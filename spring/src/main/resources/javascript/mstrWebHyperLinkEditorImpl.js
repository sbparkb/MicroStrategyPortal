mstrWebHyperLinkEditorImplScript=true;mstrWebHyperLinkEditorImpl.prototype=new mstrEditorImpl();mstrWebHyperLinkEditorImpl.prototype.objKey="";mstrWebHyperLinkEditorImpl.prototype.templateUnitID="";mstrWebHyperLinkEditorImpl.prototype.templateUnitType="";mstrWebHyperLinkEditorImpl.prototype.isNewLink=false;mstrWebHyperLinkEditorImpl.prototype.linkIndex=0;mstrWebHyperLinkEditorImpl.prototype.urlType=-1;mstrWebHyperLinkEditorImpl.prototype.TypeURL="0";mstrWebHyperLinkEditorImpl.prototype.TypeRunObject="1";mstrWebHyperLinkEditorImpl.prototype.TypeMobileURL="2";mstrWebHyperLinkEditorImpl.prototype.STATE_UNCHANGED="1";mstrWebHyperLinkEditorImpl.prototype.STATE_CHANGED="2";mstrWebHyperLinkEditorImpl.prototype.STATE_NEW="3";mstrWebHyperLinkEditorImpl.prototype.isDefault="true";mstrWebHyperLinkEditorImpl.prototype.hyperLinksInfo=[];mstrWebHyperLinkEditorImpl.prototype.currHLInfo="";mstrWebHyperLinkEditorImpl.prototype.currPrompt="";mstrWebHyperLinkEditorImpl.prototype.currPromptList="";mstrWebHyperLinkEditorImpl.prototype.defaultLinkIndex=-1;mstrWebHyperLinkEditorImpl.prototype.changed=false;mstrWebHyperLinkEditorImpl.prototype.sendAllLinks=false;mstrWebHyperLinkEditorImpl.prototype.isTextField=false;mstrWebHyperLinkEditorImpl.prototype.preCreatedHL=null;mstrWebHyperLinkEditorImpl.prototype.WEB_PROMPT_TYPE_ELEMENTS="2";mstrWebHyperLinkEditorImpl.prototype.WEB_PROMPT_TYPE_CONSTANT="1";mstrWebHyperLinkEditorImpl.prototype.TOTAL_ANSWER_MODES="9";mstrWebHyperLinkEditorImpl.prototype.SAME_PROMPT=1;mstrWebHyperLinkEditorImpl.prototype.DO_NOT_ANSWER=2;mstrWebHyperLinkEditorImpl.prototype.CLOSE=3;mstrWebHyperLinkEditorImpl.prototype.DYNAMIC=4;mstrWebHyperLinkEditorImpl.prototype.STATIC=5;mstrWebHyperLinkEditorImpl.prototype.CURRENT_UNIT=6;mstrWebHyperLinkEditorImpl.prototype.ALL_VALID_UNITS=7;mstrWebHyperLinkEditorImpl.prototype.USE_DEFAULT_ANSWER=8;mstrWebHyperLinkEditorImpl.prototype.DYNAMIC_OR_SAME_PROMPT=9;mstrWebHyperLinkEditorImpl.prototype.onload=function(e){mstrEditorImpl.prototype.onload.call(this);this.commands=new mstrDrillLinkEditorCommands();this.commands.parentBone=this;document.getElementById(this.id).iframe=false;document.getElementById(this.id+"LinkInfo").iframe=false;document.getElementById(this.id+"ifPromptList").iframe=true;this.disableHLInfo();if(this.hyperLinksInfo.length>0){this.preCreatedHL=null;if(this.defaultLinkIndex>-1){this.showLinks(this.defaultLinkIndex,true);}if(this.checkStaticAnswers()){alert("The static Link defined on the current unit cannot be modified from Web.\nAny changes applied from Web will cause the currently saved answers to be lost.");}}else{this.newHL();this.preCreatedHL=mstr.utils.Hash.clone(this.hyperLinksInfo[0]);}this.updateCheck(document.getElementById(this.id+"obUrlType"));if(this.elem){var appliesTo=this.elem.getAttribute("at");if(appliesTo&&appliesTo.length>0){this.setAppliesTo(appliesTo);}}this.hideURLInput();this.hideMobileURLInput();};mstrWebHyperLinkEditorImpl.prototype.hideURLInput=function(){if(!this.isTextField){document.getElementById(this.id+"obUrl").style.display="none";this.enableOptionAndLabel(document.getElementById(this.id+"obObjectName"));this.syncSelectTargetButtonStatus(true);document.getElementById(this.id+"obURLType1").style.display="none";document.getElementById(this.id+"obURLType1_label").style.display="none";document.getElementById(this.id+"obURLType2").style.display="none";}};mstrWebHyperLinkEditorImpl.prototype.hideMobileURLInput=function(){var needHide=!this.isTextField;if(!needHide){var doc=microstrategy.bone("rwb_viewer").doc;if(doc&&doc.selections.isOnlyOneButtonSelected()&&doc.findNavigationBar(doc.selections.firstItem())){needHide=true;}}if(needHide){document.getElementById(this.id+"obmbUrlSelector").style.display="none";document.getElementById(this.id+"obURLType3").style.display="none";document.getElementById(this.id+"obURLType3_label").style.display="none";}};mstrWebHyperLinkEditorImpl.prototype.checkStaticAnswers=function(){var result=false;for(var i=0;i<this.hyperLinksInfo.length;i++){var prms=this.hyperLinksInfo[i].prms;if(prms){for(var j=0;j<prms.length;j++){if(prms[j].am==this.STATIC){prms[j].am=this.DO_NOT_ANSWER;this.hyperLinksInfo[i].linkState=this.STATE_CHANGED;result=true;}}}}return result;};mstrWebHyperLinkEditorImpl.prototype.onunload=function(e){try{mstrEditorImpl.prototype.onunload.call(this,e);var bone=this.getAppliesTo();if(bone&&bone.observer){bone.observer.unregister(this.id);}}catch(err){microstrategy.errors.log(err);}return true;};mstrWebHyperLinkEditorImpl.prototype.disableHLInfo=function(){document.getElementById(this.id+"LinkInfo").disabled=true;};mstrWebHyperLinkEditorImpl.prototype.updateCurrentHL=function(){if(this.currHLInfo){this.setLinkName(document.getElementById(this.id+"obUrlName"));this.setURL(document.getElementById(this.id+"obUrl"));this.setSelectorOptions(document.getElementById(this.id+"selectorOptions"));}};mstrWebHyperLinkEditorImpl.prototype.showHL=function(){var obLinkInfo=document.getElementById(this.id+"LinkInfo");var obj=document.getElementById(this.id+"LinkList");if(!obj){return ;}this.currHLInfo=this.hyperLinksInfo[obj.selectedIndex];if(!this.currHLInfo||!obLinkInfo){this.clearAll();return ;}obLinkInfo.disabled=false;if(this.toolbar){this.toolbar.update();}document.getElementById(this.id+"obUrlName").value=this.currHLInfo.dtxt;var promptList=document.getElementById(this.id+"obPromptList");var ptSelector=document.getElementById(this.id+"obPTSelector");var elemSelector=document.getElementById(this.id+"elemSelector");var urlTypeInput=document.getElementById(this.id+"obURLType1");var execTypeInput=document.getElementById(this.id+"obURLType2");var urlInput=document.getElementById(this.id+"obUrl");var mobileURLTypeInpout=document.getElementById(this.id+"obURLType3");var mobileURLSelector=document.getElementById(this.id+"obmbUrlSelector");var selOpts=document.getElementById(this.id+"selectorOptions");if(!this.isTextField){if(this.currHLInfo.lt==this.TypeURL){this.currHLInfo.lt=this.TypeRunObject;}}if(this.currHLInfo.lt==this.TypeURL){urlTypeInput.checked=true;execTypeInput.checked=false;this.enableOptionAndLabel(document.getElementById(this.id+"obUrl"));this.disableOptionAndLabel(document.getElementById(this.id+"obObjectName"));this.syncSelectTargetButtonStatus(false);promptList.disabled=true;ptSelector.disabled=true;elemSelector.disabled=true;mobileURLSelector.disabled=true;this.disableOptionAndLabel(selOpts);}else{if(this.currHLInfo.lt==this.TypeMobileURL){mobileURLTypeInpout.checked=true;this.disableOptionAndLabel(document.getElementById(this.id+"obUrl"));this.disableOptionAndLabel(document.getElementById(this.id+"obObjectName"));this.syncSelectTargetButtonStatus(false);promptList.disabled=true;ptSelector.disabled=true;elemSelector.disabled=true;mobileURLSelector.disabled=false;this.disableOptionAndLabel(selOpts);}else{urlTypeInput.checked=false;execTypeInput.checked=true;this.disableOptionAndLabel(document.getElementById(this.id+"obUrl"));this.enableOptionAndLabel(document.getElementById(this.id+"obObjectName"));this.syncSelectTargetButtonStatus(true);promptList.disabled=false;ptSelector.disabled=false;elemSelector.disabled=false;mobileURLSelector.disabled=true;if(this.currHLInfo.ttp==55){this.enableOptionAndLabel(selOpts);}else{this.disableOptionAndLabel(selOpts);}}}if(this.currHLInfo.url){urlInput.value=this.currHLInfo.url;}else{urlInput.value="";}if(selOpts){selOpts.value=this.currHLInfo.so;}this.clearSelection(promptList);this.clearSelection(ptSelector);if(this.currHLInfo.tid){document.getElementById(this.id+"obObjectName").value=this.currHLInfo.tnm;document.getElementById(this.id+"obObjectID").value=this.currHLInfo.tid;document.getElementById(this.id+"obObjectType").value=this.currHLInfo.ttp;document.getElementById(this.id+"obObjectSubType").value=this.currHLInfo.tstp;var prms=this.currHLInfo.prms;this.currPromptList=this.currHLInfo.prms;if(prms){for(var i=0;i<prms.length;i++){var oOption=document.createElement("OPTION");promptList.options.add(oOption);oOption.innerHTML=prms[i].nm;oOption.value=prms[i].id;oOption.pt=prms[i].pt;}}}else{document.getElementById(this.id+"obObjectName").value="";}var oOption=document.createElement("OPTION");promptList.options.add(oOption);oOption.innerHTML=microstrategy.descriptors.getDescriptor("5969");oOption.value=-1;oOption.pt=-1;promptList.selectedIndex=0;this.showPTSelector(promptList);this.showMobileURLSelection();if(this.currHLInfo.lt==this.TypeURL||this.currHLInfo.lt==this.TypeMobileURL){ptSelector.disabled=true;promptList.disabled=true;}};mstrWebHyperLinkEditorImpl.prototype.showPTSelector=function(obj){var ptSelector=document.getElementById(this.id+"obPTSelector");var ptSelectorHelper=document.getElementById(this.id+"obPTSelectorHelper");ptSelector.disabled=false;this.clearSelection(ptSelector);var pCs=null;this.currPrompt=null;if(this.currHLInfo.prms){this.currPrompt=this.currHLInfo.prms[obj.selectedIndex];}var sIdx=0;for(var i=1;i<=this.TOTAL_ANSWER_MODES;i++){if(this.checkAM(this.currPrompt,i)){var oOptionHlp=ptSelectorHelper.options[i];var oOption=document.createElement("OPTION");ptSelector.options.add(oOption);oOption.innerHTML=oOptionHlp.text;oOption.id=oOptionHlp.id;if(this.currPrompt){if(this.currPrompt.am==i){sIdx=ptSelector.options.length-1;}}else{if(this.currHLInfo.aop==i){sIdx=ptSelector.options.length-1;}}}}ptSelector.selectedIndex=sIdx;this.updateFormList();};mstrWebHyperLinkEditorImpl.prototype.showMobileURLSelection=function(){var mobileURLSelector=document.getElementById(this.id+"obmbUrlSelector"),chi=this.currHLInfo,sIdx=0;if(chi.mobileurl){for(var i=0;i<mobileURLSelector.options.length;i++){if(chi.mobileurl==mobileURLSelector.options[i].value){sIdx=i;break;}}}if(sIdx==-1){sIdx=0;chi.mobileurl=mobileURLSelector.options[sIdx].value;}mobileURLSelector.selectedIndex=sIdx;};mstrWebHyperLinkEditorImpl.prototype.checkAM=function(prompt,am){if(prompt){switch(am){case this.SAME_PROMPT:case this.DO_NOT_ANSWER:case this.CLOSE:case this.USE_DEFAULT_ANSWER:return true;case this.DYNAMIC:return(prompt.pt==this.WEB_PROMPT_TYPE_ELEMENTS)||(prompt.pt==this.WEB_PROMPT_TYPE_CONSTANT&&!this.isTextField);break;case this.CURRENT_UNIT:case this.ALL_VALID_UNITS:return((prompt.ish)&&(!this.isTextField));case this.DYNAMIC_OR_SAME_PROMPT:return prompt.pt==this.WEB_PROMPT_TYPE_ELEMENTS;default:return false;}}else{switch(am){case this.SAME_PROMPT:case this.DO_NOT_ANSWER:case this.CLOSE:case this.USE_DEFAULT_ANSWER:return true;default:return false;}}};mstrWebHyperLinkEditorImpl.prototype.setPromptAnser=function(selection){var ptSelector=document.getElementById(this.id+"obPTSelector");var selectedItem=ptSelector.options.item(ptSelector.selectedIndex);var elemSelector=document.getElementById(this.id+"elemSelector");if(selectedItem.id==5){elemSelector.disabled=false;}else{elemSelector.disabled=true;}if(this.currPrompt){this.currPrompt.am=selectedItem.id;}else{this.currHLInfo.aop=selectedItem.id;}var fsel=document.getElementById(this.id+"formSelector");if(fsel){if((selectedItem.id==this.DYNAMIC)&&this.currPrompt&&(this.currPrompt.pt==this.WEB_PROMPT_TYPE_CONSTANT)){this.setForm(fsel,true);}else{fsel.style.display="none";if(this.currPrompt&&(this.currPrompt.pt!=this.WEB_PROMPT_TYPE_ELEMENTS)){this.currPrompt.orid=null;}if(this.currPrompt){this.currPrompt.formId=null;}}}this.currHLValueChanged();};mstrWebHyperLinkEditorImpl.prototype.setMobileURLSelection=function(actSelection){var mobileURLSelector=document.getElementById(this.id+"obmbUrlSelector");var selectedItem=mobileURLSelector.options.item(mobileURLSelector.selectedIndex);if(this.currHLInfo.mobileurl!=selectedItem.value){this.currHLInfo.mobileurl=selectedItem.value;this.currHLValueChanged();}};mstrWebHyperLinkEditorImpl.prototype.setForm=function(fsel,renderFormList){if(renderFormList){this.updateFormList();}var sel=fsel&&fsel.options.item(fsel.selectedIndex);var ids=sel&&sel.id&&sel.id.split("_");if(this.currPrompt&&ids&&ids[0]&&ids[1]&&ids[2]){this.currPrompt.orid=ids[0];this.currPrompt.formId=ids[1];this.currPrompt.ortp=ids[2];}this.currHLValueChanged();};mstrWebHyperLinkEditorImpl.prototype.updateFormList=function(){var fl=document.getElementById(this.id+"formSelector");var flh=document.getElementById(this.id+"formSelectorHelper");if(fl&&flh){if(this.currPrompt&&this.currPrompt.am==this.DYNAMIC&&this.currPrompt.pt==this.WEB_PROMPT_TYPE_CONSTANT){this.clearSelection(fl);var ids=this.currPrompt.orid+"_"+this.currPrompt.formId+"_"+this.currPrompt.ortp;var existed=false;for(var i=0;i<flh.options.length;i++){var oph=flh.options[i];var op=document.createElement("OPTION");fl.options.add(op);op.id=oph.id;op.innerHTML=oph.text;if(op.id==ids){fl.selectedIndex=i;existed=true;}}if(!existed&&this.currPrompt.tn&&this.currPrompt.orid&&this.currPrompt.formId){var opExtra=document.createElement("OPTION");fl.options.add(opExtra);opExtra.id=ids;opExtra.innerHTML=this.currPrompt.tn;fl.selectedIndex=fl.options.length-1;}fl.style.display="";fl.disabled=false;}else{fl.style.display="none";}}};mstrWebHyperLinkEditorImpl.prototype.currHLValueChanged=function(){if(this.currHLInfo.linkState!=this.STATE_NEW){this.currHLInfo.linkState=this.STATE_CHANGED;}};mstrWebHyperLinkEditorImpl.prototype.newHL=function(){var obj=document.getElementById(this.id+"LinkList");var hl={};hl.idx=this.hyperLinksInfo.length;if(this.hyperLinksInfo.length==0){this.defaultLinkIndex=0;hl.idf=true;}else{hl.idf=false;}hl.dtxt=this.getNewLinkName();hl.lt=this.TypeURL;hl.url="http://";hl.linkState=this.STATE_NEW;hl.aop=2;hl.so=0;this.hyperLinksInfo[this.hyperLinksInfo.length]=hl;this.showLinks(hl.idx,true);this.syncToolbarIconStatus("tbDeleteGroup",true);};mstrWebHyperLinkEditorImpl.prototype.getNewLinkName=function(){var ndx=1;var defaultName=microstrategy.descriptors.getDescriptor("4546");for(var i=0;i<this.hyperLinksInfo.length;i++){if(this.hyperLinksInfo[i].dtxt==defaultName+ndx){i=-1;ndx++;}}return defaultName+ndx;};mstrWebHyperLinkEditorImpl.prototype.showLinks=function(hlidx,renderLinkInfo){var obj=document.getElementById(this.id+"LinkList");if(obj){this.clearSelection(obj);for(var i=0;i<this.hyperLinksInfo.length;i++){var oOption=document.createElement("OPTION");obj.options.add(oOption);oOption.innerHTML=this.hyperLinksInfo[i].dtxt;oOption.value=this.hyperLinksInfo[i].id;if(this.hyperLinksInfo[i].idf){oOption.style.fontWeight="700";}}this.updateCurrentHL();obj.selectedIndex=hlidx;if(renderLinkInfo){this.showHL();}}};mstrWebHyperLinkEditorImpl.prototype.deleteHL=function(){var obj=document.getElementById(this.id+"LinkList");if(obj.selectedIndex==this.defaultLinkIndex){var nextHL=this.hyperLinksInfo[obj.selectedIndex+1];if(nextHL){nextHL.idf=true;}else{this.defaultLinkIndex=-1;}}this.deleteItem(this.hyperLinksInfo,obj.selectedIndex);if(this.hyperLinksInfo.length==0){this.clearAll();}this.showLinks(obj.selectedIndex>=this.hyperLinksInfo.length?this.hyperLinksInfo.length-1:obj.selectedIndex,true);this.sendAllLinks=true;if(this.hyperLinksInfo.length==0){this.syncToolbarIconStatus("tbClearDefault",false);this.syncToolbarIconStatus("tbDeleteGroup",false);}};mstrWebHyperLinkEditorImpl.prototype.syncToolbarIconStatus=function(id,status){var iconElem=document.getElementById(id);var idx=iconElem.className.indexOf(" disabled");if(status==true){if(idx>0){iconElem.className=iconElem.className.substr(0,idx);}}else{if(idx<0){iconElem.className=iconElem.className+" disabled";}}};mstrWebHyperLinkEditorImpl.prototype.clearAll=function(){document.getElementById(this.id+"LinkInfo").disabled=true;document.getElementById(this.id+"obUrlName").value="";var promptList=document.getElementById(this.id+"obPromptList");var ptSelector=document.getElementById(this.id+"obPTSelector");var formSelector=document.getElementById(this.id+"formSelector");var elemSelector=document.getElementById(this.id+"elemSelector");var urlInput=document.getElementById(this.id+"obUrl");document.getElementById(this.id+"obURLType1").checked=false;document.getElementById(this.id+"obURLType2").checked=false;document.getElementById(this.id+"obObjectName").value="";this.syncSelectTargetButtonStatus(false);urlInput.disabled=true;promptList.disabled=true;ptSelector.disabled=true;formSelector.disabled=true;elemSelector.disabled=true;urlInput.value="";this.clearSelection(promptList);this.clearSelection(ptSelector);this.clearSelection(formSelector);};mstrWebHyperLinkEditorImpl.prototype.deleteItem=function(list,index){for(var i=index;i<list.length-1;i++){list[i]=list[i+1];}if(list.length>0){list.length-=1;}};mstrWebHyperLinkEditorImpl.prototype.moveUpHL=function(){var obj=document.getElementById(this.id+"LinkList");if(obj.selectedIndex>0){var temp=this.hyperLinksInfo[obj.selectedIndex];this.hyperLinksInfo[obj.selectedIndex]=this.hyperLinksInfo[obj.selectedIndex-1];this.hyperLinksInfo[obj.selectedIndex-1]=temp;if(obj.selectedIndex==this.defaultLinkIndex){this.defaultLinkIndex=obj.selectedIndex-1;}this.showLinks(obj.selectedIndex-1,false);if(this.toolbar){this.toolbar.update();}}this.sendAllLinks=true;};mstrWebHyperLinkEditorImpl.prototype.moveDnHL=function(){var obj=document.getElementById(this.id+"LinkList");if(obj.selectedIndex<this.hyperLinksInfo.length-1){var temp=this.hyperLinksInfo[obj.selectedIndex];this.hyperLinksInfo[obj.selectedIndex]=this.hyperLinksInfo[obj.selectedIndex+1];this.hyperLinksInfo[obj.selectedIndex+1]=temp;if(obj.selectedIndex==this.defaultLinkIndex){this.defaultLinkIndex=obj.selectedIndex+1;}this.showLinks(obj.selectedIndex+1,false);if(this.toolbar){this.toolbar.update();}}this.sendAllLinks=true;};mstrWebHyperLinkEditorImpl.prototype.setDefaultHL=function(){var obj=document.getElementById(this.id+"LinkList");this.currHLInfo.idf=!this.currHLInfo.idf;this.currHLValueChanged();if(this.defaultLinkIndex!=obj.selectedIndex){var hl=this.hyperLinksInfo[this.defaultLinkIndex];this.defaultLinkIndex=obj.selectedIndex;if(hl){hl.idf=false;if(hl.linkState!=this.STATE_NEW){hl.linkState=this.STATE_CHANGED;}}}else{this.defaultLinkIndex=-1;}this.showLinks(obj.selectedIndex,false);if(this.toolbar){this.toolbar.update();}};mstrWebHyperLinkEditorImpl.prototype.setOpenInNewWindow=function(obj){this.changed=true;};mstrWebHyperLinkEditorImpl.prototype.clearSelection=function(selection){while(selection.length>0){selection.remove(0);}};mstrWebHyperLinkEditorImpl.prototype.setLinkName=function(NameInput){if(NameInput.value.length>0&&this.currHLInfo.dtxt!=NameInput.value){this.currHLInfo.dtxt=NameInput.value;this.currHLValueChanged();this.showLinks(this.currHLInfo.idx,false);}};mstrWebHyperLinkEditorImpl.prototype.updateCheck=function(obj){try{if(obj){var selOpts=document.getElementById(this.id+"selectorOptions");switch(obj.getAttribute(microstrategy.HTMLATTR_CMD_ID)){case"URLType":var objs=document.getElementsByName(obj.name);var value=this.TypeURL;for(var i=0;i<objs.length;i++){if(objs[i].checked==true){value=objs[i].value;break;}}if(value==this.TypeURL){this.syncSelectTargetButtonStatus(false);this.enableOptionAndLabel(document.getElementById(this.id+"obUrl"));this.disableOptionAndLabel(document.getElementById(this.id+"obObjectName"));this.urlType=this.TypeURL;document.getElementById(this.id+"obPromptList").disabled=true;document.getElementById(this.id+"obPTSelector").disabled=true;document.getElementById(this.id+"obmbUrlSelector").disabled=true;this.disableOptionAndLabel(selOpts);}else{if(value==this.TypeMobileURL){this.syncSelectTargetButtonStatus(false);document.getElementById(this.id+"obURLType3").checked=true;this.disableOptionAndLabel(document.getElementById(this.id+"obUrl"));this.disableOptionAndLabel(document.getElementById(this.id+"obObjectName"));this.urlType=this.TypeMobileURL;document.getElementById(this.id+"obPromptList").disabled=true;document.getElementById(this.id+"obPTSelector").disabled=true;document.getElementById(this.id+"obmbUrlSelector").disabled=false;this.setMobileURLSelection(null);this.disableOptionAndLabel(selOpts);}else{if(value==this.TypeRunObject){this.syncSelectTargetButtonStatus(true);this.enableOptionAndLabel(document.getElementById(this.id+"obObjectName"));this.disableOptionAndLabel(document.getElementById(this.id+"obUrl"));this.urlType=this.TypeRunObject;document.getElementById(this.id+"obPromptList").disabled=false;document.getElementById(this.id+"obPTSelector").disabled=false;document.getElementById(this.id+"obmbUrlSelector").disabled=true;if(this.currHLInfo.ttp==55){this.enableOptionAndLabel(selOpts);}else{this.disableOptionAndLabel(selOpts);}}}}if(this.currHLInfo){if(this.currHLInfo.lt!=value){this.currHLInfo.lt=value;this.currHLValueChanged();}}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrWebHyperLinkEditorImpl.prototype.syncSelectTargetButtonStatus=function(isEnabled){var obObjectNameElem=document.getElementById(this.id+"obObjectName");var selectTargetButton=obObjectNameElem.parentNode.lastChild;if(isEnabled==true){selectTargetButton.disabled=false;selectTargetButton.className="mstrButton";}else{selectTargetButton.disabled=true;selectTargetButton.className="mstrButtonDisabled";}};mstrWebHyperLinkEditorImpl.prototype.setURL=function(URLInput){if(this.currHLInfo.url!=URLInput.value){this.currHLInfo.url=URLInput.value;this.currHLValueChanged();}};mstrWebHyperLinkEditorImpl.prototype.setSelectorOptions=function(selectorOptions){if(selectorOptions){var selectedItem=selectorOptions.options.item(selectorOptions.selectedIndex);if(this.currHLInfo.so!=selectedItem.value){this.currHLInfo.so=selectedItem.value;this.currHLValueChanged();}}};mstrWebHyperLinkEditorImpl.prototype.disableOptionAndLabel=function(option){try{if(option){option.disabled=true;option.className="disabled";if(document.getElementById(option.id+"_label")){document.getElementById(option.id+"_label").className="disabledLabel";}}}catch(err){microstrategy.errors.log(err);return false;}};mstrWebHyperLinkEditorImpl.prototype.enableOptionAndLabel=function(option){try{if(option){option.disabled=false;option.className="";if(document.getElementById(option.id+"_label")){document.getElementById(option.id+"_label").className="";}}}catch(err){microstrategy.errors.log(err);return false;}};mstrWebHyperLinkEditorImpl.prototype.exec=function(cmdID,cmdValue){try{switch(cmdID){case"UpdateObjectInfo":var inputID=document.getElementById(this.id+"obObjectID");var inputName=document.getElementById(this.id+"obObjectName");var objType=document.getElementById(this.id+"obObjectType");var objSubType=document.getElementById(this.id+"obObjectSubType");if(inputName&&inputID){var values=cmdValue.split("\u001E");inputID.value=values[0];inputName.value=values[1];objType.value=values[2];objSubType.value=values[3];if(this.currHLInfo){this.currHLInfo.tid=values[0];this.currHLInfo.tnm=values[1];this.currHLInfo.ttp=values[2];this.currHLInfo.tstp=values[3];this.currHLValueChanged();}var objSelector=microstrategy.bone(values[4]);objSelector.closeEditor();objSelector.closed=true;inputName.setAttribute("title",values[1]);}var execTypeInput=document.getElementById(this.id+"obURLType2");if(execTypeInput){execTypeInput.checked=true;}this.updateCheck(execTypeInput);this.setTarget();break;}}catch(err){microstrategy.errors.log(err);return null;}};mstrWebHyperLinkEditorImpl.prototype.setTarget=function(){var params="renderPromptsOnly=true";params+="&targetID="+this.currHLInfo.tid;params+="&targetType="+this.currHLInfo.ttp;toggleShowBean("webHyperLinkEditor",true,params);};mstrWebHyperLinkEditorImpl.prototype.okChanges=function(){try{if(this.preCreatedHL&&this.hyperLinksInfo!=null&&this.hyperLinksInfo.length==1){if(mstr.utils.Hash.equals(this.preCreatedHL,this.hyperLinksInfo[0])&&this.changed==false){this.closeEditor();return ;}}this.updateCurrentHL();var errHLIndex=this.checkLinks();if(errHLIndex<0){this.apply();this.closeEditor();if(microstrategy.EDIT_MODE==microstrategy.ALLOW_EDIT_MODE){microstrategy.updateManager.flushAndSubmitChanges();}}else{var msg=microstrategy.descriptors.getDescriptor("6072").replace("##",this.hyperLinksInfo[errHLIndex].dtxt);alert(msg);this.showLinks(errHLIndex,true);}}catch(err){microstrategy.errors.log(err);return false;}};mstrWebHyperLinkEditorImpl.prototype.apply=function(){try{var targetBeanPath=null;if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){var appliesTo=this.getAppliesTo();targetBeanPath=appliesTo.beanPath;}else{targetBeanPath=this.getSelectedPath();}this.pushEvents(targetBeanPath);}catch(err){microstrategy.errors.log(err);return false;}};mstrWebHyperLinkEditorImpl.prototype.checkLinks=function(){var ret_val=-1;for(var i=0;i<this.hyperLinksInfo.length;i++){if(this.hyperLinksInfo[i].lt!=this.TypeURL&&this.hyperLinksInfo[i].lt!=this.TypeMobileURL&&!(this.hyperLinksInfo[i].tid)){ret_val=i;break;}}return ret_val;};mstrWebHyperLinkEditorImpl.prototype.pushEvents=function(tbPath){if(this.sendAllLinks){this.pushHLSEditEvent(tbPath,this.isTextField?mstrUpdateManager.CLEAR_WEB_HYPERLINKS_RW:mstrUpdateManager.CLEAR_WEB_HYPERLINKS);for(var i=0;i<this.hyperLinksInfo.length;i++){this.hyperLinksInfo[i].linkState=this.STATE_NEW;}this.pushIndividualEvents(tbPath);}else{if(this.changed){this.pushHLSEditEvent(tbPath,this.isTextField?mstrUpdateManager.EDIT_WEB_HYPERLINKS_RW:mstrUpdateManager.EDIT_WEB_HYPERLINKS);}this.pushIndividualEvents(tbPath);}};mstrWebHyperLinkEditorImpl.prototype.pushIndividualEvents=function(tbPath){for(var i=0;i<this.hyperLinksInfo.length;i++){var hl=this.hyperLinksInfo[i];if(hl.linkState==this.STATE_CHANGED){this.pushHLEvent(hl,this.isTextField?mstrUpdateManager.EDIT_WEB_HYPERLINK_RW:mstrUpdateManager.EDIT_WEB_HYPERLINK,tbPath,i);}else{if(hl.linkState==this.STATE_NEW){this.pushHLEvent(hl,this.isTextField?mstrUpdateManager.ADD_WEB_HYPERLINK_RW:mstrUpdateManager.ADD_WEB_HYPERLINK,tbPath,i);}}}};mstrWebHyperLinkEditorImpl.prototype.pushHLSEditEvent=function(tbPath,eventID){var um=microstrategy.updateManager;var ac=new Array();var onw=document.getElementById(this.id+"obNewWin");var onwVal;if(onw.checked){onwVal=1;}else{onwVal=0;}ac.push(um.createActionObject(this.elem,eventID,tbPath,["2048012","4248","4249","4250","4110"],[this.objKey,this.templateUnitID,this.templateUnitType,onwVal,microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION],[]));um.add(ac);};mstrWebHyperLinkEditorImpl.prototype.pushHLSUpdateEvent=function(tbPath){var um=microstrategy.updateManager;var ac=new Array();var xml=this.buildHyperLinksXml();ac.push(um.createActionObject(this.elem,mstrUpdateManager.UPDATE_WEB_HYPERLINKS,tbPath,["2048012","4248","4249","4110","4253"],[this.objKey,this.templateUnitID,this.templateUnitType,"0",xml],[]));um.add(ac);};mstrWebHyperLinkEditorImpl.prototype.buildHyperLinksXml=function(){var onw=document.getElementById(this.id+"obNewWin");var onwVal;if(onw.checked){onwVal=1;}else{onwVal=0;}var xml="<hls"+microstrategy.addXmlAttr("onw",onwVal)+">";for(var i=0;i<this.hyperLinksInfo.length;i++){var hlInfo=this.hyperLinksInfo[i];xml+=this.buildLinkXml(hlInfo);}xml+="</hls>";return xml;};mstrWebHyperLinkEditorImpl.prototype.buildLinkXml=function(linkInfo){var xml="<hl";var attrs=microstrategy.addXmlAttr("dtxt",linkInfo.dtxt)+microstrategy.addXmlAttr("idf",linkInfo.idf?"1":"0")+microstrategy.addXmlAttr("lt",linkInfo.lt)+microstrategy.addXmlAttr("aopam",linkInfo.aop);if(linkInfo.lt==this.TypeURL){attrs+=microstrategy.addXmlAttr("url",linkInfo.url);xml+=attrs+"/>";}else{if(linkInfo.lt==this.TypeMobileURL){attrs+=microstrategy.addXmlAttr("url",linkInfo.mobileurl);xml+=attrs+"/>";}else{attrs+=microstrategy.addXmlAttr("tid",linkInfo.tid)+microstrategy.addXmlAttr("ttp",linkInfo.ttp)+microstrategy.addXmlAttr("so",linkInfo.so);xml+=attrs+">";var prms=linkInfo.prms;if(prms!=null){xml+="<prms>";for(var i=0;i<prms.length;i++){var prm=prms[i];xml+="<prm"+microstrategy.addXmlAttr("id",prm.id)+microstrategy.addXmlAttr("am",prm.am)+microstrategy.addXmlAttr("pt",prm.pt);if(prm.orid){xml+=microstrategy.addXmlAttr("orid",prm.orid)+microstrategy.addXmlAttr("ortp",prm.ortp);}xml+="/>";}xml+="</prms>";}xml+="</hl>";}}return xml;};mstrWebHyperLinkEditorImpl.prototype.pushHLEvent=function(hl,eventID,tbPath,index){var um=microstrategy.updateManager;var serializer=new mstrSerializer();this.serializePrompts(serializer,hl);var ac=new Array();var idf;if(hl.idf){idf=1;}else{idf=0;}if(hl.lt==this.TypeURL||hl.lt==this.TypeMobileURL){var url;if(hl.lt==this.TypeURL){url=hl.url?hl.url:"http://";}else{url=hl.mobileurl?hl.mobileurl:"mstr://";}ac.push(um.createActionObject(this.elem,eventID,tbPath,["2048012","4239","4240","4241","4242","4243","4248","4249","4252","4110"],[this.objKey,index,idf,hl.dtxt,hl.lt,url,this.templateUnitID,this.templateUnitType,hl.aop,microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION],[]));}else{ac.push(um.createActionObject(this.elem,eventID,tbPath,["2048012","4239","4240","4241","4242","4244","4245","4246","4247","4248","4249","4252","4110","4257"],[this.objKey,index,idf,hl.dtxt,hl.lt,hl.tid,hl.ttp,hl.tstp,serializer.getState(),this.templateUnitID,this.templateUnitType,hl.aop,microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION,hl.so],[]));}um.add(ac);};mstrWebHyperLinkEditorImpl.prototype.serializePrompts=function(serializer,hl){var prms=new Array();if(hl.prms){for(var i=0;i<hl.prms.length;i++){prms.push(this.serializePrompt(hl.prms[i]));}}serializer.addValues(prms);};mstrWebHyperLinkEditorImpl.prototype.serializePrompt=function(prmpt){var serializer=new mstrSerializer();serializer.addStr(prmpt.pt);serializer.addStr(prmpt.id);serializer.addStr(prmpt.am);if(prmpt.orid){serializer.addStr(prmpt.orid);serializer.addStr(prmpt.ortp);if(prmpt.pt==this.WEB_PROMPT_TYPE_CONSTANT&&prmpt.am==this.DYNAMIC){serializer.addStr(prmpt.formId);}}return serializer.getState();};mstrWebHyperLinkEditorImpl.prototype.setAppliesTo=function(bone){try{if(!this.appliesTo){this.appliesTo=(typeof (bone)=="string")?bone:bone.id;}bone=microstrategy.bone(this.appliesTo);if(bone.observer){bone.observer.register(this.id);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrWebHyperLinkEditorImpl.prototype.getAppliesTo=function(){try{if(this.appliesTo){var bone=microstrategy.bone(this.appliesTo);return bone;}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrWebHyperLinkEditorImpl.prototype.getSelectedPath=function(){try{var appliesTo=this.getAppliesTo();var selections=appliesTo.doc.selections;var item=selections.getItems()[0];var bonePath=appliesTo.beanPath;if(item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){bonePath+="."+item.id;}return bonePath;}catch(err){microstrategy.errors.log(err);return false;}};function mstrWebHyperLinkEditorImpl(id){this.inherits=mstrEditorImpl;this.inherits(id);delete this.inherits;return this;}mstrDrillLinkEditorCommands.prototype=new Object();mstrDrillLinkEditorCommands.prototype.exec=function(cmdId,cmdValue){try{switch(cmdId){case"new":this.parentBone.newHL();break;case"delete":this.parentBone.deleteHL();break;case"up":this.parentBone.moveUpHL();break;case"down":this.parentBone.moveDnHL();break;case"setDefault":case"clearDefault":this.parentBone.setDefaultHL();break;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDrillLinkEditorCommands.prototype.queryEnabled=function(cmdId){try{var obj=null;switch(cmdId){case"up":obj=document.getElementById(this.parentBone.id+"LinkList");return obj&&obj.selectedIndex!=0;case"down":obj=document.getElementById(this.parentBone.id+"LinkList");return obj&&obj.selectedIndex<obj.length-1;case"setDefault":return this.parentBone.currHLInfo&&!this.parentBone.currHLInfo.idf;case"clearDefault":return this.parentBone.currHLInfo&&this.parentBone.currHLInfo.idf;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDrillLinkEditorCommands.prototype.queryState=function(cmdId){try{return null;}catch(err){microstrategy.errors.log(err);return false;}};function mstrDrillLinkEditorCommands(){return this;}mstrDrillLinkToolbarScript=true;mstrDrillLinkToolbar.prototype=new mstrEditorToolbar();mstrDrillLinkToolbar.prototype.onload=function(){try{mstrEditorToolbar.prototype.onload.call(this);this.update();var at=this.getAppliesTo();if(at){at.toolbar=this;}}catch(err){microstrategy.errors.log(err);}};function mstrDrillLinkToolbar(id){this.inherits=mstrEditorToolbar;this.inherits(id);delete this.inherits;return this;}