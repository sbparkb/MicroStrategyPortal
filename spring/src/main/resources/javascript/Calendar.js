CalendarScript=true;var Month;var Year;var textBoxID;var bIsSeen=false;var sOperator=null;var sDateFormat="DD/MM/YYYY";var imgID;var calendarOldMouseDownHandler=null;function isLeapYear(myYear){if(((myYear%4)==0)&&((myYear%100)!=0)||((myYear%400)==0)){return(true);}else{return(false);}}function getDaysOfMonth(myMonth,myYear){var days;if(myMonth==1||myMonth==3||myMonth==5||myMonth==7||myMonth==8||myMonth==10||myMonth==12){days=31;}else{if(myMonth==4||myMonth==6||myMonth==9||myMonth==11){days=30;}else{if(myMonth==2){if(isLeapYear(myYear)){days=29;}else{days=28;}}}}return(days);}function showCalendar(myMonth,myYear,myTextBoxID,myLeft,myTop,myImgID,myFirstDayOfWeek,dateMaxArg,dateMinArg){var fb=getFilterBone();if(fb&&fb.shouldOpenDynamicDateEditor&&fb.shouldOpenDynamicDateEditor()){openDynamicDateEditor(myMonth,myYear,myTextBoxID,myLeft,myTop,myImgID,myFirstDayOfWeek,dateMaxArg,dateMinArg);return ;}if(bIsSeen){hideCalendar();if(imgID!=myImgID){makeCalendar(myMonth,myYear,myTextBoxID,myLeft,myTop,myFirstDayOfWeek,dateMaxArg,dateMinArg);bIsSeen=true;imgID=myImgID;calendarOldMouseDownHandler=document.onmousedown;document.onmousedown=new Function("e","var rtVal = calendarOldMouseDownHandler && calendarOldMouseDownHandler(e); calendarOnMouseDown(e); return rtVal;");}}else{makeCalendar(myMonth,myYear,myTextBoxID,myLeft,myTop,myFirstDayOfWeek,dateMaxArg,dateMinArg);bIsSeen=true;imgID=myImgID;calendarOldMouseDownHandler=document.onmousedown;document.onmousedown=new Function("e","var rtVal = calendarOldMouseDownHandler && calendarOldMouseDownHandler(e); calendarOnMouseDown(e); return rtVal;");}}function getFilterBone(){return(!microstrategy.bone("promptTabMgr_PromptDialogStyle")&&(microstrategy.bone("rfe_pane")||microstrategy.bone("fexb_pane")));}function openDynamicDateEditor(myMonth,myYear,myTextBoxID,myLeft,myTop,myImgID,myFirstDayOfWeek,dateMaxArg,dateMinArg){var $M=window.mstrmojo,id="mstrDDE",dde=$M&&$M.all[id],ddeData=getFilterBone().dd||getFilterBone()._dd||{tp:parseInt(getFilterBone().selectedDataType,10)},openDDE=function(){$M=mstrmojo;dde=$M.insert({scriptClass:"mstrmojo.DynamicDateEditor",id:id,ddeData:ddeData,updatePopupConfig:function updatePopupConfig(config,opener){this.set("left",config.l+"px");this.set("top",config.t+"px");},switchToStaticDatePicker:function switchToStaticDatePicker(){getFilterBone().showDynamicDatePicker=false;document.getElementById(myTextBoxID).name=myTextBoxID;showCalendar(myMonth,myYear,myTextBoxID,myLeft,myTop,myImgID,myFirstDayOfWeek,dateMaxArg,dateMinArg);this.close();},okCallback:function(evt){var cv=document.getElementById(myTextBoxID);if(cv.name!==myTextBoxID+"Txt"){cv.name=myTextBoxID+"Txt";}var oForm=document.getElementById("feForm"),found=false,i;if(oForm){var oInputs=oForm.getElementsByTagName("input");for(i=0;i<oInputs.length;i++){found=(oInputs[i].name===myTextBoxID);if(found){break;}}if(!found){createHiddenInput(oForm,myTextBoxID,cv.value);}fillTextBoxOnOpt(oInputs[i],evt.str);}fillTextBoxOnOpt(cv,evt.dr);getFilterBone()._dd=this.ddeData;getFilterBone().showDynamicDatePicker=true;},onClose:function(evt){this.destroy();}});dde.render();dde.open(null,{l:myLeft,t:myTop});};if(dde){dde.set("ddeData",ddeData);dde.open(null,{l:myLeft,t:myTop});}else{microstrategy.mojoLoader.loadWidget({scriptClass:"DynamicDateEditor",bundle:"mojo-dde.js",callback:openDDE});}}function calendarOnMouseDown(e){if(!bIsSeen){return true;}if(!e){e=window.event;}var obj=getEventTarget(e);if(!findTarget(obj,"id","CalendarTable")&&!findTarget(obj,"id",imgID)&&!findTarget(obj,"id","swtchToDDE")){hideCalendar();}}function adjustYear(Year){if(sDateFormat.search("YYYY")==-1){if(Year<10){Year=2000+Year;}else{if(Year<200){Year=1900+Year;}}}return Year;}function makeCalendar(myMonth,myYear,myTextBoxID,myLeft,myTop,myFirstDayOfWeek,dateMaxArg,dateMinArg){dateMaxArg=dateMaxArg||"";dateMinArg=dateMinArg||"";if(isNaN(myMonth)||isNaN(myYear)||(myMonth==0&&myYear==0)){myDate=new Date();Year=myDate.getFullYear();Month=myDate.getMonth()+1;}else{if(myMonth==0){Month=12;Year=myYear-1;}else{if(myMonth>=13){Month=1;Year=myYear+1;}else{Month=myMonth;Year=myYear;}}}Year=adjustYear(Year);textBoxID=getObj(myTextBoxID);var minRestDate=getRestDate(dateMinArg);var maxRestDate=getRestDate(dateMaxArg);smonth=asDescriptors[Month];var sTableHtml;sTableHtml='<table ID="CalendarTable" NAME="CalendarTable" class="inner" bgcolor="#eeeeee" cellpadding="1" cellspacing="0">';sTableHtml=sTableHtml+'<tr><td class="arrow" onClick="makeCalendar('+(Month-1)+","+Year+",'"+myTextBoxID+"',"+myLeft+","+myTop+","+myFirstDayOfWeek+",'"+dateMaxArg+"', '"+dateMinArg+'\');" ><IMG SRC="../images/arrow_left_cal.gif"></td>';sTableHtml=sTableHtml+'<td colspan="5" align="center" class="event">'+smonth+" "+Year+"</td>";sTableHtml=sTableHtml+'<td class="arrow" onClick="makeCalendar('+(Month+1)+","+Year+",'"+myTextBoxID+"',"+myLeft+","+myTop+","+myFirstDayOfWeek+",'"+dateMaxArg+"', '"+dateMinArg+'\');" ><IMG SRC="../images/arrow_right_cal.gif"></td></tr>';sTableHtml=sTableHtml+"<tr>";sTableHtml=sTableHtml+renderWeekBar(myFirstDayOfWeek,asDescriptors,13);sTableHtml=sTableHtml+"</tr><tr>";firstOfMonth=new Date(Year,Month-1,(1-myFirstDayOfWeek)+1);leave=firstOfMonth.getDay();for(i=0;i<leave;i++){sTableHtml=sTableHtml+"<td>&nbsp;</td>";}totalDays=getDaysOfMonth(Month,Year);for(day=1;day<=totalDays;day++){var isDayActive=validateMixMaxDate(maxRestDate,minRestDate,Year,Month-1,day);if(isDayActive){sTableHtml=sTableHtml+'<td class="day" onClick="fillTextBox('+day+",'"+myTextBoxID+'\');" ><span class="norm">&nbsp;'+day+"&nbsp;</span></td>";}else{sTableHtml=sTableHtml+'<td class="day" onClick="hideCalendar();" ><span class="grayOut">&nbsp;'+day+"&nbsp;</span></td>";}i++;if(i%7==0){sTableHtml=sTableHtml+"</tr><tr>";}}if(i%7!=0){var remainder=7-i%7;for(day=1;day<=remainder;day++){sTableHtml=sTableHtml+"<td>&nbsp;</td>";}}sTableHtml=sTableHtml+"</tr></table>";if(getFilterBone()){sTableHtml+="<div id='swtchToDDE' style='cursor:pointer;color:#12B;text-decoration:underline;background-color:#eee;border:1px solid #777;margin-top:-1px;padding:3px;'onclick=\"getFilterBone().showDynamicDatePicker=true;hideCalendar();openDynamicDateEditor("+Month+","+Year+",'"+myTextBoxID+"',"+myLeft+","+myTop+",1,"+myFirstDayOfWeek+",'"+dateMaxArg+"', '"+dateMinArg+"');\" >"+switchToDynamicLink+"</div>";}writeToDiv(sTableHtml,"Calendar");moveObjTo("Calendar",myLeft,myTop);var calendarObj=getObj("Calendar");if(calendarObj){calendarObj.style.position="absolute";calendarObj.style.zIndex=999;}displayObj("Calendar");showHidePulldowns(false,myLeft,myTop);document.getElementById("CalendarTable").style.visibility="visible";}function getRestDate(strRest){var restDate=null;var yearStr=getObj(strRest+"_year");var monthStr=getObj(strRest+"_month");var dayStr=getObj(strRest+"_day");if(yearStr&&monthStr&&dayStr){restDate=new Date(yearStr.value,monthStr.value,dayStr.value);}return restDate;}function validateMixMaxDate(maxRestDate,minRestDate,Year,Month,day){var isDayActive=true;if(maxRestDate){var maxRestDateYear=maxRestDate.getFullYear();if(maxRestDateYear<10){maxRestDateYear=2000+maxRestDateYear;}else{if(maxRestDateYear<100){maxRestDateYear=1900+maxRestDateYear;}}if((Year>maxRestDateYear)||((Month>(maxRestDate.getMonth()))&&(Year==maxRestDateYear))||((day>maxRestDate.getDate())&&(Month==(maxRestDate.getMonth()))&&(Year==maxRestDateYear))){isDayActive=false;}}if(minRestDate){var minRestDateYear=minRestDate.getFullYear();if(minRestDateYear<10){minRestDateYear=2000+minRestDateYear;}else{if(minRestDateYear<100){minRestDateYear=1900+minRestDateYear;}}if((Year<minRestDateYear)||((Month<(minRestDate.getMonth()))&&(Year==minRestDateYear))||((day<minRestDate.getDate())&&(Month==(minRestDate.getMonth()))&&(Year==minRestDateYear))){isDayActive=false;}}return isDayActive;}function renderWeekBar(firstDayOfWeek,weekDays,firstDayIndex){var firstDay=firstDayIndex+(firstDayOfWeek-1);var weekBar="";var countDays;for(countDays=1;countDays<8;countDays++){if(firstDay>=(firstDayIndex+7)){firstDay=firstDayIndex;}weekBar=weekBar+'<td class="weekday">'+weekDays[firstDay]+"</td>";firstDay++;}return weekBar;}function fillTextBox(myDate,myTextBoxID){var sDateString=sDateFormat;if(sDateFormat.search("YYYY")==-1){Year=Year%100;if(Year<10){Year="0"+Year;}sDateString=sDateString.replace("YY",Year);}else{sDateString=sDateString.replace("YYYY",Year);}if(sDateFormat.search("DD")==-1){sDateString=sDateString.replace("D",myDate);}else{if(myDate>=10){sDateString=sDateString.replace("DD",myDate);}else{sDateString=sDateString.replace("DD","0"+myDate);}}if(sDateFormat.search("MMM")>0){sDateString=sDateString.replace("MMM",Month_Names[Month-1]);}else{if(sDateFormat.search("MM")==-1){sDateString=sDateString.replace("M",Month);}else{if(Month>=10){sDateString=sDateString.replace("MM",Month);}else{sDateString=sDateString.replace("MM","0"+Month);}}}textBoxID=getObj(myTextBoxID);fillTextBoxOnOpt(textBoxID,sDateString);if(textBoxID){if(textBoxID.onchange){textBoxID.onchange();}else{if(textBoxID.onkeyup){textBoxID.onkeyup();}}}hideCalendar();}function updateDateFormat(sNewDateFormat){if(sDateFormat&&sNewDateFormat&&(sNewDateFormat.length>0)){sDateFormat=sNewDateFormat;}}function fillTextBoxOnOpt(textBox,sDateString){if(sOperator&&(sOperator.length>0)){var opValues=sOperator.split(ITEM_SEPARATOR);if(opValues[0]){sOperator=opValues[0];}}if(((sOperator==null)&&(textBox.value.search(";")>0))||(sOperator=="17")||(sOperator=="44")||(sOperator=="22")||(sOperator=="57")){if(textBox.value.length<1){textBox.value=sDateString;}else{if((sOperator=="17")||(sOperator=="44")){if(textBox.value.search(";")<1){textBox.value=textBox.value+";"+sDateString;}else{if(textBox.value.search(";")==(textBox.value.length-1)){textBox.value=textBox.value+sDateString;}else{if(textBox.value.search("isDyn")>=0){textBox.value=textBox.value.substr(0,textBox.value.search(";")+1)+sDateString;}else{textBox.value=sDateString+textBox.value.substr(textBox.value.search(";"),textBox.value.length);}}}}else{if(textBox.value.search(";")==(textBox.value.length-1)){textBox.value=textBox.value+sDateString;}else{textBox.value=textBox.value+";"+sDateString;}}}}else{textBox.value=sDateString;}}function showCalendarButton(buttonName){document.getElementById(buttonName).style.visibility="visible";}function hideCalendar(){var CT=document.getElementById("CalendarTable");if(CT){CT.style.visibility="hidden";}var c=document.getElementById("Calendar");if(c){c.style.visibility="hidden";}showHidePulldowns(true,20,20);bIsSeen=false;if(calendarOldMouseDownHandler){document.onmousedown=calendarOldMouseDownHandler;}}function getMonth(myTextBoxID){var textBox=getObj(myTextBoxID);var dateString=textBox.value;if(dateString.search(";")!=-1){dateString=dateString.substr(0,dateString.search(";"));}return getDateFromFormat(dateString,sDateFormat,DATE_MONTH);}function getYear(myTextBoxID){var textBox=getObj(myTextBoxID);var dateString=textBox.value;if(dateString.search(";")!=-1){dateString=dateString.substr(0,dateString.search(";"));}return getDateFromFormat(dateString,sDateFormat,DATE_YEAR);}function showOrHideCalendarButton(mySelectForm,myButton){var oRadio=null;var data_type=null;var calButton=getObj(myButton);var oSelect=getObj(mySelectForm);if(calButton&&oSelect){var indexSelected=-1;if(oSelect.options){if(bIsW3C){for(count=0;count<oSelect.options.length;count++){if(oSelect.options[count].selected){indexSelected=count;break;}}}else{indexSelected=oSelect.selectedIndex;}}else{if(oSelect[0]){for(count=0;count<oSelect.length;count++){if(oSelect[count].checked){indexSelected=count;break;}}}}if(indexSelected>=0){if(oSelect.options){data_type=oSelect.options[indexSelected].getAttribute("DATATYPE");}else{data_type=oSelect[indexSelected].getAttribute("DATATYPE");}}else{if(oSelect.getAttribute("DATATYPE")){data_type=oSelect.getAttribute("DATATYPE");}else{if(oSelect.options){if(oSelect.options[0]){data_type=oSelect.options[0].getAttribute("DATATYPE");}}else{if(oSelect[0]){data_type=oSelect[0].getAttribute("DATATYPE");}}}}if((parseInt(data_type)==16)||(parseInt(data_type)==15)||(parseInt(data_type)==14)){calButton.style.visibility="visible";calButton.style.display="inline";}else{calButton.style.visibility="hidden";calButton.style.display="none";}}}function updateOperator(mySelectForm){var oSelect=getObj(mySelectForm);if(oSelect){sOperator=oSelect.options[oSelect.selectedIndex].value;}}function showHidePulldowns(bShow,lX,lY){var calendarObj=getObj("Calendar");if(calendarObj!=null){togglePulldowns(calendarObj,bShow);}}function getIntValue(str,i,minlength,maxlength){for(var x=maxlength;x>=minlength;x--){var token=str.substring(i,i+x);if(isAllNumeric(token)){return token;}else{if(!isNaN(parseInt(token))){return retVal=parseInt(token)+"";}}}return null;}function isAllNumeric(num){var val=new String(num);var regex=/[^0-9]/;return !regex.test(val);}function getMonthIntVal(sMonthName){for(var i=0;i<Month_Names.length;i++){if(sMonthName.toLowerCase()==Month_Names[i].toLowerCase()){return i+1;}}return 0;}var DATE_MONTH=1;var DATE_DAY=2;var DATE_YEAR=3;function getDateFromFormat(val,format,type){val=val+"";format=format+"";var i_val=0;var i_format=0;var c="";var token="";var x,y;var now=new Date();var year=now.getYear();var month=now.getMonth()+1;var day=1;if((val!=null)&&(val.length>5)){while(i_format<format.length){c=format.charAt(i_format);token="";while((format.charAt(i_format)==c)&&(i_format<format.length)){token+=format.charAt(i_format++);}if((token=="YYYY")||(token=="YY")||(token=="Y")){if(token=="YYYY"){x=4;y=4;}else{if(token=="YY"){x=2;y=2;}else{if(token=="Y"){x=2;y=4;}}}year=getIntValue(val,i_val,x,y);if(year==null||year.length<x||year.length>y){return 0;}i_val+=year.length;}else{if((token=="MM")||(token=="M")){month=getIntValue(val,i_val,token.length,2);if((month==null)||(month<1)||(month>12)){return 0;}i_val+=month.length;}else{if(token=="MMM"){month=getMonthIntVal(val.substring(i_val,i_val+token.length));i_val+=token.length;}else{if((token=="DD")||(token=="D")){day=getIntValue(val,i_val,token.length,2);if((day==null)||(day<1)||(day>31)){return 0;}i_val+=day.length;}else{if(val.substring(i_val,i_val+token.length)!=token){return 0;}else{i_val+=token.length;}}}}}}if(i_val<val.length){return 0;}}else{return 0;}switch(type){case DATE_YEAR:return year*1;break;case DATE_MONTH:return month*1;break;case DATE_DAY:return day*1;break;}}