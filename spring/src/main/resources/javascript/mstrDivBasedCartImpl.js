mstrDivBasedCartImplScript=true;mstrDivBasedCartImpl.prototype.cartElements=null;mstrDivBasedCartImpl.prototype=new mstrBoneImpl();mstrDivBasedCartImpl.prototype.selections=null;mstrDivBasedCartImpl.prototype.currentAvailable=null;mstrDivBasedCartImpl.prototype.selectionSep="|~";mstrDivBasedCartImpl.prototype.DIV_PERSONAL_DIRECTORY="PersonalDirectory";mstrDivBasedCartImpl.prototype.DIV_SHARED_DIRECTORY="SharedDirectory";mstrDivBasedCartImpl.prototype.DISPLAY_MODE_SHARED_DIRECTORY=0;mstrDivBasedCartImpl.prototype.DISPLAY_MODE_PERSONAL_DIRECTORY=1;mstrDivBasedCartImpl.prototype.displayMode=mstrDivBasedCartImpl.prototype.DISPLAY_MODE_SHARED_DIRECTORY;mstrDivBasedCartImpl.RMV_BTN_ID_TAIL=["To","Cc","Bcc"];mstrDivBasedCartImpl.prototype.onload=function(){try{mstrBoneImpl.prototype.onload.call(this);this.cartElements=microstrategy.findChildrenWithAtt(this.elem,"div","isCartElement","1");if(this.cartElements){for(var i=0;i<this.cartElements.length;i++){this.cartElements[i].onmousedown=new Function("e","return microstrategy.bone('"+this.id+"').onmousedown(e);");this.cartElements[i].ondblclick=new Function("e","return false;");this.cartElements[i].onselectstart=new Function("e","return false;");}}delete this.selections;this.selections=new Object();var availDivs=this.getAvailableListArray();var selectionDivs=this.getSelectedListArray();for(var i=0;i<availDivs.length;i++){this.selections[availDivs[i].getAttribute("id")]=new mstrDivCartSelectionsImpl();this.selections[availDivs[i].getAttribute("id")].parentBone=this;this.selections[availDivs[i].getAttribute("id")].path="microstrategy.bone('"+this.id+"').selections";}if(this.defaultAvailable){this.currentAvailable=microstrategy.findChildWithAtt(this.elem,"div","id",this.defaultAvailable);}if(this.currentAvailable==null&&availDivs.length==1){this.currentAvailable=availDivs[0];}for(var i=0;i<selectionDivs.length;i++){this.selections[selectionDivs[i].getAttribute("id")]=new mstrDivCartSelectionsImpl();this.selections[selectionDivs[i].getAttribute("id")].parentBone=this;this.selections[selectionDivs[i].getAttribute("id")].path="microstrategy.bone('"+this.id+"').selections";this.handleIdSuffix(selectionDivs[i],true);}if(this.enabledRemoveBtnClass){this.disabledRemoveBtnClass=this.enabledRemoveBtnClass+"Disabled";}if(this.selectedSectionIdBase){for(var i=0;i<mstrDivBasedCartImpl.RMV_BTN_ID_TAIL.length;i++){var selectedSection=document.getElementById(this.selectedSectionIdBase+mstrDivBasedCartImpl.RMV_BTN_ID_TAIL[i]);if(selectedSection){this.updateRemoveBtn(selectedSection,i);}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrDivBasedCartImpl.prototype.handleIdSuffix=function(oList,toAppend){var cartElementsList=microstrategy.findChildrenWithAtt(oList,"div","isCartElement","1");var SUFFIX_SEP="_";var i,j,curDiv;if(cartElementsList){if(toAppend){for(i=1;i<cartElementsList.length;i++){curDiv=cartElementsList[i];var curId=curDiv.getAttribute("id");for(j=i-1;j>=0;j--){if(curId==cartElementsList[j].getAttribute("id")){var nsfx=(oList.idSuffix||0)+1;curDiv.setAttribute("id",curId+SUFFIX_SEP+nsfx);oList.idSuffix=nsfx;break;}}}}else{for(i=0;i<cartElementsList.length;i++){curDiv=cartElementsList[i];var oid=curDiv.getAttribute("id")||"";var sfxidx=oid.lastIndexOf(SUFFIX_SEP);if(sfxidx>=0){curDiv.setAttribute("id",oid.substr(0,sfxidx));}}}}};mstrDivBasedCartImpl.prototype.getAvailableListArray=function(){try{return microstrategy.findChildrenWithAtt(this.elem,"div",microstrategy.HTMLATTR_OBJTYPE,"1");}catch(err){microstrategy.errors.log(err);return null;}return null;};mstrDivBasedCartImpl.prototype.getSelectedListArray=function(){try{return microstrategy.findChildrenWithAtt(this.elem,"div",microstrategy.HTMLATTR_OBJTYPE,"2");}catch(err){microstrategy.errors.log(err);return null;}return null;};mstrDivBasedCartImpl.prototype.onmousedown=function(e){try{if(!e){e=window.event;}var obj=getEventTarget(e);if(obj){if(obj.tagName.toLowerCase()=="div"){var parentDiv=microstrategy.findAncestorWithAtt(obj,microstrategy.HTMLATTR_OBJTYPE,"1");if(!parentDiv){parentDiv=microstrategy.findAncestorWithAtt(obj,microstrategy.HTMLATTR_OBJTYPE,"2");}if(parentDiv){if(this.selections[parentDiv.getAttribute("id")]){var selections=this.selections[parentDiv.getAttribute("id")];if(selections.isSelected(obj)&&e.ctrlKey){selections.remove(obj);}else{if(!e.ctrlKey){selections.clear();}selections.add(obj);}if(selections.onmousedown){return selections.onmousedown(e);}}}}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDivBasedCartImpl.prototype.setCurrentAvailableFromSelect=function(availableSelect,sAvailableFromDivs,searchDivId){var availableDivs=sAvailableFromDivs.split(",");var availableDiv;for(var i=0;i<availableDivs.length;i++){availableDiv=getObj(availableDivs[i]);availableDiv.style.display="none";}var selectedDirectoryID=availableSelect.options[availableSelect.selectedIndex].value;this.displayMode=selectedDirectoryID==this.DIV_SHARED_DIRECTORY?this.DISPLAY_MODE_SHARED_DIRECTORY:this.DISPLAY_MODE_PERSONAL_DIRECTORY;var oSelectedDirectory=getObj(selectedDirectoryID);oSelectedDirectory.style.display="";var searchDiv=document.getElementById(searchDivId);if(searchDiv){if(selectedDirectoryID==this.DIV_SHARED_DIRECTORY){searchDiv.style.visibility="visible";}else{if(selectedDirectoryID==this.DIV_PERSONAL_DIRECTORY){searchDiv.style.visibility="hidden";}}}var incFetchDiv=document.getElementById(this.incrementalFetchId);if(selectedDirectoryID==this.DIV_SHARED_DIRECTORY){incFetchDiv.style.visibility="visible";}else{if(selectedDirectoryID==this.DIV_PERSONAL_DIRECTORY){incFetchDiv.style.visibility="hidden";}}this.currentAvailable=oSelectedDirectory;if(this.currentAvailable.getAttribute(microstrategy.HTMLATTR_OBJTYPE)!="1"){this.currentAvailable=microstrategy.findChildrenWithAtt(this.currentAvailable,"div",microstrategy.HTMLATTR_OBJTYPE,"1")[0];}};mstrDivBasedCartImpl.prototype.getDisplayMode=function(){return this.displayMode;};mstrDivBasedCartImpl.prototype.remove=function(sList,sectionType){var i;var j;var lLength;var oOption;var bSomethingSelected;bSomethingSelected=false;var oList=microstrategy.findChildWithAtt(this.elem,"div","id",sList);var oListSelections=this.selections[sList];var nextItem;if(oListSelections){var oListSelection;if(oListSelections.length>0){nextItem=oListSelections.getItems()[oListSelections.length-1].nextSibling;}for(i=0;i<oListSelections.length;i++){oListSelection=oListSelections.getItems()[i];var unitInSelection=microstrategy.findChildWithAtt(oList,"div","id",oListSelection.getAttribute("id"));if(unitInSelection){oList.removeChild(unitInSelection);}}this.updateRemoveBtn(oList,sectionType);oListSelections.clear();this.addToSelectedList(oListSelections,nextItem);}};mstrDivBasedCartImpl.prototype.updateRemoveBtn=function(selectedList,sectionType){var removeBtn=document.getElementById(this.removeBtnIdBase+mstrDivBasedCartImpl.RMV_BTN_ID_TAIL[sectionType]);var selectedArray=microstrategy.findChildrenWithAtt(selectedList,"div","isCartElement","1");if(removeBtn&&selectedList){var imgs=removeBtn.getElementsByTagName("img");if(imgs.length==1){imgs[0].className=selectedArray&&selectedArray.length==0?this.disabledRemoveBtnClass:this.enabledRemoveBtnClass;removeBtn.onclick=selectedArray&&selectedArray.length==0?"":new Function("e","return microstrategy.bone('"+this.id+"').remove('"+selectedList.id+"','"+sectionType+"');");}}};function IsOptionInList(oList,sElement){var cartElementsList=microstrategy.findChildrenWithAtt(oList,"div","isCartElement","1");var i;if(cartElementsList){for(i=0;i<cartElementsList.length;i++){if(cartElementsList[i].getAttribute("id")==sElement.getAttribute("id")){return true;}}}return false;}mstrDivBasedCartImpl.prototype.add=function(sToList,sectionType){if(this.currentAvailable){var i;var lLength;var oDiv;var aPreSelected=new Array();var bSomethingSelected;bSomethingSelected=false;var oToList=microstrategy.findChildWithAtt(this.elem,"div","id",sToList);var oFromListSelections=this.selections[this.currentAvailable.getAttribute("id")];var oToSelections=this.selections[sToList];var nextItem;oToSelections.clear();if(oFromListSelections){if(oFromListSelections.length>0){nextItem=oFromListSelections.getItems()[oFromListSelections.length-1].nextSibling;}for(i=0;i<oFromListSelections.length;i++){var inList=IsOptionInList(oToList,oFromListSelections.getItems()[i]);if(inList==false||this.allowMultipleAdd==true){oDiv=oFromListSelections.getItems()[i].cloneNode(true);oDiv.onmousedown=new Function("e","return microstrategy.bone('"+this.id+"').onmousedown(e);");oToList.appendChild(oDiv);oToSelections.addImpl(oDiv);if(inList){this.handleIdSuffix(oToList,true);}}}this.updateRemoveBtn(oToList,sectionType);oFromListSelections.clear();this.addToSelectedList(oFromListSelections,nextItem);}}};mstrDivBasedCartImpl.prototype.addToSelectedList=function(selectedList,obj){if(obj){if(selectedList){selectedList.add(obj);}}};mstrDivBasedCartImpl.prototype.getElementsFromList=function(list){try{var selection="";if(list){this.handleIdSuffix(list,false);var elements=microstrategy.findChildrenWithAtt(list,"div","isCartElement","1");if(elements&&elements.length>0){for(var i=0;i<elements.length;i++){var element=elements[i];if(selection.length>0){selection+=this.selectionSep;}selection+=element.getAttribute("id");var elementName="";for(var j=0,len=element.childNodes.length;j<len;j++){if(element.childNodes[j].nodeType==3){elementName=element.childNodes[j].data;break;}}selection+=this.selectionSep+encodeURI(elementName);}}}return selection;}catch(err){microstrategy.errors.log(err);return false;}};function mstrDivBasedCartImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;return this;}mstrDivCartSelectionsImpl.prototype=new mstrSelectionsImpl();mstrDivCartSelectionsImpl.prototype.updateManager=microstrategy.updateManager;mstrDivCartSelectionsImpl.prototype.selectedClass="selected";mstrDivCartSelectionsImpl.prototype.add=function(obj){try{mstrSelectionsImpl.prototype.add.call(this,obj);var oldClassName=obj.className;if(typeof (oldClassName)=="undefined"){oldClassName="";}obj.className=this.selectedClass+oldClassName;}catch(err){microstrategy.errors.log(err);}return false;};mstrDivCartSelectionsImpl.prototype.addImpl=function(obj){try{mstrSelectionsImpl.prototype.add.call(this,obj);}catch(err){microstrategy.errors.log(err);}return false;};mstrDivCartSelectionsImpl.prototype.resetClassName=function(obj){try{var newClass="";if(obj){var oldClassName=obj.className;if((oldClassName.length>0)&&(oldClassName.indexOf(this.selectedClass)==0)){newClass=oldClassName.substr(this.selectedClass.length);}obj.className=newClass;}}catch(err){microstrategy.errors.log(err);}return true;};mstrDivCartSelectionsImpl.prototype.remove=function(obj){try{mstrSelectionsImpl.prototype.remove.call(this,obj);this.resetClassName(obj);}catch(err){microstrategy.errors.log(err);}return false;};mstrDivCartSelectionsImpl.prototype.clear=function(){try{for(var id in this.items){this.resetClassName(this.items[id]);}mstrSelectionsImpl.prototype.clear.call(this);}catch(err){microstrategy.errors.log(err);}return false;};function mstrDivCartSelectionsImpl(){this.inherits=mstrSelectionsImpl;this.inherits();delete this.inherits;return this;}