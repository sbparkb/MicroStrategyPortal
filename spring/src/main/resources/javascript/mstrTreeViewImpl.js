mstrTreeViewImplScript=true;mstrTreeViewImpl.prototype=new mstrBoneImpl();mstrTreeViewImpl.prototype.NODE_STATE_CLOSED=0;mstrTreeViewImpl.prototype.NODE_STATE_OPEN=1;mstrTreeViewImpl.prototype.NODE_STATE_LEAF=2;mstrTreeViewImpl.prototype.CSS_CLASS_OPEN="open";mstrTreeViewImpl.prototype.CSS_CLASS_CLOSED="";mstrTreeViewImpl.prototype.CSS_CLASS_LEAF="leaf";mstrTreeViewImpl.prototype.CSS_TREE_WAIT="mstrTreeWait";mstrTreeViewImpl.prototype.DIV_TREE_WAIT_ID="divTreeWait";mstrTreeViewImpl.prototype.treeName;mstrTreeViewImpl.prototype.TREE_TARGET="frameManager";mstrTreeViewImpl.prototype.TREE_ACTION;mstrTreeViewImpl.prototype.treeProcessing=false;mstrTreeViewImpl.prototype.currentlySelectedNode;mstrTreeViewImpl.prototype.lastSelectedNodeImgStyle;mstrTreeViewImpl.prototype.anchorTarget;mstrTreeViewImpl.prototype.currentContextMenuNode=null;mstrTreeViewImpl.prototype.defaultShouldProcessNode=false;mstrTreeViewImpl.prototype.onload=function(){try{this.initTree();}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.initTree=function(){try{this.initBone();this.treeDiv=document.getElementById(this.treeName);if(this.treeDiv){this.treeDiv.onclick=new Function("e","microstrategy.bone('"+this.id+"').onClickTree(e); return false;");this.treeDiv.ondblclick=new Function("e","microstrategy.bone('"+this.id+"').onDblClickTree(e); return false;");this.treeDiv.oncontextmenu=new Function("e","microstrategy.bone('"+this.id+"').onContextMenu(e); return false;");}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.onreload=function(){try{mstrBoneImpl.prototype.onreload.call(this);var waitDiv=getObj(this.DIV_TREE_WAIT_ID);if(waitDiv&&!waitDiv.hasChildNodes()){this.removeTreeWaitMessage();}this.treeProcessing=false;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_findTargetTag=function(oTarget,sTagName){try{while(oTarget.parentNode){if(oTarget.tagName==sTagName){return oTarget;}oTarget=oTarget.parentNode;}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_getChildNode=function(oTarget,sTagName){try{if((oTarget)&&(oTarget.childNodes.length)){for(var i=0;i<oTarget.childNodes.length;i++){var oChildNode=oTarget.childNodes[i];if(oChildNode.tagName==sTagName){return oChildNode;}oChildNode=this.util_getChildNode(oChildNode,sTagName);if(oChildNode!=null){return oChildNode;}}}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_getNodeState=function(oTarget){try{switch(oTarget.className){case (this.CSS_CLASS_OPEN):return(this.NODE_STATE_OPEN);case (this.CSS_CLASS_LEAF):return(this.NODE_STATE_LEAF);}return(this.NODE_STATE_CLOSED);}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.allowDisabledNodeClick=function(e){return true;};mstrTreeViewImpl.prototype.noAction=function(e){return false;};mstrTreeViewImpl.prototype.onDblClickTree=function(e){try{if(!e){e=window.event;}if(this.treeProcessing){e.returnValue=false;return ;}var oTarget=getEventTarget(e);var shouldProcessNode=false;if(!this.allowDisabledNodeClick(e)){return false;}if(oTarget.tagName=="A"||oTarget.tagName=="SPAN"){oTarget=this.util_findTreeNode(oTarget);if(oTarget.getAttribute("did")!="none"){this.util_unselectNodes(oTarget,this.elem);this.util_markNodeAsSelected(oTarget);shouldProcessNode=!this.noAction(e);}}if(shouldProcessNode){this.util_processNode(oTarget,this);}var parentBone=microstrategy.findBone(this.elem.parentNode);if(parentBone&&parentBone.onDblClickTree){parentBone.onDblClickTree(e);}e.returnValue=false;return ;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.onClickTree=function(e){try{if(!e){e=window.event;}if(this.treeProcessing){e.returnValue=false;return ;}var oTarget=getEventTarget(e);if(!oTarget){return ;}if(!this.allowDisabledNodeClick(e)){return false;}var shouldProcessNode=this.defaultShouldProcessNode;this.hideTreeWaitMessage();if(oTarget.tagName=="LI"){shouldProcessNode=!this.noAction(e);}else{if(bIsIE6&&oTarget.parentNode&&oTarget.parentNode.tagName=="LI"){oTarget=oTarget.parentNode;shouldProcessNode=!this.noAction(e);}else{if(oTarget.tagName=="A"||oTarget.tagName=="SPAN"){oTarget=this.util_findTreeNode(oTarget);if(oTarget.getAttribute("did")=="incrementalFetch"){shouldProcessNode=true;}else{if(oTarget.getAttribute("did")!="none"){if(this.needDetectCtrlKey()&&e.ctrlKey){if(oTarget.getAttribute("sel")=="1"){if(e.button==0){this.util_markNodeAsUnselected(oTarget);}}else{if(e.button==0){this.util_checkSelectedNodes(oTarget,this.elem);this.util_markNodeAsSelected(oTarget,true);}}}else{if(this.util_getNodeState(oTarget)==this.NODE_STATE_LEAF||oTarget.getAttribute("sel")=="1"||e.shouldExpand){shouldProcessNode=!this.noAction(e);}if(e.button==0||(e.button==2&&oTarget.getAttribute("sel")!="1")){this.util_unselectNodes(oTarget,this.elem);this.util_markNodeAsSelected(oTarget);}}}}}}}if(shouldProcessNode){e.returnValue=this.util_processNode(oTarget,this.elem);}else{e.returnValue=false;}return ;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.onContextMenu=function(e){try{if(!e){e=window.event;}var oTarget=getEventTarget(e);if(oTarget.tagName.toLowerCase()=="a"||oTarget.tagName.toLowerCase()=="span"){oTarget=findTargetTag(oTarget,"li");}if(!oTarget){return ;}if(oTarget.tagName.toLowerCase()=="li"){this.currentContextMenuNode=oTarget;}else{this.currentContextMenuNode=null;}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.needDetectCtrlKey=function(){return true;};mstrTreeViewImpl.prototype.util_processNode=function(oTarget,oTree){try{var oDIV=this.util_findTargetTag(oTarget,"DIV");if(!oDIV){return true;}if(oTarget.getAttribute("did")=="incrementalFetch"){var oUL=oDIV.parentNode;var oParentNode;var oAnchor=this.util_getAnchor(oTarget);this.util_preProcessAnchor(oTarget,oAnchor);if(oUL.parentNode==oTree){oParentNode=oUL;while(oUL.childNodes.length){oUL.removeChild(oUL.firstChild);}}else{oParentNode=oUL.previousSibling;oTree.scrollTop=oParentNode.offsetTop;oUL.parentNode.removeChild(oUL);}var preHref=oAnchor.href;oAnchor.href=preHref;this.showTreeWaitMessage(oParentNode,"afterEnd");if(oAnchor){this.util_submitForm(oAnchor);}}else{var iState=this.util_getNodeState(oTarget);switch(iState){case (this.NODE_STATE_LEAF):var oAnchor=this.util_getAnchor(oTarget);this.util_preProcessAnchor(oTarget,oAnchor);if(oTarget.getAttribute("isLink")){this.util_submitForm(oAnchor);}if(oAnchor.getAttribute("dum")){return false;}else{return true;}break;case (this.NODE_STATE_OPEN):this.util_setTreeTargetState(oDIV,this.NODE_STATE_CLOSED);break;case (this.NODE_STATE_CLOSED):if(this.util_firstNextULSibling(oDIV)){this.util_setTreeTargetState(oDIV,this.NODE_STATE_OPEN);}else{this.showTreeWaitMessage(oDIV,"afterEnd");this.util_setTreeTargetState(oDIV,this.NODE_STATE_OPEN);var oAnchor=this.util_getAnchor(oTarget);if(oAnchor){this.util_preProcessAnchor(oTarget,oAnchor);this.util_submitForm(oAnchor);}}break;}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_preProcessAnchor=function(oTarget,oAnchor){if(oTarget.getAttribute("isLink")){var attr_href=oAnchor.getAttribute("href");oAnchor.setAttribute("href",attr_href+"&isLink=true");if(this.anchorTarget&&this.anchorTarget!=""){oAnchor.target=this.anchorTarget;}}};mstrTreeViewImpl.prototype.util_submitForm=function(oTarget){try{var attr_href=oTarget.getAttribute("href");var oForm=this.util_getNewTreeForm(attr_href);var oldTarget=oForm.target;if(oTarget.target){oForm.target=oTarget.target;}submitForm(oForm);oForm.target=oldTarget;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_getNewTreeForm=function(url){try{url=url+"&isTreeRequest=true";var oForm=createDynamicForm(url);if(url.contains("iframe=true")){oForm.target=this.TREE_TARGET;}if(this.TREE_ACTION){oForm.action=this.TREE_ACTION;}return oForm;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_markNodeAsSelected=function(oTarget,bDoNotClean){try{if(this.currentlySelectedNode&&!bDoNotClean){this.util_markNodeAsUnselected(this.currentlySelectedNode);}this.currentlySelectedNode=oTarget;var selected=oTarget.getAttribute("sel");if(selected=="1"){return ;}oTarget.setAttribute("sel","1");var oAnchor=this.util_getAnchor(oTarget);if(oAnchor){oAnchor.className="marked";var span=oAnchor.previousSibling;if(span&&span.tagName.toLowerCase()=="span"){this.lastSelectedNodeImgStyle=span.className;if(this.lastSelectedNodeImgStyle.toLowerCase()=="f"){span.className=this.lastSelectedNodeImgStyle+"_open";}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_markNodeAsUnselected=function(oTarget){try{var selected=oTarget.getAttribute("sel");if(selected=="0"){return ;}oTarget.setAttribute("sel","0");var oAnchor=this.util_getAnchor(oTarget);if(oAnchor){oAnchor.className="";var span=oAnchor.previousSibling;if(span&&span.tagName.toLowerCase()=="span"&&this.lastSelectedNodeImgStyle){if(this.lastSelectedNodeImgStyle.toLowerCase()=="f"){span.className=this.lastSelectedNodeImgStyle;}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_unselectNodes=function(oTarget,oTree){try{var oLIs=oTree.getElementsByTagName("LI");if((oLIs)&&(oLIs.length)){for(var i=0;i<oLIs.length;i++){if(oLIs[i].getAttribute("sel")=="1"){this.util_markNodeAsUnselected(oLIs[i]);}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_getAnchor=function(oTarget){try{var oAnchor;if(oTarget.tagName.toLowerCase()=="a"){return oTarget;}if(oTarget.tagName=="LI"){oAnchor=this.util_getChildNode(oTarget.childNodes[0],"A");}else{oAnchor=this.util_getChildNode(oTarget,"A");}return oAnchor;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_checkSelectedNodes=function(oTarget,oTree){try{var multi=oTarget.getAttribute("multi");if(!multi){this.util_unselectNodes(oTarget,oTree);}else{var did=oTarget.getAttribute("did");var oLIs=oTree.getElementsByTagName("LI");if((oLIs)&&(oLIs.length)){for(var i=0;i<oLIs.length;i++){var treeNode=oLIs[i];if((treeNode.getAttribute("did")!=did)&&(treeNode.getAttribute("sel")=="1")){var multi=treeNode.getAttribute("multi");if(!multi){this.util_markNodeAsUnselected(treeNode);}}}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.util_setTreeTargetState=function(oTarget,iState){try{if(!oTarget){return ;}if(iState==this.NODE_STATE_LEAF){if(oTarget.childNodes[0].tagName){oTarget.childNodes[0].className=this.CSS_CLASS_LEAF;}return ;}if(this.util_firstLIChild(oTarget)&&this.util_firstLIChild(oTarget).className!=this.CSS_CLASS_LEAF){this.util_firstLIChild(oTarget).className=(iState==this.NODE_STATE_OPEN)?this.CSS_CLASS_OPEN:this.CSS_CLASS_CLOSED;if(this.util_firstNextULSibling(oTarget)){if(iState!=this.NODE_STATE_OPEN){this.util_firstNextULSibling(oTarget).style.display="none";}else{this.util_firstNextULSibling(oTarget).style.display="block";}}}return ;}catch(err){microstrategy.errors.log(err);return null;}};mstrTreeViewImpl.prototype.util_firstNextULSibling=function(oTarget){try{var targetObject=oTarget;while(targetObject.nextSibling){if(targetObject.nextSibling.tagName=="UL"){return targetObject.nextSibling;}if(targetObject.nextSibling.tagName=="DIV"){return null;}targetObject=targetObject.nextSibling;}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrTreeViewImpl.prototype.util_firstLIChild=function(oTarget){try{var targetObject;if(oTarget.childNodes[0]){targetObject=oTarget.childNodes[0];}while(targetObject){if(targetObject.tagName=="LI"){return targetObject;}targetObject=targetObject.nextSibling;}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrTreeViewImpl.prototype.util_findTreeNode=function(oTarget){try{if(!oTarget){return null;}if(oTarget.tagName=="LI"){return oTarget;}else{if(oTarget.tagName=="A"||oTarget.tagName=="SPAN"){return this.util_findTreeNode(oTarget.parentNode);}}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrTreeViewImpl.prototype.showTreeWaitMessage=function(oTarget,location){try{if(!oTarget){return ;}this.treeProcessing=true;div=document.createElement("DIV");div.setAttribute("IFRAME","true");div.id=this.DIV_TREE_WAIT_ID;div.className=this.CSS_TREE_WAIT;div.noWrap=true;if((typeof (aDescriptor)!="undefined")&&(aDescriptor[38]!=null)){div.innerHTML=aDescriptor[38];}else{div.innerHTML=microstrategy.descriptors.getDescriptor("5674");}oTarget.insertAdjacentElement(location,div);if(microstrategy.eventManager){microstrategy.eventManager.ondialogresize();microstrategy.eventManager.onforcerepaint();}return ;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.onforcerepaint=function(){try{var parent=microstrategy.findAncestor(this.elem);if(parent&&parent.parentNode){var i=document.createElement("img");parent.appendChild(i);i.parentNode.removeChild(i);}}catch(err){microstrategy.errors.log(err);}};mstrTreeViewImpl.prototype.hideTreeWaitMessage=function(){try{var div=getObj(this.DIV_TREE_WAIT_ID);if(div){if(div.previousSibling){div.previousSibling.insertAdjacentElement("afterEnd",div.childNodes[0]);}else{div.parentNode.appendChild(div.childNodes[0]);}div.parentNode.removeChild(div);}return ;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.removeTreeWaitMessage=function(){try{var div=getObj(this.DIV_TREE_WAIT_ID);if(div){this.treeProcessing=false;oTarget=div.previousSibling;if((oTarget!=null)&&(oTarget.firstChild!=null)){this.util_setTreeTargetState(oTarget,this.NODE_STATE_LEAF);}div.parentNode.removeChild(div);}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.isNodeAncestorOfCurrentlySelected=function(oTarget){try{if(this.currentlySelectedNode){var node=this.currentlySelectedNode;var childNode=this.util_getChildNode(oTarget,node.tagName);if(childNode==node){return false;}while(node&&node.innerHTML&&node!=oTarget){if(node.tagName.toLowerCase()=="a"||node.tagName.toLowerCase()=="span"){node=node.parentNode.parentNode;}else{if(node.tagName.toLowerCase()=="li"){node=node.parentNode;}}if(node.tagName.toLowerCase()=="div"){if(node==oTarget){return true;}else{node=node.parentNode;}}if(node.tagName.toLowerCase()=="ul"){var siblingDiv=node.previousSibling;if(siblingDiv==oTarget){return true;}}node=node.parentNode;}}else{return false;}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeViewImpl.prototype.findParentTreeNode=function(oTarget){try{if(!oTarget){return ;}var oDiv=oTarget.parentNode;var oUL=oDiv.parentNode;var oParentDiv=oUL.previousSibling;while(oParentDiv&&oParentDiv.nodeType==microstrategy.HTML_TEXT_NODE_TYPE){oParentDiv=oParentDiv.previousSibling;}if(oParentDiv&&oParentDiv.tagName=="DIV"){var oParentNode=oParentDiv.firstChild;if(oParentNode&&oParentNode.tagName=="LI"){return oParentNode;}else{return null;}}else{return null;}}catch(err){microstrategy.errors.log(err);return false;}};function mstrTreeViewImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;return this;}