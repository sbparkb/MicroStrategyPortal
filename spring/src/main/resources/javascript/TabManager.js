mstrFormatImplScript=true;mstrFormatImpl.prototype=new mstrEditorImpl();mstrFormatImpl.prototype.childrenTabs=new Array();mstrFormatImpl.prototype.changesApplied=0;mstrFormatImpl.prototype.currentTab=1;mstrFormatImpl.prototype.actionId=microstrategy.OPEN_EDITOR_ACTION_EDIT;mstrFormatImpl.prototype.selectedTabOptions="";mstrFormatImpl.prototype.autoSubmitJS=null;mstrFormatImpl.prototype.sharedObj=null;mstrFormatImpl.prototype.useDynamicTitle=false;mstrFormatImpl.prototype.titleContainer=null;mstrFormatImpl.prototype.targetAxis=null;mstrFormatImpl.prototype.targetLevel=null;mstrFormatImpl.prototype.targetUnit=null;mstrFormatImpl.prototype.targetPosition=null;mstrFormatImpl.prototype.submitUponTargetLevelChange=true;mstrFormatImpl.prototype.axisOptionId=null;mstrFormatImpl.prototype.levelOptionId=null;mstrFormatImpl.prototype.targetOptions=null;mstrFormatImpl.prototype.levelOptions=null;mstrFormatImpl.prototype.commands=null;mstrFormatImpl.prototype.helpButton=null;mstrFormatImpl.prototype.defaultHelpURL=null;mstrFormatImpl.panelStackOptionsMapDescriptors=[["4579","3297"],["512"]];mstrFormatImpl.gridContainerOptionsMapDescriptors=[["4579","3297"],["512"]];mstrFormatImpl.panelStackOptionsMap=[[{name:"",value:0},{name:"",value:1}],[{name:"",value:2}]];mstrFormatImpl.gridContainerOptionsMap=[[{name:"",value:8},{name:"",value:9}],[{name:"",value:8}]];mstrFormatImpl.prototype.onload=function(){try{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.start("mstrFormatImpl.onload",mstrLogImpl.LOAD_TABS);}mstrFormatImpl.initOptionsMap();this.initFormatManager();this.tabContainer=microstrategy.subObjectFind(this.body,["DIV"],microstrategy.SUBOBJTYPE_TAB_CONTAINER);this.commands=new mstrFormatImplCommandsImpl(this);}catch(err){microstrategy.errors.log(err);return false;}finally{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.stop("mstrFormatImpl.onload",mstrLogImpl.LOAD_TABS);}}};mstrFormatImpl.initOptionsMap=function(){try{if(mstrFormatImpl.panelStackOptionsMap[0][0].name!=""){return ;}else{for(var i=0;i<mstrFormatImpl.panelStackOptionsMap.length;i++){for(var j=0;j<mstrFormatImpl.panelStackOptionsMap[i].length;j++){mstrFormatImpl.panelStackOptionsMap[i][j].name=microstrategy.descriptors.getDescriptor(mstrFormatImpl.panelStackOptionsMapDescriptors[i][j]);}}for(var i=0;i<mstrFormatImpl.gridContainerOptionsMap.length;i++){for(var j=0;j<mstrFormatImpl.gridContainerOptionsMap[i].length;j++){mstrFormatImpl.gridContainerOptionsMap[i][j].name=microstrategy.descriptors.getDescriptor(mstrFormatImpl.gridContainerOptionsMapDescriptors[i][j]);}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.onreload=function(){try{mstrEditorImpl.prototype.onreload.call(this);var tabSets=microstrategy.findChildrenWithAtt(this.elem,"span","ty","tab");if(!tabSets){return false;}for(var i=0;i<tabSets.length;i++){if(tabSets[i].getAttribute("curTab")==this.currentTab){var tabSection;var tabId=tabSets[i].getAttribute("tab");if(tabId){tabSection=getElementById(tabId);}if(tabSection){this.updateDynamicInfo(tabSets[i]);this.showTabSection(tabSection);if(!microstrategy.bone(tabId)){var scriptClass=tabSection.getAttribute("scriptClass");if(scriptClass){loadInit(scriptClass+"Script",'microstrategy.registerBone("'+tabId+'", "(true)", null);');this.setTimeout('microstrategy.bone("'+tabId+'")','microstrategy.bone("'+this.id+'").loadChildrenTab("'+tabId+'")',500);}}}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.onpostload=function(){try{mstrEditorImpl.prototype.onpostload.call(this);this.initChildrenTabs();this.initSelections();this.restorePreviousSelections();}catch(err){microstrategy.errors.log(err);return false;}finally{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.stop("mstrFormatImpl.onload",mstrLogImpl.LOAD_TABS);}}};mstrFormatImpl.prototype.onunload=function(e){try{mstrEditorImpl.prototype.onunload.call(this,e);this.unRegisterChildren();var bone=this.getAppliesTo();if(bone!=null&&bone.observer){bone.observer.unregister(this.id);}}catch(err){microstrategy.errors.log(err);}return true;};mstrFormatImpl.prototype.restorePreviousSelections=function(){try{if(this.selectedTabOptions!=null&&this.selectedTabOptions.length>0){eval("this.selectedTabOptions = "+this.selectedTabOptions);for(var id in this.selectedTabOptions){var tab=microstrategy.bone(id);if(tab!=null){var settings=this.selectedTabOptions[id];tab.restorePreviousSelections(settings);}}this.selectedTabOptions=null;}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.initFormatManager=function(){try{this.initEditor();this.changesApplied=0;if(this.elem){var appliesTo=this.elem.getAttribute("at");if(appliesTo&&appliesTo.length>0){this.setAppliesTo(appliesTo);}}if(this.axisOptionId&&this.levelOptionId){this.targetOptions=microstrategy.findChildWithAtt(this.elem,"SELECT","id",this.axisOptionId);this.levelOptions=microstrategy.findChildWithAtt(this.elem,"SELECT","id",this.levelOptionId);}this.adjustTargetLevelOptions();this.initHelpButton();}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.initHelpButton=function(){try{var helpImg=microstrategy.findChildWithAtt(this.elem,"img",(bIsW3C)?"class":"className","mstrIcon-btn mstrIcon-btnHelp");if(helpImg){this.help=helpImg.parentNode;}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.isPanelStackSelected=function(){try{var at=this.getAppliesTo();return(at&&at.commands.queryEnabled("onepanelstack")==true);}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.areAllSelectedPanelStacks=function(){try{var at=this.getAppliesTo();return(at&&at.commands.queryEnabled("allpanelstack")==true&&at.commands.queryEnabled("onepanelstack")==false);}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.isGridSelected=function(){try{var at=this.getAppliesTo();return(at&&at.commands.queryEnabled("onegrid")==true);}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.isGridContainerSelected=function(){try{var at=this.getAppliesTo();return(this.isGridSelected()&&this.targetAxis==0&&(this.targetLevel==8||this.targetLevel==9));}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.adjustTargetLevelOptions=function(){try{var childrenLevelOptions;var levelOptionsLength;var origSelectedValue;if(this.levelOptions){childrenLevelOptions=this.levelOptions.options;levelOptionsLength=childrenLevelOptions.length;if(this.isGridContainerSelected()){if(childrenLevelOptions){origSelectedValue=childrenLevelOptions[this.levelOptions.selectedIndex].value;for(var i=0;i<levelOptionsLength;i++){this.levelOptions.removeChild(childrenLevelOptions[0]);}}var gridBone=microstrategy.findBone(this.getAppliesTo().commands.queryState("selectedGrid"));if(!gridBone.showTitleBar()){this.targetLevel=8;targetIndex=1;this.levelOptions.disabled=true;}else{targetIndex=0;this.levelOptions.disabled=false;}for(var j=0;j<mstrFormatImpl.gridContainerOptionsMap[targetIndex].length;j++){var oOption=document.createElement("OPTION");this.levelOptions.options.add(oOption);oOption.text=mstrFormatImpl.gridContainerOptionsMap[targetIndex][j].name;oOption.value=mstrFormatImpl.gridContainerOptionsMap[targetIndex][j].value;oOption.selected=(j==0||oOption.value==origSelectedValue);}}if(this.isPanelStackSelected()){if(childrenLevelOptions){origSelectedValue=childrenLevelOptions[this.levelOptions.selectedIndex].value;for(var i=0;i<levelOptionsLength;i++){this.levelOptions.removeChild(childrenLevelOptions[0]);}}var targetIndex=0;if(this.targetAxis==0){var panelStackBone=microstrategy.findBone(this.getAppliesTo().commands.queryState("selectedPanelStack"));if(!panelStackBone.isTitleVisible){this.targetLevel=0;targetIndex=1;this.levelOptions.disabled=true;}else{targetIndex=0;this.levelOptions.disabled=false;}}else{if(this.targetAxis==1){this.targetLevel=2;targetIndex=1;this.levelOptions.disabled=true;}}for(var j=0;j<mstrFormatImpl.panelStackOptionsMap[targetIndex].length;j++){var oOption=document.createElement("OPTION");this.levelOptions.options.add(oOption);oOption.text=mstrFormatImpl.panelStackOptionsMap[targetIndex][j].name;oOption.value=mstrFormatImpl.panelStackOptionsMap[targetIndex][j].value;oOption.selected=(j==0||oOption.value==origSelectedValue);}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.enableChildrenTabs=function(){try{var tabControls=microstrategy.objectListFind(this.body,["span"],microstrategy.OBJTYPE_TAB);var at=this.getAppliesTo();var adjustCurrentTab=false;var firstEnabledTab=null;if(tabControls&&tabControls.length){for(var i=0;i<tabControls.length;i++){var setDisabled=false;var enabledCmd=tabControls[i].getAttribute(microstrategy.HTMLATTR_CMD_ID);if(enabledCmd&&enabledCmd.length>0){if(!at.commands.queryEnabled(enabledCmd)||!this.commands.queryEnabled(enabledCmd)){setDisabled=true;}}if(firstEnabledTab==null&&!setDisabled){firstEnabledTab=i;}if((this.currentTab-1)==i&&setDisabled){adjustCurrentTab=true;}if(setDisabled){tabControls[i].className="mstrTabSetTabdisabled";microstrategy.unRegisterBone(tabControls[i].id);var tabSection=tabControls[i].getAttribute("tab");if(tabSection){tabSection=getElementById(tabSection);}if(tabSection){tabSection.style.display="none";tabSection.style.visibility="hidden";}}else{if(!this.submitUponTargetLevelChange){if(tabControls[i].className&&tabControls[i].className.indexOf("disabled")>=0){tabControls[i].className=tabControls[i].className.replace("disabled"," ");}}}}}if(adjustCurrentTab){this.setCurrentTab(tabControls[firstEnabledTab]);}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.initChildrenTabs=function(){try{this.childrenTabs=new Array();this.enableChildrenTabs();if(this.tabContainer){var tabs=microstrategy.subObjectListFind(this.tabContainer,["DIV"],microstrategy.SUBOBJTYPE_TAB_SECTION);if(tabs&&tabs.length){for(var j=0;j<tabs.length;j++){var previouslyRegistered=microstrategy.bone(tabs[j].id);var tabControl=microstrategy.findChildWithAtt(this.body,"SPAN","id",tabs[j].id+"_tab");if((tabControl&&(tabControl.className.indexOf("disabled")==-1))||tabs.length==1){if(!previouslyRegistered){if(tabs[j].getAttribute("scriptClass")){loadInit(tabs[j].getAttribute("scriptClass")+"Script",'microstrategy.registerBone("'+tabs[j].id+'", "(true)", null);');this.setTimeout('microstrategy.bone("'+tabs[j].id+'")','microstrategy.bone("'+this.id+'").loadChildrenTab("'+tabs[j].id+'")',500);}}else{previouslyRegistered.dialogDiv=this.elem;previouslyRegistered.tabManager=this;this.childrenTabs[this.childrenTabs.length]=previouslyRegistered;if(previouslyRegistered.initValues){previouslyRegistered.initValues();}}}this.setScheduleTab(previouslyRegistered);this.setDeliveryTab(previouslyRegistered);}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.loadChildrenTab=function(tabID){try{var tab=microstrategy.bone(tabID);if(tab){tab.tabManager=this;tab.setAppliesTo(this.getAppliesTo());if(tabID in this){for(var key in this[tabID]){tab[key]=this[tabID][key];}}if(tab.onload){tab.onload();}tab.dialogDiv=this.elem;if(tab.initSharedObj){tab.initSharedObj(this.sharedObj);}this.childrenTabs[this.childrenTabs.length]=tab;if(tab.onpostload){tab.onpostload();}this.setScheduleTab(tab);this.setDeliveryTab(tab);this.resizePopUp(this.elem);}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.setScheduleTab=function(tabBone){try{if(tabBone&&tabBone.scheduleType!=undefined){tabBone.initScheduleInfo();this.scheduleTab=tabBone;}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.setDeliveryTab=function(tabBone){try{if(tabBone&&tabBone.userType!=undefined){this.deliveryTab=tabBone;}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.unRegisterChildren=function(){try{if(this.tabContainer){if(this.childrenTabs&&this.childrenTabs.length){var bone=this.getAppliesTo();for(var j=0;j<this.childrenTabs.length;j++){if(bone&&bone.observer){bone.observer.unregister(this.childrenTabs[j].id);}microstrategy.unRegisterBone(this.childrenTabs[j].id);}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.initSelections=function(){try{if(this.titleBar){var at=this.getAppliesTo();if(at==null){return ;}var titleSpans=this.titleBar.getElementsByTagName("span");var titleTag=this.titleBar;if(titleSpans.length>0){titleTag=titleSpans[0];}var tempTitle=titleTag.innerHTML;var index=tempTitle.indexOf(":");if(index<0){index=tempTitle.indexOf("\uFF1A");}if(index==tempTitle.length-1){tempTitle=tempTitle.substr(0,index+1);if(at.commands&&at.commands.queryEnabled("isUserMetricSelected")){tempTitle=tempTitle+" "+microstrategy.descriptors.getDescriptor("3865");}else{if(at.commands&&at.commands.queryEnabled("isSummaryMetricSelected")){tempTitle=tempTitle+" "+microstrategy.descriptors.getDescriptor("3866");}else{if(at.commands&&!at.commands.queryEnabled()&&!at.commands.queryEnabled("onegrid")){tempTitle=tempTitle+" "+microstrategy.descriptors.getDescriptor("3520");}else{if(at.commands){tempTitle=tempTitle+" "+at.commands.queryState("selected");}}}}}titleTag.innerHTML=tempTitle;}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.setAppliesTo=function(bone){try{if(!this.appliesTo){this.appliesTo=(typeof (bone)=="string")?bone:bone.id;}bone=microstrategy.bone(this.appliesTo);if(bone&&bone.observer){bone.observer.register(this.id);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.getAppliesTo=function(bone){try{if(this.appliesTo){var bone=microstrategy.bone(this.appliesTo);return bone;}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.cancelChanges=function(){try{var at=this.getAppliesTo();var um=at.updateManager||at.um;if(at&&um){while(this.changesApplied>0){um.undo();this.changesApplied--;}}this.changesApplied=0;for(var counter=0;counter<this.childrenTabs.length;counter++){this.childrenTabs[counter].cleanup();}this.actionId=null;this.closeEditor();return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.applyGraphFormatChanges=function(bulkChanges){try{var at=this.getAppliesTo();if(!this.validateInputs()){return false;}if(bulkChanges==null){bulkChanges=new Array();}var counter;if(bulkChanges.length==0){for(counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];bulkChanges=aChildTab.applyFormatChanges(at,bulkChanges);}}if(bulkChanges.length>0){at.commands.exec("formatGraphBulk",bulkChanges);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.applyFormatChanges=function(bulkChanges){try{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.start("mstrFormatImpl.applyFormatChanges",mstrLogImpl.APPLY_EDITOR_CHANGES);}var at=this.getAppliesTo();var um=at.updateManager||at.um;if(bulkChanges==null){bulkChanges=new Array();}var counter;if(!this.validateInputs()){return false;}this.changeGridProperties=(at&&at.commands.queryEnabled("onegrid")==true)?true:false;var gridContainerChanges=this.isGridContainerSelected();var enforceSubmit=false;var numberTab=null;if(this.isPanelStackSelected()){if(this.targetAxis==0&&this.targetLevel==1){microstrategy.formatType=mstrPanelStack.FMT_TYPE_TITLE;}}if(this.changeGridProperties&&gridContainerChanges&&this.targetLevel==9){microstrategy.formatType=mstrGridReport.FMT_TYPE_TITLE;}if(bulkChanges.length==0){for(counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];if(this.changeGridProperties&&!gridContainerChanges){aChildTab.enforceSubmit=true;}aChildTab.applyFormatChanges(at,bulkChanges);enforceSubmit=enforceSubmit||aChildTab.enforceSubmit;if(typeof (aChildTab.isUserMetric)!="undefined"&&aChildTab.isUserMetric){this.formatUserMetric=true;numberTab=aChildTab;}}this.getExtraFormatChanges(at,bulkChanges);}if(bulkChanges.length>0){if(this.formatUserMetric){var formatChanges=new Object();formatChanges.userMetricId=numberTab.userMetricId;formatChanges.dataSetId=numberTab.dataSetId;formatChanges.bulkChanges=bulkChanges;at.commands.exec("formatUserMetric",formatChanges);}else{if(this.changeGridProperties==true&&this.targetAxis!=null){var oGrid=at.commands.queryState("selectedGrid");var targetGrid=microstrategy.findBone(oGrid);if(targetGrid==null){targetGrid=microstrategy.findBone(document.getElementById(oGrid.id));}if(targetGrid){targetGrid.selectedAxis=this.targetAxis;targetGrid.selectedPosition=this.targetPosition;targetGrid.selectedLevel=this.targetLevel;targetGrid.selectedUnit=this.targetUnit;}if(gridContainerChanges){at.commands.exec("formatBulk",bulkChanges);if(enforceSubmit&&microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE&&um){um.flushAndSubmitChanges();}}else{at.commands.exec("formatGridBulk",bulkChanges);}}else{at.commands.exec("formatBulk",bulkChanges,this.isPanelStackSelected()&&this.targetAxis==1);if(enforceSubmit&&microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE&&um){um.flushAndSubmitChanges();}}}this.changesApplied++;}microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;return true;}catch(err){microstrategy.errors.log(err);return false;}finally{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.stop("mstrFormatImpl.applyFormatChanges",mstrLogImpl.APPLY_EDITOR_CHANGES);}}};mstrFormatImpl.prototype.getExtraFormatChanges=function(at,bulkChanges){try{}catch(err){microstrategy.errors.log(err);}return bulkChanges;};mstrFormatImpl.prototype.applyMultiLevelFormatChanges=function(){try{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.start("mstrFormatImpl.applyMultiLevelFormatChanges",mstrLogImpl.APPLY_EDITOR_CHANGES);}var at=this.getAppliesTo();if(!at){return ;}if(!this.validateInputs()){return false;}var um=microstrategy.updateManager;var bulkChanges=new Array();var enforceSubmit=false;um.queueActions=true;for(var i=0;i<this.childrenTabs.length;i++){var aChildTab=this.childrenTabs[i];bulkChanges=aChildTab.applyFormatChanges(at,bulkChanges);enforceSubmit=enforceSubmit||aChildTab.enforceSubmit;}if(bulkChanges.length==0){um.queueActions=false;return ;}at.commands.exec("formatMultiLevelBulk",bulkChanges);um.addCachedActions();if(enforceSubmit){um.flushAndSubmitChanges();}this.changesApplied++;return true;}catch(err){microstrategy.errors.log(err);return false;}finally{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.stop("mstrFormatImpl.applyMultiLevelFormatChanges",mstrLogImpl.APPLY_EDITOR_CHANGES);}}};mstrFormatImpl.prototype.applyScheduleChanges=function(submit){try{var scheduleTab=this.scheduleTab;if(scheduleTab){var at=this.getAppliesTo();var newType=scheduleTab.getScheduleType();var newList=scheduleTab.getScheduleList();if(newType!=scheduleTab.scheduleType||newList!=scheduleTab.scheduleList){var um=at.updateManager||at.um;um.add([um.createActionObject(at.elem,mstrUpdateManager.SAVE_REPORT_ASSOCIATED_SCHEDULES,at.beanPath,["4238","4239"],[newType,newList],[scheduleTab.scheduleType,scheduleTab.schedule])]);if(submit){um&&um.flushAndSubmitChanges();}}return true;}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.applyUserChanges=function(submit){try{var deliveryTab=this.deliveryTab;if(deliveryTab){var at=this.getAppliesTo(),userInfo=deliveryTab.getAssociatedUserInfo(),newType=userInfo.userType,newUsers=userInfo.users;if(newType!=deliveryTab.userTypeWas||newUsers!=deliveryTab.usersWas){var um=at.updateManager||at.um;um.add([um.createActionObject(at.elem,mstrUpdateManager.SAVE_REPORT_ASSOCIATED_USERS,at.beanPath,["4241","4242"],[userInfo.allowType,newUsers])]);if(submit){um&&um.flushAndSubmitChanges();}deliveryTab.userTypeWas=newType;deliveryTab.usersWas=newUsers;}return true;}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.applyPropertyChanges=function(cmdID,validate){try{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.start("mstrFormatImpl.applyPropertyChanges",mstrLogImpl.APPLY_EDITOR_CHANGES);}if(validate==false||this.validateInputs(true)){var at=this.getAppliesTo();var propertiesArray=new Array();for(var counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];aChildTab.applyPropertyChanges(propertiesArray);if(aChildTab.applySharedObjChanges){aChildTab.applySharedObjChanges(propertiesArray);}}this.applyScheduleChanges(propertiesArray.length==0);this.applyUserChanges(propertiesArray.length==0);if(propertiesArray.length>0){if(cmdID&&cmdID.length>0){at.commands.exec(cmdID,propertiesArray);}else{at.commands.exec("PropertyChanges",propertiesArray);}}this.changesApplied++;return true;}else{return false;}}catch(err){microstrategy.errors.log(err);return false;}finally{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.stop("mstrFormatImpl.applyPropertyChanges",mstrLogImpl.APPLY_EDITOR_CHANGES);}}};mstrFormatImpl.prototype.applyMultiLevelPropertyChanges=function(validate){try{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.start("mstrFormatImpl.applyPropertyChanges",mstrLogImpl.APPLY_EDITOR_CHANGES);}var at=this.getAppliesTo();if(!at){return ;}if(validate&&!this.validateInputs()){return false;}var um=microstrategy.updateManager;var bulkChanges=new Array();var enforceSubmit=false;um.queueActions=true;for(var i=0;i<this.childrenTabs.length;i++){var aChildTab=this.childrenTabs[i];aChildTab.applyPropertyChanges(bulkChanges);enforceSubmit=enforceSubmit||aChildTab.enforceSubmit;}if(bulkChanges.length==0){um.queueActions=false;return ;}at.commands.exec("MultiLevelPropertyChanges",bulkChanges);um.addCachedActions();if(enforceSubmit){um.flushAndSubmitChanges();}this.changesApplied++;return true;}catch(err){microstrategy.errors.log(err);return false;}finally{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.stop("mstrFormatImpl.applyMultiLevelPropertyChanges",mstrLogImpl.APPLY_EDITOR_CHANGES);}}};mstrFormatImpl.prototype.okPropertyChanges=function(cmdID,isMultiLevel){try{var bValid=true;bValid=this.validateInputs(true);if(bValid){this.close();if(isMultiLevel){this.applyMultiLevelPropertyChanges(false);}else{this.applyPropertyChanges(cmdID,false);}for(var counter=0;counter<this.childrenTabs.length;counter++){this.childrenTabs[counter].cleanup();}this.actionId=null;microstrategy.unRegisterBone(this.id);}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.okFormatChanges=function(isMultiLevel){try{isMultiLevel=(isMultiLevel==true);if(!this.validateInputs()){return false;}else{this.close();if(isMultiLevel){this.applyMultiLevelFormatChanges();}else{this.applyFormatChanges();}microstrategy.unRegisterBone(this.id);}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.okGraphFormatChanges=function(){try{if(!this.validateInputs()){return false;}else{this.close();this.applyGraphFormatChanges();microstrategy.unRegisterBone(this.id);}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.adjustFormatType=function(){try{if(this.changeGridProperties&&this.targetAxis==0&&this.targetLevel==9){microstrategy.formatType=mstrGridReport.FMT_TYPE_TITLE;}if(this.isPanelStackSelected()){if(this.targetAxis==0&&this.targetLevel==1){microstrategy.formatType=mstrPanelStack.FMT_TYPE_TITLE;}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.getHTMLElement=function(obj){if(typeof (obj)=="string"){obj=getElementById(obj);}return obj;};mstrFormatImpl.prototype.hasChanges=function(){var checkForChanges=false;var counter;for(counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];checkForChanges=aChildTab.checkForFormatChanges();if(checkForChanges){break;}}return checkForChanges;};mstrFormatImpl.prototype.changeTarget=function(obj,bApplyChanges){try{var at=this.getAppliesTo();var bulkChanges=new Array();obj=mstrFormatImpl.getHTMLElement(obj);var um=at.updateManager||at.um;var checkForChanges=this.hasChanges();if((typeof (bApplyChanges)=="undefined")&&checkForChanges){showMessage({contents:microstrategy.descriptors.getDescriptor("3044"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').changeTarget('"+obj.id+"',true);",cancelEval:"microstrategy.bone('"+this.id+"').changeTarget('"+obj.id+"',false);",type:mstrMsgBoxImpl.MSG_WARNING});}else{var actionCollection=new Array();for(counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];aChildTab.applyFormatChanges(at,bulkChanges);}if((typeof (bApplyChanges)=="boolean")&&bApplyChanges&&(bulkChanges.length>0)){if(this.applyFormatPropertyChanges){this.applyFormatPropertyChanges(bulkChanges);}else{this.applyFormatChanges(bulkChanges);}this.targetAxis=obj.value;actionCollection.push(um.createActionObject(obj,mstrUpdateManager.CHANGE_FORMATTING_TARGET,this.beanPath,["72003"],[obj.value]));um.add(actionCollection);if(this.submitUponTargetLevelChange){this.unRegisterChildren();}}else{this.targetAxis=obj.value;if(at&&um){actionCollection.push(um.createActionObject(obj,mstrUpdateManager.CHANGE_FORMATTING_TARGET,this.beanPath,["72003"],[obj.value]));um.add(actionCollection);if(this.submitUponTargetLevelChange){um.flushAndSubmitChanges();this.unRegisterChildren();}}}}if(!this.submitUponTargetLevelChange){this.adjustTargetLevelOptions();this.initChildrenTabs();}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.changePosition=function(obj,bApplyChanges){try{var at=this.getAppliesTo();var bulkChanges=new Array();obj=mstrFormatImpl.getHTMLElement(obj);var um=at.updateManager||at.um;var checkForChanges=this.hasChanges();if((typeof (bApplyChanges)=="undefined")&&checkForChanges){showMessage({contents:microstrategy.descriptors.getDescriptor("3044"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').changePosition('"+obj.id+"',true);",cancelEval:"microstrategy.bone('"+this.id+"').changePosition('"+obj.id+"',false);",type:mstrMsgBoxImpl.MSG_WARNING});}else{var actionCollection=new Array();for(counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];bulkChanges=aChildTab.applyFormatChanges(at,bulkChanges);}if((typeof (bApplyChanges)=="boolean")&&bApplyChanges&&(bulkChanges.length>0)){if(obj.value=="0,-9"){actionCollection.push(um.createActionObject(obj,mstrUpdateManager.CHANGE_FORMATTING_TARGET,this.beanPath,["72003","72002"],[0,8]));}else{actionCollection.push(um.createActionObject(obj,mstrUpdateManager.CHANGE_FORMATTING_TARGET,this.beanPath,["72001"],[obj.value]));}um.add(actionCollection);this.applyFormatChanges(bulkChanges);um.flushAndSubmitChanges();this.unRegisterChildren();}else{if(at&&um){if(obj.value=="0,-9"){actionCollection.push(um.createActionObject(obj,mstrUpdateManager.CHANGE_FORMATTING_TARGET,this.beanPath,["72003","72002"],[0,8]));}else{actionCollection.push(um.createActionObject(obj,mstrUpdateManager.CHANGE_FORMATTING_TARGET,this.beanPath,["72001"],[obj.value]));}um.add(actionCollection);um.flushAndSubmitChanges();this.unRegisterChildren();}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.changeLevel=function(obj,bApplyChanges){try{var at=this.getAppliesTo();obj=mstrFormatImpl.getHTMLElement(obj);var um=at.updateManager||at.um;var checkForChanges=this.hasChanges();if(typeof (bApplyChanges)=="undefined"&&checkForChanges){showMessage({contents:microstrategy.descriptors.getDescriptor("3044"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').changeLevel('"+obj.id+"',true);",cancelEval:"microstrategy.bone('"+this.id+"').changeLevel('"+obj.id+"',false);",type:mstrMsgBoxImpl.MSG_WARNING});return ;}if(bApplyChanges==true&&checkForChanges){this.applyFormatChanges();}this.targetLevel=obj.value;if(at&&um){if(this.submitUponTargetLevelChange==true||bApplyChanges==true){var actionCollection=new Array();actionCollection.push(um.createActionObject(obj,mstrUpdateManager.CHANGE_FORMATTING_TARGET,this.beanPath,["72002"],[obj.value]));um.add(actionCollection);}if(this.submitUponTargetLevelChange){um.flushAndSubmitChanges();this.unRegisterChildren();}else{this.initChildrenTabs();}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.setCurTab=function(curTabIndex){try{var tabs=microstrategy.findChildrenWithAtt(this.elem,"span","ty","tab");for(var i=0;i<tabs.length;i++){if(tabs[i].getAttribute("curTab")==curTabIndex){this.setCurrentTab(tabs[i]);break;}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.setCurrentTab=function(elemTab){try{if(!elemTab){return false;}if(this.currentTab==elemTab.getAttribute("curTab")){return false;}if((elemTab.className.indexOf("disabled")>=0)||(!this.validateInputs())){return true;}var tabs=microstrategy.findChildrenWithAtt(this.elem,"span","ty","tab");var needFetch=true;var currentTabBone=null;for(var i=0;i<tabs.length;i++){var tabSection=tabs[i].getAttribute("tab");if(tabSection){tabSection=getElementById(tabSection);}if(tabs[i]==elemTab){tabs[i].className="mstrTabSetTabSelected";this.currentTab=elemTab.getAttribute("curTab");if(tabSection&&elemTab.getAttribute(microstrategy.TAB_SWITCH_MODE)==microstrategy.TAB_SWITCH_MODE_CACHED){this.updateDynamicInfo(elemTab);this.showTabSection(tabSection);currentTabBone=microstrategy.findBone(tabSection);needFetch=false;for(var j=0;j<this.childrenTabs.length;j++){if(this.childrenTabs[j]&&this.childrenTabs[j].id==elemTab.id.substring(0,elemTab.id.indexOf("_tab"))&&this.childrenTabs[j].onpostswitch){this.childrenTabs[j].onpostswitch();break;}}}}else{if(tabs[i].className.indexOf("disabled")==-1){tabs[i].className="mstrTabSetTab";this.hideTabSection(tabSection);}}}this.addSetTabEvent(needFetch);if(needFetch){microstrategy.updateManager.flushAndSubmitChanges();}else{if(this.adjustTabTable){this.adjustTabTable();if(currentTabBone){if(currentTabBone.resize){currentTabBone.resize();}if(currentTabBone.onSwitchToCurrent){currentTabBone.onSwitchToCurrent();}}}}this.resizePopUp(this.elem);microstrategy.eventManager.notifyOrphanBones("onstatechange");return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.findTabSectionContainer=function(tabSection){try{return tabSection;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.showTabSection=function(tabSection){try{if(!tabSection){return ;}var tabSectionContainer=this.findTabSectionContainer(tabSection);tabSectionContainer.style.display="block";tabSectionContainer.style.visibility="visible";}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.hideTabSection=function(tabSection){try{if(!tabSection){return ;}var tabSectionContainer=this.findTabSectionContainer(tabSection);tabSectionContainer.style.display="none";tabSectionContainer.style.visibility="hidden";}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.updateDynamicInfo=function(elemTab){try{this.updateDynamicTitle(elemTab);this.updateDynamicHelp(elemTab);}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.updateDynamicTitle=function(elemTab){try{var tc=this.getTitleContainer();if(this.useDynamicTitle&&tc){if(tc.childNodes[0]){tc.childNodes[0].nodeValue=(elemTab.childNodes[0].childNodes[0])?elemTab.childNodes[0].childNodes[0].nodeValue:elemTab.childNodes[0].nodeValue;tc.setAttribute("title",tc.childNodes[0].nodeValue);}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.updateDynamicHelp=function(elemTab){if(this.help){this.help.setAttribute("href",(elemTab.getAttribute("helpUrl"))?elemTab.getAttribute("helpUrl"):this.defaultHelpURL);if(this.help.childNodes[0]&&this.getTitleContainer()){var tooltip=microstrategy.descriptors.getDescriptor("2409").replace("###",this.titleContainer.childNodes[0].nodeValue);this.help.childNodes[0].setAttribute("title",tooltip);}}try{}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.addSetTabEvent=function(renderTabContentOnly){try{var um=microstrategy.updateManager;if(um){var actionCollection=new Array();actionCollection.push(um.createActionObject(null,mstrUpdateManager.SET_CURRENT_TAB,this.beanPath,["49001","49002"],[this.currentTab,renderTabContentOnly]));um.add(actionCollection,true);}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.getChangedTabOptions=function(){try{var changes="";for(var counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];var c=aChildTab.getChanges();if(c!=null&&c.length>0){changes+='"'+aChildTab.id+'":{'+c+"},";}}if(changes.length>0){changes=changes.substring(0,changes.length-1);}changes="{"+changes+"}";return changes;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.validateInputs=function(validateChildren){try{if(!mstrEditorImpl.prototype.validateInputs.call(this)){return false;}if(validateChildren){for(var counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];if(!aChildTab.validateInputs()){return false;}}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.onmenusubmitform=function(){if(this.autoSubmitJS!=null){return eval(this.autoSubmitJS);}};mstrFormatImpl.prototype.applySortChanges=function(){try{var actionCollection=new Array();for(var counter=0;counter<this.childrenTabs.length;counter++){var aChildTab=this.childrenTabs[counter];aChildTab.getSortChanges(actionCollection);}var um=microstrategy.updateManager;if(actionCollection.length>0&&um){um.add(actionCollection,true);um.flushAndSubmitChanges();}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.okSortChanges=function(){try{this.close();this.applySortChanges();microstrategy.unRegisterBone(this.id);return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.afterresize=function(){try{if(mstrEditorImpl.prototype.afterresize){mstrEditorImpl.prototype.afterresize.call(this);}for(var counter=0;counter<this.childrenTabs.length;counter++){if(this.childrenTabs[counter]&&this.childrenTabs[counter].afterresize){this.childrenTabs[counter].afterresize();}}}catch(err){microstrategy.errors.log(err);return false;}};mstrFormatImpl.prototype.getTitleContainer=function(){try{if(!this.titleContainer){this.titleContainer=microstrategy.findChildWithAtt(this.elem,"span",((bIsW3C)?"class":"className"),"mstrPanelTitle");}return this.titleContainer;}catch(err){microstrategy.errors.log(err);return false;}};function mstrFormatImpl(id){this.inherits=mstrEditorImpl;this.inherits(id);this.inherits=null;return this;}mstrFormatImplCommandsImpl.prototype=new Object();mstrFormatImplCommandsImpl.prototype.queryEnabled=function(cmdId){try{switch(cmdId){case"fontprops":if(this.parentBone.areAllSelectedPanelStacks()){return false;}if(this.parentBone.isPanelStackSelected()){if(this.parentBone.targetAxis==1){return false;}if(this.parentBone.targetLevel!=1){return false;}}else{if(this.parentBone.isGridSelected()){if((this.parentBone.targetPosition==-9&&this.parentBone.targetLevel==8)||(this.parentBone.targetPosition==-99)){return false;}}}break;case"numberprops":if(this.parentBone.areAllSelectedPanelStacks()){return false;}if(this.parentBone.isPanelStackSelected()){return false;}if(this.parentBone.isGridSelected()){if(this.parentBone.isGridContainerSelected()||(this.parentBone.targetPosition==-99)){return false;}}break;case"alignprops":if(this.parentBone.areAllSelectedPanelStacks()){return false;}if(this.parentBone.isPanelStackSelected()){return false;}if(this.parentBone.isGridSelected()){if(this.parentBone.isGridContainerSelected()||(this.parentBone.targetPosition==-99)){return false;}}break;case"dropShadowEffect":if(this.parentBone.isGridSelected()){if(this.parentBone.targetPosition==-99){return false;}}case"effectprops":if(this.parentBone.isPanelStackSelected()){if(this.parentBone.targetLevel==1){return false;}}else{if(this.parentBone.isGridSelected()){if((this.parentBone.targetPosition!=-9||this.parentBone.targetLevel!=8)&&(this.parentBone.targetPosition!=-99)){return false;}}}break;}return true;}catch(err){microstrategy.errors.log(err);return false;}};function mstrFormatImplCommandsImpl(parentBone){this.parentBone=parentBone;return this;}