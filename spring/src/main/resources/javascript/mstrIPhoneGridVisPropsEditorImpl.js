mstrIPhoneGridVisPropsEditorImplScript=true;mstrIPhoneGridVisPropsEditorImpl.prototype=new mstrBoneImpl();mstrIPhoneGridVisPropsEditorImpl.prototype.tableName;mstrIPhoneGridVisPropsEditorImpl.prototype.dragObject=null;mstrIPhoneGridVisPropsEditorImpl.prototype.mouseOffset=null;mstrIPhoneGridVisPropsEditorImpl.prototype.table=null;mstrIPhoneGridVisPropsEditorImpl.prototype.oldY=0;mstrIPhoneGridVisPropsEditorImpl.prototype.firstAttributeForms=null;mstrIPhoneGridVisPropsEditorImpl.prototype.onload=function(){try{this.initBone();this.verifiedPath=microstrategy.getEventHandlerString(this.path);this.attachWinListener(this,"mousemove","ondragstart");this.attachWinListener(this,"mouseup","onmouseup",false);this.table=document.getElementById(this.tableName);if(!this.table){return ;}var rows=this.table.tBodies[0].rows;for(var i=0;i<rows.length;i++){var nodrag=rows[i].getAttribute("NoDrag");if(nodrag==null||nodrag=="undefined"){this.makeDraggable(rows[i]);}}this.showWidths(microstrategy.findChildWithAtt(this.elem,"input","id","ar"));var attributeForms=document.getElementById("daf");this.firstAttributeForms=new Array();for(var i=0;i<attributeForms.length;i++){var elements=attributeForms.options[i].value.split(":");var j=0;if(elements[2]=="0"){this.firstAttributeForms[j]=attributeForms[i];j++;}}this.updateGrouping();}catch(err){microstrategy.errors.log(err);}};mstrIPhoneGridVisPropsEditorImpl.prototype.onmousedown=function(e){try{var target;if(window.event){target=window.event.srcElement;}else{target=e.target;}if(target.tagName=="INPUT"||target.tagName=="SELECT"){return true;}this.dragObject=findTargetTag(target,"tr");this.mouseOffset=this.getMouseOffset(target,e);return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrIPhoneGridVisPropsEditorImpl.prototype.ondragstart=function(ev){try{if(this.dragObject){ev=ev||window.event;var y=ev.y-this.mouseOffset.y;if(y!=this.oldY){var movingDown=y>this.oldY;this.oldY=y;this.dragObject.style.backgroundColor="#eee";var currentRow=this.findDropTargetRow(y);if(currentRow){if(movingDown&&this.dragObject!=currentRow){this.dragObject.parentNode.insertBefore(this.dragObject,currentRow.nextSibling);}else{if(!movingDown&&this.dragObject!=currentRow){this.dragObject.parentNode.insertBefore(this.dragObject,currentRow);}}}}return false;}}catch(err){microstrategy.errors.log(err);return false;}};mstrIPhoneGridVisPropsEditorImpl.prototype.onmouseup=function(ev){try{if(this.dragObject){var droppedRow=this.dragObject;droppedRow.style.backgroundColor="#FFFFFF";this.dragObject=null;this.onDrop(this.table,droppedRow);}}catch(err){microstrategy.errors.log(err);return false;}};mstrIPhoneGridVisPropsEditorImpl.prototype.onDrop=function(table,droppedRow){};mstrIPhoneGridVisPropsEditorImpl.prototype.getPosition=function(e){try{var left=0;var top=0;if(e.offsetHeight==0){e=e.firstChild;}while(e.offsetParent){left+=e.offsetLeft;top+=e.offsetTop;e=e.offsetParent;}left+=e.offsetLeft;top+=e.offsetTop;return{x:left,y:top};}catch(err){microstrategy.errors.log(err);return false;}};mstrIPhoneGridVisPropsEditorImpl.prototype.mouseCoords=function(ev){try{if(ev.pageX||ev.pageY){return{x:ev.pageX,y:ev.pageY};}return{x:ev.clientX+document.body.scrollLeft-document.body.clientLeft,y:ev.clientY+document.body.scrollTop-document.body.clientTop};}catch(err){microstrategy.errors.log(err);return false;}};mstrIPhoneGridVisPropsEditorImpl.prototype.getMouseOffset=function(target,ev){try{ev=ev||window.event;var docPos=this.getPosition(target);var mousePos=this.mouseCoords(ev);return{x:mousePos.x-docPos.x,y:mousePos.y-docPos.y};}catch(err){microstrategy.errors.log(err);return false;}};mstrIPhoneGridVisPropsEditorImpl.prototype.makeDraggable=function(item){try{if(!item){return ;}item.onmousedown=new Function("e",this.verifiedPath+" { return "+this.path+".onmousedown(e); }");item.style.cursor="move";}catch(err){microstrategy.errors.log(err);return false;}};mstrIPhoneGridVisPropsEditorImpl.prototype.findDropTargetRow=function(y){try{var rows=this.table.tBodies[0].rows;for(var i=0;i<rows.length;i++){var row=rows[i];var nodrop=row.getAttribute("NoDrop");if(nodrop==null||nodrop=="undefined"){var rowY=this.getPosition(row).y;var rowHeight=parseInt(row.offsetHeight)/2;if(row.offsetHeight==0){rowY=this.getPosition(row.firstChild).y;rowHeight=parseInt(row.firstChild.offsetHeight)/2;}if((y>rowY-rowHeight)&&(y<(rowY+rowHeight))){return row;}}}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrIPhoneGridVisPropsEditorImpl.prototype.validateColumns=function(){try{var rows=this.table.tBodies[0].rows,type,arCheck=microstrategy.findChildWithAtt(this.elem,"input","id","ar"),arChecked=!!arCheck&&arCheck.checked,sum=0,emptyW=null,allEmpty=true,onePlusEmpty=false,wFields=[],prevColHeader=false,emptyCol=false;for(var i=0;i<rows.length;i++){var row=rows[i];if(row.getAttribute("ignore")=="true"){emptyCol=prevColHeader?true:emptyCol;}else{if(row.getAttribute("iscol")=="true"){emptyCol=prevColHeader?true:emptyCol;prevColHeader=true;type=null;if(!arChecked){var field=microstrategy.findChildWithAtt(row,"input","id","iphoneWidthField"),w=field.value,valid=(new RegExp("^[0-9]+(\\"+mstr.Settings.Locale.DECIMALSEP+"[0-9]+)?$")).test(trim(w));w=microstrategy.number.toString(w);wFields[wFields.length]=field;if(w==""){if(!emptyW){emptyW=field;}else{onePlusEmpty=true;}}else{allEmpty=false;}if(valid){sum+=parseFloat(w);}else{if(w!=""){return microstrategy.descriptors.getDescriptor("7732");}}}}else{if(!this.isRowHidden(row)){prevColHeader=false;if(type==null){type=row.getAttribute("tp");}else{if(type!=row.getAttribute("tp")){return microstrategy.descriptors.getDescriptor("7567");}}}}}}if(emptyCol){return microstrategy.descriptors.getDescriptor("7762");}if(!onePlusEmpty&&emptyW&&sum<100){emptyW.value=100-sum;}else{if(allEmpty){var v=Math.round(10000/wFields.length)/100;for(var i in wFields){wFields[i].value=v;}}else{if(!arChecked&&((sum!=100||onePlusEmpty)||(sum==100&&emptyW))){return microstrategy.descriptors.getDescriptor("7733");}}}return true;}catch(err){microstrategy.errors.log(err);}};mstrIPhoneGridVisPropsEditorImpl.prototype.getColsXML=function(){try{var colsXml="<cr>";var TBODY=this.table.getElementsByTagName("TBODY");var rows=TBODY[0].getElementsByTagName("TR");for(var i=0;i<this.table.rows.length;i++){var curRow=rows[i];if(curRow.getAttribute("iscol")=="true"){if(i>0){colsXml+="</col>";}var showTitle=microstrategy.findChildrenWithAtt(curRow,"input","name","sh")[0].checked?"1":"0",w=microstrategy.findChildWithAtt(curRow,"input","id","iphoneWidthField").value;colsXml+=this.getColRowXML(showTitle,microstrategy.number.toString(w));}else{if(curRow.getAttribute("ignore")=="true"){}else{var id=curRow.getAttribute("id");var aid=curRow.getAttribute("aid");var tp=curRow.getAttribute("tp");var ad=curRow.getAttribute("ad");var fix=curRow.getAttribute("fix");var mix=curRow.getAttribute("mix");if(!this.isRowHidden(curRow)){colsXml+=this.getElemRowXML(id,aid,tp,ad,fix,mix);}}}}colsXml+="</col>";colsXml+="</cr>";return colsXml;}catch(err){microstrategy.errors.log(err);}};mstrIPhoneGridVisPropsEditorImpl.prototype.isRowHidden=function(curRow){return curRow.getAttribute("fa")=="1"&&document.getElementById("gr")&&document.getElementById("gr").checked;};mstrIPhoneGridVisPropsEditorImpl.prototype.getColRowXML=function(showTitle,width){return'<col st="'+showTitle+'" w="'+width+'">';};mstrIPhoneGridVisPropsEditorImpl.prototype.getElemRowXML=function(id,aid,tp,ad,fix,mix){if(aid){return'<oi id="'+id+'" aid="'+aid+'" tp="'+tp+'" fix="'+fix+'" ad="'+ad+'"/>';}else{return'<oi id="'+id+'" tp="'+tp+'" mix ="'+mix+'"/>';}};mstrIPhoneGridVisPropsEditorImpl.prototype.addColumn=function(hiddenColRowId){try{var myTbody=this.table.getElementsByTagName("TBODY")[0];var rows=myTbody.getElementsByTagName("TR");var lastColRow;for(var i=0;i<this.table.rows.length;i++){var curRow=rows[i];if(curRow.getAttribute("iscol")=="true"){lastColRow=curRow;}}var lastWidthField=microstrategy.findChildWithAtt(lastColRow,"input","id","iphoneWidthField"),nuWVal=Math.round(100*(microstrategy.number.toString(lastWidthField.value)/2))/100;lastWidthField.value=microstrategy.number.toLocaleString(Math.round(100*(microstrategy.number.toString(lastWidthField.value)-nuWVal))/100);var newColIndex=(parseInt(lastColRow.getAttribute("colindex"))+1);var newRow=getElementById(hiddenColRowId).cloneNode(true);newRow.id=newRow.id.replace(/##/g,newColIndex);newRow.setAttribute("colindex",newColIndex);newRow.firstChild.innerHTML=newRow.firstChild.innerHTML.replace(/##/g,newColIndex);microstrategy.findChildWithAtt(newRow,"input","id","iphoneWidthField").value=microstrategy.number.toLocaleString(nuWVal);myTbody.insertBefore(newRow,curRow);}catch(err){microstrategy.errors.log(err);}};mstrIPhoneGridVisPropsEditorImpl.prototype.removeRow=function(row){try{var ri=row.rowIndex,rows=row.parentNode.rows,oldVal=parseFloat(microstrategy.number.toString(microstrategy.findChildWithAtt(rows[row.rowIndex],"input","id","iphoneWidthField").value));row.parentNode.deleteRow(ri);for(var i=ri;i>0;i--){var curRow=rows[i];if(curRow.getAttribute("iscol")=="true"){var wf=microstrategy.findChildWithAtt(curRow,"input","id","iphoneWidthField"),val=Math.round(100*(parseFloat(microstrategy.number.toString(wf.value))+oldVal))/100;wf.value=isNaN(val)?"":microstrategy.number.toLocaleString(val);return ;}}}catch(err){microstrategy.errors.log(err);}};mstrIPhoneGridVisPropsEditorImpl.prototype.showWidths=function(check){var bc=this.elem.className.replace(" noWidths","");this.elem.className=check.checked?bc+" noWidths":bc;};mstrIPhoneGridVisPropsEditorImpl.prototype.updateGrouping=function updateGrouping(){this.changeFirstAttr();this.changeDefaultActionForm();this.updateGroupingOptions();};mstrIPhoneGridVisPropsEditorImpl.prototype.updateGroupingOptions=function(){var gr=document.getElementById("gr");if(!gr){return ;}var gOpts=document.getElementById("groupingOpts");if(!gOpts){return ;}gOpts.className=(gr.checked)?"iphone-grid":"iphone-grid iphone-grid-disabled";};mstrIPhoneGridVisPropsEditorImpl.prototype.changeFirstAttr=function(){var gr=document.getElementById("gr");if(!gr){return ;}var TBODY=this.table.getElementsByTagName("TBODY");var rows=TBODY[0].getElementsByTagName("TR");for(var i=0;i<this.table.rows.length;i++){var curRow=rows[i];var firstAttributeForm=microstrategy.findChildWithAtt(curRow,"TR","fa","1");if(firstAttributeForm){if(gr.checked==false){firstAttributeForm.className=firstAttributeForm.className.replace(" hide","");}else{firstAttributeForm.className=firstAttributeForm.className+" hide";}}}};mstrIPhoneGridVisPropsEditorImpl.prototype.changeDefaultActionForm=function(){var gr=document.getElementById("gr");if(!gr){return ;}var daf=document.getElementById("daf");if(!daf){return ;}if(gr.checked){for(var i=0;i<daf.length;i++){var elements=daf[i].value.split(":");if(elements[2]=="0"){daf.options[i]=null;}}}else{var isFirstOnList=false;for(var i=0;i<daf.length;i++){var elements=daf[i].value.split(":");if(elements[2]=="0"){isFirstOnList=true;break;}}if(!isFirstOnList){var length=daf.length;for(var i=0;i<this.firstAttributeForms.length;i++){var optn=document.createElement("OPTION");optn.text=this.firstAttributeForms[i].text;optn.value=this.firstAttributeForms[i].value;daf.options.add(optn);}}}};function mstrIPhoneGridVisPropsEditorImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);this.id=id;this.inherits=null;this.path="microstrategy.bone('"+id+"')";return this;}