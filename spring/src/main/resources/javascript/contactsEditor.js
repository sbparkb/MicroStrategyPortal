mstrContactsEditorImplScript=true;mstrContactsEditorImpl.prototype=new mstrEditorImpl();mstrContactsEditorImpl.prototype.searchBox=null;mstrContactsEditorImpl.prototype.addressName=null;mstrContactsEditorImpl.prototype.addressValue=null;mstrContactsEditorImpl.prototype.device=null;mstrContactsEditorImpl.prototype.searchBtn=null;mstrContactsEditorImpl.prototype.addToRecipientsBtn=null;mstrContactsEditorImpl.prototype.onload=function(){try{this.initializing=true;this.initEditor();this.initializing=false;this.searchBox=microstrategy.findChildWithAtt(this.elem,"input","id","searchName");this.searchBtn=microstrategy.findChildWithAtt(this.elem,"input","id","cartSearchButton");this.addressName=document.getElementById("addressName");this.addressValue=document.getElementById("addressValue");this.device=document.getElementById("device");this.addToRecipientsBtn=document.getElementById("addToRecipientsBtn");if(this.elem){this.elem.onkeydown=new Function("e","return microstrategy.bone('"+this.id+"').onKeyDown(e);");}if(this.searchBtn){this.searchBtn.onclick=new Function("e","return microstrategy.bone('"+this.id+"').onsearch(e);");}if(this.addToRecipientsBtn){this.addToRecipientsBtn.onclick=new Function("e","return microstrategy.bone('"+this.id+"').onAddToRecipients(e);");}}catch(err){microstrategy.errors.log(err);return false;}};mstrContactsEditorImpl.prototype.getCartBone=function(){try{return microstrategy.bone(this.id+"_cart");}catch(err){microstrategy.errors.log(err);return null;}};mstrContactsEditorImpl.prototype.onKeyDown=function(e){try{if(!e){e=window.event;}if(e.keyCode==13){var src=getEventTarget(e);if(src==this.searchBox&&this.onsearch){this.onsearch();}if((src==this.addressName||src==this.addressValue)&&this.onsearch){this.onAddToRecipients();}if(bIsIE4){stopEventBubbling(e);}return false;}}catch(err){microstrategy.errors.log(err);return false;}};mstrContactsEditorImpl.prototype.onsearch=function(e){try{if(this.searchBox){this.updateSelections();if(!this.searchBox.value){this.searchBox.value="";}this.searchBox.value=trim(this.searchBox.value);var um=microstrategy.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.CONTACT_BROWSER_SET_SEARCH,this.beanPath,["100001"],[this.searchBox.value],[],null)]);um.useIframe=(this.useIframe!=false);um.flushAndSubmitChanges(false,{noRefresh:true});return false;}}catch(err){microstrategy.errors.log(err);return false;}};mstrContactsEditorImpl.prototype.onAddNewPersonalRecipient=function(e,emailDestinationType){try{var el=document.getElementById(this.newAddrSecId);el=el||this.elem;if(!mstrEditorImpl.validateInputs(el,true)){return false;}this.updateSelections();var addressName=this.addressName.value;var addressValue=this.addressValue.value;var addressDevice=this.device.options[this.device.selectedIndex].value;var um=microstrategy.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.CONTACT_BROWSER_ADD_NEW_PERSONAL_RECIPIENT,this.beanPath,["106002","106003","106004","106005"],[addressName,addressValue,addressDevice,emailDestinationType],[],null)]);um.useIframe=(this.useIframe!=false);um.flushAndSubmitChanges(false,{noRefresh:true});return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrContactsEditorImpl.prototype.onAddToRecipients=function(e){return this.onAddNewPersonalRecipient(e,"1");};mstrContactsEditorImpl.prototype.getSelectedListType=function(listId){switch(listId){case"recipientsListTo":return"1";case"recipientsListCc":return"2";case"recipientsListBcc":return"4";}return"";};mstrContactsEditorImpl.prototype.updateSelections=function(){try{var cart=this.getCartBone();var selections="";if(cart){var selectedLists=cart.getSelectedListArray();if(selectedLists&&selectedLists.length>0){for(var i=0;i<selectedLists.length;i++){var selection=cart.getElementsFromList(selectedLists[i]);selections+=this.updateSelection(selection,this.getSelectedListType(selectedLists[i].id))+"!";}}if(selections.length>0){selections=selections.substr(0,selections.length-1);}var displayMode=cart.getDisplayMode();var um=microstrategy.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.CONTACT_BROWSER_UPDATE_SELECTIONS,this.beanPath,["106001"],[selections],[],null)]);um.replaceURL("displayMode",displayMode);}}catch(err){microstrategy.errors.log(err);return false;}};mstrContactsEditorImpl.prototype.onIncrementalFetch=function(eventID){try{if(!eventID){return ;}if(eventID==mstrUpdateManager.CONTACT_BROWSER_SET_INCREMENTAL_FETCH){this.updateSelections();}}catch(err){microstrategy.errors.log(err);return false;}};mstrContactsEditorImpl.prototype.updateSelection=function(strList,destType){try{var selection="";if(strList.length>0){selection=destType+"|~"+strList;}return selection;}catch(err){microstrategy.errors.log(err);return false;}};mstrContactsEditorImpl.prototype.validateSelections=function(){var cart=this.getCartBone();if(cart){if(cart.atLeastOneSelectionRequired){var selectedLists=cart.getSelectedListArray();if(selectedLists&&selectedLists.length>0){var selections=cart.getElementsFromList(selectedLists[0]);if(selections==null||selections.length==0){showMessage({contents:microstrategy.descriptors.getDescriptor("5865"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_ERROR});return false;}}}}return true;};mstrContactsEditorImpl.prototype.processApply=function(){if(!this.validateSelections()){return false;}this.updateSelections();this.close();this.saveSelections();return false;};mstrContactsEditorImpl.prototype.saveSelections=function(){try{var um=microstrategy.updateManager;um.useIframe=(this.useIframe!=false);um.add([um.createActionObject(null,mstrUpdateManager.CONTACT_BROWSER_SAVE_SELECTIONS,this.beanPath,[],[],[],null)]);um.flushAndSubmitChanges(false,{noRefresh:true});}catch(err){microstrategy.errors.log(err);return false;}};function mstrContactsEditorImpl(id){this.inherits=mstrEditorImpl;this.inherits(id);delete this.inherits;return this;}