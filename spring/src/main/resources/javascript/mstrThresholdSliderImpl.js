mstrThresholdSliderImplScript=true;mstrThresholdSliderImpl.prototype=new mstrBoneImpl();mstrThresholdSliderImpl.prototype.containers=null;mstrThresholdSliderImpl.prototype.currentContainerKey="";mstrThresholdSliderImpl.prototype.selectedType="";mstrThresholdSliderImpl.prototype.showLabels=false;mstrThresholdSliderImpl.prototype.autoApply=false;mstrThresholdSliderImpl.prototype.isCondFormat=false;mstrThresholdSliderImpl.prototype.slider=null;mstrThresholdSliderImpl.prototype.preview=null;mstrThresholdSliderImpl.prototype.scaleDiv=null;mstrThresholdSliderImpl.prototype.complexMsg=null;mstrThresholdSliderImpl.prototype.formatObject=null;mstrThresholdSliderImpl.prototype.path="";mstrThresholdSliderImpl.prototype.verifiedPath="";mstrThresholdSliderImpl.prototype.sliderPrecision=0;mstrThresholdSliderImpl.prototype.sliderGap=1;mstrThresholdSliderImpl.prototype.blockRisingPreviews=false;mstrThresholdSliderImpl.prototype.commands=null;mstrThresholdSliderImpl.prototype.observer=null;mstrThresholdSliderImpl.prototype.selections=null;mstrThresholdSliderImpl.prototype.currentSplitter=null;mstrThresholdSliderImpl.prototype.currentLabel=null;mstrThresholdSliderImpl.prototype.slideDisplay=null;mstrThresholdSliderImpl.prototype.slideInfo=null;mstrThresholdSliderImpl.prototype.editBox=null;mstrThresholdSliderImpl.prototype.editBoxInput=null;mstrThresholdSliderImpl.prototype.decimalSep=null;mstrThresholdSliderImpl.MINUS_INFINITY="-Infinity";mstrThresholdSliderImpl.INFINITY="Infinity";mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY=100;mstrThresholdSliderImpl.LH_BOUNDARY=501;mstrThresholdSliderImpl.LABEL_BASE_ZINDEX=1;mstrThresholdSliderImpl.PREVIEW_STATUS_NONE=0;mstrThresholdSliderImpl.PREVIEW_STATUS_RISING=1;mstrThresholdSliderImpl.PREVIEW_STATUS_FULL=2;mstrThresholdSliderImpl.PREVIEW_STATUS_FALLING=3;mstrThresholdSliderImpl.prototype.showDelayTimer=null;mstrThresholdSliderImpl.prototype.hideDelayTimer=null;mstrThresholdSliderImpl.SHOW_DELAY_TIME=400;mstrThresholdSliderImpl.HIDE_DELAY_TIME=400;mstrThresholdSliderImpl.QUICK_SYMBOLS=["","l","n","t","u","S","]","|","z","heavyCheck.gif","heavyBallot.gif"];mstrThresholdSliderImpl.QUICK_SYMBOLS_FOR_FIREFOX={0:"",1:"\u25cf",2:"\u25a0",3:"\u2666",4:"\u25c6",5:"\u2756",6:"\u2638",7:"\u273f",8:"\u2318",9:"heavyCheck.gif",10:"heavyBallot.gif",29:"\u21e8",30:"\u21e7",31:"\u21e9"};var thesholdTimer=null;mstrThresholdSliderImpl.prototype.onload=function(){try{mstrBoneImpl.prototype.onload.call(this);this.verifiedPath=microstrategy.getEventHandlerString(this.path);this.observer=new mstrObserverImpl();this.selections=new mstrThresholdSelectionsImpl();this.selections.parentBone=this;if(!document.getElementById(this.id+"_sliderBar")){var d=document.createElement("div");d.className="sliderBar";var sliderDiv=document.createElement("div");sliderDiv.style.position="relative";sliderDiv.setAttribute("id",this.id+"_sliderBar");d.appendChild(sliderDiv);this.elem.appendChild(d);}this.slider=document.getElementById(this.id+"_sliderBar");if(!document.getElementById(this.id+"_preview")){var d=document.createElement("div");d.className="sliderPreview";d.setAttribute("id",this.id+"_preview");this.elem.appendChild(d);}this.preview=document.getElementById(this.id+"_preview");if(!document.getElementById(this.id+"_scale")){var d=document.createElement("div");d.className="sliderScale";d.setAttribute("id",this.id+"_scale");this.elem.appendChild(d);}this.scaleDiv=document.getElementById(this.id+"_scale");this.complexMsg=document.getElementById(this.parentBone.id+"_complexMsg");this.interpolateThresholds();this.render();thresholdTimer=window.setInterval(this.verifiedPath+" { "+this.path+".moveRangePreviews(); } else { window.clearInterval(thresholdTimer); }",40);this.decimalSep=mstr.Settings.Locale.DECIMALSEP;}catch(err){microstrategy.errors.log(err);return false;}};mstrThresholdSliderImpl.prototype.onunload=function(e){try{window.clearInterval(thresholdTimer);mstrBoneImpl.prototype.onunload.call(this);}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.ondblclick=function(value){try{if(!value||value.length==0){return ;}var container=this.containers[this.currentContainerKey];if(!container||container.isOnStarting){return ;}var rangeValues=value.split("|");var t=this.getThresholdByValues(parseFloat(rangeValues[0]),parseFloat(rangeValues[1]));if(t){microstrategy.updateManager.addURL("currentRange="+value+"&appliesToID="+this.parentBone.id);this.parentBone.setCurrentRangeBoundaries(value);if(this.selectedType>-1){microstrategy.updateManager.addURL("&selectedTypes=obj."+this.selectedType);}this.parentBone.saveChanges();toggleShowBean("thresholdsFormatEditor",true,"");}}catch(err){microstrategy.errors.log(err);return false;}};mstrThresholdSliderImpl.prototype.onTextEditKeyPress=function(e){try{e=e||window.event;if(e.keyCode==13){var src=getEventTarget(e);var type=this.containers[this.currentContainerKey].thresholdType;if(mstrThresholdSliderImpl.isValidInput(src.value,type,this.decimalSep)){this.saveTextEdit(parseFloat(microstrategy.number.toString(src.value)),false);}else{mstrThresholdSliderImpl.showErrorMessage(type);}if(bIsIE4){e.cancelBubble=true;}return false;}else{if(e.keyCode==27){this.selections.clear();}else{if(e.keyCode>32&&isNaN(String.fromCharCode(e.keyCode))){}}}}catch(err){microstrategy.errors.log(err);}return true;};mstrThresholdSliderImpl.prototype.onTextEditKeyUp=function(e){try{e=e||window.event;var src=getEventTarget(e);var type=this.containers[this.currentContainerKey].thresholdType;if(!src.value){src.style.color="#000000";}else{if(!mstrThresholdSliderImpl.isValidInput(src.value,type,this.decimalSep)){src.style.color="#ff0000";}else{src.style.color="#000000";}}}catch(err){microstrategy.errors.log(err);}return true;};mstrThresholdSliderImpl.prototype.onhandleclick=function(e){try{e=e||window.event;if(this.editBox&&this.editBox.isEditing){this.cancelTextEdit();}this.selections.clear();var src=getEventTarget(e);if(src.className=="pointer"){src=src.nextSibling;}this.currentSplitter=src;getMouse(e);this.slideInfo={x:lMouseX,ro:null,floor:0,ceil:0,bo:null};if(typeof (mstr)!="undefined"){this.attachWinListener(this,"mousemove","startSlide");this.attachWinListener(this,"mouseup","selectSplitter");}else{document.onmousemove=new Function("e",this.verifiedPath+" { return  "+this.path+".startSlide(e); }");document.onmouseup=new Function("e",this.verifiedPath+" { return  "+this.path+".selectSplitter(e); }");}}catch(err){microstrategy.errors.log(err);}return false;};mstrThresholdSliderImpl.prototype.startSlide=function(e){try{this.blockRisingPreviews=true;if(!this.slideDisplay){var d=document.createElement("div");d.className="sliderDisplay";var img=document.createElement("img");img.src="../images/1ptrans.gif";img.alt="";img.className="handle";d.appendChild(img);var span=document.createElement("span");span.className="label";span.appendChild(document.createTextNode(this.currentSplitter.getAttribute("v")));d.appendChild(span);this.slideDisplay=this.elem.appendChild(d);}this.slideDisplay.style.display="block";this.observer.notifyAll("onselectionchange",null);this.slideInfo.ro=this.getRangeObject(this.containers[this.currentContainerKey]);this.slideInfo.bo=this.getBoundaryObject(this.slideInfo.ro);if(typeof (mstr)!="undefined"){this.attachWinListener(this,"mousemove","slide");this.attachWinListener(this,"mouseup","stopSlide");}else{document.onmousemove=new Function("e",this.verifiedPath+" { return  "+this.path+".slide(e); }");document.onmouseup=new Function("e",this.verifiedPath+" { return  "+this.path+".stopSlide(e); }");}this.slide(e);}catch(err){microstrategy.errors.log(err);}return false;};mstrThresholdSliderImpl.prototype.slide=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}this.slideDisplay.lastChild.innerHTML=microstrategy.number.toLocaleString(this.getNewSliderValue(e))+this.slideInfo.ro.valueSuffix;this.slideDisplay.style.left=this.getNewMousePosition(e)+"px";}catch(err){microstrategy.errors.log(err);}return false;};mstrThresholdSliderImpl.prototype.stopSlide=function(e){try{if(e&&e.e){e=e.e;}if(typeof (mstr)!="undefined"){this.detachWinListener(this,"mousemove");this.detachWinListener(this,"mouseup");}else{document.onmousemove=null;document.onmouseup=null;}this.slideDisplay.style.display="none";this.saveTextEdit(this.getNewSliderValue(e),true);this.blockRisingPreviews=false;}catch(err){microstrategy.errors.log(err);}return false;};mstrThresholdSliderImpl.prototype.getNewSliderValue=function(e){try{var x=this.getNewMousePosition(e);var portion=x/getObjWidth(this.slider);var ro=this.slideInfo.ro;var __result=0;__result=this.computeValueByPos(portion,ro);return Math.min(Math.max(Math.round(__result.toPrecision(15)),this.slideInfo.bo.floorValue),this.slideInfo.bo.ceilValue);}catch(err){microstrategy.errors.log(err);}return -1;};mstrThresholdSliderImpl.prototype.getNewMousePosition=function(e){try{e=e||window.event;getMouse(e);return Math.min(Math.max(lMouseX-getObjSumLeft(this.slider),this.slideInfo.bo.floor),this.slideInfo.bo.ceil);}catch(err){microstrategy.errors.log(err);}return -1;};mstrThresholdSliderImpl.prototype.selectValueLabel=function(e){try{var src=getEventTarget(e);if(src){this.currentLabel=src;this.currentSplitter=src.previousSibling;this.selectSplitter(e);}}catch(err){microstrategy.errors.log(err);}return false;};mstrThresholdSliderImpl.prototype.selectSplitter=function(e){try{if(e&&e.e){e=e.e;}if(typeof (mstr)!="undefined"){this.detachWinListener(this,"mousemove");this.detachWinListener(this,"mouseup");}else{document.onmousemove=null;document.onmouseup=null;}this.selections.add(this.currentSplitter);if(!this.editBox){var inputDiv=document.createElement("div");inputDiv.className="editThresh";inputDiv.innerHTML=microstrategy.descriptors.getDescriptor("5901");var inputBox=document.createElement("input");inputBox.type="text";inputDiv.appendChild(inputBox);inputBox.onkeydown=new Function("e",this.verifiedPath+" { return "+this.path+".onTextEditKeyPress(e); }");inputBox.onkeyup=new Function("e",this.verifiedPath+" { return "+this.path+".onTextEditKeyUp(e); }");this.editBoxInput=inputBox;var img=document.createElement("img");img.src="../images/1ptrans.gif";img.className="mstrIcon-ls mstrIconApply";img.style.cursor="pointer";inputDiv.appendChild(img);img.onclick=new Function(this.verifiedPath+" { return "+this.path+".applyTextEdit(this.previousSibling.value); }");var cloneImg=img.cloneNode(true);cloneImg.className="mstrIcon-ls mstrIconCancel";inputDiv.appendChild(cloneImg);cloneImg.onclick=new Function(this.verifiedPath+" { return "+this.path+".cancelTextEdit(); }");this.editBox=this.elem.appendChild(inputDiv);}this.editBox.style.display="";this.currentLabel=this.currentSplitter.nextSibling;this.currentLabel.style.display="inline";this.editBoxInput.value=parseFloat(this.currentLabel.innerHTML);this.editBox.isEditing=true;var p=parseInt(this.slider.parentNode.parentNode.style.padding);var offset=(bIsIE6&&!bIsIE7)?0:p+1;var normalLeft=getObjSumLeft(this.currentLabel)-getObjSumLeft(this.slider)+offset+p-getObjWidth(this.editBox)/2;var minLeft=offset-p-1;var maxLeft=getObjWidth(this.slider)+offset+p-getObjWidth(this.editBox);this.editBox.style.top=(getObjSumTop(this.currentLabel)-getObjSumTop(this.slider)+p+1)+"px";this.editBox.style.left=Math.min(Math.max(minLeft,normalLeft),maxLeft)+"px";this.currentLabel.style.display="none";microstrategy.setCursorToEnd(this.editBoxInput);var d=microstrategy.findAncestorWithAtt(this.currentSplitter,"at");if(d){var currentToolbar=d.appliesTo;var spans=this.preview.getElementsByTagName("span");for(var i=0;i<spans.length;i++){var s=spans[i];if(s==currentToolbar){s.status=mstrThresholdSliderImpl.PREVIEW_STATUS_FULL;s.style.top=-s.offsetHeight+"px";}else{s.status=mstrThresholdSliderImpl.PREVIEW_STATUS_NONE;s.style.top="0px";}}}}catch(err){if(err.number!=-2146827682){microstrategy.errors.log(err);}}return false;};mstrThresholdSliderImpl.prototype.saveTextEdit=function(value,force){try{var container=this.containers[this.currentContainerKey];container.isOnStarting=false;var fmtBtns=microstrategy.findChildrenWithAtt(this.preview,"IMG","name","fmtBtn");for(var i in fmtBtns){fmtBtns[i].className="formatBtn";}if(this.editBox){this.editBox.style.display="none";if(this.currentLabel){this.currentLabel.style.display="inline";}if(!force&&this.editBox.isEditing!=true){return ;}this.editBox.isEditing=false;}if(value===""||isNaN(value)){return ;}var oldValue=parseFloat(this.currentSplitter.getAttribute("v"));if(oldValue==value){return ;}var bo=this.getBoundaryObject(this.getRangeObject(container));var boFloor=(bo.floorValue==mstrThresholdSliderImpl.MINUS_INFINITY)?bo.floorValue:bo.floorValue+this.sliderGap;var boCeiling=(bo.ceilValue==mstrThresholdSliderImpl.INFINITY)?bo.ceilValue:bo.ceilValue-this.sliderGap;value=Math.min(Math.max(value,boFloor),boCeiling);var thresholds=container.thresholds;for(var i=0;i<thresholds.length;i++){var t=thresholds[i];if(t.ceil==oldValue){t.ceil=value;if(thresholds.length>i+1&&thresholds[i+1].floor==oldValue){thresholds[i+1].floor=value;}break;}else{if(t.floor==oldValue){t.floor=value;break;}}}this.render();if(this.autoApply){this.parentBone.applyChanges();}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.applyTextEdit=function(value){try{var type=this.containers[this.currentContainerKey].thresholdType;if(mstrThresholdSliderImpl.isValidInput(value,type,this.decimalSep)){this.saveTextEdit(parseFloat(microstrategy.number.toString(value)),false);}else{mstrThresholdSliderImpl.showErrorMessage(type);}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.cancelTextEdit=function(){try{if(this.editBox){this.editBox.style.display="none";if(this.currentLabel){this.currentLabel.style.display="inline";}this.editBox.isEditing=false;this.editBoxInput.style.color="#000000";}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.setCurrentContainerKey=function(k){try{this.currentContainerKey=k;this.render();}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.render=function(){try{this.clearOldElements();var container=this.containers[this.currentContainerKey];if(container.thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_COMPLEX){this.slider.parentNode.style.display="none";this.preview.style.display="none";this.scaleDiv.style.display="none";this.complexMsg.style.display="block";}else{this.slider.parentNode.style.display="block";this.preview.style.display="block";this.scaleDiv.style.display="block";this.complexMsg.style.display="none";this.renderScale(container);if(container.thresholds.length==0){this.renderStartPoint(container);}else{this.renderSlider(container);}}}catch(err){microstrategy.errors.log(err);return false;}};mstrThresholdSliderImpl.prototype.renderScale=function(container){try{switch(container.thresholdType){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:this.buildOneScale(0,"0%");this.buildOneScale(1,"100%");break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:this.buildOneScale(0,"0");this.buildOneScale(0.25,"10");this.buildOneScale(0.5,"20");this.buildOneScale(0.75,"100");this.buildOneScale(1,"500");break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:this.buildOneScale(0,"-&#8734;");this.buildOneScale(1,"+&#8734;");break;}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.buildOneScale=function(pos,value){try{var sliderWidth=getObjWidth(this.scaleDiv);var scaleSpan=document.createElement("span");scaleSpan.innerHTML=value;scaleSpan.style.left=sliderWidth*pos-15+"px";this.scaleDiv.appendChild(scaleSpan);}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.renderSlider=function(container){try{var ro=this.getRangeObject(container);var rangeFloor=ro.metricFloor;this.formatObject=this.formatObject||mstrFormatObject;if(container.thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE||container.thresholds.length==0){this.buildEmptyRange(ro,rangeFloor,ro.metricCeiling);return ;}for(var i=0;i<container.thresholds.length;i++){var thresh=container.thresholds[i];if(rangeFloor<thresh.floor){ro.showLabel=this.getShowLabelForThreshold(false);this.buildEmptyRange(ro,rangeFloor,thresh.floor);}ro.appliesTo=thresh.id;ro.floor=thresh.floor;ro.ceiling=thresh.ceil;ro.formatting=thresh.formatting||container.defaultFormatting;ro.showLabel=this.getShowLabelForThreshold((i==container.thresholds.length-1&&(thresh.ceil==ro.metricCeiling||thresh.ceil==mstrThresholdSliderImpl.INFINITY)));this.buildRange(ro);rangeFloor=thresh.ceil;}if(ro.metricCeiling>rangeFloor){ro.showLabel=true;this.buildEmptyRange(ro,rangeFloor,ro.metricCeiling);}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.renderStartPoint=function(container){try{var startValue=50;if(container.thresholdType<0){container.thresholdType=mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT;}switch(container.thresholdType){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:startValue=50;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:startValue=20;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:startValue=0;break;}this.createThreshold(startValue);container.isOnStarting=true;this.renderSlider(container);this.currentSplitter=document.getElementById(this.id+"_handle");this.selectSplitter();}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.clearOldElements=function(){try{if(this.slider){this.slider.innerHTML="";}if(this.preview){this.preview.innerHTML="";}if(this.scaleDiv){this.scaleDiv.innerHTML="";}this.deleteStartPoint();this.selections.clear();if(this.editBox){this.editBox.style.display="none";}this.observer.notifyAll("onselectionchange",null);}catch(err){microstrategy.errors.log(err);return false;}};mstrThresholdSliderImpl.prototype.deleteStartPoint=function(){try{var container=this.containers[this.currentContainerKey];if(container&&container.isOnStarting){container.thresholds=[];}}catch(err){microstrategy.errors.log(err);return false;}};mstrThresholdSliderImpl.sortThresholds=function(a,b){try{if(a.floor==mstrThresholdSliderImpl.MINUS_INFINITY){return -1;}else{if(b.floor==mstrThresholdSliderImpl.MINUS_INFINITY){return 1;}else{return a.floor-b.floor;}}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.getShowLabelForThreshold=function(isLast){try{return(this.showLabels||(this.slider.childNodes&&this.slider.childNodes.length==1)||isLast);}catch(err){microstrategy.errors.log(err);return false;}};mstrThresholdSliderImpl.prototype.buildEmptyRange=function(ro,floor,ceiling){try{ro.appliesTo=this.getNewRangeId();ro.floor=floor;ro.ceiling=ceiling;ro.formatting=this.containers[this.currentContainerKey].defaultFormatting;this.buildRange(ro);}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.resolveObjSubType=function(){try{return(this.isCondFormat)?this.selectedType:microstrategy.SUBOBJTYPE_DOC_TEXT;}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.buildRange=function(ro){try{var appliesTo=ro.floor+"|"+ro.ceiling;var d=document.createElement("div");d.setAttribute(microstrategy.HTMLATTR_APPLIES_TO,appliesTo);d.style.left=ro.basePx+"px";var rangeSize=this.getRangeSize(ro);d.style.width=(rangeSize*100)+"%";var subType=this.resolveObjSubType();if(subType!=microstrategy.SUBOBJTYPE_DOC_LINE&&subType!=microstrategy.SUBOBJTYPE_DOC_IMAGE){var bc=document.createElement("span");bc.className="bgColor";bc.style.backgroundColor=this.resolveFormat(ro.formatting,"bc","backgroundColor");var gradientColor=this.resolveFormat(ro.formatting,"gradient","color");if(gradientColor!=null){bc.style.filter=gradientColor;}d.appendChild(bc);d.style.backgroundColor="transparent";}d.onmouseover=new Function("e",this.verifiedPath+" { return "+this.path+".onmouseoverSlider(e,this); }");d.onmouseout=new Function(this.verifiedPath+" { return "+this.path+".onmouseoutSlider(this); }");d.ondblclick=new Function(this.verifiedPath+" { return "+this.path+".ondblclick('"+appliesTo+"'); }");d.isMouseOver=false;var fc=document.createElement("span");fc.className="foreColor";if(subType==microstrategy.SUBOBJTYPE_DOC_TEXT){fc.style.backgroundColor=this.resolveFormat(ro.formatting,"fc","backgroundColor");d.appendChild(fc);}else{if(subType==microstrategy.SUBOBJTYPE_DOC_LINE||subType==microstrategy.SUBOBJTYPE_DOC_SHAPE){fc.style.backgroundColor=this.resolveFormat(ro.formatting,"lc","backgroundColor");d.appendChild(fc);}else{fc.style.backgroundColor="#000000";d.appendChild(fc);}}if(this.slider.childNodes&&this.slider.childNodes.length>0){var img=document.createElement("img");img.src="../images/1ptrans.gif";img.alt="";img.className="pointer";img.onmousedown=new Function("e",this.verifiedPath+" { return "+this.path+".onhandleclick(e); }");d.appendChild(img);var clonedImg=img.cloneNode(true);clonedImg.setAttribute("id",this.id+"_handle");clonedImg.className="handle";clonedImg.setAttribute("v",ro.floor);clonedImg.onmousedown=new Function("e",this.verifiedPath+" { return "+this.path+".onhandleclick(e); }");d.appendChild(clonedImg);var span=document.createElement("span");span.className="label";if(ro.showLabel){span.style.display="inline";span.style.zIndex=mstrThresholdSliderImpl.LABEL_BASE_ZINDEX;}else{span.style.zIndex=mstrThresholdSliderImpl.LABEL_BASE_ZINDEX+1;}span.appendChild(document.createTextNode(microstrategy.number.toLocaleString(Math.max(ro.lastRangeCeiling.toFixed(this.sliderPrecision),mstrThresholdSliderImpl.MINUS_INFINITY))+ro.valueSuffix));span.onmousedown=new Function("e",this.verifiedPath+" { return "+this.path+".selectValueLabel(e); }");d.appendChild(span);}this.slider.appendChild(d);ro.basePx+=rangeSize*ro.availableWidth;ro.lastRangeCeiling=ro.ceiling;var midPoint=Math.round(this.computeMidPoint(ro));midPoint=midPoint.toPrecision(15);this.buildRangePreview(d,ro.formatting,midPoint);}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.computeMidPoint=function(ro){try{var midPoint=0;switch(ro.thresholdType){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:if((ro.ceiling-ro.floor)==mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY){midPoint=50;}else{midPoint=ro.ceiling-((ro.ceiling-ro.floor)/2);}break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:if((ro.ceiling-ro.floor)==mstrThresholdSliderImpl.LH_BOUNDARY){midPoint=5;}else{var floorPos=this.computePosByValue(ro.floor,ro);var ceilPos=this.computePosByValue(ro.ceiling,ro);var midPos=floorPos+(ceilPos-floorPos)/2;midPoint=this.computeValueByPos(midPos,ro);}break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:if(ro.metricRange==mstrThresholdSliderImpl.INFINITY){midPoint=0;}else{if(ro.metricRange==0){if(ro.floor==mstrThresholdSliderImpl.MINUS_INFINITY){if(ro.ceiling==0){midPoint=-1000;}else{if(ro.ceiling>0){midPoint=ro.ceiling/4;}else{midPoint=ro.ceiling*4;}}}else{if(ro.ceiling==mstrThresholdSliderImpl.INFINITY){if(ro.floor==0){midPoint=1000;}else{if(ro.floor>0){midPoint=ro.floor*4;}else{midPoint=ro.floor/4;}}}}}else{if(ro.floor==mstrThresholdSliderImpl.MINUS_INFINITY){midPoint=ro.ceiling-ro.metricRange*0.2;}else{if(ro.ceiling==mstrThresholdSliderImpl.INFINITY){midPoint=ro.floor+ro.metricRange*0.2;}else{midPoint=ro.ceiling-((ro.ceiling-ro.floor)/2);}}}}break;}midPoint=parseFloat(midPoint.toFixed(this.sliderPrecision));return midPoint;}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.buildRangePreview=function(d,formatting,midPoint){try{var s=document.createElement("span");d.appliesTo=s;s.style.left=d.style.left;s.status=mstrThresholdSliderImpl.PREVIEW_STATUS_NONE;s.isMouseOver=false;s.className="sliderPreviewItem";s.onmouseover=new Function("this.isMouseOver = true;");s.onmouseout=new Function("this.isMouseOver = false;");var p=document.createElement("span");p.className="sliderPreviewText";p.style.padding="2px";p.style.paddingTop="0px";p.style.paddingBottom="0px";var subType=String(this.resolveObjSubType());switch(subType){case microstrategy.SUBOBJTYPE_DOC_SHAPE:case microstrategy.SUBOBJTYPE_DOC_LINE:p.style.border=this.resolveFormat(formatting,"ls","borderTopStyle")+" "+this.resolveFormat(formatting,"lc","borderTopColor");break;case microstrategy.SUBOBJTYPE_DOC_TEXT:p.style.backgroundColor=this.resolveFormat(formatting,"bc","backgroundColor");case microstrategy.SUBOBJTYPE_DOC_IMAGE:p.style.borderTop=this.resolveFormat(formatting,"bts","borderTopStyle")+" "+this.resolveFormat(formatting,"btc","borderTopColor");p.style.borderRight=this.resolveFormat(formatting,"brs","borderRightStyle")+" "+this.resolveFormat(formatting,"brc","borderRightColor");p.style.borderBottom=this.resolveFormat(formatting,"bbs","borderBottomStyle")+" "+this.resolveFormat(formatting,"bbc","borderBottomColor");p.style.borderLeft=this.resolveFormat(formatting,"bls","borderLeftStyle")+" "+this.resolveFormat(formatting,"blc","borderLeftColor");break;}if(subType==microstrategy.SUBOBJTYPE_DOC_TEXT){p.style.fontFamily=this.resolveFormat(formatting,"ff","fontFamily");p.style.fontSize=Math.min(parseInt(this.resolveFormat(formatting,"fsz","fontSize")),10)+"pt";p.style.fontWeight=this.resolveFormat(formatting,"fw","fontWeight");p.style.fontStyle=this.resolveFormat(formatting,"fit","fontStyle");p.style.color=this.resolveFormat(formatting,"fc","backgroundColor");p.style.textAlign=this.resolveFormat(formatting,"aln","textAlign");var td="";var u=this.resolveFormat(formatting,"fun","textDecoration");var t=this.resolveFormat(formatting,"fst","textDecoration2");if(u&&t){td=u+" "+t;}else{if(u){td=u;}else{if(t){td=t;}}}if(td){p.style.textDecoration=td;}var r=this.extractFormatValue(formatting,"type");if(r==mstrThresholdEditor.TEXT){p.appendChild(document.createTextNode(this.extractFormatValue(formatting,"src")));}else{if(r==mstrThresholdEditor.IMAGE){var img=document.createElement("img");img.src=this.extractFormatValue(formatting,"src");p.appendChild(img);}else{if(r==mstrThresholdEditor.QUICK_SYMBOL){if(bIsFirefox){p.appendChild(document.createTextNode(mstrThresholdSliderImpl.QUICK_SYMBOLS_FOR_FIREFOX[parseInt(this.extractFormatValue(formatting,"src"))]));}else{p.style.fontFamily="Wingdings";p.appendChild(document.createTextNode(mstrThresholdSliderImpl.QUICK_SYMBOLS[parseInt(this.extractFormatValue(formatting,"src"))]));}}else{p.appendChild(document.createTextNode("[1234.56]"));}}}}else{var i=document.createElement("img");i.src="../images/1ptrans.gif";i.alt="";i.style.width="14px";i.style.height="14px";p.appendChild(i);}s.appendChild(p);var appliesTo=d.getAttribute(microstrategy.HTMLATTR_APPLIES_TO);var img=document.createElement("img");img.src="../images/1ptrans.gif";img.alt="";img.className="formatBtn";img.title=microstrategy.descriptors.getDescriptor("1918");s.appendChild(img.cloneNode(true));s.lastChild.onclick=new Function(this.path+".ondblclick('"+appliesTo+"');");var container=this.containers[this.currentContainerKey];if(!container||container.isOnStarting){s.lastChild.className+=" disabled";s.lastChild.setAttribute("name","fmtBtn");}img.className="clearBtn";img.title=microstrategy.descriptors.getDescriptor("5976");s.appendChild(img.cloneNode(true));s.lastChild.onclick=new Function(this.path+".clearThresholdFormatting('"+appliesTo+"');");var m=this.containers[this.currentContainerKey];img.className="splitBtn";img.title=microstrategy.descriptors.getDescriptor("5977");s.appendChild(img.cloneNode(true));s.lastChild.onclick=new Function(this.path+".addThreshold("+m.thresholdType+", '"+m.basedOn+"', "+midPoint+");");img.className="deleteBtn";img.title=microstrategy.descriptors.getDescriptor("5553");s.appendChild(img.cloneNode(true));s.lastChild.onclick=new Function(this.path+".deleteThreshold('"+appliesTo+"');");this.preview.appendChild(s);var sp=getObjSumLeft(this.slider)+getObjWidth(this.slider);var pp=getObjSumLeft(s)+getObjWidth(s);if(pp>sp){s.style.left=parseInt(d.style.left)+(sp-pp)+"px";}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.resolveFormat=function(format,propName,htmlName){try{switch(propName){case"gradient":if(this.extractFormatValue(format,"pfs")==2){var startColor=this.formatObject.decodeValue("color",this.extractFormatValue(format,"bc"));var endColor=this.formatObject.decodeValue("color",this.extractFormatValue(format,"gc"));var angle=this.extractFormatValue(format,"pga");var xOffset=this.extractFormatValue(format,"pgxo");var yOffset=this.extractFormatValue(format,"pgyo");if((angle==0&&xOffset==100)||(angle==90&&yOffset==100)){var tmp=startColor;startColor=endColor;endColor=tmp;}return"progid:DXImageTransform.Microsoft.Gradient(GradientType="+((angle==0)?"1":"0")+", StartColorStr='"+startColor+"', EndColorStr='"+endColor+"') ";}else{return null;}case"bc":if(this.extractFormatValue(format,"pfs")==1){return"transparent";}default:return this.formatObject.decodeValue(htmlName,this.extractFormatValue(format,propName));}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.extractFormatValue=function(format,propName){try{if(propName=="type"||propName=="src"){return("rplc" in format&&propName in format.rplc)?format.rplc[propName]:this.containers[this.currentContainerKey].defaultFormatting.rplc[propName];}else{return(propName in format)?format[propName]:this.containers[this.currentContainerKey].defaultFormatting[propName];}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.getRangeSize=function(ro){try{return this.computePosByValue(ro.ceiling,ro)-this.computePosByValue(ro.floor,ro);}catch(err){microstrategy.errors.log(err);return 0;}};mstrThresholdSliderImpl.prototype.computePosByValue=function(value,ro){try{var pos=0;switch(ro.thresholdType){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:value=Math.max(0,Math.min(mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY,value));pos=value/ro.metricRange;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:value=Math.max(0,Math.min(mstrThresholdSliderImpl.LH_BOUNDARY,value));if(value>=0&&value<=20){pos=(value-0)/20*0.5;}else{if(value>20&&value<=mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY){pos=(value-20)/80*0.25+0.5;}else{if(value>100&&value<=mstrThresholdSliderImpl.LH_BOUNDARY){pos=(value-100)/400*0.25+0.75;}}}break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:if(value==mstrThresholdSliderImpl.INFINITY){pos=1;}else{if(value==mstrThresholdSliderImpl.MINUS_INFINITY){pos=0;}else{if(ro.metricRange==0){pos=0.5;}else{if(ro.floor==mstrThresholdSliderImpl.MINUS_INFINITY){pos=0.2;}else{if(ro.ceiling==mstrThresholdSliderImpl.INFINITY){pos=0.8;}else{pos=(value-ro.metricFloor)/ro.metricRange*0.6+0.2;}}}}}break;}return pos;}catch(err){microstrategy.errors.log(err);return 0;}};mstrThresholdSliderImpl.prototype.computeValueByPos=function(pos,ro){try{var value=0;pos=Math.max(0,Math.min(1,pos));switch(ro.thresholdType){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:value=pos*mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:if(pos>=0&&pos<=0.5){value=(pos-0)/0.5*20;}else{if(pos>0.5&&pos<=0.75){value=(pos-0.5)/0.25*80+mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY-80;}else{if(pos>0.75&&pos<=1){value=(pos-0.75)/0.25*400+(mstrThresholdSliderImpl.LH_BOUNDARY-400);}}}break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:if(ro.metricRange==0){if(pos>=0.5){value=ro.metricFloor+Math.pow(2,Math.round((pos-0.5)*120));}else{value=ro.metricFloor-Math.pow(2,Math.round((0.5-pos)*120));}}else{if(pos<0.2){value=ro.metricFloor-Math.pow(2,Math.round((0.2-pos)*120));}else{if(pos>0.8){value=ro.metricCeiling+Math.pow(2,Math.round((pos-0.8)*120));}else{value=(ro.metricRange*(pos-0.2)/0.6)+ro.metricFloor;}}}break;}return value;}catch(err){microstrategy.errors.log(err);return 0;}};mstrThresholdSliderImpl.prototype.getNewRangeId=function(){try{return"xxyyzz";}catch(err){microstrategy.errors.log(err);return"";}};mstrThresholdSliderImpl.prototype.getRangeObject=function(container){try{var ro={};ro.appliesTo="";ro.basePx=0;ro.floor=0;ro.ceiling=0;ro.formatting=null;ro.availableWidth=getObjWidth(this.slider);ro.thresholdType=container.thresholdType;ro.lastRangeCeiling=0;ro.showLabel=true;ro.valueSuffix=(ro.thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT||ro.thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT)?"%":"";this.getMetricBoundaries(container,ro);ro.metricRange=ro.metricCeiling-ro.metricFloor;if(ro.metricRange!=0){this.sliderPrecision=Math.min(Math.max(parseInt(Math.log(ro.availableWidth/ro.metricRange)),0),6);}else{this.sliderPrecision=6;}this.sliderGap=1/Math.pow(10,this.sliderPrecision);return ro;}catch(err){microstrategy.errors.log(err);return null;}};mstrThresholdSliderImpl.prototype.getMetricBoundaries=function(container,ro){try{if(!ro){ro={};}ro.metricFloor=0;ro.metricCeiling=0;switch(container.thresholdType){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:ro.metricCeiling=mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:ro.metricCeiling=mstrThresholdSliderImpl.LH_BOUNDARY;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:if(container.thresholds.length>0){ro.metricFloor=container.thresholds[0].ceil;ro.metricCeiling=container.thresholds[container.thresholds.length-1].floor;}else{ro.metricFloor=mstrThresholdSliderImpl.MINUS_INFINITY;ro.metricCeiling=mstrThresholdSliderImpl.INFINITY;}break;}return ro;}catch(err){microstrategy.errors.log(err);return null;}};mstrThresholdSliderImpl.prototype.getBoundaryObject=function(ro){try{var range=this.currentSplitter.parentNode;if(!range){this.currentSplitter=microstrategy.findChildWithAtt(this.slider,"IMG","v",this.currentSplitter.getAttribute("v"));range=this.currentSplitter.parentNode;}var bo={};var x=getObjSumLeft(this.slider);bo.floor=getObjSumLeft(range.previousSibling)-x;bo.ceil=getObjSumLeft(range)-x+getObjWidth(range);if(ro.thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE){bo.floorValue=(range.previousSibling&&range.previousSibling.childNodes.length>2)?parseFloat(range.previousSibling.childNodes[3].getAttribute("v")):mstrThresholdSliderImpl.MINUS_INFINITY;bo.ceilValue=(range.nextSibling)?parseFloat(range.nextSibling.childNodes[3].getAttribute("v")):mstrThresholdSliderImpl.INFINITY;}else{bo.floorValue=(range.previousSibling&&range.previousSibling.childNodes.length>2)?parseFloat(range.previousSibling.childNodes[3].getAttribute("v")):ro.metricFloor;bo.ceilValue=(range.nextSibling)?parseFloat(range.nextSibling.childNodes[3].getAttribute("v")):ro.metricCeiling;}return bo;}catch(err){microstrategy.errors.log(err);return null;}};mstrThresholdSliderImpl.prototype.onmouseoverSlider=function(e,d){try{if(!e){e=window.event;}var src=getEventTarget(e);var cn=src&&src.className;if(cn=="handle"||cn=="selectedhandle"||cn=="label"){return ;}d.isMouseOver=true;if(this.showDelayTimer!=null){window.clearTimeout(this.showDelayTimer);}this.showDelayTimer=window.setTimeout(function(){mstrThresholdSliderImpl.prototype.showRangePreview(d,true);},mstrThresholdSliderImpl.SHOW_DELAY_TIME);if(!this.showLabels){this.showRangeLabels(d,true);}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.onmouseoutSlider=function(d){try{d.isMouseOver=false;if(this.hideDelayTimer!=null){window.clearTimeout(this.hideDelayTimer);}this.hideDelayTimer=window.setTimeout(function(){mstrThresholdSliderImpl.prototype.showRangePreview(d,false);},mstrThresholdSliderImpl.HIDE_DELAY_TIME);if(!this.showLabels){this.showRangeLabels(d,false);}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.showRangePreview=function(d,showPreview){try{if(d){var preview=d.appliesTo;if(showPreview){if(d.isMouseOver&&preview.status!=mstrThresholdSliderImpl.PREVIEW_STATUS_FULL){preview.status=mstrThresholdSliderImpl.PREVIEW_STATUS_RISING;}}else{if(!preview.isMouseOver&&!d.isMouseOver&&preview.status!=mstrThresholdSliderImpl.PREVIEW_STATUS_NONE){preview.status=mstrThresholdSliderImpl.PREVIEW_STATUS_FALLING;}}}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.moveRangePreviews=function(){try{var isEditing=(this.editBox)?this.editBox.isEditing:false;if(isEditing){return ;}var spans=this.preview.getElementsByTagName("span");for(var i=0;i<spans.length;i++){var s=spans[i];if(s.status==mstrThresholdSliderImpl.PREVIEW_STATUS_NONE||s.status==mstrThresholdSliderImpl.PREVIEW_STATUS_FULL){continue;}var y=parseInt(s.style.top);if(isNaN(y)){y=0;}if(s.status==mstrThresholdSliderImpl.PREVIEW_STATUS_FALLING||this.blockRisingPreviews){y+=2;if(y>=0){y=0;s.status=mstrThresholdSliderImpl.PREVIEW_STATUS_NONE;}}else{y-=2;if(y<=-s.offsetHeight){y=-s.offsetHeight;s.status=mstrThresholdSliderImpl.PREVIEW_STATUS_FULL;}}s.style.top=y+"px";}}catch(err){microstrategy.errors.log(err);return ;}};mstrThresholdSliderImpl.prototype.showRangeLabels=function(div,show){try{if(this.showLabels||!div||!div.previousSibling||!div.nextSibling){return ;}var s1=null;s2=null;if(div.previousSibling.previousSibling&&div.lastChild.className=="label"){s1=div.lastChild;}if(div.nextSibling.nextSibling&&div.nextSibling.lastChild.className=="label"){s2=div.nextSibling.lastChild;}if(s1){s1.style.display=(show)?"inline":"none";}if(s2){s2.style.display=(show)?"inline":"none";}}catch(err){microstrategy.errors.log(err);return"";}};mstrThresholdSliderImpl.prototype.addThreshold=function(type,basedOn,value){try{var container=this.containers[this.currentContainerKey];container.thresholdType=(type>=0)?type:mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT;container.basedOn=basedOn;this.createThreshold(value);this.render();this.parentBone.syncProperties();if(this.autoApply){this.parentBone.applyChanges();}}catch(err){microstrategy.errors.log(err);return"";}};mstrThresholdSliderImpl.prototype.createThreshold=function(value){try{var container=this.containers[this.currentContainerKey];var type=container.thresholdType;var ro=this.getMetricBoundaries(container,null);var thresh={id:this.getNewRangeId(),name:microstrategy.descriptors.getDescriptor("4585"),formatting:this.getEmptyThresholdFormatting(),isInterpolate:false};if(!container.thresholds||container.thresholds.length==0){container.thresholds=new Array();thresh.floor=(type==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE)?mstrThresholdSliderImpl.MINUS_INFINITY:ro.metricFloor;thresh.ceil=value;container.thresholds.push(thresh);var rThresh={id:this.getNewRangeId(),name:microstrategy.descriptors.getDescriptor("4585"),formatting:this.getEmptyThresholdFormatting(),isInterpolate:false};rThresh.floor=value;rThresh.ceil=(type==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE)?mstrThresholdSliderImpl.INFINITY:ro.metricCeiling;container.thresholds.push(rThresh);}else{for(var i=0;i<container.thresholds.length;i++){var t=container.thresholds[i];if(t.ceil==mstrThresholdSliderImpl.INFINITY||value<=t.ceil){if(value==t.ceil){return null;}thresh.floor=t.floor;thresh.ceil=value;t.floor=value;t.isInterpolate=false;container.thresholds.splice(i,0,thresh);break;}}}return thresh;}catch(err){microstrategy.errors.log(err);return null;}};mstrThresholdSliderImpl.prototype.getThresholdByValues=function(floor,ceiling){try{if(this.currentContainerKey==null||this.currentContainerKey.length==0||!(this.currentContainerKey in this.containers)){return null;}var container=this.containers[this.currentContainerKey];if(!container.thresholds||container.thresholds.length==0){return null;}for(var i=0;i<container.thresholds.length;i++){var t=container.thresholds[i];if(t.floor==floor){return t;}}return this.createThreshold(ceiling);}catch(err){microstrategy.errors.log(err);return null;}};mstrThresholdSliderImpl.prototype.getEmptyThresholdFormatting=function(){try{return{rplc:{}};}catch(err){microstrategy.errors.log(err);return null;}};mstrThresholdSliderImpl.prototype.clearThresholdFormatting=function(value){try{if(!value||value.length==0){return ;}var rangeValues=value.split("|");var t=this.getThresholdByValues(parseFloat(rangeValues[0]),parseFloat(rangeValues[1]));if(t){t.formatting=this.getEmptyThresholdFormatting();this.render();if(this.autoApply){this.parentBone.applyChanges();}}}catch(err){microstrategy.errors.log(err);return"";}};mstrThresholdSliderImpl.prototype.deleteThreshold=function(value){try{var ro=this.getMetricBoundaries(this.containers[this.currentContainerKey],null);var delValue=null;if(!value||value.length==0){if(!this.selections.isActive()){return ;}delValue=parseFloat(this.currentSplitter.getAttribute("v"));}else{var rangeValues=value.split("|");var delThreshold=this.getThresholdByValues(parseFloat(rangeValues[0]),parseFloat(rangeValues[1]));if(!delThreshold){return ;}var floorBoundary=(this.containers[this.currentContainerKey].thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE)?mstrThresholdSliderImpl.MINUS_INFINITY:ro.metricFloor;delValue=(delThreshold.floor!=floorBoundary)?delThreshold.floor:delThreshold.ceil;}var thresholds=this.containers[this.currentContainerKey].thresholds;if(thresholds.length==1){this.containers[this.currentContainerKey].thresholds=[];}else{for(var i=0;i<thresholds.length;i++){var t=thresholds[i];if(t.ceil==delValue){if(thresholds.length==2){this.containers[this.currentContainerKey].thresholds=[];}else{if(i==0){thresholds[i+1].floor=t.floor;thresholds.splice(i,1);}else{t.ceil=thresholds[i+1].ceil;thresholds.splice(i+1,1);}}break;}else{if(t.floor==delValue){t.floor=(i>0)?thresholds[i-1].ceil:ro.metricFloor;break;}}}}this.render();if(this.autoApply){this.parentBone.applyChanges();}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.applyNewType=function(newType,newBasedOn){try{var container=this.containers[this.currentContainerKey];var thresholds=container.thresholds;var oldType=container.thresholdType;var ro=this.getRangeObject(container);for(var i=0;i<thresholds.length;i++){var t=thresholds[i];switch(newType){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:ro.floor=t.floor;ro.ceiling=t.ceil;var floorPos=this.computePosByValue(t.floor,ro);var ceilPos=this.computePosByValue(t.ceil,ro);ro.thresholdType=newType;t.floor=this.computeValueByPos(floorPos,ro);t.ceil=this.computeValueByPos(ceilPos,ro);ro.thresholdType=oldType;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:t.floor=(i==0)?mstrThresholdSliderImpl.MINUS_INFINITY:t.floor;t.ceil=(i==thresholds.length-1)?mstrThresholdSliderImpl.INFINITY:t.ceil;break;}}container.thresholdType=newType;container.basedOn=newBasedOn;this.render();}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.interpolateThresholds=function(){try{for(var id in this.containers){var container=this.containers[id];var thresholdType=container.thresholdType;if(thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_COMPLEX){continue;}var boFloor=null;var boCeiling=null;switch(thresholdType){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:boFloor=0;boCeiling=mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:boFloor=0;boCeiling=mstrThresholdSliderImpl.LH_BOUNDARY;break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:boFloor=mstrThresholdSliderImpl.MINUS_INFINITY;boCeiling=mstrThresholdSliderImpl.INFINITY;break;}if(container.thresholds.length>0){container.thresholds.sort(mstrThresholdSliderImpl.sortThresholds);}var preThresh=null;for(var i=0;i<container.thresholds.length;i++){var currThresh=container.thresholds[i];if(typeof (currThresh.isInterpolate)=="undefined"){currThresh.isInterpolate=false;}if(i==0&&currThresh.floor>boFloor){var newThresh={id:this.getNewRangeId(),name:"Name",formatting:this.getEmptyThresholdFormatting(),isInterpolate:true};newThresh.floor=boFloor;newThresh.ceil=currThresh.floor;container.thresholds.splice(i,0,newThresh);i++;}if(preThresh&&preThresh.ceil<currThresh.floor){var newThresh={id:this.getNewRangeId(),name:"Name",formatting:this.getEmptyThresholdFormatting(),isInterpolate:true};newThresh.floor=preThresh.ceil;newThresh.ceil=currThresh.floor;container.thresholds.splice(i,0,newThresh);i++;}if(i==container.thresholds.length-1&&currThresh.ceil<boCeiling){var newThresh={id:this.getNewRangeId(),name:"Name",formatting:this.getEmptyThresholdFormatting(),isInterpolate:true};newThresh.floor=currThresh.ceil;newThresh.ceil=boCeiling;container.thresholds.splice(i+1,0,newThresh);i++;}preThresh=currThresh;}}}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.isValidInput=function(value,type,decimalSep){try{var numReg=new RegExp("^([+-]?)(\\d)+(["+decimalSep+"](\\d)+)?$");if(!numReg.test(value)){return false;}value=parseFloat(microstrategy.number.toString(value));switch(type){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:return !!(value>0&&value<mstrThresholdSliderImpl.LH_PERCENT_BOUNDARY);break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:return !!(value>0&&value<mstrThresholdSliderImpl.LH_BOUNDARY);break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:return !isNaN(value);break;default:return false;}}catch(err){microstrategy.errors.log(err);return false;}};mstrThresholdSliderImpl.showErrorMessage=function(type){try{var errMsg="";switch(type){case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT:errMsg=microstrategy.descriptors.getDescriptor("5978");break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST:case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST:errMsg=microstrategy.descriptors.getDescriptor("5979");break;case mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:errMsg=microstrategy.descriptors.getDescriptor("5980");break;default:errMsg=microstrategy.descriptors.getDescriptor("5980");}showMessage({contents:errMsg,elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.setContainerKey=function(key){try{this.currentContainerKey=key;}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.setAutoApply=function(value){try{this.autoApply=value;}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.setSelectedType=function(type){try{this.selectedType=type;}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.setShowLabels=function(value){try{this.showLabels=value;}catch(err){microstrategy.errors.log(err);}};mstrThresholdSliderImpl.prototype.setIsCondFormat=function(value){try{this.isCondFormat=value;}catch(err){microstrategy.errors.log(err);}};function mstrThresholdSliderImpl(id,cons,path){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;this.containers=cons;this.path=path;return this;}mstrThresholdSelectionsImplScript=true;mstrThresholdSelectionsImpl.prototype=new mstrSelectionsImpl();mstrThresholdSelectionsImpl.prototype.selectedClass="selected";mstrThresholdSelectionsImpl.prototype.ondocumentclick=function(e){try{if(!this.isActive()){return ;}if(!e){e=window.event;}var target=getEventTarget(e);var obj=microstrategy.findAncestorWithAtt(target,microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_SLIDER);if(!obj){return ;}if(target.tagName.toLowerCase()=="input"){return ;}this.clear();this.parentBone.observer.notifyAll("onselectionchange",null);}catch(err){microstrategy.errors.log(err);}};mstrThresholdSelectionsImpl.prototype.add=function(obj){try{mstrSelectionsImpl.prototype.add.call(this,obj);var oldClassName=obj.className;if(typeof (oldClassName)=="undefined"){oldClassName="";}obj.className=this.selectedClass+oldClassName;this.parentBone.observer.notifyAll("onselectionchange",null);}catch(err){microstrategy.errors.log(err);}return false;};mstrThresholdSelectionsImpl.prototype.resetClassName=function(obj){try{var newClass="";if(obj){var oldClassName=obj.className;if((oldClassName.length>0)&&(oldClassName.indexOf(this.selectedClass)==0)){newClass=oldClassName.substr(this.selectedClass.length);}obj.className=newClass;}}catch(err){microstrategy.errors.log(err);}return true;};mstrThresholdSelectionsImpl.prototype.remove=function(obj){try{mstrSelectionsImpl.prototype.remove.call(this,obj);this.resetClassName(obj);}catch(err){microstrategy.errors.log(err);}return false;};mstrThresholdSelectionsImpl.prototype.clear=function(){try{for(var id in this.items){this.resetClassName(this.items[id]);}mstrSelectionsImpl.prototype.clear.call(this);}catch(err){microstrategy.errors.log(err);}return false;};function mstrThresholdSelectionsImpl(){this.inherits=mstrSelectionsImpl;this.inherits();delete this.inherits;return this;}