mstrTreeCartImplScript=true;mstrTreeCartImpl.prototype=new mstrDialogImpl();mstrTreeCartImpl.prototype.initializing=false;mstrTreeCartImpl.prototype.treeView=null;mstrTreeCartImpl.prototype.selected=null;mstrTreeCartImpl.prototype.hasChanged=false;mstrTreeCartImpl.prototype.onload=function(){try{this.initializing=true;this.hasChanged=false;this.initDialog();this.initSettings();this.initializing=false;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeCartImpl.prototype.initSettings=function(){try{if(this.treeViewName){var elem=microstrategy.findChildWithAtt(this.elem,"div","id",this.treeViewName);if(elem){this.treeView=microstrategy.findBone(elem);}}if(this.selectedName){this.selected=microstrategy.findChildWithAtt(this.elem,"select","id",this.selectedName);}var oInput=microstrategy.findChildWithAtt(this.elem,"input","name",this.findArgument);if(oInput){oInput.onclick=new Function("e","return microstrategy.bone('"+this.id+"').submitSearch(e);");}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeCartImpl.prototype.setAppliesTo=function(bone){try{if(bone!=null){if(typeof (bone)=="string"){bone=microstrategy.bone(bone);}this.appliesTo=bone.id;if(bone.observer){bone.observer.register(this.id);}return true;}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeCartImpl.prototype.getAppliesTo=function(bone){try{if(this.appliesTo==null){var appliesTo=this.elem.getAttribute("at");if(appliesTo&&appliesTo.length>0){this.setAppliesTo(appliesTo);}}if(this.appliesTo){var bone=microstrategy.bone(this.appliesTo);return bone;}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeCartImpl.prototype.onDblClickTree=function(e){try{this.add();}catch(err){microstrategy.errors.log(err);}};mstrTreeCartImpl.prototype.add=function(){try{var options=new Array();if(this.treeView&&this.selected){var lLength=0;var oLI=this.treeView.elem.getElementsByTagName("LI");if((oLI)&&(oLI.length)){lLength=oLI.length;}for(i=0;i<lLength;i++){if(oLI[i].getAttribute("sel")=="1"){var text=(typeof oLI[i].innerText!="undefined")?oLI[i].innerText:oLI[i].textContent;var oOption=new Option(text,oLI[i].getAttribute("val"));if(!this.isItemInList(this.selected,oOption)){if((this.selected.options.length==1)&&(this.selected.options[0].value=="-none-")){this.selected.options[0]=oOption;}else{this.selected.options[this.selected.options.length]=oOption;}this.hasChanged=true;}}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeCartImpl.prototype.isItemInList=function(oList,sElement){try{var i;var elemText=(typeof sElement.text!="undefined")?sElement.text:sElement.textContent;for(i=0;i<oList.options.length;i++){var itemText=(typeof oList.options[i].innerText!="undefined")?oList.options[i].innerText:oList.options[i].textContent;if(itemText==elemText){return true;}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeCartImpl.prototype.remove=function(){try{if(this.selected){if(this.selected.options[0].value=="-none-"){this.selected.options[0].selected=false;}var lastIndex=0;var length=this.selected.options.length;for(i=0;i<length;i++){if(this.selected.options[i].selected){if(bIsFirefox){this.selected.remove(i);}else{this.selected.options.remove(i);}lastIndex=i;this.hasChanged=true;i--;length--;}}if(this.selected.options.length==0){this.selected.options[0]=new Option("--- "+microstrategy.descriptors.getDescriptor(512)+" ---","-none-");}else{if(lastIndex<this.selected.options.length){this.selected.options[lastIndex].selected=true;}else{this.selected.options[this.selected.options.length-1].selected=true;}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeCartImpl.prototype.submitSearch=function(){try{if(this.treeView.treeProcessing){return ;}this.treeView.hideTreeWaitMessage();var at=this.getAppliesTo();var oInput=microstrategy.findChildWithAtt(this.elem,"input","name",this.searchArgument);var cmdVal=(oInput)?oInput.value:"";if(at&&at.exec){if(at.exec("search",cmdVal)){var originalList=microstrategy.findChildWithAtt(this.treeView.elem,"ul","id","main");if(!originalList){originalList=document.createElement("ul");this.treeView.elem.insertAdjacentElement("beforeEnd",originalList);}originalList.id="old_main";originalList.style.display="none";var clearDiv=microstrategy.findChildWithAtt(this.elem,"div","id","clearSearch");if(clearDiv){clearDiv.style.display="inline";}clearDiv.onclick=new Function("e","return microstrategy.bone('"+this.id+"').clearSearch(e);");this.treeView.showTreeWaitMessage(originalList,"beforeBegin");microstrategy.updateManager.flushAndSubmitChanges();}}}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeCartImpl.prototype.findSearchResultsNode=function(){return microstrategy.findChildWithAtt(this.treeView.elem,"ul","id","main");};mstrTreeCartImpl.prototype.clearSearch=function(){try{var searchResults=this.findSearchResultsNode();this.treeView.removeTreeWaitMessage();var clearDiv=microstrategy.findChildWithAtt(this.elem,"div","id","clearSearch");if(clearDiv){clearDiv.style.display="none";}if(searchResults){try{this.treeView.elem.removeChild(searchResults);}catch(err){}}var originalList=microstrategy.findChildWithAtt(this.treeView.elem,"ul","id","old_main");if(originalList){originalList.id="main";originalList.style.display="block";}var textBox=microstrategy.findChildWithAtt(this.elem,"input","id","namePattern");if(textBox){textBox.value="";}}catch(err){microstrategy.errors.log(err);return false;}};function mstrTreeCartImpl(id){this.inherits=mstrDialogImpl;this.inherits(id);delete this.inherits;return this;}