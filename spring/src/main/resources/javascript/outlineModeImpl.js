mstrOutlineModeImplScript=true;mstrOutlineModeImpl.prototype=new Object();mstrOutlineModeImpl.prototype.fp=null;mstrOutlineModeImpl.prototype.expandImage="";mstrOutlineModeImpl.prototype.contractImage="";mstrOutlineModeImpl.prototype.currentExpansionLevel=0;mstrOutlineModeImpl.prototype.startRow=0;mstrOutlineModeImpl.prototype.endRow=0;mstrOutlineModeImpl.prototype.gridBone=null;mstrOutlineModeImpl.prototype.showHideRows=function(sIdentifier,iDepth,iRow,isTotal){var oObject;var i;var bInvisible;var rowLevel;var totalRows;var rowIsVisible;var nextAvailableLevel=iDepth+1;oObject=this.getGridTable(sIdentifier);if(oObject){var oNextRow=oObject.rows[iRow];if(oNextRow&&isNaN(parseInt(oNextRow.getAttribute("plv")))){nextAvailableLevel=parseInt(oNextRow.getAttribute("level"));}if(iRow!=oObject.rows.length){bInvisible=(oObject.rows[iRow].style.display=="none");totalRows=oObject.rows.length;for(i=iRow;i<totalRows;i++){rowLevel=parseInt(oObject.rows[i].getAttribute("level"));var pLevel=parseInt(oObject.rows[i].getAttribute("plv"));if(rowLevel<=iDepth||(!isNaN(pLevel)&&pLevel<iDepth)){break;}else{if((rowLevel==nextAvailableLevel)||(isTotal=="1"&&i==iRow)||(!isNaN(pLevel)&&pLevel==iDepth)){if(!(rowLevel==nextAvailableLevel)&&(isTotal=="1")&&(i==iRow)){iDepth=rowLevel-1;}if(bInvisible){oObject.rows[i].style.display="";this.showHideHeaderRows(i,"");this.setRowImage(oObject,sIdentifier,i,this.expandImage);}else{oObject.rows[i].style.display="none";this.showHideHeaderRows(i,"none");}}else{rowIsVisible=(oObject.rows[i].style.display.length==0);if(!bInvisible&&rowIsVisible){oObject.rows[i].style.display="none";this.showHideHeaderRows(i,"none");}}}}if(bInvisible){this.setRowImage(oObject,sIdentifier,iRow-1,this.contractImage);}else{this.setRowImage(oObject,sIdentifier,iRow-1,this.expandImage);}}}this.resize();};mstrOutlineModeImpl.prototype.getGridTable=function(sIdentifier){var oDivGrid=getElementById(sIdentifier);if(oDivGrid){var oGridTable=oDivGrid.getElementsByTagName("table")[0];if(oGridTable){return oGridTable.tBodies[0];}}};mstrOutlineModeImpl.prototype.showHideHeaderRows=function(iRow,sDisplay){if(this.gridBone&&this.gridBone.lockSet&&this.gridBone.lockSet.updateRowDisplay){this.gridBone.lockSet.updateRowDisplay(iRow,sDisplay);}return ;};mstrOutlineModeImpl.prototype.resize=function(){if(this.gridBone&&this.gridBone.lockSet&&this.gridBone.lockSet.resize){this.gridBone.lockSet.resize(true);}};mstrOutlineModeImpl.prototype.ApplyLeveling=function(sIdentifier,iDepth,outlineModeTableID,bIgnoreReportProperty){window.setTimeout("microstrategy.bone('"+sIdentifier+"').outlineMode.setLevel('"+sIdentifier+"', "+iDepth+", "+(outlineModeTableID?"'"+outlineModeTableID+"'":null)+", "+bIgnoreReportProperty+")",0);};mstrOutlineModeImpl.prototype.setLevel=function(sIdentifier,iDepth,outlineModeTableID,bIgnoreReportProperty){var i;var oObject;var level;var bInvisible;var currentLevel=0;var prevOriginalLevel=0;var prevLevel=0;this.currentExpansionLevel=iDepth;oObject=this.getGridTable(sIdentifier);if(oObject){for(i=1;i<oObject.rows.length;i++){level=parseInt(oObject.rows[i].getAttribute("level"));if(!level){continue;}var pLevel=parseInt(oObject.rows[i].getAttribute("plv"));if(!isNaN(pLevel)){if(pLevel<iDepth&&level>=iDepth){oObject.rows[i].style.display="";this.showHideHeaderRows(i,"");this.setRowImage(oObject,sIdentifier,i,this.expandImage);}else{if(level<iDepth){oObject.rows[i].style.display="";this.showHideHeaderRows(i,"");this.setRowImage(oObject,sIdentifier,i,this.contractImage);}else{if(!bInvisible){oObject.rows[i].style.display="none";this.showHideHeaderRows(i,"none");}}}continue;}if(level>prevOriginalLevel){currentLevel=prevLevel+1;}else{if(level<prevOriginalLevel){currentLevel=level;}}bInvisible=(oObject.rows[i].style.display=="none");if(level<iDepth&&((i+1)<oObject.rows.length)){var nextLevel=parseInt(oObject.rows[i+1].getAttribute("level"));var nextPLevel=parseInt(oObject.rows[i+1].getAttribute("plv"));if(isNaN(nextPLevel)&&level+1<nextLevel&&nextLevel>iDepth){level=iDepth;}}if((currentLevel<iDepth)||(isNaN(level))){oObject.rows[i].style.display="";this.showHideHeaderRows(i,"");this.setRowImage(oObject,sIdentifier,i,this.contractImage);}else{if(currentLevel==iDepth){oObject.rows[i].style.display="";this.showHideHeaderRows(i,"");this.setRowImage(oObject,sIdentifier,i,this.expandImage);}else{if(!bInvisible){oObject.rows[i].style.display="none";this.showHideHeaderRows(i,"none");}}}prevOriginalLevel=level;prevLevel=currentLevel;}}if(outlineModeTableID&&outlineModeTableID.length>0){oObject=getElementById(outlineModeTableID);if(oObject&&oObject.rows&&oObject.rows[0]){oObject=oObject.rows[0];}if(oObject){for(i=1;i<=oObject.cells.length;i++){if(i==iDepth){oObject.cells[i-1].className="outlinemode-level-cells-selected";}else{oObject.cells[i-1].className="outlinemode-level-cells";}}}}this.resize();if(!bIgnoreReportProperty&&microstrategy&&(typeof microstrategy.updateManager!="undefined")){var updateMngr=microstrategy.updateManager;var actionCollection=new Array();var value1="4!Template Formatting!OutlineLevelExpanding!"+iDepth;var value2="4!Template Formatting!OutlineLevelsExpanded!"+0;actionCollection.push(updateMngr.createActionObject(sIdentifier,mstrUpdateManager.SET_REPORT_PROPERTY_VALUES,mstrUpdateManager.applyChangesBeanPath,["4146"],[value1],[]));actionCollection.push(updateMngr.createActionObject(sIdentifier,mstrUpdateManager.SET_REPORT_PROPERTY_VALUES,mstrUpdateManager.applyChangesBeanPath,["4146"],[value2],[]));updateMngr.add(actionCollection,true);}};mstrOutlineModeImpl.prototype.setRowImage=function(gridTable,sIdentifier,rowIndex,src){var oImg;if(this.gridBone&&this.gridBone.lockSet){for(var i=0;i<4;i++){if(this.gridBone.lockSet.quadrants[i]){var oGridTable=this.gridBone.lockSet.quadrants[i].getElementsByTagName("table")[0];this.setImgSrc(oGridTable.tBodies[0].rows[rowIndex],sIdentifier+"_"+(rowIndex+1),src);}}}else{this.setImgSrc(gridTable.rows[rowIndex],sIdentifier+"_"+(rowIndex+1),src);}return ;};mstrOutlineModeImpl.prototype.setImgSrc=function(elem,sID,src){var oImg=microstrategy.findChildWithAtt(elem,"img","id",sID);if(oImg){if(src==null){oImg.parentNode.removeChild(oImg);}else{if(oImg.src!=src){oImg.src=src;}}}else{oImg=microstrategy.findChildWithAtt(elem,"span","id",sID);if(oImg){if(src==null){oImg.parentNode.removeChild(oImg);}else{if(src==this.contractImage){oImg.innerHTML="[-] ";}else{oImg.innerHTML="[+] ";}}}}};mstrOutlineModeImpl.prototype.isExpanded=function(sId){var retValue=false;var oImgs=document.getElementsByName(sId);if(oImgs){for(var i=0;i<oImgs.length;i++){if(oImgs[i].tagName=="SPAN"&&oImgs[i].innerHTML=="[+] "){retValue=false;}else{if(oImgs[i].tagName=="SPAN"&&oImgs[i].innerHTML=="[-] "){retValue=true;}else{if(oImgs[i].src&&oImgs[i].src.indexOf(this.expandImage)>0){retValue=false;}else{if(oImgs[i].src&&oImgs[i].src.indexOf(this.contractImage)>0){retValue=true;}}}}}}return retValue;};mstrOutlineModeImpl.prototype.getExpansionState=function(sIdentifier){var oTable=this.getGridTable(sIdentifier);var strState="";var tempContractImage=this.contractImage;var tempExpandImage=this.expandImage;this.contractImage=this.getImageNameWithoutPath(this.contractImage);this.expandImage=this.getImageNameWithoutPath(this.expandImage);if(oTable){strState=this.formTree(oTable,1,1,sIdentifier);}strState='<outlinemode defaultLevel="'+this.currentExpansionLevel+'" startRow="'+this.startRow+'" endRow="'+this.endRow+'" >'+strState+"</outlinemode>";this.contractImage=tempContractImage;this.expandImage=tempExpandImage;return strState;};mstrOutlineModeImpl.prototype.formTree=function(oTable,iRow,iDepth,sIdentifier){var i;var bInvisible;var bExpanded;var strState="";var currentDepth=0;var ordinal="";var test="";if(oTable){for(i=iRow;i<oTable.rows.length;i++){bInvisible=(oTable.rows[i].style.display=="none");if(!bInvisible){bExpanded=this.isExpanded(sIdentifier+"_"+(i+1));currentDepth=parseInt(oTable.rows[i].getAttribute("level"));if(isNaN(currentDepth)){continue;}if(currentDepth>=iDepth){if(bExpanded){ordinal=oTable.rows[i].getAttribute("o");test=oTable.rows[i].getAttribute("test");strState+='<row o="'+ordinal+'" dpt="'+currentDepth+'" />';strState+=this.formTree(oTable,i,currentDepth+1,sIdentifier);}}else{break;}}}}return strState;};mstrOutlineModeImpl.prototype.getImageNameWithoutPath=function(sImagePath){var result="";if(sImagePath){var lPosition=0;lPosition=sImagePath.lastIndexOf("\\")>0?sImagePath.lastIndexOf("\\")+1:0;if(lPosition==0){lPosition=sImagePath.lastIndexOf("/")>0?sImagePath.lastIndexOf("/")+1:0;}result=sImagePath.substr(lPosition);}return result;};mstrOutlineModeImpl.prototype.clearImgForEmptyRows=function(sIdentifier,maxLevels){var oObject=this.getGridTable(sIdentifier);if(oObject){for(i=1;i<oObject.rows.length;i++){var level=parseInt(oObject.rows[i].getAttribute("level"));if(level==maxLevels){continue;}if((i+1)==oObject.rows.length){this.setRowImage(oObject,sIdentifier,i);}else{var nextLevel=parseInt(oObject.rows[i+1].getAttribute("level"));if(nextLevel<=level){this.setRowImage(oObject,sIdentifier,i);}}}}};function mstrOutlineModeImpl(startRow,endRow,expandImage,contractImage,level,maxLevels,gridBone){this.startRow=startRow;this.endRow=endRow;this.expandImage=expandImage;this.contractImage=contractImage;this.currentExpansionLevel=level;this.isLoaded=true;this.gridBone=gridBone;this.clearImgForEmptyRows(gridBone.objId,maxLevels);if(level!=maxLevels){this.ApplyLeveling(gridBone.objId,level,null,true);}return this;}