mstrRWUnitBoneImplScript=true;mstrRWUnitBoneImpl.prototype=new mstrBoneImpl();mstrRWUnitBoneImpl.prototype.toolbar=null;mstrRWUnitBoneImpl.prototype.hasToolbar=true;mstrRWUnitBoneImpl.prototype.sibRWUnits=null;mstrRWUnitBoneImpl.prototype.activeRWUnit=null;mstrRWUnitBoneImpl.prototype.RWUnitId=null;mstrRWUnitBoneImpl.prototype.docViewer=null;mstrRWUnitBoneImpl.prototype.toolbarShown=false;mstrRWUnitBoneImpl.prototype.boneSelected=false;mstrRWUnitBoneImpl.prototype.isMouseOver=false;mstrRWUnitBoneImpl.prototype.showTBSelected=true;mstrRWUnitBoneImpl.prototype.toolbar_pos_x=null;mstrRWUnitBoneImpl.prototype.toolbar_pos_y=null;mstrRWUnitBoneImpl.prototype.toolbarTimer=null;mstrRWUnitBoneImpl.prototype.isLocked=false;mstrRWUnitBoneImpl.prototype.TIME_DELAY_SHOW_TOOLBAR=0;mstrRWUnitBoneImpl.prototype.TIME_DELAY_SHOW_TOOLBAR_SHORT=0;mstrRWUnitBoneImpl.prototype.TIME_DELAY_HIDE_TOOLBAR=9;mstrRWUnitBoneImpl.prototype.stickToolbar=false;mstrRWUnitBoneImpl.prototype.elemTagName="div";mstrRWUnitBoneImpl.prototype.onload=function(){try{mstrBoneImpl.prototype.onload.call(this);this.docViewer=microstrategy.bone("rwb_viewer");this.activeRWUnit=microstrategy.findAncestor(this.elem);if(this.activeRWUnit){this.RWUnitId=this.activeRWUnit.getAttribute("id");}this.initToolbar();}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.initToolbar=function(){try{if(this.checkToolbarCondition(true)){this.attachToolbarEvents();}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.checkToolbarCondition=function(forInit){try{if(this.docViewer==null){this.getDocViewer();}if(this.docViewer){return this.docViewer.isEditableViewModeEplus()&&(forInit||getObjWidth(this.activeRWUnit)!=0||getObjHeight(this.activeRWUnit)!=0);}else{return false;}}catch(err){microstrategy.errors.log(err);return false;}};mstrRWUnitBoneImpl.prototype.switchActiveRWUnit=function(sn){try{if(!sn){return ;}var snArray=sn.split("_");this.activeRWUnit=document.getElementsByName(this.RWUnitId)[snArray[1]];}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.switchActiveElem=function(sn){try{var elem=microstrategy.findChildWithAtt(this.activeRWUnit,this.elemTagName,"id",this.id);if(elem){this.elem=elem;}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.getTitleAndClassOfFirstToolbar=function(){var l=this.isLocked,o={};o.title=microstrategy.descriptors.getDescriptor(l?"5604":"5773");o.className=l?"mstrLocked":"select";return o;};mstrRWUnitBoneImpl.prototype.createToolbarBody=function(){try{var toolbar=document.createElement("div");if(this.docViewer.isEditableViewModeEplus()){var selectIcon=document.createElement("div");selectIcon.setAttribute("id","select_icon");selectIcon.setAttribute("targetBoneId",this.id);var tc=this.getTitleAndClassOfFirstToolbar();selectIcon.setAttribute("title",tc.title);selectIcon.className=tc.className;selectIcon.onmousedown=new Function("e","return  microstrategy.bone('"+this.id+"').getDocSelections().onmousedown(e);");toolbar.appendChild(selectIcon);}return toolbar;}catch(err){microstrategy.errors.log(err);return false;}};mstrRWUnitBoneImpl.prototype.createToolbar=function(){try{var toolbar=this.createToolbarBody();toolbar.id="toolbar_"+this.id;toolbar.className="floatingToolbar";toolbar.onmouseover=new Function("e","return microstrategy.bone('"+this.id+"').onmouseover(e);");toolbar.onmouseout=new Function("e","return microstrategy.bone('"+this.id+"').onmouseout(e);");var floatingToolbarsDiv=getElementById("floatingToolbars");if(floatingToolbarsDiv){floatingToolbarsDiv.appendChild(toolbar);}this.toolbar=toolbar;}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.computeToolbarPos=function(target){try{this.toolbar_pos_x=getObjSumLeft(this.activeRWUnit)-getObjSumLeft(this.docViewer.doc.elem)-(bIsIE4?2:1);this.toolbar_pos_y=this.getObjSumTopScrolled(this.activeRWUnit)-this.getObjSumTopScrolled("page")-getObjHeight(this.toolbar)+(mstr.utils.ISFF?1:0);}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.showToolbar=function(stick){try{if(!this.checkToolbarCondition()){return ;}this.toolbar=getObj("toolbar_"+this.id);if(!this.toolbar){this.createToolbar();}this.toolbar.style.display="block";this.computeToolbarPos();this.toolbar_pos_x=Math.max(this.toolbar_pos_x,0);this.toolbar_pos_y=Math.max(this.toolbar_pos_y,0);this.toolbar.style.width=this.toolbar.clientWidth+"px";moveObjTo(this.toolbar,this.toolbar_pos_x,this.toolbar_pos_y);this.toolbarShown=true;this.toolbar.setAttribute("shown",1);if(stick){this.stickToolbar=true;}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.showToolbarWithDelay=function(ms){try{if(this.toolbarShown){return null;}var that=this;var f=function(){var b=microstrategy.bone(that.id);if(b&&document.getElementById(that.id)){b.showToolbar();}};return window.setTimeout(f,ms);}catch(err){microstrategy.errors.log(err);return false;}};mstrRWUnitBoneImpl.prototype.resetToolbar=function(){var stick=this.stickToolbar;var shown=this.toolbarShown;if(shown){this.stickToolbar=false;this.hideToolbar(true);}if(this.toolbar){this.toolbar.parentNode.removeChild(this.toolbar);}this.toolbar=null;if(shown){this.showToolbar(stick);}};mstrRWUnitBoneImpl.prototype.hideToolbar=function(force){try{if(this.stickToolbar){return ;}var forceHide=(force==true||force=="true");if(!forceHide&&((this.showTBSelected&&this.boneSelected)||this.isMouseOver)){return ;}if(this.toolbar){this.toolbar.style.display="none";this.toolbarShown=false;this.toolbar.setAttribute("shown",0);}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.hideToolbarWithDelay=function(ms){try{if(!this.toolbarShown){return null;}return window.setTimeout("if (microstrategy.bone('"+this.id+"')) microstrategy.bone('"+this.id+"').hideToolbar();",ms);}catch(err){microstrategy.errors.log(err);return false;}};mstrRWUnitBoneImpl.prototype.syncToolbarElem=function(activeSectionSN){try{this.switchActiveRWUnit(activeSectionSN);this.switchActiveElem(activeSectionSN);this.attachToolbarEvents();}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.syncToolbarPos=function(){try{this.computeToolbarPos();moveObjTo(this.toolbar,this.toolbar_pos_x,this.toolbar_pos_y);}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.attachToolbarEvents=function(){try{this.sibRWUnits=document.getElementsByName(this.RWUnitId);var mouseOverFun=new Function("e","microstrategy.bone('"+this.id+"').onmouseover(e);");var mouseOutFun=new Function("e","microstrategy.bone('"+this.id+"').onmouseout(e); ");for(var i=0;i<this.sibRWUnits.length;i++){this.sibRWUnits[i].onmouseover=mouseOverFun;this.sibRWUnits[i].onmouseout=mouseOutFun;}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.sibBoneSelected=function(){try{return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrRWUnitBoneImpl.prototype.getObjSumTopScrolled=function(object){try{var obj=getObj(object);var lTop=0;if(obj&&(obj.getClientRects||obj.getBoundingClientRect)){var frameOffset=(self==top)?0:self.screenLeft;if(obj.getBoundingClientRect){lTop=obj.getBoundingClientRect().top;}else{lTop=obj.getClientRects()[0].top;}lTop=lTop-frameOffset-2;lTop+=getDocumentScrollTop();return Math.round(lTop);}else{for(var i=0;(obj);i++){lTop+=obj.offsetTop;if(obj.offsetParent&&obj.offsetParent.scrollTop&&obj.offsetParent.tagName.toLowerCase()!="html"){lTop-=obj.offsetParent.scrollTop;}obj=obj.offsetParent;}return parseInt(lTop);}}catch(err){microstrategy.errors.log(err);return 0;}};mstrRWUnitBoneImpl.prototype.onboneaftermove=function(movedBoneIds,activeSectionSN){try{if(movedBoneIds.indexOf("|"+this.RWUnitId+"|")>-1){if(this.toolbarShown){if(activeSectionSN){this.syncToolbarElem(activeSectionSN);}if(this.toolbarShown){this.syncToolbarPos();}}}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.onboneafterresize=function(resizedBoneIds){try{if(resizedBoneIds.indexOf("|"+this.RWUnitId+"|")>-1){if(this.toolbarShown){this.syncToolbarPos();}}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.onboneselected=function(selectedBoneIds,activeSectionSN){try{if(!selectedBoneIds||selectedBoneIds.indexOf("|"+this.RWUnitId+"|")>-1){if(this.showTBSelected&&this.checkToolbarCondition()){this.boneSelected=true;if(activeSectionSN){this.switchActiveRWUnit(activeSectionSN);}if(this.toolbarTimer!=null){window.clearTimeout(this.toolbarTimer);}this.toolbarTimer=this.showToolbarWithDelay(this.TIME_DELAY_SHOW_TOOLBAR_SHORT);}}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.onbonedeselected=function(deselectedBoneIds){try{if(!deselectedBoneIds||deselectedBoneIds.indexOf("|"+this.RWUnitId+"|")>-1){this.boneSelected=false;window.clearTimeout(this.toolbarTimer);this.toolbarTimer=this.hideToolbarWithDelay(this.TIME_DELAY_HIDE_TOOLBAR);}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.onbonedeleted=function(deletedBoneIds){try{if(!deletedBoneIds||deletedBoneIds.indexOf("|"+this.RWUnitId+"|")>-1){this.boneSelected=false;this.isMouseOver=false;if(this.toolbarShown){this.stickToolbar=false;this.hideToolbar();}}}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.onmouseover=function(e){try{e=e||window.event;stopEventBubbling(e);var target=getEventTarget(e);if(this.isParentSelected()||!this.checkToolbarCondition()){return ;}if(this.sibRWUnits&&this.sibRWUnits.length>1){var ancestor=microstrategy.findAncestorWithAtt(target,"id",this.id);if(ancestor){this.activeRWUnit=microstrategy.findAncestor(ancestor);}}this.isMouseOver=true;if(this.toolbarTimer!=null){window.clearTimeout(this.toolbarTimer);}this.toolbarTimer=this.showToolbarWithDelay(this.TIME_DELAY_SHOW_TOOLBAR);}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.hideToolbarOnMouseOut=function(){try{this.isMouseOver=false;if((this.showTBSelected&&this.boneSelected)||!this.checkToolbarCondition()){return ;}window.clearTimeout(this.toolbarTimer);this.toolbarTimer=this.hideToolbarWithDelay(this.TIME_DELAY_HIDE_TOOLBAR);}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.onmouseout=function(e){try{this.hideToolbarOnMouseOut();}catch(err){microstrategy.errors.log(err);}};mstrRWUnitBoneImpl.prototype.isParentSelected=function(){try{var parentPS=microstrategy.findAncestorBone(this,"mstrPanelStack");return(parentPS&&parentPS.boneSelected);}catch(err){microstrategy.errors.log(err);return false;}};mstrRWUnitBoneImpl.prototype.getDocViewer=function(){try{return this.docViewer;}catch(err){microstrategy.errors.log(err);return false;}};mstrRWUnitBoneImpl.prototype.getDocSelections=function(){try{if(!this.docViewer){this.getDocViewer();}if(this.docViewer&&this.docViewer.doc&&this.docViewer.doc.selections){return this.docViewer.doc.selections;}return null;}catch(err){microstrategy.errors.log(err);return false;}};function mstrRWUnitBoneImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;return this;}