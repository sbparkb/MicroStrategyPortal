(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.MetricSelectorUtility","mstrmojo.hash","mstrmojo.array");var $HASH=mstrmojo.hash,$ARR=mstrmojo.array;mstrmojo.MetricQualDocSelector=mstrmojo.declare(mstrmojo.DocSelector,null,{scriptClass:"mstrmojo.MetricQualDocSelector",_ieformatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["width","B","P","height"],filterNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},formatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},init:function init(props){this._super(props);this.spm=true;},initControlInfo:function initControlInfo(){this._super();var $MU=mstrmojo.MetricSelectorUtility,node=this.node,data=node.data,defn=node.defn;$HASH.copyProps(["srcid","srct"],defn,this);this.qua=data.qt;this.dt=data.dt;var opId=$MU.getOpIdxByfunc(data.f,data.ft);if(opId!==-1){this.include=$MU.getIncludeByOp(opId);}},canApply:function canApply(widget){return true;},onquaChange:function onquaChange(evt){this.node.data.qt=evt.value;},_buildEvent:function _buildEvent(rEvt,widget){var cs=[];$ARR.forEach(widget.cs,function(item){cs.push(item.v);if(rEvt.dtp===undefined){rEvt.dtp=item.dtp;}});if(cs.length){rEvt.cs=cs.join(mstrmojo.elementHelper.ELEM_SEPARATOR);}var fInfo=mstrmojo.MetricSelectorUtility.getFuncInfo(widget.opId,widget.qua);rEvt.f=widget.f=fInfo.f;rEvt.ft=widget.ft=fInfo.ft;rEvt.include=this.defn.include=this.include=widget.include;rEvt.ckey=this.ckey;rEvt.srcid=this.srcid;rEvt.srct=this.srct;rEvt.unset=widget.unSet;rEvt.onlyInclude=widget.onlyInclude;if(widget.changeInclude){rEvt.changeInclude=widget.changeInclude;rEvt.forceApply=true;widget.changeInclude=false;}if(widget.changeQual){rEvt.changeQual=widget.changeQual;widget.changeQual=false;}rEvt.qt=widget.qua;this.node.defn.set("cek",{id:this.id,f:widget.f,ft:widget.ft,cs:widget.cs,qua:widget.qua,include:widget.include});},preBuildRendering:function preBuildRendering(){var ret=this._super();if(this.isInFilterPanel()&&!this.isHorizFP()){this.children[0].width=this.parent.parent.contentWidth;}return ret;},postBuildRendering:function postBuildRendering(){this._super();if(this.formatHandlers.filterNode){var f=this.getFormats();if(!f.height){this.updateHeight();}}},getCekEvtListener:function getCekEvtListener(selectorContainer,selectorControl){return function(evt){selectorContainer.handleActionInSyncPhase(function(){selectorContainer.set("qua",evt.value.qua);if(selectorContainer.id!==evt.value.id){selectorControl.updateExpr(evt.value);if(selectorContainer.style===mstrmojo.DocSelector.STYLES.METRIC_SLIDER){selectorContainer.set("include",evt.value.include);}}});};},updateWidget:function updateWidget(selectorContainer){var selectorWidget=this._super(selectorContainer),node=selectorContainer.node,idx=selectorContainer.selIdx,data=node.data,elements=data.elms;if(selectorWidget.updateData){selectorWidget.numFmts=selectorContainer.defn.numFmts;selectorContainer.handleActionInSyncPhase(function(){selectorWidget.updateData({low:data.min,high:data.max,cnt:data.cnt,nov:data.nov},{cs:data.cs,f:data.f,ft:data.ft,qua:data.qt});});}selectorWidget.items=elements;selectorWidget.selectedIndices=idx;return selectorWidget;},newAndInitWidget:function newAndInitWidget(selectorContainer){var selectorWidget=this._super(selectorContainer);selectorContainer.attachEventListener("quaChange",selectorWidget.id,function(evt){this.set("qua",evt.value);});return selectorWidget;},getWidgetConfig:function getWidgetConfig(selectorContainer,selectorStyle,defn,elements){var fmts=selectorContainer.getFormats(),cfg=this._super(selectorContainer,selectorStyle,defn,elements);$HASH.copyProps(["height","width","font"],fmts,cfg);$HASH.copyProps(["cs","ft"],defn,cfg);cfg.fmts=defn.f;cfg.dt=selectorContainer.dt;cfg.qua=selectorContainer.qua;cfg.numFmts=defn.numFmts;return cfg;},isSelectAll:function isSelectAll(){var $OP=mstrmojo.MetricSelectorUtility.OP,widget=this.children&&this.children[0],isNullorNotNull=widget&&($OP._IS_NULL===widget.opId||$OP._IS_NOT_NULL===widget.opId);return widget===undefined?true:(!widget.cs||widget.cs.length===0)&&!isNullorNotNull;}});}());