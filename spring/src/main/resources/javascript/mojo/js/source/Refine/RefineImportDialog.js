(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineFileButton");mstrmojo.requiresDescs(14180,14181,14182,14183,221,2164);mstrmojo.Refine.RefineImportDialog=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.Refine.RefineImportDialog",markupString:'<div id="{@id}" class="refine-import-dialog"><div class="refine-import-dialog-header">'+mstrmojo.desc(14180,"Import History Script")+'</div><div class="refine-import-dialog-body"><div class="refine-import-dialog-instruction"></div><div class="refine-import-dialog-input"></div></div><div class="refine-import-dialog-footer"><div class="refine-import-dialog-cancel"></div><div class="refine-import-dialog-apply"></div><div class="refine-import-dialog-file"></div></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.firstChild;},instructionNode:function(){return this.domNode.children[1].children[0];},inputNode:function(){return this.domNode.children[1].children[1];},cancelNode:function(){return this.domNode.children[2].children[0];},applyNode:function(){return this.domNode.children[2].children[1];},fileNode:function(){return this.domNode.children[2].children[2];}},markupMethods:{onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;}},getMovingHandle:function getMovingHandle(){return this.headerNode;},getMovingTarget:function getMovingTarget(){return this.editorNode;},preBuildRendering:function preBuildRendering(){this.placeholder=document.body.appendChild(document.createElement("div"));return this._super();},children:[{scriptClass:"mstrmojo.Label",slot:"instructionNode",bindings:{text:function(){if(!!window.FileReader){return mstrmojo.desc(14181,"Browse or Paste the Wrangling Script");}else{return mstrmojo.desc(14182,"Paste the Wrangling Script");}}}},{scriptClass:"mstrmojo.TextArea",markupString:'<textarea id="{@id}" class="mstrmojo-TextArea {@cssClass}"  style="{@cssText}" title="{@tooltip}" placeholder="{@placeholderText}" rows="{@rows}" cols="{@cols}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,input,keydown,keyup,blur></textarea>',slot:"inputNode",alias:"textArea",maxLength:undefined,onkeyup:function onkeyup(){if(this.value){this.parent.apply.set("enabled",true);}else{this.parent.apply.set("enabled",false);}},oninput:function oninput(){if(this.value){this.parent.apply.set("enabled",true);}else{this.parent.apply.set("enabled",false);}}},{scriptClass:"mstrmojo.Refine.RefineFileButton",slot:"fileNode",bindings:{visible:function(){return !!window.FileReader;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",slot:"cancelNode",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"apply",slot:"applyNode",enabled:false,text:mstrmojo.desc(2164,"Apply"),onclick:function(){String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"");};String.prototype.startsWith=function(s){return this.length>=s.length&&this.substring(0,s.length)==s;};String.prototype.endsWith=function(s){return this.length>=s.length&&this.substring(this.length-s.length)==s;};String.prototype.contains=function(s){return this.indexOf(s)>=0;};var fixJson=function(json){json=json.trim();if(!json.startsWith("[")){json="["+json;}if(!json.endsWith("]")){json=json+"]";}return json.replace(/\}\s*\,\s*\]/g,"} ]").replace(/\}\s*\{/g,"}, {");};var json;try{json=this.parent.textArea.value;json=fixJson(json);json=JSON.parse(json);}catch(e){mstrmojo.alert(mstrmojo.desc(14183,"The JSON you pasted is invalid."));return ;}this.parent.controller.applyOperations({operations:JSON.stringify(json),engine:JSON.stringify({facets:[],mode:"row-based"})});this.parent.destroy();}}]});}());