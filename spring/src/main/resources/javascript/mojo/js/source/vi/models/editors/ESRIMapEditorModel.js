(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.MapEditorModel","mstrmojo.gmaps.MapPropertiesHelper","mstrmojo.gmaps.MapEnums","mstrmojo.array");mstrmojo.requiresDescs(8068,6030,6031,13254,13256,13255,11849,11850,11851,11852,11853,11854,11855);var propHelper=mstrmojo.gmaps.MapPropertiesHelper,$GMAPS=mstrmojo.gmaps,$EnumGeographicRole=$GMAPS.EnumGeographicRole,$PropertyTypes=$GMAPS.PropertyTypes,$EnumMapType=$GMAPS.EnumMapType,$EnumClusterMode=$GMAPS.EnumClusterMode,$ARR=mstrmojo.array;mstrmojo.vi.models.editors.ESRIMapEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.MapEditorModel,null,{scriptClass:"mstrmojo.vi.models.ESRIMapEditorModel",help:"dashboard_editor_esri_map_html5_properties.htm",vizUnit:null,defaultShapeId:null,updateProperties:function updateProperties(propertyName,newValue){var host=this.getHost(),key=this.getEditingGridKey(),properties=host.getProperties(key);this.editingProperty=propertyName;if(propertyName==$PropertyTypes.mapType||propertyName==$PropertyTypes.markerType){switch(newValue){case $EnumMapType.Marker:case $EnumMapType.Bubble:case $EnumMapType.Density:properties.sm="1";properties.sa="0";properties[propertyName]=newValue;break;case $EnumMapType.Area:properties.sm="0";properties.sa="1";this.getAreaShapes();properties.lid=this.getAreaShape();properties[propertyName]=newValue;break;default:properties[propertyName]=newValue;break;}}else{if(properties[propertyName]===undefined||properties[propertyName]===null||properties[propertyName].toString()!==newValue.toString()){properties[propertyName]=newValue;}}},getMapType:function getMapType(){var type=$PropertyTypes.mapType,host=this.getHost(),key=this.getEditingGridKey(),prop=host.getProperties(key),value;if(prop&&prop.sa&&prop.sa=="1"){value=$EnumMapType.Area;}else{if(prop&&prop[type]){value=prop[type];}else{if(prop&&prop.sm&&prop.sm=="1"){value=$EnumMapType.Marker;}}}return value;},getMapTypes:function getMapTypes(){return[{n:mstrmojo.desc(13254,"Marker"),id:$EnumMapType.Marker},{n:mstrmojo.desc(13255,"Area"),id:$EnumMapType.Area},{n:mstrmojo.desc(13256,"Density"),id:$EnumMapType.Density}];},getMapTypeSelectedIndex:function getMapTypeSelectedIndex(){var value=this.getMapType(),selectedIndex=0;switch(value){case $EnumMapType.Marker:case $EnumMapType.Bubble:selectedIndex=0;break;case $EnumMapType.Area:selectedIndex=1;break;case $EnumMapType.Density:selectedIndex=2;break;default:break;}return selectedIndex;},getMapStyles:function getMapStyles(){var host=this.getHost(),styles=[],mapStyles=host.mapStylesCache,title,titleMap={"World Street Map":mstrmojo.desc(13821,"Street"),"Light Gray Map":mstrmojo.desc(13822,"Light gray"),"Relief Map":mstrmojo.desc(13823,"Relief"),"Topographic Map":mstrmojo.desc(11852,"Topographic"),"Physical Map":mstrmojo.desc(13824,"Physical"),"Terrain Map":mstrmojo.desc(8102,"Terrain"),"Satellite View Map":mstrmojo.desc(8068,"Satellite")};if(!!host.gridParams&&!!host.gridParams.config&&!!host.gridParams.config.useESRICloud&&host.gridParams.config.useESRICloud==1){if(!!mapStyles){for(var i=0;i<mapStyles.length;i++){title=mapStyles[i];styles.push({n:titleMap[title],id:title});}}}return styles;},getMarkerClusteringType:function getMarkerClusteringType(){var type=$PropertyTypes.clusterMode,host=this.getHost(),key=this.getEditingGridKey(),value=host.getProperties(key)[type];if(value!==$EnumClusterMode.ON&&value!==$EnumClusterMode.OFF&&value!==$EnumClusterMode.PIE){value=$EnumClusterMode.OFF;}return value;},getMarkerClusteringTypes:function getMarkerClusteringTypes(){return[{n:mstrmojo.desc(6030,"On"),id:$EnumClusterMode.ON},{n:mstrmojo.desc(344,"Pie"),id:$EnumClusterMode.PIE},{n:mstrmojo.desc(6031,"Off"),id:$EnumClusterMode.OFF}];},getMarkerClusteringTypeSelectedIndex:function getMarkerClusteringTypeSelectedIndex(){var type=this.getMarkerClusteringType(),selectedIndex=0;switch(type){case $EnumClusterMode.ON:selectedIndex=0;break;case $EnumClusterMode.PIE:selectedIndex=1;break;case $EnumClusterMode.OFF:default:selectedIndex=2;break;}return selectedIndex;},getAreaShape:function getAreaShape(){var type=$PropertyTypes.shapeFile,host=this.getHost(),key=this.getEditingGridKey(),value=parseInt(host.getProperties(key)[type],10);value=isNaN(value)?this.defaultShapeId:value;return value;},getAreaShapes:function getAreaShapes(){var key=this.getEditingGridKey(),host=this.getHost(),props=host.getProperties(key),geoZoneModel=host.zonesModel.getZoneModelByZoneId(mstrmojo.vi.viz.EnumDSSDropZones.GeoAttribute),esriConfig,shapes,i,shape,shapesOptions=[],grid=this.getEditingGrid(),geoRole=$EnumGeographicRole.EnumGeographicRoleNone,ga;$ARR.forEach(geoZoneModel&&geoZoneModel.items,function(item){ga=item.id;return false;});if(!ga&&!!props){ga=props.ma;}if(!ga||ga.length==1){props.lid="";this.defaultShapeId=null;return null;}geoRole=this.getShapeAttributeGeoRole(grid,ga)||geoRole;esriConfig=host.gridParams&&host.gridParams.config;if(esriConfig&&parseInt(esriConfig.useESRICloud,10)!=1){return null;}if(esriConfig){shapes=esriConfig.shapes;for(i=0;i<shapes.length;i++){shape=shapes[i];if(geoRole===$EnumGeographicRole.EnumGeographicRoleNone||geoRole===$EnumGeographicRole.EnumGeographicRoleOther&&shape.custom&&shape.custom==true||geoRole==shape.roleId){shapesOptions.push({id:shape.id,n:shape.desc});}}}this.defaultShapeId=null;var defaultShape=propHelper.getMatchingShape(shapes,null,geoRole===$EnumGeographicRole.EnumGeographicRoleNone?null:geoRole);if(!!defaultShape){this.defaultShapeId=defaultShape.id;}return shapesOptions;},getAreaShapeSelectedIndex:function getAreaShapeSelectedIndex(){var shapes=this.getAreaShapes(),value=this.getAreaShape(),shapeCount=shapes?shapes.length:0,i,shape,selectedIndex=-1;for(i=0;i<shapeCount;i++){shape=shapes[i];if(shape.id==value){selectedIndex=i;break;}}return selectedIndex;}});})();