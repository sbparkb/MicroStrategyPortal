(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");var VALUE_KEY="___value",PARENT_KEY="___parent",KEY_MAP="___key_map",LEAF_KEY="___IS_LEAF";mstrmojo.netviz.ObservableModel=mstrmojo.declare(mstrmojo.Obj,[],{scriptClass:"mstrmojo.netviz.ObservableModel",init:function(config){var disposables=[];config=config||{};config=mstrmojo.hash.clone(config);var keys=Object.keys(config),len=keys.length,i,newNode;for(i=0;i<len;i++){var key=keys[i],value=config[key];if(!(value instanceof Object)){newNode=new NETVIZ_MODEL();newNode[VALUE_KEY]=value;newNode[LEAF_KEY]=true;config[key]=newNode;}else{config[key]=newNode=new NETVIZ_MODEL(value);}disposables.push(newNode);config[key][PARENT_KEY]=this;}if(this._super){this._super(config);}this.addDisposable(disposables);this[KEY_MAP]=config;},getParent:function(){return this[PARENT_KEY];},getChildrenKeys:function(){return Object.keys(this[KEY_MAP]);},isLeafNode:function(){return this[LEAF_KEY];},getValue:function(){if(this.isLeafNode()){return this[VALUE_KEY];}return this.getRawObject();},setValue:function(newValue,silent){var oldValue=this.getValue();var keys,len,i,key,tempNode;if(this.isLeafNode()){if(!(newValue instanceof Object)){if(oldValue!==newValue){this[VALUE_KEY]=newValue;if(!silent){this.raiseEvent({name:"valueChanged",target:this,oldValue:oldValue,newValue:newValue});}}}else{this[VALUE_KEY]=undefined;this[LEAF_KEY]=undefined;this[KEY_MAP]=newValue;keys=Object.keys(newValue);len=keys.length;tempNode=this.addDisposable(new NETVIZ_MODEL(newValue));for(i=0;i<len;i++){key=keys[i];this[key]=tempNode[key];tempNode[PARENT_KEY]=this;}if(!silent){this.raiseEvent({name:"valueChanged",target:this,oldValue:oldValue,newValue:newValue});}}}else{var childrenKeys=this.getChildrenKeys();len=childrenKeys.length;for(i=0;i<len;i++){key=childrenKeys[i];this[key]=undefined;}if(!(newValue instanceof Object)){this[LEAF_KEY]=true;this[VALUE_KEY]=newValue;this[KEY_MAP]=undefined;this[VALUE_KEY]=newValue;if(!silent){this.raiseEvent({name:"valueChanged",target:this,oldValue:oldValue,newValue:newValue});}}else{this[KEY_MAP]=newValue;keys=Object.keys(newValue);len=keys.length;tempNode=this.addDisposable(new NETVIZ_MODEL(newValue));for(i=0;i<len;i++){key=keys[i];this[key]=tempNode[key];tempNode[PARENT_KEY]=this;}if(!silent){this.raiseEvent({name:"valueChanged",target:this,oldValue:oldValue,newValue:newValue});}}}},stopPropagation:function(event){event._isStopped=true;},raiseEvent:function(event){if(this._super){this._super(event);}if(event._isStopped){return ;}var parent=this.getParent();if(parent){parent.raiseEvent(event);}},getRawObject:function(){var ret={},keys=this.getChildrenKeys(),len=keys.length,i;for(i=0;i<len;i++){var key=keys[i],child=this[key];if(child.isLeafNode()){ret[key]=child.getValue();}else{ret[key]=child.getRawObject();}}return ret;}});var NETVIZ_MODEL=mstrmojo.netviz.ObservableModel;}());