(function(){mstrmojo.requiresCls("mstrmojo.Dialog","mstrmojo.array","mstrmojo.dom","mstrmojo.css","mstrmojo._IsAnchorable");var $DOM=mstrmojo.dom,$ARR=mstrmojo.array;mstrmojo.VisHeatMapPopupPanel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.VisHeatMapPopupPanel",title:"",markupString:'<div id="{@id}" class="heatmap-popup-panel" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},initialized:false,naviAction:null});mstrmojo.VisHeatMapAnimation=(function(){var animationSet=[];return{animate:function(node,propName,orgStyle,targetStyle,duration,callback){var thisObj;var emptyPos=animationSet.length;for(var i=0,len=animationSet.length;i<len;i++){if(!animationSet[i]){emptyPos=i;continue;}if(animationSet[i].node===node&&animationSet[i].propName===propName){(animationSet[i].finalize(false));thisObj=animationSet[i];break;}}if(!thisObj){thisObj={};thisObj.node=node;thisObj.index=emptyPos;thisObj.propName=propName;animationSet[emptyPos]=thisObj;}var startTime=(new Date()).getTime();var duration=duration||500;var interval=20;var timer=null;thisObj.finalize=function(removeNode){clearInterval(timer);timer=null;if(targetStyle.r!==undefined){targetStyle.a=targetStyle.a||1;node.style[propName]="";}else{if(targetStyle.px!==undefined){node.style[propName]=targetStyle.px+"px";}}if(removeNode){delete animationSet[this.index];}if(callback){callback();}};function setStyle(){var curStyle={};var curTime=(new Date()).getTime();var timeDiff=curTime-startTime;if(timeDiff>=duration){thisObj.finalize(true);return ;}for(var prop in orgStyle){curStyle[prop]=(targetStyle[prop]-orgStyle[prop])*timeDiff/duration+orgStyle[prop];if(prop!=="a"){curStyle[prop]=Math.round(curStyle[prop]);}}if(curStyle.r){curStyle.a=curStyle.a||1;node.style[propName]="rgba("+curStyle.r+","+curStyle.g+","+curStyle.b+","+curStyle.a+")";}else{if(curStyle.px){node.style[propName]=curStyle.px+"px";}}}timer=setInterval(setStyle,interval);}};})();mstrmojo.VisHeatMapPopup=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.VisHeatMapPopup",fadeOnClose:false,autoClose:true,markupString:'<div style="display: -webkit-box; -webkit-box-align: start; -webkit-box-pack: center;position:absolute; left:0px; top:0px; z-index:100000; width: 100%; height:100%;"  id={@id} mstrAttach:mouseup,touchend><div id={@id} style=" position:relative; left: 0px; top: 0px; width:{@width}; background-color:#F5F5F5;z-index:100001;border:2px solid rgba(0, 0, 0, 0.1);-webkit-box-shadow:rgba(0, 0, 0, 0.45) 2px 2px 8px;"><div  class="heatmap-popup-panel-title" style="display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: center;position:relative; -webkit-box-sizing: border-box; margin-bottom:6px; padding-right: 25%; height:65px; width:100%; line-height:65px;vertical-align:bottom;color:#33b5e5;"></div><div style="height: 2px;width:100%;background-color:#33b5e5"></div><div style="width:100%; height:auto; position:relative;overflow:hidden; display: -webkit-box; -webkit-box-orient: horizontal"></div></div><div style="position:absolute;z-index:100000;top:0px;left:0px;width:100%;height:100%;background: rgba(0, 0, 0, 0.5);"></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild;},titleNode:function(){return this.domNode.firstChild.firstChild;},containerNode:function(){return this.domNode.firstChild.lastChild;},curtainNode:function(){return this.domNode.lastChild;}},baseTipClass:"heatmap-editor-tip",anchorOffset:42,hasCloseButton:true,goBack:function(){return this.close();},close:function(){this.domNode.style.webkitTransform="translate(-100000px,0px)";this.destroy();return true;},destroy:function(){this.onClose();if(this._super){this._super();}},postBuildRendering:function(){this._super();for(var i=0,len=this.panels.length;i<len;i++){if(i!==0){var div=document.createElement("div");div.style.cssText="position:relative;width:1px;color:grey;height:35px;text-align:center;background-color:grey;";this.titleNode.appendChild(div);}var div=document.createElement("div");div.style.cssText="-webkit-box-flex:1; line-height:65px;text-align:center; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center; height:100%;";if(i==0){div.style.cssText+="margin-left:16px;";}else{div.style.cssText+="margin-right:16px;";}div.setAttribute("panel",i);div.innerText=this.panels[i].title;this.titleNode.appendChild(div);}var that=this;document.body.appendChild(this.domNode);this.panelStack=this.defaultIndex?this.defaultIndex:0;this.navigateTo(this.panelStack);this.contentNode.style.marginTop=parseInt((document.body.offsetHeight-this.contentMaxHeight-this.titleNode.offsetHeight)/2)+"px";},onmouseup:function(event){if(event.e.target===this.curtainNode){this.close();return ;}var title=mstrmojo.dom.findAncestorByAttr(event.e.target,"panel",true,this.domNode);if(!title){return ;}title.node.style.backgroundColor="rgba(51, 181, 229, 0.6)";var callback=function(){mstrmojo.VisHeatMapAnimation.animate(title.node,"background",{r:51,g:181,b:229,a:0.6},{r:255,g:255,b:255,a:0});};var that=this;setTimeout(function(){setTimeout(function(){that.navigateTo(title.value);callback();},0);},0);},ontouchend:function(event){this.onmouseup(event);},highlightTitle:function(titleIndex){titleIndex=2*parseInt(titleIndex);if(isNaN(titleIndex)){return ;}var titles=this.titleNode.childNodes,len=titles.length;for(var i=0;i<len;i+=2){if(i!=titleIndex){titles[i].style.borderBottom="";}else{titles[i].style.borderBottom="solid 6px #33b5e5";}}},panelStack:0,navigateTo:function(panelIndex){if(this.owner&&this.owner.props){this.owner.props.navigatingIndex=panelIndex;}this.highlightTitle(panelIndex);var newPanel=this.panels[panelIndex];var curPanel=this.panelStack;var oldPanel=this.panels[curPanel];if(panelIndex!=curPanel){if(oldPanel.hasRendered){oldPanel.domNode.style.display="none";}}if(!newPanel.hasRendered){this.panels[panelIndex]=new mstrmojo.VisHeatMapPopupPanel(this.panels[panelIndex]);var newPanel=this.panels[panelIndex];this.addChildren(newPanel);this.renderChildren();}newPanel.domNode.style.display="block";if(newPanel.naviAction){newPanel.naviAction();}if(curPanel===panelIndex){delete newPanel.domNode.style.webkitTransform;}else{var oldWidth=oldPanel.domNode.offsetWidth+"px";var newWidth=newPanel.domNode.offsetWidth+"px";var maxWidth=Math.max(parseInt(oldWidth),parseInt(newWidth));delete newPanel.domNode.style.webkitTransition;var newStyle="";var oldStyle="";if(curPanel<panelIndex){newStyle="translate(-"+maxWidth+"px,0px)";oldStyle="translate(-"+maxWidth+"px,0px)";}else{newStyle="translate("+maxWidth+"px,0px)";oldStyle="translate("+maxWidth+"px,0px)";}this.panelStack=panelIndex;}},animation:function(newPanel,oldPanel,oldStyle){oldPanel.domNode.style.webkitTransform=oldStyle;newPanel.domNode.style.webkitTransform=oldStyle;},dummy:true});})();