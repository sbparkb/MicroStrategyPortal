(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.QueuedXHR");var _H=mstrmojo.hash;function _cb(me,n){return function(){if(me[n]){me[n]();}};}var _cache=[];function __getCache(me){var cch;switch(me.cacheLevel){case mstrmojo.AjaxCall.CACHELEVEL_LOCAL:if(me._cache==null){me._cache=[];}cch=me._cache;break;default:if(_cache==null){_cache=[];}cch=_cache;break;}return cch;}function __findCache(me){var cch=__getCache(me);var _r={cache:cch,idx:-1},params=me.params;if("xts" in params){delete params.xts;}for(var i=0,len=cch.length;i<len;i++){var c=cch[i];if(c&&_H.equals(c.url,me.url)&&_H.equals(c.params,params)){_r.idx=i;break;}}return _r;}function _saveToCache(me){var cch=__getCache(me),params=_H.copy(me.params);delete params.xts;cch.push({url:me.url,params:params,res:_H.copy(me.response)});}function _fetchCache(me){var f=__findCache(me);if(f&&f.idx>=0){me.response=f.cache[f.idx].res;return true;}return false;}mstrmojo.AjaxCall=mstrmojo.declare(mstrmojo.QueuedXHR,null,{scriptClass:"mstrmojo.AjaxCall",method:"POST",url:"",params:null,onsuccess:null,onerr:null,oncomplete:null,oncancel:null,readCache:false,writeCache:false,cacheLevel:"",_cache:null,useQueue:false,init:function init(props){this._super(props);_H.copy(props,this);},send:function sn(){var me=this;if(this.readCache&&_fetchCache(this)){this.onsuccess();return ;}this.request(this.method,this.url,{success:function(){if(me.writeCache){_saveToCache(me);}if(me&&me.onsuccess){me.onsuccess();}},failure:_cb(me,"onerr"),complete:_cb(me,"oncomplete")},this.params,!this.useQueue);},cancel:function cl(){this._super();if(this.oncancel){this.oncancel();}}});mstrmojo.AjaxCall.CACHELEVEL_GLOBAL="global";mstrmojo.AjaxCall.CACHELEVEL_LOCAL="local";})();