(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.registry","mstrmojo.css","mstrmojo.Arr","mstrmojo.expr","mstrmojo.Label","mstrmojo.AjaxCall","mstrmojo.HTMLButton","mstrmojo.Container","mstrmojo._HasPopup","mstrmojo.HBox","mstrmojo.Dial","mstrmojo.WidgetDial","mstrmojo.ValidationTextBox","mstrmojo.Calendar","mstrmojo.DateTextBox","mstrmojo.Editor","mstrmojo.ObjectBrowser","mstrmojo.ElementsBrowser","mstrmojo.ConditionModel","mstrmojo.mstr.EnumNodeDimty");var $CSS=mstrmojo.css,$REG=mstrmojo.registry,$HASH=mstrmojo.hash,$ARR=mstrmojo.array,$ARR_FIND=$ARR.find,$ARR_WRAP=mstrmojo.Arr,$EXPR=mstrmojo.expr,$DOM=mstrmojo.dom,$EXPRTYPE=$EXPR.ET,DTP=$EXPR.DTP,D2FD=$EXPR.DTP2FN_DTP,ET2TGT=$EXPR.ET2TGT,ET2TP=$EXPR.ET2TP,$META_TP=mstrmojo.meta.TP,$META_STP=mstrmojo.meta.STP,$ENCODE_XML_ATTR=mstrmojo.string.encodeXMLAttribute,DMT=mstrmojo.mstr.EnumNodeDimty;var DEFAULT_DIMTY_TYPES=$ARR.hash([DMT.NodeDimtyOutputLevel]);var ET2STEPS={};ET2STEPS[$EXPRTYPE.AQ]={target:1,fm:1,fn:1,c0:1,c1:1};ET2STEPS[$EXPRTYPE.AL]={target:1,fm:1,fn:1,c0:1};ET2STEPS[$EXPRTYPE.AE]={target:1,fm:1,es:1};ET2STEPS[$EXPRTYPE.AC]={target:1,fm:1,fm2:1,fm3:1,fn:1,c0:1,c1:1};ET2STEPS[$EXPRTYPE.MQ]={target:1,fn:1,c0:1,c1:1,dmy:1};ET2STEPS[$EXPRTYPE.MC]=ET2STEPS[$EXPRTYPE.MQ];ET2STEPS["*"]={target:1};var ET2FNS={};ET2FNS[$EXPRTYPE.MQ]={key:"metricFns",def:$EXPR.METRIC_FNS};ET2FNS[$EXPRTYPE.MC]={key:"metricFns",def:$EXPR.METRIC_FNS};ET2FNS[$EXPRTYPE.AQ]={key:"formFns",def:$EXPR.FORM_FNS};ET2FNS[$EXPRTYPE.AL]={key:"formFns",def:$EXPR.FORM_FNS};ET2FNS[$EXPRTYPE.AC]={key:"formFns",def:$EXPR.FORM_FNS};ET2FNS[$EXPRTYPE.AE]={key:"elemFns",def:$EXPR.ELEM_FNS};var BROWSETEXT={};BROWSETEXT[$EXPRTYPE.AQ]=mstrmojo.desc(7925,"Select Attribute...");BROWSETEXT[$EXPRTYPE.AL]=mstrmojo.desc(7926,"Browse...");BROWSETEXT[$EXPRTYPE.MQ]=mstrmojo.desc(7927,"Select Metric...");BROWSETEXT[$EXPRTYPE.MC]=mstrmojo.desc(7927,"Select Metric...");BROWSETEXT[$EXPRTYPE.AC]=mstrmojo.desc(7925,"Select Attribute...");function toggleSlot(w,s,show){var sty=w[s].style;if(mstrmojo.dom.isFF){sty.overflow="hidden";sty.width=show?"auto":"0px";sty.visibility=show?"inherit":"hidden";}else{sty.display=show?"block":"none";}}function updateOkBtn(me){var valid=true,model=me.model,i,count=model&&$EXPR.fnCstCount(model.fn,model.fnt);if(!model){return ;}switch(model.et){case $EXPRTYPE.AQ:case $EXPRTYPE.AL:case $EXPRTYPE.MQ:for(i=0;i<count;i++){valid=valid&&!me["invalid"+i];}break;}me.okBtn.set("enabled",valid&&!!model.completed);}function initSteps(me){var m=me.model,et=m&&m.et,steps=ET2STEPS[et]||ET2STEPS["*"],ch=me.children,i,len=ch.length;for(i=0;i<len;++i){var c=ch[i];if(!c.isStep){continue;}var a=c.alias,shw=steps[a];toggleSlot(me,c.slot,shw);if(shw&&c&&c.update){c.update();}}if(!steps.c1){toggleSlot(me,"btwnNode",false);}if(!steps.dmy){toggleSlot(me,"atNode",false);}updateOkBtn(me);}function walkChildPostCreateFn(){var p=this.parent,h=((p&&p.cssText)||"").match(/height:\s*(\d*)px/);this.cssText=h&&h[0];}var DUMMY_TP="dummy",BROWSE_ITEM={did:"idBrowse",v:"idBrowse",n:mstrmojo.desc(6571,"Browse..."),t:DUMMY_TP,css:"unselectable link"},ERROR_ITEM={did:"idErr",v:"idErr",n:mstrmojo.desc(7929,"Error loading data."),t:DUMMY_TP,css:"unselectable"},WAIT_ITEM={did:"idWait",v:"idWait",n:mstrmojo.desc(2901,"Loading..."),t:DUMMY_TP,css:"unselectable"};function onWalkChange(evt){if(this.updating){return ;}var ms=this.multiSelect,it=this.selectedItem;if(it&&it[$META_TP]===DUMMY_TP){this.updating=true;if(ms){this.removeSelect([this.selectedIndex]);}else{var idx=evt&&evt.removed&&Number(evt.removed[0]);idx=(idx==null)?-1:idx;this.set("selectedIndex",idx);}this.updating=false;if(it===BROWSE_ITEM){this.parent.browse(this);}}else{var m=this.parent.model;if(ms){var its=this.items;m.edit(this.alias,{added:evt.added&&$ARR.get(its,evt.added),removed:evt.removed&&$ARR.get(its,evt.removed),itemIdField:this.itemIdField});}else{m.edit(this.alias,it);}}}function replaceItem(w,item,arr){var its=w.items,idx=$ARR.indexOf(its,item);if((idx===0)&&(its.length===1)){arr=mstrmojo.Arr.makeObservable((arr&&arr.length)?arr.concat():[]);w.set("items",arr);}else{if(idx>-1){its.remove(idx,1);}if(arr&&arr.length){its.add(arr,(idx>-1)?idx:null);}}}function getChildJSON(ps){return $HASH.copy(ps,{scriptClass:"mstrmojo.Dial",slot:ps.alias+"Node",isStep:true,cssClass:"mstrmojo-walkstep mstrmojo-"+ps.alias,itemIdField:"did",itemMarkupFunction:function(item,idx,widget){var n=$ENCODE_XML_ATTR(item.n);return'<div class="dial-item '+item.css+'" title="'+n+'">'+n+"</div>";},allowUnlistedValues:true,insertUnlistedValuesAt:0,onchange:onWalkChange,postCreate:walkChildPostCreateFn});}function widgetItemFn(item,idx,widget){var config=item.cfg;if(config){config.data=item;config.parent=widget;return $REG.ref(config);}config=new mstrmojo.Label({text:item.n,cssClass:"dial-item"});config.markupMethods.onselectedChange=function(){mstrmojo.css.toggleClass(this.domNode,["selected"],this.selected);};config.data=item;config.parent=widget;return config;}function fnItem(fn,fnt){var d=fnt+$EXPR.FN_SEP+fn;return(fn!=null)?{did:d,n:d}:null;}function attachModel(){var model=this.model;if(model){if(!model.attachEventListener){mstrmojo.hash.make(model,mstrmojo.ConditionModel,{});}model.attachEventListener("edit",this.id,"onmodeledit");}}function initDmys(me){return me.targets?$ARR.filter(me.targets,function(item){return item[$META_TP]===$EXPR.TP.ATTR;}):[];}function detachModel(me,m){if(m&&m.detachEventListener){m.detachEventListener("edit",me.id,"onmodeledit");}}function updateList(w,show,items,sel){w.updating=true;toggleSlot(w.parent,w.slot,show);if(show){if(items!=null){w.clearSelect();w.set("items",items);}var f=w.itemIdField,vWas=w.selectedItem;if((vWas&&vWas[f])!=(sel&&sel[f])){w.set("selectedItem",sel);}else{w.center();}}w.updating=false;}function updateListMultiData(w,items,sel,idxs){w.updating=true;if(items!=null){}w.clearSelect();if(items){w.set("items",items);}if(sel&&sel.length){w.setSelectedItems(sel);}else{if(idxs&&idxs.length){w.select(idxs);}else{w.center();}}w.updating=false;}function updateListMulti(w,show,items,sel,idxs){toggleSlot(w.parent,w.slot,show);if(show){updateListMultiData(w,items,sel,idxs);}}function shouldShowCst(w,idx){var m=w.model||{},fn=m.fn;return(fn!=null)&&((m.et===$EXPRTYPE.MQ)||(m.et===$EXPRTYPE.MC)||(m.et===$EXPRTYPE.AQ)||(m.et===$EXPRTYPE.AL)||(m.et===$EXPRTYPE.AC))&&($EXPR.fnCstCount(fn,m.fnt)>idx);}var isDATE={};isDATE[DTP.DATE]=1;isDATE[DTP.TIME]=1;isDATE[DTP.TIMESTAMP]=1;function missedFn(arr1,arr2,p){var result=[],len=arr1.length,i;for(i=0;i<len;i++){if($ARR_FIND(arr2,p,arr1[i][p])<0){result.push(arr1[i]);}}return result;}function isComparisonAllowed(model,ets){var etAllowed;if(ets){switch(ET2TGT[model.et]){case"a":etAllowed=ets[$EXPRTYPE.AC];break;case"m":etAllowed=ets[$EXPRTYPE.MC];break;default:etAllowed=false;break;}}else{etAllowed=true;}return etAllowed&&$EXPR.fn_AC_MC(model&&model.fn);}function okCstTypes(m){var tp=m&&ET2TP[m.et],dtp=m&&m.fm&&m.fm.dtp,stp=dtp&&$EXPR.DTP2PROMPT_STP[dtp],ok={};ok[tp]=true;if(stp){ok[stp]=true;}return ok;}function updateCstList(parent){var lastModifiedTargets=this.targetsLastMod,plim=parent.targetsLastMod,model=parent.model,lastTargetId=this._lastTargetId,targetId=model&&model[ET2TGT[model.et]]&&model[ET2TGT[model.et]][parent.target.itemIdField],targetForm=model&&model.fm,targetType=targetForm&&targetForm.dtp,fnc=isComparisonAllowed(model,parent.ets),isDirty=false;if(!lastModifiedTargets||!plim||(lastModifiedTargets!=plim)||lastTargetId!==targetId){this.targetsLastMod=parent.targetsLastMod;isDirty=true;}else{if(this.lastFmDtp!==targetType){this.lastFmDtp=targetType;isDirty=true;}else{if(this.lastFnTp!==fnc){this.lastFnTp=fnc;isDirty=true;}}}if(isDirty){if(!fnc){this.clearSelect();this.set("items",this.items.slice(0,this.preLen));}else{var ok=okCstTypes(model),filteredTargets=parent.targets?$ARR.filter(parent.targets,function(item){return ok[item[$META_TP]]||ok[item[$META_STP]];}):[],slice=this.items.slice(this.preLen),itemIdField=this.itemIdField,removed=missedFn(slice,filteredTargets,itemIdField)||[],added=missedFn(filteredTargets,slice,itemIdField)||[],i,length;for(i=0,length=removed.length||0;i<length;i++){this.remove(removed[i]);}if(added.length>0){this.add(added,-1);}}this._lastTargetId=targetId;}}function updateCst(me,idx){me.updating=true;var parent=me.parent,show=shouldShowCst(parent,idx);toggleSlot(me.parent,me.slot,show);if(show){var m=parent.model||{},cs=m.cs,c=cs&&cs[idx],v=c&&c.v,dtp;updateCstList.call(me,parent);switch(m.et){case $EXPRTYPE.MQ:case $EXPRTYPE.MC:dtp=$EXPR.METRIC_DTP;break;case $EXPRTYPE.AQ:case $EXPRTYPE.AC:case $EXPRTYPE.AE:dtp=m.fm&&m.fm.dtp;break;case $EXPRTYPE.AL:dtp=m.fm&&m.fm.dtp;v=[];for(var i=0,len=cs&&cs.length;i<len;i++){v.push(cs[i].v);}v=v.join(mstrConfig.listSep);break;}dtp=dtp||DTP.CHAR;var isLF=$EXPR.fn_List(m.fn,m.fnt),isD=isDATE[dtp],isC=isD&&!isLF;var cx=me.ctxtBuilder,iws=cx&&cx.itemWidgets,si=isD?(isC?me.calIndex:me.dtxtIndex):me.txtIndex,ib=iws&&iws[me.bwIndex],iw;for(var i=0,len=me.preLen-1;i<len;i++){iw=iws[i];if(i==si){iw.set("dtp",dtp);iw.set("isList",isLF);iw.set("value",v);iw.set("visible",true);try{iw.focus&&iw.focus();}catch(x){}if(iw.clearValidation){iw.clearValidation();}}else{iw.set("visible",false);}if(isLF){iw.set("tooltip",mstrmojo.desc(8191,"value1## value2## ...## valueN").replace(/##/g,mstrConfig.listSep));}else{iw.set("tooltip","");}}if(ib){ib.set("text",BROWSETEXT[m.et]);ib.set("visible",parent.objectBrowsingEnabled&&isComparisonAllowed(m,parent.ets));}switch(m.et){case $EXPRTYPE.AQ:case $EXPRTYPE.AL:case $EXPRTYPE.MQ:if(c&&c.p){me.set("selectedItem",c.p);}else{me.set("selectedIndex",si);}break;case $EXPRTYPE.MC:case $EXPRTYPE.AC:me.set("selectedItem",m[ET2TGT[m.et]+(2+idx)]);break;}}toggleSlot(parent,"btwnNode",show);me.refreshScroll();me.updating=false;}function onCstChg(){var d=this.parent,w=d.parent,v=(this.isValid&&this.isValid())||(!this.isValid&&!mstrmojo.string.isEmpty(this.value)),m=w.model;w["invalid"+d.cstIndex]=!v;if(!this.updating&&v){this.updating=true;if(m){m.edit(d.alias,{v:this.value,dtp:this.dtp});}this.updating=false;}updateOkBtn(w);}function clearInvalid(){var d=this.parent,w=d.parent;w["invalid"+d.cstIndex]=false;}function cstJson(props){return getChildJSON($HASH.copy(props,{scriptClass:"mstrmojo.WidgetDial",makeObservable:true,itemFunction:widgetItemFn,selectionPolicy:"reselect",items:[{did:0,cfg:{scriptClass:"mstrmojo.ValidationTextBox",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL},onValid:onCstChg,onInvalid:onCstChg,onClearValidation:clearInvalid,size:6,cssText:"text-align:right",visible:false}},{did:1,cfg:{scriptClass:"mstrmojo.Calendar",onvalueChange:onCstChg,visible:false}},{did:2,cfg:{scriptClass:"mstrmojo.DateTextBox",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL},onValid:onCstChg,onInvalid:onCstChg,onClearValidation:clearInvalid,calendarToBody:true,calConfig:{onmousedown:function(evt){mstrmojo.dom.stopPropogation(evt.hWin,evt.e);}},visible:false}},{did:3,t:DUMMY_TP,cfg:{scriptClass:"mstrmojo.Label",cssClass:"dial-item link",text:"Browse...",onclick:function(){this.parent.parent.browse(this.parent);},visible:false}}],txtIndex:0,calIndex:1,dtxtIndex:2,bwIndex:3,preLen:4,insertUnlistedValuesAt:-1,update:function(){updateCst(this,this.cstIndex);}}));}function fmJson(ps){return getChildJSON($HASH.copy(ps,{insertUnlistedValuesAt:-1,postCreate:function(){walkChildPostCreateFn.apply(this,[]);this.ajx=mstrmojo.insert({parent:this,scriptClass:"mstrmojo.AjaxCall",isTask:true,readCache:true,writeCache:true,params:{taskId:"getAttributeForms",attributeId:null,displayedForms:"0",styleName:"MojoAttributeStyle"},onsuccess:function(){var p=this.parent,m=p&&p.parent&&p.parent.model,rs=this.response;if((rs&&rs.did)!==p.lastAttrId){return ;}var fms=rs.fms||[],sel=p.selectedItem;fms=$ARR.filter(fms,function(item){return(!item.icf);});if(sel){var idx=$ARR.find(fms,p.itemIdField,sel[p.itemIdField]);if(idx>-1){fms=fms.concat();fms.splice(idx,1);}}replaceItem(p,WAIT_ITEM,fms);var its=p.items,len=its.length;if(len===1){p.singleSelect(0);}},onerr:function(){replaceItem(this.parent,WAIT_ITEM,[ERROR_ITEM]);}});},update:function(){var pstf=this.fmPost,p=this.parent,m=p.model,t=m&&m["a"+pstf],show=!!t,fms,fm,tfm=m&&m.tfm,dtp=tfm&&tfm.dtp,ajx;if(show){switch(m.et){case $EXPRTYPE.AQ:case $EXPRTYPE.AL:fm=m.fm;break;case $EXPRTYPE.AC:fm=m["fm"+pstf];break;case $EXPRTYPE.AE:fm=fnItem(m.fn,1);break;}if(this.lastAttrId!==t.did){this.lastAttrId=t.did;fms=[];if(m.et!==$EXPRTYPE.AC){if(!t.ilk&&(!p.ets||p.ets[$EXPRTYPE.AE])){var lookin=ET2FNS[$EXPRTYPE.AE],key=lookin&&lookin.key;fms=fms.concat((key&&p[key])||lookin.def||[]);}}if(fm&&(m.et!==$EXPRTYPE.AE)){fms.push(fm);}ajx=this.ajx;ajx.params.attributeId=t.did;fms.push(WAIT_ITEM);$ARR_WRAP.makeObservable(fms);}}updateList(this,show,fms,fm);if(show&&ajx){if(ajx._delayId){window.clearTimeout(ajx._delayId);delete ajx._delayId;}ajx._delayId=window.setTimeout(function(){delete ajx._delayId;ajx.send();},500);}}}));}var TGT_PPT_STP=[$EXPR.STP.PROMPT,$EXPR.STP.PROMPT_OBJECTS,$EXPR.STP.PROMPT_ELEMENTS,$EXPR.STP.PROMPT_EXPRESSION,$EXPR.STP.PROMPT_EXPRESSION_DRAFT];function okTargetTps(exprTypes){if(exprTypes&&!$HASH.isEmpty(exprTypes)){var ok=$ARR.hash(TGT_PPT_STP);$HASH.forEach(exprTypes,function(allowed,et){if(allowed){ok[ET2TP[et]]=true;}});return ok;}return null;}function browseEs(me,ch,p){me.openPopup("eb",{zIndex:me.parent.zIndex+10,left:Math.round(p.x)+"px",top:Math.round(p.y)+"px"});var eb=me.eb.browser,m=me.model,aid=m&&m.a&&m.a.did;if(!aid){return ;}eb.set("attributeID",aid);eb.set("selectedItems",m.es?$HASH.clone(m.es):[]);eb.initBrowser();}function browseObjs(me,ch,p){me.openPopup("ob",{zIndex:me.parent.zIndex+10,left:Math.round(p.x)+"px",top:Math.round(p.y)+"px"});var ob=me.ob.browser;ob.target=ch;var tps;switch(ch.alias){case"dmy":tps=[$EXPR.TP.ATTR,$EXPR.TP.DIM];break;case"c0":case"c1":var model=me.model,expressionType=model&&model.et,fm=model&&model.fm,dtp=fm&&fm.dtp||(model.m?$EXPR.DTP.DECIMAL:$EXPR.DTP.UNKNOWN);tps=(expressionType===$EXPRTYPE.MQ||expressionType===$EXPRTYPE.MC)?[$EXPR.TP.METRIC,$EXPR.DTP2PROMPT_STP[dtp]]:[$EXPR.TP.ATTR,$EXPR.DTP2PROMPT_STP[dtp]];break;default:if(me.browsableTypes){tps=me.browsableTypes;}else{tps=okTargetTps(me.ets);tps=tps?$HASH.keyarray(tps,true):[$EXPR.TP.ATTR,$EXPR.TP.METRIC,$EXPR.STP.REPORT_GRID,$EXPR.STP.REPORT_GRAPH,$EXPR.STP.REPORT_ENGINE,$EXPR.STP.REPORT_TEXT,$EXPR.STP.REPORT_DATAMART,$EXPR.STP.REPORT_BASE,$EXPR.STP.REPORT_GRIDGRAPH,$EXPR.STP.REPORT_NONINTERACTIVE,$EXPR.STP.FILTER].concat(TGT_PPT_STP);}}tps[tps.length]=$EXPR.TP.FOLDER;ob.browse({folderLinksContextId:model&&(model.et===$EXPRTYPE.MQ||model.et===$EXPRTYPE.MC)?27:23,onSelectCB:[me,"onOBSelect"],browsableTypes:tps.join(",")});}mstrmojo.ConditionWalk=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ConditionWalk",markupString:'<table id="{@id}" class="mstrmojo-walk mstrmojo-ConditionWalk {@cssClass}" style="{@cssText}" cellspacing="0" cellpadding="0" mstrAttach:click><tr><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-notNode"><div class="mstrmojo-walkstep-wrapper"></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-targetNode"><div class="mstrmojo-walkstep-wrapper"><div class="mstrmojo-walkstep-browse">'+mstrmojo.desc(7926,"Browse...")+'</div></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-fmNode"><div class="mstrmojo-walkstep-wrapper"></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-esNode"><div class="mstrmojo-walkstep-wrapper"><div class="mstrmojo-walkstep-browse">'+mstrmojo.desc(7928,"Browse elements...")+'</div></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-fnNode"><div class="mstrmojo-walkstep-wrapper"></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-c0Node"><div class="mstrmojo-walkstep-wrapper"></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-fm2Node"><div class="mstrmojo-walkstep-wrapper"></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-btwnNode"><div class="mstrmojo-walkstep-wrapper">{@betweenText}</div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-c1Node"><div class="mstrmojo-walkstep-wrapper"></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-fm3Node"><div class="mstrmojo-walkstep-wrapper"></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-atNode"><div class="mstrmojo-walkstep-wrapper">{@atText}</div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-dmyNode"><div class="mstrmojo-walkstep-wrapper"><div class="mstrmojo-walkstep-browse">'+mstrmojo.desc(7925,"Select Attribute...")+'</div></div></td><td class="mstrmojo-walkcell mstrmojo-ConditionWalk-okNode"><div class="mstrmojo-walkstep-wrapper"><div></div></td></tr></table>',markupSlots:{notNode:function(){return this.domNode.rows[0].cells[0].firstChild;},targetNode:function(){return this.domNode.rows[0].cells[1].firstChild;},fmNode:function(){return this.domNode.rows[0].cells[2].firstChild;},esNode:function(){return this.domNode.rows[0].cells[3].firstChild;},fnNode:function(){return this.domNode.rows[0].cells[4].firstChild;},c0Node:function(){return this.domNode.rows[0].cells[5].firstChild;},fm2Node:function(){return this.domNode.rows[0].cells[6].firstChild;},btwnNode:function(){return this.domNode.rows[0].cells[7].firstChild;},c1Node:function(){return this.domNode.rows[0].cells[8].firstChild;},fm3Node:function(){return this.domNode.rows[0].cells[9].firstChild;},atNode:function(){return this.domNode.rows[0].cells[10].firstChild;},dmyNode:function(){return this.domNode.rows[0].cells[11].firstChild;},okNode:function(){return this.domNode.rows[0].cells[12].firstChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?$CSS.DISPLAY_TABLE:"none";},onobjectBrowsingEnabledChange:function(){this.targetNode.firstChild.style.display=this.objectBrowsingEnabled?"":"none";}},okBtn:undefined,updateBrowseElementsParams:function(params,attribute){params.attributeID=attribute.did;},children:[getChildJSON({alias:"target",insertUnlistedValuesAt:0,makeObservable:true,hideIfEmpty:true,update:function(){var parent=this.parent,model=parent.model;if(this.lastModel!==model){this.lastModel=model;var tgs=parent.targets,ets=parent.ets;if(ets&&tgs&&tgs.length){var ok=okTargetTps(parent.ets);tgs=$ARR.filter(tgs,function(item){return ok[item[$META_TP]];});}else{tgs=tgs?tgs.concat():[];}var et=model&&model.et,t=model&&model[ET2TGT[et]];updateList(this,true,tgs,t);}}}),fmJson({alias:"fm",fmPost:"",filter:false}),getChildJSON({alias:"es",itemIdField:"v",insertUnlistedValuesAt:0,makeObservable:true,itemMarkupFunction:function(item,idx,widget){var n=$ENCODE_XML_ATTR(item.n);return'<div class="dial-checkitem '+item.css+'" title="'+n+'">'+n+"</div>";},multiSelect:true,selectionPolicy:"toggle",postCreate:function pces(){walkChildPostCreateFn.apply(this,[]);this.ajx=mstrmojo.insert({parent:this,scriptClass:"mstrmojo.AjaxCall",isTask:true,params:{taskId:"browseElements",attributeID:null,styleName:"MojoAttributeStyle",blockBegin:1,blockCount:mstrApp.elementsBlockCount||30},onsuccess:function(){var p=this.parent,rs=this.response;if((rs&&rs.did)!==p.lastAttrId){return ;}var its=(rs&&rs.es)?rs.es.concat():[];updateListMultiData(p,its,p.parent.model&&p.parent.model.es,null);},onerr:function(){replaceItem(this.parent,WAIT_ITEM,[ERROR_ITEM]);}});},update:function udes(){var parent=this.parent,model=parent.model,a=model&&model.a,show=!!a&&!a.ilk,es,sel,idxs,ajx;if(show){if(this.lastAttrId!==a.did){this.lastAttrId=a.did;es=model.es;var len=es&&es.length;es=len?es.concat():[];es.push(WAIT_ITEM);if(len){idxs=[];for(var i=1;i<=len;i++){idxs[i]=i;}}ajx=this.ajx;parent.updateBrowseElementsParams(ajx.params,a);}else{sel=model.es;}}updateListMulti(this,show,es,sel,idxs);if(show&&ajx){ajx.send();}}}),getChildJSON({alias:"fn",allowUnlistedValues:false,update:function(){var p=this.parent,m=p.model||{},et=m.et,dtp,show=false,fns,sel;switch(et){case $EXPRTYPE.AE:show=!!m.a;break;case $EXPRTYPE.AQ:case $EXPRTYPE.AC:case $EXPRTYPE.AL:show=!!(m.fm&&m.fm.did);dtp=show?m.fm.dtp:null;break;case $EXPRTYPE.MQ:case $EXPRTYPE.MC:show=!!m.m;dtp=show?$EXPR.METRIC_DTP:null;break;}if(show){var fndtp=D2FD[dtp];if((this.lastEt!==et)||(this.lastFnDtp!==fndtp)){this.lastEt=et;this.lastFnDtp=fndtp;var lookin=et?ET2FNS[et]:null,k=lookin&&lookin.key;fns=(k&&p[k])||lookin.def||[];if(typeof (fns)==="object"){fns=fns[fndtp]||fns["*"];}}sel=fnItem(m.fn,m.fnt||1);}updateList(this,show,fns,sel);}}),cstJson({alias:"c0",cstIndex:0}),fmJson({alias:"fm2",fmPost:"2"}),cstJson({alias:"c1",cstIndex:1}),fmJson({alias:"fm3",fmPost:"3"}),getChildJSON({alias:"dmy",itemIdField:"did",hideIfEmpty:true,itemMarkupFunction:function(item,idx,widget){var n=$ENCODE_XML_ATTR(item.n);return'<div class="dial-checkitem '+item.css+'" title="'+n+'">'+n+"</div>";},multiSelect:true,selectionPolicy:"toggle",insertUnlistedValuesAt:0,makeObservable:true,postCreate:function(){walkChildPostCreateFn.apply(this,[]);this.set("items",initDmys(this.parent));},update:function uddmy(){var p=this.parent,m=p.model,et=m.et,t=m&&m.m,show=!!t&&(m.fn!==null)&&((et===$EXPRTYPE.MQ)||(et===$EXPRTYPE.MC))&&m.dimtyTypes[DMT.NodeDimtyOutputLevel],its,sel;if(show){var lim=this.targetsLastMod,plim=p.targetsLastMod;if(!lim||!plim||(lim!=plim)){this.targetsLastMod=p.targetsLastMod;its=initDmys(p);}sel=[];var uts=m.dmy&&m.dmy.uts;for(var u=0,uLen=(uts&&uts.length)||0;u<uLen;u++){var ut=uts[u];sel.push(ut.utgt?ut.utgt:ut);}}updateListMulti(this,show,its,sel);toggleSlot(p,"atNode",show);}}),{alias:"okBtn",slot:"okNode",scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),cssText:"width:66px;min-width:58px;",onclick:function(){var p=this.parent;if(p.onOK){p.onOK();}}},{alias:"cancelBtn",slot:"okNode",scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",cssText:"width:66px;min-width:58px;",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var p=this.parent.parent;if(p&&p.close){p.close();}}}],eb:{scriptClass:"mstrmojo.Editor",cssClass:$DOM.isIE7?"mstrmojo-ElementsEditorIE7":"mstrmojo-ElementsEditor",title:mstrmojo.desc(6149,"Select Elements"),help:"element_browser_dialog_box.htm",children:[{scriptClass:"mstrmojo.ElementsBrowser",alias:"browser",onUpdateBrowseElementsParams:function(params){var walk=this.parent.opener;walk.updateBrowseElementsParams(params,walk.model.a);}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-Editor-button",cssText:"width:72px;margin-right:2px;",onclick:function(){var editor=this.parent.parent,o=editor&&editor.opener;if(o){o.onEBSelect();o.closePopup();}}}]}]},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:302px;",fishEyeVisible:false,closeable:false,closeOnSelect:false,browsableTypes:"3,4,8,10,12,256",includeObjectDesc:true,quickSearch:true}]},betweenText:mstrmojo.desc(308,"and"),atText:mstrmojo.desc(5923,"at"),model:null,targets:null,ets:null,defaultEt:null,defaultAttrEt:null,metricFns:null,formFns:null,elemFns:null,metricLevels:null,defaultMetricLevel:null,browsableTypes:null,postBuildRendering:function pstBR(){attachModel.call(this);initSteps(this);return this._super();},_set_model:function setm(n,v){var vWas=this.model,chg=(v!==vWas);if(chg){detachModel(this,vWas);v.dimtyTypes=this.dimtyTypes||DEFAULT_DIMTY_TYPES;this.model=v;attachModel.call(this);if(this.hasRendered){initSteps(this);}}return chg;},onmodeledit:function(evt){switch(evt&&evt.prop){case"es":case"dmy":updateOkBtn(this);return ;}initSteps(this);},browse:function bws(childWidget){var prn=this.parent.editorNode,pos=function(el,pr){var pl=mstrmojo.dom.position(el,true),pt=mstrmojo.dom.position(pr,true);return{x:pl.x+pl.w,y:pt.y};};switch(childWidget&&childWidget.alias){case"target":case"dmy":browseObjs(this,childWidget,pos(childWidget.alias=="target"?this.targetNode:this.dmyNode,prn));break;case"c0":case"c1":browseObjs(this,childWidget,pos(childWidget.alias=="c0"?this.c0Node:this.c1Node,prn));break;case"es":browseEs(this,childWidget,pos(this.esNode,prn));break;}},onOBSelect:function(item){var ob=this.ob.browser,op=ob.target;this.closePopup();var f=op.itemIdField,ts=this.targets||[],idx=$ARR.find(this.targets,f,item[f]);if(idx===-1){ts.push(item);this.targets=ts;this.targetsLastMod=new Date();}op.setSelectedItems([item],op.multiSelect);op.refreshScroll();},onEBSelect:function(){var eb=this.eb.browser;var es=this.es;es.set("selectedIndices",{});es.setSelectedItems(eb.selectedItems,false);},onclick:function onclick(evt){var t=mstrmojo.dom.eventTarget(evt.hWin,evt.e);if(t==this.targetNode.firstChild){this.browse(this.target);}else{if(t==this.esNode.firstChild){this.browse(this.es);}else{if(t==this.dmyNode.firstChild){this.browse(this.dmy);}}}},objectBrowsingEnabled:true});})();