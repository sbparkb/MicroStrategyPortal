(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.Obj","mstrmojo.num","mstrmojo.array","mstrmojo.VisUtility");mstrmojo.requiresClsP("mstrmojo.gm","GMUtility","GMEnums","GMDataProvider");var $MOJO=mstrmojo,$ARR=$MOJO.array,$NUM=$MOJO.num,$HASH=$MOJO.hash,$GM=$MOJO.gm,GMUTIL=$GM.GMUtility,$VISUTILS=$MOJO.VisUtility,CHART_TYPE=$GM.EnumGraphType,CHART_SUBTYPE=$GM.EnumSubtype,COLOR_BY_TYPE=$GM.EnumColorByType,METRICS_POS=$GM.EnumMetricsPosition,ColorByAttrDelimiter=", ",ColorBySpaceDelimiter=" ",$FORM_SEP=" ",TT_DT=$GM.FormNameType;function copyAndFilterUndefined(arr){var resArr=[];arr.forEach(function(e){if(e!==undefined){resArr.push(e);}});return resArr;}function deleteSubtotal(){var attMap=this.attributesColorMap,attIdMap=this.attributesColorMapID,len=attMap.length,idLen,i,j,idsString,idsArr;for(i=0;i<len;i++){idsString=attIdMap[i];idsArr=typeof idsString==="string"?idsString.split(","):[idsString];idLen=idsArr.length;for(j=0;j<idLen;j++){var tt=parseInt(idsArr[j],10);if(tt===-1){attMap[i]=undefined;attIdMap[i]=undefined;}}}this.attributesColorMap=copyAndFilterUndefined(attMap);this.attributesColorMapID=copyAndFilterUndefined(attIdMap);}function nextEle(obj,idx){var i;if(idx>obj.mxIdx){return -1;}i=idx;while(true){if(obj[i]){return i;}i++;}}function getFormName(unit,disTp,formIdx,formCount){var unitName=unit.n,formName=unit.fs&&unit.fs[formIdx].n,resolvedTitle="";if(formName===undefined){formName=" ";}if(disTp===TT_DT.OFF){if(formIdx===0){resolvedTitle=unitName;}else{resolvedTitle="";}}else{if(disTp===TT_DT.ON){resolvedTitle=unitName+" "+formName;}else{if(disTp===TT_DT.FORM_NAME_ONLY){resolvedTitle=formName;}else{if(disTp===TT_DT.SHOW_ATT_NAME_ONCE){if(formIdx===0){resolvedTitle=unitName+" "+formName;}else{resolvedTitle=formName;}}else{if(disTp===TT_DT.AUTO){if(formCount===1){resolvedTitle=unitName;}else{resolvedTitle=unitName+" "+formName;}}}}}}return resolvedTitle;}function getFormsOfAttr(att,isRowAttribute,tui){var ttlDisTp=this.ttlDispTp,forms=[],i,len=isRowAttribute?att.cs:att.rs,singleForm;for(i=0;i<len;i++){if(att.otp===12){singleForm=$HASH.clone(att);singleForm.fid=singleForm.fs[i].id;delete singleForm.fs;singleForm.isRowAttribute=isRowAttribute;singleForm.tui=tui;singleForm.n=getFormName(att,ttlDisTp,i,len);forms.push(singleForm);}else{singleForm=$HASH.clone(att);if(att.fid!==undefined){singleForm.fid=att.fid;}else{singleForm.fid=att.id;}delete singleForm.fs;singleForm.isRowAttribute=isRowAttribute;singleForm.tui=tui;if(i===0){singleForm.n=att.n;}else{singleForm.n="";}forms.push(singleForm);}}return forms;}function elevateFormInfo(modelHs){var firstForm,attHeaderText,i,attObj,joinFormText=function(f){if(attHeaderText!==""){attHeaderText+=$FORM_SEP;}attHeaderText+=f.headerText;};$ARR.forEach(modelHs,function(lvl){i=0;while(i<=lvl.mxIdx){i=nextEle(lvl,i);attObj=lvl[i];attHeaderText="";firstForm=attObj.forms[0];attObj.cs=firstForm.cs;attObj.rs=firstForm.rs;attObj.headerID=firstForm.headerID;attObj.idx=firstForm.idx;attObj.o=firstForm.o;attObj.tui=firstForm.tui;attObj.ui=firstForm.ui;attObj.um=firstForm.um;attObj.stt=firstForm.stt;$ARR.forEach(attObj.forms,joinFormText);attObj.headerText=attHeaderText;i++;}});}function getDepthAndFormFromCorOrRow(unitsOnAxis,idx,isRow){var i,tot=0,att,len;if(unitsOnAxis&&unitsOnAxis.length>0){len=unitsOnAxis.length;for(i=0;i<len;i++){att=unitsOnAxis[i];if(!att.fcnt){att.fcnt=isRow?att.cs:att.rs;if(att.otp===-1){att.fcnt=1;}}if(tot+att.fcnt>idx){return{depth:i,formIndex:idx-tot};}tot+=att.fcnt;}}return -1;}function getMetricPropsFromIndex(metrics,idxArr,propNm){var len=idxArr.length,ids=[],id,mIdx,i;for(i=0;i<len;i++){mIdx=idxArr[i];if(mIdx>=0){id=(metrics.es[mIdx])[propNm];}else{id="-1";}ids.push(id);}return ids;}function convertArrayToMap2(arr){if(!arr||arr.length===0){return undefined;}var map={},i,n=arr.length;for(i=0;i<n;++i){map[arr[i]]=i;}return map;}function getLeftChildIndexOfDepth(depth,header){if(header===null||depth<=0){return -1;}var iLeft=0;if(depth===1){iLeft=header.children[0].levelIndex;}else{var leftNode=header.children[0];var i;for(i=1;i<depth;++i){leftNode=leftNode.children[0];}iLeft=leftNode.levelIndex;}return iLeft;}function constructAttrColorNodeCombinations(colorAttrsIndex,headerHierarchy,oRightChildIndexes){if(colorAttrsIndex===null||colorAttrsIndex.length===0||headerHierarchy===null||oRightChildIndexes===null){return null;}var nAttrs=colorAttrsIndex.length,upperIndex=colorAttrsIndex[0],upperHeaders=headerHierarchy[upperIndex.index];if(nAttrs===1){return upperHeaders;}var i,j,lowerIndex={},lowerHeaders=[],combinHeaders=[upperHeaders],childNums=[];for(i=1;i<nAttrs;++i){lowerIndex=colorAttrsIndex[i];lowerHeaders=headerHierarchy[lowerIndex.index];combinHeaders.push(lowerHeaders);childNums=[];oRightChildIndexes.push(childNums);var depth=lowerIndex.index-upperIndex.index;j=0;var upperNodeIndex=0;while(j<=upperHeaders.mxIdx){j=nextEle(upperHeaders,j+1);if(j===-1){break;}childNums[upperNodeIndex]=getLeftChildIndexOfDepth(depth,upperHeaders[j]);upperNodeIndex=j;}childNums[upperNodeIndex]=lowerHeaders.mxIdx+1;upperIndex=lowerIndex;upperHeaders=lowerHeaders;}return combinHeaders;}function filterFormat(v){v=v.replace(/\(/g,"-");v=v.replace(/\)/g,"");v=v.replace("$","");v=v.replace(/ /g,"");v=v.replace(/&nbsp;/g,"");v=v.replace(/,/g,"");if(isNaN(v[0])){return v.slice(1);}return v;}function getDataInLocalDataSet(i,j,raw,metricIndex){if(!this.items[i]){$VISUTILS.visPrint("Cannot find data at index ("+i+", "+j+")");}var o=this.items[i][j];if(o===undefined){return null;}if(o===""||o.rv===""||o.rv==="--"){return null;}if(raw===undefined||raw===true){if(o.rv!==undefined){return GMUTIL.parseNumeric(o.rv);}var v=GMUTIL.parseNumeric(filterFormat(o.v));if(isNaN(v)){$VISUTILS.visPrint("NaN from GetDataInLocalDataSet");filterFormat(o.v);}return v;}if(o.v!==undefined){return o.v;}var mask=this.getMetricNumberFormat(metricIndex);if(metricIndex!==undefined){return $NUM.formatByMask(mask,o.rv);}return GMUTIL.parseNumeric(o.rv);}function getPropValueInLocalDataSet(i,j,prop){if(!this.items[i]){$VISUTILS.visPrint("Cannot find data at index ("+i+", "+j+")");}var o=this.items[i][j];if(o===""){return null;}return o[prop];}function seperateArray(arr,idxBase,idxArr,arrNotInIndexArr){var elementsInIndexArr=[],idxCnt=idxArr.length,i,arrCnt=arr.length,localIndexArr=[],idx,localIdx;for(i=0;i<idxCnt;i++){idx=idxArr[i];localIdx=idx-idxBase;if(localIdx>=0&&localIdx<=arrCnt-1){elementsInIndexArr.push(arr[localIdx]);localIndexArr.push(localIdx);}}if(arrNotInIndexArr){var localIndexCnt=localIndexArr.length;var start=0;var end;for(i=0;i<localIndexCnt;i++){end=localIndexArr[i];var aSection=arr.slice(start,end);arrNotInIndexArr.push(aSection);start=end+1;}}return elementsInIndexArr;}function extractTotalValuesForASpecificMetric(arr,partition,cct,mcnt,arrNoneTotal,hasTotal){var ptCnt=partition.length,i,totalValues=[],start,end,colCnt,colCntForAMetric,j=0,itCnt,nonTotalRowsInAGroup;for(i=0;i<ptCnt;i++){start=partition[i];if(i===ptCnt-1){end=cct;}else{end=partition[i+1];}colCnt=end-start;colCntForAMetric=colCnt/mcnt;itCnt=colCntForAMetric;nonTotalRowsInAGroup=[];while(itCnt--){if(hasTotal){if(itCnt===0){totalValues.push(arr[j]);}else{if(arrNoneTotal){nonTotalRowsInAGroup.push(arr[j]);}}j++;}else{nonTotalRowsInAGroup.push(arr[j]);j++;}}if(arrNoneTotal){arrNoneTotal.push(nonTotalRowsInAGroup);}}return totalValues;}function extractTotalValuesForMetricInColumnRange(arr,mcnt,arrNoneTotal,hasTotal,totalStartCols,piePpt){var i,totalValues=[],colCntForAMetric,nonTotalRowsInAGroup;colCntForAMetric=(arr||[]).length;nonTotalRowsInAGroup=[];if(hasTotal){for(i=0;i<colCntForAMetric;i++){var oneArray=arr[i];if(oneArray&&oneArray.length&&totalStartCols.indexOf(oneArray[0].C)!==-1){totalValues.push(oneArray);arrNoneTotal.push(nonTotalRowsInAGroup);nonTotalRowsInAGroup=[];}else{nonTotalRowsInAGroup.push(arr[i]);}}}else{var piePptColsObj={};(piePpt||[]).forEach(function(colIndex){piePptColsObj[colIndex/mcnt]=true;});for(i=0;i<colCntForAMetric;i++){if(piePptColsObj[i]&&i!==0){arrNoneTotal.push(nonTotalRowsInAGroup);nonTotalRowsInAGroup=[];nonTotalRowsInAGroup.push(arr[i]);}else{nonTotalRowsInAGroup.push(arr[i]);}}arrNoneTotal.push(nonTotalRowsInAGroup);}return totalValues;}function splitArr(arr,idxBase,idxArr){var idxCnt=idxArr.length,i,localIdx,idx,arrLen=arr.length,start=0,end=0,output=[],aSection;for(i=0;i<idxCnt;i++){idx=idxArr[i];localIdx=idx-idxBase;if(localIdx>=0&&localIdx<=arrLen-1){if(localIdx===0){continue;}end=localIdx;aSection=arr.slice(start,end);output.push(aSection);start=end;}else{if(localIdx>arrLen-1){break;}}}aSection=arr.slice(start);output.push(aSection);return output;}function isInt(num){return parseInt(num,10)===num;}function getElementsFromDiscreteArray(obj,limit,formIndex,axis){var i=0,o,ceiling=obj.mxIdx,res=[],form,attr=axis===0?"rs":"cs";while(i<=ceiling){o=obj[i];if(o){form=o.forms[formIndex];res.push(form);i+=form[attr]||1;}else{i+=1;}if(limit>0&&i>limit){break;}}return res;}function unitInZone(unitObj,zoneName){var dropzones;if(zoneName==="All"){return true;}dropzones=unitObj.dropzones;if(dropzones){if(dropzones.indexOf(zoneName)>=0){return true;}}return false;}function collectHeaderObj(leafObj,res,endIdx){if(leafObj.ui!==endIdx){if(leafObj.pHd){collectHeaderObj(leafObj.pHd,res);}}res.push(leafObj);}function collectHeaderObjInDZ(zoneName,leafObj,res,axisName){var unitObj,gts=this.gts,axisOnGts;if(!leafObj){return ;}if(zoneName==="all"||zoneName===undefined){if(zoneName===undefined){$VISUTILS.visPrint("zoneName use 'all' instead of undefined!");}collectHeaderObj(leafObj,res);return ;}if(leafObj.pHd){collectHeaderObjInDZ.call(this,zoneName,leafObj.pHd,res,axisName);}axisOnGts=(axisName==="row"?gts.row:gts.col);unitObj=axisOnGts[leafObj.ui];if(unitInZone.call(this,unitObj,zoneName)){res.push(leafObj);}}function getTextContent(node){return node.textContent||node.innerText||node.nodeValue||"";}function headersUnitsIndex(unitsOnAxis,headerObjList,xvar){var res=[],ho,unit,header,unitIdIndex,unitId,i;for(i=0;i<headerObjList.length;i++){ho=headerObjList[i];unit=unitsOnAxis[ho.ui];unitId=unit.id;header=unit.es[ho.idx];unitIdIndex=xvar.indexOf(unitId);if(unitIdIndex>=0){res[unitIdIndex]=ho.idx;}}return res;}function translateToIndentityInfo(unitsOnAxis,headerObjList){var res=[],ho,unit,fcnt,header,len=headerObjList.length,f,i;for(i=0;i<len;i++){ho=headerObjList[i];fcnt=ho.forms.length;unit=unitsOnAxis[ho.ui];for(f=0;f<fcnt;f++){header=unit.es[ho.forms[f].idx];res.push({unit:unit,header:header,o:ho.o,tui:ho.tui,dpt:ho.tui+1});}}return res;}function decodeHTMLText(encodedText){return GMUTIL.restoreSpecialChars(encodedText);}function fetchHeaderProp(header,prop){var usePList=false,pList,pValue;if(prop){pList=prop.split("&");if(pList.length>1){usePList=true;}}if(header===undefined){var fakedProp;if(usePList){fakedProp={};$ARR.forEach(pList,function(p){fakedProp[p]="";});}else{fakedProp="";}return fakedProp;}if(prop){if(usePList){var obj={};$ARR.forEach(pList,function(p){pValue=header[p];if(pValue!==undefined&&typeof pValue==="string"){pValue=decodeHTMLText(header[p]);}obj[p]=pValue;});return obj;}return decodeHTMLText(header[prop]);}return header;}function translateToHeaderInfo(unitsOnAxis,headerObjList,prop,keepFormsTogehter){var res=[],ho,hoCp,unit,header,hdLen=headerObjList.length,f,i,fcnt;for(i=0;i<hdLen;i++){ho=headerObjList[i];if(ho.stt===1){continue;}fcnt=ho.forms.length;unit=unitsOnAxis[ho.ui];header=unit.es[ho.idx];var container;if(keepFormsTogehter===true){var attObj={forms:[]};res.push(attObj);container=attObj;}else{container=res;}for(f=0;f<fcnt;f++){var idx=ho.forms[f].idx;if(idx>=0){header=unit.es[idx];if(prop.length===1&&header&&header[prop]!==undefined){container.push(fetchHeaderProp(header,prop));}else{hoCp=hoCp||$HASH.copy(ho);$HASH.copy(ho.forms[f],hoCp);header.tid=unit.id;container.push(fetchHeaderProp($HASH.copy(header,hoCp),prop));}if(f===fcnt-1){hoCp=null;}}else{container.push("");}}}return res;}function translateLowestHeaderInfo(unitsOnAxis,headerObjList,prop){var res=[],ho,unit,header,i,eleAllEmpty=true;for(i=0;i<headerObjList.length;i++){ho=headerObjList[i];unit=unitsOnAxis[ho.ui];header=unit.es[ho.idx];if(fetchHeaderProp(header,prop)!==""){eleAllEmpty=false;}res.push(fetchHeaderProp(header,prop));}if(eleAllEmpty){res.push(fetchHeaderProp(unit,prop));}return res;}function compactHeadersIfNeed(hds,nameOfSpan){var mxIdx=hds.mxIdx,i,hdr,doCheck=true,needToCompact=false,currentSpan,lastIdx=-1,currentIdx,firstHeaderObjForLastIndex=null,newMxIdx;for(i=0;i<=mxIdx;i++){hdr=hds[i];if(hdr){if(doCheck){var nextI=nextEle(hds,i+1);var nextElement=hds[nextI];if(nextElement.idx===hdr.idx){needToCompact=true;}doCheck=false;if(needToCompact===false){return ;}}currentIdx=hdr.idx;if(currentIdx!==lastIdx){if(firstHeaderObjForLastIndex){firstHeaderObjForLastIndex[nameOfSpan]=currentSpan;}currentSpan=1;lastIdx=currentIdx;firstHeaderObjForLastIndex=hdr;}else{delete hds[i];currentSpan++;}}}if(firstHeaderObjForLastIndex){firstHeaderObjForLastIndex[nameOfSpan]=currentSpan;}if(needToCompact){for(i=0;i<=mxIdx;i++){if(hds[i]){newMxIdx=i;}}hds.mxIdx=newMxIdx;}}function createNumLeaves(hds,nameOfSpan){var mxIdx=hds.mxIdx,i,hdr,hdrFirstForm,span,isCol,metricCnt=this.getMetricCount(),divisor=metricCnt>0?metricCnt:1;isCol=(nameOfSpan==="cs");for(i=0;i<=mxIdx;i++){hdr=hds[i];if(hdr){hdrFirstForm=hdr.forms[0];span=hdrFirstForm[nameOfSpan];if(!span){span=1;}if(isCol){hdr.numLeaves=span/divisor;}else{hdr.numLeaves=span;}hdr.levelIndex=i;}}}function createChsRef(pHds,cHds,nameOfSpan){var mxIdx=cHds.mxIdx,pIdx=0,cHd,cHdFirstForm,pSpan,cSpan,pHd,pHdFirstForm,i;for(i=0;i<=mxIdx;i++){cHd=cHds[i];cHdFirstForm=cHd&&cHd.forms[0];if(cHd){while(true){pIdx=nextEle(pHds,pIdx);pHd=pHds[pIdx];if(pHds.isCustomGroupWithBanding){pHdFirstForm=pHd.forms[1];}else{pHdFirstForm=pHd.forms[0];}if(!pHd.children){pHd.children=[];}pSpan=pHdFirstForm[nameOfSpan];if(!pSpan){pSpan=1;}cSpan=cHdFirstForm[nameOfSpan];if(!cSpan){cSpan=1;}if(pHdFirstForm.o<=cHdFirstForm.o&&(pHdFirstForm.o+pSpan)>=(cHdFirstForm.o+cSpan)){cHd.pHd=pHd;cHd.pHdIdx=pIdx;pHd.children.push(cHd);break;}else{pIdx++;}}}}}function filterDuplicateColorByItems(res){var i,eles,rets=[],key,token,keyMap={};for(i in res){token=res[i].token;if(token){eles=token.elements;key=eles.join();if(keyMap[key]===undefined){keyMap[key]=true;rets.push(res[i]);}}else{rets.push(res[i]);}}return rets;}function mergeCGForm(data,axis){var mxIdx=data.mxIdx,i=0,j,o,attr=axis==="r"?"rs":"cs",step,item,span;while(i<=mxIdx){item=data[i];if(!item){i+=1;continue;}o=item.forms[0].o;span=item.forms[0][attr]||1;if(span>1){j=i+(item.forms[1][attr]||1);while(j<span+o){if(data[j]){step=data[j].forms[0][attr]||1;data[j].forms.splice(0,0,item.forms[0]);j+=step;}else{j+=1;}}}i+=span;}}var LocalDataSet=mstrmojo.declare(mstrmojo.Obj,null,{grpCnt:-1,srsCnt:-1,dps:null,getChartInfo:function(){return this.gmm.getChartInfo();},getTooltipForChartHeader:function(contentArr,axis,forSelection){var model=this.gmm,gmCtr=model.gmCtr,rcnt=gmCtr.rowHeaderCnt,ccnt=gmCtr.colHeaderCnt,hdCnt,titleArr,isRowAttribute=axis==="r",headerArr;if(isRowAttribute){if(rcnt===0){return ;}if(contentArr.length>0){if(!forSelection){contentArr.push(null);}}hdCnt=rcnt;titleArr=model.getRowTitleInfo();headerArr=this.getRowHeaders(0,"Rows","n&id&dei&o&at&idx");}else{if(ccnt===0){return ;}if(contentArr.length>0){if(!forSelection){contentArr.push(null);}}hdCnt=ccnt;titleArr=model.getColTitleInfo();headerArr=this.getColHeaders(0,"Columns","n&id&dei&o&at&idx");}GMUTIL.generateToolTipContent(0,hdCnt,isRowAttribute,titleArr,headerArr,contentArr);},getColorByValue:function(i,j,mtsIdxArr,useDefaults){var model=this.gmm,gmCtr=model.gmCtr,docModel=gmCtr.view.model.docModel,globalAttrMetricsColorMap=model.globalAttrMetricsColorMap,colorType=model.colorType,token,color,palette=gmCtr.palette,colorCnt=palette.length,attMtsColorMap=model.attrMetricsColorMapIDMap,colorIdx,ti,thObj,threshold=gmCtr.thresholds,colorByMtc,colorColumnCoordinate,mtsColorMapID=model.metricsColorMapID;if(useDefaults===undefined){useDefaults=true;}if(colorType===COLOR_BY_TYPE.METRICS){colorByMtc=gmCtr.getColorByMetrics()[0];colorColumnCoordinate=this.getAssoCoordinatesWithMetricIndex(i,[j],colorByMtc);ti=this.getPropValue(i,colorColumnCoordinate.C-this.getOffsetX(),"ti");if(ti!==undefined){ti=parseInt(ti,10)-1;thObj=threshold[ti];return(thObj.fmt&&thObj.fmt.bc)?mstrmojo.VisUtility.parseCSSColor(thObj.fmt.bc,true):gmCtr.property.defaultsObj.shpFillClr;}if(useDefaults){return gmCtr.property.defaultsObj.shpFillClr;}else{return null;}}else{if(colorType===COLOR_BY_TYPE.NULL){return null;}}token=this.getColorByToken(i,j,mtsIdxArr);if(colorType===COLOR_BY_TYPE.METRICS_ITEM){colorIdx=mtsColorMapID.indexOf(token);}else{colorIdx=attMtsColorMap&&attMtsColorMap[token];}if(colorIdx===undefined||colorIdx<0){return null;}if(gmCtr.globalColorMapping){var globalToken=globalAttrMetricsColorMap[colorIdx];color=globalToken&&docModel.getColorBy(globalToken.levels,globalToken.elements).color;}else{color=palette[colorIdx%colorCnt];}return color;},getColorByToken:function(i,j,mtsIdxArr){var model=this.gmm,gmCtr=model.gmCtr,colorType=model.colorType,rowColorByInfo=gmCtr.getRowColorAttrsIndex(),colColorByInfo=gmCtr.getColColorAttrsIndex(),tokenArr=[],k,len,mtcIdx,mtcCnt,token,orderObj,mtcId,rowHds,colHds;if(colorType===COLOR_BY_TYPE.METRICS_ITEM){mtcCnt=model.getMetricCount();if(mtcCnt>0){if(mtsIdxArr&&mtsIdxArr.length>0){$ARR.forEach(mtsIdxArr,function(mtcIdx){mtcId=(model.getMetricIds())[mtcIdx];tokenArr.push(mtcId);});token=tokenArr.join(ColorByAttrDelimiter);return token;}mtcIdx=j%mtcCnt;mtcId=(model.getMetricIds())[mtcIdx];return mtcId;}$VISUTILS.visPrint("metric count is zero!!");return"";}if(colorType===COLOR_BY_TYPE.ATT||colorType===COLOR_BY_TYPE.ATT_METRICS){len=rowColorByInfo.length;if(len>0){rowHds=this.getHeaderObjectList(i,0,"all");}for(k=0;k<len;k++){orderObj=rowColorByInfo[k];tokenArr[orderObj.order]=rowHds[orderObj.index];}len=colColorByInfo.length;if(len>0){colHds=this.getHeaderObjectList(j,1,"all");}for(k=0;k<len;k++){orderObj=colColorByInfo[k];tokenArr[orderObj.order]=colHds[orderObj.index];}}else{$VISUTILS.visPrint("Unsupported Color By Type!");}len=tokenArr.length;for(k=0;k<len;k++){tokenArr[k]=tokenArr[k].idx;}if(colorType===COLOR_BY_TYPE.ATT_METRICS&&mtsIdxArr){var mLen=mtsIdxArr.length,x;for(x=0;x<mLen;x++){mtcIdx=mtsIdxArr[x];mtcId=(model.getMetricIds())[mtcIdx];tokenArr.push(mtcId);}}token=tokenArr.join(ColorByAttrDelimiter);return token;},getHeaderObjectList:function getHeaderObjectList(ordinal,axis,dropzone){var model=this.gmm,modelRhs=model.modelRhs,modelChs=model.modelChs,hol=[],leafObj,lastAttHeaders;if(axis===0){lastAttHeaders=(modelRhs[modelRhs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[ordinal+this.oy];collectHeaderObjInDZ.call(model,dropzone,leafObj,hol,axis===0?"row":"col");}}else{lastAttHeaders=(modelChs[modelChs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[ordinal+this.ox];collectHeaderObjInDZ.call(model,dropzone,leafObj,hol,axis===0?"row":"col");}}return hol;},getRowHeaders:function getRowHeaders(i,dropzone,propNames){var rowHeaderPool,key=[i,dropzone,propNames].join(":");if(this.rowHeaderPool===undefined){this.rowHeaderPool={};}rowHeaderPool=this.rowHeaderPool;if(rowHeaderPool[key]){return rowHeaderPool[key];}var model=this.gmm,modelRhs=model.modelRhs,hol=[],unitsOnAxis,lbs,leafObj,lastAttHeaders=(modelRhs[modelRhs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[i+this.oy];collectHeaderObjInDZ.call(model,dropzone,leafObj,hol,"row");unitsOnAxis=this.gmm.gts.row;lbs=translateToHeaderInfo(unitsOnAxis,hol,propNames);}rowHeaderPool[key]=lbs;return lbs;},getColHeaders:function getColHeaders(i,dropzone,propNames){var colHeaderPool,key=[i,dropzone,propNames].join(":");if(this.colHeaderPool===undefined){this.colHeaderPool={};}colHeaderPool=this.colHeaderPool;if(colHeaderPool[key]){return colHeaderPool[key];}var model=this.gmm,modelChs=model.modelChs,hol=[],unitsOnAxis,lbs,leafObj,lastAttHeaders=modelChs[modelChs.length-1];if(lastAttHeaders){leafObj=lastAttHeaders[i+this.ox];collectHeaderObjInDZ.call(model,dropzone,leafObj,hol,"col");unitsOnAxis=this.gmm.gts.col;lbs=translateToHeaderInfo(unitsOnAxis,hol,propNames||"n");}colHeaderPool[key]=lbs;return lbs;},getSeriesLabel:function getSeriesLabel(i,j,headerInfo){var leafObj,model=this.gmm,lbs,hol=[],unitsOnAxis=null,groupLabelOnColumn=false,chtInfo=this.getChartInfo(),eDI=$GM.EnumABLDirection,chtTp=chtInfo.tp,eGT=CHART_TYPE,lastAttHeaders;if(chtInfo.isABL&&chtInfo.dirc===eDI.VERTICAL){groupLabelOnColumn=true;}else{if(chtInfo.isABL&&chtInfo.dirc===eDI.HORIZONTAL){groupLabelOnColumn=false;}else{if(chtTp===eGT.BUBBLE||chtTp===eGT.SCATTER){groupLabelOnColumn=true;}else{if(chtTp===eGT.GRID){groupLabelOnColumn=true;}else{$VISUTILS.visPrint("need to be implemented for this chart type!");}}}}if(groupLabelOnColumn){var modelRhs=this.gmm.modelRhs;if(!modelRhs||modelRhs.length===0){return[];}lastAttHeaders=(modelRhs[modelRhs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[i+this.oy];collectHeaderObjInDZ.call(model,"YAxis",leafObj,hol,"row");unitsOnAxis=this.gmm.gts.row;if(headerInfo===true){lbs=translateToIndentityInfo(unitsOnAxis,hol);}else{lbs=translateToHeaderInfo(unitsOnAxis,hol,"n");}}}else{var modelChs=this.gmm.modelChs;if(!modelChs||modelChs.length===0){return[];}lastAttHeaders=(modelChs[modelChs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[this.ox+j];collectHeaderObjInDZ.call(model,"XAxis",leafObj,hol,"col");unitsOnAxis=this.gmm.gts.col;if(headerInfo===true){lbs=translateToIndentityInfo(unitsOnAxis,hol);}else{lbs=translateToHeaderInfo(unitsOnAxis,hol,"n");}}}return lbs;},getGroupElementIndexArray:function(i,j,xvar){var leafObj,elementIndexArr,model=this.gmm,clusteredBarSpecialCase=model.clusteredBarSpecialCase,hol=[],unitsOnAxis=null,groupLabelOnColumn=false,chtInfo=this.getChartInfo(),eDI=$GM.EnumABLDirection,lastAttHeaders;if(clusteredBarSpecialCase){return[-1];}if(chtInfo.isABL&&chtInfo.dirc===eDI.VERTICAL){groupLabelOnColumn=true;}else{if(chtInfo.isABL&&chtInfo.dirc===eDI.HORIZONTAL){groupLabelOnColumn=false;}}if(groupLabelOnColumn){var modelChs=this.gmm.modelChs;if(!modelChs||modelChs.length===0){return[];}lastAttHeaders=(modelChs[modelChs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[this.ox+j];collectHeaderObjInDZ.call(model,"XAxis",leafObj,hol,"col");unitsOnAxis=this.gmm.gts.col;elementIndexArr=headersUnitsIndex(unitsOnAxis,hol,xvar);}}else{var modelRhs=this.gmm.modelRhs;if(!modelRhs||modelRhs.length===0){return[];}lastAttHeaders=(modelRhs[modelRhs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[this.oy+i];collectHeaderObjInDZ.call(model,"YAxis",leafObj,hol,"row");unitsOnAxis=this.gmm.gts.row;elementIndexArr=headersUnitsIndex(unitsOnAxis,hol,xvar);}}return elementIndexArr;},getGroupLabel:function getGroupLabel(i,j,headerInfo){var leafObj,lbs,model=this.gmm,clusteredBarSpecialCase=model.clusteredBarSpecialCase,hol=[],unitsOnAxis=null,groupLabelOnColumn=false,chtInfo=this.getChartInfo(),eDI=$GM.EnumABLDirection,chtTp=chtInfo.tp,eGT=CHART_TYPE,mcnt=model.getMetricCount(),lastAttHeaders;if(clusteredBarSpecialCase){if(headerInfo===true){var k,fakeRes=[];for(k=0;k<mcnt;k++){fakeRes.push({isAtt:false});}return fakeRes;}return[model.getMetricNames()[j%mcnt]];}if(chtInfo.isABL&&chtInfo.dirc===eDI.VERTICAL){groupLabelOnColumn=true;}else{if(chtInfo.isABL&&chtInfo.dirc===eDI.HORIZONTAL){groupLabelOnColumn=false;}else{if(chtTp===eGT.BUBBLE||chtTp===eGT.SCATTER){groupLabelOnColumn=true;}else{if(chtTp===eGT.GRID){groupLabelOnColumn=true;}else{$VISUTILS.visPrint("need to be implemented for this chart type!");}}}}if(groupLabelOnColumn){var modelChs=this.gmm.modelChs;if(!modelChs||modelChs.length===0){return[];}lastAttHeaders=(modelChs[modelChs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[this.ox+j];collectHeaderObjInDZ.call(model,"XAxis",leafObj,hol,"col");unitsOnAxis=this.gmm.gts.col;if(headerInfo===true){lbs=translateToIndentityInfo(unitsOnAxis,hol);}else{lbs=translateToHeaderInfo(unitsOnAxis,hol,"n");}}}else{var modelRhs=this.gmm.modelRhs;if(!modelRhs||modelRhs.length===0){return[];}lastAttHeaders=(modelRhs[modelRhs.length-1]);if(lastAttHeaders){leafObj=lastAttHeaders[this.oy+i];collectHeaderObjInDZ.call(model,"YAxis",leafObj,hol,"row");unitsOnAxis=this.gmm.gts.row;if(headerInfo===true){lbs=translateToIndentityInfo(unitsOnAxis,hol);}else{lbs=translateToHeaderInfo(unitsOnAxis,hol,"n");}}}return lbs;},checkExcluded:function(i,j){var mcnt=this.gmm.getMetricCount(),validDataHit=false,m;for(m=0;m<mcnt;m++){var v=this.getData(i,j,true,m);if(v!==""&&v!==undefined&&v!==null&&!isNaN(v)){validDataHit=true;break;}}return !validDataHit;},getData:function(i,j,raw,metricIndex){var chtInfo=this.getChartInfo();if((chtInfo.tp===CHART_TYPE.GRID)&&!chtInfo.isPie){return 1234;}return getDataInLocalDataSet.call(this,i,j,raw,metricIndex);},getPropValue:function(i,j,prop){var chtInfo=this.getChartInfo();if(chtInfo.tp===CHART_TYPE.GRID&&prop===undefined){return 1234;}return getPropValueInLocalDataSet.call(this,i,j,prop);},getAssoDataWithMetricIndex:function(ilr,ilcs,midx,raw){var metricCnt=this.gmm.getMetricCount(),cl=ilcs[0],startCol=Math.floor(cl/metricCnt)*metricCnt;return getDataInLocalDataSet.call(this,ilr,startCol+midx,raw,midx);},getAssoCoordinatesWithMetricIndex:function(ilr,ilcs,midx){var metricCnt=this.gmm.getMetricCount(),ox=this.getOffsetX(),oy=this.getOffsetY(),cl=ilcs[0],startCol=0;if(metricCnt>0){startCol=Math.floor(cl/metricCnt)*metricCnt;}else{startCol=cl;}return{R:ilr+oy,C:startCol+midx+ox,ox:ox,oy:oy};},getSizeByMetricIndexForBubble:function getSizeByMetricIndexForBubble(ilr,ilcs){var szI,model=this.gmm,gmCtr=model.gmCtr,szb=gmCtr.getSizeByMetrics(),metricCnt=model.getMetricCount(),cl,midx,pairIndex,metricsOnX,metricsOnY;if(szb.length<=0){return -1;}if(this.splitPlottingMetrics){cl=ilcs[1];midx=cl%metricCnt;metricsOnY=gmCtr.getMetricsOnYAxis();pairIndex=metricsOnY.indexOf(midx);szI=szb[pairIndex%szb.length];}else{cl=ilcs[0];midx=cl%metricCnt;metricsOnX=gmCtr.getMetricsOnXAxis();pairIndex=metricsOnX.indexOf(midx);if(pairIndex===-1){$VISUTILS.visPrint("have no size by for this metric");return -1;}szI=szb[pairIndex%szb.length];}return szI;},getSizeByData:function getSizeByData(ilr,ilcs){var szI,eGT=CHART_TYPE,eDI=$GM.EnumABLDirection,model=this.gmm,gmCtr=model.gmCtr,szb=gmCtr.getSizeByMetrics(),chtInfo=this.getChartInfo(),metricCnt=model.getMetricCount(),cl,startCol,midx,pairIndex,metricsOnX,metricsOnY;if(chtInfo.tp!==eGT.BUBBLE){if((chtInfo.isABL&&chtInfo.dirc===eDI.VERTICAL)||chtInfo.tp===eGT.GRID){if(szb.length>0&&metricCnt>0){szI=szb[0];cl=ilcs[0];startCol=Math.floor(cl/metricCnt)*metricCnt;return getDataInLocalDataSet.call(this,ilr,startCol+szI);}return -1;}if(chtInfo.isABL&&chtInfo.dirc===eDI.HORIZONTAL){if(szb.length>0&&metricCnt>0){szI=szb[0];cl=ilcs[0];startCol=Math.floor(cl/metricCnt)*metricCnt;return getDataInLocalDataSet.call(this,ilr,startCol+szI);}return -1;}}else{if(szb.length<=0){return -1;}if(this.splitPlottingMetrics){cl=ilcs[1];midx=cl%metricCnt;startCol=Math.floor(cl/metricCnt)*metricCnt;metricsOnY=gmCtr.getMetricsOnYAxis();pairIndex=metricsOnY.indexOf(midx);szI=szb[pairIndex%szb.length];}else{cl=ilcs[0];midx=cl%metricCnt;startCol=Math.floor(cl/metricCnt)*metricCnt;metricsOnX=gmCtr.getMetricsOnXAxis();pairIndex=metricsOnX.indexOf(midx);if(pairIndex===-1){$VISUTILS.visPrint("have no size by for this metric");return -1;}szI=szb[pairIndex];}return getDataInLocalDataSet.call(this,ilr,startCol+szI);}},getMetricNumberFormat:function(metricIndex){var model=this.gmm;return model.getMetricNumberFormat(metricIndex);},printAll:function(){$VISUTILS.visPrint("-----------------------("+this.cri+","+this.cci+")+------------------------------");var i,j;for(i=0;i<this.ht;i++){var aLine="";for(j=0;j<this.wd;j++){var o=this.items[i][j];if(!o.v){$VISUTILS.visPrint("Why!");}aLine+=(o.v+" ");}$VISUTILS.visPrint(aLine);}},getASingleColumn:function(startCol,iMIdx){var colIndex=startCol+iMIdx,res=[],ox=this.ox,oy=this.oy,i,j;for(i=0;i<this.ht;i++){for(j=0;j<this.wd;j++){if(j===colIndex){res.push({R:i+oy,C:j+ox,mIdx:iMIdx});if(isInt(j+ox)===false){$VISUTILS.visPrint("warning");}}}}},getGraphCellSingleColumn:function(startCol,grppmi,grpIdx){var mc=grppmi.length,res=[],ox=this.ox,oy=this.oy,i,j,gcell,c;for(i=0;i<this.ht;i++){gcell=[];for(j=0;j<mc;j++){c=grppmi[j];gcell.push({R:i+oy,C:startCol+c+ox,mIdx:c,grp:grpIdx,didx:j});if(isInt(startCol+c+ox)===false){$VISUTILS.visPrint("warning");}}res.push(gcell);}return res;},getGraphCellSingleRow:function(grppmi,grpIdx){var metricCnt=this.gmm.getMetricCount(),row=this.items[grpIdx],groupOfMetrics=row.length/metricCnt,mc=grppmi.length,res=[],ox=this.ox,oy=this.oy,i,j,c,startCol,gcell;for(i=0;i<groupOfMetrics;i++){startCol=i*metricCnt;gcell=[];for(j=0;j<mc;j++){c=grppmi[j];gcell.push({R:grpIdx+oy,C:startCol+c+ox,mIdx:c,grp:grpIdx,didx:j});if(isInt(startCol+c+ox)===false){$VISUTILS.visPrint("warning");}}res.push(gcell);}return res;},getGroupCount:function(){if(this.grpCnt>0){return this.grpCnt;}var grpCnt,chtInfo=this.getChartInfo(),chtTp=chtInfo.tp,eDI=$GM.EnumABLDirection,eGT=CHART_TYPE,gmm=this.gmm,clusteredBarSpecialCase=gmm.clusteredBarSpecialCase,mcnt=this.gmm.getMetricCount();if(chtInfo.isABL&&chtInfo.dirc===eDI.VERTICAL){if(clusteredBarSpecialCase){grpCnt=this.pmi.length;}else{if(mcnt===0){grpCnt=this.wd;}else{grpCnt=this.wd/mcnt;}}this.grpCnt=grpCnt;return grpCnt;}if(chtInfo.isABL&&chtInfo.dirc===eDI.HORIZONTAL){if(clusteredBarSpecialCase){grpCnt=this.pmi.length;}else{grpCnt=this.items.length;}this.grpCnt=grpCnt;return grpCnt;}if(chtTp===eGT.BUBBLE||chtTp===eGT.SCATTER){if(!this.splitPlottingMetrics){var pmi=this.pmi;grpCnt=pmi.length;this.grpCnt=grpCnt;return grpCnt;}grpCnt=1;this.grpCnt=grpCnt;return grpCnt;}if(chtTp===eGT.GRID){if(mcnt===0){return this.wd;}return this.wd/mcnt;}$VISUTILS.visPrint("LocalDataSet::getGroupCount for this type is not implemented");return 0;},getSeriesCount:function(){if(this.srsCnt>0){return this.srsCnt;}var chtInfo=this.getChartInfo(),eDI=$GM.EnumABLDirection,eGT=CHART_TYPE,ocurrenceOfEachMetric,gmm=this.gmm,clusteredBarSpecialCase=gmm.clusteredBarSpecialCase,mcnt=gmm.getMetricCount(),scnt;if(chtInfo.isABL&&chtInfo.dirc===eDI.VERTICAL){if(clusteredBarSpecialCase){scnt=this.ht;}else{if(!this.splitPlottingMetrics){scnt=this.ht*this.pmi.length;}else{scnt=this.ht;}}}else{if(chtInfo.isABL&&chtInfo.dirc===eDI.HORIZONTAL){if(clusteredBarSpecialCase){scnt=this.ht;}else{if(mcnt===0){ocurrenceOfEachMetric=this.wd;}else{ocurrenceOfEachMetric=this.wd/mcnt;}if(!this.splitPlottingMetrics){scnt=ocurrenceOfEachMetric*this.pmi.length;}else{scnt=ocurrenceOfEachMetric;}}}else{if(chtInfo.tp===eGT.BUBBLE||chtInfo.tp===eGT.SCATTER){if(!this.splitPlottingMetrics){scnt=this.ht;}else{scnt=this.ht;}}else{if(chtInfo.tp===eGT.GRID){if(this.items){scnt=this.items.length;}else{scnt=1;}}else{scnt=0;$VISUTILS.visPrint("LocalDataSet::getSeriesCount for this type is not implemented");}}}}this.srsCnt=scnt;return scnt;},getDataInGroup:function(groupIndex,pmi,metricIndex){var DataInGrp,pmiCnt,aGraphCellColumn,i,j,chtInfo=this.getChartInfo(),eDI=$GM.EnumABLDirection,eGT=CHART_TYPE,isPie=chtInfo.isPie,model=this.gmm,ctr=model.gmCtr,onlyMetricNamesOnAxisForGridPie=ctr.onlyMetricNamesOnAxisForGridPie,hasTotal=ctr.hasTotalForPie(),sliceRows,totalRows,sliceRowsLen,sliceCols,totalCols,sliceColsLen,aFakeTotalRow,splitPlottingMetrics,metricsCnt,bunchOfMetrics,whichPMI,startCol,forceForGridPie=false,totalStartCols=ctr.totalStartCols,piePpt=ctr.piePartition;if(chtInfo.tp===eGT.BUBBLE||chtInfo.tp===eGT.SCATTER){splitPlottingMetrics=this.splitPlottingMetrics;metricsCnt=model.getMetricCount();if(metricsCnt===0){metricsCnt=1;}DataInGrp=[];bunchOfMetrics=this.wd/metricsCnt;for(i=0;i<bunchOfMetrics;i++){startCol=i*metricsCnt;whichPMI=groupIndex;if(splitPlottingMetrics){whichPMI=0;}aGraphCellColumn=this.getGraphCellSingleColumn(startCol,pmi[whichPMI],groupIndex);if(isPie){if(!hasTotal){totalRows=[];sliceRows=splitArr(aGraphCellColumn,this.oy,ctr.piePartition);sliceRowsLen=sliceRows.length;for(j=0;j<sliceRowsLen;j++){aFakeTotalRow=mstrmojo.hash.clone(sliceRows[j][0]);aFakeTotalRow.fakeTotal=true;totalRows.push(aFakeTotalRow);}}else{sliceRows=[];totalRows=seperateArray(aGraphCellColumn,this.oy,ctr.totalRows,sliceRows);sliceRowsLen=sliceRows.length;}for(j=0;j<sliceRowsLen;j++){totalRows[j].slicesOfPie=sliceRows[j];}DataInGrp=DataInGrp.concat(totalRows);}else{DataInGrp=DataInGrp.concat(aGraphCellColumn);}}return DataInGrp;}if((chtInfo.isABL&&chtInfo.dirc===eDI.VERTICAL)||(chtInfo.tp===eGT.GRID)){DataInGrp=[];var colCntInAGroup=this.wd/this.getGroupCount();startCol=colCntInAGroup*groupIndex;pmiCnt=pmi.length;if(pmiCnt===0&&(chtInfo.tp===eGT.GRID)&&isPie){pmiCnt=1;forceForGridPie=true;}for(i=0;i<pmiCnt;i++){if(onlyMetricNamesOnAxisForGridPie){aGraphCellColumn=this.getGraphCellSingleColumn(startCol,[metricIndex],groupIndex);}else{if(forceForGridPie){aGraphCellColumn=this.getGraphCellSingleColumn(startCol,[0],groupIndex);}else{aGraphCellColumn=this.getGraphCellSingleColumn(startCol,pmi[i],groupIndex);}}if(isPie){if(!hasTotal){totalRows=[];sliceRows=splitArr(aGraphCellColumn,this.oy,ctr.piePartition);sliceRowsLen=sliceRows.length;for(j=0;j<sliceRowsLen;j++){aFakeTotalRow=mstrmojo.hash.clone(sliceRows[j][0]);aFakeTotalRow.fakeTotal=true;totalRows.push(aFakeTotalRow);}}else{sliceRows=[];totalRows=seperateArray(aGraphCellColumn,this.oy,ctr.totalRows,sliceRows);sliceRowsLen=sliceRows.length;}for(j=0;j<sliceRowsLen;j++){totalRows[j].slicesOfPie=sliceRows[j];}DataInGrp=DataInGrp.concat(totalRows);}else{DataInGrp=DataInGrp.concat(aGraphCellColumn);}}return DataInGrp;}if(chtInfo.isABL&&chtInfo.dirc===eDI.HORIZONTAL){DataInGrp=[];pmiCnt=pmi.length;for(i=0;i<pmiCnt;i++){aGraphCellColumn=this.getGraphCellSingleRow(pmi[i],groupIndex);if(isPie){if(!hasTotal){sliceCols=[];totalCols=extractTotalValuesForMetricInColumnRange(aGraphCellColumn,model.getMetricCount(),sliceCols,false,totalStartCols,piePpt);sliceColsLen=sliceCols.length;for(j=0;j<sliceColsLen;j++){var aFakeTotalCol=mstrmojo.hash.clone(sliceCols[j][0]);aFakeTotalCol.fakeTotal=true;totalCols.push(aFakeTotalCol);}}else{sliceCols=[];totalCols=extractTotalValuesForMetricInColumnRange(aGraphCellColumn,model.getMetricCount(),sliceCols,true,totalStartCols,piePpt);sliceColsLen=sliceCols.length;}for(j=0;j<sliceColsLen;j++){totalCols[j].slicesOfPie=sliceCols[j];}DataInGrp=DataInGrp.concat(totalCols);}else{DataInGrp=DataInGrp.concat(aGraphCellColumn);}}return DataInGrp;}$VISUTILS.visPrint("LocalDataSet::getDataInGroup for this type is not implemented");},getMaxValue:function(){return 9999;},getMinValue:function(){return -9999;},getRowCount:function(){return this.ht;},getColumnCount:function(){return this.wd;},getOffsetX:function(){return this.ox;},getOffsetY:function(){return this.oy;},getMetrics:function(){var ms=this.gmm.metrics;if(!ms){$VISUTILS.visPrint("none metrics found!");return null;}return ms;},getMetric:function(mIdx){var ms=this.getMetrics();if(ms){if(ms.es.length>mIdx){return ms.es[mIdx];}return null;}return null;},clearDataProviders:function(){this.dps=null;},generateDataProvider:function generateDataProvider(){if(this.dps){return this.dps;}var model=this.gmm,localPMI,pmi,dps,allData,groupCnt,ag,dp,g,m,trConfigPool=this.trConfigPool,gmCtr=model.gmCtr,groupInfo,me=this,shallWeUseGroupInfo=model.shallWeUseGroupInfo,clusteredBarSpecialCase=model.clusteredBarSpecialCase,onlyMetricNamesOnAxisForGridPie=model.onlyMetricNamesOnAxisForGridPie,isMetricNamesOnXAxis=model.isMetricNamesOnXAxis,splitPlottingMetrics=this.splitPlottingMetrics,chtInfo=this.getChartInfo(),eGT=CHART_TYPE,eDI=$GM.EnumABLDirection,metricsOnAngleBy=this.metricsOnAngleBy,mpos=this.mpos,metrics=this.metrics,bwd=0,fwd=0,splitPie=this.splitPie,isBlankGrid=model.isBlankGrid;if(trConfigPool){var globalProp=trConfigPool.globalProp;if(globalProp){bwd=globalProp.trdBwdFst!==undefined?globalProp.trdBwdFst:0;fwd=globalProp.trdFwdFst!==undefined?globalProp.trdFwdFst:0;}}if(shallWeUseGroupInfo){groupInfo=gmCtr.getGroupInfo(true);}groupCnt=this.getGroupCount();if(chtInfo.tp===eGT.BUBBLE||chtInfo.tp===eGT.SCATTER){pmi=this.pmi;dps=[];if(!splitPlottingMetrics){allData=[];for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(g,pmi);allData.push(ag);}dp=this.addDisposable(new $GM.GMEnhancedDataProvider({fwdSteps:fwd,bwdSteps:bwd,pmi:pmi,data:allData,lds:this,sbc:true,dataSbc:false,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie}));dps.push(dp);this.dps=dps;}else{for(m=0;m<pmi.length;m++){localPMI=pmi.slice(m,m+1);allData=[];for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(g,localPMI);allData.push(ag);}dp=this.addDisposable(new $GM.GMEnhancedDataProvider({fwdSteps:fwd,bwdSteps:bwd,pmi:localPMI,data:allData,lds:this,sbc:true,dataSbc:false,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie}));dps.push(dp);}this.dps=dps;}$ARR.forEach(dps,function(sgdp){var flb=sgdp.fwdLbs,blb=sgdp.bwdLbs;if(flb&&flb.length>0){me.flb=flb;}if(blb&&blb.length>0){me.blb=blb;}});return dps;}if(chtInfo.isABL&&chtInfo.dirc===eDI.VERTICAL){pmi=this.pmi;dps=[];if(!splitPlottingMetrics){allData=[];if(clusteredBarSpecialCase){for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(0,pmi.slice(g,g+1));allData.push(ag);}}else{for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(g,pmi);allData.push(ag);}}dp=this.addDisposable(new $GM.GMEnhancedDataProvider({fwdSteps:fwd,bwdSteps:bwd,pmi:pmi,data:allData,lds:this,sbc:true,dataSbc:true,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie}));dps.push(dp);this.dps=dps;$ARR.forEach(dps,function(sgdp){var flb=sgdp.fwdLbs,blb=sgdp.bwdLbs;if(flb&&flb.length>0){me.flb=flb;}if(blb&&blb.length>0){me.blb=blb;}});}else{if(shallWeUseGroupInfo){$ARR.forEach(groupInfo,function(oneGroup){localPMI=[];$ARR.forEach(oneGroup,function(mtcIdx){if(mtcIdx!==undefined&&mtcIdx>=0){localPMI.push([mtcIdx]);}});allData=[];for(g=0;g<groupCnt;g++){ag=me.getDataInGroup(g,localPMI);allData.push(ag);}dp=me.addDisposable(new $GM.GMEnhancedDataProvider({fwdSteps:fwd,bwdSteps:bwd,pmi:localPMI,data:allData,lds:me,sbc:true,dataSbc:true,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie}));dps.push(dp);});}else{for(m=0;m<pmi.length;m++){localPMI=pmi.slice(m,m+1);allData=[];for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(g,localPMI);allData.push(ag);}dp=this.addDisposable(new $GM.GMEnhancedDataProvider({fwdSteps:fwd,bwdSteps:bwd,pmi:localPMI,data:allData,lds:this,sbc:true,dataSbc:true,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie}));dps.push(dp);}}this.dps=dps;$ARR.forEach(dps,function(sgdp){var flb=sgdp.fwdLbs,blb=sgdp.bwdLbs;if(flb&&flb.length>0){me.flb=flb;}if(blb&&blb.length>0){me.blb=blb;}});}return dps;}if(chtInfo.isABL&&chtInfo.dirc===eDI.HORIZONTAL){pmi=this.pmi;dps=[];if(!splitPlottingMetrics){allData=[];if(clusteredBarSpecialCase){for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(0,pmi.slice(g,g+1));allData.push(ag);}}else{for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(g,pmi);allData.push(ag);}}dp=this.addDisposable(new $GM.GMEnhancedDataProvider({fwdSteps:fwd,bwdSteps:bwd,pmi:pmi,data:allData,lds:this,sbc:true,dataSbc:true,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie}));dps.push(dp);this.dps=dps;$ARR.forEach(dps,function(sgdp){var flb=sgdp.fwdLbs,blb=sgdp.bwdLbs;if(flb&&flb.length>0){me.flb=flb;}if(blb&&blb.length>0){me.blb=blb;}});}else{if(shallWeUseGroupInfo){$ARR.forEach(groupInfo,function(oneGroup){localPMI=[];$ARR.forEach(oneGroup,function(mtcIdx){if(mtcIdx!==undefined&&mtcIdx>=0){localPMI.push([mtcIdx]);}});allData=[];for(g=0;g<groupCnt;g++){ag=me.getDataInGroup(g,localPMI);allData.push(ag);}dp=me.addDisposable(new $GM.GMEnhancedDataProvider({fwdSteps:fwd,bwdSteps:bwd,pmi:localPMI,data:allData,lds:me,sbc:true,dataSbc:true,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie}));dps.push(dp);});}else{for(m=0;m<pmi.length;m++){localPMI=pmi.slice(m,m+1);allData=[];for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(g,localPMI);allData.push(ag);}dp=this.addDisposable(new $GM.GMEnhancedDataProvider({fwdSteps:fwd,bwdSteps:bwd,pmi:localPMI,data:allData,lds:this,sbc:true,dataSbc:true,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie}));dps.push(dp);}}this.dps=dps;$ARR.forEach(dps,function(sgdp){var flb=sgdp.fwdLbs,blb=sgdp.bwdLbs;if(flb&&flb.length>0){me.flb=flb;}if(blb&&blb.length>0){me.blb=blb;}});}return dps;}if(chtInfo.tp===eGT.GRID){pmi=this.pmi;dps=[];if(!splitPlottingMetrics){allData=[];var tempAllData,tempDataInGroup;for(g=0;g<groupCnt;g++){if(onlyMetricNamesOnAxisForGridPie){tempAllData=[];tempDataInGroup=[];$ARR.forEach(metricsOnAngleBy||[],function(metricIndex){ag=this.getDataInGroup(g,pmi,metricIndex);tempAllData.push(ag);},this);if(isMetricNamesOnXAxis){allData=allData.concat(tempAllData);}else{$ARR.forEach(tempAllData||[],function(data){tempDataInGroup=tempDataInGroup.concat(data);});allData.push(tempDataInGroup);}}else{ag=this.getDataInGroup(g,pmi);allData.push(ag);}}if(onlyMetricNamesOnAxisForGridPie){splitPie=false;}dp=this.addDisposable(new $GM.GMDataProvider({pmi:pmi,data:allData,lds:this,sbc:false,dataSbc:true,metrics:metrics,mpos:mpos,metricsOnAngleBy:metricsOnAngleBy,splitPie:splitPie,isBlankGrid:isBlankGrid}));dps.push(dp);this.dps=dps;}else{for(m=0;m<pmi.length;m++){localPMI=pmi.slice(m,m+1);allData=[];for(g=0;g<groupCnt;g++){ag=this.getDataInGroup(g,localPMI);allData.push(ag);}dp=this.addDisposable(new $GM.GMDataProvider({pmi:localPMI,data:allData,lds:this,sbc:false,dataSbc:true,metrics:metrics,mpos:mpos,metricsOnAngleBy:localPMI[0],splitPie:splitPie,isBlankGrid:isBlankGrid}));dps.push(dp);}this.dps=dps;}return dps;}$VISUTILS.visPrint("generateDataProvider Need to be implemented!");}});mstrmojo.gm.GMDataModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.gm.GMDataModel",gmCtr:undefined,modelChs:[],modelRhs:[],rp:null,cp:null,gts:null,rct:-1,cct:-1,cir:-1,cic:-1,ldss:[],plottingMetricsIndex:null,splitPlottingMetrics:null,zoneNames:["dummy","Rows","Columns","XAxis","YAxis","BreakBy","SliceBy","ColorBy","SizeBy","AdditionalMetrics","AngleBy"],metrics:null,chtInfo:null,colorType:COLOR_BY_TYPE.ATT,metricsType:undefined,getBreakByUnits:function(){var dz=this.dz,res=[],tus,breakBy=dz.BreakBy;if(breakBy){tus=breakBy.TemplateUnit;if(tus){$ARR.forEach(tus,function(att){res.push($HASH.clone(att));});}}return res;},getChartInfo:function(){return this.gmCtr.getChartInfo();},getMetricNames:function(){return this.getMetricProp("n");},getMetricIds:function(){return this.getMetricProp("oid");},getFullNumberFormat:function(){return this.fullNf;},isMetricInZone:function(mIdx,zoneId){var dz=this.dz,zoneName,res=false,tmm,singleZone;zoneName=this.zoneNames[zoneId];if(dz&&zoneName){singleZone=dz[zoneName];tmm=singleZone.TemplateMetric;$ARR.forEach(tmm,function(metricObj){if(metricObj.idx===mIdx){res=true;}});}return res;},getMetricProp:function(prop){var res=[],i,cnt,ms=this.metrics,es;if(!ms){return res;}es=ms.es;cnt=es.length;for(i=0;i<cnt;i++){var m=es[i];if(prop){res.push(m[prop]);}else{res.push(m);}}return res;},getUnitAttributesCountOnRow:function(containAttrForm){var rows=this.gts.row,gtsRowUnitCont=rows.length,gmCtr=this.gmCtr,attrOnRowsCnt,attrOnYAxisCnt,attOnBreakByCnt,attOnSliceByCnt,chtInfo=this.getChartInfo(),result=0;if(gtsRowUnitCont!==1){if(containAttrForm){$ARR.forEach(rows,function(attr){result+=GMUTIL.getAttributeFormCnt(attr);});}else{result=gtsRowUnitCont;}return result;}if(containAttrForm){attrOnRowsCnt=gmCtr.getGMHeaderCount("Rows");attrOnYAxisCnt=gmCtr.getGMHeaderCount("YAxis");attOnBreakByCnt=gmCtr.getGMHeaderCount("BreakBy");attOnSliceByCnt=gmCtr.getGMHeaderCount("SliceBy");}else{attrOnRowsCnt=gmCtr.getAttributesOnDropZone("Rows","n").length;attrOnYAxisCnt=gmCtr.getAttributesOnDropZone("YAxis","n").length;attOnBreakByCnt=gmCtr.getAttributesOnDropZone("BreakBy","n").length;attOnSliceByCnt=gmCtr.getAttributesOnDropZone("SliceBy","n").length;}if(chtInfo.isABL&&chtInfo.dirc===$GM.EnumABLDirection.HORIZONTAL){return attrOnRowsCnt+attrOnYAxisCnt;}return attrOnRowsCnt+attOnBreakByCnt+attrOnYAxisCnt+attOnSliceByCnt;},getUnitAttributesCountOnCol:function(containAttrForm){var i,ucC,cols=this.gts.col,attrCnt=0;ucC=cols.length;var lastUntOnCol=this.gts.col[ucC-1];if(lastUntOnCol&&lastUntOnCol.otp===-1){attrCnt=ucC-1;}else{attrCnt=ucC;}if(containAttrForm){var attrFormCnt=0;for(i=0;i<attrCnt;i++){attrFormCnt+=GMUTIL.getAttributeFormCnt(cols[i]);}return attrFormCnt;}else{return attrCnt;}},getPathToHeaderObject:function(axis,leafObj,field){var hol=[],lbs,unitsOnAxis;collectHeaderObj(leafObj,hol);if(axis===0){unitsOnAxis=this.gts.row;}else{unitsOnAxis=this.gts.col;}lbs=translateToHeaderInfo(unitsOnAxis,hol,field);return lbs;},collectHeaderObj:function(leafObj,res,endIdx){collectHeaderObj.call(this,leafObj,res,endIdx);},getMetricCount:function(){var metrics=this.metrics;if(!metrics){return 0;}return(metrics.es?metrics.es.length:0);},getMetricNumberFormat:function(metricIndex){var mx=this.mx,mObj;if(mx){mObj=mx[metricIndex];return decodeHTMLText(mObj.numfmt);}return undefined;},init:function init(props){this.ldss=[];this.modelChs=[];this.modelRhs=[];this._super(props);this.cir=this.cp.length;this.cic=this.rp.length;var ii,ij,ucR=this.gts.row.length,ucC=this.gts.col.length;var lastUntOnCol=this.gts.col[ucC-1];this.mpos=-1;if(lastUntOnCol&&lastUntOnCol.otp===-1){this.metrics=lastUntOnCol;this.mpos=ucC-1;}for(ii=0;ii<ucR;ii++){this.modelRhs.push({});}for(ij=0;ij<ucC;ij++){this.modelChs.push({});}this.createPlottingMetricsIndex();},createLocalDataSet:function createLocalDataSet(i,j){var gmCtr=this.gmCtr,chartInfo=gmCtr.getChartInfo(),metricsOnAngleBy=gmCtr.getMetricsOnAngleBy(),rp=this.rp,cp=this.cp,rct=this.rct,cct=this.cct,ldss=this.ldss,index,mcnt,metricLevelTrendLineData;var wd=-1;var ht=-1;if(j===cp.length-1){wd=cct-cp[j];}else{wd=cp[j+1]-cp[j];}if(i===rp.length-1){ht=rct-rp[i];}else{ht=rp[i+1]-rp[i];}if(ht===0){ht=1;}if(wd===0){wd=1;}var lds=this.addDisposable(new LocalDataSet({trConfigPool:this.trConfigPool,cri:i,cci:j,ox:cp[j],oy:rp[i],wd:wd,ht:ht,gmm:this,pmi:this.plottingMetricsIndex,metrics:this.metrics,mpos:this.mpos,splitPlottingMetrics:this.splitPlottingMetrics,metricsOnAngleBy:metricsOnAngleBy,splitPie:gmCtr.splitPiesInGraphCellForABL()}));ldss[this.cir*i+j]=lds;this.feedLds(i,j);if(chartInfo.isABL){lds.fses={};lds.bses={};lds.xvar={};mcnt=this.getMetricCount();for(index=0;index<mcnt;index++){metricLevelTrendLineData=gmCtr.getTrendLinesObjectForMetric(index,i,j,undefined,true)[0];if(metricLevelTrendLineData&&metricLevelTrendLineData.inChartModel[0]){var inChartModel=metricLevelTrendLineData.inChartModel,xvar=metricLevelTrendLineData["x-vars"];if(xvar&&xvar.length>0){lds.validXVar=xvar;}$ARR.forEach(inChartModel,function(model){var fse=model.fse,bse=model.bse;if(fse&&fse.length>0){lds.validFse=fse;}if(bse&&bse.length>0){lds.validBse=bse;}});}}}},feedLds:function feedLds(i,j){var gmCtr=this.gmCtr,dataJSON=gmCtr.firstRes,gvsJSON=dataJSON.gvs,vls=gvsJSON.items,dataRect=this.dataRect,ldss=this.ldss,rp=this.rp,cp=this.cp,rct=this.rct,cct=this.cct,items,lds=ldss[i*this.cir+j],vlsOnR,k;if(!vls||rp[i]===undefined||cp[j]===undefined||rp[i]>dataRect.y+dataRect.h||cp[j]>dataRect.x+dataRect.w){return ;}vlsOnR=vls.slice(rp[i],(rp[i+1]||rct));items=[];for(k=0;k<vlsOnR.length;k++){items.push(vlsOnR[k].items.slice(cp[j],(cp[j+1]||cct)));}lds.items=items;},feedLdss:function feedLdss(x,y,w,h){this.dataRect={x:x,y:y,w:w,h:h};},feedChs:function feedChs(chs){var i,j,modelChsLvl,modelChs=this.modelChs,items=chs.items,ucC=items.length,nAttOnCol=this.getUnitAttributesCountOnCol(),gtsCol=this.gts.col,depthinfo,tui,chsInLvl,ctInLvl,lastHd,maxColDepth,unit,extendLength=false;for(i=0;i<ucC;i++){depthinfo=getDepthAndFormFromCorOrRow(this.gts.col,i,false);tui=depthinfo.depth;unit=this.gts.col[tui];maxColDepth=tui;modelChsLvl=modelChs[tui];chsInLvl=items[i].items;ctInLvl=chsInLvl.length;lastHd=null;for(j=0;j<ctInLvl;j++){var hd=chsInLvl[j];extendLength=true;if(!modelChsLvl[hd.o]){modelChsLvl[hd.o]={forms:[]};}else{extendLength=false;}modelChsLvl[hd.o].forms.push(hd);if(hd.rs!==undefined&&hd.rs>1){var rs=hd.rs;for(var tt=0;tt<rs-1;tt++){var hdCpy=$HASH.copy(hd);hdCpy.rs=1;hdCpy.headerText="";modelChsLvl[hd.o].forms.push(hdCpy);}}if(lastHd){lastHd.next=hd;}if(modelChsLvl.mxIdx===undefined||modelChsLvl.mxIdx<hd.o){modelChsLvl.mxIdx=hd.o;}lastHd=hd;hd.headerID=hd.idx;if(hd.idx>=0){hd.headerText=this.headerInfoToProp(1,hd,"n")[0];if(hd.cet){var selInfo=this.cetSelectors=this.cetSelectors||{attrs:[],metrics:[]},elem=unit.es[lastHeaderInRow.idx];selInfo.attrs.push({tid:lastHeaderInRow.cet,id:elem.id,n:elem.n});}}else{hd.headerText="";}if(hd.fi!==undefined){if(gtsCol[tui].otp===12){hd.fid=gtsCol[tui].fs[hd.fi].id;}else{if(gtsCol[tui].otp>=0){hd.fid=gtsCol[tui].id;}}}if(hd.stt){hd.headerID=-1;if(hd.cs===undefined&&hd.rs!==undefined){hd.cs=hd.rs;}}if(modelChsLvl.length===undefined){modelChsLvl.length=1;}else{if(extendLength){modelChsLvl.length++;}}}}var cols=this.gts.col,col,len;for(i=0,len=cols.length;i<len;i++){col=cols[i];if(typeof col.t==="number"&&col.t===1){if(!col.rs||col.rs<=1){continue;}modelChsLvl=modelChs[i];modelChsLvl.isCustomGroupWithBanding=true;mergeCGForm(modelChsLvl,"c");}}for(i=1;i<=maxColDepth;i++){createChsRef(modelChs[i-1],modelChs[i],"cs");}for(i=0;i<nAttOnCol;i++){createNumLeaves.call(this,modelChs[i],"cs");}},feedRhs:function feedRhs(rhs){var i,j,len,modelRhs=this.modelRhs,items=rhs.items,gmCtr=this.gmCtr,unitListOnRow=this.gts.row,ucR=unitListOnRow.length,rowCnt=items.length,tui;if(rowCnt===1){var attrOnRows=gmCtr.getAttributesOnDropZone("Rows","n"),attrOnYAxis=gmCtr.getAttributesOnDropZone("YAxis","n");if(this.eg||(ucR===0&&(attrOnRows.length+attrOnYAxis.length===0))){rowCnt=0;}}for(i=0;i<rowCnt;i++){var hdsInR=items[i].items;var lastIdx=hdsInR.length;while(lastIdx--){var lastHeaderInRow=hdsInR[lastIdx];lastHeaderInRow.headerID=lastHeaderInRow.idx;tui=lastHeaderInRow.tui;if(lastHeaderInRow.stt){lastHeaderInRow.headerText="Subtotal";lastHeaderInRow.headerID=-1;}else{if(lastHeaderInRow.idx>=0){lastHeaderInRow.headerText=this.headerInfoToProp(0,lastHeaderInRow,"n")[0];if(lastHeaderInRow.cet){var selInfo=this.cetSelectors=this.cetSelectors||{attrs:[],metrics:[]},unit=this.gts.row[tui],elem=unit.es[lastHeaderInRow.idx];selInfo.attrs.push({tid:lastHeaderInRow.cet,id:elem.id,n:elem.n});}}else{lastHeaderInRow.headerText="";}}if(lastHeaderInRow.fi!==undefined){lastHeaderInRow.fid=unitListOnRow[tui].fs[lastHeaderInRow.fi].id;}var whichAttribute=modelRhs[tui];if(!whichAttribute[lastHeaderInRow.o]){whichAttribute[lastHeaderInRow.o]={forms:[]};if(whichAttribute.length===undefined){whichAttribute.length=1;}else{whichAttribute.length++;}}var lastHdCpy=$HASH.copy(lastHeaderInRow);whichAttribute[lastHeaderInRow.o].forms.push(lastHdCpy);if(whichAttribute.mxIdx===undefined||whichAttribute.mxIdx<lastHeaderInRow.o){whichAttribute.mxIdx=lastHeaderInRow.o;}if(lastHeaderInRow.cs&&lastHeaderInRow.cs>1){var cs=lastHeaderInRow.cs,ii,hdCpy;for(ii=0;ii<cs-1;ii++){hdCpy=$HASH.copy(lastHeaderInRow);hdCpy.cs=1;hdCpy.headerText="";whichAttribute[lastHeaderInRow.o].forms.push(hdCpy);}lastHdCpy.cs=1;}}}var colHeaders,mxIdx;for(i=0;i<ucR;i++){colHeaders=modelRhs[i];mxIdx=colHeaders.mxIdx;for(j=0;j<=mxIdx;j++){var hd=colHeaders[j];if(hd&&hd.forms){hd.forms.reverse();}}}var rows=this.gts.row,row,modelRhsLvl;for(i=0,len=rows.length;i<len;i++){row=rows[i];if(typeof row.t==="number"&&row.t===1){if(!row.cs||row.cs<=1){continue;}modelRhsLvl=modelRhs[i];modelRhsLvl.isCustomGroupWithBanding=true;mergeCGForm(modelRhsLvl,"r");}}for(i=1;i<ucR;i++){createChsRef(modelRhs[i-1],modelRhs[i],"rs");}for(i=0;i<ucR;i++){createNumLeaves.call(this,modelRhs[i],"rs");}},extractInfoLowestHeaderInfoToAttrObj:function(){elevateFormInfo(this.modelChs);elevateFormInfo(this.modelRhs);},createPlottingMetricsIndex:function(){var gmCtr=this.gmCtr,eGT=CHART_TYPE,chtInfo=gmCtr.getChartInfo(),ab,abLen,t,i,j,temp,plottingMetricsIndex,mOnX,mOnY,mOnSizeBy,mxcnt,mycnt,cnt,mszcnt,eDI=$GM.EnumABLDirection,metricAxis;mOnX=gmCtr.getMetricsOnXAxis();mOnY=gmCtr.getMetricsOnYAxis();mOnSizeBy=gmCtr.getSizeByMetrics();mxcnt=mOnX.length;mycnt=mOnY.length;mszcnt=mOnSizeBy.length;if(chtInfo.isABL){plottingMetricsIndex=[];if(chtInfo.dirc===eDI.VERTICAL){metricAxis=mOnY;}else{metricAxis=mOnX;}cnt=metricAxis.length;for(i=0;i<cnt;i++){plottingMetricsIndex.push([metricAxis[i]]);}}if(chtInfo.tp===eGT.GRID&&gmCtr.isPie===false){plottingMetricsIndex=[[0]];}else{if(chtInfo.tp===eGT.GRID&&gmCtr.isPie===true){if(this.splitPlottingMetrics){ab=gmCtr.getMetricsOnAngleBy();abLen=ab.length;plottingMetricsIndex=[];for(t=0;t<abLen;t++){temp=[];temp.push(ab[t]);plottingMetricsIndex.push(temp);}}else{plottingMetricsIndex=[[0]];}}else{if(chtInfo.tp===eGT.BUBBLE||chtInfo.tp===eGT.SCATTER){plottingMetricsIndex=[];if(this.splitPlottingMetrics){for(j=0;j<mycnt;j++){for(i=0;i<mxcnt;i++){plottingMetricsIndex.push([mOnX[i],mOnY[j]]);}}}else{var mPlotCnt=Math.min(mxcnt,mycnt);if(chtInfo.tp===eGT.BUBBLE){mPlotCnt=Math.min(mPlotCnt,mszcnt);}for(i=0;i<mPlotCnt;i++){plottingMetricsIndex.push([mOnX[i],mOnY[i]]);}}}}}this.plottingMetricsIndex=plottingMetricsIndex;return plottingMetricsIndex;},headerInfoToProp:function(axis,hdObj,prop){var hos=[hdObj];var unitsOnAxis;if(axis===0){unitsOnAxis=this.gts.row;}else{unitsOnAxis=this.gts.col;}return translateLowestHeaderInfo(unitsOnAxis,hos,prop);},collectHeadersObjects:function(axis,rOrCIdx){var modelHeader=null;var depthAndForm;if(axis===0){modelHeader=this.modelRhs;depthAndForm=getDepthAndFormFromCorOrRow(this.gts.row,rOrCIdx,true);}else{modelHeader=this.modelChs;depthAndForm=getDepthAndFormFromCorOrRow(this.gts.col,rOrCIdx,false);}var psedoArr=modelHeader[depthAndForm.depth];return getElementsFromDiscreteArray(psedoArr,100,depthAndForm.formIndex,axis);},collectHeadersLabels:function(axis,rOrCIdx){var hos=this.collectHeadersObjects(axis,rOrCIdx);var unitsOnAxis;if(axis===0){unitsOnAxis=this.gts.row;}else{unitsOnAxis=this.gts.col;}return translateLowestHeaderInfo(unitsOnAxis,hos,"n");},getRowHeaderObj:function(rowIndex,colIdx){var modelRhs=this.modelRhs,depthAndFormIndex=getDepthAndFormFromCorOrRow(this.gts.row,colIdx,true),depth=depthAndFormIndex.depth,formIndex=depthAndFormIndex.formIndex,aColOfRhs=modelRhs[depth],idx=rowIndex;while(aColOfRhs[idx]===undefined&&idx>=0){idx--;}if(idx>=0){var o=aColOfRhs[idx].forms[formIndex];if(!o.rs){o.rs=1;}if(o.o<=rowIndex&&(o.o+o.rs)>rowIndex){return o;}}$VISUTILS.visPrint("no row header is found! maybe we need to retrieve it from server");},getColHeaderObj:function(colIndex,rowIdx){var modelChs=this.modelChs,depthAndFormIndex=getDepthAndFormFromCorOrRow(this.gts.col,rowIdx,false),depth=depthAndFormIndex.depth,formIndex=depthAndFormIndex.formIndex,aRowOfChs=modelChs[depth],idx=colIndex;while(aRowOfChs[idx]===undefined&&idx>=0){idx--;}if(idx>=0){var o=aRowOfChs[idx].forms[formIndex];if(!o.cs){o.cs=1;}if(o.o<=colIndex&&(o.o+o.cs)>colIndex){return o;}}$VISUTILS.visPrint("no column header is found! maybe we need to retrieve it from server");},getDropZoneInfo:function getDropZoneInfo(){},getLocalDataSet:function getLocalDataSet(r,c){var linearIdx=r*this.cir+c;if(!this.ldss[linearIdx]){this.createLocalDataSet(r,c);}return this.ldss[linearIdx];},linearSearchMapGridIndexToChart:function(gIdx,ptt){var i=ptt.length-1;while(true){if(gIdx>=ptt[i]){return i;}i--;}},mapGridIndexToChart:function(gIdx,ptt){var l=0,mid,r=ptt.length-1;if(gIdx>=ptt[r]){return r;}r--;mid=parseInt((l+r)/2);while(r>=l){if(ptt[mid]<=gIdx&&ptt[mid+1]>gIdx){return mid;}else{if(ptt[mid+1]<=gIdx){l=mid+1;}else{r=mid-1;}mid=parseInt((l+r)/2);}}return this.linearSearchMapGridIndexToChart(gIdx,ptt);},mapChartIndexToGrid:function(cIdx,ptt){return ptt[cIdx];},getRowTitleInfo:function(){if(this.rwTtInfo){return this.rwTtInfo;}var gts=this.gts,row=gts.row,lbs=[],cnt=row.length,i;for(i=0;i<cnt;i++){lbs=lbs.concat(getFormsOfAttr.call(this,row[i],true,i));}this.rwTtInfo=lbs;return lbs;},isSepByMetricsForBubbleScatter:function(){var gmCtr=this.gmCtr,chtInfo=gmCtr.getChartInfo(),tp=chtInfo.tp;return(tp===CHART_TYPE.BUBBLE||tp===CHART_TYPE.SCATTER)&&(METRICS_POS.MetricsByColumn===this.metricsType||METRICS_POS.MetricsByRow===this.metricsType);},getColTitleInfo:function(){if(this.colTtInfo){return this.colTtInfo;}var gts=this.gts,col=gts.col,lbs=[],cnt=col.length,i;for(i=0;i<cnt;i++){lbs=lbs.concat(getFormsOfAttr.call(this,col[i],false,i));}this.colTtInfo=lbs;return lbs;},getMetricIDsFromIndex:function(idxArr){return getMetricPropsFromIndex(this.metrics,idxArr,"oid");},getMetricIDFromIndex:function(idx){return getMetricPropsFromIndex(this.metrics,[idx],"id")[0];},getMetricNamesFromIndex:function(idxArr){return getMetricPropsFromIndex(this.metrics,idxArr,"n");},getMetricCondenseFromIndex:function(idxArr){return getMetricPropsFromIndex(this.metrics,idxArr,"cds");},addColorMetricInAngle:function(){var i=0,j=0,metricsColorMap=this.metricsColorMap,metricsColorMapID=this.metricsColorMapID,colorItemName,colorItemId,gmCtr=this.gmCtr,chtInfo=gmCtr.getChartInfo(),angleMetricsIndex=gmCtr.getMetricsOnAngleBy(),angleMetricsID=this.getMetricIDsFromIndex(angleMetricsIndex),angleMetricsName=this.getMetricNamesFromIndex(angleMetricsIndex),angleMetricsIDLen=angleMetricsID.length,metricsColorMapLen=metricsColorMap.length;if((chtInfo.isPie||chtInfo.isRing)&&angleMetricsIDLen){var mColorMap=[];var mColorMapId=[];for(j=0;j<metricsColorMapLen;++j){for(i=0;i<angleMetricsIDLen;++i){colorItemName=metricsColorMap[j]+ColorByAttrDelimiter+angleMetricsName[i];colorItemId=metricsColorMapID[j]+ColorByAttrDelimiter+angleMetricsID[i];mColorMap.push(colorItemName);mColorMapId.push(colorItemId);}}this.metricsColorMap=mColorMap;this.metricsColorMapID=mColorMapId;}},constructMetricColorMap:function(){var i=0,j=0,gmCtr=this.gmCtr,chtInfo=gmCtr.getChartInfo(),tp=chtInfo.tp,xAxisMetricsIndex=gmCtr.getMetricsOnXAxis(),yAxisMetricsIndex=gmCtr.getMetricsOnYAxis(),sizeByMetricsIndex=gmCtr.getSizeByMetrics(),angleMetricsIndex=gmCtr.getMetricsOnAngleBy(),xAxisMetricsID=this.getMetricIDsFromIndex(xAxisMetricsIndex),yAxisMetricsID=this.getMetricIDsFromIndex(yAxisMetricsIndex),sizeByMetricsID=this.getMetricIDsFromIndex(sizeByMetricsIndex),angleMetricsID=this.getMetricIDsFromIndex(angleMetricsIndex),horizontalmode=chtInfo.dirc===1,angleMetricsName=this.getMetricNamesFromIndex(angleMetricsIndex),bubbleSeriesNum=Math.min(xAxisMetricsIndex.length,yAxisMetricsIndex.length),metricNames=this.getMetricNames();if(sizeByMetricsIndex.length>0){bubbleSeriesNum=Math.min(bubbleSeriesNum,sizeByMetricsIndex.length);}var metricsColorMap=this.metricsColorMap=[];var metricsColorMapID=this.metricsColorMapID=[];if(chtInfo.isABL){var metricsId=horizontalmode?xAxisMetricsID:yAxisMetricsID;var metricsIndex=horizontalmode?xAxisMetricsIndex:yAxisMetricsIndex;for(i=0;i<metricsId.length;++i){j=i;metricsColorMap.push(metricNames[metricsIndex[j]]);metricsColorMapID.push(metricsId[j]);}this.addColorMetricInAngle();}else{if(tp===CHART_TYPE.BUBBLE||tp===CHART_TYPE.SCATTER){var colorItemName;var colorItemId;if(this.isSepByMetricsForBubbleScatter()){for(i=0;i<xAxisMetricsIndex.length;++i){for(j=0;j<yAxisMetricsIndex.length;++j){colorItemName=metricNames[xAxisMetricsIndex[i]]+ColorByAttrDelimiter+metricNames[yAxisMetricsIndex[j]];colorItemId=xAxisMetricsID[i]+ColorByAttrDelimiter+yAxisMetricsID[j];if(tp===CHART_TYPE.BUBBLE){colorItemName+=(ColorByAttrDelimiter+metricNames[sizeByMetricsIndex[j%sizeByMetricsIndex.length]]);colorItemId+=(ColorByAttrDelimiter+sizeByMetricsID[j%sizeByMetricsIndex.length]);}metricsColorMap.push(colorItemName);metricsColorMapID.push(colorItemId);}}this.addColorMetricInAngle();}else{for(i=0;i<bubbleSeriesNum;i++){colorItemName=metricNames[xAxisMetricsIndex[i]]+ColorByAttrDelimiter+metricNames[yAxisMetricsIndex[i]];colorItemId=xAxisMetricsID[i]+ColorByAttrDelimiter+yAxisMetricsID[i];if(tp===CHART_TYPE.BUBBLE){colorItemName+=(ColorByAttrDelimiter+metricNames[sizeByMetricsIndex[i]]);colorItemId+=(ColorByAttrDelimiter+sizeByMetricsID[i]);}metricsColorMap.push(colorItemName);metricsColorMapID.push(colorItemId);}this.addColorMetricInAngle();}}else{if(chtInfo.isPie||chtInfo.isRing){for(i=0;i<angleMetricsID.length;++i){metricsColorMap.push(angleMetricsName[i]);metricsColorMapID.push(angleMetricsID[i]);}}}}},constructAttrMetricColorMap:function(){var attributesColorMap=this.attributesColorMap,attributesColorMapID=this.attributesColorMapID,metricsColorMap=this.metricsColorMap,metricsColorMapID=this.metricsColorMapID,attrMetricsColorMap,attrMetricsColorMapID,i,j;if(!attributesColorMap||!metricsColorMap){return ;}attrMetricsColorMap=this.attrMetricsColorMap=[];attrMetricsColorMapID=this.attrMetricsColorMapID=[];if(attributesColorMap.length>0&&metricsColorMap.length>0){for(i=0;i<attributesColorMap.length;++i){for(j=0;j<metricsColorMap.length;++j){attrMetricsColorMap.push(attributesColorMap[i]+ColorBySpaceDelimiter+metricsColorMap[j]);attrMetricsColorMapID.push(attributesColorMapID[i]+ColorByAttrDelimiter+metricsColorMapID[j]);}}}else{if(attributesColorMap.length>0){this.attrMetricsColorMap=attributesColorMap;this.attrMetricsColorMapID=attributesColorMapID;}else{if(metricsColorMap.length>0){this.attrMetricsColorMap=metricsColorMap;this.attrMetricsColorMapID=metricsColorMapID;}}}},clearColorMaps:function(){this.attrMetricsColorMap=this.attributesColorMap=undefined;this.attrMetricsColorMapID=this.attributesColorMapID=undefined;this.metricsColorMap=undefined;this.attrMetricsColorMapID=this.metricsColorMapID=undefined;this.attrMetricsColorMapIDMap=undefined;this.metricsColorMapMap=undefined;},getColorByLegendInfo:function(){var model=this,gmCtr=model.gmCtr,docModel=gmCtr.view.model.docModel,globalAttrMetricsColorMap=model.globalAttrMetricsColorMap,colorType=this.colorType,palette=gmCtr.palette,paletteSize=palette.length,i,colorMap=this.attrMetricsColorMap,mapSize,colorByInfo=gmCtr.colorByInfo,itemName="",res=[],globalToken,colorByObj,isDefaultColor,chtSubType,chartInfo=gmCtr.chartInfo;if(colorType===COLOR_BY_TYPE.ATT||colorType===COLOR_BY_TYPE.ATT_METRICS||colorType===COLOR_BY_TYPE.METRICS_ITEM){mapSize=colorMap.length;for(i=0;i<mapSize;i++){var itemColor;if(gmCtr.globalColorMapping){globalToken=globalAttrMetricsColorMap[i];colorByObj=docModel.getColorBy(globalToken.levels,globalToken.elements);itemColor=colorByObj.color;isDefaultColor=!colorByObj.isManual;}else{itemColor=palette[i%paletteSize];isDefaultColor=true;}res.push({label:colorMap[i],color:itemColor,isDefaultColor:isDefaultColor,token:globalToken});}if(colorType===COLOR_BY_TYPE.ATT||colorType===COLOR_BY_TYPE.ATT_METRICS){$ARR.forEach(colorByInfo.atts,function(att){itemName=itemName+" "+att.n;});}if(colorType===COLOR_BY_TYPE.ATT_METRICS||colorType===COLOR_BY_TYPE.METRICS_ITEM){itemName=itemName+" Metrics";}itemName=itemName.trim();$ARR.forEach(res,function(pair){pair.decodedColor=GMUTIL.decodeColor(pair.color);pair.encodedColor=pair.color;});res=filterDuplicateColorByItems(res);if(chartInfo&&chartInfo.isABL){chtSubType=chartInfo.sbtp;if(chtSubType===CHART_SUBTYPE.STACKED||chtSubType===CHART_SUBTYPE.PERCENT){this.colorByUnitIds=gmCtr.getColorByUnitIds(chartInfo.dirc);res.sort(this.compareColorByOrder.bind(this,chartInfo.dirc));}}}else{if(colorType===COLOR_BY_TYPE.METRICS){itemName=colorByInfo.metrics[0].n;var thresholds=colorByInfo.thresholds;var rankMode=colorByInfo.rankMode;var mxOfColorMetric,itemId=colorByInfo.metrics[0].id;$ARR.forEach(model.mx,function(obj){if(obj.did===itemId){mxOfColorMetric=obj;return false;}});if(mxOfColorMetric){var fs=mstrmojo.VisUtility.getColorByFormatStr(this.getMetricNumberFormat(model.gmCtr.getColorByMetrics()[0]),rankMode);res=mstrmojo.VisUtility.getColorByItems(thresholds,rankMode,mxOfColorMetric.max,mxOfColorMetric.min,mxOfColorMetric.cnt,fs);itemName=mstrmojo.VisUtility.getColorByTitle(itemName,rankMode);if(res===undefined||res.length===0){return undefined;}}}}if(colorType===COLOR_BY_TYPE.NULL){return undefined;}return{item:itemName,elements:res};},compareColorByOrder:function(dirc,a,b){var i,uIds=this.colorByUnitIds,aLevels=a.token.levels,aEles=a.token.elements,bEles=b.token.elements,n=uIds.length,idx,sign,es;for(i=0;i<n;i++){idx=aLevels.indexOf(uIds[i].id);es=uIds[i].es;if(idx<0||aEles[idx]===bEles[idx]){continue;}else{if(!uIds[i].unique&&(dirc===$GM.EnumABLDirection.VERTICAL||(uIds[i].zone==="Rows"||uIds[i].zone==="YAxis"))){sign=1;}else{sign=-1;}return sign*(es.indexOf(aEles[idx])-es.indexOf(bEles[idx]));}}},adaptForGlobalColor:function(){var dz=this.dz,colorByDz=dz.ColorBy,tus=colorByDz.TemplateUnit,gmCtr=this.gmCtr,esArr=[],gts=this.gts,row=gts.row,col=gts.col,gAttIds,attLen,lAttIds,oneCombiRes,oneCombiTypes,oneCombiLevel,oneCombiElements,eIndexArr,len,i,tid,es,eid;$ARR.forEach(tus,function(unit){var ax=(unit.axis==="row"?row:col);var tui=unit.uidx;esArr.push(ax[tui].es);});if(!gmCtr.globalColorMapping){return ;}gAttIds=this.globalAttrMetricsColorMap=[];attLen=tus===undefined?0:tus.length;lAttIds=this.attrMetricsColorMapID;$ARR.forEach(lAttIds,function(oneCombi){oneCombi=oneCombi.toString();oneCombiRes={};oneCombiTypes=oneCombiRes.types=[];oneCombiLevel=oneCombiRes.levels=[];oneCombiElements=oneCombiRes.elements=[];eIndexArr=oneCombi.split(ColorByAttrDelimiter);len=eIndexArr.length;for(i=0;i<len;i++){if(i<attLen){tid=tus[i].id;es=esArr[i];eid=es[parseInt(eIndexArr[i],10)].id;oneCombiTypes.push(tus[i].t);oneCombiLevel.push(tid);oneCombiElements.push(eid);}else{var mid=eIndexArr[i];oneCombiLevel.push(-1);oneCombiElements.push(mid);oneCombiTypes.push(4);}}gAttIds.push(oneCombiRes);});return gAttIds;},constructColorByInfo:function(){var colorType=this.colorType,dz=this.dz;if(colorType===COLOR_BY_TYPE.ATT||colorType===COLOR_BY_TYPE.ATT_METRICS){this.constructAttrColorMap();deleteSubtotal.call(this);this.attrMetricsColorMap=this.attributesColorMap;this.attrMetricsColorMapID=this.attributesColorMapID;if(colorType===COLOR_BY_TYPE.ATT){this.adaptForGlobalColor();}}if(colorType===COLOR_BY_TYPE.METRICS_ITEM||colorType===COLOR_BY_TYPE.ATT_METRICS){this.constructMetricColorMap();this.attrMetricsColorMap=this.metricsColorMap;this.attrMetricsColorMapID=this.metricsColorMapID;if(colorType===COLOR_BY_TYPE.METRICS_ITEM){this.adaptForGlobalColor();}}if(colorType===COLOR_BY_TYPE.ATT_METRICS){this.constructAttrMetricColorMap();this.adaptForGlobalColor();}this.attrMetricsColorMapIDMap=convertArrayToMap2(this.attrMetricsColorMapID);this.metricsColorMapMap=convertArrayToMap2(this.metricsColorMap);},constructAttrColorMap:function(){var i,ri,rj,ci,cj,ids,names,metricOnX,metricOnY,bubbleSeriesNum,isGridAndNotPie,alwaysShow,nAttrs,attributesColorMap,attributesColorMapID,lastAccessesElementIndex,lastObj,span,gmCtr=this.gmCtr,vls=gmCtr.firstRes.gvs.items,chtInfo=gmCtr.getChartInfo(),chartType=chtInfo.tp,szByMetrics=gmCtr.getSizeByMetrics(),rowColorAttrsIndex=gmCtr.getRowColorAttrsIndex(),colColorAttrsIndex=gmCtr.getColColorAttrsIndex(),metricCnt=this.getMetricCount(),divisor=metricCnt===0?1:metricCnt,colorByAttrsID=gmCtr.getColorByAttrsID(),nRowAttrs=rowColorAttrsIndex.length,nColAttrs=colColorAttrsIndex.length,headerComb=[],rowHeaders=[],rowRightChildIndexes=[],lowestRowHeaders=[],nLowesetRowHeaders=1,iRows=[],colHeaders=[],colRightChildIndexes=[],lowestColHeaders=[],nLowesetColHeaders=1,iCols=[];if(!colorByAttrsID||colorByAttrsID.length===0){return ;}nAttrs=colorByAttrsID.length;attributesColorMap=this.attributesColorMap=[];attributesColorMapID=this.attributesColorMapID=[];alwaysShow=(chartType===CHART_TYPE.GRID&&szByMetrics.length===0);isGridAndNotPie=(chartType===CHART_TYPE.GRID)&&!chtInfo.isPie;metricOnX=gmCtr.getMetricsOnXAxis();metricOnY=gmCtr.getMetricsOnYAxis();bubbleSeriesNum=Math.min(metricOnX.length,metricOnY.length);if(szByMetrics.length>0){bubbleSeriesNum=Math.min(bubbleSeriesNum,szByMetrics.length);}function hasDataInPos(rowIdx,colIdx){if(isGridAndNotPie){return 1234;}var items=vls[rowIdx],o=items&&items.items&&items.items[colIdx];if(o===undefined||o.rv===undefined||o===""||o.rv===""||o.rv==="--"){return false;}return true;}function showColorByItem(rowNum,columnNum,rowIdx,colIdx){var t,m,k,value,value1,showIt=false,htmlRowIndex,htmlColIndex;for(m=0;m<rowNum&&!showIt;++m){htmlRowIndex=rowIdx+m;for(k=0;k<columnNum&&!showIt;++k){htmlColIndex=colIdx+k;if(chtInfo.isABL){for(t=0;t<metricCnt;++t){value=hasDataInPos(htmlRowIndex,htmlColIndex*metricCnt+t);if(value){showIt=true;break;}}}else{if(chartType===CHART_TYPE.BUBBLE||chartType===CHART_TYPE.SCATTER){for(t=0;t<bubbleSeriesNum;++t){value=hasDataInPos(htmlRowIndex,htmlColIndex*metricCnt+metricOnX[t]);value1=hasDataInPos(htmlRowIndex,htmlColIndex*metricCnt+metricOnY[t]);if(value&&value1&&(chartType===CHART_TYPE.SCATTER||(chartType===CHART_TYPE.BUBBLE&&!isNaN(szByMetrics[t])))){showIt=true;break;}}}else{if(chartType===CHART_TYPE.GRID&&szByMetrics.length>0){value=hasDataInPos(htmlRowIndex,htmlColIndex*metricCnt+szByMetrics[0]);if(value){showIt=true;break;}}}}}}return showIt;}if(nRowAttrs>0){rowRightChildIndexes=[];rowHeaders=constructAttrColorNodeCombinations(rowColorAttrsIndex,this.modelRhs,rowRightChildIndexes);lowestRowHeaders=(nRowAttrs===1?rowHeaders:rowHeaders[nRowAttrs-1]);nLowesetRowHeaders=lowestRowHeaders.mxIdx+1;iRows=[];for(rj=0;rj<nRowAttrs-1;++rj){headerComb[rowColorAttrsIndex[rj].order]=rowHeaders[rj][0];iRows[rj]=0;}}if(nColAttrs>0){colRightChildIndexes=[];colHeaders=constructAttrColorNodeCombinations(colColorAttrsIndex,this.modelChs,colRightChildIndexes);lowestColHeaders=(nColAttrs===1?colHeaders:colHeaders[nColAttrs-1]);nLowesetColHeaders=lowestColHeaders.mxIdx+1;iCols=[];}var row=null,col=null,nRowLeaves=this.rct,nColLeaves=this.cct/divisor,rowIndex=0,colIndex=0,itemIdsMap={};for(ri=0;ri<nLowesetRowHeaders;++ri){if(nRowAttrs>0){row=lowestRowHeaders[ri];if(!row){continue;}nRowLeaves=row.numLeaves;headerComb[rowColorAttrsIndex[nRowAttrs-1].order]=row;iRows[nRowAttrs-1]=ri;for(rj=nRowAttrs-2;rj>=0;--rj){if(rowRightChildIndexes[rj][iRows[rj]]>iRows[rj+1]){break;}lastAccessesElementIndex=iRows[rj];lastObj=rowHeaders[rj][lastAccessesElementIndex];if(rowHeaders[rj].isCustomGroupWithBanding){span=lastObj.forms[1].rs;}else{span=lastObj.rs;}if(!span){span=1;}iRows[rj]+=span;headerComb[rowColorAttrsIndex[rj].order]=rowHeaders[rj][iRows[rj]];}}colIndex=0;if(nColAttrs>0){for(cj=0;cj<nColAttrs-1;++cj){headerComb[colColorAttrsIndex[cj].order]=colHeaders[cj][0];iCols[cj]=0;}}for(ci=0;ci<nLowesetColHeaders;++ci){if(nColAttrs>0){col=lowestColHeaders[ci];if(!col){continue;}nColLeaves=col.numLeaves;headerComb[colColorAttrsIndex[nColAttrs-1].order]=col;iCols[nColAttrs-1]=ci;for(cj=nColAttrs-2;cj>=0;--cj){if(colRightChildIndexes[cj][iCols[cj]]>iCols[cj+1]){break;}lastAccessesElementIndex=iCols[cj];lastObj=colHeaders[cj][lastAccessesElementIndex];if(colHeaders[cj].isCustomGroupWithBanding){span=lastObj.forms[1].cs;}else{span=lastObj.cs;}if(!span){span=1;}iCols[cj]+=span;headerComb[colColorAttrsIndex[cj].order]=colHeaders[cj][iCols[cj]];}}if(alwaysShow||showColorByItem(nRowLeaves,nColLeaves,rowIndex,colIndex)){ids=headerComb[0].headerID;names=headerComb[0].headerText;for(i=1;i<nAttrs;++i){ids+=ColorByAttrDelimiter+headerComb[i].headerID;names+=ColorBySpaceDelimiter+headerComb[i].headerText;}if(!itemIdsMap.hasOwnProperty(ids)){attributesColorMap.push(names);attributesColorMapID.push(ids);itemIdsMap[ids]=true;}}colIndex+=nColLeaves;}rowIndex+=nRowLeaves;}},testLocalDataSet:function testLocalDataSet(){var cir=this.cir,cic=this.cic,i,j,di,dp;for(i=0;i<cic;i++){for(j=0;j<cir;j++){var lds=this.getLocalDataSet(i,j);lds.printAll();var dps=lds.generateDataProvider();$VISUTILS.visPrint("========"+dps.length+" data providers for this local data set===");for(di=0;di<dps.length;di++){dp=dps[di];$VISUTILS.visPrint("");$VISUTILS.visPrint("====start Testing data provider: "+di+" ======");dp.testDataProvider();$VISUTILS.visPrint("====end Testing data provider: "+di+" ======");}}}}});}());