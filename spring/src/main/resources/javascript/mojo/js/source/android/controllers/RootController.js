(function(){mstrmojo.requiresCls("mstrmojo.android.controllers.ViewController","mstrmojo.hash","mstrmojo.array");mstrmojo.requiresDescs(8394);var EnumHSButtonType={FOLDER:1,RESULTSET:2,REPORTS:3,SETTINGS:4,SHAREDLIBRARY:5,SUBSCRIPTIONS:8,HELP:6};var HS_DEFAULT=1,HS_CUSTOM=2,HS_RESULTSET=3,HS_FOLDER=4;var $HASH=mstrmojo.hash,$ARR=mstrmojo.array;function setUpStatus(){this.rootView.setUpStatus(this.getCurrent().getUpStatus());}function dispatchController(deviceCfg,params){var screenType=deviceCfg&&deviceCfg.getHomeScreenType();if(!deviceCfg||(screenType<HS_DEFAULT||screenType>HS_FOLDER)){mstrmojo.err({name:"StartupError",message:deviceCfg?"illegal default homescreen type, hsc="+screenType:"no device configuration found."});return false;}if(screenType>HS_CUSTOM){var homeScreen=deviceCfg.getHomeScreen(),projectId=homeScreen.pid,subtype=homeScreen.st;params.did=homeScreen.did;var systemFolder=homeScreen.systemFolder;if(systemFolder){params.systemFolder=systemFolder;}if(screenType===HS_FOLDER){var oi=homeScreen.oi;projectId=params.pid=oi.pid;subtype=oi.st;params.did=oi.did;params.csp=!!homeScreen.csp;}else{params.projectID=projectId;$HASH.copyProps(["promptsAnswerXML","elementsPromptAnswers","valuePromptAnswers","objectsPromptAnswers","reportViewMode"],homeScreen,params);if(parseInt(params.reportViewMode,10)===2){subtype=769;}}mstrApp.setCurrentProjectId(projectId);params.st=subtype;}this.initHomeScreen(screenType,params);}var $CTRL=mstrmojo.android.controllers.RootController=mstrmojo.declare(mstrmojo.android.controllers.ViewController,null,{scriptClass:"mstrmojo.android.controllers.RootController",start:function start(){var deviceCfg=mstrApp.getConfiguration(),params={hsc:true};this._lastOpened=$ARR.filter(this._lastOpened,function(rs){return !!deviceCfg.getProject(rs.projectID||rs.pid);});dispatchController.call(this,deviceCfg,params);},direct:function direct(externalCfg){var deviceCfg=new mstrmojo.MobileConfiguration({_cfg:externalCfg});mstrApp.closeAllDialogs();dispatchController.call(this,deviceCfg,{});},restart:function restart(){mstrApp.closeAllDialogs();var nextController=this.nextController;if(nextController){nextController.destroy();}this.start();},initHomeScreen:function initHomeScreen(screenType,params){this.spawn(mstrApp.controllerFactory.newController(this.getViewKey(params.st),params),params);},initNav:function initNav(){var deviceCfg=mstrApp.getConfiguration(),nav=[{n:mstrmojo.desc(1873,"Home"),act:-1,fromNav:true}];if(deviceCfg.isSubscriptionEnabled()){nav.push({n:mstrmojo.desc(1089,"Subscriptions"),act:8,fromNav:true});}this.rootView.setNavigation(nav,0);},updateLastOpened:function updateLastOpened(request){var last=this._lastOpened,projId=mstrApp.getCurrentProjectId(),requestId;if(request){requestId=request.did||request.documentID||request.reportID||request.objectID;mstrmojo.array.forEach(last,function(item,idx){if(item.xId===requestId&&item.projectID===projId){last.splice(idx,1);return false;}});}this.rootView.updateLastOpened(last);if(request){last=this._lastOpened=[$HASH.copy(request,{projectID:projId,xId:requestId})].concat(last);if(last.length>5){last.pop();}}},updateProperties:mstrmojo.emptyFn,updateFolder:function updateFolder(folderView,title,isBack){setUpStatus.call(this);},updatePrompts:function updatePrompts(promptView,title){this.updateContent(promptView,title);},updateTransactions:mstrmojo.emptyFn,closeTransactions:mstrmojo.emptyFn,updateContent:function updateContent(contentView,title,isBack){var rootView=this.rootView;if(title!==undefined&&this._lastTitle!==title){this._lastTitle=title;rootView.setTitle(title);rootView.clearNavigation();}if(contentView){rootView.setContent(contentView,isBack);}setUpStatus.call(this);},contentUpdated:function contentUpdated(subtype){this.rootView.contentUpdated(subtype);},restoreNavigation:function restoreNavigation(){this.rootView.restoreNavigation();},updateDisplayMessage:mstrmojo.emptyFn,setActionToolbarStatus:function setActionToolbarStatus(isActive){this.rootView.setActionToolbarStatus(isActive);},getTitle:function getTitle(){return this._lastTitle||"";},jumpTo:function jumpTo(item){var action=item.act;if(action){if(!item.fromNav){if(!this.rootView.hasNavigationItems()){this.initNav();}else{this.restoreNavigation();}this.rootView.selectNavigationItem(item);}if(action===-1){this.restart();}else{if(action===EnumHSButtonType.SHAREDLIBRARY){this.spawn(mstrApp.controllerFactory.newController("Projects",{hsc:true}));}else{if(action===EnumHSButtonType.SUBSCRIPTIONS){this.spawn(mstrApp.controllerFactory.newController("Subscriptions",{hsc:true}));}}}return ;}this._super(item);},goHome:function goHome(){mstrApp.closeAllDialogs();var nextController=this.nextController;if(nextController){nextController.makeHome();}},makeCurrent:mstrmojo.emptyFn,setActionToolbar:function setActionToolbar(id,tbCfg){this.rootView.setActionToolbar(id,tbCfg);},enterFullScreen:function enterFullScreen(){this.rootView.enterFullScreen();},flashFullScreen:function flashFullScreen(){this.rootView.flashFullScreen();},exitFullScreen:function exitFullScreen(animate,isBack){this.rootView.exitFullScreen(animate);},cancelFlashFullScreen:function cancelFlashFullScreen(){return this.rootView.cancelFlashFullScreen();},onorientationChange:function onorientationChange(evt){this._super(evt);this.rootView.reset();this.raiseEvent({name:"rootOrientationChange",isLandscape:!!this.orientation});}});$CTRL.EnumHSType={DEFAULT:HS_DEFAULT,CUSTOM:HS_CUSTOM,RESULTSET:HS_RESULTSET,FOLDER:HS_FOLDER};}());