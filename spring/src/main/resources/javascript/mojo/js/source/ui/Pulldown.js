(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo.ui._IsPulldown","mstrmojo.ui.PopupList","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var $CSS=mstrmojo.css,$ARR=mstrmojo.array,$DOM=mstrmojo.dom;mstrmojo.ui.Pulldown=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo.ui._IsPulldown],{scriptClass:"mstrmojo.ui.Pulldown",onitemSelected:mstrmojo.emptyFn,allowHTML:true,init:function init(props){this._super(props);$CSS.addWidgetCssClass(this.list,"ctrl-popup-list");},initChildren:function initChildren(){this.children=this.getPopupListConfig();this._super();},getSelectedItem:function getSelectedItem(){var items=this.items;return items&&items[this.selectedIndex];},selectItemByField:function selectItemByField(fieldName,fieldValue){this.set("selectedIndex",$ARR.find(this.items||[],fieldName,fieldValue));},getPopupWidget:function getPopupWidget(){return this.list;},getPopupList:function getPopupList(){return this.list;},_set_items:function _set_items(n,v){var previousItems=this.items;this.items=v;delete this.selectedIndex;if(previousItems!==v){var hr=this.hasRendered;if(hr){this.refresh();}return true;}return false;},onclick:function onclick(evt){this._super(evt);var me=this,popupWidget=me.getPopupWidget();me.mw=me.mw||function(e){if(!$DOM.contains(popupWidget.domNode,$DOM.eventTarget(self,e),true,document.body)){popupWidget.close();$DOM.detachEvent(document,$DOM.isFF?"DOMMouseScroll":"mousewheel",me.mw);}};$DOM.attachEvent(document,$DOM.isFF?"DOMMouseScroll":"mousewheel",me.mw);},_set_selectedIndex:function _set_selectedIndex(n,v){if((v!==0&&!v)||v<0){return false;}var selectedIndex=this.selectedIndex=v,popupList=this.getPopupList(),items=popupList.items,selectedNode=this.selectedNode;popupList.set("selectedIndex",selectedIndex);if(selectedNode&&items&&items[selectedIndex]){selectedNode.innerHTML=this.allowHTML?items[selectedIndex].n:mstrmojo.string.encodeHtmlString(items[selectedIndex].n);selectedNode.title=items[selectedIndex].title||"";}this.onitemSelected(items[selectedIndex],selectedIndex);return true;},getPopupListConfig:function getpopupListConfig(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,listHooks:{select:function select(el,item,index){this.parent.set("selectedIndex",index);this.close();}},getItemProps:function getItemProps(item,idx){var props=mstrmojo._IsList.getItemProps.call(this,item,idx);props.style=this.parent.itemCssText||"";return props;}};},children:[]});mstrmojo.ui.Pulldown.newPulldown=function newPulldown(items,fnChange,selectedIndex,props,skipInstantiation){props=props||{};props.items=items;var pulldown;if(skipInstantiation===true){pulldown=mstrmojo.hash.copy({scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:selectedIndex||0},props);}else{pulldown=new mstrmojo.ui.Pulldown(props);if(selectedIndex!==undefined){pulldown.set("selectedIndex",selectedIndex);}}pulldown.postselectedIndexChange=function(evt){var newValue=evt.value,oldValue=evt.valueWas;if(newValue!==oldValue){var items=this.items;fnChange.call(this,items[newValue],items[oldValue]);}};return pulldown;};}());