(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.TextBox","mstrmojo.HTMLButton","mstrmojo.DI.DIRemoteProjectDBRole");mstrmojo.requiresDescs(24,221,5369,13085,13086,13087,13088,13089,13090);var save,$ARR=mstrmojo.array,$DOM=mstrmojo.dom,selectedProjectName,selectedProjectId;save=function save(editor){var $this=editor;var c=$this.vBoxAlias,iServerName=c.iServerNameNodeHBox.iServerNameNodeAlias.value,iServerPort=c.iServerPortHBox.iServerPortAlias.value,loginName=c.loginHBox.loginAlias.value,password=c.passwordHBox.passwordAlias.value,dsName=c.dsNameHBox.dsNameAlias.value,db_role,dbr;if($this.dbrole){db_role=$this.dbrole;}else{db_role=new mstrmojo.DI.DIRemoteProjectDBRole();db_role.init();}dbr=db_role.mdDBRole;var conn={str:"hostname="+iServerName+"; Port="+iServerPort+"; ProjectID="+selectedProjectId+";",err:"error Msg"};dbr.n=dsName;dbr.connstr=conn.str;dbr.ln=loginName;dbr.password=password;dbr.dbr_type="5";dbr.dbms="00000000000000000000000000000000";dbr.hostname=iServerName;dbr.Port=iServerPort;dbr.selectedProjectName=selectedProjectName;dbr.ProjectID=selectedProjectId;mstrApp.getRootController().projectController.saveDBRole(dbr,$this);};mstrmojo.DI.DIProjectDBRoleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIProjectDBRoleEditor",title:mstrmojo.desc(24,"Data Source"),id:"projectDBRoleEditor",help:"Select_Objects_dialog_box_.htm",cssClass:"mstrmojo-project-login",dbrole:undefined,buttons:[{scriptClass:"mstrmojo.HTMLButton",alias:"submitButtonAlias",cssClass:"mstrmojo-Editor-button mstr-submit-button",text:mstrmojo.desc(5369,"Submit"),onclick:function(){save(this.parent.parent);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button mstr-cancel-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var bdeEditor=this.parent.parent;bdeEditor.close();}}],preBuildRendering:function preBuildRendering(){if(this._super){this._super();}if(this.dbrole&&this.dbrole.hostname&&this.dbrole.Port){mstrApp.getRootController().projectController.getProjectsFromRemote(this.dbrole.hostname,this.dbrole.Port);}mstrApp.getRootController().model.attachEventListener("projectsLoaded",this.id,this.projectsLoaded);},onOpen:function onOpen(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("projectsLoaded",this.id,this.projectsLoaded);var db_role=this.dbrole;this.set("dbrole",new mstrmojo.DI.DIRemoteProjectDBRole());this.set("dbrole",db_role);if(this.dbrole&&this.dbrole.hostname&&this.dbrole.Port){mstrApp.getRootController().projectController.getProjectsFromRemote(this.dbrole.hostname,this.dbrole.Port);}else{var pulldown=this.vBoxAlias.iServerProjectHBox.iServerProject;pulldown.set("items",[]);pulldown.set("defaultSelection",0);pulldown.set("selectedIndex",-1);pulldown.set("text","");}},projectsLoaded:function projectsLoaded(evt){var forms=evt.data.srps.sp,pulldown=this.vBoxAlias.iServerProjectHBox.iServerProject;if(Object.prototype.toString.call(forms)!=="[object Array]"){forms=[].concat(forms);}pulldown.set("items",forms);if(!this.dbrole){pulldown.set("defaultSelection",0);selectedProjectName=forms[0].pn;selectedProjectId=forms[0].pgd;}else{var projectID=this.dbrole.ProjectID,idx=$ARR.find(forms,"pgd",projectID);selectedProjectId=projectID;if(idx!==-1){pulldown.set("defaultSelection",idx);pulldown.set("selectedIndex",idx);}else{pulldown.set("selectedIndex",-1);pulldown.set("defaultSelection",-1);pulldown.set("text","");}}pulldown.render();},children:[{scriptClass:"mstrmojo.VBox",alias:"vBoxAlias",cssClass:"login_Vbox",children:[{scriptClass:"mstrmojo.HBox",alias:"iServerNameNodeHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13085,"Remote I-Server Location")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"iServerNameNodeAlias",bindings:{value:function(){var db_role=this.parent.parent.parent.dbrole;if(db_role){return db_role.hostname;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"iServerPortHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13086,"Remote I-Server Port")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"iServerPortAlias",bindings:{value:function(){var db_role=this.parent.parent.parent.dbrole;if(db_role){return db_role.Port;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"iServerProjectHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13087,"Remote Server Project")},{scriptClass:"mstrmojo.Pulldown",alias:"iServerProject",popupToBody:true,itemField:"pn",itemIdField:"pgd",bindings:{popupZIndex:"this.parent.parent.parent.zIndex"},onvalueChange:function(){var list=this,selectedIndex=list.selectedIndex;selectedProjectName=list.items[selectedIndex].pn;selectedProjectId=list.items[selectedIndex].pgd;},premousedown:function(evt){if(!this.items||(this.items.length===0)){var serverName=this.parent.parent.iServerNameNodeHBox.iServerNameNodeAlias.value;var serverPort=this.parent.parent.iServerPortHBox.iServerPortAlias.value;if(serverName&&serverPort){mstrApp.getRootController().projectController.getProjectsFromRemote(serverName,serverPort);}}else{if($DOM.getButton(evt.hWin,evt.e)===$DOM.MOUSE_BUTTON.LEFT){this.togglePopup();}}}}]},{scriptClass:"mstrmojo.HBox",alias:"loginHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13088,"Project Login")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"loginAlias",bindings:{value:function(){var db_role=this.parent.parent.parent.dbrole;if(db_role){return db_role.mdDBRole.ln;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"passwordHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13089,"Project Password")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"passwordAlias",type:"password",bindings:{value:function(){var db_role=this.parent.parent.parent.dbrole;if(db_role){return db_role.mdDBRole.password;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"dsNameHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13090,"Data Source Name")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"dsNameAlias",bindings:{value:function(){var db_role=this.parent.parent.parent.dbrole;if(db_role){return db_role.n;}return"";}}}]}]}]});}());