(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var _reTOKENS=/\{\@(en@)?([^\}]+)\}/gm,_reLT=/\</gm,_reGT=/\>/gm,_reNEm=/\S/,_regSpecials=["$","^","=","!",":","/",".","*","+","?","|","(",")","[","]","{","}","\\"],_reRegEsc=new RegExp("(\\"+_regSpecials.join("|\\")+")","g"),_xmlRep={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;",u0009:"&#x09;","\n":"&#x0A;","\r":"&#x0D;",'"':"&quot;"},_htmlRep={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;"," ":"&nbsp;","\n":"<br/>","\r":"&nbsp;&nbsp;&nbsp;&nbsp;","'":"&#039;",'"':"&quot;"},_htmlDecodeRep={"&amp;":"&","&lt;":"<","&gt;":">","&nbsp;":" ","<br/>":"\n","&nbsp;&nbsp;&nbsp;&nbsp;":"\r","&#039;":"'","&quot;":'"'},_basicHtmlRep={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#039;",'"':"&quot;","\u20ac":"&#8364;"},_basicHtmlDecodeRep={"&amp;":"&","&lt;":"<","&gt;":">","&#039;":"'","&quot;":'"',"&#8364;":"\u20ac"};var _typeOf=function(v){if(v===null){return"null";}var t=typeof v;if(t!=="object"){return t;}if(v.length===undefined){return"object";}return"array";};var parseUriOptions={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};mstrmojo.string=mstrmojo.provide("mstrmojo.string",{multiReplace:function multiReplace(s,hash,skip){var k;skip=skip||[];if(!s){return"";}var keys=[];for(k in hash){if(mstrmojo.array.indexOf(skip,k)===-1){keys.push(k.k||k);}}return s.replace(new RegExp(keys.join("|"),"g"),function($0){var v=hash[$0];return v.v||v;});},trim:function trim(s){return(s&&s.replace)?s.replace(/^\s+/,"").replace(/\s+$/,""):s;},startsWith:function startsWith(src,text){return src.length>=text.length&&src.substring(0,text.length)==text;},ellipsize:function ellipsize(text,length){var shortText=this.trim(text.substr(0,(length||1)-1));if(shortText!==text){shortText+="&hellip;";}return shortText;},isEmpty:function isEmpty(v){return(v===null)||(v===undefined)||!(_reNEm.test(v));},regEscape:function regEscape(text){return text.replace(_reRegEsc,"\\$1");},encodeXMLAttribute:function(v){return mstrmojo.string.multiReplace(v,_xmlRep);},encodeHtmlString:function(v,skipSpaces,basicHtmlEncode){if(!v||!v.replace){return v;}if(basicHtmlEncode){return mstrmojo.string.multiReplace(v,_basicHtmlRep);}return mstrmojo.string.multiReplace(v,_htmlRep,skipSpaces?[" "]:[]);},decodeHtmlString:function(v,basicHtmlDecode){return basicHtmlDecode?mstrmojo.string.multiReplace(v,_basicHtmlDecodeRep):mstrmojo.string.multiReplace(v,_htmlDecodeRep);},htmlAngles:function(s){if(!mstrmojo.string.isEmpty(s)){s=String(s);return s.replace(_reLT,"&lt;").replace(_reGT,"&gt;");}return s;},apply:function apl(template,obj){if(!template){return"";}var me=this;return template.replace(_reTOKENS,function fnReplaceToken(token,encodeSymbol,prop){var propertyValue;try{propertyValue=mstrmojo.hash.walk(prop,obj);}catch(ex){}propertyValue=(propertyValue===null||propertyValue===undefined)?"":propertyValue;return(!!encodeSymbol)?me.encodeHtmlString(propertyValue,true):propertyValue;});},json2xml:function(nodeName,jsons,config){if(!(jsons instanceof Array)){jsons=[jsons];}var serial=config&&config.isSerializable,convertBoolean=(config.convertBoolean!==false),skipFunctions=config&&config.skipFunctions,ji,jlen;var att=[],ch=[],n,v,t;for(ji=0,jlen=jsons.length;ji<jlen;ji++){var json=jsons[ji];for(n in json){if(skipFunctions&&typeof json[n]==="function"){continue;}if(serial){var ret=serial(n,jsons,ji);if(ret!==true){if(ret===false){continue;}else{if(ret.att){att.push(ret.att);}if(ret.child){ch.push(ret.child);}continue;}}}v=json[n];t=_typeOf(v);switch(t){case"array":var i,len;ch.push("<"+n+">");for(i=0,len=v.length;i<len;i++){var cn=config.getArrItemName(n,v,i)||i;ch.push(this.json2xml(cn,v[i],config));}ch.push("</"+n+">");break;case"object":ch.push(this.json2xml(n,v,config));break;case"string":att.push(n+'="'+mstrmojo.string.encodeXMLAttribute(v)+'"');break;case"boolean":att.push(n+'="'+(convertBoolean?(v?"-1":"0"):v)+'"');break;case"null":if(!config.skipNull){att.push(n+'="'+config.nullValue+'"');}break;default:att.push(n+'="'+v+'"');break;}}}return"<"+nodeName+" "+att.join(" ")+">"+ch.join("")+"</"+nodeName+">";},escape4HTMLText:function escape4HTMLText(v){if(!v||!v.replace){return v;}var QUOTE=/"/gm;var QUOTE_ENCODED="&quot;";var AMP=/&/gm;var AMP_ENCODED="&amp;";var LESSTHAN=/</gm;var LESSTHAN_ENCODED="&lt;";var GREATERTHAN=/>/gm;var GREATERTHAN_ENCODED="&gt;";return v.replace(AMP,AMP_ENCODED).replace(QUOTE,QUOTE_ENCODED).replace(LESSTHAN,LESSTHAN_ENCODED).replace(GREATERTHAN,GREATERTHAN_ENCODED);},parseUri:function(str,options){options=options||parseUriOptions;var m=options.parser[((options.strictMode)?"strict":"loose")].exec(str),uri={},i=14;while(i--){uri[options.key[i]]=m[i]||"";}uri[options.q.name]={};uri[options.key[12]].replace(options.q.parser,function($0,$1,$2){if($1){uri[options.q.name][$1]=$2;}});return uri;},removeSpecialChars:function(str){return str.replace(/[^a-zA-Z0-9]/g,"");}});})();