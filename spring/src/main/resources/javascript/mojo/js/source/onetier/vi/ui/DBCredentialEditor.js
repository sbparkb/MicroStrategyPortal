(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.Editor");mstrmojo.requiresDescs(8538,8513,2523,2399,13708,1162,11134,14295);var $HASH=mstrmojo.hash;function populateControls(){var container=this.dbInfoBox,dbName,dsnlessBox=this.dsnlessBox,dbRole=this.data.dbRole,DBS,buildControl=function buildControl(prop){var setting,caption=mstrmojo.desc(prop.IDS,prop.n),value=prop.fieldV;if(caption&&caption[caption.length-1]!==":"){caption+=":";}switch(prop.tp){case"text":case"number":setting=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:caption,value:value});setting.set("text",value);break;case"list":setting=new mstrmojo.warehouse.dbroles.DBRoleSettingPulldown({caption:caption,itemIdField:"v",itemField:"v"});setting.render();setting.set("items",prop.options);setting.set("selectedID",value);break;case"boolean":setting=new mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox({label:caption,driverMode:1});setting.render();setting.setValue(value);break;}setting.set("enabled",false);return setting;};DBS=dbRole.dbmsObj.DBInfo.DBS[0].dbVersions[0].DBPS[0].DBP;if(DBS){mstrmojo.array.forEach(DBS,function(property){container.addChildren([buildControl(property)]);});}$HASH.forEach(dbRole.dbmsObj.DBInfo.dbTypes,function(item,key){dbName=key;});dsnlessBox.database.set("enabled",false);dsnlessBox.database.list.set("value",dbName);dsnlessBox.version.set("enabled",false);dsnlessBox.version.list.set("value",dbRole.dbmsObj.n);this.txtlogin.set("text",dbRole.ln||"");this.txtpwd.set("text",dbRole.password||"");this.txtname.set("text",dbRole.n);this.txtname.set("enabled",false);}mstrmojo.onetier.vi.ui.DBCredentialEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.onetier.vi.ui.DBCredentialEditor",title:"Data Source",help:"pending.htm",data:undefined,cssClass:"mstrmojo-DBCredentialEditor",children:[{alias:"dsnlessBox",scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"database",caption:mstrmojo.desc(8538,"Database:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"version",caption:mstrmojo.desc(2523,"Version:")}]},{alias:"dsnBox",scriptClass:"mstrmojo.Box",visible:false,children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dsn",caption:"dsn:"},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"version",caption:mstrmojo.desc(2523,"Version:")}]},{alias:"dbInfoBox",scriptClass:"mstrmojo.Box",visible:true},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtlogin",isRequired:true,caption:mstrmojo.desc(8513,"login:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtpwd",isPassword:true,isRequired:true,caption:mstrmojo.desc(1162,"password:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtname",caption:mstrmojo.desc(11134,"ds name:")},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",alias:"buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"OK",text:mstrmojo.desc(13708,"Test & Save Changes"),onclick:function(){var editor=this.parent.parent,data=editor.data,txtlogin=editor.txtlogin,txtpwd=editor.txtpwd,result;result=txtlogin.isValid();if(!result.val){mstrmojo.alert(result.msg);return ;}result=txtpwd.isValid();if(!result.val){mstrmojo.alert(result.msg);return ;}mstrApp.serverRequest({taskId:"setDBCredentials",dbroleinfo:JSON.stringify($HASH.copy({ln:txtlogin.getValue(),password:txtpwd.getValue()},$HASH.copy(data.dbRole)))},{success:function success(res){if(res.dbr){data.set("credentialsFetched",true);data.dbRole.ln=txtlogin.getValue();data.dbRole.password=txtpwd.getValue();editor.close();}else{mstrmojo.alert(mstrmojo.desc(14295,"Invalid Username, Password. Please check your login credential again."));}}},{doNotHold:true});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],postBuildRendering:function postBuildRendering(props){this._super(props);populateControls.call(this);}});}());