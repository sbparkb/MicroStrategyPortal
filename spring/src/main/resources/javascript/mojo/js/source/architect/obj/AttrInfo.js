(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.obj.BaseForm");var Enum_SM_AddAttributeInfo=7,Enum_SM_RemoveAttributeInfo=8,Enum_SM_UpdateAttributeInfo=13;function addNewBaseForm(attributeInfo,baseFormId,columnId,expression){attributeInfo.baseForms[baseFormId]=new mstrmojo.architect.obj.BaseForm({expression:expression,columnId:columnId,baseFormId:baseFormId});}function createAttributeInfo(props){var callback=props.callback,attributeInfo=this;this.model.submitRequest({success:function(){attributeInfo.attributeId=props.attributeId;attributeInfo.attributeName=props.attributeName;attributeInfo.tableId=props.tableId;attributeInfo.baseForms={};addNewBaseForm(attributeInfo,props.baseFormId,props.columnId,props.expression);if(callback&&callback.success){callback.success(attributeInfo);}}},{manipulationtype:Enum_SM_AddAttributeInfo,objectid:props.attributeId,baseformid:props.baseFormId,columnid:props.columnId,expression:props.expression,tableids:props.tableId,showWait:true},"schemaManipulation");}mstrmojo.architect.obj.AttrInfo=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.AttrInfo",init:function init(props){var attributeInfo=this,callback=props.callback,basefId,baseForm;this._super(props);if(props.isNew){createAttributeInfo.call(attributeInfo,props);}else{this.baseForms={};basefId=props.baseFormId;baseForm=new mstrmojo.architect.obj.BaseForm({expression:props.expression,columnId:props.columnId,baseFormId:basefId});this.baseForms[basefId]=baseForm;if(callback&&callback.success){callback.success(attributeInfo);}}},attributeId:undefined,attributeName:undefined,tableId:undefined,baseForms:undefined,count:function count(){return(Object.keys(this.baseForms).length);},addBaseForm:function addBaseForm(isNew,baseFormId,columnId,expression,callback){var attributeInfo=this;if(isNew){attributeInfo.model.submitRequest({success:function(){addNewBaseForm(attributeInfo,baseFormId,columnId,expression);if(callback&&callback.success){callback.success(attributeInfo.attributeId);}}},{manipulationtype:Enum_SM_AddAttributeInfo,objectid:attributeInfo.attributeId,baseformid:baseFormId,columnid:columnId,expression:expression,tableids:attributeInfo.tableId},"schemaManipulation");}else{addNewBaseForm(attributeInfo,baseFormId,columnId,expression);if(callback&&callback.success){callback.success(attributeInfo.attributeId);}}},remove:function remove(baseFormId,callback){var attributeInfo=this;attributeInfo.model.submitRequest({success:function(){if(baseFormId==="-1"){attributeInfo.baseForms=[];}else{delete attributeInfo.baseForms[baseFormId];}if(callback&&callback.success){callback.success(baseFormId);}}},{manipulationtype:Enum_SM_RemoveAttributeInfo,objectid:attributeInfo.attributeId,baseformid:baseFormId,tableids:attributeInfo.tableId,showWait:true},"schemaManipulation");},update:function update(baseFormId,expression,columnId,callback){var attributeInfo=this;attributeInfo.model.submitRequest({success:function(){var baseForm=attributeInfo.baseForms[baseFormId];baseForm.expression=expression;baseForm.columnId=columnId;if(callback&&callback.success){callback.success(attributeInfo.attributeId);}}},{manipulationtype:Enum_SM_UpdateAttributeInfo,objectid:attributeInfo.attributeId,expression:expression,columnid:columnId,baseformid:baseFormId,tableids:attributeInfo.tableId,showWait:false},"schemaManipulation");}});}());