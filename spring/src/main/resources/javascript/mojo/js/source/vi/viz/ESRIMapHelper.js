(function(){mstrmojo.requiresCls("mstrmojo.vi.viz.MapHelper","mstrmojo.vi.viz.EnumDSSDropZones");var $MH=mstrmojo.vi.viz.MapHelper,$EDZ=mstrmojo.vi.viz.EnumDSSDropZones,$GMAPS=mstrmojo.gmaps,REG_SPLIT32=new RegExp(".{32}","g");function getMTP(vp){return(vp.sa==="1")?$MH.MTP_AREA:vp.mtp;}mstrmojo.vi.viz.ESRIMapHelper=mstrmojo.declare(mstrmojo.vi.viz.MapHelper,null,{scriptClass:"mstrmojo.vi.viz.ESRIMapHelper",setWidget:function setWidget(w){this._super(w);this.mapType=getMTP(w.model.data.vp);},setMapType:function setMapType(tp){this._super(tp);if(tp===mstrmojo.vi.viz.MapHelper.MTP_AREA){this.vp.sa="1";this.vp.sm="0";}else{this.vp.sm="1";this.vp.sa="0";}},showAngleZone:function(){return(vp.mtp===$GMAPS.EnumMapType.Marker||vp.mtp===$GMAPS.EnumMapType.Bubble)&&vp.mc===$GMAPS.EnumClusterMode.PIE;},showColorByZone:function(){return $MH.canShowColorByZone(this.mapType||getMTP(this.vp));},showSizeByZone:function(){return $MH.canShowSizeByZone(this.mapType||getMTP(this.vp));},getXml:function getXml(){var vp=this.vp,ma=this.geoAttribute,lat=this.latitude,lng=this.longitude,colorBy=this.colorBy,sizeBy=this.sizeBy,tooltip=this.tooltip,mtp=this.mapType,dv=this.defaultView,useAttributeForm=this.useAttributeForm;if(mtp){vp.mtp=mtp;vp.sa=mtp===$MH.MTP_AREA?"1":"0";vp.sm=mtp===($MH.MTP_MARKER||mtp===$MH.MTP_BUBBLE)?"1":"0";}if(dv){vp.dv=dv;}vp.ma=ma||"";vp.lat=lat||"";vp.lng=lng||"";vp.cmt=colorBy||"";vp.smt=sizeBy||"";if(useAttributeForm){vp.af=useAttributeForm;}vp.tooltip="";tooltip.forEach(function(item){vp.tooltip+=item;});return this._super();}});mstrmojo.vi.viz.ESRIMapHelper.zonesCfg=[{n:mstrmojo.desc(11661,"Geo Attribute"),id:$EDZ.GeoAttribute,prm:true,show:function(vp){return true;},v:function(vp){return[vp.ma];},onDel:function(vp){vp.ma="";},onAdd:function(vp,context){vp.ma=context.item.did;vp.af=$MH.USE_ATTRIBUTE_FORM;vp.lid="";}},{n:mstrmojo.desc(7696,"Latitude"),id:$EDZ.Latitude,prm:true,show:function(vp){return vp.sa!=="1";},v:function(vp){return vp.lat?[vp.lat]:[];},onDel:function(vp){vp.lat="";},onAdd:function(vp,context){var item=context.item;vp.lat=item.did;vp.af=item.t===21?$MH.USE_ATTRIBUTE_FORM:$MH.USE_ATTRIBUTE;}},{n:mstrmojo.desc(7697,"Longitude"),id:$EDZ.Longitude,prm:true,show:function(vp){return vp.sa!=="1";},v:function(vp){return vp.lng?[vp.lng]:[];},onDel:function(vp){vp.lng="";},onAdd:function(vp,context){var item=context.item;vp.lng=item.did;vp.af=item.t===21?$MH.USE_ATTRIBUTE_FORM:$MH.USE_ATTRIBUTE;}},{n:mstrmojo.desc(14294,"Angle"),id:$EDZ.Angle,prm:true,show:function(vp){return(vp.mtp===$GMAPS.EnumMapType.Marker||vp.mtp===$GMAPS.EnumMapType.Bubble)&&vp.mc===$GMAPS.EnumClusterMode.PIE;},v:function(vp){return[vp.amt];},onDel:function(vp){vp.amt="";},onAdd:function(vp,context){vp.amt=context.item.did;}},{n:mstrmojo.desc(11662,"Color By"),id:$EDZ.ColorBy,prm:true,show:function(vp){return $MH.canShowColorByZone(getMTP(vp));},v:function(vp){return[vp.cmt];},onDel:function(vp){vp.cmt="";},onAdd:function(vp,context){vp.cmt=context.item.did;}},{n:mstrmojo.desc(11663,"Size By"),id:$EDZ.SizeBy,prm:true,show:function(vp){return $MH.canShowSizeByZone(getMTP(vp));},v:function(vp){return[vp.smt];},onDel:function(vp){vp.smt="";},onAdd:function(vp,context){vp.smt=context.item.did;}},{n:mstrmojo.desc(2962,"Tooltip"),id:$EDZ.AdditionalMetrics,prm:false,show:function(vp){return true;},v:function(vp){var ids=vp.tooltip;return ids&&ids.match(REG_SPLIT32);},onDel:function(vp,context){vp.tooltip=vp.tooltip.replace(context.item.did,"");},onAdd:function(vp,context){var ids=vp.tooltip?vp.tooltip.match(REG_SPLIT32):[];ids.splice(context.idx,0,context.item.did);vp.tooltip=ids.join("");}}];}());