(function(){mstrmojo.requiresCls("mstrmojo.AndroidBaseMultipleImageLayoutPrototype","mstrmojo.AndroidWidgetMatrix","mstrmojo.AndroidBaseImageLayout");var $CSS=mstrmojo.css;mstrmojo.AndroidVisMap=mstrmojo.declare(mstrmojo.AndroidBaseMultipleImageLayoutPrototype,[],{scriptClass:"mstrmojo.AndroidVisMap",isTablet:true,markupString:'<div id="{@id}" class="scrollBarParent {@cssClass}" style="position:absolute; width:{@width}px; height:{@height}px; left:{@left}px; top:{@top}px; z-index:{@zIndex};" mstrAttach:mousewheel><div id="{@id}-loading-indicator" style="position:relative; width:{@width}px; height:{@height}px; display:none; z-index: 2;"><div style="padding-left: 5px; height: {@loadingIndicatorDivHeight}px; width: {@loadingIndicatorDivWidth}px; background-color: RGBA(0,0,0,0.5); border: solid 1px RGBA(255, 255, 255, 0.5); color: #FFFFFF; font-size: {@loadingIndicatorFontSize}px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; line-height: {@loadingIndicatorDivHeight}px;">Loading...</div></div><div id="{@id}-error-message" align="center" style="position:absolute; top:35%; word-wrap:break-word; display: none; z-index: 3"></div><div id="{@id}-css" style="display:none"></div></div>',markupSlots:{loadingIndicator:function(){return this.domNode.childNodes[0];},loadingIndicatorTextDiv:function(){return this.domNode.childNodes[0].firstChild;},errorMessage:function(){return this.domNode.childNodes[1];},cssDiv:function(){return this.domNode.childNodes[2];}},init:function(props){if(this._super){this._super(props);}this.sbwh=0;},postBuildRendering:function(){this.getBGTime=0;if(this._super){this._super();}},attachListeners:function(){if(this._super){this._super();}var me=this;me.fullScreenListener=mstrmojo.touchManager.attachEventListener("fullScreenStateChange",this.id,function(evt){me.adjustWidgetOffsets();});me.touchOutsideListener=mstrmojo.touchManager.attachEventListener("touchesBegin",me.id,function(evt){if(!me.isTouchedOnWidget(evt.touch)){me.hideTooltip();}});},createBaseImageLayout:function createBaseImageLayout(props){return new mstrmojo.AndroidBaseImageLayout(props);},createWidgetMatrix:function createWidgetMatrix(props){return new mstrmojo.AndroidWidgetMatrix(props);},miniChartResizedCallback:function mrcb(evt){if(this._super){this._super(evt);}bubbleSizeParas=this.modelData.bubbleSizeParas;if(bubbleSizeParas){bubbleSizeParas.maxRadius*=this.imageLayoutTable.relScaleFactor;}},createUnitChart:function createUnitChart(w,h,t,l,row,col){var me=this,miniChartIndex=row*me.finalColCnt+col,subTitleHeight=me.subTitleHeight,subTitleFontSize=me.subTitleFontSize,subTitlePadding=me.subTitlePadding,cbw=me.CONSTANTS.CHART_BORDER_WIDTH,isDarkTheme=(me.themeMode===me.CONSTANTS.THEME.DARK),isRightColumn=(col===me.finalColCnt-1),isBottomRow=(row===me.finalRowCnt-1);if(miniChartIndex>=me.miniChartCount){return document.createElement("div");}if(!me.hasMultiAttr){subTitleHeight=0;cbw=0;}var subParentDiv=document.createElement("div");$CSS.addClass(subParentDiv,["subImageLayout-subParent"]);if(isDarkTheme){$CSS.addClass(subParentDiv,["dark"]);}else{$CSS.addClass(subParentDiv,["light"]);}if(isBottomRow){$CSS.addClass(subParentDiv,["bottom"]);}if(isRightColumn){$CSS.addClass(subParentDiv,["right"]);}subParentDiv.setAttribute("row",row);subParentDiv.setAttribute("col",col);if(w!==undefined){if(isRightColumn){subParentDiv.style.width=w+"px";}else{subParentDiv.style.width=w-cbw+"px";}}if(h!==undefined){if(isBottomRow){subParentDiv.style.height=h+"px";}else{subParentDiv.style.height=h-cbw+"px";}}if(t!==undefined){subParentDiv.style.top=t+"px";}if(l!==undefined){subParentDiv.style.left=l+"px";}if(this.hasMultiAttr){var subTitleDiv=document.createElement("div");$CSS.addClass(subTitleDiv,["subImageLayout-title"]);if(isDarkTheme){$CSS.addClass(subTitleDiv,["dark"]);}else{$CSS.addClass(subTitleDiv,["light"]);}subTitleDiv.innerHTML=me.getSubTitle(row,col);subTitleDiv.style.height=subTitleHeight+"px";subTitleDiv.style.lineHeight=subTitleHeight+"px";subTitleDiv.style.fontSize=subTitleFontSize+"px";subTitleDiv.style.paddingRight=subTitlePadding+"px";subTitleDiv.style.paddingLeft=subTitlePadding+"px";subParentDiv.appendChild(subTitleDiv);}var imageLayout,miniCharts=me.miniCharts;if(miniCharts===null){miniCharts=me.miniCharts={};}var rowStr=row.toString(),colStr=col.toString();if(!miniCharts.hasOwnProperty(rowStr)){miniCharts[rowStr]={};}if(!miniCharts[rowStr].hasOwnProperty(colStr)){console.log("new subWidget, mapFileIndex: "+(row*me.finalColCnt+col));var props={totalWidget:me,mapFileIndex:row*me.finalColCnt+col,model:me.modelData,controller:me.controller,xtabModel:me.xtabModel,width:me.CONSTANTS.MIN_WIDTH_OR_HEIGHT,height:me.CONSTANTS.MIN_WIDTH_OR_HEIGHT,top:subTitleHeight,left:0,CONSTANTS:me.CONSTANTS};if(w!==undefined){props.width=w-cbw;}if(h!==undefined){props.height=h-subTitleHeight-cbw;}imageLayout=me.createBaseImageLayout(props);imageLayout.render();imageLayout.parent=me.imageLayoutTable;miniCharts[rowStr][colStr]=imageLayout;}else{console.log("old subWidget, mapFileIndex: "+(row*me.finalColCnt+col));imageLayout=miniCharts[rowStr][colStr];if(w!==undefined){imageLayout.width=w-cbw;}if(h!==undefined){imageLayout.height=h-subTitleHeight-cbw;}imageLayout.top=subTitleHeight;imageLayout.refresh();}subParentDiv.appendChild(imageLayout.domNode);return subParentDiv;},updateUnitChart:function updateUnitChart(div,w,h,t,l){if(!div){return ;}if(this.imageLayoutTable.beingScrolled||(div.offsetWidth===w&&div.offsetHeight===h)){return ;}var me=this,miniCharts=me.miniCharts,rowIndexStr=div.getAttribute("row"),colIndexStr=div.getAttribute("col"),subTitleHeight=me.subTitleHeight,subTitleFontSize=me.subTitleFontSize,subTitlePadding=me.subTitlePadding,cbw=me.CONSTANTS.CHART_BORDER_WIDTH,isRightColumn=(parseInt(colIndexStr,10)===me.finalColCnt-1),isBottomRow=(parseInt(rowIndexStr,10)===me.finalRowCnt-1);if(!me.hasMultiAttr){subTitleHeight=0;cbw=0;}if(me.hasMultiAttr){var subTitleDiv=div.childNodes[0];if(subTitleDiv){subTitleDiv.style.height=subTitleHeight+"px";subTitleDiv.style.lineHeight=subTitleHeight+"px";subTitleDiv.style.fontSize=subTitleFontSize+"px";subTitleDiv.style.paddingRight=subTitlePadding+"px";subTitleDiv.style.paddingLeft=subTitlePadding+"px";}}if(miniCharts&&miniCharts.hasOwnProperty(rowIndexStr)&&miniCharts[rowIndexStr].hasOwnProperty(colIndexStr)){var miniChart=miniCharts[rowIndexStr][colIndexStr];if(w!==undefined){miniChart.width=w-cbw;}if(h!==undefined){miniChart.height=h-subTitleHeight-cbw;}miniChart.top=subTitleHeight;miniChart.refresh();}if(w!==undefined){if(isRightColumn){div.style.width=w+"px";}else{div.style.width=w-cbw+"px";}}if(h!==undefined){if(isBottomRow){div.style.height=h+"px";}else{div.style.height=h-cbw+"px";}}if(t!==undefined){div.style.top=t+"px";}if(l!==undefined){div.style.left=l+"px";}},getBgColorFromCss:function getBgColorFromCss(cellData,colorByIndex){var cssDiv=this.cssDiv,csss=null,th=null,cni,cssStyle;if(this.modelData.hasOwnProperty("css")){csss=this.modelData.css;}if(this.modelData.hasOwnProperty("th")){th=this.modelData.th&&this.modelData.th[colorByIndex];}if(csss&&th&&cellData&&cellData.hasOwnProperty("ty")){var ty=parseInt(cellData.ty,10),ti=cellData.hasOwnProperty("ti")?parseInt(cellData.ti,10):undefined;if((ty===2||ty===4)&&ti!==undefined&&th.length>ti&&th[ti].udbg===1){cni=th[ti].cni;cssDiv.className=cni!==undefined&&csss[cni]&&csss[cni].n;cssStyle=mstrmojo.css.getComputedStyle(cssDiv);if(cssStyle.hasOwnProperty("backgroundColor")){return cssStyle.backgroundColor;}}}return null;},calculateAllBubblesColor:function calculateAllBubblesColor(colorByIndex){var me=this,modelData=me.modelData,i;modelData.allBubblesColor={};var defBubbleColor=me.CONSTANTS.BUBBLE_COLOR.NO_COLORBY_DARK_THEME;if(me.themeMode===me.CONSTANTS.THEME.LIGHT){defBubbleColor=me.CONSTANTS.BUBBLE_COLOR.NO_COLORBY_LIGHT_THEME;}if(colorByIndex>=0){for(i=0;i<modelData.gvs.items.length;i++){var colorByCellData=modelData.gvs.items[i].items[colorByIndex],bubbleColor=me.getBgColorFromCss(colorByCellData,colorByIndex);if(!bubbleColor){bubbleColor=defBubbleColor;}modelData.allBubblesColor[i]=bubbleColor;}}return modelData.allBubblesColor;},createPropsForImageLayoutTable:function(){var me=this,hasMultiAttr=me.hasMultiAttr;var ph=me.createPlaceholder(),props=null;props={placeholder:ph,left:0,top:0,width:me.getWidth(),height:me.getHeight(),nRows:me.finalRowCnt,nCols:me.finalColCnt,chartW:me.cellWidth,chartH:me.cellHeight,borderW:me.CONSTANTS.CHART_BORDER_WIDTH,APIOwner:me,manager:me.manager||new mstrmojo.WidgetMatrixManagerForAndroid()};return props;},detachListeners:function(){if(this._super){this._super();}var me=this;if(me.fullScreenListener){mstrmojo.touchManager.detachEventListener(me.fullScreenListener);delete me.fullScreenListener;}if(me.touchOutsideListener){mstrmojo.touchManager.detachEventListener(me.touchOutsideListener);delete me.touchOutsideListener;}}});}());