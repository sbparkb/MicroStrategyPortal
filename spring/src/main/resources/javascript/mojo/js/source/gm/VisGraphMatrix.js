(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.num","mstrmojo.hash","mstrmojo.VisBase","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.VisTooltip","mstrmojo.VisSplitter","mstrmojo.VisAxisLabel","mstrmojo.gm.TitleLabelCapsule","mstrmojo.MenuButton","mstrmojo.WidgetMatrix","mstrmojo.WidgetMatrixManager","mstrmojo._HasOwnAvatar","mstrmojo._VizSelectionHelper","mstrmojo.vi.ui._IsDropTarget","mstrmojo.gm._SupportDndAsBlackBox","mstrmojo.vi.models.EnumDragSources","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.vi.ui.editors.EditorGroup","mstrmojo.vi._MonitorsAppState","mstrmojo.chart.enums.EnumLineStyle","mstrmojo.vi.ui.rw._XtabDE","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.chart.common.Utility","mstrmojo.vi.ui.rw.VizBox","mstrmojo.vi.ui.VIDragUnit");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVizStyles","EnumVisualizationTemplates");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_HasVisSelections","selectors._IsMultiUnitControl","selectors._BrushesAndHighlights");mstrmojo.requiresClsP("mstrmojo.ui.menus","ToolbarEditorConfig","MenuConfig","_HasMenuPopup");mstrmojo.requiresClsP("mstrmojo.gm","GMUtility","GMEnums","GMLegend","GMLayout","GMContainer","GMController","GMInteractivity","GMProperty","GMPropertyNode","GMPropDefaults","DndItemRenderer","GMAxisScale","GMIdentities","_SupportGraphMatrixBrushesAndHighlights","GMScroll","_GMPropertyHandler");mstrmojo.requiresDescs(12093,12094,12095,12096,12097,12098,12099,12100,12101,12102,12103,12104,13165);var REPORT_PERFORMANCE=true,$MOJO=mstrmojo,$VIZ=$MOJO.vi.viz,$GM=$MOJO.gm,$WRAP=$MOJO.func.wrapMethods,$ARR=$MOJO.array,$CSS=$MOJO.css,$DOM=$MOJO.dom,$NUM=$MOJO.num,$HASH=$MOJO.hash,$VISUTILS=$MOJO.VisUtility,$DZ_ID=$VIZ.EnumDSSDropZones,$VIZ_STYLES=$VIZ.EnumVizStyles,GRAPH_MATRIX_STYLE=$VIZ_STYLES.GRAPH_MATRIX,$VIZ_TEMPLATES=$VIZ.EnumVisualizationTemplates,GMUTIL=$GM.GMUtility,$DC=$GM.GMUtility.sizeCalculator,$LEGEND=$GM.GMLegend,PRP_SHAPE=$GM.EnumShape,ENUM_XML_TAG=$GM.WidgetPropertyTag,ENUM_FORMAT_TAG=$GM.FormatingPropertyTag,TRF_MANIPULATIONS=$GM.EnumTRFManipulations,scrollDrawInterval=150,LEGEND_PADDING=5,DOUBLE_CLICK_INTERVAL=250,PT_PX_RATIO=0.75,CHART_MIN_SIZE_RATIO=0.2,VLINE_THICKNESS=1,HLINE_THICKNESS=1,VALINE_THICKNESS=1,HALINE_THICKNESS=1,XAXIS_TITLE_HEIGHT=15,YAXIS_TITLE_HEIGHT=15,CAPSULE_TOP_PADDING=5,CAPSULE_BORDER_THICKNESS=1,ENUM_SOURCE=$MOJO.vi.models.EnumDragSources,LEGEND_DATA_TYPE=$MOJO.VisEnum.GMLegendDataType,PRP_THEME=$GM.EnumTheme,PRP_LEGEND_MODE=$GM.EnumLegendMode,PRP_LEGEND_SLOT=$GM.EnumLegendSlot,PRP_GRID_LINE=$GM.EnumGridLines,CLICK_TYPE=$GM.EnumClickType,CHART_TYPE=$GM.EnumGraphType,MENU=$GM.EnumContextMenu,CTRL_TYPE=$MOJO.VisEnum.ControlType,DOCK_POS=$GM.EnumDockPosition,ID_TYPE=$GM.EnumIdentityType,ENUM_FMT_STATUS=$GM.EnumShapeFormatStatus,$MP=$GM.Enum3DGMapping,$SEL_OPT_LVL=$GM.EnumSelectionOptionLevel,TIME_STAMP="_tmsp",COLOR_BY_TYPE=$GM.EnumColorByType,FIT_TO=$GM.EnumFitTo;var RESERVED_SCRIPT_CLAZZ=["mstrmojo.gm.GMProperty","mstrmojo.gm.GMInteractivity","mstrmojo.vi.models.GMDropZones","mstrmojo.vi.models.CombineDropZonesModel","mstrmojo.vi.models.editors.GMEditorModel","mstrmojo.Model","mstrmojo.gm.GMController","mstrmojo.ui.menus.Menu","mstrmojo.ui.menus.ToolbarEditor"];function clearListeners(){var chartResizeListener=this.chartResizeListener,splitterListeners=this.splitterListeners,lassoListener=this.lassoListener,legendResizeListener=this.legendResizeListener,legendClickListener=this.legendClickListener,updateSelectionsListener=this.updateSelectionsListener;if(chartResizeListener){chartResizeListener.clear();delete this.chartResizeListener;}if(splitterListeners){splitterListeners.forEach(function(l){l.clear();});this.splitterListeners=[];}if(lassoListener){lassoListener.clear();delete this.lassoListener;}if(legendResizeListener){legendResizeListener.clear();delete this.legendResizeListener;}if(legendClickListener){legendClickListener.clear();delete this.legendClickListener;}if(updateSelectionsListener){updateSelectionsListener.clear();delete this.updateSelectionsListener;}}var noHoverShapes=[];function setScrollDrawInterval(){var GMC=this.GMController,dataPointCount=GMC.getGraphShapeCount(true);if(dataPointCount>10000){scrollDrawInterval=800;}else{scrollDrawInterval=150;}}function getTitleMaxHeight(){var i,text,GMC=this.GMController,chInfo=GMC.getColTitleInfo(true),n=this.colHeaderHArr.length,HTML5PROPS=this.HTML5PROPS,maxLineCount=GMC.getAttributesOnDropZone("Rows").length>0?2:3,singleLineHeight,maxHeight;var getRowHeaderMaxHeight=function(){maxHeight=this.rowHeaderMaxHeightWithoutX2;singleLineHeight=$VISUTILS.measureTextHeight("Test Text",HTML5PROPS.RH_TITLE,0,100,undefined,true,true);maxHeight=Math.max(maxHeight,singleLineHeight*maxLineCount+2*CAPSULE_BORDER_THICKNESS+2*CAPSULE_TOP_PADDING);return GMC.haveX2?65535:maxHeight;};this.colHeaderMaxHeightArr=[];for(i=0;i<n;i++){text=chInfo.items[i].n;singleLineHeight=$VISUTILS.measureTextHeight(text,HTML5PROPS.CH_TITLE,0,100,undefined,true,true);maxHeight=singleLineHeight*maxLineCount+2*CAPSULE_BORDER_THICKNESS+2*CAPSULE_TOP_PADDING;this.colHeaderMaxHeightArr.push(Math.max(maxHeight,this.colHeaderHArr[i]));}this.rowHeaderMaxHeight=getRowHeaderMaxHeight.call(this);}function initProperties(fmt,propertyModel,templateObjectMapping){propertyModel.clearCachedXMLDoc();propertyModel.updateDefaults(this.getDefaultProperties(),fmt);propertyModel.setTemplateObjectMapping(templateObjectMapping);propertyModel.consumeJsonFmt(fmt);propertyModel.initFromXML();}function checkViewFilter(modelData,xtabModel,gmCtr){var gts=modelData.gts,supportViewFilter=true,supportViewFilterPool=gmCtr.supportViewFilterPool={};$ARR.forEach(gts.row,function(u){var id=u.id,tp;if(id&&id!==""){tp=xtabModel.supportsViewFilterActions(u.id);if(!tp){supportViewFilter=false;}supportViewFilterPool[u.id]=tp;}});$ARR.forEach(gts.col,function(u){var id=u.id,tp;if(id&&id!==""){tp=xtabModel.supportsViewFilterActions(u.id);if(!tp){supportViewFilter=false;}supportViewFilterPool[u.id]=tp;}});gmCtr.supportViewFilter=supportViewFilter;}function checkComb(gmCtr){var me=this,metricShape=this.readGlobalProperty(ENUM_XML_TAG.METRIC_SHAPES),tp=gmCtr.chartType,isABL=(tp===CHART_TYPE.AREA||tp===CHART_TYPE.BAR||tp===CHART_TYPE.LINE),enableCombiChart=false,metricIdsArr,metricIdxArr,onTheFlyShape,pureAreaChart=false,hasBarChart=false,mShpJson;if(!isABL||metricShape===undefined){enableCombiChart=false;}else{var gmm=gmCtr.model;mShpJson=metricShape.jsonObj;metricIdxArr=gmCtr.getMetricsOnYAxis();metricIdxArr=metricIdxArr.concat(gmCtr.getMetricsOnXAxis());metricIdsArr=gmm.getMetricIDsFromIndex(metricIdxArr);$ARR.forEach(metricIdsArr,function(mid){if(mShpJson[mid]!==undefined){enableCombiChart=true;}});$ARR.forEach(metricIdxArr,function(mi){if(gmCtr.getForbiddenShapeForMetric(mi).length>0){enableCombiChart=true;me.persistOnTheFlyShape(mi);}});pureAreaChart=true;hasBarChart=false;var metricShapeArr=gmCtr.metricShapeArr=[];$ARR.forEach(metricIdxArr,function(mi){onTheFlyShape=gmCtr.getOnTheFlyShapeForMetric(mi);metricShapeArr[mi]=onTheFlyShape;if(onTheFlyShape!==PRP_SHAPE.AREA){pureAreaChart=false;}if(onTheFlyShape===PRP_SHAPE.BAR){hasBarChart=true;}});}gmCtr.enableCombiChart=enableCombiChart;gmCtr.hasBarChart=hasBarChart;gmCtr.pureAreaChart=pureAreaChart;}function updateDropZoneInfo(modelData){var dz=modelData.dz;if(!dz){dz=modelData.dz={};}var dzItems=["Rows","Columns","XAxis","YAxis","BreakBy","ColorBy","SizeBy","SliceBy","AdditionalMetrics","AngleBy","visProp"];$ARR.forEach(dzItems,function(item){if(!dz[item]){dz[item]={};}});if(!dz.visProp.fmt){dz.visProp.fmt={};}}function addHiddenBubbles(lassoInfo){var GMC=this.GMController,chartInfo=GMC.getChartInfo();if(chartInfo.isBubbleOrScatter){var charts=lassoInfo.selectedCharts,chart,chartDom,hiddenItems,hiddenItem,hiddenItemLength,dataProvider,itemIdentity,metricSelectionCandidate,rIdx,cIdx,gIdx,sIdx,masterView=this.masterViewer,i,j;var containPoint=function(x1,x2,y1,y2,ox,oy){return ox>=x1&&ox<=x2&&oy>=y1&&oy<=y2;},lengthSquared=function(ax,ay,bx,by){return(bx-ax)*(bx-ax)+(by-ay)*(by-ay);};var isBubbleInLasso=function(chartDom,bubble,lasso){var ox=bubble.BoundingBox.x,oy=bubble.BoundingBox.y,r=bubble.Size,cx=chartDom.offsetLeft,cy=chartDom.offsetTop,cw=chartDom.offsetWidth,ch=chartDom.offsetHeight,x1=lasso.left,y1=lasso.top,x2=x1+lasso.width,y2=y1+lasso.height;x1=Math.max(x1-cx,0);x2=Math.min(x2-cx,cw);y1=Math.max(y1-cy,0);y2=Math.min(y2-cy,ch);return lengthSquared(ox,oy,x1,y1)<r*r||lengthSquared(ox,oy,x1,y2)<r*r||lengthSquared(ox,oy,x2,y1)<r*r||lengthSquared(ox,oy,x2,y2)<r*r||containPoint(x1-r,x2+r,y1,y2,ox,oy)||containPoint(x1,x2,y1-r,y2+r,ox,oy);};var chartLength=charts?charts.length:0;for(i=0;i<chartLength;i++){chart=charts[i];rIdx=chart.row;cIdx=chart.col;chartDom=masterView.getChart(rIdx,cIdx);dataProvider=GMC.getDataProvider(rIdx,cIdx);hiddenItems=chartDom&&chartDom.hiddenItems;hiddenItemLength=hiddenItems?hiddenItems.length:0;for(j=0;j<hiddenItemLength;j++){hiddenItem=hiddenItems[j];gIdx=hiddenItem.Id.mGroupId;sIdx=hiddenItem.Id.mSeriesId;if(isBubbleInLasso(chartDom,hiddenItem,lassoInfo)){itemIdentity=dataProvider.getGraphCell(sIdx,gIdx).getIdentity();metricSelectionCandidate=this.interactor.getShapeSelectionInfo(itemIdentity);this.addMetricValueSelection(metricSelectionCandidate);}}}}}function positionToolbarAndContextMenu(pos,toolBarContainer,contextMenuContainer){var toolBar=toolBarContainer.firstChild,contextMenu=contextMenuContainer.firstChild,tbWidth=toolBar?toolBar.offsetWidth:0,tbHeight=toolBar?toolBar.offsetHeight:0,cmWidth=contextMenu?contextMenu.offsetWidth:0,cmHeight=contextMenu?contextMenu.offsetHeight:0,bodyWidth=document.body.offsetWidth,bodyHeight=document.body.offsetHeight,gap=10,upperPadding=5,bottomPadding=5;if(toolBar){toolBar.style.left="0";toolBar.style.right="auto";toolBar.style.top="0";toolBar.style.bottom="auto";}if(contextMenu){contextMenu.style.left="0";contextMenu.style.right="auto";contextMenu.style.top="0";contextMenu.style.bottom="auto";}var outer={w:Math.max(tbWidth,cmWidth),h:0};var hasToolbar=tbHeight>0,hasContextMenu=cmHeight>0;if(hasToolbar&&hasContextMenu){outer.h=tbHeight+cmHeight+gap;}else{if(hasToolbar){outer.h=tbHeight;}else{if(hasContextMenu){outer.h=cmHeight;}else{return false;}}}if(hasToolbar){toolBarContainer.style.left=pos.x+"px";toolBarContainer.style.top=pos.y-tbHeight-gap/2+"px";}if(hasContextMenu){contextMenuContainer.style.left=pos.x+"px";contextMenuContainer.style.top=pos.y+gap/2+"px";}if(pos.x+outer.w>bodyWidth){toolBarContainer.style.left=pos.x-tbWidth+"px";contextMenuContainer.style.left=pos.x-cmWidth+"px";}if(hasToolbar){var toolbarTop=0;if(pos.y-tbHeight-gap/2<upperPadding){toolbarTop=upperPadding;toolBarContainer.style.top=toolbarTop+"px";contextMenuContainer.style.top=toolbarTop+tbHeight+gap+"px";}else{if(pos.y+gap/2+cmHeight>bodyHeight){toolbarTop=Math.max(bodyHeight-cmHeight-gap-tbHeight,upperPadding);toolBarContainer.style.top=toolbarTop+"px";contextMenuContainer.style.top=toolbarTop+tbHeight+gap+"px";}}}else{if(hasContextMenu){var contextMenuTop=0;if(pos.y+gap/2+cmHeight>bodyHeight){contextMenuTop=Math.max(bodyHeight-bottomPadding-cmHeight,upperPadding);contextMenuContainer.style.top=contextMenuTop+"px";}}}}function mouseOverGapBetweenCMTB(evt,CMs,TB){var posTB=$DOM.position(TB),xTBLeft=posTB.x,xTBRight=posTB.x+posTB.w,yTBBottom=posTB.y+posTB.h,inGap=false,cn,tmpName;$ARR.forEach(CMs||[],function(CM){var posCM=$DOM.position(CM),xCMLeft=posCM.x,xCMRight=posCM.x+posCM.w,yCMTop=posCM.y,gap={xLeft:Math.max(xCMLeft,xTBLeft),xRight:Math.min(xCMRight,xTBRight),yTop:yTBBottom,yBottom:yCMTop},ex=evt.pageX,ey=evt.pageY;inGap=ex>=gap.xLeft&&ex<=gap.xRight&&ey>=gap.yTop&&ey<=gap.yBottom;return !inGap;});if(inGap&&evt.target&&evt.target.getAttribute("type")==="marker"){cn=evt.target.getAttribute("class");tmpName="no-hover-"+cn;evt.target.setAttribute("class",tmpName);evt.target.setAttribute("type","no-hover-marker");noHoverShapes.push(evt.target);}else{var tmpArr=[];$ARR.forEach(noHoverShapes,function(shape){tmpName=shape.getAttribute("class");cn=tmpName.substring(9);if(shape===evt.target&&inGap){tmpArr.push(shape);}else{shape.setAttribute("class",cn);shape.setAttribute("type","marker");}});noHoverShapes=tmpArr;}return inGap;}function updateToolbarIfNeeded(forceUpdate){var gmCtr=this.GMController,chtInfo=gmCtr.getChartInfo(),currentChartType;if(chtInfo.isABL){currentChartType=0;}else{if(chtInfo.isBubbleOrScatter){currentChartType=1;}else{currentChartType=2;}}if(forceUpdate||(this.lastChartType!==undefined&&currentChartType!==this.lastChartType)){this.raiseEvent({name:"regenerateToolbar"});}this.lastChartType=currentChartType;}function getToolbarUpdateCallback(){return{success:function success(){this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}function getCharacterGroup(props,formats,showNoFill){var characterGroup=new mstrmojo.ui.editors.controls.CharacterGroup(props);characterGroup.setFormatSource(formats);if(showNoFill!=="undefined"){characterGroup.fontColor.showNoFill=showNoFill;}return characterGroup;}function getCharacterConfig(showNoFill){var me=this,boxContent,titleFmt,props,docModel;boxContent=me.parent.boxContent;docModel=boxContent.model.docModel;titleFmt=boxContent.fmts.ttl;props=boxContent.getFontToolbarProps();if(props.onGroupValueChange===undefined){props.onGroupValueChange=function(propertyName,newValue,oldValue){docModel.changeUnitFormatProperty(me.parent,[{formatType:2,propertyName:propertyName,newValue:newValue,oldValue:oldValue}]);};}return getCharacterGroup(props,titleFmt,showNoFill);}function getFontToolbar(showNoFill){var me=this;return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",showDivider:false,children:[getCharacterConfig.call(me,showNoFill)]}]});}function getTRFInfo(info){return mstrmojo.hash.copy(info,{act:"operateTRFLine",tks:this.k,partialRetrieval:this.model.getDataService().newRetrievalKeysConfig().addNode(this.k)});}function changeShowDataLabelForMetric(metricID,showDataLabel){var metricLevelShowDataLabel=this.readGlobalProperty(ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL);metricLevelShowDataLabel.setProperty(metricID,showDataLabel);this.writeGlobalProperty(ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL,metricLevelShowDataLabel,undefined);}function cmdMgr(me){return me.model.controller.cmdMgr;}function getPersistWidgetPropertyAction(lXML){return{act:"setProperty",nodeKey:this.getData().k,prs:"FormattingWidget",pri:4,v:GMUTIL.replaceSpecialChars(lXML)};}function styleDomNode(node,settings,keepDisplay){var n,v,display="block",style=node.style;for(n in settings){if(settings.hasOwnProperty(n)){v=settings[n];if((typeof v)==="number"){if((n==="width"||n==="height")&&v===0){display="none";}v+="px";}style[n]=v;}}style.backgroundColor="rgba(0,0,0,0)";if(!keepDisplay&&!settings.hasOwnProperty("display")){style.display=display;}}function getLineSizeInfo(type,depth,props){var tmp,manager,ratio=1-CHART_MIN_SIZE_RATIO,info=this.GMInfo,y1W=info.yAxisWidth,y2W=info.yAxis2Width,x1H=info.xAxisHeight,x2H=info.xAxis2Height,totalW=this.getWidth(),totalH=this.getHeight(),rhW=this.rowHeaderW,chH=this.colHeaderH,realW=this.actualWidth,realH=this.actualHeight,minSize=(props&&props.min!==undefined)?props.min:20,maxSize=(props&&props.max!==undefined)?props.max:65535;if(type===CTRL_TYPE.GM_YAXIS){return{size:y1W,min:minSize,max:Math.min(maxSize,Math.floor(totalW*ratio-rhW-y2W))};}if(type===CTRL_TYPE.GM_YAXIS2){return{size:y2W,min:minSize,max:Math.min(maxSize,Math.floor(totalW*ratio-rhW-y1W))};}if(type===CTRL_TYPE.GM_XAXIS){return{size:x1H,min:minSize,max:Math.min(maxSize,Math.floor(totalH*ratio-chH-x2H))};}if(type===CTRL_TYPE.GM_XAXIS2){return{size:x2H,min:minSize,max:Math.min(maxSize,Math.floor(totalH*ratio-chH-x1H))};}tmp=this.rowHeaderWArr[depth];if(type===CTRL_TYPE.GM_V_MATRIX_LINE){return{size:tmp,min:minSize,max:Math.min(maxSize,Math.floor(totalW*ratio-y1W-y2W-rhW+tmp))};}tmp=this.colHeaderHArr[depth];if(type===CTRL_TYPE.GM_H_MATRIX_LINE){return{size:tmp,min:minSize,max:Math.min(maxSize,Math.floor(totalH*ratio-x1H-x2H-chH+tmp))};}manager=this.manager;if(type===CTRL_TYPE.GM_V_CHART_LINE){return{size:manager.getColWidth(depth),min:minSize,max:maxSize};}if(type===CTRL_TYPE.GM_H_CHART_LINE){return{size:manager.getRowHeight(depth),min:minSize,max:maxSize};}if(type===CTRL_TYPE.GM_V_EXTRA_LINE){return{size:this.rowHeaderExtraW,min:minSize,max:Math.min(maxSize,Math.floor(totalW*ratio))};}tmp=realW-y1W-y2W-rhW;if(type===CTRL_TYPE.GM_RIGHT_BORDER){return{size:tmp,min:minSize,max:Math.min(maxSize,Math.floor(totalW-y1W-y2W-rhW))};}tmp=realH-x1H-x2H-chH;if(type===CTRL_TYPE.GM_BOTTOM_BORDER){return{size:tmp,min:minSize,max:Math.min(maxSize,Math.floor(totalH-x1H-x2H-chH))};}}function getTrendLineOptionForMetricId(metricId,independent){var opts=!independent?this.getDependentMetricOptions():this.getIndependentMetricOptions(),opt;opts.forEach(function(o){if(metricId===o.key){opt=o;}});return opt;}function getReferenceOptionForAxisKey(axisKey){var opts=this.getReferenceAxisOption(),opt;opts.forEach(function(o){if(o.key===axisKey){opt=o;return false;}});return opt;}function getUnderlineTarget(target,e){var underlineTarget;if(target&&e){target.style.display="none";underlineTarget=document.elementFromPoint(e.pageX,e.pageY);target.style.display="block";}return underlineTarget||target;}function onWheelCallBack(dirc,e){var node=this.scrollNode;if(!node){return ;}var x=node.xPos=node.xPos||0,y=node.yPos=node.yPos||0,nx=node.xPos+e.deltaX,ny=node.yPos+e.deltaY,maxX=node.offsetWidth-node.parentNode.offsetWidth,maxY=node.offsetHeight-node.parentNode.offsetHeight;ny=(ny<0)?0:ny;ny=(ny>maxY)?maxY:ny;nx=(nx<0)?0:nx;nx=(nx>maxX)?maxX:nx;if(y===ny&&x===nx){return ;}switch(dirc){case"v":y=node.yPos=ny;break;case"h":x=node.xPos=nx;break;default:y=node.yPos=ny;x=node.xPos=nx;}node.style[$DOM.CSS3_TRANSFORM]=$DOM.createTranslateString(-x,-y,0);this.onscroll();}function onWheelCallBackForMainNode(e){var target=e.target||e.srcElement,ctrlType=target.getAttribute("ctrlType");if(ctrlType===CTRL_TYPE.GM_CHART_ROW||ctrlType===CTRL_TYPE.GM_CHART_COL){onWheelCallBack.call(this,"both",e);}}mstrmojo.gm.VisGraphMatrix=mstrmojo.declare(mstrmojo.VisBase,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsDropTarget,mstrmojo.gm._SupportDndAsBlackBox,mstrmojo._VizSelectionHelper,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.gm._SupportGraphMatrixBrushesAndHighlights,mstrmojo.vi._MonitorsAppState,mstrmojo.vi.ui.rw._XtabDE,mstrmojo.gm._GMPropertyHandler],{scriptClass:"mstrmojo.gm.VisGraphMatrix",cssClass:"gm-light-theme",menuCssClass:"gm-context-menu-light",theme:PRP_THEME.LIGHT,noData:false,zIndex:1,sBarWidth:11,textHeightInX:20,textHeightInY:20,lines:null,masterViewer:undefined,slaveRowHeaders:[],slaveColHeaders:[],slaveYAxis:undefined,slaveYAxis2:undefined,slaveXAxis:undefined,slaveXAxis2:undefined,manager:undefined,chartResizeListener:undefined,splitterListeners:undefined,lassoListener:undefined,updateSelectionsListener:undefined,interactor:undefined,mousePos:undefined,layouter:mstrmojo.gm.GMLayout,svgPool:[],normalizedIdCache:{},formattingMode:false,enableTooltip:true,enableShapeHover:true,curSelOptLvl:undefined,enableCETimer:false,initFlagForContextMenu:true,preClickType:CLICK_TYPE.NONE,trendLineNotifications:null,referencefLineNotifications:null,handleDndForParentNode:true,avatarCssClass:"mstrmojo-VIUnitList",mainContainerNode:"domMainContainer",markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}px; position:absolute; height:{@height}px; left:{@left}px; top:{@top}px; z-index:{@zIndex};" mstrAttach:click,scroll,mouseover,mousemove,mouseout,mousedown,mouseup,contextmenu><div class="gm-main-container"><div class="gm-tableheader"></div><div class="gm-colheader"></div><div class="gm-rowheader"></div><div class="gm-yaxis"></div><div class="gm-container"></div><div class="gm-yaxis"></div><div></div><div class="gm-xaxis"></div><div></div><div class="gm-dummy-a"></div><div class="gm-dummy-b"></div></div><div class="gm-legend"></div><div class="gm-message"></div></div>',markupSlots:{domMainContainer:function(){return this.domNode.firstChild;},domTabHeader:function(){return this.domNode.firstChild.childNodes[0];},domColHeader:function(){return this.domNode.firstChild.childNodes[1];},domRowHeader:function(){return this.domNode.firstChild.childNodes[2];},domYAxis:function(){return this.domNode.firstChild.childNodes[3];},domGM:function(){return this.domNode.firstChild.childNodes[4];},domYAxis2:function(){return this.domNode.firstChild.childNodes[5];},domVSBar:function(){return this.domNode.firstChild.childNodes[6];},domXAxis:function(){return this.domNode.firstChild.childNodes[7];},domHSBar:function(){return this.domNode.firstChild.childNodes[8];},domDummyA:function(){return this.domNode.firstChild.childNodes[9];},domDummyB:function(){return this.domNode.firstChild.childNodes[10];},domLegend:function(){return this.domNode.childNodes[1];},domMessage:function(){return this.domNode.childNodes[2];}},init:function(props){this.lines={axes:{},borders:{},vlines:{},hlines:{},rows:[],cols:[],hMajorGridLines:[],hMinorGridLines:[],vMajorGridLines:[],vMinorGridLines:[],axisSplitters:{}};this.HTML5PROPS={};this._super(props);this.property=this.addDisposable(new $GM.GMProperty());this.interactor=this.addDisposable(new $GM.GMInteractivity({widget:this,fmtMode:this.formattingMode}));this.initFlagForContextMenu=true;this.trendLineNotifications=[];this.referencefLineNotifications=[];this.splitterListeners=[];this.enableDomDommy=false;},onAppStateChange:function onAppStateChange(evt){this._super(evt);this.closePopup();},getContainerMenuItems:function(cfg){if(!this.noData){var chgShp=this.getMenuHandler("changeGlobalShape");if(chgShp){cfg.addSubMenuItem(mstrmojo.desc(11972,"Change Shape"),"",this.id,chgShp);}}var invokeDebug=this.getMenuHandler("debug");if(invokeDebug){}},raiseEventCMSelection:function(identityType,metricId){var obj={name:"onContextMenuSelection",identityType:identityType};if(metricId!==undefined){obj.metricId=metricId;}this.raiseEvent(obj);return obj;},raiseEventFormatableChanged:function(identity,level,arrayOfComb){if(identity===undefined&&level===undefined&&arrayOfComb===undefined){this.raiseEvent(this.lastFormatableChangedObj);return this.lastFormatableChangedObj;}var obj={name:"formattingObjectChanged",identity:identity};obj.selectionlevel=level;if(arrayOfComb){obj.arrayOfComb=arrayOfComb;}this.identity=identity;this.curSelOptLvl=level;this.arrayOfComb=arrayOfComb;this.raiseEvent(obj);this.lastFormatableChangedObj=obj;return obj;},raiseEventGlobalPropertyChanged:function(propName,value,option){var obj={name:"propertyChanged",n:propName,opt:option,v:value};this.raiseEvent(obj);return obj;},raiseEventOnFormattingIdentity:function(identities){if(this.formattingMode){var obj={name:"nonShapeFormatableChanged",identities:identities};this.raiseEvent(obj);return obj;}},raiseEventOnNonFormattingIdentity:function(identities){var obj={name:"nonShapeFormatableChanged",identities:identities};this.raiseEvent(obj);return obj;},raiseEventShapeFormattingChanged:function(propName){var formattingCollects=this.getPropertiesOfFormatable();formattingCollects.modifiedPropertyKeys=[propName];if(propName===ENUM_FORMAT_TAG.SHAPE_FILL_COLOR){formattingCollects.modifiedPropertyKeys.push(ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR);}this.raiseEventGlobalPropertyChanged("ShapeFormatting",formattingCollects);},absorbGraphStyle:function(){var me=this,helperContext,chtInfo=this.getChartInfo(),CEU=mstrmojo.chart.common.Utility,gpp=this.defn.gpp,gp=gpp&&gpp.gp,gmp;helperContext={isGridChart:chtInfo.isGrid,isPieShape:chtInfo.isPie,isVertical:chtInfo.dirc===$GM.EnumABLDirection.VERTICAL};var showGraphLevelDatalabel,dataLabelStyle=1,setOnTheFly=false;$ARR.forEach(gp,function(oneProperty){gmp=CEU.transformProperty(oneProperty,0,helperContext);if(gmp&&gmp.Name){setOnTheFly=false;switch(gmp.Name){case"ShowSeriesDataLabel":if(!showGraphLevelDatalabel){showGraphLevelDatalabel=showGraphLevelDatalabel||gmp.Value;}break;case"DataLabel":dataLabelStyle=gmp.Value;setOnTheFly=helperContext.isPieShape;break;default:setOnTheFly=true;break;}if(setOnTheFly&&me.property.readItem(gmp.Name,true)===undefined){me.setWidgetPropertyValue(gmp.Name,gmp.Value);}}});if(showGraphLevelDatalabel===false){me.setWidgetPropertyValue("DataLabel",1);}else{if(showGraphLevelDatalabel===true){me.setWidgetPropertyValue("DataLabel",dataLabelStyle);}}},postFillGMControllerStyle:function postFillGMControllerStyle(){var gmCtr=this.GMController,HTML5PROPS=this.HTML5PROPS;gmCtr.rhStyles=HTML5PROPS.RH;gmCtr.chStyles=HTML5PROPS.CH;gmCtr.xTitleStyles=HTML5PROPS.AXIS_TITLE_X;gmCtr.yTitleStyles=HTML5PROPS.AXIS_TITLE_Y;},checkTemplateAndDropzone:function(){var me=this,data=me.getData(),dz=data.dz,gts=data.gts;if(!!data.eg){return true;}var gridTitles=gts,rowTitles=gridTitles.row,colTitles=gridTitles.col,gridMetricElements;[colTitles,rowTitles].forEach(function(titles){if(!gridMetricElements&&titles){var lastTitle=titles[titles.length-1];if(lastTitle&&lastTitle.otp===-1&&lastTitle.es){gridMetricElements=lastTitle.es;}}});var dzNameArray=["Rows","Columns","SizeBy","AngleBy","SliceBy","ColorBy","XAxis","YAxis","BreakBy","AdditionalMetrics"],pass=true;$ARR.forEach(dzNameArray,function(name){var dropzone=dz[name],templateMetric;if(dropzone){templateMetric=dropzone.TemplateMetric;if(templateMetric){$ARR.forEach(templateMetric,function(metric){pass=pass&&($ARR.find(gridMetricElements,"oid",metric.id)!==-1);});}}});return pass;},update:function update(node){var continueUpdate=this._super(node);if(!continueUpdate){return continueUpdate;}if(!this.checkTemplateAndDropzone()){mstrmojo.err({name:"Currently we do not support metric selector targeting to Widget",message:"Attribute/Metric in Dropzone doesn't match Grid Template"});return continueUpdate;}var me=this,xtabModel=me.model,modelData=this.getData(),dz,fmt,gmCtr,property=this.property,docModel=xtabModel.docModel,datasets=docModel.datasets,datasetName,dataset;if($VISUTILS.isOnExpressMode()){this.noData=modelData.eg!==undefined;if(!modelData.eg){this.INVALID_TEMP=GMUTIL.isInvalidTemplate(modelData);}if(this.noData||this.INVALID_TEMP){this.errorMsg=GMUTIL.getInvalidTemplateErrMsg(modelData.eg);return continueUpdate;}}me.sid=modelData.sid;updateDropZoneInfo(modelData);GMUTIL.startTimer({functionName:"VisGraphMatrix.update",purpose:"JSON loading & consuming ("+this.k+")"});dz=modelData.dz;fmt=dz.visProp.fmt;var templateUnits,templateObjectMapping={},datasetId,itemId2DsIdMap={};for(datasetName in datasets){if(datasets.hasOwnProperty(datasetName)){dataset=datasets[datasetName];datasetId=dataset.did;templateUnits=dataset.att.concat(dataset.mx);$ARR.forEach(templateUnits,function(item){templateObjectMapping[item.did]=item.t;itemId2DsIdMap[item.did]=datasetId;});}}this.itemId2DsIdMap=itemId2DsIdMap;initProperties.call(this,fmt,property,templateObjectMapping);GMUTIL.destroyDisposable(this,this.GMController);gmCtr=this.GMController=this.addDisposable(new $GM.GMController({view:this,property:this.property,defn:this.defn,firstRes:modelData,xtabModel:xtabModel}));gmCtr.msgCenter={};this.noData=!!modelData.eg;if(!this.noData){gmCtr.postInit();this.absorbGraphStyle();this.resetHTML5Props();gmCtr.checkDataLabelType();this.absorbAxisOrigin();checkViewFilter.call(this,modelData,xtabModel,gmCtr);checkComb.call(this,gmCtr);gmCtr.updateChartInfo();property.setController(this.GMController);updateToolbarIfNeeded.call(this,true);}else{this.errorMsg=modelData.eg;}GMUTIL.endTimer();return continueUpdate;},getVisType:function getVisType(){var vt=this.getWidgetPropertyValue("visType");if(vt===undefined){var tp=this.GMController.chartType,chartInfo=this.getChartInfo(),VERTICAL_CHART=$GM.EnumABLDirection.VERTICAL;if(chartInfo.isCombo){vt=$VIZ_TEMPLATES.GRAPHCOMBINATIONBARAREADUALAXIS;}else{if(chartInfo.isGrid){var propShape=this.getWidgetPropertyValue(ENUM_XML_TAG.SHAPE);if(propShape===PRP_SHAPE.LINE){tp=CHART_TYPE.LINE;}else{if(propShape===PRP_SHAPE.BAR){tp=CHART_TYPE.BAR;}else{if(propShape===PRP_SHAPE.AREA){tp=CHART_TYPE.AREA;}else{if(propShape===PRP_SHAPE.PIE){tp=CHART_TYPE.BAR;}else{if(propShape===PRP_SHAPE.RING){tp=CHART_TYPE.BAR;}else{tp=CHART_TYPE.BAR;}}}}}}switch(tp){case CHART_TYPE.AREA:vt=(chartInfo.dirc===VERTICAL_CHART)?$VIZ_TEMPLATES.GRAPHMATRIXVERTICALAREAAUTOMATIC:$VIZ_TEMPLATES.GRAPHMATRIXHORIZONTALAREAAUTOMATIC;break;case CHART_TYPE.BAR:vt=(chartInfo.dirc===VERTICAL_CHART)?$VIZ_TEMPLATES.GRAPHMATRIXVERTICALBARAUTOMATIC:$VIZ_TEMPLATES.GRAPHMATRIXHORIZONTALBARAUTOMATIC;break;case CHART_TYPE.LINE:vt=(chartInfo.dirc===VERTICAL_CHART)?$VIZ_TEMPLATES.GRAPHMATRIXVERTICALLINEAUTOMATIC:$VIZ_TEMPLATES.GRAPHMATRIXHORIZONTALLINEAUTOMATIC;break;case CHART_TYPE.SCATTER:case CHART_TYPE.BUBBLE:vt=$VIZ_TEMPLATES.GRAPHMATRIXBUBBLECIRCLEMM;break;case CHART_TYPE.PIE:vt=$VIZ_TEMPLATES.GRAPHMATRIXPIE;break;case CHART_TYPE.GRID:break;}}}return{s:GRAPH_MATRIX_STYLE,vt:vt};},setInteractive:function(flag){this.enableTooltip=flag;this.enableShapeHover=flag;},getFlushGraphPropertyAction:function(modifiedGraphProperites){var prop=[],pn,arr,idsCombi,pv,str3DGIds,isDirty=false;$ARR.forEach(modifiedGraphProperites,function(gp){pn=gp.n;pv=gp.v;str3DGIds=$MP[pn];if(str3DGIds!==undefined){isDirty=true;arr=str3DGIds.split("_");idsCombi=arr.join("\u001e");prop[idsCombi]=pv;}});},isInCombinationMode:function(){var gmCtr=this.GMController;return gmCtr.enableCombiChart;},trendLineCouldBeEnabled:function(){return true;},refLineCouldBeEnabled:function(){return true;},isAttributeMetricChart:function(){var gmCtr=this.GMController;return gmCtr.isABL;},getGraphFormatsForSingleShape:function(identity,selOptLvl){var elementComb,allPropKey,formatObj,gc,gmCtr=this.GMController;if(selOptLvl===$SEL_OPT_LVL.ALL_SHAPE){allPropKey=ENUM_FORMAT_TAG.ALL_SHAPE_FORMAT;formatObj=this.getWidgetPropertyValue(allPropKey);return formatObj;}if(selOptLvl===$SEL_OPT_LVL.ITSELF_RESOLVED){gc=identity.getGraphCell();return gc.getFormattingProperties();}if(selOptLvl===$SEL_OPT_LVL.ITSELF){elementComb=identity.getSelectedObjectLowestLevel(true);}else{if(selOptLvl===$SEL_OPT_LVL.COLOR_BY){elementComb=identity.getSelectedObjectColorByInfo();}else{if(selOptLvl===$SEL_OPT_LVL.METRIC){elementComb=identity.getSelectedObjectMetricInfo();}}}return gmCtr.getShapeFormatsWithCombination(elementComb);},clientRerenderGraphMatrix:function(){this.update();this.GMController.reRenderGM();},updateColorMapCallback:function(){this.colorByData=this.GMController.getColorByLegendInfo();this.GMController.clearShapeFormatsCache();this.updateCharts();if(this.legend){this.legend.updateColorBySquare(this.colorByData);}this.raiseEventShapeFormattingChanged(ENUM_FORMAT_TAG.SHAPE_FILL_COLOR);},applyHTML5Props:function(styles){VLINE_THICKNESS=parseInt(styles.MATRIX_LINE_V.borderWidth,10)||1;HLINE_THICKNESS=parseInt(styles.MATRIX_LINE_H.borderWidth,10)||1;VALINE_THICKNESS=parseInt(styles.AXIS_LINE_Y.borderWidth,10)||1;HALINE_THICKNESS=parseInt(styles.AXIS_LINE_X.borderWidth,10)||1;XAXIS_TITLE_HEIGHT=Math.floor((parseInt(styles.AXIS_TITLE_X.fontSize,10)||11)/PT_PX_RATIO+0.5);YAXIS_TITLE_HEIGHT=Math.floor((parseInt(styles.AXIS_TITLE_Y.fontSize,10)||11)/PT_PX_RATIO+0.5);styles.AXIS_TITLE_X.lineHeight=XAXIS_TITLE_HEIGHT+"px";styles.AXIS_TITLE_Y.lineHeight=YAXIS_TITLE_HEIGHT+"px";XAXIS_TITLE_HEIGHT+=12;YAXIS_TITLE_HEIGHT+=12;},getAddTRLineAction:function(info){var action=getTRFInfo.call(this,info);action.rm=TRF_MANIPULATIONS.AddTRLine;return action;},getUpdateTRLineAction:function(info){var action=getTRFInfo.call(this,info);action.rm=TRF_MANIPULATIONS.UpdateTRLine;return action;},getRemoveTRLineAction:function(info){var action=getTRFInfo.call(this,info);action.rm=TRF_MANIPULATIONS.RemoveTRLine;return action;},getUpdateForecastInfoAction:function(info){var action=getTRFInfo.call(this,info);action.rm=TRF_MANIPULATIONS.UpdateForecastInfo;return action;},collectTrendLineAction:function(trendJSON,actions,iKey){var info;info=this.getTrendRefInfo(trendJSON);if(iKey){info.metricId=iKey;}if(trendJSON.existing){actions.push(this.getUpdateTRLineAction(info));}else{actions.push(this.getAddTRLineAction(info));}},collectRefLineAction:function(refJSON,actions,iKey){var info;info=this.getTrendRefInfo(refJSON);if(iKey){info.metricId=iKey;}if(refJSON.existing){actions.push(this.getUpdateTRLineAction(info));}else{actions.push(this.getAddTRLineAction(info));}},collectAddRefLineAction:function(refJSON,actions){var info;info=this.getTrendRefInfo(refJSON);actions.push(this.getAddTRLineAction(info));},collectRemoveRefLineAction:function(refJSON,actions){var info;info=this.getTrendRefInfo(refJSON);if(refJSON.existing){actions.push(this.getRemoveTRLineAction(info));}},collectABLForecastActions:function(globalTrendJSON,metricId,actions){var rawObj={},sea=globalTrendJSON[ENUM_XML_TAG.TREND_SEASONALITY];rawObj[ENUM_XML_TAG.TREND_SEASONALITY]=sea;rawObj[ENUM_XML_TAG.TREND_FORECAST_ENABLED]=globalTrendJSON[ENUM_XML_TAG.TREND_FORECAST_ENABLED];rawObj[ENUM_XML_TAG.TREND_BWD_FORECAST]=globalTrendJSON[ENUM_XML_TAG.TREND_BWD_FORECAST];rawObj[ENUM_XML_TAG.TREND_FWD_FORECAST]=globalTrendJSON[ENUM_XML_TAG.TREND_FWD_FORECAST];var info=this.getTrendRefInfo(rawObj);info.metricId=metricId;actions.push(this.getUpdateForecastInfoAction(info));},getEnableTrendLineActions:function(trendJson,actions,metricId){actions=actions||[];this.collectTrendLineAction(trendJson,actions,metricId);return actions;},getEnableRefLineActions:function(refJSON,actions,metricId){actions=actions||[];this.collectRefLineAction(refJSON,actions,metricId);return actions;},onFormatableTargetChanged:function(option){var identitiesOfInterest,selection,fmtLvl,fmtState=this.interactor.fmtState,colorByComb,metricComb,arrayOfComb,shapeCollectionIdentity;if(this.syning){return ;}if(option&&option.optLvl===$SEL_OPT_LVL.COLOR_BY){fmtState=this.interactor.fmtState=ENUM_FMT_STATUS.PER_COLORBY;}if(fmtState===ENUM_FMT_STATUS.PER_COLORBY){identitiesOfInterest=this.interactor.getColorByIdentities();}else{identitiesOfInterest=this.interactor.getBreakByIdentities();}if(!option){var cbTp=this.GMController.model.colorType;if(fmtState!==ENUM_FMT_STATUS.PER_SHAPE&&(cbTp===COLOR_BY_TYPE.NULL||cbTp===COLOR_BY_TYPE.METRICS)){fmtLvl=$SEL_OPT_LVL.ALL_SHAPE;$VISUTILS.visPrint("Changed to ALL");}else{fmtLvl=(fmtState===ENUM_FMT_STATUS.PER_COLORBY?$SEL_OPT_LVL.COLOR_BY:$SEL_OPT_LVL.ITSELF);arrayOfComb=this.collectUniqueCombination(identitiesOfInterest,fmtLvl);$VISUTILS.visPrint("Changed to Color By by Mouse Action");}this.curSelOptLvl=fmtLvl;}else{fmtLvl=option.optLvl;this.curSelOptLvl=fmtLvl;if(option.key==="none"){this.clearSelections(true);}else{if(fmtLvl===$SEL_OPT_LVL.ALL_SHAPE){$VISUTILS.visPrint("Changed to ALL");}else{if(fmtLvl===$SEL_OPT_LVL.ITSELF){$VISUTILS.visPrint("Changed to Selected Elements");arrayOfComb=this.collectUniqueCombination(identitiesOfInterest,fmtLvl);}else{if(fmtLvl===$SEL_OPT_LVL.COLOR_BY){selection={};colorByComb=option.comb;arrayOfComb=[colorByComb];$ARR.forEach(colorByComb,function(item){if(!selection[item.tid]){selection[item.tid]=[{id:item.eid}];}else{selection[item.tid].push({id:item.eid});}});$VISUTILS.visPrint("Changed to Color By Option "+option.opt);}else{if(fmtLvl===$SEL_OPT_LVL.METRIC){metricComb=option.comb;selection={};$ARR.forEach(metricComb,function(item){if(!selection[item.tid]){selection[item.tid]=[{id:item.eid}];}else{selection[item.tid].push({id:item.eid});}});$VISUTILS.visPrint("Changed to Metric By Option "+option.opt);}}}}}}shapeCollectionIdentity={objType:ID_TYPE.SHAPE_COLLECTION,identityArr:identitiesOfInterest};var extraCombArr;if(metricComb){extraCombArr=[metricComb];}else{if(arrayOfComb){extraCombArr=arrayOfComb;}else{extraCombArr=undefined;}}this.syning=true;this.raiseEventFormatableChanged(shapeCollectionIdentity,fmtLvl,extraCombArr);this.syning=false;},submitUpdatesAndPersistXML:function submitUpdatesAndPersistXML(actions,requestCallback,silentUndoRedoCallback,suppressData,rqstOnlyDefn,puFiltersConfig){actions=actions||[];if(this.isXMLDirty()){actions.push(this.getPersistAction());}if(actions.length===0){return ;}var me=this,urInfo,puFilters,extra={},docModel=me.getDocModel(),dataService=docModel.getDataService();if(puFiltersConfig){puFilters=this.model.getDataService().newRetrievalKeysConfig();puFilters.addNode(this.k,puFiltersConfig);actions[0].partialRetrieval=puFilters;}if(suppressData){$HASH.copy(mstrmojo.DocDataService.SUPPRESS_DATA,extra);}if(rqstOnlyDefn){$HASH.copy(mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION,extra);}if(suppressData&&silentUndoRedoCallback){urInfo={silent:true,undo:silentUndoRedoCallback.undo,redo:silentUndoRedoCallback.redo};}else{urInfo={callback:this.getUnSilentUndoRedoCallback(actions,docModel)};}cmdMgr(me).execute({execute:function execute(){var update=dataService.newUpdate(this,undefined);update.add(actions,requestCallback,extra);if(!suppressData){this.submitUpdate(update);}else{this.submitSilent(update.actions);}me.resetXMLDirtyFlag();},urInfo:urInfo});},getModelController:function(){return this.model.controller||this.getDocModel().controller;},getXTabRefreshCallBack:function(){return this.getModelController()._getXtabCallback(this);},getDocModelSliceCallback:function(){return this.getDocModel().getSliceCallback({tks:this.k});},getUnSilentUndoRedoCallback:function(actions,docModel){var undoRedoCallback=this.getXTabRefreshCallBack(),updateColorMap=false;$ARR.forEach(actions,function(action){if(action.act==="updateElementsPropertiesMap"){updateColorMap=true;return false;}});if(updateColorMap){$WRAP(docModel.getUpdateColorMapCallback(),undoRedoCallback);}return undoRedoCallback;},outputLog4PartialRender:function outputLog4PartialRender(){if(REPORT_PERFORMANCE&&window.console){if(this.GMController.enablePartialRendering){$VISUTILS.visPrint("# Partial Rendering: ON");}else{$VISUTILS.visPrint("# Partial Rendering: OFF");}}},hEvalSizeIteratively:function hEvalSizeIteratively(){this.hEvalSize4Headers();getTitleMaxHeight.call(this);this.hEvalSize4GMArea();if(!this.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_HEADER_SHOW)){return ;}var i,text,textHeight,layouter=this.layouter,GMC=this.GMController,changed=false,chInfo=GMC.getColTitleInfo(true),maxWidth=this.hGetColTitleWidth(),n=this.colHeaderHArr.length,HTML5PROPS=this.HTML5PROPS,maxLineCount=GMC.getAttributesOnDropZone("Rows").length>0?2:3;for(i=0;i<n;i++){text=chInfo.items[i].n;textHeight=layouter.batchEvalTextHeight([text],[maxWidth],HTML5PROPS.CH_TITLE,CAPSULE_TOP_PADDING+CAPSULE_BORDER_THICKNESS,maxLineCount)[0];if(textHeight>this.colHeaderHArr[i]){this.colHeaderHArr[i]=textHeight;changed=true;}}if(changed){getTitleMaxHeight.call(this);this.hEvalSize4GMArea();}},isEmpty:function isEmpty(){return this.noData||!this.GMController||this.GMController.isEmptyVis();},getVisEmptyMsgControls:function getVisEmptyMsgControls(){var mkString;if(this.noData){if(this.model.data.egt===2){mkString=$VISUTILS.getVisEmptyMsg("AE_ERROR");}else{mkString=$VISUTILS.getVisEmptyMsg("NODATA_OTHERERROR");}}else{mkString=$VISUTILS.getVisEmptyMsg();}return[{scriptClass:"mstrmojo.Container",markupString:mkString,markupSlots:{containerNode:function(){return this.domNode;}}}];},renderErrorMessage:function renderErrorMessage(msg){var div=this.domMessage,textDiv=document.createElement("div");div.style.cssText+="position:relative;";textDiv.className="mstrmojo-message gm-error-msg";textDiv.innerText=msg;div.appendChild(textDiv);},displayOtherNotificationMessage:function(){var gmCtr=this.GMController,msgCenter=gmCtr.msgCenter;if(msgCenter){$HASH.forEach(msgCenter,function(v,n){mstrmojo.notify(n,null);});delete gmCtr.msgCenter;}},displayTrendLineErrorMessages:function(){var key,gmCtr=this.GMController,trendLineErrors=gmCtr.trendLineErrors;if(trendLineErrors){for(key in trendLineErrors){if(trendLineErrors.hasOwnProperty(key)){$MOJO.notify(trendLineErrors[key]);}}}delete gmCtr.trendLineErrors;var trendLineNotifications=this.trendLineNotifications,referenceLineNotifications=this.referenceLineNotifications;$ARR.forEach([trendLineNotifications,referenceLineNotifications],function(notifications){$ARR.forEach(notifications,function(notification){$MOJO.notify(notification);});});this.trendLineNotifications=[];this.referenceLineNotifications=[];if(gmCtr.trendlineDefined&&gmCtr.mulAttsOnAxisForABL){$MOJO.notify(mstrmojo.desc(12281,"Trend lines are disabled due to multiple attributes on independent axis."));}if(this.trendSeasonalityError){$MOJO.notify(mstrmojo.desc(14105,"The seasonality feature is unavailable with logarithmic and power trend line models."));delete this.trendSeasonalityError;}},setModel:function setModel(model){this._super(model);this.listenToUpdateColorMap(this.updateColorMapCallback);},postBuildRendering:function(){if(this.waitingForData){return ;}if(!this.checkTemplateAndDropzone()){mstrmojo.err({name:"Currently we do not support metric selector targeting to Widget",message:"Attribute/Metric in Dropzone doesn't match Grid Template"});return ;}if($VISUTILS.isOnExpressMode()){var themeID=this.model.docModel.thm.did,rsdTheme=(themeID==="F1FED8AC42B57AC1B0E9518FED0F89D6"?"mojo-theme-dark":"mojo-theme-light"),themeDiv=document.getElementsByClassName("mstrmojo-OIVMPage ");if(themeDiv.length===1){themeDiv[0].setAttribute("class","mstrmojo-OIVMPage "+rsdTheme);}}this.postBuilderingCalled=true;var HTML5PROPS=this.HTML5PROPS;if($VISUTILS.isOnExpressMode()){if(this.isEmpty()||this.INVALID_TEMP){this.renderErrorMessage(this.errorMsg||mstrmojo.desc(12093,"Filter excludes all data"));this._super();return ;}}else{if(this.isEmpty()){this._super();return ;}}if(!this.hValidateInput()||this.INVALID_TEMP){return ;}this.applyHTML5Props(HTML5PROPS);this.setTheme(this.theme);this.hResetLocalVars();if(!this.noData){GMUTIL.startTimer({functionName:"VisGraphMatrix.postBuildRendering",purpose:"Layout of GraphMatrix ("+this.k+")"});this.adjustRHAndCHOpacity();this.hInitHelpers();this.hPrepareDataAndCE();this.hEvalSize4Legend();this.hEvalSizeIteratively();this.hCalcRadiusAndMargin(true);this.hDecideDataLabelRotation();this.initGMScroll();this.hLayoutControls();this.hFillContents();this.hInitLegend();this.hInitWidgetMatrixes();this.updateRowValueBackground();this.updateColumnValueBackground();this.hUpdateLegend();this.hPlaceRHResizers(HTML5PROPS.MATRIX_LINE_V);this.hPlaceCHResizers(HTML5PROPS.MATRIX_LINE_H);this.hPlaceYResizers(HTML5PROPS.AXIS_LINE_Y);this.hPlaceXResizers(HTML5PROPS.AXIS_LINE_X);this.hPlaceOutBorders();this.outputLog4PartialRender();GMUTIL.endTimer();GMUTIL.startTimer({functionName:"WidgetMatrixManager.drawCharts",purpose:"Rendering of GraphMatrix ("+this.k+")"});this.manager.drawCharts();GMUTIL.endTimer();this.hPlaceRowResizers(HTML5PROPS.MATRIX_LINE_H);this.hPlaceColResizers(HTML5PROPS.MATRIX_LINE_V);this.hPlaceHGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);this.hPlaceVGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);this.hPlaceYSplitters(HTML5PROPS.MATRIX_LINE_V);this.hInitListeners();var me=this;setTimeout(function(){me.updateScrollBars();},0);}this.displayTrendLineErrorMessages();this.displayOtherNotificationMessage();this.initFlagForContextMenu=false;this.attachEventListener("highLightObjectChange",this.interactor.id,this.interactor.onHighLightObjectChange);var exp=this.getExp(),gtsModel=this.getRowsAndCols();$VISUTILS.modifyScExp(exp,gtsModel,this.model,this.normalizedIdCache);if(this._super){this._super();}setScrollDrawInterval.call(this);},updateScrollBars:function(){this.vSBar.updateScrollbars();this.hSBar.updateScrollbars();if(this.masterViewer){this.scrollNode=this.masterViewer.domContainer.firstChild;}},updateChartsPosition:function(dir,p){var node=this.scrollNode;if(!node){return ;}var x=node.xPos||0,y=node.yPos||0,nx=p,ny=p,maxX=node.offsetWidth-node.parentNode.offsetWidth,maxY=node.offsetHeight-node.parentNode.offsetHeight;ny=(ny<0)?0:ny;ny=(ny>maxY)?maxY:ny;nx=(nx<0)?0:nx;nx=(nx>maxX)?maxX:nx;if(dir==="v"){if(y===ny){return ;}y=node.yPos=ny;}else{if(x===nx){return ;}x=node.xPos=nx;}node.style[$DOM.CSS3_TRANSFORM]=$DOM.createTranslateString(-x,-y,0);this.onscroll();},onBrushing:function onBrushing(evt){if(evt.keys.indexOf(this.k)!==-1){var manager=this.manager,srcSelections=evt.from.getSelectionHash(),selections=[],charts,minRowIndex=-1,minColIndex=-1,gmCtr=this.GMController;$HASH.forEach(srcSelections,function(srcSelection){var attrs=this.GMController.checkAttributeIntersection(srcSelection,["Rows","Columns"]);$ARR.forEach(attrs,function(attr){var selection={};selection[attr]=srcSelection[attr];selections.push(selection);});},this);charts=manager.filterCharts(selections);$ARR.forEach(charts,function(chart){if(chart.byRow){minRowIndex=minRowIndex<0?chart.start:Math.min(minRowIndex,chart.start);}else{minColIndex=minColIndex<0?chart.start:Math.min(minColIndex,chart.start);}});if(minRowIndex>=0){this.updateChartsPosition("v",manager.master.getRowPosition(minRowIndex));}if(minColIndex>=0){this.updateChartsPosition("h",manager.master.getColPosition(minColIndex));}gmCtr.resetHighLightIndex=true;}if(this._super){this._super(evt);}},onscroll:function onscroll(){var x,y,me=this,manager=this.manager,HTML5PROPS=this.HTML5PROPS,scrollNode=this.scrollNode;if(!scrollNode){return ;}if(!this._timeout){this._timeout=window.setTimeout(function(){x=scrollNode.xPos;y=scrollNode.yPos;me.vSBar.updateScrollPosition(y);me.hSBar.updateScrollPosition(x);GMUTIL.startTimer({functionName:"VisGraphMatrix.onscroll.annonymous",purpose:"Rendering of GraphMatrix (after scrolling) ("+this.k+")"});me.outputLog4PartialRender();manager.drawCharts();me.updateSelections();GMUTIL.endTimer();delete me._timeout;},scrollDrawInterval);}x=scrollNode.xPos;y=scrollNode.yPos;manager.scrollTo(x,y);me.hPlaceRowResizers(HTML5PROPS.MATRIX_LINE_H);me.hPlaceColResizers(HTML5PROPS.MATRIX_LINE_V);me.hPlaceHGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);me.hPlaceVGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);me.interactor.updateSelectedBroders();},onmouseover:function(evt){if(!this.hasRendered||this.INVALID_TEMP||this.noData){return ;}var target=this.getRealTarget(evt),interactor=this.interactor,chtInfo=this.GMController.getChartInfo(),e=evt.e,me=this,vSBar=this.vSBar,hSBar=this.hSBar,domNode=this.domNode;$ARR.forEach([me.domGM,me.domRowHeader,me.domYAxis,me.domYAxis2],function(node){if($DOM.contains(node,target,true,domNode)){vSBar.toggleHoverState(true);return false;}});$ARR.forEach([me.domGM,me.domColHeader,me.domXAxis],function(node){if($DOM.contains(node,target,true,domNode)){hSBar.toggleHoverState(true);return false;}});var contextMenuDoms=interactor.domMenuPH.getElementsByClassName("mstrmojo-ui-Menu"),toolbarDom=interactor.domToolbarPH.firstChild;if(interactor.fmtMode&&mouseOverGapBetweenCMTB(e,contextMenuDoms,toolbarDom)){return ;}var offset=$VISUTILS.getMouseOffset(e);interactor.handleMouseOver(target,chtInfo,offset.x,offset.y);},onmouseout:function(evt){if(!this.hasRendered||this.INVALID_TEMP||this.noData){return ;}var domNode=this.domNode,toElement=evt.e.toElement||evt.e.relatedTarget,me=this;$ARR.forEach([me.domGM,me.domRowHeader,me.domYAxis,me.domYAxis2],function(node){if(!$DOM.contains(node,toElement,true,domNode)){me.vSBar.toggleHoverState(false);return false;}});$ARR.forEach([me.domGM,me.domColHeader,me.domXAxis],function(node){if(!$DOM.contains(node,toElement,true,domNode)){me.hSBar.toggleHoverState(false);return false;}});if(!$DOM.contains(domNode,toElement,true)){this.interactor.hideTooltip();this.interactor.clearHoveredTarget();this.interactor.clearHoveredSetShape();this.interactor.clearHoveredShape();this.interactor.clearSHTargets();}},oncontextmenu:function oncontextmenu(evt){delete this.noHighlightAfterKeepOnlyExcludeDrill;delete this.noReorderAfterShowData;if(!this.hasRendered||$VISUTILS.isOnExpressMode()){return ;}this.raiseEventOnNonFormattingIdentity([]);var docModel=this.getDocModel(),viUnit=docModel&&docModel.getSelectedViUnit(),titleBar=(viUnit instanceof mstrmojo.vi.ui.rw.VizBox)&&viUnit.titleBar;if(titleBar&&titleBar.onclick){titleBar.onclick();}var e=evt.e,target=this.getRealTarget(evt),pos={x:e.pageX+2,y:e.pageY+2},disabledUnits=this.GMController.disabledUnits,interactor=this.interactor,legend=this.legend,identity=target.identity||(target.parentNode&&target.parentNode.identity);this.mousePos={x:e.pageX+2,y:e.pageY+2};this.closePopup();if(legend&&$DOM.contains(legend.domNode,target,true)){interactor.handleRMCOnLegend(target,$HASH.clone(pos));if(identity&&identity.objType!==ID_TYPE.GRAPH_SHAPE){this.raiseEventOnFormattingIdentity([identity]);}}else{interactor.handleRMClick(target,disabledUnits,$HASH.clone(pos),e);}this.preClickType=CLICK_TYPE.RIGHT_CLICK;positionToolbarAndContextMenu.call(this,pos,this.interactor.domToolbarPH,this.interactor.domMenuPH);if(e!==null){$DOM.stopPropogation(e.hWin,e);$DOM.preventDefault(e.hWin,e);}},getRealTarget:function(evt){return evt.getTarget();},clearUserSelections:function(){if(this.isClearAllDisabled()){return false;}this.interactor.clearSelectRules();this.clearSelections(true);this.endSelections();return true;},resetSelectionEmptyFlag:function(){this.selectionEmptyFlag=$HASH.isEmpty(this.getSelectionHash());},endSelections:function(){if($HASH.isEmpty(this.getSelectionHash())){if(!this.selectionEmptyFlag){this.selectionEmptyFlag=true;this._super();}}else{this.selectionEmptyFlag=false;this._super();}},closePopup:function(){var interactor=this.interactor;if(interactor){interactor.hideToolbar();interactor.hideContextMenu();}if(this._super){this._super();}this._lastOpened=null;},onmousedown:function(evt){this.shouldNotTriggerClick=false;var vSBarNode=this.vSBar.domNode,hSBarNode=this.hSBar.domNode,target=evt.getTarget();if($DOM.contains(hSBarNode,target)||$DOM.contains(vSBarNode,target)){this.shouldNotTriggerClick=true;}},onclick:function(evt){delete this.noHighlightAfterKeepOnlyExcludeDrill;delete this.noReorderAfterShowData;if(this.shouldNotTriggerClick){this.shouldNotTriggerClick=false;return ;}if(this.noData||this.INVALID_TEMP){return ;}this.raiseEventOnNonFormattingIdentity([]);var me=this,interactor=this.interactor,target=this.getRealTarget(evt),hWin=evt.hWin,e=evt.e,ctrlKey=e.ctrlKey||e.metaKey,timeout=this._timeoutClick;this.mousePos={x:e.pageX+2,y:e.pageY+2};this.closePopup();if(this.enableDomDommy&&(target===this.domDummyA||target===this.domDummyB)){var menuCfg=this.GMController.getDebugMenu();this.showContextMenu(evt,menuCfg);return ;}this.hideContextMenu();if(this.formattingMode){if(timeout){$DOM.stopPropogation(hWin,e);window.clearTimeout(timeout);delete this._timeoutClick;interactor.handleDblClick(target,ctrlKey,e);this.preClickType=CLICK_TYPE.DOUBLE_CLICK;}else{this._timeoutClick=window.setTimeout(function(){interactor.handleClick(target,ctrlKey,e);delete me._timeoutClick;me.preClickType=CLICK_TYPE.LEFT_CLICK;},DOUBLE_CLICK_INTERVAL);}}else{if(timeout){window.clearTimeout(timeout);delete this._timeoutClick;}var type=target.getAttribute("type");if(type===CTRL_TYPE.LASSO_SELECTOR){var lassoSelector=this.manager.master.lassoSelector;var shape=getUnderlineTarget(lassoSelector,e);interactor.handleClick(shape,ctrlKey,e,lassoSelector);}else{if(type===CTRL_TYPE.LINE_CONTAINER){var underlineTarget=getUnderlineTarget(target,e);var shapeType=underlineTarget&&underlineTarget.getAttribute("type");if(shapeType===CTRL_TYPE.GM_SHAPE||shapeType===CTRL_TYPE.GM_MARKER){interactor.handleClick(underlineTarget,ctrlKey,e);}else{interactor.handleClick(target,ctrlKey,e);}}else{interactor.handleClick(target,ctrlKey,e);}}this.preClickType=CLICK_TYPE.LEFT_CLICK;}},onmousemove:function(evt){if(!this.hasRendered||this.INVALID_TEMP||this.noData){return ;}var shape,shapeType,e=evt.e,target=this.getRealTarget(evt),type=target.getAttribute("type"),chtInfo=this.GMController.getChartInfo(),interactor=this.interactor,toHideDom;var contextMenuDoms=interactor.domMenuPH.getElementsByClassName("mstrmojo-ui-Menu"),toolbarDom=interactor.domToolbarPH.firstChild;if(interactor.fmtMode&&mouseOverGapBetweenCMTB(e,contextMenuDoms,toolbarDom)){interactor.hideTooltip();return ;}var showTooltip=this.enableTooltip;if(!showTooltip){return ;}if(type===CTRL_TYPE.GM_SVG_CHART){interactor.hideTooltip();toHideDom=this.domGM.childNodes[0];toHideDom.style.zIndex="-2";shape=document.elementFromPoint(e.pageX,e.pageY);toHideDom.style.zIndex="auto";shapeType=shape.getAttribute("type");if(interactor.fmtMode&&(shapeType===CTRL_TYPE.LINE_CONTAINER||shapeType===CTRL_TYPE.GM_H_GRID_LINE||shapeType===CTRL_TYPE.GM_V_GRID_LINE||shapeType===CTRL_TYPE.GM_H_MINOR_GRID_LINE||shapeType===CTRL_TYPE.GM_V_MINOR_GRID_LINE)){interactor.handleMouseOver(shape);}else{interactor.handleMouseOver(target,chtInfo,$VISUTILS.getMouseOffset(e).x,$VISUTILS.getMouseOffset(e).y);}}else{if(type===CTRL_TYPE.LASSO_SELECTOR){var lassoSelector=this.manager.master.lassoSelector;shape=getUnderlineTarget(lassoSelector,e);shapeType=shape.getAttribute("type");if(shapeType===CTRL_TYPE.GM_SHAPE||shapeType===CTRL_TYPE.GM_MARKER){interactor.handleMouseOver(shape,chtInfo,$VISUTILS.getMouseOffset(e).x,$VISUTILS.getMouseOffset(e).y);interactor.showTooltip(shape,{x:e.pageX,y:e.pageY});}else{interactor.handleMouseOver(shape,chtInfo,$VISUTILS.getMouseOffset(e).x,$VISUTILS.getMouseOffset(e).y);interactor.hideTooltip();}}else{if(type===CTRL_TYPE.GM_SHAPE||type===CTRL_TYPE.GM_MARKER||type===CTRL_TYPE.GM_TREND_LINE||type===CTRL_TYPE.GM_REF_LINE){interactor.handleMouseOver(target,chtInfo,$VISUTILS.getMouseOffset(e).x,$VISUTILS.getMouseOffset(e).y);interactor.showTooltip(target,{x:e.pageX,y:e.pageY});}else{if(type===CTRL_TYPE.GM_SET_SHAPE){if(chtInfo.tp===CHART_TYPE.AREA&&chtInfo.shape===PRP_SHAPE.AREA){interactor.handleMouseOver(target,chtInfo,$VISUTILS.getMouseOffset(e).x,$VISUTILS.getMouseOffset(e).y);}else{interactor.hideTooltip();}}else{if(type===CTRL_TYPE.LINE_CONTAINER){var underlineTarget=getUnderlineTarget(target,e);shapeType=underlineTarget.getAttribute("type");if(shapeType===CTRL_TYPE.GM_SHAPE||shapeType===CTRL_TYPE.GM_MARKER){interactor.handleMouseOver(underlineTarget,chtInfo,$VISUTILS.getMouseOffset(e).x,$VISUTILS.getMouseOffset(e).y);interactor.showTooltip(underlineTarget,{x:e.pageX,y:e.pageY});}else{interactor.hideTooltip();}}else{interactor.hideTooltip();}}}}}},destroy:function(){var interactor=this.interactor;if(interactor){this.closePopup();}clearListeners.call(this);this.hResetLocalVars();this._super();if(this.GMController===mstrmojo.gm.GMLayout.API.owner){mstrmojo.gm.GMLayout.API={};}delete this.GMController;},unrender:function(){var interactor=this.interactor,me=this,lines=this.lines;if(interactor){interactor.hideTooltip();}clearListeners.call(this);var unRednerComp=function(comp){comp=typeof comp==="string"?me[comp]:comp;if(comp){comp.unrender();me.removeChildren(comp,true);}};["Row","Col"].forEach(function(axis){var headerAlias="slave"+axis+"Headers",headers=me[headerAlias];headers.forEach(unRednerComp);me[headerAlias]=[];});["slaveXAxis","slaveYAxis","slaveXAxis2","slaveYAxis2","masterViewer","legend"].forEach(function(prop){unRednerComp(prop);delete me[prop];});$ARR.forEach(Object.keys(lines),function(key){var lineObj=lines[key];if($ARR.isArray(lineObj)){lineObj.forEach(unRednerComp);lines[key]=[];}else{$ARR.forEach(Object.keys(lineObj),function(innerKey){var line=lineObj[innerKey];unRednerComp(line);delete lineObj[innerKey];});}});GMUTIL.handleDestroy(this,RESERVED_SCRIPT_CLAZZ);GMUTIL.handleDestroy(this.GMController,["mstrmojo.gm.GMDataModel"]);if(this.GMController){delete this.GMController.manager;}this._super();},hResetLocalVars:function(){this.sBarWidth=11;GMUTIL.destroyDisposable(this,this.manager);this.manager=undefined;GMUTIL.destroyDisposable(this,this.masterViewer);this.masterViewer=undefined;this.slaveRowHeaders=[];this.slaveColHeaders=[];this.slaveYAxis=undefined;this.slaveXAxis=undefined;this.slaveYAxis2=undefined;this.slaveXAxis2=undefined;this.yAxisFixed=false;this.yAxis2Fixed=false;this.xAxisFixed=false;this.xAxis2Fixed=false;this.lines={axes:{},borders:{},vlines:{},hlines:{},rows:[],cols:[],hMajorGridLines:[],hMinorGridLines:[],vMajorGridLines:[],vMinorGridLines:[],axisSplitters:{}};this.textHeightInX=XAXIS_TITLE_HEIGHT;this.textHeightInY=YAXIS_TITLE_HEIGHT;},hValidateInput:function(){var width=parseInt(this.width,10),height=parseInt(this.height,10);if(isNaN(width)||isNaN(height)){return false;}return true;},hInitHelpers:function(){var manager,interactor;manager=this.addDisposable(new mstrmojo.WidgetMatrixManager({GMController:this.GMController,widthScale:this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_WIDTH),heightScale:this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_HEIGHT)}));interactor=this.interactor;interactor.domWidget=this.domNode;interactor.clearAll();this.manager=this.GMController.manager=manager;this.interactor=interactor;},hPrepareDataAndCE:function(){var GMC=this.GMController,hasColorBy=GMC.hasColorBy(),hasSizeBy=GMC.hasSizeBy();this.needLegend=hasColorBy||hasSizeBy;this.colorByData=hasColorBy?GMC.getColorByLegendInfo():null;this.sizeByData=hasSizeBy?GMC.getSizeByLegendInfo():null;this.needLegend=!!this.colorByData||!!this.sizeByData;GMC.setupAxisCondense();GMC.setupAxisLayout();},hDecideDataLabelRotation:function(){var GMC=this.GMController;GMC.decideDataLabelRotation();},hCalcRadiusAndMargin:function(calcMargin){var GMC=this.GMController;GMC.calculateRadius();if(calcMargin){GMC.initYAxisMargins();GMC.initXAxisMargins();}},hInitLegend:function(){if(!this.needLegend){return ;}var combObj=this.isShapeCombonation(),shape;if(combObj.shapeType===undefined){shape=this.getChartInfo().shape;}else{shape=combObj.shapeType;}if(shape===PRP_SHAPE.LINE&&this.GMController.isOneDotCase()){shape=PRP_SHAPE.CIRCLE;}GMUTIL.destroyDisposable(this,this.legend);var HTML5PROPS=this.HTML5PROPS,legend=new $GM.GMLegend({widget:this,shapeType:shape,placeholder:this.domLegend,currDockedPositionIdx:this.getLegendDockPosIdx(this.getWidgetPropertyValue(ENUM_XML_TAG.LEGEND_POSITION)),cutBy:this.legendCutBy,styles:HTML5PROPS.LEGEND,model:this.model});legend.render();legend.parent=this;this.legend=this.addDisposable(legend);this.domLegend=legend.domNode;},hUpdateLegend:function(){var legend=this.legend;if(legend){legend.cutBy=this.legendCutBy;legend.minHeight=this.legendMinHeight;legend.updateContainerSize(this.getWidth(),this.actualHeight);legend.feedData([{dataType:LEGEND_DATA_TYPE.COLOR_BY,dataObj:this.colorByData},{dataType:LEGEND_DATA_TYPE.SIZE_BY,dataObj:this.sizeByData}],this.getWidgetPropertyValue(ENUM_XML_TAG.LEGEND_MODE)===PRP_LEGEND_MODE.MINIMIZED);}},hInitListeners:function(){var me=this,id=this.id,legend=this.legend,manager=this.manager,GMC=this.GMController,lines=this.lines,domAxes=lines.axes,domHLines=lines.hlines,domVLines=lines.vlines,bottomLine=lines.borders&&lines.borders.bottom,rightLine=lines.borders&&lines.borders.right;this.chartResizeListener=manager.attachEventListener("MiniChartResized",id,function(evt){var chartWidthScale=evt.chartWidthScale,chartHeightScale=evt.chartHeightScale;if(chartWidthScale){GMC.initXAxisMargins();this.writeGlobalProperty(ENUM_XML_TAG.SCALE_CHART_WIDTH,chartWidthScale);}if(chartHeightScale){GMC.initYAxisMargins();this.writeGlobalProperty(ENUM_XML_TAG.SCALE_CHART_HEIGHT,chartHeightScale);}});this.updateSelectionsListener=manager.attachEventListener("UpdateSelections",id,function(){me.updateSelections();});$HASH.keyarray(domAxes).forEach(function(axis){me.splitterListeners.push(domAxes[axis].attachEventListener("splitterMoved",id,function(evt){me.onSplitterMoved(evt.position,evt.info);}));});$HASH.keyarray(domVLines).forEach(function(line){me.splitterListeners.push(domVLines[line].attachEventListener("splitterMoved",id,function(evt){me.onSplitterMoved(evt.position,evt.info);}));});$HASH.keyarray(domHLines).forEach(function(line){me.splitterListeners.push(domHLines[line].attachEventListener("splitterMoved",id,function(evt){me.onSplitterMoved(evt.position,evt.info);}));});if(bottomLine){this.splitterListeners.push(bottomLine.attachEventListener("splitterMoved",id,function(evt){me.onSplitterMoved(evt.position,evt.info);}));}if(rightLine){this.splitterListeners.push(rightLine.attachEventListener("splitterMoved",id,function(evt){me.onSplitterMoved(evt.position,evt.info);}));}if(legend){this.legendResizeListener=legend.attachEventListener("gm-legend-resized",id,function(evt){me.onLegendResized(evt.position);});this.legendClickListener=legend.attachEventListener("gm-legend-clicked",id,function(evt){me.onLegendClicked(evt);});}var wheelObjs=[{node:me.domRowHeader,dirc:"v"},{node:me.domColHeader,dirc:"h"},{node:me.domGM,dirc:"both"},{node:me.domYAxis,dirc:"v"},{node:me.domYAxis2,dirc:"v"},{node:me.domXAxis,dirc:"h"}];$ARR.forEach(wheelObjs,function(obj){if(obj.node){$VISUTILS.addWheelListener(obj.node,onWheelCallBack.bind(me,obj.dirc));}});if(me.domMainContainer){$VISUTILS.addWheelListener(me.domMainContainer,onWheelCallBackForMainNode.bind(me));}},hLayoutLegend:function(slot){var isRight=this.legendIsRight(slot),domContainer=this.domMainContainer;if(isRight){domContainer.style.left="0px";}else{domContainer.style.left=this.legendW+this.legendP+VLINE_THICKNESS+"px";}},hEvalSize4Headers:function(){var GMC=this.GMController,HTML5PROPS=this.HTML5PROPS,rhLabelArrs=GMC.getRowHeadersToCalcWidth(),chLabelArrs=GMC.getColHeadersToCalcWidth(),rhInfo=GMC.getRowTitleInfo(),chInfo=GMC.getColTitleInfo(),yAxisInfo=GMC.getYAxisInfo(undefined,undefined,GMC.haveY1),layouter=this.layouter,showRHTitle=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_HEADER_SHOW),showRHValue=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VALUES_SHOW),showCHTitle=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_HEADER_SHOW),showCHValue=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VALUES_SHOW),showYAxisTitle=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.Y_AXIS_TITLE_SHOW),scaleSizeArray=function(sizeArr,scaleArr){var i,n=sizeArr.length;for(i=0;i<n;i++){sizeArr[i]*=(scaleArr[i]||1);}},makeZeroArray=function(sizeArr,n){var i;sizeArr.length=n;for(i=0;i<n;i++){sizeArr[i]=0;}},hasExtraColHeader=function(){var hasRT=rhLabelArrs.length>0,showRT=showRHTitle,hasYAAT=yAxisInfo.items.length>0&&!yAxisInfo.isMetric,showYAT=showYAxisTitle,hasFA=GMC.hasFooterInX&&GMC.isFooterAbove,showFA=showCHValue;var hasAndShowRT=hasRT&&showRT,hasAndShowYAAT=hasYAAT&&showYAT,hasAndShowFA=hasFA&&showFA;return{hasAndShowRT:hasAndShowRT,hasAndShowYAAT:hasAndShowYAAT,hasAndShowFA:hasAndShowFA};};this.rowHeaderWArr=layouter.getRowHeadersWidth(rhLabelArrs,HTML5PROPS.RH);this.colHeaderHArr=layouter.getColHeadersHeight(chLabelArrs,HTML5PROPS.CH);this.rowHeaderExtraW=layouter.getRowHeaderP1Width(rhLabelArrs.length,chLabelArrs.length,chInfo,this.colHeaderHArr,HTML5PROPS.CH_TITLE,showCHTitle,GMC);if(GMC.isGridPie&&rhLabelArrs.length===0&&yAxisInfo.items.length===0&&GMC.isMetricNamesOnColumns){yAxisInfo.items.push("Metric Names");}var maxLineCount=GMC.getAttributesOnDropZone("Columns").length>0?2:3;this.rowHeaderMaxHeightWithoutX2=layouter.getColHeaderP1Height(rhInfo,this.rowHeaderWArr,yAxisInfo,HTML5PROPS,hasExtraColHeader(),maxLineCount);this.colHeaderExtraH=this.rowHeaderMaxHeightWithoutX2;if(this.rowHeaderExtraW===0){this.removeWidgetProperty(ENUM_XML_TAG.SCALE_V_EXTRA_LINE);}else{var k=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_V_EXTRA_LINE);this.rowHeaderExtraW*=k;}scaleSizeArray(this.rowHeaderWArr,this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_ROW_HEADERS));scaleSizeArray(this.colHeaderHArr,this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_COL_HEADERS));if(!showRHTitle&&!showRHValue){makeZeroArray(this.rowHeaderWArr,rhLabelArrs.length);}if(!showCHTitle&&!showCHValue){makeZeroArray(this.colHeaderHArr,chLabelArrs.length);}},hEvalSize4Legend:function(){var rtn,cData=this.colorByData,sData=this.sizeByData,width=this.getWidth(),height=this.getHeight(),legendStyle=this.HTML5PROPS.LEGEND,scale;if(!this.needLegend||this.getWidgetPropertyValue(ENUM_XML_TAG.LEGEND_VISIBLE)===false){this.legendW=this.legendH=this.legendP=0;}else{$LEGEND.applyHTML5Props(legendStyle);this.legendP=LEGEND_PADDING;scale=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_LEGEND_WIDTH);if(scale==="undefined"||this.legendScale!==scale){this.legendScale=scale;this.legendResized=true;this.legendFixedW=undefined;delete this.legendFixedW;}rtn=$LEGEND.getLegendSize([{dataType:LEGEND_DATA_TYPE.COLOR_BY,dataObj:cData},{dataType:LEGEND_DATA_TYPE.SIZE_BY,dataObj:sData}],this.legendResized?this.legendScale:undefined,width,height,legendStyle,this.legendFixedW);this.legendCutBy=rtn.cutBy;this.legendMinHeight=rtn.minHeight;this.legendFixedW=rtn.width;if(rtn.scale){this.legendScale=rtn.scale;}if(this.getWidgetPropertyValue(ENUM_XML_TAG.LEGEND_MODE)===PRP_LEGEND_MODE.MINIMIZED||rtn.autoCollapse){rtn=$LEGEND.getLegendSize4MinMode(cData,height);this.legendCutBy=undefined;}this.legendW=rtn.width;this.legendH=rtn.height;}},legendIsRight:function(slot){slot=slot||this.getWidgetPropertyValue(ENUM_XML_TAG.LEGEND_POSITION);return slot===PRP_LEGEND_SLOT.RIGHT_MIDDLE||slot===PRP_LEGEND_SLOT.RIGHT_TOP||slot===PRP_LEGEND_SLOT.RIGHT_BOTTOM;},hEvalSize4GMArea:function(){var rhWidth,GMC=this.GMController,isXDualAxis=GMC.isXDualAxis,isYDualAxis=GMC.isYDualAxis,manager=this.manager,layouter=this.layouter,GMInfo=this.GMInfo,xAxisHeight=this.xAxisFixed?GMInfo.xAxisHeight:undefined,yAxisWidth=this.yAxisFixed?GMInfo.yAxisWidth:undefined,yAxis2Width=this.yAxis2Fixed?GMInfo.yAxis2Width:undefined,xAxis2Height=this.xAxis2Fixed?GMInfo.xAxis2Height:undefined,width=this.getWidth(),height=this.getHeight(),wArr=this.rowHeaderWArr,hArr=this.colHeaderHArr,isRight=this.legendIsRight(),scales=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_ALL),showYAxisTitle=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.Y_AXIS_TITLE_SHOW);if(this.legendW>0){width-=this.legendW+this.legendP+VLINE_THICKNESS;}this.actualWidth=width;this.actualHeight=height;this.rowHeaderW=$DC.sum(wArr,VLINE_THICKNESS);this.colHeaderH=$DC.sum(hArr,HLINE_THICKNESS);rhWidth=$DC.add(0,this.rowHeaderW,VLINE_THICKNESS);rhWidth=$DC.add(rhWidth,this.rowHeaderExtraW,VLINE_THICKNESS);width-=rhWidth;height-=$DC.add(0,this.colHeaderH,HLINE_THICKNESS);GMC.initLayouter(layouter);GMInfo=layouter.calculateLayout(rhWidth,width,height,xAxisHeight,xAxis2Height,yAxisWidth,yAxis2Width,scales,{h:0,v:0,ha:HALINE_THICKNESS,va:VALINE_THICKNESS,ob:0,dx:isXDualAxis,dy:isYDualAxis,rb:(isRight&&this.legendW>0),styles:this.HTML5PROPS.RH_TITLE,syat:showYAxisTitle,rhMaxH:this.rowHeaderMaxHeight});if(GMInfo.widthCacheChanged){manager.feedChartWidthInfo(GMC.widthCache);manager.updateHSlaves();GMC.initXAxisMargins();}if(GMInfo.heightCacheChanged){manager.feedChartHeightInfo(GMC.heightCache);manager.updateVSlaves();GMC.initYAxisMargins();}this.colHeaderExtraH=GMInfo.xAxis2Height;height-=$DC.add(0,this.colHeaderExtraH,GMC.haveX2?HALINE_THICKNESS:HLINE_THICKNESS);height-=$DC.add(0,GMInfo.xAxisHeight,HALINE_THICKNESS);width-=$DC.add(0,GMInfo.yAxisWidth,VALINE_THICKNESS);width-=$DC.add(0,GMInfo.yAxis2Width,VALINE_THICKNESS);this.GMW=(GMInfo.pageWidth)||width;this.GMH=(GMInfo.pageHeight)||height;this.actualWidth-=width-this.GMW;this.actualHeight-=height-this.GMH;this.GMInfo=GMInfo;this.autoSetPRFlag();},autoSetPRFlag:function(){var GMC=this.GMController;if(GMC.isBubbleOrScatter()){GMC.enablePartialRendering=true;return ;}var aspectRatioThreshold=1.2;var chartCount=GMC.getChartCountInCol()*GMC.getChartCountInRow();if(chartCount<=1){var biggerThanViewPort=(this.GMInfo.avgChartWidth/this.GMW>=aspectRatioThreshold)||(this.GMInfo.avgChartHeight/this.GMH>=aspectRatioThreshold);if(biggerThanViewPort){GMC.enablePartialRendering=GMC.getGraphShapeCount()>10000;}}else{aspectRatioThreshold=2;if((this.GMInfo.avgChartWidth/this.GMW>=aspectRatioThreshold)||(this.GMInfo.avgChartHeight/this.GMH>=aspectRatioThreshold)){GMC.enablePartialRendering=true;}}},initGMScroll:function(){var vSbar,hSbar;GMUTIL.destroyDisposable(this,this.vSBar);vSbar=new $GM.GMScroll({view:this,placeholder:this.domVSBar,cssClass:"gm-vsbar",bodyClass:"gm-vsbar-body",direction:"v"});vSbar.render();vSbar.addScrollListener();this.vSBar=this.addDisposable(vSbar);GMUTIL.destroyDisposable(this,this.hSBar);hSbar=new $GM.GMScroll({view:this,placeholder:this.domHSBar,cssClass:"gm-hsbar",bodyClass:"gm-hsbar-body",direction:"h"});hSbar.render();hSbar.addScrollListener();this.hSBar=this.addDisposable(hSbar);},hLayoutControls:function(){var GMC=this.GMController,GMInfo=this.GMInfo,yWidth=GMInfo.yAxisWidth,y2Width=GMInfo.yAxis2Width,xHeight=GMInfo.xAxisHeight,rhWidth=this.rowHeaderW,rhWidthPlus=$DC.sum([rhWidth,this.rowHeaderExtraW],VLINE_THICKNESS),rhWidthAll=$DC.sum([rhWidthPlus,yWidth],VLINE_THICKNESS),chHeight=this.colHeaderH,chHeightPlus=$DC.sum([chHeight,this.colHeaderExtraH],HLINE_THICKNESS),offsetX=rhWidthAll+(GMC.haveY1?VALINE_THICKNESS:VLINE_THICKNESS),offsetY=chHeightPlus+(GMC.haveX2?HALINE_THICKNESS:HLINE_THICKNESS),offsetX2=offsetX+this.GMW+(GMC.haveY2?VALINE_THICKNESS:0),offsetY2=offsetY+this.GMH+(GMC.haveX1?HALINE_THICKNESS:0),legendStyle=this.HTML5PROPS.LEGEND;this.offsetX=offsetX;this.offsetY=offsetY;this.offsetX2=offsetX2;this.offsetY2=offsetY2;styleDomNode(this.domLegend,{width:this.legendW,height:this.legendH});$VISUTILS.applyStyle2Legend(legendStyle,this.domLegend);styleDomNode(this.domMainContainer,{width:this.actualWidth,height:this.actualHeight});styleDomNode(this.domTabHeader,{width:rhWidthAll,height:chHeightPlus});styleDomNode(this.domColHeader,{width:this.GMW,height:chHeightPlus,left:offsetX});styleDomNode(this.domRowHeader,{width:rhWidthPlus,height:this.GMH,top:offsetY});styleDomNode(this.domYAxis,{width:yWidth,height:this.GMH,left:(rhWidthPlus===0)?0:(rhWidthPlus+VLINE_THICKNESS),top:offsetY});styleDomNode(this.domGM,{width:this.GMW,height:this.GMH,left:offsetX,top:offsetY});styleDomNode(this.domYAxis2,{width:y2Width,height:this.GMH,left:offsetX2,top:offsetY});styleDomNode(this.domXAxis,{width:this.GMW,height:xHeight,left:offsetX,top:offsetY2});styleDomNode(this.domDummyA,{width:rhWidthPlus,height:xHeight,top:offsetY2});styleDomNode(this.domDummyB,{width:yWidth,height:xHeight,left:rhWidthPlus+VLINE_THICKNESS,top:offsetY2});this.hLayoutLegend();this.hLayoutScrollBars(offsetX,offsetY,offsetX2,offsetY2,xHeight,y2Width);},hLayoutScrollBars:function(offsetX,offsetY,offsetX2,offsetY2,xHeight,y2Width){var GMInfo=this.GMInfo,vSBar=this.vSBar,hSBar=this.hSBar;styleDomNode(vSBar.domNode,{height:this.GMH,width:this.sBarWidth,top:offsetY,left:offsetX2+y2Width-this.sBarWidth});styleDomNode(vSBar.domBody,{height:GMInfo.canvasHeight});styleDomNode(hSBar.domNode,{width:this.GMW,height:this.sBarWidth,left:offsetX,top:offsetY2+xHeight-this.sBarWidth});styleDomNode(hSBar.domBody,{width:GMInfo.canvasWidth});},hGetRowTitleHeight:function(){var n=this.colHeaderHArr.length;if(this.colHeaderExtraH>0){return this.colHeaderExtraH;}return this.colHeaderHArr[n-1];},hGetColTitleWidth:function(){var n=this.rowHeaderWArr.length,GMInfo=this.GMInfo;if(this.rowHeaderExtraW>0){return this.rowHeaderExtraW;}if(GMInfo.yAxisWidth>0){return GMInfo.yAxisWidth;}return this.rowHeaderWArr[n-1];},getCellForNode:function getCellForNode(cell){return cell.identity;},getCellUnitIndex:function getCellUnitIndex(cell){return(cell.o!==undefined)?cell.o:cell._ei;},hFillContents:function(){var me=this,GMInfo=this.GMInfo,HTML5PROPS=this.HTML5PROPS,GMC=this.GMController,showRHTitle=me.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_HEADER_SHOW),showCHTitle=me.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_HEADER_SHOW),processTableHeader=function(){var i,div,div1,rowTitleH,colTitleW,table=me.domTabHeader,m=me.rowHeaderWArr.length,n=me.colHeaderHArr.length,hasExtra=me.rowHeaderExtraW>0||me.colHeaderExtraH>0,gmController=me.GMController,leftPos=0,topPos=0,rhInfo=GMC.getRowTitleInfo(true),chInfo=GMC.getColTitleInfo(true),yAxisInfo=GMC.getYAxisInfo(),wgt,labelContents=[],labelInfo;me.rowTitleH=rowTitleH=me.hGetRowTitleHeight();me.colTitleW=colTitleW=me.hGetColTitleWidth();table.innerHTML="";for(i=0;i<m;i++){labelContents=[];div=document.createElement("div");div.setAttribute("class","gm-rowheader-title");styleDomNode(div,{width:me.rowHeaderWArr[i],height:rowTitleH,left:leftPos},true);div.setAttribute("type",CTRL_TYPE.GM_ROW_HEADER_TITLE);div.setAttribute("depth",String(i));$VISUTILS.applyStyles2DomNode(div,HTML5PROPS.RH_BK);table.appendChild(div);div.identity=new $GM.TitleCellIdentity(rhInfo.items[i]);if(showRHTitle&&rhInfo.items[i].n){labelInfo={text:rhInfo.items[i].n,extraAttributes:{type:CTRL_TYPE.GM_ROW_HEADER_TITLE}};labelContents.push(labelInfo);wgt=new mstrmojo.gm.TitleLabelCapsule({width:me.rowHeaderWArr[i],height:rowTitleH,cssClass:"gm-rowheader-title",styles:HTML5PROPS.RH_TITLE,labelObj:labelContents[0],maxLineCount:GMC.getAttributesOnDropZone("Columns").length>0?2:3});wgt.render();wgt.parent=me;me.addDisposable(wgt);div1=wgt.domNode;$VISUTILS.applyStyles2DomNode(div1,HTML5PROPS.RH_BK);if(div1.firstChild&&div1.firstChild.firstChild){$VISUTILS.applyStyles2DomNode(div1.firstChild.firstChild,HTML5PROPS.RH_TITLE);}div1.identity=new $GM.TitleCellIdentity(rhInfo.items[i]);div.appendChild(div1);}leftPos+=me.rowHeaderWArr[i]+VLINE_THICKNESS;}for(i=0;i<n;i++){labelContents=[];div=document.createElement("div");div.setAttribute("class","gm-colheader-title");styleDomNode(div,{width:colTitleW,height:me.colHeaderHArr[i],top:topPos,right:0},true);div.setAttribute("type",CTRL_TYPE.GM_COL_HEADER_TITLE);div.setAttribute("depth",String(i));$VISUTILS.applyStyles2DomNode(div,HTML5PROPS.CH_BK);table.appendChild(div);div.identity=new $GM.TitleCellIdentity(chInfo.items[i]);if(showCHTitle&&chInfo.items[i].n){labelInfo={text:chInfo.items[i].n,extraAttributes:{type:CTRL_TYPE.GM_COL_HEADER_TITLE}};labelContents.push(labelInfo);wgt=new mstrmojo.gm.TitleLabelCapsule({width:colTitleW,height:me.colHeaderHArr[i],cssClass:"gm-colheader-title",styles:HTML5PROPS.CH_TITLE,labelObj:labelContents[0],maxLineCount:GMC.getAttributesOnDropZone("Rows").length>0?2:3});wgt.render();wgt.parent=me;me.addDisposable(wgt);div1=wgt.domNode;$VISUTILS.applyStyles2DomNode(div1,HTML5PROPS.CH_BK);if(div1.firstChild&&div1.firstChild.firstChild){$VISUTILS.applyStyles2DomNode(div1.firstChild.firstChild,HTML5PROPS.CH_TITLE);}div1.identity=new $GM.TitleCellIdentity(chInfo.items[i]);div.appendChild(div1);}topPos+=me.colHeaderHArr[i]+HLINE_THICKNESS;}var showYAxisTitle=me.getWidgetPropertyValue(ENUM_FORMAT_TAG.Y_AXIS_TITLE_SHOW);if(showYAxisTitle===undefined){showYAxisTitle=me.getWidgetPropertyDefaultValue(ENUM_FORMAT_TAG.Y_AXIS_TITLE_SHOW,{isMetric:gmController.yIsNumeric});}if(hasExtra&&GMInfo.yAxisWidth>0&&showYAxisTitle&&yAxisInfo.isMetric===false&&yAxisInfo.items.length>0){labelContents=[];if(yAxisInfo.isMetric===false&&yAxisInfo.items.length>0){$ARR.forEach(yAxisInfo.items,function(yItem,index){labelInfo={text:yItem,extraAttributes:{type:CTRL_TYPE.GM_YLABEL,dzId:$DZ_ID.YAxis,dzIndex:index,identity:new $GM.AttributeAxisTitleIdentity({n:yItem,tid:yAxisInfo.ids[index],objType:ID_TYPE.Y_ATTRIBUTE_AXIS_TITLE})}};labelContents.push(labelInfo);});}wgt=new mstrmojo.VisAxisLabel({width:colTitleW+"px",height:Math.min(rowTitleH,me.textHeightInY)+"px",cssClass:"gm-yaxis-cell-label",styles:gmController.yTitleStyles,align:"center",contentData:labelContents});wgt.render();wgt.parent=me;me.addDisposable(wgt);wgt.domNode.style.bottom=Math.max((rowTitleH-me.textHeightInY)/2,0)+"px";wgt.domNode.style.right=Math.max((colTitleW-wgt.contentWidth)/2,0)+"px";table.appendChild(wgt.domNode);me.extraTitleDiv=wgt.domNode;}else{me.extraTitleDiv=undefined;}},processRowHeader=function processRowHeader(){var i,div,leftPos=0,children=me.domRowHeader.childNodes;for(i=0;i<me.rowHeaderWArr.length;i++){if(children[i]){div=children[i];}else{div=document.createElement("div");me.domRowHeader.appendChild(div);}div.setAttribute("class","gm-rowheader-lv2");styleDomNode(div,{width:me.rowHeaderWArr[i],height:me.GMH,left:leftPos,"z-index":me.rowHeaderWArr.length-1-i});leftPos+=me.rowHeaderWArr[i]+VLINE_THICKNESS;if(me.slaveRowHeaders[i]){me.slaveRowHeaders[i].resizeAbs(me.rowHeaderWArr[i],me.GMH);}}},processColHeader=function processColHeader(){var i,div,topPos=0,children=me.domColHeader.childNodes;for(i=0;i<me.colHeaderHArr.length;i++){if(children[i]){div=children[i];}else{div=document.createElement("div");me.domColHeader.appendChild(div);}div.setAttribute("class","gm-colheader-lv2");styleDomNode(div,{width:me.GMW,height:me.colHeaderHArr[i],top:topPos,"z-index":me.colHeaderHArr.length-1-i});topPos+=me.colHeaderHArr[i]+HLINE_THICKNESS;if(me.slaveColHeaders[i]){me.slaveColHeaders[i].resizeAbs(me.GMW,me.colHeaderHArr[i]);}}if(me.colHeaderExtraH>0){if(children[i]){div=children[i];}else{div=document.createElement("div");me.domColHeader.appendChild(div);}me.domXAxis2=div;div.setAttribute("class","gm-colheader-lv2");styleDomNode(div,{width:me.GMW,height:me.colHeaderExtraH,top:topPos});if(me.slaveColHeaders[i]){me.slaveColHeaders[i].resizeAbs(me.GMW,me.colHeaderExtraH);}}else{me.domXAxis2=null;}},processYAxis=function(){var div,children=me.domYAxis.childNodes;if(children[0]){div=children[0];}else{div=document.createElement("div");me.domYAxis.appendChild(div);}styleDomNode(div,{position:"absolute",width:GMInfo.yAxisWidth,height:me.GMH});if(me.slaveYAxis){me.slaveYAxis.resizeAbs(GMInfo.yAxisWidth,me.GMH);}},processYAxis2=function(){var div,children=me.domYAxis2.childNodes;if(children[0]){div=children[0];}else{div=document.createElement("div");me.domYAxis2.appendChild(div);}styleDomNode(div,{position:"absolute",width:GMInfo.yAxis2Width,height:me.GMH});if(me.slaveYAxis2){me.slaveYAxis2.resizeAbs(GMInfo.yAxis2Width,me.GMH);}},processXAxis=function(){var div,children=me.domXAxis.childNodes;if(children[0]){div=children[0];}else{div=document.createElement("div");me.domXAxis.appendChild(div);}styleDomNode(div,{position:"absolute",width:me.GMW,height:GMInfo.xAxisHeight});if(me.slaveXAxis){me.slaveXAxis.resizeAbs(me.GMW,GMInfo.xAxisHeight);}},processGM=function(){var div,master=me.masterViewer,children=me.domGM.childNodes;if(children[0]){div=children[0];}else{div=document.createElement("div");me.domGM.appendChild(div);}styleDomNode(div,{position:"absolute",width:me.GMW,height:me.GMH});if(master){master.resizeAbs(me.GMW,me.GMH);}},processLegend=function(){var legend=me.legend;if(legend){legend.width=me.legendW;legend.height=me.legendH;}};processTableHeader();processRowHeader();processColHeader();processYAxis();processYAxis2();processXAxis();processGM();processLegend();},hPlaceOutBorders:function(legendSlot){var div,line,width=this.actualWidth,height=this.actualHeight,doc=document,domNode=this.domMainContainer,domBorders=this.lines.borders,propOutBorder=this.getWidgetPropertyValue(ENUM_XML_TAG.OUTSIDE_BORDER),vStyles=this.HTML5PROPS.MATRIX_LINE_V,hStyles=this.HTML5PROPS.MATRIX_LINE_H,rightBorderWidth=parseInt(vStyles.borderWidth,10)||0,fitTo=this.getWidgetPropertyValue(ENUM_XML_TAG.FIT_TO),isRight=this.legendIsRight(legendSlot),containerWidth=this.getWidth(),containerHeight=this.getHeight(),legendWidth=this.legendW,gapThreshold=1;if(!propOutBorder){line=domBorders.left;if(line){line.hide();}line=domBorders.right;if(line){line.hide();}line=domBorders.top;if(line){line.hide();}line=domBorders.bottom;if(line){line.hide();}return ;}line=domBorders.left;if(legendWidth>0&&!isRight){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_MATRIX_LINE,identity:{objType:ID_TYPE.V_MATRIX_LINE},styles:vStyles,dir:"v",parent:this,draggable:false});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);domBorders.left=line;}line.updatePosition({left:0,height:height});}else{if(line){line.hide();}}line=domBorders.right;if((legendWidth<=0&&((containerWidth-width)>gapThreshold))||(legendWidth>0&&(isRight||((containerWidth-width-legendWidth-this.legendP)>gapThreshold)))){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_MATRIX_LINE,identity:{objType:ID_TYPE.V_MATRIX_LINE},styles:vStyles,dir:"v",parent:this,context:{dock:DOCK_POS.RIGHT,type:CTRL_TYPE.GM_RIGHT_BORDER},draggable:fitTo===FIT_TO.CONTENT});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);domBorders.right=line;}line.updatePosition({left:width,height:height});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_RIGHT_BORDER));}else{if(line){line.hide();}}line=domBorders.bottom;if((containerHeight-height)>gapThreshold){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_H_MATRIX_LINE,identity:{objType:ID_TYPE.H_MATRIX_LINE},styles:hStyles,dir:"h",parent:this,context:{dock:DOCK_POS.BOTTOM,type:CTRL_TYPE.GM_BOTTOM_BORDER},draggable:fitTo===FIT_TO.CONTENT});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);domBorders.bottom=line;}line.updatePosition({top:height,width:width+rightBorderWidth});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_BOTTOM_BORDER));}else{if(line){line.hide();}}},hPlaceYResizers:function(styles){var div,line,info=this.GMInfo,y1Width=info.yAxisWidth,y2Width=info.yAxis2Width,height=this.actualHeight,doc=document,domNode=this.domMainContainer,domAxes=this.lines.axes,showY=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.Y_AXIS_LINE_SHOW);if(!showY){line=domAxes.y1;if(line){line.domNode.style.display="none";}line=domAxes.y2;if(line){line.domNode.style.display="none";}return ;}line=domAxes.y1;if(y1Width>0){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,cssClass:"gm-axis-line",type:CTRL_TYPE.GM_YAXIS_LINE,identity:{objType:ID_TYPE.Y_AXIS},styles:styles,dir:"v",context:{dock:DOCK_POS.RIGHT,type:CTRL_TYPE.GM_YAXIS},parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);domAxes.y1=line;}line.updatePosition({left:this.offsetX-VALINE_THICKNESS,height:height-info.xAxisHeight});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_YAXIS));}else{if(line){line.hide();}}line=domAxes.y2;if(y2Width>0){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,cssClass:"gm-axis-line",type:CTRL_TYPE.GM_YAXIS2_LINE,identity:{objType:ID_TYPE.Y2_AXIS},styles:styles,dir:"v",context:{dock:DOCK_POS.LEFT,type:CTRL_TYPE.GM_YAXIS2},parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);domAxes.y2=line;}line.updatePosition({left:this.offsetX2-VALINE_THICKNESS,height:height-info.xAxisHeight});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_YAXIS2));}else{if(line){line.hide();}}},hPlaceXResizers:function(styles){var div,line,GMC=this.GMController,info=this.GMInfo,x1Height=info.xAxisHeight,x2Height=info.xAxis2Height,width=this.actualWidth,doc=document,domNode=this.domMainContainer,domAxes=this.lines.axes,showX=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.X_AXIS_LINE_SHOW);if(!showX){line=domAxes.x1;if(line){line.domNode.style.display="none";}line=domAxes.x2;if(line){line.domNode.style.display="none";}return ;}line=domAxes.x1;if(x1Height>0){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,cssClass:"gm-axis-line",type:CTRL_TYPE.GM_XAXIS_LINE,identity:{objType:ID_TYPE.X_AXIS},styles:styles,dir:"h",context:{dock:DOCK_POS.TOP,type:CTRL_TYPE.GM_XAXIS},parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);domAxes.x1=line;}line.updatePosition({top:this.offsetY2-HALINE_THICKNESS,width:this.rowHeaderW?width:width-info.yAxis2Width-info.yAxisWidth,left:this.rowHeaderW?0:info.yAxisWidth});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_XAXIS));}else{if(line){line.hide();}}line=domAxes.x2;if(x2Height>0&&GMC.haveX2){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,cssClass:"gm-axis-line",type:CTRL_TYPE.GM_XAXIS2_LINE,identity:{objType:ID_TYPE.X2_AXIS},styles:styles,dir:"h",context:{dock:DOCK_POS.BOTTOM,type:CTRL_TYPE.GM_XAXIS2},parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);domAxes.x2=line;}line.updatePosition({top:this.offsetY-HALINE_THICKNESS,width:this.rowHeaderW?width:width-info.yAxis2Width-info.yAxisWidth,left:this.rowHeaderW?0:info.yAxisWidth});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_XAXIS2));}else{if(line){line.hide();}}},hPlaceColResizers:function(styles){var showThem=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.V_MATRIX_LINES_SHOW),lines=this.lines.cols;if(!showThem){lines.forEach(function(line){if(line){line.hide();}});return ;}var i,div,line,top,left,startDepth,doc=document,fragment=doc.createDocumentFragment(),manager=this.manager,GMC=this.GMController,x2Empty=!(GMC.haveX2||GMC.isFooterAbove),x2Height=this.GMInfo.xAxis2Height,nCols=this.GMInfo.nCols,index=manager.intersectCheck4Col(this.GMW),colStart=index.start,colEnd=index.end,height=this.actualHeight,domNode=this.domMainContainer,leftOffset=this.offsetX,hArr=this.colHeaderHArr,hArrLen=hArr.length;height=$DC.minus(height,this.GMInfo.xAxisHeight,HALINE_THICKNESS);var depths=manager.collectColDepths(nCols);for(i=0;i<nCols;i++){line=lines[i];if(i>=colStart&&i<colEnd&&i<nCols-1){startDepth=depths[i];left=manager.getColOffset(i+1)+leftOffset;top=$DC.sum(hArr,HLINE_THICKNESS,startDepth);if(startDepth===hArrLen&&x2Empty){top=$DC.add(top,x2Height,HLINE_THICKNESS);}if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_CHART_LINE,identity:{objType:ID_TYPE.V_MATRIX_LINE},styles:styles,dir:"v",context:{dock:DOCK_POS.RIGHT,type:CTRL_TYPE.GM_CHART_COL,depth:i},markControlType:true,parent:this});this.addDisposable(line);line.render();div=line.domNode;fragment.appendChild(div);lines[i]=line;this.splitterListeners.push(line.attachEventListener("splitterMoved",this.id,function(evt){this.onSplitterMoved(evt.position,evt.info);}));}line.updatePosition({left:left-HLINE_THICKNESS,top:top,height:height-top});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_V_CHART_LINE,i));}else{if(line){line.hide();}}}domNode.appendChild(fragment);},hPlaceVGridLines:function(majorStyle,minorStyle){var i,j,n,left,deltas,div,line,cnt1=0,cnt2=0,height=this.GMH,top=0,lines=this.lines,majorLines=lines.vMajorGridLines,minorLines=lines.vMinorGridLines,GMC=this.GMController,majorPos=GMC.xMajorGridLinePos,minorPos=GMC.xMinorGridLinePos,manager=this.manager,index=manager.intersectCheck4Col(this.GMW),colStart=index.start,colEnd=index.end,domNode=this.domGM,leftOffset=0,doc=document,fragment=doc.createDocumentFragment(),drawMajorProp=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.MAJOR_GRID_LINES_SHOW),drawMinor=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.MINOR_GRID_LINES_SHOW)===PRP_GRID_LINE.SHOW,drawMajor=false;if(drawMajorProp===PRP_GRID_LINE.AUTO){drawMajor=(this.GMInfo.nRows===1&&this.GMInfo.nCols===1);}else{if(drawMajorProp===PRP_GRID_LINE.SHOW){drawMajor=true;}}for(i=colStart;i<=colEnd;i++){left=manager.getColOffset(i)+leftOffset;if(drawMajor){deltas=majorPos[i];if(!deltas){continue;}for(j=0,n=deltas.length;j<n;j++,cnt1++){line=majorLines[cnt1];if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_GRID_LINE,identity:{objType:ID_TYPE.GRID_LINE},styles:majorStyle,dir:"v",cssClass:"gm-grid-line-major",bodyCssClass:"gm-grid-line-body-major",draggable:false,parent:this});this.addDisposable(line);line.render();div=line.domNode;fragment.appendChild(div);majorLines[cnt1]=line;}line.updateStyle(majorStyle);line.updatePosition({top:top,left:left+deltas[j],height:height});}}if(drawMinor){deltas=minorPos[i];for(j=0,n=deltas.length;j<n;j++,cnt2++){line=minorLines[cnt2];if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_MINOR_GRID_LINE,identity:{objType:ID_TYPE.MINOR_GRID_LINE},styles:minorStyle,dir:"v",cssClass:"gm-grid-line-minor",bodyCssClass:"gm-grid-line-body-minor",draggable:false,parent:this});this.addDisposable(line);line.render();div=line.domNode;fragment.appendChild(div);minorLines[cnt2]=line;}line.updateStyle(minorStyle);line.updatePosition({top:top,left:left+deltas[j],height:height});}}}for(j=cnt1,n=majorLines.length;j<n;j++){line=majorLines[j];if(line){line.hide();}}for(j=cnt2,n=minorLines.length;j<n;j++){line=minorLines[j];if(line){line.hide();}}domNode.appendChild(fragment);},hPlaceHGridLines:function(majorStyle,minorStyle){var i,j,n,top,deltas,div,line,cnt1=0,cnt2=0,width=this.GMW,left=0,lines=this.lines,majorLines=lines.hMajorGridLines,minorLines=lines.hMinorGridLines,GMC=this.GMController,majorPos=GMC.yMajorGridLinePos,minorPos=GMC.yMinorGridLinePos,manager=this.manager,index=manager.intersectCheck4Row(this.GMH),rowStart=index.start,rowEnd=index.end,domNode=this.domGM,topOffset=0,doc=document,fragment=doc.createDocumentFragment(),drawMajorProp=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.MAJOR_GRID_LINES_SHOW),drawMinor=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.MINOR_GRID_LINES_SHOW)===PRP_GRID_LINE.SHOW,drawMajor=false;if(drawMajorProp===PRP_GRID_LINE.AUTO){drawMajor=(this.GMInfo.nRows===1&&this.GMInfo.nCols===1);}else{if(drawMajorProp===PRP_GRID_LINE.SHOW){drawMajor=true;}}for(i=rowStart;i<=rowEnd;i++){top=manager.getRowOffset(i)+topOffset;if(drawMajor){deltas=majorPos[i];if(!deltas){continue;}for(j=0,n=deltas.length;j<n;j++,cnt1++){line=majorLines[cnt1];if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_H_GRID_LINE,identity:{objType:ID_TYPE.GRID_LINE},styles:majorStyle,dir:"h",cssClass:"gm-grid-line-major",bodyCssClass:"gm-grid-line-body-major",draggable:false,parent:this});this.addDisposable(line);line.render();div=line.domNode;fragment.appendChild(div);majorLines[cnt1]=line;}line.updateStyle(majorStyle);line.updatePosition({top:top+deltas[j],left:left,width:width});}}if(drawMinor){deltas=minorPos[i];for(j=0,n=deltas.length;j<n;j++,cnt2++){line=minorLines[cnt2];if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_H_MINOR_GRID_LINE,identity:{objType:ID_TYPE.MINOR_GRID_LINE},styles:minorStyle,dir:"h",cssClass:"gm-grid-line-minor",bodyCssClass:"gm-grid-line-body-minor",draggable:false,parent:this});this.addDisposable(line);line.render();div=line.domNode;fragment.appendChild(div);minorLines[cnt2]=line;}line.updateStyle(minorStyle);line.updatePosition({top:top+deltas[j],left:left,width:width});}}}for(j=cnt1,n=majorLines.length;j<n;j++){line=majorLines[j];if(line){line.hide();}}for(j=cnt2,n=minorLines.length;j<n;j++){line=minorLines[j];if(line){line.hide();}}domNode.appendChild(fragment);},hPlaceRowResizers:function(styles){var showThem=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.H_MATRIX_LINES_SHOW),lines=this.lines.rows;if(!showThem){lines.forEach(function(line){if(line){line.hide();}});return ;}var i,div,line,top,left,doc=document,fragment=doc.createDocumentFragment(),manager=this.manager,nRows=this.GMInfo.nRows,index=manager.intersectCheck4Row(this.GMH),rowStart=index.start,rowEnd=index.end,width=this.actualWidth,domNode=this.domMainContainer,topOffset=this.offsetY,wArr=this.rowHeaderWArr;var depths=manager.collectRowDepths(nRows);for(i=0;i<nRows;i++){line=lines[i];if(i>=rowStart&&i<rowEnd&&i<nRows-1){top=manager.getRowOffset(i+1)+topOffset;left=$DC.sum(wArr,VLINE_THICKNESS,depths[i]);if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_H_CHART_LINE,identity:{objType:ID_TYPE.H_MATRIX_LINE},styles:styles,dir:"h",context:{dock:DOCK_POS.BOTTOM,type:CTRL_TYPE.GM_CHART_ROW,depth:i},markControlType:true,parent:this});this.addDisposable(line);line.render();div=line.domNode;fragment.appendChild(div);lines[i]=line;this.splitterListeners.push(line.attachEventListener("splitterMoved",this.id,function(evt){this.onSplitterMoved(evt.position,evt.info);}));}line.updatePosition({top:top,left:left,width:width-left});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_H_CHART_LINE,i));}else{if(line){line.hide();}}}domNode.appendChild(fragment);},hPlaceRHResizers:function(styles){var i,div,line,top=this.colHeaderH,pos=0,rhWidths=this.rowHeaderWArr,n=rhWidths.length,height=this.actualHeight,doc=document,domNode=this.domMainContainer,vLines=this.lines.vlines,gmc=this.GMController,showVLines=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.V_MATRIX_LINES_SHOW);for(i=0;i<n;i++){pos+=rhWidths[i];line=vLines[i];if(!showVLines||rhWidths[i]===0){if(line){line.hide();}continue;}if(i===n-1||((i===n-2)&&(gmc.haveY1===false))){top=0;}if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_MATRIX_LINE,identity:{objType:ID_TYPE.V_MATRIX_LINE},styles:styles,dir:"v",context:{dock:DOCK_POS.RIGHT,type:CTRL_TYPE.GM_ROW_HEADER,depth:i},parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);vLines[i]=line;}line.updatePosition({left:pos,top:top,height:height-top-this.GMInfo.xAxisHeight});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_V_MATRIX_LINE,i));pos+=VLINE_THICKNESS;}line=vLines[i];if(this.rowHeaderExtraW>0){pos+=this.rowHeaderExtraW;if(!showVLines){if(line){line.hide();}}else{if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_MATRIX_LINE,identity:{objType:ID_TYPE.V_MATRIX_LINE},styles:styles,dir:"v",context:{dock:DOCK_POS.RIGHT,type:CTRL_TYPE.GM_V_EXTRA_LINE},parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);vLines[i]=line;}line.updatePosition({left:pos,top:0,height:height-this.GMInfo.xAxisHeight});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_V_EXTRA_LINE));}}else{if(line){line.hide();}}},hPlaceCHResizers:function(styles){var i,div,line,left=this.rowHeaderW,gmc=this.GMController,pos=0,x2Height=this.GMInfo.xAxis2Height,chHeights=this.colHeaderHArr,n=chHeights.length,width=this.actualWidth,doc=document,domNode=this.domMainContainer,hLines=this.lines.hlines,showHLines=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.H_MATRIX_LINES_SHOW);for(i=0;i<n;i++){pos+=chHeights[i];line=hLines[i];left=this.rowHeaderW;if(!showHLines||chHeights[i]===0){if(line){line.hide();}continue;}if(i===n-1){left=0;}if((i!==n-1)&&(gmc.haveY1===false)&&this.colTitleW){left-=this.colTitleW;if(this.domTabHeader.offsetWidth===this.colTitleW){left=0;}}if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_H_MATRIX_LINE,identity:{objType:ID_TYPE.H_MATRIX_LINE},styles:styles,dir:"h",context:{dock:DOCK_POS.BOTTOM,type:CTRL_TYPE.GM_COL_HEADER,depth:i},parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);hLines[i]=line;}line.updatePosition({top:pos,left:left,width:width-left});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_H_MATRIX_LINE,i,{max:this.colHeaderMaxHeightArr[i]}));pos+=HLINE_THICKNESS;}line=hLines[i];if(this.colHeaderExtraH>0){pos+=x2Height;if(!showHLines){if(line){line.hide();}}else{if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_H_MATRIX_LINE,identity:{objType:ID_TYPE.H_MATRIX_LINE},styles:styles,dir:"h",context:{dock:DOCK_POS.BOTTOM,type:CTRL_TYPE.GM_XAXIS2},parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);hLines[i]=line;}line.updatePosition({top:pos,width:width});line.updateSize(getLineSizeInfo.call(this,CTRL_TYPE.GM_XAXIS2,undefined,{max:this.rowHeaderMaxHeight}));}}else{if(line){line.hide();}}},hPlaceYSplitters:function(styles){var canShowY1Splitter=function(GMC){if(!GMC.haveY1||!GMC.hasHeaderInY){return false;}var isMetricNameOnRows=GMC.isMetricNamesInZone("Rows"),metrics=GMC.getMetricsOnXAxis(),primaryMetrics=GMC.getMetricsOnPrimaryXAxis(),metricCount=metrics&&metrics.length,primaryMetricCount=primaryMetrics&&primaryMetrics.length,attributes=GMC.getAttributesOnDropZone("YAxis"),attributeCount=attributes&&attributes.length,chtInfo=GMC.getChartInfo();if(chtInfo.isGrid&&chtInfo.isPie){metrics=GMC.getMetricsOnAngleBy();metricCount=metrics&&metrics.length;}return isMetricNameOnRows&&metricCount>=2&&attributeCount>=1&&(metricCount===primaryMetricCount||primaryMetricCount===0);};var div,line,info=this.GMInfo,y1Width=info.yAxisWidth,y2Width=info.yAxis2Width,height=this.GMH,doc=document,domNode=this.domMainContainer,axisSplitters=this.lines.axisSplitters,gmCtr=this.GMController,showThem=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.V_MATRIX_LINES_SHOW),showY1Splitter=showThem&&canShowY1Splitter(gmCtr),showY2Splitter=false,TEXT_CHART_SPACE=0,threshold=this.textHeightInY+2*TEXT_CHART_SPACE;if(!showY1Splitter){line=axisSplitters.y1Splitter;if(line){line.domNode.style.display="none";}}else{line=axisSplitters.y1Splitter;if(y1Width>threshold){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_MATRIX_LINE,identity:{objType:ID_TYPE.V_MATRIX_LINE},styles:styles,dir:"v",draggable:false,parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);axisSplitters.y1Splitter=line;}line.updatePosition({left:this.offsetX-y1Width+threshold-VALINE_THICKNESS,top:this.offsetY,height:height});}else{if(line){line.hide();}}}if(!showY2Splitter){line=axisSplitters.y2Splitter;if(line){line.domNode.style.display="none";}}else{line=axisSplitters.y2Splitter;if(y2Width>threshold){if(!line){div=doc.createElement("div");line=new mstrmojo.VisSplitter({placeholder:div,type:CTRL_TYPE.GM_V_MATRIX_LINE,identity:{objType:ID_TYPE.V_MATRIX_LINE},styles:styles,dir:"v",draggable:false,parent:this});this.addDisposable(line);line.render();div=line.domNode;domNode.appendChild(div);axisSplitters.y2Splitter=line;}line.updatePosition({left:this.offsetX2+y2Width-threshold-VALINE_THICKNESS,top:this.offsetY,height:height});}else{if(line){line.hide();}}}},hInitWidgetMatrixes:function(){var me=this,GMInfo=this.GMInfo,$C=me.GMController,manager=$C.manager,$E=$GM.EnumDrawingAPI,f1=$C.getControllerAPI($E.GET_CHART_WIDTH),f2=$C.getControllerAPI($E.GET_CHART_HEIGHT),f3=$C.getControllerAPI($E.GET_ROW_HEADER),f4=$C.getControllerAPI($E.GET_COLUMN_HEADER),f5=$C.getControllerAPI($E.CREATE_UNIT_Y_AXIS),f6=$C.getControllerAPI($E.CREATE_UNIT_X_AXIS),f7=$C.getControllerAPI($E.GET_FULL_FLEDGED_CHART),f8=$C.getControllerAPI($E.GET_ROW_SPAN),f9=$C.getControllerAPI($E.GET_COLUMN_SPAN),f10=$C.getControllerAPI($E.UPDATE_MINI_CHART),f11=$C.getControllerAPI($E.UPDATE_Y_AXIS),f12=$C.getControllerAPI($E.UPDATE_X_AXIS),f13=$C.getControllerAPI($E.GET_EXTRA_COLUMN_HEADER),f14=$C.getControllerAPI($E.UPDATE_ROW_HEADER),f15=$C.getControllerAPI($E.UPDATE_COLUMN_HEADER),hs=[],vs=[],initSlaveRowHeader=function(){var i,n=me.rowHeaderWArr.length,children=me.domRowHeader.childNodes,propsR,node,api;for(i=0;i<n;i++){propsR={name:"rh",manager:manager,depth:i,depthOnRow:false,placeholder:children[i],phCss:"gm-rowheader-cell",nRows:GMInfo.nRows,nCols:1,chartW:me.rowHeaderWArr[i],chartH:GMInfo.avgChartHeight,fixWidth:true,contentSummary:$C.getRowHeaderSummary(i),useOwnSplitter:false};node=me.addDisposable(new $GM.GMContainer(propsR));api=node.API;api.createUnitChart=f3;api.updateUnitChart=f14;api.getRowSpan=f8;node.render();me.slaveRowHeaders.push(node);vs.push(node);}},initSlaveColHeader=function(){var i,node,api,propsC,n=me.colHeaderHArr.length,children=me.domColHeader.childNodes;for(i=0;i<n;i++){propsC={name:"ch",manager:manager,depth:i,depthOnRow:true,placeholder:children[i],phCss:"gm-colheader-cell",nRows:1,nCols:GMInfo.nCols,chartW:GMInfo.avgChartWidth,chartH:me.colHeaderHArr[i],fixHeight:true,contentSummary:$C.getColHeaderSummary(i),useOwnSplitter:false};node=me.addDisposable(new $GM.GMContainer(propsC));api=node.API;api.createUnitChart=f4;api.updateUnitChart=f15;api.getColSpan=f9;node.render();me.slaveColHeaders.push(node);hs.push(node);}if(me.colHeaderExtraH>0){propsC={manager:manager,placeholder:children[i],phCss:" gm-colheader-cell-dummy",nRows:1,nCols:GMInfo.nCols,chartW:GMInfo.avgChartWidth,chartH:me.colHeaderExtraH,fixHeight:true,useOwnSplitter:false};node=me.slaveXAxis2=me.addDisposable(new $GM.GMContainer(propsC));api=node.API;if($C.haveX2){node.isPrimary=false;api.createUnitChart=f6;api.updateUnitChart=f12;}else{api.createUnitChart=f13;api.updateUnitChart=f15;}node.render();node.domNode.style.backgroundColor="rgba(0,0,0,0)";me.slaveColHeaders.push(node);hs.push(node);}},initSlaveYAxis=function(){var propsY={name:"y",manager:manager,placeholder:me.domYAxis.childNodes[0],phCss:"gm-yaxis-cell",nRows:GMInfo.nRows,nCols:1,chartW:GMInfo.yAxisWidth,chartH:GMInfo.avgChartHeight,fixWidth:true,useOwnSplitter:false},slaveYAxis=me.slaveYAxis=me.addDisposable(new $GM.GMContainer(propsY)),api=slaveYAxis.API;slaveYAxis.isPrimary=true;api.createUnitChart=f5;api.updateUnitChart=f11;slaveYAxis.render();vs.push(slaveYAxis);},initSlaveYAxis2=function(){var propsY2={name:"y2",manager:manager,placeholder:me.domYAxis2.childNodes[0],phCss:"gm-yaxis-cell",nRows:GMInfo.nRows,nCols:1,chartW:GMInfo.yAxis2Width,chartH:GMInfo.avgChartHeight,fixWidth:true,useOwnSplitter:false},slaveYAxis2=me.slaveYAxis2=me.addDisposable(new $GM.GMContainer(propsY2)),api=slaveYAxis2.API;slaveYAxis2.isPrimary=false;api.createUnitChart=f5;api.updateUnitChart=f11;slaveYAxis2.render();vs.push(slaveYAxis2);},initSlaveXAxis=function(){var propsX={name:"x",manager:manager,placeholder:me.domXAxis.childNodes[0],phCss:"gm-xaxis-cell",nRows:1,nCols:GMInfo.nCols,chartH:GMInfo.xAxisHeight,chartW:GMInfo.avgChartWidth,fixHeight:true,useOwnSplitter:false};var slaveXAxis=me.slaveXAxis=me.addDisposable(new $GM.GMContainer(propsX)),api=slaveXAxis.API;slaveXAxis.isPrimary=true;api.createUnitChart=f6;api.updateUnitChart=f12;slaveXAxis.render();hs.push(slaveXAxis);},initMaster=function(){var props={name:"master",manager:manager,placeholder:me.domGM.childNodes[0],phCss:"gm-chart",nRows:GMInfo.nRows,nCols:GMInfo.nCols,chartW:GMInfo.avgChartWidth,chartH:GMInfo.avgChartHeight,enableLassoSelect:!me.formattingMode,APIOwner:me,useOwnSplitter:false,canvasScrolled:true,useAsSelectorOrBrushes:me.hasAssociatedNodes()||me.selectorControl,shouldDrawShapeFlag:$C.shouldDrawShapeFlag},masterView=me.masterViewer=me.addDisposable(new $GM.GMContainer(props)),api=masterView.API;api.createUnitChart=f7;api.updateUnitChart=f10;api.lassoSelected=me.lassoSelected;api.lassoSelecting=me.lassoSelecting;masterView.render();masterView.domNode.style.overflow="hidden";$DOM.attachMarkupEvent(me.id,masterView.domContainer,"scroll");};manager.setDimensions(GMInfo.nRows,GMInfo.nCols,GMInfo.avgChartWidth,GMInfo.avgChartHeight);manager.API.getChartWidth=f1;manager.API.getChartHeight=f2;initSlaveRowHeader();initSlaveColHeader();initSlaveYAxis();if($C.haveY2){initSlaveYAxis2();}initSlaveXAxis();initMaster();manager.master=this.masterViewer;manager.hSlaves=hs;manager.vSlaves=vs;manager.binding();manager.yAxis=this.slaveYAxis;manager.xAxis=this.slaveXAxis;manager.yAxis2=this.slaveYAxis2;manager.xAxis2=this.slaveXAxis2;this.addChildren(hs);this.addChildren(vs);this.addChildren(this.masterViewer);},setTheme:function(theme){if(theme===PRP_THEME.DARK){this.cssClass="gm-dark-theme";this.menuCssClass="gm-context-menu-dark";}else{this.cssClass="gm-light-theme";this.menuCssClass="gm-context-menu-light";}this.theme=theme;if(this.domNode){this.domNode.setAttribute("class",this.cssClass);}this.GMController.updatePalette(theme);},onLegendDropped:function(slot){this.writeGlobalProperty(ENUM_XML_TAG.LEGEND_POSITION,slot);},onLegendDropZoneChange:function onLegendDropZoneChange(dropZoneInfo){this.hLayoutLegend(dropZoneInfo.pos);this.hPlaceOutBorders(dropZoneInfo.pos);},lassoSelecting:function(){this.shouldNotTriggerClick=false;this.interactor.clearSelectedCharts();},lassoSelected:function(info){var interactor=this.interactor;interactor.clearSelectedTargets();if(!info.ctrlKey){this.clearSelections();interactor.clearSelectedShapes();interactor.clearSelectedCharts();this.GMController.highLightShapeIndex={};}interactor.selectShapes(info.selectedShapes,true);addHiddenBubbles.call(this,info);this.endSelections();this.shouldNotTriggerClick=true;interactor.toggleGMFade();},getReplaceType:function(){var gmCtr=this.GMController,chtInfo=gmCtr.getChartInfo(),horizontalmode=(chtInfo.isABL&&chtInfo.dirc===$GM.EnumABLDirection.HORIZONTAL);if(horizontalmode||chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){return 0;}return 1;},getSliceAttrNum:function(){var gmCtr=this.GMController,chtInfo=gmCtr.getChartInfo(),sliceByCnt=gmCtr.getUnitsCountInSliceBy(),horizontalmode=(chtInfo.isABL&&chtInfo.dirc===$GM.EnumABLDirection.HORIZONTAL);if(chtInfo.isPie&&sliceByCnt>0){if((this.getReplaceType()===0&&!horizontalmode)||(this.getReplaceType()===1&&horizontalmode)){return sliceByCnt;}return 0;}return 0;},getMenuHandler:function getMenuHandler(fName){var me=this,interactor=me.interactor,gmCtr=me.GMController,chtInfo,selObjsInfo,handler;handler=this._super(fName);if(handler!==mstrmojo.emptyFn){return handler;}var changeGlobalShape=function(){chtInfo=gmCtr.getChartInfo();var shapeCfg=new mstrmojo.ui.menus.MenuConfig();var allShapes=[{id:12097,desc:"Bar",v:PRP_SHAPE.BAR},{id:12098,desc:"Line",v:PRP_SHAPE.LINE},{id:12099,desc:"Area",v:PRP_SHAPE.AREA},{id:12100,desc:"Circle",v:PRP_SHAPE.CIRCLE},{id:12101,desc:"Square",v:PRP_SHAPE.SQUARE},{id:12102,desc:"Tick",v:PRP_SHAPE.TICK},{id:12103,desc:"Ring",v:PRP_SHAPE.RING},{id:12104,desc:"Pie",v:PRP_SHAPE.PIE}];var gridExcludingShape={Area:true,Line:true},bubbleExcludingShape={Area:true,Line:true,Bar:true},ablExcludingShape={},excludingShapes=chtInfo.isBubbleOrScatter?bubbleExcludingShape:gridExcludingShape;if(chtInfo.isABL){excludingShapes=ablExcludingShape;}var validShape=[];allShapes.forEach(function(cdShp){if(!excludingShapes[cdShp.desc]){validShape.push(cdShp);}});var metricShapeProp=me.readGlobalProperty(ENUM_XML_TAG.METRIC_SHAPES).jsonObj,metricIdArray=Object.keys(metricShapeProp),isCombinationGraph=false,firstMetricShape=me.readGlobalProperty("Shape");metricIdArray=$ARR.filter(metricIdArray,function(metricId){return metricId.indexOf(TIME_STAMP)<0;});if(metricIdArray.length>0){$ARR.forEach(metricIdArray,function(metricId){if(metricShapeProp[metricId]!==firstMetricShape){isCombinationGraph=true;}});}validShape.forEach(function(sp){shapeCfg.addMenuItem(mstrmojo.desc(sp.id,sp.desc),isCombinationGraph?"":(PRP_SHAPE[sp.desc.toUpperCase()]===firstMetricShape)?"on":"",function(){me.setWidgetPropertyValue(ENUM_XML_TAG.METRIC_SHAPES,{});me.processChangeShape(sp.v);});});return shapeCfg;};var showDataForMetric=function(menuItem){var ctxt=menuItem.ctxt,showDataLabel=ctxt.dtlb,mid=ctxt.mid;changeShowDataLabelForMetric.call(me,mid,showDataLabel);};var changeShape=function(menuItem){var ctxt=menuItem.ctxt,sp=ctxt.sp,mid=ctxt.mid,metricShape;metricShape=me.readGlobalProperty(ENUM_XML_TAG.METRIC_SHAPES);metricShape.setProperty(mid,sp);me.writeGlobalProperty(ENUM_XML_TAG.METRIC_SHAPES,metricShape,undefined);};var selectionKeepOnly=function(){me.updateAfterKeepOnly(true);me.noHighlightAfterKeepOnlyExcludeDrill=true;};var selectionExclude=function(){me.updateAfterKeepOnly(false);me.noHighlightAfterKeepOnlyExcludeDrill=true;};var selectionKeepOnlyAndShow=function(menuItem){var drillUnit=menuItem.ctxt.drillUnit;me.updateAfterKeepOnlyAndShow(drillUnit);me.noHighlightAfterKeepOnlyExcludeDrill=true;};var selectionShowData=function(){selObjsInfo=gmCtr.getSelectedObjectsInfo(interactor.selectedShapes);me.showData(selObjsInfo);me.noReorderAfterShowData=true;};var headerKeepOnly=function(){me.updateAfterKeepOnly(true);me.noHighlightAfterKeepOnlyExcludeDrill=true;};var headerExclude=function(){me.updateAfterKeepOnly(false);me.noHighlightAfterKeepOnlyExcludeDrill=true;};var headerDrill=function(menuItem){var drillUnit=menuItem.ctxt.drillUnit,fromUnit=menuItem.ctxt.fromUnit;me.updateAfterKeepOnlyAndShow(drillUnit,fromUnit);me.noHighlightAfterKeepOnlyExcludeDrill=true;};var sortAttributeTitle=function(menuItem){var ctx=menuItem.ctxt,isAsc,selInfo,sortArray,actions,identity;isAsc=ctx.isAsc;identity=ctx.identity;selInfo=ctx.selInfo;gmCtr.sortingMetric=false;if(identity||selInfo){sortArray=gmCtr.getAttributeSortPlusExistedMetricSort(identity||selInfo,isAsc);actions=gmCtr.getSortActions(sortArray);me.updateAfterSort(actions);}else{$VISUTILS.visPrint("undefined identity or selection info");}};var sortMetricTitle=function(menuItem){var ctx=menuItem.ctxt,isAsc,selInfo,sortArray,cellHandle;isAsc=ctx.isAsc;selInfo=ctx.selInfo;cellHandle=selInfo.cellHandle;if(cellHandle){gmCtr.sortingMetric=true;sortArray=gmCtr.getMetricSortDefinition(cellHandle,isAsc);var actions=gmCtr.getSortActions(sortArray);me.setWidgetPropertyValue(ENUM_XML_TAG.SORT_ORDER,isAsc);me.setWidgetPropertyValue(ENUM_XML_TAG.SORT_INDEX,cellHandle);var chartInfo=gmCtr.getChartInfo(),useFakeTotal=true;if(useFakeTotal&&chartInfo.isABL&&gmCtr.isStacked){gmCtr.fakeSortActionsStackTotal(actions);}me.updateAfterSort(actions);}else{$VISUTILS.visPrint("undefined cell handle");}};var advancedSort=function(menuItem){var ctx=menuItem.ctxt,axis=ctx.axis;var METRICS=-1;switch(axis){case $DZ_ID.Rows:axis=1;break;case $DZ_ID.Columns:axis=2;break;case METRICS:break;}me.model.controller.onGetAdvSortData(me,axis,ctx.item.t);};var clearSort=function(){var actions=gmCtr.getSortActions([]);me.removeWidgetProperty(ENUM_XML_TAG.SORT_ORDER);me.removeWidgetProperty(ENUM_XML_TAG.SORT_INDEX);me.updateAfterSort(actions);};var invokeDebug=function(){var menuCfg=me.GMController.getDebugMenu();me.showContextMenu(null,menuCfg);};switch(fName){case"selectionKeepOnly":return selectionKeepOnly;case"selectionExclude":return selectionExclude;case"selectionKeepOnlyAndShow":return selectionKeepOnlyAndShow;case"selectionShowData":return selectionShowData;case"headerKeepOnly":return headerKeepOnly;case"headerExclude":return headerExclude;case"headerDrill":return headerDrill;case"sortAttributeTitle":return sortAttributeTitle;case"advancedSort":return advancedSort;case"clearSort":return clearSort;case"sortMetricTitle":return sortMetricTitle;case"changeShape":return changeShape;case"showDataForMetric":return showDataForMetric;case"changeGlobalShape":return changeGlobalShape;case"debug":return invokeDebug;case"attributeAddToFilter":case"attributeUseAsSelector":case"attributeFormat":case"sortAxisAttribute":case"advancedSortAxisAttribute":case"attributeRename":case"attributeRemove":case"attributeNew":case"filterOnSelection":case"createGroup":case"createCalculationDE":case"showMarker":case"hideMarker":case"dataLabelShowValue":case"dataLabelShowText":case"dataLabelHide":case"metricFormat":case"metricRename":case"metricRemove":case"metricNew":case"metricAddToFilter":break;}return mstrmojo.emptyFn;},showContextMenu:function(evt,menuData){var menu=this.contextMenu,me=this,controller=this.GMController,cmPos,e,win;if(evt!==null){e=evt.e;win=evt.hWin;cmPos=$DOM.position(this.getRealTarget(evt));cmPos.y+=cmPos.h;cmPos.x-=1;}else{cmPos={x:0,y:0,w:0,h:0};}if(menu){menu.hideContextMenu();menu.unrender();delete this.contextMenu;}menu=new mstrmojo.MenuButton({cmCssClass:this.menuCssClass,zIndex:1000,cm:menuData,dynamicUpdate:true,executeCommand:function(item){switch(item.did){case MENU.OUTPUT_EXTREMES:controller.printExtremes();break;case MENU.OUTPUT_DATA_COUNT:$VISUTILS.visPrint("# Data Points in Total: "+controller.getGraphShapeCount());$VISUTILS.visPrint("Count of Chart is "+controller.getChartCountInCol()*controller.getChartCountInRow());break;case MENU.ENABLE_PARTIAL_RENDERING:controller.enablePartialRendering=true;me.writeGlobalProperty(ENUM_XML_TAG.PARTIAL_RENDER,true);break;case MENU.DISABLE_PARTIAL_RENDERING:controller.enablePartialRendering=false;me.writeGlobalProperty(ENUM_XML_TAG.PARTIAL_RENDER,false);break;case MENU.ENABLE_TIMER:GMUTIL.mUseTimer=true;break;case MENU.DISABLE_TIMER:GMUTIL.mUseTimer=false;break;case MENU.ENABLE_CE_TIMER:me.enableCETimer=true;break;case MENU.DISABLE_CE_TIMER:me.enableCETimer=false;break;default:break;}}});this.contextMenu=menu;menu.set("cmPos",cmPos);menu.render();menu.showContextMenu();if(evt!==null){$DOM.stopPropogation(win,e);$DOM.preventDefault(win,e);}},hideContextMenu:function(){var menu=this.contextMenu;if(menu){menu.hideContextMenu();}},onSplitterMoved:function(distance,info){var k,manager=this.manager,GMInfo=this.GMInfo,dockPosition=info.dock,type=info.type,id=info.depth,dx=0,dy=0;if(type===CTRL_TYPE.GM_CHART_ROW){manager.resizeRow(manager.master,id,distance);return ;}if(type===CTRL_TYPE.GM_CHART_COL){manager.resizeCol(manager.master,id,distance);return ;}if(dockPosition===DOCK_POS.RIGHT){dx=distance;}else{if(dockPosition===DOCK_POS.LEFT){dx=-distance;}else{if(dockPosition===DOCK_POS.TOP){dy=-distance;}else{dy=distance;}}}if((type===CTRL_TYPE.GM_ROW_HEADER||type===CTRL_TYPE.GM_YAXIS)&&dx===0){return ;}if((type===CTRL_TYPE.GM_COL_HEADER||type===CTRL_TYPE.GM_XAXIS)&&dy===0){return ;}if(type===CTRL_TYPE.GM_RIGHT_BORDER||type===CTRL_TYPE.GM_BOTTOM_BORDER){manager.resizeBorder(manager.master,dx,dy);return ;}if(type===CTRL_TYPE.GM_ROW_HEADER){k=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_ROW_HEADERS)[id];k*=(1+dx/this.rowHeaderWArr[id]);this.rowHeaderWArr[id]+=dx;this.writeGlobalProperty(ENUM_XML_TAG.SCALE_ROW_HEADERS,k,{key:id});}else{if(type===CTRL_TYPE.GM_COL_HEADER){k=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_COL_HEADERS)[id];k*=(1+dy/this.colHeaderHArr[id]);this.colHeaderHArr[id]+=dy;this.writeGlobalProperty(ENUM_XML_TAG.SCALE_COL_HEADERS,k,{key:id});}else{if(type===CTRL_TYPE.GM_YAXIS){k=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_Y);k*=(1+dx/GMInfo.yAxisWidth);GMInfo.yAxisWidth+=dx;this.yAxisFixed=true;this.writeGlobalProperty(ENUM_XML_TAG.SCALE_Y,k);}else{if(type===CTRL_TYPE.GM_YAXIS2){k=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_Y2);k*=(1+dx/GMInfo.yAxis2Width);GMInfo.yAxis2Width+=dx;this.yAxis2Fixed=true;this.writeGlobalProperty(ENUM_XML_TAG.SCALE_Y2,k);}else{if(type===CTRL_TYPE.GM_XAXIS){k=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_X);k*=(1+dy/GMInfo.xAxisHeight);GMInfo.xAxisHeight+=dy;this.xAxisFixed=true;this.writeGlobalProperty(ENUM_XML_TAG.SCALE_X,k);}else{if(type===CTRL_TYPE.GM_XAXIS2){k=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_X2);k*=(1+dy/GMInfo.xAxis2Height);GMInfo.xAxis2Height+=dy;this.xAxis2Fixed=true;this.writeGlobalProperty(ENUM_XML_TAG.SCALE_X2,k);}else{if(type===CTRL_TYPE.GM_V_EXTRA_LINE){k=this.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_V_EXTRA_LINE);k*=(1+dx/this.rowHeaderExtraW);this.rowHeaderExtraW+=dx;this.writeGlobalProperty(ENUM_XML_TAG.SCALE_V_EXTRA_LINE,k);}}}}}}}},onLegendResized:function(distance){var legend=this.legend;if(legend){this.legendFixedW=this.legendW+distance;this.legendScale=(this.legendFixedW)/(this.legendW/this.legendScale);this.legendResized=true;this.writeGlobalProperty(ENUM_XML_TAG.SCALE_LEGEND_WIDTH,this.legendScale);}},onLegendClicked:function(evt){var action=evt.action;if(action==="close"){this.writeGlobalProperty(ENUM_XML_TAG.LEGEND_VISIBLE,false);}else{if(action==="minimize"){this.writeGlobalProperty(ENUM_XML_TAG.LEGEND_MODE,PRP_LEGEND_MODE.MINIMIZED);}else{if(action==="restore"){this.writeGlobalProperty(ENUM_XML_TAG.LEGEND_MODE,PRP_LEGEND_MODE.RESTORED);}}}},onControlResized:function(evalHeaders,evalLegend,calcMargin,drawCharts){GMUTIL.startTimer({functionName:"VisGraphMatrix.onControlResized",purpose:"Partial update of GraphMatrix ("+this.k+")"});var HTML5PROPS=this.HTML5PROPS;if(evalLegend){this.hEvalSize4Legend();}if(evalHeaders){this.hEvalSizeIteratively();}else{this.hEvalSize4GMArea();this.hDecideDataLabelRotation();}this.hCalcRadiusAndMargin(calcMargin);this.hLayoutControls();this.hFillContents();this.updateRowValueBackground();this.updateColumnValueBackground();this.hUpdateLegend();if(drawCharts){this.outputLog4PartialRender();this.manager.drawCharts();this.updateSelections();}this.hPlaceRHResizers(HTML5PROPS.MATRIX_LINE_V);this.hPlaceCHResizers(HTML5PROPS.MATRIX_LINE_H);this.hPlaceYResizers(HTML5PROPS.AXIS_LINE_Y);this.hPlaceXResizers(HTML5PROPS.AXIS_LINE_X);this.hPlaceYSplitters(HTML5PROPS.MATRIX_LINE_V);this.hPlaceOutBorders();this.hPlaceRowResizers(HTML5PROPS.MATRIX_LINE_H);this.hPlaceColResizers(HTML5PROPS.MATRIX_LINE_V);this.hPlaceHGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);this.hPlaceVGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);GMUTIL.endTimer();this.updateScrollBars();},configurePopup:function configurePopup(config,itemBtn){config.hostId=this.id;config.hostElement=itemBtn;},getPersistAction:function(lXml){lXml=lXml||this.property.getXMLString();return getPersistWidgetPropertyAction.call(this,lXml);},getDragData:function getDragData(context){var interactor=this.interactor;return interactor.getDragData(context,this);},deleteItem:function deleteItem(item){var interactor=this.interactor;return interactor.deleteItem(item,this);},createAvatar:function createAvatar(target,context){var avatar=document.createElement("div"),dragData=context.src.data,dragItem=dragData.item,itemNode;if(!dragItem){return ;}if(!this.itemRenderer){this.itemRenderer=new mstrmojo.vi.ui.VIDragUnit();}itemNode=this.itemRenderer.getUnitAvatar(context);$CSS.addClass(itemNode,"isAvatar");avatar.appendChild(itemNode);avatar.style.margin="10px 0 0 10px";return avatar;},positionAvatar:function positionAvatar(pos){if(!this.avatar){return ;}var avatar=this.avatar,avs=avatar.style;avs.left=pos.x-avatar.offsetWidth/2+"px";avs.top=pos.y-avatar.offsetHeight-13+"px";},isDragValid:function isDragValid(context){var dragData=context.src.data;return !!(dragData&&dragData.item)||this._super(context);},allowDrop:function allowDrop(context){var dragData=context.src.data,dragSource=dragData&&dragData.src,interactor=this.interactor;context.dndGM=true;if(dragSource===ENUM_SOURCE.DATASETS||dragSource===ENUM_SOURCE.VIZ_EDITOR||dragSource===ENUM_SOURCE.VIZ||dragSource===ENUM_SOURCE.ALL_OBJECT_LIST){var items=dragData.items;if(items&&items.length===1){interactor.getDropZonesOnGraph(context,this);if(Object.keys(this.dropZonesOnGraph).length>0){return true;}}else{return true;}}return false;},isDragingMultipleObj:function isDragingMultipleObj(context){var i,dragData=context.src.data,items=dragData&&dragData.items;if(context.isDragingMultipleObj===undefined){context.isDragingMultipleObj=false;for(i=1;i<items.length;i++){if(items[i].t!==items[i-1].t){context.isDragingMultipleObj=true;break;}}}return context.isDragingMultipleObj;},ondragenter:function ondragenter(context){var isEmpty=this.isEmpty();if(isEmpty){this.actualWidth=this.domNode.offsetWidth;this.actualHeight=this.domNode.offsetHeight;}var node,props,interactor=this.interactor;if(!this.dndHighlightCanvas){var canvas=document.createElement("canvas"),widgetPos=$DOM.position(this.domNode),mainContainerPos=$DOM.position(this.domMainContainer);this.domNode.appendChild(canvas);canvas.style.position="absolute";canvas.style.zIndex=1000;canvas.width=mainContainerPos.w||widgetPos.w;canvas.height=mainContainerPos.h||widgetPos.h;canvas.style.top=(mainContainerPos.y-widgetPos.y)+"px";canvas.style.left=(mainContainerPos.x-widgetPos.x)+"px";this.dndHighlightCanvas=canvas;}if(!this.dndHighlightNodes){node=document.createElement("div");this.domNode.appendChild(node);props={placeholder:node,top:0,left:0,zIndex:20,nodeCss:"gm-dnd-highlight-node"};this.dndHighlightNodes=new $GM.DndReplaceNode(props);this.dndHighlightNodes.render();this.dndHighlightNodes.parent=this;}if(!this.dndTooltip){node=document.createElement("div");document.body.appendChild(node);props={placeholder:node,contentNodeCssClass:"gm-dnd-replace-node-tooltip",boundary:document.body};this.dndTooltip=new $GM.DndTooltip(props);this.dndTooltip.render();this.dndTooltip.parent=this;}if(!this.dndArrow){node=document.createElement("div");document.body.appendChild(node);this.dndArrow=node;}context.dndGM=true;this.setInteractive(false);interactor.clearHoveredShape();interactor.hideTooltip();interactor.toggleHoverEffect(this,false);this.dndAsBlackBox=this.isDragingMultipleObj(context);if(!this.isDragingMultipleObj(context)){interactor.calculateDropZoneOnGraphRange(this,context);this.ondragover(context);}if(this._super){this._super(context);}},ondragover:function ondragover(context){var interactor=this.interactor;context.dndGM=true;if(!this.isDragingMultipleObj(context)){interactor.clearHighlightDropZoneOnGraph(this);if(interactor.findEnteredDropZoneOnGraph(context,this)){interactor.findTargetInDropZoneOnGraph(context,this);interactor.highlightDropZoneOnGraph(context,this);}}interactor.updateAvatarIcon(context);if(this._super){this._super(context);}},ondragleave:function ondragleave(context){context.dndGM=true;var mainContainerPos=$DOM.position(this.domMainContainer),pos=context.tgt&&context.tgt.pos,inWidget=(pos.x>mainContainerPos.x&&pos.x<mainContainerPos.x+mainContainerPos.w)&&(pos.y>mainContainerPos.y&&pos.y<mainContainerPos.y+mainContainerPos.h);if(inWidget){context.tgt.widget=this;}else{this._super(context);}},ondrop:function ondrop(context){var interactor=this.interactor;context.dndGM=true;interactor.ondrop(context,this);this._super(context);},cleanUpAfterTarget:function cleanUpAfterTarget(context){context.dndGM=true;this._super(context);this.setInteractive(true);this.interactor.toggleHoverEffect(this,true);if(this.domNode.contains(this.dndHighlightCanvas)){this.domNode.removeChild(this.dndHighlightCanvas);}delete this.dndHighlightCanvas;if(document.body.contains(this.dndArrow)){document.body.removeChild(this.dndArrow);}delete this.dndArrow;if(this.dndHighlightNodes){this.dndHighlightNodes.destroy();}delete this.dndHighlightNodes;if(this.dndTooltip){this.dndTooltip.destroy();}delete this.dndTooltip;this.dropZonesOnGraph=null;this.currEnteredDropZoneID=null;},toggleContainerCls:function(flag,cls){var domNode=this.domMainContainer;if(flag){$CSS.addClass(domNode,cls);}else{$CSS.removeClass(domNode,cls);}},toggleContainerCls2:function(flag,cls){var domNode=this.domMainContainer;if(flag){$CSS.addClass(domNode,cls);}else{$CSS.removeClass(domNode,cls);}},updateSelections:function(){this.highlight(this.getSelectionType(),this.getSelectionHash());},clearSelectedShapesAndCharts:function(){var interactor=this.interactor,manager=this.manager;if(manager){manager.dismissLassoSelector();}if(interactor){interactor.clearSelectedShapes();interactor.clearSelectedCharts();}},clearSelectedHighlights:function(fromDoHight){var interactor=this.interactor,manager=this.manager;if(manager){manager.dismissLassoSelector();}if(interactor){interactor.clearSelectedShapes();interactor.clearSelectedCharts();interactor.clearSelectedTargets();}if(!fromDoHight){this.GMController.highLightShapeIndex={};}},toggleShapeSelectionIndex:function(identity,isSelected){var gc,gId,sId,sliceId,dp,row,col,gmCtr=this.GMController,highLightIndex=gmCtr.highLightShapeIndex;gmCtr.resetHighLightIndex=false;if(identity.isPie){gc=identity.sPieDP.graphCell;sliceId=identity.sliceIdx;}else{gc=identity.gc;}dp=gc.dp;row=dp.rowIndex;col=dp.colIndex;gId=gc.gID;sId=gc.sID;if(highLightIndex[row]===undefined){highLightIndex[row]={};}if(highLightIndex[row][col]===undefined){highLightIndex[row][col]={};}highLightIndex=highLightIndex[row][col];if(highLightIndex[gId]===undefined){highLightIndex[gId]={};}if(identity.isPie){if(highLightIndex[gId][sId]===undefined){highLightIndex[gId][sId]={};}highLightIndex[gId][sId][sliceId]=isSelected;}else{highLightIndex[gId][sId]=isSelected;}},getNumericAxisOptions:function(isAxisScale){var gmCtr=this.GMController;return gmCtr.getNumericAxisOptions(isAxisScale);},getStyleEffectsOptions:function(){var gmCtr=this.GMController;return gmCtr.getStyleEffectsOptions();},getColorByOptions:function(){var gmCtr=this.GMController,opts=gmCtr.getColorByOptions();if(!opts){return[];}return opts.subOptions;},getTitleRMCPopup:function(){if(!this.parent.boxContent.formattingMode){return ;}var obj={name:"titleBarRMC"};this.raiseEvent(obj);return getFontToolbar.call(this,false);},getFontToolbarProps:function(){return{cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,width:"381px",height:"22px"};},getChartInfo:function(){return this.GMController.getChartInfo();},getHostStructure:function(){return this.GMController.getHostStructure();},getDependentMetricOptions:function(){return this.GMController.getDependentMetricOptions();},getIndependentMetricOptions:function(){return this.GMController.getIndependentMetricOptions();},getReferenceAxisOption:function(){return this.GMController.getReferenceAxisOption();},getRealReferenceOptionFromAxisOption:function(axOpt,refType,modix){return this.GMController.getRealReferenceOptionFromAxisOption(axOpt,refType,modix);},getReferenceLineOptions:function(){return this.GMController.getReferenceLineOptions();},getEnabledReferenceLineOptions:function(opt){return this.GMController.getEnabledReferenceLineOptions(opt);},getShowDataLabelOptions:function(){return this.GMController.getShowDataLabelOptions();},isSeasonalityEnabled:function(){return this.GMController.isSeasonalityEnabled();},formatAsAxisLabel:function(metricId,value){return this.GMController.formatAsAxisLabel(metricId,value);},isShapeCombonation:function(){var GMC=this.GMController,metricShapeArr=GMC.metricShapeArr,comb=false,i,n=(metricShapeArr&&metricShapeArr.length)||0,shape;if(GMC.enableCombiChart){if(n===0){comb=true;}else{if(n===1){comb=false;}else{for(i=1;i<n;i++){if(metricShapeArr[i]!==metricShapeArr[i-1]){comb=true;break;}}}}if(!comb){shape=metricShapeArr[0];}}return{isComb:comb,shapeType:shape};},isMajorGridLineShow:function(){var drawMajorProp=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.MAJOR_GRID_LINES_SHOW),gmInfo=this.GMInfo,drawMajor=false;if(drawMajorProp===PRP_GRID_LINE.AUTO){drawMajor=gmInfo&&(gmInfo.nRows===1&&gmInfo.nCols===1);}else{if(drawMajorProp===PRP_GRID_LINE.SHOW){drawMajor=true;}}return drawMajor;},getReferenceOptionForMetricId:function(metricId){var found=false,opts=this.getReferenceAxisOption(),opt;opts.forEach(function(o){var mos=o.mos;mos.forEach(function(m){if(m.mId===metricId){opt=o;found=true;return false;}});if(found){return false;}});return opt;},copyTrendLineInfoForSwap:function(zoneY,zoneX){var optX,optY,currentPropX,currentPropY,jsonObjX,jsonObjY,itemsX=[],itemsY=[],actions=[],bubbleSerisNum,i,METRIC_TYPE=4,METRIC_NAMES_ID="00000000000000000000000000000000";$ARR.forEach(zoneX.items,function(item){if(item.t===METRIC_TYPE&&item.id!==METRIC_NAMES_ID){itemsX.push(item);}});$ARR.forEach(zoneY.items,function(item){if(item.t===METRIC_TYPE&&item.id!==METRIC_NAMES_ID){itemsY.push(item);}});bubbleSerisNum=Math.min(itemsY.length,itemsX.length);for(i=0;i<bubbleSerisNum;i++){optX=getTrendLineOptionForMetricId.call(this,itemsX[i].did,true);currentPropX=this.readGlobalProperty(ENUM_XML_TAG.TREND_LINE_DEF,optX);jsonObjX=currentPropX.jsonObj;if(jsonObjX.trdEnabled){return actions;}}for(i=0;i<bubbleSerisNum;i++){optY=getTrendLineOptionForMetricId.call(this,itemsY[i].did);currentPropY=this.readGlobalProperty(ENUM_XML_TAG.TREND_LINE_DEF,optY);jsonObjY=currentPropY.jsonObj;if(jsonObjY.trdEnabled){optX=getTrendLineOptionForMetricId.call(this,itemsX[i].did,true);currentPropX=this.readGlobalProperty(ENUM_XML_TAG.TREND_LINE_DEF,optX);currentPropX.setProperty(ENUM_XML_TAG.TREND_ENABLED,true);currentPropX.setProperty(ENUM_XML_TAG.TREND_LEVEL,jsonObjY.trdLvl);currentPropX.setProperty(ENUM_XML_TAG.TREND_TYPE,jsonObjY.trdTp);if(jsonObjY.trdDgr){currentPropX.setProperty(ENUM_XML_TAG.TREND_POLY_DEGREE,jsonObjY.trdDgr);}this.collectTrendLineAction(currentPropX.jsonObj,actions,optX.key);}}return actions;},queryTrendLineStatusForMetric:function(metricId){var opt=getTrendLineOptionForMetricId.call(this,metricId),currentProp=this.readGlobalProperty(ENUM_XML_TAG.TREND_LINE_DEF,opt);return(currentProp.jsonObj[ENUM_XML_TAG.TREND_ENABLED]);},switchOnOffTrendLineForMetric:function(metricId,enable){if(enable){this.checkCustomScaleNotificationForTrendLine(metricId);}var opt=getTrendLineOptionForMetricId.call(this,metricId),currentProp=this.readGlobalProperty(ENUM_XML_TAG.TREND_LINE_DEF,opt);currentProp.setProperty(ENUM_XML_TAG.TREND_ENABLED,enable);this.writeGlobalProperty(ENUM_XML_TAG.TREND_LINE_DEF,currentProp,opt);},getExistingRefLineOptions:function(metricId){var opt=this.getReferenceOptionForMetricId(metricId);return this.getEnabledReferenceLineOptions(opt);},getExistingRefLineOptionsForAxis:function(axisKey){var opt=getReferenceOptionForAxisKey.call(this,axisKey);return this.getEnabledReferenceLineOptions(opt);},getAvailableRefLineTypes:function(metricId){if(GMUTIL.isIgnoredMetric(this,this.GMController.getMetricIndexFromID(metricId))){return[];}var existingRefLines=this.getExistingRefLineOptions(metricId),restrictedTypes=this.getChartInfo().isBubbleOrScatter?[$GM.EnumRefLineModelType.FIRST,$GM.EnumRefLineModelType.LAST]:[];return $HASH.valarray($GM.EnumRefLineModelType).filter(function(refType){return restrictedTypes.indexOf(refType)===-1&&(refType===$GM.EnumRefLineModelType.CONST||$ARR.find(existingRefLines,"refType",refType)===-1);});},toggleRefLineEnabled:function(metricId,refType,enabled,constVal,modix){if(enabled){this.checkCustomScaleNotificationForReferenceLine(metricId);}var metricOpt=this.getReferenceOptionForMetricId(metricId),refOpt=this.getRealReferenceOptionFromAxisOption(metricOpt,refType,modix),currentProp=this.readGlobalProperty(ENUM_XML_TAG.REF_LINE_DEF,refOpt);currentProp.setProperty(ENUM_XML_TAG.REF_ENABLED,enabled);if(refType===$GM.EnumRefLineModelType.CONST){currentProp.setProperty(ENUM_XML_TAG.REF_CONST_VALUE,$NUM.parseNumeric(constVal));}this.writeGlobalProperty(ENUM_XML_TAG.REF_LINE_DEF,currentProp,refOpt);},copyRefLineInfoForSwap:function copyRefLineInfoForSwap(){var gmCtr=this.GMController,chtInfo=gmCtr.getChartInfo(),dua=0;if(!chtInfo.isABL||!gmCtr.isStacked||gmCtr.splitPlottingMetrics){return[];}var opts=this.getReferenceAxisOption(),axisKey,me=this,actions=[];if(opts){$ARR.forEach(opts,function(opt){axisKey=opt.key;if(axisKey==="YAxis"||axisKey==="Y2Axis"||axisKey==="XAxis"||axisKey==="X2Axis"){dua=axisKey.search("2")>=0?1:0;if(!gmCtr.hasRefLineInOppositeAxis(dua)){var refs=me.getEnabledReferenceLineOptions(opt);$ARR.forEach(refs,function(ref){var currentProp=me.readGlobalProperty(ENUM_XML_TAG.REF_LINE_DEF,ref),jsonObj=currentProp.jsonObj;jsonObj.dropzoneId=(axisKey==="YAxis"||axisKey==="Y2Axis")?4:3;jsonObj.subAxis=dua;if(jsonObj.refEnabled){var jsonObjNew=$HASH.clone(jsonObj);jsonObjNew.dropzoneId=jsonObj.dropzoneId===3?4:3;me.collectAddRefLineAction(jsonObjNew,actions);}});}}});}return actions;},updateAfterKeepOnlyAndShow:function updateAfterKeepOnlyAndShow(drillUnit,fromUnit){var me=this,ROWS=1,COLUMNS=2,XAXIS=3,YAXIS=4,BREAKBY=5;var model=me.model,docModel=me.getDocModel(),dataService=docModel.getDataService(),update=dataService.newUpdate(this);var updateTemplateActions={act:"updateTemplate",keyContext:me.k,actions:[]},posIdx,keepParent=true,tplActArr=updateTemplateActions.actions,gmCtr=me.GMController,chtInfo=gmCtr.getChartInfo(),chtType=chtInfo.tp,dzModel=me.zonesModel,nonCombinedDzModel=dzModel.gmZones,unitItem={did:undefined,t:12},argumentZone={id:undefined,items:[]},naiveCallback=dzModel.getUpdateCallback(),callback=this.getXTabRefreshCallBack();if(fromUnit){argumentZone.id=fromUnit.isRowAttribute?ROWS:COLUMNS;unitItem.did=drillUnit.did;unitItem.t=drillUnit.t;if(docModel.prefs&&docModel.prefs.rtprnt){keepParent=parseInt(docModel.prefs.rtprnt,10)===1;}else{if(model.xtab.defn.tkp!==undefined){keepParent=parseInt(model.xtab.defn.tkp,10)===-1;}}var fromUnitItem,zone=nonCombinedDzModel.getZoneModelByZoneId(argumentZone.id);zone.items.forEach(function(it){if(it.did===fromUnit.tid){fromUnitItem=it;return false;}});if(keepParent){tplActArr.push(dzModel.getAddDZUnitAction(argumentZone,unitItem,fromUnitItem?fromUnitItem.uidx+1:0));}else{if(fromUnitItem){tplActArr.push(nonCombinedDzModel.getRemoveDropZoneUnitAction(argumentZone,fromUnitItem));tplActArr.push(dzModel.getAddDZUnitAction(argumentZone,unitItem,fromUnitItem.uidx));}}}else{if(chtType===CHART_TYPE.BUBBLE||chtType===CHART_TYPE.SCATTER){argumentZone.id=BREAKBY;unitItem.did=drillUnit.did;unitItem.t=drillUnit.t;posIdx=nonCombinedDzModel.getItemCountInZone(argumentZone.id);tplActArr.push(dzModel.getAddDZUnitAction(argumentZone,unitItem,posIdx));}else{if(chtInfo.isABL||chtType===CHART_TYPE.GRID){if(chtType===CHART_TYPE.GRID||chtInfo.dirc===mstrmojo.gm.EnumABLDirection.VERTICAL){$ARR.forEach(dzModel.moveAttributesToZone(XAXIS,COLUMNS),function(act){tplActArr.push(act);});argumentZone.id=XAXIS;unitItem.did=drillUnit.did;unitItem.t=drillUnit.t;tplActArr.push(dzModel.getAddDZUnitAction(argumentZone,unitItem,0));}else{$ARR.forEach(dzModel.moveAttributesToZone(YAXIS,ROWS),function(act){tplActArr.push(act);});argumentZone.id=YAXIS;unitItem.did=drillUnit.did;unitItem.t=drillUnit.t;tplActArr.push(dzModel.getAddDZUnitAction(argumentZone,unitItem,0));}}}}update.add(updateTemplateActions,$WRAP(naiveCallback,callback));var selections=me.getSelections(),selectorData=model.getSelectorDataFromViewFilter(me.model.data.vfexpr).concat({keepOnly:true,data:selections}),toolbarCallback=getToolbarUpdateCallback.call(me),ko=model.getKeepOnlyActionsForAssociatedNodes(selectorData,toolbarCallback);if(selections&&selections.length>0){update.add(ko.actions,ko.callback);}cmdMgr(me).execute({execute:function execute(){this.submitUpdate(update);},urInfo:{callback:update.callback}});},isClearAllDisabled:function isClearAllDisabled(){var sc=this.findSelectorControl();if(!!sc&&!sc.showall){return true;}return false;},execFormatHandler:function(){var interactor=this.interactor;if(interactor){interactor.formatHandler();}},onNDECreated:function(deItems){var de=deItems[0],rc=this.model.data.gts.row.concat(this.model.data.gts.col),element;this.clearSelections();$ARR.forEach(rc,function(unit){if((unit.t===47||unit.otp===47)&&unit.ost===12033&&unit.id===de.unitId){$ARR.forEach(unit.es,function(elem){if(elem.n===de.n&&elem.id&&elem.id.indexOf(de.id)>-1){element=elem;}if(element){return false;}});if(element){return false;}}});if(element){this.addAttributeSelection(de.unitId,element.id,element.n);this.interactor.doHighlight($MOJO.vi.ui.rw.SelectionType.ATTS,$HASH.clone(this.getSelectionHash()));}},checkCustomScaleNotificationForTrendLine:function(metricId){if(this.checkCustomScale(metricId)){this.trendLineNotifications.push(mstrmojo.desc(14443,"The trend line might not be displayed, as a custom scale has been applied to this metric."));}},checkCustomScaleNotificationForReferenceLine:function(metricId){if(this.checkCustomScale(metricId)){this.referenceLineNotifications.push(mstrmojo.desc(14444,"The reference line might not be displayed, as a custom scale has been applied to this metric."));}}});}());