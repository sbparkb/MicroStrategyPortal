(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.warehouse.obj.DBRole","mstrmojo.warehouse.EnumDataChangeEvents");var $A=mstrmojo.array,$ENUM_DATA_CHANGE_EVENTS=mstrmojo.warehouse.EnumDataChangeEvents,STR_SELECT_DBROLE=mstrmojo.desc(12240,"Please select a data source");mstrmojo.architect.ui.editors.DBRolePicker=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.DBRolePicker",cssClass:"mstrmojo-wh-DBRolePicker",id:"DBRolePicker",title:mstrmojo.desc(11387,"Primary Data Source"),callback:undefined,newDBRole:undefined,dbrList:undefined,postCreate:function postCreate(){var $this=this;this.model.attachEventListener($ENUM_DATA_CHANGE_EVENTS.DBROLES_LOADED.toString(),this.id,function(){if(!$this.visible){return ;}var dbroles=mstrApp.getRootController().getDBRoles().sort(function sortFunc(a,b){return $A.stringSorter(a.n,b.n);}),idx=$A.find(dbroles,"n",$this.newDBRole.mdDBRole.n);$this.dbrList.set("items",dbroles);$this.dbrList.set("selectedIndex",idx);});},onOpen:function onOpen(){var dbRoles=mstrApp.getRootController().getDBRoles().sort(function sortFunc(a,b){return $A.stringSorter(a.n,b.n);});this.dbrList.set("items",dbRoles);if(dbRoles.length>0){this.dbrList.set("selectedIndex",0);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRolePickerLabel",text:mstrmojo.desc(11388,"Please select a Primary Data Source for this project")},{scriptClass:"mstrmojo.Label",alias:"newDBRolebtn",cssClass:"mstrmojo-wh-addDB",title:mstrmojo.desc(11131,"New data source"),onclick:function onclick(){var $this=this;mstrApp.getRootController().editDBRole(undefined,{success:function success(dbrole){$this.parent.newDBRole=dbrole;}});}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"dbrList",cssClass:"mstrmojo-wh-DBRolePickerList"},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button rightfloat",text:mstrmojo.desc(1442,"OK"),onclick:function(){var e=this.parent.parent,item=e.dbrList.items[e.dbrList.selectedIndex];if(!item){mstrmojo.alert(STR_SELECT_DBROLE);}else{e.close();if(e.callback&&e.callback.success){e.callback.success(e.dbrList.items[e.dbrList.selectedIndex].did);}}}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var e=this.parent.parent;e.close();mstrApp.getRootController().navigateProject();}}]}]});}());