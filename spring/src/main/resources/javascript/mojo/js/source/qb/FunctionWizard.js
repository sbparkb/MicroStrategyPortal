(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.ObjectInputBox","mstrmojo.DataGrid","mstrmojo.Editor");mstrmojo.requiresDescs(221,629,945,1442,1825,3095,4114,4115,4563,5298,8246,9125,12173,12916,12918,12947);var _H=mstrmojo.hash,E=mstrmojo.expr,_brackets=mstrmojo.ME.MetricToken.brackets,_DTPBuilder=function(d){var w=null;if(d.isParam){w={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",alias:"paramInput",slot:"0,0",itemValidationField:"_did_",item2textCss:function item2textCss(data){return" mstrmojo-qb-SuggestIcon t"+data.t;},hideEditButton:function(){return false;},browseItemVisible:false,dynamicVerify:false,emptyText:mstrmojo.desc(9125,"Type here to input columns..."),postCreate:function(refresh){var grid=this.parent.dataGrid,fw=grid&&grid.parent;this.candidates=fw.getCandidates(function(item){return item.t===26;});if(!refresh){grid.candidatesListener.push(this);}this.autoSelect=false;this.openPopup("suggestionPopup");this.suggestionPopup.close();this.autoSelect=true;}}],onParamAdded:function(oi){var editor=this.dataGrid.parent,input=this.paramInput;editor.closePopup();oi.state=0;input.add([oi],input.items.length-1);},getTokens:function(){var its=this.paramInput.getSelectedObjects(),len=its.length,i,tks=[],t;if(len>0){for(i=0;i<len;i++){if(its[i].state===mstrmojo.Enum_OIB_States.VALID){t={v:_brackets(its[i].n)};t.oi=its[i];}else{t={v:its[i].n};}tks.push(t);tks.push({v:",",isDelimiter:true});}tks.pop();}return tks;}};var piw=w.children[0];if(!d.isRepeated){piw.cssClass="mstrmojo-ObjectInputBox singleObject noVerify";piw.maxObjectCount=1;}else{piw.cssClass="mstrmojo-ObjectInputBox noVerify";}}else{switch(d&&d.dtp){case 11:w={scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-functionArgs-pulldown mstrmojo-Pulldown",items:[{n:mstrmojo.desc(4115,"False"),did:"0"},{n:mstrmojo.desc(4114,"True"),did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(props){this.value=this.data.dfv||0;},getTokens:function(){var d=this.data;if(this.value!==d.dfv){return[{v:d.n},{v:"=",isDelimiter:true},{v:String(this.value)==="-1"?"True":"False"}];}return[];}};break;case -2:w={scriptClass:"mstrmojo.Table",cssClass:"breakBy",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",slot:"0,0",alias:"breakByInput",item2textCss:function item2textCss(data){return(this._super&&this._super(data))||{12:"a","-99":"br"}[data.t]||"";},emptyText:mstrmojo.desc(12916,"Type here to input breakby attributes..."),noEditButton:true,browseItemVisible:true,folderLinksContextId:16,browsableTypes:[E.TP.FOLDER,E.TP.ATTR].join(","),getCandidatesThroughTaskCall:function getCandidatesThroughTaskCall(params,callbacks){mstrmojo.ME.MetricDataService.getAttributes(params,callbacks);},postCreate:function(refresh){var grid=this.parent.dataGrid,fw=grid&&grid.parent;this.candidates=fw.getCandidates(function(item){return item.t===12;});if(!refresh){grid.candidatesListener.push(this);}}},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var editor=this.parent.parent.dataGrid.parent;editor.openPopup("ob",{zIndex:editor.zIndex+10});var ob=editor.ob.browser;ob.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onBreakByAdded"],browsableTypes:[E.TP.ATTR,E.TP.FOLDER].join(",")});}}]}],onBreakByAdded:function(oi){var editor=this.dataGrid.parent,input=this.breakByInput;editor.closePopup();input.add([oi],input.items.length-1);},getTokens:function(){var its=this.breakByInput.getSelectedObjects(),len=its.length,i,tks=[];if(len>0){tks.push({v:"BreakBy"});tks.push({v:"=",isDelimiter:true});tks.push({v:"{",isDelimiter:true});for(i=0;i<len;i++){tks.push({v:_brackets(its[i].n),oi:its[i]});if(i!==(len-1)){tks.push({v:",",isDelimiter:true});}}tks.push({v:"}",isDelimiter:true});}return tks;}};break;case -1:w={scriptClass:"mstrmojo.Table",cssClass:"sortBy",layout:[{cells:[{cssText:"width: 330px"},{}]}],getTokens:function(){var its=this.sortByGrid.items,len=its.length,i,tks=[];if(len>0){tks.push({v:"SortBy"});tks.push({v:"=",isDelimiter:true});tks.push({v:"(",isDelimiter:true});for(i=0;i<len;i++){var it=its[i],sit=it.selFrm||(it.dssforms&&it.dssforms[0]),tk={v:_brackets(it.n),oi:it};if(sit&&parseInt(it.t,10)===12){_H.copy({v:_brackets(it.n)+"@"+_brackets(sit.n),exv:sit.dssid,extp:sit.dtp},tk);}tks.push(tk);if(i!==(len-1)){tks.push({v:",",isDelimiter:true});}}tks.push({v:")",isDelimiter:true});}return tks;},children:[{scriptClass:"mstrmojo.DataGrid",slot:"0,0",cssClass:"mstrmojo-functionArgs-sort",alias:"sortByGrid",renderOnScroll:false,resizableColumns:true,makeObservable:true,itemDisplayField:"n",columns:[{headerText:mstrmojo.desc(945,"Name"),dataField:"n",colCss:"nmCol"},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(3095,"Order"),dataField:"order",colCss:"ordCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.asc=this.value;}}},{dataWidget:{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(evt){this.dataGrid.remove(this.data);}},headerText:"&nbsp",colCss:"actionsCol"}]},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var editor=this.parent.parent.dataGrid.parent;editor.openPopup("ob",{zIndex:editor.zIndex+10});var ob=editor.ob.browser;ob.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onSortByAdded"],browsableTypes:[E.TP.ATTR,E.TP.METRIC,E.TP.FOLDER].join(",")});}}]}],onSortByAdded:function(oi){var editor=this.dataGrid.parent,sbg=this.sortByGrid;editor.closePopup();if(oi){switch(oi.t){case 12:var success=function(res){if(res){var ctr=res.container;if(ctr&&ctr.dssforms){oi.dssforms=ctr.dssforms;sbg.add([oi]);}}},failure=function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:oi.did,displayedForms:0},{success:success,failure:failure});break;case 4:oi.dssforms=[{n:"Value"}];default:sbg.add([oi]);}}}};break;default:w={scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(props){var d=this.data;this.value=(d.dfv||d.dfv===0)?d.dfv:"";},getTokens:function(){var d=this.data;if(this.value!==d.dfv){return[{v:d.n},{v:"=",isDelimiter:true},{v:this.value}];}return[];}};break;}}w.alias="inputWidget";return w;},_PROPFunction=function(d,idx,dataGrid){return'<div class="mstrmojo-DataRow-text"title="'+(d.desc||"")+'">'+d.n+(d.isParam?"*":"")+":</div>";};mstrmojo.qb.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FunctionWizard",init:function init(props){this._super(props);this.help=this.help||(mstrApp&&mstrApp.helpTopics&&mstrApp.helpTopics.fnWiz);},cssClass:"mstrmojo-FunctionWidzard",title:mstrmojo.desc(4563,"Function Arguments"),help:"",fctOi:null,fctArgs:null,fctSyntax:"",bindings:{candidates:"this.opener.candidates"},getCandidates:function getCandidates(f){var cs=this.candidates,its;if(cs){its=mstrmojo.array.filter(cs.items,f);return{items:its,isComplete:cs.isComplete};}return null;},_set_candidates:function(n,v){this.candidates=v;if(this.hasRendered&&this.visible){var grid=this.argsGrid,listeners=grid.candidatesListener,len=listeners.length,i;for(i=0;i<len;i++){listeners.postCreate(true);}}return true;},onOpen:function(){var me=this,taskParams,success=function(res){if(res){me.set("fctOi",res);var ps=[],i,len,p,syntax=[];syntax.push(res.n);syntax.push("(");len=(res.pars&&res.pars.length)||0;for(i=0;i<len;i++){p=_H.copy(res.pars[i]);p.isParam=true;ps.push(p);syntax.push(res.pars[i].n);if(i!==(len-1)){syntax.push(", ");}}syntax.push(")");if(res.rpc>0){p.isRepeated=true;}len=(res.pros&&res.pros.length)||0;if(res.did==="6F7DF5FF449111D5BEA300B0D01A55EF"){len=0;}for(i=0;i<len;i++){if(res.pros[i].n!=="UseLookupForAttributes"){ps.push(_H.copy(res.pros[i]));}}if(res.sqt===5){ps.push({n:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:mstrmojo.desc(12918,"Break By is a parameter representing the break by levels for this function.")});}me.set("fctArgs",ps);me.set("fctSyntax",syntax.join(""));}mstrmojo.css.removeClass(me.argsGrid.domNode,["loading"]);},failure=function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));mstrmojo.css.removeClass(this.argsGrid.domNode,["loading"]);};this.argsGrid.set("items",[]);mstrmojo.css.addClass(this.argsGrid.domNode,["loading"]);this.set("fctSyntax","");this.set("title",mstrmojo.desc(12947,"Function arguments for:")+this.fctOi.n);taskParams={functionId:this.fctOi.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};mstrApp.getRootController().getDataService().getFunctionDetails({success:success,failure:failure},taskParams);},getTokens:function getTokens(){var rs=this.argsGrid.ctxtBuilder.itemWidgets,len=rs.length,i,w,props=[],params=[],tks=[],a,j,l,anyProp,oi=this.fctOi;for(i=0;i<len;i++){w=rs[i].inputWidget;if(w.data.isParam){params.push(w.getTokens());}else{props.push(w.getTokens());}}tks.push({v:oi.n,oi:oi});len=props.length;if(len>0){anyProp=false;tks.push({v:"<",isDelimiter:true});for(i=0;i<len;i++){a=props[i];l=a.length;if(l===0){continue;}anyProp=true;for(j=0;j<l;j++){tks.push(a[j]);}tks.push({v:",",isDelimiter:true});}tks.pop();if(anyProp){tks.push({v:">",isDelimiter:true});}}len=params.length;tks.push({v:"(",isDelimiter:true});anyProp=false;for(i=0;i<len;i++){a=params[i];l=a.length;if(l===0){continue;}anyProp=true;for(j=0;j<l;j++){tks.push(a[j]);}tks.push({v:",",isDelimiter:true});}if(anyProp){tks.pop();}tks.push({v:")",isDelimiter:true});return tks;},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},children:[{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:"functionArgs",banding:false,columns:[{headerText:"Property Name",dataFunction:_PROPFunction,colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:_DTPBuilder,colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-syntaxLabel",text:"",bindings:{text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-descLabel",text:"",bindings:{text:function(){return this.parent.fctOi.desc;}}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-FW-buttonBox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var e=this.parent.parent;if(e.insertOnFinish){e.insertOnFinish(e.getTokens());}e.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var e=this.parent.parent;e.close();}}]}]});}());