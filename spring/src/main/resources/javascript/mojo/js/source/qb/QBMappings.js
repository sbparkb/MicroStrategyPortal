(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.qb.QBSimplePreview");mstrmojo.requiresDescs(13033,12419);var $DESC=mstrmojo.desc;var $QBMAPPINGS;mstrmojo.qb.QBMappings=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBMappings",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},cssClass:"mstrmojo-di-datapreview",cssText:"position:relative;overflow:hidden;border-bottom-right-radius:6px;border-bottom-left-radius:6px;padding:0px;",width:0,height:0,dropZone:false,active:false,children:[{scriptClass:"mstrmojo.Box",alias:"previewInfo",cssClass:"mstrmojo-qb-preview-info",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-preview-text">'+$DESC(13033,"Sample Preview")+'</span><span class="mstrmojo-qb-preview-menu" mstrAttach:click></span></div>',visible:false,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.domNode.lastChild.style.display=(mstrApp.isFFSQL||mstrApp.isFFSQLMode)?"none":"block";}},onclick:function onclick(){$QBMAPPINGS.showPopupMenu(this.parent,{menuNode:this.domNode.lastChild});}},{scriptClass:"mstrmojo.qb.QBSimplePreview",alias:"content",columns:[],cssText:"width:100%"},{scriptClass:"mstrmojo.Label",alias:"notice",cssClass:"warnLabel",text:$DESC(12419,"No preview available.")}],init:function init(props){var evtConfig,listConfig;this._super(props);evtConfig={};listConfig=evtConfig[this.id]={};listConfig.dataPreview=this.handleDataPreview;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},handleDataPreview:function handleDataPreview(evt){mstrApp.getRootController().toggleDataPreview(true);var content=this.content,notice=this.notice,mappings=evt.mappings,dataset=evt.dataset,selectedColumns=evt.selectedColumns,isRefined=evt.isRefined,hasMapping=(mappings&&mappings.length>0);content.mappings=mappings;content.dataset=dataset;content.selectedColumns=selectedColumns;content.isRefined=isRefined;content.set("visible",hasMapping);notice.set("visible",!hasMapping);this.previewInfo.set("visible",hasMapping);hasMapping&&content.populatePreview();},onheightChange:function(e){if(this.domNode){var currentHeight=Math.max(parseInt(e.value,10)-2,0),previewInfoHeight=38,contentHeight;this.domNode.style.height=currentHeight+"px";contentHeight=Math.max(currentHeight-previewInfoHeight,0);this.content.set("height",contentHeight+"px");}},onwidthChange:function onwidthChange(e){if(this.domNode){var currentWidth=parseInt(e.value,10)+"px";if(currentWidth!=="NaNpx"){this.domNode.style.width=currentWidth;this.content.set("width",currentWidth);}}}});function deleteAllColumns(){mstrApp.getRootController().deleteAllColumns();}$QBMAPPINGS=mstrmojo.qb.QBMappings;$QBMAPPINGS.showPopupMenu=function showPopMenu(qbMapping,itemInfo){var menuHelper=$QBMAPPINGS.menuHelper=$QBMAPPINGS.menuHelper||new mstrmojo.qb.QBPreviewMenu();menuHelper.target=qbMapping;var cfg=menuHelper.getMenuConfig();cfg.hostId=qbMapping.id;cfg.hostElement=itemInfo.menuNode;cfg.isHostedWithin=false;cfg.position=mstrmojo.dom.position(itemInfo.menuNode,true);qbMapping.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:cfg}));};mstrmojo.qb.QBPreviewMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.DBTableRowMenu",menuCssClass:"mstrmojo-qb-DBTableRowMenu",menuCfg:null,getMenuConfig:function(){var cfg=this.menuCfg;if(!cfg){cfg=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{cfg.clear();}cfg.addMenuItem($DESC(5186,"Delete All"),"",deleteAllColumns);return cfg;}});})();