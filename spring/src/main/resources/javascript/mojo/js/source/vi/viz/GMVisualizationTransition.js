(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.gm.GMEnums","mstrmojo.gm.EnumShape");mstrmojo.requiresClsP("mstrmojo.vi.viz","KnownVisualizations","EnumVisualizationTemplates","VisualizationTransition","GraphMatrixHelper","HeatMapVisualizationHelper","NetworkVisualizationHelper","ImageLayoutHelper","ESRIMapHelper","GoogleMapHelper");var $MOJO=mstrmojo,$GM=mstrmojo.gm,$ARR=$MOJO.array,$HASH=$MOJO.hash,$VIZ=$MOJO.vi.viz,$KNOWN_VIZ=$VIZ.KnownVisualizations,$VIZTEMPLATES=$VIZ.EnumVisualizationTemplates,$GMH=$VIZ.GraphMatrixHelper,$DSSOBJ_TYPES=mstrmojo.chart.model.enums.EnumDSSObjectType,$GRID="Grid",$SHAPE_TYPES=$GM.EnumShape,$SAB=$GM.DualAxisSubAxisBit,AXIS_PRIMARY=$SAB.PRIMARY,AXIS_SECONDARY=$SAB.SECONDARY,ENUM_DZID=$VIZ.EnumDSSDropZones,XAXIS=ENUM_DZID.XAxis,YAXIS=ENUM_DZID.YAxis,ANGLEBY=ENUM_DZID.Angle,COLORBY=ENUM_DZID.ColorBy,METRIC_NAMES_VISIBLE_THRESH=1;var GRAPHMATRIXVERTICALBARAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXVERTICALBARAUTOMATIC,GRAPHMATRIXVERTICALLINEAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXVERTICALLINEAUTOMATIC,GRAPHMATRIXVERTICALAREAAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXVERTICALAREAAUTOMATIC,GRAPHMATRIXVERTICALBARSTACKED=$VIZTEMPLATES.GRAPHMATRIXVERTICALBARSTACKED,GRAPHMATRIXVERTICALLINESTACKED=$VIZTEMPLATES.GRAPHMATRIXVERTICALLINESTACKED,GRAPHMATRIXVERTICALAREASTACKED=$VIZTEMPLATES.GRAPHMATRIXVERTICALAREASTACKED,GRAPHMATRIXBUBBLECIRCLEMM=$VIZTEMPLATES.GRAPHMATRIXBUBBLECIRCLEMM,GRAPHMATRIXBUBBLESQUAREMM=$VIZTEMPLATES.GRAPHMATRIXBUBBLESQUAREMM,GRAPHMATRIXSCATTERCIRCLEMM=$VIZTEMPLATES.GRAPHMATRIXSCATTERCIRCLEMM,GRAPHMATRIXSCATTERSQUAREMM=$VIZTEMPLATES.GRAPHMATRIXSCATTERSQUAREMM,GRAPHMATRIXBUBBLEGRIDCIRCLEAA=$VIZTEMPLATES.GRAPHMATRIXBUBBLEGRIDCIRCLEAA,GRAPHMATRIXBUBBLEGRIDSQUAREAA=$VIZTEMPLATES.GRAPHMATRIXBUBBLEGRIDSQUAREAA,GRAPHMATRIXSCATTERGRIDCIRCLEAA=$VIZTEMPLATES.GRAPHMATRIXSCATTERGRIDCIRCLEAA,GRAPHMATRIXSCATTERGRIDSQUAREAA=$VIZTEMPLATES.GRAPHMATRIXSCATTERGRIDSQUAREAA,GRAPHMATRIXVERTICALBARCLUSTERED=$VIZTEMPLATES.GRAPHMATRIXVERTICALBARCLUSTERED,GRAPHMATRIXVERTICALLINECLUSTERED=$VIZTEMPLATES.GRAPHMATRIXVERTICALLINECLUSTERED,GRAPHMATRIXVERTICALAREACLUSTERED=$VIZTEMPLATES.GRAPHMATRIXVERTICALAREACLUSTERED,GRAPHMATRIXVERTICALBARPERCENT=$VIZTEMPLATES.GRAPHMATRIXVERTICALBARPERCENT,GRAPHMATRIXVERTICALLINEPERCENT=$VIZTEMPLATES.GRAPHMATRIXVERTICALLINEPERCENT,GRAPHMATRIXVERTICALAREAPERCENT=$VIZTEMPLATES.GRAPHMATRIXVERTICALAREAPERCENT,GRAPHMATRIXHORIZONTALBARAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBARAUTOMATIC,GRAPHMATRIXHORIZONTALLINEAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALLINEAUTOMATIC,GRAPHMATRIXHORIZONTALAREAAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALAREAAUTOMATIC,GRAPHMATRIXHORIZONTALBARCLUSTERED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBARCLUSTERED,GRAPHMATRIXHORIZONTALLINECLUSTERED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALLINECLUSTERED,GRAPHMATRIXHORIZONTALAREACLUSTERED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALAREACLUSTERED,GRAPHMATRIXHORIZONTALBARSTACKED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBARSTACKED,GRAPHMATRIXHORIZONTALLINESTACKED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALLINESTACKED,GRAPHMATRIXHORIZONTALAREASTACKED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALAREASTACKED,GRAPHMATRIXHORIZONTALBARPERCENT=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBARPERCENT,GRAPHMATRIXHORIZONTALLINEPERCENT=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALLINEPERCENT,GRAPHMATRIXHORIZONTALAREAPERCENT=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALAREAPERCENT,GRAPHMATRIXPIE=$VIZTEMPLATES.GRAPHMATRIXPIE,GRAPHMATRIXRING=$VIZTEMPLATES.GRAPHMATRIXRING,GRAPHCOMBINATIONBARAREA=$VIZTEMPLATES.GRAPHCOMBINATIONBARAREA,GRAPHCOMBINATIONBARAREADUALAXIS=$VIZTEMPLATES.GRAPHCOMBINATIONBARAREADUALAXIS,GRAPHMATRIXBUBBLESQUAREAM=$VIZTEMPLATES.GRAPHMATRIXBUBBLESQUAREAM,GRAPHMATRIXSCATTERSQUAREAM=$VIZTEMPLATES.GRAPHMATRIXSCATTERSQUAREAM;var UNIT_TYPE_NONMETRIC="nm",UNIT_TYPE_METRIC="m",UNIT_TYPE_NONE="none",UNIT_TYPE_ANY="any",UNIT_TYPE_TOGGLE="toggle",METRICS_IN_ANY="MetricsInAny",METRICS_IN_NONE="MetricsInNone";function getTemplateInfo(node){var gsi=$HASH.copy(node.data.gsi),whichMetricsAxis=gsi.tma===1?"rows":"cols",metricsAxis=gsi[whichMetricsAxis],mx=gsi.mx;gsi[whichMetricsAxis]=metricsAxis.filter(function(unit){return unit.t!==-1&&unit.did!=="-1";});if(mx){mx.forEach(function(m){m.t=4;});}return gsi;}function removeFromCollection(obj){var ti=this.templateInfo,i;for(i=0;i<ti.rows.length;i++){if(ti.rows[i].did===obj.id){ti.rows.splice(i,1);return ;}}for(i=0;i<ti.cols.length;i++){if(ti.cols[i].did===obj.id){ti.cols.splice(i,1);return ;}}for(i=0;i<ti.mx.length;i++){if(ti.mx[i].did===obj.id){ti.mx.splice(i,1);return ;}}}function addDropZonesNode(defn,metricsDropZone){defn.MetricsDropZone=metricsDropZone;}function addDropZoneNode(defn,dropZoneId,unitType,min){defn.Zones[dropZoneId]={type:unitType,min:min};}function addPropertiesNode(defn,propertyName,propertyValue){defn.Properties[propertyName]=propertyValue;}function getDropZoneFromDefn(defn,dropZoneId){return defn.Zones[dropZoneId];}function getDefinition(templateID){var defn={Zones:[],Properties:[]};switch(templateID){case GRAPHMATRIXBUBBLECIRCLEMM:case GRAPHMATRIXBUBBLESQUAREMM:addDropZonesNode(defn,METRICS_IN_ANY);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_SIZEBY,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_BREAKBY,UNIT_TYPE_ANY,1);addDropZoneNode(defn,$GMH.PROP_COLORBY,UNIT_TYPE_ANY,0);break;case GRAPHMATRIXSCATTERCIRCLEMM:case GRAPHMATRIXSCATTERSQUAREMM:addDropZonesNode(defn,METRICS_IN_ANY);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_SIZEBY,UNIT_TYPE_NONE,1);addDropZoneNode(defn,$GMH.PROP_BREAKBY,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_COLORBY,UNIT_TYPE_NONMETRIC,0);break;case GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case GRAPHMATRIXBUBBLEGRIDSQUAREAA:addDropZonesNode(defn,METRICS_IN_NONE);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_BREAKBY,UNIT_TYPE_NONE,0);addDropZoneNode(defn,$GMH.PROP_SIZEBY,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXSCATTERGRIDCIRCLEAA:case GRAPHMATRIXSCATTERGRIDSQUAREAA:addDropZonesNode(defn,METRICS_IN_NONE);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_BREAKBY,UNIT_TYPE_NONE,0);addDropZoneNode(defn,$GMH.PROP_SIZEBY,UNIT_TYPE_NONE,0);addDropZoneNode(defn,$GMH.PROP_COLORBY,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXVERTICALBARAUTOMATIC:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXVERTICALAREAAUTOMATIC:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXVERTICALBARCLUSTERED:case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALAREACLUSTERED:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXVERTICALBARSTACKED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALAREASTACKED:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXVERTICALBARPERCENT:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXVERTICALAREAPERCENT:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXHORIZONTALBARAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);break;case GRAPHMATRIXHORIZONTALBARCLUSTERED:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALAREACLUSTERED:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);break;case GRAPHMATRIXHORIZONTALBARSTACKED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALAREASTACKED:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);break;case GRAPHMATRIXHORIZONTALBARPERCENT:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXHORIZONTALAREAPERCENT:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);break;case GRAPHMATRIXPIE:case GRAPHMATRIXRING:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_SLICE,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_ANGLE,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_COLORBY,UNIT_TYPE_NONMETRIC,0);break;case GRAPHCOMBINATIONBARAREA:case GRAPHCOMBINATIONBARAREADUALAXIS:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;}switch(templateID){case GRAPHMATRIXBUBBLECIRCLEMM:case GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case GRAPHMATRIXSCATTERCIRCLEMM:case GRAPHMATRIXSCATTERGRIDCIRCLEAA:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_CIRCLE);break;case GRAPHMATRIXBUBBLESQUAREAM:case GRAPHMATRIXBUBBLESQUAREMM:case GRAPHMATRIXBUBBLEGRIDSQUAREAA:case GRAPHMATRIXSCATTERSQUAREAM:case GRAPHMATRIXSCATTERSQUAREMM:case GRAPHMATRIXSCATTERGRIDSQUAREAA:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_SQUARE);break;case GRAPHMATRIXVERTICALBARCLUSTERED:case GRAPHMATRIXVERTICALBARSTACKED:case GRAPHMATRIXVERTICALBARPERCENT:case GRAPHMATRIXHORIZONTALBARCLUSTERED:case GRAPHMATRIXHORIZONTALBARSTACKED:case GRAPHMATRIXHORIZONTALBARPERCENT:case GRAPHMATRIXVERTICALBARAUTOMATIC:case GRAPHMATRIXHORIZONTALBARAUTOMATIC:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_BAR);break;case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_LINE);break;case GRAPHMATRIXVERTICALAREACLUSTERED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXVERTICALAREAPERCENT:case GRAPHMATRIXHORIZONTALAREACLUSTERED:case GRAPHMATRIXHORIZONTALAREASTACKED:case GRAPHMATRIXHORIZONTALAREAPERCENT:case GRAPHMATRIXVERTICALAREAAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_AREA);break;case GRAPHMATRIXPIE:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_PIE);break;case GRAPHMATRIXRING:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_RING);break;case GRAPHCOMBINATIONBARAREADUALAXIS:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_BAR);break;}switch(templateID){case GRAPHMATRIXVERTICALBARCLUSTERED:case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALAREACLUSTERED:case GRAPHMATRIXHORIZONTALBARCLUSTERED:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALAREACLUSTERED:addPropertiesNode(defn,$GMH.PROP_SUBTYPE,$GMH.PROP_SUBTYPE_CLUSTERED);break;case GRAPHMATRIXVERTICALBARSTACKED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXHORIZONTALBARSTACKED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALAREASTACKED:addPropertiesNode(defn,$GMH.PROP_SUBTYPE,$GMH.PROP_SUBTYPE_STACKED);break;case GRAPHMATRIXVERTICALBARPERCENT:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXVERTICALAREAPERCENT:case GRAPHMATRIXHORIZONTALBARPERCENT:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXHORIZONTALAREAPERCENT:addPropertiesNode(defn,$GMH.PROP_SUBTYPE,$GMH.PROP_SUBTYPE_PERCENT);break;case GRAPHMATRIXPIE:case GRAPHMATRIXRING:case GRAPHMATRIXVERTICALBARAUTOMATIC:case GRAPHMATRIXHORIZONTALBARAUTOMATIC:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case GRAPHMATRIXVERTICALAREAAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:case GRAPHCOMBINATIONBARAREADUALAXIS:addPropertiesNode(defn,$GMH.PROP_SUBTYPE,$GMH.PROP_SUBTYPE_AUTOMATIC);break;}return defn;}function isValidUnit(object,type,definition){if(type===UNIT_TYPE_NONE){return false;}if(type===UNIT_TYPE_ANY){return true;}if((object.t===$DSSOBJ_TYPES.DssTypeMetric)&&(type===UNIT_TYPE_METRIC)){return true;}if((object.t!==$DSSOBJ_TYPES.DssTypeMetric)&&(type===UNIT_TYPE_NONMETRIC)){return true;}if(type===UNIT_TYPE_TOGGLE){var dropZone=getDropZoneFromDefn(definition,$GMH.PROP_XAXIS);if((dropZone&&dropZone.t===UNIT_TYPE_METRIC)&&(object.t!==$DSSOBJ_TYPES.DssTypeMetric)){return true;}if((dropZone&&dropZone.t===UNIT_TYPE_NONMETRIC)&&(object.t===$DSSOBJ_TYPES.DssTypeMetric)){return true;}return false;}return false;}function isHorizontalGraphMatrix(templateID){var result=false;switch(templateID){case GRAPHMATRIXHORIZONTALBARCLUSTERED:case GRAPHMATRIXHORIZONTALBARSTACKED:case GRAPHMATRIXHORIZONTALBARPERCENT:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXHORIZONTALAREACLUSTERED:case GRAPHMATRIXHORIZONTALAREASTACKED:case GRAPHMATRIXHORIZONTALAREAPERCENT:case GRAPHMATRIXHORIZONTALBARAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:result=true;break;default:break;}return result;}function isBubbleOrScatterGraphMatrix(templateID){var result=false;switch(templateID){case GRAPHMATRIXBUBBLECIRCLEMM:case GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case GRAPHMATRIXBUBBLESQUAREAM:case GRAPHMATRIXBUBBLESQUAREMM:case GRAPHMATRIXBUBBLEGRIDSQUAREAA:case GRAPHMATRIXSCATTERCIRCLEMM:case GRAPHMATRIXSCATTERGRIDCIRCLEAA:case GRAPHMATRIXSCATTERSQUAREAM:case GRAPHMATRIXSCATTERSQUAREMM:case GRAPHMATRIXSCATTERGRIDSQUAREAA:result=true;break;default:break;}return result;}function isComboGraphMatrix(templateID){return(templateID===GRAPHCOMBINATIONBARAREA||templateID===GRAPHCOMBINATIONBARAREADUALAXIS);}function addAttributeToZone(newGMHelper,_rows,_cols,zone,dropZone){if(_rows.length+_cols.length>=dropZone.min){if(_cols.length){newGMHelper[zone].push(_cols.pop());}else{if(_rows.length){newGMHelper[zone].push(_rows.pop());}}}}function addAttributes(definition,newGMHelper,newTemplateID){var gsi=this.templateInfo,rows=gsi.rows,cols=gsi.cols,dropZone=getDropZoneFromDefn(definition,$GMH.PROP_SLICE);if(dropZone&&dropZone.type===UNIT_TYPE_NONMETRIC&&!newGMHelper.sliceObjects.length){addAttributeToZone(newGMHelper,rows,cols,"sliceObjects",dropZone);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_XAXIS);if(dropZone&&(dropZone.type===UNIT_TYPE_NONMETRIC||dropZone.type===UNIT_TYPE_ANY)&&!newGMHelper.xAxisObjects.length){addAttributeToZone(newGMHelper,cols,rows,"xAxisObjects",dropZone);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_YAXIS);var insertNonMetric=dropZone&&((dropZone.type===UNIT_TYPE_NONMETRIC)||(dropZone.type===UNIT_TYPE_ANY));if(!insertNonMetric&&dropZone&&dropZone.type===UNIT_TYPE_TOGGLE&&newGMHelper.xAxisObjects.length){if(newGMHelper.xAxisObjects[0].t===4){insertNonMetric=true;}}if(insertNonMetric){addAttributeToZone(newGMHelper,rows,cols,"yAxisObjects",dropZone);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_BREAKBY);if(dropZone&&dropZone.type===UNIT_TYPE_NONMETRIC&&!newGMHelper.breakByObjects.length){if(isHorizontalGraphMatrix(newTemplateID)){addAttributeToZone(newGMHelper,rows,cols,"breakByObjects",dropZone);}else{addAttributeToZone(newGMHelper,cols,rows,"breakByObjects",dropZone);}}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_COLORBY);if(dropZone&&dropZone.type===UNIT_TYPE_NONMETRIC&&!newGMHelper.colorByObjects.length){if(newGMHelper.sliceObjects.length){newGMHelper.colorByObjects.push(newGMHelper.sliceObjects[0]);}else{if(rows.length+cols.length>=dropZone.min){if(isHorizontalGraphMatrix(newTemplateID)){addAttributeToZone(newGMHelper,rows,cols,"colorByObjects",dropZone);}else{addAttributeToZone(newGMHelper,cols,rows,"colorByObjects",dropZone);}}}}}function shouldShowMetricNames(newGMHelper){if(newGMHelper.getMetricCountInZone(newGMHelper.xAxisObjects)>METRIC_NAMES_VISIBLE_THRESH){return true;}if(newGMHelper.getMetricCountInZone(newGMHelper.yAxisObjects)>METRIC_NAMES_VISIBLE_THRESH){return true;}if(newGMHelper.angleObjects&&newGMHelper.getMetricCountInZone(newGMHelper.angleObjects)>METRIC_NAMES_VISIBLE_THRESH){return true;}return false;}function addMetricsKeyword(definition,oldGMHelper,newGMHelper){if(shouldShowMetricNames(newGMHelper)){if(!hasMetricInZone(newGMHelper.colorByObjects)){newGMHelper.secondaryMetricsDropZone=$GMH.PROP_COLORBY;}var dropZoneID=definition.MetricsDropZone;if(!dropZoneID||dropZoneID!=="null"){switch(dropZoneID){case METRICS_IN_NONE:newGMHelper.metricsDropZone="";break;case METRICS_IN_ANY:newGMHelper.metricsDropZone=$GMH.PROP_COLUMNS;break;default:newGMHelper.metricsDropZone=dropZoneID;break;}}}}function addMetrics(definition,newGMHelper,newTemplateID){var mx=this.templateInfo.mx,dropZone;if(!mx.length){return ;}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_ANGLE);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!newGMHelper.angleObjects.length&&mx.length>=dropZone.min){newGMHelper.angleObjects.push(mx[0]);mx.splice(0,1);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_XAXIS);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!newGMHelper.xAxisObjects.length&&mx.length>=dropZone.min){newGMHelper.xAxisObjects.push(mx[0]);mx.splice(0,1);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_YAXIS);if(dropZone){var insertMetric=(dropZone.type===UNIT_TYPE_METRIC);if(!insertMetric&&dropZone.type===UNIT_TYPE_TOGGLE){if(!newGMHelper.xAxisObjects.length||newGMHelper.xAxisObjects[0].t!==4){insertMetric=true;}}if(insertMetric&&!newGMHelper.yAxisObjects.length){if(mx.length>=dropZone.min){newGMHelper.yAxisObjects.push(mx[0]);mx.splice(0,1);if(mx.length>0&&(newTemplateID===GRAPHCOMBINATIONBARAREA||newTemplateID===GRAPHCOMBINATIONBARAREADUALAXIS)){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},mx[0]));mx.splice(0,1);}}}}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_COLORBY);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!newGMHelper.colorByObjects.length){if(mx.length>0){newGMHelper.colorByObjects.push(mx[0]);this.markedObjects.push(mx[0]);}else{[{n:"sizeByObjects",fn:function(n){return newGMHelper[n].length;}},{n:"xAxisObjects",fn:function(n){return newGMHelper[n].length&&newGMHelper[n][0].t===4;}},{n:"yAxisObjects",fn:function(n){return newGMHelper[n].length&&newGMHelper[n][0].t===4;}}].forEach(function(item){if(item.fn(item.n)){var z=newGMHelper[item.n],colorByItem=$HASH.copy(z[z.length-1]);colorByItem.ax=1;newGMHelper.colorByObjects.push(colorByItem);}});}}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_SIZEBY);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!newGMHelper.sizeByObjects.length){if(mx.length){newGMHelper.sizeByObjects.push(mx[0]);this.markedObjects.push(mx[0]);}else{["colorByObjects","xAxisObjects","yAxisObjects"].forEach(function(n){var from=newGMHelper[n],sz=from.length;if(sz&&from[0].t===4){newGMHelper.sizeByObjects.push(from[sz-1]);}});}}}function isMetricUsed(did){var r=false;$ARR.forEach(this.markedObjects,function(obj){if(obj.did===did){r=true;return false;}});return r;}function addRowColumnAdditionalMetricsZones(newGMHelper){var ths=this,ti=this.templateInfo;ti.rows.forEach(function(obj){newGMHelper.rowObjects.push(obj);});ti.cols.forEach(function(obj){newGMHelper.columnObjects.push(obj);});ti.mx.forEach(function(obj){if(!isMetricUsed.call(ths,obj.did)){newGMHelper.tooltipMetrics.push(obj);}});}function addProperties(definition,helper){var props=definition.Properties;if(props[$GMH.PROP_SHAPE]){helper.shape=props[$GMH.PROP_SHAPE];}if(props[$GMH.PROP_SUBTYPE]&&(helper.subtype===""||helper.subtype===$GMH.PROP_SUBTYPE_AUTOMATIC)){helper.subtype=props[$GMH.PROP_SUBTYPE];}}function addThresholds(node,newGMHelper,actions){if(newGMHelper.colorByObjects.length<=0){return ;}var templateMetric=newGMHelper.colorByObjects[0];if(templateMetric.t===$DSSOBJ_TYPES.DssTypeMetric){this.addThresholds(node,templateMetric,actions,undefined,undefined);}}function clearAllSubTotals(node,actions){var rows=(node.data.gts&&node.data.gts.row)||[];rows.forEach(function(r){if(r.otp===12&&r.ast&&r.ast.length){actions.push({act:"showTotals",unitId:r.id,unitType:r.otp,subtotalType:[],clearSubtotalType:r.ast.map(function(tt){return tt.t;})});}});}function hasMetricInZone(zoneObjects){var i,unit;for(i=0;i<zoneObjects.length;i++){unit=zoneObjects[i];if(unit.t===$DSSOBJ_TYPES.DssTypeMetric){return true;}}return false;}function addSubTotalOnSliceAttr(newGMHelper){var unit,i,firstAttribute,doesSliceHaveAttribute=false,doesXYSizeByHaveMetric;for(i=0;i<newGMHelper.sliceObjects.length;i++){unit=newGMHelper.sliceObjects[i];if(unit.t===$DSSOBJ_TYPES.DssTypeAttribute){firstAttribute=unit;doesSliceHaveAttribute=true;break;}}if(!doesSliceHaveAttribute){return ;}doesXYSizeByHaveMetric=hasMetricInZone(newGMHelper.xAxisObjects);if(!doesXYSizeByHaveMetric){doesXYSizeByHaveMetric=hasMetricInZone(newGMHelper.yAxisObjects);}if(!doesXYSizeByHaveMetric){doesXYSizeByHaveMetric=hasMetricInZone(newGMHelper.sizeByObjects);}if(!doesXYSizeByHaveMetric){return ;}}function isVerticalGraphMatrix(templateID){switch(templateID){case GRAPHMATRIXVERTICALBARCLUSTERED:case GRAPHMATRIXVERTICALBARSTACKED:case GRAPHMATRIXVERTICALBARPERCENT:case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXVERTICALAREACLUSTERED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXVERTICALAREAPERCENT:case GRAPHMATRIXVERTICALBARAUTOMATIC:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXVERTICALAREAAUTOMATIC:return true;default:return false;}}function isVerticalGraphMatrix2(node){if(!node.data.dz){return false;}var dz=node.data.dz,$GH=mstrmojo.vi.viz.GraphMatrixHelper,xAxis=dz[$GH.PROP_XAXIS],xAxisList=xAxis.TemplateUnit||xAxis.TemplateMetric||[],yAxis=dz[$GH.PROP_YAXIS],yAxisList=yAxis.TemplateUnit||yAxis.TemplateMetric||[];if(yAxisList.length>0&&yAxisList[0].t===$DSSOBJ_TYPES.DssTypeMetric){if(xAxisList.length===0||xAxisList[0].t!==$DSSOBJ_TYPES.DssTypeMetric){return true;}}return false;}function isHorizontalGraphMatrix2(node){if(!node.data.dz){return false;}var dz=node.data.dz,$GH=mstrmojo.vi.viz.GraphMatrixHelper,xAxis=dz[$GH.PROP_XAXIS],xAxisList=[],yAxis=dz[$GH.PROP_YAXIS],yAxisList=[];if(xAxis){xAxisList=xAxis.TemplateUnit||xAxis.TemplateMetric||[];}if(yAxis){yAxisList=yAxis.TemplateUnit||yAxis.TemplateMetric||[];}if(xAxisList.length>0&&(xAxisList[0].t===$DSSOBJ_TYPES.DssTypeMetric)){if(yAxisList.length===0||(yAxisList[0].t!==$DSSOBJ_TYPES.DssTypeMetric)){return true;}}return false;}function isABLGraphMatrix(templateID){return isVerticalGraphMatrix(templateID)||isHorizontalGraphMatrix(templateID);}function isAreaChart(templateID){switch(templateID){case GRAPHMATRIXVERTICALAREACLUSTERED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXVERTICALAREAPERCENT:case GRAPHMATRIXHORIZONTALAREACLUSTERED:case GRAPHMATRIXHORIZONTALAREASTACKED:case GRAPHMATRIXHORIZONTALAREAPERCENT:case GRAPHMATRIXVERTICALAREAAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:return true;default:return false;}}function swapDropZoneUnits(oldTemplateID,newTemplateID,oldGMHelper,newGMHelper,node){if(this.isGraphMatrix(oldTemplateID)){if((isHorizontalGraphMatrix2(node)&&isVerticalGraphMatrix(newTemplateID))||(isHorizontalGraphMatrix(newTemplateID)&&isVerticalGraphMatrix2(node))){var i;for(i=0;i<oldGMHelper.xAxisObjects.length;i++){newGMHelper.yAxisObjects.push(oldGMHelper.xAxisObjects[i]);removeFromCollection.call(this,oldGMHelper.xAxisObjects[i]);}for(i=0;i<oldGMHelper.yAxisObjects.length;i++){newGMHelper.xAxisObjects.push(oldGMHelper.yAxisObjects[i]);removeFromCollection.call(this,oldGMHelper.yAxisObjects[i]);}}}}function transitionFromGraphMatrixPie(oldGMHelper,newGMHelper){newGMHelper.breakByObjects=oldGMHelper.sliceObjects.concat();newGMHelper.tooltipMetrics=oldGMHelper.angleObjects.concat();}function transferUnits(definition,oldGMHelper,newGMHelper,oldTemplateID,actions,node){var dropZone,i,obj,oldHelper,oldIsMap=(oldTemplateID===$VIZTEMPLATES.GOOGLEMAP||oldTemplateID===$VIZTEMPLATES.ESRIMAP);if(oldTemplateID===$VIZTEMPLATES.HEATMAP){oldHelper=new $VIZ.HeatMapVisualizationHelper();oldHelper.setData(node.data.dz);}else{if(oldIsMap){var helperCls=(oldTemplateID===$VIZTEMPLATES.ESRIMAP)?$VIZ.ESRIMapHelper:$VIZ.GoogleMapHelper;oldHelper=new helperCls({data:node.data});oldHelper.setWidget(this.vis);}}if(this.isGraphMatrix(oldTemplateID)){if(oldGMHelper.xAxisObjects.length>0){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_XAXIS);if(!dropZone||isValidUnit(oldGMHelper.xAxisObjects[0],dropZone.type,definition)){for(i=0;i<oldGMHelper.xAxisObjects.length;i++){obj=oldGMHelper.xAxisObjects[i];newGMHelper.xAxisObjects.push(obj);removeFromCollection.call(this,obj);}}}if(oldGMHelper.yAxisObjects.length>0){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_YAXIS);if(!dropZone||isValidUnit(oldGMHelper.yAxisObjects[0],dropZone.type,definition)){for(i=0;i<oldGMHelper.yAxisObjects.length;i++){obj=oldGMHelper.yAxisObjects[i];newGMHelper.yAxisObjects.push(obj);removeFromCollection.call(this,obj);}}}if(oldGMHelper.breakByObjects.length>0){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_BREAKBY);if(!dropZone||isValidUnit(oldGMHelper.breakByObjects[0],dropZone.type,definition)){for(i=0;i<oldGMHelper.breakByObjects.length;i++){obj=oldGMHelper.breakByObjects[i];newGMHelper.breakByObjects.push(obj);removeFromCollection.call(this,obj);}}}}var colorByUnits=[];if(this.isGraphMatrix(oldTemplateID)){for(i=0;i<oldGMHelper.colorByObjects.length;i++){colorByUnits.push(oldGMHelper.colorByObjects[i]);}}else{if(oldTemplateID===$VIZTEMPLATES.HEATMAP){oldHelper.colorBy.forEach(function(unit){colorByUnits.push(unit);});}else{if(oldIsMap&&oldHelper.showColorByZone()){var cbUnit=oldHelper.getColorByUnit();if(cbUnit){colorByUnits.push(cbUnit);}}}}if(colorByUnits.length){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_COLORBY);var addColorBy=(!dropZone||isValidUnit(colorByUnits[0],dropZone.type,definition));if(addColorBy){for(i=0;i<colorByUnits.length;i++){obj=colorByUnits[i];newGMHelper.colorByObjects.push(obj);this.markedObjects.push(obj);}}}var sizeByUnits=[];if(this.isGraphMatrix(oldTemplateID)){for(i=0;i<oldGMHelper.sizeByObjects.length;i++){sizeByUnits.push(oldGMHelper.sizeByObjects[i]);}}else{if(oldTemplateID===$VIZTEMPLATES.HEATMAP){if(oldHelper.sizeByMetric){sizeByUnits.push(oldHelper.sizeByMetric);}}else{if(oldIsMap&&oldHelper.showSizeByZone()){var sbUnit=oldHelper.getSizeByUnit();if(sbUnit){sizeByUnits.push(sbUnit);}}}}if(sizeByUnits.length>0){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_SIZEBY);var shape=definition.Properties[$GMH.PROP_SHAPE],addSizeBy;addSizeBy=(shape!=="Area")&&(!dropZone||isValidUnit(sizeByUnits,dropZone.type,definition));if(addSizeBy){for(i=0;i<sizeByUnits.length;i++){obj=sizeByUnits[i];newGMHelper.sizeByObjects.push(obj);this.markedObjects.push(obj);}}}}function transitionFromGridToBubble(newGMHelper){var ti=this.templateInfo,mx=ti.mx,definition=this.definition,lastMx=mx.pop(),secondLastMx=mx.pop(),thirdLastMx=mx.pop()||secondLastMx||lastMx,addMetricToZoneIfExist=function(m,zoneName,objList){if(m){var dropZone=getDropZoneFromDefn(definition,zoneName);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!objList.length){objList.push(m);}}};addMetricToZoneIfExist(lastMx,$GMH.PROP_XAXIS,newGMHelper.xAxisObjects);addMetricToZoneIfExist(secondLastMx,$GMH.PROP_YAXIS,newGMHelper.yAxisObjects);addMetricToZoneIfExist(thirdLastMx,$GMH.PROP_SIZEBY,newGMHelper.sizeByObjects);addAttributeToZone(newGMHelper,ti.cols,ti.rows,"breakByObjects",getDropZoneFromDefn(definition,$GMH.PROP_BREAKBY));addRowColumnAdditionalMetricsZones.call(this,newGMHelper);}function transitionFromGridToPie(newGMHelper){var ti=this.templateInfo,mx=ti.mx,definition=this.definition,lastMx=mx.pop();addAttributeToZone(newGMHelper,ti.cols,ti.rows,"sliceObjects",getDropZoneFromDefn(definition,$GMH.PROP_SLICE));if(lastMx){newGMHelper.angleObjects.push(lastMx);}if(newGMHelper.sliceObjects.length){newGMHelper.colorByObjects.push(newGMHelper.sliceObjects[0]);}ti.mx.forEach(function(obj){newGMHelper.tooltipMetrics.push(obj);});}function getUnitIndexInZone(zone,item){return $ARR.find(zone,"did",item.did);}function hMoveUnitsToZoneByType(objList,destZone,type){var result=false;if(objList.length&&(objList[0].t===type||type===undefined)){objList.forEach(function(obj){if(getUnitIndexInZone(destZone,obj)===-1){destZone.push(obj);result=true;}});}return result;}function copyZones(zones,oldGMHelper,newGMHelper){zones.forEach(function(zoneObj){hMoveUnitsToZoneByType(oldGMHelper[zoneObj],newGMHelper[zoneObj]);});}function hMoveLastTooltipMetricToZone(toolTipMetrics,destZone){if(toolTipMetrics.length){destZone.push(toolTipMetrics.pop());}}function hCopyFirstMetricToZoneIfExist(objList,destZone){if(objList.length&&objList[0].t===4){destZone.push(objList[0]);return true;}return false;}function transitionHeatmapToABL(newGMHelper,node){var oldHMHelper,objList,anObj;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.groupingObjects;if(objList.length&&!newGMHelper.isMetric(objList[0])){newGMHelper.xAxisObjects.push(objList.pop());}objList=oldHMHelper.tooltipMetrics;anObj=oldHMHelper.sizeByMetric||oldHMHelper.getFirstColorByUnit(true)||objList.pop();if(anObj){newGMHelper.yAxisObjects.push(anObj);}hMoveUnitsToZoneByType(oldHMHelper.groupingObjects,newGMHelper.rowObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldHMHelper.colorBy,newGMHelper.colorByObjects);hMoveUnitsToZoneByType(oldHMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionHeatmapToBubble(newGMHelper,node){var oldHMHelper,objList,anObj;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.tooltipMetrics;anObj=oldHMHelper.sizeByMetric||oldHMHelper.getFirstColorByUnit(true)||objList.pop();if(anObj){newGMHelper.xAxisObjects.push(anObj);}anObj=oldHMHelper.getFirstColorByUnit(true);if(!anObj||newGMHelper.xAxisObjects.length&&newGMHelper.xAxisObjects[0].did===anObj.did){anObj=objList.pop();}if(anObj){newGMHelper.yAxisObjects.push(anObj);}anObj=objList.pop()||oldHMHelper.getFirstColorByUnit(true)||oldHMHelper.sizeByMetric;if(anObj){newGMHelper.sizeByObjects.push(anObj);}objList=oldHMHelper.groupingObjects;if(objList.length&&!newGMHelper.isMetric(objList[0])){newGMHelper.breakByObjects.push(objList.pop());}hMoveUnitsToZoneByType(oldHMHelper.colorBy,newGMHelper.colorByObjects);hMoveUnitsToZoneByType(oldHMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionNetworkToBubble(newGMHelper,node){var oldHelper,anObj;oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);var mx=oldHelper.getNetworkMetrics();anObj=findFirstMetricInArrayAndRemove(mx);if(anObj){newGMHelper.xAxisObjects.push(anObj);}anObj=mx[0];if(anObj){newGMHelper.yAxisObjects.push(anObj);}anObj=findFirstMetricInArrayAndRemove(mx);if(anObj){newGMHelper.sizeByObjects.push(anObj);}anObj=oldHelper.fromItemAttribute;if(anObj){newGMHelper.breakByObjects.push(anObj);}anObj=oldHelper.toItemAttribute;if(anObj){newGMHelper.rowObjects.push(anObj);}hMoveUnitsToZoneByType(mx,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionFromBubbleToABL(oldGMHelper,newGMHelper){var objList=oldGMHelper.xAxisObjects;copyZones(["tooltipMetrics"],oldGMHelper,newGMHelper);if(objList.length&&objList[0].t===4){objList.forEach(function(obj){newGMHelper.tooltipMetrics.push(obj);});}objList=oldGMHelper.breakByObjects;if(objList.length&&objList[0].t===12){newGMHelper.xAxisObjects.push(objList[0]);objList.splice(0,1);}else{objList=oldGMHelper.columnObjects;if(objList.length&&objList[0].t===12){newGMHelper.xAxisObjects.push(objList.pop());}else{objList=oldGMHelper.rowObjects;if(objList.length){newGMHelper.xAxisObjects.push(objList.pop());}}}objList=oldGMHelper.sizeByObjects;if(objList.length){objList.forEach(function(obj){newGMHelper.tooltipMetrics.push(obj);});}copyZones(["breakByObjects","yAxisObjects","colorByObjects","columnObjects","rowObjects"],oldGMHelper,newGMHelper);}function transitionImageLayoutOrMapToBubble(newGMHelper,geoObj,sizeByObj,colorByObj,tooltips,isMap){var xAxisObj,yAxisObj,firstTooltip,firstTooltipIndex=-1,tooltipCount=tooltips?tooltips.length:0,colorBy,sizeBy,tooltipsCopy=tooltips.concat([]),tooltipUsed=false;colorBy=(colorByObj&&newGMHelper.isMetric(colorByObj))?colorByObj:undefined;for(var i=0;i<tooltipCount;i++){if(newGMHelper.isMetric(tooltips[i])){firstTooltip=tooltips[i];firstTooltipIndex=i;break;}}xAxisObj=sizeByObj||colorBy;if(!xAxisObj&&firstTooltip){xAxisObj=firstTooltip;tooltipUsed=true;}if(xAxisObj){newGMHelper.xAxisObjects.push(xAxisObj);}yAxisObj=colorBy||firstTooltip;if(yAxisObj&&yAxisObj.did!==xAxisObj.did){newGMHelper.yAxisObjects.push(yAxisObj);if(!colorBy){tooltipUsed=true;}}if(isMap){sizeBy=xAxisObj;}else{sizeBy=firstTooltip||colorBy||sizeByObj;if(firstTooltip){tooltipUsed=true;}}if(sizeBy){newGMHelper.sizeByObjects.push(sizeBy);}if(geoObj){newGMHelper.breakByObjects.push(geoObj);}if(colorByObj){newGMHelper.colorByObjects.push(colorByObj);}if(tooltipUsed){tooltipsCopy.splice(firstTooltipIndex,1);}hMoveUnitsToZoneByType(tooltipsCopy,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionMapToBubble(oldTemplateID,newGMHelper){var oldHelper=(oldTemplateID===$VIZTEMPLATES.ESRIMAP)?new $VIZ.ESRIMapHelper():new $VIZ.GoogleMapHelper();oldHelper.setWidget(this.vis);transitionImageLayoutOrMapToBubble(newGMHelper,oldHelper.getGeoUnit(),oldHelper.getSizeByUnit(),oldHelper.getColorByUnit(),oldHelper.getTooltipUnits(),true);}function transitionImageLayoutToBubble(newGMHelper,node){var oldHelper=new $VIZ.ImageLayoutHelper({node:node});oldHelper.setData(node.data.dz);transitionImageLayoutOrMapToBubble(newGMHelper,oldHelper.geoAttribute,oldHelper.sizeByMetric,oldHelper.colorByMetric,oldHelper.tooltipMetrics);}function transitionFromABLToBubble(oldGMHelper,newGMHelper,node){var objList=oldGMHelper.xAxisObjects,fnPopulateAxis=function(z){if(!hCopyFirstMetricToZoneIfExist(oldGMHelper.sizeByObjects,newGMHelper[z])){if(!hCopyFirstMetricToZoneIfExist(oldGMHelper.colorByObjects,newGMHelper[z])){hMoveLastTooltipMetricToZone(oldGMHelper.tooltipMetrics,newGMHelper[z]);}}};moveMetricsOnNumericAxisToPrimary(oldGMHelper,node);if(!hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects,4)){objList=oldGMHelper.yAxisObjects;if(objList.length>1&&oldGMHelper.isMetric(objList[0])){newGMHelper.xAxisObjects.push(objList.pop());}else{fnPopulateAxis("xAxisObjects");}}if(!hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects,4)){fnPopulateAxis("yAxisObjects");}if(!hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper.sizeByObjects,4)){objList=newGMHelper.yAxisObjects;if(objList.length>1){newGMHelper.sizeByObjects.push(objList.pop());}else{if(!hCopyFirstMetricToZoneIfExist(oldGMHelper.colorByObjects,newGMHelper.sizeByObjects)){hMoveLastTooltipMetricToZone(oldGMHelper.tooltipMetrics,newGMHelper.sizeByObjects);}}}hMoveUnitsToZoneByType(oldGMHelper.breakByObjects,newGMHelper.breakByObjects,12);objList=oldGMHelper.yAxisObjects;if(objList.length&&objList[0].t===12){newGMHelper.breakByObjects=objList.concat(newGMHelper.breakByObjects);}objList=oldGMHelper.xAxisObjects;if(objList.length&&objList[0].t===12){newGMHelper.breakByObjects=objList.concat(newGMHelper.breakByObjects);}copyZones(["colorByObjects","columnObjects","rowObjects","tooltipMetrics"],oldGMHelper,newGMHelper);}function transitionFromGridChartToABL(oldGMHelper,newGMHelper){copyZones(["breakByObjects","colorByObjects","columnObjects","rowObjects","xAxisObjects"],oldGMHelper,newGMHelper);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.rowObjects,12);if(oldGMHelper.sizeByObjects.length){newGMHelper.yAxisObjects.push(oldGMHelper.sizeByObjects[0]);}else{if(oldGMHelper.colorByObjects.length&&oldGMHelper.isMetric(oldGMHelper.colorByObjects[0])){newGMHelper.yAxisObjects.push(oldGMHelper.colorByObjects[0]);}else{if(oldGMHelper.tooltipMetrics.length){newGMHelper.yAxisObjects.push(oldGMHelper.tooltipMetrics.pop());}}}hMoveUnitsToZoneByType(oldGMHelper.tooltipMetrics,newGMHelper.tooltipMetrics);}function transitionFromGridChartToBubble(oldGMHelper,newGMHelper){var objList,usedMetrics=[];copyZones(["sizeByObjects","colorByObjects","columnObjects","rowObjects"],oldGMHelper,newGMHelper);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.breakByObjects,12);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.breakByObjects,12);hMoveUnitsToZoneByType(oldGMHelper.breakByObjects,newGMHelper.breakByObjects,12);["xAxisObjects","yAxisObjects"].forEach(function(destZone){$ARR.forEach(["sizeByObjects","colorByObjects"],function(z){objList=oldGMHelper[z];if(objList.length&&oldGMHelper.isMetric(objList[0])&&getUnitIndexInZone(usedMetrics,objList[0])===-1){newGMHelper[destZone].push(objList[0]);usedMetrics.push(objList[0]);return false;}});if(newGMHelper[destZone].length===0&&oldGMHelper.tooltipMetrics.length){newGMHelper[destZone].push(oldGMHelper.tooltipMetrics.pop());}});if(newGMHelper.sizeByObjects.length===0){objList=oldGMHelper.colorByObjects;if(objList.length&&objList[0].t===4){newGMHelper.sizeByObjects.push(objList[0]);}else{if(oldGMHelper.tooltipMetrics.length){newGMHelper.sizeByObjects.push(oldGMHelper.tooltipMetrics.pop());}}}hMoveUnitsToZoneByType(oldGMHelper.tooltipMetrics,newGMHelper.tooltipMetrics);}function transitionFromGMToPie(oldGMHelper,newGMHelper){var objList,obj;$ARR.forEach(["xAxisObjects","yAxisObjects","breakByObjects","columnObjects","rowObjects"],function(z){objList=oldGMHelper[z];if(objList&&objList.length&&objList[0].t===$DSSOBJ_TYPES.DssTypeAttribute){obj=objList.pop();newGMHelper.sliceObjects.push(obj);newGMHelper.colorByObjects.push(obj);return false;}});["xAxisObjects","yAxisObjects"].forEach(function(z){hMoveUnitsToZoneByType(oldGMHelper[z],newGMHelper.rowObjects,$DSSOBJ_TYPES.DssTypeAttribute);});$ARR.forEach(["xAxisObjects","yAxisObjects","sizeByObjects","tooltipMetrics"],function(z){objList=oldGMHelper[z];if(objList&&objList.length&&oldGMHelper.isMetric(objList[0])){newGMHelper.angleObjects.push(objList.pop());return false;}});["tooltipMetrics","xAxisObjects","yAxisObjects","sizeByObjects","colorByObjects"].forEach(function(z){hMoveUnitsToZoneByType(oldGMHelper[z],newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);});copyZones(["columnObjects","rowObjects"],oldGMHelper,newGMHelper);}function transitionHeatmapToPie(newGMHelper,node){var oldHMHelper,objList,anObj;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.groupingObjects;if(objList.length&&!newGMHelper.isMetric(objList[0])){newGMHelper.sliceObjects.push(objList.pop());}objList=oldHMHelper.tooltipMetrics;anObj=oldHMHelper.sizeByMetric||oldHMHelper.getFirstColorByUnit(true)||objList.pop();if(anObj){newGMHelper.angleObjects.push(anObj);}objList=newGMHelper.sliceObjects;anObj=oldHMHelper.getFirstColorByUnit(true)||(objList.length&&objList[0]);if(anObj){newGMHelper.colorByObjects.push(anObj);}hMoveUnitsToZoneByType(oldHMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionNetworkToPie(newGMHelper,node){var oldHelper,objList,anObj;oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);anObj=oldHelper.fromItemAttribute||oldHelper.toItemAttribute;if(anObj){newGMHelper.sliceObjects.push(anObj);}anObj=oldHelper.nodeSizeMetric||oldHelper.edgeSizeMetric||oldHelper.edgeColorMetric;if(anObj){newGMHelper.angleObjects.push(anObj);}objList=newGMHelper.sliceObjects;anObj=objList.length&&objList[0];if(anObj){newGMHelper.colorByObjects.push(anObj);}}function transitionImageLayoutOrMapToPie(newGMHelper,sliceObj,angleObj,colorByObj,tooltips){var objList,anObj;if(sliceObj){newGMHelper.sliceObjects.push(sliceObj);}if(angleObj){newGMHelper.angleObjects.push(angleObj);}objList=newGMHelper.sliceObjects;anObj=colorByObj||(objList.length&&objList[0]);if(anObj){newGMHelper.colorByObjects.push(anObj);}hMoveUnitsToZoneByType(tooltips,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionImageLayoutToPie(newGMHelper,node){var oldHelper=new $VIZ.ImageLayoutHelper({node:node});oldHelper.setData(node.data.dz);transitionImageLayoutOrMapToPie(newGMHelper,oldHelper.geoAttribute,(oldHelper.sizeByMetric||oldHelper.colorByMetric),oldHelper.colorByMetric,oldHelper.tooltipMetrics);}function transitionMapToPie(oldTemplateID,newGMHelper){var oldHelper=(oldTemplateID===$VIZTEMPLATES.ESRIMAP)?new $VIZ.ESRIMapHelper():new $VIZ.GoogleMapHelper();oldHelper.setWidget(this.vis);var colorBy=oldHelper.getColorByUnit();transitionImageLayoutOrMapToPie(newGMHelper,oldHelper.getGeoUnit(),(oldHelper.getSizeByUnit()||colorBy),colorBy,oldHelper.getTooltipUnits());}function transitionToGraphMatrixPie(oldTemplateID,oldGMHelper,newGMHelper,node){if(oldGMHelper){transitionFromGMToPie.call(this,oldGMHelper,newGMHelper);}else{switch(oldTemplateID){case $VIZTEMPLATES.ESRIMAP:case $VIZTEMPLATES.GOOGLEMAP:transitionMapToPie.call(this,oldTemplateID,newGMHelper,node);break;case $VIZTEMPLATES.HEATMAP:transitionHeatmapToPie.call(this,newGMHelper,node);break;case $VIZTEMPLATES.NETWORK:transitionNetworkToPie.call(this,newGMHelper,node);break;case $VIZTEMPLATES.IMAGELAYOUT:transitionImageLayoutToPie.call(this,newGMHelper,node);break;case $VIZTEMPLATES.GRID:transitionFromGridToPie.call(this,newGMHelper,node);break;}}}function distributeMetricsToYAxis(newGMHelper,mx){var metricShapes=[],numLeft=(mx.length/2),fnPushShape=function(aMetric,shape){metricShapes.push("'"+aMetric.did+"':"+shape);};while(numLeft>0){newGMHelper.yAxisObjects.push(mx[0]);fnPushShape(mx[0],$SHAPE_TYPES.BAR);mx.splice(0,1);numLeft-=1;}while(mx.length){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},mx[0]));fnPushShape(mx[0],$SHAPE_TYPES.LINE);mx.splice(0,1);}if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}}function transitionFromABLToCombo(oldGMHelper,newGMHelper){var objList,mx=[];copyZones(["breakByObjects","colorByObjects","columnObjects","rowObjects","sizeByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);["xAxisObjects","yAxisObjects"].forEach(function(z){hMoveUnitsToZoneByType(oldGMHelper[z],newGMHelper.xAxisObjects,12);});["xAxisObjects","yAxisObjects"].forEach(function(z){objList=oldGMHelper[z];if(objList.length&&oldGMHelper.isMetric(objList[0])){mx=mx.concat(objList);}});if(mx.length){distributeMetricsToYAxis.call(this,newGMHelper,mx);}}function transitionFromBubbleToCombo(oldGMHelper,newGMHelper){copyZones(["breakByObjects","colorByObjects","columnObjects","rowObjects"],oldGMHelper,newGMHelper);hMoveUnitsToZoneByType(oldGMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);var objList,obj;$ARR.forEach(["breakByObjects","columnObjects","rowObjects"],function(z){objList=newGMHelper[z];if(objList&&objList.length&&objList[0].t===$DSSOBJ_TYPES.DssTypeAttribute){if(z==="breakByObjects"){obj=objList.splice(0,1)[0];}else{obj=objList.pop();}newGMHelper.xAxisObjects.push(obj);return false;}});hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);distributeMetricsToYAxis.call(this,newGMHelper,oldGMHelper.yAxisObjects);}function transitionFromGridChartToCombo(oldGMHelper,newGMHelper){var objList,obj,leftSideMetric,metricShapes=[],fnFindMetric=function(){var aMetric,firstObj;$ARR.forEach(["sizeByObjects","colorByObjects"],function(z){objList=oldGMHelper[z];if(objList&&objList.length){firstObj=objList[0];if(oldGMHelper.isMetric(firstObj)&&firstObj!==leftSideMetric){aMetric=firstObj;return false;}}});if(!aMetric){aMetric=oldGMHelper.tooltipMetrics.pop();}return aMetric;};copyZones(["breakByObjects","colorByObjects","columnObjects","rowObjects","sizeByObjects"],oldGMHelper,newGMHelper);["xAxisObjects","yAxisObjects"].forEach(function(z){hMoveUnitsToZoneByType(oldGMHelper[z],newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);});leftSideMetric=fnFindMetric();if(leftSideMetric){newGMHelper.yAxisObjects.push(leftSideMetric);metricShapes.push("'"+leftSideMetric.did+"':"+$SHAPE_TYPES.BAR);}obj=fnFindMetric();if(obj){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},obj));metricShapes.push("'"+obj.did+"':"+$SHAPE_TYPES.LINE);}hMoveUnitsToZoneByType(oldGMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}}function transitionFromGridToCombo(oldTemplateID,oldGMHelper,newGMHelper){var ti=this.templateInfo,mx=ti.mx,definition=this.definition,metricShapes=[];addAttributeToZone(newGMHelper,ti.cols,ti.rows,"xAxisObjects",getDropZoneFromDefn(definition,$GMH.PROP_XAXIS));if(mx.length){newGMHelper.yAxisObjects.push(mx[0]);metricShapes.push("'"+mx[0].did+"':"+$SHAPE_TYPES.BAR);mx.splice(0,1);if(mx.length){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},mx[0]));metricShapes.push("'"+mx[0].did+"':"+$SHAPE_TYPES.LINE);mx.splice(0,1);}}addRowColumnAdditionalMetricsZones.call(this,newGMHelper);addMetricsKeyword.call(this,this.definition,oldGMHelper,newGMHelper);if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}}function transitionHeatmapToCombo(newGMHelper,node){var oldHMHelper,objList,anObj,leftSideMetric,metricShapes=[],hmColorByMetric;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);hmColorByMetric=oldHMHelper.getFirstColorByUnit(true);objList=oldHMHelper.groupingObjects;if(objList.length&&!newGMHelper.isMetric(objList[0])){newGMHelper.xAxisObjects.push(objList.pop());}hMoveUnitsToZoneByType(oldHMHelper.groupingObjects,newGMHelper.rowObjects,$DSSOBJ_TYPES.DssTypeAttribute);objList=oldHMHelper.tooltipMetrics;leftSideMetric=anObj=oldHMHelper.sizeByMetric||hmColorByMetric||objList.pop();if(anObj){newGMHelper.yAxisObjects.push(anObj);metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.BAR);if(anObj===oldHMHelper.sizeByMetric){delete oldHMHelper.sizeByMetric;}else{if(anObj===oldHMHelper.colorBy[0]){oldHMHelper.colorBy.splice(0,1);}}}anObj=(hmColorByMetric&&(hmColorByMetric.did!==leftSideMetric.did))?hmColorByMetric:objList.pop();if(anObj){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},anObj));metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.LINE);}hMoveUnitsToZoneByType(oldHMHelper.colorBy,newGMHelper.colorByObjects);hMoveUnitsToZoneByType(oldHMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);anObj=oldHMHelper.sizeByMetric;if(anObj){newGMHelper.tooltipMetrics.push(anObj);}if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}}function findFirstMetricInArrayAndRemove(mx,usedMetric){var aMetric;$ARR.forEach(mx,function(m,idx,arr){if(m&&m!==usedMetric){aMetric=m;arr.splice(idx,1);return false;}});return aMetric;}function transitionNetworkToCombo(newGMHelper,node){var oldHelper,anObj,leftSideMetric,xAxisObj,metricShapes=[];oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);anObj=oldHelper.fromItemAttribute||oldHelper.toItemAttribute;if(anObj){newGMHelper.xAxisObjects.push(anObj);xAxisObj=anObj;}var mx=oldHelper.getNetworkMetrics();leftSideMetric=anObj=findFirstMetricInArrayAndRemove(mx);if(anObj){newGMHelper.yAxisObjects.push(anObj);metricShapes.push("'"+mx.did+"':"+$SHAPE_TYPES.BAR);}anObj=findFirstMetricInArrayAndRemove(mx,leftSideMetric);if(anObj){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},anObj));metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.LINE);}if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}anObj=oldHelper.toItemAttribute;if(anObj&&(xAxisObj!==anObj)){newGMHelper.rowObjects.push(anObj);}}function transitionImageLayoutOrMapToCombo(newGMHelper,xAxisObj,yAxisMetrics,tooltips,colorByMetric){var anObj,leftSideMetric,metricShapes=[];if(xAxisObj){newGMHelper.xAxisObjects.push(xAxisObj);}leftSideMetric=anObj=findFirstMetricInArrayAndRemove(yAxisMetrics);if(!anObj){leftSideMetric=anObj=tooltips&&(tooltips.length>0)&&(tooltips[0].t===$DSSOBJ_TYPES.DssTypeMetric)&&tooltips.pop();}if(anObj){newGMHelper.yAxisObjects.push(anObj);metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.BAR);}anObj=findFirstMetricInArrayAndRemove(yAxisMetrics,leftSideMetric);if(!anObj){anObj=tooltips&&(tooltips.length>0)&&(tooltips[0].t===$DSSOBJ_TYPES.DssTypeMetric)&&tooltips.pop();}if(anObj){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},anObj));metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.LINE);}if(colorByMetric){newGMHelper.colorByObjects.push(colorByMetric);}if(tooltips){hMoveUnitsToZoneByType(tooltips,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}}function transitionImageLayoutToCombo(newGMHelper,node){var oldHelper=new $VIZ.ImageLayoutHelper({node:node});oldHelper.setData(node.data.dz);transitionImageLayoutOrMapToCombo(newGMHelper,oldHelper.geoAttribute,[oldHelper.sizeByMetric,oldHelper.colorByMetric],oldHelper.tooltipMetrics,oldHelper.colorByMetric);}function transitionMapToCombo(oldTemplateID,newGMHelper){var oldHelper=(oldTemplateID===$VIZTEMPLATES.ESRIMAP)?new $VIZ.ESRIMapHelper():new $VIZ.GoogleMapHelper();oldHelper.setWidget(this.vis);var colorBy=oldHelper.getColorByUnit();transitionImageLayoutOrMapToCombo(newGMHelper,oldHelper.getGeoUnit(),[oldHelper.getSizeByUnit(),colorBy],oldHelper.getTooltipUnits(),colorBy);}function transitionToGraphMatrixCombo(oldTemplateID,oldGMHelper,newGMHelper,node){switch(oldTemplateID){case $VIZTEMPLATES.ESRIMAP:case $VIZTEMPLATES.GOOGLEMAP:transitionMapToCombo.call(this,oldTemplateID,newGMHelper,node);break;case $VIZTEMPLATES.HEATMAP:transitionHeatmapToCombo.call(this,newGMHelper,node);break;case $VIZTEMPLATES.NETWORK:transitionNetworkToCombo.call(this,newGMHelper,node);break;case $VIZTEMPLATES.IMAGELAYOUT:transitionImageLayoutToCombo.call(this,newGMHelper,node);break;case $VIZTEMPLATES.GRID:transitionFromGridToCombo.call(this,oldTemplateID,oldGMHelper,newGMHelper);break;}}function moveMetricsToPrimaryAxis(oldGMHelper,z){var objList=oldGMHelper[z];if(objList&&objList.length&&oldGMHelper.isMetric(objList[0])){objList.forEach(function(m){m.ax=AXIS_PRIMARY;});}}function moveMetricsOnNumericAxisToPrimary(oldGMHelper,node){if(isHorizontalGraphMatrix2(node)){moveMetricsToPrimaryAxis(oldGMHelper,"xAxisObjects");}else{moveMetricsToPrimaryAxis(oldGMHelper,"yAxisObjects");}}function transitionFromComboToABL(oldGMHelper,newGMHelper,node){moveMetricsOnNumericAxisToPrimary(oldGMHelper,node);newGMHelper.clone(oldGMHelper);}function transitionNetworkToABL(newGMHelper,node){var oldHelper,anObj,xAxisObj;oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);anObj=oldHelper.fromItemAttribute||oldHelper.toItemAttribute;if(anObj){newGMHelper.xAxisObjects.push(anObj);xAxisObj=anObj;}var mx=oldHelper.getNetworkMetrics();anObj=findFirstMetricInArrayAndRemove(mx);if(anObj){newGMHelper.yAxisObjects.push(anObj);}hMoveUnitsToZoneByType(mx,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);anObj=oldHelper.toItemAttribute;if(anObj&&(xAxisObj!==anObj)){newGMHelper.rowObjects.push(anObj);}}function transitionImageLayoutOrMapToABL(newGMHelper,xAxisObj,sizeByObj,colorByObj,tooltips){var firstTooltip,firstTooltipIndex=-1,tooltipCount=tooltips?tooltips.length:0,yAxisObj,tooltipsCopy=tooltips.concat([]);if(xAxisObj){newGMHelper.xAxisObjects.push(xAxisObj);}for(var i=0;i<tooltipCount;i++){if(newGMHelper.isMetric(tooltips[i])){firstTooltip=tooltips[i];firstTooltipIndex=i;break;}}yAxisObj=sizeByObj||colorByObj;if(!yAxisObj&&firstTooltip){yAxisObj=firstTooltip;tooltipsCopy.splice(firstTooltipIndex,1);}if(yAxisObj){newGMHelper.yAxisObjects.push(yAxisObj);}if(colorByObj){newGMHelper.colorByObjects.push(colorByObj);}hMoveUnitsToZoneByType(tooltipsCopy,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionMapToABL(oldTemplateID,newGMHelper){var oldHelper=(oldTemplateID===$VIZTEMPLATES.ESRIMAP)?new $VIZ.ESRIMapHelper():new $VIZ.GoogleMapHelper();oldHelper.setWidget(this.vis);transitionImageLayoutOrMapToABL(newGMHelper,oldHelper.getGeoUnit(),oldHelper.getSizeByUnit(),oldHelper.getColorByUnit(),oldHelper.getTooltipUnits());}function transitionImageLayoutToABL(newGMHelper,node){var oldHelper=new $VIZ.ImageLayoutHelper({node:node});oldHelper.setData(node.data.dz);transitionImageLayoutOrMapToABL(newGMHelper,oldHelper.geoAttribute,oldHelper.sizeByMetric,oldHelper.colorByMetric,oldHelper.tooltipMetrics);}function transitionFromComboToBubble(oldGMHelper,newGMHelper,node){moveMetricsOnNumericAxisToPrimary(oldGMHelper,node);transitionFromABLToBubble.call(this,oldGMHelper,newGMHelper,node);}function transitionFromPieToAnyChart(oldGMHelper,newGMHelper){hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper.breakByObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.angleObjects,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function doFlashTransition(oldTemplateID,newTemplateID,actions,node,newGMHelper,oldGMHelper){transferUnits.call(this,this.definition,oldGMHelper,newGMHelper,oldTemplateID,actions,node);swapDropZoneUnits.call(this,oldTemplateID,newTemplateID,oldGMHelper,newGMHelper,node);addAttributes.call(this,this.definition,newGMHelper,newTemplateID);addMetricsKeyword.call(this,this.definition,oldGMHelper,newGMHelper);addMetrics.call(this,this.definition,newGMHelper,newTemplateID);addRowColumnAdditionalMetricsZones.call(this,newGMHelper);}function transition(oldTemplateID,newTemplateID,actions,node){var newGMHelper=new $VIZ.GraphMatrixHelper({data:node.data,visType:newTemplateID}),oldGMHelper,templateActions=[],thresholdActions=[],chartInfo;if(this.isGraphMatrix(oldTemplateID)){oldGMHelper=new $VIZ.GraphMatrixHelper({data:node.data});oldGMHelper.setData(node.data.dz);oldGMHelper.setMetricsDropZone(node.data.dz);chartInfo=this.chartInfo=this.vis.getChartInfo();newGMHelper.metricsDropZone=oldGMHelper.metricsDropZone;newGMHelper.secondaryMetricsDropZone=oldGMHelper.secondaryMetricsDropZone;}if(this.isGraphMatrix(oldTemplateID)){if(chartInfo.isPie||chartInfo.isRing){transitionFromGraphMatrixPie.call(this,oldGMHelper,newGMHelper);}}var isGridChart=chartInfo&&chartInfo.isGrid,isBubbleOrScatter=chartInfo&&chartInfo.isBubbleOrScatter,isABL=chartInfo&&chartInfo.isABL,isCombo=chartInfo&&chartInfo.isCombo,isPie=chartInfo&&(chartInfo.isPie||chartInfo.isRing),isHeatMap=(oldTemplateID===$VIZTEMPLATES.HEATMAP),isNetwork=(oldTemplateID===$VIZTEMPLATES.NETWORK),isMap=(oldTemplateID===$VIZTEMPLATES.GOOGLEMAP||oldTemplateID===$VIZTEMPLATES.ESRIMAP),isImageLayout=(oldTemplateID===$VIZTEMPLATES.IMAGELAYOUT),newIsBubbleOrScatter=isBubbleOrScatterGraphMatrix(newTemplateID),newIsABL=isABLGraphMatrix(newTemplateID),newIsCombo=isComboGraphMatrix(newTemplateID),newIsPie=(newTemplateID===GRAPHMATRIXPIE||newTemplateID===GRAPHMATRIXRING);if(newIsABL){if(isGridChart){transitionFromGridChartToABL.call(this,oldGMHelper,newGMHelper,node);}else{if(isCombo){transitionFromComboToABL.call(this,oldGMHelper,newGMHelper,node);}else{if(isBubbleOrScatter||isPie){if(isABL){newGMHelper.clone(oldGMHelper);newGMHelper.sliceObjects=[];newGMHelper.angleObjects=[];}if(isPie){transitionFromPieToAnyChart.call(this,oldGMHelper,newGMHelper,node);}if(!isABL){transitionFromBubbleToABL.call(this,oldGMHelper,newGMHelper,node);}}else{if(isABL){newGMHelper.clone(oldGMHelper);if(isAreaChart(newTemplateID)&&newGMHelper.sizeByObjects.length){var occurance=this.vis.zonesModel.gmZones.hGetItemOccurrence(newGMHelper.sizeByObjects[0],[XAXIS,YAXIS,COLORBY,ANGLEBY]);if(occurance.length===0){hMoveUnitsToZoneByType(newGMHelper.sizeByObjects,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}newGMHelper.sizeByObjects=[];}else{newGMHelper.handled=true;var gm=this.vis;gm.setWidgetPropertyValue($GM.WidgetPropertyTag.METRIC_SHAPES,{});gm.setWidgetPropertyValue("visType",newGMHelper.visType);gm.writeGlobalProperty("Shape",$SHAPE_TYPES[this.definition.Properties[$GMH.PROP_SHAPE].toUpperCase()]);}}else{if(isHeatMap){transitionHeatmapToABL.call(this,newGMHelper,node);}else{if(isNetwork){transitionNetworkToABL.call(this,newGMHelper,node);}else{if(isMap){transitionMapToABL.call(this,oldTemplateID,newGMHelper,node);}else{if(isImageLayout){transitionImageLayoutToABL.call(this,newGMHelper,node);}else{doFlashTransition.call(this,oldTemplateID,newTemplateID,actions,node,newGMHelper,oldGMHelper);}}}}}}}}}else{if(newIsCombo){if(isCombo){newGMHelper.clone(oldGMHelper);}else{if(isABL||isPie){if(isPie){transitionFromPieToAnyChart.call(this,oldGMHelper,newGMHelper,node);}transitionFromABLToCombo.call(this,oldGMHelper,newGMHelper);}else{if(isBubbleOrScatter){transitionFromBubbleToCombo.call(this,oldGMHelper,newGMHelper);}else{if(isGridChart){transitionFromGridChartToCombo.call(this,oldGMHelper,newGMHelper);}else{transitionToGraphMatrixCombo.call(this,oldTemplateID,oldGMHelper,newGMHelper,node);}}}}}else{if(newIsBubbleOrScatter){if(isGridChart){transitionFromGridChartToBubble.call(this,oldGMHelper,newGMHelper,node);}else{if(isCombo){transitionFromComboToBubble.call(this,oldGMHelper,newGMHelper,node);}else{if(oldTemplateID===$VIZTEMPLATES.GRID){transitionFromGridToBubble.call(this,newGMHelper,node);}else{if(isABL||isPie){if(isPie){transitionFromPieToAnyChart.call(this,oldGMHelper,newGMHelper,node);}transitionFromABLToBubble.call(this,oldGMHelper,newGMHelper,node);}else{if(isHeatMap){transitionHeatmapToBubble.call(this,newGMHelper,node);}else{if(isNetwork){transitionNetworkToBubble.call(this,newGMHelper,node);}else{if(isBubbleOrScatter){newGMHelper.clone(oldGMHelper);}else{if(isMap){transitionMapToBubble.call(this,oldTemplateID,newGMHelper,node);}else{if(isImageLayout){transitionImageLayoutToBubble.call(this,newGMHelper,node);}else{doFlashTransition.call(this,oldTemplateID,newTemplateID,actions,node,newGMHelper,oldGMHelper);}}}}}}}}}}else{if(newIsPie){if(isPie){newGMHelper.clone(oldGMHelper);}else{transitionToGraphMatrixPie.call(this,oldTemplateID,oldGMHelper,newGMHelper,node);}}else{doFlashTransition.call(this,oldTemplateID,newTemplateID,actions,node,newGMHelper,oldGMHelper);}}}}addProperties.call(this,this.definition,newGMHelper);addThresholds.call(this,node,newGMHelper,thresholdActions);if(newIsPie){addSubTotalOnSliceAttr.call(this,newGMHelper,actions,node);}clearAllSubTotals.call(this,node,thresholdActions);var dzActions=newGMHelper.getAddDropZonesAction();dzActions.actions=templateActions.concat(dzActions.actions).concat(thresholdActions);if(dzActions.actions.length){actions.push(dzActions);}return newGMHelper;}function getTransistionInfo(oldTemplateID,newTemplateID,actions,node){this.templateInfo=getTemplateInfo.call(this,node);this.definition=getDefinition.call(this,newTemplateID);var gmHelper=transition.call(this,oldTemplateID,newTemplateID,actions,node);return{wp:gmHelper.getXml(),handled:gmHelper.handled};}mstrmojo.vi.viz.GMVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.GMVisualizationTransition",templateInfo:null,definition:null,markedObjects:null,chartInfo:null,init:function init(props){this._super(props);this.markedObjects=[];},transitionDropZones:function transitionDropZones(actions,vt){var transitionData,vis=this.vis,data=vis.node.data,curVisName=data.visName||$GRID,fnMapNewTemplate=function(w,vt){var vtIsObj=(typeof vt==="object"),newVT=vtIsObj?vt.v:vt;if(isHorizontalGraphMatrix2(w.node)&&vtIsObj){newVT=vt.h;}return newVT;};vt=fnMapNewTemplate.call(this,vis,vt);switch($KNOWN_VIZ.getDefinition(curVisName).id){case $KNOWN_VIZ.GRAPHMATRIX:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.UNKNOWN_GRAPHMATRIX_TYPE,vt,actions,vis.node);break;case $KNOWN_VIZ.ESRIMAP:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.ESRIMAP,vt,actions,vis.node);break;case $KNOWN_VIZ.GOOGLEMAP:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.GOOGLEMAP,vt,actions,vis.node);break;case $KNOWN_VIZ.HEATMAP:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.HEATMAP,vt,actions,vis.node);break;case $KNOWN_VIZ.IMAGELAYOUT:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.IMAGELAYOUT,vt,actions,vis.node);break;case $KNOWN_VIZ.NETWORK:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.NETWORK,vt,actions,vis.node);break;default:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.GRID,vt,actions,vis.node);break;}return transitionData;}});}());