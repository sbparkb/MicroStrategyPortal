(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Pulldown");mstrmojo.requiresDescs(13574,134,1052,1053,12343,12362,12363,12364,3627,12365,13995,14551);var constants=mstrmojo.Refine.RefineConstants;function escapeSpecial(str){str=str.replace(/\n/g,"\\n");str=str.replace(/\t/g,"\\t");return str;}function replaceDollar(str){return str.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function applyOperations(){var i,operations=[],operation,transformation,columns,index,columnName,transformationList,idx;transformation=this.parent;columns=transformation.columns;index=columns.selectedIndex;if(index===undefined){return ;}columnName=(columns.items[index]).name;transformationList=transformation.transformationList;idx=transformationList.subType%10;switch(idx){case 0:if(!this.optionsBox.fixed.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var s="["+this.optionsBox.fixed.value+"]";var lengths=[];try{var a=JSON.parse(s);for(i=0;i<a.length;i++){if(typeof a[i]==="number"){lengths.push(a[i]);}}if(lengths.length===0){mstrmojo.alert(mstrmojo.desc(13995,"The given field lengths are not properly formatted."));return ;}}catch(e){mstrmojo.alert(mstrmojo.desc(13995,"The given field lengths are not properly formatted."));return ;}operation=JSON.parse(JSON.stringify(this.operations.byFieldLengths));operation.description=operation.description.replace("[column name]",columnName);operation.columnName=columnName;operation.fieldLengths=lengths;break;case 1:case 2:case 3:if(!this.optionsBox.separatorBox.separator.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(idx===1){operation=JSON.parse(JSON.stringify(this.operations.bySeparator));}else{if(idx===2){operation=JSON.parse(JSON.stringify(this.operations.beforeFirst));}else{operation=JSON.parse(JSON.stringify(this.operations.afterLast));}}operation.description=operation.description.replace("[column name]",columnName);operation.columnName=columnName;operation.separator=this.optionsBox.separatorBox.separator.value;if(this.optionsBox.separatorBox.separatorList.selectedIndex===7){operation.regex=true;operation.description=operation.description.replace("####","/"+this.optionsBox.separatorBox.separator.value+"/");}else{operation.description=operation.description.replace("####","'"+escapeSpecial(replaceDollar(this.optionsBox.separatorBox.separator.value))+"'");}break;case 4:operation=JSON.parse(JSON.stringify(this.operations.cellIntoRow));operation.description=operation.description.replace("[column name]",columnName);operation.columnName=columnName;operation.keyColumnName=this.controller.model.columns.keyColumnName;operation.separator=this.optionsBox.separatorBox2.separator.value;break;}operation.engineConfig=JSON.parse(this.controller.model.engine);operations.push(operation);this.controller.applyOperations({operations:JSON.stringify(operations),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.fixed.set("value","");this.optionsBox.separatorBox.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox.separator.set("value",",");this.optionsBox.separatorBox2.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox2.separator.set("value",",");}mstrmojo.Refine.RefineControlSplit=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlSplit",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},bindings:{visible:function(){return(this.parentBox.transformationList.type===constants.transformationType.Split);}},operations:null,children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.TextBox",alias:"fixed",cssClass:"refine-split-fromto",emptyText:mstrmojo.desc(14551,"List of integers separated by commas, e.g., 5, 7, 15"),tooltip:mstrmojo.desc(14551,"List of integers separated by commas, e.g., 5, 7, 15"),valueChangeDelay:200,onvalueChange:function(evt){var value=evt.value;value=value.replace(/[^0-9,]/g,"");this.set("value",value);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===0);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"Comma")},{n:mstrmojo.desc(1053,"Tab")},{n:mstrmojo.desc(12343,"Whitespace")},{n:mstrmojo.desc(12362,"Newline")},{n:mstrmojo.desc(12363,"Pipe")},{n:mstrmojo.desc(12364,"Period")},{n:mstrmojo.desc(3627,"Other")},{n:mstrmojo.desc(12365,"regex")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6||this.selectedIndex===7){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0&&this.parent.parent.parentBox.transformationList.subType%10!==4);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox2",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"Comma")},{n:mstrmojo.desc(1053,"Tab")},{n:mstrmojo.desc(12343,"Whitespace")},{n:mstrmojo.desc(12362,"Newline")},{n:mstrmojo.desc(12363,"Pipe")},{n:mstrmojo.desc(12364,"Period")},{n:mstrmojo.desc(3627,"Other")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){applyOperations.call(this.parent.parent);}}]}]});}());