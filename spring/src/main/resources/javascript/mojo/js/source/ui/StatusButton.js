(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.MenuConfig");var _S=mstrmojo.string,_D=mstrmojo.dom,_CORNER=mstrmojo.ui.PopupConfig.ENUM_CORNERS;function popupStatusMenu(){var me=this,statusList=me.statusList,len=statusList&&statusList.length||0,menuConfig=me.statusConfig||new mstrmojo.ui.menus.MenuConfig(),menuHandler=function(item){return function(menuItem){me.set("status",item);me.onStatusClick(item);};};if(!menuConfig.hasMenuItems()&&len){for(var i=0;i<len;i++){var item=statusList[i];menuConfig.addMenuItem(item.n,item.cls||"",menuHandler(item),me);}}else{}if(menuConfig.hasMenuItems()){menuConfig.alignment=me.alignment||{host:_CORNER.BOTTOM_LEFT,popup:_CORNER.TOP_LEFT};menuConfig.hostId=me.id;menuConfig.hostElement=me[me.hostElementName]||me.domNode;me.openPopup(menuConfig.newInstance());}}function updateButtonVisibility(){var showMenuButton=this.statusConfig||this.statusList&&this.statusList.length>1;this.menuButtonNode.style.display=showMenuButton?"":"none";}mstrmojo.ui.StatusButton=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.ui.StatusButton",markupString:'<div id="{@id}" class="mstrmojo-StatusButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}"><div class="mstrmojo-Button {@innerIconClass}"  mstrAttach:click><span class="mstrmojo-text"></span></div><div class="menuButton" mstrAttach:click></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},textSpanNode:function(){return this.domNode.firstChild.firstChild;},menuButtonNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onstatusChange:function(){this.textSpanNode.innerHTML=_S.encodeHtmlString(this.status&&this.status.n||"");},onstatusListChange:function(){updateButtonVisibility.call(this);},onstatusConfigChange:function(){updateButtonVisibility.call(this);}},status:null,statusList:null,statusConfig:null,onclick:function(evt){var t=_D.eventTarget(evt.hWin,evt.e);if(_D.contains(this.menuButtonNode,t,true)){popupStatusMenu.call(this);}else{if(_D.contains(this.textNode,t,true)){this.onButtonClick(this.status,evt);}}},onButtonClick:mstrmojo.emptyFn,onStatusClick:mstrmojo.emptyFn});}());