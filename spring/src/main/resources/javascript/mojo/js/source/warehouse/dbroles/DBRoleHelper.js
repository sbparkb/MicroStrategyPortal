(function(){var $FULLCONNECTION="FULLCONNECTION",MSTR_CUSTOM_SETTING="MSTR_CUSTOM";function cleanIndex(nameToCheck,currentIndex){var $S=mstrmojo.string;nameToCheck=$S.trim(nameToCheck);var pattern=/\(\d+\)$/,match=pattern.exec(nameToCheck);if(match){currentIndex.v=parseInt(nameToCheck.substring(match.index+1,nameToCheck.length-1),10);return $S.trim(nameToCheck.substring(0,match.index));}return nameToCheck;}mstrmojo.warehouse.dbroles.DBRoleHelper=mstrmojo.provide("mstrmojo.warehouse.dbroles.DBRoleHelper",{isNumeric:function isNumeric(n){return !isNaN(parseFloat(n))&&isFinite(n);},getUniqueName:function getUniqueName(nameToCheck){nameToCheck=cleanIndex(nameToCheck,{});var dbroles=mstrApp.rootController.getDBRoles(),isCloud=mstrApp.rootController.isCloud(),allDBRoleNames=mstrApp.rootController.getAllDBRoleNames(),loopName,count=0,currentIndex={},maxIndex=0,tempName=nameToCheck,checker=function(dbrole){tempName=nameToCheck;if(isCloud){loopName=cleanIndex(dbrole.des,currentIndex);}else{loopName=cleanIndex(dbrole.n,currentIndex);}maxIndex=Math.max(maxIndex,currentIndex.v)||0;if(loopName.toString().toUpperCase()===tempName.toString().toUpperCase()){count=maxIndex+1;}};do{if(!isCloud){mstrmojo.hash.forEach(allDBRoleNames,checker);if(count===0){mstrmojo.array.forEach(dbroles,checker);}}else{mstrmojo.array.forEach(dbroles,checker);}if(count>0){tempName=nameToCheck+" ("+count+")";}}while(mstrApp.rootController.findinArray(dbroles,"n",tempName)>=0);return tempName;},cleanDSNConnection:function cleanDSNConnection(connstr){connstr=mstrmojo.string.trim(connstr).replace(/\\/g,"\\\\");connstr=this.cleanDSNConnectionPlaceHolders(connstr);connstr=connstr.replace(/\\/g,"^^^789^^^");connstr=connstr.replace(/:/g,"!!!789!!!");connstr=connstr.replace(/,/g,"%%%789%%%");connstr=connstr.replace("\\","###789###");connstr=connstr.replace(/{/g,"+++789+++");connstr=connstr.replace(/}/g,"@@@789@@@");connstr=connstr.replace("FULLCONNECTION=","");return connstr;},cleanDSNConnectionPlaceHolders:function cleanDSNConnection(connstr){connstr=connstr.replace(/!#AT#!/g,"@");connstr=connstr.replace(/!#QUESTION#!/g,"?");connstr=connstr.replace(/!#AND#!/g,"&");connstr=connstr.replace("!#DRIVERSUFFIX#!","");return connstr;},cleanLoadedDSNConnection:function cleanLoadedDSNConnection(connstr,dbID){var tokens;connstr=mstrmojo.string.trim(connstr);if(dbID===19){tokens=connstr.split(";");mstrmojo.array.forEach(tokens,function(token,i){if(token.search(/^\s*DBQ=/)===-1){tokens[i]=token.replace(/\\\\/g,"\\");}});connstr=tokens.join(";");}else{connstr=connstr.replace(/\\\\/g,"\\");}connstr=connstr.replace(/@/g,"!#AT#!");connstr=connstr.replace(/\?/g,"!#QUESTION#!");connstr=connstr.replace(/&/g,"!#AND#!");return connstr;},driverAvailable:function driverAvailable(dbc){if((dbc.str.indexOf($FULLCONNECTION)===0)&&(dbc.driver===""||dbc.driver==="XQUERY")){return true;}return(mstrmojo.array.find(this.drivers,"nU",dbc.driver.toUpperCase())>=0);},driverExists:function driverExists(connections){var $this=this,exists=false,driver="",index=0,$DBHLP=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.array.forEach(connections,function(dbc,idx){if($DBHLP.driverAvailable.call($this,dbc)){exists=true;driver=dbc.driver;index=idx;}return !exists;});return{exists:exists,driver:driver,idx:index};},cleanDriver:function cleanDriver(connectionString){var strDriver="DRIVER=",driverIdx=connectionString.toUpperCase().indexOf(strDriver),driver="";if(driverIdx>=0){driverIdx+=strDriver.length;driver=connectionString.substring(driverIdx,driverIdx+connectionString.substring(driverIdx).indexOf(";"));driver=driver.replace(/([\{\}])+/g,"");}return driver;},isCustomConnection:function isCustomConnection(connectionString){return(connectionString.indexOf(MSTR_CUSTOM_SETTING)>=0);},showHelp:function showHelp(helpLink){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(helpLink);}else{var helpUrl=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");window.open(helpUrl+(helpLink||""),"_blank");return false;}}});}());