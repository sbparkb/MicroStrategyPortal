(function(){mstrmojo.requiresCls("mstrmojo.dnd","mstrmojo.CheckBox","mstrmojo.Editor");var privateFlg=2,sharedFlg=1;mstrmojo.SegmentSaveAs=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SegmentSaveAs",title:"Save As",cssClass:"mstrmojo-SegmentSaveAs",name:"New Segment",desc:"",doc:null,children:[{scriptClass:"mstrmojo.HBox",alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput",bindings:{value:"this.parent.parent.name"}}]},{scriptClass:"mstrmojo.ImageCheckBox",alias:"shared",checked:false,label:"Save as shared"},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",alias:"btns",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.HTMLButton",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-Editor-button",onclick:function(){this.parent.parent.saveSegment();},bindings:{enabled:function(){var v=this.parent.parent.contPanel.name.value;return(v&&v.length);}}},{scriptClass:"mstrmojo.HTMLButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-Editor-button",onclick:function(){this.parent.parent.close();}}]}],onvisibleChange:function(evt){if(this.visible){this.contPanel.name.focus();}},saveSegment:function(overwrite){var me=this,s=me.shared.checked,n=me.contPanel.name.value,nk=(me.fps&&me.fps.k)?me.fps.k:"",fg=s?sharedFlg:privateFlg,okbtn=me.btns.ok,calbtn=me.btns.cancel,params={taskId:"saveSegment",objName:n,saveAsFlags:((!!overwrite)?16777216:0)|fg,nodeKey:nk,rwb:me.fps.model.bs};var saveAsCB={success:function(res){var n=me.contPanel.name.value;mstrmojo.alert('"'+n+'" successfully saved',null,mstrmojo.desc(7984,"Object Saved"));okbtn.set("enabled",true);calbtn.set("enabled",true);me.close();},failure:function(res){okbtn.set("enabled",true);calbtn.set("enabled",true);var n=me.contPanel.name.value,ec=parseInt(res.getResponseHeader("X-MSTR-TaskErrorCode"),10)+4294967296;if(ec==2147749923){mstrmojo.confirm("Filter "+n+" already exists. Do you want to replace it?",{confirmBtn:{fn:function(){me.saveSegment(true);}}},{title:mstrmojo.desc(3179)});me.close();}else{mstrmojo.alert("Error while Saving:"+res.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(!n){mstrmojo.alert("name can't be empty!");return ;}okbtn.set("enabled",false);calbtn.set("enabled",false);mstrmojo.xhr.request("POST",mstrmojo.App.taskURL,saveAsCB,params);}});})();