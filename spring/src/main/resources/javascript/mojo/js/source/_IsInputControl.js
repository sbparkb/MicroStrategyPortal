(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.num","mstrmojo.array","mstrmojo.DICFactory");var INPUT_VALUES_MANUAL=1,POPUP_INLINE=0,POPUP_ABOVE=1,POPUP_BELOW=2,decimal=".",$D=mstrmojo.dom,$C=mstrmojo.css,$H=mstrmojo.hash,TAB_KEY=mstrmojo.Enum_Keys.TAB,isNumType=function(dt){return(dt>=1&&dt<=7)||dt==21||dt==22||dt==30;},convertEmtoPx=function(dom,v){if($D.isIE&&!/px$/.test(v)){var img=document.createElement("img"),pl;img.style.zIndex=-1;img.style.left=v;dom.appendChild(img);pl=img.style.pixelLeft;dom.removeChild(img);return pl+"px";}return v;},_getScaleStyle=function(dom,n){return parseInt(convertEmtoPx(dom,$C.getStyleValue(dom,n)),10)||0;},getPadding=function(dom){return{lp:_getScaleStyle(dom,"paddingLeft"),rp:_getScaleStyle(dom,"paddingRight"),tp:_getScaleStyle(dom,"paddingTop"),bp:_getScaleStyle(dom,"paddingBottom")};},getFontStyle=function(dom){var s=$C.getComputedStyle(dom)||dom.currentStyle;return{fontFamily:s.fontFamily,fontSize:convertEmtoPx(dom,s.fontSize),fontStyle:s.fontStyle,fontVariant:s.fontVariant,fontWeight:s.fontWeight,textAlign:s.textAlign};},lockInfoWindow=function(widget,isLock){var infowindow=mstrmojo.findAncestor(widget,"scriptClass","mstrmojo.DocInfoWindow");if(!!infowindow){infowindow[isLock?"registerLock":"releaseLock"](this);}};mstrmojo._IsInputControl={_mixinName:"_IsInputControl",dic:null,owner:null,openerNode:null,popupStyle:POPUP_INLINE,items:null,applyOnEnter:true,lv:null,init:function(props){if(this._super){this._super(props);}var dic=this.dic,dt=dic.dt,_DTP=mstrmojo.expr.DTP,dtObj,arr=[];if(mstrApp.useBinaryFormat){if(dt==_DTP.DATE||dt==_DTP.TIME||dt==_DTP.TIMESTAMP){dtObj=mstrmojo.date.parseDateAndOrTime(this.value);if(dtObj){if(dt!=_DTP.TIME){arr.push(mstrmojo.date.formatDateInfo(dtObj.date,mstrmojo.locales.datetime.DATEOUTPUTFORMAT));}if(dt!=_DTP.DATE){arr.push(mstrmojo.date.formatTimeInfo(dtObj.time,mstrmojo.locales.datetime.TIMEOUTPUTFORMAT));}this.value=arr.join(" ");}}}this.lv=this.value;if(dic.wm&&dic.w===undefined){dic.wm=0;}},showByDefault:false,hasPreview:false,getItems:function(){var dic=this.dic,m=[],i,v,nm=0,dv=String(dic.itv),dx=dv&&dv.indexOf(decimal),isNumeric=isNumType(dic.dt);if(dx>=0){nm=dv.substring(dx+1).length;}if(parseInt(dic.ipt,10)===0){for(i=0,v=dic.min;v<dic.max+0.00001;i++,v+=dic.itv){m[i]={n:mstrmojo.num.toLocaleString(nm>0?v.toFixed(nm):v),v:v};}}else{m=dic.vls;mstrmojo.array.forEach(m,function(mi){if(mi.n===undefined){mi.n=isNumeric?mstrmojo.num.toLocaleString(mi.v):mi.v;}});}return m;},font:null,onfontChange:function(){if(this.getInputNode){var node=this.getInputNode(),f=this.font;$H.forEach(f,function(o,i){node.style[i]=o;});}},getOpenerNodeStyle:function(){var s=this.group&&this.group.ons,p=this.openerNode;if(!s){s=getPadding(p);s.hp=s.lp+s.rp;s.vp=s.tp+s.bp;s.iw=Math.max(0,p.clientWidth-s.hp);s.ih=Math.max(0,p.clientHeight-s.vp);if(this.group){this.group.ons=s;}}return s;},onvalueChange:function(){if(this._super){this._super();}this.dicChanged=true;if(this.showByDefault&&(!this.isDicWidgetReady||this.isDicWidgetReady())){this.applyChanges();}else{if(this.popupStyle!==POPUP_INLINE&&this.popup&&this.popup.enableApply){this.popup.enableApply();}}},preBuildRendering:function(){if(this._super){this._super();}this.openerNode=this.openerNode||this.owner.domNode;if(this.showByDefault){this.openerStyle=this.getOpenerNodeStyle();if(this.inlineExtraCssText){this.cssText+=" "+this.inlineExtraCssText;}}if(!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}},postBuildRendering:function(){var target=this.openerNode;if(this._super){this._super();}if(!mstrmojo.isDescendant(this.owner,this)){if(this.showByDefault){var domNode=this.domNode;if(!(this.handleDisable()||this.enabled)){var container=document.createElement("div"),curtain=document.createElement("div");container.className="DIC-Container";curtain.className="curtain";container.appendChild(domNode);container.appendChild(curtain);domNode=container;}target.innerHTML="";target.appendChild(domNode);}this.set("font",getFontStyle(target));}if(mstrmojo.DICConfig.isKeyNavigable(this.dic)){this.registerKeyEvents(this.domNode);}},applyChanges:function(){var lv=this.lv,v=this.getCurValue?this.getCurValue():this.value,d=this.openerNode,dv=this.getDisplayValue?this.getDisplayValue():v,dt=this.dic.dt,_DTP=mstrmojo.expr.DTP,LD=mstrmojo.locales.datetime;if(String(v)!==String(lv)){if(mstrApp.useBinaryFormat){if(dt==_DTP.TIME||dt==_DTP.TIMESTAMP){v=v.replace(new RegExp(LD.AM_NAME),"AM").replace(new RegExp(LD.PM_NAME),"PM");}}this.lv=v;this.dv=dv;if(this.owner&&this.owner.dataChanged){this.owner.dataChanged(this.k,lv,{dv:dv,v:v},d,this.dic.k);}}return true;},cancelChanges:function cancelChanges(){this.value=this.lv;},showInPopup:function(){this.popup=mstrmojo.DICFactory.createDICPopup(this.owner,this);if(this.focus&&!mstrApp.useBinaryFormat){this.focus();}this.setInfoWindowLock(true);},lockPopup:function(){this.setInfoWindowLock(false);},renderPreview:null,onTabDown:function(evt){mstrmojo.dom.preventDefault(window,evt);if(this.applyChanges()!==false){if(this.popup){this.popup.close();}this.owner.editNext(this.k);this.cleanup();}},cleanup:mstrmojo.emptyFn,registerKeyEvents:function(dom){var me=this;$D.attachEvent(dom,"keydown",function(evt){var e=evt||window.event;if(e.keyCode===TAB_KEY){me.onTabDown(evt);}});if($D.isIE){$D.attachEvent(dom,"keyup",function(evt){var e=evt||window.event;if(e.keyCode===TAB_KEY){me.focus();}});}},setInfoWindowLock:function(isLock){lockInfoWindow.call(this,this.owner,isLock);},handleDisable:function(){return true;}};}());