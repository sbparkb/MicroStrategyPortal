(function(){mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphMarkerShape","EnumDSSGraphRegressionType","EnumDSSGraphDataTextPosition","EnumShapeType","EnumDSSGraphObject");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumLayout","EnumOrientation","EnumValueAxis","EnumFillType","EnumAnchorPoint","EnumGraphMatrixMarkerTypeInChart","EnumLineStyle","EnumImageUsage","EnumAxisDirection","EnumGraphMatrixMarkerTypeInChart","EnumGraphMatrixPiePlotType","EnumGraphMatrixThemeType","EnumGraphMatrixElementSizeMode","EnumCollectionType","EnumFontStyle");mstrmojo.requiresClsP("mstrmojo.chart","GraphObjectManager","CategoryPlot","PiePlotRenderer","Rect2D","Vector2D","NumberObject","MarkerObject","FormatFill","Point2D","GMDataLabelInfo");mstrmojo.requiresCls("mstrmojo.chart.common.MapStructure","mstrmojo.VisUtility");var $C=mstrmojo.chart,$CHART_COMMON=$C.common,$CHART_ENUMS=$C.enums,$K=$C.ChartConstants,$VISUTIL=mstrmojo.VisUtility,$LAYOUT=$CHART_ENUMS.EnumLayout,$OR=$CHART_ENUMS.EnumOrientation,$VA=$CHART_ENUMS.EnumValueAxis,$AP=$CHART_ENUMS.EnumAnchorPoint,$GM_MarkerStyle=$CHART_ENUMS.EnumGraphMatrixMarkerTypeInChart,$AXIS_DIRECTION=$CHART_ENUMS.EnumAxisDirection,$IMG_USAGE=$CHART_ENUMS.EnumImageUsage,$GMPPT=$CHART_ENUMS.EnumGraphMatrixPiePlotType,$CT=$CHART_ENUMS.EnumCollectionType;var $M=$C.model,$MODEL_ENUMS=$M.enums,$MS=$MODEL_ENUMS.EnumDSSGraphMarkerShape,$RT=$MODEL_ENUMS.EnumDSSGraphRegressionType,$DTP=$MODEL_ENUMS.EnumDSSGraphDataTextPosition,$SHP=$MODEL_ENUMS.EnumShapeType,$GM_ESM=$CHART_ENUMS.EnumGraphMatrixElementSizeMode,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$FS=$CHART_ENUMS.EnumFontStyle;var $Utility=$C.common.Utility;var kZeroTolerance=1e-10,kSlopeTolerance=0.00001,kDataLabelShowValue=2,kDataLabelShowText=3,kRefLabelPosition1=1,kRefLabelPosition2=2,kRefLabelPosition3=3,kRefLabelPosition4=4,kRefLabelPosition5=5,kRefLabelPosition6=6;var dataLabelFormat=new $C.ChartAdvFormat(),centralDataLabelPoint=new $C.Point2D(),maxDataLabelPoint=new $C.Point2D(),minDataLabelPoint=new $C.Point2D();function compareRefLabelCandidates(a,b){var diff;if(a.cannotFitVertically===true&&b.cannotFitVertically===false){return 1;}if(a.cannotFitVertically===false&&b.cannotFitVertically===true){return -1;}if(a.cannotFitHorizontally===true&&b.cannotFitHorizontally===false){return 1;}if(a.cannotFitHorizontally===false&&b.cannotFitHorizontally===true){return -1;}diff=a.overlapRefLabelCount-b.overlapRefLabelCount;if(diff<0){return -1;}if(diff>0){return 1;}diff=a.overlapRefLineCount-b.overlapRefLineCount;if(diff<0){return -1;}if(diff>0){return 1;}diff=a.overlapDataLabelCount-b.overlapDataLabelCount;return diff;}function hMapSeriesShapeToMakerShape(shape){switch(shape){case $SHP._CIRCLE:return $MS.DssGraphMarkerShapeCircle;case $SHP._RECTANGLE:return $MS.DssGraphMarkerShapeRectangle;case $SHP._SQUARE:return $MS.DssGraphMarkerShapeSquare;case $SHP._TICKER:return $MS.DssGraphMarkerShapeGMTick;default:return $MS.DssGraphMarkerShapeNone;}}function hGetGMPiePosition(infoIndex,xInput,yInput,xSubIndex,ySubIndex,xSectionCount,ySectionCount){var x=-1,y=-1,value=-1,point=new $C.Point2D({x:-1,y:-1}),ablContext=this.mpABLPlotContext,categoryAxis=ablContext.mCategoryAxisPtr,valueAxisSet=ablContext.mValueAxis;if(this.mIsVertical){x=categoryAxis.getSubGroupMiddlePos(xInput,xSubIndex,xSectionCount);value=valueAxisSet[this.mSeriesInfo[infoIndex].mValueAxis].GetPositionByValue(yInput);if(value!==null){y=value;}}else{y=categoryAxis.getSubGroupMiddlePos(yInput,ySubIndex,ySectionCount);value=valueAxisSet[this.mSeriesInfo[infoIndex].mValueAxis].GetPositionByValue(xInput);if(value!==null){x=value;}}if(x>=0&&y>=0){point.x=x;point.y=y;}return point;}function hGetPieCenter(seriesInfo,groupId,angleIndex,angleNumber){var xInput=0,yInput,xSubInput,ySubInput,xSectionCount=1,ySectionCount=1,angleCount,value,key=[seriesInfo,groupId,angleIndex];if(this.mPieCentersPool===null){this.mPieCentersPool=new $CHART_COMMON.MapStructure();}var point=this.mPieCentersPool.find(key);if(point!==null&&point!==undefined){return point;}angleCount=angleNumber||this.mDatasetPtr.GetPieCountAtOneDataPoint(this.mSeriesInfo[seriesInfo].mSeriesId,groupId);if(this.mIsVertical){xSectionCount=angleCount;}else{ySectionCount=angleCount;}value=this.GetData(seriesInfo,groupId);if(value!==null){xInput=value;}xSubInput=this.mSeriesInfo[seriesInfo].mSeriesId;yInput=groupId;ySubInput=angleIndex;if(this.mIsVertical){var temp;temp=xInput;xInput=yInput;yInput=temp;temp=xSubInput;xSubInput=ySubInput;ySubInput=temp;}point=hGetGMPiePosition.call(this,seriesInfo,xInput,yInput,xSubInput,ySubInput,xSectionCount,ySectionCount);this.mPieCentersPool.replace(key,point);return point;}function hDrawTrendLine(){var size=this.mTrendLineObjects.length,i;for(i=0;i<size;++i){this.mTrendLineObjects[i].Draw();}}function hDrawRefLine(){var size=this.mReferenceLineObjects.length,i;for(i=0;i<size;++i){this.mReferenceLineObjects[i].Draw();}}function hGetValidValueNum(valArray){var i,validValueNum=0;for(i=0;i<valArray.length;i++){if(valArray[i]!==null){validValueNum++;}}return validValueNum;}function hCalcTrendLinePoint(seriesIndex,groupId,value,valueAxis,isVertical,isLinear){var riserInfo,position,categoryPos,valuePos,xVal,yVal,point;if(this instanceof mstrmojo.chart.BarSeriesRenderer){riserInfo={groupID:groupId,seriesInfoID:seriesIndex,groupIndex:0,useFloat:!isLinear};if(isLinear){position=this.GetRiserStartPosAndSize(riserInfo);valuePos=valueAxis.GetPositionByValue(value);}else{position=this.GetRiserStartPosAndSize(riserInfo);valuePos=valueAxis.GetFloatPositionByValue(value);}categoryPos=position.Start+position.Size/2;}else{if(this instanceof mstrmojo.chart.AreaSeriesRenderer||this instanceof mstrmojo.chart.LineSeriesRenderer){if(isLinear){categoryPos=this.mpABLPlotContext.mCategoryAxisPtr.getGroupMiddlePos(groupId);valuePos=valueAxis.GetPositionByValue(value);}else{categoryPos=this.mpABLPlotContext.mCategoryAxisPtr.getFloatGroupMiddlePos(groupId);valuePos=valueAxis.GetFloatPositionByValue(value);}}}xVal=isVertical?categoryPos:valuePos;yVal=isVertical?valuePos:categoryPos;point=new $C.Point2D({x:xVal,y:yVal});return point;}function hProcessPointsForTrendline(points){var i,result,numberOfOriginalPoints,slope1,slope2,skipPoint;numberOfOriginalPoints=points.length;if(numberOfOriginalPoints<=2){result=points;}else{result=[];result.push(points[0]);for(i=0;i+2<numberOfOriginalPoints;++i){skipPoint=false;if((Math.abs(points[i].x-points[i+1].x)>kZeroTolerance)&&(Math.abs(points[i+1].x-points[i+2].x)>kZeroTolerance)){slope1=(points[i+1].y-points[i].y)/(points[i+1].x-points[i].x);slope2=(points[i+2].y-points[i+1].y)/(points[i+2].x-points[i+1].x);if(Math.abs(slope1-slope2)<kSlopeTolerance){skipPoint=true;}}else{if((Math.abs(points[i].x-points[i+1].x)<=kZeroTolerance)&&(Math.abs(points[i+1].x-points[i+2].x)<=kZeroTolerance)){skipPoint=true;}else{if((Math.abs(points[i].x-points[i+1].x)>kZeroTolerance)&&(Math.abs(points[i+1].x-points[i+2].x)<=kZeroTolerance)){if(Math.abs(points[i+1].y-points[i+2].y)<=kZeroTolerance){skipPoint=true;}}}}if(!skipPoint){result.push(points[i+1]);}}result.push(points[numberOfOriginalPoints-1]);}return result;}function hGetRefLabelRectInfo(position,height,halfHeight,width,halfWidth,valuePosition,drawingAreaHeight,drawingAreaWidth,refLabelPadding,isVertical){var retVal={};retVal.rect=new $C.Rect2D({x:0,y:0,width:width+2*refLabelPadding,height:height+2*refLabelPadding});switch(position){case kRefLabelPosition1:if(isVertical){retVal.xOffset=valuePosition+refLabelPadding+halfWidth;retVal.yOffset=refLabelPadding+halfHeight;retVal.rect.x=valuePosition;retVal.rect.y=0;}else{retVal.xOffset=drawingAreaWidth-refLabelPadding-halfWidth;retVal.yOffset=valuePosition-refLabelPadding-halfHeight;retVal.rect.x=drawingAreaWidth-2*refLabelPadding-width;retVal.rect.y=valuePosition-2*refLabelPadding-height;}break;case kRefLabelPosition2:if(isVertical){retVal.xOffset=valuePosition-refLabelPadding-halfWidth;retVal.yOffset=refLabelPadding+halfHeight;retVal.rect.x=valuePosition-2*refLabelPadding-width;retVal.rect.y=0;}else{retVal.xOffset=drawingAreaWidth-refLabelPadding-halfWidth;retVal.yOffset=valuePosition+refLabelPadding+halfHeight;retVal.rect.x=drawingAreaWidth-2*refLabelPadding-width;retVal.rect.y=valuePosition;}break;case kRefLabelPosition3:if(isVertical){retVal.xOffset=valuePosition+refLabelPadding+halfWidth;retVal.yOffset=drawingAreaHeight/2;retVal.rect.x=valuePosition;retVal.rect.y=drawingAreaHeight/2-refLabelPadding-halfHeight;}else{retVal.xOffset=drawingAreaWidth/2;retVal.yOffset=valuePosition-refLabelPadding-halfHeight;retVal.rect.x=drawingAreaWidth/2-refLabelPadding-halfWidth;retVal.rect.y=valuePosition-2*refLabelPadding-height;}break;case kRefLabelPosition4:if(isVertical){retVal.xOffset=valuePosition-refLabelPadding-halfWidth;retVal.yOffset=drawingAreaHeight/2;retVal.rect.x=valuePosition-2*refLabelPadding-width;retVal.rect.y=drawingAreaHeight/2-refLabelPadding-halfHeight;}else{retVal.xOffset=drawingAreaWidth/2;retVal.yOffset=valuePosition+refLabelPadding+halfHeight;retVal.rect.x=drawingAreaWidth/2-refLabelPadding-halfWidth;retVal.rect.y=valuePosition;}break;case kRefLabelPosition5:if(isVertical){retVal.xOffset=valuePosition+refLabelPadding+halfWidth;retVal.yOffset=drawingAreaHeight-refLabelPadding-halfHeight;retVal.rect.x=valuePosition;retVal.rect.y=drawingAreaHeight-2*refLabelPadding-height;}else{retVal.xOffset=refLabelPadding+halfWidth;retVal.yOffset=valuePosition-refLabelPadding-halfHeight;retVal.rect.x=0;retVal.rect.y=valuePosition-2*refLabelPadding-height;}break;case kRefLabelPosition6:if(isVertical){retVal.xOffset=valuePosition-refLabelPadding-halfWidth;retVal.yOffset=drawingAreaHeight-refLabelPadding-halfHeight;retVal.rect.x=valuePosition-2*refLabelPadding-width;retVal.rect.y=drawingAreaHeight-2*refLabelPadding-height;}else{retVal.xOffset=refLabelPadding+halfWidth;retVal.yOffset=valuePosition+refLabelPadding+halfHeight;retVal.rect.x=0;retVal.rect.y=valuePosition;}break;}return retVal;}function hCheckRefLabelCandidate(refLabelCandidate,drawingAreaHeight,drawingAreaWidth,dataLabels,refLabels,refLinePosInfos){var rect=refLabelCandidate.rect,len,i,checkRect,currentDataLabel,curRefLine;if(rect.y<0||rect.y+rect.height>drawingAreaHeight){refLabelCandidate.cannotFitVertically=true;return ;}if(rect.x<0||rect.x+rect.width>drawingAreaWidth){refLabelCandidate.cannotFitHorizontally=true;}len=refLabels.length;for(i=0;i<len;++i){checkRect=refLabels[i].GetBoundingRect();if(rect.HasIntersection(checkRect)){++refLabelCandidate.overlapRefLabelCount;}}len=refLinePosInfos.length;for(i=0;i<len;++i){curRefLine=refLinePosInfos[i];if(curRefLine.isVertical){if(rect.x<curRefLine.position&&rect.x+rect.width>curRefLine.position){++refLabelCandidate.overlapRefLineCount;}}else{if(rect.y<curRefLine.position&&rect.y+rect.height>curRefLine.position){++refLabelCandidate.overlapRefLineCount;}}}len=dataLabels.length;for(i=0;i<len;++i){currentDataLabel=dataLabels[i];if(currentDataLabel.mIsShown){checkRect=currentDataLabel.GetBoundingRect();if(rect.HasIntersection(checkRect)){++refLabelCandidate.overlapDataLabelCount;refLabelCandidate.overlapDataLabels.push(dataLabels[i]);}}}}function hGenerateRefLineLabels(drawingAreaHeight,drawingAreaWidth,refLinePosInfos){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),refLabelPadding=gmCtx.getPadding($K.kRefLabel),numberOfRefLines=refLinePosInfos.length,curRefLine,label,width,height,halfWidth,halfHeight,textRect,i,j,k,renderingStr,refLabelCandidate,positionInfo,refLabelCandidates,len,shownDataLabels=this.mpABLPlot.shownDataLabels,shownRefLabels=this.mpABLPlot.shownRefLabels;for(i=0;i<numberOfRefLines;++i){curRefLine=refLinePosInfos[i];label=new $C.TextObject({TripleId:curRefLine.tripleId,GraphObjectManager:this,GraphCollectionObject:null,Identity:curRefLine.identity});if(label!==null){label.SetText(curRefLine.labelText);for(j=0;j<2;++j){if(j===1){renderingStr=label.mText;label.SetText(renderingStr[0]+"...");label.rect.height=0;label.rect.width=0;}textRect=label.GetBoundingRect();height=textRect.height;halfHeight=height/2;width=textRect.width;halfWidth=width/2;refLabelCandidates=[];for(k=kRefLabelPosition1;k<=kRefLabelPosition6;++k){refLabelCandidate={};refLabelCandidate.position=k;refLabelCandidate.cannotFitVertically=false;refLabelCandidate.cannotFitHorizontally=false;refLabelCandidate.overlapRefLabelCount=0;refLabelCandidate.overlapRefLineCount=0;refLabelCandidate.overlapDataLabelCount=0;refLabelCandidate.overlapDataLabels=[];positionInfo=hGetRefLabelRectInfo.call(this,k,height,halfHeight,width,halfWidth,curRefLine.position,drawingAreaHeight,drawingAreaWidth,refLabelPadding,curRefLine.isVertical);refLabelCandidate.xOffset=positionInfo.xOffset;refLabelCandidate.yOffset=positionInfo.yOffset;refLabelCandidate.rect=positionInfo.rect;hCheckRefLabelCandidate.call(this,refLabelCandidate,drawingAreaHeight,drawingAreaWidth,shownDataLabels,shownRefLabels,refLinePosInfos);refLabelCandidates.push(refLabelCandidate);}refLabelCandidates.sort(compareRefLabelCandidates);if(refLabelCandidates[0].cannotFitVertically){break;}if(refLabelCandidates[0].cannotFitHorizontally){if(i===0){continue;}else{break;}}label.MoveTo(refLabelCandidates[0].xOffset,refLabelCandidates[0].yOffset,$AP.CENTER);label.mIsShown=true;len=refLabelCandidates[0].overlapDataLabelCount;for(k=0;k<len;++k){refLabelCandidates[0].overlapDataLabels[k].mIsShown=false;}this.mpABLPlot.mPostTrendLineObjects.push(label);shownRefLabels.push(label);break;}}}}mstrmojo.chart.SeriesRenderer=mstrmojo.declare(mstrmojo.chart.GraphObjectManager,null,{scriptClass:"mstrmojo.chart.SeriesRenderer",mDeviceDataArea:null,mpABLPlot:null,mGroupCount:0,mSeriesCount:0,mDatasetPtr:null,mLegendPtr:null,mSeriesInfo:null,mCumulateData:null,mSeriesNumber:null,mTextCollection:null,mTrendLineObjects:null,mReferenceLineObjects:null,mpABLPlotContext:null,mIsVertical:true,mUseDepth:false,mHasNegativeValue:false,mDepth:0,mDepthDirection:0,mStartLevel:0,mGroupIdMapPerSeries:[],mHasSizeBy:false,mHasColorBy:false,mClippedMarkerSize:null,mPieRenderer:null,mPieCentersPool:null,renderSequence:null,init:function init(props){this._super(props);this.mSeriesInfo=[];this.mCumulateData=[[],[]];this.mClippedMarkerSize={X1:{LowOffset:0,HighOffset:0},X2:{LowOffset:0,HighOffset:0},Y1:{LowOffset:0,HighOffset:0},Y2:{LowOffset:0,HighOffset:0}};this.mSeriesNumber=[0,0];this.mTextCollection=[];this.mTrendLineObjects=[];this.mReferenceLineObjects=[];this.mDatasetPtr=props.DataSet;this.mLegendPtr=props.Legend;this.mDepth=0;this.mDepthDirection=0;this.mHasNegativeValue=false;this.mpABLPlot=this.mpManager;this.mGroupCount=this.mDatasetPtr.GetGroupCount();var ablPlotCtx=this.mpABLPlotContext=this.mpABLPlot.mABLPlotContext;this.mIsVertical=(ablPlotCtx.mABLOptions.mOrientation===$OR.OR_VERTICAL);this.mUseDepth=ablPlotCtx.mABLOptions.mUseDepth;if(this.mUseDepth){this.mDepth=this.mpABLPlot.unitLevelDepth;this.mDepthDirection=ablPlotCtx.mABLOptions.mDepthDirection;}var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext();this.mHasSizeBy=gmCtx.mHasSizeBy;this.mHasColorBy=gmCtx.mHasColorBy;this.renderSequence=[];},AddSeries:function AddSeries(iSeriesId,iSeriesIndex,iDataIndex,iValueAxis){this.mSeriesInfo.push({mSeriesId:iSeriesId,mSeriesIndex:iSeriesIndex,mDataIndex:iDataIndex,mValueAxis:iValueAxis});++this.mSeriesNumber[iValueAxis];},GetMinMaxValue:function GetMinMaxValue(valueAxis,min,max,areInitialized){var chartCtx=this.mChartContextPtr,useGlobalAutoScale,value,groupCount,seriesSet=[],i,j,k,seriesInfo=this.mSeriesInfo,tempMin,tempMax;if(seriesInfo.length===0){return{Min:min,Max:max,AreInitialized:areInitialized};}if(chartCtx.mIsUniformAxisMode){var uaCtx=chartCtx.getUniformAxisContext(),uaVA=uaCtx.ValueAxis;if(chartCtx.IsVertical()===false){if(valueAxis===0){return{Min:uaVA.X1.Min,Max:uaVA.X1.Max,AreInitialized:true};}else{return{Min:uaVA.X2.Min,Max:uaVA.X2.Max,AreInitialized:true};}}if(valueAxis===0){return{Min:uaVA.Y1.Min,Max:uaVA.Y1.Max,AreInitialized:true};}return{Min:uaVA.Y2.Min,Max:uaVA.Y2.Max,AreInitialized:true};}useGlobalAutoScale=chartCtx.mIsTimeSeriesChart&&this.mpABLPlotContext.mABLOptions.mUseGlobalAutoScale;value=0;groupCount=this.mDatasetPtr.GetDataGroup();for(i=0;i<seriesInfo.length;++i){if(seriesInfo[i].mValueAxis===valueAxis){if(useGlobalAutoScale){seriesSet.push(seriesInfo[i].mSeriesId);}else{for(j=0;j<this.mGroupCount;++j){for(k=0;k<groupCount;++k){value=this.GetData(i,j,false,k);if(value!==null){continue;}if(!areInitialized){areInitialized=true;min=value;max=value;}else{max=Math.max(value,max);min=Math.min(value,min);}}}}}}if(useGlobalAutoScale&&seriesSet.length!==0){tempMin=0;tempMax=0;value=this.mDatasetPtr.GetPeakValuesAcrossSeries(tempMax,tempMin,seriesSet,0);max=(value.Max>max)?value.Max:max;min=(value.Min<min)?value.Min:min;areInitialized=true;}return{Min:min,Max:max,AreInitialized:areInitialized};},GetData:function GetData(infoIndex,groupId,preValue,dataGroup){var ablContext=this.mpABLPlotContext,ablOptions=ablContext.mABLOptions,ablPlot=this.mpABLPlot,layout=ablOptions.mLayout,seriesInfo=this.mSeriesInfo,dataset=this.mDatasetPtr,valueIndex=seriesInfo[infoIndex].mValueAxis,value,data,baseValue,base;preValue=preValue||false;dataGroup=dataGroup||0;if((layout===$LAYOUT.LO_STACKED)||(layout===$LAYOUT.LO_PERCENT)){value=this.hGetCumulateData(valueIndex,seriesInfo[infoIndex].mDataIndex,groupId);data=dataset.GetData(seriesInfo[infoIndex].mSeriesId,groupId,dataGroup);if(data!==null){if(preValue){baseValue=ablContext.mValueAxis[valueIndex].GetBaseValue();value=(value-baseValue-data)+baseValue;if($Utility.AlmostZero(value)){value=0;}}if(layout===$LAYOUT.LO_PERCENT){base=ablPlot.getGroupTotals(groupId,valueIndex);if(base===0){value=0;}else{value/=base;}}return value;}if(layout===$LAYOUT.LO_PERCENT){base=ablPlot.getGroupTotals(groupId,valueIndex);if(base===0){value=0;}else{value/=base;}}return null;}data=dataset.GetData(seriesInfo[infoIndex].mSeriesId,groupId,dataGroup);if(data!==null){value=data;}else{value=null;}return value;},SetDeviceDataArea:function SetDeviceDataArea(deviceDataArea){if(this.mChartContextPtr.mUseAnimation){if(this.mDeviceDataArea===null){this.mDeviceDataArea=new $C.Rect2D({Rect2D:deviceDataArea});}else{this.mDeviceDataArea.ResetRect(deviceDataArea);}}},IsReverseSeriesOrder:function IsReverseSeriesOrder(valueAxisIndex){var valueAxes=this.mpABLPlotContext.mValueAxis,valueAxis;if(valueAxisIndex>=valueAxes.length){return false;}valueAxis=valueAxes[valueAxisIndex];return this.mChartContextPtr.IsReverseSeriesOrder(valueAxis,this.mIsVertical,this.mDepthDirection);},IsReverseGroupOrder:function IsReverseGroupOrder(){return this.mChartContextPtr.IsReverseGroupOrder(this.mIsVertical,this.mDepthDirection);},PriorToNextSeries:function PriorToNextSeries(sideDirection){var chartCtx=this.mChartContextPtr,refDirection,product,result=false;refDirection=this.mIsVertical?new $C.Vector2D({x:1,y:0}):new $C.Vector2D({x:0,y:1});product=chartCtx.normalDirection(sideDirection,this.mDepthDirection)*chartCtx.normalDirection(refDirection,this.mDepthDirection);if(product===0){result=this.mIsVertical?(sideDirection.y>0):(sideDirection.x<0);}else{result=product>0;}return result;},CreateTotalLabel:function CreateTotalLabel(valueAxis,groupId,totalCollection){var seriesInfo=this.mSeriesInfo,allNullData=true,displayValue=0,i,value,numberObject;for(i=0;i<seriesInfo.length;++i){if(seriesInfo[i].mValueAxis===valueAxis&&this.mpABLPlotContext.mSeriesOptions[seriesInfo[i].mSeriesIndex].mShowDataLabels){value=this.mDatasetPtr.GetData(seriesInfo[i].mSeriesId,groupId);if(value!==null){displayValue+=value;if(allNullData){allNullData=false;}}}}if(allNullData){return null;}numberObject=new $C.NumberObject({TripleId:new $C.TripleId({ObjectId:401,SeriesId:valueAxis,GroupId:groupId}),GraphObjectManager:this,Number:displayValue,NumberFormat:this.mpABLPlotContext.mSeriesOptions[0].mGraphNumberFormat,GraphCollectionObject:totalCollection,Locale:0,clientDrag:true,DataSet:this.mDatasetPtr});this.AddToMap(numberObject);totalCollection.AddGraphObject(numberObject);return numberObject;},GetUpmostIndexByValueAxisAndGroup:function GetUpmostIndexByValueAxisAndGroup(valueAxis,groupId){var seriesInfo=this.mSeriesInfo,index,i,data,len;index=-1;len=seriesInfo.length;for(i=len-1;i>-1;--i){if(seriesInfo[i].mValueAxis===valueAxis){data=this.mDatasetPtr.GetData(seriesInfo[i].mSeriesId,groupId);if(data!==null){index=i;if(data>0){break;}}}}return index;},createRiserLabel:function createRiserLabel(infoIndex,groupId,textCollection){var seriesInfo=this.mSeriesInfo,oneSeriesInfo=seriesInfo[infoIndex],ablOptions=this.mpABLPlotContext.mABLOptions,data,displayValue,format=null,label="";data=this.mDatasetPtr.GetData(oneSeriesInfo.mSeriesId,groupId);if(data===null){return null;}displayValue=0;if(((ablOptions.mLayout===$LAYOUT.LO_STACKED)||(ablOptions.mLayout===$LAYOUT.LO_PERCENT))&&(!ablOptions.mShowCumulate)){displayValue=data;if(ablOptions.mLayout===$LAYOUT.LO_PERCENT&&ablOptions.mShowAsPercentage){displayValue/=this.mpABLPlot.getGroupTotals(groupId,oneSeriesInfo.mValueAxis);}}else{if(ablOptions.mLayout===$LAYOUT.LO_PERCENT&&!ablOptions.mShowAsPercentage){displayValue=this.hGetCumulateData(oneSeriesInfo.mValueAxis,oneSeriesInfo.mDataIndex,groupId);}else{displayValue=this.GetData(infoIndex,groupId);if(displayValue===null||displayValue===undefined){return null;}}}ablOptions.mShowValue=true;if(ablOptions.mShowValue){format=this.mpABLPlotContext.mSeriesOptions[oneSeriesInfo.mSeriesIndex].mGraphNumberFormat;}if(ablOptions.mShowLabel){label=this.mDatasetPtr.GetSeriesLabel(oneSeriesInfo.mSeriesId,false);}return this.mpABLPlot.createRiserLabel(new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:oneSeriesInfo.mSeriesId,GroupId:groupId}),displayValue,format,label,textCollection);},AddTextToMapAndList:function AddTextToMapAndList(){},GetIndexFromSeriesId:function GetIndexFromSeriesId(seriesId){var seriesInfo=this.mSeriesInfo,len=seriesInfo.length,i;for(i=0;i<len;++i){if(seriesInfo[i].mSeriesId===seriesId){return i;}}return -1;},AddLegendMarkerToCollection:function AddLegendMarkerToCollection(iSeriesIndex,ipRiserCollection,iIsLineCollection,iIsShownMarker,iMarkerShape,iIsShownLine){iIsLineCollection=iIsLineCollection||false;iIsShownMarker=(iIsShownMarker===undefined)?true:iIsShownMarker;iMarkerShape=iMarkerShape||$MS.DssGraphMarkerShapeRectangle;iIsShownLine=(iIsShownLine===undefined)?true:iIsShownLine;this.mpABLPlot.AddLegendMarkerToCollection(this.mSeriesInfo[iSeriesIndex].mSeriesId,ipRiserCollection,iIsLineCollection,iIsShownMarker,iMarkerShape,iIsShownLine);},MoveLabel:function MoveLabel(groupId,textObject,max,min,infoIndex){var seriesInfo=this.mSeriesInfo,ablOptions=this.mpABLPlotContext.mABLOptions,isDescendingAxis,isReverse,sign,dataValue,currentMax,currentMin,textRect,halfWidth,halfHeight,centerPoint,lCurrentLabelId,isTotal,labelLocation,seriesIndex,seriesLabel,rect,seriesFont,currentLabelFont,margin,data;if(textObject===null||textObject===undefined){return ;}isDescendingAxis=this.mpABLPlotContext.mValueAxis[seriesInfo[infoIndex].mValueAxis].IsReverseOrder();isReverse=isDescendingAxis;sign=isDescendingAxis?-1:1;dataValue=0;data=this.GetData(infoIndex,groupId);if(data!==null&&data!==undefined){dataValue=data;}if(data&&(dataValue<0)){sign=-sign;isReverse=!isReverse;}maxDataLabelPoint.Reset(max.x,max.y);minDataLabelPoint.Reset(min.x,min.y);currentMax=maxDataLabelPoint;currentMin=minDataLabelPoint;if(this.mIsVertical){if(isReverse){if(currentMax.y<currentMin.y){currentMax.swapPoints(currentMin);}}else{if(currentMin.y<currentMax.y){currentMax.swapPoints(currentMin);}}}else{if(isReverse){if(currentMin.x<currentMax.x){currentMax.swapPoints(currentMin);}}else{if(currentMax.x<currentMin.x){currentMax.swapPoints(currentMin);}}}textRect=textObject.GetBoundingRect();halfWidth=Math.floor(textRect.width/2);halfHeight=Math.floor(textRect.height/2);centralDataLabelPoint.Reset(currentMax.x,currentMax.y);centerPoint=centralDataLabelPoint;lCurrentLabelId=textObject.mTripleId;isTotal=(lCurrentLabelId.mObjectId===$GO.DssGraphDataTextStackTotal);labelLocation=isTotal?$DTP.DssGraphDTPositionOutMax:ablOptions.mTextPosition;if(labelLocation===$DTP.DssGraphDTPositionOutMin||labelLocation===$DTP.DssGraphDTPositionInMin){centerPoint.x=currentMin.x;centerPoint.y=currentMin.y;}switch(labelLocation){case $DTP.DssGraphDTPositionCenter:centerPoint.x=(centerPoint.x+currentMin.x)/2;centerPoint.y=(centerPoint.y+currentMin.y)/2;break;case $DTP.DssGraphDTPositionInMin:case $DTP.DssGraphDTPositionOutMax:if(this.mIsVertical){centerPoint.y-=halfHeight*sign;}else{centerPoint.x+=halfWidth*sign;}break;case $DTP.DssGraphDTPositionOutMin:case $DTP.DssGraphDTPositionInMax:if(this.mIsVertical){centerPoint.y+=halfHeight*sign;}else{centerPoint.x-=halfWidth*sign;}break;default:break;}if(isTotal&&ablOptions.mTextPosition===$DTP.DssGraphDTPositionOutMax){seriesIndex=this.GetUpmostIndexByValueAxisAndGroup($VA.VA_Y1,groupId);seriesLabel=this.mpManager.GetGraphObject(new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:seriesInfo[seriesIndex].mSeriesId,GroupId:groupId}));if(!seriesLabel){textObject.MoveTo(centerPoint.x,centerPoint.y,$AP.CENTER);return ;}rect=seriesLabel.GetBoundingRect();seriesFont=seriesLabel.GetFormatFont();currentLabelFont=textObject.GetFormatFont();margin=seriesFont.mFontSize+currentLabelFont.mFontSize;if(this.mIsVertical){if(seriesFont.isHorizontal()||currentLabelFont.isHorizontal()){centerPoint.y-=Math.floor(rect.height+margin/3)*sign;}else{if(seriesFont.isVertical()){centerPoint.x+=margin;}else{centerPoint.x+=Math.floor(margin*Math.SQRT2);}}}else{if(seriesFont.isVertical()||currentLabelFont.isVertical()){centerPoint.x+=Math.floor(rect.width+margin/3)*sign;}else{if(seriesFont.isHorizontal()){centerPoint.y+=margin;}else{centerPoint.y+=Math.floor(margin*Math.SQRT2);}}}}textObject.MoveTo(centerPoint.x,centerPoint.y,$AP.CENTER);},updateGroupStackInfoWithBase:function updateGroupStackInfoWithBase(valueAxis,groupId,baseValue){if(this.mStackedGroupInfos===null||this.mStackedGroupInfos===undefined){this.mStackedGroupInfos=[[],[],[],[]];}function searchNext(array,start){var i=start+1;for(;i<array.length;i++){if(array[i]!==null&&array[i]!==undefined){return Math.min(array[i],baseValue);}}return baseValue;}function searchPre(array,start){var i=start-1;for(;i>=0;i--){if(array[i]!==null&&array[i]!==undefined){return Math.max(array[i],baseValue);}}return baseValue;}var stackedGroupInfos=this.mStackedGroupInfos,groupInfo;if(stackedGroupInfos[valueAxis]&&stackedGroupInfos[valueAxis][groupId]){return stackedGroupInfos[valueAxis][groupId];}var groupInfos=stackedGroupInfos[valueAxis],i,map=[],seriesInfos=this.mSeriesInfo,seriesCount=seriesInfos.length;var positive=[],negative=[];for(i=0;i<seriesCount;i++){var stackedData=this.GetData(i,groupId),oneGroupInfo={Min:stackedData,Max:stackedData,SeriesIndex:i};(stackedData>=0)?positive.push(oneGroupInfo):negative.unshift(oneGroupInfo);}groupInfo=negative.concat(positive);var values=[],insertPosition=-1;for(i=0;i<groupInfo.length;i++){map[groupInfo[i].SeriesIndex]=i;values.push(groupInfo[i].Max);}for(i=0;i<groupInfo.length;i++){if(groupInfo[i].Max!==null&&groupInfo[i].Max!==undefined){if(groupInfo[i].Max>=baseValue){groupInfo[i].Min=searchPre(values,i);}else{groupInfo[i].Max=searchNext(values,i);}}}groupInfos[groupId]=groupInfo;stackedGroupInfos[valueAxis+2][groupId]=map;return groupInfos[groupId];},getGroupStackedInformation:function getGroupStackedInformation(valueAxis,groupId){if(this.mStackedGroupInfos===null||this.mStackedGroupInfos===undefined){this.mStackedGroupInfos=[[],[],[],[]];}var stackedGroupInfos=this.mStackedGroupInfos;if(stackedGroupInfos[valueAxis]&&stackedGroupInfos[valueAxis][groupId]){return stackedGroupInfos[valueAxis][groupId];}var groupInfos=stackedGroupInfos[valueAxis],i,map=[],seriesInfos=this.mSeriesInfo,seriesCount=seriesInfos.length;var positive=[],negative=[];for(i=0;i<seriesCount;i++){var preData=this.GetData(i,groupId,true),stackedData=this.GetData(i,groupId),oneGroupInfo={Min:Math.min(preData,stackedData),Max:Math.max(preData,stackedData),SeriesIndex:i};(stackedData>=0)?positive.push(oneGroupInfo):negative.unshift(oneGroupInfo);}groupInfos[groupId]=negative.concat(positive);for(i=0;i<groupInfos[groupId].length;i++){map[groupInfos[groupId][i].SeriesIndex]=i;}stackedGroupInfos[valueAxis+2][groupId]=map;return groupInfos[groupId];},getSeriesOffsetIntoStackedInfo:function getSeriesOffsetIntoStackedInfo(valueAxis,groupId,seriesIndex){var stackedGroupInfos=this.mStackedGroupInfos;if(stackedGroupInfos[valueAxis+2]&&stackedGroupInfos[valueAxis+2][groupId]){return stackedGroupInfos[valueAxis+2][groupId][seriesIndex];}var groupInfos=stackedGroupInfos[valueAxis],stackedInfo=groupInfos[groupId],i;for(i=0;i<stackedInfo.length;i++){if(stackedInfo[i].SeriesIndex===seriesIndex){return i;}}return seriesIndex;},analyzeGroupInfo:function analyzeGroupInfo(valueAxis,groupId,baseValue){this.groupStackAnalysis=this.groupStackAnalysis||[[],[]];if(this.groupStackAnalysis[valueAxis][groupId]){return this.groupStackAnalysis[valueAxis][groupId];}var groupAnalysis=this.groupStackAnalysis[valueAxis],groupInfo=this.getGroupStackedInformation(valueAxis,groupId),i,ret={Reverse:3};if(groupInfo&&groupInfo.length){i=groupInfo.length-1;if(groupInfo[i].Max<=baseValue){ret={Reverse:0,CeilUpdated:i};}else{if(groupInfo[0].Min>=baseValue){ret={Reverse:1,FloorUpdated:0};}else{for(i=0;i<groupInfo.length;i++){if(groupInfo[i].Max>=baseValue){ret.FloorUpdated=i;ret.CeilUpdated=i>0?i-1:-1;}}}}}else{ret={Reverse:4};}groupAnalysis[groupId]=ret;return groupAnalysis[groupId];},UpdateCumulateData:function UpdateCumulateData(valueAxis,baseValues,seriesIndex){var seriesInfo=this.mSeriesInfo,dataset=this.mDatasetPtr,groupCount=this.mGroupCount,cumulatedData=this.mCumulateData,seriesNumber,seriesNumberY1,seriesNumberY2,seriesCount,i,j,indexIntoArray,isDualAxis=this.mChartContextPtr.IsDualAxis(),perSeries=seriesIndex!==undefined&&seriesIndex>=0,positiveValue,negativeValue,data,dataValue;if(perSeries){var seriesVaIndex=dataset.GetValueAxisBySeries(seriesIndex);if(seriesVaIndex!==valueAxis){return baseValues;}}seriesNumber=seriesInfo.length;if(seriesNumber===0){return baseValues;}seriesCount=seriesNumber;if(isDualAxis){seriesNumberY1=this.mSeriesNumber[0];seriesNumberY2=seriesNumber-seriesNumberY1;}for(i=0;i<groupCount;++i){positiveValue=(baseValues&&baseValues.positive[i])||0;negativeValue=(baseValues&&baseValues.negative[i])||0;for(j=0;j<seriesNumber;++j){if(perSeries){if(seriesInfo[j].mSeriesId!==seriesIndex){continue;}}if(seriesInfo[j].mValueAxis===valueAxis){data=dataset.GetData(seriesInfo[j].mSeriesId,i);dataValue=0;if(data!==null&&data!==undefined){dataValue=data;if(dataValue<0){this.mHasNegativeValue=true;dataValue+=negativeValue;negativeValue=dataValue;}else{dataValue+=positiveValue;positiveValue=dataValue;}}else{dataValue=positiveValue;}if(perSeries){if(dataValue>=0){baseValues.positive[i]=dataValue;}else{baseValues.negative[i]=dataValue;}if(isDualAxis){seriesCount=valueAxis===$VA.VA_Y1?seriesNumberY1:seriesNumberY2;}indexIntoArray=i*seriesCount+seriesInfo[j].mDataIndex;cumulatedData[valueAxis][indexIntoArray]=dataValue;}else{cumulatedData[valueAxis].push(dataValue);if(j===seriesNumber-1){if(dataValue>=0){baseValues.positive[i]=dataValue;}else{baseValues.negative[i]=dataValue;}}}}}}return baseValues;},AddBaseToCumulateData:function AddBaseToCumulateData(valueAxis,baseValue){var len=this.mCumulateData[valueAxis].length,i;for(i=0;i<len;++i){this.mCumulateData[valueAxis][i]+=baseValue;}},drawSingleDataPoint:function drawSingleDataPoint(tripleId,point,shape,sourceCase){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),pieCount=0,i,j,center,radius,onePieSliceList,oneSingleShape,graphObjectsInOneDataPoint=[],shownDataLabels=this.mpABLPlot.shownDataLabels;var markerShape=gmCtx.mMarkerShape;if(markerShape===$MS.DssGraphMarkerShape2DPie||markerShape===$MS.DssGraphMarkerShape2DRingPie){if(this.mPieRenderer===null){var layout=0;if(markerShape===$MS.DssGraphMarkerShape2DRingPie){layout=1;}this.mPieRenderer=new $C.PiePlotRenderer({GraphObjectManager:this,Dataset:this.mDatasetPtr,ChartContext:this.mChartContextPtr,Layout:layout,PlotType:$GMPPT.GMPPT_CATEGORY,ShownDataLabel:shownDataLabels});}var pieRenderer=this.mPieRenderer;pieCount=this.mDatasetPtr.GetPieCountAtOneDataPoint(tripleId.mSeriesId,tripleId.mGroupId);for(i=0;i<pieCount;++i){if(chartCtx.checkColorByAndSizeByValue(tripleId,this.mDatasetPtr,false,this.mHasSizeBy)===false){graphObjectsInOneDataPoint.push({Object:null,ShapeSize:radius});continue;}if(chartCtx.mImageUsage===$IMG_USAGE.GENERAL){center=hGetPieCenter.call(this,tripleId.mSeriesId,tripleId.mGroupId,i,pieCount);onePieSliceList=pieRenderer.drawSinglePie(tripleId.mSeriesId,tripleId.mGroupId,i,center,pieCount);for(j=0;j<onePieSliceList.length;j++){if(onePieSliceList[j]){graphObjectsInOneDataPoint.push({Object:onePieSliceList[j],ShapeSize:onePieSliceList[j].getShapeSize()});}}}else{if(chartCtx.mImageUsage===$IMG_USAGE.OBJECT_CLIP_COMPUTATION){radius=pieRenderer.getShapeSizeAt(tripleId.mSeriesId,tripleId.mGroupId,i,!this.mHasSizeBy);graphObjectsInOneDataPoint.push({Object:null,ShapeSize:radius});}}}}else{if(shape===$SHP._COMBINED){shape=this.mDatasetPtr.GetShapeByCell(tripleId.mSeriesId,tripleId.mGroupId);if(shape===$SHP._GENERIC){shape=$SHP._CIRCLE;}}oneSingleShape=this.drawSinglePoint(tripleId,point,shape,sourceCase);graphObjectsInOneDataPoint.push(oneSingleShape);}return graphObjectsInOneDataPoint;},drawSinglePoint:function drawSinglePoint(tripleId,point,shape,sourceCase){var setLineAreaAsDots=(shape!==undefined)?shape!==$SHP._LINE:false,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),categoryUnits=this.mGroupCount,data,groupCount,markerShape,markerSize,oneMarker,dataMarkerTripleId,rect,forecastCount=this.mDatasetPtr.getForecastCount();if(chartCtx.checkColorByAndSizeByValue(tripleId,this.mDatasetPtr,this.mHasColorBy,this.mHasSizeBy)===false){return{Object:null,ShapeSize:0};}if(sourceCase===$SHP._AREA){setLineAreaAsDots=false;}markerShape=hMapSeriesShapeToMakerShape.call(this,shape);if(chartCtx.RenderClusterShapes()){if(!(categoryUnits===1&&shape===2)){categoryUnits*=this.mSeriesInfo.length;}}if(markerShape===$MS.DssGraphMarkerShapeGMTick){markerSize=gmCtx.GetMaxMarkerSize($GM_MarkerStyle._TICK_CATEGORY,chartCtx.IsVertical(),categoryUnits);}else{if(shape===$SHP._AREA||sourceCase===$SHP._AREA){markerSize=gmCtx.GetMaxElementSizeInAreaChart(this.mIsVertical,categoryUnits,!setLineAreaAsDots,forecastCount);}else{markerSize=gmCtx.GetMaxElementSizeInLineChart(this.mIsVertical,categoryUnits,!setLineAreaAsDots,markerShape);}}groupCount=this.mDatasetPtr.GetGroupCount();if(this.mHasSizeBy){data=this.mDatasetPtr.GetSizeByData(tripleId.mSeriesId,tripleId.mGroupId);if(data!==null&&data!==undefined){if(markerShape===$MS.DssGraphMarkerShapeNone&&(gmCtx.mMaxSizeVal===gmCtx.mMinSizeVal)){if(!setLineAreaAsDots&&groupCount>=3){markerSize=gmCtx.GetAdjustThicknessValue(gmCtx.mConstants.MinimalSize.General);}markerSize=Math.round(Math.max(markerSize,1));}else{markerSize=gmCtx.GetScaledSize(data,markerSize,shape);markerSize=Math.max(Math.round(markerSize),gmCtx.mConstants.MinimalSize.General);}}}if(chartCtx.mImageUsage===$IMG_USAGE.OBJECT_CLIP_COMPUTATION){var shapeSize=markerSize;if(markerShape===$MS.DssGraphMarkerShapeGMTick){shapeSize=Math.round(0.5*(this.mIsVertical?gmCtx.mConstants.FixedTickerSize:markerSize));}return{Object:null,ShapeSize:shapeSize};}if(markerShape===$MS.DssGraphMarkerShapeNone){markerShape=$MS.DssGraphMarkerShapeCircle;}if(markerShape===$MS.DssGraphMarkerShapeGMTick){var p1,p2,halfOffset=Math.round(0.5*markerSize);if(chartCtx.IsVertical()){p1={x:point.x-halfOffset,y:point.y};p2={x:point.x+halfOffset,y:point.y};}else{p1={y:point.y-halfOffset,x:point.x};p2={y:point.y+halfOffset,x:point.x};}oneMarker=new $C.StraightLineObject({TripleId:tripleId,GraphObjectManager:this,StartPoint:p1,EndPoint:p2,GraphCollectionObject:null,Shape:$SHP._TICKER});}else{if(markerShape===$MS.DssGraphMarkerShapeSquare||markerShape===$MS.DssGraphMarkerShapeRectangle){rect=this.mChartContextPtr.transformToRect(point,markerSize,true);oneMarker=new $C.RectangleObject({TripleId:tripleId,GraphObjectManager:this,GraphCollectionObject:null,Area:rect,Shape:$SHP._RECTANGLE,hasFill:true});}else{oneMarker=new $C.MarkerObject({TripleId:tripleId,GraphObjectManager:this,MarkerPosition:point,MarkerShape:markerShape,IsIsometric:true,MarkerSize:markerSize,GraphCollectionObject:null,IsDialogSize:false,Shape:$SHP._CIRCLE,hasFill:true});}}if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeNone){gmCtx.AddToIsolatedDotList(tripleId);if(tripleId.mObjectId!==$GO.DssGraphDataMarker){dataMarkerTripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataMarker,SeriesId:tripleId.mSeriesId,GroupId:tripleId.mGroupId});gmCtx.AddToIsolatedDotList(dataMarkerTripleId);}}return{Object:oneMarker,ShapeSize:oneMarker.getShapeSize()};},getCorrectGroupIdInSeriesPoints:function getCorrectGroupIdInSeriesPoints(index,candidate){var groupId=this.mGroupIdMapPerSeries[index];if(groupId!==null&&groupId!==undefined){return groupId;}return candidate;},prepareTransitionalGradient:function prepareTransitionalGradient(startId,points,restrictLength){var i,colorValue,props={Effective:false};if(restrictLength!==undefined){restrictLength=Math.min(points.length,restrictLength);}else{restrictLength=points.length;}props.Colors=[];for(i=0;i<restrictLength;i++){var oneColor=this.mDatasetPtr.GetColorByData(startId.mSeriesId,startId.mGroupId+i);if(oneColor===null){oneColor=this.mDatasetPtr.GetDefaultShapeFillColor();}if(i===0){colorValue=oneColor;props.StartGraphColor=oneColor;}else{if(i===restrictLength-1){props.EndGraphColor=oneColor;props.Effective=props.Effective||oneColor!==colorValue;}else{props.Colors.push({Color:oneColor,Step:i/(restrictLength-1)});props.Effective=props.Effective||oneColor!==colorValue;}}}props.Style=1;props.EndAlpha=255;props.Angle=this.mChartContextPtr.IsVertical()?0:1;return props;},getMaxElementOffsetClippedByBoundary:function getMaxElementOffsetClippedByBoundary(result,isXAxis,isPrimaryAxis){var clippedMarkerKey=isXAxis?(isPrimaryAxis?"X1":"X2"):(isPrimaryAxis?"Y1":"Y2");if(this.mClippedMarkerSize[clippedMarkerKey]){var thisOffset=this.mClippedMarkerSize[clippedMarkerKey];result.LowOffset=Math.max(thisOffset.LowOffset,result.LowOffset);result.HighOffset=Math.max(thisOffset.HighOffset,result.HighOffset);}else{result.LowOffset=Math.max(0,result.LowOffset);result.HighOffset=Math.max(0,result.HighOffset);}},CreateOneDataMarker:function CreateOneDataMarker(infoIndex,groupId,markerCollection,centerPoint,correctLineObjectGroupId,isDataMarker){var seriesInfo=this.mSeriesInfo[infoIndex],chartCtx=this.mChartContextPtr,tripleId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:seriesInfo.mSeriesId,GroupId:groupId}),gmCtx=chartCtx.GetGraphMatrixContext(),dataset=this.mDatasetPtr,shape=dataset.GetShapeBySeries(seriesInfo.mSeriesId),isLineShape=(shape===$SHP._LINE||shape===$SHP._GENERIC),isAreaShape=(shape===$SHP._AREA),isIsolatedDot=gmCtx.IsIsolatedDot(tripleId),isSizeBy=gmCtx.mHasSizeBy,dotShapeInLineChart,markerObject,markerInfo,graphObjectList;isDataMarker=isDataMarker||false;var validMarker,markerShape=$MS.DssGraphMarkerShapeCircle;if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeCombined){dotShapeInLineChart=(shape===$SHP._CIRCLE||shape===$SHP._RECTANGLE||shape===$SHP._SQUARE);}else{dotShapeInLineChart=(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeCircle||gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeRectangle||gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeSquare);}validMarker=(!isIsolatedDot&&!dotShapeInLineChart&&!isSizeBy);if(!validMarker){return ;}markerInfo=this.mDatasetPtr.getMarkerShapeInfoAt(seriesInfo.mSeriesId,groupId);validMarker=(markerInfo.Show||isDataMarker)&&markerShape!==undefined;if(!validMarker){return ;}markerShape=markerInfo.Shape;markerCollection=null;var markerId=new $C.TripleId({ObjectId:$GO.DssGraphDataMarker,SeriesId:seriesInfo.mSeriesId,GroupId:groupId}),markerSize=markerInfo.Size||3;if(isDataMarker){markerShape=$MS.DssGraphMarkerShapeCircle;markerSize=gmCtx.mConstants.FixedDataMarkerSize;}if(markerShape===$MS.DssGraphMarkerShapeCircle){markerObject=new $C.MarkerObject({TripleId:markerId,MarkerPosition:centerPoint,MarkerShape:markerShape,IsIsometric:true,MarkerSize:markerSize,GraphCollectionObject:markerCollection,GraphObjectManager:this,IsDialogSize:false,Shape:$SHP._CIRCLE});}else{if(markerShape===$MS.DssGraphMarkerShapeRectangle||markerShape===$MS.DssGraphMarkerShapeSquare){var rect=this.mChartContextPtr.transformToRect(centerPoint,markerSize,true);markerObject=new $C.RectangleObject({TripleId:markerId,GraphObjectManager:this,GraphCollectionObject:markerCollection,Area:rect,Shape:$SHP._RECTANGLE});}}graphObjectList=this.mGraphObjectList;if(isLineShape){graphObjectList.push(markerObject);}else{if(isAreaShape){graphObjectList.push(markerObject);}}},CreateAllDataLabels:function CreateAllDataLabels(){var i,j,tripleId,oneTextCollection,textCollections=this.mTextCollection,data,label,useGlobalDataLabelForamt=true,myLabels=this.mDataLabels,seriesInfos=this.mSeriesInfo,dataLabelInfo,seriesId;tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText});if(useGlobalDataLabelForamt){oneTextCollection=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});}for(i=0;i<seriesInfos.length;++i){seriesId=seriesInfos[i].mSeriesId;if(this.mDatasetPtr.showSeriesDatalabel(seriesId)===false){continue;}if(!useGlobalDataLabelForamt){oneTextCollection=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});}textCollections.push(oneTextCollection);for(j=0;j<this.mGroupCount;++j){data=this.mDatasetPtr.GetData(seriesId,j);if(data!==undefined&&data!==null){label=this.CreateOneDataLabel(seriesId,j,data,oneTextCollection);if(label!==null&&label!==undefined){dataLabelInfo=new $C.GMDataLabelInfo({SeriesId:seriesId,GroupId:j,SeriesInfo:i,isValid:true,Label:label});label.mIsShown=false;myLabels.push(dataLabelInfo);this.AddToMapAndList(label);}}}}},hGetCumulateData:function hGetCumulateData(valueAxis,dataIndex,groupId){return this.mCumulateData[valueAxis][groupId*this.mSeriesNumber[valueAxis]+dataIndex];},GetAccompanyPoints:function GetAccompanyPoints(basePoint,offset){var lowPoint=new $C.Point2D(),highPoint=new $C.Point2D(),retVal={};lowPoint.x=basePoint.x;lowPoint.y=basePoint.y;highPoint.x=basePoint.x;highPoint.y=basePoint.y;if(this.mIsVertical){lowPoint.y-=offset;highPoint.y+=offset;}else{lowPoint.x-=offset;highPoint.x+=offset;}retVal.lowPoint=lowPoint;retVal.highPoint=highPoint;return retVal;},CreateOneDataLabel:function CreateOneDataLabel(seriesId,groupId,dataValue,collection){var data=dataValue,finalStr="",valueAxisIndex,tripleId,numberObject,dataLabel,dataset,dataLabelStyle,plotCxt,ablOptions,layout,realComboChart=this.mpABLPlot.realComboChart,fontFormat;tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:seriesId,GroupId:groupId});dataset=this.mDatasetPtr;plotCxt=this.mpABLPlotContext;ablOptions=plotCxt.mABLOptions;layout=ablOptions.mLayout;if(layout===$LAYOUT.LO_STACKED||layout===$LAYOUT.LO_PERCENT){data=dataset.GetData(seriesId,groupId);}dataLabelStyle=dataset.dataLabelStyle;switch(dataLabelStyle){case kDataLabelShowValue:valueAxisIndex=this.mSeriesInfo[0].mValueAxis;dataLabelFormat.restore();dataset.getGridDataFormat(dataLabelFormat,seriesId,groupId,0);numberObject=new $C.NumberObject({TripleId:tripleId,GraphObjectManager:this,Number:data,NumberFormat:dataLabelFormat,GraphCollectionObject:collection,Locale:0,clientDrag:false,DataSet:null,IsFinal:false,ColumnOffset:0});if(numberObject){finalStr=numberObject.mText;dataLabel=numberObject;}break;case kDataLabelShowText:finalStr=this.mDatasetPtr.GetTextLabel(seriesId,groupId);dataLabel=new $C.TextObject({TripleId:tripleId,GraphObjectManager:this,GraphCollectionObject:collection});break;}if(finalStr.length!==0){dataLabel.SetText(finalStr);if(realComboChart){fontFormat=dataLabel.mFormatFontPtr;fontFormat.mFontStyle=$FS.FS_BOLD;dataLabel.strokeBBox();}return dataLabel;}return null;},Draw:function Draw(){this._super();hDrawTrendLine.call(this);hDrawRefLine.call(this);},updateSeriesRenderSequence:function updateSeriesRenderSequence(result,base,useBase){var i,sequenceIndex,baseCount=0,mySequence=this.renderSequence,len=mySequence.length;if(useBase===undefined){useBase=true;}base=useBase?base:0;for(i=0;i<len;i++){sequenceIndex=mySequence[i];if(sequenceIndex!==null&&sequenceIndex!==undefined){baseCount++;result[i]=sequenceIndex+base;}}if(useBase){return base+baseCount;}return 0;},populateRenderSequence:function populateRenderSequnce(sequences){if(sequences){this.renderSequence=sequences;}else{var i,mySequence=this.renderSequence,seriesInfos=this.mSeriesInfo,len=seriesInfos.length;mySequence.splice(0,mySequence.length);for(i=0;i<len;i++){mySequence[seriesInfos[i].mSeriesId]=i;}}},evalBarStyleUnitWidth:function evalBarStyleUnitWidth(groupSize,columns,gapRatio){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),clusterInfo={unitWidth:0,columns:1,riserGap:0,groupGap:0,overlapRatio:0,gapRatio:10};if(gapRatio===undefined){gapRatio=10;var elementInfo=gmCtx.mElementsInfo;if(elementInfo.Max.Mode===$GM_ESM._MANUAL){gapRatio=elementInfo.Max.Size*100;if(gapRatio<1){gapRatio=1;}if(gapRatio>100){gapRatio=99;}clusterInfo.gapRatio=100-gapRatio;}}else{clusterInfo.gapRatio=gapRatio;}clusterInfo.columns=columns||this.mSeriesInfo.length;clusterInfo.unitWidth=(groupSize*(1-clusterInfo.gapRatio/100)/clusterInfo.columns);if(chartCtx.mIsGraphMatrix){if(clusterInfo.unitWidth>2){clusterInfo.unitWidth-=1;}if(gmCtx.mElementsInfo.Max.Mode===$GM_ESM._AUTOMATIC){clusterInfo.unitWidth=Math.min(clusterInfo.unitWidth,gmCtx.mConstants.MaximalSize.Bar);}if(this.mHasSizeBy===false){if(!chartCtx.isCompactMode()){clusterInfo.unitWidth=Math.max(clusterInfo.unitWidth,gmCtx.mConstants.MinimalSize.Bar);}}clusterInfo.gapRatio=(1-clusterInfo.unitWidth*clusterInfo.columns/groupSize)*100;clusterInfo.riserGap=0;clusterInfo.groupGap=groupSize*clusterInfo.gapRatio/100;}return clusterInfo;},GenerateTrendLine:function GenerateTrendLine(){var ablPlotCtx=this.mpABLPlotContext,trendLineInfo,isVertical,categoryAxis=ablPlotCtx.mCategoryAxisPtr,i,j,k,trendLineType,seasonal,values,coreValues,count,dataset=this.mDatasetPtr,chartCtx=this.mChartContextPtr,seriesInfos=this.mSeriesInfo,seriesInfoCount=seriesInfos.length,oneSeriesInfo,seriesId,value,valueIndex,valueAxis,point,points=[],trendLineId,polyLine,curveLine,identity,midX,midY,slope,startX,endX,numberOfPoints,startPoint={},midPoint={},endPoint={};if(dataset.isBare(chartCtx.IsPieChart())){return ;}if(categoryAxis.mAxisInfo.mAxisDirection===$AXIS_DIRECTION.AD_X){isVertical=true;}else{isVertical=false;}for(i=0;i<seriesInfoCount;++i){points=[];oneSeriesInfo=seriesInfos[i];seriesId=oneSeriesInfo.mSeriesId;trendLineInfo=dataset.GetTrendLineOfSeries(seriesId);valueIndex=oneSeriesInfo.mValueAxis;valueAxis=ablPlotCtx.mValueAxis[valueIndex];trendLineId=new $C.TripleId({ObjectId:$GO.DssGraphTrendLine,SeriesId:seriesId});if(!!trendLineInfo===false){continue;}trendLineType=trendLineInfo.getTrendLineType();if(trendLineType===$RT.DssGraphRegressionNone){continue;}identity=trendLineInfo.getIdentity();values=trendLineInfo.getTrendLineValuesWithForecast();coreValues=trendLineInfo.getTrendLineValues();seasonal=trendLineInfo.getSeasonalityType();if(hGetValidValueNum(coreValues)<=1){continue;}if(!!values===false||values.length===0){continue;}count=values.length;if(trendLineType===$RT.DssGraphRegressionLinear){if(seasonal!==0){for(j=0;j<count;++j){value=values[j];if(value!==null&&value!==undefined){point=hCalcTrendLinePoint.call(this,i,j,value,valueAxis,isVertical,true);if(point.x!==null&&point.y!==null){points.push(point);}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tseries #: "+i+", data point #:"+j);$VISUTIL.visPrint("\tvalue = "+value);$VISUTIL.visPrint("\tx = "+point.x+", y = "+point.y);}}}points=hProcessPointsForTrendline.call(this,points);numberOfPoints=points.length;if(numberOfPoints>=2){startX=points[0].x;endX=points[numberOfPoints-1].x;midX=(startX+endX)/2;for(i=0;i<numberOfPoints;++i){if(points[i].x===midX){midY=points[i].y;break;}else{if(i<numberOfPoints-1&&points[i].x<midX&&points[i+1].x>midX){slope=(points[i+1].y-points[i].y)/(points[i+1].x-points[i].x);midY=points[i].y+slope*(midX-points[i].x);break;}}}midPoint.x=midX;midPoint.y=midY;}}else{for(j=0;j<count;++j){value=values[j];if(value!==null&&value!==undefined){point=hCalcTrendLinePoint.call(this,i,j,value,valueAxis,isVertical,true);if(point.x!==null&&point.y!==null){points.push(point);break;}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tseries #: "+i+", data point #:"+j);$VISUTIL.visPrint("\tvalue = "+value);$VISUTIL.visPrint("\tx = "+point.x+", y = "+point.y);}}}for(k=count-1;k>j;--k){value=values[k];if(value!==null&&value!==undefined){point=hCalcTrendLinePoint.call(this,i,k,value,valueAxis,isVertical,true);if(point.x!==null&&point.y!==null){points.push(point);break;}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tseries #: "+i+", data point #:"+k);$VISUTIL.visPrint("\tvalue = "+value);$VISUTIL.visPrint("\tx = "+point.x+", y = "+point.y);}}}numberOfPoints=points.length;if(numberOfPoints>=2){midX=(points[0].x+points[1].x)/2;midY=(points[0].y+points[1].y)/2;midPoint.x=midX;midPoint.y=midY;}}if(numberOfPoints>=2){startPoint.x=points[0].x;startPoint.y=points[0].y;endPoint.x=points[numberOfPoints-1].x;endPoint.y=points[numberOfPoints-1].y;polyLine=new $C.PolyLineObject({TripleId:trendLineId,GraphObjectManager:this,PolyLine:points,Shape:$SHP._LINE,Identity:identity,startPoint:startPoint,midPoint:midPoint,endPoint:endPoint});if(polyLine!==null){this.mTrendLineObjects.push(polyLine);}}}else{for(j=0;j<count;++j){value=values[j];if(value!==null&&value!==undefined){point=hCalcTrendLinePoint.call(this,i,j,value,valueAxis,isVertical,false);if(point.x!==null&&point.y!==null){points.push(point);}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tseries #: "+i+", data point #:"+j);$VISUTIL.visPrint("\tvalue = "+value);$VISUTIL.visPrint("\tx = "+point.x+", y = "+point.y);}}}if(points.length>=2){curveLine=new $C.CurveLineObject({TripleId:trendLineId,GraphObjectManager:this,Points:points,IsVertical:isVertical,Identity:identity,Shape:$SHP._CURVE});if(curveLine!==undefined&&curveLine!==null){this.mTrendLineObjects.push(curveLine);}}}}},GenerateRefLine:function GenerateRefLine(){var ablPlotCtx=this.mpABLPlotContext,chartCtx=this.mChartContextPtr,drawingAreaWidth=chartCtx.mGraphWidth,drawingAreaHeight=chartCtx.mGraphHeight,numberOfSeries=this.mSeriesInfo.length,seriesId,seriesInfo,i,j,valueIndex,valueAxis,value,direction,points=[],refLineId,refLineInfo,refLineInfos,refLineLabel,refLineLevel,identity,refLineLabelIdentity,refLine,position,startX,endX,midPoint={},labelId,refLabelFormat,dataset=this.mDatasetPtr,isVertical,refLinePosInfos=[],numberOfRefLines,numberOfDataPoints=dataset.GetSeriesCount()*dataset.GetGroupCount();if(chartCtx.mPartialRendering===false){numberOfDataPoints=this.mpABLPlot.DPCount;}for(i=0;i<numberOfSeries;++i){seriesInfo=this.mSeriesInfo[i];seriesId=seriesInfo.mSeriesId;refLineInfos=dataset.GetReferenceLinesOfSeries(seriesId);valueIndex=seriesInfo.mValueAxis;valueAxis=ablPlotCtx.mValueAxis[valueIndex];refLabelFormat={};refLabelFormat.Condense=valueAxis.mCondenseLabels;if(!refLabelFormat.Condense){if(valueAxis.mNumberFormat.isDefault){var axisFormat=new $C.ChartAdvFormat();chartCtx.getAxisAutoNumberFormat(axisFormat,valueAxis.mPrimaryMetrics);valueAxis.mNumberFormat=axisFormat;}refLabelFormat.NumberFormat=valueAxis.mNumberFormat.mCustomFormat;}numberOfRefLines=refLineInfos.length;for(j=0;j<numberOfRefLines;++j){points=[];refLineInfo=refLineInfos[j];if(refLineInfo){identity=refLineInfo.getIdentity();value=refLineInfo.getReferenceLineValue();direction=refLineInfo.getReferenceLineDirection();isVertical=(direction!=="horizontal");refLineLabel=refLineInfo.getReferenceLineLabel(false,false,refLabelFormat);refLineLabelIdentity=refLineInfo.getRefLineLabelIdentity();if(numberOfDataPoints===0){continue;}refLineId=new $C.TripleId({ObjectId:$GO.DssGraphReferenceLine,SeriesId:seriesId,GroupId:j});labelId=new $C.TripleId({ObjectId:$GO.DssGraphRefLineText,SeriesId:seriesId,GroupId:j});if(value!==null&&value!==undefined){position=valueAxis.GetPositionByValue(value);if(position!==null&&position!==undefined){startX=1;if(isVertical){if(position===0){position=1;}else{if(position===drawingAreaWidth){--position;}}endX=drawingAreaHeight-1;points.push(new $C.Point2D({x:position,y:startX}));points.push(new $C.Point2D({x:position,y:endX}));midPoint.x=position;midPoint.y=(points[0].y+points[1].y)/2;}else{if(position===0){position=1;}else{if(position===drawingAreaHeight){--position;}}endX=drawingAreaWidth-1;points.push(new $C.Point2D({x:startX,y:position}));points.push(new $C.Point2D({x:endX,y:position}));midPoint.x=(points[0].x+points[1].x)/2;midPoint.y=position;}refLine=new $C.StraightLineObject({TripleId:refLineId,GraphObjectManager:this,StartPoint:points[0],EndPoint:points[1],GraphCollectionObject:null,Identity:identity,Shape:$SHP._LINE,MidPoint:midPoint});if(refLine!==null){if(!refLine.mFormatLinePtr){refLine.mFormatLinePtr=new $C.FormatLine();}this.mReferenceLineObjects.push(refLine);refLinePosInfos.push({tripleId:labelId,identity:refLineLabelIdentity,isVertical:isVertical,position:position,labelText:refLineLabel});}}else{$VISUTIL.visPrint("Reference line point calculation abnormal:");$VISUTIL.visPrint("\tseries #: "+i+"ref line #: "+j);$VISUTIL.visPrint("\tvalue = "+value);$VISUTIL.visPrint("\ty = "+position);}}}}}hGenerateRefLineLabels.call(this,drawingAreaHeight,drawingAreaWidth,refLinePosInfos);}});}());