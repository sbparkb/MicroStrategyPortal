(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.chart.common.MapStructure","mstrmojo.chart.JSONParameter","mstrmojo.chart.enums.EnumInstructionName");var $C=mstrmojo.chart,$CHART_ENUMS=$C.enums,$JI=$CHART_ENUMS.EnumInstructionName;function hAddParameter(parameterName,parameterValue){++this.mCurrentIndex;if(this.mIsFirstPass){this.mParameterList.push(new $C.JSONParameter({mParameterName:parameterName,mParameterValue:parameterValue,mIsLastFrameSet:this.mIsLastFrame}));}}mstrmojo.chart.JSONInstruction=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.chart.JSONInstruction",mInstructionName:$JI.JSONInsUndefined,mpOriginalAddress:0,mFormatIdx:-1,mParameterList:[],mCurrentIndex:-1,mIsLastFrame:true,mIsFirstPass:true,init:function init(props){this._super(props);this.mParameterList=[];},SetInstructionName:function SetInstructionName(instructionName){this.mInstructionName=instructionName;},GetInstructionName:function GetInstructionName(){return this.mInstructionName;},SetSecondPass:function SetSecondPass(){this.mIsFirstPass=false;this.mCurrentIndex=-1;},SetLastFrame:function SetLastFrame(isLastFrame){this.mIsLastFrame=isLastFrame;},AppendToParameterList:function AppendToParameterList(parameterName,parameterValue){hAddParameter.call(this,parameterName,parameterValue);},AppendArrayToParameterList:function AppendArrayToParameterList(parameterName,parameterArray,parameterNumber){if(parameterNumber>0){hAddParameter.call(this,parameterName,parameterArray);}},AppendSimpleVectorToParameterList:function AppendSimpleVectorToParameterList(parameterName,parameterVector){if(parameterVector.length>0){hAddParameter.call(this,parameterName,parameterVector);}},SetFormatAddress:function SetFormatAddress(originalAddress){this.mpOriginalAddress=originalAddress;},CalculateFormatIndex:function CalculateFormatIndex(formatList){var originalAddress=this.mpOriginalAddress,nFirst,nMid,nLast;if(originalAddress!==null&&originalAddress!==undefined){nFirst=0;nLast=formatList.length-1;while(nFirst<=nLast){nMid=Math.floor((nFirst+nLast)/2);if(formatList[nMid].mpOriginalAddress<originalAddress){nFirst=nMid+1;}else{if(formatList[nMid].mpOriginalAddress>originalAddress){nLast=nMid-1;}else{this.mFormatIdx=nMid;return ;}}}nFirst=0;nLast=formatList.length-1;while(nFirst<=nLast){nMid=Math.floor((nFirst+nLast)/2);if(formatList[nMid].id<originalAddress){nFirst=nMid+1;}else{if(formatList[nMid].id>originalAddress){nLast=nMid-1;}else{this.mFormatIdx=nMid;return ;}}}}},AppendToJSONObject:function AppendToJSONObject(JSONObject){var paramList=this.mParameterList,fmtIndex=this.mFormatIdx,i,len,currentJSONObject={Ins:this.mInstructionName};if(fmtIndex>=0){currentJSONObject.Format=fmtIndex;}len=paramList.length;for(i=0;i<len;i++){paramList[i].AppendToJSONObject(currentJSONObject);}JSONObject.push(currentJSONObject);}});}());