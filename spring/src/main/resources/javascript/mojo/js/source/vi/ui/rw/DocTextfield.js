(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.ScrollableDocTextfield","mstrmojo._HasEditableText","mstrmojo.vi._MonitorsAppState","mstrmojo._HasDocLink","mstrmojo.string","mstrmojo.css","mstrmojo.dom");var $DOM=mstrmojo.dom,$CSS=mstrmojo.css;function getDL(node){return node.data.dl||node.defn.dl;}function updateText(text){this.getAnchor()[$DOM.isFF?"textContent":"innerText"]=text;}function updateLinkCss(){$CSS.toggleClass(this.domNode,"hasLink",this.hasActiveLink());}function setPaddingForItalics(){var formats=this.defn.fmts,fs,valueStyle,padding=0,hasVerticalScroll=this.valueNode.className.indexOf(" hasVertical ")>-1;if(formats&&(formats.font||"").split(" ").indexOf("italic")>=0&&(formats["text-align"]||"").toLocaleLowerCase()==="right"){fs=(formats.font||"").match(/([0-9]+)[,\.]?[0-9]*pt/);fs=(fs&&fs[1])||8;valueStyle=this.valueNode&&this.valueNode.style;padding=Math.round(fs/3)+(hasVerticalScroll?30:0);valueStyle.paddingRight=padding+"px";}return padding;}mstrmojo.vi.ui.rw.DocTextfield=mstrmojo.declare(mstrmojo.vi.ui.ScrollableDocTextfield,[mstrmojo._HasEditableText,mstrmojo.vi._MonitorsAppState,mstrmojo._HasDocLink],{scriptClass:"mstrmojo.vi.ui.rw.DocTextfield",markupString:'<div id="{@id}" class="mstrmojo-DocTextfield {@cssClass}" style="{@domNodeCssText}"><div class="mstrmojo-DocTextfield-valueNode" style="{@valueNodeCssText}" mstrAttach:click ><div class="vi-doc-tf-value-text">{@v}</div></div>{@buttonNodeMarkup}</div>',editableSlot:"valueTextNode",editOnClick:false,editOnDoubleClick:true,allowEmptyText:true,allowNewLine:true,formatHandlers:{domNode:["background-color"],valueNode:["F","fx","text-align","white-space"]},markupSlots:{valueNode:function valueNode(){return this.domNode.firstChild;},valueTextNode:function valueNode(){return this.domNode.firstChild.firstChild;}},update:function update(node){delete this.fmts;this._super(node);this.text=this.v;var dl=getDL(node);if(dl){this.tooltip=dl.items[0].n;}var parent=this.parent;if(parent){parent.updateOverlay();}updateLinkCss.call(this);},postBuildRendering:function postBuildRendering(){this._super();this.attachEventListener("renderComplete",this.id,function(){setPaddingForItalics.call(this);}.bind(this));updateLinkCss.call(this);if(this.getFormats().overflow==="auto"&&!this.hasCustomScrollbar){this.valueTextNode.style.overflow="auto";}},getAnchor:function getAnchor(){return this.valueTextNode;},getRawText:function getRawText(){return this.node.data.rv||this.v;},ondblclick:function ondblclick(evt){this.cancelDocLink=true;if(!this.isEditing){updateText.call(this,this.getRawText());}this._super(evt);},onTextEditComplete:function onTextEditComplete(textChanged,oldText){if(textChanged){this.parent.textEdited(this.text,textChanged,oldText);this.updateScrollbars();}else{updateText.call(this,this.v);}if(!this.text){this.parent.updateOverlay();}},unrender:function unrender(ignoreDom){this.clearCache();this.isEditing=false;this._super(ignoreDom);},setupScrollNodes:function setupScrollNodes(){var fmts=this.getFormats();if(!fmts.overflow||fmts.overflow==="auto"){this.scrollNode=this.valueTextNode;}},handleRotatedText:function handleRotatedText(){if(this.isTextFieldRotated()){this.valueNode.style.cssText="";window.setTimeout(function(){if(this.hasRendered){this.valueNode.style.cssText=this.valueNodeCssText;var px="px",formats=this.getFormats(),valueNode=this.valueNode,valueNodeStyle=valueNode.style,rotateValue=formats.fx&&formats.fx.rt,offsetWidth=valueNode.offsetWidth,offsetHeight=valueNode.offsetHeight,paddingForItalics=setPaddingForItalics.call(this);switch(rotateValue){case 1:valueNodeStyle.left=offsetWidth+px;break;case 3:valueNodeStyle.top=offsetHeight-1+px;break;}valueNodeStyle.height=offsetWidth+px;valueNodeStyle.width=offsetHeight-paddingForItalics+px;}}.bind(this),0);}},onAppStateChange:function onAppStateChange(evt){var isPresentationMode=mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION===evt.value;this.isEditing=!isPresentationMode;this.editOnClick=!isPresentationMode;},onisEditingChange:function onisEditingChange(evt){this._super(evt);this.parent.set("useRichTooltip",!evt.value);},canShowContentTooltip:function canShowContentTooltip(e,win){var target=$DOM.eventTarget(win,e);return target===this.valueNode||target===this.valueTextNode;}});}());