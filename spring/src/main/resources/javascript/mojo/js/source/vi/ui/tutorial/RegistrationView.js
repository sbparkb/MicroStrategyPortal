(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.css");var emailAddress="",isWaitingForTask=false,defaultButton,freeMsg=mstrmojo.desc(11772,"Register to receive free technical support."),moreInfoMsg=mstrmojo.desc(11771,"Tell us about yourself."),headerMsg=mstrmojo.desc(13576,"Register MicroStrategy Desktop"),placeHolder={fn:mstrmojo.desc(11542,"First Name"),ln:mstrmojo.desc(11543,"Last Name"),email:mstrmojo.desc(4699,"Email"),ph:mstrmojo.desc(8467,"Phone"),jt:mstrmojo.desc(10300,"Job Title"),com:mstrmojo.desc(11545,"Company"),cty:mstrmojo.desc(7674,"Country"),prov:mstrmojo.desc(9967,"State/Province"),login_email:mstrmojo.desc(4699,"Email")},placeHolderMessages={fn:mstrmojo.desc(11524,"Please enter a valid first name")+".",ln:mstrmojo.desc(11525,"Please enter a valid last name")+".",email:mstrmojo.desc(11526,"Please enter a valid email address")+".",ph:mstrmojo.desc(11529,"Please enter a phone number")+".",jt:mstrmojo.desc(11530,"Please enter a job title")+".",com:mstrmojo.desc(11531,"Please enter a company name")+".",cty:mstrmojo.desc(11532,"Please select a country")+".",prov:mstrmojo.desc(11533,"Please enter a state/province")+".",prov_select:mstrmojo.desc(11534,"Please select a state/province")+".",login_email:mstrmojo.desc(11535,"Please enter a valid email address")+"."},placeHolderLength={fn:128,ln:128,email:100,ph:100,jt:120,com:120,cty:100,prov:100,login_email:100};function addStyleToElement(elem,style){if(elem.className.indexOf(style)<0){elem.className+=style;}}function removeStyleFromElement(elem,style){elem.className=elem.className.replace(style,"");}function flagErrorToElement(item,params){addStyleToElement(item," error");if(params){params.error=true;}}function hideTooltip(){var errorMsgElem=this.loginNode.style.display==="block"?this.emailRegisterErrorElem:this.fullRegisterErrorElem;addStyleToElement(errorMsgElem," hidden");}function displayTooltip(elem,errorId){var errorMsgElem=this.loginNode.style.display==="block"?this.emailRegisterErrorElem:this.fullRegisterErrorElem;errorMsgElem.innerHTML=placeHolderMessages[errorId||elem.id];removeStyleFromElement(errorMsgElem," hidden");}function hasErrorFlag(item){return item.className.indexOf(" error")>0;}function clearField(item){var id=item.id,value=item.value;if(placeHolder[id]===value.trim()){item.value="";}addStyleToElement(item," active");if(hasErrorFlag(item)){removeStyleFromElement(item," error");hideTooltip.call(this);}}function isValidEmail(email){var rtnVal=true,re=/\S+@\S+\.\S+/;if(email.length>placeHolderLength.email){rtnVal=false;}else{rtnVal=re.test(email);}return rtnVal;}function validateCurrentField(item){var id=item.id,value=item.value.trim(),length=value.length,valid=true,maxLength=100;if(id==="email"||id==="login_email"){valid=isValidEmail(value);}else{if(id==="fn"||id==="ln"){if(length<2||length>placeHolderLength.fn||value.indexOf("<")>=0||value.indexOf(">")>=0){valid=false;}}else{if(id==="prov"||id==="cty"){if(length<1||value>placeHolderLength.prov||value===placeHolder[id]){valid=false;}}else{if(id==="jt"||id==="com"){maxLength=placeHolderLength.jt;}else{if(id==="ph"){maxLength=placeHolderLength.ph;}}if(length<1||length>maxLength){valid=false;}}}}if(!valid){flagErrorToElement(item);displayTooltip.call(this,item,id);}else{removeStyleFromElement(item," error");}}function checkActivateValue(item){var id=item.id,value=item.value.trim();if(value===""){item.value=placeHolder[id];removeStyleFromElement(item," active");}else{validateCurrentField.call(this,item);}}function activateExistingUser(){if(this.isTooltipVisible()||isWaitingForTask){return ;}var busyElem=document.getElementById("login_show_busy_div"),item=document.getElementById("login_email"),checkAgainButton=document.getElementById("loginButton"),value=item&&item.value.trim();if(value&&!isValidEmail(value)){flagErrorToElement(item);displayTooltip.call(this,item,"email");return ;}isWaitingForTask=true;if(checkAgainButton){addStyleToElement(checkAgainButton," pressed");}if(busyElem){removeStyleFromElement(busyElem,"hidden");}emailAddress=value;var me=this;window.setTimeout(function(){if(!window.FormWrapper.activateMail(emailAddress)){isWaitingForTask=false;me.displayFullInfoWindow();}},100);}function addValueToParams(elem,params,key,value){removeStyleFromElement(elem," error");params[key]=value;}function validateField(id,params,length){var elem=document.getElementById(id),value=elem.value.trim();length=length||1;if((id==="fn"||id==="ln")&&(value.indexOf("<")>=0||value.indexOf(">")>=0)){flagErrorToElement(elem,params);return ;}if(placeHolder[id]===value||value.length<length||value.length>placeHolderLength[id]){flagErrorToElement(elem,params);}else{addValueToParams(elem,params,id,value);}}function addOptionToSelect(selectElem,value,id,addClass){var el=document.createElement("option");el.text=value;el.value=id;if(addClass){el.className="option_cls";}selectElem.options.add(el);}function populateStates(states){var me=this,stElem=document.getElementById("prov"),stSelElem=document.getElementById("prov_select"),dbState=(mstrApp.demandBaseData&&mstrApp.demandBaseData.state)||"",length=states.length,i,state;if(length===0){stSelElem.style.display="none";stElem.style.display="inline-block";stSelElem.value=placeHolder[stElem.id];removeStyleFromElement(stSelElem," error");hideTooltip.call(me);}else{stElem.style.display="none";stElem.value=placeHolder[stElem.id];removeStyleFromElement(stSelElem," error");stSelElem.style.display="inline-block";stSelElem.innerHTML="";addOptionToSelect(stSelElem,"State/Province",-1,false);for(i=0;i<length;i++){state=states[i];addOptionToSelect(stSelElem,state.v,state.id,true);if(state.v===dbState){stSelElem.selectedIndex=i+1;addStyleToElement(stSelElem," active");}}}}function populateCountryList(countries){var select=document.getElementById("cty"),country,i,el;for(i=0;i<countries.length;i++){el=document.createElement("option");country=countries[i];addOptionToSelect(select,country.Value,country.ID,true);}}function validateAllFields(){var params={},elem=document.getElementById("email"),value=elem.value.trim();validateField("fn",params,2);validateField("ln",params,2);if(!isValidEmail(value)){flagErrorToElement(elem,params);}else{addValueToParams(elem,params,"email",value);}validateField("ph",params,1);validateField("jt",params,1);validateField("com",params,1);elem=document.getElementById("cty");if(elem.selectedIndex===0){flagErrorToElement(elem,params);}else{addValueToParams(elem,params,"cty",elem.value.trim());}elem=document.getElementById("prov_select");if(elem.style.display==="none"){validateField("prov",params,1);}else{if(elem.selectedIndex===0){flagErrorToElement(elem,params);}else{addValueToParams(elem,params,"prov",elem.options[elem.selectedIndex].text);}}return params;}function activateNewSubscription(){if(this.isTooltipVisible()||isWaitingForTask){return ;}isWaitingForTask=true;var activateButton=document.getElementById("register_activation_activate");addStyleToElement(activateButton," pressed");addStyleToElement(this.fullRegisterErrorElem," hidden");var params=validateAllFields();if(params.error){this.fullRegisterErrorElem.innerHTML=mstrmojo.desc(11547,"Please check the items in red");removeStyleFromElement(this.fullRegisterErrorElem," hidden");removeStyleFromElement(activateButton," pressed");isWaitingForTask=false;return ;}else{emailAddress=params.email;}window.FormWrapper.activateFullInfo(params.fn,params.ln,params.email,params.ph,params.jt,params.com,params.cty,params.prov);}function enableDefaultButtons(evt){evt=evt||window.event;var charCode=(typeof evt.which==="number")?evt.which:evt.keyCode,target=evt.target||evt.srcElement;if(charCode===13){if(defaultButton&&defaultButton.clientWidth>0){defaultButton.click();}}else{if(target&&target.id==="login_email"){hideTooltip();}}}mstrmojo.vi.ui.tutorial.RegistrationView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.vi.ui.tutorial.RegistrationView",markupString:'<div style="position: absolute;z-index:200;"><div class="activate_dialog register" style="display:block;"><div><span class="activate_header_logo"></span><span class="activate_header">'+headerMsg+'</span></div><div class="activate_text login">'+freeMsg+'</div><div class="activation_inputs"><div class="activation_input_div"><input id="login_email" class="activation_input email" type="text" maxlength="100" value="'+placeHolder.login_email+'" mstrAttach:focus,blur/></div></div><div id="error_msg_div" class="register_error hidden">'+mstrmojo.desc(11547,"Please check the items in red")+'</div><div id="login_show_busy_div" class="showBusy hidden"><span class="show_wait"> </span></div><div class="activation_input_buttons_div"><span id="remindButton" class="activation_input_button remind" mstrAttach:click>'+mstrmojo.desc(13983,"Remind Me Later")+'</span><span id="loginButton" class="activation_input_button activate" mstrAttach:click>'+mstrmojo.desc(11773,"Register")+'</span></div></div><div class="activate_dialog register" style="display:none;"><div><span class="activate_header_logo"></span><span class="activate_header">'+headerMsg+'</span></div><div class="activate_text">'+moreInfoMsg+'</div><div class="activation_inputs"><div class="activation_input_div"><input id="email" class="activation_input email active" type="text" value="'+placeHolder.email+'" maxlength="100" mstrAttach:focus,blur/></div><div class="activation_input_div"><input id="fn" class="activation_input first" type="text" maxlength="100" value="'+placeHolder.fn+'" mstrAttach:focus,blur/><input id="ln" class="activation_input last" type="text" maxlength="100" value="'+placeHolder.ln+'" mstrAttach:focus,blur/></div><div class="activation_input_div"><input id="ph" class="activation_input phone" type="text" value="'+placeHolder.ph+'" maxlength="100" mstrAttach:focus,blur/></div><div class="activation_input_div"><input id="jt" class="activation_input job" type="text" value="'+placeHolder.jt+'" maxlength="100" mstrAttach:focus,blur/><input id="com" class="activation_input company" type="text" value="'+placeHolder.com+'" maxlength="100" mstrAttach:focus,blur/></div><div class="activation_input_div"><select id="cty" class="activation_input country" mstrAttach:change><option  value="-1">'+placeHolder.cty+'</option></select><select id="prov_select" class="activation_input state list" style="display:none;" mstrAttach:change></select><input id="prov" class="activation_input state" type="text" value="'+placeHolder.prov+'" maxlength="100" mstrAttach:focus,blur/></div></div><div id="error_msg_div" class="register_error hidden">'+mstrmojo.desc(11547,"Please check the items in red")+'</div><div class="activation_input_buttons_div"><span id="register_activation_activate" class="activation_input_button activate" mstrAttach:click>'+mstrmojo.desc(11773,"Register")+"</span></div></div></div>",markupSlots:{loginNode:function(){return this.domNode.firstChild;},fullInfoNode:function(){return this.domNode.childNodes[1];},emailRegisterErrorElem:function(){return this.domNode.firstChild.childNodes[3];},fullRegisterErrorElem:function(){return this.domNode.childNodes[1].childNodes[3];}},isTooltipVisible:function isTooltipVisible(){return(this.emailRegisterErrorElem.style.display==="block"||this.fullRegisterErrorElem.style.display==="block");},onclick:function onclick(evt){var item=evt.getTarget(),id=item.id;if(id==="loginButton"){activateExistingUser.call(this);}else{if(id==="register_activation_activate"){activateNewSubscription.call(this);}else{if(id==="remindButton"){window.FormWrapper.closeActivationForm();}}}},onfocus:function onfocus(evt){var item=evt.getTarget(),id=item.id;if(id==="cty"||id==="prov_select"){removeStyleFromElement.call(this,item," error");hideTooltip.call(this);}else{clearField.call(this,item);}},onblur:function onblur(evt){var item=evt.getTarget();checkActivateValue.call(this,item);},onchange:function onchange(evt){var selElem=evt.getTarget(),id=selElem.id;if(selElem.selectedIndex===0){removeStyleFromElement(selElem," active");flagErrorToElement(selElem);displayTooltip.call(this,selElem);}else{addStyleToElement(selElem," active");if(hasErrorFlag(selElem)){removeStyleFromElement(selElem," error");hideTooltip.call(this);}if(id==="cty"){var states=eval(window.FormWrapper.getStates(parseInt(selElem.options[selElem.selectedIndex].value)));populateStates.call(this,states);}}},displayFullInfoWindow:function displayFullInfoWindow(){var demandBase=document.createElement("script");demandBase.setAttribute("src","../javascript/libraries/DemandBase.js");document.head.appendChild(demandBase);this.loginNode.style.display="none";this.fullInfoNode.style.display="block";this.fullInfoNode.childNodes[2].firstChild.firstChild.value=window.FormWrapper.getEmailAddress()||placeHolder.email;defaultButton=this.fullInfoNode.lastChild.lastChild;var countries=eval(window.FormWrapper.getAllCountries());populateCountryList.call(this,countries);},postBuildRendering:function postBuildRendering(){this._super();if(window.FormWrapper.displayFullInfo()){this.displayFullInfoWindow();}else{defaultButton=this.loginNode.lastChild.lastChild;}document.onkeyup=enableDefaultButtons;}});}());