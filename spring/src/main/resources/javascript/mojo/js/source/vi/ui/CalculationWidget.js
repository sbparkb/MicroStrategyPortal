(function(){mstrmojo.requiresClsP("mstrmojo","ListBase","_IsList");mstrmojo.vi.ui.CalculationWidget=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.vi.ui.CalculationWidget",prevSelection:{},itemField:"v",selectionPolicy:"toggle",multiSelect:false,init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-vi-calculation");},_set_selectedItems:function(n,v){var selectedTypes=(v||[]).map(function(item){return item.t;}),prevSelection=this.prevSelection={};selectedTypes.forEach(function(type){prevSelection[type]=true;});this.setSelectedItems(this.items.filter(function(item){return selectedTypes.indexOf(item.v)>-1;}));},getCalculationTypes:function getCalculationTypes(){var items=this.items,selectedIndices=this.selectedIndices,prevSelection=this.prevSelection,selectItems=items.filter(function(item,idx){return selectedIndices[idx]&&!prevSelection[item.v];}),clearItems=items.filter(function(item,idx){return !selectedIndices[idx]&&prevSelection[item.v];}),fnMap=function(item){return item.v;};return[selectItems.map(fnMap),clearItems.map(fnMap)];},onselectionChange:function onselectionChange(evt){this._super(evt);this.parent.applyCalculation(this.selectedItem.v);}});}());