(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.registry","mstrmojo._HasContextMenu","mstrmojo.Widget");var $DOM=mstrmojo.dom,$CSS=mstrmojo.css,SCROLLBAR_WIDTH=16;mstrmojo.ContextMenuItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasContextMenu],{scriptClass:"mstrmojo.ContextMenuItem",SUBMENU_SHIFT:3,visible:true,checked:false,enabled:true,buildDom:function(){var ph=document.createElement("tr"),d=this.data,w=this._cmSource,td,img;ph.id=this.id;ph.className="mstrmojo-ContextMenuItem "+(w.isSeparatorItem(d)?"separator":w.item2textCss(d));var me=this,fo=function(){me.handleMouseOver();},ft=function(){me.handleMouseOut();},fc=function(){me.handleClick();};$DOM.attachEvent(ph,"mouseover",fo);$DOM.attachEvent(ph,"mouseout",ft);$DOM.attachEvent(ph,"click",fc);td=document.createElement("td");ph.appendChild(td);td.className="mstrmojo-CMI-left";img=document.createElement("img");img.src="../images/1ptrans.gif";td.appendChild(img);td=document.createElement("td");ph.appendChild(td);td.className="mstrmojo-CMI-text";if(w.isSeparatorItem(d)){img=document.createElement("img");img.src="../images/1ptrans.gif";}else{img=document.createElement("div");img.className="mstrmojo-CMI-content";td.innerHTML=d.itemWidget?"&nbsp":d[this.itemField];}td.appendChild(img);td=document.createElement("td");ph.appendChild(td);td.className="mstrmojo-CMI-right "+(this.hasSubmenu?"sm":"");img=document.createElement("img");img.src="../images/1ptrans.gif";td.appendChild(img);return ph;},buildRendering:function bldRn(){this._super();var w=this.data.itemWidget;if(w){w.placeholder=this.domNode.cells[1].children[0];w.data=this.data;w=mstrmojo.insert(w);w.render();w.parent=this;this.itemWidget=w;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"":"none";},oncheckedChange:function(){$CSS.toggleClass(this.domNode,["checked"],this.checked);},onenabledChange:function(){$CSS.toggleClass(this.domNode,["disabled"],!this.enabled);}},getMenuPosition:function getMenuPosition(){var pos=$DOM.position(this.domNode,true);return{x:Math.round(pos.x+pos.w-this.SUBMENU_SHIFT),y:Math.round(pos.y)};},getContextMenuItems:function getContextMenuItems(){return this.data[this.itemChildrenField];},getContextMenuCssClass:function getContextMenuCssClass(){return this.data.cmCssClass||"";},callOnContextMenuOpen:function callOnContextMenuOpen(){var d=this.data;if(d.onContextMenuOpen){d.onContextMenuOpen.apply(this,[]);}},callOnContextMenuClose:function callOnContextMenuClose(){var d=this.data;if(d.onContextMenuClose){d.onContextMenuClose.apply(this,[]);}},attachMousedownEvent:function attachMousedownEvent(){},getContextMenuSource:function getContextMenuSource(){return this._cmSource;},adjustMenuPosition:function adjustMenuPosition(){var cm=this._subMenu,cmd=this._subMenu.domNode,h=cmd.offsetHeight,w=cmd.offsetWidth,wDim=$DOM.windowDim(),pos=$DOM.position(cmd,false),posX=$DOM.position(cmd,true);if((pos.x+w+SCROLLBAR_WIDTH)>wDim.w){cm.set("left",($DOM.position(this.domNode,true).x-w)+"px");}if((pos.y+h+SCROLLBAR_WIDTH)>wDim.h){cm.set("top",(wDim.h-h-SCROLLBAR_WIDTH+(posX.y-pos.y))+"px");}},handleMouseOver:function handleMouseOver(){var me=this,of=function(){if(me.hasSubmenu){me.showContextMenu();}me._cmSource.closeMenuTree(me);me._mouseOverTimer=null;};if(this._cmSource.activeMenuItem!==this){this._mouseOverTimer=window.setTimeout(of,80);}},handleMouseOut:function handleMouseOut(){if(this._mouseOverTimer){window.clearTimeout(this._mouseOverTimer);this._mouseOverTimer=null;}},closeMenuTree:function closeMenuTree(){this._cmSource.closeMenuTree();},handleClick:function handleClick(){if(this.hasSubmenu){return ;}var cms=this._cmSource,d=this.data;if(!this.itemWidget){if(!cms.isSeparatorItem(d)&&cms.queryEnabled(d)){if(cms.executeCommand){cms.executeCommand(this.data);}cms.closeMenuTree();}}}});}());