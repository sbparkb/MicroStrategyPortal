(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.string","mstrmojo.expr","mstrmojo.date","mstrmojo.ValidationTextBox","mstrmojo.DateTextBox");var $A=mstrmojo.array,$C=mstrmojo.css,$S=mstrmojo.string,$D=mstrmojo.date,$E=mstrmojo.expr,$DTP=$E.DTP,$FN=$E.FN,$V=mstrmojo.validation;var optFNMap={};optFNMap[$FN.BETWEEN]=$FN.NOT_BETWEEN;optFNMap[$FN.NOT_BETWEEN]=$FN.BETWEEN;optFNMap[$FN.GREATER_EQUAL]=$FN.LESS;optFNMap[$FN.LESS]=$FN.GREATER_EQUAL;optFNMap[$FN.LESS_EQUAL]=$FN.GREATER;optFNMap[$FN.GREATER]=$FN.LESS_EQUAL;optFNMap[$FN.SEARCH]=$FN.SEARCH;function enterKeyOnTextBox(evt){if(this.value!==this._lastInput){valueChangeOnTextBox.call(this,evt,true);}}function clickOnTextBox(evt){mstrmojo.DateTextBox.prototype.onclick.call(this,evt);$C.addClass(this.calendar&&this.calendar.domNode,mstrApp.getThemeClassName());}function valueChangeOnTextBox(evt,submitNow){var widget=this.parent.parent;if(!widget._inSyncPhase){var calPicker=this.calendar&&this.calendar.cal,me=this,tmr=widget.submitTimer;if(tmr){window.clearTimeout(tmr);}if(!mstrApp.isWaiting()){if(submitNow||calPicker&&calPicker.value===this.value){this._lastInput=this.value;widget.submit(me);}else{widget.submitTimer=window.setTimeout(function(){me._lastInput=me.value;widget.submit(me);},3000);this.set("dynDateValue",null);if(calPicker){calPicker.set("value",this.value);}}}else{if(this._lastInput){this.set("value",this._lastInput);}}}}function assembleDynDate(d){if(!d.isDyn){return null;}var dynDate=["isDyn"];dynDate.push(d.dyt||0);dynDate.push(d.ddo||0);dynDate.push(d.dmo||0);dynDate.push(d.dm||0);dynDate.push(d.dd||0);dynDate.push(d.dw||0);dynDate.push(d.dow||0);dynDate.push(d.v||"");if(d.dtp===$E.DTP.TIMESTAMP){var dt=$D.parseDateAndOrTime(d.v||""),t=dt&&dt.time;if(t){d.dh=t.hour;d.dmi=t.min;d.ds=t.sec;}}dynDate.push(d.dh||0);dynDate.push(d.dmi||0);dynDate.push(d.ds||0);return dynDate.join("::");}function getWidgetHelper(parent,dt,f){return{parent:parent,dt:dt,f:f,setDataType:function setDT(dt){this.dt=dt;},setFunction:function setFun(f){this.f=f;},hasSecTextBox:function hasSecTextBox(){var f=this.f;return f!==$FN.SEARCH;},adjustVisibleFields:function adjustVFS(){var p=this.parent;if(!this.hasSecTextBox()){p.toBox.set("visible",false);p.fromBox.fromLabel.set("visible",false);}if(dt===$E.DTP.DATE||dt===$E.DTP.TIMESTAMP){p.fromBox.fromInput.set("visible",false);p.toBox.toInput.set("visible",false);}else{p.fromBox.fromPicker.set("visible",false);p.toBox.toPicker.set("visible",false);}},passValueToInputs:function passValueToInputs(cs){var p=this.parent,from,to,me=this,setValueToInput=function(csv,input){if(me.f===$FN.SEARCH||csv.v!=="*"){input.set("value",csv.v);input._lastInput=csv.v;if(dt===$E.DTP.DATE||dt===$E.DTP.TIMESTAMP){input.set("dynDateValue",assembleDynDate(csv));}}};if(dt===$E.DTP.DATE||dt===$E.DTP.TIMESTAMP){from=p.fromBox.fromPicker;to=p.toBox.toPicker;}else{from=p.fromBox.fromInput;to=p.toBox.toInput;}if(f===$FN.BETWEEN||f===$FN.NOT_BETWEEN){if(cs&&cs[0]){setValueToInput(cs[0],from);}else{from.set("value",from.min||"");from._lastInput=from.min||"";}if(this.hasSecTextBox()&&cs&&cs[1]){setValueToInput(cs[1],to);}else{to.set("value",to.max||"");to._lastInput=to.max||"";}}else{if(f===$FN.GREATER_EQUAL||f===$FN.LESS){if(cs&&cs[0]){setValueToInput(cs[0],from);to.set("value",to.max||"");to._lastInput=to.max||"";}}else{if(f===$FN.LESS_EQUAL||f===$FN.GREATER){if(cs&&cs[0]){setValueToInput(cs[0],to);from.set("value",from.min||"");from._lastInput=from.min||"";}}}}}};}mstrmojo.vi.ui.rw.selectors.AttrQualInputBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.AttrQualInputBox",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},cssClass:"Attr-Qual-InputBox",children:[{scriptClass:"mstrmojo.Box",alias:"fromBox",cssClass:"from-box",children:[{scriptClass:"mstrmojo.Label",alias:"fromLabel",cssDisplay:"inline-block",cssClass:"input-label",text:mstrmojo.desc(146,"From:")},{scriptClass:"mstrmojo.ValidationTextBox",alias:"fromInput",cssDisplay:"inline-block",required:false,constraints:{trigger:$V.TRIGGER.ALL},autoFormat:false,onEnter:enterKeyOnTextBox,onblur:enterKeyOnTextBox,_lastInput:null,bindings:{dtp:"this.parent.parent.dt"}},{scriptClass:"mstrmojo.DateTextBox",alias:"fromPicker",cssDisplay:"inline-block",required:false,calendarToBody:true,constraints:{trigger:$V.TRIGGER.ALL},autoFormat:false,onvalueChange:valueChangeOnTextBox,onEnter:enterKeyOnTextBox,onblur:enterKeyOnTextBox,_lastInput:null,bindings:{dtp:"this.parent.parent.dt",min:"this.parent.parent.min",max:"this.parent.parent.max",defaultDate:"this.parent.parent.min",showAdvanced:"this.parent.parent.showAdvanced",canSelectDisabledDate:"this.parent.parent.canSelectDisabledDate"},onclick:clickOnTextBox}]},{scriptClass:"mstrmojo.Box",alias:"toBox",cssClass:"to-box",children:[{scriptClass:"mstrmojo.Label",alias:"toLabel",cssDisplay:"inline-block",cssClass:"input-label",text:mstrmojo.desc(147,"To:")},{scriptClass:"mstrmojo.ValidationTextBox",alias:"toInput",cssDisplay:"inline-block",required:false,constraints:{trigger:$V.TRIGGER.ALL},autoFormat:false,onEnter:enterKeyOnTextBox,onblur:enterKeyOnTextBox,_lastInput:null,bindings:{dtp:"this.parent.parent.dt"}},{scriptClass:"mstrmojo.DateTextBox",alias:"toPicker",cssDisplay:"inline-block",required:false,calendarToBody:true,constraints:{trigger:$V.TRIGGER.ALL},autoFormat:false,onvalueChange:valueChangeOnTextBox,onEnter:enterKeyOnTextBox,onblur:enterKeyOnTextBox,_lastInput:null,bindings:{dtp:"this.parent.parent.dt",min:"this.parent.parent.min",max:"this.parent.parent.max",defaultDate:"this.parent.parent.max",showAdvanced:"this.parent.parent.showAdvanced",canSelectDisabledDate:"this.parent.parent.canSelectDisabledDate"},onclick:clickOnTextBox}]}],widgetResized:function(){var me=this,w=parseInt(this.width,10),boxs=["fromBox","toBox"],hasRendered,inOneRow;if(!this.widgetHelper.hasSecTextBox()){boxs=["fromBox"];}if(w>368){inOneRow=true;}else{inOneRow=false;}if(me.parent.isInFilterPanel()||!this.widgetHelper.hasSecTextBox()){inOneRow=false;return ;}window.setTimeout(function(){hasRendered=me.hasRendered;$A.forEach(boxs,function(box){if(hasRendered){$C.toggleClass(me[box].domNode,"onerow",inOneRow);me[box].domNode.style.display=inOneRow?"inline-block":"block";}else{if(inOneRow){$C.addWidgetCssClass(me[box],"onerow");me[box].cssDisplay="inline-block";}else{$C.removeWidgetCssClass(me[box],"onerow");me[box].cssDisplay="block";}}});},0);},init:function init(props){if(this._super){this._super(props);}this.widgetHelper=getWidgetHelper(this,this.dt,this.f);this.updateWidgetByData();},update:function update(props){if(props){this.cs=props.cs;if(props.f){this.f=props.f;}if(props.ft){this.ft=props.ft;}if(props.fid){this.fid=props.fid;}if(props.min){this.set("min",props.min);}if(props.max){this.set("max",props.max);}}this.updateWidgetByData();},updateWidgetByData:function updateWidgetByData(){var wh=this.widgetHelper,cs=this.cs;this._inSyncPhase=true;wh.adjustVisibleFields();wh.passValueToInputs(cs);this._inSyncPhase=false;},onincludeChange:function incChange(){this.f=optFNMap[this.f];if(!this._inSyncPhase){this.onchange();}},submit:function submit(input){var cs=this.cs=[],include=this.parent.include,wh=this.widgetHelper,valid=(input.validationStatus.code===$V.STATUSCODE.VALID),docModel=this.parent.model,anotherInput;if(wh.hasSecTextBox()){if(input.alias==="toInput"){anotherInput=this.fromBox.fromInput;}else{if(input.alias==="toPicker"){anotherInput=this.fromBox.fromPicker;}else{if(input.alias==="fromInput"){anotherInput=this.toBox.toInput;}else{if(input.alias==="fromPicker"){anotherInput=this.toBox.toPicker;}}}}anotherInput.validate();if(anotherInput.validationStatus.code!==$V.STATUSCODE.VALID){valid=false;}}if(valid){if(wh.hasSecTextBox()){var from=(input.alias.indexOf("from")===0)?input:anotherInput,to=(input.alias.indexOf("to")===0)?input:anotherInput,fromValue=from.dynDateValue||from.value,toValue=to.dynDateValue||to.value;this.unset=$S.isEmpty(fromValue)&&$S.isEmpty(toValue);if(!$S.isEmpty(fromValue)&&!$S.isEmpty(toValue)){cs[0]={v:fromValue};cs[1]={v:toValue};this.f=include?$FN.BETWEEN:$FN.NOT_BETWEEN;}else{if(!$S.isEmpty(fromValue)){if(docModel.isFromSolrCube&&docModel.isFromSolrCube(this.srcid)){cs[0]={v:fromValue};cs[1]={v:"*"};this.f=include?$FN.BETWEEN:$FN.NOT_BETWEEN;}else{cs[0]={v:fromValue};this.f=include?$FN.GREATER_EQUAL:$FN.LESS;}}else{if(!$S.isEmpty(toValue)){if(docModel.isFromSolrCube&&docModel.isFromSolrCube(this.srcid)){cs[0]={v:"*"};cs[1]={v:toValue};this.f=include?$FN.BETWEEN:$FN.NOT_BETWEEN;}else{cs[0]={v:toValue};this.f=include?$FN.LESS_EQUAL:$FN.GREATER;}}}}}else{cs[0]={v:input.value};this.unset=$S.isEmpty(cs[0].v);this.f=$FN.SEARCH;}this.onchange();if(this.makeSelection){this.makeSelection({selItem:this.domNode});}}},getSummaryText:function getSummaryText(){var cs=this.cs||[],f=this.f;if(this.unset||!cs.length||$S.isEmpty(cs[0].v)&&(cs.length<=1||$S.isEmpty(cs[1].v))){return"";}var txt="",include=this.parent.include;switch(f){case $FN.BETWEEN:case $FN.NOT_BETWEEN:txt=mstrmojo.desc(4804).replace("##",cs[0].v).replace("###",cs[1].v);break;}if(!include){txt=mstrmojo.desc(1099,"Not")+" "+txt;}return txt;}});}());