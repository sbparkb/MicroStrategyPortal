(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.EditorModel","mstrmojo.models.FormatModel","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.vi.ui.TextAlignButtonBar","mstrmojo.ui.editors.CharacterToolbarPopup","mstrmojo.array","mstrmojo.hash");var TARGET_CONTAINER=0,$CONTAINER_FLAGS=mstrmojo.ui.editors.controls.ContainerGroup.CTRL_FLAGS,$FORMAT_MODEL=mstrmojo.models.FormatModel,$EN_TITLE_ALIGN=$FORMAT_MODEL.ENUM_PROPERTY_NAMES.TEXT_ALIGN,$HASH=mstrmojo.hash,currentTarget=TARGET_CONTAINER;function changeUnitFormats(formatType,formats,propertyName,newValue,oldValue){var isTitleFormat=formatType===this.getTitleFormatCode(),fnConverter;if(propertyName===$EN_TITLE_ALIGN){fnConverter=function(formatValue){return this.titleAlignButtonBar.items.filter(function(item){return item.v===formatValue;})[0].id;}.bind(this);}this.getHost().parent.changeUnitFormats(isTitleFormat,formatType,formats,propertyName,newValue,oldValue,fnConverter,function(value){this.raiseEvent({name:"BEMFormatChange",propertyName:propertyName,value:value,isTitle:isTitleFormat});}.bind(this));}function getTitleAlignBar(selectedValue,fnChange){var textAlign=new mstrmojo.vi.ui.TextAlignButtonBar({includeJustify:false});this.titleAlignButtonBar=textAlign;textAlign.singleSelect(textAlign.items.map(function(item){return item.id;}).indexOf(selectedValue));textAlign.onValueChange=function(newValue,oldValue){fnChange($EN_TITLE_ALIGN,newValue,oldValue);};return this.getLabelAndControl(mstrmojo.desc(13597,"Alignment:"),textAlign);}function getDefaultControls(dynamicCtrlGroup){var formats=this.getHost().getFormats(),titleFormats=formats.ttl,editorGroups=[];if(titleFormats){var fnTitleChange=changeUnitFormats.bind(this,this.getTitleFormatCode(),formats),host=this.getHost(),titleShown=host.parent.getTitleBarVisibility(),titleControls=[this.getCharacterGroup(fnTitleChange,titleFormats),this.getContainerGroup(titleFormats,fnTitleChange,$CONTAINER_FLAGS.FILL_COLOR,{showBackgroundNoFill:false}),getTitleAlignBar.call(this,$FORMAT_MODEL.getFormatBlockValue(titleFormats,$EN_TITLE_ALIGN),fnTitleChange)];titleControls.forEach(function(ctrl){ctrl.set("enabled",titleShown);});editorGroups.push(this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(4756,"Title")),this.getCheckboxAndLabel(titleShown,mstrmojo.desc(13599,"Show titlebar"),function(newValue){host.parent.toggleTitleBar(!!newValue);})].concat(titleControls),{cssClass:"bem-tc-title",showDivider:false}));}editorGroups.push(this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(11917,"Container")),this.getContainerGroup(formats,changeUnitFormats.bind(this,1,formats),this.getContainerCtrlFlags(),{showBackgroundNoFill:false,showBorderNoFill:false})],{cssClass:"bem-tc-container"}));this.replaceChildControls(dynamicCtrlGroup,editorGroups.concat(this.getTitleAndContainerControls()));}function getTargetPulldown(dynamicCtrlGroup){var pulldownItems=this.getTargetPulldownItems(dynamicCtrlGroup);var pulldown=this.getPulldown(pulldownItems,function(newTargetValue){currentTarget=newTargetValue;pulldownItems[pulldownItems.map(function(item){return item.v;}).indexOf(newTargetValue)].h(newTargetValue);});pulldown.set("selectedIndex",Math.max(pulldownItems.map(function(item){return item.v;}).indexOf(currentTarget),0));return pulldown;}mstrmojo.vi.models.editors.BaseEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.EditorModel,null,{scriptClass:"mstrmojo.vi.models.editors.BaseEditorModel",titleAlignButtonBar:null,init:function init(props){this._super(props);currentTarget=this.getInitialTarget();},selectTargetByValue:function selectTargetByValue(value){if(value!==undefined){var targetPulldown=this._targetPulldown;if(targetPulldown){targetPulldown.selectItemByField("v",value);}}},getInitialTarget:function getInitialTarget(){return TARGET_CONTAINER;},getEditorContents:function getEditorContents(){var dynamicCtrlGroup=this.getEditorGroup([],{cssClass:"bem-dynamic-grp",showDivider:false,isNested:true,isContainer:true});var targetPulldown=this._targetPulldown=getTargetPulldown.call(this,dynamicCtrlGroup),contents=[dynamicCtrlGroup].concat(this.getCommonControls());if(targetPulldown.items.length>1){contents.unshift(this.getEditorGroup([targetPulldown]));}return contents;},getFormattingToolbar:function getFormattingToolbar(fmtTarget,anchorEl,props){if(fmtTarget===TARGET_CONTAINER){var host=this.getHost(),formats=host.getFormats(),titleFormats=formats.ttl;if(titleFormats){titleFormats=$HASH.copy(titleFormats);titleFormats[$EN_TITLE_ALIGN]=this.titleAlignButtonBar.items.filter(function(item){return item.id===titleFormats["text-align"];})[0].v;var toolbar=new mstrmojo.ui.editors.CharacterToolbarPopup($HASH.copy({onGroupValueChange:changeUnitFormats.bind(this,this.getTitleFormatCode(),formats),textAlignJustify:false,textAlignFmtName:$EN_TITLE_ALIGN,anchorElement:anchorEl},props));toolbar.setFormatSource(titleFormats);return toolbar;}}return null;},getCommonControls:function getCommonControls(){return[];},getContainerCtrlFlags:function getContainerCtrlFlags(){return $CONTAINER_FLAGS.FILL_COLOR+$CONTAINER_FLAGS.BORDER;},getTitleAndContainerControls:function getTitleAndContainerControls(){return[];},getTargetPulldownItems:function getTargetPulldownItems(dynamicCtrlGroup){var formats=this.getHost().getFormats(),pulldownItems=[];if(formats&&(this.getHost().showTitleAndContainerFormats!==false)){pulldownItems.push({n:mstrmojo.desc(12049,"Title and Container"),v:TARGET_CONTAINER,h:getDefaultControls.bind(this,dynamicCtrlGroup)});}return pulldownItems;},getTitleFormatCode:function getTitleFormatCode(){return 2;}});mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE=TARGET_CONTAINER;}());