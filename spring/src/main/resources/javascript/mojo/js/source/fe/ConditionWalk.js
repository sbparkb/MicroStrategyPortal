(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.rw.ConditionWalk","mstrmojo.Label","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.expr","mstrmojo.css");var $MQ=mstrmojo.expr.ET.MQ,$MC=mstrmojo.expr.ET.MC,$CSS=mstrmojo.css,idcsiText=mstrmojo.desc(14387,"Evaluate this condition independent of other dataset level conditions");var showTools=function(conditionData,level){var et=conditionData.et,visible=((et===$MQ||et===$MC)&&!this.inRelation)?"block":"none",selectLevel=((level===1)||et!==$MQ)?1:0;$CSS.toggleClass(this.toolNode,"unselectable",et===$MC);this.toolNode.style.display=visible;this.level.set("selectedIndex",selectLevel);this.includeExist.set("visible",selectLevel===1&&(et===$MC||et===$MQ));this.includeExist.set("checked",conditionData.idcsi===undefined?false:conditionData.idcsi);};mstrmojo.fe.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,null,{scriptClass:"mstrmojo.fe.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="tools"></div><div class="apply"></div></div>',markupSlots:mstrmojo.hash.copy({toolNode:function(){return this.domNode.childNodes[2];}},mstrmojo.hash.copy(mstrmojo.rw.ConditionWalk.prototype.markupSlots)),layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",toolNode:"auto",applyNode:"auto"},xt:true},postCreate:function postCreate(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Label",slot:"toolNode",text:mstrmojo.desc(13517,"Calculate on")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"toolNode",alias:"level",isHostedWithin:false,items:[{n:mstrmojo.desc(13518,"Template level"),v:0},{n:mstrmojo.desc(13519,"Dataset level"),v:1}],onitemSelected:function onitemSelected(item){var p=this.parent;if(p&&p.condition&&p.visible){p.includeExist.set("visible",item.v===1);p.condition.level=item.v;}}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"includeExist",slot:"toolNode",postBuildRendering:function(){this.domNode.innerHTML=idcsiText;},oncheckedChange:function(){var p=this.parent;if(p){p.model.set("idcsi",this.checked);}}}]);if(this._super){this._super();}},onvisibleChange:function onvisibleChange(evt){var cond=this.condition;if(cond&&this.toolNode&&this.visible){showTools.call(this,cond.data,cond.tree.level);}if(this._super){this._super(evt);}},onmodeledit:function onmodeledit(evt){if(this._super){this._super(evt);}if(this.toolNode){showTools.call(this,this.model.get(),this.model.level);}}});}());