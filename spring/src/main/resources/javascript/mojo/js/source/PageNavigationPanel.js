(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css","mstrmojo.Pulldown","mstrmojo.ProgressBar");var $D=mstrmojo.dom,$C=mstrmojo.css,DISABLE_CSS="disabled",NOT_FOUND=-1;function setBtnsCss(){var sel=this.selected,len=this.panels.length,cur=this.getValidPanelsNum(sel),tot=this.getValidPanelsNum(len);if(cur===tot-1){$C.addClass(this.nextBtnNode,DISABLE_CSS);}else{$C.removeClass(this.nextBtnNode,DISABLE_CSS);}if(cur===0){$C.addClass(this.prevBtnNode,DISABLE_CSS);}else{$C.removeClass(this.prevBtnNode,DISABLE_CSS);}}mstrmojo.PageNavigationPanel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.PageNavigationPanel",markupString:'<div class="mstrmojo-PageNavPanel {@cssClass}" style="{@cssText}" mstrAttach:click><div class="header"><div class="titles"><div class="title">{@title}</div><div class="subtitle">{@subtitle}</div></div><div class="progress"></div><div class="navigation"></div></div><div class="content"></div><div class="footer"><div class="prev"><div class="btn" btnv="pre">{@prevText}</div></div><div class="pges"></div><div class="next"><div class="btn" btnv="nxt">{@nextText}</div></div></div></div>',markupSlots:{headerNode:function(){return this.domNode.firstChild;},progressBarNode:function(){return this.domNode.firstChild.childNodes[1];},navigationNode:function(){return this.domNode.firstChild.childNodes[2];},containerNode:function(){return this.domNode.childNodes[1];},footerNode:function(){return this.domNode.lastChild;},prevBtnNode:function(){return this.domNode.lastChild.firstChild;},pagesNode:function(){return this.domNode.lastChild.childNodes[1];},nextBtnNode:function(){return this.domNode.lastChild.lastChild;}},markupMethods:{onsubtitleChange:function(){this.headerNode.firstChild.lastChild.innerHTML=this.subtitle||"";},onheaderVisibleChange:function(){this.headerNode.style.display=this.headerVisible?"":"none";},ontitleVisibleChange:function(){this.headerNode.firstChild.style.display=this.titleVisible?"":"none";},onsubtitleVisibleChange:function(){this.headerNode.lastChild.style.display=this.subtitleVisible?"":"none";},onheightChange:function(){var hh=this.headerHeight,fh=this.footerHeight;if(this.height){if(!hh||!fh){hh=this.headerHeight=this.headerNode.offsetHeight||0;fh=this.headerHeight=this.footerNode.offsetHeight||0;}this.containerNode.style.height=(parseInt(this.height,10)-hh-fh)+"px";}}},title:"",subtitle:"",prevText:"Prev",nextText:"Next",selected:0,headerVisible:true,titleVisible:true,subtitleVisible:true,panels:null,renderedPanels:0,init:function init(props){this.panels=[];this._super(props);},onselectedChange:function onselectedChange(){var sel=this.selected,ls=this._lastSelected,p=this.panels[sel],lp=this.panels[ls];if(lp){lp.set("visible",false);}if(p){p.set("visible",true);}this.set("subtitle",p.title);this._lastSelected=this.selected;setBtnsCss.call(this);if(this.navlst){this.navlst.set("value",sel);}this.updatePageNode();},onrenderedPanelsChange:function onrenderedPanelsChange(){var pc=this.panels.length,vpc=this.renderedPanels;if(pc>0){this.updateProgressNode(Math.floor(100*vpc/pc));}else{this.updateProgressNode(0);}},updateProgressNode:function updateProgressNode(pct){if(this.prgbar){this.prgbar.updateProgress(pct,pct+"% completed");}},updatePageNode:function updatePageNode(){this.pagesNode.innerHTML=(this.getValidPanelsNum(this.selected)+1)+"/"+this.getValidPanelsNum(this.panels.length);},getValidPanelsNum:function getValidPanelsNum(sel){var count=0,panels=this.panels||[];for(var i=0,len=panels.length;i<len;i++){if(i===sel){return count;}if(!panels[i].isHide){count++;}}return count;},getNextValidPanel:function getNextValidPanel(sel){var panels=this.panels||[];for(var i=sel+1,len=panels.length;i<len;i++){if(!panels[i].isHide){return i;}}return NOT_FOUND;},getPreValidPanel:function getPreValidPanel(sel){var panels=this.panels||[];for(var i=sel-1;i>=0;i--){if(!panels[i].isHide){return i;}}return NOT_FOUND;},showNextPanel:function showNextPanel(){var sel=this.selected,p=this.panels[sel],next=this.getNextValidPanel(sel);if(next===NOT_FOUND){return ;}if(!p.viewed){p.viewed=true;this.set("renderedPanels",this.renderedPanels+1);}this.set("selected",next);},showPreviousPanel:function showPreviousPanel(){var sel=this.selected,p=this.panels[sel],pre=this.getPreValidPanel(sel);if(pre===NOT_FOUND){return ;}if(!p.viewed){p.viewed=true;this.set("renderedPanels",this.renderedPanels+1);}this.set("selected",pre);},update:function update(curIdx){var panels=this.panels,len=panels.length,navlst=this.navlst,panel;if(curIdx>=len){return ;}panel=this.panels[curIdx];this.updatePageNode();setBtnsCss.call(this);navlst.items[curIdx].css=(!panel.isHide)?"enabled":"disabled";},preBuildRendering:function preBuildRendering(){var i,len,ps=this.panels||[],menu=[],sel=0,me=this;if(ps.length>0){for(i=0,len=ps.length;i<len;i++){if(i!==this.selected){ps[i].visible=false;}else{sel=i;}menu.push({n:ps[i].title,v:i,css:(sel===i)?"enabled":"disabled"});}this.set("children",[{scriptClass:"mstrmojo.ProgressBar",alias:"prgbar",slot:"progressBarNode"},{scriptClass:"mstrmojo.Pulldown",alias:"navlst",slot:"navigationNode",items:menu,itemIdField:"v",defaultSelection:sel,onvalueChange:function onvalueChange(){var panels=me.panels,p=panels[me._lastSelected];me.set("selected",this.value);this.items[this.value].css="enabled";if(!p.viewed){p.viewed=true;me.set("renderedPanels",me.renderedPanels+1);}},prevalueChange:function prevalueChange(){var panels=me.panels;if(!panels[this.value].viewed||panels[this.value].isHide){this.value=me._lastSelected;}}}].concat(ps));this.set("subtitle",ps[0].title);this._lastSelected=this.selected;}this._super();},postBuildRendering:function postBuildRendering(){this._super();this.updateProgressNode(0);this.updatePageNode();setBtnsCss.call(this);},onclick:function onclick(e){var t=$D.eventTarget(window,e.e),b=t.getAttribute("btnv"),sel=this.selected,panels=this.panels,len=panels.length,cur=this.getValidPanelsNum(sel),tot=this.getValidPanelsNum(len);if(b){if(b==="pre"&&cur>0){this.showPreviousPanel();}else{if(b==="nxt"&&cur<tot-1){this.showNextPanel();}}}}});}());