(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.desc","mstrmojo.android.ui.Button","mstrmojo.android.controllers._HasSelectBoxDialog");mstrmojo.requiresDescs(221,1442,5136,2941);var $HASH=mstrmojo.hash,$ARR=mstrmojo.array,$DESC=mstrmojo.desc,$BTN=mstrmojo.android.ui.Button.newButton;function displayPageByDialog(title,isDoc){var pageByData=$HASH.clone(this.pageByData),pageElements=pageByData.es,dialogCfg={title:title,dialogRefresh:function(){this.refresh();}},ctrl=this,pageCnt=0,depth,pageBys,selections,selectedIndices,fnClearPageBy,fnPageHeader,fnGetPages,fnIterateSelections,fnSubmit;fnClearPageBy=function(node){var idx=selectedIndices.shift(),item=node.ph.h[idx];delete item.cet;if(item.ph){fnClearPageBy(item);}};fnPageHeader=function(node){var page=node.ph;if(!page){return ;}var items=[],selectedPageHeader;$ARR.forEach(page.h,function(v,idx){var ix=v.ix,cet=v.cet||0;var el=pageElements[ix];items[idx]={n:el.en,v:ix,on:cet};if(cet){selections[depth]=items[idx];selectedIndices[depth]=idx;selectedPageHeader=v.ph;}});var selected=selections[depth];pageBys.push({n:page.n,items:items,v:selected.n});depth++;fnPageHeader($HASH.copy(selected,{ph:selectedPageHeader}));};fnGetPages=function(){depth=0;pageBys=[];selections=[];selectedIndices=[];fnPageHeader(pageByData);pageCnt=pageBys.length;};fnIterateSelections=function(fnModifier){var pageHeader=pageByData.ph;$ARR.forEach(selections,function(v){var headers=pageHeader.h,index=$ARR.find(headers,"ix",v.v),selectedHeader;if(index<0){index=(isDoc&&headers.length>1)?1:0;}selectedHeader=headers[index];fnModifier(selectedHeader,pageHeader);pageHeader=selectedHeader.ph;});};fnSubmit=function(){var pageByKeys=[];fnIterateSelections(function(selectedHeader,pageHeader){pageByKeys.push({id:pageHeader.id||"m",tp:pageHeader.tp,v:pageElements[selectedHeader.ix].ei});});ctrl.pageByData=pageByData;ctrl.onPageBy(pageByKeys);};fnGetPages();if(pageCnt>1){dialogCfg.buttons=[$BTN($DESC(221,"Cancel")),$BTN($DESC(1442,"OK"),function(){fnSubmit();})];}this.showSelectBoxDialog(pageBys,function(idx,item){fnClearPageBy(pageByData);selections[idx]=item;fnIterateSelections(function(selectedHeader){selectedHeader.cet=1;});fnGetPages();if(pageCnt>1){if(!!this.isNative){this.update(pageBys);}else{this.set("items",pageBys);}}else{fnSubmit();}return(pageCnt>1);},dialogCfg);}mstrmojo.android.controllers._HasPageBy=mstrmojo.provide("mstrmojo.android.controllers._HasPageBy",$HASH.copy(mstrmojo.android.controllers._HasSelectBoxDialog,{_mixinName:"mstrmojo.android.controllers._HasPageBy",showGroupByDialog:function showGroupByDialog(){displayPageByDialog.call(this,mstrmojo.desc(2941,"Grouping"),true);},showPageByDialog:function showPageByDialog(){displayPageByDialog.call(this,mstrmojo.desc(5136,"Page By"),false);}}));}());