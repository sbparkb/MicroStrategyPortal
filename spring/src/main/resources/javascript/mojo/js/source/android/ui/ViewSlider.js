(function(){mstrmojo.requiresCls("mstrmojo.android.ui.ViewSwitcher","mstrmojo.dom","mstrmojo.array");var $MATH=Math,$DOM=mstrmojo.dom,$ARR=mstrmojo.array;function translate(el,x,duration,easing){if(isNaN(x)){x=parseInt(x,10);}var elementStyle=el.style;elementStyle[$DOM.CSS3_TRANSITION]=$DOM.CSS3_PREFIX+"transform "+(duration||0)+"ms "+(easing||"ease");elementStyle[$DOM.CSS3_TRANSFORM]="translateX("+x+"px)";}function insertScrollView(view,sliderX,isForward){var slotInfo=this.getSlots(),currentSlot=slotInfo.current,nextSlot=slotInfo.next,nextSlotName=slotInfo.slot,targetPosition=0;$ARR.forEach($ARR.filter(this.children,function(child){return(child.slot===nextSlotName);}),function(child){this.removeChildren(child);child.unrender();},this);this.prepareNewView(view,nextSlotName);try{var id=this.id;window.setTimeout(function(){mstrmojo.all[id].addChildren([view]);},0);if(nextSlot&&currentSlot){targetPosition=isForward?parseInt(this.width,10):0;if(isForward){nextSlot.style.zIndex=3;currentSlot.style.zIndex=1;}}}catch(e){mstrmojo.Obj.free(view);throw e;}return{start:sliderX,target:targetPosition,newView:view,oldView:this.getCurrentView(),isForward:isForward};}function positionSliderNode(newPosition,oldPosition,callback,useAnimation,velocity){var sliderNode=this.sliderNode,duration=0,easing="",fnPosition=function(){translate(sliderNode,-newPosition,duration,easing);if(callback){if(duration){window.setTimeout(callback,duration+100);}else{callback();}}};if(useAnimation){var delta=$MATH.abs((newPosition||0)-(oldPosition||0));duration=$MATH.round(delta/parseInt(this.width,10)*700);easing="ease";if(velocity){duration=$MATH.min(duration,$MATH.round(delta/velocity));easing+="-out";}this._animating=true;window.setTimeout(fnPosition,20);}else{fnPosition();}}function cleanUpScroll(activeChild,inactiveChild){this.removeChildren(inactiveChild);inactiveChild.unrender();this._curSlot=activeChild.slot;delete this._animating;}mstrmojo.android.ui.ViewSlider=mstrmojo.declare(mstrmojo.android.ui.ViewSwitcher,null,{scriptClass:"mstrmojo.android.ui.ViewSlider",switchView:function switchView(view,isBackOperation){var slotInfo=this.getSlots();translate(this.sliderNode,0);translate(slotInfo.current,0);translate(slotInfo.next,0);this._super(view,isBackOperation);},isAnimating:function isAnimating(){return !!this._animating;},resetSliderNodes:function(isForward){var slotInfo=this.getSlots(),width=parseInt(this.width,10),sliderX=-width,currentX=width,nextX=0;if(isForward){sliderX=0;currentX=0;nextX=width;}translate(this.sliderNode,sliderX);translate(slotInfo.current,currentX);translate(slotInfo.next,nextX);return{sliderX:sliderX,currentX:currentX,nextX:nextX};},beginScroll:function(touch,view){if(this.isAnimating()){return false;}var isForward=touch.delta.x<0,positions=this.resetSliderNodes(isForward);var info=this._scrollInfo=insertScrollView.call(this,view,positions.sliderX,isForward);this.scrollStarted(info);this.scroll(touch);},scroll:function scroll(touch){var info=this._scrollInfo,x=touch.delta.x;if(info){if(info.isForward!==(x<0)){positionSliderNode.call(this,0);this.beginScroll(touch);}else{positionSliderNode.call(this,-(info.start+x));this.scrollProgress(info,x);}}},endScroll:function endScroll(touch){var info=this._scrollInfo;if(!info){return ;}var delta=touch.delta.x,newPosition=-info.start,isComplete=false,velocity=0,id=this.id;if($MATH.abs(delta)/parseInt(this.width,10)>0.25){newPosition=info.target;isComplete=true;velocity=touch.velocity.x;}this.scrollStopped(info,isComplete);positionSliderNode.call(this,newPosition,newPosition-delta,function(){mstrmojo.all[id]["scroll"+(isComplete?"Complete":"Canceled")](info);},true,velocity);delete this._scrollInfo;},scrollStarted:mstrmojo.emptyFn,scrollProgress:mstrmojo.emptyFn,scrollStopped:mstrmojo.emptyFn,scrollCanceled:function scrollCanceled(info){cleanUpScroll.call(this,info.oldView,info.newView);},scrollComplete:function scrollComplete(info){cleanUpScroll.call(this,info.newView,info.oldView);}});}());