(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.css","mstrmojo.Button");mstrmojo.requiresDescs(1143,8338,9111,9113);var $CSS=mstrmojo.css,$DOM=mstrmojo.dom,$ARR=mstrmojo.array,CSS_CLASS_TBICON="mstrmojo-qb-toolbarIcon",CSS_CLASS_ON="on",CSS_CLASS_DBVIEW="connectionview",CSS_CLASS_DATAPREVIEW="viewtable",CSS_CLASS_CONDITION="conditionview",CSS_CLASS_REFRESHOPT="refreshOption",CSS_CLASS_HELP="help",CSS_SEP=" ";function createToolbarButton(params){return mstrmojo.hash.copy(params,{scriptClass:"mstrmojo.Button",onactiveChange:function onactiveChange(){$CSS.toggleClass(this.domNode,CSS_CLASS_ON,this.active);},onclick:function onclick(){this.set("active",!this.active);if(this.cmd){mstrApp.getRootController()[this.cmd](this.active);}if(!this.persistSelection){var $this=this;window.setTimeout(function(){$this.set("active",false);},100);}}});}function updateLogoutIframe(src){var ifmID="mstr-qb-oAuthSourcelogout",ifm=document.getElementById(ifmID);if(!ifm){ifm=document.createElement("IFRAME");ifm.id=ifmID;document.body.appendChild(ifm);ifm.style.display="none";$DOM.attachEvent(ifm,"load",function(evt){var params={};var callback={success:function success(res){mstrApp.getRootController().handleLogout();}};params.dbRoleID=mstrApp.dbrid;if(mstrApp.said){params.sourceAccountID=mstrApp.said;}mstrApp.getRootController().getDataService().signOutOAuthSource(callback,params);});}ifm.src=src;}function createToolbarBigQuery(){var bigQuery={scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-toolbar-bigquery",bindings:{visible:function(){return mstrApp.said&&mstrApp.dbrid;}},children:[{scriptClass:"mstrmojo.Label",postCreate:function postCreate(){if(this._super){this._super();}var text=mstrApp.userName;if(mstrApp.userEmail){text+=" ("+mstrApp.userEmail+")";}this.set("text",text);this.set("title",text);},cssClass:"mstrmojo-qb-toolbar-bigquery-username"},{scriptClass:"mstrmojo.Label",text:"|",cssClass:"splitText"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(8338,"sign out"),cssClass:"mstrmojo-qb-toolbar-bigquery-signout",onclick:function onclick(){updateLogoutIframe("https://www.google.com/accounts/logout");}}]};return bigQuery;}function createToolbar(){var toolbarButtons=[{cmd:"toggleDatabaseView",active:true,iconClass:[CSS_CLASS_TBICON,CSS_CLASS_DBVIEW,CSS_CLASS_ON].join(CSS_SEP),title:mstrmojo.desc(9111,"Database View"),persistSelection:true},{cmd:"toggleDataPreview",active:false,iconClass:[CSS_CLASS_TBICON,CSS_CLASS_DATAPREVIEW].join(CSS_SEP),title:mstrmojo.desc(9113,"Data Preview"),persistSelection:true,postBuildRendering:function postBuildRendering(){var controller=mstrApp.getRootController(),wid=this.id;controller.attachEventListener("dataPreview",wid,function(){this.set("active",true);});controller.attachEventListener("reportModeChange",wid,function(evt){this.set("active",evt.showPreview);});}},{cmd:"openHelp",iconClass:[CSS_CLASS_TBICON,CSS_CLASS_HELP].join(CSS_SEP),title:mstrmojo.desc(1143,"help")}];$ARR.forEach(toolbarButtons,function(button,i,buttonArr){buttonArr[i]=createToolbarButton(button);});toolbarButtons.push(createToolbarBigQuery());return toolbarButtons;}mstrmojo.qb.Toolbar=mstrmojo.declare(mstrmojo.Box,null,{children:createToolbar()});}());