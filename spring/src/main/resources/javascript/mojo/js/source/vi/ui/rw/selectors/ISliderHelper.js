(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.desc","mstrmojo.dom","mstrmojo.hash","mstrmojo.MetricSelectorUtility","mstrmojo.mstr.EnumDataType","mstrmojo._FormatDefinition","mstrmojo.num","mstrmojo.array");var $MU=mstrmojo.MetricSelectorUtility,$DT=mstrmojo.mstr.EnumDataType,$CAT=mstrmojo._FormatDefinition.NumberFormatCategory,$FN=$MU.FN,$Q=$MU.Q,$OP=$MU.OP,$NM=mstrmojo.num,$MAX=Math.max,$MIN=Math.min,$ROUND=Math.round;mstrmojo.vi.ui.rw.selectors.ISliderHelper=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.SliderHelper,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.ISliderHelper",initAsStaticStatus:function initAsStaticStatus(){var sl=this.slider;sl.staticStatus=sl.disableDrag=this.isStatic();if(sl.staticStatus){sl.da.low=1;sl.da.high=7;sl.ft=$MU._GENERIC;sl.f=$FN.BETWEEN;sl.cs=[{n:"",v:1},{n:"",v:7}];sl.numFmts={cat:9,dp:0,fm:""};}if(this.displayInvalid()){sl.f=$FN.BETWEEN;sl.cs=[];}},initialSlider:function initialSlider(){this.initAsStaticStatus();this.createDataRangeItems();this.updateCurrentSelectionFromModel();},createDataRangeItems:function updateDataRange(){var sl=this.slider,fixDigit=this.fixDigitByNumFormat,notNull=this.notNull,numFmt=sl.numFmts,qualifyOn=sl.qua,cnt=sl.da.cnt,lowValue,highValue;switch(qualifyOn){case $Q._G:lowValue=fixDigit(sl.da.low,numFmt);highValue=fixDigit(sl.da.high,numFmt);sl.step=this.getValueStep(lowValue,highValue);break;case $Q._RB:case $Q._RT:lowValue=cnt?1:0;highValue=cnt;sl.step=this.getValueStep(lowValue,highValue);break;case $Q._PB:case $Q._PT:lowValue=0;highValue=100;sl.step=this.getValueStep(lowValue,highValue);break;}var isEmpty=this.isEmpty();sl.set("lowText",isEmpty?"":this.formatNumber(lowValue));sl.set("highText",isEmpty?"":this.formatNumber(highValue));sl.low=lowValue;sl.high=highValue;var items=[],len,i;if(notNull(lowValue,highValue)){if(lowValue+sl.step<=lowValue){sl.set("validation",{refNode:sl.docSelector.parent.domNode,position:1,invalid:true,errorCode:"bigDecimalMetricSliderVIWaring"});}else{for(i=lowValue;i<=highValue;i+=sl.step){items.push(this.getItem(qualifyOn,i,numFmt));}len=items.length;if(len>0){items[len-1]=this.getItem(qualifyOn,highValue,numFmt);}}}sl.items=items;sl.unit=this.getUnit();},getItem:function getItem(qualifyOn,value,numFmt){return{n:$MU.formatNumber(qualifyOn,value,numFmt),v:this.fixDigitByNumFormat(value,numFmt)};},getValueStep:function getValueStep(low,high){var sl=this.slider,len=sl._effectiveLength;return this.fixDigitByNumFormat((high-low)/(len-2),sl.numFmts)||1;},getIdxByValue:function getIdxByValue(vl){var sl=this.slider;return $MIN($MAX($ROUND((vl-sl.low)/sl.step),0),sl.items.length-1);},isStatic:function isStatic(){var sl=this.slider;return !this.notNull(sl.da,sl.da.low,sl.da.high,sl.da.cnt,sl.qua);},isEmpty:function isEmpty(){var sl=this.slider;return this.isStatic()||!!sl.da.nov;},displayInvalid:function displayInvalid(){var sl=this.slider;var funcType=parseInt(sl.ft,10),func=parseInt(sl.f,10),gen,rp;if(funcType===$MU._GENERIC){gen=func===$FN.ISNULL||func===$FN.ISNOTNULL||func===$FN.NOTIN||func===$FN.IN;}else{if(funcType===$MU._PERCENT||funcType===$MU._RANK){rp=func===$MU.MRPFN.INASCENDING||func===$MU.MRPFN.INDESCENDING||func===$MU.MRPFN.NOTINDESCENDING||func===$MU.MRPFN.NOTINASCENDING;}}return !!gen||!!rp;},fixDigitByNumFormat:function fixDigitByNumFormat(v,numberFormats){var category=parseInt(numberFormats.cat,10),isCustomPercentage=(category===$CAT.Custom&&numberFormats.fm&&numberFormats.fm.indexOf("%")>=0),digitalPoint=isCustomPercentage?2:numberFormats.dp,adjust=(category===$CAT.Percentage||category===$CAT.General||isCustomPercentage)?2:(category===$CAT.Fraction)?4:0;return Number(Number(v).toFixed(Math.min(digitalPoint+adjust,20)));},formatNumber:function formatNumber(num){var sl=this.slider,v=Math.abs(num),cat=sl.numFmts.cat,base=1000,baseNames=["K","M","B","T","P","E","Z","Y"],len=baseNames.length,i;if(v>=base&&(cat===$CAT.Default||cat===$CAT.Fixed||cat===$CAT.General||cat===$CAT.Currency)){for(i=0;i<len;i++,base*=1000){if(v<base*1000){var q=v/base,dp=(q*10).toFixed(0)%10>0?1:0,ret=q.toFixed(dp)+baseNames[i];return num<0?"("+ret+")":ret;}}}return $MU.formatNumber(sl.qua,num,sl.numFmts);},updateCurrentSelectionFromModel:function updateCurrentSelectionFromModel(){var sl=this.slider,notNull=this.notNull,cs=sl.cs,f=sl.f,ft=sl.ft,lowValue=sl.low,highValue=sl.high,qualifyOn=sl.qua,numFmt=sl.numFmts,c1=(cs&&cs.length>0)?$NM.parseNumeric(String(cs[0].v).replace("%","")):qualifyOn?highValue:lowValue,c2=(cs&&cs.length>1)?$NM.parseNumeric(String(cs[1].v).replace("%","")):highValue,include=sl.include=sl.parent.include,opId;if(sl.dt===$DT.DataTypeTimeStamp){numFmt.fm=numFmt.fm.replace(/\\/g,"");}if(qualifyOn===$Q._PT||qualifyOn===$Q._PB){c1=(cs&&cs.length>0&&!String(cs[0].v).match("%"))?c1*100:c1;}sl.frtUst=c1<lowValue;sl.ndUst=c2>highValue;sl.unSet=!cs||cs.length===0;if(notNull(f,ft)){opId=$MU.getOpIdxByfunc(f,ft);}else{if(include){opId=qualifyOn?$OP._LESS_EQUAL:$OP._BETWEEN;}else{opId=qualifyOn?$OP._GREATER:$OP._NOT_BETWEEN;}}sl.opId=opId;switch(opId){case $OP._EQUALS:case $OP._NOT_EQUALS:sl.cs1Vl=sl.cs2Vl=c1;break;case $OP._LESS_EQUAL:case $OP._GREATER:sl.cs1Vl=lowValue;sl.cs2Vl=c1;break;case $OP._GREATER_EQUAL:case $OP._LESS:sl.cs1Vl=c1;sl.cs2Vl=highValue;break;case $OP._IN:case $OP._NOT_IN:case $OP._IS_NULL:case $OP._IS_NOT_NULL:break;default:sl.cs1Vl=c1;sl.cs2Vl=c2;break;}sl.cs1Idx=this.getIdxByValue(sl.cs1Vl);sl.cs2Idx=this.getIdxByValue(sl.cs2Vl);sl.cs1Nm=notNull(sl.cs1Vl)?$MU.formatNumber(qualifyOn,sl.cs1Vl,numFmt):sl.items[sl.cs1Idx].n;sl.cs2Nm=notNull(sl.cs2Vl)?$MU.formatNumber(qualifyOn,sl.cs2Vl,numFmt):sl.items[sl.cs2Idx].n;if(qualifyOn){sl.rankon.selectItemByField("v",qualifyOn);}},updateSelection:function updateSelection(){var sl=this.slider,c1=sl.cs1Vl,c2=sl.cs2Vl,qualifyOn=parseInt(sl.qua,10),nf=sl.numFmts;sl.cs1Idx=this.getIdxByValue(c1);sl.cs2Idx=this.getIdxByValue(c2);sl.cs1Nm=$MU.formatNumber(qualifyOn,c1,nf);sl.cs2Nm=$MU.formatNumber(qualifyOn,c2,nf);sl.unSet=false;this.updateOpCs();sl.parent.node.data.cs=sl.cs;}});}());