(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.css");var $CSS=mstrmojo.css,KEY_CODE_NAME={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"},CLEAR_BTN="sbClear",SEARCH_BTN="sbSearch";mstrmojo.SearchWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchWidget",quickSearch:false,placeholderText:"",markupString:'<table id={@id} cellspacing="0" cellpadding="0" class="mstrmojo-SearchWidget mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" style="width:{@width};" placeholder="{@placeholderText}" mstrAttach:keyup,blur/></div></td><td><div class="mstrmojo-SearchBox-clear" id="{@id}'+CLEAR_BTN+'" mstrAttach:click></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}'+SEARCH_BTN+'" mstrAttach:click ></div></div></td></tr></table>',markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},clearNode:function(){return this.domNode.rows[0].cells[1].firstChild;},searchNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},markupMethods:{onquickSearchChange:function(){$CSS.toggleClass(this.domNode,"quick-search",this.quickSearch);},onwidthChange:function(){if(this.inputNode&&this.inputNode.style&&this.inputNode.style.width){this.inputNode.style.width=this.width;}}},clearNode:null,searchNode:null,onsearch:mstrmojo.emptyFn,onclear:mstrmojo.emptyFn,prekeyup:function prekeyup(evt){var hWin=evt.hWin,e=evt.e||hWin.event;var pattern=this.getSearchPattern(),hasPattern=(pattern.length===0),quickSearch=this.quickSearch;$CSS.toggleClass(this.clearNode,"show",!hasPattern&&!quickSearch);$CSS.toggleClass(this.searchNode,"clear",!hasPattern&&quickSearch);if(quickSearch){this[hasPattern?"clearSearch":"onsearch"](pattern);}var n=KEY_CODE_NAME[e.keyCode];if(this["on"+n]){this["on"+n](evt);}},onEnter:function onEnter(evt){this.onsearch(this.getSearchPattern());},onEsc:function onEsc(evt){this.clearSearch();},getSearchPattern:function getSearchPattern(){return mstrmojo.string.trim(this.inputNode.value);},preclick:function preclick(evt){var tgt=evt.getTarget(),id=tgt&&tgt.id;switch(id.replace(this.id,"")){case SEARCH_BTN:if(this.quickSearch){this.clearSearch();}else{this.onsearch(this.getSearchPattern());}break;case CLEAR_BTN:this.clearSearch();break;}},clearSearch:function clearSearch(){var pattern=this.getSearchPattern();this.reset();this.onclear(pattern);},reset:function reset(){this.inputNode.value="";$CSS.removeClass(this.clearNode,"show");$CSS.removeClass(this.searchNode,"clear");}});}());