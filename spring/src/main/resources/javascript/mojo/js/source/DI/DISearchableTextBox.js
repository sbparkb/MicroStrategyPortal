(function(){mstrmojo.requiresCls("mstrmojo.ui.SearchablePulldown");var KEY_ENTER=13,$A=mstrmojo.array;mstrmojo.DI.DISearchableTextBox=mstrmojo.declare(mstrmojo.ui.SearchablePulldown,null,{scriptClass:"mstrmojo.DI.DISearchableTextBox",allowCustomInput:true,allowCustomText:true,editOnClick:true,editOnDoubleClick:true,onclick:function onclick(){this.set("isEditing",true);},onmousedown:function onmousedown(evt){var target=evt.getTarget();if(target===this.selectedNode){var listWidget=this.getPopupList();if(!listWidget.visible&&listWidget.items.length>0){listWidget.open(this);}evt.cancel();}},onPopupWidgetClosed:function onPopupWidgetClosed(){var pulldownList=this.getPopupList(),oldItems=pulldownList._oldItems,textValue=this.text;delete pulldownList._oldItems;if(oldItems){var selIdx=$A.find(oldItems,"n",textValue);if(selIdx===-1&&!this.allowCustomText){var fallbackItem=pulldownList.items[0]||oldItems[0];selIdx=$A.find(oldItems,"n",fallbackItem.n);}pulldownList.set("items",oldItems);}},onkeydown:function onkeydown(event){this._super(event);var me=this;if(event.e.keyCode===KEY_ENTER){window.setTimeout(function(){me.onitemSelected(null,-1);},0);}},populateList:function populateList(){var listWidget=this.getPopupList();var results=mstrApp.getRootController().model.wikiSuggestions;var items=[],oldItems=listWidget._oldItems||listWidget.items;var i;if(results.length===0){listWidget.set("visible",false);return ;}if(results){for(i=0;i<results.length;i++){items.push({n:results[i],rgt:""});}}var searchText=this.selectedNode.innerText||this.selectedNode.textContent||"";var searchValue=mstrmojo.string.trim(searchText),input=searchValue.toUpperCase();listWidget._spft=input;listWidget.set("items",items);listWidget.selectedIndex=-1;listWidget.adjustCornersForPopupOverflow();delete listWidget._spft;listWidget._oldItems=oldItems;if(!listWidget.visible){listWidget.open(this);}},onkeyup:function onkeyup(e){if(this._super){this._super(e);}var listWidget=this.getPopupList();var input=this.selectedNode.innerText||this.selectedNode.textContent||"";if(!input||input.length===0){listWidget.set("visible",false);}else{mstrApp.getRootController().scrapeWiki(input,true);}},postBuildRendering:function postBuildRendering(){if(this._super){this._super();}var divNode=this.domNode;mstrmojo.dom.attachEvent(divNode,"paste",function updateInputText(evt){var inputtext="";setTimeout(function(){inputtext=divNode.children[0].innerText;inputtext=inputtext.replace(/<\/?.+?>/g," ").replace(/[\r\n]/g," ").replace(/\r/g," ").replace(/\n/g," ").replace(/\s+/g," ");divNode.children[0].innerText=inputtext;});});}});}());