(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.EditableLabel","mstrmojo.ui.menus.MenuConfig","mstrmojo.css");var $CSS=mstrmojo.css,ACT_RENAME=1,ACT_MOVE=2,ACT_DUPLICATE=4,ACT_DELETE=8,ACT_NEW_TAB=16;function getPopupHandler(isOpen){return function(){$CSS.toggleClass(this.menuBtnNode,"active",isOpen);};}function openMenu(menuBtn){var menuCfg=new mstrmojo.ui.menus.MenuConfig(),menuActionsFlag=this.getMenuActions(),idx=this.index,id=this.id,tabCount=this.total;if((menuActionsFlag&ACT_NEW_TAB)>0){this.addNewTabMenuItem(menuCfg);}if((menuActionsFlag&ACT_DUPLICATE)>0){menuCfg.addMenuItem(mstrmojo.desc(3397,"Duplicate"),"dup",function(){mstrmojo.all[id].tabDuplicated();});}if((menuActionsFlag&ACT_MOVE)>0){if(idx){menuCfg.addMenuItem(mstrmojo.desc(5362,"Move Left"),"lft",function(){mstrmojo.all[id].tabMoved(true);});}if(idx<tabCount-1){menuCfg.addMenuItem(mstrmojo.desc(5363,"Move Right"),"rgt",function(){mstrmojo.all[id].tabMoved(false);});}}menuCfg.addSeparator();if((menuActionsFlag&ACT_RENAME)>0){menuCfg.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){mstrmojo.all[id].lbl.set("isEditing",true);});}if((menuActionsFlag&ACT_DELETE)>0){if(tabCount>1){menuCfg.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){mstrmojo.all[id].tabDeleted();});}}var customMenuCfg=this.getCustomMenu();if(customMenuCfg&&customMenuCfg.hasMenuItems()){menuCfg.addSeparator();menuCfg.absorbMenuItems(customMenuCfg);}menuCfg.addPopupHandlers(this.id,getPopupHandler(true),getPopupHandler(false));this.showTabMenu(this.updateMenuCfg(menuCfg),menuBtn);}mstrmojo.vi.ui.tabs.Tab=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.Tab",markupString:'<div id="{@id}" class="mstrmojo-VITab unselectable {@cssClass}" style="{@cssText}" unselectable="on" mstrAttach:click><div><div class="mstrmojo-VITab-tab"></div><div class="mstrmojo-VITab-menu"></div></div></div>',markupSlots:{containerNode:function containerNode(){return this.domNode.firstChild.firstChild;},menuBtnNode:function menuBtnNode(){return this.domNode.firstChild.lastChild;}},markupMethods:{ontitleChange:function ontitleChange(){this.lbl.set("text",this.title);},onisSelectedChange:function onisSelectedChange(){mstrmojo.css.toggleClass(this.domNode,"selected",this.isSelected);},onzIndexChange:function onzIndexChange(){this.domNode.style.zIndex=this.zIndex;}},zIndex:1,menuBtnNode:null,lbl:null,title:"",index:-1,total:-1,isSelected:false,children:[{scriptClass:"mstrmojo.EditableLabel",alias:"lbl",editOnClick:false,onTextEditComplete:function onTextEditComplete(textChanged,oldText){if(textChanged){this.parent.titleEdited(this.text,oldText);}}}],postBuildRendering:function postBuildRendering(){if(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()){this.draggable=false;}this._super();},onclick:function onclick(evt){var target=evt.getTarget();if(target===this.menuBtnNode){openMenu.call(this,target);}else{if(!this.isSelected){this.tabSelected();}}},getMenuActions:function getMenuActions(){return 0;},getCustomMenu:function getCustomMenu(){return null;},isDragValid:function isDragValid(){return this.parent.children.length>1&&!this.lbl.isEditing;},createAvatar:function createAvatar(){var avatar=document.createElement("div");avatar.appendChild(this.domNode.cloneNode(true));avatar.style.margin="-5px 0 0 10px";return avatar;},allowDrop:function allowDrop(context){var srcWidget=context.src.widget;return srcWidget&&srcWidget.parent===this.parent;},ondrop:function ondrop(context){var srcData=context.src.data;this.parent.moveTab(srcData.idx,this.index,srcData.fromIdx);this._super(context);},ondragenter:function ondragenter(context){this._super(context);var srcData=context.src.data,idx=this.index;this.parent.moveTab(srcData.idx,idx);srcData.idx=idx;},ondragover:function ondragover(context){var tgtNode=context.tgt.node,tgtData=context.tgtData,existingTgtNode=tgtData&&tgtData.node;if(!tgtData||existingTgtNode!==tgtNode){context.tgtData={node:tgtNode};if(existingTgtNode){existingTgtNode.style.borderColor="";}}tgtNode.style.borderColor="#0fe88f";},getDragData:function getDragData(){var id=this.id,idx=this.index;return{setAvatarClass:function setAvatarClass(cls){var list=mstrmojo.all[id],avatar=list.avatar;if(avatar){var classes=[list.avatarCssClass,"hasOwnAvatar",cls];avatar.className=classes.join(" ");}},fromIdx:idx,idx:idx};},getDropAvatarIcon:function getDropAvatarIcon(){return"pivot";},cleanUpAfterTarget:function cleanUpAfterTarget(context){var tgtNode=context.tgtData&&context.tgtData.node;if(tgtNode){tgtNode.style.borderColor="";}this._super(context);},onAppStateChange:function onAppStateChange(evt){var lblTitle=this.lbl,isPresentationMode=evt.value===mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;lblTitle.set("isEditing",false);lblTitle.set("editOnDoubleClick",!isPresentationMode);this.draggable=!isPresentationMode;},addNewTabMenuItem:function addNewTabMenuItem(menuCfg){this.throwAbstractMethodError("addNewTabMenuItem");},tabSelected:mstrmojo.emptyFn,titleEdited:mstrmojo.emptyFn,tabMoved:mstrmojo.emptyFn,tabDeleted:mstrmojo.emptyFn,tabDuplicated:mstrmojo.emptyFn,showTabMenu:mstrmojo.emptyFn,updateMenuCfg:function updateMenuCfg(menuCfg){return menuCfg;}});mstrmojo.vi.ui.tabs.Tab.ACTIONS={NEW_TAB:ACT_NEW_TAB,RENAME:ACT_RENAME,MOVE:ACT_MOVE,DUPLICATE:ACT_DUPLICATE,DELETE:ACT_DELETE};}());