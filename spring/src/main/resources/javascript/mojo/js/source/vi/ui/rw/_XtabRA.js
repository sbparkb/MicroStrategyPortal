(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.css");var $D=mstrmojo.dom,$ARR=mstrmojo.array,$HASH=mstrmojo.hash,$CSS=mstrmojo.css;var _highlightTimer;function getRAChildrenIdxs(eid){var model=this.model,gts=model.data.gts,es=$ARR.filterOne(gts.row.concat(gts.col),function(title){return title.id===eid[0];}).es,roots=[],idxs=[];function treeTraversal(root){idxs.push(root);(es[root].ch||[]).forEach(function(ch){treeTraversal(ch);});}es.forEach(function(e,idx,es){var prt=es[e.p_index];if(model.compareElementsId(e.id,eid[1])){roots.push(idx);}if(prt){if(prt.ch){prt.ch.push(idx);}else{prt.ch=[idx];}}});roots.forEach(function(root){treeTraversal(root);});return idxs;}mstrmojo.vi.ui.rw._XtabRA=mstrmojo.provide("mstrmojo.vi.ui.rw._XtabRA",{_mixinName:"mstrmojo.vi.ui.rw._XtabRA",onclick:function onclick(evt){var target=evt.getTarget&&evt.getTarget();if(_highlightTimer){window.clearTimeout(_highlightTimer);_highlightTimer=null;}if(target.hasAttribute("rabtn")){var me=this,model=this.model,cell=target&&$D.findAncestorByName(target,"td",true,this.viewport),cInfo=this.getCellForNode(cell);this.clearSelections();this.controller.submitUndoRedoTemplateUpdates(this,model.getRAExpandAction(cInfo,this.sid),{success:function(){me.highlightGroupCells(me.getRACellGroups(me.getSelectionHash()));_highlightTimer=window.setTimeout(function(){me.clearSelections();me.clearSelectionsCache();},1000);}});}this._super(evt);},raExpandAll:function raExpandCollapseAll(data,isExpandAll){this.controller.submitUndoRedoTemplateUpdates(this,this.model.getRAExpandAllAction(data.id,isExpandAll));},raExpandDescendants:function raExpandDescendants(data){this.controller.submitUndoRedoTemplateUpdates(this,this.model.getRAExpandAction(data,this.sid,true));},getRACellGroups:function getRACellGroups(data){var eids=(function(){var res=[];$HASH.forEach(data,function(a){$HASH.forEach(a,function(x,aid){$ARR.forEach(x,function(e){res.push([aid,e.id]);});});});return res;}()),cellGroups=[];$ARR.forEach(eids,function(eid){var model=this.model,cells=[],cellIdxs=getRAChildrenIdxs.call(this,eid);$ARR.forEach(this.interactiveCellsArray,function(cell){var isAttribute=!cell.hasOwnProperty("mix")&&cell._e&&cell.fi===undefined;if(isAttribute&&model.getCellTitleInfo(cell).title.id===eid[0]){var idx=cell.idx;if(model.compareElementsId(cell._e.id,eid[1])||cellIdxs.indexOf(idx)===-1){if(cells.length>0){cellGroups.push(cells);cells=[];}}if(cellIdxs.indexOf(idx)>-1){cells.push(cell);}}},this);if(cells.length>0){cellGroups.push(cells);}},this);return cellGroups;}});}());