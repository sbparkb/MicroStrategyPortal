(function(){mstrmojo.requiresCls("mstrmojo.HBox","mstrmojo.Box","mstrmojo.Table","mstrmojo.warehouse.MenuButton");var _menuItems=[{did:"Rename",n:"Rename"},{did:"Delete",n:"Delete"}];function _isVisible(w){return(w.domNode&&w.domNode.style.display!=="none");}function _display(w,evt){var mdl=mstrmojo.all.ArchModel,tid=mdl.SelTableID,aid=mdl.SelAttrID;if(!tid){w.content.joins.set("items",[]);mdl.raiseEvent({name:"tblJoinsUpdated",items:[]});return ;}var tbl=mdl.getTable(tid),cb={success:function(res){w.content.joins.set("items",res);},failure:function(res){}};mdl.getJoinsForTable(tbl,aid,evt,cb);}mstrmojo.architect.JoinsView=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.JoinsView",targetTableName:"",items:[],children:[{scriptClass:"mstrmojo.Table",alias:"header",rows:1,cols:1,cssClass:"mstrmojo-Architect-Panel-header subheader",children:[{scriptClass:"mstrmojo.Label",alias:"title",slot:"0,0",cssClass:"mstrmojo-ArchitectToolbarIcon link",cssText:"padding-left: 5px; padding-right: 5px;",}]},{scriptClass:"mstrmojo.Box",alias:"content",cssText:"background-color:white;",children:[{scriptClass:"mstrmojo.warehouse.TableTree",alias:"joins",cssClass:"mstrmojo-Architect-LogicalTablesTree",cssText:"height:100%;",tp:3,itemFunction:function ifn(item,idx,w){var tree=w.tree||w,iw=new mstrmojo.TreeBrowserNode({markupString:'<li id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,click,dblclick><div class="mstrmojo-TreeNode-div {@tp}"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><img class="mstrmojo-TreeNode-checkBox" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><ul class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</ul></li>',tp:"Join t"+item.tp,data:item,parent:w,tree:tree,text:item[w.itemDisplayField],textCssClass:tree.item2textCss(item),items:item[w.itemChildrenField],itemDisplayField:w.itemDisplayField,itemChildrenField:w.itemChildrenField,itemFunction:w.itemFunction,onRender:function(){if(item.tp===12){this.set("state",1);}}});return iw;},getContentThroughTaskCall:function getContentThroughTaskCall(params,callbacks){var me=this;if(params.isRoot){callbacks.success(me.items);}else{callbacks.success(params.data);}},item2textCss:function item2textCss(data){return("mstrmojo-ArchitectJoinList t"+data.tp);},displayMenu:function(w){if(w.data){return w.data.tp===15;}}},{scriptClass:"mstrmojo.warehouse.MenuButton",executeCommand:function(item){switch(item.did){case"Edit":break;case"Delete":break;default:break;}},postCreate:function(){this.cm=_menuItems;}}]}],refresh:function(evt){if(!_isVisible(this)){return ;}_display(this,evt);},onheightChange:function hchange(){var h=parseInt(this.height,10);if(this.domNode){this.content.domNode.style.height=h-20+"px";}},postBuildRendering:function(){if(this._super){this._super();}var h=parseInt(this.height,10),mdl=mstrmojo.all.ArchModel;this.content.domNode.style.height=h-20+"px";mdl.attachEventListener("SelTableIDChange",this.id,"refresh");mdl.attachEventListener("TableContentChange",this.id,"refresh");mdl.attachEventListener("AttrFctChange",this.id,"refresh");mdl.attachEventListener("SelAttrIDChange",this.id,"refresh");}});}());