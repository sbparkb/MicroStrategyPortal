(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.array","mstrmojo.vi.ui.theme","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui.VIDragUnit");var $CSS=mstrmojo.css,$DOM=mstrmojo.dom,$THEME=mstrmojo.vi.ui.theme,$ARR=mstrmojo.array;function addToSelections(item,itemNode,evt){var targetSelected=false;$ARR.forEach(this.getSelectedItems(),function(obj){if(obj.itemNode===itemNode){targetSelected=true;}});if(item&&!targetSelected){this.doItemSelect(item,evt||{});}}mstrmojo.vi.ui._HasUnitListAvatar=mstrmojo.provide("mstrmojo.vi.ui._HasUnitListAvatar",mstrmojo.mixin({avatarCssClass:"mstrmojo-VIUnitList",getDragData:function getDragData(context){var sourceNode=context.src.node,itemNodeObj=$DOM.findAncestorByAttr(sourceNode,"idx",true,this.domNode);context.src.node=itemNodeObj?itemNodeObj.node:sourceNode;var dragData=(context.dragUnitHelper=new mstrmojo.vi.ui.VIDragUnit()).getUnitDragData(context,this.getSelectedItems());if(this.getItemDisplayName){mstrmojo.func.override({getItemDisplayName:this.getItemDisplayName},context.dragUnitHelper);}dragData.srcId=this.id;return dragData;},createAvatar:function createAvatar(srcNode,context){return context.dragUnitHelper.getUnitAvatar(context);},selectDragNode:function selectDragNode(context){var src=context.src;addToSelections.call(this,this.getItemFromTarget(src.node),this.getItemNodeFromTarget(src.node),src);},onItemContextMenu:function onItemContextMenu(item,evt){addToSelections.call(this,item,this.getItemNodeFromTarget(evt.getTarget()),evt);if(this._super){return this._super(item,evt);}},positionAvatar:function positionAvatar(pos,context){context.dragOffsets=context.dragUnitHelper.getDragUnitOffsets();if(this._super){this._super(pos,context);}}},mstrmojo.mixin(mstrmojo._HasOwnAvatar)));}());