(function(){mstrmojo.requiresCls("mstrmojo.cookies");mstrmojo.requiresDescs(14356,11866);mstrmojo.mstr._RecentObjectsHelper=mstrmojo.provide("mstrmojo.mstr._RecentObjectsHelper",{_mixinName:"mstrmojo.mstr._RecentObjectsHelper",handleRecentObjects:function handleRecentObjects(){var recentObjects=this.recentObjects();var numRecentObjects=Math.min(recentObjects.length,10);var j=-1;for(i=0;i<numRecentObjects;i++){if(recentObjects[i].lastRecovered!==undefined&&recentObjects[i].lastRecovered===true){recentObjects[i].iconClass="mstrIcon-lv mstrIcon-recover";recentObjects[i].recoveryName=mstrmojo.desc(11866,"Recover #").replace("#",recentObjects[i].recoveryName);recentObjects[i].itemClass="mstr-recent-item";j=i;}else{recentObjects[i].itemClass="mstr-recent-item";recentObjects[i].iconClass="mstrIcon-lv "+recentObjects[i].iconClass;}}if(j!=-1){recentObjects[j].cssText="border-bottom: 1px solid #D6D6D6;";}var recoveryObject={};if(numRecentObjects==0){recoveryObject.recoveryURL="";recoveryObject.recoveryName=mstrmojo.desc(14356,"No recent items");recoveryObject.iconClass="";recoveryObject.lastRecovered=false;recentObjects.push(recoveryObject);}return recentObjects;},recentObjects:function recentObjects(){try{var ls=window.localStorage,ss=window.sessionStorage;if(!ls||!window.JSON){return ;}var recoveryObjects=[];var getObjectIDString=function(type){var objectIDString="";switch(type){case 3:objectIDString="reportID=";break;case 55:objectIDString="documentID=";break;default:objectIDString="messageID=";break;}return objectIDString;};var getIconClass=function(recoveryInfo){var type=recoveryInfo.ty;var iconClass="";switch(type){case 55:var vm=recoveryInfo.vm;switch(vm){case 8192:case 2048:iconClass="mstrIcon-lv-rw avm";break;case 1:default:iconClass="mstrIcon-lv-rw";break;}break;case 3:var viewMode=recoveryInfo.viewMode;switch(viewMode){case 1:iconClass="mstrIcon-lv-g";break;case 2:iconClass="mstrIcon-lv-gp";break;case 3:iconClass="mstrIcon-lv-gpgs";break;default:iconClass="";break;}break;}return iconClass;};var recentObjects=JSON.parse(ls.getItem("recentObjects"+mstrConfig.lastMsgKey));try{var msgKey=mstrConfig.lastMsgKey,lastMsgIDKey="lastMsgID"+msgKey,lastMsgID=(JSON.parse(decodeURIComponent(mstrmojo.cookies.getCookieSetting("lastMsgID")||"{}")))[msgKey],isValidMsgID=function(msgId){return msgId&&(msgId.length===32)&&/^[A-Z0-9]{32}$/.test(msgId);};}catch(e){}if(isValidMsgID(lastMsgID)){var recoveryObject={};var recoveryInfoKey="lastMsgRecoveryInfo"+msgKey,recoveryInfo=ls.getItem(recoveryInfoKey);if(recoveryInfo){var recoveryInfo=JSON.parse(recoveryInfo);recoveryObject.recoveryInfo=recoveryInfo;recoveryObject.recoveryURL=mstrmojo.addCSRFTokenToURL("?"+recoveryInfo.url.replace(/messageID.*/,"messageID="+lastMsgID)),recoveryObject.recoveryName=recoveryInfo.n;recoveryObject.recoveryType=recoveryInfo.ty;recoveryObject.did=recoveryInfo.did;recoveryObject.iconClass=getIconClass(recoveryInfo);recoveryObject.lastRecovered=true;recoveryObjects.push(recoveryObject);}}for(var i in recentObjects){var recentObject=recentObjects[i];if(recentObject===""){continue;}var recoveryObject={};var recoveryInfo=JSON.parse(recentObject);recoveryObject.recoveryInfo=recoveryInfo;recoveryObject.recoveryURL=mstrmojo.addCSRFTokenToURL("?"+recoveryInfo.url.replace(/messageID.*/,getObjectIDString(recoveryInfo.ty)+recoveryInfo.did));recoveryObject.recoveryName=recoveryInfo.n;recoveryObject.recoveryType=recoveryInfo.ty;recoveryObject.did=recoveryInfo.did;recoveryObject.iconClass=getIconClass(recoveryInfo);recoveryObject.lastRecovered=false;var idx=mstrmojo.array.find(recoveryObjects,"did",recoveryObject.did);if(idx===-1){recoveryObjects.push(recoveryObject);}else{recoveryObjects[idx].recoveryInfo.imgData=recoveryObject.recoveryInfo.imgData;}}return recoveryObjects;}catch(err){mstrmojo.errors.log(err);}}});}());