(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");mstrmojo.requiresDescs(889,7405,11163,12369);var $H=mstrmojo.hash,$DESC=mstrmojo.desc;var WAIT_MSG=$DESC(889,"Please wait...");function submitServerRequest(callback,params,waitBoxCfg){var showWait=params.showWait,suppressErrorMsg=params.suppressError,waitMsg=params.waitMsg;delete params.showWait;delete params.suppressError;delete params.waitMsg;mstrApp.serverRequest(params,callback,showWait,suppressErrorMsg,waitMsg,undefined,undefined,waitBoxCfg);}mstrmojo.qb.DataService=mstrmojo.provide("mstrmojo.qb.DataService",{submitRequest:function submitRequest(callback,params){submitServerRequest.call(this,callback,params);},pollingStatus:function pollingStatus(callback,result,message,waitBoxCfg){var me=this;if(mstrApp.isSingleTier){if(callback.success){callback.success(result);}return ;}submitServerRequest.call(me,{success:function success(res){if(res.status==="1"){if(callback.success){callback.success(result);}}else{me.pollingStatus(callback,result,message);}},failure:function failure(res){if(callback.failure){callback.failure(res);}},canceled:function canceled(reqId){if(callback.canceled){callback.canceled(reqId,result);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:message},waitBoxCfg);},prepareDataPollStatus:function prepareDataPollStatus(callback,result,message,waitBoxCfg){var me=this,pollStatus="pollStatus";if(mstrApp.isSingleTier){pollStatus="DIPollStatus";}submitServerRequest.call(me,{success:function success(res){if(res.status==="1"||res.status===1){if(callback.success){callback.success(result);}}else{me.prepareDataPollStatus(callback,result,message,waitBoxCfg);}},failure:function failure(res){if(callback.failure){callback.failure(res);}},canceled:function canceled(reqId){if(callback.canceled){callback.canceled(reqId,result);}}},{taskId:pollStatus,resultSetType:3,pollingFrequency:500,threadId:result.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:message},waitBoxCfg);},search:function search(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"arch.search",showWait:true}));},searchFolderContents:function searchFolderContents(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:WAIT_MSG});},createReportInstance:function createReportInstance(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.CreateQBReportInstance",showWait:true,suppressError:true}));},createEmmaInstance:function createEmmaInstance(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:WAIT_MSG}));},createEmmaTable:function createEmmaTable(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"DICreateEMMASourceTable",showWait:true,waitMsg:WAIT_MSG}));},changeMapping:function changeMapping(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.RemapObject",showWait:true,waitMsg:WAIT_MSG}));},buildRelations:function buildRelations(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"DIDetectRelationshipEMMASourceTable",showWait:true,waitMsg:WAIT_MSG}));},setDBRole:function setDBRole(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.SetDBRole",showWait:false}));},getShapeKeys:function getShapeKeys(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"getMapShapes",showWait:false}));},addTable:function addTable(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.AddTable",showWait:true,waitMsg:WAIT_MSG}));},removeTable:function removeTable(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.RemoveTable",showWait:true,waitMsg:WAIT_MSG}));},editTable:function editTable(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.EditTable",showWait:true}));},addColumn:function addColumn(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.AddSelectedColumn",showWait:true}));},addSelectedColumns:function addSelectedColumns(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.AddMultiSelectedColumns",showWait:true}));},editColumn:function editColumn(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.EditSelectedColumn",showWait:true}));},removeColumn:function removeColumn(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.RemoveSelectedColumn",showWait:true}));},addJoin:function addJoin(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.AddJoin",showWait:true}));},removeJoin:function removeJoin(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.RemoveSelectedJoin",showWait:true}));},editJoin:function editJoin(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.EditJoin",showWait:true}));},autoJoin:function autoJoin(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.GenerateJoins",showWait:true}));},editCondition:function editCondition(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.EditCondition",showWait:true}));},remapObject:function remapObject(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.RemapObject",showWait:true}));},updateTableStructure:function updateTableStructure(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.UpdateWHTable",showWait:true}));},parse:function parse(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.Parse",showWait:true}));},getReportDefinition:function getReportDefinition(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.GetReportXDADefinition",showWait:true}));},saveReport:function saveReport(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.SaveReportXDADefinition",showWait:true,suppressError:true,waitMsg:mstrmojo.desc(7405,"Saving changes...")}));},getSystemFunctions:function getSystemFunctions(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"getSystemFunctions",showWait:false,suppressError:true}));},convertToQB:function convertToQB(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.ConvertToQueryBuilder",showWait:true}));},convertToFFSQL:function convertToFFSQL(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.ConvertToFreeFormSQL",showWait:true}));},editFFSQL:function editFFSQL(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.EditFreeFormSQL",showWait:true}));},catalogAction:function catalogAction(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"arch.catalogAction",showWait:true}));},getDocumentAttributes:function getDocumentAttributes(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"getDocumentAttributes",showWait:true}));},autoClosePrompt:function autoClosePrompt(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.AutoClosePrompt",showWait:true}));},publishCube:function publishCube(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.PublishCube",showWait:true,suppressError:true,waitMsg:mstrmojo.desc(11163,"Publishing...")}));},getAttributeForms:function getAttributeForms(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"getAttributeForms"}));},searchMetadata:function searchMetadata(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"searchMetadata"}));},getFunctionDetails:function getFunctionDetails(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"getSystemFunctions"}));},signOutOAuthSource:function signOutOAuthSource(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.FetchSourceObjects",flags:8,showWait:true,waitMsg:$DESC(12369,"Signing out...")}));},removeEmmaTable:function removeEmmaTable(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"DIRemoveEMMASourceTable",showWait:true,waitMsg:WAIT_MSG}));},removeOrDuplicateRI:function removeOrDuplicateRI(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.RemoveOrDuplicateRI",showWait:true}));},prepareData:function prepareData(callback,params,current,total,msg){var waitMsg=msg||$DESC(13196,"Prepare data ## of ### tables...").replace("##",current).replace("###",total);var me=this,waitBoxCfg={showCancel:true};submitServerRequest.call(me,{success:function success(res){me.prepareDataPollStatus(callback,res,waitMsg,waitBoxCfg);},canceled:function(reqId){if(callback.canceled){callback.canceled(reqId);}}},$H.copy(params,{taskId:"DIDataPreparation",showWait:true,waitMsg:waitMsg}),waitBoxCfg);},killJob:function killJob(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"DIKillJob",showWait:true,suppressError:true,waitMsg:WAIT_MSG}));}});}());