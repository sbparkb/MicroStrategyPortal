(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.dom","mstrmojo.string","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(5,49,2918,3289,8042,9948,8042,13305,13306,13307,12187);var $A=mstrmojo.array,$DOM=mstrmojo.dom,$S=mstrmojo.string;function getListItems(){var items=[],privileges=mstrApp.diParams,unsupportedBrowser=($DOM.isIE8||$DOM.isIE7)&&!(privileges.flashVI||privileges.smartVI),pageRedirect=mstrmojo.DI.DIExitOptions.pageRedirect;if(privileges.CreateAnalysis===1){items.push({hot:true,icon:"newvi",n:mstrmojo.desc(8042,"Create Dashboard"),desc:mstrmojo.desc(9948,"Explore data visually and discover trends, patterns, relationships and outliers"),redirect:unsupportedBrowser?pageRedirect.unsupportedBrowser:pageRedirect.analysis});}if(privileges.CreateReportServices===1){items.push({icon:"newdoc",n:mstrmojo.desc(2918,"Create Document"),desc:mstrmojo.desc(13858,"Create an enterprise report, scorecard, or dashboard"),redirect:pageRedirect.doc});}if(privileges.CreateViewReport===1&&mstrApp.getRootController().model.isDirectDataAccess===false){items.push({icon:"newreport",n:mstrmojo.desc(5,"Create Report"),desc:mstrmojo.desc(13859,"Create a grid or graph report"),redirect:pageRedirect.report});}return items;}mstrmojo.DI.DIExitOptions=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIExitOptions",cssClass:"mstrmojo-di-DIExitOptions",redirectToPage:function redirectToPage(selection){var diExitOptions=mstrmojo.DI.DIExitOptions;if(selection===diExitOptions.pageRedirect.unsupportedBrowser){mstrmojo.alert(mstrmojo.desc(12187,"Unsupported browser."));}else{mstrApp.redirectToPage(diExitOptions.getRedirectParams(selection,this.model.cubeID,this.model.isDirectDataAccess));}},onCancelButtonClick:function(){mstrApp.getRootController().exitApplication();return true;},preBuildRendering:function(){var children=[],items,widget,cls=["mstrmojo-di-button","mstrmojo-WebButton"];if(this._super){this._super();}items=getListItems();cls.push("cnt"+items.length);$A.forEach(items,function(item,idx){widget=new mstrmojo.Button({cssClass:idx===0?cls.concat(["hot",item.icon]).join(" "):cls.concat(item.icon).join(" "),text:item.n,useRichTooltip:true,updateTooltipConfig:function(){var me=this,position=$DOM.position(me.domNode);me.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:item.desc,top:Math.max(position.y+40,0),left:Math.max(position.x+position.w/2,0),posType:mstrmojo.tooltip.POS_TOPCENTER};},redirect:item.redirect,onclick:function(){this.parent.redirectToPage(this.redirect);}});children.push(widget);});this.addChildren(children);},children:[{scriptClass:"mstrmojo.Label",cssClass:"title-one",useRichTooltip:true,allowHTML:true,updateTooltipConfig:function(){var pos;if(this.title){pos=$DOM.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(pos.y,0),left:Math.max(pos.x+pos.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});}},ontextChange:function(){var me=this;var showMiddleEllipsis=function(){var str=me.parent.model.isDirectDataAccess?mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###."):mstrmojo.desc(13305,"Success! Your data was imported as ###."),node=me.domNode,path=me.parent.model.path,name=me.parent.model.cubeName,isOverflow,txt,txts,l,r;if(!node){return ;}isOverflow=node.scrollWidth>node.clientWidth;txt=path;l=r=path.indexOf(name);while(isOverflow&&(l>=0||r<=path.length)){if(l>0){l--;}else{r++;}txts=l>0?[path.substr(0,l)]:[];txts.push("...");if(r<path.length){txts.push(path.substr(r));}txt=str.replace("###","<b>"+$S.encodeHtmlString(txts.join(""),true,true)+"</b>");node.innerHTML=txt;isOverflow=node.scrollWidth>node.clientWidth;}};if(me.domNode){showMiddleEllipsis();}else{window.setTimeout(showMiddleEllipsis,0);}},preBuildRendering:function(){var str=mstrmojo.desc(13305,"Success! Your data was imported as ###."),txt;if(this.parent.model.isDirectDataAccess){str=mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###.");}txt=str.replace("###","<b>"+$S.encodeHtmlString(this.parent.model.path,true,true)+"</b>");this.set("text",txt);this.set("title",txt);}},{scriptClass:"mstrmojo.Label",cssClass:"title-two",text:mstrmojo.desc(13307,"What would you like to do now?")}]});mstrmojo.DI.DIExitOptions.pageRedirect={exit:0,report:1,doc:2,analysis:3,flashVI:4,historyList:5,existingAnalysis:6,unsupportedBrowser:7};mstrmojo.DI.DIExitOptions.getRedirectParams=function getRedirectParams(redirect,cubeID,isDDA,docID){var params={},pageRedirect=mstrmojo.DI.DIExitOptions.pageRedirect,servletName=mstrApp.name||microstrategy.servletName;switch(redirect){case pageRedirect.analysis:if(mstrApp.diParams.flashVI){params={evt:"3104",src:servletName+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:cubeID,rwCreateFlags:"16",rwViewMode:"2048"};}else{params={evt:"3185",src:mstrApp.name+".3185",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:cubeID,rwCreateFlags:64};if(isDDA){params.rwCreateFlags|=128;}if(mstrApp.cubeSaveFolderId){params.saveFolderId=mstrApp.cubeSaveFolderId;}}break;case pageRedirect.doc:params={evt:"3104",src:mstrApp.name+".3104",executionMode:"2",rwDesignMode:"1",objectType:"3",objectID:cubeID,rwCreateFlags:0};if(isDDA){params.rwCreateFlags|=128;}if(mstrApp.cubeSaveFolderId){params.saveFolderId=mstrApp.cubeSaveFolderId;}break;case pageRedirect.flashVI:params={evt:"3104",src:servletName+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:cubeID,rwCreateFlags:16,rwViewMode:"2048"};if(isDDA){params.rwCreateFlags|=128;}break;case pageRedirect.report:params={iframe:"true",evt:["5005","17004"],src:[mstrApp.name+".create.5005",mstrApp.name+".create.ObjectExplorer.17004"],selectedObjectID:cubeID,defaultevtlist:"17004"};break;case pageRedirect.exit:params={evt:"3010"};break;case pageRedirect.historyList:params={evt:"3018",src:servletName+".3018"};break;case pageRedirect.existingAnalysis:params={evt:"3140",src:servletName+".3140",documentID:docID};break;}return params;};}());