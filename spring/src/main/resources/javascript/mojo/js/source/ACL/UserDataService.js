(function(){mstrmojo.requiresCls("mstrmojo.func");mstrmojo.ACL.UserDataService=mstrmojo.provide("mstrmojo.ACL.UserDataService",{topgroups:null,userCandidates:null,getMembers:function(params,callbacks){var taskParams={taskId:"getUserEntityInfo",blockBegin:params.blockBegin,blockCount:params.blockCount,userEntityID:params.data.did,userEntityName:params.data.n||"",incremental:true,outputElements:params.outputElements||3};mstrmojo.xhr.request("POST",mstrConfig.taskURL,callbacks,taskParams);},getTopLevelGroups:function getTopLevelGroups(params,callbacks){var me=this;if(this.topgroups){callbacks.success({items:this.topgroups});return ;}callbacks.success=mstrmojo.func.composite([callbacks.success,function(res){me.topgroups=res.items;}]);this.getUsers({topGroupsOnly:true},callbacks);},searchUserCandidates:function searchUserCandidates(pattern,wildCard,blockCount,callbacks){var params={blockBegin:1,blockCount:blockCount,searchPattern:pattern,nameWildcards:wildCard?1:2};this.getUsers(params,callbacks);},getUserCandidates:function getUserCandidates(blockCount,callbacks){if(this.userCandidates){callbacks.success(this.userCandidates);return ;}var successWas=callbacks.success,me=this;callbacks.success=function(res){me.userCandidates={items:res.items,isComplete:(parseInt(res.bc,10)===-1||(res.bb+res.bc>res.sz))};successWas(me.userCandidates);};var params={blockBegin:1,blockCount:blockCount,nameWildcards:1};this.getUsers(params,callbacks);},getUsers:function getUsers(params,callbacks){var ps={taskId:"getUserServices"};mstrmojo.hash.copy(params,ps);mstrmojo.xhr.request("POST",mstrConfig.taskURL,callbacks,ps);}});}());