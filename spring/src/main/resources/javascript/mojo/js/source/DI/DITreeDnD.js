(function(){mstrmojo.requiresCls("mstrmojo.DI.DITreeNodeDnD","mstrmojo.WidgetTree","mstrmojo.DI.DIHelpers");var $HELPer=mstrmojo.DI.DIHelpers,$DOM=mstrmojo.dom,$A=mstrmojo.array;mstrmojo.DI.DITreeDnD=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.DI.DITreeDnD",renderOnScroll:false,itemFunction:function ifn(item,idx,w){var title="Name: "+item[w.itemDisplayField];if(w.sizeTooltip){if(item.isFolder){if(w.folderSizeTooltip){title+=" Size: ---";}}else{if(item.type==="application/vnd.google-apps.spreadsheet"){title+=" Size: unavailable";}else{if(typeof item.size==="number"){title+=" Size: "+$HELPer.getRoundSize(item.size);}}}}var tree=w.tree||w,iw=new mstrmojo.DI.DITreeNodeDnD({edit:item.edit,data:item,state:0,parent:w,tree:tree,supportFolderDrag:w.supportFolderDrag,text:item[w.itemDisplayField],tooltipContent:title,useRichTooltip:true,_ontooltipover:function(e){$DOM.stopPropogation(self,e);iw.showTooltip(e,self);},textCssClass:"mstrmojo-di-tree-node-dnd",index:idx,items:item[w.itemChildrenField],itemIdField:w.itemIdField,itemDisplayField:w.itemDisplayField,itemIconField:w.itemIconField,itemChildrenField:w.itemChildrenField,itemFunction:w.itemFunction,listSelector:w.listSelector,iconFolderClosed:item.iconFolderClosed||"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:item.iconFolderOpen||"mstrmojo-di-tree-node-icon folder-open"});item.node=iw;return iw;},postCreate:function(){if(this._super){this._super();}this.selectedNodes=[];this.selectedNode=null;},selectedNodes:[],selectedNode:null,selectNode:function selectNode(node,evt){if(!evt||(!$HELPer.isCtrlKey(evt.hWin,evt.e)&&!mstrmojo.dom.shiftKey(evt.hWin,evt.e))){$A.forEach(this.selectedNodes,function(selectedNode){if(selectedNode!==null&&selectedNode!==node){selectedNode.deselect();}});this.selectedNode=node;this.selectedNodes=[node];}else{if(evt&&$HELPer.isCtrlKey(evt.hWin,evt.e)){var idx=mstrmojo.array.find(this.selectedNodes,"id",node.id);if(idx<0){this.selectedNodes.push(node);this.selectedNode=node;}else{node.deselect();this.selectedNodes.splice(idx,1);if(this.selectedNode===node){this.selectedNode=null;}}}else{if(evt&&mstrmojo.dom.shiftKey(evt.hWin,evt.e)){var startNode=node,endNode=startNode;if(this.selectedNode){var index=0;while(this.selectedNode.ancestorList[index]===node.ancestorList[index]){index++;}if(this.selectedNode.ancestorList[index]<node.ancestorList[index]){startNode=this.selectedNode;}else{endNode=this.selectedNode;}}var i;if(this.selectedNodes.length>=2){var len=this.selectedNodes.length;for(i=0;i<len;i++){this.selectedNodes[i].deselect();}}this.selectedNodes=[];this.selectedNode=node;var nodeItr=startNode;while(nodeItr!==endNode){if(!nodeItr.data.isFolder){this.selectedNodes.push(nodeItr);mstrmojo.css.addClass(nodeItr.listNode,"selected");}nodeItr=nodeItr.nextOrderNode;}this.selectedNodes.push(endNode);mstrmojo.css.addClass(endNode.listNode,"selected");}}}}});}());