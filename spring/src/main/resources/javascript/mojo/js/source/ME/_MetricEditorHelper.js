(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.string","mstrmojo.form","mstrmojo._FormatDefinition","mstrmojo.ME.MetricDataService","mstrmojo.ME.MetricEditBox","mstrmojo.mstr.EnumDataType","mstrmojo.ME.Enum");mstrmojo.requiresDescs(218,219,221,531,628,1442,1918,2102,2116,2154,2213,2919,5298,5424,5728,5891,7558,7984,7987,11566,13249);var S=mstrmojo.string,DT=mstrmojo.mstr.EnumDataType,MDS=mstrmojo.ME.MetricDataService;function fnConvertTokens2Formula(tks){var items=tks.items,len=items.length,f="",i;for(i=0;i<len;i++){f+=items[i].v;}return f;}var _D=mstrmojo.dom,_S=mstrmojo.string,_FD=mstrmojo._FormatDefinition,_VSTATUS=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,METRIC_EDIT_TYPES=mstrmojo.ME.Enum.METRIC_EDIT_TYPES;var _mapErrorCode=function(code){if(!code){return _VSTATUS.VALID;}return{"-2147214845":_VSTATUS.ERROR,"-2147214846":_VSTATUS.AMBIGUITY}[code]||_VSTATUS.ERROR;},_postprocessTokenStram=function(tks){var its=tks.items,len=its.length,last=its[its.length-1],i,it,newItems=[],newV="";if(its[0]&&its[0].tp!==38){newItems.push({v:"&",tp:38,lv:4,sta:2});}for(i=0,len=its.length;i<len;i++){it=its[i];if(it.isNew&&!it.oi){newV+=it.v;}else{if(!_S.isEmpty(newV)){newItems.push({v:newV,tp:2,lv:1});newV="";}newItems.push(it);}}if(!_S.isEmpty(newV)){newItems.push({v:newV,tp:2,lv:1});newV="";}if(last&&last.tp!==-1){newItems.push({v:"",tp:-1,lv:4,sta:2});}return{items:newItems};},_getTokenStreamXML=function(oi){var tks=_postprocessTokenStram(oi.tks);var props={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true},config={getArrItemName:function(n,v,i){return"tkn";},isSerializable:function(nodeName,jsons,index){return(props[nodeName])?true:false;}};return _S.json2xml("tknstrm",tks,config);},_preprocessTokenStram=function(tks){var its=tks.items,len=its.length,last=its[its.length-1];if(last&&last.tp===-1){its.pop();}if(its[0]&&its[0].tp===38){its.splice(0,1);}},_getLocalSymbolFolderXML=function(oi){return"";},_clearTokenSection=function(me,meb){var empty=[];me.oi.tks.items=empty;meb.clearTokens(empty);},_getMetricPropsXML=function(oi,onlyMps){var res=[];res.push("<mt>");if(oi.fmt&&!onlyMps){var fmtCtg={getArrItemName:function(n,v,i){return n.substr(0,n.length-1);},isSerializable:function(nodeName,jsons,index){if(mstrmojo.array.indexOf(["header_format","grid_format"],nodeName)>-1){var format=jsons[index][nodeName];if(!format){return{};}var xml="<"+nodeName+">",prs;for(prs in format){xml+="<prs n='"+prs+"'>";var prsv=format[prs],pr;for(pr in prsv){var prv=prsv[pr];xml+="<pr n='"+pr+"' v='"+(prv==="pru"?"":prv)+"'";xml+=prv==="pru"?' pru="1"':"";xml+="/>";}xml+="</prs>";}xml+="</"+nodeName+">";return{child:xml};}return true;},skipNull:true};res.push(_S.json2xml("fmt",oi.fmt,fmtCtg));}if(oi.prss&&!onlyMps){var prssCtg={getArrItemName:function(n,v,i){return n.substr(0,n.length-1);},isSerializable:function(nodeName,jsons,index){if(mstrmojo.array.indexOf(["AnalyticalEngineProperties","DatamartProperties","VLDBSelect","VLDBFunction","VLDBReport"],nodeName)>-1){var json=jsons[index][nodeName];if(!json){return{};}var xml=[],innerXml=[],pr;xml.push("<prs n='"+nodeName+"' ");for(pr in json){var prv=json[pr];if(prv!=null){if(typeof prv==="object"){innerXml.push(_S.json2xml("pr",prv,{skipNull:true,convertBoolean:true,isSerializable:function(n,jsons,idx){return true;}}));}else{xml.push(pr+"='"+prv+"' ");}}}xml.push(">");xml.push(innerXml.join(""));xml.push("</prs>");return{child:xml.join("")};}return true;},skipNull:true};res.push(_S.json2xml("prss",oi.prss,prssCtg));}if(oi.mps){res.push(_S.json2xml("mps",oi.mps,{skipNull:true,convertBoolean:true,isSerializable:function(n,jsons,idx){return true;}}));}if(oi.datp&&!onlyMps){res.push(_S.json2xml("datp",oi.datp,{skipNull:true,convertBoolean:true,isSerializable:function(n,jsons,idx){return true;}}));}if(oi.sbs&&!onlyMps){var sbsCtg={getArrItemName:function(n,v,i){return(n==="avs")?"sb":n.substr(0,n.length-1);},isSerializable:function(nodeName,jsons,index){return true;},skipNull:true};res.push(_S.json2xml("sbs",oi.sbs,sbsCtg));}res.push("</mt>");return res.join("");},_wait=function(btn,v){btn.set("enabled",!v);var waitIconClass="mstrmojo-InlineWaitIcon";if(btn.iconClass){btn.set("iconClass",btn.iconClass.replace(new RegExp(waitIconClass),"")+" "+(v?waitIconClass:""));}else{mstrmojo.css.toggleClass(btn.domNode,waitIconClass,v);}},_saveTaskParams=function(oi,saveAs){var params={taskId:"saveMetricDefinition",tokenStreamXML:_getTokenStreamXML(oi),localSymbolFolderXML:_getLocalSymbolFolderXML(oi),metricXML:_getMetricPropsXML(oi),metricId:oi.did||"",outputFlags:327695,description:oi.desc||"",name:oi.n||"",saveAs:saveAs};if(_S.isEmpty(oi.metricId)){params.isNew=true;}return params;},_saveAsCallback=function(me){var scb=function(res){var p=this.parent;var message=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##","Object").replace("'###'","");if(p){p.ob.refreshContent();p.onObjectSaved({name:p.name,did:res.did,desc:p.desc});message=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",p.typeDesc||"Object").replace("###",p.name);}mstrmojo.alert(message,me.onSaved,mstrmojo.desc(7984,"Object Saved"));if(p){p.close();}me.dirty=false;},cb={success:scb,failure:mstrmojo.SaveAsEditor.SAVEAS_CALLBACK.failure};return cb;},_validateSyntaxAndSave=function(me,saveFlag){var btn=this;_wait(btn,true);var oi=mstrmojo.ME._MetricEditorHelper.oi=me.oi,tksXML=_getTokenStreamXML(oi),lsfXML=_getLocalSymbolFolderXML(oi),mtrXML=_getMetricPropsXML(oi,true),success=function(res){if(res&&res.tks){var tks=res.tks;_preprocessTokenStram(tks);oi.tks=tks;me.checkEditorFallback(me.ide.candidates.items,oi);tks.vs=_mapErrorCode(tks.rjec);me.set("vStatus",tks.vs);me.set("iStatus",tks.rjed||"");if(me.handleValidation){me.handleValidation(tks);}if(saveFlag&&(tks.vs===_VSTATUS.VALID)){switch(saveFlag){case"save":case"saveAs":if(me.isDME){me.handleDerivedMetricAction(saveFlag,oi);}else{me.handleMetricAction(saveFlag,oi);}break;case"switch":if(me.cbSwtichEditor){me.cbSwtichEditor(me);}break;}}else{if(saveFlag&&tks.vs===_VSTATUS.ERROR){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));}}}},failure=function(res){mstrmojo.alert(res.message||res.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete=function(res){_wait(btn,false);};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:tksXML,localSymbolFolderXML:lsfXML,metricXML:mtrXML,metricId:oi.did,isNew:_S.isEmpty(oi.did),msgID:me.ide.isDME?mstrApp.getMsgID():null},{success:success,failure:failure,complete:complete});},_openFormatPopup=function(btn,editor){var me=editor,m=me.oi.fmt,MAP=_FD.MetricFormatTarget;_wait(btn,true);window.setTimeout(function(){if(!m){m=me.oi.fmt={};var i;for(i=0;i<MAP.length;i++){m[MAP[i].p]={};}}var pos=_D.position(btn.domNode,true);me.openPopup("formatPopupRef",{zIndex:me.zIndex+10,model:m,left:Math.max(0,(pos.x-(me.formatPopupRef.width||565)))+"px",top:pos.y+"px"});_wait(btn,false);},50);},_openOptionPopup=function(btn,editor){var me=editor,m=me.oi,open=function(){var pos=_D.position(btn.domNode,true);me.openPopup(mstrmojo.all.mstrMEOptionsDialog||"optionPopupRef",{zIndex:me.zIndex+10,model:m,funcs:me.funcs,left:Math.max(0,(pos.x-(me.optionPopupRef.width||565)))+"px",top:pos.y+"px"});};if(!me.isDME&&!me.funcs){_wait(btn,true);mstrmojo.ME.MetricDataService.getSubtotalFunctions(null,{success:function(res){if(res.items){me.funcs=res.items;open();_wait(btn,false);}},failure:function(res){mstrmojo.alert(res.message||res.getResponseHeader("X-MSTR-TaskFailureMsg"));_wait(btn,false);}});}else{open();}};mstrmojo.ME._MetricEditorHelper=mstrmojo.provide("mstrmojo.ME._MetricEditorHelper",{noCache:true,useKeyDelay:true,tbBrowsable:true,functionNameRef:{scriptClass:"mstrmojo.Label",alias:"fnLabel",cssClass:"mstrmojo-ME-fct-name",bindings:{visible:function(){return !this.parent.insertMode;},text:function(){return mstrmojo.desc(5424,"Function:")+" "+this.parent.fctName;}}},nameEditBoxRef:{scriptClass:"mstrmojo.Box",alias:"nameEditBox",cssClass:"mstrmojo-ME-nameEditBox",cssDisplay:"inline-block",visible:false,bindings:{visible:function(){return !this.parent.insertMode&&this.parent.visible;}},onvisibleChange:function(evt){if(evt.value==false){return ;}var me=this;if(!me.tmr){me.tmr=window.setInterval(function(){if(me.domNode){window.clearInterval(me.tmr);delete me.tmr;me.nameInput.inputNode.select();}},50);}},children:[{alias:"nameInput",scriptClass:"mstrmojo.TextBoxWithLabel",inputNodeCssClass:"mstrmojo-ME-nameInput",value:mstrmojo.desc(2213,"New metric"),size:20,useRichTooltip:true,showErrTooltip:function showTooltip(){var pos=_D.position(this.domNode),msg=_S.isEmpty(this.value)?mstrmojo.desc(9122,"Name cannot be empty"):mstrmojo.desc(11569,"Input contains invalid character");this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+msg+"</span></div>",top:pos.y-5,left:pos.x+pos.w+10};this.hasOpenTooltip=false;this.showTooltip();},bindings:{value:function(){var visible=this.parent.visible;return this.parent.parent.oi.alias||this.parent.parent.oi.n;},label:function(){var ide=this.parent.parent.ide||{},nameLabel=ide.nameLabel||mstrmojo.desc(11566,"Metric Name:");return this.parent.parent.oi.alias?mstrmojo.desc(13249,"Display Name:"):nameLabel;}},onvalueChange:function(evt){var allowSpecialChars=this.parent.parent.ide.action.alias,validate=function(v){return !_S.isEmpty(v)&&(allowSpecialChars?true:!/[\[\]\"\\]/g.test(v));},valid=validate(this.value);if(valid){this.hideTooltip();}else{this.showErrTooltip();}mstrmojo.css.toggleClass(this.parent.domNode,"err",!valid);var editor=this.parent.parent;editor.set("cValid",valid);var oi=editor.oi;if(oi){var old={n:oi.n,alias:oi.alias};oi.n=this.value;oi.alias=this.value;if(oi.n!==old.n&&oi.alias!==old.alias){editor.dirty=true;}}}}]},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:"Metric",browsableTypes:"4,8",onObjectSaved:function(o){var p=this.opener,oi=p&&p.oi;if(p&&oi){oi.did=o.did;oi.n=o.name;oi.desc=o.desc;p.set("title",mstrmojo.desc(2154,"Metric:")+" "+o.name);}}},optionPopupRef:{id:"mstrMEOptionsDialog",scriptClass:"mstrmojo.ME.OptionDialog",title:mstrmojo.desc(9572,"Advanced Metric Options"),help:"Advanced_Metric_Options_dialog_box.htm",height:340},formatPopupRef:{scriptClass:"mstrmojo.ME.MetricFormatEditor",contentNodeCssClass:"mstrmojo-balloon",alias:"formatEditor",title:mstrmojo.desc(2116,"Format"),left:"100px",top:"100px",useAnimate:false,height:360,width:565,help:"Format_Metric_dialog_box.htm",locksHover:true},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px;",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},switchRef:{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"switchToMetricEdtior",cssClass:"mstrmojo-ME-switch mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(9563,"Switch to Formula Editor"),closeAfterSwitch:true,bindings:{visible:function(){return !this.parent.insertMode;}},getEditor:function(){return this.parent;},getFormulaEditorId:function(){var editor=this.getEditor();return(editor.ide&&editor.ide.formulaEditorId)||"mstrME";},onclick:function(){var editor=this.getEditor(),formulaEditorId=this.getFormulaEditorId();editor.oi.tks.items=editor.getMetricDefAsTokens();var cfg={vStatus:mstrmojo.ME.MetricEditBox.VALIDATION_STATUS.UNKNOWN,oi:editor.oi,did:editor.oi.did};if(editor.dirty){cfg.dirty=editor.dirty;}editor.switch2Editor(formulaEditorId,cfg);if(editor.ide){editor.ide.set("showLeftPanel",true);editor.set("simple",false);}}},formatAndOptionsBarRef:{scriptClass:"mstrmojo.HBox",alias:"formatbar",cssClass:"mstrmojo-ME-formatbar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link format",alias:"formatButton",text:mstrmojo.desc(1918,"Format"),bindings:{visible:function(){return this.parent.parent.tbFormatable&&!this.parent.parent.insertMode;}},onclick:function(){_openFormatPopup(this,this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link property",alias:"optButton",text:mstrmojo.desc(13035,"Metric Options"),bindings:{visible:function(){var fme=this.parent.parent;return !fme.insertMode&&!fme.ide.disableAFB;}},onclick:function(){_openOptionPopup(this,this.parent.parent);}}]},saveLabel:mstrmojo.desc(5891,"Save"),saveAsLabel:mstrmojo.desc(628,"Save As"),closeLabel:mstrmojo.desc(221,"Cancel"),saveAsEnabled:true,cValid:true,buttonBarRef:{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:"",bindings:{enabled:function(){return this.parent.parent.cValid;},text:function(){return this.parent.parent.insertMode?mstrmojo.desc(531,"Add"):this.parent.parent.saveLabel;}},onclick:function(){var e=this.parent.parent;if(!e.insertMode&&e.isDirty&&!e.isDirty()){e.close();e.onCancel();return ;}if(!e.cValid){return ;}if(e.insertMode){e.insertOnFinish(e.getMetricDefAsTokens());e.close();}else{if(e.getMetricDefAsTokens){e.oi.tks.items=e.getMetricDefAsTokens();}var me=this;if(e.validateAndSave){_wait(me,true);e.validateAndSave(e.oi,function(){_wait(me,false);});}else{if(e.ide&&e.ide.validateAndSave){_wait(me,true);e.ide.validateAndSave(e.oi,function(){_wait(me,false);});}else{e.tbValidate=this;_validateSyntaxAndSave.call(this,e,"save");}}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",alias:"btnSaveAs",text:mstrmojo.desc(628,"Save As"),bindings:{visible:function(){return !this.parent.parent.insertMode&&!this.parent.parent.isDME;},text:function(){return this.parent.parent.saveAsLabel;}},onclick:function(){var e=this.parent.parent;if(e.getMetricDefAsTokens){e.oi.tks.items=e.getMetricDefAsTokens();}e.tbValidate=this;_validateSyntaxAndSave.call(this,this.parent.parent,"saveAs");}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.parent.closeLabel;}},onclick:function(){var e=this.parent.parent;if(e.onPreClose()){e.close();if(!e.insertMode){e.onCancel();}}}}]},validateSyntax:function validateSyntax(btn){_validateSyntaxAndSave.call(btn,this);},validateSyntaxAndSwitch:function validateSyntaxAndSwitch(btn){_validateSyntaxAndSave.call(btn,this,"switch");},preprocessTokenStram:function preprocessTokenStram(tks){_preprocessTokenStram(tks);},isDirty:function isDirty(){if(this.insertMode){return false;}return this.dirty||this.oi.dirty||(this.oi.fmt||{}).dirty||(this.oi.mps||{}).dirty;},onmetricModify:function onmetricModify(){this.dirty=true;},save:function save(){this.buttonBar.btnSaveAs.onclick();},prompt2saveRef:{scriptClass:"mstrmojo.Editor",cssText:"width:350px;",title:mstrmojo.desc(5728,"Confirm save"),children:[{scriptClass:"mstrmojo.Label",cssText:"margin:5px 5px 20px;",allowHTML:true,bindings:{text:function(){return mstrmojo.desc(9573,"Do you want to save changes made to #?").replace("#","<b>"+this.parent.opener.oi.n+"</b>");}}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"left",cssText:"width:10px;"},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(219,"Yes"),onclick:function(){var me=this.parent.parent;me.opener.save();me.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(218,"No"),onclick:function(){var me=this.parent.parent;me.opener.close();if(me.opener.onCancel){me.opener.onCancel();}me.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var me=this.parent.parent;me.close();}}]}]},prompt2save:function(){if(this.getMetricDefAsTokens){this.oi.tks.items=this.getMetricDefAsTokens();}this.openPopup("prompt2saveRef",{zIndex:this.zIndex+1});},handleMetricAction:function handleMetricAction(action,oi){var me=this;var params=_saveTaskParams(oi,false);if((action==="save")&&oi.did){mstrmojo.xhr.request("POST",mstrConfig.taskURL,_saveAsCallback(me),params);}else{if(((action==="save")&&_S.isEmpty(oi.did))||action==="saveAs"){params.saveAs=true;me.openPopup("saveasRef",{zIndex:me.zIndex+10,folderLinksContextId:17,name:oi.n||oi.name||(me.name&&me.name.value)||mstrmojo.desc(2213,"New Metric"),saveParams:params,saveAsCallback:function(){var cb=_saveAsCallback(me);if(cb.success){var fnSuccess=cb.success;cb.success=function(res){fnSuccess.call(this,res);if(me.ide.noRefresh!==true){var app=mstrApp;mstrmojo.form.send({evt:5005,src:app.name+"."+app.pageName+".5005"});}};}return cb;}});}}},handleDerivedMetricAction:function handleDerivedMetricAction(action,oi){oi=oi||this.oi;if(action==="save"){var cfg={tokenStreamXML:_getTokenStreamXML(oi),alias:oi.n};var mps=oi.mps||{};if(mps.dirty){if(mps.fbf===0){mps.afb=mps.sfb=-1;}cfg.afb=mps.afb;cfg.sfb=mps.sfb;}var ide=mstrmojo.all.mstrMetricIDE,disableAFB=ide.disableAFB;if(disableAFB){cfg.afb=0;cfg.sfb=1;}ide.onApplyMetricCallback(cfg);ide.close();}},onPreClose:function(){var e=this;if(e.isDirty&&e.isDirty()&&!this.isDME){e.prompt2save();return false;}return true;},onClose:function onClose(){this.dirty=false;if(this.onPostClose){this.onPostClose();}},init:function init(props){if(this._super){this._super(props);}var app=mstrApp,useQuickSearch=app&&app.useQuickSearch&&app.useQuickSearch(),delay=useQuickSearch?((app&&app.searchAutoCompleteDelay&&app.searchAutoCompleteDelay())||0):0;this.suggestDelay=delay||200;this.noCache=this.noCache&&useQuickSearch&&!this.isDME;this.ob.children[0].quickSearch=useQuickSearch;mstrmojo.ME.MetricDataService.suggestDelay=this.suggestDelay;mstrmojo.ME.MetricDataService.noCache=this.noCache;},_setupCandidatesCache:function _setupCandidatesCache(tib){if(this.candidates&&tib){tib.candidates=null;tib.set("candidates",this.candidates);}},item2textCss:function item2textCss(item){return"mstrmojo-ME-icon t"+item.t+(item.st?" st"+item.st:(item.um||item.da?"d":""));},getSpecialFunctionEditorId:function getSpecialFunctionEditorId(fct,modal){var did=fct&&fct.did,editorId;if(did){if(mstrmojo.ME.MetricDataService.isBasicAggMap(did)){editorId="mstrSME";}else{if(mstrmojo.ME.MetricDataService.isRank(did)){editorId="mstrRFE";}else{if(MDS.isOLAPAgg(did)){editorId="mstrOFE";}else{editorId="mstrFE";}}}if(editorId){editorId+=modal?"_1":"";}}return editorId;},isDimty:function(n,sortby){return(/^@[a-z]{1,}(\s*[+-]\s*\d{1,})?$/i).test(S.trim(n));},validateByDataType:function validateByDataType(dtp,v){var isValid=false;switch(dtp){case DT.DataTypeInteger:isValid=/^(-)?\d+$/.test(v);break;case DT.DataTypeNumeric:case DT.DataTypeReal:case DT.DataTypeDouble:isValid=mstrmojo.num.isNumeric(v);break;case DT.DataTypeChar:case DT.DataTypeVarChar:isValid=true;break;case DT.DataTypeDate:case DT.DataTypeTimeStamp:isValid=true;break;default:isValid=true;}return isValid;},getRootFunction:function getRootFunction(oi){var fct,met=oi&&oi.tks&&oi.tks.met;if(met!==METRIC_EDIT_TYPES.ADVANCED){var fctTk=oi.tks.items[0];fct=fctTk&&fctTk.oi;}return fct;},checkEditorFallback:function checkEditorFallback(items,oi){var fct=this.getRootFunction(oi),noRoot=mstrmojo.array.find(items,"did",fct&&fct.did)===-1;if(noRoot&&oi&&oi.tks&&oi.tks.items&&oi.tks.items.length>0){oi.tks.met=METRIC_EDIT_TYPES.ADVANCED;}return noRoot;}});mstrmojo.ME._MetricEditorHelper.getTokenStreamXML=_getTokenStreamXML;}());