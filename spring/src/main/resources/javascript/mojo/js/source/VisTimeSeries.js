(function(){mstrmojo.requiresCls("mstrmojo.VisChartLine","mstrmojo.EnumRWUnitType","mstrmojo.VisTooltip","mstrmojo.dom","mstrmojo._TouchGestures","mstrmojo.TouchScroller","mstrmojo._HasTouchScroller","mstrmojo.css","mstrmojo.color","mstrmojo.VisTimeSeriesLegend","mstrmojo.VisTimeSeriesTimeSelector");mstrmojo.requiresDescs(5674,8475,8626);var $CSS=mstrmojo.css,$CLR=mstrmojo.color;var DRILLING_ACTION=1,SELECTOR_ACTION=2,HYPERLINK_ACTION=4;var ROW_AXIS=1,COL_AXIS=2;var chartStatus={},widgetCount=0,tooltipShown=false,itemClicked=false,isDataSetChanged=false,chartSizeChanged=false,originalTouchPosition=0,masterSliderClicked=null,rangeToSeriesMaxRatio=5;var MCHW=20;var MCHH=20;var MAXPOINTS_PER_DRAW=80;var SWidthChanged=false;var masterMargin={t:5,r:MCHW/2,b:5,l:MCHW/2};var PADDING=10,TOP_PADDING=8;var canvasReseted=false;var $_DT=mstrmojo.locales.datetime;function resetLocalVars(){tooltipShown=false;itemClicked=false;isDataSetChanged=false;chartSizeChanged=false;originalTouchPosition=0;masterSliderClicked=null;}function getParentBkgColor(){var parentNode=this.domNode.parentNode;while(parentNode){var compStyle=mstrmojo.css.getComputedStyle(parentNode);var bkgColor=compStyle.backgroundColor;if(bkgColor){if(bkgColor.indexOf("rgba")>=0){var rgba=this.utils.rgbaStr2rgba(bkgColor);if(rgba&&rgba[4]){return rgba;}}else{if(bkgColor.indexOf("rgb")>=0){var rgb=$CLR.rgbStr2rgb(bkgColor);return rgb;}}}parentNode=parentNode.parentNode;}return[255,255,255];}var LIGHT_THEME=0;var DARK_THEME=1;function getUITheme(){var utils=this.utils;var rgb=getParentBkgColor.call(this);var opacity=this.formatProp.backgroundAlpha;rgb=utils.getRGBWithOpacity(rgb,opacity,this.formatProp.backgroundClr);var brightness=(rgb[0]*299+rgb[1]*587+rgb[2]*114)/1000;if(brightness>150){this.theme=LIGHT_THEME;}else{this.theme=DARK_THEME;}}function addChartStatus(id){chartStatus[id]={isLegendBarOpen:false,legendBarWidth:30,isLegendSelected:false,legendSelectedIndex:-1,timeSelectedIntervalPosition:{},currSelectionIdx:-1,usingCustomInterval:false};}function isScrollableElementTouched(touch){var me=this,m=me.margin,chartWidth=me.getChartWidthOnScreen();var touchPointOnWidget=me.utils.getTouchXYOnWidget(touch.pageX,touch.pageY,me);var x=touchPointOnWidget.touchX,y=touchPointOnWidget.touchY;if(x<m.l||x>(chartWidth+m.l)||y<m.t||y>this.canvas.height-m.b){return false;}return true;}function isTouchedOnWidget(touch){if(!touch){return false;}var me=this;var touchPointOnWidget=me.utils.getTouchXYOnWidget(touch.pageX,touch.pageY,me);var x=touchPointOnWidget.touchX,y=touchPointOnWidget.touchY;if((x>0&&x<me.getWidth())&&(y>0&&y<me.getHeight())){return true;}return false;}function getTouchedElement(touch){var item=mstrmojo.dom.findAncestorByAttr(touch.target,"clk",true,this.domNode);return item||null;}function getMinYPosition(lines){var l=lines.length;var i=0,min;while(i<l){if(lines[i]){min=lines[i].y;break;}i++;}for(i=0;i<l;i++){if(lines[i]){min=Math.min(min,lines[i].y);}}return min;}function resetBaseAndDerivedData(tsl){var obm=this.baseModel;var currStatus=chartStatus[this.chartID];this.baseModel=this.getModel(tsl.ds)||this.baseModel;var bm=this.baseModel;this.checkData(bm);var err=bm.err||bm.eg;if(err){this.renderErrorMessage(err);return false;}var bms=bm.series,m=this.model,cs=m.series,sl=bms.length,s=[],j;for(j=0;j<sl;j++){s[j]=bms[j];}this.model.categories=bm.categories;this.model.series=s;this.model.colHeaders=bm.colHeaders;var currWindowSize=this.model.series[0].rv.length;if(this.windowSize!==currWindowSize){currStatus.rns=0;currStatus.rne=currWindowSize;}this.windowSize=currWindowSize;if(!bm.vp||!bm.vp.rl||bm.vp.rl.length<obm.vp.rl.length){bm.vp=obm.vp;}isDataSetChanged=true;return true;}function localUpdateScrollerConfig(){var scl=this._scroller,m=this.model,margin=this.margin,currStatus=chartStatus[this.chartID],animationCanvas=this.animationCanvas,chartWidth=this.getChartWidthOnScreen(),offsetEnd=Math.max(this.acContentWidth-chartWidth,0);var rns=(currStatus.rns!==0&&currStatus.rns+1===currStatus.rne)?currStatus.rns-1:currStatus.rns;scl.origin={x:parseInt(((rns-this.ACrns)*this.RTX),10),y:0};scl.hScroll=(offsetEnd!==0&&scl.noHScroll!==true)||this.scrollPast;if(scl.hScroll){scl.offset={x:{start:0,end:offsetEnd},scrollPast:this.scrollPast};}this.utils.translateCSS(-(scl.origin.x),scl.origin.y,false,this.animationCanvasDiv);this.utils.translateCSS(-(scl.origin.x)+this.maxYLblWidth,scl.origin.y,false,this.xLabelsDiv);}function getCurrencySymbolForMetric(m){var s=m.series,ch=m.colHeaders,chl=ch[0].items.length;var hi0=s[0].hi,fInfo=ch[ch.length-1].items[hi0[hi0.length-1]],f=fInfo.f;var cs=(fInfo&&f&&f.indexOf(fInfo.cs)>=0)?","+fInfo.cs:"";if(cs===""&&f){cs=f.indexOf("%")>=0?",%":"";}if(cs===""&&f){var q=null;if(f.indexOf("'")>=0){q="'";}else{if(f.indexOf('"')>=0){q='"';}}if(q){var temp=f.substring(f.indexOf(q)+1);cs=","+temp.substring(0,temp.indexOf(q));}}return cs;}function hideMasterSliderTooltip(){var ms=this.masterSlider,stt=this.sliderTooltip,sttF=stt.firstChild,sttP=stt.lastChild,fc=ms.firstChild,lc=ms.lastChild;$CSS.removeClass(fc,"mstrmojo-timeseries-span-shadow");$CSS.removeClass(lc,"mstrmojo-timeseries-span-shadow");sttF.innerHTML="";sttF.style.display="none";sttP.style.display="none";}function resizeMasterSliderDone(){var me=this,currStatus=chartStatus[this.chartID];if(currStatus.usingCustomInterval&&me.currSelection){me._timeSelector.toggleSelected(me.currSelection,false);me._timeSelector.toggleGlowEffect(me.currSelection,false);this.updateIntervalPosition();me.currSelection=null;currStatus.currSelectionIdx=-1;}if(chartSizeChanged&&masterSliderClicked!=="MS"){me.showMessage();this.makeSureMasterSliderNotBeyondTheMargin();this.makeSureSliderOnPoint();this.makeSureSelectedIntervalMoreThanTwo();this.makeSureMasterSliderNoOverlap();this.setMasterSliderLayout();window.setTimeout(function(){me.reDrawSlaveChart();},10);}else{masterSliderClicked=null;}hideMasterSliderTooltip.call(this);}function getFormattedDateForSliderTooltip(sliderTooltipXPosition){var me=this,cat=me.model.categories,tp=cat.tp;var pos=Math.round((sliderTooltipXPosition-masterMargin.l)/me.MRTX),rVal=cat.items[pos];if(tp.toString()===me.DSS_XML_BASE_FORM_DATE){rVal=me.getFormattedDateForTooltip(rVal,true);}return rVal;}function getPointDistanceSquare(p1,p2){return(p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y);}function getACRnsRne(rns,rne){var me=this,currStatus=chartStatus[me.chartID],model=me.model,windowSize=me.windowSize,needRedraw=true,ACrns,ACrne;if((!rns&&rns!==0)||!rne){rns=currStatus.rns;rne=currStatus.rne;}var diff=rne-rns;model.currentRatio=Math.round(windowSize/((diff-1)||1));if(model.currentRatio>rangeToSeriesMaxRatio){var ACRation=(rangeToSeriesMaxRatio-1)/2;ACrns=Math.max(0,rns-ACRation*(diff-1));ACrne=Math.min(windowSize,rne+ACRation*(diff-1));if(ACrns===0){ACrne=rangeToSeriesMaxRatio*(diff-1)+1;}else{if(ACrne===windowSize){ACrns=ACrne-rangeToSeriesMaxRatio*(diff-1)-1;}}}else{ACrns=0;ACrne=windowSize;var ACdiff=ACrne-ACrns;}if(me.ACrns===ACrns&&me.ACrne===ACrne){needRedraw=false;}else{me.ACrns=ACrns;me.ACrne=ACrne;}return needRedraw;}function removeChildren(container){var count=container&&container.childNodes&&container.childNodes.length,i;for(i=0;i<count;++i){container.removeChild(container.firstChild);}}function removeLegendAndTimeSelectorChildren(){if(this._legend){this._legend.destroy();}if(this._timeSelector){this._timeSelector.destroy();}}mstrmojo.VisTimeSeries=mstrmojo.declare(mstrmojo.VisChartLine,[mstrmojo._TouchGestures,mstrmojo._HasTouchScroller],{scriptClass:"mstrmojo.VisTimeSeries",isLinearChart:true,highlightColor:"#ffffff",chartLineColors:["#16b0ff","#ff3729","#04ba22","#ff960e","#ae79de","#cccd25","#19cee0","#a9a9a9","#b3cdef","#ffa796","#98df8a","#ffbf80","#dac3ec","#dac3ec","#a1dfea","#d6d6d6"],switchSeriesOnTouch:false,multiTouch:true,margin:{t:70,r:1,b:50,l:5},SLXP:0,SRXP:0,isTimeSeries:true,maxXLabels:4,scrollerConfig:{bounces:false,showScrollbars:false,useTranslate3d:true},scrollPast:true,isAndroidTab:false,masterContext:null,selectionOrLinkdrillOnRow:false,lastSelectedPoint:null,markupString:'<div id="{@id}" class="mstrmojo-Chart {@cssClass}" style="width:{@width};height:{@height};left:{@left};top:{@top};z-index:{@zIndex};position:absolute;-webkit-transition: 0ms; transition: 0ms; -webkit-transform: translate3d(0px, 0px, 0px);"  mstrAttach:mousedown,mouseup,mousemove,click ><canvas width="{@width}" height="{parseInt(@height) - @masterChartHeight}"></canvas><div style="overflow:hidden;position:absolute;left:0px;top:0px;"><div id="{@id}-animation-canvas-div" class="mstrmojo-timeseries-animation-canvas" style="position:absolute;left:0px;top:0px;width:{@width};height:{@slaveChartHeight+"px"};"><canvas style="position:absolute;left:0px;top:0px;" width="{@width}" height="{parseInt(@height) - @masterChartHeight}"></canvas></div></div><div style="overflow:hidden;position:absolute;left:0px;top:0px;"><div id="{@id}-x-labels-div" class="mstrmojo-timeseries-animation-canvas" style="position:absolute;left:0px;top:0px;width:{@width};height={@slaveChartHeight+"px"}"></div></div><canvas id="{@id}-highlight-canvas" style="position:absolute;left:0px;top:0px;" width="{@width}" height="{parseInt(@height) - @masterChartHeight}"></canvas><div id="{@id}-tooltip"></div><div id="{@id}-time-selector-div"></div><div id="{@id}-legend-bar-div" ></div><div id="{@id}-loading-msg" class="mstrmojo-loading-msg" style="display:none"></div><canvas id="{@id}-master-canvas" style=" position:absolute;left:0px;bottom:0px;" width="{@width}" height="{@masterChartHeight}"></canvas><div id="{@id}-master-div" class="mstrmojo-master-parent-div" width="{@width}" style="position:absolute;bottom:5px" ><div id="{@id}-master-cover-span" style="position:absolute;left:0px;" class="mstrmojo-master-cover-span"></div><div id="{@id}-master-slider" class="mstrmojo-master-slider-div" clk="MS"><canvas id="{@id}-master-img-L" width="20" height="20" style="position:absolute;left:0px" class="mstrmojo-timeseries-master-span" clk="L" ></canvas><canvas id="{@id}-master-slider" width="{@width}" height="{@masterChartHeight}" style="top:0px;left:0px" class="mstrmojo-master-slider-div-top"></canvas><canvas id="{@id}-master-img-R" width="20" height="20" style="position:absolute;right:0px" class="mstrmojo-timeseries-master-span" clk="R" ></canvas></div><div id="{@id}-master-cover-span" style="position:absolute;right:0px;" class="mstrmojo-master-cover-span"></div></div><div id="{@id}-slider-tooltip" style="position:absolute;left:0;top:0;z-index:150;width:{@width};"><div class="timeseries-slider-tooltip"></div><canvas style="position:absolute;left:0px;top:20px;display: none;" width="6px" height="5px"></canvas></div><div id="{@id}-legend-tooltip" class="mstrmojo-Chart-tooltip timeseries-legend-tooltip"></div><span id="textSpan" style="z-index:-10;visibility:hidden;"></span><div id="{@id}-infowindow-anchor" style="position:absolute;width:18px;height:18px;display:block"></div><div id="{@id}-errMsg" class="mstrmojo-message" style="width:{@width};height:{@height};top:0px;left:0px;position:absolute;display:none; z-index:20;"></div></div>',markupSlots:{canvas:function(){return this.domNode.firstChild;},animationCanvasDiv:function(){return this.domNode.childNodes[1].firstChild;},animationCanvas:function(){return this.domNode.childNodes[1].firstChild.firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1];},xLabelsDiv:function(){return this.domNode.childNodes[2].firstChild;},xLabelsDivContainer:function(){return this.domNode.childNodes[2];},highlightCanvas:function(){return this.domNode.childNodes[3];},tooltip:function(){return this.domNode.childNodes[4];},timeSelectorDiv:function(){return this.domNode.childNodes[5];},legendBarDiv:function(){return this.domNode.childNodes[6];},loadingMsg:function(){return this.domNode.childNodes[7];},masterCanvas:function(){return this.domNode.childNodes[8];},masterSlider:function(){return this.domNode.childNodes[9].childNodes[1];},sliderTooltip:function(){return this.domNode.childNodes[10];},legendTooltip:function(){return this.domNode.childNodes[11];},textSpan:function(){return this.domNode.childNodes[12];},infoWindowAnchor:function(){return this.domNode.childNodes[13];},errorMsg:function(){return this.domNode.childNodes[14];}},getTextWidth:function gtw(str,fontStyle,zf){this.textSpan.style.font=fontStyle;this.textSpan.innerHTML=str;if(zf){this.utils.changeElementSize(this.textSpan,"font",zf);}var ret=this.textSpan.offsetWidth;return ret;},getTextWidthByElem:function gtwCvs(text,elem){var computedStyle=mstrmojo.css.getComputedStyle(elem);var fontStyle=computedStyle.fontStyle+" "+computedStyle.fontWeight+" "+computedStyle.fontSize+"/"+computedStyle.fontVariant+" "+computedStyle.fontFamily;return this.getTextWidth(text,fontStyle);},getTextHeight:function gtw(str,fontStyle,zf){this.textSpan.style.font=fontStyle;this.textSpan.innerHTML=str;if(zf){this.utils.changeElementSize(this.textSpan,"font",zf);}var ret=this.textSpan.offsetHeight;return ret;},getMaxTextWidth:function(textArray,fontStyle){var me=this,l=textArray.length,maxWidth=0,currWidth=0,i;for(i=1;i<l;i++){currWidth=me.getTextWidth(textArray[i],fontStyle);maxWidth=currWidth>maxWidth?currWidth:maxWidth;}return maxWidth;},getChartWidthOnScreen:function getChartWidthOnScreen(){var m=this.margin;return this.getWidth()-m.r-m.l-chartStatus[this.chartID].legendBarWidth;},drawChartXYAxis:function drawChartXYAxis(){var utils=this.utils,m=this.margin,w=this.getWidth()-chartStatus[this.chartID].legendBarWidth,h=this.canvas.height,c=this.context;c.save();c.strokeStyle=utils.rgb2rgbStr(this.formatProp.textClr);c.lineWidth=1;c.globalAlpha=0.8;var xPos=Math.floor(m.l)-0.5;utils.drawLineSet(this,[{x:xPos,y:m.t},{x:xPos,y:h-m.b}],false,c);var yPos=Math.floor(h-m.b)+0.5;utils.drawLineSet(this,[{x:m.l-this.maxYLblWidth,y:yPos},{x:w-m.r,y:yPos}],false,c);c.restore();},setMasterSlider:function setMasterSlider(){var width=this.getWidth(),h=this.masterCanvas.height-masterMargin.t-masterMargin.b,utils=this.utils,msl=this.masterSlider,msStyle=msl.style,mslp=msl.parentNode,lcStyle=mslp.firstChild.style,rcStyle=mslp.childNodes[2].style,m=this.model,mrtx=this.MRTX,currStatus=chartStatus[this.chartID];mslp.style.display="block";mslp.style.height=h+"px";mslp.style.width=width+"px";msStyle.height=h+"px";lcStyle.height=h-2+"px";rcStyle.height=h-2+"px";lcStyle.backgroundColor=rcStyle.backgroundColor=utils.rgb2rgbStr(this.formatProp.backgroundClr,this.formatProp.backgroundAlpha*0.5);this.drawMasterChartHandler(msl.firstChild,MCHW,MCHH,true);this.drawMasterChartHandler(msl.lastChild,MCHW,MCHH,false);msl.firstChild.style.marginTop=msl.lastChild.style.marginTop=Math.round((h-MCHH)/2)+"px";this.calculateSXP(currStatus.rns,currStatus.rne,true);this.makeSureMasterSliderNotBeyondTheMargin();this.makeSureMasterSliderNoOverlap();this.setMasterSliderLayout();},drawMasterChartHandler:function drwMCH(canvas,w,h,isLeft){var utils=this.utils,ctx=canvas.getContext("2d");canvas.width=w;canvas.height=h;ctx.save();ctx.fillStyle=utils.rgb2rgbStr(this.formatProp.backgroundClr,0.76);utils.drawRoundRect(ctx,0.5,0.5,w-1,h-1,1,true);ctx.strokeStyle=utils.rgb2rgbStr(this.formatProp.textClr);ctx.lineWidth=1;utils.drawRoundRect(ctx,0.5,0.5,w-1,h-1,1);ctx.beginPath();ctx.lineWidth=2;if(isLeft){ctx.moveTo(11,6);ctx.lineTo(7,10);ctx.lineTo(11,14);}else{ctx.moveTo(9,6);ctx.lineTo(13,10);ctx.lineTo(9,14);}ctx.stroke();ctx.restore();},drawMasterChartDiv:function drwMCD(x,w){var canvas=this.masterSlider.childNodes[1],width=this.SRXP-this.SLXP+MCHW;if(canvas.width==width){}else{var margin=masterMargin,mcHeight=this.masterChartHeight,divHeight=mcHeight-margin.t-margin.b,h=(divHeight-MCHH)/2;canvas.height=divHeight;canvas.width=width;var ctx=canvas.getContext("2d");ctx.save();ctx.strokeStyle=this.utils.rgb2rgbStr(this.formatProp.textClr);ctx.lineWidth=1;ctx.beginPath();var leftX=0.5+MCHW/2;var rightX=width-0.5-MCHW/2;ctx.moveTo(leftX,h);ctx.lineTo(leftX,0);ctx.lineTo(rightX,0);ctx.lineTo(rightX,h);ctx.moveTo(leftX,h+MCHH);ctx.lineTo(leftX,divHeight);ctx.lineTo(rightX,divHeight);ctx.lineTo(rightX,h+MCHH);ctx.stroke();ctx.restore();}},setMasterSliderLayout:function setMasterSliderLayout(){var width=this.getWidth(),utils=this.utils,msl=this.masterSlider,msStyle=msl.style,mslp=msl.parentNode,lcStyle=mslp.firstChild.style,rcStyle=mslp.childNodes[2].style;lcStyle.width=(this.SLXP)+"px";rcStyle.width=(width-this.SRXP)+"px";var slWidth=(this.SRXP-this.SLXP);msStyle.width=(slWidth+MCHW)+"px";utils.translateCSS(this.SLXP-MCHW/2,0,false,msl);this.drawMasterChartDiv();},makeSureMasterSliderNoOverlap:function makeSureMasterSliderNoOverlap(fixWhich){var slWidth=this.SRXP-this.SLXP;if(slWidth<MCHW){slWidth=MCHW;var width=this.getWidth();if(!fixWhich){fixWhich=this.SRXP+MCHW/2===width-1?"R":"L";}if(fixWhich=="L"){this.SRXP=this.SLXP+MCHW;}else{this.SLXP=this.SRXP-MCHW;}}},calculateSXP:function calculateSXP(rns,rne,intervalChanged){if(intervalChanged){this.SLXP=Math.round((this.MRTX*rns)+masterMargin.l);this.SRXP=Math.round((this.MRTX*(rne-1))+masterMargin.l);}else{var width=this.SRXP-this.SLXP;this.SLXP=Math.round((this.MRTX*rns)+masterMargin.l);this.SRXP=this.SLXP+width;}},makeSureMasterSliderNotBeyondTheMargin:function makeSureMasterSliderNotBeyondTheMargin(keepWidth){var SWidth=this.SRXP-this.SLXP;var width=this.getWidth();if(this.SLXP<masterMargin.l){this.SLXP=masterMargin.l;if(keepWidth){this.SRXP=this.SLXP+SWidth;}}if(this.SRXP>width-masterMargin.r-1){this.SRXP=width-masterMargin.r-1;if(keepWidth){this.SLXP=this.SRXP-SWidth;}}},makeSureSelectedIntervalMoreThanTwo:function makeSureSelectedIntervalMoreThanTwo(){var mrtx=this.MRTX,width=this.getWidth();if(this.SRXP-this.SLXP<mrtx){if(masterSliderClicked){if(masterSliderClicked==="L"){this.SLXP=this.SRXP-mrtx;}else{this.SRXP=this.SLXP+mrtx;}}else{if(this.SLXP+mrtx<=width-masterMargin.r){this.SRXP=this.SLXP+mrtx;}else{this.SLXP=this.SRXP-mrtx;}}}},makeSureSXPNotEqual:function makeSureSXPNotEqual(){var mrtx=this.MRTX,width=this.getWidth();if(this.SLXP===this.SRXP){if(masterSliderClicked){if(masterSliderClicked==="L"){this.SLXP-=mrtx;}else{this.SRXP+=mrtx;}}else{if(this.SRXP+mrtx<=width-masterMargin.r){this.SRXP+=mrtx;}else{this.SLXP-=mrtx;}}}},makeSureSliderOnPoint:function makeSureSliderOnPoint(){return ;var mrtx=this.MRTX,diff=0,currStatus=chartStatus[this.chartID];if(masterSliderClicked){diff=Math.round((this.SRXP-this.SLXP)/mrtx);if(masterSliderClicked==="L"){this.SLXP=this.SRXP-diff*mrtx;}else{if(masterSliderClicked==="R"){this.SRXP=this.SLXP+diff*mrtx;}else{this.calculateSXP(currStatus.rns,currStatus.rne,true);}}}},initScroller:function initScroller(scroller){if(!scroller.offset&&this.scrollPast){scroller.offset={scrollPast:this.scrollPast};}this._super(scroller);var me=this;this._scrollDoneListener=this._scroller.attachEventListener("scrollDone",me.id,function(evt){var m=me.model,currStatus=chartStatus[me.chartID],r=currStatus.rne-currStatus.rns,rns=me.ACrns+parseInt(Math.round(me._scroller.origin.x/me.RTX),10);if(r===1){rns++;}var rne=rns+r;if(rns<0){currStatus.rns=0;currStatus.rne=currStatus.rns+r;}else{if(rne>m.series[0].rv.length){currStatus.rne=m.series[0].rv.length;currStatus.rns=currStatus.rne-r;}else{currStatus.rns=rns;currStatus.rne=rne;}}me.updateRnsRne();SWidthChanged=false;me.incFetchChart();});this._scrollMovedListener=this._scroller.attachEventListener("scrollMoved",me.id,function(evt){if(tooltipShown){me.hiddenTooltipAndShowTimeSelector();}var m=me.model,currStatus=chartStatus[me.chartID],sl=m.series[0].rv.length,r=currStatus.rne-currStatus.rns,rns=me.ACrns+Math.round(evt.x/me.RTX),rne=Math.min(rns+r,sl);if(rns<0){rns=0;}if(rne-rns!=r){SWidthChanged=true;}me.utils.translateCSS(-evt.x+me.maxYLblWidth,-evt.y,false,me.xLabelsDiv);me.calculateSXP(rns,rne,SWidthChanged);me.makeSureSXPNotEqual();me.makeSureMasterSliderNoOverlap();me.setMasterSliderLayout();});},getAppLevelTheme:function(){this.theme=DARK_THEME;},initFromVisProps:function(vp){var propValue=vp?vp:{};var formatProp={};this.getAppLevelTheme();var theme=this.theme;var setFormatProp=function(darkTheme,lightTheme){if(theme===LIGHT_THEME){return lightTheme;}else{return darkTheme;}};formatProp.backgroundClr=propValue.fbg?$CLR.hex2rgb(propValue.fbg):setFormatProp([31,31,31],[247,247,247]);formatProp.textClr=propValue.flt?$CLR.hex2rgb(propValue.flt):setFormatProp([224,224,224],[51,51,51]);formatProp.tooltipClr=propValue.ftt?$CLR.hex2rgb(propValue.ftt):setFormatProp([224,224,224],[51,51,51]);formatProp.backgroundAlpha=propValue.fbt!=undefined?(1-parseInt(propValue.fbt)/100):1;var getBool=function(v){if(v==true||v=="1"||v==1||v=="true"){return true;}return false;};formatProp.useCustomAxisScale=propValue.fcas?getBool(propValue.fcas):false;var numCheck=function(num){if(num>Number.MAX_VALUE){num=Number.MAX_VALUE;}if(num<-1*Number.MAX_VALUE){num=-1*Number.MAX_VALUE;}return num;};formatProp.minValue=propValue.fmiav?numCheck(parseFloat(propValue.fmiav)):"";formatProp.maxValue=propValue.fmaav?numCheck(parseFloat(propValue.fmaav)):"";formatProp.condenseLabels=propValue.fcl?getBool(propValue.fcl):true;formatProp.iconTintClr=setFormatProp([194,194,194],[64,64,64]);formatProp.secTextClr=setFormatProp([135,135,135],[140,140,140]);formatProp.secBackgroundClr=setFormatProp([48,48,48],[229,229,229]);formatProp.tintClr=[43,172,48];this.formatProp=formatProp;this.chartLineColors=["#16b0ff","#ff3729","#04ba22","#ff960e","#ae79de","#cccd25","#19cee0","#a9a9a9","#b3cdef","#ffa796","#98df8a","#ffbf80","#dac3ec","#dac3ec","#a1dfea","#d6d6d6"];for(var i=0;i<this.chartLineColors.length;i++){var propName=""+Math.floor(i/4)+i%4;propName="fs"+propName;var color=propValue[propName];if(color){this.chartLineColors[i]="#"+color;}}this.glowColor=this.utils.rgb2rgbStr(this.formatProp.tooltipClr);},getMaxValue:function getMaxV(){if(typeof this.formatProp.maxValue=="number"){return this.formatProp.maxValue;}else{return this._super();}},getMinValue:function getMinV(){if(typeof this.formatProp.minValue=="number"){return this.formatProp.minValue;}else{return this._super();}},preBuildRendering:function preBR(){if(this._super){this._super();}this.masterChartHeight=90;this.slaveChartHeight=this.getHeight()-this.masterChartHeight;},buildRendering:function(){this._super();this.slaveChartHeight=this.getHeight()-this.masterChartHeight;},postBuildRendering:function postBR(){var model=this.model;this.checkData(model);var err=model.err||model.eg;var xtabModel=this.xtabModel,docModel=(xtabModel&&xtabModel.docModel);if(err){if(docModel&&docModel.prompts){this.model.docModel=docModel;}this.renderErrorMessage(err);return ;}else{this.errorMsg.style.display="none";}resetLocalVars();getUITheme.call(this);this.updateSelectionLinkdrillInfo(model);if(this.baseModel&&!model.vp){this.model=this.baseModel;}this.chartID=this.getChartID(docModel);if(!chartStatus[this.chartID]){addChartStatus(this.chartID);}this.scrollerConfig.scrollEl=this.animationCanvasDiv;this.isAndroidTab=!!mstrApp.isTablet();this.masterContext=this.masterCanvas.getContext("2d");this.renderVisTooltip();this.setMarginTopByTooltipHeight();this.renderLegend();if(this._super){this._super();}this.renderTimeSelector();this.setAnimationCanvasContainer();localUpdateScrollerConfig.call(this);if(docModel&&docModel.prompts){this.model.docModel=docModel;}this.drawSliderTooltipPointer();var me=this;if(docModel){this._infoWClosedListener=this.xtabModel.docModel.attachEventListener("infoWindowClosed",this.id,function(evt){var infoWindowK=evt.psKey;if(!me.hasNonifwTarget&&me.selectorTargets&&me.selectorTargets[infoWindowK]){me.lastSelectedPoint=null;me.incFetchChart(true);return ;}});}this.fullScreenListener=mstrmojo.touchManager.attachEventListener("fullScreenStateChange",this.id,function(evt){this.adjustWidgetOffsets();});this.renderLegendTooltip();this.model.processed=true;},ongridDataChange:function onGridDataChange(evt){this.model=this.gridData;},getChartID:function getChartID(docModel){var chartID="";var layoutModel=docModel?docModel:(this.layoutModel?this.layoutModel:(this.model.layoutModel?this.model.layoutModel:null));if(layoutModel){chartID=layoutModel.oid+"_"+layoutModel.currlayKey+"_"+this.model.k;}else{if(this.model.mid){chartID=this.model.mid;}else{chartID=widgetCount++;}}return chartID;},checkData:function checkData(model){var colHeaders=model.colHeaders,categories=model.categories;if(!colHeaders||(colHeaders&&colHeaders.length<1)){this.model.err=mstrmojo.desc(8626,"The Time Series widget requires at least one attribute on the row axis and at least one metric on the column axis; optionally, one attribute can be placed above the metrics.");}if(colHeaders&&colHeaders.length>=1&&!this.isMetric(colHeaders[colHeaders.length-1].items)){this.model.err=mstrmojo.desc(8626,"The Time Series widget requires at least one attribute on the row axis and at least one metric on the column axis; optionally, one attribute can be placed above the metrics.");}if((categories&&(!categories.items||categories.items.length<2))){this.model.err=mstrmojo.desc(8475,"There is not enough data to plot the graph.");}},renderErrorMessage:function renderErrorMessage(msg){this.errorMsg.innerHTML=msg;this.errorMsg.style.display="block";},isMetric:function isMetric(items){if(items&&items.length>0&&items[0].cs!=null){return true;}return false;},updateSelectionLinkdrillInfo:function uscld(model){var rowHeaders=model.rowHeaders,rowHL=rowHeaders.length;for(var i=0;i<rowHL;i++){var rowH=rowHeaders[i];if(rowH.sc&&rowH.sc.tks){this.selectionOrLinkdrillOnRow=true;return ;}if(rowH.lm&&rowH.lm[0]&&rowH.lm[0].links){this.selectionOrLinkdrillOnRow=true;return ;}}},hasPageBy:function hasPageBy(){if(this.baseModel&&this.baseModel.phs&&this.baseModel.phs.show){return true;}return false;},setlegendStatus:function setlegendStatus(ilo,lbw){chartStatus[this.chartID].legendBarWidth=lbw;chartStatus[this.chartID].isLegendBarOpen=ilo;},setLegendSelected:function setLegendSelected(ils,lsi){chartStatus[this.chartID].isLegendSelected=ils;chartStatus[this.chartID].legendSelectedIndex=lsi;},getLegendBarDiv:function getLegendBarDiv(){return this.domNode.childNodes[6];},getTimeSelectorDiv:function getTimeSelectorDiv(){return this.domNode.childNodes[5];},renderLegend:function renderLegend(){var placeholder=this.legendBarDiv;var m=this.margin;var chartID=this.chartID;var props={placeholder:placeholder,model:this.model,utils:this.utils,widget:this,isLegendBarOpen:chartStatus[chartID].isLegendBarOpen,isAndroidTab:this.isAndroidTab,isLegendSelected:chartStatus[chartID].isLegendSelected,legendSelectedIndex:chartStatus[chartID].legendSelectedIndex,top:m.t+"px",right:"0px",zIndex:1};var w=new mstrmojo.VisTimeSeriesLegend(props);w.render();this._legend=w;},renderTimeSelector:function renderTimeSelector(){var placeholder=this.timeSelectorDiv;var m=this.margin;var chartID=this.chartID;var props={placeholder:placeholder,offsetx:this.margin.l,widget:this,chartStatus:chartStatus[this.chartID]};var w=new mstrmojo.VisTimeSeriesTimeSelector(props);w.render();this._timeSelector=w;},renderVisTooltip:function renderVisTooltip(){var props={placeholder:this.tooltip,cssClass:"timeseries-tooltip"};this._tooltip=new mstrmojo.VisTooltip(props);this._tooltip.render();this._tooltip.toggle(false);},renderLegendTooltip:function renderLegendTooltip(){var props={placeholder:this.legendTooltip,boundary:this.domNode};this._legendTooltip=new mstrmojo.VisTextTooltip(props);this._legendTooltip.render();this._legendTooltip.toggle(false);},setAnimationCanvasContainer:function setAnimationCanvasContainer(){var currStatus=chartStatus[this.chartID],m=this.margin;this.itemsContainerNode.style.left=m.l+"px";this.xLabelsDivContainer.style.left=(m.l-this.maxYLblWidth)+"px";},updateRnsRne:function updateRnsRne(rns,rne){var currStatus=chartStatus[this.chartID],m=this.model;if((rns==0||rns)&&rne){currStatus.rns=rns;currStatus.rne=rne;}m.rns=currStatus.rns;m.rne=currStatus.rne;},drawPreparation:function drawPreparation(windowSize,rns,rne){var me=this,margin=this.margin,model=me.model,diff=rne-rns,height=me.getHeight()-me.masterChartHeight,ctx=me.animationContext;var chartWidth=me.getChartWidthOnScreen();this.chartWidth=chartWidth;getACRnsRne.call(this,rns,rne);var ACdiff=me.ACrne-me.ACrns;if(diff<windowSize){if(diff>1){diff--;}if(ACdiff>1){ACdiff--;}windowSize--;}this.itemsContainerNode.style.width=chartWidth+"px";this.itemsContainerNode.style.height=height+"px";this.xLabelsDivContainer.style.width=me.maxYLblWidth+chartWidth+"px";this.xLabelsDivContainer.style.height=height+"px";totalChartWidth=(windowSize/diff)*chartWidth;me.totalChartWidth=totalChartWidth;var acContentWidth=0;if(model.currentRatio>rangeToSeriesMaxRatio){acContentWidth=(ACdiff/diff)*chartWidth;}else{acContentWidth=totalChartWidth;}this.acContentWidth=acContentWidth;var acWidth=rangeToSeriesMaxRatio*this.getWidth();if(me.animationCanvas.width!==acWidth){canvasReseted=true;}me.animationCanvas.width=acWidth;me.RTX=(totalChartWidth-1)/(this.windowSize-1);},drawChart:function drwchrt(){var model=this.model;if(model.err){return ;}var me=this,mvalues=model.mvalues,width=me.getWidth(),margin=me.margin,utils=me.utils,values=model.series,ylbls=model.ylbls,windowSize=me.windowSize,currStatus=chartStatus[this.chartID];if((!currStatus.rns&&currStatus.rns!=0)||!currStatus.rne||currStatus.rns<0||currStatus.rne>windowSize){currStatus.rns=model.rns;currStatus.rne=model.rne;if((currStatus.rne-currStatus.rns)<2){if(currStatus.rns>0){currStatus.rns=currStatus.rne-2;}else{currStatus.rne=currStatus.rns+2;}}}this.updateRnsRne();var mch=me.masterChartHeight;var height=me.slaveChartHeight;if(!values){return ;}if(me.isDrawAxis&&me.drawYAxisLabels){margin.l=utils.getLabelWidthForMargin(me,model.mls);}me.masterCanvas.height=mch;me.masterCanvas.width=width;utils.fillMasterChartBackground(me,0,masterMargin.t,width,mch-masterMargin.t-masterMargin.b,masterMargin.b,me.masterContext);me.MRTY=(mch-masterMargin.t-masterMargin.b-1-3)/(mvalues[mvalues.length-1]-mvalues[0]);me.MRTX=(width-masterMargin.l-masterMargin.r-1)/(windowSize-1);me.drawSeries(0,windowSize,currStatus.rns,currStatus.rne,values,me.masterContext,true);me.setMasterSlider();this.calculateRnsRneFromSXP();if(me.canvas.height!=height||me.animationCanvas.height!=height||me.highlightCanvas.height!=height||me.canvas.width!=width){me.canvas.height=me.animationCanvas.height=me.highlightCanvas.height=height;me.canvas.width=me.highlightCanvas.width=width;canvasReseted=true;utils.fillBackground(me);}this.maxYLblWidth=this.getMaxTextWidth(ylbls,this.mstrmojo_Chart_lbl_font)+5;this.drawPreparation(windowSize,currStatus.rns,currStatus.rne);me.RTY=(height-margin.t-margin.b-1-4)/(mvalues[mvalues.length-1]-mvalues[0]);me.drawSeries(me.ACrns,me.ACrne,currStatus.rns,currStatus.rne,values,me.animationContext,false);},calculateRnsRneFromSXP:function calrns(keepInterval){var me=this,m=me.model,rns,rne;var interval=m.rne-m.rns;rne=Math.round((me.SRXP-masterMargin.l)/me.MRTX)+1;rne=Math.min(rne,me.windowSize);if(keepInterval){rns=rne-interval;}else{rns=Math.round((me.SLXP-masterMargin.l)/me.MRTX);}this.updateRnsRne(rns,rne);},reDrawSlaveChartImpl:function reDrawSlaveChartImpl(){var me=this,model=me.model,currStatus=chartStatus[this.chartID],values=model.series,context=me.animationContext;this.drawPreparation(me.windowSize,currStatus.rns,currStatus.rne);me.drawSeries(me.ACrns,me.ACrne,currStatus.rns,currStatus.rne,values,context,false);localUpdateScrollerConfig.call(me);this.removeLabels();itemClicked=true;this.drawLabels();itemClicked=false;},redrawSeries:function redrawSeries(){var me=this,model=me.model,values=model.series,context=me.animationContext,windowSize=me.windowSize,ht=me.getHeight(),currStatus=chartStatus[this.chartID];me.animationCanvas.width=me.animationCanvas.width;me.drawSeries(me.ACrns,me.ACrne,currStatus.rns,currStatus.rne,values,context,false);localUpdateScrollerConfig.call(me);this.removeLabels();itemClicked=true;this.drawLabels();itemClicked=false;},incFetchChart:function incFetchChart(mustRedraw){var me=this,model=me.model,currStatus=chartStatus[this.chartID],values=model.series,context=me.animationContext,m=me.margin,utils=me.utils,lines=[],width=me.getWidth(),chartWidth=me.getChartWidthOnScreen(),h=me.canvas.height,windowSize=me.windowSize;var v0l=values[0].rv.length;var diff=currStatus.rne-currStatus.rns;var needRedraw=getACRnsRne.call(this);var redrawChart=mustRedraw||needRedraw||currStatus.isLegendSelected||me.needRedrawVerticalLine;if(redrawChart){var ACdiff=me.ACrne-me.ACrns;if(diff<v0l){if(diff>1){diff--;}if(ACdiff>1){ACdiff--;}v0l--;}totalChartWidth=(v0l/diff)*chartWidth;me.totalChartWidth=totalChartWidth;var acContentWidth=0;if(model.currentRatio>rangeToSeriesMaxRatio){acContentWidth=(ACdiff/diff)*chartWidth;}else{acContentWidth=totalChartWidth;}this.acContentWidth=acContentWidth;me.animationCanvas.width=me.animationCanvas.width;me.drawSeries(me.ACrns,me.ACrne,currStatus.rns,currStatus.rne,values,context,false);localUpdateScrollerConfig.call(me);}this.removeLabels();itemClicked=true;this.drawLabels(!redrawChart);itemClicked=false;},reDrawSlaveChart:function reDrawSlaveChart(){var me=this;this.calculateRnsRneFromSXP();this.reDrawSlaveChartImpl();chartSizeChanged=false;masterSliderClicked=null;this.hideMessage();},drawSeries:function drawSeries(start,end,rns,rne,values,context,isMasterChart){var me=this,utils=me.utils,lines=[],k=0,vl=values.length;var lineWidth=isMasterChart?1:(rne-rns>180?1:2);for(var j=vl-1;j>=0;j--){lines=[];k=0;for(var i=start;i<end;i++){var val=values[j].rv[i];if(val.length===0){lines[k++]=null;continue;}lines[k]={x:isMasterChart?((i*me.MRTX)+masterMargin.l+1):((i-start)*me.RTX),y:isMasterChart?utils.getMasterYValue(me,val,masterMargin):utils.getYValue(me,val)};k++;}me.drawChartLine(lines,rns-start,rne-start,j,context,isMasterChart,lineWidth);}if(!isMasterChart&&me.lastSelectedPoint){me.highlightSelectedPoint();}},getSerieColor:function getSerieColor(serieIndex){var clrLength=this.chartLineColors.length;return this.chartLineColors[serieIndex%clrLength];},drawChartLine:function drwcl(lines,rns,rne,si,context,isMasterChart,lw){var me=this,m=me.model,s=m.series[si],utils=this.utils,currStatus=chartStatus[this.chartID];context.save();context.lineCap="round";context.lineWidth=lw||2;context.lineJoin="round";context.beginPath();if(this.formatProp&&this.formatProp.useCustomAxisScale){var margin;if(!isMasterChart){margin=me.margin;context.rect(0,margin.t,me.animationCanvas.width,me.slaveChartHeight-margin.b-margin.t);}else{margin=masterMargin;context.rect(0,margin.t,me.getWidth(),me.masterChartHeight-margin.b-margin.t);}context.clip();}var clr=this.getSerieColor(si),rgbClr=$CLR.hex2rgb(clr),l=lines.length,dataPointPerScreen=rne-rns;context.strokeStyle=clr;if(currStatus.isLegendSelected&&!isMasterChart){if(currStatus.legendSelectedIndex===si){var MaxY=this.canvas.height-this.margin.b;var start=rns,end=rne-1;for(var i=0;i<Math.ceil((l-1-rns)/(dataPointPerScreen-1));i++){if(mstrmojo.dom.isIE10){utils.drawLineAreaWithSplit(me,lines,start,end,MaxY,rgbClr,context,MAXPOINTS_PER_DRAW);}else{utils.drawLineArea(me,lines,start,end,MaxY,rgbClr,context);}start=end;end=Math.min(start+dataPointPerScreen-1,l-1);}start=Math.max(rns-dataPointPerScreen+1,0),end=rns;for(var i=Math.ceil((rns)/(dataPointPerScreen-1));i>0;i--){if(mstrmojo.dom.isIE10){utils.drawLineAreaWithSplit(me,lines,start,end,MaxY,rgbClr,context,MAXPOINTS_PER_DRAW);}else{utils.drawLineArea(me,lines,start,end,MaxY,rgbClr,context);}end=start;start=Math.max(start-dataPointPerScreen+1,0);}if(mstrmojo.dom.isIE10){utils.drawLineAreaWithSplit(me,lines,start,end,MaxY,rgbClr,context,MAXPOINTS_PER_DRAW);}else{utils.drawLineArea(me,lines,start,end,MaxY,rgbClr,context);}context.globalAlpha=1;context.lineWidth=2;}else{context.globalAlpha=0.3;context.lineWidth=1;}}if(mstrmojo.dom.isIE10){utils.drawLineSetWithSplit(me,lines,false,context,MAXPOINTS_PER_DRAW);}else{utils.drawLineSet(me,lines,false,context);}context.restore();},drawLabels:function drwlbls(needNotDrawVerticalGridLine){this.drawChartXYAxis();if(this._super){this._super(needNotDrawVerticalGridLine);}var h=this.xLabelsDiv.offsetHeight;},drawSelector:function drwsl(lbl,rl,intervalChanged){var m=this.model,sl=m.series[0].rv.length,rng=sl,bm=this.baseModel,row=bm.rowHeaders,currStatus=chartStatus[this.chartID],rns=currStatus.rns,rne=currStatus.rne;if(intervalChanged){var rs=parseInt(rl.rs,10);var sr=rl.sr;for(var i=0;i<row.length;i++){if(row[i].id===sr){rng=row[i].l*rs;break;}}if(rng<2){rng=2;}var index=mstrmojo.dom.findAncestorByAttr(lbl,"value",true,this.domNode);var right=rne;if(right-rng>=0){currStatus.rns=right-rng;currStatus.rne=right;}else{currStatus.rns=0;currStatus.rne=rng<sl?rng:sl;}this.updateIntervalPosition();this.updateRnsRne();}this.refreshChart(true,isDataSetChanged);itemClicked=false;this.hideMessage();},getTouchValue:function gtvlindx(x,y){var md=this.model,m=this.margin,currStatus=chartStatus[this.chartID];var sz=currStatus.rne-currStatus.rns>0?currStatus.rne-currStatus.rns>1?currStatus.rne-currStatus.rns:2:this.windowSize;var touchVal=Math.round(((x-m.l)*(sz-1))/(this.getChartWidthOnScreen()));return(touchVal<sz)?touchVal:null;},getNearestPoint:function getNP(touchX,touchY){var me=this,currStatus=chartStatus[this.chartID],margin=me.margin;var touchPointOnWidget=me.utils.getTouchXYOnWidget(touchX,touchY,me);touchX=touchPointOnWidget.touchX;touchY=touchPointOnWidget.touchY;if(touchX<margin.l||touchY<margin.t||touchY>me.canvas.height-margin.b){return ;}var xIndexOnScreen=this.getTouchValue(touchX,touchY);var rowIdx=xIndexOnScreen+currStatus.rns;var pointX=(xIndexOnScreen*me.RTX)+me.margin.l;var pointY,serieIdx;if(currStatus.isLegendSelected){serieIdx=currStatus.legendSelectedIndex;pointY=me.utils.getYValue(me,me.model.series[serieIdx].rv[rowIdx]);}else{var nearestPoint=me.utils.getSeriesIndexAndYValue(me,rowIdx,touchY);serieIdx=nearestPoint.si;pointY=nearestPoint.y;}return{rowIdx:rowIdx,serieIdx:serieIdx,point:{x:pointX,y:pointY}};},highlightPoint:function hghlghtpnt(x,touchX,touchY){var me=this,ctx=me.highlightContext,height=me.highlightCanvas.height,mg=me.margin,m=me.model,utils=me.utils,currStatus=chartStatus[this.chartID],si=currStatus.isLegendSelected?currStatus.legendSelectedIndex:me.seriesIndex;this.highlightCanvas.width=this.highlightCanvas.width;if(x<0){return ;}var xcoord=(x*me.RTX)+mg.l;ctx.strokeStyle=this.utils.rgb2rgbStr(this.formatProp.textClr);ctx.lineCap="round";ctx.lineWidth=2;ctx.globalAlpha=1;utils.drawLineSet(me,[{x:touchX,y:this._tooltip.domNode.offsetHeight},{x:touchX,y:height-mg.b}],false,ctx);ctx.fillStyle=ctx.strokeStyle;var s=m.series,l=s.length,rns=(currStatus.rns===0||currStatus.rne-currStatus.rns>1)?currStatus.rns:currStatus.rns-1,rowIdx=rns+x,y=utils.getYValue(me,s[si].rv[rowIdx]);if(!chartStatus[this.chartID].isLegendSelected){ctx.strokeStyle=me.getSerieColor(si);}ctx.fillStyle=ctx.strokeStyle;if(y>=mg.t&&y<=this.canvas.height-mg.b){utils.drawArc(me,xcoord,y,5,0,Math.PI*2,true,true,ctx);}this.lastHighlightPoint={rowIdx:rowIdx,serieIdx:si,point:{x:xcoord,y:y}};},hideTimeSelectorLabels:function htsl(){var lbls=this.domNode.getElementsByClassName("timeseries-intervals");for(var i=0;i<lbls.length;i++){lbls[i].style.display="none";}},showTimeSelectorLabels:function stsl(){var lbls=this.domNode.getElementsByClassName("timeseries-intervals");for(var i=0;i<lbls.length;i++){lbls[i].style.display="block";}},getFormattedDateForTooltip:function getFormattedDateForTooltip(val,isLongFormat){if(isNaN(val)){return val;}var fVal=val;try{val=this.utils.convertRawValueToMilliseconds(val);var dt=new Date(Number(val)),$_DT=mstrmojo.locales.datetime;var mn=isLongFormat?$_DT.MONTHNAME_FULL[dt.getMonth()]:$_DT.MONTHNAME_SHORT[dt.getMonth()];var yr=dt.getFullYear().toString();if(isLongFormat){fVal=mn+" "+dt.getDate()+", "+yr;}else{fVal=mn+"-"+dt.getDate()+"-"+yr.substring(2);}}catch(e){}return fVal;},showLegendTooltip:function showLegendTooltip(e){this._legendTooltip.updateContent(e);},hiddenLegendTooltip:function hiddenLegendTooltip(){this._legendTooltip&&this._legendTooltip.toggle(false);},getLegendName:function getLegendName(colHeaders,series,i){var colHLength=colHeaders.length;var hiLength=series[i].hi.length;if(colHLength<1){return"null";}if(hiLength==colHLength){var legendName="";for(var j=0;j<hiLength;j++){var colHeader=colHeaders[j];var colName="";if(colHeader.es){colName=colHeader.es[series[i].hi[j]];}else{colName=colHeader.items[series[i].hi[j]].n;}if(j>0){legendName+=" ";}if(colName!=""){legendName+=colName;}}return legendName;}else{var items=colHeaders[0].items;legendName=items[i%items.length].n;return legendName;}return"null";},getRowHeader:function getrh(idx){var me=this,m=me.model,riArray=m.ri,s=m.series,cat=m.categories,tp=cat.tp,currStatus=chartStatus[this.chartID],rowHs=m.rowHeaders,rowHLength=rowHs.length,rowHeader=[];var rVal=cat.items[idx];var ri=riArray&&riArray[idx];if(!ri){return rowHeader;}if(tp.toString()===me.DSS_XML_BASE_FORM_DATE){rVal=me.getFormattedDateForTooltip(rVal,true);var rowHeaderObj={};rowHeaderObj.n=rowHs[rowHLength-1].n;rowHeaderObj.v=rVal;rowHeader.push(rowHeaderObj);}else{for(var i=0;i<rowHLength;i++){var rowHeaderObj={};var rowH=rowHs[i];rowHeaderObj.n=rowH.n;rowHeaderObj.v=rowH.es[ri[i]]||"";rowHeader.push(rowHeaderObj);}}return rowHeader;},setMarginTopByTooltipHeight:function setMarginTopByTooltipHeight(){var me=this,m=me.model,mg=me.margin,s=m.series,colH=m.colHeaders;if(this._tooltip){this._tooltip.displayInfo([{n:"legendName",v:"val"},{n:"rowHeaderName",v:"rowHeaderValue"}]);this._tooltip.toggle(true);var height=this._tooltip.domNode.offsetHeight+10;this._tooltip.toggle(false);if(me.margin.t<height){me.margin.t=height;}}var stt=me.sliderTooltip,sttF=stt.firstChild,sttP=stt.lastChild;sttF.innerHTML="name: value";sttF.style.display="block";var sliderTooltipHeight=sttF.offsetHeight;me.sliderTooltipYPosition=me.getHeight()-me.masterChartHeight-sliderTooltipHeight-7+masterMargin.t;sttP.style.top=sliderTooltipHeight+"px";sttF.style.display="none";},renderTooltip:function rndrttp(valIndex,touchX,touchY){if(valIndex<0){this._tooltip.toggle(false);return ;}var me=this,m=me.model,mg=me.margin,s=m.series,currStatus=chartStatus[this.chartID],si=currStatus.isLegendSelected?currStatus.legendSelectedIndex:me.seriesIndex,rns=(currStatus.rns===0||currStatus.rne-currStatus.rns>1)?currStatus.rns:currStatus.rns-1,colH=m.colHeaders;var width=me.getWidth();if(!tooltipShown){me.hideTimeSelectorLabels();tooltipShown=true;var touchManager=mstrmojo.touchManager;this._touchListener=touchManager.attachEventListener("touchesBegin",this.id,function(evt){if(!isTouchedOnWidget.call(me,evt.touch)){me.hiddenTooltipAndShowTimeSelector();}});}var vIdx=rns+valIndex;var val=s[si].v[vIdx]?s[si].v[vIdx]:"null";var legendName=this.getLegendName(colH,s,si);var rowHeaders=this.getRowHeader(vIdx),rowHeaderName="",rowHeaderValue="";for(var i=0;i<rowHeaders.length;i++){rowHeaderName+=rowHeaders[i].n;rowHeaderValue+=rowHeaders[i].v;if(i<rowHeaders.length-1){rowHeaderName+=" ";rowHeaderValue+=" ";}}this._tooltip.displayInfo([{n:legendName,v:val},{n:rowHeaderName,v:rowHeaderValue}]);this._tooltip.toggle(true);this._tooltip.doLayout(width-10);var ttw=this._tooltip.domNode.offsetWidth,x=touchX-ttw/2;if(x<5){x=5;}else{if(x>width-5-ttw){x=width-5-ttw;}}this._tooltip.posTo({x:x,y:5});},handleTouchEnd:function handleTouchEnd(){this._super();this._tooltip&&this._tooltip.toggle(false);},showMessage:function shmsg(text){var msg=this.loadingMsg,mns=msg.style;msg.innerHTML=text||mstrmojo.desc(5674,"Loading...");mns.display="block";mns.opacity=1;var x=Math.round(this.getWidth()/2-msg.offsetWidth/2);var y=Math.round(this.getHeight()/2-msg.offsetHeight/2);this.utils.translateCSS(x,y,false,msg);},hideMessage:function hmsg(){this.loadingMsg.style.opacity=0;},showMasterSliderTooltip:function showMasterSliderTooltip(item){$CSS.addClass(item.node,"mstrmojo-timeseries-span-shadow");var stt=this.sliderTooltip;stt.firstChild.style.display="block";stt.lastChild.style.display="block";this.renderSliderTooltip(item.value==="L"?this.SLXP:this.SRXP);},unrender:function unrender(ignoreDom){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}if(this._legend){this._legend.destroy();delete this._legend;}if(this._timeSelector){this._timeSelector.destroy();delete this._timeSelector;}if(this._legendTooltip){this._legendTooltip.destroy();delete this._legendTooltip;}if(this._super){this._super(ignoreDom);}},refresh:function refresh(){var me=this;me.unrender();if(!me.model.processed){me.lastSelectedPoint=null;}me.render();},removeLabels:function rmvlbls(){var me=this;me.canvas.width=me.canvas.width;me.utils.fillBackground(me);me.xLabelsDiv.innerHTML="";var lbls=me.domNode.getElementsByClassName("mstrmojo-chart-ylbl-div")[0];if(lbls){lbls.innerHTML="";}},refreshChart:function refcht(isMetric,pld){var me=this,wd=me.getWidth(),ht=me.getHeight();if(me.model.err){return ;}me.highlightCanvas.width=wd;me.animationCanvas.width=me.animationCanvas.width;if(isMetric){me.context.clearRect(0,0,wd,ht);me.removeLabels();if(pld){me.data.processLinearData(me);}}me.drawChart();this.setAnimationCanvasContainer();me.drawLabels();localUpdateScrollerConfig.call(me);},timeSelectorOnClick:function hoc(item){var currStatus=chartStatus[this.chartID];if(!itemClicked){itemClicked=true;var me=this,v=item.value,node=item.node,intervalChanged=true;if(node===me.currSelection&&!currStatus.usingCustomInterval){itemClicked=false;return ;}if(v==="S"){if(currStatus.usingCustomInterval){currStatus.usingCustomInterval=false;}else{me.updateIntervalPosition();}if(me.currSelection){me._timeSelector.toggleSelected(me.currSelection,false);me._timeSelector.toggleGlowEffect(me.currSelection,false);}me._timeSelector.toggleSelected(node,true);me._timeSelector.toggleGlowEffect(node,true);var bm=me.baseModel,tslIndex=parseInt(node.getAttribute("value"));var tsl=bm.vp.rl[tslIndex];if((bm.k&&bm.k!==tsl.ds)&&me.layoutModel){var getData=resetBaseAndDerivedData.call(this,tsl);if(!getData){return ;}}else{isDataSetChanged=false;}intervalChanged=node!==me.currSelection;me.currSelection=node;currStatus.currSelectionIdx=me.currSelection.getAttribute("value");me.showMessage();window.setTimeout(function(){me.drawSelector(node,tsl,intervalChanged);},10);}}},moveMasterSlider:function moveMasterSlider(x){var me=this,m=me.model,width=me.getWidth(),delta=Math.round(x-originalTouchPosition),currStatus=chartStatus[this.chartID];this.SLXP+=delta;this.SRXP+=delta;this.SLXP=Math.round(this.SLXP);this.SRXP=Math.round(this.SRXP);this.makeSureMasterSliderNotBeyondTheMargin(true);this.setMasterSliderLayout();this.calculateRnsRneFromSXP(true);localUpdateScrollerConfig.call(me);if(!currStatus.usingCustomInterval&&this.currSelection){this.updateIntervalPosition();}},updateIntervalPosition:function updateIntervalPosition(){var me=this,m=me.model,currStatus=chartStatus[this.chartID];if(me.currSelection){var index=me.currSelection.getAttribute("value");currStatus.timeSelectedIntervalPosition[index]={rns:currStatus.rns,rne:currStatus.rne};}},drawSliderTooltipPointer:function drawSliderTooltipPointer(){var canvas=this.sliderTooltip.lastChild,cntx=canvas.getContext("2d"),width=canvas.width,height=canvas.height;cntx.fillStyle="#ffffff";cntx.beginPath();cntx.moveTo(0,0);cntx.lineTo(width,0);cntx.lineTo(width/2,height);cntx.lineTo(0,0);cntx.closePath();cntx.fill();},renderSliderTooltip:function renderSliderTooltip(sliderTooltipXPosition){var me=this,stt=me.sliderTooltip,sttF=stt.firstChild,sttP=stt.lastChild,width=me.getWidth();var pointerPos=sliderTooltipXPosition;var content=getFormattedDateForSliderTooltip.call(this,sliderTooltipXPosition);if(content==""){content="--";}sttF.innerHTML=content;var stWidth=sttF.offsetWidth,stHalfWidth=stWidth/2;if(sliderTooltipXPosition!==this.SLXP){sliderTooltipXPosition=this.SRXP-stHalfWidth;}else{sliderTooltipXPosition-=stHalfWidth;}if(sliderTooltipXPosition<0){sliderTooltipXPosition=0;}else{if(sliderTooltipXPosition+stWidth>width){sliderTooltipXPosition=width-stWidth;}}sttP.style.left=(pointerPos-sliderTooltipXPosition-3)+"px";me.utils.translateCSS(sliderTooltipXPosition,me.sliderTooltipYPosition,false,stt);},resizeMasterSlider:function resizeMasterSlider(x){var me=this,width=me.getWidth(),msl=me.masterSlider,msls=msl.style,lcs=msl.parentNode.firstChild.style,rcs=msl.parentNode.childNodes[2].style;var touchPoint=me.utils.getTouchXYOnWidget(x,0,me);x=touchPoint.touchX;var fixWhich;if(masterSliderClicked==="L"){this.SLXP=x;fixWhich="R";}else{this.SRXP=x;fixWhich="L";}me.makeSureMasterSliderNotBeyondTheMargin();me.makeSureMasterSliderNoOverlap(fixWhich);this.setMasterSliderLayout();if(masterSliderClicked==="L"){me.renderSliderTooltip(this.SLXP);}else{me.renderSliderTooltip(this.SRXP);}chartStatus[this.chartID].usingCustomInterval=true;chartSizeChanged=true;},shouldTouchBubble:function shouldTouchBubble(touch){return false;},hiddenTooltipAndShowTimeSelector:function hsctooltip(){if(tooltipShown){this.handleTouchEnd();tooltipShown=false;this.showTimeSelectorLabels();var touchManager=mstrmojo.touchManager;touchManager.detachEventListener(this._touchListener);delete this._touchListener;}},onCrossWidgetMultitouch:function onCrossWidgetMultitouch(){this.hiddenTooltipAndShowTimeSelector();},touchBegin:function touchBegin(touch){this.adjustWidgetOffsets();var item=this.isMasterSliderTouched(touch);if(item){this.hiddenTooltipAndShowTimeSelector();var value=item.value;if(value==="L"||value==="R"||value==="MS"){masterSliderClicked=item.value;originalTouchPosition=touch.pageX;if(item.value!=="MS"){this.showMasterSliderTooltip(item);}}else{return false;}}else{if(!isScrollableElementTouched.call(this,touch)){this.hiddenTooltipAndShowTimeSelector();if(this.shouldTouchBubble(touch)){return this.bubbleTouchEvent(touch);}return false;}}},isMasterSliderTouched:function isMasterSliderTouched(touch){var item=getTouchedElement.call(this,touch);if(item&&(item.value==="L"||item.value==="R")){return item;}var touchRadius=45*this.utils.getScreenZoomFactor();var position=this.utils.getTouchXYOnWidget(touch.pageX,touch.pageY,this);var touchX=position.touchX,touchY=position.touchY;var height=this.getHeight();if(touchY>height||touchY<height-this.masterChartHeight){return null;}if(touchX<this.SRXP&&touchX>this.SLXP){return{node:this.masterSlider.childNodes[1],value:"MS"};}var LDistance=Math.abs(touchX-this.SLXP);var RDistance=Math.abs(this.SRXP-touchX);var minDistance=Math.min(LDistance,RDistance);if(minDistance<touchRadius){if(LDistance==minDistance){return{node:this.masterSlider.firstChild,value:"L"};}else{if(RDistance==minDistance){return{node:this.masterSlider.lastChild,value:"R"};}}}else{return null;}return null;},touchSelectBegin:function touchSelectBegin(touch){this.hiddenTooltipAndShowTimeSelector();var item=this.isMasterSliderTouched(touch);if(item){if(item.value==="L"||item.value==="R"||item.value==="MS"){masterSliderClicked=item.value;originalTouchPosition=touch.pageX;}}else{this.handleTouchBegin(touch.pageX,touch.pageY);}},touchSelectMove:function touchSelectMove(touch){if(masterSliderClicked){if(masterSliderClicked==="MS"){this.moveMasterSlider(touch.pageX);}else{this.resizeMasterSlider(touch.pageX);}originalTouchPosition=touch.pageX;return false;}this.handleTouchMove(touch.pageX,touch.pageY);},handleTouchSelectEnd:function handleTouchSelectEnd(touch){if(masterSliderClicked){if(masterSliderClicked==="MS"){this.makeSureSliderOnPoint();this.setMasterSliderLayout();this.incFetchChart();}else{resizeMasterSliderDone.call(this);}return false;}var canBeSelected=false;if(touch){var nearestPoint=this.getLastHighlightPoint();canBeSelected=nearestPoint&&this.pointCanBeSelected(nearestPoint.rowIdx,nearestPoint.serieIdx);}if(!canBeSelected){this.handleTouchEnd();if(tooltipShown){tooltipShown=false;this.showTimeSelectorLabels();}}else{this.seriesIndex=-1;}this.hiddenLegendTooltip();},touchSelectEnd:function touchSelectEnd(touch){this.handleTouchSelectEnd(touch);},touchMultiBegin:function touchMultiBegin(touch){this.handleTouchSelectEnd();},touchSwipeMove:function touchSwipeMove(touch){if(isScrollableElementTouched.call(this,touch)&&this._super){this._super(touch);}else{if(masterSliderClicked){if(masterSliderClicked==="MS"){this.moveMasterSlider(touch.pageX);}else{this.resizeMasterSlider(touch.pageX);}originalTouchPosition=touch.pageX;}}},touchSwipeEnd:function touchSwipeEnd(touch){if(masterSliderClicked){if(masterSliderClicked==="MS"){this.makeSureSliderOnPoint();this.setMasterSliderLayout();this.incFetchChart();}else{resizeMasterSliderDone.call(this);}return false;}else{if(this._super){this._super(touch);}}},touchSelectCancel:function touchSelectCancel(touch){this.touchCancel(touch);},touchCancel:function touchCancel(touch){this.touchSelectEnd(touch);},touchEnd:function touchEnd(touch){if(masterSliderClicked&&!chartSizeChanged){hideMasterSliderTooltip.call(this);masterSliderClicked=null;}this._legend.hiddenSwitcherArrowGlowEffect();return false;},pointCanBeSelected:function pcbs(rowIdx,serieIdx){if(this.selectionOrLinkdrillOnRow){return true;}var me=this,m=me.model,colHeaders=m.colHeaders,colHL=colHeaders.length,hi=m.series[serieIdx].hi,hiLength=hi.length;for(var i=0;i<colHL;i++){var colH=colHeaders[i];if(colH.es){if(colH.sc&&colH.sc.tks){return true;}if(colH.lm&&colH.lm[0]&&colH.lm[0].links){return true;}}else{if(colH.sc&&colH.sc.tks){return true;}var lmArray=colH.lm,lm=lmArray&&lmArray[hi[i]];if(lm&&lm.links){return true;}}}return false;},getModelK:function getModelK(){var k=this.baseModel&&this.baseModel.k;return k;},getActionObjList:function getActionObjList(nearestPoint,selectedAll){var actionObjList=[];var scObjList=[];var actionType=0;var actionObjList=[];var linkDrillNode=null;var metricColHIdx=-1;var me=this,model=me.model,riArray=model.ri,ri=riArray[nearestPoint.rowIdx],rowHeaders=model.rowHeaders,rowHL=rowHeaders.length;for(var i=0;i<rowHL;i++){var rowH=rowHeaders[i];if(rowH.sc&&rowH.sc.tks){if(selectedAll&&(rowH.sc.all==="false"||rowH.sc.all===false)){return null;}var scObj={};scObj.sc=rowH.sc;scObj.es=rowH.es[ri[i]];scObj.eid=selectedAll?"OA:(All)":rowH.eid[ri[i]];scObjList.push(scObj);actionType=rowH.at||0;}if(rowH.lm&&rowH.lm[0]&&rowH.lm[0].links&&!linkDrillNode){linkDrillNode={};linkDrillNode.titleInfo=rowH;linkDrillNode._e={id:rowH.eid[ri[i]],n:rowH.es[ri[i]]};}}var colHeaders=model.colHeaders,colHL=colHeaders.length,hi=model.series[nearestPoint.serieIdx].hi,hiLength=hi.length;for(var i=colHL-1;i>=0;i--){var colH=colHeaders[i];if(colH.es){if(colH.sc&&colH.sc.tks){if(selectedAll&&(colH.sc.all==="false"||colH.sc.all===false)){return null;}var scObj={};scObj.sc=colH.sc;scObj.es=colH.es[hi[i]];scObj.eid=selectedAll?"OA:(All)":colH.eid[hi[i]];scObjList.push(scObj);actionType=colH.at||0;}if(colH.lm&&colH.lm[0]&&colH.lm[0].links&&!linkDrillNode){linkDrillNode={};linkDrillNode.titleInfo=colH;linkDrillNode._e={id:colH.eid[hi[i]],n:colH.es[hi[i]]};}}else{if(colH.sc&&colH.sc.tks){if(selectedAll&&(colH.sc.all==="false"||colH.sc.all===false)){return null;}var scObj={};scObj.sc=colH.sc;scObj.es=colH.items[hi[i]].n;scObj.eid=selectedAll?"OA:(All)":colH.items[hi[i]].id;scObjList.push(scObj);actionType=colH.at||0;}metricColHIdx=i;}}if(scObjList.length>0){actionType=actionType|SELECTOR_ACTION;this.infoWindowAnchor.style.left=(nearestPoint.point.x-9)+"px";this.infoWindowAnchor.style.top=(nearestPoint.point.y-9)+"px";actionObjList.push({at:actionType,k:this.getModelK(),scObjList:scObjList,anchor:this.infoWindowAnchor});return actionObjList;}if(!linkDrillNode){var metricH=colHeaders[metricColHIdx],metric=metricH.items[hi[metricColHIdx]],lm=metricH.lm[hi[metricColHIdx]];if(lm&&lm.links){linkDrillNode={};linkDrillNode.titleInfo=metricH;linkDrillNode.mix=hi[metricColHIdx];var currNode=linkDrillNode;for(var i=0;i<rowHL;i++){var rowH=rowHeaders[i];var nodeLP={};nodeLP.titleInfo=rowH;nodeLP._e={id:rowH.eid[ri[i]],n:rowH.es[ri[i]]};currNode._lp=nodeLP;currNode.axis=ROW_AXIS;currNode=nodeLP;}currNode=linkDrillNode;for(var i=colHL-1;i>=0;i--){var colH=colHeaders[i];if(colH.es){var nodeTP={};nodeTP.titleInfo=colH;nodeTP._e={id:colH.eid[hi[i]],n:colH.es[hi[i]]};currNode._tp=nodeTP;currNode.axis=COL_AXIS;currNode=nodeTP;}}}}if(linkDrillNode){actionType=actionType|HYPERLINK_ACTION;actionObjList.push({at:actionType,k:this.getModelK(),node:linkDrillNode});return actionObjList;}return null;},getLastHighlightPoint:function gtLstHighlightPnt(){return this.lastHighlightPoint||null;},performAction:function performAction(actionObjList){this.hasNonifwTarget=this.hasNoninfowindowTarget(actionObjList[0]);if(this._super){this._super(actionObjList);}},touchTap:function touchTap(touch){var me=this,nearestPoint=this.getLastHighlightPoint(),touchPointOnWidget=me.utils.getTouchXYOnWidget(touch.pageX,touch.pageY,me);var touchPointInHighlightArea=tooltipShown&&getPointDistanceSquare({x:nearestPoint.point.x,y:nearestPoint.point.y},{x:touchPointOnWidget.touchX,y:touchPointOnWidget.touchY})<=45*45;if(touchPointInHighlightArea){me.hiddenTooltipAndShowTimeSelector();nearestPoint=this.getLastHighlightPoint();}else{nearestPoint=this.getNearestPoint(touch.pageX,touch.pageY);}if(isScrollableElementTouched.call(this,touch)){var fallInPointArea=getPointDistanceSquare({x:nearestPoint.point.x,y:nearestPoint.point.y},{x:touchPointOnWidget.touchX,y:touchPointOnWidget.touchY})<=45*45,canBeSelected=me.pointCanBeSelected(nearestPoint.rowIdx,nearestPoint.serieIdx),sameAsLastSelectedPoint=me.lastSelectedPoint&&(nearestPoint.rowIdx==me.lastSelectedPoint.rowIdx&&nearestPoint.serieIdx==me.lastSelectedPoint.serieIdx);if(fallInPointArea&&canBeSelected&&!sameAsLastSelectedPoint){if(tooltipShown){me.hiddenTooltipAndShowTimeSelector();}me.lastSelectedPoint=nearestPoint;me.incFetchChart(true);var actionObjList=this.getActionObjList(nearestPoint);me.performAction(actionObjList);}else{if(fallInPointArea&&!canBeSelected){if(touchPointInHighlightArea){}else{this.handleTouchBegin(touch.pageX,touch.pageY);}}else{if(tooltipShown){me.hiddenTooltipAndShowTimeSelector();}else{if(me.lastSelectedPoint){var actionObjList=this.getActionObjList(nearestPoint,true);if(actionObjList){me.performAction(actionObjList);me.lastSelectedPoint=null;me.incFetchChart(true);}}}}}}},highlightSelectedPoint:function highlightSelectedPoint(){var me=this,ctx=me.animationContext,utils=me.utils,pointInfo=me.lastSelectedPoint,point=pointInfo.point,currStatus=chartStatus[this.chartID];ctx.save();if(currStatus.isLegendSelected&&currStatus.legendSelectedIndex!=pointInfo.serieIdx){ctx.globalAlpha=0.3;}else{ctx.globalAlpha=1;}var pointX=(pointInfo.rowIdx-me.ACrns)*me.RTX;ctx.fillStyle=me.getSerieColor(pointInfo.serieIdx);ctx.lineWidth=1;utils.drawArc(me,pointX,point.y,4,0,Math.PI*2,true,true,ctx);if(this.theme==LIGHT_THEME){ctx.strokeStyle="#ffffff";ctx.lineWidth=2;utils.drawArc(me,pointX,point.y,5,0,Math.PI*2,true,false,ctx);ctx.strokeStyle="#000000";ctx.lineWidth=2;utils.drawArc(me,pointX,point.y,7,0,Math.PI*2,true,false,ctx);}else{ctx.strokeStyle="#333333";ctx.lineWidth=2;utils.drawArc(me,pointX,point.y,5,0,Math.PI*2,true,false,ctx);ctx.strokeStyle="#ffffff";ctx.lineWidth=2;utils.drawArc(me,pointX,point.y,7,0,Math.PI*2,true,false,ctx);}ctx.restore();},destroy:function destroy(){if(this.currSelection){delete this.currSelection;}if(this._touchListener){mstrmojo.touchManager.detachEventListener(this._touchListener);delete this._touchListener;}if(this._scrollDoneListener){this._scroller.detachEventListener(this._scrollDoneListener);delete this._scrollDoneListener;}if(this._scrollMovedListener){this._scroller.detachEventListener(this._scrollMovedListener);delete this._scrollMovedListener;}if(this._infoWClosedListener){this.xtabModel.docModel.detachEventListener(this._infoWClosedListener);delete this._infoWClosedListener;}if(this.fullScreenListener){mstrmojo.touchManager.detachEventListener(this.fullScreenListener);delete this.fullScreenListener;}if(this.selectorTargets){delete this.selectorTargets;}this._super();if(this._tn){delete this._tn;}}});})();