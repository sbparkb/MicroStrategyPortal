(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.WidgetMatrixForAndroid","mstrmojo.array");function makeCompleteArray(n){var i,arr=[];arr.length=n;for(i=0;i<n;i++){arr[i]=i;}return arr;}function performAction(fName){var i,master=this.master,hSlaves=this.hSlaves,vSlaves=this.vSlaves,hCount=hSlaves.length,vCount=vSlaves.length;for(i=0;i<hCount;i+=1){hSlaves[i][fName]();}for(i=0;i<vCount;i+=1){vSlaves[i][fName]();}if(master){master[fName]();}}function getRelevantRows(rule){var i,node,slaves=this.vSlaves,n=slaves.length,indices=makeCompleteArray(this.nRows);for(i=0;i<n;i++){node=slaves[i];if(node===this.yAxis||node===this.yAxis2){continue;}indices=node.filterRelevantRows(indices,rule);}return indices;}function getRelevantCols(rule){var i,node,slaves=this.hSlaves,n=slaves.length,indices=makeCompleteArray(this.nCols);for(i=0;i<n;i++){node=slaves[i];if(node===this.xAxis||node===this.xAxis2){continue;}indices=node.filterRelevantCols(indices,rule);}return indices;}function filterShapesOnSingleRule(selectionRule,selectedShapes){var i,j,m,n,rIndices,cIndices,master=this.master;if(this.GMController.checkAttributeIntersection(selectionRule,["Rows","Columns","XAxis","YAxis"]).length>0){rIndices=getRelevantRows.call(this,selectionRule);cIndices=getRelevantCols.call(this,selectionRule);}else{rIndices=[];cIndices=[];}for(i=0,m=rIndices.length;i<m;i++){for(j=0,n=cIndices.length;j<n;j++){if(master.filterShapes){master.filterShapes(selectedShapes,rIndices[i],cIndices[j],selectionRule);}}}}function filterChartsByRow(rule,selectedCharts){var i,j,node,results,slaves=this.vSlaves,n=slaves.length;for(i=0;i<n;i++){node=slaves[i];if(node===this.yAxis||node===this.yAxis2){continue;}results=node.filterChartsByRow(rule,i);if(results){for(j=0;j<results.length;j++){selectedCharts.push(results[j]);}return true;}}return false;}function filterChartsByCol(rule,selectedCharts){var i,j,node,results,slaves=this.hSlaves,n=slaves.length;for(i=0;i<n;i++){node=slaves[i];if(node===this.xAxis||node===this.xAxis2){continue;}results=node.filterChartsByCol(rule,i);if(results){for(j=0;j<results.length;j++){selectedCharts.push(results[j]);}return true;}}return false;}mstrmojo.WidgetMatrixManagerForAndroid=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.WidgetMatrixManagerForAndroid",isAsynchronous:false,widthScale:1,heightScale:1,hSlaves:null,vSlaves:null,yAxis:undefined,yAxis2:undefined,xAxis:undefined,xAxis2:undefined,master:undefined,hArr:null,wArr:null,hAccArr:null,wAccArr:null,widthCache:null,heightCache:null,API:null,GMController:null,init:function(props){if(this._super){this._super(props);}this.hArr=[];this.wArr=[];this.hAccArr=[];this.wAccArr=[];this.widthCache=[];this.heightCache=[];this.hSlaves=[];this.vSlaves=[];this.API={getChartWidth:undefined,getChartHeight:undefined};},setDimensions:function(nRows,nCols,avgColWidth,avgRowHeight){var i,heightCache=this.heightCache,widthCache=this.widthCache;this.nRows=nRows;this.nCols=nCols;this.chartW=avgColWidth;this.chartH=avgRowHeight;for(i=0;i<nRows;i+=1){heightCache[i]=avgRowHeight;}for(i=0;i<nCols;i+=1){widthCache[i]=avgColWidth;}},enableXSplitter:function(flag){var x=this.xAxis,x2=this.xAxis2;if(x){x.enableSplitter(flag);}if(x2){x2.enableSplitter(flag);}},enableYSplitter:function(flag){var y=this.yAxis,y2=this.yAxis2;if(y){y.enableSplitter(flag);}if(y2){y2.enableSplitter(flag);}},enableRowHeaderSplitter:function(flag){var i,n,item,vs=this.vSlaves;for(i=0,n=vs.length;i<n;i++){item=vs[i];if(item===this.yAxis||item===this.yAxis2){continue;}item.enableSplitter(flag);}},enableColHeaderSplitter:function(flag){var i,n,item,hs=this.hSlaves;for(i=0,n=hs.length;i<n;i++){item=hs[i];if(item===this.xAxis||item===this.xAxis2){continue;}item.enableSplitter(flag);}},enableInChartRowSplitter:function(flag){var i,n,vs=this.vSlaves;for(i=0,n=vs.length;i<n;i++){vs[i].enableRowSplitter(flag);}this.master.enableRowSplitter(flag);},enableInChartColSplitter:function(flag){var i,n,hs=this.hSlaves;for(i=0,n=hs.length;i<n;i++){hs[i].enableColSplitter(flag);}this.master.enableColSplitter(flag);},doUpdateInChartSplitters:function(doRow,doCol){this.master.doUpdateInChartSplitters(true,true);var i,n,vs=this.vSlaves,hs=this.hSlaves;for(i=0,n=vs.length;i<n;i++){vs[i].doUpdateInChartSplitters(doRow,doCol);}for(i=0,n=hs.length;i<n;i++){hs[i].doUpdateInChartSplitters(doRow,doCol);}},binding:function(){var i,node,me=this,master=this.master,hSlaves=this.hSlaves,vSlaves=this.vSlaves,hsCount=hSlaves.length,vsCount=vSlaves.length,API=this.API;if(!master){return ;}if(!API.getChartWidth){API.getChartWidth=function(rowIdx,colIdx){var k,start,end,sum=0,widthCache=me.widthCache;if(colIdx instanceof Array){start=colIdx[0];end=colIdx[1];}else{start=colIdx;end=colIdx+1;}for(k=start;k<end;k++){sum+=widthCache[k];}return sum;};}if(!API.getChartHeight){API.getChartHeight=function(rowIdx,colIdx){var k,start,end,sum=0,heightCache=me.heightCache;if(rowIdx instanceof Array){start=rowIdx[0];end=rowIdx[1];}else{start=rowIdx;end=rowIdx+1;}for(k=start;k<end;k++){sum+=heightCache[k];}return sum;};}for(i=0;i<hsCount;i+=1){node=hSlaves[i];node.wArr=master.wArr;node.wAccArr=master.wAccArr;node.offset.x=master.offset.x;node.API.getChartWidth=API.getChartWidth;node.API.getChartHeight=API.getChartHeight;}for(i=0;i<vsCount;i+=1){node=vSlaves[i];node.hArr=master.hArr;node.hAccArr=master.hAccArr;node.offset.y=master.offset.y;node.API.getChartWidth=API.getChartWidth;node.API.getChartHeight=API.getChartHeight;}this.master.API.getChartWidth=API.getChartWidth;this.master.API.getChartHeight=API.getChartHeight;},updateHSlaves:function(){if(!this.master){return ;}var i,node,master=this.master,origin=master.origin,width=master.domCanvas.offsetWidth,hSlaves=this.hSlaves,hsCount=hSlaves.length;for(i=0;i<hsCount;i++){node=hSlaves[i];node.updateHLayout(width,origin.x);node.updateActiveCharts();node.updateCharts();}},updateVSlaves:function(){if(!this.master){return ;}var i,node,master=this.master,origin=master.origin,height=master.domCanvas.offsetHeight,vSlaves=this.vSlaves,vsCount=vSlaves.length;for(i=0;i<vsCount;i++){node=vSlaves[i];node.updateVLayout(height,origin.y);node.updateActiveCharts();node.updateCharts();}},isVSlaveNodeValid:function(node,type,metricNamesOnYAxis){var ret=(node===this.yAxis2)||(node===this.yAxis&&!metricNamesOnYAxis);if(type==="row"){return !ret;}return ret;},isHSlaveNodeValid:function(node,type,metricNamesOnXAxis){var ret=(node===this.xAxis)||(node===this.xAxis2&&!metricNamesOnXAxis);if(type==="column"){return !ret;}return ret;},updateSubSetOfVSlaves:function(type,metricNamesOnYAxis){if(!this.master){return ;}var i,node,master=this.master,origin=master.origin,height=master.domCanvas.offsetHeight,vSlaves=this.vSlaves,vsCount=vSlaves.length;for(i=0;i<vsCount;i++){node=vSlaves[i];if(this.isVSlaveNodeValid(node,type,metricNamesOnYAxis)){node.updateVLayout(height,origin.y);node.updateActiveCharts();}}},updateSubSetOfHSlaves:function(type,metricNamesOnXAxis){if(!this.master){return ;}var i,node,master=this.master,origin=master.origin,width=master.domCanvas.offsetWidth,hSlaves=this.hSlaves,hsCount=hSlaves.length;for(i=0;i<hsCount;i++){node=hSlaves[i];if(this.isHSlaveNodeValid(node,type,metricNamesOnXAxis)){node.updateHLayout(width,origin.x);node.updateActiveCharts();}}},drawCharts:function(){var master=this.master;if(!master){return ;}master.updateGrid();this.updateHSlaves();this.updateVSlaves();master.updateCharts();},dismissLassoSelector:function(){performAction.call(this,"dismissLassoSelector");},updateXYAxis:function(){var xAxis=this.xAxis,xAxis2=this.xAxis2,yAxis=this.yAxis,yAxis2=this.yAxis2;if(xAxis){xAxis.clearCharts();xAxis.updateCharts();}if(xAxis2){xAxis2.clearCharts();xAxis2.updateCharts();}if(yAxis){yAxis.clearCharts();yAxis.updateCharts();}if(yAxis2){yAxis2.clearCharts();yAxis2.updateCharts();}},scrollTo:function(x,y){var master=this.master;if(!master){return ;}master.scrollTo(x,y);this.translateHSlaves(x);this.translateVSlaves(y);},translateHSlaves:function(x){var i,hSlaves=this.hSlaves,hsCount=hSlaves.length;for(i=0;i<hsCount;i+=1){hSlaves[i].scrollTo(x,undefined);}},translateVSlaves:function(y){var i,vSlaves=this.vSlaves,vsCount=vSlaves.length;for(i=0;i<vsCount;i+=1){vSlaves[i].scrollTo(undefined,y);}},feedChartWidthInfo:function(widthCache){var master=this.master;if(!master){return ;}master.resetHGrid();var i,value,nCols=this.nCols,target=this.widthCache,widthArr=master.wArr;target.length=0;target.length=nCols;for(i=0;i<nCols;i++){value=widthCache[i];if(value){target[i]=value;widthArr[i]=value;}else{target[i]=this.chartW;}}master.initAccWidth();},feedChartHeightInfo:function(heightCache){var master=this.master;if(!master){return ;}master.resetVGrid();var i,value,nRows=this.nRows,target=this.heightCache,heightArr=master.hArr;target.length=0;target.length=nRows;for(i=0;i<nRows;i++){value=heightCache[i];if(value){target[i]=value;heightArr[i]=value;}else{target[i]=this.chartH;}}master.initAccHeight();},resizeBorder:function(source,deltaX,deltaY){var master=this.master;if(!master){return ;}var i,nRows=source.nRows,nCols=source.nCols,percent,affectedRows=[],affectedCols=[],deltas=[],totalHeight=0,totalWidth=0;if(!!deltaY){for(i=0;i<nRows;i++){totalHeight+=source.getRowHeight(i);}percent=deltaY/totalHeight;this.heightScale*=(1+percent);for(i=0;i<nRows;i++){if(source.hArr[i]!==undefined){affectedRows.push(i);deltas.push(source.getMiniChartHeight(i,0)-source.getRowHeight(i));}else{source.hArr[i]=source.getMiniChartHeight(i,0);}}master.resizeRow(affectedRows,deltas);source.updateAccHeight(0,nRows-1);master.adjustOriginIfNeeded();this.raiseEvent({name:"MiniChartResized",chartHeightScale:this.heightScale});}if(!!deltaX){for(i=0;i<nCols;i++){totalWidth+=source.getColWidth(i);}percent=deltaX/totalWidth;this.widthScale*=(1+percent);for(i=0;i<nCols;i++){if(source.wArr[i]!==undefined){affectedCols.push(i);deltas.push(source.getMiniChartWidth(0,i)-source.getColWidth(i));}else{source.wArr[i]=source.getMiniChartWidth(0,i);}}this.master.resizeCol(affectedCols,deltas);source.updateAccWidth(0,nCols-1);master.adjustOriginIfNeeded();this.raiseEvent({name:"MiniChartResized",chartWidthScale:this.widthScale});}master.doUpdateChartsGlobally();this.raiseEvent({name:"UpdateSelections"});},resizeRow:function(source,idx,delta){var master=this.master;if(!master){return ;}var i,nRows=source.nRows,rowSpan=source.API.getRowSpan(idx,source.depth),rowHeight=source.getRowHeight(rowSpan),percent=delta/rowHeight,affectedRows=[],deltas=[];this.heightScale*=(1+percent);for(i=0;i<nRows;i++){if(source.hArr[i]!==undefined){affectedRows.push(i);deltas.push(source.getMiniChartHeight(i,0)-source.getRowHeight(i));}else{source.hArr[i]=source.getMiniChartHeight(i,0);}}master.resizeRow(affectedRows,deltas);source.updateAccHeight(0,nRows-1);master.adjustOriginIfNeeded();this.raiseEvent({name:"MiniChartResized",chartHeightScale:this.heightScale});master.doUpdateChartsGlobally();this.raiseEvent({name:"UpdateSelections"});},resizeCol:function(source,idx,delta){var master=this.master;if(!master){return ;}var i,nCols=source.nCols,colSpan=source.API.getColSpan(idx,source.depth),colWidth=source.getColWidth(colSpan),percent=delta/colWidth,affectedCols=[],deltas=[];this.widthScale*=(1+percent);for(i=0;i<nCols;i++){if(source.wArr[i]!==undefined){affectedCols.push(i);deltas.push(source.getMiniChartWidth(0,i)-source.getColWidth(i));}else{source.wArr[i]=source.getMiniChartWidth(0,i);}}this.master.resizeCol(affectedCols,deltas);source.updateAccWidth(0,nCols-1);this.master.adjustOriginIfNeeded();this.raiseEvent({name:"MiniChartResized",chartWidthScale:this.widthScale});this.master.doUpdateChartsGlobally();this.raiseEvent({name:"UpdateSelections"});},resizeMiniCharts:function(scaleFactor){var me=this;me.chartWidthScale=scaleFactor;me.chartHeightScale=scaleFactor;me.master.resizeMiniCharts(scaleFactor);},resizeRowCol:function(source,idx,scaleFactor){var master=this.master;if(!master){return ;}var i,nCols=source.nCols,colSpan=source.API.getColSpan(idx,source.depth),colWidth=source.getColWidth(colSpan),affectedCols=[],colDeltas=[],nRows=source.nRows,rowSpan=source.API.getRowSpan(idx,source.depth),rowHeight=source.getRowHeight(rowSpan),affectedRows=[],rowDeltas=[];this.widthScale=scaleFactor;this.heightScale=scaleFactor;for(i=0;i<nRows;i++){if(source.hArr[i]!==undefined){affectedRows.push(i);rowDeltas.push(source.getMiniChartHeight(i,0)-source.getRowHeight(i));}}for(i=0;i<nCols;i++){if(source.wArr[i]!==undefined){affectedCols.push(i);colDeltas.push(source.getMiniChartWidth(0,i)-source.getColWidth(i));}}this.master.resizeCol(affectedCols,colDeltas);this.master.resizeRow(affectedRows,rowDeltas);this.master.adjustOriginIfNeeded();this.raiseEvent({name:"MiniChartResized",chartWidthScale:this.widthScale,chartHeightScale:this.heightScale});this.master.doUpdateChartsGlobally();this.raiseEvent({name:"UpdateSelections"});},toggleClsByRows:function(rowStart,rowEnd,depth,flag,cls){if(flag===undefined){flag=true;}var i,master=this.master,vs=this.vSlaves,vsCount=vs.length;for(i=depth;i<vsCount;i++){vs[i].toggleClsByRows(rowStart,rowEnd,flag,cls);}if(master){master.toggleClsByRows(rowStart,rowEnd,flag,cls);}},toggleClsByCols:function(colStart,colEnd,depth,flag,cls){if(flag===undefined){flag=true;}var i,master=this.master,hs=this.hSlaves,hsCount=hs.length;for(i=depth;i<hsCount;i++){hs[i].toggleClsByCols(colStart,colEnd,flag,cls);}if(master){master.toggleClsByCols(colStart,colEnd,flag,cls);}},intersectCheck4Row:function(height){return this.master.doRowIntersectionCheck(0,height,true);},intersectCheck4Col:function(width){return this.master.doColIntersectionCheck(0,width,true);},getRowStartDepth:function(row){var i,item,rowSpan,vs=this.vSlaves,vsCount=vs.length;for(i=0;i<vsCount;i++){item=vs[i];if(item===this.yAxis||item===this.yAxis2){break;}rowSpan=item.API.getRowSpan(row,i);if(rowSpan[1]===row){return i;}}return i;},getColStartDepth:function(col){var i,item,colSpan,hs=this.hSlaves,hsCount=hs.length;for(i=0;i<hsCount;i++){item=hs[i];if(item===this.xAxis||item===this.xAxis2){break;}colSpan=item.API.getColSpan(col,i);if(colSpan[1]===col){return i;}}return i;},getRowOffset:function(row){var master=this.master;return master.getRowPosition(row)-master.origin.y;},getColOffset:function(col){var master=this.master;return master.getColPosition(col)-master.origin.x;},getRowHeight:function(row){return this.master.getRowHeight(row);},getColWidth:function(col){return this.master.getColWidth(col);},filterCharts:function(selections){var i,n,key,rule,selectedCharts=[];if(selections.constructor===Array){n=selections.length;for(i=0;i<n;i++){rule=selections[i];delete rule.hashKey;if(!filterChartsByRow.call(this,rule,selectedCharts)){filterChartsByCol.call(this,rule,selectedCharts);}}}else{for(key in selections){if(selections.hasOwnProperty(key)){rule=selections[key];if(!filterChartsByRow.call(this,rule,selectedCharts)){filterChartsByCol.call(this,rule,selectedCharts);}}}}return selectedCharts;},filterShapes:function(selections){var i,n,key,selectedShapes=[];if(selections.constructor===Array){n=selections.length;for(i=0;i<n;i++){delete selections[i].hashKey;filterShapesOnSingleRule.call(this,selections[i],selectedShapes);}}else{for(key in selections){if(selections.hasOwnProperty(key)){filterShapesOnSingleRule.call(this,selections[key],selectedShapes);}}}return selectedShapes;},resize:function(dx,dy){var i,n,master=this.master,hSlaves=this.hSlaves,vSlaves=this.vSlaves;if(dx===undefined){dx=0;}if(dy===undefined){dy=0;}if(dx!==0){n=hSlaves.length;for(i=0;i<n;i++){hSlaves[i].resize(dx,0);}}if(dy!==0){n=vSlaves.length;for(i=0;i<n;i++){vSlaves[i].resize(0,dy);}}if(dx!==0||dy!==0){master.resize(dx,dy);}},queryRowHeight:function(i){var me=this,master=this.master,updateRowHeight=function(i,h){if(master.isRowInSight(i)){me.resizeRow(me.master,i,h);me.doUpdateChartsGlobally();}};},queryColWidth:function(i){var me=this,master=this.master,updateColWidth=function(i,w){if(master.isColInSight(i)){me.resizeCol(me.master,i,w);me.doUpdateChartsGlobally();}};},queryMiniChart:function(i,j){var master=this.master,updateMiniChart=function(i,j){if(master.isRowInSight(i)&&master.isColInSight(j)){master.doUpdateCharts(i,i,j,j);}};},queryYAxis:function(i){var yAxis=this.yAxis,updateYAxis=function(i){yAxis.doUpdateCharts(i,i,0,0);};},queryXAxis:function(j){var xAxis=this.xAxis,updateXAxis=function(j){xAxis.doUpdateCharts(0,0,j,j);};},queryRowHeader:function(i,depth){var rh=this.vSlaves[depth],updateRowHeader=function(i){rh.doUpdateCharts(i,i,0,0);};},queryColHeader:function(j,depth){var ch=this.hSlaves[depth],updateColHeader=function(j){ch.doUpdateCharts(0,0,j,j);};},queryRowSpan:function(i){var me=this,master=this.master,vs=this.vSlaves,n=vs.length,updateRowSpan=function(i){var k;for(k=0;k<n-1;k+=1){vs[k].doUpdateCharts(i,i,0,0);}};},queryColSpan:function(j){var hs=this.hSlaves,n=hs.length,updateColSpan=function(){var k;for(k=0;k<n-1;k+=1){hs[k].doUpdateCharts(0,0,j,j);}};}});}());