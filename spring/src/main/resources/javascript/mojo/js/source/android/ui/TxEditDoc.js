(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.android.SimpleList","mstrmojo.OfflineTransactionModel");var EnumTxType=mstrmojo.OfflineTransactionModel,PENDING=EnumTxType.PENDING,FAILED=EnumTxType.FAILED;mstrmojo.android.ui.TxEditDoc=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.android.ui.TxEditDoc",markupString:'<div id="{@id}" class="mstrmojo-TxEditDoc {@cssClass}" style="{@cssText}"><div></div><div></div><div></div></div>',markupSlots:{typeNode:function(){return this.domNode.firstChild;},txNode:function(){return this.domNode.childNodes[1];},btmNode:function(){return this.domNode.lastChild;}},model:null,docDid:null,children:[{scriptClass:"mstrmojo.android.SimpleList",alias:"txList",slot:"txNode",cssClass:"txList",postselectionChange:function(evt){var added=evt.added,idx=added&&added[0],transactionView=this.parent.parent;if(transactionView){transactionView.enableButtons(idx!==null);}}}],addChildren:function addChildren(children,idx,silent){children=children.concat([mstrApp.viewFactory.newView("TransactionsTypeList",{alias:"typeList",slot:"typeNode",cssClass:"txTypeList",selectionPolicy:"reselect",postselectionChange:function(evt){var added=evt.added,idx=added&&added[0];if(idx!==null){var txItems=[],parent=this.parent;mstrmojo.array.forEach(this.parent._tx[idx?FAILED:PENDING],function(item,idx){txItems.push({n:item.n,v:item.timestamp,idx:idx});});parent.txList.set("items",txItems);parent.typeSelected(idx);}}})]);this._super(children,idx,silent);},getType:function getType(){return this.typeList.selectedIndex;},setType:function setType(type){this.typeList.singleSelect(type);},getSelectedTx:function getSelectedTx(){return this.txList.getSelectedItems()[0];},typeSelected:mstrmojo.emptyFn,generateTypeList:function generateTypeList(defaultSelect){var docID=this.docID;if(!docID){return ;}var model=this.model,txs=(model&&model.docsTx)||[],documentTxs=txs[docID],pendingItems=[],failedItems=[];if(documentTxs){pendingItems=documentTxs[PENDING];failedItems=documentTxs[FAILED];}var tx=this._tx={};tx[PENDING]=pendingItems;tx[FAILED]=failedItems;var typeList=this.typeList,selectedIdx=Math.max(typeList.selectedIndex,0);typeList.set("items",[{n:mstrmojo.desc(9250,"Pending"),v:pendingItems.length},{n:mstrmojo.desc(9251,"Failed"),v:failedItems.length}]);if(defaultSelect){selectedIdx=(failedItems.length)?1:0;}typeList.singleSelect(selectedIdx);},ondocIDChange:function ondocIDChange(){this.generateTypeList(true);}});}());