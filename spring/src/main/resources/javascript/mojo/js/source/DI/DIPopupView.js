(function(){mstrmojo.requiresCls("mstrmojo._HasLayout","mstrmojo.DI.DIFooter","mstrmojo.DI.DIFileUpload","mstrmojo.DI.DIURLUpload","mstrmojo.DI.DISampleFiles","mstrmojo.DI.DIPreview","mstrmojo.DI.DIExitOptions","mstrmojo.DI.DISourceList","mstrmojo.DI.DICubesList","mstrmojo.DI.DIXqueryLogin","mstrmojo.DI.DISourceIntro","mstrmojo.DI.DIDatabaseIntro","mstrmojo.DI.ProgressPolyfill","mstrmojo.DI.DISourceObjects","mstrmojo.DI.DIDataset","mstrmojo.DI.DIMappingPage","mstrmojo.DI.TableSources","mstrmojo.DI.DIClipboard","mstrmojo.qb.QBContainer","mstrmojo.ProgressBar");mstrmojo.requiresDescs(172,212,1059,1143,1302,3389,7972,10766,11677,12483,12484,12490,12715,12716,12874,12875,12876);var constants=mstrmojo.DI.DIConstants,pageType=constants.pageType,operationMode=constants.operationMode,fileUploadPage={scriptClass:"mstrmojo.DI.DIFileUpload",pageType:pageType.file,slot:"layoutNode"},urlUploadPage={scriptClass:"mstrmojo.DI.DIURLUpload",pageType:pageType.file,slot:"layoutNode"},clipboardPage={scriptClass:"mstrmojo.DI.DIClipboard",alias:"clipboardPage",cssClassLabel:"mstrmojo-clipboard-label",slot:"layoutNode"};var databasePage={scriptClass:"mstrmojo.DI.DIDatabaseIntro",pageType:pageType.database,slot:"layoutNode"};var singleTableQB={scriptClass:"mstrmojo.qb.QBContainer",pageType:pageType.database,slot:"layoutNode"};var datasetPage={scriptClass:"mstrmojo.DI.DIDataset",pageType:pageType.dataset,slot:"layoutNode"};var sampleFilesPage={scriptClass:"mstrmojo.DI.DISampleFiles",pageType:pageType.sampleFiles,slot:"layoutNode"};var sourceList={scriptClass:"mstrmojo.DI.DISourceList",pageType:pageType.dataSelection,slot:"layoutNode"};var cubesWidget={scriptClass:"mstrmojo.DI.DICubesList",alias:"cubesWidget",slot:"layoutNode"};var sourceObjectsPage={scriptClass:"mstrmojo.DI.DISourceObjects",pageType:pageType.sourceObjects,slot:"layoutNode"};var emptyPage={scriptClass:"mstrmojo.Box",alias:"emptyPage",slot:"layoutNode"};var xqueryLoginPage={scriptClass:"mstrmojo.DI.DIXqueryLogin",pageType:pageType.xqueryLogin,slot:"layoutNode"};var sourceIntroPage={scriptClass:"mstrmojo.DI.DISourceIntro",pageType:pageType.sourceIntro,slot:"layoutNode"};var previewPage={scriptClass:"mstrmojo.DI.DIPreview",pageType:pageType.preview,slot:"layoutNode"};var mappingPage={scriptClass:"mstrmojo.DI.DIMappingPage",pageType:pageType.emmaPreview,slot:"layoutNode"};var footer={scriptClass:"mstrmojo.DI.DIFooter",slot:"footerNode",alias:"footer"};var redirect={scriptClass:"mstrmojo.DI.DIExitOptions",pageType:pageType.redirect,slot:"layoutNode"};var header={scriptClass:"mstrmojo.Box",slot:"headerNode",alias:"header",quota:0,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-title",alias:"title",text:mstrmojo.desc(7972,"Import data")},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-di-help",title:mstrmojo.desc(1143,"Help"),onclick:function(){if(window.rrShowQuickTip!=="undefined"){window.rrShowQuickTip(this.domNode);}}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-di-usage",onclick:function(){var table=mstrmojo.insert(mstrmojo.DI.TableSources);table.domSrc=this.domNode;table.open();}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-user-quota-text",bindings:{text:function(){return mstrmojo.desc(12874,"##% storage used").replace("##",this.parent.quota);},tooltip:function(){return mstrmojo.desc(12874,"##% storage used").replace("##",this.parent.quota);}}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-di-usage-refresh"}],preBuildRendering:function(){if(this._super){this._super();}var progressBar;if(mstrmojo.dom.isIE8){progressBar={scriptClass:"mstrmojo.ProgressBar",alias:"progress",cssClass:"mstrmojo-di-user-quota"};}else{progressBar={scriptClass:"mstrmojo.Widget",alias:"progress",value:0,markupString:'<progress class="mstrmojo-di-user-quota" value = "{@value}"></progress>'};}this.addChildren(mstrmojo.insert(progressBar),5);},onquotaChange:function(evt){if(mstrmojo.dom.isIE8){this.progress.updateProgress(evt.value);}else{this.progress.domNode.value=evt.value/100;}}};var xQueryPages={};var sourceObjectsPages={};var sourceIntroPages={};function createPage(newPage,model,title,slot){var page=null;var cfg=newPage;if(slot){page=slot.get();}if(!page){if(model){newPage.model=model;}if(slot&&slot.getConfig()){cfg=slot.getConfig().properties||{};cfg=mstrmojo.hash.copy(newPage,cfg);}page=this.addChildren(mstrmojo.insert(cfg));page.render();if(page.alias==="sourceIntroPage"){sourceIntroPages[newPage.sourceInfo.id]=page;}else{if(newPage.alias==="xqueryLoginPage"){xQueryPages[newPage.sourceInfo.name]=page;}}if(newPage.sourceObjectsInfo){sourceObjectsPages[newPage.sourceObjectsInfo.name]=page;}if(slot){slot.set(page);}if(slot.getConfig()&&page.updatePageConfig){page.updatePageConfig(slot.getConfig());}}this.currentPage=page;this.header.title.set("text",title);}mstrmojo.DI.DIPopupView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIPopupView",markupString:'<div id="{@id}" class="mstrmojo-di-view {@cssClass}" ><div class="mstrmojo-di-header"></div><div class="mstrmojo-di-layout"></div><div class="mstrmojo-di-footer"></div></div>',markupSlots:{headerNode:function(){return this.domNode.firstChild;},layoutNode:function(){return this.domNode.children[1];},footerNode:function(){return this.domNode.lastChild;}},offsetHeight:44,offsetWidth:0,headerHeight:25,footerHeight:55,showPage:function showPage(page,sourceInfo,slot){this.clearModalNodes();if(this.currentPage){this.currentPage.set("visible",false);}var model=mstrApp.getRootController().getModel();var footerConfig;var CONTINUE_TEXT=mstrmojo.desc(212,"Continue"),FINISH_TEXT=mstrmojo.desc(1302,"Finish");var continueText=(model.operationMode===operationMode.create)?CONTINUE_TEXT:FINISH_TEXT;mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD",(model.operationMode===operationMode.refresh)?"refresh":"select",0];switch(page){case pageType.dataSelection:createPage.call(this,sourceList,model,mstrmojo.desc(12875,"Select a Data Source"),slot);footerConfig={next:{visible:true,enabled:false,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;case pageType.dataset:createPage.call(this,datasetPage,model,mstrmojo.desc(11677,"Select a dataset"),slot);footerConfig={next:{visible:true,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;case pageType.file:if(sourceInfo!==null&&(slot.getConfig()&&slot.getConfig().sourceInfo!==undefined)){sourceInfo=slot.getConfig().sourceInfo;}if(sourceInfo===0){fileUploadPage.sourceSubtype=constants.sourceSubtype.localFile;createPage.call(this,fileUploadPage,model,mstrmojo.desc(12715,"Upload your files"),slot);}else{urlUploadPage.sourceSubtype=constants.sourceSubtype.url;createPage.call(this,urlUploadPage,model,mstrmojo.desc(12715,"Upload your files"),slot);}footerConfig={next:{visible:true,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;case pageType.database:if(sourceInfo!==null){databasePage.sourceInfo=sourceInfo;}if(mstrApp.isEMMACube){continueText=CONTINUE_TEXT;createPage.call(this,singleTableQB,model,mstrmojo.desc(12716,"Import from Tables"),slot);var qbParams=mstrApp.getRootController().getQueryBuilderParams(sourceInfo.type,sourceInfo.extParams||null);var me=this;qbParams.diShowFooterFunction=function(footerConfig){me.showFooter(footerConfig);};mstrmojo.hash.copy(qbParams,this.currentPage.QBParams);this.currentPage.loadQB();}else{createPage.call(this,databasePage,model,mstrmojo.desc(10766,"Select Data"),slot);}footerConfig={next:{visible:true,enabled:true,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:false},finish:{visible:false}};break;case pageType.sampleFiles:createPage.call(this,sampleFilesPage,model,mstrmojo.desc(12483,"Select a Sample File"),slot);footerConfig={next:{visible:true,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;case pageType.emmaPreview:createPage.call(this,mappingPage,model,mstrmojo.desc(3389,"Preview"),slot);footerConfig={next:{visible:true,enabled:true,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:true}};mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD","review",0];break;case pageType.preview:createPage.call(this,previewPage,model,mstrmojo.desc(3389,"Preview"),slot);if(model.operationMode!==operationMode.create){if(model.currentSource&&model.currentSource.currentTransformations&&model.currentSource.currentTransformations.xtab){continueText=(model.currentSource.currentTransformations.xtab.isCrosstab===true)?mstrmojo.desc(212,"Continue"):mstrmojo.desc(1302,"Finish");}}footerConfig={next:{visible:true,text:continueText},back:{visible:true},cancel:{visible:true},previewNote:{visible:true}};mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD","review",0];break;case pageType.redirect:createPage.call(this,redirect,model,mstrmojo.desc(12484,"Data Imported"),slot);footerConfig={next:{visible:false},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;case pageType.sourceIntro:if(sourceInfo!==null){sourceIntroPage.sourceInfo=sourceInfo;}createPage.call(this,sourceIntroPage,model,mstrmojo.desc(12876,"Connect to ####").replace("####",sourceInfo.name),slot);footerConfig={next:{visible:true,enabled:true,text:mstrmojo.desc(212,"Continue")},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;case pageType.sourceObjects:if(sourceInfo!==null){sourceObjectsPage.sourceObjectsInfo=sourceInfo;}createPage.call(this,sourceObjectsPages[sourceInfo.name],sourceObjectsPage,model,mstrmojo.desc(10766,"Select Data"));footerConfig={next:{visible:true,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;case pageType.xqueryLogin:if(sourceInfo!==null){xqueryLoginPage.sourceInfo=sourceInfo;}createPage.call(this,xqueryLoginPage,model,mstrmojo.desc(12876,"Connect to ####").replace("####",sourceInfo.name),slot);footerConfig={next:{visible:true,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;case pageType.suggestNewSource:this.currentPage.set("visible",true);window.location.href="mailto:expressadmin@microstrategy.com?subject=New%20Data%20Source%20Suggestion";break;case pageType.clipboard:if(this.clipboardPage){this.clipboardPage.set("url",sourceInfo);}else{clipboardPage.url=sourceInfo;}createPage.call(this,this.clipboardPage,clipboardPage,model,mstrmojo.desc(12490,"Create custom data"));footerConfig={next:{visible:true,text:continueText},back:{visible:false},cancel:{visible:true},previewNote:{visible:false}};break;}this.showFooter(footerConfig);this.currentPage.set("visible",true);return this.currentPage;},changeCubeQuota:function(value){this.header.set("quota",value);},showFooter:function showFooter(footerConfig){this.footer.showControls(footerConfig);},setModalNodes:function(modalNodes,modalZIndex){this.clearModalNodes();var zIndex=modalZIndex||9999;var i;if(!modalNodes||!modalNodes.length){return ;}this.modalNodes=modalNodes;for(i=0;i<modalNodes.length;i++){this.modalNodesZIndexes.push(modalNodes[i].style.zIndex);}for(i=0;i<modalNodes.length;i++){modalNodes[i].style.zIndex=zIndex;if(modalNodes[i].style.position===""){modalNodes[i].style.position="relative";}}modalNodes[0].focus();},clearModalNodes:function(){var i,origZIndexes,nodes,node;nodes=this.modalNodes;origZIndexes=this.modalNodesZIndexes;for(i=0;nodes&&i<nodes.length;i++){node=nodes[i];if(node&&node.style){node.style.zIndex=origZIndexes[i];}}this.modalNodes=[];this.modalNodesZIndexes=[];},browserResized:function browserResized(size){var height=(parseInt(size.h,10)-this.offsetHeight);var width=(parseInt(size.w,10)-this.offsetWidth);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.w.layoutNode=width+"px";this.layoutConfig.h.layoutNode=height-(this.headerHeight+this.footerHeight)+"px";this.setDimensions(height+"px",width+"px");return true;},preBuildRendering:function preBuildRendering(){if(this._super){this._super();}mstrmojo.DI.ProgressPolyfill.createProgressPolyfill();var children=[];if(!this.footer){footer.model=mstrApp.getRootController().getModel();children.push(footer);}if(!this.header){children.push(header);}this.addChildren(children);this.footer.showControls({next:{visible:false},back:{visible:false},cancel:{visible:false},previewNote:{visible:false}});if(!this.emptyPage){this.currentPage=this.addChildren(emptyPage);}},postBuildRendering:function postBuildRendering(){if(this._super){this._super();}this.browserResized(mstrApp.container.size);}});}());