(function(){mstrmojo.requiresCls("mstrmojo.SuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var _buildTooltip=function(w,item,excludeSelf){var opener=w.parent.opener,showDesc=opener&&opener.showDesc,showPath=opener&&opener.showPath,n=item[w.itemField];var encode=mstrmojo.string.escape4HTMLText,tooltip="";if(showPath){var its=item.anc&&item.anc.items,len=its&&its.length;if(len>0){for(var i=0;i<len-1;i++){tooltip+=its[i].n+" > ";}tooltip+=encode(its[len-1].n);}else{if(item.path){tooltip+=item.path;}}}if(!excludeSelf){tooltip+=(tooltip.length===0?"":" > ")+encode(n);}if(showDesc){var desc=item[w.itemDescField],ml=120;if(desc){tooltip+="\r\n\r\n<br>"+encode(desc.substring(0,ml)+(desc.length>ml?"...":""));}}return tooltip;};var _requestPath=function(w,el,item){w.path=null;if(!el||!item||item.path){if(item&&item.path){w.set("path",item.path);}return ;}window.clearTimeout(this.pathTmr);this.pathTmr=window.setTimeout(function(){var path=el.path||el.getAttribute("path");if(path){w.set("path",item.path);return ;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(res){var path=pathParser(res.toString())||"";item.path=path;w.set("path",path);}},{taskId:"getObjectDetails",objectID:item.did,objectType:item.t},undefined);},200);};var pathParser=function(pathXmlString){var xmlDoc;if(window.DOMParser){xmlDoc=(new DOMParser()).parseFromString(pathXmlString,"text/xml");}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(pathXmlString);}var pathNode=xmlDoc.getElementsByTagName("path")[0],cns=pathNode.childNodes,path="";if(cns){for(var i=0,len=cns.length;i<len;i++){var vNode=cns[i].childNodes&&cns[i].childNodes[0];if(vNode){path+=mstrmojo.string.escape4HTMLText(vNode.nodeValue)+(i<len-1?"> ":"");}}}return path;};mstrmojo.LegacySuggestionList=mstrmojo.declare(mstrmojo.SuggestionList,null,{scriptClass:"mstrmojo.LegacySuggestionList",useRichTooltip:false,itemDescField:"desc",getItemMarkup:function(item,idx){var opener=this.parent.opener,tooltip=this.useRichTooltip?"":this.buildTooltip(item);return'<div class="mstrmojo-suggest-text '+((opener&&opener.item2textCss(item))||"")+'" idx="'+idx+'" title="'+tooltip+'">'+opener.getHighlightedText(opener.getSearchPattern(),mstrmojo.string.escape4HTMLText(item[this.itemField]))+"</div>";},getItemProps:function getItemProps(){return{};},onmouseover:function(evt){var opener=this.parent.opener;if(opener&&opener.showPath){var el=mstrmojo.dom.eventTarget(evt.hWin,evt.e),idx=el.getAttribute("idx"),item=idx!=null?this.items[idx]:null;if(item&&item.t>-1){this.targetEl=el;this.targetItem=item;this.requestPath(el,item);}}},requestPath:function requestPath(el,item){var opener=this.parent.opener;if(item.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function&&opener.showFunctionSyntaxAsPath){this.buildFunctionSyntax(item);}else{_requestPath(this,el,item);}},buildFunctionSyntax:function buildFunctionSyntax(item){var path=item.path;if(!path&&item.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){var getFunctionSyntax=function getFunctionSyntax(f){if(f.did<0){return f.n;}var pars=f.pars,sa=[],i,len;sa.push(f.n);if(pars){sa.push("(");for(i=0,len=pars.length;i<len;i++){sa.push(pars[i].n);if(i!==(len-1)){sa.push(", ");}}sa.push(")");}return sa.join("");};item.path=getFunctionSyntax(item);}this.set("path",{path:item.path,excludeSelf:true});},buildTooltip:function buildTooltip(item,excludeSelf){return _buildTooltip(this,item,excludeSelf);},onpathChange:function onpathChange(){var el=this.targetEl;el.path=1;var ttp=this.buildTooltip(this.targetItem,this.path.excludeSelf);if(this.useRichTooltip){this.useRichTooltip=true;this.hasOpenTooltip=false;if(!el.ttp){el.ttp=ttp;this.showTooltip();}}else{el.title=ttp;}}});}());