(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.num","mstrmojo.string");mstrmojo.validation={STATUSCODE:{UNKNOWN:-1,VALID:0,INVALID:1,INVALID_EMPTY:2,INVALID_CHAR:3,INVALID_OUTOFRANGE:4,INVALID_REGEX:5,INVALID_VALIDATOR:6,INVALID_BAD_NUMERICFORMAT:7,INVALID_BAD_DATESTRING:8},TRIGGER:{NONE:0,ONBLUR:1,ONKEYUP:2,VALUESET:4,ALL:7},REGEXP:{US_ZIP:/^\d{5}([\- ]?\d{4})?$/,EMAIL_ADDRESS:/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+[\.])+([a-zA-Z0-9]{2,4})+$/,SOCIAL_SECURITY_NUMBER:/^((?!000)(?!666)\d{3})(\s|\-)?((?!00)\d{2})\2((?!0000)\d{4})$/,PHONE_NUMBER:/^(?!-)[ \d\-\(\)\.\+]+$/,FILE_NAME:new RegExp('^[^:*?"<>|/\\\\()]+$'),FOLDER_PATH_WIN:new RegExp('^([a-zA-Z]:|\\\\\\\\[^:*?"<>|/\\\\]+|[^:*?"<>|/\\\\]*)(\\\\[^:*?"<>|/\\\\]+)*(\\\\){0,1}$'),FOLDER_PATH_UNIX:new RegExp('^(/){0,1}([^:*?"<>|/\\\\]+/)*([^:*?"<>|/\\\\]+){0,1}$'),PRINTER_PATH_SINGLE:new RegExp('^[^$%:*?"<>|/\\\\]*$'),PRINTER_PATH_MULTIPLE:new RegExp('^((/|\\\\\\\\)[^$%:*?"<>|/\\\\]+)((/|\\\\)[^$%:*?"<>|/\\\\]+)*(/|\\\\){0,1}$')}};var $VAL=mstrmojo.validation,$TRIGGER=$VAL.TRIGGER,$STATUSCODE=$VAL.STATUSCODE,DTP2TYPE={"-1":-1,1:1,2:1,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:4,12:4,13:4,14:6,15:6,16:6,17:3,18:3,21:2,22:2,23:3,24:4,25:3,30:5,34:5};$VAL.VALIDATOR={DEMO:function customValidator(v){var parsed=parseInt(v,10),SC=mstrmojo.validation.STATUSCODE;if(parsed===0||parsed===1||parsed>10){return{code:SC.VALID};}return{code:SC.INVALID,msg:"This field must be either 0, 1 or greater than 10"};},VALIDATE_PHONENO:function validatePhoneNo(v){var phoneNo=String(v).replace(/[^\d]/g,"");if(phoneNo.length<10){return{code:$STATUSCODE.INVALID,msg:mstrmojo.desc(9203,"A telephone number must contain at least 10 digits.")};}if(!$VAL.REGEXP.PHONE_NUMBER.test(v)){return{code:$STATUSCODE.INVALID,msg:mstrmojo.desc(9204,"The telephone number contains invalid characters.")};}return{code:$STATUSCODE.VALID};},VALIDATE_ZIPCODE:function validateZipCode(v){var msg="",dt=this.dtp;if(!$VAL.REGEXP.US_ZIP.test(v)){if($VAL.isNumeric(dt)||$VAL.isInt(dt)){msg=mstrmojo.desc(9208,"A zip code must be 5 digits or 5+4 digits.");}else{if($VAL.isString(dt)){msg=mstrmojo.desc(9206,"The zip code is invalid");}}return{code:$STATUSCODE.INVALID,msg:msg};}return{code:$STATUSCODE.VALID};},VALIDATE_EMAIL:function validateEmail(v){var atSignIdx=v.indexOf("@");if(atSignIdx===-1){return{code:$STATUSCODE.INVALID,msg:mstrmojo.desc(9197,"The email address is missing an at sign (@).")};}if(v.substring(atSignIdx).indexOf(".")===-1){return{code:$STATUSCODE.INVALID,msg:mstrmojo.desc(9198,"The email address is missing a period on the domain.")};}return $VAL.REGEXP.EMAIL_ADDRESS.test(v)?{code:$STATUSCODE.VALID}:{code:$STATUSCODE.INVALID,msg:mstrmojo.desc(9207,"The email address is invalid.")};},VALIDATE_SSN:function validateSSN(v){var dt=this.dtp,ssnNo;if($VAL.isNumeric(dt)||$VAL.isInt(dt)){ssnNo=String(v).replace(/[^\d]/g,"");if(ssnNo.length!==9){return{code:$STATUSCODE.INVALID,msg:mstrmojo.desc(9209,"A Social Security Number must be 9 digits.")};}}if(!$VAL.REGEXP.SOCIAL_SECURITY_NUMBER.test(v)){return{code:$STATUSCODE.INVALID,msg:mstrmojo.desc(9210,"The Social Security Number is invalid.")};}return{code:$STATUSCODE.VALID};}};$VAL.isInt=function isInt(dtp){return DTP2TYPE[dtp]===1;};$VAL.isNumeric=function isNumeric(dtp){return DTP2TYPE[dtp]===2||DTP2TYPE[dtp]===5;};$VAL.isString=function isString(dtp){return DTP2TYPE[dtp]===3;};var $CONFIG=window.mstrConfig,listSep=$CONFIG.listSep,$EXPR=mstrmojo.expr,DTP=$EXPR.DTP,$NUM=mstrmojo.num,$STRING=mstrmojo.string,$DATE=mstrmojo.date;function containsInvalidChar(me,v){var dtp=me.dtp,c=me.constraints,allows=c.allowedFormatChars||"",isInt=(DTP2TYPE[dtp]===1),isNumeric=(DTP2TYPE[dtp]===2),isDT=(DTP2TYPE[dtp]===6),thousand=mstrmojo.locales.number.THOUSANDSEPARATOR,decimal=mstrmojo.locales.number.DECIMALSEPARATOR,regExp;if(isInt){if(!me._intRegExp){allows+="0-9-"+(me.isList?listSep:"")+thousand;me._intRegExp=new RegExp("[^"+allows+"]");}regExp=me._intRegExp;}if(isNumeric){if(!me._numericRegExp){allows+="0-9-"+(me.isList?listSep:"")+decimal+thousand;me._numericRegExp=new RegExp("[^"+allows+"]");}regExp=me._numericRegExp;}return !!regExp&&regExp.test(v);}function valueOutOfRange(me,v){var dtp=me.dtp,c=me.constraints,isInt=(DTP2TYPE[dtp]===1),isNumeric=(DTP2TYPE[dtp]===2),isDT=(DTP2TYPE[dtp]===6),min=c.min,max=c.max,parsed;if(min===undefined&&max===undefined){return false;}if(isInt||isNumeric){return $NUM.inNumericRange(v,min,max)!==0;}if(isDT){return $DATE.inDateTimeRange(v,min,max)!==0;}return false;}function badNumericFormat(me,v){return !$NUM.isNumeric(v);}function badDTString(me,v){var isD=(me.dtp===DTP.DATE),isT=(me.dtp===DTP.TIME);return(isD?!$DATE.isDate(v):(isT?!$DATE.isTime(v):!$DATE.isDateAndOrTime(v)));}mstrmojo._CanValidate=mstrmojo.provide("mstrmojo._CanValidate",{constraints:null,required:false,dtp:DTP.INTEGER,isList:false,autoFormat:false,validationStatus:null,init:function init(props){this._super(props);if(!this.constraints){this.constraints={};}var c=this.constraints;if(!c.hasOwnProperty("trigger")){c.trigger=$TRIGGER.NONE;}},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){this.value=v;var t=this.constraints.trigger,cv=(t&$TRIGGER.VALUESET)>0;if(cv){this.validate(v);}}return bChanged;},validate:function validate(){var v=(this.value!==null&&this.value!==undefined)?this.value:"",vl=this.isList?v.split(listSep):[v],r,isInvalid,method,len=vl.length,i;for(i=0;i<len;i++){r=this.doValidation(vl[i]);isInvalid=(r.code>$STATUSCODE.VALID);if(isInvalid){if(len>1){r.msg=mstrmojo.locales.validation.invalidValueInListError.replace("#",vl[i]||" ");}break;}}method=isInvalid?"onInvalid":"onValid";if(!isInvalid&&this.autoFormat){this.format();}this.set("validationStatus",r);if(this[method]){this[method](r);}},format:function format(){var dtp=this.dtp,isDT=(DTP2TYPE[dtp]===6);if(!isDT){return ;}var listSep=mstrConfig.listSep,v=this.value||"",vl=this.isList?v.split(listSep):[v],isD=dtp===14,va=[],dt,_DT=mstrmojo.locales.datetime,len=vl.length,i;for(i=0;i<len;i++){v=vl[i];dt=$DATE.parseDateAndOrTime(v);if(dt){if(isD&&dt.date){va.push($DATE.formatDateInfo(dt.date,_DT.DATEOUTPUTFORMAT));}else{va.push((dt.date?$DATE.formatDateInfo(dt.date,_DT.DATEOUTPUTFORMAT):"")+" "+(dt.time?$DATE.formatTimeInfo(dt.time,_DT.TIMEOUTPUTFORMAT):""));}}}this.set("value",va.join(listSep));},isValid:function isValid(){var s=this.validationStatus;if(!s){this.validate();}return this.validationStatus.code===$STATUSCODE.VALID;},clearValidation:function clearValidation(){this.set("validationStatus",{code:$STATUSCODE.VALID});if(this.onClearValidation){this.onClearValidation();}},doValidation:function doValidation(v){var c=this.constraints,regExp=c.regExp,validator=c.validator,r={id:this.id,code:$STATUSCODE.VALID,msg:""},dtp=this.dtp,isInt=(DTP2TYPE[dtp]===1),isNumeric=(DTP2TYPE[dtp]===2||DTP2TYPE[dtp]===5),isString=(DTP2TYPE[dtp]===3),isDT=(DTP2TYPE[dtp]===6),isEmpty=$STRING.isEmpty(v),vLen=String(v).length,err="",_VAL=mstrmojo.locales.validation;if(this.required&&isEmpty){r.code=$STATUSCODE.INVALID_EMPTY;r.msg=_VAL.requiredFieldError;return r;}v=$STRING.trim(v);if(!isEmpty&&containsInvalidChar(this,v)){if(isInt){err=_VAL.integerDataType;}if(isNumeric){err=_VAL.numericDataType;}if(isDT){err=_VAL.dateDataType;}r.code=$STATUSCODE.INVALID_CHAR;r.msg=_VAL.invalidCharError.replace("#",err);return r;}if(!isEmpty&&isDT&&badDTString(this,v)){r.code=$STATUSCODE.INVALID_BAD_DATESTRING;r.msg=_VAL.invalidDateStringError;return r;}if(!isEmpty&&(isNumeric||isInt)&&badNumericFormat(this,v)){r.code=$STATUSCODE.INVALID_BAD_NUMERICFORMAT;r.msg=_VAL.invalidNumericFormatError;return r;}if(!isEmpty&&(isInt||isNumeric||isDT)&&valueOutOfRange(this,v)){r.code=$STATUSCODE.INVALID_OUTOFRANGE;if(c.min!==null&&c.max!==null){err=_VAL.outofRangeError.replace("# ","").replace("##",c.min).replace("###",c.max);}else{if(c.min!==null){err=_VAL.noLessMinError.replace("##",c.min).replace("# ","");}else{if(c.max!==null){err=_VAL.noGreaterMaxError.replace("###",c.max).replace("# ","");}}}r.msg=err;return r;}if(isString&&c.minLen!==null&&c.maxLen!==null){if(vLen<c.minLen||vLen>c.maxLen){r.code=$STATUSCODE.INVALID;r.msg=mstrmojo.desc(9211).replace(/#/,c.minLen).replace(/##/,c.maxLen);return r;}}if(regExp&&!regExp.test(v)){r.code=$STATUSCODE.INVALID_REGEX;r.msg=mstrmojo.desc(9205);return r;}var _t=validator&&validator.apply(this,[v]);if(_t){r.code=_t.code;r.msg=_t.msg;return r;}return r;}});}());