(function(){mstrmojo.requiresCls("mstrmojo.qb.QBPreview","mstrmojo.DI.DIMappingPreview","mstrmojo._HasLayout","mstrmojo.DI.DIConstants","mstrmojo.Container","mstrmojo.DI.DIXtabPreview","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(134,221,1052,1053,1054,1055,1823,2057,2966,3477,10986,12522,12532,12639,12838,12839,12840,12841,12842,12843,12844,12845,12846,12847);var constants=mstrmojo.DI.DIConstants,$ARR=mstrmojo.array,$HASH=mstrmojo.hash,previewMode={raw:0,xtab:1},OPEN_SIZE;function convertSkipRows(skipRows){return skipRows<0?Math.abs(parseInt(skipRows,10)+1):parseInt(skipRows,10);}function checkSourceTableKey(){var diPreview=this;var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.tableID];var bMatch=true;if(!source){bMatch=false;}else{if(diPreview.sourceTableKey&&diPreview.sourceTableKey!==source.key){bMatch=false;}}return bMatch;}function findDelimiter(symbol){var idx;if(symbol){switch(symbol){case"none":idx=0;break;case",":idx=1;break;case";":idx=2;break;case"\t":idx=3;break;case" ":idx=4;break;default:idx=5;break;}}else{idx=0;}return idx;}function findQuotes(symbol){var idx;switch(symbol){case"'":idx=1;break;case'"':idx=2;break;default:idx=0;}return idx;}mstrmojo.DI.ui.dialogs.DIParseDataDialog=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.ui.dialogs.DIParseDataDialog",cssClass:"mstrmojo-di-parse-data-dialog",title:mstrmojo.desc(12838,"Parse Your Data"),mode:previewMode.raw,noButtonCls:true,showTitle:true,originalDelimiter:"",originalQuotes:"",originalSkipRows:"",originalNewCH:false,originalMode:previewMode.raw,bindings:{help:function(){if(mstrApp.isSingleTier){return"Parse_Your_Data.htm";}else{return"Parse_Your_Data_page.htm";}}},children:[{scriptClass:"mstrmojo.Label",cssClass:"view-Label",text:mstrmojo.desc(2966,"View: "),bindings:{visible:function(){var model=mstrmojo.all.DIModel;var type=model.importSources[this.parent.tableID].type;var enabled=(type!==constants.sourceType.hadoop);return enabled;}}},{scriptClass:"mstrmojo.ui.CheckList",cssClass:"upload-options",multiSelect:false,orientation:"h",alias:"DIPreviewXtab",selectedIndex:0,items:[{did:"0",n:mstrmojo.desc(10986,"Tabular")},{did:"1",n:mstrmojo.desc(3477,"Crosstab")}],bindings:{visible:function(){var model=mstrmojo.all.DIModel;var type=model.importSources[this.parent.tableID].type;var enabled=(type!==constants.sourceType.hadoop);return enabled;}},postBuildRendering:function(){var model=mstrmojo.all.DIModel;model.attachEventListener("changeToXtab",this.id,"changeToXtab");},changeToXtab:function(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.tableID];source.currentTransformations.xtab.set("isCrosstab",true);this.parent.set("mode",previewMode.xtab);this.set("selectedIndex",1);},onchange:function(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.tableID];var sourceInfo=source.sourceInfo;if(this.selectedIndex===0){if(source.currentTransformations.xtab.isCrosstab===true){source.currentTransformations.xtab.set("isCrosstab",false);controller.editImportedData(constants.requestFlag.preview|constants.requestFlag.mapping|constants.requestFlag.sourceInfo|constants.requestFlag.relationship,source.currentIndex,null,source.currentTransformations.xtab.getXML(),null,null,this.parent.tableID);}controller.clearModalNodes();this.parent.set("mode",previewMode.raw);}else{var flag=constants.requestFlag.preview|constants.requestFlag.mapping|constants.requestFlag.transformations|constants.requestFlag.sourceInfo|constants.requestFlag.relationship|constants.requestFlag.anyState;var sheetIndex=sourceInfo.sheetIndex;var callback={success:function(){controller.getImportedDataEMMA(constants.actions.transform,flag,sheetIndex,false,source.tableID);},failure:function(res){controller.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,res.message||"");}};if(parseInt(this.parent.crosstab.skipRows.value,10)!==convertSkipRows(this.parent.originalSkipRows)||this.parent.newCH.checked){this.parent.originalSkipRows=sourceInfo.skipRows;this.parent.newCH.set("checked",false);controller.editImportedDataEMMA(flag,sheetIndex,"<chs/>",null,this.parent.tableID,-2,null,null,callback);}else{this.parent.set("mode",previewMode.xtab);}}this.parent.browserResized(OPEN_SIZE);}},{scriptClass:"mstrmojo.ImageCheckBox",alias:"newCH",label:mstrmojo.desc(12522,"Insert new column headers"),enabled:true,postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";var model=mstrmojo.all.DIModel;model.attachEventListener("PreviewFetched",this.id,"insertHdrs");model.attachEventListener("PreviewNotFetched",this.id,"insertHdrs");model.attachEventListener("CurrentSourceChanged",this.id,"insertHdrs");model.attachEventListener("sourceInfoFetched",this.id,"updateHdrs");model.attachEventListener("CurrentSourceChanged",this.id,"updateHdrs");this.updateHdrs();},updateHdrs:function(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.tableID];if(source&&source.sourceInfo&&source.sourceInfo.hasNewHeaders){this.set("checked",true);this.parent.originalNewCH=true;}},insertHdrs:function(){var diPreview=this.parent;var controller=mstrApp.getRootController();var m=controller.getModel();if(!checkSourceTableKey.call(diPreview)){return ;}var DIPreviewXtab=diPreview.DIPreviewXtab;var source=m.importSources[this.parent.tableID];var p=source&&source.currentPreview;if(!p){this.set("visible",false);return ;}var type=source.type;var enabled=(type===constants.sourceType.file||type===constants.sourceType.dropbox||type===constants.sourceType.googleDrive||type===constants.sourceType.hadoop);if(DIPreviewXtab.selectedIndex===0&&diPreview.mode===previewMode.raw&&enabled){this.set("visible",true);if(source.canAutoMappingAndDetectRelation()){this.set("visible",true);}else{this.set("visible",false);}}},onclick:function(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.tableID];var preview=source.currentPreview;var i;var colHeadersXml="<chs>";if(this.checked){for(i=1;i<=preview.chs.length;i++){colHeadersXml=colHeadersXml+"<ch>Column "+i+"</ch>";}source.set("hasNewHeaders",true);}else{source.set("hasNewHeaders",false);}colHeadersXml=colHeadersXml+"</chs>";mstrApp.getRootController().editImportedData(constants.requestFlag.sourceInfo|constants.requestFlag.mapping|constants.requestFlag.relationship|constants.requestFlag.preview,source.currentIndex,colHeadersXml,null,null,null,this.parent.tableID);},bindings:{visible:function(){var model=mstrmojo.all.DIModel;var type=model.importSources[this.parent.tableID].type;var enabled=(type===constants.sourceType.file||type===constants.sourceType.dropbox||type===constants.sourceType.googleDrive||type===constants.sourceType.hadoop);return(this.parent.mode===previewMode.raw&&enabled);}}},{scriptClass:"mstrmojo.HBox",alias:"crosstab",cssClass:"di-preview-parse-options",postCreate:function postCreate(){var diPreview=this.parent;var controller=mstrApp.getRootController();var m=controller.getModel();diPreview.attachEventListener("modeChange",this.id,this.makeVisible);m.attachEventListener("MappingsFetched",this.id,this.makeVisible);m.attachEventListener("CurrentSourceChanged",this.id,this.makeVisible);},onRender:function onRender(){this.makeVisible();},makeVisible:function makeVisible(){var diPreview=this.parent;var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.tableID];if(!checkSourceTableKey.call(diPreview)){return ;}var type=source&&source.type;var xdaType=source&&source.xdaType;var subType=source&&source.subtype;var mimeType=source&&source.sourceInfo&&source.sourceInfo.mimetype;if(type===null){this.set("visible",false);return ;}if(type!==constants.sourceType.file&&type!==constants.sourceType.dropbox&&type!==constants.sourceType.googleDrive&&type!==constants.sourceType.hadoop){this.set("visible",false);return ;}if(diPreview.mode===previewMode.raw){if(source.canAutoMappingAndDetectRelation()){this.set("visible",true);}else{this.set("visible",false);}}else{this.set("visible",false);}if(((type===constants.sourceType.file||type===constants.sourceType.hadoop)&&xdaType===constants.xdaType.text&&subType!==constants.sourceSubtype.clipboard)||(type===constants.sourceType.googleDrive&&(mimeType==="text/plain"||mimeType==="text/csv"))||(type===constants.sourceType.dropbox&&(mimeType==="text/plain"||mimeType!=="text/csv"))){this.delimiter.set("visible",true);this.quotes.set("visible",true);}else{this.delimiter.set("visible",false);this.delimiterCustom.set("visible",false);this.quotes.set("visible",false);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"di-preview-skip-N-rows",text:mstrmojo.desc(13266,"Skip"),alias:"skipRowsLabel1"},{scriptClass:"mstrmojo.TextBox",cssClass:"di-preview-skip-N-rows-input",alias:"skipRows",postCreate:function postCreate(){var controller=mstrApp.getRootController();var m=controller.getModel();m.attachEventListener("CurrentSourceChanged",this.id,this.update);this.update();},postBuildRendering:function postBuildRendering(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.parent.tableID];this.parent.parent.originalSkipRows=source&&source.sourceInfo.skipRows;},update:function(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.parent.tableID];var skipRows=source&&source.sourceInfo.skipRows;skipRows=convertSkipRows(skipRows);this.set("value",skipRows);}},{scriptClass:"mstrmojo.Label",cssClass:"di-preview-skip-N-rows",text:mstrmojo.desc(13267,"rows from beginning"),alias:"skipRowsLabel2"},{scriptClass:"mstrmojo.DropDownList",alias:"delimiter",title:mstrmojo.desc(12840,"Delimiter"),cssClass:"di-preview-delimiter",options:[{n:mstrmojo.desc(2057,"None"),v:"none"},{n:mstrmojo.desc(1052,"Comma"),v:","},{n:mstrmojo.desc(1054,"Semicolon"),v:";"},{n:mstrmojo.desc(1053,"Tab"),v:"tab"},{n:mstrmojo.desc(1055,"Space"),v:"space"},{n:mstrmojo.desc(1823,"Custom"),v:""}],onidxChange:function(){if(this.idx===5){this.parent.delimiterCustom.set("visible",true);if(this.parent.delimiterCustom.inputNode){this.parent.delimiterCustom.focus();}}else{this.parent.delimiterCustom.set("visible",false);}},postBuildRendering:function(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.parent.tableID];var delimiter=source&&source.sourceInfo.delimiter;var editor=this.parent.parent;editor.originalDelimiter=delimiter;var idx=findDelimiter(delimiter);this.set("idx",idx);}},{scriptClass:"mstrmojo.TextBox",alias:"delimiterCustom",cssClass:"di-preview-delimiter-inputBox",maxLength:"1",postBuildRendering:function(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.parent.tableID];var delimiter=source&&source.sourceInfo.delimiter;var idx=findDelimiter(delimiter);if(idx===5){this.set("value",delimiter);}}},{scriptClass:"mstrmojo.DropDownList",alias:"quotes",title:mstrmojo.desc(12841,"Quotes"),cssClass:"di-preview-quotes",options:[{n:mstrmojo.desc(2057,"None"),v:"none"},{n:mstrmojo.desc(12842,"Single Quotes"),v:"\\'"},{n:mstrmojo.desc(12843,"Double Quotes"),v:'\\"'}],postBuildRendering:function(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.parent.tableID];var quotes=source&&source.sourceInfo.quotes;var editor=this.parent.parent;editor.originalQuotes=quotes;var idx=findQuotes(quotes);this.set("idx",idx);}},{scriptClass:"mstrmojo.Button",alias:"delimiterOK",text:mstrmojo.desc(134,"Apply"),cssClass:"mstrmojo-di-button mstrmojo-WebButton",onclick:function(){var model=mstrApp.getRootController().model;var source=model.importSources[this.parent.parent.tableID];var numOfRows=source.nrows-1;var delimiterSel=this.parent.delimiter;var quotesSel=this.parent.quotes;var skipRowsSel=this.parent.skipRows;var skipRows,delimiter,quotes;if(parseInt(skipRowsSel.value,10)!==convertSkipRows(source.sourceInfo.skipRows)){skipRows=parseInt(skipRowsSel.value,10);if(skipRows>numOfRows){var msg="There are only ## rows in the original data. Please input a number lower than that.";mstrApp.getRootController().displayError(msg.replace("##",numOfRows));return ;}}if(delimiterSel.idx===5){var value=this.parent.delimiterCustom.value;switch(value){case" ":value="space";break;case"  ":value="tab";break;default:break;}delimiter=value;}else{delimiter=delimiterSel.options[delimiterSel.idx].v;}if(quotesSel.idx!==undefined){quotes=quotesSel.options[quotesSel.idx].v;}var flag=constants.requestFlag.preview|constants.requestFlag.mapping|constants.requestFlag.transformations|constants.requestFlag.sourceInfo|constants.requestFlag.sheets|constants.requestFlag.relationship|constants.requestFlag.anyState;var sheetIndex=source.sourceInfo.sheetIndex;mstrApp.getRootController().editImportedDataEMMA(flag,sheetIndex,null,null,this.parent.parent.tableID,skipRows,delimiter,quotes);}}]},{scriptClass:"mstrmojo.ImageCheckBox",alias:"mhb",label:mstrmojo.desc(12639,"No metric headers"),origMhb:null,postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";var model=mstrmojo.all.DIModel;var diPreview=this.parent;model.attachEventListener("TransformationsFetched",this.id,"hasNoMetric");model.attachEventListener("CurrentSourceChanged",this.id,"hasNoMetric");diPreview.xtab_container.xtab.attachEventListener("NoMetricHeaderBlock",this.id,"hasNoMetric");},hasNoMetric:function(){var diPreview=this.parent;var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.tableID];if(!checkSourceTableKey.call(diPreview)){return ;}if(source===null){return ;}if(!source.currentTransformations){return ;}if(source.currentTransformations.xtab){var mhb=source.currentTransformations.xtab.mhb;if(mhb.startRow===-1||mhb.startColumn===-1){this.set("checked",true);}else{this.set("checked",false);}}},setDefaultMhb:function(mhb,db){if(db.startRow>0){mhb.set("startRow",db.startRow-1);mhb.set("endRow",db.startRow-1);mhb.set("startColumn",db.startColumn);mhb.set("endColumn",-1);}else{if(db.startColumn>0){mhb.set("startRow",db.startRow);mhb.set("endRow",-1);mhb.set("startColumn",db.startColumn-1);mhb.set("endColumn",db.startColumn-1);}else{this.set("checked",true);}}},onclick:function(){var diPreview=this.parent;var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.tableID];var mhb=source.currentTransformations.xtab.mhb;var db=source.currentTransformations.xtab.db;if(this.checked){this.origMhb=mstrmojo.hash.copy(mhb);mhb.set("startColumn",-1);mhb.set("startRow",-1);mhb.set("endColumn",-1);mhb.set("endRow",-1);}else{if(!this.origMhb){this.origMhb=mstrmojo.hash.copy(mhb);}if((this.origMhb.startRow===-1)||(this.origMhb.startColumn===-1)){this.setDefaultMhb(mhb,db);}else{if(this.origMhb.startRow===this.origMhb.endRow){if(this.origMhb.startRow>=db.startRow){this.setDefaultMhb(mhb,db);}else{mhb.set("startColumn",db.startColumn);mhb.set("endRow",this.origMhb.endRow);mhb.set("endColumn",this.origMhb.endColumn);mhb.set("startRow",this.origMhb.startRow);}}else{if(this.origMhb.startColumn>=db.startColumn){this.setDefaultMhb(mhb,db);}else{mhb.set("startRow",db.startRow);mhb.set("endRow",this.origMhb.endRow);mhb.set("endColumn",this.origMhb.endColumn);mhb.set("startColumn",this.origMhb.startColumn);}}}}diPreview.xtab_container.xtab.draw();},bindings:{visible:function(){return(this.parent.mode===previewMode.xtab);}}},{scriptClass:"mstrmojo.HBox",cssClass:"di-preview-xtab-legend",alias:"xtabLegend",children:[{scriptClass:"mstrmojo.Label",cssClass:"attribute-headers",text:mstrmojo.desc(12844,"Attribute Headers")},{scriptClass:"mstrmojo.Label",cssClass:"attribute-elements",text:mstrmojo.desc(12845,"Attribute elements")},{scriptClass:"mstrmojo.Label",cssClass:"metrics-headers",text:mstrmojo.desc(12846,"Metrics Headers")},{scriptClass:"mstrmojo.Label",cssClass:"metrics-values",text:mstrmojo.desc(12847,"Metrics values")}],bindings:{visible:function(){return(this.parent.mode===previewMode.xtab);}}},{scriptClass:"mstrmojo.DI.DIMappingPreview",alias:"preGrid",hasContextMenu:false,columns:[],postCreate:function(){var controller=mstrApp.getRootController();var m=controller.getModel();m.attachEventListener("MappingsFetched",this.id,"initPreview");if(mstrApp.isEMMACube){m.attachEventListener("CurrentSourceChanged",this.id,"initPreview");}},initPreview:function(){var controller=mstrApp.getRootController();var diModel=controller.getModel();var source=diModel.importSources[this.parent.tableID];var subColumns,mapTemp=[],newColumn,newSubColumns,newSubColumnsNum;if(!checkSourceTableKey.call(this.parent)){return ;}if(!source){return ;}var map,dataPreview;if(this.parent.mode===previewMode.raw){map=source.currentMapping;if(!map){return ;}if(!source.currentPreview){return ;}dataPreview=source.currentPreview.data;}else{map=source.transformedMapping;if(!map){return ;}if(!source.transformedPreview){return ;}dataPreview=source.transformedPreview.data;}$ARR.forEach(map,function(column){subColumns=column.subColumns;if(subColumns&&subColumns.length>=1){newSubColumns=[];$ARR.forEach(subColumns,function(subColumn){if(subColumn.columnState!==4&&(subColumn.type!=="cmps"||source.executeAction!==0)){newSubColumns.push(subColumn);}});newSubColumnsNum=newSubColumns.length;if(newSubColumnsNum>1){newColumn={};$HASH.copy(column,newColumn);newColumn.subColumns=newSubColumns;mapTemp.push(newColumn);}else{if(newSubColumnsNum===1){mapTemp.push(newSubColumns[0]);}}}else{if(column.columnState!==4&&(column.type!=="cmps"||source.executeAction!==0)){mapTemp.push(column);}}});var model={mappings:mapTemp,dataset:dataPreview,supportTimeGeo:true,shapeKeys:diModel.shapeKeys,renameMapped:function(did,cIndex,v){var mdl=this,mp=mdl.mappings,found=false,i,len;for(i=0,len=mp.length;i<len;i++){if(i!==cIndex){if(v===mp[i].alias&&mp[cIndex].tp===mp[i].tp){found=true;break;}}}if(found){var msg=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");mstrApp.getRootController().displayError(msg.replace("##",v),null,mdl.alertTitle);return ;}mdl.mappings[cIndex].alias=v;mstrApp.getRootController().model.raiseEvent({name:"MappingsFetched"});}};this.set("model",model);if(!model.mappings){return ;}this.populatePreview();if(OPEN_SIZE){this.parent.browserResized(OPEN_SIZE);}},bindings:{visible:function(){return(this.parent.mode===previewMode.raw);},height:function(){var model=mstrmojo.all.DIModel;var type=model.importSources[this.parent.tableID].type;if(type!==constants.sourceType.hadoop){return"80%";}else{return"86%";}}}},{scriptClass:"mstrmojo.Box",cssClass:"di-xtab-container",alias:"xtab_container",children:[{scriptClass:"mstrmojo.DI.DIXtabPreview",alias:"xtab",cssClass:"di-xtab",postCreate:function(){var controller=mstrApp.getRootController();var m=controller.getModel();m.attachEventListener("TransformationsFetched",this.id,"initPreview");if(mstrApp.isEMMACube){m.attachEventListener("CurrentSourceChanged",this.id,"initPreview");}m.attachEventListener("FlatPreviewFetched",this.id,"initPreview");},initPreview:function(){var DIPreviewXtab=this.parent.parent.DIPreviewXtab;var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.parent.tableID];if(!checkSourceTableKey.call(this.parent.parent)){return ;}if(!source){return ;}if(!source.currentTransformations){return ;}if(!source.currentTransformations.xtab){return ;}if(!source.currentPreview){return ;}this.initXtab(source.currentPreview.data,source.currentTransformations.xtab,source.currentPreview.chs);if(source.currentTransformations.xtab.isCrosstab===true){DIPreviewXtab.set("selectedIndex",1);if(source.executeAction===0){this.parent.parent.set("mode",previewMode.xtab);}}else{DIPreviewXtab.set("selectedIndex",0);this.parent.parent.set("mode",previewMode.raw);}},bindings:{visible:function(){return(this.parent.parent.mode===previewMode.xtab);}}}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"applyBtn",enabled:true,onclick:function(){var editor=this.parent.parent;var controller=mstrApp.getRootController();var source=controller.model.importSources[this.parent.parent.tableID];var sourceInfo=source.sourceInfo;editor.originalNewCH=editor.newCH.checked;if(sourceInfo.skipRows!==undefined){editor.originalSkipRows=sourceInfo.skipRows.toString();}if(sourceInfo.delimiter){editor.originalDelimiter=sourceInfo.delimiter;}else{editor.originalDelimiter="none";}if(sourceInfo.quotes){editor.originalQuotes=sourceInfo.quotes;}else{editor.originalQuotes="none";}editor.originalMode=editor.mode;var DIPreviewXtab=editor.DIPreviewXtab;if(DIPreviewXtab.selectedIndex===1&&editor.mode===previewMode.xtab){source.currentTransformations.xtab.set("isCrosstab",true);editor.set("mode",previewMode.raw);controller.clearModalNodes();controller.editImportedData(constants.requestFlag.transformedPreview|constants.requestFlag.mapping|constants.requestFlag.sourceInfo|constants.requestFlag.relationship,source.currentIndex,null,source.currentTransformations.xtab.getXML(),null,null,this.parent.parent.tableID);}editor.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelBtn",onclick:function(){var editor=this.parent.parent;var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.parent.parent.tableID];var preview=source.currentPreview;var changed=false;var flag=constants.requestFlag.preview|constants.requestFlag.mapping|constants.requestFlag.transformations|constants.requestFlag.sourceInfo|constants.requestFlag.sheets|constants.requestFlag.relationship|constants.requestFlag.anyState;var sheetIndex=source.sourceInfo.sheetIndex;var convertedSkipRows=convertSkipRows(editor.originalSkipRows);var skipRowsParam,newCHParam,delimiterParam,quotesParam;if(editor.originalMode===editor.mode&&editor.mode===previewMode.raw){if(parseInt(editor.crosstab.skipRows.value,10)!==convertedSkipRows){changed=true;skipRowsParam=editor.originalSkipRows<0?"-2":editor.originalSkipRows;}if(editor.newCH.checked!==editor.originalNewCH){editor.newCH.set("checked",editor.originalNewCH);source.hasNewHeaders=editor.originalNewCH;changed=true;var i;newCHParam="<chs>";if(editor.originalNewCH){for(i=1;i<=preview.chs.length;i++){newCHParam=newCHParam+"<ch>Column "+i+"</ch>";}}newCHParam=newCHParam+"</chs>";}var delimiterSel=editor.crosstab.delimiter;var quoteSel=editor.crosstab.quotes;if(delimiterSel.visible){if(delimiterSel.idx===5){var value=source.sourceInfo.delimiter;if(value!==editor.originalDelimiter){changed=true;delimiterParam=editor.originalDelimiter;}}else{if(delimiterSel.idx!==findDelimiter(editor.originalDelimiter)){changed=true;delimiterParam=editor.originalDelimiter;}}}if(quoteSel.visible){if(quoteSel.idx!==findQuotes(editor.originalQuotes)){changed=true;quotesParam=editor.originalQuotes;}}if(changed){controller.editImportedDataEMMA(flag,sheetIndex,newCHParam,null,this.parent.parent.tableID,skipRowsParam,delimiterParam,quotesParam);}}else{if(editor.originalMode===editor.mode&&editor.mode===previewMode.xtab){if(editor.newCH.checked!==editor.originalNewCH){editor.newCH.set("checked",editor.originalNewCH);source.hasNewHeaders=editor.originalNewCH;}}else{if(editor.originalMode!==editor.mode&&editor.originalMode===previewMode.raw){if(source.currentTransformations.xtab.isCrosstab===true){source.currentTransformations.xtab.set("isCrosstab",false);controller.editImportedData(constants.requestFlag.preview|constants.requestFlag.mapping|constants.requestFlag.sourceInfo|constants.requestFlag.relationship,source.currentIndex,null,source.currentTransformations.xtab.getXML(),null,null,this.parent.parent.tableID);}controller.clearModalNodes();editor.set("mode",previewMode.raw);}else{if(editor.originalMode!==editor.mode&&editor.originalMode===previewMode.xtab){flag=constants.requestFlag.transformedPreview|constants.requestFlag.mapping|constants.requestFlag.sourceInfo|constants.requestFlag.relationship;source.currentTransformations.xtab.set("isCrosstab",true);editor.set("mode",previewMode.xtab);controller.clearModalNodes();controller.editImportedDataEMMA(flag,source.currentIndex,null,source.currentTransformations.xtab.getXML(),this.parent.parent.tableID,editor.originalSkipRows,editor.originalDelimiter,editor.originalQuotes);}}}}editor.close();}}],browserResized:function browserResized(size){var width=parseInt(size.w,10),height=Math.floor(parseInt(size.h,10)*0.95),preGrid=this.preGrid;OPEN_SIZE=size;if(isNaN(width)||width<0||!this.domNode){return ;}if(width<800){width=760;this.domNode.children[0].style.width="760px";}else{width=Math.ceil(width*0.95);this.domNode.children[0].style.width="";}if(width>40&&preGrid.domNode){preGrid.domNode.style.width=(width-40)+"px";preGrid.itemsContainerNode.style.width=(width-40)+"px";if(height>271){this.domNode.children[0].style.height=height+"px";this.containerNode.style.height=(height-112)+"px";preGrid.domNode.style.height=(height-250)+"px";preGrid.scrollNode.style.height=(height-271)+"px";this.xtabLegend.domNode.style.width=(width-40)+"px";this.xtab_container.domNode.style.width=(width-40)+"px";this.xtab_container.domNode.style.height=(height-250)+"px";}preGrid.widgetResized();}if(this.domNode.childNodes[0]){mstrmojo.dom.center(this.domNode.childNodes[0]);}},onOpen:function onOpen(){var controller=mstrApp.getRootController();var m=controller.getModel();var source=m.importSources[this.tableID];mstrApp.getRootController().selectSourceTable(this.tableID);if(this.originalMode===previewMode.xtab){if(!source.currentTransformations.xtab.isCrosstab){source.currentTransformations.xtab.set("isCrosstab",true);}this.set("mode",previewMode.xtab);}if((controller.model.operationMode!==constants.operationMode.create&&source.currentTransformations&&source.currentTransformations.xtab.isCrosstab)||!source.currentPreview){var flag=constants.requestFlag.preview|constants.requestFlag.mapping|constants.requestFlag.transformations;var sourceInfo=source.sourceInfo;var sheetIndex=sourceInfo.sheetIndex;controller.getImportedDataEMMA(constants.actions.getFlatPreview,flag,sheetIndex,false,this.tableID);this.originalMode=previewMode.xtab;}this.preGrid.initPreview();this.xtab_container.xtab.initPreview();var idx1=findDelimiter(this.originalDelimiter);if(this.crosstab.delimiter.idx!==idx1){this.crosstab.delimiter.set("idx",idx1);}var idx2=findQuotes(this.originalQuotes);if(this.crosstab.quotes.idx!==idx2){this.crosstab.quotes.set("idx",idx2);}var skipRows=convertSkipRows(this.originalSkipRows);this.crosstab.skipRows.set("value",skipRows);}});}());