(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu");mstrmojo.requiresDescs(4326,8983);var _D=mstrmojo.dom;mstrmojo.Refine.TextSearchFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.TextSearchFacet",config:null,options:null,query:null,timerID:null,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><div class="facet-column-name text"></div></div><div class="facet-menu"></div></div><div class="facet-text-body"><div class="input-container" mstrAttach:keyup><textarea></textarea></div><div class="facet-text-options"><div class="facet-text-item"><input type="checkbox"/><label>'+mstrmojo.desc(4326,"Case Sensitive")+'</label></div><div class="facet-text-item"><input type="checkbox"/><label>'+mstrmojo.desc(8983,"Regular Expression")+"</label></div></div></div></li>",markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},titleNode:function(){return this.domNode.children[0].children[0].children[0];},inputNode:function(){return this.domNode.children[1].children[0].children[0];},caseSensitiveNode:function(){return this.domNode.children[1].children[1].children[0].children[0];},regexNode:function(){return this.domNode.children[1].children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var src=this.parent;var $MAPPINGTABLE=mstrmojo.Refine.RangeFacet;var menuHelper=$MAPPINGTABLE.menuHelper=$MAPPINGTABLE.menuHelper||new mstrmojo.Refine.RefineFacetMenu();menuHelper.target=src;menuHelper.type=0;var cfg=menuHelper.getMenuConfig();cfg.hostId=src.id;cfg.hostElement=this.domNode;cfg.isHostedWithin=false;cfg.position=_D.position(this.domNode,true);src.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:cfg}));}}],onkeyup:function(){this.query=this.inputNode.value;this.scheduleUpdate();},onclick:function(evt){var e=evt.e,t=_D.eventTarget(evt.hWin,e);if(t===this.removeNode){this.remove();}else{if(t===this.caseSensitiveNode){this.config.caseSensitive=!this.config.caseSensitive;if(this.query!==null&&this.query.length>0){this.scheduleUpdate();}}else{if(t===this.regexNode){if(this.config.mode==="regex"){this.config.mode="text";}else{this.config.mode="regex";}if(this.query!==null&&this.query.length>0){this.scheduleUpdate();}}}}},scheduleUpdate:function(){var self=this;if(!this.timerID){this.timerID=window.setTimeout(function(){self.timerID=null;self.parent.updateEngine(true);},500);}else{window.clearTimeout(this.timerID);this.timerID=window.setTimeout(function(){self.timerID=null;self.parent.updateEngine(true);},500);}},reset:function(){this.query=null;this.inputNode.value="";this.parent.updateEngine(true);},remove:function(){this.parent.removeFacet(this);this.config=null;this.options=null;},hasSelection:function(){return(this.query!==null&&this.query!=="");},getRequirementDiscription:function(){var res='{cells in "'+this.config.name+'" contains "'+this.query+'"}';return res;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(data){this.config.caseSensitive=data.caseSensitive;this.config.mode=data.mode;if(this.config.caseSensitive){this.caseSensitiveNode.checked=true;}if(this.config.mode==="regex"){this.regexNode.checked=true;}},getJSON:function(){return{type:"text",name:this.config.name,columnName:this.config.columnName,mode:this.config.mode,caseSensitive:this.config.caseSensitive,query:this.query};}});}());