(function(){mstrmojo.requiresCls("mstrmojo.Model","mstrmojo._HasPopup","mstrmojo.string");var $DOM=mstrmojo.dom,$STR=mstrmojo.string;var DRILLING_ACTION=1,SELECTOR_ACTION=2,HYPERLINK_ACTION=4,SORT_ACTION=8,PIVOT_ACTION=16,KEEP_ONLY_ACTION=512;function toolTipText(xtab,td){var cell=xtab.getCellForNode(td),at=cell&&cell.at,defAction=0;if(at){defAction=(at&SELECTOR_ACTION)||(at&HYPERLINK_ACTION)||(at&DRILLING_ACTION);}if(defAction===HYPERLINK_ACTION){var lInf=xtab.model.getCellLinksInfo(cell);if(!lInf||isNaN(lInf.di)){return"";}var item=lInf.links[lInf.di];return item.n;}if(defAction===DRILLING_ACTION){var drillsInfo=xtab.model.getCellDrillsInfo(cell);return drillsInfo&&(mstrmojo.desc(183,"Drill to")+" "+drillsInfo.n)||"";}if(cell){var e=("mix" in cell)?cell._e:cell;if(e&&e.desc){return $STR.decodeHtmlString(e.desc);}}return xtab.tooltip||"";}function shouldShowPopupInner(xtab,td){var cell=xtab.getCellForNode(td),at=cell&&cell.at;if((at&SORT_ACTION)>0||(at&PIVOT_ACTION)>0||(at&KEEP_ONLY_ACTION)>0){return true;}var actCount=0;if((at&DRILLING_ACTION)>0){return true;}if((at&HYPERLINK_ACTION)>0){actCount++;}if((at&SELECTOR_ACTION)>0){actCount++;}if(actCount>1){return true;}if((at&HYPERLINK_ACTION)>0){var lInf=xtab.model.getCellLinksInfo(cell),links=lInf&&lInf.links;var len=(links&&links.length)||0;if(lInf&&!isNaN(lInf.di)){len--;}if(len>0){return true;}}return false;}function getPageLimit(xtab){return xtab.viewport.clientWidth-(xtab.scrollboxNode.offsetWidth-xtab.scrollboxNode.clientWidth);}mstrmojo._XtabCellHoverMgr=mstrmojo.declare(mstrmojo.Model,null,{scriptClass:"mstrmojo._XtabCellHoverMgr",parent:null,td:null,audibles:{"*":false},startup:function startup(){var xtab=this.parent;if(xtab&&xtab.getCellForNode){var zs=xtab.zones,z;for(z in zs){this.addMgrElement(z);}if(!this._sub_ihc){this._sub_ihc=xtab.attachEventListener("ignoreHoverChange",this.id,"onChangeIgnoreHover");}window.setTimeout(function(){xtab._pl=getPageLimit(xtab);},0);}},addMgrElement:function addMgrElement(zk){var xtab=this.parent,me=this,_el=xtab&&xtab.zones[zk].tableNode;if(_el&&xtab&&xtab.getCellForNode){if(!this.fCtxMenu){this.fCtxMenu=function(e){me.oncontextmenu(e,self);};}if(!this.fOver){this.fOver=function(e){me.onhover(e,self);};}if(!this.fOut){this.fOut=function(e){me.onunhover(e,self);};}var fCtxMenu=this.fCtxMenu,fOver=this.fOver,fOut=this.fOut;$DOM.attachEvent(_el,"mouseover",fOver);$DOM.attachEvent(_el,"mouseout",fOut);$DOM.attachEvent(_el,"contextmenu",fCtxMenu);}},shutdown:function shtdwn(){var zs=this.parent&&this.parent.zones,z;for(z in zs){var el=zs[z].tableNode;if(el){$DOM.detachEvent(el,"mouseover",this.fOver);$DOM.detachEvent(el,"mouseout",this.fOut);$DOM.detachEvent(el,"contextmenu",this.fCtxMenu);}}},onXtabWidthChanged:function(){var xtab=this.parent;xtab._pl=getPageLimit(xtab);},onChangeIgnoreHover:function(){var xtab=this.parent;if(!xtab.ignoreHover&&this._ignored){this.onhover(null,null,this._ignored);}},onhover:function hvr(e,hWin,target){if(this.parent.ignoreHover){this._ignored=$DOM.eventTarget(hWin,e);return ;}var xtab=this.parent,td=this.getEvtTargetCell(e,hWin,xtab,target);if(td&&xtab){td.title=toolTipText(xtab,td);}if(this.showHvrBtn(xtab,td)){this.td=td;if(!xtab._pl){xtab._pl=getPageLimit(xtab);}xtab.openPopup("cellHoverPopupRef",{xtab:xtab,td:td});}else{this.onunhover(e,hWin,target);}},onunhover:function onunhover(){if(this.parent.ignoreHover){return ;}var xtab=this.parent,p=xtab._lastOpened;if(!p){return ;}if(p.autoCloses){p.autoClose();}else{xtab.closePopup();}},getEvtTargetCell:function getEvtTargetCell(e,hWin,xtab,target){var t=target||$DOM.eventTarget(hWin,e);return t&&$DOM.findAncestorByName(t,"td",true,xtab.viewport);},oncontextmenu:function oncontextmenu(e,hWin,target){var xtab=this.parent,td=this.getEvtTargetCell(e,hWin,xtab,target);this.processRightClick(e,hWin,td);if(td&&this.shouldShowPopup(xtab,td,true)){xtab.openPopup("cellHoverPopupRef",{xtab:xtab,td:td,cmPos:$DOM.getMousePosition(e,hWin)});xtab.cellHoverPopupRef.btn.openPopup();xtab.closePopup();$DOM.preventDefault(hWin,e);$DOM.stopPropogation(hWin,e);}},processRightClick:mstrmojo.emptyFn,shouldShowPopup:function shouldShowPopup(xtab,td,isRightClick){var b=td.mstrShowPopup;if(b!==undefined){return b;}b=shouldShowPopupInner(xtab,td);td.mstrShowPopup=b;return b;},showHvrBtn:function showHvrBtn(xtab,td){return this.shouldShowPopup(xtab,td,false);}});}());