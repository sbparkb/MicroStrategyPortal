(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.BoxPanel","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.vi.ui._IsUnitDependentPanel","mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui.VisualizationEditorUnitList","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(14389);var $ARR=mstrmojo.array,$H=mstrmojo.hash,$CSS=mstrmojo.css;mstrmojo.vi.ui.VisualizationEditor=mstrmojo.declare(mstrmojo.vi.ui.BoxPanel,[mstrmojo.vi.ui._IsUnitDependentPanel,mstrmojo.vi.ui.toolbars._HasToolbar],{scriptClass:"mstrmojo.vi.ui.VisualizationEditor",activeZoneId:"",layoutConfig:{h:{controlNode:"25px",containerNode:"100%"},w:{controlNode:"100%",containerNode:"100%"},xt:true},onvisibleChange:function onvisibleChange(evt){if(this.viPanelType===mstrmojo.vi.ui.BoxPanel.PANEL_TYPES.DROP_ZONES&&evt.value){this.refresh();}},init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIVizEditor");},onactiveZoneIdChange:function onactiveZoneChange(evt){var was=evt.valueWas;if(was){mstrmojo.all[was].clearSelect();}},onVIUnitSelected:function onVIUnitSelected(targetUnit){var dropZonesModel=targetUnit&&targetUnit.getZonesModel(),zoneCfg=dropZonesModel&&dropZonesModel.getDropZones(),contents=this.contents,id=this.id;$CSS.toggleClass(this.domNode,"empty",!zoneCfg);if(zoneCfg){var fnGetScriptClassInstance=function(currentZone){return{scriptClass:"mstrmojo.vi.ui.PanelPortlet",title:currentZone.n,panelId:id,canCollapse:false,enabled:currentZone.enabled,portletSrc:currentZone,children:[currentZone]};},fnGetPortlet=function(currentZone){var zoneConfig={scriptClass:"mstrmojo.vi.ui.PanelPortlet",title:currentZone.n,getTitleBarCfg:function(){return $H.copy({useRichTooltip:true,shouldShowTooltip:function(){return true;},getTooltipContent:function(){return currentZone.title;}},this.constructor.prototype.getTitleBarCfg.call(this));},panelId:id,canCollapse:false,enabled:currentZone.enabled,portletSrc:currentZone,children:[{scriptClass:"mstrmojo.vi.ui.VisualizationEditorUnitList",items:currentZone.items,alias:"unitList",cssClass:currentZone.cssClass,panelId:id,zonesModel:dropZonesModel,zonesSource:currentZone}]};if(currentZone.siblings){zoneConfig.children=zoneConfig.children.concat(currentZone.siblings);}return zoneConfig;},items=[],datasets=dropZonesModel.docModel.datasets,fnInitDatasetProperty=function(items){(items||[]).forEach(function(item){if(item.usedInDropZones){item.usedInDropZones=false;}});},fnSetUsedInDropZones=function(items,item){var i=$ARR.find(items,"did",item.did);if(i>-1){items[i].usedInDropZones=true;return true;}return false;},toolbarConfig=new mstrmojo.ui.menus.ToolbarConfig();(zoneCfg.zones||[]).forEach(function(zone){items=items.concat(zone.items);});if(dropZonesModel.canSwapAxis()){toolbarConfig.addToolbarBtn(mstrmojo.desc(11658,"Swap"),"swap",function(){dropZonesModel.swapAxis();});}else{toolbarConfig.addDisabledToolbarBtn(mstrmojo.desc(11658,"Swap"),"swap");}if(dropZonesModel.canDefineSubtotals()){toolbarConfig.addToggleToolbarButton(mstrmojo.desc(6193,"Show Totals"),"totals",function(){dropZonesModel.showQuickSubtotals();},function(){dropZonesModel.hideDefinedSubtotals();},null,dropZonesModel.hasVisibleSubtotals());}else{toolbarConfig.addDisabledToolbarBtn(mstrmojo.desc(6193,"Show Totals"),"totals");}toolbarConfig.addToolbarBtn(mstrmojo.desc(14389,"Remove Data"),"clearall",function(){dropZonesModel.clearAllDropZones(dropZonesModel.docModel.clearVisAsFilterAction(targetUnit));});contents.addChildren([{scriptClass:"mstrmojo.vi.ui.toolbars.Toolbar",alias:"toolbar",visible:true,useRichTooltip:true,cssClass:"VizEditorToolbar",getItemMarkup:function getItemMarkup(item){return this.constructor.prototype.getItemMarkup.call(this,item).replace("{@en@n}",'<div class="icn"></div>');},getLayoutOffsets:function(){return{w:6};}}]);contents.toolbar.set("toolbarCfg",toolbarConfig);$H.keyarray(datasets).forEach(function(datasetId){fnInitDatasetProperty(datasets[datasetId].att);fnInitDatasetProperty(datasets[datasetId].mx);(items||[]).forEach(function(item){if(!fnSetUsedInDropZones(datasets[datasetId].att,item)){fnSetUsedInDropZones(datasets[datasetId].mx,item);}});});(zoneCfg.zones||[]).forEach(function(zone){if(zone.scriptClass){contents.addChildren([fnGetScriptClassInstance(zone)]);}else{contents.addChildren([fnGetPortlet(zone)]);}});this.activeZoneId="";this.generateToolbar();}this.doLayout();},updateToolbar:function updateToolbar(cfg){if(mstrApp.allowWebDashboardDesign()){this.addRenameTargetMenuItem(cfg);}this.addHelpTopicMenuItem(cfg,mstrmojo.desc(1143,"Help"),"html5_dashboard_editor_editor_panel.htm");return this._super(cfg);}});}());