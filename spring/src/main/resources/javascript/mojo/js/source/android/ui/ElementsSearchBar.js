(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.android.ui.Label","mstrmojo.android.ui.Menu","mstrmojo.android.ui.SearchBox","mstrmojo.android.ui.Image","mstrmojo.mstr.WebElements","mstrmojo.dom","mstrmojo.css");mstrmojo.requiresDescs(10,9462,9463);var $DOM=mstrmojo.dom,$CSS=mstrmojo.css,$TRANSITION_END=$DOM.CSS3_TRANSITION_END;var menuItems=[{n:mstrmojo.desc(9462,"View All"),idx:1,v:true},{n:mstrmojo.desc(9463,"View Selected"),idx:0,v:false}];function canSearchClose(){if(this.searchRequired){if(!this.target.getSelectedItems().length){return false;}}return true;}function toggleSearch(){var switchLbl=this.lbl,switchLblNode=switchLbl.domNode,switchLblNodeStyle=switchLblNode.style,searchNodeStyle=this.searchNode.style,txt=this.search.box,txtNode=txt.inputNode,txtNodeStyle=txtNode.style,target=this.target,viz="visible";var isSearch=this._isSearch=!!switchLbl.visible;if(isSearch){target.enterSearchMode();var textStyle=$CSS.getComputedStyle(txt.inputNode),width=this.domNode.offsetWidth-(2*parseInt(textStyle.marginRight,10))-parseInt(textStyle.paddingLeft,10)-parseInt(textStyle.paddingRight,10)-this.search.slot0.offsetWidth,browseElements=this.browseElements;$DOM.attachOneTimeEvent(switchLblNode,$TRANSITION_END,function(){switchLbl.set(viz,false);searchNodeStyle.width="100%";txt.set("hint",(browseElements&&browseElements.source.n)||mstrmojo.desc(10,"Search"));txt.set(viz,true);window.setTimeout(function(){txtNodeStyle.width=width+"px";},0);});switchLblNodeStyle.opacity=0;}else{if(!canSearchClose.call(this)){return ;}target.exitSearchMode(!this.searchRequired);$DOM.attachOneTimeEvent(txtNode,$TRANSITION_END,function(){txt.set(viz,false);txt.set("value","");searchNodeStyle.width="";switchLbl.set(viz,true);window.setTimeout(function(){switchLblNodeStyle.opacity=1;},0);});txt.inputNode.style.width=0;}}mstrmojo.android.ui.ElementsSearchBar=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.android.ui.ElementsSearchBar",markupString:'<div id="{@id}" class="mstrmojo-ElementSearchBar {@cssClass}" style="{@cssText}" ><div><div class="mstrmojo-ElementSearchBar-switch"></div><div class="mstrmojo-ElementSearchBar-search"></div></div></div>',markupSlots:{switchNode:function(){return this.domNode.firstChild.firstChild;},searchNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{oncanSearchChange:function(){this.search.btn.set("visible",!!this.canSearch);}},target:null,browseElements:null,searchRequired:false,children:[{scriptClass:"mstrmojo.android.ui.Menu",slot:"switchNode",alias:"menu",visible:false,items:[menuItems[1]],postselectionChange:function(evt){var added=evt.added,item=added&&this.items[added[0]];if(item){var parent=this.parent;parent.lbl.set("text",item.n);this.set("visible",false);this.set("items",[menuItems[item.idx]]);parent.target.set("viewAll",item.v);}}},{scriptClass:"mstrmojo.HBox",alias:"search",slot:"searchNode",children:[{scriptClass:"mstrmojo.android.ui.Image",alias:"btn",touchTap:function(){toggleSearch.call(this.parent.parent);}},{scriptClass:"mstrmojo.android.ui.SearchBox",alias:"box",hint:mstrmojo.desc(10,"Search"),cssDisplay:"block",cssText:"width:0;",visible:false,searchFunc:function(searchPattern){if(searchPattern){var searchBar=this.parent.parent,elements=searchBar.browseElements,searchElements=(elements&&elements.duplicate())||new mstrmojo.mstr.WebElements(),cfg=searchElements.browseConfig||{},id=this.id;cfg.searchPattern=searchPattern;cfg.blockBegin=1;cfg.searchForms=this.searchForms;if(searchBar.searchTarget){cfg.searchTarget=searchBar.searchTarget;delete searchBar.searchTarget;}searchElements.browseConfig=cfg;searchElements.getItems(0,{success:function(){mstrmojo.all[id].set("searchResult",searchElements);}});}else{this.clearSearch();}},clearFunc:function(){this.parent.parent.target.clearSearch();},onsearchResultChange:function(){this.parent.parent.target.search(this.searchResult);}}]}],init:function init(props){this._super(props);var lbl={scriptClass:"mstrmojo.android.ui.Label",slot:"switchNode",alias:"lbl"};if(props.searchRequired){lbl.text=props.title;lbl.cssClass="mstrmojo-no-Image";}else{lbl.text=mstrmojo.desc(9462,"View All");lbl.touchTap=function(){var menu=this.parent.menu,show=!menu.visible;if(show){menu.set("width",this.domNode.offsetWidth+"px");}menu.set("visible",show);};}this.addChildren(lbl);},onRender:function onRender(){var initialSearch=this.initSearchValue,id=this.id;if(initialSearch||this.searchRequired){delete this.initSearchValue;window.setTimeout(function(){var bar=mstrmojo.all[id];toggleSearch.call(bar);var box=bar.search.box;box.set("value",initialSearch||"");if(initialSearch){box.onEnter();}},0);}return this._super();},goBack:function goBack(){if(this._isSearch){if(canSearchClose.call(this)){toggleSearch.call(this);return true;}}return false;}});}());