(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.func","mstrmojo.hash","mstrmojo.css","mstrmojo.Container","mstrmojo.Image","mstrmojo.ObjectBrowser","mstrmojo._HasLayout","mstrmojo._FillsBrowser","mstrmojo.ui.List","mstrmojo.ui._HasScroller","mstrmojo.ui.pathbar.PathBar","mstrmojo.home.ui.Card","mstrmojo.home.EnumHomeCards","mstrmojo.home.ui.CustomCard","mstrmojo.home.ui.HtmlBox","mstrmojo.home.ui.RecentsCard","mstrmojo.string");mstrmojo.requiresDescs(2,3,531,3272,3678);var CARDS=mstrmojo.home.EnumHomeCards,CARD_TYPES=CARDS.types,CARD_ITEMS=CARDS.items;function getObjectBrowser(props){var view=this;return{scriptClass:"mstrmojo.ObjectBrowser",alias:"ob",fishEyeVisible:false,upButtonVisible:true,searchVisible:false,quickSearch:true,minSearchLength:1,closeable:false,closeOnSelect:false,scrollableIncFetch:true,showCompletePath:false,includeObjectDesc:true,browsableTypes:props.browsableTypes||"",rootFolderID:props.rootFolderID,rootFolderType:props.rootFolderType||7,folderLinksContextId:props.folderLinksContextId,postCreate:function(){if(this.visible&&!this.loaded){this.browse({onSelectCB:[this,"handleObject"]});this.loaded=true;}},handleObject:function(item){view.controller.execute(item);}};}function scrollCardIntoView(scrollNode,targetCard){var st=scrollNode.scrollTop;(new mstrmojo.fx.AnimateProp({target:scrollNode,props:{scrollTop:{isStyle:false,start:st,stop:st+(targetCard.offsetTop-st),ease:mstrmojo.ease.sin}},duration:500})).play();}mstrmojo.home.views.HomeView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._FillsBrowser,mstrmojo._HasLayout,mstrmojo._HasPopup,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.home.views.HomeView",markupString:'<div id="{@id}" class="mstrmojo-HomeView {@cssClass}" style="{@cssText}" mstrAttach:contextmenu,click><div></div><div class="mstrmojo-RootView-pathbar"></div><div class="mstrmojo-HomeView-content"><div class="mstrmojo-HomeView-scrollNode"><div class="cards-container-outer"><div class="cards-container"></div></div></div></div><div></div></div>',markupSlots:{topCtrlNode:function(){return this.domNode.firstChild;},pathbarNode:function(){return this.domNode.childNodes[1];},contentNode:function(){return this.domNode.childNodes[2];},scrollNode:function(){return this.domNode.childNodes[2].firstChild;},containerNode:function(){return this.domNode.childNodes[2].firstChild.firstChild.firstChild;},bottomCtrlNode:function(){return this.domNode.lastChild;}},markupMethods:{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},layoutConfig:{h:{topCtrlNode:"auto",pathbarNode:"42px",scrollNode:"100%",bottomCtrlNode:"auto"},w:{topCtrlNode:"100%",pathbarNode:"100%",scrollNode:"100%",bottomCtrlNode:"100%"},xt:true},model:null,init:function init(props){this._super(props);this.addPathBar();if(mstrmojo.dom.isIE7||mstrmojo.dom.isIE8){this.addChildren([{scriptClass:"mstrmojo.Label",cssClass:"no-support",text:mstrmojo.desc(14546,"This page is not supported in your browser.")+"\n\n"+mstrmojo.desc(14547,'Please go to "Preferences > General" to change the "Default start page"')}]);}else{this.addCard({t:CARD_TYPES.ADD});this.renderCards();}},postBuildRendering:function(){var ret=this._super();var me=this;window.setTimeout(function(){me.updateScrollbars();},300);me.pathbar.pathExtraLinks.attachEventListener("loadDefaultCard",this.id,function(){this.model.loadDefaultCard();});me.pathbar.pathExtraLinks.attachEventListener("saveDefaultCard",this.id,function(){this.model.saveDefaultCard();});return ret;},setupScrollNodes:function setupScrollNodes(){this.scrollbarHostNode=this.contentNode;},updateScrollbars:function updateScrollbars(){this._super();},renderCards:function renderCards(){mstrmojo.array.forEach(this.model.cards,function(cardDef){this.addCard(cardDef,false);},this);},addCard:function addCard(cardDef,save){var view=this,controller=view.controller;var cardProps={},card;switch(cardDef.t){case CARD_TYPES.ADD:var cardAdd=mstrmojo.Button.newWebButton(mstrmojo.desc(531,"Add"),function(){var menuCfg=mstrmojo.hash.copy({hostId:view.id,hostElement:this.domNode,isHostedWithin:true},controller.getAddMenuCfg());var corners=menuCfg.ENUM_CORNERS;menuCfg.setAlignment(corners.TOP_LEFT,corners.TOP_LEFT);view.openPopup(menuCfg.newInstance());},false,{cssClass:"mstrmojo-Card-add",ignoreLayout:true,cssDisplay:"inline-block",text:"\u002B",alias:"addBtn",isAddBtn:true});this.addChildren([cardAdd]);return ;case CARD_TYPES.IMAGE:cardProps={cssClass:"col-2 imgCard",title:cardDef.title,contentWidget:[{scriptClass:"mstrmojo.Image",alias:"splash",src:cardDef.splashURL,onclick:function(){if(!mstrmojo.string.isEmpty(cardDef.objectURL)){window.open(cardDef.objectURL);}}}],getEditorConfig:function(data,cfg){var me=this;cfg.addPopupMenuItem(mstrmojo.desc(3272,"Edit"),this.id,function(){return controller.getDashboardSettingEditorConfig({objectURL:data.objectURL,splashURL:data.splashURL},function(data,editor){me.cardDef.objectURL=data.objectURL;me.cardDef.splashURL=data.splashURL;me.splash.set("src",me.cardDef.splashURL);me.parent.model.updateCard(me.cardDef);});});cfg.addPopupMenuItem(mstrmojo.desc(3297,"Title"),this.id,function(){return controller.getDashboardSettingTitleConfig({title:me.title},function okCallback(data,editor){me.set("title",data.title);});});}};break;case CARD_TYPES.MY:cardProps={cssClass:"my col-1",title:mstrmojo.desc(3,"My Reports"),contentWidget:[getObjectBrowser.call(this,{rootFolderType:20,folderLinksContextId:35})],onClickTitleBar:function(){controller.executeEvent(3003);}};break;case CARD_TYPES.SHARED:cardProps={cssClass:"shared col-1",title:mstrmojo.desc(2,"Shared Reports"),contentWidget:[getObjectBrowser.call(this,{rootFolderType:7,folderLinksContextId:34})],onClickTitleBar:function(){controller.executeEvent(3002);}};break;case CARD_TYPES.FOLDER:cardProps={cssClass:"my folder col-1",title:cardDef.n,contentWidget:[getObjectBrowser.call(this,{rootFolderID:cardDef.did})],onClickTitleBar:function(){controller.executeEvent(2001,{folderID:cardDef.did});}};break;case CARD_TYPES.RECENT:card={scriptClass:"mstrmojo.home.ui.RecentsCard",cssClass:"recent col-4",model:view.model,ignoreLayout:true,cardDef:cardDef};break;case CARD_TYPES.HTML:cardProps={cssClass:cardDef.cssClass||"html-container",title:cardDef.title,col:cardDef.col,contentWidget:[{scriptClass:"mstrmojo.home.ui.HtmlBox",alias:"htmlbox",cssText:"height:100%; width:100%"}]};card=mstrmojo.hash.copy(cardProps,{scriptClass:"mstrmojo.home.ui.CustomCard",title:cardProps.title,children:cardProps.contentWidget,ignoreLayout:true,cardDef:cardDef});break;}if(!card){card=mstrmojo.hash.copy(cardProps,{scriptClass:"mstrmojo.home.ui.Card",title:cardProps.title,children:cardProps.contentWidget,ignoreLayout:true,cardDef:cardDef});}var addedChildren=this.addChildren([card],this.children.length-1);if(save!==false){this.model.addCard(cardDef);}this.updateAddBtnVisibility();this.updateScrollbars();if(save!==false){var newCardNode=addedChildren[0];scrollCardIntoView(this.scrollNode,newCardNode.domNode);}},removeCard:function removeCard(card){this.removeAndDestroyChild(card);this.model.removeCard(card.cardDef);this.updateAddBtnVisibility();},updateAddBtnVisibility:function updateAddBtnVisibility(){this.addBtn.set("visible",this.model.cards.length===0);},addPathBar:function addPathBar(){var pathInfo=mstrApp.pathInfo;if(pathInfo){var pathbar=new mstrmojo.ui.pathbar.PathBar({alias:"pathbar",slot:"pathbarNode",pathInfo:pathInfo,showCreateButton:true});pathbar.addChildren(this.getPathToolbarChildren());this.addChildren([pathbar]);}},getPathToolbarChildren:function getPathToolbarChildren(){return[];}});}());