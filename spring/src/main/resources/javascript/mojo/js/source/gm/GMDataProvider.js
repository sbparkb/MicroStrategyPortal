(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.VisUtility");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumFontAlignment","EnumFontStyle","EnumFontRotation","EnumLineStyle");mstrmojo.requiresClsP("mstrmojo.gm","GMUtility","GMEnums","GMAxisScale");var $C=mstrmojo.chart,$HASH=mstrmojo.hash,$GM=mstrmojo.gm,GMUTIL=$GM.GMUtility,$VISUTILS=mstrmojo.VisUtility,CHART_TYPE=$GM.EnumGraphType,SUB_TYPE=$GM.EnumSubtype,ABL_DIRECTION=$GM.EnumABLDirection,COLOR_BY_TYPE=$GM.EnumColorByType,MK_SHAPE=$GM.EnumShape,$ZONE_IDs=$GM.EnumGMZoneIds,$ARR=mstrmojo.array,IDENTITY_TYPE=$GM.EnumIdentityType,$FT=$GM.FormatingPropertyTag,$WT=$GM.WidgetPropertyTag,useOriginalDP=false,XAXIS=3,YAXIS=4,SpFlTp=mstrmojo.gm.ShapeFillType,METRIC_LVL_DATA_LABEL_SHOW=true;function getRandLCS(){var dp=this.dp,lds=dp.lds,len=this.groupData.length,lcs=[],ox=lds.getOffsetX(),oy=lds.getOffsetY(),i,lr;for(i=0;i<len;i++){lcs.push(this.groupData[i].C-ox);}lr=this.groupData[0].R-oy;return{lr:lr,lcs:lcs};}function hGetMetric(metricIndex){var idx=parseInt(metricIndex,10),dp=this.dp,lds=dp.lds,gmm=lds.gmm,mIds=dp.getMetricIds(),fullNf,mNames=dp.getMetricNames();if(idx<0){return undefined;}fullNf=gmm.getFullNumberFormat();return{idx:idx,metric:mNames[idx],id:mIds[idx],fullNf:fullNf!==undefined?fullNf[idx]:undefined};}function getPrivateGraphCell(seriesId,groupId){var dataSbc=this.dataSbc,r,c,rawObj,chtInfo=this.getChartInfo(),lds=this.lds,gmm=lds.gmm,onlyMetricNamesOnAxisForGridPie=gmm.onlyMetricNamesOnAxisForGridPie,isMetricNamesOnXAxis=gmm.isMetricNamesOnXAxis,metricIndexForLabelForGridPie=-1;if(dataSbc===true){c=parseInt(seriesId,10);r=parseInt(groupId,10);}else{r=parseInt(seriesId,10);c=parseInt(groupId,10);}if(this.cache[r]===undefined){this.cache[r]=[];}if(this.cache[r][c]!==undefined){return this.cache[r][c];}if(onlyMetricNamesOnAxisForGridPie){if(isMetricNamesOnXAxis){metricIndexForLabelForGridPie=this.metricsOnAngleBy[r];}else{metricIndexForLabelForGridPie=this.metricsOnAngleBy[c];}}rawObj=this.data[r][c];var cell=null;if(rawObj){cell=new GraphCell({groupData:rawObj,dp:this,chtInfo:chtInfo,metricsOnAngleBy:onlyMetricNamesOnAxisForGridPie?[metricIndexForLabelForGridPie]:this.metricsOnAngleBy,splitPie:this.splitPie,sID:seriesId,gID:groupId,metricIndexForLabelForGridPie:metricIndexForLabelForGridPie});this.cache[r][c]=cell;}return cell;}function sortAndFilterMetricsInTooltip(arr){var gc=this,i,lds=this.dp.lds,gmm=lds.gmm,metricCompatibleZones=[$ZONE_IDs.XAXIS,$ZONE_IDs.YAXIS,$ZONE_IDs.COLORBY,$ZONE_IDs.SIZEBY,$ZONE_IDs.TOOLTIP],chtInfo=this.chtInfo,zonesTheMetricIsIn,len=arr.length;function collectValidArr(arr){var res=[];$ARR.forEach(arr,function(m){if(m.toDelete!==true){res.push(m);}});return res;}function isHostingZone(zoneId){if(gmm.isMetricInZone(arr[i].midx,zoneId)){zonesTheMetricIsIn.push(zoneId);}}if(chtInfo.isABL){var plottingMetric=gc.getMetricIndex(0);var numericAxisID=chtInfo.dirc===ABL_DIRECTION.VERTICAL?$ZONE_IDs.YAXIS:$ZONE_IDs.XAXIS;for(i=0;i<len;i++){zonesTheMetricIsIn=[];$ARR.forEach(metricCompatibleZones,isHostingZone);if(zonesTheMetricIsIn.length===0){arr[i].toDelete=true;}if(zonesTheMetricIsIn.length===1&&zonesTheMetricIsIn[0]===numericAxisID){if(plottingMetric!==arr[i].midx){arr[i].toDelete=true;}}}}if(chtInfo.isBubbleOrScatter){var mtxIdxArr=[];this.getMetricsIndexArray(mtxIdxArr);for(i=0;i<len;i++){zonesTheMetricIsIn=[];$ARR.forEach(metricCompatibleZones,isHostingZone);if(zonesTheMetricIsIn.length===0){arr[i].toDelete=true;}if(!!!arr[i].toDelete&&mtxIdxArr.indexOf(arr[i].midx)<=-1){if(zonesTheMetricIsIn.indexOf($ZONE_IDs.TOOLTIP)===-1&&zonesTheMetricIsIn.indexOf($ZONE_IDs.COLORBY)===-1){arr[i].toDelete=true;}}}}if(chtInfo.isPie){var pieAggMetricZones=[$ZONE_IDs.XAXIS,$ZONE_IDs.YAXIS,$ZONE_IDs.SIZEBY];for(i=0;i<len;i++){if(arr[i].toDelete===true){continue;}zonesTheMetricIsIn=[];$ARR.forEach(pieAggMetricZones,isHostingZone);if(zonesTheMetricIsIn.length===0){arr[i].toDelete=true;}}}return collectValidArr(arr);}function verifyCoordinates(coordinates){return(coordinates.R!==undefined&&coordinates.C!==undefined&&coordinates.oy!==undefined&&coordinates.ox!==undefined);}function getTooltipContentForDataPoint(contentArr,forSelection,includeMetrics){var lds=this.dp.lds,chtInfo=this.chtInfo,model=lds.gmm,gmCtr=model.gmCtr,rcnt=gmCtr.rowHeaderCnt,ccnt=gmCtr.colHeaderCnt,allRowHeaders,allColHeaders,attrOnRCnt=model.getUnitAttributesCountOnRow(true),attrOnCCnt=model.getUnitAttributesCountOnCol(true),attrOnSliceBy=gmCtr.getGMHeaderCount("SliceBy"),lastRIdxBeforeSlice=attrOnRCnt,lastCIdxBeforeSlice=attrOnCCnt,inChartRowHeaderCnt,inChartColHeaderCnt,nullPushed=contentArr.length===0,rowTitleArr,colTitleArr,i,ilcs,metricNames=model.getMetricNames(),metricCnt=metricNames.length,value,tempArr,cnt;var o=this.groupData[0],ox=lds.getOffsetX(),oy=lds.getOffsetY(),lr=o.R-oy,lc=o.C-ox;inChartRowHeaderCnt=attrOnRCnt-rcnt;inChartColHeaderCnt=attrOnCCnt-ccnt;if(attrOnSliceBy>0&&chtInfo.isPie){if(chtInfo.isABL&&chtInfo.dirc===$GM.EnumABLDirection.HORIZONTAL){inChartColHeaderCnt-=attrOnSliceBy;lastCIdxBeforeSlice-=attrOnSliceBy;}else{inChartRowHeaderCnt-=attrOnSliceBy;lastRIdxBeforeSlice-=attrOnSliceBy;}}if(inChartRowHeaderCnt>0){allRowHeaders=lds.getRowHeaders(lr,"all",forSelection===true?"n&id&dei&o&at&idx":"n&idx");rowTitleArr=model.getRowTitleInfo();if(contentArr.length>0){if(!forSelection){contentArr.push(null);}nullPushed=true;}GMUTIL.generateToolTipContent(rcnt,lastRIdxBeforeSlice,true,rowTitleArr,allRowHeaders,contentArr,!forSelection);}if(inChartColHeaderCnt>0){allColHeaders=lds.getColHeaders(lc,"all",forSelection===true?"n&id&dei&o&at&idx":"n&idx");colTitleArr=model.getColTitleInfo();if(!nullPushed&&contentArr.length>0){if(!forSelection){contentArr.push(null);}nullPushed=true;}GMUTIL.generateToolTipContent(ccnt,lastCIdxBeforeSlice,false,colTitleArr,allColHeaders,contentArr,!forSelection);}if(!forSelection&&metricCnt>0){if(!nullPushed&&contentArr.length>0){if(!forSelection){contentArr.push(null);}nullPushed=true;}tempArr=[];ilcs=[];ilcs.push(lc);for(i=0;i<metricCnt;i++){value=lds.getAssoDataWithMetricIndex(lr,ilcs,i,false);tempArr.push({n:metricNames[i],v:value,midx:i});}tempArr=sortAndFilterMetricsInTooltip.call(this,tempArr);cnt=tempArr.length;for(i=0;i<cnt;i++){contentArr.push(tempArr[i]);}if(chtInfo.isABL&&chtInfo.sbtp===SUB_TYPE.PERCENT){var groupIdx=o.grp,totalGroupValue=this.dp.getTotalOfGroup(groupIdx),tooltipValue=this.getData(0),pctTitle=mstrmojo.desc(14141,"Percent Contribution"),pct=tooltipValue/totalGroupValue;pct=(pct*100).toFixed(2)+"%";contentArr.push({n:pctTitle,v:pct,isPerCon:true});}}if(forSelection&&includeMetrics){var mtxIdxArr=[],k,len,mtxIds,mtxNms;this.getMetricsIndexArray(mtxIdxArr);mtxIdxArr=mtxIdxArr.slice(0,this.groupData.length);len=mtxIdxArr.length;mtxIds=model.getMetricIDsFromIndex(mtxIdxArr);mtxNms=model.getMetricNamesFromIndex(mtxIdxArr);for(k=0;k<len;k++){contentArr.push({eid:mtxIds[k],n:"Metrics",tid:-1,v:mtxNms[k]});}}return contentArr;}function getData(lds,o){var ox=lds.getOffsetX(),oy=lds.getOffsetY(),lr=o.R-oy,lc=o.C-ox;return lds.getData(lr,lc);}function getChartObjInfo(forSelection,includeMetrics){var isPie=this.isPie,gc=this.gc,sPieDP=this.sPieDP,sliceIdx=this.sliceIdx,tooltipCtt;if(!isPie){tooltipCtt=gc.getTooltipContent(forSelection,includeMetrics);}else{tooltipCtt=sPieDP.getTooltipContent(sliceIdx,forSelection,includeMetrics);}return tooltipCtt;}function searchTemplateUnit(templateUnit,unitId){var i,len;if(templateUnit){len=templateUnit.length;for(i=0;i<len;i++){if(templateUnit[i].id===unitId){return i;}}}return -1;}function getObjectInfo(attIds,keepMetrics){var allInfo,res=[],reverseMap;allInfo=this.getSelectedObjectInfo(keepMetrics);reverseMap=GMUTIL.reverseMapping(attIds);$ARR.forEach(allInfo,function(selInfo){if(selInfo.tid===-1){res.push(selInfo);}else{if(reverseMap[selInfo.tid]!==undefined){res.push(selInfo);}}});return res;}var CategoricalAxisLabelIdentity=mstrmojo.declare(mstrmojo.Base,null,{init:function init(props){this._super(props);var gc=this.gc,gmCtr,dz,hInfo,unit,dzArr,singleZone,i,dropZoneId=-1,dropZoneIndex=-1;if(this.isFaked){return ;}gmCtr=gc.dp.lds.gmm.gmCtr;dz=gmCtr.dz;hInfo=this.hInfo;if(hInfo.isAtt===false){return ;}unit=hInfo.unit;dzArr=["XAxis","YAxis"];if(unit.otp!==4){for(i=0;i<dzArr.length;i++){singleZone=dz[dzArr[i]];var idx=searchTemplateUnit(singleZone.TemplateUnit,unit.id);if(idx>=0){dropZoneIndex=idx;if(i===0){dropZoneId=XAXIS;}else{dropZoneId=YAXIS;}break;}}this.dzindex=dropZoneIndex;this.dzid=dropZoneId;}}});var Identity=mstrmojo.declare(mstrmojo.Base,null,{getGraphCell:function(){var gc;if(this.isPie){gc=this.sPieDP.graphCell;}else{gc=this.gc;}return gc;},getShape:function(){var chtInfo=this.getChartInfo();if(chtInfo.isABL){return this.getGraphCell().getShape();}return chtInfo.shape;},getAssMetricDataLabelID:function(){var dlAssMtc,gc=this.getGraphCell(),gmCtr=gc.getGMCtr(),chtInfo=gc.chtInfo;if(this.isPie===false){if(chtInfo.isABL){dlAssMtc=gc.getMetric(0);}else{if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){dlAssMtc=gc.getMetric(1);}else{if(!gmCtr.hasSizeBy()){dlAssMtc=undefined;}else{dlAssMtc=hGetMetric.call(gc,gmCtr.getSizeByMetrics()[0]);}}}}else{var sPieDP=this.sPieDP,sliceIdx=this.sliceIdx;dlAssMtc=sPieDP.getMetric(sliceIdx);}if(dlAssMtc!==undefined){return dlAssMtc.id;}return undefined;},getTooltipContent:function(){return getChartObjInfo.call(this,false);},getSelectedObjectInfo:function(includeMetrics){var key=includeMetrics?"objectInfoWithMetric":"objectInfo";if(this[key]){return this[key];}var objInfo=getChartObjInfo.call(this,true,includeMetrics),selObjArr=[];$ARR.forEach(objInfo,function(element){if(element){selObjArr.push(element);}});if(selObjArr.length>1){selObjArr.sort(GMUTIL.compareElementObj);}this[key]=selObjArr;return selObjArr;},getSelectedObjectMetricInfo:function(existingInfo){if(this.objectMetricInfo){return this.objectMetricInfo;}var allInfo,res=[];if(existingInfo){allInfo=existingInfo;}else{allInfo=this.getSelectedObjectInfo(true);}$ARR.forEach(allInfo,function(selInfo){if(selInfo.tid===-1){res.push(selInfo);}});this.objectMetricInfo=res;return res;},getSelectedObjectColorByInfo:function(){if(this.objectColorByInfo){return this.objectColorByInfo;}var res=[],gc,model,gmCtr,colorByAttId,cbTp,keepMetrics=false;if(this.isPie){gc=this.sPieDP.graphCell;}else{gc=this.gc;}model=gc.dp.lds.gmm;gmCtr=model.gmCtr;if(model.colorType!==COLOR_BY_TYPE.NULL){colorByAttId=gmCtr.getColorByAttrsID();if(model.colorType===COLOR_BY_TYPE.ATT_METRICS||model.colorType===COLOR_BY_TYPE.METRICS_ITEM){keepMetrics=true;}res=getObjectInfo.call(this,colorByAttId,keepMetrics);cbTp=gmCtr.colorByInfo.tp;if(cbTp===COLOR_BY_TYPE.METRICS_ITEM||cbTp===COLOR_BY_TYPE.ATT_METRICS){if(gc&&gc.chtInfo&&gc.chtInfo.isBubbleOrScatter){var sizeByFormat=gc.getSizeByMetricFormat();if(sizeByFormat){res.push({eid:sizeByFormat.id,n:"Metrics",tid:-1,v:sizeByFormat.metric});}}}}this.objectColorByInfo=res;return res;},getSelectedObjectBreakByInfo:function(includeMetrics){var cacheKey=includeMetrics?"objectBreakByInfoWithMetric":"objectBreakByInfo";if(this[cacheKey]){return this[cacheKey];}var res,gc,model,gmCtr,colorByAttId,breakByAttId;if(this.isPie){gc=this.sPieDP.graphCell;}else{gc=this.gc;}model=gc.dp.lds.gmm;gmCtr=model.gmCtr;colorByAttId=gmCtr.getColorByAttrsID();breakByAttId=gmCtr.getBreakByAttrsID();res=getObjectInfo.call(this,breakByAttId.concat(colorByAttId),includeMetrics);this[cacheKey]=res;return res;},getSelectedObjectSliceByInfo:function(includeMetrics){var cacheKey=includeMetrics?"objectSliceByInfoWithMetric":"objectSliceByInfo";if(this[cacheKey]){return this[cacheKey];}var res,gc,model,gmCtr,colorByAttId,breakByAttId,sliceByAttId;if(this.isPie){gc=this.sPieDP.graphCell;}else{gc=this.gc;}model=gc.dp.lds.gmm;gmCtr=model.gmCtr;colorByAttId=gmCtr.getColorByAttrsID();breakByAttId=gmCtr.getBreakByAttrsID();sliceByAttId=gmCtr.getSliceByAttrsID();res=getObjectInfo.call(this,breakByAttId.concat(colorByAttId.concat(sliceByAttId)),includeMetrics);this[cacheKey]=res;return res;},getSelectedSliceAngleByMetric:function(){if(this.isPie){return this.sPieDP.getSelectedSliceAngleByMetric(this.sliceIdx);}return undefined;},getSelectedObjectLowestLevel:function(includeMetrics){var gc=this.getGraphCell(),chtInfo=gc.chtInfo;if(chtInfo.isPie){return this.getSelectedObjectSliceByInfo(includeMetrics);}return this.getSelectedObjectBreakByInfo(includeMetrics);},isEqualToObjectInfo:function(objInfoForAnotherShape,includeMetrics){var mySelInfo=this.getSelectedObjectInfo(includeMetrics);return GMUTIL.isEqualComb(mySelInfo,objInfoForAnotherShape);},isEqualToIdentity:function(anotherIdentity,includeMetrics){if(!anotherIdentity){return false;}return this.isEqualToObjectInfo(anotherIdentity.getSelectedObjectInfo(includeMetrics),includeMetrics);},getChartInfo:function(){var gc=this.gc||this.sPieDP.graphCell,dp=gc.dp,gmCtr=dp.lds.gmm.gmCtr;var info=gmCtr.getChartInfo();if(info.isCombo){info.currentMarkerShape=dp.getShapeBySeries(gc.sID);if(info.currentMarkerShape===7){info.currentMarkerShape=200;}else{if(info.currentMarkerShape===2){info.currentMarkerShape=204;}else{if(info.currentMarkerShape===1){info.currentMarkerShape=205;}else{if(info.currentMarkerShape===0){info.currentMarkerShape=206;}else{if(info.currentMarkerShape===4){info.currentMarkerShape=4;}else{if(info.currentMarkerShape===5||info.currentMarkerShape===6){info.currentMarkerShape=24;}}}}}}}else{if(info.isABL&&info.ceMarkerShape===undefined){info.ceMarkerShape=dp.getShapeBySeries(gc.sID);if(info.ceMarkerShape===7){info.ceMarkerShape=200;}else{if(info.ceMarkerShape===2){info.ceMarkerShape=204;}else{if(info.ceMarkerShape===1){info.ceMarkerShape=205;}else{if(info.ceMarkerShape===0){info.ceMarkerShape=206;}else{if(info.ceMarkerShape===4){info.ceMarkerShape=4;}else{if(info.ceMarkerShape===5||info.ceMarkerShape===6){info.ceMarkerShape=24;}}}}}}}info.currentMarkerShape=info.ceMarkerShape;}return info;}});var SinglePieDP=mstrmojo.declare(mstrmojo.Base,null,{graphCell:undefined,tot:undefined,sliceByMetrics:undefined,sliceIdentities:undefined,init:function init(props){this._super(props);this.dataCache={};this.sliceIdentities=[];this.sliceDataLabelIdentities=[];var innerSliceCount=this.innerGetSliceCount(),i,allValid=true,validSlices=[];for(i=0;i<innerSliceCount;i++){if(this.innerGetData(i)!==0){validSlices.push(i);}else{allValid=false;}}this.allValid=allValid;this.validSlices=validSlices;},innerGetSliceCount:function(){var gc=this.graphCell,data=gc.groupData,slicesOfPie=data.slicesOfPie,abLen=this.angleBy.length,gmm=gc.dp.lds.gmm,onlyMetricNamesOnAxisForGridPie=gmm.onlyMetricNamesOnAxisForGridPie;if(abLen===0){return slicesOfPie.length;}if(onlyMetricNamesOnAxisForGridPie){abLen=1;}return slicesOfPie.length*abLen;},getInnerSliceIndex:function(sliceIdx,isInner){if(isInner){return sliceIdx;}return this.validSlices[sliceIdx];},getOutSliceIndex:function(sliceIdx,isInner){if(isInner){var i;if(this.allValid){return sliceIdx;}for(i=0;i<this.validSlices.length;i++){if(this.validSlices[i]===sliceIdx){return i;}}}return sliceIdx;},getSelectedSliceAngleByMetric:function(sliceIdx){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx),model=this.graphCell.dp.lds.gmm,abLen=this.angleBy.length;if(abLen>0){var metricName=this.getMetricNameOfSlice(innerSliceIdx,true),metricIndex=this.getMetricIndexOfSlice(innerSliceIdx,true);return{n:"Metrics",tid:-1,v:metricName,eid:model.getMetricIDsFromIndex([metricIndex])[0]};}return undefined;},getSliceCount:function(){return this.validSlices.length;},getTooltipContent:function(sliceIdx,forSelection,includeMetrics){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx),tooltipCtt,gc=this.graphCell,sliceTts=this.getSliceTitles(),sliceLbs=this.getSliceLabel(innerSliceIdx,true),cnt=sliceTts.length,abLen=this.angleBy.length,i,tooltipMetrics,metricName,metricValue,pctTitle,pct,mIdx,model=gc.dp.lds.gmm,gmCtr=model.gmCtr,metricIndex,mNms=model.getMetricNames();tooltipCtt=gc.getTooltipContent(forSelection,includeMetrics);if(tooltipCtt.length>0&&tooltipCtt[tooltipCtt.length-1]!==null){if(!forSelection){tooltipCtt.push(null);}}GMUTIL.generateToolTipContent(0,cnt,undefined,sliceTts,sliceLbs,tooltipCtt);if(abLen>0){metricName=this.getMetricNameOfSlice(innerSliceIdx,true);metricIndex=this.getMetricIndexOfSlice(innerSliceIdx,true);if(!forSelection){metricValue=this.innerGetData(innerSliceIdx,metricIndex,false);for(i=0;i<tooltipCtt.length;i++){if(tooltipCtt[i]!==null&&(tooltipCtt[i].n===metricName||tooltipCtt[i].isPerCon)){tooltipCtt[i].n=mstrmojo.desc(2121,"Total")+" "+tooltipCtt[i].n;}}tooltipCtt.push({n:metricName,v:metricValue});pctTitle=mstrmojo.desc(14141,"Percent Contribution");pct=this.getPercentage(innerSliceIdx,true);pct=(pct*100).toFixed(2)+"%";tooltipCtt.push({n:pctTitle,v:pct});var colorByInfo=gmCtr.colorByInfo;if(colorByInfo.tp===COLOR_BY_TYPE.METRICS&&colorByInfo.metrics){var colorByN=colorByInfo.metrics[0].n;if(colorByN!==metricName){for(i=0;i<tooltipCtt.length;i++){if(tooltipCtt[i]!==null&&tooltipCtt[i].n===colorByN){tooltipCtt[i].n=mstrmojo.desc(2121,"Total")+" "+tooltipCtt[i].n;}}tooltipCtt.push({n:colorByN,v:this.innerGetData(innerSliceIdx,colorByInfo.metrics[0].idx,false)});}}}else{if(model.colorType===COLOR_BY_TYPE.ATT_METRICS||model.colorType===COLOR_BY_TYPE.METRICS_ITEM){tooltipCtt.push({n:"Metrics",tid:-1,v:metricName,eid:model.getMetricIDsFromIndex([metricIndex])[0]});}}}if(!forSelection){tooltipMetrics=gmCtr.getMetricsOnTooltip();cnt=tooltipMetrics.length;for(i=0;i<cnt;i++){mIdx=tooltipMetrics[i];metricName=mNms[mIdx];metricValue=this.innerGetData(innerSliceIdx,mIdx,false);tooltipCtt.push({n:metricName,v:metricValue});}}return tooltipCtt;},getDataLabelIdentity:function(sliceIdx,isInner){var outSliceIndex=this.getOutSliceIndex(sliceIdx,isInner);var slcIds=this.sliceDataLabelIdentities;if(slcIds[outSliceIndex]===undefined){var gc=this.graphCell,cct=gc.dp.lds.gmm.cct,coor=this.getCoordinates(outSliceIndex),hashID=coor.R*cct+coor.C;slcIds[outSliceIndex]=new Identity({objType:IDENTITY_TYPE.DATA_LABEL,sPieDP:this,isPie:true,sliceIdx:outSliceIndex,id:hashID});}return slcIds[outSliceIndex];},getIdentity:function(sliceIdx,isInner){var outSliceIndex=this.getOutSliceIndex(sliceIdx,isInner);var slcIds=this.sliceIdentities;if(slcIds[outSliceIndex]===undefined){var gc=this.graphCell,cct=gc.dp.lds.gmm.cct,coor=this.getCoordinates(outSliceIndex),hashID=coor.R*cct+coor.C;slcIds[outSliceIndex]=new Identity({objType:IDENTITY_TYPE.GRAPH_SHAPE,sPieDP:this,isPie:true,sliceIdx:outSliceIndex,id:hashID});}return slcIds[outSliceIndex];},getCoordinates:function(sliceIdx,mIdx,isInner){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx,isInner);var gc=this.graphCell,gmm=gc.dp.lds.gmm,onlyMetricNamesOnAxisForGridPie=gmm.onlyMetricNamesOnAxisForGridPie,angleBy=this.angleBy,abLen=onlyMetricNamesOnAxisForGridPie?1:angleBy.length;var data=gc.groupData,slicesOfPie=data.slicesOfPie,row,currentSlice,lds=gc.dp.lds,ox=lds.getOffsetX(),oy=lds.getOffsetY(),lcs=[],lr,plottingObj;if(abLen>0){row=parseInt(innerSliceIdx/abLen,10);}else{row=innerSliceIdx;}currentSlice=slicesOfPie[row];plottingObj=currentSlice[0];lr=plottingObj.R-oy;lcs.push(plottingObj.C-ox);if(mIdx!==undefined){return lds.getAssoCoordinatesWithMetricIndex(lr,lcs,mIdx);}if(abLen>0){return lds.getAssoCoordinatesWithMetricIndex(lr,lcs,angleBy[innerSliceIdx%abLen]);}return lds.getAssoCoordinatesWithMetricIndex(lr,lcs,0);},getMetricNameOfSlice:function(sliceIdx,isInner){var metricIndex=this.getMetricIndexOfSlice(sliceIdx,isInner),gc=this.graphCell,model=gc.dp.lds.gmm,mNms;if(metricIndex<0){return"";}mNms=model.getMetricNames();return mNms[metricIndex];},getMetricIndexOfSlice:function(sliceIdx,isInner){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx,isInner),gc=this.graphCell,angleBy=this.angleBy,abLen=angleBy.length,metricIdx,model=gc.dp.lds.gmm,onlyMetricNamesOnAxisForGridPie=model.onlyMetricNamesOnAxisForGridPie;if(abLen===0){return -1;}if(onlyMetricNamesOnAxisForGridPie){metricIdx=gc.metricIndexForLabelForGridPie;}else{metricIdx=angleBy[innerSliceIdx%abLen];}return metricIdx;},getMetric:function getMetric(sliceIdx,isInner){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx,isInner);var idx=this.getMetricIndexOfSlice(innerSliceIdx,true);if(idx>=0){return hGetMetric.call(this.graphCell,idx);}return undefined;},isIndividualFormatted:function(sliceIdx,isInner){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx,isInner);var gmCtr=this.graphCell.getGMCtr(),identity,concreteComb,concreteLevelProp;identity=this.getIdentity(innerSliceIdx,true);concreteComb=identity.getSelectedObjectLowestLevel(true);concreteLevelProp=gmCtr.getShapeFormatsWithCombination(concreteComb);return !!concreteLevelProp;},getFormattingProperties:function(sliceIdx,isInner){var res,innerSliceIdx=this.getInnerSliceIndex(sliceIdx,isInner),identity,gmCtr=this.graphCell.getGMCtr(),defProp,allProp,metricLevelProp,colorByLevelProp,concreteLevelProp,allPropKey=$FT.ALL_SHAPE_FORMAT,metricComb,colorByComb,concreteComb;defProp=gmCtr.getDefaultsForShape(gmCtr.getChartInfo().shape);identity=this.getIdentity(innerSliceIdx,true);var shapeFormats=gmCtr.getShapeFormatsObject();if(shapeFormats){concreteComb=identity.getSelectedObjectLowestLevel(true);metricComb=identity.getSelectedObjectMetricInfo(concreteComb);colorByComb=identity.getSelectedObjectColorByInfo();}allProp=this.graphCell.getPropertyValue(allPropKey);metricLevelProp=gmCtr.getShapeFormatsWithCombination(metricComb);colorByLevelProp=gmCtr.getShapeFormatsWithCombination(colorByComb);concreteLevelProp=gmCtr.getShapeFormatsWithCombination(concreteComb);res=GMUTIL.getResolvedFormatsObject([defProp,allProp,metricLevelProp,colorByLevelProp,concreteLevelProp]);var shapeColor=this.getColorByData(innerSliceIdx,true),finalRes;if(res===defProp){finalRes=gmCtr.getVolatileDefaultsForShape(gmCtr.getChartInfo().shape);}else{finalRes=res;}shapeColor=(shapeColor!==undefined&&shapeColor!==null)?shapeColor:finalRes[$FT.SHAPE_FILL_COLOR];var isGradient=false;if(shapeColor&&typeof shapeColor==="object"){isGradient=true;}if(shapeColor!==undefined){finalRes[$FT.SHAPE_LINE_COLOR]=finalRes[$FT.SHAPE_FILL_COLOR]=shapeColor;if(res[$FT.LINE_MARKER_COLOR]===undefined){finalRes[$FT.LINE_MARKER_COLOR]=isGradient?shapeColor.c1:shapeColor;}if(res[$FT.LINE_MARKER_BORDER_COLOR]===undefined){finalRes[$FT.LINE_MARKER_BORDER_COLOR]=isGradient?shapeColor.c1:shapeColor;}if(res[$FT.SHAPE_BORDER_COLOR]===undefined){finalRes[$FT.SHAPE_BORDER_COLOR]=isGradient?shapeColor.c1:shapeColor;}}finalRes[$FT.SHAPE_FILL_STYLE]=isGradient?SpFlTp.Gradient:SpFlTp.Solid;var metricLvlDL=this.graphCell.getPropertyValue($WT.METRIC_LEVEL_DATA_LABEL);if(metricLvlDL===undefined){finalRes[$FT.DATA_LABELS_SHOW]=METRIC_LVL_DATA_LABEL_SHOW;}else{var dlAssMtcId=identity.getAssMetricDataLabelID();if(dlAssMtcId!==undefined){finalRes[$FT.DATA_LABELS_SHOW]=metricLvlDL[dlAssMtcId];}else{finalRes[$FT.DATA_LABELS_SHOW]=false;}}return finalRes;},getData:function(sliceIdx,mIdx,raw){var innerSliceIdx=this.validSlices[sliceIdx];return this.innerGetData(innerSliceIdx,mIdx,raw);},innerGetData:function(innerSliceIdx,mIdx,raw){if(this.dataCache[innerSliceIdx]){return this.dataCache[innerSliceIdx];}var gc=this.graphCell,angleBy=this.angleBy,abLen=angleBy.length,coordinate,v,i,j,lds=gc.dp.lds;coordinate=this.getCoordinates(innerSliceIdx,mIdx,true);i=coordinate.R-coordinate.oy;j=coordinate.C-coordinate.ox;var bareMetricsInGrid=false,gmm=lds.gmm,gmCtr=gmm.gmCtr;bareMetricsInGrid=(gmCtr.isGrid()&&gmm.getMetricCount()===0);if(!bareMetricsInGrid&&lds.checkExcluded(i,j)){return 0;}if(abLen===0&&mIdx===undefined){return 1;}v=lds.getData(i,j,raw,mIdx);if(raw&&isNaN(v)){return 0;}return v;},getColorByData:function(sliceIdx,isInner,useDefaults){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx,isInner),metricIdx;var gc=this.graphCell,mtsIdxArr=[],coor,angleBy=this.angleBy,abLen=angleBy.length,v,lds=gc.dp.lds,model=lds.gmm;if(model.colorType===COLOR_BY_TYPE.NULL){return null;}coor=this.getCoordinates(innerSliceIdx,undefined,true);if(model.colorType===COLOR_BY_TYPE.ATT_METRICS||model.colorType===COLOR_BY_TYPE.METRICS_ITEM){gc.getMetricsIndexArray(mtsIdxArr);if(angleBy.length!==0){metricIdx=this.getMetricIndexOfSlice(sliceIdx,isInner);if(metricIdx<0){metricIdx=angleBy[innerSliceIdx%abLen];}mtsIdxArr.push(metricIdx);}}v=lds.getColorByValue(coor.R-coor.oy,coor.C-coor.ox,mtsIdxArr,useDefaults);return v;},getPercentage:function(sliceIdx,isInner){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx,isInner),v=Math.abs(this.innerGetData(innerSliceIdx)),tot=this.getAbsTotalValue();return v/tot;},getSliceTitles:function(){var lds=this.graphCell.dp.lds,model=lds.gmm,ctr=model.gmCtr,chtInfo=ctr.getChartInfo(),unitsCountInSliceBy=ctr.getGMHeaderCount("SliceBy"),isABL=chtInfo.isABL,eGT=CHART_TYPE,dirc=chtInfo.dirc,tp=chtInfo.tp,eABLDirc=$GM.EnumABLDirection,titleArr;if((isABL&&dirc===eABLDirc.VERTICAL)||(tp===eGT.GRID)||(tp===eGT.BUBBLE||tp===eGT.SCATTER)){titleArr=model.getRowTitleInfo();}else{titleArr=model.getColTitleInfo();if(titleArr.length>0){var lastItem=titleArr[titleArr.length-1];if(lastItem.otp===-1){titleArr=titleArr.slice(0,titleArr.length-1);}}}return titleArr.slice(titleArr.length-unitsCountInSliceBy);},getSliceLabel:function(sliceIdx,isInner){var innerSliceIdx=this.getInnerSliceIndex(sliceIdx,isInner);var lds=this.graphCell.dp.lds,ctr=lds.gmm.gmCtr,chtInfo=ctr.getChartInfo(),unitsCountInSliceBy=ctr.getGMHeaderCount("SliceBy"),gc=this.graphCell,angleBy=this.angleBy,abLenTp=angleBy.length,abLen=abLenTp>0&&!lds.gmm.onlyMetricNamesOnAxisForGridPie?abLenTp:1,data=gc.groupData,slicesOfPie=data.slicesOfPie,row=parseInt(innerSliceIdx/abLen,10),currentSlice=slicesOfPie[row],ox=lds.getOffsetX(),oy=lds.getOffsetY(),lc,lr,plottingObj=currentSlice[0],lbs,isABL=chtInfo.isABL,eGT=CHART_TYPE,dirc=chtInfo.dirc,tp=chtInfo.tp,eABLDirc=$GM.EnumABLDirection;if(unitsCountInSliceBy<=0){return[];}if((isABL&&dirc===eABLDirc.VERTICAL)||(tp===eGT.GRID)||(tp===eGT.BUBBLE||tp===eGT.SCATTER)){lr=plottingObj.R-oy;lc=plottingObj.C-ox;lbs=lds.getRowHeaders(lr,"SliceBy","n&id&tid&dei&o&at&idx");if(lbs.length>unitsCountInSliceBy){return lbs.slice(lbs.length-unitsCountInSliceBy);}return lbs;}lr=plottingObj.R-oy;lc=plottingObj.C-ox;lbs=lds.getColHeaders(lc,"SliceBy","n&id&tid&dei&o&at&idx");if(lbs.length>unitsCountInSliceBy){lbs=lbs.slice(0,lbs.length-1);return lbs.slice(lbs.length-unitsCountInSliceBy);}return lbs;},getTotalValue:function(){if(this.tot!==undefined){return this.tot;}var tot=0,i,sliceCnt=this.getSliceCount();for(i=0;i<sliceCnt;i++){tot=tot+this.getData(i);}this.tot=tot;return tot;},getAbsTotalValue:function(){if(this.tot!==undefined){return this.tot;}var tot=0,i,sliceCnt=this.getSliceCount();for(i=0;i<sliceCnt;i++){tot=tot+Math.abs(this.getData(i));}this.tot=tot;return tot;},testSinglePieDP:function(){var slcCnt,i,tot,data,hashID,gc=this.graphCell,lds=gc.dp.lds,model=lds.gmm,color="default",lbs;slcCnt=this.getSliceCount();tot=this.getTotalValue();$VISUTILS.visPrint("the angle by metric is "+this.angleBy.join(","));function collectLb(o){lbs.push(o.n);}for(i=0;i<slcCnt;i++){data=this.getData(i);if(model.colorType!==COLOR_BY_TYPE.NULL){color=this.getColorByData(i);}hashID=this.getIdentity(i).id;var sliceLabelObject=this.getSliceLabel(i);lbs=[];$ARR.forEach(sliceLabelObject,collectLb);$VISUTILS.visPrint("slice "+i+" ("+hashID+")  is "+data+" ("+this.getPercentage(i)+") with slice labels: "+lbs.join(","));$VISUTILS.visPrint("color is: "+color);this.getIdentity(i).getTooltipContent();}}});var FakedGraphCell=mstrmojo.declare(mstrmojo.Base,null,{getGroupLabelIdentities:function(){var i,res=[];for(i=0;i<10;i++){res.push(new CategoricalAxisLabelIdentity({gc:this,isGroup:true,isFaked:true}));}return res;},getFormattingProperties:function(){return undefined;},getSeriesLabelIdentities:function(){var i,res=[];for(i=0;i<10;i++){res.push(new CategoricalAxisLabelIdentity({gc:this,isGroup:false,isFaked:true}));}return res;},getSinglePieDPs:function(){return null;},getFormat:function getFormat(){return{};},getMetric:function getMetric(){return null;},getMetricIndex:function getMetricIndex(){return null;},getMetricNumberWithDataIndex:function(){return null;},getMetricFormat:function(){return null;},getAxisMetricIndexArr:function(){return null;},getData:function getData(){return null;},getIdentity:function(){return{isFaked:true};},getSliceIdentity:function(){return null;},getAssoDataWithMetricIndex:function(){return null;},getSizeByData:function getSizeByData(){return null;},getMetricsIndexArray:function getMetricsIndexArray(){return null;},getColorByData:function getColorByData(){return null;},getSeriesLabel:function getSeriesLabel(){return null;},getGroupLabel:function getGroupLabel(){var dp=this.dp,lds=dp.lds,flb=lds.flb,blb=lds.blb,gIdx=this.gIdx,bwdSteps=dp.bwdSteps,fwdSteps=dp.fwdSteps,oriGroupCount,res;if(!dp.bwdEnabled){bwdSteps=0;}if(!dp.fwdEnabled){fwdSteps=0;}if(dp.oriGroupCount<0){this.getGroupCount();}oriGroupCount=dp.oriGroupCount;if(gIdx<bwdSteps){res=blb[gIdx];}else{res=flb[gIdx-bwdSteps-oriGroupCount];}if(res){return res;}return[];},getThresholdIndex:function getThresholdIndex(){return null;},getThreshold:function getThreshold(){return null;},getRowIndex:function getRowIndex(){return null;},getColIndex:function getColIndex(){return null;},getTooltipContent:function(){return null;}});var GraphCell=mstrmojo.declare(mstrmojo.Base,null,{getGMCtr:function(){var dp=this.dp,lds=dp.lds,gmm=lds.gmm;return gmm.gmCtr;},getGroupLabelIdentities:function(dataIndex){if(dataIndex===undefined){dataIndex=0;}if(this.gCateAxisLbIdCache===undefined){this.gCateAxisLbIdCache=[];}if(this.gCateAxisLbIdCache[dataIndex]){return this.gCateAxisLbIdCache[dataIndex];}var i,res=[],o,dp,lds,ox,oy,lr,lc,headerInfos;o=this.groupData[dataIndex];dp=this.dp;lds=dp.lds;ox=lds.getOffsetX();oy=lds.getOffsetY();lr=o.R-oy;lc=o.C-ox;headerInfos=lds.getGroupLabel(lr,lc,true);for(i=0;i<headerInfos.length;i++){res.push(new CategoricalAxisLabelIdentity({gc:this,isGroup:true,hInfo:headerInfos[i]}));}this.gCateAxisLbIdCache[dataIndex]=res;return res;},getPropertyValue:function(propName){var dp=this.dp,lds=dp.lds,gmm=lds.gmm,property=gmm.property;return property.readItem(propName);},getShapeFormatsWithCombination:function(elemComb){return this.getGMCtr().getShapeFormatsWithCombination(elemComb);},isIndividualFormatted:function(){var gmCtr=this.getGMCtr(),identity,concreteComb,concreteLevelProp;identity=this.getIdentity();concreteComb=identity.getSelectedObjectLowestLevel(true);concreteLevelProp=gmCtr.getShapeFormatsWithCombination(concreteComb);return !!concreteLevelProp;},getFormattingProperties:function(){var res,finalRes,identity,gmCtr=this.getGMCtr(),shareProp,mergeProp;if(gmCtr.getChartInfo().isPie){$VISUTILS.visPrint("for pie chart, call getFormattingPropertiesOfSlice of SinglePieDataProvider instead");return undefined;}identity=this.getIdentity();finalRes=gmCtr.getShapeFormatsCachedObject(identity);if(!finalRes){shareProp=gmCtr.getDefaultsMergedWithAllPropsCachedObject(this);mergeProp=gmCtr.getComboLevelPropCachedObject(identity);res=GMUTIL.getResolvedFormatsObject([shareProp].concat(mergeProp));finalRes=gmCtr.getShapeColorFormatsCachedObject(this,identity,res,res===shareProp);gmCtr.setShapeFormatsCachedObject(identity,finalRes);}return finalRes;},getSeriesLabelIdentities:function(dataIndex){if(dataIndex===undefined){dataIndex=0;}if(this.sCateAxisLbIdCache===undefined){this.sCateAxisLbIdCache=[];}if(this.sCateAxisLbIdCache[dataIndex]){return this.sCateAxisLbIdCache[dataIndex];}var i,res=[],o,dp,lds,ox,oy,lr,lc,headerInfos;o=this.groupData[dataIndex];dp=this.dp;lds=dp.lds;ox=lds.getOffsetX();oy=lds.getOffsetY();lr=o.R-oy;lc=o.C-ox;headerInfos=lds.getSeriesLabel(lr,lc,true);for(i=0;i<headerInfos.length;i++){res.push(new CategoricalAxisLabelIdentity({gc:this,isGroup:false,hInfo:headerInfos[i]}));}this.sCateAxisLbIdCache[dataIndex]=res;return res;},getGroupElementIndexArray:function(xvar,dataIndex){var o=this.groupData[dataIndex],dp=this.dp,lds=dp.lds,ox=lds.getOffsetX(),oy=lds.getOffsetY(),lr=o.R-oy,lc=o.C-ox;return lds.getGroupElementIndexArray(lr,lc,xvar);},getBreakByElementIndexArray:function(useCompactResult){var dp=this.dp,lds=dp.lds,ox=lds.getOffsetX(),oy=lds.getOffsetY(),o,lr,lc,ordinal,axis,chtInfo=lds.getChartInfo();o=this.groupData[0];lr=o.R-oy;lc=o.C-ox;if(chtInfo.isABL&&chtInfo.dirc===ABL_DIRECTION.HORIZONTAL){axis=1;ordinal=lc;}else{ordinal=lr;axis=0;}var bbObjList=lds.getHeaderObjectList(ordinal,axis,"BreakBy");if(useCompactResult){var res=[];$ARR.forEach(bbObjList,function(bbObj){res.push(bbObj.idx);});return res;}return bbObjList;},getSinglePieDPs:function(){if(this.pieDps){return this.pieDps;}var chtInfo=this.getGMCtr().getChartInfo(),isPie=chtInfo.isPie,metricsOnAngleBy=this.metricsOnAngleBy,splitPie=this.splitPie,pieCnt,pieDps=[],i,pieDp,evenPie=false,angleBy;if(!isPie){return pieDps;}if(splitPie){pieCnt=metricsOnAngleBy.length;if(pieCnt===0){evenPie=true;pieCnt=1;}for(i=0;i<pieCnt;i++){if(evenPie){angleBy=[];}else{angleBy=metricsOnAngleBy.slice(i,i+1);}pieDp=new SinglePieDP({angleBy:angleBy,graphCell:this,chtInfo:chtInfo});pieDps.push(pieDp);}}else{pieDp=new SinglePieDP({angleBy:metricsOnAngleBy,graphCell:this,chtInfo:chtInfo});pieDps.push(pieDp);}this.pieDps=pieDps;return pieDps;},getFormat:function getFormat(dataIndex){return this.getMetric(dataIndex);},getMetric:function getMetric(dataIndex){var idx=this.getMetricIndex(dataIndex);return hGetMetric.call(this,idx);},getShape:function getShape(dataIndex){dataIndex=dataIndex||0;var mcIdx=this.getMetricIndex(dataIndex),dp=this.dp,lds=dp.lds,model=lds.gmm,gmCtr=model.gmCtr;return gmCtr.getOnTheFlyShapeForMetric(mcIdx);},getMetricIndex:function getMetricIndex(dataIndex){var o=this.groupData[dataIndex];return o.mIdx;},getMetricNumberWithDataIndex:function(dataIndex){var lds=this.dp.lds,mIdx=this.getMetricIndex(dataIndex);return lds.getMetricNumberFormat(mIdx);},getMetricFormat:function(metricIndex){var lds=this.dp.lds;return lds.getMetricNumberFormat(metricIndex);},getAxisMetricIndexArr:function(idxArr){var groupData=this.groupData,len=groupData.length,i;for(i=0;i<len;i++){idxArr.push(this.getMetricIndex(i));}return idxArr;},getData:function getData(dataIndex){var o=this.groupData[dataIndex],dp=this.dp,lds=dp.lds,ox=lds.getOffsetX(),oy=lds.getOffsetY(),lr=o.R-oy,lc=o.C-ox;return lds.getData(lr,lc);},getIdentity:function(){if(!this.identity){var isPie=this.getGMCtr().getChartInfo().isPie,cct=this.dp.lds.gmm.cct,dd=this.groupData[0],hashID=dd.R*cct+dd.C;this.identity=new Identity({objType:IDENTITY_TYPE.GRAPH_SHAPE,gc:this,id:hashID,isPie:isPie});}return this.identity;},getMarkerIdentity:function(){if(!this.mkIdentity){var isPie=this.getGMCtr().getChartInfo().isPie,cct=this.dp.lds.gmm.cct,dd=this.groupData[0],hashID=dd.R*cct+dd.C;this.mkIdentity=new Identity({objType:IDENTITY_TYPE.LINE_MARKER,gc:this,id:hashID,isPie:isPie});}return this.mkIdentity;},getDataLabelIdentity:function(){if(!this.dataLabelIdentity){var isPie=this.getGMCtr().getChartInfo().isPie,cct=this.dp.lds.gmm.cct,dd=this.groupData[0],hashID=dd.R*cct+dd.C;this.dataLabelIdentity=new Identity({objType:IDENTITY_TYPE.DATA_LABEL,gc:this,id:hashID,isPie:isPie});}return this.dataLabelIdentity;},getSliceIdentity:function(angleByID,sliceID){var singlePieDP=this.getSinglePieDPs()[angleByID];return singlePieDP.getIdentity(sliceID);},getAssoDataWithMetricIndex:function(midx,raw){var dp=this.dp,lds=dp.lds,len=this.groupData.length,lcs=[],ox=lds.getOffsetX(),oy=lds.getOffsetY(),i,lr;for(i=0;i<len;i++){lcs.push(this.groupData[i].C-ox);}lr=this.groupData[0].R-oy;return lds.getAssoDataWithMetricIndex(lr,lcs,midx,raw);},getSizeByMetricFormat:function getSizeByMetricFormat(){var chtInfo=this.dp.getChartInfo(),dp=this.dp,lds=dp.lds,sbIdx;if(!chtInfo.isBubbleOrScatter){var gmCtr=this.getGMCtr();if(!gmCtr.hasSizeBy()){return undefined;}sbIdx=gmCtr.getSizeByMetrics()[0];}else{var obj=getRandLCS.call(this);sbIdx=lds.getSizeByMetricIndexForBubble(obj.lr,obj.lcs);}return hGetMetric.call(this,sbIdx);},getSizeByData:function getSizeByData(){var dp=this.dp,lds=dp.lds,len=this.groupData.length,lcs=[],ox=lds.getOffsetX(),oy=lds.getOffsetY(),i,lr;for(i=0;i<len;i++){lcs.push(this.groupData[i].C-ox);}lr=this.groupData[0].R-oy;return lds.getSizeByData(lr,lcs);},getAbsSizeByData:function getAbsSizeByData(){return Math.abs(this.getSizeByData());},getMetricsIndexArray:function getMetricsIndexArray(mtsIdxArr){var dp=this.dp,chtInfo=dp.getChartInfo(),szbMIdx,lds=dp.lds,len=this.groupData.length,lcs=[],ox=lds.getOffsetX(),oy=lds.getOffsetY(),i,lr;if(chtInfo.tp!==CHART_TYPE.GRID){this.getAxisMetricIndexArr(mtsIdxArr);}if((chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER)&&chtInfo.hasSizeBy){for(i=0;i<len;i++){lcs.push(this.groupData[i].C-ox);}lr=this.groupData[0].R-oy;szbMIdx=lds.getSizeByMetricIndexForBubble(lr,lcs);mtsIdxArr.push(szbMIdx);}},getColorByData:function getColorByData(useDefautls){var o=this.groupData[0],dp=this.dp,lds=dp.lds,ox=lds.getOffsetX(),oy=lds.getOffsetY(),lr=o.R-oy,lc=o.C-ox,mtsIdxArr=[],model=lds.gmm;if(model.colorType===COLOR_BY_TYPE.NULL){return undefined;}if(model.getChartInfo().isPie){$VISUTILS.visPrint("not expected to call getColorByData of graph cell when in pie mode");return undefined;}if(model.colorType===COLOR_BY_TYPE.ATT_METRICS||model.colorType===COLOR_BY_TYPE.METRICS_ITEM){this.getMetricsIndexArray(mtsIdxArr);}return lds.getColorByValue(lr,lc,mtsIdxArr,useDefautls);},isSubtotal:function isSubtotal(){},getSeriesLabel:function getSeriesLabel(dataIndex){var o,dp,lds,model,ox,oy,lr,lc;if(this.seriesLabel===undefined){this.seriesLabel={};}if(this.seriesLabel[dataIndex]!==undefined){return this.seriesLabel[dataIndex];}o=this.groupData[dataIndex];dp=this.dp;lds=dp.lds;model=lds.gmm;ox=lds.getOffsetX();oy=lds.getOffsetY();lr=o.R-oy;lc=o.C-ox;if(model.onlyMetricNamesOnAxisForGridPie&&!model.isMetricNamesOnXAxis){var labels=[];labels.push(dp.getOneMetricName(this.metricIndexForLabelForGridPie));this.seriesLabel[dataIndex]=labels;return labels;}this.seriesLabel[dataIndex]=lds.getSeriesLabel(lr,lc);return this.seriesLabel[dataIndex];},getGroupLabel:function getGroupLabel(dataIndex){var o,dp,lds,model,ox,oy,lr,lc;if(this.groupLabel===undefined){this.groupLabel={};}if(this.groupLabel[dataIndex]!==undefined){return this.groupLabel[dataIndex];}o=this.groupData[dataIndex];dp=this.dp;lds=dp.lds;model=lds.gmm;ox=lds.getOffsetX();oy=lds.getOffsetY();lr=o.R-oy;lc=o.C-ox;if(model.onlyMetricNamesOnAxisForGridPie&&model.isMetricNamesOnXAxis){var labels=[];labels.push(dp.getOneMetricName(this.metricIndexForLabelForGridPie));this.groupLabel[dataIndex]=labels;return labels;}this.groupLabel[dataIndex]=lds.getGroupLabel(lr,lc);return this.groupLabel[dataIndex];},getThresholdIndex:function getThresholdIndex(){return 0;},getThreshold:function getThreshold(){},getRowIndex:function getRowIndex(dataIndex){var o=this.groupData[dataIndex];return o.R;},getColIndex:function getColIndex(dataIndex){var o=this.groupData[dataIndex];return o.C;},getTooltipContent:function(forSelection,includeMetrics){forSelection=!!forSelection;includeMetrics=!!includeMetrics;var gcTtpCcnt=this.gcTtpCcnt||{},cacheKey=forSelection+","+includeMetrics;if(gcTtpCcnt[cacheKey]!==undefined){return gcTtpCcnt[cacheKey];}var lds=this.dp.lds,tooltipContent=[];lds.getTooltipForChartHeader(tooltipContent,"r",forSelection);lds.getTooltipForChartHeader(tooltipContent,"c",forSelection);getTooltipContentForDataPoint.call(this,tooltipContent,forSelection,includeMetrics);gcTtpCcnt[cacheKey]=tooltipContent;return tooltipContent;},testGraphCell:function testGraphCell(){$VISUTILS.visPrint("");$VISUTILS.visPrint("start testing gcell...");var dp=this.dp,model=dp.lds.gmm,cnt=dp.getDataGroup(),di,v,slbs,glbs,pieCnt,i,pieDps,sPieDP,chtInfo=model.getChartInfo(),isPie=chtInfo.isPie,color;for(di=0;di<cnt;di++){v=this.getData(di);if(model.colorType!==COLOR_BY_TYPE.NULL){color=this.getColorByData(di);}$VISUTILS.visPrint("data with data index "+di+": "+v);if(model.colorType!==COLOR_BY_TYPE.NULL){$VISUTILS.visPrint("color with data index "+di+": "+color);}$VISUTILS.visPrint("sizeBy data: "+this.getSizeByData());slbs=this.getSeriesLabel(di);$VISUTILS.visPrint("series labels are: "+slbs.join());glbs=this.getGroupLabel(di);$VISUTILS.visPrint("group labels are: "+glbs.join());}if(isPie){$VISUTILS.visPrint("start testing pie dps");pieDps=this.getSinglePieDPs();pieCnt=pieDps.length;for(i=0;i<pieCnt;i++){sPieDP=pieDps[i];sPieDP.testSinglePieDP();if(i!==pieCnt-1){$VISUTILS.visPrint("-----------------------");}}$VISUTILS.visPrint("end testing pie dps");}this.getTooltipContent();$VISUTILS.visPrint("end testing gcell...");}});mstrmojo.gm.GMDataProvider=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GMDataProvider",lds:null,data:null,sbc:false,graphJSON:null,isValid:true,fwdEnabled:false,bwdEnabled:false,cache:null,getController:function(){var lds=this.lds,model=lds.gmm,gmCtr=model.gmCtr;return gmCtr;},allowDatalabelOverlap:function(){var gmCtr=this.getController();return gmCtr.getChartInfo().dlPlmt>1;},isClusteredBarSpecialCase:function(){var gmCtr=this.getController();return gmCtr.clusteredBarSpecialCase;},getChartInfo:function(){return this.lds.getChartInfo();},init:function init(props){this._super(props);this.cache=[];var chtInfo=this.getChartInfo();if(chtInfo.isABL||chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){this.getTrendsOfChart();}},destroy:function destroy(){delete this.cache;},isGradientABL:function(){return this.lds.gmm.gmCtr.isGradientABL();},getTotalOfGroup:function(groupIndex){var seriesCount=this.innerGetSeriesCount(),tot=0,i,gc;for(i=0;i<seriesCount;i++){gc=this.innerGetGraphCell(i,groupIndex);tot+=gc.getData(0);}return tot;},getAxisOriginLineIdentity:function(whichAxis){var gmCtr=this.getController();return gmCtr.getAxisOriginLineIdentity(whichAxis);},getAxisOriginLabelIdentity:function(whichAxis){var gmCtr=this.getController();return gmCtr.getAxisOriginLabelIdentity(whichAxis);},getMetricsOnAxis:function(axisName){var r=this.rowIndex,c=this.colIndex;var gmCtr=this.getController();if(r===undefined||c===undefined){$VISUTILS.visPrint("row index or column index of data provider is not found");}if(axisName==="x"||axisName==="x1"||axisName==="X1"){return GMUTIL.filterInValidMetricIndex(gmCtr.getMetricsOnAxisOfChart(r,c,"x",true));}if(axisName==="y"||axisName==="y1"||axisName==="Y1"){return GMUTIL.filterInValidMetricIndex(gmCtr.getMetricsOnAxisOfChart(r,c,"y",true));}if(axisName==="x2"||axisName==="X2"){return GMUTIL.filterInValidMetricIndex(gmCtr.getMetricsOnAxisOfChart(r,c,"x",false));}if(axisName==="y2"||axisName==="Y2"){return GMUTIL.filterInValidMetricIndex(gmCtr.getMetricsOnAxisOfChart(r,c,"y",false));}return[];},isLogScale:function(axisName){var gmCtr=this.getController();return gmCtr.isLogScale(axisName,this.rowIndex,this.colIndex);},getNumericOption:function(axisName){var metricIndexArr=this.getMetricsOnAxis(axisName),gmCtr=this.getController();if(metricIndexArr.length>0){return GMUTIL.getOptionObjArr.call(gmCtr,metricIndexArr,axisName,false);}return[];},getAxisOriginValue:function(axisName){var gmCtr=this.getController(),visGM=gmCtr.view,axisOption=this.getNumericOption(axisName),axisOrigin=visGM.readGlobalProperty($WT.AXIS_ORIGIN,axisOption).jsonObj;if(axisOrigin){var auto=axisOrigin[$WT.AXIS_ORIGIN_AUTO];var oriV=parseFloat(axisOrigin[$WT.AXIS_ORIGIN_VALUE]);if(auto){return 0;}return oriV;}return 0;},getAxisFormats:function getAxisFormats(whichAxis,formatType){formatType=formatType||"all";var gmCtr=this.getController(),attrs,axisFormat=gmCtr.getAllAxisProperties();switch(formatType){case"axisLabel":if(whichAxis==="x1"||whichAxis==="x2"||whichAxis==="X1"||whichAxis==="X2"){attrs=[$FT.X_AXIS_LABELS_FONT_SIZE,$FT.X_AXIS_LABELS_FONT_FAMILY,$FT.X_AXIS_LABELS_FONT_STYLE,$FT.X_AXIS_LABELS_ROTATION,$FT.X_AXIS_LABELS_FONT_COLOR];}else{if(whichAxis==="y1"||whichAxis==="y2"||whichAxis==="Y1"||whichAxis==="Y2"){attrs=[$FT.Y_AXIS_LABELS_FONT_SIZE,$FT.Y_AXIS_LABELS_FONT_FAMILY,$FT.Y_AXIS_LABELS_FONT_STYLE,$FT.Y_AXIS_LABELS_ROTATION,$FT.Y_AXIS_LABELS_FONT_COLOR];}}return $HASH.copyProps(attrs,axisFormat);case"majorTick":case"minorTick":var isMajor=formatType==="majorTick",lineFormats={};if(isMajor){attrs=[$FT.MAJOR_GRID_LINES_COLOR,$FT.MAJOR_GRID_LINES_THICKNESS,$FT.MAJOR_GRID_LINES_STYLE];}else{attrs=[$FT.MINER_GRID_LINES_COLOR,$FT.MINER_GRID_LINES_THICKNESS,$FT.MINER_GRID_LINES_STYLE];}return $HASH.copyProps(attrs,axisFormat);case"body":if(whichAxis==="x1"||whichAxis==="x2"||whichAxis==="X1"||whichAxis==="X2"){attrs=[$FT.X_AXIS_LINE_COLOR,$FT.X_AXIS_LINE_STYLE,$FT.X_AXIS_LINE_THICKNESS];}else{if(whichAxis==="y1"||whichAxis==="y2"||whichAxis==="Y1"||whichAxis==="Y2"){attrs=[$FT.Y_AXIS_LINE_COLOR,$FT.Y_AXIS_LINE_STYLE,$FT.Y_AXIS_LINE_THICKNESS];}}return $HASH.copyProps(attrs,axisFormat);case"axisOrigin":if(whichAxis==="x1"||whichAxis==="x2"||whichAxis==="X1"||whichAxis==="X2"){attrs=[$FT.X_AXIS_ORIGIN_LINE_SHOW,$FT.X_AXIS_ORIGIN_LINE_COLOR,$FT.X_AXIS_ORIGIN_LINE_STYLE,$FT.X_AXIS_ORIGIN_LINE_THICKNESS];}else{if(whichAxis==="y1"||whichAxis==="y2"||whichAxis==="Y1"||whichAxis==="Y2"){attrs=[$FT.Y_AXIS_ORIGIN_LINE_SHOW,$FT.Y_AXIS_ORIGIN_LINE_COLOR,$FT.Y_AXIS_ORIGIN_LINE_STYLE,$FT.Y_AXIS_ORIGIN_LINE_THICKNESS];}}return $HASH.copyProps(attrs,axisFormat);case"showHide":if(whichAxis==="x1"||whichAxis==="x2"||whichAxis==="X1"||whichAxis==="X2"){attrs=[$FT.X_AXIS_LINE_SHOW,$FT.X_AXIS_TITLE_SHOW,$FT.X_AXIS_LABELS_SHOW,$FT.MAJOR_GRID_LINES_SHOW,$FT.MINOR_GRID_LINES_SHOW];}else{if(whichAxis==="y1"||whichAxis==="y2"||whichAxis==="Y1"||whichAxis==="Y2"){attrs=[$FT.Y_AXIS_LINE_SHOW,$FT.Y_AXIS_TITLE_SHOW,$FT.Y_AXIS_LABELS_SHOW,$FT.MAJOR_GRID_LINES_SHOW,$FT.MINOR_GRID_LINES_SHOW];}}return $HASH.copyProps(attrs,axisFormat);default:$HASH.copy(axisFormat,lineFormats);return lineFormats;}},getDataLabelType:function(){return this.getChartInfo().dlTp;},getDataLabelFontFormat:function(){var gmCtr=this.getController(),hash=mstrmojo.hash,attrs=[$FT.DATA_LABELS_FONT_FAMILY,$FT.DATA_LABELS_FONT_SIZE,$FT.DATA_LABELS_FONT_STYLE,$FT.DATA_LABELS_FONT_COLOR],dataLabelFormats=gmCtr.getDataLabelFontFormat();return hash.copyProps(attrs,dataLabelFormats);},clearGraphJSON:function(){this.graphJSON=null;},resetDPCache:function resetDPCache(){if(this.rCache){this.rCache={};delete this.rCache;}if(this.cCache){this.cCache={};delete this.cCache;}},innerGetGraphCell:function innerGetGraphCell(seriesId,groupId){return getPrivateGraphCell.call(this,seriesId,groupId);},getGraphCell:function getGraphCell(seriesId,groupId){var gmCtr=this.getController();if(gmCtr.clusteredBarSpecialCase){var clusterDp=this.getClusterDataGroup();if(seriesId>=groupId*clusterDp&&seriesId<(groupId+1)*clusterDp){seriesId=Math.round(seriesId%clusterDp);}else{return new FakedGraphCell({gIdx:groupId,dp:this,isFaked:true});}}return getPrivateGraphCell.call(this,seriesId,groupId);},countValidGraphCell:function(){var gcnt,scnt,gc,i,j,cnt=0;gcnt=this.innerGetGroupCount();scnt=this.innerGetSeriesCount();for(i=0;i<gcnt;i++){for(j=0;j<scnt;j++){gc=this.innerGetGraphCell(j,i);if(gc.getData(0)!==null){cnt++;}}}return cnt;},collectElementsIndexArrayOnXVar:function(xvar){var chtInfo=this.getChartInfo(),g,gc,elementIndexArray,res=[],gcnt=this.innerGetGroupCount();if(chtInfo.isABL){for(g=0;g<gcnt;g++){gc=this.innerGetGraphCell(0,g);elementIndexArray=gc.getGroupElementIndexArray(xvar,0);res.push(elementIndexArray);}return res;}return undefined;},isNullGC:function(gc){return isNaN(gc.getData(0));},isDiscreteSeries:function(sIdx){var gcnt=this.innerGetGroupCount(),gc,nextGC,previousIsNull=true,g;for(g=0;g<gcnt;g++){gc=this.innerGetGraphCell(sIdx,g);if(!this.isNullGC(gc)){if(previousIsNull){if(g===gcnt-1){return true;}nextGC=this.innerGetGraphCell(sIdx,g+1);if(this.isNullGC(nextGC)){return true;}}previousIsNull=false;}else{previousIsNull=true;}}return false;},GetDiscreteSeries:function GetDiscreteSeries(){var chtInfo=this.getChartInfo(),i,res=[],model=this.lds.gmm,gmCtr=model.gmCtr,clBarSpecial=gmCtr.clusteredBarSpecialCase,scnt=this.getSeriesCount();if(!chtInfo.isABL){return[];}for(i=0;i<scnt;i++){if(clBarSpecial||this.isDiscreteSeries(i)){res.push(i);}}return res;},prepareForTrendLines:function(){var me=this,chtInfo=this.getChartInfo(),inDpTrMdls={},inDpRfMdls={},seriesWithTrendLineDefined,metricIndexesWithTrendLineDefined,metricIndexesWithRefLineDefined,yVarMtxIdx,xVarMtxIdx,yMetricId,xMetricId,lds=this.lds,gc,gcnt=this.getGroupCount(),scnt=this.getSeriesCount(),i,unitElementIndexArray,model=lds.gmm,mx=model.mx,cri=lds.cri,cci=lds.cci,bbUnits=model.getBreakByUnits(),hasBb=bbUnits.length>0,gmCtr=model.gmCtr,fse=lds.validFse,bse=lds.validBse,xvar=lds.validXVar,trendLineModelData,refMetricIdxs,m,curMtcIdx,curMtcId,isBubble=false,direction,refModelDataArr;var opts=gmCtr.getDependentMetricOptions();function getTrendLineOptionForMetricId(metricId){var opt;opts.forEach(function(o){if(metricId===o.key){opt=o;}});return opt;}var trendLineErrors=gmCtr.trendLineErrors={};var refIsDefOnAxis=false,prefixAxis,axisName;var getMidForAxisByMetricIndex=function(metricIdx){var refMidForAxis={MID_IN_Y1:-131072,MID_IN_Y2:-1179648,MID_IN_X1:-65536,MID_IN_X2:-1114112},dz=model.dz[axisName],metrics=dz&&dz.TemplateMetric,curMetric=metrics&&metrics[metricIdx],tmpMid;if(curMetric&&curMetric.ax===0){if(chtInfo.dirc===ABL_DIRECTION.VERTICAL){tmpMid=refMidForAxis.MID_IN_Y1;}else{tmpMid=refMidForAxis.MID_IN_X1;}}else{if(chtInfo.dirc===ABL_DIRECTION.VERTICAL){tmpMid=refMidForAxis.MID_IN_Y2;}else{tmpMid=refMidForAxis.MID_IN_X2;}}return tmpMid;};var processRefModelData=function(refModelData){function isModelCollected(tModelArr,modix){var defined=false;$ARR.forEach(tModelArr,function(cM){if(cM.tmData.modix===modix){defined=true;}});return defined;}var refHost,dz,zone,defOnZone;if(!refIsDefOnAxis){refHost=curMtcIdx;}else{dz=me.lds.gmm.dz;zone=dz[axisName];defOnZone=zone.mdls&&zone.mdls.mod_c[refModelData.modix-1];if(defOnZone===undefined){return ;}if(defOnZone.dua===0){refHost=axisName;}else{refHost=prefixAxis+"2Axis";}}if(metricIndexesWithRefLineDefined.indexOf(refHost)<0){metricIndexesWithRefLineDefined.push(refHost);}if(inDpRfMdls[refHost]===undefined){inDpRfMdls[refHost]=[];}var refOptions,refOpt;if(refModelData){if(!refIsDefOnAxis){var metricId=gmCtr.model.getMetricIDsFromIndex([refModelData.mid])[0];refOptions=gmCtr.view.getExistingRefLineOptions(metricId);refOptions.forEach(function(o){if(o.modix===refModelData.modix){refOpt=o;}});if(!isModelCollected(inDpRfMdls[refHost],refModelData.modix)){inDpRfMdls[refHost].push(new $GM.TrendLineModel({tmData:refModelData,dp:me,mx:mx,isTrendLine:false,direction:direction,refIsDefOnAxis:refIsDefOnAxis,seriesIds:[i],midx:refHost,trendLineOpt:refOpt,metricId:curMtcId,ldsCri:cri,ldsCci:cci}));}}else{refOptions=gmCtr.view.getExistingRefLineOptionsForAxis(refHost);refOptions.forEach(function(o){if(o.modix===refModelData.modix){refOpt=o;}});if(!isModelCollected(inDpRfMdls[refHost],refModelData.modix)){inDpRfMdls[refHost].push(new $GM.TrendLineModel({tmData:refModelData,dp:me,isTrendLine:false,direction:chtInfo.dirc===ABL_DIRECTION.VERTICAL?"horizontal":"vertical",defOnZone:defOnZone,seriesIds:[i],trendLineOpt:refOpt,refIsDefOnAxis:refIsDefOnAxis,ldsCri:cri,ldsCci:cci}));}}}};if(chtInfo.isABL&&gmCtr.isStacked&&!gmCtr.splitPlottingMetrics){prefixAxis=chtInfo.dirc===ABL_DIRECTION.VERTICAL?"Y":"X";axisName=prefixAxis+"Axis";refIsDefOnAxis=true;}this.trendLineCalculated=true;this.inDpTrMdls=inDpTrMdls;this.inDpRfMdls=inDpRfMdls;this.seriesWithTrendLineDefined=seriesWithTrendLineDefined=[];this.metricIndexesWithTrendLineDefined=metricIndexesWithTrendLineDefined=[];this.metricIndexesWithRefLineDefined=metricIndexesWithRefLineDefined=[];if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){isBubble=true;}var clusterDp=1;for(i=0;i<scnt;i++){if(this.isClusteredBarSpecialCase()){clusterDp=this.getClusterDataGroup();gc=this.getGraphCell(i,Math.round(i/clusterDp));}else{gc=this.innerGetGraphCell(i,0);}if(gc.isFaked){continue;}if(chtInfo.isABL){yVarMtxIdx=gc.getMetricIndex(0);}else{if(isBubble===true){xVarMtxIdx=gc.getMetricIndex(0);xMetricId=model.getMetricIDsFromIndex([xVarMtxIdx])[0];yVarMtxIdx=gc.getMetricIndex(1);}}yMetricId=model.getMetricIDsFromIndex([yVarMtxIdx])[0];if(xvar&&(fse||bse)){unitElementIndexArray=this.collectElementsIndexArrayOnXVar(xvar);this.unitElementIndexArray=unitElementIndexArray;if(gcnt>1){if(fse&&unitElementIndexArray.length>0&&GMUTIL.indexOf(unitElementIndexArray,fse)>=0){this.fwdEnabled=true;}if(bse&&unitElementIndexArray.length>0&&GMUTIL.indexOf(unitElementIndexArray,bse)>=0){this.bwdEnabled=true;}}}if(isBubble===true){this.bwdEnabled=true;this.fwdEnabled=true;}trendLineModelData=gmCtr.getTrendLinesObjectForMetric(yVarMtxIdx,cri,cci,xMetricId,true)[0];if(trendLineModelData&&trendLineModelData.inChartModel[0]&&trendLineModelData.inChartModel[0].model){var errMsg=trendLineModelData.inChartModel[0].model.error_message;if(errMsg){var errorKey=trendLineModelData.mid+","+trendLineModelData.modix;if(!trendLineErrors[errorKey]){trendLineErrors[errorKey]=errMsg;}}else{seriesWithTrendLineDefined.push(i);if(inDpTrMdls[yVarMtxIdx]){inDpTrMdls[yVarMtxIdx].seriesIds.push(i);inDpTrMdls[yVarMtxIdx].seriesBBUnits.push(gc.getBreakByElementIndexArray(true));}else{metricIndexesWithTrendLineDefined.push(yVarMtxIdx);var tlOpt=getTrendLineOptionForMetricId(yMetricId);inDpTrMdls[yVarMtxIdx]=new $GM.TrendLineModel({tmData:trendLineModelData,hasBb:hasBb,dp:me,isTrendLine:true,mx:mx,seriesBBUnits:[gc.getBreakByElementIndexArray(true)],seriesIds:[i],midx:yVarMtxIdx,metricId:yMetricId,trendLineOpt:tlOpt,ldsCri:cri,ldsCci:cci});}}}if(!refIsDefOnAxis){refMetricIdxs=[yVarMtxIdx];if(isBubble===true){refMetricIdxs.push(gc.getMetricIndex(0));}for(m=0;m<refMetricIdxs.length;m++){if(isBubble){if(m===0){direction="horizontal";}else{direction="vertical";}}else{if(chtInfo.isABL){if(chtInfo.dirc===ABL_DIRECTION.VERTICAL){direction="horizontal";}else{direction="vertical";}}}curMtcIdx=refMetricIdxs[m];curMtcId=model.getMetricIDsFromIndex([curMtcIdx])[0];refModelDataArr=gmCtr.getTrendLinesObjectForMetric(curMtcIdx,cri,cci,undefined,false);refModelDataArr.forEach(processRefModelData);}}else{var midInAxis=getMidForAxisByMetricIndex(yVarMtxIdx);refModelDataArr=gmCtr.getTrendLinesObjectForMetric(midInAxis,cri,cci,undefined,false);refModelDataArr.forEach(processRefModelData);}}},getTrendsOfChart:function(){if(this.trendLinesOfChart){return this.trendLinesOfChart;}if(!this.trendLineCalculated){this.prepareForTrendLines();}var inDpTrMdls=this.inDpTrMdls,res=[],trendLineInfo={},metricIndexesWithTrendLineDefined=this.metricIndexesWithTrendLineDefined;if(metricIndexesWithTrendLineDefined){$ARR.forEach(metricIndexesWithTrendLineDefined,function(mtxIdx){var modelWithBB=inDpTrMdls[mtxIdx],lines=modelWithBB.getSingleTrendLines(trendLineInfo);res=res.concat(lines);});}function makeSureStringLabel(lbsArr){if(lbsArr===undefined){return lbsArr;}var i;lbsArr.forEach(function(arr){for(i=0;i<arr.length;i++){arr[i]=arr[i].toString();}});return lbsArr;}this.trendLinesOfChart=res;this.fwdLbs=trendLineInfo.fwdLbs=makeSureStringLabel(trendLineInfo.fwdLbs);this.bwdLbs=trendLineInfo.bwdLbs=makeSureStringLabel(trendLineInfo.bwdLbs);return res;},getRefsOfChart:function(){if(this.refLinesOfChart){return this.refLinesOfChart;}if(!this.trendLineCalculated){this.prepareForTrendLines();}var inDpRfMdls=this.inDpRfMdls,res=[],trendLineInfo={},metricIndexesWithRefLineDefined=this.metricIndexesWithRefLineDefined;if(metricIndexesWithRefLineDefined){$ARR.forEach(metricIndexesWithRefLineDefined,function(mtxIdx){var modelWithBBArr=inDpRfMdls[mtxIdx],lines;modelWithBBArr.forEach(function(modelWithBB){lines=modelWithBB.getSingleTrendLines(trendLineInfo);res=res.concat(lines);});});}this.refLinesOfChart=res;return res;},getMetricsIndexOnAxis:function getMetricsIndexOnAxis(){return this.mpos;},getMinMetricValue:function getMinMetricValue(){},getMaxMetricValue:function getMaxMetricValue(){},getMinMaxValueForABL:function(){var min,max,scnt=this.innerGetSeriesCount(),gcnt=this.innerGetGroupCount(),s,g,gc,cnt,di,v,gmCtr=this.lds.gmm.gmCtr,hasSzBy=gmCtr.hasSizeBy(),szV,ZMax,ZMin;for(s=0;s<scnt;s++){for(g=0;g<gcnt;g++){gc=this.innerGetGraphCell(s,g);if(hasSzBy){szV=gc.getSizeByData();if(ZMin===undefined){ZMin=szV;}else{if(ZMin>szV){ZMin=szV;}}if(ZMax===undefined){ZMax=szV;}else{if(ZMax<szV){ZMax=szV;}}}cnt=gc.dp.getDataGroup();for(di=0;di<cnt;di++){v=gc.getData(di);if(min===undefined){min=v;}else{if(min>v){min=v;}}if(max===undefined){max=v;}else{if(max<v){max=v;}}}}}return{XMax:max,XMin:min,YMax:max,YMin:min,ZMin:ZMin,ZMax:ZMax};},getMinMaxValueForGrid:function(){var ZMin,ZMax,scnt=this.getSeriesCount(),gcnt=this.getGroupCount(),s,g,gc,szV,gmCtr=this.lds.gmm.gmCtr,hasSzBy=gmCtr.hasSizeBy();if(hasSzBy){for(s=0;s<scnt;s++){for(g=0;g<gcnt;g++){gc=this.innerGetGraphCell(s,g);szV=gc.getSizeByData();if(ZMin===undefined){ZMin=szV;}else{if(ZMin>szV){ZMin=szV;}}if(ZMax===undefined){ZMax=szV;}else{if(ZMax<szV){ZMax=szV;}}}}}return{YMax:20000,YMin:0,XMin:0,XMax:20000,ZMin:ZMin,ZMax:ZMax};},getMinMaxValueForBubbleOrScatter:function(){var XMin,XMax,YMin,YMax,ZMin,ZMax,scnt=this.innerGetSeriesCount(),gcnt=this.innerGetGroupCount(),s,g,gc,cnt,szV,di,gmCtr=this.lds.gmm.gmCtr,hasSzBy=gmCtr.hasSizeBy();for(s=0;s<scnt;s++){for(g=0;g<gcnt;g++){gc=this.innerGetGraphCell(s,g);cnt=gc.dp.getDataGroup();if(hasSzBy){szV=gc.getSizeByData();if(ZMin===undefined){ZMin=szV;}else{if(ZMin>szV){ZMin=szV;}}if(ZMax===undefined){ZMax=szV;}else{if(ZMax<szV){ZMax=szV;}}}for(di=0;di<cnt;di++){var v=gc.getData(di);if(di===0){if(XMin===undefined){XMin=v;}else{if(XMin>v){XMin=v;}}if(XMax===undefined){XMax=v;}else{if(XMax<v){XMax=v;}}}else{if(YMin===undefined){YMin=v;}else{if(YMin>v){YMin=v;}}if(YMax===undefined){YMax=v;}else{if(YMax<v){YMax=v;}}}}}}return{YMax:YMax,YMin:YMin,XMin:XMin,XMax:XMax,ZMin:ZMin,ZMax:ZMax};},getMetricFormat:function getMetricFormat(metricIndex,useFullFormat){useFullFormat=useFullFormat||false;if(useFullFormat){var idx=parseInt(metricIndex,10),dp=this,lds=dp.lds,gmm=lds.gmm,mIds=dp.getMetricIds(),fullNf,mNames=dp.getMetricNames();if(idx<0){$VISUTILS.visPrint("invalid metric index");return undefined;}fullNf=gmm.getFullNumberFormat();return{idx:idx,metric:mNames[idx],id:mIds[idx],fullNf:fullNf!==undefined?fullNf[idx]:undefined};}return this.lds.getMetricNumberFormat(metricIndex);},isMetricOnRowAxis:function isMetricOnRowAxis(){return false;},getMetricsCount:function getMetricsCount(){var ms=this.metrics;if(!ms){return 0;}return ms.es.length;},getMetricNames:function getMetricNames(){var lds=this.lds,model=lds.gmm;return model.getMetricNames();},getMetricIds:function getMetricIds(){var lds=this.lds,model=lds.gmm;return model.getMetricIds();},getOneMetricName:function getOneMetricName(metricIndex){var ms=this.metrics;if(ms){if(ms.es.length-1>=metricIndex){return ms.es[metricIndex].n;}}},getSeriesCount:function getSeriesCount(){return this.innerGetSeriesCount();},innerGetSeriesCount:function(){var dataSbc=this.dataSbc;if(dataSbc===true){return this.data[0].length;}return this.data.length;},getGroupCount:function getGroupCount(){var dataSbc=this.dataSbc;if(dataSbc===false){return this.data[0].length;}return this.data.length;},innerGetGroupCount:function getGroupCount(){var dataSbc=this.dataSbc;if(dataSbc===false){return this.data[0].length;}return this.data.length;},getDimensionSize:function getDimensionSize(){return 5;},getDataGroup:function getDataGroup(){var rawObj=this.data[0][0];if(rawObj===undefined){return 1;}return rawObj.length;},getSeriesByColumn:function getSeriesByColumn(){return this.sbc;},seriesGroupIndexToRowColumnIndex:function seriesGroupIndexToRowColumnIndex(iSeriesID,iGroupID,iDataIndex,iIsConsiderSubtotal){iIsConsiderSubtotal=iIsConsiderSubtotal||false;var dataSbc=this.dataSbc;var r,c;if(dataSbc===true){c=iSeriesID;r=iGroupID;}else{r=iSeriesID;c=iGroupID;}var rawObj=this.data[r][c];if(rawObj){return{Row:rawObj[iDataIndex].R,Col:rawObj[iDataIndex].C};}return{Row:-1,Col:-1};},getTextLabel:function getTextLabel(seriesId,groupId,angleId,sliceId){var gc=this.getGraphCell(seriesId,groupId),chtInfo=this.getChartInfo(),identity,bbInfo,gmCtr,bbAttIds,slcAttIds,lastId,idx;if(gc!==null&&gc!==undefined){gmCtr=gc.getGMCtr();if(chtInfo.isPie){var sPieDP=gc.getSinglePieDPs()[angleId];var sliceLbs=sPieDP.getSliceLabel(sliceId);if(sliceLbs.length===0){return"";}slcAttIds=gmCtr.getSliceByAttrsID();lastId=slcAttIds[slcAttIds.length-1];idx=$ARR.find(sliceLbs,"tid",lastId);return sliceLbs[idx].n;}identity=gc.getIdentity();bbInfo=identity.getSelectedObjectBreakByInfo(false);if(bbInfo.length===0){return"";}bbAttIds=gmCtr.getBreakByAttrsID();lastId=bbAttIds[bbAttIds.length-1];idx=$ARR.find(bbInfo,"tid",lastId);if(idx>=0){return bbInfo[idx].v;}}return"";},isGridPieSplitAlongXAxis:function(){var chtInfo=this.getChartInfo(),lds=this.lds,model=lds.gmm,gmCtr=model.gmCtr;if(chtInfo.isPie&&chtInfo.tp===CHART_TYPE.GRID){return gmCtr.isMetricNamesInZone("XAxis");}return undefined;},getMetricIndexForSeries:function(sId){var gCnt=this.getGroupCount(),gc,i;for(i=0;i<gCnt;i++){gc=this.getGraphCell(sId,i);if(!gc.isFaked){break;}}return gc.getMetricIndex(0);},getShapeBySeries:function(sId){var gmCtr=this.lds.gmm.gmCtr,mtcIdx;if(gmCtr.enableCombiChart===false){return gmCtr.markerShape;}mtcIdx=this.getMetricIndexForSeries(sId);return gmCtr.getOnTheFlyShapeForMetric(mtcIdx);},getPrioritizedSeriesIndex:function(){var gmCtr=this.lds.gmm.gmCtr,sCnt=this.getSeriesCount(),i,sShapeInfo,sIdxArr=[];if(gmCtr.enableCombiChart===false){var hardCodedArr=[];for(i=0;i<sCnt;i++){hardCodedArr.push(i);}return hardCodedArr;}sShapeInfo=this.getSeriesByShape();sIdxArr=sIdxArr.concat(sShapeInfo.Area);sIdxArr=sIdxArr.concat(sShapeInfo.Bar);sIdxArr=sIdxArr.concat(sShapeInfo.Circle);sIdxArr=sIdxArr.concat(sShapeInfo.Square);sIdxArr=sIdxArr.concat(sShapeInfo.Line);sIdxArr=sIdxArr.concat(sShapeInfo.Tick);return sIdxArr;},getSeriesByShape:function(shape){var sCnt=this.getSeriesCount(),i,curShape,curArray,sShapes={Tick:[],Line:[],Bar:[],Area:[],Circle:[],Square:[],Pie:[]};function getShapeArray(iShape){var arr;switch(iShape){case MK_SHAPE.TICK:arr=sShapes.Tick;break;case MK_SHAPE.LINE:arr=sShapes.Line;break;case MK_SHAPE.BAR:arr=sShapes.Bar;break;case MK_SHAPE.AREA:arr=sShapes.Area;break;case MK_SHAPE.CIRCLE:arr=sShapes.Circle;break;case MK_SHAPE.SQUARE:arr=sShapes.Square;break;case MK_SHAPE.PIE:arr=sShapes.Pie;break;}return arr;}for(i=0;i<sCnt;i++){curShape=this.getShapeBySeries(i);curArray=getShapeArray(curShape);curArray.push(i);}if(shape===undefined){return sShapes;}return getShapeArray(shape);},getValueAxisBySeries:function(sId){var gmCtr=this.lds.gmm.gmCtr,mtcIdx,pm;mtcIdx=this.getMetricIndexForSeries(sId);pm=gmCtr.getPrimaryMetrics();if(pm.indexOf(mtcIdx)>=0){return 0;}return 1;},getSeriesByValueAxis:function(axisId){var gmCtr=this.lds.gmm.gmCtr,mtcIdx,scnt=this.getSeriesCount(),i,result=[],metrics;metrics=(axisId===0)?gmCtr.getPrimaryMetrics():gmCtr.getSecondaryMetrics();for(i=0;i<scnt;i++){mtcIdx=this.getMetricIndexForSeries(i);if(metrics.indexOf(mtcIdx)!==-1){result.push(i);}}return result;},testDataProvider:function testDataProvider(){var scnt=this.getSeriesCount(),gcnt=this.innerGetGroupCount(),mcnt=this.getMetricsCount(),lds=this.lds,cci=lds.cci,cri=lds.cri,i,s,g;$VISUTILS.visPrint("");$VISUTILS.visPrint("======================chart with index: ("+cri+", "+cci+")=============================");for(i=0;i<mcnt;i++){var n=this.getOneMetricName(i);$VISUTILS.visPrint("single metric name of "+i+" is: "+n);}for(s=0;s<scnt;s++){for(g=0;g<gcnt;g++){var gc=this.innerGetGraphCell(s,g);if(!gc.isFaked){gc.testGraphCell();}}}},getResizerLineThickNess:function getResizerLineThickNess(){var model=this.lds.gmm,gmCtr=model.gmCtr,view=gmCtr.view,styles=view.getHTML5Props();return{MATRIX_VLINE_THICKNESS:parseInt(styles.MATRIX_LINE_V.borderWidth,10)||1,MATRIX_HLINE_THICKNESS:parseInt(styles.MATRIX_LINE_H.borderWidth,10)||1,AXIS_X_THICKNESS:parseInt(styles.AXIS_LINE_X.borderWidth,10)||1,AXIS_Y_THICKNESS:parseInt(styles.AXIS_LINE_Y.borderWidth,10)||1};},getChartRowColCount:function getChartRowColCount(){var model=this.lds.gmm;return{cir:model.cir,cic:model.cic};},isCompactMode:function isCompactMode(){var model=this.lds.gmm,gmCtr=model.gmCtr;return gmCtr.isCompactMode();}});mstrmojo.gm.GMEnhancedDataProvider=mstrmojo.declare(mstrmojo.gm.GMDataProvider,null,{scriptClass:"mstrmojo.gm.GMEnhancedDataProvider",fwdSteps:0,bwdSteps:0,oriGroupCount:-1,getGroupCount:function(){if(useOriginalDP){return this._super();}var bwdSteps=this.bwdSteps,fwdSteps=this.fwdSteps;if(!this.bwdEnabled){bwdSteps=0;}if(!this.fwdEnabled){fwdSteps=0;}this.oriGroupCount=this._super();if(!this.fwdSteps&&!this.bwdSteps){return this.oriGroupCount;}return bwdSteps+this.oriGroupCount+fwdSteps;},getGraphCell:function getGraphCell(seriesId,groupId,nonFake){if(useOriginalDP||nonFake===true){return this._super(seriesId,groupId);}var bwdSteps=this.bwdSteps,fwdSteps=this.fwdSteps,gc;if(!this.bwdEnabled){bwdSteps=0;}if(!this.fwdEnabled){fwdSteps=0;}if(this.oriGroupCount<0){this.getGroupCount();}if(!this.fwdSteps&&!this.bwdSteps){gc=this._super(seriesId,groupId);return gc;}if(groupId<bwdSteps||groupId>=(this.oriGroupCount+bwdSteps)){return new FakedGraphCell({gIdx:groupId,dp:this,isFaked:true});}gc=this._super(seriesId,groupId-bwdSteps);return gc;},getClusterDataGroup:function getClusterDataGroup(){if(!!!this.mClusterDataGroup){var model=this.lds.gmm,gmCtr=model.gmCtr;if(gmCtr.clusteredBarSpecialCase){this.mClusterDataGroup=this.innerGetSeriesCount();}else{this.mClusterDataGroup=1;}}return this.mClusterDataGroup;},getSeriesCount:function getSeriesCount(){var model=this.lds.gmm,gmCtr=model.gmCtr;if(!gmCtr.clusteredBarSpecialCase){return this.innerGetSeriesCount();}return this.getGroupCount()*this.getClusterDataGroup();}});}());