(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.css");var MODE_OFF=1,MODE_CANCEL=2,MODE_PRE_SELECT=4,MODE_SELECT=8,MODE_SELECTION_MADE=16,MODE_SELECTION_COMPETE=32;function getBtnConfig(title,mode,isHot,alias,visibleFlags,enabledFlags){return mstrmojo.Button.newWebButton(title,function(evt){this.parent.set("_targetMode",mode);evt.cancel();},isHot,{alias:alias,flgVis:visibleFlags,flgEnabled:enabledFlags||undefined});}mstrmojo.vi.ui.TargetSelector=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.vi.ui.TargetSelector",markupString:'<div id="{@id}" class="mstrmojo-TargetSelector {@cssClass}" style="{@cssText}"><div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},init:function init(props){this._super(props);if(!this.hostId){throw new Error("You must pass the hostId when instantiating mstrmojo.vi.ui.TargetSelector.");}this._targetMode=MODE_OFF;},hostId:null,markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,on_targetModeChange:function(){var mode=this._targetMode,filterBox=mstrmojo.all[this.hostId],viPanel=filterBox.parent,id=this.id;this.children.forEach(function(btn){btn.set("visible",(btn.flgVis&mode)>0);btn.set("enabled",(!btn.flgEnabled||(btn.flgEnabled&mode)>0));});this.set("visible",mode!==MODE_OFF);var isComplete=mode===MODE_SELECTION_COMPETE;if(isComplete||mode===MODE_CANCEL){viPanel.exitTargetSelectionMode(isComplete);if(!isComplete){this.set("_targetMode",this._cancelMode);}filterBox.generateToolbar();}else{if(mode===MODE_SELECT){viPanel.enterTargetSelectionMode(function(keys,isComplete){var selectMode=isComplete?MODE_OFF:MODE_SELECT;if(!isComplete&&keys.length){selectMode=MODE_SELECTION_MADE;}mstrmojo.all[id].set("_targetMode",selectMode);if(isComplete){filterBox.setTargets(keys);}},filterBox.id,filterBox.getTargetKeys());}}var APP_STATES=mstrmojo.vi.VisualInsightApp.APP_STATES;mstrApp.set("appState",mode===MODE_SELECT||mode===MODE_SELECTION_MADE?APP_STATES.SELECTOR_TARGETING:APP_STATES.DEFAULT);}},ignoreLayout:true,enterPreSelectMode:function enterPreSelectMode(){this._cancelMode=MODE_PRE_SELECT;this.set("_targetMode",MODE_PRE_SELECT);},enterSelectMode:function enterSelectMode(){this._cancelMode=MODE_OFF;this.set("_targetMode",MODE_SELECT);},enterOffMode:function enterOffMode(){this._cancelMode=MODE_OFF;this.set("_targetMode",MODE_OFF);},children:[getBtnConfig(mstrmojo.desc(4799,"Select Target"),MODE_SELECT,true,"btnSelect",MODE_PRE_SELECT),getBtnConfig(mstrmojo.desc(221,"Cancel"),MODE_CANCEL,false,"btnCancel",MODE_SELECT+MODE_SELECTION_MADE),getBtnConfig(mstrmojo.desc(134,"Apply"),MODE_SELECTION_COMPETE,true,"btnApply",MODE_SELECT+MODE_SELECTION_MADE,MODE_SELECTION_MADE)]});}());