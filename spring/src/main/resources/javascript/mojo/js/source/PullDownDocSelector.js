(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.hash","mstrmojo.array","mstrmojo.elementHelper","mstrmojo.string");var $HASH=mstrmojo.hash,$STR=mstrmojo.string,$ARR=mstrmojo.array,_EH=mstrmojo.elementHelper;mstrmojo.PullDownDocSelector=mstrmojo.declare(mstrmojo.DocSelector,null,{scriptClass:"mstrmojo.PullDownDocSelector",initControlInfo:function initControlInfo(){this._super();var v=this.selIdx.length;this.selIdx.length=(v>0)?1:0;},canApply:function canApply(widget){return true;},_buildEvent:function _buildEvent(rEvt,widget){var value=widget.value,defn=this.defn,n=null;if(widget.selectNode){var sn=widget.selectNode;n=sn.options[sn.selectedIndex].text;}rEvt.eid=value;if(parseInt(rEvt.type,10)===1&&n!==null){rEvt.eid=rEvt.eid+";"+n;}this.defn.set("cek",value);this.currSelValue=value;if(defn.sec){var es=this.node.data.elms,tc=$ARR.filter(es,function(el){return el.v!==_EH.ELEM_ALL_ID&&el.v!==_EH.ELEM_DUMMY_ID;}).length;if(value==_EH.ELEM_ALL_ID||!defn.multi){this.parent.set("count",_EH.buildElemsCountStrByNum(tc,tc));}else{this.parent.set("count",_EH.buildElemsCountStrByNum(1,tc));}}},updateWidget:function updateWidget(selectorContainer){var selectorWidget=this._super(selectorContainer),node=selectorContainer.node,idx=selectorContainer.selIdx,data=node.data,elements=data.elms;selectorWidget.idx=$HASH.any(idx,true);var selectorUnset=(isNaN(selectorWidget.idx)||selectorWidget.idx<0);if(selectorUnset){if($ARR.find(elements,"v","-1")<0){elements=[{v:"-1",n:""}].concat(elements);}selectorWidget.idx="0";}selectorWidget.unset=!!selectorUnset;selectorWidget.options=elements;return selectorWidget;},newSelectorWidget:function newSelectorWidget(selectorContainer){var selectorStyle=selectorContainer.style,node=selectorContainer.node,defn=node.defn,data=node.data,elements=data.elms||[],cfg=this.getWidgetConfig(selectorContainer,selectorStyle,defn,elements),ret;if(cfg.scriptClass){ret=this._super(selectorContainer);}else{ret=this.newPulldown(selectorContainer);}return ret;},getCekEvtListener:function getCekEvtListener(selectorContainer,selectorWidget){return{cekEvtListener:function(evt){var elems=this.options;if($ARR.find(elems,"v",evt.value)<0){if($ARR.find(elems,"v","-1")<0){elems.unshift({v:"-1",n:""});}selectorWidget.idx="0";selectorWidget.options=elems;selectorWidget.unset=true;selectorContainer.handleActionInSyncPhase(function(){selectorWidget.refresh();});}else{selectorWidget.set("value",evt.value);}},cekContextId:selectorWidget.id};}});}());