(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Box","mstrmojo.Image","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.DI.DISearchableTextBox","mstrmojo.DataGrid");mstrmojo.requiresDescs(39,4283,14032,14033);var constants=mstrmojo.DI.DIConstants;function toggleSelectAll(selectedAll){var num=this.items.length;var selected={},i;if(selectedAll){for(i=0;i<num;i++){selected[i]=selectedAll;}}this.set("selectedIndices",selected);}function doImport(action){var i;var urls=[];var controller=mstrApp.getRootController();var url;for(i=0;i<this.outputGrid.items.length;i++){if(this.outputGrid.selectedIndices[i]){urls.push(this.outputGrid.items[i].url);this.setTableIndex(urls.length-1,this.outputGrid.items[i].index);}}this.urls=urls;for(i=0;i<urls.length;i++){url=mstrmojo.string.trim(urls[i]);urls[i]=url;}controller.importURLEMMA(this,urls,true,!controller.model.hasEMMAReportInstance(),this.id,true,action,this.id);}mstrmojo.DI.DIPublicData=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPublicData",markupString:'<div id = "{@id}" ><div class= "{@cssClass} cf" mstrAttach:click></div><div></div><div></div></div>',cssClass:"mstrmojo-di-public-data-search",searchField:null,resultSize:0,markupSlots:{containerNode:function(){return this.domNode;},textInputNode:function(){return this.domNode.children[0];},textOutputNode:function(){return this.domNode.children[1];},gridOutputNode:function(){return this.domNode.children[2];}},preBuildRendering:function preBuildRendering(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("wikiSearchResultsFetched",this.id,"populate");},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onBackButtonClick:function onBackButtonClick(){mstrApp.getRootController().showPage(constants.pageType.dataSelection);},onNextButtonClick:function onNextButtonClick(){doImport.call(this,this.tableID?constants.actions.refreshData:constants.actions.importSource);},onFinishButtonClick:function onFinishButtonClick(){doImport.call(this,constants.actions.savePublish);},onHelpButtonClick:function onHelpButtonClick(){return"Importing_data_by_scraping_a_web_page_public_data.htm";},populate:function populate(){var data=mstrApp.getRootController().model.wikiSearchResults;if(data.length===0){this.outputText.set("text",mstrmojo.desc(14032,"We could not find any results for your search."));this.outputText.set("visible",true);this.outputGrid.set("visible",false);}else{this.outputText.set("visible",false);this.outputGrid.set("visible",true);this.outputGrid.set("items",data);toggleSelectAll.call(this.outputGrid,false);}if(this.model.importSources[this.tableID]&&this.model.importSources[this.tableID].sourceInfo&&this.model.importSources[this.tableID].sourceInfo.name&&!this.autoselected){this.autoselected=true;var table=this.model.importSources[this.tableID];var i,url=table.sourceInfo.url,index=table.sourceInfo.sheetIndex;this.outputGrid.set("multiSelect",false);for(i=0;i<this.outputGrid.items.length;i++){if(url===this.outputGrid.items[i].url&&index===this.outputGrid.items[i].index){this.outputGrid.set("selectedIndex",i);break;}}this.outputGrid.updateHeaderCheckbox();}},updateSearchResult:function updateSearchResult(evt){if(!this.stillSearching&&!evt.newValue){return ;}if(evt.newValue){this.searchField=evt.newValue;}this.outputGrid.set("visible",false);if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrApp.getRootController().scrapeWiki(evt.newValue);},children:[{slot:"textInputNode",scriptClass:"mstrmojo.DI.DISearchableTextBox",alias:"urlInput",value:mstrmojo.desc(14033,"Search for data or enter a URL to extract data."),items:[],itemField:"n",itemIdField:"rgt",preBuildRendering:function preBuildRendering(){if(this._super){this._super();}this.attachEventListener("itemSelectedChanged",this.parent.id,"updateSearchResult");mstrApp.getRootController().model.attachEventListener("wikiSuggestionsChange",this.id,"populateList");},onitemSelected:function(item,index){var modifiedValue;if(item){modifiedValue=(item.n);}else{if(index&&index!==-1){modifiedValue=(this.items[index]);}else{modifiedValue=(this.text);}}this.raiseEvent({name:"itemSelectedChanged",newValue:modifiedValue,limit:25,off:0});}},{slot:"textInputNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",cssText:"float:left;margin-left:410px;margin-top:-22px;",text:mstrmojo.desc(10,"Search"),onclick:function(){if(this.parent.urlInput.text!=="Search for data or enter a URL to extract data."){this.parent.urlInput.raiseEvent({name:"itemSelectedChanged",newValue:this.parent.urlInput.text,limit:25,off:0});}}},{slot:"textOutputNode",scriptClass:"mstrmojo.Label",alias:"outputText",cssClass:"mstrmojo-di-public-data-output"},{slot:"gridOutputNode",scriptClass:"mstrmojo.DataGrid",alias:"outputGrid",cssClass:"mstrmojo-di-public-data-grid",setupScrollNodes:function setupScrollNodes(){this.scrollNode=this.scrollboxNode;},visible:false,multiSelect:true,markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="height:336px; {@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',selectionPolicy:"toggle",columns:[{headerCss:"mstrmojo-di-samplefiles-col1header",headerWidget:{scriptClass:"mstrmojo.ImageCheckBox",cssText:"padding-top:8px;",alias:"checkall",state:"unselect-all",preclick:function(){var w=this.dataGrid.parent;if(w.tableID){return ;}if(this.state==="select-all"){this.set("state","unselect-all");toggleSelectAll.call(this.dataGrid,false);}else{this.set("state","select-all");toggleSelectAll.call(this.dataGrid,true);}},onstateChange:function(){var CSS=mstrmojo.css;CSS.removeClass(this.inputNode,["select-all","unselect-all","select-some"]);CSS.addClass(this.inputNode,this.state);},postCreate:function(){this.set("state","unselect-all");}},colCss:"mstrmojo-di-samplefiles-col1",colWidth:"30",dataWidget:{scriptClass:"mstrmojo.ImageCheckBox",bindings:{label:"this.parent.data.display",checked:function(){return !!this.parent.dataGrid.selectedIndices[this.idx];}},preclick:function(){this.set("checked",!!this.parent.dataGrid.selectedIndices[this.idx]);this.parent.dataGrid.updateHeaderCheckbox();}}},{headerText:mstrmojo.desc(4283,"Source"),dataWidget:{colCss:"mstrmojo-di-public-data-grid-entry",scriptClass:"mstrmojo.Widget",markupString:'<div class="mstrmojo-di-public-data-source-container"><a href="{@value}" target="_blank"" mstrAttach:mouseover,mouseout,mousedown>{@value}</a></div>',bindings:{value:function(){return this.data.url+"#"+this.data.section.replace(/ /g,"_");}},onmouseover:function onmouseover(e){var me=mstrmojo.all[this.id];me.showTooltip(e,self);},onmouseout:function onmouseout(e){var me=mstrmojo.all[this.id];me.hideTooltip(e,self);},onmousedown:function onmousedown(e){e.e.stopPropagation();},postBuildRendering:function postBuildRendering(){function decode(encoded){return decodeURIComponent(encoded.replace(/\+/g," "));}var tableContent=decode(this.data.contents);tableContent=tableContent.replace(/\/\/upload.wikimedia.org\//ig,"http://upload.wikimedia.org/");this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:tableContent});}}},{headerText:mstrmojo.desc(39,"Description"),dataWidget:{colCss:"mstrmojo-di-public-data-grid-entry",scriptClass:"mstrmojo.Widget",markupString:"<div mstrAttach:mouseover,mouseout>{@value}</div>",bindings:{value:function(){return this.data.desc;}},onmouseover:function onmouseover(e){var me=mstrmojo.all[this.id];me.showTooltip(e,self);},onmouseout:function onmouseout(e){var me=mstrmojo.all[this.id];me.hideTooltip(e,self);},postBuildRendering:function postBuildRendering(){function decode(encoded){return decodeURIComponent(encoded.replace(/\+/g," "));}var tableContent=decode(this.data.contents);tableContent=tableContent.replace(/\/\/upload.wikimedia.org\//ig,"http://upload.wikimedia.org/");this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:tableContent});}},colCss:"mstrmojo-di-public-data-grid-entry"}],onchange:function(){var controller=mstrApp.getRootController();var selectedItems=this.getSelectedItems();if(selectedItems.length>0){controller.sourceSelected(true);}else{controller.sourceSelected(false);}},updateHeaderCheckbox:function(){var dataGrid=this,num=dataGrid.items.length,selectedNum=0,allCheckBox=dataGrid._headerWidgets_[0],i;if(!allCheckBox){return ;}for(i=0;i<num;i++){if(dataGrid.selectedIndices[i]){selectedNum++;}}if(selectedNum<=0){allCheckBox.set("state","unselect-all");}else{if(selectedNum>=num){allCheckBox.set("state","select-all");}else{allCheckBox.set("state","select-some");}}}}],tableidx:[],getFilesCnt:function(){if(this.urls){return this.urls.length;}return 0;},getFileUrl:function(idx){if(idx>=0){return this.urls[idx];}return -1;},setUrlTableIndices:function(){var i;for(i=0;i<this.urls.length;i++){this.tableidx[i]=0;}},setTableIndex:function(selectedIndex,tableIndex){this.tableidx[selectedIndex]=tableIndex;},getUrlTableIndices:function(idx){if(this.tableidx){return this.tableidx[idx];}},getFileTableID:function(idx){if(this.urls&&idx<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[idx]];}}});}());