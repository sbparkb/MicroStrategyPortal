(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.hash","mstrmojo.Button","mstrmojo.Label","mstrmojo.ToolSeparator","mstrmojo.ui.ScrollableContainer","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(1442,8689,11952,11953,11954,11955,11956,11957,12136);var $H=mstrmojo.hash,$NWB=mstrmojo.Button.newWebButton,validT=function(def){if(def){var t=def.t;return Math.round(t/10)==52||t==115;}return false;},changes={},sc,singleUnit,cgbs,unitId,an,_addChildren=function(){var me=this,myVis=me.vis,cc=[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",allowHTML:true,text:mstrmojo.desc(11952,"Use  <span>#</span> to filter the following targets:").replace("#",myVis.title),visible:true},{scriptClass:"mstrmojo.ui.ScrollableContainer",alias:"VisContainer",cssClass:"mstrmojo-scrollable-container",children:[]},{scriptClass:"mstrmojo.ToolSeparator"},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-filter-type",cssDisplay:"table-cell",alias:"filterType",selectedIndex:(!!an&&an.length>0)&&!singleUnit&&!sc?1:0,isHostedWithin:true,enabled:false,items:[{n:mstrmojo.desc(8689,"Filter"),v:true},{n:mstrmojo.desc(11953,"Highlight"),v:false}],onitemSelected:function(item){changes.isFilter=item.v;this.isFilter=item.v;me.csl.set("enabled",noChecked>0&&this.isFilter);me.forType.set("enabled",this.isFilter);},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-type-label",cssDisplay:"table-cell",text:mstrmojo.desc(11954,"data on selection"),visible:true},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-for-type",cssDisplay:"table-cell",alias:"forType",value:0,visible:false,selectedIndex:0,isHostedWithin:true,enabled:false,items:[{n:mstrmojo.desc(11955,"for #").replace("#",(cgbs[0]||{}).n),v:false},{n:mstrmojo.desc(11956,"for All Data"),v:true}],onitemSelected:function(item){changes.forAllData=item.v;},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);}},{scriptClass:"mstrmojo.CheckBox",cssClass:"mstrmojo-clear-check",alias:"csl",checked:(sc?sc.showall:true),cssDisplay:"block",label:mstrmojo.desc(11957,"Allow users to clear all selections"),enabled:false,oncheckedChange:function(){changes.clearAll=this.checked;}}],viss=myVis.parent.children,i,targetKeys={},noChecked=0,addVis=function(i){var cv=viss[i],checked,ft,singleCGB;if(an){checked=mstrmojo.array.find(an,"k",cv.k)!==-1;}else{if(cgbs.length>0){if(cgbs[0]&&cgbs[0].sc&&cgbs[0].sc.tks){checked=cgbs[0].sc.tks.indexOf(cv.k)>-1;}}}noChecked+=checked?1:0;if(cv!==myVis&&validT(cv.defn)){ft=cv.boxContent.getFilterType();singleCGB=cv.boxContent.model.getSelectorControlMapInfo();targetKeys[cv.k]={c:false,v:checked,ft:ft,cgbs:singleCGB};cc[1].children.unshift({scriptClass:"mstrmojo.CheckBox",cssDisplay:"block",label:cv.title,checked:checked,oncheckedChange:function(){targetKeys[cv.k]={c:true,v:this.checked,ft:ft,cgbs:singleCGB};changes.targetKeys=targetKeys;noChecked+=this.checked?1:-1;me.forType.set("enabled",noChecked>0&&me.filterType.isFilter);me.filterType.set("enabled",noChecked>0);me.csl.set("enabled",noChecked>0&&me.filterType.isFilter);}});}};for(i=viss.length-1;i>=0;i--){addVis(i);}this.addChildren(cc);this.targetKeys=targetKeys;};mstrmojo.vi.ui.editors.VisAsFilterDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.VisAsFilterDialog",title:mstrmojo.desc(12136,"Filtering options"),cssClass:"mstrmojo-vis-as-filter",btnAlignment:"right",vis:null,buttons:null,modal:true,visible:false,help:"filtering_options_dialog_box_html5.htm",onOpen:function onOpen(){this.VisContainer.onOpen();},postBuildRendering:function postBuildRendering(){this._super();changes={};},toggleFields:function toggleFields(){if(cgbs.length!==0){this.forType.set("visible",true);this.filterType.set("enabled",true);}if(an&&an.length>0){this.filterType.set("enabled",true);}if(sc){this.csl.set("enabled",true);}},preBuildRendering:function preBuildRendering(){var that=this,myId=that.id,visModel=that.vis.boxContent.model,myVis=that.vis;cgbs=(visModel.getSelectorControlMapInfo?visModel.getSelectorControlMapInfo():[]);if(cgbs.length>0){sc=cgbs[0].sc;unitId=cgbs[0].did;singleUnit=true;}else{an=myVis.defn.an;sc=myVis.boxContent.selectorControl||(myVis.boxContent.findSelectorControl&&myVis.boxContent.findSelectorControl());singleUnit=false;}this.set("buttons",[$NWB(mstrmojo.desc(1442,"OK"),function(){if(!$H.isEmpty(changes)){changes.targetKeys=that.targetKeys;changes.singleUnit=singleUnit;if(singleUnit){changes.unitId=unitId;}changes.sc=sc;myVis.model.setVisAsFilter(myVis,changes);}mstrmojo.all[myId].destroy();},true),$NWB(mstrmojo.desc(221,"Cancel"),function(){mstrmojo.all[myId].destroy();})]);_addChildren.call(this);this.toggleFields();this._super();}});mstrmojo.vi.ui.editors.VisAsFilterDialog.open=function(vis){var w=mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.editors.VisAsFilterDialog",vis:vis});w.open();};}());