(function(){mstrmojo.requiresCls("mstrmojo.vi.VisualInsightApp","mstrmojo.onetier.controllers.RootController","mstrmojo.customVisLoader","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.array","mstrmojo.string");var $CSS=mstrmojo.css,$DOM=mstrmojo.dom,$HASH=mstrmojo.hash,$ARR=mstrmojo.array,$STR=mstrmojo.string;var CUSTOM_VIZ_CSS=["global.css","Html5ViPage.css"],CUSTOM_VIZ_CSS_HREF_PATHS=["../plugins/","/style/"];function setupCustomVisualizations(pluginNames,isVisBuilderApp){if(pluginNames&&pluginNames.length>0){var customCss=[];$HASH.copy(mstrmojo.customVisLoader.loadVisualizations(pluginNames,isVisBuilderApp),mstrConfig.pluginsVisList);pluginNames.forEach(function(pluginName){if(!isVisBuilderApp&&pluginNames[pluginName]==="nonDashboard"){return ;}customCss=customCss.concat(getCustomVizCSSPaths(pluginName));});mstrmojo.insertCSSLinks(customCss);}}function deleteCustomVisualizations(pluginNames){var currentPluginVisList=mstrConfig.pluginsVisList;pluginNames.forEach(function(cachedName){for(vizName in currentPluginVisList){if(currentPluginVisList[vizName].pn===cachedName){delete currentPluginVisList[vizName];}}});}function getCustomVizCSSPaths(custVizname){var customCss=[];CUSTOM_VIZ_CSS.forEach(function(cssFile){customCss.push(CUSTOM_VIZ_CSS_HREF_PATHS[0]+custVizname+CUSTOM_VIZ_CSS_HREF_PATHS[1]+cssFile);});return customCss;}var openModalDialogs={};mstrmojo.onetier.OneTierApp=mstrmojo.declare(mstrmojo.vi.VisualInsightApp,null,{scriptClass:"mstrmojo.onetier.OneTierApp",isSingleTier:true,isPrefLangChanged:false,isPrefNdfChanged:false,start:function start(docModelData){$CSS.addClass(document.body,mstrApp.isSingleTier&&$DOM.getOSInfo().name.toLowerCase().indexOf("mac")>-1?"mac":"none-mac");mstrApp.set("browseAllObjects",!docModelData.disableAllObjects);setupCustomVisualizations(mstrConfig.pluginNames,this.isVisBuilderApp);this._super(docModelData);if(docModelData.istup){window.setTimeout(function(){window.FormWrapper.restoreDashboard();},0);}},getRootController:function getRootController(){return(this.rootCtrl=this.rootCtrl||new mstrmojo.onetier.controllers.RootController());},getRecentGallery:function getRecentGallery(isOnVizDeletion){var cachedNames=mstrConfig.pluginNames,currentNames=mstrConfig.pluginNames=eval(window.FormWrapper.getCustomizationNames());if(!!isOnVizDeletion){deleteCustomVisualizations($ARR.difference(cachedNames,currentNames));}else{setupCustomVisualizations($ARR.difference(currentNames,cachedNames));}},serverResponse:function serverResponse(id,methodName,requestID,status,responseJSON){if(!mstrmojo.all[id]||!status){this.onerror(responseJSON);}this._super(id,methodName,requestID,status,responseJSON);},getPreferredColors:function getPreferredColors(){return[];},openPage:function openPage(url){window.FormWrapper.openPage(url);},modalEditorChange:function modalEditorChange(id,isOpen){var fnToggle=function(){window.FormWrapper.toggleNetMenu(Object.keys(openModalDialogs).length?"disable":"enable");};if(isOpen){openModalDialogs[id]=true;fnToggle();}else{delete openModalDialogs[id];fnToggle();}}});}());