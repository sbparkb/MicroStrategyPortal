(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.XtabZone","mstrmojo.DICFactory","mstrmojo.DynamicClassFactory");var MARKROW=102,ROW_HEADER_MERGED=1,TX_MARK=2,TX_DISABLED=1,TX_REQUIRED=4,$C=mstrmojo.css,$D=mstrmojo.dom,$H=mstrmojo.hash,$A=mstrmojo.array,$CFC=mstrmojo.DynamicClassFactory.newComponent,CP_TITLE=1,CP_COL_HEADERS=2,CP_ROW_HEADERS=4,COL_AXIS=2,TX_ELEM_ATT_FORM=1,TX_ELEM_METRIC=2,MARK_ROW=1,CHANGE_DATA=2,MR_MANIPULATION_UNSET=1,MR_MANIPULATION_SELECT=2,DATA_DRIVEN_CONTROL=2,XTAB=1,CLEAR_ATTRIBUTE_DDIC_CHANGES=6,CLEAR_METRIC_DDIC_CHANGES=7,getGroupIdx=function(cell){if(cell){return cell.tui>=0?("h_"+cell.tui+"_"+cell.fi+"_"+cell.axis):("m_"+cell.mix);}return"";};function applyChange(c,k,vo){var t=this.nm[k],v=vo.v,dv=vo.dv;c.rv=v;c.v=dv;c.mdf=1;if(c._src){c._src.rv=v;c._src.v=dv;c._src.mdf=1;}var dicWidget=this.dicGroupMap[getGroupIdx(c)].widgetsMap[c._ei];if(!dicWidget.showByDefault){if(dicWidget.hasPreview){dicWidget.renderPreview();}else{if($D.isIE7&&mstrmojo.string.isEmpty(v)){v=" ";}t[t.innerText!==undefined?"innerText":"textContent"]=(!v?"\u00a0":v);}}return t;}function onTotalRow(cp,o,rs){if(rs[o]===0){return true;}if(cp&&rs[o]===undefined){try{var cells=cp.getRowCells(o),c=cells&&cells[0];if(c&&c.o===o){if(c.sst){rs[o]=0;}return !!c.stt;}if(c&&c.o){return onTotalRow(cp,o+o-c.o,rs);}return false;}catch(ex){return false;}}else{return false;}}function updateSelectedRows(marked,rs){$A.forEach(marked,function(m){rs[m.o]=1;});}function clearMergedHeaderMarks(gd){if(gd.mgh&&(gd.mgh&ROW_HEADER_MERGED)){this.mghMarks={};}}function clearSelectedRowsForBlock(selections,block){var begin=block.bb-1,end=Math.min(begin+block.bc,block.tc),row;$H.forEach(selections,function(v,idx){row=Number(idx);if(!isNaN(row)&&row>=begin&&row<end){delete selections[idx];}});}function markDirtyRows(c,rowIdx){var rs=this.editing?1:(c.rs||1),i;for(i=0;i<rs;i++){this.dirtyRows[rowIdx+i]=1;}}function isDataDrivenDIC(di){return di&&parseInt(di.ipt,10)===DATA_DRIVEN_CONTROL;}function getRowIndex(cell){var _grid;this.delegateGridAction(function(grid){if(!_grid&&grid.posMap&&grid.posMap[cell._ei]){_grid=grid;}},"getRowIndex");return _grid.getRowIdxByCell(cell);}function markEditableColHeaders(grid){var thPosMap=grid.thPosMap,slot=grid.slot,len=thPosMap&&thPosMap.length||0,lastHeaderIndex=this.lastHeaderIndexs[slot]||0,tableNodes=[grid.tableNode],pos,node,cell,i;if(this.getStickedTableNodes){tableNodes=tableNodes.concat(this.getStickedTableNodes());}for(i=lastHeaderIndex;i<len;++i){pos=thPosMap[i],cell=pos.obj;if(this.isEditableHeader(cell)){for(var tnIdx in tableNodes){markEditableCHNode(tableNodes[tnIdx],pos);}}}this.lastHeaderIndexs[slot]=i;}function markEditableCHNode(tableNode,pos){var node=tableNode.tBodies[pos.page].rows[pos.row].cells[pos.cell];node.innerHTML='<div class="editable-column">'+node.innerHTML+"</div>";}function extraColumnWidth(colWidths){var fixedLayout=true,cw=colWidths||[];for(var i=0,len=cw.length;i<len;i++){if(cw[i]&&(cw[i].w==="")){fixedLayout=false;break;}}return fixedLayout?"40px":"";}function inputControlEnabled(cell){return !cell.tav||!(cell.tav&TX_DISABLED);}mstrmojo._IsEditableGridCP={_mixinName:"mstrmojo._IsEditableGridCP",initContent:function initContent(startIndexInContainer){this._super(startIndexInContainer);var gd=this.gridData,vp=gd&&gd.vp,i,j,fm,size,cg,cl,cws,rt;if(((this.type===CP_TITLE)||(this.type===CP_ROW_HEADERS))&&vp&&vp.cols&&!vp._adjusted){cg=vp.cols.cg;cws=vp.cols.cws;if(cg&&cg.cgc>0){for(i=cg.cgc;i>0;i--){cg[i]=$H.copy(cg[i-1],{});cl=cg[i];var fms=cl.attForms;if(fms){for(j=0,size=fms.length;j<size;j++){fm=fms[j];fm.idx+=1;}}}cg[0]={tg:false,cc:0,cl:1,attForms:[{n:"",idx:0}]};cg.cgc+=1;}if(cws){cws.splice(0,0,{w:"60px",xc:true});}if(vp.dafIdx!==undefined){vp.dafIdx+=1;}rt=gd.gts.row;for(i=0,size=rt.length;i<size;i++){rt[i].ci=i+1;}vp._adjusted=true;}this.colWidths=[{w:extraColumnWidth(this.colWidths)}].concat(this.colWidths);this.unmergedCells=[];},getUnmergedCells:function getUnmergedCells(){return null;},getRowCells:function getRowCells(ri){var cells=this._super(ri),cell=cells[0],o=(cell&&cell.o)||0,isTtl=(this.tp===CP_TITLE),ics=this.interactiveCellsArray,fc={css:"",v:""},umc=[],ncs=[],i,len;if(!isTtl){var rows=this.base.items,lb=this.lookupBase,cssBase=this.gridData.css,pi=cell&&cell.pi,r=pi&&pi.ri,c=pi&&pi.ci,otr=cell.stt>0;while(pi&&r>-1&&c>-1){cell=cell._p||rows[r].items[c];var _c=$H.copy(cell,{});_c._src=cell;if(!_c.css){_c.css=cssBase[_c.cni].n;}var unit=lb[cell.tui],e=unit&&unit.es[cell.idx];if(e){_c.v=cell.v||e.n;_c._e=e;}_c.rs=1;if(otr){_c.at&=~32;}if(o>-1){_c.o=o;}if(!_c.axis&&this.axis){_c.axis=this.axis;}_c._ei=ics.push(_c)-1;umc.splice(0,0,_c);pi=cell&&cell.pi;r=pi&&pi.ri;c=pi&&pi.ci;}for(i=0,len=cells.length;i<len;i++){var nc=cells[i];if(nc.rs>1){var tc=$H.copy(nc,{});tc.rs=1;nc=tc;}ncs.push(nc);}}else{ncs=cells;if(ri>0){return cells;}}if(ncs[0]){fc=$H.copy(ncs[0],{});fc.rv=fc.v="";if(this.tp===CP_TITLE){fc.n=fc.v="";fc.markAll=true;}else{fc.n="";}fc._ei=ics.push(fc)-1;fc.at=32;fc.cs=1;fc.mark=true;fc.mix="x";fc.css=(umc[0]&&umc[0].css)||fc.css;delete fc.ui;delete fc.tui;delete fc.fs;delete fc.mdf;}return[fc].concat(umc.concat(ncs));}};mstrmojo._IsEditableXtab=mstrmojo.provide("mstrmojo._IsEditableXtab",{_mixinName:"mstrmojo._IsEditableXtab",update:function update(node){var marks,gd=node.data;if(this._super){this._super(node);}this.kc={};this.rs={};this.rsDelta={};clearMergedHeaderMarks.call(this,gd);if(gd.eg!==undefined){return ;}marks=node.data.marked;if(marks){updateSelectedRows(marks,this.rs);}if(!gd.rw){var rc=gd.gvs.items.length;gd.rw={row:{bb:1,bc:rc,tc:rc},col:{bb:-1,bc:-1,tc:0}};}},initCP:function initCP(gd,interactiveCellsArray,tp,base,lkpBase,ax,cp){var props={gridData:gd,type:tp,interactiveCellsArray:interactiveCellsArray};props.base=base||props.base;props.lookupBase=lkpBase||props.lookupBase;props.axis=ax||props.axis;props.dataSource=this;if(!cp){if(this.tca===TX_MARK&&this.editing){if(tp===CP_TITLE){mstrmojo.EditableXtabTitlesCP=$CFC(mstrmojo.XtabTitlesCP,[mstrmojo._IsEditableGridCP],{scriptClass:"mstrmojo.EditableXtabTitlesCP",tp:CP_TITLE});cp=new mstrmojo.EditableXtabTitlesCP(props);}else{if(tp===CP_ROW_HEADERS){mstrmojo.EditableXtabCP=$CFC(mstrmojo.XtabCP,[mstrmojo._IsEditableGridCP],{scriptClass:"mstrmojo.EditableXtabCP"});cp=new mstrmojo.EditableXtabCP(props);}else{cp=new mstrmojo.XtabCP(props);}}}else{if(tp===CP_TITLE){cp=new mstrmojo.XtabTitlesCP(props);}else{cp=new mstrmojo.XtabCP(props);}}}else{$H.copy(props,cp);}return cp;},createOnDemandCP:function createOnDemandCP(blockNum,rc,zone){var cp;if(this.tca===TX_MARK&&this.editing&&zone===CP_ROW_HEADERS){mstrmojo.EditableXtabOnDemandCP=$CFC(mstrmojo.XtabOnDemandCP,[mstrmojo._IsEditableGridCP],{scriptClass:"mstrmojo.EditableXtabOnDemandCP"});cp=new mstrmojo.EditableXtabOnDemandCP();}else{cp=new mstrmojo.XtabOnDemandCP();}cp.dataSource=this;cp.blockNum=blockNum;cp.rc=rc;return cp;},preBuildRendering:function preBuildRendering(){var txi=this.defn.txi;if(this._super){this._super();}this.txar=txi.txar;this.sci=txi.sci;this.tca=txi.tca;if(this.tca!==TX_MARK){this.editing=false;}else{if(mstrApp.isMobile){this.editing=this.alwaysEditing=true;}}this.nm={};this.ko={};this.dirtyRows={};this.requiredCellsMap={};this.dicGroupMap={};this.lastIndex=0;this.lastHeaderIndexs={};this.columnNames={};},postBuildRendering:function postBuildRendering(){if(this._super){this._super();}if(this.tca===TX_MARK&&this.gridData.eg===undefined){var t=Math.max(-16,-this.domNode.offsetTop),me=this;if(!this.alwaysEditing){var dn=mstrmojo.Button.newIconButton(mstrmojo.desc(8324,"Mark rows"),"mstrmojo-EditButton",function(){if(!me.recalculating){me.editing=!me.editing;me.refresh();}}),btn=new mstrmojo.Button(mstrmojo.hash.copy({cssText:"top:"+t+"px;"},dn));btn.render();this.domNode.appendChild(btn.domNode);if(this.editing){this.domNode.style.zIndex=1000;$C.addClass(btn.domNode,"close");}else{$C.removeClass(btn.domNode,"close");}}}},dataDownloadErr:function dataDownloadErr(){if(this.txar&&this.recalculating){this.delegateGridAction(function(grid){grid.isDownloading=false;},"isDownloading");this.rhsCP.initContent();this.valuesCP.initContent();$C.removeClass(this.maskNode,"wait");this.recalculating=false;}},dataDownloaded:function dataDownloaded(node,memo){var gd=node.data;if(this.txar){var idx=memo.blockNum,ica;if(this.recalculating){memo.recalculating=true;this.interactiveCellsArray=[];this.requiredCellsMap={};this.dirtyRows={};this.lastIndex=0;this.lastHeaderIndexs={};this.kc={};this.nm={};this.updatedCellsMap={};this.recalculating=false;this.destroyDICs();}else{memo.recalculating=false;}if(idx===0){this.gridData=gd;}if(gd.eg){this.refresh();return ;}ica=this.interactiveCellsArray;this.initCP(gd,ica,CP_TITLE,null,null,null,this.titlesCP);this.initCP(gd,ica,CP_COL_HEADERS,gd.ghs.chs,gd.gts.col,COL_AXIS,this.chsCP);this.titlesCP.initContent();this.chsCP.initContent();this.delegateGridAction(function(gird){if(ica&&ica.length===0){grid.refresh();}},"refreshOnDataDownloaded");}if(this._super){this._super(node,memo);}clearMergedHeaderMarks.call(this,gd);clearSelectedRowsForBlock(this.rs,gd.rw.row);if(gd.marked){updateSelectedRows(gd.marked,this.rs);this.rsDelta={};}},closeDownloadStatus:function closeDownloadStatus(){if(this._super){this._super();}mstrmojo.css.removeClass(this._STATUS,"recalculate");},kc:null,ko:null,nm:null,rs:null,dicGroupMap:null,lastIndex:0,lastHeaderIndexs:{},columnNames:null,getDataInputInfo:function getDataInputInfo(cell,widx){var k=cell._ei,o,defn=this.node.defn,data=this.gridData;if(cell.mark){o=cell.o;if(cell.stt){this.rs[o]=0;return ;}this.ko[o]=k;cell.rv=cell.v=this.rs[o]||-1;this.kc[k]={rowop:true};return{key:k,t:MARKROW,vls:[{v:-1},{v:1}],wm:1,w:22,hm:1,h:16,dm:1};}var titleInfo=this.model.getCellTitleInfo(cell,this.dataBlocks[cell._gd]),title=titleInfo&&titleInfo.title,es=title&&title.es,mti=(cell.mti!==undefined)?cell.mti:cell.mix,isMtx=(cell.mix!==undefined),dic=defn.txi.dic,di;di=$H.copy(!isMtx?dic.att&&title&&dic.att[title.id]&&dic.att[title.id][title.fs[cell.fi].id]:dic.mtx&&dic.mtx[es[mti].oid],{});if(!di){return null;}if(this.columnNames[widx]===undefined){this.columnNames[widx]=!isMtx?title.n:es[mti].n;}if(isDataDrivenDIC(di)){di.vls=(data.dcv&&data.dcv[di.k])||[];}if(data.tcs&&data.tcs[di.k]){var action=data.tcs[di.k];if(action&TX_DISABLED){di.disabled=true;}if(action&TX_REQUIRED){di.req=1;}}if(k>=0&&!this.kc[k]){var isMv=!cell.axis,t={isMv:isMv};if(isMv){var pi=cell.pi,tp=pi&&pi.top;t.co=(tp&&tp.ci)||0;t.metric_id=es[mti].oid;cell.o=t.o=(cell._lp&&cell._lp.o)||0;t.tp=TX_ELEM_METRIC;}else{t.ax=cell.axis;t.atid=title.id;t.form_id=title.fs[cell.fi].id;t.o=cell.o;t.tp=TX_ELEM_ATT_FORM;t.fi=cell.fi;t.ui=cell.ui;t.tui=cell.tui;t.rs=cell.rs;}t.dt=di.dt;if(isDataDrivenDIC(di)){t.vls=di.vls;t.k=di.k;}this.kc[k]=t;}di.key=k;if(di.dm){di.dm=parseInt(di.dm,10);}return di;},isEditableHeader:function isEditableHeader(cell){var defn=this.node.defn,dic=defn.txi.dic;if(cell.sst||!dic){return false;}if(cell.id!==undefined&&dic.att){return !!(dic.att[cell.id]&&(cell.fix?dic.att[cell.id][cell.fid]:dic.att[cell.id]));}if(cell.tui!==undefined&&cell.mix!==undefined&&dic.mtx){return !!(dic.mtx[cell._e.oid]);}return false;},dataChanged:function dataChanged(k,r,v,d,ctlKey){if(!this.recalculating){if(d){this.nm[k]=d;}if(this._super){this._super(k,r,v,d,ctlKey);}}},updateValue:function updateValue(k,vo){if(this._super){this._super(k,vo);}var c=this.interactiveCellsArray[k],v=vo.v,t,rowIdx=getRowIndex.call(this,c);this.lmr=null;t=applyChange.call(this,c,k,vo);if(c.r!==v){if(!c.mark){c.mdf=1;mstrmojo.css.removeClass(t,"required");markDirtyRows.apply(this,[c,rowIdx]);this.flagDirtyUnit(t);}}else{this.clearDirtyUnit(t);}if(this.onCellUpdated){this.onCellUpdated(c,t);}if(this.tca===TX_MARK){if(c.mark){var ordinal=c.markAll?-1:c.o,rsDelta=this.rsDelta;this.rs[ordinal]=v;this.lmr={r:ordinal,v:v};if(c.markAll){rsDelta=this.rsDelta={};rsDelta[ordinal]=v;this.mghMarks={};}else{if(rsDelta[ordinal]&&rsDelta[ordinal]!==v){delete rsDelta[ordinal];}else{if(rsDelta[-1]!==v){rsDelta[ordinal]=v;}}}}else{if(this.rs[c.o]!==0){this.rs[c.o]=1;}if(!this.editing&&this.mghMarks&&(c.mix===undefined)){if(!this.mghMarks[c.o]||this.mghMarks[c.o].rs<c.rs){this.mghMarks[c.o]={o:c.o,rs:c.rs,k:k};}var sro,sco,me=this;$H.forEach(this.rsDelta,function(mv,ro){sro=parseInt(ro,10);sco=parseInt(c.o,10);if(sro>=sco&&sro<=(sco+c.rs)){delete me.rsDelta[ro];}});}else{this.rsDelta[c.o]=1;}if(!this.editing&&c.rs>1){var o=c.o+1;while(o-c.o<c.rs){if(!onTotalRow(this.rhsCP,o,this.rs)){this.rs[o]=1;}o+=1;}}if(this.editing){var w=this.dicGroupMap.m_x.widgetsMap[this.ko[c.o]];if(w){w.set("checked",true);}}}}if(this.txar&&!c.mark){return true;}return false;},autoRefresh:function autoRefresh(evt){this.delegateGridAction(function(grid){grid.invalidAllPages();},"invalidAllPages");this.rhsCP.invalid();this.valuesCP.invalid();$C.addClass(this._STATUS,"recalculate");this.delegateGridAction(function(grid){grid.onscroll(true,evt);},"scrollOnAutoRefresh");this.recalculating=true;},getKeyContext:function getKeyContext(key){return this.kc[key];},getUpdateObject:function getUpdateObject(){var cs=[],j,udvs,udv,lmr=this.lmr,v,ddicObj={};if(lmr){this.lmr=null;return{manipulation:MARK_ROW,actionType:(lmr.v===-1)?MR_MANIPULATION_UNSET:MR_MANIPULATION_SELECT,rowOrdinal:lmr.r,nodeKey:this.k,sliceId:this.sid};}udvs=this.getUpdatedValues();for(j=0;j<(udvs&&udvs.length);j++){if(!udvs[j].rowop){udv=udvs[j];break;}}if(udv){v=mstrmojo.string.encodeXMLAttribute(String(udv.v));if(udv.k!==undefined&&udv.vls){var idx=$A.find(udv.vls,"v",udv.v);if(idx!==-1){ddicObj={controlKey:udv.k,elementId:udv.vls[idx].eid};}}if(!!udv.isMv){cs.push($H.copy(ddicObj,{rowOrdinal:udv.o,colOrdinal:udv.co,newValue:v,dataType:udv.dt}));}else{cs.push($H.copy(ddicObj,{rowOrdinal:udv.o,attId:udv.atid,formId:udv.form_id,unitIndex:udv.tui||udv.ui,newValue:v,dataType:udv.dt}));}}return{manipulation:CHANGE_DATA,nodeKey:this.k,sliceId:this.sid,cells:cs,autoRefresh:this.txar};},getUpdates:function getUpdates(){var w=this,j,udv,udvs=w.getUpdatedValues(),srs=this.rsDelta,eg=[],gd=[],udt=false,k="";eg.push('<gr rw_tree_type="'+w.treeType+'" rw_node_key="'+w.k+'" slice_id="'+w.sid+'">');for(j in udvs){if(udvs.hasOwnProperty(j)){udv=udvs[j];if(!udv.rowop){var v=mstrmojo.string.encodeXMLAttribute(String(udv.v)),m=$A.find(udv.vls,"v",udv.v);if(udv.k&&udv.vls&&m===-1){if(!!udv.isMv){gd.push('<cli cordinal="'+udv.co+'" metric_id="'+udv.metric_id+'"><updt types="'+CLEAR_METRIC_DDIC_CHANGES+'" rordinal="'+udv.o+'" rw_control_key="'+udv.k+'"/></cli>');}else{gd.push('<cli ax="'+udv.ax+'" attribute_id="'+udv.atid+'" form_id="'+udv.form_id+'"><updt types="'+CLEAR_ATTRIBUTE_DDIC_CHANGES+'" ordinal="'+udv.o+'" rw_control_key="'+udv.k+'" flags="1"/></cli>');}}else{if(udv.k&&udv.vls&&m!==-1){k='rw_control_key="'+udv.k+'" element_id="'+udv.vls[m].eid+'" ';}if(!!udv.isMv){gd.push('<cli cordinal="'+udv.co+'" metric_id="'+udv.metric_id+'"><updt types="'+udv.tp+'" rordinal="'+udv.o+'" '+k+'value="'+v+'" dt="'+udv.dt+'"/></cli>');}else{gd.push('<cli ax="'+udv.ax+'" attribute_id="'+udv.atid+'" form_id="'+udv.form_id+'"><updt types="'+udv.tp+'" ordinal="'+udv.o+'" '+k+'value="'+v+'" dt="'+udv.dt+'"'+(this.mghMarks?' flags="1"':"")+"/></cli>");}}udt=true;}}}if(!$H.isEmpty(this.mghMarks)){var me=this;$H.forEach(this.mghMarks,function(v,ro){k=me.getKeyContext(v.k);gd.push('<mark rordinal="'+ro+'" types="4" flags="1" attribute_id="'+k.atid+'" form_id="'+k.form_id+'"/>');});}if(srs&&!$H.isEmpty(srs)){udt=true;$A.forEach($H.keyarray(srs).sort(),function(o){if(srs[o]===1){gd.push('<mark rordinal="'+o+'" types="4"/>');}else{gd.push('<mark rordinal="'+o+'" types="5"/>');}});}eg.push(gd.join(""));eg.push("</gr>");if(!udt){eg=[];}return eg.join("");},flagDirtyUnit:function flgDtUnt(t){if(t&&this.sci){if(this._super){this._super(t);return ;}var v=document.createElement("div"),df,tf=false,trans3d=$C.getStyleValue(this.domNode,$D.CSS3_TRANSFORM),isTDRelative;v.className="flag-container";v.innerHTML='<div class="dirty-cell"/>';if(t.insertBefore){t.insertBefore(v,t.firstChild);isTDRelative=(v.offsetParent===t);}tf=mstrmojo.string.isEmpty(trans3d)||trans3d==="none";df=v.firstChild;df.style.top=((!tf||isTDRelative)?(-v.offsetTop):(t.offsetTop-v.offsetTop))+"px";df.style.left=(t.clientWidth+((!tf||isTDRelative)?(-v.offsetLeft):(t.offsetLeft-v.offsetLeft))-8)+"px";}},clearDirtyUnit:function clrDtUnt(t){if(this._super){this._super(t);return ;}var c=t.firstChild;if(t){if(c&&c.className&&c.className==="flag-container"){t.removeChild(c);}}},onvisibleChange:function onvisChg(){if(this.visible===true){var me=this;setTimeout(function(){me.configureActions();},10);}},configureActions:function cfgAct(){if(this.visible===false){return ;}this.configureCellsAction();this.lastIndex=this.interactiveCellsArray.length;var me=this;this.delegateGridAction(function(grid){markEditableColHeaders.call(me,grid);},"markEditableColHeaders");this.registerTxWidget();if(this._super){this._super();}},configureCellsAction:function configureCellsAction(interactiveCellsArray,startIndex,posMap,notSetDirtyFlag){var me=this,grid=this.getTargetZone(),posMap=posMap||grid.posMap,ics=interactiveCellsArray||this.interactiveCellsArray,startIndex=(startIndex===undefined?this.lastIndex:startIndex),dicGroupMap=this.dicGroupMap,dirtyNodes=[],ei,len,i,k,cell,pos,node,widx,rowIdx,currentRow,config,dicGroup,tableNode,getGrids=function(){var _grids=[];this.delegateGridAction(function(grid){_grids.push(grid);},"configureActions");return _grids;},grids=getGrids.call(this),rowLocked=(grids.length>1),flagDirtyNodes=function(dns){var jLen=dns.length,j;for(j=0;j<jLen;j++){me.flagDirtyUnit(dns[j]);}};for(ei=startIndex,len=ics.length;ics[ei]&&ei<len;ei++){cell=ics[ei];pos=posMap&&posMap[ei];if(!pos&&rowLocked){grid=(grids[0]===grid)?grids[1]:grids[0];posMap=grid&&grid.posMap;pos=posMap&&posMap[ei];}if(pos&&((cell.at&32)>0)){cell.at=32;if(cell.rv==null){cell.rv=isNaN(cell.mix)?cell._e.n:cell.v;}widx=getGroupIdx(cell);config=this.getDataInputInfo(cell,widx);dicGroup=dicGroupMap[widx];if(cell.axis===1&&this.clonedRowHeader){if(this.clonedRowHeader.isRendered()){tableNode=this.clonedRowHeader.getTableNode();}else{tableNode=grid.tableNode;if(config&&!dicGroup){this.clonedRowHeader.addGroupKey(widx);}this.clonedRowHeader.addTempDICInfo(cell,pos);}}else{if(cell.axis===2&&this.clonedColHeader&&this.clonedColHeader.isRendered()){tableNode=this.clonedColHeader.getTableNode();}else{tableNode=grid.tableNode;}}node=tableNode.tBodies[pos.page].rows[pos.row].cells[pos.cell];if(config){if(!dicGroup){dicGroup=dicGroupMap[widx]=mstrmojo.DICFactory.createDICGroup({gk:widx,dic:config,owner:this,openerType:XTAB});}var dicDisabled=!inputControlEnabled(cell)||config.disabled;var dicProps={value:(cell.rv===undefined)?(cell.v||cell.n):(typeof cell.rv==="string"?mstrmojo.string.decodeHtmlString(cell.rv):cell.rv),dv:cell.v||cell.n,ts:cell.ts,markAll:cell.markAll,openerNode:node,k:cell._ei,ownerCell:cell,enabled:!dicDisabled,popupTitle:this.columnNames[widx]},stackedRh=grid.cp.stackedRh;if(stackedRh&&cell.singleStack&&(mstrmojo.DICConfig.showDICByDefault(config,1)||mstrmojo.DICConfig.hasDICPreview(config,1))){var tdHeight=node.offsetHeight;node.className+=" igDIC";node.style.cssText="height:"+tdHeight+"px;";if(dicGroup.showByDefault){node.className+=" sbd";}mstrmojo.hash.copy({inlineExtraCssText:"position:absolute;top:"+parseInt(stackedRh/2-tdHeight/2+1,10)+"px;"},dicProps);}dicGroup.addDIC(cell._ei,dicProps);rowIdx=pos.page*grid.rowsPerPage+pos.row;if(config.req){for(k=0;k<(this.editing?1:(cell.rs||1));k++){currentRow=this.requiredCellsMap[rowIdx+k];if(!currentRow){this.requiredCellsMap[rowIdx+k]=currentRow=[];}currentRow.push(cell);}}if(cell.mdf&&!notSetDirtyFlag){dirtyNodes.push(node);markDirtyRows.apply(this,[cell,rowIdx]);}if(dicDisabled&&!mstrmojo.DICConfig.showDICByDefault(config,1)){var container=document.createElement("div"),spanNode=document.createElement("span"),s=node.currentStyle||document.defaultView.getComputedStyle(node,null),properties={marginLeft:"-"+s.paddingLeft,paddingLeft:s.paddingLeft,marginRight:"-"+s.paddingRight,paddingRight:s.paddingRight,marginTop:"-"+s.paddingTop,paddingTop:s.paddingTop,marginBottom:"-"+s.paddingBottom,paddingBottom:s.paddingBottom};container.className="xtab-dic-disabled";$H.copy(properties,container.style);spanNode.appendChild(node.firstChild);container.appendChild(spanNode);node.appendChild(container);}}}}this.lastIndex=ei;for(widx in dicGroupMap){dicGroupMap[widx].render();}setTimeout(function(){flagDirtyNodes(dirtyNodes);},25);},destroyDICGroup:function destroyDICGroup(groups){var dicGroupMap=this.dicGroupMap,idx,widx,dicGroup;if(dicGroupMap&&(groups instanceof Array)){for(idx in groups){widx=groups[idx];dicGroup=dicGroupMap[widx];if(dicGroup){dicGroup.destroy();delete dicGroupMap[widx];}}}},showPopupDIC:function showPopupDIC(target){var tn=target&&$D.findAncestorByAttr(target,"ei",true,this.viewport);if(tn){var td=tn.node,cell=this.getCellForNode(td),group=this.dicGroupMap[getGroupIdx(cell)];if(group&&!group.dic.disabled&&!(cell.tav&&(cell.tav&TX_DISABLED))){group.showPopupDIC(cell._ei);return true;}}return false;},onclick:function onclick(e){var target=mstrmojo.dom.eventTarget(window,e.e);if(!this.showPopupDIC(target)&&this._super){this._super(e);}},unrender:function unrender(){if(this._super){this._super();}this.destroyDICs();},destroyDICs:function destroyDICs(){var dicGroupMap=this.dicGroupMap;this.dicGroupMap={};setTimeout(function(){var i;for(i in dicGroupMap){dicGroupMap[i].destroy();}},10);},checkRequiredObjects:function checkRequiredObjects(){if(this.hasRendered&&!(this.isInteractiveGrid&&this.isInteractiveGrid())&&!this.gridData.eg){var grid=this.getTargetZone(),posMap=grid.posMap,row,me=this,rowSelections=this.rs,validFlag=true,processRow=function(r,hilite){var valid=true,cells=me.requiredCellsMap[r],len=(cells&&cells.length)||0,i;for(i=0;i<len;i++){if(!cells[i].mdf){$C.toggleClass(grid.getNodeByPosition(posMap[cells[i]._ei]),"required",hilite);valid=!hilite;}}return valid;};if(this.tca===TX_MARK){for(row in rowSelections){validFlag=processRow(parseInt(row,10)+1,rowSelections[row]>0)&&validFlag;}}else{for(row in this.dirtyRows){validFlag=processRow(row,true)&&validFlag;}}return validFlag;}return true;},editNext:function editNext(k){if(this.recalculating){return false;}var ics=this.interactiveCellsArray,len=ics.length,i=k+1,nextCell,dicWidget;do{if(i>=len){i%=len;}if(i===k){return false;}nextCell=ics[i];var group=this.dicGroupMap[getGroupIdx(nextCell)];if(group&&!group.dic.disabled&&inputControlEnabled(nextCell)){if(mstrmojo.DICConfig.isKeyNavigable(group.dic)){if(!group.showByDefault){group.showPopupDIC(i);}else{dicWidget=group.widgetsMap[i];dicWidget.focus();}return true;}}i++;}while(true);}});}());