(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.Refine.RefineImportDialog","mstrmojo.Refine.RefineExtractDialog","mstrmojo.List");mstrmojo.requiresDescs(12350,12351,3482,3473,8118,246);var $CSS=mstrmojo.css;var diConstants=mstrmojo.DI.DIConstants;mstrmojo.Refine.RefineHistoryList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineHistoryList",markupString:'<div id="{@id}" class="refine-history-list-box"><div class="refine-history-header"></div><div class="refine-history-box"><div class="refine-history-inner-box"></div></div></div>',markupSlots:{headerNode:function(){return this.domNode.children[0];},historyNode:function(){return this.domNode.children[1];},sequenceNode:function(){return this.domNode.children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onundoIDChange:function(){if(this.undoID===-1){this.undo.set("enabled",false);}else{this.undo.set("enabled",true);}},onredoIDChange:function(){if(this.redoID===-1){this.redo.set("enabled",false);}else{this.redo.set("enabled",true);}}},undoID:-1,redoID:-1,setDimensions:function setDimensions(h,w){var height=parseInt(h,10);var width=parseInt(w,10);if(isNaN(height)||isNaN(width)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var headerNodeHeight=44;var contentWidth=width-Math.max(Math.floor(width*0.65),618)-1;this.layoutConfig.h.headerNode=(headerNodeHeight-16)+"px";this.layoutConfig.w.headerNode=(contentWidth-9)+"px";this.layoutConfig.h.sequenceNode=(height-headerNodeHeight-14-3)+"px";this.layoutConfig.w.sequenceNode=(contentWidth-14)+"px";if(this._super){this._super(height+"px",contentWidth+"px");}},children:[{scriptClass:"mstrmojo.Label",cssClass:"refine-history-label",cssDisplay:"inline-block",text:mstrmojo.desc(12350,"History Script"),slot:"headerNode"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12351,"Reset to Initial Data"),cssClass:"refine-history-reset",slot:"headerNode",alias:"reset",enable:false,onclick:function(){var controller,facetPanel;if(this.enable){controller=this.parent.controller;if(controller.refinePanel&&controller.refinePanel.bottomPanal&&controller.refinePanel.bottomPanal.splitter){facetPanel=controller.refinePanel.bottomPanal.splitter.facetPanel;facetPanel.resetAllFacets();}controller.applyOperations({lastDoneID:0},true);}},onenableChange:function(){$CSS.toggleClass(this.domNode,"enable",this.enable);}},{slot:"headerNode",alias:"undo",cssClass:"refine-history-undo",scriptClass:"mstrmojo.Button",title:mstrmojo.desc(3482,"Undo"),onclick:function(){this.parent.controller.applyOperations({lastDoneID:this.parent.undoID},true);},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){$CSS.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){$CSS.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}}},{slot:"headerNode",alias:"redo",cssClass:"refine-history-redo",scriptClass:"mstrmojo.Button",title:mstrmojo.desc(3473,"Redo"),onclick:function(){this.parent.controller.applyOperations({lastDoneID:this.parent.redoID},true);},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){$CSS.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){$CSS.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(8118,"Import"),slot:"headerNode",cssClass:"refine-history-import",alias:"import",onclick:function(){var controller=mstrApp.getRootController();controller.showDialog(diConstants.dialogType.refineImportDialog,{controller:this.parent.controller});},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){$CSS.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){$CSS.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(246,"Export"),slot:"headerNode",cssClass:"refine-history-export",alias:"export",onclick:function(){var controller=mstrApp.getRootController();controller.showDialog(diConstants.dialogType.refineExtractDialog,{controller:this.parent.controller});},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){$CSS.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){$CSS.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}}},{scriptClass:"mstrmojo.List",cssClass:"refine-history-list",slot:"sequenceNode",itemMarkup:'<div class="list-item {@cssClass}" title="{@description}">{@description}</div>',alias:"sequence",populateChange:false,populate:function populate(list){if(list.past&&list.future){var i,j,op;for(i=0;i<list.past.length;i++){op=list.past[i];op.description=i+") "+mstrmojo.string.encodeHtmlString(op.description,null,true);op.cssClass="past";}for(j=0;j<list.future.length;j++){op=list.future[j];op.description=(i+j)+") "+mstrmojo.string.encodeHtmlString(op.description,null,true);op.cssClass="future";}this.set("items",list.past.concat(list.future));if(this.selectedIndex!==list.past.length-1){this.populateChange=true;}this.set("selectedIndex",list.past.length-1);this.render();if(list.past.length===0){this.parent.set("undoID",-1);}else{if(list.past.length===1){this.parent.set("undoID",0);}else{this.parent.set("undoID",list.past[this.selectedIndex-1].id);}}if(list.future.length===0){this.parent.set("redoID",-1);}else{this.parent.set("redoID",list.future[0].id);}}},onchange:function(event){if(this.populateChange===true){this.populateChange=false;}else{this.parent.controller.applyOperations({lastDoneID:event.src.selectedItem.id},true);}},multiSelect:false}],populate:function populate(list){this.sequence.populate(list);if(list&&list.past&&list.past.length>0){this.reset.set("enable",true);}else{this.reset.set("enable",false);}},handleListChanged:function handleListChanged(event){this.populate(event.value);}});}());