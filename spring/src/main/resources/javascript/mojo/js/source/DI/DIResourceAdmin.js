(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.DI.DISourceItemAdmin");mstrmojo.requiresDescs(14456,14459);var $A=mstrmojo.array,$H=mstrmojo.hash;mstrmojo.DI.DIResourceAdmin=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIResourceAdmin",selectedSource:null,topLabel:mstrmojo.desc(14459,"Commonly used"),bottomLabel:mstrmojo.desc(14456,"Not commonly used"),markupString:'<div id="{@id}" class="mstrmojo-DI-DIResourceAdmin {@cssClass}" style="{@cssText}"><div class="mstrmojo-DI-DIResourceAdmin-Label top">{@topLabel}</div><div class="mstrmojo-DI-DIResourceAdmin-Content top cf"></div><div class="mstrmojo-DI-DIResourceAdmin-Label bottom">{@bottomLabel}</div><div class="mstrmojo-DI-DIResourceAdmin-Content bottom cf"></div></div>',markupSlots:{topContainerNode:function(){return this.domNode.children[1];},bottomContainerNode:function(){return this.domNode.children[3];}},children:[{scriptClass:"mstrmojo.Box",alias:"topBox",slot:"topContainerNode",cssClass:"mstrmojo-DI-DIResourceAdmin-Box top"},{scriptClass:"mstrmojo.Box",alias:"bottomBox",slot:"bottomContainerNode",cssClass:"mstrmojo-DI-DIResourceAdmin-Box bottom"}],preBuildRendering:function(){if(this._super){this._super();}this.populateResources();},populateResources:function(){var me=this,controller=mstrApp.getRootController(),model=controller.getModel(),sources=[],selectedSource=[];var onSelectChangeFn=function(evt){me.onItemSelectChange(evt);};$A.forEach(model.sourceItems,function(item){var adminItem=$H.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:item.selected!==false?"":"add",onselectChange:onSelectChangeFn},$H.clone(item));if(adminItem.selected!==false){selectedSource.push($H.copy({mode:"remove"},adminItem));}else{sources.push(adminItem);}});this.selectedSource=selectedSource||[];this.topBox.addChildren(mstrApp.isSingleTier?controller.filterSourcesForOneTier(selectedSource):controller.filterSourcesByPrivileges(selectedSource));this.bottomBox.addChildren(mstrApp.isSingleTier?controller.filterSourcesForOneTier(sources):controller.filterSourcesByPrivileges(sources));},onItemSelectChange:function(evt){switch(evt.type){case"add":this.addItem(evt);break;case"remove":this.removeItem(evt);break;}},addItem:function(evt){var me=this,model=mstrApp.getRootController().getModel(),src=evt.src,sources=model.sourceItems,sid,source,idx,item;var onSelectChangeFn=function(evt){me.onItemSelectChange(evt);};this.bottomBox.removeChildren(src);src.destroy();sid=src.sid;idx=$A.find(sources,"sid",sid);source=sources[idx];item=$H.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:"remove",onselectChange:onSelectChangeFn},$H.clone(source));this.selectedSource.push(item);this.topBox.addChildren([item]);},removeItem:function(evt){var me=this,src=evt.src,model=mstrApp.getRootController().getModel(),sources=model.sourceItems,idx,i,item,adminItem;var onSelectChangeFn=function(evt){me.onItemSelectChange(evt);};idx=$A.find(this.topBox.children,"sid",src.sid);if(idx<0){return ;}item=this.topBox.children[idx];this.topBox.removeChildren(item);idx=$A.find(this.bottomBox.children,"sid",src.sid);if(idx>=0){item=this.bottomBox.children[idx];item.set("mode","add");}else{i=$A.find(sources,"sid",src.sid);if(i>=0){adminItem=$H.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:"add",onselectChange:onSelectChangeFn},$H.clone(sources[i]));this.bottomBox.addChildren([adminItem]);}}idx=$A.find(this.selectedSource,"sid",src.sid);if(idx>=0){$A.removeIndices(this.selectedSource,idx,1);}},getAdminConfig:function(){var me=this,model=mstrApp.getRootController().getModel(),selected=me.selectedSource,unselected=null;if(this.hasRendered){unselected=[];$A.forEach(model.sourceItems,function(source){var sid=source.sid;if($A.find(selected,"sid",sid)<0){unselected.push(sid);}});}return unselected;}});}());