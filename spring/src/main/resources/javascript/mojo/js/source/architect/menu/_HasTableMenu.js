(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.architect.EnumBaseFormTypes","mstrmojo.architect.EnumColumnDataTypes","mstrmojo.architect.ui.editors.ColumnDefinitionEditor","mstrmojo.architect.ui.editors.DataSourceEditor","mstrmojo.architect.ui.editors.LogicalSizeEditor","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus.MenuConfig");var $A=mstrmojo.array,$H=mstrmojo.hash,$ENUM_MENU_ACTIONS=mstrmojo.architect.menu.EnumMenuActions,ENUM_ACTION_UPDATE_FORMAT=$ENUM_MENU_ACTIONS.UPDATE_FORMAT,ENUM_ACTION_UPDATE_AGGR=$ENUM_MENU_ACTIONS.UPDATE_AGGR,ENUM_ACTION_UPDATE_CATEGORY=$ENUM_MENU_ACTIONS.UPDATE_CATEGORY,ENUM_ACTION_UPDATE_GROUP=$ENUM_MENU_ACTIONS.UPDATE_GROUP,ENUM_ACTION_NONE=$ENUM_MENU_ACTIONS.NONE,STR_ADD_TO_LAYER=mstrmojo.desc(11416,"Add to Layer"),STR_REMOVE_FROM_LAYER=mstrmojo.desc(11401,"Remove from Layer"),STR_UNUSED_COLS=mstrmojo.desc(11403,"Show Unused Columns"),STR_AUTO_MAP=mstrmojo.desc(11402,"Auto Map"),STR_NEW_ATTRIBUTE=mstrmojo.desc(11404,"New Attribute"),STR_NEW_FACT=mstrmojo.desc(11405,"New Fact"),STR_EDIT=mstrmojo.desc(1088,"Edit"),STR_DELETE=mstrmojo.desc(629,"Delete"),STR_RENAME=mstrmojo.desc(1388,"Rename"),STR_LOGICAL_SIZE=mstrmojo.desc(12224,"Logical size"),STR_REMOVE_FROM_TABLE=mstrmojo.desc(11406,"Remove from Table"),STR_SET_AS_LOOKUP=mstrmojo.desc(11407,"Set as LookUp"),STR_SET_AS_FORM=mstrmojo.desc(11408,"Set as Form"),STR_QUICK_METRICS=mstrmojo.desc(11409,"Add Quick Metrics"),STR_FORM_TYPE=mstrmojo.desc(11410,"Form Type"),STR_SAMPLE_DATA=mstrmojo.desc(11411,"Sample Data"),STR_TO_ATTRIBUTE=mstrmojo.desc(11412,"To Attribute"),STR_TO_FACT=mstrmojo.desc(11413,"To Fact"),STR_ADD_AS_ATTRIBUTE=mstrmojo.desc(11414,"Add as Attribute"),STR_ADD_AS_FACT=mstrmojo.desc(11415,"Add as Fact"),STR_LINKS=mstrmojo.desc(5752,"Links"),STR_CATEGORY=mstrmojo.desc(7940,"category"),STR_UPDATE_STRUCT=mstrmojo.desc(11417,"Update Structure"),STR_CREATE_ALIAS=mstrmojo.desc(11418,"Create Alias"),STR_SET_AS_MULTILINGUAL=mstrmojo.desc(12220,"Set as Multilingual"),STR_DATA_SOURCES=mstrmojo.desc(4381,"Data Sources"),STR_UNGROUP_FORMS=mstrmojo.desc(12221,"Ungroup forms"),STR_UNGROUP_FORM=mstrmojo.desc(12222,"Remove from group"),STR_GROUP_FORMS=mstrmojo.desc(12223,"Add to group"),MENU_CONTEXT_TREE=1,MENU_CONTEXT_LAYER=2;mstrmojo.architect.menu._HasTableMenu=mstrmojo.provide("mstrmojo.architect.menu._HasTableMenu",{_mixinName:"mstrmojo.architect.menu._HasTableMenu",cm:[{action:$ENUM_MENU_ACTIONS.ADD_TO_LAYER,n:STR_ADD_TO_LAYER,icn:"atl",context:MENU_CONTEXT_TREE},{action:$ENUM_MENU_ACTIONS.REMOVE_FROM_LAYER,n:STR_REMOVE_FROM_LAYER},{action:$ENUM_MENU_ACTIONS.AUTOMAP,n:STR_AUTO_MAP,icn:"amp"},{action:$ENUM_MENU_ACTIONS.SHOW_UNUSED_COLUMNS,n:STR_UNUSED_COLS,view:2,context:MENU_CONTEXT_LAYER},{action:$ENUM_MENU_ACTIONS.NEW_ATTR,n:STR_NEW_ATTRIBUTE},{action:$ENUM_MENU_ACTIONS.NEW_FACT,n:STR_NEW_FACT},{action:ENUM_ACTION_NONE},{action:$ENUM_MENU_ACTIONS.EDIT,n:STR_EDIT,icn:"edt"},{action:$ENUM_MENU_ACTIONS.DELETE,n:STR_DELETE,icn:"del"},{action:$ENUM_MENU_ACTIONS.RENAME,n:STR_RENAME,fn:"renameObject",icn:"rnm"},{action:$ENUM_MENU_ACTIONS.LOGICAL_TABLE_SIZE,n:STR_LOGICAL_SIZE,hasEdt:true,buildSubMenuConfig:function buildSubMenuConfig(){return this.buildLogicalSizeEditor(this.data);},icn:"lock"},{action:$ENUM_MENU_ACTIONS.UPSTRUCT,n:STR_UPDATE_STRUCT},{action:$ENUM_MENU_ACTIONS.ADD_ATTRIBUTE,n:STR_ADD_AS_ATTRIBUTE},{action:$ENUM_MENU_ACTIONS.ADD_FACT,n:STR_ADD_AS_FACT},{action:$ENUM_MENU_ACTIONS.REMOVE_FROM_TABLE,n:STR_REMOVE_FROM_TABLE},{action:ENUM_ACTION_NONE},{action:$ENUM_MENU_ACTIONS.SET_AS_LOOKUP,n:STR_SET_AS_LOOKUP},{action:$ENUM_MENU_ACTIONS.SET_AS_MULTILINGUAL,n:STR_SET_AS_MULTILINGUAL},{action:$ENUM_MENU_ACTIONS.CONVERT_ATTR_TO_FORM,n:STR_SET_AS_FORM,items:[],buildSubMenuConfig:function buildSubMenuConfig(){return this.buildSetAsFormSubMenu(mstrApp.getRootController().getSameTableAttributes(this.data));}},{action:$ENUM_MENU_ACTIONS.CONVERT_COLUMN_TO_FORM,n:STR_SET_AS_FORM,items:[],buildSubMenuConfig:function buildSubMenuConfig(){return this.buildSetColumnAsFormSubMenu(mstrApp.getRootController().getSameTableAttributes(this.data));}},{action:$ENUM_MENU_ACTIONS.AGGREGATION,n:STR_QUICK_METRICS,hasEdt:true,buildSubMenuConfig:function buildSubMenuConfig(){return this.buildQuickMetricsMenuEditor();}},{action:$ENUM_MENU_ACTIONS.COLUMN_DEF,n:STR_EDIT,hasEdt:true,buildSubMenuConfig:function buildSubMenuConfig(){return this.buildColumnDefEditor(mstrApp.getRootController().getColumns()[this.data.did],this.data.pdid);}},{action:$ENUM_MENU_ACTIONS.DATA_TYPE,n:STR_FORM_TYPE,items:[],buildSubMenuConfig:function buildSubMenuConfig(){return this.buildFormTypeSubMenu();}},{action:$ENUM_MENU_ACTIONS.CREATE_ALIAS,n:STR_CREATE_ALIAS},{action:ENUM_ACTION_NONE},{action:$ENUM_MENU_ACTIONS.SAMPLE_DATA,n:STR_SAMPLE_DATA,icn:"smpl"},{action:ENUM_ACTION_NONE},{action:$ENUM_MENU_ACTIONS.FORM_CATEGORY,n:STR_CATEGORY,items:[],buildSubMenuConfig:function buildSubMenuConfig(){return this.buildFormCatSubMenu(mstrApp.rootController.model.basicForms);}},{action:$ENUM_MENU_ACTIONS.DATA_SOURCES,n:STR_DATA_SOURCES},{action:$ENUM_MENU_ACTIONS.CONVERT_FACT_TO_ATTR,n:STR_TO_ATTRIBUTE},{action:$ENUM_MENU_ACTIONS.CONVERT_ATTR_TO_FACT,n:STR_TO_FACT},{action:$ENUM_MENU_ACTIONS.LINKS,n:STR_LINKS},{action:ENUM_ACTION_NONE},{action:$ENUM_MENU_ACTIONS.UNGROUP_FORMS,n:STR_UNGROUP_FORMS},{action:$ENUM_MENU_ACTIONS.UNGROUP_FORM,n:STR_UNGROUP_FORM},{action:$ENUM_MENU_ACTIONS.GROUP_FORM,n:STR_GROUP_FORMS,items:[],buildSubMenuConfig:function buildSubMenuConfig(){return this.buildFormGroupsSubMenu(mstrApp.getRootController().getAttribute(this.data.sid),this.data,mstrApp.rootController.getFormCategories());}}],buildQuickMetricsMenuEditor:function buildQuickMetricsMenuEditor(){var menu=this,editorItems=[],selectedIndices={};$A.forEach(["Sum","Count","Max","Min","Variance","Average"],function(item,index){var menuItem={n:item,did:item,action:ENUM_ACTION_UPDATE_AGGR};editorItems.push(menuItem);if(menu.queryChecked(menuItem)){selectedIndices[index]=true;}});return new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.architect.ui.SimpleList({cssClass:"mstrmojo-ar-qmlist",multiSelect:true,selectionPolicty:"reselect",items:editorItems,selectedIndices:selectedIndices}),fnOk:function fnOk(){var submissionItem={action:ENUM_ACTION_UPDATE_AGGR,aggr:{sum:false,count:false,max:false,min:false,variance:false,average:false}},map={Sum:"sum",Count:"count",Max:"max",Min:"min",Variance:"variance",Average:"average"};$A.forEach(this.contents.getSelectedItems(),function executeEditorOkFn(selectedItem){submissionItem.aggr[map[selectedItem.n]]=true;});menu.executeCommand(submissionItem);},data:{}});},buildColumnDefEditor:function buildColumnDefEditor(colData,tableId){var types=[];$H.forEach(mstrmojo.architect.EnumColumnDataTypes,function(dataType){types.push(dataType);});types.sort(function(a,b){return a.n.toUpperCase().localeCompare(b.n.toUpperCase());});return new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.architect.ui.editors.ColumnDefinitionEditor({colName:colData.cln,type:colData.dt.tp,precision:colData.dt.ps,scale:colData.dt.sc,items:types}),fnOk:function fnOk(){var info=this.contents.getEditorData();if(info.colName!==""){mstrApp.getRootController().updateColumn({cln:info.colName,cmid:colData.cmid,dt:{tp:info.type,ps:info.precision,sc:info.scale},tableId:tableId},colData,{});}},data:{}});},buildLogicalSizeEditor:function buildLogicalSizeEditor(data){var menu=this;return new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.architect.ui.editors.LogicalSizeEditor({isLocked:data.isLocked,logicalSize:data.size,submitData:function submitData(){this.parent.btnNode.children[1].onclick();}}),fnOk:function fnOk(){var info=this.contents.getEditorData();data.isLocked=info.locked;data.size=info.size;menu.executeCommand({did:data.id,n:data.name,action:$ENUM_MENU_ACTIONS.LOGICAL_TABLE_SIZE});},cssClass:"popUpMenuEditor",data:data});},buildSetAsFormSubMenu:function buildSetAsFormSubMenu(items){var menuHelper=this,newMenuItems=[],i;for(i=0;i<items.length;i++){var item=items[i];if(item.id!==menuHelper.data.did){newMenuItems.push({did:item.id,n:item.name,action:$ENUM_MENU_ACTIONS.CONVERT_ATTR_TO_FORM});}}return this.getMenuConfig(newMenuItems);},buildSetColumnAsFormSubMenu:function buildSetColumnAsFormSubMenu(items){var menuHelper=this,newMenuItems=[],i;for(i=0;i<items.length;i++){var item=items[i];if(item.id!==menuHelper.data.did){newMenuItems.push({did:item.id,n:item.name,action:$ENUM_MENU_ACTIONS.CONVERT_COLUMN_TO_FORM});}}return this.getMenuConfig(newMenuItems);},buildFormCatSubMenu:function buildFormCatSubMenu(categories){var newMenuItems=[];$H.forEach(categories,function(category){newMenuItems.push({did:category.id,n:category.useName,action:ENUM_ACTION_UPDATE_CATEGORY});});return this.getMenuConfig(newMenuItems);},buildFormGroupsSubMenu:function buildFormGroupsSubMenu(attribute,form,categories){var newMenuItems=[],cat;$A.forEach(attribute.formGroups,function(group){newMenuItems.push({catid:group.catID,n:group.formName,un:group.formName,ud:group.formName,action:ENUM_ACTION_UPDATE_GROUP});});$H.forEach(attribute.forms,function(attform){if(attform.categoryId!==form.fcatId){cat=categories[attform.categoryId];if(cat){newMenuItems.push({fcatId:cat.id,n:attform.useName,un:cat.useName,ud:cat.useDescription,action:ENUM_ACTION_UPDATE_GROUP});}}});return this.getMenuConfig(newMenuItems);},buildFormTypeSubMenu:function buildFormTypeSubMenu(){var $ENUM_BASE_FORM_TYPES=mstrmojo.architect.EnumBaseFormTypes;return this.getMenuConfig([{n:mstrmojo.desc(1013,"text"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.Text},{n:mstrmojo.desc(3434,"number"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.Number},{n:mstrmojo.desc(2052,"date"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.Date},{n:mstrmojo.desc(2170,"time"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.Time},{n:mstrmojo.desc(9919,"datetime"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.DateTime},{n:mstrmojo.desc(9922,"url"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.URL},{n:mstrmojo.desc(4699,"email"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.Email},{n:mstrmojo.desc(9921,"html tag"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.HTMLTag},{n:mstrmojo.desc(4530,"symbol"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.Symbol},{n:mstrmojo.desc(9920,"big decimal"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.BigDecimal},{n:mstrmojo.desc(8984,"phone number"),action:ENUM_ACTION_UPDATE_FORMAT,baseFormType:$ENUM_BASE_FORM_TYPES.PhoneNumber}]);}});}());