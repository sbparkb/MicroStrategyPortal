(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.string","mstrmojo.Widget","mstrmojo.condTx.CommonComponent");var OP_LIST=["-","+","*","/"],DEL_LIST=OP_LIST.concat(["(",")"]),DEL_MAP=null,$CC=mstrmojo.condTx.CommonComponent,_NT=$CC.NODE_TYPE,_AOP=$CC.ADV_OPERATION,$H=mstrmojo.hash,SUM_TOKEN=$H.copy(_AOP.SUM,{isDelimiter:true});function _isDelimiter(c){if(!DEL_MAP){DEL_MAP={};var i,len;for(i=0,len=DEL_LIST.length;i<len;i++){DEL_MAP[DEL_LIST[i]]=true;}}return DEL_MAP[c];}function _isMetricToken(c){return c&&c.t&&c.t===4;}function _convertTokens(it,isNotVec){var tokens=[];it.isMstrObj=true;if(_isMetricToken(it)){var d=$H.clone(it);d.v=d.dn||it.n;if(!isNotVec){d.v="("+d.v+")";tokens.push($H.clone(SUM_TOKEN));}tokens.push(d);}else{tokens.push($H.copy(it,{v:it.n}));}return tokens;}mstrmojo.condTx.ExpressionToken=mstrmojo.declare(mstrmojo.Widget,null,{data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}"></span>',active:false,markupMethods:{ondataChange:function(){var d=this.data;if(d.v===","){this.domNode.innerHTML=mstrmojo.string.encodeHtmlString(String(d.v))+"&nbsp;";}else{this.domNode.innerHTML=mstrmojo.string.encodeHtmlString(String(d.v));}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrObj());mstrmojo.css.toggleClass(this.domNode,["invalid"],d.sta===-1);if(d.tn){this.domNode.title=d.tn;}},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);}},isMstrObj:function isMstrObj(){return !!this.data.isMstrObj;},length:function length(){return this.data.v.length;},isDelimiter:function isDelimiter(){return this.data.isDelimiter||(this.length()===1&&_isDelimiter(this.data.v));},split2Tokens:function split2Tokens(offset){var d=this.data,s=d&&d.v,sb=s.substring(0,offset),sa=s.substring(offset);return[{v:sb},{v:sa}];},mergeTo:function mergeTo(w){var d=this.data,s=d&&d.v,ws=w.data.v;return{v:s+ws};},spliceContent:function spliceContent(offset,length,istChar){var d=this.data,s=d&&d.v,sb=s.substring(0,offset);length=(length===null||length===undefined)?(s.length-offset):length;var sa=s.substring(offset+length),ns=sb+(istChar||"")+sa;d.v=ns;d.sta=1;d.isMstrObj=false;d.isDelimiter=false;this.set("data",d);this.paint();},isMetricToken:function isMetricToken(){return _isMetricToken(this.data);},setToken:function setToken(it){var d=this.data,t=_convertTokens(it,true)[0];$H.copy(t,d);this.set("data",d);this.paint();}});mstrmojo.condTx.ExpressionToken.isDelimiter=_isDelimiter;mstrmojo.condTx.ExpressionToken.convertTokens=_convertTokens;}());