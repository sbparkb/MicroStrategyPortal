(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.string","mstrmojo.Obj","mstrmojo.Box","mstrmojo.Label","mstrmojo.Table","mstrmojo.VisEnum","mstrmojo.VisAxisLabel","mstrmojo.VisUtility","mstrmojo.PageNavigationPanel","mstrmojo._CanSupportTransaction","mstrmojo._Formattable","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.vi.viz.EnumDSSDropZones");mstrmojo.requiresClsP("mstrmojo.gm","GMEnums","TrendLineModel","GMDataModel","VecDrawer","GMUtility","GMIdentities","GMAxisScale");mstrmojo.requiresClsP("mstrmojo.chart","DataSetImpl","ChartImpl","MsiChart");mstrmojo.requiresCls("mstrmojo.chart.common.Utility");var perfMaxScanRow=100,perfMaxScanCol=100;var $MOJO=mstrmojo,$VISUTIL=$MOJO.VisUtility,$CSS=$MOJO.css,$HASH=$MOJO.hash,$ARR=$MOJO.array,$STR=$MOJO.string,$C=$MOJO.chart,$M=$C.model,$MODEL_ENUMS=$M.enums,EnumDSSXMLObjectTypes=mstrmojo.mstr.EnumDSSXMLObjectTypes,EnumTrendLineModelType=mstrmojo.gm.EnumTrendLineModelType,$GM=$MOJO.gm,AS=$GM.GMAxisScale,$RLB=$GM.EnumTrendRefModelLabels,GMUTIL=$GM.GMUtility,$SEL_OPT_LVL=$GM.EnumSelectionOptionLevel,$NUM=$MOJO.num,ABL_DIRECTION=$GM.EnumABLDirection,MENU=$GM.EnumContextMenu,CONTROL_TYPE=$MOJO.VisEnum.ControlType,ENUM_DZID=$MOJO.vi.viz.EnumDSSDropZones,COLOR_BY_TYPE=$GM.EnumColorByType,DRAWING_API=$GM.EnumDrawingAPI,XLABEL_STAT=$GM.EnumXAxisLabelStatus,ABLDIR=$GM.EnumABLDirection,MK_SHAPE=$GM.EnumShape,$AXIS=$GM.EnumAxis,$GT=$MODEL_ENUMS.EnumDSSGraphType,FIT_TO=$GM.EnumFitTo,AXIS_TYPE=$GM.EnumAxisType,CHART_TYPE=$GM.EnumGraphType,SIZEBY_TYPE=$GM.EnumSizeByType,GM_AXIS=$GM.EnumAxis,THEME=$GM.EnumTheme,METRICS_POS=$GM.EnumMetricsPosition,CEUtility=$C.common.Utility,PRP_SHAPE=$GM.EnumShape,PRP_SUBTYPE=$GM.EnumSubtype,PRP_AXIS_SCALE=$GM.EnumAxisScale,PRP_MAX_SIZE_TYPE=$GM.EnumMaxSizeType,PRP_MIN_SIZE_TYPE=$GM.EnumMinSizeType,IDENTITY_TYPE=$GM.EnumIdentityType,ENUM_XML_TAG=$GM.WidgetPropertyTag,ENUM_FORMAT_TAG=$GM.FormatingPropertyTag,$REF_TYPE=$GM.EnumRefLineModelType,$STK_EX=$GM.StackExetrmeId,$SAB=$GM.DualAxisSubAxisBit,freezeChart=false,METRIC_NAMES_ID="00000000000000000000000000000000",METRIC_NAMES_UNIT_TYPE=0,TIME_STAMP="_tmsp",gradientCount=0,INVALID_METRIC_IDX=-20,TEXT_CHART_SPACE=0,LABEL_PADDING=5,MIN_BAR_WIDTH=5,MIN_LINE_WIDTH=2,sortAscending=0,sortDescending=1,sortNoSorting=3,ETP_SCALE=0,ETP_SIZEBY=16,ETP_COLORBY=32,X1_ON=1,Y1_ON=2,Y2_ON=4,X2_ON=8,refModelModelType=["MAX","MIN","AVG","MED","FIRST","LAST","CONST"],refModelDesc=[mstrmojo.desc(5417,"Max"),mstrmojo.desc(5416,"Min"),mstrmojo.desc(12151,"Avg"),mstrmojo.desc(12152,"Med"),mstrmojo.desc(4046,"First"),mstrmojo.desc(4049,"Last"),mstrmojo.desc(12153,"Const")],kZeroPadding={isZeroPadding:true,X1:{LowOffset:0,HighOffset:0},X2:{LowOffset:0,HighOffset:0},Y1:{LowOffset:0,HighOffset:0},Y2:{LowOffset:0,HighOffset:0}},AxisStyleProperty={x:{first:"top",second:"bottom"},y:{first:"right",second:"left"}},PALLETTE_DARK=[16756758,2701311,2275844,956159,14580142,2477516,14732825,11119017,15715763,9873407,9101208,8437759,15516634,9494752,15392673,14079702],PALLETTE_LIGHT=[11826975,1381846,1810715,950271,12407690,2276796,13614615,8355711,15255470,9869567,9101208,7912447,14004421,9296859,15063710,13092807];mstrmojo.requiresDescs(2058,2460,12091,12092);var stackTypes=[2,9,16,23,30,37];var pctTypes=[7,14,21,28,35,42];var filterInValidMetricIndex=GMUTIL.filterInValidMetricIndex,getOptionObjArr=GMUTIL.getOptionObjArr;function isEmptyObject(obj){var isEmpty=true,elem;for(elem in obj){if(obj.hasOwnProperty(elem)){isEmpty=false;break;}}return isEmpty;}function shouldDrawShape(dz,chartInfo){var shouldDraw=false,checkDzs=["XAxis","YAxis"],checkDzsLen=checkDzs.length,zone,i;for(i=0;i<checkDzsLen;i++){zone=dz&&dz[checkDzs[i]];if(zone){shouldDraw=!isEmptyObject(zone);if(shouldDraw){break;}}}return shouldDraw||chartInfo.isPie;}function resetController(){this.rwHdrSmrs=[];this.colHdrSmrs=[];delete this.mulAttsOnAxisForABL;delete this.ttlDispTp;delete this.chartInfo;delete this.defaultsForShape;delete this.rowHeaderCnt;delete this.colHeaderCnt;delete this.model;delete this.isPie;this.splitPlottingMetrics=undefined;this.metricInfos={};this.sharedPool={};this.metricSelectionInfo={};this.attributeSelectionInfo={};this.axisScaleCache=null;}function evaluateSpecialCases(modelJSON,ceChartType){var chtInfo=this.getChartInfo();if(!chtInfo.isABL){this.removeGroupInfo();}var sbsBar=(ceChartType===1||ceChartType===8)||(ceChartType===15||ceChartType===22)||(ceChartType===29||ceChartType===36)||(ceChartType===91||ceChartType===92);if(sbsBar){var valueMetrics;var dz=modelJSON.dz,xAxis=dz.XAxis,yAxis=dz.YAxis,breakBy=dz.BreakBy;if(chtInfo.dirc===$GM.EnumABLDirection.VERTICAL){valueMetrics=this.getMetricsOnYAxis();}else{valueMetrics=this.getMetricsOnXAxis();}if(valueMetrics.length>1){if(chtInfo.dirc===$GM.EnumABLDirection.VERTICAL){if((xAxis.MetricNames!==undefined&&(!xAxis.TemplateUnit||xAxis.TemplateUnit.length===0))||(breakBy.MetricNames!==undefined&&(!xAxis.TemplateUnit||xAxis.TemplateUnit.length===0))){this.clusteredBarSpecialCase=true;}}else{if((yAxis.MetricNames!==undefined&&(!yAxis.TemplateUnit||yAxis.TemplateUnit.length===0))||(breakBy.MetricNames!==undefined&&(!yAxis.TemplateUnit||yAxis.TemplateUnit.length===0))){this.clusteredBarSpecialCase=true;}}}}this.isGridPie=chtInfo.isGrid&&chtInfo.isPie;this.onlyMetricNamesOnAxisForGridPie=isOnlyMetricNamesOnAxisForGridPie.call(this);this.isMetricNamesOnXAxis=isMetricNamesInZone.call(this,"XAxis");this.isMetricNamesOnYAxis=isMetricNamesInZone.call(this,"YAxis");this.isMetricNamesOnRows=isMetricNamesInZone.call(this,"Rows");this.isMetricNamesOnColumns=isMetricNamesInZone.call(this,"Columns");if(chtInfo.isABL){if(getAttributesOnDropZone.call(this,"XAxis","n").length>1||getAttributesOnDropZone.call(this,"YAxis","n").length>1){this.mulAttsOnAxisForABL=true;}}}function evaluateChartTypes(modelJSON){var eGT=CHART_TYPE;var view=this.view,subType,ceChartType;var propShape=view.getWidgetPropertyValue(ENUM_XML_TAG.SHAPE);var propSubtype=view.getWidgetPropertyValue(ENUM_XML_TAG.SUB_TYPE);var chartType=this.getChartType();var bubbleShape=[PRP_SHAPE.CIRCLE,PRP_SHAPE.SQUARE,PRP_SHAPE.PIE,PRP_SHAPE.RING,PRP_SHAPE.TICK];var gridShape=bubbleShape.concat([PRP_SHAPE.BAR]);var checkCombFromJSON=function(modelJSON){var isComb=false,hasBar=false;if(chartType!==eGT.BAR&&chartType!==eGT.LINE&&chartType!==eGT.AREA){return{enableComb:false,hasBarShape:false};}var barShape=1,i,allMetrics=[],allShapes=[],allAxisResidences=[];var dz=modelJSON.dz,json=dz.XAxis.TemplateMetric&&dz.XAxis.TemplateMetric.concat()||[];json=json.concat(dz.YAxis.TemplateMetric&&dz.YAxis.TemplateMetric.concat()||[]);json.forEach(function(ele){allMetrics.push(ele.id);allAxisResidences.push(ele.ax);});var shapeJson=dz.visProp.fmt.metricShapes||"{}";json=JSON.parse(shapeJson.replace(/'/g,'"'));allMetrics.forEach(function(ele){if(json.hasOwnProperty(ele)){allShapes.push(json[ele]);}});hasBar=allShapes.length&&allShapes[0]===barShape;for(i=1;i<allShapes.length;i++){isComb=isComb||allShapes[i]!==allShapes[i-1];hasBar=hasBar||allShapes[i]===barShape;if(isComb&&hasBar){break;}}return{enableComb:isComb,hasBarShape:hasBar};};var combInfo=checkCombFromJSON(modelJSON);if(propSubtype!==undefined){subType=propSubtype;}if(((chartType===eGT.BUBBLE||chartType===eGT.SCATTER)&&bubbleShape.indexOf(propShape)===-1)||((chartType===eGT.GRID)&&(gridShape.indexOf(propShape)===-1))){propShape=PRP_SHAPE.CIRCLE;}var shapeValue=[4,24,201,202,200];var idx=bubbleShape.indexOf(propShape);if(idx>=0&&idx<bubbleShape.length){this.ceMarkerShape=shapeValue[idx];}var ceTypeAndShape=getCEChartTypeAndShape.call(this,chartType,subType,this.chartDirection,propShape,combInfo.enableComb,combInfo.hasBarShape);this.chartSubType=ceTypeAndShape.subType;ceChartType=ceTypeAndShape.ceChartType;this.ceChartType=ceChartType;this.markerShape=ceTypeAndShape.shape;this.isPercentage=isDigitInArray(ceChartType,pctTypes);this.isStacked=isDigitInArray(ceChartType,stackTypes.concat(pctTypes));}function evaluateHeaderSize(json){var rct=json.dm.rct;var cct=json.dm.cct;var rp=json.ptt.row;var cp=json.ptt.col;var me=this,dz=json.dz;if(rp.length===0){rp.push(0);}if(cp.length===0){cp.push(0);}if(rct<0){rct=json.dm.rct=json.gvs.items.length;}if(cct<0){cct=json.dm.cct=json.gvs.items[0].items.length;}me.rowHeaderCnt=getGMHeaderCount(dz.Rows);me.colHeaderCnt=getGMHeaderCount(dz.Columns);}function hgetAxisLayoutPerChartType(i,j){if(this.isBubbleOrScatter()){return this.getAxisLayout4CE(i,j);}else{return this.axisLayout;}}function getTextFromHTMLTag(htmlTag){var div=document.createElement("div");div.innerHTML=htmlTag;return div.innerText;}function restoreEsForUnit(unit){var es=unit.es,fs=unit.fs,type=unit.otp,len=fs&&fs.length;if(es){$ARR.forEach(es,function(el){el.n=GMUTIL.restoreSpecialChars(el.n);el.n=$STR.decodeHtmlString(el.n);el.n=el.n.trim();});}if(type===12&&len){for(var i=0;i<es.length;i++){switch(fs[i%len].bftp){case 5:break;case 7:es[i].n=getTextFromHTMLTag(es[i].n);break;default:}}}}function getDP(r,c){var dm=this.model,iLdsIdx,lds,dps,dp;iLdsIdx=this.mapFromChartToLDSIndex(r,c);lds=dm.getLocalDataSet(iLdsIdx.r,iLdsIdx.c);dps=lds.generateDataProvider();dp=dps[iLdsIdx.dpIdx];return dp;}function pickLayoutPaddings(isX,isPrimary){this.layoutPaddingEchos=this.layoutPaddingEchos||{X1:[],X2:[],Y1:[],Y2:[]};var key=isX?"X2":"Y2";if(isPrimary){key=isX?"X1":"Y1";}return this.layoutPaddingEchos[key];}function pickCondenseEchos(isX,isPrimary){this.condenseEchos=this.condenseEchos||{X1:[],X2:[],Y1:[],Y2:[]};var key=isX?"X2":"Y2";if(isPrimary){key=isX?"X1":"Y1";}return this.condenseEchos[key];}function canReuseFormatManager(){return true;}function canUseGlobalZeroDataAreaPadding(chtInfo){if(this.enableCombiChart){return false;}var shape=chtInfo.shape;if(shape===MK_SHAPE.BAR||chtInfo.tp===CHART_TYPE.GRID){return true;}if(shape===MK_SHAPE.TICK){var chartInfo=this.getChartInfo();return chartInfo.isABL;}return false;}function canUseZeroDataAreaPadding(chtInfo,r,c){var dp,shape=chtInfo.shape;if(this.enableCombiChart){dp=getDP.call(this,r,c);var allShapes=dp.getSeriesByShape();if(allShapes.Circle.length||allShapes.Square.length){return false;}if(allShapes.Line.length&&this.hasSizeBy()){return false;}var discreteSeries=dp.GetDiscreteSeries();if(discreteSeries.length){if(allShapes.Line.length){if(CEUtility.HasArrayIntersection(discreteSeries,allShapes.Line)){return false;}}if(allShapes.Area.length){if(CEUtility.HasArrayIntersection(discreteSeries,allShapes.Area)){return false;}}}return true;}if(canUseGlobalZeroDataAreaPadding.call(this,chtInfo)){return true;}if(shape===MK_SHAPE.AREA){dp=getDP.call(this,r,c);return dp.getGroupCount()>=2&&dp.GetDiscreteSeries().length===0;}if(shape===MK_SHAPE.LINE){dp=getDP.call(this,r,c);return !this.hasSizeBy()&&dp.getGroupCount()>=2&&dp.GetDiscreteSeries().length===0;}return false;}function fillTrendLineConfig(trConfigPool,lnM,metricId,modix){var defaultsObj=this.view.getDefaultProperties(),trendLineProp=trConfigPool[metricId]||{},chtInfo=this.getChartInfo(),fmt=(lnM.fmt||lnM.fms),tmp;if(fmt.length===0){fmt={};}else{if(typeof fmt==="string"){fmt=JSON.parse(GMUTIL.restoreSpecialChars(fmt));}}trendLineProp.modix=modix;trendLineProp[ENUM_XML_TAG.TREND_TYPE]=lnM.tp;trendLineProp[ENUM_XML_TAG.TREND_LEVEL]=lnM.lv;trendLineProp[ENUM_XML_TAG.TREND_ENABLED]=lnM.enabl===1;trendLineProp.fmt=fmt;[ENUM_XML_TAG.TREND_REF_LINE_THICKNESS,ENUM_XML_TAG.TREND_REF_LINE_COLOR,ENUM_XML_TAG.TREND_REF_LINE_STYLE].forEach(function(pn){tmp=fmt[pn];if(tmp===undefined){trendLineProp[pn]=defaultsObj[pn];}else{trendLineProp[pn]=tmp;}});if(chtInfo.isABL){trendLineProp[ENUM_XML_TAG.TREND_INCLUDE_BREAK_BY]=(lnM.incl===1);}if(lnM.cst.vv!==""&&!isNaN(lnM.cst.vv)){trendLineProp[ENUM_XML_TAG.TREND_POLY_DEGREE]=parseFloat(lnM.cst.vv);}trendLineProp.existing=true;lnM.clientDef=trendLineProp;trConfigPool[metricId]=trendLineProp;}function configRFLineLabelFormat(fmt,defaultsObj,refLineProp){var tmp,globalVal,widget=this.view;[ENUM_FORMAT_TAG.REF_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.REF_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.REF_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.REF_LABELS_FONT_COLOR].forEach(function(pn){globalVal=widget.getWidgetPropertyValue(pn);tmp=fmt[pn];if((typeof globalVal==="object")&&(tmp===undefined||typeof tmp!=="object"||(globalVal[pn+TIME_STAMP]>tmp[pn+TIME_STAMP]))){refLineProp[pn]=globalVal[pn];fmt[pn]=globalVal;}else{if(tmp===undefined){refLineProp[pn]=defaultsObj[pn];}else{if(typeof tmp!=="object"){refLineProp[pn]=tmp;}else{refLineProp[pn]=tmp[pn];}}}});}function fillRefLineConfig(refConfigPool,lnM,metricIdOrAxis,modix){var chtInfo=this.getChartInfo();if(chtInfo.isBubbleOrScatter){if(lnM.tp===$REF_TYPE.FIRST||lnM.tp===$REF_TYPE.LAST){return ;}}var defaultsObj=this.view.getDefaultProperties(),refLinePropsOfMetric=refConfigPool[metricIdOrAxis]||{},refLineProp={},fmt=(lnM.fmt||lnM.fms),tmp;refLineProp.modix=modix;refLineProp[ENUM_XML_TAG.REF_TYPE]=lnM.tp;refLineProp[ENUM_XML_TAG.REF_LEVEL]=lnM.lv;if(fmt.length===0){fmt={};}else{if(typeof fmt==="string"){fmt=JSON.parse(GMUTIL.restoreSpecialChars(fmt));}}refLineProp.fmt=fmt;[ENUM_XML_TAG.TREND_REF_LINE_THICKNESS,ENUM_XML_TAG.TREND_REF_LINE_COLOR,ENUM_XML_TAG.TREND_REF_LINE_STYLE].forEach(function(pn){tmp=fmt[pn];if(tmp===undefined){refLineProp[pn]=defaultsObj[pn];}else{refLineProp[pn]=tmp;}});configRFLineLabelFormat.call(this,fmt,defaultsObj,refLineProp);refLineProp[ENUM_XML_TAG.REF_ENABLED]=lnM.enabl===1;refLineProp[ENUM_XML_TAG.REF_SHOW_LABEL]=(lnM.la!==$RLB.DssModelLabelsNone&&lnM.la!==$RLB.DssModelLabelsReserved);refLineProp[ENUM_XML_TAG.REF_LABEL_TYPE]=lnM.la;refLineProp[ENUM_XML_TAG.REF_CONST_VALUE]=lnM.cst.vv;if(lnM.tp===$REF_TYPE.CONST){refLineProp[ENUM_XML_TAG.REF_LINE_NAME]=lnM.lin;}refLineProp.existing=true;if(refLinePropsOfMetric[lnM.tp]===undefined){refLinePropsOfMetric[lnM.tp]=[];}refLinePropsOfMetric[lnM.tp].push(refLineProp);lnM.clientDef=refLineProp;refConfigPool[metricIdOrAxis]=refLinePropsOfMetric;}function isRegionIdentical(lhs,rhs){if(!lhs&&!rhs){return true;}if(lhs&&rhs){return(lhs.x===rhs.x&&lhs.y===rhs.y&&lhs.width===rhs.width&&lhs.height===rhs.height&&lhs.flag===rhs.flag);}return false;}function reorderSortArray(sortActions){var res=[],realSort=[],len=sortActions.length,i,act;for(i=0;i<len;i++){act=sortActions[i];if(act.actionId===27){res.push(act);}else{realSort.push(act);}}res=res.concat(realSort.reverse());return res;}function checkMetricSortDefinition(selectionInfo){var cellIndex=selectionInfo.cellHandle,mid=selectionInfo.mid,sortInfo=this.getMetricSortInfo(),chartInfo=this.getChartInfo();if(cellIndex&&sortInfo.metricId===mid){var xtabModel=this.xtabModel,result=this.getRowHeadersByCell(cellIndex),headers=result.headers,elements=sortInfo.elements||[],len=elements.length,i;if(len===headers.length){for(i=0;i<len;i++){if(chartInfo.isABL&&this.isStacked){var fakeTotalHeader=headers[i].id,fakeTotalElement=elements[i],headAttrId,elemAttrId,splitter=fakeTotalHeader[2];if(splitter!==":"){splitter=";";}headAttrId=fakeTotalHeader.split(splitter)[1];elemAttrId=fakeTotalElement.split(splitter)[1];if(this.isAttrInZone(headAttrId,"ColorBy")||this.isAttrInZone(elemAttrId,"BreakBy")){if(headAttrId!==elemAttrId){return false;}}else{if(xtabModel.getNormalizedFormElementId(elements[i])!==xtabModel.getNormalizedFormElementId(headers[i].id)){return false;}}}else{if(xtabModel.getNormalizedFormElementId(elements[i])!==xtabModel.getNormalizedFormElementId(headers[i].id)){return false;}}}this.updateSortIndex(cellIndex);this.showMetricSortIcon=true;return true;}}return false;}function generateAOXML(sortIndex,sortType,objType,objID,ascending,axisIndex,subtotalsPosition,elements,attributeFormID){return{sortIndex:sortIndex,sortType:sortType,objType:objType,objID:objID,ascending:ascending,axisIndex:axisIndex,subtotalsPosition:subtotalsPosition,eIds:elements,formId:attributeFormID,actionId:26};}function getColumnTitleCell(i){return(this.getColTitleInfo(true).items)[i];}function getRowTitleCell(i){return(this.getRowTitleInfo(true).items)[i];}function getExistedSortingType(ax,handler){var modelData=this.firstRes,gsi=modelData.gsi,unitId=handler.id,UNIT_TYPE=0,UNIT_ID=1,FORM_ID=2,i,sortsOnAxis=gsi.sorts[ax-1],aSort,keys,sortUnitType,sortUnitId,sortFormId;for(i=0;i<sortsOnAxis.length;i++){aSort=sortsOnAxis[i];keys=aSort.key.split("!");sortUnitType=keys[UNIT_TYPE];sortUnitId=keys[UNIT_ID];sortFormId=keys[FORM_ID];if(sortUnitId===unitId){if(aSort.isAsc===true){return sortAscending;}return sortDescending;}}return sortNoSorting;}function checkMutipleBubble(yAxisMetrics){var chartType=this.chartType,metricsByType=this.metricsType,szBy=this.dz.SizeBy.TemplateMetric,szByLength=(szBy&&szBy.length)||0;if(yAxisMetrics===undefined){yAxisMetrics=this.getMetricsOnYAxis();}return((chartType===CHART_TYPE.BUBBLE)||(chartType===CHART_TYPE.SCATTER))&&(yAxisMetrics.length>1&&szByLength>1)&&(metricsByType===METRICS_POS.MetricsByColumn||metricsByType===METRICS_POS.MetricsByRow);}function getSizeByMetricsNum(){return this.getSizeByMetrics().length;}function splitMetricsForDualAxis(metrics,isPrimary,includeInvalidMetrics){if(this.fakeGroupInfo===false){if(isPrimary===false){return[];}return metrics;}var len=metrics.length,i,upBound=Math.ceil(len/2),res=[];for(i=0;i<len;i++){if(isPrimary){if(i%2===0){res.push(metrics[i]);}}else{if(i%2===1){res.push(metrics[i]);}}}if(includeInvalidMetrics&&res.length<upBound){res.push(INVALID_METRIC_IDX);}return res;}function getMetricNamesFromIndex(metricsIndexesArr,allNameArr){var res=[];$ARR.forEach(metricsIndexesArr,function(idx){res.push(allNameArr[idx]);});return res;}function formatMetricValue(value,metricIndex){var gmm=this.model,mask=gmm.getMetricNumberFormat(metricIndex);return $NUM.formatByMask(mask,value);}function unitExistInTemplate(did,gts){var i,n,rowUnits=gts.row,colUnits=gts.col;for(i=0,n=rowUnits.length;i<n;i++){if(rowUnits[i].id===did){return true;}}for(i=0,n=colUnits.length;i<n;i++){if(colUnits[i].id===did){return true;}}return false;}function findDisabledUnits(modelData,xtabModel){var i,n,datasets=xtabModel.docModel.datasets,gts=modelData.gts,datasetId=modelData.datasetId,dataset=datasets[datasetId]||{},atts=dataset.att||[],rtn=[];if(atts){for(i=0,n=atts.length;i<n;i++){if(!unitExistInTemplate(atts[i].did,gts)){rtn.push(atts[i]);}}}return rtn;}function getUnitInDataSet(xtabModel,unitId){var fnFilter=function fnFilter(unit){return unit.did===unitId;},docModel=xtabModel.docModel,atts=docModel.getDatasetUnits(["att"],fnFilter);if(atts&&atts[0]){return atts[0];}return undefined;}function calMaxOffset(os1,os2){var res={},mxLow,mxHigh;mxLow=Math.max(os1.LowOffset,os2.LowOffset);mxHigh=Math.max(os1.HighOffset,os2.HighOffset);res.LowOffset=mxLow;res.HighOffset=mxHigh;return res;}function getLargerPadding(pd1,pd2){if(pd1.isZeroPadding&&pd2.isZeroPadding){return pd1;}var res={};res.X1=calMaxOffset(pd1.X1,pd2.X1);res.X2=calMaxOffset(pd1.X2,pd2.X2);res.Y1=calMaxOffset(pd1.Y1,pd2.Y1);res.Y2=calMaxOffset(pd1.Y2,pd2.Y2);return res;}function assemblePadding(rowPadding,colPadding){var res={};res.Y1=rowPadding.Y1;res.Y2=rowPadding.Y2;res.X1=colPadding.X1;res.X2=colPadding.X2;return res;}function mergeCondense(r,c){var allEchos=this.condenseEchos,retVal={};if(allEchos===undefined){return{X1:false,X2:false,Y1:false,Y2:false};}retVal.X1=allEchos.X1[c]||false;retVal.X2=allEchos.X2[c]||false;retVal.Y1=allEchos.Y1[r]||false;retVal.Y2=allEchos.Y2[r]||false;return retVal;}function mergeValueAxisTrims(xTrim,yTrim,x2Trim,y2Trim){xTrim=xTrim||{PrimaryHighTrim:0,PrimaryLowTrim:0,SecondaryHighTrim:0,SecondaryLowTrim:0};yTrim=yTrim||{PrimaryHighTrim:0,PrimaryLowTrim:0,SecondaryHighTrim:0,SecondaryLowTrim:0};x2Trim=x2Trim||{PrimaryHighTrim:0,PrimaryLowTrim:0,SecondaryHighTrim:0,SecondaryLowTrim:0};y2Trim=y2Trim||{PrimaryHighTrim:0,PrimaryLowTrim:0,SecondaryHighTrim:0,SecondaryLowTrim:0};var res={};res.xPrimaryHighTrim=xTrim.PrimaryHighTrim||0;res.xPrimaryLowTrim=xTrim.PrimaryLowTrim||0;res.yPrimaryHighTrim=yTrim.PrimaryHighTrim||0;res.yPrimaryLowTrim=yTrim.PrimaryLowTrim||0;res.xSecondaryHighTrim=x2Trim.SecondaryHighTrim||0;res.xSecondaryLowTrim=x2Trim.SecondaryLowTrim||0;res.ySecondaryHighTrim=y2Trim.SecondaryHighTrim||0;res.ySecondaryLowTrim=y2Trim.SecondaryLowTrim||0;return res;}function mergeCategoryAxisTrims(xCaTrim,yCaTrim){xCaTrim=xCaTrim||{LowTrim:0,HighTrim:0};yCaTrim=yCaTrim||{LowTrim:0,HighTrim:0};return{xCaHighTrim:xCaTrim.HighTrim,yCaHighTrim:yCaTrim.HighTrim,xCaLowTrim:xCaTrim.LowTrim,yCaLowTrim:xCaTrim.LowTrim};}function mergeMargins(yMargin,xMargin){var res={},chtInfo=this.getChartInfo();res.TOP=yMargin.TOP;res.BOTTOM=yMargin.BOTTOM;res.LEFT=xMargin.LEFT;res.RIGHT=xMargin.RIGHT;var isOK=false,margin,isVericalChart=chtInfo.isABL&&chtInfo.dirc===ABL_DIRECTION.VERTICAL,isDualAxis=true;if(isDualAxis){if(isVericalChart){isOK=true;margin=yMargin;}else{isOK=true;margin=xMargin;}}return res;}function isDigitInArray(dig,arr){var len=arr.length,i;for(i=0;i<len;i++){if(dig===arr[i]){return true;}}return false;}function getMetricIndexFromID(oid,gts){var column=gts.col,colUnitCnt,lastObj,mcnt,i,es;if(column){colUnitCnt=column.length;lastObj=column[colUnitCnt-1];if(lastObj&&lastObj.otp===-1&&lastObj.es){es=lastObj.es;mcnt=es.length;for(i=0;i<mcnt;i++){if(es[i].oid===oid){return i;}}}}return INVALID_METRIC_IDX;}function getMetricsOnDropZone(zone){var gts,dz,metricInZone,i,mcnt,res=this.metricsOnDropZone[zone];if(!res){gts=this.gts;dz=this.dz[zone];metricInZone=dz.TemplateMetric;res=[];if(metricInZone&&metricInZone.length>0){mcnt=metricInZone.length;for(i=0;i<mcnt;i++){res.push(getMetricIndexFromID.call(this,metricInZone[i].id,gts));}}this.metricsOnDropZone[zone]=res;}return res;}function compareIndexOrderPair(a,b){if(a.index<b.index){return -1;}if(a.index>b.index){return 1;}return 0;}function getColorAttrsIndexOnGts(direction){var i,len,atts,colorByInfo,att,res=[];colorByInfo=this.colorByInfo;if(colorByInfo.tp===COLOR_BY_TYPE.ATT||colorByInfo.tp===COLOR_BY_TYPE.ATT_METRICS){atts=colorByInfo.atts;len=atts.length;for(i=0;i<len;i++){att=atts[i];if(att.axis===direction){res.push({index:att.uidx,order:i});}}return res.sort(compareIndexOrderPair);}return[];}function getPosOfMids(mids,mIdx,etp,etpType){var i,len=mids.length;for(i=0;i<len;i++){if(mIdx===mids[i]&&(etpType===undefined||etpType===etp[i])){return i;}}return -1;}function mergeAndGetExtremes(extrObjCollection,mids,mtsIdxArr,etp,etpType){var i,min,max,len=mtsIdxArr.length,exObj,mIdx,pos;if(len>0&&(extrObjCollection===undefined||mids===undefined)){$VISUTIL.visPrint("the extreme is likely missing");return{min:0,max:99999999};}if(len===0){return undefined;}var assigned=false;for(i=0;i<len;i++){mIdx=mtsIdxArr[i];if(mIdx===undefined||mIdx===INVALID_METRIC_IDX){return undefined;}pos=getPosOfMids(mids,mIdx,etp,etpType);if(pos>=0){exObj=extrObjCollection[pos];if(!assigned&&exObj.length>=1){min=GMUTIL.parseNumeric(exObj[0]);max=GMUTIL.parseNumeric(exObj[1]);assigned=true;}else{if(min>GMUTIL.parseNumeric(exObj[0])){min=GMUTIL.parseNumeric(exObj[0]);}if(max<GMUTIL.parseNumeric(exObj[1])){max=GMUTIL.parseNumeric(exObj[1]);}}}else{$VISUTIL.visPrint("the metric "+mIdx+" Not Found in extremes from back end");return{min:0,max:99999999};}}return{min:min,max:max};}function getExObjAndMids(hostType,whichAxis,r,c){var extrs=this.extrs,mids,exObj,etp,iLdsIdx,rLds,cLds;if(hostType!==PRP_AXIS_SCALE.GLOBAL){iLdsIdx=this.mapFromChartToLDSIndex(r,c);rLds=iLdsIdx.r;cLds=iLdsIdx.c;}if(whichAxis==="XAxis"||whichAxis==="X2Axis"){whichAxis="x";}else{if(whichAxis==="YAxis"||whichAxis==="Y2Axis"){whichAxis="y";}else{if(whichAxis==="SizeBy"){whichAxis="z";}}}if(hostType===PRP_AXIS_SCALE.GLOBAL){if(extrs.g){exObj=extrs.g.ex;mids=extrs.g.mids;etp=extrs.g.etp;}}else{if(hostType===PRP_AXIS_SCALE.PERROWCOL){if(whichAxis!=="z"){var rOrC=(whichAxis==="y"?extrs.r:extrs.c);if(rOrC){mids=rOrC.mids;exObj=rOrC.ex[(whichAxis==="y"?rLds:cLds)];etp=rOrC.etp;}}else{if(extrs.all){mids=extrs.all.mids;exObj=extrs.all.ex[rLds][cLds];etp=extrs.all.etp;}}}else{if(hostType===PRP_AXIS_SCALE.PERCELL){if(extrs.all){mids=extrs.all.mids;exObj=extrs.all.ex[rLds][cLds];etp=extrs.all.etp;}}}}return{mids:mids,exObj:exObj,etp:etp};}function correctExtremeForABL(originEx,shapes){var subType=this.chartSubType,hasBar=false,shapeBar=$GM.EnumShape.BAR;shapes=shapes||[];$ARR.forEach(shapes,function(sp){if(sp===shapeBar){hasBar=true;}});if(originEx&&(originEx.min!==undefined&&originEx.max!==undefined)){if(originEx.min>0){if(hasBar){originEx.min=0;}if(subType===PRP_SUBTYPE.PERCENT){originEx.max=1;originEx.min=0;}}if(originEx.max<0){if(hasBar){originEx.max=0;}if(subType===PRP_SUBTYPE.PERCENT){originEx.min=-1;originEx.max=0;}}}return originEx;}function getMetricsOnCurrentAxis(r,c,axisName){var metricsOnCurrentAxis;if(axisName==="YAxis"){metricsOnCurrentAxis=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"y",true,true));}else{if(axisName==="Y2Axis"){metricsOnCurrentAxis=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"y",false,true));}else{if(axisName==="XAxis"){metricsOnCurrentAxis=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"x",true,true));}else{if(axisName==="X2Axis"){metricsOnCurrentAxis=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"x",false,true));}else{$VISUTIL.visPrint("to support");}}}}return metricsOnCurrentAxis;}function getAxisScaleFromCache(r,c,axisName,axisScale){var tag=axisName[0];if(tag!=="X"&&tag!=="Y"){return null;}this.axisScaleCache=this.axisScaleCache||{};this.axisScaleCache[axisScale]=this.axisScaleCache[axisScale]||{};this.axisScaleCache[axisScale][axisName]=this.axisScaleCache[axisScale][axisName]||{};var scaleType=axisScale,theTarget=null,horvCache=this.axisScaleCache[axisScale][axisName];horvCache=horvCache||{};if(axisName[0]==="X"){if(scaleType===PRP_AXIS_SCALE.GLOBAL||scaleType===PRP_AXIS_SCALE.PERROWCOL){theTarget=horvCache[c];}}else{if(axisName[0]==="Y"){if(scaleType===PRP_AXIS_SCALE.GLOBAL||scaleType===PRP_AXIS_SCALE.PERROWCOL){theTarget=horvCache[r];}}else{}}if(!!theTarget){return theTarget;}return null;}function updateAxisScaleToCache(r,c,axisName,minMax,axisScale){var tag=axisName[0];if(tag!=="X"&&tag!=="Y"){return ;}this.axisScaleCache=this.axisScaleCache||{};this.axisScaleCache[axisScale]=this.axisScaleCache[axisScale]||{};this.axisScaleCache[axisScale][axisName]=this.axisScaleCache[axisScale][axisName]||{};var scaleType=axisScale,horvCache=this.axisScaleCache[axisScale][axisName];horvCache=horvCache||{};if(axisName[0]==="X"){if(scaleType===PRP_AXIS_SCALE.GLOBAL||scaleType===PRP_AXIS_SCALE.PERROWCOL){horvCache[c]=minMax;}}else{if(axisName[0]==="Y"){if(scaleType===PRP_AXIS_SCALE.GLOBAL||scaleType===PRP_AXIS_SCALE.PERROWCOL){horvCache[r]=minMax;}}else{}}}function getMinMaxForABLOnAxis(r,c,axisName,axisScale){var chtInfo=this.getChartInfo(),me=this,dirc=chtInfo.dirc,eDIRC=$GM.EnumABLDirection,exObj,mids,etp,minMax,gExtrsOnX,gExtrsOnY,gExtrsOnX2,gExtrsOnY2,metricsOnCurrentAxis,shpsOnAx=[],temp;if(axisScale===undefined){axisScale=this.axisScale;}minMax=getAxisScaleFromCache.call(this,r,c,axisName,axisScale);if(!!minMax){return minMax;}metricsOnCurrentAxis=getMetricsOnCurrentAxis.call(me,r,c,axisName);$ARR.forEach(metricsOnCurrentAxis,function(mi){shpsOnAx.push(me.getOnTheFlyShapeForMetric(mi));});temp=getExObjAndMids.call(this,axisScale,dirc===eDIRC.VERTICAL?"y":"x",r,c);exObj=temp.exObj;mids=temp.mids;etp=temp.etp;minMax={};if(dirc===eDIRC.VERTICAL){if(this.isStacked&&!this.splitPlottingMetrics){gExtrsOnY=(axisName==="YAxis")&&mergeAndGetExtremes(exObj,mids,[$STK_EX.PRIMARY_Y_AXIS],etp,ETP_SCALE);gExtrsOnY2=(axisName==="Y2Axis")&&mergeAndGetExtremes(exObj,mids,[$STK_EX.SECONDARY_Y_AXIS],etp,ETP_SCALE);}else{gExtrsOnY=(axisName==="YAxis")&&mergeAndGetExtremes(exObj,mids,metricsOnCurrentAxis,etp,ETP_SCALE);gExtrsOnY2=(axisName==="Y2Axis")&&mergeAndGetExtremes(exObj,mids,metricsOnCurrentAxis,etp,ETP_SCALE);}if(gExtrsOnY){gExtrsOnY=correctExtremeForABL.call(me,gExtrsOnY,shpsOnAx);minMax.min=minMax.YMin=gExtrsOnY.min;minMax.max=minMax.YMax=gExtrsOnY.max;}if(gExtrsOnY2){gExtrsOnY2=correctExtremeForABL.call(me,gExtrsOnY2,shpsOnAx);minMax.min=minMax.Y2Min=gExtrsOnY2.min;minMax.max=minMax.Y2Max=gExtrsOnY2.max;}}else{if(this.isStacked&&!this.splitPlottingMetrics){gExtrsOnX=(axisName==="XAxis")&&mergeAndGetExtremes(exObj,mids,[$STK_EX.PRIMARY_X_AXIS],etp,ETP_SCALE);gExtrsOnX2=(axisName==="X2Axis")&&mergeAndGetExtremes(exObj,mids,[$STK_EX.SECONDARY_X_AXIS],etp,ETP_SCALE);}else{gExtrsOnX=(axisName==="XAxis")&&mergeAndGetExtremes(exObj,mids,metricsOnCurrentAxis,etp,ETP_SCALE);gExtrsOnX2=(axisName==="X2Axis")&&mergeAndGetExtremes(exObj,mids,metricsOnCurrentAxis,etp,ETP_SCALE);}if(gExtrsOnX){gExtrsOnX=correctExtremeForABL.call(me,gExtrsOnX,shpsOnAx);minMax.min=minMax.XMin=gExtrsOnX.min;minMax.max=minMax.XMax=gExtrsOnX.max;}if(gExtrsOnX2){gExtrsOnX2=correctExtremeForABL.call(me,gExtrsOnX2,shpsOnAx);minMax.min=minMax.X2Min=gExtrsOnX2.min;minMax.max=minMax.X2Max=gExtrsOnX2.max;}}updateAxisScaleToCache.call(this,r,c,axisName,minMax,axisScale);return minMax;}function getMinMaxForBubbleOnAxis(r,c,axisName,axisScale){var minMax,etpX,etpY,tempX,tempY,metricsOnCurrentAxis,exObjX,exObjY,midsX,midsY,gExtrsOnAx;if(axisScale===undefined){axisScale=this.axisScale;}minMax=getAxisScaleFromCache.call(this,r,c,axisName,axisScale);if(!!minMax){return minMax;}tempX=getExObjAndMids.call(this,axisScale,"x",r,c);exObjX=tempX.exObj;midsX=tempX.mids;etpX=tempX.etp;tempY=getExObjAndMids.call(this,axisScale,"y",r,c);exObjY=tempY.exObj;midsY=tempY.mids;etpY=tempY.etp;metricsOnCurrentAxis=getMetricsOnCurrentAxis.call(this,r,c,axisName);if(axisName==="YAxis"){gExtrsOnAx=mergeAndGetExtremes(exObjY,midsY,metricsOnCurrentAxis,etpY,ETP_SCALE);minMax={YMin:gExtrsOnAx&&gExtrsOnAx.min,YMax:gExtrsOnAx&&gExtrsOnAx.max};}else{if(axisName==="Y2Axis"){gExtrsOnAx=mergeAndGetExtremes(exObjY,midsY,metricsOnCurrentAxis,etpY,ETP_SCALE);minMax={Y2Min:gExtrsOnAx&&gExtrsOnAx.min,Y2Max:gExtrsOnAx&&gExtrsOnAx.max};}else{if(axisName==="XAxis"){gExtrsOnAx=mergeAndGetExtremes(exObjX,midsX,metricsOnCurrentAxis,etpX,ETP_SCALE);minMax={XMin:gExtrsOnAx&&gExtrsOnAx.min,XMax:gExtrsOnAx&&gExtrsOnAx.max};}else{if(axisName==="X2Axis"){gExtrsOnAx=mergeAndGetExtremes(exObjX,midsX,metricsOnCurrentAxis,etpX,ETP_SCALE);minMax={X2Min:gExtrsOnAx&&gExtrsOnAx.min,X2Max:gExtrsOnAx&&gExtrsOnAx.max};}else{$VISUTIL.visPrint("to support");}}}}minMax.min=gExtrsOnAx&&gExtrsOnAx.min;minMax.max=gExtrsOnAx&&gExtrsOnAx.max;updateAxisScaleToCache.call(this,r,c,axisName,minMax,axisScale);return minMax;}function getGlobalExtremeForMetric(metricId,sizeByOnly){var temp,exObj,mids,etp,gExOfMetric,mIdx=getMetricIndexFromID(metricId,this.gts);temp=getExObjAndMids.call(this,PRP_AXIS_SCALE.GLOBAL);exObj=temp.exObj;mids=temp.mids;etp=temp.etp;if(sizeByOnly===true){gExOfMetric=mergeAndGetExtremes(exObj,mids,[mIdx],etp,ETP_SIZEBY);}else{gExOfMetric=mergeAndGetExtremes(exObj,mids,[mIdx],etp,ETP_SCALE);}return gExOfMetric;}function getMinMaxOnNumericAxis(r,c){var chtInfo=this.getChartInfo(),res={},me=this,axisNames=["YAxis","Y2Axis","XAxis","X2Axis"],axEx,func;func=chtInfo.isABL?getMinMaxForABLOnAxis:getMinMaxForBubbleOnAxis;axisNames.forEach(function(ax){axEx=func.call(me,r,c,ax);$HASH.copy(axEx,res);});return res;}function isMetricID(hostName){var nonMetricNames=["AllMetrics","XAxis","X2Axis","YAxis","Y2Axis","SizeBy"];return(nonMetricNames.indexOf(hostName)<0);}function getAxisScaleModeForSingleMetric(mtsIdx,dropZone,extraInfo){var i,n,NAME=0,TYPE=1,MIN=2,MAX=3,members,allMetricsType,axisScale=this.axisScale,mtsId,zoneScaleType,singleMetricScaleType,axisScaleData;if(mtsIdx!==undefined){mtsId=(this.model.getMetricIDsFromIndex([mtsIdx]))[0];}if(axisScale!==PRP_AXIS_SCALE.CUSTOM){return axisScale;}axisScaleData=this.view.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE_DATA);allMetricsType=parseInt(axisScaleData[0][TYPE],10);if(allMetricsType!==PRP_AXIS_SCALE.DIFFERENT){if(extraInfo!==undefined){extraInfo.min=parseFloat(axisScaleData[0][MIN]);extraInfo.max=parseFloat(axisScaleData[0][MAX]);}return allMetricsType;}for(i=1,n=axisScaleData.length;i<n;i++){members=axisScaleData[i];var hostName=members[NAME];if(dropZone!==undefined&&hostName===dropZone){zoneScaleType=parseInt(members[TYPE],10);if(extraInfo!==undefined){extraInfo.min=parseFloat(members[MIN]);extraInfo.max=parseFloat(members[MAX]);}break;}if(mtsId!==undefined&&mtsId===hostName){singleMetricScaleType=parseInt(members[TYPE],10);if(extraInfo!==undefined){extraInfo.min=parseFloat(members[MIN]);extraInfo.max=parseFloat(members[MAX]);}}}return zoneScaleType!==undefined?zoneScaleType:singleMetricScaleType;}function getShapesForAxisName(axisName){var hostNameIsMetric=isMetricID(axisName),metricsOnCurrentAxis,shpsOnAx=[],midx,r=0,c=0,me=this;if(hostNameIsMetric){midx=this.getMetricIndexFromID(axisName);return[this.getOnTheFlyShapeForMetric(midx)];}metricsOnCurrentAxis=getMetricsOnCurrentAxis.call(this,r,c,axisName);$ARR.forEach(metricsOnCurrentAxis,function(mi){shpsOnAx.push(me.getOnTheFlyShapeForMetric(mi));});return shpsOnAx;}function getGlobalExtremeForAxisOrMetric(hostName,sizeByOnly,ignoreCustom){var me=this,chtInfo=this.getChartInfo(),temp=getExObjAndMids.call(this,PRP_AXIS_SCALE.GLOBAL),exObj,mids,etp,extreme,szBMetrics,hostNameIsMetric=isMetricID(hostName);var scaleType;var extra={};if(hostNameIsMetric){var midx=getMetricIndexFromID.call(this,hostName,this.gts);scaleType=getAxisScaleModeForSingleMetric.call(this,midx,undefined,extra);}else{scaleType=getAxisScaleModeForSingleMetric.call(this,undefined,hostName,extra);}if(!ignoreCustom){if(scaleType===PRP_AXIS_SCALE.CUSTOM){return{min:extra.min,max:extra.max,scaleType:scaleType};}}if(!hostNameIsMetric){if(hostName==="SizeBy"){exObj=temp.exObj;mids=temp.mids;etp=temp.etp;if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){szBMetrics=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(0,0,"z"));}else{szBMetrics=this.getSizeByMetrics();}extreme=mergeAndGetExtremes(exObj,mids,szBMetrics,etp,ETP_SIZEBY);}else{var func=chtInfo.isABL?getMinMaxForABLOnAxis:getMinMaxForBubbleOnAxis;extreme=func.call(this,0,0,hostName,PRP_AXIS_SCALE.GLOBAL);}}else{extreme=getGlobalExtremeForMetric.call(this,hostName,sizeByOnly);}if(extreme){if(chtInfo.isABL&&scaleType!==PRP_AXIS_SCALE.CUSTOM){extreme=correctExtremeForABL.call(me,extreme,getShapesForAxisName.call(me,hostName));}return{min:extreme.min,max:extreme.max,scaleType:scaleType};}$VISUTIL.visPrint("getGlobalExtremeForAxisOrMetric getting faked extreme");return{min:0,max:99999999,scaleType:scaleType};}function getCustomMinMaxForAxis(axisName,r,c,pairs){var chtInfo=this.getChartInfo(),me=this,NAME=0,TYPE=1,MIN=2,MAX=3,AUTO_MIN=7,AUTO_MAX=8,len=pairs.length,i,members,hostName,hostType,groupTogether=false,min,max,autoMin,autoMax,exObj,mids,etp,extreme,temp,gts,szBMetrics,metricIdx,shortAxisName,shortAxisMapping=["Dumy","x","y","z","x2","y2"],axisMapping=["Dumy","XAxis","YAxis","SizeBy","X2Axis","Y2Axis"];shortAxisName=shortAxisMapping[axisMapping.indexOf(axisName)];var isPrimary=true,func;if(shortAxisName==="x2"){shortAxisName="x";isPrimary=false;}if(shortAxisName==="y2"){shortAxisName="y";isPrimary=false;}for(i=1;i<len;i++){members=pairs[i];hostName=members[NAME];if(hostName===axisName){groupTogether=true;hostType=parseInt(members[TYPE],10);if(hostType===PRP_AXIS_SCALE.CUSTOM){max=parseFloat(members[MAX]);min=parseFloat(members[MIN]);autoMin=GMUTIL.isTrueForBoolValue(members[AUTO_MIN]);autoMax=GMUTIL.isTrueForBoolValue(members[AUTO_MAX]);return{max:max,min:min,autoMin:autoMin,autoMax:autoMax};}if(axisName==="SizeBy"){temp=getExObjAndMids.call(this,hostType,axisName,r,c);exObj=temp.exObj;mids=temp.mids;etp=temp.etp;if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){szBMetrics=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"z"));}else{szBMetrics=this.getSizeByMetrics();}extreme=mergeAndGetExtremes(exObj,mids,szBMetrics,etp,ETP_SIZEBY);}else{func=chtInfo.isABL?getMinMaxForABLOnAxis:getMinMaxForBubbleOnAxis;extreme=func.call(this,r,c,axisName,hostType);}return{max:extreme.max,min:extreme.min,autoMin:false,autoMax:false};}}gts=this.gts;var singleMetricMin,singleMetricMax,singleAutoMin,singleAutoMax,metricsOnAxis=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,shortAxisName,isPrimary));if(groupTogether===false){var firstMetric=true;max=min=undefined;for(i=1;i<len;i++){members=pairs[i];hostName=members[NAME];hostType=parseInt(members[TYPE],10);if(isMetricID(hostName)){metricIdx=getMetricIndexFromID.call(this,hostName,gts);if(isDigitInArray(metricIdx,metricsOnAxis)){if(hostType===3){singleMetricMax=parseFloat(members[MAX]);singleMetricMin=parseFloat(members[MIN]);singleAutoMin=GMUTIL.isTrueForBoolValue(members[AUTO_MIN]);singleAutoMax=GMUTIL.isTrueForBoolValue(members[AUTO_MAX]);}else{temp=getExObjAndMids.call(this,hostType,axisName,r,c);exObj=temp.exObj;mids=temp.mids;etp=temp.etp;extreme=mergeAndGetExtremes(exObj,mids,[metricIdx],etp,axisName==="SizeBy"?ETP_SIZEBY:ETP_SCALE);if(chtInfo.isABL&&axisName!=="SizeBy"){var sp=me.getOnTheFlyShapeForMetric(metricIdx);extreme=correctExtremeForABL.call(me,extreme,[sp]);}singleMetricMax=extreme.max;singleMetricMin=extreme.min;singleAutoMin=false;singleAutoMax=false;}if(firstMetric){min=singleMetricMin;max=singleMetricMax;autoMin=singleAutoMin;autoMax=singleAutoMax;}else{min=min<singleMetricMin?min:singleMetricMin;max=max>singleMetricMax?max:singleMetricMax;autoMin=autoMin===singleAutoMin?autoMin:false;autoMax=autoMax===singleAutoMax?autoMax:false;}firstMetric=false;}}}return{max:max,min:min,autoMin:autoMin,autoMax:autoMax};}}function getCustomMinMaxForDP(r,c,axisScaleData){var TYPE=1,MIN=2,MAX=3,AUTO_MIN=7,AUTO_MAX=8,members,minMax,allMetricsType;members=axisScaleData[0];allMetricsType=parseInt(members[TYPE],10);if(allMetricsType===PRP_AXIS_SCALE.CUSTOM){var gMin,gMax,gAutoMin,gAutoMax;gMin=parseFloat(members[MIN]);gMax=parseFloat(members[MAX]);gAutoMin=GMUTIL.isTrueForBoolValue(members[AUTO_MIN]);gAutoMax=GMUTIL.isTrueForBoolValue(members[AUTO_MAX]);minMax={XMin:gMin,XMax:gMax,YMin:gMin,YMax:gMax,ZMin:gMin,ZMax:gMax,X2Min:gMin,X2Max:gMax,Y2Min:gMin,Y2Max:gMax,XAutoMin:gAutoMin,XAutoMax:gAutoMax,X2AutoMin:gAutoMin,X2AutoMax:gAutoMax,YAutoMin:gAutoMin,YAutoMax:gAutoMax,Y2AutoMin:gAutoMin,Y2AutoMax:gAutoMax,ZAutoMin:gAutoMin,ZAutoMax:gAutoMax};}else{var xEx,yEx,zEx,x2Ex,y2Ex;xEx=getCustomMinMaxForAxis.call(this,"XAxis",r,c,axisScaleData);yEx=getCustomMinMaxForAxis.call(this,"YAxis",r,c,axisScaleData);x2Ex=getCustomMinMaxForAxis.call(this,"X2Axis",r,c,axisScaleData);y2Ex=getCustomMinMaxForAxis.call(this,"Y2Axis",r,c,axisScaleData);zEx=getCustomMinMaxForAxis.call(this,"SizeBy",r,c,axisScaleData);minMax={XMin:xEx.min,XMax:xEx.max,YMin:yEx.min,YMax:yEx.max,ZMin:zEx.min,ZMax:zEx.max,X2Min:x2Ex.min,X2Max:x2Ex.max,Y2Min:y2Ex.min,Y2Max:y2Ex.max,XAutoMin:xEx.autoMin,XAutoMax:xEx.autoMax,X2AutoMin:x2Ex.autoMin,X2AutoMax:x2Ex.autoMax,YAutoMin:yEx.autoMin,YAutoMax:yEx.autoMax,Y2AutoMin:y2Ex.autoMin,Y2AutoMax:y2Ex.autoMax,ZAutoMin:zEx.autoMin,ZAutoMax:zEx.autoMax};}return minMax;}function getMinMaxForColorByMetric(){var colorByInfo=this.colorByInfo,temp,exObj,mids,etp,gExColorBy,cbidx;if(colorByInfo.tp===COLOR_BY_TYPE.METRICS){cbidx=colorByInfo.colorByMetricIndex;temp=getExObjAndMids.call(this,PRP_AXIS_SCALE.GLOBAL,"c",0,0);exObj=temp.exObj;mids=temp.mids;etp=temp.etp;gExColorBy=mergeAndGetExtremes(exObj,mids,[cbidx],etp,ETP_COLORBY);return gExColorBy;}return undefined;}function tranformAndUpper(ax){var candidate;if(ax==="x1"){candidate="x";}else{if(ax==="y1"){candidate="y";}else{candidate=ax;}}return candidate.toUpperCase();}function getMinMaxForDP(r,c){var props,chtInfo=this.getChartInfo(),eGT=CHART_TYPE,axisScale=this.axisScale,exObjSB,midsSB,etpSB,minMax,realMax,realMin,gSizeByExtrs,tempSB,sizeByMetricsOnCurrentChart,axisScaleData,sizeByMetrics=this.getSizeByMetrics(),hasSizeBy=sizeByMetrics.length>0;if(axisScale===PRP_AXIS_SCALE.CUSTOM){axisScaleData=this.view.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE_DATA);}if(chtInfo.isABL){if(axisScale===PRP_AXIS_SCALE.CUSTOM){minMax=getCustomMinMaxForDP.call(this,r,c,axisScaleData);if(chtInfo.isABL&&this.chartSubType===PRP_SUBTYPE.PERCENT){if(hasSizeBy){var sbMetricIdx=sizeByMetrics[0];if(getAxisScaleModeForSingleMetric.call(this,sbMetricIdx,"SizeBy")===PRP_AXIS_SCALE.CUSTOM){realMax=this.model.mx[sbMetricIdx].max;realMin=this.model.mx[sbMetricIdx].min;minMax.ZMin=minMax.ZMin*(realMax-realMin)+realMin;minMax.ZMax=minMax.ZMax*(realMax-realMin)+realMin;}}}}else{minMax=getMinMaxOnNumericAxis.call(this,r,c);if(hasSizeBy){var temp=getExObjAndMids.call(this,axisScale,"z",r,c);exObjSB=temp.exObj;midsSB=temp.mids;etpSB=temp.etp;gSizeByExtrs=mergeAndGetExtremes(exObjSB,midsSB,sizeByMetrics,etpSB,ETP_SIZEBY);if(gSizeByExtrs){minMax.ZMin=gSizeByExtrs.min;minMax.ZMax=gSizeByExtrs.max;}}}}else{if(chtInfo.tp===eGT.BUBBLE||chtInfo.tp===eGT.SCATTER){sizeByMetricsOnCurrentChart=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"z"));if(axisScale===PRP_AXIS_SCALE.CUSTOM){minMax=getCustomMinMaxForDP.call(this,r,c,axisScaleData);}else{minMax=getMinMaxOnNumericAxis.call(this,r,c);if(hasSizeBy){tempSB=getExObjAndMids.call(this,axisScale,"z",r,c);exObjSB=tempSB.exObj;midsSB=tempSB.mids;etpSB=tempSB.etp;gSizeByExtrs=mergeAndGetExtremes(exObjSB,midsSB,sizeByMetricsOnCurrentChart,etpSB,ETP_SIZEBY);if(gSizeByExtrs){minMax.ZMin=gSizeByExtrs.min;minMax.ZMax=gSizeByExtrs.max;}}}if(hasSizeBy&&sizeByMetricsOnCurrentChart.length>0&&minMax.ZMin===undefined&&minMax.ZMax===undefined){var szmInAxis=this.sizeByMetricsSharedInAxis;if(szmInAxis.length>1){var minArr=[],maxArr=[];szmInAxis.forEach(function(ax){minArr.push(minMax[tranformAndUpper(ax)+"Min"]);maxArr.push(minMax[tranformAndUpper(ax)+"Max"]);});minMax.ZMin=minArr.sort()[0];minMax.ZMax=maxArr.sort()[maxArr.length-1];}else{if(szmInAxis.length===1){var collisionSizeByMetric=this.collisionSizeByMetric;var szMAxScaleTp=getAxisScaleModeForSingleMetric.call(this,collisionSizeByMetric[0],tranformAndUpper(szmInAxis[0])+"Axis");if(szMAxScaleTp===PRP_AXIS_SCALE){minMax.ZMin=minMax[tranformAndUpper(szmInAxis[0])+"Min"];minMax.ZMax=minMax[tranformAndUpper(szmInAxis[0])+"Max"];}else{if(szMAxScaleTp!==PRP_AXIS_SCALE.GLOBAL){szMAxScaleTp=PRP_AXIS_SCALE.PERCELL;}tempSB=getExObjAndMids.call(this,szMAxScaleTp,"z",r,c);exObjSB=tempSB.exObj;midsSB=tempSB.mids;etpSB=tempSB.etp;gSizeByExtrs=mergeAndGetExtremes(exObjSB,midsSB,sizeByMetricsOnCurrentChart,etpSB,undefined);if(gSizeByExtrs){minMax.ZMin=gSizeByExtrs.min;minMax.ZMax=gSizeByExtrs.max;}}}}}}else{if(chtInfo.tp===eGT.GRID){if(axisScale===PRP_AXIS_SCALE.CUSTOM){minMax=getCustomMinMaxForDP.call(this,r,c,axisScaleData);}else{tempSB=getExObjAndMids.call(this,axisScale,"z",r,c);exObjSB=tempSB.exObj;midsSB=tempSB.mids;etpSB=tempSB.etp;gSizeByExtrs=mergeAndGetExtremes(exObjSB,midsSB,sizeByMetrics,etpSB,ETP_SIZEBY);if(gSizeByExtrs){minMax={ZMin:gSizeByExtrs.min,ZMax:gSizeByExtrs.max};}else{minMax={};}}}}}props={YMinValue:minMax.YMin,YMaxValue:minMax.YMax,Y2MinValue:minMax.Y2Min,Y2MaxValue:minMax.Y2Max,XMinValue:minMax.XMin,XMaxValue:minMax.XMax,X2MinValue:minMax.X2Min,X2MaxValue:minMax.X2Max,ZMinValue:minMax.ZMin,ZMaxValue:minMax.ZMax};$HASH.copyProps(["XAutoMin","XAutoMax","X2AutoMin","X2AutoMax","YAutoMin","YAutoMax","Y2AutoMin","Y2AutoMax","ZAutoMin","ZAutoMax"],minMax,props);return props;}function getCustomAxisEnabled(metricsIndexes,dropZone){var customAxisEnabled=false,me=this,axisMode,emptyAxis=false;$ARR.forEach(metricsIndexes,function(mtsIdx){if(mtsIdx===undefined||mtsIdx<0){emptyAxis=true;}else{axisMode=getAxisScaleModeForSingleMetric.call(me,mtsIdx,dropZone);if(axisMode===PRP_AXIS_SCALE.CUSTOM){customAxisEnabled=true;}}});return{emptyAxis:emptyAxis,customAxisEnabled:customAxisEnabled};}function calcSizebyLegendValues(sizeByMeticIndex,proportionalMode){var sbExtreme,html5Extreme,origMin,origMax,sizebyValues,extremeForPpMode;html5Extreme=getMinMaxForDP.call(this,0,0);sbExtreme={origMin:html5Extreme.ZMinValue,origMax:html5Extreme.ZMaxValue};origMin=sbExtreme.origMin;origMax=sbExtreme.origMax;if(proportionalMode&&origMin<0){extremeForPpMode=this.getSizeByExtremeForNegativeProportionalMode(sizeByMeticIndex);origMin=extremeForPpMode.min||origMin;origMax=extremeForPpMode.max||origMax;}sizebyValues=[origMax];if(origMin!==origMax){sizebyValues.push(origMin);}return sizebyValues;}function constructSizebyDataProvider(notAllBubbleInLineFlag){if(notAllBubbleInLineFlag===undefined){notAllBubbleInLineFlag=true;}var bubbleSeriesNum,metricsOnX=this.getMetricsOnXAxis(),metricsOnY=this.getMetricsOnYAxis(),chtInfo=this.getChartInfo(),chartType=chtInfo.tp,sizeByMtsIdx=this.getSizeByMetrics(),colorByMtsIdx=this.getColorByMetrics(),gmm=this.model,metricNames=gmm.getMetricNames(),sizeByMxName=getMetricNamesFromIndex(sizeByMtsIdx,metricNames),mkShape=this.markerShape,sizebyDP=[],sizebyTitles=[],sizebyType=0,sizebyGlobal=true,i=0,j=0,sizebyScaleType=[],isSizebyMissing=true,_rhNum=this.model.cic,_chNum=this.model.cir,sizebyValues,numOfSizebyValues,sizebyDiameter,sizebyValue,strSizebyValue,szLen,useAbbrevation;bubbleSeriesNum=Math.min(metricsOnX.length,metricsOnY.length);if(sizeByMtsIdx.length>0){bubbleSeriesNum=Math.min(bubbleSeriesNum,sizeByMtsIdx.length);}if(sizeByMxName&&sizeByMxName[0]&&mkShape!==MK_SHAPE.AREA){if((!checkMutipleBubble.call(this)&&this.getSizeByScaleType(0)===PRP_AXIS_SCALE.GLOBAL)||(!checkMutipleBubble.call(this)&&this.getSizeByScaleType(0)===PRP_AXIS_SCALE.CUSTOM)||(!checkMutipleBubble.call(this)&&(_rhNum===1&&_chNum===1&&((chartType===CHART_TYPE.BUBBLE||chartType===CHART_TYPE.SCATTER)||chartType===CHART_TYPE.GRID||chtInfo.isABL)))){sizebyValues=calcSizebyLegendValues.call(this,sizeByMtsIdx[0],this.property.readItem(ENUM_XML_TAG.MIN_SIZE_TYPE)===PRP_MIN_SIZE_TYPE.PROPORTIONAL);numOfSizebyValues=sizebyValues.length;sizebyDiameter=0;sizebyValue=0;strSizebyValue="";for(i=0;i<numOfSizebyValues;i++){sizebyValue=sizebyValues[i];if(isNaN(sizebyValue)){strSizebyValue="NaN";}else{strSizebyValue=formatMetricValue.call(this,sizebyValue,sizeByMtsIdx[0]);isSizebyMissing=false;}sizebyDP.push({diameter:sizebyDiameter,value:strSizebyValue,num:sizebyValue});}szLen=sizebyDP.length;if(szLen>0){useAbbrevation=false;if(useAbbrevation){for(i=0;i<szLen;++i){sizebyDP[i].value=GMUTIL.formatNumber(sizebyDP[i].num,"up").s;}}}}else{sizebyGlobal=false;for(i=0;i<sizeByMxName.length;i++){isSizebyMissing=false;if(!isSizebyMissing){break;}}}if(sizeByMxName.length>1&&!checkMutipleBubble.call(this)){for(j=0;j<bubbleSeriesNum;j++){if(chtInfo.isPie&&colorByMtsIdx&&colorByMtsIdx.indexOf(sizeByMtsIdx[j])!==-1){sizebyTitles[j]="Total of "+sizeByMxName[j];}else{sizebyTitles[j]=sizeByMxName[j];}}}else{for(j=0;j<sizeByMxName.length;j++){if(chtInfo.isPie&&colorByMtsIdx&&colorByMtsIdx.indexOf(sizeByMtsIdx[j])!==-1){sizebyTitles[j]="Total of "+sizeByMxName[j];}else{sizebyTitles[j]=sizeByMxName[j];}}}if(mkShape===MK_SHAPE.CIRCLE||mkShape===MK_SHAPE.LINE){sizebyType=SIZEBY_TYPE.CIRCLE;}else{sizebyType=SIZEBY_TYPE.SQUARE;}for(i=0;i<sizeByMxName.length;i++){if(this.getSizeByScaleType(i)===PRP_AXIS_SCALE.CUSTOM){sizebyScaleType.push(sizeByMxName[i]);}}}if(isSizebyMissing){sizebyTitles=[];}return{sizeByDataProvider:sizebyDP,sizeByTitles:sizebyTitles,sizebyType:sizebyType,sizeByMode:sizebyGlobal,sizeByScaleType:sizebyScaleType};}function getCEChartTypeAndShape(type,subType,direction,shape){var eGT=CHART_TYPE,eDIRC=$GM.EnumABLDirection,ceChartType,markerShape,isABL=(type===eGT.BAR||type===eGT.LINE||type===eGT.AREA);if(isABL){if(shape!==MK_SHAPE.BAR){if(subType===PRP_SUBTYPE.CLUSTERED){subType=PRP_SUBTYPE.ABSOLUTE;}}else{if(subType===PRP_SUBTYPE.ABSOLUTE){subType=PRP_SUBTYPE.CLUSTERED;}}if(type===eGT.BAR){if(subType===PRP_SUBTYPE.ABSOLUTE){if(shape===MK_SHAPE.BAR){subType=PRP_SUBTYPE.CLUSTERED;}}}}if(isABL&&subType===PRP_SUBTYPE.AUTO){if(shape===PRP_SHAPE.AREA){subType=PRP_SUBTYPE.STACKED;}else{if(shape===PRP_SHAPE.BAR){subType=PRP_SUBTYPE.CLUSTERED;}else{subType=PRP_SUBTYPE.ABSOLUTE;}}}if(isABL&&shape===PRP_SHAPE.BAR&&subType===PRP_SUBTYPE.ABSOLUTE){subType=PRP_SUBTYPE.CLUSTERED;}if(type===eGT.AREA){if(direction===eDIRC.VERTICAL){switch(subType){case PRP_SUBTYPE.ABSOLUTE:ceChartType=1;break;case PRP_SUBTYPE.STACKED:ceChartType=2;break;case PRP_SUBTYPE.PERCENT:ceChartType=7;break;}}else{switch(subType){case PRP_SUBTYPE.ABSOLUTE:ceChartType=8;break;case PRP_SUBTYPE.STACKED:ceChartType=9;break;case PRP_SUBTYPE.PERCENT:ceChartType=14;break;}}}else{if(type===eGT.BAR){if(direction===eDIRC.VERTICAL){switch(subType){case PRP_SUBTYPE.CLUSTERED:ceChartType=15;break;case PRP_SUBTYPE.ABSOLUTE:ceChartType=91;break;case PRP_SUBTYPE.STACKED:ceChartType=16;break;case PRP_SUBTYPE.PERCENT:ceChartType=21;break;}}else{switch(subType){case PRP_SUBTYPE.CLUSTERED:ceChartType=22;break;case PRP_SUBTYPE.ABSOLUTE:ceChartType=92;break;case PRP_SUBTYPE.STACKED:ceChartType=23;break;case PRP_SUBTYPE.PERCENT:ceChartType=28;break;}}}else{if(type===eGT.LINE){if(direction===eDIRC.VERTICAL){switch(subType){case PRP_SUBTYPE.ABSOLUTE:ceChartType=29;break;case PRP_SUBTYPE.STACKED:ceChartType=30;break;case PRP_SUBTYPE.PERCENT:ceChartType=35;break;}}else{switch(subType){case PRP_SUBTYPE.ABSOLUTE:ceChartType=36;break;case PRP_SUBTYPE.STACKED:ceChartType=37;break;case PRP_SUBTYPE.PERCENT:ceChartType=42;break;}}}else{if(type===eGT.BUBBLE){ceChartType=61;}else{if(type===eGT.SCATTER){ceChartType=51;}else{if(type===eGT.GRID){ceChartType=20000;}else{$VISUTIL.visPrint("the ce chart type is not found");}}}}}}switch(shape){case PRP_SHAPE.AREA:markerShape=MK_SHAPE.AREA;break;case PRP_SHAPE.BAR:markerShape=MK_SHAPE.BAR;break;case PRP_SHAPE.LINE:markerShape=MK_SHAPE.LINE;break;case PRP_SHAPE.CIRCLE:markerShape=MK_SHAPE.CIRCLE;break;case PRP_SHAPE.SQUARE:markerShape=MK_SHAPE.SQUARE;break;case PRP_SHAPE.TICK:markerShape=MK_SHAPE.TICK;break;case PRP_SHAPE.PIE:markerShape=MK_SHAPE.PIE;break;case PRP_SHAPE.RING:markerShape=MK_SHAPE.RING;break;}return{ceChartType:ceChartType,shape:markerShape,subType:subType};}function getMetricsOnABLMetricValue(axIdx,includeInvalidMetrics,intoIndex,zone){var storedGI=this.hasGroupInfoStored(),gts=this.gts,res=[],dz=this.dz,chtInfo,metricZone,tms,midx,mid,ax,isAPrimaryMetric;if(this.shallWeUseGroupInfo&&includeInvalidMetrics&&storedGI.existing){var gInfo=storedGI.gi;if(intoIndex===true){$ARR.forEach(gInfo,function(pair){var mid=pair[0];if(mid!==INVALID_METRIC_IDX){pair[0]=getMetricIndexFromID.call(this,mid,gts);}mid=pair[1];if(mid!==INVALID_METRIC_IDX){pair[1]=getMetricIndexFromID.call(this,mid,gts);}});}$ARR.forEach(gInfo,function(pair){if(includeInvalidMetrics===true){res.push(pair[axIdx]);}else{if(pair[axIdx]!==INVALID_METRIC_IDX){res.push(pair[axIdx]);}}});return res;}chtInfo=this.getChartInfo();if(chtInfo.isABL){if(chtInfo.dirc===ABL_DIRECTION.VERTICAL){if(zone==="x"){return res;}metricZone=dz.YAxis;}else{if(zone==="y"){return res;}metricZone=dz.XAxis;}}else{if(zone==="x"){metricZone=dz.XAxis;}else{metricZone=dz.YAxis;}}tms=metricZone.TemplateMetric;$ARR.forEach(tms,function(metricInAxisZone){midx=metricInAxisZone.idx;mid=metricInAxisZone.id;ax=parseInt(metricInAxisZone.ax,10);isAPrimaryMetric=(ax===$SAB.PRIMARY);if((axIdx===0&&isAPrimaryMetric===true)||(axIdx===1&&isAPrimaryMetric===false)){if(intoIndex){res.push(midx);}else{res.push(mid);}}});return res;}function getDependentMetrics(){var mtxIdxArr,bbSeries,chtInfo=this.getChartInfo();if(chtInfo.isABL){if(chtInfo.dirc===ABL_DIRECTION.VERTICAL){mtxIdxArr=this.getMetricsOnYAxis();}else{mtxIdxArr=this.getMetricsOnXAxis();}}else{if(chtInfo.tp===CHART_TYPE.GRID){mtxIdxArr=[];}else{mtxIdxArr=this.getMetricsOnYAxis();bbSeries=this.bubbleSeriesNum;if(chtInfo.isBubbleOrScatter&&bbSeries!==undefined){mtxIdxArr=mtxIdxArr.slice(0,bbSeries);}}}return mtxIdxArr;}function isVerticalABLType(type){var verABL=[1,2,7,15,91,16,21,29,30,35];if(isDigitInArray(type,verABL)){return 1;}return 0;}function isHorizontalABLType(type){var horiABL=[8,9,14,22,92,23,28,36,37,42];if(isDigitInArray(type,horiABL)){return 1;}return 0;}function getStaggerStartPos(labelCountArr,idx){if(!labelCountArr||idx>=labelCountArr.length){return 1;}var i,cnt=0;for(i=0;i<idx;i++){cnt+=(labelCountArr[i]||0);}return cnt%2+1;}function cutGVS(x,y,w,h,gvs){var i,partOfSrc=gvs.items.slice(y,y+h),ct=partOfSrc.length,res=[];for(i=0;i<ct;i++){res.push({items:partOfSrc[i].items.slice(x,x+w)});}return res;}function partition(len,n){var res=[];var total=0;var mean=Math.floor(len/n);var i=n;while(i--){res.push(total);total+=mean;}res.push(len);return res;}function getGMHeaderCount(dropzone){var templateUnits=dropzone.TemplateUnit,formCount=0;if(templateUnits){$ARR.forEach(templateUnits,function(attr){formCount+=GMUTIL.getAttributeFormCnt(attr);});}return formCount;}function findUnitByID(id,unitList,prop){var uLen=unitList.length,i;for(i=0;i<uLen;i++){if(id===unitList[i][prop]){return i;}}return -1;}function pickUpNumberFormats(modelData){var gsi=modelData.gsi,mx=gsi.mx,nf=modelData.nf,i,len=mx&&mx.length;for(i=0;i<len;i++){if(typeof nf[i].nfs!=="string"){nf[i].nfs=$VISUTIL.getNumberFormat(modelData,i);}if(mx[i].numfmt===undefined){mx[i].numfmt=nf[i].nfs;}}}function updateDropzoneInfo(dz,modelJSON){var gridTitles=modelJSON.gts,rowTitles=gridTitles.row,colTitles=gridTitles.col,gridMetricElements;[colTitles,rowTitles].forEach(function(titles){if(!gridMetricElements&&titles){var lastTitle=titles[titles.length-1];if(lastTitle&&lastTitle.otp===-1&&lastTitle.es){gridMetricElements=lastTitle.es;}}});function addDropZone(unit,axisTitles,axisName,zoneName){var unitIdx=findUnitByID(unit.id,axisTitles,"id");if(unitIdx>=0){var unitTitle=axisTitles[unitIdx],unitTitleDropZones=unitTitle.dropzones=unitTitle.dropzones||[],unitFs=$HASH.clone(unitTitle.fs);unit.uidx=unitIdx;unit.axis=axisName;unit.fs=unitFs;unit.fcnt=unitFs&&unitFs.length;unit.n=unitTitle.n;unit.cs=unitTitle.cs;unit.rs=unitTitle.rs;unitTitleDropZones.push(zoneName);}}["Rows","Columns","SizeBy","AngleBy","Angle","SliceBy","ColorBy","XAxis","YAxis","BreakBy","AdditionalMetrics"].forEach(function(zoneName){var dropZone=dz[zoneName];if(dropZone){var i=0,templateUnit=dropZone.TemplateUnit,unit;if(templateUnit){while(i<templateUnit.length){unit=templateUnit[i];if(unit.t===EnumDSSXMLObjectTypes.Dimension){var mapping=[];rowTitles.concat(colTitles).forEach(function(title){if(title.hid===unit.id){mapping.push({id:title.id,t:title.t,srcUnit:unit});}});Array.prototype.splice.apply(templateUnit,[i,1].concat(mapping));i+=mapping.length;}else{i++;}}templateUnit.forEach(function(unit,idx){unit.idx=idx;});}(templateUnit||[]).forEach(function(unit){addDropZone(unit,rowTitles,"row",zoneName);addDropZone(unit,colTitles,"col",zoneName);});var dropZoneMetrics=dropZone.TemplateMetric;if(gridMetricElements&&dropZoneMetrics){dropZoneMetrics.forEach(function(metric){var metricIdx=findUnitByID(metric.id,gridMetricElements,"oid");if(metricIdx>=0){metric.idx=metricIdx;metric.n=gridMetricElements[metricIdx].n;gridMetricElements[metricIdx].cds=metric.cds;}});}}});}function getMetricsByType(dz){var dzNms=["XAxis","YAxis","BreakBy","Rows","Columns","SliceBy"],sDz,sDzNm,len=dzNms.length,i,metricsByDZs=[];for(i=0;i<len;i++){sDzNm=dzNms[i];sDz=dz[sDzNm];if(sDz&&sDz.MetricNames!==undefined){metricsByDZs.push(sDzNm);}}if(metricsByDZs.length===1){switch(metricsByDZs[0]){case"XAxis":return METRICS_POS.MetricsByXAxis;case"YAxis":return METRICS_POS.MetricsByYAxis;case"BreakBy":return METRICS_POS.MetricsByBreakBy;case"Rows":return METRICS_POS.MetricsByRow;case"Columns":return METRICS_POS.MetricsByColumn;case"SliceBy":return METRICS_POS.MetricsBySlice;}}else{if(metricsByDZs.length===2){if((metricsByDZs[0]==="XAxis"&&metricsByDZs[1]==="YAxis")||(metricsByDZs[1]==="XAxis"&&metricsByDZs[0]==="YAxis")){return METRICS_POS.MetricsByAxis;}$VISUTIL.visPrint("the metricsBy item is incorrect #1");return METRICS_POS.MetricsByRow;}}if(metricsByDZs.length>2){$VISUTIL.visPrint("the metricsBy item is incorrect #2");return METRICS_POS.MetricsByRow;}if(metricsByDZs.length===0){return METRICS_POS.MetricsByRow;}}function isMetricNamesOnRowMetricsOnXAxis(){var dz=this.dz,chartInfo=this.getChartInfo(),isABL=chartInfo.isABL,metricNamesByRow=dz.Rows.MetricNames!==undefined,noAttributeByYAxis=dz.YAxis.TemplateUnit===undefined;return isABL&&metricNamesByRow&&noAttributeByYAxis;}function isMetricNamesOnColumnMetricsOnYAxis(){var dz=this.dz,metricNamesByRow=dz.Columns.MetricNames!==undefined,noMetricByXAxis=dz.XAxis.TemplateMetric===undefined;return metricNamesByRow&&noMetricByXAxis;}function isMetricNamesInZone(zoneName){var dz=this.dz,zone=dz[zoneName];return(zone.MetricNames!==undefined);}function isOnlyMetricNamesInZone(zoneName){var dz=this.dz,zone=dz[zoneName],keys=Object.keys(zone);return isMetricNamesInZone.call(this,zoneName)&&keys.length===1;}function isOnlyMetricNamesOnAxisForGridPie(){var chartInfo=this.getChartInfo(),isPie=chartInfo.isPie,isGrid=chartInfo.isGrid,onlyMetricNamesOnAxis=isOnlyMetricNamesInZone.call(this,"XAxis")||isOnlyMetricNamesInZone.call(this,"YAxis"),metricsOnAngleBy=this.getMetricsOnAngleBy(),more2=metricsOnAngleBy.length>=2;return isGrid&&isPie&&onlyMetricNamesOnAxis&&more2;}function getAttributesOnDropZone(zoneName,prop){var dz=this.dz,res=[],len,i,att,attConcreteObj,templateUnits,axisName,axis,uidx,gts=this.gts;templateUnits=dz[zoneName].TemplateUnit;if(templateUnits){len=templateUnits.length;for(i=0;i<len;i++){att=templateUnits[i];axisName=att.axis;if(axisName==="row"){axis=gts.row;}else{axis=gts.col;}uidx=att.uidx;attConcreteObj=axis[uidx];if(prop){res.push(attConcreteObj[prop]);}else{res.push(attConcreteObj);}}}return res;}function getColorByType(dz,modelJSON){var colorBy=dz.ColorBy,atts=[],len,i,gsi,colorByMetricIndex,templateUnits=colorBy.TemplateUnit,templateMetrics=colorBy.TemplateMetric,hasAttributes=false,hasMetrics=false,hasMetricsNameItem=false,colorByType=COLOR_BY_TYPE.NULL;if(templateUnits&&templateUnits.length>0){hasAttributes=true;}if(templateMetrics&&templateMetrics.length>0){colorByMetricIndex=templateMetrics[0].idx;hasMetrics=true;}if(colorBy.MetricNames!==undefined){hasMetricsNameItem=true;}if(!(hasMetricsNameItem||templateMetrics||hasAttributes)){return{tp:COLOR_BY_TYPE.NULL};}if(hasAttributes){if(hasMetricsNameItem){colorByType=COLOR_BY_TYPE.ATT_METRICS;}else{colorByType=COLOR_BY_TYPE.ATT;}len=templateUnits.length;for(i=0;i<len;i++){atts.push(templateUnits[i]);}return{tp:colorByType,atts:atts};}if(hasMetricsNameItem){colorByType=COLOR_BY_TYPE.METRICS_ITEM;return{tp:colorByType};}if(hasMetrics){colorByType=COLOR_BY_TYPE.METRICS;gsi=modelJSON.gsi;this.thresholds=gsi.thresholds;var metricId=gsi.mx[colorByMetricIndex].did,thresholds=this.thresholds&&this.thresholds[metricId],rankMode;if(!thresholds){return{tp:COLOR_BY_TYPE.NULL};}rankMode=$VISUTIL.getRankMode(thresholds);return{tp:colorByType,metrics:templateMetrics,rankMode:rankMode,colorByMetricIndex:colorByMetricIndex,thresholds:thresholds};}}function createHorizontalZeroLine(w,top,dashed){var div=document.createElement("div");div.setAttribute("class","gm-zero-line horizontal");div.style.width=w+"px";div.style.top=top+"px";div.style.left="0px";if(dashed){$CSS.addClass(div,"dashed");}else{$CSS.addClass(div,"nondashed");}return div;}function createVerticalZeroLine(h,left,dashed){var div=document.createElement("div");div.setAttribute("class","gm-zero-line vertical");div.style.height=h+"px";div.style.top="0px";div.style.left=left+"px";if(dashed){$CSS.addClass(div,"dashed");}else{$CSS.addClass(div,"nondashed");}return div;}function hPrepareGraph(iProps){var dataset,theFormatManager,msiChart,chart,dataProvider=iProps.dataProvider,reuseFormatManager=canReuseFormatManager.call(this),isOk,defn=this.defn,gpp=defn.gpp;if(this.ChartFactory===undefined){this.ChartFactory=new $C.MsiChart();this.ChartFactory.setController(this.controller);}msiChart=this.ChartFactory;theFormatManager=this.sharedFormatManager;if(!theFormatManager){theFormatManager=msiChart.createFormatManager(gpp,this.sharedPool);}if(reuseFormatManager){this.sharedFormatManager=theFormatManager;}dataset=msiChart.createDataSet({dataProvider:dataProvider,formatManager:theFormatManager});if(dataset===null){return null;}if(dataset.GetStatus(true)===0){return null;}chart=this.addDisposable(msiChart.createChartFromFormatManager(dataset,theFormatManager,null,this.view.enableCETimer));isOk=chart.IsDataEnough();if(!isOk){return null;}if(this.useCECanvas){chart.setCanvasProps({type:"JSON"});}else{chart.setCanvasProps({type:"SVG",gradPrefix:"gmGrad",mGradientCount:++gradientCount,seriesDrawOrder:dataset.GetSeriesIndexByPriority()});}return chart;}function preprocessGroupInfo(groupInfo){var count=groupInfo?groupInfo.length:0,i,pair,left,leftMetricIndex,right,rightMetricIndex,metricId;var getMetricIndex=function(param){var result,index=-1;if(param&&param.indexOf&&param.indexOf("idx")>=0){result=param.split(":");if(result&&result.length===2){index=parseInt(result[1]);}}return index;};var getMetricIdFromIndex=function(index,isPrimary){var chtInfo=this.getChartInfo(),metric,metricId=null,dz=this.dz,yAxis,xAxis,metricInZone,ax;if(chtInfo.dirc===ABL_DIRECTION.VERTICAL){yAxis=dz.YAxis;metricInZone=yAxis.TemplateMetric;metric=metricInZone&&metricInZone.length>0&&metricInZone[index];if(metric){ax=parseInt(metric.ax,10);if(ax===$SAB.PRIMARY&&isPrimary||ax===$SAB.SECONDARY&&!isPrimary){metricId=metric.id;}}}else{if(chtInfo.dirc===ABL_DIRECTION.HORIZONTAL){xAxis=dz.XAxis;metricInZone=xAxis.TemplateMetric;metric=metricInZone&&metricInZone.length>0&&metricInZone[index];if(metric){ax=parseInt(metric.ax,10);if(ax===$SAB.PRIMARY&&isPrimary||ax===$SAB.SECONDARY&&!isPrimary){metricId=metric.id;}}}}return metricId;};var removeFromGroupInfo=function(groupInfo,pairIndex,isPrimary){var pair=groupInfo[pairIndex],removeIndex=isPrimary?0:1;if(pair[0]===INVALID_METRIC_IDX||pair[1]===INVALID_METRIC_IDX){groupInfo[pairIndex]=undefined;}else{pair[removeIndex]=INVALID_METRIC_IDX;}};for(i=0;i<count;i++){pair=groupInfo[i];left=pair[0];leftMetricIndex=getMetricIndex(left);if(leftMetricIndex>=0){metricId=getMetricIdFromIndex.call(this,leftMetricIndex,true);if(metricId){pair[0]=metricId;}else{removeFromGroupInfo(groupInfo,i,true);}}right=pair[1];rightMetricIndex=getMetricIndex(right);if(rightMetricIndex>=0){metricId=getMetricIdFromIndex.call(this,rightMetricIndex,false);if(metricId){pair[1]=metricId;}else{removeFromGroupInfo(groupInfo,i,false);}}}var processedGroupInfo=[];for(i=0;i<count;i++){if(groupInfo[i]!==undefined){processedGroupInfo.push(groupInfo[i]);}}this.setGroupInfo(processedGroupInfo);return processedGroupInfo;}function createAxisDiv(width,height,labelHeight,axis,isPrimary){var axisDiv=document.createElement("div"),rs=(axis==="x"?height:width)-labelHeight,rw,rh;rs=rs>0?rs:0;rw=axis==="x"?width:rs;rh=axis==="x"?rs:height;axisDiv.style.position="absolute";axisDiv.style.width=rw+"px";axisDiv.style.height=rh+"px";axisDiv.style[AxisStyleProperty[axis][isPrimary?"first":"second"]]="0px";return axisDiv;}mstrmojo.gm.GMController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.gm.GMController",dualAxisEnabled:false,model:undefined,firstRes:undefined,view:undefined,drawer:undefined,manager:undefined,horizontalMode:false,enablePartialRendering:false,chartType:-1,isBlankGrid:false,chartSubType:PRP_SUBTYPE.AUTO,chartDirection:-1,rowHeaderCnt:2,colHeaderCnt:2,splitPlottingMetrics:undefined,inChartLayout:undefined,mWd:0,mHt:0,isEmpty:false,ceChartType:$GT.DssGraphTypeVertical_Line_Absolute,isPercentage:false,isStacked:false,isPie:false,piePartition:undefined,totalRows:undefined,totalStartCols:undefined,useCECanvas:false,maxPadding:undefined,maxRowPadding:undefined,maxColPadding:undefined,axisScale:PRP_AXIS_SCALE.GLOBAL,axisScaleCache:null,freezeChart:freezeChart,markerShape:undefined,ceMarkerShape:undefined,palette:PALLETTE_LIGHT,isLarge:false,metricsType:METRICS_POS.MetricsByColumn,fakeGroupInfo:false,shallWeUseGroupInfo:false,enableCombiChart:false,pureAreaChart:false,globalColorMapping:true,ttlDispTp:undefined,mulAttsOnAxisForABL:false,trendlineDefined:false,clusteredBarSpecialCase:false,init:function(props){this.rhStyles=null;this.chStyles=null;this.xTitleStyles=null;this.yTitleStyles=null;if(this._super){this._super(props);}this.bandings=[];this.chartInstancePool=[];this.yZeroAxisPos=[];this.xZeroAxisPos=[];this.y2ZeroAxisPos=[];this.x2ZeroAxisPos=[];this.disabledUnits=[];this.yMajorGridLinePos=[];this.yMinorGridLinePos=[];this.xMajorGridLinePos=[];this.xMinorGridLinePos=[];this.xAxisTrims=[];this.x2AxisTrims=[];this.yAxisTrims=[];this.y2AxisTrims=[];this.caAxisTrims=[[],[]];this.axisFormats={x1:[],x2:[],y1:[],y2:[]};this.dz=props.firstRes.dz;this.gts=props.firstRes.gts;this.highLightShapeIndex={};this.resetHighLightIndex=true;this.metricsOnDropZone={};this.hasTotal=undefined;this.heightCache=[];this.widthCache=[];},postInit:function(){var model=this.firstRes,xtabModel=this.xtabModel;this.consumeJSON(model);this.getAxisScaleMode();this.setupDualAxis();this.composeCustomString();this.configureTrendLineBubbleForecast(model);if(!model.eg){this.initMaxMinSizeProps();this.initChartingDetails();}if(model){this.disabledUnits=findDisabledUnits(model,xtabModel);}},getMetricInGSIMx:function(metricIndex){var mx=this.firstRes.gsi.mx;return mx[metricIndex];},valueTypeDataLabelEnabled:function(){var visGM=this.view;if(visGM.noData){return false;}var opts=this.getShowDataLabelOptions();return opts.length>0;},isGradientABL:function(){var colorByInfo=this.colorByInfo,chtInfo=this.getChartInfo(),axAttIds,hit=false,clrAtts=[];if(chtInfo.isABL===false){return false;}if(colorByInfo.tp===COLOR_BY_TYPE.ATT){axAttIds=getAttributesOnDropZone.call(this,"YAxis","id");axAttIds=axAttIds.concat(getAttributesOnDropZone.call(this,"XAxis","id"));clrAtts=getAttributesOnDropZone.call(this,"ColorBy","id");$ARR.forEach(clrAtts,function(clrAttId){if(axAttIds.indexOf(clrAttId)>=0){hit=true;return false;}});return hit;}else{if(colorByInfo.tp===COLOR_BY_TYPE.NULL||colorByInfo.tp===COLOR_BY_TYPE.METRICS_ITEM){return false;}}return true;},textTypeDataLabelEnabled:function(){var chtInfo=this.getChartInfo();if(chtInfo.isPie){return this.getUnitsCountInSliceBy()>0;}return this.getBreakByAttributes().length>0;},checkAttributeIntersection:function(selectionRule,zoneIds){var dz=this.dz,zone,units,unitIds,mSelectionRule=$HASH.clone(selectionRule||{}),intersectionUnitIds=[],model=this.view.model,hasLinkAttr=!!model.docModel.als;if(this.view.interactor.fmtMode||this.view.interactor.fmtFake){return["mockid"];}$ARR.forEach(zoneIds||[],function(zoneId){zone=dz[zoneId];units=zone.TemplateUnit;$ARR.forEach(units||[],function(unit){unitIds=[unit.id];if(hasLinkAttr){unitIds=unitIds.concat(model.getLinkedAttributes(unit.id)||[]);}$ARR.forEach(unitIds,function(unitId){if(mSelectionRule.hasOwnProperty(unitId)){intersectionUnitIds.push(unitId);delete mSelectionRule[unitId];return false;}});});});return intersectionUnitIds;},isSeasonalityEnabled:function(){var me=this,chtInfo=this.getChartInfo(),sea=false,xtabModel=this.xtabModel,unt,untInTp;if(chtInfo.isABL){var ids=getAttributesOnDropZone.call(this,"YAxis","id");ids=ids.concat(getAttributesOnDropZone.call(this,"XAxis","id"));ids.forEach(function(attId){unt=getUnitInDataSet(xtabModel,attId);untInTp=me.getAttributeById(attId);if(unt&&untInTp){var fs=unt.fs,fsInTp=untInTp.fs;$ARR.forEach(fs,function(fm){if((fm.bftp===1||fm.bftp===8)&&$ARR.find(fsInTp,"id",fm.fid)!==-1){sea=true;}});}});if(sea){var seaApplicable=false,trConfigPool=this.trConfigPool;$HASH.forEach(trConfigPool,function(v){var trdMdTp=v[ENUM_XML_TAG.TREND_TYPE];if(trdMdTp){seaApplicable=seaApplicable||(trdMdTp!==EnumTrendLineModelType.LOG&&trdMdTp!==EnumTrendLineModelType.POW);}});if(!seaApplicable){sea=false;}}}return sea;},getGlobalExtremeForAxisOrMetric:function(hostName,sizeByOnly,ignoreCustom){return getGlobalExtremeForAxisOrMetric.call(this,hostName,sizeByOnly,ignoreCustom);},getAttributeById:function(id){var i,gts=this.gts,row=gts.row,col=gts.col,nRow=row.length,nCol=col.length;for(i=0;i<nRow;i++){if(row[i].id===id){return row[i];}}for(i=0;i<nCol;i++){if(col[i].id===id){return col[i];}}return null;},initMaxMinSizeProps:function(){var gm=this.view,maxSizeType=gm.getWidgetPropertyValue(ENUM_XML_TAG.MAX_SIZE_TYPE),maxSizeValue=gm.getWidgetPropertyValue(ENUM_XML_TAG.MAX_SIZE_VALUE),minSizeType=gm.getWidgetPropertyValue(ENUM_XML_TAG.MIN_SIZE_TYPE),minSizeValue=gm.getWidgetPropertyValue(ENUM_XML_TAG.MIN_SIZE_VALUE),translateMaxType4CE=function(type){if(type===PRP_MAX_SIZE_TYPE.MANUAL){return 2;}return 0;},translateMinType4CE=function(type){if(type===PRP_MIN_SIZE_TYPE.MANUAL){return 2;}if(type===PRP_MIN_SIZE_TYPE.PROPORTIONAL){return 1;}return 0;};this.sizeInfo=this.sizeInfo||{};var sizeInfo=this.sizeInfo;sizeInfo.Max={Mode:translateMaxType4CE(maxSizeType),Size:maxSizeValue};sizeInfo.Min={Mode:translateMinType4CE(minSizeType),Size:minSizeValue};sizeInfo.ProportionalMinMax=minSizeType===PRP_MIN_SIZE_TYPE.MANUAL;},initChartingDetails:function(){var dm=this.model,iLdsIdx=this.mapFromChartToLDSIndex(0,0),lds=dm.getLocalDataSet(iLdsIdx.r,iLdsIdx.c),dps=lds.generateDataProvider(),dp=dps[iLdsIdx.dpIdx];this.chartingDetails={nSeries:dp.innerGetSeriesCount()};},getAxisModeForAxis:function(r,c,axisName,isPrimary){var mtxArr=this.getMetricsOnAxisOfChart(r,c,axisName,isPrimary);if(mtxArr&&mtxArr[0]!==undefined){var dropZone;if(axisName==="x"||axisName==="y"){dropZone=axisName.toUpperCase()+(isPrimary?"":"2")+"Axis";}else{dropZone="SizeBy";}return getAxisScaleModeForSingleMetric.call(this,mtxArr[0],dropZone);}return undefined;},isPerCellScaleOn:function(r,c,axisKey){var axisName,scale,isPrimary;if(axisKey==="y"||axisKey==="y1"){axisName="y";isPrimary=true;}else{if(axisKey==="y2"){axisName="y";isPrimary=false;}else{if(axisKey==="x"||axisKey==="x1"){axisName="x";isPrimary=true;}else{axisName="x";isPrimary=false;}}}scale=this.getAxisModeForAxis(r,c,axisName,isPrimary);return scale===PRP_AXIS_SCALE.PERCELL;},composeCustomString:function(){var me=this,gmProperty=this.property,minMax=gmProperty.readItem(ENUM_XML_TAG.AXIS_SCALE),oldAxisScaleData=gmProperty.readItem(ENUM_XML_TAG.AXIS_SCALE_DATA),szmInAxis=[],collisionSizeByMetric=[],opt=this.getNumericAxisOptions(true,undefined,undefined,szmInAxis,collisionSizeByMetric),axScaleCollection={},oldAxScaleCollection={},ex,axObj,chtInfo=me.getChartInfo(),hostName,props,key,newAxObj,oldAxObj,newAxString,oldAxString,sizeByOnlyHosts=[];opt.forEach(function(o){hostName=o.key;if(hostName!=="AllMetrics"){if(o.sizeBy||o.key==="SizeBy"){sizeByOnlyHosts.push(hostName);}ex=me.getGlobalExtremeForAxisOrMetric(hostName,o.sizeBy,true);if(chtInfo.isABL){ex=correctExtremeForABL.call(me,ex,getShapesForAxisName.call(me,hostName));}if(ex.scaleType===undefined||isNaN(ex.scaleType)){ex.scaleType=PRP_AXIS_SCALE.GLOBAL;}props={axKey:hostName,rMin:ex.min,rMax:ex.max,minMax:minMax,logScale:false,isCust:false,scaleType:ex.scaleType};axObj=new AS(props);axScaleCollection[hostName]=axObj;}});if(oldAxisScaleData){oldAxScaleCollection=AS.createAxisScaleCollectionFromArrays(oldAxisScaleData,oldAxScaleCollection);oldAxString=AS.serializeCollection2String(oldAxScaleCollection);for(key in axScaleCollection){if(axScaleCollection.hasOwnProperty(key)){newAxObj=axScaleCollection[key];oldAxObj=oldAxScaleCollection[key];if(oldAxObj){if(minMax===PRP_AXIS_SCALE.CUSTOM){newAxObj.absorbInfo(oldAxObj);}else{newAxObj.logScale=oldAxObj.logScale===true;}if(sizeByOnlyHosts.indexOf(key)>=0){newAxObj.logScale=false;}}}}}this.sizeByMetricsSharedInAxis=szmInAxis;this.collisionSizeByMetric=collisionSizeByMetric;newAxString=AS.serializeCollection2String(axScaleCollection);if(oldAxString!==newAxString){gmProperty.updateItem(ENUM_XML_TAG.AXIS_SCALE_DATA,newAxString);}},getBreakByAttributes:function(){return getAttributesOnDropZone.call(this,"BreakBy");},getSliceByAttributes:function(){return getAttributesOnDropZone.call(this,"SliceBy");},isMetricNamesInZone:function(zoneName){return isMetricNamesInZone.call(this,zoneName);},isAttrInZone:function(attrId,zoneName){var ids=[],attrsOnZone=getAttributesOnDropZone.call(this,zoneName);attrsOnZone.forEach(function(e){if(e.id){ids.push(e.id);}});return ids.indexOf(attrId)!==-1;},getSelectedObjectsInfo:function(selectedShapes,includeMetrics){var selObjsInfo=[],identity;$ARR.forEach(selectedShapes,function(shape){identity=shape.identity;selObjsInfo.push(identity.getSelectedObjectInfo(includeMetrics));});return selObjsInfo;},isEmptyBreakby:function(){var struct=this.getHostStructure(),nBreakBy=struct.BreakBy.length;return nBreakBy;},isEmptyVis:function(){var struct=this.getHostStructure(),isPie=this.isPie,nRows=struct.Rows.length,nCols=struct.Columns.length,nXAxis=struct.XAxis.length,nYAxis=struct.YAxis.length,nSliceBy=struct.SliceBy.length,nAngleBy=struct.AngleBy.length;if(isPie&&this.getChartType()===CHART_TYPE.GRID){return this.isBlankGrid;}if(nRows>0||nCols>0||nXAxis>0||nYAxis>0){return false;}if(isPie){if(nSliceBy>0||nAngleBy>0){return false;}}return true;},getHostStructure:function(){var i,arr,zName,zData,dz=this.dz||this.firstRes.dz,zoneNames=["Rows","Columns","XAxis","YAxis","BreakBy","SliceBy","ColorBy","SizeBy","AdditionalMetrics","AngleBy"],nZones=zoneNames.length,hostStruct={},gts=this.gts,me=this,data=me.xtabModel.data,gsi=data.gsi||{},attributes=(gsi.rows||[]).concat(gsi.cols||[]),stHash={},getUnitItem=function(unit){if(unit.srcUnit){unit=unit.srcUnit;if(arr.filter(function(elem){return unit.id===elem.id;}).length>0){return ;}}var item=$HASH.copy(unit,{zone:i+1});var uInGts;if(unit.t!==4){if(unit.axis!==undefined&&unit.uidx!==undefined){uInGts=gts[unit.axis][unit.uidx];}}var unt=getUnitInDataSet(me.xtabModel,unit.id);if(unt&&unt.fs){item.fs=unt.fs;}if(stHash[unit.id]){item.st=stHash[unit.id];}if(uInGts){item.at=uInGts.at;}arr.push(item);};attributes.forEach(function(a){if(a.hasOwnProperty("st")&&a.hasOwnProperty("did")){stHash[a.did]=a.st;}});for(i=0;i<nZones;i++){zName=zoneNames[i];zData=dz[zName]||dz.Angle;arr=hostStruct[zName]=[];if(zData.TemplateUnit){$ARR.forEach(zData.TemplateUnit,getUnitItem);}if(zData.TemplateMetric){$ARR.forEach(zData.TemplateMetric,getUnitItem);}if(zData.MetricNames!==undefined){arr.push({n:"Metric Names",id:METRIC_NAMES_ID,t:METRIC_NAMES_UNIT_TYPE,zone:i+1});}}return hostStruct;},updatePalette:function(newTheme){if(newTheme===THEME.DARK){this.palette=PALLETTE_DARK;}else{this.palette=PALLETTE_LIGHT;}},initYAxisMargins:function(){var i,chtRowCnt=this.getChartCountInCol(),ymgs=this.yAxisMargins=[];for(i=0;i<chtRowCnt;i++){ymgs.push(-1);}},initXAxisMargins:function(){var i,chtColCnt=this.getChartCountInRow(),xmgs=this.xAxisMargins=[];for(i=0;i<chtColCnt;i++){xmgs.push(-1);}},formatChartInstancePool:function(){var i,chtRowCnt,pool=this.chartInstancePool;chtRowCnt=this.getChartCountInCol();for(i=0;i<chtRowCnt;i++){pool[i]=[];}},configureTrendLine:function(data){var mx=data.gsi.mx,chtInfo=this.getChartInfo(),me=this,mdls,modc,mid,trdDef={},isBubble=false,refDef={},gTrend,modix;if(chtInfo.tp===CHART_TYPE.GRID){return ;}if(chtInfo.isABL){trdDef={globalProp:{trdFwdFst:0,trdBwdFst:0,trdFstEnabled:false,trdSeason:data.dz.sea!==undefined?parseInt(data.dz.sea,10):0}};}else{trdDef={};if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){isBubble=true;}}gTrend=trdDef.globalProp;$ARR.forEach(mx,function(m){mid=m.did;trdDef[mid]={min:m.min,max:m.max};if(m.foreBwd!==undefined||m.foreFwd!==undefined){trdDef[mid].trdBwdFst=m.foreBwd;trdDef[mid].trdFwdFst=m.foreFwd;if(!isBubble){gTrend.trdFstEnabled=gTrend.trdFstEnabled||m.fstEnabled!==false;}}mdls=m.mdls;if(mdls){if(chtInfo.isABL){gTrend.trdFwdFst=gTrend.trdFwdFst<m.foreFwd?m.foreFwd:gTrend.trdFwdFst;gTrend.trdBwdFst=gTrend.trdBwdFst<m.foreBwd?m.foreBwd:gTrend.trdBwdFst;}modc=mdls.mod_c;modix=1;$ARR.forEach(modc,function(lnM){if(lnM.tp>=$REF_TYPE.MAX&&lnM.tp<=$REF_TYPE.CONST){fillRefLineConfig.call(me,refDef,lnM,mid,modix);}else{fillTrendLineConfig.call(me,trdDef,lnM,mid,modix);}modix++;});}});if(chtInfo.isABL&&this.isStacked&&!this.splitPlottingMetrics){var prefixAxis=chtInfo.dirc===ABL_DIRECTION.VERTICAL?"Y":"X",axisName=prefixAxis+"Axis",axis=data.dz[axisName];mdls=axis.mdls;if(mdls){modc=mdls.mod_c;modix=1;$ARR.forEach(modc,function(lnM){if(lnM.tp>=$REF_TYPE.MAX&&lnM.tp<=$REF_TYPE.CONST){var keyAxisName=lnM.dua===0?axisName:prefixAxis+"2Axis";fillRefLineConfig.call(me,refDef,lnM,keyAxisName,modix);}else{$VISUTIL.visPrint("No way entering this branch");fillTrendLineConfig.call(me,trdDef,lnM,mid,modix);}modix++;});}}this.trConfigPool=trdDef;this[ENUM_XML_TAG.REF_LINE_DEF]=refDef;},hasRefLineInOppositeAxis:function(dua){var dz=this.dz||this.firstRes.dz,chtInfo=this.getChartInfo(),existing=false;if(chtInfo.isABL&&this.isStacked&&!this.splitPlottingMetrics){var prefixAxis=chtInfo.dirc===ABL_DIRECTION.HORIZONTAL?"Y":"X",axisName=prefixAxis+"Axis",axis=dz[axisName],mdls,modc;mdls=axis.mdls;if(mdls){modc=mdls.mod_c;$ARR.forEach(modc,function(lnM){if(lnM.tp>=$REF_TYPE.MAX&&lnM.tp<=$REF_TYPE.CONST){if(lnM.dua===dua){existing=true;return false;}}});}}return existing;},getBubbleForcastExtremeForPieWithTotal:function(metric){var i,j,m,n,totalIdx,mcnt=this.model.getMetricCount(),midx=this.getMetricIndexFromID(metric.did),totalRows=this.totalRows||[],totalLen=totalRows.length,data=this.firstRes.gvs.items,cols,value,min,max;n=data.length;for(i=0;i<totalLen;i++){totalIdx=totalRows[i];if(totalIdx<n){cols=data[totalIdx].items||[];j=midx;m=cols.length;while(j<m){value=cols[j];if(value!==undefined){value=parseFloat(value.rv);if(!isNaN(value)){if(min===undefined||min>value){min=value;}if(max===undefined||max<value){max=value;}}}j+=mcnt;}}}if(min!==undefined){return{min:min,max:max};}return{min:metric.min,max:metric.max};},configureTrendLineBubbleForecast:function(data){var mx=data.gsi.mx,chtInfo=this.getChartInfo(),me=this,mid,bbForeMtxDef,bbForeExtreme,bubbleForecastDef={},isBubble=false,useTotalForPie=false;if(chtInfo.tp===CHART_TYPE.GRID){return ;}if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){isBubble=true;}if(this.isPie&&this.hasTotalForPie()){useTotalForPie=true;}$ARR.forEach(mx,function(m){mid=m.did;if(isBubble){if(useTotalForPie){bbForeExtreme=me.getBubbleForcastExtremeForPieWithTotal(m);}else{bbForeExtreme={min:m.min,max:m.max};}bbForeMtxDef={min:bbForeExtreme.min,max:bbForeExtreme.max};bubbleForecastDef[mid]=bbForeMtxDef;bbForeMtxDef[ENUM_XML_TAG.TREND_BUBBLE_FORE_FWD]=bbForeMtxDef[ENUM_XML_TAG.TREND_BUBBLE_MAX]=bbForeExtreme.max;bbForeMtxDef[ENUM_XML_TAG.TREND_BUBBLE_FORE_BWD]=bbForeMtxDef[ENUM_XML_TAG.TREND_BUBBLE_MIN]=bbForeExtreme.min;if(m.foreBwd!==undefined||m.foreFwd!==undefined){bbForeMtxDef[ENUM_XML_TAG.TREND_BUBBLE_FORE_FWD]=m.foreFwd;bbForeMtxDef[ENUM_XML_TAG.TREND_BUBBLE_FORE_BWD]=m.foreBwd;bbForeMtxDef[ENUM_XML_TAG.TREND_BUBBLE_FORE_ENABLED]=m.fstEnabled!==false;}}});this[ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF]=bubbleForecastDef;},getTrendLineJSON:function(modelJSON){return modelJSON.trendref;},getTrendLineObjectsForMetricAtScale:function(midx,chartRowIndex,chartColIndex,overMetricId,isTrendLine,scale){var tlJSon=this.trendLineJSON,modelArray=tlJSon[scale],xVarArr,tlm,isTr,resModelArr=[];if(modelArray){$ARR.forEach(modelArray,function(item){tlm=undefined;xVarArr=item["x-vars"];if(item.mid===midx&&(overMetricId===undefined||(xVarArr&&xVarArr[0]===overMetricId))){tlm=$HASH.copy(item,{});if(scale==="g"){tlm.inChartModel=tlm.models;}else{if(scale==="all"){tlm.inChartModel=tlm.models[chartRowIndex][chartColIndex];}else{if(scale==="r"){tlm.inChartModel=tlm.models[chartRowIndex];}else{tlm.inChartModel=tlm.models[chartColIndex];}}}delete tlm.models;}if(tlm){isTr=isNaN(tlm.inChartModel[0].model);if((isTr===true&&isTrendLine===true)||(!isTr&&!isTrendLine)){resModelArr.push(tlm);}}});}return resModelArr;},getTrendLinesObjectForMetric:function(midx,chartRowIndex,chartColIndex,overMetricId,isTrendLine){var me=this,scales=["g","all","r","c"],resModelArr=[];scales.forEach(function(scale){resModelArr=resModelArr.concat(me.getTrendLineObjectsForMetricAtScale(midx,chartRowIndex,chartColIndex,overMetricId,isTrendLine,scale));});return resModelArr;},isLogScale:function(axisName,rowIndex,colIndex){var gmCtr=this,visGM=gmCtr.view,axisOption,chtInfo=gmCtr.getChartInfo(),logScaleCache;if(chtInfo.isABL&&chtInfo.sbtp===$GM.EnumSubtype.PERCENT){return false;}if(gmCtr.logScaleCache===undefined){gmCtr.logScaleCache=[{},{}];}var oneCacheEntry,isVertical=axisName[0]==="y"||axisName[0]==="Y",isPrimary=axisName==="y"||axisName==="Y"||axisName==="y1"||axisName==="Y1"||axisName==="x"||axisName==="X"||axisName==="x1"||axisName==="X1";logScaleCache=gmCtr.logScaleCache[isVertical?1:0];if(isVertical){oneCacheEntry=logScaleCache[rowIndex]=logScaleCache[rowIndex]||{};}else{oneCacheEntry=logScaleCache[colIndex]=logScaleCache[colIndex]||{};}if(isPrimary){if(oneCacheEntry.Primary!==undefined){return oneCacheEntry.Primary;}}else{if(oneCacheEntry.Secondary!==undefined){return oneCacheEntry.Secondary;}}var fullAxisName;if(isVertical){if(isPrimary){fullAxisName="YAxis";}else{fullAxisName="Y2Axis";}}else{if(isPrimary){fullAxisName="XAxis";}else{fullAxisName="X2Axis";}}var metricOnAxis=getMetricsOnCurrentAxis.call(this,rowIndex,colIndex,fullAxisName);if(metricOnAxis&&metricOnAxis.length>0){axisOption=getOptionObjArr.call(gmCtr,metricOnAxis,axisName,false);}if(!axisOption||axisOption.length===0){return undefined;}var axScaleDataArr,scaleForAxis,axScaleCollection;axScaleDataArr=visGM.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE_DATA);axScaleCollection=AS.createAxisScaleCollectionFromArrays(axScaleDataArr);scaleForAxis=axScaleCollection[axisOption.key];if(scaleForAxis){if(isPrimary){oneCacheEntry.Primary=scaleForAxis.logScale;}else{oneCacheEntry.Secondary=scaleForAxis.logScale;}return scaleForAxis.logScale;}return false;},checkDataLabelType:function(){var dl=this.property.readItem(ENUM_XML_TAG.DATA_LABEL);if(dl===undefined||((dl===2)&&!this.valueTypeDataLabelEnabled())||(dl===3&&!this.textTypeDataLabelEnabled())){this.property.updateItem(ENUM_XML_TAG.DATA_LABEL,1);}this.checkMetricLevelDataLabel();},checkMetricLevelDataLabel:function(){var dl=this.property.readItem(ENUM_XML_TAG.DATA_LABEL),opts=this.getShowDataLabelOptions(),mldl,key;if(dl===2&&opts.length===1){mldl=this.property.readItem(ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL);if(mldl){key=opts[0].key;if(mldl[key]===false){mldl[key]=true;this.property.updateItem(ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL,mldl);}}}},consumeJSON:function(modelJSON){var rp,cp,rct,cct,vls,dm,scM,colorByInfo,me=this,json=modelJSON;resetController.call(this);var themeInJson=this.view.model.data.dz.visProp.fmt.th;if(themeInJson!==undefined&&themeInJson!==null){if(typeof themeInJson==="number"){this.view.theme=themeInJson;}else{if(typeof themeInJson==="string"){this.view.theme=parseInt(themeInJson,10);}}}var dz=modelJSON.dz,fmt=dz.visProp.fmt;me.trendLineJSON=this.getTrendLineJSON(modelJSON);me.ttlDispTp=modelJSON.lnm;me.fmt=fmt;me.extrs=modelJSON.extrs;var gts=modelJSON.gts;me.th=[];$ARR.forEach(gts.row,function(u){restoreEsForUnit(u);var _unit=getUnitInDataSet(me.xtabModel,u.id);if(_unit&&_unit.t){u.t=_unit.t;}if(u.cs===undefined){u.cs=1;}});$ARR.forEach(gts.col,function(u){restoreEsForUnit(u);var _unit=getUnitInDataSet(me.xtabModel,u.id);if(_unit&&_unit.t){u.t=_unit.t;}if(u.rs===undefined){if(u.opt!==-1){u.rs=1;}}});updateDropzoneInfo(dz,modelJSON);pickUpNumberFormats(modelJSON);evaluateHeaderSize.call(this,modelJSON);rct=json.dm.rct;cct=json.dm.cct;rp=json.ptt.row;cp=json.ptt.col;evaluateChartTypes.call(this,modelJSON);colorByInfo=getColorByType.call(this,dz,modelJSON);if(colorByInfo.tp===COLOR_BY_TYPE.METRICS){var cmxId=colorByInfo.metrics[0].id;me.thresholds=modelJSON.gsi.thresholds[cmxId];}me.colorByInfo=colorByInfo;me.metricsType=getMetricsByType.call(this,dz);evaluateSpecialCases.call(this,modelJSON,this.ceChartType);me.configureTrendLine(modelJSON);if(json.gvs.items){vls=cutGVS(0,0,cct,rct,json.gvs);}this.model=this.addDisposable(new $GM.GMDataModel({ttlDispTp:this.ttlDispTp,eg:json.eg,rp:rp,cp:cp,rct:rct,cct:cct,gts:json.gts,fullNf:json.nf,mx:json.gsi.mx,dz:dz,trConfigPool:this.trConfigPool,clusteredBarSpecialCase:this.clusteredBarSpecialCase,onlyMetricNamesOnAxisForGridPie:this.onlyMetricNamesOnAxisForGridPie,isMetricNamesOnXAxis:this.isMetricNamesOnXAxis,colorType:colorByInfo.tp,gmCtr:this,metricsType:this.metricsType,splitPlottingMetrics:this.getSplitPlottingMetrics(),getMetricsOnXAxis:this.getControllerAPI(DRAWING_API.GET_METRICS_ON_X),getMetricsOnYAxis:this.getControllerAPI(DRAWING_API.GET_METRICS_ON_Y),getSizeByMetrics:this.getControllerAPI(DRAWING_API.GET_METRICS_ON_SIZE_BY),property:this.property,isBlankGrid:this.isBlankGrid}));dm=this.model;var chtInfo=this.getChartInfo();if(chtInfo.isABL&&this.getSplitPlottingMetrics()){scM=this.getSecondaryMetrics();if(scM.length>0){this.shallWeUseGroupInfo=true;}}dm.shallWeUseGroupInfo=this.shallWeUseGroupInfo;me.shouldDrawShapeFlag=shouldDrawShape(dz,chtInfo);if(!this.shallWeUseGroupInfo){this.removeGroupInfo();}else{this.updateGroupInfo();}if(json.gvs.items){dm.feedLdss(0,0,cct,rct,vls);}if(json.ghs.chs.items){dm.feedChs(json.ghs.chs);}if(json.ghs.rhs.items){dm.feedRhs(json.ghs.rhs);}if(dm.cetSelectors){this.view.cetSelectors=dm.cetSelectors;delete dm.cetSelectors;}dm.extractInfoLowestHeaderInfoToAttrObj();dm.constructColorByInfo();this.inChartLayout=this.getSubChartsLayout();if(this.isPie){this.preprocessForPie(modelJSON);}var rhInfo=this.getRowTitleInfo(true),chInfo=this.getColTitleInfo(true),attributeSelectionInfo=this.attributeSelectionInfo;if(rhInfo&&rhInfo.items){$ARR.forEach(rhInfo.items,function(att){attributeSelectionInfo[att.id]=att;});}if(chInfo&&chInfo.items){$ARR.forEach(chInfo.items,function(att){attributeSelectionInfo[att.id]=att;});}var yInfo=this.getYAxisInfo(),xInfo=this.getXAxisInfo();this.xIsNumeric=xInfo.isMetric;this.yIsNumeric=yInfo.isMetric;this.axisLayout=this.getAxisLayout4CE();this.enablePartialRendering=this.view.getWidgetPropertyValue(ENUM_XML_TAG.PARTIAL_RENDER)==="true";if(chtInfo.isBubbleOrScatter&&(this.metricsType!==METRICS_POS.MetricsByRow&&this.metricsType!==METRICS_POS.MetricsByColumn)){var metricOnX=this.getMetricsOnXAxis(),metricOnY=this.getMetricsOnYAxis(),sizeByMetricsIndex=this.getSizeByMetrics(),bubbleSeriesNum=Math.min(metricOnX.length,metricOnY.length);if(sizeByMetricsIndex.length>0){bubbleSeriesNum=Math.min(bubbleSeriesNum,sizeByMetricsIndex.length);}this.bubbleSeriesNum=bubbleSeriesNum;}if(chtInfo.isABL){var yAtts=getAttributesOnDropZone.call(this,"YAxis","n"),xAtts=getAttributesOnDropZone.call(this,"XAxis","n"),bbAtts=getAttributesOnDropZone.call(this,"BreakBy","n");if(yAtts.length+xAtts.length===0&&bbAtts.length>0){this.specialSortable=true;}}},getAxisOriginLineIdentity:function(whichAxis){var key=whichAxis+"axOrLnId";if(this[key]){return this[key];}var iden,xAxis=["x1","x2"],objType=xAxis.indexOf(whichAxis)!==-1?IDENTITY_TYPE.X_AXIS_ORIGIN_LINE:IDENTITY_TYPE.Y_AXIS_ORIGIN_LINE;iden=new mstrmojo.gm.GeneralIdentity({objType:objType});this[key]=iden;return iden;},getAxisOriginLabelIdentity:function(whichAxis){var key=whichAxis+"axOrLbId";if(this[key]){return this[key];}var iden,xAxis=["x1","x2"],objType=xAxis.indexOf(whichAxis)!==-1?IDENTITY_TYPE.X_AXIS_ORIGIN_LABEL:IDENTITY_TYPE.Y_AXIS_ORIGIN_LABEL;iden=new mstrmojo.gm.GeneralIdentity({objType:objType});this[key]=iden;return iden;},getAllAxisProperties:function(){var visGM=this.view;return visGM.getAllAxisProperties();},printExtremes:function(){var me=this,i,j,dp,chtRowCnt,chtColCnt,extremes;chtRowCnt=me.getChartCountInCol();chtColCnt=me.getChartCountInRow();for(i=0;i<chtRowCnt;i++){for(j=0;j<chtColCnt;j++){dp=getDP.call(this,i,j);extremes=getMinMaxForDP.call(me,i,j);$VISUTIL.visPrint("("+i+", "+j+")"+JSON.stringify(extremes));}}},getGraphShapeCount:function(approximate){var me=this,i,j,dp,res=0,sCnt=0,gCnt=0,chtRowCnt,chtColCnt;approximate=approximate||false;chtRowCnt=me.getChartCountInCol();chtColCnt=me.getChartCountInRow();for(i=0;i<chtRowCnt;i++){for(j=0;j<chtColCnt;j++){dp=getDP.call(this,i,j);sCnt=dp.innerGetSeriesCount();gCnt=dp.innerGetGroupCount();if(approximate&&sCnt>0&&gCnt>0){return chtRowCnt*chtColCnt*sCnt*gCnt;}res+=sCnt*gCnt;}}return res;},getColorByMetricExtremes:function(){return getMinMaxForColorByMetric.call(this);},getCategoricalAxisLabelsInfo:function(rowIdx,colIdx,axis,purpose){purpose=purpose||{purpose:"content"};var isEmpty=false,s=0,g=0,dp,scnt,gcnt,gcntWithForcast,lbs=[],gc,eGT=CHART_TYPE,chtInfo=this.getChartInfo();if(chtInfo.isABL&&chtInfo.dirc===ABL_DIRECTION.VERTICAL&&axis==="y"){isEmpty=true;}else{if(chtInfo.isABL&&chtInfo.dirc===ABL_DIRECTION.HORIZONTAL&&axis==="x"){isEmpty=true;}else{dp=getDP.call(this,rowIdx,colIdx);scnt=dp.innerGetSeriesCount();gcnt=dp.innerGetGroupCount();gcntWithForcast=dp.getGroupCount();isEmpty=(scnt===0||gcnt===0);}}if(isEmpty){switch(purpose.purpose){case"count":return 0;default:return lbs;}}if(chtInfo.tp===eGT.GRID){switch(purpose.purpose){case"count":return axis==="x"?gcnt:scnt;default:if(axis==="x"){for(g=0;g<gcnt;g++){gc=dp.getGraphCell(s,g);lbs.push(gc.getGroupLabel(0).join(" "));}}else{for(s=0;s<scnt;s++){gc=dp.getGraphCell(s,g);lbs.push(gc.getSeriesLabel(0).join(" "));}}return lbs;}}switch(purpose.purpose){case"count":var total=0;if(gcntWithForcast===gcnt){for(g=0;g<gcnt;g++){gc=dp.innerGetGraphCell(s,g);if(!gc.isFaked){total++;}}}else{total=gcntWithForcast;}return total;default:if(gcntWithForcast===gcnt){for(g=0;g<gcnt;g++){gc=dp.innerGetGraphCell(s,g);if(!gc.isFaked){lbs.push(gc.getGroupLabel(0).join(" "));}}}else{var bwdLbs=dp.bwdLbs||[],bwdLen=bwdLbs.length,fwdLbs=dp.fwdLbs||[],singleLl,fwdLbFromJSON;for(g=0;g<gcntWithForcast;g++){if(g<bwdLen){singleLl=(bwdLbs[g]).join(" ");}else{if(g>=bwdLen+gcnt){fwdLbFromJSON=fwdLbs[g-(bwdLen+gcnt)];if(fwdLbFromJSON){singleLl=fwdLbFromJSON.join(" ");}else{singleLl="";}}else{gc=dp.innerGetGraphCell(s,g-bwdLen);singleLl=gc.getGroupLabel(0).join(" ");}}lbs.push(singleLl);}}return lbs;}},getColorByLegendInfo:function(){var model=this.model;return model.getColorByLegendInfo();},getSizeByLegendInfo:function(){return this.getAdaptedSizeByDataProvider();},constructSizebyDataProvider:function(){return constructSizebyDataProvider.call(this);},getSizeByExtremeForNegativeProportionalMode:function(sbMidx){var i,j,m,n,cols,value,rawValue,min,rawMin,max,rawMax,mcnt=this.model.getMetricCount(),data=this.firstRes.gvs.items;n=data.length;for(i=0;i<n;i++){cols=data[i].items||[];j=sbMidx;m=cols.length;while(j<m){rawValue=cols[j];if(rawValue!==undefined){rawValue=parseFloat(rawValue.rv);if(!isNaN(rawValue)){value=Math.abs(rawValue);if(min===undefined||min>value){min=value;rawMin=rawValue;}if(max===undefined||max<value){max=value;rawMax=rawValue;}}}j+=mcnt;}}return{min:rawMin,max:rawMax};},getAdaptedSizeByDataProvider:function(){var flexSZB=this.constructSizebyDataProvider(),elements,res={},SIZE_BY_TITLE=mstrmojo.desc(13966,"Size by:"),itemsLength,items=[];if(!flexSZB.sizeByTitles||flexSZB.sizeByTitles.length<=0){return null;}res.custMetrics=flexSZB.sizeByScaleType;itemsLength=flexSZB.sizeByTitles.length;$ARR.forEach(flexSZB.sizeByTitles,function(tt){items.push(tt);});if(itemsLength>1){res.items=items;}if(flexSZB.sizeByMode===true&&flexSZB.sizeByDataProvider.length>1){res.item=itemsLength>1?SIZE_BY_TITLE:flexSZB.sizeByTitles[0];elements=res.elements=[];$ARR.forEach(flexSZB.sizeByDataProvider,function(szByObj){elements.push({sign:"<",v:szByObj.value});});if(elements.length===5){elements[0].sign="=";elements[4].sign="=";}res.caseFlag=0;return res;}if(flexSZB.sizeByMode===true&&flexSZB.sizeByDataProvider.length===1){res.caseFlag=2;res.item=itemsLength>1?SIZE_BY_TITLE:flexSZB.sizeByTitles[0];res.elements=[{diameter:12,shape:"rect",sign:"=",v:flexSZB.sizeByDataProvider[0].value}];return res;}res.item=SIZE_BY_TITLE;res.items=items;res.elements=[];res.caseFlag=1;return res;},getXAxisLabels:function(colIdx){var rowIdx=0;return this.getCategoricalAxisLabelsInfo(rowIdx,colIdx,"x");},getYAxisLabels:function(rowIdx){var colIdx=0;return this.getCategoricalAxisLabelsInfo(rowIdx,colIdx,"y");},countXAxisLabels:function(colIdx){var rowIdx=0;return this.getCategoricalAxisLabelsInfo(rowIdx,colIdx,"x",{purpose:"count"});},countYAxisLabels:function(rowIdx){var colIdx=0;return this.getCategoricalAxisLabelsInfo(rowIdx,colIdx,"y",{purpose:"count"});},estimateXAxisSize:function(labels,rotate,totalWidth){var i,size,n=labels.length,maxWidth=0,maxHeight=0,axisWidth=20,axisHeight=20,styles=this.view.HTML5PROPS.AXIS_LABEL_X;for(i=0;i<n;i++){size=$VISUTIL.measureTextSize(labels[i],styles,0);maxWidth=Math.max(maxWidth,size.width);maxHeight=Math.max(maxHeight,size.height);}if(rotate===XLABEL_STAT.STAGGER){axisWidth=(maxWidth+LABEL_PADDING)*((n+1)>>1)+LABEL_PADDING;axisHeight=maxHeight*2+LABEL_PADDING*3;}else{if(rotate===XLABEL_STAT.ROTATE){axisWidth=maxHeight*n+LABEL_PADDING*(n+1);axisHeight=maxWidth+LABEL_PADDING*2;}else{axisWidth=maxWidth*n+LABEL_PADDING*(n+1);axisHeight=maxHeight+LABEL_PADDING*2;}}if(totalWidth&&!rotate&&axisWidth>totalWidth){axisWidth=totalWidth;}if(axisWidth<n*5){axisWidth=n*5;}return{width:axisWidth,height:axisHeight};},estimateYAxisSize:function(labels){var i,size,axisWidth,axisHeight,n=labels.length,maxWidth=0,maxHeight=0,styles=this.view.HTML5PROPS.AXIS_LABEL_Y,fakedLabel="H",fakedHeight,useFakedHeight=true;for(i=0;i<n;i++){size=$VISUTIL.measureTextSize(labels[i],styles,0);maxWidth=Math.max(maxWidth,size.width);if(useFakedHeight){if(fakedHeight===undefined){fakedHeight=$VISUTIL.measureTextSize(fakedLabel,styles,1).height;fakedHeight=Math.round(fakedHeight*0.85);}maxHeight=fakedHeight;}else{maxHeight=Math.max(maxHeight,size.height);}}axisWidth=maxWidth+LABEL_PADDING*2;axisHeight=maxHeight*n+LABEL_PADDING*(2*n);return{width:axisWidth,height:axisHeight};},initLayouter:function(layouter){var widthRatio,heightRatio,me=this,fitTo=this.view.getWidgetPropertyValue(ENUM_XML_TAG.FIT_TO),nRows=this.getChartCountInCol(),nCols=this.getChartCountInRow(),xInfo=this.getXAxisInfo(),yInfo=this.getYAxisInfo(),calculateMaxXAxisWidth=function(){var i,width,labels,cnt=0,maxWidth=0,nSamples=Math.min(10,nCols);for(i=0;i<nSamples;i++){labels=me.getXAxisLabels(i);width=me.estimateXAxisSize(labels,XLABEL_STAT.NORMAL).width;maxWidth=Math.max(maxWidth,width);cnt+=labels.length;if(cnt>100){break;}}return maxWidth;},calculateMaxXAxisWidthStagger=function(){var i,width,labels,cnt=0,maxWidth=0,nSamples=Math.min(10,nCols);for(i=0;i<nSamples;i++){labels=me.getXAxisLabels(i);width=me.estimateXAxisSize(labels,XLABEL_STAT.STAGGER).width;maxWidth=Math.max(maxWidth,width);cnt+=labels.length;if(cnt>100){break;}}return maxWidth;},calculateMinXLabelWidth=function(labels){var i,item,width,subItem,subWidth,maxWidth=0,n=labels.length,styles=me.view.HTML5PROPS.AXIS_LABEL_Y;for(i=0;i<n;i++){item=labels[i];width=$VISUTIL.measureTextWidth(item,styles,0);if(item.length>10){subItem=item.substr(0,10)+"...";subWidth=$VISUTIL.measureTextWidth(subItem,styles,0);width=Math.min(width,subWidth);}maxWidth=Math.max(maxWidth,width);}return maxWidth;},countXLabels=function(){var i,labelsNum,cnt=0;for(i=0;i<nCols;i++){labelsNum=me.countXAxisLabels(i);cnt+=labelsNum;}return cnt;},collectLabels=function(){var i,labels,rtnArr=[];for(i=0;i<nCols;i++){labels=me.getXAxisLabels(i);rtnArr=rtnArr.concat(labels);}return rtnArr;},getWidthRatio=function(){var i,labelsNum,rtn=[];for(i=0;i<nCols;i++){labelsNum=me.countXAxisLabels(i);rtn.push(labelsNum);}return rtn;},getHeightRatio=function(){var i,labelsNum,rtn=[];for(i=0;i<nRows;i++){labelsNum=me.countYAxisLabels(i);rtn.push(labelsNum);}return rtn;},getMinWidthOfCols=function(){var i,width,labelsNum,nSeries=1,chartInfo=me.getChartInfo(),chartShape=chartInfo.shape,subType=me.chartSubType,chartType=me.chartType,minUnitWidth=MIN_BAR_WIDTH,rtn=[];if(chartShape===MK_SHAPE.BAR&&subType===PRP_SUBTYPE.CLUSTERED&&chartType!==CHART_TYPE.GRID){nSeries=me.chartingDetails.nSeries;}if(chartShape===MK_SHAPE.PIE||chartShape===MK_SHAPE.RING){minUnitWidth=Math.max(24,minUnitWidth);}else{if((chartShape===MK_SHAPE.LINE||chartShape===MK_SHAPE.AREA)&&!chartInfo.isCombo){minUnitWidth=MIN_LINE_WIDTH;}}for(i=0;i<nCols;i++){labelsNum=me.countXAxisLabels(i);width=(nSeries*minUnitWidth)*(labelsNum+0.5);rtn.push(Math.floor(width+0.5));}return rtn;},getMinHeightOfRows=function(){var i,height,labelsNum,nSeries=1,chartInfo=me.getChartInfo(),chartShape=chartInfo.shape,subType=me.chartSubType,chartType=me.chartType,minUnitHeight=MIN_BAR_WIDTH,rtn=[];if(chartShape===$GM.EnumShape.BAR&&subType===PRP_SUBTYPE.CLUSTERED&&chartType!==CHART_TYPE.GRID){nSeries=me.chartingDetails.nSeries;}if(chartShape===$GM.EnumShape.PIE||chartShape===$GM.EnumShape.RING){minUnitHeight=Math.max(24,minUnitHeight);}else{if((chartShape===MK_SHAPE.LINE||chartShape===MK_SHAPE.AREA)&&!chartInfo.isCombo){minUnitHeight=MIN_LINE_WIDTH;}}for(i=0;i<nRows;i++){labelsNum=me.countYAxisLabels(i);height=(nSeries*minUnitHeight)*(labelsNum+0.5);rtn.push(Math.floor(height+0.5));}return rtn;},calculateBandingFlags=function(labelCountArr){var i,n,sum,rtn=[];if(!labelCountArr||labelCountArr.length===0){for(i=0;i<nRows;i++){rtn.push(i%2);}return rtn;}n=labelCountArr.length;rtn=[0];sum=labelCountArr[0];for(i=1;i<n;i++){rtn.push(sum%2);sum+=labelCountArr[1];}return rtn;};layouter.fitTo=fitTo;layouter.chartType=this.chartType;layouter.nRows=nRows;layouter.nCols=nCols;layouter.xInfo=xInfo;layouter.yInfo=yInfo;layouter.xAxisType=xInfo.isMetric?AXIS_TYPE.METRIC:AXIS_TYPE.ATTRIBUTE;layouter.yAxisType=yInfo.isMetric?AXIS_TYPE.METRIC:AXIS_TYPE.ATTRIBUTE;layouter.widthCache=this.widthCache;layouter.heightCache=this.heightCache;layouter.minWidths=xInfo.isMetric?null:getMinWidthOfCols();layouter.minHeights=yInfo.isMetric?null:getMinHeightOfRows();widthRatio=xInfo.isMetric?undefined:getWidthRatio();heightRatio=yInfo.isMetric?undefined:getHeightRatio();if(fitTo===FIT_TO.CONTENT){layouter.maxXAxisWidth=xInfo.isMetric?undefined:calculateMaxXAxisWidth();layouter.maxXAxisWidthStagger=xInfo.isMetric?undefined:calculateMaxXAxisWidthStagger();delete layouter.widthRatio;delete layouter.heightRatio;}else{layouter.nLabels=countXLabels();layouter.minXLabelWidth=xInfo.isMetric?undefined:calculateMinXLabelWidth(collectLabels());layouter.widthRatio=widthRatio;layouter.heightRatio=heightRatio;}this.widthRatio=widthRatio;this.heightRatio=heightRatio;this.bandingFlags=calculateBandingFlags(heightRatio);layouter.API.owner=this;layouter.API.getXAxisHeight=this.getXAxisHeight;layouter.API.getXAxis2Height=this.getXAxis2Height;layouter.API.getYAxisWidth=this.getYAxisWidth;layouter.API.getYAxis2Width=this.getYAxis2Width;layouter.API.getRowHeight=this.getControllerAPI(DRAWING_API.GET_CHART_HEIGHT);layouter.API.getColWidth=this.getControllerAPI(DRAWING_API.GET_CHART_WIDTH);layouter.API.calculateAllXAxisStyle=this.getControllerAPI(DRAWING_API.LAYOUT_ALL_X_AXIS_LABELS);layouter.API.calculateOneXAxisStyle=this.getControllerAPI(DRAWING_API.LAYOUT_ONE_X_AXIS_LABELS);},preprocessForPie:function(modelJSON){var chtInfo=this.getChartInfo(),isFaking=false,model=this.model,eGT=CHART_TYPE,dirc=chtInfo.dirc,eDIRC=$GM.EnumABLDirection,tp=chtInfo.tp,slcCnt=this.getUnitsCountInSliceBy(),piePpt=this.piePartition=[],totalRows=this.totalRows=[],totalStartCols=this.totalStartCols=[],rct,cct,i,attCntOnRow,attCntOnCol,dz,sliceBy,sliceTP,tempLength,mcnt,leafHeaderObjectIndex,validSttOrdinal=0,firstSlcObj;if(!isFaking){dz=this.dz;sliceBy=dz.SliceBy;sliceTP=sliceBy.TemplateUnit;if(sliceTP&&sliceTP.length>0){validSttOrdinal=sliceTP[0].uidx;}else{$VISUTIL.visPrint("actually, it should be a bubble chart. not implemented!");}}rct=model.rct;cct=model.cct;attCntOnRow=model.getUnitAttributesCountOnRow();attCntOnCol=model.getUnitAttributesCountOnCol();mcnt=model.getMetricCount();var getPiePartitionUsingStt,getPiePartitionByComparingToken;if((chtInfo.isABL&&dirc===eDIRC.VERTICAL)||(tp===eGT.BUBBLE||tp===eGT.SCATTER)||(tp===eGT.GRID)){getPiePartitionUsingStt=function(){if(rct>0){piePpt.push(0);}if(!isNaN(validSttOrdinal)){validSttOrdinal=getOrdinal(modelJSON.gts,"row",validSttOrdinal);for(i=0;i<rct;i++){firstSlcObj=model.getRowHeaderObj(i,validSttOrdinal);if(firstSlcObj&&firstSlcObj.stt===1){if(i+1<rct){piePpt.push(i+1);}}}}tempLength=piePpt.length;for(i=1;i<tempLength;i++){totalRows.push(piePpt[i]-1);}totalRows.push(rct-1);};getPiePartitionByComparingToken=function(){leafHeaderObjectIndex=attCntOnRow-1-slcCnt;var formIndex=0,breakByIndices,isLeafHeaderInBreakBy,tempPiePpt=[],maxPiePpt=[];if(leafHeaderObjectIndex>=0){var curGts=this.gts.row[leafHeaderObjectIndex];curGts.fcnt=curGts.fcnt||curGts.cs||curGts.rs||1;if(curGts.t===1&&curGts.fcnt>1){var rhs=model.modelRhs[leafHeaderObjectIndex];i=0;while(i<=rhs.mxIdx){if(rhs[i]){piePpt.push(i);}i++;}}else{breakByIndices=this.getBreakByAttributeIndices(true);isLeafHeaderInBreakBy=$ARR.indexOf(breakByIndices,leafHeaderObjectIndex)>=0;if(isLeafHeaderInBreakBy){for(var index=breakByIndices.length-1;index>=0;index--){formIndex=0;for(i=0;i<breakByIndices[index];i++){formIndex+=this.gts.row[i].cs||1;}tempPiePpt=this.getPiePartitions(formIndex,true);if(tempPiePpt.length>maxPiePpt.length){maxPiePpt=tempPiePpt;}if(maxPiePpt.length===rct){break;}}piePpt=this.piePartition=maxPiePpt;}else{for(i=0;i<leafHeaderObjectIndex;i++){formIndex+=this.gts.row[i].cs||1;}piePpt=this.piePartition=this.getPiePartitions(formIndex,true);}}}else{piePpt.push(0);}};if(isFaking){getPiePartitionByComparingToken.call(this);}else{if(this.hasTotalForPie()){getPiePartitionUsingStt.call(this);}else{getPiePartitionByComparingToken.call(this);}}}else{if(chtInfo.isABL&&dirc===eDIRC.HORIZONTAL){getPiePartitionUsingStt=function(){if(cct>0){piePpt.push(0);}if(!isNaN(validSttOrdinal)){validSttOrdinal=getOrdinal(modelJSON.gts,"col",validSttOrdinal);for(i=0;i<cct;i++){firstSlcObj=model.getColHeaderObj(i,validSttOrdinal);if(firstSlcObj&&firstSlcObj.stt===1){piePpt.push(i);}}}tempLength=piePpt.length;for(i=1;i<tempLength;i++){totalStartCols.push(piePpt[i]);}totalStartCols.push(cct-mcnt);};getPiePartitionByComparingToken=function(){leafHeaderObjectIndex=attCntOnCol-1-slcCnt;var breakByIndices,isLeafHeaderInBreakBy,tempPiePpt=[],maxPiePpt=[];if(leafHeaderObjectIndex>=0){breakByIndices=this.getBreakByAttributeIndices(false);isLeafHeaderInBreakBy=$ARR.indexOf(breakByIndices,leafHeaderObjectIndex)>=0;if(isLeafHeaderInBreakBy){for(var index=breakByIndices.length-1;index>=0;index--){tempPiePpt=this.getPiePartitions(breakByIndices[index],false);if(tempPiePpt.length>maxPiePpt.length){maxPiePpt=tempPiePpt;}if(maxPiePpt.length===cct){break;}}piePpt=this.piePartition=maxPiePpt;}else{piePpt=this.piePartition=this.getPiePartitions(leafHeaderObjectIndex,false);}}else{piePpt.push(0);}};if(isFaking){getPiePartitionByComparingToken.call(this);}else{if(this.hasTotalForPie()){getPiePartitionUsingStt.call(this);}else{getPiePartitionByComparingToken.call(this);}}}}function getOrdinal(templateJson,axisName,unitIndex,offset){unitIndex=unitIndex||0;if(!!!templateJson){return unitIndex;}offset=offset||0;var i,item,axisItems,tag="cs",result=offset;if(axisName.toLowerCase()==="row"){axisItems=templateJson.row;}else{axisItems=templateJson.col;tag="rs";}for(i=0;axisItems&&i<unitIndex;i++){item=axisItems[i];result+=(item[tag]||1);}return result;}},getBreakByAttributeIndices:function getBreakByAttributeIndices(isVertical){var breakBy=this.dz.BreakBy,templateUnit=breakBy&&breakBy.TemplateUnit||[],i,j,breakByObj,gts=this.gts,titles=isVertical?gts.row:gts.col,ret=[];if(templateUnit.length>0){for(i=0;i<templateUnit.length;i++){breakByObj=templateUnit[i];for(j=0;j<titles.length;j++){if(titles[j].t===12&&breakByObj.id===titles[j].id){ret.push(j);break;}}}}return ret;},getPiePartitions:function getPiePartitions(columnIndex,isVertical){var model=this.model,count=isVertical?model.rct:model.cct,i,j,leafObj,hol,holLen,fieldList,o,token,lastToken,piePpt=[];for(i=0;i<count;i++){leafObj=isVertical?model.getRowHeaderObj(i,columnIndex):model.getColHeaderObj(i,columnIndex);hol=[];model.collectHeaderObj(leafObj,hol);holLen=hol.length;fieldList=[];for(j=0;j<holLen;j++){o=hol[j];fieldList.push(o.idx);}token=fieldList.join(",");if(lastToken!==token){piePpt.push(i);lastToken=token;}}return piePpt;},hasTotalForPie:function(){if(this.hasTotal!==undefined){return this.hasTotal;}var i,dz=this.dz,sDz,hasMetric=false,hasAttrInSliceby=this.getUnitsCountInSliceBy()>0,dzNms=["XAxis","YAxis","SizeBy"];for(i=0;i<3;i++){sDz=dz[dzNms[i]];if(sDz&&sDz.TemplateMetric&&sDz.TemplateMetric.length>0){hasMetric=true;break;}}this.hasTotal=hasMetric&&hasAttrInSliceby;return this.hasTotal;},setCEChartType:function(ceChartType){if(ceChartType&&this.ceChartType===ceChartType){return false;}if(ceChartType===undefined){ceChartType=this.ceChartType;}this.ceChartType=ceChartType;this.isPercentage=isDigitInArray(ceChartType,[7,21,35,14,28,42]);this.isStacked=isDigitInArray(ceChartType,[2,16,21,28,30,9,23,37]);return true;},getUnitsCountInSliceBy:function(){return this.getSliceByAttrsID().length;},getCellHandler:function(rIdx,cIdx,mIdx,dirc,isPie){var model=this.model,iLdsRow,ldsIdx,iLdsCol,gridR,gridC;if(mIdx!==INVALID_METRIC_IDX){ldsIdx=this.mapFromChartToLDSIndex(rIdx,cIdx);iLdsRow=ldsIdx.r;iLdsCol=ldsIdx.c;gridR=model.mapChartIndexToGrid(iLdsRow,model.rp);gridC=model.mapChartIndexToGrid(iLdsCol,model.cp);if(isPie){var piePartition=this.piePartition,totalIndex,totalOffset=0;if(dirc===ABL_DIRECTION.VERTICAL){totalIndex=this.totalRows;if(totalIndex.length>0&&piePartition.length>0){totalOffset=totalIndex[0]-piePartition[0];gridR+=totalOffset;}}else{if(dirc===ABL_DIRECTION.HORIZONTAL){totalIndex=this.totalStartCols;if(totalIndex.length>0&&piePartition.length>0){totalOffset=totalIndex[0]-piePartition[0];gridC+=totalOffset;}}}}return{row:gridR+this.gts.col.length,col:gridC+mIdx+this.gts.row.length};}return undefined;},getYAxisInfo:function(row,col,isPrimary,includeInvalidMetrics,inSeperateChartBubbleScatter){var me=this,chtInfo=this.getChartInfo(),model=this.model,cellHandlers=[],displayItems,isMetric=true,items,ids,mtsIdxArr,onlyMetricNamesOnAxisForGridPie=this.onlyMetricNamesOnAxisForGridPie,isMetricNamesOnXAxis=this.isMetricNamesOnXAxis;if(this.chartType===CHART_TYPE.GRID||(isHorizontalABLType(this.ceChartType))||onlyMetricNamesOnAxisForGridPie){isMetric=false;}inSeperateChartBubbleScatter=false;if(isMetric){if(chtInfo.isABL||inSeperateChartBubbleScatter){if(isPrimary===false){mtsIdxArr=this.getSecondaryMetrics(includeInvalidMetrics);items=model.getMetricNamesFromIndex(mtsIdxArr);ids=model.getMetricIDsFromIndex(mtsIdxArr);}else{mtsIdxArr=this.getPrimaryMetrics(includeInvalidMetrics);items=model.getMetricNamesFromIndex(mtsIdxArr);ids=model.getMetricIDsFromIndex(mtsIdxArr);}if(row!==undefined&&col!==undefined){$ARR.forEach(mtsIdxArr,function(mi){cellHandlers.push(me.getCellHandler(row,col,mi,chtInfo.dirc,chtInfo.isPie));});}}else{if(isPrimary===false){mtsIdxArr=this.getMetricsOnSecondaryYAxis();}else{mtsIdxArr=this.getMetricsOnPrimaryYAxis();}if(chtInfo.isBubbleOrScatter&&this.bubbleSeriesNum!==undefined){mtsIdxArr=mtsIdxArr.slice(0,this.bubbleSeriesNum);}items=model.getMetricNamesFromIndex(mtsIdxArr);ids=model.getMetricIDsFromIndex(mtsIdxArr);}}else{if(onlyMetricNamesOnAxisForGridPie&&!isMetricNamesOnXAxis){items=["Metric Names"];ids=["0"];mtsIdxArr=this.getMetricsOnAngleBy();}else{items=getAttributesOnDropZone.call(this,"YAxis","n");ids=getAttributesOnDropZone.call(this,"YAxis","id");}}return{isMetric:isMetric,items:items,ids:ids,cellHandlers:cellHandlers,mtsIdxArr:mtsIdxArr,displayItems:displayItems};},getXAxisInfo:function(row,col,isPrimary,includeInvalidMetrics){var me=this,model=this.model,chtTp=this.chartType,chtInfo=this.getChartInfo(),cellHandlers=[],displayItems,isMetric=true,items,ids,mtsIdxArr,onlyMetricNamesOnAxisForGridPie=this.onlyMetricNamesOnAxisForGridPie,isMetricNamesOnXAxis=this.isMetricNamesOnXAxis;if((isVerticalABLType(this.ceChartType))||chtTp===CHART_TYPE.GRID||onlyMetricNamesOnAxisForGridPie){isMetric=false;}if(isMetric){if(chtInfo.isABL){if(isPrimary===false){mtsIdxArr=this.getSecondaryMetrics(includeInvalidMetrics);items=model.getMetricNamesFromIndex(mtsIdxArr);ids=model.getMetricIDsFromIndex(mtsIdxArr);}else{mtsIdxArr=this.getPrimaryMetrics(includeInvalidMetrics);items=model.getMetricNamesFromIndex(mtsIdxArr);ids=model.getMetricIDsFromIndex(mtsIdxArr);}if(row!==undefined&&col!==undefined){$ARR.forEach(mtsIdxArr,function(mi){cellHandlers.push(me.getCellHandler(row,col,mi,chtInfo.dirc,chtInfo.isPie));});}}else{if(isPrimary===false){mtsIdxArr=this.getMetricsOnSecondaryXAxis();}else{mtsIdxArr=this.getMetricsOnPrimaryXAxis();}if(chtInfo.isBubbleOrScatter&&this.bubbleSeriesNum!==undefined){mtsIdxArr=mtsIdxArr.slice(0,this.bubbleSeriesNum);}items=model.getMetricNamesFromIndex(mtsIdxArr);ids=model.getMetricIDsFromIndex(mtsIdxArr);}}else{if(onlyMetricNamesOnAxisForGridPie&&isMetricNamesOnXAxis){items=["Metric Names"];ids=["0"];mtsIdxArr=this.getMetricsOnAngleBy();}else{items=getAttributesOnDropZone.call(this,"XAxis","n");ids=getAttributesOnDropZone.call(this,"XAxis","id");}}return{isMetric:isMetric,items:items,ids:ids,cellHandlers:cellHandlers,mtsIdxArr:mtsIdxArr,displayItems:displayItems};},getRowTitleInfo:function(isfullInfo){var model=this.model,titleInfos=model.getRowTitleInfo(),rhCnt=this.rowHeaderCnt,lbs=[];if(rhCnt<titleInfos.length){titleInfos.slice(0,rhCnt);}$ARR.forEach(titleInfos,function(titleInfo){if(isfullInfo){lbs.push(titleInfo);}else{lbs.push(titleInfo.n);}});return{items:lbs};},getColTitleInfo:function(isfullInfo){var model=this.model,titleInfos=model.getColTitleInfo(),chCnt=this.colHeaderCnt,lbs=[];if(chCnt<titleInfos.length){titleInfos.slice(0,chCnt);}$ARR.forEach(titleInfos,function(titleInfo){if(isfullInfo){lbs.push(titleInfo);}else{lbs.push(titleInfo.n);}});return{items:lbs};},isGrid:function(){return this.chartType===CHART_TYPE.GRID;},isBubble:function(){return this.chartType===CHART_TYPE.BUBBLE;},isScatter:function(){return this.chartType===CHART_TYPE.SCATTER;},isBubbleOrScatter:function(){var type=this.chartType;return type===CHART_TYPE.BUBBLE||type===CHART_TYPE.SCATTER;},clearLayoutInfo:function(){this.widthCache=[];this.heightCache=[];},updateChartInfo:function(){delete this.chartInfo;},getChartInfo:function(){var chtInfo=this.chartInfo;if(chtInfo){return chtInfo;}var gTp=CHART_TYPE,tp=this.chartType,isABL=false,myProperty=this.property,dlTp=myProperty&&myProperty.readItem(ENUM_XML_TAG.DATA_LABEL),dlPlmt=(myProperty&&myProperty.readItem(ENUM_XML_TAG.DATA_LABELS_PLACEMENT))||1;if(tp===gTp.AREA||tp===gTp.BAR||tp===gTp.LINE){isABL=true;}this.chartInfo={tp:tp,sbtp:this.chartSubType,dirc:this.chartDirection,shape:this.markerShape,ceMarkerShape:this.ceMarkerShape,isABL:isABL,isPie:this.isPie,isRing:false,hasSizeBy:this.hasSizeBy(),isCombo:this.enableCombiChart,isBubbleOrScatter:this.isBubbleOrScatter(),isGrid:this.isGrid(),dlTp:dlTp,dlPlmt:dlPlmt};return this.chartInfo;},getDrillableAttributes:function(){return["Year","Month"];},getDebugMenu:function(){var menuData=[],flag=this.enablePartialRendering;if(flag){menuData.push({n:"Disable Partial Rendering",did:MENU.DISABLE_PARTIAL_RENDERING});}else{menuData.push({n:"Enable Partial Rendering",did:MENU.ENABLE_PARTIAL_RENDERING});}if(GMUTIL.mUseTimer){menuData.push({n:"Disable Timer",did:MENU.DISABLE_TIMER});}else{menuData.push({n:"Enable Timer",did:MENU.ENABLE_TIMER});}if(this.view.enableCETimer){menuData.push({n:"Disable CE Timer",did:MENU.DISABLE_CE_TIMER});}else{menuData.push({n:"Enable CE Timer",did:MENU.ENABLE_CE_TIMER});}menuData.push({n:"Print Extremes",did:MENU.OUTPUT_EXTREMES});menuData.push({n:"Print #DataPoints",did:MENU.OUTPUT_DATA_COUNT});return menuData;},getContextMenuData:function(targetType){var menuData=[];if(targetType===CONTROL_TYPE.GM_ROW_HEADER_TITLE){menuData.push({n:"CIRCLE",did:MENU.CIRCLE});menuData.push({n:"SQUARE",did:MENU.SQUARE});menuData.push({n:"PIE",did:MENU.PIE});menuData.push({n:"TICKER",did:MENU.TICKER});menuData.push({n:"RING",did:MENU.RING});}else{if(targetType===CONTROL_TYPE.GM_COL_HEADER_TITLE){menuData.push({n:"Print Extremes",did:MENU.OUTPUT_EXTREMES});menuData.push({n:"Open Legend",did:MENU.OPEN_LEGEND});menuData.push({n:"Switch Combination Chart",did:MENU.COMBINATION});}}return menuData;},getChartType:function(){if(this.chartType===undefined||CHART_TYPE.UNDEFINED){var modelJSON=this.firstRes,dz=modelJSON.dz,xAxis=dz.XAxis,yAxis=dz.YAxis,chartType,propShape=this.view.getWidgetPropertyValue(ENUM_XML_TAG.SHAPE);if(xAxis.TemplateMetric&&yAxis.TemplateMetric){if(this.hasSizeBy()){chartType=CHART_TYPE.BUBBLE;}else{chartType=CHART_TYPE.SCATTER;}}else{if(!xAxis.TemplateMetric&&!yAxis.TemplateMetric){chartType=CHART_TYPE.GRID;if((!xAxis.TemplateUnit||xAxis.TemplateUnit.length===0)&&(!yAxis.TemplateUnit||yAxis.TemplateUnit.length===0)){this.isBlankGrid=true;}}else{if(propShape===PRP_SHAPE.LINE){chartType=CHART_TYPE.LINE;}else{if(propShape===PRP_SHAPE.BAR){chartType=CHART_TYPE.BAR;}else{if(propShape===PRP_SHAPE.AREA){chartType=CHART_TYPE.AREA;}else{if(propShape===PRP_SHAPE.PIE){chartType=CHART_TYPE.BAR;}else{if(propShape===PRP_SHAPE.RING){chartType=CHART_TYPE.BAR;}else{chartType=CHART_TYPE.BAR;}}}}}if(yAxis.TemplateMetric){this.chartDirection=$GM.EnumABLDirection.VERTICAL;}else{this.horizontalMode=true;this.chartDirection=$GM.EnumABLDirection.HORIZONTAL;}}}this.chartType=chartType;this.isPie=(propShape===PRP_SHAPE.PIE||propShape===PRP_SHAPE.RING);if(this.isPie){this.isBlankGrid=false;}if(modelJSON.eg!==undefined){this.isBlankGrid=true;}}return this.chartType;},getChartDirection:function(){if(this.chartDirection===undefined){this.getChartType();}return this.chartDirection;},getMetricsOnAxisOfChart:function(r,c,axis,isPrimary,forMinMax){var iLdsIdx,splitPlottingMetrics,chtInfo=this.getChartInfo(),chartDirection=chtInfo.dirc,metricsOnX,metricsOnY,axisMetrics,metricsOnPrimaryAxis,metricsOnSecondaryAxis,sizeByMetrics,bubbleSeriesNum,subChartsLayout,dzNm,smpMtc,scTp,metricsOnAxis,key;if(chtInfo.tp===CHART_TYPE.GRID){return[];}if(axis==="y"&&chtInfo.isABL&&chartDirection===1){return[];}if(axis==="x"&&chtInfo.isABL&&chartDirection===2){return[];}this.metricsOnAxisCache=this.metricsOnAxisCache||{};this.metricsOnAxisCache[axis]=this.metricsOnAxisCache[axis]||{};key=(axis==="y"||axis==="z")?r:c;key+="#"+(isPrimary?1:0)+"#"+(forMinMax?1:0);metricsOnAxis=this.metricsOnAxisCache[axis][key];if(metricsOnAxis!==undefined){return metricsOnAxis;}iLdsIdx=this.mapFromChartToLDSIndex(r,c);splitPlottingMetrics=this.splitPlottingMetrics;metricsOnX=this.getMetricsOnXAxis();metricsOnY=this.getMetricsOnYAxis();axisMetrics=metricsOnX.concat(metricsOnY);metricsOnPrimaryAxis=this.getPrimaryMetrics(true);metricsOnSecondaryAxis=this.getSecondaryMetrics(true);sizeByMetrics=this.getSizeByMetrics();subChartsLayout=this.inChartLayout||this.getSubChartsLayout();bubbleSeriesNum=Math.min(metricsOnX.length,metricsOnY.length);if(sizeByMetrics.length>0){bubbleSeriesNum=Math.min(bubbleSeriesNum,sizeByMetrics.length);}if(!splitPlottingMetrics){if(axis==="y"){if(chtInfo.isABL){if(isPrimary===false){metricsOnAxis=metricsOnSecondaryAxis;}else{metricsOnAxis=metricsOnPrimaryAxis;}}else{if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){if((this.haveY1&&isPrimary!==false)||(!this.haveY1&&isPrimary===false)){metricsOnAxis=metricsOnY.slice(0,bubbleSeriesNum);}}}}else{if(axis==="x"){if(chtInfo.isABL){if(isPrimary===false){metricsOnAxis=metricsOnSecondaryAxis;}else{metricsOnAxis=metricsOnPrimaryAxis;}}else{if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){if((this.haveX1&&isPrimary!==false)||(!this.haveX1&&isPrimary===false)){metricsOnAxis=metricsOnX.slice(0,bubbleSeriesNum);}}}}else{if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){if(sizeByMetrics.length>0){metricsOnAxis=sizeByMetrics.slice(0,bubbleSeriesNum);}}else{metricsOnAxis=sizeByMetrics;}}}}else{if(axis==="y"){if(chtInfo.isABL&&chartDirection===2){dzNm=isPrimary?"YAxis":"Y2Axis";smpMtc=isPrimary?metricsOnPrimaryAxis[0]:metricsOnSecondaryAxis[0];if(smpMtc!==undefined){scTp=getAxisScaleModeForSingleMetric.call(this,smpMtc,dzNm);}if(this.metricsType===METRICS_POS.MetricsByRow){if(isPrimary===false){metricsOnAxis=metricsOnSecondaryAxis.length>0?[metricsOnSecondaryAxis[iLdsIdx.inchtRow]]:[];}else{metricsOnAxis=metricsOnPrimaryAxis.length>0?[metricsOnPrimaryAxis[iLdsIdx.inchtRow]]:[];}}else{if(forMinMax&&this.metricsType===METRICS_POS.MetricsByColumn&&scTp===PRP_AXIS_SCALE.PERCELL){metricsOnAxis=[axisMetrics[c%axisMetrics.length]];}else{if(isPrimary===false){metricsOnAxis=metricsOnSecondaryAxis;}else{metricsOnAxis=metricsOnPrimaryAxis;}}}}else{if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){if((this.haveY1&&isPrimary!==false)||(!this.haveY1&&isPrimary===false)){metricsOnAxis=metricsOnY.length>0?[metricsOnY[r%subChartsLayout.r]]:[];}}}}else{if(axis==="x"){if(chtInfo.isABL&&chartDirection===1){dzNm=isPrimary?"XAxis":"X2Axis";smpMtc=isPrimary?metricsOnPrimaryAxis[0]:metricsOnSecondaryAxis[0];if(smpMtc!==undefined){scTp=getAxisScaleModeForSingleMetric.call(this,smpMtc,dzNm);}if(this.metricsType===METRICS_POS.MetricsByColumn){if(isPrimary===false){metricsOnAxis=metricsOnSecondaryAxis.length>0?[metricsOnSecondaryAxis[iLdsIdx.inchtCol]]:[];}else{metricsOnAxis=metricsOnPrimaryAxis.length>0?[metricsOnPrimaryAxis[iLdsIdx.inchtCol]]:[];}}else{if(forMinMax&&this.metricsType===METRICS_POS.MetricsByRow&&scTp===PRP_AXIS_SCALE.PERCELL){metricsOnAxis=[axisMetrics[r%axisMetrics.length]];}else{if(isPrimary===false){metricsOnAxis=metricsOnSecondaryAxis;}else{metricsOnAxis=metricsOnPrimaryAxis;}}}}else{if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){if((this.haveX1&&isPrimary!==false)||(!this.haveX1&&isPrimary===false)){metricsOnAxis=metricsOnX.length>0?[metricsOnX[c%subChartsLayout.c]]:[];}}}}else{if((chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER)&&sizeByMetrics.length>0){metricsOnAxis=sizeByMetrics.length>0?[sizeByMetrics[r%sizeByMetrics.length]]:[];}else{metricsOnAxis=sizeByMetrics;}}}}metricsOnAxis=metricsOnAxis||[];this.metricsOnAxisCache[axis][key]=metricsOnAxis;return metricsOnAxis;},getSubChartsLayout:function(){var splitPlottingMetrics=this.splitPlottingMetrics,chtInfo=this.getChartInfo(),groupInfo,shallWeUseGroupInfo=this.shallWeUseGroupInfo,metricType=this.metricsType;if(!splitPlottingMetrics){return{r:1,c:1};}var eGT=CHART_TYPE,pmi=this.model.plottingMetricsIndex;if(chtInfo.tp===eGT.BUBBLE||chtInfo.tp===eGT.SCATTER){var mOnX=this.getMetricsOnXAxis();var mOnY=this.getMetricsOnYAxis();return{r:mOnY.length,c:mOnX.length};}if(metricType===METRICS_POS.MetricsByRow){if(shallWeUseGroupInfo&&chtInfo.isABL){groupInfo=this.getGroupInfo();return{r:groupInfo.length,c:1};}return{r:pmi.length,c:1};}if(metricType===METRICS_POS.MetricsByColumn){if(shallWeUseGroupInfo&&chtInfo.isABL){groupInfo=this.getGroupInfo();return{r:1,c:groupInfo.length};}return{r:1,c:pmi.length};}$VISUTIL.visPrint("getSubChartsLayout need to be implemented for this chart type");return{r:1,c:1};},getChartCountInCol:function(){return this.model.cic*this.inChartLayout.r;},getChartCountInRow:function(){return this.model.cir*this.inChartLayout.c;},getSplitPlottingMetrics:function(){var eGT=CHART_TYPE;if(this.chartType===eGT.GRID&&this.isPie===false){this.splitPlottingMetrics=false;}else{if(this.chartType===eGT.GRID&&this.isPie&&this.getMetricsOnAngleBy().length===0){this.splitPlottingMetrics=false;}else{if(this.chartType===eGT.GRID&&this.isPie&&isMetricNamesInZone.call(this,"SliceBy")){this.splitPlottingMetrics=false;}else{var metricsType=this.metricsType;this.splitPlottingMetrics=(metricsType===METRICS_POS.MetricsByRow||metricsType===METRICS_POS.MetricsByColumn);}}}return this.splitPlottingMetrics;},reRenderGM:function(){this.widthCache.length=0;this.heightCache.length=0;this.view.reRender();},hideContextMenu:function(){var menu=this.view.contextMenu;if(menu!==undefined){menu.hideContextMenu();}},getAxisScaleMode:function(){var minMax=this.view.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE),allMetricsType,axisScaleData;if(minMax){this.axisScale=minMax;if(minMax===PRP_AXIS_SCALE.CUSTOM){axisScaleData=this.view.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE_DATA);if(axisScaleData&&axisScaleData.length>0){allMetricsType=parseInt(axisScaleData[0][1],10);if(allMetricsType<=PRP_AXIS_SCALE.PERCELL){this.axisScale=allMetricsType;}else{this.axisScale=PRP_AXIS_SCALE.CUSTOM;}}}}else{this.axisScale=PRP_AXIS_SCALE.GLOBAL;}return this.axisScale;},getPerCellSetting:function(r,c){return{xPerCell:this.isPerCellScaleOn(r,c,"x1")||false,x2PerCell:this.isPerCellScaleOn(r,c,"x2")||false,y2PerCell:this.isPerCellScaleOn(r,c,"y2")||false,yPerCell:this.isPerCellScaleOn(r,c,"y1")||false};},getChartUniformAxisTrims:function(r,c){var allTrims,yTrims=this.yAxisTrims,xTrims=this.xAxisTrims,ytrim=yTrims[r],xtrim=xTrims[c];var y2Trims=this.y2AxisTrims,x2Trims=this.x2AxisTrims,y2trim=y2Trims[r],x2trim=x2Trims[c];allTrims=mergeValueAxisTrims.call(this,xtrim,ytrim,x2trim,y2trim);var xCaTrims=this.caAxisTrims[0],yCaTrims=this.caAxisTrims[1],xCaTrim=xCaTrims[c],yCaTrim=yCaTrims[r],caTrims;caTrims=mergeCategoryAxisTrims.call(this,xCaTrim,yCaTrim);allTrims=mstrmojo.hash.copy(caTrims,allTrims);return allTrims;},getChartUniformAxisMargins:function(r,c){var ymgs=this.yAxisMargins,xmgs=this.xAxisMargins,ymg=ymgs[r],xmg=xmgs[c],chtMgs;if(!xmg){$VISUTIL.visPrint("cannot find the x-axis margin");}if(!ymg){$VISUTIL.visPrint("cannot find the y-axis margin");}chtMgs=mergeMargins.call(this,ymg,xmg);return chtMgs;},getDataAreaPadding:function(r,c){var axisMode=this.axisScale,mxDataPadding=this.maxDataAreaPaddingCache,eAxisMode=PRP_AXIS_SCALE,rowCnt,colCnt,i,j,rMxPd,inChartLayout,cMxPd,inc;if(axisMode===eAxisMode.PERCELL){if(mxDataPadding&&mxDataPadding[r]&&mxDataPadding[r][c]){return mxDataPadding[r][c];}else{return null;}}if(axisMode===eAxisMode.PERROWCOL||axisMode===eAxisMode.GLOBAL||axisMode===eAxisMode.CUSTOM){var result;if(this.dataAreaPaddingGlobalZero){result={X1:{HighOffset:0,LowOffset:0},Y1:{HighOffset:0,LowOffset:0},X2:{HighOffset:0,LowOffset:0},Y2:{HighOffset:0,LowOffset:0}};}else{if(!mxDataPadding){return null;}if(r>=perfMaxScanRow){r=0;}if(c>=perfMaxScanCol){c=0;}rowCnt=mxDataPadding.length;colCnt=mxDataPadding[0].length;var maxRowPadding,maxColPadding;if(this.maxRowPadding===undefined){maxRowPadding=this.maxRowPadding=[];for(i=0;i<rowCnt;i++){rMxPd=mxDataPadding[i][0];for(j=0;j<colCnt;j++){if(j!==0){rMxPd=getLargerPadding(rMxPd,mxDataPadding[i][j]);}}maxRowPadding.push(rMxPd);}}if(this.maxColPadding===undefined){maxColPadding=this.maxColPadding=[];for(j=0;j<colCnt;j++){cMxPd=mxDataPadding[0][j];for(i=0;i<rowCnt;i++){if(i!==0){cMxPd=getLargerPadding(cMxPd,mxDataPadding[i][j]);}}maxColPadding.push(cMxPd);}}maxRowPadding=this.maxRowPadding;maxColPadding=this.maxColPadding;rMxPd=maxRowPadding[r];cMxPd=maxColPadding[c];if(axisMode===eAxisMode.GLOBAL||axisMode===eAxisMode.CUSTOM){inChartLayout=this.inChartLayout;inc=inChartLayout.r;for(i=r%rowCnt;i<rowCnt;i+=inc){rMxPd=getLargerPadding(rMxPd,maxRowPadding[i]);}inc=inChartLayout.c;for(i=c%colCnt;i<colCnt;i+=inc){cMxPd=getLargerPadding(cMxPd,maxColPadding[i]);}}result=assemblePadding(rMxPd,cMxPd);}var key,idx,oneLayoutPaddings,oneIndex,allLayoutPaddings=this.layoutPaddingEchos,index=[c,c,r,r],keys=["X1","X2","Y1","Y2"];if(allLayoutPaddings){for(idx=0;idx<keys.length;idx++){key=keys[idx];oneIndex=index[idx];oneLayoutPaddings=allLayoutPaddings[key][oneIndex];if(oneLayoutPaddings){result[key].HighOffset=Math.max(result[key].HighOffset,(oneLayoutPaddings.HighOffset||0));result[key].LowOffset=Math.max(result[key].LowOffset,(oneLayoutPaddings.LowOffset||0));}}}return result;}},getMetricNameOnAngleBy:function(index){function getMetricOnAngleBy(index){var dz,angleBy,metricInZone;dz=this.dz;angleBy=dz.AngleBy||dz.Angle;if(angleBy){metricInZone=angleBy.TemplateMetric;}if(metricInZone&&metricInZone.length>index){return metricInZone[index];}return null;}var metric=getMetricOnAngleBy.call(this,index);if(metric){return metric.n;}return"";},getMetricsOnAngleBy:function(){return getMetricsOnDropZone.call(this,"AngleBy");},getMetricsOnXAxis:function(){return getMetricsOnDropZone.call(this,"XAxis");},setGroupInfo:function(groupInfo){var visGM=this.view;if(visGM.GMController===undefined){visGM.GMController=this;}visGM.setWidgetPropertyValue(ENUM_XML_TAG.GROUP_INFO,JSON.stringify(groupInfo));},removeGroupInfo:function(){this.setGroupInfo([]);},updateGroupInfo:function(){var visGM=this.view,groupInfo=this.getGroupInfo(),copy=[],idxs=[INVALID_METRIC_IDX,INVALID_METRIC_IDX],gts=this.gts;$ARR.forEach(groupInfo,function(pair){if(pair[0]!==INVALID_METRIC_IDX){idxs[0]=getMetricIndexFromID.call(this,pair[0],gts);}if(pair[1]!==INVALID_METRIC_IDX){idxs[1]=getMetricIndexFromID.call(this,pair[1],gts);}if(idxs[0]!==INVALID_METRIC_IDX||idxs[1]!==INVALID_METRIC_IDX){copy.push(pair);}});visGM.setWidgetPropertyValue(ENUM_XML_TAG.GROUP_INFO,JSON.stringify(copy));},hasGroupInfoStored:function(){var gInfo,rawGInfo=this.view.getWidgetPropertyValue(ENUM_XML_TAG.GROUP_INFO);if(rawGInfo){rawGInfo=rawGInfo.replace(/'/g,'"');gInfo=JSON.parse(rawGInfo);}if(gInfo&&gInfo.length>0){if(rawGInfo.indexOf("idx")>=0){gInfo=preprocessGroupInfo.call(this,gInfo);}return{existing:true,gi:gInfo};}return{existing:false};},getDummyGroupInfo:function(newMetricId,isPrimary,isNewMetricOnTop){var gmm=this.model;var res=[],i,pMs=this.getPrimaryMetrics(),sMs=this.getSecondaryMetrics(),metricIds=(gmm&&gmm.getMetricIds())||[],pIds=getMetricNamesFromIndex(pMs,metricIds),sIds=getMetricNamesFromIndex(sMs,metricIds);if(newMetricId){var removeFromOriginalPos=function(idArray){var k;for(k=0;k<idArray.length;k++){if(idArray[k]===newMetricId){idArray.splice(k,1);break;}}};removeFromOriginalPos(pIds);removeFromOriginalPos(sIds);if(isNewMetricOnTop){if(isPrimary){pIds=[newMetricId].concat(pIds);}else{sIds=[newMetricId].concat(sIds);}}else{if(isPrimary){pIds=pIds.concat([newMetricId]);}else{sIds=sIds.concat([newMetricId]);}}}var len1=pIds.length,len2=sIds.length,max=Math.max(len1,len2);for(i=0;i<max;i++){var v1,v2;v1=(pIds[i]!==undefined?pIds[i]:INVALID_METRIC_IDX);v2=(sIds[i]!==undefined?sIds[i]:INVALID_METRIC_IDX);res.push([v1,v2]);}return res;},getMetricIndexFromID:function(mid){return getMetricIndexFromID.call(this,mid,this.gts);},getGroupInfo:function(intoIndex){var visGM=this.view,gts=this.gts,res=[];if(visGM.GMController===undefined){visGM.GMController=this;}var existingGroupInfo=this.hasGroupInfoStored();if(existingGroupInfo.existing){res=existingGroupInfo.gi;}else{res=this.getDummyGroupInfo();visGM.setWidgetPropertyValue(ENUM_XML_TAG.GROUP_INFO,JSON.stringify(res));}if(intoIndex===true){$ARR.forEach(res,function(pair){var mid=pair[0];if(mid!==INVALID_METRIC_IDX){pair[0]=getMetricIndexFromID.call(this,mid,gts);}mid=pair[1];if(mid!==INVALID_METRIC_IDX){pair[1]=getMetricIndexFromID.call(this,mid,gts);}});}return res;},haveMetricAxisTitle:function(ax){var haveXAxisTitle=this.haveX1||this.haveX2,haveYAxisTitle=this.haveY1||this.haveY2,chtInfo=this.getChartInfo(),dz=this.model&&this.model.dz,xAxis=dz.XAxis,yAxis=dz.YAxis;if(chtInfo.isABL){haveXAxisTitle=!!xAxis.TemplateMetric;haveYAxisTitle=!!yAxis.TemplateMetric;}if(ax==="x"){return haveXAxisTitle;}if(ax==="y"){return haveYAxisTitle;}return haveYAxisTitle||haveXAxisTitle;},haveAxisTitle:function(ax){var haveXAxisTitle=this.haveX1||this.haveX2,haveYAxisTitle=this.haveY1||this.haveY2,chtInfo=this.getChartInfo(),dirc=chtInfo.dirc,xAxisMetrics,yAxisMetrics,axisMetrics,metricsType=this.metricsType;if(chtInfo.isABL){yAxisMetrics=this.getMetricsOnYAxis();xAxisMetrics=this.getMetricsOnXAxis();axisMetrics=xAxisMetrics.concat(yAxisMetrics);if(axisMetrics.length===1){if(xAxisMetrics.length===1){haveXAxisTitle=false;}else{haveYAxisTitle=false;}}else{if(dirc===ABL_DIRECTION.VERTICAL){if(metricsType===METRICS_POS.MetricsByRow||metricsType===METRICS_POS.MetricsByYAxis){haveXAxisTitle=false;}else{if(metricsType===METRICS_POS.MetricsByXAxis){if(this.hasAttributesInDropzone("XAxis")){haveXAxisTitle=false;}else{haveXAxisTitle=true;haveYAxisTitle=false;}}else{haveXAxisTitle=false;haveYAxisTitle=false;}}}else{if(metricsType===METRICS_POS.MetricsByColumn||metricsType===METRICS_POS.MetricsByXAxis){haveYAxisTitle=false;}else{if(metricsType===METRICS_POS.MetricsByYAxis){if(this.hasAttributesInDropzone("YAxis")){haveYAxisTitle=false;}else{haveXAxisTitle=false;haveYAxisTitle=true;}}else{haveXAxisTitle=false;haveYAxisTitle=false;}}}}}if(ax==="x"){return haveXAxisTitle;}if(ax==="y"){return haveYAxisTitle;}return haveYAxisTitle||haveXAxisTitle;},haveAttributeAxisTitle:function(ax){var haveXAxisTitle=this.haveX1||this.haveX2,haveYAxisTitle=this.haveY1||this.haveY2;haveXAxisTitle=this.hasAttributesInDropzone("XAxis");haveYAxisTitle=this.hasAttributesInDropzone("YAxis");if(ax==="x"){return haveXAxisTitle;}if(ax==="y"){return haveYAxisTitle;}return haveYAxisTitle||haveXAxisTitle;},getShapeForOption:function(opt){if(this.view.noData){return[];}var metricShapeArr=this.metricShapeArr,colorType=this.model.colorType,midx,chtInfo=this.getChartInfo(),res=[];if(!chtInfo.isABL||!this.enableCombiChart){return[chtInfo.shape];}if(opt!==undefined&&(colorType===COLOR_BY_TYPE.ATT_METRICS||colorType===COLOR_BY_TYPE.METRICS_ITEM)){var mid;$ARR.forEach(opt.comb,function(el){if(el.tp===4){mid=el.eid;return false;}});if(mid!==undefined){midx=this.getMetricIndexFromID(mid);}}if(opt!==undefined&&opt.optLvl===$SEL_OPT_LVL.METRIC){midx=this.getMetricIndexFromID(opt.key);}if(midx===undefined||midx===INVALID_METRIC_IDX){$ARR.forEach(metricShapeArr,function(sp){if(sp!==undefined&&sp>=0){res.push(sp);}});return res;}return[metricShapeArr[midx]];},getOnTheFlyShapeForMetric:function(mIdx){var fbdShps=this.getForbiddenShapeForMetric(mIdx),oriShape=this.getResolvedShapeForMetric(mIdx);if(fbdShps.indexOf(oriShape)>=0){return MK_SHAPE.LINE;}return oriShape;},getResolvedShapeForMetric:function(mIdx){var gmm=this.model,mId=gmm&&gmm.getMetricIDsFromIndex([mIdx])[0],generalProps=this.property.generalProps,metricShapes=generalProps.metricShapes,specificShape;if(metricShapes){specificShape=metricShapes[mId];}if(specificShape!==undefined){return specificShape;}return this.markerShape;},getForbiddenShapeForMetric:function(mIdx){var me=this,oppsiteMetrics=[],existingGroupInfo,fbdShps=[],chtInfo=this.getChartInfo(),pMts=this.getPrimaryMetrics(false),sMts=this.getSecondaryMetrics(false);if(chtInfo.isABL){if(sMts.indexOf(mIdx)>=0){existingGroupInfo=this.hasGroupInfoStored();if(existingGroupInfo.existing){var gi=this.getGroupInfo(true);gi.forEach(function(pair){if(pair[1]===mIdx&&pair[0]>=0){oppsiteMetrics.push(pair[0]);}});}else{oppsiteMetrics=pMts;}}}var barHit=false,areaHit=false;oppsiteMetrics.forEach(function(mi){var shapeOnPrimaryAxis=me.getResolvedShapeForMetric(mi);if(shapeOnPrimaryAxis===MK_SHAPE.BAR){barHit=true;}else{if(shapeOnPrimaryAxis===MK_SHAPE.AREA){areaHit=true;}}});if(barHit){fbdShps.push(MK_SHAPE.BAR);}if(areaHit){fbdShps.push(MK_SHAPE.AREA);}return fbdShps;},getPrimaryMetrics:function(includeInvalidMetrics){if(!this.horizontalMode){return this.getMetricsOnPrimaryYAxis(includeInvalidMetrics);}return this.getMetricsOnPrimaryXAxis(includeInvalidMetrics);},getSecondaryMetrics:function(includeInvalidMetrics){if(!this.horizontalMode){return this.getMetricsOnSecondaryYAxis(includeInvalidMetrics);}return this.getMetricsOnSecondaryXAxis(includeInvalidMetrics);},getMetricsOnPrimaryXAxis:function(includeInvalidMetrics){var resMts=getMetricsOnABLMetricValue.call(this,0,includeInvalidMetrics,true,"x");if(resMts){return resMts;}var mts=this.getMetricsOnXAxis();return splitMetricsForDualAxis.call(this,mts,true,includeInvalidMetrics);},getMetricsOnSecondaryXAxis:function(includeInvalidMetrics){var resMts=getMetricsOnABLMetricValue.call(this,1,includeInvalidMetrics,true,"x");if(resMts){return resMts;}var mts=this.getMetricsOnXAxis();return splitMetricsForDualAxis.call(this,mts,false,includeInvalidMetrics);},getMetricsOnPrimaryYAxis:function(includeInvalidMetrics){var resMts=getMetricsOnABLMetricValue.call(this,0,includeInvalidMetrics,true,"y");if(resMts){return resMts;}var mts=this.getMetricsOnYAxis();return splitMetricsForDualAxis.call(this,mts,true,includeInvalidMetrics);},getMetricsOnSecondaryYAxis:function(includeInvalidMetrics){var resMts=getMetricsOnABLMetricValue.call(this,1,includeInvalidMetrics,true,"y");if(resMts){return resMts;}var mts=this.getMetricsOnYAxis();return splitMetricsForDualAxis.call(this,mts,false,includeInvalidMetrics);},getMetricsOnYAxis:function(){return getMetricsOnDropZone.call(this,"YAxis");},getMetricsOnTooltip:function(){return getMetricsOnDropZone.call(this,"AdditionalMetrics");},getSliceByAttrsID:function(){var attObjArr=this.getSliceByAttributes(),idArr=[];$ARR.forEach(attObjArr,function(attObj){idArr.push(attObj.id);});return idArr;},getBreakByAttrsID:function(){var attObjArr=this.getBreakByAttributes(),idArr=[];$ARR.forEach(attObjArr,function(attObj){idArr.push(attObj.id);});return idArr;},getColorByAttrsID:function(){var colorByInfo,attIDs=[],i,len,atts;colorByInfo=this.colorByInfo;if(colorByInfo.tp===COLOR_BY_TYPE.ATT||colorByInfo.tp===COLOR_BY_TYPE.ATT_METRICS){atts=colorByInfo.atts;len=atts.length;for(i=0;i<len;i++){attIDs.push(atts[i].id);}return attIDs;}return[];},getRowColorAttrsIndex:function(){return getColorAttrsIndexOnGts.call(this,"row");},getColColorAttrsIndex:function(){return getColorAttrsIndexOnGts.call(this,"col");},getColorByUnitIds:function(dirc){var i,n,atts,colorByInfo,res=[],att,attIds,dropZones,rowColAxisAttrs=[],me=this,hasMetricNames=false,metricNamesPushed=false;if(dirc===$GM.EnumABLDirection.VERTICAL){dropZones=["Rows","YAxis","Columns","XAxis"];}else{dropZones=["Columns","XAxis","Rows","YAxis"];}dropZones.forEach(function(item){attIds=getAttributesOnDropZone.call(me,item,"id");$ARR.forEach(attIds,function(aid){rowColAxisAttrs.push({id:aid,zone:item});});if((item==="Rows"||item==="Columns")&&me.dz[item].MetricNames!==undefined){rowColAxisAttrs.push({id:-1,zone:item});}});colorByInfo=this.colorByInfo;if(colorByInfo.tp===COLOR_BY_TYPE.METRICS_ITEM||colorByInfo.tp===COLOR_BY_TYPE.ATT_METRICS){hasMetricNames=true;}if(colorByInfo.tp===COLOR_BY_TYPE.ATT||colorByInfo.tp===COLOR_BY_TYPE.ATT_METRICS||colorByInfo.tp===COLOR_BY_TYPE.METRICS_ITEM){atts=colorByInfo.atts;n=(atts&&atts.length)||0;$ARR.forEach(rowColAxisAttrs,function(item){if(item.id===-1&&hasMetricNames){res.push({id:-1,unique:false,zone:item.zone,es:me.getMetricIdsOfABLChart(dirc)});metricNamesPushed=true;return ;}for(i=0;i<n;i++){att=atts[i];if(item.id===att.id){res.push({id:att.id,unique:false,zone:item.zone,es:me.getElementsOfAttr(att)});break;}}});if(!metricNamesPushed&&hasMetricNames){res.push({id:-1,unique:true,es:this.getMetricIdsOfABLChart(dirc)});}var resKeys=[],m;for(i=0,m=res.length;i<m;i++){resKeys.push(res[i].id);}for(i=0;i<n;i++){att=atts[i];if(resKeys.indexOf(att.id)<0){res.push({id:att.id,unique:true,es:this.getElementsOfAttr(att)});}}}return res;},getElementsOfAttr:function(attr){var gts=this.gts,row=gts.row,col=gts.col,ax=(attr.axis==="row"?row:col),tui=attr.uidx,es=[];$ARR.forEach(ax[tui].es,function(item){es.push(item.id);});return es;},getMetricIdsOfABLChart:function(dirc){var i,mcnt,res=[],dropZone,dz=this.dz,metricInZone;if(dirc===$GM.EnumABLDirection.VERTICAL){dropZone="YAxis";}else{dropZone="XAxis";}metricInZone=dz[dropZone].TemplateMetric;if(metricInZone&&metricInZone.length>0){mcnt=metricInZone.length;for(i=0;i<mcnt;i++){res.push(metricInZone[i].id);}}return res;},splitPiesInGraphCellForABL:function(){if(this.chartType===5){return true;}return this.metricsType!==METRICS_POS.MetricsBySlice;},getSizeByScaleType:function(index){var sbMts,dropZone="SizeBy",mtsIdx;sbMts=this.getSizeByMetrics();mtsIdx=sbMts[index];return getAxisScaleModeForSingleMetric.call(this,mtsIdx,dropZone);},getSizeByMetrics:function(){var metricInZone,i,mcnt,yAxisMetrics,gts,dz,chartType,zone="SizeBy",res=this.metricsOnDropZone[zone];if(!res){gts=this.gts;dz=this.dz[zone];chartType=this.chartType;metricInZone=dz.TemplateMetric;res=[];if(metricInZone&&metricInZone.length>0){yAxisMetrics=this.getMetricsOnYAxis();if(checkMutipleBubble.call(this,yAxisMetrics)){mcnt=Math.min(metricInZone.length,yAxisMetrics.length);}else{if((chartType===CHART_TYPE.BUBBLE)||(chartType===CHART_TYPE.SCATTER)){mcnt=metricInZone.length;}else{mcnt=1;}}for(i=0;i<mcnt;i++){res.push(getMetricIndexFromID.call(this,metricInZone[i].id,gts));}}this.metricsOnDropZone[zone]=res;}return res;},getColorByMetrics:function(){return getMetricsOnDropZone.call(this,"ColorBy");},getAttributesOnDropZone:function(zoneName,prop){return getAttributesOnDropZone.call(this,zoneName,prop);},getGMHeaderCount:function(zoneName){var dz=this.dz;return getGMHeaderCount.call(this,dz[zoneName]);},setupDualAxis:function(){var xInfo,yInfo,chtInfo=this.getChartInfo(),primaryMetrics,secondaryMetrics,me=this;this.haveX1=false;this.haveX2=false;this.haveY1=false;this.haveY2=false;this.drawX1Numeric=false;this.drawX2Numeric=false;this.drawY1Numeric=false;this.drawY2Numeric=false;if(chtInfo.isABL){if(this.horizontalMode){yInfo=this.getYAxisInfo();if(yInfo.items.length>0){this.haveY1=true;}if(this.clusteredBarSpecialCase){this.haveY1=true;}}else{xInfo=this.getXAxisInfo();primaryMetrics=this.getMetricsOnPrimaryYAxis();secondaryMetrics=this.getMetricsOnSecondaryYAxis();if(xInfo.items.length>0){this.haveX1=true;}if(this.clusteredBarSpecialCase){this.haveX1=true;}}}var checkNumericAxis=function(metrics,identity){if(metrics.length>0){if(identity==="XAxis"){me.haveX1=true;}else{if(identity==="XAxis2"){me.haveX2=true;}else{if(identity==="YAxis"){me.haveY1=true;}else{if(identity==="YAxis2"){me.haveY2=true;}}}}$ARR.forEach(metrics,function(mtsIdx){if(mtsIdx===undefined||mtsIdx<0){return ;}if(getAxisScaleModeForSingleMetric.call(me,mtsIdx,identity)!==PRP_AXIS_SCALE.PERCELL){if(identity==="XAxis"){me.drawX1Numeric=true;}else{if(identity==="XAxis2"){me.drawX2Numeric=true;}else{if(identity==="YAxis"){me.drawY1Numeric=true;}else{if(identity==="YAxis2"){me.drawY2Numeric=true;}}}}}else{if(identity==="XAxis"){me.drawX1Numeric=me.drawX1Numeric||me.getChartCountInCol()===1;}else{if(identity==="XAxis2"){me.drawX2Numeric=me.drawX2Numeric||me.getChartCountInCol()===1;}else{if(identity==="YAxis"){me.drawY1Numeric=me.drawY1Numeric||me.getChartCountInRow()===1;}else{if(identity==="YAxis2"){me.drawY2Numeric=me.drawY2Numeric||me.getChartCountInRow()===1;}}}}}});}};checkNumericAxis(this.getMetricsOnPrimaryXAxis(),"XAxis");checkNumericAxis(this.getMetricsOnSecondaryXAxis(),"XAxis2");checkNumericAxis(this.getMetricsOnPrimaryYAxis(),"YAxis");checkNumericAxis(this.getMetricsOnSecondaryYAxis(),"YAxis2");if(me.clusteredBarSpecialCase){if(chtInfo.dirc===ABLDIR.VERTICAL){this.drawX1Numeric=true;}else{this.drawY1Numeric=true;}}if(this.isBubbleOrScatter()){var axisLayout=this.axisLayout;this.haveY1=(axisLayout&Y1_ON)!==0;this.haveY2=(axisLayout&Y2_ON)!==0;this.haveX1=(axisLayout&X1_ON)!==0;this.haveX2=(axisLayout&X2_ON)!==0;}if(this.onlyMetricNamesOnAxisForGridPie){if(this.isMetricNamesOnXAxis){this.haveX1=true;}else{this.haveY1=true;}}if(chtInfo.isGrid&&chtInfo.isPie){if(this.isMetricNamesOnRows){this.haveY1=true;}}yInfo=this.getYAxisInfo();if(chtInfo.isGrid&&yInfo.items.length>0&&yInfo.isMetric===false){this.haveY1=true;}},setupAxisLayout:function(){var nMetrics,n2Metrics=0,isXDualAxis=false,isYDualAxis=false,hasHeaderInY=false,hasFooterInX=false,isFooterAbove=false,metricNameInX=false,metricNameInY=false,combineMetricNameInY=false,combineMetricNameInX=false,metricNamesOnRowMetricsOnXAxis=false,chartType=this.chartType,direction=this.chartDirection,metricsType=this.metricsType,xInfo=this.getXAxisInfo(),x2Info=this.getXAxisInfo(undefined,undefined,false,undefined),yInfo=this.getYAxisInfo(),y2Info=this.getYAxisInfo(undefined,undefined,false,undefined),angleByMetrics=this.getMetricsOnAngleBy(),isABL=chartType===CHART_TYPE.AREA||chartType===CHART_TYPE.BAR||chartType===CHART_TYPE.LINE,isPie=this.isPie,isGrid=this.isGrid(),isBubbleScatter=this.isBubbleOrScatter();if(isABL){if(direction===ABLDIR.VERTICAL){nMetrics=yInfo.items.length;if(y2Info&&y2Info.items){n2Metrics=y2Info.items.length;}if(nMetrics>0&&n2Metrics>0){isYDualAxis=true;}if(isYDualAxis){if(metricsType===METRICS_POS.MetricsByRow){hasHeaderInY=true;}else{hasHeaderInY=true;combineMetricNameInY=true;}}else{if((nMetrics<=1&&n2Metrics<=1)||metricsType===METRICS_POS.MetricsByRow){hasHeaderInY=true;}else{if(metricsType===METRICS_POS.MetricsByColumn){hasFooterInX=true;isFooterAbove=true;}else{if(metricsType===METRICS_POS.MetricsByXAxis||metricsType===METRICS_POS.MetricsByBreakBy){if(xInfo.items.length===0){if(this.chartSubType!==PRP_SUBTYPE.STACKED&&this.chartSubType!==PRP_SUBTYPE.PERCENT){metricNameInX=true;}}else{hasHeaderInY=true;combineMetricNameInY=true;}}}}}}else{nMetrics=xInfo.items.length;if(x2Info&&x2Info.items){n2Metrics=x2Info.items.length;}if(nMetrics>0&&n2Metrics>0){isXDualAxis=true;}if(isXDualAxis){if(metricsType===METRICS_POS.MetricsByColumn){hasFooterInX=true;}else{hasFooterInX=true;combineMetricNameInX=true;}}else{if((nMetrics<=1&&n2Metrics<=1)||metricsType===METRICS_POS.MetricsByColumn){hasFooterInX=true;}else{if(metricsType===METRICS_POS.MetricsByRow){if(isMetricNamesOnRowMetricsOnXAxis.call(this)){metricNamesOnRowMetricsOnXAxis=true;}hasHeaderInY=true;}else{if(metricsType===METRICS_POS.MetricsByYAxis||metricsType===METRICS_POS.MetricsByBreakBy){if(yInfo.items.length===0){metricNameInY=true;}else{hasFooterInX=true;combineMetricNameInX=true;}}}}}}}else{if(isGrid){if(isPie&&angleByMetrics.length>1){if(metricsType===METRICS_POS.MetricsByRow){hasHeaderInY=true;hasFooterInX=false;this.haveY1=true;}if(metricsType===METRICS_POS.MetricsByColumn){hasHeaderInY=false;hasFooterInX=true;isFooterAbove=true;}}}else{if(isBubbleScatter){if(metricsType===METRICS_POS.MetricsByRow||metricsType===METRICS_POS.MetricsByColumn){hasHeaderInY=true;hasFooterInX=true;}else{hasHeaderInY=true;hasFooterInX=true;combineMetricNameInY=true;combineMetricNameInX=true;}}}}var xAxisAttributes=this.dz.XAxis.TemplateUnit;if(xAxisAttributes&&xAxisAttributes.length>0){hasFooterInX=true;}var showYAxisTitle=this.view.getWidgetPropertyValue(ENUM_FORMAT_TAG.Y_AXIS_TITLE_SHOW),showXAxisTitle=this.view.getWidgetPropertyValue(ENUM_FORMAT_TAG.X_AXIS_TITLE_SHOW);if(showYAxisTitle===undefined){showYAxisTitle=this.view.getWidgetPropertyDefaultValue(ENUM_FORMAT_TAG.Y_AXIS_TITLE_SHOW,{isMetric:this.yIsNumeric});}if(showXAxisTitle===undefined){showXAxisTitle=this.view.getWidgetPropertyDefaultValue(ENUM_FORMAT_TAG.X_AXIS_TITLE_SHOW,{isMetric:this.xIsNumeric});}if(!showYAxisTitle){hasHeaderInY=false;}if(!showXAxisTitle){if(hasFooterInX&&!isFooterAbove){hasFooterInX=false;}}this.isXDualAxis=isXDualAxis;this.isYDualAxis=isYDualAxis;this.hasHeaderInY=hasHeaderInY;this.hasFooterInX=hasFooterInX;this.isFooterAbove=isFooterAbove;this.metricNameInX=metricNameInX;this.metricNameInY=metricNameInY;this.combineMetricNameInX=combineMetricNameInX;this.combineMetricNameInY=combineMetricNameInY;this.metricNamesOnRowMetricsOnXAxis=metricNamesOnRowMetricsOnXAxis;this.metricNamesOnColumnMetricsOnYAxis=isMetricNamesOnColumnMetricsOnYAxis.call(this);},getAxisLayout4CE:function(i,j){var flag=0,yCache,xCache,xyCache;var xInfo,x2Info,yInfo,y2Info;if(i!==undefined&&j!==undefined){xyCache=this.chartAxisLayouts=this.chartAxisLayouts||{x:[],y:[]};yCache=xyCache.y;xCache=xyCache.x;var xflag=0,yflag=0;if(xCache[j]===undefined){xInfo=this.getXAxisInfo(i,j,true,false,true);x2Info=this.getXAxisInfo(i,j,false,false,true);if(xInfo.items.length>0){xflag|=X1_ON;}if(x2Info.items.length>0){xflag|=X2_ON;}xCache[j]=xflag;}else{xflag=xCache[j];}if(yCache[i]===undefined){yInfo=this.getYAxisInfo(i,j,true,false,true);y2Info=this.getYAxisInfo(i,j,false,false,true);if(yInfo.items.length>0){yflag|=Y1_ON;}if(y2Info.items.length>0){yflag|=Y2_ON;}yCache[i]=yflag;}else{yflag=yCache[i];}flag|=xflag;flag|=yflag;}else{xInfo=this.getXAxisInfo(i,j,true,false);x2Info=this.getXAxisInfo(i,j,false,false);yInfo=this.getYAxisInfo(i,j,true,false);y2Info=this.getYAxisInfo(i,j,false,false);if(xInfo.items.length>0){flag|=X1_ON;}if(yInfo.items.length>0){flag|=Y1_ON;}if(y2Info.items.length>0){flag|=Y2_ON;}if(x2Info.items.length>0){flag|=X2_ON;}}return flag;},getYAxisWidth4FitWindow:function(isPrimary){var i,dp,tpWd,width=0,nRows=this.getChartCountInCol(),getChartHeight=this.getControllerAPI(DRAWING_API.GET_CHART_HEIGHT);nRows=Math.min(nRows,perfMaxScanRow);for(i=0;i<nRows;i++){dp=getDP.call(this,i,0);tpWd=this.getSingleYAxisWidth(getChartHeight(i,0),dp,i,0,isPrimary);width=Math.max(width,tpWd);}return width;},getYAxisWidth4FitContent:function(isMetric){if(isMetric){return this.getNumericYAxisWidth(true);}return this.getCategoricalYAxisWidth();},getYAxisWidth:function(){if(this.metricNamesOnRowMetricsOnXAxis){var axisInfo=this.getXAxisInfo(0,0),metricNames=[axisInfo.items],style=this.view.HTML5PROPS.RH,layouter=this.view.layouter;var maxWidth=layouter.getRowHeadersWidth(metricNames,style);if(maxWidth&&maxWidth.length>0){this.haveY1=true;return maxWidth[0];}}var axisLayout,width=0,fitTo=this.view.getWidgetPropertyValue(ENUM_XML_TAG.FIT_TO),yInfo=this.getYAxisInfo(undefined,undefined,true,false);if(this.isBubbleOrScatter()){axisLayout=this.axisLayout;if((axisLayout&Y1_ON)===0){return 0;}}if(yInfo.items.length===0&&!this.metricNameInY){if(this.hasHeaderInY&&!this.haveY2){return this.view.textHeightInY+2*TEXT_CHART_SPACE;}return 0;}if(!yInfo.isMetric||this.drawY1Numeric){if(fitTo===FIT_TO.CONTENT){width=this.getYAxisWidth4FitContent(yInfo.isMetric);}else{width=this.getYAxisWidth4FitWindow(true);}}if(this.hasHeaderInY&&this.haveY1){width+=this.view.textHeightInY+2*TEXT_CHART_SPACE;}return width;},getYAxis2Width:function(){var axisLayout,width,yInfo=this.getYAxisInfo(undefined,undefined,false,true);if(this.isBubbleOrScatter()){axisLayout=this.axisLayout;if((axisLayout&Y2_ON)===0){return 0;}}if(yInfo.items.length===0){if(this.hasHeaderInY&&!this.haveY1){width=this.view.textHeightInY+2*TEXT_CHART_SPACE;return width;}return 0;}if(!yInfo.isMetric){return 0;}width=this.drawY2Numeric?this.getNumericYAxisWidth(false):0;if(this.hasHeaderInY){width+=this.view.textHeightInY+2*TEXT_CHART_SPACE;}return width;},getCategoricalYAxisWidth:function(){var i,labels,width,maxWidth=0,nRows=this.getChartCountInCol();for(i=0;i<nRows;i++){labels=this.getYAxisLabels(i);width=this.estimateYAxisSize(labels).width;maxWidth=Math.max(maxWidth,width);}return maxWidth;},getNumericYAxisWidth:function(isPrimary){var maxWd=-1,getChartHeight=this.getControllerAPI(DRAWING_API.GET_CHART_HEIGHT),i,tpWd,viewRowIdx;var chartCountInCol=this.getChartCountInCol();for(i=0;i<chartCountInCol;i++){var dp=getDP.call(this,i,0);tpWd=this.getSingleYAxisWidth(getChartHeight(i,0),dp,i,0,isPrimary);if(tpWd>maxWd){maxWd=tpWd;}}return maxWd;},getXAxisHeight:function(rotate){var axisLayout,height,xInfo=this.getXAxisInfo();if(this.isBubbleOrScatter()){axisLayout=this.axisLayout;if((axisLayout&X1_ON)===0){return 0;}}if(xInfo.items.length===0&&!this.metricNameInX){if(this.metricNameInX&&!this.haveX2){return this.view.textHeightInX+TEXT_CHART_SPACE*2;}return 0;}if(xInfo.isMetric){height=this.drawX1Numeric?this.getNumericXAxisHeight(rotate,true):0;if(this.hasFooterInX&&!this.isFooterAbove){height+=this.view.textHeightInX+2*TEXT_CHART_SPACE;}}else{height=this.getCategoricalXAxisHeight(rotate);if(this.hasFooterInX){height+=this.view.textHeightInX+2*TEXT_CHART_SPACE;}}return height;},getXAxis2Height:function(rotate){var axisLayout,view=this.view,defaultHeight=view.rowHeaderMaxHeightWithoutX2;if(!this.haveX2){return defaultHeight;}if(this.isBubbleOrScatter()){axisLayout=this.axisLayout;if((axisLayout&X2_ON)===0){return defaultHeight;}}var height=this.drawX2Numeric?this.getNumericXAxisHeight(rotate,false):0;if(this.hasFooterInX&&!this.isFooterAbove){height+=this.view.textHeightInX+2*TEXT_CHART_SPACE;}return Math.max(defaultHeight,height);},getCategoricalXAxisHeight:function(rotate){return this.getNumericXAxisHeight(rotate,true);},getNumericXAxisHeight:function(labelRotation,isPrimary){var maxHt=0,getChartWidth=this.getControllerAPI(DRAWING_API.GET_CHART_WIDTH),j,dp,tpHt;var chartCountInRow=this.getChartCountInRow(),scale=this.view.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_WIDTH);chartCountInRow=Math.min(chartCountInRow,perfMaxScanCol);for(j=0;j<chartCountInRow;j++){dp=getDP.call(this,0,j);tpHt=this.getSingleXAxisHeight(getChartWidth(0,j)*scale,dp,0,j,labelRotation,isPrimary);maxHt=Math.max(maxHt,tpHt);}return maxHt;},getSingleYAxisWidth:function(h,dp,r,c,isPrimary){var chart=this.getAxisChartInstance(dp,r,c,"y",isPrimary,0,h,true),wd;if(chart===null){return 0;}wd=chart.GetUniformYAxisWidth(h,-1,isPrimary);var echos=pickCondenseEchos.call(this,false,isPrimary);chart.echoCondenseStatus(echos,r);var layoutPadding=pickLayoutPaddings.call(this,false,isPrimary);chart.echoLayoutPaddings(layoutPadding,r);return wd;},getSingleXAxisHeight:function(w,dp,r,c,labelRotation,isPrimary){var chart=this.getAxisChartInstance(dp,r,c,"x",isPrimary,w,0,true),ht;if(chart===null){return 0;}ht=chart.GetUniformXAxisHeight(w,-1,isPrimary);var echos=pickCondenseEchos.call(this,true,isPrimary);chart.echoCondenseStatus(echos,c);var layoutPadding=pickLayoutPaddings.call(this,true,isPrimary);chart.echoLayoutPaddings(layoutPadding,c);return ht;},getCategoricalColWidth:function(colIdx){var labels=this.getXAxisLabels(colIdx),rotate=this.xLabelPlacement,totalWidth=this.view.GMW,minWidths=this.view.layouter.minWidths,width;width=this.estimateXAxisSize(labels,rotate,totalWidth).width;if(minWidths&&minWidths[colIdx]){width=Math.max(width,minWidths[colIdx]);}return width;},checkBarColumnsForAxisPadding:function checkBarColumnsForAxisPadding(i,j){var chartInfo=this.getChartInfo(),hasBarShape=this.hasBarChart,isComb=this.isCombo,isCluster=hasBarShape&&(isComb||chartInfo.sbtp===$GM.EnumSubtype.AUTO||chartInfo.sbtp===$GM.EnumSubtype.CLUSTERED);var nBarcolumns=-1;if(hasBarShape){var dp=getDP.call(this,i,j);nBarcolumns=dp.getGroupCount();if(isCluster){nBarcolumns*=dp.innerGetSeriesCount();}nBarcolumns+=0.5;}return nBarcolumns;},getCategoricalRowHeight:function(rowIdx){var labels=this.getYAxisLabels(rowIdx);var axisHeight=this.estimateYAxisSize(labels).height;var nBarColumns=this.checkBarColumnsForAxisPadding(rowIdx,0);if(nBarColumns>0){axisHeight+=2*Math.round(axisHeight/(4*nBarColumns-2));}var minHeights=this.view.layouter.minHeights;if(minHeights&&minHeights[rowIdx]){axisHeight=Math.max(axisHeight,minHeights[rowIdx]);}return axisHeight;},getColHeaderSummary:function(depth){if(this.colHdrSmrs[depth]){return this.colHdrSmrs[depth];}var i,unit,obj,n_id,lbs,iLdsCol,gridCol,model=this.model,nCols=this.getChartCountInRow(),rtn=[];for(i=0;i<nCols;i++){iLdsCol=this.mapFromChartToLDSIndex(depth,i).c;gridCol=model.mapChartIndexToGrid(iLdsCol,model.cp);obj=model.getColHeaderObj(gridCol,depth);n_id=model.headerInfoToProp(1,obj,"n&id");lbs=n_id[0].id;unit=model.getColTitleInfo()[obj.tui].id;rtn.push(lbs);}var colHdrSmr={unit:unit,elements:rtn};this.colHdrSmrs.push(colHdrSmr);return colHdrSmr;},getRowHeaderSummary:function(colIdx){if(this.rwHdrSmrs[colIdx]){return this.rwHdrSmrs[colIdx];}var i,obj,lbs,unit,n_id,iLdsRow,gridRow,model=this.model,nRows=this.getChartCountInCol(),rtn=[];for(i=0;i<nRows;i++){iLdsRow=this.mapFromChartToLDSIndex(i,colIdx).r;gridRow=model.mapChartIndexToGrid(iLdsRow,model.rp);obj=model.getRowHeaderObj(gridRow,colIdx);n_id=model.headerInfoToProp(0,obj,"n&id");lbs=n_id[0].id;unit=model.getRowTitleInfo()[obj.tui].id;rtn.push(lbs);}var rwHdrSmr={unit:unit,elements:rtn};this.rwHdrSmrs.push(rwHdrSmr);return rwHdrSmr;},getRowHeadersByCell:function getRowHeaderByCell(cellIndex){var gmm=this.model,mcnt=gmm.getMetricCount(),attCntOnRow=gmm.getUnitAttributesCountOnRow(),attCntOnCol=gmm.getUnitAttributesCountOnCol(),selPropArr=["fi","headerID","headerText","id","idx","levelIndex","n","ui","tui"],i,gvsRI,gvsCI,sortMtcIdx,allMetrics,attTitle,selObj,metricObj,moreInfo,elements=[];if(cellIndex){gvsRI=cellIndex.row-this.gts.col.length;gvsCI=cellIndex.col-this.gts.row.length;sortMtcIdx=gvsCI%mcnt;allMetrics=gmm.getMetricProp(undefined);metricObj=$HASH.copy(allMetrics[sortMtcIdx],{});metricObj.gvsRI=gvsRI;metricObj.gvsCI=gvsCI;}else{return{metricObj:undefined,headers:undefined};}if(this.horizontalMode){metricObj.axis=$AXIS.DssAxisRows;if(this.specialSortable){metricObj.axis=$AXIS.DssAxisColumns;}for(i=0;i<attCntOnCol;i++){attTitle=getColumnTitleCell.call(this,i);if(this.specialSortable&&attTitle.dropzones.indexOf("BreakBy")>=0){continue;}selObj=$HASH.copyProps(selPropArr,gmm.getColHeaderObj(gvsCI,i),{});moreInfo=gmm.headerInfoToProp(1,selObj,"n&id");$HASH.copy(moreInfo[0],selObj);elements.push(selObj);}}else{metricObj.axis=$AXIS.DssAxisColumns;if(this.specialSortable){metricObj.axis=$AXIS.DssAxisRows;}for(i=0;i<attCntOnRow;i++){attTitle=getRowTitleCell.call(this,i);if(this.specialSortable&&attTitle.dropzones.indexOf("BreakBy")>=0){continue;}selObj=$HASH.copyProps(selPropArr,gmm.getRowHeaderObj(gvsRI,i),{});moreInfo=gmm.headerInfoToProp(0,selObj,"n&id");$HASH.copy(moreInfo[0],selObj);elements.push(selObj);}}return{metricObj:metricObj,headers:elements};},getMetricSortInfo:function getMetricSortInfo(){var modelData=this.firstRes,gsi=modelData.gsi,sortInRow=gsi.sorts[0],sortInCol=gsi.sorts[1],sortsAll=sortInRow.concat(sortInCol),UNIT_TYPE=0,UNIT_ID=1,ELEM_LIST=4,IS_METRIC_TYPE=4,i,keys,aSort,sortUnitType,sortUnitId,sortElemList,elemList,metricSortInfo={};if(this.metricSortInfo){return this.metricSortInfo;}for(i=0;i<sortsAll.length;i++){aSort=sortsAll[i];keys=aSort.key.split("!");sortUnitType=parseInt(keys[UNIT_TYPE]);sortUnitId=keys[UNIT_ID];sortElemList=keys[ELEM_LIST];if(sortUnitType===IS_METRIC_TYPE){elemList=sortElemList!==""?sortElemList.split(""):[];metricSortInfo={metricId:sortUnitId,elements:elemList,order:aSort.isAsc};}}this.metricSortInfo=metricSortInfo;return metricSortInfo;},updateSortIndex:function updateSortIndex(cellIndex){var visGM=this.view,cellHandle=visGM.getWidgetPropertyValue(ENUM_XML_TAG.SORT_INDEX);if(cellHandle&&(cellHandle.row!==cellIndex.row||cellHandle.col!==cellIndex.col)){visGM.setWidgetPropertyValue(ENUM_XML_TAG.SORT_INDEX,cellIndex);}},getUpdateMetricSortAction:function getUpdateMetricSortAction(cellHandle,isAsc,isStacked){var actions,sortArray,chartInfo=this.getChartInfo();this.sortingMetric=true;sortArray=this.getMetricSortDefinition(cellHandle,isAsc);actions=this.getSortActions(sortArray);if(chartInfo.isABL&&isStacked){this.fakeSortActionsStackTotal(actions);}return{act:"sortGM",nodeKey:this.view.k,subActions:actions};},getControllerAPI:function getControllerAPI(fName){var me=this,visGM=this.view,chtInfo=me.getChartInfo(),model=me.model;var getChartWidth=function(i,j){var start,end,sum=0;if(j instanceof Array){start=j[0];end=j[1];}else{start=+j;end=+j+1;}var isCacheHit=function(){var k;for(k=start;k<end;k++){if(me.widthCache[k]===undefined){return false;}}return true;};var k;if(me.manager.isAsync&&isCacheHit()===false){for(k=start;k<end;k++){if(me.widthCache[k]===undefined){me.manager.queryColWidth(k);sum+=me.manager.chartW||me.manager.master.chartW;}else{sum+=me.widthCache[k];}}}else{for(k=start;k<end;k++){if(me.widthCache[k]===undefined){me.widthCache[k]=me.getCategoricalColWidth(k);}sum+=me.widthCache[k];}}return sum;};var getChartHeight=function(i,j){var start,end,sum=0;if(i instanceof Array){start=i[0];end=i[1];}else{start=+i;end=+i+1;}var isCacheHit=function(){var k;for(k=start;k<end;k++){if(me.heightCache[k]===undefined){return false;}}return true;};var k;if(me.manager.isAsync&&isCacheHit()===false){for(k=start;k<end;k++){if(me.heightCache[k]===undefined){me.manager.queryRowHeight(k);sum+=me.manager.chartH||me.manager.master.chartH;}else{sum+=me.heightCache[k];}}}else{for(k=start;k<end;k++){if(me.heightCache[k]===undefined){me.heightCache[k]=me.getCategoricalRowHeight(k);}sum+=me.heightCache[k];}}return sum;};var getRowSpan=function(i,depth){if(depth===undefined){depth=0;}var iLdsRow=me.mapFromChartToLDSIndex(i,0).r,gridRow=model.mapChartIndexToGrid(iLdsRow,model.rp),o=model.getRowHeaderObj(gridRow,depth),s=model.mapGridIndexToChart(o.o,model.rp),e=model.mapGridIndexToChart(o.o+o.rs-1,model.rp),cnt=e-s+1,rowInChart=me.inChartLayout.r;s*=rowInChart;e=s+cnt*rowInChart-1;return[s,e];};var getColSpan=function(i,depth){if(depth===undefined){depth=0;}var iLdsCol=me.mapFromChartToLDSIndex(0,i).c,gridC=model.mapChartIndexToGrid(iLdsCol,model.cp),o=model.getColHeaderObj(gridC,depth),s=model.mapGridIndexToChart(o.o,model.cp),e=model.mapGridIndexToChart(o.o+o.cs-1,model.cp),cnt=e-s+1,colInChart=me.inChartLayout.c;s*=colInChart;e=s+cnt*colInChart-1;return[s,e];};var createUnitRowHeader=function(w,h,t,l,row,col,nr,nc,css){var iLdsRow,gridRow,obj,lbs,eid,n_id,tui,fid,unit,view=me.view,hAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL),vAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL),showText=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VALUES_SHOW);iLdsRow=me.mapFromChartToLDSIndex(row,col).r;gridRow=model.mapChartIndexToGrid(iLdsRow,model.rp);obj=model.getRowHeaderObj(gridRow,col);fid=obj.fid;n_id=model.headerInfoToProp(0,obj,"n&id");lbs=n_id[0].n;eid=n_id[0].id;tui=obj.tui;unit=model.getRowTitleInfo()[tui];var div=document.createElement("div");div.setAttribute("row",row);div.setAttribute("col","0");div.setAttribute("rowSpan",nr);div.setAttribute("colSpan",nc);div.setAttribute("depth",col);div.setAttribute("class",css);div.setAttribute("type",CONTROL_TYPE.GM_ROW_HEADER);div.setAttribute("text",lbs);div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";if(showText){GMUTIL.fillTextInDiv(div,{objType:IDENTITY_TYPE.ROW_HEADER_TEXT},lbs,w,h,false,me.rhStyles,hAlign,vAlign);}GMUTIL.fillBackgroundDiv(div);div.selectionInfo=[[{eid:eid,v:lbs,tid:unit.id,n:unit.n,isRowAttribute:true,tui:tui}]];div.identity=new mstrmojo.gm.HeaderCellIdentity({objType:IDENTITY_TYPE.ROW_HEADER,eid:eid,v:lbs,tid:unit.id,n:unit.n,tui:tui,fid:fid,isRowAttribute:true,o:obj.o,dpt:obj.dpt,dei:obj.dei,at:obj.at});return div;};var updateUnitColHeader=function(div,w,h,t,l){div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";var view=me.view,text=div.getAttribute("text"),hAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL),vAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_VERTICAL),showText=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VALUES_SHOW);div.innerHTML="";if(showText){GMUTIL.fillTextInDiv(div,{objType:IDENTITY_TYPE.COL_HEADER_TEXT},text,w,h,false,me.chStyles,hAlign,vAlign);}GMUTIL.fillBackgroundDiv(div);};var updateUnitRowHeader=function(div,w,h,t,l){div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";var view=me.view,text=div.getAttribute("text"),hAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL),vAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL),showText=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VALUES_SHOW);div.innerHTML="";if(showText){GMUTIL.fillTextInDiv(div,{objType:IDENTITY_TYPE.ROW_HEADER_TEXT},text,w,h,false,me.rhStyles,hAlign,vAlign);}GMUTIL.fillBackgroundDiv(div);};var createUnitColHeader=function(w,h,t,l,row,col,nr,nc,css){var iLdsCol,gridCol,obj,n_id,lbs,eid,tui,unit,fid,view=me.view,hAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL),vAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_VERTICAL),showText=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VALUES_SHOW);iLdsCol=me.mapFromChartToLDSIndex(row,col).c;gridCol=model.mapChartIndexToGrid(iLdsCol,model.cp);obj=model.getColHeaderObj(gridCol,row);fid=obj.fid;n_id=model.headerInfoToProp(1,obj,"n&id");lbs=n_id[0].n;eid=n_id[0].id;tui=obj.tui;unit=model.getColTitleInfo()[tui];var div=document.createElement("div");div.setAttribute("row","0");div.setAttribute("col",col);div.setAttribute("rowSpan",nr);div.setAttribute("colSpan",nc);div.setAttribute("depth",row);div.setAttribute("class",css);div.setAttribute("type",CONTROL_TYPE.GM_COL_HEADER);div.setAttribute("text",lbs);div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";if(showText){GMUTIL.fillTextInDiv(div,{objType:IDENTITY_TYPE.COL_HEADER_TEXT},lbs,w,h,false,me.chStyles,hAlign,vAlign);}GMUTIL.fillBackgroundDiv(div);div.selectionInfo=[[{eid:eid,v:lbs,tid:unit.id,n:unit.n,isRowAttribute:false,tui:tui}]];div.identity=new mstrmojo.gm.HeaderCellIdentity({objType:IDENTITY_TYPE.COL_HEADER,eid:eid,v:lbs,tid:unit.id,n:unit.n,tui:tui,fid:fid,isRowAttribute:false,o:obj.o,dpt:obj.dpt,dei:obj.dei,at:obj.at});return div;};var createExtraUnitColHeader=function(w,h,t,l,row,col,nr,nc,css){var text,xInfo,dzId,dzIndex,type="",div=document.createElement("div"),metricNames=[""],angIdxArr,angIdsArr,nMetrics=metricNames.length,view=me.view,showText=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VALUES_SHOW);if(me.metricsType===METRICS_POS.MetricsByColumn&&me.isFooterAbove){xInfo=me.getYAxisInfo(row,col,me.haveY1);metricNames=xInfo.items;if(chtInfo.isPie){angIdxArr=me.getMetricsOnAngleBy();if(!xInfo.isMetric){metricNames=model.getMetricNamesFromIndex(angIdxArr);}angIdsArr=model.getMetricIDsFromIndex(angIdxArr);}nMetrics=metricNames.length;type=CONTROL_TYPE.GM_COL_HEADER_EXTRA;}dzId=ENUM_DZID.YAxis;dzIndex=col%nMetrics;text=metricNames[dzIndex];div.setAttribute("row","0");div.setAttribute("col",col);div.setAttribute("rowSpan",nr);div.setAttribute("colSpan",nc);div.setAttribute("depth",row);div.setAttribute("class",css);div.setAttribute("type",type);div.setAttribute("text",text);if(text!==""){div.setAttribute("dzId",dzId);div.setAttribute("dzIndex",dzIndex);}div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";if(showText&&text!==""){GMUTIL.fillTextInDiv(div,{objType:IDENTITY_TYPE.COL_HEADER_TEXT},text,w,h,false,me.chStyles);}GMUTIL.fillBackgroundDiv(div);if(me.metricsType===METRICS_POS.MetricsByColumn&&me.isFooterAbove){if(chtInfo.isPie){div.selectionInfo={mid:angIdsArr[col],midx:angIdxArr[col]};}else{var cellHandlers=xInfo.cellHandlers;div.selectionInfo={mid:xInfo.ids[dzIndex],midx:xInfo.mtsIdxArr[dzIndex],cellHandle:cellHandlers[dzIndex]};}}return div;};var createExtraUnitRowHeader=function(w,h,t,l,row,col,nr,nc,css){var text,yInfo,dzId,dzIndex,type="",div=document.createElement("div"),metricNames=[""],nMetrics=metricNames.length,view=me.view,showText=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VALUES_SHOW);if(me.metricsType===METRICS_POS.MetricsByRow&&me.metricNamesOnRowMetricsOnXAxis){yInfo=me.getXAxisInfo(row,col);metricNames=yInfo.items;nMetrics=metricNames.length;type=CONTROL_TYPE.GM_ROW_HEADER_EXTRA;}dzId=ENUM_DZID.XAxis;dzIndex=row%nMetrics;text=metricNames[dzIndex];div.setAttribute("row",row);div.setAttribute("col",0);div.setAttribute("rowSpan",nr);div.setAttribute("colSpan",nc);div.setAttribute("depth",col);div.setAttribute("class",css);div.setAttribute("type",type);div.setAttribute("text",text);if(text!==""){div.setAttribute("dzId",dzId);div.setAttribute("dzIndex",dzIndex);}div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";if(showText){GMUTIL.fillTextInDiv(div,{objType:IDENTITY_TYPE.ROW_TITLE_TEXT},text,w,h,false,me.rhStyles);}GMUTIL.fillBackgroundDiv(div);if(me.metricsType===METRICS_POS.MetricsByRow&&me.metricNamesOnRowMetricsOnXAxis){var cellHandlers=yInfo.cellHandlers;div.selectionInfo={mid:yInfo.ids[dzIndex],midx:yInfo.mtsIdxArr[dzIndex],cellHandle:cellHandlers[dzIndex]};}return div;};var updateExtraUnitRowHeader=function(div,w,h,t,l){div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";var view=me.view,text=div.getAttribute("text"),hAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL),vAlign=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL),showText=view.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VALUES_SHOW);div.innerHTML="";if(showText){GMUTIL.fillTextInDiv(div,{objType:IDENTITY_TYPE.ROW_HEADER_TEXT},text,w,h,false,me.rhStyles,hAlign,vAlign);}GMUTIL.fillBackgroundDiv(div);};var createUnitYAxis=function(w,h,t,l,row,col,nr,nc,css,isPrimary,subRegion){if(me.metricNamesOnRowMetricsOnXAxis){css="gm-rowheader-cell-dummy";return createExtraUnitRowHeader(w,h,t,l,row,col,nr,nc,css);}var div=document.createElement("div");div.setAttribute("class",css);div.setAttribute("row",row);div.setAttribute("col",col);div.setAttribute("rowSpan",nr);div.setAttribute("colSpan",nc);if(me.clusteredBarSpecialCase){div.setAttribute("type",CONTROL_TYPE.GM_Y_NUMERIC);}else{div.setAttribute("type",me.yIsNumeric?CONTROL_TYPE.GM_Y_NUMERIC:CONTROL_TYPE.GM_Y_CATEGORY);}div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";div.style.backgroundColor="rgba(0,0,0,0)";div.drawAxis=true;if(row%2===1&&me.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)){$CSS.addClass(div,"banding");}var i,text,extraAttributes,iLdsIdx,xInfo,x2Info,yInfo,labelDiv,metricNames,nMetrics,dzId=ENUM_DZID.YAxis,dzIndex,cellHandlers,selInfos=[],labelHeight=0,ABLDualAxisHandling=false,drawNothing=false,mid,mOriId,midx,metricCHPool,axisIdentity,metricIdxArr,isGrid=me.isGrid(),isPie=me.isPie,haveX1=me.haveX1,takeInvalidMetrics=chtInfo.isABL&&me.splitPlottingMetrics;iLdsIdx=me.mapFromChartToLDSIndex(row,col);xInfo=me.getXAxisInfo(row,col,true,takeInvalidMetrics);x2Info=me.getXAxisInfo(row,col,false,takeInvalidMetrics);yInfo=me.getYAxisInfo(row,col,isPrimary,takeInvalidMetrics);if(isGrid&&isPie){metricNames=me.model.getMetricNamesFromIndex(me.getMetricsOnAngleBy());dzId=ENUM_DZID.Angle;}else{if(yInfo.isMetric){metricNames=yInfo.items;cellHandlers=yInfo.cellHandlers;}else{metricNames=[];}}if(yInfo.isMetric&&chtInfo.isABL&&me.splitPlottingMetrics){ABLDualAxisHandling=true;if(yInfo.mtsIdxArr[iLdsIdx.inchtRow]<0){drawNothing=true;}}if(yInfo.isMetric&&!drawNothing){if(isPrimary===false){metricIdxArr=filterInValidMetricIndex(me.getMetricsOnAxisOfChart(row,col,"y",false));}else{metricIdxArr=filterInValidMetricIndex(me.getMetricsOnAxisOfChart(row,col,"y",true));}div.drawAxis=true;$ARR.forEach(metricIdxArr,function(mtsIdx){if(mtsIdx===undefined||mtsIdx<0){div.drawAxis=false;}else{var dzName=isPrimary?"YAxis":"Y2Axis";if(getAxisScaleModeForSingleMetric.call(me,mtsIdx,dzName)===PRP_AXIS_SCALE.PERCELL){div.drawAxis=(me.getChartCountInRow()===1);}}});axisIdentity=new $GM.AxisIdentity({isNumericAxis:true,objType:IDENTITY_TYPE.Y_NUMERIC,metricIdxArr:metricIdxArr});}else{if(!yInfo.isMetric){axisIdentity=new $GM.AxisIdentity({isNumericAxis:false,objType:IDENTITY_TYPE.Y_CATEGORY,attrIdArr:yInfo.ids});}}if(!drawNothing&&me.hasHeaderInY){if(metricNames.length===0&&xInfo.isMetric){metricNames=haveX1?xInfo.items:x2Info.items;cellHandlers=haveX1?xInfo.cellHandlers:x2Info.cellHandlers;dzId=ENUM_DZID.XAxis;}nMetrics=metricNames.length;labelHeight=me.view.textHeightInY+2*TEXT_CHART_SPACE;labelDiv=document.createElement("div");div.metrics=[];var labelInfo,metricInMx,labelContents=[],dzIndexList=[];if(me.combineMetricNameInY){for(i=0;i<nMetrics;i++){dzIndexList.push(i);div.metrics.push(metricNames[i]);}}else{if(ABLDualAxisHandling){dzIndex=iLdsIdx.inchtRow;}else{dzIndex=row%nMetrics;}dzIndexList.push(dzIndex);div.metrics.push(metricNames[dzIndex]);}for(i=0;i<dzIndexList.length;i++){dzIndex=dzIndexList[i];text=metricNames[dzIndex];labelInfo={};labelInfo.extraAttributes={};extraAttributes=labelInfo.extraAttributes;labelInfo.text=text;extraAttributes.dzId=dzId;extraAttributes.dzIndex=dzIndex;extraAttributes.type=CONTROL_TYPE.GM_YLABEL;if(chtInfo.isABL&&cellHandlers){if(cellHandlers[dzIndex]){midx=(cellHandlers[dzIndex].col-me.gts.row.length)%model.getMetricCount();metricInMx=me.getMetricInGSIMx(midx);mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,cellHandle:cellHandlers[dzIndex],objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}else{extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});}if(checkMetricSortDefinition.call(me,extraAttributes.selectionInfo)){labelInfo.sort=true;extraAttributes.sort=true;extraAttributes.sortOrder=me.metricSortInfo.order;labelDiv.innerHTML+=me.metricSortInfo.order?"asc":"desc";}}else{if(chtInfo.isBubbleOrScatter){midx=yInfo.mtsIdxArr[dzIndex];metricInMx=me.getMetricInGSIMx(midx);mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}}extraAttributes.customScale=(getAxisScaleModeForSingleMetric.call(me,midx,"YAxis")===PRP_AXIS_SCALE.CUSTOM);selInfos.push(extraAttributes.selectionInfo);labelContents.push(labelInfo);}div.appendChild(labelDiv);var wgt=new mstrmojo.VisAxisLabel({placeholder:labelDiv,width:h+"px",height:me.view.textHeightInY+"px",cssClass:"gm-yaxis-cell-label",styles:me.yTitleStyles,align:isPrimary?"left":"right",contentData:labelContents});wgt.render();wgt.parent=visGM;me.addDisposable(wgt);if(dzIndexList.length===1){div.labelDiv=wgt.domNode;}else{div.combinedLabelDiv=wgt.domNode;}}else{if(!drawNothing&&yInfo.isMetric){if(metricNames.length===0&&xInfo.isMetric){metricNames=haveX1?xInfo.items:x2Info.items;cellHandlers=haveX1?xInfo.cellHandlers:x2Info.cellHandlers;dzId=ENUM_DZID.XAxis;}nMetrics=metricNames.length;div.metrics=[];var dzIndexList=[];for(i=0;i<nMetrics;i++){dzIndexList.push(i);div.metrics.push(metricNames[i]);}for(i=0;i<dzIndexList.length;i++){dzIndex=dzIndexList[i];text=metricNames[dzIndex];extraAttributes={};extraAttributes.dzId=dzId;extraAttributes.dzIndex=dzIndex;extraAttributes.type=CONTROL_TYPE.GM_YLABEL;if(chtInfo.isABL&&cellHandlers){if(cellHandlers[dzIndex]){midx=(cellHandlers[dzIndex].col-me.gts.row.length)%model.getMetricCount();mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,cellHandle:cellHandlers[dzIndex],objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}else{extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});}}else{if(chtInfo.isBubbleOrScatter){midx=yInfo.mtsIdxArr[dzIndex];mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}}selInfos.push(extraAttributes.selectionInfo);}}}div.selectionInfos=selInfos;var axisDiv=createAxisDiv(w,h,labelHeight,"y",isPrimary);div.setAttribute("isPrimary",isPrimary);div.appendChild(axisDiv);if(!drawNothing&&div.drawAxis){var yAxisScale=me.view.getWidgetPropertyValue(isPrimary?ENUM_XML_TAG.SCALE_Y:ENUM_XML_TAG.SCALE_Y2),yAxisIsScaled=yAxisScale!==undefined&&yAxisScale!==1;me.drawYAxis(axisDiv,w-labelHeight,h,row,iLdsIdx.r,col,false,iLdsIdx.dpIdx,yAxisIsScaled,isPrimary,subRegion,me.hasHeaderInY);}else{if(me.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)){var banding=[{Start:0,Size:h}];me.drawInChartBanding(div,banding,me.bandingFlags[row]);}}div.subRegion=subRegion;if(axisIdentity){div.identity=axisIdentity;}return div;};var createUnitXAxis=function(w,h,t,l,row,col,nr,nc,css,isPrimary,subRegion){var div=document.createElement("div");div.setAttribute("row",row);div.setAttribute("col",col);div.setAttribute("rowSpan",nr);div.setAttribute("colSpan",nc);div.setAttribute("class",css);if(me.clusteredBarSpecialCase){div.setAttribute("type",CONTROL_TYPE.GM_X_NUMERIC);}else{div.setAttribute("type",me.xIsNumeric?CONTROL_TYPE.GM_X_NUMERIC:CONTROL_TYPE.GM_X_CATEGORY);}div.innerHTML="";div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";div.style.backgroundColor="rgba(0,0,0,0)";div.drawAxis=true;var iLdsIdx=me.mapFromChartToLDSIndex(row,col),takeInvalidMetrics=chtInfo.isABL&&me.splitPlottingMetrics,xInfo=me.getXAxisInfo(row,col,isPrimary,takeInvalidMetrics),yInfo=me.getYAxisInfo(row,col,true,takeInvalidMetrics),y2Info=me.getYAxisInfo(row,col,false,takeInvalidMetrics),haveY1=me.haveY1,labelHeight=0,labelDiv,nMetrics,dzId=ENUM_DZID.XAxis,dzIndex,metricNames,cellHandlers,selInfos=[],ABLDualAxisHandling=false,drawNothing=false,mid,mOriId,midx,metricCHPool,metricIdxArr,axisIdentity;if(xInfo.isMetric){metricNames=xInfo.items;cellHandlers=xInfo.cellHandlers;}else{metricNames=[];}if(xInfo.isMetric&&chtInfo.isABL&&me.splitPlottingMetrics){ABLDualAxisHandling=true;if(xInfo.mtsIdxArr[iLdsIdx.inchtCol]<0){drawNothing=true;}}if(xInfo.isMetric&&!drawNothing){if(isPrimary===false){metricIdxArr=filterInValidMetricIndex(me.getMetricsOnAxisOfChart(row,col,"x",false));}else{metricIdxArr=filterInValidMetricIndex(me.getMetricsOnAxisOfChart(row,col,"x",true));}div.drawAxis=true;$ARR.forEach(metricIdxArr,function(mtsIdx){if(mtsIdx===undefined||mtsIdx<0){div.drawAxis=false;}else{var dzName=isPrimary?"XAxis":"X2Axis";if(getAxisScaleModeForSingleMetric.call(me,mtsIdx,dzName)===PRP_AXIS_SCALE.PERCELL){div.drawAxis=(me.getChartCountInCol()===1);}}});axisIdentity=new $GM.AxisIdentity({isNumericAxis:true,objType:IDENTITY_TYPE.X_NUMERIC,metricIdxArr:metricIdxArr});}else{if(!xInfo.isMetric){axisIdentity=new $GM.AxisIdentity({isNumericAxis:false,objType:IDENTITY_TYPE.X_CATEGORY,attrIdArr:xInfo.ids});}}if(!drawNothing&&me.hasFooterInX){var i,text,extraAttributes,labelInfo,metricInMx,labelContents=[],dzIndexList=[],axisTitleWidget;labelDiv=document.createElement("div");labelHeight=me.view.textHeightInX+2*TEXT_CHART_SPACE;if(xInfo.isMetric&&!me.isFooterAbove){div.appendChild(labelDiv);if(metricNames.length===0&&yInfo.isMetric){metricNames=haveY1?yInfo.items:y2Info.items;cellHandlers=haveY1?yInfo.cellHandlers:y2Info.cellHandlers;dzId=ENUM_DZID.YAxis;}nMetrics=metricNames.length;div.metrics=[];if(me.combineMetricNameInX){for(i=0;i<nMetrics;i++){dzIndexList.push(i);div.metrics.push(metricNames[i]);}}else{if(ABLDualAxisHandling){dzIndex=iLdsIdx.inchtCol;}else{dzIndex=col%nMetrics;}dzIndexList.push(dzIndex);div.metrics.push(metricNames[dzIndex]);}for(i=0;i<dzIndexList.length;i++){dzIndex=dzIndexList[i];text=metricNames[dzIndex];labelInfo={};labelInfo.extraAttributes={};extraAttributes=labelInfo.extraAttributes;labelInfo.text=text;extraAttributes.dzId=dzId;extraAttributes.dzIndex=dzIndex;extraAttributes.type=CONTROL_TYPE.GM_XLABEL;if(chtInfo.isABL&&cellHandlers){if(cellHandlers[dzIndex]){midx=(cellHandlers[dzIndex].col-me.gts.row.length)%model.getMetricCount();metricInMx=me.getMetricInGSIMx(midx);mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,cellHandle:cellHandlers[dzIndex],objType:IDENTITY_TYPE.X_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}else{extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({objType:IDENTITY_TYPE.X_METRIC_AXIS_TITLE});}if(checkMetricSortDefinition.call(me,extraAttributes.selectionInfo)){labelInfo.sort=true;extraAttributes.sort=true;extraAttributes.sortOrder=me.metricSortInfo.order;labelDiv.innerHTML=me.metricSortInfo.order?"asc":"desc";}}else{if(chtInfo.isBubbleOrScatter){midx=xInfo.mtsIdxArr[dzIndex];metricInMx=me.getMetricInGSIMx(midx);mid=model.getMetricIDsFromIndex([midx])[0];extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,midx:midx,objType:IDENTITY_TYPE.X_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}}extraAttributes.customScale=(getAxisScaleModeForSingleMetric.call(me,midx,"XAxis")===PRP_AXIS_SCALE.CUSTOM);selInfos.push(extraAttributes.selectionInfo);labelContents.push(labelInfo);}axisTitleWidget=new mstrmojo.VisAxisLabel({placeholder:labelDiv,width:w+"px",height:me.view.textHeightInX+"px",cssClass:(isPrimary?"gm-xaxis-cell-label":"gm-x2axis-cell-label"),styles:me.xTitleStyles,align:isPrimary?"bottom":"top",contentData:labelContents});axisTitleWidget.render();axisTitleWidget.parent=visGM;if(!isPrimary&&!me.drawX2Numeric){var x2AxisLabel=axisTitleWidget.domNode,center={};center.top=(h-labelHeight)>>1;$VISUTIL.positionDomNode(x2AxisLabel,center);}me.addDisposable(axisTitleWidget);if(dzIndexList.length===1){div.labelDiv=axisTitleWidget.domNode;}else{div.combinedLabelDiv=axisTitleWidget.domNode;}}else{if(!xInfo.isMetric){div.appendChild(labelDiv);labelContents=[];if(xInfo.items.length>0){$ARR.forEach(xInfo.items,function(xItem,index){labelInfo={text:xItem,extraAttributes:{type:CONTROL_TYPE.GM_XLABEL,dzId:ENUM_DZID.XAxis,dzIndex:index,identity:new $GM.AttributeAxisTitleIdentity({n:xItem,tid:xInfo.ids[index],objType:IDENTITY_TYPE.X_ATTRIBUTE_AXIS_TITLE})}};labelContents.push(labelInfo);});}axisTitleWidget=new mstrmojo.VisAxisLabel({placeholder:labelDiv,width:w+"px",height:me.view.textHeightInX+"px",cssClass:"gm-xaxis-cell-label",styles:me.xTitleStyles,align:"bottom",contentData:labelContents});axisTitleWidget.render();axisTitleWidget.parent=visGM;me.addDisposable(axisTitleWidget);if(labelContents.length===1){div.labelDiv=axisTitleWidget.domNode;}else{if(labelContents.length>1){div.combinedLabelDiv=axisTitleWidget.domNode;}}}}}else{if(!drawNothing&&!me.hasFooterInX&&xInfo.isMetric){if(metricNames.length===0&&yInfo.isMetric){metricNames=haveY1?yInfo.items:y2Info.items;cellHandlers=haveY1?yInfo.cellHandlers:y2Info.cellHandlers;dzId=ENUM_DZID.YAxis;}nMetrics=metricNames.length;div.metrics=[];var i,text,extraAttributes,dzIndexList=[];for(i=0;i<nMetrics;i++){dzIndexList.push(i);div.metrics.push(metricNames[i]);}for(i=0;i<dzIndexList.length;i++){dzIndex=dzIndexList[i];text=metricNames[dzIndex];extraAttributes={};extraAttributes.dzId=dzId;extraAttributes.dzIndex=dzIndex;extraAttributes.type=CONTROL_TYPE.GM_XLABEL;if(chtInfo.isABL&&cellHandlers){midx=(cellHandlers[dzIndex].col-me.gts.row.length)%model.getMetricCount();mid=model.getMetricIDsFromIndex([midx])[0];extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,midx:midx,cellHandle:cellHandlers[dzIndex],objType:IDENTITY_TYPE.X_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}else{if(chtInfo.isBubbleOrScatter){midx=xInfo.mtsIdxArr[dzIndex];mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,objType:IDENTITY_TYPE.X_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}}selInfos.push(extraAttributes.selectionInfo);}}}div.selectionInfos=selInfos;var axisDiv=createAxisDiv(w,h,labelHeight,"x",isPrimary);div.setAttribute("isPrimary",isPrimary);div.appendChild(axisDiv);if(!drawNothing&&div.drawAxis){var xAxisScale=me.view.getWidgetPropertyValue(isPrimary?ENUM_XML_TAG.SCALE_X:ENUM_XML_TAG.SCALE_X2),xAxisScaleIsChanged=xAxisScale!==undefined&&xAxisScale!==1;me.drawXAxis(axisDiv,w,h-labelHeight,row,col,iLdsIdx.c,false,iLdsIdx.dpIdx,xAxisScaleIsChanged,isPrimary,subRegion);}div.subRegion=subRegion;if(axisIdentity){div.identity=axisIdentity;}return div;};var recalculateMaxRadius=function(){var i,j,chart,mxR,chtRowCnt,chtColCnt,rowCache,chartInfo=me.getChartInfo(),useSharedChart=chartInfo.isBubbleOrScatter&&this.hasSizeBy(),useUniversalRadius=chartInfo.isBubbleOrScatter&&!this.hasSizeBy(),useZeroPadding=false;me.dataAreaPaddingGlobalZero=canUseGlobalZeroDataAreaPadding.call(this,chtInfo);if(me.dataAreaPaddingGlobalZero){return ;}me.maxRowPadding=undefined;me.maxColPadding=undefined;if(me.maxDataAreaPaddingCache){delete me.maxDataAreaPaddingCache;}var cache=me.maxDataAreaPaddingCache=[];chtRowCnt=me.getChartCountInCol();chtColCnt=me.getChartCountInRow();useSharedChart=useSharedChart&&(chtColCnt*chtRowCnt>=1);var maxScanRow=Math.min(chtRowCnt,perfMaxScanRow),maxScanCol=Math.min(chtColCnt,perfMaxScanCol);for(i=0;i<maxScanRow;i++){rowCache=[];cache.push(rowCache);for(j=0;j<maxScanCol;j++){useZeroPadding=canUseZeroDataAreaPadding.call(this,chtInfo,i,j);if(useZeroPadding){rowCache.push($HASH.clone(kZeroPadding));}else{if(useUniversalRadius){chart=chart||me.queryChartInstance(0,0,false,true);mxR=mxR||chart.GetDataAreaPadding();}else{if(useSharedChart){var props={purpose:"clipping"};chart=me.getSharedChartInstance(i,j,props);}else{chart=me.queryChartInstance(i,j,false,true);}mxR=chart.GetDataAreaPadding();}rowCache.push(mxR);}}}};var createFullFledgedChart=function(w,h,t,l,row,col,nr,nc,css,isPrimary,subRegion){var div=document.createElement("div");div.setAttribute("chartDiv",1);div.svg=!this.useCECanvas;div.setAttribute("row",row);div.setAttribute("col",col);div.setAttribute("rowSpan",nr);div.setAttribute("colSpan",nc);div.setAttribute("class",css);div.setAttribute("type",CONTROL_TYPE.GM_MINI_CHART);div.innerHTML="";div.style.width=w+"px";div.style.height=h+"px";div.style.top=t+"px";div.style.left=l+"px";if(me.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)&&!me.bandings[row]){me.bandings[row]=[{Start:0,Size:h}];}me.drawOnDiv(div,w,h,row,col,true,css,subRegion);GMUTIL.fillBackgroundDiv(div);if(row%2===1&&me.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)){$CSS.addClass(div,"banding");}div.subRegion=subRegion;return div;};var updateMiniChart=function(div,w,h,t,l,isPrimary,subRegion){var redraw=false;var ow=parseInt(div.style.width,10);var oh=parseInt(div.style.height,10);if(w&&div.style.width!==w+"px"){div.style.width=w+"px";ow=w;redraw=true;}if(h&&div.style.height!==h+"px"){div.style.height=h+"px";oh=h;redraw=true;}if(t){div.style.top=t+"px";}if(l){div.style.left=l+"px";}if(me.enablePartialRendering&&!isRegionIdentical(div.subRegion,subRegion)){redraw=true;div.subRegion=subRegion;}var r=parseInt(div.getAttribute("row"),10),c=parseInt(div.getAttribute("col"),10);if(r%2===1&&me.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)){$CSS.addClass(div,"banding");}else{$CSS.removeClass(div,"banding");}if(redraw){div.innerHTML="";me.drawOnDiv(div,ow,oh,r,c,true,"",subRegion);GMUTIL.fillBackgroundDiv(div);}};var updateYAxis=function(div,w,h,t,l,isPrimary,subRegion){if(me.metricNamesOnRowMetricsOnXAxis){return updateExtraUnitRowHeader(div,w,h,t,l);}var i,redraw=false,dzId=ENUM_DZID.YAxis,dzIndex;var ow=parseInt(div.style.width,10);var oh=parseInt(div.style.height,10);if(w&&div.style.width!==w+"px"){div.style.width=w+"px";ow=w;redraw=true;}if(h&&div.style.height!==h+"px"){div.style.height=h+"px";oh=h;redraw=true;}if(t){div.style.top=t+"px";}if(l){div.style.left=l+"px";}var r=parseInt(div.getAttribute("row"),10);var c=parseInt(div.getAttribute("col"),10);var iLdsIdx=me.mapFromChartToLDSIndex(r,c);if(r%2===1&&me.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)){$CSS.addClass(div,"banding");}else{$CSS.removeClass(div,"banding");}if(me.enablePartialRendering&&!isRegionIdentical(div.subRegion,subRegion)){redraw=true;div.subRegion=subRegion;}if(redraw||me.forceUpdateAxis()){var takeInvalidMetrics=chtInfo.isABL&&me.splitPlottingMetrics,xInfo=me.getXAxisInfo(r,c,true,takeInvalidMetrics),x2Info=me.getXAxisInfo(r,c,false,takeInvalidMetrics),yInfo=me.getYAxisInfo(r,c,isPrimary,takeInvalidMetrics),labelHeight=0,labelDiv,selInfo,selInfos=[],nMetrics,metricIds,metricNames,mtsIdxArr,isGrid=me.isGrid(),isPie=me.isPie,haveX1=me.haveX1,ABLDualAxisHandling=false,drawNothing=false;if(isGrid&&isPie){mtsIdxArr=me.getMetricsOnAngleBy();metricNames=me.model.getMetricNamesFromIndex(mtsIdxArr);dzId=ENUM_DZID.Angle;}else{if(yInfo.isMetric){mtsIdxArr=yInfo.mtsIdxArr;metricNames=yInfo.items;}else{mtsIdxArr=[];metricNames=[];}}if(yInfo.isMetric&&chtInfo.isABL&&me.splitPlottingMetrics){ABLDualAxisHandling=true;if(yInfo.mtsIdxArr[iLdsIdx.inchtRow]<0){drawNothing=true;}}div.innerHTML="";var cellHandlers=yInfo.cellHandlers,midx,mid,mOriId,metricCHPool;if(!drawNothing&&me.hasHeaderInY){if(!h){h=div.clientHeight;}if(metricNames.length===0&&xInfo.isMetric){metricNames=haveX1?xInfo.items:x2Info.items;mtsIdxArr=haveX1?(xInfo.isMetric?xInfo.mtsIdxArr:[]):(x2Info.isMetric?x2Info.mtsIdxArr:[]);dzId=ENUM_DZID.XAxis;}nMetrics=metricNames.length;labelHeight=me.view.textHeightInY+2*TEXT_CHART_SPACE;labelDiv=document.createElement("div");metricIds=me.model.getMetricIDsFromIndex(mtsIdxArr);div.metrics=[];var text,extraAttributes,labelInfo,labelContents=[],dzIndexList=[];if(me.combineMetricNameInY){for(i=0;i<nMetrics;i++){dzIndexList.push(i);div.metrics.push(metricNames[i]);}}else{if(ABLDualAxisHandling){dzIndex=iLdsIdx.inchtRow;}else{dzIndex=r%nMetrics;}dzIndexList.push(dzIndex);div.metrics.push(metricNames[dzIndex]);}for(i=0;i<dzIndexList.length;i++){dzIndex=dzIndexList[i];text=metricNames[dzIndex];selInfo=me.metricSelectionInfo[metricIds[dzIndex]];labelInfo={};labelInfo.extraAttributes={};extraAttributes=labelInfo.extraAttributes;labelInfo.text=text;extraAttributes.dzId=dzId;extraAttributes.dzIndex=dzIndex;extraAttributes.type=CONTROL_TYPE.GM_YLABEL;selInfos.push(selInfo);if(selInfo){extraAttributes.selectionInfo=extraAttributes.identity=selInfo;if(checkMetricSortDefinition.call(me,extraAttributes.selectionInfo)){labelInfo.sort=true;extraAttributes.sort=true;extraAttributes.sortOrder=me.metricSortInfo.order;labelDiv.innerHTML+=me.metricSortInfo.order?"asc":"desc";}extraAttributes.customScale=(getAxisScaleModeForSingleMetric.call(me,extraAttributes.selectionInfo.midx,"YAxis")===PRP_AXIS_SCALE.CUSTOM);}labelContents.push(labelInfo);}div.appendChild(labelDiv);var wgt=new mstrmojo.VisAxisLabel({placeholder:labelDiv,width:h+"px",height:me.view.textHeightInY+"px",cssClass:"gm-yaxis-cell-label",styles:me.yTitleStyles,align:isPrimary?"left":"right",contentData:labelContents});wgt.render();wgt.parent=visGM;me.addDisposable(wgt);if(dzIndexList.length===1){div.labelDiv=wgt.domNode;div.combinedLabelDiv=undefined;}else{div.labelDiv=undefined;div.combinedLabelDiv=wgt.domNode;}}else{if(!drawNothing&&yInfo.isMetric){if(metricNames.length===0&&xInfo.isMetric){metricNames=haveX1?xInfo.items:x2Info.items;cellHandlers=haveX1?xInfo.cellHandlers:x2Info.cellHandlers;dzId=ENUM_DZID.XAxis;}nMetrics=metricNames.length;div.metrics=[];var dzIndexList=[];for(i=0;i<nMetrics;i++){dzIndexList.push(i);div.metrics.push(metricNames[i]);}for(i=0;i<dzIndexList.length;i++){dzIndex=dzIndexList[i];text=metricNames[dzIndex];extraAttributes={};extraAttributes.dzId=dzId;extraAttributes.dzIndex=dzIndex;extraAttributes.type=CONTROL_TYPE.GM_YLABEL;if(chtInfo.isABL&&cellHandlers){if(cellHandlers[dzIndex]){midx=(cellHandlers[dzIndex].col-me.gts.row.length)%model.getMetricCount();mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,cellHandle:cellHandlers[dzIndex],objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}else{extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});}}else{if(chtInfo.isBubbleOrScatter){midx=yInfo.mtsIdxArr[dzIndex];mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,objType:IDENTITY_TYPE.Y_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}}selInfos.push(extraAttributes.selectionInfo);}}}div.selectionInfos=selInfos;var axisDiv=createAxisDiv(ow,oh,labelHeight,"y",isPrimary);div.setAttribute("isPrimary",isPrimary);div.appendChild(axisDiv);if(!drawNothing&&div.drawAxis){var yAxisScale=me.view.getWidgetPropertyValue(isPrimary?ENUM_XML_TAG.SCALE_Y:ENUM_XML_TAG.SCALE_Y2),yAxisScaleIsChanged=yAxisScale!==undefined&&yAxisScale!==1;me.drawYAxis(axisDiv,ow-labelHeight,oh,r,iLdsIdx.r,c,true,iLdsIdx.dpIdx,yAxisScaleIsChanged,isPrimary,subRegion);}else{if(me.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)){var banding=[{Start:0,Size:h}];me.drawInChartBanding(div,banding,me.bandingFlags[r]);}}}};var updateXAxis=function(div,w,h,t,l,isPrimary,subRegion){var redraw=false,metricNames,dzId=ENUM_DZID.XAxis,selInfo,selInfos=[],metricIds,dzIndex;var ow=parseInt(div.style.width,10);var oh=parseInt(div.style.height,10);if(w&&div.style.width!==w+"px"){div.style.width=w+"px";ow=w;redraw=true;}if(h&&div.style.height!==h+"px"){div.style.height=h+"px";oh=h;redraw=true;}if(t){div.style.top=t+"px";}if(l){div.style.left=l+"px";}if(me.enablePartialRendering&&!isRegionIdentical(div.subRegion,subRegion)){redraw=true;div.subRegion=subRegion;}var r=parseInt(div.getAttribute("row"),10);var c=parseInt(div.getAttribute("col"),10);var iLdsIdx=me.mapFromChartToLDSIndex(r,c);if(redraw||me.forceUpdateAxis()){var takeInvalidMetrics=chtInfo.isABL&&me.splitPlottingMetrics,xInfo=me.getXAxisInfo(r,c,isPrimary,takeInvalidMetrics),yInfo=me.getYAxisInfo(r,c,true,takeInvalidMetrics),y2Info=me.getYAxisInfo(r,c,false,takeInvalidMetrics),haveY1=me.haveY1,labelHeight=0,labelDiv,nMetrics,ABLDualAxisHandling=false,drawNothing=false;metricNames=xInfo.isMetric?xInfo.items:[];var mtsIdxArr=xInfo.isMetric?xInfo.mtsIdxArr:[];if(xInfo.isMetric&&chtInfo.isABL&&me.splitPlottingMetrics){ABLDualAxisHandling=true;if(xInfo.mtsIdxArr[iLdsIdx.inchtCol]<0){drawNothing=true;}}div.innerHTML="";var cellHandlers=xInfo.cellHandlers,midx,mid,mOriId,metricCHPool;if(!drawNothing&&me.hasFooterInX){if(!w){w=div.clientWidth;}var i,text,extraAttributes,labelInfo,labelContents=[],dzIndexList=[],axisTitleWidget;labelDiv=document.createElement("div");labelHeight=me.view.textHeightInX+2*TEXT_CHART_SPACE;if(xInfo.isMetric&&!me.isFooterAbove){div.appendChild(labelDiv);if(metricNames.length===0&&yInfo.isMetric){metricNames=haveY1?yInfo.items:y2Info.items;mtsIdxArr=haveY1?(yInfo.isMetric?yInfo.mtsIdxArr:[]):(y2Info.isMetric?y2Info.mtsIdxArr:[]);dzId=ENUM_DZID.YAxis;}nMetrics=metricNames.length;metricIds=me.model.getMetricIDsFromIndex(mtsIdxArr);div.metrics=[];if(me.combineMetricNameInX){for(i=0;i<nMetrics;i++){dzIndexList.push(i);div.metrics.push(metricNames[i]);}}else{if(ABLDualAxisHandling){dzIndex=iLdsIdx.inchtCol;}else{dzIndex=c%nMetrics;}dzIndexList.push(dzIndex);div.metrics.push(metricNames[dzIndex]);}for(i=0;i<dzIndexList.length;i++){dzIndex=dzIndexList[i];text=metricNames[dzIndex];selInfo=me.metricSelectionInfo[metricIds[dzIndex]];labelInfo={};labelInfo.extraAttributes={};extraAttributes=labelInfo.extraAttributes;labelInfo.text=text;extraAttributes.dzId=dzId;extraAttributes.dzIndex=dzIndex;extraAttributes.type=CONTROL_TYPE.GM_XLABEL;selInfos.push(selInfo);if(selInfo){extraAttributes.selectionInfo=extraAttributes.identity=selInfo;if(checkMetricSortDefinition.call(me,extraAttributes.selectionInfo)){labelInfo.sort=true;extraAttributes.sort=true;extraAttributes.sortOrder=me.metricSortInfo.order;labelDiv.innerHTML+=me.metricSortInfo.order?"asc":"desc";}}extraAttributes.customScale=(getAxisScaleModeForSingleMetric.call(me,extraAttributes.selectionInfo.midx,"XAxis")===PRP_AXIS_SCALE.CUSTOM);labelContents.push(labelInfo);}axisTitleWidget=new mstrmojo.VisAxisLabel({placeholder:labelDiv,width:w+"px",height:me.view.textHeightInX+"px",cssClass:(isPrimary?"gm-xaxis-cell-label":"gm-x2axis-cell-label"),styles:me.xTitleStyles,align:isPrimary?"bottom":"top",contentData:labelContents});axisTitleWidget.render();axisTitleWidget.parent=visGM;if(!isPrimary&&!me.drawX2Numeric){var x2AxisLabel=axisTitleWidget.domNode,center={};center.top=(h-labelHeight)>>1;$VISUTIL.positionDomNode(x2AxisLabel,center);}me.addDisposable(axisTitleWidget);if(dzIndexList.length===1){div.labelDiv=axisTitleWidget.domNode;div.combinedLabelDiv=undefined;}else{div.labelDiv=undefined;div.combinedLabelDiv=axisTitleWidget.domNode;}}else{if(!xInfo.isMetric){div.appendChild(labelDiv);labelContents=[];if(xInfo.items.length>0){$ARR.forEach(xInfo.items,function(xItem,index){labelInfo={text:xItem,extraAttributes:{type:CONTROL_TYPE.GM_XLABEL,dzId:ENUM_DZID.XAxis,dzIndex:index,identity:new $GM.AttributeAxisTitleIdentity({n:xItem,tid:xInfo.ids[index],objType:IDENTITY_TYPE.X_ATTRIBUTE_AXIS_TITLE})}};labelContents.push(labelInfo);});}axisTitleWidget=new mstrmojo.VisAxisLabel({placeholder:labelDiv,width:w+"px",height:me.view.textHeightInX+"px",cssClass:"gm-xaxis-cell-label",styles:me.xTitleStyles,align:"bottom",contentData:labelContents});axisTitleWidget.render();axisTitleWidget.parent=visGM;me.addDisposable(axisTitleWidget);if(labelContents.length===1){div.labelDiv=axisTitleWidget.domNode;}else{if(labelContents.length>1){div.combinedLabelDiv=axisTitleWidget.domNode;}}}}}else{if(!drawNothing&&!me.hasFooterInX&&xInfo.isMetric){if(metricNames.length===0&&yInfo.isMetric){metricNames=haveY1?yInfo.items:y2Info.items;cellHandlers=haveY1?yInfo.cellHandlers:y2Info.cellHandlers;dzId=ENUM_DZID.YAxis;}nMetrics=metricNames.length;div.metrics=[];var i,text,extraAttributes,dzIndexList=[];for(i=0;i<nMetrics;i++){dzIndexList.push(i);div.metrics.push(metricNames[i]);}for(i=0;i<dzIndexList.length;i++){dzIndex=dzIndexList[i];text=metricNames[dzIndex];extraAttributes={};extraAttributes.dzId=dzId;extraAttributes.dzIndex=dzIndex;extraAttributes.type=CONTROL_TYPE.GM_XLABEL;if(chtInfo.isABL&&cellHandlers){midx=(cellHandlers[dzIndex].col-me.gts.row.length)%model.getMetricCount();mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,cellHandle:cellHandlers[dzIndex],objType:IDENTITY_TYPE.X_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}else{if(chtInfo.isBubbleOrScatter){midx=xInfo.mtsIdxArr[dzIndex];mid=model.getMetricIDsFromIndex([midx])[0];mOriId=model.getMetricIDFromIndex(midx);extraAttributes.selectionInfo=extraAttributes.identity=new $GM.MetricAxisTitleIdentity({n:text,mid:mid,mOriId:mOriId,midx:midx,objType:IDENTITY_TYPE.X_METRIC_AXIS_TITLE});metricCHPool=me.metricSelectionInfo;if(!metricCHPool[mid]){metricCHPool[mid]=extraAttributes.selectionInfo;}}}selInfos.push(extraAttributes.selectionInfo);}}}div.selectionInfos=selInfos;var axisDiv=createAxisDiv(ow,oh,labelHeight,"x",isPrimary);div.setAttribute("isPrimary",isPrimary);div.appendChild(axisDiv);if(!drawNothing&&div.drawAxis){var xAxisScale=me.view.getWidgetPropertyValue(isPrimary?ENUM_XML_TAG.SCALE_X:ENUM_XML_TAG.SCALE_X2),xAxisScaleIsChanged=xAxisScale!==undefined&&xAxisScale!==1;me.drawXAxis(axisDiv,ow,oh-labelHeight,r,c,iLdsIdx.c,true,iLdsIdx.dpIdx,xAxisScaleIsChanged,isPrimary,subRegion);}}},calculateOneXAxisStyle=function(labels,width,axisPaddings,allowRotate,canWordWrap){if(labels.length<=0){return XLABEL_STAT.NORMAL;}canWordWrap=canWordWrap||false;var trimLow=0,trimHigh=0,axisBorderPaddings=axisPaddings,labelPadding=10,labelToBorderPaddings=5,allLabelPositions=[],n=labels.length,axisWidth=width-axisBorderPaddings*2,nGroups=labels.length,groupSize=axisWidth/nGroups;var getPosition=function(){var i,item,oneLabelWidth,oneLabelPosition,styles=me.view.HTML5PROPS.AXIS_LABEL_Y;for(i=0;i<n;i++){item=labels[i];oneLabelWidth=$VISUTIL.measureTextWidth(item,styles,0);oneLabelPosition=axisBorderPaddings+(i+0.5)*groupSize-0.5*oneLabelWidth;allLabelPositions.push({Size:oneLabelWidth,Start:oneLabelPosition});}};var fitWithPadding=function(labelInfo){var start=labelInfo.Start,end=start+labelInfo.Size;return(start>=labelToBorderPaddings&&end<=width-labelToBorderPaddings);};var hasOverlap=function(labelInfos,startIndex,step){var i,info,previousInfo,overlap=false;for(i=startIndex;i<labelInfos.length;i+=step){info=labelInfos[i];if(fitWithPadding(info)===false){return true;}if(i>=step){previousInfo=labelInfos[i-step];if(previousInfo.Start+previousInfo.Size+labelPadding>info.Start){return true;}}}return overlap;};getPosition();if(hasOverlap(allLabelPositions,0,1)===false){return XLABEL_STAT.NORMAL;}var evenOk=false,oddOk=false;evenOk=hasOverlap(allLabelPositions,0,2)===false;oddOk=hasOverlap(allLabelPositions,1,2)===false;if(evenOk&&oddOk){return XLABEL_STAT.STAGGER;}if(allowRotate){return XLABEL_STAT.ROTATE;}else{return XLABEL_STAT.HORI_DROP;}},calculateAllXAxisStyle=function(){var i,labels,width,allowRotate,view=me.view,nBarcolumns=1,axisPaddings=0,nCols=this.getChartCountInRow(),xRotateMode=this.property.readItem(ENUM_FORMAT_TAG.X_AXIS_LABELS_ROTATION),scale=view.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_WIDTH),getChartWidth=me.getControllerAPI(DRAWING_API.GET_CHART_WIDTH),maxScanCol=Math.min(100,nCols),style=XLABEL_STAT.NORMAL;if(xRotateMode===undefined){xRotateMode=-1;}allowRotate=xRotateMode===-1||xRotateMode===2;for(i=0;i<maxScanCol;i++){labels=me.getXAxisLabels(i);width=getChartWidth(0,i)*scale;nBarcolumns=this.checkBarColumnsForAxisPadding(0,i);if(nBarcolumns>0){axisPaddings=Math.round(width/nBarcolumns/4);}style=Math.max(style,calculateOneXAxisStyle(labels,width,axisPaddings,allowRotate));if(style===XLABEL_STAT.ROTATE){break;}}return style;};switch(fName){case DRAWING_API.GET_CHART_WIDTH:return getChartWidth;case DRAWING_API.GET_CHART_HEIGHT:return getChartHeight;case DRAWING_API.GET_ROW_HEADER:return createUnitRowHeader;case DRAWING_API.UPDATE_ROW_HEADER:return updateUnitRowHeader;case DRAWING_API.GET_COLUMN_HEADER:return createUnitColHeader;case DRAWING_API.UPDATE_COLUMN_HEADER:return updateUnitColHeader;case DRAWING_API.GET_EXTRA_COLUMN_HEADER:return createExtraUnitColHeader;case DRAWING_API.CREATE_UNIT_Y_AXIS:return createUnitYAxis;case DRAWING_API.CREATE_UNIT_X_AXIS:return createUnitXAxis;case DRAWING_API.GET_FULL_FLEDGED_CHART:return createFullFledgedChart;case DRAWING_API.GET_ROW_SPAN:return getRowSpan;case DRAWING_API.GET_COLUMN_SPAN:return getColSpan;case DRAWING_API.GET_METRICS_ON_X:return this.getMetricsOnXAxis;case DRAWING_API.GET_METRICS_ON_Y:return this.getMetricsOnYAxis;case DRAWING_API.GET_METRICS_ON_SIZE_BY:return this.getSizeByMetrics;case DRAWING_API.UPDATE_MINI_CHART:return updateMiniChart;case DRAWING_API.UPDATE_Y_AXIS:return updateYAxis;case DRAWING_API.UPDATE_X_AXIS:return updateXAxis;case DRAWING_API.MAX_RADIUS_CALC:return recalculateMaxRadius;case DRAWING_API.LAYOUT_ALL_X_AXIS_LABELS:return calculateAllXAxisStyle;case DRAWING_API.LAYOUT_ONE_X_AXIS_LABELS:return calculateOneXAxisStyle;}},getUnifiedMetricCondense:function(mIdx,axis,isPrimary,inChartIdx){var me=this,isCondensed=this.getMetricCondense(mIdx),miniChartCount=axis==="y"?me.model.cic:me.model.cir,chartStep=axis==="y"?me.inChartLayout.r:me.inChartLayout.c,useLog,hasBarAreaShape,chartLayout,isPercentABL=false,maxV,minV,maxTick,minTick,formatString,rowIdx,colIdx,options,sp,result,axisName=axis.toUpperCase()+(isPrimary?"":"2"),abbrLimit,isBubbleScatter=this.isBubbleOrScatter();if(!isCondensed){return false;}else{isCondensed=false;}for(var i=0;i<miniChartCount;i++){if(axis=="y"){rowIdx=inChartIdx+i*chartStep;colIdx=0;}else{rowIdx=0;colIdx=inChartIdx+i*chartStep;}useLog=me.isLogScale(axisName,rowIdx,colIdx);result=getMinMaxForDP.call(this,rowIdx,colIdx);minV=result[axisName+"MinValue"];maxV=result[axisName+"MaxValue"];hasBarAreaShape=me.getOnTheFlyShapeForMetric(getMetricsOnCurrentAxis.call(me,rowIdx,colIdx,axisName+"Axis"));chartLayout=0;if(me.chartSubType===3&&!isBubbleScatter){chartLayout=2;}else{if(me.chartSubType===5&&!isBubbleScatter){isPercentABL=true;chartLayout=1;}}abbrLimit=!!(chartLayout&1)?10:6;options=CEUtility.prepareScalePlateOptions(useLog,hasBarAreaShape,chartLayout);sp=CEUtility.getScalePlate(true);if(sp){result=sp.getMaxMinTickValue(options,chartLayout,maxV,minV);if(isPercentABL){formatString="0%";}else{formatString=me.model.getMetricNumberFormat(mIdx);if(formatString.match("%")!==null){var gmm=this.model,fullFormat=gmm.getFullNumberFormat()[mIdx];if(fullFormat&&fullFormat.nct===4){abbrLimit=10;}}}maxTick=$NUM.formatByMask(formatString,result.Max);minTick=$NUM.formatByMask(formatString,result.Min);if(maxTick.length>abbrLimit||minTick.length>abbrLimit){isCondensed=true;break;}}}return isCondensed;},getMetricCondense:function(mIdx){var metricFmt=this.getMetricFormat(mIdx);return metricFmt&&metricFmt.cds===true;},getMetricFormat:function(mIdx){var gmm=this.model,metricId,cds=false,metricName,strNF;if(mIdx>=0){metricId=gmm.getMetricIDsFromIndex([mIdx])[0];metricName=gmm.getMetricNamesFromIndex([mIdx])[0];cds=gmm.getMetricCondenseFromIndex([mIdx])[0];strNF=gmm.getMetricNumberFormat(mIdx);return{mId:metricId,n:metricName,nf:strNF,cds:cds};}return{};},getMetricFormatFromIndexArray:function(mIdxArr){var res=[],me=this;$ARR.forEach(mIdxArr,function(midx){res.push(me.getMetricFormat(midx));});return res;},hasTheSameFormat:function(mIdxA,mIdxB){var me=this,formatA=me.getMetricFormat(mIdxA),formatB=me.getMetricFormat(mIdxB);return formatA.nf===formatB.nf;},hasCustomOnAxis:function(){var xMxs,yMxs,xCust,yCust;yMxs=filterInValidMetricIndex(this.getMetricsOnYAxis());xMxs=filterInValidMetricIndex(this.getMetricsOnXAxis());xCust=getCustomAxisEnabled.call(this,xMxs,"XAxis");yCust=getCustomAxisEnabled.call(this,yMxs,"YAxis");var hasCust=false;if(!xCust.emptyAxis&&xCust.customAxisEnabled){hasCust=true;}if(!yCust.emptyAxis&&yCust.customAxisEnabled){hasCust=true;}return hasCust;},populateChartRefreshment:function(r,c,props){var dp=getDP.call(this,r,c);dp.rowIndex=r;dp.colIndex=c;props.dataProvider=dp;var getChartWidth=this.getControllerAPI(DRAWING_API.GET_CHART_WIDTH);var getChartHeight=this.getControllerAPI(DRAWING_API.GET_CHART_HEIGHT);var widthScale=this.view.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_WIDTH);var heightScale=this.view.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_HEIGHT);props.size={w:getChartWidth(r,c)*widthScale,h:getChartHeight(r,c)*heightScale};var axisInfo=getMinMaxForDP.call(this,r,c);var chtInfo=this.getChartInfo(),eGT=CHART_TYPE;if(chtInfo.tp===eGT.BUBBLE){props.primaryValueAxis={min:axisInfo.YMinValue,max:axisInfo.YMaxValue};props.secondaryValueAxis={min:axisInfo.XMinValue,max:axisInfo.XMaxValue};}else{}if(chtInfo.tp===eGT.BUBBLE){props.plot={};}else{}},getSharedChartInstance:function(r,c,props){this.sharedCharts=this.sharedCharts||{};var chart=null,key,purpose=props.purpose;if(purpose==="clipping"){this.sharedCharts[purpose]=this.sharedCharts[purpose]||{};var xMxs,yMxs,charts=this.sharedCharts[purpose];key="x:",xMxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"x",true));key+=xMxs.join("-")+"; y:";yMxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"y",true));key+=yMxs.join("-");chart=charts[key];}else{chart=this.sharedCharts[purpose];}if(chart){this.populateChartRefreshment(r,c,props);chart.refreshChartComponents(props);}else{chart=this.queryChartInstance(r,c,false,true);if(purpose==="dataLabelRotation"){if(chart.mDatasetPtr.showDatalabels()===false){return null;}chart.PlainDraw();}if(purpose==="clipping"){this.sharedCharts[props.purpose][key]=chart;}else{this.sharedCharts[props.purpose]=chart;}}return chart;},queryChartInstance:function(r,c,withPaddingMargins,withGraphSize){var chart,paddings,axisMargins,axisTrims,axisPerCells,dp,axisInfo,hasSB,sizeByProps,chartsPosIdMap=this.chartsPosIdMap,chtInfo=this.getChartInfo();if(!chartsPosIdMap){chartsPosIdMap=this.chartsPosIdMap={};}if(!chartsPosIdMap[r]){chartsPosIdMap[r]={};}if(chartsPosIdMap[r][c]){GMUTIL.destroyDisposable(this,mstrmojo.all[chartsPosIdMap[r][c]]);}dp=getDP.call(this,r,c);dp.rowIndex=r;dp.colIndex=c;axisInfo=getMinMaxForDP.call(this,r,c);hasSB=this.hasSizeBy();sizeByProps={HasSizeBy:hasSB};if(hasSB){sizeByProps.Max=axisInfo.ZMaxValue;sizeByProps.Min=axisInfo.ZMinValue;}chart=this.hGetChartInstance({dataProvider:dp});chartsPosIdMap[r][c]=chart.id;axisInfo.GraphHeight=400;axisInfo.LabelPlacement=this.xLabelPlacement;sizeByProps={HasSizeBy:hasSB};if(hasSB){sizeByProps.Max=axisInfo.ZMaxValue;sizeByProps.Min=axisInfo.ZMinValue;}var configureProps={Extremes:axisInfo,SizeBy:sizeByProps};if(withGraphSize){var getChartWidth=this.getControllerAPI(DRAWING_API.GET_CHART_WIDTH);var getChartHeight=this.getControllerAPI(DRAWING_API.GET_CHART_HEIGHT);var widthScale=this.view.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_WIDTH);var heightScale=this.view.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_HEIGHT);configureProps.GraphSize={W:getChartWidth(r,c)*widthScale,H:getChartHeight(r,c)*heightScale};}if(withPaddingMargins){paddings=this.getDataAreaPadding(r,c);axisMargins=this.getChartUniformAxisMargins(r,c);axisTrims=this.getChartUniformAxisTrims(r,c);axisPerCells=this.getPerCellSetting(r,c);mstrmojo.hash.copy(axisTrims,axisMargins);mstrmojo.hash.copy(axisPerCells,axisMargins);configureProps.DataAreaPaddings=paddings;configureProps.UniformAxisPaddings=axisMargins;}configureProps.isABL=chtInfo.isABL;configureProps.GraphType=this.ceChartType;this.completePropForCE(configureProps,{dataProvider:dp});var xMxs,yMxs,x2Mxs,y2Mxs;xMxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"x",true));yMxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"y",true));x2Mxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"x",false));y2Mxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,c,"y",false));var xCust=getCustomAxisEnabled.call(this,xMxs,"XAxis"),yCust=getCustomAxisEnabled.call(this,yMxs,"YAxis"),x2Cust=getCustomAxisEnabled.call(this,x2Mxs,"XAxis"),y2Cust=getCustomAxisEnabled.call(this,y2Mxs,"YAxis");if(xCust.emptyAxis===false){axisInfo.XCustomScale=xCust.customAxisEnabled;axisInfo.XMetrics=xMxs;}if(yCust.emptyAxis===false){axisInfo.YCustomScale=yCust.customAxisEnabled;axisInfo.YMetrics=yMxs;}if(x2Cust.emptyAxis===false){axisInfo.X2CustomScale=x2Cust.customAxisEnabled;axisInfo.X2Metrics=x2Mxs;}if(y2Cust.emptyAxis===false){axisInfo.Y2CustomScale=y2Cust.customAxisEnabled;axisInfo.Y2Metrics=y2Mxs;}axisInfo.XCategoryAxis=axisInfo.XCategoryAxis||{};axisInfo.YCategoryAxis=axisInfo.YCategoryAxis||{};var isClusterOrAbs=(this.chartSubType===PRP_SUBTYPE.CLUSTERED||this.chartSubType===PRP_SUBTYPE.ABSOLUTE),enforceCluster=(this.enableCombiChart||this.getSecondaryMetrics(false).length>0)&&this.hasBarChart&&isClusterOrAbs,enforceFringe=(this.enableCombiChart||this.getSecondaryMetrics(false).length>0)&&this.hasBarChart;axisInfo.XCategoryAxis.EnforceCluster=enforceCluster;axisInfo.XCategoryAxis.EnforceFringe=enforceFringe;axisInfo.YCategoryAxis.EnforceCluster=enforceCluster;axisInfo.YCategoryAxis.EnforceFringe=enforceFringe;var condense=mergeCondense.call(this,r,c);axisInfo.X1CondenseEnfored=condense.X1;axisInfo.YCondenseEnfored=condense.Y1;axisInfo.X2CondenseEnfored=condense.X2;axisInfo.Y2CondenseEnfored=condense.Y2;configureProps.ElementInfo=this.sizeInfo;configureProps.AxisLayout=hgetAxisLayoutPerChartType.call(this,r,c);configureProps.Extremes=axisInfo;chart.configureChart(configureProps);return chart;},calculateRadius:function(){this.getControllerAPI(DRAWING_API.MAX_RADIUS_CALC).call(this);},decideDataLabelRotation:function(){var me=this,hasBar=false,chartInfo=this.getChartInfo(),hasBarShape=this.hasBarChart,isComb=this.isCombo;var idx=0,dp=getDP.call(this,0,0),seriesCount=dp&&dp.getSeriesCount()||0;if(!!dp===false||seriesCount===0){return ;}if(isComb){for(;idx<seriesCount;i++){hasBar=hasBar||dp.getShapeBySeries()===1;}}else{hasBar=this.markerShape===1&&chartInfo.isABL;}if(hasBar===false){return ;}var props={purpose:"dataLabelRotation"},chart=me.getSharedChartInstance(0,0,props);if(!!chart===false){return ;}if(chart.mDatasetPtr&&chart.mDatasetPtr.showDatalabels()===false){return ;}var chartCtx=chart.mChartContextPtr,dataset=chart.mDatasetPtr,w=chartCtx.mGraphWidth,h=chartCtx.mGraphHeight;var needBuildChart=chartCtx.IsBarChart();if(!needBuildChart&&chartCtx.isCombinationChart()){var barShapes=dataset.GetSeriesByShape().Bar,seriesCount=dataset.GetSeriesCount();needBuildChart=(barShapes.length===seriesCount);if(!needBuildChart&&barShapes.length){needBuildChart=true;}}if(needBuildChart){chart.PlainDraw();}else{return ;}var DssGraphMatrixInitedDataLabelRotation=21155,nullTripleId=mstrmojo.chart.gNullTripleId;chartCtx.PutGraphProperty(DssGraphMatrixInitedDataLabelRotation,nullTripleId,null);var result=chart.ShouldRotateDataLabel(w,h);var dataLabelPaddingOption=0;if(result.Adjust&&(chartCtx.IsBarChart(1)||chart.mDatasetPtr.GetSeriesCount()===1)){var dp=getDP.call(this,0,0);if(chartCtx.IsVertical()){chart=this.getAxisChartInstance(dp,0,0,"y",true,0,h,false);if(chart!==null){chart.GetUniformYAxisWidth(h,-1,true);}else{if(chartCtx.IsDualAxis()){chart.GetUniformYAxisWidth(h,-1,false);}}this.YAxisDataLabelPadding=chart&&chart.getAxisPadding(dataLabelPaddingOption).H||0;}else{chart=this.getAxisChartInstance(dp,0,0,"x",true,0,w,false);if(chart!==null){chart.GetUniformXAxisHeight(w,-1,true);}else{if(chartCtx.IsDualAxis()){chart.GetUniformXAxisHeight(w,-1,false);}}this.XAxisDataLabelPadding=chart&&chart.getAxisPadding(dataLabelPaddingOption).H||0;}}},setupAxisCondense:function(){var me=this,xCondense={},yCondense={},x2Condense={},y2Condense={},xInfo=this.getXAxisInfo(),yInfo=this.getYAxisInfo(),x2Info=this.getXAxisInfo(undefined,undefined,false),y2Info=this.getYAxisInfo(undefined,undefined,false),checkCondense=function(condenseInfo,axis,isPrimary){var i,j,id,n,flag,chartCount=axis==="y"?me.inChartLayout.r:me.inChartLayout.c,metricsOnAxisOfChart;for(i=0;i<chartCount;i++){if(axis==="y"){metricsOnAxisOfChart=me.getMetricsOnAxisOfChart(i,0,axis,isPrimary);}else{metricsOnAxisOfChart=me.getMetricsOnAxisOfChart(0,i,axis,isPrimary);}n=metricsOnAxisOfChart.length;if(n===1){id=metricsOnAxisOfChart[0];condenseInfo[id]=me.getUnifiedMetricCondense(id,axis,isPrimary,i);}else{if(n>1){flag=false;for(j=0;j<n;j++){id=metricsOnAxisOfChart[j];if(me.getUnifiedMetricCondense(id,axis,isPrimary,i)){flag=true;break;}if(me.chartSubType!==5){if(j!==0&&!me.hasTheSameFormat(id,metricsOnAxisOfChart[0])){flag=true;break;}}}for(j=0;j<n;j++){id=metricsOnAxisOfChart[j];condenseInfo[id]=flag;}}}}};if(xInfo.isMetric){checkCondense(xCondense,"x",true);}if(yInfo.isMetric){checkCondense(yCondense,"y",true);}if(x2Info.isMetric){checkCondense(x2Condense,"x",false);}if(y2Info.isMetric){checkCondense(y2Condense,"y",false);}this.xCondense=xCondense;this.yCondense=yCondense;this.x2Condense=x2Condense;this.y2Condense=y2Condense;},getRowHeadersToCalcWidth:function(){var cnt=this.rowHeaderCnt,res=[],i,model=this.model;for(i=0;i<cnt;i++){res.push(model.collectHeadersLabels(0,i));}return res;},getColHeadersToCalcWidth:function(){var cnt=this.colHeaderCnt,res=[],i,model=this.model;for(i=0;i<cnt;i++){res.push(model.collectHeadersLabels(1,i));}return res;},createACanvas:function createACanvas(wd,ht,l,t){var canvas=document.createElement("canvas");canvas.width=wd;canvas.height=ht;canvas.style.zIndex=8;canvas.style.top=t+"px";canvas.style.left=l+"px";canvas.style.position="absolute";return canvas;},parseNumericAxisFormat:function parseNumericAxisFormat(isX,isPrimary,row,col){var axisKey=isX?"x":"y";var metricsIndexOnAxis=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(row,col,axisKey,isPrimary));var theFormat="General",gmm=this.model;metricsIndexOnAxis.forEach(function(metricIndex,i){var format=gmm.getMetricNumberFormat(metricIndex);if(!!format&&format.hasOwnProperty("nfs")){format=format.nfs;if(theFormat===undefined){theFormat=format;}else{if(theFormat!==format){theFormat="General";return theFormat;}}}});return theFormat;},postDrawCollecting:function postDrawCollecting(isX,isMetric,isPrimary,chart,chartIndex,w,h){var trims=chart.getUniformAxisTrims(isX,isPrimary),zeroAxisPos,majorGridLinePos,minorGridLinePos,axisNumberFormat,zeroLineFormatStyle;var graphDimention=w,row=0,col=chartIndex;if(!isX){row=chartIndex;col=0;graphDimention=h;}if(chart.IsZeroBaseLineQualified(isX,isPrimary)){zeroAxisPos=chart.GetPositionAtTick(0,isX,graphDimention);}else{zeroAxisPos=null;}var defaultZeroBaseLineFormat=0,axisOriginLineFormat=1;majorGridLinePos=isMetric?chart.getUniformAxisGridLinePosition(true):[];minorGridLinePos=isMetric?chart.getUniformAxisGridLinePosition(false):[];axisNumberFormat=isMetric?(chart.getUniformAxisFormat()||this.parseNumericAxisFormat(isX,isPrimary,row,col)):"";zeroLineFormatStyle=!!chart.useOriginFormatForZeroLine?axisOriginLineFormat:defaultZeroBaseLineFormat;return{MajorGrids:majorGridLinePos,MinorGris:minorGridLinePos,ZeroPos:zeroAxisPos,ZeroStyle:zeroLineFormatStyle,AxisTrims:trims,AxisFormat:axisNumberFormat};},drawYAxis:function(div,w,h,row,rLds,cLds,forceRepaint,dpIdx,scaled,isPrimary,subRegion,forceResize){var banding,dm=this.model,isMetric=this.yIsNumeric,zeroAxisPos=isPrimary?this.yZeroAxisPos:this.y2ZeroAxisPos,majorGridLinePos=this.yMajorGridLinePos,minorGridLinePos=this.yMinorGridLinePos,lds=dm.getLocalDataSet(rLds,cLds),dps=lds.generateDataProvider(),ymgs=this.yAxisMargins;var dp=dps[dpIdx];if(forceRepaint===true){dp.clearGraphJSON();}var chart=this.getAxisChartInstance(dp,row,0,"y",isPrimary,w,h,true);if(chart&&chart.newBorn){chart.GetUniformYAxisWidth(h,-1,isPrimary);ymgs[row]=chart.GetUniformAxisMargins();delete chart.newBorn;}var manualResized=true;if(chart&&!forceResize){manualResized=!!chart.visited;}if(!chart){chart=this.getAxisChartInstance(dp,row,0,"y",isPrimary,w,h,true);chart.GetUniformYAxisWidth(h,-1,isPrimary);ymgs[row]=chart.GetUniformAxisMargins();}else{if(manualResized||scaled){chart.configureChart({GraphSize:{W:w,H:h},ElementInfo:this.sizeInfo,AxisLayout:hgetAxisLayoutPerChartType.call(this,row,0),Timer:this.view.enableCETimer});chart.GetUniformYAxisWidth(h,w,isPrimary);ymgs[row]=chart.GetUniformAxisMargins();}else{ymgs[row]=chart.GetUniformAxisMargins();}}chart.UpdatePartialRenderingWindow(this.enablePartialRendering,subRegion,subRegion?subRegion.flag:2);var extraProps={};if(this.YAxisDataLabelPadding>0&&this.YAxisDataLabelPadding<h){extraProps.dataLabelPadding=this.YAxisDataLabelPadding;}var graphJSON=chart.DrawUniformYAxis(w,h,isPrimary,extraProps),svg=graphJSON.svg;if(this.useCECanvas){var $D=null;if(!this.drawer){$D=this.drawer=new $GM.VecDrawer();}else{$D=this.drawer;}$D.graphData=graphJSON;var cvs=$D.graphNode=this.createACanvas(w,h,0,0);if(isPrimary){cvs.style.left="";cvs.style.right="0px";}else{cvs.style.left="0px";cvs.style.right="";}div.appendChild(cvs);$D.retrieveGraphSrc(h,w);}else{if(this.clusteredBarSpecialCase){svg.setAttribute("type",CONTROL_TYPE.GM_SVG_Y_NUMERIC);}else{svg.setAttribute("type",this.yIsNumeric?CONTROL_TYPE.GM_SVG_Y_NUMERIC:CONTROL_TYPE.GM_SVG_Y_CATEGORY);}svg.style.position="absolute";div.appendChild(svg);gradientCount=chart.mChartContextPtr.mCanvas.mGradientCount;}if(this.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)){banding=chart.getUniformAxisBanding();this.bandings[row]=banding;this.drawInChartBanding(div.parentNode,banding,this.bandingFlags[row]);}var trims,infoCollection=this.postDrawCollecting(false,isMetric,isPrimary,chart,row,w,h);majorGridLinePos[row]=infoCollection.MajorGrids;minorGridLinePos[row]=infoCollection.MinorGris;zeroAxisPos[row]=infoCollection.ZeroPos;trims=infoCollection.AxisTrims;if(trims.isCaTrim){var yCaTrims=this.caAxisTrims[1];yCaTrims[row]=trims;}else{var yNumericTrims=isPrimary?this.yAxisTrims:this.y2AxisTrims;yNumericTrims[row]=trims;}if(isMetric){var yAxisFormats=this.axisFormats["y"+(isPrimary?"1":"2")];yAxisFormats[row]=infoCollection.AxisFormat;}chart.visited=true;},getAxisChartInstance2:function(row,col,whichAxis,isPrimary){var dm=this.model,getChartWidth=this.getControllerAPI(DRAWING_API.GET_CHART_WIDTH),getChartHeight=this.getControllerAPI(DRAWING_API.GET_CHART_HEIGHT),widthScale=this.view.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_WIDTH),heightScale=this.view.getWidgetPropertyValue(ENUM_XML_TAG.SCALE_CHART_HEIGHT),iLdsIdx=this.mapFromChartToLDSIndex(row,col),rLds=whichAxis==="x"?row:iLdsIdx.r,cLds=whichAxis==="x"?iLdsIdx.c:col,dpIdx=iLdsIdx.dpIdx,lds=dm.getLocalDataSet(rLds,cLds),dps=lds.generateDataProvider(),dp=dps[dpIdx],w=getChartWidth(row,col)*widthScale,h=getChartHeight(row,col)*heightScale;return this.getAxisChartInstance(dp,row,col,whichAxis,isPrimary,w,h,true);},getAxisChartInstance:function(dp,row,col,whichAxis,isPrimary,w,h,queryCache){var axisInfo,chart,paddings;var metricsIndexOnAxis=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(row,col,whichAxis,isPrimary));var axisCust=getCustomAxisEnabled.call(this,metricsIndexOnAxis,whichAxis==="x"?"XAxis":"YAxis");var axisKey=(isPrimary===false)?whichAxis.toUpperCase()+"2AxisChart":whichAxis.toUpperCase()+"AxisChart";var xAxisLayout=whichAxis==="x"&&{Layout:this.xLabelPlacement,StartRow:getStaggerStartPos(this.widthRatio,col),EnforceCluster:(this.enableCombiChart||this.getSecondaryMetrics(false).length>0)&&this.hasBarChart&&isClusterOrAbs,EnforceFringe:(this.enableCombiChart||this.getSecondaryMetrics(false).length>0)&&this.hasBarChart};queryCache=queryCache||false;if(axisCust.emptyAxis){return null;}if(queryCache&&!this.forceUpdateAxis()){if(dp[axisKey]){if(whichAxis==="x"){var xAxisRotate=this.property.readItem(ENUM_FORMAT_TAG.X_AXIS_LABELS_ROTATION);dp[axisKey].updateUniformAxisLabelRotation(this.xLabelPlacement,xAxisRotate);dp[axisKey].updateUniformXAxisLayout(xAxisLayout);}paddings=this.getDataAreaPadding(row,col);if(!!paddings){dp[axisKey].UpdateValueAxisPadding(paddings);}if(dp[axisKey].newBorn){delete dp[axisKey].newBorn;}return dp[axisKey];}}GMUTIL.destroyDisposable(this,dp&&dp[axisKey]);dp.rowIndex=row;dp.colIndex=col;dp.EnforedCondense=dp.EnforedCondense||{};chart=this.hGetChartInstance({dataProvider:dp,isAxis:true});axisInfo=getMinMaxForDP.call(this,row,col);var axMin,axMinKey=whichAxis.toUpperCase()+"MinValue";axMin=axisInfo[axMinKey];if(axMin!==undefined&&axMin<0&&this.msgCenter){if(this.isLogScale(isPrimary?whichAxis:whichAxis+"2",row,col)){var visGM=this.view;if(visGM.logScaleChanged){var errMsg=mstrmojo.desc(13656,"Data less than or equal to zero has been removed from the graph");this.msgCenter[errMsg]=true;visGM.logScaleChanged=false;}}}axisInfo.GraphHeight=400;axisInfo.LabelPlacement=this.xLabelPlacement;axisInfo.xAxisRotateMode=this.property.readItem(ENUM_FORMAT_TAG.X_AXIS_LABELS_ROTATION);if(isPrimary===false){dp[axisKey]=chart;axisInfo[whichAxis.toUpperCase()+"2Metrics"]=metricsIndexOnAxis;axisInfo[whichAxis.toUpperCase()+"2CustomScale"]=axisCust.customAxisEnabled;axisInfo[whichAxis.toUpperCase()+"2CondenseLabel"]=this[whichAxis+"2Condense"];axisInfo[whichAxis.toUpperCase()+"2CondenseEnfored"]=dp.EnforedCondense[whichAxis.toUpperCase()+"2"]||false;}else{dp[axisKey]=chart;axisInfo[whichAxis.toUpperCase()+"Metrics"]=metricsIndexOnAxis;axisInfo[whichAxis.toUpperCase()+"CustomScale"]=axisCust.customAxisEnabled;axisInfo[whichAxis.toUpperCase()+"CondenseLabel"]=this[whichAxis+"Condense"];axisInfo[whichAxis.toUpperCase()+"CondenseEnfored"]=dp.EnforedCondense[whichAxis.toUpperCase()]||false;}if(this.forceUpdateAxis()){paddings=this.getDataAreaPadding(row,col);if(!!paddings){dp[axisKey].UpdateValueAxisPadding(paddings);}}var isClusterOrAbs=(this.chartSubType===PRP_SUBTYPE.CLUSTERED||this.chartSubType===PRP_SUBTYPE.ABSOLUTE);if(whichAxis==="x"){axisInfo.XCategoryAxis=xAxisLayout;}else{axisInfo.YCategoryAxis={EnforceCluster:(this.enableCombiChart||this.getSecondaryMetrics(false).length>0)&&this.hasBarChart&&isClusterOrAbs,EnforceFringe:(this.enableCombiChart||this.getSecondaryMetrics(false).length>0)&&this.hasBarChart};}var props={Extremes:axisInfo};this.completePropForCE(props,{dataProvider:dp,isAxis:true});props.AxisLayout=hgetAxisLayoutPerChartType.call(this,row,col);chart.configureChart(props);chart.newBorn=true;return chart;},drawXAxis:function(div,w,h,rLds,col,cLds,forceRepaint,dpIdx,scaled,isPrimary,subRegion){var dm=this.model,isNumeric=this.xIsNumeric,zeroAxisPos=isPrimary?this.xZeroAxisPos:this.x2ZeroAxisPos,majorGridLinePos=this.xMajorGridLinePos,minorGridLinePos=this.xMinorGridLinePos,lds=dm.getLocalDataSet(rLds,cLds),dps=lds.generateDataProvider(),dp=dps[dpIdx],xmgs=this.xAxisMargins;if(forceRepaint===true){dp.clearGraphJSON();}var chart=this.getAxisChartInstance(dp,0,col,"x",isPrimary,w,h,true);if(chart&&chart.newBorn){chart.GetUniformXAxisHeight(w,-1,isPrimary);xmgs[col]=chart.GetUniformAxisMargins();delete chart.newBorn;}var manualResized=true;if(chart){manualResized=!!chart.visited;}if(!chart){chart=this.getAxisChartInstance(dp,0,col,"x",isPrimary,w,h,true);chart.GetUniformXAxisHeight(w,-1,isPrimary);xmgs[col]=chart.GetUniformAxisMargins();}else{if(manualResized||scaled){chart.configureChart({GraphSize:{W:w,H:h},ElementInfo:this.sizeInfo,AxisLayout:hgetAxisLayoutPerChartType.call(this,0,col),Timer:this.view.enableCETimer});chart.GetUniformXAxisHeight(w,h,isPrimary);xmgs[col]=chart.GetUniformAxisMargins();}else{xmgs[col]=chart.GetUniformAxisMargins();}}chart.UpdatePartialRenderingWindow(this.enablePartialRendering,subRegion,subRegion?subRegion.flag:2);var extraProps={};if(this.XAxisDataLabelPadding>0&&this.XAxisDataLabelPadding<w){extraProps.dataLabelPadding=this.XAxisDataLabelPadding;}var graphJSON=chart.DrawUniformXAxis(w,h,isPrimary,extraProps),svg=graphJSON.svg;if(this.useCECanvas){var $D=null;if(!this.drawer){$D=this.drawer=new $GM.VecDrawer();}else{$D=this.drawer;}$D.graphData=graphJSON;var cvs=$D.graphNode=this.createACanvas(w,h,0,0);if(isPrimary){cvs.style.top="0px";cvs.style.bottom="";}else{cvs.style.top="";cvs.style.bottom="0px";}div.appendChild(cvs);$D.retrieveGraphSrc(h,w);}else{if(this.clusteredBarSpecialCase){svg.setAttribute("type",CONTROL_TYPE.GM_SVG_X_NUMERIC);}else{svg.setAttribute("type",this.xIsNumeric?CONTROL_TYPE.GM_SVG_X_NUMERIC:CONTROL_TYPE.GM_SVG_X_CATEGORY);}svg.style.position="absolute";div.appendChild(svg);gradientCount=chart.mChartContextPtr.mCanvas.mGradientCount;}var trims,infoCollection=this.postDrawCollecting(true,isNumeric,isPrimary,chart,col,w,h);majorGridLinePos[col]=infoCollection.MajorGrids;minorGridLinePos[col]=infoCollection.MinorGris;zeroAxisPos[col]=infoCollection.ZeroPos;trims=infoCollection.AxisTrims;if(trims.isCaTrim){var xCaTrims=this.caAxisTrims[0];xCaTrims[col]=trims;}else{var xNumericTrims=isPrimary?this.xAxisTrims:this.x2AxisTrims;xNumericTrims[col]=trims;}if(isNumeric){var xAxisFormats=this.axisFormats["x"+(isPrimary?"1":"2")];xAxisFormats[col]=infoCollection.AxisFormat;}chart.visited=true;},mapFromChartToLDSIndex:function(r,c){var inChartLayout=this.inChartLayout,row=Math.floor(r/inChartLayout.r),col=Math.floor(c/inChartLayout.c),inchtRow=r%inChartLayout.r,inchtCol=c%inChartLayout.c,dpIdx=inchtRow*inChartLayout.c+inchtCol;return{r:row,c:col,dpIdx:dpIdx,inchtRow:inchtRow,inchtCol:inchtCol};},drawInChartZeroLine:function(div,w,h,r,c){var zeroLineDiv,xZeroLinePos=this.xZeroAxisPos[c],yZeroLinePos=this.yZeroAxisPos[r],x2ZeroLinePos=this.x2ZeroAxisPos[c],y2ZeroLinePos=this.y2ZeroAxisPos[r],dashedLine=false;if(this.chartType===CHART_TYPE.BAR){if(this.axisFormat.xAxOriLnShw){xZeroLinePos=x2ZeroLinePos=null;}else{dashedLine=true;}if(this.axisFormat.yAxOriLnShw){yZeroLinePos=y2ZeroLinePos=null;}else{dashedLine=true;}}if(yZeroLinePos){zeroLineDiv=createHorizontalZeroLine(w,yZeroLinePos,dashedLine);div.appendChild(zeroLineDiv);}if(y2ZeroLinePos){zeroLineDiv=createHorizontalZeroLine(w,y2ZeroLinePos,dashedLine);div.appendChild(zeroLineDiv);}if(xZeroLinePos){zeroLineDiv=createVerticalZeroLine(h,xZeroLinePos,dashedLine);div.appendChild(zeroLineDiv);}if(x2ZeroLinePos){zeroLineDiv=createVerticalZeroLine(h,x2ZeroLinePos,dashedLine);div.appendChild(zeroLineDiv);}},drawInChartBanding:function(div,bandings,flag){var i,start,size,blockDiv,n=bandings.length,doc=document,bandingCtn=doc.createElement("div");bandingCtn.setAttribute("class","gm-banding-container");for(i=0;i<n;i++){start=bandings[i].Start;size=bandings[i].Size;blockDiv=doc.createElement("div");blockDiv.setAttribute("class","gm-banding-div");blockDiv.style.top=start+"px";blockDiv.style.height=size+"px";if(i%2!==flag){$CSS.addClass(blockDiv,"odd");}bandingCtn.appendChild(blockDiv);}div.appendChild(bandingCtn);},drawOnDiv:function(div,w,h,r,c,forceRepaint,css,subRegion){var bandings=this.bandings,prFlag=subRegion?subRegion.flag:2,wd,ht,dp,chart;dp=getDP.call(this,r,c);if(dp.isBlankGrid){var chartInfo=this.getChartInfo();if(chartInfo.isGrid===false){return ;}}if(forceRepaint===true){dp.clearGraphJSON();}wd=w;ht=h;dp.r=r;dp.c=c;var graphJSON=dp.graphJSON;if(!graphJSON){chart=this.queryChartInstance(r,c,true,true);var localPR=true;if(this.enablePartialRendering){if(this.isBubbleOrScatter()){var bubblePRTH=1000;localPR=(dp.getGroupCount()>bubblePRTH);}}chart.UpdatePartialRenderingWindow(this.enablePartialRendering&&localPR,subRegion,prFlag);var props={xDataLabelPadding:this.XAxisDataLabelPadding,yDataLabelPadding:this.YAxisDataLabelPadding};graphJSON=chart.DrawDataAreaForUniformAxis(wd,ht,props);dp.graphJSON=graphJSON;}div.hiddenItems=graphJSON.hiddenItems;var svg=graphJSON.svg;if(this.useCECanvas){var $D=null;if(!this.drawer){$D=this.drawer=new $GM.VecDrawer();}else{$D=this.drawer;}$D.graphData=graphJSON;var cvs;cvs=$D.graphNode=this.createACanvas(wd,ht,0,0);div.appendChild(cvs);$D.retrieveGraphSrc(ht,wd);}else{svg.setAttribute("type",CONTROL_TYPE.GM_SVG_CHART);div.appendChild(svg);gradientCount=chart.mChartContextPtr.mCanvas.mGradientCount;}this.drawInChartZeroLine(div,w,h,r,c);if(this.view.getWidgetPropertyValue(ENUM_XML_TAG.BANDING)){if(this.yIsNumeric){var banding=[{Start:0,Size:h}];this.drawInChartBanding(div,banding,this.bandingFlags[r]);}else{if(bandings[r]!==undefined){this.drawInChartBanding(div,bandings[r],this.bandingFlags[r]);}}}},hasSizeBy:function(){var szBy=this.dz.SizeBy.TemplateMetric;return(szBy&&szBy.length>0)||false;},hasColorBy:function(){var visGM=this.view;if(visGM.noData){return false;}return this.model.colorType!==COLOR_BY_TYPE.NULL;},isAxisAttributeInColorBy:function isAxisAttributeInColorBy(){var dz=this.dz,xAxis=dz.XAxis,yAxis=dz.YAxis,colorBy=dz.ColorBy,axisAttrs=(xAxis.TemplateUnit||[]).concat(yAxis.TemplateUnit||[]),colorByAttrs=colorBy.TemplateUnit||[],hasMetricNames=function(n){return typeof n.MetricNames!=="undefined";};if((hasMetricNames(xAxis)||hasMetricNames(yAxis))&&hasMetricNames(colorBy)){return true;}for(var i=0;i<axisAttrs.length;++i){if($ARR.find(colorByAttrs,"n",axisAttrs[i].n)>=0){return true;}}return false;},completePropForCE:function(props,iProps){var graphSize=iProps.graphSize,chtInfo=this.getChartInfo(),model=this.model,tempProps,outputType;if(this.useCECanvas){outputType=105;}else{outputType=103;}tempProps={isABL:chtInfo.isABL,OutputType:outputType,GraphType:this.ceChartType,ThemeType:this.view.theme,ColorBy:{HasColorBy:model.colorType!==COLOR_BY_TYPE.NULL},ElementInfo:this.sizeInfo};if(graphSize){tempProps.GraphSize=graphSize;}if(this.enableCombiChart){tempProps.ShapeType=203;}else{if(this.ceMarkerShape){tempProps.ShapeType=this.ceMarkerShape;}}$HASH.copy(tempProps,props);},hGetChartInstance:function(iProps){var dataProvider=iProps.dataProvider,chart=hPrepareGraph.call(this,iProps);if(!chart){$VISUTIL.visPrint("chart instance is invalid");dataProvider.testDataProvider();}return chart;},getStyleEffectsOptions:function(){var visGM=this.view;if(visGM.noData){return[];}var options=[],mtxArr,me=this,clrOption=this.getColorByOptions();options.push({opt:mstrmojo.desc(2058,"All"),optLvl:$SEL_OPT_LVL.ALL_SHAPE,comb:-1});mtxArr=this.getMetricsOnYAxis();mtxArr=mtxArr.concat(this.getMetricsOnXAxis());$ARR.forEach(mtxArr,function(m){options.push(getOptionObjArr.call(me,[m]));});if(clrOption){options.push(clrOption);}var shapeCollectionIdentity=visGM.identity;if(shapeCollectionIdentity&&shapeCollectionIdentity.identityArr&&shapeCollectionIdentity.identityArr.length>0){options.push({opt:mstrmojo.desc(12091,"Selected Elements"),optLvl:$SEL_OPT_LVL.ITSELF,comb:-1});}return options;},getColorByOptions:function(){var visGM=this.view;if(visGM.noData){return[];}var colorByOption,subOptions=[],gmm=this.model,colorType=gmm.colorType,colorByData,colorByTitle,els,arrayOfComb;function getComb(token){var i,lComb=[],levels=token.levels,elements=token.elements,types=token.types,len=levels.length;for(i=0;i<len;i++){lComb.push({eid:elements[i],tid:levels[i],tp:types[i]});}return lComb;}if(colorType===COLOR_BY_TYPE.ATT||colorType===COLOR_BY_TYPE.ATT_METRICS||colorType===COLOR_BY_TYPE.METRICS_ITEM){colorByData=gmm.getColorByLegendInfo();colorByTitle=colorByData.item;els=colorByData.elements;$ARR.forEach(els,function(e){subOptions.push({opt:e.label,comb:getComb(e.token),optLvl:$SEL_OPT_LVL.COLOR_BY});});arrayOfComb=visGM.arrayOfComb;if(arrayOfComb&&arrayOfComb.length>1){subOptions.push({opt:mstrmojo.desc(12092,"Multiple Elements"),comb:[],key:"multiple",optLvl:$SEL_OPT_LVL.COLOR_BY});}colorByOption={opt:colorByTitle,optLvl:$SEL_OPT_LVL.COLOR_BY,comb:-1,subOptions:subOptions};if(colorType===COLOR_BY_TYPE.METRICS_ITEM){colorByOption.isMetricNames=true;}return colorByOption;}return undefined;},getNumericAxisOptions:function(isAxisScale,forceToAxis,forceToMetric,szmInAxis,collisionSzM){var visGM=this.view;if(visGM.noData){return[];}var chtInfo=this.getChartInfo(),allMtxIdx=[],me=this,inChtL=this.inChartLayout,ir=inChtL.r,ic=inChtL.c,opts=[],mtxArrY1=[],mtxArrY2=[],mtxArrX1=[],mtxArrX2=[],r,c,szbMtxArr,szbOnly;if(chtInfo.tp!==CHART_TYPE.GRID){for(r=0;r<ir;r++){mtxArrY1=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,0,"y",true));if(mtxArrY1.length>0){if(!forceToMetric){opts.push(getOptionObjArr.call(me,mtxArrY1,"y",forceToAxis));}allMtxIdx=allMtxIdx.concat(mtxArrY1);}mtxArrY2=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(r,0,"y",false));if(mtxArrY2.length>0){if(!forceToMetric){opts.push(getOptionObjArr.call(me,mtxArrY2,"y2",forceToAxis));}allMtxIdx=allMtxIdx.concat(mtxArrY2);}}for(c=0;c<ic;c++){mtxArrX1=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(0,c,"x",true));if(mtxArrX1.length>0){if(!forceToMetric){opts.push(getOptionObjArr.call(me,mtxArrX1,"x",forceToAxis));}allMtxIdx=allMtxIdx.concat(mtxArrX1);}mtxArrX2=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(0,c,"x",false));if(mtxArrX2.length>0){if(!forceToMetric){opts.push(getOptionObjArr.call(me,mtxArrX2,"x2",forceToAxis));}allMtxIdx=allMtxIdx.concat(mtxArrX2);}}}if(forceToMetric){allMtxIdx.forEach(function(m){opts.push(getOptionObjArr.call(me,[m],"x",forceToAxis));});}if(isAxisScale){var hasSharedSizeByMetric=false;szbMtxArr=this.getSizeByMetrics();szbOnly=[];$ARR.forEach(szbMtxArr,function(midx){if(allMtxIdx.indexOf(midx)<0){szbOnly.push(midx);}else{hasSharedSizeByMetric=true;if(collisionSzM){collisionSzM.push(midx);}}});if(chtInfo.isBubbleOrScatter&&!this.splitPlottingMetrics&&hasSharedSizeByMetric){}else{if(szbOnly.length>0){allMtxIdx=allMtxIdx.concat(szbOnly);opts.push(getOptionObjArr.call(me,szbOnly,"z"));}}if(szmInAxis&&hasSharedSizeByMetric){$ARR.forEach(szbMtxArr,function(midx){if(mtxArrY1.indexOf(midx)>=0){szmInAxis.push("y1");}if(mtxArrY2.indexOf(midx)>=0){szmInAxis.push("y2");}if(mtxArrX1.indexOf(midx)>=0){szmInAxis.push("x1");}if(mtxArrX2.indexOf(midx)>=0){szmInAxis.push("x2");}});}}if(opts.length>1){opts.unshift({opt:mstrmojo.desc(2460,"All Metrics"),mos:this.getMetricFormatFromIndexArray(allMtxIdx),key:"AllMetrics"});}return opts;},getDependentMetricOptions:function(){var visGM=this.view;if(visGM.noData){return[];}var mtxIdxArr,me=this,options=[];mtxIdxArr=getDependentMetrics.call(this);$ARR.forEach(mtxIdxArr,function(m){options.push(getOptionObjArr.call(me,[m]));});return options;},getIndependentMetricOptions:function(){var visGM=this.view;if(visGM.noData){return[];}var mtxIdxArr=[],me=this,chtInfo=this.getChartInfo(),options=[];if(chtInfo.tp===CHART_TYPE.BUBBLE||chtInfo.tp===CHART_TYPE.SCATTER){mtxIdxArr=this.getMetricsOnXAxis();}$ARR.forEach(mtxIdxArr,function(m){options.push(getOptionObjArr.call(me,[m]));});return options;},getRealReferenceOptionFromAxisOption:function(axOpt,refType,modix){var visGM=this.view;if(visGM.noData){return[];}var opt=$HASH.clone(axOpt),i=refType-1;opt.opt=opt.opt+" - "+refModelDesc[i];opt.key=opt.key+","+refModelModelType[i];opt.refType=refType;if(modix!==undefined){opt.modix=modix;}return opt;},getReferenceAxisOption:function(){var visGM=this.view;if(visGM.noData){return[];}var forceToAxis=false,options=[],axisOptions;if(this.isStacked&&!this.splitPlottingMetrics){forceToAxis=true;}axisOptions=this.getNumericAxisOptions(false,forceToAxis,!forceToAxis);axisOptions.forEach(function(axOpt){if(axOpt.key!=="AllMetrics"){options.push(axOpt);}});return options;},getReferenceLineOptions:function(){var visGM=this.view;if(visGM.noData){return[];}var options=[],me=this,axisOptions;axisOptions=this.getReferenceAxisOption();axisOptions.forEach(function(axOpt){var refType;for(refType in $REF_TYPE){if($REF_TYPE.hasOwnProperty(refType)){options.push(me.getRealReferenceOptionFromAxisOption(axOpt,$REF_TYPE[refType]));}}});return options;},getEnabledReferenceLineOptions:function(opt){var visGM=this.view;if(visGM.noData||opt===undefined){return[];}var hostKey=opt.key.split(",")[0],refDef=this[ENUM_XML_TAG.REF_LINE_DEF],refDefPerMtc=refDef[hostKey],res=[],typeLevelRefDef,mdTy;var getSingleOption=function(singleLineDef){var resOpt={};resOpt.refType=parseInt(mdTy,10);resOpt.key=hostKey+","+refModelModelType[mdTy-1]+","+singleLineDef.modix;resOpt.opt=hostKey+" - "+refModelDesc[mdTy-1];if(resOpt.refType===$REF_TYPE.CONST){resOpt.c=parseFloat(singleLineDef[ENUM_XML_TAG.REF_CONST_VALUE]);resOpt.lin=singleLineDef[ENUM_XML_TAG.REF_LINE_NAME];}resOpt.modix=singleLineDef.modix;resOpt.existing=true;res.push(resOpt);};for(mdTy in refDefPerMtc){if(refDefPerMtc.hasOwnProperty(mdTy)){var refType=parseInt(mdTy,10);typeLevelRefDef=refDefPerMtc[refType];$ARR.forEach(typeLevelRefDef,getSingleOption);}}return res;},getShowDataLabelOptions:function(){var visGM=this.view;if(visGM.noData){return[];}if(this.dlOptions){return this.dlOptions;}var me=this,chtInfo=this.getChartInfo(),mtxIdxArr,options=[];if(chtInfo.isPie){mtxIdxArr=this.getMetricsOnAngleBy();}else{if(chtInfo.tp!==CHART_TYPE.GRID){mtxIdxArr=getDependentMetrics.call(this);}else{mtxIdxArr=this.getSizeByMetrics();}}$ARR.forEach(mtxIdxArr,function(m){options.push(getOptionObjArr.call(me,[m]));});if(options.length>1){options.unshift({opt:mstrmojo.desc(2460,"All Metrics"),mos:this.getMetricFormatFromIndexArray(mtxIdxArr),key:"AllMetrics"});}this.dlOptions=options;return options;},getAttributeSortPlusExistedMetricSort:function(header,ascending){if(header.dropzones===undefined){header=this.attributeSelectionInfo[header.tid];}var escapeMetricSort=false,visGM=this.view,cellHandle=visGM.getWidgetPropertyValue(ENUM_XML_TAG.SORT_INDEX),cellSortAsc=visGM.getWidgetPropertyValue(ENUM_XML_TAG.SORT_ORDER);var chtInfo=this.getChartInfo();if(chtInfo.isABL&&(header.dropzones.indexOf("XAxis")>=0||header.dropzones.indexOf("YAxis")>=0)){escapeMetricSort=true;if(cellHandle){this.property.removeItem(ENUM_XML_TAG.SORT_INDEX);this.property.removeItem(ENUM_XML_TAG.SORT_ORDER);}}if(!cellHandle){cellHandle=null;}if(escapeMetricSort||!this.showMetricSortIcon){return this.getMetricSortDefinition(null,cellSortAsc,header,ascending);}return this.getMetricSortDefinition(cellHandle,cellSortAsc,header,ascending);},getMetricSortDefinition:function(cellIndex,ascending,attributeHeader,attributeHeaderAscending){var sortsArray=[],me=this,chtInfo=this.getChartInfo(),gmm=this.model,mcnt=gmm.getMetricCount(),i,rowAttrSorts=[],colAttrSorts=[],unitObject={},cell=null,collevel=this.colHeaderCnt,rowlevel=this.rowHeaderCnt,attTitle,gvsRI,gvsCI,sortMtcIdx,allMetrics,selPropArr=["fi","headerID","headerText","id","idx","levelIndex","n","ui","tui"],metricObj,sortType,attCntOnRow=gmm.getUnitAttributesCountOnRow(),attCntOnCol=gmm.getUnitAttributesCountOnCol(),keepMatrixStructureInFrontEnd=false,selObj,moreInfo;var escapeXAxisAtt=false,escapeYAxisAtt=false;if(chtInfo.isABL&&this.sortingMetric){if(chtInfo.dirc===ABL_DIRECTION.VERTICAL){escapeXAxisAtt=true;}else{escapeYAxisAtt=true;}}if(attributeHeader===undefined){attributeHeader=null;}if(attributeHeaderAscending===undefined){attributeHeaderAscending=true;}for(i=0;i<attCntOnCol;++i){cell=getColumnTitleCell.call(this,i);if(cell){if(!escapeXAxisAtt||cell.dropzones.indexOf("XAxis")<0){if(attributeHeader&&!attributeHeader.isRowAttribute&&(attributeHeader.tui===i)){colAttrSorts.push({unit:cell,isAsc:attributeHeaderAscending});}else{unitObject=cell;if(unitObject.otp===12||unitObject.otp===47){sortType=getExistedSortingType.call(this,GM_AXIS.DssAxisColumns,cell);if(keepMatrixStructureInFrontEnd){colAttrSorts.push({unit:cell,isAsc:sortType!==sortDescending});}else{if(sortType!==sortNoSorting){colAttrSorts.push({unit:cell,isAsc:sortType!==sortDescending});}}}}}}}for(i=0;i<attCntOnRow;i++){cell=getRowTitleCell.call(this,i);if(cell){if(!escapeYAxisAtt||cell.dropzones.indexOf("YAxis")<0){if(attributeHeader&&attributeHeader.isRowAttribute&&(attributeHeader.tui===i)){rowAttrSorts.push({unit:cell,isAsc:attributeHeaderAscending});}else{unitObject=cell;if(unitObject.otp===12||unitObject.otp===47){sortType=getExistedSortingType.call(this,GM_AXIS.DssAxisRows,cell);if(keepMatrixStructureInFrontEnd){rowAttrSorts.push({unit:cell,isAsc:sortType!==sortDescending});}else{if(sortType!==sortNoSorting){rowAttrSorts.push({unit:cell,isAsc:sortType!==sortDescending});}}}}}}}if(chtInfo.isABL===false){return rowAttrSorts.concat(colAttrSorts);}if(cellIndex){gvsRI=cellIndex.row-this.gts.col.length;gvsCI=cellIndex.col-this.gts.row.length;sortMtcIdx=gvsCI%mcnt;allMetrics=gmm.getMetricProp(undefined);metricObj=$HASH.copy(allMetrics[sortMtcIdx],{});metricObj.gvsRI=gvsRI;metricObj.gvsCI=gvsCI;}var elements=[];if(this.horizontalMode){sortsArray=sortsArray.concat(rowAttrSorts);if(cellIndex){metricObj.axis=$AXIS.DssAxisRows;if(me.specialSortable){metricObj.axis=$AXIS.DssAxisColumns;}for(i=0;i<attCntOnCol;i++){attTitle=getColumnTitleCell.call(this,i);if(me.specialSortable&&attTitle.dropzones.indexOf("BreakBy")>=0){continue;}selObj=$HASH.copyProps(selPropArr,gmm.getColHeaderObj(gvsCI,i),{});moreInfo=gmm.headerInfoToProp(1,selObj,"n&id");$HASH.copy(moreInfo[0],selObj);elements.push(selObj);}elements.push(metricObj);}sortsArray=sortsArray.concat(colAttrSorts);if(cellIndex){sortsArray.push({unit:metricObj,isAsc:ascending,elements:elements});}}else{sortsArray=sortsArray.concat(colAttrSorts);sortsArray=sortsArray.concat(rowAttrSorts);if(cellIndex){metricObj.axis=$AXIS.DssAxisColumns;if(me.specialSortable){metricObj.axis=$AXIS.DssAxisRows;}for(i=0;i<attCntOnRow;i++){attTitle=getRowTitleCell.call(this,i);if(me.specialSortable&&attTitle.dropzones.indexOf("BreakBy")>=0){continue;}selObj=$HASH.copyProps(selPropArr,gmm.getRowHeaderObj(gvsRI,i),{});moreInfo=gmm.headerInfoToProp(0,selObj,"n&id");$HASH.copy(moreInfo[0],selObj);elements.push(selObj);}elements.push(metricObj);sortsArray.push({unit:metricObj,isAsc:ascending,elements:elements});}}return sortsArray;},getSortActions:function(_SortInfoArray){var lSubtotalsPositionRow=-1,lSubtotalsPositionColumn=-1,sortActions=[],lObjType,lObjID,lNeedServer=false,modelData=this.firstRes,gsi=modelData.gsi,lSortsRow=gsi.sorts[0],lSortsColumn=gsi.sorts[1],lHasOldSortsRow=false,lHasOldSortsColumn=false,i,j,lSort,lSorts,lAxisIndex,lTemplateUnit,lAttributeFormID;if(lSortsRow){if(lSortsRow.length>0){lHasOldSortsRow=true;}}if(lSortsColumn){if(lSortsColumn.length>0){lHasOldSortsColumn=true;}}if(lHasOldSortsRow&&lHasOldSortsColumn){sortActions.push({actionId:27,axisName:$AXIS.DssAxisRows});sortActions.push({actionId:27,axisName:$AXIS.DssAxisColumns});}else{if(lHasOldSortsRow){sortActions.push({actionId:27,axisName:$AXIS.DssAxisRows});}else{if(lHasOldSortsColumn){sortActions.push({actionId:27,axisName:$AXIS.DssAxisColumns});}}}for(i=0;i<_SortInfoArray.length;i++){var sortInfo=_SortInfoArray[i],lAscending=sortInfo.isAsc,lCellHandle=sortInfo.unit,lElements,lOppositeAxis,lObjType=lCellHandle.otp;if(lCellHandle.otp===4){lObjType=4;lElements=[];if(sortInfo.elements){for(j=0;j<sortInfo.elements.length;j++){lElements.push(sortInfo.elements[j]);}}var lMetric=null;for(j=0;j<lElements.length;j++){var lCurMetric=lElements[j];if(lCurMetric.otp===4){lMetric=lCurMetric;lObjID=lMetric.oid;break;}}if(lMetric!==null){if(sortInfo.elements){lAxisIndex=lCellHandle.axis;if(lAxisIndex===$AXIS.DssAxisRows){lOppositeAxis=this.gts.col;}else{if(lAxisIndex===$AXIS.DssAxisColumns){lOppositeAxis=this.gts.row;}}}lSorts=lOppositeAxis.sorts;if(!lSorts){lSorts={sortCollection:[]};lOppositeAxis.sorts=lSorts;}lSort={sortType:4,subtotalsPosition:0};lSorts.sortCollection.push(lSort);lSort.isAsc=lAscending;lSort.metricID=lObjID;lSort.elements=lElements;lSort.objectID=lObjID;lSort.objectType=lObjType;}if(lAxisIndex===$AXIS.DssAxisRows&&lSubtotalsPositionRow>0){lSort.subtotalsPosition=lSubtotalsPositionRow;}else{if(lAxisIndex===$AXIS.DssAxisColumns&&lSubtotalsPositionColumn>0){lSort.subtotalsPosition=lSubtotalsPositionColumn;}}sortActions=sortActions.concat(generateAOXML.call(this,i,1,lObjType,lObjID,lAscending,lAxisIndex,lSort.subtotalsPosition,lElements,null));}else{if(lObjType===12||(lObjType===47&&(lCellHandle.ost===12033||lCellHandle.ost===12032))){var isNDE=(lObjType===47&&lCellHandle.ost===12033);lTemplateUnit=lCellHandle;lAxisIndex=lTemplateUnit.isRowAttribute?$AXIS.DssAxisRows:$AXIS.DssAxisColumns;lAttributeFormID=lTemplateUnit.fid;lObjID=lTemplateUnit.id;var lAxis;if(lAxisIndex===$AXIS.DssAxisRows){lAxis=this.gts.row;}else{if(lAxisIndex===$AXIS.DssAxisColumns){lAxis=this.gts.col;}}lSorts=lAxis.sorts;if(!lSorts){lSorts={sortCollection:[]};lAxis.sorts=lSorts;}lSort={sortType:2,subtotalsPosition:0};lSorts.sortCollection.push(lSort);lSort.isAsc=lAscending;lSort.attributeID=lObjID;lSort.formID=lAttributeFormID;lSort.objectID=lObjID;lSort.objectType=lObjType;if(lAxisIndex===$AXIS.DssAxisRows&&lSubtotalsPositionRow>0){lSort.subtotalsPosition=lSubtotalsPositionRow;}else{if(lAxisIndex===$AXIS.DssAxisColumns&&lSubtotalsPositionColumn>0){lSort.subtotalsPosition=lSubtotalsPositionColumn;}}sortActions=sortActions.concat(generateAOXML.call(this,i,lObjType===47?(isNDE?24:10):3,lObjType,lObjID,lAscending,lAxisIndex,lSort.subtotalsPosition,null,lAttributeFormID));}}}return reorderSortArray(sortActions);},fakeSortActionsStackTotal:function(actions){if(actions&&actions.length){var i,action;for(i=0;i<actions.length;i++){if(actions[i]&&actions[i].eIds){action=actions[i];break;}}var allEids=action&&action.eIds;if(action&&allEids&&allEids.length){for(i=0;i<allEids.length;i++){if(allEids[i].otp===4){continue;}var fakeTotalItem=allEids[i],attrId,splitter=fakeTotalItem.id[2];if(splitter!==":"){splitter=";";}attrId=fakeTotalItem.id.split(splitter)[1];if(attrId){if(this.isAttrInZone(attrId,"ColorBy")||this.isAttrInZone(attrId,"BreakBy")){fakeTotalItem.headerText=fakeTotalItem.n="StackedTotal";var idItems=fakeTotalItem.id.split(splitter);fakeTotalItem.id="DB:"+idItems[1]+":-1";}}}}}},getShapeFormatsObject:function(){var shapeFormats;shapeFormats=this[ENUM_XML_TAG.FORMATS_ON_COMBINATION];if(!this.shapeFormatsRead){shapeFormats=this.view.getWidgetPropertyValue(ENUM_XML_TAG.FORMATS_ON_COMBINATION);this[ENUM_XML_TAG.FORMATS_ON_COMBINATION]=shapeFormats;this.shapeFormatsRead=true;}return shapeFormats;},setShapeFormatsWithCombination:function(elemComb,formatObj){var shapeFormats,strComb;shapeFormats=this.getShapeFormatsObject();if(shapeFormats===undefined){shapeFormats=this[ENUM_XML_TAG.FORMATS_ON_COMBINATION]={};}strComb=GMUTIL.serializeCombination(elemComb);if(Object.keys(formatObj).length<=0){delete shapeFormats[strComb];}else{shapeFormats[strComb]=formatObj;}this.view.setWidgetPropertyValue(ENUM_XML_TAG.FORMATS_ON_COMBINATION,shapeFormats);},getShapeFormatsWithCombination:function(elemComb){if(elemComb===undefined||elemComb.length===0){return undefined;}var shapeFormats,strComb;shapeFormats=this.getShapeFormatsObject();if(shapeFormats){strComb=GMUTIL.serializeCombination(elemComb);return shapeFormats[strComb];}return undefined;},getDataLabelFontFormat:function(){var gmProp=this.property,props=[ENUM_FORMAT_TAG.DATA_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.DATA_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.DATA_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.DATA_LABELS_FONT_COLOR],dlFont={};props.forEach(function(pn){dlFont[pn]=gmProp.readItem(pn);});return dlFont;},getDefaultsForShape:function(shape){var defaultsForShape=this.defaultsForShape;if(!defaultsForShape){defaultsForShape=this.defaultsForShape={};}if(defaultsForShape[shape]){return defaultsForShape[shape];}var visGM=this.view,globalDef=visGM.getDefaultProperties(),fmt=visGM.model.data.dz.visProp.fmt,shapeDef={},shapePropNm=[ENUM_FORMAT_TAG.SHAPE_LINE_THICKNESS,ENUM_FORMAT_TAG.SHAPE_LINE_COLOR,ENUM_FORMAT_TAG.SHAPE_LINE_STYLE,ENUM_FORMAT_TAG.SHAPE_FILL_COLOR,ENUM_FORMAT_TAG.SHAPE_FILL_STYLE,ENUM_FORMAT_TAG.SHAPE_FILL_TRANSPARENCY,ENUM_FORMAT_TAG.SHAPE_FILL_EFFECT,ENUM_FORMAT_TAG.SHAPE_FILL_COLOR_DEFAULT,ENUM_FORMAT_TAG.SHAPE_BORDER_STYLE,ENUM_FORMAT_TAG.SHAPE_BORDER_THICKNESS,ENUM_FORMAT_TAG.LINE_MARKER_SHOW,ENUM_FORMAT_TAG.LINE_MARKER_SHAPE,ENUM_FORMAT_TAG.LINE_MARKER_SIZE,ENUM_FORMAT_TAG.LINE_MARKER_COLOR_EQUAL,ENUM_FORMAT_TAG.PIE_EXPLODE,ENUM_FORMAT_TAG.DATA_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.DATA_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.DATA_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.DATA_LABELS_FONT_COLOR];this.property.updateDefaults(globalDef,fmt);$ARR.forEach(shapePropNm,function(pn){shapeDef[pn]=globalDef[pn];});if(shape===PRP_SHAPE.PIE||shape===PRP_SHAPE.RING){shapeDef[ENUM_FORMAT_TAG.SHAPE_FILL_TRANSPARENCY]=70;shapeDef[ENUM_FORMAT_TAG.SHAPE_BORDER_THICKNESS]=1;}else{shapeDef[[ENUM_FORMAT_TAG.SHAPE_FILL_TRANSPARENCY]]=70;}if(shape===PRP_SHAPE.BAR){shapeDef[ENUM_FORMAT_TAG.SHAPE_BORDER_THICKNESS]=1;}defaultsForShape[shape]=shapeDef;return shapeDef;},getVolatileDefaultsForShape:function(shape){var volDefaultsForShape=this.volDefaultsForShape;if(!volDefaultsForShape){volDefaultsForShape=this.volDefaultsForShape={};}if(volDefaultsForShape[shape]){return volDefaultsForShape[shape];}var shapeDef=this.getDefaultsForShape(shape);volDefaultsForShape[shape]=$HASH.copy(shapeDef);return volDefaultsForShape[shape];},refineShapeFormatsObject:function(){var shapeFormats=this[ENUM_XML_TAG.FORMATS_ON_COMBINATION];var level=["metricLevelProp","colorByLevelProp","concreteLevelProp"];this.levelPropCache={};var colorByAttId=this.getColorByAttrsID()||[];var breakByAttId=this.getBreakByAttrsID()||[];breakByAttId=breakByAttId.filter(function(id){return colorByAttId.indexOf(id)===-1;});function getLevel(key){var isBreakBy=breakByAttId.some(function(id){return key.indexOf(id)!==-1;});if(isBreakBy){return level[2];}var isColorBy=colorByAttId.some(function(id){return key.indexOf(id)!==-1;});if(isColorBy){return level[1];}return level[0];}for(var key in shapeFormats){var lvl=getLevel(key);this.levelPropCache[lvl]=true;}var colorByDZ=this.view.model.data.dz.ColorBy;if("MetricNames" in colorByDZ&&!colorByDZ.TemplateUnit){this.levelPropCache.colorByLevelProp=true;}},clearShapeFormatsCache:function(type){switch(type){default:}delete this.levelPropCache;delete this.sharePropCache;delete this.allPropFormatsRead;delete this.allPropFormatsCache;delete this.lineMarkerShowCache;delete this.metricLvlDLRead;delete this.metricLvlDLCache;delete this.shapeColorCache;delete this.shapeColorFormatsCache;delete this.shapeFormatsCache;},getDefaultsMergedWithAllPropsCachedObject:function(gc){if(!this.sharePropCache){var defProp=this.getDefaultsForShape(this.chartInfo.shape);var allProp=this.getAllPropsFormatsCachedObject(gc);this.sharePropCache=GMUTIL.getResolvedFormatsObject([defProp,allProp]);this.sharePropCache.lnMkShw=this.getLineMarkerShowCachedObject(gc);}return this.sharePropCache;},getLineMarkerShowCachedObject:function(gc){this.lineMarkerShowCache=this.lineMarkerShowCache||gc.getPropertyValue(ENUM_FORMAT_TAG.LINE_MARKER_SHOW);return this.lineMarkerShowCache;},getAllPropsFormatsCachedObject:function(gc){if(!this.allPropFormatsRead){this.allPropFormatsCache=gc.getPropertyValue(ENUM_FORMAT_TAG.ALL_SHAPE_FORMAT);this.allPropFormatsRead=true;}return this.allPropFormatsCache;},getMetricDataLabelCachedObject:function(gc,identity){var METRIC_LVL_DATA_LABEL_SHOW=true;if(!this.metricLvlDLRead){this.metricLvlDLCache=gc.getPropertyValue(ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL);this.metricLvlDLRead=true;}var metricLvlDL=this.metricLvlDLCache;var show=METRIC_LVL_DATA_LABEL_SHOW;if(metricLvlDL===undefined){show=METRIC_LVL_DATA_LABEL_SHOW;}else{var dlAssMtcId=identity.assMetricDLIDCache=identity.assMetricDLIDCache||identity.getAssMetricDataLabelID();if(dlAssMtcId!==undefined){show=metricLvlDL[dlAssMtcId];}else{show=false;}}return show;},getShapeFormatsCachedObject:function(identity){this.shapeFormatsCache=this.shapeFormatsCache||[];identity.idx="idx" in identity?identity.idx:this.shapeFormatsCache.length;return this.shapeFormatsCache[identity.idx];},setShapeFormatsCachedObject:function(identity,formats){this.shapeFormatsCache[identity.idx]=formats;},getComboLevelPropCachedObject:function(identity){var metricComb,colorByComb,concreteComb,shapeFormats=this.getShapeFormatsObject();if(!shapeFormats){return ;}if(!this.levelPropCache){this.refineShapeFormatsObject();}if(!identity.concreteCombStr&&this.levelPropCache.concreteLevelProp){concreteComb=identity.getSelectedObjectLowestLevel(true);identity.concreteCombStr=(concreteComb===undefined||concreteComb.length===0)?"":GMUTIL.serializeCombination(concreteComb);}if(!identity.metricCombStr&&this.levelPropCache.metricLevelProp){metricComb=identity.getSelectedObjectMetricInfo();identity.metricCombStr=(metricComb===undefined||metricComb.length===0)?"":GMUTIL.serializeCombination(metricComb);}if(!identity.colorByCombStr&&this.levelPropCache.colorByLevelProp){colorByComb=identity.getSelectedObjectColorByInfo();identity.colorByCombStr=(colorByComb===undefined||colorByComb.length===0)?"":GMUTIL.serializeCombination(colorByComb);}return[shapeFormats[identity.concreteCombStr],shapeFormats[identity.metricCombStr],shapeFormats[identity.colorByCombStr]];},getShapeColorCachedObject:function(gc,identity){this.shapeColorCache=this.shapeColorCache||[];return this.shapeColorCache[identity.idx]=this.shapeColorCache[identity.idx]||gc.getColorByData();},getShapeColorFormatsCachedObject:function(gc,identity,res,equal2share){var finalRes=res,SpFlTp=mstrmojo.gm.ShapeFillType,metricLvlDLShow=this.getMetricDataLabelCachedObject(gc,identity),shapeColor=this.getShapeColorCachedObject(gc,identity),key=shapeColor+(metricLvlDLShow?"T":"F");this.shapeColorFormatsCache=this.shapeColorFormatsCache||{};if(equal2share){if(this.shapeColorFormatsCache[key]){return this.shapeColorFormatsCache[key];}else{finalRes=this.shapeColorFormatsCache[key]=$HASH.copy(res);}}shapeColor=(shapeColor!==undefined&&shapeColor!==null)?shapeColor:finalRes[ENUM_FORMAT_TAG.SHAPE_FILL_COLOR];var isGradient=false;if(shapeColor&&typeof shapeColor==="object"){isGradient=true;}if(shapeColor!==undefined){finalRes[ENUM_FORMAT_TAG.SHAPE_LINE_COLOR]=finalRes[ENUM_FORMAT_TAG.SHAPE_FILL_COLOR]=shapeColor;var globalMkClr=gc.getPropertyValue(ENUM_FORMAT_TAG.LINE_MARKER_COLOR);if(globalMkClr===undefined){finalRes[ENUM_FORMAT_TAG.LINE_MARKER_COLOR]=isGradient?shapeColor.c1:shapeColor;}else{finalRes[ENUM_FORMAT_TAG.LINE_MARKER_COLOR]=globalMkClr;}if(finalRes[ENUM_FORMAT_TAG.LINE_MARKER_BORDER_COLOR]===undefined){finalRes[ENUM_FORMAT_TAG.LINE_MARKER_BORDER_COLOR]=isGradient?shapeColor.c1:(globalMkClr!==undefined?globalMkClr:shapeColor);}if(finalRes[ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR]===undefined){finalRes[ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR]=isGradient?shapeColor.c1:shapeColor;}}finalRes[ENUM_FORMAT_TAG.SHAPE_FILL_STYLE]=isGradient?SpFlTp.Gradient:SpFlTp.Solid;if(isGradient&&this.chartInfo.isABL){var gcShape=gc.getShape();if(gcShape===MK_SHAPE.LINE||gcShape===MK_SHAPE.TICK){finalRes[ENUM_FORMAT_TAG.SHAPE_FILL_STYLE]=SpFlTp.Solid;finalRes[ENUM_FORMAT_TAG.SHAPE_LINE_COLOR]=finalRes[ENUM_FORMAT_TAG.SHAPE_FILL_COLOR]=shapeColor.c1;}}finalRes[ENUM_FORMAT_TAG.DATA_LABELS_SHOW]=metricLvlDLShow;return finalRes;},forceUpdateAxis:function(){var view=this.view;if(view){return view.forceUpdateAxis;}return false;},forceUpdateCharts:function(){var view=this.view;if(view){return view.forceUpdateCharts;}return false;},clearLogScaleCahce:function(){delete this.logScaleCache;},resetDataLabelType:function(){var chtInfo=this.chartInfo;if(chtInfo){chtInfo.dlTp=this.property.readItem(ENUM_XML_TAG.DATA_LABEL);}},resetDataLabelPlacement:function(){var chtInfo=this.chartInfo;if(chtInfo){chtInfo.dlPlmt=this.property.readItem(ENUM_XML_TAG.DATA_LABELS_PLACEMENT);}},clearDataLabelFormatCache:function(){var msiChart=this.ChartFactory;if(msiChart&&msiChart.mUniversalProperty){delete msiChart.mUniversalProperty.DatatextFormat;}},resetDefaultShapeProp:function(){delete this.defaultsForShape;delete this.volDefaultsForShape;},formatAsAxisLabel:function(metricIds,value){if(!metricIds||metricIds.length<=0){return undefined;}var ret;if(this.chartSubType===PRP_SUBTYPE.PERCENT){ret=$NUM.formatByMask("#%",value);}else{ret=this.formatValue(metricIds,value);}return ret;},formatValue:function(metricIds,value){var i,idx,xMxs,yMxs,x2Mxs,y2Mxs,inChtL=this.inChartLayout,rnt=inChtL.r,cnt=inChtL.c,cache=this.mericsAxisMapCache;idx=this.getMetricIndexFromID(metricIds[0]);if(!cache){cache=this.mericsAxisMapCache={};}if(cache[idx]!==undefined){return this.formatMetricsValueUniformly(metricIds,value,cache[idx]);}for(i=0;i<rnt;i++){yMxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(i,0,"y",true));if(yMxs.indexOf(idx)>=0){cache[idx]={row:i,col:0,axisName:"y",isPrimary:true};return this.formatMetricsValueUniformly(metricIds,value,cache[idx]);}y2Mxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(i,0,"y",false));if(y2Mxs.indexOf(idx)>=0){cache[idx]={row:i,col:0,axisName:"y",isPrimary:false};return this.formatMetricsValueUniformly(metricIds,value,cache[idx]);}}for(i=0;i<cnt;i++){xMxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(0,i,"x",true));if(xMxs.indexOf(idx)>=0){cache[idx]={row:0,col:i,axisName:"x",isPrimary:true};return this.formatMetricsValueUniformly(metricIds,value,cache[idx]);}x2Mxs=filterInValidMetricIndex(this.getMetricsOnAxisOfChart(0,i,"x",false));if(x2Mxs.indexOf(idx)>=0){cache[idx]={row:0,col:i,axisName:"x",isPrimary:false};return this.formatMetricsValueUniformly(metricIds,value,cache[idx]);}}return formatMetricValue.call(this,value,idx);},getMetricInfo:function(metricId){this.metricInfos=this.metricInfos||{};var metricInfos=this.metricInfos;if(!!metricInfos[metricId]){return metricInfos[metricId];}var gts=this.gts,col=gts.col,colLen=col.length;if(colLen&&col[colLen-1].otp===-1){var metrics=col[colLen-1].es;metrics.forEach(function(e){if(e.oid===metricId){metricInfos[metricId]=$HASH.copy(e,{});}});var gnf=this.firstRes.gnf;gnf.forEach(function(e){if(e.id===metricId){metricInfos[metricId].nf=$HASH.copy(e,{});}});}},formatMetricsValueUniformly:function(metricIds,value,axisInfo){var useCondense,index,row=axisInfo.row,col=axisInfo.col,axisName=axisInfo.axisName,isPrimary=axisInfo.isPrimary,echoCondense=this.condenseEchos,iLdsIdx=this.mapFromChartToLDSIndex(row,col),rLds=axisName==="x"?row:iLdsIdx.r,cLds=axisName==="x"?iLdsIdx.c:col,dpIdx=iLdsIdx.dpIdx,lds=this.model.getLocalDataSet(rLds,cLds),dps=lds.generateDataProvider(),dp=dps[dpIdx],axisKey=axisName.toUpperCase()+(isPrimary?"AxisChart":"2AxisChart");if(dp[axisKey]){return dp[axisKey].formatAsUniformAxisLabel(value);}index=axisName==="x"?col:row;axisKey=axisName.toUpperCase();if(isPrimary){axisKey=axisKey+"1";}else{axisKey=axisKey+"2";}echoCondense=echoCondense&&echoCondense[axisKey];useCondense=echoCondense&&echoCondense[index];if(useCondense){return CEUtility.abbreviateNumber(value,5);}else{axisKey=axisKey.toLowerCase();if(isPrimary){axisKey=axisKey[0];}axisKey=axisKey+"Condense";if(this[axisKey]){return CEUtility.abbreviateNumber(value,5);}}var me=this,numberformats=[],numberFormat="General";metricIds.forEach(function(e){var metricInfo=me.getMetricInfo(e);if(metricInfo&&metricInfo.nf){numberformats.push(metricInfo.nf);}});if(numberformats.length){var i=1;numberFormat=numberformats[0].nfs;for(;i<numberformats.length;i++){if(numberformats[i].nfs!=numberFormat){numberFormat="General";break;}}}return $NUM.formatByMask(numberFormat,value);},hasAttributesInDropzone:function(zoneName){var templateUnit=this.dz[zoneName].TemplateUnit;return(templateUnit&&templateUnit.length>0);},getAttributeIds:function(){if(!this.attributeIds){var row=this.gts.row,col=this.gts.col,attrIds={};$ARR.forEach(row,function(unit){if(unit.otp!==-1&&unit.otp!==4){attrIds[unit.id]=unit.es;}});$ARR.forEach(col,function(unit){if(unit.otp!==-1&&unit.otp!==4){attrIds[unit.id]=unit.es;}});this.attributeIds=attrIds;}return this.attributeIds;},getDataProvider:function(r,c){return getDP.call(this,r,c);},isOneDotCase:function(){var gmm=this.model,firstLDS,grpCnt,mcnt;firstLDS=gmm.getLocalDataSet(0,0);if(this.chartDirection===$GM.EnumABLDirection.VERTICAL){mcnt=gmm.getMetricCount();if(mcnt===0){grpCnt=firstLDS.wd;}else{grpCnt=firstLDS.wd/mcnt;}}else{grpCnt=firstLDS.items.length;}return grpCnt<2;},isCompactMode:function(){return this.view.getWidgetPropertyValue(ENUM_XML_TAG.FIT_TO)===FIT_TO.COMPACT;}});}());