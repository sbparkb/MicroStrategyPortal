(function(){mstrmojo.requiresClsP("mstrmojo.chart","GraphObjectManager","CategoryPlot","TripleId");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumOrientation");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphType","EnumDSSGraphObject","EnumVariantBool","EnumDSSExtraGraphProperty");var $C=mstrmojo.chart,$CHART_ENUMS=$C.enums,$OR=$CHART_ENUMS.EnumOrientation,$NOID=$C.gNullObjectId,$NTID=$C.gNullTripleId;var $M=mstrmojo.chart.model,$MODEL_ENUMS=$M.enums,$GT=$MODEL_ENUMS.EnumDSSGraphType,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$VF=$MODEL_ENUMS.EnumVariantBool.VARIANT_FALSE,$EGP=$MODEL_ENUMS.EnumDSSExtraGraphProperty;mstrmojo.chart.PlotManager=mstrmojo.declare(mstrmojo.chart.GraphObjectManager,null,{scriptClass:"mstrmojo.chart.PlotManager",mLegendPtr:null,mDatasetPtr:null,mGraphType:$GT.DssGraphTypeVertical_Bar_Side_by_Side,mPlotArea:null,mChartAreaOptions:null,mRecalculateFrame:false,mLeftMargin:0,mRightMargin:0,mTopMargin:0,mBottomMargin:0,init:function init(props){this._super(props);this.mChartAreaOptions={useChartArea:false,chartAreaNumber:1,orientation:$OR.OR_VERTICAL,vecPercentageHeightOrWidth:[],seriesDistribution:[]};this.mPlotArea=props.Area||null;this.mChartContextPtr=props.GraphObjectManager.mChartContextPtr;},SetDataset:function SetDataset(iDataSetPtr){this.mDatasetPtr=iDataSetPtr;},SetMarginInfo:function SetMarginInfo(iLeftMargin,iRightMargin,iTopMargin,iBottomMargin){this.mLeftMargin=iLeftMargin;this.mRightMargin=iRightMargin;this.mTopMargin=iTopMargin;this.mBottomMargin=iBottomMargin;},LoadProperties:function LoadProperties(){var value,seriesCount,residualSpace,autoAreaNumber,i,vecSeriesId=[],seriesIndex=[],groupIndex=[];var chartCtx=this.mChartContextPtr,chartAreaOptions=this.mChartAreaOptions;this.mGraphType=chartCtx.mGraphType;this.mRecalculateFrame=chartCtx.mRecalculateFrame;if(!chartCtx.mIsGraphMatrix){value=chartCtx.GetProperty($EGP.DssGraphUseChartArea,$NOID);if(value){chartAreaOptions.useChartArea=value!==$VF;}}seriesCount=this.mDatasetPtr.GetSeriesCount();residualSpace=1;autoAreaNumber=0;if(chartAreaOptions.useChartArea){value=chartCtx.GetProperty($EGP.DssGraphChartAreaNumber,$NOID);if(value){chartAreaOptions.chartAreaNumber=value;if(chartAreaOptions.chartAreaNumber>seriesCount){chartAreaOptions.chartAreaNumber=seriesCount;}}value=chartCtx.GetProperty($EGP.DssGraphChartAreaOrientation,$NOID);if(value){chartAreaOptions.orientation=(value!==$VF?$OR.OR_VERTICAL:$OR.OR_HORIZONTAL);}for(i=0;i<chartAreaOptions.chartAreaNumber;i++){value=chartCtx.GetProperty($EGP.DssGraphChartAreaSpacePercentage,new mstrmojo.chart.TripleId({ObjectId:$GO.DssGraphFrame,SeriesId:i}));if(value&&value>=0){chartAreaOptions.vecPercentageHeightOrWidth.push(value/100);residualSpace-=value/100;}else{chartAreaOptions.vecPercentageHeightOrWidth.push(-1);autoAreaNumber++;}}}else{chartAreaOptions.chartAreaNumber=1;chartAreaOptions.vecPercentageHeightOrWidth.push(1);}for(i=0;i<chartAreaOptions.chartAreaNumber;i++){chartAreaOptions.seriesDistribution.push(vecSeriesId);}this.mDatasetPtr.GetOneSliceRangeSimple(seriesIndex,groupIndex);for(i=0;i<seriesCount;i++){if(chartCtx.mIsGraphMatrix){chartAreaOptions.seriesDistribution[i%chartAreaOptions.chartAreaNumber].push(seriesIndex[i]);}else{value=chartCtx.GetProperty($EGP.DssGraphChartAreaDestination,new mstrmojo.chart.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:i}));if(chartAreaOptions.useChartArea&&value){chartAreaOptions.seriesDistribution[value].push(i);}else{chartAreaOptions.seriesDistribution[i%chartAreaOptions.chartAreaNumber].push(seriesIndex[i]);}}}if(autoAreaNumber>0){for(i=0;i<chartAreaOptions.chartAreaNumber;i++){if(chartAreaOptions.vecPercentageHeightOrWidth[i]<=0){chartAreaOptions.vecPercentageHeightOrWidth[i]=residualSpace/autoAreaNumber;}}}},CalculateChartAreas:function CalculateChartAreas(irDataArea,orChartAreas){var runningPercentage,marginHeight,marginWidth,i,chartAreaOptions=this.mChartAreaOptions,chartAreaHeight,chartAreaWidth,rect,size;runningPercentage=0;if(chartAreaOptions.orientation===$OR.OR_VERTICAL){marginHeight=irDataArea.height/20;size=chartAreaOptions.chartAreaNumber;for(i=0;i<size;i++){chartAreaHeight=(irDataArea.height-marginHeight*(chartAreaOptions.chartAreaNumber-1))*chartAreaOptions.vecPercentageHeightOrWidth[i];orChartAreas.push(new mstrmojo.chart.Rect2D({x:irDataArea.x,y:irDataArea.y+(irDataArea.height-marginHeight*(size-1))*runningPercentage+marginHeight*i,width:irDataArea.width,height:chartAreaHeight}));runningPercentage+=chartAreaOptions.vecPercentageHeightOrWidth[i];}rect=orChartAreas[chartAreaOptions.chartAreaNumber-1];rect.height=irDataArea.y+irDataArea.height-rect.y;}else{marginWidth=irDataArea.width/20;size=chartAreaOptions.chartAreaNumber;for(i=0;i<size;i++){chartAreaWidth=(irDataArea.width-marginWidth*(chartAreaOptions.chartAreaNumber-1))*chartAreaOptions.vecPercentageHeightOrWidth[i]+0.5;orChartAreas.push(new mstrmojo.chart.Rect2D({x:irDataArea.x+(irDataArea.width-marginWidth*(size-1))*runningPercentage+marginWidth*i,y:irDataArea.y,widht:chartAreaWidth,height:irDataArea.height}));runningPercentage+=chartAreaOptions.vecPercentageHeightOrWidth[i];}rect=orChartAreas[size-1];rect.width=irDataArea.x+irDataArea.width-rect.x;}},RectangleUnion:function RectangleUnion(irRectA,irRectB,orRect){orRect.x=Math.min(irRectA.x,irRectB.x);orRect.y=Math.min(irRectA.y,irRectB.y);orRect.width=Math.max(irRectA.x+irRectA.width,irRectB.x+irRectB.width)-orRect.x;orRect.height=Math.max(irRectA.y+irRectA.height,irRectB.y+irRectB.height)-orRect.y;},RectangleIntersection:function RectangleIntersection(irRectA,irRectB,orRect){if((irRectA.x>(irRectB.x+irRectB.width))||(irRectB.x>(irRectA.x+irRectA.width))||(irRectA.y>(irRectB.y+irRectB.height))||(irRectB.y>(irRectA.y+irRectA.height))){return false;}orRect.x=Math.max(irRectA.x,irRectB.x);orRect.y=Math.max(irRectA.y,irRectB.y);orRect.width=Math.min(irRectA.x+irRectA.width,irRectB.x+irRectB.width)-orRect.x;orRect.height=Math.min(irRectA.y+irRectA.height,irRectB.y+irRectB.height)-orRect.y;return true;}});}());