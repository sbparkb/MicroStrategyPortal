(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom");var $DOM=mstrmojo.dom,$ARR=mstrmojo.array;function initializeData(){var me=this;me.selectedRows=[];me.headersData="";me.rowsData="";me.clipBoardText="";me.globalRowCounter=0;me.allRows=new Array();}function extractRows(selectedCells){initializeData.call(this);var i,tdCount=selectedCells.length;var headerInfo=populateHeaderInfo.call(this,$DOM.findAncestorByName(selectedCells[0],"tr",true,this.domNode)),headerRowCount=headerInfo.headerRowCount,maxHeaderChildCount=headerInfo.maxHeaderChildCount,gridOffset=headerInfo.gridOffset;for(i=0;i<tdCount;i++){findAncestorsByRowSpan.call(this,selectedCells[i],"tr",true,this.domNode,headerRowCount,maxHeaderChildCount,gridOffset);}}function populateHeaderInfo(currentRow){var hRC=this.rhsCP.startIndexInContainer||0,mHcc=0;var i,offset=0,tbody=currentRow&&currentRow.parentNode;while(tbody.hasAttribute("n")&&parseInt(tbody.getAttribute("n"),10)>0){tbody=tbody.previousElementSibling;}var firstRowInContainer=tbody.firstChild,headerChildNodes=firstRowInContainer.childNodes;for(i=0;i<headerChildNodes.length;i++){mHcc+=parseInt(headerChildNodes[i].getAttribute("colspan"));}var headerAndFirstRowObj=getHeaderData(firstRowInContainer,hRC,mHcc);this.headersData=headerAndFirstRowObj.headerText;var firstDataRow=headerAndFirstRowObj.firstDataRow;if(firstDataRow&&firstDataRow.childElementCount>mHcc){offset=1;}return{headerRowCount:hRC,maxHeaderChildCount:mHcc,gridOffset:offset};}function getHeaderData(headerRow,headerRowCount,maxHeaderChildCount){var i=0,it,headerText="",headerRowCounter=0,currHeaderRowChildCount,colSpan,currHeaderChildNodes;while(headerRowCounter<headerRowCount){currHeaderChildNodes=headerRow.childNodes;currHeaderRowChildCount=currHeaderChildNodes.length;if(headerRowCounter!=0){headerText+="\n";for(i=0;i<(maxHeaderChildCount-currHeaderRowChildCount);i++){headerText+="\t";}}for(i=0;headerRow&&i<currHeaderRowChildCount;i++){it=currHeaderChildNodes[i].innerText||currHeaderChildNodes[i].textContent;headerText+=it?(it+"\t"):"";colSpan=currHeaderChildNodes[i].getAttribute("colspan");while(colSpan>1){headerText+="\t";colSpan--;}}headerRow=headerRow.nextSibling;headerRowCounter++;}return{headerText:headerText,firstDataRow:headerRow};}function getPreviousRowCell(cellIndex){return this.allRows[this.globalRowCounter-1][cellIndex];}function findAncestorsByRowSpan(td,nodeName,inclusive,elLimit,headerRowCount,maxHeaderChildCount,gridOffset){var umCells=[],umObjs=[],rowSpanCount=td.rowSpan,i=0,currentRowText="",cellCounter=0,cell="",currentRow=$DOM.findAncestorByName(td,nodeName,inclusive,elLimit),me=this,allRows=me.allRows;if((currentRow.childElementCount-gridOffset)<maxHeaderChildCount){umObjs=me.rhsCP.getUnmergedCells(td.getAttribute("r")-headerRowCount);for(i=0;i<umObjs.length;i++){umCells[i]=(umObjs[i]._e)?umObjs[i]._e.n:" ";}}if(rowSpanCount===1){allRows[me.globalRowCounter]=new Array(maxHeaderChildCount);cellCounter=0;if(umCells.length>0){umCells.forEach(function(umCell){currentRowText+=umCell+"\t";allRows[me.globalRowCounter][cellCounter++]=umCell;});}currentRowText=extractCellsFromRow.call(me,currentRow,currentRowText,cellCounter);saveSelectedRow.call(me,currentRowText);this.globalRowCounter++;}else{while(rowSpanCount>0){cellCounter=0;allRows[me.globalRowCounter]=new Array(maxHeaderChildCount);currentRowText="";i=maxHeaderChildCount-(currentRow.childElementCount-gridOffset);while(i>0){cell=umCells[cellCounter]?umCells[cellCounter]:getPreviousRowCell.call(me,cellCounter);currentRowText+=cell+"\t";allRows[me.globalRowCounter][cellCounter++]=cell;i--;}currentRowText=extractCellsFromRow.call(me,currentRow,currentRowText,cellCounter);saveSelectedRow.call(me,currentRowText);me.globalRowCounter++;currentRow=currentRow.nextSibling;rowSpanCount--;}}}function extractCellsFromRow(currentRow,currentRowText,cellCounter){var i,it,currentRowChildNodes=currentRow.childNodes;for(i=0;i<currentRowChildNodes.length;i++){it=currentRowChildNodes[i].innerText||currentRowChildNodes[i].textContent;currentRowText+=it?(it+"\t"):"";this.allRows[this.globalRowCounter][cellCounter++]=it?(it):"";}return currentRowText;}function saveSelectedRow(_tr){if($ARR.indexOf(this.selectedRows,_tr)<0){this.selectedRows.push(_tr);this.rowsData+=_tr+"\n";}}function updateClipBoardData(){this.clipBoardText=(this.headersData)?this.headersData+"\n"+this.rowsData:this.rowsData;}function updateXtabHiddenTxtArea(){var xha=this.xTabHiddenTextArea;xha.readOnly=false;xha.value=this.clipBoardText;xha.readOnly=true;xha.focus();xha.select();}function copyToClipBoard(){try{document.execCommand("copy");}catch(ex){console.log("Exception while copying data"+ex);}}function cleanUp(){var me=this;me.selectedRows=null;me.allRows=null;me.headersData=null;me.rowsData=null;}mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste=mstrmojo.provide("mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste",{_mixinName:"mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste",xTabHiddenTextArea:undefined,isCopySupported:false,selectedRows:[],headersData:"",rowsData:"",clipBoardText:"",globalRowCounter:0,allRows:undefined,init:function init(props){this._super(props);this.isCopySupported=!(mstrApp.isSingleTier&&$DOM.isMac()||$DOM.isSafari||$DOM.isFF);},onclick:function onclick(e){this._super(e);if(this.selCells.length>0&&!$DOM.isMobile){this.prepareClipBoardData.call(this,this.selCells);}},prepareClipBoardData:function prepareClipBoardData(tds){extractRows.call(this,tds);updateClipBoardData.call(this);updateXtabHiddenTxtArea.call(this);cleanUp.call(this);},copyRowsFromXtab:function copyRowsFromXtab(contextCell,tds){if(tds.length<1){return ;}if(this.isCopySupported){updateXtabHiddenTxtArea.call(this);copyToClipBoard.call(this);}cleanUp.call(this);}});}());