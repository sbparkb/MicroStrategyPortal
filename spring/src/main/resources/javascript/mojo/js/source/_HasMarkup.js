(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.hash");var $STRING=mstrmojo.string,$HASH=mstrmojo.hash,$DOM=mstrmojo.dom;var creationElement=mstrmojo.usesFrames?null:document.createElement("span");var REG_EXP_EVENTS=/mstrAttach:([\w,]+)/g;var isTouchEnabled;function replaceEvtTokens(s){if(isTouchEnabled===undefined){isTouchEnabled=(mstrApp!==undefined&&mstrApp.isTouchApp&&mstrApp.isTouchApp())||false;}return s.replace(REG_EXP_EVENTS,function hRepl(token,es){var arr=es.split(","),out=[],len=arr.length,i;for(i=0;i<len;i++){var e=arr[i];if(e){if(isTouchEnabled){if(e.indexOf("mouse")>-1){continue;}else{if(e==="click"){e="touchend";}}}out.push("on"+e+"=\"mstrmojo.dom.captureDomEvent('{@id}','"+e+"', self, event)\"");}}return out.join(" ");});}var PRE="preBuildRendering",BUILD="buildRendering",POST="postBuildRendering";function buildDomNode(widget){var s=widget.markupString;if(s.match(/mstrAttach:/)){s=replaceEvtTokens(s);if(widget.markupString===widget.constructor.prototype.markupString){widget.constructor.prototype.markupString=s;}}var html=$STRING.apply(s,widget);if(html){if(mstrmojo.usesFrames){var doc=(widget.domNode&&widget.domNode.ownerDocument)||window.document;if(!creationElement||creationElement.ownerDocument!==doc){creationElement=doc.createElement("span");}}creationElement.innerHTML=html;var d=creationElement.removeChild(creationElement.firstChild);d.mstrmojoId=widget.id;return d;}return null;}function callSlots(widget){var ms=widget.markupSlots,nodes,n;if(ms){nodes={};for(n in ms){nodes[n]=ms[n].call(widget);}}return nodes;}mstrmojo._HasMarkup=mstrmojo.provide("mstrmojo._HasMarkup",{markupString:null,markupMethods:null,markupSlots:null,onRender:mstrmojo.emptyFn,onUnRender:mstrmojo.emptyFn,render:function render(){if((this[PRE]&&this[PRE]()===false)||(this[BUILD]()===false)||(this[POST]&&this[POST]()===false)){return false;}this.hasRendered=!!this.domNode;this.onRender();var evtName="renderComplete";if(mstrmojo.publisher.hasSubs(this.id,evtName)){this.raiseEvent({name:evtName});}return true;},buildDom:function buildDom(){return buildDomNode(this);},postBuildDom:null,preBuildRendering:mstrmojo.emptyFn,buildRendering:function buildRendering(){var dnWas=this.domNode,dn=this.buildDom();this.domNode=dn;if(this.postBuildDom){this.postBuildDom();}if(this.slotNames){this.removeSlots(this.slotNames);}this.addSlots(callSlots(this));this.paint();if(dn){var ph=dnWas;if(!ph){ph=this.placeholder;if(ph){if(typeof ph==="string"){ph=document.getElementById(ph);}delete this.placeholder;}}if(ph){$DOM.replace(ph,dn);}}var fn="onchildRenderingChange",p=this.parent;if(p&&p[fn]){p[fn](this);}return true;},postBuildRendering:mstrmojo.emptyFn,unrender:function unrender(ignoreDom){if(this.hasRendered){if(!ignoreDom){try{var dn=this.domNode;if(dn.parentNode){dn.parentNode.removeChild(dn);}if(mstrmojo.dom.isIE&&dn.outerHTML!=="undefined"){dn.outerHTML="";}}catch(ex){}}this.domNode=null;this.removeSlots(this.slotNames);this.hasRendered=false;this.onUnRender();}},paint:function paint(){var ms=this.markupMethods;if(!ms){return ;}var me=this,callM=function(n){var f=ms[n];if(f){try{f.apply(me,[true]);}catch(localErr){throw new Error(["Error in markup method.","Script class: "+me.scriptClass,"Widget id: "+me.id,"Method name: "+n,"Err: "+localErr.message].join("\n\n"));}}};var s=ms.sequence,len,i,n;if(s){len=s.length||0;for(i=0;i<len;i++){callM(s[i]);}}else{for(n in ms){callM(n);}}},redraw:function redraw(){return false;},refresh:function refresh(postUnrender){if(this.hasRendered){if(this.redraw()!==true){var ph=this.domNode;this.unrender(true);this.placeholder=ph;if(postUnrender){postUnrender();}this.render();}}},set:function set(n,v){this._super(n,v);if(this.domNode){var ms=this.markupMethods,f=ms&&ms["on"+n+"Change"];if(f){f.apply(this);}}return this;},slotNames:null,addSlots:function addSlots(slots){var ns=this.slotNames,n;if(!ns){ns={};this.slotNames=ns;}for(n in slots){this[n]=slots[n];ns[n]=true;}},removeSlots:function removeSlots(slots){if(slots){var sns=this.slotNames,n;for(n in slots){delete this[n];if(sns){delete sns[n];}}}},captureDomEvent:function captureDomEvent(type,hWin,e,config){if(this.enabled!==false){this.raiseEvent(mstrmojo._HasMarkup.newDomEvent(type,hWin,e||hWin.event,config));}},playEffect:function playEffect(n){var fx=this[n];if(fx&&fx.constructor===Object){fx=mstrmojo.insert(mstrmojo.hash.clone(fx));fx.widget=this;this[n]=fx;}if(fx){fx.play();}}});mstrmojo._HasMarkup.addMarkupMethods=function addMarkupMethods(clazz,methods){clazz.prototype.markupMethods=$HASH.copy(methods,$HASH.copy(clazz.prototype.markupMethods));};mstrmojo._HasMarkup.MSTRDomEventType=null;mstrmojo._HasMarkup.newDomEvent=function(type,hWin,winEvt,config){return{name:type,hWin:hWin,e:winEvt,config:config,ctrlKey:$DOM.ctrlKey(hWin,winEvt),shiftKey:$DOM.shiftKey(hWin,winEvt),metaKey:$DOM.isMetaKey(hWin,winEvt),cancel:function(){$DOM.stopPropogation(hWin,winEvt);},preventDefault:function(){$DOM.preventDefault(hWin,winEvt);},getTarget:function(){return $DOM.eventTarget(hWin,winEvt);}};};}());