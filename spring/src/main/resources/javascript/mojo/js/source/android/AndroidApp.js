(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._CanSupportOfflineTransactions","mstrmojo._CanMakeServerProxyRequests","mstrmojo.MobileConfiguration","mstrmojo.OfflineTransactionModel","mstrmojo.dom","mstrmojo.hash","mstrmojo.android.EnumOrientationTypes");mstrmojo.requiresDescs(6828,9419);var $DOM=mstrmojo.dom,$HASH=mstrmojo.hash;var dialogs=[],lisStacks={},menus={},cachedMicroTablet;function handleError(res,app,callback){if(!res||res.handledError){return ;}var msg=[],map={title:"",message:mstrmojo.desc(6828)+" ",sourceURL:"Source URL: ",fileName:"File: ",lineNumber:"Line: ",line:"Line: "};$HASH.forEach(map,function(v,n){if(res[n]!==undefined){msg.push(v+res[n]);if(n==="title"){msg.push("");}}});if(res.getResponseHeader){msg.push("XHR: "+res.getResponseHeader("X-MSTR-TaskFailureMsg"));}msg=msg.join("\n");if(app){app.hideMessage();}if(msg.length){if(res.useToast){mstrmojo.toast(msg,3000,callback);}else{mstrmojo.alert(msg,callback);}res.handledError=true;mstrmojo.dbg(res.stack||msg);}}function onWindowError(errMsg,fName,lineNum){if(errMsg instanceof String){handleError({message:errMsg,fileName:fName,lineNumber:lineNum});}}var $APP=mstrmojo.android.AndroidApp=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._CanMakeServerProxyRequests,mstrmojo._CanSupportOfflineTransactions],{scriptClass:"mstrmojo.android.AndroidApp",serverProxy:null,isMobile:true,handledCompatibilityError:false,nativeBridge:new mstrmojo.android.NativeBridge(),init:function init(props){this._super(props);var fn=window.onerror;window.onerror=fn?mstrmojo.func.composite([onWindowError,fn]):onWindowError;this.handleError=handleError;},start:function start(){this.started=true;var app=mstrMobileApp;app.setTaskServletName(mstrConfig.taskURL);var cfg=this.getConfiguration(),diagnosticMode=cfg.getDiagnosticMode();app.setDiagnosticMode(diagnosticMode);this.diagnosticMode=diagnosticMode;this.useBinaryFormat=cfg.getBinaryMode();mstrmojo.DPIManager.setDPI();mstrApp.oflnTxModel=new mstrmojo.OfflineTransactionModel();var view=this.rootView=this.viewFactory.newView("Root",{id:"rootView",placeholder:this.placeholder});var controller=this.rootController=this.controllerFactory.newController("Root",{id:"rootController",rootView:view});view.controllerId=controller.id;view.render();controller.start();if(!mstrApp.isActionBarNative()){window.setTimeout(function(){mstrMobileApp.getTitleBarHeight(mstrApp.rootView.getTitleHeight());},0);}},restart:function restart(){var rootController=this.rootController;if(rootController){rootController.restart();}else{this.start();}},onMobileDevice:function onMobileDevice(){return mstrConfig.onMobileDevice;},isTouchApp:function isTouchApp(){return($DOM.isIPad||$DOM.isAndroid||mstrApp.onMobileDevice())&&!$DOM.isWinPhone;},isLandscape:function isLandscape(){return(mstrMobileApp.getOrientation()===mstrmojo.android.EnumOrientationTypes.LANDSCAPE);},getConfiguration:function getConfiguration(){if(!this._cfg){this._cfg=new mstrmojo.MobileConfiguration();}return this._cfg;},isTablet:function isTablet(){return mstrMobileApp.isTablet();},isMicroTablet:function isMicroTablet(){if(cachedMicroTablet===undefined){cachedMicroTablet=false;if(this.isTablet()){var dimensions=this.getScreenDimensions(),limit=700;cachedMicroTablet=(dimensions.h<limit||dimensions.w<limit);}}return cachedMicroTablet;},goBack:function goBack(){if(this.cancelPending(true)){return true;}var menuClosed=false;$HASH.forEach(menus,function(v,id){var menu=mstrmojo.all[id];if(menu){menu.set("visible",false);menuClosed=true;}});menus={};if(menuClosed){return true;}var len=dialogs.length;if(len){var openDialog=dialogs[len-1];if(openDialog.goBack){if(openDialog.goBack()){return true;}}if(this.closeDialog()){return true;}}return(this.rootController&&this.rootController.goBack())||mstrMobileApp.goBack();},doSearch:function doSearch(){},menuShown:function menuShown(){},registerListener:function(name,target,fn){var s=lisStacks[name]||[];s.push({t:target,f:fn});lisStacks[name]=s;},unregisterListener:function(name,target){var s=lisStacks[name],l=s&&s.pop();if(!l||l.t!==target){window.alert("Unregister Search listener out of order.");if(s&&l){s.push(l);}}},getListener:function(name,target){var s=lisStacks[name],l=s&&((s.length)?s[s.length-1]:null);return((l&&l.t===target)?l:null);},cancelPending:function cancelPending(dontCloseDialogs){this.hideMessage();mstrMobileApp.hideProgress();var serverProxy=this.serverProxy;if(serverProxy){if(serverProxy.cancelRequests()){return true;}}return dontCloseDialogs?false:this.closeDialog();},onerror:function onerror(res,callback){handleError(res,this,callback);},showMessage:function showMessage(text){if(this.rootView){this.rootView.showMessage(text);}},showHTMLProgress:function showHTMLProgress(text){if(this.rootView){this.rootView.showHTMLProgress(text);}},hideMessage:function hideMessage(){if(this.rootView){this.rootView.hideMessage();}},hideHTMLProgress:function hideHTMLProgress(){if(this.rootView){this.rootView.hideHTMLProgress();}},showToastNotification:function showToastNotification(msg,duration){mstrMobileApp.toast(msg,duration);},displayHelp:function displayHelp(){var err=mstrMobileApp.displayHelp();if(err){mstrApp.onerror({message:err});}},isDialogUp:function isDialogUp(){return(dialogs.length>0);},showDialog:function showDialog(dialogConfig,viewName){var d;if(dialogConfig.isNative){d=mstrmojo.insert(dialogConfig);d.show();return d;}mstrMobileApp.showPopupDialog();dialogConfig.scriptClass=dialogConfig.scriptClass||"mstrmojo.android.Dialog";var cfg=mstrmojo.func.wrapMethods(dialogConfig,{onClose:function(){mstrMobileApp.closePopupDialog();dialogs.pop();}});d=viewName?this.viewFactory.newView(viewName,cfg):mstrmojo.insert(cfg);dialogs.push(d);d.render();window.setTimeout(function(){mstrMobileApp.forceRepaint();},0);return d;},showPopup:function showPopup(popupConfig,anchor){popupConfig.scriptClass=popupConfig.scriptClass||"mstrmojo.android.Popup";if(anchor){popupConfig.anchor=anchor;}return this.showDialog(popupConfig);},closeDialog:function closeDialog(){if(dialogs.length){dialogs[dialogs.length-1].close();return true;}return false;},closeAllDialogs:function closeAllDialogs(){var cDialogs=dialogs.slice(0),dialog=cDialogs.pop();while(dialog){dialog.close();dialog=cDialogs.pop();}dialogs=[];},setMenuStatus:function setMenuStatus(menuId,isOpen){if(isOpen){menus[menuId]=true;}else{delete menus[menuId];}},setCurrentProjectId:function setCurrentProjectId(id){this._currentProjId=id;},getCurrentProjectId:function getCurrentProjectId(){return this._currentProjId;},getSessionState:function getSessionState(projectId){return this.serverProxy.getSession(projectId||this._currentProjId);},getContentDimensions:function getContentDimensions(supportsFullScreen){return this.rootView.getContentDimensions(supportsFullScreen);},getContentPosition:function getContentPosition(){var contentDimensions=this.getContentDimensions();return{x:0,y:this.rootView.getTitleHeight(),w:contentDimensions.w,h:contentDimensions.h};},getScreenDimensions:function getScreenDimensions(){var deviceDimensions=String(mstrMobileApp.getScreenDimensions()).split("|");return{h:parseInt(deviceDimensions[0],10),w:parseInt(deviceDimensions[1],10)};},getResSetStore:function getResSetStore(){return mstrMobileApp.getResSetStore(this.getCurrentProjectId());},getResSetStoreMgr:function getResSetStoreMgr(){return mstrMobileApp.getResSetStoreMgr();},removeProjectCaches:function removeProjectCaches(pid){if(this.getConfiguration().getCacheEnabled()){this.getResSetStoreMgr().removeProjectCaches(pid);}},getLocaleInfo:function getLocaleInfo(projectId){projectId=projectId||this._currentProjId;return this.serverProxy.getLocaleInfo(projectId);},onConnectivityChanged:function onConnectivityChanged(onlineFlag,settingsChanged){var publisher=mstrmojo.publisher;if(onlineFlag&&settingsChanged){this.getConfiguration().reload();}publisher.publish(publisher.NO_SRC,publisher.CONNECTIVITY_CHANGED_EVENT,onlineFlag);if(onlineFlag){this.submitOfflineTransaction();}this.rootController.generateActionToolbar();},onReconcileEnd:function onReconcileEnd(){var publisher=mstrmojo.publisher;publisher.publish(publisher.NO_SRC,publisher.RECONCILE_END_EVENT,null);if(mstrMobileApp.isOnline()){this.submitOfflineTransaction();}},handleCompatibilityError:function handleCompatibilityError(){if(!this.handledCompatibilityError){this.handledCompatibilityError=true;if(!this.isHosted()){mstrmojo.toast(mstrmojo.desc(9419,"The version of this app is incompatible with one or more of the MicroStrategy Mobile Server(s). Please update the app to a more recent version."));}}},hasOpenDialog:function hasOpenDialog(){return dialogs.length>0;},isHosted:function isHosted(){return mstrMobileApp.isProxy;},isActionBarNative:function isActionBarNative(){return !this.isHosted();},cachesCleared:function cachesCleared(){this.refreshOfflineTransactionModel();}});$APP.$PF=function(direction,className,methodName){mstrMobileApp[(direction?"enter":"exit")+"JavaScriptMethod"](new Date().getTime(),methodName||arguments.callee.caller.name,className);};window.$MAPF=$APP.$PF;}());