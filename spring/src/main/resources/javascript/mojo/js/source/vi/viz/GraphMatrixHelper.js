(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.viz.DropZoneHelper","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.XMLBuilder","mstrmojo.gm.GMEnums");var $MOJO=mstrmojo,$HASH=$MOJO.hash,$ARR=$MOJO.array,$VIZ=$MOJO.vi.viz,$EDZ=$VIZ.EnumDSSDropZones,METRIC_NAMES_VISIBLE_THRESH=1,METRIC_NAMES_UNIT_TYPE=0,METRIC_NAMES_ID=$VIZ.DropZoneHelper.METRIC_NAMES_ID,$GH,$SAB=mstrmojo.gm.DualAxisSubAxisBit,AXIS_PRIMARY=$SAB.PRIMARY;mstrmojo.vi.viz.GraphMatrixHelper=mstrmojo.declare(mstrmojo.vi.viz.DropZoneHelper,null,{scriptClass:"mstrmojo.vi.viz.GraphMatrixHelper",handled:false,rowObjects:null,columnObjects:null,xAxisObjects:null,yAxisObjects:null,angleObjects:null,sliceObjects:null,breakByObjects:null,colorByObjects:null,currentXML:"",sizeByObjects:null,tooltipMetrics:null,data:null,metricsDropZone:"",secondaryMetricsDropZone:"",shape:"",subtype:"",metricShapes:null,visType:-1,init:function init(props){this._super(props);this.rowObjects=[];this.columnObjects=[];this.xAxisObjects=[];this.yAxisObjects=[];this.angleObjects=[];this.sliceObjects=[];this.breakByObjects=[];this.colorByObjects=[];this.sizeByObjects=[];this.tooltipMetrics=[];this.currentXML="";this.metricsDropZone="";this.secondaryMetricsDropZone="";this.shape="";this.subtype="";this.metricShapes="{}";},clone:function clone(srcHelper){var ths=this;ths.rowObjects=srcHelper.rowObjects.concat();ths.columnObjects=srcHelper.columnObjects.concat();ths.xAxisObjects=srcHelper.xAxisObjects.concat();ths.yAxisObjects=srcHelper.yAxisObjects.concat();ths.angleObjects=srcHelper.angleObjects.concat();ths.sliceObjects=srcHelper.sliceObjects.concat();ths.breakByObjects=srcHelper.breakByObjects.concat();ths.colorByObjects=srcHelper.colorByObjects.concat();ths.sizeByObjects=srcHelper.sizeByObjects.concat();ths.tooltipMetrics=srcHelper.tooltipMetrics.concat();ths.currentXML=srcHelper.currentXML;ths.metricsDropZone=srcHelper.metricsDropZone;ths.secondaryMetricsDropZone=srcHelper.secondaryMetricsDropZone;ths.shape=srcHelper.shape;ths.subtype=srcHelper.subtype;ths.metricShapes=srcHelper.metricShapes;},exists:function(obj,zone){var z=this[zone],r=false;$ARR.forEach(z,function(item){r=(item.did===obj.did);if(r){return false;}});return r;},removeAngleMetricFromOthers:function(obj){["xAxisObjects","yAxisObjects","tooltipMetrics"].every(function(z){var zone=this[z],idx=$ARR.find(zone,"did",obj.did);if(idx>-1){zone.splice(idx,1);return false;}});},getXml:function getXml(){var dz=this.data.dz,vp=dz?$HASH.copy(dz.visProp&&dz.visProp.fmt,{}):{},xml=new mstrmojo.XMLBuilder();if(this.shape){vp.Shape=this.shape;}if(this.subtype){vp.Subtype=this.subtype;}if(this.metricShapes){vp.metricShapes=this.metricShapes;}vp.visType=this.visType;xml.addChild("props");xml.addChild("widgetProps");xml.addChild("fmt");$HASH.forEach(vp,function(v,n){xml.addChild(n);xml.addAttribute("value",v);xml.closeElement();});xml.closeElement();xml.closeElement();xml.closeElement();return xml.toString();},setData:function setXml(p){if(!p){return ;}var ths=this,fn=function(dz,dst){if(dz){var arr=dz.TemplateUnit||dz.TemplateMetric;if(arr){arr.forEach(function(x){var item=$HASH.copy(x);if(!item.did){item.did=item.id;}dst.push(item);});}}};fn(p[$GH.PROP_ROWS],this.rowObjects);fn(p[$GH.PROP_COLUMNS],this.columnObjects);fn(p[$GH.PROP_XAXIS],this.xAxisObjects);fn(p[$GH.PROP_YAXIS],this.yAxisObjects);fn(p[$GH.PROP_BREAKBY],this.breakByObjects);fn(p[$GH.PROP_COLORBY],this.colorByObjects);fn(p[$GH.PROP_SIZEBY],this.sizeByObjects);fn(p[$GH.PROP_SLICE],this.sliceObjects);fn(p[$GH.PROP_ANGLE],this.angleObjects);fn(p[$GH.PROP_TOOLTIPMETRICS],this.tooltipMetrics);var fmt=p.visProp.fmt;this.shape=fmt[$GH.PROP_SHAPE];this.subtype=fmt[$GH.PROP_SUBTYPE];},setMetricsDropZone:function setMetricsDropZone(dz){if(!dz){return ;}var me=this;[$GH.PROP_ROWS,$GH.PROP_COLUMNS,$GH.PROP_XAXIS,$GH.PROP_YAXIS,$GH.PROP_BREAKBY,$GH.PROP_SLICE,$GH.PROP_COLORBY].forEach(function(z){if(dz[z]&&dz[z].hasOwnProperty("MetricNames")){if(me.metricsDropZone){me.secondaryMetricsDropZone=z;}else{me.metricsDropZone=z;}}});},getAddDropZonesAction:function(){var gmh=this,mdz=this.metricsDropZone,smdz=this.secondaryMetricsDropZone,r={act:"updateTemplate",keyContext:this.data.k,actions:[]},addMetricsTag=function(n){r.actions.push({act:"addDropZoneUnit",zoneId:$EDZ[n],unitId:METRIC_NAMES_ID,unitType:METRIC_NAMES_UNIT_TYPE});};[{p:"rowObjects",v:"Rows"},{p:"columnObjects",v:"Columns"},{p:"xAxisObjects",v:"XAxis"},{p:"yAxisObjects",v:"YAxis"},{p:"breakByObjects",v:"BreakBy"},{p:"colorByObjects",v:"ColorBy"},{p:"sizeByObjects",v:"SizeBy"},{p:"angleObjects",v:"Angle"},{p:"sliceObjects",v:"SliceBy"},{p:"tooltipMetrics",v:"AdditionalMetrics"}].forEach(function(item){var zone=gmh[item.p],id=$EDZ[item.v];zone.forEach(function(obj){r.actions.push({act:"addDropZoneUnit",zoneId:id,unitId:obj.did,unitType:obj.t,ax:obj.ax||AXIS_PRIMARY});});if(mdz===item.v){var fnIsMetricZone=function(zoneUnits){return(zoneUnits&&(zoneUnits.length>METRIC_NAMES_VISIBLE_THRESH)&&gmh.isMetricZone(zoneUnits));};if(fnIsMetricZone(gmh.xAxisObjects)||fnIsMetricZone(gmh.yAxisObjects)||fnIsMetricZone(gmh.angleObjects)){addMetricsTag(mdz);}}});if(smdz==="ColorBy"){addMetricsTag(smdz);}return r;}});$GH=mstrmojo.vi.viz.GraphMatrixHelper;$GH.PROP_ROWS="Rows";$GH.PROP_COLUMNS="Columns";$GH.PROP_HORIZONTAL_AXIS="HorizontalAxis";$GH.PROP_VERTICAL_AXIS="VerticalAxis";$GH.PROP_XAXIS="XAxis";$GH.PROP_YAXIS="YAxis";$GH.PROP_SLICE="SliceBy";$GH.PROP_ANGLE="AngleBy";$GH.PROP_BREAKBY="BreakBy";$GH.PROP_COLORBY="ColorBy";$GH.PROP_SIZEBY="SizeBy";$GH.PROP_TOOLTIPMETRICS="AdditionalMetrics";$GH.PROP_SHAPE="Shape";$GH.PROP_SUBTYPE="Subtype";$GH.PROP_METRICSHAPES="metricShapes";$GH.PROP_SHAPE_AREA="Area";$GH.PROP_SHAPE_LINE="Line";$GH.PROP_SHAPE_BAR="Bar";$GH.PROP_SHAPE_CIRCLE="Circle";$GH.PROP_SHAPE_SQUARE="Square";$GH.PROP_SHAPE_PIE="Pie";$GH.PROP_SHAPE_RING="Ring";$GH.PROP_SHAPE_TICK="Tick";$GH.PROP_SUBTYPE_CLUSTERED="Clustered";$GH.PROP_SUBTYPE_AUTOMATIC="Automatic";$GH.PROP_SUBTYPE_STACKED="Stacked";$GH.PROP_SUBTYPE_ABSOLUTE="Absolute";$GH.PROP_SUBTYPE_PERCENT="Percent";}());