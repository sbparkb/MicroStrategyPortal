(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.string","mstrmojo.array");var _L=mstrmojo.locales,_S=mstrmojo.string,_G=window.mstrConfig,$ARR=mstrmojo.array,getThousand=function(){return mstrmojo.locales.number.THOUSANDSEPARATOR;},getDecimal=function(){return mstrmojo.locales.number.DECIMALSEPARATOR;},_unit=_G.units,UNIT={CM:1,IN:2,MM:3,PT:4,PC:5,PX:6},UNIT_SYMBOL={1:"cm",2:"in",3:"mm",4:"pt",5:"pc",6:"px"},CAT={DEFAULT:-2,FIXED:0,CURR:1,PERCENT:4,FRACTION:5,SCIENTIFIC:6,GENERAL:9};var DPI_CONVERSION=96;String.prototype.reverse=function(){var res="",i;for(i=this.length;i>0;--i){res+=this.charAt(i-1);}return res;};function removeDoubleQuote(formatMask,customStrings){formatMask=formatMask||"";customStrings=customStrings||formatMask.match(/\".+?\"/g)||[];for(var i=0;i<customStrings.length;i++){formatMask=formatMask.replace(customStrings[i],customStrings[i].substring(1,customStrings[i].length-1).replace(/\$/g,"$$$$"));}return formatMask;}function convertIntToDate(value){var millisecondsPerDay=86400000,baseDate=new Date(1900,0,1,0,0,0,0),datePart=Math.floor(value)-1,timePart=value-datePart-1;if(value>=59){datePart--;}var convertedDate=new Date(baseDate.getTime()+(datePart*millisecondsPerDay));convertedDate.setTime(convertedDate.getTime()+timePart*millisecondsPerDay+500);return convertedDate;}function formatDate(date,formatMask,value){var dataInfo={"d+":date.getDate(),"h+|H":date.getHours(),"s+":date.getSeconds()},DATETIME=_L.datetime,k;if(/(y+)/.test(formatMask)){var yearStr=date.getFullYear().toString(),yearRegExp=RegExp.$1,isShortYear=yearRegExp.length===2,yearLen=yearStr.length;formatMask=formatMask.replace(yearRegExp,yearStr.substr(isShortYear?yearLen-2:0,isShortYear?2:yearLen));}if(/(^\[h\])/.test(formatMask)&&value){formatMask=formatMask.replace(RegExp.$1,""+(Math.floor(value*24)));}if(/(\"?:\"?mm)/.test(formatMask)){var mnt=date.getMinutes();formatMask=formatMask.replace(RegExp.$1,":"+(RegExp.$1.length===1?mnt:("00"+mnt).substr(mnt.toString().length)));}if(/(AM\/PM)/.test(formatMask)){var hours=dataInfo["h+"],isPM=hours>11;dataInfo["h+"]=hours-(isPM?12:0);formatMask=formatMask.replace(RegExp.$1,isPM?"PM":"AM");}for(k in dataInfo){if(new RegExp("("+k+")").test(formatMask)){formatMask=formatMask.replace(RegExp.$1,RegExp.$1.length===1?dataInfo[k]:("00"+dataInfo[k]).substr((dataInfo[k].toString()).length));}}if(/(mmmm)/.test(formatMask)){formatMask=formatMask.replace(RegExp.$1,DATETIME.MONTHNAME_FULL[date.getMonth()]);}else{if(/(mmm)/.test(formatMask)){formatMask=formatMask.replace(RegExp.$1,DATETIME.MONTHNAME_SHORT[date.getMonth()].substr(0,3));}else{if(/((m|M)+)/.test(formatMask)){var month=(date.getMonth()+1).toString();formatMask=formatMask.replace(RegExp.$1,RegExp.$1.length===1?month:("00"+month).substr(month.length));}}}return removeDoubleQuote(formatMask);}function extractDP(decimalLen,pattern){var i=0,len=pattern.length,dpLen=0;for(;i<len;i++){if(pattern[i]==="0"){dpLen++;}else{if(pattern[i]==="#"){if(dpLen<decimalLen){dpLen++;}}else{continue;}}}return dpLen;}mstrmojo.num=mstrmojo.provide("mstrmojo.num",{isInt:function isInt(v){var thousand=getThousand(),INT_THOUSAND=new RegExp("^(-)?[0-9]{1,3}(\\"+thousand+"[0-9]{3})*$"),INT_NO_THOUSAND=new RegExp("^(-)?[0-9]+$");return(String(v).indexOf(thousand)&&INT_THOUSAND.test(v))||INT_NO_THOUSAND.test(v);},isNumeric:function isNumeric(v,noDG){var decimal=getDecimal(),thousand=getThousand(),NUMERIC_THOUSAND=new RegExp("^(-)?[0-9]{1,3}(\\"+thousand+"[0-9]{3})*(\\"+decimal+"[0-9]+)?$"),NUMERIC_NO_THOUSAND=new RegExp("^(-)?[0-9]*(\\"+decimal+")?[0-9]+$");return(String(v).indexOf(thousand)&&NUMERIC_THOUSAND.test(v))||NUMERIC_NO_THOUSAND.test(v);},parseInteger:function parseInteger(v,r){if(!this.isInt(v)){return Number.NaN;}return parseInt(this.toString(v,true),r);},parseNumeric:function parseNumeric(v){if(!this.isNumeric(v)){return Number.NaN;}return parseFloat(this.toString(v,true));},inNumericRange:function inNumericRange(v,min,max){v=this.parseNumeric(v);max=(max!=null)?this.parseNumeric(String(max)):Number.NaN;min=(min!=null)?this.parseNumeric(String(min)):Number.NaN;if(max!=Number.NaN&&(v>max||isNaN(v))){return 1;}if(min!=Number.NaN&&(v<min||isNaN(v))){return -1;}return 0;},convertToUSUnits:function(value,unit,doNotLocalize){var __result=value;unit=unit||_unit;switch(parseInt(unit,10)){case UNIT.CM:__result=parseFloat(this.toString(value))/2.54+"";break;case UNIT.MM:__result=parseFloat(this.toString(value))/25.4+"";break;case UNIT.PT:__result=parseFloat(this.toString(value))/72+"";break;case UNIT.PC:__result=parseFloat(this.toString(value))/6+"";break;case UNIT.PX:__result=parseFloat(this.toString(value))/DPI_CONVERSION+"";break;}return doNotLocalize?__result:this.toLocaleString(__result);},convertToLocalUnits:function(value,unit,doNotLocalize){var __result;unit=unit||_unit;switch(parseInt(unit,10)){case UNIT.CM:__result=(parseFloat(this.toString(value))*2.54).toFixed(4)+"";break;case UNIT.MM:__result=(parseFloat(this.toString(value))*25.4).toFixed(4)+"";break;case UNIT.PT:__result=(parseFloat(this.toString(value))*72).toFixed(4)+"";break;case UNIT.PC:__result=(parseFloat(this.toString(value))*6).toFixed(4)+"";break;case UNIT.PX:__result=(parseFloat(this.toString(value))*DPI_CONVERSION)+"";break;default:__result=parseFloat(this.toString(value)).toFixed(4)+"";}return doNotLocalize?__result:this.toLocaleString(__result);},convertUnits:function(unitFrom,unitTo,value){return this.convertToLocalUnits(this.convertToUSUnits(value,unitFrom,true),unitTo,true);},toLocaleString:function(value){return(value+"").replace(".",getDecimal());},toString:function(value,removeThousandsSeparator){if(removeThousandsSeparator===true){var regex=this.getThousandSepRegex();if(regex){value=String(value).replace(regex,"");}}return String(value).replace(getDecimal(),".");},getThousandSepRegex:function(){if(this.thousandSeparatorRegex==null){this.thousandSeparatorRegex=new RegExp(getThousand().replace(/(\W){1}/g,"\\$1"),"g");}return this.thousandSeparatorRegex;},addSeparators:function(val,ts){var _ts=ts;if(ts=="."||ts=="*"||ts=="\\"){_ts="\\"+ts;}return val.reverse().replace(/(\d{3})/g,"$1"+ts).reverse().replace(new RegExp("^(-)?"+_ts),"$1");},format:function(category,decimalPlaces,curr,nm){var pattern="",ds=(decimalPlaces>0)?".":"",zeros=[];curr=(curr)?curr:"";for(var i=0;i<decimalPlaces;i++){zeros.push("0");}zeros=zeros.join("");switch(category){case CAT.GENERAL:pattern="0.00";break;case CAT.PERCENT:pattern="0"+ds+zeros+"%";break;case CAT.SCIENTIFIC:pattern="0"+ds+zeros+"E+00";break;default:pattern='"'+curr+'"#,##0'+ds+zeros;}return this.formatByMask(pattern,nm);},getDecimalLength:function getDecimalLength(pattern){var position=pattern.indexOf("."),decimalLength=0;if(position!==-1){var decimalString=pattern.substr(position+1,pattern.length).match(/\d+/);if(decimalString&&decimalString.length>0){decimalLength=decimalString[0].length;}}return decimalLength;},formatByMask:function(formatMask,nm){var convertedDate,isDateByDefault;if(isNaN(nm)){convertedDate=new Date(nm);if(isNaN(convertedDate)){return nm;}isDateByDefault=true;}if(formatMask==="General"){return String(parseFloat(nm).toFixed(2));}var ptns=String(formatMask).split(";"),result="",pattern=ptns[0],ph="\u00A4",qt=/"[^"]*"/g,pf=(formatMask&&formatMask.replace(qt,ph).replace(/\[.*\]/g,ph))||"",dateOrTimeStr=["m","y","d","h","s"],isDateOrTime=false;$ARR.forEach(dateOrTimeStr,function(str){isDateOrTime=isDateOrTime||pf.indexOf(str,0)!==-1;});if(isDateOrTime){if(window.SSF){result=window.SSF.format(formatMask,nm);}if(result!==""){return result;}else{return formatDate(isDateByDefault?convertedDate:convertIntToDate(nm),formatMask,nm);}}var ePos=pattern.indexOf("E+"),pPos=pattern.indexOf("%"),cs=pattern.match(/\".+?\"/g),fs=pattern.indexOf("?/?")>-1,cat=(ePos!=-1)?CAT.SCIENTIFIC:((pPos!=-1)?CAT.PERCENT:((cs)?CAT.CURR:fs?CAT.FRACTION:CAT.FIXED)),currMask="",negMask="",isNeg=false,sNm=new String(nm),nN=this.parseNumeric(nm)||parseFloat(nm);if(cs){if(pattern.match(/\[\$.+?\]/g)){for(var dd=0;dd<cs.length;dd++){pattern=pattern.replace(cs[dd],cs[dd].substring(1,cs[dd].length-1));if(cs[dd].match(/\[\$.+?\]/g)){cs[dd]=cs[dd].replace(/\[\$.+?\]/g,cs[dd][cs[dd].indexOf("[$")+2]);}}pattern=pattern.replace(/\[\$.+?\]/g,'"#"'.replace("#",pattern[pattern.indexOf("[$")+2]));}currMask=removeDoubleQuote(pattern,cs);currMask=currMask.replace(pattern.replace(/\".+?\"/g,""),ph);}if(nN<0){sNm=sNm.substring(1,sNm.length);nN=-nN,isNeg=true;if(ptns.length>1){var _ptns1=ptns[1].replace(/\[.*\]/,"");negMask=removeDoubleQuote(_ptns1.replace(ptns[0],ph));}}var negativeFormat=function(sNm,negMask){return(negMask)?negMask.replace(ph,sNm):"-"+sNm;};if(cat==CAT.FRACTION){var i,j,minIndex,base=10,output,intPart=0,v,currentMin,temp,sepInt=false,stemp;if(formatMask.indexOf("# ")>-1){sepInt=true;}for(i=5;i>0;i--){stemp="/";for(j=0;j<i;j++){stemp+="?";}if(formatMask.indexOf(stemp)>-1){for(j=1;j<i;j++){base*=10;}break;}}if(sepInt){intPart=Math.floor(Number(nN));nN-=intPart;}currentMin=base/2;minIndex=-1;v=nN*base;for(i=base-1;i>=2;i--){temp=(v*i)/base;temp=temp-Math.floor(temp);temp=temp*base;if(Math.abs(temp-base)<temp){temp=Math.abs(temp-base);}temp=temp/i;if(temp<currentMin){currentMin=temp;minIndex=i;}else{if((temp==currentMin)&&(temp==0)){currentMin=temp;minIndex=i;}}}output=Math.round(minIndex*v/base);for(i=minIndex;i>=2;i--){if((output%i==0)&&(minIndex%i==0)){output=output/i;minIndex=minIndex/i;break;}}if(minIndex==base){minIndex=1;output=0;}if(output==0){minIndex=1;}if(output==minIndex){if(sepInt){result=""+(intPart+1);}else{result="1";}}else{if(sepInt&&intPart>0){if(output==0){result=intPart;}else{result=intPart+" "+output+"/"+minIndex;}}else{if(output==0){result="0";}else{result=output+"/"+minIndex;}}}if(isNeg){result=negativeFormat(result,negMask);}}else{if(cat==CAT.SCIENTIFIC){if(nN!=0){var exp=Math.floor(Math.log(nN)/Math.LN10),m=nN/Math.pow(10,exp),beStr=pattern.substring(0,ePos),dPos=beStr.indexOf("."),expFill=pattern.length-pattern.indexOf("E+")-(""+Math.abs(exp)).length-2,i,negExp=exp<0;exp=Math.abs(exp);for(i=0;i<expFill;i++){exp="0"+exp;}result+=Number(m).toFixed((dPos!=-1)?beStr.length-dPos-1:0);result=((isNeg)?negativeFormat(result,negMask):result)+"E"+(negExp?"-":"+")+exp;}else{result="0";}}else{if(cat==CAT.PERCENT){pattern=pattern.substring(0,pattern.length-1);sNm=String(nN*100);}var dPos=pattern.indexOf("."),dp=0,decimalLen,subPattern=dPos>=0?pattern.substring(0,dPos):pattern;if(subPattern.match(/[#0\?],$/)){nN/=1000;sNm=String(nN);}decimalLen=this.getDecimalLength(sNm);if(dPos!=-1){dp=extractDP(decimalLen,pattern.substr(dPos+1,pattern.length));}result=String(parseFloat(sNm).toFixed(Math.min(dp,20)));var nn=result.split(".");var tsPos=pattern.replace(/"[^"]*"/g,"").match(/[#\d]+[^\.\d#]+[#\d]+/);if(tsPos!==null){nn[0]=this.addSeparators(nn[0],getThousand());}result=nn.join(getDecimal());if(cat==CAT.CURR){result=currMask.replace(ph,result);if(result===currMask&&window.SSF){result=window.SSF.format(formatMask,nm);}}if(cat==CAT.PERCENT){result+="%";}if(isNeg){result=negativeFormat(result,negMask);}}}return result;},validateFormat:function(fm){var _rtn=true,ptns=String(fm).split(";");if(ptns[1]&&ptns[1].indexOf(ptns[0])<0){_rtn=false;}return _rtn;},generateUniqueID:function(keyLen){var chars="0123456789ABCDEF".split(""),id=[];for(var i=0;i<keyLen;i++){id[i]=chars[0|Math.random()*16];}return id.join("");},countOfDecimals:function(v,decimalSep){var sV=String(v);return sV.length-(sV.indexOf(decimalSep!==undefined?decimalSep:getDecimal())+1);}});mstrmojo.num.UNIT=UNIT;mstrmojo.num.UNIT_SYMBOL=UNIT_SYMBOL;})();