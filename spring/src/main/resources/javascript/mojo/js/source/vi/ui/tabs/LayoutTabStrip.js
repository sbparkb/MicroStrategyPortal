(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui._HasMask","mstrmojo.vi.ui.tabs.Tab","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.models.FormatModel","mstrmojo.vi.models.VIComponentMap");var $HASH=mstrmojo.hash,$DOM=mstrmojo.dom,$ARR=mstrmojo.array,ENUM_ACTIONS=mstrmojo.vi.ui.tabs.Tab.ACTIONS,MENU_ACTIONS=ENUM_ACTIONS.DELETE+ENUM_ACTIONS.DUPLICATE+ENUM_ACTIONS.MOVE+ENUM_ACTIONS.RENAME+ENUM_ACTIONS.NEW_TAB,$VI_TYPES=mstrmojo.vi.models.VIComponentMap.TYPES,$FORMAT_MODEL=mstrmojo.models.FormatModel,ADD_BUTTON_WIDTH=40;mstrmojo.vi.ui.tabs.LayoutTabStrip=mstrmojo.declare(mstrmojo.vi.ui.tabs.TabStrip,[mstrmojo.vi.ui._HasMask],{scriptClass:"mstrmojo.vi.ui.tabs.LayoutTabStrip",docModel:null,isAlignRight:false,isAlignBottom:true,cssClass:"mstrmojo-LayoutTabStrip",markupMethods:{onisAlignBottomChange:function(){mstrmojo.css.toggleClass(this.domNode,"alignTop",!this.isAlignBottom);},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{w:{addBtnNode:ADD_BUTTON_WIDTH+"px"},xt:true},onAppStateChange:function onAppStateChange(evt){this._super(evt);this.set("isMasked",evt.value===mstrmojo.vi.VisualInsightApp.APP_STATES.SELECTOR_TARGETING);},widgetResized:function widgetResized(){var fnAdjustLayout=function(){this.tabContainerNode.style.maxWidth=($DOM.position(this.domNode).w-ADD_BUTTON_WIDTH)+"px";};if(this.hasRendered){fnAdjustLayout.call(this);return ;}this.attachEventListener("renderComplete",this.id,fnAdjustLayout);},buildRendering:function bldRendering(){this._super();var borderDiv=this.borderNode=document.createElement("div");borderDiv.className="mstrmojo-VILayoutTabs-divider";borderDiv.style.zIndex=this._borderZIndex;this.domNode.appendChild(borderDiv);},getTabCfg:function getTabCfg(allTabObjects,currentTabObject,cfg){var tabKey=cfg.k,tabStripId=this.id;$HASH.copy({title:currentTabObject.n,getMenuActions:function getMenuActions(){return MENU_ACTIONS;},addNewTabMenuItem:function addNewTabMenuItem(menuCfg){menuCfg.addMenuItem(mstrmojo.desc(13768,"Insert Panel"),"",function(){var currentTabObject=(allTabObjects||[]).filter(function(layout){return layout.k===tabKey;})[0];currentTabObject.builder.getLayoutVIMap(currentTabObject.model.getCurrentLayoutKey()).getComponent($VI_TYPES.VIZ_CONTENT).addPanel();});menuCfg.addSeparator();menuCfg.addMenuItem(mstrmojo.desc(13769,"Insert Sheet"),"",function(){mstrmojo.all[tabStripId].addTab();});},tabSelected:function tabSelected(){var doc=this.parent.parent,model=doc.model;model.execute({execute:function execute(){doc.showLayout((allTabObjects||[]).filter(function(layout){return layout.k===tabKey;})[0]);},urInfo:{treesToRender:3}});},tabDeleted:function tabDeleted(){var doc=this.parent.parent,model=doc.model;model.execute({execute:function execute(){var update=model.getDataService().newUpdate(this);doc.deleteLayout(tabKey,update);this.submitUpdate(update);},urInfo:{treesToRender:3}});},tabDuplicated:function tabDuplicated(){var doc=this.parent.parent,model=doc.model;model.execute({execute:function execute(){var update=model.getDataService().newUpdate(this);doc.duplicateLayout(update,tabKey);this.submitUpdate(update,model.cmdMgr().CMD_PHASE.FIRST);},urInfo:{disablePU:true,treesToRender:3}});},titleEdited:function editTitle(titleText,oldText){var layoutKey=this.k,doc=this.parent.parent,tabFn=function(){return $ARR.filterOne(mstrmojo.all[tabStripId].getTabs(),function(tab){return tab.k===layoutKey;});},currentLayoutFn=function(){return $ARR.filterOne(doc.getLayouts(),function(layout){return layout.k===layoutKey;});};this.parent.docModel.renameLayout(tabKey,titleText,oldText,{failure:function failure(err){mstrApp.onerror(err);tabFn().set("title",oldText);},success:function success(title){var currentLayout=currentLayoutFn();currentLayout.defn.title=title;currentLayout.set("n",title);var stack=currentLayout.builder.getLayoutVIMap(currentLayout.model.getCurrentLayoutKey()).getComponent($VI_TYPES.FILTER_STACK);if(stack){stack.set("title",title);}tabFn().set("title",title);}});},postCreateChildren:function postCreateChildren(){$HASH.copy({autoApplyDelay:3000,editOnDoubleClick:mstrApp.allowWebDashboardDesign()},this.lbl);},useRichTooltip:true,updateTooltipConfig:function updateTooltipConfig(evt){var target=evt.target;if(target===this.lbl.domNode&&target.scrollWidth>target.clientWidth){var position=$DOM.position(target);this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMCENTER,cssClass:"vi-regular vi-tooltip-V V-center",content:this.title,top:position.y,left:position.x+position.w/2};}else{this.richTooltip=null;}},getCustomMenu:function(){var menuCfg=new mstrmojo.ui.menus.MenuConfig(),strip=this.parent,model=strip.parent.model,alignBottom=strip.isAlignBottom,propName=$FORMAT_MODEL.ENUM_PROPERTY_NAMES.LAYOUT_TAB_POSITION,text=alignBottom?mstrmojo.desc(13770,"Move Sheet Tabs to Top"):mstrmojo.desc(13771,"Move Sheet Tabs to Bottom");menuCfg.addMenuItem(text,"",function(){var fnUpdateModel=function(isBottomAlign){model.set(propName,isBottomAlign?0:1);};fnUpdateModel(alignBottom);model.saveDocProps($FORMAT_MODEL.getFormatUpdate(propName,!alignBottom),{extras:{params:{suppressData:true}},undo:function(){fnUpdateModel(!alignBottom);},redo:function(){fnUpdateModel(alignBottom);}});});return menuCfg;}},cfg);this.docModel=currentTabObject.model;return cfg;},addTab:function addTab(){var parent=this.parent,model=parent.model;model.execute({execute:function execute(){var update=model.getDataService().newUpdate(this);parent.addNewLayout(update,-1,null);this.submitUpdate(update,model.cmdMgr().CMD_PHASE.FIRST);},urInfo:{disablePU:true,treesToRender:3}});},commitTabMove:function commitTabMove(fromIdx,toIdx){this.parent.moveLayout(fromIdx,toIdx);},onTabsChange:function onTabsChange(){(this.children||[]).slice(0).reverse().forEach(function(tab,idx,arr){var zIndex=idx+2;if(tab.isSelected){zIndex=arr.length+3;var borderNode=this.borderNode;if(this.borderNode){borderNode.style.zIndex=zIndex-1;}else{this._borderZIndex=zIndex-1;}}tab.set("zIndex",zIndex);},this);}});}());