(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Box","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.HBox","mstrmojo.Label");var $ALERT=mstrmojo.alert,toggleFields=function(state){var setVisible=function(o,s){o.set("visible",s);},openOnly=!!this.openOnly;switch(state){case"loading":setVisible(this.loadingBox,true);break;case"login":setVisible(this.loadingBox,false);setVisible(this.loginBox,true);setVisible(this.loginBox.user,true);setVisible(this.loginBox.pwd,true);break;case"signup":break;}},getPublicCloudSession=function getPublicCloudSession(email,pwd,callback){this.connectivityProxy.getPublicCloudSession({email:email,password:pwd},callback);},getSaveAsCallBack=function(cloudConnInfo){var editor=this;return{success:function(res){editor.close();var editorId="sharingEditor",sharingEditor=mstrmojo.all[editorId],oi={did:res.did,t:55,st:14081};if(!sharingEditor){sharingEditor=mstrmojo.insert({scriptClass:"mstrmojo.SharingEditor",guestModeEnabled:false,mid:-1,id:editorId,oi:oi,href:res.url,urlReady:true,isLinkDirty:undefined,viewMode:undefined,lastState:undefined});}else{sharingEditor.set("oi",oi);sharingEditor.href=res.url,sharingEditor.mid=-1;sharingEditor.isLinkDirty=undefined;sharingEditor.viewMode=undefined;sharingEditor.lastState=undefined;sharingEditor.urlReady=true;}sharingEditor.open();}.bind(this)};};mstrmojo.onetier.vi.ui.SaveToCloud=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.onetier.vi.ui.SaveToCloud",title:mstrmojo.desc(14317,"Login to Public Cloud"),help:"pending.htm",children:[{alias:"message",scriptClass:"mstrmojo.Label",cssText:"width:100%; padding:20px 0;",visible:false,text:mstrmojo.desc(13552,"Select a location to save your dashboard:")},{alias:"loginBox",scriptClass:"mstrmojo.Box",cssText:"position:relative;",visible:true,children:[{alias:"user",scriptClass:"mstrmojo.TextBox",cssClass:"login-username",cssDisplay:"block",cssText:"width: 100%;margin: 10px 0;",hint:mstrmojo.desc(17,"User name"),postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(17,"User name");}},onEnter:function(){this.parent.parent.saveAs();}},{alias:"pwd",scriptClass:"mstrmojo.TextBox",cssClass:"login-pwd",cssText:"width: 100%;margin: 10px 0;",cssDisplay:"block",hint:mstrmojo.desc(18,"Password"),type:"password",postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(18,"Password");}},onEnter:function(){this.parent.parent.saveAs();}}]},{alias:"linksBox",scriptClass:"mstrmojo.Box",cssText:"position:relative;",children:[{alias:"getPassword",scriptClass:"mstrmojo.Label",cssText:"color:rgb(38, 143, 202);text-align:right;cursor:pointer;",text:mstrmojo.desc(14318,"Get Password"),onclick:function(){$ALERT("get password");}}]},{alias:"buttonBox",scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"ok",text:mstrmojo.desc(14319,"Login"),onclick:function(){this.parent.parent.saveAs();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]},{alias:"loadingBox",scriptClass:"mstrmojo.Box",cssText:"background: url(../javascript/mojo/css/vi/images/spinner_white.gif) no-repeat center center;left: 0;right: 0;top: 0;bottom: 0;z-index: 1;position: absolute;",visible:false}],init:function init(props){this._super(props);},saveAs:function saveAs(){toggleFields.call(this,"loading");var editor=this;getPublicCloudSession.call(this,this.loginBox.user.value,this.loginBox.pwd.value,{success:function(res){editor.connectivityProxy.saveToPublicCloud(res.session,getSaveAsCallBack.call(editor));},failure:function(){$ALERT("There was an error getting the public cloud session");toggleFields.call(this,"login");}});}});}());