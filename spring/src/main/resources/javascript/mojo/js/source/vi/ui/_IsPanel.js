(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.CollapsibleTitleBar","mstrmojo.ui.menus.ToolbarConfig","mstrmojo.ui.menus.Menu","mstrmojo.dom","mstrmojo.css");var $CSS=mstrmojo.css,CSS_BTN_VISIBLE="visible",CONTAINER_SLOT="containerNode";function setMenuButtonVisibility(info){info.btn.style.display=!!info.menuCfg?"block":"none";}mstrmojo.vi.ui._IsPanel=mstrmojo.provide("mstrmojo.vi.ui._IsPanel",{_mixinName:"mstrmojo.vi.ui._IsPanel",markupString:'<div id="{@id}" class="mstrmojo-VIPanel {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="mstrmojo-VIPanel-titlebar"></div><div class="mstrmojo-VIPanel-content"></div><div class="mstrmojo-VIDND-mask"></div><div class="mstrmojo-VIPanel-handle splitter v"></div></div>',markupSlots:{titlebarNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.childNodes[2];},handleNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onisCollapsedChange:function onisCollapsedChange(){if(this.canCollapse){this.containerNode.style.display=this.isCollapsed?"none":"block";if(!this.isCollapsed){this.doLayout();}}}},title:"",titleBar:null,titlebarNode:null,containerNode:null,maskNode:null,handleNode:null,bubbleMouseOver:true,canCollapse:false,isCollapsed:false,autoHideToolbar:false,init:function init(props){this._super(props);this.addChildren([this.getTitleBarCfg()]);this.menuBtnInfo={};},skipsSlotLayout:function(slotName){return slotName===CONTAINER_SLOT&&this.isCollapsed;},getTitleBarCfg:function getTitleBarCfg(){return{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",slot:"titlebarNode",alias:"titleBar",isCollapsed:this.isCollapsed,title:this.title,close:function(){this.parent.setOpenStatus(false);mstrApp.rootCtrl.generateToolbar();},collapse:function(isCollapsed){this.parent.set("isCollapsed",isCollapsed);}};},ontitleChange:function ontitleChange(){this.titleBar.set("title",this.title);},_set_children:function setCh(n,v,silent){if(v!==this.children){var titleBar=this.titleBar;if(titleBar){v.push(titleBar);}}return this._super(n,v,silent);},preBuildRendering:function preBuildRendering(){this.generateToolbar();this.titleBar.setToolbarVisibility(!this.autoHideToolbar);return this._super();},generateToolbar:function generateToolbar(){var titleBar=this.titleBar;titleBar.set("toolbarCfg",this.updateToolbar(new mstrmojo.ui.menus.ToolbarConfig()));if(!titleBar.visible){this.menuBtnInfo.menuCfg=titleBar.getMenuConfig();}},updateToolbar:function updateToolbar(cfg){return cfg;},setOpenStatus:function setOpenStatus(isOpen){if(this.visible!==isOpen){this.set("visible",isOpen);this.parent.doLayout();}},setTitleBarVisibility:function setTitleBarVisibility(isVisible){var titleBar=this.titleBar;titleBar.set("visible",isVisible);this.generateToolbar();var info=this.menuBtnInfo,menuBtn=info.btn;if(!menuBtn){menuBtn=info.btn=document.createElement("div");menuBtn.className="hover-menu-btn";var id=this.id;mstrmojo.dom.attachEvent(menuBtn,"click",function(){var panel=mstrmojo.all[id],cfg=info.menuCfg;cfg.hostId=id;cfg.hostElement=menuBtn;panel.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:cfg}));});this.domNode.appendChild(menuBtn);}info.menuCfg=isVisible?null:titleBar.getMenuConfig();setMenuButtonVisibility(info);this.doLayout();},onmouseover:function onmouseover(evt){if(!mstrApp.isInteractive()){return ;}if(!this.bubbleMouseOver){evt.cancel();}var timeout=this._panelTimeout;if(timeout){window.clearTimeout(timeout);delete this._panelTimeout;}if(this.autoHideToolbar){this.titleBar.setToolbarVisibility(true);}var menuBtnInfo=this.menuBtnInfo;if(!!menuBtnInfo.menuCfg){$CSS.addClass(menuBtnInfo.btn,CSS_BTN_VISIBLE);}},onmouseout:function onmouseout(){var id=this.id;this._panelTimeout=window.setTimeout(function(){var panel=mstrmojo.all[id];if(panel){if(panel.autoHideToolbar){panel.titleBar.setToolbarVisibility(false);}var menuBtnInfo=panel.menuBtnInfo;if(!!menuBtnInfo.menuCfg){$CSS.removeClass(menuBtnInfo.btn,CSS_BTN_VISIBLE);}}},200);}});}());