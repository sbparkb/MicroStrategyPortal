(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Container","mstrmojo._IsPopup","mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.ui._HasScroller");var $BOX=mstrmojo.boxmodel,$DOM=mstrmojo.dom,$CSS=mstrmojo.css,CSS_TOOLTIP="mstrmojo-Tooltip",CSS_SCROLL_NODE="mstrmojo-scrollNode",CURSOR_HEIGHT=20;function toggleScrollbox(opener,tooltip,isDetach){var fnName="connectScrollbox";if(isDetach){fnName="dis"+fnName;}var parent=opener&&opener.parent;while(parent){if(parent[fnName]){parent[fnName](tooltip);}parent=parent.parent;}}function delayPaint(){if(!this._paintHandle){var id=this.id,fnPaint=function(isInit){var tooltip=mstrmojo.all[id];if(!tooltip){return ;}delete tooltip._paintHandle;var domNodeCss=[CSS_TOOLTIP],cssClass=tooltip.cssClass;if(cssClass){domNodeCss.push(cssClass);}var themeClassName=mstrApp.getThemeClassName&&mstrApp.getThemeClassName(),opener=tooltip.opener;if(opener&&opener.getTooltipThemeClass){themeClassName=opener.getTooltipThemeClass();}domNodeCss.push(themeClassName);tooltip.domNode.className=domNodeCss.join(" ");var tooltipContent=tooltip.content,contentNode=tooltip.contentNode,arrowNode=tooltip.arrowNode;contentNode.className=(CSS_TOOLTIP+"-content "+CSS_SCROLL_NODE+" "+tooltip.contentNodeCssClass);contentNode.style.cssText=tooltip.contentNodeCssText;contentNode.innerHTML=tooltipContent;arrowNode.style.cssText="";tooltip.domNode.style.visibility=!!tooltipContent?"visible":"hidden";tooltip.updatePosition();if(!isInit&&tooltip.optimizePos){tooltip.optimizePos();}tooltip.updateScrollbars();};if(!this._hasPaint){fnPaint(true);this._hasPaint=true;}else{this._paintHandle=window.setTimeout(fnPaint,0);}}}function updateTooltipProperties(tooltip,opener,e,win){var reference=opener&&(opener.richTooltip||opener.tooltip),mousePosition=e?$DOM.getMousePosition(e,win||self):null,isString=reference&&(typeof reference==="string");var cnCssCls="",cssClass="",cnCssTxt="",content=reference,refNode=null,positionType=mstrmojo.tooltip.POS_TOPLEFT,left=null,top=null;var keepArrowXPos=false,keepArrowYPos=false;if(reference&&!isString){cssClass=reference.cssClass||cssClass;cnCssCls=reference.contentNodeCssClass||cnCssCls;cnCssTxt=reference.contentNodeCssText||cnCssTxt;content=reference.content||"";refNode=reference.refNode||refNode;positionType=reference.posType||positionType;left=reference.left||0;top=reference.top||0;keepArrowXPos=reference.keepArrowXPos||keepArrowXPos;keepArrowYPos=reference.keepArrowYPos||keepArrowYPos;}tooltip.set("contentNodeCssClass",cnCssCls);tooltip.set("cssClass",cssClass);tooltip.set("contentNodeCssText",cnCssTxt);tooltip.set("content",content);tooltip.set("refNode",refNode);tooltip.set("posType",positionType);tooltip.set("left",isString?((mousePosition&&mousePosition.x)||tooltip.left):left);tooltip.set("top",(isString||!reference)?((mousePosition&&(mousePosition.y+CURSOR_HEIGHT))||tooltip.top):top);tooltip.set("keepArrowXPos",keepArrowXPos);tooltip.set("keepArrowYPos",keepArrowYPos);}mstrmojo.Tooltip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Tooltip",content:null,top:null,left:null,refNode:null,keepArrowXPos:false,keepArrowYPos:false,posType:"TL",markupString:'<div id="{@id}" class="'+CSS_TOOLTIP+' {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout><div class="'+CSS_TOOLTIP+'-shadow {@shadowNodeCssClass}"></div><div class="'+CSS_TOOLTIP+'-contentWrapper"><div class="'+CSS_TOOLTIP+"-content "+CSS_SCROLL_NODE+' {@contentNodeCssClass}" style="{@contentNodeCssText}"></div></div><div class="'+CSS_TOOLTIP+'-arrow"></div></div>',markupSlots:{containerNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[1].firstChild;},shadowNode:function(){return this.domNode.firstChild;},arrowNode:function(){return this.domNode.children[2];}},setupScrollNodes:function setupScrollNodes(){this.scrollNode=this.contentNode;this.scrollbarHostNode=this.containerNode;},_previousVisible:false,markupMethods:{onvisibleChange:function(){var domNodeStyle=this.domNode.style,isVisible=!!this.visible;if(this._previousVisible!==isVisible){domNodeStyle.visibility="hidden";}domNodeStyle.display=isVisible?"block":"none";this._previousVisible=isVisible;if(isVisible){this.updatePosition();if(this.content){delayPaint.call(this);}}},onleftChange:delayPaint,ontopChange:delayPaint,onrefNodeChange:delayPaint,onposTypeChange:delayPaint,oncontentNodeCssClassChange:delayPaint,oncontentNodeCssTextChange:delayPaint,oncontentChange:delayPaint,oncssClassChange:delayPaint},preBuildRendering:function preBuildRendering(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},updatePosition:function updatePosition(ignoreVisible){if(!this.visible&&!ignoreVisible){return ;}var ref=this.refNode,offset=ref?$BOX.offset(ref,document.body):{left:$DOM.getHorizontalScroll(),top:$DOM.getVerticalScroll()},domNodeStyle=this.domNode.style,containerNode=this.containerNode,containerOffsetWidth=containerNode.offsetWidth,containerOffsetHeight=containerNode.offsetHeight,positionType=this.posType,positionRight=positionType.indexOf("R")>-1,positionBottom=positionType.indexOf("B")>-1,top=this.top!==null?parseInt(this.top,10)+offset.top-(positionBottom?containerOffsetHeight:0):null,left=this.left!==null?parseInt(this.left,10)+offset.left-(positionRight?containerOffsetWidth:((positionType.indexOf("C")>-1)?Math.floor(containerOffsetWidth/2):0)):null,isLeftOffset=false,isTopOffset=false,newLeft,newTop,winDim=$DOM.windowDim(),bodyClientWidth=$DOM.getHorizontalScroll()+winDim.w,bodyClientHeight=$DOM.getVerticalScroll()+winDim.h,arrowNode=this.arrowNode,arrowStyle=null;if(left!==null){newLeft=Math.min(Math.max(left,0),bodyClientWidth-containerOffsetWidth);domNodeStyle.left=newLeft+"px";isLeftOffset=left!==newLeft;}if(top!==null){newTop=Math.min(Math.max(top,0),bodyClientHeight-containerOffsetHeight);domNodeStyle.top=newTop+"px";isTopOffset=top!==newTop;}if(isLeftOffset||isTopOffset){if((this.keepArrowXPos&&isLeftOffset)||(this.keepArrowYPos&&isTopOffset)){arrowStyle=$CSS.getComputedStyle(arrowNode);}if(this.keepArrowXPos&&isLeftOffset){arrowNode.style.left=(parseInt(arrowStyle.left,10)+left-newLeft)+"px";}if(this.keepArrowYPos&&isTopOffset){arrowNode.style.top=(parseInt(arrowStyle.top,10)+top-newTop)+"px";}}$CSS.toggleClass(this.domNode,"offset",isLeftOffset||isTopOffset);},_on_tooltip_change:function(evt){updateTooltipProperties(this,evt&&evt.src);},_set_opener:function(n,opener){var currentOpener=this.opener,isOpenerChanged=opener!==currentOpener;if(isOpenerChanged){if(opener){toggleScrollbox(opener,this);}if(currentOpener){toggleScrollbox(opener,this,true);}if(currentOpener&&currentOpener.detachEventListener){currentOpener.detachEventListener(this._richSubs);currentOpener.detachEventListener(this._ttpSubs);}if(opener&&opener.attachEventListener){this._richSubs=opener.attachEventListener("richTooltipChange",this.id,"_on_tooltip_change");this._ttpSubs=opener.attachEventListener("tooltipChange",this.id,"_on_tooltip_change");}this.opener=opener;}return isOpenerChanged;},updatePopupConfig:function(config,opener){updateTooltipProperties(this,opener,config&&config.e,config&&config.win);},onscroll:function onscroll(){if(this.visible&&this.nudge){this.nudge();}this._super();},onmouseover:mstrmojo.emptyFn,onmouseout:mstrmojo.emptyFn});var ttpInst=null;mstrmojo.tooltip={POS_TOPLEFT:"TL",POS_BOTTOMLEFT:"BL",POS_TOPRIGHT:"TR",POS_BOTTOMRIGHT:"BR",POS_BOTTOMCENTER:"BC",POS_TOPCENTER:"TC",open:function open(opener,e,win,config){if(!ttpInst||!mstrmojo.all[ttpInst.id]){ttpInst=new mstrmojo.Tooltip();}config=config||{};config.e=e;config.win=win;ttpInst.open(opener,config);opener.tooltip=ttpInst;},close:function close(){if(ttpInst){if(ttpInst.opener){ttpInst.opener.tooltip=null;}ttpInst.close();}}};}());