(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.array","mstrmojo.vi.models.editors.ControlsViewFactory","mstrmojo.Label","mstrmojo.vi.ui.TextAlignButtonBar","mstrmojo.vi.ui.editors.EditorGroup","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.vi.ui.editors.MoreOptionsEditor");var $HASH=mstrmojo.hash,$CONTAINER_FLAGS=mstrmojo.ui.editors.controls.ContainerGroup.CTRL_FLAGS,MORE_OPTIONS_EDITOR_ID="mstrmojo-more-options-editor";mstrmojo.vi.models.editors.EditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.ControlsViewFactory,null,{scriptClass:"mstrmojo.vi.models.editors.EditorModel",hostId:"",help:"",getHost:function getHost(){return mstrmojo.all[this.hostId];},docModel:null,getEditorContents:mstrmojo.emptyFn,getGroupTitle:function getGroupTitle(text){return new mstrmojo.Label({cssClass:"edt-title",text:text});},getShowTitleCheckbox:function getShowTitleCheckbox(){var host=this.getHost();return this.getCheckboxAndLabel(host.parent.getTitleBarVisibility(),mstrmojo.desc(13599,"Show titlebar"),function(newValue){host.parent.toggleTitleBar(!!newValue);});},getTextAlign:function getTextAlign(selectedValue,fnChange,conversionMap){var txtAlign=new mstrmojo.vi.ui.TextAlignButtonBar(!conversionMap?null:{itemsValueMap:conversionMap});txtAlign.singleSelect(mstrmojo.array.find(txtAlign.items,"id",selectedValue));txtAlign.onValueChange=fnChange;return txtAlign;},getWrapText:function getWrapText(isWrapped,fnChange){return this.getCheckboxAndLabel(isWrapped,mstrmojo.desc(13577,"Wrap text"),fnChange);},getTextDirection:function getTextDirection(selectedValue,fnChange){var selectedIndex=0;if(selectedValue){selectedIndex=selectedValue===3?1:2;}return this.getLabelAndControl(mstrmojo.desc(11914,"Direction:"),this.getPulldown([{n:mstrmojo.desc(2066,"Horizontal"),v:0},{n:mstrmojo.desc(5155,"90 degrees"),v:90},{n:mstrmojo.desc(5156,"-90 degrees"),v:-90}],fnChange,selectedIndex));},getOverflow:function getOverflow(isScroll,fnChange){return this.getLabelAndControl(mstrmojo.desc(11915,"Overflow:"),this.getPulldown([{n:mstrmojo.desc(2974,"Clip"),v:false},{n:mstrmojo.desc(2976,"Scroll"),v:true}],fnChange,isScroll?1:0));},getChangeFormatPropertyFn:function getChangeFormatPropertyFn(propertyName,formatType){var id=this.id;return function(newValue,oldValue){var editor=mstrmojo.all[id];editor.docModel.changeUnitFormatProperty(editor.getHost().parent,[{formatType:formatType||1,propertyName:propertyName,newValue:newValue,oldValue:oldValue}]);};},getChangeGroupPropertyFn:function getChangeGroupPropertyFn(formatType){var id=this.id;return function(propertyName,newValue,oldValue){(mstrmojo.all[id].getChangeFormatPropertyFn(propertyName,formatType))(newValue,oldValue);};},getCharacterGroup:function getCharacterGroup(fnChange,formats,ctrlFlags){var groupProps={onGroupValueChange:fnChange};if(ctrlFlags){groupProps.visibleControls=ctrlFlags;}var characterGroup=new mstrmojo.ui.editors.controls.CharacterGroup(groupProps);characterGroup.setFormatSource(formats);return characterGroup;},getContainerGroup:function getContainerGroup(formats,fnChange,ctrlFlags,props){var containerGroup=new mstrmojo.ui.editors.controls.ContainerGroup($HASH.copy(props,{onGroupValueChange:fnChange||this.getChangeGroupPropertyFn(),visibleControls:ctrlFlags||($CONTAINER_FLAGS.FILL_COLOR+$CONTAINER_FLAGS.BORDER)}));containerGroup.setFormatSource(formats);return containerGroup;},getMoreOptionsEditorLink:function getMoreOptionsEditorLink(data,showHeadersSection,lockHeadersCase){return new mstrmojo.Label({text:mstrmojo.desc(9126,"More options"),cssClass:"edt-link",onclick:function(){this.openMoreOptionsEditor(data,showHeadersSection,lockHeadersCase);}.bind(this)});},openMoreOptionsEditor:function openMoreOptionsEditor(data,showHeadersSection,lockHeadersCase){var host=this.getHost();var editor=mstrmojo.all[MORE_OPTIONS_EDITOR_ID]||new mstrmojo.vi.ui.editors.MoreOptionsEditor({id:MORE_OPTIONS_EDITOR_ID,submitAction:function submitAction(newData,extraActions,callback,extras){var host=this.host,ctrl=host.controller,actions=[];if(!$HASH.isEmpty(newData)){callback=mstrmojo.func.wrapMethods(ctrl._getXtabCallback(host),callback);actions=[ctrl.dataService().getUpdateTemplateAction(host.k,[host.model.getAdvancedPropertiesAction(newData)])];}actions=actions.concat(extraActions||[]);if(!$HASH.isEmpty(actions)){ctrl.submitUndoRedoUpdates(actions,null,callback,extras);}}});editor.set("data",data);editor.set("showHeadersSection",!!showHeadersSection);editor.set("lockHeadersCase",lockHeadersCase);editor.set("host",host);editor.open();},replaceChildControls:function replaceChildControls(controlGroup,controls){var currentChildren=[].concat(controlGroup.children||[]);controlGroup.removeChildren();currentChildren.forEach(function(ctrl){ctrl.destroy();});controlGroup.addChildren(controls);controlGroup.doLayout();}});}());