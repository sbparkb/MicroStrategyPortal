(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.SelectBox","mstrmojo._CanValidate","mstrmojo.MetricSelectorUtility");var $MU=mstrmojo.MetricSelectorUtility,$V=mstrmojo.validation,$E=mstrmojo.expr,$NM=mstrmojo.num,$OP=$MU.OP,allOprs=[{n:mstrmojo.desc(2795,"Equals"),v:$OP._EQUALS},{n:mstrmojo.desc(2796,"Does not equals"),v:$OP._NOT_EQUALS},{n:mstrmojo.desc(521,"Greater than"),v:$OP._GREATER},{n:mstrmojo.desc(522,"Greater than or equal to"),v:$OP._GREATER_EQUAL},{n:mstrmojo.desc(523,"Less than"),v:$OP._LESS},{n:mstrmojo.desc(524,"Less than or equal to"),v:$OP._LESS_EQUAL},{n:mstrmojo.desc(519,"Between (enter value1;value2)"),v:$OP._BETWEEN},{n:mstrmojo.desc(614,"Not between (enter value1;value2)"),v:$OP._NOT_BETWEEN},{n:mstrmojo.desc(898,"In (enter value1;value2; ...;valueN)"),v:$OP._IN},{n:mstrmojo.desc(2394,"Not In (enter value1;value2; ...;valueN)"),v:$OP._NOT_IN},{n:mstrmojo.desc(2202,"Is null"),v:$OP._IS_NULL},{n:mstrmojo.desc(2203,"Is not null"),v:$OP._IS_NOT_NULL}],oprs=allOprs.slice(0,10),cellCss="padding:2px 2px 2px 2px",oprsNull=allOprs.slice(10,12);var checkRange=function(v,r,isPercent,unary,category){var i;if(category===2){return r;}var vs=String(v).split(";"),invalid=$V.STATUSCODE.INVALID_VALIDATOR,valid=$V.STATUSCODE.VALID;if(unary&&vs&&vs.length>1){r.code=invalid;}else{for(i=0;i<vs.length;i++){var _v=parseFloat(vs[i],10);if(isNaN(_v)||(isPercent&&((vs[i].match(/^\d+(\.\d+)?%$/)===null&&vs[i].match(/^\d+(\.\d+)?$/)==null)||_v<0||_v>100))||(!isPercent&&vs[i].match(/\d+$/)===null)){r.code=invalid;}if(r.code!==valid){break;}}}if(r.code!==valid){r.msg=mstrmojo.desc(6103,"Please fix any invalid data");}return r;};var calcTxtWidth=function(fs){fs=parseFloat(fs);return isNaN(fs)?"54px":((fs*72/16)+"pt;");},txtFontChange=function(me){if(me.hasRendered){var s=me.domNode.style;s.font=me.font;s.width=calcTxtWidth(s.fontSize);}else{var m=me.font.match(/[^\s]*?pt/)||[];me.cssText=me.cssText+" font:"+me.font+"; width:"+calcTxtWidth(m[0]);}},isNumericDT=function(dt){if((dt>=8&&dt<=16)||(dt>=23&&dt<=25)){return false;}return true;};mstrmojo.MetricQualification=mstrmojo.declare(mstrmojo.Table,null,{scriptClass:"mstrmojo.MetricQualification",cssClass:"qs",cssText:"width:100%",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},getClientHeight:function getClientHeight(){return this.domNode.clientHeight+2;},rows:1,cols:4,layout:[{cells:[{cssText:"width:100%"},{cssText:"width:56px"},{cssText:"width:56px"},{cssText:"width:18px"}]}],init:function(props){if(this._super){this._super(props);}this._init();},_init:function(reset){var i;switch(this.qua){case 0:this.low=(this.da&&this.da.low)||0;this.high=(this.da&&this.da.high)||0;break;case 1:case 2:this.low=1;this.high=(this.da&&this.da.cnt)||0;break;case 3:case 4:this.low=0;this.high=100;break;}if(reset){this.cs=[];this.f=this.ft=null;}var op=$MU.getOpIdxByfunc(this.f,this.ft),def=isNumericDT(this.dt)?$OP._GREATER_EQUAL:$OP._IS_NULL;this.set("opId",(op==-1)?def:op);var in_cs=(this.cs&&this.cs.length>0)?$NM.toLocaleString(this.cs[0].v):"";if(this.opId===$OP._IN||this.opId===$OP._NOT_IN){for(i=1;i<this.cs.length;i++){in_cs+=";"+$NM.toLocaleString(String(this.cs[i].v));}}else{this.set("cs2",(this.cs&&this.cs.length>1)?$NM.toLocaleString(this.cs[1].v):"");}this.set("cs1",in_cs);this.vldTbL.validate();this.vldTbH.validate();this.changeQual=false;},updateData:function udtDt(da,props){this.da=da;this.updateExpr(props);},updateExpr:function udtEp(props){if(props){this.cs=props.cs;this.f=props.f;this.ft=props.ft;this.qua=props.qua;}this._init();},onquaChange:function onqChg(evt){this._init(true);this.func.items=(this.qua!==0)?oprs:isNumericDT(this.parent.dt)?allOprs:oprsNull;this.func.refresh();this.changeQual=true;this.onchange();},children:[{slot:"0,0",alias:"func",scriptClass:"mstrmojo.SelectBox",cssText:"width:100%",size:1,bindings:{sv:"this.parent.opId",font:"this.parent.font"},onfontChange:function(){if(this.hasRendered){this.domNode.style.font=this.font;}else{this.cssText="width:100%;font:"+this.font;}},onsvChange:function(){if(this.sv!==null&&this.sv!==undefined){this.set("selectedItem",{v:this.sv});}},postCreate:function(){if(mstrmojo.dom.isIE){this.itemDisplayField="n";this.showItemTooltip=true;}this.items=(this.parent.qua!==0)?oprs:isNumericDT(this.parent.dt)?allOprs:oprsNull;},onchange:function(){var p=this.parent,itm=this.selectedItem;if(itm&&itm.v!==null&&itm.v!==undefined){var newInclude=$MU.getIncludeByOp(itm.v);p.include=newInclude;if(p.parent&&newInclude!==p.parent.include){p.changeInclude=true;}else{p.changeInclude=false;}p.set("opId",itm.v);}if(mstrApp.isMobile&&(itm.v===$OP._IS_NULL||itm.v===$OP._IS_NOT_NULL)){if(p.onchange){p.onchange();}}}},{slot:"0,1",alias:"vldTbL",scriptClass:"mstrmojo.ValidationTextBox",required:true,dtp:$E.DTP.VARCHAR,constraints:{trigger:$V.TRIGGER.ALL,validator:function(v){var r={id:this.id,code:$V.STATUSCODE.VALID,msg:""},p=this.parent;checkRange(v,r,(p.qua===3||p.qua===4),(p.opId!==8&&p.opId!==9),(p.numFmts&&p.numFmts.cat));return r;}},bindings:{visible:"this.parent.opId!=10&&this.parent.opId!=11",value:"this.parent.cs1",font:"this.parent.font"},onfontChange:function(){txtFontChange(this);},onValid:function(){var p=this.parent,box=this.domNode;p.set("cs1",this.value);if(box&&box.value.length>6){box.title=box.value;}else{if(box){box.title="";}}},onvisibleChange:function(){if(!this.visible){this.parent.set("cs1","");}},onkeyup:function(evt){var hWin=evt.hWin,e=evt.e||hWin.event,p=this.parent,box=evt.src.domNode;if(e.keyCode===13&&p.apply&&p.apply.enabled){p.apply.onclick();}}},{slot:"0,2",alias:"vldTbH",scriptClass:"mstrmojo.ValidationTextBox",required:true,dtp:$E.DTP.VARCHAR,constraints:{trigger:$V.TRIGGER.ALL,validator:function(v){var r={id:this.id,code:$V.STATUSCODE.VALID,msg:""},p=this.parent;checkRange(v,r,(p.qua===3||p.qua===4),(p.opId!==8&&p.opId!==9),(p.numFmts&&p.numFmts.cat));return r;}},bindings:{visible:"this.parent.opId ==7 ||this.parent.opId ==6",value:"this.parent.cs2",font:"this.parent.font"},onfontChange:function(){txtFontChange(this);},onValid:function(){this.parent.set("cs2",this.value);var box=this.domNode;if(box&&box.value.length>6){box.title=box.value;}else{if(box){box.title="";}}},onvisibleChange:function(){if(!this.visible){this.parent.set("cs2","");}},onkeyup:function(evt){var hWin=evt.hWin,e=evt.e||hWin.event,p=this.parent;if(e.keyCode===13&&p.apply&&p.apply.enabled){p.apply.onclick();}}},{slot:"0,3",alias:"apply",title:mstrmojo.desc(2164,"Apply"),scriptClass:"mstrmojo.Button",cssClass:"icn apply",bindings:{enabled:"(!this.parent.vldTbL.visible ||!this.parent.vldTbL.validationStatus.code)&& (!this.parent.vldTbH.visible||!this.parent.vldTbH.validationStatus.code)"},onclick:function(){var p=this.parent,isPercent=(p.qua===$MU.Q._PT||p.qua===$MU.Q._PB),i;p.cs=[];var toPrcnt=function(v){return v+((isPercent&&!String(v).match(/^\d+%$/))?"%":"");};var type=function(cat,qua){return((cat===2||cat===3)&&qua===0)?14:5;};if(p.opId===$OP._IN||p.opId===$OP._NOT_IN){var _cs=String(p.cs1).split(";");for(i=0;i<_cs.length;i++){if(!mstrmojo.string.isEmpty(_cs[i])){p.cs.push({dtp:5,v:toPrcnt(_cs[i])});}}}else{if(p.vldTbL.visible){p.cs.push({dtp:type((p.numFmts&&p.numFmts.cat),p.qua),v:toPrcnt(p.cs1)});}if(p.vldTbH.visible){p.cs.push({dtp:type((p.numFmts&&p.numFmts.cat),p.qua),v:toPrcnt(p.cs2)});}}if(p.onchange){p.onchange();}if(p.makeSelection){p.makeSelection();}}}]});}());