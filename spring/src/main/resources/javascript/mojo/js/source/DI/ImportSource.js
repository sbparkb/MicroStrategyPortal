(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.string");mstrmojo.requiresDescs(10,489,1279,1910,3687,7755,10171,10174,12448,12450,12539,12541,13978,14217,14218,14219,14220,14221,14222,14223,14224,14225,14226,14227,14228,14229);var constants=mstrmojo.DI.DIConstants,$ARR=mstrmojo.array,$HASH=mstrmojo.hash,helpers=mstrmojo.DI.DIHelpers,SAPHANA_DBTYPE=4000;var ENUM_STATE={NT:1,RT:2,PT:3};var dataTypeToBaseFormType={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2};var columnDataTypeMap={1:constants.columnDataTypes.integer,2:constants.columnDataTypes.integer,3:constants.columnDataTypes.dtdouble,6:constants.columnDataTypes.dtdouble,7:constants.columnDataTypes.dtfloat,21:constants.columnDataTypes.integer,22:constants.columnDataTypes.nlong,30:constants.columnDataTypes.bigDecimal,34:constants.columnDataTypes.int64};function isColumnSelected(ups,type){var ret=false;if(type==="amps"||type==="mtmps"){ret=(ups&constants.columnState.missing)!==constants.columnState.missing;return ret;}if(type==="cmps"){ret=false;return ret;}return ret;}function createMappingColumn(InputColumn,oi,type,tableId,tableName,isMultiForm,attrForm){var newCol=constants.columnState.newColumn,aimp=InputColumn.aimp,ups=oi.def?oi.def.dicl.ups:oi.sqc.ups,isSelect=isColumnSelected(ups,type),column,alias,id=null,ipa,columnDetail,columnName,columnIndex,dtp,ctp;if(oi.sqc){columnName=oi.cln;columnDetail=oi.sqc;alias=columnDetail.als;dtp=dataTypeToBaseFormType[columnDetail.dt.tp];ctp=columnDataTypeMap[columnDetail.dt.tp];columnIndex=columnDetail.ix+1;}else{columnName=oi.def.cln;alias=oi.n;dtp=attrForm?attrForm.bft:dataTypeToBaseFormType[oi.def.dt.tp];columnDetail=oi.def.dicl;columnIndex=columnDetail.clix;ctp=columnDataTypeMap[oi.def.dt.tp];}var isNew=ups===newCol;column={did:oi.did||oi.sqc.id,n:mstrmojo.string.decodeHtmlString(columnName),originalAlias:mstrmojo.string.decodeHtmlString(alias),alias:mstrmojo.string.decodeHtmlString(alias),isNew:isNew,columnState:ups,selected:isSelect,dtp:dtp,ctp:ctp,ix:columnIndex,tp:isSelect?columnDetail.idot:0,idot:columnDetail.idot,toDel:(ups===constants.columnState.missing),der:columnDetail.der,hasMapped:true,isDI:true,type:type};switch(type){case"amps":alias=aimp.atnm;id=aimp.atid;ipa=aimp.ipa;if(ipa){column.ipa=ipa;}if(alias&&!isMultiForm){column.alias=alias;}column.isMultiForm=isMultiForm;break;case"mtmps":id=InputColumn.mtid;alias=InputColumn.mtn;if(alias){column.alias=alias;}break;case"cmps":break;}if(id){column.id=id;}if(tableId){column.tableId=tableId;}if(tableName){column.tableName=tableName;}if(attrForm){column.afid=aimp.atid+attrForm.fmid;column.fmn=attrForm.fmn;column.fmid=attrForm.fmid;column.oid=aimp.atid;column.shapeKey=attrForm.sha;column.timerole=attrForm.tim;}return column;}function extractColumns(maps,columns,type,data,tableIDParm){var column,oi,aflen,subColumn,tableId=data.datap.tbid||tableIDParm,tableName=data.datap.tbn,isMultiForm,aimp,afmps,georole;$ARR.forEach(maps,function(col){aimp=col.aimp;afmps=col.afmps;switch(type){case"amps":aflen=afmps.length;isMultiForm=aflen>1;$ARR.forEach(afmps,function(afmp,i){georole=0;oi=afmp.sqc?afmp:afmp.col.oi;subColumn=createMappingColumn(col,oi,type,tableId,tableName,isMultiForm,afmp);subColumn.georole=afmp.geo;if(subColumn.georole){georole=1;}subColumn.timerole=afmp.tim;subColumn.ipa=aimp.ipa;if(aflen===1){columns.push(subColumn);}else{if(i===0){column={id:aimp.atid,tableId:tableId,n:aimp.atnm,alias:aimp.atnm,isMultiForm:true,ix:subColumn.ix,oid:aimp.atid,selected:false,tp:12,subColumns:[],type:type,ipa:aimp.ipa};columns.push(column);subColumn.isIdForm=true;}if(georole){column.georole=georole;}subColumn.isAttributeForm=true;column.subColumns.push(subColumn);if(subColumn.selected){column.selected=true;}}});break;case"mtmps":case"cmps":oi=col.sqc?col:(col.col?col.col.oi:col.oi);column=createMappingColumn(col,oi,type,tableId,null,null,null);columns.push(column);break;}});}function populateRSTree(parent,data){var rs=[];var i,item,child,rsItem;if(!parent||!data||data.length<=0){return rs;}for(i=0;i<data.length;i++){item=data[i];child={id:item.atid,n:item.n};rsItem={parent:parent,child:child,ert:item.ert};if(item.hasOwnProperty("status")){rsItem.status=item.status;}if(item.hasOwnProperty("relationship_type")){rsItem.type=item.relationship_type;}rs.push(rsItem);rs=rs.concat(populateRSTree(child,item.children));}return rs;}function compareColumn(a,b){return a.ix-b.ix;}function sortColumns(columns){var subColumns,newColumns=[];columns.sort(compareColumn);$ARR.forEach(columns,function(column){subColumns=column.subColumns;if(subColumns&&subColumns.length>1){subColumns.sort(compareColumn);$ARR.forEach(subColumns,function(subCol){newColumns.push(subCol);});column.dataIdx=-1;}else{newColumns.push(column);}});newColumns.sort(compareColumn);$ARR.forEach(newColumns,function(column,i){column.dataIdx=i;});}mstrmojo.DI.ImportSource=mstrmojo.declare(mstrmojo.Obj,null,{formCategory:null,type:-1,subtype:-1,key:"",currentIndex:-1,previews:{},mappings:{},originalMappings:{},sourceInfo:null,sheets:null,transformations:{},currentTransformations:null,currentPreview:null,currentMapping:null,transformedMapping:null,origTransformMapping:null,transformedPreview:null,tableID:null,relationships:{},relationship:null,state:0,lastRefreshedTime:null,nrows:0,binaryExists:false,executeAction:0,refreshType:0,cannotFetchPreview:false,tablePosition:null,hasRefreshedData:false,tableState:null,forceRepublish:false,schemaChanged:false,postCreate:function(){this.relationships={};this.previews={};this.mappings={};this.originalMappings={};this.transformations={};var model=mstrApp.getRootController().model;if(model.operationMode===constants.operationMode.create){this.executeAction=1;}},reset:function(){this.currentIndex=-1;this.previews={};this.mappings={};this.originalMappings={};this.sourceInfo=null;this.transformations={};this.sheets=null;this.currentPreview=null;this.currentTransformations=null;this.currentMapping=null;},canAutoMappingAndDetectRelation:function(){var operationMode=mstrApp.getRootController().model.operationMode;var r=this.hasRefreshedData;if(this.xdaType===constants.xdaType.qbSingleTable&&this.databaseType===SAPHANA_DBTYPE){return false;}return r||operationMode===constants.operationMode.create;},canLaunchWrangler:function(){var ret=this.canAutoMappingAndDetectRelation();if(mstrApp.isSingleTier&&this.projectID){ret=true;}return ret;},initialize:function(type,subtype,key,table_id){this.type=type;this.subtype=subtype;this.key=key;this.tableID=table_id;},populate:function(data,requestFlags,tableID){var serviceFlags=requestFlags;if(this.sourceInfo.sheetIndex>=0){this.currentIndex=this.sourceInfo.sheetIndex;}else{this.currentIndex=-1;}if((serviceFlags&constants.requestFlag.transformations)===constants.requestFlag.transformations){if(!data.datap.trnsfs){serviceFlags=serviceFlags&(~constants.requestFlag.transformations);}else{this.populateTransformations(data.datap.trnsfs,this.currentIndex,data.datap.data.chrn);this.currentTransformations=this.transformations[this.currentIndex];}}if((serviceFlags&constants.requestFlag.mapping)===constants.requestFlag.mapping){if(!data.datap.maps){serviceFlags=serviceFlags&(~constants.requestFlag.mapping);}else{var columns=this.populateMappings(data,tableID);if(columns.length>0){if((requestFlags&constants.requestFlag.transformedPreview)===constants.requestFlag.transformedPreview||((this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab)===true)){this.transformedMapping=columns;this.origTransformMapping=mstrmojo.hash.clone(columns);}else{this.mappings[this.currentIndex]=columns;this.currentMapping=columns;this.originalMappings[this.currentIndex]=mstrmojo.hash.clone(columns);}this.formCategory=data.forms;}}}if((serviceFlags&constants.requestFlag.preview)===constants.requestFlag.preview){if(!data.datap.data||!data.datap.data.dcs||data.datap.data.dcs.length===0){serviceFlags=serviceFlags&(~constants.requestFlag.preview);this.cannotFetchPreview=true;}else{this.previews[this.currentIndex]=this.populatePreview(data.datap.data.dcs,this.previews[this.currentIndex]);this.currentPreview=this.previews[this.currentIndex];if(data.datap.data.timestamp!==undefined){this.set("lastRefreshedTime",data.datap.data.timestamp);}if(data.datap.data.nrows){this.nrows=data.datap.data.nrows;}}}if((serviceFlags&constants.requestFlag.transformedPreview)===constants.requestFlag.transformedPreview){if(!data.datap.data||!data.datap.data.dcs||data.datap.data.dcs.length===0){serviceFlags=serviceFlags&(~constants.requestFlag.transformedPreview);this.cannotFetchPreview=true;}else{this.transformedPreview=this.populatePreview(data.datap.data.dcs,this.transformedPreview);if(data.datap.data.timestamp!==undefined){this.set("lastRefreshedTime",data.datap.data.timestamp);}if(data.datap.data.nrows){this.nrows=data.datap.data.nrows;}}}if((serviceFlags&constants.requestFlag.relationship)===constants.requestFlag.relationship){if(!data.datap.relationship){serviceFlags=serviceFlags&(~constants.requestFlag.relationship);}else{this.relationships[this.currentIndex]=this.populateRelationships(data.datap.relationship);this.relationship=this.relationships[this.currentIndex];}}return serviceFlags;},invalidPreview:function(){this.currentPreview=null;this.transformedPreview=null;this.cannotFetchPreview=false;this.previews=[];},getCurrentMappings:function(fnFilter){var maps;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){maps=this.transformedMapping;}else{maps=this.currentMapping;}if(typeof fnFilter==="function"){maps=mstrmojo.array.filter(maps,fnFilter);}return maps;},getMappingChanges:function(){var currentMapping=this.currentMapping;var originalMapping=this.originalMappings[this.currentIndex];var i,j,mpcs=[],attrmpc,mpc,current,original;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){currentMapping=this.transformedMapping||this.currentMapping;originalMapping=this.origTransformMapping||this.originalMappings[this.currentIndex];}if(!currentMapping||!originalMapping){return mpcs;}for(i=0;i<currentMapping.length;i++){current=currentMapping[i];original=originalMapping[i];if(current.isMultiForm){attrmpc=this.findChanges(current,original);if(attrmpc){j=$ARR.find(current.subColumns,"isIdForm",true);if(j>0){attrmpc.did=current.subColumns[j].did;}else{attrmpc.did=current.subColumns[0].did;}mpcs.push(attrmpc);}current=current.subColumns;original=original.subColumns;for(j=0;j<current.length;j++){mpc=this.findChanges(current[j],original[j]);if(mpc){if(attrmpc&&mpc.did===attrmpc.did){$HASH.copy(mpc,attrmpc);}else{mpcs.push(mpc);}}}}else{mpc=this.findChanges(current,original);if(mpc){mpcs.push(mpc);}}}return mpcs;},findChanges:function findChanges(current,original){var mpc,changed;mpc={did:current.did,n:current.n};mpc.n=mstrmojo.string.encodeXMLAttribute(current.n);changed=false;if(current.selected!==original.selected){mpc.cmf=(current.selected?1:0);mpc.ot=current.tp;changed=true;}if(!current.ipa){if(original.ipa){changed=true;mpc.alias=mstrmojo.string.encodeXMLAttribute(current.alias);mpc.oid="";mpc.frmid="";}else{if(current.oid!==original.oid){changed=true;mpc.oid=current.oid;mpc.alias=current.alias;}if(current.tp===12){var fmidChanged=false;if(original.tp!==12){if(current.fmid!==""){fmidChanged=true;}}else{if(current.fmid!==original.fmid){fmidChanged=true;}}if(fmidChanged){changed=true;mpc.frmid=current.fmid;}}if(current.alias!==original.alias){mpc.alias=mstrmojo.string.encodeXMLAttribute(current.alias);changed=true;}}}else{if(original.tp===4){changed=true;}else{if(!original.selected){changed=true;}else{if(original.fmid!==current.fmid||original.oid!==current.oid){changed=true;}}}if(changed===true){mpc.oid=current.oid;mpc.frmid=current.fmid;}}if(current.alias!==original.alias){mpc.alias=mstrmojo.string.encodeXMLAttribute(current.alias);if(current.ipa===0){if(current.linkObjID!==null||current.linkObjID!==undefined){mpc.oid=current.linkObjID;}if(current.formID!==null||current.formID!==undefined){mpc.frmid=current.formID;}if(current.lv){mpc.lv=current.lv;}else{mpc.lv=0;}}changed=true;}if(current.tp!==original.tp){mpc.ot=current.tp;changed=true;}if(current.dtp!==original.dtp||current.ctp!==original.ctp){mpc.bft=current.dtp;if(current.ctp!==original.ctp){mpc.dt=current.ctp;}changed=true;}if(!current.ipa){if(current.tp===12){if(original.tp===12){if(original.georole!==current.georole){changed=true;mpc.georole=current.georole;}else{if(original.timerole!==current.timerole){changed=true;mpc.timerole=current.timerole;}}}else{changed=true;mpc.georole=current.georole;}}if(current.tp===12){if(original.tp===12){if(original.der!==current.der||original.dtp!==current.dtp){changed=true;mpc.drvflg=current.der;}}else{changed=true;mpc.drvflg=current.der;}}if(current.tp===12){if(original.tp===12){if(original.shapeKey!==current.shapeKey){changed=true;mpc.shapekey=current.shapeKey;}}else{changed=true;mpc.shapekey=current.shapeKey;}}}if(changed){return mstrmojo.hash.copy(mpc);}return"";},isOriginColumnImported:function isOriginColumnImported(){var mappings=this.currentMapping;var column,i;if(mappings){for(i=0;i<mappings.length;i++){column=mappings[i];if((column.columnState&constants.columnState.unchanged)===constants.columnState.unchanged){return true;}}}return false;},getMissingColumns:function getMissingColumns(){var mappings=this.currentMapping;var missingColumns=[];var column,form,i,j;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){mappings=this.transformedMapping;}if(mappings){for(i=0;i<mappings.length;i++){column=mappings[i];if(column.isMultiForm){for(j=0;column.subColumns&&j<column.subColumns.length;j++){form=column.subColumns[j];if((form.columnState&constants.columnState.missing)===constants.columnState.missing&&(form.type==="amps"||form.type==="mtmps")){missingColumns.push(column);}}}else{if((column.columnState&constants.columnState.missing)===constants.columnState.missing&&(column.type==="amps"||column.type==="mtmps")){missingColumns.push(column);}}}}return missingColumns;},areAllColumnsMissing:function areAllColumnsMissing(){var mappings=this.getCurrentMappings(function(map){return !map.isNew;});var missingColumns=this.getMissingColumns(),allMissing=false,columnCnt=0,column,i;for(i=0;i<mappings.length;i++){column=mappings[i];if(column.isMultiForm){columnCnt+=column.subColumns.length;}else{columnCnt++;}}if(columnCnt===missingColumns.length){allMissing=true;}return allMissing;},populatePreview:function(data,preview){if(!data.length){return null;}var nCols=data.length;var nRows=data[0].dvs.length;var previewData=[];var columnHeaders=[];var dcns=[];var i,j;for(i=0;i<nCols;i++){columnHeaders.push(data[i].dcns.cln);dcns.push(data[i].dcns);}for(j=0;j<nRows;j++){previewData[j]=[];for(i=0;i<nCols;i++){previewData[j].push(data[i].dvs[j]);}}for(j=nRows;j<49;j++){previewData[j]=[];for(i=0;i<nCols;i++){previewData[j].push("");}}if(!preview){preview=new mstrmojo.Obj();this.addDisposable(preview);}preview.set("chs",columnHeaders);preview.set("dcns",dcns);preview.set("data",previewData);preview.set("numOfRows",nRows+1);preview.set("ignoredRows",0);return preview;},populateMappings:function(data,tableID){if(this.type===constants.sourceType.googleBigQuery){if(this.xdaType===constants.xdaType.googleBigQuery){return this.populateQBMappings(data,tableID);}}if(this.type===constants.sourceType.querybuilder&&this.xdaType===constants.xdaType.querybuilder){return this.populateQBMappings(data,tableID);}var columns=[];var maps=data.datap.maps;extractColumns(maps.amps,columns,"amps",data,tableID);extractColumns(maps.mtmps,columns,"mtmps",data,tableID);extractColumns(maps.cmps,columns,"cmps",data,tableID);sortColumns(columns);return columns;},populateQBMappings:function populateMappings(data,tableIDParam){var columns=[],maps=data.datap.maps,attrs=maps.amps,metrs=maps.mtmps,i,len,aimp,afmps,aflen,sqc,subColumn,column,metr,alias,georole;var tableId=data.datap.tbid||tableIDParam;$ARR.forEach(attrs,function(attr){aimp=attr.aimp;afmps=attr.afmps;aflen=afmps.length;$ARR.forEach(afmps,function(afmp,i){georole=0;sqc=afmp.sqc;subColumn={id:aimp.atid,ipa:aimp.ipa,oid:aimp.atid,fmn:afmp.fmn,fmid:afmp.fmid,did:sqc.id,afid:aimp.atid+afmp.fmid,n:afmp.cln,alias:afmp.cln,isNew:(sqc.ups===constants.columnState.newColumn),columnState:sqc.ups,selected:(sqc.se===1),dtp:afmp.bft,ctp:columnDataTypeMap[sqc.dt.tp],ix:sqc.ix+1,tp:12,toDel:(sqc.ups&4)?true:false,georole:sqc.geo,der:sqc.der,hasMapped:true,isDI:true,type:"amps",tableId:tableId};if(subColumn.georole){georole=1;}if(aflen===1){alias=aimp.atnm;if(alias){subColumn.alias=alias;subColumn.isMultiForm=false;}columns.push(subColumn);}else{if(i===0){column={id:aimp.atid,tableId:tableId,did:aimp.atid,n:aimp.atnm,alias:aimp.atnm,ix:sqc.ix+1,tp:12,selected:false,isMultiForm:(aflen>1),oid:aimp.atid,subColumns:[],type:"amps",ipa:aimp.ipa};columns.push(column);subColumn.isIdForm=true;}if(georole){column.georole=georole;}subColumn.isAttributeForm=true;column.subColumns.push(subColumn);if(subColumn.selected){column.selected=true;}}});});for(i=0,len=metrs.length;i<len;i++){metr=metrs[i];sqc=metr.sqc;columns.push({id:metr.mtid,tableId:tableId,did:sqc.id,alias:metr.mtn,n:metr.cln,selected:(sqc.se===1),hasMapped:true,isDI:true,dtp:dataTypeToBaseFormType[sqc.dt.tp],ctp:columnDataTypeMap[sqc.dt.tp],ix:sqc.ix+1,tp:4,georole:sqc.geo,der:sqc.der,toDel:(sqc.ups&4)?true:false,type:"mtmps"});}mstrmojo.hash.forEach(maps.cmps,function(item){sqc=item.sqc;columns.push({did:sqc.id,alias:sqc.exp.exp,n:sqc.exp.exp,selected:false,hasMapped:false,isDI:true,dtp:dataTypeToBaseFormType[sqc.dt.tp],ctp:columnDataTypeMap[sqc.dt.tp],ix:sqc.ix+1,tp:0,type:"cmps"});});sortColumns(columns);return columns;},populateSheets:function(data,defaultIndex){var i;var shts=[];var firstSheet=-1;var selected;if(this.currentIndex&&this.currentIndex!==-1){defaultIndex=this.currentIndex;}if(data){for(i=0;i<data.length;i++){if(data[i]!=="*"){if(firstSheet===-1){firstSheet=i;}if(defaultIndex){selected=(i===defaultIndex);}else{selected=(i===firstSheet);}shts.push({index:i,name:data[i],selected:selected,isAutoMapped:false});}}if(shts.length>0&&$ARR.find(shts,"selected",true)<0){shts[0].selected=true;}this.set("sheetsInfo",shts);}},populateTransformations:function(data,sheetIndex,emptyRows){var transfs=this.transformations[sheetIndex],i;if(!transfs){transfs=new mstrmojo.Obj();this.addDisposable(transfs);}var xtab;function getXtabXML(){var xml='<trnsfs count="1" >';if(this.isCrosstab){xml+='<trnsf trnsftype="'+constants.transformation.xtab+'">';if(this.mhb.startColumn===-1&&this.mhb.startRow===-1){xml+='<mhdrs srow="-1" scol="-1" erow="-1" ecol="-1" />';}else{xml+='<mhdrs srow="'+(this.mhb.startRow+emptyRows)+'" scol="'+this.mhb.startColumn+'" erow="'+(this.mhb.endRow+emptyRows)+'" ecol="'+this.mhb.endColumn+'" />';}xml+='<dtrng srow="'+(this.db.startRow+emptyRows)+'" scol="'+this.db.startColumn+'" erow="'+(this.db.endRow+emptyRows)+'" ecol="'+this.db.endColumn+'" />';xml+="</trnsf>";}else{xml+='<trnsf trnsftype="'+constants.transformation.xtab+'" fg="1" />';}xml+="</trnsfs>";return xml;}for(i=0;i<data.length;i++){var trans=data[i];if(trans.tp===constants.transformation.xtab){xtab=new mstrmojo.Obj({isCrosstab:(trans.fg!==1),mhb:new mstrmojo.Obj({startRow:(trans.clrngs[0].srow===-1)?-1:(trans.clrngs[0].srow-emptyRows),startColumn:trans.clrngs[0].scol,endRow:(trans.clrngs[0].erow===-1)?-1:(trans.clrngs[0].erow-emptyRows),endColumn:trans.clrngs[0].ecol}),db:new mstrmojo.Obj({startRow:(trans.clrngs[1].srow===-1)?-1:(trans.clrngs[1].srow-emptyRows),startColumn:trans.clrngs[1].scol,endRow:(trans.clrngs[1].erow===-1)?-1:(trans.clrngs[1].erow-emptyRows),endColumn:trans.clrngs[1].ecol}),getXML:getXtabXML});}}transfs.set("xtab",xtab);if(xtab){transfs.addDisposable(xtab);if(xtab.mhb){xtab.addDisposable(xtab.mhb);}if(xtab.db){xtab.addDisposable(xtab.db);}}this.transformations[sheetIndex]=transfs;},populateRelationships:function populateRelationships(data){var relationship=[];var i,j,item,parent,found;var rss=[];if(data){for(i=0;i<data.length;i++){item=data[i];parent={id:item.atid||item.paid,n:item.n};relationship=relationship.concat(populateRSTree(parent,item.children));}}for(i=0;i<relationship.length;i++){item=relationship[i];found=false;for(j=0;j<rss.length;j++){if(rss[j].parent.id===item.parent.id&&rss[j].child.id===item.child.id){found=true;break;}}if(!found){rss.push(item);}}return rss;},getSourceObjectType:function getSourceObjectType(){var type=mstrmojo.desc(489,"File"),xdaTypeEnum=constants.xdaType;switch(this.type){case constants.sourceType.file:type=mstrmojo.desc(489,"File");break;case constants.sourceType.googleDrive:type=mstrmojo.desc(489,"File");break;case constants.sourceType.dropbox:type=mstrmojo.desc(489,"File");break;case constants.sourceType.salesforce:type=mstrmojo.desc(1279,"Report");break;case constants.sourceType.googleAnalytics:type=mstrmojo.desc(1279,"Report");break;case constants.sourceType.googleBigQuery:type=mstrmojo.desc(14217,"Query");break;case constants.sourceType.querybuilder:if(this.xdaType===xdaTypeEnum.qbSingleTable){type=mstrmojo.desc(7755,"Table");}if(this.xdaType===xdaTypeEnum.querybuilder){type=mstrmojo.desc(14218,"Builder");}if(this.xdaType===xdaTypeEnum.ffsql){type=mstrmojo.desc(1910,"Data");}break;case constants.sourceType.bisource:type=mstrmojo.desc(1910,"Data");break;case constants.sourceType.facebook:type=mstrmojo.desc(3687,"Page");break;case constants.sourceType.twitter:type=mstrmojo.desc(10,"Search");break;}return type;},getDataSource:function getDataSource(){var v="",xdaTypeEnum=constants.xdaType,sourceTypeEnum=constants.sourceType;switch(this.type){case sourceTypeEnum.file:v=mstrmojo.desc(489,"File");switch(this.subtype){case constants.sourceSubtype.localFile:if(this.xdaType===xdaTypeEnum.excel){v=mstrmojo.desc(14219,"Excel Data");}if(this.xdaType===xdaTypeEnum.text){v=mstrmojo.desc(14220,"Text Data");}break;case constants.sourceSubtype.url:if(this.xdaType===xdaTypeEnum.excel){v=mstrmojo.desc(14221,"URL Excel Data");}if(this.xdaType===xdaTypeEnum.text){v=mstrmojo.desc(14222,"URL Text Data");}break;case constants.sourceSubtype.samplefile:v=mstrmojo.desc(12539,"Sample File");break;case constants.sourceSubtype.publicData:v=mstrmojo.desc(13978,"Public Data");break;case constants.sourceSubtype.clipboard:v=mstrmojo.desc(12541,"Custom Data");break;}break;case sourceTypeEnum.googleDrive:v=mstrmojo.desc(14223,"Google Drive File");break;case sourceTypeEnum.dropbox:v=mstrmojo.desc(14224,"Dropbox File");break;case sourceTypeEnum.salesforce:v=mstrmojo.desc(14225,"Salesforce Report");break;case sourceTypeEnum.googleAnalytics:v=mstrmojo.desc(12448,"Google Analytics");break;case sourceTypeEnum.googleBigQuery:v=mstrmojo.desc(12450,"Google Big Query");break;case sourceTypeEnum.querybuilder:if(this.xdaType===xdaTypeEnum.qbSingleTable){v=mstrmojo.desc(14226,"Individual Table");}if(this.xdaType===xdaTypeEnum.querybuilder){v=mstrmojo.desc(14227,"Query Builder");}if(this.xdaType===xdaTypeEnum.ffsql){v=mstrmojo.desc(14228,"Freeform SQL Data");}break;case sourceTypeEnum.bisource:v=mstrmojo.desc(14229,"BI Data");break;case sourceTypeEnum.facebook:v=mstrmojo.desc(10171,"Facebook");break;case sourceTypeEnum.twitter:v=mstrmojo.desc(10174,"Twitter");break;}return v;},canSubscribe:function(){var v=false;var xdaTypeEnum=constants.xdaType;switch(this.xdaType){case xdaTypeEnum.excel:case xdaTypeEnum.text:if(this.sourceInfo&&this.sourceInfo.url!==""){v=true;}break;case xdaTypeEnum.qbSingleTable:case xdaTypeEnum.querybuilder:case xdaTypeEnum.ffsql:v=true;break;case xdaTypeEnum.dataImportOAuthDropbox:case xdaTypeEnum.dataImportOAuthSalesforce:case xdaTypeEnum.dataImportOAuthGDrive:case xdaTypeEnum.dataImportOAuthGAnalytics:case xdaTypeEnum.dataImportOAuthGBigQuery:case xdaTypeEnum.dataImportOAuthGBigQueryFFSQL:case xdaTypeEnum.dataImportOAuthGBigQuerySingleTable:case xdaTypeEnum.twitter:case xdaTypeEnum.facebook:v=true;break;}return v;},canSetAlternateSource:function canSetAlternateSource(){var v=false,xdaTypeEnum=constants.xdaType;switch(this.xdaType){case xdaTypeEnum.excel:case xdaTypeEnum.text:if(this.sourceInfo&&this.sourceInfo.url!==""){v=true;}break;case xdaTypeEnum.qbSingleTable:v=true;break;}if(this.type===constants.sourceType.hadoop){v=false;}return v;},canRefine:function canRefine(){var model=mstrApp.getRootController().getModel(),xdaTypeEnum=constants.xdaType,sourceTypeEnum=constants.sourceType,xdaType=this.xdaType,type=this.type,support;support=(!model.isDirectDataAccess&&(xdaType===xdaTypeEnum.ffsql||xdaType===xdaTypeEnum.qbSingleTable||xdaType===xdaTypeEnum.querybuilder))||type===sourceTypeEnum.file||type===sourceTypeEnum.googleDrive||type===sourceTypeEnum.dropbox||type===sourceTypeEnum.salesforce||type===sourceTypeEnum.twitter||type===sourceTypeEnum.facebook||type===sourceTypeEnum.googleAnalytics||(!model.isDirectDataAccess&&type===sourceTypeEnum.hadoop);return support;},findMappingItem:function findMappingItem(column){var map=null,maps;var j;var found=false;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){maps=this.transformedMapping;}else{maps=this.currentMapping;}for(j=0;maps&&j<maps.length;j++){map=maps[j];if(column.id){if(map.id&&map.id===column.id){found=true;break;}}else{if(column.oid){if(map.oid&&map.oid===column.oid){found=true;break;}}else{if(map.did===column.did){found=true;break;}else{if(column.type==="cmps"&&map.type==="cmps"&&column.alias===map.alias){found=true;break;}}}}}return found?map:null;},updateTablePosition:function(pos){this.tablePosition=mstrmojo.hash.copy(pos,this.tablePosition);},populatePosition:function(data){var pos={},ret=false;if(!this.tablePosition){$ARR.forEach(data,function(pair){switch(pair.pri){case 135856129:pos.y=pair.pdv;break;case 135856130:pos.x=pair.pdv;break;case 134742017:pos.w=pair.pdv;break;case 134742018:pos.h=pair.pdv;break;}});if(pos.hasOwnProperty("x")||pos.hasOwnProperty("y")||pos.hasOwnProperty("w")||pos.hasOwnProperty("h")){this.tablePosition=pos;ret=true;}}return ret;},isExtensionValid:function(fileName){var ret=true,str,origFileExt,curFileExt;if(this.sourceInfo&&this.sourceInfo.dbTableName!==undefined&&fileName!==undefined){str=this.sourceInfo.dbTableName.toString();origFileExt=helpers.getExtensionType(str.substr(str.lastIndexOf(".")));str=fileName.toString();curFileExt=helpers.getExtensionType(str.substr(str.lastIndexOf(".")));}return ret;},isRefined:function(){return !!this.sourceInfo.isRefined;},isParsed:function(){var srcInfo=this.sourceInfo,transformations=this.currentTransformations;if(transformations&&transformations.xtab&&transformations.xtab.isCrosstab){return true;}if(srcInfo&&srcInfo.hasNewHeaders){return true;}if(srcInfo&&srcInfo.skipRows>0){return true;}return false;}});mstrmojo.DI.ImportSource.ENUM_STATE=ENUM_STATE;}());