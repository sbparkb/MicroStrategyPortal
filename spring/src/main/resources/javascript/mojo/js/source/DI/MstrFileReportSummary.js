(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Box","mstrmojo.HBox","mstrmojo.WidgetList","mstrmojo.Label","mstrmojo.List");mstrmojo.requiresDescs(8973,11594,11595,11596,11597,11598,11599,11600,11601);function expand(node){var isDisplayed=(node.style.display==="none")?false:true;if(!isDisplayed){node.style.display="block";this.set("text",mstrmojo.desc(8973,"Collapse"));}else{node.style.display="none";this.set("text",mstrmojo.desc(11594,"Click for details"));}}mstrmojo.DI.FailedDashboardItem=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.FailedDashboardItem",cssClass:"mstr_fu_fail_items",dbName:"",errMsg:"",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstr_fu_err_msg_button_down",isUp:false,onclick:function(){this.isUp=!this.isUp;mstrmojo.css.toggleClass(this.domNode,"mstr_fu_err_msg_button_up",this.isUp);this.parent.errorLabel.set("visible",this.isUp);}},{scriptClass:"mstrmojo.Label",cssClass:"mstr_fu_dashboard_name_label",bindings:{text:"this.parent.dbName"}},{scriptClass:"mstrmojo.Label",cssClass:"mstr_fu_error_message",alias:"errorLabel",visible:false,bindings:{text:"this.parent.errMsg"}}]});mstrmojo.DI.MstrFileReportSummary=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.MstrFileReportSummary",successItems:[],failItems:[],children:[{scriptClass:"mstrmojo.HBox",alias:"summaryEditorHBox",cssClass:"",bindings:{visible:function(){return this.parent.failItems.length>0;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstr_fu_fail_label",bindings:{text:function(){var failLength=this.parent.parent.failItems.length;if(failLength===1){return mstrmojo.desc(11595,"Could not upload the dashboard.");}var str=mstrmojo.desc(11596,"# dashboards could not be uploaded.");str=mstrmojo.string.multiReplace(str,{"#":failLength});return str;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstr_fu_report_button",alias:"reportLableAlias",text:"Report Problem",bindings:{enableLabel:function(){this.set("enabled",true);this.set("text",mstrmojo.desc(11597,"Report Problem"));mstrmojo.css.removeClass(this.domNode,["mstr_fu_report_button_disable"]);return this.parent.parent.failItems;}},onclick:function(){var reportLabel=this,dashboardName="",errorLog="",subject="Error in importing dashboards from mstr file.",message="",failItems=this.parent.parent.failItems,item,failItemMsg="",params,callbacks,i;reportLabel.set("enabled",false);reportLabel.set("text","");mstrmojo.css.addClass(reportLabel.domNode,["mstr_fu_report_button_disable"]);mstrmojo.css.addClass(reportLabel.domNode,["mstr_fu_report_button_animation"]);for(i=0;i<failItems.length;i++){failItemMsg+="<p>"+failItems[i].dashBoardName+" "+failItems[i].errorLog+"</p>";}message="<p>Dear administrator,</p><p>A user encountered an error while importing dashboards from mstr file.</p><p>The dashboard name(s) and error message(s) are </p><p>"+failItemMsg+"</p>";params={taskId:"reportProblem",taskEnv:"xhr",taskContentType:"json",subject:subject,message:message};callbacks={success:function(res){reportLabel.set("text",mstrmojo.desc(11598,"Problem Reported"));mstrmojo.css.removeClass(reportLabel.domNode,["mstr_fu_report_button_animation"]);},failure:function(res){reportLabel.set("text",mstrmojo.desc(11599,"Error reporting problem"));mstrmojo.css.removeClass(reportLabel.domNode,["mstr_fu_report_button_animation"]);}};mstrmojo.xhr.request("POST",mstrConfig.taskURL,callbacks,params);}}]},{scriptClass:"mstrmojo.Label",text:"Click for details",cssClass:"mstr_fu_collapse_label",onclick:function(){expand.call(this,this.parent.failItemsSection.domNode);},bindings:{visible:function(){return this.parent.failItems.length>1;}}},{scriptClass:"mstrmojo.WidgetList",alias:"failItemsSection",itemFunction:function ifn(item,idx,w){return new mstrmojo.DI.FailedDashboardItem({dbName:item.dashBoardName,errMsg:item.errorLog});},bindings:{items:function(){return this.parent.failItems;},visible:function(){return this.parent.failItems.length===1;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstr_fu_horizon_line",bindings:{visible:function(){return(this.parent.successItems.length>0)&&(this.parent.failItems.length>0);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstr_fu_success_label",bindings:{visible:function(){return this.parent.successItems.length>0;},text:function(){var successLength=this.parent.successItems.length;if(successLength===1){return mstrmojo.desc(11600,"Dashboard was uploaded successfully.");}var str=mstrmojo.desc(11601,"# dashboards were uploaded successfully.");str=mstrmojo.string.multiReplace(str,{"#":successLength});return str;}}},{scriptClass:"mstrmojo.List",itemMarkup:'<div class="mstrmojo-Label mstr_fu_dashboard_name_label">{@dashBoardName}</div>',bindings:{items:function(){return this.parent.successItems;},visible:function(){return this.parent.successItems.length>0;}}}]});}());