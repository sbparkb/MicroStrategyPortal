(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.dnd");function _scrollTo(me,st,noAnim){st=parseInt(st,10)||0;var icn=me.containerNode,ost=icn.offsetTop;if(noAnim){icn.style.MozTransition="";icn.style.webkitTransition="";}else{icn.style.MozTransition="-moz-transform 300ms ease-out";icn.style.webkitTransition="-webkit-transform 300ms ease-out";}icn.style.MozTransform="translate(0, "+(st-ost)+"px)";icn.style.webkitTransform="translate(0, "+(st-ost)+"px)";if(mstrmojo.dom.isIE){icn.style.top=st+"px";}}function _getScrollThumbLength(ch,h){return(ch>h)?Math.round(h*h/ch):0;}function _thumbDelta2ScrollDelta(me,deltaY){var ch=me.containerNode.clientHeight,h=me.wrapperNode.offsetHeight,thbLen=_getScrollThumbLength(ch,h);return(ch>h)?Math.round(deltaY*(ch-h)/(h-thbLen)):0;}function _scrollTop2ThumbTop(ch,h,top){var thbLen=_getScrollThumbLength(ch,h);return(ch>h)?Math.round(-1*top*(h-thbLen)/(ch-h)):0;}mstrmojo._HasFloatingScrollBar=mstrmojo.provide("mstrmojo._HasFloatingScrollBar",{_mixinName:"mstrmojo._HasFloatingScrollBar",draggable:true,scrollingHeight:null,_fsbEnabled:false,ownAvatar:true,ondragend:function ondragend(ctxt){var s=ctxt.src,d=s&&s.data,isScrolling=d&&d.isScrolling,icn=this.containerNode,me=this;if(me._oselectstartFn){document.body.onselectstart=me._oselectstartFn.fn;me._oselectstartFn=null;}if(!isScrolling){this.isReordering=false;if(this._super){return this._super(ctxt);}}else{mstrmojo.css.removeClass(this.domNode,["mstrmojo-fsb-scrolling"]);icn.style.top=me._scrollTop+"px";icn.style.MozTransform="";window.setTimeout(function(){icn.style.webkitTransform="";},0);}},getDragData:function(c){var s=c.src,node=s&&s.node;if(node===this._thumbNode){mstrmojo.css.addClass(this.domNode,["mstrmojo-fsb-scrolling"]);return{isScrolling:true,scrollTop:this._scrollTop||0,thumbTop:parseInt(this._thumbNode.style.top,10)||0};}else{this.isReordering=true;if(this._super){return this._super(c);}}},ondragmove:function(c){var isScrolling=c.src.data&&c.src.data.isScrolling;if(isScrolling){var deltaY=(c.tgt.pos.y-c.src.pos.y),tt=c.src.data.thumbTop+deltaY,nScrollTop=-1*_thumbDelta2ScrollDelta(this,deltaY)+c.src.data.scrollTop,me=this,ch=me.containerNode.clientHeight,h=me.wrapperNode.offsetHeight,st,thbt;if(nScrollTop>=0){st=thbt=0;}else{if(nScrollTop<=h-ch){st=h-ch;thbt=h-_getScrollThumbLength(ch,h);}else{st=nScrollTop;thbt=tt;}}_scrollTo(this,st,true);me._thumbNode.style.top=thbt+"px";me._scrollTop=st;}else{if(this._super){this._super(c);}}},onscrollingHeightChange:function(){var me=this,h=me.wrapperNode.offsetHeight,st=me._scrollTop||0,ch,thbLen;me.containerNode.style.height=Math.max(h,me.scrollingHeight)+"px";ch=me.containerNode.clientHeight;thbLen=_getScrollThumbLength(ch,h);if(ch<=h&&st<0){_scrollTo(me,0,true);me._scrollTop=0;}if(st<h-ch){_scrollTo(me,h-ch,true);me._scrollTop=h-ch;}me._thumbNode.style.top=_scrollTop2ThumbTop(ch,h,me._scrollTop||0)+"px";me._thumbNode.style.height=thbLen+"px";if(ch<=h){mstrmojo.css.removeClass(me.domNode,["mstr-fsb-enabled"]);}else{mstrmojo.css.addClass(me.domNode,["mstr-fsb-enabled"]);}},postBuildRendering:function(){if(this._fsbEnabled){var me=this,ocn=this.containerNode,sbn,stn,sb;if(ocn){sbn=document.createElement("div");mstrmojo.css.addClass(sbn,["mstrmojo-fsb-scrollbox"]);ocn.appendChild(sbn);stn=document.createElement("div");mstrmojo.css.addClass(stn,["mstrmojo-fsb-scrollTrack"]);ocn.appendChild(stn);sb=document.createElement("div");mstrmojo.css.addClass(sb,["mstrmojo-fsb-scrollBar","yAxis"]);stn.appendChild(sb);if(mstrmojo.dom.isWK){var bd=document.body;me._oselectstartFn={fn:bd.onselectstart};sb.onmousedown=function(){bd.onselectstart=function(){return false;};};}me.addSlots({wrapperNode:me.containerNode,_thumbNode:sb,containerNode:sbn});me.wrapperNode.style.overflow="hidden";me.containerNode.style.position="absolute";}}if(this._super){this._super();}}});})();