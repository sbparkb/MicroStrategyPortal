(function(){mstrmojo.requiresCls("mstrmojo.Slider","mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.vi.ui.rw.selectors.MetricValueSliderHelper","mstrmojo.vi.ui.rw.selectors.MetricRankSliderHelper","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.MetricSelectorUtility","mstrmojo.num","mstrmojo.boxmodel");var $C=mstrmojo.css,$D=mstrmojo.dom,$HASH=mstrmojo.hash,$NM=mstrmojo.num,$MU=mstrmojo.MetricSelectorUtility,$BOX=mstrmojo.boxmodel;mstrmojo.vi.ui.rw.selectors.MetricSlider=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.Slider,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.vi.ui.rw.selectors.MetricSlider",updateTypeHelper:function updateTypeHelper(){var qua=this.qua,scriptClass=$MU.typeHelperCls[qua]||$MU.typeHelperCls.defaultCls,Cls=$HASH.walk("vi.ui.rw.selectors."+scriptClass,mstrmojo);this.typeHelper=new Cls({slider:this});$C[(qua!==$MU.Q._G?"add":"remove")+"WidgetCssClass"](this,"rank");},configureGhost:function configureGhost(showGhost){if(!this.staticStatus){return this._super(showGhost);}},initDrag:function initDrag(e,hWin){if(!this.staticStatus&&!this.da.nov){this._super(e,hWin);}},ondrag:function ondrag(e,hWin){if(!this.staticStatus){this._super(e,hWin);}},ondrop:function ondrop(e){if(!this.staticStatus&&!this.da.nov){this._super(e);}},onclick:function onclick(evt){var tgt=evt.getTarget();if(tgt===this.handle1Node||tgt===this.handle2Node){window.clearTimeout(this._tooltipTimeOut);this.hideTooltip();this.openPopup("editValueRef",{tgt:tgt});}else{this._super(evt);}},onincludeChange:function incChange(){if(!this.staticStatus){this.changeInclude=true;this.onselectionChange();}},onquaChange:function onqChg(evt){var oldQua=evt.valueWas,newQua=evt.value,oldf=$MU.getFuncInfo(this.opId,oldQua),newf=$MU.getFuncInfo(this.opId,newQua);if(oldf.ft!==newf.ft){if(!this.staticStatus){this.items=[];this.cs=[];this.f=this.ft=null;this.refresh();}}else{this.f=$MU.getFuncInfo(this.opId,evt.value).f;}this.changeQual=true;this.onselectionChange();},updateData:function udtDt(da,props){this.da=da;this.updateExpr(props);},updateExpr:function udtEp(props){if(props){this.cs=props.cs;this.f=props.f;this.ft=props.ft;this.qua=props.qua;}this.refresh();},editValueRef:{cssClass:"edvl mstrmojo-Tooltip",contentNodeCssClass:"mstrmojo-Tooltip-content",scriptClass:"mstrmojo.Popup",locksHover:true,onOpen:function(){var op=this.opener,edt=this.edt,isfrt=(this.tgt===op.handle1Node),tooltipOffset=$BOX.offset(op.tooltipNode[isfrt?0:1]);$C.addClass(this.domNode,op.richTooltip.cssClass);this.set("left",tooltipOffset.left+"px");this.set("top",tooltipOffset.top-this.containerNode.offsetHeight+"px");edt.set("value",$NM.toLocaleString(isfrt?op.cs1Vl:op.cs2Vl));$D.setInputSelection(edt.inputNode);},onClose:function(){this.opener.set("validation",{invalid:false,position:1});},children:[{scriptClass:"mstrmojo.TextBox",alias:"edt",apply:function(){var p=this.parent,op=p.opener,T=op.typeHelper,isfrt=(p.tgt===op.handle1Node),v=$NM.parseNumeric(this.value);if(String(v).length>0){v=v<op.low?op.low:(v>op.high?op.high:v);op[isfrt?"cs1Vl":"cs2Vl"]=T.fixDigitByNumFormat(v,op.numFmts);op.onselectionChange();T.updateThumb();p.close();}},onEnter:function(){var opener=this.parent.opener,validation=$MU.doValidation(this.value,opener,{refNode:this.parent.domNode,position:1});if(validation.invalid){opener.set("validation",validation);}else{this.apply();}}}]},showTooltip:function showTooltip(e,win){if(!this.editValueRef.visible){this._super(e,win);}}});mstrmojo.vi.ui.rw.selectors.MetricSlider.METRICSLIDERDEFAULTWIDTH=95;}());