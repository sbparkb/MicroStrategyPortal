(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.locales");var _A=mstrmojo.array,MTP=mstrmojo.meta.TP,MSTP=mstrmojo.meta.STP,H=mstrmojo.hash,_ET={ANDOR:14,MQ:10,MC:12,AQ:2,AL:6,AC:9,AE:5,F:13,R:21,B:20,XML:1,RLS:15},_ETvals={};var k;for(k in _ET){_ETvals[_ET[k]]=true;}var ET2TGT={};ET2TGT[_ET.AQ]="a";ET2TGT[_ET.AL]="a";ET2TGT[_ET.AC]="a";ET2TGT[_ET.AE]="a";ET2TGT[_ET.MQ]="m";ET2TGT[_ET.MC]="m";ET2TGT[_ET.F]="f";ET2TGT[_ET.R]="r";ET2TGT[_ET.XML]="p";var ET2C={};ET2C[_ET.MQ]=["not","m","fn","fnt","cs","dmy","idcsi"];ET2C[_ET.MC]=["not","m","fn","fnt","m2","m3","p","dmy","idcsi"];ET2C[_ET.AE]=["not","a","fn","es","a2","fm2","p"];ET2C[_ET.AQ]=["not","a","fm","fn","cs"];ET2C[_ET.AL]=["not","a","fm","fn","cs"];ET2C[_ET.AC]=["not","a","fm","a2","fm2","a3","fm3","fn","cs"];ET2C[_ET.R]=["not","r"];ET2C[_ET.F]=["not","f"];ET2C[_ET.XML]=["not","n","p"];var _ET2FNS={};_ET2FNS[_ET.MQ]="METRIC_FNS";_ET2FNS[_ET.MC]="METRIC_FNS";_ET2FNS[_ET.AQ]="FORM_FNS";_ET2FNS[_ET.AL]="FORM_FNS";_ET2FNS[_ET.AC]="FORM_FNS";_ET2FNS[_ET.AE]="ELEM_FNS";var _TP={FILTER:1,REPORT:3,METRIC:4,FOLDER:8,PROMPT:10,FUNCTION:11,ATTR:12,FACT:13,DIM:14,FORM:21,ROLE:43,CONS:47},_STP={FILTER:256,CUSTOMGROUP:257,PROMPT:2560,PROMPT_BOOLEAN:2561,PROMPT_LONG:2562,PROMPT_STRING:2563,PROMPT_DOUBLE:2564,PROMPT_DATE:2565,PROMPT_OBJECTS:2566,PROMPT_ELEMENTS:2567,PROMPT_EXPRESSION:2568,PROMPT_EXPRESSION_DRAFT:2569,PROMPT_DIMTY:2570,PROMPT_BIGDECIMAL:2571,REPORT_GRID:768,REPORT_GRAPH:769,REPORT_ENGINE:770,REPORT_TEXT:771,REPORT_DATAMART:772,REPORT_BASE:773,REPORT_GRIDGRAPH:774,REPORT_NONINTERACTIVE:775,REPORT_CUBE:776,REPORT_EMMACUBE:779,CONS:12032,NDE:12033},OBJKEY2TP={a:_TP.ATTR,a2:_TP.ATTR,m:_TP.METRIC,m2:_TP.METRIC,r:_TP.REPORT,f:_TP.FILTER,p:_TP.PROMPT},OBJKEY2STP={f:_STP.FILTER};var ET2TP={};ET2TP[_ET.MQ]=_TP.METRIC;ET2TP[_ET.MC]=_TP.METRIC;ET2TP[_ET.AQ]=_TP.ATTR;ET2TP[_ET.AL]=_TP.ATTR;ET2TP[_ET.AC]=_TP.ATTR;ET2TP[_ET.AE]=_TP.ATTR;ET2TP[_ET.F]=_TP.FILTER;ET2TP[_ET.R]=_TP.REPORT;var _funcTrans=function(funs){var len=funs.length,r={},i;for(i=0;i<len;i++){var f=funs[i];r[f.did]=f.n;}return r;},_tpTrans=function(funs){var len=funs.length,i;for(i=0;i<len;i++){var fun=funs[i];if("tp" in fun){fun.t=fun.tp;}}return funs;},_fnTrans=function(funs,t){var len=funs.length,i;for(i=0;i<len;i++){var fun=funs[i];if("tp" in fun){if(t){fun.t=t;}else{delete fun.t;}}}return funs;},_arrRep=function(funs,desc){if(!desc){desc=[];}desc.length=0;var i,len;for(i=0,len=funs.length;i<len;i++){desc[i]=funs[i];}return desc;},FORM_PROHIBITED={0:[{did:"1,76"},{did:"1,79"},{did:"1,77"},{did:"1,80"},{did:"1,78"},{did:"1,81"},{did:"1,18"},{did:"1,43"}],1:[{did:"2,1"},{did:"2,2"},{did:"3,1"},{did:"3,2"}]};var METRIC_PROHIBITED={0:[{did:"1,22"},{did:"1,57"}]};mstrmojo.expr=mstrmojo.provide("mstrmojo.expr",{ET:_ET,ETs:_ETvals,ET2TGT:ET2TGT,ET2COND:ET2C,ET2TP:ET2TP,FN:{EQUAL:6,NOT_EQUAL:7,GREATER:8,LESS:9,GREATER_EQUAL:10,LESS_EQUAL:11,IN_LIST:22,NOT_IN_LIST:57,BETWEEN:17,NOT_BETWEEN:44,IS_NULL:54,IS_NOT_NULL:55,AND:19,OR:20,NOT:21,SEARCH:158},FN_MRP:{BETWEEN:3,EXCLUDE_TOP:4,EXCLUDE_BOTTOM:5,BETWEEN_DESCENDING:13},FNT:{DEF:1,RANK:2,PER:3},FN_SEP:",",TP:_TP,STP:_STP,DMY_TP:{ATTR:-1,DIM:-2},DTP:{UNKNOWN:-1,INTEGER:1,UNSIGNED:2,NUMERIC:3,DECIMAL:4,REAL:5,DOUBLE:6,FLOAT:7,CHAR:8,VARCHAR:9,LONGVARCHAR:10,BINARY:11,VARBIN:12,LONGVARBIN:13,DATE:14,TIME:15,TIMESTAMP:16,SHORT:21,LONG:22,MBCHAR:23,BOOLEAN:24,PATTERN:25,BIGDECIMAL:30},BFTP:{RESERVED:0,HIDDEN:-1,DATETIME:1,NUMBER:2,TEXT:3,PICTURE:4,URL:5,EMAIL:6,TAG:7,DATE:8,TIME:9,SYMBOL:10,BIGDECIMAL:11,PHONENUMBER:12},METRIC_DTP:3,FN_DTP:{NUM:0,CHAR:1,DATE:2},DTP2PROMPT_STP:{"-1":_STP.PROMPT,1:_STP.PROMPT_LONG,2:_STP.PROMPT_LONG,3:_STP.PROMPT_LONG,4:_STP.PROMPT_DOUBLE,5:_STP.PROMPT_DOUBLE,6:_STP.PROMPT_DOUBLE,7:_STP.PROMPT_DOUBLE,8:_STP.PROMPT_STRING,9:_STP.PROMPT_STRING,10:_STP.PROMPT_STRING,14:_STP.PROMPT_DATE,15:_STP.PROMPT_DATE,16:_STP.PROMPT_DATE,21:_STP.PROMPT_LONG,22:_STP.PROMPT_LONG,23:_STP.PROMPT_STRING,24:_STP.PROMPT_BOOLEAN,30:_STP.PROMPT_BIGDECIMAL},DTP2FN_DTP:{"-1":0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1,9:1,10:1,11:0,12:0,13:0,14:0,15:0,16:0,21:0,22:0,23:1,24:0,25:1,30:0,34:0},fnCstCount:function fcc(fn,fnt){var f=this.FN,FN_MRP=this.FN_MRP,FNT=this.FNT;if(fnt===FNT.DEF||fnt===undefined){switch(fn){case f.BETWEEN:case f.NOT_BETWEEN:return 2;case f.IS_NULL:case f.IS_NOT_NULL:return 0;}}else{if(fnt===FNT.PER||fnt===FNT.RANK){switch(fn){case FN_MRP.BETWEEN:case FN_MRP.BETWEEN_DESCENDING:return 2;}}}return 1;},fn_List:function fn_List(fn,fnt){var f=this.FN;return fn==f.IN_LIST||fn==f.NOT_IN_LIST;},fn_AC_MC:function fn_AC_MC(fn,fnt){var f=this.FN;return(fn==f.EQUAL)||(fn==f.NOT_EQUAL)||(fn==f.GREATER)||(fn==f.LESS)||(fn==f.GREATER_EQUAL)||(fn==f.LESS_EQUAL);},fnName:function fnn(et,fn,fnt,dtp){var arr=this[_ET2FNS[et]];if(arr&&arr.constructor===Object){arr=arr[this.DTP2FN_DTP[dtp]]||arr["*"];}if(et===_ET.MQ){arr=arr.concat(mstrmojo.locales.expression.MetricRP);}var i=_A.find(arr,"did",(fnt||1)+this.FN_SEP+fn);if(i>-1){return arr[i].n;}return"";},findTargets:function fndT(nd,idField,h){if(!h){h={};}if(nd){var k;for(k in OBJKEY2TP){var t=nd[k];if(t){if(!t[MTP]){t[MTP]=OBJKEY2TP[k];}if(!t[MSTP]&&OBJKEY2STP[k]){t[MSTP]=OBJKEY2STP[k];}h[t[idField]]=t;}}if(nd.dmy){var A=this.TP.ATTR,DA=this.DMY_TP.ATTR,uts=nd.dmy.uts,u,uLen;for(u=0,uLen=(uts&&uts.length)||0;u<uLen;u++){var ut=uts[u];if(ut&&ut.utp===DA){var dt=ut.utgt;if(!dt.t){dt.t=A;}h[dt[idField]]=dt;}}}var ch=nd.nds,i,len;for(i=0,len=(ch&&ch.length)||0;i<len;i++){this.findTargets(ch[i],idField,h);}var cs=nd.cs,clen=cs&&cs.length;if(clen){for(i=0;i<clen;i++){this.findTargets(cs[i],idField,h);}}}return h;},onLocaleUpdated:function(){var _STRS=mstrmojo.locales.expression,_E=mstrmojo.expr;_E.BRANCH_FNS=H.copy(_funcTrans(_STRS.BranchQual),_E.BRANCH_FNS);_E.ELEM_FNS=_arrRep(_fnTrans(_STRS.Element,"fn"),_E.ELEM_FNS);_E.METRIC_FNS={"*":_fnTrans(_A.filter(_STRS.Metric.concat(_STRS.MetricRP),function(item){return item.did&&(_A.find(METRIC_PROHIBITED["0"],"did",item.did)<0);}))};_E.FORM_FNS={0:_fnTrans(_A.filter(_STRS.Attribute,function(item){return item.did&&(_A.find(FORM_PROHIBITED["0"],"did",item.did)<0);})),1:_fnTrans(_A.filter(_STRS.Attribute,function(item){return item.did&&(_A.find(FORM_PROHIBITED["1"],"did",item.did)<0);})),2:_fnTrans(_A.filter(_STRS.Attribute,function(item){return item.did&&(_A.find(FORM_PROHIBITED["0"],"did",item.did)<0)&&(_A.find(FORM_PROHIBITED["1"],"did",item.did)<0);}))};_E.DIMTYLEVELS=_arrRep(_fnTrans(_STRS.DimtyLevels),_E.DIMTYLEVELS);},getSortedObjectsByTypeGroup:function getSortedObjectsByTypeGroup(objects){var TYPE_GROUP_ATTRIBUTE=0,TYPE_GROUP_METRIC=1,TYPE_GROUP_GENERAL=2;function typeGroup(object){switch(object.t){case _TP.METRIC:return TYPE_GROUP_METRIC;case _TP.ATTR:case _TP.DIM:case _TP.CONS:return TYPE_GROUP_ATTRIBUTE;case _TP.FILTER:return object.st===_STP.CUSTOMGROUP?TYPE_GROUP_ATTRIBUTE:TYPE_GROUP_GENERAL;default:return TYPE_GROUP_GENERAL;}}return objects.slice(0).sort(function(o1,o2){var typeGroupDiff=typeGroup(o1)-typeGroup(o2);if(typeGroupDiff){return typeGroupDiff;}var upper1=o1.n.toUpperCase(),upper2=o2.n.toUpperCase(),upperDiff=upper1.localeCompare(upper2);if(upperDiff){return upperDiff;}return o1.n.localeCompare(o2.n);});},mapBaseFormTypeToDataType:function mapBaseFormTypeToDataType(baseFormType){baseFormType=parseInt(baseFormType);if(baseFormType===NaN){return -1;}var BFTP=this.BFTP,DTP=this.DTP;switch(baseFormType){case BFTP.DATETIME:return DTP.TIMESTAMP;case BFTP.DATE:return DTP.DATE;case BFTP.TIME:return DTP.TIME;case BFTP.NUMBER:return DTP.REAL;case BFTP.TEXT:return DTP.CHAR;case BFTP.BIGDECIMAL:return DTP.BIGDECIMAL;default:return DTP.CHAR;}}});mstrmojo.expr.onLocaleUpdated();}());