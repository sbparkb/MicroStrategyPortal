(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.WidgetTree","mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.onetier.vi.ui.DBCredentialEditor");mstrmojo.requiresDescs(221,8708,14284,14285,14286,14287,14328);var constants=mstrmojo.DI.DIConstants,MAX_NAME_LENGTH=30,LeafRenderer=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICredentialsTable",data:null,cssClass:"dataset-table",markupString:'<div id="{@id}" class="cf {@cssClass}" ><div class="dataset-table-status"></div><div></div><div></div></div>',markupSlots:{tableNode:function(){return this.domNode.children[1];},statusNode:function(){return this.domNode.children[0];},buttonNode:function(){return this.domNode.children[2];}},children:[{scriptClass:"mstrmojo.Label",slot:"tableNode",bindings:{text:function(){var tableName=this.parent.data.name;if(tableName.length>MAX_NAME_LENGTH){tableName=tableName.substr(0,MAX_NAME_LENGTH)+"...";}return tableName;},title:function(){var tooltip="";if(this.parent.data.name.length>MAX_NAME_LENGTH){tooltip=this.parent.data.name;}return tooltip;},cssClass:function(){var css="table-font-credentials-not-fetched";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.domNode,css);css="";}else{mstrmojo.css.addClass(this.domNode,css);}return"dataset-table-name "+css;}}},{scriptClass:"mstrmojo.Label",slot:"statusNode",tableStatusClass:{"0":"","1":"waiting","2":"finished","3":"warning"},bindings:{cssClass:function(){var css;if(this.parent.data.credentialsFetched){css=this.tableStatusClass[2];}else{if(this.parent.data.credentialsFetched===false){css=this.tableStatusClass[3];}else{css=this.tableStatusClass[0];}}mstrmojo.css.addClass(this.domNode,css);return css;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.data.credentialsFetched?mstrmojo.desc(14286,"Edit Credentials"):mstrmojo.desc(14287,"Input Credentials");},innerIconClass:function(){var css="button-font-input";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.textNode,css);css="";}else{mstrmojo.css.addClass(this.textNode,css);}return css;}},slot:"buttonNode",onclick:function(){var source=this.parent.data;var tableIDs=[this.parent.data.did];var controller=mstrApp.getRootController();switch(source.dict){case constants.backendSourceSubtype.googleBigQuery:case constants.backendSourceSubtype.googleBigQueryFFSQLModel:case constants.backendSourceSubtype.googleBigQuerySingleTable:controller.setTableIDsForOAuth(tableIDs);controller.gotoOAuthLogin(constants.sourceType.googleBigQuery);break;case constants.backendSourceSubtype.dropbox:controller.setTableIDsForOAuth(tableIDs);controller.gotoOAuthLogin(constants.sourceType.dropbox);break;case constants.backendSourceSubtype.googleAnalytics:controller.setTableIDsForOAuth(tableIDs);controller.gotoOAuthLogin(constants.sourceType.googleAnalytics);break;case constants.backendSourceSubtype.googleDrive:controller.setTableIDsForOAuth(tableIDs);controller.gotoOAuthLogin(constants.sourceType.googleDrive);break;case constants.backendSourceSubtype.facebook:controller.setTableIDsForOAuth(tableIDs);controller.gotoOAuthLogin(constants.sourceType.facebook);break;case constants.backendSourceSubtype.twitter:controller.setTableIDsForOAuth(tableIDs);controller.gotoOAuthLogin(constants.sourceType.twitter);break;case constants.backendSourceSubtype.salesforce:controller.setTableIDsForOAuth(tableIDs);controller.gotoOAuthLogin(constants.sourceType.salesforce);break;default:var dbmsObj=source.dbRole.dbmsObj;if(dbmsObj.DBInfo.driverInstalled){new mstrmojo.onetier.vi.ui.DBCredentialEditor({data:source,zIndex:this.parent.parent.tree.parent.zIndex+1}).open();}else{mstrmojo.alert(mstrmojo.desc(14328,"There is no driver installed for ##. Please install it and try again.").replace("##",dbmsObj.n));}break;}}}]});mstrmojo.DI.ui.dialogs.DICredentialsDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICredentialsDialog",title:mstrmojo.desc(14285,"Connection Information"),cssClass:"mstrmojo-di-credentials-dialog",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(8708,"OK"),alias:"okButton",onclick:function(){var editor=this.parent.parent,ret=true;if(editor.onOK){ret=editor.onOK();}if(ret){editor.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelButton",onclick:function(){var editor=this.parent.parent,ret=true;if(editor.onCancel){ret=editor.onCancel();}if(ret){editor.close();}}}],onOpen:function(){this.set("items",this.model.datasets);if(this._super){this._super();}},onOK:function(){mstrApp.getRootController().wrapUpDataImport();return true;},onCancel:function(){mstrApp.serverRequest({taskId:"authenticationCancelled"},null,{doNotHold:true});return true;},onClose:function(){window.setTimeout(function(){if(mstrApp.container){mstrApp.container.close();}},0);},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tablestatuslist-title",text:mstrmojo.desc(14284,"Please enter credentials used to create these datasets in order to access the following datasets in the dashboard:")},{scriptClass:"mstrmojo.WidgetTree",bindings:{items:"this.parent.items"},itemIdField:"did",itemDisplayField:"name",itemChildrenField:"tables",cssClass:"datasets-list",itemFunction:function ifn(item,idx,w){var tree=w.tree||w,iw=new mstrmojo.TreeNode({idx:idx,data:item,state:1,parent:w,tree:tree,multiSelect:w.multiSelect,text:item[w.itemDisplayField],textCssClass:tree.item2textCss(item),items:item[w.itemChildrenField],itemIdField:w.itemIdField,itemDisplayField:w.itemDisplayField,itemIconField:w.itemIconField,itemChildrenField:w.itemChildrenField,itemFunction:function(item,idx,w){return new LeafRenderer({idx:idx,data:item,parent:w});},listSelector:w.listSelector});return iw;}}]});}());