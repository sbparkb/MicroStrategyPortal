(function(){mstrmojo.requiresClsP("mstrmojo","hash","Button","Box","express.ui.SubtotalsWidget");var $HASH=mstrmojo.hash;mstrmojo.express.ui.SubtotalMenuEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.express.ui.SubtotalMenuEditor",checkList:undefined,btnContainer:undefined,onSubmenuOpen:function onSubmenuOpen(){this.checkList.set("selectedItems",this.cell.ast);},children:[{scriptClass:"mstrmojo.express.ui.SubtotalsWidget",alias:"checkList"},{scriptClass:"mstrmojo.Box",alias:"btnContainer",cssClass:"mstrmojo-subtotals-button cf",cancelBtn:undefined,children:[{scriptClass:"mstrmojo.Button",alias:"cancelBtn",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.onSubmenuClosed();}},{scriptClass:"mstrmojo.Button",alias:"okBtn",text:mstrmojo.desc(1442,"OK"),onclick:function(){var editor=this.parent.parent,cell=editor.cell,xtab=editor.xtab,selections=[],newSelections=[],selected=editor.checkList.selectedIndices,prevSelection=cell.ast,clearSelections=[],i,j;$HASH.forEach(selected,function(v,k){var item=editor.checkList.items[k].v,toAdd=true;selections.push(item);if(prevSelection){for(i=0;i<prevSelection.length;i++){if(item===prevSelection[i].t){toAdd=false;break;}}if(toAdd){newSelections.push(item);}}});if(prevSelection){for(i=0;i<prevSelection.length;i++){var item=prevSelection[i].t,found=false;for(j=0;j<selections.length;j++){if(selections[j]===item){found=true;}}if(!found){clearSelections.push(item);}}}xtab.showTotal(cell,prevSelection?newSelections:selections,clearSelections);editor.onSubmenuClosed();}}]}]});}());