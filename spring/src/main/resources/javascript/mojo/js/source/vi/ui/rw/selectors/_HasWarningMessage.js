(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.hash","mstrmojo.string");mstrmojo.requiresDescs(11038,11935,11936,11937,11856,11938,13138,13230,13260,14633,14636);var $COPY=mstrmojo.hash.copy,$CSS=mstrmojo.css,$D=mstrmojo.dom,$A=mstrmojo.array,$S=mstrmojo.string,replaceSharp=function replaceSharp(str,args){if(!str){return ;}var len=args&&args.length||0,i;for(i=len;i>0;i--){str=str.replace(new Array(i+2).join("#"),args[i-1]);}return str;},adjustTooltipPos=function adjustTooltipPos(validation){if(!validation){return ;}var $this=this,refPos=$D.position(validation.refNode||$this.refNode),tlPos=$D.position($this.domNode),position=validation.position||WARNING_POS.RIGHT,l=0,t=0,mr=9+(validation.margin!==undefined?validation.margin:0),cssCls=" ";switch(position){case WARNING_POS.TOP:t=-tlPos.h-mr;cssCls+="t";break;case WARNING_POS.BOTTOM:t=refPos.h+mr;cssCls+="b";break;case WARNING_POS.LEFT:l=-tlPos.w-mr;cssCls+="l";break;case WARNING_POS.RIGHT:l=refPos.w+mr;cssCls+="r";break;}mstrmojo.hash.forEach($COPY(validation,{left:l,top:t,contentNodeCssClass:cssCls,visible:false}),function(k,n){this[n]=k;},this);this.set("visible",validation.invalid);},parseWarningContent=function parseWarningContent(validation){var $this=this,_result,code=validation.errorCode,msg=validation.errorMsg,args=validation.args,dict=mstrmojo.vi.ui.rw.selectors.EnumWarningMessages;if(validation.invalid){_result={content:code!==null?($this.generateContentHTML(replaceSharp(dict[code],args))||dict["*"]):msg};}return _result;};mstrmojo.vi.ui.rw.selectors.EnumWarningMessages=$COPY(mstrmojo.locales.validation,{"*":mstrmojo.desc(11038,"Invalid"),invalidValueVIWarning:mstrmojo.desc(11935,"Invalid characters"),emptyValueVIWarning:mstrmojo.desc(11936,"Please enter a number"),notIntegerVIWarning:mstrmojo.desc(11937,"Please enter an integer"),outOfRangeVIWarning:mstrmojo.desc(11856,"Please enter value between ## and ###."),noMultiSelectionVIWaring:mstrmojo.desc(11938,"This selector does not support multiple selections."),continuousSelectionVIWaring:mstrmojo.desc(13138,"This selector does not support non-continuous selections."),bigDecimalMetricSliderVIWaring:mstrmojo.desc(13230,"Cannot qualify on big decimal value. Please change qualification type to Rank"),unableDisplaySelectionVIWarning:mstrmojo.desc(13260,"Filter cannot display actual selections."),imageSizeExceedLimitVIWarning:mstrmojo.desc(14633,"Cannot embed an image larger than ##MB. Your image is still ###MB after compression. Enter a URL to the image instead."),imageFileTypeNotSupportedVIWarning:mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."),imageOverSizeNoCompessionVIWarning:mstrmojo.desc(14665,"Cannot embed an image larger than ##MB. Enter a URL to the image instead.")});mstrmojo.vi.ui.rw.selectors.EnumWarningPosition={TOP:1,BOTTOM:2,LEFT:3,RIGHT:4};var WARNING_POS=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition;mstrmojo.vi.ui.rw.selectors._HasWarningMessage=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._HasWarningMessage",{_mixinName:"mstrmojo.vi.ui.rw.selectors._HasWarningMessage",warningSlotName:"warning",showWarning:function showWarning(validation){var $this=this,wSlot=$this.warningSlotName,tooltip=$this[wSlot],lasting=validation&&validation.lasting||6000,refNode=validation.refNode||this.domNode,highlight=validation.highlight!==false,closeOnClick=validation.closeOnClick===false?false:true,fnCloseOnClick;if(!tooltip){tooltip=new mstrmojo.Tooltip({refNode:refNode,highlight:highlight,closeOnClick:closeOnClick,updatePopupConfig:null,cssClass:"vi-warning vi-tooltip-V"});$this.addDisposable(tooltip);$this[wSlot]=tooltip;fnCloseOnClick=$this.closeOnClick=$this.getCloseOnClickListener();$D.attachEvent(document.body,"click",fnCloseOnClick);}var position=validation.position||WARNING_POS.TOP,TOOLTIP_CSS_PRE="vi-warning vi-tooltip-";switch(position){case WARNING_POS.TOP:tooltip.cssClass=TOOLTIP_CSS_PRE+"V";break;case WARNING_POS.BOTTOM:tooltip.cssClass=TOOLTIP_CSS_PRE+"A";break;case WARNING_POS.LEFT:tooltip.cssClass=TOOLTIP_CSS_PRE+"D";break;case WARNING_POS.RIGHT:tooltip.cssClass=TOOLTIP_CSS_PRE+"C";break;}tooltip.open($this,parseWarningContent.call($this,validation));this.adjustPosition(validation);if(highlight){$CSS.toggleClass(tooltip.refNode,"mstrmojo-Warning",true);}window.clearTimeout($this._warningTimeOut);$this._warningTimeOut=window.setTimeout(function(){$this.hideWarning();},lasting);},hideWarning:function hideWarning(){var $this=this,tooltip=$this[$this.warningSlotName];if(tooltip&&tooltip.visible&&tooltip.close){if(tooltip.highlight){$CSS.toggleClass(tooltip.refNode,"mstrmojo-Warning",false);}tooltip.close();window.clearTimeout($this._warningTimeOut);delete $this._warningTimeOut;}},getCloseOnClickListener:function getCloseOnClickListener(){var $this=this;return function(){var tooltip=$this[$this.warningSlotName];if(tooltip.closeOnClick){$this.hideWarning();}};},adjustPosition:function adjustPosition(validation){var $this=this;adjustTooltipPos.call($this[$this.warningSlotName],validation);},generateContentHTML:function generateContentHTML(errorMessage){return $S.encodeHtmlString(errorMessage,true);},bindWarningHandler:function bindWarningHandler(){$A.forEach(arguments,function bindWarningHandlerToEach(widget){if(!widget||!widget.attachEventListener){return ;}var _validationEventListener=widget._validationEventListener,fnValidate;if(_validationEventListener){widget.detachEventListener(_validationEventListener);delete widget._validationEventListener;}fnValidate=this.getValidationEvtListener();if(fnValidate){widget._validationEventListener=widget.attachEventListener("validationChange",this.id,fnValidate);}},this);},getValidationEvtListener:function getValidationEvtListener(){var $this=this;return function validationChangeHandler(evt){var validation=evt.value;$this[(validation&&validation.invalid?"show":"hide")+"Warning"](validation);};},unrender:function unrender(ignoreDom){var tooltip=this[this.warningSlotName];if(tooltip){tooltip.unrender();}this._super(ignoreDom);},destroy:function destroy(ignoreDOM){$D.detachEvent(document.body,"click",this.closeOnClick);return this._super(ignoreDOM);}});}());