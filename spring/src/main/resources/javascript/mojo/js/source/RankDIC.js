(function(){mstrmojo.requiresCls("mstrmojo.List");var $D=mstrmojo.dom,$A=mstrmojo.array,$C=mstrmojo.css,DELIM=",";function setValue(){var i,len,items=this.items,vs=[];for(i=0,len=items.length;i<len;i++){vs.push(items[i].v);}this.set("value",vs.join(DELIM));}function clearSelectedDOM(){var container=this.itemsContainerNode;if(container){$A.forEach(container.children,function(dom){if(dom&&dom.firstChild){$C.removeClass(dom.firstChild,"selected");}});}}mstrmojo.RankDIC=mstrmojo.declare(mstrmojo.List,[mstrmojo._IsInputControl],{scriptClass:"mstrmojo.RankDIC",cssClass:"mstrmojo-RankDIC",draggable:true,dropZone:true,allowCopy:false,multiSelect:false,renderOnScroll:false,itemDisplayField:"n",itemIdField:"v",containerResizable:false,itemMarkupFunction:function(item,idx,w){var isFirst=idx===0,isLast=idx===w.items.length-1,upBtn='<div class="moveup '+(!isFirst?"":"disabled")+'" or="1" idx="'+idx+'">&nbsp;</div>',downBtn='<div class="movedown '+(!isLast?"":"disabled")+'" or="-1" idx="'+idx+'">&nbsp;</div>';return'<div class="mstrmojo-RankOption'+(isFirst?" first":(isLast?" last":""))+'"><div class="index" contentEditable="true" onfocus="return mstrmojo.all[\''+w.id+"'].selectText(this);\" onblur=\"return mstrmojo.all['"+w.id+"'].indexChanged(this, "+idx+');" onkeyup="return mstrmojo.all[\''+w.id+"'].keyPressed(event, this, "+idx+');">'+idx+'</div><div class="text">'+item.n+"</div>"+downBtn+upBtn+"</div>";},allowDrop:function(c){var s=c&&c.src,w=s&&s.widget;return(w===this);},ondrop:function(c){var p=this.domNode.parentNode,ps=p.style,u=false;if(!ps.height){ps.height=p.offsetHeight+"px";u=true;}this._super(c);clearSelectedDOM.call(this);setValue.call(this);if(u){ps.height="";}},selectText:function selectText(dom){var range=document.createRange();range.selectNodeContents(dom);var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);},indexChanged:function(dom,idx){var newIdx=parseInt(dom[dom.innerText!==undefined?"innerText":"textContent"],10),oldIdx=parseInt(idx,10),len=this.items.length;if(isNaN(newIdx)){dom[dom.innerText!==undefined?"innerText":"textContent"]=idx;return false;}newIdx=Math.min(Math.max(0,newIdx),len);if(newIdx!==oldIdx){this.move([oldIdx],newIdx);setValue.call(this);return true;}else{return true;}},keyPressed:function keyPressed(e,dom,idx){if(e.keyCode===mstrmojo.Enum_Keys.ESCAPE){dom[dom.innerText!==undefined?"innerText":"textContent"]=idx;if(dom.blur){dom.blur();}}else{if(e.keyCode===mstrmojo.Enum_Keys.ENTER){this.indexChanged(dom,idx);}}return true;},onmouseup:function(e){var dom=$D.eventTarget(e.hWin,e.e),or=parseInt(dom.getAttribute("or"),10),idx=dom&&parseInt(dom.getAttribute("idx"),10),len=this.items.length;if(or===1&&idx!==0){this.move([idx],0);setValue.call(this);return true;}else{if(or===-1&&idx!==(len-1)){this.move([idx],len);setValue.call(this);return true;}else{mstrmojo.dom.preventDefault(window,e.e);return true;}}},init:function(props){this._super(props);this.items=this.getItems();}});}());