(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.ToolbarButton","mstrmojo.architect.ui.SettingsList","mstrmojo.architect.ui.EnumViewTypes","mstrmojo.Box","mstrmojo.dom");var $DOM=mstrmojo.dom,$ENUM_VIEW_TYPES=mstrmojo.architect.ui.EnumViewTypes,CSS_SELECTED="selected",CSS_PREFIX="mstrmojo-ar-tb-icon",CSS_CLASS_ON="on",CSS_CLASS_DBVIEW="databaseview",CSS_CLASS_TBLVIEW="ptableview",CSS_CLASS_SYS_DIM="sysdim",CSS_CLASS_USER_HIERARCHY="userdim",CSS_CLASS_LAYER="layer",CSS_CLASS_TRANSFORMATION="trsfm",CSS_CLASS_LOGICAL_VIEWS="logvw",CSS_CLASS_UPDATE="update",CSS_CLASS_SAVE="save",CSS_CLASS_SETTINGS="autoMap",CSS_SEP=" ",STR_LAYERS=mstrmojo.desc(11142,"Layers"),STR_SYS_HIERARCHY=mstrmojo.desc(788,"System Hierarchy"),STR_USER_HIERARCHIES=mstrmojo.desc(12216,"User hierarchies"),STR_TRANSFORMATIONS=mstrmojo.desc(12215,"Transformations"),STR_LOGICAL_VIEWS=mstrmojo.desc(12217,"Logical views"),STR_AUTO_MAP=mstrmojo.desc(11402,"Auto Map"),STR_SAVE_PROGRESS=mstrmojo.desc(11383,"Save Progress"),STR_UPDATE_SCHEMA=mstrmojo.desc(12248,"Update schema"),STR_DATA_SOURCES=mstrmojo.desc(4381,"data sources"),STR_PROJECT_EXPLORER=mstrmojo.desc(12249,"Project explorer");mstrmojo.architect.ui.Toolbar=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.Toolbar",postBuildRendering:function postBuildRendering(){this._super();this.onwidthChange();},onwidthChange:function onwidthChange(){var viewsDN=this.views.domNode;if(viewsDN){var width=parseInt(this.width,10),viewsWidth=$DOM.position(viewsDN).w,minLeft=140,left=((width-viewsWidth)/2);viewsDN.style.left=(left<minLeft?minLeft:left)+"px";}},tbList:undefined,toggleLeft:undefined,databaseView:undefined,update:function update(params){this.toggleLeft.set("active",params.isLeftVisible);this.databaseView.set("active",params.showDB);mstrApp.rootController.toggleDatabaseView(params.showDB);var cv=params.currentView,tbList=this.views.tbList;tbList.selectedIndices={};tbList.selectedIndices[cv]=true;tbList.refresh();},children:[{scriptClass:"mstrmojo.architect.ui.ToolbarButton",cmd:"saveProject",iconClass:[CSS_PREFIX,CSS_CLASS_SAVE].join(CSS_SEP),title:STR_SAVE_PROGRESS},{scriptClass:"mstrmojo.architect.ui.ToolbarButton",cmd:"saveAndUpdate",iconClass:[CSS_PREFIX,CSS_CLASS_UPDATE].join(CSS_SEP),title:STR_UPDATE_SCHEMA},{scriptClass:"mstrmojo.architect.ui.ToolbarButton",alias:"databaseView",cmd:"toggleDatabaseView",active:false,iconClass:[CSS_PREFIX,CSS_CLASS_DBVIEW].join(CSS_SEP),title:STR_DATA_SOURCES,persistSelection:true},{scriptClass:"mstrmojo.architect.ui.ToolbarButton",alias:"toggleLeft",cmd:"toggleProjectTableView",active:true,iconClass:[CSS_PREFIX,CSS_CLASS_TBLVIEW,CSS_CLASS_ON].join(CSS_SEP),title:STR_PROJECT_EXPLORER,persistSelection:true},{scriptClass:"mstrmojo.Box",alias:"views",cssClass:"views-tb",children:[{scriptClass:"mstrmojo.architect.ui.SimpleList",cssClass:"views-tb-list",alias:"tbList",selectedIndex:0,getItemMarkup:function(){return'<div class="item {@cls}" title="{@n}" idx="{@idx}"></div>';},getItemProps:function getItemProps(item,idx){var isSelected=!!this.selectedIndices[idx];return{tag:"div",sel:isSelected,cls:[CSS_PREFIX,item.cls||""].concat(isSelected?CSS_SELECTED:"").join(CSS_SEP),n:item.n,style:"",idx:idx};},preselectionChange:function preselectionChange(evt){var check=mstrApp.rootController.preSwitchView();if(!check.canProceed){this.select([evt.removed[0]],true);mstrmojo.alert(check.msg);return false;}},postselectionChange:function postselectionChange(evt){mstrApp.rootController.switchView(this.items[evt.added[0]].viewTp,true);},items:[{n:STR_LAYERS,viewTp:$ENUM_VIEW_TYPES.LAYER,cls:CSS_CLASS_LAYER},{n:STR_SYS_HIERARCHY,viewTp:$ENUM_VIEW_TYPES.SYS_HIERARCHY,cls:CSS_CLASS_SYS_DIM},{n:STR_USER_HIERARCHIES,viewTp:$ENUM_VIEW_TYPES.USER_HIERARCHY,cls:CSS_CLASS_USER_HIERARCHY},{n:STR_TRANSFORMATIONS,viewTp:$ENUM_VIEW_TYPES.TRANSFORMATION,cls:CSS_CLASS_TRANSFORMATION},{n:STR_LOGICAL_VIEWS,viewTp:$ENUM_VIEW_TYPES.LOGICAL_VIEWS,cls:CSS_CLASS_LOGICAL_VIEWS}]}]},{scriptClass:"mstrmojo.architect.ui.ToolbarButton",persistSelection:"persistSelection",cmd:function cmd(){var toolbarButton=this,settingsList=this.settingsList=this.settingsList||new mstrmojo.architect.ui.SettingsList({parentDomNode:this.domNode,onClose:function onClose(){toolbarButton.settingsList.set("visible",false);toolbarButton.set("active",false);}});if(!settingsList.hasRendered){settingsList.render();}if(this.active){settingsList.open(this);}else{settingsList.close();}},closePopup:mstrmojo.emptyFn,iconClass:[CSS_PREFIX,CSS_CLASS_SETTINGS].join(CSS_SEP),title:STR_AUTO_MAP}]});}());