(function(){mstrmojo.requiresCls("mstrmojo.hash");mstrmojo.requiresClsP("mstrmojo.chart","Axis","ChartAdvFormat","NumberObject","AxisObject","Vector2D","ChartConstants","Point2D");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumGraphMajorType","EnumDSSGraphOffScaleType","EnumAnchorPoint","EnumAxisLabelsLocation","EnumAxisDirection","EnumGraphObjectType","EnumNumberCategory","EnumCollectionType","EnumRectExpandDirection");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphProperty","EnumDSSGraphObject","EnumDSSExtraGraphProperty","EnumDSSGraphFontRotation","EnumDSSGraphGridLineType","EnumDSSGraphMarkerShape");mstrmojo.requiresCls("mstrmojo.chart.common.Utility");mstrmojo.requiresCls("mstrmojo.VisUtility");mstrmojo.requiresCls("mstrmojo.gm.GMUtility");var $HASH=mstrmojo.hash,$C=mstrmojo.chart,$K=$C.ChartConstants,$CHART_ENUMS=$C.enums,$VISUTIL=mstrmojo.VisUtility,$GMT=$CHART_ENUMS.EnumGraphMajorType,$OST=$CHART_ENUMS.EnumDSSGraphOffScaleType,$AP=$CHART_ENUMS.EnumAnchorPoint,$AXIS_LABEL_LOC=$CHART_ENUMS.EnumAxisLabelsLocation,$AXIS_DIRECTION=$CHART_ENUMS.EnumAxisDirection,$GRAPH_OBJ_TYPE=$CHART_ENUMS.EnumGraphObjectType,$COLLECTION_TYPE=$CHART_ENUMS.EnumCollectionType,$NOID=$C.gNullObjectId,$M=$C.model,$MODEL_ENUMS=$M.enums,$MS=$MODEL_ENUMS.EnumDSSGraphMarkerShape,$GT=$MODEL_ENUMS.EnumDSSGraphType,$GP=$MODEL_ENUMS.EnumDSSGraphProperty,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$EGP=$MODEL_ENUMS.EnumDSSExtraGraphProperty,$FR=$MODEL_ENUMS.EnumDSSGraphFontRotation,$GLT=$MODEL_ENUMS.EnumDSSGraphGridLineType,$RED=$CHART_ENUMS.EnumRectExpandDirection,$GM_MT=$CHART_ENUMS.EnumGraphMatrixMajorGraphType,$Utility=$C.common.Utility,$GM=mstrmojo.gm,$GMUTIL=$GM.GMUtility,kPercentageTolerance=0.00001,kEmptyBlock=0,sTolerance=1e-14,sMaxPosition=10000,sTickOffsetRatio=0.1;var perfOverlapRect=new $C.Rect2D(),perfMaxWidthHeightRect=new $C.Rect2D(),perfLabelMarginRect=new $C.Rect2D(),perfLabelPosition=null,perfVector2D=null,perfLowGridLinePoint=null,perfHighGridLinePoint=null,perfQueryId=new $C.TripleId();function hIsSecondaryAxis(objectId){switch(objectId){case $GO.DssGraphY2Body:case $GO.DssGraphX2Body:return true;}return false;}function hCalSideMinorGridPosition(refMajorPosition,atHighEnd,step){var position=refMajorPosition,kPadding=10,chartCtx=this.mChartContextPtr,xMax=chartCtx.mGraphWidth,yMax=chartCtx.mGraphHeight,isY=this.IsVerticalAxis();if(step===undefined){var max=isY?yMax:xMax;if((isY^atHighEnd)===0){step=0.5*refMajorPosition;}else{step=0.5*(max-refMajorPosition);}}step=atHighEnd?-step:step;if(!isY){step=-step;}position+=step;if(position<kPadding||position+kPadding>(isY?yMax:xMax)){return null;}return position;}function hasShownLabels(){if(this.hasLabelCreated){var i,list=this.mLabelList,len=list.length;for(i=0;i<len;i++){if(list[i]&&list[i].mIsShown){return true;}}return false;}return canAccomodateOneLabel.call(this);}function hCheckZeroInCombo(){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),res={Include:false,DrawFromZero:false};if(gmCtx.isCombinationChart()){var dataset=chartCtx.mDataset,allShapes=dataset.GetSeriesByShape(),axisObjectId=this.mTripleId.mObjectId,ok=false,isSecondaryAxis=hIsSecondaryAxis.call(this,axisObjectId),barSeries=allShapes.Bar,areaSeries=allShapes.Area,barSeriesCount=0,areaSeriesCount=0;var allSeriesCount=dataset.GetSeriesCount();if(chartCtx.IsDualAxis()){var myIndex=isSecondaryAxis?1:0,key=isSecondaryAxis?"Secondary":"Primary";allShapes=dataset.GetShapesDistributionByValueAxis(myIndex)[key];barSeries=allShapes.BAR;areaSeries=allShapes.AREA;allSeriesCount=dataset.GetSeriesByValueAxis(myIndex).length;ok=(barSeries&&barSeries.indexOf(myIndex)!==-1)||(areaSeries&&areaSeries.indexOf(myIndex)!==-1);}else{ok=((barSeries&&barSeries.length>0)||(areaSeries&&areaSeries.length>0));}ok=!!ok;res.Include=ok;if(barSeries&&barSeries.length>0){barSeriesCount=barSeries.length;}if(areaSeries&&areaSeries.length>0){areaSeriesCount=areaSeries.length;}res.DrawFromZero=(areaSeriesCount+barSeriesCount===allSeriesCount);}return res;}function log10(x){return Math.log(x)/Math.log(10);}function hHasTooManyTicks(){if(this.mChartContextPtr.mIsGraphMatrix){return false;}var majorGrid=this.mMajorGrid;return majorGrid.mUseManualGrid&&(majorGrid.mGridInterval<(this.mMaxTick-this.mMinTick)/30);}function hIsManualMinShown(){return this.mOptions.mUseMinValue&&this.mOptions.mShowMinLabel;}function hComputeStep(iMaximum,iMinimum,iIncludeZero){var range,step;if(this.mMajorGrid.mUseManualGrid){return this.mMajorGrid.mGridInterval;}range=0;if(iIncludeZero){range=Math.max(iMaximum,iMaximum-iMinimum);range=Math.max(range,-iMinimum);}else{range=iMaximum-iMinimum;}if(range===0){this.mIsShown=false;return 1;}if(range>=1&&range<=4&&parseInt(range)===range){var mIdxs=this.PrimaryMetricIndex,count=mIdxs.length;for(var k=0;k<count;k++){var dataset=this.mChartContextPtr.mDatasetPtr,dp=dataset.dataProvider,sCnt=dp.getSeriesCount(),gCnt=dp.getGroupCount(),mIdx=mIdxs[k],metricIndex,isInteger;for(var i=0;i<sCnt;i++){metricIndex=dp.getMetricIndexForSeries(i);if(metricIndex===mIdx){isInteger=true;for(var j=0;j<gCnt;j++){var data=dataset.GetData(i,j);if(parseInt(data)!==data){isInteger=false;break;}}}if(isInteger){return 1;}}}}var absoluteRange=range;step=1;while(range<1){range*=10;step/=10;}while(range>=10){range/=10;step*=10;}if(range<1.8){step*=2;step/=10;}else{if(range<3.1){step*=4;step/=10;}else{if(range<4.6){step*=5;step/=10;}else{if(range>=8.1){step*=2;}}}}step=this.postProcessStep(step,absoluteRange);return step;}function hIsHistogramX(){return this.mGraphMajorType===$GMT.GMT_HISTOGRAM&&this.mTripleId.mObjectId===$GO.DssGraphX1Body;}function hIsPolarXOrHistogramX(){return(this.mGraphMajorType===$GMT.GMT_HISTOGRAM||this.mGraphMajorType===$GMT.GMT_POLAR)&&this.mTripleId.mObjectId===$GO.DssGraphX1Body;}function hIsAutoXAxis(){var chartCtx=this.mChartContextPtr;if(chartCtx.mIsGraphMatrix){return !this.IsVerticalAxis();}if(!this.mChartContextPtr.mManualLayoutMode&&this.mTripleId.mObjectId===$GO.DssGraphX1Body&&!this.IsVerticalAxis()){switch(this.mGraphMajorType){case $GMT.GMT_HISTOGRAM:case $GMT.GMT_SCATTER:case $GMT.GMT_BUBBLE:return true;default:break;}}return false;}function hApplyAutoXAxisLayout(){var ticks,hasOverlap,tripleId,yCoord,formatFontPtr,i=0,axisOptions=this.mOptions,len,oneLabel,currentRect,startIndex=0;var chartCtx=this.mChartContextPtr,isGraphMatrix=chartCtx.mIsGraphMatrix,xRotateLabel=chartCtx.getUniformAxisLabelRotateMode("x");ticks=[];this.GetTicks(ticks);if(ticks.length<2){if(!isGraphMatrix||xRotateLabel===$FR.Automatic){return ;}}tripleId=$C.gAxisObjects[this.getIndex()].mLabelId;this.InitObjectSet(tripleId,$GRAPH_OBJ_TYPE.GOT_AXIS_LABEL);formatFontPtr=this.mpAxisLabelSet.GetFormatFont();if(isGraphMatrix){if(xRotateLabel!==$FR.Automatic){formatFontPtr.mFontRotation=xRotateLabel;return ;}}len=ticks.length;yCoord=50;hasOverlap=false;perfOverlapRect.Reset(0,0,0,0);formatFontPtr.mFontRotation=$FR.Normal;if(!isGraphMatrix&&len>=2){if(this.mOptions.mUseMinValue){i=1;startIndex=1;}if(this.mOptions.mUseMaxValue){len--;}}var k,j=i,gmCtx=this.mChartContextPtr.GetGraphMatrixContext();for(k=0;i<len;i++){if(this.hasLabelCreated){oneLabel=this.mLabelList[i];}oneLabel=oneLabel||new $C.NumberObject({TripleId:tripleId,GraphObjectManager:this,Number:ticks[i],NumberFormat:this.mNumberFormat,GraphCollectionObject:this.mpAxisLabelSet,ShouldCondense:this.mCondenseLabels,ExpectCondense:this.mCondenseLabels});oneLabel.MoveTo(this.ValueToPosition(ticks[i]),yCoord,$AP.CENTER);currentRect=oneLabel.GetBoundingRect(true);if(i!==startIndex){if(isGraphMatrix){var fixEnd=(i===1&&axisOptions.mUseMinValue)||(i===len-1&&axisOptions.mUseMaxValue);if(!fixEnd){var checkBorder=1;hasOverlap=currentRect.HasIntersection(perfOverlapRect)||gmCtx.checkPaddingBetweenLabels(perfOverlapRect,currentRect,checkBorder,true);}}else{hasOverlap=currentRect.HasIntersection(perfOverlapRect);}}perfOverlapRect.ResetRect(currentRect);}this.hasLabelCreated=this.mpAxisLabelSet.GetCollectionSize()===len;if(hasOverlap){formatFontPtr.mFontRotation=isGraphMatrix?$FR.Rotate90:$FR.Rotate270;}else{formatFontPtr.mFontRotation=$FR.Normal;}this.maxLabelLength=this.fakeMaxLabelLength;if(this.maxLabelLength!==-1){this.restoreLabels(true);for(k=0;j<len;j++){oneLabel=this.mLabelList[j];oneLabel.MoveTo(this.ValueToPosition(ticks[j]),yCoord,$AP.CENTER);}}}function hIsDualAxisWithoutSplit(){switch(this.mChartContextPtr.GetGraphType()){case $GT.DssGraphTypeVertical_Area_DualAxis_Absolute:case $GT.DssGraphTypeVertical_Area_DualAxis_Stacked:case $GT.DssGraphTypeHorizontal_Area_DualAxis_Absolute:case $GT.DssGraphTypeHorizontal_Area_DualAxis_Stacked:case $GT.DssGraphTypeVertical_Bar_DualAxis_Side_by_Side:case $GT.DssGraphTypeVertical_Bar_DualAxis_Stacked:case $GT.DssGraphTypeHorizontal_Bar_DualAxis_Side_by_Side:case $GT.DssGraphTypeHorizontal_Bar_DualAxis_Stacked:case $GT.DssGraphTypeVertical_Line_DualAxis_Absolute:case $GT.DssGraphTypeVertical_Line_DualAxis_Stacked:case $GT.DssGraphTypeHorizontal_Line_DualAxis_Absolute:case $GT.DssGraphTypeHorizontal_Line_DualAxis_Stacked:case $GT.DssGraphTypeVertical_Bar_DualAxis_Absolute:case $GT.DssGraphTypeHorizontal_Bar_DualAxis_Absolute:return true;default:return false;}}function hHasAxisLine(){if(this.mUseDepth){return(hIsSecondaryAxis.call(this,this.mTripleId.mObjectId)===false||!(hIsDualAxisWithoutSplit.call(this)));}return this.mAxisInfo.mShowAxisLine;}function hCreateOneTickLabel(irTripleId,iTickValue){var label;label=new $C.NumberObject({TripleId:irTripleId,GraphObjectManager:this,Number:iTickValue,NumberFormat:this.mNumberFormat,GraphCollectionObject:this.mpAxisLabelSet,ShouldCondense:this.mCondenseLabels,ExpectedCondense:this.mCondenseLabels});this.mGraphObjectList.push(label);this.mpAxisLabelSet.AddGraphObject(label);}function hCreateTickLabels(){var ticks,tickCount,tripleId,i;ticks=[];this.GetTicks(ticks);tickCount=ticks.length;tripleId=this.mLabelObjectId;for(i=0;i<tickCount;++i){hCreateOneTickLabel.call(this,tripleId,ticks[i]);}}function hCheckValue(iorValue,iMin,iMax){var chartCtx=this.mChartContextPtr,options=this.mOptions,orMin=iMin,orMax=iMax;var customGraphMatrixMinMax=chartCtx.mIsGraphMatrix&&options.mUseCustomMinMax;if(!chartCtx.mIsTimeSeriesChart&&!customGraphMatrixMinMax){if(chartCtx.mIsGraphMatrix){var precisionTolerate=1e-9,maxOffsetRatio=Math.abs((iorValue-this.mMaxTick)/(this.mMaxTick-this.mMinTick));if((iorValue<this.mMinTick||(iorValue>this.mMaxTick&&maxOffsetRatio>precisionTolerate))&&options.mOffScaleType===$OST.DssGraphOffScaleHide){return{Flag:false,Value:iorValue,Min:orMin,Max:orMax};}if(iorValue>this.mMaxTick&&options.mOffScaleType===$OST.DssGraphOffScaleHide){iorValue=this.mMaxTick;}}else{if((iorValue<this.mMinTick||iorValue>this.mMaxTick)&&options.mOffScaleType===$OST.DssGraphOffScaleHide){return{Flag:false,Value:iorValue,Min:orMin,Max:orMax};}}if(options.mOffScaleType===$OST.DssGraphOffScaleClip){iorValue=(iorValue>this.mMaxTick)?this.mMaxTick:iorValue;iorValue=(iorValue<this.mMinTick)?this.mMinTick:iorValue;}}orMin=this.mMinTick;orMax=this.mMaxTick;if(this.IsLogarithmic()){if(iorValue<=0){return{Flag:false,Value:iorValue,Min:orMin,Max:orMax};}iorValue=log10.call(this,iorValue);orMin=log10.call(this,orMin);orMax=log10.call(this,orMax);}return{Flag:true,Value:iorValue,Min:orMin,Max:orMax};}function hGenerateInterlacedGrids(){}function hGetLineByValue(iValue){if(perfLowGridLinePoint===null){perfLowGridLinePoint=new $C.Point2D();}else{perfHighGridLinePoint.Reset(0,0);}if(perfHighGridLinePoint===null){perfHighGridLinePoint=new $C.Point2D();}else{perfHighGridLinePoint.Reset(0,0);}var orLowEnd=perfLowGridLinePoint,orHighEnd=perfHighGridLinePoint,deviceArea=this.mDeviceDataArea,x,y;x=this.IsVerticalAxis()?deviceArea.x:deviceArea.x+deviceArea.width;y=this.IsVerticalAxis()?deviceArea.y:deviceArea.y+deviceArea.height;orLowEnd.Reset(x,y);orHighEnd.Reset(deviceArea.x+deviceArea.width,deviceArea.y);if(this.IsVerticalAxis()){orLowEnd.y=this.ValueToPosition(iValue);orHighEnd.y=orLowEnd.y;}else{orLowEnd.x=this.ValueToPosition(iValue);orHighEnd.x=orLowEnd.x;}return{LowEnd:orLowEnd,HighEnd:orHighEnd};}function hAdjustTicks(){if(!this.mChartContextPtr.mIsGraphMatrix){return ;}var axisOptions=this.mOptions;if(axisOptions.mUseCustomMinMax||axisOptions.mUseLogarithmicScale){return ;}var fixMin=false,fixMax=false,ticks=[];this.GetTicks(ticks);if(ticks.length>=2){var size=ticks.length;fixMax=((Math.abs(this.mMaximum-ticks[size-2])<sTickOffsetRatio*this.mStep));fixMin=((Math.abs(this.mMinimum-ticks[1])<sTickOffsetRatio*this.mStep));if(this.mIsPercent){fixMax=false;}}if(fixMax&&fixMin){this.mMaxTick=this.mMaximum;this.mMinTick=this.mMinimum;axisOptions.mUseMinValue=true;axisOptions.mShowMinLabel=false;axisOptions.mUseMaxValue=true;axisOptions.mShowMaxLabel=false;}else{if(fixMax){this.mMaxTick=this.mMaximum;axisOptions.mUseMaxValue=true;axisOptions.mShowMaxLabel=false;}else{if(fixMin){this.mMinTick=this.mMinimum;axisOptions.mUseMinValue=true;axisOptions.mShowMinLabel=false;}else{kEmptyBlock++;}}}if(axisOptions.mAlwaysIncludeZero){this.mMaxTick=(this.mMaximum<0)?0:this.mMaxTick;this.mMinTick=(this.mMinimum>0)?0:this.mMinTick;}}function hAdjustAxisScale(){if(!this.mChartContextPtr.mIsGraphMatrix){return ;}if(this.mGraphMajorType===$GMT.GMT_BUBBLE&&this.mTripleId.mObjectId===$GO.DssGraphZBody){return ;}hAdjustTicks.call(this);}function hGetNumberFormatFromMetric(){var chartCtx=this.mChartContextPtr;if(!chartCtx.mIsGraphMatrix){return false;}var dataset=chartCtx.mDataset;if(!dataset){return false;}if(!this.mIsUniformAxis){var gmCtx=chartCtx.GetGraphMatrixContext();if(gmCtx.isPieOrRingShape()===false&&dataset.showDatalabels()===false){return true;}if(gmCtx.isPieOrRingShape()===true&&dataset.showPieDatalabels()===false){return true;}}if(this.mPrimaryMetrics){if(!!this.mNumberFormat.isDefault){this.mNumberFormat=new $C.ChartAdvFormat();}var isOk=dataset.getValueAxisNumberFormat(this.mNumberFormat,this.mPrimaryMetrics);if(this.mIsPercent===false){return isOk;}}var numberFormat=this.mNumberFormat;if(this.mIsPercent){numberFormat.mFormatType=4;numberFormat.mCustomFormat="0%";return true;}return false;}function hGetAxisLabelByTickValue(iValue){var i,lpMap,ret;for(i=0;i<2;i++){lpMap=(i===0)?this.mHighTicksToLabel:this.mLowTicksToLabel,ret=lpMap[iValue];if(ret&&ret.mIsShown){return ret;}}return null;}function hEnsureEndLabelsShown(highEnd,lowEnd){var bound,chartCtx=this.mChartContextPtr;if(chartCtx.mIsGraphMatrix){if(this.IsVerticalAxis()){if(lowEnd.y===chartCtx.mGraphHeight){--lowEnd.y;--highEnd.y;}}if(chartCtx.isUADataAreaOutput()){var padding2Chart=chartCtx.GetGraphMatrixContext().getPadding($K.kEndTickToChart),uaCtx=chartCtx.getUniformAxisContext();if(this.IsVerticalAxis()){if(uaCtx.mDataAreaRightMargin>=0){if(highEnd.x+uaCtx.mDataAreaRightMargin<=chartCtx.mGraphWidth){highEnd.x+=uaCtx.mDataAreaRightMargin;}else{highEnd.x=chartCtx.mGraphWidth;}}if(uaCtx.mDataAreaLeftMargin>=0){if(lowEnd.x>=uaCtx.mDataAreaLeftMargin){lowEnd.x-=uaCtx.mDataAreaLeftMargin;}}bound=chartCtx.mGraphHeight;if(Math.abs(lowEnd.y-bound)<padding2Chart||Math.abs(lowEnd.y)<padding2Chart){return false;}}else{if(uaCtx.mDataAreaBottomMargin>=0){if(lowEnd.y+uaCtx.mDataAreaBottomMargin<=chartCtx.mGraphHeight){lowEnd.y+=uaCtx.mDataAreaBottomMargin;}else{lowEnd.y=chartCtx.mGraphHeight;}}if(uaCtx.mDataAreaTopMargin>=0){if(highEnd.y>=uaCtx.mDataAreaTopMargin){highEnd.y-=uaCtx.mDataAreaTopMargin;}}bound=chartCtx.mGraphWidth;if(Math.abs(lowEnd.x)<padding2Chart||Math.abs(highEnd.x-bound)<padding2Chart){return false;}}}}return true;}function hGenerateGridByValue(irTripleId,iValue,ipGridLineSet,iIsMajor){var lowEnd,highEnd,gridStyle,tickLength,polyLine=[],chartCtx=this.mChartContextPtr,hasCreated=iIsMajor?this.hasMajorTickCreated:this.hasMinorTickCreated,R;if(iValue>this.mMaxTick||iValue<this.mMinTick){return ;}if(chartCtx.mIsGraphMatrix){if(this.mAxisInfo.mAxisDirection>=$AXIS_DIRECTION.AD_Z){return ;}if(chartCtx.isUADataAreaOutput()){var set=chartCtx.GetGraphMatrixContext().mShownValueTickSet[this.mAxisInfo.mAxisDirection];if(set[iValue]===undefined){return ;}}if(this.mIsUniformAxis){if(this.mAxisInfo.mShowAxisLabels===false){return ;}var label=hGetAxisLabelByTickValue.call(this,iValue);if(!label||!label.mIsShown){return ;}}}R=hGetLineByValue.call(this,iValue);lowEnd=R.LowEnd;highEnd=R.HighEnd;if(!hEnsureEndLabelsShown.call(this,highEnd,lowEnd)){return ;}gridStyle=iIsMajor?this.mMajorGrid.mGridStyle:this.mMinorGrid.mGridStyle;tickLength=Math.floor(iIsMajor?this.mTickLength:this.mTickLength*2/3+1);this.GetOneGridLine(this.mAxisInfo.mAxisLabelsLocation,gridStyle,tickLength,lowEnd,highEnd,polyLine);this.GenerateOneLineObject(irTripleId,polyLine,ipGridLineSet);if(this.HasTwoGridLineParts(gridStyle)){polyLine.splice(0,polyLine.length);this.GetOneGridLine(this.IsVerticalAxis()?$AXIS_LABEL_LOC.ALL_RIGHT:$AXIS_LABEL_LOC.ALL_TOP,gridStyle,tickLength,lowEnd,highEnd,polyLine);this.GenerateOneLineObject(irTripleId,polyLine,ipGridLineSet);}}function hSetOneTickToLabel(iIsOnHighSide,iValue,ipObject){var map=iIsOnHighSide?this.mHighTicksToLabel:this.mLowTicksToLabel;map[iValue]=ipObject;}function hBuildTickToLabelMap(iIsOnHighSide,iStartIndexInSet){var i,len=this.mpAxisLabelSet.GetCollectionSize(),map=iIsOnHighSide?this.mHighTicksToLabel:this.mLowTicksToLabel;map={};if(iStartIndexInSet<0||iStartIndexInSet>=len){return ;}for(i=iStartIndexInSet;i<len;i++){var tickPtr=this.mpAxisLabelSet.GetObjectByIndex(i);if(tickPtr){hSetOneTickToLabel.call(this,iIsOnHighSide,tickPtr.mNumber,tickPtr);}}}function hGetEvenSpacedPadding(isHighEnd,baseL){if(baseL<=0){return 0;}var axisOptions=this.mOptions,mMaxTick=this.mMaxTick,mMinTick=this.mMinTick,mMaximum=this.mMaximum,mMinimum=this.mMinimum,lOffset;if(axisOptions.mUseLogarithmicScale){mMaximum=mMaximum<=0?-1:log10.call(this,mMaximum);mMinimum=mMinimum<=0?-1:log10.call(this,mMinimum);mMaxTick=log10.call(this,mMaxTick);mMinTick=log10.call(this,mMinTick);}lOffset=isHighEnd?mMaxTick-mMaximum:mMinimum-mMinTick;lOffset=Math.abs(lOffset);return lOffset/(mMaxTick-mMinTick)*baseL;}function hGenerateMajorGrid(){var majorId,hasFrameBorder,V,i;if(this.mIsUniformAxis){majorId=this.mTripleId;}else{majorId=$C.gAxisObjects[this.getIndex()].mMajorId;}if(this.hasMajorTickCreated){this.clearTickObjects(majorId,true);this.hasMajorTickCreated=false;}this.InitObjectSet(majorId,$GRAPH_OBJ_TYPE.GOT_MAJOR_GRID);if(this.mChartContextPtr.mIsGraphMatrix){hGenerateGridByValue.call(this,majorId,this.mMinTick,this.mpMajorGridSet,true);hGenerateGridByValue.call(this,majorId,this.mMaxTick,this.mpMajorGridSet,true);}else{hasFrameBorder=true;V=this.mChartContextPtr.GetProperty($GP.DssGraphLineAlpha,new $C.TripleId({ObjectId:$GO.DssGraphFrame}));if(V){hasFrameBorder=(V>0);}if(!hasFrameBorder||this.mAxisInfo.mAxisDrawInReverse){hGenerateGridByValue.call(this,majorId,this.mMinTick,this.mpMajorGridSet,true);}if(!hasFrameBorder||!this.mAxisInfo.mAxisDrawInReverse){hGenerateGridByValue.call(this,majorId,this.mMaxTick,this.mpMajorGridSet,true);}}for(i=0;i<this.mTicks.length;++i){hGenerateGridByValue.call(this,majorId,this.mTicks[i],this.mpMajorGridSet,true);}this.hasMajorTickCreated=true;}function hGenerateMinorGrid(){var minorCount,options=this.mOptions,minorId,step,i,j;minorCount=1;if(options.mUseLogarithmicScale){minorCount=8;}else{if(this.mMinorGrid.mUseManualGrid){minorCount=Math.floor(this.mMinorGrid.mGridInterval);}}if(this.mIsUniformAxis){minorId=this.mTripleId;}else{minorId=$C.gAxisObjects[this.getIndex()].mMinorId;}if(this.hasMinorTickCreated){this.clearTickObjects(minorId,false);this.hasMinorTickCreated=false;}this.InitObjectSet(minorId,$GRAPH_OBJ_TYPE.GOT_MINOR_GRID);step=this.mStep/(minorCount+1);for(i=0;i<this.mTicks.length;++i){step=options.mUseLogarithmicScale?this.mTicks[i]:step;for(j=1;j<=minorCount;++j){hGenerateGridByValue.call(this,minorId,this.mTicks[i]+j*step,this.mpMinorGridSet,false);}}if(this.mTicks.length===0){step=Math.floor(options.mUseLogarithmicScale?this.mMinTick:(this.mMaxTick-this.mMinTick)/(minorCount+1));for(j=1;j<=minorCount;++j){hGenerateGridByValue.call(this,minorId,this.mMinTick+j*step,this.mpMinorGridSet,false);}return ;}step=options.mUseLogarithmicScale?this.mMinTick:step;for(j=1;j<=minorCount;++j){hGenerateGridByValue.call(this,minorId,this.mTicks[0]-j*step,this.mpMinorGridSet,false);}this.hasMinorTickCreated=true;}function hFilterRepeatedLabels(){if(this.mpAxisLabelSet===null){return ;}if(this.mCondenseLabels!==true){return ;}var i=this.mpAxisLabelSet.GetCollectionSize()-1,refDisplay,refLabel=null,firstLoop=true,thisValue,thisLabel,numberFromText,diff=0;while(i>=0){thisLabel=this.mpAxisLabelSet.GetObjectByIndex(i);thisValue=0;if(thisLabel.mIsShown){if(firstLoop){refDisplay=thisLabel.mText;refLabel=thisLabel;firstLoop=false;numberFromText=refLabel.GetNumberFromText();if(numberFromText!==null){thisValue=numberFromText;diff=Math.abs(thisValue-refLabel.mNumber);}}else{var display=thisLabel.mText;if(display===refDisplay){if(refLabel.mIsShown){if(diff>0){refLabel.mIsShown=false;}}numberFromText=thisLabel.GetNumberFromText();if(numberFromText!==null){thisValue=numberFromText;if(Math.abs(thisValue-thisLabel.mNumber)>0){thisLabel.mIsShown=false;}}else{thisLabel.mIsShown=false;}}else{refDisplay=display;refLabel=thisLabel;numberFromText=refLabel.GetNumberFromText();if(numberFromText){thisValue=numberFromText;diff=Math.abs(thisValue-thisLabel.mNumber);}else{diff=0;}}}}i--;}}function hUpdateShownTicksToGMContext(){var chartCtx=this.mChartContextPtr;if(chartCtx.mIsGraphMatrix&&!chartCtx.isUADataAreaOutput()){if(this.mAxisInfo.mAxisDirection>=$AXIS_DIRECTION.AD_Z){return ;}var gmCtx=chartCtx.GetGraphMatrixContext(),oneSet=gmCtx.mShownValueTickSet[this.mAxisInfo.mAxisDirection]={},setShownValueTick=function(array){$HASH.forEach(array,function(v){if(v.mIsShown){oneSet[v]=true;}});};setShownValueTick(this.mHighTicksToLabel);setShownValueTick(this.mLowTicksToLabel);}}function hIsTickPositionFitForRotatedLabelPadding(tickValue,labelPadding,fontSize){var position=this.ValueToFloatPosition(tickValue),paddingOnSide=labelPadding+0.5*fontSize,chartCtx=this.mChartContextPtr;if(position>=paddingOnSide&&position+paddingOnSide<=chartCtx.mGraphWidth){return true;}return false;}function canAccomodateOneLabel(){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),deviceArea=this.mDeviceDataArea,isVeritcal=this.IsVerticalAxis(),space,formatFont=this.mpAxisLabelSet.mFormatFontPtr,kPaddings=gmCtx.getPadding($K.kEndLabelToChart);if(isVeritcal){space=Math.max(deviceArea.height,chartCtx.mGraphHeight);}else{space=Math.max(deviceArea.width,chartCtx.mGraphWidth);}if(space<formatFont.mFontSize+2*kPaddings){return false;}if(space<formatFont.GetStringHeight("H")+2*kPaddings){return false;}if(deviceArea.width>=0&&deviceArea.height>0){var ticks=[];this.GetTicks(ticks);var i,len=ticks.length;for(i=0;i<len;i++){if(hIsTickPositionFitForRotatedLabelPadding.call(this,ticks[i],kPaddings,formatFont.mFontSize)===true){return true;}}}return true;}function hReserveAreaAtTop(iReservedHeight){if(this.mOptions.mUseMaxValue||iReservedHeight>this.mDeviceDataArea.height){return false;}var tick,newMaxTick=(this.mMaxTick-this.mMinTick)/(this.mDeviceDataArea.height-iReservedHeight)*this.mDeviceDataArea.height;for(tick=this.mMaxTick;tick<newMaxTick;tick+=this.mStep){this.mTicks.push(tick);}this.mMaxTick=newMaxTick;return true;}function hGetRequiredPaddingAtTwoEnds(isCustMinMax){var chartCtx=this.mChartContextPtr,H=0,L=0;if(chartCtx.mIsGraphMatrix){L=H=chartCtx.GetGraphMatrixContext().getPadding($K.kChartToChart);if(isCustMinMax){L=H=0;}else{if(this.mMaxTick<=0){H=0;}if(this.mMinTick>=0){L=0;}}}return{LowPadding:L,HighPadding:H};}function hGetGMAffiliatePadding(){var chartCtx=this.mChartContextPtr,R=0,gmCtx=chartCtx.GetGraphMatrixContext(),grpCount=chartCtx.mDataset.GetGroupCount();if(chartCtx.mIsGraphMatrix===false){return 0;}if(gmCtx.isCombinationChart()){var allShapes=chartCtx.mDataset.GetSeriesByShape();if(allShapes.Circle&&allShapes.Circle.length){return gmCtx.getPadding($K.kExtra);}if(allShapes.Square&&allShapes.Square.length){return gmCtx.getPadding($K.kExtra);}if(allShapes.Circle&&allShapes.Circle.length){return gmCtx.getPadding($K.kExtra);}if((allShapes.Line&&allShapes.Line.length)||(allShapes.Area&&allShapes.Area.length)){if(grpCount===1){return gmCtx.getPadding($K.kExtra);}}return 0;}switch(chartCtx.GetGraphMatrixGraphMajorType()){case $GM_MT._BUBBLE:case $GM_MT._SCATTER:case $GM_MT._PIE:R=gmCtx.getPadding($K.kExtra);break;case $GM_MT._LINE:case $GM_MT._AREA:if(grpCount===1||gmCtx.mMarkerShape!==$MS.DssGraphMarkerShapeNone){R=gmCtx.getPadding($K.kExtra);}break;}return R;}function hComputeHighAndLowPadding(useFixedMargin,iBaseLength,iHighPadding,iLowPadding){var chartCtx=this.mChartContextPtr,extraPd=0,highDelta=0,lowDelta=0,computedHighPadding=0,computedLowPadding=0,pursuedHigh=0,pursuedLow=0,highPd=iHighPadding,lowPd=iLowPadding,isPrimary=this.mTripleId.mObjectId===$GO.DssGraphY1Body||this.mTripleId.mObjectId===$GO.DssGraphX1Body,isX=this.mAxisInfo.mAxisDirection===$AXIS_DIRECTION.AD_X,isCustMinMax=this.mOptions.mUseCustomMinMax,needCalPaddingMin=!isCustMinMax||(isCustMinMax&&!this.mOptions.mUseMinValue),needCalPaddingMax=!isCustMinMax||(isCustMinMax&&!this.mOptions.mUseMaxValue),uaCtx=chartCtx.mUniformAxisContext,gmCtx=chartCtx.GetGraphMatrixContext();if(needCalPaddingMax){extraPd=hGetGMAffiliatePadding.call(this);pursuedHigh=gmCtx.GetValueAxisPadding(isX,true,isPrimary);pursuedHigh=pursuedHigh>0?pursuedHigh+extraPd:pursuedHigh;highDelta=hGetEvenSpacedPadding.call(this,true,iBaseLength-pursuedHigh-pursuedLow);computedHighPadding=pursuedHigh-highDelta;highPd=Math.max(highPd,computedHighPadding);}if(needCalPaddingMin){extraPd=hGetGMAffiliatePadding.call(this);pursuedLow=gmCtx.GetValueAxisPadding(isX,false,isPrimary);pursuedLow=pursuedLow>0?pursuedLow+extraPd:pursuedLow;lowDelta=hGetEvenSpacedPadding.call(this,false,iBaseLength-pursuedHigh-pursuedLow);computedLowPadding=pursuedLow-lowDelta;lowPd=Math.max(lowPd,computedLowPadding);}var padding=0,highMargin=isX?uaCtx.mDataAreaRightMargin:uaCtx.mDataAreaTopMargin,lowMargin=isX?uaCtx.mDataAreaLeftMargin:uaCtx.mDataAreaBottomMargin;if(!useFixedMargin){padding=highPd;if(highMargin>=0&&highMargin<padding){highPd=padding-highMargin;}else{highPd=0;}padding=lowPd;if(lowMargin>=0&&lowMargin<padding){lowPd=padding-lowMargin;}else{lowPd=0;}}return{HighPadding:highPd,LowPadding:lowPd};}function hTrimPaddingFromRect(iUseFixedMargin,iHighPadding,iLowPadding,iorRect){var low=iLowPadding,high=iHighPadding,length=(this.mAxisInfo.mAxisDirection===$AXIS_DIRECTION.AD_X)?iorRect.width:iorRect.height;if(low<0){low=0;}if(high<0){high=0;}if(length<=0||length<low+high){return ;}length-=low+high;this.mLowTrim=low;this.mHighTrim=high;if(!iUseFixedMargin){this.mIsTrimmedWithPadding=true;}if(this.mAxisInfo.mAxisDirection===$AXIS_DIRECTION.AD_X){iorRect.x+=low;iorRect.width=length;}if(this.mAxisInfo.mAxisDirection===$AXIS_DIRECTION.AD_Y){iorRect.y+=high;iorRect.height=length;}}function hGetMaxScaleRange(){if(this.mChartContextPtr.mIsGraphMatrix&&this.mOptions.mUseCustomMinMax){return sMaxPosition;}return 32757;}function hHideLabelsFromHighEnd(iLastIndex,iIsFromHigh){var chartCtx=this.mChartContextPtr,low=0,high=iLastIndex-1;if(!chartCtx.mIsGraphMatrix){return -1;}if(this.mIsPercent&&!this.mOptions.mUseCustomMinMax){if(iIsFromHigh&&this.mMaxTick===1){return high;}if(this.mMinTick===-1){return low;}}var label,padding=chartCtx.GetGraphMatrixContext().getPadding($K.kEndLabelToChart),objectList=this.mGraphObjectList;if(iIsFromHigh){while(high>=0){label=objectList[high];if(!label.mIsShown){high--;continue;}if(hIsLabelFitWithPadding.call(this,label,padding)){return high;}label.mIsShown=false;high--;}}else{while(low<=high){label=objectList[low];if(!label.mIsShown){low++;continue;}if(hIsLabelFitWithPadding.call(this,label,padding)){return low;}label.mIsShown=false;low++;}}return -1;}function hComputeLabelSkipStep(iSkipFromHighEnd,startIndex,endIndex,refLabelIndex,expDirection){var overlapped=true,isGM=this.mChartContextPtr.mIsGraphMatrix,isGMPercent=isGM&&this.mIsPercent,step=1,span=this.mLabelSpan,options=this.mOptions,objectList=this.mGraphObjectList,refLabel=objectList[refLabelIndex],previousLabel=refLabel;while(overlapped){overlapped=false;var i=isGMPercent?refLabelIndex-step:refLabelIndex+step,isOk=isGMPercent?(i>=startIndex):(i<endIndex);while(isOk){var thisLabel=objectList[i];if(thisLabel.HasOverlapForSameRotation(previousLabel,span,expDirection)){overlapped=true;previousLabel=refLabel;++step;break;}else{previousLabel=thisLabel;}i+=isGMPercent?-step:step;isOk=isGMPercent?(i>=startIndex):(i<endIndex);}}var labelCount=this.mIsPercent?(refLabelIndex-startIndex)/step:(endIndex-refLabelIndex)/step;labelCount=Math.floor(labelCount);if(labelCount<3){return step;}var labelNumber,extraPadding,L=hHideLabelsFromHighEnd.call(this,endIndex,false),H=hHideLabelsFromHighEnd.call(this,endIndex,true);if(L===-1||H===-1){return step;}if(this.mIsPercent){if(L<=refLabelIndex-labelCount*step){return step;}if(L===0&&options.mUseMinValue&&options.mShowMinLabel&&this.mMinTick!==-1){L++;}labelNumber=(refLabelIndex-L)/step;extraPadding=(refLabelIndex-labelNumber*step)-L;step+=extraPadding/labelNumber;}else{if(H>=refLabelIndex+labelCount*step){return step;}labelNumber=(H-refLabelIndex)/step;extraPadding=H-(refLabelIndex+labelNumber*step);step+=Math.floor(extraPadding/labelNumber);}return step;}function hShowOrHideAroundMax(startIdx,endIdx,refIdx,step,expDir){var maxLabel,chartCtx=this.mChartContextPtr,isGM=chartCtx.mIsGraphMatrix,isTS=chartCtx.mIsTimeSeriesChart;if(this.mOptions.mShowMaxLabel){if((!isGM&&!isTS)||(isGM&&this.mIsPercent)){var lastLabelOffset=((endIdx-1-refIdx)%step);if(lastLabelOffset!==0){maxLabel=this.mGraphObjectList[endIdx-1];maxLabel.mIsShown=true;var lIndex=endIdx-1-lastLabelOffset,lpPreMaxLabel=this.mGraphObjectList[lIndex];if(maxLabel.HasOverlapForSameRotation(lpPreMaxLabel,this.mLabelSpan,expDir)&&(lIndex>startIdx||!this.mOptions.mShowMinLabel)){lpPreMaxLabel.mIsShown=false;}}}else{if(isGM&&this.mOptions.mUseMaxValue&&endIdx-startIdx>2){maxLabel=this.mGraphObjectList[endIdx-1];maxLabel.mIsShown=false;}}}}function hShowOrHideAroundMin(startIdx){var minLabel,isGM=this.mChartContextPtr.mIsGraphMatrix;if(this.mOptions.mShowMinLabel){if(isGM){if(this.mIsPercent&&this.mMinTick===-1){minLabel=this.mGraphObjectList[startIdx];minLabel.mIsShown=true;}else{if(this.mIsPercent&&this.mOptions.mUseMinValue){minLabel=this.mGraphObjectList[startIdx];minLabel.mIsShown=false;}}}}}function hHideLabelsAtStep(labelStep,start,end,weekOrder,positiveSearch,refIndex,fn){var i=start,step=positiveSearch?1:-1,distance=0,isOk=positiveSearch?(weekOrder?i-end<=0:i-end<0):(weekOrder?i-end>=0:i-end>0);while(isOk){if(positiveSearch){distance=i-refIndex;}else{distance=refIndex-i;}if(distance%labelStep!==0){this.mGraphObjectList[i].mIsShown=false;}else{if(fn&&fn(i,labelStep,start,end)){this.mGraphObjectList[i].mIsShown=false;}}i+=step;isOk=positiveSearch?(weekOrder?i-end<=0:i-end<0):(weekOrder?i-end>=0:i-end>0);}}function hHideLabelsWithStep(iSkipFromHighEnd,iStartIndex,iEndIndex,iReflabeIndex,iLabelStep){var labelStep=iLabelStep,equal=function(a,b,c,d){return a===d;},less=function(a,b,c,d){return a<b+d;};if(this.mChartContextPtr.mIsGraphMatrix&&this.mIsPercent){if(this.mMinTick===-1){if(this.mMaxTick===0){hHideLabelsAtStep.call(this,labelStep,iStartIndex,iReflabeIndex,true,true,0,equal);}else{var labelsNum=(iReflabeIndex-iStartIndex)/iLabelStep,newLabelStep=(iReflabeIndex-iStartIndex)/labelsNum;hHideLabelsAtStep.call(this,newLabelStep,iReflabeIndex-1,iStartIndex,false,false,iReflabeIndex,less);labelStep=newLabelStep;}}else{hHideLabelsAtStep.call(this,labelStep,iReflabeIndex-1,iStartIndex,true,false,iReflabeIndex);}}else{hHideLabelsAtStep.call(this,labelStep,iReflabeIndex+1,iEndIndex,false,true,iReflabeIndex);}return labelStep;}function hGenerateOneCustomLine(iorGraphObjectList,iCustomValue,iCustomLineId){if(iCustomValue>this.mMaxTick||iCustomValue<this.mMinTick){return ;}var lowEnd={},highEnd={},returnVal,isOnBorder=false,polyLine=[];returnVal=hGetLineByValue.call(this,iCustomValue);lowEnd.x=returnVal.LowEnd.x;lowEnd.y=returnVal.LowEnd.y;highEnd.x=returnVal.HighEnd.x;highEnd.y=returnVal.HighEnd.y;var chartCtx=this.mChartContextPtr;if(chartCtx.mIsGraphMatrix){if(this.IsVerticalAxis()){isOnBorder=lowEnd.y===chartCtx.mGraphHeight||lowEnd.y===0;}else{isOnBorder=lowEnd.x===chartCtx.mGraphWidth||lowEnd.x===0;}}if(isOnBorder){return ;}if(chartCtx.mIsGraphMatrix){if(this.IsVerticalAxis()){lowEnd.x=Math.min(lowEnd.x,0);highEnd.x=Math.max(highEnd.x,chartCtx.mGraphWidth);}else{highEnd.y=Math.min(highEnd.y,0);lowEnd.y=Math.max(lowEnd.y,chartCtx.mGraphHeight);}}if(this.mUseDepth){if((this.IsVerticalAxis()&&this.IsLeftDirection())||(!this.IsVerticalAxis()&&this.IsDownDirection())){lowEnd.swapPoints(highEnd);}polyLine.push(highEnd.Shifted(this.mDepthOffset));}polyLine.push(highEnd);polyLine.push(lowEnd);var tripleId=new $C.TripleId({ObjectId:iCustomLineId,SeriesId:0,GroupId:0}),customLineSetPtr;if(this.mTripleId.mSeriesId>0){customLineSetPtr=this.mpManager.GetGraphObject(tripleId,false);}if(!customLineSetPtr){customLineSetPtr=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$COLLECTION_TYPE.CT_LINE});this.mpManager.AddToMap(customLineSetPtr);}var customLinePtr=new $C.PolyLineObject({TripleId:tripleId,GraphObjectManager:this,PolyLine:polyLine,GraphCollectionObject:customLineSetPtr});customLineSetPtr.AddGraphObject(customLinePtr);iorGraphObjectList.push(customLinePtr);}function hComputeTicks(){this.mTicks.splice(0,this.mTicks.length);var result=$GMUTIL.computeTicksForAxis(this);this.mMaxTick=result.mMaxTick;this.mMinTick=result.mMinTick;this.mTicks=result.mTicks;this.mStep=result.mStep;}function hGetMaxLabelWidthOrHeight(iIsWidth){var maxWorH,ticksCount,i,label;maxWorH=0;ticksCount=this.mTicks.length+(this.mOptions.mShowMinLabel?1:0)+(this.mOptions.mShowMaxLabel?1:0);for(i=0;i<ticksCount;++i){label=this.mGraphObjectList[i+this.mLabelStartIndex];label.GetBoundingRectEx(perfMaxWidthHeightRect);if(iIsWidth){maxWorH=(maxWorH<perfMaxWidthHeightRect.width)?perfMaxWidthHeightRect.width:maxWorH;}else{maxWorH=(maxWorH<perfMaxWidthHeightRect.height)?perfMaxWidthHeightRect.height:maxWorH;}}return maxWorH;}function hUpdateOneLabelLocation(iGraphObjectIndex,iLabelLocation,iTickValue){var textObject,depthOffset,depthOffsetX,depthOffsetY,isOk=true,labelArea=this.mLabelArea;textObject=this.mGraphObjectList[iGraphObjectIndex];if(!!textObject===false){return ;}if(this.mUseDepth){depthOffset=new $C.Point2D();this.GetLabelOffset(iLabelLocation,depthOffset);depthOffsetX=depthOffset.x;depthOffsetY=depthOffset.y;}else{depthOffsetX=depthOffsetY=0;}if(perfLabelPosition===null){perfLabelPosition=new $C.Point2D();}else{perfLabelPosition.Reset(0,0);}if(perfVector2D===null){perfVector2D=new $C.Point2D();}else{perfVector2D.Reset(1,0);}switch(iLabelLocation){case $AXIS_LABEL_LOC.ALL_BOTTOM:case $AXIS_LABEL_LOC.ALL_BOTTOM_TOP:perfLabelPosition.x=this.ValueToPosition(iTickValue)+depthOffsetX;perfLabelPosition.y=labelArea.y+labelArea.height;perfVector2D.x=0;perfVector2D.y=1;break;case $AXIS_LABEL_LOC.ALL_TOP:perfLabelPosition.x=this.ValueToPosition(iTickValue)+depthOffsetX;perfLabelPosition.y=labelArea.y;perfVector2D.x=0;perfVector2D.y=-1;break;case $AXIS_LABEL_LOC.ALL_LEFT:case $AXIS_LABEL_LOC.ALL_LEFT_RIGHT:perfLabelPosition.x=labelArea.x;perfLabelPosition.y=this.ValueToPosition(iTickValue)+depthOffsetY;perfVector2D.x=-1;perfVector2D.y=0;break;case $AXIS_LABEL_LOC.ALL_RIGHT:perfLabelPosition.x=labelArea.x+labelArea.width;perfLabelPosition.y=this.ValueToPosition(iTickValue)+depthOffsetY;perfVector2D.x=1;perfVector2D.y=0;break;default:isOk=false;break;}if(isOk){this.MoveLabel(textObject,perfLabelPosition,perfVector2D);}}function hUpdateLabelLocation(){var i,ticks=[],staggerLabelArea,normalLabelArea,staggerOffset,tickSize;this.GetTicks(ticks);if(ticks.length===0){return ;}staggerLabelArea=new $C.Rect2D({Rect2D:this.mLabelArea});if(this.mIsStagger){staggerOffset=hGetMaxLabelWidthOrHeight.call(this,this.IsVerticalAxis());if(this.IsVerticalAxis()){staggerLabelArea.x-=staggerOffset;staggerLabelArea.width+=staggerOffset*2;}else{staggerLabelArea.x-=staggerOffset;staggerLabelArea.height+=staggerOffset*2;}}else{var isSpaceEnough,space,oneLetterSpace=3,objectList=this.mGraphObjectList,len=objectList.length;if(this.hasLabelCreated){space=this.IsVerticalAxis()?this.mLabelArea.height:this.mLabelArea.width;space-=this.mChartContextPtr.GetGraphMatrixContext().getPadding($K.kEndLabelToChart)+4;isSpaceEnough=space>oneLetterSpace;if(isSpaceEnough===false){for(i=0;i<len;i++){objectList[i].mIsShown=false;}return ;}}}normalLabelArea=new $C.Rect2D({Rect2D:this.mLabelArea});tickSize=ticks.length;for(i=0;i<tickSize;++i){this.mLabelArea=(i&1)===0?normalLabelArea:staggerLabelArea;hUpdateOneLabelLocation.call(this,i+this.mLabelStartIndex,this.mAxisInfo.mAxisLabelsLocation,ticks[i]);}this.HideOverlappedLabels(this.mLabelStartIndex,this.mLabelStartIndex+ticks.length);if(this.HasLabelsOnBothSides()){for(i=0;i<tickSize;++i){this.mLabelArea=(i&1)===0?normalLabelArea:staggerLabelArea;hUpdateOneLabelLocation.call(this,i+tickSize+this.mLabelStartIndex,this.IsVerticalAxis()?$AXIS_LABEL_LOC.ALL_RIGHT:$AXIS_LABEL_LOC.ALL_TOP,ticks[i]);}this.HideOverlappedLabels(this.mLabelStartIndex+tickSize,this.mLabelStartIndex+2*tickSize);}hUpdateShownTicksToGMContext.call(this);}function hPickStartLabelIndex(iStartIndex,iEndIndex){var label,chartCtx=this.mChartContextPtr,isGM=chartCtx.mIsGraphMatrix,proposed=iStartIndex+(hIsManualMinShown.call(this)||isGM?1:0),possible=false,labelList=this.mLabelList,len=labelList.length,padding=chartCtx.GetGraphMatrixContext().getPadding($K.kLabelToChart),i;for(i=proposed;i<len;i++){label=labelList[i];if(hIsLabelFitWithPadding.call(this,label,padding)){possible=true;break;}}if(!isGM){return{Start:proposed,PaddingPossible:possible};}if(this.mIsPercent){return{Start:iEndIndex-1,PaddingPossible:possible};}if(possible){return{Start:i,PaddingPossible:possible};}return{Start:proposed,PaddingPossible:possible};}function hGetLabelMargins(){var Low=0,High=0,label,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),axisOptions=this.mOptions,axisInfo=this.mAxisInfo,deviceArea=this.mDeviceDataArea,position;if(this.mLabelStartIndex>=this.mGraphObjectList.length){return{LowMargin:Low,HighMargin:High};}if(axisOptions.mUseCustomMinMax){return{LowMargin:Low,HighMargin:High};}if(this.mUseDepth){this.ReserveDepthAxisLine(deviceArea,false,this.mTripleId.mObjectId!==$GO.DssGraphX1Body);}perfLabelMarginRect.Reset(0,0,0,0);label=this.mLabelList[this.mLabelStartIndex];label.GetBoundingRectEx(perfLabelMarginRect);position=this.ValueToPosition(label.mNumber);if(axisInfo.mAxisDrawInReverse){High=this.IsVerticalAxis()?perfLabelMarginRect.height/2-(position-deviceArea.y):perfLabelMarginRect.width/2-(deviceArea.x+deviceArea.width-position);High=(High<0)?0:High;}else{if(chartCtx.mIsGraphMatrix){if(this.mIsPercent&&this.mMinTick===-1){Low=this.IsVerticalAxis()?perfLabelMarginRect.height/2-(deviceArea.y+deviceArea.height-position):perfLabelMarginRect.width/2-(position-deviceArea.x);Low+=gmCtx.getPadding($K.kLabelToChart);}else{Low=0;}Low=Math.max(Low,0);}else{Low=this.IsVerticalAxis()?perfLabelMarginRect.height/2-(deviceArea.y+deviceArea.height-position):perfLabelMarginRect.width/2-(position-deviceArea.x);Low=(Low<0)?0:Low;}}perfLabelMarginRect.Reset(0,0,0,0);label=this.mLabelList[this.mLabelList.length-1];label.GetBoundingRectEx(perfLabelMarginRect);position=this.ValueToPosition(label.mNumber);if(!axisInfo.mAxisDrawInReverse){High=this.IsVerticalAxis()?perfLabelMarginRect.height/2-(position-deviceArea.y):perfLabelMarginRect.width/2-(deviceArea.x+deviceArea.width-position);if(chartCtx.mIsGraphMatrix){if(this.mIsPercent&&this.mMaxTick===1){High+=gmCtx.getPadding($K.kLabelToChart);}else{High=0;}}High=(High<0)?0:High;}else{Low=this.IsVerticalAxis()?perfLabelMarginRect.height/2-(deviceArea.y+deviceArea.height-position):perfLabelMarginRect.width/2-(position-deviceArea.x);Low=(Low<0)?0:Low;}if(!this.mUseDepth){return{LowMargin:Low,HighMargin:High};}var depthMargin=this.getDepthMargin(0,0);Low=(Low<depthMargin.lowMargin)?0:Low-depthMargin.lowMargin;High=(High<depthMargin.highMargin)?0:High-depthMargin.highMargin;return{LowMargin:Low,HighMargin:High};}function hIsLabelFitWithPadding(ipTextLabel,iPadding){var chartCtx=this.mChartContextPtr,rect=ipTextLabel.GetBoundingRect(true);if(this.IsVerticalAxis()){return(rect.y>=iPadding&&rect.y+rect.height+iPadding<=chartCtx.mGraphHeight);}return(rect.x>=iPadding&&rect.x+rect.width+iPadding<=chartCtx.mGraphWidth);}function manglingMaxMin(axisOptions){var chartCtx=this.mChartContextPtr;if(axisOptions.mDrawCustomLine){this.mMinimum=Math.min(this.mMinimum,axisOptions.mAxisCustomValue);this.mMaximum=Math.max(this.mMaximum,axisOptions.mAxisCustomValue);}if(this.mIsPercent&&this.mMinimum===this.mMaximum&&1===this.mMaximum){if(this.mMinimum===1){this.mMinimum=0;}}if(Math.abs(this.mMinimum-this.mMaximum)<sTolerance){var isGM=chartCtx.mIsGraphMatrix;if(this.mMinimum<-sTolerance||this.mMinimum>sTolerance){var temp=Math.abs(this.mMinimum)*0.5;if(isGM===false){this.mMaximum=this.mMaximum+temp;this.mMinimum=this.mMinimum-temp;}else{if(this.mMaximum>0){this.mMinimum=0;}else{this.mMaximum=0;}}}else{if(isGM===false||isGM&&this.mMinimum!==this.mMaximum){this.mMinimum=-6;this.mMaximum=6;}}}}mstrmojo.chart.ValueAxis=mstrmojo.declare(mstrmojo.chart.Axis,null,{scriptClass:"mstrmojo.chart.ValueAxis",mLargerGridInterval:false,mIsPercent:false,mMinimum:-1,mMaximum:-1,mMaxTick:-1,mMinTick:-1,mStep:-1,mLabelStartIndex:0,mTicks:null,mLabelSpan:0,mIsStagger:false,mNumberFormat:null,mLabelArea:null,mGraphMajorType:$GMT.GMT_CATEGORY,mLabelObjectId:null,mIsMaxZoom:false,mPrimaryMetrics:-1,mHighTicksToLabel:null,mLowTicksToLabel:null,mIsTrimmedWithPadding:false,mCondenseLabels:null,init:function init(props){props.AxisLabelsLocation=$AXIS_LABEL_LOC.ALL_LEFT;this._super(props);this.mOptions={mUseLogarithmicScale:false,mAlwaysIncludeZero:true,mDrawFromZero:true,mUseMinValue:false,mUseMaxValue:false,mShowMinLabel:true,mShowMaxLabel:true,mDrawCustomLine:false,mDrawSecondCustomLine:false,mUseSmartScaleBreak:false,mOffScaleType:$OST.DssGraphOffScaleHide,mAxisMinValue:0,mAxisMaxValue:0,mAxisCustomValue:0,mAxisSecondCustomValue:0,mUseCustomMinMax:false};var temp,chartCtx=this.mChartContextPtr,objectId=this.mTripleId.mObjectId;this.mTicks=[];this.mHighTicksToLabel={};this.mLowTicksToLabel={};this.mLargerGridInterval=props.LargerGridInterval;this.mIsPercent=props.IsPercent;this.mMinimum=Math.min(props.Max,props.Min);this.mMaximum=Math.max(props.Max,props.Min);this.mLabelStartIndex=0;this.mIsStagger=false;this.mLabelObjectId=null;this.mIsMaxZoom=false;if(props.IsShown!==null){this.mIsShown=props.IsShown;}if(chartCtx.mIsTimeSeriesChart){this.mIsShown=true;}if(chartCtx.mIsUniformAxisMode){this.mIsShown=!chartCtx.isUADataAreaOutput();}if(this.mIsUniformAxis||chartCtx.mIsGraphMatrix===false){this.mNumberFormat=new $C.ChartAdvFormat({});}else{this.mNumberFormat=$C.dNF;}if(props.PrimaryMetricIndex!==null){this.mPrimaryMetrics=props.PrimaryMetricIndex;}else{this.mPrimaryMetrics=[];}if(this.mDeviceDataArea===null){this.mDeviceDataArea=new $C.Rect2D();this.mDeviceDataArea.width=this.mDeviceDataArea.height=-1;}this.mGraphMajorType=chartCtx.GetGraphMajorType();if(this.mIsUniformAxis===false){if(this.mGraphMajorType===$GMT.GMT_HISTOGRAM){this.mIsShown=this.mIsShown||(this.mTripleId.mObjectId===$GO.DssGraphY1Body);if(this.mTripleId.mObjectId===$GO.DssGraphX1Body){this.mMaximum+=(this.mMinimum===this.mMaximum)?10:(this.mMaximum-this.mMinimum)*0.01;}}}var axisInfo=this.mAxisInfo,axisOptions=this.mOptions,gmCtx=chartCtx.GetGraphMatrixContext(),axisLayout=gmCtx.AxisLayout;if(props.AxisDirection===$AXIS_DIRECTION.AD_Y){if(objectId!==$GO.DssGraphY1Body){axisInfo.mAxisLabelsLocation=$AXIS_LABEL_LOC.ALL_RIGHT;}else{if(chartCtx.IsBubbleChart()||chartCtx.IsScatterChart()){var y2=4;if(axisLayout&y2){axisInfo.mAxisLabelsLocation=$AXIS_LABEL_LOC.ALL_RIGHT;}}}}else{if(props.AxisDirection===$AXIS_DIRECTION.AD_X){if(objectId===$GO.DssGraphY1Body||objectId===$GO.DssGraphX1Body){axisInfo.mAxisLabelsLocation=$AXIS_LABEL_LOC.ALL_BOTTOM;if(chartCtx.IsBubbleChart()||chartCtx.IsScatterChart()){var x2=8;if(axisLayout&x2){axisInfo.mAxisLabelsLocation=$AXIS_LABEL_LOC.ALL_TOP;}}}else{axisInfo.mAxisLabelsLocation=$AXIS_LABEL_LOC.ALL_TOP;}}}this.hLoadProperties();manglingMaxMin.call(this,axisOptions);hComputeTicks.call(this);if(axisOptions.mUseLogarithmicScale&&chartCtx.IsStackedChart()){this.mMaximum=axisOptions.mDrawCustomLine?Math.max(this.mMaximum+this.mMinTick,axisOptions.mAxisCustomValue):this.mMaximum+this.mMinTick;this.mMinimum=Math.min(this.mMinimum,0);this.mTicks.splice(0,this.mTicks.length);var result=$GMUTIL.computeTicksForLogScale(this);this.mMaxTick=result.mMaxTick;this.mMinTick=result.mMinTick;this.mTicks=result.mTicks;this.mStep=result.mStep;}hAdjustAxisScale.call(this);},IsBaseAtZero:function IsBaseAtZero(){var axisOptions=this.mOptions;return axisOptions.mDrawFromZero&&!axisOptions.mUseLogarithmicScale;},hLoadProperties:function hLoadProperties(){var chartCtx=this.mChartContextPtr,isGraphMatrix=chartCtx.mIsGraphMatrix,gmCtx=chartCtx.GetGraphMatrixContext(),axisOptions=this.mOptions,value,temp;$Utility.tripleId.reset(perfQueryId,this.mTripleId.mObjectId);if(isGraphMatrix){var isOk=chartCtx.hasBarAreaInComb()||chartCtx.IsBarChart()||chartCtx.IsAreaChart()||chartCtx.IsPercentChart()||(chartCtx.IsStackedChart()&&this.mMaximum*this.mMinimum<0);axisOptions.mDrawFromZero=isOk;axisOptions.mAlwaysIncludeZero=isOk;if(gmCtx.isCombinationChart()){var res=hCheckZeroInCombo.call(this);axisOptions.mAlwaysIncludeZero=axisOptions.mAlwaysIncludeZero||res.Include;axisOptions.mDrawFromZero=axisOptions.mDrawFromZero||res.DrawFromZero;}if(this.mLabelSpan===0){this.mLabelSpan=gmCtx.getPadding($K.kBetweenLabels);}var selfInfo=chartCtx.getUniformAxisInformation(this.mTripleId.mObjectId);if(selfInfo.CustomScale){axisOptions.mUseCustomMinMax=selfInfo.CustomScale;axisOptions.mUseMaxValue=!selfInfo.AutoMax;axisOptions.mUseMinValue=!selfInfo.AutoMin;axisOptions.mAxisMaxValue=selfInfo.Max;axisOptions.mAxisMinValue=selfInfo.Min;}var dataset=this.mDatasetPtr||chartCtx.mDataset,axisKey=chartCtx.getAxisKeyFromObjectId(this.mTripleId.mObjectId);if(axisKey==="Z"){return ;}var originProperties=dataset.getAxisOriginFormat(axisKey);axisOptions.mDrawCustomLine=originProperties.show||false;axisOptions.mAxisCustomValue=originProperties.number||0;axisOptions.mUseLogarithmicScale=dataset.isLogScaleAxis(axisKey);if(axisOptions.mUseLogarithmicScale){axisOptions.mAlwaysIncludeZero=false;axisOptions.mDrawFromZero=false;}}else{value=chartCtx.GetProperty($GP.DssGraph2ExcludeZero,perfQueryId);if(value){axisOptions.mAlwaysIncludeZero=value!==false;}if(chartCtx.mIsTimeSeriesChart){axisOptions.mShowMinLabel=false;}else{value=chartCtx.GetProperty($GP.DssGraph2ScaleEndMin,perfQueryId);if(value){axisOptions.mShowMinLabel=value!==false;}}value=chartCtx.GetProperty($GP.DssGraph2ScaleEndMax,perfQueryId);if(value){axisOptions.mShowMaxLabel=value!==false;}if(chartCtx.mImageUsage===0){value=chartCtx.GetProperty($GP.DssGraph2LogScale,perfQueryId);if(!this.mIsPercent&&value){axisOptions.mUseLogarithmicScale=value!==false;}value=chartCtx.GetProperty($GP.DssGraph2ScaleUseMin,perfQueryId);if(value){axisOptions.mUseMinValue=value!==false;}value=chartCtx.GetProperty($GP.DssGraph2ScaleUseMax,perfQueryId);if(value){axisOptions.mUseMaxValue=value!==false;}value=chartCtx.GetProperty($EGP.DssGraphOffScaleType,perfQueryId);if(value){axisOptions.mOffScaleType=value;}value=chartCtx.GetProperty($GP.DssGraph2ScaleMin,perfQueryId);if(axisOptions.mUseMinValue&&value){axisOptions.mAxisMinValue=value;}value=chartCtx.GetProperty($GP.DssGraph2ScaleMax,perfQueryId);if(axisOptions.mUseMaxValue&&value){axisOptions.mAxisMaxValue=value;}if(axisOptions.mUseMinValue&&axisOptions.mUseMaxValue){if(axisOptions.mAxisMinValue>axisOptions.mAxisMaxValue){temp=axisOptions.mAxisMinValue;axisOptions.mAxisMinValue=axisOptions.mAxisMaxValue;axisOptions.mAxisMaxValue=temp;}else{if(axisOptions.mAxisMinValue===axisOptions.mAxisMaxValue){temp=axisOptions.mAxisMinValue===0?10:Math.abs(axisOptions.mAxisMinValue);axisOptions.mAxisMaxValue=axisOptions.mAxisMaxValue+temp*0.5;axisOptions.mAxisMinValue=axisOptions.mAxisMinValue-temp*0.5;}}}}}var isOK=false;if(isGraphMatrix){isOK=hGetNumberFormatFromMetric.call(this);}if(!isOK){value=chartCtx.GetProperty($GP.DssGraphAxisNumberFormat,perfQueryId);if(value){chartCtx.ParseValueToFormat(value,this.mNumberFormat);}}if(this.mGraphMajorType===$GMT.GMT_BUBBLE&&this.mTripleId.mObjectId===$GO.DssGraphZBody){return ;}if(chartCtx.mIsGraphMatrix){var tripleId=this.mTripleId;if(this.hasOwnProperty("mTicks")){this.mMajorGrid.mShowGridLines=true;}else{this.mMajorGrid.mShowGridLines=false;this.mMajorGrid.mGridStyle=$GLT.DssGraphGridNone;}if(this.mMajorGrid.mShowGridLines){value=chartCtx.GetProperty($GP.DssGraphStyleMajor,tripleId);if(this.mMajorGrid.mShowGridLines&&value){this.mMajorGrid.mGridStyle=value;}}return ;}if(chartCtx.mImageUsage===0&&!chartCtx.mIsGraphMatrix){value=chartCtx.GetProperty($GP.DssGraph2ScaleDirection,perfQueryId);if(value){this.mAxisInfo.mAxisDrawInReverse=value!==false;}if(this.mGraphMajorType===$GMT.GMT_GAUGE){return ;}value=chartCtx.GetProperty($GP.DssGraphAxisShowUserLine,perfQueryId);if(value){axisOptions.mDrawCustomLine=value!==false;}value=chartCtx.GetProperty($EGP.DssGraphAxisShowSecondUserLine,perfQueryId);if(value){axisOptions.mDrawSecondCustomLine=value!==false;}value=chartCtx.GetProperty($GP.DssGraphManualMajor,perfQueryId);if(value){this.mMajorGrid.mUseManualGrid=value!==false;}value=chartCtx.GetProperty($GP.DssGraphCountMajor,perfQueryId);if(this.mMajorGrid.mUseManualGrid&&value){this.mMajorGrid.mGridInterval=value;}if(hIsHistogramX.call(this)){value=chartCtx.GetProperty($GP.DssGraphAxisStagger,perfQueryId);if(value){this.mIsStagger=value!==false;}return ;}value=chartCtx.GetProperty($GP.DssGraphAxisUserLineValue,perfQueryId);if(axisOptions.mDrawCustomLine&&value){axisOptions.mAxisCustomValue=value;}value=chartCtx.GetProperty($EGP.DssGraphAxisSecondUserLineValue,perfQueryId);if(axisOptions.mDrawSecondCustomLine&&value){axisOptions.mAxisSecondCustomValue=value;}}},GetStep:function GetStep(){return this.mStep;},IsLogarithmic:function IsLogarithmic(){return this.mOptions.mUseLogarithmicScale;},ReserveTitleAndLabels:function ReserveTitleAndLabels(iorArea,iLowMargin,iHighMargin){var L,H,V;if(!this.mIsShown||!this.mChartContextPtr.mIsValueAxisShown){return ;}if(this.mAxisInfo.mShowAxisTitle){this.ReserveTitleArea(iorArea);this.mLabelStartIndex=1;}else{this.mLabelStartIndex=0;}if(this.mAxisInfo.mShowAxisLabels){this.mDeviceDataArea.ResetRect(iorArea);if(this.mLabelObjectId===null){this.mLabelObjectId=$C.gAxisObjects[this.getIndex()].mLabelId;}if(hIsAutoXAxis.call(this)){this.fakeMaxLabelLength=this.maxLabelLength;this.maxLabelLength=-1;this.restoreLabels(true);hApplyAutoXAxisLayout.call(this);}else{this.restoreLabels(true);this.InitObjectSet(this.mLabelObjectId,$GRAPH_OBJ_TYPE.GOT_AXIS_LABEL);}if(canAccomodateOneLabel.call(this)===false){return ;}this.GenerateTickLabels();if(iLowMargin<1000){if(this.mUseDepth&&this.mTripleId.mObjectId===$GO.DssGraphX1Body){var ret=this.TrimMarginsForDepthAxis(iLowMargin,iHighMargin);iLowMargin=ret.LowMargin;iHighMargin=ret.HighMargin;}V=hGetLabelMargins.call(this);L=V.LowMargin;H=V.HighMargin;L=L>iLowMargin+this.mLowTrim?L-iLowMargin-this.mLowTrim:0;H=H>iHighMargin+this.mHighTrim?H-iHighMargin-this.mHighTrim:0;if(this.IsVerticalAxis()){iorArea.y+=H;iorArea.height-=H+L;}else{iorArea.x+=L;iorArea.width-=L+H;}if(this.mIsUniformAxis){if(L>0){this.mLowTrim+=L;}if(H>0){this.mHighTrim+=H;}}}this.hReserveLabelOrTickArea(iorArea,true,false);}},CreateAxisLine:function CreateAxisLine(){if(this.mChartContextPtr.mIsValueAxisShown){}else{return ;}if(!this.mIsShown&&!this.mUseDepth){return ;}if(hHasAxisLine.call(this)){this._super();}},GenerateTickLabels:function GenerateTickLabels(){if(this.hasLabelCreated){return ;}this.mLabelList.splice(0,this.mLabelList.length);var isGM=this.mChartContextPtr.mIsGraphMatrix;hCreateTickLabels.call(this);if(isGM){hBuildTickToLabelMap.call(this,true,0);}var i,size=this.mpAxisLabelSet.GetCollectionSize();if(this.mAxisInfo.mAxisLabelsLocation===$AXIS_LABEL_LOC.ALL_LEFT_RIGHT||this.mAxisInfo.mAxisLabelsLocation===$AXIS_LABEL_LOC.ALL_BOTTOM_TOP){hCreateTickLabels.call(this);if(isGM){hBuildTickToLabelMap.call(this,false,size);}}size=this.mpAxisLabelSet.GetCollectionSize();for(i=0;i<size;i++){this.mLabelList.push(this.mpAxisLabelSet.GetObjectByIndex(i));}this.hasLabelCreated=true;},GetTicks:function GetTicks(orTicks){if(this.mOptions.mShowMinLabel){orTicks.push(this.mMinTick);}var i;for(i=0;i<this.mTicks.length;++i){orTicks.push(this.mTicks[i]);}if(this.mOptions.mShowMaxLabel){orTicks.push(this.mMaxTick);}},hReserveLabelOrTickArea:function hReserveLabelOrTickArea(iorArea,iIsLabel,iIsReversed,specifiedLength){var labelLocation=this.mAxisInfo.mAxisLabelsLocation,labelTickSpace,maxLen;if(iIsLabel){maxLen=specifiedLength!==undefined?specifiedLength:hGetMaxLabelWidthOrHeight.call(this,this.IsVerticalAxis());var addUp=this.mChartContextPtr.mpGraphMatrixContext.getPadding($K.kLabelToChart);labelTickSpace=(maxLen*(this.mIsStagger?2:1)+$C.Axis.gLabelMargin)+addUp;}else{labelTickSpace=this.GetOuterTickLength();}if(iIsReversed){labelTickSpace=-labelTickSpace;}if(this.IsVerticalAxis()){if(labelLocation===$AXIS_LABEL_LOC.ALL_LEFT||labelLocation===$AXIS_LABEL_LOC.ALL_LEFT_RIGHT){iorArea.x+=labelTickSpace;iorArea.width-=labelTickSpace;}if(labelLocation===$AXIS_LABEL_LOC.ALL_RIGHT||labelLocation===$AXIS_LABEL_LOC.ALL_LEFT_RIGHT){iorArea.width-=labelTickSpace;}}else{if(labelLocation===$AXIS_LABEL_LOC.ALL_BOTTOM||labelLocation===$AXIS_LABEL_LOC.ALL_BOTTOM_TOP){iorArea.height-=labelTickSpace;}if(labelLocation===$AXIS_LABEL_LOC.ALL_TOP||labelLocation===$AXIS_LABEL_LOC.ALL_BOTTOM_TOP){iorArea.y+=labelTickSpace;iorArea.height-=labelTickSpace;}}},ValueToPosition:function ValueToPosition(iValue,iTruncate){if(iTruncate===undefined){if(this.mOptions.mOffScaleType!==$OST.DssGraphOffScaleHide){iTruncate=false;}else{iTruncate=true;}}if(iTruncate){iValue=(iValue>this.mMaxTick)?this.mMaxTick:iValue;iValue=(iValue<this.mMinTick)?this.mMinTick:iValue;}return Math.floor(this.ValueToFloatPosition(iValue)+0.5);},ValueToPosition2:function ValueToPosition2(iValue,iStartPosition,iStopPosition){var min=this.mMinTick;var max=this.mMaxTick;if(this.mOptions.mUseLogarithmicScale){iValue=iValue<=0?-1:log10.call(this,iValue);min=log10.call(this,min);max=log10.call(this,max);}var deltaValue=this.mAxisInfo.mAxisDrawInReverse?(max-iValue):(iValue-min);return iStartPosition+((iStopPosition-iStartPosition)*deltaValue/(max-min));},ValueToFloatPosition:function ValueToFloatPosition(value){var result=0,minTick=this.mMinTick,maxTick=this.mMaxTick,axisOptions=this.mOptions,deviceArea=this.mDeviceDataArea,axisInfo=this.mAxisInfo,deltaValue;if(axisOptions.mUseLogarithmicScale){value=value<=0?-1:log10.call(this,value);minTick=log10.call(this,minTick);maxTick=log10.call(this,maxTick);}deltaValue=axisInfo.mAxisDrawInReverse?(value-minTick):(maxTick-value);if(maxTick===minTick){return result;}if(axisInfo.mAxisDirection===$AXIS_DIRECTION.AD_Y){result=deviceArea.y+deltaValue/(maxTick-minTick)*deviceArea.height;}else{result=deviceArea.x+deviceArea.width-deltaValue/(maxTick-minTick)*deviceArea.width;}var maxScale=hGetMaxScaleRange.call(this),minScale=-maxScale;if(result>maxScale){result=maxScale;this.mIsMaxZoom=true;}else{if(result<minScale){result=minScale;this.mIsMaxZoom=true;}}return result;},ValueToPositionCheckLogScale:function ValueToPositionCheckLogScale(iValue,iStartPosition,iStopPosition){var lMin,lMax,lDeltaValue;lMin=this.mMinTick;lMax=this.mMaxTick;if(this.mOptions.mUseLogarithmicScale){iValue=iValue<=0?-1:log10.call(this,iValue);lMin=log10.call(this,lMin);lMax=log10.call(this,lMax);}lDeltaValue=this.mAxisInfo.mAxisDrawInReverse?(lMax-iValue):(iValue-lMin);return iStartPosition+((iStopPosition-iStartPosition)*lDeltaValue/(lMax-lMin));},ValueToPositionCheckValue:function ValueToPositionCheckValue(iValue,iStartPosition,iStopPosition){var lMin,lMax,lRetVal,lDeltaValue,orPosition;lMin=0;lMax=0;lRetVal=hCheckValue.call(this,iValue,lMin,lMax);iValue=lRetVal.Value;lMin=lRetVal.Min;lMax=lRetVal.Max;if(!lRetVal.Flag){return{Flag:false};}lDeltaValue=this.mAxisInfo.mAxisDrawInReverse?(lMax-iValue):(iValue-lMin);orPosition=iStartPosition+Math.floor((iStopPosition-iStartPosition)*lDeltaValue/(lMax-lMin));return{Flag:true,Position:orPosition};},GetValueForUnit:function GetValueForUnit(){var axisInfo=this.mAxisInfo,result,deviceArea=this.mDeviceDataArea,midValue=(this.mMinTick+this.mMaxTick)/2,min=0,max=0,lRetVal=hCheckValue.call(this,midValue,min,max);min=lRetVal.Min;max=lRetVal.Max;if(!this.mOptions.mUseLogarithmicScale&&lRetVal.Flag){if(axisInfo.mAxisDirection===$AXIS_DIRECTION.AD_Y){result=(max-min)/deviceArea.height;}else{result=(max-min)/deviceArea.width;}}return result;},GetOuterTickLength:function GetOuterTickLength(){if(this.HasOuterTicks(this.mMajorGrid.mGridStyle)){return this.mTickLength;}if(this.HasOuterTicks(this.mMinorGrid.mGridStyle)){return this.mTickLength/2;}return 0;},AdjustDeviceDataArea:function AdjustDeviceDataArea(iorDeviceDataArea,iIsReversed){if(this.mIsShown&&this.mAxisInfo.mShowAxisLabels){this.hReserveLabelOrTickArea(iorDeviceDataArea,false,iIsReversed);}if(this.mIsShown||this.mUseDepth){this.ReserveDepthAxisLine(iorDeviceDataArea,iIsReversed);}},UpdateTitleAndLabelArea:function UpdateTitleAndLabelArea(iorArea){var chartCtx=this.mChartContextPtr,axisInfo=this.mAxisInfo;if(!this.mIsShown||!chartCtx.mIsValueAxisShown){return ;}if(this.mLabelArea===null||this.mLabelArea===undefined){this.mLabelArea=new $C.Rect2D({Rect2D:iorArea});}else{this.mLabelArea.ResetRect(iorArea);}if(axisInfo.mShowAxisLabels&&hasShownLabels.call(this)){hUpdateLabelLocation.call(this);this.hReserveLabelOrTickArea(iorArea,true,true);}if(axisInfo.mShowAxisTitle){this.UpdateTitleLocation(iorArea);this.ReserveTitle(iorArea,true);}},HideCustomPercentOverlappedLabels:function HideCustomPercentOverlappedLabels(){$VISUTIL.visPrint("To be impl with percetn in custom scale");},HideOverlappedLabels:function HideOverlappedLabels(start,end){var refLabel,minLabel,lastLabelOffset,lastLabel,chartCtx=this.mChartContextPtr,isGM=chartCtx.mIsGraphMatrix,expDirection=this.IsVerticalAxis()?$RED.REC_EXP_VERTICAL:$RED.REC_EXP_HORIZONTAL;if(end-start<2){return ;}var isGMPercent=this.mIsPercent&&isGM,ret=hPickStartLabelIndex.call(this,start,end),refLabelIndex=ret.Start,labelList=this.mLabelList,objectList=this.mGraphObjectList,paddingPossible=ret.PaddingPossible;refLabel=objectList[refLabelIndex];minLabel=refLabel;if(paddingPossible===false){var i,len=labelList.length;for(i=0;i<len;i++){if(labelList[i]){labelList[i].mIsShown=false;}}return ;}if(hIsManualMinShown.call(this)||(!this.mIsPercent&&isGM)){minLabel=objectList[start];var hiddenLabel=isGM?minLabel:refLabel;if(minLabel.HasOverlapForSameRotation(refLabel,this.mLabelSpan,expDirection)){hiddenLabel.mIsShown=false;}}var step,axisOptions=this.mOptions,graphMajorType=this.mGraphMajorType,thisObjectId=this.mTripleId.mObjectId,endIndex=end;if(endIndex-start>2&&!isGMPercent){if(axisOptions.mUseMaxValue&&axisOptions.mShowMaxLabel){endIndex--;}}step=hComputeLabelSkipStep.call(this,isGMPercent,start,endIndex,refLabelIndex,expDirection);step=hHideLabelsWithStep.call(this,isGMPercent,start,endIndex,refLabelIndex,step);hShowOrHideAroundMax.call(this,start,end,refLabelIndex,step,expDirection);hShowOrHideAroundMin.call(this,start);if(refLabel.mIsShown){var padding=chartCtx.GetGraphMatrixContext().getPadding($K.kEndLabelToChart);refLabel.mIsShown=hIsLabelFitWithPadding.call(this,refLabel,padding);}if((graphMajorType===$GMT.GMT_POLAR&&thisObjectId===$GO.DssGraphX1Body)||(graphMajorType===$GMT.GMT_RADAR&&thisObjectId===$GO.DssGraphO1Body)){lastLabelOffset=((end-1-refLabelIndex)%step);lastLabel=objectList[end-1-lastLabelOffset];if(lastLabel.HasOverlapForSameRotation(minLabel)){lastLabel.mIsShown=false;}}if(paddingPossible){hHideLabelsFromHighEnd.call(this,end,true);hHideLabelsFromHighEnd.call(this,end,false);}this.mLabelInterval=step;},ValueToBubbleSize:function ValueToBubbleSize(DialogSize,Value){var min,max,refSize,minBubbleSize,maxBubbleSize,bubbleSize,chartCtx=this.mChartContextPtr;Value=(Value>this.mMaxTick)?this.mMaxTick:Value;Value=(Value<this.mMinTick)?this.mMinTick:Value;min=this.mMinTick;max=this.mMaxTick;if(this.mOptions.mUseLogarithmicScale){Value=Value<=0?-1:(log10.call(this,Value));min=log10.call(this,min);max=log10.call(this,max);}refSize=Math.min(chartCtx.mGraphHeight,chartCtx.mGraphWidth)*DialogSize;minBubbleSize=refSize/5000;maxBubbleSize=refSize/1000;bubbleSize=minBubbleSize+((Value-min)*(maxBubbleSize-minBubbleSize)/(max-min));return Math.ceil(bubbleSize);},GetBottomPosition:function GetBottomPosition(useCustBase){if(this.mChartContextPtr.mIsGraphMatrix){useCustBase=useCustBase||false;if(this.mOptions.mUseCustomMinMax&&this.mOptions.mDrawFromZero){return this.ValueToPosition(this.GetBaseValue(useCustBase),false);}}return this.ValueToPosition(this.mMinTick);},GetAxisOriginValue:function GetAxisOriginValue(){var axisOptions=this.mOptions;if(axisOptions.mDrawCustomLine){return axisOptions.mAxisCustomValue;}return null;},GetBasePosition:function GetBasePosition(useCustBase,value){useCustBase=useCustBase||false;if(value===null||value===undefined){value=this.GetBaseValue(useCustBase);}if(this.mChartContextPtr.mIsGraphMatrix){if(this.mOptions.mUseCustomMinMax&&this.mOptions.mDrawFromZero){return this.ValueToPosition(value,false);}}return this.ValueToPosition(value);},GetMinTick:function GetMinTick(){return this.mMinTick;},GetMaxTick:function GetMaxTick(){return this.mMaxTick;},GetBaseValue:function GetBaseValue(customized){customized=customized||false;var chartCtx=this.mChartContextPtr,options=this.mOptions;if(chartCtx.mIsGraphMatrix){if(customized&&options.mDrawCustomLine){if($Utility.isValidNumber(options.mAxisCustomValue)){return options.mAxisCustomValue;}}if(options.mUseCustomMinMax&&options.mDrawFromZero){return 0;}}if(this.mMaxTick<0){return this.mMaxTick;}if(!options.mDrawFromZero||this.mMinTick>0||this.mMaxTick<0){return this.mMinTick;}return 0;},GetPositionByValue:function GetPositionByValue(iValue){var retVal=this.GetFloatPositionByValue(iValue);if(retVal===null){return retVal;}retVal=Math.floor(retVal+0.5);return retVal;},GetFloatPositionByValue:function GetFloatPositionByValue(value){var min=0,max=0,deltaValue,result,returnVal;returnVal=hCheckValue.call(this,value,min,max);value=returnVal.Value;min=returnVal.Min;max=returnVal.Max;if(!returnVal.Flag){return null;}var axisInfo=this.mAxisInfo,deviceArea=this.mDeviceDataArea;deltaValue=axisInfo.mAxisDrawInReverse?(value-min):(max-value);result=0;if(max===min){return result;}if(axisInfo.mAxisDirection===$AXIS_DIRECTION.AD_Y){result=deviceArea.y+deltaValue*deviceArea.height/(max-min);}else{result=deviceArea.x+deviceArea.width-deltaValue*deviceArea.width/(max-min);}var maxRange=hGetMaxScaleRange.call(this);if(result>maxRange){result=maxRange;this.mIsMaxZoom=true;}if(result<-maxRange){result=-maxRange;this.mIsMaxZoom=true;}return result;},GenerateCustomLine:function GenerateCustomLine(irDataArea,iorGraphObjectList){var axisOptions=this.mOptions,deviceArea=this.mDeviceDataArea;if(this.mChartContextPtr.mIsGraphMatrix){if(this.mPrimaryMetrics.length===0){return ;}}if(!axisOptions.mDrawCustomLine&&!axisOptions.mDrawSecondCustomLine){return ;}var backupDataArea,customLineId;if(this.mChartContextPtr.mIsGraphMatrix){customLineId=$C.gAxisObjects[this.getIndex()].mCustomLineId.mObjectId;backupDataArea=deviceArea;}else{customLineId=$C.gAxisObjects[this.getIndex()].mCustomLineId.mObjectId;backupDataArea=new $C.Rect2D({Rect2D:this.mDeviceDataArea});deviceArea.ResetRect(irDataArea);}if(axisOptions.mDrawCustomLine){hGenerateOneCustomLine.call(this,iorGraphObjectList,axisOptions.mAxisCustomValue,customLineId);}if(this.mTripleId.mObjectId===$GO.DssGraphY1Body&&axisOptions.mDrawSecondCustomLine){hGenerateOneCustomLine.call(this,iorGraphObjectList,axisOptions.mAxisSecondCustomValue,$GO.DssGraphY1SecondUserLine);}deviceArea.ResetRect(backupDataArea);},GenerateMapAndList:function GenerateMapAndList(){},generateGridsByArea:function generateGridsByArea(iIsGridLine){if(!this.mIsShown){return ;}var majorGrid=this.mMajorGrid,minorGrid=this.mMinorGrid;if(iIsGridLine){if(majorGrid.mShowGridLines&&majorGrid.mGridStyle!==$GLT.DssGraphGridNone){hGenerateMajorGrid.call(this);}if(minorGrid.mShowGridLines&&minorGrid.mGridStyle!==$GLT.DssGraphGridNone){hGenerateMinorGrid.call(this);}}else{if(this.mAxisInfo.mUseInterlacedGrids){hGenerateInterlacedGrids.call(this);}}},GetNumberFormat:function GetNumberFormat(){return this.mNumberFormat;},GetTrimWithPadding:function GetTrimWithPadding(){return this.mIsTrimmedWithPadding;},GetPositionAtTick:function GetPositionAtTick(iTickValue){var lResult=this.GetFloatPositionByValue(iTickValue);if(lResult!==null){return lResult;}return 0;},GetMaxMinDataInput:function GetMaxMinDataInput(){return{Max:this.mMaximum,Min:this.mMinimum};},GetMaxMinDataInputPosition:function GetMaxMinDataInputPosition(){var L=this.GetPositionByValue(this.mMinimum),H=this.GetPositionByValue(this.mMaximum);return{LowBoundary:L,HighBoundary:H};},postProcessStep:function postProcessStep(currentStep,lAbsoluteRange){var step=currentStep,chartCtx=this.mChartContextPtr;switch(this.mGraphMajorType){case $GMT.GMT_HISTOGRAM:case $GMT.GMT_POLAR:case $GMT.GMT_SCATTER:case $GMT.GMT_BUBBLE:case $GMT.GMT_3D_SCATTER:case $GMT.GMT_GANTT:break;case $GMT.GMT_GAUGE:break;case $GMT.GMT_CATEGORY:if(!this.IsVerticalAxis()&&!chartCtx.mIsGraphMatrix){this.mLargerGridInterval=true;}break;default:if(!this.IsVerticalAxis()&&!chartCtx.mIsGraphMatrix){this.mLargerGridInterval=true;}break;}if(this.mLargerGridInterval){if(lAbsoluteRange<step*7){step*=2;}else{step*=4;}}if(chartCtx.mIsGraphMatrix){var lZoomScale=this.mChartContextPtr.GetGraphMatrixContext().GetValueAxisZoomScale(this.mTripleId.mObjectId);if(lZoomScale>1){step/=lZoomScale;}if(Math.abs(this.mMaximum)<0.3&&Math.abs(this.mMinimum)<0.3){var maxTick=Math.ceil(this.mMaximum/step)*step,minTick=Math.floor(this.mMinimum/step)*step;if(maxTick<minTick+step){step/=2;}}}return step;},GetLogicalCoord:function GetLogicalCoord(iAbsoluteCoord){var result=0,deviceDataArea=this.mDeviceDataArea,min=this.mMinTick,max=this.mMaxTick;if(this.mOptions.mUseLogarithmicScale){min=log10.call(this,min);max=log10.call(this,max);}var deltaValue=this.IsVerticalAxis()?(max-min)*(iAbsoluteCoord-deviceDataArea.y)/deviceDataArea.height:(max-min)*(deviceDataArea.x+deviceDataArea.width-iAbsoluteCoord)/deviceDataArea.width;result=this.mAxisInfo.mAxisDrawInReverse?min+deltaValue:max-deltaValue;if(this.mOptions.mUseLogarithmicScale){result=Math.pow(10,result);}return result;},GetSlopeFactor:function GetSlopeFactor(iLogicalCoord){var resultVal=this.IsVerticalAxis()?-this.mDeviceDataArea.height:this.mDeviceDataArea.width;if(this.mOptions.mUseLogarithmicScale){resultVal/=((Math.log(this.mMaxTick)-Math.log(this.mMinTick))*iLogicalCoord);}else{resultVal/=(this.mMaxTick-this.mMinTick);}return this.mAxisInfo.mAxisDrawInReverse?-resultVal:resultVal;},GetMinMaxLogicalCoord:function GetMinMaxLogicalCoord(){return{Min:this.mMinTick,Max:this.mMaxTick};},GenerateLabelsFor3D:function GenerateLabelsFor3D(){},GetGridLinePositionsFor3D:function GetGridLinePositionsFor3D(){},OnZooming:function OnZooming(){},getStatus:function getStatus(){var NORMAL=0,ROTATED=2,rotate=this.getLabelRotation(),interval=this.mLabelInterval;if(rotate===$FR.Rotate90){return ROTATED;}if(interval===1){return NORMAL;}return ROTATED;},getCondenseStatus:function getCondenseStatus(){return this.mCondenseLabels;},checkCondense:function checkCondense(expectCondense){this.mCondenseLabels=expectCondense;return this.mCondenseLabels;},isBaseLineQualified:function isBaseLineQualified(baseValue){baseValue=baseValue||0;return this.mMaxTick>baseValue&&this.mMinTick<baseValue;},liftedFromZero:function liftedFromZero(){return this.mMinTick===0&&this.mLowTrim>0;},getBandings:function getBandings(){var start=0,size,chartCtx=this.mChartContextPtr;if(this.IsVerticalAxis()){size=chartCtx.mGraphHeight;}else{size=chartCtx.mGraphWidth;}return[{Start:start,Size:size}];},formatAsLabel:function formatAsLabel(number){var tripleId=$C.gAxisObjects[this.getIndex()].mLabelId,label=new $C.NumberObject({TripleId:tripleId,GraphObjectManager:this,Number:number,NumberFormat:this.mNumberFormat,GraphCollectionObject:this.mpAxisLabelSet,ShouldCondense:this.mCondenseLabels,ExpectCondense:this.mCondenseLabels});return label.mText;},getGridLinePosition:function getGridLinePosition(isMajorGridLine){if(!!(this.mIntegrity&4)===false){return[];}if(isMajorGridLine===undefined){isMajorGridLine=true;}var onePosition,i,majorPositions=[];var labelList=this.mLabelList,len=labelList.length;var kPadding=10,chartCtx=this.mChartContextPtr,xMax=chartCtx.mGraphWidth,yMax=chartCtx.mGraphHeight,isY=this.IsVerticalAxis();for(i=0;i<len;i++){if(labelList[i].mIsShown){onePosition=this.ValueToPosition(labelList[i].mNumber);if(onePosition<kPadding||onePosition+kPadding>(isY?yMax:xMax)){continue;}majorPositions.push(onePosition);}}if(isMajorGridLine){return majorPositions;}var refPosition,refIndex,minorPositions=[];len=majorPositions.length;if(len===0){return minorPositions;}else{var step1,step2;for(i=1;i<len;i++){onePosition=0.5*(majorPositions[i-1]+majorPositions[i]);if(i===1){step1=Math.abs(onePosition-majorPositions[i-1]);}else{if(i===len-1){step2=Math.abs(onePosition-majorPositions[i-1]);}}minorPositions.push(onePosition);}refIndex=!isY?len-1:0;refPosition=majorPositions[refIndex];onePosition=hCalSideMinorGridPosition.call(this,refPosition,false,step1);if(onePosition!==null){minorPositions.push(onePosition);}refIndex=isY?len-1:0;refPosition=majorPositions[refIndex];onePosition=hCalSideMinorGridPosition.call(this,refPosition,true,step2);if(onePosition!==null){minorPositions.push(onePosition);}}return minorPositions;},TrimDeviceDataArea:function TrimDeviceDataArea(area){var chartCtx=this.mChartContextPtr,axisInfo;axisInfo=chartCtx.getUniformAxisInformation(this.mTripleId.mObjectId);if(axisInfo.PerCell){return this.TrimAxisPadding(area,false);}this.mLowTrim=axisInfo.Trims[0];this.mHighTrim=axisInfo.Trims[1];hTrimPaddingFromRect.call(this,false,this.mHighTrim,this.mLowTrim,area);},refresh:function refresh(purpose,props){if(purpose==="clipping"){var chartCtx=this.mChartContextPtr,axisOptions=this.mOptions;if(this.mMaximum!==props.max||this.mMinimum!==props.min){this.mMaximum=props.max;this.mMinimum=props.min;axisOptions.mAxisMaxValue=props.max;axisOptions.mAxisMinValue=props.min;manglingMaxMin.call(this,this.mOptions);this.mTicks=[];this.mMaxTick=this.mMinTick=-1;this.mStep=-1;hComputeTicks.call(this);if(axisOptions.mUseLogarithmicScale&&chartCtx.IsStackedChart()){this.mMaximum=axisOptions.mDrawCustomLine?Math.max(this.mMaximum+this.mMinTick,axisOptions.mAxisCustomValue):this.mMaximum+this.mMinTick;this.mMinimum=Math.min(this.mMinimum,0);this.mTicks.splice(0,this.mTicks.length);var result=$GMUTIL.computeTicksForLogScale(this);this.mMaxTick=result.mMaxTick;this.mMinTick=result.mMinTick;this.mTicks=result.mTicks;this.mStep=result.mStep;}hAdjustAxisScale.call(this);}var newArea={x:0,y:0,width:chartCtx.mGraphWidth,height:chartCtx.mGraphHeight};this.TrimAxisPadding(newArea,false);}},TrimAxisPadding:function TrimAxisPadding(iorRect,iUseFixedMargin){if(!this.mChartContextPtr.mIsGraphMatrix){return ;}var R,L,H,baseL,isCustMinMax=this.mOptions.mUseCustomMinMax;this.mLowTrim=this.mHighTrim=0;R=hGetRequiredPaddingAtTwoEnds.call(this,isCustMinMax);L=R.LowPadding;H=R.HighPadding;baseL=this.mAxisInfo.mAxisDirection===$AXIS_DIRECTION.AD_X?iorRect.width:iorRect.height;baseL-=(H+L);R=hComputeHighAndLowPadding.call(this,iUseFixedMargin,baseL,H,L);L=R.LowPadding;H=R.HighPadding;hTrimPaddingFromRect.call(this,iUseFixedMargin,H,L,iorRect);}});}());