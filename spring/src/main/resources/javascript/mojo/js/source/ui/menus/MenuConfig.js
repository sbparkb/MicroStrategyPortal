(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.Menu","mstrmojo.hash","mstrmojo.array");mstrmojo.ui.menus.MenuItemType=null;var CLS_SEPARATOR="separator";mstrmojo.ui.menus.MenuConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.MenuConfig",menus:null,menuCssClass:"",supportsScroll:false,maxHeight:0,hasMenuItems:function hasMenuItems(){return !!this.menus.length;},getMenuItems:function getMenuItems(includeAll){return mstrmojo.array.filter(this.menus.slice().reverse(),function(item,idx,arr){var nextItem=arr[idx+1];return includeAll||item.cls!==CLS_SEPARATOR||(idx&&nextItem&&nextItem.cls!==CLS_SEPARATOR);}).reverse();},getMenuItem:function getMenuItem(menuItemId){var menuList=this.menus,i;if(menuList!==null){for(i=0;i<menuList.length;i++){var menuItem=menuList[i];if(menuItem.cls===menuItemId){return menuItem;}}}return null;},absorbMenuItems:function absorbMenuItems(menuCfg){this.menus=this.menus.concat(menuCfg.menus);},addMenuItem:function addMenuItem(text,cls,fn,ctxt,index){var menuText,menuTooltip,newMenuItem;if(!text||typeof text==="string"){menuText=text;}else{menuText=text.n;menuTooltip=text.ttp;}newMenuItem={n:menuText,ttp:menuTooltip,cls:cls,fn:fn,ctxt:ctxt};if(isNaN(index)||index>=this.menus.length){this.menus.push(newMenuItem);}else{this.menus.splice(index,0,newMenuItem);}return newMenuItem;},addCustomMenuItem:function addCustomMenuItem(text,cls,fn,fnGetItemMarkup,ctxt){var menuItem=this.addMenuItem(text,cls,fn,ctxt);menuItem.getItemMarkup=fnGetItemMarkup;return menuItem;},addDisabledMenuItem:function addDisabledMenuItem(text,cls){this.addNonInteractiveMenuItem(text,cls,true);},addNonInteractiveMenuItem:function addNonInteractiveMenuItem(text,cls,isDisabled){var classes=["non-int"];if(cls){classes.push(cls);}if(isDisabled){classes.push("disabled");}var lastMenuItem=this.addMenuItem(text,classes.join(" "),mstrmojo.emptyFn);lastMenuItem.dsbld=true;},addSeparator:function addSeparator(){this.addMenuItem("",CLS_SEPARATOR,function(){return false;});},addPopupMenuItem:function addPopupMenuItem(text,scopeId,fn,cls,ctxt,index){var css=["pop "];if(cls){css.push(cls);}var subMenuItem=this.addMenuItem(text,css.join(" "),fn,ctxt,index);subMenuItem.pop=true;subMenuItem.scope=scopeId;return subMenuItem;},addActionPopupMenuItem:function addActionPopupMenuItem(text,scopeId,actionFn,actionPopupMenuFn,cls,ctxt,index){var popupMenuItem=this.addPopupMenuItem(text,scopeId,actionPopupMenuFn,(cls||"")+" ax",ctxt,index);popupMenuItem.actionFn=actionFn;popupMenuItem.ax=true;},addSubMenuItem:function addSubMenuItem(text,cls,scopeId,fn,ctxt){this.addPopupMenuItem(text,scopeId,fn,cls,ctxt);},addEditorMenuItem:function addEditorMenuItem(text,scopeId,fn,ctxt,index){this.addPopupMenuItem(text,scopeId,fn,"",ctxt,index);},getToggleItemStates:function getToggleItemStates(text,cls,fnOn,fnOff,isOn,ctxt){var textOn,textOff,tooltipOn,tooltipOff;if(typeof text==="string"){textOn=textOff=text;tooltipOn=tooltipOff="";}else{textOn=text.on||"";textOff=text.off||"";tooltipOn=text.ttpOn||"";tooltipOff=text.ttpOff||"";}var states=[{n:textOn,ttp:tooltipOn,cls:cls+" on",fn:fnOff,ctxt:ctxt},{n:textOff,ttp:tooltipOff,cls:cls,fn:fnOn,ctxt:ctxt}];if(!isOn){states.reverse();}return states;},addToggleMenuItem:function addToggleMenuItem(text,cls,fnOn,fnOff,scopeId,isOn,ctxt){var states=this.getToggleItemStates(text,cls,fnOn,fnOff,isOn,ctxt);return this.addDualStateItem(scopeId,states[0],states[1]);},addDualStateItem:function addDualStateItem(scopeId,initialState,toggleState){return this.addMenuItem({n:initialState.n,ttp:initialState.ttp},initialState.cls,this.getDualStateHandler(scopeId,initialState,toggleState),initialState.ctxt);},getDualStateHandler:function getDualStateHandler(scopeId,initialState,toggleState){return function(item,widget){var states=[initialState,toggleState];if(item.cls===initialState.cls){states.reverse();}states[1].fn.call(mstrmojo.all[scopeId],item,widget);item.n=states[0].n;item.ttp=states[0].ttp;item.cls=states[0].cls;};},addRadioMenuGroup:function addRadioMenuGroup(currValue,fnChange,options,cls,ctxt,useCheckMark,customItemMarkupFn){var menuItems=[];options.forEach(function(option,idx){if(option.separator){this.addSeparator();return ;}var text=option.text,itemCls=(cls||"")+" "+(option.cls||"")+(useCheckMark?"":" radio")+(option.value===currValue?" on":""),fn=function(){if(fnChange.call(this.ctxt,option.value,currValue,option)===false){return false;}currValue=option.value;menuItems.forEach(function(item){item.cls=item.cls.replace(/ on$/,"")+(item.radioValue===currValue?" on":"");});return true;},menuItem=customItemMarkupFn?this.addCustomMenuItem(text,itemCls,fn,customItemMarkupFn(option,idx),ctxt):this.addMenuItem(text,itemCls,fn,ctxt);menuItem.radioValue=option.value;menuItems.push(menuItem);},this);},clear:function clear(){this._super();this.menus=[];},newInstance:function newInstance(props){return new mstrmojo.ui.menus.Menu(mstrmojo.hash.copy({popupConfig:this},props));}});}());