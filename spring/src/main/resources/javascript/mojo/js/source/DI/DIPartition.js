(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.CheckList","mstrmojo.ImageCheckBox");mstrmojo.requiresDescs(12388);var $ARR=mstrmojo.array,$DESC=mstrmojo.desc;mstrmojo.DI.DIPartition=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPartition",markupString:'<div id="{@id}" class="mstrmojo-di-partition {@cssClass}" style="{@cssText}"><div class="mstrmojo-di-partition-content"></div><div class="mstrmojo-di-partition-notice"></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild;},noticeNode:function(){return this.domNode.lastChild;}},tables:null,sourceId:null,init:function init(props){this._super(props);var data=this.data,sourceId=data&&data.id,partitionTables=data&&data.partition;var model=mstrApp.getRootController().getModel();this.isRefined=model.importSources[sourceId].sourceInfo.isRefined;this.sourceId=sourceId;this.tables=mstrApp.getRootController().partitionController.getAllPartitionTables(sourceId,partitionTables);$ARR.forEach(this.tables,function(table){table.selected=table.isMember;});if(this.isRefined){$ARR.forEach(this.tables,function(table){table.title="Cannot change partition group after wrangling.";});}this.ontablesChange();},ontablesChange:function ontablesChange(){var tables=this.tables,contentVisible=tables&&tables.length>0;if(contentVisible){this.content.set("items",tables);}this.content.set("visible",contentVisible);this.notice.set("visible",!contentVisible);},_close:function(){var parent=this.parent;if(parent&&parent._cmSource){parent._cmSource.closeMenuTree();}},onOK:function onOK(){var tables=this.content.items,addMembers=[],delMembers=[],selectedItems;selectedItems=this.content.getSelectedItems();$ARR.forEach(tables,function(table){table.selected=($ARR.indexOf(selectedItems,table)!==-1);});$ARR.forEach(tables,function(table){if(table.isMember&&!table.selected){delMembers.push(table.ptIndex.toString());}else{if(!table.isMember&&table.selected){addMembers.push(table.sourceId);}}});if(addMembers.length>0||delMembers.length>0){mstrApp.getRootController().partitionController.changePartition(this.sourceId,addMembers,delMembers);}this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"content",slot:"contentNode",onRender:function onRender(){var items=this.items,selections=[];$ARR.forEach(items,function(item){if(item.selected){selections.push(item);}});if(selections.length){this.setSelectedItems(selections,true);}if(this.parent.isRefined){this.set("enabled",false);}}},{scriptClass:"mstrmojo.Label",alias:"notice",slot:"noticeNode",text:$DESC(12388,"No tables found with the same set of attributes and metrics.")}]});}());