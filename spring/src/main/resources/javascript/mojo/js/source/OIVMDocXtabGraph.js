(function(){mstrmojo.requiresCls("mstrmojo.DocXtabGraph");var $D=mstrmojo.dom;mstrmojo.OIVMDocXtabGraph=mstrmojo.declare(mstrmojo.DocXtabGraph,null,{scriptClass:"mstrmojo.OIVMDocXtabGraph",unrender:function unrender(){this.clearCache();this._super();},postBuildRendering:function postBuildRendering(){if(!this.preLoader){this.preLoader=document.createElement("img");}return this._super();},retrieveGraphSrc:function retrieveGraphSrc(h,w){if(parseInt(h,10)===0||parseInt(w,10)===0){return ;}if(isNaN(parseInt(this.node.data.sid,10))){return ;}var src=mstrConfig.taskURL+"?taskId=getRWGraphImage&taskEnv=xhr&__ts__="+(new Date().getTime())+"&messageID="+this.model.docModel.mid+"&nodeKey="+this.k+"&sliceID="+parseInt(this.node.data.sid,10)+"&imgType=4&width="+parseInt(w,10)+"&height="+parseInt(h,10),preLoader=this.preLoader,imgNode=this.imgNode,id=this.id;src=mstrmojo.addCSRFTokenToURL(src);if(preLoader.dsrc!==src){preLoader.dsrc=src;var fnComplete=function(){mstrApp.removeLoadingGraph(id);},load="load",err="error",fnPreFail,fnPreLoad,fnMainFail,fnMainLoad;fnPreLoad=$D.attachOneTimeEvent(preLoader,load,function(){fnMainLoad=$D.attachOneTimeEvent(imgNode,load,function(){fnComplete();imgNode.style.background="none";mstrmojo.all[id].defn.set("readyState",mstrmojo.EnumReadystate.IDLE);$D.detachEvent(imgNode,err,fnMainFail);},true);fnMainFail=$D.attachOneTimeEvent(imgNode,err,function(){fnComplete();$D.detachEvent(imgNode,load,fnMainLoad);},true);$D.detachEvent(preLoader,err,fnPreFail);imgNode.src=preLoader.src;},true);fnPreFail=$D.attachOneTimeEvent(preLoader,"error",function(){fnComplete();$D.detachEvent(preLoader,load,fnPreLoad);},true);this.model.docModel.dataService.getRWGraphImage({k:this.k,sid:parseInt(this.node.data.sid,10),w:w,h:h,encodeImage:true},{success:function(res){preLoader.src=res;},failure:function(){fnPreFail();}});}}});}());