(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Model","mstrmojo.storage.DOMLocalStorage");var $HASH=mstrmojo.hash,$ARR=mstrmojo.array;mstrmojo.home.HomeModel=mstrmojo.declare(mstrmojo.Model,[],{scriptClass:"mstrmojo.home.HomeModel",controller:null,modelData:null,cards:null,init:function init(props){this._super(props);this.loadCards();},loadCards:function loadCards(){this.cards=this.modelData||[];this.cards=mstrmojo.array.filter(this.cards,function(card){return card!==null;});this.sortCards();return this.cards;},sortCards:function sortCards(){mstrmojo.array.forEach(this.cards,function(card,idx){card.pos=idx;});},saveCards:function saveCards(callback,prefsLevel){callback=callback||{};prefsLevel=prefsLevel||"0";var clearPrefValue=(this.cards===null);mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(res){if(callback.success){callback.success(res);}},failure:function(res){if(callback.failure){callback.failure(res);}},complete:function(res){if(callback.complete){callback.complete(res);}}},{taskId:"setPreference",clearPrefValue:clearPrefValue,prefs:"homecardsDef\u001E"+JSON.stringify(this.cards,function replacer(key,value){if(key==="pos"){return undefined;}return value;})+"\u001E"+prefsLevel});this.raiseEvent("cardsChange",{cards:this.cards});},updateCard:function updateCard(cardDef){this.cards[cardDef.pos]=cardDef;this.saveCards();},addCard:function addCard(cardDef){cardDef.pos=this.cards.length;this.cards.push(cardDef);this.saveCards();},removeCard:function removeCard(cardDef){if(this.cards.length===1){this.cards=[];}else{this.cards.splice(cardDef.pos,1);this.sortCards();}this.saveCards();},switchCards:function(srcCardDef,tgtCardDef,onLeft){var srcPos=srcCardDef.pos;var tgtPos=tgtCardDef.pos;this.cards.splice(srcPos,1);var idx=mstrmojo.array.find(this.cards,"pos",tgtPos);this.cards.splice(idx+(onLeft?0:1),0,srcCardDef);this.sortCards();this.saveCards();},loadDefaultCard:function loadDefaultCard(){this.cards=null;this.saveCards({success:function(){mstrmojo.form.send({evt:5005,src:mstrApp.name+"."+mstrApp.pageName+".5005"});},failure:function(res){mstrmojo.alert(res.message||res.getResponseHeader("X-MSTR-TaskFailureMsg"));}},"0");},saveDefaultCard:function saveDefaultCard(){this.saveCards({success:function(){mstrmojo.alert(mstrmojo.desc(3336,"## layout has been saved successfully.").replace("##",mstrmojo.desc(14510,"My Page")));},failure:function(res){mstrmojo.alert(res.message||res.getResponseHeader("X-MSTR-TaskFailureMsg"));}},"1");},getRecentObjects:function getRecentObjects(){try{var ls=window.localStorage;if(!ls||!window.JSON){return ;}var getObjectIDString=function(type){return{3:"reportID=",55:"documentID="}[type]||"messageID=";},getIconClass=function(recoveryInfo){var ty=recoveryInfo.ty,iconClass="";switch(ty){case 55:var vm=recoveryInfo.vm;switch(vm){case 8192:case 2048:iconClass="mstrmojo-ListIcon t55 dvm8192";break;case 1:default:iconClass="mstrmojo-ListIcon t55";break;}break;case 3:var viewMode=recoveryInfo.viewMode;switch(viewMode){case 1:iconClass="mstrmojo-ListIcon t3 st768";break;case 2:iconClass="mstrmojo-ListIcon t3 st769";break;case 3:iconClass="mstrmojo-ListIcon t3 st774";break;default:iconClass="";break;}break;}return iconClass;};var items=[];var msgKey=mstrConfig.lastMsgKey,lastMsgID=(JSON.parse(decodeURIComponent(mstrmojo.cookies.getCookieSetting("lastMsgID")||"{}")))[msgKey],isValidMsgID=function(msgId){return msgId&&(msgId.length===32)&&/^[A-Z0-9]{32}$/.test(msgId);};if(isValidMsgID(lastMsgID)){var ri=ls.getItem("lastMsgRecoveryInfo"+msgKey);if(ri){ri=JSON.parse(ri);items.push({url:mstrmojo.addCSRFTokenToURL("?"+ri.url.replace(/messageID.*/,"messageID="+lastMsgID)),n:mstrmojo.desc(14706,"# (Recovered)").replace("#",mstrmojo.string.decodeHtmlString(ri.n)),did:ri.did,iconCls:"mstrmojo-ListIcon recover",isLastMsg:true});}}var recentObjects=JSON.parse(ls.getItem("recentObjects"+msgKey));mstrmojo.array.forEach(recentObjects,function(objStr){if(!mstrmojo.string.isEmpty(objStr)){var item=JSON.parse(objStr);item.url=mstrmojo.addCSRFTokenToURL("?"+item.url.replace(/messageID.*/,getObjectIDString(item.ty)+item.did));item.iconCls=getIconClass(item);item.isMsg=false;item.n=mstrmojo.string.decodeHtmlString(item.n);if(item.imgData===undefined){item.html='<div class="preview no-recent-img">'+mstrmojo.desc(14558,"No preview image available.")+"<br/></div>";}var idx=mstrmojo.array.find(items,"did",item.did);if(idx===-1){items.push(item);}else{items[idx].imgData=item.imgData;items[idx].html=item.html;}}});if(items.length===0){var msg;if(mstrmojo.resolveFeature("create-analysis")&&mstrmojo.resolveFeature("dhtml")){var url=mstrmojo.addCSRFTokenToURL("?evt=3187&src="+mstrApp.name+".3187");if(mstrmojo.resolveFeature("show-sample-recents")){msg=mstrmojo.desc(14649,"Your Recents list is empty.# ###Create a new dashboard## # or # view a sample dashboard for inspiration.").replace("###",'<a href="'+url+'">').replace("##","</a>").replace(/#/g,"<br/>");}else{msg=mstrmojo.desc(14709,"Your Recents list is empty.# ###Create a new dashboard##").replace("###",'<a href="'+url+'">').replace("##","</a>").replace(/#/g,"<br/>");}items=[{n:"",html:'<div class="no-recent">'+msg+"</div>",url:url,info:true}];}else{if(mstrmojo.resolveFeature("show-sample-recents")){msg=mstrmojo.desc(14710,"Your Recents list is empty.# view a sample dashboard for inspiration.").replace(/#/g,"<br/>");}else{msg=mstrmojo.desc(14711,"Your Recents list is empty.");}items=[{n:"",html:'<div class="no-recent">'+msg+"</div>",info:true}];}}if(mstrmojo.resolveFeature("show-sample-recents")){var samples=[{n:"Airline Flight Analysis",url:mstrmojo.addCSRFTokenToURL("?evt=3140&src=#.3140&documentID=233AE5EF48F48E84B4626D8E0E8806DE".replace("#",mstrApp.name)),iconCls:getIconClass({ty:55,vm:8192}),pos:0,overlayText:mstrmojo.desc(10293,"Sample")},{n:"Slot Machine Performance",url:mstrmojo.addCSRFTokenToURL("?evt=3140&src=#.3140&documentID=C495AFFF435BB7A2896A7E953425AB97".replace("#",mstrApp.name)),iconCls:getIconClass({ty:55,vm:8192}),pos:1,overlayText:mstrmojo.desc(10293,"Sample")},{n:"Technology Adoption Trend",url:mstrmojo.addCSRFTokenToURL("?evt=3140&src=#.3140&documentID=553B744D4EC7568C1370E28D1B4B27D0".replace("#",mstrApp.name)),iconCls:getIconClass({ty:55,vm:8192}),pos:2,overlayText:mstrmojo.desc(10293,"Sample")},{n:"Worldwide Emissions",url:mstrmojo.addCSRFTokenToURL("?evt=3140&src=#.3140&documentID=CB525E944363EA469F4E29A5C01608D6".replace("#",mstrApp.name)),iconCls:getIconClass({ty:55,vm:8192}),pos:3,overlayText:mstrmojo.desc(10293,"Sample")}];return items.concat(samples);}return items;}catch(err){}}});mstrmojo.home.HomeModel.CardDefType=null;}());