(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.color","mstrmojo.dom","mstrmojo.Widget","mstrmojo.tooltip","mstrmojo.Button");mstrmojo.requiresClsP("mstrmojo.ui.editors.controls","ColorList","AdvancedColorPicker");mstrmojo.requiresDescs(221,1442,13776,13812,14535,14537,14538);var $ARR=mstrmojo.array,$HASH=mstrmojo.hash,$CSS=mstrmojo.css,$DOM=mstrmojo.dom,$COLOR=mstrmojo.color;var MAX_COLOR_CNT=16;mstrmojo.MultipleColorsPicker=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.MultipleColorsPicker",cssClass:"mstrmojo-MultipleColorsPicker",colors:[],isAdding:null,onOpen:function onOpen(){this.set("isAdding",true);this.colorsChanged();},onOK:mstrmojo.emptyFn(),markupMethods:$HASH.copy({onisAddingChange:function onisAddingChange(){var isAdding=this.isAdding,contentNode=this.containerNode;$CSS.toggleClass(contentNode,"isAdding",isAdding);$CSS.toggleClass(contentNode,"isRemoving",!isAdding);}},$HASH.copy(mstrmojo.Editor.prototype.markupMethods)),findSelectedColor:function(clr){return $ARR.indexOf($ARR.map(this.colors,function(selClr){return $COLOR.encodeColor(selClr);}),$COLOR.encodeColor(clr));},onColorAdding:function onColorAdding(clr,forceAdd){var colors=this.colors;if((this.isAdding||forceAdd)&&colors.length<MAX_COLOR_CNT&&this.findSelectedColor(clr)===-1){this.colors.push(clr);this.colorsChanged();}},onColorRemoving:function onColorRemoving(clr,forceRemove){if(!this.isAdding||forceRemove){this.colors.splice(this.findSelectedColor(clr),1);this.colorsChanged();}},colorsChanged:function colorsChanged(){this.colorList.set("items",$ARR.map(this.colors,function(clr){return{id:clr};}));this.btnHbox.okBtn.set("enabled",!!this.colors.length);},colorPickerModeChanged:function(isPaletteMode){$CSS.toggleClass(this.containerNode,"isPalettePickerMode",isPaletteMode);},children:[{scriptClass:"mstrmojo.ui.editors.controls.AdvancedColorPicker",showNoFill:false,useRichTooltip:true,updateTooltipConfig:function(e){var tgtNode=$DOM.eventTarget(window,e),basicColors=this.basicColors,colorWheel=this.colorWheel,baseTooltip={cssClass:"vi-regular vi-tooltip-A A-center",posType:mstrmojo.tooltip.POS_TOPCENTER},mcp=this.parent,colorExistedDesc=mstrmojo.desc(13812,"This color is already in color container");this.richTooltip=null;if(basicColors){var itemNode=basicColors.getItemNodeFromTarget(tgtNode);if(itemNode){itemNode.removeAttribute("title");var item=basicColors.getItemFromTarget(itemNode);this.richTooltip=$HASH.copy({content:mcp.findSelectedColor(item.id)!==-1?colorExistedDesc:mstrmojo.desc(14535,"Click to add this color: ##").replace("##",item.n),refNode:itemNode,areaId:item._renderIdx,top:33,left:10},baseTooltip);}}else{if(colorWheel){$ARR.forEach(["hueHandleNode","slHandleNode"],function(slotName){if($DOM.contains(colorWheel[slotName],tgtNode)){this.richTooltip=$HASH.copy({content:mcp.findSelectedColor(this.color)!==-1?colorExistedDesc:mstrmojo.desc(13776,"Double-click to add this color"),refNode:colorWheel[slotName],areaId:slotName,top:30,left:8},baseTooltip);return false;}},this);}}},colorChanged:function colorChanged(newColor){this.parent.onColorAdding(newColor);},postpickerModeChange:function(){this.parent.colorPickerModeChanged(this.pickerMode===2);},postBuildRendering:function postBuildRendering(){mstrmojo.ui.editors.controls.AdvancedColorPicker.prototype.postBuildRendering.call(this);$DOM.attachMarkupEvent(this.id,this.containerNode,"dblclick");$DOM.attachMarkupEvent(this.id,this.containerNode,"keyup");},ondblclick:function ondblclick(evt){var basicColors=this.basicColors,colorWheel=this.colorWheel,tgtNode=evt.getTarget(),color=null;if(basicColors){var item=basicColors.getItemFromTarget(tgtNode);color=item&&item.id;}else{if(colorWheel&&$DOM.contains(colorWheel.domNode,tgtNode)){color=this.color;}}if(color){this.parent.onColorAdding(color,true);}},onkeyup:function onkeyup(evt){if(evt.e.keyCode===13){var txtColor=this.txtColor1;if(txtColor&&$DOM.contains(txtColor.domNode,evt.getTarget())){this.parent.onColorAdding(this.color,true);}}}},{scriptClass:"mstrmojo.Label",alias:"label",cssClass:"paletteColorsLabel",text:mstrmojo.desc(14537,"Palette colors")},{scriptClass:"mstrmojo.ui.editors.controls.ColorList",alias:"colorList",cssClass:"mstrmojo-PaletteColorList",icnCss:"ColorsContainer",useRichTooltip:true,updateTooltipConfig:function(e){this.richTooltip=null;var itemNode=this.getItemNodeFromTarget($DOM.eventTarget(window,e));if(itemNode){this.richTooltip={refNode:itemNode,areaId:this.getItemFromTarget(itemNode)._renderIdx,cssClass:"vi-regular vi-tooltip-A A-center",content:mstrmojo.desc(14538,"Click to remove this color"),posType:mstrmojo.tooltip.POS_TOPCENTER,top:29,left:9};}},postselectionChange:function(evt){var added=evt.added;if(added){this.parent.onColorRemoving(this.items[added[0]].id);}},onclick:function onclick(evt){var item=this.getItemFromTarget(evt.getTarget());if(item){this.parent.onColorRemoving(item.id,true);}},onRender:function onRender(){this.hideTooltip();}}],buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(1442,"OK"),function(){var editor=this.parent.parent;editor.onOK();editor.close();},true,{alias:"okBtn"}),mstrmojo.Button.newWebButton(mstrmojo.desc(221,"Cancel"),function(){this.parent.parent.close();})]});}());