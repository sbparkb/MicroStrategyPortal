(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.Refine.HistogramWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.HistogramWidget",options:null,binMatrix:null,range:null,markupString:"<canvas></canvas>",update:function(min,max,step,binMatrix){if(min===undefined||max===undefined||binMatrix.length===0||binMatrix[0].length===0){this.range=null;this.binMatrix=null;this.parent.histogramNode.style.display="none";}else{this.range={min:min,max:max,step:step};this.binMatrix=binMatrix;this.peak=0;var i,j;for(i=0;i<binMatrix.length;i++){var row=binMatrix[i];for(j=0;j<row.length;j++){this.peak=Math.max(this.peak,row[j]);}}}if(this.binMatrix!==null){this.parent.histogramNode.style.display="block";this.resize();this._render();}},resize:function(){var height=this.options.height||(this.parent.hasOtherChoices()?54:73);this.domNode.height=height;this.domNode.width=this.parent.histogramNode.clientWidth;this.parent.histogramNode.style.height=height+"px";},_render:function(){var self=this;var options=this.options;var canvas=this.domNode;var ctx=canvas.getContext("2d");ctx.fillStyle="white";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.save();ctx.translate(0,canvas.height);ctx.scale(1,-1);var stepPixels=canvas.width/this.binMatrix[0].length;ctx.save();ctx.strokeStyle=options.emptyBinColor||"#faa";ctx.lineWidth=1;ctx.moveTo(0,0);ctx.lineTo(canvas.width,0);ctx.stroke();ctx.restore();var makeColor=function(i){var n=Math.floor(15*(self.binMatrix.length-i)/self.binMatrix.length);var h=n.toString(16);return"#"+h+h+h;};var renderRow=function(row,color,borderColor){ctx.save();ctx.lineWidth=0;ctx.fillStyle=color;ctx.strokeStyle=borderColor;var c;for(c=0;c<row.length;c++){var y=row[c];if(y>0){var left=c*stepPixels;var width=Math.ceil(stepPixels);var height=Math.max(2,Math.ceil(y*canvas.height/self.peak));ctx.fillRect(left,0,width,height);ctx.strokeRect(left,0,width,height);}}ctx.restore();};var r;for(r=0;r<this.binMatrix.length;r++){renderRow(this.binMatrix[r],options.hasOwnProperty("binBorderColors")&&r<options.binColors.length?options.binColors[r]:makeColor(r),options.hasOwnProperty("binBorderColors")&&r<options.binBorderColors.length?options.binBorderColors[r]:makeColor(r));}ctx.restore();}});}());