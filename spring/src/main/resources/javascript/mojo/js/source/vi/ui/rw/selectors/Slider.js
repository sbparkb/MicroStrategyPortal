(function(){mstrmojo.requiresCls("mstrmojo.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.dom","mstrmojo.hash","mstrmojo.css","mstrmojo.num");var $D=mstrmojo.dom,$C=mstrmojo.css,$HASH=mstrmojo.hash,$MAX=Math.max,$MIN=Math.min;mstrmojo.vi.ui.rw.selectors.Slider=mstrmojo.declare(mstrmojo.Slider,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.Slider",markupString:'<div class="mstrmojo-VISlider mstrmojo-Slider {@cssClass} {@clsOrientation}" style="{@cssText}" ><div class="sl-title"></div><div class="sl-control"></div><div class="cont" style="position:relative"><div class="bk" style="{@bkCssText}"></div><div class="sdc" style="position:absolute;{@sdcCssText}"><div class="sd" style="{@sdCssText}" mstrAttach:click><div class="bk left" style="{@lowerRangeCssText}"></div><div class="t1" style="{@handle1CssText}" mstrAttach:mouseout></div><div class="bk middle" style="{@thumbCssText}"></div><div class="t3" style="{@handel2CssText}" mstrAttach:mouseout></div><div class="bk right" style="{@upperRangeCssText}"></div></div></div><div class="mstrmojo-Label subscript left">{@lowText}</div><div class="mstrmojo-Label subscript right">{@highText}</div></div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},controlNode:function(){return this.domNode.childNodes[1];},dndNode:function(){return this.domNode.childNodes[2];},bgNode:function(){return this.domNode.childNodes[2].firstChild;},sdcNode:function(){return this.domNode.childNodes[2].childNodes[1];},containerNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild;},lowerRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.firstChild;},handle1Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1];},thumbNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[2];},handle2Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3];},upperRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.lastChild;},lowNode:function(){return this.domNode.childNodes[2].childNodes[2];},highNode:function(){return this.domNode.childNodes[2].childNodes[3];},tooltipNode:function(){return[this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3]];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onlowTextChange:function(){this.lowNode.innerHTML=this.lowText||"";},onhighTextChange:function(){this.highNode.innerHTML=this.highText||"";},onwidthChange:function(){this.synchronizeSlider();},onmultiSelectChange:function(){$C.toggleClass(this.domNode,"scm",this.multiSelect);$C.toggleClass(this.domNode,"sc1",!this.multiSelect);}},thumbWidth:14,sliderDefaultWidth:95,multiSelect:true,init:function init(p){this._super(p);this.updateTypeHelper();},updateTypeHelper:function updateTypeHelper(){var Cls=$HASH.walk("vi.ui.rw.selectors.SliderHelper",mstrmojo);this.typeHelper=new Cls({slider:this});},synchronizeSlider:function synchronizeSlider(){var orCfg=this.orCfg,T=this.typeHelper,dimension=orCfg.lenCssP,handleSize=this.thumbWidth,length=parseInt(this[dimension],10),effectiveLength;length=(isNaN(length)||length<=0)?this.sliderDefaultWidth:length;effectiveLength=$MAX(length-handleSize,0);if(effectiveLength>0){var bkLen=$MAX(length-(2*this.cssBkBW),0),sdcLen=effectiveLength;this.bkCssText=dimension+":"+bkLen+"px;";this.sdcCssText=orCfg.posCssP+":0px;"+dimension+":"+sdcLen+"px;"+orCfg.opPosCssP+":-1px;";if(this.hasRendered){this.bgNode.style[dimension]=bkLen+"px";this.sdcNode.style[dimension]=sdcLen+"px";}}this._effectiveLength=effectiveLength;T.initialSlider();T.updateThumb();T.updateSummary();},refresh:function(){this.updateTypeHelper();this._super();},configureGhost:function configureGhost(showGhost){var ghost=this.ghost;if(!ghost){var cn=this.containerNode.cloneNode(true),cnc=cn.childNodes;$C.addClass(cn,["gh"]);cn.style.display="none";ghost=this.ghost={containerNode:cn,lowerRange:cnc[0],handle1Node:cnc[1],thumbNode:cnc[2],handle2Node:cnc[3],upperRange:cnc[4]};this.sdcNode.appendChild(cn);}var orCfg=this.orCfg,position=orCfg.posCssP,length=orCfg.lenCssP,id=this.id;mstrmojo.array.forEach(["lowerRange","containerNode","thumbNode","upperRange"],function(nodeName,idx){var slider=mstrmojo.all[id],widgetNodeStyle=slider[nodeName].style,ghostNodeStyle=ghost[nodeName].style;if(idx){ghostNodeStyle[position]=widgetNodeStyle[position];}ghostNodeStyle[length]=widgetNodeStyle[length];});if(showGhost){ghost.containerNode.style.display="block";}return ghost;},initDrag:function initDrag(e,hWin){hWin=hWin||window;var td=$D.eventTarget(hWin,this.dnd.startE);if(td===this.handle1Node||td===this.handle2Node){var ghost=this.configureGhost(true),oc=this.orCfg,dnd=this.dnd;dnd.initD={handle1:parseFloat(this.handle1,10),handle2:parseFloat(this.handle2,10),length:this._effectiveLength,contL:ghost.containerNode[oc.lenP],offset:$D.getMousePosition(this.dnd.startE,hWin)[oc.offsetP]};dnd.initD.td=td;$C.removeClass(this.domNode,["invalid"]);}},ondrag:function ondrag(e,hWin){var T=this.typeHelper;hWin=hWin||window;var initD=this.dnd.initD;if(initD){var ghost=this.ghost,cs1Px=initD.handle1,cs2Px=initD.handle2,cs1Idx=this.cs1Idx,cs2Idx=this.cs2Idx,length=initD.length;var diff=$D.getMousePosition(e,hWin)[this.orCfg.offsetP]-initD.offset;switch(initD.td){case this.handle1Node:cs1Px=$MAX($MIN($MAX(initD.handle1+diff,0),length),-1);cs1Idx=T.getIdxByPx(cs1Px);break;case this.handle2Node:cs2Px=$MAX($MIN($MAX(initD.handle2+diff,0),length),-1);cs2Idx=T.getIdxByPx(cs2Px);break;default:return ;}T.positionSliderElements(ghost,cs1Px,cs2Px);var items=this.items,itemCount=(items&&items.length)||0;if(itemCount&&cs1Idx>=0&&cs1Idx<itemCount&&cs2Idx>=0&&cs2Idx<itemCount){var isChanged=false,itm;if(cs1Idx!==this.cs1Idx){this.cs1Idx=cs1Idx;itm=this.items[cs1Idx];this.cs1Vl=itm.v;this.cs1Nm=itm.n;isChanged=true;}if(cs2Idx!==this.cs2Idx){this.cs2Idx=cs2Idx;itm=this.items[cs2Idx];this.cs2Vl=itm.v;this.cs2Nm=itm.n;isChanged=true;}if(isChanged){T.updateThumb();this._updateTooltip({target:initD.td});}}}},ondrop:function ondrop(e){this.typeHelper.updateThumb();var ghost=this.ghost;if(ghost){ghost.containerNode.style.display="none";}this.hideTooltip(e,self);if(this.items&&this.items.length){this.onselectionChange();}this.dnd.initD=null;},onclick:function onclick(evt){var tgt=evt.getTarget();if(tgt===this.lowerRange||tgt===this.upperRange||tgt===this.thumbNode){var T=this.typeHelper,orientation=this.orCfg.offsetP,mousePos=$D.getMousePosition(evt.e)[orientation],handle1Diff=mousePos-$D.position(this.handle1Node)[orientation],handle2Diff=mousePos-$D.position(this.handle2Node)[orientation],items=this.items,cs1Idx,cs2Idx,csPx,itm,isChanged=false;if(items.length<2){return ;}if(Math.abs(handle1Diff)<Math.abs(handle2Diff)){csPx=$MAX($MIN($MAX(parseFloat(this.handle1,10)+handle1Diff,0),this._effectiveLength),-1);cs1Idx=T.getIdxByPx(csPx);if(this.cs1Idx!==cs1Idx){this.cs1Idx=cs1Idx;itm=items[cs1Idx];this.cs1Vl=itm.v;this.cs1Nm=itm.n;isChanged=true;}}else{csPx=$MAX($MIN($MAX(parseFloat(this.handle2,10)+handle2Diff,0),this._effectiveLength),-1);cs2Idx=T.getIdxByPx(csPx);if(this.cs2Idx!==cs2Idx){this.cs2Idx=cs2Idx;itm=items[cs2Idx];this.cs2Vl=itm.v;this.cs2Nm=itm.n;isChanged=true;}}if(isChanged){this.onselectionChange();T.updateThumb();}}},onselectionChange:function onselChg(evt){var T=this.typeHelper;T.updateSelection();T.updateSummary();this._super(evt);if(this.dnd&&this.dnd.initD){this.dnd.initD=null;}},_updateTooltip:function _updateTooltip(e,win){var tgt=$D.eventTarget(win,e);if(tgt){var tooltipMarkup="<span {@ttpCssText}>{@content}</span>",txt=String((tgt===this.handle1Node)?this.cs1Nm:this.cs2Nm).replace("$","$$$$"),tt={cssClass:"mstrmojo-VISlider vi-regular vi-tooltip-V "+mstrApp.getThemeClassName(),content:tooltipMarkup.replace(/\{@content\}/g,txt),contentNodeCssClass:"scm-tooltip",refNode:tgt,posType:this._tooltip_pos};this.set("richTooltip",tt);}}});}());