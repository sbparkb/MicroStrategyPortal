(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.EditorModel","mstrmojo.ui.editors.CharacterToolbarPopup","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.ui.editors.controls.LinkGroup","mstrmojo.NumStepperContentProvider","mstrmojo.hash");var $FORMAT_MODEL=mstrmojo.models.FormatModel,$ENUM_FORMAT_PROPERTIES=$FORMAT_MODEL.ENUM_PROPERTY_NAMES;mstrmojo.vi.models.editors.TextEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.EditorModel,null,{scriptClass:"mstrmojo.vi.models.TextEditorModel",help:"dashboard_editor_text_properties.htm",getEditorContents:function getEditorContents(){var hostFormats=this.getHost().getFormats(),fnGroupHandler=this.getChangeGroupPropertyFn(),characterGroup=new mstrmojo.ui.editors.controls.CharacterGroup({onGroupValueChange:fnGroupHandler,showNoFillInColor:false}),me=this,containerGroup=new mstrmojo.ui.editors.controls.ContainerGroup({showBackgroundNoFill:false,showBorderNoFill:false,onGroupValueChange:function(){me.getHost().parent.clearCache();fnGroupHandler.apply(null,arguments);}}),linkGroup=new mstrmojo.ui.editors.controls.LinkGroup({docModel:this.docModel,hostId:this.hostId,hostType:3});if(!mstrApp.allowWebDashboardDesign()){return[];}characterGroup.setFormatSource(hostFormats);containerGroup.setFormatSource(hostFormats);return[this.getEditorGroup([characterGroup]),this.getEditorGroup([this.getTextAlign(hostFormats["text-align"]||"left",this.getChangeFormatPropertyFn($ENUM_FORMAT_PROPERTIES.TEXT_ALIGN)),this.getWrapText(hostFormats["white-space"]!=="nowrap",this.getChangeFormatPropertyFn($ENUM_FORMAT_PROPERTIES.TEXT_WRAP)),this.getTextDirection(hostFormats.fx&&hostFormats.fx.rt,this.getChangeFormatPropertyFn($ENUM_FORMAT_PROPERTIES.TEXT_DIRECTION)),this.getOverflow(hostFormats.overflow==="auto",this.getChangeFormatPropertyFn($ENUM_FORMAT_PROPERTIES.TEXT_OVERFLOW))]),this.getEditorGroup([containerGroup]),this.getEditorGroup([linkGroup])];},getChangeFormatPropertyFn:function getChangeFormatPropertyFn(propertyName,formatType){var id=this.id;return function(newValue,oldValue){var editor=mstrmojo.all[id],unit=editor.getHost().parent,docModel=editor.docModel,formats=[{formatType:formatType||1,propertyName:propertyName,newValue:newValue,oldValue:oldValue}];docModel.saveUnitFormatProperty(unit,formats,{success:function(res){if(!(unit&&unit.parent)){unit=docModel.getSelectedViUnit();}var panel=unit.parent,unitKey=unit.k,textField=unit.boxContent;docModel.partialUpdate(null,docModel.getTargetDefn(unitKey),res.defn,[unitKey]);textField.update(textField.node);unit.refresh();panel.selectVIUnit(unit,true);}},mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION);};},getFormattingToolbar:function getFormattingToolbar(fmtTarget,anchorEl,props){var toolbar=new mstrmojo.ui.editors.CharacterToolbarPopup(mstrmojo.hash.copy({onGroupValueChange:this.getChangeGroupPropertyFn(),anchorElement:anchorEl},props));toolbar.setFormatSource(this.getHost().getFormats());return toolbar;}});}());