(function(){mstrmojo.requiresCls("mstrmojo.onetier.vi.ui.VIProjectBrowser","mstrmojo.func","mstrmojo.array","mstrmojo.Button");mstrmojo.requiresDescs(14092,14093,14094,14074,14091,11922,2397,13568);var $NWB=mstrmojo.Button.newWebButton,$A=mstrmojo.array,showDDAMessage=function(res,callback){var cubeInfo=res.cubeDLInfo||{},hasSecFilter=cubeInfo.hsf,getSizeLabel=function(sizeInMB){return"{"+(sizeInMB>=1024?(Math.round(sizeInMB*100/1024))/100+"GB":(sizeInMB+"MB"))+"}";},bigCubes=$A.filter(cubeInfo.cubes,function(cube){return(cube.cs||0)>(cubeInfo.maxcs*1024);}),acldCubes=$A.filter(cubeInfo.cubes,function(cube){return !!cube.acld;}),cubeNames=function(cubes,postfix){var res=[];$A.forEach(cubes,function(cube){res.push("\n"+cube.n+(postfix||""));});return res;},text;if(hasSecFilter){text=mstrmojo.desc(14092,"A security filter has been defined for you in this project, so you cannot download data in the selected dashboard. Therefore, you can only Connect Live.");}else{if(bigCubes.length===1){text=mstrmojo.desc(14093,'The size of the data set "#" is more than the download limit of ## set by the administrator. Therefore, you can only Connect Live.').replace("##",getSizeLabel(cubeInfo.maxcs)).replace("#",(bigCubes[0]||{}).n);}else{if(bigCubes.length>1){text=mstrmojo.desc(14094,"The size of the following data sets #is more than the download limit ## set by the administrator. Therefore, you can only Connect Live.").replace("##",getSizeLabel(cubeInfo.maxcs)).replace("#",cubeNames(bigCubes));}else{if(acldCubes.length>0){text=mstrmojo.desc(14074,"You do not have access to all the objects in the dashboard, the following data sets can not be downloaded:")+"\n"+cubeNames(acldCubes,mstrmojo.desc(14077,"(Access List)")).join()+"\n"+mstrmojo.desc(14091,"Therefore, you can only Connect Live.");}}}}if(text){mstrmojo.alert(text,null,mstrmojo.desc(11922,"Data Access Mode"),null,null,{buttons:[$NWB(mstrmojo.desc(2397,"OK"),function(){callback.success(res);return true;},true)]});}else{callback.success(res);}};mstrmojo.onetier.vi.ui.OpenFromServerBrowser=mstrmojo.declare(mstrmojo.onetier.vi.ui.VIProjectBrowser,null,{scriptClass:"mstrmojo.onetier.vi.ui.OpenFromServerBrowser",cssClass:"mstrmojo-SaveAsEditor mstrmojo-ViProjectBrowser server openFrom",title:mstrmojo.desc(13568,"Download from Server"),help:"pending.htm",browsableViewMedias:"2048,8192",afterLogin:function afterLogin(res){this._super(res);this.initBrowser("browsing");},validate:function validate(){this.buttonBox.openButton.set("enabled",!!this.selectedItem&&!!this.selectedFolder);},openCallback:function openCallback(params,callback){var ed=this;ed.toggleNativeMenus(false);var getPollingStataus=function getPollingStatus(data,callback){ed.connectivityProxy.getPollingStatus({id:data.id},{success:function success(res){switch(res.status){case 1:case 2:mstrApp.getRootController().showOrHideProgressBar(mstrmojo.desc(13568,"Download from server"),false);ed.toggleNativeMenus(true);if(res.status===2){if(callback.failure){callback.failure(res.data);}}else{showDDAMessage(res.data,callback);ed.connectivityProxy.refreshNativeDialogMenu();}case 4:mstrApp.getRootController().showOrHideProgressBar(mstrmojo.desc(13568,"Download from server"),false);ed.toggleFields.call(ed,"browsing");if(callback.complete){callback.complete();}return ;default:mstrApp.getRootController().updateProgressBar({pct:res.pct,msg:res.msg,requestID:data.id,canCancel:res.status===0});getPollingStataus(res,callback);}},failure:function failure(res){mstrApp.getRootController().showOrHideProgressBar(mstrmojo.desc(13568,"Download from server"),false);if(callback.complete){callback.complete();}if(callback.failure){callback.failure(res);}}});};this.connectivityProxy.openFromServer({objectID:params.objectId,objType:params.objType,sessionState:params.sessionState},{success:function(res){mstrApp.getRootController().showOrHideProgressBar(mstrmojo.desc(13568,"Download from server"),true);getPollingStataus({id:res.id},callback);},failure:function(res){ed.toggleNativeMenus(true);callback.failure(res);}});},openOb:function openOb(){this.toggleFields.call(this,"loading");if(this.openCallback){var selectedItem=this.selectedItem;this.openCallback({selectedProject:this.loginToProjectBox.currentProject,sessionState:this.sessionState,folderId:this.selectedFolder.did,objectId:selectedItem.did,name:selectedItem.n,objType:selectedItem.t,connectionId:this.connectionId},{success:function(res){var dataProvider=mstrApp.rootCtrl.dataProvider;var selectedProject=mstrApp.rootCtrl.selectedProject;this.cacheCurrentFolder();this.close();mstrApp.start(res);mstrApp.rootCtrl.set("dataProvider",dataProvider);mstrApp.rootCtrl.set("selectedProject",selectedProject);}.bind(this),failure:function(res){this.toggleFields.call(this,"browsing");if(res){this.onError(res);}}.bind(this)});}else{this.onError("no open callback has been provided for VIProject Browser");}}});}());