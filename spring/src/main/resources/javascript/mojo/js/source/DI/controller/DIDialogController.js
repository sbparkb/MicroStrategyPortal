(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.Obj","mstrmojo.Editor","mstrmojo.qb.es.AlternateSourceDialog","mstrmojo.DI.DIProjectsAttribute","mstrmojo.DI.DIHelpers","mstrmojo.vi.ui.editors.ObjectPicker");mstrmojo.requiresClsP("mstrmojo.DI","DIConstants","DIRootView","DIAllObjectsView","DIRepublishScheduleEditor","DIMultiFormEditor","DIPartitionGroupDialog","DIOAuthParaEditor","DIWhiteListEditor","DIProjectsAttribute","DITwitterAdvancedOptions");mstrmojo.requiresClsP("mstrmojo.DI.ui.dialogs","DICubesListDialog","DIMissingColumnsDialog","DIPageDialog","DIRefreshHistoryDialog","DIDirectAccessConfirmDialog","DISaveAsDialog","DISheetsSelectionDialog","DIParseDataDialog","DIQBImportOptionDialog","DICredentialsDialog","DIMapProjectAttributeDialog");mstrmojo.requiresClsP("mstrmojo.Refine","RefineClusteringDialog","RefineExtractDialog","RefineImportDialog");mstrmojo.requiresDescs(189,221,1442,3610,8973,11581,12579,12580,13010,13191,13192,13193,13194,13309,13310,13311,13312,13313,13314,13315,13316,13317,13329,13330,13303,14296);var $MOJO=mstrmojo,constants=$MOJO.DI.DIConstants,$ARR=$MOJO.array,$DOM=$MOJO.dom,$CSS=$MOJO.css,$HELPER=$MOJO.DI.DIHelpers,currentZIndex=15;var PICK_TABLES=mstrmojo.desc(13309,"Pick Tables"),PICK_TABLES_SUBTITLE=mstrmojo.desc(13310,"Select single or multiple tables to import via 'SQL on hadoop'"),BUILD_QUERY=mstrmojo.desc(13193,"Build a Query"),BUILD_QUERY_SUBTITLE=mstrmojo.desc(13311,"Use a graphical interface to build a 'SQL on hadoop' query to import a table"),TYPE_QUERY=mstrmojo.desc(13194,"Type a Query"),TYPE_QUERY_SUBTITLE=mstrmojo.desc(13312,"Paste or write a query script to import a table via 'SQL on Hadoop' or Pig"),HADOOP_FILE=mstrmojo.desc(13313,"Browse Hadoop Files using MicroStrategy Big Data Engine"),HADOOP_FILE_SUBTITLE=mstrmojo.desc(13314,"Import tables by browsing HDFS(Hadoop Distributed File System)"),PICK_TABLES_ODBC_SUBTITLE=mstrmojo.desc(13315,"Select single or multiple tables to import"),BUILD_QUERY_ODBC_SUBTITLE=mstrmojo.desc(13316,"Use a graphical interface to build a SQL query to import a table"),TYPE_QUERY_ODBC_SUBTITLE=mstrmojo.desc(13317,"Paste or write a query script to import a table");var OPTIONS=[PICK_TABLES,BUILD_QUERY,TYPE_QUERY];var OPTIONS_HADOOP=[HADOOP_FILE,PICK_TABLES,BUILD_QUERY,TYPE_QUERY];var OPTIONS_ODBC=[PICK_TABLES,BUILD_QUERY,TYPE_QUERY];var OPTIONS_sub=[PICK_TABLES_SUBTITLE,BUILD_QUERY_SUBTITLE,TYPE_QUERY_SUBTITLE];var OPTIONS_HADOOP_sub=[HADOOP_FILE_SUBTITLE,PICK_TABLES_SUBTITLE,BUILD_QUERY_SUBTITLE,TYPE_QUERY_SUBTITLE];var OPTIONS_ODBC_sub=[PICK_TABLES_ODBC_SUBTITLE,BUILD_QUERY_ODBC_SUBTITLE,TYPE_QUERY_ODBC_SUBTITLE];var FIX_REFRESH_DIALOG="fixRefreshDialog",fixRefreshDialogConfig={scriptClass:"mstrmojo.Editor",id:FIX_REFRESH_DIALOG,showTitle:false,zIndex:999,onOpen:function onOpen(){var controller=mstrApp.getRootController();controller.rootView=this.rootView;controller.fetchCubeInfoEMMA();},onClose:function onClose(){var controller=mstrApp.getRootController();controller.dialogController.pageZIndex--;},children:[{scriptClass:"mstrmojo.DI.DIRootView",alias:"rootView"}]};function isDetailErrorMessageEnabled(){return true;}var errorBoxConfig={scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-di-errorBox",draggable:false,showTitle:true,zIndex:99999,showCancel:false,errorMessage:mstrmojo.desc(12579,"Error when running the application"),onmousedown:function(evt){$DOM.stopPropogation(evt.hWin,evt.e);},onOpen:function(){this.helpNode.style.display="none";var st=this.curtainNode.style;var editor=this;st.background="black";st.opacity=0.5;st.filter="alpha(opacity=50)";this.message.domNode.innerHTML=this.errorMessage+" ";var linkNode=document.createElement("A");linkNode.href="#";linkNode.innerHTML=mstrmojo.desc(189,"Details");linkNode.className="mstrmojo-di-error-link";$CSS.toggleClass(editor.message.domNode,"off",true);$DOM.attachEvent(linkNode,"click",function(e){var collapsed=$HELPER.expandNode(editor.detailMessage);$CSS.toggleClass(editor.message.domNode,"off",!collapsed);$CSS.toggleClass(linkNode,"on",collapsed);$DOM.preventDefault(window,e);});this.detailMessage.domNode.innerHTML=this.detailErrorMessage;if(this.cancelBtnText){this.cancelButton.set("text",this.cancelBtnText);}if(this.okBtnText){this.okButton.set("text",this.okBtnText);}if(isDetailErrorMessageEnabled()){if(this.detailErrorMessage){this.message.domNode.appendChild(linkNode);}this.detailMessage.set("visible",false);}else{this.detailMessage.set("visible",false);}this.cancelButton.set("visible",this.showCancel);},children:[{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-di-errorMessage off",alias:"message",text:mstrmojo.desc(12580,"Unexpected error occured during an operation. Please try again."),cssDisplay:""},{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-di-errorMessage-detail",alias:"detailMessage",visible:false},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",alias:"cancelButton",text:mstrmojo.desc(221,"Cancel"),cssText:"float:right; margin-left:10px;",onclick:function(){var e=this.parent;e.close();if(e.onCancel){e.onCancel();}}},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),alias:"okButton",onclick:function(){var e=this.parent;e.close();if(e.onOK){e.onOK();}}}]};var INPUT_NAME_BOX_ID="inputNameBox",inputNameBoxConfig={scriptClass:"mstrmojo.Editor",id:INPUT_NAME_BOX_ID,cssClass:"mstrmojo-di-inputNameBox",draggable:true,showTitle:true,zIndex:999,title:mstrmojo.desc(13329,"Please rename the attribute to unmap it"),noButtonCls:true,text:mstrmojo.desc(13330,"Please rename to unmap this attribute"),buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(13303,"Unmap"),onclick:function(){var p=this.parent.parent;var newName=p.input.value;if(p.onOk){if(p.onOk(newName)){p.close();}}else{p.close();}},bindings:{enabled:function(){return this.parent.parent.input.value.length>0;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var p=this.parent.parent;p.close();if(p.onCancel){p.onCancel();}}}],children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-inputNameBox-text",bindings:{text:"this.parent.text"}},{scriptClass:"mstrmojo.Box",markupString:'<span id="{@id}" class="{@cssClass}">{@text}</span>',cssClass:"mstrmojo-di-inputNameBox-inputText",cssDisplay:"inline",text:mstrmojo.desc(13010,"New Name:")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-inputNameBox-input",alias:"input",onEnter:function(){var p=this.parent;var newName=this.value;if(p.onOk){if(p.onOk(newName)){p.close();}}else{p.close();}}}],onOpen:function(){this.input.set("value",this.curName);this.input.focus();}};var missingColumnsDialogID,allObjectsDialogID,cubesListID,refreshHistoryDialogID,publishStatusDialogID,saveAsDialogID,alternateSourceValidateDialogID,multiFormEditorID,sheetsSelectionDialogID,partitionGroupDialogID,parseDataDialogID,errorDialogID,warningDialogID,relationDefineDialogID,qbImportOptionDialogID,pageDialogID,setOAuthParaDialogID,mapProjectAttributeID,twitterAdvOptDialogID,credentialsDialogID,setWhiteListDialogID;mstrmojo.DI.controller.DIDialogController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDialogController",pageZIndex:0,hasDialog:function hasDialog(dialogType){var hasCreated=false;switch(dialogType){case constants.dialogType.publishStatusDialog:var publishStatusDialog=mstrmojo.all[publishStatusDialogID];if(publishStatusDialog){hasCreated=true;}break;case constants.dialogType.cubesList:if(mstrmojo.all[cubesListID]){hasCreated=true;}break;}return hasCreated;},getNextZIndex:function getNextZIndex(){var ret=currentZIndex;currentZIndex+=2;if(mstrApp.sessionManager){mstrApp.sessionManager.set("zIndex",currentZIndex+1);}return ret;},getCurrentZIndex:function getCurrentZIndex(){return currentZIndex;},centerPageDialog:function(){if(pageDialogID&&mstrmojo.all[pageDialogID]){mstrmojo.dom.center(mstrmojo.all[pageDialogID].editorNode);}},close:function close(dialogType){var dialog;switch(dialogType){case constants.dialogType.publishStatusDialog:dialog=mstrmojo.all[publishStatusDialogID];break;case constants.dialogType.cubesList:dialog=mstrmojo.all[cubesListID];break;case constants.dialogType.errorDialog:dialog=mstrmojo.all[errorDialogID];break;}if(dialog&&dialog.visible){dialog.close();}},destroyAll:function destroyAll(){if(mstrmojo.all[publishStatusDialogID]){mstrmojo.all[publishStatusDialogID].destroy();}if(mstrmojo.all[missingColumnsDialogID]){mstrmojo.all[missingColumnsDialogID].destroy();}if(mstrmojo.all[credentialsDialogID]){mstrmojo.all[credentialsDialogID].destroy();}if(mstrmojo.all[allObjectsDialogID]){mstrmojo.all[allObjectsDialogID].destroy();}if(mstrmojo.all[cubesListID]){mstrmojo.all[cubesListID].destroy();}if(mstrmojo.all[refreshHistoryDialogID]){mstrmojo.all[refreshHistoryDialogID].destroy();}if(mstrmojo.all[alternateSourceValidateDialogID]){mstrmojo.all[alternateSourceValidateDialogID].destroy();}if(mstrmojo.all[saveAsDialogID]){mstrmojo.all[saveAsDialogID].destroy();}if(mstrmojo.all[multiFormEditorID]){mstrmojo.all[multiFormEditorID].destroy();}if(mstrmojo.all[sheetsSelectionDialogID]){mstrmojo.all[sheetsSelectionDialogID].destroy();}if(mstrmojo.all[allObjectsDialogID]){mstrmojo.all[allObjectsDialogID].destroy();}if(mstrmojo.all[mapProjectAttributeID]){mstrmojo.all[mapProjectAttributeID].destroy();}if(mstrmojo.all[twitterAdvOptDialogID]){mstrmojo.all[twitterAdvOptDialogID].destroy();}if(parseDataDialogID){$ARR.forEach(parseDataDialogID,function(id){if(mstrmojo.all[id]){mstrmojo.all[id].destroy();}});}},show:function show(dialogType,config){var dialog=null,model,controller,cls;config=config||{};config.zIndex=this.getNextZIndex();switch(dialogType){case constants.dialogType.setOAuthParaDialog:dialog=mstrmojo.all[setOAuthParaDialogID];if(!dialog){dialog=new mstrmojo.DI.DIOAuthParaEditor();}dialog.open(null,config);setOAuthParaDialogID=dialog.id;break;case constants.dialogType.setWhiteListDialog:dialog=mstrmojo.all[setWhiteListDialogID];if(!dialog){dialog=new mstrmojo.DI.DIWhiteListEditor();}dialog.open(null,config);setWhiteListDialogID=dialog.id;break;case constants.dialogType.fixRefreshErrorDialog:dialog=mstrmojo.all[FIX_REFRESH_DIALOG];if(!dialog){dialog=mstrmojo.insert(mstrmojo.hash.copy(config,fixRefreshDialogConfig));}dialog.open(null,config);this.pageZIndex++;break;case constants.dialogType.allObjectsViewDialog:dialog=mstrmojo.all[allObjectsDialogID];if(!dialog){dialog=new mstrmojo.DI.DIAllObjectsView();}dialog.open(null,config);allObjectsDialogID=dialog.id;break;case constants.dialogType.missingColumnsDialog:dialog=mstrmojo.all[missingColumnsDialogID];if(!dialog){dialog=new mstrmojo.DI.ui.dialogs.DIMissingColumnsDialog();}dialog.open(null,config);missingColumnsDialogID=dialog.id;break;case constants.dialogType.credentialsDialog:dialog=mstrmojo.all[credentialsDialogID];if(!dialog){dialog=new mstrmojo.DI.ui.dialogs.DICredentialsDialog();}dialog.open(null,config);credentialsDialogID=dialog.id;break;case constants.dialogType.diPageDialog:dialog=new mstrmojo.DI.ui.dialogs.DIPageDialog();dialog.open(null,config);pageDialogID=dialog.id;this.pageZIndex++;break;case constants.dialogType.ddaConfirmDialog:dialog=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog();dialog.open(null,config);break;case constants.dialogType.refreshHistoryDialog:dialog=mstrmojo.all[refreshHistoryDialogID];if(!dialog){dialog=new mstrmojo.DI.ui.dialogs.DIRefreshHistoryDialog();}dialog.open(null,config);refreshHistoryDialogID=dialog.id;break;case constants.dialogType.alternateSourceValidateDialog:dialog=mstrmojo.all[alternateSourceValidateDialogID];if(!dialog){dialog=new mstrmojo.qb.es.AlternateSourceDialog();}dialog.open(null,config);alternateSourceValidateDialogID=dialog.id;break;case constants.dialogType.publishStatusDialog:dialog=mstrmojo.all[publishStatusDialogID];cls="mstrmojo-di-scheduleEMMA ";model=mstrApp.getRootController().getModel();switch(model.operationMode){case constants.operationMode.create:cls+="createMode";break;case constants.operationMode.refresh:cls+="refreshMode";break;case constants.operationMode.edit:cls+="editMode";break;case constants.operationMode.subscribe:cls+="subscribeMode";break;}if(!dialog){dialog=new mstrmojo.DI.DIRepublishScheduleEditor({cssClass:cls});}dialog.open(null,config);publishStatusDialogID=dialog.id;break;case constants.dialogType.saveAsDialog:dialog=new mstrmojo.DI.ui.dialogs.DISaveAsDialog();this.addDisposable(dialog);dialog.open(null,config);break;case constants.dialogType.cubesList:dialog=mstrmojo.all[cubesListID];if(!dialog){dialog=new mstrmojo.DI.ui.dialogs.DICubesListDialog();cubesListID=dialog.id;}dialog.open(null,config);break;case constants.dialogType.refinePage:controller=mstrApp.getRootController();dialog=new mstrmojo.Refine.RefinePopupPage({controller:controller});var refinePanel=controller.refineApp.getRefinePanel();refinePanel.slot="refinePanelNode";dialog.addChildren([refinePanel]);dialog.open(null,config);break;case constants.dialogType.refineClusteringPage:dialog=new mstrmojo.Refine.RefineClusteringDialog();dialog.open(null,config);break;case constants.dialogType.refineExtractDialog:dialog=new mstrmojo.Refine.RefineExtractDialog();dialog.open(null,config);break;case constants.dialogType.refineImportDialog:controller=mstrApp.getRootController();dialog=new mstrmojo.Refine.RefineImportDialog();dialog.open(null,config);break;case constants.dialogType.multiFormEditor:dialog=new mstrmojo.DI.DIMultiFormEditor();dialog.open(null,config);this.addDisposable(dialog);break;case constants.dialogType.sheetsSelectionDialog:dialog=sheetsSelectionDialogID&&mstrmojo.all[sheetsSelectionDialogID];if(!dialog){dialog=new mstrmojo.DI.ui.dialogs.DISheetsSelectionDialog();}dialog.open(null,config);sheetsSelectionDialogID=dialog.id;break;case constants.dialogType.partitionGroupDialog:dialog=partitionGroupDialogID&&mstrmojo.all[partitionGroupDialogID];if(!dialog){dialog=new mstrmojo.DI.DIPartitionGroupDialog();}dialog.open(null,config);partitionGroupDialogID=dialog.id;break;case constants.dialogType.parseDataDialog:var dialogId=config.id;dialog=dialogId&&mstrmojo.all[dialogId];if(!parseDataDialogID){parseDataDialogID=[];}if(!dialog){parseDataDialogID.push(dialogId);dialog=new mstrmojo.DI.ui.dialogs.DIParseDataDialog({id:dialogId,tableID:config.tableID});}dialog.open(null,config);break;case constants.dialogType.errorDialog:dialog=errorDialogID&&mstrmojo.all[errorDialogID];if(!dialog){dialog=mstrmojo.insert(errorBoxConfig);}dialog.open(null,config);errorDialogID=dialog.id;break;case constants.dialogType.warningDialog:dialog=warningDialogID&&mstrmojo.all[warningDialogID];if(!dialog){dialog=mstrmojo.insert(errorBoxConfig);}dialog.open(null,config);warningDialogID=dialog.id;break;case constants.dialogType.relationDefineDialog:dialog=relationDefineDialogID&&mstrmojo.all[relationDefineDialogID];if(!dialog){dialog=new mstrmojo.DI.DIRelationshipDefineEditor();}dialog.open(null,config);relationDefineDialogID=dialog.id;break;case constants.dialogType.qbImportOptionDialog:dialog=qbImportOptionDialogID&&mstrmojo.all[qbImportOptionDialogID];if(!dialog){dialog=new mstrmojo.DI.ui.dialogs.DIQBImportOptionDialog();}var items_hadoop=[{did:"2",n:OPTIONS[1],sub:OPTIONS_sub[1]},{did:"3",n:OPTIONS[2],sub:OPTIONS_sub[2]},{did:"1",n:OPTIONS[0],sub:OPTIONS_sub[0]}],items_hadoop_all=[{did:"0",n:OPTIONS_HADOOP[0],sub:OPTIONS_HADOOP_sub[0]},{did:"2",n:OPTIONS_HADOOP[2],sub:OPTIONS_HADOOP_sub[2]},{did:"3",n:OPTIONS_HADOOP[3],sub:OPTIONS_HADOOP_sub[3]},{did:"1",n:OPTIONS_HADOOP[1],sub:OPTIONS_HADOOP_sub[1]}],items_ODBC=[{did:"2",n:OPTIONS_ODBC[1],sub:OPTIONS_ODBC_sub[1]},{did:"3",n:OPTIONS_ODBC[2],sub:OPTIONS_ODBC_sub[2]},{did:"1",n:OPTIONS_ODBC[0],sub:OPTIONS_ODBC_sub[0]}],items_SAPHanaDDA=[{did:"1",n:OPTIONS_ODBC[0],sub:OPTIONS_ODBC_sub[0]}],items_HasNonSAPHana=[{did:"2",n:OPTIONS_ODBC[1],sub:OPTIONS_ODBC_sub[1]},{did:"3",n:OPTIONS_ODBC[2],sub:OPTIONS_ODBC_sub[2]}];if(config.isContainHadoop&&!mstrApp.isSingleTier){dialog.set("items",items_hadoop_all);}else{if(config.isSAPHanaDDA){dialog.set("items",items_SAPHanaDDA);}else{if(config.isSAPHana){dialog.set("items",mstrApp.isSingleTier?items_HasNonSAPHana:items_ODBC);}else{if(config.isODBC){dialog.set("items",items_ODBC);}else{dialog.set("items",items_hadoop);}}}}dialog.set("srcInfo",config.srcInfo);dialog.open(null,config);qbImportOptionDialogID=dialog.id;break;case constants.dialogType.previewRenameDialog:dialog=mstrmojo.all[INPUT_NAME_BOX_ID];if(!dialog){dialog=mstrmojo.insert(mstrmojo.hash.copy(config,inputNameBoxConfig));}dialog.open(null,config);this.pageZIndex++;break;case constants.dialogType.mapProjectsAttributeDialog:dialog=mstrmojo.all[mapProjectAttributeID];if(!dialog){dialog=new mstrmojo.DI.DIProjectsAttribute();}dialog.set("attribute",config.attribute);dialog.set("formMaps",config.formMaps);dialog.set("projectAttribute",null);dialog.set("projectFormMaps",null);dialog.open(null,config);dialog.updateHintText();mapProjectAttributeID=dialog.id;break;case constants.dialogType.mapProjectsAttributeDialog2:dialog=new mstrmojo.DI.ui.dialogs.DIMapProjectAttributeDialog(config);dialog.open(null,config);this.addDisposable(dialog);break;case constants.dialogType.objectPicker:dialog=new mstrmojo.vi.ui.editors.ObjectPicker(config);if(config.oTypes){dialog.browsableTypes=$ARR.hash(config.oTypes);dialog.ob.browsableTypes="8,"+config.oTypes.join(",");}this.addDisposable(dialog);dialog.open();break;case constants.dialogType.twitterAdvOptDialog:dialog=mstrmojo.all[twitterAdvOptDialogID];if(!dialog){dialog=new mstrmojo.DI.DITwitterAdvancedOptions(config);}dialog.open(null,config);break;}if(dialog){mstrmojo.dom.center(dialog.editorNode);mstrmojo.css.toggleClass(dialog.domNode,"mstrmojo-di-popup-dialog",true);$HELPER.reevaluatePopupPosition(dialog.editorNode);}return dialog;}});var alertDialogID;mstrmojo.DI.controller.DIDialogController.showErrorDialog=function(genericMsg,detailedMsg,callback,title,alertCfg){var alertDialog,newCfg={title:title||(mstrApp.isSingleTier?mstrmojo.desc(14296,"MicroStrategy Desktop"):mstrmojo.desc(3610,"MicroStrategy Web")),errorMessage:genericMsg,detailErrorMessage:detailedMsg||"",onOK:callback||null};if(alertCfg){mstrmojo.hash.copy(alertCfg,newCfg);}alertDialog=alertDialogID&&mstrmojo.all[alertDialogID];if(!alertDialog){alertDialog=mstrmojo.insert(errorBoxConfig);}alertDialog.open(null,newCfg);alertDialogID=alertDialog.id;};mstrmojo.DI.controller.DIDialogController.showConnectionError=function(){var id=null;mstrmojo.DI.controller.DIDialogController.hideConnectionError=function(){mstrmojo.all[id].close();};var errorMessage=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),replaceStr='<a href="" onclick=" mstrmojo.DI.controller.DIDialogController.hideConnectionError(); delete  mstrmojo.DI.controller.DIDialogController.hideConnectionError; window.FormWrapper.showProxyEditor();return false;">'+mstrmojo.desc(14125,"settings")+"</a>";errorMessage=errorMessage.replace("#",replaceStr)+".";var dialog=mstrmojo.insert(errorBoxConfig);dialog.open(null,{title:mstrmojo.desc(11812,"Notification"),errorMessage:errorMessage,detailErrorMessage:"",onOK:null});id=dialog.id;};}());