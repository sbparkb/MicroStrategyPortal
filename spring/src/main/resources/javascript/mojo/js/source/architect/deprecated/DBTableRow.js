(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom");var $DOM=mstrmojo.dom,doc=mstrmojo.global.document,avatarEl;function makeTable(h,w){var indent=this.indent,table='<div style="display:'+this.display+(h?"height:"+h+"px;":"")+(w?"width:"+w+"px;":"")+';"> <table style="width: 100%; border-collapse:collapse;border-spacing=0px;table-layout: fixed;"> <tr>',i;if(this.supportsubItems&&this.rowItems.length){table+='<td width="13px"><img class="mstrmojo-architect-DBTableRow-state" src="../images/1ptrans.gif"></td>';}for(i=0;i<indent;i++){table+='<td width="13px"></td>';}table+='<td width="20px"><span class="mstrmojo-ArchitectListIconBlock t'+this.tp+'" ></span></td>';table+='<td  style="overflow:hidden;text-overflow:ellipsis;">'+this.text+"</td>";var attrTables=this.Obj&&this.Obj.tbls;if(attrTables&&attrTables.length>1){table+='<td width="40px"><span class="mstrmojo-ArchitectListIconBlock tlink" ></span></td>';}table+="</tr> </table> </div>";return table;}function updateAvatar(pos,allowDrop,html){if(html){avatarEl.firstChild.innerHTML=html;}var avatarStyle=avatarEl.style;avatarStyle.left=pos.x+"px";avatarStyle.top=pos.y+"px";}function showAvatar(html,pos){var avatarStyle=avatarEl&&avatarEl.style;if(!avatarEl){avatarEl=doc.createElement("div");avatarStyle=avatarEl.style;avatarStyle.position="absolute";avatarStyle["z-index"]=9999;avatarEl.className="mstrmojo-Architect-TableRow-avatar";avatarEl.innerHTML="<div></div>";doc.body.appendChild(avatarEl);}updateAvatar(pos,true,html);avatarStyle.display="block";}function hideAvatar(){if(avatarEl){avatarEl.style.display="none";}}mstrmojo.architect.DBTableRow=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.architect.DBTableRow",indent:0,text:"",checkBox:false,draggable:true,ownAvatar:true,_leftPos:0,_topPos:0,rowItems:[],movable:false,dropTarget:null,markupString:'<div id="{@id}" class="mstrmojo-qb-DBTableRow {@cssClass}" style="{@cssText}"><div></div><div class="subItems"></div></div>',markupMethods:{ontextChange:function(){this.domNode.firstChild.innerHTML=makeTable.call(this);}},markupSlots:{formContainerNode:function formContainerNode(){return this.domNode.lastChild;}},children:[{scriptClass:"mstrmojo.List",alias:"formlist",slot:"formContainerNode"}],onrowItemsChange:function onrowItemsChange(){this.formlist.set("items",this.rowItems);},getDragData:function getDragData(c){return this;},ondragstart:function ondragstart(c){var n=c.src.node,tn=this.domNode;if($DOM.contains(tn,n,true,document.body)){if($DOM.isWK){document.onselectstart=function(e){e.preventDefault();return false;};}this.domNode.style.cssText="opacity:0.3; filter: alpha(opacity=30);";showAvatar(makeTable.call(this,this.domNode.offsetHeight,this.domNode.offsetWidth),$DOM.position(this.domNode));c.event="MapElement";return true;}return false;},ondragmove:function ondragmove(c){var e=c.tgt.pos;updateAvatar({x:e.x+5,y:e.y+5},true);},ondragend:function ondragend(c){if($DOM.isWK){document.onselectstart=function(e){return true;};}if(this.domNode){this.domNode.style.cssText="opacity:1; filter: alpha(opacity=100);";}hideAvatar();}});}());