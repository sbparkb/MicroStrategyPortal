(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(14723,14735);mstrmojo.Refine.RefineHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.Refine.RefineHelpers.completely=function(container,config){config=config||{};config.fontSize=config.fontSize||"16px";config.fontFamily=config.fontFamily||"sans-serif";config.promptInnerHTML=config.promptInnerHTML||"";config.color=config.color||"#000";config.hintColor=config.hintColor||"#aaa";config.backgroundColor=config.backgroundColor||"#fff";config.dropdownBackgroundColor=config.dropdownBackgroundColor||"#f3f3f4";config.dropDownBorderColor=config.dropDownBorderColor||"#aaa";config.dropDownZIndex=config.dropDownZIndex||"100";config.dropDownOnHoverBackgroundColor=config.dropDownOnHoverBackgroundColor||"#dadada";var txtInput=document.createElement("input");txtInput.type="text";txtInput.spellcheck=false;txtInput.style.fontSize=config.fontSize;txtInput.style.fontFamily=config.fontFamily;txtInput.style.color=config.color;txtInput.style.backgroundColor=config.backgroundColor;txtInput.style.width="100%";txtInput.style.outline="0";txtInput.style.border="0";txtInput.style.margin="0";txtInput.style.padding="0";var txtHint=txtInput.cloneNode();txtHint.disabled="";txtHint.style.position="absolute";txtHint.style.top="0";txtHint.style.left="0";txtHint.style.borderColor="transparent";txtHint.style.boxShadow="none";txtHint.style.color=config.hintColor;txtHint.style.visibility="hidden";txtInput.style.backgroundColor="transparent";txtInput.style.verticalAlign="top";txtInput.style.position="relative";var wrapper=document.createElement("div");wrapper.style.position="relative";wrapper.style.outline="0";wrapper.style.border="0";wrapper.style.margin="0";wrapper.style.padding="0";var prompt=document.createElement("div");prompt.style.position="absolute";prompt.style.outline="0";prompt.style.margin="0";prompt.style.padding="0";prompt.style.border="0";prompt.style.fontSize=config.fontSize;prompt.style.fontFamily=config.fontFamily;prompt.style.color=config.color;prompt.style.backgroundColor=config.backgroundColor;prompt.style.top="0";prompt.style.left="0";prompt.style.overflow="hidden";prompt.innerHTML=config.promptInnerHTML;prompt.style.background="transparent";if(document.body===undefined){throw"document.body is undefined. The library was wired up incorrectly.";}document.body.appendChild(prompt);var w=prompt.getBoundingClientRect().right;wrapper.appendChild(prompt);prompt.style.visibility="visible";prompt.style.left="-"+w+"px";wrapper.style.marginLeft=w+"px";wrapper.appendChild(txtHint);wrapper.appendChild(txtInput);var dropDownContainer=document.createElement("div");dropDownContainer.style.position="absolute";dropDownContainer.style.visibility="hidden";dropDownContainer.style.padding="5px 0px";dropDownContainer.style.backgroundColor=config.dropdownBackgroundColor;dropDownContainer.style.borderWidth="1px";dropDownContainer.style.borderColor=config.dropDownBorderColor;dropDownContainer.style.borderStyle="solid";var dropDown=document.createElement("div");dropDown.style.position="relative";dropDown.style.outline="0";dropDown.style.margin="0";dropDown.style.padding="0";dropDown.style.textAlign="left";dropDown.style.fontSize=config.fontSize;dropDown.style.fontFamily=config.fontFamily;dropDown.style.zIndex=config.dropDownZIndex;dropDown.style.cursor="default";dropDown.style.overflowX="hidden";dropDown.style.whiteSpace="pre";dropDown.style.overflowY="scroll";dropDown.style.width=config.width+"px";var createDropDownController=function(elem,elemContainer){var rows=[];var ix=0;var oldIndex=-1;var onMouseOver=function(){this.style.backgroundColor="#e6e6e6";};var onMouseOut=function(){if(rows.indexOf(this)===oldIndex){this.style.backgroundColor=config.dropDownOnHoverBackgroundColor;}else{this.style.backgroundColor=config.dropdownBackgroundColor;}};var onMouseDown=function(){p.hide();p.onmouseselection(this.__hint);};var p={hide:function(){elemContainer.style.visibility="hidden";},refresh:function(token,array){elemContainer.style.visibility="hidden";ix=-1;elem.innerHTML="";var vph=(window.innerHeight||document.documentElement.clientHeight);var rect=elemContainer.parentNode.getBoundingClientRect();var distanceToTop=rect.top-6;var distanceToBottom=vph-rect.bottom-6;rows=[];var i;for(i=0;i<array.length;i++){if(array[i].toLowerCase().indexOf(token.toLowerCase())!==0){continue;}var divRow=document.createElement("div");divRow.style.color=config.color;divRow.style.padding="0px 0px 0px 9px";divRow.style.height="22px";divRow.style.lineHeight="22px";divRow.style.overflow="hidden";divRow.style.textOverflow="ellipsis";divRow.style.whiteSpace="nowrap";divRow.onmouseover=onMouseOver;divRow.onmouseout=onMouseOut;divRow.onmousedown=onMouseDown;divRow.title=divRow.__hint=array[i];divRow.innerHTML=mstrmojo.string.encodeHtmlString(array[i].substr(0,token.length),false,true)+mstrmojo.string.encodeHtmlString(array[i].substring(token.length),false,true);rows.push(divRow);}for(i=0;i<rows.length;i++){elem.appendChild(rows[i]);}if(rows.length===0){return ;}if(rows.length===1&&token===rows[0].__hint){return ;}if(rows.length<1){return ;}var maxHeight=22*9;if(distanceToBottom<maxHeight){elemContainer.style.top="";elemContainer.style.bottom=config.bottom+"px";}else{elemContainer.style.top=config.top+"px";elemContainer.style.bottom="";}elem.style.maxHeight=maxHeight+"px";elemContainer.style.visibility="visible";},highlight:function(index){if(rows.length===0){return ;}if(oldIndex!==-1&&rows[oldIndex]){rows[oldIndex].style.backgroundColor=config.dropdownBackgroundColor;}rows[index].style.backgroundColor=config.dropDownOnHoverBackgroundColor;oldIndex=index;var rowNode=rows[index];var containerNode=rowNode.parentNode;if(rowNode.offsetTop+rowNode.clientHeight>containerNode.scrollTop+containerNode.clientHeight){containerNode.scrollTop=rowNode.offsetTop+rowNode.clientHeight-containerNode.clientHeight;}else{if(rowNode.offsetTop<containerNode.scrollTop){containerNode.scrollTop=rowNode.offsetTop;}}},move:function(step){if(elemContainer.style.visibility==="hidden"){return"";}if(ix+step===-2||ix+step===-1){ix=rows.length-1;}else{if(ix+step===rows.length){ix=0;}else{ix+=step;}}p.highlight(ix);return rows[ix].__hint;},onmouseselection:function(){}};return p;};var dropDownController=createDropDownController(dropDown,dropDownContainer);dropDownController.onmouseselection=function(text){txtInput.value=txtHint.value=leftSide+text;rs.onChange(txtInput.value);registerOnTextChangeOldValue=txtInput.value;setTimeout(function(){txtInput.focus();txtHint.scrollLeft=txtInput.scrollLeft;},0);};dropDownContainer.appendChild(dropDown);wrapper.appendChild(dropDownContainer);container.appendChild(wrapper);var spacer;var leftSide;function calculateWidthForText(text){if(spacer===undefined){spacer=document.createElement("span");spacer.style.visibility="hidden";spacer.style.position="fixed";spacer.style.outline="0";spacer.style.margin="0";spacer.style.padding="0";spacer.style.border="0";spacer.style.left="0";spacer.style.whiteSpace="pre";spacer.style.fontSize=config.fontSize;spacer.style.fontFamily=config.fontFamily;spacer.style.fontWeight="normal";document.body.appendChild(spacer);}spacer.innerHTML=String(text).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return spacer.getBoundingClientRect().right;}var rs={onArrowDown:function(){},onArrowUp:function(){},onEnter:function(e){e.preventDefault();e.stopPropagation();},onTab:function(){},onChange:function(){rs.repaint();},startFrom:0,options:[],wrapper:wrapper,input:txtInput,hint:txtHint,dropDown:dropDown,prompt:prompt,setText:function(text){txtHint.value=text;txtInput.value=text;},getText:function(){return txtInput.value;},hideDropDown:function(){dropDownController.hide();},repaint:function(){var text=txtInput.value;var startFrom=rs.startFrom;var options=rs.options;var optionsLength=options.length;var token=text.substring(startFrom);leftSide=text.substring(0,startFrom);txtHint.value="";for(var i=0;i<optionsLength;i++){var opt=options[i];if(opt.toLowerCase().indexOf(token.toLowerCase())===0){break;}}dropDown.parentNode.style.left=calculateWidthForText(leftSide)-config.left+"px";dropDownController.refresh(token,rs.options);registerOnTextChangeOldValue=text;}};var registerOnTextChangeOldValue;var registerOnTextChange=function(txt,callback){registerOnTextChangeOldValue=txt.value;var handler=function(){var value=txt.value;if(registerOnTextChangeOldValue!==value){registerOnTextChangeOldValue=value;callback(value);}txtHint.scrollLeft=txtInput.scrollLeft;};var handlerBlur=function(){txtHint.value="";};if(txt.addEventListener){txt.addEventListener("input",handler,false);txt.addEventListener("keyup",handler,false);txt.addEventListener("change",handler,false);txt.addEventListener("blur",handlerBlur,false);}else{txt.attachEvent("oninput",handler);txt.attachEvent("onkeyup",handler);txt.attachEvent("onchange",handler);txt.attachEvent("onblur",handlerBlur);}};registerOnTextChange(txtInput,function(text){rs.onChange(text);});var keyDownHandler=function(e){e=e||window.event;var keyCode=e.keyCode;var hasTextChanged,m;if(e.keyCode===17){return ;}if(keyCode===33){return ;}if(keyCode===34){return ;}if(keyCode===27){dropDownController.hide();txtHint.value=txtInput.value;txtInput.focus();return ;}if(keyCode===39||keyCode===35||keyCode===9){if(keyCode===9){e.preventDefault();e.stopPropagation();if(txtHint.value.length===0){rs.onTab();}}if(txtHint.value.length>0){var wasDropDownHidden=(dropDown.style.visibility==="hidden");if(!wasDropDownHidden){dropDownController.hide();}if(txtInput.value!==txtHint.value){txtInput.value=txtHint.value;}hasTextChanged=registerOnTextChangeOldValue!==txtInput.value;registerOnTextChangeOldValue=txtInput.value;if(hasTextChanged){rs.onChange(txtInput.value);}}return ;}if(keyCode===13){if(txtHint.value.length===0){return ;}else{var wasDropDownHidden=(dropDown.style.visibility==="hidden");if(!wasDropDownHidden){dropDownController.hide();}if(wasDropDownHidden){txtHint.value=txtInput.value;txtInput.focus();rs.onEnter(e);return ;}txtInput.value=txtHint.value;hasTextChanged=registerOnTextChangeOldValue!==txtInput.value;registerOnTextChangeOldValue=txtInput.value;if(hasTextChanged){rs.onChange(txtInput.value);}e.preventDefault();e.stopPropagation();}return ;}if(keyCode===40){m=dropDownController.move(+1);if(m===""){rs.onArrowDown();}txtHint.value=leftSide+m;return ;}if(keyCode===38){m=dropDownController.move(-1);if(m===""){rs.onArrowUp();}txtHint.value=leftSide+m;e.preventDefault();e.stopPropagation();return ;}if(txtInput.value===""&&(keyCode===8)||(keyCode===46)){return ;}txtHint.value="";};var scrollHandler=function(){this.parentNode.childNodes[1].scrollTop=this.scrollTop;};if(txtInput.addEventListener){txtInput.addEventListener("keydown",keyDownHandler,false);txtInput.addEventListener("scroll",scrollHandler,false);}else{txtInput.attachEvent("onkeydown",keyDownHandler);txtInput.attachEvent("scroll",scrollHandler);}return rs;};mstrmojo.Refine.RefineHelpers.confirmFilldownOrBlankdown=function(fnOk,fnCancel){var confirmMsg=mstrmojo.desc(14723,'The column is going to be "fill down" or "blank down" using the data order of the random sample in the preview page. When the dataset is eventually published, the entire table in the correct order will be utilized by the wrangler to populate the correct "fill down" or "blank down" values in the final in-memory dataset'),confirmMsgBrief=mstrmojo.desc(14735,"Warning: Final table data may differ from current preview due to Fill Down / Blank Down operation."),confirmTital=mstrmojo.desc(12537,"Data Import");var ctrl=mstrApp.getRootController();if(fnOk){ctrl.displayError(confirmMsgBrief,false,confirmMsg,fnOk,confirmTital);}};}());