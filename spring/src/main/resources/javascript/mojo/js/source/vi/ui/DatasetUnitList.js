(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.InteractiveUnitList","mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.vi.models.EnumDragSources");mstrmojo.requiresDescs();var $ARR=mstrmojo.array,$CSS=mstrmojo.css,$DOM=mstrmojo.dom,$HASH=mstrmojo.hash,$STR=mstrmojo.string,ICON_SIZE=16,PADDING_LEFT=9,LEVEL_DIFF=13,DELEMITER="\u001E";function reloadItems(){this._dsetId=this.dataset&&this.dataset.id||"";this.set("items",this.filterItems(this.getAllItems()).map(function(item){return $HASH.copy(item);}));}mstrmojo.vi.ui.DatasetUnitList=mstrmojo.declare(mstrmojo.vi.ui.InteractiveUnitList,null,{scriptClass:"mstrmojo.vi.ui.DatasetUnitList",dataset:null,filterScope:"",filterExpr:"",filterFunc:null,level:null,dropZone:false,init:function init(props){this._super(props);reloadItems.call(this);},getItemMarkup:function getItemMarkup(item){return this._super(item).replace('<span class="txt" unselectable="on">{@en@n}</span>','<div class="icon" style="{@iconLeft}"></div><span class="txt" unselectable="on">{@en@n}</span>').replace("{@en@n}","{@matchHTML}");},getItemProps:function getItemProps(item,idx){var props=this._super(item,idx);if(item.mnu){props.addCls(mstrmojo.vi.ui.InteractiveUnitList.CLS_HAS_MENU);}props.dsc=item.dsc;var filterExpression=this.filterExpr,filterRegExp,itemName=props.n,encode=mstrmojo.string.encodeHtmlString;if(filterExpression){filterRegExp=new RegExp($STR.regEscape(filterExpression),"ig");if(filterRegExp.test(itemName)){itemName=itemName.replace(filterRegExp,function(match){return DELEMITER+match+DELEMITER;});}var parts=$ARR.map((itemName||"").split(DELEMITER),function(v,idx){return(idx%2===0)?encode(v):("<em>"+encode(v)+"</em>");});props.matchHTML=parts.join("");}else{props.matchHTML=encode(itemName);}if(this.level!==null){var padding=PADDING_LEFT+this.level*LEVEL_DIFF;props.addStyle("padding-left: "+(padding+ICON_SIZE)+"px;");props.iconLeft=$STR.encodeHtmlString("left:"+padding+"px;");}return props;},prefilterScopeChange:reloadItems,prefilterExprChange:reloadItems,ondatasetChange:reloadItems,getAllItems:null,reloadItems:reloadItems,filterItems:function(items){items=items.filter(function(item){return !item.hide;});switch(this.filterScope){case"att":items=items.filter(function(item){return item.t!==4;});break;case"mx":items=items.filter(function(item){return item.t===4;});break;}var filterExpression=this.filterExpr;if(filterExpression){var filteredItems=[];$ARR.forEach(items,function(item){var itemCopy=$HASH.copy(item),itemName=itemCopy.n,filterRegExp=new RegExp($STR.regEscape(filterExpression),"ig");if(filterRegExp.test(itemName)){filteredItems.push(itemCopy);}});items=filteredItems;}if(this.filterFunc){items=this.filterFunc(items);}return items;},addMenuProp:false,getDragData:function getDragData(context){this.selectDragNode(context);var info=this._super(context);info.item=info.items&&info.items[0];info.dsid=this.dataset.id;info.src=mstrmojo.vi.models.EnumDragSources.DATASETS;return info;},selectDragNode:function selectDragNode(context){this._super(context);var data=context.src.data;if(data){var items=data.items=mstrmojo.all[data.srcId].getSelectedItems();data.item=items&&items[0];}}});}());