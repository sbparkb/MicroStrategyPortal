(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._TouchGestures","mstrmojo.array","mstrmojo.dom","mstrmojo.css");var $C=mstrmojo.css,$EF=mstrmojo.emptyFn,$D=mstrmojo.dom,$HANDLE_WIDTH=32,$CSS=mstrmojo.css,types={SINGLE:1,INCLUDE:2,EXCLUDE:3},f={CONTINUOUS_STEPS:-1,UNSET:-4641},tmp={},getSliderWidth=function(t){if(!tmp[t.id+"cw"]){var width=parseInt($C.getComputedStyle(t.sliderContainer).width,10);if(isNaN(width)){width=parseInt($C.getComputedStyle(t.domNode.parentNode).width,10);}tmp[t.id+"cw"]=width;}return tmp[t.id+"cw"];},getSingleStep=function(t,left,handle){var range=t.type!==types.SINGLE,handleWidth=$HANDLE_WIDTH,l=!!left?(left-(handleWidth/2)):parseInt(handle.style.left,10),st=t.steps,contWidth=getSliderWidth(t)-handleWidth,gap=Math.round(contWidth/(st-(!range?1:0))),maxStep=range?t.rightStep:st-1;return Math.min(maxStep,Math.round(l/gap));},getRightStep=function(t){var rcStyle=t.rangeContainer.style,width=parseInt(rcStyle.width,10)-$HANDLE_WIDTH,left=parseInt(rcStyle.left,10),st=t.steps,contWidth=getSliderWidth(t)-$HANDLE_WIDTH,gap=Math.round(contWidth/st);return Math.max(0,Math.min(Math.round((left+width)/gap),st));},getLeftForSingle=function(t,step){var st=t.steps,w=getSliderWidth(t),hs=$HANDLE_WIDTH;return Math.min(w-hs,Math.max(0,((w/(st-1)*step)-hs/2)))+"px";},getLeftForRange=function(t,leftStep){var st=t.steps,w=getSliderWidth(t)-$HANDLE_WIDTH;return((w/st)*leftStep)+"px";},getWidthForRange=function(t,leftStep,rightStep){var st=t.steps,w=getSliderWidth(t)-$HANDLE_WIDTH,ch=rightStep-leftStep;return((ch*w)/st)+$HANDLE_WIDTH+"px";},positionSingleStep=function(t,step){var singleHandle=t.singleHandle;if(singleHandle){singleHandle.style.left=getLeftForSingle(t,step);}},positionRangeStep=function(t,leftStep,rightStep){var ic=t.rangeContainer,sty,handleWidth=(t.rangeLHandle.clientWidth||$HANDLE_WIDTH)+5;if(ic){var ircStyle=t.innerRangeContainer.style;sty=ic.style;sty.left=getLeftForRange(t,leftStep);sty.width=getWidthForRange(t,leftStep,rightStep);ircStyle.left=parseInt(sty.left,10)+handleWidth+"px";ircStyle.width=Math.max(parseInt(sty.width,10)-(2*handleWidth),0)+"px";}},snapHandle=function(t,l,handle){var range=t.type!==types.SINGLE,step=getSingleStep(t,l,handle),stepName=range?"leftStep":"singleStep",func;if(step!==t[stepName]){t.set(stepName,step);this.step=step;}else{func=range?positionRangeStep:positionSingleStep;func(t,step,t.rightStep);}},snapRangeHandles=function(t,left,handle){var rangeContainer=t.rangeContainer,step,leftStep=t.leftStep,grabDrag=(handle===rangeContainer||handle===t.innerRangeContainer);if(handle===t.rangeRHandle||grabDrag){step=getRightStep(t);leftStep+=grabDrag?step-t.rightStep:0;positionRangeStep(t,leftStep,step);if(t.rightStep!==step){t.set("rightStep",step);if(grabDrag){t.set("leftStep",leftStep);}}}else{if(handle===t.rangeLHandle){snapHandle(t,left,rangeContainer);}}},snapHandles=function(t,target){switch(t.type){case types.SINGLE:snapHandle(t,null,t.singleHandle);break;case types.EXCLUDE:case types.INCLUDE:snapRangeHandles(t,null,target);break;}},jumpRangeHandle=function(t,tapPosition){var rangeContainer=t.rangeContainer,rcStyle=rangeContainer.style,width=parseInt(rcStyle.width,10),left=parseInt(rcStyle.left,10),leftStep=t.leftStep,rightStep=t.rightStep,nuRs=rightStep,nuLs=leftStep;if(tapPosition>0&&tapPosition<left&&leftStep>0){nuRs--;nuLs--;}else{if(tapPosition>(left+width)&&tapPosition<getSliderWidth(t)){nuRs++;nuLs++;}}positionRangeStep(t,nuLs,nuRs);t.set("leftStep",nuLs);t.set("rightStep",nuRs);},moveHandle=function(slider,node,handle,position,deltaX){var width=handle.style.width;if(width===""){width=$C.getComputedStyle(handle).width;}position=Math.min(Math.max(0,position+(deltaX||0)),getSliderWidth(slider)-parseInt(width,10));node.style.left=position+"px";return position;},moveRangeLHandle=function(t,originalPosition,originalWidth,deltaX){var rangeContainer=t.rangeContainer,rangeLHandle=t.rangeLHandle,contWidth=getSliderWidth(t)-$HANDLE_WIDTH,gap=Math.round(contWidth/t.steps),newWidth=originalWidth-deltaX,handlePos;if(newWidth>=(gap+$HANDLE_WIDTH)){handlePos=moveHandle(t,rangeContainer,rangeLHandle,originalPosition,deltaX);if((originalPosition+deltaX)>0){rangeContainer.style.width=newWidth+"px";}return handlePos;}},moveRangeRHandle=function(t,originalPosition,originalWidth,deltaX){var rangeContainer=t.rangeContainer,max=getSliderWidth(t)-parseInt(rangeContainer.style.left,10),newWidth=originalWidth+deltaX,contWidth=getSliderWidth(t)-$HANDLE_WIDTH,gap=Math.round(contWidth/t.steps),handlePos;if(newWidth>=(gap+$HANDLE_WIDTH)){handlePos=Math.min(max,newWidth);rangeContainer.style.width=handlePos+"px";return handlePos;}},prepareSummary=function(t){var singleStep,leftStep,rightStep,summary;switch(t.type){case types.SINGLE:singleStep=parseInt(this.step,10)===f.UNSET?getSingleStep(t,null,t.singleHandle):this.step;summary=t.buildSummary(singleStep);this.step=f.UNSET;break;case types.EXCLUDE:case types.INCLUDE:leftStep=getSingleStep(t,null,t.rangeContainer);rightStep=getRightStep(t);summary=t.buildSummary(null,leftStep,rightStep);break;}return summary;};mstrmojo.android.selectors.MobileSliderSelector=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._TouchGestures,mstrmojo._ListSelections],{width:0,type:f.UNSET,value:f.UNSET,steps:f.UNSET,include:f.UNSET,initState:$EF,buildSummary:$EF,updateMinMaxLabels:$EF,flushSelections:$EF,step:f.UNSET,singleStep:f.UNSET,leftStep:f.UNSET,rightStep:f.UNSET,cssDisplay:"block",scriptClass:"mstrmojo.android.selectors.MobileSliderSelector",useRichTooltip:true,markupString:'<div class="mstrmojo-sliderSel" id="{@id}"><div></div><div class="mstrmojo-sliderSelSummary">&nbsp;</div><div class="mstrmojo-sliderSelScrollerContainer"><div class="mstrmojo-sliderSelScrollerHandle" style="display:none;"><div class="mstrmojo-sliderSelScrollerHandle1 leftHandle"><div></div></div><div class="mstrmojo-sliderSelScrollerHandle1 rightHandle"><div></div></div></div><div class="mstrmojo-sliderSelScrollerHandle2" style="display:none;"><div></div></div><div class="mstrmojo-sliderSelScrollerHandleArea" style="display:none;position:absolute"></div></div><div class="mstrmojo-sliderSelLabels"><label class="mstrmojo-sliderSelLL">&nbsp;</label><label class="mstrmojo-sliderSelLR">&nbsp;</label></div></div>',markupSlots:{editor:function(){return this.domNode.childNodes[0];},summary:function(){return this.domNode.childNodes[1];},sliderContainer:function(){return this.domNode.childNodes[2];},innerRangeContainer:function(){return this.domNode.childNodes[2].childNodes[2];},rangeContainer:function(){return this.domNode.childNodes[2].childNodes[0];},rangeLHandle:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[0];},rangeRHandle:function(){return this.domNode.childNodes[2].childNodes[0].childNodes[1];},singleHandle:function(){return this.domNode.childNodes[2].childNodes[1];},minLabel:function(){return this.domNode.childNodes[3].childNodes[0];},maxLabel:function(){return this.domNode.childNodes[3].childNodes[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";},ontypeChange:function(){var s,i="none",scClassName="mstrmojo-sliderSelScrollerContainer",handleClassName="Handle1";switch(this.type){case types.SINGLE:s="block";break;case types.EXCLUDE:scClassName="mstrmojo-sliderSelScrollerContainerExcl";handleClassName="Handle2";i="block";break;case types.INCLUDE:i="block";break;}this.rangeContainer.style.display=i;this.innerRangeContainer.style.display=i;this.sliderContainer.className=scClassName;this.rangeLHandle.className="mstrmojo-sliderSelScrollerHandleX leftHandle".replace("HandleX",handleClassName);this.rangeRHandle.className="mstrmojo-sliderSelScrollerHandleX rightHandle".replace("HandleX",handleClassName);this.singleHandle.style.display=s;},onconstantsChange:function(){this.updateMinMaxLabels();},onvalueChange:function(){prepareSummary(this);}},postBuildRendering:function postBuildRendering(){var rtn=this._super();this.initState();var d=this.tooltipNode||this.domNode;$D.detachEvent(d,"mouseover",this._ontooltipover);$D.detachEvent(d,"mouseout",this._ontooltipout);return rtn;},onsingleStepChange:function(){positionSingleStep(this,this.singleStep);},onleftStepChange:function(){positionRangeStep(this,this.leftStep,this.rightStep);},onrightStepChange:function(){positionRangeStep(this,this.leftStep,this.rightStep);},touchSwipeBegin:function(touch){var target=touch.target;if(!target){return false;}this.touchTap(touch);var glowTargets=this._glowing=[];$CSS.addClass(target,"glow");glowTargets.push(target);this._sliderTarget=target;var singleHandle=this.singleHandle,rangeContainer=this.rangeContainer,left,style;switch(target){case singleHandle:left=singleHandle.style.left;tmp.shl=parseInt(!!left?left:0,10);break;case rangeContainer:case this.innerRangeContainer:case this.rangeLHandle:case this.rangeRHandle:style=rangeContainer.style;left=style.left;tmp.icl=parseInt(!!left?left:0,10);tmp.icw=parseInt(style.width,10);break;case this.sliderContainer:$CSS.addClass(singleHandle,"glow");glowTargets.push(singleHandle);break;default:this.bubbleTouchEvent(touch);}this._initTooltip();if(this.type===types.SINGLE){this.touchSelectMove(touch,true);}},touchSwipeMove:function(touch,ignoreNodeWidth){var target=touch.target;if(!target){return false;}target=this._sliderTarget;var singleHandle=this.singleHandle,rangeContainer=this.rangeContainer,rangeLHandle=this.rangeLHandle,rangeRHandle=this.rangeRHandle,deltaX=touch.delta.x,leftPos;switch(target){case singleHandle:leftPos=moveHandle(this,singleHandle,singleHandle,tmp.shl,deltaX);break;case rangeRHandle:leftPos=moveRangeRHandle(this,tmp.icl,tmp.icw,deltaX);break;case rangeLHandle:leftPos=moveRangeLHandle(this,tmp.icl,tmp.icw,deltaX);break;case rangeContainer:case this.innerRangeContainer:if(this.type===types.INCLUDE){leftPos=moveHandle(this,rangeContainer,rangeContainer,tmp.icl,deltaX);}break;case this.sliderContainer:leftPos=moveHandle(this,singleHandle,singleHandle,touch.clientX-$D.position(this.sliderContainer,true).x);break;}this._updateTooltip(touch.evt,target,leftPos,ignoreNodeWidth);},touchSwipeEnd:function(touch){var target=(touch.target===this.sliderContainer)?this.singleHandle:this._sliderTarget,l=this.leftStep,r=this.rightStep,s=this.singleStep;mstrmojo.array.forEach(this._glowing,function(glowTarget){$CSS.removeClass(glowTarget,"glow");});snapHandles(this,target);if(l!==this.leftStep||r!==this.rightStep||s!==this.singleStep){this.flushSelections();}this.hideTooltip(touch.evt,this);},touchTap:function(touch){var target=touch.target;if(!target){return false;}var sliderContainer=this.sliderContainer,clientX=touch.clientX,containerTapped=(sliderContainer===target),tapPosition=clientX-$D.position(sliderContainer,true).x,l=this.leftStep,r=this.rightStep,s=this.singleStep;switch(this.type){case types.SINGLE:if(containerTapped){snapHandle(this,tapPosition,this.singleHandle);}break;case types.INCLUDE:if(containerTapped){jumpRangeHandle(this,tapPosition);}break;}if(l!==this.leftStep||r!==this.rightStep||s!==this.singleStep){prepareSummary(this);this.flushSelections();}},touchSelectBegin:function(touch){this.touchSwipeBegin(touch);},touchSelectMove:function(touch){this.touchSwipeMove(touch,true);},touchSelectEnd:function(touch){this.touchSwipeEnd(touch);},touchEnd:function touchEnd(touch){this.hideTooltip(touch.evt,this);},_initTooltip:function _initTooltip(){this.set("richTooltip",{refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMCENTER,contentNodeCssClass:"mstrmojo-sliderTip"});},_updateTooltip:function _updateTooltip(event,target,leftPos,ignoreNodeWidth){this.showTooltip(event,this);var containerNode=$D.position(this.sliderContainer,false),dposDomNode=$D.position(this.domNode,false),boxContainer=mstrmojo.boxmodel.offset(this.sliderContainer),breachedTopBoundary=(containerNode.y<90),ttN=this.richTooltip,content=prepareSummary(this),nodeWidth;if(ignoreNodeWidth){nodeWidth=($HANDLE_WIDTH/2);}else{nodeWidth=target.style.width;if(nodeWidth===""){nodeWidth=$C.getComputedStyle(target).width;}nodeWidth=parseInt(nodeWidth,10)/2;}ttN.content='<div class="mstrmojo-sliderTip-top">'+content+'</div><div class="mstrmojo-sliderTip-bottom'+(breachedTopBoundary?" down":"")+'"></div>';ttN.top=dposDomNode.y-boxContainer.top-20+(breachedTopBoundary?100:0);ttN.left=leftPos+nodeWidth+(dposDomNode.x-boxContainer.left);this.richTooltip=null;this.set("richTooltip",ttN);},onselectionChange:function onselChg(){if(this.onchange){this.onchange();}if(this.makeSelection){this.makeSelection({selItem:this.type===types.SINGLE?this.singleHandle:this.rangeContainer});}},slideHosted:function(single,left,right){if(single!==null&&single!==undefined){this.set("singleStep",single);}if(left!==null&&left!==undefined){this.set("leftStep",left);}if(right!==null&&right!==undefined){this.set("rightStep",right);}this.flushSelections();prepareSummary(this);}});var $MSL=mstrmojo.android.selectors.MobileSliderSelector;$MSL.TYPES=types;$MSL.FLAGS=f;}());