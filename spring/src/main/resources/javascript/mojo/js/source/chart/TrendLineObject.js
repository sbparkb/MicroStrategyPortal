(function(){mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphType","EnumDSSGraphRegressionType");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumDSSGraphOffScaleType","EnumLineJoinType");mstrmojo.requiresClsP("mstrmojo.chart","GraphTrendLineOptions","GraphObject","Axis","FormatLine","Point2D","BezierCurve","CurveLineObject");mstrmojo.requiresCls("mstrmojo.VisUtility");var $C=mstrmojo.chart,$MODEL_ENUMS=$C.model.enums,$VISUTIL=mstrmojo.VisUtility,$CHART_ENUMS=$C.enums,$OST=$CHART_ENUMS.EnumDSSGraphOffScaleType,$GRAPH_TYPE=$MODEL_ENUMS.EnumDSSGraphType,$SHP=$MODEL_ENUMS.EnumShapeType,$LJT=$CHART_ENUMS.EnumLineJoinType,$LSL=$CHART_ENUMS.EnumLineStyle,$RT=$MODEL_ENUMS.EnumDSSGraphRegressionType,kZeroTolerance=1e-10,kSteepSlopeThreshold=100,kFlatSlopeThreshold=0.25,kSuperFlatSlopeThreshold=0.01,kSlopeChangeThreshold=0.15,kFlatSlopeChangeThreshold=0.3,kSuperFlatSlopeChangeThreshold=1,kLogFactorMin=1.001,kSubtypeNone=0,kSubtypeExponentialBaseNearOne=1;function swap(point){var temp=point.x;point.x=point.y;point.y=temp;}function hParseCoefficients(coefficients){var i,len,value,numberPart,meCoefficients=this.mCoefficients,trendlineType=this.mTrendLineOptions.mRegressionType;len=coefficients.length;for(i=0;i<len;++i){value=coefficients[i];if(typeof (value)==="number"){meCoefficients.push(value);}else{if(typeof (value)==="string"&&trendlineType===$RT.DssGraphRegressionExp){if(value.indexOf("Ln")===0){numberPart=value.substr(2);value=parseFloat(numberPart);if(isNaN(value)){return false;}this.subType=kSubtypeExponentialBaseNearOne;meCoefficients.push(value);}}else{return false;}}}if((len===1)&&(trendlineType===$RT.DssGraphRegressionExp||trendlineType===$RT.DssGraphRegressionLog||trendlineType===$RT.DssGraphRegressionPow)){this.deformed=true;}return true;}function hCalcPosition(valueAxis,dataValue){var option=valueAxis.mOptions.mOffScaleType,retVal;valueAxis.mOptions.mOffScaleType=$OST.DssGraphOffScaleShow;retVal=valueAxis.GetPositionByValue(dataValue);valueAxis.mOptions.mOffScaleType=option;return retVal;}function hSetBorderStyle(points){var chartCtx=this.mChartContextPtr,lineStyle=this.mFormatLinePtr.mLineStyle,i,j,t;if(this.mFormatLinePtr.mLineStyle===$LSL.LS_SOLID||chartCtx.mUseAnimation){return ;}chartCtx.NewPath();var n=points.length;if(n<2){return ;}var dashPattern=$C.FormatLine.getLinePattern(lineStyle),dashPatternSize=dashPattern.length,dashIndex=0,length=0,xArray=[],yArray=[];for(i=0;i<n;++i){yArray.push(0);xArray.push(0);}var x=points[0].x;var y=points[0].y;var sectionLength=0.05;if(lineStyle===$LSL.LS_DOT_DOT_DOT){sectionLength=0.03;dashPattern[dashPatternSize-1]*=3;}else{if(lineStyle===$LSL.LS_DOT){sectionLength=0.005;}}for(t=0;t<=1;t+=sectionLength/n){for(i=1;i<n;++i){for(j=0;j<n-i;++j){if(i===1){xArray[j]=points[j].x*(1-t)+points[j+1].x*t;yArray[j]=points[j].y*(1-t)+points[j+1].y*t;continue;}xArray[j]=xArray[j]*(1-t)+xArray[j+1]*t;yArray[j]=yArray[j]*(1-t)+yArray[j+1]*t;}}length+=Math.sqrt((x-xArray[0])*(x-xArray[0])+(y-yArray[0])*(y-yArray[0]));if(length>=dashPattern[dashIndex]){if(dashIndex%2===0){if(this.mIsVertical){chartCtx.MoveTo(x,y);chartCtx.LineTo(xArray[0],yArray[0]);}else{chartCtx.MoveTo(y,x);chartCtx.LineTo(yArray[0],xArray[0]);}}dashIndex=(dashIndex+1)%dashPatternSize;length=0;x=xArray[0];y=yArray[0];}}}function hAdvanceX(type,startX,factor,realC1,deltaValueX){var lastX,result={};result.usedDefaultValueX=false;switch(type){case $RT.DssGraphRegressionLog:lastX=startX;startX*=factor;if(startX-lastX>deltaValueX){startX=lastX+deltaValueX;result.usedDefaultValueX=true;}result.startX=startX;break;case $RT.DssGraphRegressionExp:startX+=factor/Math.pow(realC1,startX*0.25);result.startX=startX;break;case $RT.DssGraphRegressionPoly:startX+=factor;result.startX=startX;break;}return result;}function hAddingValues(type,minValueX,maxValueX,factor,deltaValueX,minStep,realC1,calcValues){var lastSlope=0,lastSlopeAbs,newSlope=0,slopeDeltaAbs,lastPosition,newPosition,usedDeltaValueX,startX,lastX,retVal;for(startX=minValueX;startX<maxValueX;){calcValues.push(startX);calcValues.push(hGetY.call(this,startX));lastX=startX;retVal=hAdvanceX.call(this,type,startX,factor,realC1,deltaValueX);startX=retVal.startX;usedDeltaValueX=retVal.usedDefaultValueX;if(!usedDeltaValueX){lastSlope=hGetSlope.call(this,lastX);newSlope=hGetSlope.call(this,startX);}lastSlopeAbs=Math.abs(lastSlope);slopeDeltaAbs=Math.abs(newSlope-lastSlope);if(minStep===0){lastPosition=this.mpXAxis.GetPositionByValue(lastX);newPosition=this.mpXAxis.GetPositionByValue(startX);}while(!usedDeltaValueX&&(startX<maxValueX)&&((minStep===0&&Math.abs(newPosition-lastPosition)<5)||(minStep!==0&&Math.abs(startX-lastX)<minStep)||(lastSlopeAbs<=kSteepSlopeThreshold&&lastSlopeAbs>kFlatSlopeThreshold&&slopeDeltaAbs<kSlopeChangeThreshold*lastSlopeAbs)||(lastSlopeAbs<=kFlatSlopeThreshold&&lastSlopeAbs>kSuperFlatSlopeThreshold&&slopeDeltaAbs<kFlatSlopeChangeThreshold*lastSlopeAbs)||(lastSlopeAbs<=kSuperFlatSlopeThreshold&&slopeDeltaAbs<kSuperFlatSlopeChangeThreshold*lastSlopeAbs))){retVal=hAdvanceX.call(this,type,startX,factor,realC1,deltaValueX);startX=retVal.startX;usedDeltaValueX=retVal.usedDefaultValueX;if(!usedDeltaValueX){newSlope=hGetSlope.call(this,startX);slopeDeltaAbs=Math.abs(newSlope-lastSlope);}if(minStep===0){newPosition=this.mpXAxis.GetPositionByValue(startX);}}if(startX>=maxValueX){calcValues.push(maxValueX);calcValues.push(hGetY.call(this,maxValueX));return ;}}}function hCalcValues(){var type=this.mTrendLineOptions.mRegressionType,i,rawValues=this.mTrendLineDataValues,coefficients=this.mCoefficients,order=coefficients.length-1,numberOfRawValues=rawValues.length,usefulValues=[],numberOfUsefulValues,minValueX,maxValueX,minValueY,maxValueY,positionX,positionY,calcValues,factor,startX,totalNumberOfValues=16,deltaValueX,realC1;calcValues=[];for(i=0;2*i<numberOfRawValues-numberOfRawValues%2;++i){if(rawValues[2*i]!==null&&rawValues[2*i+1]!==null){usefulValues.push(rawValues[2*i]);usefulValues.push(rawValues[2*i+1]);}}numberOfUsefulValues=usefulValues.length;if(numberOfUsefulValues<2){this.isValid=false;return ;}minValueX=usefulValues[0];maxValueX=usefulValues[numberOfUsefulValues-numberOfUsefulValues%2-2];deltaValueX=(maxValueX-minValueX)/totalNumberOfValues;minValueY=hGetY.call(this,minValueX);maxValueY=hGetY.call(this,maxValueX);positionX=this.mpXAxis.GetPositionByValue(minValueX);positionY=this.mpYAxis.GetPositionByValue(minValueY);this.startPoint={x:positionX,y:positionY};positionX=this.mpXAxis.GetPositionByValue(maxValueX);positionY=this.mpYAxis.GetPositionByValue(maxValueY);this.endPoint={x:positionX,y:positionY};if(deltaValueX<kZeroTolerance){this.deformed=true;}if(this.deformed){calcValues.push(usefulValues[0]);calcValues.push(usefulValues[1]);calcValues.push(usefulValues[numberOfUsefulValues-numberOfUsefulValues%2-2]);calcValues.push(usefulValues[numberOfUsefulValues-numberOfUsefulValues%2-1]);}else{var valuePerPixel=this.mpXAxis.GetValueForUnit(),minStep;if(valuePerPixel!==undefined&&valuePerPixel!==null){minStep=5*valuePerPixel;}else{minStep=0;}switch(type){case $RT.DssGraphRegressionNone:break;case $RT.DssGraphRegressionLinear:calcValues=usefulValues;break;case $RT.DssGraphRegressionLog:if(coefficients[1]!==0){factor=1+Math.SQRT2/Math.pow(Math.abs(coefficients[1]),0.25);}factor=Math.max(factor,kLogFactorMin);hAddingValues.call(this,type,minValueX,maxValueX,factor,deltaValueX,minStep,0,calcValues);break;case $RT.DssGraphRegressionExp:if(this.subType===kSubtypeExponentialBaseNearOne){realC1=Math.pow(Math.E,coefficients[1]);}else{realC1=coefficients[1];}if((coefficients[0]!==0)&&(realC1!==0)){factor=Math.pow(24/Math.abs(coefficients[0]),0.25)/Math.abs(Math.log(realC1));factor=Math.min(factor,deltaValueX);factor=Math.max(factor,minStep);hAddingValues.call(this,type,minValueX,maxValueX,factor,deltaValueX,minStep,realC1,calcValues);break;}else{for(startX=minValueX;startX<maxValueX;){calcValues.push(startX);calcValues.push(hGetY.call(this,startX));startX+=deltaValueX;if(startX>=maxValueX){calcValues.push(maxValueX);calcValues.push(hGetY.call(this,maxValueX));break;}}}break;case $RT.DssGraphRegressionPow:for(startX=minValueX;startX<maxValueX;){calcValues.push(startX);calcValues.push(hGetY.call(this,startX));startX+=deltaValueX;if(startX>=maxValueX){calcValues.push(maxValueX);calcValues.push(hGetY.call(this,maxValueX));break;}}break;case $RT.DssGraphRegressionPoly:factor=1;if(order>1){factor=1/Math.pow(Math.abs(coefficients[order]),1/order);}else{factor=deltaValueX;}factor=Math.min(deltaValueX,factor);factor=Math.max(factor,minStep);hAddingValues.call(this,type,minValueX,maxValueX,factor,deltaValueX,minStep,0,calcValues);break;default:break;}}this.mCalcValues=calcValues;}function hGetY(valueX){var type=this.mTrendLineOptions.mRegressionType,retVal,coefficients=this.mCoefficients,order,i;switch(type){case $RT.DssGraphRegressionNone:retVal=null;break;case $RT.DssGraphRegressionLinear:retVal=null;break;case $RT.DssGraphRegressionLog:retVal=coefficients[0]+coefficients[1]*Math.log(valueX);break;case $RT.DssGraphRegressionExp:switch(this.subType){case kSubtypeNone:retVal=coefficients[0]*Math.pow(coefficients[1],valueX);break;case kSubtypeExponentialBaseNearOne:retVal=coefficients[0]*Math.pow(Math.E,coefficients[1]*valueX);break;}break;case $RT.DssGraphRegressionPow:retVal=coefficients[0]*Math.pow(valueX,coefficients[1]);break;case $RT.DssGraphRegressionPoly:order=coefficients.length-1;retVal=coefficients[0];for(i=1;i<=order;++i){retVal+=coefficients[i]*Math.pow(valueX,i);}break;default:retVal=null;break;}return retVal;}function hGetSlope(valueX){var type=this.mTrendLineOptions.mRegressionType,retVal,coefficients=this.mCoefficients,order,i;switch(type){case $RT.DssGraphRegressionNone:retVal=null;break;case $RT.DssGraphRegressionLinear:retVal=null;break;case $RT.DssGraphRegressionLog:retVal=coefficients[1]/valueX;break;case $RT.DssGraphRegressionExp:switch(this.subType){case kSubtypeNone:retVal=coefficients[0]*Math.log(coefficients[1])*Math.pow(coefficients[1],valueX);break;case kSubtypeExponentialBaseNearOne:retVal=coefficients[0]*coefficients[1]*Math.pow(Math.E,coefficients[1]*valueX);}break;case $RT.DssGraphRegressionPow:retVal=coefficients[0]*coefficients[1]*Math.pow(valueX,coefficients[1]-1);break;case $RT.DssGraphRegressionPoly:order=coefficients.length-1;retVal=0;for(i=1;i<=order;++i){retVal+=coefficients[i]*i*Math.pow(valueX,i-1);}break;default:retVal=null;break;}return retVal;}function hInnerValueAdjustment(increasing,startValue,control1Value,control2Value,endValue){var result,control1=control1Value,control2=control2Value;if(increasing){if(control1>endValue){if(control2>startValue&&control2<endValue){control1=(startValue+2*control2)/3;}else{control1=(startValue+2*endValue)/3;}}if(control2<startValue||control2<control1){control2=(control1+endValue)/2;}}else{if(control1<endValue){if(control2<startValue&&control2>endValue){control1=(startValue+2*control2)/3;}else{control1=(startValue+2*endValue)/3;}}if(control2>startValue||control2>control1){control2=(control1+endValue)/2;}}result={control1:control1,control2:control2};return result;}function hAdjustCalcValues(trendLineType,startValue,control1Value,control2Value,endValue){var result,coefficients=this.mCoefficients,realC1;if(trendLineType===$RT.DssGraphRegressionPow){if((coefficients[1]<0&&coefficients[0]>0)||(coefficients[1]>0&&coefficients[0]<0)){result=hInnerValueAdjustment(false,startValue,control1Value,control2Value,endValue);}else{if((coefficients[1]>0&&coefficients[0]>0)||(coefficients[1]<0&&coefficients[0]<0)){result=hInnerValueAdjustment(true,startValue,control1Value,control2Value,endValue);}}}else{if(trendLineType===$RT.DssGraphRegressionLog){if(coefficients[1]>0){result=hInnerValueAdjustment(true,startValue,control1Value,control2Value,endValue);}else{if(coefficients[1]<0){result=hInnerValueAdjustment(false,startValue,control1Value,control2Value,endValue);}}}else{if(trendLineType===$RT.DssGraphRegressionExp){if(this.subType===kSubtypeExponentialBaseNearOne){realC1=Math.pow(Math.E,coefficients[1]);}else{realC1=coefficients[1];}if((realC1<1&&coefficients[0]>0)||(realC1>1&&coefficients[0]<0)){result=hInnerValueAdjustment(false,startValue,control1Value,control2Value,endValue);}else{if((realC1>1&&coefficients[0]>0)||(realC1<1&&coefficients[0]<0)){result=hInnerValueAdjustment(true,startValue,control1Value,control2Value,endValue);}}}}}if(result===undefined||result===null){result={control1:control1Value,control2:control2Value};}return result;}mstrmojo.chart.TrendLineObject=mstrmojo.declare(mstrmojo.chart.GraphObject,null,{scriptClass:"mstrmojo.chart.TrendLineObject",mpXAxis:null,mpYAxis:null,mTrendLineOptions:null,mDataArea:null,mDepthOffset:null,mIsVertical:false,mTextPtr:null,mRealObjectId:$GRAPH_TYPE.DssGraphTypeReserved,mCurveLinePtr:null,mMinXLogical:0,mMaxXLogical:0,mMinYLogical:0,mMaxYLogical:0,mTrendLineType:0,mCoefficients:[],mTrendLineDataValues:[],mCalcValues:[],mBezierCurves:[],identity:null,isValid:null,subType:kSubtypeNone,deformed:false,startPoint:{},midPoint:{},endPoint:{},init:function init(props){var temp=0,value;this._super(props);this.deformed=false;this.mCoefficients=[];this.mTrendLineDataValues=[];if(props){if(props.RealObjectId){this.mRealObjectId=props.RealObjectId;}if(props.XAxis){this.mpXAxis=props.XAxis;}if(props.YAxis){this.mpYAxis=props.YAxis;}if(props.TrendLineOptions){this.mTrendLineOptions=props.TrendLineOptions;}this.mDataArea=props.DataArea||new $C.Rect2D();this.mDepthOffset=props.DepthOffset||new $C.Point2D();this.mIsVertical=props.IsVertical||false;if(props.Coefficients){this.isValid=hParseCoefficients.call(this,props.Coefficients);}else{this.isValid=false;}if(props.TrendLineValues){this.mTrendLineDataValues=props.TrendLineValues;}if(props.Identity){this.identity=props.Identity;}}this.startPoint={};this.midPoint={};this.endPoint={};this.mCalcValues=[];hCalcValues.call(this);this.mBezierCurves=[];if(!this.mIsVertical){temp=this.mDepthOffset.x;this.mDepthOffset.x=this.mDepthOffset.y;this.mDepthOffset.y=temp;}if(this.mpXAxis){value=this.mpXAxis.GetMinMaxLogicalCoord();this.mMinXLogical=value.Min;this.mMaxXLogical=value.Max;}if(this.mpYAxis){value=this.mpYAxis.GetMinMaxLogicalCoord();this.mMinYLogical=value.Min;this.mMaxYLogical=value.Max;}},Draw:function Draw(){var chartCtx=this.mChartContextPtr,bezierCurves=this.mBezierCurves,backupLineJoinType=chartCtx.GetLineJoin(),i,numberOfCurves,points=[];if(!this.isValid){return ;}chartCtx.SetLineJoin($LJT.LJT_ROUND);this.SetLineWidth();numberOfCurves=bezierCurves.length;if(this.mFormatLinePtr.mLineStyle===$LSL.LS_SOLID||chartCtx.mUseAnimation){chartCtx.NewPath();bezierCurves[0].MoveToStart(chartCtx);for(i=0;i<numberOfCurves;++i){bezierCurves[i].CurveToEnd(chartCtx);}}else{for(i=0;i<numberOfCurves;++i){bezierCurves[i].GetControlPoints(points);hSetBorderStyle.call(this,points);this.ApplyLineFormat();}}if(this.isClosePath){chartCtx.ClosePath();}if(this.mFormatLinePtr.mLineStyle===$LSL.LS_SOLID||chartCtx.mUseAnimation){this.ApplyLineFormat();}chartCtx.SetLineJoin(backupLineJoinType);for(i=0;i<numberOfCurves;++i){var curve=bezierCurves[i],p0=new $C.Point2D({Point2D:curve.mP0}),p1=new $C.Point2D({Point2D:curve.mP1}),p2=new $C.Point2D({Point2D:curve.mP2}),p3=new $C.Point2D({Point2D:curve.mP3});if(!this.mIsVertical){p0.swap();p1.swap();p2.swap();p3.swap();swap.call(this,this.startPoint);swap.call(this,this.midPoint);swap.call(this,this.endPoint);}points.push(p0);points.push(p1);points.push(p2);points.push(p3);}chartCtx.FinishDrawCurves(points,this.mTripleId,this.identity,this.startPoint,this.midPoint,this.endPoint);},CreateTrendLine:function CreateTrendLine(){var i,j,trendLineOptions=this.mTrendLineOptions,trendLineType=trendLineOptions.mRegressionType,valueX,valueY,pointX,pointY,point,points=[],polyLine,startPoint=new $C.Point2D(),endPoint=new $C.Point2D(),startValueX,startValueY,endValueX,endValueY,control1ValueY,control2ValueY,control1Y,control2Y,adjustedValues,startSlope,endSlope,startX,startY,endX,endY,midX,midY,slope,rawValues=this.mTrendLineDataValues,numberOfRawValues=rawValues.length,calcValues,totalNumberOfValues,bezierCurves=this.mBezierCurves,numberOfBezierCurves=0,curveLine,retVal=null;if(!this.isValid){return retVal;}numberOfRawValues=numberOfRawValues-(numberOfRawValues%2);if(trendLineType===$RT.DssGraphRegressionLinear){if(trendLineOptions.mSeasonal){for(i=0;2*i<numberOfRawValues;++i){valueX=rawValues[2*i];valueY=rawValues[2*i+1];if(valueX!==null&&valueX!==undefined&&valueY!==null&&valueY!==undefined){pointX=hCalcPosition.call(this,this.mpXAxis,valueX);pointY=hCalcPosition.call(this,this.mpYAxis,valueY);if(pointX!==undefined&&pointX!==null&&pointY!==undefined&&pointY!==null){point=new $C.Point2D({x:pointX,y:pointY});points.push(point);}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tdata point #: "+(2*i)+" and "+(2*i+1));$VISUTIL.visPrint("\tvalueX = "+valueX+", valueY = "+valueY);$VISUTIL.visPrint("\tx = "+pointX+", y = "+pointY);}}}if(points.length>=2){startX=points[0].x;endX=points[numberOfRawValues-1].x;midX=(startX+endX)/2;for(i=0;i<numberOfRawValues;++i){if(points[i].x===midX){midY=points[i].y;break;}else{if(i<numberOfRawValues-1&&points[i].x<midX&&points[i+1].x>midX){slope=(points[i+1].y-points[i].y)/(points[i+1].x-points[i].x);midY=points[i].y+slope*(midX-points[i].x);break;}}}this.midPoint.x=midX;this.midPoint.y=midY;}}else{for(i=0;i*2<numberOfRawValues;++i){valueX=rawValues[2*i];valueY=rawValues[2*i+1];if(valueX!==null&&valueX!==undefined&&valueY!==null&&valueY!==undefined){pointX=hCalcPosition.call(this,this.mpXAxis,valueX);pointY=hCalcPosition.call(this,this.mpYAxis,valueY);if(pointX!==undefined&&pointX!==null&&pointY!==undefined&&pointY!==null){point=new $C.Point2D({x:pointX,y:pointY});points.push(point);break;}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tdata point #: "+(2*i)+" and "+(2*i+1));$VISUTIL.visPrint("\tvalueX = "+valueX+", valueY = "+valueY);$VISUTIL.visPrint("\tx = "+pointX+", y = "+pointY);}}}for(j=(numberOfRawValues/2)-1;j>i;--j){valueX=rawValues[2*j];valueY=rawValues[2*j+1];if(valueX!==null&&valueX!==undefined&&valueY!==null&&valueY!==undefined){pointX=hCalcPosition.call(this,this.mpXAxis,valueX);pointY=hCalcPosition.call(this,this.mpYAxis,valueY);if(pointX!==undefined&&pointX!==null&&pointY!==undefined&&pointY!==null){point=new $C.Point2D({x:pointX,y:pointY});points.push(point);break;}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tdata point #: "+(2*j)+" and "+(2*j+1));$VISUTIL.visPrint("\tvalueX = "+valueX+", valueY = "+valueY);$VISUTIL.visPrint("\tx = "+point.x+", y = "+point.y);}}}if(points.length>=2){midX=(points[0].x+points[1].x)/2;midY=(points[0].y+points[1].y)/2;this.midPoint.x=midX;this.midPoint.y=midY;}}if(points.length>=2){polyLine=new $C.PolyLineObject({TripleId:this.mTripleId,GraphObjectManager:this,PolyLine:points,Shape:$SHP._LINE,Identity:this.identity,startPoint:this.startPoint,midPoint:this.midPoint,endPoint:this.endPoint});}retVal=polyLine;}else{calcValues=this.mCalcValues;totalNumberOfValues=calcValues.length;if(this.deformed){valueX=calcValues[0];valueY=calcValues[1];if(valueX!==null&&valueX!==undefined&&valueY!==null&&valueY!==undefined){pointX=hCalcPosition.call(this,this.mpXAxis,valueX);pointY=hCalcPosition.call(this,this.mpYAxis,valueY);if(pointX!==undefined&&pointX!==null&&pointY!==undefined&&pointY!==null){point=new $C.Point2D({x:pointX,y:pointY});points.push(point);}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tdata point #: 0 and 1");$VISUTIL.visPrint("\tvalueX = "+valueX+", valueY = "+valueY);$VISUTIL.visPrint("\tx = "+pointX+", y = "+pointY);}}valueX=calcValues[2];valueY=calcValues[3];if(valueX!==null&&valueX!==undefined&&valueY!==null&&valueY!==undefined){pointX=hCalcPosition.call(this,this.mpXAxis,valueX);pointY=hCalcPosition.call(this,this.mpYAxis,valueY);if(pointX!==undefined&&pointX!==null&&pointY!==undefined&&pointY!==null){point=new $C.Point2D({x:pointX,y:pointY});points.push(point);}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");$VISUTIL.visPrint("\tdata point #: 2 and 3");$VISUTIL.visPrint("\tvalueX = "+valueX+", valueY = "+valueY);$VISUTIL.visPrint("\tx = "+point.x+", y = "+point.y);}}if(points.length>=2){midX=(points[0].x+points[1].x)/2;midY=(calcValues[0].y+points[1].y)/2;this.midPoint.x=midX;this.midPoint.y=midY;polyLine=new $C.PolyLineObject({TripleId:this.mTripleId,GraphObjectManager:this,PolyLine:points,Shape:$SHP._LINE,Identity:this.identity,startPoint:this.startPoint,midPoint:this.midPoint,endPoint:this.endPoint});}retVal=polyLine;}else{for(i=0;2*i+3<2*totalNumberOfValues;++i){startValueX=calcValues[2*i];startValueY=calcValues[2*i+1];endValueX=calcValues[2*i+2];endValueY=calcValues[2*i+3];if(startValueX!==undefined&&startValueX!==null&&startValueY!==undefined&&startValueY!==null&&endValueX!==undefined&&endValueX!==null&&endValueY!==undefined&&endValueY!==null){startSlope=hGetSlope.call(this,startValueX);endSlope=hGetSlope.call(this,endValueX);control1ValueY=startValueY+startSlope*((2*startValueX+endValueX)/3-startValueX);control2ValueY=endValueY+endSlope*((startValueX+2*endValueX)/3-endValueX);if(trendLineType===$RT.DssGraphRegressionExp||trendLineType===$RT.DssGraphRegressionLog||trendLineType===$RT.DssGraphRegressionPow){adjustedValues=hAdjustCalcValues.call(this,trendLineType,startValueY,control1ValueY,control2ValueY,endValueY);control1ValueY=adjustedValues.control1;control2ValueY=adjustedValues.control2;}startX=hCalcPosition.call(this,this.mpXAxis,startValueX);startY=hCalcPosition.call(this,this.mpYAxis,startValueY);endX=hCalcPosition.call(this,this.mpXAxis,endValueX);endY=hCalcPosition.call(this,this.mpYAxis,endValueY);control1Y=hCalcPosition.call(this,this.mpYAxis,control1ValueY);control2Y=hCalcPosition.call(this,this.mpYAxis,control2ValueY);if(startX!==undefined&&startX!==null&&startY!==undefined&&startY!==null&&endX!==undefined&&endX!==null&&endY!==undefined&&endY!==null&&control1Y!==undefined&&control1Y!==null&&control2Y!==undefined&&control2Y!==null){startPoint=new $C.Point2D({x:startX,y:startY});endPoint=new $C.Point2D({x:endX,y:endY});bezierCurves.push(new $C.BezierCurve({P0:startPoint,F1:control1Y,F2:control2Y,P3:endPoint,IsVertical:this.mIsVertical}));}else{$VISUTIL.visPrint("Trendline point calculation abnormal:");if(startX===undefined||startX===null||startY===undefined||startY===null){$VISUTIL.visPrint("\tdata point #: "+(2*i)+" and "+(2*i+1));$VISUTIL.visPrint("\tvalueX = "+startValueX+", valueY = "+startValueY);$VISUTIL.visPrint("\tx = "+startX+", y = "+startY);}if(endX===undefined||endX===null||endY===undefined||endY===null){$VISUTIL.visPrint("\tdata point #: "+(2*i+2)+" and "+(2*i+3));$VISUTIL.visPrint("\tvalueX = "+endValueX+", valueY = "+endValueY);$VISUTIL.visPrint("\tx = "+endX+", y = "+endY);}}}}numberOfBezierCurves=bezierCurves.length;startX=bezierCurves[0].mP0.x;endX=bezierCurves[numberOfBezierCurves-1].mP3.x;midX=(startX+endX)/2;j=-1;for(i=0;i<numberOfBezierCurves;++i){if(bezierCurves[i].mP0.x===midX){midY=bezierCurves[i].mP0.y;j=i;break;}else{if(bezierCurves[i].mP3.x===midX){midY=bezierCurves[i].mP3.y;j=i+1;break;}else{if(bezierCurves[i].mP0.x<midX&&bezierCurves[i].mP3.x>midX){j=i;break;}}}}if(midY!==undefined){this.midPoint.x=midX;this.midPoint.y=midY;}else{if(j<numberOfBezierCurves){midY=bezierCurves[j].evaluate(midX);this.midPoint.x=midX;this.midPoint.y=midY;}}curveLine=new $C.CurveLineObject({TripleId:this.mTripleId,GraphObjectManager:this,IsVertical:true,Identity:this.identity,startPoint:this.startPoint,midPoint:this.midPoint,endPoint:this.endPoint});for(i=0;i<numberOfBezierCurves;++i){curveLine.AddBezierCurveLine(bezierCurves[i]);}retVal=curveLine;}}return retVal;}});}());