(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.ListMapperHoriz","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo.TristateCheckBox","mstrmojo.Pulldown","mstrmojo.ACL.UserTreeBrowser","mstrmojo.DataGrid","mstrmojo.DropDownButton","mstrmojo.ListBox","mstrmojo.DivItemRenderer","mstrmojo.VBox","mstrmojo.Box","mstrmojo.ACL.UserInputBox","mstrmojo.Editor","mstrmojo.ACL.UserDataService","mstrmojo.StackContainer","mstrmojo.fe.FilterUtils","mstrmojo.fe.FilterEditor");mstrmojo.requiresDescs(218,219,221,308,505,531,629,767,922,959,1088,1442,1825,2056,2102,2140,2156,3336,5657,8078,8079,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,9048,9149,9151,12085,12299,12436,12905,13082);var Enum_RIGHT_FLAGS=[1,4,8,16,32,64,128],Enum_RIGHT_DESC=[mstrmojo.desc(1825,"Browse"),mstrmojo.desc(8078,"Read"),mstrmojo.desc(8079,"Write"),mstrmojo.desc(629,"Delete"),mstrmojo.desc(8080,"Control"),mstrmojo.desc(8081,"Use"),mstrmojo.desc(8082,"Execute")],Enum_RIGHT_DESC_SHORT=["B","R","W","D","C","U","E"],$EMMA_CUBE_FILTER_EDITOR_ID="emmacubeSFE",$USER_LOGIN_ID="93B9A8EB46D9C6A4ADA5FEBAB092A7CF",$ARR=mstrmojo.array,$EXPR=mstrmojo.expr,$ET=$EXPR.ET,$ANGLES=mstrmojo.string.htmlAngles,$GET_EXPRESSION_XML=mstrmojo.fe.FilterUtils.getExprXml,$DISABLED_TOOLTIP=mstrmojo.desc(12905,"Security rules cannot be defined/updated for metric only datasets."),$SPACE_TEXT=" ",$LEFT_CURLY_PARENTHESIS_TEXT="{",$RIGHT_CURLY_PARENTHESIS_TEXT="}",$LEFT_PARENTHESIS_TEXT="(",$RIGHT_PARENTHESIS_TEXT=")",$BETWEEN_TEXT=mstrmojo.desc(308,"and");function getNodeExpression(node){var result=[],constantCount,temp,constants,constant0,constant1,value;if(node&&node.a&&node.a.n){result.push($ANGLES(node.a.n));if(node.fm&&node.fm.n){result.push($LEFT_PARENTHESIS_TEXT+$ANGLES(node.fm.n)+$RIGHT_PARENTHESIS_TEXT);if(node.fn!==undefined){result.push($ANGLES($EXPR.fnName(node.et,node.fn,node.fnt,node.fm.dtp)));constantCount=$EXPR.fnCstCount(node.fn,node.fnt);if(node.et===$ET.AC){if(constantCount>=1){if(node.a2&&node.a2.n){result.push($ANGLES(node.a2.n));if(node.fm2&&node.fm2.n){result.push($LEFT_PARENTHESIS_TEXT+$ANGLES(node.fm2.n)+$RIGHT_PARENTHESIS_TEXT);}}if(constantCount>1){result.push($BETWEEN_TEXT);if(node.a3&&node.a3.n){result.push($ANGLES(node.a3.n));if(node.fm3&&node.fm3.n){result.push($ANGLES(node.fm3.n));}}}}}else{if(node.et===$ET.AL){temp=[];$ARR.forEach(node.cs,function(item){temp.push(item.v);});result.push(temp.join(mstrConfig.listSep||$SPACE_TEXT));}else{if(constantCount>=1){constants=node.cs;constant0=constants&&constants[0];value=constant0&&constant0.p&&constant0.p.n;result.push(value?($LEFT_CURLY_PARENTHESIS_TEXT+$ANGLES(value)+$RIGHT_CURLY_PARENTHESIS_TEXT):$ANGLES(constant0&&constant0.v));if(constantCount>1){constant1=constants&&constants[1];result.push($BETWEEN_TEXT);value=constant1&&constant1.p&&constant1.p.n;result.push(value?($LEFT_CURLY_PARENTHESIS_TEXT+$ANGLES(value)+$RIGHT_CURLY_PARENTHESIS_TEXT):$ANGLES(constant1&&constant1.v));}}}}}}}return $LEFT_PARENTHESIS_TEXT+result.join($SPACE_TEXT)+$RIGHT_PARENTHESIS_TEXT;}function getFilterText(node){var result=[];if(!node){return"";}if(node.nds){$ARR.forEach(node.nds,function(item){result.push(getNodeExpression(item));});}else{return getNodeExpression(node);}return result.join($SPACE_TEXT+$EXPR.BRANCH_FNS[node.fn]+$SPACE_TEXT);}function saveSecurityFilters(){var objectInfo=this.oi,editor=this,filters=[];mstrmojo.array.forEach(objectInfo.acls,function(item){if(item.isDirty){filters.push({uid:item.did,fg:item.fg,exp:$GET_EXPRESSION_XML(item.filter)});}});mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function success(res){if(editor.postSaveACL){editor.postSaveACL(true);}editor.close();},failure:function failure(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{taskId:"DISetCubeSecurityFilter",cubeid:objectInfo.did,filter:JSON.stringify(filters)});}function openSecurityFilterEditor(dataInfo){var dataGrid=this.dataGrid,showEditor=function showEditor(data,filter){var filterModel={expr:filter,hasPrompt:true,targets:data.concat({n:"User Login",t:$EXPR.TP.PROMPT,did:$USER_LOGIN_ID,st:$EXPR.STP.PROMPT_STRING})},fnOnSaveFilter=function fnOnSaveFilter(filterModel){var expression=filterModel.expr;dataInfo.isDirty=true;dataInfo.filter=expression;dataGrid.set("items",dataGrid.items.slice(0));},editor,disableElementBrowsing=function disableElementBrowsing(){return true;};editor=window.mstrmojo&&mstrmojo.all[$EMMA_CUBE_FILTER_EDITOR_ID]||mstrmojo.insert({id:$EMMA_CUBE_FILTER_EDITOR_ID,scriptClass:"mstrmojo.fe.FilterEditor",skipAndOrPopup:true,showLimits:false,cssClass:"mstrmojo-charcoalboxe mstrmojo-FE mstrmojo-SecurityFilter-editor"});editor.validExprTypes=$ARR.hash([mstrmojo.expr.ET.AQ,mstrmojo.expr.ET.AC]);editor.set("title",mstrmojo.desc(12085,"Select a filter"));editor.set("onSave",fnOnSaveFilter);editor.set("model",filterModel);editor.set("disableElementsBrowsing",disableElementBrowsing);editor.open(null,{zIndex:dataGrid.parent.zIndex+10||10});};showEditor(this.parent.dataGrid.parent.candidates,dataInfo.filter||"");}function showPopMenu(dataInfo,target){var $this=this,dataGrid=this.dataGrid,menuHelper=this.menuHelper=this.menuHelper||new mstrmojo.MenuButton({cm:[{n:mstrmojo.desc(1088,"Edit"),did:"Edit"},{n:mstrmojo.desc(629,"Delete"),did:"Delete"}],cmCssClass:"di-sf-cxt-menu",getMenuPosition:function getMenuPosition(){var pos=mstrmojo.dom.position(target,true);return{x:Math.round(pos.x),y:Math.round(pos.y+pos.h)};},executeCommand:function(item){switch(item.did){case"Edit":openSecurityFilterEditor.call($this,dataInfo);break;case"Delete":dataInfo.isDirty=true;dataInfo.filter=null;dataGrid.set("items",dataGrid.items.slice(0));break;}}});menuHelper.set("zIndex",dataGrid.parent.zIndex+10);menuHelper.showContextMenu();}function _getACLHint(r){var h=[],d=Math.floor(r/1000),g=r%1000,rf=Enum_RIGHT_FLAGS,rd=Enum_RIGHT_DESC,len=rf.length,s,i;for(i=0;i<len;i++){h.push(rd[i]);h.push(" ");if((g&rf[i])>0){h.push(mstrmojo.desc(8083,"Granted"));}else{if((d&rf[i])>0){h.push(mstrmojo.desc(8084,"Denied"));}else{h.push(mstrmojo.desc(959,"Default"));}}h.push(",");}s=h.join("");return s.substring(s,s.length-1);}function _getACLLabel(r){var h=[],g=r%1000,rf=Enum_RIGHT_FLAGS,rd=Enum_RIGHT_DESC_SHORT,len=rf.length,s,i;for(i=0;i<len;i++){if((g&rf[i])>0){h.push(rd[i]);h.push(",");}}s=h.join("");return s.substring(s,s.length-1);}function _fixACL(v){return{"253000":255000,"253":255,"221":223,"197":199,"69":71}[v]||v;}function _fixACLTwoStates(v){return{"253000":255000,"253":255,"32221":223,"56197":199}[v]||v;}function _updatePulldown(w,v){var its=w.items,idx=mstrmojo.array.find(its,w.itemIdField,v),iWas=w.customItem,iIdx=its.length-2;if(idx===-1){var iNew={n:_getACLLabel(v),rgt:v};if(iWas){its.splice(iIdx,1);}iIdx=its.length-1;its.splice(iIdx,0,iNew);w.customItem=iNew;}else{if(iWas&&idx!==iIdx){its.splice(iIdx,1);w.customItem=null;}}w.set("title",_getACLHint(v));w.value=v;}function _getCategoriesByType(t){return{"776":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}],"779":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}]}[t]||[{n:mstrmojo.desc(8090,"View"),rgt:199},{n:mstrmojo.desc(767,"Modify"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8092,"Custom Permission Level"),rgt:-1}];}function _isFolder(oi){return(oi&&oi.t===8);}function _postProcessACLs(oi){var acls=oi.acls,inhs=oi.inhs,exAcls=[],acl,g,rgt,i,len;if(_isFolder(oi)){acls=acls.concat(mstrmojo.hash.valarray(inhs));}for(i=0,len=acls.length;i<len;i++){acl=acls[i];rgt=acl.rgt;if(rgt>1000){g=mstrmojo.hash.copy(acl);g.den=true;g.rgt=Math.floor(rgt/1000);exAcls.push(g);}if((rgt%1000)>0){g=mstrmojo.hash.copy(acl);g.den=false;g.rgt=rgt%1000;exAcls.push(g);}}oi.acls=exAcls;return oi;}function _getSaveXML(oi){var cfg={isSerializable:function(nodeName,jsons,idx){switch(nodeName){case"did":case"rgt":case"n":case"acls":case"t":case"st":case"inh":case"den":return true;}return false;},getArrItemName:function(n,v,i){if(n==="acls"){return"acl";}},convertBoolean:true};return mstrmojo.string.json2xml("oi",oi,cfg);}function _saveACL(e,isToClose){var oi=e&&e.oi,xml;if(oi){oi=_postProcessACLs(oi);xml=_getSaveXML(oi);var params={taskId:"saveObjectACL",objectXML:xml,objectType:oi.t,objectID:oi.did};mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(res){if(isToClose){if(e.postSaveACL){e.postSaveACL(true);}e.close();}},failure:function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));if(isToClose){if(e.postSaveACL){e.postSaveACL(false);}e.close();}}},params);}}function _addACL(e){var acl=e.aclList,ci=e.objectInputer,pd=e.rightPulldown,its=ci.getSelectedObjects(),len=its.length,added=[],it,rgt=pd.value,i,idx,ace;if(!ci.isValid()){mstrmojo.alert(mstrmojo.desc(9048,"Some users/groups do not exist. Please remove them in order to proceed."),null,e.alertTitle);return false;}for(i=0;i<len;i++){it=its[i];idx=mstrmojo.array.find(acl.items,"did",it.did);if(idx!==-1){ace=acl.items[idx];if(e.uneditableRights[ace.rgt]){continue;}}added.push(new mstrmojo.Obj({n:it.n,did:it.did,st:it.st,rgt:rgt,filter:"",fg:1,newItem:true}));}if(added.length>0){var count=0;mstrmojo.array.forEach(added,function(item){mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function success(res){var userInfo=res.oi.gsfsr.u,current;if(userInfo.mi){current=added[count];current.partial=userInfo.partial_type;current.fg=userInfo.partial_type||3;current.filter=mstrmojo.DI.ui.dialogs.DIPermissionDialog.buildWalk(userInfo.mi.exp.nd,[].concat(userInfo.mi["in"].oi),e.formTypes);current.filterText=userInfo.mi.exp.content;}count++;if(count===added.length){acl.add(added);e.set("hasChanged",true);}}},{taskId:"DIGetCubeSecurityFilter",uid:item.did,cubeid:e.cubeid});});var ret=mstrmojo.array.findMulti(acl.items,"did",added);if(ret.count){var idxs=ret.indices.concat().sort(mstrmojo.array.numSorter).slice(0,ret.count);for(i=idxs.length-1;i>-1;i--){acl.remove(idxs[i]);}}}ci.set("items",[]);e.set("inEditMode",false);return true;}mstrmojo.DI.ui.dialogs.DIPermissionDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIPermissionDialog",cssClass:"mstrmojo-di-permissions",zIndex:10,inEditMode:false,hasChanged:false,showButtonText:true,showObjectNameOnTitle:true,uneditableRights:{},defaultRight:223,viewOnlyMode:false,title:mstrmojo.desc(13082,"Permissions"),userSelectorTitle:mstrmojo.desc(8091,"User/User Group Browser"),formTypes:{},userSelector:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-UserEditor",help:"user_group_browser.htm",onClose:function(){this.userBrowser.clearTreeSelect();},children:[{scriptClass:"mstrmojo.ACL.UserTreeBrowser",alias:"userBrowser",anim:true,selectionAcrossBranch:true,multiSelect:true},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(evt){var ue=this.parent.parent,e=ue.opener,ci=e.objectInputer,ub=ue.userBrowser,sls=ub.getTotalSelections();if(sls&&sls.length>0){ci.add(sls,ci.items.length-1);e.set("inEditMode",true);}ue.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(evt){this.parent.parent.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}}]}],onOpen:function(){this.set("title",this.opener.userSelectorTitle);}},customACL:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(8092,"Custom Permission Level"),cssClass:"mstrmojo-CustomACLEditor",help:"Custom_Permission_Level_dialog_box.htm",onOpen:function(){var rgt=this.rgt,d=Math.floor(rgt/1000),g=rgt%1000,chs=this.children,ch,r,i,len;for(i=0,len=chs.length;i<len;i++){ch=chs[i];r=ch.right;if(this.twoStates){ch.set("grayed",false);ch.set("checked",false);}else{ch.set("grayed",true);ch.set("checked",true);}if((d&r)>0){ch.set("checked",false);ch.set("grayed",false);}if((g&r)>0){ch.set("checked",true);ch.set("grayed",false);}}},getACLValue:function(){var g=0,d=0,chs=this.children,ch,i,len;for(i=0,len=chs.length;i<len;i++){ch=chs[i];if(ch.grayed||!ch.right){continue;}if(ch.checked){g+=ch.right;}else{d+=ch.right;}}return d*1000+g;},children:[{scriptClass:"mstrmojo.TristateCheckBox",alias:"browse",right:1,text:mstrmojo.desc(1825,"Browse")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"read",right:4,text:mstrmojo.desc(8078,"Read")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"write",right:8,text:mstrmojo.desc(8079,"Write")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"delete",right:16,text:mstrmojo.desc(629,"Delete")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"control",right:32,text:mstrmojo.desc(8080,"Control")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"use",right:64,text:mstrmojo.desc(8081,"Use")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"execute",right:128,text:mstrmojo.desc(8082,"Execute")},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(evt){var e=this.parent.parent;if(e.onOK){e.onOK();}e.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(221,"Cancel"),onclick:function(evt){var e=this.parent.parent;if(e.onCancel){e.onCancel();}e.close();}}]}]},_set_oi:function(n,v){this.oi=this.preProcessACLs(v);return true;},postCreate:function(){this.oi=this.preProcessACLs(this.oi);},preProcessACLs:function(oi){var acls=oi.acls,len=acls&&acls.length,isF=_isFolder(oi),aclMap={},acl,r,inhs,i;if(isF){inhs={};oi.inhs=inhs;}for(i=0;i<len;i++){acl=new mstrmojo.Obj(acls[i]);if(isF&&acl.inh){inhs[acl.did]=mstrmojo.hash.copy(acl);continue;}r=aclMap[acl.did];if(!r){r=mstrmojo.hash.copy(acl);r.rgt=0;delete r.den;aclMap[acl.did]=r;}r.rgt+=acl.den?acl.rgt*1000:acl.rgt;}acls=mstrmojo.hash.valarray(aclMap);oi.acls=acls;return oi;},postSaveACL:function(){},getAvailableRightsForDisplay:function(){return _getCategoriesByType(this.oi.st);},getAvailableRightsForSelection:function(){return _getCategoriesByType(this.oi.st);},onOpen:function(){delete mstrmojo.all[$EMMA_CUBE_FILTER_EDITOR_ID];var pd=this.rightPulldown;pd.set("items",this.getAvailableRightsForSelection());pd.set("value",this.defaultRight);var ci=this.objectInputer,us=this.userSelector,ub=us&&us.userBrowser;ci.zIndex=this.zIndex+1||11;if(ub&&ub.hasRendered){ub.set("items",[]);ub.getContent(ub);}var DS=mstrmojo.ACL.UserDataService,INITIAL_USERS_COUNT=200,success=function(candidates){ci.set("candidates",candidates);},failure=function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));},callbacks={success:success,failure:failure};DS.getUserCandidates(INITIAL_USERS_COUNT,callbacks);this.set("inEditMode",false);this.set("hasChanged",false);},onClose:function(){var ci=this.objectInputer;ci.set("items",[]);this.aclList.clearSelect();this.destroy();},oninEditModeChange:function(){var e=this;if(e.inEditMode){mstrmojo.css.removeClass(e.objectInputer.domNode,"small");}else{mstrmojo.css.addClass(e.objectInputer.domNode,"small");}},children:[{scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-ACLEditor-ACLList",cssText:"width: 100%",alias:"aclList",renderOnScroll:false,makeObservable:true,itemDisplayField:"n",dropZone:true,bindings:{items:"this.parent.oi.acls"},sortCol:"",sortAsc:new mstrmojo.Obj({n:true,rgt:true}),sort:function(prop,asc){var sortFunc=function mySort(p,s){return function(a,b){var aProp=eval("a."+p),bProp=eval("b."+p),r=aProp>bProp;if(aProp===bProp){return 0;}if(s===r){return 1;}return -1;};};if(this.items){this.items.sort(sortFunc(prop,asc));this.render();}},onremove:function(evt){var oi=this.parent.oi;if(!_isFolder(oi)){return ;}var inhs=oi.inhs,its=evt.value,len=its&&its.length,did,i;for(i=0;i<len;i++){did=its[i].did;delete inhs[did];}},onadd:function(evt){var oi=this.parent.oi;if(!_isFolder(oi)){return ;}var inhs=oi.inhs,its=evt.value,len=its&&its.length,did,i;for(i=0;i<len;i++){did=its[i].did;inhs[did]=mstrmojo.hash.copy(its[i]);inhs[did].inh=true;}},onACLChanged:function(d){var oi=this.parent.oi;this.parent.set("hasChanged",true);if(!_isFolder(oi)){return ;}oi.inhs[d.did]=mstrmojo.hash.copy(d);oi.inhs[d.did].inh=true;},postCreate:function postCreate(){this.columns=[{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5657,"User/Group"),onclick:function(){var asc=!(this.dataGrid.sortAsc.n);this.dataGrid.set("sortCol","n");this.dataGrid.sortAsc.set("n",asc);this.dataGrid.sort("n",asc);},postCreate:function(){if(this.dataGrid.sortCol==="n"){this.set("cssClass",(this.dataGrid.sortAsc.n)?"mstrmojo-sortAsc":"mstrmojo-sortDesc");}}},dataFunction:function(item,idx,w){return'<div class="mstrmojo-ACLEditor-user '+(item.st===8705?"ug":"u")+'">'+mstrmojo.string.encodeHtmlString(item.n)+"</div>";},colCss:"userCol"},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9149,"Access"),onclick:function(){var asc=!(this.dataGrid.sortAsc.rgt);this.dataGrid.set("sortCol","rgt");this.dataGrid.sortAsc.set("rgt",asc);this.dataGrid.sort("rgt",asc);},postCreate:function(){if(this.dataGrid.sortCol==="rgt"){this.set("cssClass",(this.dataGrid.sortAsc.rgt)?"mstrmojo-sortAsc":"mstrmojo-sortDesc");}}},colCss:"rgtCol",dataWidget:{scriptClass:"mstrmojo.MouseOverContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"access-label",bindings:{text:function(){var access=this.parent.dataGrid.parent.getAvailableRightsForDisplay(),len=access.length,i;for(i=0;i<len;i++){if(access[i].rgt===this.parent.data.rgt){return access[i].n;}}return mstrmojo.desc(2056,"Custom");}}},{scriptClass:"mstrmojo.HBox",visible:false,children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"rgt",popupToBody:true,selectionPolicy:"reselect",defaultSelection:0,postCreate:function(){this.markupMethods=mstrmojo.hash.copy({ondataChange:function(){var d=this.parent.parent.data;this.set("value",d[this.itemIdField]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(!this.visible&&this.popupRef){this.popupRef.set("visible",false);}}},mstrmojo.hash.copy(this.markupMethods));this.items=this.parent.parent.dataGrid.parent.getAvailableRightsForSelection();},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){if(v===-1){var e=this.parent.parent.dataGrid.parent,me=this;e.openPopup("customACL",{zIndex:e.zIndex+10,rgt:vWas,twoStates:!!this.parent.parent.data.newItem,onOK:function(){me.set("value",this.getACLValue());},onCancel:function(){me.set("value",vWas);}});return false;}v=_fixACL(v);_updatePulldown(this,v);this.parent.parent.data.set(this.itemIdField,v);if(vWas!==null){this.parent.parent.dataGrid.onACLChanged(this.parent.parent.data);}return true;}return true;}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(evt){var me=this,fnOk=function(){var dg=me.parent.parent.dataGrid;dg.remove(me.parent.parent.data);dg.parent.set("hasChanged",true);};mstrmojo.confirm(mstrmojo.desc(12299,"Are you sure you want to delete the user/user group #?").replace("#",this.parent.parent.data.n),{confirmBtn:{fn:fnOk}},{zIndex:9999});}}]}],postCreate:function(){var doSwitch=!this.dataGrid.parent.viewOnlyMode&&!this.dataGrid.parent.uneditableRights[this.data.rgt];this.set("doSwitch",doSwitch);}}}];if(this.parent.oi.canEdit){this.columns.push({headerText:mstrmojo.desc(12436,"Data Security"),headerCss:"di-security-header",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"security-filter-col",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click><span class="di-sf-icon"></span><span class="di-sf-n"></span><span class="di-sf-mn"></span></div>',markupMethods:{ontitleChange:function(){this.domNode.title=this.title;},ontextChange:function(){this.domNode.children[1].innerHTML=this.text||"";},oncssTextChange:mstrmojo.Widget.cssTextMarkupMethod,onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod},onclick:function(evt){var target=evt.target||mstrmojo.dom.eventTarget(evt.hWin,evt.e);if(target.className.indexOf("di-sf-mn")>-1){showPopMenu.call(this,this.parent.data,target);}else{if(!this.parent.data.filter){openSecurityFilterEditor.call(this,this.parent.data);}}},onRender:function onrender(){var data=this.parent.data;if(this.domNode){if(data.noElement){mstrmojo.css.toggleClass(this.domNode,"noEdit",true);this.domNode.title="Security rules cannot be defined/updated for metric only datasets.";}else{mstrmojo.css.toggleClass(this.domNode,"update",!!data.filter);}}},bindings:{text:function(){var data=this.parent.data;return data.filter?mstrmojo.desc(505,"Update"):mstrmojo.desc(922,"Add...");}}}});}}},{scriptClass:"mstrmojo.HBox",cssClass:"di-permission-MorePanel",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2156,"Add")+":",cssClass:"di-permission-addLabel"},{scriptClass:"mstrmojo.ACL.UserInputBox",emptyText:mstrmojo.desc(9151,"Type users or groups here."),cssClass:"mstrmojo-ObjectInputBox mstrmojo-ACLEditor-inputBox small",noCache:true,onRender:function(){var e=this.parent.parent;if(e){e.objectInputer=this;}},postBuildDom:function(){var me=this;this._clickHandler=function(evt){me.parent.parent.set("inEditMode",true);};mstrmojo.dom.attachEvent(this.domNode,"click",this._clickHandler);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",onclick:function(evt){var e=this.parent.parent;e.openPopup("userSelector",{zIndex:e.zIndex+10});},text:"..."},{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"rgt",value:-1,defaultSelection:0,selectionPolicy:"reselect",onRender:function(){var e=this.parent.parent;if(e){e.rightPulldown=this;}},postCreate:function(){this.items=this.parent.parent.getAvailableRightsForSelection();},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){if(v===-1){var e=this.parent.parent,me=this;e.openPopup("customACL",{zIndex:e.zIndex+10,rgt:vWas,twoStates:true,onOK:function(){me.set("value",this.getACLValue());},onCancel:function(){me.set("value",vWas);}});return false;}v=_fixACLTwoStates(v);_updatePulldown(this,v);return true;}return true;},bindings:{visible:"this.parent.parent.inEditMode"}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",onclick:function(){var e=this.parent.parent;_addACL(e);},text:mstrmojo.desc(2156,"Add"),bindings:{visible:"this.parent.parent.inEditMode"}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),bindings:{enabled:function(){var oi=this.parent.parent.oi;return(oi.acg&32)>0;},visible:"!this.parent.parent.viewOnlyMode"},onclick:function(evt){var e=this.parent.parent;if(_addACL(e)){_saveACL(e,true);}saveSecurityFilters.call(this.parent.parent);},preBuildRendering:function(){if(!this.parent.parent.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",onclick:function(evt){if(!this.parent.parent.inEditMode){this.parent.parent.close();this.parent.parent.set("hasChanged",false);}this.parent.parent.objectInputer.set("items",[]);this.parent.parent.set("inEditMode",false);},bindings:{iconClass:function(){if(this.parent.parent.inEditMode||this.parent.parent.hasChanged){return"mstrmojo-Editor-button-Cancel";}return"mstrmojo-Editor-button-Close";},text:function(){if(!this.parent.parent.showButtonText){return"";}if(this.parent.parent.inEditMode||this.parent.parent.hasChanged){return mstrmojo.desc(2140,"Cancel");}return mstrmojo.desc(2102,"Close");}}}]}]});mstrmojo.MouseOverContainer=mstrmojo.declare(mstrmojo.StackContainer,null,{scriptClass:"mstrmojo.MouseOverContainer",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout></div>',doSwitch:true,markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onmouseover:function(){if(this.doSwitch){this.set("selected",this.children[1]);}},onmouseout:function(){if(this.doSwitch){this.set("selected",this.children[0]);}},preBuildRendering:function(){this.set("selected",this.children[0]);}});$ENUM_DataType={Char:8,Date:14,Time:15,TimeStamp:16,BigDecimal:30,Int64:34};$PERMISSION_DIALOG=mstrmojo.DI.ui.dialogs.DIPermissionDialog;$PERMISSION_DIALOG.buildWalk=function buildWalk(node,objectInfos,formDataTypes){var result,attributeTagName,formTagName,prompt,attribute,form,attributeId,formId,formDTMapping={1:$ENUM_DataType.TimeStamp,8:$ENUM_DataType.Date,9:$ENUM_DataType.Time,2:$ENUM_DataType.Int64,3:$ENUM_DataType.Char,11:$ENUM_DataType.BigDecimal,};if(node===undefined){return null;}if(node.op&&node.op.fnt===mstrmojo.expr.FN.AND){if(Object.prototype.toString.call(node.nd)==="[object Array]"){result={fn:node.op.fnt,et:node.et,nds:[]};$ARR.forEach(node.nd,function(item){result.nds.push(buildWalk(item,objectInfos,formDataTypes));});}else{if(!node.nd){return null;}result=buildWalk(node.nd,objectInfos,formDataTypes);}}else{result={fn:node.op.fnt,et:node.et};$ARR.forEach($ARR.ensureArray(node.nd),function(item){if(item.at){attributeTagName=result.a?"a2":"a";formTagName=result.fm?"fm2":"fm";attribute=item.at.mi["in"].oi[0];attributeId=attribute.did;form=item.fm.mi["in"].oi[0];formId=form.did;result[attributeTagName]={did:attributeId,n:attribute.n,t:attribute.tp};result[formTagName]={did:formId,n:form.n,t:form.tp,dtp:formDTMapping[formDataTypes[attributeId+formId]]||$ENUM_DataType.Char,ibf:true,idf:true,itf:true};}else{if(item.cst){if(item.prompt_instances){prompt=objectInfos[item.prompt_instances.prompt_instance.pin];result.cs=[{p:{did:prompt.did,n:prompt.n,st:prompt.stp,t:prompt.tp}}];}else{result.cs=result.cs||[];result.cs.push({v:item.cst.content,dtp:item.ddt});}}else{if(item.content!==undefined){result.cs=result.cs||[];result.cs.push({v:item.content,dtp:item.ddt});}}}});}return result;};}());