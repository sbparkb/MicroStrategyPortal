(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._IsExprNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo._HasEditableText","mstrmojo.css","mstrmojo.string","mstrmojo.dom");var _C=mstrmojo.css,_D=mstrmojo.dom,_S=mstrmojo.string,stopBubble=function(evt){this._super&&this._super(evt);_D.stopPropogation(evt.hWin,evt.e);},_createSetHtml=mstrmojo.fe._IsRelationTreeNode.createSetHtml;mstrmojo.fe.DynamicNode=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._IsExprNode,mstrmojo.fe._IsRelationTreeNode,mstrmojo._HasEditableText],{scriptClass:"mstrmojo.fe.DynamicNode",markupString:'<div id="{@id}" class="mstrmojo-dynamic {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-dynamic-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-dynamic-prefix-text"  mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">'+_createSetHtml+'<span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-onhoverparent mstrmojo-dynamicNode" title="'+mstrmojo.desc(13229,"Add this condition to the target list of a selector.")+'"><span class="mstrmojo-dynamicNode-info"><span class="mstrmojo-textset"></span></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" ></img></span><span class="mstrmojo-textset mstrmojo-rename-text" mstrAttach:click >'+mstrmojo.desc(1388,"Rename")+"</span>"+_createSetHtml+"</div></div>",markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},dynamicNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.lastChild.firstChild.lastChild;},createSetOptNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},createSetNode:function(){return this.domNode.lastChild.lastChild;},renameNode:function(){return this.domNode.lastChild.childNodes[2];}},markupMethods:{onprefixedAndOrEditableChange:function(){_C.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){_C.toggleClass(this.dynamicNode,["selected"],this.selected);},onisEditingChange:function(){_C.toggleClass(this.domNode,["renaming"],this.isEditing);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=this.data.ph.n;},onglowChange:function(){var me=this;_C.toggleClass(me.dynamicNode,["glow"],this.glow);if(this.glow){setTimeout(function(){_C.toggleClass(me.dynamicNode,["glow"],false);me.glow=false;},1000);}},onnoRelationOperatorChange:function(){_C.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);},onnoRelationChange:function(){_C.toggleClass(this.dynamicNode,["noRelation"],this.noRelation);}},editableSlot:"textNode",editButtonSlot:"renameNode",init:function(props){var d=props.data;if(d){var nf=props.tree.nameFactory;if(d.ph.n){nf.setName(d.ph.n,this);}else{d.ph.n=nf.getNewName(this,mstrmojo.desc(12033,"Dynamic Condition")+" ");}}this._super(props);},_set_data:function(n,v){var vWas=this.data,chg=(vWas!==v);if(chg){this.data=v;this.text=v.ph.n;}return chg;},preclick:function pc(evt){var p=null,t=_D.eventTarget(evt.hWin,evt.e);if(_D.contains(this.prefixNode,t,true)){p="andor";}else{if(_D.contains(this.createSetOptNode,t,true)&&!this.noRelationOperator&&!this.noRelation){p="createSetOpt";}else{if(_D.contains(this.createSetNode,t,true)&&!this.noRelation){p="createSet";}else{if(_D.contains(this.renameNode,t,true)){this.set("isEditing",true);}}}}evt.part=p;},isEmpty:function(){var d=this.data,ph=d&&d.ph;return !(ph&&ph.n);},del:function del(){var p=this.parent,nf=this.tree.nameFactory;if(p&&p.remove&&this.data){p.remove(this.data);nf.removeName(this.data.ph.n);}},onkeyup:stopBubble,onkeydown:stopBubble,onTextEditComplete:function(){var t=this.tree,nf=t.nameFactory,txt=_S.trim(this.text||""),originalTxt=this.data.ph.n;if(txt&&txt!==originalTxt){if(nf.isNameExist(txt)){nf.names[txt].set("glow",true);this.set("isEditing",true);}else{nf.changeName(originalTxt,txt,this);this.data.ph.n=txt;}}},isSelectableArea:function(el){return mstrmojo.dom.contains(this.dynamicNode,el,true);},avatarCssCls:"mstrmojo-FE mstrmojo-dynamicNode",getAvatarNode:function(){return this.dynamicNode.cloneNode(true);}});})();