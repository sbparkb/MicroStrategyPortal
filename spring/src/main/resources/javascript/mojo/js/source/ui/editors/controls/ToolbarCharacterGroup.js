(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.Label","mstrmojo.HBox","mstrmojo.ui.Pulldown","mstrmojo.ui.ButtonBar","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ui.editors.controls.ComboBox","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo._FormatDefinition","mstrmojo.models.FormatModel","mstrmojo.css","mstrmojo.array","mstrmojo.color");var $FD=mstrmojo._FormatDefinition,$FORMAT_MODEL=mstrmojo.models.FormatModel,$ENUM_FORMAT_PROPERTIES=$FORMAT_MODEL.ENUM_PROPERTY_NAMES;var fontSizeItems=$FD.Sizes.slice(1).map(function(size){return{idx:parseInt(size.n,10),n:size.n+"pt"};});var fontFamilyItems=$FD.Families.slice(1).map(function(font){return{n:font.n,id:font.n};});var fontStyleMap={bold:$ENUM_FORMAT_PROPERTIES.FONT_WEIGHT,italic:$ENUM_FORMAT_PROPERTIES.FONT_STYLE,underline:$ENUM_FORMAT_PROPERTIES.UNDERLINE,strikeout:$ENUM_FORMAT_PROPERTIES.LINE_THROUGH};function extractFontValue(formats){return formats.font||"";}function updateFontFamily(formats){var fontValue=extractFontValue(formats).match(/'([\w\W]*?)'/),fontFamily=formats[$ENUM_FORMAT_PROPERTIES.FONT_FAMILY]||(fontValue&&fontValue[1]);var newIndex=Math.max(mstrmojo.array.find(fontFamilyItems,"n",fontFamily),0);this.fontToolbarConfig.fontFamily.set("selectedIndex",newIndex);}function updateFontStyle(formats){var styleValues=[],font=extractFontValue(formats),textDecoration=formats["text-decoration"]||"",fnAddFontStyle=function(propertyName,cssValue,cssName,idx){if(formats[propertyName]||cssValue.match(new RegExp(cssName))){styleValues.push(idx);}};fnAddFontStyle($ENUM_FORMAT_PROPERTIES.FONT_WEIGHT,font,"bold",0);fnAddFontStyle($ENUM_FORMAT_PROPERTIES.FONT_STYLE,font,"italic",1);fnAddFontStyle($ENUM_FORMAT_PROPERTIES.UNDERLINE,textDecoration,"underline",2);fnAddFontStyle($ENUM_FORMAT_PROPERTIES.LINE_THROUGH,textDecoration,"line-through",3);if(styleValues.length!==0){this.fontToolbarConfig.fontStyle.select(styleValues);}}function updateFontSizeAndColor(formats){var sizeAndColorContainer=this.fontToolbarConfig.fontSizeAndColor,fontSize=sizeAndColorContainer.fontSize,fontSizeMatch=extractFontValue(formats).match(/([0-9]+)[,\.]?[0-9]*pt/),fontSizeNumber=formats[$ENUM_FORMAT_PROPERTIES.FONT_SIZE]||(fontSizeMatch&&fontSizeMatch[1]);fontSize.set("selectedValue",fontSizeNumber?(fontSizeNumber+"pt"):fontSize.items[0].n);sizeAndColorContainer.fontColor.set("selectedValue",mstrmojo.color.fixFullHexValue(formats[$ENUM_FORMAT_PROPERTIES.COLOR]||formats.color||""));}mstrmojo.ui.editors.controls.ToolbarCharacterGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.ToolbarCharacterGroup",fontSizeAndColor:undefined,init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-EditCharacter");var childrenGroup=new mstrmojo.HBox({alias:"fontToolbarConfig",cellSpacing:"5px",cssText:"border-collapse: separate;border-spacing: 5px;"});childrenGroup.addChildren([mstrmojo.ui.Pulldown.newPulldown(fontFamilyItems,function(newItem,oldItem){this.parent.parent.raiseFormatValueChange($ENUM_FORMAT_PROPERTIES.FONT_FAMILY,newItem.id,oldItem&&oldItem.id);},0,{alias:"fontFamily",width:"60px"}),{scriptClass:"mstrmojo.ui.ButtonBar",alias:"fontStyle",multiSelect:true,cssText:"width:90px;margin-top:0px;border-collapse: collapse;",items:[{n:mstrmojo.desc(2718,"Bold"),id:"b",css:"bold"},{n:mstrmojo.desc(2719,"Italic"),id:"i",css:"italic"},{n:mstrmojo.desc(2720,"Underline"),id:"u",css:"underline"}],postselectionChange:function(evt){var added=evt.added,item=this.items[added?added[0]:evt.removed[0]],isSelected=!!added;this.parent.parent.raiseFormatValueChange(fontStyleMap[item.css],isSelected,!isSelected);}},{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",cssText:"margin-top:0px;border-collapse: collapse;",alias:"fontSizeAndColor",col1Width:"50%",col2Width:"50%",dividerWidth:"5px",width:"120px",children:[{scriptClass:"mstrmojo.ui.editors.controls.ComboBox",alias:"fontSize",slot:"col1Node",selectedValue:"10",items:fontSizeItems,validateTextInput:function(text){return(/^[0-9]+(pt)?$/.test(text));},updateSelection:function(){this.set("selectedValue",parseInt(this.txtLabel.value,10).toString());},postselectedValueChange:function(evt){var newValue=parseInt(evt.value,10)+"pt",oldValue=parseInt(evt.valueWas,10)+"pt";this.parent.parent.parent.raiseFormatValueChange($ENUM_FORMAT_PROPERTIES.FONT_SIZE,newValue,oldValue);}},{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",alias:"fontColor",slot:"col2Node",showGradient:false,isHostedWithin:true,selectedValue:"#000000",postselectedValueChange:function(evt){this.parent.parent.parent.raiseFormatValueChange($ENUM_FORMAT_PROPERTIES.COLOR,evt.value,evt.valueWas);}}]}]);this.addChildren(childrenGroup);},setFormatSource:function setFormatSource(formats){var group=this;this.syncControls(function(){updateFontFamily.call(group,formats);updateFontStyle.call(group,formats);updateFontSizeAndColor.call(group,formats);});}});}());