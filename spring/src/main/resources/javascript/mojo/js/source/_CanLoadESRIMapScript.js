(function(){var esriConfig=null;var mstrmap={};var $ESRI_VERSION="3.14",$DEFAULT_ESRI_API_SERVER="js.arcgis.com/"+$ESRI_VERSION;mstrmojo._CanLoadESRIMapScript=mstrmojo.provide("mstrmojo._CanLoadESRIMapScript",{_mixinName:"mstrmojo._CanLoadESRIMapScript",callback:null,mixinParentMapObj:null,esriAPIServer:null,setEsriConfig:function setEsriConfig(val){esriConfig=val;},getEsriConfig:function getEsriConfig(){return esriConfig;},parseEsriAPIServer:function parseEsriAPIServer(){var useCloud=esriConfig&&!!esriConfig.useESRICloud&&(parseInt(esriConfig.useESRICloud)===1),apiUrl=esriConfig&&esriConfig.jsapiurl;if(!useCloud&&apiUrl){apiUrl=apiUrl.trim();apiUrl=apiUrl.replace(/^.*:\/{2,}/,"");apiUrl=apiUrl.replace(/\/+$/,"");if(apiUrl){this.esriAPIServer="//"+apiUrl;return ;}}this.esriAPIServer="//"+$DEFAULT_ESRI_API_SERVER;},loadExternalScript:function loadScript(callBackFunc,mapObject){this.parseEsriAPIServer();this.callback=callBackFunc;this.mixinParentMapObj=mapObject;var script=document.createElement("script");script.type="text/javascript";var protocol=window.location.protocol;if(mstrApp.isSingleTier){protocol="http:";}script.src=protocol+this.esriAPIServer+"/init.js";document.getElementsByTagName("head")[0].appendChild(script);var that=this;if(script.addEventListener){script.addEventListener("load",function load(){script.removeEventListener("load",load);that.loadMainModule();},false);}else{if(script.readyState){script.onreadystatechange=function(){if(script.readyState==="loaded"||script.readyState==="complete"){script.onreadystatechange=null;that.loadMainModule();}};}}},loadMainModule:function loadMainModule(){window.dojo.require("esri.map");window.dojo.require("esri.tasks.query");window.dojo.require("esri.arcgis.utils");var protocol=window.location.protocol;if(mstrApp.isSingleTier){protocol="http:";}var esriCssUrl=protocol+this.esriAPIServer+"/esri/css/esri.css";this.loadCss("esricss",esriCssUrl);var claroUrl=protocol+this.esriAPIServer+"/dijit/themes/claro/claro.css";this.loadCss("esriClaro",claroUrl);var me=this;this.loadMapVisCss();window.dojo.addOnLoad(function(){var intervalId=window.setInterval(function(){if(me.isMapVisCssLoaded()){window.clearInterval(intervalId);me.loadMap();}},50);});},loadMap:function loadMap(){var i,j,finishedCallbacks=[],finishedCallback,listener,found,config=this.getEsriConfig(),listenerCount=mstrmojo.esrimap.loadScriptListeners.length;this.callback.call(this.mixinParentMapObj,config);finishedCallbacks.push({caller:this.mixinParentMapObj,method:this.callback});for(i=0;i<listenerCount;i++){listener=mstrmojo.esrimap.loadScriptListeners[i];found=false;for(j=0;j<finishedCallbacks.length;j++){finishedCallback=finishedCallbacks[j];if(listener.caller===finishedCallback.caller&&listener.method===finishedCallback.method){found=true;break;}}if(!found){listener.method.call(listener.caller,listener.params);finishedCallbacks.push({caller:listener.caller,method:listener.method});}}},loadCss:function loadCss(ElementId,hrefLink){var currentStyles=document.styleSheets;if(currentStyles){var i,style;for(i=0;i<currentStyles.length;i++){style=currentStyles[i];if(style.id===ElementId){return ;}}}var css=document.createElement("link");css.setAttribute("rel","stylesheet");css.setAttribute("type","text/css");css.setAttribute("href",hrefLink);css.setAttribute("id",ElementId);document.getElementsByTagName("head")[0].appendChild(css);},isOIVM:function isOIVM(){return(mstrApp&&mstrApp.isExpress);},isMapVisCssLoaded:function isMapVisCssLoaded(){var currentStyles=document.styleSheets;if(currentStyles){var i,style;for(i=0;i<currentStyles.length;i++){style=currentStyles[i];if((style.id==="googleMapVis")||(!!style.ownerNode&&style.ownerNode.id==="googleMapVis")){return true;}}}return false;},loadMapVisCss:function loadMapVisCss(){if(this.isMapVisCssLoaded()){return ;}var css=document.createElement("link");css.setAttribute("rel","stylesheet");css.setAttribute("type","text/css");css.setAttribute("href",mstrmojo.getStyleRoot()+"/mstr/googleMap.css");css.setAttribute("id","googleMapVis");document.getElementsByTagName("head")[0].appendChild(css);}});}());