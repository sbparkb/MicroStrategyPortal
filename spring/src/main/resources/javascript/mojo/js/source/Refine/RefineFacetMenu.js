(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(12346,12355,12356,1905,14543,10380,14544);var constants=mstrmojo.Refine.RefineConstants;var diConstants=mstrmojo.DI.DIConstants;var menuItems=constants.menuItems;var $A=mstrmojo.array;mstrmojo.Refine.RefineFacetMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineFacetMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(12346,"Cluster and Edit"),did:menuItems.REFINE_CLUSTER},{type:"list",did:menuItems.SEPARATOR},{n:mstrmojo.desc(12355,"Sort by Name"),did:menuItems.REFINE_SORT_NAME},{n:mstrmojo.desc(12356,"Sort by Count"),did:menuItems.REFINE_SORT_COUNT},{type:"list",did:menuItems.SEPARATOR},{n:mstrmojo.desc(1905,"Reset"),did:menuItems.REFINE_RESET},{n:mstrmojo.desc(14543,"Reset ALL Selector"),did:menuItems.REFINE_RESET_ALL},{did:menuItems.SEPARATOR},{n:mstrmojo.desc(13039,"Delete"),did:menuItems.REFINE_DELETE},{n:mstrmojo.desc(14544,"Delete ALL Selector"),did:menuItems.REFINE_DELETE_ALL},{did:menuItems.SEPARATOR},{n:mstrmojo.desc(null,"Delete Row Included In Selectors"),did:menuItems.REFINE_DELETE_ROWS_IN_THE_VIEW},{n:mstrmojo.desc(null,"Delete Row Not-included In Selectors"),did:menuItems.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW}],queryEnabled:function queryEnabled(item){var enable=true;var controller=this.target.parent.parent.parent.parent.controller;switch(item.did){case menuItems.REFINE_DELETE_ROWS_IN_THE_VIEW:case menuItems.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:var facetPanel=controller.refinePanel.bottomPanal.splitter.facetPanel;enable=facetPanel.hasSelection();break;default:enable=true;break;}return enable;},queryVisible:function queryVisible(item){var visible=true;switch(item.did){case menuItems.REFINE_CLUSTER:case menuItems.REFINE_SORT_NAME:case menuItems.REFINE_SORT_COUNT:visible=(this.target.type==="list");break;case menuItems.SEPARATOR:if(item.type==="list"){visible=(this.target.type==="list");}break;default:visible=true;break;}return visible;},queryChecked:function queryChecked(item){var checked=false;switch(item.did){case menuItems.REFINE_SORT_NAME:checked=(this.target.options.sort==="name");break;case menuItems.REFINE_SORT_COUNT:checked=(this.target.options.sort!=="name");break;}return checked;},executeCommand:function(item){var panel,operation,facetPanel,operations=[],requirement;var controller=this.target.parent.parent.parent.parent.controller;switch(item.did){case menuItems.REFINE_CLUSTER:var diController=mstrApp.getRootController();var dialog=diController.showDialog(diConstants.dialogType.refineClusteringPage,{columnName:this.target.config.name,controller:controller});controller.model.attachEventListener("clustersFetched",dialog.id,dialog.handleClustersFetched);break;case menuItems.REFINE_SORT_NAME:this.target.sortByName();break;case menuItems.REFINE_SORT_COUNT:this.target.sortByCount();break;case menuItems.REFINE_RESET:panel=this.target.parent;this.target.reset();panel.updateEngine(true);break;case menuItems.REFINE_RESET_ALL:panel=this.target.parent;panel.resetAllFacets();panel.updateEngine(true);break;case menuItems.REFINE_DELETE_ALL:panel=this.target.parent;panel.removeAllFacets();panel.updateEngine(true);break;case menuItems.REFINE_DELETE:this.target.remove();break;case menuItems.REFINE_DELETE_ROWS_IN_THE_VIEW:operation=JSON.parse(JSON.stringify(controller.model.transformations.Delete.DeleteRowsInTheView));facetPanel=controller.refinePanel.bottomPanal.splitter.facetPanel;operation.engineConfig=facetPanel.getJSON();requirement=facetPanel.getRequirementDiscription();operation.description=operation.description.replace("[Requirement]",requirement);operations.push(operation);facetPanel.resetAllFacets();controller.applyOperations({operations:JSON.stringify(operations),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case menuItems.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:operation=JSON.parse(JSON.stringify(controller.model.transformations.Delete.DeleteRowsNotInTheView));facetPanel=controller.refinePanel.bottomPanal.splitter.facetPanel;operation.engineConfig=facetPanel.getJSON();requirement=facetPanel.getRequirementDiscription();operation.description=operation.description.replace("[Requirement]",requirement);operations.push(operation);facetPanel.resetAllFacets();controller.applyOperations({operations:JSON.stringify(operations),engine:JSON.stringify({facets:[],mode:"row-based"})});break;default:return false;}return true;},getMenuConfig:function getMenuConfig(menuItems){var menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-refine-menu"}),id=this.id,isSeparator,lastIsSeparator=false,allAvailableMenuItems=menuItems||this.cm;$A.forEach(allAvailableMenuItems,function(menuItem){isSeparator=(menuItem.did===constants.menuItems.SEPARATOR);if(this.queryVisible(menuItem)){var cssClasses=[menuItem.icn||""],execFn=function execFn(){this.executeCommand(menuItem);};if(this.queryEnabled(menuItem)===false||isSeparator){if((isSeparator&&!lastIsSeparator)||!isSeparator){cssClasses.push(isSeparator?"separator":"");menuCfg.addDisabledMenuItem(menuItem.n,cssClasses.join(" "));}if(isSeparator){lastIsSeparator=true;}}else{if(menuItem.items){menuCfg.addSubMenuItem(menuItem.n,"",id,menuItem.buildSubMenuConfig||this.getMenuConfig,menuItem.items);lastIsSeparator=false;}else{if(menuItem.hasEdt){menuCfg.addEditorMenuItem(menuItem.n,id,menuItem.buildSubMenuConfig);lastIsSeparator=false;}else{menuCfg.addToggleMenuItem(menuItem.n||"",cssClasses.join(" "),execFn,execFn,id,this.queryChecked(menuItem));lastIsSeparator=false;}}}}},this);return menuCfg;}});}());