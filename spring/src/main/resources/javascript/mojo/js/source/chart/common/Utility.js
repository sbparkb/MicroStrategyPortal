(function(){mstrmojo.requiresCls("mstrmojo.locales");mstrmojo.requiresCls("mstrmojo.chart.enums.EnumFontStyle");mstrmojo.requiresCls("mstrmojo.VisUtility");mstrmojo.requiresClsP("mstrmojo.chart.common","DSSDateTime","ScalePlate");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphProperty","EnumDSSGraphDataTextShowType","EnumDSSGraphObject");var $C=mstrmojo.chart,$M=$C.model,$VisUtility=mstrmojo.VisUtility,$CHART_ENUMS=$C.enums,$FS=$CHART_ENUMS.EnumFontStyle,$MODEL_ENUMS=$M.enums,$GP=$MODEL_ENUMS.EnumDSSGraphProperty,$DTST=$MODEL_ENUMS.EnumDSSGraphDataTextShowType,$GO=$MODEL_ENUMS.EnumDSSGraphObject;var DLType=mstrmojo.gm.EnumDataLabels;var fontRelatedProperties=[["xAxLbFntClr","yAxLbFntClr","dlFntClr","lgdFntClr"],["xAxLbFntFml","yAxLbFntFml","dlFntFml","lgdFntFml"],["xAxLbFntSz","yAxLbFntSz","dlFntSz","lgdFntSz"],["xAxLbFntStyle","yAxLbFntStyle","dlFntStyle","lgdFntFml"]];var lineRelatedProperties=[["majorGridLnThk","minerGridLnThk","majorGridLnThk","minerGridLnThk"],["majorGridLnClr","minerGridLnClr","majorGridLnClr","minerGridLnClr"],["majorGridLnStyle","minerGridLnStyle","majorGridLnStyle","minerGridLnStyle"]];var fillRelatedProperties=[["bgFillClr"],["bgFillStyle"],["bgFillTrans"]];function getFontPropertyOffset(aid){switch(aid){case $GP.DssGraphFontColor:return 0;case $GP.DssGraphFontName:return 1;case $GP.DssGraphFontSize:return 2;case $GP.DssGraphFontStyle:return 3;case $GP.DssGraphFontSize100:return 4;default:return -1;}}function getFillPropertyOffset(aid){switch(aid){case $GP.DssGraphAreaColor:return 0;case $GP.DssGraphFillEffect:return 1;case $GP.DssGraphAreaAlpha:return 2;}return -1;}function hIsAxisObject(obejctId){var key;switch(obejctId){case $GO.DssGraphX1Body:case $GO.DssGraphX1Label:case $GO.DssGraphX1Major:case $GO.DssGraphX1Minor:case $GO.DssGraphUserLabel3:case $GO.DssGraphUserLine3:key="X1";break;case $GO.DssGraphX2Body:case $GO.DssGraphX2Label:case $GO.DssGraphX2Major:case $GO.DssGraphX2Minor:case $GO.DssGraphUserLabel4:case $GO.DssGraphUserLine4:key="X2";break;case $GO.DssGraphY1Body:case $GO.DssGraphY1Label:case $GO.DssGraphY1Major:case $GO.DssGraphY1Minor:case $GO.DssGraphUserLabel1:case $GO.DssGraphUserLine1:key="Y1";break;case $GO.DssGraphY2Body:case $GO.DssGraphY2Label:case $GO.DssGraphY2Major:case $GO.DssGraphY2Minor:case $GO.DssGraphUserLabel2:case $GO.DssGraphUserLine2:key="Y2";break;case $GO.DssGraphZBody:key="Z";break;case $GO.DssGraphO1Body:case $GO.DssGraph2DO1Label:case $GO.DssGraphO1Major:case $GO.DssGraphO1Minor:key="O1";break;case $GO.DssGraphO2Body:case $GO.DssGraph2DO2Label:case $GO.DssGraphO2Major:case $GO.DssGraphO2Minor:key="O2";break;default:key="No_Axis";break;}return key;}function transformGMProperty(oneProperty,helperContext){if(!!oneProperty===false){return undefined;}return undefined;}function transformOOTBProperty(oneProperty,helperContext){if(!!oneProperty===false){return undefined;}var key,index,isVerticalChart=helperContext.isVertical!==undefined?helperContext.isVertical:true,isGridChart=helperContext.isGridChart||false,isPieShape=helperContext.isPieShape||false,retProperty={Name:0,Value:0},aid=oneProperty.gaid,oid=oneProperty.goid,sid=oneProperty.gsid,value=oneProperty.v;if(!!aid===false){return undefined;}switch(aid){case $GP.DssGraphShowLBLFeeler:if(isPieShape){retProperty.Name="DataLabel";if((value&$DTST.DssGraphDataTextValue)!==0){retProperty.Value=DLType.SHOW_VALUE_ONLY;}else{if((value&$DTST.DssGraphDataTextLabel)!==0){retProperty.Value=DLType.SHOW_TEXT_ONLY;}else{retProperty.Value=DLType.HIDE;}}}break;case $GP.DssGraphAreaColor:case $GP.DssGraphFillEffect:case $GP.DssGraphAreaAlpha:index=getFillPropertyOffset.call(this,aid);if(index<0){return undefined;}if(oid===$GO.DssGraphBackground){retProperty.Name=fillRelatedProperties[index][0];if(retProperty.Name.search("Trans")!==-1){retProperty.Value=value/255*100;}else{retProperty.Value=value;}}break;case $GP.DssGraphShowLegendText:retProperty.Name="LegendVisibleness";retProperty.Value=value===0?false:true;break;case $GP.DssGraphSDShowDataText:retProperty.Name="ShowSeriesDataLabel";retProperty.Value=value!==0;break;case $GP.DssGraphShowDataText:if(isPieShape===false){retProperty.Name="DataLabel";retProperty.Value=DLType.HIDE;if(value&$DTST.DssGraphDataTextValue){retProperty.Value=DLType.SHOW_VALUE_ONLY;}else{if(value&$DTST.DssGraphDataTextLabel){retProperty.Value=DLType.SHOW_TEXT_ONLY;}}}break;case $GP.DssGraphFontColor:case $GP.DssGraphFontName:case $GP.DssGraphFontSize100:case $GP.DssGraphFontSize:case $GP.DssGraphFontStyle:retProperty.Value=value;key=hIsAxisObject.call(this,oid);index=getFontPropertyOffset.call(this,aid);if(index<0){return undefined;}if(index===4){index=3;retProperty.Value/=100;}if(key==="No_Axis"){if(oid===$GO.DssGraphDataText){if(isPieShape){return undefined;}retProperty.Name=fontRelatedProperties[index][2];}else{if(oid===$GO.DssGraphPieFeelerLabel||oid===$GO.DssGraphPieFeelerLabel){if(isPieShape===false){return undefined;}retProperty.Name=fontRelatedProperties[index][2];}else{if(oid===$GO.DssGraphLegendText){retProperty.Name=fontRelatedProperties[index][3];}else{return undefined;}}}}else{if(key[0]==="X"){retProperty.Name=fontRelatedProperties[index][0];}else{if(key[0]==="Y"){retProperty.Name=fontRelatedProperties[index][1];}else{if(key[0]==="O"){retProperty.Name=isVerticalChart?fontRelatedProperties[index][0]:fontRelatedProperties[index][1];}else{return undefined;}}}}break;}return retProperty;}var $HEX_TABLE,$SFCC=String.fromCharCode,DT=mstrmojo.locales.datetime,kEmptyBlocks=0,$TEXT_NODE=document.getElementById("measureText"),$TEXT_CACHE={},$TEXT_HEIGHT_CACHE={};var kWidthEdgeMarginRatio=0.03,kHeightEdgeMarginRatio=0,kTextLineSpaceRatio=0,kDoubleLineMarginRatio=0.2;function hCreateHEXTable(iSize){var i,table=[],value;for(i=0;i<=iSize;i++){value=i.toString(16);if(value.length===1){value="0"+value;}table[i]=value;}$HEX_TABLE=table;return table;}function ToDouble(input){var number=parseFloat(input);if(isNaN(number)===false&&number!==undefined&&number!==null){return number;}return 0;}function hConvertMSTRDateFormatString(formatString){formatString=formatString.replace(/ddd/g,"EEE");formatString=formatString.replace(/AM\/PM/g,"a");formatString=formatString.replace(/tt/g,"a");formatString=formatString.replace(/:'/g,":");formatString=formatString.replace(/'\/'/g,"/");formatString=formatString.replace(/\\/g,"");var i,process=true,length=formatString.length;for(i=0;i<length;i++){if(formatString[i]==="h"||formatString[i]==="H"||formatString[i]===":"){process=true;}else{if(formatString[i]===" "&&process){process=true;}}if(formatString[i]==="m"&&process){formatString=formatString.substring(0,i)+"M"+formatString.substring(i+1);}}return formatString;}mstrmojo.chart.common.Utility=mstrmojo.provide("mstrmojo.chart.common.Utility",{point2D:{},rect2D:{},tripleId:{create:function create(objectId,seriesId,groupId,angleId,sliceId){if(objectId===null||objectId===undefined){objectId=-3;}if(seriesId===null||seriesId===undefined){seriesId=-3;}if(groupId===null||groupId===undefined){groupId=-3;}var result={mObjectId:objectId,mSeriesId:seriesId,mGroupId:groupId};if(angleId!==undefined&&angleId!==null){result.angleByIndex=angleId;}if(sliceId!==undefined&&sliceId!==null){result.sliceById=sliceId;}return result;},walks:function walks(keyPaths,context){if(!!keyPaths===false||!!context===false){return null;}if(keyPaths.length===1){return context[keyPaths[0]];}var length=(keyPaths&&keyPaths.length)||0,i,key=keyPaths[i];for(i=0;i<length;i++){if(context[key]===undefined){context[key]={};}context=context[key];}return context;},equal:function equal(A,B){return(A.mObjectId===B.mObjectId&&A.mSeriesId===B.mSeriesId&&A.mGroupId===B.mGroupId);},reset:function reset(dest,sourceObjectId,sourceSeriesId,sourceGroupId,angleId,sliceId){dest.mObjectId=sourceObjectId!==undefined?sourceObjectId:-3;dest.mSeriesId=sourceSeriesId!==undefined?sourceSeriesId:-3;dest.mGroupId=sourceGroupId!==undefined?sourceGroupId:-3;if(angleId!==undefined&&angleId!==null){dest.angleByIndex=angleId;}if(sliceId!==undefined&&sliceId!==null){dest.sliceById=sliceId;}return dest;}},transformProperty:function transformProperty(oneProperty,transformType,helperContext){if(transformType===0){return transformOOTBProperty.call(this,oneProperty,helperContext);}return transformGMProperty.call(this,oneProperty,helperContext);},abbreviateNumber:function abbreviateNumber(thisNumber,maxLength){var text,dotIndex,suffix="",isNeg=(thisNumber<0),hasFraction=(this.isIntegar(thisNumber)===false);if(hasFraction){maxLength++;}if(thisNumber<0){maxLength++;}var number=isNeg?-thisNumber:thisNumber;var checkEmptyBlock=0;if(number>=1e+27){number=999;suffix="Y";}else{if(number>=1e+24){number/=1e+24;suffix="Y";}else{if(number>=1e+21){number/=1e+21;suffix="Z";}else{if(number>=1000000000000000000){number/=1000000000000000000;suffix="E";}else{if(number>=1000000000000000){number/=1000000000000000;suffix="P";}else{if(number>=1000000000000){number/=1000000000000;suffix="T";}else{if(number>=1000000000){number/=1000000000;suffix="B";}else{if(number>=1000000){number/=1000000;suffix="M";}else{if(number>=1000){number/=1000;suffix="K";}else{if(number>=1){checkEmptyBlock++;}else{if(number>=0.001){checkEmptyBlock++;}else{if(number>=0.000001){checkEmptyBlock++;}else{if(number>=1e-9){checkEmptyBlock++;}else{if(number>=1e-12){checkEmptyBlock++;}else{isNeg=false;}}}}}}}}}}}}}}if(this.isIntegar(number)===false){text=number.toString();var allowedFractionLength=5,fixedFractionLength=2,fLen;dotIndex=text.indexOf(".");fLen=text.length-dotIndex-1;if(fLen>allowedFractionLength||(fLen>fixedFractionLength&&fLen>dotIndex)){if(fLen>allowedFractionLength&&maxLength-fLen<0){fixedFractionLength=Math.max(fixedFractionLength,Math.min(fixedFractionLength,maxLength-fLen));}else{fixedFractionLength=Math.max(1,Math.min(fixedFractionLength,maxLength-fLen));}number=number.toFixed(fixedFractionLength);}}text=number.toString();if(this.isIntegar(number)===false){var lastIndex=text.length-1;dotIndex=text.indexOf(".");if(dotIndex!==-1){if(dotIndex>=lastIndex){text=text.substring(0,dotIndex);}else{var i,allZero=true;for(i=lastIndex;i>dotIndex&&allZero;--i){if(text[i]!=="0"){allZero=false;}}if(allZero){text=text.substring(0,dotIndex);}}}}if(isNeg){text="-"+text;}text+=suffix;return text;},getScalePlate:function getScalePlate(reset){reset=reset||false;this.mScalePlate=mstrmojo.chart.common.ScalePlate;if(reset){this.mScalePlate.clear();}return this.mScalePlate;},prepareScalePlateOptions:function prepareScalePlateOptions(useLog,hasBarAreaShpae,chartLayout){var options={mUseLogarithmicScale:useLog,mAlwaysIncludeZero:!useLog&&(hasBarAreaShpae||!!(chartLayout&1)||!!(chartLayout&2)),mShowMinLabel:true,mShowMaxLabel:true,mDrawCustomLine:false,mAxisMinValue:0,mAxisMaxValue:0,mAxisCustomValue:0,mUseCustomMinMax:false};return options;},evaluateTextMargin:function evaluateTextMargin(fontSize){this.mTextMargins=this.mTextMargins||{};var margins=this.mTextMargins;if(margins[fontSize]){return margins[fontSize];}var array=[];array[0]=Math.floor(fontSize*kWidthEdgeMarginRatio+0.5);array[1]=Math.floor(fontSize*kHeightEdgeMarginRatio+0.5);array[2]=Math.max(Math.floor(fontSize*kTextLineSpaceRatio+0.5),1);margins[fontSize]=array;return array;},AlmostZero:function AlmostZero(value){return(Math.abs(value)<0.000001);},isValidNumber:function isValidNumer(a){if(typeof a==="number"){if(a===0){return true;}return !!a;}return false;},isIntegar:function isIntegar(n){return n===+n&&n===(n|0);},HasArrayIntersection:function HasArrayIntersection(a,b){var i;for(i=0;i<a.length;i++){if(b.indexOf(a[i])!==-1){return true;}}return false;},EscapeString:function EscapeString(origString){var slashWithQuote='"',escapedSlashWithQuote='\\"',regExpSlashWithQuote=new RegExp(slashWithQuote,"g");return String(origString).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\/g,"\\\\").replace(regExpSlashWithQuote,escapedSlashWithQuote).replace(/\r\n/g,"<br/>").replace(/\r/g,"<br/>").replace(/\n/g,"<br/>");},EscapeStringForJSON:function EscapeStringForJSON(origString){var slashWithQuote='"',escapedSlashWithQuote='\\"',regExpSlashWithQuote=new RegExp(slashWithQuote,"g");return String(origString).replace(/\\/g,"\\\\").replace(regExpSlashWithQuote,escapedSlashWithQuote).replace(/\r/g,"\\r").replace(/\n/g,"\\n");},TrimLastComma:function TrimLastComma(stringStream){var streamLength;if(!stringStream.buf||stringStream.len===-1){return ;}streamLength=stringStream.len;var lastString=String(stringStream.buf[streamLength]);if(lastString&&lastString[lastString.length-1]===","){stringStream.buf[streamLength]=lastString.slice(0,-1);}},decodeUTF8:function decodeUTF8(utftext){var string="",i=0,c=0,c1=0,c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=$SFCC(c);i++;}else{if((c>191)&&(c<224)){c1=utftext.charCodeAt(i+1);string+=$SFCC(((c&31)<<6)|(c1&63));i+=2;}else{c1=utftext.charCodeAt(i+1);c2=utftext.charCodeAt(i+2);string+=$SFCC(((c&15)<<12)|((c1&63)<<6)|(c2&63));i+=3;}}}return string;},formatDateTimeValue:function formatDateTimeValue(istrFormat,idblValue){var aeDateTime=new mstrmojo.chart.common.DSSDateTime({ifTime:idblValue});var oss="";var lstrColor="";var cur=0;while(cur<istrFormat.length){var count=1;switch(istrFormat.charAt(cur)){case"[":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)!=="]"){lstrColor+=istrFormat.charAt(cur);cur++;}if(lstrColor.length>0&&(lstrColor[0]===">"||lstrColor[0]==="<"||lstrColor[0]==="=")){lstrColor="";}cur++;break;case"y":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)==="y"){count++;cur++;if(count===4){break;}}if(count===1||count===2){oss+=this.fillZeroToWidth(aeDateTime.mnYear%100,2);}else{if(count===3){oss+=this.fillZeroToWidth(aeDateTime.mnYear%100,2);cur--;}else{if(count===4){oss+=aeDateTime.mnYear;}}}break;case"M":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)==="M"){count++;cur++;}if(count<3){oss+=this.fillZeroToWidth(aeDateTime.mnMonth,count);}else{if(count===3){oss+=DT.MONTHNAME_SHORT[aeDateTime.mnMonth];}else{oss+=DT.MONTHNAME_FULL[aeDateTime.mnMonth];}}break;case"d":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)==="d"){count++;cur++;}if(count<3){oss+=this.fillZeroToWidth(aeDateTime.mnDay,count);}else{if(count===3){oss+=DT.dayShortNames[aeDateTime.mnDay];}else{oss+=DT.dayNames[aeDateTime.mnDay];}}break;case"h":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)==="h"){count++;cur++;}var lHour=aeDateTime.mnHour;if(lHour===0){lHour=12;}if(lHour>12){lHour-=12;}oss+=this.fillZeroToWidth(lHour,count);break;case"H":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)==="H"){count++;cur++;}oss+=this.fillZeroToWidth(aeDateTime.mnHour,count);break;case"m":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)==="m"){count++;cur++;}oss+=this.fillZeroToWidth(aeDateTime.mnMinute,count);break;case"s":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)==="s"){count++;cur++;}oss+=this.fillZeroToWidth(aeDateTime.mnSecond,count);break;case"S":cur++;while(cur<istrFormat.length&&istrFormat.charAt(cur)==="S"){count++;cur++;}oss+=this.fillZeroToWidth(aeDateTime.mnMillisecond,count);break;case"a":lHour=aeDateTime.mnHour;if(lHour<12){oss+=DT.AM_NAME;}else{oss+=DT.PM_NAME;}cur++;break;default:oss+=istrFormat.charAt(cur++);break;}}if(lstrColor.length!==0){oss='<SPAN STYLE="COLOR: '+lstrColor+'" >'+oss+"</SPAN>";}return oss;},fillZeroToWidth:function fillZeroToWidth(iValue,iWidth){var empty="",str=empty+iValue;var len=str.length;while(len<iWidth){str="0"+str;len++;}return str;},updateCache:function updateCache(cache,keys,value){var length=(keys&&keys.length)||0,i,k,c=cache;for(i=0;i<length-1;i++){k=keys[i];if(!c[k]){c[k]={};}c=c[k];}c[keys[length-1]]=value;},measureTextHeight:function(ipString,ipFontName,iFontSize,iFontStyle,metric){var height,string=ipString;if(string===" "){string="\u00A0";}metric=metric||"pt";if(typeof iFontSize==="number"){iFontSize=iFontSize+metric;}var fontStyle="none",fontWeight="normal";if(iFontStyle&$FS.FS_ITALIC){fontStyle="italic";}if(iFontStyle&$FS.FS_BOLD){fontWeight="bold";}var fs={fontFamily:ipFontName,fontSize:iFontSize,fontStyle:fontStyle,fontWeight:fontWeight};if($TEXT_HEIGHT_CACHE&&$TEXT_HEIGHT_CACHE.H&&$TEXT_HEIGHT_CACHE.H[ipFontName]&&$TEXT_HEIGHT_CACHE.H[ipFontName][iFontSize]&&$TEXT_HEIGHT_CACHE.H[ipFontName][iFontSize][iFontStyle]){height=$TEXT_HEIGHT_CACHE.H[ipFontName][iFontSize][iFontStyle];}else{height=$VisUtility.measureTextHeight("H",fs,1);this.updateCache($TEXT_HEIGHT_CACHE,["H",ipFontName,iFontSize,iFontStyle],height);}return height;},measureText:function measureText(ipString,ipFontName,iFontSize,iFontStyle,metric){var useWidgetMearure=true,width,height=iFontSize+1;var string=ipString;if(string===" "){string="\u00A0";}metric=metric||"pt";if(typeof iFontSize==="number"){iFontSize=iFontSize+metric;}if($TEXT_CACHE&&$TEXT_CACHE[string]&&$TEXT_CACHE[string][ipFontName]&&$TEXT_CACHE[string][ipFontName][iFontSize]&&$TEXT_CACHE[string][ipFontName][iFontSize][iFontStyle]){return $TEXT_CACHE[string][ipFontName][iFontSize][iFontStyle];}if(useWidgetMearure){var fontStyle="normal",fontWeight="normal";if(iFontStyle&$FS.FS_ITALIC){fontStyle="italic";}if(iFontStyle&$FS.FS_BOLD){fontWeight="bold";}var fs={fontFamily:ipFontName,fontSize:iFontSize,fontStyle:fontStyle,fontWeight:fontWeight};if($TEXT_HEIGHT_CACHE&&$TEXT_HEIGHT_CACHE.H&&$TEXT_HEIGHT_CACHE.H[ipFontName]&&$TEXT_HEIGHT_CACHE.H[ipFontName][iFontSize]&&$TEXT_HEIGHT_CACHE.H[ipFontName][iFontSize][iFontStyle]){height=$TEXT_HEIGHT_CACHE.H[ipFontName][iFontSize][iFontStyle];}else{height=$VisUtility.measureTextHeight("H",fs,true);this.updateCache($TEXT_HEIGHT_CACHE,["H",ipFontName,iFontSize,iFontStyle],height);}width=$VisUtility.measureTextWidth(ipString,fs,0);}else{if(!$TEXT_NODE){var divTag=document.createElement("div");divTag.id="measureText";divTag.style.position="absolute";divTag.style.top="0";divTag.style.visibility="hidden";divTag.style.height="auto";divTag.style.width="auto";document.body.appendChild(divTag);$TEXT_NODE=divTag;}$TEXT_NODE.innerHTML="";$TEXT_NODE.appendChild(document.createTextNode(string));$TEXT_NODE.style.fontFamily=ipFontName;$TEXT_NODE.style.fontSize=iFontSize;$TEXT_NODE.style.fontWeight="normal";$TEXT_NODE.style.fontStyle="none";if(iFontStyle&$FS.FS_ITALIC){$TEXT_NODE.style.fontStyle="italic";}if(iFontStyle&$FS.FS_BOLD){$TEXT_NODE.style.fontWeight="bold";}width=$TEXT_NODE.scrollWidth+1;height=$TEXT_NODE.scrollHeight+1;}var result={Width:width,Height:height};this.updateCache($TEXT_CACHE,[string,ipFontName,iFontSize,iFontStyle],result);return result;},ReplaceDecimalPoint:function ReplaceDecimalPoint(iString,istrDecimalPoint){return iString.replace(".",istrDecimalPoint);},ReplaceMinusSign:function ReplaceMinusSign(iString,istrMinusSign){return iString.replace("-",istrMinusSign);},insert:function insert(iOrgString,iStringToInsert,iPos){if(typeof iOrgString==="string"&&typeof iStringToInsert==="string"&&iPos<=iOrgString.length){return iOrgString.substr(0,iPos)+iStringToInsert+iOrgString.substr(iPos);}return iOrgString;},InsertThousandSeparator:function InsertThousandSeparator(iString,istrSeperator,iLocaleInfo){var lDecimalPoint=iLocaleInfo.mstrDecimalPoint;var decimalPlace=iString.indexOf(lDecimalPoint);if(decimalPlace===-1){decimalPlace=iString.length;}var startPos=0;while(startPos<decimalPlace&&!this.chk_val(iString.charAt(startPos))){startPos++;}var lResult=iString;var i;for(i=decimalPlace-3;i>startPos;i-=3){lResult=this.insert(lResult,istrSeperator,i);}return lResult;},chk_val:function chk_val(val){return/^\d+$/.test(val);},hFormatValue:function hFormatValue(istrFormat,idblValue,iCategory,iLocaleInfo){var cur=0;var start=0;var end=istrFormat.length;var lbConditionMet=false;if(!iLocaleInfo){iLocaleInfo={};var locale=window.navigator.userLanguage||window.navigator.language;var lans=locale.split("-");this.mstrLanguageCode=lans[0];this.mstrCountryCode=lans[1]||lans[0];iLocaleInfo.mstrThousandSeparator=mstrmojo.locales.number.THOUSANDSEPARATOR||",";iLocaleInfo.mstrCurrencySymbol="$";iLocaleInfo.mstrDecimalPoint=mstrmojo.locales.number.DECIMALSEPARATOR||".";iLocaleInfo.mstrPercentSign="%";iLocaleInfo.mstrMinusSign="-";}while(cur<end){if(istrFormat.charAt(cur)==='"'){cur++;while(cur<end&&istrFormat.charAt(cur)!=='"'){cur++;}}else{if(istrFormat.charAt(cur)==="["){cur++;var lstrCondition="";while(cur<end&&istrFormat.charAt(cur)!=="]"){lstrCondition+=istrFormat.charAt(cur);cur++;}if(lstrCondition.length>1&&(lstrCondition.charAt(0)===">"||lstrCondition.charAt(0)==="<"||lstrCondition.charAt(0)==="=")){var comp=-1;var numberStart=0;switch(lstrCondition.charAt(0)){case">":if(lstrCondition.charAt(1)>="0"&&lstrCondition.charAt(1)<="9"){comp=1;numberStart=1;}else{if(lstrCondition.charAt(1)==="="&&lstrCondition.length>2&&lstrCondition.charAt(2)>="0"&&lstrCondition.charAt(2)<="9"){comp=2;numberStart=2;}}break;case"=":if(lstrCondition.charAt(1)>="0"&&lstrCondition.charAt(1)<="9"){comp=3;numberStart=1;}else{if(lstrCondition.charAt(1)==="="&&lstrCondition.length>2&&lstrCondition.charAt(2)>="0"&&lstrCondition.charAt(2)<="9"){comp=3;numberStart=2;}}break;case"<":if(lstrCondition.charAt(1)>="0"&&lstrCondition.charAt(1)<="9"){comp=5;numberStart=1;}else{if(lstrCondition.charAt(1)==="="&&lstrCondition.length>2&&lstrCondition.charAt(2)>="0"&&lstrCondition.charAt(2)<="9"){comp=4;numberStart=2;}}break;}if(comp>0){var ss=lstrCondition.substr(numberStart);var ldblValueToCompare=parseFloat(ss);if((comp===1&&idblValue>ldblValueToCompare)||(comp===2&&idblValue>=ldblValueToCompare)||(comp===3&&idblValue===ldblValueToCompare)||(comp===4&&idblValue<=ldblValueToCompare)||(comp===5&&idblValue<ldblValueToCompare)){lbConditionMet=true;}}}}else{if(istrFormat.charAt(cur)===";"){if(lbConditionMet){end=cur;break;}else{start=cur+1;cur++;}}else{cur++;}}}}if(!lbConditionMet){start=0;}cur=start;var lbIsDateTime=false;while(cur<end){if(istrFormat.charAt(cur)==='"'){cur++;while(cur<end&&istrFormat.charAt(cur)!=='"'){cur++;}}else{if(istrFormat.charAt(cur)==="["){cur++;while(cur<end&&istrFormat.charAt(cur)!=="]"){cur++;}}else{if(istrFormat.charAt(cur)==="y"||istrFormat.charAt(cur)==="M"||istrFormat.charAt(cur)==="d"||istrFormat.charAt(cur)==="h"||istrFormat.charAt(cur)==="H"||istrFormat.charAt(cur)==="m"||istrFormat.charAt(cur)==="s"||istrFormat.charAt(cur)==="S"){lbIsDateTime=true;break;}else{cur++;}}}}if(lbIsDateTime){var lstrFormat="";if(lbConditionMet){lstrFormat=istrFormat.substr(start,end-start);}else{lstrFormat=istrFormat;}return mstrmojo.num.formatByMask(lstrFormat,idblValue);}var i;var tempCur;var lbUseThousandSeparator=false;var lbUsePlusSign=false;var lbUseKilo=false;var lbIsZipCode=false;var lvZipCodeLens=[];var lKiloCharacter="K";var lnDecimalPlace=0;var lbNeedIntegerPart=false;var lnFractionPlace=0;var lstrPrefix="";var lstrSuffix="";var lstrColor="";var lstrScientificSeparator="";var lnScientificExpLen=0;var lnCategory=0;var lbLastBit=false;var lCurrencySymbol=iLocaleInfo.mstrCurrencySymbol;var lThousandSeparator=iLocaleInfo.mstrThousandSeparator;var lDecimalPoint=iLocaleInfo.mstrDecimalPoint;var lPercentSign=iLocaleInfo.mstrPercentSign;var lMinusSign=iLocaleInfo.mstrMinusSign;cur=start;var oss="";if(idblValue<0&&!lbConditionMet){while(cur<end&&istrFormat.charAt(cur)!==";"){if(istrFormat.charAt(cur)==='"'){cur++;while(cur<end&&istrFormat.charAt(cur)!=='"'){cur++;}}cur++;}cur++;if(cur>=end){if(idblValue<0){lstrPrefix+="-";}cur=start;}}var lbPrefixEnded=false;while(cur<end){var lbNeedQuit=false;switch(istrFormat.charAt(cur)){case"[":cur++;while(cur<end&&istrFormat.charAt(cur)!=="]"){lstrColor+=istrFormat.charAt(cur);cur++;}if(lstrColor.length>0&&(lstrColor.charAt(0)===">"||lstrColor.charAt(0)==="<"||lstrColor.charAt(0)==="=")){lstrColor="";}cur++;break;case'"':cur++;while(cur<end&&istrFormat.charAt(cur)!=='"'){if(istrFormat.charAt(cur)==="K"){lbUseKilo=true;lKiloCharacter="K";}else{if(lbPrefixEnded){lstrSuffix+=istrFormat.charAt(cur);}else{lstrPrefix+=istrFormat.charAt(cur);}}cur++;}cur++;break;case"#":case"0":var digit=istrFormat.charAt(cur);lbPrefixEnded=true;var len=1;cur++;while(cur<end&&istrFormat.charAt(cur)===digit){len++;cur++;}if(cur+1<end&&istrFormat.charAt(cur)==="-"&&istrFormat.charAt(cur+1)===digit){lbIsZipCode=true;lvZipCodeLens.push(len);cur++;while(true){len=0;while(cur<end&&istrFormat.charAt(cur)===digit){len++;cur++;}lvZipCodeLens.push(len);if(cur>=end||istrFormat.charAt(cur)!=="-"){break;}cur++;}}while(cur<end){if(istrFormat.charAt(cur)===","){if(cur+1<end&&istrFormat.charAt(cur+1)===digit){lbUseThousandSeparator=true;}else{break;}}else{if(istrFormat.charAt(cur)!==digit){break;}}cur++;}break;case".":lbPrefixEnded=true;cur++;lnDecimalPlace=0;while(cur<end&&istrFormat.charAt(cur)==="0"){lnDecimalPlace++;cur++;}if(lnDecimalPlace===0){while(cur<end&&istrFormat.charAt(cur)==="#"){lnDecimalPlace++;cur++;}}break;case"E":lnCategory=6;while(cur<end&&istrFormat.charAt(cur)!=="0"){if(istrFormat.charAt(cur)==="+"&&cur<end&&istrFormat.charAt(cur+1)==="0"){lbUsePlusSign=true;}else{lstrScientificSeparator+=istrFormat.charAt(cur);}cur++;}lnScientificExpLen=0;while(cur<end&&istrFormat.charAt(cur)==="0"){lnScientificExpLen++;cur++;}break;case"%":lnCategory=4;cur++;break;case"(":cur++;lstrPrefix+="(";break;case")":cur++;lstrSuffix+=")";break;case"-":cur++;if(idblValue<0){lstrPrefix+=lMinusSign;}break;case"?":cur++;break;case"/":if(cur>start&&istrFormat.charAt(cur-1)==="?"&&cur+1<end&&istrFormat.charAt(cur+1)==="?"){lnCategory=5;lbNeedIntegerPart=false;tempCur=cur-1;while(tempCur>start&&istrFormat.charAt(tempCur)==="?"){tempCur--;}while(tempCur>start&&istrFormat.charAt(tempCur)===" "){tempCur--;}if(tempCur>=start&&(istrFormat.charAt(tempCur)==="#"||istrFormat.charAt(tempCur)==="0")){lbNeedIntegerPart=true;}lnFractionPlace=0;cur++;while(cur<end&&istrFormat.charAt(cur)==="?"){lnFractionPlace++;cur++;}}else{cur++;}break;case",":if(cur>start&&(istrFormat.charAt(cur-1)==="0"||istrFormat.charAt(cur-1)==="#")){if(cur+1<end&&(istrFormat.charAt(cur+1)==="K"||istrFormat.charAt(cur+1)==="k")){lbUseKilo=true;lKiloCharacter=istrFormat.charAt(cur+1);cur++;}}tempCur=cur+1;while(tempCur<end){if(istrFormat.charAt(tempCur)===","){tempCur++;continue;}else{break;}}if(tempCur===end||istrFormat.charAt(tempCur)==="."){lbLastBit=true;}if(lbLastBit||(!lbLastBit&&cur+1<end&&istrFormat.charAt(cur+1)===",")){while(cur<end&&istrFormat.charAt(cur)===","){idblValue/=1000;cur++;}cur--;}cur++;break;case";":lbNeedQuit=true;break;case"$":if(lbPrefixEnded){lstrSuffix+=lCurrencySymbol;}else{lstrPrefix+=lCurrencySymbol;}cur++;break;default:if(lbPrefixEnded){lstrSuffix+=istrFormat.charAt(cur);}else{lstrPrefix+=istrFormat.charAt(cur);}cur++;}if(lbNeedQuit){break;}}if(idblValue<0){idblValue=-idblValue;}var lstrValue="";if(lbIsZipCode){var lTotalLen=0;for(i=0;i<lvZipCodeLens.length;i++){lTotalLen+=lvZipCodeLens[i];}lstrValue=oss=this.fillZeroToWidth(lTotalLen,idblValue.toFixed());for(i=0;i<lvZipCodeLens.length-1;i++){lTotalLen-=lvZipCodeLens[i];var pos=lstrValue.length-lTotalLen;lstrValue=lstrValue.slice(0,pos)+"-"+lstrValue.slice(pos);}}else{switch(lnCategory){case 0:if(lbUseKilo){idblValue/=1000;}var ldblTemp=idblValue;if(ldblTemp<0){ldblTemp=-ldblTemp;}var lE=0;while(ldblTemp>=10){ldblTemp/=10;lE++;}if(lE>=15){lstrValue=oss=this.fillZeroToWidth((idblValue<0?-idblValue:idblValue),10);var nPos=lstrValue.indexOf(".");if(nPos!==-1){lstrValue=lstrValue.slice(0,nPos)+lstrValue.slice(nPos+1);}lstrValue=lstrValue.substr(0,16);if(lstrValue.charAt(15)>="5"){var lLastPos=14;while(lLastPos>=0&&lstrValue.charAt(lLastPos)==="9"){lstrValue=lstrValue.slice(0,lLastPos)+"0"+lstrValue.slice(lLastPos+1);lLastPos--;}var ctemp=lstrValue.charAt(lLastPos);ctemp++;if(lLastPos>=0){lstrValue=lstrValue.slice(0,lLastPos)+ctemp+lstrValue.slice(lLastPos+1);}else{lstrValue="1"+lstrValue;}}lstrValue=lstrValue.substr(0,15);var k;for(k=lE-14;k>0;k--){lstrValue+="0";}if(idblValue<0){lstrValue=lMinusSign+lstrValue;}}else{oss+=(idblValue+Math.pow(0.1,lnDecimalPlace+6)).toFixed(lnDecimalPlace);lstrValue=oss;lstrValue=this.ReplaceDecimalPoint(lstrValue,lDecimalPoint);if(idblValue<0){lstrValue=this.ReplaceMinusSign(lstrValue,lMinusSign);}}if(lbUseThousandSeparator){lstrValue=this.InsertThousandSeparator(lstrValue,lThousandSeparator,iLocaleInfo);}if(lbUseKilo){lstrValue+=lKiloCharacter;}break;case 5:if(lbUseKilo){idblValue/=1000;}var base=10;for(i=1;i<lnFractionPlace;i++){base*=10;}var lLow={numerator:0,denominator:1};var lHigh={numerator:1,denominator:1};var lMid={numerator:1,denominator:2};var lRet={numerator:0,denominator:1};var lIsPositive=idblValue>=0;var value=Math.abs(idblValue);var lInt=parseInt(value,10);value-=lInt;while(lMid.denominator<base){if(Math.abs(ToDouble.call(lMid)-value)<1e-15){lRet=lMid;break;}if(ToDouble.call(lMid)>value){lHigh=lMid;}else{lLow=lMid;}lMid.denominator=lLow.denominator+lHigh.denominator;lMid.numerator=lLow.numerator+lHigh.numerator;}if(lMid.denominator>=base){if(value-ToDouble.call(lLow)<ToDouble.call(lHigh)-value){lRet=lLow;}else{lRet=lHigh;}}if(lInt>0){lRet.numerator+=lInt*lRet.denominator;}if(lRet.denominator===0){lbNeedIntegerPart=false;}var lHasIntPart=false;var lIncludeZeroNume=false;var lNumerator=lRet.numerator;if(lbNeedIntegerPart){lInt=Math.floor(lRet.numerator/lRet.denominator);lNumerator=lRet.numerator%lRet.denominator;lIncludeZeroNume=lIncludeZeroNume||(lNumerator!==0);if(lInt>0){lHasIntPart=true;oss+=lInt;if(lIncludeZeroNume){oss+=" ";}}}if(!lIncludeZeroNume&&!lHasIntPart&&lNumerator===0){oss+="0";}else{if(!lIncludeZeroNume&&lHasIntPart&&lNumerator===0){kEmptyBlocks++;}else{oss+=lNumerator;oss+="/";oss+=lRet.denominator;}}lstrValue=oss;if(!lIsPositive){lstrValue=lMinusSign+lstrValue;}if(lbUseThousandSeparator){lstrValue=this.InsertThousandSeparator(lstrValue,lThousandSeparator,iLocaleInfo);}if(lbUseKilo){lstrValue+=lKiloCharacter;}break;case 4:idblValue*=100;oss+=(idblValue+Math.pow(0.1,lnDecimalPlace+6)).toFixed(lnDecimalPlace);lstrValue=oss;lstrValue=this.ReplaceDecimalPoint(lstrValue,lDecimalPoint);if(idblValue<0){lstrValue=this.ReplaceMinusSign(lstrValue,lMinusSign);}if(lbUseThousandSeparator){lstrValue=this.InsertThousandSeparator(lstrValue,lThousandSeparator,iLocaleInfo);}lstrValue+=lPercentSign;break;case 6:var ldblTemp1=idblValue;var exp=0;if(ldblTemp1>1){while(ldblTemp1>=10){ldblTemp1/=10;exp++;}}else{if(ldblTemp1!==0){while(ldblTemp1<1){ldblTemp1*=10;exp--;}}}oss+=(ldblTemp1+Math.pow(0.1,lnDecimalPlace+6)).toFixed(lnDecimalPlace);oss+=lstrScientificSeparator;if(lbUsePlusSign&&exp>=0){oss<<"+";}if(exp<0){oss<<"-";exp=-exp;}oss+=this.fillZeroToWidth(exp,lnScientificExpLen);lstrValue=oss;lstrValue=this.ReplaceDecimalPoint(lstrValue,lDecimalPoint);if(idblValue<0){lstrValue=this.ReplaceMinusSign(lstrValue,lMinusSign);}break;}}var lstrFormattedValue=lstrPrefix+lstrValue+lstrSuffix;var useHTMLColorTag=false;if(lstrColor.length!==0&&useHTMLColorTag){lstrFormattedValue='<SPAN STYLE="COLOR: '+lstrColor+'" >'+lstrFormattedValue+"</SPAN>";}return lstrFormattedValue;}});}());