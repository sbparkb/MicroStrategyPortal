(function(){mstrmojo.requiresCls("mstrmojo._IsList","mstrmojo.ListBase","mstrmojo.array","mstrmojo.string","mstrmojo.dom","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.Menu","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.menu.DBConnectionsMenu");mstrmojo.requiresDescs(2901);var $A=mstrmojo.array,$DOM=mstrmojo.dom,$STR=mstrmojo.string,CSS_MENU_CLASS="item-mn",$ENUM_DATA_CHANGE_EVENTS=mstrmojo.warehouse.EnumDataChangeEvents,STR_LOADING=mstrmojo.desc(2901,"Loading..."),DssXmlPrivilegesUseDatabaseInstanceManager=57;function dbRolesRenamed(evt){var newItem=evt.item,currentItems=this.items,index=$A.find(currentItems,"did",newItem.did);currentItems[index]=newItem;this._getItemNode(index).outerHTML=this.itemRenderer.render(newItem,index,this);}function dbRolesDeleted(evt){var newItem=evt.item,currentItems=this.items.concat(),idx=$A.find(currentItems,"did",newItem.did);if(idx>-1){currentItems.splice(idx,1);}this.set("items",currentItems);}mstrmojo.warehouse.ui.DBConnectionsList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.architect.ui.DBConnectionsList",cssClass:"mstrmojo-wh-dbConnectionslist",selectionPolicy:"reselect",useRichTooltip:true,showTooltip:function showTooltip(evt,win){var target=evt.target||$DOM.eventTarget(evt.hWin,evt.e),item=this.getItemFromTarget(target);if(target.className&&(target.className.indexOf("item-n")>-1)){target=target.parentNode;}if(item&&item.n&&(target.scrollWidth>target.clientWidth)){var position=$DOM.position(target);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:$STR.encodeHtmlString(item.n+"",true),top:position.y+position.h+5,left:position.x};this._super(evt,win);}},postBuildRendering:function postBuildRendering(){if($DOM.isChrome){$DOM.attachEvent(this.domNode,"mousedown",function(evt){if(evt.which===2){$DOM.stopPropogation(window,evt);$DOM.preventDefault(window,evt);}});}if(this._super){this._super();}},init:function init(props){this._super(props);var $this=this,evtConfig={},listConfig=evtConfig[this.id]={};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_REQUESTED]=function dbRolesRequested(){var loadingDBRole={n:STR_LOADING,tp:"0",isPrimary:function(){return false;}};$this.set("items",[loadingDBRole]);};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_LOADED]=function dbRolesLoaded(evt){var offset=evt.offset||0;$this.set("items",evt.items);if(offset>0){$this.adjustScrollPosition(offset);}};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_ADD]=function dbRolesAdded(evt){$this.addItems([evt.item]);};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLE_CHANGED]=dbRolesRenamed;listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_RENAME]=dbRolesRenamed;listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_DELETE]=dbRolesDeleted;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},getItemMarkup:function getItemMarkup(item){var isShared=(item.mdDBRole&&item.mdDBRole.shared==="1"?" shared":"");return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-ic'+isShared+'"></span><span class="item-n" >{@n}</span><span class='+CSS_MENU_CLASS+"></span></div>";},getItemProps:function getItemProps(item,idx){var sel=!!this.selectedIndices[idx],name=$STR.encodeHtmlString(item.n),cssClass=mstrApp.rootController.hasPrivilege(DssXmlPrivilegesUseDatabaseInstanceManager)?"":" hide-menu";return{sel:sel,cls:"tp"+item.tp+(item.isPrimary()?" primary":"")+(sel?" selected":"")+cssClass,n:name,idx:idx};},onclick:function onclick(evt){try{var target=evt.target||$DOM.eventTarget(evt.hWin,evt.e),item=$DOM.findAncestorByAttr(target,"idx",true,this.domNode),idx=item&&parseInt(item.value,10),itemInfo=this.items[idx];if(target.className===CSS_MENU_CLASS&&idx!==null&&!isNaN(idx)){var $DB_CONNECTIONS_LIST=mstrmojo.warehouse.ui.DBConnectionsList,menuHelper=$DB_CONNECTIONS_LIST.dbCtxMenu=$DB_CONNECTIONS_LIST.dbCtxMenu||new mstrmojo.warehouse.menu.DBConnectionsMenu();menuHelper.data=itemInfo.data;var cfg=menuHelper.getMenuConfig();cfg.hostId=this.id;cfg.hostElement=target;cfg.isHostedWithin=false;cfg.hostProxyCssClass="item-mn-proxy";cfg.position=$DOM.position(cfg.hostElement,true);this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:cfg}));}else{if(idx!==null){this._super(evt);}}}catch(ex){throw ex;}},onchange:function onSelectionChange(){if(this.selectedItem){mstrApp.getRootController().setSelectedDBRoleID(this.selectedItem);}},adjustScrollPosition:function adjustScrollPosition(offset){var height=this.domNode.clientHeight,scrollHeight=this.domNode.scrollHeight,num=this.items.length;if(num>0&&scrollHeight>height){this.domNode.scrollTop=offset*(scrollHeight/num);}}});}());