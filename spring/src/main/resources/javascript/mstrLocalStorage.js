var mstrLocalStorage=(function(){return{addRecentObjectInfo:function addRecentObjectInfo(recentObjectInfo){var localStorage=window.localStorage;if(!localStorage||!window.JSON||!recentObjectInfo){return ;}var obj=JSON.parse(recentObjectInfo);obj.timestamp=new Date().getTime();var objectId=obj.did;var recentObjectsKey="recentObjects"+mstrConfig.lastMsgKey,recentObjects=localStorage.getItem(recentObjectsKey)||[];if(recentObjects.length===0){recentObjectInfo=JSON.stringify(obj);recentObjects.push(recentObjectInfo);localStorage.setItem(recentObjectsKey,JSON.stringify(recentObjects));}else{var updatedRecentObjects=[];var updateRecentObjects=JSON.parse(recentObjects);for(var i=0;i<updateRecentObjects.length;i++){var ro=JSON.parse(updateRecentObjects[i]);if(ro.did===objectId){if(ro.imgData!==undefined){obj.imgData=ro.imgData;}}else{updatedRecentObjects.push(JSON.stringify(ro));}}recentObjectInfo=JSON.stringify(obj);updatedRecentObjects.unshift(recentObjectInfo);var newLength=updatedRecentObjects.length;if(newLength>10){updatedRecentObjects.splice(-1,(newLength-10));}localStorage.setItem(recentObjectsKey,JSON.stringify(updatedRecentObjects));}},addScreenshot:function(objectInfo,root){if(!mstrConfig.showPreviews){return ;}var recentObjectsKey="recentObjects"+mstrConfig.lastMsgKey;var objectId=JSON.parse(objectInfo).did;var targetNode={};if(typeof root==="string"){targetNode=document.getElementById(root)||document.body;}else{targetNode=root||document.body;}var body=document.body,html=document.documentElement;var height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight),width=Math.max(body.scrollWidth,body.offsetWidth,html.clientWidth,html.scrollHeight,html.offsetWidth);if(height>10000||width>10000||document.getElementsByTagName("g").length>1000){return ;}setTimeout(function(){html2canvas(targetNode,{onrendered:function(canvas){var updatedRecentObjects=[];var dataURL=canvas.toDataURL("image/png");var recentObjects=JSON.parse(window.localStorage.getItem(recentObjectsKey));for(var i=0;i<recentObjects.length;i++){var ro=JSON.parse(recentObjects[i]);if(ro.did===objectId){ro.imgData=dataURL.replace(/^data:image\/(png|jpg);base64,/,"");}updatedRecentObjects.push(JSON.stringify(ro));}window.localStorage.setItem(recentObjectsKey,JSON.stringify(updatedRecentObjects));},background:"#e6e6e6",dontCrop:true,height:300,width:300*width/height});},2000);}};}());