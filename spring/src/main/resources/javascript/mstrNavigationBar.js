mstrNavigationBarScript=true;mstrNavigationBar.prototype=new mstrPanelStack();(function(){var HTMLATTR_NAVBAR_LAYOUT="nbl",NAVBAR_LAYOUT_COMPACT=1,NAVBAR_LAYOUT_CENTERED=2,MAX_BUTTON_SPACING=35,MAX_BUTTON_WIDTH=76,MOVE_DIRECTION_LEFT=-1,MOVE_DIRECTION_RIGHT=1;var NAVBAR_FORMATS={UseAsNavBar:microstrategy.TRUE,showTitleBar:microstrategy.FALSE,BackgroundHighlightColor:16089629,backgroundColor:"#000000"};var BUTTON_FORMATS={locked:microstrategy.TRUE,BackgroundHighlightColor:-1,FontHighlightColor:16777215,color:"#FFFFFF",fontSize:"10pt",fontFamily:"Helvetica",fontWeight:"bold",backgroundColor:"transparent",backgroundStyle:"transparent"};mstrNavigationBar.prototype.buttons=null;mstrNavigationBar.prototype.isNavigationBar=true;mstrNavigationBar.prototype.onload=function(){this.buttons=[];mstrPanelStack.prototype.onload.call(this);this.docViewer=microstrategy.getViewerBone();var panel=this.getCurrentPanel(),elPanel=panel.elem;panel.isNavigationBar=true;panel.isPanelEmpty=function(){return false;};panel.clearContentsMenu();if(elPanel){var elButtons=microstrategy.findChildrenWithAtt(elPanel,"span","scriptclass","mstrButton"),so=microstrategy.styleObj;for(var i=0;i<elButtons.length;i++){var bone=microstrategy.bone(elButtons[i].id);if(bone){this.registerButton(bone);}}this.buttons.sort(function(b1,b2){var el1=b1.elem,el2=b2.elem;return so.getValue(el1,"zIndex")-so.getValue(el2,"zIndex");});}mstr.controllers.EventManager.attachEventListener(this,this,"Add","onAdd");mstr.controllers.EventManager.attachEventListener(this,panel,"ChildAdded","onButtonInserted");mstr.controllers.EventManager.attachEventListener(this,panel,"ChildDeleted","onButtonRemoved");mstr.controllers.EventManager.attachEventListener(this,panel,"PostRemoveChildren","postRemoveButtons");this.docViewer.observer.register(this.id);};mstrNavigationBar.prototype.addButton=function(ac){this.docViewer.commands.exec("addToPanel;106B|"+microstrategy.BUTTON_STYLE_ICON_TOP);};mstrNavigationBar.prototype.onAdd=function(e){var ac=e.ac,update=e.update,item=this.elem,doc=this.docViewer.doc,fo=microstrategy.formatObj;applyFormats(doc,[item],NAVBAR_FORMATS,ac,update);doc.formatItemBorders([item],["borderLeft","borderRight","borderTop","borderBottom"],"none","0pt","#000000",update,ac);};function forEachInHash(obj,f,scope){var scope=scope||(function(){return this;})();for(var key in obj){if(f.call(scope,obj[key],key,obj)===false){break;}}}function applyFormats(doc,items,formats,ac,update){var fo=microstrategy.formatObj;forEachInHash(formats,function(value,propName){var isStyle=fo.isTargetStyleOrAttr(propName)&fo.TARGET_VALUE_STYLE;if(isStyle){doc.formatItems(items,propName,value,update,ac);}else{doc.formatAttribute(items,propName,value,update,fo.getAttrNameFromStyle(propName),ac);}});}mstrNavigationBar.prototype.onButtonInserted=function(e){var item=e.item,ac=e.ac,update=e.update,bone=microstrategy.findBone(item),doc=this.docViewer.doc;applyFormats(doc,[item],BUTTON_FORMATS,ac,update);doc.formatItemBorders([item],["borderLeft","borderRight","borderTop","borderBottom"],"none","0pt","#000000",update,ac);this.registerButton(bone);this.synchronizeSize(ac);};mstrNavigationBar.prototype.onButtonRemoved=function(item){var bone=item&&microstrategy.findBone(item);if(bone){mstr.$A.removeItems(this.buttons,[bone]);}};mstrNavigationBar.prototype.postRemoveButtons=function(ac){this.synchronizeSize(ac);};mstrNavigationBar.prototype.onselectionchange=function(e){this.setToolbarState();};mstrNavigationBar.prototype.synchronizeSize=function(ac){mstrPanelStack.prototype.synchronizeSize.apply(this,arguments);this.updateLayout(ac);};mstrNavigationBar.prototype.updateLayout=function(ac){var el=this.getCurrentPanel().elem;if(!el){return ;}var n=this.buttons.length,w=getObjInnerWidth(el),h=getObjInnerHeight(el);var layout=Number(microstrategy.styleObj.getAttValue(this.elem,HTMLATTR_NAVBAR_LAYOUT))||NAVBAR_LAYOUT_COMPACT,doc=this.docViewer.doc,left=0,spacing=0,buttonTotalWidth=w;if(layout==NAVBAR_LAYOUT_CENTERED){var totalSpace=w-n*MAX_BUTTON_WIDTH;if(totalSpace>=0){var spacing=n>1?Math.min(MAX_BUTTON_SPACING,Math.floor(totalSpace/(n-1))):0;left=Math.max(0,Math.floor((totalSpace-(n-1)*spacing)/2));buttonTotalWidth=n*MAX_BUTTON_WIDTH;}}for(var i=0,x=left;i<n;i++){var item=this.buttons[i].elem,x2=left+Math.floor((i+1)*buttonTotalWidth/n)+i*spacing;doc.formatItems([item],"left",x+"px",false,ac);doc.formatItems([item],"top","0px",false,ac);doc.formatSize([item],"width",x2-x+"px",ac);doc.formatSize([item],"height",h+"px",ac);x=x2+spacing;}};mstrNavigationBar.prototype.registerButton=function(bone){this.buttons.push(bone);};mstrNavigationBar.prototype.onmousedown=function(e){try{e=e||window.event;var src=findTarget(getEventTarget(e),microstrategy.HTMLATTR_CMD_ID);if(!src||src.getAttribute(microstrategy.HTMLATTR_CMD_ID)=="tb"){return ;}if((e.which==3)||(e.button==2)){return false;}if(src.className.indexOf("Disabled")==-1){var cmdid=src.getAttribute(microstrategy.HTMLATTR_CMD_ID);switch(cmdid){case"mbl":case"mbr":this.moveButton((cmdid=="mbl")?MOVE_DIRECTION_LEFT:MOVE_DIRECTION_RIGHT);break;case"ab":this.selectPanelStack();this.addButton();break;}}e.cancelBubble=true;return false;}catch(err){microstrategy.errors.log(err);}};mstrNavigationBar.prototype.moveButton=function(direction){var docViewer=this.docViewer,doc=docViewer.doc,selections=doc.selections,btns=this.buttons,sltIdx=selections.isOnlyOneButtonSelected()?mstr.$A.find(btns,microstrategy.findBone(selections.getSelectedButtons()[0])):-1;if(sltIdx>-1){var ac=[],tgtIdx=sltIdx+direction;if(0<=tgtIdx&&tgtIdx<btns.length){var sltBtnBone=btns[sltIdx],tgtBtnBone=btns[tgtIdx],srcZIndex=microstrategy.styleObj.getValue(sltBtnBone.elem,"zIndex"),targetZIndex=microstrategy.styleObj.getValue(tgtBtnBone.elem,"zIndex");doc.formatItems([sltBtnBone.elem],"zIndex",targetZIndex,false,ac);doc.formatItems([tgtBtnBone.elem],"zIndex",srcZIndex,false,ac);btns[sltIdx]=tgtBtnBone;btns[tgtIdx]=sltBtnBone;this.synchronizeSize(ac);docViewer.updateManager.add(ac);selections.reselect(sltBtnBone.elem.id);this.setToolbarState();}}};mstrNavigationBar.prototype.getTitleAndClassOfFirstToolbar=function(){return{title:microstrategy.descriptors.getDescriptor("5773"),className:"select"};};mstrNavigationBar.prototype.createToolbar=function(){try{mstrRWUnitBoneImpl.prototype.createToolbar.call(this);var tb=this.toolbar,tbMap=this.toolbarMap={select:tb.childNodes[0]};tb.setAttribute(microstrategy.HTMLATTR_CMD_ID,"tb");tb.onmousedown=new Function("e","microstrategy.bone('"+this.id+"').onmousedown(e);");function appendToolbarNode(className,title,cmdid){var node=document.createElement("div");node.className=className;node.setAttribute("title",title);node.setAttribute(microstrategy.HTMLATTR_CMD_ID,cmdid);tb.appendChild(node);tbMap[cmdid]=node;}appendToolbarNode("moveButtonLeft",microstrategy.descriptors.getDescriptor("9887"),"mbl");appendToolbarNode("moveButtonRight",microstrategy.descriptors.getDescriptor("9888"),"mbr");appendToolbarNode("panelInsertMenu",microstrategy.descriptors.getDescriptor("9889"),"ab");this.setToolbarState();}catch(err){microstrategy.errors.log(err);}};mstrNavigationBar.prototype.setToolbarState=function(){try{if(this.toolbar==null){return ;}this.clearToolbarState();var selections=this.docViewer.doc.selections,btns=this.buttons,sltIdx=selections.isOnlyOneButtonSelected()?mstr.$A.find(btns,microstrategy.findBone(selections.getSelectedButtons()[0])):-1,tbMap=this.toolbarMap;function disableTbNode(tbNode){if(tbNode){tbNode.className+="Disabled";}}if(sltIdx>-1){if(sltIdx==0){disableTbNode(tbMap.mbl);}if(sltIdx==btns.length-1){disableTbNode(tbMap.mbr);}}else{disableTbNode(tbMap.mbl);disableTbNode(tbMap.mbr);}}catch(err){microstrategy.errors.log(err);}};})();function mstrNavigationBar(id){mstrPanelStack.call(this,id);}