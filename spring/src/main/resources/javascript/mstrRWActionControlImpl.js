mstrRWActionControlImplScript=true;mstrRWActionControlImpl.prototype=new mstrEditorImpl();mstrRWActionControlImpl.prototype.OKButton=null;mstrRWActionControlImpl.prototype.autowireSelectedItems=[];mstrRWActionControlImpl.prototype.onload=function(){try{this.initEditor();this.OKButton=microstrategy.findChildWithAtt(this.elem,"input","id","ok");this.validateUC(true);this.saveAutowireStatus();this.updateControlsOnDatatypeChange();}catch(err){microstrategy.errors.log(err);}};mstrRWActionControlImpl.prototype.processOK=function(){try{var targetTypeList=getObj(this.targetTypeList);var params=[];var dsParams=[];if(targetTypeList&&targetTypeList.selectedIndex==1){if(this.dsSelectionBox!=null){dsParams=this.getSelectedItemsFormCart(this.dsSelectionBox);}}else{if(this.selectionBox!=null){params=this.getSelectedItemsFormCart(this.selectionBox);}}this.close();microstrategy.unRegisterBone(this.id);var oForm=getObj(this.id+"_form");if(targetTypeList&&targetTypeList.selectedIndex==1){for(var i in dsParams){createHiddenInput(oForm,"ctlDatasetTargetID",dsParams[i]);}}else{for(var i in params){createHiddenInput(oForm,"ctlTarget",params[i]);}}if(oForm!=null){submitForm(oForm);}}catch(err){microstrategy.errors.log(err);return false;}};mstrRWActionControlImpl.prototype.showMessage=function(){showMessage({contents:microstrategy.descriptors.getDescriptor(6154),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,zIndex:1001,okEval:"microstrategy.bone('"+this.id+"').disableAutowire()",type:mstrMsgBoxImpl.MSG_WARNING});};mstrRWActionControlImpl.prototype.saveAutowireStatus=function(){var bone=microstrategy.getViewerBone();var autowire=bone.commands.queryState("Autowire");if(!autowire||this.selectionBox==null){return ;}this.autowireSelectedItems=this.getSelectedItemsFormCart(this.selectionBox);};mstrRWActionControlImpl.prototype.restoreAutowireStatus=function(){var bone=microstrategy.getViewerBone();var autowire=bone.commands.queryState("Autowire");if(!autowire||this.selectionBox==null||this.availableBox==null){return ;}var selectionBoxObj=getObj(this.selectionBox);var avaliableBoxObj=getObj(this.availableBox);if(selectionBoxObj&&avaliableBoxObj){RemoveAllItemsToList(avaliableBoxObj,selectionBoxObj);if(!this.isCartBoxEmpty(avaliableBoxObj)&&this.autowireSelectedItems.length>0){var i,j;for(i=0;i<avaliableBoxObj.options.length;i++){avaliableBoxObj.options[i].selected=false;for(j in this.autowireSelectedItems){if(avaliableBoxObj.options[i]!=null&&avaliableBoxObj.options[i].value!="-none-"&&this.autowireSelectedItems[j]==avaliableBoxObj.options[i].value){avaliableBoxObj.options[i].selected=true;}}}AddItemsToList(avaliableBoxObj,selectionBoxObj);UncheckSelectionsOnList(selectionBoxObj);}}};mstrRWActionControlImpl.prototype.disableAutowire=function(){var bone=microstrategy.getViewerBone();bone.commands.exec("disableAutowire");var src=microstrategy.activeCXMenu;var gb=microstrategy.findBone(bone.doc.selections.getSelectedGrid());var evtStr=gb.getActiveUnitString(src);var um=microstrategy.updateManager;um.addURL(evtStr);um.flushAndSubmitChanges();};mstrRWActionControlImpl.prototype.triStateUCCycle=function(elem){var hbox=getObj(this.triStateUCCheck);if(hbox.disabled){return true;}switch(hbox.value){case"1":hbox.value="0";break;default:hbox.value="1";break;}this.validateUC();};mstrRWActionControlImpl.prototype.onChangeDSCart=function(){try{this.setButtonEnable(this.OKButton,false);var dsSelectionBoxObj=getObj(this.dsSelectionBox);if(dsSelectionBoxObj!=null){if(!this.isCartBoxEmpty(dsSelectionBoxObj)){this.setButtonEnable(this.OKButton,true);}}}catch(err){microstrategy.errors.log(err);return false;}};mstrRWActionControlImpl.prototype.setControlUIDisplay=function(objId,display){var obj=getElementById(objId);if(obj){obj.style.display=display;}};mstrRWActionControlImpl.prototype.updateControlsOnDatatypeChange=function(){var targetTypeList=getObj(this.targetTypeList);if(targetTypeList&&targetTypeList.selectedIndex==1){var dsSelectionBoxObj=getObj(this.dsSelectionBox);if(!dsSelectionBoxObj||this.isCartBoxEmpty(dsSelectionBoxObj)){this.setButtonEnable(this.OKButton,false);}}else{this.setButtonEnable(this.OKButton,true);this.restoreAutowireStatus();}this.setControlUIDisplay("ctlDSTargetDiv",(targetTypeList.selectedIndex==1?"block":"none"));var displayType=(targetTypeList.selectedIndex==0?"block":"none");this.setControlUIDisplay("ctlTargetDiv",displayType);this.setControlUIDisplay("controlDataFilterMode_img",displayType);this.setControlUIDisplay("showTotalOptionDiv",displayType);this.setControlUIDisplay("autoSyncOptionDiv",displayType);this.setControlUIDisplay("ctlAutowireDiv",displayType);};mstrRWActionControlImpl.prototype.onTargetTypeChange=function(){if(this.selectionBox!=null){var selectionBoxObj=getObj(this.selectionBox);var avaliableBoxObj=getElementById("AvailableTargets");if(selectionBoxObj&&avaliableBoxObj){RemoveAllItemsToList(avaliableBoxObj,selectionBoxObj);}}if(this.dsSelectionBox!=null){var dsSelectionBoxObj=getObj(this.dsSelectionBox);var dsAvaliableBoxObj=getElementById("AvailableDSTargets");if(dsSelectionBoxObj&&dsAvaliableBoxObj){RemoveAllItemsToList(dsAvaliableBoxObj,dsSelectionBoxObj);}}this.updateControlsOnDatatypeChange();};mstrRWActionControlImpl.prototype.validateUC=function(fromLoad){var UCBox=getObj(this.triStateUCCheck);var UCBoxImg=getObj(this.triStateUCCheckImg);var selectionBoxObj=getObj(this.selectionBox);var synchBox=getObj(this.autoSynchCheck);var totalBox=getObj(this.totalCheck);var oldCount=this.selTargetsCount;this.selTargetsCount=selectionBoxObj.options.length;this.selTargetsCount=(selectionBoxObj.options[0].value=="-none-")?this.selTargetsCount-1:this.selTargetsCount;var addingTargets=oldCount<this.selTargetsCount;if(fromLoad&&UCBox.value=="-1"){return ;}var baseClass=UCBoxImg.className.split("_")[0];if(!this.UCEnabled||this.selTargetsCount==0){UCBox.disabled=true;UCBoxImg.className=baseClass+"_d";}else{UCBox.disabled=false;if(addingTargets||UCBox.value=="-1"){UCBoxImg.className=baseClass+"_3";UCBox.value="-1";}else{UCBoxImg.className=baseClass+"_"+UCBox.value;}}var UCChecked=UCBox.value=="1"&&!UCBox.disabled;var UCUndefined=UCBox.value=="-1"&&!UCBox.disabled;synchBox.disabled=UCChecked;totalBox.disabled=UCChecked||UCUndefined||this.isMetricSource;if(UCChecked){synchBox.checked=false;totalBox.checked=false;}};mstrRWActionControlImpl.prototype.isCartBoxEmpty=function(cartBoxObj){if(cartBoxObj.options.length>1||(cartBoxObj.options.length==1&&cartBoxObj.options[0]!=null&&cartBoxObj.options[0].value!="-none-")){return false;}return true;};mstrRWActionControlImpl.prototype.setButtonEnable=function(button,enable){if(button){if(enable){button.disabled=false;button.setAttribute("class","mstrButton");}else{button.disabled=true;button.setAttribute("class","mstrButton mstrButtonDisabled");}}};mstrRWActionControlImpl.prototype.getSelectedItemsFormCart=function(selectedBox){var selectionBoxObj=getObj(selectedBox);var i;selectedItems=[];for(i=0;i<selectionBoxObj.options.length;i++){if(selectionBoxObj.options[i]!=null){if(selectionBoxObj.options[i].value!="-none-"){selectedItems.push(selectionBoxObj.options[i].value);}}}return selectedItems;};function mstrRWActionControlImpl(id){this.inherits=mstrEditorImpl;this.inherits(id);this.inherits=null;return this;}