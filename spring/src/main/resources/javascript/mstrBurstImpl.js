mstrBurstImplScript=true;mstrBurstImpl.prototype=new mstrBoneImpl();mstrBurstImpl.prototype.useAnimate=true;mstrBurstImpl.prototype.minHeight=30;mstrBurstImpl.prototype.maxHeight=225;mstrBurstImpl.prototype.steps=5;mstrBurstImpl.prototype.valueField="id";mstrBurstImpl.prototype.nameField="n";mstrBurstImpl.prototype.itemSep=ITEM_SEPARATOR;mstrBurstImpl.prototype.unitSep=UNIT_SEPARATOR;mstrBurstImpl.prototype.simpleSep=",";mstrBurstImpl.prototype.visible=false;mstrBurstImpl.prototype.onload=function(){try{this.initBone();this.dataLoaded=false;this.hiddenArgName=this.burstEvtArgName;this.elCriteria=microstrategy.findChildWithAtt(this.elem,"span","id","burstCriteria");this.useBurst=!mstr.utils.String.isEmpty(this.burstEvtArgValue);this.updateExpandPageByCheckbox();this.updateToRecepientsDiv();this.updateDataLinkHistoryList();this.updateBurstSubFolder();}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.initCartComponents=function(){try{var elem=this.burstCart;this.elFieldset=microstrategy.findChildWithAtt(elem,"fieldset","id","fsBurst");this.availableCart=microstrategy.findChildWithAtt(elem,"select","id","availableBurstList");this.selectedCart=microstrategy.findChildWithAtt(elem,"select","id","selectedBurstList");this.addButton=microstrategy.findChildWithAtt(elem,"div","id","addUnitsButton");this.removeButton=microstrategy.findChildWithAtt(elem,"div","id","removeUnitsButton");this.addAllButton=microstrategy.findChildWithAtt(elem,"div","id","addAllUnitsButton");this.removeAllButton=microstrategy.findChildWithAtt(elem,"div","id","removeAllUnitsButton");this.upButton=microstrategy.findChildWithAtt(elem,"div","id","upUnitsButton");this.downButton=microstrategy.findChildWithAtt(elem,"div","id","downUnitsButton");this.addButton.onclick=new Function("e","return microstrategy.bone('"+this.id+"').add(e);");this.removeButton.onclick=new Function("e","return microstrategy.bone('"+this.id+"').remove(e);");this.addAllButton.onclick=new Function("e","return microstrategy.bone('"+this.id+"').addAll(e);");this.removeAllButton.onclick=new Function("e","return microstrategy.bone('"+this.id+"').removeAll(e);");this.upButton.onclick=new Function("e","return microstrategy.bone('"+this.id+"').up(e);");this.downButton.onclick=new Function("e","return microstrategy.bone('"+this.id+"').down(e);");}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.buildCart=function(cssText){var html='<fieldset id="fsBurst" style="'+(cssText||"")+'"><legend>'+microstrategy.descriptors.getDescriptor(9030)+'</legend><div class="mstrBurstCartDiv"><table cellspacing="0" cellpadding="0" border="0" class="mstrCart"><tbody><tr><td class="mstrCartAvailable"><div class="listHeader">'+microstrategy.descriptors.getDescriptor(9031)+'</div></td><td class="mstrCartButtons"></td><td class="mstrCartSelected"><div class="listHeader">'+microstrategy.descriptors.getDescriptor(9032)+'</div></td><td class="mstrCartButtons"></td></tr><tr><td class="mstrCartAvailable"><select class="cartAvailable" id="availableBurstList" size="8" multiple="1"></select></td><td class="mstrCartButtons"><div align="center" id="addUnitsButton"><img src="../images/1ptrans.gif" class="mstrIcon-btn mstrIcon-btnArrowRight" title="'+microstrategy.descriptors.getDescriptor(537)+'"></div><div align="center" id="addAllUnitsButton"><img src="../images/1ptrans.gif" class="mstrIcon-btn mstrIcon-btnAddAll"  title="'+microstrategy.descriptors.getDescriptor(3170)+'"></div><div align="center" id="removeUnitsButton"><img src="../images/1ptrans.gif" class="mstrIcon-btn mstrIcon-btnArrowLeft" title="'+microstrategy.descriptors.getDescriptor(875)+'"></div><div align="center" id="removeAllUnitsButton"><img src="../images/1ptrans.gif" class="mstrIcon-btn mstrIcon-btnRemoveAll" title="'+microstrategy.descriptors.getDescriptor(3168)+'"></div></td><td class="mstrCartSelected"><select class="cartSelected" id="selectedBurstList" size="8" multiple="1"></select></td><td class="mstrCartButtons"><div align="center" id="upUnitsButton"><img src="../images/1ptrans.gif" class="mstrIcon-btn mstrIcon-btnArrowUp" title="'+microstrategy.descriptors.getDescriptor(7978)+'"></div><div align="center" id="downUnitsButton"><img src="../images/1ptrans.gif" class="mstrIcon-btn mstrIcon-btnArrowDown" title="'+microstrategy.descriptors.getDescriptor(7979)+'"></div></td></tr></tbody></table></div></div></fieldset>';var span=document.createElement("span");span.innerHTML=html;this.burstCart=span.firstChild;delete span;return this.burstCart;};mstrBurstImpl.prototype.renderPulldown=function(label,items,callback,hiddenArgName,hiddenArgValue){try{var html='<div class="mstr-pulldown burst '+hiddenArgName+'"><span class="mstr-pulldown-label">'+label+'</span><div class="mstr-pulldown-container"><div class="mstr-pulldown-content"><div class="mstr-pulldown-title"></div><span class="mstr-pulldown-icon"></span></div><div class="mstr-pulldown-popup" style="display:none;"></div></div><span class="mstr-pulldown-suffix"></span></div>';if(hiddenArgName){html+='<input type="hidden" class="mstrHiddenInput" value="'+hiddenArgValue+'" id="'+hiddenArgName+'" name="'+hiddenArgName+'">';}var span=document.createElement("span");span.innerHTML=html;var pulldown=span.firstChild,containerNode=pulldown.childNodes[1],contentNode=containerNode.firstChild.firstChild,popupNode=containerNode.lastChild,fnTogglePopup=function(visible){popupNode.style.display=visible?"":"none";popupNode.style.left=contentNode.offsetLeft-1+"px";};pulldown.contentNode=contentNode;pulldown.popupNode=popupNode;pulldown.suffixNode=pulldown.lastChild;pulldown.onclick=function(e){var elTarget=getEventTarget(e||window.event),onBtn=containerNode.contains(elTarget),onPopup=popupNode.contains(elTarget);if(onPopup&&elTarget.idx!=undefined){elTarget.className=elTarget.className.replace(/ on/,"")+" on";var list=pulldown.list,prev=list.childNodes[list.selectedIndex];prev.className=prev.className.replace(/ on/,"");contentNode.innerHTML=(elTarget.innerHTML);fnTogglePopup(false);list.selectedIndex=elTarget.idx;if(callback){callback.call(this,list.selectedIndex);}}else{if(onBtn){fnTogglePopup(popupNode.style.display=="none");}else{fnTogglePopup(false);}}};mstr.$D.attachEvent(document.body,"mousedown",function(e){var elTarget=getEventTarget(e||window.event),onBtn=containerNode.contains(elTarget),onPopup=popupNode.contains(elTarget);if(!onBtn&&!onPopup){fnTogglePopup(false);}});this.updatePulldown(pulldown,items,{id:hiddenArgValue});var fs=this.elem.lastChild;fs.appendChild(pulldown.nextSibling);fs.appendChild(pulldown);delete span;return pulldown;}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.updatePulldown=function(pulldown,items,selectedItem){try{if(selectedItem){var idx=mstr.$A.findByForm(items,selectedItem.id,"id");if(idx>-1){items[idx].isDefault=true;}}pulldown.items=items;pulldown.popupNode.innerHTML="";var elList=this.renderList(items);if(elList){pulldown.popupNode.appendChild(elList);}pulldown.contentNode.innerHTML=mstr.utils.String.escape4HTMLText(elList?items[elList.selectedIndex].n:microstrategy.descriptors.getDescriptor("512"));pulldown.list=elList;}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.renderList=function(items){try{var elList=null;if(items&&items.length>0){elList=document.createElement("div");elList.className="mstr-list";var selectedIndex=0;for(var i=0,len=items.length;i<len;i++){var item=items[i],elItem=document.createElement("div");elItem.className="mstr-list-item";elItem.idx=i;elItem.id=item.id;elItem.t=item.t;elItem.st=item.st;elItem.innerHTML=mstr.utils.String.escape4HTMLText(item.n);elList.appendChild(elItem);if(item.isDefault){selectedIndex=i;}}elList.selectedIndex=selectedIndex;elList.childNodes[selectedIndex].className+=" on";}return elList;}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.renderPulldownForDevice=function(){try{var devices=this.burstDevices;if(devices&&devices.length>0){this.selectedDeviceId=this.burstEvtDeviceIdArgValue||"1D2E6D168A7711D4BE8100B0D04B6F0B";var me=this;this.devicePulldown=this.renderPulldown(microstrategy.descriptors.getDescriptor(11577),devices,function(idx){var deviceId=me.burstDevices[idx].id;me.selectedDevicedId=deviceId;window.setTimeout(function(){me.deviceHiddenArgInput.value=deviceId;},0);},this.burstEvtDeviceIdArgName,this.selectedDeviceId);this.deviceHiddenArgInput=this.devicePulldown.previousSibling;}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.renderPulldownForAddressForm=function(){try{this.selectedAddressFormId=this.burstEvtAddressIdArgValue;var items=this.buildAddressItems();if(items.length>=0){var me=this;this.addressPulldown=this.renderPulldown(microstrategy.descriptors.getDescriptor(11576),items,function(idx){var addressFormId=me.addressItems[idx].id;me.selectedAddressFormId=addressFormId;me.addressFormHiddenArgInput.value=addressFormId;},this.burstEvtAddressIdArgName,me.selectedAddressFormId);this.addressFormHiddenArgInput=this.addressPulldown.previousSibling;var tip=microstrategy.descriptors.getDescriptor(11578);this.addressPulldown.suffixNode.innerHTML='<img title="'+tip+'" alt ="info" height="15" width="15" src="../images/info.gif" border="0"/>';}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.buildAddressItems=function buildAddressItems(){try{var atts=this.selectedItems,items=[];for(var i=0,len=atts.length;i<len;i++){var att=atts[i],forms=att.forms;for(var j=0,len2=forms.length;j<len2;j++){var form=forms[j],item={id:att.id+"~"+form.id,n:att.n+": "+form.n};item.isDefault=(this.selectedAddressFormId==item.id);items.push(item);}}if(atts.length>0&&!this.selectedAddressFormId){items[0].isDefault=true;}this.addressItems=items;return items;}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.unrenderList=function(pulldown){try{if(pulldown){pulldown.items=null;pulldown.list.innerHTML="";pulldown.popupNode.innerHTML="";pulldown.contentNode.innerHTML=microstrategy.descriptors.getDescriptor("512");}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.prepareSelectedItems=function(){this.selectedItems=[];if(this.burstEvtArgValue.length==0){return ;}var items=this.burstEvtArgValue.split(this.unitSep);for(var i=0,len=items.length;i<len;i++){var item=items[i].split(this.itemSep),value=item[0];var idx=mstr.$A.findByForm(this.availableItems,value,this.valueField);if(idx>-1){this.selectedItems.push(this.availableItems[idx]);}}mstr.$A.removeItemsByForm(this.availableItems,this.selectedItems,this.valueField);};mstrBurstImpl.prototype.updateSelectedItems=function(){this.availableItems=[].concat(this._allItems);this.selectedItems=[];if(this.selectedCart.options.length==0){return ;}var items=this.selectedCart.options;for(var i=0,len=items.length;i<len;i++){var item=items[i].value.split(this.itemSep),value=item[0];var idx=mstr.$A.findByForm(this.availableItems,value,this.valueField);if(idx>-1){this.selectedItems.push(this.availableItems[idx]);}}mstr.$A.removeItemsByForm(this.availableItems,this.selectedItems,this.valueField);};mstrBurstImpl.prototype.loadData=function(){try{iframe.showWaitPage();var params=this.isReport?{taskId:"reportExecute",styleName:"SubscriptionsPageByAttributesStyle",execFlags:524288,resultFlags:41943072}:{taskId:"RWExecute",styleName:"SubscriptionsPageByAttributesStyle",executionMode:2};var msgId=this.getMsgId();if(msgId){if(this.isReport){params.msgID=msgId;}else{params.messageID=msgId;}}else{if(this.isReport){params.reportID=this.objectId;}else{params.objectID=this.objectId;}}if(this.subscriptionID){params.subscriptionID=this.subscriptionID;}var me=this;mstr.$XHR.request(mstrApp.taskURL||mstrConfig.taskURL,params,{success:function(res){me.dataLoaded=true;me.availableItems=res.atts||[];me.canBurst=me.availableItems.length>0;me._allItems=[].concat(me.availableItems);me.prepareSelectedItems();}},false);iframe.hideWaitPage();}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.getMsgId=function(){try{var bone;if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){bone=microstrategy.bone("UniqueReportID");}else{if(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION){bone=microstrategy.bone("rwb_viewer");}}return bone?bone.messageID:"";}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.openBurstEditor=function(burstBtn){try{var v=this.visible;if(!v&&!this.dataLoaded){this.loadData();if(this.canBurst){if(this.useAnimate){this.elem.style.height=this.minHeight+"px";}this.burstCart=this.buildCart();this.initCartComponents();this.updateCart(this.availableCart,this.availableItems);this.updateCart(this.selectedCart,this.selectedItems);if(this.availableItems.length==0){ClearSelectedItems(this.availableCart);}if(this.selectedItems.length==0){ClearSelectedItems(this.selectedCart);}this.elem.appendChild(this.burstCart);if(this.isEmailSub){this.renderPulldownForAddressForm();this.renderPulldownForDevice();this.maxHeight+=60;}}else{this.elCriteria.innerHTML='<label style="color:red">'+microstrategy.descriptors.getDescriptor(9174)+"</label>";}}if(!this.canBurst){return ;}var elem=this.elem;if(this.useAnimate){if(v){elem.style.overflow="hidden";}mstr.utils.Animations.resize(this.elem,null,v?this.minHeight:this.maxHeight,this.step,function(){if(!v){elem.style.overflow="visible";elem.style.height="auto";}});}else{this.elFieldset.style.display=v?"none":"block";}burstBtn.title=microstrategy.descriptors.getDescriptor(v?9034:9035);burstBtn.style.border=!v?"2px solid #ccc":"";this.visible=!v;}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.showPageByChangedSaveMessage=function(burstBtn){try{this.elCriteria.innerHTML='<label style="color:red">'+microstrategy.descriptors.getDescriptor(2510)+"</label>";}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.updateCart=function(cart,items){try{if(items&&items.length>0){cart.options.length=0;for(var i=0,len=items.length;i<len;i++){var option=new Option(items[i][this.nameField],items[i][this.valueField]+this.itemSep+items[i][this.nameField],false,false);option.className="mstrCartOption mstrBurstCartOption";option.title=items[i][this.nameField];cart.options.add(option);}}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.updateExpandPageByCheckbox=function(){try{var elExpandPageBy=document.getElementById("fModeExAll");if(elExpandPageBy){elExpandPageBy.disabled=this.useBurst;elExpandPageBy.useBurst=this.useBurst;}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.updateFilenameDiv=function(){try{if(this.isEmailSub){var zip=document.getElementById("fstate");if(zip){zip.onchange();}}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.updateToRecepientsDiv=function(){try{if(this.isEmailSub){var contactsDiv=document.getElementById("contactsTable")||document.getElementById("DIV_Address");if(contactsDiv){var curtain=this.contactsDivCurtain||(function(){var div=document.createElement("div");div.className="contactsTableCurtain";contactsDiv.appendChild(div);return div;})();this.contactsDivCurtain=curtain;curtain.style.display=this.useBurst?"block":"none";var allowDelSettings=document.getElementById("allowDelSettings");if(allowDelSettings){if(this.useBurst){allowDelSettings.checked=0;allowDelSettings.disabled=true;}else{allowDelSettings.disabled=false;}}var allowPers=document.getElementById("allowPers");if(allowPers){if(this.useBurst){allowPers.checked=0;allowPers.disabled=true;}else{allowPers.disabled=false;}}var allowUnsub=document.getElementById("allowUnsub");if(allowUnsub){if(this.useBurst){allowUnsub.checked=0;allowUnsub.disabled=true;}else{allowUnsub.disabled=false;}}contactsDiv.setAttribute("ignoreAddr",this.useBurst);}}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.updateDataLinkHistoryList=function(){try{if(this.isEmailSub){var sendDropdown=document.getElementById("dataLinkHistoryList");if(sendDropdown&&this.useBurst){sendDropdown.selectedIndex=0;sendDropdown.disabled=this.useBurst;}}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.updateBurstSubFolder=function(){try{var burstSubFolder=document.getElementById("DIV_burstSubFolder");if(burstSubFolder){burstSubFolder.style.display=this.useBurst?"":"none";}}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.updateBurstCriteria=function(){try{var el=this.elCriteria;var options=this.selectedCart.options;if(options&&options.length>0){this.useBurst=false;var html="";for(var i=0,len=options.length;i<len;i++){if(options[i].value=="-none-"){continue;}var separator=i==len-1?"":this.simpleSep;html+='<span class="mstrBurstItem"><span class="mstrIcon-lv mstrIcon-lv-a"></span><span>'+options[i].innerHTML+separator+"</span></span>";this.useBurst=true;}el.innerHTML=html;}this.updateExpandPageByCheckbox();this.updateFilenameDiv();this.updateToRecepientsDiv();this.updateDataLinkHistoryList();this.updateSelectedItems();if(this.isEmailSub){this.updatePulldown(this.addressPulldown,this.buildAddressItems());this.addressFormHiddenArgInput.value=this.addressItems.length>0?this.addressItems[this.addressPulldown.list.selectedIndex].id:"";}this.updateBurstSubFolder();}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.add=function(){try{AddItemsToList(this.availableCart.id,this.selectedCart.id,this.hiddenArgName);this.updateBurstCriteria();}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.addAll=function(){try{AddAllItemsToList(this.availableCart.id,this.selectedCart.id,this.hiddenArgName);this.updateBurstCriteria();}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.remove=function(){try{RemoveItemsFromList(this.availableCart.id,this.selectedCart.id,this.hiddenArgName);this.updateBurstCriteria();}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.removeAll=function(){try{RemoveAllItemsToList(this.availableCart.id,this.selectedCart.id,this.hiddenArgName);this.updateBurstCriteria();}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.up=function(){try{MoveItemsInListUp(this.selectedCart.id,this.hiddenArgName);UpdateHiddenSelectedValue(this.selectedCart.id,this.hiddenArgName);this.updateBurstCriteria();}catch(err){microstrategy.errors.log(err);}};mstrBurstImpl.prototype.down=function(){try{MoveItemsInListDown(this.selectedCart.id,this.hiddenArgName);UpdateHiddenSelectedValue(this.selectedCart.id,this.hiddenArgName);this.updateBurstCriteria();}catch(err){microstrategy.errors.log(err);}};function mstrBurstImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;return this;}