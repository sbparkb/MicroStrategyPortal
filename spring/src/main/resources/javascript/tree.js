mstrTreeImplScript=true;mstrTreeImpl.prototype=new mstrBoneImpl();mstrTreeImpl.prototype.path="";mstrTreeImpl.prototype.selections=null;mstrTreeImpl.prototype.onload=function(e){try{this.initBone();this.elem.onmousedown=new Function("e","return "+this.path+".onmousedown(e);");this.getSelections();}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeImpl.prototype.onmousedown=function(e){try{if(!e){e=window.event;}this.getSelections();var obj=getEventTarget(e);if(obj){if(obj.tagName.toLowerCase()=="img"||(obj.tagName.toLowerCase()=="span")&&!obj.getAttribute(microstrategy.HTMLATTR_DSS_ID)){obj=obj.parentNode;}if(this.selections!=null){this.selections.clickedSrc=obj;}switch(obj.tagName.toLowerCase()){case"span":if(this.selections!=null&&obj.getAttribute(microstrategy.HTMLATTR_DSS_ID)){if(this.selections.isSelected(obj)){if(e.ctrlKey){if(typeof (mstr)!="undefined"){this.attachWinListener(this.selections,"mouseup","ondeselect");}else{document.onmouseup=new Function("e","return "+this.selections.path+".ondeselect(e);");}}}else{if(!e.ctrlKey){this.selections.clear();}this.selections.add(obj);}if(this.selections.onmousedown){return this.selections.onmousedown(e);}}break;case"li":var cn=obj.className;if(cn&&(cn=="mstrTreeOpen"||cn=="mstrTreeClosed")){var span=microstrategy.findChildWithAtt(obj,"span","oty","12");var attDid=span&&span.getAttribute("oid"),ul=microstrategy.findChildWithAtt(obj,"ul","af","1");if(ul){ul.className="loading";var me=this;mstr.$XHR.request(mstrConfig.taskURL,{taskId:"getAttributeForms",styleName:"MojoAttributeStyle",attributeID:attDid,displayedForms:0},{success:function(res){var attForms=res.fms;for(var i=0;i<attForms.length;i++){var f=attForms[i];if(!f.itf){continue;}var li=document.createElement("li");li.innerHTML="<nobr><span id="+me._nextId()+" ds="+f.n+" oid="+f.did+" oty="+f.t+" title="+f.n+'><img border=0 align=absmiddle src="../images/formli.png" alt="">&nbsp;'+f.n+"</span></nobr>";ul.appendChild(li);}ul.removeAttribute("af");ul.className="";}});}if(obj.className=="mstrTreeOpen"){this.collapseNode(obj);}else{this.expandNode(obj);}break;}default:if(this.selections!=null){this.selections.clear();}}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeImpl.prototype._nextId=function(){var pfx=this.elem.getAttribute("pfx")||"",nodeId=pfx+this.elem.getElementsByTagName("span").length;return nodeId;};mstrTreeImpl.prototype.addNode=function(node,attForms){var ul=this.elem.firstChild;if(ul){if(microstrategy.findChildWithAtt(ul,"span","oid",node.getAttribute("oid"))){return ;}var isAttr=node.getAttribute("oty")==microstrategy.DSSTYPE_ATTRIBUTE;node.id=this._nextId();node.className="mstrTreeStrong";node.innerHTML='<img border="0" align="absmiddle" src="../images/'+(isAttr?"attributeli.png":"metricli.png")+'" alt="">&nbsp;'+node.getAttribute("ds");var li=document.createElement("li");li.className=isAttr?"mstrTreeClosed":"";var nobr=document.createElement("nobr");nobr.appendChild(node);li.appendChild(nobr);ul.appendChild(li);if(isAttr){var _ul=document.createElement("ul");_ul.style.display="none";if(!attForms){_ul.setAttribute("af","1");}else{for(var i=0;i<attForms.length;i++){var f=attForms[i];var _li=document.createElement("li");_li.innerHTML="<nobr><span ds="+f.n+" oid="+f.dssid+" oty="+f.ty+" title="+f.n+'><img border=0 align=absmiddle src="../images/formli.png" alt="">&nbsp;'+f.n+"</span></nobr>";_ul.appendChild(_li);}}li.appendChild(_ul);}}};mstrTreeImpl.prototype.updateAttForms=function(){var xhr=this.xhr;switch(xhr.readyState){case 4:if(xhr.status==200&&!xhr.cancelled){var txt=xhr.responseText;if(txt){try{var rsData=eval("("+txt+")");}catch(ex){}}console.log(txt);}else{if(xhr.status>=400){alert(xhr.status+" : "+xhr.statusText);}}break;default:break;}};mstrTreeImpl.prototype.collapseNode=function(node){try{if(node.tagName.toLowerCase()=="li"){node.className="mstrTreeClosed";if(node.lastChild&&node.lastChild.tagName.toLowerCase()=="ul"){node.lastChild.style.display="none";}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeImpl.prototype.expandNode=function(node){try{if(node.tagName.toLowerCase()=="li"){node.className="mstrTreeOpen";if(node.lastChild&&node.lastChild.tagName.toLowerCase()=="ul"){node.lastChild.style.display="block";}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrTreeImpl.prototype.getSelections=function(){try{if(this.selections==null&&this.parentBone!=null&&this.parentBone.selections!=null){this.selections=this.parentBone.selections;}}catch(err){microstrategy.errors.log(err);return false;}};function mstrTreeImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);this.inherits=null;return this;}