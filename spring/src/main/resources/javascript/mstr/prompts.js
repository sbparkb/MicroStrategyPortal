mstr.Props.MSTRElement={DSSID:"dssid",TYPE:"emt",ARITY:"art",DISPLAYID:"disp_id",FORMKEYUNKNOWN:"formKeyUnknown",FORMID:"formId",FORMNAME:"formName",FORMVALUE:"formValue"};mstr.Props.Nodes={EXPRESSIONTYPE:"expressionType",NODETYPE:"nodeType",DATATYPE:"dataType",NODEDIMTYTYPE:"nodeDimtyType",NODEDIMTYLEVEL:"nodeDimtyLevel",DIMTYOBJECT:"dimtyObject",LIMITUNITID:"limitUnitId",LIMITGROUPID:"limitGroupId",LIMITTYPE:"limitType",DISPLAYNAME:"displayName",DISPLAYID:"displayId",EMET:"emet",FUNCTION:"function",PROPERTYSTR:"propertyStr",MRPFUNCTION:"mrpFunction",FUNCTIONTYPE:"functionType",PROPS:"props",TARGET:"target",ATTRIBUTEINFO:"attributeInfo",FORMINFO:"formInfo",CONSTANTDATATYPE:"constantDataType",CONSTANTVALUE:"constantValue",VALUE:"value",TIMECONTAINER:"timeContainer",SOURCE:"source",ELEMENTSCOLLECTION:"elementsCollection",APPLYSUBEXPRESSION:"applySubExpression",USESCHEMA:"useSchema",RELATIONSHIP:"relationship",INDETERMINATE:"indetExprType"};mstr.Props.DimtyObject={CANCONTINUE:"canContinue",FILTERREST:"filterRest",UNITS:"units"};mstr.Props.DimtyUnit={UNITTYPE:"unitType",AGGREGATION:"aggregation",FILTERING:"filtering",GROUPBY:"groupBy",RELATIVEPOSITION:"relativePosition",DISPLAYID:"displayId",DISPLAYNAME:"displayName",TARGET:"target"};mstr.Props.DimtyLevel={ID:"dssid",NAME:"n",ATTRIBUTES:"attrs"};mstr.Props.Functions={ID:"dssid",TYPE:"dsstp"};mstr.Props.QuestionAnswer={VALUE:"value",VALUEFLATTENED:"valueFlattened",AVAILABLE:"available",AVAILABLEFLATTENED:"availableFlattened",ISCOMPLEX:"isComplex"};mstr.Props.Answer={PRIMELOCKEY:"key",PROMPTTYPE:"pt",PRIMELOCPIN:"pin",PRIMELOCID:"did",PRIMELOCTYPE:"tp",ROOTNODE:"answerObject"};mstr.Props.Validation={STATUSCODE:"statusCode",MESSAGES:"msgs"};mstr.Enum.Widget.ALLOWQUALIFYORSELECT={NONE:0,QUALIFY:1,SELECT:2,BOTH:3};mstr.Enum.Widget.DISPLAYEDFORMS={ALL:0,BROWSE:1,REPORT:2,SAP_QUAL:3};mstr.Enum.Cache={};mstr.Enum.Cache.CACHETYPE={ATTRIBUTEDSSFORMS:"attributeDSSForms",ATTRIBUTEBROWSEFORMS:"attributeBrowseForms",ATTRIBUTEDATAFORMS:"attributeDataForms"};mstr.Enum.Question={};mstr.Enum.Question.TYPE={CONSTANT:"Constant",OBJECTLIST:"ObjectList",ELEMENTLIST:"ElementList",METRICQUALIFIER:"MetricQualifier",ATTRIBUTEQUALIFIER:"AttributeQualifier",HIERARCHY:"Hierarchy"};mstr.Enum.Prompts={};mstr.Enum.Prompts.VALIDATIONLEVEL={OFF:0,ATRUNREPORT:1,AFTERANSWEREACH:2,INMIDANSWEREACH:3};mstr.Enum.Prompts.AUTOFORMATLEVEL={OFF:0,AFTERRUNREPORT:1,BEFORERUNREPORT:2,AFTERANSWEREACH:3,INMIDANSWEREACH:4};mstr.Enum.Prompts.DISPLAYSTYLE={PULLDOWN:"Pull down",LIST:"List",CART:"Cart",CALENDAR:"Calendar",TREE:"Tree"};mstr.Enum.Nodes.EXPRESSIONTYPE={GENERIC:1,SINGLEMETRICQUAL:10,SINGLEBASEFORMQUAL:2,LISTQUAL:5,LISTFORMQUAL:6,JOINTLISTQUAL:7,BRANCHQUAL:14,MDXSAPVARIABLE:22};mstr.Enum.Nodes.NODETYPE={NODEOPERATOR:4,SHORTCUT:5,FORMSHORTCUT:1,CONSTANT:3,BIGDECIMAL:10,TIME:6,ELEMENTSOBJECT:2,RELATIONSHIP:7};mstr.Enum.Nodes.NODEDIMTYTYPE={UNSPECIFIED:7,NONE:1,OUTPUTLEVEL:4};mstr.Enum.Nodes.NODEDIMTYLEVEL={DEFAULT:0,METRIC:1,REPORT:2,ATTRIBUTES:3};mstr.Enum.Nodes.FUNCTION={EQUALS:6,NOTEQUALS:7,GREATERTHAN:8,GREATERTHANEQUALS:10,LESSTHAN:9,LESSTHANEQUALS:11,BETWEEN:17,NOTBETWEEN:44,ISNULL:54,ISNOTNULL:55,IN:22,NOTIN:57,CONTAINS:76,NOTCONTAINS:79,BEGINSWITH:77,NOTBEGINSWITH:80,ENDSWITH:78,NOTENDSWITH:81,LIKE:18,NOTLIKE:43,AND:19,OR:20,NOT:21,RANK:23,RANKPERCENT:59,TUPLE:1000};mstr.Enum.Nodes.MRPFUNCTION={TOP:1,BOTTOM:2,BETWEEN:3,EXCLUDETOP:4,EXCLUDEBOTTOM:5,NOTBETWEEN:6,EQUALS:7,DIFFERENTFROM:8};mstr.Enum.Nodes.FUNCTIONTYPE={DEFAULT:1,RANK:2,RANKPERCENT:3};mstr.Enum.Nodes.PROPERTYSTR={RANKTOP:'<pr ix="4" v="0" />',RANKBOTTOM:'<pr ix="4" v="-1" />',PERCENT:'<pr ix="5" v="0" />',NONPERCENT:'<pr ix="5" v="-1" />'};mstr.Enum.Nodes.INCLUDESTATE={INCLUDE:1,EXCLUDE:2};mstr.Enum.Form={};mstr.Enum.Form.ALL={dssid:"idAll",n:"(All)",dtp:mstr.Enum.Nodes.DATATYPE.CHAR};mstr.Enum.BranchQual={};mstr.Enum.BranchQual.DSSID={AND:1,OR:2,ANDNOT:3,ORNOT:4};mstr.Enum.Functions={};mstr.Enum.Functions.CATEGORY={ELEMENT:"Element",ATTRIBUTE:"Attribute",MDXATTRIBUTE:"MDXAttribute",SAPATTRIBUTE:"SAPAttribute",MDXMETRIC:"MDXMetric",METRIC:"Metric"};mstr.Enum.DimtyUnit={};mstr.Enum.DimtyUnit.UNITTYPE={ATTRIBUTE:-1,DIMENSION:-2};mstr.Enum.MSTRFolderItem.DATATYPE=mstr.Enum.DataForm.DATATYPE;mstr.Enum.App={};mstr.Enum.App.EnumDSSXMLFolderNames={DssXmlFolderNameSchemaAttributes:26};mstr.Enum.Validation.Prompt={};mstr.Enum.Validation.Prompt.Stage={RUNREPORT:1,CHANGEANSWER:2,NAVIGATEAWAY:3,LOSTFOCUS:4,KEYSTROKE:5,INIT:6};mstr.Enum.BEANTYPE={REPORT:2,HTMLDOC:8,SUBS:128,SCHED:256,RW:1024};mstr.Settings.DataExplorer={AUTOEXPANDONDRILL:true};mstr.Settings.Expression={DEFAULTMETRICDATATYPE:mstr.Enum.Nodes.DATATYPE.UNKNOWN,DEFAULTFORMDATATYPE:mstr.Enum.Nodes.DATATYPE.CHAR,QUALIFICATIONDELIMITER:[";",","],SAPQUALIFICATIONDELIMITER:",",PRESERVEWHITESPACE:false,METRICVALIDATIONLEVEL:0};mstr.Settings.Elements={BLOCKCOUNT:100};mstr.Settings.Prompts={VALIDATIONLEVEL:3,AUTOFORMATLEVEL:2};mstr.Settings.Functions={};mstr.Settings.Functions.Include=[{dssid:"1",n:"Include"},{dssid:"2",n:"Exclude"}];mstr.Settings.Functions.BranchQual=[{dssid:"1",n:"AND"},{dssid:"2",n:"OR"},{dssid:"3",n:"AND NOT"},{dssid:"4",n:"OR NOT"}];mstr.Settings.Functions.RootOperator=[{dssid:19,n:"All selections"},{dssid:20,n:"Any selection"}];mstr.Settings.Functions.Metric=mstr.Settings.Functions.MDXMetric=[{dssid:"1,6",tp:1,id:6,n:"Equal to"},{dssid:"1,7",tp:1,id:7,n:"Not Equal to"},{dssid:"1,8",tp:1,id:8,n:"Greater than"},{dssid:"1,10",tp:1,id:10,n:"Greater than or equal to"},{dssid:"1,9",tp:1,id:9,n:"Less than"},{dssid:"1,11",tp:1,id:11,n:"Less than or equal to"},{dssid:"1,17",tp:1,id:17,n:"Between"},{dssid:"1,44",tp:1,id:44,n:"Not between"},{dssid:"1,54",tp:1,id:54,n:"Is Null"},{dssid:"1,55",tp:1,id:55,n:"Is not null"},{dssid:"1,22",tp:1,id:22,n:"In"},{dssid:"1,57",tp:1,id:57,n:"Not in"},{dssid:"2,1",tp:2,id:1,n:"Highest"},{dssid:"2,2",tp:2,id:2,n:"Lowest"},{dssid:"3,1",tp:3,id:1,n:"Highest (%)"},{dssid:"3,2",tp:3,id:2,n:"Lowest (%)"}];mstr.Settings.Functions.Attribute=mstr.Settings.Functions.SAPAttribute=mstr.Settings.Functions.MDXAttribute=[{dssid:"1,6",tp:1,id:6,n:"Equal to"},{dssid:"1,7",tp:1,id:7,n:"Not Equal to"},{dssid:"1,8",tp:1,id:8,n:"Greater than"},{dssid:"1,10",tp:1,id:10,n:"Greater than or equal to"},{dssid:"1,9",tp:1,id:9,n:"Less than"},{dssid:"1,11",tp:1,id:11,n:"Less than or equal to"},{dssid:"1,17",tp:1,id:17,n:"Between"},{dssid:"1,44",tp:1,id:44,n:"Not between"},{dssid:"1,76",tp:1,id:76,n:"Contains"},{dssid:"1,79",tp:1,id:79,n:"Does not contain"},{dssid:"1,77",tp:1,id:77,n:"Begins with"},{dssid:"1,80",tp:1,id:80,n:"Does not begin with"},{dssid:"1,78",tp:1,id:78,n:"Ends with"},{dssid:"1,81",tp:1,id:81,n:"Does not end with"},{dssid:"1,18",tp:1,id:18,n:"Like"},{dssid:"1,43",tp:1,id:43,n:"Not like"},{dssid:"1,54",tp:1,id:54,n:"Is Null"},{dssid:"1,55",tp:1,id:55,n:"Is not null"},{dssid:"1,22",tp:1,id:22,n:"In"},{dssid:"1,57",tp:1,id:57,n:"Not in"}];mstr.Settings.Functions.Element=[{dssid:"1,22",tp:1,id:22,n:"In List"},{dssid:"1,57",tp:1,id:57,n:"Not In List"}];mstr.Settings.Functions.ExprType=[{dssid:2,n:"Qualify"},{dssid:5,n:"Select"}];mstr.Settings.Functions.Prohibited={};mstr.Settings.Functions.Prohibited.Numeric=[{dssid:"1,76"},{dssid:"1,79"},{dssid:"1,77"},{dssid:"1,80"},{dssid:"1,78"},{dssid:"1,81"},{dssid:"1,18"},{dssid:"1,43"}];mstr.Settings.Functions.Prohibited.String=[{dssid:"2,1"},{dssid:"2,2"},{dssid:"3,1"},{dssid:"3,2"}];mstr.Settings.Functions.Prohibited.Date=mstr.Settings.Functions.Prohibited.String.concat(mstr.Settings.Functions.Prohibited.Numeric);mstr.Settings.DimtyLevels=[{dssid:0,n:"Default"},{dssid:1,n:"Metric"},{dssid:2,n:"Report"}];mstr.Settings.TaskBlockCountMap={"*":-1,searchMetadata:30,browseElements:30,browseHierarchy:30};mstr.utils.UpdateManagerHelper=(function(){var UMH={};UMH.addPromptEvent=function UMH_addPromptEvent(elem,id,beanPath,argID,newArgs,oldArgs,cachedArray,argKey){if((argKey!=null)&&(argKey!="0")){microstrategy.updateManager.add([microstrategy.updateManager.createActionObject(elem,id,beanPath,argID,newArgs,oldArgs,cachedArray,argKey)]);}else{microstrategy.updateManager.add([microstrategy.updateManager.createActionObject(elem,id,beanPath,argID,newArgs,oldArgs,cachedArray)]);}};UMH.submitFormToUpdateManager=function UMH_submitFormToUM(oForm,needPageSize){if(!oForm){oForm=this.createDynamicFormForPrompts();}mstr.utils.Dom.addFormHiddenInput(oForm,"promptLoaded","true");if(needPageSize){UpdateHelper.appendPageSizeToParams(oForm);}microstrategy.showWait(true);submitForm(oForm);};UMH.createDynamicFormForPrompts=function UMH_createDynFormForPrompts(){var sAction=microstrategy.updateManager.getFormAction();var el=self.document.createElement("form");sAction=microstrategy.addJSessionID(sAction);el.action=sAction;el.method="POST";if(self.document.body){self.document.body.appendChild(el);}return el;};UMH.getSaveEventCodeForBeanType=function UMH_getSaveEvent(beanType){switch(parseInt(beanType)){case mstr.Enum.BEANTYPE.REPORT:case mstr.Enum.BEANTYPE.HTMLDOC:return mstrUpdateManager.WebEventSaveAs;case mstr.Enum.BEANTYPE.RW:return mstrUpdateManager.WebEventRWSaveAs;}return null;};UMH.getCancelEventCodeForBeanType=function UMH_getCancelEvent(beanType,isReprompt){switch(parseInt(beanType)){case mstr.Enum.BEANTYPE.REPORT:return(isReprompt)?mstrUpdateManager.REPORT_EVENT_CANCEL_REPROMPT_REQUEST:mstrUpdateManager.REPORT_EVENT_CANCEL_REQUEST;case mstr.Enum.BEANTYPE.HTMLDOC:return(isReprompt)?mstrUpdateManager.DOCUMENT_EVENT_CANCEL_REPROMPT_REQUEST:mstrUpdateManager.DOCUMENT_EVENT_CANCEL_REQUEST;case mstr.Enum.BEANTYPE.RW:return(isReprompt)?mstrUpdateManager.REPORT_WRITER_EVENT_CANCEL_REPROMPT_REQUEST:mstrUpdateManager.REPORT_WRITER_EVENT_CANCEL_REQUEST;case mstr.Enum.BEANTYPE.SUBS:return mstrUpdateManager.SUBSCRIPTION_EVENT_CANCEL;case mstr.Enum.BEANTYPE.SCHED:return mstrUpdateManager.SCHEDULE_EVENT_CANCEL;}return null;};UMH.serializeObjectList=function UMH_serializeObjectList(items){var len=mstr.$A.len(items);if(!len){return"";}var DELIM_ANSWERS=(typeof (ANSWER_SEPARATOR)=="undefined")?String.fromCharCode(27):ANSWER_SEPARATOR;var DELIM_ITEMS=(typeof (ITEM_SEPARATOR)=="undefined")?String.fromCharCode(126):ITEM_SEPARATOR;var answers=new Array(len),item;for(var i=0;i<len;i++){item=items[i];if(item.tp==mstr.Enum.MSTRFolderItem.TYPE.DIMTYUNIT||item.tp==mstr.Enum.MSTRFolderItem.TYPE.DIMTYUNITATTRIBUTE||item.tp==mstr.Enum.MSTRFolderItem.TYPE.DIMTYUNITDIMENSION){answers[i]=[item.dssid,item.tp,item.n,item.agg,item.flt,item.gb,item.rps].join(DELIM_ITEMS);}else{var tp=item.tp;answers[i]=[item.dssid,tp||"0",item.n].join(DELIM_ITEMS);}}return answers.join(DELIM_ANSWERS);};UMH.serializeExpression=function UMH_serializeExpression(exprPromptAnswer,exprRootNode,exprModelType,bNullRootIsEmpty){var xmlNode=mstr.xml&&mstr.xml.Builder&&mstr.xml.Builder.buildResolution(exprPromptAnswer,exprRootNode,exprModelType,bNullRootIsEmpty);return(xmlNode&&xmlNode.buildXMLString&&xmlNode.buildXMLString())||"";};return UMH;})();mstr.models.PromptAnswer.prototype.execRename=function PA_execRename(newNamedAnswerInfo){this.set("container",newNamedAnswerInfo);};mstr.models.PromptAnswer.prototype.validateSavedAnswer=function PA_validateSavedAnswer(){var status={statusCode:mstr.Enum.Validation.STATUSCODE.VALID};var savedAnswer=this.get("container");if(!savedAnswer||(!savedAnswer.n&&!savedAnswer.dssid)){status.statusCode=mstr.Enum.Validation.STATUSCODE.NO_PERSONAL_ANSWER_NAME;}else{if(savedAnswer.n&&/[\\\[\]"]/.test(savedAnswer.n)){status.statusCode=mstr.Enum.Validation.STATUSCODE.INVALID_PERSONAL_ANSWER_NAME;}}return status.statusCode;};mstr.models.PromptAnswer.prototype._getMsgForStatus=function PA_getMsg4Status(statusCode){var en=mstr.Enum.Validation.STATUSCODE,descs=this.props.descriptors,msg;var l=this._msgsForStatus;if(!l){l=this._msgForStatus={};l[en.EXCEEDS_MIN_COUNT]="minCountWarning";l[en.EXCEEDS_MAX_COUNT]="maxCountWarning";l[en.EXCEEDS_MIN_VALUE]="minValueWarning";l[en.EXCEEDS_MAX_VALUE]="maxValueWarning";l[en.EXCEEDS_MIN_LENGTH]="minLengthWarning";l[en.EXCEEDS_MAX_LENGTH]="maxLengthWarning";l[en.NO_INPUT]="requiredWarning";l[en.INVALID_DATATYPE]="dataTypeWarning";l[en.NO_PERSONAL_ANSWER_NAME]="noPersonalAnswerNameWarning";l[en.INCOMPLETE_CONDITION]="incompleteCondition";l[en.INCOMPLETE_CONDITION_ON_AUTO_NODE]="incompleteCondition";l[en.TRUNCATED]="truncatedWarning";l[en.INVALID_PERSONAL_ANSWER_NAME]="invalidPersonalAnswerNameWarning";}var desc_id=l&&l[statusCode];return(desc_id&&descs&&descs[desc_id])||"";};mstr.models.ConstantPromptAnswer.prototype.reloadAnswer=function CPA_reloadAnswer(newAnswer){this.set("isComplex",newAnswer.props.isComplex);this.set("valueString",newAnswer.props.valueString);};mstr.models.ConstantPromptAnswer.prototype.execImportFile=function CPA_execImportFile(formInfo){if(!(formInfo&&formInfo.el&&formInfo.inputId)){return false;}var inputs=new mstr.http.ImportFileRequestInputs(formInfo.el,formInfo.inputId,formInfo.maxFileSize,formInfo.maxElements,formInfo.inputDelimiter,formInfo.outputDelimiter);var memo={commandId:"ImportFile",formInfo:formInfo};this.submitRequest(inputs,memo);return true;};mstr.models.ConstantPromptAnswer.prototype.getCalendarTimePicker=function CPA_getCalendarTimePicker(){if(!this.props.initedCalendarTimePicker){mstr.controllers.Factory.plugin(this,mstr.models.DateTimeConstantPromptAnswerPlugIn);this.props.initedCalendarTimePicker=true;}return this;};mstr.models.ListModel.prototype.getHeaderModel=function LM_getHeaderModel(){if(!this.props.headerModel){this._initHeaderModel();}return this.props.headerModel;};mstr.models.ListModel.prototype._initHeaderModel=function LM_initHeaderModel(){this.updateContainerHierarchyId();var props={item:this.getContainer().value};var lc=this.props.headerModel=new mstr.models.BaseModel(props);mstr.controllers.Factory.add(lc);lc&&lc.init&&lc.init();};mstr.models.ListModel.prototype.updateHeaderModel=function LM_updateHeaderModel(){this.updateContainerHierarchyId();this.props.headerModel.set("item",this.getContainer().value);};mstr.models.ListModel.prototype.updateContainerHierarchyId=function LM_updateContainerHierarchyId(){var container=this.getContainer();if(container&&container.isWithinHierarchy==null){container.isWithinHierarchy=!!mstr.utils.ListViewHelper.isWithinHierarchy(container);}if(container&&container.isWithinHierarchy&&container.value){dimensionId=mstr.utils.ListViewHelper.getHierarchyId(container);container.value.dimensionId=dimensionId;}};mstr.models.ListModel.prototype.execBrowseForms=function LM_execBrowseForms(args){return this.browseForms(args&&args.attributeId,args&&args.formCategory);};mstr.models.ListModel.prototype.browseForms=function LM_browseForms(attributeId,formCategory){if(!attributeId){return false;}if(formCategory==null){formCategory=mstr.Enum.Widget.DISPLAYEDFORMS.ALL;}var inputs=new mstr.http.BrowseFormsRequestInputs(attributeId,formCategory,this.props.dataSourcesXML);var memo={commandId:"BrowseForms"};this.submitRequest(inputs,memo);return true;};mstr.models.ListModel.prototype.browseHierarchyBlock=function LM_browseHierarchyBlock(path,blockBegin,searchPattern,memo){if(!blockBegin||blockBegin<0){return false;}if(searchPattern==null){searchPattern="";}var inputs=new mstr.http.DataExploreRequestInputs(path,searchPattern,this.props.searchMatchCaseAvailable&&this.props.searchMatchCase,blockBegin,mstr.utils.ListViewHelper.getFetchBlockForTask("browseHierarchy"),this.props.dataSourcesXML||"");this.submitRequest(inputs,memo);return true;};mstr.models.ListModel.prototype.execBrowseAttribute=function LM_execBrowseAttribute(attrId){return this.browseAttributeBlock(attrId,1);};mstr.models.ListModel.prototype.execSearchAttribute=function LM_execSearchAttribute(searchPattern){var conNode=this.getContainer();var attrId=conNode&&conNode.value&&conNode.value.dssid;this.browseAttributeBlock(attrId,1,searchPattern);};mstr.models.ListModel.prototype.browseAttributeBlock=function LM_browseAttributeBlock(attrId,blockBegin,searchPattern){if(!attrId||!blockBegin||blockBegin<0){return false;}if(searchPattern==null){searchPattern="";}var conNode=this.getContainer();var dimensionId=conNode&&conNode.value&&conNode.value.dimensionId;var searchForms="";if(conNode&&conNode.value&&conNode.value.dssforms&&conNode.value.dssforms.length>0){for(var i=0;i<conNode.value.dssforms.length;i++){if(i>0){searchForms+=";";}searchForms+=conNode.value.dssforms[i].dssid;}}var inputs=new mstr.http.BrowseAttributeRequestInputs(attrId,blockBegin,(this.props.blockCount&&!this.props.blockCountAuto)?this.props.blockCount:mstr.utils.ListViewHelper.getFetchBlockForTask("browseElements"),this.props.totalSize||0,!!this.props.collectForms,searchPattern,this.props.searchMatchCaseAvailable&&this.props.searchMatchCase,this.props.filterXML||"",this.props.dataSourcesXML||"",this.props.includeFormValues,this.props.displayedForms,dimensionId||this.props.dimensionId,searchForms);var memo={commandId:"BrowseAttribute",searchPattern:searchPattern};this.submitRequest(inputs,memo);return true;};mstr.models.ListModel.prototype.canBrowseAttribute=function LM_canBrowseAttribute(item){if(item&&(parseInt(item.tp)==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE)){var con=this.getContainer();if(!con){return true;}var conType=parseInt(con.value.tp);return !!(conType&&(conType!=mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY)&&(conType!=mstr.Enum.MSTRFolderItem.TYPE.ELEMENT));}};mstr.models.ListModel.prototype.execBrowseHierarchyItem=function LM_BrowseHierarchyItem(itemId){var LM=mstr.models.ListModel;var index=this.indexOfValue(itemId);if(index<=-1){return false;}var item=this.props.items[index],items=[item],itemsSiblings=[this.props.items],conNode=this.getContainer();var path=this._buildHierarchyPathForNode(conNode);var ITEM_PATH_PREFIX=(parseInt(item.tp)==mstr.Enum.MSTRFolderItem.TYPE.FILTER)?LM.ELE_FILTER_ATT_DELIM:LM.HIERARCHY_PATHDELIM;if(path){path+=ITEM_PATH_PREFIX;}path+=encodeBrowsePathElement(item[this.props.valueForm]);var downPaths=[],downPathCount=0,drillPaths=this.getRMCModel()&&this.getRMCModel().getItems()||item.filters;for(var i=0,len=mstr.$A.len(drillPaths);i<len;i++){if(drillPaths[i]&&(drillPaths[i]["drillDir"]=="down"||drillPaths[i]["tp"]=="1")){downPaths.push(drillPaths[i]);downPathCount++;}}if((downPathCount>1)||((downPathCount==1)&&downPaths[0]["locked"])){this._loadResults({browsedItems:items,browsedItemsSiblings:itemsSiblings,listItems:downPaths,totalSize:downPathCount,blockBegin:1,blockCount:downPathCount,leafElements:false});return true;}else{var autoExpand=this.canAutoExpandOnDrill();if(autoExpand&&(downPathCount==1)&&(!downPaths[0]["locked"]||downPaths[0]["tp"]=="1")){path+=(downPaths[0].tp=="1"?LM.ELE_FILTER_ATT_DELIM:LM.HIERARCHY_PATHDELIM)+encodeBrowsePathElement(downPaths[0][this.props.valueForm]);items.push(downPaths[0]);itemsSiblings.push(downPaths);var nv=downPaths[0];if(nv.tp=="12"&&nv.filters&&nv.filters.length==1){var fv=nv.filters[0];path+=(fv.tp=="1"?LM.ELE_FILTER_ATT_DELIM:TM.HIERARCHY_PATHDELIM)+encodeBrowsePathElement(fv[this.props.valueForm]);items.push(fv);itemsSiblings.push([fv]);}}var bSearchRequired=false;if(!!this.props.elementSearchRequired&&!this.props.searchPattern){var itemsLength=mstr.$A.len(items),lastItemBrowsed=itemsLength?items[itemsLength-1]:null;var lastItemBrowseParent=(itemsLength>1)?items[itemsLength-2]:conNode&&conNode.value;var lpp=(itemsLength>2)?items[itemsLength-3]:((itemsLength>1)?conNode&&conNode.value:conNode&&conNode.parent&&conNode.parent.value);bSearchRequired=this.isElementSearchRequired({value:lastItemBrowsed,parent:{value:lastItemBrowseParent,parent:{value:lpp}}});}if(bSearchRequired){this._loadResults({browsedItems:items,browsedItemsSiblings:itemsSiblings,listItems:[],totalSize:0,blockBegin:1});return true;}else{return this.browseHierarchyBlock(path,1,"",{commandId:"BrowseHierarchyItem",items:items,itemsSiblings:itemsSiblings});}}return false;};mstr.models.ListModel.prototype.isElementSearchRequired=function LM_isElemSearchRequired(conNode){if(this.props.elementSearchRequired){if(!conNode){conNode=this.getContainer();}if(conNode&&conNode.value){if((conNode.value.tp==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE)){if(mstr.utils.ListViewHelper.isWithinHierarchy(conNode)){var p=conNode.parent;return((!conNode.value.filters||conNode.value.filters.length==0)&&!!(p&&p.value&&(p.value.tp==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY)));}else{return true;}}else{if(conNode.value.tp==mstr.Enum.MSTRFolderItem.TYPE.FILTER){var p=conNode.parent;var pp=p&&p.parent;return !!(p&&p.value&&p.value.tp==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE&&pp&&pp.value&&pp.value.tp==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY);}}}return false;}};mstr.models.ListModel.prototype.execDrillHierarchyItem=function LM_DrillHierarchyItem(drillPath){var LM=mstr.models.ListModel;var itemId=drillPath&&drillPath[this.props.valueForm];if(!itemId){return false;}var path=this._buildHierarchyPathForNode(this.getContainer());if(path){path+=LM.HIERARCHY_PATHDELIM;}var selItems=this.getSelectedItems(),lenSel=mstr.$A.len(selItems),vf=this.props.valueForm,selItem;if(lenSel<2){selItem=selItems&&selItems[0];selItem.isMultiElems=false;}else{selItem=mstr.$H.clone(selItems[0]);var names=[],ids=[];for(var i=0;i<lenSel;i++){if(selItems[i]){ids[i]=encodeBrowsePathElement(selItems[i][vf]);names[i]=selItems[i]["n"];}}selItem.n=selItem.desc=names.join(LM.ELE_FILTER_ATT_DELIM);selItem[vf]=ids.join(LM.ELE_FILTER_ATT_DELIM);selItem.isMultiElems=true;}if(selItem&&(!selItem.isMultiElems)){path+=encodeBrowsePathElement(selItem[vf]);}else{path+=selItem&&selItem[vf];}if(path){path+=LM.HIERARCHY_PATHDELIM;}path+=encodeBrowsePathElement(itemId);var browsedItems=[selItem,drillPath],bSearchRequired=false;if(!!this.props.elementSearchRequired&&!this.props.searchPattern){if(drillPath.tp==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE){bSearchRequired=!!browsedItems[0]&&(browsedItems[0]["tp"]==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY);}}if(bSearchRequired){this._loadResults({browsedItems:browsedItems,browsedItemsSiblings:null,listItems:[],totalSize:0,blockBegin:1});}else{return this.browseHierarchyBlock(path,1,"",{commandId:"BrowseHierarchyItem",items:browsedItems});}return false;};mstr.models.ListModel.prototype.canAutoExpandOnDrill=function LM_canAEonDrill(){var ae=this.props.autoExpandOnDrill;return(ae===false||ae===true)?ae:mstr.Settings.DataExplorer.AUTOEXPANDONDRILL;};mstr.models.ListModel.prototype._buildHierarchyPathForNode=function LM_buildHIPathForNode(node){var LM=mstr.models.ListModel;var path=[],vf=this.props.valueForm,item,tp,filter;while(node){item=node.value;if(!item){break;}tp=parseInt(item.tp);switch(tp){case mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE:if(filter){path.unshift(encodeBrowsePathElement(item[vf])+LM.ELE_FILTER_ATT_DELIM+encodeBrowsePathElement(filter[vf]));filter=null;break;}case mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY:case mstr.Enum.MSTRFolderItem.TYPE.ELEMENT:if(tp==mstr.Enum.MSTRFolderItem.TYPE.ELEMENT&&!!item.isMultiElems){path.unshift(item[vf]);}else{path.unshift(encodeBrowsePathElement(item[vf]));}filter=null;break;case mstr.Enum.MSTRFolderItem.TYPE.FILTER:filter=item;break;case mstr.Enum.MSTRFolderItem.TYPE.PROJECT:case mstr.Enum.MSTRFolderItem.TYPE.FOLDER:default:tp=null;node=null;filter=null;break;}if(tp==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY){break;}node=node&&node.parent;}return path.join(mstr.models.ListModel.HIERARCHY_PATHDELIM);};mstr.models.ListModel.prototype.canBrowseHierarchy=function LM_canBrowseHierarchy(item){if(item){switch(parseInt(item.tp)){case mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY:return true;case mstr.Enum.MSTRFolderItem.TYPE.ELEMENT:if(this.props.leafElements){return false;}break;case mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE:if(item.locked){return false;}break;case mstr.Enum.MSTRFolderItem.TYPE.FILTER:break;default:return false;}var cn=this.getContainer();if(cn){if(cn.isWithinHierarchy==null){cn.isWithinHierarchy=!!mstr.utils.ListViewHelper.isWithinHierarchy(cn);}return cn.isWithinHierarchy;}}return false;};mstr.models.TreeCart=(function(){mstr.$O.extendsClass(TC,mstr.models.AbstractCartBase);TC.prototype.init=function TC_init(){mstr.models.AbstractCartBase.prototype.init.apply(this);this.updateCommandEnabledAdd();this.updateCommandEnabledRemove();this.updateCommandEnabledRemoveAll();var av=this.props.available;if(av){av.attachEventListener(this,"hashadd_selections","updateCommandEnabledAdd");av.attachEventListener(this,"hashremove_selections","updateCommandEnabledAdd");}var sel=this.props.selected;if(sel){sel.attachEventListener(this,"listadd_items","onAddRemoveItemsInSelectedModel");sel.attachEventListener(this,"listremove_items","onAddRemoveItemsInSelectedModel");sel.attachEventListener(this,"hashadd_selectedIndices","updateCommandEnabledRemove");sel.attachEventListener(this,"hashremove_selectedIndices","updateCommandEnabledRemove");}};TC.prototype.onAddRemoveItemsInSelectedModel=function TC_onAddRmvInSel(){this.updateCommandEnabledRemoveAll();var max=Math.max(0,parseInt(this.props.max)||0);if(max){this.updateCommandEnabledAdd();}};TC.prototype.execAdd=function TC_execAdd(){var allowedCount=this._computeAllowedAddCount();if(!allowedCount){return ;}var avModel=this.props.available;var avNodes=avModel&&avModel.getSelectedNodes();var avCount=mstr.$H.len(avNodes);if(!avCount){return ;}var addableInfo=this._findAddableNodes(mstr.$A.fromHashValues(avNodes),allowedCount);if(addableInfo.count){this._addItemsToSelectedModel(addableInfo.itemsToAdd);var nextNode=mstr.utils.Trees.nextSibling(addableInfo.nodesToAdd.pop());if(nextNode){avModel.execCommand("SingleSelect",nextNode);}}};TC.prototype.execRemove=function TC_execRemove(){var selModel=this.props.selected;if(!selModel){return ;}var selIndices=selModel.getSelectedIndices();var selCount=mstr.$H.len(selIndices);if(!selCount){return ;}var arrIndices=mstr.$A.fromHashKeys(selIndices,true);selModel.removeItemsAt(arrIndices,false);};TC.prototype.execRemoveAll=function TC_execRemoveAll(){var selModel=this.props.selected;if(!selModel){return ;}var selItems=selModel.getItems();var selCount=mstr.$A.len(selItems);if(!selCount){return ;}var range={min:0,max:selCount-1};selModel.removeItemsAtRanges([range],true);};TC.prototype.updateCommandEnabledAdd=function TC_upCEAdd(){var bAddEnabled=true;if(!this.props.allowAddAlways&&this._hasMetAddMax()){bAddEnabled=false;}else{var av=this.props.available;if(!av||!this._findAddableItem(av.getSelectedItems())){bAddEnabled=false;}}this.set("CommandEnabledAdd",bAddEnabled);};TC.prototype._findAddableNodes=function LC_findAddableNodes(nodes,maxCount){var result={nodesToAdd:[],itemsToAdd:[],count:0,container:null};var lm=this.props.selected;if(!lm){return result;}var item;for(var i=0,len=mstr.$A.len(nodes);i<len;i++){item=nodes[i]&&nodes[i].value;if(mstr.utils.ListModelHelper.canAdd(this,item)){if(lm.indexOfItem(item)<0){result.nodesToAdd[result.count]=nodes[i];result.itemsToAdd[result.count]=item;result.count++;if(result.count==maxCount){break;}}}}return result;};function TC(props){mstr.models.AbstractCartBase.apply(this,[props]);}return TC;})();mstr.models.PromptQuestion=(function(){mstr.$O.extendsClass(PQ,mstr.models.BaseModel);PQ.prototype.execFetchData=function PQ_execFetchData(){var a=this.props.answer;if(a&&a.execCommand){return a.execCommand("FetchData");}return false;};PQ.prototype.execLoadSavedAnswer=function PQ_execLoadSavedAnswer(selectedAnswer){if(selectedAnswer){var inputs=new mstr.http.LoadPromptAnswerRequestInputs(selectedAnswer);var memo={commandId:"LoadSavedAnswer",answer:selectedAnswer};return this.submitRequest(inputs,memo);}return false;};PQ.prototype.loadRequestResponse=function PQ_loadRequestResponse(){var ctxt=this.props.requestContext;var res=ctxt&&ctxt.response;var memo=ctxt&&ctxt.memo;if(!res||!res.data){this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);return ;}this.get("answer").reloadAnswer(res.data);if(memo&&memo.answer){this.get("answer").set("container",memo.answer);}this.props.requestContext={};this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);};PQ.prototype.init=function PQ_init(){mstr.models.BaseModel.prototype.init.apply(this);var ans=this.props.answer;if(!ans){return ;}var type=this.props.type;if(!ans.props.type){ans.props.type=type;}var sel=ans.props.selected;if(sel&&!sel.props.type){sel.props.type=type;}};function PQ(props){mstr.models.BaseModel.apply(this,[props]);}return PQ;})();mstr.models.DateTimeConstantPromptAnswerPlugIn=(function(){var DTCPA={};DTCPA.init=function DTCPA_init(){this.on_set_valueString();};DTCPA.getCalendar=function DTCPA_getCalendar(){var cal=this.props.calendar;if(!cal){this.getCalendarTimePicker();var monthDescs={"0":"Jan","1":"Feb","2":"Mar","3":"Apr","4":"May","5":"Jun","6":"Jul","7":"Aug","8":"Sep","9":"Oct","10":"Nov","11":"Dec"},dayDescs={"0":"S","1":"M","2":"T","3":"W","4":"T","5":"F","6":"S","7":"S"},json={scriptClass:"mstr.models.Calendar",dateFormat:this.props.dateFormat||mstr.Settings.Locale.DATEOUTPUTFORMAT,firstDayOfWeek:(this.props.firstDayOfWeek!=null)?this.props.firstDayOfWeek:1,TwoDigitStart:mstr.Settings.Locale.TWODIGITYEARSTART,monthDescs:this.props.monthDescs||mstr.Settings.Locale.MONTHNAME_FULL||monthDescs,dayDescs:this.props.dayDescs||dayDescs,valueString:this.props.dateString,message:mstr.Settings.Locale.YEAR_WARNING};cal=this.props.calendar=new mstr.models.Calendar(json);if(cal){mstr.controllers.Factory.add(cal);if(cal.init){cal.init();}cal.props.parent=this;}cal.attachEventListener(this,"set_valueString","_copyDateStringFromCal");}return cal;};DTCPA.getTimePicker=function DTCPA_getTimePkr(){var tp=this.props.timePicker;if(!tp){this.getCalendarTimePicker();var json={scriptClass:"mstr.models.TimePicker",timeFormat:this.props.timeFormat||mstr.Settings.Locale.TIMEOUTPUTFORMAT,timeDescs:this.props.timeDescs,valueString:this.props.timeString};tp=this.props.timePicker=new mstr.models.TimePicker(json);if(tp){mstr.controllers.Factory.add(tp);if(tp.init){tp.init();}tp.props.parent=this;}tp.attachEventListener(this,"set_valueString","_copyTimeStringFromPicker");}return tp;};DTCPA._copyDateStringFromCal=function DTCPA_copyDSFromCal(){if(this.get("initializing")){return ;}var cal=this.props.calendar;if(cal&&cal.props){this.set("dateString",cal.props.valueString);}};DTCPA._copyTimeStringFromPicker=function DTCPA_copyTSFromPkr(){if(this.get("initializing")){return ;}var tp=this.props.timePicker;if(tp&&tp.props){this.set("timeString",tp.props.valueString);}};DTCPA.on_set_valueString=function DTCPA_on_set_vs(){this.set("initializing",true);var enDT=mstr.Enum.Nodes.DATATYPE,dateStr=this._getLastDateTimeValue(true),timeStr=this._getLastDateTimeValue(false);this.set("dateString",dateStr);this.set("timeString",timeStr);var c=this.props.calendar;if(c&&c.set){c.set("valueString",dateStr||"");}var tp=this.props.timePicker;if(tp&&tp.set){tp.set("valueString",timeStr);}this.set("initializing",false);};DTCPA.on_set_dateString=function DTCPA_on_set_dateString(){if(this.get("initializing")){return ;}this._recalcDateTimeValueString(true);if(mstr.Settings.Prompts.VALIDATIONLEVEL){this.validate({stage:mstr.Enum.Validation.Prompt.Stage.LOSTFOCUS});}};DTCPA.on_set_timeString=function DTCPA_on_set_timeString(){if(this.get("initializing")){return ;}this._recalcDateTimeValueString(false);if(mstr.Settings.Prompts.VALIDATIONLEVEL){this.validate({stage:mstr.Enum.Validation.Prompt.Stage.LOSTFOCUS});}};DTCPA._recalcDateTimeValueString=function DTCPA_updateValueString(whichPartChanged){var props=this.props;var enDT=mstr.Enum.Nodes.DATATYPE;switch(props.dataType){case enDT.DATE:if(props.multiSelect){if(whichPartChanged){this.set("valueString",mstr.utils.QualNode.addConstValue2List(props.valueString,props.dateString,props.exprModelType));}}else{this.set("valueString",props.dateString);}break;case enDT.TIME:case enDT.TIMESTAMP:default:var multiSelect=props.multiSelect;if(!multiSelect||mstr.utils.String.isEmpty(props.valueString)){var concat=props.dateString&&props.timeString?props.dateString+" "+props.timeString:props.dateString||props.timeString;this.set("valueString",concat);}else{var newValueString;if(whichPartChanged){var newVal=props.dateString&&props.timeString?props.dateString+" "+props.timeString:props.dateString||props.timeString;newValueString=mstr.utils.QualNode.addConstValue2List(props.valueString,newVal,this.props.exprModelType);}else{var arr=mstr.utils.QualNode.constValue2Array(props.valueString,true,this.props.exprModelType),lastDelimValue=arr.pop(),lastInfo=mstr.utils.LocaleParser.parseDateAndOrTime(lastDelimValue),lastDateString=lastInfo&&lastInfo.date&&lastInfo.date.match||"",newLastDelimValue=lastDateString?lastDateString+" "+props.timeString:props.timeString;arr.push(newLastDelimValue);newValueString=mstr.utils.QualNode.constArray2Value(arr,true,this.props.exprModelType);}this.set("valueString",newValueString);}break;}return ;};DTCPA._getLastDateTimeValue=function DTCPA_getLastDateTimeValue(whichPart){var props=this.props,s=props.valueString;if((s!=null)&&props.multiSelect){var valueArray=mstr.utils.QualNode.constValue2Array(s,true,this.props.exprModelType);s=valueArray.pop();}if(s==null){return null;}var dateTimeInfo=mstr.utils.LocaleParser.parseDateAndOrTime(s),key=whichPart?"date":"time";return dateTimeInfo&&dateTimeInfo[key]&&dateTimeInfo[key].match;};return DTCPA;})();mstr.models.ListPromptAnswer=(function(){mstr.$O.extendsClass(LPA,mstr.models.PromptAnswer);LPA.prototype._initSelectedModel=function LPA_iSM(){if(this.props.selected){return ;}var props={parent:this,valueForm:this.props.available&&this.props.available.get("valueForm")};var lm=this.props.selected=new mstr.models.ListModel(props);if(!lm){return ;}mstr.controllers.Factory.add(lm);lm.init&&lm.init();};LPA.prototype.reloadAnswer=function LPA_reloadAnswer(newAnswer){this.set("isComplex",newAnswer.props.isComplex);var lm=this.props.selected;if(!lm){return ;}var m=newAnswer&&newAnswer.get("selected"),newItems=m&&m.getItems();if(newItems){lm.setItems(newItems);var lc=this.props.listCart;if(lc){lc._updateAvailableFilteredItems();}if(!lc&&!this.props.availableTree){this._initAvailableModelSelections();}}};LPA.prototype.isEmpty=function LPA_isEmpty(){if(this.props.isComplex){switch(this.props.complexString){case"":case null:case undefined:return true;default:return false;}}else{if(this.props.listCart||this.props.treeCart){var items=this.props.selected&&this.props.selected.getItems();return(items&&items[0])?false:true;}else{var av=this.props.available,avItems=av&&av.getItems();if(!avItems||!avItems.length){return !(av.get("keptSelections")&&(av.get("keptSelections").length>0));}else{var indices=this.props.available&&this.props.available.getSelectedIndices();var res=mstr.$H.isEmpty(indices);if(!res&&mstr.$H.len(indices)==1){var vlFrm=av.get("valueForm");res=(vlFrm=="dssid"&&avItems[av.getSelectedIndex()][vlFrm]=="0")?true:false;}if(res&&this.get("_internalComplex")){var items=this.props.selected&&this.props.selected.getItems();res=(items&&items[0])?false:true;}return res;}}}};LPA.prototype._initAvailableModelSelections=function LPA_iAMS(){var av=this.props.available;if(!av){return ;}av.set("keepFolders",av.get("keepFolders")||(this.get("allowNavAboveSearchRoot")!=3));var selItems=this.props.selected&&this.props.selected.props.items;if(selItems&&selItems.length){var avItems=av.getItems();if(!avItems||!avItems.length){av.set("keptSelections",[].concat(selItems));}else{var results=av.indexOfMultiple(selItems,false);if(results.foundCount){av.execCommand("Select",mstr.$A.toHash(results.indices));}var displayStyle=this.get("parent")&&this.get("parent").get("displayStyle");var isTreeOrCart=mstr.Enum.Prompts.DISPLAYSTYLE.TREE===displayStyle||mstr.Enum.Prompts.DISPLAYSTYLE.CART===displayStyle;if(isTreeOrCart&&results.foundCount<selItems.length){this.set("_internalComplex",true);}}}if(mstr.$H.isEmpty(av.getSelectedIndices())){var ds=av.props.defaultSelection;if(ds==1){av.execCommand("SingleSelect",(av.get("prefixItems")&&av.get("prefixItems").length)||0);}else{if(ds==2){var itemsLen=av.getItems()&&av.getItems().length,prefixItemsLen=av.get("prefixItems")&&av.get("prefixItems").length;if(itemsLen&&(!prefixItemsLen||(itemsLen>prefixItemsLen))){av.execCommand("SingleSelect",av.getItems().length-1);}}else{if(((this.props.min||this.props.required)&&(av.getItems&&av.getItems()&&(av.getItems().length==1)))||(av.props.prefixItems&&av.props.prefixItems.length)){var displayStyle=this.get("parent")&&this.get("parent").get("displayStyle");var isTreeOrCart=mstr.Enum.Prompts.DISPLAYSTYLE.TREE===displayStyle||mstr.Enum.Prompts.DISPLAYSTYLE.CART===displayStyle;if(!isTreeOrCart){av.execCommand("SingleSelect",0);}}}}}};LPA.prototype.getListCartModel=function LPA_getListCartModel(){if(!this.props.listCart){this._initListCartModel();}return this.props.listCart;};LPA.prototype._initListCartModel=function LPA_initListCartModel(){var av=this.props.available;if(av){av.detachEventListener(this,"hashadd_selectedIndices");av.detachEventListener(this,"hashremove_selectedIndices");if(mstr.$H.isEmpty(av.getSelectedIndices())&&mstr.$A.len(av.getItems())){av.execCommand("SingleSelect",0);}}var props={parent:this,min:this.props.min||Math.abs(!!this.props.required),max:this.props.max,available:this.props.available,selected:this.props.selected,allowedItemFormName:this.props.allowedItemFormName,allowedItemFormValues:this.props.allowedItemFormValues,prohibitedItemFormValues:this.props.prohibitedItemFormValues,keepAvailableItems:this.props.keepAvailableItems,keepAvailableSorted:this.props.keepAvailableSorted,allowAddAlways:this.props.allowAddAlways};var lc=this.props.listCart=new mstr.models.ListCart(props);mstr.controllers.Factory.add(lc);lc&&lc.init&&lc.init();};LPA.prototype.getTreeModel=function LPA_getTreeModel(){if(!this.props.availableTree){this._initTreeModel();}return this.props.availableTree;};LPA.prototype._initTreeModel=function LPA_initTreeModel(){if(this.props.available){var av=this.props.available;av.detachEventListener(this,"hashadd_selectedIndices");av.detachEventListener(this,"hashremove_selectedIndices");if(mstr.$H.isEmpty(av.getSelectedIndices())&&mstr.$A.len(av.getItems())){av.execCommand("SingleSelect",0);}var tm=this.props.availableTree=new mstr.models.TreeModel({parent:this,valueForm:this.props.available.get("valueForm")});mstr.controllers.Factory.add(tm);tm.importListModel(this.props.available);tm&&tm.init&&tm.init();}};LPA.prototype.getTreeCartModel=function LPA_getTreeCartModel(){if(!this.props.treeCart){this._initTreeCartModel();}return this.props.treeCart;};LPA.prototype._initTreeCartModel=function LPA_initTreeCartModel(){var props={parent:this,min:this.props.min||Math.abs(!!this.props.required),max:this.props.max,available:this.getTreeModel(),selected:this.props.selected,allowedItemFormName:this.props.allowedItemFormName,allowedItemFormValues:this.props.allowedItemFormValues,prohibitedItemFormValues:this.props.prohibitedItemFormValues,allowAddAlways:this.props.allowAddAlways};var tc=this.props.treeCart=new mstr.models.TreeCart(props);mstr.controllers.Factory.add(tc);tc&&tc.init&&tc.init();};LPA.prototype.getValueString=function LPA_getValueString(){if(this.props.isComplex){return null;}return mstr.utils.UpdateManagerHelper.serializeObjectList(this.getSelected());};LPA.prototype.getSelected=function LPA_getSelected(){if(this.props.isComplex){return null;}var displayStyle=this.get("parent")&&this.get("parent").get("displayStyle");var isTreeOrCart=mstr.Enum.Prompts.DISPLAYSTYLE.TREE===displayStyle||mstr.Enum.Prompts.DISPLAYSTYLE.CART===displayStyle;if(this.props.listCart||this.props.treeCart||isTreeOrCart){var items=this.props.selected&&this.props.selected.getItems();}else{var bSort=!!this.get("sortResult");var items=this.props.available&&this.props.available.getSelectedItems(bSort);if(this.get("_internalComplex")){items=this.props.selected&&this.props.selected.getItems();}}return items;};LPA.prototype._validateInternally=function LPA_validateInternally(context){var status={statusCode:mstr.Enum.Validation.STATUSCODE.VALID,context:context&&context.stage};var checkingSavedAnswer=this.get("parent")&&this.get("parent").get("savingAnswer");if(!this.props.isComplex&&(this.props.required||this.props.min||this.props.max)){var selectionCount=0;if(this.props.listCart||this.props.treeCart){selectionCount=mstr.$A.len(this.props.selected&&this.props.selected.getItems());}else{if(this.props.availableTree){selectionCount=mstr.$H.len(this.props.availableTree.getSelectedNodes());}else{var av=this.props.available;if(av&&av.props&&(av.props.totalSize!=null)&&mstr.$A.len(av.props.items)){selectionCount=mstr.$H.len(av.getSelectedIndices());if(this.get("_internalComplex")){selectionCount=mstr.$A.len(this.props.selected&&this.props.selected.getItems());}}else{selectionCount=mstr.$A.len(this.props.selected&&this.props.selected.getItems());}}}var sc=mstr.utils.Math.inNumericRange(selectionCount,this.props.min?this.props.min:(this.props.required?1:0),this.props.max);if(sc){if((sc<0)&&!this.props.min){status.statusCode=mstr.Enum.Validation.STATUSCODE.NO_INPUT;}else{status.statusCode=(sc>0)?mstr.Enum.Validation.STATUSCODE.EXCEEDS_MAX_COUNT:mstr.Enum.Validation.STATUSCODE.EXCEEDS_MIN_COUNT;}}}if(status.statusCode==mstr.Enum.Validation.STATUSCODE.VALID&&checkingSavedAnswer){status.statusCode=this.validateSavedAnswer();}return status;};LPA.prototype.execFetchData=function LPA_execFetchData(){var av=this.props.available;if(av&&av.shouldFetchData()){var rs;var avt=this.props.availableTree;if(avt){rs=avt.get("readyState");if(rs==null||rs==mstr.Enum.Widget.READYSTATE.IDLE){return avt.execCommand("FetchFirst",avt.getSelectedNode());}}else{rs=av.get("readyState");if(rs==null||rs==mstr.Enum.Widget.READYSTATE.IDLE){return av.execCommand("FetchFirst");}}}return false;};LPA.prototype.init=function LPA_init(){mstr.models.BaseModel.prototype.init.apply(this);this._initSelectedModel();this._initAvailableModelSelections();var av=this.props.available;if(av){av.attachEventListener(this,"loadRequestResponse","_initAvailableModelSelections");av.attachEventListener(this,"hashadd_selectedIndices","autoValidateCheck");av.attachEventListener(this,"hashremove_selectedIndices","autoValidateCheck");}var sel=this.props.selected;if(sel){sel.attachEventListener(this,"listadd_items","autoValidateCheck");sel.attachEventListener(this,"listremove_items","autoValidateCheck");}};LPA.prototype.autoValidateCheck=function LPA_autoValidateCheck(){if(mstr.Settings.Prompts.VALIDATIONLEVEL>=mstr.Enum.Prompts.VALIDATIONLEVEL.AFTERANSWEREACH){this.validate({stage:mstr.Enum.Validation.Prompt.Stage.CHANGEANSWER});}};function LPA(props){mstr.models.PromptAnswer.apply(this,[props]);}return LPA;})();mstr.models.ReportInstance=(function(){mstr.$O.extendsClass(RI,mstr.models.BaseModel);RI.prototype.format=function RI_format(){return this._formatOrValidate(true);};RI.prototype.validate=function RI_validate(){return this._validateOrFormat(true);};RI.prototype._formatOrValidate=function RI_fmtOrValid(bFormat){var context={stage:mstr.Enum.Validation.Prompt.Stage.RUNREPORT},status={statusCode:mstr.Enum.Validation.STATUSCODE.VALID,context:context&&context.stage};var pqs=this.props.promptQuestions.getItems();var len=mstr.$A.len(pqs);var validation,methodName=bFormat?"format":"validate";for(var i=0;i<len;i++){var pq=pqs[i],pqa=pq&&pq.props.answer;validation=pqa&&pqa[methodName]&&pqa[methodName](context);if(validation&&validation.statusCode!=mstr.Enum.Validation.STATUSCODE.VALID){status.statusCode=validation;}}this.set("validationStatus",status);return status.statusCode;};RI.prototype.init=function RI_init(){mstr.models.BaseModel.prototype.init.apply(this);var pqs=this.props.promptQuestions.getItems();var len=mstr.$A.len(pqs);if(!len){return ;}var validation;for(var i=0;i<len;i++){var pq=pqs[i];var ans=pq&&pq.props.answer;if((ans.get&&ans.get("validationStatus")&&ans.get("validationStatus").statusCode)==mstr.Enum.Validation.STATUSCODE.INVALID){validation=ans.get("validationStatus").statusCode;}else{ans.validate({stage:mstr.Enum.Validation.Prompt.Stage.INIT});}}};RI.prototype.getPromptQuestionsSummaryModel=function RI_getPQSummaryModel(){var pqs=this.props.promptQuestions,ps=pqs&&pqs.props&&mstr.$H.clone(pqs.props);ps.id=null;ps.parent=this;ps.selectedIndices=mstr.$H.clone(pqs.props.selectedIndices);ps.selectedIndicesList=null;var m=new mstr.models.ListModel(ps);if(!m){return ;}mstr.controllers.Factory.add(m);m.init&&m.init();return m;};RI.prototype.execApplyPromptAnswers=function RI_execApplyPromptAnswers(){this.set("CommandEnabledApplyPromptAnswers",false);var eps=this.props.extendedProperties;var htmlForm=eps.updateManagerFormId?document.getElementById(eps.updateManagerFormId):null;if((htmlForm&&htmlForm.id=="PromptForm"&&typeof (validateInputs)=="function"&&!validateInputs(htmlForm))||!this._addAnswerAllPromptsAnswers()){this.set("CommandEnabledApplyPromptAnswers",true);return ;}if(htmlForm){var target=eps.updateManagerFormTarget;if(target!=null){htmlForm.target=target;}var names=eps.updateManagerFormRemoveInputNames;if(names){mstr.utils.Dom.removeFormInputNames(htmlForm,names);}}var umh=mstr.utils.UpdateManagerHelper;umh.submitFormToUpdateManager(htmlForm,true);};RI.prototype._addAnswerAllPromptsAnswers=function RI_addAnswerAllPromptsAnswers(execFlags){if(!this.checkFormatAndValidation()){this._selectFirstInvalidPrompt();return false;}this._submitAnswersToUpdateManager();var eps=this.props.extendedProperties;var messageNameModel=this.props.messageName;var historyListMsgName=messageNameModel&&messageNameModel.getValueString();var args=["8255"];var argVals=[true];if(historyListMsgName){args.push("8254");argVals.push(historyListMsgName);}if(execFlags){args.push("8258");argVals.push(execFlags);}microstrategy.updateManager.add([microstrategy.updateManager.createActionObject(null,mstrUpdateManager.PROMPTS_EVENT_ANSWER_ALL_PROMPTS,eps&&eps.beanPath,args,argVals)]);return true;};RI.prototype.execSavePromptAnswers=function RI_execSavePromptAnswers(){if(!this._addAnswerAllPromptsAnswers(65536)){return ;}var eps=this.props.extendedProperties;var evtCode=mstr.utils.UpdateManagerHelper.getSaveEventCodeForBeanType(eps&&eps.beanType);if(evtCode!=null){var fromDesignMode=(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE)?"true":"false";microstrategy.updateManager.add([microstrategy.updateManager.createActionObject(null,evtCode,microstrategy.servletName,["3013","3109","3017","3159","3160"],["true","false",fromDesignMode,eps&&eps.ownerBeanPath,"true"])]);}mstr.utils.UpdateManagerHelper.submitFormToUpdateManager();};RI.prototype.checkFormatAndValidation=function RI_ckFmtValid(){if(mstr.Settings.Prompts.VALIDATIONLEVEL>=mstr.Enum.Prompts.VALIDATIONLEVEL.ATRUNREPORT){var validation;if(mstr.Settings.Prompts.AUTOFORMATLEVEL>=mstr.Enum.Prompts.AUTOFORMATLEVEL.BEFORERUNREPORT){validation=this.format&&this.format();}else{validation=this.validate&&this.validate();}if(validation&&validation.statusCode!=mstr.Enum.Validation.STATUSCODE.VALID){return false;}}return true;};RI.prototype.queryEnabledSavePromptAnswers=function(){return true;};RI.prototype.execCancelPrompt=function RI_execCancelPrompt(){var eps=this.props.extendedProperties;var evtCode=mstr.utils.UpdateManagerHelper.getCancelEventCodeForBeanType(eps&&eps.beanType,!!(eps&&eps.isReprompt));if(evtCode!=null){microstrategy.updateManager.add([microstrategy.updateManager.createActionObject(null,evtCode,eps&&eps.beanPath,[],[])]);}mstr.utils.UpdateManagerHelper.submitFormToUpdateManager();};RI.prototype.execValidateCurrentPrompt=function RI_execValidateCurrentPrompt(context){if(mstr.Settings.Prompts.VALIDATIONLEVEL>=mstr.Enum.Prompts.VALIDATIONLEVEL.ATRUNREPORT){var pqs=this.props.promptQuestions;if(pqs&&pqs.get("stack")){var pq=pqs.getSelectedItem();if(pq&&pq.props.answer&&pq.props.answer.validate){return(pq.props.answer.validate(context)==mstr.Enum.Validation.STATUSCODE.VALID);}}}return true;};RI.prototype.queryEnabledCancelPrompt=function RI_queryEnabledCancelPrompt(){return true;};RI.prototype._selectFirstInvalidPrompt=function RI__selectFirstInvalidPrompt(){var pqs=this.props.promptQuestions.getItems();var len=mstr.$A.len(pqs);if(!len){return ;}for(var i=0;i<len;i++){var pq=pqs[i];if(!pq){continue;}var status=pq.props.answer&&pq.props.answer.props.validationStatus&&pq.props.answer.props.validationStatus.statusCode;if(status!=mstr.Enum.Validation.STATUSCODE.VALID){this.props.promptQuestions.execCommand("SingleSelect",i);break;}}};RI.prototype._submitAnswersToUpdateManager=function RI__submitAnswersToUpdateManager(){var pqs=this.props.promptQuestions.getItems();var len=mstr.$A.len(pqs);if(!len){return ;}var UMH=mstr.utils.UpdateManagerHelper;for(var i=0;i<len;i++){var pq=pqs[i];if(!pq){continue;}var answerValueString=pq.props.answer&&pq.props.answer.getValueString();if(answerValueString!=null){var eps=pq.props.extendedProperties;var ansRes=pq.props.answerRestriction;var action=null;if(ansRes=="-1"){action=(pq&&pq.props.savingAnswer)?"add":null;}else{if(ansRes=="1"){action=(pq&&pq.props.savingAnswer)?"add":"del";}}var savedAnswer=(action==null)?null:pq.props.answer&&pq.props.answer.props.container;UMH.addPromptEvent(null,mstrUpdateManager.PROMPT_EVENT_ANSWER_PROMPT,eps&&eps.beanPath,["4098001","4098002","4098003","4098010","4098011","4098012","4098013","4098014","4098015"],[eps&&eps.answerOption,eps&&eps.answerFormat,answerValueString,savedAnswer?savedAnswer.n:"",savedAnswer?(savedAnswer.isDefault?"1":"0"):"0",savedAnswer?savedAnswer.dssid:"","",savedAnswer?(savedAnswer.isAutoClose?"1":"0"):"0",action],null,null,pq.props.index);}}};function RI(props){mstr.models.BaseModel.apply(this,[props]);}return RI;})();mstr.models.Calendar=(function(){mstr.$O.extendsClass(Calendar,mstr.models.BaseModel);Calendar.prototype.on_set_valueString=function Calendar_on_set_valueString(){this.setSelectedDateAsString(this.get("valueString"));};Calendar.prototype.updateValueString=function Calendar_updateValueString(){var selected=this.get("selectedDate");this.set("valueString",mstr.utils.LocaleParser.formatDateInfo(selected,mstr.Settings.Locale.DATEOUTPUTFORMAT));};Calendar.prototype.moveNext=function Calendar_moveNext(){var month=this.get("browseMonth").month;var year=this.get("browseMonth").year;year=(month==12)?year+1:year;month=(month==12)?1:month+1;this.set("browseMonth",{month:month,year:year});};Calendar.prototype.movePrev=function Calendar_movePrev(){var month=this.get("browseMonth").month;var year=this.get("browseMonth").year;year=(month==1)?year-1:year;month=(month==1)?12:month-1;this.set("browseMonth",{month:month,year:year});};Calendar.prototype.setBrowseMonth=function Calendar_setBrowseMonth(month){this.set("browseMonth",{month:parseInt(month),year:this.get("browseMonth").year});};Calendar.prototype.setBrowseYear=function Calendar_setBrowseYear(year){this.set("browseMonth",{month:this.get("browseMonth").month,year:parseInt(year)});};Calendar.prototype.initBrowseMonth=function Calendar_initBrowseMonth(){var props=this.props,dateInfo=props.selectedDate||props.minDate||props.maxDate;if(!dateInfo){var today=new Date();dateInfo={month:today.getMonth()+1,year:today.getFullYear()};}this.set("browseMonth",{month:dateInfo.month,year:dateInfo.year});};Calendar.prototype.setSelectedDateAsString=function Calendar_setSelectedDateAsString(formattedDate){if(formattedDate==null){return ;}var dateInfo=mstr.utils.LocaleParser.parseDate(formattedDate);if(dateInfo==null){var today=new Date();dateInfo={month:today.getMonth()+1,year:today.getFullYear()};this.set("selectedDate",null);this.set("browseMonth",{month:dateInfo.month,year:dateInfo.year});}else{this.set("selectedDate",{day:dateInfo.day,month:dateInfo.month,year:dateInfo.year});this.set("browseMonth",{month:dateInfo.month,year:dateInfo.year});}};Calendar.prototype.getSelectedDateAsString=function Calendar_getSelectedDateAsString(){return this.get("valueString");};Calendar.prototype.setMinDate=function Calendar_setMinDate(formattedDate){this._setDateInfoFromString(formattedDate,"minDate");};Calendar.prototype.setMaxDate=function Calendar_setMaxDate(formattedDate){this._setDateInfoFromString(formattedDate,"maxDate");};Calendar.prototype._setDateInfoFromString=function Calendar_setDIFromS(s,propName){if(s==null){return ;}var dateInfo=mstr.utils.LocaleParser.parseDate(s);if(dateInfo){this.set(propName,{month:dateInfo.month,day:dateInfo.day,year:dateInfo.year});}};Calendar.prototype.calBrowseDates=function Calendar_calBrowseDates(){var firstDayOfWeek=this.get("firstDayOfWeek");var firstDate=new Date(this.get("browseMonth").year,this.get("browseMonth").month-1,1);var leadingBlanks=(firstDate.getDay()-firstDayOfWeek+8)%7;this.set("browseDates",Calendar.calDatesOfMonth(firstDate,leadingBlanks));return leadingBlanks;};Calendar.prototype.isDateBetweenMinMax=function Calendar_isDateBetweenMinMax(year,month,day){if(day<0){return -1;}var minDate=this.get("minDate");var maxDate=this.get("maxDate");var lessThanMax=!maxDate||((year<maxDate.year)||(year==maxDate.year&&month<maxDate.month)||(year==maxDate.year&&month==maxDate.month&&day<=maxDate.day));if(!lessThanMax){return 1;}var greaterThanMix=!minDate||((year>minDate.year)||(year==minDate.year&&month>minDate.month)||(year==minDate.year&&month==minDate.month&&day>=minDate.day));if(!greaterThanMix){return -1;}return 0;};Calendar.prototype.isMonthBetweenMinMax=function Calendar_isMonthBetweenMinMax(year,month){var minDate=this.get("minDate");var maxDate=this.get("maxDate");var lessThanMax=!maxDate||((year<maxDate.year)||(year==maxDate.year&&month<=maxDate.month));var greaterThanMix=!minDate||((year>minDate.year)||(year==minDate.year&&month>=minDate.month));return lessThanMax&&greaterThanMix;};Calendar.prototype.isYearBetweenMinMax=function Calendar_isYearBetweenMinMax(year){var minDate=this.get("minDate");var maxDate=this.get("maxDate");var lessThanMax=!maxDate||(year<=maxDate.year);var greaterThanMix=!minDate||(year>minDate.year);return lessThanMax&&greaterThanMix;};Calendar.calDatesOfMonth=function Calendar_calDatesOfMonth(firstDate,leadingBlanks){var daysOfMonth=Calendar.getDaysOfMonth(firstDate);var trailingBlanks=6*7-leadingBlanks-daysOfMonth;var dates=new Array();for(var i=0,len=leadingBlanks;i<len;i++){dates.push("");}for(var i=0,len=daysOfMonth;i<len;i++){dates.push(""+(i+1));}for(var i=0,len=trailingBlanks;i<len;i++){dates.push("");}return dates;};Calendar.isLeapYear=function Calendar_isLeapYear(year){if(((year%4)==0)&&((year%100)!=0)||((year%400)==0)){return(true);}else{return(false);}};Calendar.getDaysOfMonth=function Calendar_getDaysOfMonth(date){month=date.getMonth()+1;year=date.getFullYear();switch(month){case 1:case 3:case 5:case 7:case 8:case 10:case 12:return 31;break;case 4:case 6:case 9:case 11:return 30;break;case 2:if(Calendar.isLeapYear(year)){return 29;}else{return 28;}}};Calendar.isDateValid=function Calendar_isDayValid(day,month,year){if(month<0||month>12){return false;}var date=new Date(year,month-1,1);if(day<0||day>Calendar.getDaysOfMonth(date)){return false;}return true;};Calendar.prototype.parseDate=function Calendar_parseDate(formattedDate){var pattern=this.get("dateFormat");var monthDescs=this.get("monthDescs");var twoDigitStart=this.get("TwoDigitStart")%100;if(mstr.utils.String.isEmpty(pattern)||mstr.utils.String.isEmpty(formattedDate)){return null;}pattern=pattern.replace(/(\W){1}/g,"\\$1");if(/MMM/.test(pattern)){for(var i in monthDescs){var regex=new RegExp(monthDescs[i],"gi");formattedDate=formattedDate.replace(regex,parseInt(i)+1);}}if(Calendar.isPatternValid(pattern,formattedDate)){var day=parseInt(formattedDate.match(pattern.replace(/d+/i,"(\\d+)").replace(/m+/i,"\\d+").replace(/y+/i,"\\d+"))[1],10);var month=parseInt(formattedDate.match(pattern.replace(/d+/i,"\\d+").replace(/m+/i,"(\\d+)").replace(/y+/i,"\\d+"))[1],10);var year=parseInt(formattedDate.match(pattern.replace(/d+/i,"\\d+").replace(/m+/i,"\\d+").replace(/y+/i,"(\\d+)"))[1],10);if(year>0&&year<=twoDigitStart){year=2000+year;}if(year>twoDigitStart&&year<100){year=1900+year;}if(Calendar.isDateValid(day,month,year)){return new Date(year,month-1,day);}}return null;};Calendar.prototype.formatDate=function Calendar_formatDate(date){var pattern=this.get("dateFormat");var monthDescs=this.get("monthDescs");var twoDigitStart=this.get("TwoDigitStart")%100;if(date==null||pattern==null){return null;}var day=date.getDate();var month=date.getMonth()+1;var year=date.getFullYear();var formattedDate=pattern;if(Calendar.isPatternValid(pattern)){return formattedDate.replace(/d+/i,replaceDay).replace(/m+/i,replaceMonth).replace(/y{2,}/i,replaceYear);}function replaceDay(dayString){dayString=dayString.toLowerCase();switch(dayString){case"d":return String(day);break;case"dd":default:if(day<10){return"0"+day;}else{return String(day);}}}function replaceMonth(monthString){monthString=monthString.toLowerCase();switch(monthString){case"m":return String(month);break;case"mm":if(month<10){return"0"+month;}else{return String(month);}break;case"mmm":return monthDescs[month-1];break;default:if(month<10){return"0"+month;}else{return String(month);}}}function replaceYear(yearString){yearString=yearString.toLowerCase();switch(yearString){case"y":return String(year);break;case"yy":return adjustTo2DigitYear(year);break;case"yyy":if(year<10){return"00"+year;}else{if(year<100){return"0"+year;}else{return String(year);}}break;case"yyyy":default:if(year<10){return"000"+year;}else{if(year<100){return"00"+year;}else{if(year<1000){return"0"+year;}else{return String(year);}}}}}function adjustTo2DigitYear(year){if(year<10){return"0"+year;}else{if(year>1900&&year<2000&&(year%100>twoDigitStart)){return String(year%100);}else{if(year>2000&&year<3000&&(year%100<10)){return"0"+String(year%100);}else{if(year>2000&&year<3000&&(year%100>10)){return String(year%100);}}}}}};Calendar.isPatternValid=function Calendar_isPatternValid(pattern,formattedDate){if(pattern.match(/[^mMdDyY\W]/)!=null){return false;}if(!pattern.match(/d+/ig)||pattern.match(/d+/ig).length!=1){return false;}else{pattern=pattern.replace(/d+/i,"(\\d+)");}if(!pattern.match(/m+/ig)||pattern.match(/m+/ig).length!=1){return false;}else{pattern=pattern.replace(/m+/i,"(\\d+)");}if(!pattern.match(/y+/ig)||pattern.match(/y+/ig).length!=1){return false;}else{pattern=pattern.replace(/y+/i,"(\\d+)");}if(formattedDate&&(!formattedDate.match(pattern)||formattedDate.match(pattern)[0]!=formattedDate)){return false;}return true;};function Calendar(props){mstr.models.BaseModel.apply(this,[props]);this.setSelectedDateAsString(this.get("valueString"));this.setMinDate(this.get("min"));this.setMaxDate(this.get("max"));this.initBrowseMonth();}return Calendar;})();mstr.models.TimePicker=(function(){mstr.$O.extendsClass(TimePicker,mstr.models.BaseModel);function From12To24(hour,isPM){if(isPM){return(hour==12)?hour:hour+12;}return(hour==12?0:hour);}function From24To12(hour){if(hour==12||hour==0){return 12;}return Padding2(hour%12);}function Padding2(number){if(parseInt(number)<10){return"0"+parseInt(number);}else{return String(number);}}function isDoubleBytes(localeId){var db=false;switch(localeId){case 1041:case 1042:case 1028:case 2052:case 3076:case 4100:case 5124:db=true;}return db;}TimePicker.prototype.getHourAsString=function TimePicker_getHourAsString(hour,military){if(!military){military=this.get("displayMilitary");}if(military){if(!hour){return"00";}return Padding2(hour);}else{var db=isDoubleBytes(mstr.Settings.Locale.ID),tDess=this.get("timeDescs"),hr=(hour)?(From24To12(hour)):"12",tDes=(hour)?tDess[(hour%24>=12)?1:0]:tDess[0];return(db)?(tDes+" "+hr):(hr+" "+tDes);}};TimePicker.prototype.getMinuteAsString=function TimePicker_getMinuteAsString(minute){if(!minute){return"00";}return Padding2(minute);};TimePicker.prototype.getSecondAsString=function TimePicker_getSecondAsString(second){if(!second){return"00";}return Padding2(second);};TimePicker.prototype.on_set_hour=TimePicker.prototype.on_set_minute=TimePicker.prototype.on_set_second=function TimePicker_on_set_hms(){if(this.get("initializing")){return ;}this.updateValueString();};TimePicker.prototype.updateValueString=function TimePicker_updateValueString(){var props=this.props,timeInfo={hour:Math.max(Number(props.hour)||0,0),min:Math.max(Number(props.minute)||0,0),sec:Math.max(Number(props.second)||0,0)};this.set("valueString",mstr.utils.LocaleParser.formatTimeInfo(timeInfo,mstr.Settings.Locale.TIMEOUTPUTFORMAT));};TimePicker.prototype.on_set_valueString=function TimePicker_on_set_valueString(timeValue){this.set("initializing",true);var timeInfo=mstr.utils.LocaleParser.parseTime(this.get("valueString"));timeInfo=timeInfo||{hour:-1,min:-1,sec:-1};this.set("hour",timeInfo&&timeInfo.hour||0);this.set("minute",timeInfo&&timeInfo.min||0);this.set("second",timeInfo&&timeInfo.sec||0);this.set("initializing",false);};TimePicker.prototype.validate=function TimePicker_validate(formattedTime){if(!formattedTime){return false;}var time=this.parseTime(formattedTime);if(!this.isTimeValid(time)){return false;}return true;};TimePicker.prototype.isTimeValid=function TimePicker_isTimeValid(time){if(!(time&&typeof (time)=="object"&&"hour" in time&&"minute" in time&&"second" in time)){return false;}if(time.hour>24||time.hour<0||time.minute>60||time.minute<0||time.second>60||time.second<0){return false;}return true;};TimePicker.prototype.parseTime=function TimePicker_parseTime(formattedTime){if(!formattedTime){return null;}var _result=null;var pattern=this.get("timeFormat");var timeDescs=this.get("timeDescs");if(mstr.utils.String.isEmpty(pattern)||mstr.utils.String.isEmpty(formattedTime)){return null;}if(TimePicker.isPatternValid(pattern,formattedTime,timeDescs)){var symbolPattern="(?:(?:"+timeDescs[0]+")|(?:"+timeDescs[1]+"))";pattern=pattern.replace(/(\W){1}/g,"\\$1");var hour=parseInt(formattedTime.match(pattern.replace(/h+/i,"(\\d+)").replace(/m+/i,"\\d+").replace(/s+/i,"\\d+").replace(/a/i,symbolPattern))[1],10);var minute=parseInt(formattedTime.match(pattern.replace(/h+/i,"\\d+").replace(/m+/i,"(\\d+)").replace(/s+/i,"\\d+").replace(/a/i,symbolPattern))[1],10);var second=parseInt(formattedTime.match(pattern.replace(/h+/i,"\\d+").replace(/m+/i,"\\d+").replace(/s+/i,"(\\d+)").replace(/a/i,symbolPattern))[1],10);if(formattedTime.match("(?:"+timeDescs[1]+")")){hour=From12To24(hour,true);}else{if(formattedTime.match("(?:"+timeDescs[0]+")")){hour=From12To24(hour,false);}}_result={hour:hour,minute:minute,second:second};if(this.isTimeValid(_result)){return _result;}}return null;};TimePicker.prototype.formatTime=function TimePicker_formatTime(time){if(!this.isTimeValid(time)){time={hour:0,minute:0,second:0};}var pattern=this.get("timeFormat");var timeDescs=this.get("timeDescs");if(pattern.match(/a+/i)){var isPM=(time.hour%24>=12);return pattern.replace(/h+/i,From24To12(time.hour)).replace(/m+/i,Padding2(time.minute)).replace(/s+/i,Padding2(time.second)).replace(/a+/i,isPM?timeDescs[1]:timeDescs[0]);}else{return pattern.replace(/h+/i,Padding2(time.hour)).replace(/m+/i,Padding2(time.minute)).replace(/s+/i,Padding2(time.second));}};TimePicker.isPatternValid=function TimePicker_isPatternValid(pattern,formattedTime,timeDescs){if(!pattern){return false;}if(pattern.match(/[^\Wahms]/i)){return false;}pattern=pattern.replace(/(\W){1}/g,"\\$1");if(!pattern.match(/h+/ig)||pattern.match(/h+/ig).length!=1){return false;}else{pattern=pattern.replace(/h+/i,"(\\d+)");}if(!pattern.match(/m+/ig)||pattern.match(/m+/ig).length!=1){return false;}else{pattern=pattern.replace(/m+/i,"(\\d+)");}if(!pattern.match(/s+/ig)||pattern.match(/s+/ig).length!=1){return false;}else{pattern=pattern.replace(/s+/i,"(\\d+)");}if(formattedTime){if(!(timeDescs&&timeDescs[0]&&timeDescs[1])){timeDescs={0:"AM",1:"PM"};}var symbolPattern="(?:(?:"+timeDescs[0]+")|(?:"+timeDescs[1]+"))";pattern=pattern.replace(/a/i,symbolPattern);if(!formattedTime.match(pattern)||formattedTime.match(pattern)[0]!=formattedTime){return false;}}return true;};TimePicker.prototype.initTimeFormat=function TimePicker_initTimeFormat(timeFormat){this.set("displayMilitary",isMilitaryFormat());this.set("timeDelimiter",timeFormat.match(/[^\sahms]/gi)[0]);var timeDescs=this.get("timeDescs");if(!(timeDescs&&timeDescs[0]&&timeDescs[1])||timeDescs[0].match(/\*/)){this.set("timeDescs",{0:"AM",1:"PM"});}if(!TimePicker.isPatternValid(timeFormat)){this.set("timeFormat","hh:mm:ss");}function isMilitaryFormat(){var now=new Date();now.setTime(Date.parse("January, 01 2006 13:00:00"));var str=now.toLocaleString();return(str.indexOf("13")>=0);}};function TimePicker(props){mstr.models.BaseModel.apply(this,[props]);this.initTimeFormat(this.get("timeFormat")?this.get("timeFormat"):"hh:mm:ss");this.set("initializing",true);if(!this.props.valueString){this.updateValueString();}else{this.on_set_valueString();}this.set("initializing",false);}return TimePicker;})();mstr.models.PromptSavedAnswers=(function(){mstr.$O.extendsClass(PSA,mstr.models.ListModel);PSA.prototype.execDeleteSelected=function LM_exDeleteSelected(){var answerToDelete=this.getSelectedItem();if(answerToDelete){var inputs=new mstr.http.DeletePromptAnswerRequestInputs(answerToDelete);var memo={commandId:"DeleteSavedAnswer",index:this.getSelectedIndex(),item:answerToDelete};this.submitRequest(inputs,memo);return true;}return false;};PSA.prototype.execRenameSelectedItem=function LM_exRenameItem(newName){var answerToRename=this.getSelectedItem();if(newName&&answerToRename){if(this.indexOfValue({value:newName,form:"n",ignoreCase:true})>-1){var descs=this.props.descriptors;this.set("message",descs&&descs.rejectDuplicatedNameWarning);this.set("validationStatus",{statusCode:mstr.Enum.Validation.STATUSCODE.DUPLICATED});return false;}else{var inputs=new mstr.http.RenamePromptAnswerRequestInputs(answerToRename,newName);var memo={commandId:"RenameSavedAnswer",index:this.getSelectedIndex(),newName:newName};this.submitRequest(inputs,memo);return true;}}return false;};PSA.prototype.loadRequestResponse=function PSA_loadRequestResponse(){var ctxt=this.props.requestContext;var res=ctxt&&ctxt.response;var memo=ctxt&&ctxt.memo;if(!memo||!memo.commandId||(memo.commandId!="DeleteSavedAnswer"&&memo.commandId!="RenameSavedAnswer")){mstr.models.ListModel.prototype.loadRequestResponse.apply(this);}else{switch(memo&&memo.commandId){case"DeleteSavedAnswer":mstr.models.ListModel.prototype.execDeleteSelected.apply(this);var currentAnswer=this.props.parent&&this.props.parent.props.answer;var curAnsCon=currentAnswer&&currentAnswer.props.container;if(curAnsCon&&curAnsCon.dssid==memo.item["dssid"]){curAnsCon.dssid="";}break;case"RenameSavedAnswer":mstr.models.ListModel.prototype.execRenameSelectedItem.apply(this,[memo.newName]);break;}this.props.requestContext={};this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);}};function PSA(props){mstr.models.ListModel.apply(this,[props]);}return PSA;})();mstr.behaviors.TextAreaWithImport=(function(){var TA={};TA.on_set_enabled=function TA_on_set_enabled(view,model,rootTag){var en=view.get("enabled");var cn=rootTag.childNodes;cn[2].childNodes[0].disabled=!en;};TA.on_set_importEnabled=function TA_on_set_importEnabled(view,model,rootTag){var enImport=view.get("importEnabled");var cn=rootTag.childNodes;cn[0].childNodes[0].childNodes[1].disabled=!enImport;};TA.onblur=function TA_onblur(viewId,elTextarea){var view=mstr.$obj(viewId),props=view&&view.props,model=props&&props.model;if(model){var changed=model.set("valueString",elTextarea.value);if(changed&&model.format){model.format({validateOnChange:props.validateOnChange,formatOnValidate:props.formatOnValidate});}}return true;};TA.on_model_set_readyState=function TA_on_model_set_readyState(view,model,rootTag){this._updateTextArea(view,model,rootTag);};TA.on_model_set_valueString=function TA_on_model_set_valueString(view,model,rootTag){this._updateTextArea(view,model,rootTag);};TA._updateTextArea=function TA_updateTA(view,model,rootTag){var bEnabled=true,txt="";var bImportEnabled=true;switch(model&&model.get("readyState")){case mstr.Enum.Widget.READYSTATE.WAITING:bEnabled=false;bImportEnabled=false;txt="Loading file...";break;case mstr.Enum.Widget.READYSTATE.ERROR:bEnabled=false;bImportEnabled=true;var ctxt=model&&model.props.requestContext,res=ctxt&&ctxt.response,msgDetail=res&&res.errorMessage,txt=msgDetail||"Error loading file contents.";break;case mstr.Enum.Widget.READYSTATE.TIMEOUT:bEnabled=false;bImportEnabled=true;txt="Request timed out.";break;case mstr.Enum.Widget.READYSTATE.CANCELLED:bEnabled=false;bImportEnabled=true;txt="Request cancelled.";break;default:bEnabled=true;bImportEnabled=true;txt=model.get("valueString")||"";break;}rootTag.childNodes[2].childNodes[0].value=txt;view.set("enabled",bEnabled);view.set("importEnabled",bImportEnabled);};TA.onClickSubmitButton=function TA_onClickSubmitButton(viewId,elInput,elForm){var view=mstr.$obj(viewId),model=view&&view.getModel();if(model&&elInput&&elForm){if(this._validateExtension(elInput,view.props.validFileExtensions,view.props.descriptors)){var ps=view.props;model.execCommand("ImportFile",{el:elForm,inputId:elInput.id,maxFileSize:ps.maxFileSize,maxElements:ps.maxElements,inputDelimiter:ps.inputDelimiter,outputDelimiter:ps.outputDelimiter});}}return true;};TA._validateExtension=function TA_vldExt(elInput,sValid,descs){var s=elInput&&elInput.value;if(s){if(!sValid){return true;}var j=s.lastIndexOf("."),ext=(j>-1)?s.substring(j+1):"";var hash=mstr.$A.toHash(sValid.split(","));if(hash[ext]){return true;}}alert(s?descs.invalidText.replace("##",sValid.replace(/\,/g,", "))+".":descs.emptyText);return false;};return TA;})();mstr.behaviors.ListHeaderView=(function(){var LHV={};LHV.on_model_set_item=function LHV_on_model_set_item(view,model,rootTag){var v=(model&&model.get&&model.get("item"))||model;var vis=v!=null&&v.tp==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE;var origHeight=mstr.utils.BoxModel.getElementOuterHeight(rootTag);view.set("visible",vis);var newHeight=mstr.utils.BoxModel.getElementOuterHeight(rootTag);if(vis){document.getElementById(view.props.id+"_txt").innerHTML=model.get("item")["n"];}var heightChanged=(origHeight!=newHeight);var enclosingListView=view.props.parent.props.scrollArea;if(heightChanged&&enclosingListView){var viewH=mstr.utils.BoxModel.getElementInnerHeight(enclosingListView);viewH+=origHeight-newHeight;enclosingListView.style.height=viewH+"px";}};return LHV;})();mstr.behaviors.TreePulldown=(function(){var TP={};TP.on_set_enabled=function TP_on_set_enabled(view,model,rootTag){var e=!!view.props.enabled;mstr.behaviors.Generic.set_enabled(rootTag,e);rootTag.style.color=(e)?"#000000":"#716f64";};return TP;})();mstr.behaviors.PromptQuestionSummary=(function(){var PQ={};PQ.on_model_set_answer=function PQ_on_model_set_answer(view,model,rootTag){var answer=model&&model.get("answer");var isRequired=!!(answer&&answer.get("required"));rootTag.childNodes[0].className=isRequired?(view.props.cssPrefix||"")+(view.props.cssClass||"")+"Required":"";var isComplex=!!(answer&&answer.get("isComplex"));var isEmpty=!!(answer&&answer.isEmpty());var sections=rootTag.childNodes[0].childNodes[1].childNodes;mstr.behaviors.Generic.set_css_display(sections[0],"block","none",!isEmpty&&!isComplex);mstr.behaviors.Generic.set_css_display(sections[1],"block","none",!isEmpty&&isComplex);mstr.behaviors.Generic.set_css_display(sections[2],"block","none",isEmpty);};return PQ;})();mstr.behaviors.PromptQuestion=(function(){var PQ={};PQ.on_set_visible=function PQ_on_set_visible(view,model,rootTag,context){var visible=!!view.props.visible;if(visible&&!rootTag.mstrInitialized){var parent=view.props[mstr.$W.PARENT];var siblings=parent&&parent.props.views;var pageNum=(mstr.$A.len(siblings)>1)?mstr.$A.find(siblings,view)+1:null;view.props.pageNum=pageNum||null;this._paintPageNum(rootTag,pageNum||null);this._paintBackToTop(view,rootTag);rootTag.mstrInitialized=true;}return mstr.behaviors.Generic.set_css_display(rootTag,"block","none",visible);};PQ.on_set_pageNum=function PQ_on_set_pageNum(view,model,rootTag){this._paintPageNum(rootTag,parseInt(view.props.pageNum));};PQ._paintPageNum=function PQ_paintPageNum(rootTag,pageNum){var elPageNum=rootTag.firstChild.firstChild.firstChild.rows[0].cells[0].firstChild;elPageNum.innerHTML=(pageNum>0)?pageNum+".":"";mstr.behaviors.Generic.set_css_display(elPageNum,"inline","none",pageNum>0);};PQ._paintBackToTop=function PQ_paintBack2Top(view,rootTag){var parent=view&&view.props&&view.props.parent,bShow=parent&&parent.props&&!parent.props.scriptClass.match(/Stack/);if(bShow){bShow=rootTag&&rootTag.previousSibling;}mstr.behaviors.Generic.set_css_display(rootTag.firstChild.firstChild.firstChild.rows[0].cells[1].firstChild,"inline","none",bShow);};PQ.onClickBackToTop=function PQ_clkBack2Top(viewId){var view=mstr.$obj(viewId),parent=view&&view.props&&view.props.parent,elParent=parent&&parent.props&&parent.props.element,parentParent=parent&&parent.props&&parent.props.parent,elParentParent=parentParent&&parentParent.props&&parentParent.props.element;if(elParentParent&&parentParent.props.scrollBrowser){scroll(0,getObjSumTop(elParentParent));}else{if(elParent){elParent.scrollTop=0;}}};PQ.on_model_set_isComplex=function PQ_on_model_set_isComplex(view,model,rootTag){var answer=model&&model.get("answer");var isComplex=!!(answer&&answer.get("isComplex"));var elRadio=isComplex?rootTag.childNodes[0].childNodes[2].childNodes[2].rows[0].cells[0].childNodes[0]:rootTag.childNodes[0].childNodes[2].childNodes[0].rows[0].cells[0].childNodes[0];elRadio.checked=true;};PQ.on_model_set_answer=function PQ_on_model_set_answer(view,model,rootTag){var answer=model&&model.get("answer");var isRequired=!!(answer&&answer.get("required"));rootTag.firstChild.className=isRequired?(view.props.cssPrefix||"")+(view.props.cssClass||"")+"Required":"";var isComplex=!!(answer&&answer.get("isComplex"));this.toggleComplexView(view,model,rootTag,isComplex);this.on_model_set_isComplex(view,model,rootTag);this.on_model_set_validationStatus(view,answer,rootTag);if(answer&&view){view._status_callback=this.view_status_callback;answer.attachEventListener(view,"set_validationStatus","_status_callback");}};PQ.view_message_callback=function(evt){var ps=this.props,rootTag=ps.element,model=ps.model,ans=model&&model.props.answer;mstr.behaviors.PromptQuestion.on_model_set_message(this,ans,rootTag);};PQ.view_status_callback=function(evt){var ps=this.props,rootTag=ps.element,model=ps.model,ans=model&&model.props.answer;mstr.behaviors.PromptQuestion.on_model_set_validationStatus(this,ans,rootTag);};PQ.on_model_set_validationStatus=function PQ_on_model_set_validationStatus(view,model,rootTag){var status=model&&model.get("validationStatus"),sc=status&&status.statusCode;var msg=(sc&&sc!=mstr.Enum.Validation.STATUSCODE.VALID&&!mstr.behaviors.PromptValidationHelper.showInvalid(status))?null:model&&model.get("message");this.update_div(msg,rootTag.childNodes[0].childNodes[1].rows[0].cells[0].childNodes[2]);};PQ.on_model_set_meaning=function PQ_on_model_set_meaning(view,model,rootTag){this.update_div(model&&model.get("meaning"),rootTag.childNodes[0].childNodes[1].rows[0].cells[0].childNodes[0]);};PQ.on_model_set_instructions=function PQ_on_model_set_instructions(view,model,rootTag){this.update_div(model&&model.get("instructions"),rootTag.childNodes[0].childNodes[1].rows[0].cells[0].childNodes[1]);};PQ.on_model_set_message=function PQ_on_model_set_message(view,model,rootTag){this.update_div(model&&model.get("message"),rootTag.childNodes[0].childNodes[1].rows[0].cells[0].childNodes[2]);};PQ.update_div=function PQ_update_div(s,el){if(s==null){s="";}el.innerHTML=s;mstr.behaviors.Generic.set_css_display(el,"block","none",s!="");};PQ.toggleComplexView=function PQ_toggleComplexView(view,model,rootTag,bShowComplex){var elContents=rootTag.childNodes[0].childNodes[2].childNodes;mstr.behaviors.Generic.set_css_display(elContents[0],"table","none",bShowComplex);mstr.behaviors.Generic.set_css_display(elContents[2],"table","none",bShowComplex);mstr.behaviors.Generic.set_css_display(elContents[3],"block","none",bShowComplex);elContents[1].style.paddingLeft=bShowComplex?elContents[3].style.paddingLeft:"0px";if(!bShowComplex){view.props.rendering=true;var elSimpleViewCheckbox=elContents[0].rows[0].cells[0].childNodes[0];elSimpleViewCheckbox.checked=true;view.props.rendering=false;}};PQ.onClickRadio=function(viewId,isComplex){var view=mstr.$obj(viewId);if(!view){return true;}if(view.props.rendering){return true;}var model=view.getModel();if(model){model=model.get("answer");}if(model){model.set("isComplex",!!isComplex);}return true;};return PQ;})();mstr.behaviors.PromptList=(function(){var TOC={};TOC.on_model_add_items=function TOC_on_model_add_items(view,model,rootTag,index){var tr=rootTag.childNodes[0].insertRow(index);tr.mstrListItemIndex=index;tr.onmouseover=this.hover;tr.onmouseout=this.unhover;var question=model&&model.get("items")[index];if(!question){return ;}var doc=rootTag.ownerDocument;var css=(view.props.cssPrefix||"")+(view.props.cssClass||"");var answer=question&&question.get("answer");var bRequired=!!(answer&&answer.get("required"));if(bRequired){tr.className=css+"ItemRequired";}td=tr.insertCell(0);td.className=css+"CellIndex";td.appendChild(doc.createTextNode(parseInt(index+1)+"."));td=tr.insertCell(1);td.className=css+"CellTitle";var title=question.get("title");td.appendChild(doc.createTextNode(title));td.title=title;if(bRequired){var el=td.appendChild(doc.createElement("span"));el.appendChild(doc.createTextNode(view.props.descriptors.required));el.className=(view.props.cssPrefix||"")+"Required";}td=tr.insertCell(2);td.className=css+"CellMessage";var divMessage=td.appendChild(doc.createElement("div"));divMessage.className=css+"ItemNoMessage";divMessage.innerHTML="&nbsp;";this.update_listItem_message(view,model,rootTag,index);};TOC.update_listItem_message=function TOC_update_listItem_message(view,model,rootTag,index){var doc=rootTag.ownerDocument;var question=model&&model.get("items")[index];var tr=rootTag.childNodes[0].rows[index];var td=tr&&tr.cells[2];var divMessage=td&&td.childNodes[0];if(!divMessage){return ;}var txtMessage=question&&question.get("message");if(txtMessage==null){txtMessage="";}divMessage.title=txtMessage;divMessage.className=(view.props.cssPrefix||"")+(view.props.cssClass||"")+((txtMessage!=null)?"Message":"NoMessage");};TOC.hover=function(){this.style.color="#0000ff";this.style.textDecoration="underline";};TOC.unhover=function(){this.style.color="#000000";this.style.textDecoration="none";};return TOC;})();mstr.behaviors.PromptTOC=(function(){var PTOC={};PTOC.on_set_visible=function PTOC_on_set_visible(view,model,rootTag,context){var vis=!!view.props.visible;var cn=rootTag.childNodes;rootTag.style.display="block";mstr.behaviors.Generic.set_css_display(cn[0],"none","block",vis);if(!vis||(context&&context.init)){mstr.behaviors.Generic.set_css_display(cn[1],"table","none",vis);mstr.behaviors.Generic.set_css_display(cn[2],"block","none",vis);this.set_childViews_vis(view);}if(context&&context.init){PTOC._updateParentNode(view);return ;}var callback=new Function("","mstr.behaviors.PromptTOC.on_after_set_visible('"+view.props.id+"')");rootTag.style.overflow="hidden";mstr.utils.Animations.resize(rootTag,vis?200:8,null,5,callback);};PTOC.on_after_set_visible=function PTOC_on_after_set_visible(viewId){var view=mstr.$obj(viewId);if(!view){return ;}var rootTag=view.props.element;var vis=!!view.props.visible;if(vis){var cn=rootTag&&rootTag.childNodes;mstr.behaviors.Generic.set_css_display(cn&&cn[1],"table","none",vis);mstr.behaviors.Generic.set_css_display(cn&&cn[2],"block","none",vis);this.set_childViews_vis(view);}PTOC._updateParentNode(view);var evt=new mstr.lang.CustomEvent(this,"resize");mstr.controllers.EventManager.notifyWindowListeners(evt);};PTOC._updateParentNode=function PTOC_updateParentNode(view){var parent=view.props.parent,autoResizeWidth=parent&&parent.props.autoResizeWidth;if(mstr.utils.ISIE4&&autoResizeWidth){var rootTag=view.props.element;var td=rootTag.parentNode;td.style.width=(view.props.visible?200:8)+"px";}};PTOC.set_childViews_vis=function PTOC_set_childViews_vis(view){if(!view){return ;}var vis=!!view.props.visible;var sb=view.props.summaryButton;if(sb){if(sb.set){sb.set("visible",vis);}else{sb.visible=vis;}}var cv=view.props.contentsView;if(cv){if(cv.set){cv.set("visible",vis);}else{cv.visible=vis;}}};PTOC.on_set_height=function PTOC_on_set_height(view,model,rootTag){var MIN_HEIGHT=1;var h=parseInt(view.props.height);if(!h){return ;}rootTag.style.height=Math.max(h,MIN_HEIGHT)+"px";};PTOC.on_set_height_old=function PTOC_on_set_height_old(view,model,rootTag){var MIN_HEIGHT_CONTENTSVIEW=20;var cv=view.props.contentsView;if(!cv){return ;}var h=parseInt(view.props.height);if(!h){return ;}var elSummaryButton=rootTag.childNodes[2];var hCV=Math.max(h-elSummaryButton.offsetTop-elSummaryButton.offsetHeight,MIN_HEIGHT_CONTENTSVIEW);if(cv.set){cv.set("height",hCV+"px");}else{cv.height=hCV+"px";}};return PTOC;})();mstr.behaviors.PromptEditor=(function(){var PE={};PE.MINIMUM_HEIGHT=125;PE.on_set_toc=function PE_on_set_toc(view,model,rootTag){if(!view.props.toc){var el=rootTag.rows[0].cells[0];el.style.borderWidth="0px";el.style.backgroundColor="transparent";rootTag.rows[1].cells[0].style.padding="3px";}};PE.on_set_showSummary=function PE_on_set_showSummary(view,model,rootTag){if(!view){return ;}var pq=model.get("promptQuestions");if(!!view.props.showSummary){mstr.controllers.Factory.setPath("book/visible",view,false,false);view.get("previousButton")&&mstr.controllers.Factory.setPath("previousButton/visible",view,false,false);view.get("nextButton")&&mstr.controllers.Factory.setPath("nextButton/visible",view,false,false);view.execCommand("ShowChild","closeSummaryButton");var summary=view.props.summary;if(summary&&summary.initModel){summary.initModel();}view.execCommand("ShowChild","summary");pq.set("previousSelection",pq.getSelectedIndex());pq.execClearSelect();}else{mstr.controllers.Factory.setPath("closeSummaryButton/visible",view,false,false);mstr.controllers.Factory.setPath("summary/visible",view,false,false);view.get("previousButton")&&mstr.controllers.Factory.setPath("previousButton/visible",view,true,false);view.get("nextButton")&&mstr.controllers.Factory.setPath("nextButton/visible",view,true,false);view.execCommand("ShowChild","book");var prevSel=pq.get("previousSelection");if(prevSel!=undefined){pq.execSingleSelect(prevSel);}}var toc=view.props.toc,tocProps=toc&&toc.props,tocElem=tocProps&&tocProps.element;if(tocElem){var sb=rootTag.ownerDocument.getElementById(tocProps.id+"_summaryButton");var cn=sb.className.replace("Selected","");cn=!!view.props.showSummary?cn+"Selected":cn;sb.className=cn;}};PE.on_set_height=function PE_on_set_height(view,model,rootTag){var h=parseInt(view.props.height);if(!h){return ;}var CELLSPACING=3;var adjustedHeight=h-CELLSPACING*(rootTag.rows.length+1);var rows=rootTag.rows,showsMessage=!!view.props.message;adjustedHeight-=this._bottomHeight(view,rootTag);var rowIndex=showsMessage?1:0;var cells=rootTag.rows[rowIndex].cells;cells[0].style.height=adjustedHeight+"px";cells[1].style.height=adjustedHeight+"px";if(mstr.utils.ISWK||mstr.utils.ISW3CIE){cells[1].childNodes[0].style.height=adjustedHeight+"px";}var toc=view.props.toc;if(toc){if(toc.set){toc.set("height",adjustedHeight+"px");}else{toc.height=adjustedHeight+"px";}}};PE._bottomHeight=function PE_bottomHeight(view,rootTag){var result=0;var rows=rootTag.rows,showsMessage=!!view.props.message,indexHLName=showsMessage?2:1,indexNavBar=showsMessage?3:2;var showsHLName=true,hlNameView=view.props.messageNameView;if(!hlNameView||(hlNameView.visible===false)||(hlNameView.props&&hlNameView.props.visible===false)){showsHLName=false;}if(showsMessage){result+=Math.max(rows[0].cells[0].offsetHeight,22);}if(showsHLName){result+=Math.max(rows[indexHLName].cells[0].offsetHeight,30);}result+=Math.max(rows[indexNavBar].cells[0].offsetHeight,22);return result;};PE.on_win_resize=function PE_on_win_resize(view,model,rootTag){if(mstr.utils.ISIE4&&view.props.autoResizeWidth){rootTag.style.tableLayout="fixed";rootTag.rows[0].cells[1].style.width="auto";}if(mstr.utils.ISIE4&&view.props.document&&view.props.document.readyState!="complete"){if(!view.props._setCallbackOnDocComplete){view.props._setCallbackOnDocComplete=true;var viewId=view.props.id,modelId=model.props.id,myCallback=new Function("if (document.readyState == 'complete') mstr.behaviors.PromptEditor.on_win_resize(mstr.$obj('"+viewId+"'), mstr.$obj('"+modelId+"'), mstr.$obj('"+viewId+"').props.element)");view.props.document.onreadystatechange=mstr.utils.Objects.compositeFunc(view.props.document.onreadystatechange,myCallback);return ;}}var newHeight=this._computeAvailableHeight(view,rootTag)+"px";view.props.height=newHeight;this.on_set_height(view,model,rootTag);};PE.on_win_scroll=function PE_on_win_scroll(view,model,rootTag,notScrollBody){if(mstr.utils.ISIE4&&view.props.document&&view.props.document.readyState!="complete"){if(!view.props._setCallbackOnDocComplete){view.props._setCallbackOnDocComplete=true;var viewId=view.props.id,modelId=model.props.id,myCallback=new Function("if (document.readyState == 'complete') mstr.behaviors.PromptEditor.on_win_scroll(mstr.$obj('"+viewId+"'), mstr.$obj('"+modelId+"'), mstr.$obj('"+viewId+"').props.element)");view.props.document.onreadystatechange=mstr.utils.Objects.compositeFunc(view.props.document.onreadystatechange,myCallback);return ;}}var CELLSPACING=3;var cellspacings=CELLSPACING*(rootTag.rows.length+1);var hScrollBarHeight=mstr.utils.ISIE6?12:0;var toc=view.props.toc;var tocDiv=toc&&toc.props&&toc.props.element;var tocListDiv=toc&&toc.props&&toc.props.contentsView&&toc.props.contentsView.props&&toc.props.contentsView.props.element;if(!tocDiv||!tocListDiv){return ;}var bd=(document&&document.documentElement)||(document&&document.body);bd=notScrollBody?document.getElementById("mstrWebContents"):bd;var scrollTop=(bd&&bd.scrollTop)||0;var scrollBottom=scrollTop+((document&&document.documentElement&&document.documentElement.clientHeight)||(document&&document.body&&document.body.clientHeight)||0);var elTop=mstr.utils.BoxModel.getElementSumOffsetTop(view.props.element,notScrollBody?bd:undefined);var elBottom=view.props.element.scrollHeight?(elTop+view.props.element.scrollHeight):scrollBottom;var tocListOffsetHeight=mstr.utils.BoxModel.getElementSumOffsetTopAccurately(tocListDiv,tocDiv);var pos=tocDiv.style.position;if(pos!="relative"){tocDiv.style.position="relative";tocListDiv.style.overflow="auto";}if(elTop<scrollTop){var tocDivHeight=Math.min(mstr.utils.BoxModel.getBrowserWindowHeight(document),Math.max(elBottom-scrollTop-mstr.behaviors.PromptEditor._bottomHeight(view,rootTag)-cellspacings,0));tocListDiv.style.height=(tocDivHeight-tocListOffsetHeight-((tocListDiv.scrollWidth>tocListDiv.clientWidth)?hScrollBarHeight:0))+"px";tocDiv.style.top=(scrollTop-elTop-CELLSPACING)+"px";}else{if(elTop<scrollBottom){var tocDivHeight=Math.min(Math.max(scrollTop+mstr.utils.BoxModel.getBrowserWindowHeight(document)-elTop-CELLSPACING,0),Math.max(elBottom-scrollTop-mstr.behaviors.PromptEditor._bottomHeight(view,rootTag)-cellspacings,0));tocListDiv.style.height=Math.max(0,(tocDivHeight-tocListOffsetHeight-((tocListDiv.scrollWidth>tocListDiv.clientWidth)?hScrollBarHeight:0)))+"px";tocDiv.style.top="0px";}}};PE.on_scroll=function PE_on_scroll(vid,mid,rid){var f=mstr.controllers.Factory;this.on_win_scroll(f.obj(vid),f.obj(mid),document.getElementById(rid),true);};PE.attachScrollHandler=function PE_attachScrollHandler(view,model,rootTag){var scrollSrc=document.getElementById("mstrWebContents");if(scrollSrc&&!scrollSrc.onscroll&&window.mstrInterfacePlugin){scrollSrc.onscroll=new Function("e","return mstr.behaviors.PromptEditor.on_scroll('"+view.getId()+"','"+model.getId()+"','"+rootTag.id+"');");}};PE._computeAvailableHeight=function PE_computeAvailableHeight(view,rootTag){var DEFAULT_PROMPT_EDITOR_TOP=microstrategy.headerHeight;var PAGEFOOTERHEIGHT=microstrategy.footerHeight+3;if(!rootTag){return 0;}var doc=view.props.document;var webContents=document.getElementById("mstrWebContents");var heightBrowser=(doc&&doc.documentElement&&doc.documentElement.clientHeight)||(doc&&doc.body&&doc.body.clientHeight)||0;view.props.lastComputedBrowserHeight=heightBrowser;var top=mstr.utils.BoxModel.getElementSumOffsetTop(rootTag,document.getElementById("mstrWebContents"))||DEFAULT_PROMPT_EDITOR_TOP;var h=heightBrowser-top-PAGEFOOTERHEIGHT;return Math.max(h,this.MINIMUM_HEIGHT);};PE.on_model_set_validationStatus=function PE_onVldStatus(view,model,rootTag){var status=model&&model.get("validationStatus"),sc=status&&status.statusCode;if(sc&&sc!=mstr.Enum.Validation.STATUSCODE.VALID){var descs=view.props.descriptors,msg;if(sc==mstr.Enum.Validation.STATUSCODE.NO_PERSONAL_ANSWER_NAME||sc==mstr.Enum.Validation.STATUSCODE.INVALID_PERSONAL_ANSWER_NAME){msg=descs&&descs.invalidPersonalAnswersWarning;}else{msg=descs&&descs.invalidAnswersWarning;}if(msg){alert(msg);}}};return PE;})();mstr.behaviors.PromptValidationHelper=(function(){var PVH={};PVH.showInvalid=function PVH_showInvalid(status){var showInvalid=true;var statusCode=status.statusCode;var context=status.context;if(statusCode!=mstr.Enum.Validation.STATUSCODE.VALID&&context){if(statusCode==mstr.Enum.Validation.STATUSCODE.INVALID){return showInvalid;}switch(context){case mstr.Enum.Validation.Prompt.Stage.RUNREPORT:case mstr.Enum.Validation.Prompt.Stage.NAVIGATEAWAY:break;case mstr.Enum.Validation.Prompt.Stage.CHANGEANSWER:case mstr.Enum.Validation.Prompt.Stage.KEYSTROKE:if(!(statusCode==mstr.Enum.Validation.STATUSCODE.INVALID_DATATYPE||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MAX_VALUE||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MAX_LENGTH||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MAX_COUNT)){showInvalid=false;}break;case mstr.Enum.Validation.Prompt.Stage.LOSTFOCUS:if(!(statusCode==mstr.Enum.Validation.STATUSCODE.INVALID_DATATYPE||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MAX_VALUE||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MAX_LENGTH||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MAX_COUNT||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MIN_VALUE||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MIN_LENGTH||statusCode==mstr.Enum.Validation.STATUSCODE.EXCEEDS_MIN_COUNT)){showInvalid=false;}break;case mstr.Enum.Validation.Prompt.Stage.INIT:showInvalid=false;break;default:break;}}return showInvalid;};return PVH;})();mstr.itemrenderers.DrillList=(function(){var DL=mstr.$H.clone(mstr.itemrenderers.ListView);DL.renderListItem=function DL_renderListItem(view,model,rootTag,context){var elDiv=mstr.itemrenderers.FastListView.renderListItem(view,model,rootTag,context);if(elDiv){var dir=context.item&&context.item.drillDir;if(dir){mstr.utils.Dom.setBGIconClass(elDiv,dir);elDiv.style.paddingLeft="22px";}}this._insertElementForIndex(view,rootTag,context.at,elDiv);return elDiv;};return DL;})();mstr.itemrenderers.PromptTOCList=(function(){var PL={};PL.renderListItem=function PL_renderListItem(view,model,rootTag,context){var doc=view.props.document;var css=(view.props.cssPrefix||"")+(view.props.cssClass||"");var tr=rootTag.childNodes[0].insertRow(context.at);var answer=context.item.get("answer");var bRequired=!!(answer&&answer.get("required"));tr.className=css+"Item"+(bRequired?"Required":"");tr.onmouseover=this.hover;tr.onmouseout=this.unhover;var elIndex=tr.insertCell(0);elIndex.className=css+"ItemIndex";elIndex.appendChild(doc.createTextNode(context.at+1));var elTitle=tr.insertCell(1);elTitle.className=css+"ItemTitle";var elTitleValue=doc.createElement("span");elTitleValue.innerHTML=context.item.get("title");elTitle.appendChild(elTitleValue);if(bRequired){var elRequired=doc.createElement("span");elTitle.appendChild(elRequired);elRequired.className=css+"ItemTitleRequiredLabel";elRequired.innerHTML=view.props.descriptors.required||"(Required)";}var elFlag=tr.insertCell(2);elFlag.className=css+"ItemFlag";var elDiv=doc.createElement("div");elFlag.appendChild(elDiv);var status=answer&&answer.get&&answer.get("validationStatus"),msg=answer&&answer.get&&answer.get("message");PL.markItemMessageDiv(elDiv,msg,status,answer&&answer.isEmpty&&answer.isEmpty());if(answer){var fn="_PTOCList_message_callback_"+context.at;view[fn]=new Function("evt","mstr.itemrenderers.PromptTOCList.markItemMessage(this, "+context.at+")");answer.attachEventListener(view,"set_validationStatus",fn);}return tr;};PL.markItemMessage=function PL_mIMessage(view,index){if(isNaN(index)||index<0){return ;}var ps=view&&view.props,rootTag=ps&&ps.element;if(!rootTag){return ;}var elRow=rootTag.firstChild.rows[index],elCells=elRow&&elRow.cells,elCell=elCells&&elCells[2],elDiv=elCell&&elCell.firstChild;if(!elDiv){return ;}var model=ps.model,pqs=model&&model.getItems(),pq=pqs&&pqs[index],ans=pq&&pq.props.answer,status=ans&&ans.get&&ans.get("validationStatus"),msg=ans&&ans.get&&ans.get("message");PL.markItemMessageDiv(elDiv,msg,status,ans&&ans.isEmpty&&ans.isEmpty());};PL.markItemMessageDiv=function PL_mIMDiv(elDiv,msg,status,isEmpty){if(!status){return ;}var statusCode=status.statusCode;var showInvalid=mstr.behaviors.PromptValidationHelper.showInvalid(status);elDiv.title=msg||"";elDiv.className=(statusCode==mstr.Enum.Validation.STATUSCODE.VALID)?(isEmpty?"":"mstrValid"):(showInvalid?"mstrMessage":"");};PL.markListItemAsSelected=function PL_mLIasSelected(view,model,rootTag,context){var index=parseInt(context.at);if(isNaN(index)||index<0){return ;}var el=rootTag.childNodes[0].rows[context.at];var c=el.className;if(/Hover/.test(c)){c=c.replace(/Hover/,"SelectedHover");}else{c+="Selected";}el.className=c;};PL.markListItemAsUnselected=function PL_mLIasUnselected(view,model,rootTag,context){var index=parseInt(context.at);if(isNaN(index)||index<0){return ;}var el=rootTag.childNodes[0].rows[context.at];el.className=el.className.replace(/Selected/,"");};PL.hover=function PL_hover(){this.className+="Hover";};PL.unhover=function PL_unhover(css){this.className=this.className.replace(/Hover/,"");};return PL;})();mstr.behaviors.ExpressionConstantPopup=(function(){var ECP={};ECP.on_set_visible=function ECP_on_set_visible(view,model,rootTag){this._updateBrowseView(view,model,rootTag);this._updateImportView(view,model,rootTag);mstr.behaviors.Popup.on_set_visible(view,model,rootTag);};ECP._updateBrowseView=function ECP_updateBV(view,model,rootTag){if(!view){return ;}var opener=view.get("opener"),em=opener&&opener.getModel(),editNode=em&&em.get("editNode"),target=editNode&&mstr.utils.QualNode.getTarget(editNode),bShow=!!(target&&!target.locked),form=editNode&&mstr.utils.QualNode.getForm(editNode),bShow=bShow&&!!(form&&form.isBrowseForm);bShow=bShow&&em&&(em.get("allowElementBrowse")!=false);if(bShow){view.execCommand("ShowChild","browseView");}else{mstr.controllers.Factory.safeset(view.get("browseView"),"visible",false);}};ECP._updateImportView=function ECP_updateIV(view,model,rootTag){if(!view){return ;}var opener=view.get("opener"),em=opener&&opener.getModel(),bShow=em&&(em.get("allowFileImport")!=false);if(bShow){var editNode=em.get("editNode"),et=mstr.utils.QualNode.getExpressionType(editNode);switch(et){case mstr.Enum.Nodes.EXPRESSIONTYPE.SINGLEBASEFORMQUAL:case mstr.Enum.Nodes.EXPRESSIONTYPE.LISTQUAL:bShow=true;break;default:bShow=false;break;}}if(bShow){view.execCommand("ShowChild","importView");}else{mstr.controllers.Factory.safeset(view.get("importView"),"visible",false);}};return ECP;})();mstr.behaviors.ExpressionCart=(function(){var EC={};EC.updateRootOperatorView=function EC_updateROView(view,model,rootTag){var sel=model.props.selected;var count=(sel&&sel.count())||0;if(count<2){view.execHideChild("rootOperatorView");}else{view.execShowChild("rootOperatorView");}};return EC;})();mstr.behaviors.ExpressionEditor=(function(){var EE={};EE.onmousedown=function EE_onmousedown(e,hWin,viewId){var evt=new mstr.lang.Event(e,hWin);var bCTRL=evt.ctrl(),bSHIFT=evt.shift();if(bCTRL||bSHIFT){mstr.utils.Dom.clearBrowserHighlights(hWin);}var view=mstr.$obj(viewId);if(!view||!view.fireCommands||!view.get||view.get("readOnly")){return true;}var cmdValue={nodeId:null,isANDOR:false,ctrl:bCTRL,shift:bSHIFT,x:evt.x-6,y:evt.y+3};var elTarget=evt.target();var elTargetAnc=mstr.utils.Dom.findAncestor(elTarget,"mstrExprNodeInfo",null,view.props[mstr.$W.ELEMENT],true);if(elTargetAnc){var nodeInfo=elTargetAnc.mstrExprNodeInfo.split(",");cmdValue.nodeId=nodeInfo&&nodeInfo[0];cmdValue.isANDOR=!!(nodeInfo&&parseInt(nodeInfo[1]));if(!bCTRL&&!bSHIFT&&String(elTarget.nodeName).toLowerCase()=="a"){cmdValue.popup=elTarget.mstrPopupInfo||elTarget.getAttribute("mstrPopupInfo");}}view.fireCommands(null,cmdValue);return true;};return EE;})();mstr.itemrenderers.ExpressionEditor=(function(){var EE={};EE._renderTarget=function EE_renderTarget(target,bReadOnly){var txt=target&&target.n;var bUndefined=(txt==null);return this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("3377"):txt,"ExpressionTargetPopup1",bUndefined,true,false);};EE._renderExprType=function EE_renderExprType(exprType,bReadOnly){var txt=exprType&&exprType.n;var bUndefined=(txt==null);return this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("5921"):txt,"ExpressionTypePopup1",bUndefined,bReadOnly,false);};EE._renderForm=function EE_renderForm(form,bReadOnly){var txt=form&&form.n;var bUndefined=(txt==null);return this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("5922"):txt,"ExpressionFormPopup1",bUndefined,bReadOnly,false);};EE._renderFunc=function EE_renderFunc(func,bReadOnly){var txt=func&&func.n;var bUndefined=(txt==null);return this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("545"):txt,"ExpressionFunctionPopup1",bUndefined,bReadOnly,false);};EE._renderConstant1=function EE_renderConstant1(constNodeVal,bReadOnly){var txt=constNodeVal&&constNodeVal.constantValue;var bUndefined=(txt==null||String(txt)=="");return this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("527"):txt,"ExpressionConstant1Popup1",bUndefined,bReadOnly,true);};EE._renderConstant2=function EE_renderConstant2(constNodeVal,bReadOnly){var txt=constNodeVal&&constNodeVal.constantValue;var bUndefined=(txt==null||String(txt)=="");return this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("527"):txt,"ExpressionConstant2Popup1",bUndefined,bReadOnly,true);};EE._renderLevel=function EE_renderLevel(level,bReadOnly){var txt=level&&level.n;var bUndefined=(txt==null);return this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("3273"):txt,"ExpressionLevelPopup1",bUndefined,bReadOnly,false);};EE._renderElements=function EE_renderElements(arr,max,bReadOnly){var len=mstr.$A.len(arr),bUndefined=!len,names;if(!bUndefined){if(parseInt(max)){len=Math.min(parseInt(max),len);}names=new Array(len);for(var i=0;i<len;i++){names[i]=arr[i]&&arr[i]["n"];}}return this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("2210"):names.join(", "),"ExpressionElementsPopup1",bUndefined,bReadOnly,false);};EE._renderPopupLink=function EE_renderPopupLink(txt,popupInfo,bUndefined,bReadOnly,bPresWS){if(bReadOnly){return(bPresWS?mstr.utils.String.preserveWhiteSpace4HTML(txt):String(txt))||"";}else{var cssClass="mstrUndefined"+(microstrategy.isDoubleByte()?"DB":"");txt=mstr.utils.String.escape4HTMLText(txt);return'<a href="javascript:void(0)" mstrPopupInfo="'+popupInfo+'" '+(bUndefined?' class="'+cssClass+'" ':"")+">"+((bPresWS?mstr.utils.String.preserveWhiteSpace4HTML(txt):String(txt))||"")+"</a>";}};EE.renderMetricQualifier=function EE_renderMQ(view,model,rootTag,context){var bReadOnly=!!view.props.readOnly;if(context.el){var s=[this._renderTarget(context.metric,bReadOnly)," ",this._renderFunc(context["function"],bReadOnly)];if(context.constant1){s.push(" ");s.push(this._renderConstant1(context.constant1,bReadOnly));if(context.constant2){s.push(" "+microstrategy.descriptors.getDescriptor("701")+" ");s.push(this._renderConstant2(context.constant2,bReadOnly));}}if((view.props.showMetricLevel||bReadOnly)&&context.level){s.push(" "+microstrategy.descriptors.getDescriptor("6003")+" ");s.push(this._renderLevel(context.level,bReadOnly));}context.el.innerHTML=s.join("");}};EE.renderAttributeQualifier=function EE_renderAQ(view,model,rootTag,context){var bReadOnly=!!view.props.readOnly;if(context.el){var s=[this._renderTarget(context.attribute,bReadOnly)];var bRenderExprType=!bReadOnly&&!(context.attribute&&context.attribute.locked);if(bRenderExprType){var h=mstr.utils.Expr.getAllowedExprTypesHash(model);bRenderExprType=mstr.utils.Hash.lenGreaterThan(h,1)||mstr.utils.Hash.isEmpty(h);}if(bRenderExprType){s.push(" ");s.push(this._renderExprType(context.exprType,bReadOnly));}if(view.props.showForms!=false){s=s.concat([" ",this._renderForm(context.form,bReadOnly)]);}s=s.concat([" ",this._renderFunc(context["function"],bReadOnly)]);if(context.constant1){s.push(" ");s.push(this._renderConstant1(context.constant1,bReadOnly));if(context.constant2){s.push(" "+microstrategy.descriptors.getDescriptor("701")+" ");s.push(this._renderConstant2(context.constant2,bReadOnly));}}context.el.innerHTML=s.join("");}};EE.renderAttributeElementList=function EE_renderAE(view,model,rootTag,context){var bReadOnly=!!view.props.readOnly;if(context.el){var s=[this._renderTarget(context.attribute,bReadOnly)];var bRenderExprType=!bReadOnly&&!(context.attribute&&context.attribute.locked);if(bRenderExprType){var h=mstr.utils.Expr.getAllowedExprTypesHash(model);bRenderExprType=mstr.utils.Hash.lenGreaterThan(h,1)||mstr.utils.Hash.isEmpty(h);}if(bRenderExprType){s.push(" ",this._renderExprType(context.exprType,bReadOnly));}s.push(" ",this._renderFunc(context["function"],bReadOnly)," ",this._renderElements(context.elements,view.props.maxElementsDisplay,bReadOnly));context.el.innerHTML=s.join("");}};EE.renderANDORValue=function EE_renderANDORValue(view,model,rootTag,context){var bReadOnly=!!view.props.readOnly;if(context.el){if(model.get("allowGrouping")==false){context.el.style.display="none";}else{var txt=null;switch(parseInt(context.funcId)){case mstr.Enum.Nodes.FUNCTION.AND:if(!context.isNOT){txt=microstrategy.descriptors.getDescriptor("5282");}else{txt=microstrategy.descriptors.getDescriptor("5924");}break;case mstr.Enum.Nodes.FUNCTION.OR:if(!context.isNOT){txt=microstrategy.descriptors.getDescriptor("5283");}else{txt=microstrategy.descriptors.getDescriptor("5925");}break;case mstr.Enum.Nodes.FUNCTION.TUPLE:txt="TUPLE";if(context.isNOT){txt+=" NOT";}break;}var bUndefined=(txt==null);context.el.innerHTML=this._renderPopupLink(bUndefined?microstrategy.descriptors.getDescriptor("545"):txt,"ExpressionBranchQualPopup1",bUndefined,bReadOnly,false);}}};EE.renderUnknownCondition=function EE_renderUnknownCondition(view,model,rootTag,context){if(context.el){context.el.innerHTML="...";}};EE.markAsSelected=function EE_markAsSelected(view,model,rootTag,context){var el=context.el;if(el){var c=el.className;if(/Hover/.test(c)){c=c.replace(/Hover/,"SelectedHover");}else{c+="Selected";}el.className=c;}};EE.markAsUnselected=function EE_markAsUnselected(view,model,rootTag,context){var el=context.el;if(el){el.className=el.className.replace(/Selected/,"");}};EE.hover=function(e){this.className+="Hover";};EE.unhover=function(e){this.className=this.className.replace(/Hover/,"");};return EE;})();mstr.behaviors.CalendarView=(function(){var CalView={};CalView.on_model_set_browseMonth=function CalView_on_model_set_browseMonth(view,model,rootTag){var leadingBlanks=model.calBrowseDates();var dates=model.get("browseDates");var browseMonth=model.get("browseMonth");var tableHTMLPrefix='<table class="cal_table" border="0" cellpadding="0" cellspacing="0" style="width:100%;"><thead><tr>';var dayDescs=model.get("dayDescs");var firstDayOfWeek=model.get("firstDayOfWeek")==1?0:1;for(var i=firstDayOfWeek;i<7+firstDayOfWeek;i++){tableHTMLPrefix+="<th>"+dayDescs[i]+"</th>";}tableHTMLPrefix+="</tr></thead>";var tableHTMLPostfix="</table>";var bodyHTML="<tr>";for(var i=0,len=dates.length;i<len;i++){bodyHTML+="<td ";if(dates[i]!=""&&!model.isDateBetweenMinMax(browseMonth.year,browseMonth.month,i+1-leadingBlanks)){bodyHTML+=" onclick=\"mstr.behaviors.CalendarView.on_click_day('"+view.get("id")+"', this);\"";bodyHTML+=' onmouseover="mstr.behaviors.CalendarView.on_mouse_over_day(this);"';bodyHTML+=' onmouseout="mstr.behaviors.CalendarView.on_mouse_out_day(this);"';}else{if(dates[i]!=""){bodyHTML+=' class="disabled"';}}bodyHTML+=">"+dates[i]+"</td>";if(i%7==6&&i!=(len-1)){bodyHTML+="</tr> <tr>";}}bodyHTML+="</tr>";var tableContainer=rootTag.childNodes[1];var span=document.createElement("span");span.innerHTML=tableHTMLPrefix+bodyHTML+tableHTMLPostfix;mstr.$D.clearChilds(tableContainer);mstr.$D.insertNode(span.childNodes[0],tableContainer);var yearNode=rootTag.childNodes[0].getElementsByTagName("input")[0];var monthPulldown=yearNode.parentNode.previousSibling;var monthDesc=model.get("monthDescs");var newOptions="";for(var i=0;i<12;i++){if(model.isMonthBetweenMinMax(browseMonth.year,i+1)){newOptions+='<option value="'+(i+1)+'"';if(i+1==browseMonth.month){newOptions+='selected="true"';}newOptions+=">"+monthDesc[i]+"</option>";}}span.innerHTML="<select onchange=\"mstr.$obj('"+view.get("id")+"').getModel().setBrowseMonth(this.value)\">"+newOptions+"</select>";mstr.$D.clearChilds(monthPulldown);mstr.$D.insertNode(span.childNodes[0],monthPulldown);yearNode.value=model.get("browseMonth").year;highlightSelectedTd(model,view);toggleMinMaxButtons(model,view);};function highlightSelectedTd(model,view){if(model.get("selectedDate")==null){return ;}var rootTag=view.props.element;var tds=rootTag.getElementsByTagName("td");if(model.get("browseMonth").year==model.get("selectedDate").year&&model.get("browseMonth").month==model.get("selectedDate").month){var firstDate=new Date(model.get("browseMonth").year,model.get("browseMonth").month-1,1);var leadingBlanks=(firstDate.getDay()-model.get("firstDayOfWeek")+8)%7;var selectedTd=tds[model.get("selectedDate").day+leadingBlanks-1];if(view.get("selectedTd")!=null){view.get("selectedTd").className="";}selectedTd.className+=" selected";view.set("selectedTd",selectedTd);}else{if(view.get("selectedTd")!=null){view.get("selectedTd").className="";}}}function toggleMinMaxButtons(model,view){var viewId=view.get("id");var minDate=model.get("minDate");var maxDate=model.get("maxDate");var browseMonth=model.get("browseMonth");var rootTag=view.props.element,prev=rootTag.childNodes[0].childNodes[0],next=rootTag.childNodes[0].childNodes[1];if(!minDate||browseMonth.year>minDate.year||(browseMonth.year==minDate.year&&browseMonth.month>minDate.month)){prev.style.visibility="visible";}else{prev.style.visibility="hidden";}if(!maxDate||browseMonth.year<maxDate.year||(browseMonth.year==maxDate.year&&browseMonth.month<maxDate.month)){next.style.visibility="visible";}else{next.style.visibility="hidden";}}CalView.on_click_day=function CalView_on_click_day(viewId,tdTag){var view=mstr.$obj(viewId);var model=view.getModel();var day=parseInt(tdTag.innerHTML);if(view.get("selectedTd")!=null){view.get("selectedTd").className="";}tdTag.className+=" selected";view.set("selectedTd",tdTag);model.set("selectedDate",{day:day,month:model.get("browseMonth").month,year:model.get("browseMonth").year});model.updateValueString();if(view.get("opener")){view.get("opener").fireCommands();}if(model.get("parent")&&!model.get("parent").get("multiSelect")){view.fireCommands();}};CalView.on_mouse_over_day=function CalView_on_mouse_over_day(tdTag){tdTag.className+=" mouseover";};CalView.on_mouse_out_day=function CalView_on_mouse_over_day(tdTag){tdTag.className=tdTag.className.replace(/\bmouseover\b/,"");};CalView.on_key_up_year=function CalView_on_key_up_year(e,viewId,inputTag){if(!e){e=window.event;}var kc=e.keyCode;if({9:true,38:true,40:true,37:true,39:true}[kc]){return ;}var msg="",year=inputTag.value,model=mstr.$obj(viewId).getModel(),v=/^(1\d|20)\d{2}$/.test(year);if(v&&model.isYearBetweenMinMax(year)){model.setBrowseYear(year);}else{var minDate=model.get("minDate"),minYear=minDate&&minDate.year||1000,maxDate=model.get("maxDate"),maxYear=maxDate&&maxDate.year||2099,msg=model.get("message").replace("##",minYear).replace("###",maxYear);}if(inputTag){inputTag.title=msg||"";inputTag.style.background=msg?"#ffffff url(../style/mstr/images/errorLine.gif) bottom left repeat-x":"#fff";}};CalView.on_set_visible=function CalView_on_set_visible(view,model,rootTag){rootTag.style.display=view.get("visible")?"block":"none";};CalView.on_click_movePrev=function CalView_on_click_movePrev(viewId){var view=mstr.$obj(viewId);var model=view.getModel();model.movePrev();};CalView.on_click_moveNext=function CalView_on_click_moveNext(viewId){var view=mstr.$obj(viewId);var model=view.getModel();model.moveNext();};return CalView;})();mstr.behaviors.CalendarAndTimePicker=(function(){var CalTimeView={};CalTimeView.on_model_set_valueString=function CalTimeView_on_model_set_valueString(view,model,rootTag){var viewId=view.get("id");var calendar_input=document.getElementById(viewId+"_txt"),s=(model&&model.get("valueString"))||"",sOld=calendar_input.value;if(sOld!=s){calendar_input.title=calendar_input.value=s;}};CalTimeView.on_model_set_dataType=function CalTimeView_on_model_set_dataType(view,model,rootTag){var dataType=model&&model.get("dataType");var viewId=view.get("id");var calendar_input=document.getElementById(viewId+"_txt");var calendar_icon=document.getElementById(viewId+"_cal_icon");var timePickerView=view.get("timePicker");switch(dataType){case mstr.Enum.Nodes.DATATYPE.DATE:calendar_input.style.display="block";calendar_icon.style.display="block";mstr.controllers.Factory.safeset(timePickerView,"visible",false);break;case mstr.Enum.Nodes.DATATYPE.TIME:calendar_input.style.display="none";calendar_icon.style.display="none";view.execCommand("ShowChild","timePicker");break;case mstr.Enum.Nodes.DATATYPE.TIMESTAMP:calendar_input.style.display="block";calendar_icon.style.display="block";view.execCommand("ShowChild","timePicker");break;default:calendar_input.style.display="block";calendar_icon.style.display="none";mstr.controllers.Factory.safeset(timePickerView,"visible",false);}};CalTimeView.onmousedown_icon=function CalTimeView_onmousedown_icon(viewId){var view=mstr.$obj(viewId);if(view.props.enabled){view.execCommand("OpenPopup");}return true;};CalTimeView.onblur_dayinput=function CalTimeView_onblur_dayinput(viewId,inputTag,eventContext){if(!inputTag){return true;}var view=mstr.$obj(viewId);if(!view){return true;}var isKeyPress=eventContext&&eventContext.keyPress;var bWriteBack=view.shouldWriteBack&&view.shouldWriteBack(isKeyPress?"keypress":"blur");if(bWriteBack){var model=view.props.model;model.set("valueString",inputTag.value);var av=view.getAutoValidate&&view.getAutoValidate(view);if(av){var af=Math.min((view.getAutoFormat&&view.getAutoFormat())||0,av);var stage=isKeyPress?"KEYSTROKE":"LOSTFOCUS",validationContext={stage:mstr.Enum.Validation.Prompt.Stage[stage]},checkLevel=isKeyPress?"ONKEYPRESS":"ONBLUR";if(af>=mstr.Enum.Widget.AUTOFORMAT[checkLevel]){model.format(validationContext);}else{if(av>=mstr.Enum.Widget.AUTOVALIDATE[checkLevel]){model.validate(validationContext);}}}}if(view.fireCommands){view.fireCommands();}return true;};CalTimeView.IGNORE_KEYCODES={9:true,38:true,40:true,37:true,39:true};CalTimeView.onkeypress_dayinput=function CalTimeView_onkeypress_dayinput(viewId,inputId,e){var key=mstr.utils.Events.keyCode(e,window);if(key&&this.IGNORE_KEYCODES[key]){return true;}var s="var el = document && document.getElementById('"+inputId+"'); if (el && el.onblur) el.onblur({keyPress: true});";var ids=this.timeoutIds;if(!ids){ids=this.timeoutIds={};}var id=ids[inputId];if(id){self.clearTimeout(id);}ids[inputId]=self.setTimeout(s,5000);return true;};CalTimeView.on_model_set_validationStatus=function CTV_on_validationStatus(view,model,rootTag,idTextBox){var status=model&&model.get("validationStatus"),sc=status&&status.statusCode;var msg=(sc&&(sc!=mstr.Enum.Validation.STATUSCODE.VALID)&&mstr.behaviors.PromptValidationHelper.showInvalid(status))?model.get("message"):null;var doc=rootTag&&rootTag.ownerDocument,elTxt=doc.getElementById(idTextBox);if(elTxt){elTxt.title=msg||"";if(msg){elTxt.style.background="#ffffff url(../style/mstr/images/errorLine.gif) bottom left repeat-x";}else{elTxt.style.backgroundImage="";}}};CalTimeView.on_set_enabled=function CTV_on_set_enabled(view,model,rootTag){var elInput=rootTag.childNodes[1].rows[0].cells[0].firstChild;var en=view.props.enabled;mstr.behaviors.Generic.set_enabled(elInput,en);elInput.style.backgroundColor=en?"#ffffff":"#d4d0c8";};return CalTimeView;})();mstr.behaviors.TimePickerView=(function(){var TimePicker={};TimePicker.on_set_visible=function TimePicker_on_set_visible(view,model,rootTag){rootTag.style.display=view.get("visible")?"block":"none";if(mstr.utils.ISIE7||mstr.utils.ISIE6){var s=rootTag.parentNode.style;var o=s.overflow;s.overflow="visible";s.overflow=o;}if(mstr.utils.ISFF2){rootTag.style.whiteSpace="nowrap";}};TimePicker.on_model_set_hour=function TimePicker_on_model_set_hour(view,model,rootTag){var viewId=view.get("id");var hourPulldown=document.getElementById(viewId+"_hour");if(!hourPulldown.firstChild){var options=[];for(var i=0;i<24;i++){options.push('<option value="'+i+'">'+model.getHourAsString(i)+"</option>");}var span=document.createElement("span");span.innerHTML="<select onchange=\"mstr.behaviors.TimePickerView.on_change_field('"+viewId+"','hour',this.value)\">"+options.join(" ")+"</select>";mstr.$D.clearChilds(hourPulldown);mstr.$D.insertNode(span.childNodes[0],hourPulldown);}hourPulldown.firstChild.selectedIndex=model.get("hour");};TimePicker.on_model_set_minute=function TimePicker_on_model_set_minute(view,model,rootTag){var viewId=view.get("id");var minutePulldown=document.getElementById(viewId+"_minute");if(!minutePulldown.firstChild){var options=[];for(var i=0;i<60;i++){options.push('<option value="'+i+'">'+model.getMinuteAsString(i)+"</option>");}var span=document.createElement("span");span.innerHTML="<select onchange=\"mstr.behaviors.TimePickerView.on_change_field('"+viewId+"','minute',this.value)\">"+options.join(" ")+"</select>";mstr.$D.clearChilds(minutePulldown);mstr.$D.insertNode(span.childNodes[0],minutePulldown);}minutePulldown.firstChild.selectedIndex=model.get("minute");};TimePicker.on_model_set_second=function TimePicker_on_model_set_second(view,model,rootTag){var viewId=view.get("id");var secondPulldown=document.getElementById(viewId+"_second");if(!secondPulldown.firstChild){var options=[];for(var i=0;i<60;i++){options.push('<option value="'+i+'">'+model.getSecondAsString(i)+"</option>");}var span=document.createElement("span");span.innerHTML="<select onchange=\"mstr.behaviors.TimePickerView.on_change_field('"+viewId+"','second',this.value)\">"+options.join(" ")+"</select>";mstr.$D.clearChilds(secondPulldown);mstr.$D.insertNode(span.childNodes[0],secondPulldown);}secondPulldown.firstChild.selectedIndex=model.get("second");};TimePicker.on_change_field=function TimePicker_on_change_field(viewId,fieldName,fieldValue){var view=mstr.$obj(viewId);var model=view.getModel();model.set(fieldName,fieldValue);if(view&&view.props.parent){view.props.parent.fireCommands();}};return TimePicker;})();mstr.behaviors.PromptSaveCheckbox=(function(){var PSC={};PSC.on_set_savingAnswer=function PSC_on_set_savingAnswer(view,model,rootTag){rootTag.rows[0].cells[0].childNodes[0].checked=model.get("savingAnswer");};PSC.onClickRemeber=function PSC_onClickRemeber(viewId,checkbox){var view=mstr.$obj(viewId);var model=view.getModel();model.set("savingAnswer",checkbox.checked);var answer=model.props.answer;if(answer){var container=answer.props.container;var newContainer={};if(!container){var name=model.get("n")||model.get("parent").get("parent").get("objectInfo").n;newContainer.n=model.get("namePrefixForSingleSavedAnswer")+name;newContainer.dssid="";newContainer.isDefault=true;newContainer.isAutoClose=false;}else{for(var prop in container){newContainer[prop]=container[prop];}}}if(!checkbox.checked){newContainer.isAutoClose=false;}newContainer.isDefault=checkbox.checked;answer.set("container",newContainer);};PSC.on_set_answer=function PSC_on_set_answer(view,model,rootTag){if(model&&model.get("answer")&&model.get("answer").get("container")){var isAutoClose=model.get("answer").get("container").isAutoClose;getAutoCloseCheckbox(rootTag).checked=isAutoClose;getAutoCloseCheckbox(rootTag).disabled=!model.get("savingAnswer");}else{getAutoCloseCheckbox(rootTag).disabled=true;}};PSC.on_set_readyState=function PSC_on_set_readyState(view,model,rootTag){mstr.behaviors.PromptSaveCheckbox.on_set_answer(view,model,rootTag);};PSC.onClickAutoClose=function PSC_onClickAutoClose(viewId,checkbox){var view=mstr.$obj(viewId);var promptQuestion=view.getModel();var container=promptQuestion.get("answer")&&promptQuestion.get("answer").get("container");if(!container){container={};}container.isAutoClose=checkbox.checked;};function getAutoCloseCheckbox(rootTag){return rootTag.rows[0].cells[1].childNodes[0];}return PSC;})();mstr.behaviors.PromptSaveCheckbox2=(function(){var PSC={};PSC.on_set_savingAnswer=function PSC_on_set_savingAnswer(view,model,rootTag){var checkbox=getSaveCheckbox(rootTag);checkbox.checked=model.get("savingAnswer");mstr.behaviors.Generic.set_css_display(getNamePartRoot(rootTag),"block","none",model.get("savingAnswer"));if(model.get("savingAnswer")){getSavingPartRoot(rootTag).style.border="1px solid #808080";getSavingPartRoot(rootTag).style.margin="0px 0px 0px 0px";}else{getSavingPartRoot(rootTag).style.border="0px solid #808080";getSavingPartRoot(rootTag).style.margin="0px 1px 1px 1px";}if(!model||!model.get("answer")||!model.get("answer").get("container")||!model.get("answer").get("container").isDefault){getAutoCloseCheckbox(rootTag).disabled=true;}};PSC.on_set_answer=function PSC_on_set_answer(view,model,rootTag){if(model&&model.get("answer")&&model.get("answer").get("container")){var answerName=model.get("answer").get("container").n||"";var isdefault=model.get("answer").get("container").isDefault;var isAutoClose=model.get("answer").get("container").isAutoClose;getNameTextbox(rootTag).value=answerName;getDefaultCheckbox(rootTag).checked=isdefault;getAutoCloseCheckbox(rootTag).checked=isAutoClose;getAutoCloseCheckbox(rootTag).disabled=!isdefault;}else{getAutoCloseCheckbox(rootTag).disabled=true;}};PSC.on_set_readyState=function PSC_on_set_readyState(view,model,rootTag){mstr.behaviors.PromptSaveCheckbox2.on_set_answer(view,model,rootTag);};PSC.onClickSaving=function PSC_onClickSaving(viewId,checkbox){var view=mstr.$obj(viewId);var model=view.getModel();model.set("savingAnswer",checkbox.checked);};PSC.onClickDefault=function PSC_onClickDefault(viewId,checkbox){var view=mstr.$obj(viewId);var promptQuestion=view.getModel();var container=promptQuestion.get("answer")&&promptQuestion.get("answer").get("container");var newContainer={};if(!container){newContainer.isAutoClose=false;}else{for(var prop in container){newContainer[prop]=container[prop];}}newContainer.isDefault=checkbox.checked;if(!checkbox.checked){newContainer.isAutoClose=false;}promptQuestion.get("answer").set("container",newContainer);};PSC.onClickAutoClose=function PSC_onClickAutoClose(viewId,checkbox){var view=mstr.$obj(viewId);var promptQuestion=view.getModel();var container=promptQuestion.get("answer")&&promptQuestion.get("answer").get("container");if(!container){container={};}container.isAutoClose=checkbox.checked;promptQuestion.get("answer").set("container",container);};PSC.onNameChange=function PSC_onNameChange(viewId,textbox){var view=mstr.$obj(viewId);var promptQuestion=view.getModel();var answer=promptQuestion&&promptQuestion.get("answer");var oldContainer=answer.get("container");var newName=textbox.value;var newContainer=null;var existingAnswers=promptQuestion&&promptQuestion.get("savedAnswers")&&promptQuestion.get("savedAnswers").getItems();var index=mstr.utils.Arrays.findByForm(existingAnswers,newName,"n");if(index>-1){newContainer=existingAnswers[index];}else{newContainer={};newContainer.n=newName;newContainer.dssid="";}newContainer.isDefault=oldContainer?oldContainer.isDefault:false;newContainer.isAutoClose=oldContainer?oldContainer.isAutoClose:false;answer.set("container",newContainer);};function getSavingPartRoot(rootTag){return rootTag.childNodes[1];}function getNamePartRoot(rootTag){return getSavingPartRoot(rootTag).childNodes[1];}function getSaveCheckbox(rootTag){return getSavingPartRoot(rootTag).childNodes[0].childNodes[0];}function getDefaultCheckbox(rootTag){return getNamePartRoot(rootTag).childNodes[0].rows[1].cells[1].childNodes[0];}function getAutoCloseCheckbox(rootTag){return getNamePartRoot(rootTag).childNodes[0].rows[1].cells[2].childNodes[0];}function getNameTextbox(rootTag){return getNamePartRoot(rootTag).childNodes[0].rows[0].cells[1].childNodes[0].childNodes[0];}return PSC;})();mstr.http.BrowseAttributeRequestInputs=(function(){function BARIs(attributeId,blockBegin,blockCount,totalSize,collectForms,searchPattern,matchCase,filterXML,dataSourcesXML,bIncludeFormValues,displayedForms,dimensionId,searchForms){this.params={taskId:"browseElements",attributeID:attributeId,blockBegin:blockBegin,blockCount:blockCount,filterXML:filterXML||"",searchPattern:searchPattern||"",matchCase:!!matchCase,dataSourcesXML:dataSourcesXML||"",includeFormNames:!!collectForms,includeFormValues:!!bIncludeFormValues,displayedForms:displayedForms||mstr.Enum.Widget.DISPLAYEDFORMS.BROWSE,dimensionID:dimensionId||"",searchForms:searchForms||""};}return BARIs;})();mstr.http.BrowseFormsRequestInputs=(function(){function BFRIs(attributeId,formCategory,dataSources){this.params={taskId:"getAttributeForms",attributeID:attributeId,displayedForms:formCategory,dataSourcesXML:dataSources||""};}return BFRIs;})();mstr.http.DataExploreRequestInputs=(function(){function DERIs(browsePath,searchPattern,matchCase,blockBegin,blockCount,dataSources){this.params={taskId:"browseHierarchy",browsePath:browsePath,searchPattern:searchPattern,matchCase:!!matchCase,blockBegin:blockBegin,blockCount:blockCount,dataSourcesXML:dataSources||"",isPathEncoded:true,messageID:mstrApp.messageID};}return DERIs;})();mstr.http.ImportFileRequestInputs=(function(){function IFRIs(elForm,inputId,maxFileSize,maxElements,inputDelimiter,outputDelimiter){var delims=mstr.Settings.Expression.QUALIFICATIONDELIMITER,defaultDelim=delims&&delims[0]||delims;this.params={taskId:"uploadFile",fileFieldName:inputId,maxFileSize:maxFileSize||-1,maxElements:maxElements||-1,inputDelimiter:inputDelimiter||defaultDelim,outputDelimiter:outputDelimiter||defaultDelim,preserveWhiteSpace:mstr.Settings.Expression.PRESERVEWHITESPACE};this.htmlForm=elForm;}return IFRIs;})();mstr.http.LoadPromptAnswerRequestInputs=(function(){function LPARI(answer){this.params={taskId:"loadPromptAnswer",answerID:answer.dssid,subtype:answer.stp};}return LPARI;})();mstr.http.DeletePromptAnswerRequestInputs=(function(){function DPARI(answer){this.params={taskId:"deletePromptAnswer",answerID:answer.dssid,subtype:answer.stp};}return DPARI;})();mstr.http.RenamePromptAnswerRequestInputs=(function(){function RPARI(answer,newName){this.params={taskId:"renamePromptAnswer",answerID:answer.dssid,subtype:answer.stp,newName:newName};}return RPARI;})();mstr.views.ViewRoll=(function(){mstr.$O.extendsClass(VR,mstr.views.ViewListBase);VR.prototype.init=function VR_init(){mstr.views.ViewListBase.prototype.init.apply(this);this.isScrollProvider=true;};VR.prototype.onAddSelections=function VR_onAddSelections(evt){if(this.props.selectingFirstVisibleChildView){return false;}var indices=evt&&evt.memo&&evt.memo.at;var index=mstr.$H.firstKey(indices);this._scrollToChildView(index);};VR.prototype._adjustScrollAreaBottomHeight=function VR_adjustScrollAreaBottomHeight(index,fillup){var elScroll=this.props.scrollArea;if(!elScroll){return ;}index=parseInt(index);if(isNaN(index)||index<0){return ;}var view=this.props.views&&this.props.views[index];var elView=view&&(view.props?view.props.element:view.element);if(!elView){return ;}if(this.props.parent&&this.props.parent.props&&this.props.parent.props.scrollBrowser){elView.scrollIntoView(true);return ;}var y=mstr.utils.BoxModel.getElementSumOffsetTopAccurately(elView,elScroll);var x=mstr.utils.BoxModel.getElementSumOffsetLeftAccurately(elView,elScroll);var maxSclTop=elScroll.scrollHeight-elScroll.offsetHeight;if(y>maxSclTop||index>1){var elFiller=document.getElementById("vrFiller");if(!elFiller){elFiller=document.createElement("div");elFiller.id="vrFiller";elScroll.appendChild(elFiller);}elFiller.style.paddingBottom=(elScroll.offsetHeight-(fillup?0:elView.offsetHeight))+"px";}var me=this;window.setTimeout(function(){if(mstr.utils.BoxModel.getElementSumOffsetTopAccurately(elView,elScroll)&&!(mstr.utils.ISIE4||mstr.utils.ISW3CIE)){elView.scrollIntoView(true);}if(fillup){me._adjustScrollAreaBottomHeight(index);}},200);return{x:x,y:y};};VR.prototype._scrollToChildView=function VR_scrollToChildView(index){var elScroll=this.props.scrollArea;if(!elScroll){return ;}var scrollOffset=this._adjustScrollAreaBottomHeight(index,true);this.props.scrollingToSelectedChildView=true;var callback=new Function("","mstr.$obj('"+this.props.id+"').afterScrollAnimation()");mstr.utils.Animations.scroll(elScroll,scrollOffset.x,scrollOffset.y,null,callback);};VR.prototype.afterScrollAnimation=function VR_afterScrollAnimation(){this.props.scrollingToSelectedChildView=false;this.onScroll();};VR.prototype._computeFirstVisibleChildView=function VR_computeFirstVisibleChildView(){var elScroll=this.props.scrollArea;if(!elScroll){return ;}var scrollTop=elScroll.scrollTop;var views=this.props.views,count=mstr.$A.len(views),y=new Array(count),v;for(var i=0;i<count;i++){v=views[i];if(!v){continue;}y[i]=mstr.utils.BoxModel.getElementSumOffsetTopAccurately((v.props&&v.props.element)||v.element,elScroll);if(y[i]>=scrollTop){if((i>0)&&(y[i]-scrollTop>scrollTop-y[i-1])){return i-1;}else{return i;}}}return count-1;};VR.prototype._computeFirstHiddenChildView=function VR_computeFirstHiddenChildView(){var elScroll=this.props.scrollArea;if(!elScroll){return null;}var scrollTop=elScroll.scrollTop,h=elScroll.clientHeight,scrollBottom=scrollTop+h;if(!h){return -1;}var views=this.props.views,count=mstr.$A.len(views),y=new Array(count),v,bHidden,bFoundHidden=false;for(var i=0;i<count;i++){v=views[i];if(!v){continue;}bHidden=((v.props&&!v.props.visible)||(!v.props&&!v.visible));if(bHidden){bFoundHidden=true;y[i]=mstr.utils.BoxModel.getElementSumOffsetTopAccurately((v.props&&v.props.element)||v.element,elScroll);if(y[i]==scrollTop){return i;}else{if(y[i]>scrollTop){if((i>0)&&(y[i-1]!=null)){return i-1;}return(y[i]>=scrollBottom)?-1:i;}else{if(scrollTop<y[i]+mstr.utils.BoxModel.getElementOuterHeight((v.props&&v.props.element)||v.element)){return i;}}}}}return bFoundHidden?-1:null;};VR.prototype._hideChildViewRange=function VR_hideChildViewRange(range){if(!range||(range.min<0)){return ;}var len=mstr.$A.len(this.props.views),max=Math.min(len-1,range.max);for(var i=range.min;i<=max;i++){this.execHideChild("views/"+i);}};VR.prototype._showChildViewRange=function VR_showChildViewRange(range){if(!range||(range.min<0)){return ;}var len=mstr.$A.len(this.props.views),max=Math.min(len-1,range.max);for(var i=range.min;i<=max;i++){this.execShowChild("views/"+i);}};VR.prototype.render=function VR_render(){if(this.props.renderViewsOnScroll){var count=parseInt(this.props.initialViewRenderCount);if(isNaN(count)||count<1){count=0;}this._hideChildViewRange({min:count,max:mstr.$A.len(this.props.views)-1});}mstr.views.ViewListBase.prototype.render.apply(this);var el=this.execLayoutHandler("scrollArea");this.props.scrollArea=el;if(el){el.onscroll=new Function("e","return mstr.controllers.Factory.obj('"+this.getId()+"').onScroll()");this.onScroll();}mstr.timers.renderStop=new Date();mstr.timers.render=mstr.timers.renderStop-mstr.timers.renderStart;};VR.prototype.onScroll=function VR_onScroll(){if(this.props.scrollingToSelectedChildView){return true;}if(this.props.afterScrollTimeoutId){self.clearTimeout(this.props.afterScrollTimeoutId);}if(this.props.renderViewsOnScroll){self.clearTimeout(this.props.afterScrollTimeoutId);this.props.afterScrollTimeoutId=self.setTimeout('mstr.controllers.Factory.obj("'+this.getId()+'").updateScrollArea()',parseInt(this.props.scrollPause)||200);}if(this.props.scrollTimeoutId){return true;}this.props.scrollTimeoutId=self.setTimeout('mstr.controllers.Factory.obj("'+this.getId()+'").updateSelectedView()',100);this.raiseEvent("sync_scroll");return true;};VR.prototype.updateScrollArea=function VR_updateScrollArea(){if(this.props.afterScrollTimeoutId){self.clearTimeout(this.props.afterScrollTimeoutId);}var i=this._computeFirstHiddenChildView();if(i==null){this.props.renderViewsOnScroll=false;}if(i==null||i<0){return ;}this._adjustScrollAreaBottomHeight(this.props.model.props.leadIndex,true);this.execShowChild("views/"+i);self.clearTimeout(this.props.afterScrollTimeoutId);this.props.afterScrollTimeoutId=self.setTimeout('mstr.controllers.Factory.obj("'+this.getId()+'").updateScrollArea()',parseInt(this.props.scrollPause)||200);};VR.prototype.updateSelectedView=function VR_updateSelectedView(){if(this.props.scrollTimeoutId){self.clearTimeout(this.props.scrollTimeoutId);this.props.scrollTimeoutId=null;}var m=this.props.model;if(!m){return ;}var index=this._computeFirstVisibleChildView();this.props.selectingFirstVisibleChildView=true;m.execCommand("SingleSelect",index);this.props.selectingFirstVisibleChildView=false;};function VR(props){mstr.views.ViewListBase.apply(this,[props]);}return VR;})();