mstr.behaviors.Generic=(function(){var G={};G.returnFalse=function(){return false;};G.returnTrue=function(){return true;};G.set_enabled=function T_set_enabled(rootTag,enabled){rootTag&&(rootTag.disabled=!enabled);};G.set_tooltip=function T_set_tooltip(rootTag,tooltip){rootTag&&(rootTag.title=(tooltip!=null)?tooltip:"");};G.clearBrowserHighlights=function G_clearBrowHigh(hWin){mstr.utils.Dom.clearBrowserHighlights(hWin);return true;};G.set_css_display=function G_set_css_display(el,displayShow,displayHide,bShow){if(el&&el.style){var v=!!bShow?displayShow:displayHide;if(!mstr.utils.ISW3C){if(v=="table"){v="block";}}el.style.display=v;}};G.toggleCellElement=function G_toggleCellElement(rootTag,rowIndex,cellIndex,childIndex,displayShow,displayHide,bShow){var elRow=(rowIndex>-1)&&rootTag&&rootTag.rows&&rootTag.rows[rowIndex];var elCell=elRow&&elRow.cells&&elRow.cells[cellIndex];var el=elCell&&elCell.childNodes&&elCell.childNodes[childIndex];this.set_css_display(el,displayShow,displayHide,bShow);};G.renderState=function G_renderState(el,state){if(!el){return ;}var borderColor=null;if(state&mstr.Enum.Widget.STATE.SELECTED){borderColor=mstr.Settings.Scheme.SELECTED_BORDERCOLOR;}else{if(state&mstr.Enum.Widget.STATE.HOVER){borderColor=mstr.Settings.Scheme.HOVER_BORDERCOLOR;}else{borderColor=mstr.Settings.Scheme.DEFAULT_BORDERCOLOR;}}if(borderColor!=null){el.style.border="1px "+borderColor+" solid";el.style.margin="0px";}else{el.style.border="0px";el.style.margin="1px";}var bgColor=null;if(!el.disabled&&(state&mstr.Enum.Widget.STATE.SELECTED)&&(state&mstr.Enum.Widget.STATE.HOVER)){bgColor=mstr.Settings.Scheme.SELECTED_HOVER_BGCOLOR;}else{if(state&mstr.Enum.Widget.STATE.SELECTED){bgColor=mstr.Settings.Scheme.SELECTED_BGCOLOR;}else{if(!el.disabled&&(state&mstr.Enum.Widget.STATE.HOVER)){bgColor=mstr.Settings.Scheme.HOVER_BGCOLOR;}else{bgColor=mstr.Settings.Scheme.DEFAULT_BGCOLOR;}}}el.style.backgroundColor=(bgColor!=null)?bgColor:"transparent";};G.oncontextmenu=function G_oncontextmenu(e,hWin,viewId){var view=mstr.$obj(viewId);var evt=new mstr.lang.Event(e,hWin);if(!view||!view.fireCommands){return true;}var isValidRMCModel=view.getModel().getRMCModel();if(view.props.enabled&&isValidRMCModel){view.execCommand("OpenPopup",{popup:mstr.$obj("RMCPopup1"),x:evt.x+3,y:evt.y+3});cancelEvent(e);return false;}return true;};G.on_model_set_validationStatus=function G_on_model_set_validationStatus(view,model,rootTag){if(view.props.visible&&view.props.enabled){var status=model&&model.get("validationStatus"),sc=status&&status.statusCode;if(sc&&sc!=mstr.Enum.Validation.STATUSCODE.VALID){var msg=model&&model.get("message");if(msg){alert(msg);}}}};return G;})();mstr.behaviors.MojoWidget=(function(){var MW={};MW.on_set_visible=function MW_on_set_visible(view,model,rootTag){var bShow=view.props.visible;mstr.behaviors.Generic.set_css_display(rootTag,"block","none",bShow);if(bShow){this.renderMojoWidget(view,model,rootTag);}};MW.renderMojoWidget=function MW_renderMojoWidget(view,model,rootTag){var props=view.props,id=props.id,cfg=props.cfg,uiCfg=cfg.ui,dataCfg=cfg.data,dataProp=cfg.dataProp,mojoConfig={};if(!mstr.utils.String.isEmpty(cfg)){try{uiCfg=eval("("+uiCfg+")")||{};}catch(ex){}mojoConfig=uiCfg;var data=dataProp&&model.props[dataProp]||{};if(dataProp===undefined){try{dataCfg=eval("("+dataCfg+")")||{};}catch(ex){}data=dataCfg;}}mojoConfig.placeholder=rootTag.lastChild;mojoConfig.id=id.replace("id_","");var fnHandlePropChanges=function(newV){var m=model.getAncestorByProperty(dataProp,true);if(m){m.set(dataProp,newV);}};switch(props.name){case"ACLEditor":mstr.$H.overwrite(mojoConfig,{acls:data});mojoConfig.onhasChangedChange=function(){var newV=this.getACLItems();fnHandlePropChanges(newV);};mojoConfig.getAvailableRightsForSelection=function(){return model.props.userSubscribeRights.items;};microstrategy.showSharingEditor(null,null,null,mojoConfig);break;}};return MW;})();mstr.behaviors.FloatingEditor=(function(){var FE={};FE.on_set_visible=function FE_on_set_visible(view,model,rootTag){var bShow=view.props.visible;if(view.get("isModal")){mstr.controllers.ModalEditors[bShow?"add":"remove"](view);}if(bShow){rootTag.style.zIndex=microstrategy.getMaxZIndex();}mstr.behaviors.Generic.set_css_display(rootTag,"block","none",bShow);};return FE;})();mstr.behaviors.TextBox=(function(){var T={};T.on_set_visible=function T_on_set_visible(view,model,rootTag){mstr.behaviors.Generic.set_css_display(rootTag,"block","none",view.props.visible);if(mstr.utils.ISIE4&&!rootTag.mstrInitialized){rootTag.mstrInitialized=true;var inputTag=rootTag.getElementsByTagName("input")[0];if(inputTag){var f1=inputTag.onfocus,f2=function(){view.textBoxInitialized=true;return true;};if(f1){inputTag.onfocus=function(){return f1.apply(this,arguments)&&f2.apply(null,arguments);};}else{inputTag.onfocus=f2;}var b1=inputTag.onblur,b2=function(){view.textBoxInitialized=false;return true;};if(b1){inputTag.onblur=function(){return b2.apply(null,arguments)&&b1.apply(this,arguments);};}else{inputTag.onblur=b2;}}self.setTimeout('mstr.behaviors.TextBox.initValue("'+view.getId()+'")',100);}};T.initValue=function T_initValue(viewId){var view=mstr.$obj(viewId);if(view){this.on_model_set_value(view,view.props.model,view.props.element);}};T.on_set_enabled=function T_on_set_enabled(view,model,rootTag){mstr.behaviors.Generic.set_enabled(rootTag,view.props.enabled);var elInput=rootTag.childNodes[1].childNodes[0];var en=view.props.enabled;mstr.behaviors.Generic.set_enabled(elInput,en);elInput.style.backgroundColor=en?"#ffffff":"#d4d0c8";};T.on_set_caption=function T_on_set_caption(view,model,rootTag){var elCaption=rootTag.childNodes[0];var txtCaption=view.props.caption;elCaption.childNodes[0].innerHTML=(txtCaption!=null)?txtCaption:"";mstr.behaviors.Generic.set_css_display(elCaption,"block","none",(txtCaption!=null)&&(txtCaption!=""));};T.on_set_size=function T_on_set_size(view,model,rootTag){var s=parseInt(view.props.size);if(!isNaN(s)){rootTag.childNodes[1].childNodes[0].size=s;}};T.on_set_maxlength=function T_on_set_maxlength(view,model,rootTag){var m=parseInt(view.props.maxlength);if(!isNaN(m)){rootTag.childNodes[1].childNodes[0].maxlength=m;}};T.on_model_set_dataType=function T_on_model_set_dataType(view,model,rootTag){var isNumeric=mstr.utils.Math.isDataTypeNumeric(model&&model.get("dataType"));rootTag.childNodes[1].childNodes[0].style.textAlign=isNumeric?"right":"left";};T.on_model_set_value=function T_on_model_set_value(view,model,elTextbox){var v=model&&model.get(view.get("valueField"));if(v==null){v="";}v+="";view.props.rendering=true;var sr=view.get("selectionRange");if(sr){window.setTimeout(function(){view.set("selectionRange",null);},0);}if(mstr.utils.ISIE4){if(!view.textBoxInitialized||!this._containDBCharacter(v)){elTextbox.value=v;}}else{if(elTextbox.value!=v){elTextbox.value=v;}}if(sr){mstr.utils.Controls.setSelectionRange(elTextbox,sr.start,sr.end);}view.props.rendering=false;view.set("validationStatus",{statusCode:mstr.Enum.Validation.STATUSCODE.VALID,message:"",bubble:true});};T._containDBCharacter=function _containDBCharacter(v){for(var i=0;i<v.length;i++){var c=v.charCodeAt(i);if(c>256&&!this._isDBCurSymbol(c)){return true;}}return false;};T._isDBCurSymbol=function _containDBCharacter(c){return(c==8364)||(c==8361)||(c==65509)||(c==65510);};T.on_value_change=function T_on_value_change(viewId,elTextbox,diskFile){var view=mstr.$obj(viewId);if(!view){return true;}if(view.props.rendering){return true;}var model=view.getModel();if(model){var v=mstr.utils.Math.convertStringToDataType(elTextbox&&elTextbox.value,model.get("dataType"));var imgPreview=document.getElementsByClassName("mstrImagePreview")[0];if(imgPreview){var preID=microstrategy.getViewerBone().doc.prevSelectedId,preEl=document.getElementById(preID);if(diskFile){var url=mstr.utils.Math.convertStringToDataType(window.URL.createObjectURL(diskFile),model.get("dataType"));diskFile.url=url;preEl.setAttribute("ut",mstr.Enum.IMAGE_URL_TYPE.IMAGE_NAME);imgPreview.blobURL=url;imgPreview.imgName=elTextbox.value;}else{imgPreview.blobURL=undefined;preEl.setAttribute("ut",mstr.Enum.IMAGE_URL_TYPE.HTTP_URL);}}var isValid=(!view.get("validator")||view.get("validator").validate(v));if(isValid){view.set("selectionRange",mstr.utils.Controls.getSelectionRange(elTextbox));if(imgPreview){model._storeDeltaProp("imgFile",diskFile);}model.set(view.props.valueField,v);model.set("isComplex",false);}}var zz=view.fireCommands&&view.fireCommands();return true;};T.on_file_selected=function T_on_file_selected(viewId,el){if(el.type!=="file"||!el.files[0]){return false;}var imgUrl=document.getElementById("imgUrl_txt"),file=el.files[0];el.value="";if(el.value!=""){var newEL=el.cloneNode(true);el.parentNode.appendChild(newEL);if(el.removeNode){el.removeNode(true);}}var name=file.name,accept=["image/jpeg","image/bmp","image/gif","image/png"],invalid=true;me=this,ONE_MB=1<<20,IMG_MAX_SIZE=3,ORI_MAX_SIZE=10;if(file.size>ORI_MAX_SIZE*ONE_MB||(file.size>IMG_MAX_SIZE*ONE_MB&&file.type==="image/gif")){mstrmojo.alert(mstrmojo.desc(14665,"Cannot embed an image larger than ##MB. Enter a URL to the image instead.").replace("##",IMG_MAX_SIZE));return false;}mstr.$A.forEach(accept,function(a){if(invalid&&file.type===a){var image=new Image(),reader=new FileReader();reader.onload=function(event){image.src=event.target.result;image.onload=function(){var img=file;if(file.size>IMG_MAX_SIZE*ONE_MB){var $IMGUTILS=mstrmojo.imageUtils,ratio=image.naturalWidth>=1920&&image.naturalHeight>=1080?45:75,outputType=file.type==="image/png"?"png":"jpg";compressImg=$IMGUTILS.compress(image,ratio,outputType);img=$IMGUTILS.dataURLToBlob(compressImg.src);if(img.size>IMG_MAX_SIZE*ONE_MB){mstrmojo.alert(mstrmojo.desc(14633,"Cannot embed an image larger than ##MB. Your image is still ###MB after compression. Enter a URL to the image instead.").replace("##",IMG_MAX_SIZE).replace("###",(img.size/ONE_MB).toFixed(1)));return false;}}imgUrl.value=name;me.on_value_change("imgUrl",imgUrl,img);};image.onerror=function(){mstrmojo.alert(mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."));return false;};};reader.onerror=function(){mstrmojo.alert(mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."));return false;};reader.readAsDataURL(file);invalid=false;return false;}});if(invalid){mstrmojo.alert(mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."));return false;}};T.on_keyPress=function T_on_keyPress(e,viewId){e=e||hWin.event;if(e.keyCode==13){var view=mstr.$obj(viewId);if(!view){return true;}var model=view.getModel();if(!model){return true;}if(!model.get("submitQueueOnEnter")){return true;}if(model.submitParentQueue){model.submitParentQueue();}return false;}return true;};T.on_set_validationStatus=function T_on_set_validationStatus(view,model,el){mstr.behaviors.Controls.on_set_validationStatus(view,model,el);if(!mstr.behaviors.Controls.needsValidation(view)){return true;}if(mstr.behaviors.Controls.validate(view)){el.style.backgroundImage="none";}else{el.style.background="#ffffff url(../style/mstr/images/errorLine.gif) bottom left repeat-x";}return true;};return T;})();mstr.behaviors.TextBoxWithIcon=(function(){var T={};T.on_set_enabled=function T_on_set_enabled(view,model,rootTag){var en=!!view.props.enabled;mstr.behaviors.Generic.set_enabled(rootTag,en);var elCells=rootTag.childNodes[1].rows[0].cells;var elInput=elCells[0].childNodes[0].firstChild;mstr.behaviors.Generic.set_enabled(elInput,en);elInput.style.backgroundColor=en?"#ffffff":"#d4d0c8";var elIcon=elCells[1].childNodes[0];mstr.behaviors.ToolButtonRounded.markAsEnabled(elIcon,en);};T.on_set_caption=function T_on_set_caption(view,model,rootTag){var elCaption=rootTag.childNodes[0];var txtCaption=view.props.caption;elCaption.childNodes[0].innerHTML=(txtCaption!=null)?txtCaption:"";mstr.behaviors.Generic.set_css_display(elCaption,"block","none",(txtCaption!=null)&&(txtCaption!=""));};T.on_set_size=function T_on_set_size(view,model,rootTag){var s=parseInt(view.props.size);if(!isNaN(s)){rootTag.childNodes[1].rows[0].cells[0].childNodes[0].size=s;}};T.on_set_maxlength=function T_on_set_maxlength(view,model,rootTag){var m=parseInt(view.props.maxlength);if(!isNaN(m)){rootTag.childNodes[1].rows[0].cells[0].childNodes[0].maxlength=m;}};T.on_model_set_valueString=function T_on_model_set_valueString(view,model,rootTag){var v=model&&model.get("valueString");if(v==null){v="";}rootTag.childNodes[1].rows[0].cells[0].childNodes[0].value=v;};T.onkeypress=function T_onkeypress(e,hWin,viewId,txtValue){e=e||hWin.event;if(e.keyCode==13){this.fire(viewId,txtValue);stopEventBubbling(e);return false;}return true;};T.fire=function T_fire(viewId,cmdValue){var view=mstr.$obj(viewId);if(view&&view.fireCommands&&!!view.props.enabled){view.fireCommands(null,cmdValue);}return true;};return T;})();mstr.behaviors.ToolButtonRounded=(function(){var TBR={};TBR.hover=function TBR_hover(rootTag){rootTag&&!rootTag.disabled&&(rootTag.style.backgroundPosition="center right");};TBR.unhover=function TBR_unhover(rootTag){rootTag&&!rootTag.disabled&&(rootTag.style.backgroundPosition="center left");};TBR.on_set_enabled=function TBR_on_set_enabled(view,model,rootTag){this.markAsEnabled(rootTag,!!view.props.enabled);};TBR.markAsEnabled=function TBR_markAsEnabled(el,enabled){if(!enabled){this.unhover(el);}mstr.behaviors.Generic.set_enabled(el,enabled);el.childNodes[0].style.backgroundPosition=enabled?"left center":"right center";el.childNodes[0].style.cursor=enabled?"pointer":"default";};return TBR;})();mstr.behaviors.ToolButton=(function(){var TB={};TB.hover=function TB_hover(rootTag){rootTag&&!rootTag.disabled&&mstr.behaviors.Generic.renderState(rootTag,mstr.Enum.Widget.STATE.HOVER);};TB.unhover=function TB_unhover(rootTag){rootTag&&mstr.behaviors.Generic.renderState(rootTag,0);};TB.on_set_enabled=function TB_on_set_enabled(view,model,rootTag){this.markAsEnabled(rootTag,!!view.props.enabled);};TB.markAsEnabled=function TB_markAsEnabled(el,enabled){if(!enabled){this.unhover(el);}mstr.behaviors.Generic.set_enabled(el,enabled);el.style.backgroundPosition=enabled?"left center":"right center";};return TB;})();mstr.behaviors.TextLink=(function(){var T={};T.on_set_enabled=function T_on_set_enabled(view,model,rootTag){var a=rootTag&&rootTag.childNodes[0];if(!a){return ;}var en=view.props.enabled;a.disabled=!en;if(en){a.className=a.className.replace("Disabled","");}else{a.className+="Disabled";}};return T;})();mstr.behaviors.TextFieldLabel=(function(){var T={};T.on_model_set_value=function T_on_model_set_value(view,model,elDiv){var v=model&&model.get(view.get("valueField"));if(v==null){v="";}v+="";elDiv.innerHTML=v;};return T;})();mstr.behaviors.TextDiv=(function(){var TD={};TD.on_set_caption=function TD_on_set_caption(view,model,rootTag){var elCaption=rootTag.childNodes[0];var txtCaption=view.props.caption;elCaption.innerHTML=(txtCaption!=null)?txtCaption:"";mstr.behaviors.Generic.set_css_display(elCaption,"block","none",(txtCaption!=null)&&(txtCaption!=""));};TD.on_model_set_value=function T_on_model_set_value(view,model,rootTag){var v=(model&&model.get&&model.get("value"))||model;if(v==null||v==undefined||typeof (v)!="string"){v="";}rootTag.childNodes[1].innerHTML=v;};return TD;})();mstr.behaviors.ListTextDiv=(function(){var TD={};TD.on_model_set_items=function TD_on_model_set_items(view,model,rootTag){rootTag.childNodes[1].innerHTML=this.buildObjectListString(model);};TD.buildObjectListString=function TD_buildObjectListString(items){var names=[];for(var i=0,len=mstr.$A.len(items);i<len;i++){names[i]=items[i]["n"];}return names.join(", ");};return TD;})();mstr.behaviors.Pulldown=(function(){var P={};P.onmousedown=function P_onmousedown(viewId){var view=mstr.$obj(viewId);var model=view.getModel&&view.getModel();if(view.props.enabled&&!this._showAsLabel(view,model)){if(view.get("opened")){view.execCommand("ClosePopup");}else{view.execCommand("OpenPopup");if(view.get("popup")&&view.get("popup").focus){view.get("popup").focus();}}}return true;};P.on_set_enabled=function P_on_set_enabled(view,model,rootTag){var en=!!view.props.enabled;rootTag.disabled=!en;var elCaption=rootTag.childNodes[0];elCaption.style.color=en?"#000000":"#808080";var elCellContent=rootTag.childNodes[1].rows[0].cells[1];elCellContent.style.color=en?"#000000":"#808080";elCellContent.style.backgroundColor=(this._showAsLabel(view,model))?"transparent":(en?"#ffffff":"#d4d0c8");elCellContent.style.cursor=(en&&!this._showAsLabel(view,model))?"pointer":"default";if(elCellContent.childNodes[1].firstChild){elCellContent.childNodes[1].firstChild.ignoreMouseEvents=!(en&&!this._showAsLabel(view,model));}var dv=view.get("disabledModelValue");if(!en&&dv!=undefined){model.execSingleSelect(dv);}};P.on_set_opened=function P_on_set_opened(view,model,rootTag){var elBtn=rootTag.childNodes[1].rows[0].cells[2].childNodes[0];if(view.props.opened){elBtn.className+="Pushed";}else{elBtn.className=elBtn.className.replace(/Pushed/,"");}};P.on_set_width=function P_on_set_width(view,model,rootTag){var w=view.props.width;if(w&&w!="auto"&&!w.match(/\%$/)){rootTag.style.width=w;rootTag.childNodes[1].style.width=w;rootTag.childNodes[1].style.tableLayout="fixed";var popup=view.props.popup;if(popup){popup.width=w;}}};P.on_set_enabled_colorPicker=function P_on_set_enabled_colorPicker(view,model,rootTag){var en=!!view.props.enabled;rootTag.disabled=!en;var elCellContent=rootTag.childNodes[1].rows[0].cells[1].childNodes[1];var actualColor=model.get("actualColor");if(actualColor&&actualColor.indexOf(",")>0){actualColor="#"+actualColor.split(",")[0];}elCellContent.style.backgroundColor=en?actualColor:"#a3a19d";};P.clickColorButton=function P_clickColorButton(id){var picker=mstr.$obj(id);var model=picker?picker.get("model"):null;var parent=model?model.get("parent"):null;var path=picker.props.modelPath;var propertyName=path.substring(path.lastIndexOf(mstr.controllers.Factory.PATHDELIM)+1,path.length);if(parent&&parent.exec){parent.exec(propertyName,model.get("actualColor"));}};P.showPulldownOrLabel=function P_showPulldownOrLabel(view,model,rootTag){var elButton=rootTag.childNodes[1].rows[0].cells[2];elButton.style.display=(!this._showAsLabel(view,model))?((mstr.utils.ISW3C)?"table-cell":"block"):"none";var elContent=rootTag.childNodes[1].rows[0].cells[1];var className=elContent.className;if(this._showAsLabel(view,model)){if(!/AsLabel$/.test(className)){className+="AsLabel";}}else{className=className.replace(/AsLabel$/,"");}elContent.className=className;};P._showAsLabel=function P_showAsLabel(view,model){var items=model&&model.props&&model.props.items;return(view.props.showSingleItemListAsLabel&&(items&&mstr.$A.len(items)==1));};P.on_model_set_readyState=function P_on_model_setReadyState(view,model,rootTag){var readyState=model&&model.get("readyState");view.set("message",null);var elCell=rootTag.childNodes[1].rows[0].cells[1];var elContent=elCell.childNodes[1];var elReadyState=elCell.childNodes[2];var bShowReadyState=false;if((readyState!=mstr.Enum.Widget.READYSTATE.IDLE)&&mstr.utils.Hash.isEmpty(model&&model.get("selectedIndices"))){bShowReadyState=true;}if(!bShowReadyState){elReadyState.style.display="none";elContent.style.display="block";this.showPulldownOrLabel(view,model,rootTag);}else{elContent.style.display="none";elReadyState.style.display="block";var htmlPrefix='<span class="'+(view.props.cssPrefix||"")+(view.props.cssClass||"")+'ReadyState">';var htmlSuffix="</span>";var html="";var descs=view.props.descriptors;switch(readyState){case mstr.Enum.Widget.READYSTATE.SUCCESS:html=descs&&descs.loadingText;break;case mstr.Enum.Widget.READYSTATE.CANCELLED:html=descs&&descs.requestCancelledText;break;case mstr.Enum.Widget.READYSTATE.WAITING:html=descs&&descs.waitingText;break;case mstr.Enum.Widget.READYSTATE.TIMEOUT:html="Request timed out.";break;case mstr.Enum.Widget.READYSTATE.ERROR:default:html=descs&&descs.requestTimeOutText;break;}elReadyState.innerHTML=htmlPrefix+html+htmlSuffix;}};return P;})();mstr.behaviors.ListView=(function(){var LV={};LV.on_set_height=function LV_on_set_height(view,model,rootTag){var ps=view&&view.props,el=ps&&ps.scrollArea,elS=el&&el.style,h=ps.height;if(elS&&h){elS.height=h;}};LV.on_set_width=function LV_on_set_width(view,model,rootTag){var ps=view&&view.props,el=ps&&ps.scrollArea,elS=el&&el.style,w=ps.width;if(!elS){return ;}if(w==""||w=="auto"){rootTag.style.width=elS.width=w;}else{if(w&&w.match(/\%$/)){rootTag.style.width=w;if(!mstr.utils.ISIE6){elS.width="auto";}}else{elS.width=(w!=null)?w:"";rootTag.style.width="auto";}}};LV.on_set_caption=function LV_on_set_caption(view,model,rootTag){var txt=view.props.caption!=null?view.props.caption:"";var elCaption=rootTag.rows[0].cells[0].firstChild.firstChild;mstr.behaviors.Generic.set_css_display(elCaption,"block","none",txt!="");elCaption.innerHTML=txt;};LV.on_set_message=function LV_on_set_message(view,model,rootTag){var ps=view&&view.props,message=ps&&ps.message,parent=ps&&ps.scrollArea,sibs=parent&&parent.childNodes;if(!sibs){return ;}if(message){sibs[0].style.display="none";sibs[1].style.display="none";sibs[2].style.display="block";sibs[2].firstChild.innerHTML=message;}else{sibs[0].style.display="block";sibs[1].style.display="none";sibs[2].style.display="none";}};LV.on_model_set_leadIndex=function LV_on_model_setLeadIndex(view,model,rootTag){var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(view);if(!itemRenderer||!itemRenderer.on_set_leadIndex){return false;}return itemRenderer.on_set_leadIndex(view,model,rootTag);};LV.on_model_set_readyState=function LV_on_model_setReadyState(view,model,rootTag){var readyState=model&&model.get("readyState");view.set("message",null);var elScroll=view.props.scrollArea,sibs=elScroll.childNodes,elReadyState=sibs[1],elListContainer=sibs[0];if(readyState==mstr.Enum.Widget.READYSTATE.IDLE){elReadyState.style.display="none";elListContainer.style.display="block";view._updateEmptyMessage();}else{var bHideItems=!view.props.showItemsDuringRequest;if(bHideItems){elListContainer.style.display="none";}elReadyState.style.display="block";var descs=view.props.descriptors;switch(readyState){case mstr.Enum.Widget.READYSTATE.SUCCESS:elReadyState.innerHTML=microstrategy.descriptors.getDescriptor("5674");break;case mstr.Enum.Widget.READYSTATE.CANCELLED:elReadyState.innerHTML="Request cancelled.";break;case mstr.Enum.Widget.READYSTATE.WAITING:elReadyState.innerHTML=microstrategy.descriptors.getDescriptor("5674");break;case mstr.Enum.Widget.READYSTATE.TIMEOUT:elReadyState.innerHTML="Request timed out.";break;case mstr.Enum.Widget.READYSTATE.ERROR:default:var msg=descs&&descs.errorText,ctxt=model&&model.props.requestContext,res=ctxt&&ctxt.response,msgDetail=res&&res.errorMessage&&res.errorMessage.replace(/[\r\n]/g,"");if(msgDetail){msg=msg+' <a href="javascript:void(0)" onclick="alert(\''+msgDetail.replace(/'/g,"\\'")+"');return false;\">"+descs.errorDetailsText+"</a>";}elReadyState.innerHTML=msg;break;}}};LV.ondblclick=function LV_ondblclick(e,hWin,viewId){var view=mstr.$obj(viewId);if(!view||!view.fireCommands||!view.props.enabled){return true;}var cmds=view.props.cmdsDblClick;if(!cmds){return true;}view.fireCommands(cmds,null);return true;};LV.onmousedown=function LV_onmousedown(e,hWin,viewId){var view=mstr.$obj(viewId);if(!view||!view.fireCommands||!view.props.enabled){return true;}var evt=new mstr.lang.Event(e,hWin);var bCTRL=evt.ctrl(),bSHIFT=evt.shift();if(bCTRL||bSHIFT){mstr.utils.Dom.clearBrowserHighlights(hWin);}var cmdValue={valueForm:null,ctrl:bCTRL,shift:bSHIFT,browseType:null,rmc:evt.rightClick()};var elTarget=evt.target();if(elTarget){elTarget.mstrViewId=viewId;}var elTargetAnc=mstr.utils.Dom.findAncestor(elTarget,"mstrListItemInfo",null,view.props[mstr.$W.ELEMENT],true);if(elTargetAnc){var listItemInfo=elTargetAnc.mstrListItemInfo.split("/");var viewId=listItemInfo.shift();var browseCommand=listItemInfo.pop();cmdValue.valueForm=listItemInfo.join("/");if(!bCTRL&&!bSHIFT&&!evt.rightClick()&&String(elTarget.nodeName).toLowerCase()=="a"){cmdValue.browseCommand=browseCommand;}}window.setTimeout(function(){view.fireCommands(null,cmdValue);},0);return true;};LV.on_set_visible=function LV_on_set_visible(view,model,rootTag){if(view.props.showDescriptions){var elScroll=view.props.scrollArea,sibs=elScroll.childNodes,elListContainer=sibs[0];elListContainer.className+=" mstrListWithDescriptions";}mstr.behaviors.Generic.set_css_display(rootTag,"table","none",view.props.visible);var id=view.props.id;if(mstr.utils.ISIE4&&!view.keysInited){var id=view.props.id;rootTag.attachEvent("onkeypress",function(e){mstr.$obj(id).onkeypress(e,window);});rootTag.attachEvent("onkeydown",function(e){mstr.$obj(id).onkeydown(e,window);});view.keysInited=true;}};LV.on_set_validationStatus=function LV_on_set_validationStatus(view,model,el){mstr.behaviors.Controls.on_set_validationStatus(view,model,el);if(!mstr.behaviors.Controls.needsValidation(view)){return true;}var vd=view&&view.get("validator");var cache=vd.get("cache");if(mstr.behaviors.Controls.validate(view)){if(cache){el.style.color=cache.c;el.style.textDecoration=cache.td;}}else{if(cache){cache.c=el.style.color;cache.td=el.style.textDecoration;}el.style.color="#ff0000";el.style.textDecoration="underline";}return true;};return LV;})();mstr.itemrenderers={};mstr.itemrenderers.FastListView=(function(){var FLV={};FLV.listItemHeightMin=function FLV_listItemHeightMin(view){return 20;};FLV.listItemHeight=function FLV_listItemHeight(view){return(view&&view.props.showDescriptions)?40:20;};FLV.listItemHeightMax=function FLV_listItemHeightMax(view){return(view&&view.props.showDescriptions)?40:20;};FLV.renderListItem=function FLV_renderListItem(view,model,rootTag,context){var item=context.item;var doc=view.props[mstr.$W.DOCUMENT];var css=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||"");if("enabled" in item&&!item.enabled){css+="Disabled";}var itemCls=css;if(item.cssClass){itemCls=view.props.cssPrefix+item.cssClass+" "+css;}var elDiv=doc.createElement("div");elDiv.className=itemCls;if(item.cssText){elDiv.style.cssText=item.cssText;}if(view&&view.props.showDescriptions){elDiv.style.height=this.listItemHeight(view)+"px";}elDiv.onmouseover=this.hover;elDiv.onmouseout=this.unhover;if(item.n!=null&&item.n!=""&&item.desc!=null&&item.desc!=""){elDiv.title=item.n+". "+item.desc;}else{if(item.n!=null&&item.n!=""&&item.dsn!=null&&item.dsn!=""){elDiv.title=item.n+" ("+item.dsn+")";}else{if(item.n!=null&&item.n!=""){elDiv.title=item.n;}else{if(item.desc!=null&&item.desc!=""){elDiv.title=item.desc;}}}}var elDivName=doc.createElement("div");elDiv.appendChild(elDivName);elDivName.className=css+"Name";if(view.props.showDescriptions&&item.desc){var elDivDesc=doc.createElement("div");elDiv.appendChild(elDivDesc);elDivDesc.className=css+"Desc";elDivDesc.appendChild(doc.createTextNode(item.desc));}else{var elDivDesc=null;}var elNameText=null;if(view.props.shouldReplaceSpace){var nameText=item.n.replace(/ /g,"\u00a0");elNameText=doc.createTextNode(nameText||"");}else{elNameText=doc.createTextNode(item.n||"");}var browseCommand=context.browseCommand;if(browseCommand&&!item.locked){var elHlink=doc.createElement("a");elDivName.appendChild(elHlink);elHlink.appendChild(elNameText);elHlink.href="javascript:void(0)";var cancelEvt=function(e){cancelEvent(e||window.event);return false;};elHlink.onclick=cancelEvt;elHlink.tabIndex=-1;elHlink.oncontextmenu=cancelEvt;browseCommand=null;}else{elDivName.appendChild(elNameText);}if(view.props.showIcons){var icon=item.icon;if(item.locked){icon+="_locked";}if(icon){mstr.utils.Dom.setBGIconClass(elDivName,icon);elDivName.style.backgroundPosition="2px 50%";elDivName.style.paddingLeft="23px";if(elDivDesc){elDivDesc.style.paddingLeft="23px";}}}return elDiv;};FLV.hover=function(e){if(!this.ignoreMouseEvents&&!/Hover$/.test(this.className)){this.className+="Hover";}};FLV.unhover=function(e){if(!this.ignoreMouseEvents){this.className=this.className.replace(/Hover/,"");}};FLV.markListItemAsSelected=function FLV_mLIasSelected(view,model,rootTag,context){if(view.get("ignoreSelection")){return ;}var el=context.elItem;if(!el){return ;}var c=el.className;if(/Hover/.test(c)){c=c.replace(/Hover/,"SelectedHover");}else{if(!/Selected/.test(c)){c+="Selected";}}el.className=c;};FLV.markListItemAsUnselected=function FLV_mLIasUnselected(view,model,rootTag,context){var el=context.elItem;if(!el){return ;}el.className=el.className.replace(/Selected/,"");};FLV.fireBrowse=function FLV_fireBrowse(){var info=this.mstrListItemInfo||this.parentNode.mstrListItemInfo||this.parentNode.parentNode.mstrListItemInfo;info=info&&info.split("/");if(info&&(info[0]!=null)&&(info[1]!=null)&&(info[2]!=null)){var view=mstr.controllers.Factory.obj(info[0]);var model=view&&view.getModel();if(model){model.execCommand(info[2],info[1]);}}return true;};FLV.on_set_leadIndex=function FLV_on_set_leadIndex(view,model,rootTag){var leadIndex=model&&model.get("leadIndex");if(leadIndex==null||leadIndex<0){return false;}var el=view&&view._getOrMakeElementForItemAt(leadIndex);if(!el){return false;}var elScroll=view.get("scrollArea")||rootTag.rows[0].cells[0].firstChild.childNodes[2];if(!elScroll){return false;}mstr.utils.BoxModel.scrollToElement(elScroll,el);};return FLV;})();mstr.itemrenderers.ListPulldownView=(function(){var LPV={};LPV.renderListItem=function(view,model,rootTag,context){var elDiv=mstr.itemrenderers.FastListView.renderListItem(view,model,rootTag,context);var elCont=this._getContentContainer(rootTag);mstr.utils.Dom.clearChild(elCont,0);elCont.appendChild(elDiv);elDiv.ignoreMouseEvents=!view.props.enabled||context.showAsLabel;elCont.title=elDiv.title||"";if(mstr.utils.ISIE4){var s=elCont.style,wasWidth=s.width;if(wasWidth==null){wasWidth="";}s.width="1px";s.width=wasWidth;}};LPV.renderMultipleItems=function(view,model,rootTag,context){var items=context.items;var len=mstr.$A.len(items);var s=new Array(len);for(var i=0;i<len;i++){s[i]=items[i]["n"];}s=s.join(", ");var el=this._getContentContainer(rootTag);el.innerHTML=s;el.title=s;};LPV.renderEmpty=function(view,model,rootTag,context){var css=(view.props.cssPrefix||"")+(view.props.cssClass||"");this._getContentContainer(rootTag).innerHTML='<span class="'+css+'EmptyText">'+view.props.descriptors.emptyText+"</span>";};LPV._getContentContainer=function(rootTag){return rootTag.childNodes[1].rows[0].cells[1].childNodes[1];};return LPV;})();mstr.itemrenderers.CheckList=(function(){var CLR={};CLR.renderListItem=function CLR_renderListItem(view,model,rootTag,context){if(context.at==0){var css=(view.props.cssPrefix||"")+(view.props.cssClass||"");var cssBody=css+(view.props.multiSelect?"Checks":"Radios");var arrHtml=['<table class="'+css+'Table" cellspacing="0" cellpadding="0">','<tbody class="'+cssBody+'" >'];if(view.props.horizontal){arrHtml=arrHtml.concat(this._buildHorizontalTableHTML(view,model,rootTag));}else{arrHtml=arrHtml.concat(this._buildVerticalTableHTML(view,model,rootTag));}arrHtml.push("</tbody></table>");var elCont=this._getListContainer(rootTag);if(elCont){elCont.innerHTML=arrHtml.join("");}}var elCell=this._findCellForIndex(view,rootTag,parseInt(context.at),!view.props.horizontal);return elCell&&elCell.childNodes[0];};CLR._buildHorizontalTableHTML=function CLR_buildHorizTable(view,model,rootTag){var items=model&&model.getItems(),len=mstr.$A.len(items),agSize=view&&parseInt(view.props.arrangementSize),cols=(!agSize||(agSize<1))?len:agSize,rows=mstr.utils.Math.roundUpDiv(len,cols);var arrHtml=[];if(rows&&cols){var itemIndex=0;for(var row=1;row<=rows;row++){arrHtml.push("<tr>");for(var col=1;col<=cols;col++){arrHtml.push(this._buildItemCell(view,model,rootTag,items[itemIndex++]));if(itemIndex>=len){break;}}arrHtml.push("</tr>");}}return arrHtml;};CLR._buildVerticalTableHTML=function CLR_buildVerticalTable(view,model,rootTag){var items=model&&model.getItems(),len=mstr.$A.len(items),agSize=view&&parseInt(view.props.arrangementSize),rows=(!agSize||(agSize<1))?len:agSize,cols=mstr.utils.Math.roundUpDiv(len,rows);var arrHtml=[];if(rows&&cols){var itemIndex;for(var row=1;row<=rows;row++){arrHtml.push("<tr>");for(var col=1;col<=cols;col++){itemIndex=(row-1)+(col-1)*rows;if(itemIndex>=len){break;}arrHtml.push(this._buildItemCell(view,model,rootTag,items[itemIndex++]));}arrHtml.push("</tr>");}}return arrHtml;};CLR._buildItemCell=function CLR_buildItemCell(view,model,rootTag,item){var cssText=(item.cssText&&item.cssText!="")?'" style="'+item.cssText:"";var css=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||"");if("enabled" in item&&!item.enabled){css+="Disabled";}var bMulti=!!view.props.multiSelect;var n=item.n;var desc=item.desc;var s=['<td><div onmouseover="return mstr.itemrenderers.CheckList.hover(this)" onmouseout="return mstr.itemrenderers.CheckList.unhover(this)" class="'+css+'" title="'+((desc!=null&&desc!="")?n+". "+desc:n)+cssText+'">'];var cssIconClassName=css+"Name";var paddingStyle="";if(view.props.showIcons){var icon=item.icon;if(item.locked){icon+="_locked";}if(icon){cssIconClassName=mstr.utils.Dom.getBGIconClass(icon)+" "+cssIconClassName;paddingStyle=' style="padding-left: 23px" ';}}s.push('<div class="'+cssIconClassName+'" '+paddingStyle+" >"+item.n+"</div>");if(view.props.showDescriptions){if((desc!=null)&&(desc!="")){s.push('<div class="'+css+'Desc" '+paddingStyle+" >"+desc+"</div>");}}return s.join("");};CLR.hover=function CLR_hover(el){el.className+="Hover";};CLR.unhover=function CLR_unhover(el){el.className=el.className.replace(/Hover/,"");};CLR._getListContainer=function CL_getListContainer(rootTag){return rootTag.rows[0].cells[0].firstChild.childNodes[2].firstChild;};CLR.markListItemAsSelected=function(view,model,rootTag,context){this._toggleCheckBox(view,model,rootTag,context,true);};CLR.markListItemAsUnselected=function(view,model,rootTag,context){this._toggleCheckBox(view,model,rootTag,context,false);};CLR._toggleCheckBox=function(view,model,rootTag,context,bChecked){view.props.rendering=true;var elCell=this._findCellForIndex(view,rootTag,parseInt(context.at),!view.props.horizontal);var elItem=elCell&&elCell.childNodes[0];if(elItem){if(bChecked){var c=elItem.className;if(!(/Selected/.test(c))){var c=elItem.className;if(/Hover/.test(c)){c=c.replace(/Hover/,"SelectedHover");}else{c+="Selected";}elItem.className=c;}}else{elItem.className=elItem.className.replace(/Selected/,"");}}view.props.rendering=false;};CLR._findCheckboxForIndex=function(view,rootTag,index,bColumnsFirst){return this._findCellForIndex(view,rootTag,index,bColumnsFirst);};CLR._findCellForIndex=function(view,rootTag,index,bColumnsFirst){var rowColInfo=this._computeRowColumnForIndex(view,index,bColumnsFirst);if(rowColInfo){return this._getListContainer(rootTag).firstChild.rows[rowColInfo.row].cells[rowColInfo.col];}};CLR._computeRowColumnForIndex=function(view,index,bColumnsFirst){var size=parseInt(view.props.arrangementSize);var row=(size&&size>0)?index%size:index;var col=(size&&size>0)?parseInt(index/size):0;if(bColumnsFirst){return{row:row,col:col};}else{return{row:col,col:row};}};return CLR;})();mstr.behaviors.Popup=(function(){var P={};P.on_set_visible=function P_on_set_visible(view,model,rootTag,context){var viewId=view.props.id;var unPopFunc=new Function("mstr.$obj('"+viewId+"').props['timeoutID'] = self.setTimeout(\"mstr.$obj('"+viewId+"').execCommand('Unpop');\", 500)");if((context&&context.init)||!view.props.animate){if(view.props.autoHide){rootTag.onmouseover=new Function("self.clearTimeout(mstr.$obj('"+viewId+"').props['timeoutID']);");rootTag.onmouseout=unPopFunc;}return mstr.behaviors.Generic.set_css_display(rootTag,"table","none",view.props.visible);}var vis=!!view.props.visible;if(view.props.autoHide&&vis){unPopFunc();}if(vis){mstr.behaviors.Generic.set_css_display(rootTag,"table","none",view.props.visible);}var callback=new Function("","mstr.behaviors.Popup.on_after_set_visible('"+view.props.id+"')");mstr.utils.Animations.alpha(rootTag,vis?0:100,vis?100:0,vis?5:15,callback);};P.on_after_set_visible=function P_on_after_set_visible(viewId){var view=mstr.$obj(viewId);if(!view){return ;}var vis=!!view.props.visible;var rootTag=view.props.element;if(!vis){mstr.behaviors.Generic.set_css_display(rootTag,"table","none",vis);}};P.origon_set_visible=function P_on_set_visible(view,model,rootTag){mstr.behaviors.Generic.set_css_display(rootTag,"table","none",view.props.visible);};return P;})();mstr.behaviors.Controls=(function(){var C={};C.on_model_set_value=function(view,model,element){if(element==null){return ;}var v=(model&&model.get&&model.get(view.props.valueField));view.props.rendering=true;if(element.tagName.toLowerCase()=="input"){switch(element.getAttribute("type").toLowerCase()){case"checkbox":element.checked=v||false;break;default:element.value=(v!=null&&v!=undefined)?v:"";view.fireCommands(null,model&&model.get&&model.get(view.props.valueField));break;}}else{element.innerHTML=v;}view.set("validationStatus",{statusCode:mstr.Enum.Validation.STATUSCODE.VALID,message:"",bubble:true});view.props.rendering=false;};C.on_set_validationStatus=function C_on_set_validationStatus(view,model,el){if(!mstr.behaviors.Controls.needsValidation(view)){return true;}var vd=view&&view.get("validator");var cache=vd.get("cache");var vs=view.get("validationStatus");if(mstr.behaviors.Controls.validate(view)){if(cache){el.style.borderColor=cache.b;el.setAttribute("title",cache.t);}}else{if(!cache){vd.set("cache",{b:el.style.borderColor,t:el.getAttribute("title")});}el.style.borderColor="#ff0000";el.setAttribute("title",vs.message);}return true;};C.needsValidation=function C_needsValidation(view){var vd=view&&view.get("validator");if(!vd){return false;}var vs=view.get("validationStatus");if(!vs){return false;}return true;};C.validate=function C_validate(view){var vs=view.get("validationStatus");return(vs.statusCode==mstr.Enum.Validation.STATUSCODE.VALID);};return C;})();mstr.behaviors.ListToolButton=(function(){var P={};P.onmousedown=function P_onmousedown(viewId){var view=mstr.$obj(viewId);if(view.props.enabled){view.execCommand("OpenPopup");}return true;};return P;})();mstr.models.PromptAnswer=(function(){mstr.$O.extendsClass(PA,mstr.models.BaseModel);PA.prototype.validate=function PA_validate(context,bFormat){var status=this._validateInternally(context,bFormat);this.set("message",this._getMsgForStatus(status.statusCode));this.set("validationStatus",status);return status.statusCode;};PA.prototype.format=function PA_format(context){return this.validate(context,true);};PA.prototype.execValidate=function PA_execValidate(context){return(this.validate(context)==mstr.Enum.Validation.STATUSCODE.VALID);};function PA(props){mstr.models.BaseModel.apply(this,[props]);}return PA;})();mstr.models.ConstantPromptAnswer=(function(){mstr.$O.extendsClass(CPA,mstr.models.PromptAnswer);CPA.prototype.getValueString=CPA.prototype.getSelected=function CPA_getValueString(){return this.props.isComplex?null:this.props.valueString;};CPA.prototype.isEmpty=function CPA_isEmpty(){var props=this.props,v=props.isComplex?props.complexString:props.valueString;return this._isEmptyAnswerString(v);};CPA.prototype._isEmptyAnswerString=function _isEmptyAnswerString(v){var isEmptyValue=false;var props=this.props;if(props&&props.dataType){var dtps=String(props.dataType).split(",");var en=mstr.Enum.Nodes.DATATYPE;var isString=false;for(var i=0;i<dtps.length;i++){if(mstr.utils.Math.isDataTypeString(dtps[i])){isString=true;break;}}if(isString){if(!v){isEmptyValue=true;}}else{isEmptyValue=mstr.utils.String.isEmpty(v);}}else{isEmptyValue=mstr.utils.String.isEmpty(v);}return isEmptyValue;};CPA.prototype.format=function CPA_format(context){var status=this._validateInternally(context,true);if(status.valueStringFormatted){this.set("valueString",status.valueStringFormatted);}this.set("message",this._getMsgForStatus(status.statusCode));this.set("validationStatus",status);return status;};CPA.prototype._validateInternally=function CPA_validateInternally(context,bFormatOutput){var enSC=mstr.Enum.Validation.STATUSCODE,status={statusCode:enSC.VALID,context:context&&context.stage};var checkingSavedAnswer=this.get("parent")&&this.get("parent").get("savingAnswer");var props=this.props;if(!props.isComplex){var stringStatus=this._validateString(props.valueString,bFormatOutput);status.statusCode=stringStatus.statusCode;status.valueStringFormatted=stringStatus.valueStringFormatted;}if(status.statusCode==enSC.VALID&&checkingSavedAnswer){status.statusCode=this.validateSavedAnswer();}return status;};CPA.prototype._validateString=function CPA_validateString(s,bFormatOutput){var enSC=mstr.Enum.Validation.STATUSCODE,status={statusCode:enSC.VALID},props=this.props;if(this._isEmptyAnswerString(s)){if(props.required){status.statusCode=enSC.NO_INPUT;}}else{if(props.dataType){var dtps=String(props.dataType).split(",");var arr=(mstr.utils.QualNode)?mstr.utils.QualNode.constValue2Array(s,!!props.multiSelect):[s],arrFormatted=bFormatOutput?arr.concat():[];var min=props.min,max=props.max,MU=mstr.utils.Math,LP=mstr.utils.LocaleParser;for(var i=0,len=arr.length;i<len;i++){var val=arr[i],match=LP.whichDataType(val,dtps,bFormatOutput),dtpMatch=bFormatOutput?match&&match.dataType:match,minMaxCheck;if(dtpMatch==null){status.statusCode=enSC.INVALID_DATATYPE;break;}else{if(bFormatOutput){arrFormatted[i]=match.formatted;}if(MU.isDataTypeNumeric(dtpMatch)){minMaxCheck=LP.inNumericRange(val,min,max);if(minMaxCheck){status.statusCode=(minMaxCheck>0)?enSC.EXCEEDS_MAX_VALUE:enSC.EXCEEDS_MIN_VALUE;break;}}else{if(MU.isDataTypeDateTime(dtpMatch)){minMaxCheck=LP.inDateTimeRange(val,min,max);if(minMaxCheck){status.statusCode=(minMaxCheck>0)?enSC.EXCEEDS_MAX_VALUE:enSC.EXCEEDS_MIN_VALUE;break;}}else{if(MU.isDataTypeString(dtpMatch)){minMaxCheck=LP.inNumericRange(val.length,min,max);if(minMaxCheck){status.statusCode=(minMaxCheck>0)?enSC.EXCEEDS_MAX_LENGTH:enSC.EXCEEDS_MIN_LENGTH;break;}}else{if(MU.isDataTypeBigDecimal(dtpMatch)){minMaxCheck=LP.inBigDecimalRange(val,min,max);if(minMaxCheck){status.statusCode=(minMaxCheck>0)?enSC.EXCEEDS_MAX_VALUE:enSC.EXCEEDS_MIN_VALUE;break;}}}}}}}if(bFormatOutput){status.valueStringFormatted=(mstr.utils.QualNode)?mstr.utils.QualNode.constArray2Value(arrFormatted):(arrFormatted&&arrFormatted.length>0)?arrFormatted[0]:null;}}}return status;};CPA.prototype.loadRequestResponse=function CPA_loadReqRes(){var ctxt=this.props.requestContext;var res=ctxt&&ctxt.response;if(!res||!res.data){this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);return ;}this.set("valueString",res.data.get("valueString"));var status=res.data.get("validationStatus");if(status&&status.statusCode!=mstr.Enum.Validation.STATUSCODE.VALID){this.set("message",this._getMsgForStatus(status.statusCode).replace("##",res.data.get("max")));this.set("validationStatus",status);}this.props.requestContext={};this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);};CPA.prototype.init=function CPA_init(){mstr.models.PromptAnswer.prototype.init.apply(this);if(!("CommandEnabledValidate" in this.props)){this.set("CommandEnabledValidate",true);}};function CPA(props){mstr.models.PromptAnswer.apply(this,[props]);}return CPA;})();mstr.models.ListModel=(function(){mstr.$O.extendsClass(LM,mstr.models.BaseModel);LM.RESERVED_LISTS={items:true};LM.RESERVED_HASHS={selectedIndices:true};LM.prototype.DEFAULTS={readyState:mstr.Enum.Widget.READYSTATE.IDLE};LM.prototype.sethash=function LM_sethash(n,v){var retVal=this.hashclear(n);if(v&&v.length){return this.hashadd(n,v);}else{return retVal;}};LM.prototype.setlist=function LB_setlist(n,v){var retVal=this.listclear(n);if(v&&v.length){return this.listadd(n,v);}else{return retVal;}};LM.prototype.execToggleSelect=function LM_exToggleSelect(index){if(this.props.selectedIndices[index]){this.execRemoveSelect(index);}else{this.execAddSelect(index);}this.set("leadIndex",index);return true;};LM.prototype.execAddSelect=function LM_exAddSelect(index){if(!mstr.utils.ListModelHelper.canAdd(this,this.getItems()[index])){return false;}var keys={};keys[index]=true;this.hashadd("selectedIndices",keys);this.props.anchorIndex=index;return true;};LM.prototype.execRemoveSelect=function LM_exRemoveSelect(index){var keys={};keys[index]=true;this.hashremove("selectedIndices",keys);if(this.props.anchorIndex==index){this.props.anchorIndex=-1;}return true;};LM.prototype.execRangeSelect=function LM_exRangeSelect(index){var a=this.props.anchorIndex;if(a<0){if(mstr.utils.ListModelHelper.canAdd(this,this.getItems()[index])){var keys={};keys[index]=true;this.hashadd("selectedIndices",keys);}}else{var keys={};var start=Math.min(index,a);var finish=Math.max(index,a);for(var i=start;i<=finish;i++){keys[i]=true;}if(this.execSelect(keys)){this.props.anchorIndex=a;}}this.set("leadIndex",index);return true;};LM.prototype.execSingleSelect=function LM_exSingleSelect(index){if(!this.props.enableReselect){var sel=this.props.selectedIndices;if(sel&&sel[index]){if(!mstr.utils.Hash.lenGreaterThan(sel,1)){return false;}}}var keys={};keys[index]=true;if(this.execSelect(keys)){this.props.anchorIndex=index;this.set("leadIndex",index);}return true;};LM.prototype.execRMCSelect=function LM_exRMCSelect(index){var sel=this.props.selectedIndices;if(sel&&sel[index]){return false;}var keys={};keys[index]=true;this.execSelect(keys);this.props.anchorIndex=index;return true;};LM.prototype.execSelect=function LM_exSelect(indices){indices=mstr.utils.ListModelHelper.verifySelectionKeys(this,indices);if(!indices){return false;}this.execClearSelect();this.hashadd("selectedIndices",indices);return true;};LM.prototype.execDeleteSelected=function LM_exDeleteSelected(){var selIndices=this.props.selectedIndices;var selCount=mstr.$H.len(selIndices);if(!selCount){return ;}var arrIndices=mstr.$A.sortNumericArray(mstr.$A.fromHashKeys(selIndices,true));this.removeItemsAt(arrIndices,true);};LM.prototype.execRenameSelectedItem=function LM_exRenameItem(newName){if(newName){var index=this.getSelectedIndex();if(index==null){return ;}var selected=this.props.items&&this.props.items[index];if(selected){this.removeItemsAt([index],true);selected.n=newName;this.insertItemsAt([selected],index);this.execSingleSelect(index);}}};LM.prototype.execEnableIndices=function LM_exEnableItem(values){var selected=mstr.utils.Hash.clone(this.getSelectedIndices());var resetSelections=false;for(var v in values){var index=this.indexOfValue(v);if(index==-1){continue;}var item=this.props.items&&this.props.items[index];if(!item||item.enabled==values[v]){continue;}if(selected[index]){resetSelections=true;}this.removeItemsAt([index],true);item.enabled=values[v];this.insertItemsAt([item],index);}if(resetSelections){this.execSelect(selected);}};LM.prototype.verifySelectionKeys=function LM_verifySelectionKeys(keys){var items=this.getItems();for(var i in keys){if(!mstr.utils.ListModelHelper.canAdd(this,items[i])){delete keys[i];}}return(mstr.utils.Hash.isEmpty(keys))?null:keys;};LM.prototype.execSelectPrevious=function LM_exSelectPrevious(isRangeSelect){var indices=this.props.selectedIndices;var selectedItems=this.getSelectedItems();var lastSelectedIndex=parseInt(this.props.leadIndex);var firstSelectedIndex=parseInt(this.props.anchorIndex);if(isRangeSelect){var highestSelectedIndex=mstr.utils.Hash.maxNumber(indices);if((firstSelectedIndex==lastSelectedIndex)&&selectedItems.length>1){var sel={};sel[lastSelectedIndex]=true;if((lastSelectedIndex-1)>=0){sel[lastSelectedIndex-1]=true;}this.execSelect(sel);}else{if(lastSelectedIndex<=highestSelectedIndex){if((lastSelectedIndex-1)>=0){this.execRangeSelect(lastSelectedIndex-1);}}else{this.execRemoveSelect(lastSelectedIndex);this.set("leadIndex",lastSelectedIndex-1);}}}else{if((lastSelectedIndex-1)>=0){this.execClearSelect();this.execSingleSelect(lastSelectedIndex-1);}}return true;};LM.prototype.execSelectNext=function LM_exSelectNext(isRangeSelect){var indices=this.props.selectedIndices;var selectedItems=this.getSelectedItems();var items=this.props.items;var lastSelectedIndex=parseInt(this.props.leadIndex);var firstSelectedIndex=parseInt(this.props.anchorIndex);if(isRangeSelect){if((firstSelectedIndex==lastSelectedIndex)&&selectedItems.length>1){var sel={};sel[lastSelectedIndex]=true;if((lastSelectedIndex+1)<items.length){sel[lastSelectedIndex+1]=true;}this.execSelect(sel);}else{if(lastSelectedIndex>=firstSelectedIndex){if((lastSelectedIndex+1)<items.length){this.execRangeSelect(lastSelectedIndex+1);}}else{this.execRemoveSelect(lastSelectedIndex);this.set("leadIndex",lastSelectedIndex+1);}}}else{if((lastSelectedIndex+1)<items.length){this.execClearSelect();this.execSingleSelect(lastSelectedIndex+1);}}return true;};LM.prototype.execSingleSelectNextAndLoop=function LM_exSingleSelectNextAndLoo(){var selectedIndicesList=this.props.selectedIndicesList;if(isNaN(selectedIndicesList)){return false;}var selectedIndex=parseInt(selectedIndicesList);var numItems=this.props.items.length;var newSelectedIndex;if(selectedIndex+1<numItems){newSelectedIndex=selectedIndex+1;}else{newSelectedIndex=0;}this.execSingleSelect(newSelectedIndex);return true;};LM.prototype.execSelectString=function LM_execSelectString(s,form,skip){if(!s){return false;}if(!form){form="n";}var regExp=new RegExp("^"+s,"i"),index=mstr.$A.matchByForm(this.getItems(),regExp,form,this.props.leadIndex+((skip===undefined)?1:skip));return(index>-1)&&this.execSingleSelect(index);};LM.prototype.execSelectValue=function LM_execSelectValue(v){var index=this.indexOfValue(v);if(index==-1){return false;}this.execSingleSelect(index);return true;};LM.prototype.execSelectValues=function LM_execSelectValues(v){if(!v){return false;}if(typeof (v)=="string"){v=[v];}var indices={};for(var i=0;i<v.length;i++){var index=this.indexOfValue(v[i]);if(index!=-1){indices[index]=true;}}if(mstr.utils.Hash.isEmpty(indices)){return false;}return this.execSelect(indices);};LM.prototype.getSelectedIndices=function LM_getSelectedIndices(){return this.props.selectedIndices;};LM.prototype.getSelectedIndex=function LM_getSelectedIndex(){var index=parseInt(mstr.$H.firstKey(this.props.selectedIndices));if(index!=null&&!isNaN(index)){return index;}return -1;};LM.prototype.getSelectedItems=function LM_getSelectedItems(bSort){var items=this.props.items;if((!items||!items.length)&&this.props.keptSelections){return[].concat(this.props.keptSelections);}else{var selIndices=this.props.selectedIndices;var indices=(bSort)?mstr.$A.sortNumericArray(mstr.$A.fromHashKeys(selIndices,true)):selIndices;if(indices){var sel=[];for(var i in indices){var item=(bSort)?items[indices[i]]:items[parseInt(i)];if(item){sel.push(item);}}return sel;}}return null;};LM.prototype.getSelectedItem=function LM_getSelectedItem(){var indices=this.props.selectedIndices;if(indices){var items=this.props.items;for(var i in indices){return items[parseInt(i)];}}return null;};LM.prototype.getSelectedItemValue=function LM_getSelectedItemValue(){var item=this.getSelectedItem();var v=item&&item[this.get("valueForm")];return v||null;};LM.prototype.setSelectedItems=function LM_setSelectedItems(items){var findResults=this.indexOfMultiple(items,false);if(findResults&&findResults.foundCount){this.execSelect(mstr.$A.toHash(findResults.indices));}else{this.execClearSelect();}};LM.prototype.execClearSelect=function LM_exClearSelect(){var currentSel=mstr.$H.clone(this.props.selectedIndices);this.hashremove("selectedIndices",currentSel);this.props.anchorIndex=-1;this.props.leadIndex=-1;};LM.prototype.execSelectAll=function LM_execSelectAll(){var indices=[];var items=this.getItems();for(var i=0;i<items.length;i++){indices.push(true);}this.execSelect(indices);};LM.prototype.queryEnabledSelectAll=function LM_qryEnSelectAll(){return(this.getSelectedIndices().length!=this.getItems().length);};LM.prototype.getItems=function LM_getItems(){return this.props.items;};LM.prototype.setItems=function LM_setItems(items){this.execClearSelect();var oldLen=mstr.$A.len(this.props.items);if(oldLen){var range={min:0,max:oldLen-1};this.removeItemsAtRanges([range],true);}this.insertItemsAt(items,0);if(this.props.autoSelectFirstItem&&!this.props.defaultSelection&&this.getSelectedIndex()==-1){this.execSelect({0:true});}};LM.prototype.insertItemsAt=function LM_insertItemsAt(items,index){if(index==null||index<0){index=mstr.$A.len(this.props.items);}var count=mstr.$A.len(items);if(!count){return -1;}var selIndices=this.props.selectedIndices;if(selIndices){var adjustedIndices={};for(var selIndex in selIndices){if(parseInt(selIndex)>=index){selIndex=parseInt(selIndex)+count;}adjustedIndices[selIndex]=true;}this.props.selectedIndices=adjustedIndices;}this.listadd("items",items,index);this._updateCommandEnabledUpDown();return index;};LM.prototype.removeItems=function LM_removeItems(items){var findResults=this.indexOfMultiple(items,false);if(findResults&&findResults.foundCount){this.removeItemsAt(findResults&&findResults.indices);}};LM.prototype.removeItemsAt=function LM_removeItemsAt(indices,sorted){if(!mstr.$A.len(indices)){return ;}var ranges=mstr.utils.Math.convertIndicesToRanges(indices,sorted);this.removeItemsAtRanges(ranges,true);};LM.prototype.removeItemsAtRanges=function LM_removeItemsAtRanges(ranges,sorted){if(!mstr.utils.Hash.isEmpty(this.props.selectedIndices)){var rangesSorted1=sorted?ranges:ranges.concat().sort(mstr.$A.rangeSorter);mstr.$H.remove(this.props.selectedIndices,mstr.utils.Hash.fromRanges(rangesSorted1));}var rangesSorted=this.listremove("items",ranges,sorted);if(!mstr.utils.Hash.isEmpty(this.props.selectedIndices)){var selArray=mstr.$A.sortNumericArray(mstr.$A.fromHashKeys(this.props.selectedIndices,true));var lenSel=mstr.$A.len(selArray);for(var i=0,lenRanges=mstr.$A.len(rangesSorted);i<lenRanges;i++){var min=rangesSorted[i].min;var max=rangesSorted[i].max;for(var removedIndex=max;removedIndex>=min;removedIndex--){for(var j=lenSel-1;j>-1;j--){if(selArray[j]<removedIndex){break;}selArray[j]--;}}}this.props.selectedIndices=mstr.$A.toHash(selArray);}else{var firstIndex=Math.max(rangesSorted[0].min,0);var len=mstr.$A.len(this.props.items);if(len){this.execSingleSelect(Math.min(len-1,firstIndex));}else{this._updateCommandEnabledUpDown();}}};LM.prototype.execUp=function LM_execUp(){var sel=this.props.selectedIndices,ranges=mstr.utils.Math.convertIndicesToRanges(mstr.$A.fromHashKeys(sel,true),false);var range,item;for(var i=0,len=mstr.$A.len(ranges);i<len;i++){range=ranges[i];if(range&&range.min&&(range.max>=range.min)){item=this.props.items[range.min-1];this.removeItemsAtRanges([{min:range.min-1,max:range.min-1}],true);this.insertItemsAt([item],range.max);sel[range.min-1]=true;sel[range.max]=false;}}this._updateCommandEnabledUpDown();return true;};LM.prototype.execDown=function LM_execDown(){var sel=this.props.selectedIndices,ranges=mstr.utils.Math.convertIndicesToRanges(mstr.$A.fromHashKeys(sel,true),false);var range,lastIndex=mstr.$A.len(this.props.items)-1,item;for(var i=0,len=mstr.$A.len(ranges);i<len;i++){range=ranges[i];if(range&&(range.max>-1)&&(range.max<lastIndex)){item=this.props.items[range.max+1];this.removeItemsAtRanges([{min:range.max+1,max:range.max+1}],true);this.insertItemsAt([item],range.min);sel[range.min]=false;sel[range.max+1]=true;}}this._updateCommandEnabledUpDown();return true;};LM.prototype.on_hashadd_selectedIndices=LM.prototype.on_hashremove_selectedIndices=function LM_on_change_selectedIndices(evt){if(evt&&evt.src==this){this._updateCommandEnabledUpDown();}var indices=mstr.utils.Arrays.fromHashKeys(evt.memo.at);this.props.selectedIndicesList=indices.join(",");var sel=this.props.selectedIndices;this.set("selectedCount",mstr.utils.Hash.len(sel));};LM.prototype.on_set_selectedIndicesList=function LM_on_set_selectedIndicesList(evt){this.execSelect(mstr.utils.Arrays.toHash(String(evt.memo.value).split(",")));};LM.prototype._updateCommandEnabledUpDown=function LM_updateCommandEnabledUpDown(){var indices=this.props.selectedIndices,lastIndex=mstr.$A.len(this.props.items)-1,index;var bUpEnabled=false,bDownEnabled=false;for(var i in indices){index=parseInt(i);if(!bUpEnabled){bUpEnabled=index&&!indices[index-1];}if(!bDownEnabled){bDownEnabled=(index<lastIndex)&&!indices[index+1];}if(bUpEnabled&&bDownEnabled){break;}}this.set("CommandEnabledUp",bUpEnabled);this.set("CommandEnabledDown",bDownEnabled);};LM.prototype.indexOfItem=function LM_indexOfItem(item){var vf=this.props.valueForm;if(vf!=null&&!item.get){return mstr.$A.findByForm(this.props.items,item&&item[vf],vf);}else{return mstr.$A.find(this.props.items,item);}};LM.prototype.indexOfValue=function LM_indexOfValue(v){var ic=false,vf,value,cs;if(v instanceof Object){vf=v.form||this.props.valueForm;value=v.value;ic=v.ignoreCase?true:false;}else{vf=this.props.valueForm;value=v;}if(vf!=null){var items=this.props.items;if(items&&items[0]&&items[0].get){return mstr.$A.findByGetter(this.props.items,"get",value,vf);}else{return mstr.$A.findByForm(this.props.items,value,vf,ic);}}return -1;};LM.prototype.indexOfMultiple=function LM_indexOfMultiple(items,includePlaceholders){var vf=this.props.valueForm;if(vf!=null){return mstr.$A.findByFormMultiple(this.props.items,items,vf,includePlaceholders);}else{return mstr.$A.findMultiple(this.props.items,items,includePlaceholders);}};LM.prototype.getContainerTree=function LM_getContainerTree(){var pt=this.props.containerTree;if(!pt){pt=this.setContainerTree(this.props.container);}return pt;};LM.prototype.setContainerTree=function LM_setContainerTree(container){var pt=new mstr.models.TreeModel({parent:this,valueForm:this.props.valueForm,scriptClass:"mstr.models.TreeModel"});mstr.controllers.Factory.add(pt);if(container){var newRoot={value:container};pt.setRootNode(newRoot);pt.execCommand("SingleSelect",newRoot);}this.props.containerTree=pt;return pt;};LM.prototype.getContainer=function LM_getContainer(){var pt=this.getContainerTree();if(pt){return pt.getSelectedNode&&pt.getSelectedNode();}return null;};LM.prototype.execBrowseListItem=function LM_execBrowseListItem(cmdValue){if(cmdValue&&cmdValue.browseCommand&&cmdValue.valueForm!=null){return this.execCommand(cmdValue.browseCommand,cmdValue.valueForm);}return false;};LM.prototype.execBrowseFolder=function LM_execBrowseFolder(folder){var folderId,folderObject;if(folder&&folder.dssid!=null){folderId=folder.dssid;folderObject=folder;}else{if(typeof (folder)=="string"){folderId=folder;}}if(folderId){return this.browseFolderBlock(folderId,1,null,folderObject);}return false;};LM.prototype.browseFolderBlock=function LM_browseFolderBlock(folderId,blockBegin,searchPattern,folderItem,memo){if(!blockBegin||blockBegin<0){return false;}if(!folderId&&!this.props.searchXML){return false;}var inputs;if(!memo){memo={};}if(searchPattern!=null&&searchPattern!=""){inputs=new mstr.http.MetadataSearchRequestInputs(folderId||"",blockBegin,(this.props.blockCount&&!this.props.blockCountAuto)?this.props.blockCount:mstr.utils.ListViewHelper.getFetchBlockForTask("searchMetadata"),this.props.totalSize||0,this.props.objectType,this.props.searchXML||"",searchPattern,this.props.dataSourcesXML);if(!memo.commandId){memo.commandId="Search";}memo.searchPattern=searchPattern;memo.item=folderItem;var sf=this.props.searchFlags;if(sf&&(sf&256)==0&&(sf&1024)==0){inputs.params.recursive=0;}}else{inputs=new mstr.http.BrowseFolderRequestInputs(folderId||"",blockBegin,(this.props.blockCount&&!this.props.blockCountAuto)?this.props.blockCount:mstr.utils.ListViewHelper.getFetchBlockForTask("searchMetadata"),this.props.totalSize||0,this.props.hierarchical,this.props.objectType,this.props.searchXML||"",this.props.dataSourcesXML);if(!memo.commandId){memo.commandId="BrowseFolder";}if(this.props.styleName){inputs.params.styleName=this.props.styleName;}memo.item=folderItem;}this.submitRequest(inputs,memo);return true;};LM.prototype.canBrowseFolder=function LM_canBrowseFolder(item){if(item){switch(parseInt(item.tp)){case mstr.Enum.MSTRFolderItem.TYPE.FOLDER:case mstr.Enum.MSTRFolderItem.TYPE.PROJECT:return true;}}return false;};LM.prototype.canBrowseHierarchy=function LM_canBrowseHierarchy(item){return false;};LM.prototype._loadResults=function LM_loadResults(results){this.set("readyState",mstr.Enum.Widget.READYSTATE.SUCCESS);this.set("searchPattern",(results&&results.searchPattern)||"");this.set("totalSize",(results&&results.totalSize)||0);this.set("blockBegin",(results&&results.blockBegin)||1);this.set("blockCount",(results&&results.blockCount)||this.props.blockCount||1);this.set("leafElements",!!(results&&results.leafElements));this._appendBrowsedItemsToContainerTree((results&&results.browsedItems)||[],(results&&results.browsedItemsSiblings)||[]);this.set("rmc",(results&&results.rmc)||null);if(this.props.headerModel){this.updateHeaderModel();}var listItems=(results&&results.listItems)||[];if(this.props.prefixItems){listItems=listItems.concat(this.props.prefixItems);}this.setItems(listItems);this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);};LM.prototype.execBrowseContainerTreeNode=function LM_BrowseContainerTreeNode(node){var item=node&&node.value;if(!item){return false;}switch(parseInt(item.tp)){case mstr.Enum.MSTRFolderItem.TYPE.FOLDER:case mstr.Enum.MSTRFolderItem.TYPE.PROJECT:return this.browseFolderBlock(item[this.props.valueForm],1,null,item,{commandId:"BrowseContainerTreeNode",node:node});default:if(mstr.utils.ListViewHelper.isWithinHierarchy(node)){if(this.isElementSearchRequired(node)){var tm=this.getContainerTree();if(tm){tm.removeAllChildNodes(node);tm.execSelect([node]);}this._loadResults({browsedItems:null,browsedItemsSiblings:null,listItems:[],totalSize:0,blockBegin:1});return true;}else{var autoExpand=this.canAutoExpandOnDrill(),nodeToBrowse=node;var nv=nodeToBrowse&&nodeToBrowse.value;if(autoExpand&&nv&&nv.filters&&nv.filters.length==1){if(!nodeToBrowse.children||nodeToBrowse.children.length==0){this._loadResults({browsedItems:[nv.filters[0]],browsedItemsSiblings:[[nv.filters[0]]],listItems:[],totalSize:0,blockBegin:1});}nodeToBrowse=nodeToBrowse.children[0];}return this.browseHierarchyBlock(this._buildHierarchyPathForNode(nodeToBrowse),1,"",{commandId:"BrowseContainerTreeNode",node:nodeToBrowse});}}else{if(this._isDummyNode(node)){var childItems=[];if(node.children){for(var n in node.children){if(node.children[n].value){childItems.push(node.children[n].value);}}}var tm=this.getContainerTree();if(tm){tm.removeAllChildNodes(node);tm.execSelect([node]);}this._loadResults({browsedItems:null,browsedItemsSiblings:null,listItems:childItems,totalSize:0,blockBegin:1});return true;}}}return false;};LM.prototype.execBrowseContainerParent=function LM_BrowseContainerParent(){var conNode=this.getContainer();if(conNode&&conNode.parent){var autoExpand=this.canAutoExpandOnDrill&&this.canAutoExpandOnDrill(),nodeToBrowse=conNode.parent;if(autoExpand&&mstr.utils.ListViewHelper.isWithinHierarchy(nodeToBrowse)){var nv=nodeToBrowse&&nodeToBrowse.value;if(nv&&nv.filters&&nv.filters.length==1){nodeToBrowse=nodeToBrowse.parent||nodeToBrowse;}}return this.execBrowseContainerTreeNode(nodeToBrowse);}return false;};LM.HIERARCHY_PATHDELIM="~";LM.ELE_FILTER_ATT_DELIM=",";LM.prototype._getNodeFromBrowsePath=function LM_getNodeFromBrowsePath(node,itemValue){while(node){browsePathItem=node.value;if(!browsePathItem){break;}tp=parseInt(browsePathItem.tp);if(tp==mstr.Enum.MSTRFolderItem.TYPE.PROJECT||tp==mstr.Enum.MSTRFolderItem.TYPE.FOLDER||tp==mstr.Enum.MSTRFolderItem.TYPE.DIMENSION){break;}if(browsePathItem[this.props.valueForm]==itemValue){return node;}node=node.parent;}return null;};LM.prototype.execFetchBlock=function LM_execFetchBlock(blockBegin){if(!blockBegin){return ;}return this.fetchBlock(blockBegin,this.props.searchPattern);};LM.prototype.execFetchData=function LM_execFetchData(){if(this.shouldFetchData()){var rs=this.props.readyState;if(rs==null||rs==mstr.Enum.Widget.READYSTATE.IDLE){return this.execCommand("FetchFirst");}}return false;};LM.prototype.shouldFetchData=function LM_shouldFetchData(){if(this.props.totalSize==null){if(this.props.prefixItems){return(mstr.$A.len(this.props.items)-mstr.$A.len(this.props.prefixItems))<=0;}else{return !mstr.$A.len(this.props.items);}}return false;};LM.prototype.fetchBlock=function LM_fetchBlock(blockBegin,searchPattern){var conNode=this.getContainer();if(!conNode){return false;}switch(conNode.value&&parseInt(conNode.value.tp)){case mstr.Enum.MSTRFolderItem.TYPE.FOLDER:case mstr.Enum.MSTRFolderItem.TYPE.PROJECT:return this.browseFolderBlock(conNode.value.dssid,blockBegin,searchPattern,conNode.value);break;default:if(mstr.utils.ListViewHelper.isWithinHierarchy(conNode)){if(!searchPattern&&this.isElementSearchRequired(conNode)){this._loadResults({browsedItems:null,browsedItemsSiblings:null,listItems:[],totalSize:0,blockBegin:1,searchPattern:searchPattern});return true;}else{return this.browseHierarchyBlock(this._buildHierarchyPathForNode(conNode),blockBegin,searchPattern,{commandId:"BrowseContainerTreeNode",node:conNode,searchPattern:searchPattern});}}else{if(parseInt(conNode.value.tp)==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE){if(!searchPattern&&this.isElementSearchRequired(conNode)){this._loadResults({browsedItems:null,browsedItemsSiblings:null,listItems:[],totalSize:0,blockBegin:1,searchPattern:searchPattern});return true;}else{return this.browseAttributeBlock(conNode.value.dssid,blockBegin,searchPattern);}}}break;}};LM.prototype.execFetchFirst=function LM_execFetchFirst(){return this.execFetchBlock(1);};LM.prototype.execFetchPrevious=function LM_execFetchPrevious(){return this.execFetchBlock(this._computePreviousBlockBegin());};LM.prototype.execFetchNext=function LM_execFetchNext(){return this.execFetchBlock(this._computeNextBlockBegin());};LM.prototype.execFetchLast=function LM_execFetchLast(){return this.execFetchBlock(this._computeLastBlockBegin());};LM.prototype.queryEnabledFetchFirst=function LM_qryEnFetchFirst(){var s=this.props.totalSize;var bc=this.props.blockCount;return(s>0)&&(bc>0)&&(this.props.blockBegin>1);};LM.prototype.queryEnabledFetchPrevious=function LM_qryEnFetchPrevious(){var b=this.props.blockBegin;return(b>1)&&(this._computePreviousBlockBegin()<b);};LM.prototype.queryEnabledFetchNext=function LM_qryEnFetchNext(){return this._computeNextBlockBegin()>0;};LM.prototype.queryEnabledFetchLast=function LM_qryEnFetchLast(){var b=this.props.blockBegin;return b>0&&(this._computeLastBlockBegin()>=b+this.props.blockCount);};LM.prototype._computePreviousBlockBegin=function LM_compPrevBB(){var s=this.props.totalSize;var bc=this.props.blockCount;if(s>0&&bc>0){return Math.max(1,this.props.blockBegin-bc);}return -1;};LM.prototype._computeNextBlockBegin=function LM_compNextBB(){var s=this.props.totalSize;var bc=this.props.blockCount;if(s>0&&bc>0){if(this.props.blockBegin+bc<=s){return this.props.blockBegin+bc;}}return -1;};LM.prototype._computeLastBlockBegin=function LM_compLastBB(){var s=this.props.totalSize;var bc=this.props.blockCount;if(s>0&&bc>0){var offset=s%bc;if(offset==0){offset=bc;}return s-offset+1;}return -1;};LM.prototype.getFetchBlockModel=function LM_getFetchBlockModel(){var bCached=false;var model=this.props.fetchBlockModel;if(model){bCached=(model.get("blockBegin")==this.props.blockBegin)&&(model.get("totalSize")==this.props.totalSize);}if(!bCached){var s=parseInt(this.props.totalSize)||0;var props={min:Math.min(1,s),max:s,dataType:mstr.Enum.Nodes.DATATYPE.INTEGER,valueString:parseInt(this.props.blockBegin)||""};model=new mstr.models.ConstantPromptAnswer(props);if(model){mstr.controllers.Factory.add(model);model.init&&model.init();this.props.fetchBlockModel=model;}}return model;};LM.prototype.execSearch=function LM_execSearch(searchPattern){this.fetchBlock(1,searchPattern);};LM.prototype.on_set_readyState=function LM_on_set_readyState(evt){if(evt&&evt.src==this){this._updateCommandEnabledSearch();this._updateCommandEnabledFetchBlock();this._updateCommandEnabledBrowseFolder();}};LM.prototype._updateCommandEnabledSearch=function LM_updateCommandEnabledSearch(){var en=false;var mcAvail=false;if(this.props.readyState==mstr.Enum.Widget.READYSTATE.IDLE){var conNode=this.getContainer(),conItem=conNode&&conNode.value,tp=conItem&&parseInt(conItem.tp);switch(tp){case mstr.Enum.MSTRFolderItem.TYPE.FOLDER:en=true;break;case mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE:var items=this.props.items,prefixItems=this.props.prefixItems,firstItem=items&&items[(prefixItems?prefixItems.length:0)];en=(!this.props.elementSearchDisabled)&&(!firstItem||(parseInt(firstItem.tp)==mstr.Enum.MSTRFolderItem.TYPE.ELEMENT));mcAvail=en&&!this.props.matchCaseDisabled;break;case mstr.Enum.MSTRFolderItem.TYPE.FILTER:en=(conNode.readyState==null)||(conNode.readyState==mstr.Enum.Widget.READYSTATE.IDLE);en=en&&(!this.props.elementSearchDisabled);en=en&&mstr.utils.ListViewHelper.isWithinHierarchy(conNode);mcAvail=en&&!this.props.matchCaseDisabled;break;}}else{if(this.props.readyState==mstr.Enum.Widget.READYSTATE.ERROR){var sp=this.props.requestContext&&this.props.requestContext.memo&&this.props.requestContext.memo.searchPattern;if(sp){en=true;}}}this.set("CommandEnabledSearch",en);this.set("searchMatchCaseAvailable",mcAvail);};LM.prototype._updateCommandEnabledBrowseFolder=function LM_updateCommandEnabledBrowseFolder(){var rs=this.props.readyState,bIsIdle=(rs==mstr.Enum.Widget.READYSTATE.IDLE),bIsIdleErr=bIsIdle||(rs==mstr.Enum.Widget.READYSTATE.ERROR);this.set("CommandEnabledBrowseFolder",bIsIdle);this.set("CommandEnabledBrowseContainerTreeNode",bIsIdleErr);var conNode=(bIsIdleErr&&this.getContainer())||null;this.set("CommandEnabledBrowseContainerParent",!!(conNode&&conNode.parent&&!(conNode.parent.parent==null&&this._isDummyNode(conNode.parent))));};LM.prototype._updateCommandEnabledFetchBlock=function LM_updateCommandEnabledFetchBlock(){var bc=this.props.blockCount;var s=this.props.totalSize;this.set("CommandEnabledFetchBlock",(this.props.readyState==mstr.Enum.Widget.READYSTATE.IDLE)&&(bc>0)&&(s>0)&&(bc<s));};LM.prototype.loadRequestResponse=function LM_loadReqRes(){var ctxt=this.props.requestContext;var res=ctxt&&ctxt.response;if(!res||!res.data){this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);return ;}var data=res.data;this.set("searchPattern",ctxt.memo&&ctxt.memo.searchPattern);var previousSelItems;if(this.props.keepSelectionsAfterRequest){previousSelItems=this.getSelectedItems();if(!previousSelItems||!previousSelItems.length){previousSelItems=this.props.keptSelections;}this.props.keptSelections=null;}var newItems;switch(ctxt.memo&&ctxt.memo.commandId){case"BrowseForms":var attrNode=data.getContainer();newItems=attrNode&&attrNode.value&&attrNode.value.dssforms;if(this.props.prefixItems){newItems=newItems?this.props.prefixItems.concat(newItems):this.props.prefixItems.concat();}var len=mstr.$A.len(newItems);this.set("totalSize",len);this.set("blockCount",0);this.set("blockBegin",len?0:1);this.set("leafElements",false);this.setContainerTree(attrNode&&attrNode.value);this.setItems(newItems||[]);break;default:var ns=["totalSize","blockCount","blockBegin","leafElements"];for(var i=0;i<ns.length;i++){this.set(ns[i],data.get(ns[i]));}switch(ctxt.memo&&ctxt.memo.commandId){case"BrowseHierarchyItem":this._appendBrowsedItemsToContainerTree(ctxt.memo.items,ctxt.memo.itemsSiblings);break;case"BrowseContainerTreeNode":var node=ctxt.memo.node;if(node){var tm=this.getContainerTree();if(tm){tm.execCommand("SingleSelect",node);var parent=node.parent;var sibs=parent&&parent.children||[node];for(var i=0,len=mstr.$A.len(sibs);i<len;i++){tm.removeAllChildNodes(sibs[i]);}}}break;default:if(this.props.keepFolders||(ctxt.memo&&ctxt.memo.commandId=="BrowseAttribute")){var browsedItem=ctxt.memo.item;if(!browsedItem){var browsedContainer=data.getContainer();browsedItem=browsedContainer&&browsedContainer.value;}this._appendBrowsedItemsToContainerTree([browsedItem],[this.getItems()]);}else{var newTree=data.getContainerTree();var oldTree=this.getContainerTree();if(oldTree){var newRoot=newTree&&newTree.getRootNode();if(newRoot){newRoot=mstr.utils.Trees.cloneSubTree(newRoot);}oldTree.setRootNode(newRoot);oldTree.setSelectedPaths(newTree&&newTree.getSelectedPaths());}}}newItems=data.getItems()||[];this.setRMCModel(data.props.rmc);if(this.props.headerModel){this.updateHeaderModel();}if(this.props.prefixItems){newItems=newItems?this.props.prefixItems.concat(newItems):this.props.prefixItems.concat();}this.setItems(newItems);}if(mstr.$A.len(previousSelItems)){this.setSelectedItems(previousSelItems);}this.props.requestContext={};this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);this.raiseEvent("loadRequestResponse",null);};LM.prototype._shouldKeepBrowsedItemSiblings=function LM_shouldKeepBrowsedItemSiblings(conNode,item){if(!conNode||!item){return null;}if(this.props.keepEntryPoints&&conNode.value&&(conNode.value.tp==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY)){return mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE;}else{if(this.props.keepHierarchies&&(item.tp==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY)){return mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY;}else{if(this.props.keepFolders&&!conNode.parent&&(item.tp==mstr.Enum.MSTRFolderItem.TYPE.FOLDER)){return mstr.Enum.MSTRFolderItem.TYPE.FOLDER;}}}return null;};LM.prototype._isSingleFilterNode=function LM_isSingleFilterNode(node){var nv=node&&node.value;if(nv&&(nv.stp==256||nv.tp==1)){var p=node.parent&&node.parent.value;if(p&&p.filters&&p.filters.length==1){return true;}}return false;};LM.prototype._isDummyNode=function LM_isDummyNode(node){return !(node&&node.value&&node.value.tp&&(node.value.tp>0));};LM.prototype._appendBrowsedItemsToContainerTree=function LM_appendItemsToContTree(items,itemsSiblings){var tm=this.getContainerTree();if(!tm||!mstr.$A.len(items)){return ;}var conNode=this.getContainer(),vf=this.props.valueForm,item,sibs,insertPath,newContainerNodes,newContainerSelection,keepSiblingsType;for(var j in items){item=items[j];sibs=itemsSiblings&&itemsSiblings[j];if(!item||!conNode){break;}if(conNode&&conNode.value&&conNode.value[vf]==item[vf]){if(conNode.value.dssforms&&item.dssforms){conNode.value.dssforms=item.dssforms;}break;}newContainerNodes=[];newContainerSelection=null;var dummyConNode=this._isDummyNode(conNode);if(dummyConNode||(keepSiblingsType=this._shouldKeepBrowsedItemSiblings(conNode,item))){for(var i=0,lenSiblings=mstr.$A.len(sibs);i<lenSiblings;i++){if(dummyConNode||(sibs[i]&&sibs[i]["tp"]==keepSiblingsType)){newContainerNodes.push({value:sibs[i]});if(sibs[i][vf]==item[vf]){newContainerSelection=newContainerNodes[newContainerNodes.length-1];}}}if(!newContainerSelection){newContainerSelection={value:item};newContainerNodes.push(newContainerSelection);}}else{newContainerSelection={value:item};newContainerNodes.push(newContainerSelection);}insertPath=tm.getNodePath(conNode)+mstr.models.AbstractTreeBase.PATHDELIM+mstr.$A.len(conNode.children);tm.insertNodesAt(newContainerNodes,insertPath);tm.execCommand("SingleSelect",newContainerSelection);conNode=newContainerSelection;}};LM.prototype.getPropertyNameForForm=function LM_getPropertyNameForForm(formId){if(formId!=null){var conNode=this.getContainer();if(conNode&&conNode.value&&conNode.value.dssforms){var index=mstr.$A.findByForm(conNode.value.dssforms,formId,"dssid");if(index>-1){return"form"+index;}}}return null;};LM.prototype.clone=function LM_clone(){var ps=mstr.$H.clone(this.props);ps.items=[].concat(ps.items);ps.selectedIndices=mstr.$H.clone(ps.selectedIndices);if(this.getContainer()){ps.containerTree=this.getContainerTree()&&this.getContainerTree().clone();}else{ps.containerTree=null;}ps.container=null;ps.id=mstr.controllers.Factory.nextFreeId();var m=new LM(ps,false);if(this.props.headerModel){m._initHeaderModel();}if(!m){return ;}mstr.controllers.Factory.add(m);m.init&&m.init();return m;};LM.prototype.init=function LM_init(){mstr.models.BaseModel.prototype.init.apply(this);if(this.props.container||this.props.blockBegin){this._updateCommandEnabledBrowseFolder();this._updateCommandEnabledSearch();}if(this.props.autoSelectFirstItem&&!this.props.defaultSelection&&this.getSelectedIndex()==-1){this.execSelect({0:true});}};function LM(props,applyPrefix){mstr.models.BaseModel.apply(this,[props]);this.props.items=this.props.items||[];if(this.props.prefixItems&&(applyPrefix!==false)){this.props.items=this.props.prefixItems.concat(this.props.items);}this.props.selectedIndices=this.props.selectedIndices||{};if(this.props.selectedIndicesList){var indices=mstr.$A.toHash(this.props.selectedIndicesList.split(","));this.execSelect(indices);}if(this.props.anchorIndex==null){this.props.anchorIndex=-1;}if(this.props.leadIndex==null){this.props.leadIndex=-1;}this._updateCommandEnabledFetchBlock();}return LM;})();mstr.models.dnd={};mstr.models.dnd.DragZone=(function(){mstr.$O.extendsClass(DZ,mstr.models.BaseModel);DZ.prototype.init=function DZ_init(){mstr.controllers.EventManager.attachWindowEventListener(this,"mousedown","onmousedown");mstr.controllers.EventManager.attachWindowEventListener(this,"mouseup","onmouseup");mstr.utils.Hash.applydefault(this.props,{delay:200});};DZ.prototype.findTarget=function DZ_findTarget(view,e){return null;};DZ.prototype.getDragData=function DZ_getDragData(view,e){return{ddel:this.get("src").cloneNode(true)};};DZ.prototype.startDrag=function DZ_startDrag(view){};DZ.prototype.drag=function DZ_drag(view,x,y){};DZ.prototype.endDrag=function DZ_endDrag(view,x,y){};DZ.prototype.onmousedown=function DZ_onmousedown(e){if(this.get("view").get("renderStatus")<3){return null;}var t=this.findTarget(this.get("view"),e);if(!t){return ;}var that=this;this.delayHandle=window.setTimeout(function(){that.initDrag(e,t);},this.get("delay"));};DZ.prototype.initDrag=function DZ_initDrag(e,t){delete this.delayHandle;mstr.controllers.EventManager.attachWindowEventListener(this,"mousemove","onmousemove");this.set("dragging",true);this.set("src",t);var box=mstr.utils.BoxModel.getBox(t);this.set("xOffset",e.x-box.left);this.set("yOffset",e.y-box.top);var dd=this.getDragData(this.get("view"),e);this.set("data",dd);dd.ddel.style.left="0";dd.ddel.style.top="0";var el=this.get("el");if(!el){el=document.createElement("div");el.style.position="absolute";el.style.zIndex=10001;document.body.appendChild(el);this.set("el",el);}else{el.removeChild(el.firstChild);}el.appendChild(dd.ddel);var constraints={};var parts=["x","y"];var p,m;for(var i=0;i<2;i++){p=parts[i];m=this.get(p+"Min");if(m||!isNaN(m)){constraints[p+"Min"]=(typeof (m)=="function")?m():m;}m=this.get(p+"Max");if(m||!isNaN(m)){constraints[p+"Max"]=(typeof (m)=="function")?m():m;}constraints[p]=(("xMin" in constraints)||("xMax" in constraints));}this.set("constraints",constraints);this.startDrag(this.get("view"));this.onmousemove(e);};DZ.prototype.onmousemove=function DZ_onmousemove(e){if(!this.get("dragging")){return ;}var x=e.x-this.get("xOffset");var y=e.y-this.get("yOffset");var c=this.constrainXY(x,y);var el=this.get("el");el.style.left=c.x+"px";el.style.top=c.y+"px";this.drag(this.get("view"),c.x,c.y);};DZ.prototype.onmouseup=function DZ_onmouseup(e){if(!this.get("dragging")){if(this.delayHandle){window.clearTimeout(this.delayHandle);delete this.delayHandle;}return ;}this.set("dragging",false);mstr.controllers.EventManager.detachWindowEventListener(this,"mousemove");var c=this.constrainXY(e.x-this.get("xOffset"),e.y-this.get("yOffset"));this.endDrag(this.get("view"),c.x,c.y);var el=this.get("el");el.style.top="-10000px";};DZ.prototype.constrainXY=function DZ_constrainXY(dx,dy){var c=this.get("constraints");if(c.x){if(!isNaN(c.xMin)){dx=Math.max(dx,c.xMin);}if(!isNaN(c.xMax)){dx=Math.min(dx,c.xMax);}}if(c.y){if(!isNaN(c.yMin)){dy=Math.max(dy,c.yMin);}if(!isNaN(c.yMax)){dy=Math.min(dy,c.yMax);}}return{x:dx,y:dy};};function DZ(props,methods){mstr.models.BaseModel.apply(this,[props]);mstr.utils.Hash.overwrite(this,methods);mstr.controllers.Factory.add(this);this.init();}return DZ;})();mstr.http.FrameProcessor=(function(){mstr.$O.extendsClass(FP,mstr.models.BaseModel);FP.prototype.isHTTPProcessor=true;FP.prototype.setInputs=function FP_setInputs(inputs){this.props.inputs=inputs;this.props.readyState=mstr.Enum.Widget.READYSTATE.IDLE;this.props.response=null;};FP.prototype.submit=function FP_submit(){var inputs=this.props.inputs;if(!inputs){return ;}var doc=inputs.htmlForm?inputs.htmlForm.ownerDocument:this.props.document;if(!doc){return ;}var form=inputs.htmlForm;if(!form){form=doc.createElement("form");doc.body.appendChild(form);form.method="POST";}var sAction=this.props.taskURL;sAction=microstrategy.addJSessionID(sAction);form.action=sAction;form.target=this.props.frameName;form.appendChild(this._getHiddenInput(doc,"taskEnv","juil_iframe",inputEls));var inputEl;var inputEls=(inputs.htmlForm)?[]:null;for(var n in inputs.params){form.appendChild(this._getHiddenInput(doc,n,inputs.params[n],inputEls));}form.appendChild(this._getHiddenInput(doc,"_xts_",new Date().getTime(),inputEls));for(var key in microstrategy.persistParams){form.appendChild(this._getHiddenInput(doc,key,microstrategy.persistParams[key],inputEls));}this.props.cancelled=false;this.props.readyState=mstr.Enum.Widget.READYSTATE.WAITING;this.props.lastSubmit=new Date();if(parseInt(this.props.timeout)){this.props.timeoutId=self.setTimeout('mstr.$obj("'+this.getId()+'").timeout()',parseInt(this.props.timeout));}form.submit();if(inputEls){while(inputEl=inputEls.pop()){form.removeChild(inputEl);}}};FP.prototype._getHiddenInput=function FP__getHiddenInput(doc,n,v,inputEls){var inputEl=doc.createElement("input");inputEl.type="hidden";inputEl.name=n;inputEl.value=v;if(inputEls){inputEls.push(inputEl);}return inputEl;};FP.prototype.timeout=function FP_timeout(){this._clearTimeout();if(this.props.readyState==mstr.Enum.Widget.READYSTATE.WAITING){this.set("readyState",mstr.Enum.Widget.READYSTATE.TIMEOUT);}};FP.prototype.cancel=function FP_cancel(){this._clearTimeout();if(this.props.readyState==mstr.Enum.Widget.READYSTATE.WAITING){this.props.cancelled=true;this.set("readyState",mstr.Enum.Widget.READYSTATE.CANCELLED);}};FP.prototype.update=function FP_update(hWin){this._clearTimeout();var r=this.props.response=hWin&&hWin.mstrResponse;if(hWin){hWin.mstrResponse=null;}if(parseInt(r&&r.statusCode)==200){this.props.lastSuccess=new Date();this.set("readyState",mstr.Enum.Widget.READYSTATE.SUCCESS);}else{this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);}};FP.prototype.getResponse=function FP_getResponse(){return this.props.response;};FP.prototype._clearTimeout=function FP_clearTimeout(){var tId=this.props.timeoutId;if(tId){self.clearTimeout(tId);this.props.timeoutId=null;}};function FP(props){mstr.models.BaseModel.apply(this,[props]);}return FP;})();mstr.http.BrowseFolderRequestInputs=(function(){function BFRIs(folderId,blockBegin,blockCount,totalSize,hierarchical,objectTypes,searchXML,dataSources){this.url="../servlet/taskProc";this.params={taskId:"searchMetadata",rootFolderID:folderId,blockBegin:blockBegin,blockCount:blockCount,recursive:hierarchical?0:(searchXML?"":1),folderBrowserStyle:hierarchical?1:0,includeAncestorInfo:String(!!hierarchical),searchXML:searchXML,dataSourcesXML:dataSources||"",objectType:objectTypes};}return BFRIs;})();mstr.http.MetadataSearchRequestInputs=(function(){function MSRIs(folderId,blockBegin,blockCount,totalSize,objectTypes,searchXML,searchPattern,dataSources){this.params={taskId:"searchMetadata",rootFolderID:folderId,searchPattern:searchPattern,nameWildcards:1,blockBegin:blockBegin,blockCount:blockCount,recursive:1,folderBrowserStyle:0,includeAncestorInfo:"true",searchXML:searchXML,dataSourcesXML:dataSources||"",objectType:objectTypes};}return MSRIs;})();mstr.views={};mstr.views.IView={get:null,set:null,getModel:null,setModel:null,render:null,update:null};mstr.views.BaseView=(function(){mstr.$O.extendsClass(BV,mstr.models.BaseModel);BV.prototype.DEFAULTS={visible:true,enabled:true,renderStatus:mstr.Enum.Widget.RENDERSTATUS.NOT_STARTED,validationStatus:{statusCode:mstr.Enum.Validation.STATUSCODE.VALID,message:"",bubble:false}};BV.prototype.getModel=function BV_getModel(){return this.props.model;};BV.prototype.setModel=function BV_setModel(m){if(m==this.props.model){return false;}if(this.props.model){this._detachLayoutHandlers();}this.props.model=m;this._modelDirty=true;var names=this.props.modelPushedProps;var arr=names&&names.split&&names.split(",");for(var i=0,len=arr&&arr.length||0;i<len;i++){var p=arr[i];var overwrite=(p.indexOf("!")==0);if(overwrite){p=p.substr(1);}if(!(p in m.props)){continue;}this["set_"+p]=function(evt){var p1=evt.name.substring(4,evt.name.length);var m1=evt.originalSrc;this.setPropertyByPath(p1.replace("|","/"),m1&&m1.props[p1],false);};m.attachEventListener(this,"set_"+p,"set_"+p);if(overwrite||mstr.controllers.Factory.getPath(p.replace("|","/"),this)==null){this.setPropertyByPath(p.replace("|","/"),m&&m.props[p],true);if(m.props[p] instanceof mstr.models.BaseModel){m.props[p].set("parent",this);}}}if(this.props.cmds){this._refreshCommandHandlers();}this._refreshChildViewModels();if(this._shouldAutoRender()){this.render();}return true;};BV.prototype.initModel=function BV_initModel(){var p=this.props.modelPath;if(p!=null){this.setModel(mstr.controllers.Factory.getPath(p,this));}};BV.prototype.initValidator=function BV_initValidator(){var p=this.props.validator;if(p!=null){var obj=p[mstr.$W.SCRIPTCLASS]&&mstr.controllers.Factory.registerJSON(p,this.props[mstr.$W.DOCUMENT]);if(obj){this.props.validator=obj;var zz=obj.props&&(obj.props[mstr.$W.PARENT]=this);zz=obj.init&&obj.init();}}};BV.prototype.execResetValidationStatus=function BV_execResetValidationStatus(){var vs=this.get("validationStatus");if(vs.statusCode!=mstr.Enum.Validation.STATUSCODE.VALID){this.set("validationStatus",{statusCode:mstr.Enum.Validation.STATUSCODE.VALID,message:"",bubble:true});this.updateAllProps();}};BV.prototype.execCheckValidationStatus=function FE_execCheckValidationStatus(){return !(this.get("validationStatus").statusCode>mstr.Enum.Validation.STATUSCODE.VALID);};BV.prototype.after_set_validationStatus=function BV_after_set_validationStatus(){var vs=this.get("validationStatus");if(vs.bubble){this.raiseEvent("set_childValidationStatus",{id:this.getId(),code:vs.statusCode},true);}};BV.prototype._refreshChildViewModels=function BV_refCVM(cascade){for(var i=0,len=mstr.$A.len(this._childViewsInstantiated);i<len;i++){var child=this._childViewsInstantiated[i];var p=child&&child.props&&child.props.modelPath;if(p&&(p.substring(0,7)=="parent/")){child.initModel&&child.initModel();}var cmds=child.props.cmdArray;for(var j=0,lenCmds=mstr.$A.len(cmds);j<lenCmds;j++){if(cmds[j]&&cmds[j].targetPath&&(cmds[j].targetPath.substring(0,7)=="parent/")){child._refreshCommandHandlers();break;}}if(cascade){child._refreshChildViewModels(cascade);}}};BV.prototype.getLayoutXML=function BV_getLayoutXML(){return this._layoutXML;};BV.prototype.setLayoutXML=function BV_setLayoutXML(sXML){if(sXML==this._layoutXML){return false;}if(this._layoutXML){this._detachLayoutHandlers();}this._layoutXML=sXML;this._layoutDirty=true;if(this._shouldAutoRender()){this.render();}};BV.prototype.initLayoutXML=function BV_initLayoutXML(){var c=this.props[mstr.$W.LAYOUTCLASS];if(c){c=c.replace(/\@[^:]*:/g,"");this.props[mstr.$W.LAYOUTCLASS]=c;}c&&this.setLayoutXML(eval(c));};BV.prototype.render=function BV_render(){if(!mstr.timers.renderStart){mstr.timers.renderStart=new Date();}var LR=mstr.utils.LayoutRenderer;var result=LR.render(this.props,this._layoutXML);var elNew=result&&result.el&&result.el.childNodes&&result.el.childNodes[0];if(!elNew){return ;}elNew.style.display="none";var curElement=this.props[mstr.$W.ELEMENT];if(this.get("preserveDOMNode")&&this.get("parent")==null){mstr.$D.insertNode(elNew,curElement.parentNode,curElement);}else{mstr.$D.replaceNode(curElement,elNew);}this.props[mstr.$W.ELEMENT]=elNew;this.props[mstr.$W.RENDERSTATUS]=result.renderStatus;this._layoutHandlers=LR.getLayoutHandlers(this.props[mstr.$W.LAYOUTCLASS],this._layoutXML);this._layoutHandlers=LR.replaceLayoutHandlerTokens(this._layoutHandlers,this);this._attachLayoutHandlers();if(this.props.cmds){this._refreshCommandHandlers();}this._layoutDirty=false;this.updateAllProps();this._modelDirty=false;this.props.childViewPaths=result.childPaths;this.props.childViewRenderCounter=0;if(mstr.$A.len(result.childPaths)){var p=parseInt(this.props.pauseBeforeRenderingChildren);if(p>0){window.setTimeout('mstr.$obj("'+this.getId()+'").renderNextChildView()',p);}else{this.renderNextChildView();}}else{this.props[mstr.$W.RENDERSTATUS]=mstr.Enum.Widget.RENDERSTATUS.RENDEREDCHILDREN;mstr.timers.renderStop=new Date();mstr.timers.render=mstr.timers.renderStop-mstr.timers.renderStart;}};BV.prototype._shouldAutoRender=function BV_shouldAutoRender(){var rs=this.props[mstr.$W.RENDERSTATUS];return(rs!=null&&rs!=mstr.Enum.Widget.RENDERSTATUS.NOT_STARTED);};BV.prototype.renderNextChildView=function BV_renderNextChildView(){var paths=this.props.childViewPaths,unrenderedPaths={};if(paths){var childInfo;while(childInfo=paths.shift()){if(this.renderChildAt(childInfo.name,childInfo.id)){this.props.childViewRenderCounter++;if(this.props.childViewRenderCounter%mstr.views.BaseView.REPAINT_EVERY_CHILDCOUNT==0){window.setTimeout('mstr.$obj("'+this.getId()+'").renderNextChildView()',1);break;}}else{unrenderedPaths[childInfo.name]=childInfo;}}this.props.unrenderedChildViewPaths=unrenderedPaths;}if(!mstr.$A.len(paths)){this.props[mstr.$W.RENDERSTATUS]=mstr.Enum.Widget.RENDERSTATUS.RENDEREDCHILDREN;mstr.timers.renderStop=new Date();mstr.timers.render=mstr.timers.renderStop-mstr.timers.renderStart;this.execLayoutHandler("on_win_resize");}};BV.prototype.renderChildAt=function BV_renderChildAt(path,placeholderId){var child=mstr.controllers.Factory.getPath(path,this);if(!child){return false;}var doc=this.props[mstr.$W.DOCUMENT];var el=doc&&doc.getElementById(placeholderId);mstr.controllers.Factory.safeset(child,"document",doc);mstr.controllers.Factory.safeset(child,"element",el);mstr.controllers.Factory.safeset(child,"renderStatus",mstr.Enum.Widget.RENDERSTATUS.NOT_STARTED);if((child.props&&child.props.visible==false)||child.visible==false){return false;}if(!child.getId){child[mstr.$W.PARENT]=this;child=mstr.controllers.Factory.registerElement(el,null,child);if(child){mstr.controllers.Factory.setPath(path,this,child,true);}this._childViewsInstantiated.push(child);}if(child&&child.render){child.render();return true;}return false;};BV.prototype._attachLayoutHandlers=function BV_attachLayoutHandlers(){var model=this.props.model;var handlers=this._layoutHandlers&&this._layoutHandlers.info;if(handlers&&model&&model.attachEventListener){for(var n in handlers){switch(handlers[n].src){case"model":model.attachEventListener(this,handlers[n].eventName,"update");break;case"win":mstr.controllers.EventManager.attachWindowEventListener(this,handlers[n].eventName,"update");break;default:if(handlers[n]&&handlers[n].src&&handlers[n].src.substr(0,5)=="model"){var paths=handlers[n].src.split(".");var temp=model;for(var i=1;i<paths.length;i++){temp=temp.get(paths[i]);}temp.attachEventListener(this,handlers[n].eventName,"update");break;}}}}this._attachPropertiesHandlers(["enabled","visible"]);};BV.prototype._attachPropertiesHandlers=function BV_attachPropertiesHandlers(ps){var path,pathParts,obj,field,callbackName;for(var i=0,len=ps.length;i<len;i++){path=this.props[ps[i]+"Field"];if(path==null||path==""){continue;}callbackName="on"+ps[i]+"FieldValueChange";if(!this[callbackName]){continue;}if(path.charAt(0)=="!"){path=path.substring(1);}pathParts=path.split(mstr.controllers.Factory.PATHDELIM);field=pathParts.pop();var valueIndex=field.indexOf(":");if(valueIndex>-1){var valueParts=field.split(":");field=valueParts[0];this.props[ps[i]+"SourceFieldValues"]=valueParts[1].split(",");}this.props[ps[i]+"SourceField"]=field;path=pathParts.join(mstr.controllers.Factory.PATHDELIM);this.props[ps[i]+"Source"]=obj=path.length?mstr.$path(path,this):this;if(obj instanceof mstr.models.ListModel&&field=="selectedIndices"){obj&&obj.attachEventListener&&obj.attachEventListener(this,"hashadd_"+field,callbackName);}else{obj&&obj.attachEventListener&&obj.attachEventListener(this,"set_"+field,callbackName);}if(obj){this[callbackName]({memo:{value:obj.get(field)}});}}};BV.prototype._detachLayoutHandlers=function BV_detachLayoutHandlers(){var model=this.props.model;var handlers=this._layoutHandlers&&this._layoutHandlers.info;if(handlers&&model&&model.detachEventListener){for(var n in handlers){switch(handlers[n].src){case"model":model.detachEventListener(this,handlers[n].eventName);break;case"win":mstr.controllers.EventManager.detachWindowEventListener(this,handlers[n].eventName);}}}this._detachPropertiesHandlers(["enabled","visible"]);};BV.prototype._detachPropertiesHandlers=function BV_detachPropertiesHandlers(ps){var obj,field;for(var i=0,len=ps.length;i<len;i++){obj=this.props[ps[i]+"Source"];field=this.props[ps[i]+"SourceField"];obj&&obj.detachEventListener&&obj.detachEventListener(this,"set_"+field);}};BV.prototype.onenabledFieldValueChange=function BV_onEnabledFieldValueChange(evt){var fieldValue=this.extractEventSourceFieldValue("enabled",evt);var fieldPath=this.props.enabledField;if(fieldPath&&fieldPath.charAt(0)=="!"){fieldValue=!fieldValue;}this.set("enabled",fieldValue);};BV.prototype.onvisibleFieldValueChange=function BV_onVisibleFieldValueChange(evt){var fieldValue=this.extractEventSourceFieldValue("visible",evt);fieldPath=this.props.visibleField;if(fieldPath&&fieldPath.charAt(0)=="!"){fieldValue=!fieldValue;}this.set("visible",fieldValue);};BV.prototype.extractEventSourceFieldValue=function BV_extractEventSourceFieldValue(name,evt){if(!this.props[name+"SourceFieldValues"]){return !!evt&&evt.memo&&evt.memo.value;}else{var src=this.props[name+"Source"];if(src instanceof mstr.models.ListModel){var hash=src&&src.get(this.props[name+"SourceField"]);if(hash){var testValues=this.props[name+"SourceFieldValues"];if(typeof (hash)=="object"){for(var i=0,cnt=testValues.length;i<cnt;i++){if(testValues[i] in hash){return true;}}}else{for(var i=0,cnt=testValues.length;i<cnt;i++){if(testValues[i]==hash){return true;}}}}}else{return !evt&&evt.memo&&evt.memo.value&&evt.memo.value==this.props[name+"SourceFieldValues"];}}return false;};BV.prototype._refreshCommandHandlers=function BV_refreshCommandHandlers(){var cmds=this.props.cmdArray;if(!cmds){cmds=this.props.cmdArray=this._initCommands(this.props.cmds);}if(this.props.enabledField!=undefined){return ;}if(!cmds||!cmds.length){return ;}var bAnyCommandEnabled=false;var bRequiredCommandsEnabled=true;for(var i=0,len=cmds.length;i<len;i++){if(!cmds[i].id){continue;}var cmdId=cmds[i].id;var attachedTarget=cmds[i].target;var target=cmds[i].targetPath?mstr.$path(cmds[i].targetPath,this):this;if(target!=attachedTarget){attachedTarget&&attachedTarget.detachEventListener&&attachedTarget.detachEventListener(this,"set_CommandEnabled"+cmdId);target&&target.attachEventListener&&target.attachEventListener(this,"set_CommandEnabled"+cmdId,"updateCommandEnabled");cmds[i].target=attachedTarget=(target&&target.execCommand)?target:null;}var v=cmds[i].valuePath;v=(v&&!/^prompt\(/.test(v))?mstr.controllers.Factory.resolveArgsString(v,this):null;cmds[i].enabled=((attachedTarget&&attachedTarget.queryCommandEnabled&&attachedTarget.queryCommandEnabled(cmdId,v))||cmdId.substr(0,4)=="Set_"||false);if(!bAnyCommandEnabled){bAnyCommandEnabled=cmds[i].enabled;}if(bRequiredCommandsEnabled&&cmds[i].required&&!cmds[i].enabled){bRequiredCommandsEnabled=false;}}this.set("enabled",bRequiredCommandsEnabled&&bAnyCommandEnabled);};BV.prototype.updateCommandEnabled=function BV_updateCmdEnabled(evt){var id=String(evt&&evt.name).substr(18);if(!id){return ;}var cmds=this.props.cmdArray;var index=mstr.$A.findByForm(cmds,id,"id");if(index>-1){var v=cmds[index].valuePath;v=v?mstr.controllers.Factory.resolveArgsString(v,this):null;var en=!!(evt.src&&evt.src.queryCommandEnabled&&evt.src.queryCommandEnabled(id,v));var bChanged=(!!cmds[index].enabled!=!!en);if(bChanged){cmds[index].enabled=!!en;var bViewEnabled=!!en;if(!bViewEnabled){var i=mstr.$A.findByForm(cmds,"enabled",true);if(i>-1){bViewEnabled=true;}}this.set("enabled",bViewEnabled);}}};BV.prototype.execFireCommands=function BV_execFireCmds(defaultCmdValue){return this.fireCommands(null,defaultCmdValue);};BV.prototype.fireCommands=function CV_fireCommands(cmdsString,defaultCmdValue){var cmds;if(cmdsString){cmds=this._initCommands(cmdsString);}else{cmds=this.props.cmdArray;}for(var i=0,len=mstr.$A.len(cmds);i<len;i++){var cmdReturnValue=false;var t=cmds[i].target;if(!t){t=cmds[i].targetPath?mstr.$path(cmds[i].targetPath,this):this;}if(t&&t.execCommand){var v=cmds[i].valuePath;v=v?mstr.controllers.Factory.resolveArgsString(v,this):null;if(v==null){v=[defaultCmdValue];}cmdReturnValue=t.execCommand.apply(t,[cmds[i].id].concat(v));}if(!cmdReturnValue&&cmds[i].required){break;}}return true;};BV.prototype._initCommands=function BV_initCommands(s){if(!s){return ;}s=(s&&s.split)?s.split(";"):[s];var len=s.length;if(len){var arr=[];for(var i=0;i<len;i++){var parts=(s[i]&&s[i].split)?s[i].split("|"):[s[i]];if(parts[0]){var bRequired=(String(parts[0]).charAt(0)=="!");if(bRequired){parts[0]=String(parts[0]).substr(1);}arr.push({id:parts[0],valuePath:parts[1],targetPath:parts[2],required:bRequired});}}return arr;}return null;};BV.prototype.computeHandlerNameForEvent=function BV_compHNforEvent(evt){if(evt.src==this.props.model){return"on_model_"+evt.name;}else{if(evt.src==this.props.document){return"on_win_"+evt.name;}else{return"on_"+evt.name;}}};BV.prototype.searchHandlerByEventName=function BV_searchHandlerByEventName(evt){if(this._layoutHandlers&&this._layoutHandlers.info){for(var n in this._layoutHandlers.info){if(this._layoutHandlers.info[n].eventName==evt.name){return this._layoutHandlers.info[n];}}}return null;};BV.prototype.update=function BV_update(evt){if(evt){var hName=this.computeHandlerNameForEvent(evt);var hInfo=this._layoutHandlers&&this._layoutHandlers.info&&this._layoutHandlers.info[hName];if(!hInfo){hInfo=this.searchHandlerByEventName(evt);if(hInfo){hName=hInfo.name;}}switch(hInfo&&hInfo.method){case"listadd":var range={min:evt.memo.start,max:evt.memo.start+evt.memo.count-1};this._updateListPropIteratively(hName,hInfo,[range]);break;case"listremove":this._updateListPropIteratively(hName,hInfo,evt.memo.ranges);break;case"hashadd":case"hashremove":this._updateHashPropIteratively(hName,hInfo,evt.memo.at);break;default:return this.execLayoutHandler(hName);}}};BV.prototype.updateAllProps=function BV_updateAllProps(){if(!this._layoutHandlers){return ;}var names=this._layoutHandlers.sequence;var infos=this._layoutHandlers.info;var v=this,m=this.props.model,el=this.props.element;for(var i=0,len=mstr.$A.len(names);i<len;i++){var hName=names[i];var hInfo=infos[hName];switch(hInfo&&hInfo.method){case"set":case"win":case null:case undefined:var h=this._validateLayoutHandlerFunction(hInfo);if(h){var retVal=h(v,m,el,{init:true});if(hName&&!hName.match(/^on\_/)){this.props[hName]=retVal;}}break;case"listadd":var src=(hInfo.src=="model")?m:v;if(src){var vals=(src==v)?src.props[hInfo.prop]:src.get&&src.get(hInfo.prop);var len=mstr.$A.len(vals);if(len){var range={min:0,max:len-1};this._updateListPropIteratively(hName,hInfo,[range]);}}break;case"hashadd":var src=(hInfo.src=="model")?m:v;if(src){var keys=(src==v)?src.props[hInfo.prop]:src.get&&src.get(hInfo.prop);this._updateHashPropIteratively(hName,hInfo,keys);}break;}}};BV.prototype.execLayoutHandler=function BV_execLH(hName,index){var hInfo=this._layoutHandlers&&this._layoutHandlers.info&&this._layoutHandlers.info[hName];var h=this._validateLayoutHandlerFunction(hInfo);return h&&h(this,this.props.model,this.props[mstr.$W.ELEMENT],index);};BV.prototype._updateHashPropIteratively=function BV_updateHashPropIteratively(hName,hInfo,keys){var h=this._validateLayoutHandlerFunction(hInfo);if(!h){return ;}var v=this;var m=this.props.model;var el=this.props[mstr.$W.ELEMENT];for(var key in keys){h(v,m,el,key);}};BV.prototype._updateListPropIteratively=function BV_updateListPropIteratively(hName,hInfo,ranges){var h=this._validateLayoutHandlerFunction(hInfo);if(!h){return ;}var v=this;var m=this.props.model;var el=this.props[mstr.$W.ELEMENT];for(var i=0,len=mstr.$A.len(ranges);i<len;i++){var min=ranges[i].min;var max=ranges[i].max;for(var index=min;index<=max;index++){h(v,m,el,index);}}};BV.prototype.raiseEvent=function BV_raiseEvent(name,memo,bubble){if(name){var evt=new mstr.lang.CustomEvent(this,name,memo);if(this["before_"+name]){this["before_"+name](evt);}this.update(evt);if(this["after_"+name]){this["after_"+name](evt);}this.notifyListeners(evt);if(bubble){var zz=this.get("parent")&&this.get("parent").raiseEvent&&this.get("parent").raiseEvent(name,memo,bubble);}}};BV.prototype._validateLayoutHandlerFunction=function BV_validLHF(hInfo){if(hInfo){if(!hInfo.func&&hInfo.str){hInfo.func=new Function("view, model, rootTag, context",hInfo.str);hInfo.str=null;}return hInfo.func;}return null;};BV.prototype.execHide=function BV_execHide(){this.set("visible",false);return true;};BV.prototype.execShow=function BV_execShow(){this.set("visible",true);return true;};BV.prototype.execHideChild=function BV_execHideChild(path){if(path){mstr.controllers.Factory.setPath(path+"/visible",this,false,false);}};BV.prototype.execShowChild=function BV_execShowChild(path){return this._showChildViewAtPath(path);};BV.prototype._showChildViewAtPath=function BV_showChildViewAtPath(childPath){var childView=mstr.controllers.Factory.getPath(childPath,this);if(childView){mstr.controllers.Factory.safeset(childView,"visible",true);if((this.props.renderStatus==mstr.Enum.Widget.RENDERSTATUS.RENDEREDCHILDREN)&&(!childView.getId||(childView.props.renderStatus==mstr.Enum.Widget.RENDERSTATUS.NOT_STARTED))){var childInfo=this.props.unrenderedChildViewPaths&&this.props.unrenderedChildViewPaths[childPath];if(childInfo&&childInfo.id!=null){this.renderChildAt(childPath,childInfo.id);childView=mstr.controllers.Factory.getPath(childPath,this);var m=childView&&childView.props.model;if(m){m.execCommand&&m.execCommand("FetchData");}}}}};BV.prototype.execOpenPopup=function BV_execOpenPopup(popupInfo){self.supressWaitPage=true;try{if(popupInfo){if(typeof (popupInfo)=="string"){popupInfo={popup:mstr.$obj(popupInfo)};}else{if(popupInfo.popup==null){popupInfo={popup:popupInfo};}}}var popup=popupInfo&&popupInfo.popup;if(!popup&&this.props.popupId){popup=mstr.$obj(this.props.popupId);}var useDefault=!popup||!popup.getId;if(useDefault){popup=this.props.popup;}if(!popup){return ;}var p=this.props.currentPopUp;if(p){this.execClosePopup();}if(!popup.getId){if(useDefault){popup[mstr.$W.PARENT]=this;}popup=mstr.controllers.Factory.registerJSON(popup,this.props.document);popup&&popup.init&&popup.init();if(useDefault){this.props.popup=popup;popup&&this._childViewsInstantiated.push(popup);}}this.props.currentPopUp=popup;if(!popup){return ;}popup.attachEventListener(this,"Pop","onPop");if(popupInfo&&popupInfo.x!=null){popup.set("x",popupInfo.x);}if(popupInfo&&popupInfo.y!=null){popup.set("y",popupInfo.y);}popup.execCommand("Pop",this);}finally{window.setTimeout("self.supressWaitPage = false;",10);}};BV.prototype.onPop=function BV_onPop(evt){var p=this.props.currentPopUp;if(p!=(evt&&evt.src)){return ;}this.set("opened",true);p.detachEventListener(this,"Pop");p.attachEventListener(this,"Unpop","onUnpop");self.setTimeout("mstr.controllers.EventManager.attachWindowEventListener(mstr.$obj('"+this.props.id+"'),'mousedown','onMouseEvent')",1);var sc=this.getAncestorByProperty("isScrollProvider");if(sc){if(p.props.element.offsetParent!=sc.props.element){sc.attachEventListener(this,"sync_scroll","onSyncScroll");sc.props._initialScrollTop=sc.props.element.scrollTop;p.props._scrollProvider=sc;if(mstr.utils.ISWK){var docEl=document.documentElement,ov=docEl.style.overflow;docEl.style.overflow="hidden";window.setTimeout(function(){docEl.style.overflow=ov;},0);}}}};BV.prototype.onSyncScroll=function BV_onSyncScroll(evt){var popup=this.props.currentPopUp;if(popup){if(this._scTimer){window.clearTimeout(this._scTimer);}var opener=this.props.element;this._scTimer=window.setTimeout(function(){var popupProps=popup.props,sc=popupProps&&popupProps._scrollProvider;if(sc){var scProps=sc.props,scEl=scProps.element,scST=scEl.scrollTop,delta=scST-scProps._initialScrollTop;var el=popupProps.element;if(el){el.style.top=parseInt(el.style.top)-delta+"px";scProps._initialScrollTop=scEl.scrollTop;var scPos=mstr.utils.BoxModel.position(scEl),scBottom=scPos.top+scPos.height,openerPos=mstr.utils.BoxModel.position(opener),openerBottom=openerPos.top+openerPos.height;el.style.display=openerBottom>=scBottom?"none":"";if(mstr.utils.ISWK){var docEl=document.documentElement,ov=mstr.utils.CSS.getStyleValue(docEl,"overflow");docEl.style.overflow="hidden";window.setTimeout(function(){docEl.style.overflow=ov;},100);}}}},100);}};BV.prototype.onUnpop=function BV_onUnpop(evt){var p=this.props.currentPopUp;if(p!=(evt&&evt.src)){return ;}this.set("opened",false);p.detachEventListener(this,"Unpop");mstr.controllers.EventManager.detachWindowEventListener(this,"mousedown");mstr.controllers.EventManager.detachWindowEventListener(this,"mouseup");this.props.currentPopUp=null;};BV.prototype.onMouseEvent=function BV_onMouseEvent(evt){var p=this.props.currentPopUp;if(!p){return ;}var elTarget=evt&&evt.target();if(!mstr.utils.Dom.containsElement(p.props.element,elTarget,true)&&(!mstr.utils.Dom.containsElement(this.props.element,elTarget,true)||this.props.popupPolicy=="toggle")){var viewId=elTarget&&elTarget.mstrViewId,view=viewId&&mstr.$obj(viewId);if(!p.isAncestorOf(view)){this.execClosePopup();}}};BV.prototype.isAncestorOf=function(view){var p=view;while(p){p=p&&p.props&&p.props.parent;if(p==this){return true;}}return false;};BV.prototype.execClosePopup=function BV_execClosePopup(){var p=this.props.currentPopUp;if(p){p.execCommand("Unpop");}};BV.prototype.execPop=function BV_execPop(opener){if(!opener){return ;}this.props.opener=opener;this.set("visible",false);if(!this.props.element){var doc=opener.props.document||document;this.props.element=doc.createElement("span");}var el=this.props.element;var elOpener=opener.props.element;if(elOpener&&elOpener.parentNode){if(el.parentNode){el.parentNode.removeChild(el);}var elNextSibling=elOpener.nextSibling;if(elNextSibling){elOpener.parentNode.insertBefore(el,elNextSibling);}else{elOpener.parentNode.appendChild(el);}}var m=mstr.$path(this.props.modelPath,this);if(m!=this.getModel()){this.setModel(m);}this.render();this._positionPop();this.set("visible",true);this.raiseEvent("Pop");};BV.prototype._positionPop=function BV_positionPop(){this._prePositionPop();var coords=this._computeNewClientCoords();var BM=mstr.utils.BoxModel,mySize=this._getMySize(),bAllowNudge=(this.props.popOrientation!=mstr.Enum.Widget.POPORIENTATION.VERTICAL);if(bAllowNudge||this.props.nudge){coords.width=mySize.width;coords.height=mySize.height;coords=BM.fitRectWithinRect(coords,BM.getBrowserWindowRect(this.props.element.ownerDocument));}var elOffsetParent=this.props.element.offsetParent,offsetScrollLeft=0,offsetScrollTop=0;if(elOffsetParent){offsetScrollLeft=+elOffsetParent.scrollLeft;offsetScrollTop=+elOffsetParent.scrollTop;}BM.setClientCoords(this.props.element,coords.left+offsetScrollLeft,coords.top+offsetScrollTop);this._postPositionPop(mySize.width,mySize.height);};BV.prototype._prePositionPop=function BV_prePositionPop(){var el=this.props.element,s=el&&el.style;if(!s){return ;}el.className=el.className.replace(/ mstrAsPopup/,"")+" mstrAsPopup";s.visibility="hidden";s.position="absolute";s.zIndex=999;s.display=(el.tagName&&el.tagName.toLowerCase()=="table"&&mstr.utils.ISW3C)?"table":"block";};BV.prototype._postPositionPop=function BV_postPositionPop(width,height){var el=this.props.element,s=el&&el.style;if(!s){return ;}s.display="none";s.visibility="visible";if(mstr.utils.ISIE6){var popupMask=microstrategy.getPopupMask(el),pms=popupMask&&popupMask.style;if(pms){popupMask.className="popupMask_"+el.id;pms.left=s.left;pms.top=s.top;pms.width=width+"px";pms.height=height+"px";pms.zIndex=s.zIndex-1;}}};BV.prototype._getMySize=function BV_getMySize(){var ps=this.props,w=ps.width,h=ps.height,el=ps.element,BM=mstr.utils.BoxModel;if(w&&w.match(/px$/)){w=parseInt(w);}else{w=BM.getElementOuterWidth(el)||BM.getElementOuterWidth(el.firstChild);}if(h&&h.match(/px$/)){h=parseInt(h);}else{h=BM.getElementOuterHeight(el)||BM.getElementOuterHeight(el.firstChild);}return{width:w,height:h};};BV.prototype._computeNewClientCoords=function BV_ccc(){return(this.props.popOrientation==mstr.Enum.Widget.POPORIENTATION.VERTICAL)?this._computeNewClientCoordsAsDropdown():this._computeNewClientCoordsAsCtxtMenu();};BV.prototype._computeNewClientCoordsAsDropdown=function BV_cmpClientAsDD(){var elOpener=this._getOpenerArea();var coords=mstr.utils.BoxModel.getClientCoords(elOpener);coords.top+=elOpener.offsetHeight;return coords;};BV.prototype._computeNewClientCoordsAsCtxtMenu=function BV_cmpClientAsCM(){if(!isNaN(parseInt(this.props.x))&&!isNaN(parseInt(this.props.y))){var el=this.props.element,doc=el&&el.ownerDocument,de=doc&&doc.documentElement;return{left:parseInt(this.props.x)-(de&&de.scrollLeft||0),top:parseInt(this.props.y)-(de&&de.scrollTop||0)};}else{return mstr.utils.BoxModel.getClientCoords(this._getOpenerArea());}};BV.prototype._getOpenerArea=function BV_getOpenerArea(){var opener=this.get("opener"),elOpener=opener&&(opener.execLayoutHandler("openerArea")||opener.get("element"));return elOpener;};BV.prototype.execUnpop=function BV_execUnpop(){if(mstr.utils.ISIE4){microstrategy.releasePopupMask(this.props.element);}this.set("visible",false);this.props.opener=null;this.raiseEvent("Unpop");};BV.prototype.execConfirm=function BV_execConfirm(msg){if(!msg){return false;}return window.confirm(msg);};BV.prototype.prompt=function BV_prompt(msg,defV){if(!msg){return null;}return window.prompt(msg,(defV?defV:""));};BV.prototype.init=function BV_init(){this.initLayoutXML();this.initModel();this.initValidator();};function BV(props){this.props=mstr.utils.Hash.applydefault(props,this.DEFAULTS);this._childViewsInstantiated=[];}return BV;})();mstr.views.Editor=(function(){mstr.$O.extendsClass(E,mstr.views.BaseView);E.prototype.execApply=function E_execApply(cmdValue){this.raiseEvent("apply",{value:cmdValue});};E.prototype.execSave=function E_execSave(cmdValue){this.raiseEvent("save",{value:cmdValue});};E.prototype.queryEnabledApply=function E_qryApply(){return true;};E.prototype.queryEnabledApply=function E_qryApply(){return false;};function E(props){mstr.views.BaseView.apply(this,[props]);}return E;})();mstr.views.TextInput=(function(){mstr.$O.extendsClass(TI,mstr.views.BaseView);TI.prototype.shouldWriteBack=function TI_shouldWriteBack(evtName){evtName=String(evtName).toLowerCase();var enAWB=mstr.Enum.Widget.AUTOWRITEBACK;switch(parseInt(this.props.autoWriteBack)){case enAWB.ONKEYPRESS:return !!evtName.match(/keypress|keydown|blur/i);case enAWB.ONBLUR:return !!evtName.match(/blur/i);case enAWB.OFF:return false;}return !!evtName.match(/keypress|keydown|blur/i);};TI.prototype.getAutoValidate=function TI_getAutoVal(){var enAV=mstr.Enum.Widget.AUTOVALIDATE,v=parseInt(this.props.autoValidate);if(isNaN(v)){v=enAV.USEDEFAULT;}if(v==enAV.USEDEFAULT){var enVL=mstr.Enum.Prompts.VALIDATIONLEVEL;switch(mstr.Settings.Prompts.VALIDATIONLEVEL){case enVL.AFTERANSWEREACH:v=enAV.ONBLUR;break;case enVL.INMIDANSWEREACH:v=enAV.ONKEYPRESS;break;case enVL.OFF:case enVL.ATRUNREPORT:default:v=enAV.OFF;break;}}return v;};TI.prototype.getAutoFormat=function TI_getAutoFmt(){var enAF=mstr.Enum.Widget.AUTOFORMAT,f=parseInt(this.props.autoFormat);if(isNaN(f)){f=enAF.USEDEFAULT;}if(f==enAF.USEDEFAULT){var enAFL=mstr.Enum.Prompts.AUTOFORMATLEVEL;switch(mstr.Settings.Prompts.AUTOFORMATLEVEL){case enAFL.AFTERANSWEREACH:f=enAF.ONBLUR;break;case enAFL.INMIDANSWEREACH:f=enAF.ONKEYPRESS;break;case enAFL.OFF:case enAFL.BEFORERUNREPORT:case enAFL.AFTERRUNREPORT:default:f=enAF.OFF;break;}}return f;};function TI(props){mstr.views.BaseView.apply(this,[props]);}return TI;})();mstr.views.ViewListBase=(function(){mstr.$O.extendsClass(VLB,mstr.views.BaseView);VLB.prototype._attachLayoutHandlers=function TV_attachLayoutHandlers(){mstr.views.BaseView.prototype._attachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){model.attachEventListener(this,"hashadd_selectedIndices","onAddSelections");model.attachEventListener(this,"hashremove_selectedIndices","onRemoveSelections");}};VLB.prototype._detachLayoutHandlers=function VS_detachLayoutHandlers(){mstr.views.BaseView.prototype._detachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){model.detachEventListener(this,"hashadd_selectedIndices");model.detachEventListener(this,"hashremove_selectedIndices");}};VLB.prototype.initChildModelPaths=function VS_initChildModelPaths(){var views=this.props.views;var P="parent/model/items/";for(var i=0,len=mstr.$A.len(views);i<len;i++){var vw=views[i];if(!vw||((vw.props&&vw.props.modelPath)||(vw.modelPath))){continue;}if(vw.props){vw.props.modelPath=P+i;}else{vw.modelPath=P+i;}}};VLB.prototype.init=function VS_init(){this.initChildModelPaths();mstr.views.BaseView.prototype.init.apply(this);};function VLB(props){mstr.views.BaseView.apply(this,[props]);}return VLB;})();mstr.views.ViewBook=(function(){mstr.$O.extendsClass(VB,mstr.views.ViewListBase);VB.prototype.init=function VB_init(){mstr.views.ViewListBase.prototype.init.apply(this);var m=this.getModel();m.attachEventListener(this,"listadd_items","reRender");m.attachEventListener(this,"listremove_items","reRender");};VB.prototype.reRender=function VB_reRender(){if(this.props.renderStatus!=mstr.Enum.Widget.RENDERSTATUS.NOT_STARTED){this.render();}};VB.prototype.render=function VB_render(){this._initChildViewList();mstr.views.ViewListBase.prototype.render.apply(this);};VB.prototype._initChildViewList=function VB_initChildViewList(){var P="parent/model/items/";var views=this.props.views=[];var jsons=this.props.childViewTypes||this.props.parent.props.childViewTypes;var doc=this.props.document,m=this.props.model,items=m&&m.getItems(),item,type,json;for(var i=0,len=mstr.$A.len(items);i<len;i++){item=items[i];type=(item&&item.get&&item.get("type"))||"default";json=jsons&&(jsons[type]||jsons["default"]);if(!json){continue;}json=mstr.utils.Hash.deepClone(json);json.parent=this;json.modelPath=P+i;views[i]=mstr.controllers.Factory.registerJSON(json,doc);if(views[i]&&views[i].init){views[i].init();}}};function VB(props){mstr.views.ViewListBase.apply(this,[props]);}return VB;})();mstr.views.ViewStack=(function(){mstr.$O.extendsClass(VS,mstr.views.ViewListBase);VS.prototype.setModel=function VS_setModel(m){mstr.views.ViewListBase.prototype.setModel.apply(this,[m]);if(m){m.set("stack",true);}};VS.prototype.onAddSelections=function VS_onAddSelections(evt){var indices=evt&&evt.memo&&evt.memo.at;var index=parseInt(mstr.$H.firstKey(indices));this._showChildViewAtIndex(index);this._updateNavCommands();};VS.prototype._updateNavCommands=function VS_updateNavCommands(){var index;var m=this.props.model;if(m){index=m.getSelectedIndex();}if(index==null){index=-1;}this.set("CommandEnabledPreviousView",index>0);this.set("CommandEnabledNextView",index<(mstr.$A.len(this.props.views)-1));};VS.prototype.onRemoveSelections=function VS_onRemoveSelections(evt){var indices=evt&&evt.memo&&evt.memo.at;var index=parseInt(mstr.$H.firstKey(indices));if(index>-1){var childView=this.props.views&&this.props.views[index];mstr.controllers.Factory.safeset(childView,"visible",false);}};VS.prototype.render=function VS_render(){var views=this.props.views,len=mstr.$A.len(views),childView;for(var i=0;i<len;i++){mstr.controllers.Factory.safeset(views[i],"visible",false);mstr.controllers.Factory.safeset(views[i],"renderStatus",mstr.Enum.Widget.RENDERSTATUS.NOT_STARTED);}mstr.views.BaseView.prototype.render.apply(this);var m=this.getModel();var index=m&&m.getSelectedIndex();this._showChildViewAtIndex(index);mstr.timers.renderStop=new Date();mstr.timers.render=mstr.timers.renderStop-mstr.timers.renderStart;};VS.prototype.renderNextChildViewOld=function VS_renderNextChildView(){var paths=this.props.childViewPaths;if(paths){var stackInfo=this.props.stackInfo={};var childInfo;for(var i=paths.length-1;i>-1;i--){childInfo=paths[i];if(childInfo.name&&childInfo.name.substring(0,6)=="views/"){stackInfo[childInfo.name]=childInfo;paths.splice(i,1);}}}this.renderNextChildView=mstr.views.BaseView.prototype.renderNextChildView;this.renderNextChildView();};VS.prototype.execPreviousView=function VS_execPrevView(){var m=this.props.model;if(m){var index=m.getSelectedIndex();if(index>0){return this.execGotoView(index-1);}}return false;};VS.prototype.execNextView=function VS_execNextView(){var m=this.props.model;if(m){var index=m.getSelectedIndex();if(index>-1){return this.execGotoView(index+1);}}return false;};VS.prototype.execGotoView=function VS_execGotoView(index){var m=this.props.model;if(m){if((index>-1)&&(index<mstr.$A.len(this.props.views))){return m.execCommand("SingleSelect",index);}}return false;};VS.prototype._showChildViewAtIndex=function VS_showChildViewAtIndex(index){index=parseInt(index);if(index!=null&&index>-1){this._showChildViewAtPath("views/"+index);}};function VS(props){mstr.views.ViewListBase.apply(this,[props]);this._updateNavCommands();}return VS;})();mstr.views.Pulldown=(function(){mstr.$O.extendsClass(PD,mstr.views.BaseView);PD.prototype.render=function PD_render(){mstr.views.BaseView.prototype.render.apply(this);if(!this.get("horizontalCaption")){var el=this.get("element");var td=el.getElementsByTagName("td");if(td.length>0){td[0].style.display="none";}}this.renderSelections();};PD.prototype._attachLayoutHandlers=function PD_attachLayoutHandlers(){mstr.views.BaseView.prototype._attachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){model.attachEventListener(this,"set_icon","set_buttonClass");model.attachEventListener(this,"set_showPressed","set_pressed");var prop=this._getPropNameForSelections();if(prop){model.attachEventListener(this,"hashadd_"+prop,"renderSelections");model.attachEventListener(this,"hashremove_"+prop,"renderSelections");}}};PD.prototype.set_buttonClass=function PD_set_buttonClass(evt){this.set("buttonClass",evt.memo.value);};PD.prototype.set_pressed=function PD_set_pressed(evt){this.set("pressed",evt.memo.value);};PD.prototype._detachLayoutHandlers=function PD_detachLayoutHandlers(){mstr.views.BaseView.prototype._detachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){var prop=this._getPropNameForSelections();if(prop){model.detachEventListener(this,"hashadd_"+prop);model.detachEventListener(this,"hashremove_"+prop);}}};PD.prototype._getPropNameForSelections=function PD_getPropNameForSelections(){var mc=this.props.modelClass;if(/TreeModel/.test(mc)){return"selections";}else{if(/ListModel/.test(mc)){return"selectedIndices";}}return null;};PD.prototype.renderSelections=function PD_renderSelections(){var r=mstr.utils.ListViewHelper.getItemRenderer(this);if(!r){return ;}var m=this.props.model;var items=(this.props.popup&&(this.props.popup.singleFilterCssClass||this.props.popup.props&&this.props.popup.props.singleFilterCssClass))?(m&&m.getViewableSelectedItems&&m.getViewableSelectedItems()):(m&&m.getSelectedItems());var showAsLabel=(this.props.showSingleItemListAsLabel&&(items&&mstr.$A.len(items)==1));var methodName;switch(mstr.$A.len(items)){case 1:methodName="renderListItem";break;case 0:methodName="renderEmpty";break;default:methodName="renderMultipleItems";break;}if(r[methodName]){r[methodName](this,m,this.props.element,{item:items&&items[0],items:items,showAsLabel:showAsLabel});}};function PD(props){mstr.views.BaseView.apply(this,[props]);}return PD;})();mstr.views.FieldSet=(function(){mstr.$O.extendsClass(FS,mstr.views.BaseView);FS.prototype.onlegendFieldValueChange=function FS_onlegendFieldValueChange(evt){var elem=this.get("element"),legendNode=elem.firstChild;if(evt.memo.value){legendNode.innerHTML=evt.memo.value;}};FS.prototype._attachLayoutHandlers=function FS_attachLayoutHandlers(){mstr.views.BaseView.prototype._attachLayoutHandlers.apply(this);mstr.views.BaseView.prototype._attachPropertiesHandlers.call(this,["legend"]);};FS.prototype._detachLayoutHandlers=function FS_detachLayoutHandlers(){mstr.views.BaseView.prototype._detachLayoutHandlers.apply(this);mstr.views.BaseView.prototype._detachPropertiesHandlers.call(this,["legend"]);};function FS(props){mstr.views.BaseView.apply(this,[props]);}return FS;})();mstr.views.ListView=(function(){mstr.$O.extendsClass(LV,mstr.views.BaseView);LV.prototype.render=function LV_render(){mstr.views.BaseView.prototype.render.apply(this);var m=this.getModel();var len=mstr.$A.len(m&&m.getItems&&m.getItems());if(len){this.renderItemsAt(0,len);}this._updateEmptyMessage();mstr.timers.renderStop=new Date();mstr.timers.render=mstr.timers.renderStop-mstr.timers.renderStart;};LV.prototype._updateEmptyMessage=function LV_updateEmptyMessage(){var m=this.props.model,len=mstr.$A.len(m&&m.getItems&&m.getItems()),plen=mstr.$A.len(m&&m.props&&m.props.prefixItems),desc=this.props.descriptors,descSearchRequired=desc&&desc.searchRequiredText,descEmpty=desc&&desc.emptyText,searchReq=m&&m.isElementSearchRequired&&m.isElementSearchRequired()&&!m.get("searchPattern");if(len>plen||(!searchReq&&len)){this._clearEmptyMessage();}else{msg=(searchReq)?descSearchRequired:descEmpty;this.set("message",msg);}};LV.prototype._clearEmptyMessage=function LV_clearEmptyMessage(){var msg=this.get("message"),desc=this.props.descriptors,descEmpty=desc&&desc.emptyText,descSearchRequired=desc&&desc.searchRequiredText;switch(msg){case descEmpty:case descSearchRequired:this.set("message",null);break;}};LV.prototype.renderItemsAt=function LV_renderIAt(start,count){var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!itemRenderer||!itemRenderer.renderListItem){return null;}var v=this,myId=this.getId(),m=this.props.model;var items=m&&m.getItems();var isSelected=(m&&m.getSelectedIndices())||{};var stop=Math.min(start+count,mstr.$A.len(items));var rt=this.props[mstr.$W.ELEMENT];var valueForm=m&&m.get("valueForm"),valueFormValue;for(var i=start;i<stop;i++){var item=items[i];var browseCommand=mstr.utils.ListViewHelper.getItemBrowseCommand(this,item)||"";var el=itemRenderer.renderListItem(v,m,rt,{at:i,item:item,browseCommand:browseCommand});if(el){if(isSelected[i]){itemRenderer.markListItemAsSelected(v,m,rt,{at:i,item:item,elItem:el});}if(!("enabled" in item)||item.enabled){valueFormValue=item[valueForm];if(valueFormValue==null&&item.get){valueFormValue=item.get(valueForm);}el.mstrListItemInfo=myId+"/"+(valueFormValue||"")+"/"+browseCommand;}}}};LV.prototype._attachLayoutHandlers=function LV_attachLayoutHandlers(){mstr.views.BaseView.prototype._attachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){model.attachEventListener(this,"listadd_items","onAddListItems");model.attachEventListener(this,"listremove_items","onRemoveListItems");model.attachEventListener(this,"hashadd_selectedIndices","onAddSelectedIndices");model.attachEventListener(this,"hashremove_selectedIndices","onRemoveSelectedIndices");}};LV.prototype._detachLayoutHandlers=function LV_detachLayoutHandlers(){mstr.views.BaseView.prototype._detachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){model.detachEventListener(this,"listadd_items");model.detachEventListener(this,"listremove_items");model.detachEventListener(this,"hashadd_selectedIndices");model.detachEventListener(this,"hashremove_selectedIndices");}};LV.prototype.onAddListItems=function LV_onAddListItems(evt){var start=evt.memo.start;var count=evt.memo.count;if(!count||(start==null)){return ;}this._updateEmptyMessage();this.renderItemsAt(start,count);};LV.prototype.onRemoveListItems=function LV_onRemoveListItems(evt){var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!itemRenderer||!itemRenderer.removeListItem){return ;}var ranges=evt.memo.ranges;var v=this,m=this.props.model,rn=this.props[mstr.$W.ELEMENT];for(var i=mstr.$A.len(ranges)-1;i>-1;i--){var range=ranges[i];for(var j=range.max;j>=range.min;j--){itemRenderer.removeListItem(v,m,rn,{at:j});}}this._updateEmptyMessage();};LV.prototype.onAddSelectedIndices=function LV_onAddSelectedIndices(evt){this._toggleSelectedIndices(evt.memo.at,"markListItemAsSelected");};LV.prototype.onRemoveSelectedIndices=function LV_onRemoveSelectedIndices(evt){this._toggleSelectedIndices(evt.memo.at,"markListItemAsUnselected");};LV.prototype._toggleSelectedIndices=function LV_tSelInd(indices,methodName){if(!indices){return ;}var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!itemRenderer||!itemRenderer[methodName]){return ;}var v=this,m=this.props.model,rn=this.props[mstr.$W.ELEMENT];var items=m&&m.getItems();for(var index in indices){index=parseInt(index);itemRenderer[methodName](v,m,rn,{at:index,item:items[index]});}};LV.prototype.execClickListItem=function LV_execClickListItem(cmdValue){var m=this.props.model;if(!m){return false;}var bMulti=!!this.props.multiSelect;var index=m.indexOfValue(cmdValue.valueForm);if(index>-1){var cmdId=null;if(this.props.isCheckList){if(bMulti){cmdId="ToggleSelect";}else{cmdId="SingleSelect";}}else{if(cmdValue.ctrl&&bMulti){cmdId="ToggleSelect";}else{if(cmdValue.shift&&bMulti){cmdId="RangeSelect";}else{if(cmdValue.rmc&&bMulti){cmdId="RMCSelect";}else{cmdId="SingleSelect";}}}}if(this.get("validator")){this.get("validator").validate(cmdId,index);}m.execCommand(cmdId,index);return true;}else{if(bMulti&&!this.props.isCheckList){m.execCommand("ClearSelect");}return false;}};LV.prototype.onkeypress=function LV_onkeypress(e,hWin){if(this.get("ignoreKeyStrokes")){return false;}var skip=1;if(this._timerID){window.clearTimeout(this._timerID);this._timerID=null;skip=0;}var m=this.getModel();if(!m){return true;}var s=mstr.utils.Events.keyChar(e,hWin),isTab=(s==String.fromCharCode(9));if(mstr.Enum.REGEXP_RESERVED_CHARS[s]){s="\\"+s;}this._selKeys+=s;m.execCommand("SelectString",this._selKeys,"n",skip);var me=this;this._timerID=window.setTimeout(function(){me._selKeys="";me._timerID=null;},this._keyDelay);if(!isTab){mstr.utils.Events.cancel(e,hWin);}return isTab;};LV.prototype.onkeydown=function LV_onkeydown(e,hWin){if(this.get("ignoreKeyStrokes")){return true;}var m=this.getModel();if(!m){return true;}var key=mstr.utils.Events.keyCode(e,hWin),shift=mstr.utils.Events.shiftKey(e,hWin);switch(key){case 38:this.getModel().execCommand("SelectPrevious",shift);mstr.utils.Events.cancel(e,hWin);return false;case 40:this.getModel().execCommand("SelectNext",shift);mstr.utils.Events.cancel(e,hWin);return false;default:return true;}};LV.prototype.focus=function LV_focus(){if(!mstr.utils.ISIE4){document.getElementById(this.get("id")+"TabStop").focus();}};LV.prototype.restoreFocus=function LV_restoreFocus(){if(!mstr.utils.ISIE4){document.getElementById(this.get("id")+"TabStop").focus();}else{this.props.scrollArea.focus();}};function LV(props){mstr.views.BaseView.apply(this,[props]);this._selKeys="";this._timerID=null;this._keyDelay=1000;}return LV;})();mstr.itemrenderers.ListView=(function(){var LV={};LV.renderListItem=function(view,model,rootTag,context){var elDiv=mstr.itemrenderers.FastListView.renderListItem(view,model,rootTag,context);this._insertElementForIndex(view,rootTag,context.at,elDiv);return elDiv;};LV.markListItemAsSelected=function LV_mLIasSelected(view,model,rootTag,context){context.elItem=this._findElementForIndex(view,rootTag,context.at);mstr.itemrenderers.FastListView.markListItemAsSelected(view,model,rootTag,context);};LV.markListItemAsUnselected=function LV_mLIasUnselected(view,model,rootTag,context){context.elItem=this._findElementForIndex(view,rootTag,context.at);mstr.itemrenderers.FastListView.markListItemAsUnselected(view,model,rootTag,context);};LV.removeListItem=function LV_removeListItem(view,model,rootTag,context){var elItem=this._findElementForIndex(view,rootTag,context.at);var p=elItem&&elItem.parentNode;if(p){p.removeChild(elItem);}};LV._insertElementForIndex=function LV_insertElForIndex(view,rootTag,index,el){var elCont=view.props.scrollArea.firstChild;var elExisting=elCont.childNodes[index];if(elExisting){elCont.insertBefore(el,elExisting);}else{elCont.appendChild(el);}};LV.on_set_leadIndex=function LV_on_set_leadIndex(view,model,rootTag){var leadIndex=model&&model.get("leadIndex");if(leadIndex==null||leadIndex<0){return false;}var el=this._findElementForIndex(view,rootTag,leadIndex);if(!el){return false;}var elScroll=view.get("scrollArea")||rootTag.rows[0].cells[0].firstChild.childNodes[2];if(!elScroll){return false;}mstr.utils.BoxModel.scrollToElement(elScroll,el);};LV._findElementForIndex=function LV_findElForIndex(view,rootTag,index){return view.props.scrollArea.firstChild.childNodes[index];};return LV;})();mstr.views.TextBox=(function(){mstr.$O.extendsClass(TB,mstr.views.BaseView);TB.prototype.execClearSearch=function TB_execCS(){var inputs=this.props.element.getElementsByTagName("input");if(inputs&&inputs[0].value!=""){inputs[0].value="";}this.fireCommands(null,"");};function TB(props){mstr.views.BaseView.apply(this,[props]);}return TB;})();mstr.views.FastListView=(function(){mstr.$O.extendsClass(FLV,mstr.views.ListView);FLV.DEFAULT_LIST_ITEM_HEIGHT=20;FLV.prototype.init=function FLV_init(){mstr.views.ListView.prototype.init.apply(this,arguments);this.set("baseHeight",this.get("height"));};FLV.prototype._positionPop=function FLV_positionPop(){var el=this.props.element;var s=el&&el.style;if(!s){return ;}s.position=mstr.utils.ISFF?"fixed":"absolute";s.display="block";var elContents=this.props.scrollArea;elContents.style.height="auto";var h=mstr.utils.BoxModel.getElementOuterHeight(el);if(mstr.utils.ISIE4&&mstr.utils.BoxModel.hasScrollbar(elContents,"x")){h+=SCROLLBAR_SIZE;}var bh=this.get("baseHeight");if(bh!="auto"){h=Math.min(h,parseInt(bh))+"px";}else{h=bh;}elContents.style.height=h;this.props.height=h;mstr.views.BaseView.prototype._positionPop.apply(this);};FLV.prototype.render=function FLV_render(){mstr.views.BaseView.prototype.render.apply(this);var el=this.execLayoutHandler("scrollArea");this.props.scrollArea=el;if(el&&this.props.renderListItemsOnScroll){el.onscroll=new Function("e","return mstr.controllers.Factory.obj('"+this.getId()+"').onScroll()");}this.props.listItemsContainer=el&&el.childNodes[0];this._updateItemsContainerDimensions();this.initItems();mstr.timers.renderStop=new Date();mstr.timers.render=mstr.timers.renderStop-mstr.timers.renderStart;};FLV.prototype.initItems=function FLV_initItems(){var m=this.getModel();var len=mstr.$A.len(m&&m.getItems&&m.getItems());var plen=m&&m.props&&m.props.prefixItems&&m.props.prefixItems.length||0;this._updateEmptyMessage();this.props.isListItemRendered=[];if(!len){return ;}var bRenderOnScroll=this.props.renderListItemsOnScroll&&this.props.scrollArea;if(!bRenderOnScroll){this.renderItemsAt(0,len);}else{this._addIndicesToRender(0,count);var count=parseInt(this.props.initialListItemRenderCount)||0;count&&this.renderItemsAt(0,count);}var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(itemRenderer&&itemRenderer.on_set_leadIndex){itemRenderer.on_set_leadIndex(this,this.getModel(),this.props.element);}if(bRenderOnScroll){this.onScroll();}};FLV.prototype.renderItemsAt=function FLV_renderIAt(start,count){var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!itemRenderer){return null;}var elContainer=this.props.listItemsContainer;if(!elContainer){return null;}var childNodeIndex=this._countIndicesRenderedBefore(start);var elExistingChild=elContainer.childNodes[childNodeIndex];var m=this.props.model;var items=m&&m.getItems();var stop=Math.min(start+count,mstr.$A.len(items));var elsRendered={};var isRendered=this.props.isListItemRendered;var isSelected=(m&&m.getSelectedIndices())||{};var v=this;var myId=this.getId();var m=this.props.model;var el=this.props[mstr.$W.ELEMENT];var valueForm=m&&m.get("valueForm");for(var i=start;i<stop;i++){var item=items[i];var browseCommand=mstr.utils.ListViewHelper.getItemBrowseCommand(this,item)||"";var el=itemRenderer.renderListItem(v,m,el,{at:i,item:item,browseCommand:browseCommand});if(elExistingChild){elContainer.insertBefore(el,elExistingChild);}else{elContainer.appendChild(el);}if(isSelected[i]){itemRenderer.markListItemAsSelected(v,m,el,{at:i,item:item,elItem:el,notFocus:true});}if(!("enabled" in item)||item.enabled){el.mstrListItemInfo=myId+"/"+(item[valueForm]||"")+"/"+browseCommand;}isRendered[i]=true;if(i==start){elsRendered.first=el;}if(i==stop-1){elsRendered.last=el;}}return elsRendered;};FLV.prototype.onAddListItems=function FLV_onAddListItems(evt){var start=evt.memo.start;var count=evt.memo.count;if(!count||(start==null)){return ;}this._updateEmptyMessage();this._updateItemsContainerDimensions();this._addIndicesToRender(start,count);var nextItemIndex=this.findNextRenderedIndex(start+count,false);if(nextItemIndex>-1){this._adjustWhiteSpaceAboveItem(nextItemIndex,this._getElementForItemAt(nextItemIndex));}this.updateScrollArea();};FLV.prototype.onRemoveListItems=function FLV_onRemoveListItems(evt){this._updateItemsContainerDimensions();var copyRanges=[];mstr.$A.forEach(evt.memo.ranges,function(r){copyRanges.push(mstr.$H.clone(r));});var ranges=this._splitRangesByRenderStatus(copyRanges);var isRendered=this.props.isListItemRendered;var elContainer=this.props.listItemsContainer;for(var i=mstr.$A.len(ranges)-1;i>-1;i--){var range=ranges[i];if(isRendered[range.min]){var elFirst=this._getElementForItemAt(range.min);for(var j=0;j<range.max-range.min;j++){elContainer.removeChild(elFirst.nextSibling);}elContainer.removeChild(elFirst);}this._removeIndicesToRender(range.min,range.max-range.min+1);var nextItemIndex=this.findNextRenderedIndex(range.max+1,false);if(nextItemIndex>-1){this._adjustWhiteSpaceAboveItem(nextItemIndex,this._getElementForItemAt(nextItemIndex));}}this.updateScrollArea();this._updateEmptyMessage();};FLV.prototype._toggleSelectedIndices=function FLV_tSelInd(indices,methodName){if(!indices){return ;}var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!itemRenderer){return ;}var v=this,m=this.props.model,rn=this.props[mstr.$W.ELEMENT];var items=m&&m.getItems();for(var index in indices){index=parseInt(index);var el=this._getElementForItemAt(index);if(el){itemRenderer[methodName](v,m,rn,{at:index,item:items[index],elItem:el});}}};FLV.prototype._updateItemsContainerDimensions=function FLV_uICDimensions(){this._updateItemsContainerHeight();};FLV.prototype._updateItemsContainerHeight=function FLV_uICHeight(){var el=this.props.listItemsContainer;if(!el){return ;}var propHeight=this.props.height;if(!propHeight||propHeight=="auto"){return ;}var r=mstr.utils.ListViewHelper.getItemRenderer(this);var h=r&&((r.listItemHeight&&r.listItemHeight(this))||(r.listItemHeightMin&&r.listItemHeightMin(this)));if(!h){h=FLV.DEFAULT_LIST_ITEM_HEIGHT;}if(h){var m=this.getModel();h=h*mstr.$A.len(m&&m.getItems&&m.getItems());}if(h){el.style.height=h+"px";}else{el.style.height=mstr.utils.ISIE4?"1px":"auto";}if(mstr.utils.ISIE4){el.style.overflow=h?"visible":"hidden";}};FLV.prototype._addIndicesToRender=function FLV_addITR(start,count){this.props.isListItemRendered=mstr.$A.insert(this.props.isListItemRendered,new Array(count),start);};FLV.prototype._removeIndicesToRender=function FLV_remITR(start,count){this.props.isListItemRendered=mstr.$A.removeRange(this.props.isListItemRendered,start,count);};FLV.prototype._countIndicesRenderedBefore=function FLV_countIndicesRenderedBefore(index){var count=0;var indices=this.props.isListItemRendered;for(var i=0;i<index;i++){if(indices[i]){count++;}}return count;};FLV.prototype._getElementForItemAt=function FLV_getElementForItemAt(index){if(this.props.isListItemRendered[index]){var childNodeIndex=this._countIndicesRenderedBefore(index);return this.props.listItemsContainer.childNodes[childNodeIndex];}return null;};FLV.prototype._getOrMakeElementForItemAt=function FLV_getOrMakeElementForItemAt(index){var el=this._getElementForItemAt(index);if(!el){var m=this.getModel(),items=m&&m.getItems(),item=items[index];if(item){var elsRendered=this.renderItemsAt(index,1);el=elsRendered&&elsRendered.first;if(el){this._adjustWhiteSpaceAboveItem(index,el);this._adjustWhiteSpaceBelowItem(index,el);}}}return el;};FLV.prototype.onScroll=function FLV_onScroll(){if(this.props.scrollTimeoutId){return true;}this.props.scrollTimeoutId=self.setTimeout('mstr.controllers.Factory.obj("'+this.getId()+'").updateScrollArea()',200);return true;};FLV.prototype.after_set_visible=function FLV_after_set_visible(evt){if(this.props.visible){this.updateScrollArea();}};FLV.prototype.on_win_resize=function FLV_on_win_resize(evt){this._updateListContainerWidth();};FLV.prototype.updateScrollArea=function FLV_updateScrollArea(){if(this.props.scrollTimeoutId){self.clearTimeout(this.props.scrollTimeoutId);this.props.scrollTimeoutId=null;}var itemsRange=this._computeVisibleItemsRange();if(!itemsRange){return ;}var ranges=this._splitRangesByRenderStatus([itemsRange]);var isRendered=this.props.isListItemRendered;for(var i=0,len=mstr.$A.len(ranges);i<len;i++){var range=ranges[i];if(!isRendered[range.min]){var elsRendered=this.renderItemsAt(range.min,range.max-range.min+1);if(!elsRendered||!elsRendered.first){continue;}this._adjustWhiteSpaceAboveItem(range.min,elsRendered.first);this._adjustWhiteSpaceBelowItem(range.max,elsRendered.last);}}this._updateListContainerWidth();};FLV.prototype._updateListContainerWidth=function FLV__updateListContainerWidth(){if(mstr.utils.ISIE6){return ;}var elScrollArea=this.props.scrollArea,elContainer=elScrollArea&&elScrollArea.firstChild;if(elContainer.style.width!=(elScrollArea.scrollWidth+"px")&&mstr.utils.BoxModel.hasScrollbar(elScrollArea,"x")){window.setTimeout(function(){elContainer.style.width=elScrollArea.scrollWidth+"px";},0);}};FLV.prototype.execResetScrollArea=function FLV_execUpdateScrollArea(){var elScroll=this.props.scrollArea;if(mstr.utils.ISFF){elScroll.scrollTop=0;}};FLV.prototype._adjustWhiteSpaceAboveItem=function FLV_aWSAbove(index,el){if(!el){return ;}var r=mstr.utils.ListViewHelper.getItemRenderer(this);var h=r&&((r.listItemHeight&&r.listItemHeight(this))||(r.listItemHeightMin&&r.listItemHeightMin(this)));if(!h){h=FLV.DEFAULT_LIST_ITEM_HEIGHT;}if(!h){return ;}var indexRenderedPrevious=this.findNextRenderedIndex(index-1,true);var countMissingPrevious=index-indexRenderedPrevious-1;el.style.marginTop=(countMissingPrevious*h)+"px";};FLV.prototype._adjustWhiteSpaceBelowItem=function FLV_aWSBelow(index,el){var r=mstr.utils.ListViewHelper.getItemRenderer(this);var h=r&&((r.listItemHeight&&r.listItemHeight(this))||(r.listItemHeightMin&&r.listItemHeightMin(this)));if(!h){h=FLV.DEFAULT_LIST_ITEM_HEIGHT;}if(!h){return ;}var indexRenderedNext=this.findNextRenderedIndex(index+1,false);if(indexRenderedNext>-1){var countMissingNext=indexRenderedNext-index-1;var elNext=el.nextSibling;if(elNext){elNext.style.marginTop=(countMissingNext*h)+"px";if(mstr.utils.ISIE8){elNext.style.display="none";window.setTimeout(function(){elNext.style.display="block";},0);}}}};FLV.prototype._computeVisibleItemsRange=function FLV_compVisItemsRange(){var ps=this.props,el=ps.scrollArea,h=ps.height;if(h&&h.match(/px$/)||(h==String(parseInt(h)))){h=parseInt(h);}else{if(h&&(h!="auto")&&!h.match(/\%$/)){h=el&&el.clientHeight;if(!h&&el&&el.style){h=el.style.height;h=(h.match(/px$/)||(h==String(parseInt(h))))?parseInt(h):"auto";}}else{h="auto";}}if(!h||isNaN(h)){var m=this.props.model,items=m&&m.props&&m.props.items;return{min:0,max:items&&items.length||0};}var min,max;var r=mstr.utils.ListViewHelper.getItemRenderer(this);if(r&&r.listItemHeight){min=max=r.listItemHeight(this);}else{min=(r&&r.listItemHeightMin&&r.listItemHeightMin(this))||FLV.DEFAULT_LIST_ITEM_HEIGHT;max=(r&&r.listItemHeightMax&&r.listItemHeightMax(this))||FLV.DEFAULT_LIST_ITEM_HEIGHT;}if(min){var top=el.scrollTop;var range={min:parseInt(top/max),max:parseInt((top+h)/min)+1};return range;}return null;};FLV.prototype._splitRangesByRenderStatus=function FLV_sRBRS(ranges){var isRendered=this.props.isListItemRendered;var len=mstr.$A.len(ranges);var i=0;while(i<len){var range=ranges[i];var bRendered=isRendered[range.min];for(var j=range.min+1;j<=range.max;j++){if(isRendered[j]!=bRendered){var newRange={min:j,max:range.max};range.max=j-1;ranges=mstr.$A.insert(ranges,newRange,i+1);len++;break;}}i++;}return ranges;};FLV.prototype.findNextRenderedIndex=function FLV_findNextRenderedIndex(start,bReverse){var isRendered=this.props.isListItemRendered;if(bReverse){for(var i=start;i>-1;i--){if(isRendered[i]){return i;}}}else{var len=mstr.$A.len(isRendered);for(var i=start;i<len;i++){if(isRendered[i]){return i;}}}return -1;};function FLV(props){mstr.views.ListView.apply(this,[props]);this.props.isListItemRendered=[];}return FLV;})();mstr.views.FloatingEditor=(function(){mstr.$O.extendsClass(FE,mstr.views.BaseView);FE.prototype.before_set_visible=function FE_before_set_visible(evt){if(evt.memo.value&&this.get("reloadCmds")){this.fireCommands(this.get("reloadCmds"),"");}};FE.prototype.execResetValidationStatus=function FE_execResetValidationStatus(){mstr.views.BaseView.prototype.execResetValidationStatus.apply(this,arguments);if(!this.childValidationStatus){return ;}for(var c in this.childValidationStatus){mstr.$obj(c).execResetValidationStatus();}};FE.prototype.after_set_childValidationStatus=function FE_after_set_childValidationStatus(evt){var m=evt.memo;this.childValidationStatus=this.childValidationStatus||{};if(m.code==mstr.Enum.Validation.STATUSCODE.VALID){if(m.id in this.childValidationStatus){delete this.childValidationStatus[m.id];if(mstr.utils.Hash.isEmpty(this.childValidationStatus)){this.set("validationStatus",mstr.Enum.Validation.STATUSCODE.VALID);this.set("message","");this.set("CommandEnabledCheckValidationStatus",true);var xx=this.getModel()&&this.getModel().disableModelFromView&&this.getModel().disableModelFromView(false);}}}else{if(mstr.utils.Hash.isEmpty(this.childValidationStatus)){this.set("validationStatus",mstr.Enum.Validation.STATUSCODE.INVALID_ANSWERS);this.set("message",this.props.descriptors.ALERT);this.set("CommandEnabledCheckValidationStatus",false);var yy=this.getModel()&&this.getModel().disableModelFromView&&this.getModel().disableModelFromView(true);}this.childValidationStatus[m.id]=m.code;}};FE.prototype.after_set_message=function FE_after_set_message(evt){var div=this.get("element").firstChild.rows[1].cells[0].firstChild;var msg=div.firstChild;var m=evt.memo.value;if(m){div.style.visibility="hidden";div.style.position="absolute";msg.innerHTML=m;div.style.height="auto";var f1=function(){var h=mstr.utils.BoxModel.getElementInnerHeight(div);div.style.height=0;div.style.position="static";div.style.visibility="visible";mstr.utils.Animations.resize(div,null,h,3,null);};window.setTimeout(f1,0);}else{mstr.utils.Animations.resize(div,null,0,3,function(){msg.innerHTML="";});}};FE.prototype.after_set_opener=function FE_after_set_opener(evt){var btns=this.get("cmdButtons")||[];for(var i=0,cnt=btns.length;i<cnt;i++){var zz=btns[i]&&btns[i]._refreshCommandHandlers&&btns[i]._refreshCommandHandlers();}var mp=this.get("modelPath");if(mp&&mp.substr(0,6)=="opener"){this.initModel();this._refreshChildViewModels(true);}};FE.prototype.render=function FE_render(){mstr.views.BaseView.prototype.render.apply(this);var el=this.props[mstr.$W.ELEMENT];if(this.get("moveToBody")&&mstr.utils.ISIE9&&el.parentNode!=document.body){this.props[mstr.$W.ELEMENT]=document.body.appendChild(el);}var tbl=el.firstChild;var d=null;this.set("titleBar",this.execLayoutHandler("titleBar"));if(this.get("isModal")){var ans=mstr.utils.Dom.findPositionedAncestor(el);var dist=mstr.utils.BoxModel.computeDistanceFromAncestor(ans);var clientSize=mstr.utils.BoxModel.getBrowserWindowRect(el.ownerDocument);el.style.top=(clientSize.top-dist.offsetY)+"px";el.style.left=(clientSize.left-dist.offsetX)+"px";el.style.width=clientSize.width+"px";el.style.height=clientSize.height+"px";el.style.backgroundRepeat="repeat";mstr.utils.Dom.setBGIconClass(el,"1ptrans");d=tbl;if(this.left){d.style.left=this.left;d.style.top=this.top;}else{mstr.utils.BoxModel.centerElementOnObject(el,d);this.left=d.style.left;this.top=d.style.top;}}else{el.style.height="auto";el.style.width="auto";el.style.background="transparent";d=el;mstr.utils.BoxModel.centerElementOnObject(document.body,d);}tbl.style.visibility="visible";mstr.utils.Dom.insertPopupMask(d,el,d.style.left,d.style.top);if(this.get("loadCmds")){this.fireCommands(this.get("loadCmds"),"");}};FE.prototype.getHelpLink=function FE_getHelpLink(){if(this.get("helpTopic")&&this.get("helpTopic")&&this.get("helpPath")){var helpPath=this.get("helpPath");return helpPath+(helpPath.lastIndexOf("#")===helpPath.length-1?"":"#")+this.get("helpTopic");}return this.get("helpPath");};FE.prototype.execShowHelp=function FE_execShowHelp(url){window.open(url);};FE.prototype.execSetModel=function FE_execSetModel(model){this.setModel(model);};FE.prototype.execCheckValidationStatus=function FE_execCheckValidationStatus(){return !(this.get("validationStatus")>mstr.Enum.Validation.STATUSCODE.VALID);};function FE(props){mstr.views.BaseView.apply(this,[props]);if(!this.get("isDraggable")){return ;}this.set("dz",new mstr.models.dnd.DragZone({view:this},{findTarget:function(view,e){var el=view.get("element");var title=mstr.utils.Dom.findAncestor(e.target(),"className","mstrFloatingEditorTitle");return(title&&title==view.get("titleBar"))?title:null;},getDragData:function(view,e){var d=document.createElement("div");d.style.border="2px solid #9e9e9e";var el=view.get("element").firstChild;d.style.height=mstr.utils.BoxModel.getElementOuterHeight(el)+"px";d.style.width=mstr.utils.BoxModel.getElementOuterWidth(el)+"px";return{ddel:d};},endDrag:function(view,x,y){x=Math.max(0,x);y=Math.max(0,y);var el=view.get("element");if(view.get("isModal")){y-=mstr.utils.BoxModel.getElementSumOffsetTop(el);el.firstChild.style.left=x+"px";el.firstChild.style.top=y+"px";if(el.firstChild!=el.lastChild&&el.lastChild.className!=="mstrCurtain"){el.lastChild.style.left=x+"px";el.lastChild.style.top=y+"px";}}else{el.style.left=x+"px";el.style.top=y+"px";}}}));}return FE;})();mstr.views.JoinBehaviorTable=(function(){mstr.$O.extendsClass(JBT,mstr.views.BaseView);JBT.prototype.init=function JBT_init(){mstr.views.BaseView.prototype.init.apply(this);};JBT.prototype.render=function JBT_render(){var id="mstrDG",me=this,model=me.getModel(),renderDataGrid=function(){var items=me.buildDGItems(me.getModel().get(me.get("valueField"))),isRendered=false;me.dgWidget=mstrmojo.insert({scriptClass:"mstrmojo.DataGrid",placeholder:me.props.element,cssClass:"jointype",columns:[{headerText:mstrmojo.desc(5467,"Objects"),dataField:"mn",headerCss:"jointype-hd",tooltip:true,itemTooltipField:"tf",itemCSSField:"itemCss",colWidth:160},{headerText:mstrmojo.desc(13176,"Join Type"),headerCss:"jointype-hd",dataWidget:{scriptClass:"mstrmojo.Pulldown",popupToBody:true,itemIdField:"v",itemTitleField:"title",popupZIndex:999,items:[{n:mstrmojo.desc(959,"Default"),v:"dft",title:mstrmojo.desc(959,"Default")},{n:mstrmojo.desc(13177,"Inner Join"),v:"0",title:mstrmojo.desc(13178,"Results displaying only those attribute elements that have metric value")},{n:mstrmojo.desc(13179,"Outer Join - Ignore Filter"),v:"2",title:mstrmojo.desc(13180,"Outer join to attribute's look up table without considering the filter on template")},{n:mstrmojo.desc(13181,"Outer Join - Preserve Filter"),v:"3",title:mstrmojo.desc(13182,"Outer join to attribute's look up table after considering the filter on template")}],onvalueChange:function(){if(!model.translating&&isRendered){model.joinTypeChange(this.data.id,this.value);}},postCreate:function(){this.markupMethods=mstrmojo.hash.copy({ondataChange:function(){var d=this.data;this.set("value",d[this.itemIdField]);}},mstrmojo.hash.copy(this.markupMethods));if(this.data&&this.data.id!=="allAttrs"){this.items=[{n:mstrmojo.desc(959,"Default"),v:"dft",title:mstrmojo.desc(959,"Default")},{n:mstrmojo.desc(13177,"Inner Join"),v:"0",title:mstrmojo.desc(13178,"Results displaying only those attribute elements that have metric value")},{n:mstrmojo.desc(13183,"Outer Join"),v:"1",title:mstrmojo.desc(13184,"Outer join to attributes look up table")}];}}}}],items:items});me.dgWidget.render();isRendered=true;};me.initModel();model.attachEventListener(this,"set_"+me.get("valueField"),"onUpdateDataGrid");if(!window.mstrmojo){microstrategy.mojoLoader.loadWidget({scriptClass:"DataGrid",id:id,bundle:"mojo-sle.js",callback:function(){microstrategy.mojoLoader.loadWidget({scriptClass:"Pulldown",id:id,bundle:"mojo-coreui.js",callback:renderDataGrid});}});}else{renderDataGrid();}};JBT.prototype.onUpdateDataGrid=function JBT_onUpdateDataGrid(evt){if(this.dgWidget){this.dgWidget.set("items",this.buildDGItems(evt.memo.value));}};JBT.prototype.buildDGItems=function JBT_buildDGItems(data){var items=[];mstr.$A.forEach(data,function(u){items.push({mn:u.alias,id:u.dssId,v:u.jt,n:u.n,tf:u.alias,itemCss:u.ic});});return items;};function JBT(props){mstr.views.BaseView.apply(this,[props]);}return JBT;})();