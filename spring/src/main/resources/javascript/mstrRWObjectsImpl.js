mstrRWObjectsImplScript=true;mstrRWObjectsImpl.prototype=new mstrObjectBrowserImpl();mstrRWObjectsImpl.prototype.superClass=mstrObjectBrowserImpl.prototype;mstrRWObjectsImpl.prototype.deleteButton=null;mstrRWObjectsImpl.prototype.taskModel=null;mstrRWObjectsImpl.prototype.selectDataSetEditor=null;mstrRWObjectsImpl.HTMLATTR_BTN_ID="b";mstrRWObjectsImpl.NEW_DATASET="new";mstrRWObjectsImpl.EDIT_DATASET="edit";mstrRWObjectsImpl.DELETE_DATASET="del";mstrRWObjectsImpl.prototype.onload=function(e){try{this.superClass.onload.call(this,e);this.isRWTab=true;if(!(this.body)){microstrategy.unRegisterBone(this.id);return ;}this.maskArea=this.body.firstChild;this.mask.onload(this);this.selections=new mstrRWObjSelectionsImpl();this.selections.parentBone=this;this.selections.path="microstrategy.bone('"+this.id+"').selections";var toolbar=microstrategy.subObjectFind(this.elem,["DIV"],microstrategy.SUBOBJTYPE_TOOLBAR);if(toolbar){var imgs=toolbar.getElementsByTagName("img");for(var j=0;j<imgs.length;j++){if(imgs[j].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_BTN){imgs[j].onclick=new Function("e","return microstrategy.bone('"+this.id+"').onclick(e);");if(imgs[j].getAttribute(mstrRWObjectsImpl.HTMLATTR_BTN_ID)==mstrRWObjectsImpl.DELETE_DATASET){this.deleteButton=imgs[j];}}}}var imgDelDataSet2=microstrategy.subObjectFind(this.tree.elem,["IMG"],microstrategy.SUBOBJTYPE_BTN);if(imgDelDataSet2){imgDelDataSet2.onclick=new Function("e","return microstrategy.bone('"+this.id+"').onclick(e);");}this.resizeContents();}catch(err){microstrategy.errors.log(err);return false;}};mstrRWObjectsImpl.prototype.onpostload=function(e){if(microstrategy.getViewerBone()){this.selections.targetMask=new mstrTransparentMask(microstrategy.getViewerBone().elem);this.populateInDocAttributeLinkInfo();}};mstrRWObjectsImpl.prototype.onforcerepaint=function(){try{var fn=function(obj){if(obj){obj=obj.parentNode;var i=document.createElement("img");obj.appendChild(i);i.parentNode.removeChild(i);}};fn(microstrategy.findAncestor(this.elem));if(bIsIE4){fn(microstrategy.findChildWithAtt(this.elem,"TABLE","sty","tree"));}}catch(err){microstrategy.errors.log(err);}};mstrRWObjectsImpl.prototype.resizeContents=function(){try{var TREE_MARGIN_X=10;var TREE_MARGIN_TOP=15;var TREE_MARGIN_BOTTOM=5;var TREE_BORDER_WIDTH=1;var PANEL_BORDER_WIDTH_TOP=2;var PANEL_BORDER_WIDTH_BOTTOM=2;var SURROUNDING_PADDING=7;if(!isInDocument(this.elem)){return false;}var height=0;if(this.tabManager&&this.tabManager.getAvailableHeight){height=Math.max((this.tabManager.getAvailableHeight()-SURROUNDING_PADDING),0);}if(this.tree&&this.tree.elem&&this.tree.elem.style&&(isInDocument(this.tree.elem))){var hPanel=height-(PANEL_BORDER_WIDTH_TOP+PANEL_BORDER_WIDTH_BOTTOM);if(hPanel>0){this.elem.childNodes[0].style.height=hPanel+"px";}else{this.elem.childNodes[0].style.height="0px";}var hTree=hPanel-(TREE_MARGIN_TOP+TREE_MARGIN_BOTTOM+TREE_BORDER_WIDTH*2);if(hTree>0&&(this.tree.elem.style.height!=hTree+"px")){this.tree.elem.style.height=hTree+"px";}var wTree=getObjOuterWidth(this.elem)-(TREE_MARGIN_X+TREE_BORDER_WIDTH)*2;if(wTree>0){this.tree.elem.style.width=wTree+"px";}}}catch(err){microstrategy.errors.log(err);return false;}};mstrRWObjectsImpl.prototype.onclick=function(e){try{if(!e){e=window.event;}var src=findTarget(getEventTarget(e),mstrRWObjectsImpl.HTMLATTR_BTN_ID);if(src){var id=src.getAttribute(mstrRWObjectsImpl.HTMLATTR_BTN_ID);switch(id){case mstrRWObjectsImpl.NEW_DATASET:var viewer=microstrategy.getViewerBone(),cmds=viewer&&viewer.commands;if(cmds){cmds.exec("openSelectDatasetEditor");}break;case mstrRWObjectsImpl.EDIT_DATASET:this.selections.editDataSet();break;case mstrRWObjectsImpl.DELETE_DATASET:if(src.className!="mstrIcon-tb mstrIcon-disabled"){this.confirmDeleteDataSet();}break;}return false;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrRWObjectsImpl.prototype.confirmDeleteDataSet=function(){try{var descriptor=microstrategy.descriptors.getDescriptor("4966");if(this.selections){var currSelections=this.selections;for(member in currSelections.items){var objType=currSelections.items[member].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(objType==microstrategy.DSSTYPE_RPT_DEFINITION&&currSelections.items[member].getAttribute("oid")==microstrategy.primeDataSetId){descriptor=microstrategy.descriptors.getDescriptor("5171");}}}showMessage({contents:descriptor,elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').selections.deleteDataSet();",type:mstrMsgBoxImpl.MSG_WARNING});}catch(err){microstrategy.errors.log(err);}};mstrRWObjectsImpl.prototype.confirmSetPrimeDataSet=function(){try{var descriptor=microstrategy.descriptors.getDescriptor("3043");if(this.selections.determineIsValid()){this.selections.setPrimeDataSet();}else{showMessage({contents:descriptor,elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').selections.setPrimeDataSet();",type:mstrMsgBoxImpl.MSG_WARNING});}}catch(err){microstrategy.errors.log(err);}};mstrRWObjectsImpl.prototype.onselectionchange=function(e){try{var enable=false;if(this.selections&&this.selections.isActive()&&!this.selections.isMulti()){var item=this.selections.firstItem();enable=(item!=null&&item.getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_RPT_DEFINITION);}if(this.deleteButton){this.deleteButton.className=(enable)?"mstrIcon-tb":"mstrIcon-tb mstrIcon-disabled";}}catch(err){microstrategy.errors.log(err);}};mstrRWObjectsImpl.prototype.hasMetrics=function(){try{var items=this.tree.elem.getElementsByTagName("span");for(var i=0;i<items.length;i++){if(items[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_METRIC){return true;}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrRWObjectsImpl.prototype.getDatasetName=function(datasetId){return this.getDatasetAtt(datasetId,"ds");};mstrRWObjectsImpl.prototype.getDatasetType=function(datasetId){return this.getDatasetAtt(datasetId,"oty");};mstrRWObjectsImpl.prototype.getDatasetAtt=function(datasetId,attName){try{var datasetList=microstrategy.findChildrenWithAtt(this.elem,"span",microstrategy.HTMLATTR_DSS_TYPE,microstrategy.DSSTYPE_RPT_DEFINITION);if(!datasetList){return"";}for(var i=0;datasetList&&i<datasetList.length;i++){if(datasetList[i].getAttribute("id").indexOf(datasetId)>-1){return datasetList[i].getAttribute(attName);}}}catch(err){microstrategy.errors.log(err);}return"";};mstrRWObjectsImpl.prototype.isMetricUnique=function(metricName){try{var count=0;var metricList=microstrategy.findChildrenWithAtt(this.elem,"span",microstrategy.HTMLATTR_DSS_TYPE,microstrategy.DSSTYPE_METRIC);for(var i=0;metricList&&i<metricList.length&&count<2;i++){if(metricList[i].getAttribute("ds")==metricName){count++;}}return(count<=1);}catch(err){microstrategy.errors.log(err);}return true;};mstrRWObjectsImpl.prototype.resize=function(){try{var SURROUNDING_PADDING=7;var IN_BETWEEN_PADDING=12;var accordionTabManager=microstrategy.findAncestorWithAtt(this.elem,"scriptClass","mstrAccordionTabManagerImpl");if(accordionTabManager){var accordionTabManagerBone=microstrategy.findBone(accordionTabManager);var gah=accordionTabManagerBone.getAvailableHeight();var newHeight=0;if(gah>SURROUNDING_PADDING){newHeight=gah-SURROUNDING_PADDING;}this.elem.parentNode.style.height=newHeight+"px";this.elem.style.height=newHeight+"px";this.elem.parentNode.parentNode.style.height=(((gah-(SURROUNDING_PADDING-IN_BETWEEN_PADDING))<IN_BETWEEN_PADDING)?IN_BETWEEN_PADDING:(gah-(SURROUNDING_PADDING-IN_BETWEEN_PADDING)))+"px";this.elem.style.width=accordionTabManagerBone.getAvailableWidth()+"px";}if(this.moveResizeHandles){this.moveResizeHandles();}if(this.resizeContents){this.resizeContents();}if(this.mask&&this.mask.onmaskedobjectresize){this.mask.onmaskedobjectresize();}}catch(err){microstrategy.errors.log(err);return false;}};mstrRWObjectsImpl.prototype.afterresize=function(){try{if(this.resizeContents){this.resizeContents();}}catch(err){microstrategy.errors.log(err);return false;}};mstrRWObjectsImpl.prototype.populateInDocAttributeLinkInfo=function populateInDocAttributeLinkInfo(){var als=microstrategy.bone("rwb_viewer")["als"];if(!als){return ;}if(!als.links){als.links={};var links=als.links,len=(als&&als.length)||0,i,pair,k,v;for(i=0;i<len;i++){pair=als[i];for(k in pair){v=pair[k];if(!links[k]){links[k]=[];}links[k].push(v);if(!links[v]){links[v]=[];}links[v].push(k);}}}};function mstrRWObjectsImpl(id){this.inherits=mstrObjectBrowserImpl;this.inherits(id);delete this.inherits;return this;}mstrRWObjSelectionsImplScript=true;mstrRWObjSelectionsImpl.prototype=new mstrObjSelectionsImpl();mstrRWObjSelectionsImpl.prototype.dragDisplay=null;mstrRWObjSelectionsImpl.prototype.targetMask=null;mstrRWObjSelectionsImpl.prototype.onmousedown=function(e){try{var src=getEventTarget(e);var mstrSrc=microstrategy.eventManager.getSource(e);if(mstrSrc&&mstrSrc.button>1){var types="["+this.getDssTypes().toString()+"]";for(var id in this.items){var objInfo=new mstrObjectInfoImpl(this.items[id]);microstrategy.getContextMenuManager("RWObjB").getMenu("rwobjbrowser_context_menu").registerTrigger(this.items[id],types);}return false;}if(e.ctrlKey){return ;}mstrSelectionsImpl.prototype.onmousedown.call(this,e);if(this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_SUBTYPE)==microstrategy.DSSTYPE_REPORT_CUBE){return ;}var verifiedPath=microstrategy.getEventHandlerString(this.path);if(typeof (mstr)!="undefined"){this.parentBone.attachWinListener(this,"mousemove","ondragstart");this.parentBone.attachWinListener(this,"mouseup","onmouseup",false);}else{document.onmousemove=new Function("e",verifiedPath+" { return "+this.path+".ondragstart(e); }");if(document.onmouseup==null){document.onmouseup=new Function("e",verifiedPath+" { return "+this.path+".onmouseup(e); }");}}return false;}catch(err){microstrategy.errors.log(err);}return false;};mstrRWObjSelectionsImpl.prototype.ondrag=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}getMouse(e);var x=lMouseX;var y=lMouseY;var offsetX=55;var offsetY=12;var objTypes=","+this.getDssTypes().toString()+",";if(objTypes.indexOf(","+microstrategy.DSSTYPE_HIERARCHY+",")==-1){var src=microstrategy.findAncestor(getEventTarget(e));if(src){var showTargetMask=false;var isTemplate=(objTypes.indexOf(","+microstrategy.DSSTYPE_RPT_DEFINITION+",")>-1);var objType=src.getAttribute(microstrategy.HTMLATTR_OBJTYPE);var rect=this.getOuterRect(src,getObj("mstrWebContents"));switch(objType){case microstrategy.OBJTYPE_DOC_OBJECT:var subType=src.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);if(!this.isEditableViewModeEplus()&&subType!=microstrategy.SUBOBJTYPE_DOC_TEMPLATE){break;}if(subType==microstrategy.SUBOBJTYPE_DOC_TEXT){showTargetMask=(!isTemplate);rect.top-=3;rect.right+=5;rect.bottom+=2;break;}else{if(subType==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){showTargetMask=this.getItems()&&(this.getItems().length==1)&&(this.isSupportedBySelector(this.getItems()[0],src));rect.top-=3;rect.right+=5;rect.bottom+=2;break;}else{src=microstrategy.findAncestor(src.parentNode);rect=this.getOuterRect(src,getObj("mstrWebContents"));}}case microstrategy.OBJTYPE_DOC_SUBSECTION:if(!this.isEditableViewModeEplus()){break;}var useSnap=(e.ctrlKey)?microstrategy.SNAP_OFF:!microstrategy.SNAP_OFF;if(useSnap){x=microstrategy.snapCoordinate(x-offsetX-microstrategy.CURSOR_OFFSET,getObjSumLeft(src.parentNode),true);y=microstrategy.snapCoordinate(y-offsetY-microstrategy.CURSOR_OFFSET,getObjSumTop(src.parentNode),true);x+=offsetX+microstrategy.CURSOR_OFFSET;y+=offsetY+microstrategy.CURSOR_OFFSET;}rect.left+=3;showTargetMask=true;if(src.getAttribute(microstrategy.HTMLATTR_DETAILS_SECTION)==microstrategy.TRUE&&isTemplate){showTargetMask=false;}break;default:showTargetMask=false;break;}if(showTargetMask){this.targetMask.resize(rect);var top=(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE)?rect.top+1:rect.top;var viewerDiv=microstrategy.getViewerBone().elem;var left=rect.left-this.targetMask.offset-viewerDiv.offsetLeft+viewerDiv.scrollLeft;top-=viewerDiv.offsetTop-viewerDiv.scrollTop;this.targetMask.moveTo(left,top);this.targetMask.show();}else{this.targetMask.hide();}}}moveObjTo(this.dragDisplay,x-offsetX-microstrategy.CURSOR_OFFSET,y-offsetY-microstrategy.CURSOR_OFFSET);this.parentBone.dndHelper.moveHelperImage(e);}catch(err){microstrategy.errors.log(err);}return false;};mstrRWObjSelectionsImpl.prototype.ondragend=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}var x=parseInt(this.dragDisplay.style.left);var y=parseInt(this.dragDisplay.style.top);this.parentBone.dndHelper.parkObject(this.dragDisplay);microstrategy.eventManager.notifyOrphanBones("onnotifydragend",this.parentBone);this.targetMask.hide();this.onmouseup(e);var src=microstrategy.findAncestor(getEventTarget(e));if(src){this.shiftKey=e.shiftKey;this.ctrlKey=e.ctrlKey;var sortedItems=this.getItems();var objType=src.getAttribute(microstrategy.HTMLATTR_OBJTYPE);switch(objType){case microstrategy.OBJTYPE_DOC_OBJECT:if(!this.isEditableViewModeEplus()){return ;}var subType=src.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);if(subType==microstrategy.SUBOBJTYPE_DOC_TEXT){var at=this.parentBone.elem.getAttribute("at");if(at!=null&&at.length>0){var bone=microstrategy.bone(at);if(bone&&bone.commands){var ac=[];for(var i=0;i<sortedItems.length;i++){var item=sortedItems[i];var objType=item.getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(objType!=microstrategy.DSSTYPE_RPT_DEFINITION){var text=item.getAttribute(microstrategy.HTMLATTR_DESCRIPTION);if(objType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){var ul=findTargetTag(item.parentNode,"ul");if(ul){var li=findTargetTag(ul,"li");if(li&&li.getElementsByTagName("span")[0]){if(text.indexOf(" ")>-1){text="["+text+"]";}var attrName=li.getElementsByTagName("span")[0].getAttribute(microstrategy.HTMLATTR_DESCRIPTION);text=((attrName.indexOf(" ")>-1)?"["+attrName+"]":attrName)+"@"+text;}}}else{if(text.indexOf(" ")>-1){text="["+text+"]";}}bone.commands.exec("addToTextField",["{"+text+"}",src,ac]);}}if(ac.length>0){this.updateManager.add(ac);bone.commands.exec("editTextField",src);}}}break;}else{if(subType==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){if(sortedItems.length==1){var at=this.parentBone.elem.getAttribute("at");if(at!=null&&at.length>0){var bone=microstrategy.bone(at);if(bone&&bone.commands){var item=sortedItems[0];var objID=item.getAttribute(microstrategy.HTMLATTR_DSS_ID);var text=item.getAttribute(microstrategy.HTMLATTR_DESCRIPTION);var objType=item.getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(text.indexOf(" ")>-1){text="["+text+"]";}if(this.isSupportedBySelector(item,src)){bone.commands.exec("setSelectorSource",[objID,objType,text,src]);}}}}break;}else{src=microstrategy.findAncestor(src.parentNode);}}case microstrategy.OBJTYPE_DOC_SUBSECTION:if(!this.isEditableViewModeEplus()){return ;}this.dragX=x-getObjSumLeftScrolled(src);this.dragY=y-getObjSumTop(src);this.docViewerBone=microstrategy.bone("rwb_viewer");if(this.docViewerBone.docViewsSize>1&&!this.docViewerBone.defaultInsertMode){var fc="var rwb = microstrategy.bone('rwb_viewer').doc, p = document.getElementById('msgPref'), checked = p && p.checked;";var doExec="var ob = microstrategy.bone('reportObjs_RWWorkingSetStyle');var src= document.getElementById('"+src.id+"');var bone = microstrategy.findBone(src);bone.ondrop(src, ob.selections);";var fok=fc+"rwb.visibleCurOnly=false;"+doExec+"if(checked) rwb.updateInsertMode(true);";var fcancel=fc+"rwb.visibleCurOnly=true;"+doExec+"if(checked) rwb.updateInsertMode(false);";fnShowMessageAdd(fok,fcancel);}else{var bone=microstrategy.findBone(src);bone.ondrop(src,this);}break;default:var bone=microstrategy.boneForMask(src);if(bone&&bone.ondrop){bone.ondrop(src,this);}break;}}}catch(err){microstrategy.errors.log(err);}return false;};mstrRWObjSelectionsImpl.prototype.isSupportedBySelector=function(item,src){var ctl=src&&microstrategy.bone(src.id+"_Ctl"),ctlType=ctl&&ctl.ctlType,sty=ctl&&ctl.ctlStyle;if(mstrRWControlImpl&&ctlType==mstrRWControlImpl.CTL_TYPE_TRANSACTION_ACTION){return false;}switch(item.getAttribute(microstrategy.HTMLATTR_DSS_TYPE)){case microstrategy.DSSTYPE_CONSOLIDATION:return sty!="9";case microstrategy.DSSTYPE_ATTRIBUTE:if(sty=="11"){var objID=item.getAttribute(microstrategy.HTMLATTR_DSS_ID),atts=microstrategy.bone("rwb_viewer").getAttributesWithDateForms(),_result=false;mstr.$A.forEach(atts,function(att){var oid=att.dssid.split("|")[0];if(oid==objID){_result=true;return false;}});return _result;}return !sty||(sty!="7"&&sty!="8");case microstrategy.DSSTYPE_USER_METRIC:case microstrategy.DSSTYPE_METRIC:case microstrategy.DSSTYPE_USER_SUMMARY_METRIC:return sty=="7"||sty=="8";case microstrategy.DSSTYPE_FILTER:return item.getAttribute(microstrategy.HTMLATTR_DSS_SUBTYPE)==microstrategy.DSSTYPE_CUSTOM_GROUP&&sty!="9";default:return false;}return false;};mstrRWObjSelectionsImpl.prototype.editDataSet=function(){try{for(member in this.items){var objType=this.items[member].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(objType==microstrategy.DSSTYPE_RPT_DEFINITION){}}return true;}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.isPrimaryJoinDataset=function(){try{for(member in this.items){var objType=this.items[member].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(objType==microstrategy.DSSTYPE_RPT_DEFINITION){return(this.items[member].getAttribute(microstrategy.HTMLATTR_IS_DATASET_JOIN_PRIMARY)=="1");}}return false;}catch(err){microstrategy.errors.log(err);}return true;};mstrRWObjSelectionsImpl.prototype.setPrimaryJoinDataset=function(value){try{var updateManager=this.parentBone.updateManager;var actionCollection=new Array();var docViewerBone=microstrategy.bone("rwb_viewer");for(member in this.items){var objType=this.items[member].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);this.items[member].setAttribute(microstrategy.HTMLATTR_IS_DATASET_JOIN_PRIMARY,(value?"1":"0"));if(objType==microstrategy.DSSTYPE_RPT_DEFINITION){if(updateManager){actionCollection.push(updateManager.createActionObject(this.items[member],mstrUpdateManager.SET_DATASET_JOIN_MODE,docViewerBone.beanPath,["2048032","2048155"],[this.items[member].getAttribute("oid"),value],[this.items[member].getAttribute("oid"),"true"]));}}}if(actionCollection.length>0){updateManager.add(actionCollection);if(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE){updateManager.flushAndSubmitChanges();}}}catch(err){microstrategy.errors.log(err);}return true;};mstrRWObjSelectionsImpl.prototype.deleteDataSet=function(){try{var isDataset=false;for(id in this.items){if(this.items[id].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_RPT_DEFINITION){isDataset=true;break;}}if(!isDataset){return true;}var updateManager=this.parentBone.updateManager;var actionCollection=new Array();for(member in this.items){var objType=this.items[member].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(objType==microstrategy.DSSTYPE_RPT_DEFINITION){if(updateManager){actionCollection.push(updateManager.createActionObject(this.items[member],mstrUpdateManager.REMOVE_DATASET,this.parentBone.beanPath,["2048032","2048034"],[this.items[member].getAttribute("oid"),"true"],[this.items[member].getAttribute("oid"),"true"]));}}}if(actionCollection.length>0){updateManager.add(actionCollection);updateManager.flushAndSubmitChanges();}return true;}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.setPrimeDataSet=function(){try{var isDataset=false;for(id in this.items){if(this.items[id].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_RPT_DEFINITION){isDataset=true;break;}}if(!isDataset){return true;}var updateManager=this.parentBone.updateManager;var actionCollection=new Array();for(member in this.items){var objType=this.items[member].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(objType==microstrategy.DSSTYPE_RPT_DEFINITION){if(updateManager){actionCollection.push(updateManager.createActionObject(this.items[member],mstrUpdateManager.SET_PRIMARY_DATASET,this.parentBone.beanPath,["2048031"],[this.items[member].getAttribute("oid")],[microstrategy.primeDataSetId]));}}}if(actionCollection.length>0){updateManager.add(actionCollection);updateManager.flushAndSubmitChanges();}return true;}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.getDatasetMembers=function(obj){try{var __result=null;if(obj.getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_RPT_DEFINITION){__result=this.getChildren(obj);}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.getDataSetId=function(){try{var __result=null;var ids=new Array();for(var item in this.items){var objInfo=new mstrObjectInfoImpl(this.items[item]);if(objInfo.dssType!=microstrategy.DSSTYPE_RPT_DEFINITION){ids.push(objInfo.dSetId);}else{ids.push(objInfo.dssId);}}if(ids.length>0){ids.sort();if(ids[0]==ids[ids.length-1]){__result=ids[0];}}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.getActiveUserMetricIndxKey=function(){try{var result=null;var sortedItems=mstr.utils.Arrays.fromHashValues(this.items);if((sortedItems[0].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_USER_METRIC)||(sortedItems[0].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_USER_SUMMARY_METRIC)){result=new Array();result[0]=sortedItems[0].oid;result[1]=sortedItems[0].key;}return result;}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.processContextMenu=function(cmd){this.docViewerBone=microstrategy.bone("rwb_viewer");if(this.docViewerBone.docViewsSize>1&&!this.docViewerBone.defaultInsertMode&&(cmd=="addToSectionWithFormat"||cmd=="addToSectionAsShortcut"||cmd=="addToSectionAsStatic"||cmd=="addToSectionAsSelector"||cmd=="addToSection"||cmd=="addToSectionAsDynamic")){var fc="var rwb = microstrategy.bone('rwb_viewer').doc, p = document.getElementById('msgPref'), checked = p && p.checked;";var doExec="var ob = microstrategy.bone('reportObjs_RWWorkingSetStyle');ob.selections.doProcessContextMenu('"+cmd+"');";var fok=fc+"rwb.visibleCurOnly=false;"+doExec+"if(checked) rwb.updateInsertMode(true);";var fcancel=fc+"rwb.visibleCurOnly=true;"+doExec+"if(checked) rwb.updateInsertMode(false);";fnShowMessageAdd(fok,fcancel);}else{this.doProcessContextMenu(cmd);}};mstrRWObjSelectionsImpl.prototype.doProcessContextMenu=function(cmd){try{this.docViewerBone=microstrategy.bone("rwb_viewer");var sortedItems=this.getItems();var userDerivedMetricId;var datasetID=this.getDataSetId();var userDerivedMetricKey=0;var um=this.parentBone.updateManager,mid=mstrApp.getMsgID();var updateManageActions=[um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[])],refreshCB={success:function(res){um.add(updateManageActions);um.flushAndSubmitChanges();}};switch(cmd){case"addToSectionWithFormat":var cmdValue=new Array(sortedItems,this.parentBone);this.shiftKey=false;return(this.docViewerBone.commands.exec("addObjsWithFormat",cmdValue));case"addToSectionAsShortcut":var cmdValue=new Array(sortedItems,this.parentBone);return(this.docViewerBone.commands.exec("addObjsAsLinked",cmdValue));case"addToSectionAsStatic":return(this.docViewerBone.commands.exec("addasText",sortedItems));case"addToSectionAsSelector":return(this.docViewerBone.commands.exec("addAsSelector",sortedItems));case"addToSection":var sub=this.docViewerBone.commands.queryState("selectedSection");this.dragX=getObjSumLeftScrolled(sub)-getObjSumLeft(sub)+5;this.dragY=getObjSumTopScrolled(sub)-getObjSumTop(sub)+5;this.ctrlKey=false;this.shiftKey=true;return(this.docViewerBone.commands.exec("addObjs",this));case"addToSectionAsDynamic":var sub=this.docViewerBone.commands.queryState("selectedSection");this.dragX=getObjSumLeftScrolled(sub)-getObjSumLeft(sub)+5;this.dragY=getObjSumTopScrolled(sub)-getObjSumTop(sub)+5;this.ctrlKey=this.shiftKey=false;return(this.docViewerBone.commands.exec("addObjs",this));case"addToGrouping":return(this.docViewerBone.commands.exec("addToGrouping",this));case"editUserMetric":case"addUserMetric":var dss=microstrategy.bone("rwb_viewer")["datasetInfos"],curId=sortedItems[0]&&sortedItems[0].getAttribute(microstrategy.HTMLATTR_DSS_ID),curName=sortedItems[0]&&sortedItems[0].getAttribute(microstrategy.HTMLATTR_DISPLAY_NAME),config={datasets:dss,dsid:datasetID,msgID:mid},actions=[];var submitAction=function(actions){mstrmojo.xhr.request("POST",mstrConfig.taskURL,refreshCB,{taskId:"mojoRWManipulation",rwb:um.getRWBState(),messageID:mid,suppressData:true,params:JSON.stringify({actions:actions,style:{params:{treesToRender:0},name:"RWIVEMojoStyle"}})});};if(cmd==="addUserMetric"){config.metricId="";config.action={cmd:"editNew",refOi:{did:curId,n:curName}};config.onApplyMetricCallback=function(cfg){actions.push({act:"addDerivedMetricToDataset",dsid:datasetID,formula:cfg.tokenStreamXML,isTokenStream:!mstrmojo.string.isEmpty(cfg.tokenStreamXML),name:cfg.alias,afb:cfg.afb,sfb:cfg.sfb});submitAction.call(this,actions);};}else{config.metricId=curId;config.action={cmd:"edit",n:curName};config.onApplyMetricCallback=function(cfg){actions.push({act:"editDM",formula:cfg.tokenStreamXML,isTokenStream:!mstrmojo.string.isEmpty(cfg.tokenStreamXML),afb:cfg.afb,sfb:cfg.sfb,alias:cfg.alias,name:cfg.alias,dsid:datasetID,did:curId});submitAction.call(this,actions);};}microstrategy.openDerivedMetricEditor(config);break;case"addDerivedAttr":var insertingNew=true;case"editDerivedAttr":if(datasetID&&(datasetID.length>0)){var viewer=microstrategy.bone("rwb_viewer"),dss=viewer.datasetInfos,curId=sortedItems[0]&&sortedItems[0].getAttribute(microstrategy.HTMLATTR_DSS_ID),curAttr,curDs=dss&&dss[datasetID],attslen=(curDs&&curDs.att&&curDs.att.length)||0,attr={},submitAction=function(params,callback){viewer.checkAndDisableFlashDefaultMode(um,updateManageActions);refreshCB=mstrmojo.func.wrapMethods(callback,refreshCB);mstrmojo.xhr.request("POST",mstrConfig.taskURL,refreshCB,{taskId:"mojoRWManipulation",rwb:um.getRWBState(),messageID:mid,suppressData:true,params:JSON.stringify({actions:[params],style:{params:{treesToRender:0},name:"RWIVEMojoStyle"}})});};for(var i=0;i<attslen;i++){var unit=curDs.att[i];if(unit.did===curId){curAttr=unit;if(!insertingNew&&unit.da){attr=unit;}break;}}var okCB=function(){microstrategy.openDerivedAttrEditor({datasets:dss,dsid:datasetID,msgID:mid,did:attr.did,n:attr.n,forms:attr.fs,onAttribute:curAttr,oncreate:submitAction,onupdate:submitAction});};if(insertingNew){viewer.showWarningMessageForUnsupportFeature(okCB);break;}okCB();}break;case"removeDerivedAttr":if(datasetID&&(datasetID.length>0)){var curId=sortedItems[0]&&sortedItems[0].getAttribute(microstrategy.HTMLATTR_DSS_ID),daList=datasetID+mstrUpdateManager.UNIT_SEPARATOR+curId,updateManager=this.parentBone.updateManager,actionCollection=new Array();if(updateManager){actionCollection.push(updateManager.createActionObject(this,mstrUpdateManager.REMOVE_DERIVED_ATTRIBUTES_FROM_DATASET,this.parentBone.beanPath,["2048075","2048018"],[daList,"1"],[]));}if(actionCollection.length>0){updateManager.add(actionCollection);updateManager.flushAndSubmitChanges();}}break;case"addShortcutMetricCount":case"addShortcutMetricMin":case"addShortcutMetricMax":case"addShortcutMetricAvg":case"addShortcutMetricSum":case"addShortcutMetricStdDev":case"addShortcutMetricVar":if(datasetID&&(datasetID.length>0)){var updateManager=this.parentBone.updateManager;var actionCollection=new Array();var unitID=sortedItems[0].getAttribute(microstrategy.HTMLATTR_DSS_ID);var unitType=sortedItems[0].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(updateManager&&unitID&&unitID.length>0){var func={addShortcutMetricSum:12,addShortcutMetricCount:13,addShortcutMetricAvg:14,addShortcutMetricMin:15,addShortcutMetricMax:16,addShortcutMetricStdDev:32,addShortcutMetricVar:33}[cmd];actionCollection.push(updateManager.createActionObject(this,mstrUpdateManager.RW_ADD_SHORTCUT_METRIC,this.parentBone.beanPath,["2048032","2048033","2048249","2048251"],[datasetID,this.parentBone.getDatasetType(datasetID),func,unitID+","+unitType],[]));}if(actionCollection.length>0){updateManager.add(actionCollection);updateManager.flushAndSubmitChanges();}}break;case"removeUserMetric":if(this.isMulti()&&!this.isSameType()){return false;}var userMetricsList="";var delimiter="";for(var i=0;i<sortedItems.length;i++){if(sortedItems[i]!=null){userMetricsList+=delimiter+datasetID+mstrUpdateManager.UNIT_SEPARATOR+sortedItems[i].getAttribute(microstrategy.HTMLATTR_DSS_ID);delimiter=mstrUpdateManager.ITEM_SEPARATOR;}}if(userMetricsList.length>0){var updateManager=this.parentBone.updateManager;var actionCollection=new Array();if(updateManager){actionCollection.push(updateManager.createActionObject(this,mstrUpdateManager.REMOVE_DERIVED_METRICS_FROM_DATASET,this.parentBone.beanPath,["2048075","2048018"],[userMetricsList,"1"],[]));}if(actionCollection.length>0){updateManager.add(actionCollection);updateManager.flushAndSubmitChanges();}}break;case"formatUserMetric":return(this.docViewerBone.commands.exec("openFormatDMetric",sortedItems));break;default:return false;}}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.getDataSets=function(){var docDataSets=microstrategy.bone("rwb_viewer")["documentDataSets"];if(docDataSets){return docDataSets;}return null;};mstrRWObjSelectionsImpl.prototype.loadAttributeLinkTarget=function loadAttributeLinkTarget(){var cmm=microstrategy.getContextMenuManager("RWObjB"),loadMenu=cmm.findMenuItem(microstrategy.descriptors.getDescriptor("2901")),srcAttrID=this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_ID),srcDataSetID=this.clickedSrc.getAttribute(microstrategy.HTMLATTR_ID).substring(0,32),isIDForm=function isIDForm(attID,formID){var dss=microstrategy.bone("rwb_viewer")["datasetInfos"],dsID,atts,att,fs,f,i,ilen,j,jlen;for(dsID in dss){atts=dss[dsID].att;for(i=0,ilen=atts.length;i<ilen;i++){att=atts[i];if(att.did==attID){fs=att.fs;for(j=0,jlen=fs.length;j<jlen;j++){f=fs[j];if(formID==f.fid&&f.idf){return true;}}break;}}}return false;},removeOriginMenuItem=function removeOriginMenuItem(){var menu=getMenuDiv(aMenuItemsName+2),rows=menu.getElementsByTagName("tr"),i,rLen,tr;if(rows!=null){for(i=0,rLen=rows.length;i<rLen;i++){tr=rows[i];tr.parentNode.removeChild(tr);}}},updateMenuCallback={success:function(res){var linkableAttrs=res.als,ats=linkableAttrs[0].ats,als=microstrategy.bone("rwb_viewer")["als"],dss=microstrategy.bone("rwb_viewer")["datasetInfos"],links=als&&als.links||{},toLink={},tgtAttrs={},namesHash={},hasTarget=false,i,ilen,j,jlen,at,fms,fm,k,v,tgtAttrID,attrMenu,attrMenuItem,attrName,nh,size;for(i=0,ilen=ats.length;i<ilen;i++){at=ats[i].at;fms=ats[i].fms;for(j=0,jlen=fms.length;j<jlen;j++){fm=fms[j].fm;if(isIDForm(at,fm)){toLink[at]=true;hasTarget=true;break;}}}for(k in links){if(k.indexOf(srcAttrID+" ")==0){v=links[k];for(i=0,ilen=v.length;i<ilen;i++){tgtAttrID=v[i].split(" ")[0];toLink[tgtAttrID]=true;hasTarget=true;}break;}}attrMenu=cmm.getMenu();if(hasTarget){for(k in dss){v=dss[k];ats=v.att;for(i=0,ilen=ats.length;i<ilen;i++){at=ats[i];if(toLink[at.did]){if(!namesHash[at.n]){namesHash[at.n]={};}if(!namesHash[at.n][at.did]){namesHash[at.n][at.did]=[];}namesHash[at.n][at.did].push(v.name);tgtAttrs[at.did]=at;}}}for(tgtAttrID in toLink){at=tgtAttrs[tgtAttrID];attrName=at.n;nh=namesHash[at.n];if(nh){size=0;for(k in nh){size++;}if(size>1){attrName+=" ("+nh[at.did].join(",")+")";}}attrMenuItem=attrMenu.addItem(attrName,"microstrategy.bone('reportObjs_RWWorkingSetStyle').selections.confirmAttributeLinking('"+tgtAttrID+"')",null,null,mstrContextMenuImpl.IMG_CHECK);attrMenuItem[9]="microstrategy.bone('reportObjs_RWWorkingSetStyle').selections.showAttributeLinkingCheckmark('"+tgtAttrID+"')";}}else{attrMenu.addItem(microstrategy.descriptors.getDescriptor("13398"),"");}removeOriginMenuItem();addDynamicMenus(2,cmm.menu_items,attrMenu.menu_items);loadAttributeLinkTarget.attrMenu[srcAttrID]=attrMenu.menu_items;loadAttributeLinkTarget.cmmMenuItemSize=cmm.menu_items.length;}};if(!loadAttributeLinkTarget.attrMenu||(loadAttributeLinkTarget.cmmMenuItemSize!=cmm.menu_items.length)){loadAttributeLinkTarget.attrMenu={};}if(!loadAttributeLinkTarget.attrMenu[srcAttrID]){loadMenu[0][2]=mstrContextMenuImpl.IMG_LOADING;mstrmojo.xhr.request("POST",mstrConfig.taskURL,updateMenuCallback,{taskId:"validateDocumentLinks",msgID:mstrApp.getMsgID(),action:1,attributeList:srcAttrID});}else{window.setTimeout(function(){removeOriginMenuItem();addDynamicMenus(2,cmm.menu_items,loadAttributeLinkTarget.attrMenu[srcAttrID]);},0);}return true;};mstrRWObjSelectionsImpl.prototype.isAttributesLinked=function(srcAttrID,targetAttrID){var als=microstrategy.bone("rwb_viewer")["als"],links=als&&als.links||{},k,v,i,len;for(k in links){if(k.indexOf(srcAttrID+" ")==0){v=links[k];for(i=0,len=v.length;i<len;i++){if(v[i].indexOf(targetAttrID+" ")==0){return true;}}}}return false;};mstrRWObjSelectionsImpl.prototype.showAttributeLinkingCheckmark=function(targetAttrID){var srcAttrID=this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_ID);return(this.clickedSrc.getAttribute(microstrategy.HTMLATTR_LINK_TO)=="1"&&this.isAttributesLinked(srcAttrID,targetAttrID));};mstrRWObjSelectionsImpl.prototype.confirmAttributeLinking=function(targetAttrID){var srcAttrID=this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_ID),findIDForm=function findIDForm(attID){var dss=microstrategy.bone("rwb_viewer")["datasetInfos"],dsID,atts,att,fs,f,i,ilen,j,jlen;for(dsID in dss){atts=dss[dsID].att;for(i=0,ilen=atts.length;i<ilen;i++){att=atts[i];if(att.did==attID){fs=att.fs;for(j=0,jlen=fs.length;j<jlen;j++){f=fs[j];if(f.idf){return f.fid;}}break;}}}};if(this.clickedSrc.getAttribute(microstrategy.HTMLATTR_LINK_TO)=="1"&&this.isAttributesLinked(srcAttrID,targetAttrID)){return ;}var me=this,cb=function(){me.attributeLinking(srcAttrID,findIDForm(srcAttrID),targetAttrID,findIDForm(targetAttrID),false);};microstrategy.bone("rwb_viewer").showWarningMessageForUnsupportFeature(cb);};mstrRWObjSelectionsImpl.prototype.confirmAttributeUnlinking=function(){var als=microstrategy.bone("rwb_viewer")["als"],links=als&&als.links||{},srcAttrID=this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_ID),srcForms=[],tgtAttrs=[],tgtForms=[],ITEM_SEPARATOR="\u001E",k,v,ks,vs,i,len;for(k in links){ks=k.split(" ");if(ks[0]===srcAttrID){v=links[k];for(i=0,len=v.length;i<len;i++){vs=v[i].split(" ");tgtAttrs.push(vs[0]);tgtForms.push(vs[1]);srcForms.push(ks[1]);}}}this.attributeLinking(srcAttrID,srcForms.join(ITEM_SEPARATOR),tgtAttrs.join(ITEM_SEPARATOR),tgtForms.join(ITEM_SEPARATOR),true);};mstrRWObjSelectionsImpl.prototype.attributeLinking=function(srcAttrID,srcFormIDs,targetAttrIDs,targetFormIDs,unlink){var updateManager=this.parentBone.updateManager,ac=[],viewer=microstrategy.bone("rwb_viewer");ac.push(updateManager.createActionObject(this,mstrUpdateManager.LINK_ATTRIBUTES,this.parentBone.beanPath,["2048262","2048286","2048287","2048288","2048289"],[srcAttrID,srcFormIDs,targetAttrIDs,targetFormIDs,unlink],[]));viewer.checkAndDisableFlashDefaultMode(updateManager,ac);updateManager.add(ac);updateManager.flushAndSubmitChanges();};mstrRWObjSelectionsImpl.prototype.enableAttributeLinking=function(){var docDataSets=this.getDataSets();if(docDataSets==null){return ;}var size=0,dSetID;for(dSetID in docDataSets){size++;}if(size<=1){var linkTo=microstrategy.getContextMenuManager("RWObjB").findMenuItem(microstrategy.descriptors.getDescriptor("9747"));linkTo[0][3]="0";return false;}return true;};mstrRWObjSelectionsImpl.prototype.enableAttributeUnlinking=function(){var als=microstrategy.bone("rwb_viewer")["als"],links=als&&als.links||{},srcAttrID=this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_ID),k;for(k in links){if(k.indexOf(srcAttrID+" ")==0){return true;}}return false;};mstrRWObjSelectionsImpl.prototype.enableContextMenuItem=function(cmdId){try{var __result=false,isEditableMode=microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE||(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&microstrategy.getViewerBone().currentRWViewMode==microstrategy.RW_VIEW_MODE_EDITABLE),allowDA=(function(me){var _result=true,datasetID=me.getDataSetId();if(datasetID&&(datasetID.length>0)){var viewer=microstrategy.bone("rwb_viewer"),dss=viewer.datasetInfos,curDs=dss&&dss[datasetID];if(curDs.isDDA&&curDs.isMDX||microstrategy.hasCGorCon(curDs)){_result=false;}}return _result;})(this);switch(cmdId){case"addToSectionWithFormat":case"addToSection":case"addToSectctionAsShortcut":if(this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_SUBTYPE)==microstrategy.DSSTYPE_REPORT_CUBE){break;}case"addToSectionAsStatic":var at=this.parentBone.elem.getAttribute("at");if(at!=null&&at.length>0){var bone=microstrategy.bone(at);if(bone&&bone.commands.queryEnabled("subSectionIsSelected")){var objTypes=","+this.getDssTypes().toString()+",";var hasDataset=(objTypes.indexOf(","+microstrategy.DSSTYPE_RPT_DEFINITION+",")!=-1);var hasSecondary=(objTypes.indexOf(","+microstrategy.DSSTYPE_ATTRIBUTE_FORM+",")!=-1);var primaryTypes=new Array(microstrategy.DSSTYPE_METRIC,microstrategy.DSSTYPE_USER_METRIC,microstrategy.DSSTYPE_ATTRIBUTE,microstrategy.DSSTYPE_FILTER,microstrategy.DSSTYPE_CONSOLIDATION,microstrategy.DSSTYPE_CUSTOM_GROUP,microstrategy.DSSTYPE_DIMENSION,microstrategy.DSSTYPE_USER_SUMMARY_METRIC);for(var i=0;i<primaryTypes.length;i++){var exp=new RegExp(","+primaryTypes[i]+",","g");objTypes=objTypes.replace(exp,"~");}var hasPrimary=(objTypes.indexOf("~")!=-1);var sameLevel=((hasDataset&&!hasSecondary&&!hasPrimary)||(!hasDataset&&hasSecondary&&!hasPrimary)||(!hasDataset&&!hasSecondary&&hasPrimary));if(sameLevel){if(hasDataset){var section=bone.commands.queryState("selectedSection");if(section&&section.getAttribute(microstrategy.HTMLATTR_DETAILS_SECTION)!=microstrategy.TRUE){__result=true;}}else{__result=true;}}}}break;case"addToSectionAsSelector":var at=this.parentBone.elem.getAttribute("at");if(at!=null&&at.length>0){var bone=microstrategy.bone(at);if(bone&&bone.commands.queryEnabled("subSectionIsSelected")){if(this.isMulti()){return false;}return true;}}break;case"addDerivedAttr":if(!isEditableMode||!allowDA){return false;}case"addUserMetric":var objTypes=","+this.getDssTypes().toString()+",";var hasDataset=(objTypes.indexOf(","+microstrategy.DSSTYPE_RPT_DEFINITION+",")!=-1);if(hasDataset){__result=(this.getDataSetId()!=null);}else{var dSetIds=this.getDataSetIDs();dSetIds.sort();return(dSetIds[0]==dSetIds[dSetIds.length-1]);}break;case"editDerivedAttr":if(!isEditableMode||!allowDA){return false;}case"removeDerivedAttr":return !this.isMulti()&&this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_ATTRIBUTE&&this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_SUBTYPE)==microstrategy.DSSSUB_TYPE_DERIVED_ATTRIBUTE;case"addToGrouping":var validAction=this.determineIsValid();if(!validAction){return false;}var addToGroupBy=false;var at=this.parentBone.elem.getAttribute("at");if(at!=null&&at.length>0){var bone=microstrategy.bone(at);var itemsSelected=this.getItems();for(var i=0;i<itemsSelected.length;i++){if(microstrategy.isValidGroupByType(itemsSelected[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE))){var dssId=itemsSelected[i].oid||itemsSelected[i].getAttribute("oid");var groupByDssIds=bone.commands.queryState("groupByDssIds");addToGroupBy=(groupByDssIds.indexOf("|"+dssId+"|")==-1);if(addToGroupBy){break;}}}}return(addToGroupBy);break;case"attributeUnlinking":return this.clickedSrc.getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_ATTRIBUTE&&this.clickedSrc.getAttribute(microstrategy.HTMLATTR_LINK_TO)=="1";break;}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.determineIsValid=function(){try{var at=this.parentBone.elem.getAttribute("at");var groupByPresent=false;if(at!=null){groupByPresent=microstrategy.bone(at).groupByPresent;}var isPrimeDatasetIdSet=microstrategy.primeDataSetId!=null&&microstrategy.primeDataSetId!=-1;if(isPrimeDatasetIdSet&&this.getDataSetId()!=microstrategy.primeDataSetId&&(microstrategy.sortDefinedOnDefault||groupByPresent)){return false;}return true;}catch(err){microstrategy.errors.log(err);return null;}};mstrRWObjSelectionsImpl.prototype.isEditableViewModeEplus=function(){var docviewer=microstrategy.bone("rwb_viewer");if(!docviewer||docviewer.isEditableViewModeEplus()){return true;}else{return false;}};function mstrRWObjSelectionsImpl(){this.inherits=mstrObjSelectionsImpl;this.inherits();delete this.inherits;var img=document.createElement("img");img.src=microstrategy.FOLDER_IMAGES+"dragRectangle.gif";img.className="mstrDnDRWDragItem";img.style.zIndex="10000";this.dragDisplay=document.body.appendChild(img);return this;}mstrTransparentMask.prototype=new Object();mstrTransparentMask.prototype.sides=null;mstrTransparentMask.prototype.offset=3;mstrTransparentMask.prototype.resize=function(rect){try{this.sides.top.style.width=this.sides.bottom.style.width=(rect.right-rect.left)+"px";this.sides.left.style.height=this.sides.right.style.height=(rect.bottom-rect.top)+"px";}catch(err){microstrategy.errors.log(err);return null;}};mstrTransparentMask.prototype.moveTo=function(x,y){try{this.sides.top.style.top=this.sides.left.style.top=this.sides.right.style.top=y+"px";this.sides.bottom.style.top=(y+parseInt(this.sides.left.style.height)-2)+"px";this.sides.top.style.left=this.sides.left.style.left=this.sides.bottom.style.left=x+"px";this.sides.right.style.left=(x+parseInt(this.sides.top.style.width)-2)+"px";}catch(err){microstrategy.errors.log(err);return null;}};mstrTransparentMask.prototype.show=function(){try{for(var id in this.sides){this.sides[id].style.display="inline";}}catch(err){microstrategy.errors.log(err);return null;}};mstrTransparentMask.prototype.hide=function(){try{for(var id in this.sides){this.sides[id].style.display="none";}}catch(err){microstrategy.errors.log(err);return null;}};function mstrTransparentMask(parentElem){try{this.sides=new Object();var div=document.createElement("span");div.className="mstrTransparentMaskSide";div.style.height=this.offset+"px";div.style.width=this.offset+"px";this.sides.top=parentElem.appendChild(div.cloneNode(false));this.sides.right=parentElem.appendChild(div.cloneNode(false));this.sides.bottom=parentElem.appendChild(div.cloneNode(false));this.sides.left=parentElem.appendChild(div.cloneNode(false));return this;}catch(err){microstrategy.errors.log(err);return null;}}fnShowMessageAdd=function(fok,fcancel){showMessage({contents:microstrategy.descriptors.getDescriptor("8498"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:fok,buttonLabels:{Ok:microstrategy.descriptors.getDescriptor("219"),Cancel:microstrategy.descriptors.getDescriptor("218")},cancelEval:fcancel,type:mstrMsgBoxImpl.MSG_PREF_WARNING});};