mstrTreePickerVisPropsEditorImplScript=true;mstrTreePickerVisPropsEditorImpl.prototype=new mstrBoneImpl();mstrTreePickerVisPropsEditorImpl.prototype.atts=[];mstrTreePickerVisPropsEditorImpl.prototype.attSettingsContainer=null;mstrTreePickerVisPropsEditorImpl.prototype.attFormsSettingsContainer=null;mstrTreePickerVisPropsEditorImpl.prototype.ID_MODE="useAtt";mstrTreePickerVisPropsEditorImpl.prototype.ID_ATTRIBUTE="att";mstrTreePickerVisPropsEditorImpl.prototype.ID_CHILD_ID_FORM="chIDForm";mstrTreePickerVisPropsEditorImpl.prototype.ID_CHILD_DESC_FORM="chDescForm";mstrTreePickerVisPropsEditorImpl.prototype.ID_PARENT_ID_FORM="pIDForm";mstrTreePickerVisPropsEditorImpl.prototype.ID_PARENT_DESC_FORM="pDescForm";mstrTreePickerVisPropsEditorImpl.prototype.ID_LEVEL_FORM="lForm";mstrTreePickerVisPropsEditorImpl.prototype.ID_CHILD_ATT="chAtt";mstrTreePickerVisPropsEditorImpl.prototype.ID_PARENT_ATT="pAtt";mstrTreePickerVisPropsEditorImpl.prototype.ID_LEVEL_ATT="lAtt";mstrTreePickerVisPropsEditorImpl.prototype.USE_ATTRIBUTE="1";mstrTreePickerVisPropsEditorImpl.prototype.USE_ATTRIBUTE_FORMS="0";mstrTreePickerVisPropsEditorImpl.prototype.onload=function(){try{this.initBone();if(!this.valid){return ;}this.attSettingsContainer=document.getElementById("treePicker_attribute");this.attFormsSettingsContainer=document.getElementById("treePicker_attributeForms");this.settings={att:[this.ID_CHILD_ATT,this.ID_CHILD_ID_FORM,this.ID_CHILD_DESC_FORM,this.ID_PARENT_ATT,this.ID_PARENT_ID_FORM,this.ID_PARENT_DESC_FORM,this.ID_LEVEL_ATT],forms:[this.ID_ATTRIBUTE,this.ID_CHILD_ID_FORM,this.ID_CHILD_DESC_FORM,this.ID_PARENT_ID_FORM,this.ID_PARENT_DESC_FORM,this.ID_LEVEL_FORM]};this.updateMode();this.initView();this.updateByVisProps();}catch(err){microstrategy.errors.log(err);}};mstrTreePickerVisPropsEditorImpl.prototype.initView=function(){var selects=this.isFormsMode()?[this.ID_ATTRIBUTE]:[this.ID_CHILD_ATT,this.ID_PARENT_ATT],me=this;mstr.$A.forEach(selects,function(id){me.updateDependents(me.getSelect(id));});this.getCurrentModeContainer().setAttribute("populated","true");};mstrTreePickerVisPropsEditorImpl.prototype.updateByVisProps=function(){var vp=this.visProps;if(vp){var isFormsMode=this.isFormsMode(),selects=isFormsMode?[this.ID_ATTRIBUTE]:[this.ID_CHILD_ATT,this.ID_PARENT_ATT],me=this;mstr.$A.forEach(selects,function(id){var select=me.getSelect(id),deps=select.getAttribute("deps");deps=(deps&&deps.split(","))||[];mstr.$A.forEach(deps,function(vpID){me.getSelect(vpID).value=vp[vpID];});});if(isFormsMode&&this.getSelect(this.ID_LEVEL_FORM)&&!vp[this.ID_LEVEL_FORM]){this.getSelect(this.ID_LEVEL_FORM).value="-1";}}};mstrTreePickerVisPropsEditorImpl.prototype.updateMode=function(){var isFormsMode=this.isFormsMode(),me=this;this.attSettingsContainer.style.display=isFormsMode?"none":"";this.attFormsSettingsContainer.style.display=isFormsMode?"":"none";var setProps=function(idArr,v,container){mstr.$A.forEach(idArr,function(id){var select=me.getSelect(id,container);if(select){select.setAttribute("visprop",!!v?"1":"0");}});};setProps(this.settings[isFormsMode?"forms":"att"],true);setProps(this.settings[isFormsMode?"att":"forms"],false,isFormsMode?this.attSettingsContainer:this.attFormsSettingsContainer);if(!this.getCurrentModeContainer().getAttribute("populated")){this.initView();}};mstrTreePickerVisPropsEditorImpl.prototype.updateDependents=function(attSelect){var me=this,deps=attSelect.getAttribute("deps");deps=(deps&&deps.split(","))||[];mstr.$A.forEach(deps,function(dep){me.populateAttForms(dep,attSelect.value);});};mstrTreePickerVisPropsEditorImpl.prototype.populateAttForms=function(vpID,attId){var select=this.getSelect(vpID),getOption=function(value,text){var opt=document.createElement("OPTION");opt.setAttribute("value",value);opt.text=text;return opt;},getFormsByAttId=function(id){var r=[];mstr.$A.forEach(this.atts,function(att){if(att.did===id){r=att.forms;return false;}});return r;};if(select){select.innerHTML="";if(vpID===this.ID_LEVEL_FORM){select.add(getOption("-1","--none--"));}mstr.$A.forEach(getFormsByAttId.call(this,attId),function(form){select.add(getOption(form.did,form.n));});}};mstrTreePickerVisPropsEditorImpl.prototype.getCurrentModeContainer=function(){return this.isFormsMode()?this.attFormsSettingsContainer:this.attSettingsContainer;};mstrTreePickerVisPropsEditorImpl.prototype.getSelect=function(id,container){container=container||this.getCurrentModeContainer();return microstrategy.findChildWithAtt(container,"select","id",id);};mstrTreePickerVisPropsEditorImpl.prototype.isFormsMode=function(){return document.getElementById(this.ID_MODE).value===this.USE_ATTRIBUTE_FORMS;};mstrTreePickerVisPropsEditorImpl.prototype.validateSelectors=function validateSelectors(){var err=null,me=this,selectors=this.settings[this.isFormsMode()?"forms":"att"],values=[];if(this.isFormsMode()){mstr.$A.forEach(selectors,function(id,i){var sel=me.getSelect(id);if(i&&sel){var v=sel.value;if(mstr.$A.find(values,v)>-1){err="Tree Selector can't configure 2 points to the same attribute form.";return false;}values.push(v);}});}else{mstr.$A.forEach(selectors,function(id,i){var v=me.getSelect(id).value;values.push(v);});if(values[0]===values[3]){err="Entity and Parent can't configure point to the same attributes!";}else{if(values[1]===values[2]||values[4]===values[5]){err="ID and Description form can't be the same!";}}}return err||true;};function mstrTreePickerVisPropsEditorImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);this.id=id;this.inherits=null;this.path="microstrategy.bone('"+id+"')";return this;}