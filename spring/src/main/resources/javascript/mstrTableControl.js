mstrTableControlScript=true;mstrTableControl.prototype=new mstrPanelStack();mstrTableControl.prototype.unloadBone=true;mstrTableControl.prototype.isTable=true;mstrTableControl.prototype.tables=[];mstrTableControl.prototype.def="";mstrTableControl.DEFAULT_ICON="../style/mstr/images/table_icon.png";mstrTableControl.DEFAULT_INDICATOR="../style/mstr/images/navRight.png";mstrTableControl.DEFAULT_GROUP_TITLE_TEXT="4756";mstrTableControl.DEFAULT_TITLE_TEXT="4756";mstrTableControl.DEFAULT_SUBTITLE_TEXT="Subtitle";mstrTableControl.DEFAULT_VALUE_TEXT="7760";mstrTableControl.GROUP_TITLE_HEIGHT=36;mstrTableControl.DEFAULT_GROUP_TITLE_TOP_PADDING=10;mstrTableControl.DEFAULT_CELL_PADDING=10;mstrTableControl.CELL_HEIGHT=44;mstrTableControl.CELL_PADDING=0;mstrTableControl.DEFAULT_ICON_WIDTH=30;mstrTableControl.DEFAULT_INDICATOR_WIDTH=16;mstrTableControl.DEFAULT_TABLE_MARGIN=10;mstrTableControl.SELECTOR_BUTTON_HEIGHT=44;mstrTableControl.SELECTOR_BUTTON_INTERVAL=14;mstrTableControl.RECT_ZINDEX=5;mstrTableControl.IMG_ZINDEX=10;mstrTableControl.TEXT_ZINDEX=10;mstrTableControl.LINE_ZINDEX=10;mstrTableControl.SELECTOR_ZINDEX=10;mstrTableControl.LINE_PROPS={bc:true,bs:true,bw:true};mstrTableControl.RECT_PROPS={bc:true,bs:true,bw:true,bgc:true};mstrTableControl.TEXT_PROPS={ff:true,fs:true,fc:true,fb:true,fi:true,fso:true,ful:true};mstrTableControl.prototype.getDefaultSubmitBtnConfig=function(){return{dpCfm:false,subMsg:"",invCache:false,ast:8,shSubMsg:false,aapm:false,fcLvExec:false,dpTxt:microstrategy.descriptors.getDescriptor("5369"),pso:8};};mstrTableControl.prototype.getDefaultCancelBtnConfig=function(){return{dpCfm:false,subMsg:"",invCache:false,ast:4,shSubMsg:false,aapm:false,fcLvExec:false,dpTxt:microstrategy.descriptors.getDescriptor("2827"),pso:8};};mstrTableControl.prototype.onload=function(){try{mstrPanelStack.prototype.onload.call(this);if(!this.elem){return ;}this.commands=new mstrPanelStackCommandsImpl(this);this.sibs=document.getElementsByName(this.id);this.rwb=microstrategy.getViewerBone();this.um=microstrategy.updateManager;this.cleanupTables();this.submitBtn=this.submitBtn||this.getDefaultSubmitBtnConfig();this.cancelBtn=this.cancelBtn||this.getDefaultCancelBtnConfig();var props={bone:this,textPaddings:this.getDefaultTextPadding()};if(this.def){eval("var tb="+this.def);props.def=tb.table.def;props.tp=tb.table.tp;props.fmt=tb.table.fmt;props.sg={smt:{key:props.def.smk,dpTxt:this.submitBtn.dpTxt},dsc:{key:props.def.dck,dpTxt:this.cancelBtn.dpTxt},marginLeft:mstrTableControl.DEFAULT_TABLE_MARGIN,buttonInterval:mstrTableControl.SELECTOR_BUTTON_INTERVAL};}this.renderTC(props);mstr.controllers.EventManager.attachWindowEventListener(this,"closeContextMenu","closeContextMenu");}catch(err){microstrategy.errors.log(err);}};mstrTableControl.prototype.renderTC=function(props){var me=this,styleObj=me.getDocViewer().doc.styleObj,updatePanel=function(pn){pn.style.width="100%";pn.style.display="";pn.removeAttribute(microstrategy.HTMLATTR_OBJTYPE);pn.removeAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);pn.removeAttribute(microstrategy.HTMLATTR_SCRIPTCLASS);pn.innerHTML='<div style="height:100%;"/>';};var openTC=function(){props.scriptClass="mstrmojo.platform.TableModel";if(me.trxInfo){props.trxInfo=me.trxInfo;}var model=mstrmojo.insert(props);me.model=model;for(var i=0;i<me.sibs.length;i++){var sib=me.sibs[i],pn=sib.lastChild.lastChild.firstChild;me.currentPanelId=me.currentPanelId?me.currentPanelId:pn.id;var padding=parseInt(styleObj.getValue(me.elem,"padding"));padding=isNaN(padding)?1:padding;var height=me.elem.style.height?me.elem.style.height:Math.max(parseInt(styleObj.getValue(me.elem,"height",microstrategy.FORMAT_TYPE_MAIN))-(2*padding),0)+"px";sib.lastChild.style.height=height;pn.style.height=height;updatePanel(pn);var tc=mstrmojo.insert({scriptClass:"mstrmojo.platform.TableControl",model:model,container:me,text:"hello",width:microstrategy.getFormatObject().decodeValue("width",me.queryState("Width"))});me.tables.push(tc);tc.domNode=pn.lastChild;tc.render();}};if(!window.mstrmojo||!mstrmojo.platform.TableControl){microstrategy.mojoLoader.loadWidget({bundle:"mojo-tc.js",callback:openTC});}else{openTC();}};mstrTableControl.prototype.onboneaftermove=function(movedBoneIds,activeSectionSN){if(activeSectionSN){mstrPanelStack.prototype.onload.call(this);mstrPanelStack.prototype.onboneaftermove.call(this,movedBoneIds,activeSectionSN);this.commands=new mstrPanelStackCommandsImpl(this);this.sibs=document.getElementsByName(this.id);this.rwb=microstrategy.getViewerBone();this.um=microstrategy.updateManager;for(var i=0;i<this.sibs.length;i++){var sib=this.sibs[i],pn=sib.lastChild.lastChild.firstChild,tbl=this.tables[0];this.currentPanelId=this.currentPanelId?this.currentPanelId:pn.id;tbl.domNode=pn.lastChild;tbl.refresh();}}else{mstrPanelStack.prototype.onboneaftermove.call(this,movedBoneIds,activeSectionSN);}};mstrTableControl.prototype.getTextTopInCell=function(fs,ch){var f=microstrategy.getFormatObject(),diff=(parseFloat(ch)-parseFloat(f.encodeValue("top",f.getPxFromPt(fs))))/2;return diff>0?diff:0;};mstrTableControl.prototype.getTextTopInCellPx=function(fs,ch){var f=microstrategy.getFormatObject(),diff=(ch-parseInt(this.getDefaultTextPadding().v)*2-parseInt(f.getPxFromPt(fs)))/2;return diff>0?diff:0;};mstrTableControl.prototype.getTitlesTopInCell=function(tfs,stfs,ch){var f=microstrategy.getFormatObject(),tfs=parseFloat(f.encodeValue("top",f.getPxFromPt(tfs))),stfs=parseFloat(f.encodeValue("top",f.getPxFromPt(stfs))),diff=(parseFloat(ch)-tfs-stfs)/2;diff=diff>0?diff:0;return{st:diff+tfs,t:diff};};mstrTableControl.prototype.genObjId=function(){return microstrategy.OBJ_PREFIX+this.rwb.getNextObjId();};mstrTableControl.prototype.getLineWidth=function(fmt,rectWidth){var f=microstrategy.getFormatObject(),rf=fmt.g.r,border=parseInt(f.getPxFromPt((rf.bs=="none")?0:rf.bw));return parseInt(rectWidth)-border*2;};mstrTableControl.prototype.getNewCell=function(top,cHeight,fmt,addLine){var cik=(this.model.tp==1)?null:this.genObjId(),ctk=this.genObjId(),cvk=this.genObjId(),mstr_desc=microstrategy.descriptors,valueText=mstr_desc.getDescriptor(mstrTableControl.DEFAULT_VALUE_TEXT),cdef={h:cHeight,tp:106,ick:cik,tk:ctk,vk:cvk,vph:valueText,is:"textvalue",idx:"0",t:top},f=microstrategy.getFormatObject(),rf=fmt.g.r,border=parseFloat(f.getPxFromPt((rf.bs=="none")?0:rf.bw)),tw=parseFloat(this.queryState("Width"))-parseFloat(f.encodeValue("width",border))*2,tblLeft=parseFloat(f.encodeValue("left",mstrTableControl.DEFAULT_TABLE_MARGIN)),iw=cik?mstrTableControl.DEFAULT_ICON_WIDTH:mstrTableControl.DEFAULT_CELL_PADDING,eiw=parseFloat(f.encodeValue("height",iw)),etw=(tw-eiw*2)/2,ot=top,top=parseFloat(f.encodeValue("height",top)),ch=parseFloat(f.encodeValue("height",cHeight)),th=f.encodeValue("height",f.getPxFromPt(fmt.c.t.fs)),vh=f.encodeValue("height",f.getPxFromPt(fmt.c.v.fs)),adjustI=(ch>eiw)?((ch-eiw)/2):0,adjustT=this.getTextTopInCell(fmt.c.t.fs,ch),adjustV=this.getTextTopInCell(fmt.c.v.fs,ch);if(cik){this.exec({id:"addImg",v:{key:cik,n:"icon_"+cik,url:mstrTableControl.DEFAULT_ICON,top:top+adjustI,left:tblLeft,height:eiw,width:eiw},umNow:true});}this.exec({id:"addText",v:{key:ctk,n:"title"+ctk,fmla:mstr_desc.getDescriptor(mstrTableControl.DEFAULT_TITLE_TEXT),top:top+adjustT,left:eiw+tblLeft,height:th,width:etw},umNow:true});this.exec({id:"addText",v:{key:cvk,n:"value"+cvk,fmla:valueText,top:top+adjustV,left:etw+parseFloat(eiw)+tblLeft,height:vh,width:etw},umNow:true});var df=this.getDefaultFormat(106,"1"),cfg=[{key:ctk,ps:mstrTableControl.TEXT_PROPS,df:df,applyFmt:fmt.c.t},{key:cvk,ps:mstrTableControl.TEXT_PROPS,df:df,applyFmt:fmt.c.v}];this.applyDefaultFormats(cfg);if(addLine){var lk=this.genObjId();this.exec({id:"addLine",v:{key:lk,n:"line"+lk,top:ot,left:mstrTableControl.DEFAULT_TABLE_MARGIN+border,width:this.queryState("decWidth")-2*border,fmt:fmt},umNow:true});cdef.lk=lk;}return cdef;};mstrTableControl.prototype.getNewGroup=function(top,tHeight,cHeight,fmt){var gtk=this.genObjId(),rk=this.genObjId(),f=microstrategy.getFormatObject(),tw=parseFloat(this.queryState("Width")),tblLeft=parseFloat(f.encodeValue("left",mstrTableControl.DEFAULT_TABLE_MARGIN)),textPaddingV=parseInt(this.getDefaultTextPadding().v),gth=f.encodeValue("height",parseInt(f.getPxFromPt(fmt.g.t.fs))+2*textPaddingV),t=f.encodeValue("top",top+this.getTextTopInCellPx(fmt.g.t.fs,mstrTableControl.GROUP_TITLE_HEIGHT)),cth=f.encodeValue("height",cHeight),rt=f.encodeValue("top",top+tHeight);this.exec({id:"addText",v:{key:gtk,n:"title"+gtk,fmla:microstrategy.descriptors.getDescriptor(mstrTableControl.DEFAULT_GROUP_TITLE_TEXT),top:t,left:tblLeft,height:gth,width:tw},umNow:true});this.exec({id:"addRect",v:{key:rk,n:"rect"+rk,top:rt,left:tblLeft,height:cth},umNow:true});var cfg=[{key:gtk,ps:mstrTableControl.TEXT_PROPS,df:this.getDefaultFormat(106,"1"),applyFmt:fmt.g.t},{key:rk,ps:mstrTableControl.RECT_PROPS,df:this.getDefaultFormat(101,"1"),applyFmt:fmt.g.r}];this.applyDefaultFormats(cfg);return{tk:gtk,rk:rk,t:parseFloat(top)+"px",h:parseFloat(tHeight)+parseFloat(cHeight)+"px",cells:[this.getNewCell(top+tHeight,cHeight,fmt)]};};mstrTableControl.prototype.getDefaultIOSFormat=function(){return{g:{h:mstrTableControl.GROUP_TITLE_HEIGHT+"px",t:{ff:"Helvetica",fs:"12",fc:"#4C576B",fb:true,fi:false,fso:false,ful:false},r:{bgc:"#FFFFFF",bs:"solid",bc:"#969696",bw:"1"}},c:{h:mstrTableControl.CELL_HEIGHT+"px",t:{ff:"Helvetica",fs:"12",fc:"#000000",fb:true,fi:false,fso:false,ful:false},st:{ff:"Arial",fs:"10",fc:"#999999",fb:true,fi:false,fso:false,ful:false},v:{ff:"Helvetica",fs:"12",fc:"#385487",fb:false,fi:false,fso:false,ful:false}}};};mstrTableControl.prototype.getDefaultTextPadding=function(){var paddings=this.rwb.defaultFormats[106][1].FormattingPadding,f=microstrategy.getFormatObject(),h=parseFloat(paddings.LeftPadding.defaultValue)+parseFloat(paddings.RightPadding.defaultValue),v=parseFloat(paddings.TopPadding.defaultValue)+parseFloat(paddings.BottomPadding.defaultValue);return{h:f.getPxFromPt(h),v:f.getPxFromPt(v)};};mstrTableControl.prototype.getDefaultFormat=function(subType,fmtType){var tdf=this.rwb.defaultFormats[subType][fmtType],f=microstrategy.getFormatObject();switch(subType){case 106:var tdff=tdf&&tdf.FormattingFont;return tdff&&{ff:tdff.Name.defaultValue,fs:tdff.Size.defaultValue,fc:f.decodeValue("color",tdff.Color.defaultValue),fb:!!parseInt(tdff.Bold.defaultValue),fi:!!parseInt(tdff.Italic.defaultValue),fso:!!parseInt(tdff.Strikeout.defaultValue),ful:!!parseInt(tdff.Underline.defaultValue)};case 101:var tdfp=tdf&&tdf.FormattingPatterns,tdfl=tdf&&tdf.FormattingLine;return txtFont=tdfp&&tdfl&&{bgc:f.decodeValue("color",tdfp.FillColor.defaultValue),bs:f.decodeValue("lineStyle",tdfl.LineStyle.defaultValue),bc:f.decodeValue("color",tdfl.LineColor.defaultValue),bw:tdfl.LineWeight.defaultValue};case 105:var tdfl=tdf&&tdf.FormattingLine;return txtFont=tdfl&&{bs:f.decodeValue("lineStyle",tdfl.LineStyle.defaultValue),bc:f.decodeValue("color",tdfl.LineColor.defaultValue),bw:tdfl.LineWeight.defaultValue};}};mstrTableControl.prototype.initNewTable=function(ac,tp){var rwb=this.rwb,f=microstrategy.getFormatObject(),encfn=function(v){f.encodeValue("height",v);},isTrx=(tp==1),txtFont=this.getDefaultFormat(106,"1"),rk=this.genObjId(),gtk=this.genObjId(),cik=isTrx?null:this.genObjId(),ctk=this.genObjId(),cvk=this.genObjId(),smk=this.genObjId(),dck=this.genObjId(),$H=mstr.utils.Hash,mstr_desc=microstrategy.descriptors,valueText=mstr_desc.getDescriptor(mstrTableControl.DEFAULT_VALUE_TEXT),def={def:{gs:[{tk:gtk,rk:rk,t:"0px",h:mstrTableControl.GROUP_TITLE_HEIGHT+mstrTableControl.CELL_HEIGHT+"px",cells:[{tp:106,ick:cik,tk:ctk,vk:cvk,vph:valueText,t:mstrTableControl.GROUP_TITLE_HEIGHT+"px",h:mstrTableControl.CELL_HEIGHT+"px",sty:1,idx:"0"}]}],smk:smk,dck:dck},fmt:this.getDefaultIOSFormat()},rf=def.fmt.g.r,border=parseInt(f.getPxFromPt((rf.bs=="none")?0:rf.bw)),tablePadding=mstrTableControl.CELL_PADDING,textPaddingV=parseInt(this.getDefaultTextPadding().v),tableWidth=this.queryState("decWidth")-2*border,tableLeft=mstrTableControl.DEFAULT_TABLE_MARGIN,iconWidth=cik?mstrTableControl.DEFAULT_ICON_WIDTH:mstrTableControl.DEFAULT_CELL_PADDING,iconHeight=iconWidth,nodeWidth=(tableWidth-iconWidth*2)/2-tablePadding,cellHeight=mstrTableControl.CELL_HEIGHT-2*border,cellTop=mstrTableControl.GROUP_TITLE_HEIGHT,gTitleHeight=parseInt(f.getPxFromPt(def.fmt.g.t.fs))+2*textPaddingV,gTitleTop=this.getTextTopInCellPx(def.fmt.g.t.fs,mstrTableControl.GROUP_TITLE_HEIGHT),iconTop=Math.max(cellHeight-iconHeight,0)/2+cellTop,titleTop=this.getTextTopInCellPx(def.fmt.c.t.fs,cellHeight)+cellTop,titleHeight=parseInt(f.getPxFromPt(def.fmt.c.t.fs))+2*textPaddingV,valueHeight=parseInt(f.getPxFromPt(def.fmt.c.v.fs))+2*textPaddingV,valueTop=this.getTextTopInCellPx(def.fmt.c.v.fs,cellHeight)+cellTop,selTop=cellTop+cellHeight+2;ac=[];ac.push(this.exec({id:"addTextdec",v:{key:gtk,n:"title"+gtk,fmla:mstr_desc.getDescriptor(mstrTableControl.DEFAULT_GROUP_TITLE_TEXT),top:gTitleTop,left:tableLeft,height:gTitleHeight,width:tableWidth},umNow:true}));ac.push(this.exec({id:"addRectdec",v:{key:rk,n:"rect"+rk,top:cellTop,left:tableLeft,height:cellHeight},umNow:true}));if(cik){ac.push(this.exec({id:"addImgdec",v:{key:cik,n:"icon_"+cik,url:mstrTableControl.DEFAULT_ICON,top:iconTop,left:tableLeft+tablePadding,height:iconHeight,width:iconWidth},umNow:true}));}ac.push(this.exec({id:"addTextdec",v:{key:ctk,n:"title"+ctk,fmla:mstr_desc.getDescriptor(mstrTableControl.DEFAULT_TITLE_TEXT),top:titleTop,left:tableLeft+iconWidth,height:titleHeight,width:nodeWidth},umNow:true}));ac.push(this.exec({id:"addTextdec",v:{key:cvk,n:"value"+cvk,fmla:valueText,top:valueTop,left:tableLeft+iconWidth+nodeWidth,height:valueHeight,width:nodeWidth},umNow:true}));this.submitBtn=this.getDefaultSubmitBtnConfig();this.submitBtn.ctlKey=smk;this.cancelBtn=this.getDefaultCancelBtnConfig();this.cancelBtn.ctlKey=dck;var sg={smt:{key:smk,dpTxt:this.submitBtn.dpTxt},dsc:{key:dck,dpTxt:this.cancelBtn.dpTxt},marginLeft:mstrTableControl.DEFAULT_TABLE_MARGIN,buttonInterval:mstrTableControl.SELECTOR_BUTTON_INTERVAL},sw=(tableWidth-mstrTableControl.SELECTOR_BUTTON_INTERVAL)/2,sh=mstrTableControl.SELECTOR_BUTTON_HEIGHT,bi=mstrTableControl.SELECTOR_BUTTON_INTERVAL;ac.push(this.exec({id:"addSelector",v:{key:smk,n:"selector"+smk,top:selTop,left:sw+bi+tableLeft,height:sh,width:sw},umNow:true}));ac.push(this.exec({id:"addSelector",v:{key:dck,n:"selector"+dck,top:selTop,left:tableLeft,height:sh,width:sw},umNow:true}));ac.push(this.exec({id:"setSelectorAction",v:{key:dck,at:4},umNow:true}));ac.push(this.exec({id:"setSelectorDisplayText",v:{key:dck,txt:mstr_desc.getDescriptor("2827")},umNow:true}));ac.push(this.exec({id:"setSelectorDisplayText",v:{key:smk,txt:mstr_desc.getDescriptor("5369")},umNow:true}));this.model.set("fmt",def.fmt);this.model.set("tp",tp);this.model.set("sg",sg);this.model.set("def",def.def);var fmt=def.fmt,rps=mstrTableControl.RECT_PROPS,fps=mstrTableControl.TEXT_PROPS,cfg=[{key:rk,ps:rps,df:this.getDefaultFormat(101,"1"),applyFmt:fmt.g.r},{key:gtk,ps:fps,df:txtFont,applyFmt:fmt.g.t},{key:ctk,ps:fps,df:txtFont,applyFmt:fmt.c.t},{key:cvk,ps:fps,df:txtFont,applyFmt:fmt.c.v}];this.applyDefaultFormats(cfg);};mstrTableControl.prototype.applyDefaultFormats=function(config){for(var n in config){var cp=config[n],key=cp.key,ps=cp.ps,df=cp.df,applyFmt=cp.applyFmt;for(var p in ps){if(applyFmt[p]!=df[p]){this.exec({id:"set"+p,v:{key:key,value:applyFmt[p]}});}}}};mstrTableControl.prototype.cleanupTables=function(){var tbls=this.tables,sz=tbls.length,i=0;if(sz){for(;i<sz;i++){var t=tbls[i];if(t&&t.destroy){t.destroy();}}}this.tables=[];};mstrTableControl.prototype.onunload=function(){this.cleanupTables();};mstrTableControl.prototype.createToolbar=function(){mstrRWUnitBoneImpl.prototype.createToolbar.call(this);};mstrTableControl.prototype.registerPanel=function(){};mstrTableControl.prototype.updatePositionMap=function(){};mstrTableControl.prototype.hideGuidelines=function(){};mstrTableControl.prototype.synchronizeShadow=function(){};mstrTableControl.prototype.ondocobjectdrag=function(){};mstrTableControl.prototype.showPanel=function(){};mstrTableControl.prototype.resize=function(h,w){if(h){this.getCurrentPanel().elem.style.height=h+"px";}if(w){this.getCurrentPanel().elem.style.width=w+"px";}this.tables[0].resize(h,w&&(w-mstrTableControl.DEFAULT_TABLE_MARGIN*2+"px"));};mstrTableControl.prototype.getCurrentPanel=function(){var e=this.elem.lastChild.lastChild.firstChild;return{elem:e,id:e.id};};mstrTableControl.prototype.getFormat=function(format){var fmt=format,m=this.tables[0].model,u={"2":"g","3":"c"}[fmt.u],f={"1":"t","2":"st","3":"v","4":"r"}[fmt.f];return u&&f&&m.fmt[u][f]&&m.fmt[u][f][fmt.p];};mstrTableControl.prototype.setFormat=function(format){var fmt=format,m=this.tables[0].model,u={"2":"g","3":"c"}[fmt.u],f={"1":"t","2":"st","3":"v","4":"r"}[fmt.f];if(u&&f&&m.fmt[u][f]){m.fmt[u][f].set(fmt.p,fmt.v);}};mstrTableControl.prototype.getTransactionUnitKey=function(){var p=this.getCurrentPanel().elem;return{k:p.getAttribute("fgkey"),sk:p.id};};mstrTableControl.prototype.exec=function(cmd){var id=cmd.id,v=cmd.v,umNow=cmd.umNow,um=this.um,ac=[],bp=this.rwb.beanPath,f=microstrategy.getFormatObject(),fn=function(v){return f.encodeValue("height",v);};switch(cmd.id){case"postAddSelector":um.commands.exec("apply");break;case"transactionEdit":var p=this.getCurrentPanel().elem;this.rwb.doc.commands.exec(cmd.id);break;case"selectorEdit":var selector=microstrategy.bones[v.key+"_Ctl"];if(selector){this.rwb.doc.selections.add(selector.activeRWUnit);this.rwb.doc.selections.remove(this.elem);this.rwb.doc.commands.exec("edtProps");}break;case"edtLinks":toggleShowBean("webHyperLinkEditor",true,"activeObjKey="+v.key+"&renderPromptsOnly=false");break;case"setTableDef":microstrategy.formatType=1;this.rwb.doc.formatAttribute([this.elem],"TableControlDefinition",v.def,false,microstrategy.HTMLATTR_TABLE_CONTROL_DEFINITION,ac,true);if(umNow){um.add(ac);break;}else{return ac[0];}case"newGroup":return this.getNewGroup(parseFloat(v.top),parseFloat(v.th),parseFloat(v.ch),v.fmt);case"newCell":return this.getNewCell(parseFloat(v.top),parseFloat(v.ch),v.fmt,v.line);case"setProp":microstrategy.formatType=1;um.add([um.createEditPropsAction(null,v.key,bp,[v.prop],[v.value],null,null,null,true)]);if(v.value=="NaNpx"){microstrategy.errors.log({description:"an Error on object with key ["+v.key+"]: "+v.prop});}break;case"addLine":var k=v.key||this.genObjId(),l=f.encodeValue("left",v.left),t=f.encodeValue("top",v.top),w=v.width?v.width:this.getLineWidth(v.fmt,this.queryState("decWidth"));w=f.encodeValue("width",w);um.add([um.createActionObject(null,mstrUpdateManager.ADD_LINE,bp,["2048018","2048012","2048020","2048007","2048010","2048011","2048100","2048241","2048043","2048061"],[mstrUpdateManager.UPDATE_LATER,k,v.n||"line",this.currentPanelId,t,l,mstrTableControl.LINE_ZINDEX,"true",w,microstrategy.ORIENTATION_HORIZONTAL],[],null)]);var os=this.rwb.doc.styleObj,o=os.formattingAttributes[k];if(typeof (o)=="undefined"){os.formattingAttributes[k]={};o=os.formattingAttributes[k];}o.lt=l;o.tp=t;o[microstrategy.HTMLATTR_WIDTH]=w;var cfg=[{key:k,ps:mstrTableControl.LINE_PROPS,df:this.getDefaultFormat(105,"1"),applyFmt:v.fmt.g.r}];this.applyDefaultFormats(cfg);return{key:k};break;case"addRectdec":v.top=fn(v.top);v.left=fn(v.left);v.height=fn(v.height);case"addRect":var w=this.queryState("Width");um.add([um.createActionObject(null,mstrUpdateManager.ADD_SHAPE,bp,["2048018","2048012","2048020","2048007","2048010","2048011","2048100","2048241","2048042","2048043","2048067"],[mstrUpdateManager.UPDATE_LATER,v.key,v.n,this.currentPanelId,v.top,v.left,mstrTableControl.RECT_ZINDEX,"true",v.height,w,"2"],[],null)]);var os=this.rwb.doc.styleObj,o=os.formattingAttributes[v.key];if(typeof (o)=="undefined"){os.formattingAttributes[v.key]={};o=os.formattingAttributes[v.key];}o.lt=v.left;o.tp=v.top;o[microstrategy.HTMLATTR_HEIGHT]=v.height;o[microstrategy.HTMLATTR_WIDTH]=w;break;case"setText":um.add([um.createActionObject(null,mstrUpdateManager.EDIT_TEXT,bp,["2048012","2048008","2048018"],[v.key,v.fmla,mstrUpdateManager.UPDATE_LATER],[],null)]);break;case"setImg":um.add([um.createActionObject(null,mstrUpdateManager.EDIT_IMAGE,bp,["2048012","2048019","2048018"],[v.key,v.url,mstrUpdateManager.UPDATE_LATER],[],null)]);break;case"addIndicator":var ik=this.genObjId(),url=mstrTableControl.DEFAULT_INDICATOR,w=parseFloat(this.queryState("Width")),tblLeft=parseFloat(f.encodeValue("left",mstrTableControl.DEFAULT_TABLE_MARGIN)),sz=parseFloat(f.encodeValue("width",mstrTableControl.DEFAULT_INDICATOR_WIDTH)),diff=parseFloat(v.cellHeight)-parseFloat(mstrTableControl.DEFAULT_INDICATOR_WIDTH),t=f.encodeValue("top",parseFloat(v.top)+(diff?diff:0)/2);this.exec({id:"addImg",v:{key:ik,n:"indicator"+ik,url:url,top:t,left:w-sz*2+tblLeft,height:sz,width:sz},umNow:true});return{key:ik,url:url};break;case"addImgdec":v.width=fn(v.width);v.top=fn(v.top);v.left=fn(v.left);v.height=fn(v.height);case"addImg":um.add([um.createActionObject(null,mstrUpdateManager.ADD_IMAGE,bp,["2048018","2048012","2048020","2048007","2048019","2048010","2048011","2048100","2048241","2048042","2048043"],[mstrUpdateManager.UPDATE_LATER,v.key,v.n,this.currentPanelId,v.url,v.top,v.left,mstrTableControl.IMG_ZINDEX,"true",v.height,v.width],[],null)]);var os=this.rwb.doc.styleObj,o=os.formattingAttributes[v.key];if(typeof (o)=="undefined"){os.formattingAttributes[v.key]={};o=os.formattingAttributes[v.key];}o[microstrategy.HTMLATTR_IMAGE_SOURCE]=v.url;o.lt=v.left;o.tp=v.top;o[microstrategy.HTMLATTR_HEIGHT]=v.height;o[microstrategy.HTMLATTR_WIDTH]=v.width;break;case"addCellValue":var tk=this.genObjId(),t=parseFloat(f.encodeValue("top",v.top))+this.getTextTopInCell(v.fmt.fs,f.encodeValue("top",v.cellHeight));this.exec({id:"addText",v:{key:tk,n:"value"+tk,fmla:microstrategy.descriptors.getDescriptor(mstrTableControl.DEFAULT_VALUE_TEXT),top:t,left:f.encodeValue("left",v.left),height:f.encodeValue("top",v.height),width:f.encodeValue("top",v.width)},umNow:true});this.exec({id:"applyTextFormat",v:{key:tk,fmt:v.fmt},umNow:true});return{key:tk};case"addCellSubtitle":var stk=this.genObjId(),ts=this.getTitlesTopInCell(v.fmt.t.fs,v.fmt.st.fs,f.encodeValue("top",v.cellHeight)),cellTop=parseFloat(f.encodeValue("top",v.top)),t=cellTop+ts.st;this.exec({id:"addText",v:{key:stk,n:"subtitle"+stk,fmla:mstrTableControl.DEFAULT_SUBTITLE_TEXT,top:t,left:f.encodeValue("left",v.left),height:f.encodeValue("height",f.getPxFromPt(v.fmt.st.fs)),width:f.encodeValue("top",v.width)},umNow:true});this.exec({id:"applyTextFormat",v:{key:stk,fmt:v.fmt.st},umNow:true});return{key:stk,t:f.decodeValue("top",ts.t+cellTop),h:f.getPxFromPt(v.fmt.st.fs)+"px"};case"applyTextFormat":var cfg=[{key:v.key,ps:mstrTableControl.TEXT_PROPS,df:this.getDefaultFormat(106,"1"),applyFmt:v.fmt}];this.applyDefaultFormats(cfg);break;case"addTextdec":v.width=fn(v.width||parseFloat(this.queryState("decWidth"))/2+"");v.top=fn(v.top);v.left=fn(v.left);v.height=fn(v.height);case"addText":var w=v.width||parseFloat(this.queryState("Width"))/2+"";ac=[um.createActionObject(null,mstrUpdateManager.ADD_TEXT,bp,["2048018","2048012","2048020","2048007","2048008","2048010","2048011","2048100","2048241","2048042","2048043"],[mstrUpdateManager.UPDATE_LATER,v.key,v.n,this.currentPanelId,v.fmla,v.top,v.left,mstrTableControl.TEXT_ZINDEX,"true",v.height,w],[],null)];var os=this.rwb.doc.styleObj,o=os.formattingAttributes[v.key];if(typeof (o)=="undefined"){os.formattingAttributes[v.key]={};o=os.formattingAttributes[v.key];}o.frma=v.fmla;o.lt=v.left;o.tp=v.top;o[microstrategy.HTMLATTR_HEIGHT]=v.height;o[microstrategy.HTMLATTR_WIDTH]=w;ac.push(um.createEditPropsAction(null,v.key,bp,["heightMode"],["0"],["2"],false));o.hm="0";if(umNow){um.add(ac);break;}else{return ac;}case"addSelector":var key=v.key,l=f.encodeValue("left",v.left),t=f.encodeValue("top",v.top),h=f.encodeValue("height",v.height),w=f.encodeValue("width",v.width),zIndx=mstrTableControl.SELECTOR_ZINDEX;ac=[um.createActionObject(null,mstrUpdateManager.CTRL_ADD,bp,["2048010","2048011","2048100","2048043","2048042","2048007","2048012","2048113","2048129","2048114","2048115","2048116","2048119","2048120","2048121","2048125","2048020","2048139","2048241"],[t,l,zIndx,w,h,this.currentPanelId,key,"4","","","",this.id,"5","1","1","1","selector"+key,"0","true"],[],null)];ac.push(um.createEditPropsAction(null,key,bp,["textAlign"],["center"]));ac.push(um.createEditPropsAction(null,key,bp,["fontSize"],["11"],null));ac.push(um.createEditPropsAction(null,key,bp,["fontWeight"],["bold"],null));var os=this.rwb.doc.styleObj,o=os.formattingAttributes[key];if(typeof (o)=="undefined"){os.formattingAttributes[key]={};o=os.formattingAttributes[key];}o.lt=l;o.tp=t;o[microstrategy.HTMLATTR_HEIGHT]=h;o[microstrategy.HTMLATTR_WIDTH]=w;um.add(ac);return{key:key};case"setSelectorDisplayText":if(v.key===this.submitBtn.ctlKey){this.submitBtn.dpTxt=v.txt;this.model.selGroupModel&&this.model.selGroupModel.smt.set("dpTxt",v.txt);}else{if(v.key===this.cancelBtn.ctlKey){this.cancelBtn.dpTxt=v.txt;this.model.selGroupModel&&this.model.selGroupModel.dsc.set("dpTxt",v.txt);}}um.add([um.createActionObject(null,mstrUpdateManager.SET_CTL_DISPLAY_TEXT,bp,["2048018","2048130","2048234"],[mstrUpdateManager.UPDATE_LATER,v.key,v.txt],[],null)]);break;case"setSelectorAction":um.add([um.createActionObject(null,mstrUpdateManager.SET_CTL_ACTIONS,bp,["2048018","2048130","2048226"],[mstrUpdateManager.UPDATE_LATER,v.key,v.at],[],null)]);break;case"setSelectorDisplayConfirmation":if(v.key===this.submitBtn.ctlKey){this.submitBtn.dpCfm=v.value;}else{if(v.key===this.cancelBtn.ctlKey){this.cancelBtn.dpCfm=v.value;}}um.add([um.createEditPropsAction(null,v.key,bp,["DisplayConfirmation"],[v.value?v.value:0],null,false)]);break;case"remove":um.add([um.createActionObject(null,mstrUpdateManager.REMOVE_OBJECT,bp,["2048018","2048012"],[mstrUpdateManager.UPDATE_LATER,v.key],[],null)]);break;case"setff":this.exec({id:"setProp",v:{key:v.key,prop:"fontFamily",value:v.value}});break;case"setfs":this.exec({id:"setProp",v:{key:v.key,prop:"fontSize",value:v.value}});break;case"setfc":this.exec({id:"setProp",v:{key:v.key,prop:"color",value:v.value}});break;case"setfb":this.exec({id:"setProp",v:{key:v.key,prop:"fontWeight",value:v.value?"bold":""}});break;case"setfi":this.exec({id:"setProp",v:{key:v.key,prop:"fontStyle",value:v.value?"italic":""}});break;case"setfso":this.exec({id:"setProp",v:{key:v.key,prop:"textDecoration2",value:v.value?"line-through":""}});break;case"setful":this.exec({id:"setProp",v:{key:v.key,prop:"textDecoration",value:v.value?"underline":""}});break;case"setbgc":this.exec({id:"setProp",v:{key:v.key,prop:"backgroundColor",value:v.value}});break;case"setbc":this.exec({id:"setProp",v:{key:v.key,prop:"lineColor",value:v.value}});break;case"setbs":this.exec({id:"setProp",v:{key:v.key,prop:"lineStyle",value:v.value}});break;case"setbw":this.exec({id:"setProp",v:{key:v.key,prop:"lineWeight",value:v.value}});break;default:this.rwb.commands.exec(id);}};mstrTableControl.prototype.querySelectorState=function(p,btn){return this[btn]&&this[btn][p];};mstrTableControl.prototype.queryState=function(cmdId,v){var tbl=this.tables[0];fmt=tbl&&tbl.model&&tbl.model.fmt,cf=fmt&&fmt.c,gf=fmt&&fmt.g,fas=this.rwb.formattingAttributes,f=microstrategy.getFormatObject();fn=function(p){return f.decodeValue("height",fas[v][p]);},cmdInfo=cmdId.split("_");if(cmdInfo.length==3){var o=fmt[cmdInfo[0]][cmdInfo[1]];return o&&o[cmdInfo[2]];}switch(cmdId){case"defaultCellPadding":return mstrTableControl.DEFAULT_CELL_PADDING;case"removeBorders":var fmt=v.fmt,r=v.v;return parseFloat(r)-parseFloat(fmt.bs=="none"?0:f.getPxFromPt(fmt.bw))*2;case"selectorDom":var d=document.getElementById(v);if(d){var r=d.cloneNode(true);r.className="";r.removeAttribute(microstrategy.HTMLATTR_OBJTYPE);r.removeAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);r.removeAttribute(microstrategy.HTMLATTR_SCRIPTCLASS);return r;}return null;case"TRXObjs":return tbl.model.getTRXObjs();case"pxFromPt":return f.getPxFromPt(v);case"top":return fn("tp");case"left":return fn("lt");case"width":return fn(microstrategy.HTMLATTR_WIDTH);case"height":return fn(microstrategy.HTMLATTR_HEIGHT);case"text":return this.rwb.formattingAttributes[v].frma;case"img":return this.rwb.formattingAttributes[v][microstrategy.HTMLATTR_IMAGE_SOURCE];case"ctff":return cf.t.ff;case"ctfs":return cf.t.fs;case"ctfc":return cf.t.fc;case"tableId":return this.id;case"decWidth":var decWidth=parseInt(f.decodeValue("width",this.rwb.doc.commands.getCommonAttValue([this.elem],microstrategy.HTMLATTR_WIDTH,"width")));return this.rwb.doc.removePaddingAndBorder(this.elem,decWidth,"width")-2*parseInt(mstrTableControl.DEFAULT_TABLE_MARGIN);case"Width":return f.encodeValue("width",this.queryState("decWidth"));case"zIndex":return this.rwb.doc.styleObj.getValue(this.elem,"zIndex",microstrategy.FORMAT_TYPE_MAIN);case"newObjId":return this.genObjId();default:return this.rwb.commands.queryState(cmdId);}};mstrTableControl.prototype.closeContextMenu=function(evt){var cxm=this.tables&&this.tables[0]&&this.tables[0].contextMenu;if(cxm){cxm.closeMenuHandler(evt.e);}};function mstrTableControl(id){this.inherits=mstrRWUnitBoneImpl;this.inherits(id);delete this.inherits;return this;}