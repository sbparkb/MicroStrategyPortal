mstrDocImpl.prototype=new mstrStaticDoc();mstrDocImpl.prototype.currentControl="cursor";mstrDocImpl.prototype.currentControlSubtype=null;mstrDocImpl.prototype.textEditor=null;mstrDocImpl.prototype.controlSelectionMode=false;mstrDocImpl.prototype.controlSourceUnitID=null;mstrDocImpl.prototype.standAloneControlKey=null;mstrDocImpl.prototype.controlSourceUnitType="";mstrDocImpl.prototype.controlSource="";mstrDocImpl.prototype.resizedSubMaskOnDrag=null;mstrDocImpl.prototype.adjustImageSizeFlag=false;mstrDocImpl.prototype.docMask=null;mstrDocImpl.prototype.docMaskCollection=null;mstrDocImpl.prototype.prevSelectedId=null;mstrDocImpl.prototype.undoRedoSubSections=null;mstrDocImpl.prototype.heightAndWidthAttMap={heightMode:microstrategy.HTMLATTR_HEIGHT_MODE,widthMode:microstrategy.HTMLATTR_WIDTH_MODE,height:microstrategy.HTMLATTR_HEIGHT,width:microstrategy.HTMLATTR_WIDTH};mstrDocImpl.DELETE_MODE={DELETE:1,HIDE:2};mstrDocImpl.INSERT_MODE={ALL_VISIBLE:1,HIDE_OTHERS:2};mstrDocImpl.prototype.onselectionchange=function(subId){try{var prevId=this.prevSelectedId;var fn=function(id){if(!id){return ;}var el=document.getElementById(id);if(el&&microstrategy.objectType(el)==microstrategy.OBJTYPE_DOC_SUBSECTION){var b=microstrategy.findBone(el);if(b){b.toggleSelected();}}else{if(id==prevId&&el&&(el.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEXT||el.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER)){var te=document.getElementById("docEditTextArea");te&&te.onblur&&te.onblur();}}};fn(prevId);fn(subId);this.prevSelectedId=subId;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.onnotifydrag=function(items,bone,types){try{if(this.parentBone.isEditableViewModeEplus()){if(bone.id==this.id){this.dockMask=this.getMask();this.dockMask.style.display="block";this.dockMask.style.zIndex="101";var src=microstrategy.eventManager.source;this.mouseoffsetLeft=(src.mousedownX-getObjSumLeft(this.elem)+this.parentBone.elem.scrollLeft)-this.selections.range.left;this.mouseoffsetTop=(src.mousedownY-getObjSumTop(this.elem)+this.parentBone.elem.scrollTop)-this.selections.range.top;this.dockMask.style.width=(getClientWidth()-getObjSumLeftScrolled(this.elem))+"px";var mask=this.findFirstVerticalNonCollapsedSubMask();if(mask){var fn=function(obj,h,o){obj.setAttribute(microstrategy.HTMLATTR_HEIGHT,h);obj.style.height=h+o+"px";};var id=mask.getAttribute("id");if(id&&id.indexOf("table")!=-1){if(mask.rows&&mask.rows[0]){var row=mask.rows[0];for(var i=0;i<row.cells.length;i++){var obj=row.cells[i].firstChild;fn(obj,getObjHeight(obj),Math.max(this.mouseoffsetTop,0));}}}else{fn(mask,getObjHeight(mask),this.mouseoffsetTop);}}this.resizedSubMaskOnDrag=mask;microstrategy.eventManager.notifyOrphanBones("ondocobjectdrag",items,this.mouseoffsetLeft,this.mouseoffsetTop);var submask=document.getElementById("maskDiv");if(submask){submask.style.display="block";}}else{if(bone.type==microstrategy.OBJTYPE_OBJBROWSER&&bIsIE6){var typeString=","+types.toString()+",";if(typeString.indexOf(","+microstrategy.DSSTYPE_RPT_DEFINITION+",")>-1){for(var id in this.sections){if(this.sections[id].isDetails){this.sections[id].setCursor("not-allowed");}}}}}this.selections.onnotifydrag(items,bone,types);}}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.ondocumentclick=function(e){try{if(
/*bIsIE6 && */
this.textEditor!=null&&this.textEditor.onblur!=null){var src=getEventTarget(e);if(src.getAttribute("id")!="docEditTextArea"){this.textEditor.blur(e);}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.onnotifydragend=function(bone){try{if(bone!=null&&bone.id==this.id&&this.parentBone.isEditableViewModeEplus()){this.docMask=this.getMask();var obj=this.resizedSubMaskOnDrag;if(obj){var id=obj.getAttribute("id");var h=obj.getAttribute(microstrategy.HTMLATTR_HEIGHT)+"px";if(id&&id.indexOf("table")!=-1){obj=obj.rows[0];if(obj&&obj.cells){for(var i=0;i<obj.cells.length;i++){var c=obj.cells[i].firstChild;c.style.height=c.getAttribute(microstrategy.HTMLATTR_HEIGHT)+"px";}}}else{obj.style.height=h;}}this.docMask.style.zIndex="-1";this.docMask.style.display="none";var submask=document.getElementById("maskDiv");if(submask){submask.style.display="none";}}else{for(var id in this.sections){if(this.sections[id].isDetails){this.sections[id].setCursor("");}}}this.resizedSubMaskOnDrag=null;this.selections.onnotifydragend(bone);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.onpanelchange=function(){try{if(this.selections){this.selections.onpanelchange();}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.findFirstVerticalNonCollapsedSubMask=function(){try{var mask=null;for(var i=0;i<this.dockMask.childNodes.length;i++){var mask=this.docMask.childNodes[i];var id=mask.getAttribute("id");if(id&&id.indexOf("table")>-1){return mask;}if(id&&id!="maskDiv"&&mask.getAttribute("isCollapsed")!="true"){return mask;}}}catch(err){microstrategy.errors.log(err);}return null;};mstrDocImpl.prototype.addPanelMask=function(panelBone){try{if(this.docMaskCollection==null){return ;}var secId=microstrategy.findAncestorWithAtt(panelBone.elem,microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_SECTION).getAttribute("id");for(var i=0;i<panelBone.sibs.length;i++){this.addMask(secId,i,panelBone.sibs[i],0);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.onPanelDeleted=function(id){try{if(this.docMaskCollection==null){return ;}var masks=document.getElementsByName(id+"_mask");for(var i=0;i<masks.length;i++){masks[i].parentNode.removeChild(masks[i]);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.resizeSubMask=function(secId,subId,delta,prop){try{if(this.docMaskCollection==null){return ;}var z=this.docMaskCollection[secId][subId];for(var i=0;i<z.length;i++){z[i].onmaskedobjectresize(delta,prop);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.hideSubMask=function(secId,subId,hide){try{if(this.docMaskCollection==null){return ;}var z=this.docMaskCollection[secId][subId];for(var i=0;i<z.length;i++){z[i].toggleMaskHilite(hide);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.resizeSubMaskForSib=function(secId,subId,newValue,sibIndex,prop){try{if(this.docMaskCollection==null){return ;}this.docMaskCollection[secId][subId][sibIndex].onmaskedobjectresizeForSib(newValue,sibIndex,prop);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.hideSubMaskForSib=function(secId,subId,hide,sibIndex){try{if(this.docMaskCollection==null){return ;}this.docMaskCollection[secId][subId][sibIndex].toggleMaskHiliteForSib(hide,sibIndex);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.resizeSubMaskForHorizontalContainer=function(hContID,delta,prop){try{if(this.docMaskHorizontalCollection==null){return ;}var z=this.docMaskHorizontalCollection[hContID];for(var i=0;i<z.length;i++){z[i].onmaskedobjectresize(delta,prop);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.hideSubMaskForHorizontalContainer=function(hContID,hide){try{if(this.docMaskHorizontalCollection==null){return ;}var z=this.docMaskHorizontalCollection[hContID];for(var i=0;i<z.length;i++){z[i].toggleMaskHilite(hide);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getSubMask=function(secId,subId,src){try{if(this.docMaskCollection!=null){var z=this.docMaskCollection[secId][subId];for(var i=0;i<z.length;i++){if(z[i].img==src||z[i].imgMap==src.parentNode){return z[i];}}}}catch(err){microstrategy.errors.log(err);}return null;};mstrDocImpl.prototype.getSubMaskBone=function(secId,subId,index){try{if(this.docMaskCollection!=null){return this.docMaskCollection[secId][subId][index];}}catch(err){microstrategy.errors.log(err);}return null;};mstrDocImpl.prototype.resetMask=function(){try{if(this.docMask){this.docMask.innerHTML="";}this.docMask=null;this.docMaskCollection=null;this.docMaskHorizontalCollection=null;this.docMask=this.getMask();this.docMask.style.display="none";}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getMask=function(){try{if(!this.docMask){this.docMask=document.getElementById("docMask");this.docMask.style.position="absolute";this.docMaskCollection={};this.docMaskHorizontalCollection={};var secCollection=microstrategy.objectListFind(this.elem,"div",microstrategy.OBJTYPE_DOC_SECTION);if(secCollection&&this.docMask.childNodes.length<1){var secTitleHeight;if(secCollection[0]){secTitleHeight=getObjHeight(microstrategy.subObjectFind(secCollection[0],"div",microstrategy.SUBOBJTYPE_TITLEBAR));}for(var i=0;i<secCollection.length;i++){var secId=secCollection[i].getAttribute("id");if(!this.docMaskCollection[secId]){this.docMaskCollection[secId]={};}var subCollection=microstrategy.objectListFind(secCollection[i],"div",microstrategy.OBJTYPE_DOC_SUBSECTION);for(var j=0;j<subCollection.length;j++){this.addMask(secId,j,subCollection[j],secTitleHeight);}}}with(this.docMask.style){position="absolute";left=getObjLeft(this.elem)+"px";top=getObjTop(this.elem)+"px";}}return this.docMask;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocImpl.prototype.addMask=function(secId,index,elem,titleHeight){try{var ssb=microstrategy.findBone(elem);var subId=ssb.id;var horizFound=false;var hdl=0,cntHdleHeight=0,hSecTleWidth=0,hSubHleWidth=0;var fn=function(el,d,ty){var o=microstrategy.subObjectFind(el,"div",microstrategy["SUBOBJTYPE_"+ty]);return(o&&window["getObj"+d](o))||0;};if(!this.docMaskCollection[secId][subId]){this.docMaskCollection[secId][subId]=[];hdl=fn(ssb.parentBone.elem,"Height","SUBSECTION_HANDLE");}var mask;if(ssb.isFilterPanel){mask=new mstrFilterPanelMaskImpl(secId,subId,index);}else{mask=new mstrSubSectionMaskImpl(secId,subId,index);}mask.parentBone=this;mask.path=this.path+".getSubMask('"+secId+"', '"+subId+"', this)";this.docMaskCollection[secId][subId].push(mask);var hcDiv,hCont,hContId;if(ssb.isHorizontal){hcDiv=microstrategy.findAncestorWithAtt(elem,microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_HORIZONTAL_CONTAINER);hCont=microstrategy.findBone(hcDiv);mask.horizontalBone=hCont;mask.sibIndex=index;hContId=hCont.id;var hMaskCol=this.docMaskHorizontalCollection[hContId]||[];hMaskCol.push(mask);this.docMaskHorizontalCollection[hContId]=hMaskCol;if(!horizFound){cntHdleHeight=fn(hcDiv.parentNode,"Height","SUBSECTION_HANDLE");hSecTleWidth=fn(ssb.parentBone.elem,"Width","TITLEBAR");hSubHleWidth=fn(ssb.parentBone.elem,"Width","SUBSECTION_HANDLE");horizFound=true;}}ssb.maskArea=elem;mask.onload(ssb);var fnOffset=function(offset){mask.elem.style.height=parseInt(mask.elem.style.height)+offset+"px";mask.topOffset=offset;};if(index>0||ssb.isHorizontal){fnOffset((ssb.isHorizontal)?cntHdleHeight:hdl);}if(index==0&&!ssb.isHorizontal){fnOffset(titleHeight);}if(ssb.isHorizontal){var tr,td;if(ssb.isBeginHorizontalSib(index)&&!microstrategy.findChildWithAtt(this.docMask,"table","id","table_"+hContId)){var gt=document.createElement("table");gt.setAttribute("id","table_"+hContId);gt.setAttribute("height",hCont.height+"px");gt.style.tableLayout="auto";gt.cellSpacing=0;gt.cellPadding=0;tr=gt.insertRow(gt.rows.length);td=tr.insertCell(tr.cells.length);tr.setAttribute("id","tr_"+hContId);td.appendChild(mask.elem);this.docMask.appendChild(gt);}else{tr=document.getElementById("tr_"+hContId);td=tr.insertCell(tr.cells.length);td.appendChild(mask.elem);}if(ssb.isEndHorizontalSib(index)){td.style.width="100%";}mask.leftOffset=(index==0)?hSecTleWidth:hSubHleWidth;if(!ssb.isEndHorizontalSib(index)){var w=parseInt(mask.elem.style.width),lo=mask.leftOffset;mask.elem.style.width=(isNaN(w)?lo:(w+lo))+"px";}}else{this.docMask.appendChild(mask.elem);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getMaskFromPoint=function(x,y){try{if(this.docMask){var pointRect={left:x,top:y,right:x+1,bottom:y+1};for(var i=0,cnt=this.docMask.childNodes.length;i<cnt;i++){var mask=this.docMask.childNodes[i];if(mask.nodeType==1&&mask.getAttribute("id")!="maskDiv"){var maskRect=microstrategy.getRect(mask);if(microstrategy.doRectsIntersect(pointRect,maskRect)){return mask;}}}}}catch(err){microstrategy.errors.log(err);}return null;};mstrDocImpl.prototype.appendToTextField=function(appendString,textField,ac){try{if(!textField){return ;}var passOut=!!ac;ac=ac||[];var id=textField.getAttribute("id");var fields=document.getElementsByName(id);if(fields.length>0){var oldValue=decode(this.styleObj.getAttValue(fields[0],microstrategy.HTMLATTR_DSS_FORMULA));if(oldValue.length>0){appendString=oldValue+" "+appendString;}var textValues=this.getTextFieldValues(textField,appendString);if(textValues.hasChanged){for(var i=0;i<fields.length;i++){this.updateSingleTextField(fields[i],textValues.displayValue);}this.styleObj.setAttValue(fields[0],microstrategy.HTMLATTR_DSS_FORMULA,textValues.attributeValue);var um=this.parentBone.updateManager;ac.push(um.createActionObject(textField,mstrUpdateManager.EDIT_TEXT,this.parentBone.beanPath,["2048012","2048008","2048018"],[id,textValues.saveValue,mstrUpdateManager.UPDATE_LATER],[id,textValues.oldValue,mstrUpdateManager.UPDATE_LATER]));}if(!passOut&&ac.length>0){um.add(ac);}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getAutoTextMacroCode=function(macroId){try{return{pgNum:"{&PAGE}",totPages:"{&NPAGES}",dateTime:"{&DATETIME}",curUsr:"{&USER}",docName:"{&DOCUMENT}",docDesc:"{&DESCRIPTION}",prjName:"{&PROJECT}",docExecTime:"{&EXECUTIONTIME}",filterDet:"{&FILTERDETAILS}",promptDet:"{&PROMPTDETAILS}",reportDet:"{&REPORTDETAILS}",notes:"{&NOTES}"}[macroId]||"{&}";}catch(err){microstrategy.errors.log(err);}return"";};mstrDocImpl.prototype.commonRedoUndoCode=function(action,mode){try{var f=mstrFormatObject;var so=this.styleObj;var ca=action.cachedArray;var args=action.args;var el=action.elem;var id=(el&&el.getAttribute("id"))||args[0];var aa=(el&&{0:el})||null;var i,cnt,objs,mth;switch(action.id){case mstrUpdateManager.EDIT_TEXT:objs=document.getElementsByName(id);if(objs.length>0){var tv=this.getTextFieldValues(objs[0],args[1]);so.setAttValue(objs[0],microstrategy.HTMLATTR_DSS_FORMULA,tv.attributeValue);for(i=0,cnt=objs.length;i<cnt;i++){this.updateSingleTextField(objs[i],tv.displayValue);}}break;case mstrUpdateManager.MOVE_OBJECT:objs=[];var x=(ca.acrossSections==true);if(x){this.deleteItems({0:document.getElementById(id)},false);objs=[el];}else{objs=document.getElementsByName(id);}for(i=0,cnt=objs.length;i<cnt;i++){var textDirection=so.getValue(objs[i],"TextDirection")||"0",left=f.decodeValue("left",args[4]),top=f.decodeValue("top",args[3]);if(textDirection==="0"){objs[i].style.left=left;objs[i].style.top=top;}else{so.changeVerticalTextPosition(objs[i],{x:parseInt(top),y:parseInt(left)});}}if(x){var sec=(mode=="redo")?ca.newSection:ca.orginalSection;this.addItemsToSubsection(sec,el,false);}break;case mstrUpdateManager.EDIT_PROPS:if(action.formatType!=null){microstrategy.formatType=action.formatType;}if(args[args.length-1]){microstrategy.formatType=args[args.length-1];}if(!args[1]){break;}var a=action.args[1].split(mstrUpdateManager.UNIT_SEPARATOR);id=a[0];var fnStripSep=function(s){if(s.charAt(s.length-1)==mstrUpdateManager.ITEM_SEPARATOR){s=s.substr(0,s.length-1);}return s;};var that=this;var fnSetAtt=function(att){that.formatAttribute(aa,p,v,false,att);};var gv;if(args[1].indexOf("GradientColor")>0){var gs=args[1].split(mstrUpdateManager.ITEM_SEPARATOR);var fnGrad=function(idx){return gs[idx].split(mstrUpdateManager.UNIT_SEPARATOR)[3];};gv=f.decodeValue("backgroundColor",fnGrad(0)).slice(1)+","+f.decodeValue("backgroundColor",fnGrad(1)).slice(1)+",14,"+fnGrad(3)+","+fnGrad(4)+","+fnGrad(5);}else{if(a[1]=="Gradient"){gv=a[2];}}if(gv){this.formatItems(aa,"Gradient",fnStripSep(gv),false);break;}var ps=a[1];var p=f[ps][a[2]][mstrFormatObject.HTML_PROP_NAME];var v=f.decodeValue(p,fnStripSep(a[3]));if(ps=="FormattingBorder"){var s,w,c;if(p.indexOf("b3d")>-1){s=(p=="b3dstyle")?v:so.getAttValue(el,microstrategy.HTMLATTR_BORDER_3D_STYLE);w=parseInt((p=="b3dweight")?v:so.getAttValue(el,microstrategy.HTMLATTR_BORDER_3D_WEIGHT),10);if(parseInt(s,10)==0){this.turnOffItem3D(el);}else{this.format3DItems(aa,s,w);}}else{if(p.indexOf("Color2")>-1){s=so.getAttValue(el,microstrategy.HTMLATTR_BORDER_3D_STYLE);if(parseInt(s,10)>0){this.process3DItemColorSettings(el,[p.slice(0,p.length-6)],[v],so.getAttValue(el,microstrategy.HTMLATTR_BORDER_3D_WEIGHT));}}else{s=w=c="";if(p.indexOf("Color")>-1){c=v;}else{var comp=v.split(" ");w=comp[0];s=comp[1];}this.formatItemBorders(aa,[p.slice(0,p.length-5)],s,w,c,false);}}}else{if(ps=="FormattingHTML"&&p=="htmlType"){this.formatHTMLType(aa,v);}else{if(ps=="FormattingHTML"&&(p=="htmlText"||p=="url")){objs=document.getElementsByName(id);if(objs.length){var tv=this.getHTMLFieldValues(objs[0],v);so.setAttValue(objs[0],microstrategy["HTMLATTR_HTML_"+((p=="htmlText")?"TEXT":"SOURCE")],tv.attributeValue);var ty=microstrategy["HTML_CONTAINER_TYPE_"+((p=="htmlText")?"HTML":"IFRAME")];for(i=0,cnt=objs.length;i<cnt;i++){if(so.getAttValue(objs[i],microstrategy.HTMLATTR_HTML_TYPE)==ty){microstrategy.findRWObjectBone(objs[i],"mstrHTMLContainerImpl").updateContents(ty,tv);}}}}else{if(ps=="FormattingView"&&p=="windowState"){var mth="restore";if(v==microstrategy.WINDOW_STATE_MINIMIZED){mth="minimize";}else{if(v==microstrategy.WINDOW_STATE_MAXIMIXED){mth="maximize";}}this[mth+"Portal"](aa,p,v,false);}else{if(ps=="FormattingAppearance"&&p=="title"){this.formatTitle(aa,p,v);}else{if(ps=="FormattingAppearance"&&p=="name"){fnSetAtt(microstrategy.HTMLATTR_NAME);}else{if(ps=="FormattingNavigation"&&p=="isLink"){this.formatIsLink(aa,(v==microstrategy.TRUE));}else{if(ps=="FormattingNavigation"&&p=="link"){fnSetAtt(microstrategy.HTMLATTR_LINK_HREF);}else{if(ps=="FormattingSection"&&p=="keepSectionTogether"){fnSetAtt(microstrategy.HTMLATTR_KEEP_SECTION_TOGETHER);}else{if(ps=="FormattingSection"&&p=="repeatSection"){fnSetAtt(microstrategy.HTMLATTR_REPEAT_SECTION);}else{if(ps=="FormattingSection"&&p=="repeatHorizontally"){fnSetAtt(microstrategy.HTMLATTR_REPEAT_HORIZONTALLY);}else{if(ps=="FormattingSection"&&p=="forceNewPage"){fnSetAtt(microstrategy.HTMLATTR_FORCE_NEW_PAGE);}else{if(ps=="FormattingSection"&&p=="expanded"){this.sections[i].toggleSections(v);}else{if(ps=="FormattingFont"&&p.indexOf("textDecoration")>-1){var idx=(a[2]=="Underline")?4:8;if(parseInt(a[3],10)>=0){idx=idx*-1;}this.formatUnderlineStrikeout(aa,"textDecoration",String(idx));}else{if(ps=="FormattingLine"&&p=="orientation"){this.changeLineOrientation(aa,f.encodeValue(p,v));}else{if(ps=="FormattingLine"&&(p=="lineColor"||p=="lineStyle"||p=="lineWeight")){var d3=so.getAttValue(el,microstrategy.HTMLATTR_BORDER_3D_STYLE);if(mode=="redo"||!d3||d3==0){this.formatLineSetting(aa,p,v,false,[]);}else{so.setAttValue(el,f.getAttrNameFromStyle(p),f.encodeValue(p,v));}}else{if(mode=="redo"&&ps=="FormattingSize"&&(p=="oldHeight"||p=="oldWidth")){fnSetAtt(microstrategy["HTMLATTR_OLD_"+p.substr(3).toUpperCase()]);}else{if((ps=="FormattingSize"&&p=="maxHeight"||p=="canShrink"||p=="canGrow")||(ps=="FomattingSection"&&p=="hideIfEmpty")){}else{if(ps=="FormattingSize"&&(p=="height"||p=="heightMode"||p=="width"||p=="widthMode")){var sfx;if(ca&&mode=="redo"){v=ca.origValue;}if(ca&&(ca.subsectionHeight||ca.subsectionWidth)){var tmp=(mode=="redo")?ca.origValue:ca.cachedOldValue;sfx=(ca.subsectionWidth)?"Horizontal":"";this.formatSubHeightWidth(aa,p,[tmp[0],tmp[1],f.decodeValue("canGrow"+sfx,tmp[2]),f.decodeValue("canShrink"+sfx,tmp[3]),f.decodeValue("hideIfEmpty",tmp[4])]);}else{sfx=(p.indexOf("Mode")>-1)?"Mode":"";if(ca&&ca.subType==microstrategy.SUBOBJTYPE_DOC_LINE){this.formatLineLength(aa,"length"+sfx,v,null,ca.performFormatChange);}else{this["formatSize"+sfx](aa,p,v,null,ca&&ca.performFormatChange,(sfx)?ca.updateLayoutWidth:null);}}}else{this.formatItems(aa,p,v,false);}}}}}}}}}}}}}}}}}}}microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;break;}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.onredo=function(action){var oldFormatType=microstrategy.formatType;try{var aa={0:action.elem};var ca=action.cachedArray;this.undoRedoSubSections=[];switch(action.id){case mstrUpdateManager.ADD_PANEL_STACK:case mstrUpdateManager.ADD_TEXT:case mstrUpdateManager.ADD_DATASET_TEMPLATE:case mstrUpdateManager.ADD_TEMPLATE:case mstrUpdateManager.ADD_LINE:case mstrUpdateManager.ADD_SHAPE:case mstrUpdateManager.ADD_IMAGE:case mstrUpdateManager.COPY_OBJECT:case mstrUpdateManager.CTRL_ADD:this.addItemsToSubsection(ca.parent,action.elem,false);break;case mstrUpdateManager.PASTE_FROM_CLIPBOARD:for(var i=0;i<ca.elements.length;i++){this.addItemsToSubsection(ca.parents[i],ca.elements[i],false);}break;case mstrUpdateManager.APPLY_CONTROL_DEFAULT:this.parentBone.objProps.applyCtrlDft(ca.orgObjs,false);break;case mstrUpdateManager.EDIT_TEXT:case mstrUpdateManager.MOVE_OBJECT:case mstrUpdateManager.EDIT_PROPS:this.commonRedoUndoCode(action,"redo");break;case mstrUpdateManager.REMOVE_OBJECT:this.deleteItems(aa,false,ca.parent);break;}this.selections.syncUp();this.selections.resetRange(false,null);if(this.parentBone.observer){this.parentBone.observer.notifyAll("onselectionchange");}if(this.undoRedoSubSections.length>0){for(var id in this.undoRedoSubSections){var b=this.undoRedoSubSections[id].bone;var t=this.undoRedoSubSections[id].isTarget;b.wireTargets([],this.parentBone.beanPath,t);}}this.undoRedoSubSections=null;return true;}catch(err){microstrategy.errors.log(err);return false;}finally{microstrategy.formatType=oldFormatType;}};mstrDocImpl.prototype.onundo=function(action){var oldFormatType=microstrategy.formatType;try{var aa={1:action.elem};var ca=action.cachedArray;this.undoRedoSubSections=[];switch(action.id){case mstrUpdateManager.ADD_PANEL_STACK:case mstrUpdateManager.ADD_TEXT:case mstrUpdateManager.ADD_DATASET_TEMPLATE:case mstrUpdateManager.ADD_TEMPLATE:case mstrUpdateManager.ADD_IMAGE:case mstrUpdateManager.ADD_LINE:case mstrUpdateManager.ADD_SHAPE:case mstrUpdateManager.COPY_OBJECT:case mstrUpdateManager.CTRL_ADD:this.deleteItems(aa,false,ca.parent);break;case mstrUpdateManager.PASTE_FROM_CLIPBOARD:for(var i=0;i<ca.elements.length;i++){this.deleteItems({i:ca.elements[i]},false,ca.parents[i],true);}break;case mstrUpdateManager.APPLY_CONTROL_DEFAULT:var orgObjs=ca.orgObjs;if(orgObjs){for(var i in orgObjs){var objs=document.getElementsByName(orgObjs[i].getAttribute("id"));for(var j=0;j<objs.length;j++){objs[j].style.cssText=microstrategy.styleObj.getCssText(orgObjs[i]);}}}break;case mstrUpdateManager.EDIT_TEXT:case mstrUpdateManager.MOVE_OBJECT:case mstrUpdateManager.EDIT_PROPS:this.commonRedoUndoCode(action,"undo");break;case mstrUpdateManager.REMOVE_OBJECT:this.restoreDeletedItems(ca.parent,ca.srcObjects);break;}this.selections.syncUp();this.selections.resetRange(false,null);if(this.parentBone.observer){this.parentBone.observer.notifyAll("onselectionchange");}if(this.undoRedoSubSections.length>0){for(var id in this.undoRedoSubSections){var b=this.undoRedoSubSections[id].bone;var t=this.undoRedoSubSections[id].isTarget;b.wireTargets([],this.parentBone.beanPath,t);}}this.undoRedoSubSections=null;return true;}catch(err){microstrategy.errors.log(err);return false;}finally{microstrategy.formatType=oldFormatType;}};mstrDocImpl.prototype.onwinresize=function(t,l){try{this.syncPosition(t,l);if(this.selections){this.selections.syncUp();}window.setTimeout(function(){iframe.hideWaitPage(true);},mstr.utils.ISIE8?100:0);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.isValidSelectorTarget=function(item){return(item!=null&&item.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT&&(microstrategy.subObjectType(item)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE||microstrategy.subObjectType(item)==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK||microstrategy.subObjectType(item)==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL)&&this.standAloneControlKey!=item.id)||this.commands.queryState("isDDIC");};mstrDocImpl.prototype.disableAutowire=function(){this.parentBone.commands.exec("disableAutowire");this.submitControlTargetSelections();};mstrDocImpl.prototype.submitControlTargetSelections=function(){try{if(this.parentBone.autoWire){showMessage({contents:microstrategy.descriptors.getDescriptor("6154"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,zIndex:1001,okEval:"microstrategy.getViewerBone().doc.disableAutowire()",cancelEval:"microstrategy.getViewerBone().doc.selections.clear()",type:mstrMsgBoxImpl.MSG_WARNING});return ;}var um=this.parentBone.updateManager;var targetKeys="";var selectedItems=this.selections.getItems();var firstAdd=true;var firstPanel=null;for(var i=0;i<selectedItems.length;i++){if(this.isValidSelectorTarget(selectedItems[i])){var itemKey=selectedItems[i].getAttribute("id");if(firstPanel==null){if(microstrategy.subObjectType(selectedItems[i])==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){firstPanel=itemKey;}}if(firstAdd==false){targetKeys+=CLIPBOARD_ITEM_SEPARATOR;}else{firstAdd=false;}if(this.commands.queryState("isDDIC")){var ctlKey=selectedItems[i].getAttribute("trxctlkey");targetKeys+=ctlKey;}else{targetKeys+=itemKey;}}}this.selections.clear();var cb;if(this.standAloneControlKey){cb=microstrategy.bone(this.standAloneControlKey+"_Ctl");if(cb){if(cb.ctlType==mstrRWControlImpl.CTL_TYPE_PANEL_STACK){targetKeys=firstPanel||"";}cb.targetKeys=targetKeys?targetKeys.split(CLIPBOARD_ITEM_SEPARATOR):[];}um.add([um.createActionObject(null,mstrUpdateManager.CTRL_SET_TARGETS,this.parentBone.beanPath,["2048130","2048129","2048116"],[this.standAloneControlKey,"",targetKeys],[])]);if(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&cb.isDefinitionComplete()){um.flushAndSubmitChanges();}}else{cb=microstrategy.bone("grid_"+this.controlSource);if(cb){if(cb.controlLinks==null){cb.controlLinks={};}var unitKey=this.controlSourceUnitID;if(this.controlSourceUnitID==null||this.controlSourceUnitID==""){unitKey="Metrics";}if(cb.controlLinks[unitKey]==null){cb.controlLinks[unitKey]={};}cb.controlLinks[unitKey].targets=targetKeys?targetKeys.split(CLIPBOARD_ITEM_SEPARATOR):[];}um.add([um.createActionObject(null,mstrUpdateManager.ADD_CONTROL_TO_GRID,this.parentBone.beanPath,["2048007","2048012","2048001","2048009","2048129","2048116"],[this.controlSource,"",this.controlSourceUnitID,this.controlSourceUnitType,"",targetKeys],[])]);if(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE){um.flushAndSubmitChanges();}}this.endControlSelectionMode();}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.onkeydown=function(e){try{var dv=this.parentBone;if(!e){e=window.event;}if(this.shouldIgnoreKeyEvent(e)){return true;}if(!mstrStaticDoc.prototype.onkeydown.call(this,e)){return false;}this.isNotConstrained=(e.ctrlKey)?!microstrategy.SNAP_OFF:microstrategy.SNAP_OFF;if(!this.parentBone.isEditableViewModeEplus()){return true;}switch(e.keyCode){case 89:if(e.ctrlKey){this.parentBone.updateManager.redo();return false;}break;case 90:if(e.ctrlKey){this.parentBone.updateManager.undo();return false;}break;case 120:this.parentBone.commands.exec("grid");if(this.parentBone.observer){this.parentBone.observer.notifyAll("onstatechange");}return false;}if(!this.selections){return true;}switch(e.keyCode){case 65:e.cancelBubble=true;if(e.ctrlKey){return this.selections.selectAll(e);}break;case 86:e.cancelBubble=true;if(e.ctrlKey){if(dv.IsNavigationDocument){return true;}return this.selections.paste();}break;}if(!this.selections.isActive()||!this.selections.isVisible){return true;}switch(e.keyCode){case 37:case 38:case 39:case 40:if(this.selections.firstItem().getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_SUBSECTION){return false;}var cancelEvent=true;var db=0,dr=0;var style="";if(e.keyCode%2>0){style="e";dr=(e.keyCode==37)?-1:1;}else{style="s";db=(e.keyCode==38)?-1:1;}cancelEvent=(e.shiftKey)?this.selections.resize.resizeItems(style,0,0,dr,db,false,this.isNotConstrained):this.selections.nudge(e.keyCode,this.isNotConstrained);if(bIsIE4){e.cancelBubble=!cancelEvent;}if(bIsFirefox&&cancelEvent&&e.shiftKey){mstr.utils.Dom.clearBrowserHighlights();}return cancelEvent;case 46:if(dv.IsNavigationDocument){var bone=microstrategy.findBone(mstr.$H.firstItem(this.selections.items));if(bone&&bone.isNavigationBar){return true;}}this.promptDeleteItems(this.selections.items,true);return false;case 66:case 73:case 85:if(e.ctrlKey){e.cancelBubble=true;var propValue=1;if(e.keyCode==73){propValue=2;}else{if(e.keyCode==85){propValue=4;}}var currentState=this.commands.queryState("fstyle");if(propValue&currentState){propValue=-propValue;}this.commands.exec("fstyle",propValue);microstrategy.eventManager.notifyOrphanBones("onselectionchange");return false;}break;case 67:if(e.ctrlKey){if(dv.IsNavigationDocument){return true;}return this.selections.copy();}break;case 68:if(e.ctrlKey&&this.selections.firstObjType()==microstrategy.OBJTYPE_DOC_OBJECT){if(dv.IsNavigationDocument){return true;}e.cancelBubble=true;this.selections.duplicate();return false;}break;case 75:case 84:if(e.ctrlKey){var target=(e.altKey)?"one":"";target+=(e.keyCode==75)?"back":"front";return this.selections.sendTo(target);}break;case 88:if(e.ctrlKey){if(dv.IsNavigationDocument){return true;}this.selections.cut();return false;}break;case 113:if(!this.selections.isMulti()){var item=this.selections.firstItem();var st=microstrategy.subObjectType(item);if(st==microstrategy.SUBOBJTYPE_DOC_TEXT){this.editObj(null,item);return false;}else{if(st==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){var bone=microstrategy.findRWObjectBone(item,"mstrHTMLContainerImpl");bone.editContents(e);}}}break;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.onkeypress=function(e){try{e=e||window.event;if(this.shouldIgnoreKeyEvent(e)){return true;}if(this.parentBone.isEditableViewModeEplus()){if(!e.ctrlKey&&this.selections.isActive()&&!this.selections.isMulti()){var isMoz=(bIsW3C&&!bIsIE4);var code=(isMoz)?e.charCode:e.keyCode;var item=this.selections.firstItem();var te=this.textEditor;var fn=function(scp,mth,itm){if(code==13){scp[mth](null,itm);return false;}else{if(code>=32){scp[mth](null,itm);if(isMoz){te.value+=String.fromCharCode(code);}}}return true;};var st=microstrategy.subObjectType(item);if(st==microstrategy.SUBOBJTYPE_DOC_TEXT){return fn(this,"editText",item);}else{if(st==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){return fn(microstrategy.findRWObjectBone(item,"mstrHTMLContainerImpl"),"editContents",null);}}}}}catch(err){microstrategy.errors.log(err);}return true;};mstrDocImpl.prototype.initDoc=function(){try{mstrStaticDoc.prototype.initDoc.call(this);window.setTimeout(this.path+".displayPageBreaker();",0);this.initSelection();this.parentBone.elem.onscroll=new Function("e",this.verifiedPath+" { "+this.path+".syncPosition(); }");if(this.parentBone.isEditableViewModeEplus()){var txt=document.createElement("textarea");txt.setAttribute("id","docEditTextArea");with(txt.style){overflow="hidden";position="absolute";zIndex=5;visibility="hidden";padding="0px";left="0px";top="0px";}txt.tabindex=1;txt.onkeydown=new Function("e",this.verifiedPath+" { return "+this.path+".catchEscKey(e); }");this.textEditor=this.elem.appendChild(txt);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.catchEscKey=function(e){try{if(!e){e=window.event;}if(e.keyCode==27){this.saveTextEdit(false);return false;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.initSelection=function(){try{for(var i=0;i<this.elem.childNodes.length;i++){var child=this.elem.childNodes[i];if(child.nodeType==1){if(child.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_SELECTION){this.selections=new mstrDocSelectionsImpl();this.selections.parentBone=this;this.selections.elem=child;this.selections.path=this.path+".selections";if(this.selections.onload){this.selections.onload();}break;}}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.onSubSectionResize=function(){try{this.updatePageBreaker();return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.displayPageBreaker=function(){try{this.showPageBreaker(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE||(this.parentBone.dividerOn&&(this.parentBone.isEditableViewModeEplus())));}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getNewPosition=function(x,parentNode,isVertical,useSnap,direction){try{if(useSnap){x=microstrategy.relativeSnapCoordinate(x,parentNode,isVertical,useSnap,direction);}var baseZero=(isVertical)?getObjSumTop(parentNode):getObjSumLeft(parentNode);x-=baseZero;if(x<0){x=0;}return x;}catch(err){microstrategy.errors.log(err);return x;}};mstrDocImpl.updateSectionList=function(us,subSection,bWire,isTarget){if(!us[subSection.id]){us[subSection.id]={};}us[subSection.id].bone=subSection;if(isTarget){bWire.target=us[subSection.id].isTarget=true;}else{bWire.control=true;us[subSection.id].isTarget=us[subSection.id].isTarget||false;}};mstrDocImpl.prototype.deleteItems=function(items,addToUpdateManager,sParentNode,isStaticAction,delayRangeReset){try{var um=this.parentBone.updateManager;var ac=(addToUpdateManager)?[]:null;var itemIds="|";var bone,i,cnt;var us={};var bWire={control:false,target:false};for(var item in items){var id=items[item].getAttribute("id");itemIds+=id+"|";}for(var item in items){var elem=items[item];if(elem.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_SUBSECTION){continue;}var st=microstrategy.subObjectType(elem);if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){bone=microstrategy.findBone(elem);if(bone&&bone.isGridInCellSelectionMode()){continue;}}this.selections.remove(elem,delayRangeReset);var zIndexValue=value=this.styleObj.getValue(elem,"zIndex");var subSecNode=sParentNode||elem.parentNode;var top=this.styleObj.getValue(elem,"top");var subSection=microstrategy.findBone(subSecNode);var id=elem.getAttribute("id");var objs=document.getElementsByName(id);if(subSection.isFilterPanel){this.docMask=this.getMask();var sec=microstrategy.findAncestorWithAtt(subSecNode,microstrategy.HTMLATTR_OBJTYPE,"dsec");if(!sec&&objs[0]){sec=microstrategy.findAncestorWithAtt(objs[0],microstrategy.HTMLATTR_OBJTYPE,"dsec");}var maskBone=this.getSubMaskBone(sec.id,subSection.id,0);maskBone.updateImageMap();}var ca={parent:elem.parentNode,srcObjects:[]};switch(st){case microstrategy.SUBOBJTYPE_DOC_TEMPLATE:mstrDocImpl.updateSectionList(us,subSection,bWire,true);for(i=0;i<objs.length;i++){bone=microstrategy.bone("grid_"+id+"_"+i);if(bone){bone.disabled=true;}}break;case microstrategy.SUBOBJTYPE_DOC_PANEL_STACK:mstrDocImpl.updateSectionList(us,subSection,bWire,true);bone=microstrategy.findBone(elem);if(bone&&bone.deleteStack){bone.deleteStack();}break;case microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL:mstrDocImpl.updateSectionList(us,subSection,bWire);bone=microstrategy.findBone(elem.firstChild);if(bone){bone.disabled=true;}break;default:var navbar=this.findNavigationBar(elem);if(navbar){navbar.onButtonRemoved(elem);}break;}for(i=objs.length-1;i>=0;i--){ca.srcObjects.push(objs[i].parentNode.removeChild(objs[i]));}var attCol=this.formattingAttributes[id];if(attCol){attCol.deleted=true;}if(addToUpdateManager){ca.srcObjects.reverse();var args=[mstrUpdateManager.UPDATE_LATER,id];ac.push(um.createActionObject(ca.srcObjects[ca.srcObjects.length-1],mstrUpdateManager.REMOVE_OBJECT,this.parentBone.beanPath,["2048018","2048012"],args,args,ca));}}this.updatePanelCM(subSection);if(subSection&&subSection.isFilterPanel){var maskBone=this.getSubMaskBone(sec.id,subSection.id,0);var format=mstrFormatObject;if(maskBone.adjustZIndex(null,id,true)){var moveItems=maskBone.getMoveItems();var th=parseInt(top);for(var i=0;i<moveItems.length;i++){var info=moveItems[i];ac=this.formatItems(microstrategy.createAssociativeArray(info.item),"zIndex",info.zIndex,false,ac||[]);var l=mstrFilterPanelMaskImpl.ITEM_SPA,t=th;moveObjTo(info.item,l,t);var ca={acrossSections:false};ac.push(um.createActionObject(info.item,mstrUpdateManager.MOVE_OBJECT,this.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,info.item.id,subSection.id,format.encodeValue("top",t),format.encodeValue("left",l)],[mstrUpdateManager.UPDATE_LATER,info.item.id,subSection.id,format.encodeValue("top",this.styleObj.getValue(info.item,"top")),format.encodeValue("left",this.styleObj.getValue(info.item,"left"))],ca));th+=getObjHeight(info.item)+mstrFilterPanelMaskImpl.ITEM_SPA;}}}else{if(subSection&&subSection.isNavigationBar){subSection.parentBone.postRemoveButtons(ac);}}microstrategy.eventManager.notifyOrphanBones("onbonedeleted",itemIds);if((bWire.control||bWire.target)&&this.parentBone.autoWire&&this.undoRedoSubSections!=null){for(var id in us){this.undoRedoSubSections.push(us[id]);}}if(addToUpdateManager&&ac&&ac.length>0){um.add(ac,isStaticAction);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.addObj=function(left,top,subsection,objs,ac,notUseSnap){try{var passOut=(ac!=null);ac=ac||[];var um=this.parentBone.updateManager;var f=microstrategy.getFormatObject();var ca={};var l=parseInt(Math.max(left,0));var t=parseInt(top)+this.parentBone.elem.scrollTop;var finishAdd=true;var objInfo=null;if(!objs.length){objs=[objs];}for(var i=0;i<objs.length;i++){objInfo=new mstrObjectInfoImpl(objs[i]);objInfo.height=objInfo.width="";objInfo.left=l;objInfo.top=t;if(notUseSnap!=null){objInfo.left=microstrategy.snapCoordinate(objInfo.left,0,!notUseSnap);objInfo.top=microstrategy.snapCoordinate(objInfo.top,0,!notUseSnap);l=objInfo.left;}var subType="";var text=objs[i].getAttribute("ds");finishAdd=true;switch(objInfo.dssType){case microstrategy.DSSTYPE_FILTER:if(objInfo.dssSubType!=microstrategy.DSSTYPE_CUSTOM_GROUP){finishAdd=false;break;}case microstrategy.DSSTYPE_METRIC:subType=microstrategy.SUBOBJTYPE_DOC_TEXT;if(!objInfo.isUnique){text="{["+objInfo.dSetName+"]:["+text+"]}";}else{text="{["+text+"]}";}break;case microstrategy.DSSTYPE_USER_SUMMARY_METRIC:case microstrategy.DSSTYPE_USER_METRIC:case microstrategy.DSSTYPE_ATTRIBUTE:case microstrategy.DSSTYPE_CONSOLIDATION:subType=microstrategy.SUBOBJTYPE_DOC_TEXT;text="{["+text+"]}";break;case microstrategy.DSSTYPE_ATTRIBUTE_FORM:subType=microstrategy.SUBOBJTYPE_DOC_TEXT;var attName="";var parentUL=findTargetTag(objs[i],"UL");if(parentUL){var parentLI=findTargetTag(parentUL,"LI");if(parentLI){if(parentLI.getElementsByTagName("span")[0]){attName=parentLI.getElementsByTagName("span")[0].getAttribute(microstrategy.HTMLATTR_DESCRIPTION);}}}attName="["+attName+"]";text="["+text+"]";text="{"+attName+"@"+text+"}";break;default:finishAdd=false;break;}if(finishAdd){var item=this.addItem(text,subsection,subType,objInfo,ac);ca.parent=item.parentNode;ac.push(um.createActionObject(item,mstrUpdateManager.ADD_TEXT,this.parentBone.beanPath,["2048018","2048012","2048020","2048007","2048008","2048010","2048011","2048100","2048099","2048241"],[mstrUpdateManager.UPDATE_LATER,item.getAttribute("id"),this.styleObj.getAttValue(item,microstrategy.HTMLATTR_NAME),subsection.id,text,f.encodeValue("top",objInfo.top),f.encodeValue("left",objInfo.left),String(this.styleObj.getValue(item,"zIndex")),f.encodeValue("textAlign",item.style.textAlign),"true"],[],ca));if(this.parentBone.defaultInsertMode==mstrDocImpl.INSERT_MODE.HIDE_OTHERS||(!this.parentBone.defaultInsertMode&&this.visibleCurOnly)){this.formatAttribute([item],"visibility","0",false,microstrategy.HTMLATTR_VISIBLE,ac,true);this.formatAttribute([item],"visibility","-1",false,microstrategy.HTMLATTR_VISIBLE,ac,false);}l+=getObjWidth(item)+10;}}if(!passOut&&ac.length>0){um.add(ac);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getContentHeight=function(bone){try{var subsection=bone.elem;if(!subsection){return 0;}var max=0;var ch;for(var j=0;j<subsection.childNodes.length;j++){var c=subsection.childNodes[j];if(c.nodeType!=1){continue;}if(c.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){var hm=microstrategy.styleObj.getAttValue(c,microstrategy.HTMLATTR_HEIGHT_MODE);if(!hm||hm!=microstrategy.HUNDRED_PERCENT_MODE){ch=parseInt(microstrategy.styleObj.getValue(c,"top"))+getObjHeight(c);}if(ch>max){max=ch;}}}return max;}catch(err){microstrategy.errors.log(err);return 0;}};mstrDocImpl.prototype.addCtrl=function(rect,src,ac,st,str,ci,notUseSnap){try{var passOut=(ac!=null);if(!passOut){ac=[];}var um=this.parentBone.updateManager;var f=microstrategy.getFormatObject();var so=this.styleObj;var ca={};var subsection=microstrategy.findBone(src);var objInfo=new mstrObjectInfoImpl(null);if(!st){st=this.currentControl;}var cst=this.currentControlSubtype;var needToAddDataset=(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE&&cst=="R");if(st==microstrategy.GRAPH_CTL){st=microstrategy.SUBOBJTYPE_DOC_TEMPLATE;objInfo.viewMode=2;}if(st==microstrategy.BUTTON_CTL){st=microstrategy.SUBOBJTYPE_DOC_TEXT;}if(rect){objInfo.left=rect.left-getObjSumLeft(src);if(bIsW3C){objInfo.left+=this.parentBone.elem.scrollLeft;}objInfo.top=rect.top-getObjSumTop(src)+this.parentBone.elem.scrollTop;objInfo.height=(rect.bottom)?rect.bottom-rect.top:null;objInfo.width=(rect.right)?rect.right-rect.left:null;if(cst=="FP"){objInfo.height=(objInfo.height==null)?625:objInfo.height;objInfo.width=(objInfo.width==null)?145:objInfo.width;}else{if(this.isDocButtonType(st,cst)){var defaultSize=mstrButton.BUTTON_DEFAULT_SIZES[cst];if(defaultSize){objInfo.width=objInfo.width==null?defaultSize.w:objInfo.width;objInfo.height=objInfo.height==null?defaultSize.h:objInfo.height;}}}}else{objInfo.top=this.getContentHeight(subsection);objInfo.height=null;var autoResize=false;if(st==microstrategy.SUBOBJTYPE_DOC_WIDGET){var wp=this.currentControlSubtype.split(";");if(wp[0]=="com.microstrategy.web.vf.viewer.DatePickerApplicationViewer"||wp[0]=="com.microstrategy.web.vf.viewer.FishEyeApplicationViewer"){resize=false;}else{resize=true;}}else{resize=st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE||st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK||st==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER||st==microstrategy.SUBOBJTYPE_DOC_IMAGE;}if(resize){objInfo.height=getObjHeight(subsection.elem)-objInfo.top;if(objInfo.height<=0){objInfo.height=null;}}objInfo.width=getObjWidth(subsection.elem);if(subsection.isFilterPanel){objInfo.width-=4;objInfo.top+=2;objInfo.left=2;}}if(notUseSnap!=null){objInfo.left=microstrategy.snapCoordinate(objInfo.left,0,!notUseSnap);objInfo.top=microstrategy.snapCoordinate(objInfo.top,0,!notUseSnap);if(objInfo.width){objInfo.width=microstrategy.snapCoordinate(objInfo.width,0,!notUseSnap);}if(objInfo.height){objInfo.height=microstrategy.snapCoordinate(objInfo.height,0,!notUseSnap);}}var widgetProps={isWidget:false,className:"",rslPath:"",title:"",previewImage:"",isApp:"false",scope:microstrategy.SUBOBJTYPE_DOC_TEMPLATE,defaultDHTMLStyle:0};switch(st){case microstrategy.SUBOBJTYPE_DOC_TEMPLATE:if(ci!=null){if(ci.dssSubType){objInfo.dssSubType=ci.dssSubType;}if(ci.dataSetName){objInfo.dSetName=ci.dataSetName;}}break;case microstrategy.SUBOBJTYPE_DOC_WIDGET:var wp=this.currentControlSubtype.split(";");widgetProps.isWidget=true;if(wp.length>1){widgetProps.className=wp[0];widgetProps.rslPath=wp[1];widgetProps.title=wp[2];widgetProps.previewImage=wp[3];if(wp.length>4){widgetProps.isApp=wp[4];}if(wp.length>5){widgetProps.scope=wp[5];}if(wp.length>6){widgetProps.defaultDHTMLStyle=wp[6];}st=microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL;}else{var lst=microstrategy.getViewerBone().gridWidgets.lst;var w=lst[wp];if(w){widgetProps.gridWidget=w;widgetProps.widgetId=wp[0];if(w.wgt){widgetProps.className=w.wgt.cn;widgetProps.rslPath=w.wgt.rsl;widgetProps.title=w.t;widgetProps.previewImage=w.wgt.img;widgetProps.isApp=w.wgt.ia;widgetProps.scope=w.wgt.scp;widgetProps.defaultDHTMLStyle=w.wgt.sty;}}st=microstrategy.SUBOBJTYPE_DOC_TEMPLATE;}if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){ci={widgetName:widgetProps.title,widgetPreviewSrc:widgetProps.previewImage,widgetClass:widgetProps.className,widgetRSL:widgetProps.rslPath,widgetIsApp:widgetProps.isApp};}else{if(st==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){this.currentControlSubtype=widgetProps.defaultDHTMLStyle;cst=this.currentControlSubtype;}}}if(src.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_PANEL&&cst==="TC"){showMessage({contents:microstrategy.descriptors.getDescriptor("11959"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return null;}if(this.isAddToFilterPanel(src)&&st!=microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){showMessage({contents:microstrategy.descriptors.getDescriptor("9512"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return null;}var text=null;switch(st){case microstrategy.SUBOBJTYPE_DOC_TEMPLATE:if(this.isAddToDetailsSection(src)){return null;}text=document.createElement("div");text.setAttribute(microstrategy.HTMLATTR_SCRIPTCLASS,"mstrGridRW");text.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_GRID_TABLE);text.style.position="relative";text.appendChild(mstrTemplateImpl.buildEmptyTemplate("r-",false));break;case microstrategy.SUBOBJTYPE_DOC_TEXT:text=(str&&str.length>0)?str:"";break;case microstrategy.SUBOBJTYPE_DOC_IMAGE:if(!objInfo.height){objInfo.height=30;}if(!objInfo.width){objInfo.width=28;}text=document.createElement("img");break;case microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL:if(this.isAddToDetailsSection(src)){return null;}text=document.createElement("div");break;case microstrategy.SUBOBJTYPE_DOC_PANEL_STACK:if(this.isAddToDetailsSection(src)){return null;}case microstrategy.SUBOBJTYPE_DOC_LINE:case microstrategy.SUBOBJTYPE_DOC_SHAPE:text="";break;case microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER:text=document.createElement("div");break;default:text=st;break;}var item=this.addItem(text,subsection,st,objInfo,ac,ci);var id=item.getAttribute("id");ca.parent=item.parentNode;var bp=this.parentBone.beanPath;if(!objInfo.height){objInfo.height=getObjHeight(item);}if(!objInfo.width){objInfo.width=getObjWidth(item);}var objName=so.getAttValue(item,microstrategy.HTMLATTR_NAME);var submitWidgetEvt=function(){var epP=["ClassName","Enable"];var epV=[widgetProps.className,"-1"];if(widgetProps.rslPath&&widgetProps.rslPath.length){epP.push("RSLPath");epV.push(widgetProps.rslPath);}if(widgetProps.isApp&&widgetProps.isApp.length>0){epP.push("IsApp");epV.push(widgetProps.isApp);}ac.push(um.createEditPropsAction(item,id,bp,epP,epV));};var encTop=f.encodeValue("top",objInfo.top);var encLeft=f.encodeValue("left",objInfo.left);var encWidth=f.encodeValue("width",objInfo.width);var encHeight=f.encodeValue("height",objInfo.height);var zIndex=so.getValue(item,"zIndex");var argIds,argVals;var me=this;var fnSetCurVisible=function(itm){if(me.parentBone.defaultInsertMode==mstrDocImpl.INSERT_MODE.HIDE_OTHERS||(!me.parentBone.defaultInsertMode&&me.visibleCurOnly)){me.formatAttribute([itm],"visibility","0",false,microstrategy.HTMLATTR_VISIBLE,ac,true);me.formatAttribute([itm],"visibility","-1",false,microstrategy.HTMLATTR_VISIBLE,ac,false);}};if(st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){var isTC=so.getAttValue(item,microstrategy.HTMLATTR_USE_AS_TABLE_CONTROL)==microstrategy.TRUE,panelId=item.lastChild.lastChild.firstChild.getAttribute("id");var acObj=um.createActionObject(item,mstrUpdateManager.ADD_PANEL_STACK,bp,["2048007","2048012","2048117","2048010","2048011","2048100","2048043","2048042","2048018","2048020","2048241"],[subsection.id,id,panelId,encTop,encLeft,zIndex,encWidth,encHeight,mstrUpdateManager.UPDATE_LATER,objName,"true"],[],ca);if(!isTC){ac.push(acObj);}else{microstrategy.updateManager.add([acObj]);}if(isTC){this.formatAttribute([item],"UseAsTableControl",microstrategy.TRUE,false,microstrategy.HTMLATTR_USE_AS_TABLE_CONTROL,ac,true);this.formatAttribute([item],"showTitleBar",microstrategy.FALSE,false,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE,ac,true);this.formatItems([item],"backgroundColor","#C5CCD4",false,ac);microstrategy.findBone(item).initNewTable(ac,1);um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[])]);}fnSetCurVisible(item);if(this.parentBone.autoWire){subsection.wireTargets(ac,bp,true);}if(so.getAttValue(item,microstrategy.HTMLATTR_USE_AS_FILTER_PANEL)==microstrategy.TRUE){this.formatAttribute([item],"UseAsFilterPanel",microstrategy.TRUE,false,microstrategy.HTMLATTR_USE_AS_FILTER_PANEL,ac);}}else{if(st==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){var cb=microstrategy.bone(id+"_Ctl");if(cb!=null){var srcTy=cb.ctlSrcType?cb.ctlSrcType:"";this.selections.syncUp(null,ac);this.selections.finishAddAllObjs(microstrategy.createAssociativeArray(item),ac);ac.push(um.createActionObject(item,mstrUpdateManager.CTRL_ADD,bp,["2048010","2048011","2048100","2048043","2048042","2048007","2048012","2048113","2048129","2048114","2048115","2048116","2048119","2048120","2048121","2048125","2048020","2048139","2048241"],[encTop,encLeft,zIndex,encWidth,encHeight,subsection.id,id,cb.ctlType,"",cb.ctlSrcId,srcTy,cb.targetKeys,cb.ctlStyle,cb.multiSelect?"1":"0",cb.ctlOrientation,cb.showAll?"1":"0",objName,((cb.autoSync)?"1":"0"),"true"],[],ca));fnSetCurVisible(item);cb.initDefaultFormats(ac);if(widgetProps.isWidget){submitWidgetEvt();so.setAttValue(item,"twc",widgetProps.className);so.setAttValue(item,"rsl",widgetProps.rslPath);so.setAttValue(item,"iap",widgetProps.isApp);}if(this.isAddToFilterPanel(src)){me.formatAttribute([item],"showElementCount",microstrategy.TRUE,false,microstrategy.HTMLATTR_CTL_SHOW_ELEMENT_COUNT,ac);var ft=microstrategy.formatType;microstrategy.formatType=microstrategy.FORMAT_TYPE_CONTROL_TITLE;me.formatAttribute([item],"showTitleBar",microstrategy.TRUE,false,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE,ac);microstrategy.formatType=ft;}}if(this.parentBone.autoWire&&cb.ctlType!=mstrRWControlImpl.CTL_TYPE_PANEL_STACK){subsection.wireTargets(ac,bp);}}else{if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var isDataset=false;argIds=["2048012","2048007","2048010","2048011","2048100","2048042","2048043"];argVals=[id,subsection.id,encTop,encLeft,zIndex,encHeight,encWidth];if(ci!=null&&ci.dataSetID!=null){isDataset=true;argIds.push("2048031");argVals.push(ci.dataSetID);if(ci.addAsLinked){argIds=argIds.concat(["2048018","2048158"]);argVals=argVals.concat([mstrUpdateManager.UPDATE_LATER,"1"]);}else{if(ci.shiftKey&&ci.viewMode){var vm=(ci.viewMode=="3")?"7":ci.viewMode;argIds=argIds.concat(["2048098","2048025","2048018"]);argVals=argVals.concat([ci.shiftKey,vm,mstrUpdateManager.UPDATE_LATER]);}else{argIds=argIds.concat(["2048098","2048018"]);argVals=argVals.concat([ci.shiftKey,mstrUpdateManager.UPDATE_LATER]);}}}else{argIds=argIds.concat(["2048018","2048020","2048025"]);argVals=argVals.concat([mstrUpdateManager.UPDATE_LATER,objName,(objInfo.viewMode||1)]);}argIds=argIds.concat(["2048241"]);argVals=argVals.concat(["true"]);ac.push(um.createActionObject(item,mstrUpdateManager["ADD_"+((isDataset)?"DATASET_":"")+"TEMPLATE"],bp,argIds,argVals,[],ca));fnSetCurVisible(item);if(!isDataset){if(objInfo.viewMode&&cst){ac.push(um.createActionObject(item,mstrUpdateManager.EDIT_GRAPH_PROPS,bp+"."+id,["4082"],[cst],[],ca));}if(widgetProps.isWidget){this.formatSizeMode({0:item},"heightMode","0",ac,true);this.formatSizeMode({0:item},"widthMode","0",ac,true);this.selections.processWidgetPropertyChanges({widgetId:widgetProps.widgetId,FlashDisplay:widgetProps.gridWidget.wgt!=null,DHTMLDisplay:widgetProps.gridWidget.vis!=null&&widgetProps.gridWidget.vis.vm!==50,iPhoneDisplay:widgetProps.gridWidget.iphVis!=null,iPadDisplay:widgetProps.gridWidget.ipadVis!=null,AndroidDisplay:widgetProps.gridWidget.aVis!=null,AndroidTabletDisplay:widgetProps.gridWidget.atVis!=null},microstrategy.findBone(item),ac,{id:item});}}if(this.parentBone.autoWire){subsection.wireTargets(ac,bp,true);}}else{argIds=["2048018","2048007","2048012","2048020","2048010","2048011","2048100"];argVals=[mstrUpdateManager.UPDATE_LATER,subsection.id,id,objName,encTop,encLeft,zIndex];if(st==microstrategy.SUBOBJTYPE_DOC_LINE){var ori=so.getAttValue(item,microstrategy.HTMLATTR_ORIENTATION);objInfo[microstrategy.HTMLATTR_ORIENTATION]=ori;evtId=mstrUpdateManager.ADD_LINE;argIds.push("2048061");argVals.push(ori);if(ori==microstrategy.ORIENTATION_HORIZONTAL){argIds.push("2048043");argVals.push(encWidth);}else{if(ori==microstrategy.ORIENTATION_VERTICAL){argIds.push("2048042");argVals.push(encHeight);}}}else{argIds.push("2048043");argIds.push("2048042");argVals.push(encWidth);argVals.push(encHeight);switch(st){case microstrategy.SUBOBJTYPE_DOC_TEXT:evtId=mstrUpdateManager.ADD_TEXT;var frm=so.getAttValue(item,microstrategy.HTMLATTR_DSS_FORMULA);if(frm==null){frm="";}argIds.splice(2,0,"2048008");argVals.splice(2,0,frm);break;case microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER:evtId=mstrUpdateManager.ADD_HTML_CONTAINER;argIds.push("2048161");argVals.push(so.getAttValue(item,microstrategy.HTMLATTR_HTML_TYPE));break;case microstrategy.SUBOBJTYPE_DOC_SHAPE:evtId=mstrUpdateManager.ADD_SHAPE;argIds.push("2048067");argVals.push((cst=="1")?"5":"2");break;case microstrategy.SUBOBJTYPE_DOC_IMAGE:this.selections.syncUp(null,ac);this.selections.finishAddAllObjs(microstrategy.createAssociativeArray(item),ac);evtId=mstrUpdateManager.ADD_IMAGE;argIds.splice(1,0,"2048019");argVals.splice(1,0,"dummy url");argIds[8]="2048042";argIds[9]="2048043";var fnR=function(d){return f.encodeValue(d,item.getAttribute(microstrategy["HTMLATTR_D"+d.toUpperCase()]));};argVals.splice(5,5,fnR("top"),fnR("left"),zIndex,fnR("height"),fnR("width"));break;}}if(evtId){argIds.splice(0,0,"2048241");argVals.splice(0,0,"true");ac.push(um.createActionObject(item,evtId,bp,argIds,argVals,[],ca));fnSetCurVisible(item);}if(st==microstrategy.SUBOBJTYPE_DOC_SHAPE){if(cst=="1"){this.selections.syncUp(null,ac);this.selections.finishAddAllObjs(microstrategy.createAssociativeArray(item),ac);}}else{if(st==microstrategy.SUBOBJTYPE_DOC_IMAGE){this.selections.addingCtrl=microstrategy.SUBOBJTYPE_DOC_IMAGE;this.commands.exec("addImg");}}}}}mstr.controllers.EventManager.notifyListenersOfId(item.id,{name:"Add",ac:ac,update:false,item:item});mstr.controllers.EventManager.notifyListenersOfId(src.id,{name:"ChildAdded",ac:ac,item:item});if(needToAddDataset){var grid=microstrategy.findBone(item);if(grid){grid.onLinkDataset();}}if(this.isInsertMode&&this.currentControl==microstrategy.GRAPH_CTL){var params="activeViewID="+id+"&boneID=grid_"+id+"&zoomFactor="+microstrategy.ZOOM_FACTOR;if(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE){params+="&graphHeight="+objInfo.height+"&graphWidth="+objInfo.width;var sliceIndexHelper=id.replace("_graph",""),lastUnderScoreIndex=sliceIndexHelper.lastIndexOf("_"),sliceIndex=(lastUnderScoreIndex===-1)?null:sliceIndexHelper.substr(lastUnderScoreIndex+1);if(sliceIndex!=null){params+="&sliceIndex="+sliceIndex;}}ac.push(um.createActionObject(null,mstrUpdateManager.SHOW_BEAN,microstrategy.servletName+"."+microstrategy.pageName,["5017","5018"],[true,"edtGraphDropZones"],[]));um.addURL(params);}if(passOut){return ac;}um.add(ac);}catch(err){microstrategy.errors.log(err);return ac;}};mstrDocImpl.prototype.getLinkedVisualization=function(widgetRsl){if(this.parentBone&&this.parentBone.widgets){for(var i=0;i<this.parentBone.widgets.length;i++){var curWgt=this.parentBone.widgets[i];if(curWgt.rslPath==widgetRsl&&curWgt.scope==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){if(curWgt.isVis){var wdgId=this.parentBone.widgets[i].id;if(wdgId=="FisheyeWidget"){return"visFishEye";}else{return"vis"+wdgId;}}break;}}}return null;};mstrDocImpl.prototype.isAddToDetailsSection=function(src){try{if(src.getAttribute(microstrategy.HTMLATTR_DETAILS_SECTION)&&src.getAttribute(microstrategy.HTMLATTR_DETAILS_SECTION)==microstrategy.TRUE){showMessage({contents:microstrategy.descriptors.getDescriptor("4813"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return true;}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocImpl.prototype.isAddToFilterPanel=function(src){try{if(src.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_PANEL){var bone=microstrategy.findBone(src);if(bone&&bone.isFilterPanel){return true;}}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocImpl.prototype.createTitleBar=function(dataSetName,id,gridgraphParams){try{var isSelector=this.selections.isSelectorControlSelected()||(gridgraphParams&&(gridgraphParams.isSelector||gridgraphParams.isSelectorControl));var pd=document.createElement("div");pd.className="portal";pd.id=id;pd.setAttribute(microstrategy.HTMLATTR_SCRIPTCLASS,"mstrPortalImpl");pd.setAttribute("sty","ctitl");pd.style.height=microstrategy.WINDOW_TITLE_HEIGHT+"px";pd.style.position="relative";pd=this.parentBone.objProps.initObjectFormat(pd,true,isSelector?microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL:microstrategy.SUBOBJTYPE_DOC_TEMPLATE,isSelector?mstrRWControlImpl.FMT_TYPE_TITLE:mstrGridReport.FMT_TYPE_TITLE);var pt=document.createElement("table");pd.appendChild(pt);pt.border=0;pt.cellSpacing=0;pt.cellPadding=0;pt.className="pane";var tr=pt.insertRow(pt.rows.length);var td=null;var imgTag=null;var cls="mstrIcon-btn mstrIcon-btn";var md=microstrategy.descriptors;if(this.parentBone.isInteractiveViewModeEplus()&&microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE&&gridgraphParams&&!gridgraphParams.isSelector){td=tr.insertCell(tr.cells.length);td.className="portalTitleBarZoomTD";imgTag=this.createImageTag(md.getDescriptor("5567"),cls+"Find","btnFind");imgTag.onclick=new Function("var b = microstrategy.bone('"+gridgraphParams.boneId+"'); if(b) b.drillOutToFixedTemplate('"+gridgraphParams.objKey+"','"+gridgraphParams.treeType+"','"+gridgraphParams.displayMode+"');");td.appendChild(imgTag);}td=tr.insertCell(tr.cells.length);td.className="portalTitleBarTD";var ttl=document.createElement("div");ttl.className="portalTitleBar";ttl.setAttribute("id","titleBar");ttl.setAttribute("name","titleBar");if(dataSetName){var name=document.createTextNode(dataSetName);ttl.appendChild(name);}td.appendChild(ttl);td=tr.insertCell(tr.cells.length);td.className="portalTitleBarButtonsTD";var bs=document.createElement("span");bs.className="portalTitleBarButtons";td.appendChild(bs);if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE&&gridgraphParams){imgTag=this.createImageTag(md.getDescriptor("4161"),cls+"Menu","localDataMenu_"+gridgraphParams.boneId);imgTag.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,"wBtn");bs.appendChild(imgTag);}if(gridgraphParams&&!gridgraphParams.isSelector){imgTag=this.createImageTag(md.getDescriptor("4539"),cls+"Minimize","minimize");imgTag.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,"wBtn");bs.appendChild(imgTag);imgTag=this.createImageTag(md.getDescriptor("4540"),cls+"Restore","restore");imgTag.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,"wBtn");imgTag.style.display="none";bs.appendChild(imgTag);imgTag=this.createImageTag(md.getDescriptor("4541"),cls+"Maximize","maximize");imgTag.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,"wBtn");bs.appendChild(imgTag);imgTag=this.createImageTag(md.getDescriptor("629"),cls+"Close","delete");imgTag.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,"wBtn");bs.appendChild(imgTag);}return pd;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.createImageTag=function(title,cssClass,id){try{var imgTag=document.createElement("img");imgTag.className=cssClass;imgTag.setAttribute("id",id);imgTag.setAttribute("title",title);imgTag.setAttribute("src",microstrategy.IMG_SRC_TRANSPARENT);return imgTag;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.setStubImage=function(stubImage){if(stubImage!=null){var img=(stubImage.getElementsByTagName("img"))[0];if(img!=null){img.setAttribute("src","");}this.styleObj.setAttValue(stubImage,microstrategy.HTMLATTR_IMAGE_SOURCE,"");}this.stubImage=stubImage;};mstrDocImpl.prototype.addNewImage=function(stubItem,ac){try{var so=this.styleObj;var ca={parent:stubItem.parentNode};this.selections.remove(stubItem);var newItem=null;if(!bIsIE6){var subsection=microstrategy.findBone(stubItem.parentNode);var objInfo=new mstrObjectInfoImpl(null);var fn=function(d){objInfo[d]=parseInt(so.getValue(stubItem,d),10);};fn("left");fn("top");fn("height");fn("width");this.commands.exec("deleteStubImg");newItem=this.addItem(document.createElement("img"),subsection,microstrategy.SUBOBJTYPE_DOC_IMAGE,objInfo);}else{newItem=stubItem.cloneNode(true);this.commands.exec("deleteStubImg");newItem=this.addItemsToSubsection(ca.parent,newItem,true);}so.cloneAttValues(stubItem,newItem);this.selections.add(newItem);var fnImg=function(d){return mstrFormatObject.encodeValue(d,newItem.getAttribute(microstrategy["HTMLATTR_D"+d.toUpperCase()]));};ac.push(this.parentBone.updateManager.createActionObject(newItem,mstrUpdateManager.ADD_IMAGE,this.parentBone.beanPath,["2048018","2048019","2048007","2048012","2048020","2048010","2048011","2048100","2048042","2048043","2048295","2048241"],[mstrUpdateManager.UPDATE_LATER,"dummy url",newItem.getAttribute(microstrategy.HTMLATTR_SECTION_ID),newItem.getAttribute(microstrategy.HTMLATTR_ID),so.getAttValue(newItem,microstrategy.HTMLATTR_NAME),fnImg("top"),fnImg("left"),so.getValue(newItem,"zIndex"),fnImg("height"),fnImg("width"),"true"],[],mstr.Enum.IMAGE_URL_TYPE.DUMMY_URL,ca));if(this.parentBone.defaultInsertMode==mstr.Enum.INSERT_MODE.HIDE_OTHERS||(this.visibleCurOnly&&!this.parentBone.defaultInsertMode)){this.formatAttribute([newItem],"visibility","0",false,microstrategy.HTMLATTR_VISIBLE,ac,true);this.formatAttribute([newItem],"visibility","-1",false,microstrategy.HTMLATTR_VISIBLE,ac,false);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.autoSizeImages=function(cycle,init,items,ac,isNewImage){try{if(items){this.items=items;}var appendActions=false;var um=this.parentBone.updateManager;if(this.items){for(var item in this.items){var selectedItem=this.items[item];if(microstrategy.subObjectType(selectedItem)==microstrategy.SUBOBJTYPE_DOC_IMAGE){var oImage=document.getElementsByName(selectedItem.getAttribute("id")+"_img");var el=oImage[0];if(el&&(el.readyState=="complete"||el.complete)){if(init){if(!ac||ac==null){ac=this.parentBone.updateManager.getLastAction();appendActions=true;}}el.style.width="auto";el.style.height="auto";var bm=mstr.utils.BoxModel;if(this.adjustImageSizeFlag){this.adjustImageSizeFlag=false;var pw=bm.getElementInnerWidth(el.parentNode.parentNode);var ph=bm.getElementInnerHeight(el.parentNode.parentNode)-parseInt(microstrategy.styleObj.getValue(el.parentNode,"top"));var iw=bm.getElementOuterWidth(el);var ih=bm.getElementOuterHeight(el);var iRatio=iw/ih;if(ih>ph||iw>pw){var hR=ph/ih;var wR=pw/iw;if(hR>wR){iw=pw;ih=iw/iRatio;}else{ih=ph;iw=ih*iRatio;}el.style.width=iw+"px";el.style.height=ih+"px";}}this.formatSizeMode({0:selectedItem},"widthMode","0",ac,false);this.formatSizeMode({0:selectedItem},"heightMode","0",ac,false);var h=getObjHeight(el),w=getObjWidth(el);this.formatSize({0:selectedItem},"height",""+h,ac);this.formatSize({0:selectedItem},"width",""+w,ac);if(isNewImage){this.formatAttribute([selectedItem],"height",""+mstrFormatObject.encodeValue("height",h),false,microstrategy.HTMLATTR_HEIGHT,ac,true);this.formatAttribute([selectedItem],"width",""+mstrFormatObject.encodeValue("width",w),false,microstrategy.HTMLATTR_WIDTH,ac,true);}if(appendActions){this.parentBone.updateManager.add(ac);}}else{if(cycle<10){var that=this;window.setTimeout(function(){that.autoSizeImages(cycle+1,init);},50);}else{this.adjustImageSizeFlag=false;}}}}this.selections.resizeSubSection(false,ac);this.selections.resetRange(false,ac);this.selections.syncUp();}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.editText=function(e,src){try{var so=this.styleObj;var te=this.textEditor;var v="";src=microstrategy.findAncestor(src);var att=microstrategy.HTMLATTR_DSS_FORMULA;var defaultHttp=false;var st=microstrategy.subObjectType(src);var textDirection=this.styleObj.getValue(src,"TextDirection")||"0";if(st==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){if(so.getAttValue(src,microstrategy.HTMLATTR_HTML_TYPE)==microstrategy.HTML_CONTAINER_TYPE_HTML){att=microstrategy.HTMLATTR_HTML_TEXT;}else{att=microstrategy.HTMLATTR_HTML_SOURCE;defaultHttp=true;}}if(this.isDocButton(src)){var dispStyle=so.getAttValue(src,microstrategy.HTMLATTR_DISPLAY_STYLE);if(dispStyle==microstrategy.BUTTON_STYLE_ICON_ONLY||dispStyle==microstrategy.BUTTON_STYLE_CUSTOM){return ;}}v=so.getAttValue(src,att);if(!v&&defaultHttp){v="http://";}if(v==null){v="";}v=v.replace(/\\n/g,"\r\n");v=decode(v,true);te.source=src;var fnBg=function(ty){var el=(ty)?microstrategy.findAncestorWithAtt(src.parentNode,microstrategy.HTMLATTR_OBJTYPE,ty):src;var bc=so.getValue(el,"backgroundColor");return(bc&&bc.toLowerCase()!="transparent")?bc:null;};var bg=fnBg()||fnBg(microstrategy.OBJTYPE_DOC_SUBSECTION)||fnBg(microstrategy.OBJTYPE_DOC);te.style.backgroundColor=(bg!=null&&bg.length>0&&bg.toLowerCase()!="transparent")?bg:"#ffffff";te.style.width=so.getValue(src,"width");te.style.height=so.getValue(src,"height");var fnBr=function(d,scp){var dl=d.toLowerCase();var x=parseFloat(so.getValue(src,"border"+d+"Width"));if(dl==="top"&&textDirection==="90"&&!bIsDXIE){te.style[dl]=(window["getObjSum"+d](src)-scp[dl]+((!isNaN(x))?x:0))-src.offsetWidth+"px";}else{te.style[dl]=(window["getObjSum"+d](src)-scp[dl]+((!isNaN(x))?x:0))+"px";}};fnBr("Top",this);fnBr("Left",this);te.style.paddingTop=so.getValue(src,"paddingTop");te.style.paddingRight=so.getValue(src,"paddingRight");te.style.paddingBottom=so.getValue(src,"paddingBottom");te.style.paddingLeft=so.getValue(src,"paddingLeft");te.style.color=so.getValue(src,"color");te.style.textAlign=so.getValue(src,"textAlign");te.style.fontFamily=so.getValue(src,"fontFamily");te.style.fontSize=so.getValue(src,"fontSize");te.style.fontWeight=so.getValue(src,"fontWeight");te.style.fontStyle=so.getValue(src,"fontStyle");te.style.textDecoration=so.getValue(src,"textDecoration");if(so.getValue(src,"whiteSpace")=="nowrap"){te.setAttribute("wrap","off");}else{te.removeAttribute("wrap");}te.style.borderWidth="0px";te.style.visibility="visible";te.style.zIndex=(""+so.getValue(src,"zIndex")+1);te.onblur=new Function(this.verifiedPath+" { "+this.path+".saveTextEdit(true); }");te.value=v;if(this.isDocButton(src)){var bone=microstrategy.findBone(src);if(bone){bone.onEditText(te,src);}}microstrategy.setCursorToEnd(te);te=null;}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.editObj=function(e,src){try{switch(microstrategy.subObjectType(src)){case microstrategy.SUBOBJTYPE_DOC_TEXT:case microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER:if(this.parentBone.isEditableViewModeEplus()){if(this.isDocButton(src)){var bone=microstrategy.findBone(src);bone.editContents(e,src);break;}this.editText(e,src);}break;case microstrategy.SUBOBJTYPE_DOC_SHAPE:break;default:this.commands.exec("edtPropsTabSelected",0);break;}}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.saveTextEdit=function(saveEdit){try{var te=this.textEditor,src=te.source;te.onblur=null;te.style.visibility="hidden";te.style.top=te.style.left="0px";if(this.isDocButton(src)){var bone=microstrategy.findBone(src);if(bone){bone.postEditText(te,src);}}if(saveEdit){var itemType=(microstrategy.subObjectType(src)==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER)?"HTML_CONTAINER":"Text";var textValues=this["get"+itemType.replace("_CONTAINER","")+"FieldValues"](src,te.value);if(textValues.hasChanged){var objs=document.getElementsByName(src.getAttribute("id"));if(objs&&objs.length>0){var um=this.parentBone.updateManager;var ac=[];var attId;var id=src.getAttribute("id");var bp=this.parentBone.beanPath;var type=microstrategy["SUBOBJTYPE_DOC_"+itemType.toUpperCase()];if(type==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){var fmtId;if(this.styleObj.getAttValue(src,microstrategy.HTMLATTR_HTML_TYPE)==microstrategy.HTML_CONTAINER_TYPE_HTML){var pattern=/^(&nbsp;|\s)*http:\/\//i;if(textValues.attributeValue&&textValues.attributeValue.search(pattern)!=-1){this.styleObj.setAttValue(objs[0],microstrategy.HTMLATTR_HTML_TYPE,microstrategy.HTML_CONTAINER_TYPE_IFRAME);ac.push(um.createEditPropsAction(objs[0],id,bp,["htmlType"],[microstrategy.HTML_CONTAINER_TYPE_IFRAME],[microstrategy.HTML_CONTAINER_TYPE_HTML]));attId=microstrategy.HTMLATTR_HTML_SOURCE;fmtId="url";}else{attId=microstrategy.HTMLATTR_HTML_TEXT;fmtId="htmlText";}}else{attId=microstrategy.HTMLATTR_HTML_SOURCE;fmtId="url";}evtId=mstrUpdateManager.EDIT_PROPS;ac.push(um.createEditPropsAction(objs[0],id,bp,[fmtId],[textValues.saveValue],[textValues.oldValue]));}else{attId=microstrategy.HTMLATTR_DSS_FORMULA;ac.push(um.createActionObject(objs[0],mstrUpdateManager.EDIT_TEXT,bp,["2048012","2048008","2048018"],[id,textValues.saveValue,mstrUpdateManager.UPDATE_LATER],[id,textValues.oldValue,mstrUpdateManager.UPDATE_LATER]));}this.styleObj.setAttValue(objs[0],attId,textValues.attributeValue);for(var i=0;i<objs.length;i++){if(type==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){microstrategy.findRWObjectBone(objs[i],"mstrHTMLContainerImpl").updateContents(this.styleObj.getAttValue(objs[i],microstrategy.HTMLATTR_HTML_TYPE),textValues);}else{this.updateSingleTextField(objs[i],textValues.displayValue);}}this.selections.syncUp(src);this.selections.resizeSubSection(false,ac);um.add(ac);}}}te.value="";if(bIsW3C&&!bIsIE4){te.blur();}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getTextFieldValues=function(obj,newValue){try{var so=this.styleObj;var rslt={};rslt.oldValue=decode(so.getAttValue(obj,microstrategy.HTMLATTR_DSS_FORMULA),true);rslt.saveValue=newValue;rslt.hasChanged=(rslt.oldValue!=rslt.saveValue);rslt.attributeValue=encode(rslt.saveValue,true);rslt.displayValue=rslt.attributeValue.replace(/\r?\n/g,"<br />");if(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE){var isLink=(so.getAttValue(obj,microstrategy.HTMLATTR_IS_LINK)==microstrategy.TRUE);var href=(isLink)?so.getAttValue(obj,microstrategy.HTMLATTR_LINK_HREFVALUE):"";var lcValue=rslt.saveValue.toLowerCase();var asIndex=lcValue.indexOf("<a");if(asIndex>-1&&lcValue.indexOf("href=",asIndex)>-1&&isLink&&(href==null||href.length==0)){asIndex=lcValue.indexOf(">",asIndex)+1;var aeIndex=lcValue.indexOf("</a",asIndex);if(aeIndex!=-1){rslt.displayValue=rslt.saveValue.substring(asIndex,aeIndex);}else{rslt.displayValue=rslt.saveValue.substring(asIndex);}rslt.displayValue=encode(rslt.displayValue,true);rslt.displayValue=rslt.displayValue.replace(/\r\n/g,"<br />");}}return rslt;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocImpl.prototype.openReplaceObjectEditor=function(source,workingset,info,datasets){var me=this,ROEDITOR_ID="mstrReconReplaceEditor",roEditor=null,openReplaceObjectEditor=function(config){if(!roEditor){roEditor=mstrmojo.all[ROEDITOR_ID]||mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.ReplaceObjectEditor",id:ROEDITOR_ID});}roEditor.setUnits({source:config.source,target:config.target});var applyReconciliationFunction=function(members,clearaf){var actions={actions:[{act:"applyReconciliation",clr_af:clearaf,members:members}],style:{name:"RWIVEMojoStyle"}};if(info.ReplaceAllDS){for(var did in datasets){members.unshift({srcid:did,srct:3,tgtid:config.target.did,tgtt:3});}}else{members.unshift({srcid:config.source.did,srct:3,tgtid:config.target.did,tgtt:3});}var rwbViewer=microstrategy.getViewerBone(),params={taskId:"mojoRWManipulation",style:"RWIVEMojoStyle",messageID:rwbViewer.messageID,stateID:-1,params:JSON.stringify(actions),rwb:document.getElementsByName("rwb")[0].value};mstr.$XHR.request(mstrConfig.taskURL,params,{success:function(res){var um=microstrategy.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[])]);um.flushAndSubmitChanges();},failure:function(res){mstrmojo.alert(res);}});};roEditor.onOk=applyReconciliationFunction;roEditor.onClose=function(){roEditor.tooltip&&roEditor.tooltip.hideTooltip();roEditor.destroy();};roEditor.open();};var generateWorkingSetObjects=function generateWorkingSetObjects(dataset){var workingSet=[].concat(dataset.att.concat(dataset.mx));mstr.$A.forEach(workingSet,function(unit){if(unit.hc){unit.cont_did=dataset.did;unit.cont_tp=dataset.type;}});return mstr.$A.filter(workingSet,{umCheck:function(obj){return !obj.um;}},"umCheck");};var workingSetObjects=generateWorkingSetObjects(workingset);openReplaceObjectEditor({source:source,target:{did:workingset.did,units:workingSetObjects},});};mstrDocImpl.prototype.getTargetDataSet=function(datasets,units,info){var me=this,sourceDSID=info.oldDSID,targetDSID=info.items[0].did||info.items[0].dssid,targetDataset=datasets[targetDSID],source={did:sourceDSID,units:units};if(targetDataset){targetDataset=mstr.$H.clone(targetDataset);targetDataset.did=targetDSID;me.openReplaceObjectEditor(source,targetDataset,info,datasets);}else{mstr.$XHR.request(mstrConfig.taskURL,{taskId:"mojoGetReportWorkingSet",reportId:targetDSID},{success:function(workingset){me.openReplaceObjectEditor(source,workingset,info,datasets);},failure:function(res){mstrmojo.alert(res);}});}};mstrDocImpl.prototype.getManifest=function(info){var me=this,rwbViewer=microstrategy.getViewerBone(),datasets=rwbViewer.datasetInfos,dsid=info.oldDSID,params={taskId:"mojoGetDocumentManifest",style:"RWIVEMojoStyle",messageID:rwbViewer.messageID,stateID:-1,rwb:""},getDatasetInfo=function(indexArray){var datasets=[],index=1;for(var did in datasets){var dataset=datasets[did];mstr.$A.forEach(indexArray,function(inx){if(index===parseInt(inx,10)){datasets.push(dataset);}});index++;}return datasets;};if(dsid){params.dsid=dsid;}mstr.$XHR.request(mstrConfig.taskURL,params,{success:function(manifest){var units=[],all_units={},all_manifest_units={};for(var did in datasets){var dataset=datasets[did];mstr.$A.forEach(dataset.att.concat(dataset.mx),function(unit){all_units[unit.did]=unit;});}manifest.manifest_objects.forEach(function(obj){var manifestObj=all_units[obj.did];if(manifestObj){obj.cubes=getDatasetInfo(obj.cube_ids||[]);for(var prop in manifestObj){obj[prop]=manifestObj[prop];}units.push(obj);all_manifest_units[obj.did]=obj;}});manifest.manifest_objects.forEach(function(obj){if(obj.dependents){obj.dependentObjects=[];obj.dependents.forEach(function(objID){obj.dependentObjects.push(all_manifest_units[objID]);});}});getSortedDatasetUnits=function(units){var getPriority=function getPriority(unit){return unit.t===4?2:1;};units=units.concat();units.sort(function(a,b){var typeCmpResult=getPriority(a)-getPriority(b),upperA=a.n.toUpperCase(),upperB=b.n.toUpperCase();return typeCmpResult!==0?typeCmpResult:(upperA!==upperB?upperA.localeCompare(upperB):a.n.localeCompare(b.n));});return units;};units=getSortedDatasetUnits(units);me.getTargetDataSet(datasets,units,info);},failure:function(res){mstrmojo.alert(res);}});};mstrDocImpl.prototype.handleDatasetExplorer=function(info){if(info.ReplaceAllDS||(info.oldDSID&&info.oldDSID.length>0)){var me=this,checkSession=function(){var callback={success:function(res){if(res){me.getManifest(info);}else{if(mstrApp.onSessionExpired){mstrApp.onSessionExpired();}}}},params={taskId:"keepSessionAlive"};mstrmojo.xhr.request("POST",mstrConfig.taskURL,callback,params);};var getCss=function(){microstrategy.cssLoader.get("vi-base-themes.css",true,checkSession);};var getJSBundle=function(){microstrategy.mojoLoader.loadWidget({bundle:"mojo-dre.js",callback:getCss});};microstrategy.descriptorsLoader.loadDescriptors({bundle:"mojo-dre",callback:getJSBundle});return ;}try{var um=microstrategy.updateManager;var datasets=info.items;var ids="";var d="";for(var i=0;i<datasets.length;i++){ids+=d+(datasets[i].dssid||datasets[i].did);d=mstrUpdateManager.ITEM_SEPARATOR;}var cubeIds=[];for(i=0;i<datasets.length;i++){cubeIds.push(datasets[i].dssid||datasets[i].did);}microstrategy.getCubesInfo(cubeIds,function(cubesInfo){if(info.oldDSID&&info.oldDSID.length>0||info.ReplaceAllDS){var dataset=datasets[0],type=dataset.tp||dataset.t,dssid=dataset.dssid||dataset.did,cubeInfo=cubesInfo[dssid];um.add([um.createActionObject(null,mstrUpdateManager.RW_REPLACE_DATASET,mstrUpdateManager.applyChangesBeanPath,["2048216","2048217","2048218","2048219","2048018"],[microstrategy.getViewerBone().hasMultiDatasets()?info.oldDSID:"",dssid,info.oldDSType,type,mstrUpdateManager.UPDATE_LATER],[],null)]);}else{var type=(datasets[0].tp||datasets[0].t);um.add([um.createActionObject(null,mstrUpdateManager.RW_ADD_DATASET,mstrUpdateManager.applyChangesBeanPath,["2048032","2048033","2048018"],[ids,type,mstrUpdateManager.UPDATE_LATER],[],null)]);}um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[])]);um.flushAndSubmitChanges();});}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getHTMLFieldValues=function(obj,newValue){try{var so=this.styleObj;var rslt={};if(newValue==null){newValue="";}var att=(so.getAttValue(obj,microstrategy.HTMLATTR_HTML_TYPE)==microstrategy.HTML_CONTAINER_TYPE_HTML)?"TEXT":"SOURCE";var oldValue=decode(so.getAttValue(obj,microstrategy["HTMLATTR_HTML_"+att]),true);if(oldValue==null){oldValue="";}rslt.oldValue=oldValue;rslt.saveValue=newValue;rslt.hasChanged=(rslt.oldValue!=rslt.saveValue);rslt.attributeValue=encode(rslt.saveValue,true);rslt.displayValue=rslt.attributeValue.replace(/\r\n/g,"<br />");return rslt;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocImpl.prototype.addItem=function(text,subsection,subtype,objInfo,ac,ctrlInfo){try{microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;var i,bone,ctrlId,cb;var so=this.styleObj;var cst=this.currentControlSubtype;var isNavigationBar=subtype==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK&&cst==microstrategy.CONTROLSUBTYPE_NAVIGATION_BAR;var isTableControl=(subtype==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK)&&(cst=="TC");var id=microstrategy.OBJ_PREFIX+this.parentBone.getNextObjId();if(subsection.parentBone.isCollapsed){subsection.parentBone.toggleSections(1);}var span=document.createElement("span");span.setAttribute(microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_OBJECT);span.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,subtype);span.setAttribute("id",id);span.setAttribute("name",id);if(subtype==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK&&this.currentControlSubtype=="FP"){so.setAttValue(span,microstrategy.HTMLATTR_NAME,microstrategy.descriptors.getDescriptor("2550")+id.substr(id.indexOf(microstrategy.OBJ_PREFIX)+microstrategy.OBJ_PREFIX.length));}else{if(isTableControl){so.setAttValue(span,microstrategy.HTMLATTR_NAME,"Table Control"+id.substr(id.indexOf(microstrategy.OBJ_PREFIX)+microstrategy.OBJ_PREFIX.length));}else{if(isNavigationBar){so.setAttValue(span,microstrategy.HTMLATTR_NAME,microstrategy.descriptors.getDescriptor("8145")+id.substr(id.indexOf(microstrategy.OBJ_PREFIX)+microstrategy.OBJ_PREFIX.length));}else{if(this.isDocButtonType(subtype,cst)){so.setAttValue(span,microstrategy.HTMLATTR_NAME,microstrategy.descriptors.getDescriptor("6457")+id.substr(id.indexOf(microstrategy.OBJ_PREFIX)+microstrategy.OBJ_PREFIX.length));}else{so.setAttValue(span,microstrategy.HTMLATTR_NAME,this.getName(subtype,id));}}}}span.className="object";if(objInfo.dssId){span.setAttribute(microstrategy.HTMLATTR_DSS_ID,objInfo.dssId);}if(objInfo.dssType){span.setAttribute(microstrategy.HTMLATTR_DSS_TYPE,objInfo.dssType);}if(objInfo.dSetId){span.setAttribute(microstrategy.HTMLATTR_DSS_SET,objInfo.dSetId);}span.style.position="absolute";span.style.overflow="hidden";span.style.left=objInfo.left+"px";span.style.top=objInfo.top+"px";mstr.utils.Dom.setBGIconClass(span,"1ptrans");if(subtype==microstrategy.SUBOBJTYPE_DOC_LINE&&objInfo[microstrategy.HTMLATTR_ORIENTATION]!=null){so.setAttValue(span,microstrategy.HTMLATTR_ORIENTATION,objInfo[microstrategy.HTMLATTR_ORIENTATION]);}if(subtype==microstrategy.SUBOBJTYPE_DOC_SHAPE&&(this.currentControlSubtype=="1")){so.setAttValue(span,microstrategy.HTMLATTR_STYLE,microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND);}span=this.parentBone.objProps.initObjectFormat(span,true);if(isTableControl){var f=microstrategy.getFormatObject();span.style.width="318px";microstrategy.styleObj.setAttValue(span,f.getAttrNameFromStyle("width"),f.encodeValue("width","320px"));}if(subsection.isFilterPanel&&this.currentControlSubtype==mstrRWControlImpl.CTL_STYLE_METRIC_SLIDER){var minHeight=84,currentHeight=parseInt(span.style.height,10);if(currentHeight<minHeight){var fo=microstrategy.getFormatObject(),propName="height";so.setAttValue(span,fo.getAttrNameFromStyle(propName),fo.encodeValue(propName,minHeight));so.setValue(span,propName,minHeight+"px");}}if(subtype==microstrategy.SUBOBJTYPE_DOC_TEXT){so.setAttValue(span,microstrategy.HTMLATTR_DSS_FORMULA,text);text=encode(text);span.innerHTML=text;}else{if(typeof (text)=="string"){text=document.createTextNode(text);}if(subtype==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var titlebarDiv;if(so.getAttValue(span,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE)==microstrategy.TRUE){titlebarDiv=this.createTitleBar(objInfo.dSetName);span.appendChild(titlebarDiv);}}span.appendChild(text);}so.setAttValue(span,microstrategy.HTMLATTR_OBJTYPE,subtype);if(subtype==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){span.style.overflow="visible";}if(objInfo.width!=null&&!isNaN(parseInt(objInfo.width,10))){so.setValue(span,"width",objInfo.width+"px");}if(objInfo.height!=null&&!isNaN(parseInt(objInfo.height,10))){so.setValue(span,"height",objInfo.height+"px");}if(objInfo.dssType==microstrategy.DSSTYPE_METRIC||objInfo.dssType==microstrategy.DSSTYPE_USER_METRIC||objInfo.dssType==microstrategy.DSSTYPE_USER_SUMMARY_METRIC){span.style.textAlign="right";}switch(subtype){case microstrategy.SUBOBJTYPE_DOC_TEMPLATE:span.setAttribute(microstrategy.HTMLATTR_SHOW_WINDOW_TITLE,"0");span.setAttribute(microstrategy.HTMLATTR_WINDOW_STATE,"0");break;case microstrategy.SUBOBJTYPE_DOC_LINE:this.fixLineItem(span,subtype);objInfo.width=span.style.width;objInfo.height=span.style.height;break;case microstrategy.SUBOBJTYPE_DOC_SHAPE:this.fixShapeItem(span);break;case microstrategy.SUBOBJTYPE_DOC_IMAGE:span.getElementsByTagName("IMG")[0].setAttribute("id",id+"_img");span.getElementsByTagName("IMG")[0].setAttribute("name",id+"_img");so.setAttValue(span,microstrategy.HTMLATTR_HEIGHT,mstrFormatObject.encodeValue("height",objInfo.height));so.setAttValue(span,microstrategy.HTMLATTR_WIDTH,mstrFormatObject.encodeValue("width",objInfo.width));so.setAttValue(span,microstrategy.HTMLATTR_LOCK_ASPECT_RATIO,microstrategy.TRUE);span.setAttribute(microstrategy.HTMLATTR_SECTION_ID,subsection.id);span.setAttribute(microstrategy.HTMLATTR_DTOP,objInfo.top);span.setAttribute(microstrategy.HTMLATTR_DLEFT,objInfo.left);span.setAttribute(microstrategy.HTMLATTR_DHEIGHT,objInfo.height);span.setAttribute(microstrategy.HTMLATTR_DWIDTH,objInfo.width);break;}span.style.zIndex=subsection.maxZindex++;subsection.setNeedToUpdateMaxContentHeight(true);if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE&&(subtype==microstrategy.SUBOBJTYPE_DOC_TEXT||subtype==microstrategy.SUBOBJTYPE_DOC_IMAGE||subtype==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER||subtype==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK||subtype==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL)){var useFake=(!span.style.borderWidth||parseInt(span.style.borderWidth)==0);if(useFake){span.style.border=microstrategy.DESIGNMODE_NOBORDER_STYLE;}so.setAttValue(span,microstrategy.HTMLATTR_BORDER,microstrategy[((useFake)?"NO":"HAS")+"_BORDER"]);var that=this;var fn=function(d){if(objInfo[d]){so.setValue(span,d,that.removePaddingAndBorder(span,objInfo[d],d)+"px");}else{if(useFake){span.style[d]=Math.max(parseInt(span.style[d])-2,0)+"px";}}};if(this.isDocButtonType(subtype,cst)){var wd=so.getAttValue(span,microstrategy.HTMLATTR_WIDTH);var ht=so.getAttValue(span,microstrategy.HTMLATTR_HEIGHT);fn("width");fn("height");so.setAttValue(span,microstrategy.HTMLATTR_WIDTH,wd);so.setAttValue(span,microstrategy.HTMLATTR_HEIGHT,ht);}else{fn("width");fn("height");}}var fc=span.firstChild;switch(subtype){case microstrategy.SUBOBJTYPE_DOC_TEMPLATE:var item=span.cloneNode(true);var grid=microstrategy.subObjectFind(item,"div",microstrategy.SUBOBJTYPE_GRID_TABLE);var portal=microstrategy.findChildWithAtt(item,"div",microstrategy.HTMLATTR_SCRIPTCLASS,"mstrPortalImpl");var isGrid=true;if(objInfo&&objInfo.dssSubType){isGrid=(objInfo.dssSubType==microstrategy.DSSTYPE_GRID||objInfo.dssSubType==microstrategy.DSSTYPE_GRID_AND_GRAPH);}var isWidget=(ctrlInfo!=null&&"widgetName" in ctrlInfo);so.setAttValue(item,"twc",((isWidget)?ctrlInfo.widgetClass:"None"));so.setAttValue(item,"rsl",(isWidget)?ctrlInfo.widgetRSL:"");so.setAttValue(item,"iap",(isWidget)?ctrlInfo.widgetIsApp:false);for(i=0;i<subsection.sibs.length;i++){var gridId="grid_"+id+"_"+i;item.setAttribute(microstrategy.HTMLATTR_APPLIES_TO,gridId);grid.setAttribute("id",gridId);var portalID="portal_"+gridId;if(portal){portal.setAttribute("id",portalID);portal.setAttribute("name",portalID);}subsection.sibs[i].appendChild(item.cloneNode(true));if(portal){var portalBone=microstrategy.registerBone(portalID,"(true)",null);portalBone.onload();}bone=microstrategy.registerBone(gridId,"(true)",null);bone.beanPath=this.parentBone.beanPath+"."+id;bone.gridCellCssPrefix=this.parentBone.gridCellCssPrefix;bone.isGraph=(objInfo&&(objInfo.dssSubType==microstrategy.DSSTYPE_GRAPH||objInfo.dssSubType==microstrategy.DSSTYPE_GRID_AND_GRAPH));bone.isGrid=isGrid;bone.isWidget=isWidget;bone.widgetDescription=(isWidget)?ctrlInfo.widgetName:null;bone.widgetPreviewSrc=(isWidget)?ctrlInfo.widgetPreviewSrc:null;bone.dSetName=(objInfo.dSetName)?objInfo.dSetName:"";bone.onload();bone.onpostload();if(portal){bone.updatePortalTitle();}}break;case microstrategy.SUBOBJTYPE_DOC_PANEL_STACK:var scriptClass="mstrPanelStack";if(cst==microstrategy.CONTROLSUBTYPE_NAVIGATION_BAR){scriptClass="mstrNavigationBar";}else{if(cst=="TC"){scriptClass="mstrTableControl";}}span.setAttribute(microstrategy.HTMLATTR_SCRIPTCLASS,scriptClass);span.className+=" panelStack";var psContainer=span.appendChild(document.createElement("div"));psContainer.setAttribute("id",id+"_content");psContainer.style.position="absolute";if(bIsIE7){psContainer.style.position="relative";window.setTimeout(function(){var myContainer=document.getElementById(id+"_content");if(myContainer){myContainer.style.position="absolute";}},0);}psContainer.style.overflow="hidden";psContainer.style.width="100%";var t=psContainer.appendChild(document.createElement("div"));t.className="title_"+id;t.setAttribute("id",id+"_toolbar");t.setAttribute("name",id+"_toolbar");t.style.height=microstrategy.WINDOW_TITLE_HEIGHT+"px";t=this.parentBone.objProps.initObjectFormat(t,true,microstrategy.subObjectType(span),mstrPanelStack.FMT_TYPE_TITLE);mstr.utils.Dom.setBGIconClass(t,"1ptrans");var tbl=document.createElement("table");t.appendChild(tbl);tbl.className="pane";tbl.cellSpacing=0;tbl.cellPadding=0;tbl.style.height="100%";var tr=tbl.insertRow(-1);var td=tr.insertCell(-1);td.className="titleTD";var titleDiv=td.appendChild(document.createElement("div"));titleDiv.setAttribute("id","titleBar");titleDiv.setAttribute("name","titleBar");titleDiv.className="titleBar";var c=psContainer.appendChild(document.createElement("div"));c.setAttribute("id",id+"_container");c.setAttribute("name",id+"_container");c.className="panels";c.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_PANEL_CONTAINER);c.appendChild(this.createPanel());for(i=0;i<subsection.sibs.length;i++){subsection.sibs[i].appendChild(span.cloneNode(true));}insertDynamicScript(scriptClass+"Script",javaScriptPath+scriptClass+".js");var psProps=null;if(this.currentControlSubtype=="FP"){so.setAttValue(span,microstrategy.HTMLATTR_USE_AS_FILTER_PANEL,microstrategy.TRUE);}else{if(isNavigationBar){so.setAttValue(span,microstrategy.HTMLATTR_USE_AS_NAVIGATION_BAR,microstrategy.TRUE);}else{if(this.currentControlSubtype=="TC"){so.setAttValue(span,microstrategy.HTMLATTR_USE_AS_TABLE_CONTROL,microstrategy.TRUE);so.setAttValue(span,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE,microstrategy.FALSE);psProps={def:"",fmt:""};}}}bone=microstrategy.registerBone(id,scriptClass+"Script",psProps);bone.onload();bone.onpostload();break;case microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL:ctrlId=id+"_Ctl";fc.setAttribute("id",ctrlId);fc.setAttribute(microstrategy.HTMLATTR_SCRIPTCLASS,"mstrRWControlImpl");fc.setAttribute("name",ctrlId);so.setAttValue(span,microstrategy.HTMLATTR_STYLE,this.currentControlSubtype);insertDynamicScript("mstrRWControlImplScript",javaScriptPath+"mstrRWControlImpl.js");var orientation=this.getSelectorOrientation(objInfo,subsection);for(i=0;i<subsection.sibs.length;i++){subsection.sibs[i].appendChild(span.cloneNode(true));}var multiSelect=(cst==mstrRWControlImpl.CTL_STYLE_BUTTON_ARRAY||cst==mstrRWControlImpl.CTL_STYLE_LIST_BOX||cst==mstrRWControlImpl.CTL_STYLE_CHECKBOX||cst==mstrRWControlImpl.CTL_STYLE_SEARCH_BOX),orientation=cst==mstrRWControlImpl.CTL_STYLE_METRIC_QUALIFICATION||cst==mstrRWControlImpl.CTL_STYLE_METRIC_SLIDER?"1":orientation;cb=microstrategy.registerBone(ctrlId,"mstrRWControlImplScript",{ctlKey:id,ctlType:this.currentControl_SelectorControlType||"1",ctlStyle:this.currentControlSubtype,ctlOrientation:orientation,multiSelect:multiSelect,showAll:true,autoSync:false});cb.onload(ctrlInfo);cb.onpostload();cb.renderPreview();break;case microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER:ctrlId=id+"_Ctr";fc.setAttribute("id",ctrlId);fc.setAttribute(microstrategy.HTMLATTR_SCRIPTCLASS,"mstrHTMLContainerImpl");fc.setAttribute("name",ctrlId);insertDynamicScript("mstrHTMLContainerImplScript",javaScriptPath+"mstrHTMLContainerImpl.js");for(i=0;i<subsection.sibs.length;i++){subsection.sibs[i].appendChild(span.cloneNode(true));}cb=microstrategy.registerBone(ctrlId,"mstrHTMLContainerImplScript",null);cb.onload();cb.onpostload();break;case microstrategy.SUBOBJTYPE_DOC_SHAPE:var isRound=(this.currentControlSubtype=="1");if(isRound){span.setAttribute(microstrategy.HTMLATTR_SCRIPTCLASS,"mstrRoundedRectangle");}so.setAttValue(span,microstrategy.HTMLATTR_ROUNDED_CORNERS,(isRound)?microstrategy.TRUE:microstrategy.FALSE);for(i=0;i<subsection.sibs.length;i++){subsection.sibs[i].appendChild(span.cloneNode(true));}if(this.currentControlSubtype=="1"){so.setAttValue(span,microstrategy.HTMLATTR_STYLE,microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND);insertDynamicScript("mstrRoundedRectangleScript",javaScriptPath+"mstrRoundedRectangle.js");microstrategy.registerBone(id,"mstrRoundedRectangleScript",null).onload();}break;case microstrategy.SUBOBJTYPE_DOC_TEXT:if(this.isDocButtonType(subtype,cst)){so.setAttValue(span,microstrategy.HTMLATTR_DISPLAY_STYLE,cst);span.setAttribute(microstrategy.HTMLATTR_SCRIPTCLASS,"mstrButton");insertDynamicScript("mstrButtonScript",javaScriptPath+"mstrButton.js");mstrButton.initHTML(span);for(i=0;i<subsection.sibs.length;i++){subsection.sibs[i].appendChild(span.cloneNode(true));}microstrategy.registerBone(id,"mstrButtonScript",null).onload();break;}default:for(i=0;i<subsection.sibs.length;i++){subsection.sibs[i].appendChild(span.cloneNode(true));}}var gv=span.getAttribute("gradientcolor");if(gv){if((span.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_SUBSECTION&&span.getAttribute("scriptclass")!="mstrPanel")||(subtype==microstrategy.SUBOBJTYPE_DOC_SHAPE&&span.getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND)){var selectedBone=(span.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_SUBSECTION)?this.getChildBone(span):microstrategy.bone(span.id);selectedBone.applyGradient();}else{var objs=document.getElementsByName(span.getAttribute("id"));var gs=gv.split(",");for(i=0;i<objs.length;i++){gradientUtil.applyGradientSettings(objs[i],gs,so);}}}this.updatePanelCM(subsection);return subsection.sibs[0].lastChild;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.getSelectorOrientation=function(objInfo,subsection){var orientation=this.getOrientationConstraint(subsection);if(orientation==null){if(objInfo){if(objInfo.height){if(objInfo.width&&objInfo.width>=objInfo.height){orientation=mstrRWControlImpl.ORIENTATION_HORIZONTAL;}else{orientation=mstrRWControlImpl.ORIENTATION_VERTICAL;}}else{if(objInfo.width){orientation=mstrRWControlImpl.ORIENTATION_HORIZONTAL;}}}}if(orientation==null){orientation=mstrRWControlImpl.ORIENTATION_VERTICAL;}return orientation;};mstrDocImpl.prototype.getOrientationConstraint=function(subsection){var $RWCTRL=mstrRWControlImpl;switch(this.currentControlSubtype){case $RWCTRL.CTL_STYLE_POOL_DOWN:case $RWCTRL.CTL_STYLE_LIST_BOX:return $RWCTRL.ORIENTATION_VERTICAL;break;case $RWCTRL.CTL_STYLE_CHECKBOX:case $RWCTRL.CTL_STYLE_RADIO_BUTTON:case $RWCTRL.CTL_STYLE_LINK_ARRAY:case $RWCTRL.CTL_STYLE_BUTTON_ARRAY:if(subsection.isFilterPanel){return $RWCTRL.ORIENTATION_VERTICAL;}break;}return null;};mstrDocImpl.prototype.createPanel=function(){try{var p=document.createElement("div");var nextObjId=this.parentBone.getNextObjId();var secId=microstrategy.OBJ_PREFIX+nextObjId;var n=microstrategy.descriptors.getDescriptor("4780")+nextObjId;p.setAttribute("id",secId);p.setAttribute("name",secId);p.setAttribute(microstrategy.HTMLATTR_NAME,n);p.setAttribute(microstrategy.HTMLATTR_WINDOW_TITLE,n);p.setAttribute(microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_SUBSECTION);p.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_DOC_PANEL);p.setAttribute(microstrategy.HTMLATTR_SCRIPTCLASS,"mstrPanel");p.className+=" panel";this.parentBone.objProps.initObjectFormat(p,true,microstrategy.SUBOBJTYPE_DOC_PANEL);var panelCaptureArea=document.createElement("div");panelCaptureArea.style.height="100%";p.appendChild(panelCaptureArea);return p;}catch(err){microstrategy.errors.log(err);}return null;};mstrDocImpl.prototype.fixLineItem=function(span,subtype){try{if(subtype==microstrategy.SUBOBJTYPE_DOC_LINE){var or=parseInt(this.styleObj.getValue(span,"width"))>=parseInt(this.styleObj.getValue(span,"height"))?"HORIZONTAL":"VERTICAL";this.setLineOrientation(span,microstrategy["ORIENTATION_"+or]);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.fixShapeItem=function(span){try{if(this.currentControlSubtype=="0"){var f=mstrFormatObject;var so=this.styleObj;var aux=so.getAttValue(span,"b3dstyle");if(aux==null||parseInt(aux)==0){span.style.border=(f.decodeValue("lineStyle",so.getAttValue(span,"ls"))||"solid")+" "+(f.decodeValue("lineColor",so.getAttValue(span,"lc")||0))+" "+parseInt(f.decodeValue("lineWeight",so.getAttValue(span,"lw"))||1,10)+"pt";}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.addItemsToSubsection=function(subsection,item,isNew,srcItem,oldSubSec){try{var id;var us={};var bWire={control:false,target:false};var returnObj=null;if(subsection){var subSec=microstrategy.findBone(subsection);if(isNew){id=this.parentBone.getNextObjId();item.setAttribute("id",microstrategy.OBJ_PREFIX+id);item.setAttribute("name",microstrategy.OBJ_PREFIX+id);item.style.zIndex=subSec.maxZindex;}subSec.maxZindex++;subSec.setNeedToUpdateMaxContentHeight(true);var objs=document.getElementsByName(subsection.getAttribute("id"));var st=microstrategy.subObjectType(item);if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){mstrDocImpl.updateSectionList(us,subSec,bWire,true);objs[0].appendChild(item);if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE){id=item.getAttribute("id");var grid=microstrategy.subObjectFind(item,"div",microstrategy.SUBOBJTYPE_GRID_TABLE)||microstrategy.subObjectFind(item,"div",microstrategy.SUBOBJTYPE_DOC_GRAPH_TEMPLATE);if(grid!=null){var gridId=grid.getAttribute("id");var portal=microstrategy.findChildWithAtt(item,"div",microstrategy.HTMLATTR_SCRIPTCLASS,"mstrPortalImpl");if(isNew){gridId="grid_"+id+"_0";var portalID="portal_"+gridId;grid.setAttribute("id",gridId);if(srcItem&&this.parentBone.gridItemFormats){this.parentBone.gridItemFormats[id]=this.parentBone.objProps.cloneFormats(this.parentBone.gridItemFormats[srcItem.id]);}if(portal){portal.setAttribute("id",portalID);portal.setAttribute("name",portalID);}loadInit("mstrGridRWScript",'microstrategy.registerBone("'+gridId+'", "(true)", { beanPath : \''+this.parentBone.beanPath+"."+id+"' });");loadInit('mstrGridRWScript && microstrategy.bone("'+gridId+'") != null','microstrategy.bone("'+gridId+'").onload();');loadInit('mstrGridRWScript && microstrategy.bone("'+gridId+'") != null','microstrategy.bone("'+gridId+'").gridCellCssPrefix = "'+this.parentBone.gridCellCssPrefix+'";');if(portal){loadInit("mstrPortalImplScript",'microstrategy.registerBone("'+portalID+'", "(true)", null);');loadInit('mstrPortalImplScript && microstrategy.bone("'+portalID+'") != null','microstrategy.bone("'+portalID+'").onload();');}}else{loadInit('mstrGridRWScript && microstrategy.bone("'+gridId+'") != null','microstrategy.bone("'+gridId+'").beanPath = "'+this.parentBone.beanPath+"."+id+'"; microstrategy.bone("'+gridId+'").onload();');loadInit('mstrGridRWScript && microstrategy.bone("'+gridId+'") != null','microstrategy.bone("'+gridId+'").gridCellCssPrefix = "'+this.parentBone.gridCellCssPrefix+'";');}}}this.updatePanelCM(subSec);this.updatePanelCM(oldSubSec);returnObj=objs[0].lastChild;}else{if(st==microstrategy.SUBOBJTYPE_DOC_IMAGE){item.getElementsByTagName("IMG")[0].setAttribute("id",item.id+"_img");}var newNode=null,len=objs.length;for(var i=0;i<len;i++){newNode=item.cloneNode(true);objs[i].appendChild(newNode);}var ctl,srcBone;if(st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){if(!isNew){var psBone=microstrategy.bone(item.id);if(!psBone.isTable){psBone.resetElement();psBone.onload();psBone.getCurrentPanel().clearContentsMenu();psBone.getCurrentPanel().updateContentsMenu();mstrDocImpl.updateSectionList(us,subSec,bWire,true);}}}else{if(st==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){if(isNew){ctl=document.getElementById(item.id);if(srcItem){this.styleObj.cloneAttValues(srcItem,item);srcBone=microstrategy.bone(srcItem.id+"_Ctl");srcBone.initNewUnit(ctl);}}else{if(item&&newNode){var selItem=item.getElementsByTagName("select");var selNewNode=newNode.getElementsByTagName("select");if(selItem&&selItem.length>0&&selNewNode&&selNewNode.length>0){selNewNode[0].selectedIndex=selItem[0].selectedIndex;}}microstrategy.bone(item.id+"_Ctl").onSectionChange();}mstrDocImpl.updateSectionList(us,subSec,bWire);}else{if(st==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){if(isNew){ctl=document.getElementById(item.id);if(srcItem){srcBone=microstrategy.bone(srcItem.id+"_Ctr");srcBone.initNewUnit(ctl);}}}else{if(st==microstrategy.SUBOBJTYPE_DOC_SHAPE&&item.getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){if(isNew){ctl=document.getElementById(item.id);if(srcItem){this.styleObj.cloneAttValues(srcItem,item);}srcBone=microstrategy.bone(srcItem.id);if(srcBone){srcBone.initNewUnit(ctl);}else{this.initRoundedRectangle(item.id);}}}else{if(st==microstrategy.SUBOBJTYPE_DOC_TEXT&&isNew&&this.isDocButton(srcItem)){microstrategy.registerBone(item.id,"mstrButtonScript",null).onload();}}}}}this.updatePanelCM(subSec);this.updatePanelCM(oldSubSec);returnObj=newNode;}if((bWire.control||bWire.target)&&this.parentBone.autoWire&&this.undoRedoSubSections!=null){for(var id in us){this.undoRedoSubSections.push(us[id]);}}}return returnObj;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocImpl.prototype.updatePanelCM=function(subSecBone){if(subSecBone&&microstrategy.subObjectType(subSecBone.elem)==microstrategy.SUBOBJTYPE_DOC_PANEL){subSecBone.updateContentsMenu();}};mstrDocImpl.prototype.restoreDeletedItems=function(subsection,items){try{var sections=document.getElementsByName(subsection.getAttribute("id"));for(var i=0;i<items.length;i++){var item=items[i];sections[i].appendChild(item);if(microstrategy.subObjectType(item)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var gridBone=microstrategy.findBone(item);if(gridBone){gridBone.onload();}}var attCol=this.formattingAttributes[item.id];attCol.deleted=false;}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatUnderlineStrikeout=function(items,prop,value,ac){try{var uValue,sValue;var styles=value.split(",");var v=parseInt(styles[0],10);if(styles.length==1){if(v&4){uValue=(v>0);sValue=-1;}else{uValue=-1;sValue=(v>0);}}else{uValue=((v&4)&&(v>0));v=parseInt(styles[1],10);sValue=((v&8)&&(v>0));}var zu="underline";var zl="line-through";var td1="textDecoration";var td2="textDecoration2";for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs&&this.checkAppliesTo(items[item],prop)){var ouValue=this.styleObj.getValue(items[item],td1,microstrategy.formatType);ouValue=ouValue!=undefined?(ouValue.indexOf(zu)>-1):false;var osValue=this.styleObj.getValue(items[item],td2,microstrategy.formatType);osValue=osValue!=undefined?(osValue.indexOf(zl)>-1):false;if(this.styleObj.doTextDecOnBone(items[item])){var controlBone=microstrategy.findBone(items[item]);ouValue=controlBone[td1];ouValue=ouValue!=undefined?(ouValue.indexOf(zu)>-1):false;osValue=controlBone[td2];osValue=osValue!=undefined?(osValue.indexOf(zl)>-1):false;}var nuValue=(uValue==-1)?ouValue:uValue;var nsValue=(sValue==-1)?osValue:sValue;if(ac){var um=this.parentBone.updateManager;if(nuValue!=ouValue){ac.push(um.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[td1],[(nuValue)?zu:""],[(ouValue)?zu:""]));}if(nsValue!=osValue){ac.push(um.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[td2],[(nsValue)?zl:""],[(osValue)?zl:""]));}}value="";if(microstrategy.subObjectType(objs[0])==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){if(!(nuValue||nsValue)){value="none";}else{if(nuValue){value+=zu;if(nsValue){value+=" ";}}if(nsValue){value+=zl;}}}for(var j=0;j<objs.length;j++){this.styleObj.setValue(objs[j],td1,(nuValue)?zu:"none");this.styleObj.setValue(objs[j],td2,(nsValue)?zl:"none");if(value&&microstrategy.formatType==microstrategy.FORMAT_TYPE_MAIN){this.styleObj.cascadeSelectorValue(objs[j],td1,value);}}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.renamePanel=function(){try{var msgBone=microstrategy.bones.msgBox;if(msgBone.getInputValue()&&this.commands.queryEnabled("onepanelstack")){var panelStack=microstrategy.findBone(this.commands.queryState("selectedPanelStack"));if(panelStack){this.formatAttribute({0:panelStack.getCurrentPanel().elem},"windowTitle",msgBone.getInputValue(),true,microstrategy.HTMLATTR_WINDOW_TITLE,null);panelStack.getCurrentPanel().elem.setAttribute("wt",msgBone.getInputValue());microstrategy.eventManager.notifyOrphanBones("onpanelchange");this.parentBone.delay("observer.notifyAll('onselectionchange')");}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatPadding=function(items,prop,value,update,ac){try{var passOut=(ac!=null);if(update||passOut){if(!passOut){ac=[];}}var f=microstrategy.getFormatObject(),so=this.styleObj,um=this.parentBone.updateManager,bp=this.parentBone.beanPath,data,oldData,oldValue,value;var fnEncode=function(v){return microstrategy.number.toLocaleString(f.encodeValue(prop,microstrategy.number.toLocaleString(value)));};mstr.$A.forEach(items,function(item){var id=item.id;if(!this.checkAppliesTo(item,prop)){return ;}data=id+mstrUpdateManager.UNIT_SEPARATOR+f.getPropertySetName(prop)+mstrUpdateManager.UNIT_SEPARATOR+f.getPropertyName(prop)+mstrUpdateManager.UNIT_SEPARATOR;oldValue=fnEncode(so.getValue(item,prop));ac.push(um.createActionObject(item,mstrUpdateManager.EDIT_PROPS,bp,["2048018","2048035"],[mstrUpdateManager.UPDATE_LATER,data+fnEncode(value)+mstrUpdateManager.ITEM_SEPARATOR],[mstrUpdateManager.UPDATE_LATER,data+oldValue+mstrUpdateManager.ITEM_SEPARATOR]));mstr.$A.forEach(document.getElementsByName(id),function(obj){so.setValue(obj,prop,value);});},this);if(!passOut&&update&&ac&&ac.length>0){um.add(ac);}return(passOut)?ac:null;}catch(err){microstrategy.errors.log(err);return(ac!=null)?ac:false;}};mstrDocImpl.prototype.formatItems=function(items,prop,value,update,ac,allPanels){try{var f=mstrFormatObject;var so=this.styleObj;var um=this.parentBone.updateManager;var passOut=(ac!=null);if(update||passOut){if(!passOut){ac=[];}}var i,subType,data,oldData,oldValue,bone;var ft=microstrategy.formatType;var bp=this.parentBone.beanPath;for(var item in items){var object=items[item];var subType=microstrategy.subObjectType(object);var panelStack=null;if(this.checkAppliesTo(object,prop)){if(subType==microstrategy.SUBOBJTYPE_DOC_LINE){var or=so.getAttValue(object,microstrategy.HTMLATTR_ORIENTATION);if((prop=="height"&&or==microstrategy.ORIENTATION_HORIZONTAL)||(prop=="height"&&or==microstrategy.ORIENTATION_HORIZONTAL)){continue;}}var objCollection=[];if((prop=="backgroundColor"||prop=="backgroundStyle"||prop=="Gradient")&&subType==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){panelStack=microstrategy.findBone(object);if(this.selections.panelUnitFormat==0){if(this.selections.panelValueFormat==0&&ft==microstrategy.FORMAT_TYPE_MAIN){object=panelStack.getCurrentPanel().elem;}objCollection.push(object);}else{if(panelStack.panels){for(var j=0;j<panelStack.panels.length;j++){objCollection.push(panelStack.panels[j].elem);}}}}else{objCollection.push(object);}for(var iterator in objCollection){var obj=objCollection[iterator];var objType=obj.getAttribute(microstrategy.HTMLATTR_OBJTYPE);subType=microstrategy.subObjectType(obj);var gradColor=this.getGradientColor(obj,ft);var id=obj.getAttribute("id");if(ac&&prop!="Gradient"&&prop!="selectionColor"&&prop!="selectionStyle"){if((prop!="backgroundColor"&&prop!="backgroundStyle")||(gradColor==null||gradColor=="")){var tempValue=value;var skipEncode=false;if(prop=="paddingLeft"||prop=="paddingTop"||prop=="paddingBottom"||prop=="paddingRight"){tempValue=microstrategy.number.toLocaleString(value);skipEncode=true;}ac.push(um.createEditPropsAction(obj,id,bp,[prop],[tempValue],[(prop=="backgroundStyle")?"transparent":so.getValue(obj,prop)],null,null,null,skipEncode));if(subType==microstrategy.SUBOBJTYPE_DOC_TEMPLATE&&bIsIE4){var grid=microstrategy.findBone(obj);if(grid&&grid.isGraph){ac.forceSubmit=true;}}}else{data=id+mstrUpdateManager.UNIT_SEPARATOR+f.getPropertySetName(prop)+mstrUpdateManager.UNIT_SEPARATOR+f.getPropertyName(prop)+mstrUpdateManager.UNIT_SEPARATOR;oldData=(prop=="backgroundColor")?id+mstrUpdateManager.UNIT_SEPARATOR+"Gradient"+mstrUpdateManager.UNIT_SEPARATOR:data;oldValue=gradColor;if(prop=="backgroundStyle"){oldValue="gradient";}ac.push(um.createActionObject(obj,mstrUpdateManager.EDIT_PROPS,bp,["2048018","2048035"],[mstrUpdateManager.UPDATE_LATER,data+f.encodeValue(prop,value)+mstrUpdateManager.ITEM_SEPARATOR],[mstrUpdateManager.UPDATE_LATER,oldData+oldValue+mstrUpdateManager.ITEM_SEPARATOR]));}}var tempProp=prop;if(prop=="backgroundStyle"&&value=="transparent"&&so.getValue(obj,"backgroundColor")=="transparent"&&gradColor==null){tempProp="backgroundColor";}var objs=document.getElementsByName(id);if(tempProp=="backgroundColor"&&ft==microstrategy.FORMAT_TYPE_MAIN){var bgstyleV=(value=="transparent")?1:0;for(i=0;i<objs.length;i++){objs[i].setAttribute("bgstyle",bgstyleV);if(objs[i].getAttribute("gradientcolor")){objs[i].removeAttribute("gradientcolor");}}if(objType==microstrategy.OBJTYPE_DOC_SUBSECTION&&obj.getAttribute("scriptclass")!="mstrPanel"){var sectionBone=this.getChildBone(obj);if(sectionBone){sectionBone.setSibsWithGradients(null);sectionBone.setGradientInfo(objs,null);}}}if(tempProp=="Gradient"){if(!bIsIE4&&!this.parentBone.isFeatureAvailable(microstrategy.FEATURE_IS_CLOUD)){showMessage({contents:microstrategy.descriptors.getDescriptor("9751"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING,zIndex:1001});}if(ft==microstrategy.FORMAT_TYPE_MAIN){if(gradColor==null){oldData=id+mstrUpdateManager.UNIT_SEPARATOR+f.getPropertySetName("backgroundColor")+mstrUpdateManager.UNIT_SEPARATOR+f.getPropertyName("backgroundColor")+mstrUpdateManager.UNIT_SEPARATOR;oldValue=f.encodeValue("backgroundColor",so.getValue(obj,"backgroundColor"));}else{oldData=id+mstrUpdateManager.UNIT_SEPARATOR+"Gradient"+mstrUpdateManager.UNIT_SEPARATOR;oldValue=gradColor;}var gs=value.split(",");if((objType==microstrategy.OBJTYPE_DOC_SUBSECTION&&obj.getAttribute("scriptclass")!="mstrPanel")||(subType==microstrategy.SUBOBJTYPE_DOC_SHAPE&&obj.getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND)){var selectedBone=(objType==microstrategy.OBJTYPE_DOC_SUBSECTION)?this.getChildBone(obj):microstrategy.bone(obj.id);if(selectedBone){if(objType==microstrategy.OBJTYPE_DOC_SUBSECTION){selectedBone.setSibsWithGradients(objs);selectedBone.setGradientInfo(objs,gs);}else{selectedBone.gradientColor={startingColor:gs[gradientUtil.GRADIENT_START_COLOR_INDEX],endingColor:gs[gradientUtil.GRADIENT_END_COLOR_INDEX],gradientAngle:gs[gradientUtil.GRADIENT_ANGLE_INDEX],gradientXOffset:gs[gradientUtil.GRADIENT_XOFFSET_INDEX],gradientYOffset:gs[gradientUtil.GRADIENT_YOFFSET_INDEX]};}selectedBone.applyGradient();}}else{for(i=0;i<objs.length;i++){objs[i].setAttribute("bgstyle","2");objs[i].setAttribute("gradientcolor",value);gradientUtil.applyGradientSettings(objs[i],gs,microstrategy.styleObj);}}if(ac){var fnEP=function(p,v){return id+mstrUpdateManager.UNIT_SEPARATOR+f.getPropertySetName(p)+mstrUpdateManager.UNIT_SEPARATOR+f.getPropertyName(p)+mstrUpdateManager.UNIT_SEPARATOR+v+mstrUpdateManager.ITEM_SEPARATOR;};ac.push(um.createActionObject(obj,mstrUpdateManager.EDIT_PROPS,bp,["2048018","2048035"],[mstrUpdateManager.UPDATE_LATER,fnEP("backgroundColor",f.encodeValue("backgroundColor",value))+fnEP("gradientColor",f.encodeValue("gradientColor",value))+fnEP("backgroundStyle",f.encodeValue("backgroundStyle",value))+fnEP("gradientAngle",gs[3])+fnEP("gradientXOffset",gs[4])+fnEP("gradientYOffset",gs[5])],[mstrUpdateManager.UPDATE_LATER,oldData+oldValue+mstrUpdateManager.ITEM_SEPARATOR]));}}else{bone=microstrategy.findBone(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL?obj.lastChild:obj);if(bone&&bone.applyGradientOnItem){bone.applyGradientOnItem(ft,prop,value,ac,f);}}}if(tempProp=="selectionColor"||tempProp=="selectionStyle"){var propName=(tempProp=="selectionColor")?microstrategy.HTMLATTR_SELECTOR_SELECTION_COLOR:microstrategy.HTMLATTR_SELECTOR_SELECTION_STYLE;var oldV=so.getAttValue(object,propName);so.setAttValue(object,propName,value);if(tempProp=="selectionColor"&&object.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){if(object.lastChild){var ctlBone=microstrategy.bone(object.lastChild.id);if(ctlBone&&ctlBone.setSelectionColor){ctlBone.setSelectionColor(value);}}}if(ac){ac.push(um.createEditPropsAction(object,id,bp,[tempProp],[value],[oldV]));}}else{if(tempProp!="backgroundStyle"){if(this.selections.isSingleSelectionType&&objs[0]&&microstrategy.subObjectType(objs[0])==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK&&!(this.selections.panelUnitFormat==0&&this.selections.panelValueFormat==0)){var b=mstrStaticDoc.getBone(objs[0]);if(b&&b.setFormatValue){b.setFormatValue(mstrPanelStack.FMT_TYPE_TITLE,tempProp,value);}}else{if(this.selections.isSingleSelectionType&&objs[0]&&microstrategy.subObjectType(objs[0])==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL&&!(this.selections.controlUnitFormat==0&&this.selections.controlValueFormat==0)&&!(tempProp=="dropShadowDepth"||tempProp=="dropShadowEffect")){var b=mstrStaticDoc.getBone(objs[0]);if(b&&b.setFormatValue){b.setFormatValue(mstrRWControlImpl.FMT_TYPE_TITLE,tempProp,value);}}else{for(i=0;i<objs.length;i++){var textDirection=so.getValue(objs[i],"TextDirection")||"0";so.setValue(objs[i],tempProp,value);if(tempProp.match(/^padding/)){var sp,ap;if(tempProp.match(/Left$/)||tempProp.match(/Right$/)){sp="width";ap=microstrategy.HTMLATTR_WIDTH;}else{sp="height";ap=microstrategy.HTMLATTR_HEIGHT;}objs[i].style[textDirection==="0"?sp:sp==="width"?"height":"width"]=so.adjustSizes(sp,f.decodeValue(sp,so.getAttValue(objs[i],ap)),null,objs[i])+"px";}if(textDirection!="0"){so.changeVerticalTextPosition(objs[i],{x:tempProp==="top"?parseInt(value,0):null,y:tempProp==="left"?parseInt(value,0):null});}}}}}}if(prop=="backgroundColor"&&objType==microstrategy.OBJTYPE_DOC_SUBSECTION&&obj.getAttribute("scriptclass")!="mstrPanel"){var selectedSubSec=this.getChildBone(obj);if(selectedSubSec){selectedSubSec.startingColor=null;selectedSubSec.endingColor=null;}}if(prop=="backgroundColor"&&subType==microstrategy.SUBOBJTYPE_DOC_SHAPE&&obj.getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){bone=microstrategy.bone(obj.id);if(bone){bone.synchronizeFormat();}if(obj.getAttribute("gradientcolor")){obj.removeAttribute("gradientcolor");}}if(prop=="backgroundColor"&&object.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){if(object.lastChild){var ctlBone=microstrategy.bone(object.lastChild.id);if(ctlBone.setSelectionColor){ctlBone.setSelectionColor(microstrategy.styleObj.getAttValue(object,microstrategy.HTMLATTR_SELECTOR_SELECTION_COLOR));}}}}if(panelStack){panelStack.synchronizeShadow();}}}if(!passOut&&update&&ac&&ac.length>0){um.add(ac);}return(passOut)?ac:null;}catch(err){microstrategy.errors.log(err);return(ac!=null)?ac:false;}};mstrDocImpl.prototype.setGridDataSource=function(items,value,ac){try{for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs){if(ac){ac.push(this.parentBone.updateManager.createActionObject(objs[0],mstrUpdateManager.CHANGE_DATA_SET,this.parentBone.beanPath,["2048031","2048012"],[value,id]));}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.setGridOrigin=function(items,linked,datasetID,ac){try{var v=(linked)?"1":"0";for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs){if(ac){ac.push(this.parentBone.updateManager.createActionObject(objs[0],mstrUpdateManager.CHANGE_TEMPLATE_ORIGIN,this.parentBone.beanPath,["2048158","2048031","2048012"],[v,datasetID,id]));}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatItemBorders=function(items,props,style,width,color,update,ac){try{var f=mstrFormatObject;var passOut=(ac!=null);var um=this.parentBone.updateManager;var so=this.styleObj;if(update||passOut){if(!passOut){var ac=[];}}var applyBorder=(parseFloat(width)>0);var cacheprops=[];for(var i=0;i<props.length;i++){switch(props[i]){case"borderTop":cacheprops.push("bt");break;case"borderBottom":cacheprops.push("bb");break;case"borderRight":cacheprops.push("br");break;case"borderLeft":cacheprops.push("bl");break;}}for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs.length==0){continue;}var subType=microstrategy.subObjectType(items[item]);var checkBorder=(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE&&(subType==microstrategy.SUBOBJTYPE_DOC_TEXT||subType==microstrategy.SUBOBJTYPE_DOC_IMAGE||subType==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL||subType==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER));var hasBorder=(so.getAttValue(items[item],microstrategy.HTMLATTR_BORDER)==microstrategy.HAS_BORDER);if(width.length>0){if(checkBorder&&applyBorder&&!hasBorder){for(var j=0;j<objs.length;j++){objs[j].style.border="";}}for(var i=0;i<props.length;i++){if(this.checkAppliesTo(items[item],props[i]+"Color")&&this.checkAppliesTo(items[item],props[i]+"Style")){var useDefaultColor=(width!="0pt"&&(color.length==0||!hasBorder));if(useDefaultColor){useDefaultColor=(!hasBorder||so.getAttValue(items[item],cacheprops[i]+"c").length==0);}var useSpecifiedColor=true;if(color.length==0){if(useDefaultColor){color="#000000";}else{useSpecifiedColor=false;}}if(ac){ac.push(um.createEditPropsAction(items[item],id,this.parentBone.beanPath,[props[i]+"Style"],[width+" "+style],[f.decodeValue(props[i]+"Style",so.getAttValue(items[item],cacheprops[i]+"s"))]));if(useSpecifiedColor){ac.push(um.createEditPropsAction(items[item],id,this.parentBone.beanPath,[props[i]+"Color"],[color],[f.decodeValue(props[i]+"Color",so.getAttValue(items[item],cacheprops[i]+"c"))]));}}so.setAttValue(items[item],cacheprops[i]+"c",f.encodeValue(props[i]+"Color",color));so.setAttValue(items[item],cacheprops[i]+"s",f.encodeValue(props[i]+"Style",width+" "+style));var borderStyle=width+" "+style,prop=props[i];if(objs[0].getAttribute(props[i])!=null){for(var j=0;j<objs.length;j++){prop=so.swapForRotation(objs[j],props[i]);objs[j].setAttribute(prop,borderStyle,0);if(useSpecifiedColor){objs[j].setAttribute(prop+"Color",color,0);}}}else{var thisColor=(useSpecifiedColor)?color:so.getValue(objs[0],props[i]+"Color");for(var j=0;j<objs.length;j++){prop=so.swapForRotation(objs[j],props[i]);objs[j].style[prop]=borderStyle;objs[j].style[prop+"Color"]=thisColor;}}}}}else{for(var i=0;i<props.length;i++){if(this.checkAppliesTo(items[item],props[i]+"Color")){if(ac!=null){ac.push(um.createEditPropsAction(items[item],id,this.parentBone.beanPath,[props[i]+"Color"],[color],[f.decodeValue(props[i]+"Color",so.getAttValue(items[item],cacheprops[i]+"c"))]));}so.setAttValue(items[item],cacheprops[i]+"c",f.encodeValue(props[i]+"Color",color));var prop=props[i];if(objs[0].getAttribute(props[i]+"Color")){for(var j=0;j<objs.length;j++){prop=so.swapForRotation(objs[j],props[i]);objs[j].setAttribute(prop+"Color",color,0);}}else{for(var j=0;j<objs.length;j++){prop=so.swapForRotation(objs[j],props[i]);objs[j].style[prop+"Color"]=color;}}}}}if(checkBorder){if(applyBorder){so.setAttValue(objs[0],microstrategy.HTMLATTR_BORDER,microstrategy.HAS_BORDER);}else{var borderValues={Top:false,Bottom:false,Left:false,Right:false};for(var b in borderValues){var w=so.getValue(objs[0],"border"+b+"Width");var s=so.getValue(objs[0],"border"+b+"Style");borderValues[b]=(w.length!=0&&w!="0pt"&&s.length!=0&&s!="none");}if(!borderValues.Top&&!borderValues.Bottom&&!borderValues.Left&&!borderValues.Right){so.setAttValue(objs[0],microstrategy.HTMLATTR_BORDER,microstrategy.NO_BORDER);for(var j=0;j<objs.length;j++){objs[j].style.border=microstrategy.DESIGNMODE_NOBORDER_STYLE;}}}}var fnHW=function(o,p,ap,isHorizontal){o.style[isHorizontal?p:p==="width"?"height":"width"]=so.adjustSizes(p,f.decodeValue(p,so.getAttValue(o,ap)),null,o)+"px";},isHorizontal=true;for(var i=0;i<objs.length;i++){isHorizontal=!so.getValue(objs[i],"TextDirection")||so.getValue(objs[i],"TextDirection")==="0";if(so.getAttValue(objs[i],microstrategy.HTMLATTR_WIDTH_MODE)!=microstrategy.AUTO_MODE){fnHW(objs[i],"width",microstrategy.HTMLATTR_WIDTH,isHorizontal);}if(so.getAttValue(objs[i],microstrategy.HTMLATTR_HEIGHT_MODE)!=microstrategy.AUTO_MODE){fnHW(objs[i],"height",microstrategy.HTMLATTR_HEIGHT,isHorizontal);}}this.adjustObjectSize(objs);if(subType==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var grid=microstrategy.findBone(items[item]);if(grid&&grid.isGraph){if(ac){ac.forceSubmit=true;}}}}if(!passOut&&update&&ac.length>0){um.add(ac);}return(passOut)?ac:null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.adjustObjectSize=function(objs){try{var o={0:objs[0]};var so=this.styleObj;var st=microstrategy.subObjectType(objs[0]);var that=this;var fnAOS=function(m,p,ap){var v;if(m==microstrategy.HUNDRED_PERCENT_MODE&&st==microstrategy.SUBOBJTYPE_DOC_SHAPE){v=that.calcParentSubHeightWidth(objs[0],p)+"px";}else{if(m!=microstrategy.AUTO_MODE){v=mstrFormatObject.decodeValue(p,so.getAttValue(objs[0],ap));}else{return ;}}that.formatSize(o,p,v);};fnAOS(so.getAttValue(objs[0],microstrategy.HTMLATTR_HEIGHT_MODE),"height",microstrategy.HTMLATTR_HEIGHT);fnAOS(so.getAttValue(objs[0],microstrategy.HTMLATTR_WIDTH_MODE),"width",microstrategy.HTMLATTR_WIDTH);if(st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK||st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var panelBone=microstrategy.findBone(objs[0]);panelBone.synchronizeSize();}}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.formatLineSetting=function(items,prop,value,update,ac){try{var passOut=(ac!=null);var um=this.parentBone.updateManager;ac=ac||[];var f=mstrFormatObject;var so=this.styleObj;var p=prop.substr(4);if(p=="Weight"){p="Width";}for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(!objs||!this.checkAppliesTo(items[item],prop)){continue;}var cp=microstrategy["HTMLATTR_LINE_"+p.toUpperCase()];var htmlProp=p;var st=microstrategy.subObjectType(items[item]);if(st==microstrategy.SUBOBJTYPE_DOC_LINE){if(prop=="lineWeight"&&parseInt(value,10)<=0){continue;}if(so.getAttValue(items[item],microstrategy.HTMLATTR_ORIENTATION)==microstrategy.ORIENTATION_HORIZONTAL){htmlProp="Top"+htmlProp;}else{htmlProp="Left"+htmlProp;}}htmlProp="border"+htmlProp;if(ac){ac.push(um.createEditPropsAction(items[item],id,this.parentBone.beanPath,[prop],[value],[f.decodeValue(prop,so.getAttValue(items[item],cp))]));}so.setAttValue(items[item],cp,f.encodeValue(prop,value));if(st!=microstrategy.SUBOBJTYPE_DOC_SHAPE||items[item].getAttribute(microstrategy.HTMLATTR_STYLE)!=microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){var fnHW=function(p,ap){objs[j].style[p]=so.adjustSizes(p,f.decodeValue(p,so.getAttValue(objs[j],ap)),null,objs[j])+"px";};for(var j=0;j<objs.length;j++){objs[j].style[htmlProp]=value;if(htmlProp=="borderWidth"||htmlProp=="borderStyle"){fnHW("width",microstrategy.HTMLATTR_WIDTH);fnHW("height",microstrategy.HTMLATTR_HEIGHT);}}}}if(!passOut&&update&&ac.length>0){um.add(ac);}return(passOut)?ac:null;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocImpl.prototype.formatLineSetting=function(items,prop,value,update,ac){try{var um=this.parentBone.updateManager;var f=mstrFormatObject;var so=this.styleObj;var p=prop.substr(4);var cp=microstrategy["HTMLATTR_LINE_"+p.toUpperCase()];if(p=="Weight"){p="Width";}for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(!objs||!this.checkAppliesTo(items[item],prop)){continue;}var htmlProp=p;var st=microstrategy.subObjectType(items[item]);if(st==microstrategy.SUBOBJTYPE_DOC_LINE){if(prop=="lineWeight"&&parseInt(value,10)<=0){continue;}var o=(so.getAttValue(items[item],microstrategy.HTMLATTR_ORIENTATION)==microstrategy.ORIENTATION_HORIZONTAL)?"Top":"Left";htmlProp=o+htmlProp;}htmlProp="border"+htmlProp;if(ac){ac.push(um.createEditPropsAction(items[item],id,this.parentBone.beanPath,[prop],[value],[f.decodeValue(prop,so.getAttValue(items[item],cp))]));}so.setAttValue(items[item],cp,f.encodeValue(prop,value));if(st!=microstrategy.SUBOBJTYPE_DOC_SHAPE||items[item].getAttribute(microstrategy.HTMLATTR_STYLE)!=microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){var fnHW=function(p){objs[j].style[p]=so.adjustSizes(p,f.decodeValue(p,so.getAttValue(objs[j],microstrategy["HTMLATTR_"+p.toUpperCase()])),null,objs[j])+"px";};for(var j=0;j<objs.length;j++){objs[j].style[htmlProp]=value;if(htmlProp=="borderWidth"||htmlProp=="borderStyle"){fnHW("width");fnHW("height");}}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.applyUserMetricFormat=function(formatObject){try{var userMetricId=formatObject.userMetricId;var dataSetId=formatObject.dataSetId;var formatArray=formatObject.bulkChanges;if(userMetricId&&dataSetId){var updateManager=this.parentBone.updateManager;var ac=[];var sData="";for(counter=0;counter<formatArray.length;counter++){formatArray[counter]=formatArray[counter].replace("|",mstrUpdateManager.UNIT_SEPARATOR);sData=sData+"FormattingNumber"+mstrUpdateManager.UNIT_SEPARATOR+formatArray[counter]+mstrUpdateManager.ITEM_SEPARATOR;}sData=sData.substring(0,sData.length-1);ac.push(updateManager.createActionObject(null,mstrUpdateManager.FORMAT_USER_METRIC,this.parentBone.beanPath,["2048031","2048001","2048035","2048018"],[dataSetId,userMetricId,sData,mstrUpdateManager.UPDATE_LATER]));updateManager.add(ac);if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){updateManager.flushAndSubmitChanges();}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.populatePortalSizeValues=function(so,item,p,ap,ac){try{var x=so.getAttValue(item,microstrategy[ap]);this.formatAttribute({0:item},p,x,null,microstrategy[ap.replace("_","_OLD_")],ac);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.minimizePortal=function(items,prop,value,update,ac){try{var passOut=(ac!=null);var um=this.parentBone.updateManager;if(update||passOut){if(!passOut){ac=[];}}var so=this.styleObj;var itemIds="|";for(var item in items){var id=items[item].getAttribute("id");itemIds+=id+"|";var objs=document.getElementsByName(id);if(objs&&this.checkAppliesTo(items[item],prop)&&so.getAttValue(items[item],microstrategy.HTMLATTR_WINDOW_STATE)!=microstrategy.WINDOW_STATE_MINIMIZED){this.restoreOldTopAndLeft(items[item]);var subBone=microstrategy.findBone(microstrategy.findAncestorWithAtt(items[item],microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_SUBSECTION));if(ac){var o={0:items[item]};var ws=so.getAttValue(items[item],microstrategy.HTMLATTR_WINDOW_STATE);if(ws==microstrategy.WINDOW_STATE_NORMAL){this.populatePortalSizeValues(so,items[item],"oldHeight","HTMLATTR_HEIGHT",ac);this.populatePortalSizeValues(so,items[item],"oldWidth","HTMLATTR_WIDTH",ac);}var portalElem=microstrategy.findChildWithAtt(objs[0],"div",microstrategy.HTMLATTR_SCRIPTCLASS,"mstrPortalImpl");var portalHeight=(portalElem)?getObjHeight(portalElem):microstrategy.WINDOW_TITLE_HEIGHT;if(portalElem){var tempHeight=so.getAttValue(items[item],"wth");if(tempHeight!=null){portalHeight=tempHeight+microstrategy.getPaddingAndBorderPixels(items[item],"height");}portalHeight+="px";}this.formatSize(o,"height",""+portalHeight,ac,!!portalElem,false,true);if(ws==microstrategy.WINDOW_STATE_MAXIMIXED){var newWidth=so.getAttValue(items[item],microstrategy.HTMLATTR_OLD_WIDTH);if(newWidth){this.formatSize(o,"width",mstrFormatObject.decodeValue("width",newWidth),ac,true,false,true);}}ac.push(um.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[prop],[value],[mstrFormatObject.decodeValue(prop,so.getAttValue(items[item],microstrategy.HTMLATTR_WINDOW_STATE))]));if(subBone){var newZindex=subBone.maxZindex-1;var viewerBone=microstrategy.getViewerBone();if(viewerBone.portals&&viewerBone.portals[items[item].id]&&typeof (viewerBone.portals[items[item].id][microstrategy.WINDOW_STATE_NORMAL])!="undefined"){newZindex=viewerBone.portals[items[item].id][microstrategy.WINDOW_STATE_NORMAL];}this.formatItems(o,"zIndex",newZindex,false,ac);}}if(subBone){this.processSubsectionBone(subBone);}for(var j=0;j<objs.length;j++){so.setAttValue(objs[j],microstrategy.HTMLATTR_WINDOW_STATE,value);}}microstrategy.eventManager.notifyOrphanBones("portalWindowResize","minimize",id);}this.selections.syncUp();this.updateLayoutWidth(ac);if(!passOut&&update&&ac.length>0){um.add(ac);}microstrategy.eventManager.notifyOrphanBones("onboneafterresize",itemIds);return(passOut)?ac:null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.maximizePortal=function(items,prop,value,update,ac){try{var passOut=(ac!=null);var um=this.parentBone.updateManager;if(update||passOut){if(!passOut){ac=[];}}var f=mstrFormatObject;var so=this.styleObj;var itemIds="|";var subBones={};for(var item in items){var id=items[item].getAttribute("id");itemIds+=id+"|";var objs=document.getElementsByName(id);var ws=so.getAttValue(items[item],microstrategy.HTMLATTR_WINDOW_STATE);if(objs&&this.checkAppliesTo(items[item],prop)&&ws!=microstrategy.WINDOW_STATE_MAXIMIXED){var that=this;var o={0:items[item]};var fnTL=function(n){so.setAttValue(items[item],microstrategy["HTMLATTR_OLD_"+n.toUpperCase()],f.encodeValue(n,parseInt(so.getValue(items[item],n))));that.formatItems(o,n,0,false);};fnTL("top");fnTL("left");var subBone=microstrategy.findBone(microstrategy.findAncestorWithAtt(items[item],microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_SUBSECTION));if(ac){subBones[subBone.id]=subBone;if(ws==microstrategy.WINDOW_STATE_NORMAL){this.populatePortalSizeValues(so,items[item],"oldHeight","HTMLATTR_HEIGHT",ac);this.populatePortalSizeValues(so,items[item],"oldWidth","HTMLATTR_WIDTH",ac);}var fnDp=function(p,x){var x=!!x?x:that.calcParentSubHeightWidth(items[item],p),tmp=x;if(bIsIE8){tmp=(parseInt(tmp)-1)+"px";}that.formatSize(o,p,tmp,ac,true,false);return x;};var newHeight=so.getAttValue(subBone.elem,microstrategy.HTMLATTR_HEIGHT);if(newHeight){newHeight=f.decodeValue("height",newHeight);}newHeight=fnDp("height",newHeight);var newWidth=fnDp("width");if(mstrStaticDoc.getBone(items[item])){mstrStaticDoc.getBone(items[item]).synchronizeSize();}if(subBone.subsectionType!=mstrSubSection.TYPE_PANEL){this.formatSubHeightWidth({0:subBone.elem},"height",[f.encodeValue("height",newHeight),so.getAttValue(subBone.elem,microstrategy.HTMLATTR_MAX_HEIGHT),"0","0",so.getAttValue(subBone.elem,microstrategy.HTMLATTR_HIDE_IF_EMPTY)],ac);}ac.push(um.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[prop],[value],[ws]));var maxZIndex=subBone.maxZindex;var oldZIndex=so.getValue(items[item],"zIndex");if(maxZIndex>=oldZIndex){maxZIndex++;var viewerBone=microstrategy.getViewerBone();viewerBone.portals=viewerBone.portals||{};viewerBone.portals[items[item].id]=viewerBone.portals[items[item].id]||{};viewerBone.portals[items[item].id][ws]=oldZIndex;ac=this.formatItems(o,"zIndex",maxZIndex,false,ac);}}if(subBone){this.processSubsectionBone(subBone);}for(var j=0;j<objs.length;j++){so.setAttValue(objs[j],microstrategy.HTMLATTR_WINDOW_STATE,value);}}microstrategy.eventManager.notifyOrphanBones("portalWindowResize","maximize",id);}if(subBones&&ac){for(var subBoneId in subBones){var subBone=subBones[subBoneId];subBone.maxZindex++;}}this.selections.syncUp();this.updateLayoutWidth(ac);if(!passOut&&update&&ac.length>0){um.add(ac);}microstrategy.eventManager.notifyOrphanBones("onboneafterresize",itemIds);return(passOut)?ac:null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.restorePortal=function(items,prop,value,update,ac){try{var passOut=(ac!=null);var um=this.parentBone.updateManager;if(update||passOut){if(!passOut){ac=[];}}var f=mstrFormatObject;var so=this.styleObj;var itemIds="|";var subBones={};for(var item in items){var id=items[item].getAttribute("id");itemIds+=id+"|";var objs=document.getElementsByName(id);var ws=so.getAttValue(items[item],microstrategy.HTMLATTR_WINDOW_STATE);if(objs&&this.checkAppliesTo(items[item],prop)&&ws!=microstrategy.WINDOW_STATE_NORMAL){this.restoreOldTopAndLeft(items[item]);var subBone=microstrategy.findBone(microstrategy.findAncestorWithAtt(items[item],microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_SUBSECTION));var that=this;var o={0:items[item]};if(ac){var fnDp=function(p){var x=so.getAttValue(items[item],microstrategy["HTMLATTR_OLD_"+p.toUpperCase()]);that.formatSize(o,p,f.decodeValue(p,x),ac,true,false);return x;};var newHeight=fnDp("height");var newWidth=fnDp("width");if(mstrStaticDoc.getBone(items[item])){mstrStaticDoc.getBone(items[item]).synchronizeSize();}ac.push(um.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[prop],[value],[ws]));if(subBone){var newZindex=subBone.maxZindex-1;var viewerBone=microstrategy.getViewerBone();if(viewerBone.portals&&viewerBone.portals[items[item].id]&&typeof (viewerBone.portals[items[item].id][microstrategy.WINDOW_STATE_NORMAL])!="undefined"){newZindex=viewerBone.portals[items[item].id][microstrategy.WINDOW_STATE_NORMAL];}this.formatItems(o,"zIndex",newZindex,false,ac);}}if(subBone){this.processSubsectionBone(subBone);}for(var j=0;j<objs.length;j++){so.setAttValue(objs[j],microstrategy.HTMLATTR_WINDOW_STATE,value);}}microstrategy.eventManager.notifyOrphanBones("portalWindowResize","restore",id);}this.selections.syncUp();this.updateLayoutWidth(ac);if(!passOut&&update&&ac.length>0){um.add(ac);}microstrategy.eventManager.notifyOrphanBones("onboneafterresize",itemIds);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.restoreOldTopAndLeft=function(item,leftOrTop){try{if(typeof (leftOrTop)=="undefined"){leftOrTop=microstrategy.RESTORE_BOTH;}var that=this;var fn=function(n){var x=that.styleObj.getAttValue(item,microstrategy["HTMLATTR_OLD_"+n.toUpperCase()]);if(x){that.formatItems({0:item},n,mstrFormatObject.decodeValue(n,x),false);}};if(leftOrTop!=microstrategy.RESTORE_LEFT){fn("top");}if(leftOrTop!=microstrategy.RESTORE_TOP){fn("left");}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatTitle=function(items,prop,value,ac){try{for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs&&this.checkAppliesTo(items[item],prop)){if(ac){ac.push(this.parentBone.updateManager.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[prop],[value],[mstrFormatObject.decodeValue(prop,(items[item].getAttribute("title",0)||""))]));}this.styleObj.setAttValue(items[item],microstrategy.HTMLATTR_TOOLTIP_FORMULA,value);for(var j=0;j<objs.length;j++){if(bIsIE7&&objs[j].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){objs[j].setAttribute("tooltip",value,0);}else{objs[j].setAttribute("title",value,0);}}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatAttribute=function(items,prop,value,update,attributeName,ac,applyToAllViews){try{var bone;var passOut=(ac!=null);if(update||passOut){var um=this.parentBone.updateManager;if(!passOut){ac=[];}}for(var item in items){var elem=items[item];var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs&&this.checkAppliesTo(items[item],prop)){if(ac){ac.push(um.createActionObject(objs[0],mstrUpdateManager.EDIT_PROPS,this.parentBone.beanPath,["2048018","2048035","2048241"],[mstrUpdateManager.UPDATE_LATER,mstrUpdateManager.createPropertyEditString(id,prop,value,true),applyToAllViews?"1":"0"],[mstrUpdateManager.UPDATE_LATER,mstrUpdateManager.createPropertyEditString(id,prop,this.styleObj.getAttValue(elem,attributeName,true))]));}this.styleObj.setAttValue(elem,attributeName,value);if(attributeName=="swt"){bone=microstrategy.findBone(elem);if(bone&&bone.toggleTitleBars){bone.isTitleVisible=(value==-1);bone.toggleTitleBars();if(bone.synchronizeSize){bone.synchronizeSize();}}}if(attributeName=="wt"){bone=microstrategy.findBone(elem);if(bone&&bone.updatePortalTitle){bone.updatePortalTitle(value);}}if(attributeName=="tbd"){bone=microstrategy.findBone(items[item]);if(bone){bone.titleBarDisplay=value;bone.adjustTitle();}}if(attributeName=="nm"&&microstrategy.subObjectType(items[item])==microstrategy.SUBOBJTYPE_DOC_PANEL){microstrategy.findBone(items[item]).parentBone.adjustTitle(items[item]);}if(attributeName=="visible"||attributeName=="nm"||attributeName=="wt"||attributeName=="lck"||attributeName=="twc"||attributeName=="rsl"){this.styleObj.setAttValue(elem,attributeName,value);}if(attributeName==microstrategy.HTMLATTR_NORMAL_URL||attributeName==microstrategy.HTMLATTR_HIGHLIGHT_URL){bone=microstrategy.findBone(elem);if(bone&&bone.updateIcons){bone.updateIcons();}}if(attributeName==microstrategy.HTMLATTR_FILL_EFFECT){bone=microstrategy.findBone(elem);if(bone&&bone.updateFillEffect){bone.updateFillEffect();}}if(attributeName==microstrategy.HTMLATTR_DISPLAY_STYLE){bone=microstrategy.findBone(elem);if(bone&&bone.updateDisplayStyle){bone.updateDisplayStyle(ac,update);}}}else{if(objs&&this.parentBone.commands.queryState("isDDIC")){if(ac){var commands=microstrategy.getViewerBone().doc.commands,ctlkey=commands.getDDICBoneProperty([items[item]],"ctlKey",null);ac.push(um.createActionObject(objs[0],mstrUpdateManager.EDIT_PROPS,this.parentBone.beanPath,["2048018","2048035","2048241"],[mstrUpdateManager.UPDATE_LATER,mstrUpdateManager.createPropertyEditString(ctlkey,prop,value,true),applyToAllViews?"1":"0"],[mstrUpdateManager.UPDATE_LATER,mstrUpdateManager.createPropertyEditString(ctlkey,prop,this.styleObj.getAttValue(elem,attributeName,true))]));}this.styleObj.setAttValue(elem,attributeName,value);}}}if(!passOut&&update&&ac.length>0){um.add(ac);}return(passOut)?ac:null;}catch(err){microstrategy.errors.log(err);return(ac!=null)?ac:false;}};mstrDocImpl.prototype.formatIframeSource=function(items,value){try{for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs&&this.checkAppliesTo(items[item],"url")){var type=this.styleObj.getAttValue(objs[0],microstrategy.HTMLATTR_HTML_TYPE);if(type==microstrategy.HTML_CONTAINER_TYPE_IFRAME){microstrategy.findRWObjectBone(objs[0],"mstrHTMLContainerImpl").updateContents(type,value);}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.importImage=function(file,um){var me=this;function handleFileLoaded(e){var array=[];array.push(e.target.result);var blob=new Blob(array);mstrmojo.xhr.upload("POST",mstrConfig.taskURL,{success:function(res){},failure:function(res){},complete:function(res){delete me.img;um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,me.parentBone.beanPath,[],[],[])]);um.flushAndSubmitChanges();}},file.props,blob,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12963,"Uploading File...")});}function handleFileLoadError(){var res={code:0,message:mstrmojo.desc(12814,"Cannot read file content")};if(callbacks.failure){callbacks.failure(res);}if(callbacks.complete){callbacks.complete();}}var reader=new FileReader();reader.onerror=handleFileLoadError;reader.onload=handleFileLoaded;reader.readAsArrayBuffer(file);};mstrDocImpl.prototype.formatImageSource=function(items,value,ac,isNew){var forceSubmit=false;try{for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(microstrategy.subObjectType(items[item])==microstrategy.SUBOBJTYPE_DOC_IMAGE&&objs&&this.checkAppliesTo(items[item],"src")){if(ac){var a=objs[0].getElementsByTagName("img");var oldValue=(a.length>0)?a[0].getAttribute("src"):"";var preID=microstrategy.getViewerBone().doc.prevSelectedId,preEl=document.getElementById(preID),oldType=Number(preEl.getAttribute("ut")),type=oldType,um=this.parentBone.updateManager;if(this.img){type=mstr.Enum.IMAGE_URL_TYPE.BLOB_URL;this.img.props={taskId:"importImage",imageFieldName:"myFile",sectionKey:items[item].parentNode.getAttribute("id"),fieldKey:id,fieldName:items[item].getAttribute("name"),imageName:encodeURIComponent(this.img.name),imageSize:this.img.size,msgID:this.parentBone.messageID,isEdit:isNew};this.importImage(this.img,um);}else{type=mstr.Enum.IMAGE_URL_TYPE.HTTP_URL;}ac.push(um.createActionObject(items[item],mstrUpdateManager.EDIT_IMAGE,this.parentBone.beanPath,["2048012","2048019","2048295","2048018"],[id,value,type,mstrUpdateManager.UPDATE_LATER],[id,oldValue,oldType,mstrUpdateManager.UPDATE_LATER]));if(!this.img){forceSubmit=true;ac.push(um.createActionObject(items[item],mstrUpdateManager.APPLY_CHANGES,this.parentBone.beanPath,[],[],[]));}}var setAtt=false;for(var j=0;j<objs.length;j++){var img=objs[j].getElementsByTagName("img");if(img.length>0){var imgID=img[0].id;img[0].outerHTML="<img />";if(mstr.utils.ISFF){var t=value.split("?");if(t.length>1){t[0]=t[0].replace(/\\/g,"/");img[0].src=t.join("?");}else{img[0].src=t[0].replace(/\\/g,"/");}}else{img[0].src=value;}img[0].id=imgID;img[0].name=imgID;setAtt=true;}}if(setAtt){this.styleObj.setAttValue(items[item],microstrategy.HTMLATTR_IMAGE_SOURCE,value);}}}}catch(err){microstrategy.errors.log(err);}return forceSubmit;};mstrDocImpl.prototype.formatTemplateSize=function(items,value,ac){try{var um=this.parentBone.updateManager;for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs&&this.checkAppliesTo(items[item],"xTabView")){microstrategy.findBone(this.selections.getSelectedGrid()).updateViewMode(value);ac.push(um.createActionObject(objs[0],mstrUpdateManager.CHANGE_VIEW_MODE,this.parentBone.beanPath+"."+objs[0].id,["4115"],[value],[]));}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.changeLineOrientation=function(items,v,ac){try{var um=this.parentBone.updateManager;for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs.length==0){objs=mstr.utils.Arrays.fromHashValues(items);}if(objs&&this.checkAppliesTo(items[item],"orientation")){var ov=this.styleObj.getAttValue(items[item],microstrategy.HTMLATTR_ORIENTATION);if(ov!=v){if(ac){ac.push(um.createActionObject(objs[0],mstrUpdateManager.EDIT_PROPS,this.parentBone.beanPath,["2048018","2048035"],[mstrUpdateManager.UPDATE_LATER,mstrUpdateManager.createPropertyEditString(id,"orientation",v,true)],[mstrUpdateManager.UPDATE_LATER,mstrUpdateManager.createPropertyEditString(id,"orientation",ov,true)]));}var so=this.styleObj;var that=this;var fn=function(item){var ow=so.getValue(item,"width");var oh=so.getValue(item,"height");var owm=so.getValue(item,"widthMode");var ohm=so.getValue(item,"heightMode");var isSame=(owm==ohm);item.style.width=(isSame||owm==1)?oh:"100%";item.style.height=(isSame||ohm==1)?ow:"100%";if(!isSame){that.formatSizeMode([item],"heightMode",owm,ac,false);that.formatSizeMode([item],"widthMode",ohm,ac,false);}if(isSame||owm==1){that.formatSize([item],"height",ow,ac,false);}if(isSame||ohm==1){that.formatSize([item],"width",oh,ac,false);}if(!isSame){that.restoreOldTopAndLeft(item,microstrategy["RESTORE_"+(owm==1)?"LEFT":"TOP"]);}};for(var j=0;j<objs.length;j++){fn(objs[j]);this.setLineOrientation(objs[j],v);objs[j].setAttribute(microstrategy.HTMLATTR_ORIENTATION,v,0);}}}}this.updateLayoutWidth(ac);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.setLineOrientation=function(obj,v,ac){try{var so=this.styleObj;var bv=(so.getValue(obj,"lineStyle")||"solid")+" "+(so.getValue(obj,"lineColor")||"#000000")+" "+parseInt(so.getValue(obj,"lineWeight")||1,10)+"pt";var map={};map[microstrategy.ORIENTATION_HORIZONTAL]={0:"Top",1:"Left",2:"height"};map[microstrategy.ORIENTATION_VERTICAL]={0:"Left",1:"Top",2:"width"};var o=map[v];if(o){obj.style["border"+o[0]]=bv;obj.style["border"+o[1]+"Width"]=0;so.setValue(obj,o[2],0);}so.setAttValue(obj,microstrategy.HTMLATTR_ORIENTATION,v);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatIsLink=function(items,value,ac){try{var v=(value)?"-1":"0";for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs&&this.checkAppliesTo(items[item],"isLink")){if(ac){ac.push(this.parentBone.updateManager.createEditPropsAction(objs[0],id,this.parentBone.beanPath,["isLink"],[v],[this.styleObj.getAttValue(items[item],microstrategy.HTMLATTR_IS_LINK)]));}this.styleObj.setAttValue(items[item],microstrategy.HTMLATTR_IS_LINK,v);var cursor=(value&&microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE)?"pointer":"default";for(var j=0;j<objs.length;j++){objs[j].style.cursor=cursor;}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatHTMLType=function(items,value,ac){try{for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs&&this.checkAppliesTo(items[item],"htmlType")){var oldValue=this.styleObj.getAttValue(items[item],microstrategy.HTMLATTR_HTML_TYPE);if(oldValue!=value){var textValues=this.getHTMLFieldValues(objs[0],decode(this.styleObj.getAttValue(objs[0],(value==microstrategy.HTML_CONTAINER_TYPE_HTML)?microstrategy.HTMLATTR_HTML_TEXT:microstrategy.HTMLATTR_HTML_SOURCE),true));for(var i=0;i<objs.length;i++){microstrategy.findRWObjectBone(objs[i],"mstrHTMLContainerImpl").updateContents(value,textValues);}}}}this.formatAttribute(items,"htmlType",value,false,microstrategy.HTMLATTR_HTML_TYPE,ac);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatLockAspectRatio=function(items,value,ac){try{var v=(value)?"-1":"0";for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs.length==0){objs=mstr.utils.Arrays.fromHashValues(items);}if(objs&&this.checkAppliesTo(items[item],"lockAspectRatio")){var ov=this.styleObj.getAttValue(items[item],microstrategy.HTMLATTR_LOCK_ASPECT_RATIO);if(ov!=v){if(ac){ac.push(this.parentBone.updateManager.createEditPropsAction(objs[0],id,this.parentBone.beanPath,["lockAspectRatio"],[v],[ov]));}this.styleObj.setAttValue(items[item],microstrategy.HTMLATTR_LOCK_ASPECT_RATIO,v);}}}this.updateLayoutWidth(ac);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatSubHeightWidth=function(items,prop,value,ac){try{var propArr=prop.split("|");prop=propArr[0];var f=mstrFormatObject;var so=this.styleObj;var up=prop.toUpperCase();var pSuffix=(prop=="width")?"Horizontal":"";var suffix=(pSuffix)?"_"+pSuffix.toUpperCase():"";var o=[{tp:prop,at:microstrategy["HTMLATTR_"+up]},{tp:"max"+up.substr(0,1)+prop.substr(1),at:microstrategy["HTMLATTR_MAX_"+up]},{tp:"canGrow"+pSuffix,at:microstrategy["HTMLATTR_CAN_GROW"+suffix]},{tp:"canShrink"+pSuffix,at:microstrategy["HTMLATTR_CAN_SHRINK"+suffix]},{tp:"hideIfEmpty",at:microstrategy["HTMLATTR_HIDE_IF_EMPTY"+suffix]}];for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);for(var i=0;i<value.length;i++){var tp=o[i].tp;if(objs&&this.checkAppliesTo(items[item],tp)){var cachedOldValue=null;if(i==0){var suffix=(prop=="width")?"_HORIZONTAL":"";cachedOldValue=[so.getAttValue(items[item],o[i].at),so.getAttValue(items[item],microstrategy["HTMLATTR_MAX_"+prop.toUpperCase()]),so.getAttValue(items[item],microstrategy["HTMLATTR_CAN_GROW"+suffix]),so.getAttValue(items[item],microstrategy["HTMLATTR_CAN_SHRINK"+suffix]),so.getAttValue(items[item],microstrategy.HTMLATTR_HIDE_IF_EMPTY)];}if(ac){ac.push(this.parentBone.updateManager.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[tp],[f.decodeValue(tp,value[i])],[1],false,{origValue:value,cachedOldValue:cachedOldValue,subsectionHeight:true}));}so.setAttValue(items[item],o[i].at,value[i]);if(i==0&&microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE){var v=f.decodeValue(tp,value[i]||0);for(var j=0;j<objs.length;j++){objs[j].style[tp]=v;if(prop=="height"){objs[j].parentNode.firstChild.style[tp]=v;}}}if(i==4){var subBone=microstrategy.findBone(items[item]);subBone.setNeedToUpdateMaxContentHeight(true);if(prop=="height"){if(subBone.isHorizontal){this.adjustHeightOfHorizontalSubSections(subBone,true);var hc=microstrategy.findBone(microstrategy.findAncestorWithAtt(subBone.elem,microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_HORIZONTAL_CONTAINER));if(hc){for(var k=1;k<propArr.length;k++){if(propArr[k]=="SubHeight"){hc.height=parseInt(f.decodeValue("height",value[0]),10);break;}}hc.propogateHeightToChildren();}}else{subBone.adjustSubsectionHeight(true);}}else{if(prop=="width"){subBone.adjustSubsectionWidth(true);}}}}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatSize=function(items,prop,value,ac,performFormatChange,updateLayoutWidth,noGraphAdjust){try{var f=mstrFormatObject;var so=this.styleObj;for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);var changeFormat=false;if(objs.length==0||(!this.checkAppliesTo(items[item],prop)&&microstratgegy.formatType==microstrategy.FORMAT_TYPE_MAIN)){continue;}var st=microstrategy.subObjectType(items[item]);var bone=mstrStaticDoc.getBone(items[item]);var isTC=bone&&bone.isTable;if(prop!=null&&value!=null){if(st==microstrategy.SUBOBJTYPE_DOC_IMAGE){var imgchild=microstrategy.findChildWithAtt(items[item],"img","id",id+"_img");if(imgchild!=null){imgchild.style[prop]="100%";}}}if(ac){var ov=so.getValue(items[item],prop);if(ov!="auto"&&ov!="100%"){ov=Math.max(Math.round(parseFloat(ov)+microstrategy.getPaddingAndBorderPixels(items[item],prop)),0)+"px";}var applyToAllView=isTC?true:false;ac.push(this.parentBone.updateManager.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[prop],[value],[ov],false,{origValue:value,performFormatChange:performFormatChange,updateLayoutWidth:updateLayoutWidth,subType:st},applyToAllView));}so.setAttValue(items[item],this.heightAndWidthAttMap[prop],f.encodeValue(prop,value));changeFormat=!this.useModeForStyle(prop,items[item]);var adjustedValue=value;if(changeFormat&&(performFormatChange!=false)){if(value!="100%"&&value!="auto"){adjustedValue=Math.max(this.removePaddingAndBorder(objs[0],value,prop),1)+"px";}for(var j=0;j<objs.length;j++){if(microstrategy.formatType==microstrategy.FORMAT_TYPE_MAIN){prop=so.swapForRotation(objs[j],prop);var position={x:parseInt(so.getValue(objs[j],"top")),y:parseInt(so.getValue(objs[j],"left"))},textDirection=objs[j].direction||this.styleObj.getValue(objs[j],"TextDirection")||"0";objs[j].style[prop]=adjustedValue;if(textDirection!="0"){so.changeVerticalTextPosition(objs[j],position);}if(st==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){var bn=mstrStaticDoc.getBone(objs[j]);var ctlSty=bn.ctlStyle;var ctlOrn=bn.ctlOrientation;if(prop!="height"||ctlOrn!="0"||(ctlSty!="0"&&ctlSty!="4"&&ctlSty!="3")){so.cascadeSelectorValue(objs[j],prop,adjustedValue);}}if(st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK&&/width|height/.test(prop)){var psb=mstrStaticDoc.getBone(objs[j]);if(psb&&psb.isTable){if(prop=="width"){psb.resize(null,parseInt(adjustedValue));}if(prop=="height"){psb.resize(parseInt(adjustedValue),null);}}}}if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var grid=microstrategy.findBone(objs[j]);if(grid&&grid.isGraph&&!noGraphAdjust&&grid.adjustGraphSize){grid.adjustGraphSize(grid.commands.queryState("gridPosition"),grid.commands.queryState("gridFactor"),ac);}else{if(grid&&!grid.isGraph){if(prop=="width"){grid.setGridDimension(grid.elem,null,parseInt(adjustedValue));}if(prop=="height"){grid.setGridDimension(grid.elem,parseInt(adjustedValue),null);}}}}}}if((st==microstrategy.SUBOBJTYPE_DOC_SHAPE&&items[item].getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND)||st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK||this.isDocButton(items[item])){var bone=microstrategy.bone(id);if(bone){bone.synchronizeSize(ac);}}}if(prop=="width"&&(updateLayoutWidth=="undefined"||updateLayoutWidth==null||updateLayoutWidth==true)){this.updateLayoutWidth(ac);}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.formatSizeMode=function(items,prop,value,ac,performFormatChange){try{var f=mstrFormatObject;var so=this.styleObj;var styleProp=prop.replace("Mode","").toLowerCase();for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs.length==0||!this.checkAppliesTo(items[item],prop)){continue;}var st=microstrategy.subObjectType(items[item]);if(st==microstrategy.SUBOBJTYPE_DOC_SHAPE){var mth="100"+prop.toUpperCase().substr(0,1)+"MObjects";if(parseInt(value,10)==microstrategy.HUNDRED_PERCENT_MODE){mth="addTo"+mth;}else{mth="removeFrom"+mth;}this.parentBone[mth](id);}if(value==microstrategy.HUNDRED_PERCENT_MODE||value==microstrategy.AUTO_MODE){if(st==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER||st==microstrategy.SUBOBJTYPE_DOC_IMAGE){continue;}if((so.getAttValue(items[item],microstrategy.HTMLATTR_SHOW_WINDOW_TITLE)==microstrategy.TRUE)&&(st!=microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL)){continue;}}else{if(value==microstrategy.HUNDRED_PERCENT_MODE&&st==microstrategy.SUBOBJTYPE_DOC_TEXT){continue;}}if(ac){ac.push(this.parentBone.updateManager.createEditPropsAction(objs[0],id,this.parentBone.beanPath,[prop],[value],[so.getAttValue(items[item],this.heightAndWidthAttMap[prop])],false,{origValue:value,performFormatChange:performFormatChange,subType:st}));}var mode=parseInt(value);if(!isNaN(mode)){so.setAttValue(items[item],this.heightAndWidthAttMap[prop],String(mode));}var newValue;var changeFormat=(mode==microstrategy.FIX_MODE)||this.useModeForStyle(prop,items[item]);switch(mode){case microstrategy.FIX_MODE:newValue=f.decodeValue(styleProp,so.getAttValue(items[item],this.heightAndWidthAttMap[styleProp]));break;case microstrategy.HUNDRED_PERCENT_MODE:newValue=(st==microstrategy.SUBOBJTYPE_DOC_SHAPE)?this.calcParentSubHeightWidth(items[item],styleProp):"100%";var position=(prop=="heightMode")?"top":"left";so.setAttValue(items[item],(prop=="heightMode")?microstrategy.HTMLATTR_OLD_TOP:microstrategy.HTMLATTR_OLD_LEFT,f.encodeValue(position,parseInt(so.getValue(items[item],position))));this.formatItems([items[item]],position,"0",false,ac);break;case microstrategy.AUTO_MODE:newValue="auto";break;}if(changeFormat&&(performFormatChange!=false)){if(newValue!="100%"&&newValue!="auto"){newValue=Math.max(this.removePaddingAndBorder(objs[0],newValue,styleProp),1)+"px";}for(var j=0;j<objs.length;j++){styleProp=so.swapForRotation(objs[j],styleProp);objs[j].style[styleProp]=newValue;if((prop=="widthMode")&&microstrategy.subObjectType(objs[j])==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var grid=microstrategy.findBone(objs[j]);if(grid&&grid.adjustGridWidth){grid.adjustGridWidth(String(mode));}}}}if(st==microstrategy.SUBOBJTYPE_DOC_SHAPE&&items[item].getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){var bone=microstrategy.bone(id);if(bone){bone.synchronizeSize();}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.useModeForStyle=function(prop,item){try{var propModeAtt=(prop.indexOf("height")>-1)?microstrategy.HTMLATTR_HEIGHT_MODE:microstrategy.HTMLATTR_WIDTH_MODE;var st=microstrategy.subObjectType(item);if(st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){return false;}if(parseInt(this.styleObj.getAttValue(item,propModeAtt))!=microstrategy.FIX_MODE){if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var g=microstrategy.findBone(item);return !!(g&&g.isGrid);}return true;}else{if(st==microstrategy.SUBOBJTYPE_DOC_SHAPE||st==microstrategy.SUBOBJTYPE_DOC_LINE){return true;}}}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocImpl.prototype.calcParentSubHeightWidth=function(item,prop){try{var subsec=microstrategy.findAncestorWithAtt(item,"ty",microstrategy.OBJTYPE_DOC_SUBSECTION);if(subsec!=null){return window["getObj"+prop.substr(0,1).toUpperCase()+prop.substr(1)](subsec);}}catch(err){microstrategy.errors.log(err);}return 0;};mstrDocImpl.prototype.formatLineLength=function(items,p,v,ac,pfc){try{var newProp;for(var item in items){if(this.checkAppliesTo(items[item],p)){var np=(this.styleObj.getAttValue(items[item],microstrategy.HTMLATTR_ORIENTATION)==microstrategy.ORIENTATION_HORIZONTAL)?"width":"height";var suffix=(p.indexOf("Mode")>-1)?"Mode":"";this["formatSize"+suffix]([items[item]],np+suffix,v,ac,pfc);}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.process3DItemSetting=function(item,p,v,ac){try{if(ac){var ov=this.styleObj.getAttValue(item,p);ov=(ov==null)?0:parseInt(ov);ac.push(microstrategy.updateManager.createEditPropsAction(item,item.getAttribute("id"),this.parentBone.beanPath,[p],[v],[ov]));}this.styleObj.setAttValue(item,p,v);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.process3DItemColorSettings=function(item,props,v,weight,ac){try{var f=mstrFormatObject;var so=this.styleObj;var id=item.getAttribute("id");var objs=document.getElementsByName(id);if(objs.length==0){return ;}for(var i=0;i<props.length;i++){var p=props[i]+"Color2";var attr=f.getAttrNameFromStyle(p);if(ac){ac.push(microstrategy.updateManager.createEditPropsAction(item,id,this.parentBone.beanPath,[p],[v[i]],[f.decodeValue(p,so.getAttValue(item,attr))]));}for(var j=0;j<objs.length;j++){var prop=so.swapForRotation(objs[j],props[i]);objs[j].style[prop]=weight+"pt solid";objs[j].style[prop+"Color"]=v[i];so.setAttValue(item,attr,f.encodeValue(p,v[i]));}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.format3DItems=function(items,b3dStyle,b3dWeight,ac){try{var so=this.styleObj;var fnBC=function(item){var g=item.getAttribute("gradientColor");var ga=g&&g.split(",");if(ga&&ga.length==6){var idx=(ga[5]==0&&ga[4]==0)?0:1;return"#"+ga[idx];}return so.getValue(item,"backgroundColor");};for(var item in items){var st=microstrategy.subObjectType(items[item]);if(!this.checkAppliesTo(items[item],"b3dstyle")){continue;}if((st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK||st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE)&&microstrategy.formatType!=microstrategy.FORMAT_TYPE_MAIN){continue;}var turnOffItem3d=true;var item3dStyle=b3dStyle;var item3dWeight=b3dWeight;if(b3dStyle==null||b3dStyle.length==0){item3dStyle=this.styleObj.getAttValue(items[item],microstrategy.HTMLATTR_BORDER_3D_STYLE);}if(item3dStyle!=null&&parseInt(item3dStyle)>0){if(b3dWeight==null||b3dWeight.length==0){item3dWeight=this.styleObj.getAttValue(items[item],microstrategy.HTMLATTR_BORDER_3D_WEIGHT);}item3dWeight=parseInt(item3dWeight,10);if(item3dWeight!=null&&item3dWeight>0){turnOffItem3d=false;var bgcolor=(st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK)?null:fnBC(items[item]);if(bgcolor==null||bgcolor.length==0||bgcolor.toLowerCase()=="transparent"){bgcolor="#FFFFFF";}bgcolor=mstr.utils.Color.hex2rgb(bgcolor);var bottomright=mstr.utils.Color.get3DBorderColor(bgcolor,"dark");var topleft=mstr.utils.Color.get3DBorderColor(bgcolor,"light");if(item3dStyle!="1"){var t=topleft;topleft=bottomright;bottomright=t;}this.process3DItemSetting(items[item],"b3dstyle",item3dStyle,ac);this.process3DItemSetting(items[item],"b3dweight",item3dWeight,ac);if(!(st==microstrategy.SUBOBJTYPE_DOC_SHAPE&&items[item].getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND)){this.process3DItemColorSettings(items[item],["borderLeft","borderTop","borderRight","borderBottom"],[topleft,topleft,bottomright,bottomright],item3dWeight,ac);this.adjustObjectSize(document.getElementsByName(items[item].getAttribute("id")));}}}if(turnOffItem3d){item3dStyle=this.styleObj.getAttValue(items[item],microstrategy.HTMLATTR_BORDER_3D_STYLE);if((b3dStyle!=null&&parseInt(b3dStyle)==0)&&(item3dStyle!=null&&parseInt(item3dStyle)>0)){this.turnOffItem3D(items[item],ac);}}if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var grid=microstrategy.findBone(items[item]);if(grid&&grid.isGraph&&grid.adjustGraphSize){grid.adjustGraphSize(grid.commands.queryState("gridPosition"),grid.commands.queryState("gridFactor"),ac);if(ac){ac.forceSubmit=true;}}}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.turnOffItem3D=function(item,ac){try{this.process3DItemSetting(item,"b3dstyle","0",ac);var so=this.styleObj;var f=mstrFormatObject;var st=microstrategy.subObjectType(item);if(st!=microstrategy.SUBOBJTYPE_DOC_SHAPE){var bMap={borderLeft:"bl",borderTop:"bt",borderRight:"br",borderBottom:"bb"};for(var b in bMap){var x=bMap[b];var v=f.decodeValue(b+"Style",so.getAttValue(item,x+"s")).split(" ");this.formatItemBorders({0:item},[b],v[1],v[0],f.decodeValue(b+"Color",so.getAttValue(item,x+"c")));}}else{if(st==microstrategy.SUBOBJTYPE_DOC_SHAPE&&item.getAttribute(microstrategy.HTMLATTR_STYLE)!=microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){var that=this;var fn=function(p,ap){that.formatLineSetting({0:item},p,f.decodeValue(p,so.getAttValue(item,ap)));};fn("lineColor","lc");fn("lineStyle","ls");fn("lineWeight","lw");}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.checkAppliesTo=function(item,prop){try{return microstrategy.isEnabledForItem(item,prop);}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.checkBorderProperties=function(obj,fn,prefix,style,color){try{if(this.selections.hasNoBorder(obj)){return 0;}var i;var p=["Right","Bottom","Left"];var borderWidth=fn.getValue(obj,prefix+"Top"+style);for(i=0;i<3;i++){if(borderWidth!=fn.getValue(obj,prefix+p[i]+style)){return 2;}}var v=parseFloat(borderWidth,10);if(isNaN(v)||v==0){return 0;}var borderColor=fn.getValue(obj,prefix+"Top"+color);for(i=0;i<3;i++){if(borderColor!=fn.getValue(obj,prefix+p[i]+color)){return 2;}}return 1;}catch(err){microstrategy.errors.log(err);return 0;}};mstrDocImpl.prototype.resolveDeltaPropertyValue=function(deltas,cmdId){return(cmdId in deltas)?deltas[cmdId]:this.commands.queryState(cmdId);};mstrDocImpl.prototype.processDocBorderChanges=function(deltas,ac){try{if(!deltas){return ;}var f=mstrFormatObject;var b=["Top","Right","Bottom","Left"];var s,c,v,p,d,i;var borderStyle=this.resolveDeltaPropertyValue(deltas,"LayoutBorderStyle");switch(parseInt(borderStyle)){case 0:this.elem.style.borderWidth=0;var that=this;var fn=function(p){p+="Style";that.saveDocProperty("border"+p,f.decodeValue("border"+p,0),ac);that.parentBone["Layout"+p]=0;};for(i=0;i<4;i++){fn(b[i]);}break;case 1:s=this.resolveDeltaPropertyValue(deltas,"LayoutAllStyle");c=this.resolveDeltaPropertyValue(deltas,"LayoutAllColor");v=f.decodeValue("borderTopStyle",s);this.elem.style.border=v+" "+c;for(i=0;i<4;i++){this.saveDocProperty("border"+b[i]+"Style",v,ac);this.saveDocProperty("border"+b[i]+"Color",c,ac);this.parentBone["Layout"+b[i]+"Style"]=s;this.parentBone["Layout"+b[i]+"Color"]=c;}break;case 2:for(i=0;i<4;i++){s=deltas["Layout"+b[i]+"Style"];if(!isNaN(s)){p="border"+b[i]+"Style";v=f.decodeValue("borderTopStyle",s);var bc=v.split(" ");this.elem.style["border"+b[i]+"Width"]=bc[0];this.elem.style[p]=bc[1];this.saveDocProperty(p,v,ac);this.parentBone["Layout"+b[i]+"Style"]=s;}c=deltas["Layout"+b[i]+"Color"];if(c){p="border"+b[i]+"Color";this.elem.style[p]=c;this.saveDocProperty(p,c,ac);this.parentBone["Layout"+b[i]+"Color"]=c;}}break;}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.processIncrFetchChanges=function(ac){try{var ifSettings=this.parentBone.ifSettings;var ids=["2048166"];var vs=(ifSettings.enabled)?[microstrategy.TRUE]:[microstrategy.FALSE];if(ifSettings.curLevel){ids.push("2048167");vs.push(ifSettings.curLevel);}if(ifSettings.blockCount){ids.push("2048168");vs.push(ifSettings.blockCount);}ac.push(this.parentBone.updateManager.createActionObject(null,mstrUpdateManager.RW_IF_SETTINGS,this.parentBone.beanPath,ids,vs));}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.processDocViewModeChanges=function(deltas,ac){try{if(!deltas){return false;}var i,n,addModes,removeModes=0;var um=this.parentBone.updateManager,me=this;var fnGetModes=function(cmdName){var modes=0,viewModes=me.resolveDeltaPropertyValue(deltas,cmdName);if(typeof (viewModes)=="string"){viewModes=viewModes.split(CLIPBOARD_ITEM_SEPARATOR);}for(i=0;i<viewModes.length;i++){n=parseInt(viewModes[i],10);if(!isNaN(n)){modes+=n;}}return modes;};addModes=fnGetModes("AvailableViewModes");addModes+=fnGetModes("AvailableExportModes");var vm=mstr.Enum.VIEWMEDIA;var allModes=vm.STATIC+vm.INTERACTIVE+vm.EDITABLE+vm.FLASH+vm.EXPORT_EXCEL+vm.EXPORT_PDF+vm.EXPORT_HTML+vm.EXPORT_FLASH;removeModes=allModes-addModes;this.parentBone.AvailableViewModes=addModes;var defaultViewMode=this.resolveDeltaPropertyValue(deltas,"DefaultViewMode");ac.push(um.createActionObject(null,mstrUpdateManager.SET_VIEW_MEDIA,this.parentBone.beanPath,["2048163","2048290","2048291"],[defaultViewMode,addModes,removeModes],[]));return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.processDocPropertyChanges=function(cmdArray){try{var ac=[];var um=this.parentBone.updateManager;var submit=false;var refreshEditor=false;var borderChanges=null;var viewModeChanges=null;var ifSettings=this.parentBone.ifSettings;var ifSettingsChanged=false;var delayedActions={};for(var i=0,cnt=cmdArray.length;i<cnt;i++){var cmdId=cmdArray[i].cmdId;var value=cmdArray[i].value;var convertedValue=null;var j;var fn=(this.docPropsMap[cmdId]&&this.docPropsMap[cmdId].f)||cmdId;var lp=(this.docPropsMap[cmdId]&&this.docPropsMap[cmdId].l)||cmdId;switch(cmdId){case"TabName":var tabKey=cmdArray[i].id;this.saveDocProperty(fn,value,ac,tabKey);if(tabKey==this.parentBone.currentLayout){this.parentBone[lp]=value;}break;case"DefaultGridStyle":case"CalculateDocWidth":case"TOCTitle":case"TOCFontName":case"TOCFontSize":case"WatermarkType":case"WatermarkText":case"TextOrientation":case"ImageSource":case"ImageScale":case"WatermarkFontName":case"WatermarkFontSize":case"EmbeddedFonts":case"MobileDataView":case"PreLoadAllPanels":case"SupportedOrientations":case"layoutBarPosition":case"ExcelExportDocumentURL":case"PDFExportDocumentURL":case"TOCTitleAlignment":case"TOCTitleFontName":case"TOCTitleFontSize":case"TOCLeftIndent":case"TOCRightIndent":case"TOCBorderStyle":case"TOCBorderWeight":case"RemoveMissingUnits":case"SingleSourceGrid":case"DocumentThemeColor":case"SmartClientDoc":case"RWLevelMCEJoin":this.saveDocProperty(fn,value,ac);this.parentBone[lp]=value;break;case"layoutBarStyle":this.saveDocProperty(fn,value,ac);this.parentBone[lp]=value;if(value=="0"){this.saveDocProperty("layoutBarPosition",1,ac);this.parentBone.layoutBarPosition=1;}break;case"BeforeLayout":this.saveDocProperty(fn,parseInt(value)+1,ac);this.parentBone[lp]=value;break;case"Autowire":delayedActions[cmdId]={value:value,fn:fn,lp:lp};break;case"FitPDFContentHeight":case"DisplayPageByBar":case"DisplayRePromptIcon":case"UseAsInfoWindow":case"ExecutionFullScreenMode":case"PreserveTranslations":case"ShowingBarsTemporarily":case"ShowFloatingToolbars":case"CtlAutoSubmit":case"tabMPHF":case"EnableToc":case"TOCFontStrikeout":case"TOCFontUnderline":case"TabLeader":case"AutoFontSize":case"TextWashout":case"WatermarkFontStrikeout":case"WatermarkFontUnderline":case"RemoveNullGroups":case"TrimNoSectionData":case"ShowTabsForSingleLayout":case"IncludePageHeaderFooter":case"EnableExport":case"EnableSwipingToSwitchLayout":case"TOCTitleFontUnderline":case"TOCTitleFontStrikeout":case"KeepControlTargetsConsistent":this.saveDocProperty(fn,(value)?microstrategy.TRUE:microstrategy.FALSE,ac);this.parentBone[lp]=value;break;case"OfflineOnCube":if(!!this.parentBone.ShowOfflineUCOnCubeConfig){this.saveDocProperty(fn,(value)?microstrategy.TRUE:microstrategy.FALSE,ac);this.parentBone[lp]=value;}break;case"TOCTitleEnableInherit":this.saveDocProperty(fn,(value)?microstrategy.FALSE:microstrategy.TRUE,ac);this.parentBone[lp]=value;break;case"ViewModeInteractivityLevel":this.saveDocProperty(fn,(value)?2:1,ac);this.parentBone[lp]=value;break;case"DefaultSelectorsAsFilter":delayedActions[cmdId]={value:value,fn:fn,lp:lp};break;case"LayoutFillColor":convertedValue=(value=="transparent")?"#ffffff":value;this.saveDocProperty(fn,convertedValue,ac);this.parentBone[lp]=value;this.saveDocProperty("backgroundStyle",value,ac);break;case"LayoutBorderStyle":case"LayoutAllStyle":case"LayoutAllColor":case"LayoutLeftStyle":case"LayoutLeftColor":case"LayoutTopStyle":case"LayoutTopColor":case"LayoutRightStyle":case"LayoutRightColor":case"LayoutBottomStyle":case"LayoutBottomColor":borderChanges=borderChanges||{};borderChanges[cmdId]=value;break;case"AvailableViewModes":case"AvailableExportModes":case"DefaultViewMode":viewModeChanges=viewModeChanges||{};viewModeChanges[cmdId]=value;break;case"VisibleSections":case"DockedSections":var prop=(cmdId=="VisibleSections")?"visibility":"docked",fld=(cmdId=="VisibleSections")?"v":"dc";value=CLIPBOARD_ITEM_SEPARATOR+value+CLIPBOARD_ITEM_SEPARATOR;var allSections=this.commands.queryState("sectionsList");for(j=0;j<allSections.length;j++){var v=(value.indexOf(CLIPBOARD_ITEM_SEPARATOR+allSections[j].dssid+CLIPBOARD_ITEM_SEPARATOR)>-1)?microstrategy.TRUE:microstrategy.FALSE;var data=mstrUpdateManager.createPropertyEditString(allSections[j].dssid,prop,v,true);if(allSections[j].v!=(v==microstrategy.TRUE)){this.parentBone.sectionsList[j][fld]=(v==microstrategy.TRUE);}ac.push(um.createActionObject(null,mstrUpdateManager.EDIT_PROPS,this.parentBone.beanPath,["2048018","2048035"],[mstrUpdateManager.UPDATE_LATER,data],[]));}break;case"ShowConditionalFormatting":ac.push(um.createActionObject(this.elem,mstrUpdateManager.TOGGLE_DOC_THRESHOLDS,[],[],[],[]));if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){submit=true;}break;case"TOCFontBoldItalic":this.parentBone.TOCFontBold=(value&1);this.saveDocProperty("TOCFontBold",(value&1)?microstrategy.TRUE:microstrategy.FALSE,ac);this.parentBone.TOCFontItalic=(value&2);this.saveDocProperty("TOCFontItalic",(value&2)?microstrategy.TRUE:microstrategy.FALSE,ac);break;case"TOCTitleFontBoldItalic":this.parentBone.TOCTitleFontBold=(value&1);this.saveDocProperty("TOCTitleFontBold",(value&1)?microstrategy.TRUE:microstrategy.FALSE,ac);this.parentBone.TOCTitleFontItalic=(value&2);this.saveDocProperty("TOCTitleFontItalic",(value&2)?microstrategy.TRUE:microstrategy.FALSE,ac);break;case"WatermarkFontBoldItalic":this.parentBone.WatermarkFontBold=(value&1);this.saveDocProperty("WatermarkFontBold",(value&1)?microstrategy.TRUE:microstrategy.FALSE,ac);this.parentBone.WatermarkFontItalic=(value&2);this.saveDocProperty("WatermarkFontItalic",(value&2)?microstrategy.TRUE:microstrategy.FALSE,ac);break;case"TOCFillColor":case"TOCTitleFillColor":convertedValue=(value=="transparent")?"#ffffff":value;this.saveDocProperty(fn,microstrategy.getFormatObject().encodeValue("color",convertedValue),ac);this.parentBone[lp]=value;break;case"TOCFontColor":case"TOCTitleFontColor":case"TOCBorderColor":case"WatermarkFontColor":this.saveDocProperty(cmdId,microstrategy.getFormatObject().encodeValue("color",value),ac);this.parentBone[cmdId]=value;break;case"incrFetchEnabled":case"incrFetchBlockCount":case"incrFetchCurLevel":ifSettingsChanged=true;ifSettings[lp]=value;break;case"ApplyGBToAllLayouts":var pv=value?2:1;this.saveDocProperty(fn,pv,ac);this.parentBone[lp]=pv;break;}switch(cmdId){case"TOCFillColor":if(value=="transparent"){this.saveDocProperty("TOCFillStyle","1",ac);}else{this.saveDocProperty("TOCFillStyle","0",ac);}break;case"TOCTitleFillColor":if(value=="transparent"){this.saveDocProperty("TOCTitleFillStyle","1",ac);}else{this.saveDocProperty("TOCTitleFillStyle","0",ac);}break;case"LayoutFillColor":this.elem.style.backgroundColor=value;break;case"TabName":case"tabMPHF":case"VisibleSections":case"ShowConditionalFormatting":case"CalculateDocWidth":submit=true;break;case"RemoveNullGroups":case"TrimNoSectionData":case"RemoveMissingUnits":case"KeepControlTargetsConsistent":submit=(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE);break;case"SingleSourceGrid":if(value==="0"){this.parentBone.features[microstrategy.FEATURE_SINGLE_SOURCE_GRID]=this.parentBone.isFeatureAvailable(microstrategy.FEATURE_SINGLE_SOURCE_GRID_PROJECT);}else{this.parentBone.features[microstrategy.FEATURE_SINGLE_SOURCE_GRID]=value==="1"?true:false;}submit=(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE);break;case"RWLevelMCEJoin":if(value==="-1"){this.parentBone.features[microstrategy.FEATURE_RW_LEVEL_MCE_JOIN]=this.parentBone.features[microstrategy.FEATURE_PROJECT_LEVEL_MCE_JOIN];}else{this.parentBone.features[microstrategy.FEATURE_RW_LEVEL_MCE_JOIN]=value;}submit=(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE);break;case"ShowTabsForSingleLayout":submit=true;refreshEditor=true;break;}}this.processDelayedActions(delayedActions,ac);this.processDocBorderChanges(borderChanges,ac);if(this.processDocViewModeChanges(viewModeChanges,ac)){submit=true;}if(ifSettingsChanged){this.processIncrFetchChanges(ac);submit=true;}var staticSubmit=this.processStaticDocPropertyChanges(cmdArray,ac);if(ac.length>0){um.add(ac,true);if(submit||staticSubmit){um.flushAndSubmitChanges();}}if(refreshEditor){var editorModel=mstr.$obj("RWDocPropertiesEditorModel1");if(editorModel){editorModel.execReinitializeModel();}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.processDelayedActions=function(delayedActions,ac){var actions=["DefaultSelectorsAsFilter","Autowire"];for(var x in actions){var action=actions[x];if(action in delayedActions){var dAcc=delayedActions[action];var value=dAcc.value;var fn=dAcc.fn;var lp=dAcc.lp;switch(action){case"Autowire":this.saveDocProperty(fn,(value)?microstrategy.TRUE:microstrategy.FALSE,ac);this.parentBone[lp]=value;if(value){for(var key in this.sections){var subSec=this.sections[key];for(var sec in subSec.subsections){subSec.subsections[sec].recursiveWiring(ac,this.parentBone.beanPath);}}}break;case"DefaultSelectorsAsFilter":this.saveDocProperty(fn,(value)?"1":"0",ac);this.parentBone[lp]=value;break;}}}};mstrDocImpl.prototype.processRWDocProperty=function(prop,value){try{var ac=[];var um=this.parentBone.updateManager;var data=mstrUpdateManager.createPropertyEditString(null,prop,value);var that=this;var fn=function(id){ac.push(um.createActionObject(null,id,that.parentBone.beanPath,["2048018","2048065"],[mstrUpdateManager.UPDATE_NOW,data],[]));};fn(mstrUpdateManager.SAVE_DOC_PROPERIES);fn(mstrUpdateManager.APPLY_CHANGES);um.add(ac);um.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.saveDocProperty=function(prop,value,ac,nodeKey){try{var submit=(!ac);if(submit){ac=[];}var um=this.parentBone.updateManager;var bp=this.parentBone.beanPath;switch(prop){case"backgroundColor":case"borderTopColor":case"borderTopStyle":case"borderRightColor":case"borderRightStyle":case"borderBottomColor":case"borderBottomStyle":case"borderLeftColor":case"borderLeftStyle":case"name":case"TabMPHF":case"TabColor":case"SupportedOrientations":case"Autowire":case"FitPDFContentHeight":case"DisplayPageByBar":case"DisplayRePromptIcon":case"UseAsInfoWindow":case"IPhoneVisualization":case"APhoneVisualization":case"ATabletVisualization":case"WidgetProps":if(this.parentBone.currentLayout){ac.push(um.createEditPropsAction(null,this.parentBone.currentLayout,bp,[prop],[value],null,true));}else{ac.push(um.createActionObject(null,mstrUpdateManager.SAVE_DOC_PROPERIES,bp,["2048018","2048065"],[mstrUpdateManager.UPDATE_NOW,mstrUpdateManager.createPropertyEditString(null,prop,value)],[]));}break;case"FilterDetailsFormat":var tokens=value.split(UNIT_SEPARATOR);if(tokens.length!=2){break;}if(tokens[0]){ac.push(um.createEditPropsAction(null,tokens[0],bp,[prop],[tokens[1]],null,true));}break;default:mstrStaticDoc.prototype.saveDocProperty.apply(this,[prop,value,ac,nodeKey]);}if(submit){um.add(ac,(prop=="width"||prop=="UsePageWidthAsLayoutWidth"));}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.openDialog=function(n,url,ac,bp,obj){try{bp=bp||this.parentBone.beanPath+".rwd";microstrategy.openDialog(n,url,ac,bp,obj);}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.showPageBreaker=function(show){try{if(this.pgBreakers){for(var i in this.pgBreakers){this.elem.removeChild(this.pgBreakers[i]);}this.pgBreakers=null;}if(show){this.pgBreakers={};var pgWidth=parseInt(this.getPageWidth());var numOfPgs=Math.ceil(getObjWidth(this.elem)/pgWidth);if(!this.docbgDiv){this.docbgDiv=document.getElementById("docbg");}this.docbgDiv.style.left=((numOfPgs-1)*pgWidth)+"px";this.docbgDiv.style.width=pgWidth+"px";var height=getObjHeight(this.elem);var oDiv=document.createElement("div");oDiv.style.position="absolute";oDiv.style.borderLeft="1pt dashed gray";oDiv.style.height=getObjHeight(this.elem)+"px";oDiv.style.zIndex="30";oDiv.style.top=getObjTop(this.elem);for(var i=1;i<numOfPgs;i++){oDiv.setAttribute("id",i);oDiv.style.left=(i*pgWidth)+"px";this.pgBreakers[i]=this.elem.appendChild(oDiv.cloneNode(true));}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.updatePageBreaker=function(){try{var nHeight=getObjHeight(this.elem);var nWidth=parseInt(this.getPageWidth());if(this.pgBreakers){for(var i in this.pgBreakers){this.pgBreakers[i].style.height=nHeight+"px";this.pgBreakers[i].style.left=i*nWidth+"px";}}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.updateHRulerWidth=function(extra){try{var extraScales=(typeof extra!="undefined"&&extra!=null)?parseInt(extra,10):12;var r=this.parentBone.rulers.rwb_viewer;if(r){r.style.width=parseInt(this.parentBone.docRszHandler.style.left)+"px";r.style.paddingRight=extraScales+"pt";}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.updateLayoutWidth=function(ac,allowShrink){try{var newWidth=this.getRightMostPos();if(this.minWidth!=null&&(this.minWidth<newWidth&&newWidth>getObjWidth(this.elem)||allowShrink)){this.minWidth=newWidth;this.elem.style.width=this.minWidth+"px";this.saveDocProperty("width",this.minWidth,ac);if(this.parentBone.usePageWidthAsLayoutWidth!=0){this.parentBone.usePageWidthAsLayoutWidth=0;this.saveDocProperty("UsePageWidthAsLayoutWidth",this.parentBone.usePageWidthAsLayoutWidth,ac);}if(this.parentBone.rulerTicker){this.parentBone.rulerTicker.style.left=(this.minWidth-parseInt(getObjWidth(this.parentBone.rulerTicker)/2))+"px";}if(this.parentBone.docRszHandler){this.parentBone.docRszHandler.style.left=this.minWidth+"px";}this.updateHRulerWidth();if(this.parentBone.viewer100wm!=null){this.parentBone.resize100WMObjects();}this.displayPageBreaker();}else{this.minWidth=newWidth;}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getName=function(subObjType,Id){try{var id=Id.substr(Id.indexOf(microstrategy.OBJ_PREFIX)+microstrategy.OBJ_PREFIX.length);var fn=function(did){return microstrategy.descriptors.getDescriptor(did)+id;};switch(subObjType){case microstrategy.SUBOBJTYPE_DOC_TEXT:return fn("1013");case microstrategy.SUBOBJTYPE_DOC_IMAGE:return fn("2922");case microstrategy.SUBOBJTYPE_DOC_LINE:return fn("2059");case microstrategy.SUBOBJTYPE_DOC_SHAPE:return fn("3196");case microstrategy.SUBOBJTYPE_DOC_TEMPLATE:return fn("3313");case microstrategy.SUBOBJTYPE_DOC_PANEL_STACK:return fn("4727");case microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL:return fn("4728");case microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER:return fn("3957");default:return"Unknown";}}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.getDefaultNameOfObject=function(obj){var id=obj.getAttribute("id"),st=microstrategy.subObjectType(obj);var fn=function(did){return microstrategy.descriptors.getDescriptor(did)+id.substr(id.indexOf(microstrategy.OBJ_PREFIX)+microstrategy.OBJ_PREFIX.length);};if(this.isDocButton(obj)){return fn("6457");}return this.getName(st,id);};mstrDocImpl.prototype.openAddImagePropertiesEditor=function(){try{this.setStubImage(this.selections.firstItem());microstrategy.openBlockLoaderEditor("rwPropsEditor","PropertiesEditorBlockLoader",{lockedTab:2});}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.startControlSelectionMode=function(){try{var graphBone=null;if(this.selections.getFirstObjType()==microstrategy.OBJTYPE_DOC_OBJECT&&this.selections.getFirstObjSubType()==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){this.standAloneControlKey=this.selections.firstItem().id;}else{var gridID=null;var bone=microstrategy.getActiveCXBone();graphBone=bone&&bone.getGraphBone&&bone.getGraphBone();if(graphBone){gridID=graphBone.objId;}else{if(this.selections.isGridSelected()){gridID=this.selections.getSelectedGrid().getAttribute("id");}}if(gridID){var cx=microstrategy.activeCXMenu;this.controlSourceUnitType=cx.getAttribute(microstrategy.HTMLATTR_DSS_TYPE);this.controlSource=gridID;if(this.controlSourceUnitType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){this.controlSourceUnitType=microstrategy.DSSTYPE_ATTRIBUTE;this.controlSourceUnitID=microstrategy.getActiveCXBone().getUnitInfo(cx).parentDssId;}else{this.controlSourceUnitID=cx.getAttribute(microstrategy.HTMLATTR_DSS_ID);}if(this.controlSourceUnitID==null){this.controlSourceUnitID="";}}else{return ;}}this.controlSelectionMode=true;this.selections.clear();var linksList="";if(this.standAloneControlKey){linksList=microstrategy.bone(this.standAloneControlKey+"_Ctl").targetKeys;}else{var controlSourceBone=graphBone||microstrategy.getActiveCXBone();var controlLinkKey=this.controlSourceUnitID;if(controlLinkKey==null||controlLinkKey==""){this.controlSourceUnitID="";controlLinkKey="Metrics";}if(controlSourceBone.controlLinks&&controlSourceBone.controlLinks[controlLinkKey]){linksList=controlSourceBone.controlLinks[controlLinkKey].targets;}}if(linksList){for(var i in linksList){var link=document.getElementById(linksList[i]);if(link){this.selections.addToSelection(true,link);}}}showMessage({contents:"Control Selection Mode",elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.parentBone.id+"').doc.submitControlTargetSelections();",cancelEval:"microstrategy.bone('"+this.parentBone.id+"').doc.endControlSelectionMode();",type:mstrMsgBoxImpl.MSG_WARNING,messageBoxID:"controlTargetsRecorder"});}catch(err){microstrategy.errors.log(err);}};mstrDocImpl.prototype.endControlSelectionMode=function(){try{this.standAloneControlKey=null;this.controlSourceUnitID=null;this.controlSourceUnitType="";this.controlSelectionMode=false;this.controlSource=null;this.selections.clear();}catch(err){microstrategy.errors.log(err);}};function mstrDocImpl(id){this.inherits=mstrStaticDoc;this.inherits(id);this.inherits=null;return this;}mstrDocImpl.shallRenderTarget=function(key){try{var elem=document.getElementById(key);if(!elem){return false;}var parentBone=microstrategy.findBone(elem.parentNode);while(parentBone&&parentBone.elem.getAttribute("scriptclass")=="mstrPanel"){var panelStack=parentBone.parentBone;if(panelStack.getCurrentPanel()!=parentBone){panelStack.addDirtyKey(parentBone,key);return false;}parentBone=microstrategy.findBone(panelStack.elem.parentNode);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocImpl.prototype.promptDeleteItems=function(items,addToUpdateManager,sParentNode,isStaticAction,delayRangeReset){if(this.parentBone.docViewsSize>1){var ddm=this.parentBone.defaultDeleteMode;if(!ddm){var fc="var rwb = microstrategy.bone('rwb_viewer').doc, p = document.getElementById('msgPref'), checked = p && p.checked; ";var fapply=fc+"rwb.deleteItems(rwb.selections.items, true);if(checked)rwb.updateDeleteMode(true);";var fok=fc+"rwb.formatAttribute(rwb.selections.items,'visibility','0',true,microstrategy.HTMLATTR_VISIBLE,null,false);if(checked)rwb.updateDeleteMode(false);";showMessage({contents:microstrategy.descriptors.getDescriptor("8563"),elements:microstrategy.OK_BUTTON+microstrategy.APPLY_BUTTON,okEval:fok,buttonLabels:{Apply:microstrategy.descriptors.getDescriptor("219"),Ok:microstrategy.descriptors.getDescriptor("218")},applyEval:fapply,type:mstrMsgBoxImpl.MSG_PREF_WARNING});}else{var DM=mstrDocImpl.DELETE_MODE;if(ddm==DM.DELETE){this.deleteItems(this.selections.items,true);}else{if(ddm==DM.HIDE){this.formatAttribute(this.selections.items,"visibility","0",true,microstrategy.HTMLATTR_VISIBLE,null,false);}}}}else{this.deleteItems(this.selections.items,true);}};mstrDocImpl.prototype.updateInsertMode=function(visibleAll){var pb=this.parentBone,um=pb.updateManager,IM=mstrDocImpl.INSERT_MODE;pb.defaultInsertMode=visibleAll?IM.ALL_VISIBLE:IM.HIDE_OTHERS;um.add([um.createActionObject(null,mstrUpdateManager.SET_DEFAULT_INSERT_MODE,pb.beanPath,["55005"],[pb.defaultInsertMode],[])]);};mstrDocImpl.prototype.updateDeleteMode=function(deleteAll){var pb=this.parentBone,um=pb.updateManager,DM=mstrDocImpl.DELETE_MODE;pb.defaultDeleteMode=deleteAll?DM.DELETE:DM.HIDE;um.add([um.createActionObject(null,mstrUpdateManager.SET_DEFAULT_DELETE_MODE,pb.beanPath,["55006"],[pb.defaultDeleteMode],[])]);};mstrDocImpl.prototype.isDocButton=function(obj){return this.isDocButtonType(microstrategy.subObjectType(obj),microstrategy.styleObj.getAttValue(obj,microstrategy.HTMLATTR_DISPLAY_STYLE));};mstrDocImpl.prototype.isDocButtonType=function(subType,displayStyle){return subType==microstrategy.SUBOBJTYPE_DOC_TEXT&&displayStyle>0;};mstrDocImpl.prototype.updateSingleTextField=function(textField,displayValue){if(this.isDocButton(textField)){mstrButton.updateButtonCaption(textField,displayValue);}else{textField.innerHTML=displayValue;}};mstrDocImpl.prototype.isNavigationBar=function(obj){return microstrategy.subObjectType(obj)==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK&&microstrategy.styleObj.getAttValue(obj,microstrategy.HTMLATTR_USE_AS_NAVIGATION_BAR)==microstrategy.TRUE;};mstrDocImpl.prototype.findNavigationBar=function(el){if(!el){return null;}var elBar=microstrategy.findAncestorWithAtt(el,"scriptclass","mstrNavigationBar");if(!elBar){return null;}return mstr.$obj(elBar.id);};