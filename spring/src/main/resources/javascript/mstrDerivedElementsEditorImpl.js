mstrDerivedElementsEditorImplScript=true;mstrDerivedElementsEditorImpl.TAB_DEFINITION="TAB_DEFINITION";mstrDerivedElementsEditorImpl.TAB_PROPERTIES="TAB_PROPERTEIS";mstrDerivedElementsEditorImpl.prototype=new mstrEditorImpl();mstrDerivedElementsEditorImpl.prototype.deBrowserBone=null;mstrDerivedElementsEditorImpl.prototype.currentElmtId=null;mstrDerivedElementsEditorImpl.prototype.currentTab=null;mstrDerivedElementsEditorImpl.prototype.onload=function(e){try{mstrEditorImpl.prototype.onload.call(this,e);this.commands=new mstrDerivedElementsEditorCommands();this.commands.parentBone=this;this.observer=new mstrObserverImpl();this.tabDefinition=document.getElementById("deTabDefinition");this.tabProperties=document.getElementById("deTabProperties");this.sectionDefinition=document.getElementById("deDefinitionSection");this.sectionProperties=document.getElementById("dePropertiesSection");if(this.tabDefinition&&this.tabProperties){this.tabDefinition.onclick=new Function("e","return microstrategy.bone('"+this.id+"').switchTab(mstrDerivedElementsEditorImpl.TAB_DEFINITION);");this.tabProperties.onclick=new Function("e","return microstrategy.bone('"+this.id+"').switchTab(mstrDerivedElementsEditorImpl.TAB_PROPERTIES);");this.switchTab(mstrDerivedElementsEditorImpl.TAB_DEFINITION);this.loadProperties();}if(this.editorTitle){var children=microstrategy.findChildrenWithAtt(this.titleBar,"SPAN","title",null);if(children.length>0){children[0].setAttribute("title",this.editorTitle);children[0].innerHTML=this.editorTitle;}}}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorImpl.prototype.absorbObject=function(obj){try{mstrEditorImpl.prototype.absorbObject.call(this,obj);this.loadProperties();}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorImpl.prototype.loadProperties=function(){try{var fSet=document.getElementById("deLevelSet");if(this.eltType==4){fSet.style.visibility="hidden";}else{fSet.style.visibility="visible";fSet.disabled=this.isRA;this.deLevelInclude=document.getElementById("deLevelInclude");this.deLevelInclude.checked=!this.applyToAllOthers;this.deLevelInclude.disabled=!this.isEditable;this.deLevelDontInclude=document.getElementById("deLevelDontInclude");this.deLevelDontInclude.checked=this.applyToAllOthers;this.deLevelDontInclude.disabled=!this.isEditable;}fSet=document.getElementById("deBehaviorSet");fSet.disabled=this.isRA;this.deBehaviorSeparate=document.getElementById("deBehaviorSeparate");this.deBehaviorSeparate.checked=this.separateElements;this.deBehaviorConsolidate=document.getElementById("deBehaviorConsolidate");this.deBehaviorConsolidate.checked=this.consolidateElements;this.deAggregation=document.getElementById("deAggregation");for(var i=0;i<this.deAggregation.options.length;i++){this.deAggregation.options[i].selected=false;if(this.deAggregation.options[i].value==this.aggregationType){this.deAggregation.options[i].selected=true;break;}}this.deAggregation.disabled=!this.isEditable;this.deBehaviorSeparate.disabled=!this.isEditable;this.deBehaviorConsolidate.disabled=!this.isEditable;if(this.isEditable&&this.forSort){if(this.usage===1){this.deBehaviorConsolidate.disabled=true;}else{this.deBehaviorSeparate.disabled=true;}}var oFromList=getObj("elementIDs");var oToList=getObj("elementKeys");this.updateAddRemoveButtons(oFromList,oToList);}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorImpl.prototype.switchTab=function(tab){try{if(tab!=this.currentTab){this.currentTab=tab;switch(tab){case mstrDerivedElementsEditorImpl.TAB_DEFINITION:this.tabDefinition.className="mstrTabSetTabSelected";this.tabProperties.className="mstrTabSetTab";this.sectionDefinition.style.display="block";this.sectionProperties.style.display="none";var eBone=microstrategy.bones.dElt_pane;if(eBone&&eBone.isListDE){mstrFilterEditorImpl.setupShoppingCartScrollable(eBone.elem);}var editor=microstrategy.findChildWithAtt(this.sectionDefinition,"div","scriptclass","mstrFilterEditorImpl");if(microstrategy.findChildWithAtt(editor,"select","id","elementIDs")){mstrFilterEditorImpl.setupShoppingCartScrollable(editor);}break;case mstrDerivedElementsEditorImpl.TAB_PROPERTIES:this.tabProperties.className="mstrTabSetTabSelected";this.tabDefinition.className="mstrTabSetTab";this.sectionProperties.style.display="block";this.sectionDefinition.style.display="none";this.loadProperties();break;}}}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorImpl.prototype.onselectionchange=function(e){try{if(this.observer){this.observer.notifyAll("onselectionchange",e);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorImpl.prototype.applyChanges=function(){try{if(this.validate()){var pos=this.getPosition();this.move(pos.x,pos.y);this.commands.submitEvent("17003");return true;}}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorImpl.prototype.okChanges=function(){try{if(this.validate()){this.commands.submitEvent("17004");return true;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorImpl.prototype.cancelChanges=function(){try{var form=this.elem.getElementsByTagName("form")[0];if(form){this.commands.submitEvent("17005");}else{this.closeEditor();}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorImpl.prototype.validate=function(){try{if(this.deBrowserBone){if(!this.deBrowserBone.saveText()){return false;}if(!this.deBrowserBone.checkVisible()){showMessage({contents:microstrategy.descriptors.getDescriptor("5607"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_ERROR});return false;}}if(this.dElt_pane&&!this.dElt_pane.isValid()){showMessage({contents:microstrategy.descriptors.getDescriptor("13372"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_ERROR});return false;}return true;}catch(err){microstrategy.errors.log(err);return false;}};function mstrDerivedElementsEditorImpl(id){this.inherits=mstrEditorImpl;this.inherits(id);this.primaryBone=true;delete this.inherits;return this;}mstrDerivedElementsEditorCommands.prototype=new Object();mstrDerivedElementsEditorCommands.prototype.exec=function(cmdId,cmdValue){try{var obj=this.parentBone.elem;var form=obj.getElementsByTagName("form")[0];switch(cmdId){case"sendEvent":this.submitEvent(cmdValue);break;case"add":if(this.parentBone.deBrowserBone.saveText()){this.parentBone.setRefreshDEComponent("Browser",form,true);this.parentBone.setRefreshDEComponent("Editor",form,true);this.submitEvent(cmdValue);}break;case"format":this.submitEvent("109010");break;case"save":if(this.parentBone.deBrowserBone.saveText()){this.submitEvent("109013");}break;case"import":this.submitEvent("109014");break;case"moveup":case"movedown":if(this.parentBone.forSort){var descriptor=microstrategy.descriptors.getDescriptor("12201");showMessage({contents:descriptor,elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.parentBone.id+"').commands.delegateToBrowser('"+cmdId+"', '"+cmdValue+"');",type:mstrMsgBoxImpl.MSG_WARNING});}else{return this.delegateToBrowser(cmdId,cmdValue);}break;case"rename":case"delete":case"deleteall":return this.delegateToBrowser(cmdId,cmdValue);break;default:this.submitEvent(null);break;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorCommands.prototype.delegateToBrowser=function(cmdId,cmdValue){var deBrowserBone=this.parentBone.deBrowserBone;if(deBrowserBone!=null&&deBrowserBone.commands!=null){return deBrowserBone.commands.exec(cmdId,cmdValue);}else{return true;}};mstrDerivedElementsEditorCommands.prototype.submitEvent=function(event){try{var obj=this.parentBone.elem;var form=obj.getElementsByTagName("form")[0];var in1=null;var in2=null;var in3=null;if(event!=null){in1=createHiddenInput(form,event,"true");if(event=="17004"||event=="17003"||event=="17005"){in2=createHiddenInput(form,"evt",event);in3=createHiddenInput(form,"src",this.parentBone.beanPath+"."+event);}}submitForm(form,true);if(in1!=null){form.removeChild(in1);}if(in2!=null){form.removeChild(in2);}if(in3!=null){form.removeChild(in3);}}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorCommands.prototype.queryEnabled=function(cmdId){try{if(this.parentBone.isEditable==false&&cmdId!="import"&&cmdId!="deleteall"){return false;}var deBrowserBone=this.parentBone.deBrowserBone;if(deBrowserBone!=null&&deBrowserBone.commands!=null){return deBrowserBone.commands.queryEnabled(cmdId);}else{return false;}}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementsEditorCommands.prototype.queryState=function(cmdId){try{return null;}catch(err){microstrategy.errors.log(err);return false;}};function mstrDerivedElementsEditorCommands(){return this;}mstrDerivedElementsEditorImpl.prototype.moveItemsbyListObject=function(sFromList,sToList,sAnswerList,sSelectedAnswerList,bRemoveFromItem,bAddToItem,moveAll){try{var oForm=getObj("feForm");var i;var lLength;var bFlag=true;var oFromList=getObj(sFromList);var oToList=getObj(sToList);var lIndexSelected=-1;var lNumSelections=0;var isRA=this.isRA;var toAvail=sFromList===sSelectedAnswerList;var toSelected=!toAvail;var toLength=oToList.options.length;if(this.usage==1&&toSelected){return ;}if(bRemoveFromItem==null){bRemoveFromItem=true;}if(bAddToItem==null){bAddToItem=true;}lLength=oFromList.options.length;for(i=0;i<lLength;i++){var option=oFromList.options[i];if(option&&!option.disabled&&(option.selected||moveAll)&&(option.value!="-none-")){var bAddItemToList=true;if(!bRemoveFromItem){if(isItemInList(option,oToList)){bAddItemToList=false;}}if(bAddToItem&&bAddItemToList){var text=option.text;if(isRA&&toSelected){var level=option.getAttribute("lvl");if(level>0){text=text.substring(2*level);}}var oOption=new Option(text,option.value,false,true);oOption.title=option.title;if((oToList.length==1)&&(oToList.options[0].value=="-none-")){oToList.options[0]=oOption;}else{oToList.options[oToList.length]=oOption;}if(oToList.options[oToList.length-1]){oToList.options[oToList.length-1].selected=false;}}else{if(isRA&&toAvail){var j,toOption,toId,optId=option.value.split("~")[0];for(j=0;j<toLength;j++){toOption=oToList.options[j];toId=toOption.value.split("~")[0];if(toId===optId){toOption.disabled=false;break;}}}}lIndexSelected=i;lNumSelections=lNumSelections+1;}}if(bRemoveFromItem){for(i=lLength-1;i>=0;i--){if(oFromList.options[i]&&(oFromList.options[i].selected==true||moveAll)&&(oFromList.options[i].value!="-none-")){oFromList.options[i]=null;}}}if(oFromList.options.length==0){var oOption=new Option("--"+microstrategy.descriptors.getDescriptor(2020)+"--","-none-",false,false);oFromList.options[0]=oOption;oFromList.options[0].selected=false;}if(!bRemoveFromItem&&(oFromList.options.length>1)){if(lNumSelections>0){for(i=0;i<=lIndexSelected;i++){var opt=oFromList.options[i];if(opt.selected||moveAll){opt.selected=false;if(isRA){opt.disabled=true;}}}}if((lIndexSelected>=0)&&(oFromList.options[lIndexSelected+1]!=null)){oFromList.options[lIndexSelected+1].selected=true;}else{if(lIndexSelected==-1){}}}else{if((lIndexSelected>0)&&(oFromList.options.length>0)){if(lIndexSelected>=lNumSelections){if(oFromList.options.length>lIndexSelected-lNumSelections+1){oFromList.options[lIndexSelected-lNumSelections+1].selected=true;}else{oFromList.options[oFromList.options.length-1].selected=true;}}else{lNumSelections=lNumSelections-1;oFromList.options[lIndexSelected-lNumSelections].selected=true;}}else{if(lIndexSelected>-1){oFromList.options[0].selected=true;}}}BuildFilterSelections(sAnswerList,sSelectedAnswerList);this.updateUpDownButtons(document.getElementById(sSelectedAnswerList));if(sSelectedAnswerList==oToList.id){this.updateAddRemoveButtons(oFromList,oToList);}else{this.updateAddRemoveButtons(oToList,oFromList);}if(mstrFilterEditorImpl.setupShoppingCartScrollable){mstrFilterEditorImpl.setupShoppingCartScrollable(microstrategy.findAncestorWithTag(oFromList,"TABLE"));}}catch(err){alert(err.value);}};mstrDerivedElementsEditorImpl.prototype.moveItemInSelectedList=function(sList,sDirection,sAnswerList){try{var oForm=getObj("feForm");var i;var lLength;var oList=getObj(sList);var oOption;lLength=oList.options.length;var upButton=document.getElementById("de_tbUp");var downButton=document.getElementById("de_tbDown");if((upButton&&sDirection=="Up"&&upButton.getAttribute("disabled")=="true")||(downButton&&sDirection!="Up"&&downButton.getAttribute("disabled")=="true")){return ;}for(i=0;i<lLength;i++){oOption=oList.options[i];if((oOption)&&(oOption.selected==true)){if(sDirection=="Up"){if(i>0){oList.remove(i);oList.options.add(oOption,i-1);break;}}else{if(i<lLength-1){oList.remove(i);oList.options.add(oOption,i+1);break;}}}}BuildFilterSelections(sAnswerList,sList);this.updateUpDownButtons(document.getElementById(sList));}catch(err){alert(err.value);}};mstrDerivedElementsEditorImpl.prototype.updateAddRemoveButtons=function(oAvailable,oSelected){if(oAvailable){this.updateMoveButton(oAvailable,"de_tbAdd","de_tbAddAll");}if(oSelected){this.updateMoveButton(oSelected,"de_tbRemove","de_tbRemoveAll");}};mstrDerivedElementsEditorImpl.prototype.updateMoveButton=function(oList,moveSingleId,moveAllId){if(oList){var moveSingleButton=document.getElementById(moveSingleId);var moveAllButton=document.getElementById(moveAllId);var oOptions=oList.options;if(!oOptions){return ;}var lLength=oOptions.length;var oOption;var enableSingle;var enableAll;if(moveAllButton){moveAllButton.firstChild.className=moveAllButton.firstChild.className.replace("Disabled","");if(moveAllButton.getAttribute("disabled")){moveAllButton.removeAttribute("disabled");}}if(moveSingleButton){moveSingleButton.firstChild.className=moveSingleButton.firstChild.className.replace("Disabled","");if(moveSingleButton.getAttribute("disabled")){moveSingleButton.removeAttribute("disabled");}}if(this.usage!=1||(moveSingleId=="de_tbAdd"||moveAllId=="de_tbAddAll")){for(var i=0;i<lLength;i++){oOption=oList.options[i];if(oOption.value!="-none-"){if(oOption.selected){enableSingle=true;}if(!oOption.disabled){enableAll=true;}if(enableSingle&&enableAll){break;}}}}if(!enableAll&&moveAllButton){moveAllButton.firstChild.className+="Disabled";moveAllButton.setAttribute("disabled","true");}if(!enableSingle&&moveSingleButton){moveSingleButton.firstChild.className+="Disabled";moveSingleButton.setAttribute("disabled","true");}}};mstrDerivedElementsEditorImpl.prototype.updateUpDownButtons=function(oList){if(!oList){return ;}var upButton=document.getElementById("de_tbUp");var downButton=document.getElementById("de_tbDown");if(!upButton||!downButton){return ;}var lLength,oOption;var iFirst=-1;var iLast=-1;var bSelected=false;var lLength=oList.options.length;for(i=0;i<lLength;i++){oOption=oList.options[i];if(oOption.selected){bSelected=true;if(iFirst==-1){iFirst=i;}iLast=i;}}upButton.firstChild.className=upButton.firstChild.className.replace("Disabled","");downButton.firstChild.className=downButton.firstChild.className.replace("Disabled","");if(upButton.getAttribute("disabled")){upButton.removeAttribute("disabled");}if(downButton.getAttribute("disabled")){downButton.removeAttribute("disabled");}if(iFirst<=0||!bSelected){upButton.firstChild.className+="Disabled";upButton.setAttribute("disabled","true");}if(iLast==lLength-1||!bSelected){downButton.firstChild.className+="Disabled";downButton.setAttribute("disabled","true");}this.updateMoveButton(oList,"de_tbRemove","de_tbRemoveAll");};mstrDerivedElementsEditorImpl.prototype.setRefreshDEComponent=function(name,oform,value,updateManager){try{var errMsg=document.getElementById("deEderrorMessage");if(errMsg){errMsg.innerHTML="";}name="refreshElement"+name;var v=(value)?"1":"0";if(oform!=null){return updateDynamicInput(oform,name,v);}if(updateManager!=null){return updateManager.replaceURL(name,v);}}catch(err){microstrategy.errors.log(err);}};