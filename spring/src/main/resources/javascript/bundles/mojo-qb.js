mstrmojo.warehouse.EnumDatabaseType={SAP:1200,MSAS:1500,EssBase:1600,TM1:2900,SAPHana:4000,BDE:5400,SearchEngineSOLR:5500,SearchEngineSPLUNK:5600};(function(){function AJ(Ap,Aq){return Aq||(Ap||window).event;}mstrmojo.PositionType=null;var Am=!!document.all,AH=document.documentMode,q=navigator.userAgent,j=false,g=false,e=false,d=false,R=false,t=false;if(Am){if(window.mstrConfig&&mstrConfig.isEdgeModeEnabled){j=!!q.match(/MSIE 6/);g=((!!q.match(/MSIE 7/)&&!AH)||AH===7);e=(AH===8);d=(AH===9);R=(AH===10);t=(!AH||AH<=9);}else{j=!!q.match(/MSIE 6/);g=!!q.match(/MSIE 7/);e=!!q.match(/MSIE 8/);d=!!q.match(/MSIE 9/);R=!!q.match(/MSIE 10/);t=!R;}}var c=!Am&&!!q.match(/Firefox/),l=0,r=!!q.match(/Android/),Ad=!!q.match(/iPad/),AN=!!q.match(/iPhone/),AV=!!document.createTouch||r,p=!!q.match(/PlayBook/),O=!!q.match(/Windows Phone/),An=!Am&&!!q.match(/Trident.*rv/),b=c?"-moz-":(Am||An)?"":"-webkit-",AI=c?"Moz":(R||An)?"":Am?"ms":"webkit",AS=((R||An)?"t":"T"),AM=AI+AS+"ransition";function Ah(){return AI+AS+"ransform";}function AF(){return AM+"Property";}function S(){return AM+"Duration";}function N(){return(R||c)?"transitionend":"webkitTransitionEnd";}function f(){return AI+"BoxShadow";}var Ak=Ah(),Aa=AF(),AA=S(),A=N(),n=f();function AR(){if(!l&&c){var Ap=q.match(/.*Firefox\/([\d|\.]*).*/);if(Ap){l=parseFloat(Ap[1]);}}return l;}function AX(){var Aq=0,Au=0,Ar=window,As=document,Ap=As.body,At=As.documentElement;if(typeof Ar.pageYOffset==="number"){Au=Ar.pageYOffset;Aq=Ar.pageXOffset;}else{if(Ap&&(Ap.scrollLeft||Ap.scrollTop)){Au=Ap.scrollTop;Aq=Ap.scrollLeft;}else{if(At&&(At.scrollLeft||At.scrollTop)){Au=At.scrollTop;Aq=At.scrollLeft;}}}return{x:Aq,y:Au};}function AG(Ap){Ap=Ap||0;Ap=String(Ap);return((Ap.indexOf("%",0))!==-1)?Ap:(Ap+"px");}function AP(Ar,Av,Au,At,As){if(!mstrmojo.dom.isWinPhone){At=(At||false||this.isHWAccelerated);}else{At=false;}var Aq=As+(At?"3d":"")+"(",Ap=At?(","+Au+")"):")";return Aq+Ar+","+Av+Ap;}var Ab=2,V=3;function u(Av,Au,Ay){var Ax=Av.style,Ar=Ax.display,At=this.windowDim(),As=AX();Ax.display="block";var Aw=At.w-Av.clientWidth,Az=Math.max(At.h-Av.clientHeight,0),Ap={4:0,5:Aw,3:Aw/2},Aq={1:0,3:Az/2,2:Az};Ax.left=Ap[Au]+As.x+"px";Ax.top=Aq[Ay]+As.y+"px";Ax.display=Ar;}function m(As,Ar,At,Ap){if(As.addEventListener){return As.addEventListener(Ar,At,!!Ap);}At._id=At._id||m.guid++;As.events=As.events||{};var Aq=As.events[Ar];if(!Aq){Aq=As.events[Ar]={};if(As["on"+Ar]){Aq[0]=As["on"+Ar];}}Aq[At._id]=At;function Au(Ax){Ax=Ax||window.event;var Aw=this.events[Ax.type],Av;for(Av in Aw){Aw[Av].call(this,Ax);}}As["on"+Ar]=Au;}m.guid=1;function h(Ar,Aq,As,Ap){if(!Ar){return ;}if(Ar.removeEventListener){Ar.removeEventListener(Aq,As,!!Ap);}else{if(Ar.events&&Ar.events[Aq]){delete Ar.events[Aq][As._id];}}}mstrmojo.Enum_Keys={BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46};mstrmojo.dom=mstrmojo.provide("mstrmojo.dom",{userAgent:q,isIE:Am,isIE6:j,isIE7:g,isIE8:e,isIE9:d,isIE10:R,isIEW3C:An,isNSIE:t,isDXIE:t,isFF:c,isWK:!!q.match(/AppleWebKit/),isSafari:!!q.match(/Safari/)&&!q.match(/Chrome/),isChrome:!!q.match(/AppleWebKit/)&&q.match(/Chrome/),isHWAccelerated:!r,isAndroid:r,isIPad:Ad,isPlayBook:p,isWinPhone:O,isMobile:Ad||AN||O||r,supportsTouches:AV,TOUCHSTART:AV?"touchstart":"mousedown",TOUCHMOVE:AV?"touchmove":"mousemove",TOUCHEND:AV?"touchend":"mouseup",TOUCHCANCEL:AV?"touchcancel":"",RESIZE:AV?"orientationchange":"resize",CSS3_PREFIX:b,CSS3_BOXSHADOW:n,CSS3_TRANSFORM:Ak,CSS3_TRANSITION:AM,CSS3_TRANSITION_PROPERTY:Aa,CSS3_TRANSITION_DURATION:AA,CSS3_TRANSITION_END:A,cssFeatures:{GRADIENTS:"gd",ROUND_CORNERS:"rc",TEXT_ROTATION:"tr",DROP_SHADOW:"sh"},htmlFeatures:{FILE_READER:"fr"},MOUSE_BUTTON:{LEFT:1,RIGHT:2},supports:function B(Ap){var Aq=this.isFF&&AR();switch(Ap){case this.cssFeatures.GRADIENTS:return(this.isIE||this.isIEW3C||this.isWK||Aq>=3.6||this.isWinPhone);case this.cssFeatures.ROUND_CORNERS:return(this.isWK||this.isFF||this.isWinPhone||this.isIE10);case this.cssFeatures.TEXT_ROTATION:case this.cssFeatures.DROP_SHADOW:return(this.isIE||this.isWK||Aq>=3.5||this.isWinPhone||this.isIE10||this.isIEW3C);case this.htmlFeatures.FILE_READER:return !!(window.FileReader);}return false;},getOSInfo:function AO(){var Au="Unknown",Aq=navigator.appVersion,At=navigator.userAgent,As=Au;var Ap=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];var Ar;for(Ar=0;Ar<Ap.length;Ar++){var Aw=Ap[Ar];if(Aw.r.test(At)){As=Aw.s;break;}}var Av=Au;if(/Windows/.test(As)){Av=/Windows (.*)/.exec(As)[1];As="Windows";}switch(As){case"Mac OS X":Av=/Mac OS X (10[\.\_\d]+)/.exec(At)[1];break;case"Android":Av=/Android ([\.\_\d]+)/.exec(At)[1];break;case"iOS":Av=/OS (\d+)_(\d+)_?(\d+)?/.exec(Aq);Av=Av[1]+"."+Av[2]+"."+(Av[3]|0);break;}return{name:As,version:Av};},transEndEvtNames:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},replace:function o(Ar,Ap){if(Ar&&Ap){var Aq=Ar.parentNode;if(Aq){Aq.replaceChild(Ap,Ar);}}return Ap;},attachEvent:function X(Ar,Aq,As,Ap){if(Ar.addEventListener){return Ar.addEventListener(Aq,As,!!Ap);}return Ar.attachEvent("on"+Aq,As);},detachEvent:function AZ(Ar,Aq,As,Ap){if(!Ar){return ;}if(Ar.removeEventListener){Ar.removeEventListener(Aq,As,!!Ap);}else{Ar.detachEvent("on"+Aq,As);}},attachMarkupEvent:function x(As,Ar,Ap){var Aq=function(At){mstrmojo.all[As].captureDomEvent(Ap,window,At);};this.attachEvent(Ar,Ap,Aq);return Aq;},attachOneTimeEvent:function W(As,Aq,At,Ap){var Ar=function(Au){At(Au);if(Ap){h(this,Aq,Ar);}else{mstrmojo.dom.detachEvent(this,Aq,Ar);}};if(Ap){m(As,Aq,Ar);}else{this.attachEvent(As,Aq,Ar);}As=null;return Ar;},attachMouseMoveEvents:function D(As,Ap){var Ar=this,Aq=function(At){if(Ap){Ap(At);}Ar.detachEvent(document,"mousemove",As);Ar.detachEvent(document,"mouseup",Aq);};Ar.attachEvent(document,"mousemove",As);Ar.attachEvent(document,"mouseup",Aq);},captureDomEvent:function AL(Au,As,Aq,At,Ar){var Ap=mstrmojo.all[Au];if(Ap){Ap.captureDomEvent(As,Aq,At,Ar);}},translate:function L(Ar,Aq,Au,At,Ap,As){Ap=(Ap&&" "+Ap)||"";Ar.style[((mstrmojo.dom.isWinPhone||mstrmojo.dom.isIE9||mstrmojo.dom.isIE10)?"ms":"webkit")+"Transform"]=this.createTranslateString(Aq,Au,At,As)+Ap;},createTranslateString:function P(Ap,As,Ar,Aq){Ap=AG(Ap);As=AG(As);Ar=AG(Ar);return AP(Ap,As,Ar,Aq,"translate");},createScaleString:function w(Ap,As,Ar,Aq){Ap=Ap||0;As=As||0;Ar=Ar||0;return AP(Ap,As,Ar,Aq,"scale");},_bufferSize:200,_bufferConnects:{},attachBufferedEvent:function C(Ar,Ap,As,Au){var Aq=Ar.id+"-"+Ap,At=this._bufferConnects[Aq];if(!At){At=this._bufferConnects[Aq]={elId:Ar.id,eventName:Ap,timer:null,bufferSize:Au,listeners:[],callback:function(Av){mstrmojo.dom._callback(Av,mstrmojo.global,Aq);return true;}};this.attachEvent(Ar,Ap,At.callback);}At.listeners.push(As);},_callback:function Ag(At,Ap,Ar){var As=this._bufferConnects[Ar],Au=As&&As.timer;if(As&&!Au){var Aq=(As.bufferSize===null)?this._bufferSize:As.bufferSize;if(As.bufferSize){As.timer=Ap.setTimeout(function(){mstrmojo.dom.updateBuffers(Ar);},Aq);}else{mstrmojo.dom.updateBuffers(Ar);}}},updateBuffers:function H(As){var At=this._bufferConnects[As],Aq=At&&At.listeners,Ap=(Aq&&Aq.length)||0,Ar;for(Ar=0;Ar<Ap;Ar++){Aq[Ar]();}if(At&&At.timer){delete At.timer;}},detachBufferedEvent:function AD(Aq,Au,Av){if(!Aq){return ;}var Ax=Aq.id+"-"+Au,Ar=this._bufferConnects[Ax],At=Ar&&Ar.listeners,Aw=(At&&At.length)||0,As;if(Aw){for(As=Aw-1;As>-1;As--){if(At[As]===Av){At.splice(As,1);}}if(!At.length){this.detachEvent(Aq,Au,Ar.callback);delete this._bufferConnects[Ax];if(Ar.timer){var Ap=mstrmojo.global;Ap.clearTimeout(Ar.timer);}}}},eventTarget:function AB(Ap,Aq){Aq=AJ(Ap,Aq);return Aq.target||Aq.srcElement;},isMac:function z(){return this.getOSInfo().name.toLowerCase().indexOf("mac")>=0;},isMetaKey:function J(Ap,As){var Ar=this.getOSInfo().name.toLowerCase().indexOf("mac")>=0,Aq=AJ(Ap,As)||{};return(Aq.ctrlKey&&!Ar)||(Aq.metaKey&&Ar);},ctrlKey:function Aj(Ap,Aq){return(AJ(Ap,Aq)||{}).ctrlKey;},shiftKey:function AC(Ap,Aq){return(AJ(Ap,Aq)||{}).shiftKey;},metaKey:function Z(Ap,Aq){return(AJ(Ap,Aq)||{}).metaKey;},getButton:function AT(Ap,Aq){return((Number(AJ(Ap,Aq).button))===2)?2:1;},isPrimaryMouseBtn:function Ae(Aq,Ap){return this.getButton(Ap||window,Aq)===1;},getMousePosition:function k(As,Ar){Ar=Ar||window;var Aq,Av;if(mstrmojo.dom.isIE){As=As||Ar.event;var At=document,Ap=At.body,Au=At.documentElement;Aq=As.clientX+Ap.scrollLeft+(Au.scrollLeft||0);Av=As.clientY+Ap.scrollTop+(Au.scrollTop||0);}else{Aq=As.pageX;Av=As.pageY;}return{x:Aq,y:Av};},position:function AU(Aq,Ar){var Au={x:0,y:0,w:0,h:0};if(Aq&&Aq.getBoundingClientRect){try{Au=Aq.getBoundingClientRect();}catch(At){Au={left:0,top:0,right:0,bottom:0,height:0,width:0};}Au={x:Au.left,y:Au.top,w:Au.right-Au.left,h:Au.bottom-Au.top};if(this.isIE6||this.isIE7){var Ap=Aq.ownerDocument;if(Ap){var Aw=Ap.documentElement,Av=Aw.getBoundingClientRect();Au.x-=Av.left;Au.y-=Av.top;}}}if(Ar){var As=AX();Au.x+=As.x;Au.y+=As.y;}return Au;},delta:function F(Ar,Ap){Ap=Ap||document.body;var Aq=this.position(Ar),As=this.position(Ap);return{x:Math.round(Aq.x-As.x),y:Math.round(Aq.y-As.y)};},windowDim:function Q(){var Ap=0,Ar=0,As=window,At=document,Au=At.documentElement,Aq=At.body;if(typeof (As.innerWidth)=="number"&&typeof (As.innerHeight)=="number"){Ap=As.innerWidth;Ar=As.innerHeight;}else{if(Au&&(Au.clientWidth||Au.clientHeight)){Ap=Au.clientWidth;Ar=Au.clientHeight;}else{if(Aq&&(Aq.clientWidth||Aq.clientHeight)){Ap=Aq.clientWidth;Ar=Aq.clientHeight;}}}return{w:Ap,h:Ar};},center:function AK(Ap){u.call(this,Ap,V,V);},bottomCenter:function E(Ap){u.call(this,Ap,V,Ab);},clearBrowserHighlights:function K(Ap){Ap=Ap||self;if(!Ap.getSelection){var Av=Ap.document,Au=Av&&Av.selection,As=Au&&Au.empty;if(As){try{Au.empty();}catch(Ar){}}}else{var Aq=Ap.getSelection,At=Aq&&Ap.getSelection();if(At&&!At.isCollapsed){if(At.empty){At.empty();}else{if(At.removeAllRanges){At.removeAllRanges();}}}}},findAncestorByAttr:function AQ(At,Ar,Aq,Ap){var Au=Aq?At:At&&At.parentNode;while(Au&&(Au!==Ap)){var As=Au.getAttribute&&Au.getAttribute(Ar);if(As!=null){return{node:Au,value:As};}Au=Au.parentNode;}return null;},findAncestorByName:function Ai(Ar,Au,Aq,Ap){Au=Au&&Au.toLowerCase();var As=Aq?Ar:Ar&&Ar.parentNode;while(As&&(As!==Ap)){var At=As.nodeName;if(At&&(At.toLowerCase()===Au)){return As;}As=As.parentNode;}return null;},contains:function I(As,At,Aq,Ap){var Ar=At;if(!Aq){Ar=Ar.parentNode;}while(Ar){if(Ar===As){return true;}if(Ar===Ap){break;}Ar=Ar.parentNode;}return false;},toggleSelection:function Ao(Aq,Ap){Aq.setAttribute("unselectable",Ap?"off":"on");mstrmojo.css.toggleClass(Aq,"unselectable",!Ap);Aq.onselectstart=function(){return Ap;};if(!Ap){this.clearBrowserHighlights();}},preventDefault:function U(Ap,Aq){Aq=Aq||Ap.event;if(Aq.preventDefault){Aq.preventDefault();}else{Aq.returnValue=false;}},stopPropogation:function M(Ap,Aq){Aq=Aq||Ap.event;if(Aq.stopPropagation){Aq.stopPropagation();}else{Aq.cancelBubble=true;}},firstTouch:function AW(Ap,Aq){return Aq&&Aq.touches&&Aq.touches.length?Aq.touches[0]:(Aq||Ap.event);},firstChangedTouch:function Ac(Ap,Aq){return Aq&&Aq.changedTouches&&Aq.changedTouches.length?Aq.changedTouches[0]:(Aq||Ap.event);},isLandscape:function T(){return !this.supportsTouches||(Math.abs(window.orientation)===90);},findWidget:function AY(Ap){while(Ap){var Aq=Ap.mstrmojoId;if(Aq!==null&&Aq!==undefined){return mstrmojo.all[Aq];}Ap=Ap.parentNode;}return null;},setCaret:function G(Ap,Ar){if(Ap.setSelectionRange){Ap.focus();Ap.setSelectionRange(Ar,Ar);}else{if(Ap.createTextRange){var Aq=Ap.createTextRange();Aq.move("character",Ar);Aq.select();}}},setInputSelection:function Y(Ap){if(Ap.select){Ap.focus();Ap.select();}else{if(Ap.createTextRange){Ap.createTextRange().select();}}},setElementSelection:function a(Ar){if(window.getSelection){var Ap=document.createRange(),Aq=window.getSelection();Ap.selectNodeContents(Ar);Aq.removeAllRanges();Aq.addRange(Ap);}else{if(document.body.createTextRange){var As=document.body.createTextRange();As.moveToElementText(Ar);As.select();}}},getHorizontalScroll:function Al(){return AX().x;},getVerticalScroll:function AE(){return AX().y;},removeNode:function Af(Ar){var Aq=document.getElementById(Ar),Ap=Aq&&Aq.parentNode;if(Ap){return Ap.removeChild(Aq);}}});}());mstrmojo.warehouse.EnumDataChangeEvents={DBROLES_REQUESTED:"dbRolesRequested",DBROLES_LOADED:"dbRolesLoaded",DBROLES_ADD:"dbRoleAdd",DBROLES_RENAME:"dbRoleRename",DBROLES_DELETE:"dbRoleDelete",DBROLE_SELECTION:"dbroleSelection",NAMESPACES_CHANGED:"namespacesChanged",NAMESPACES_REQUESTED:"namespacesRequested",DBTABLES_CHANGED:"dbTablesChange",DBTABLES_REQUESTED:"dbTablesRequested",DBTABLE_UPDATED:"dbTableUpdated",DBROLE_CHANGED:"dbRoleChanged",DBTABLES_USED:"dbTablesUsed",DBTABLES_ENABLED:"dbTablesEnabled"};(function(){mstrmojo.warehouse._CanToggleAvatarClass=mstrmojo.provide("mstrmojo.warehouse._CanToggleAvatarClass",{_mixinName:"mstrmojo.warehouse._CanToggleAvatarClass",getAvatarIconClass:function C(D){return"enabled";},ondragenter:function A(D){var E=D.src.widget;if(E&&E.toggleAvatarClass&&this.allowDrop(D)){E.toggleAvatarClass(this.getAvatarIconClass(D),true);}if(this._super){this._super(D);}},ondragleave:function B(D){var E=D.src.widget;if(E&&E.toggleAvatarClass&&this.allowDrop(D)){E.toggleAvatarClass(this.getAvatarIconClass(D),false);}if(this._super){this._super(D);}}});}());(function(){mstrmojo.boxmodel=mstrmojo.provide("mstrmojo.boxmodel",{rangeIntersect:function E(J,H,I,G){if(J<I){return I<=H;}if(J>I){return J<=G;}return true;},px2Inches:function C(H,G){G=parseInt(G,10);return mstrmojo.NumberFormat.getInstance(mstrConfig.decimalSep,mstrConfig.thousandsSep).format(parseFloat((G/H.zf/H.dpi).toFixed(4)));},offset:function F(I,H){var L=I,G=0,K=0;while(I){G+=I.offsetLeft;K+=I.offsetTop;I=I.offsetParent;if(I===H){break;}}var J;for(J=L&&L.parentNode;J&&J!==H;J=J.parentNode){if(J.scrollTop){K-=J.scrollTop;}if(J.scrollLeft){G-=J.scrollLeft;}}return{left:G,top:K};},convert2px:function D(K,I){if(!/px$/.test(I)){var H=document.createElement("img"),G=H.style,J;G.zIndex=-1;G.left=I;K.appendChild(H);J=G.pixelLeft;K.removeChild(H);return J+"px";}return I;},getEdgeQuadrantByPoint:function B(I,H){var G=H.x-I.x,M=H.y-I.y,J=I.w,L=I.h,K=[["Left","Bottom"],["Top","Right"]];if(M>L/J*G){K=K[0];}else{K=K[1];}return(M<-L/J*G+L)?K[0]:K[1];},isPtInPolygon:function A(I,K){var G=I.x,J=I.y,H=false;K.forEach(function(N,L){var M=K[L-1]||K[K.length-1];if((N.y>=J)!==(M.y>=J)){if((G<(M.x-N.x)*(J-N.y)/(M.y-N.y)+N.x)){H=!H;}}});return H;}});}());mstrmojo.mstr.EnumDataType={DataTypeUnknown:-1,DataTypeReserved:0,DataTypeInteger:1,DataTypeUnsigned:2,DataTypeNumeric:3,DataTypeDecimal:4,DataTypeReal:5,DataTypeDouble:6,DataTypeFloat:7,DataTypeChar:8,DataTypeVarChar:9,DataTypeLongVarChar:10,DataTypeBinary:11,DataTypeVarBin:12,DataTypeLongVarBin:13,DataTypeDate:14,DataTypeTime:15,DataTypeTimeStamp:16,DataTypeShort:21,DataTypeLong:22,DataTypeMBChar:23,DataTypeBool:24,DataTypePattern:25,DataTypeBigDecimal:30,DataTypeCellFormatData:31,DataTypeInt64:34};mstrmojo.EnumAuthenticationModes={DEFAULT:0,STANDARD:1,NTCREDENTIAL:2,PASSTHRU:4,ANONYMOUS:8,LDAP:16,DATABASE:32,PLUGIN:64,INTEGRATED:128,USHER:256};(function(){mstrmojo.qb.OneTierServerTransport={serverRequest:function A(E,D,C){window.FormWrapper.serverRequest(D,JSON.stringify(C.params),E,"response");},cancelRequest:function B(C){return false;}};}());(function(){mstrmojo._HasPopup=mstrmojo.provide("mstrmojo._HasPopup",{_mixinName:"mstrmojo._HasPopup",_lastOpened:null,openPopup:function A(G,E){var C=!!G&&(typeof G==="string")&&!G.match(/\./)&&!!this[G],D=mstrmojo.registry.ref(C?this[G]:G);if(D&&D.open){if(C){this[G]=D;}if(D.disposable!==false){this.addDisposable(D);}var J=D.slot&&this[D.slot];if(J){if(D.parent!==this){if(this.addChildren){this.addChildren([D]);}else{var I=false,F=D.domNode||D.placeholder;if(F&&typeof F==="string"){F=document.getElementById(F);}if(!F){I=true;F=document.createElement("span");D.placeholder=F;}if(I||(F.parentNode!==J)){J.appendChild(F);}}}}try{D.open(this,E);}catch(H){console.log("Error opening popup: "+H);}this._lastOpened=D;}},closePopup:function B(){var C=this._lastOpened;if(C&&C.visible&&C.close){C.close();delete this._lastOpened;}}});}());mstrmojo.architect.EnumDragActions={ADD_TABLE:"addTable",ADD_COLUMN:"addColumn",TABLE_VIEW_ATTR:"tableViewItemAttr",TABLE_VIEW_METRIC:"tableViewItemMetric",PROJECT_TABLE:"projectTable",PROJECT_TABLE_COLUMN:"projectTableColumn",LINKER_ATTR:"linkerAttr",COMPOUND_FORM:"compoundForm"};(function(){mstrmojo.vi._MonitorsAppState=mstrmojo.provide("mstrmojo.vi._MonitorsAppState",{onAppStateChange:function(B){if(this._super){this._super(B);}},init:function A(B){this._super(B);if(mstrApp.attachEventListener){mstrApp.attachEventListener("appStateChange",this.id,"onAppStateChange");}}});}());mstrmojo.vi.viz.EnumVizStyles={GRAPH_MATRIX:"GraphMatrixVisualizationStyle",NETWORK:"NetworkVisualizationStyle",HEAT_MAP:"VIHeatMapVisualizationStyle",GOOGLE_MAP:"GoogleMapVisualizationStyle",ESRI_MAP:"ESRIMapVisualizationStyle",IMAGE_LAYOUT:"ImageLayoutVisualizationStyle"};(function(){function Q(U,R,S){if(U.nodeType===3&&R){return U;}else{var T=(R&&U.nodeType===1&&U.lastChild)?U.lastChild:F(U,S);return T?D(T,S):null;}}function F(S,R){return(S===R)?null:(S.previousSibling||F(S.parentNode,R));}function D(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.lastChild){return D(S.lastChild);}else{return D(F(S,R));}}}function I(R){return R.textContent||R.nodeValue||R.innerText;}function M(U,R,S){if(U.nodeType===3&&R){return U;}else{var T=(R&&U.nodeType===1&&U.firstChild)?U.firstChild:B(U,S);return T?E(T,S):null;}}function B(S,R){return(S===R)?null:(S.nextSibling||B(S.parentNode,R));}function E(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.firstChild){return E(S.firstChild);}else{return E(B(S,R));}}}mstrmojo.range=mstrmojo.provide("mstrmojo.range",{EDGE:{EDGE_BEGIN:1,EDGE_END:2,EDGE_MIDDLE:-1},getEdgeInfo:function P(T,U){var R=0,S;if(T.nodeType===1){if(window.getSelection){S=document.createRange();S.selectNode(T);R=S.toString().length;}else{S=document.body.createTextRange();S.moveToElementText(T);R=S.text.length;}}else{R=I(T).length;}return U===R?this.EDGE.EDGE_END:(U===0?this.EDGE.EDGE_BEGIN:this.EDGE.EDGE_MIDDLE);},collapseOnNode:function K(U,S){if(!U.offsetParent){return ;}var T=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(U);R.collapse(S);T.removeAllRanges();T.addRange(R);}else{R.moveToElementText(U);R.collapse(S);R.select();}},collapseOnTextNode:function L(U,V){var T=this.getSelection(),S=this.getRange();if(window.getSelection){var R=M(U,true);S.setStart(R,V);S.collapse(true);T.removeAllRanges();T.addRange(S);}else{S.moveToElementText(U);S.collapse(true);S.move("character",V);S.select();}},collapseOnTextNodeIE:function C(S,T){var U=M(S,true),R;while(U!==null){R=I(U).length;if(R>=T){this.collapseOnTextNode(U,T);break;}else{T-=R;U=M(U,false);}}},getRangeInfo:function J(X,e){var Z=null,k,c=this.getRange(),b;if(X&&X===c.startContainer){var g=c.startContainer.firstChild,U=g&&g.firstChild,d=U&&U.firstChild;if(d){c.setStart(d,c.startOffset);c.setEnd(d,c.endOffset);}}if(window.getSelection){var W=function(m,o,n){var l=m.cloneRange();l.collapse(n);l.setStartBefore(o);return l.toString().length;},S=c.startContainer,f=c.startOffset;if(S.nodeType===1){f=W(c,S,true);}Z={collapsed:c.collapsed,startContainer:S,startOffset:e?e.startOffset:f};if(!c.collapsed){var V=c.endContainer,R=c.endOffset;if(V.nodeType===1){R=W(c,V,false);}Z.endContainer=V;Z.endOffset=R;}Z.range=c;}else{var j,a,Y=function(o,p){var n=o.duplicate(),l=document.body.createTextRange(),m;n.collapse(p);m=n.parentElement();l.moveToElementText(m);l.setEndPoint("EndToStart",n);return{container:m,offset:l.text.length};},h=Y(c,true),T;Z={collapsed:(c.compareEndPoints("StartToEnd",c)===0),startContainer:h.container,startOffset:h.offset};if(!Z.collapsed){T=Y(c,false);Z.endContainer=T.container;Z.endOffset=T.offset;}}return Z;},collapse:function O(S){if(window.getSelection){var T=this.getSelection();if(S){T.collapseToStart();}else{T.collapseToEnd();}}else{var R=this.getRange();R.collapse(S);R.select();}},selectSingleNode:function H(T){var S=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(T);S.removeAllRanges();S.addRange(R);}else{R.moveToElementText(T);R.select();}},selectMultipleNodes:function N(W,S,X,U){var V=this.getSelection(),T=this.getRange();if(window.getSelection){T.setStart(W,S);T.setEnd(X,U);V.removeAllRanges();V.addRange(T);}else{W=(W.nodeType===3)?W.parentNode:W;T.moveToElementText(W);T.move("character",S);X=(X.nodeType===3)?X.parentNode:X;var R=document.body.createTextRange();R.moveToElementText(X);R.move("character",U);T.setEndPoint("EndToStart",R);T.select();}},getSelection:function G(){if(window.getSelection){return window.getSelection();}else{return document.selection;}},getRange:function A(){if(window.getSelection){selection=window.getSelection();if(selection.rangeCount>0){return selection.getRangeAt(0);}else{return document.createRange();}}else{return document.selection.createRange();}}});}());mstrmojo.warehouse.EnumObjectTypes={FILTER:1,METRIC:4,ATTRIBUTE:12,FACT:13,DIMENSION:14,TABLE:15,TABLE_LOGICAL_VIEW:151,TABLE_PARTITION:152,FORM:21,COLUMN:26,DBROLE:29,PROJECT:32,TRANSFORMATION:43,DBTABLE:53,LAYER:70,RELATIONSHIP:99,COMPOUND_FORM:1001,RELATIONSHIP_ATTRIBUTE:1002};mstrmojo.warehouse.EnumNamespaceMode={ALL:"0",CURRENT:"1"};mstrmojo.vi.models.EnumDragSources={DATASETS:1,VIZ_EDITOR:2,FILTERS:3,ALL_OBJECT_LIST:4,VIZ:5};mstrmojo.architect.menu.EnumMenuActions={NONE:0,DELETE:1,RENAME:2,AUTOMAP:3,UPSTRUCT:4,ADD_ATTRIBUTE:5,ADD_FACT:6,CREATE_ALIAS:7,SET_AS_PRIMARY:8,IS_PRIMARY:9,SAMPLE_DATA:10,CONVERT_ATTR_TO_FACT:11,CONVERT_ATTR_TO_FORM:12,CONVERT_FACT_TO_ATTR:13,REMOVE_FROM_TABLE:14,SET_AS_LOOKUP:15,SET_AS_FORM:16,NEW_FACT:17,NEW_ATTR:18,UPDATE_FORMAT:19,EDIT:20,MAPPING:21,AGGREGATION:22,DATA_TYPE:23,UPDATE_AGGR:24,DATA_SOURCES:25,REMOVE_TABLE:26,REMOVE_ATTR_FROM_RELATIONSHIP:27,ONE_TO_ONE:28,ONE_TO_MANY:29,MANY_TO_MANY:30,DELETE_RELATIONSHIP:31,RELATIONSHIP_TABLE:32,RELATIONSHIP_TABLE_ENTRY:33,SHOW_UNUSED_COLUMNS:34,ADD_TO_LAYER:35,REMOVE_FROM_LAYER:36,COLUMN_DEF:37,LINKS:38,CONVERT_COLUMN_TO_FORM:39,ADD_TO_PROJECT:40,LOGICAL_TABLE_SIZE:41,SET_AS_MULTILINGUAL:42,FORM_CATEGORY:43,UPDATE_CATEGORY:44,UNGROUP_FORMS:45,GROUP_FORM:46,UNGROUP_FORM:47,UPDATE_GROUP:48,DUPLICATE:49,TX_ONE_TO_ONE:50,TX_MANY_TO_MANY:51,TX_APPLY_TO_ALL:52,TX_APPLY_TO_HIGHEST:53,SET_ENTRY_POINT:54,REMOVE_ENTRY_POINT:55,REL_ATTR_ELEMENT_DISPLAY:56,ATTRIBUTE_FILTERS:57,BROWSE_ATTRIBUTES:58,REL_ATTR_ELEMENT_LIMIT:59,REL_ATTR_ELEMENT_LOCK:60,REL_ATTR_ELEMENT_UNLOCK:61,ADD_JOIN_CHILDREN:62,USE_AS_DRILL:63,USE_AS_BROWSE:64,CATALOG_SQL:65};mstrmojo.mstr.EnumFunction={FunctionCustom:-1,FunctionReserved:0,FunctionPlus:1,FunctionMinus:2,FunctionTimes:3,FunctionDivide:4,FunctionUnaryMinus:5,FunctionEquals:6,FunctionNotEqual:7,FunctionGreater:8,FunctionLess:9,FunctionGreaterEqual:10,FunctionLessEqual:11,FunctionSum:12,FunctionCount:13,FunctionAvg:14,FunctionMin:15,FunctionMax:16,FunctionBetween:17,FunctionLike:18,FunctionAnd:19,FunctionOr:20,FunctionNot:21,FunctionIn:22,FunctionRank:23,FunctionAbs:24,FunctionRunningSum:25,FunctionRunningAvg:26,FunctionMovingSum:28,FunctionMovingAvg:27,FunctionProduct:29,FunctionMedian:30,FunctionMode:31,FunctionStdev:32,FunctionVar:33,FunctionGeomean:34,FunctionEqualEnhanced:35,FunctionNotEqualEnhanced:36,FunctionGreaterEqualEnhanced:37,FunctionLessEqualEnhanced:38,FunctionBetweenEnhanced:39,FunctionBanding:40,FunctionBandingC:41,FunctionBandingP:42,FunctionNotLike:43,FunctionNotBetween:44,FunctionIntersect:45,FunctionIntersectIn:46,FunctionNullToZero:47,FunctionZeroToNull:48,FunctionApplySimple:49,FunctionApplyAggregation:50,FunctionApplyLogic:51,FunctionApplyComparison:52,FunctionApplyRelative:53,FunctionIsNull:54,FunctionIsNotNull:55,FunctionUcase:56,FunctionNotIn:57,FunctionNTile:58,FunctionPercentile:59,FunctionMovingMax:60,FunctionMovingMin:61,FunctionMovingDifference:62,FunctionMovingStdev:63,FunctionExpWghMovingAvg:64,FunctionMovingCount:65,FunctionRunningMax:66,FunctionRunningMin:67,FunctionRunningStdev:68,FunctionRunningCount:69,FunctionExpWghRunningAvg:70,FunctionNotBetweenEnhanced:71,FunctionConcat:72,FunctionFirstInRange:73,FunctionLastInRange:74,FunctionValueSegment:75,FunctionContains:76,FunctionBeginsWith:77,FunctionEndsWith:78,FunctionNotContains:79,FunctionNotBeginsWith:80,FunctionNotEndsWith:81,FunctionCase:82,FunctionCaseV:83,FunctionStdevP:84,FunctionRunningStdevP:85,FunctionMovingStdevP:86,FunctionNTileS:87,FunctionNTileVS:88,FunctionVarP:89,FunctionCurrentDate:90,FunctionDayOfMonth:91,FunctionDayOfWeek:92,FunctionDayOfYear:93,FunctionWeek:94,FunctionMonth:95,FunctionQuarter:96,FunctionYear:97,FunctionCurrentDateTime:98,FunctionCurrentTime:99,FunctionHour:100,FunctionMinute:101,FunctionSecond:102,FunctionMilliSecond:103,FunctionConcatNoBlank:104,FunctionLength:105,FunctionLower:106,FunctionLTrim:107,FunctionPosition:108,FunctionRTrim:109,FunctionSubStr:110,FunctionInitCap:111,FunctionTrim:112,FunctionRightStr:113,FunctionLeftStr:114,FunctionGreatest:115,FunctionLeast:116,FunctionFirst:117,FunctionLast:118,FunctionAdd:134,FunctionAverage:135,FunctionMultiply:136,FunctionBandingM:137,FunctionOLAPSum:138,FunctionOLAPAvg:139,FunctionOLAPCount:140,FunctionOLAPMax:141,FunctionOLAPMin:142,FunctionLag:143,FunctionLead:144,FunctionPercentRank:166,FunctionTuple:1000};(function(){var C="xviPopopNode";function A(G){var H={};H[C]=G;return H;}mstrmojo.ui.menus._IsMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._IsMenuPopup",{init:function E(G){this._super(G);var J=this.popupConfig;if(!J){throw new Error("Cannot instantiate popup without supplying the popupConfig property.");}this.addDisposable(J);var H=mstrmojo.all[J.hostId],I=J.hostElement;if(J.isHostedWithin&&H&&I){H.addSlots(A(I));this.slot=C;}},closeAllMenus:function F(){var G=this.opener;if(G&&G.closePopup){G.closePopup();}if(G&&G.closeAllMenus){G.closeAllMenus();}},open:function B(H,G){if(this._super){this._super(H,G);}},close:function D(G){if(this.slot===C){this.opener.removeSlots(A(null));}if(this._super){this._super(G);}this.destroy();var H=mstrmojo.all[this.popupConfig.hostId];if(H){H.closePopup();}}});}());mstrmojo.vi.viz.EnumVisualizationTemplates={UNKNOWN_GRAPHMATRIX_TYPE:-1,GRID:0,HEATMAP:1,GOOGLEMAP:2,PIE:3,RING:4,GRAPHMATRIXVERTICALBARSTACKED:6,GRAPHMATRIXVERTICALBARCLUSTERED:7,GRAPHMATRIXVERTICALBARPERCENT:8,GRAPHMATRIXHORIZONTALBARSTACKED:9,GRAPHMATRIXHORIZONTALBARCLUSTERED:10,GRAPHMATRIXHORIZONTALBARPERCENT:11,GRAPHMATRIXVERTICALLINESTACKED:12,GRAPHMATRIXVERTICALLINECLUSTERED:13,GRAPHMATRIXVERTICALLINEPERCENT:14,GRAPHMATRIXHORIZONTALLINESTACKED:15,GRAPHMATRIXHORIZONTALLINECLUSTERED:16,GRAPHMATRIXHORIZONTALLINEPERCENT:17,GRAPHMATRIXSCATTERCIRCLEMM:18,GRAPHMATRIXSCATTERGRIDCIRCLEAA:19,GRAPHMATRIXBUBBLECIRCLEMM:21,GRAPHMATRIXBUBBLEGRIDCIRCLEAA:22,GRAPHMATRIXSCATTERSQUAREAM:23,GRAPHMATRIXSCATTERSQUAREMM:24,GRAPHMATRIXSCATTERGRIDSQUAREAA:25,GRAPHMATRIXBUBBLESQUAREAM:26,GRAPHMATRIXBUBBLESQUAREMM:27,GRAPHMATRIXBUBBLEGRIDSQUAREAA:28,GRAPHHORIZONTALBARCLUSTERED:29,GRAPHMATRIXVERTICALAREASTACKED:30,GRAPHMATRIXVERTICALAREAPERCENT:31,GRAPHMATRIXVERTICALAREACLUSTERED:32,GRAPHMATRIXHORIZONTALAREASTACKED:40,GRAPHMATRIXHORIZONTALAREAPERCENT:41,GRAPHMATRIXHORIZONTALAREACLUSTERED:42,GRAPHHORIZONTALBARDUALAXISCLUSTERED:33,GRAPHHORIZONTALBARDUALAXISABSOLUTE:34,GRAPHHORIZONTALLINEABSOLUTE:35,GRAPHHORIZONTALLINEDUALAXISABSOLUTE:36,GRAPHHORIZONTALAREAABSOLUTE:37,GRAPHHORIZONTALAREADUALAXISABSOLUTE:38,GRAPHVERTICALBARCLUSTERED:39,GRAPHVERTICALBARDUALAXISCLUSTERED:43,GRAPHVERTICALBARDUALAXISABSOLUTE:44,GRAPHVERTICALBARDUALAXISSTACKED:45,GRAPHVERTICALLINEABSOLUTE:46,GRAPHVERTICALLINESTACKED:47,GRAPHVERTICALLINEPERCENT:48,GRAPHVERTICALLINEDUALAXISABSOLUTE:49,GRAPHVERTICALLINEDUALAXISSTACKED:50,GRAPHVERTICALAREAABSOLUTE:51,GRAPHVERTICALAREAPERCENT:52,GRAPHVERTICALAREASTACKED:53,GRAPHVERTICALAREADUALAXISABSOLUTE:54,GRAPHVERTICALAREADUALAXISSTACKED:55,GRAPHCOMBINATIONBARAREA:56,GRAPHCOMBINATIONBARAREADUALAXIS:57,NETWORK:58,IMAGELAYOUT:59,GOOGLEMAPDENSITY:60,GRAPHMATRIXPIE:61,GRAPHMATRIXRING:62,GRAPHHORIZONTALBARABSOLUTE:63,GRAPHHORIZONTALBARPERCENT:64,GRAPHHORIZONTALBARSTACKED:65,GRAPHVERTICALBARABSOLUTE:66,GRAPHVERTICALBARPERCENT:67,GRAPHVERTICALBARSTACKED:68,ESRIMAP:69,GRAPHMATRIXVERTICALBARAUTOMATIC:70,GRAPHMATRIXHORIZONTALBARAUTOMATIC:71,GRAPHMATRIXVERTICALLINEAUTOMATIC:72,GRAPHMATRIXHORIZONTALLINEAUTOMATIC:73,GRAPHMATRIXVERTICALAREAAUTOMATIC:74,GRAPHMATRIXHORIZONTALAREAAUTOMATIC:75};var STR_BYTE_LEN=mstrmojo.desc(9660,"Byte length:"),STR_BIT_LEN=mstrmojo.desc(11456,"Bit length:"),STR_PREC=mstrmojo.desc(9659,"Precision:"),STR_SCL=mstrmojo.desc(9662,"Scale:"),STR_TM_SCL=mstrmojo.desc(9661,"Time scale:");var byteLength={txt:STR_BYTE_LEN,field:"ps"},bitLength={txt:STR_BIT_LEN,field:"ps"},precision={txt:STR_PREC,field:"ps"},scale={txt:STR_SCL,field:"sc"},timeScale={txt:STR_TM_SCL,field:"ps"};mstrmojo.architect.EnumColumnDataTypes={"-1":{id:-1,n:mstrmojo.desc(4444,"unknown"),options:[]},0:{id:0,n:"Reserved",options:[]},1:{id:1,n:"Integer",options:[byteLength]},2:{id:2,n:"Unsigned",options:[byteLength]},3:{id:3,n:"Numeric",options:[precision,scale]},4:{id:4,n:"Decimal",options:[precision,scale]},5:{id:5,n:"Real",options:[]},6:{id:6,n:"Double",options:[]},7:{id:7,n:"Float",options:[bitLength]},8:{id:8,n:"Char",options:[byteLength]},9:{id:9,n:"VarChar",options:[byteLength]},10:{id:10,n:"LongVarChar",options:[byteLength]},11:{id:11,n:"Binary",options:[byteLength]},12:{id:12,n:"VarBin",options:[byteLength]},13:{id:13,n:"LongVarBin",options:[byteLength]},14:{id:14,n:"Date",options:[]},15:{id:15,n:"Time",options:[timeScale]},16:{id:16,n:"TimeStamp",options:[timeScale]},17:{id:17,n:"NChar",options:[byteLength]},18:{id:18,n:"NVarChar",options:[byteLength]},30:{id:30,n:"Big Decimal",options:[precision,scale]},34:{id:34,n:"Big Integer",options:[byteLength]}};(function(){mstrmojo.DI.DIConstants=mstrmojo.provide("mstrmojo.DI.DIConstants",{invalidObjectNameChars:'\\"[]',invalidObjectNameCharsRegex:/[\\"\[\]]/,sourceItemLinkType:{dbList:0,oauthPara:1},setDefaultOAuthParamCMD:"MSTR_DEFAULT_OAUTH_PARAMS",actions:{none:0,importSource:1,editImport:2,transform:3,changeSheet:4,publish:5,changeMappings:6,refine:7,quickPreview:8,savePublish:9,getFlatPreview:10,refreshData:11},requestFlag:{mapping:1,preview:2,sourceInfo:4,refineSourceInfo:8,sheets:16,crb:32,transformations:64,transformedPreview:128,relationship:256,stateInfo:512,anyState:268435456,fullData:1024,refineInnerData:2048},formMappingFlag:{formMappingFlagReserved:0,formMappingFlagRemoveGeoRole:1,formMappingFlagRemoveTimeRole:2,formMappingFlagRemoveDeriveFlags:4},browseFlag:{reportBindingTable:1,dataPreview:4,publish:16,cubeConfig:68,reportLevelProperty:256},importBehaviorFlag:{reserved:0,newColumnsSilent:1,dataTypeSilent:2},saveAsFlags:{saveAsOverWrite:32,saveAsManaged:524288,saveAsDDA:33554432,saveAsInMemory:67108864,saveAsWithPrompts:4096,saveAsWithAnswers:4},connectLiveSupport:{connectLiveSupportUnknown:0,connectLiveSupportDDAOrInMemory:1,connectLiveSupportInMemoryOnly:2,connectLiveSupportDDAOnly:3},xdaType:{excel:272,text:288,refine:384,salesforce:337,querybuilder:352,ffsql:304,mdx:2,googleAnalytics:390,googleBigQuery:341,googleBigQueryFFSQL:342,googleBigQuerySingleTable:345,qbSingleTable:368,twitter:343,facebook:344,dataImport:256,projectsImport:400,dataImportFileExcel:16|256,dataImportFileText:32|256,dataImportCustomSQL:48|256,dataImportTable:64|256,dataImportOAuth:80|256,dataImportBISource:144|256,dataImportOAuthSalesforce:1|336,dataImportOAuthGDocs:2|336,dataImportOAuthGDrive:2|336,dataImportOAuthDropbox:3|336,dataImportOAuthGAnalytics:4|336,dataImportOAuthGBigQuery:5|336,dataImportOAuthGBigQueryFFSQL:6|336,dataImportOAuthGBigQuerySingleTable:9|336},sourceInfoDesc:{json:"DB_FILE_TYPE_JSON"},sourceType:{file:1,salesforce:2,dropbox:3,googleDrive:4,googleAnalytics:5,googleBigQuery:6,querybuilder:7,mstrFile:8,mdx:9,hadoop:10,twitter:11,facebook:12,bisource:13,remoteProject:14},sourceSubtype:{localFile:1,url:2,salesforce:3,dropbox:4,googleDrive:5,googleAnalytics:6,googleBigQuery:7,querybuilder:8,samplefile:9,clipboard:10,googleBigQueryFFSQL:11,searchOnSource:12,mdx:13,hadoop:14,twitter:15,facebook:16,bisource:17,remoteProject:18,googleBigQuerySingleTable:19,hanaSingleTable:20,publicData:21},backendSourceSubtype:{localFile:65537,url:65539,samplefile:65540,clipboard:65538,hadoopFileBrowser:65541,customSQL:131073,customSQLWizard:131074,singleTable:131075,bISources:131076,searchAsASource:131078,salesforce:196609,dropbox:196610,facebook:196611,twitter:196612,googleDrive:196613,googleAnalytics:196614,googleBigQuery:196615,googleBigQueryFFSQLModel:196616,googleBigQuerySingleTable:196617,OLAPSources:327681,publicData:65542},sourceItemType:{file:0,url:1,database:2,hadoop:3,olap:4,publicData:5,salesforce:6,googleAnalytics:7,googleBigQuery:8,googleDrive:9,dropbox:10,searchAsASource:11,clipboard:12,bISources:13,facebook:14,twitter:15,samplefile:16,unknow:-1},columnState:{reserved:0,unchanged:1,newColumn:2,missing:4,changed:8},operationMode:{create:0,edit:1,refresh:2,subscribe:3,enterCredentials:4,oauth:5},statusCode:{obtainSource:-2147071874,xformsError:-2147071872,mappingError:-2147071871,edit:1,republish:2,schedule:3,enterCredentials:4},pageType:{intro:0,file:1,database:2,emmaPreview:3,redirect:4,analytics:5,dataSelection:6,suggestNewSource:7,sourceIntro:8,sourceObjects:10,sampleFiles:11,dataset:12,externalPage:13,preview:14,clipboard:15,refine:16,parse:17,mstrFile:18,allProjectSource:19,hadoop:20,twitter:21,facebook:22,sourceObjectsDnD:23,schedule:24,publicData:25,republish:26,sourceAdmin:27},backendError:{overwriteObject:-2147212339,noPermission:-2147214579,invalidObjectName:-2147213715,unexpectedDataType:-2147212539,noExternalSession:-2147071844,noPrivilege:-2147212082,salesforceUnsavedReport:-2147212081,salesforceObsoleteReport:-2147212080,maxSizeExceeded:-2147212076,maxSizeExceededURL:-2147212121,salesforceUnresolvedFilter:-2147212074,incrementalRefresh:-2147212287,invalidUrl:-2147212062,fileVersionError:-2147212064,emptySheet:-2147212144,refreshTokenUnavailable:-2147202875,cubeQuotaExceeded:-2147071825,notEnoughSpace:-2147071811,importedURLInvalid:-2147212122,unsupportedFileFormat:-2147212063,objectNameTooLong:-2147217407,noExternalSourceInfo:-2147215346,memoryConsumptionExceeded:-2147215346,cubeQuotaReached:-2147071870,switchingFileType:-2147212140,memoryGovernSizeExceeded:-2147181051,stringTooLong:-2147213718,missingColumn:-2147071871,dataDiscoveryError:-2147211998,refineApplyError:-2147202299,serverOutOfMemory:-2147212055,columnCountMatchError:-2147467259,incompatibleDataTypeError:-2147211983,reportTimeout:-2147212335,requestTimeout:-2147206497,databaseCredentialsNotAvailable:-2147212037},transformation:{xtab:1,delimiter:2},application:{platform:"Platform",cloudPersonal:"Personal",cloudProfessional:"Professional"},refreshOptions:{replace:1,append:2,update:4},cubeRefreshType:{dummy:-1,reserved:0,add:1,remove:2,update:3,upsert:4,addNewTable:5,deleteTable:6,replaceTable:7,preserve:8},tableStatsExecutionAction:{reserved:0,forceExecution:1,ignore:4,requireFreshData:268435456},sourcesInfoFlags:{none:0,getReports:1,getUserName:2,getTokensInfo:4,revokeSession:8,getGAnalyticsAccount:64},queryBuilderType:{individualTable:1,multipleTables:2,queryScript:3},relationshipEditType:{create:1,changeERType:2,remove:3,flip:8001},ERType:{reserved:0,ERType11:1,ERType1M:2,ERTypeM1:3,ERTypeMM:4,ERTypeParallel:5,ERTypePerpendicular:6},RSType:{reserved:0,auto:1,geo:2,defined:3},tableStates:{newly:1,old:2},behaviorChangeFlag:{multiSheet:4,remapping:8,refreshData:16},menuItems:{SEPARATOR:-1,NONE:0,TABLE_RENAME:1,DO_NOT_IMPORT:2,FLIP_ORDER:3,DELETE:4,RELATIONSHIP_TYPE:5,ONE_TO_ONE:6,ONE_TO_MANY:7,MANY_TO_ONE:8,MANY_TO_MANY:9,REMOVE:10,REFRESH_DATA:11,REFINE:12,CANCEL_REFINE:13,UNLINK:14,CHANGE_DATA_TYPE:15,MARK_GEO_ROLES:16,CREATE_TIME_ATTRIBUTES:17,TO_METRIC:18,TO_ATTRIBUTE:19,MAP_TO_PROJECT_ATTRIBUTE:20,UNMAP:21,MODIFY_ATTRIBUTE_GROUP:22,CREATE_ATTRIBUTE_GROUP:23,HIDE_ALL_ATTRIBUTE_FORMS:24,DEFINE_RELATIONSHIPS:25,LINK:26,ITEM_RENAME:27,CREATE_MULTIFORM_ATTRIBUTE:28,EDIT_MULTIFORM_ATTRIBUTE:29,ADDTO_MULTIFORM_ATTRIBUTE:30,SHOW_ALL_ATTRIBUTE_FORMS:31,SHOW_ALL_COLUMNS:32,PARTITION:33,REFINE_RENAME:34,REFINE_DELETE:35,REFINE_DELETE_ALL:36,REFINE_RESET:37,REFINE_RESET_ALL:38,PARSE:39,IMPORT:40,UNLINK_ALL:41},dataTypeMenuItems:{DATE_TIME:"1",NUMBER:"2",TEXT:"3",URL:"5",EMAIL:"6",HTML_TAG:"7",DATE:"8",TIME:"9",SYMBOL:"10",BIG_DECIMAL:"11",PHONE_NUMBER:"12"},columnDataTypes:{reserved:0,integer:1,unsigned:2,numeric:3,decimal:4,real:5,dtdouble:6,dtfloat:7,dtchar:8,varChar:9,longVarChar:10,binary:11,varBin:12,longVarBin:13,date:14,dttime:15,timeStamp:16,nChar:17,nVarChar:18,nlong:22,bigDecimal:30,cellFormatData:31,utf8Char:33,int64:34},formsOptions:{CREATE_MULTIFORM_ATTRIBUTE:1,EDIT_MULTIFORM_ATTRIBUTE:2,ADDTO_MULTIFORM_ATTRIBUTE:3},timeRoles:{NONE:0,DATE:1,DATE_TIME:2,TIME:3,SECOND:4,MINUTE:5,HOUR:6,DAY:7,WEEK:8,MONTH:9,QUARTER:10,YEAR:11},contextMenuType:{ITEM_MENU:0,TABLE_MENU:1,PREVIEW_ITEM_MENU:2,LINK_MENU:3},dialogType:{fixRefreshErrorDialog:1,allObjectsViewDialog:2,missingColumnsDialog:3,diPageDialog:4,refreshHistoryDialog:5,alternateSourceValidateDialog:6,ddaConfirmDialog:7,publishStatusDialog:8,saveAsDialog:9,cubesList:10,refinePage:11,multiFormEditor:12,sheetsSelectionDialog:13,partitionGroupDialog:14,parseDataDialog:15,errorDialog:16,warningDialog:17,relationDefineDialog:18,qbImportOptionDialog:19,previewRenameDialog:20,mapProjectsAttributeDialog:21,setOAuthParaDialog:22,objectPicker:23,refineClusteringPage:24,refineExtractDialog:25,refineImportDialog:26,twitterAdvOptDialog:27,credentialsDialog:28,mapProjectsAttributeDialog2:29,setWhiteListDialog:30},dataEvents:{DATA_PREVIEW_EVENT:"dataReturned",NO_DATA_RETURNED_EVENT:"noDataReturned"},cubeSchedStatus:{unexecuted:1,successful:2,unscheduled:3,failed:4},privilegeType:{accessDatabase:1,accessFile:2,accessCloud:3},dbType:{MS_ACCESS:100,ORACLE:200,SQL_SERVER:300,INFORMIX:400,SYBASE:500,REDBRICK:600,DB2:700,TANDEM:800,TERADATA:900,UNKNOWN:1000,GENERIC:1100,SAP:1200,NETEZZA:1300,EXCEL:1400,MSFT_AS:1500,ESSBASE:1600,MYSQL:1700,POSTGRESQL:1800,HPNEOVIEW:1900,METAMATRIX:2000,DATALLEGRO:2100,COMPOSITE:2200,ASTER:2300,VERTICA:2400,OPENACCESS:2500,SYBASE_SQL_ANY:2600,SYBASE_IQ:2700,PARACCEL:2800,TM1:2900,XQUERY:3000,HIVE:3100,SAND:3200,SALESFORCE:3300,HIVETHRIFT:3400,VECTORWISE:3500,ENTERPRISEDB:3600,KOGNITIOWX2:3700,EXASOLUTION:3800,INFORMATICA:3900,SAPHANA:4000,IMPALA:4100,AMAZON_REDSHIFT:4200,DENODO:4300,GOOGLE_DRIVE:4400,DROPBOX:4500,GOOGLE_ANALYTICS:4600,GOOGLE_BIGQUERY:4700,CONNECTION_CLOUD:4800,GOOGLE_BIG_QUERY_FFSQL_MODEL:4900,PARSTREAM:5100,MONGODB:5200,MARKLOGIC:5300,BIG_DATA_ENGINE:5400,SEARCH_ENGINE_SOLR:5500,SPLUNK:5600,TWITTER:5700,FACEBOOK:5800,PIG:6400},getCubeQuotaAndInfosOptions:{GetCubeQuotaAndInfosReserved:0,GetCubeQuotaAndInfosDefault:1,GetCubeQuotaAndInfosQuotaOnly:2,GetCubeQuotaAndInfosAll:3,GetCubeQuotaAndInfosVI:4},homepageViewMode:{GRID_VIEW:0,LIST_VIEW:1},datasetServeMode:{inMemory:1,dda:2,unknow:3},cubePollStatus:{msgID:0,result:1,prompt:2,error:3,xmlResult:21},ibmDb2Versions:[17,18,21,22,23,24,25,37,45,46,47,48,63,66,74,89,92,101,103,105,123,134,157,172,202,232],hadoopDbTypes:[3100,1100,700,4100,7300,6800,6400]});}());(function(){var J=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.bigquery._BigQueryController=mstrmojo.provide("mstrmojo.qb.bigquery._BigQueryController",{loadDBRoles:function H(K){this.model.loadDBRoles(K);},getNameSpaces:function D(K){this.model.selectedDataset=undefined;this.model.getDatasets(K);},setSelectedDBRoleID:function G(K){this.model.set("selectedProject",K.id);},setNameSpaceID:function E(K){this.model.set("selectedDataset",K);},handleLogout:function F(){mstrApp.container.unloadQB();mstrApp.getRootController().afterBigQueryProcess(false);},handleDBTableRefresh:function B(){var K=this.model,L=K.selectedProject;if(!L||!K.selectedDataset){return ;}K.catalogRefresh=true;K.getDatasetTables({blockBegin:0,blockCount:1000,filterText:""});},availableTableSearch:function C(K){this.model.getDatasetTables({blockBegin:0,blockCount:1000,filterText:K});},getProjectPrimaryDBRoleID:function I(){return this.model.selectedProject;},onHelpButtonClick:function A(){mstrApp.showHelpTopic("Importing_data_from_Google_BigQuery.htm");}});}());mstrmojo.chart.model.enums.EnumDSSObjectType={DssTypeUnknown:-1,DssTypeReserved:0,DssTypeGeneric:5,DssTypeFormatBAD:46,DssTypeFilter:1,DssTypeTemplate:2,DssTypeReportDefinition:3,DssTypeMetric:4,DssTypeStyle:6,DssTypeAggMetric:7,DssTypeFolder:8,DssTypeDevice:9,DssTypePrompt:10,DssTypeFunction:11,DssTypeAttribute:12,DssTypeFact:13,DssTypeDimension:14,DssTypeTable:15,DssTypeDatamartReport:16,DssTypeFactGroup:17,DssTypeShortcut:18,DssTypeResolution:19,DssTypeMonitor:20,DssTypeAttributeForm:21,DssTypeSchema:22,DssTypeFormat:23,DssTypeCatalog:24,DssTypeCatalogDefn:25,DssTypeColumn:26,DssTypePropertyGroup:27,DssTypePropertySet:28,DssTypeDBRole:29,DssTypeDBLogin:30,DssTypeDBConnection:31,DssTypeProject:32,DssTypeServerDef:33,DssTypeUser:34,DssTypeTransmitter:35,DssTypeConfiguration:36,DssTypeRequest:37,DssTypeScript:38,DssTypeSearch:39,DssTypeSearchFolder:40,DssTypeDatamart:41,DssTypeFunctionPackageDefinition:42,DssTypeRole:43,DssTypeSecurityRole:44,DssTypeLocale:45,DssTypeConsolidation:47,DssTypeConsolidationElement:48,DssTypeScheduleEvent:49,DssTypeScheduleObject:50,DssTypeScheduleTrigger:51,DssTypeLink:52,DssTypeDbTable:53,DssTypeTableSource:54,DssTypeDocumentDefinition:55,DssTypeDrillMap:56,DssTypeDBMS:57,DssTypeMDSecurityFilter:58,DssTypePromptAnswer:59,DssTypePromptAnswers:60,DssTypeGraphStyle:61,DssTypeChangeJournalSearch:62,DssTypeNCSObjects:255,DssTypeReservedLastOne:63};(function(){var I="FULLCONNECTION",J="MSTR_CUSTOM";function K(O,M){var Q=mstrmojo.string;O=Q.trim(O);var P=/\(\d+\)$/,N=P.exec(O);if(N){M.v=parseInt(O.substring(N.index+1,O.length-1),10);return Q.trim(O.substring(0,N.index));}return O;}mstrmojo.warehouse.dbroles.DBRoleHelper=mstrmojo.provide("mstrmojo.warehouse.dbroles.DBRoleHelper",{isNumeric:function A(M){return !isNaN(parseFloat(M))&&isFinite(M);},getUniqueName:function E(S){S=K(S,{});var V=mstrApp.rootController.getDBRoles(),O=mstrApp.rootController.isCloud(),Q=mstrApp.rootController.getAllDBRoleNames(),U,R=0,T={},P=0,M=S,N=function(W){M=S;if(O){U=K(W.des,T);}else{U=K(W.n,T);}P=Math.max(P,T.v)||0;if(U.toString().toUpperCase()===M.toString().toUpperCase()){R=P+1;}};do{if(!O){mstrmojo.hash.forEach(Q,N);if(R===0){mstrmojo.array.forEach(V,N);}}else{mstrmojo.array.forEach(V,N);}if(R>0){M=S+" ("+R+")";}}while(mstrApp.rootController.findinArray(V,"n",M)>=0);return M;},cleanDSNConnection:function D(M){M=mstrmojo.string.trim(M).replace(/\\/g,"\\\\");M=this.cleanDSNConnectionPlaceHolders(M);M=M.replace(/\\/g,"^^^789^^^");M=M.replace(/:/g,"!!!789!!!");M=M.replace(/,/g,"%%%789%%%");M=M.replace("\\","###789###");M=M.replace(/{/g,"+++789+++");M=M.replace(/}/g,"@@@789@@@");M=M.replace("FULLCONNECTION=","");return M;},cleanDSNConnectionPlaceHolders:function D(M){M=M.replace(/!#AT#!/g,"@");M=M.replace(/!#QUESTION#!/g,"?");M=M.replace(/!#AND#!/g,"&");M=M.replace("!#DRIVERSUFFIX#!","");return M;},cleanLoadedDSNConnection:function B(N,M){var O;N=mstrmojo.string.trim(N);if(M===19){O=N.split(";");mstrmojo.array.forEach(O,function(Q,P){if(Q.search(/^\s*DBQ=/)===-1){O[P]=Q.replace(/\\\\/g,"\\");}});N=O.join(";");}else{N=N.replace(/\\\\/g,"\\");}N=N.replace(/@/g,"!#AT#!");N=N.replace(/\?/g,"!#QUESTION#!");N=N.replace(/&/g,"!#AND#!");return N;},driverAvailable:function H(M){if((M.str.indexOf(I)===0)&&(M.driver===""||M.driver==="XQUERY")){return true;}return(mstrmojo.array.find(this.drivers,"nU",M.driver.toUpperCase())>=0);},driverExists:function F(O){var R=this,P=false,Q="",N=0,M=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.array.forEach(O,function(T,S){if(M.driverAvailable.call(R,T)){P=true;Q=T.driver;N=S;}return !P;});return{exists:P,driver:Q,idx:N};},cleanDriver:function G(N){var P="DRIVER=",M=N.toUpperCase().indexOf(P),O="";if(M>=0){M+=P.length;O=N.substring(M,M+N.substring(M).indexOf(";"));O=O.replace(/([\{\}])+/g,"");}return O;},isCustomConnection:function L(M){return(M.indexOf(J)>=0);},showHelp:function C(N){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(N);}else{var M=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");window.open(M+(N||""),"_blank");return false;}}});}());(function(){mstrmojo.cookies={};var C="%26",E="%3D",B=mstrmojo.cookies,D=function(){var F=document.cookie;if(!F||!(typeof F==="string")||F.indexOf("bSet")<0){return false;}return true;},A=function(){var F=document.cookie;F=F.split(";");for(s in F){if(F[s].indexOf("bSet")>=0){return F[s];}}return null;};mstrmojo.cookies.updateCookieSetting=function(H,N,J){try{if(!D()&&!J){return ;}var K=document.cookie,M=H+E+N+C;if(K.indexOf(H)>=0){var F=H+E,G=F+(B.getCookieSetting(H)||0),I=F+N;if(I!=G){document.cookie=K.replace(G,I);}}else{if(K.indexOf("bSet")>=0){document.cookie=K.replace("bSet=","bSet="+M);}else{if(J){document.cookie="bSet="+M+";"+K;}}}}catch(L){mstrmojo.alert(L);return ;}};mstrmojo.cookies.getCookieSetting=function(F){try{return B.getCookieList()[F];}catch(G){mstrmojo.alert(G);return ;}};mstrmojo.cookies.getCookieList=function(){try{if(!D()){return[];}var G=A(),F={},H=null;G=G.replace("bSet=","").split(C);for(H in G){H=G[H].split(E);F[H[0]]=H[1];}return F;}catch(I){mstrmojo.alert(I);return ;}};mstrmojo.cookies.enabledCookieOnBrowser=function(){var F=document.cookie;if(!F||!(typeof F==="string")){return false;}return true;};})();mstrmojo.EnumRWUnitType={LAYOUT:0,HEADER:2,FOOTER:3,SUBSECTION:4,DETAILS:5,PAGEHEADER:6,PAGEFOOTER:7,PANELSTACK:8,PANEL:9,GRID:521,GRAPH:522,GRIDGRAPH:527,RECTANGLE:101,IMAGE:102,LINE:105,TEXTFIELD:106,HTMLCONTAINER:107,SELECTOR:111,ROUNDEDRECTANGLE:112,VISUALIZATION:114,MOJOVISUALIZATION:115};mstrmojo.qb.EnumQBAppType={EmmaSingleTable:368,QueryBuilder:352,FFSQL:304,BigQuery:341,BigQueryFFSQL:342,BigQuerySingleTable:345,BISource:400,MDX:2};mstrmojo.mstr.EnumDSSXMLObjectTypes={Generic:-2,Unknown:-1,Reserved:0,Filter:1,Template:2,ReportDefinition:3,Metric:4,Style:6,AggMetric:7,Folder:8,SubscriptionDevice:9,Prompt:10,Function:11,Attribute:12,Fact:13,Dimension:14,Table:15,DatamartReport:16,FactGroup:17,Shortcut:18,Resolution:19,Monitor:20,AttributeForm:21,Schema:22,Format:23,Catalog:24,CatalogDefn:25,Column:26,PropertySet:28,DBRole:29,DBLogin:30,DBConnection:31,Project:32,ServerDef:33,User:34,Configuration:36,Request:37,Script:38,Search:39,SearchFolder:40,Datamart:41,FunctionPackageDefinition:42,Role:43,SecurityRole:44,Locale:45,Consolidation:47,ConsolidationElement:48,ScheduleEvent:49,ScheduleObject:50,ScheduleTrigger:51,Link:52,DbTable:53,TableSource:54,DocumentDefinition:55,DrillMap:56,DBMS:57,MDSecurityFilter:58,PromptAnswer:59,PromptAnswers:60,ObjectTag:65,ReservedLastOne:66};(function(){var A=/^mstrmojo./;mstrmojo.DynamicClassFactory={newComponent:function(C,B,F){var H=C.prototype.scriptClass.replace(A,"");for(var E=0,D=B&&B.length||0;E<D;E++){if(!B[E]._mixinName){throw new Error('Mixins must have a "_mixinName" property to be used with DynamicClassFactory');}H+="_"+B[E]._mixinName.replace(A,"");}var G=mstrmojo[H];if(!G){G=mstrmojo.declare(C,B,F);mstrmojo[H]=G;}return G;}};}());mstrmojo.vi.viz.EnumWidgetTypes={GRID:0,GRAPH_MATRIX:1,HEATMAP:2,NETWORK:3,IMAGELAYOUT:4,ESRIMAP:5,GOOGLEMAP:6,CUSTOM:7};mstrmojo.LoadedExternalJSURLs={};function LoadScriptsExternalJSCallback(){mstrmojo.LoadedExternalJSURLs[mstrmojo._LoadsScript.esScripts.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(mstrmojo._LoadsScript.esScripts,mstrmojo._LoadsScript.callback,mstrmojo._LoadsScript.esScritsContext);mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=false;}mstrmojo._LoadsScript=mstrmojo.provide("mstrmojo._LoadsScript",{_meta_usesSuper:false,requiresMethod:function requiresMethod(B){if(!B){return false;}if(typeof this[B]==="function"){return true;}var A=this[B]||(this.methods&&(this.methods[B]||this.methods["*"]));if(typeof A==="string"){this.requiresCls(A);return typeof this[B]==="function";}return false;},requiresCls:function req(mixins,callback){if(mixins){if(typeof mixins==="string"){mixins=[mixins];}mstrmojo.requiresCls.apply(mstrmojo,mixins);var p=this.constructor.prototype,pm=p.mixins;if(!pm){p.mixins={};pm=p.mixins;}var mx=mstrmojo.mixin,i,len;for(i=0,len=mixins.length;i<len;i++){var fqcn=mixins[i];if(!pm[fqcn]){var m=eval(mixins[i]);mx(m,p);pm[fqcn]=true;if(m.__onmixin__){m.__onmixin__.apply(this,[]);}}}if(callback){callback.apply(this,[]);}}},requiresContrib:function reqCb(C,B){var A=this[C];if(A){var E,D=false;if(typeof A==="string"){E=mstrmojo.registry.ref(A);this[C]=E;D=true;}else{E=A;}if(E&&(D||B)){E.parent=this;if(E.startup){E.startup();}}return E;}return null;},requiresExternalScripts:function requiresExternalScripts(F,G,C){if(F&&F instanceof Array){if(F.length===0){if(G){G.call(C);}return false;}if(F[0]&&F[0].forceReload===false&&mstrmojo.LoadedExternalJSURLs[F[0].url]){F.splice(0,1);return this.requiresExternalScripts(F,G,C);}var A=document.createElement("script"),D=!!document.all,B=F[0].url;if(B.substr(0,7)==="file://"){B=B.substr(7);}else{if(mstrApp.isSingleTier&&B.substr(0,4)!=="http"){B="http:"+B;}}A.type="text/javascript";A.src=B;if(!F[0].callbackParamName){if(D){A.onreadystatechange=function(){if(A.readyState==="loaded"||A.readyState==="complete"){A.onreadystatechange=null;if(F.length>1){mstrmojo.LoadedExternalJSURLs[F.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(F,G);}else{if(F.length===1){mstrmojo.LoadedExternalJSURLs[F[0].url]=true;if(G){G.call(C);}}}}};}else{A.onload=function(){A.onload=null;if(F.length>1){mstrmojo.LoadedExternalJSURLs[F.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(F,G);}else{if(F.length===1){mstrmojo.LoadedExternalJSURLs[F[0].url]=true;if(G){G.call(C);}}}};}}else{if(F[0].callbackParamName.length!==0){if(mstrmojo._LoadsScript.ExternalJSCallbackIsBusy&&mstrmojo._LoadsScript.ExternalJSCallbackIsBusy===true){var E=this;window.setTimeout(function(){E.requiresExternalScripts(F,G,C);},500);return ;}mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=true;A.src+="&"+F[0].callbackParamName+"=LoadScriptsExternalJSCallback";mstrmojo._LoadsScript.esScripts=F;mstrmojo._LoadsScript.callback=G;mstrmojo._LoadsScript.esScritsContext=C;}}document.getElementsByTagName("head")[0].appendChild(A);}}});(function(){mstrmojo.requiresCls("mstrmojo.vi.models.EnumDragSources");function D(H){this.cleanUpAfterTarget(H);var G=H.tgtData;if(G){delete H.tgtData;}var I=this.getContextDragData(H);if(I&&I.setAvatarClass){I.setAvatarClass("");}}mstrmojo.vi.ui._IsDropTarget=mstrmojo.provide("mstrmojo.vi.ui._IsDropTarget",{_mixinName:"mstrmojo.vi.ui._IsDropTarget",dropZone:true,getDropAvatarIcon:function B(G){return"add";},getContextDragData:function F(G){return G.getCtxtDragData();},cleanUpAfterTarget:mstrmojo.emptyFn,ondragenter:function A(G){var H=this.getContextDragData(G);if(H&&H.setAvatarClass){H.setAvatarClass(this.getDropAvatarIcon(G));}if(this._super){this._super(G);}},ondragleave:function E(G){D.call(this,G);if(this._super){this._super(G);}},ondrop:function C(G){D.call(this,G);if(this._super){this._super(G);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var H="#000000",E=Math.round;function N(X){return("0"+parseInt(X,10).toString(16)).slice(-2);}mstrmojo.color=mstrmojo.provide("mstrmojo.color",{rgbStr2rgb:function V(X){return X.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i).slice(1);},rgbStr2hex:function F(X){if(X.indexOf("rgb")>=0){var Y=this.rgbStr2rgb(X);return"#"+this.rgb2hex(Y[0],Y[1],Y[2]);}return X;},rgb2hex:function B(Z,Y,X){return N(Z)+N(Y)+N(X);},rgb2hsv:function U(X,e,j){var a=Math.min(X,e,j),k=Math.max(X,e,j),c=0,n,m;m=k/255;n=(k!==0)?(parseFloat(k)-parseFloat(a))/parseFloat(k):0;if(n===0){c=0;}else{var f=k-a,Y=(k-X)/f,Z=(k-e)/f,l=(k-j)/f;if(X===k){c=l-Z;}else{if(e===k){c=2+Y-l;}else{c=4+Z-Y;}}c=c/6;if(c<0){c=c+1;}}return[E(c*360),E(n*100),E(m*100)];},rgb2hsl:function D(X,c,d){X/=255;c/=255;d/=255;var e=Math.max(X,c,d),Z=Math.min(X,c,d),Y=(e+Z)/2,a,j;if(e===Z){a=j=0;}else{var f=e-Z;j=Y>0.5?f/(2-e-Z):f/(e+Z);switch(e){case X:a=(c-d)/f+(c<d?6:0);break;case c:a=(d-X)/f+2;break;case d:a=(X-c)/f+4;break;}a/=6;}return[a,j,Y];},hsl2rgb:function C(d,j,c){var a=function a(h,g,b){if(b<0){b+=1;}if(b>1){b-=1;}if(b<1/6){return h+(g-h)*6*b;}if(b<1/2){return g;}if(b<2/3){return h+(g-h)*(2/3-b)*6;}return h;},X,e,f;if(j===0){X=e=f=c;}else{var Y=c<0.5?c*(1+j):c+j-c*j,Z=2*c-Y;X=a(Z,Y,d+1/3);e=a(Z,Y,d);f=a(Z,Y,d-1/3);}return[E(X*255),E(e*255),E(f*255)];},hsl2hex:function I(Z,Y,X){return"#"+mstrmojo.array.map(this.hsl2rgb(Z,Y,X),function(a){return N(a);}).join("");},hex2rgb:function P(a){var X=this.fixFullHexValue("#"+a.replace("#","")),Y=[],Z;X=X.replace("#","");for(Z=0;Z<3;Z++){Y.push(parseInt(X.substr(Z*2,2),16));}return Y;},hex2bgr:function K(X){return this.hex2rgb(X).reverse();},hex2hsv:function S(Y){var X=this.hex2rgb(Y);return this.rgb2hsv(X[0],X[1],X[2]);},hex2hsl:function W(X){return this.rgb2hsl.apply(this,this.hex2rgb(X));},hsv2rgb:function G(f,o,m){f=f/360;o=o/100;m=m/100;var X,j,l;if(o===0){X=m*255;j=m*255;l=m*255;}else{var a=f*6;if(a===6){a=0;}var e=Math.floor(a);var Z=m*(1-o);var Y=m*(1-o*(a-e));var n=m*(1-o*(1-(a-e)));var k,c,d;switch(e){case 0:k=m;c=n;d=Z;break;case 1:k=Y;c=m;d=Z;break;case 2:k=Z;c=m;d=n;break;case 3:k=Z;c=Y;d=m;break;case 4:k=n;c=Z;d=m;break;default:k=m;c=Z;d=Y;break;}X=k*255;j=c*255;l=d*255;}return[E(X),E(j),E(l)];},hsv2hex:function L(a,Z,X){var Y=this.hsv2rgb(a,Z,X);return this.rgb2hex(Y[0],Y[1],Y[2]);},getContrastingColor:function M(a,Y,X){var Z=this.hex2rgb(a);return(((Z[0]*299)+(Z[1]*587)+(Z[2]*114))/1000<125)?Y:X;},getHighlightColor:function R(f,d){var X,e,h,j,k=this.hex2rgb(!d?"#FFCE7F":"#EFE6D8"),c=parseInt(f[0],10),Z=parseInt(f[1],10),m=parseInt(f[2],10),a=parseInt(k[0],10),Y=parseInt(k[1],10),l=parseInt(k[2],10);X=(c*a)/255;e=(Z*Y)/255;h=(m*l)/255;j=c*0.3+Z*0.59+m*0.11;if(j<85){X=X+(63*(85-j)/85);X=X>255?255:X;e=e+(63*(85-j)/85);e=e>255?255:e;h=h+(63*(85-j)/85);h=h>255?255:h;}return"#"+this.rgb2hex(E(X),E(e),E(h));},get3DBorderColor:function Q(Z,d){var Y=parseInt(Z[0],10)*0.3+parseInt(Z[1],10)*0.59+parseInt(Z[2],10)*0.11;var c=parseInt(Z[0],10);var a=parseInt(Z[1],10);var X=parseInt(Z[2],10);switch(d){case"light":if(Y>150){c=c*0.9;a=a*0.9;X=X*0.9;}else{c=c*0.6+102;a=a*0.6+102;X=X*0.6+102;}break;case"dark":if(Y>10){c=c*0.4;a=a*0.4;X=X*0.4;}else{c=c*0.8+30;a=a*0.8+30;X=X*0.8+30;}break;}return"#"+this.rgb2hex(E(c),E(a),E(X));},encodeColor:function J(X,Y){if(Y!==undefined&&(X===null||X.length===0||X==="undefined")){X=Y;}if(X==="transparent"){return -1;}if(parseInt(X,10)===-2){return -2;}if(X.substring(0,1)==="#"){X=X.substring(1);}return parseInt(X.substring(4)+X.substring(2,4)+X.substring(0,2),16);},decodeColor:function A(X){X=parseInt(X,10);if(X===0){return H;}var Y=16777216+(X&255)*65536+(X&65280)+(X&16711680)/65536;return"#"+Y.toString(16).substring(1).toUpperCase();},fixFullHexValue:function T(X){if(X&&X.length===4){return X.replace(/([0-9a-f])/ig,"$1$1");}return X;},findMidColorHex:function O(a,Z){var b=this.hex2rgb(a),X=this.hex2rgb(Z),Y=[];b.forEach(function(c,d){Y.push(parseInt((c+X[d])/2,10));});return("#"+this.rgb2hex(Y[0],Y[1],Y[2]));}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var E="*",A=".",C="-",J="_",H="<";var M=new RegExp("[\\"+E+"\\"+A+"\\"+C+"\\"+J+"\\"+H+"]","g"),G=E+"$&";mstrmojo.Serializer={scriptClass:"mstrmojo.Serializer",serializeValueGroup:function F(B){mstrmojo.array.forEach(B,function(D,K){B[K]=mstrmojo.Serializer.serializeValues(D);});return C+this.serializeValues(B)+J;},serializeValues:function I(D){var B=[];mstrmojo.array.forEach(D,function(K){if(typeof K==="Boolean"){K=K?"1":"0";}B.push(String(K).replace(M,G));});return B.join(A);}};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var G=mstrmojo.array;function B(){var H=this.buildConfig=this.buildConfig||{};H.pk=this.k;H.fgk=this.defn&&this.defn.fgk;return H;}mstrmojo._HasBuilder={builder:null,postBuildRendering:function D(){if(!this.builtChildren){this.buildChildren();}return this._super();},getChildren:function F(){return this.model.getChildren(this.node,false);},buildChildren:function E(H){if(!this.builder||!this.model){return false;}var J=this.children;if(J&&J.length){this.set("children",[]);}var I=this.builder.build(this.getChildren(),this.model,B.call(this));if(!H){this.addChildren(I);}this.builtChildren=true;return H?I:true;},rebuildChildren:function C(K){var H=this.children.slice(0),I=this.model,J=[];K=K||H.slice(0);K.forEach(function(P){var N=G.indexOf(H,P),O=P.k;if(N===-1){throw new Error("Invalid child requested rebuild in mstrmojo._HasBuilder::rebuildChild.");}this.removeChildren(P);P.destroy();J.push(O);},this);var L=I.getChildrenByKey(this.node,false,J);var M=this.builder.build(L,I,B.call(this));this.addChildren(M);return M;},rebuildChild:function A(H){return this.rebuildChildren([H])[0];}};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var B=mstrmojo.array;function A(C){if(C.parent){if(C.parent.shouldEllipsizeChildren===undefined){mstrmojo.mixin(mstrmojo._HasEllipsis,C.parent);}C.parent.set("shouldEllipsizeChildren",true);}}mstrmojo._HasEllipsis=mstrmojo.provide("mstrmojo._HasEllipsis",{shouldEllipsize:false,shouldEllipsizeChildren:false,doEllipsize:function(){if(this.shouldEllipsizeChildren){B.forEach(this.children,function(D,C){if(D.hasRendered&&D.doEllipsize){D.doEllipsize();}});}},onshouldEllipsizeChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsize,this.shouldEllipsizeChildren);},onshouldEllipsizeChildrenChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsizeChildren,this.shouldEllipsize);},_onEllipsizeFlagChange:function(D,C){if(D&&!C){A(this);this.markupMethods=mstrmojo.mixin({onvisibleChange:function(){if(this._super){this._super();}if(this.visible&&this.hasRendered){this.doEllipsize();}}},mstrmojo.hash.copy(this.markupMethods));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var C=mstrmojo.array;function A(E){var D=(E&&E.gts&&E.gts.col)||[],G=(E&&E.gts&&E.gts.row)||[];var F=C.filter(D.concat(G),function(H){return H.otp===-1;})[0];return{tpltProp:E.prop,mxProp:C.map((F&&F.es)||[],function(H){var I={};I[H.oid]=mstrmojo.hash.copy(H.prop,{n:H.n,t:H.otp});return I;})};}mstrmojo._IsDocumentTemplate=mstrmojo.provide("mstrmojo._IsDocumentTemplate",{_mixinName:"mstrmojo._IsDocumentTemplate",gridInfo:null,tmsProps:null,update:function B(D){if(D&&D.data){this.gridInfo=D.data.gsi;this.tmsProps=A(D.data);}if(this._super){return this._super(D);}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var N=/\{\@(en@)?([^\}]+)\}/gm,J=/\</gm,R=/\>/gm,E=/\S/,Q=["$","^","=","!",":","/",".","*","+","?","|","(",")","[","]","{","}","\\"],F=new RegExp("(\\"+Q.join("|\\")+")","g"),S={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;",u0009:"&#x09;","\n":"&#x0A;","\r":"&#x0D;",'"':"&quot;"},C={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;"," ":"&nbsp;","\n":"<br/>","\r":"&nbsp;&nbsp;&nbsp;&nbsp;","'":"&#039;",'"':"&quot;"},M={"&amp;":"&","&lt;":"<","&gt;":">","&nbsp;":" ","<br/>":"\n","&nbsp;&nbsp;&nbsp;&nbsp;":"\r","&#039;":"'","&quot;":'"'},D={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#039;",'"':"&quot;","\u20ac":"&#8364;"},K={"&amp;":"&","&lt;":"<","&gt;":">","&#039;":"'","&quot;":'"',"&#8364;":"\u20ac"};var L=function(V){if(V===null){return"null";}var W=typeof V;if(W!=="object"){return W;}if(V.length===undefined){return"object";}return"array";};var T={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};mstrmojo.string=mstrmojo.provide("mstrmojo.string",{multiReplace:function G(W,Z,Y){var V;Y=Y||[];if(!W){return"";}var X=[];for(V in Z){if(mstrmojo.array.indexOf(Y,V)===-1){X.push(V.k||V);}}return W.replace(new RegExp(X.join("|"),"g"),function(a){var b=Z[a];return b.v||b;});},trim:function P(V){return(V&&V.replace)?V.replace(/^\s+/,"").replace(/\s+$/,""):V;},startsWith:function U(W,V){return W.length>=V.length&&W.substring(0,V.length)==V;},ellipsize:function A(X,W){var V=this.trim(X.substr(0,(W||1)-1));if(V!==X){V+="&hellip;";}return V;},isEmpty:function I(V){return(V===null)||(V===undefined)||!(E.test(V));},regEscape:function O(V){return V.replace(F,"\\$1");},encodeXMLAttribute:function(V){return mstrmojo.string.multiReplace(V,S);},encodeHtmlString:function(W,V,X){if(!W||!W.replace){return W;}if(X){return mstrmojo.string.multiReplace(W,D);}return mstrmojo.string.multiReplace(W,C,V?[" "]:[]);},decodeHtmlString:function(W,V){return V?mstrmojo.string.multiReplace(W,K):mstrmojo.string.multiReplace(W,M);},htmlAngles:function(V){if(!mstrmojo.string.isEmpty(V)){V=String(V);return V.replace(J,"&lt;").replace(R,"&gt;");}return V;},apply:function H(V,X){if(!V){return"";}var W=this;return V.replace(N,function Y(b,c,d){var Z;try{Z=mstrmojo.hash.walk(d,X);}catch(a){}Z=(Z===null||Z===undefined)?"":Z;return(!!c)?W.encodeHtmlString(Z,true):Z;});},json2xml:function(V,k,l){if(!(k instanceof Array)){k=[k];}var W=l&&l.isSerializable,j=(l.convertBoolean!==false),o=l&&l.skipFunctions,h,b;var d=[],Z=[],c,Y,a;for(h=0,b=k.length;h<b;h++){var g=k[h];for(c in g){if(o&&typeof g[c]==="function"){continue;}if(W){var m=W(c,k,h);if(m!==true){if(m===false){continue;}else{if(m.att){d.push(m.att);}if(m.child){Z.push(m.child);}continue;}}}Y=g[c];a=L(Y);switch(a){case"array":var e,f;Z.push("<"+c+">");for(e=0,f=Y.length;e<f;e++){var X=l.getArrItemName(c,Y,e)||e;Z.push(this.json2xml(X,Y[e],l));}Z.push("</"+c+">");break;case"object":Z.push(this.json2xml(c,Y,l));break;case"string":d.push(c+'="'+mstrmojo.string.encodeXMLAttribute(Y)+'"');break;case"boolean":d.push(c+'="'+(j?(Y?"-1":"0"):Y)+'"');break;case"null":if(!l.skipNull){d.push(c+'="'+l.nullValue+'"');}break;default:d.push(c+'="'+Y+'"');break;}}}return"<"+V+" "+d.join(" ")+">"+Z.join("")+"</"+V+">";},escape4HTMLText:function B(c){if(!c||!c.replace){return c;}var Z=/"/gm;var X="&quot;";var d=/&/gm;var b="&amp;";var a=/</gm;var V="&lt;";var Y=/>/gm;var W="&gt;";return c.replace(d,b).replace(Z,X).replace(a,V).replace(Y,W);},parseUri:function(Z,W){W=W||T;var V=W.parser[((W.strictMode)?"strict":"loose")].exec(Z),Y={},X=14;while(X--){Y[W.key[X]]=V[X]||"";}Y[W.q.name]={};Y[W.key[12]].replace(W.q.parser,function(b,a,c){if(a){Y[W.q.name][a]=c;}});return Y;},removeSpecialChars:function(V){return V.replace(/[^a-zA-Z0-9]/g,"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var I=mstrmojo.array,M=mstrmojo.hash;function J(U){if(U!==null){return(U.constructor!==Array)?[U]:U;}return null;}function F(e,c,Y){if(!c){return null;}var f=[],V=e.selectedIndices,U=e.allIdx,a=e.noneIdx;if(e.multiSelect&&(a>-1)&&(I.indexOf(c,a)>-1)){return f;}var X,Z,d=e.items,b=e.itemIdField,W=e.selectedItems,h;if(e.multiSelect&&(U>-1)&&(I.indexOf(c,e.allIdx)>-1)){for(X=0,Z=d.length;X<Z;X++){if(!V[X]){f.push(X);V[X]=true;e.selectedIndex=X;e.selectedItem=d[X];}}}else{for(X=0,Z=c.length;X<Z;X++){var g=c[X];if(!V[g]){V[g]=true;if(Y){f.push({idx:g,positions:Y});}else{f.push(g);}e.selectedIndex=g;h=e.selectedItem=d[g];if(W){W[h[b]]=h;}}}}return f;}function D(X,U){var W=[],Y=X.selectedIndices,Z=X.selectedItems,V;for(V in Y){delete Y[V];if(U){W.push({idx:parseInt(V,10),positions:U});}else{W.push(parseInt(V,10));}}X.selectedIndex=-1;X.selectedItem=null;if(Z){X.selectedItems={};}return W;}function T(e,d,Y){if(!d){return null;}var a=[],V=e.selectedIndices,g=I.indexOf,U=e.allIdx,b=e.noneIdx,c=e.itemIdField,W=e.selectedItems;if(e.multiSelect&&(((U>-1)&&(g(d,U)>-1))||((b>-1)&&(g(d,b)>-1)))){return D(e);}if(d.length>0&&V[U]){if(g(d,U)<0){d.push(U);}}var Z=d.length,X;for(X=0;X<Z;X++){var f=d[X];if(V[f]){delete V[f];if(Y){a.push({idx:f,positions:Y});}else{a.push(f);}if(W){delete W[e.items[f][c]];}if(e.selectedIndex===f){e.selectedIndex=-1;e.selectedItem=null;}}}return a;}function C(X,Y,V,U){if(U){return ;}if(this.raiseEvent){if((X&&X.length)||(Y&&Y.length)){try{this.raiseEvent({name:"selectionChange",added:X,removed:Y});}catch(W){T(this,X);F(this,Y);throw W;}}}}function B(V){var W=this.itemIdField,U=this.items;if(typeof V==="object"&&W){return I.find(U,W,V[W]);}return I.indexOf(U,V);}mstrmojo._ListSelections={multiSelect:false,allIdx:-1,noneIdx:-1,itemIdField:"",items:null,selectedIndices:null,selectedIndex:-1,selectedIndices_bindEvents:"selectionChange",selectedIndex_bindEvents:"selectionChange",selectedItem:null,selectedItem_bindEvts:"selectionChange",allowUnlistedValues:true,selectedItems:null,supportsIncFetch:false,init:function(U){this._super(U);if(this.supportsIncFetch&&this.itemIdField){this.selectedItems={};}if(!this.items){this.items=[];}if(!this.selectedIndices){this.selectedIndices={};if(this.selectedIndex>-1){this._set_selectedIndex("selectedIndex",this.selectedIndex,true);}else{if(this.selectedItem){this._set_selectedItem("selectedItem",this.selectedItem,true);}}}},addItems:function K(d){d=J(d);if(!d){return ;}var a=this.items,U=this.items.length,W=this.selectedItems,Y=[],V;a=this.items=a.concat(d);V=a.length;if(W){var Z=this.itemIdField,X,c;for(X=U;X<a.length;X++){c=a[X];if(W[c[Z]]){Y.push(X);}}}if(Y&&Y.length){F(this,Y);}if(V>U){var b=this.itemsContainerNode;if(b){b.innerHTML+=this._buildItemsMarkup(U,V-1).join("");}}},addSelectedItems:function S(U){this.selectItems(U,false);},setSelectedItems:function L(U){this.selectItems(U,true);},selectItems:function R(c,e){c=J(c);if(!c){return ;}if(e&&this.selectedItems){this.selectedItems={};}var W=this.selectedItems,a=this.itemIdField,U=[],Y=this.items.length,Z=[],V=this.allowUnlistedValues,d,b,X;for(X=0;X<c.length;X++){d=c[X];b=B.call(this,d);if(b<0){if(W===null){if(V){U.push(d);b=Y++;Z.push(b);}}else{W[d[a]]=d;}}else{Z.push(b);}}if(U.length>0){this.addItems(U);}if(Z.length>0){if(e){this.select(Z);}else{this.addSelect(Z);}}},unselectItems:function A(V){V=J(V);if(!V){return ;}var a=this.selectedItems,W=[],Z=this.itemIdField,Y,U,X;if(a===null){return ;}for(X=0;X<V.length;X++){Y=V[X];if(a){delete a[Y[Z]];}U=B.call(this,Y);if(U<0){W.push(U);}}if(W.length>0){this.removeSelect(W);}},getSelectedItems:function G(){if(this.selectedItems){return M.valarray(this.selectedItems);}return I.get(this.items,M.keyarray(this.selectedIndices,true));},singleSelect:function(V,W,U){if(V!==-1){this.select([V],W,U);}},singleSelectByField:function O(V,W,U){this.singleSelect(I.find(this.items,W,V),U);},toggleSelect:function Q(U){var W,V;if(this.selectedIndices[U]){V=T(this,[U]);}else{W=F(this,[U]);}C.call(this,W,V,[U]);},select:function(W,V,U){W=J(W);if(!W){return ;}var Y=D(this,U),a=F(this,W,U),X;if(this.selectionPolicy!=="reselect"){for(X=Y.length-1;X>=0;X--){var Z=I.indexOf(a,Y[X]);if(Z>-1){Y.splice(X,1);a.splice(Z,1);}}}C.call(this,a,Y,W,V);},rangeSelect:function H(V,U){var a=this.selectedIndex,Y=a,Z=this.allIdx,W=[],X;if(V===Z||this.selectedIndices[Z]){W.push(Z);}else{if(Y===-1&&this.selectedIndices){for(X in this.selectedIndices){Y=parseInt(X,10);break;}}Y=Y===-1?0:Y;if(Y>V){Y=V;V=a;}for(X=Y;X<=V;X++){W.push(X);}}this.select(W,U);this.selectedIndex=a;},clearSelect:function(U){C.call(this,null,D(this),[],U);if(!U){this.raiseEvent({name:"clearSelection"});}},addSelect:function(X,U,V){X=J(X);if(!X){return ;}var W=F(this,X,V),Z=null,Y=this.noneIdx;if(this.multiSelect&&(Y>-1&&I.indexOf(X,Y)>-1)){Z=T(this,X);}C.call(this,W,Z,X,U);},removeSelect:function(W,U,V){W=J(W);if(!W){return ;}C.call(this,null,T(this,W,V),W,U);},_set_selectedIndices:function P(W,c,U){if(this.selectedItems){this.selectedItems={};}var V=this.selectedIndices;if(V===c){return false;}if(!V){V={};this.selectedIndices=V;}if(!c){c={};}var a=this.selectedIndex,Z=[],b;for(b in V){if(!c[b]){b=parseInt(b,10);delete V[b];Z.push(b);if(a===b){this.selectedIndex=-1;this.selectedItem=null;}}}var f=[],d=this.items,Y=this.itemIdField,e;for(b in c){if(!V[b]){b=parseInt(b,10);V[b]=true;f.push(b);this.selectedIndex=b;e=this.selectedItem=d[b];if(this.selectedItems){this.selectedItems[e[Y]]=e;}}}if(U!==true){var X=[];for(b in c){if(V[b]){b=parseInt(b,10);X.push(b);}}C.call(this,f,Z,X);}return(f.length||Z.length);},_set_selectedIndex:function N(X,V,U){var W={};if(V>-1){W[V]=true;}return this._set_selectedIndices("selectedIndices",W,U);},_set_selectedItem:function E(X,W,V){var U=B.call(this,W);if((U<0)&&(W!==null&&W!==undefined)&&this.allowUnlistedValues&&this.items){this.set("items",this.items.concat(W));U=this.items.length-1;}return this._set_selectedIndex("selectedIndex",U,V);},_addSelections:function(U){return F(this,U);},_removeAll:function(){return D(this);}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var K=mstrmojo.array,D=mstrmojo.hash;function E(V,T){var W=[],Q=V.selectedIndices,P=V.allIdx;var R,S,U=V.items;if(V.multiSelect&&(P>-1)&&(K.indexOf(T,V.allIdx)>-1)){for(R=0,S=U.length;R<S;R++){if(!Q[R]){W.push(R);Q[R]=true;V.selectedIndex=R;V.selectedItem=U[R];}}}else{for(R=0,S=T.length;R<S;R++){var X=T[R];if(!Q[X]){Q[X]=true;W.push(X);V.selectedIndex=X;V.selectedItem=U[X];}}}return W;}function J(R){var Q=[],S=R.selectedIndices,P;for(P in S){delete S[P];Q.push(parseInt(P,10));}R.selectedIndex=-1;R.selectedItem=null;return Q;}function H(V,U){var S=[],Q=V.selectedIndices,X=K.indexOf,P=V.allIdx;if(V.multiSelect&&(P>-1)&&(X(U,P)>-1)){return J(V);}if(U.length>0&&Q[P]){if(X(U,P)<0){U.push(P);}}var T=U.length,R;for(R=0;R<T;R++){var W=U[R];if(Q[W]){delete Q[W];S.push(W);if(V.selectedIndex===W){V.selectedIndex=-1;V.selectedItem=null;}}}return S;}function A(S,R){var P=S.selectedIndices;if(!P){P={};S.selectedIndices=P;}if(!R){R={};}var U=S.selectedIndex,T=[],V,Q;for(Q in P){if(!R[Q]){V=parseInt(Q,10);delete P[Q];T.push(V);if(U===V){S.selectedIndex=-1;S.selectedItem=null;}}}var X=[],W=S.items;for(Q in R){if(!P[Q]){V=parseInt(Q,10);P[Q]=true;X.push(V);S.selectedIndex=V;S.selectedItem=W&&W[V];}}return{add:X,rmv:T};}function G(Q,P,R){if(Q.raiseEvent&&((P&&P.length)||(R&&R.length))){Q.raiseEvent({name:"change",added:P,removed:R});}}mstrmojo._ListBase2Selections=mstrmojo.provide("mstrmojo._ListBase2Selections",{multiSelect:false,selectedIndices:null,selectedIndex:-1,selectedItem:null,selectedIndices_bindEvents:"change",selectedIndex_bindEvents:"change",selectedItem_bindEvents:"change",allowUnlistedValues:true,insertUnlistedValuesAt:-1,allIdx:-1,singleSelect:function F(P,Q){if(!this.selectedIndices[P]||(this.selectionPolicy==="reselect")||(P!==this.allIdx&&this.selectedIndices[this.allIdx])){var R=J(this),S=E(this,[P]);if(Q!==true){G(this,S,R);}}},toggleSelect:function O(P,Q){var S,R;if(this.selectedIndices[P]){R=H(this,[P]);}else{S=E(this,[P]);}if(Q!==true){G(this,S,R);}},rangeSelect:function N(P,Q){this.singleSelect(P,Q);},clearSelect:function I(P){var Q=J(this);if(P!==true){G(this,null,Q);}},select:function L(R,P){var Q=A(this,K.hash(R));if((P!==true)&&(Q.add.length||Q.rmv.length)){G(this,Q.add,Q.rmv);}},addSelect:function B(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=E(this,R);if(P!==true){G(this,Q,null);}return Q;},removeSelect:function M(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=H(this,R);if(P!==true){G(this,null,Q);}return Q;},_set_selectedIndices:function(S,Q,P){if(this.selectedIndices===Q){return false;}var R=A(this,Q);if(R.add.length||R.rmv.length){if(P!==true){G(this,R.add,R.rmv);}}return false;},_set_selectedIndex:function(S,Q,P){var R={};if(Q>-1){R[Q]=true;}return this._set_selectedIndices(null,R,P);},_set_selectedItem:function(W,T,S){var R=T&&(typeof T==="object"),V=this.itemIdField,Q=-1,U=this.items;if(R&&V!=null){Q=K.find(U,V,T[V]);}else{if(T!=null){Q=K.indexOf(U,T);}}if((Q===-1)&&(T!=null)&&this.allowUnlistedValues){var P=this.insertUnlistedValuesAt;if(P==null||P<0){P=(U&&U.length)||0;}Q=P;this.add([T],Q);}return this._set_selectedIndex(null,Q,S);},initSelections:function C(T,Q,P,S,R){if(!this.selectedIndices){this.selectedIndices={};this.selectedIndex=-1;}if(T){this._set_selectedIndices(null,T,R);}else{if(Q){this.select(Q,R);}else{if(S){this._set_selectedItem(null,S,R);}else{if(P!==null&&P!==undefined){this._set_selectedIndex(null,P,R);}}}}},sortSelectedIndices:function(){return D.keyarray(this.selectedIndices,true).sort(K.numSorter);},removeSelectedItems:function(){var R=this.sortSelectedIndices(),P=R.length,S=R[P-1],Q=this.remove(R);S=Math.min(S+1-P,this.items.length-1);if(S>=0){this.singleSelect(S);}return Q;},getSelectedItems:function(){return K.get(this.items,this.sortSelectedIndices())||[];},setSelectedItems:function(Q,d){if(!Q||!Q.length){return ;}var S=this.items||[],t=this.itemIdField!=null?K.findMulti(S,this.itemIdField,Q):K.indexOfMulti(S,Q),V=Q.length,T=V-t.count,q=this.allowUnlistedValues,b=this.insertUnlistedValuesAt,X=(q&&(b>-1))?T:0;if(b<0){b=S.length;}var R=[],U=[],f=t.map;if(T&&q){var p=0,e;for(e=0;e<V;e++){if(f[e]==null){R.push(Q[e]);U.push(b+p++);}}this.add(R,b);}var W=[],h;for(h in f){var o=f[h];if(o>=b){o+=X;}W.push(o);}var r=W.concat(U),Y=this.addSelect(r,!d);if(!d){var Z=K.hash(Y),g=this.selectedIndices,a=[],l;for(l in g){if(!Z[l]){a.push(parseInt(l,10));}}var P=this.removeSelect(a,true);G(this,Y,P);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var G=mstrmojo.array,E=mstrmojo.desc(2412,"Default"),H=mstrmojo.desc(3433,"Font"),B=mstrmojo.desc(3434,"Number"),C=mstrmojo.desc(3435,"Alignment"),A=mstrmojo.desc(2886,"Borders"),F=mstrmojo.desc(3905,"Background");var L=[{n:E,v:"pru"}];G.forEach(["Arial","Arial Black","Arial Narrow","Arial Unicode MS","Batang","Book Antiqua","Bookman Old Style","Comic Sans MS","Courier New","Garamond","Haettenschweiler","Helvetica","Impact","Lucida Console","Lucida Sans Unicode","Map Symbols","Marlett","Monotype Corsiva","Monotype Sorts","MS Gothic","MS Outlook","Microsoft Sans Serif","MT Extra","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings"],function(M){L.push({n:M,v:M});});function K(N,M,O){return(M&&M>=N)?K(N,M-O,O).concat(M):[];}var J=K(2,12,1);J=J.concat(K(14,24,2));J=J.concat(K(36,48,12));J=J.concat(K(72,72,1));var D=[{n:E,v:"pru"}];G.forEach(J,function(M){D.push({n:String(M),v:String(M)});});mstrmojo._FormatDefinition={Formats:[{n:H},{n:B},{n:C},{n:mstrmojo.desc(3436,"Color and Lines")}],FormatTarget:[{n:mstrmojo.desc(7942,"Element Header"),v:1,p:"header_format"},{n:mstrmojo.desc(7943,"Element Value"),v:2,p:"grid_format"},{n:mstrmojo.desc(7944,"Individual Items Header"),v:3,p:"child_header_format"},{n:mstrmojo.desc(7945,"Individual Items Value"),v:4,p:"child_grid_format"}],MetricFormatTarget:[{n:mstrmojo.desc(9710,"Metric Headers"),v:1,p:"header_format"},{n:mstrmojo.desc(9711,"Metric Values"),v:2,p:"grid_format"}],MetricValueFormats:[{n:B},{n:C},{n:H},{n:A},{n:F}],MetricHeaderFormats:[{n:B},{n:C},{n:H},{n:A},{n:F},{n:mstrmojo.desc(12139,"Chart")}],NumberFormatCategory:{Automatic:-3,Default:-2,General:9,Fixed:0,Currency:1,Date:2,Time:3,Percentage:4,Fraction:5,Scientific:6,Custom:7},DefaultFormat:{FormattingAlignment:{Horizontal:"1",Vertical:"1",TextWrap:"0",TextDirection:"0"},FormattingBorder:{HInsideStyle:"1",VInsideStyle:"1",TopStyle:"1",LeftStyle:"1",BottomStyle:"1",RightStyle:"1",HInsideColor:"0",VInsideColor:"0",TopColor:"0",LeftColor:"0",BottomColor:"0",RightColor:"0",Border3DStyle:"0",Border3DWeight:"0",Border3DBottomColor:"0",Border3DLeftColor:"0",Border3DRightColor:"0",Border3DTopColor:"0"},FormattingFont:{Name:"Arial",Bold:"0",Italic:"0",Size:"10",Strikeout:"0",Underline:"0",Color:"0",Script:"0"},FormattingNumber:{Category:"9",DecimalPlaces:"0",ThousandSeparator:"-1",CurrencySymbol:"$",CurrencyPosition:"0",Format:"General",NegativeNumbers:"3"},FormattingPadding:{LeftPadding:"1",RightPadding:"1",TopPadding:"1",BottomPadding:"1",LineSpacing:"0"},FormattingPatterns:{FillColor:"16777215",PatternColor:"8650752",PatternStyle:"1",FillStyle:"0",ApplyToGraphThreshold:"0",GradientColor:"16777215",GradientAngle:"0",GradientXOffset:"0",GradientYOffset:"0",SelectorSelectionColor:"16167264",SelectorSelectionFillStyle:"0",SeriesFillColor:"pru",SeriesPatternColor:"8650752",SeriesPatternStyle:"1",SeriesFillStyle:"0",SeriesApplyToGraphThreshold:"0",SeriesGradientColor:"16777215",SeriesGradientAngle:"0",SeriesGradientXOffset:"0",SeriesGradientYOffset:"0",SeriesSelectorSelectionColor:"16167264",SeriesSelectorSelectionFillStyle:"0"}},Families:L,Sizes:D,SizesInVI:D.slice(7,19),Styles:[{n:E,v:"pru"},{n:mstrmojo.desc(3440,"Regular"),v:"0,0"},{n:mstrmojo.desc(2718,"Bold"),v:"-1,0",v2:"-1,"},{n:mstrmojo.desc(2719,"Italic"),v:"0,-1",v2:",-1"},{n:mstrmojo.desc(3441,"Bold Italic"),v:"-1,-1"}],Effects:[{n:"Underline",v:0},{n:"Strike",v:1}],Category:[{n:E,v:-2},{n:mstrmojo.desc(2378,"General"),v:9},{n:mstrmojo.desc(2050,"Fixed"),v:0},{n:mstrmojo.desc(2051,"Currency"),v:1},{n:mstrmojo.desc(2052,"Date"),v:2},{n:mstrmojo.desc(2170,"Time"),v:3},{n:mstrmojo.desc(2053,"Percentage"),v:4},{n:mstrmojo.desc(2054,"Fraction"),v:5},{n:mstrmojo.desc(2055,"Scientific"),v:6},{n:mstrmojo.desc(2056,"Custom"),v:7}],MaxNegativeDidigts:30,FixedNegative:[{n:"-1,234.12",v:1,f:"#,##0.00"},{n:"-1,234.12",r:true,v:5,f:"#,##0.00;[RED]-#,##0.00"},{n:"1,234.12",r:true,v:2,f:"#,##0.00;[RED]#,##0.00"},{n:"(1,234.12)",v:3,f:"#,##0.00;(#,##0.00)"},{n:"(1,234.12)",r:true,v:4,f:"#,##0.00;[RED](#,##0.00)"}],CurrencyNegative:[{n:"-$1,234.12",v:1,f:'"$"#,##0.00'},{n:"-$1,234.12",r:true,v:5,f:'"$"#,##0.00;[RED]-"$"#,##0.00'},{n:"$1,234.12",r:true,v:2,f:'"$"#,##0.00;[RED]"$"#,##0.00'},{n:"($1,234.12)",v:3,f:'"$"#,##0.00;("$"#,##0.00)'},{n:"($1,234.12)",r:true,v:4,f:'"$"#,##0.00;[RED]("$"#,##0.00)'}],CurrencyPosition:[{n:mstrmojo.desc(2194,"Left"),v:0},{n:mstrmojo.desc(2195,"Right"),v:1},{n:mstrmojo.desc(2183,"Left with space"),v:2},{n:mstrmojo.desc(2182,"Right with space"),v:3}],Date:[{n:mstrmojo.desc(2231,"4/7"),v:"m/d"},{n:mstrmojo.desc(2232,"04/07"),v:"mm/dd"},{n:mstrmojo.desc(2233,"4/7/98"),v:"m/d/yy"},{n:mstrmojo.desc(2234,"04/07/98"),v:"mm/dd/yy"},{n:mstrmojo.desc(2235,"04/07/1998"),v:"mm/dd/yyyy"},{n:mstrmojo.desc(2236,"7-Apr"),v:"d-mmm"},{n:mstrmojo.desc(2237,"7-Apr-98"),v:"d-mmm-yy"},{n:mstrmojo.desc(2238,"Apr-98"),v:"mmm-yy"},{n:mstrmojo.desc(2239,"Apr '98"),v:"mmm 'yy"},{n:mstrmojo.desc(2240,"April 1998"),v:"mmmm yyyy"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2243,"April 7, 1998"),v:"mmmm d, yyyy"}],Time:[{n:mstrmojo.desc(2244,"15:41"),v:"h:mm"},{n:mstrmojo.desc(2245,"3:41 PM"),v:"h:mm AM/PM"},{n:mstrmojo.desc(2246,"15:41:46"),v:"h:mm:ss"},{n:mstrmojo.desc(2247,"3:41:46 PM"),v:"h:mm:ss AM/PM"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2250,"04/07/98 15:41"),v:"mm/dd/yy h:mm"},{n:mstrmojo.desc(2248,"04/07/98 3:41 PM"),v:"mm/dd/yy h:mm AM/PM"}],PercentNegative:[{n:"-12.12%",v:1,f:"0.00%"},{n:"-12.12%",r:true,v:5,f:"0.00%;[RED]-0.00%"},{n:"12.12%",r:true,v:2,f:"0.00%;[RED]0.00%"},{n:"(12.12%)",v:3,f:"0.00%;(0.00%)"},{n:"(12.12%)",r:true,v:4,f:"0.00%;[RED](0.00%)"}],Fraction:[{n:"12 1/3",v:"# ?/?"},{n:"37/3",v:"?/?"},{n:"12 26/81",v:"# ??/??"},{n:"998/81",v:"??/??"}],TextDirection:[{n:E,v:"pru"},{n:mstrmojo.desc(4601,"Horizontal"),v:0},{n:mstrmojo.desc(5156,"-90 Degree"),v:-90}],Horizontal:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2378,"General"),v:1},{n:mstrmojo.desc(2194,"Left"),v:2},{n:mstrmojo.desc(2193,"Center"),v:3},{n:mstrmojo.desc(2195,"Right"),v:4},{n:mstrmojo.desc(2068,"Justify"),v:6}],Vertical:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2256,"Top"),v:1},{n:mstrmojo.desc(2067,"Center"),v:2},{n:mstrmojo.desc(2257,"Bottom"),v:3}],TextWrap:[{v:0},{v:-1}],BorderStyles:[{n:E,v:"pru"},{n:mstrmojo.desc(2258,"None"),v:0},{n:mstrmojo.desc(2259,"Dashed"),v:3},{n:mstrmojo.desc(2260,"Dotted"),v:4},{n:mstrmojo.desc(2261,"Hair"),v:7},{n:mstrmojo.desc(2262,"Thin"),v:1},{n:mstrmojo.desc(2264,"Thick"),v:5},{n:mstrmojo.desc(2265,"Double"),v:6}],extractModel:function(O,Q,N){var S=N||this.DefaultFormat,R;for(R in O){var M=O[R];if(!M.attachEventListener){if(!mstrmojo.hash.isEmpty(M)){Q[R]=M;}}else{var P;for(P in M){if(S[R]&&S[R][P]){if(!Q[R]){Q[R]={};}Q[R][P]=M[P];}}}}},getAvailableFonts:function I(){var M={success:function(O){if(O.name==="fontPicker"){var N=[{n:E,v:"pru"}];mstrmojo.array.forEach(O.shortcuts,function(P){N.push({n:P.attributes[1].value,v:P.attributes[1].value});});mstrmojo._FormatDefinition.Families=N;}}};mstrmojo.xhr.request("POST",mstrConfig.taskURL,M,{taskId:"getSystemPickerJson",name:"fontPicker"},false,null,true);},getStandardFormat:function(N,M){var P=mstrmojo.hash.clone(M||this.DefaultFormat),O;N=N||{};for(O in P){N[O]=N[O]||{};}for(O in N){if(!N[O].attachEventListener){N[O]=mstrmojo.hash.make(N[O],mstrmojo.Obj);}}return N;},saveFormatModel:function(Q,W,N,X){var V=X||this.DefaultFormat,S,M;for(S=0;S<N.length;S++){var R=N[S],P=W[R]||null,U=Q[R];if(U===undefined){delete W[R];continue;}for(M in V){var T=V[M],O;if((!P&&!U)||(P&&!P[M]&&!U[M])){continue;}for(O in T){if(U[M]===undefined||U[M]===""||U[M][O]==="pru"||U[M][O]===undefined){if(P&&P[M]&&(P[M][O]!==undefined&&P[M][O]!==null&&P[M][O]!=="pru")){P[M][O]="pru";}}else{P=P||{};P[M]=P[M]||{};P[M][O]=U[M][O];}}}if(P){W[R]=P;}}}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var O=/this\.([\w\.\[\]\'\"\-]+)/m,D=/this\./m,M=/mstrmojo\.all\[[\'\"]([\w]+)[\'\"]\]\.([\w\.\[\]\'\"\-]+)/m,R=/mstrmojo\.all\[/m,L=/mstrmojo\.all\.([\w]+)\.([\w\.\[\]\'\"\-]+)/m,B=/mstrmojo\.all\./m,C=/\[(\d+)\]/g,E=/\[\'([\w\-]+)\'\]/g,P=/\[\"([\w\-]+)\"\]/g,H=/([\[\]].*)/;mstrmojo.Binding=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Binding",parent:null,source:null,destination:null,enabled:false,setter:"set",executing:0,init:function N(S){mstrmojo.hash.copy(S,this);mstrmojo.registry.add(this);},destroy:function F(){mstrmojo.publisher.clearSubscriptions(this.id);mstrmojo.registry.remove(this);},exec:function K(){this.executing++;var W=this._sourceFn;if(!W){var V=this.source;if(V!=null){if(typeof (V)=="string"){if(!(V.match("return "))&&!(V.match(/\;\s*\S/))){V="return "+V;}W=new Function(V);}else{if(typeof (V)=="function"){W=V;}}this._sourceFn=W;}}var S,X=this.parent;if(W){try{S=W.apply(X,[]);}catch(U){}}var T=this.setter,Y=this.destination;if(T==null){X[Y]=S;}else{if(typeof (T)=="string"){X[T](Y,S);}else{if(typeof (T)=="function"){T.apply(X,[Y,S]);}}}this.executing--;},enable:function A(){if(!this.enabled){this.exec();var T=this._chains;if(!T){this._parseChains();T=this._chains;}for(var S in T){this._attachChain(T[S]);}this.enabled=true;}},disable:function J(){if(this.enabled){var T=this._chains;if(T){for(var S in T){this._detachChain(T[S]);}}this.enabled=false;}},_chains:null,_parseChains:function(){this._chains={};var U=this._chains;var T=this.source;if(T&&(typeof (T)=="function")){T=T.toString&&T.toString();}if(!T){return ;}function S(b,e,V,X){var W=b,Z;while(Z=W.match(e)){var c=Z[0],a=c.length,d=true;c=c.replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"");for(var Y in U){if(Y.substr(0,a)===c){d=false;break;}else{if(c.indexOf(Y)===0){delete U[Y];}}}if(d){U[c]={host:(V==null)?null:Z[V],parts:Z[X].replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"").split(".")};}W=W.substr(Z.index+a);}}if(D.test(T)){S(T,O,null,1);}if(R.test(T)){S(T,M,1,2);}if(B.test(T)){S(T,L,1,2);}},_attachChain:function Q(S,U){if(!S.evt2idx){S.evt2idx={};}if(!S.idx2evt){S.idx2evt=[];}var d=S.evt2idx,g=S.idx2evt,Z=S.parts;var e=(U>=0)?U:0,b=this.id,W=mstrmojo.all,c=(U>0)?W[g[e-1].context][Z[e-1]]:(S.host?W[S.host]:this.parent),T=Z[e];var V=mstrmojo.array;while(c&&T){if(c.attachEventListener){var f=c[T+"_bindEvents"]||(T+"Change");if(typeof (f)=="string"){f=[f];}var Y=[];for(var a=0,X=f.length;a<X;a++){Y[a]=c.attachEventListener(f[a],b,"_callback");}for(var a=0;a<f.length;a++){d[c.id+"_"+f[a]]=e;}g[e]={context:c.id,evts:f,subs:Y};}c=c[T];T=S.parts[++e];}},_detachChain:function G(S,T){var U=mstrmojo.all,h=S.idx2evt,d=S.evt2idx,a=this.id;var Y=(T>-1)?T:0,b=h.length;if(Y<b){for(;Y<b;Y++){var Z=h[Y];if(!Z){break;}var W=Z.context,c=U[W],g=Z.evts;if(c&&c.detachEventListener){var k=Z.subs;for(var f=0,V=k.length;f<V;f++){c.detachEventListener(k[f]);}}h[Y]=null;for(var X=0,e=g.length;X<e;X++){delete d[W+"_"+g[X]];}}}},_callback:function I(T){this.exec();if(!T||!T.name||!T.src){return ;}var U=T.src.id+"_"+T.name,W=this._chains;for(var X in W){var V=W[X],S=V.evt2idx[U];if(S!=null){this._detachChain(V,S+1);this._attachChain(V,S+1);}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var D=mstrmojo.dom,L=mstrmojo.hash;var O=100;var F=D.supportsTouches?0.5:1;var G=1;var R=100;var P={onvscrollVisibleChange:function(){var U=this.vscrollNode,V=U&&U.style;if(!V){return ;}if(this.vscrollVisible){var T=this.maxPos,W=this.clientSize;V.height=Math.round(W.y*W.y/T.y)+"px";V.left=(W.x-5)+"px";V.display="block";V.opacity=0.5;}else{V.opacity=0;}},onhscrollVisibleChange:function(){var V=this.hscrollNode,U=V&&V.style;if(!U){return ;}if(this.hscrollVisible){var T=this.maxPos,W=this.clientSize;U.width=Math.round(W.x*W.x/T.x)+"px";U.top=(W.y-5)+"px";U.display="block";U.opacity=0.5;}else{U.opacity=0;}}};var M=L.copy({onposChange:function(){var V=this.clientSize,U=this.maxPos,T=0,W=0;if(this.scrollsVert){W=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style[D.CSS3_TRANSFORM]="translateY("+Math.round((V.y-(V.y*V.y/U.y))*this.pos.y/U.y)+"px)";}}if(this.scrollsHoriz){T=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style[D.CSS3_TRANSFORM]="translateX("+Math.round((V.x-(V.y*V.x/U.x))*this.pos.x/U.x)+"px)";}}this.scrollChild.style[D.CSS3_TRANSFORM]="translate3d(-"+parseInt(T,10)+"px, -"+parseInt(W,10)+"px, 0px)";},ondeceleratingChange:function(){this.scrollChild.style[D.CSS3_TRANSITION]=this.decelerating?(D.CSS3_PREFIX+"transform 0.2s linear"):"";}},L.copy(P));var H=L.copy({onposChange:function(){var V=this.clientSize,U=this.maxPos,T=0,X=0,W=this.scrollboxNode;if(this.scrollsVert){X=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style.top=Math.round((V.y-(V.y*V.y/U.y))*this.pos.y/U.y)+"px";}W.scrollTop=parseInt(X,10);}if(this.scrollsHoriz){T=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style.left=Math.round((V.x-(V.y*V.x/U.x))*this.pos.x/U.x)+"px";}W.scrollLeft=parseInt(T,10);}}},L.copy(P));mstrmojo._TouchScrolling=mstrmojo.provide("mstrmojo._TouchScrolling",{FRICTION:0.65,BOUNCEFRICTION:0.5,usesTouches:false,bounces:true,scrollsHoriz:true,scrollsVert:true,pos:null,preBuildRendering:function N(){this.usesTouches=(mstrmojo.dom.supportsTouches&&this.usesTouches&&(this.scrollsHoriz||this.scrollsVert));if(this.usesTouches){this.pos={x:0,y:0};}if(this._super){this._super();}},postBuildRendering:function C(){if(this._super){this._super();}if(this.usesTouches){var W=this.scrollboxNode,V=this.itemsContainerNode||W.firstChild;if(W&&W!==V){this.scrollChild=V;var T=W.style;T.position="relative";T.overflow="hidden";var U=V.style;U.position="absolute";U.left=0;U.top=0;this.markupMethods=L.copy(D.isSafari?M:H,L.copy(this.markupMethods));this.attachTouchEvents();}}},unrender:function(T){if(this.usesTouches){this.detachTouchEvents();}this._super(T);},attachTouchEvents:function(){var U=this.touchNode||this.scrollboxNode;if(U){if(!this._tsCallback){var T=this;this._tsCallback=function(V){T.touchesBegin(self,V);};this._tmCallback=function(V){T.touchesMoved(self,V);};this._teCallback=function(V){T.touchesEnd(self,V);};}D.attachEvent(U,D.TOUCHSTART,this._tsCallback);this._tsNode=U;}},detachTouchEvents:function(){var T=this._tsNode;if(T){D.detachEvent(T,D.TOUCHSTART,this._tsCallback);delete this._tsNode;}},touchesBegin:function J(T,V){var U=V.target&&V.target.tagName;if(U&&(U==="SELECT"||U==="INPUT")){return ;}D.preventDefault(T,V);this.stopDeceleration();this.startTime=new Date();this.startTimePos={x:this.pos.x,y:this.pos.y};this.startTouchPos=D.getMousePosition(D.firstTouch(T,V),T);this.dragging=false;D.attachEvent(window,D.TOUCHMOVE,this._tmCallback);D.attachEvent(window,D.TOUCHEND,this._teCallback);},touchesMoved:function E(b,d){var Z=D.getMousePosition(D.firstTouch(b,d),b);D.preventDefault(b,d);if(!this.dragging){var T=5,h=Math.abs;if((this.scrollsHoriz&&h(Z.x-this.pos.x)>T)||(this.scrollsVert&&h(Z.y-this.pos.y)>T)){this.dragging=true;this.dragStartTime=new Date();this.startTouchPos=Z;var V=this.scrollboxNode,Y={x:V.clientWidth,y:V.clientHeight},f={x:V.scrollWidth,y:V.scrollHeight};this.clientSize=Y;this.scrollSize=f;this.maxPos={x:Math.max(f.x-Y.x,0),y:Math.max(f.y-Y.y,0)};this.showScroll();}}if(this.dragging){D.stopPropogation(b,d);var c=this.startTimePos,X=this.startTouchPos,a=this.maxPos;var W={x:this.scrollsHoriz?Math.max(Math.min(c.x-(Z.x-X.x),a.x),0):0,y:this.scrollsVert?Math.max(Math.min(c.y-(Z.y-X.y),a.y),0):0};this.set("pos",W);this.nextLastDragPos=this.lastDragPos;this.lastDragPos=Z;var U=new Date(),g=this.lastDragTime;this.nextLastDragTime=g;this.lastDragTime=U;if((U-g)>R){this.startTime=this.lastDragTime;this.dragStartTime=this.startTime;this.startTimePos={x:W.x,y:W.y};this.startTouchPos=Z;}}},touchesEnd:function I(T,U){D.preventDefault(T,U);D.detachEvent(window,D.TOUCHMOVE,this._tmCallback);D.detachEvent(window,D.TOUCHEND,this._teCallback);if(this.dragging){this.dragging=false;D.stopPropogation(T,U);if((new Date())-this.lastDragTime<=R){this.startDeceleration(T,U);}else{this.hideScroll();}}},startDeceleration:function B(Y,Z){var W=D.getMousePosition(D.firstChangedTouch(Y,Z),Y),c=((mstrmojo.dom.supportsTouches===null)?this.lastDragPos:this.nextLastDragPos)||W,b={x:W.x-c.x,y:W.y-c.y},T=((mstrmojo.dom.supportsTouches===null)?this.lastDragTime:this.nextLastDragTime),d=T?(new Date())-T:0,V={x:d?Number(b.x*O*F/d).toFixed(2):0,y:d?Number(b.y*O*F/d).toFixed(2):0};var a=this,U=function(e){return(a.scrollsHoriz&&Math.abs(e.x)>=G)||(a.scrollsVert&&Math.abs(e.y)>=G);};if(U(V)){this.velocity=V;this.friction={x:this.FRICTION,y:this.FRICTION};this.set("decelerating",true);var X=function(){a.decelerate();if(!U(a.velocity)){a.stopDeceleration();a=null;}};X();if(this.decelerating){this.decelerationTimer=window.setInterval(X,O);}}else{this.hideScroll();}},stopDeceleration:function A(){this.set("decelerating",false);delete this.velocity;if(this.decelerationTimer){window.clearTimeout(this.decelerationTimer);delete this.decelerationTimer;}this.hideScroll();},decelerate:function S(){var W=this.pos,V=this.velocity,U=this.friction,Z=this.maxPos,X={x:W.x-V.x,y:W.y-V.y},b=this.bounces,T=this.BOUNCEFRICTION;var a=X.x;if(a<0||a>Z.x){X.x=(a<0)?0:Z.x;V.x*=b?-T:0;U.x=T;}var Y=X.y;if(Y<0||Y>Z.y){X.y=(Y<0)?0:Z.y;V.y*=b?-T:0;U.y=T;}this.set("pos",X);this.velocity={x:U.x*V.x,y:U.y*V.y};},hideScroll:function K(){this.set("vscrollVisible",false);this.set("hscrollVisible",false);},showScroll:function Q(){var T=this.maxPos;if(this.scrollsVert&&T.y&&this.vscrollNode){this.set("vscrollVisible",true);}if(this.scrollsHoriz&&T.x&&this.hscrollNode){this.set("hscrollVisible",true);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var B=mstrmojo.hash;mstrmojo.Base=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Base",init:function A(C){B.copy(C,this);if(this.postApplyProperties){this.postApplyProperties();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var E=mstrmojo.dom,M=mstrmojo.hash,B,I=mstrmojo.global.document,K="mousedown",P="mousemove",R="mouseup";function G(Y){if(E.isPrimaryMouseBtn(Y)){B.startDragCheck(self,Y);}}var V,Q,A="mstrmojo-dnd-avatar",U;function F(Z,Y){if(Y!==undefined&&Y!==null){Q.innerHTML=Y;}U.left=Z.x+"px";U.top=Z.y+"px";}function L(Z,Y){if(!V){V=I.createElement("div");U=V.style;V.className=A;V.innerHTML='<div class="'+A+'-inner"></div>';Q=V.firstChild;I.body.appendChild(V);}F(Z,Y);U.display="block";}function S(){if(U){U.display="none";}}function H(Y){var Z=++B.ctxt.moveCount;if(Z>=B.minMoves){B.stopDragCheck();if((Y.buttons===1||Y.buttons===undefined||E.isIE9)&&(Y.which===1||Y.button===0||E.isIE8)){B.startDrag(self,Y);}}}function O(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDragCheck();delete B.ctxt;}}function D(Y){B.onDragMove(self,Y);}function C(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDrag(window,Y);}}function N(b){var Z=mstrmojo.hash.copy(b,{}),a=Z.hWin=Z.hWin||window,Y=Z.e=Z.e||a.event;Z.node=E.eventTarget(a,Y);Z.pos=E.getMousePosition(Y,a);return Z;}function J(Z){var Y=E.findWidget(Z);while(Y){if(Y.draggable){return Y;}Y=Y.parent;}return null;}function T(Y){var a=Y.src,Z=J(a.node);if(!Z){return null;}if(Z.getDragAction){Y.action=Z.getDragAction(Y);}a.widget=Z;a.data=Z.getDragData&&Z.getDragData(Y);if(Z.isDragValid){if(!Z.isDragValid(Y)){if(!Z.shouldDragBubble||Z.shouldDragBubble(Y)!==true){Y.src.node=Z.domNode.parentNode;return T(Y);}return null;}}if(Z.ondragstart){Z.ondragstart(Y);}return Z;}function X(a,Z){var Y=E.findWidget(a),b=Z.tgt&&Z.tgt.widget;while(Y){if(Y.dropZone){if(Y===b){return Y;}if(Y.allowDrop&&Y.allowDrop(Z)){return Y;}}Y=Y.parent;}return null;}function W(){if(this.set){this.set("allowingDrop",false);}}mstrmojo.dnd=mstrmojo.dnd||mstrmojo.provide("mstrmojo.dnd",{minMoves:3,enable:function(){if(!mstrmojo.dndEnabled){E.attachEvent(I,K,G);mstrmojo.dndEnabled=true;}},disable:function(){mstrmojo.dndEnabled=false;E.detachEvent(I,K,G);},startDragCheck:function(Y,Z){delete this.ctxt;var a=N({hWin:Y,e:Z});this.ctxt={src:a,moveCount:0,last:M.copy(a.pos),getDirection:function(b){return !!this.dir[b];},getCtxtDragData:function(){var b=this.src;return(b&&b.data)||{};},getCtxtDropData:function(){var b=this.tgt;return(b&&b.data)||{};}};if(this.minMoves){E.attachEvent(I,P,H);E.attachEvent(I,R,O);}else{this.startDrag(Y,Z);}},stopDragCheck:function(){E.detachEvent(I,P,H);E.detachEvent(I,R,O);},startDrag:function(Y,b){var Z=this.ctxt;Z.id=mstrmojo.now();var a=T(Z);if(!a){return ;}E.clearBrowserHighlights(Y);E.preventDefault(self,b);E.attachEvent(I,P,D);E.attachEvent(I,R,C);var d=window.mstrApp;if(d&&d.setInteractive){this._changeAppStatus=d.setInteractive(false);}if(!a.ownAvatar){var c=Z.src;L(c.pos,c.data&&c.data.html);}},stopDrag:function(Y,f){E.detachEvent(I,P,D);E.detachEvent(I,R,C);var b=this.ctxt,a=b.tgt||{},Z=N({hWin:Y,e:f,data:a.data}),d=X(Z.node,b);Z.widget=d;b.tgt=Z;if(d){if(d.ondrop){d.ondrop(b);}else{W.call(d);}}var c=b.src.widget;if(c&&c.ondragend){c.ondragend(b);}if(c&&!c.ownAvatar){S();}if(this._changeAppStatus){window.mstrApp.setInteractive(true);delete this._changeAppStatus;}},onDragMove:function(c,f){if(E.isSafari){E.clearBrowserHighlights();}var Y=this.ctxt,b=Y.tgt||{},Z=b.widget,d=N({hWin:c,e:f,data:b.data}),j=d.widget=X(d.node,Y),h=Y.last,a=d.pos;Y.dir={x:a.x>h.x,y:a.y>h.y};Y.last=M.copy(d.pos);Y.tgt=d;if(Z!==j){if(Z){if(Z.ondragleave){Z.ondragleave(Y);}else{W.call(Z);}}if(j){Y.tgt.data=(j.getDropData&&j.getDropData(Y))||{};if(j.ondragenter){j.ondragenter(Y);}else{if(j.set){j.set("allowingDrop",true);}}}}if(j){if(j.ondragover){j.ondragover(Y);}}var g=Y.src.widget;if(g&&g.ondragmove){g.ondragmove(Y);}if(g&&!g.ownAvatar){F(d.pos);}}});B=mstrmojo.dnd;B.enable();}());mstrmojo.DPIManager={classes:[],registerClass:function registerClass(B,C,D,A){this.classes.push({c:B,d:C,s:D,v:A});},setDPI:function(){var A=mstrMobileApp.getDeviceDPI();mstrmojo.array.forEach(this.classes,function(B){B.c.prototype.layoutConfig[B.d][B.s]=B.v[A]+"px";});this.classes=[];}};(function(){document.msCSSOMElementFloatMetrics=true;mstrmojo.requiresCls("mstrmojo.hash");var S=mstrmojo.hash,H="containerNode",G="auto",Q="px";var I={v:G,c:undefined,sv:G};function E(c,f,e){var g=this._layoutWidgets[f],k=c.slot||H,h=g.f,j=g.p,d=(h&&h[k]!==undefined),b=(j&&j[k]!==undefined);if(k&&((!e&&d)||b)){return d?h[k]:(g.x*parseInt(j[k],10)/100)+Q;}return c[(f==="h")?"height":"width"];}function K(g,d,b){if(g.ignoreLayout){return ;}var c=(d===G)||d==="NaNpx",f=(b===G)||b==="NaNpx";var e=g.getLayoutOffsets&&g.getLayoutOffsets();if(e){if(!c){d=(parseInt(d,10)-e.h)+Q;}if(!f){b=(parseInt(b,10)-e.w)+Q;}}if(g.setDimensions){g.setDimensions(d,b);}else{if(g.set){if(!c){g.set("height",d);}if(!f){g.set("width",b);}}}}function Z(e){var c=this.children,g,k;for(g=0,k=(c&&c.length)||0;g<k;g++){var d=c[g],l=d.slot||H;if(l){var j=E.call(this,d,"h",e),m=E.call(this,d,"w",e);this.setSlotDimensions(l,j,m);K(d,j,m);var b=E.call(this,d,"h",e),f=E.call(this,d,"w",e);if(b!==j||f!==m){K(d,b,f);}this.setSlotDimensions(l,b,f);}}this.afterLayout();}function B(){var c=this.children,b=this._layoutWidgets;S.forEach(this.slotNames,function(g,j){if(!g||this.skipsSlotLayout(j)){return ;}var f=(b.h&&b.h.getSlotSizeInfo(j,c))||I,d=(b.w&&b.w.getSlotSizeInfo(j,c))||I,e=f.c||d.c;mstrmojo.array.forEach(e,function(h){K(h,f.v,d.v);});this.setSlotDimensions(j,f.sv,d.sv);},this);this.afterLayout();}function D(c){var b=this.layoutConfig.xt?B:Z;b.call(this,c);}function T(j,e,g){var h=j.slot||H,f=e&&e.a;if(!f||f[h]===undefined){return ;}var b=this[h]["offset"+g],c=f[h];if(b===c){return ;}e.x-=(b-c);f[h]=b;}function J(b){this.beforeLayout();var c=this._layoutWidgets,d=b.src;T.call(this,d,c.h,"Height");T.call(this,d,c.w,"Width");D.call(this,true);}function O(d,g){if(!d){return null;}var b=this.children,q=g.toLowerCase(),h=parseInt(this[q],10),k=h,m={},o={},f={},c={},n={},j,l,e,r,p;for(p in d){if(!d.hasOwnProperty(p)){continue;}r=d[p];if(r.match(/px$/)){h-=parseInt(r,10);m[p]=r;}else{if(r.match(/%$/)){o[p]=r;}else{if(r.match(/all/)){n[p]=k;}else{f[p]=r;}}}}if(!S.isEmpty(f)&&!S.isEmpty(o)){for(j=0,l=(b&&b.length)||0;j<l;j++){e=b[j];p=e.slot||H;if(p&&f[p]&&!e.ignoreLayout){if(e.hasRendered){c[p]=this[p]["offset"+g];h-=c[p];}else{c[p]=0;e.attachEventListener((e instanceof mstrmojo.Container)?"childrenRendered":"renderComplete",this.id,J);}}}}return{f:S.isEmpty(m)?undefined:m,p:S.isEmpty(o)?undefined:o,a:S.isEmpty(c)?undefined:c,n:S.isEmpty(n)?undefined:n,x:h,getSlotSizeInfo:function(AC,w){if(!d[AC]){return I;}var u=mstrmojo.array.filter(w,function(AE){var AD=AE.slot;return AD===AC||(AC===H&&!AD);}),AA,AB;var t=m[AC];if(t){AB=t;}var z=o[AC];if(z){AB=(this.x*parseInt(z,10)/100)+Q;}if(f[AC]){AB=c[AC];if(AB){AB+=Q;}else{AB=G;}AA=G;}var x=n[AC];if(x){AB=AA=x+Q;}AB=AB||"0px";return{v:AB,c:u,sv:AA||AB};}};}function R(c){var b=this.domNode;if(!b||!this.layoutConfig){return ;}b.style[c]=this[c];this.doLayout();}mstrmojo._HasLayout=mstrmojo.provide("mstrmojo._HasLayout",{_mixinName:"mstrmojo._HasLayout",height:"auto",width:"auto",ignoreLayout:false,beforeLayout:mstrmojo.emptyFn,afterLayout:mstrmojo.emptyFn,layoutConfig:null,init:function V(b){this._super(b);this.layoutConfig=S.clone(this.layoutConfig);},preBuildRendering:function C(){var d=this.cssText||"";var b=this.height;if(b&&b!==G){d+="height:"+this.height+";";}var c=this.width;if(c&&c!==G){d+="width:"+this.width+";";}this.cssText=d;return(this._super)?this._super():true;},postBuildRendering:function W(){this.doLayout();return this._super();},modifyLayoutConfig:function Y(d,c){var b=this.layoutConfig=this.layoutConfig||{};b.h=S.copy(d,b.h);b.w=S.copy(c,b.w);this.doLayout();},getLayoutOffsets:mstrmojo.emptyFn,set:function P(d,b){var c=this._super(d,b);if(d==="visible"&&this._pendingLayoutOnVisible){delete this._pendingLayoutOnVisible;this.doLayout();}return c;},doLayout:function A(){var b=this.layoutConfig;if(!b||(this.height===G&&this.width===G)){return ;}if(b.xt){if(!this.visible){this._pendingLayoutOnVisible=true;return ;}}this.beforeLayout();this._layoutWidgets={h:O.call(this,b.h,"Height"),w:O.call(this,b.w,"Width")};D.call(this,false);this.widgetResized();},browserResized:function F(b){this.setDimensions(b.h,b.w);return true;},onwidthChange:function N(){R.call(this,"width");},onheightChange:function M(){R.call(this,"height");},skipsSlotLayout:function(b){return false;},adjustParentDimensions:function L(){var c=this.parent,b=c&&c._layoutWidgets;if(b){T.call(c,this,b.h,"Height");T.call(c,this,b.w,"Width");}},setDimensions:function U(e,c){var d=(e===G)||e==="NaNpx",f=(c===G)||c==="NaNpx";if((!d&&parseInt(this.height,10)!==parseInt(e,10))||(!f&&parseInt(this.width,10)!==parseInt(c,10))){if(!d){this.height=e;}if(!f){this.width=c;}var b=this.domNode,g=b&&b.style;if(g){if(!d){g.height=e;}if(!f){g.width=c;}this.doLayout();}return true;}return false;},setSlotDimensions:function X(e,d,c){var b=this[e]&&this[e].style;if(!b){return ;}if(d!==G&&d!==undefined&&d!=="NaNpx"&&b.height!==d&&parseInt(d)>=0){b.height=d;}if(c!==G&&c!==undefined&&c!=="NaNpx"&&b.width!==c&&parseInt(c)>=0){b.width=c;}}});mstrmojo._HasLayout.getSlotSize=function a(e,f){var c=e&&e.prototype.layoutConfig;if(c){var d=c.h,b=c.w;return{h:(d&&d[f])||undefined,w:(b&&b[f])||undefined};}return null;};}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var A=mstrmojo.hash;mstrmojo.requiresDescs(2213,3326,3327,3329,4531,13283,13284,13285,13286);mstrmojo.ME.Enum={METRIC_ACTIONS:{ADD:"add",EDIT:"edit",EIDT_NEW:"editNew"},EDITOR_IDS:{ADVANCED:"mstrME",FORMULA:"mstrME",WIZARD:"mstrFE",SIMPLE:"mstrSME",SELECOTR:"mstrFSE"},EDITOR_TYPES:{ADVANCED:"ADVANCED",FUNCTION:"FUNCTION",SIMPLE:"SIMPLE",SELECTOR:"SELECTOR"},METRIC_EDIT_TYPES:{ADVANCED:65536,SIMPLE:131072,FUNCTION:196608},METRIC_TYPES:{65536:"ADVANCED",131072:"SIMPLE",196608:"FUNCTION"},NEW_METRIC_DEFINITION:{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}},getNewDefinition:function(){return{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}};},FBFlag:{Automatic:0,Manual:3},AFB:{Automatic:-1,False:0,True:1},SFB:{Automatic:-1,False:1,True:2},UI_OBJECT_TYPE:{Dimty:-1,Sub_Expression:-2,Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},UI_DATA_TYPE:{Sortby:-1,Breakby:-2,Level:-4,Condition:-5,Transformation:-6},SHORTCUT_FUNCTIONS:{Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},DYNAMIC_DIMTY:{CODES:{auto:{n:mstrmojo.desc(4531,"Automatic"),did:"@auto",t:-1},page:{n:mstrmojo.desc(3329,"Grand Total"),did:"@p",t:-1},byCol:{n:mstrmojo.desc(3326,"By Columns"),did:"@cols",t:-1},byRow:{n:mstrmojo.desc(3327,"By Rows"),did:"@rows",t:-1},byCell:{n:mstrmojo.desc(13283,"By Cell"),did:"@cell",t:-1},byShape:{n:mstrmojo.desc(13284,"By Shape"),did:"@shape",t:-1},downCross:{n:mstrmojo.desc(13285,"Down, Then Across"),did:"@cr",t:-1},crossDown:{n:mstrmojo.desc(13286,"Across, Then Down"),did:"@rc",t:-1}},getItems:function D(G){var F=this.CODES,E=[];switch(G){case"breakby":E=[F.auto,A.copy({n:mstrmojo.desc(2057,"None")},A.copy(F.page)),A.copy({n:mstrmojo.desc(122,"Columns")},A.copy(F.byCol)),A.copy({n:mstrmojo.desc(2968,"Rows")},A.copy(F.byRow)),A.copy({n:mstrmojo.desc(13399,"Cell")},A.copy(F.byCell)),A.copy({n:mstrmojo.desc(2923,"Shape")},A.copy(F.byShape))];break;case"level":E=[F.auto,F.page,F.byCol,F.byRow,F.byCell,F.byShape];break;case"sortby":E=[F.auto,F.downCross,F.crossDown];}return E;},getAutomaticDimtyObject:function C(){return A.copy(this.CODES.auto);},getDimtyObject:function B(E,H){var F=null;var G=false;if(H){A.forEach(mstrmojo.ME.Enum.DYNAMIC_DIMTY.CODES,function(I){if(I.did===E){F=A.copy(I);G=true;return false;}});}if(!G){F={n:E,t:-1,dimty:true};}return F;}},NonExposableParams:["IsNewOLAP","OLAPPattern","OLAPHasWindow"]};mstrmojo.ME.Enum.DEFAULT_MPS={mps:{afb:mstrmojo.ME.Enum.AFB.False,sfb:mstrmojo.ME.Enum.SFB.False,fbf:mstrmojo.ME.Enum.FBFlag.Automatic}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;mstrmojo.ui._IsIncFetchList=mstrmojo.provide("mstrmojo.ui._IsIncFetchList",{_mixinName:"mstrmojo.ui._IsIncFetchList",ifDataHelper:null,supportsIncFetch:false,isFetching:false,initScroll:function A(){var G=this.ifDataHelper,F=this,E=this.scrollNode||this.domNode;this.supportsIncFetch=G&&G.hasNext();if(G&&this.supportsIncFetch){this._scroll=function D(){if(E.offsetHeight+E.scrollTop>=E.scrollHeight){F.raiseEvent({name:"incFetch",id:F.id});}};C.attachEvent(E,"scroll",this._scroll);this.attachEventListener("incFetch",this.id,function(H){if(!this.supportsIncFetch||this.isFetching){return ;}if(this.preNext){this.preNext();}this.set("isFetching",true);G.next({complete:function(I){if(F.postNext){F.postNext();}F.set("isFetching",false);},success:function(I){F.addItems(I.items);},failure:function(I){F.supportsIncFetch=false;mstrmojo.alert("Error in fetching next: "+I);}});});}},addItems:function B(D){if(this._super){this._super(D);}if(!this.ifDataHelper.hasNext()){this.supportsIncFetch=false;var E=this.scrollNode||this.domNode;C.detachEvent(E,"scroll",this._scroll);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var B=mstrmojo.dom,E=100;function I(K,J){return function(L){mstrmojo.all[K][(J?"move":"show")+"Tooltip"](L,self);};}function A(){var K=this.tooltipNode||this.domNode,M=this.id,J,L="_ontooltip"+(this.isDynamicTooltip?"move":"over");if(!this._ontooltipout){this._ontooltipout=function(N){mstrmojo.all[M].hideTooltip(N,self);};}if(!this[L]){this[L]=I(M,this.isDynamicTooltip);}K=[].concat(K);for(J=0;J<K.length;J++){K[J].removeAttribute("title");B.attachEvent(K[J],(this.isDynamicTooltip?"mousemove":"mouseover"),this[L]);B.attachEvent(K[J],"mouseout",this._ontooltipout);}}mstrmojo._HasTooltip=mstrmojo.provide("mstrmojo._HasTooltip",{tooltip:"",richTooltip:null,useRichTooltip:false,isDynamicTooltip:false,tooltipNode:null,tooltipOpenDelay:700,hasOpenTooltip:false,postBuildRendering:function(){var J=this._super();if(this.useRichTooltip){A.call(this);}return J;},onuseRichTooltipChange:function H(){if(this.hasRendered){var K=this.tooltipNode||this.domNode,J;if(this.useRichTooltip){A.call(this);}else{if(this._ontooltipout){if(K&&K.constructor!==Array){K=[K];}for(J=0;J<K.length;J++){B.detachEvent(K[J],this.isDynamicTooltip?"mousemove":"mouseover",this["_ontooltip"+(this.isDynamicTooltip?"move":"over")]);B.detachEvent(K[J],"mouseout",this._ontooltipout);}}this.hideTooltip();}}},showTooltip:function G(M,L){var K=this;if(!K.hasOpenTooltip&&(!mstrApp.isInteractive||mstrApp.isInteractive&&mstrApp.isInteractive())){mstrmojo.requiresCls("mstrmojo.tooltip");if(this.updateTooltipConfig){this.updateTooltipConfig(M);}window.clearTimeout(this._tooltipTimeOut);if(mstrmojo.dom.isIE){var N={};for(var J in M){N[J]=M[J];}M=N;}var O=this.richTooltip?this.richTooltip.areaId:undefined;this._tooltipTimeOut=window.setTimeout(function(){if(K._closeTooltipTimeout){window.clearTimeout(K._closeTooltipTimeout);delete K._closeTooltipTimeout;}mstrmojo.tooltip.open(K,M,L);K.tooltip.onmouseover=function(){if(K.richTooltip&&K.richTooltip.enableHover){window.clearTimeout(K._closeTooltipTimeout);window.clearTimeout(K._deactivationTimeout);if(K.tooltip){K.tooltip.onmouseout=function(P){if(!B.contains(this.domNode,P.e.toElement||P.e.relatedTarget)){K.hideTooltip();}};}}};K.hasOpenTooltip=true;K._hasActiveArea=true;K._tooltipAreaId=O;window.clearTimeout(K._deactivationTimeout);delete K._deactivationTimeout;},(this._hasActiveArea&&O&&O===this._tooltipAreaId)?0:this.tooltipOpenDelay);}},moveTooltip:function C(J,L){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;mstrmojo.tooltip.close();}var N=this,K=J,M=L;this._tooltipTimeOut=setTimeout(function(){mstrmojo.tooltip.open(N,K,M);},this.tooltipOpenDelay);},hideTooltip:function F(){var J=this;window.clearTimeout(this._tooltipTimeOut);if(this._closeTooltipTimeout){window.clearTimeout(this._closeTooltipTimeout);}if(this._hasActiveArea&&!this._deactivationTimeout){this._deactivationTimeout=window.setTimeout(function(){delete J._deactivationTimeout;delete J._hasActiveArea;delete J._tooltipAreaId;},100);}mstrmojo.requiresCls("mstrmojo.tooltip");if(J.richTooltip&&J.richTooltip.enableHover){this._closeTooltipTimeout=window.setTimeout(function(){mstrmojo.tooltip.close();delete J._closeTooltipTimeout;},E);}else{mstrmojo.tooltip.close();}this.hasOpenTooltip=false;},unrender:function D(M){var N=this.tooltipNode||this.domNode,L;if(N&&N.constructor!==Array){N=[N];}if(N){var O=this._ontooltipover,K=this._ontooltipout,J=this._ontooltipmove;for(L=0;L<N.length;L++){if(O){B.detachEvent(N[L],"mouseover",O);}if(K){B.detachEvent(N[L],"mouseout",K);}if(J){B.detachEvent(N[L],"mousemove",J);}}}this._super(M);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var A=false,P=mstrmojo.dom,T=16;mstrmojo._HasContextMenu=mstrmojo.provide("mstrmojo._HasContextMenu",{cm:null,cmPos:null,itemField:"n",itemIdField:"did",itemChildrenField:"items",dynamicUpdate:false,queryChecked:function(U){return false;},queryEnabled:function(U){return true;},queryVisible:function(U){return true;},executeCommand:function O(U){},item2textCss:function E(U){return U.cssClass||U.cmdId||("cmd"+U[this.itemIdField]);},showContextMenu:function J(){if(!A){mstrmojo.requiresCls("mstrmojo.ContextMenu");A=true;}var a=this._subMenu,Y=this.getMenuPosition();if(!a){var c=(this.menuZIndex||this.zIndex||10)+1,W={left:Y.x+"px",top:Y.y+"px",zIndex:c,visible:false,dynamicUpdate:this.dynamicUpdate,itemField:this.itemField,itemIdField:this.itemIdField,itemChildrenField:this.itemChildrenField,_cmSource:this.getContextMenuSource(),items:this.getContextMenuItems(),cssClass:this.getContextMenuCssClass(),placeholder:document.body.appendChild(document.createElement("div")),parent:this};a=new mstrmojo.ContextMenu(W);a.render();this._subMenu=a;}else{a.set("left",Y.x+"px");a.set("top",Y.y+"px");}if(this.dynamicUpdate){var V=a.ctxtBuilder.itemWidgets,X=V&&V.length,U,Z,b=this.getContextMenuSource();for(U=0;U<X;U++){Z=V[U];if(b.queryVisible){Z.set("visible",b.queryVisible(Z.data));}if(b.queryChecked){Z.set("checked",b.queryChecked(Z.data));}if(b.queryEnabled){Z.set("enabled",b.queryEnabled(Z.data));}}}a.set("visible",true);this.callOnContextMenuOpen();this.adjustMenuPosition();this.attachMousedownEvent();},hideContextMenu:function I(){var U=this._subMenu;if(U&&U.visible){this._subMenu.set("visible",false);this.callOnContextMenuClose();}},adjustMenuPosition:function N(){var U=this._subMenu,X=this._subMenu.domNode,W=X.offsetHeight,V=X.offsetWidth,a=P.windowDim(),Z=P.position(X,false),Y=P.position(X,true);if((Z.x+V+T)>a.w){U.set("left",(a.w-V-T+(Y.x-Z.x))+"px");}if((Z.y+W+T)>a.h){U.set("top",(a.h-W-T+(Y.y-Z.y))+"px");}},attachMousedownEvent:function L(){var U=this;if(!this._close_handler){this._close_handler=function(V){U.closeMenuHandler(V);};}P.attachEvent(document.body,"mousedown",this._close_handler);},closeMenuHandler:function Q(U){if(!this.isOnMySubmenu(P.eventTarget(self,U))){this.closeMenuTree();}},isOnMySubmenu:function M(Y){var V=this._subMenu;if(!V){return false;}if(P.contains(V.domNode,Y,true,document.body)){return true;}var Z=V.ctxtBuilder.itemWidgets,U=Z&&Z.length,X,W;for(X=0;X<U;X++){W=Z[X];if(W.isOnMySubmenu(Y)){return true;}}return false;},callOnContextMenuOpen:function D(){if(this.onContextMenuOpen){this.onContextMenuOpen();}},callOnContextMenuClose:function C(){if(this.onContextMenuClose){this.onContextMenuClose();}},getContextMenuItems:function S(){return this.cm;},getContextMenuCssClass:function B(){return this.cmCssClass||"";},getContextMenuSource:function H(){return this;},getMenuPosition:function F(){if(this.cmPos){return this.cmPos;}var U=P.position(this.domNode,true);return{x:Math.round(U.x),y:Math.round(U.y+U.h)};},isSeparatorItem:function G(U){return U[this.itemIdField]===-1||U[this.itemField]==="-";},hasSubmenu:function K(U){return !!U[this.itemChildrenField];},closeMenuTree:function R(W){var V=this.activeMenuItem,U=this._cmSource||this;if(!V){if(W){this.activeMenuItem=W;}else{U.hideContextMenu();}return ;}if(V===W){return ;}if(W){this.activeMenuItem=W;if(W.parent.parent===V){return ;}if(W.parent===V.parent){V.hideContextMenu();return ;}}else{W=U;this.activeMenuItem=null;}V.hideContextMenu();while(V!==U){V=V.parent.parent;if(V!==W||U===W){V.hideContextMenu();if(U===W){P.detachEvent(document.body,"mousedown",this._close_handler);}}if(V.parent===W.parent){break;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;function D(J,I){var G=[];if(J){var F;for(F in J){var H=Number(F);if(H>=I){G.push(H);}}}G.sort(mstrmojo.array.numSorter);return G;}mstrmojo.ListSelector=mstrmojo.provide("mstrmojo.ListSelector",{premousedown:function E(L,F,N){if(C.isPrimaryMouseBtn(N.e)){var I=N.hWin,J=N.e,G=C.eventTarget(I,J),M=L.listMapper.findIndex(L,F,G);if(M>-1){var H=L.multiSelect,K=C.ctrlKey(I,J),O=C.shiftKey(I,J);if(K||O){C.clearBrowserHighlights(I);}if(H&&(K||(L.selectionPolicy==="toggle"))){L.toggleSelect(M);}else{if(H&&O){L.rangeSelect(M);}else{L.singleSelect(M);}}}}},premouseup:function B(H,K,G){var F=G.hWin,J=G.e,L=C.ctrlKey(F,J),I=C.shiftKey(F,J);if(L||I){C.clearBrowserHighlights(F);}},onadd:function A(I,H){var M=H&&H.value&&H.value.length;if(M){var G=H.index,K=I.selectedIndices,L=D(K,G),J;for(J=L.length-1;J>-1;J--){var F=L[J];K[F+M]=true;delete K[F];}if(I.selectedIndex>=G){I.selectedIndex+=M;}}},onremove:function A(Q,S){var O=S&&S.value&&S.value.length;if(O){var R=S.index,I=R+O-1,M=Q.selectedIndices,L=Q.selectedIndex,G=[],T=[],P=false;if(M){var H;for(H in M){var K=Number(H);if(K>I){G.push(K);}else{if(K>=R){T.push(K);P=true;}}}}G.sort(mstrmojo.array.numSorter);var J,N;for(J=0,N=G.length;J<N;J++){var F=G[J];M[F-O]=true;delete M[F];}if(L>I){Q.selectedIndex-=O;}if(P){Q.removeSelect(T);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx={enabled:true};var E=mstrmojo.dom;mstrmojo.fx._Effect=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.fx._Effect",duration:500,interval:50,delay:null,target:null,getTarget:null,widget:null,slot:null,preStart:null,postStart:null,onCancel:null,onEnd:null,revertOnCancel:true,isPlaying:false,started:false,init:function R(W){mstrmojo.hash.copy(W,this);},play:function C(){this.isPlaying=true;this.started=false;if(this.delay){var W=this;this.delayTimer=window.setTimeout(function(){W._start();W=null;},this.delay);}else{this._start();}},pause:function H(){if(this.delayTimer){window.clearTimeout(this.delayTimer);delete this.delayTimer;}if(this.timer){window.clearInterval(this.timer);delete this.timer;}this.isPlaying=false;},cancel:function U(){this.pause();if(this.started){if(this.revertOnCancel){this.counter=0;this.exec();}if(this.onCancel){this.onCancel();}this.started=false;}},_start:function F(){this.started=true;this._doTarget();this.steps=Math.max(Math.ceil(this.duration/this.interval),1);var W=this.ease;if(typeof W==="string"){this.ease=mstrmojo.registry.ref(W);}if(this._doPreStart()===false){this.started=false;this.isPlaying=false;return ;}this.counter=0;this.exec();this.counter++;this._doPostStart();if(this.counter>=this.steps){this._end();}else{var X=this;if(this.timer){window.clearInterval(this.timer);}this.timer=window.setInterval(function Y(){if(X){X.exec();X.counter++;if(X.counter>=X.steps){X._end();X=null;}}},this.interval);}},exec:null,_end:function D(){this.pause();this.started=false;if(this.onEnd){this.onEnd();}},_doTarget:function T(){if(this.getTarget){this.target=this.getTarget();}else{if(this.widget){this.target=this.widget[this.slot||"domNode"];}else{if(this.target){var X=this.target;if(X&&this.slot&&X.scriptClass){var Y=X[this.slot];if(Y){this.widget=X;this.target=Y;}}}}}if(!this.target){var W=this;while(W=W.parent){if(!W||W.domNode){break;}}if(W){this.widget=W;this.target=W[this.slot||"domNode"];}}},_doPreStart:function N(){if(this.preStart){return this.preStart();}},_doPostStart:function S(){if(this.postStart){this.postStart();}}});function M(Z,a){var X=Z.children,W=(X&&X.length)||0,Y;for(Y=0;Y<W;Y++){X[Y][a]();}}mstrmojo.fx.Parallel=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Parallel",init:function R(Z){this._super(Z);var Y=this.children;mstrmojo.registry.refArray(Y);var W=(Y&&Y.length)||0,X;for(X=0;X<W;X++){Y[X].parent=this;}},_start:function F(){this.started=true;if(this.preStart){this.preStart();}M(this,"play");if(this.postStart){this.postStart();}},pause:function H(){M(this,"pause");},cancel:function U(){M(this,"cancel");}});mstrmojo.fx.AnimateProp=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.AnimateProp",props:null,_start:function O(){var Y=this.props,Z;for(Z in Y){var X=Y[Z],W=X.ease;if(typeof W==="string"){X.ease=mstrmojo.registry.ref(W,{dontInst:true});}}this._super();},exec:function P(){var Z=this.props,a;for(a in Z){var X=Z[a],W=(X.ease||mstrmojo.ease.sin)(this.counter,X.start,X.stop-X.start,this.steps-1);if(X.fn){W=X.fn(W);}if(X.suffix){W+=X.suffix;}var Y=X.isStyle===false?this.target:this.target.style;Y[a]=W;}}});mstrmojo.fx.Typewriter=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Typewriter",charGroupSize:1,srcProp:"text",_doPreStart:function(){this._super();this._dynStop=false;if(this.stop==null){var a=this.srcProp,Y;if(a){var W=this.widget||this.parent;Y=W&&W[a];if((Y!=null)&&(typeof (Y)!=="string")){Y=String(Y);}}this.stop=Y;this._dynStop=true;}if(this.stop==null){this.stop="";}var Z=this.target,b=null,X=1;if(Z){Z.innerHTML="";b=document.createTextNode("");Z.appendChild(b);X=Math.max(Math.floor(this.stop.length/this.steps),1);}this.targetTextNode=b;this.charGroupSize=X;},exec:function(){var X=this.targetTextNode;if(!X){return ;}var W;if(this.counter>=this.steps-1){W=this.stop;}else{if(this.counter===0){W="";}else{W=this.stop.substring(0,this.charGroupSize*this.counter)+"_";}}X.nodeValue=W;},_end:function D(){this._super();if(this._dynStop){this.stop=null;delete this._dynStop;}},cancel:function U(){if(this._dynStop){this.stop=null;delete this._dynStop;}}});mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx.Fade=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Fade",start:null,stop:null,ease:null,suffix:null,exec:function P(W){if(W==null){W=(this.ease||mstrmojo.ease.sin)(this.counter,this.start,this.stop-this.start,this.steps-1);}if(E.isIE&&!E.isWinPhone){this.target.style.filter="alpha(opacity="+parseInt(W*100,10)+")";}else{this.target.style.opacity=W;}}});mstrmojo.fx.FadeOut=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeOut",start:1,stop:0,revertOnCancel:true,cssDisplay:"block",_end:function D(){if(this.cssDisplay){this.target.style.display="none";this.exec(this.start);}this._super();},cancel:function U(){if(this.started&&this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();}});mstrmojo.fx.FadeIn=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeIn",start:0,stop:1,revertOnCancel:true,cssDisplay:"block",_doPostStart:function V(){if(this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();},cancel:function(){if(this.started&&this.revertOnCancel&&this.cssDisplay){this.target.style.display="none";}this._super();}});function I(Y,X,Z){var W=Math.pow(10,Z||2);if(X){return parseInt(W*Y/X,10)/W;}return parseInt(W*Y,10)/W;}mstrmojo.ease={linear:function L(X,W,Z,Y){if(X===Y){return W+Z;}if(X===0){return W;}return W+Z*I(X,Y);},sin:function A(X,W,Z,Y){return W+Z*Math.sin((Math.PI/2)*X/Y);},cos:function B(X,W,Z,Y){return W+Z*Math.cos((Math.PI/2)*(1-X/Y));},sincos:function K(X,W,Z,Y){if(X>Y/2){return W+Z*Math.cos((Math.PI/2)*(1-X/Y));}return W+Z*Math.sin((Math.PI/2)*X/Y);},cossin:function Q(X,W,Z,Y){if(X>Y/2){return W+Z*Math.sin((Math.PI/2)*X/Y);}return W+Z*Math.cos((Math.PI/2)*(1-X/Y));},bounce:function G(X,W,Z,Y){if((X/=Y)<(1/2.75)){return Z*(7.5625*X*X)+W;}if(X<(2/2.75)){return Z*(7.5625*(X-=(1.5/2.75))*X+0.75)+W;}if(X<(2.5/2.75)){return Z*(7.5625*(X-=(2.25/2.75))*X+0.9375)+W;}return Z*(7.5625*(X-=(2.625/2.75))*X+0.984375)+W;},shake:function J(X,W,Z,Y){if(X<Y/2){return W+Z*I(Math.sin(2*Math.PI*X/8),null,2)*2*X/Y;}return W+Z*I(Math.sin(2*Math.PI*X/8),null,2)*2*(1-X/Y);}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var E=mstrmojo.dom;var P=mstrmojo.dom;var O="mousedown";function S(U){var T=U[U.hotSlot||"domNode"];if(T){if(!U._closeCallback){var W=U.id,V=function(X){return function(Z){var Y=mstrmojo.all[W];if(Y&&!Y.ignoreHover){Y["auto"+X](Z,self);}};};U._uncloseCallback=V("Unclose");U._closeCallback=V("Close");}E.attachEvent(T,"mouseover",U._uncloseCallback);E.attachEvent(T,"mouseout",U._closeCallback);}}function B(U){if(U._closeCallback){var T=U[U.hotSlot||"domNode"];if(T){E.detachEvent(T,"mouseover",U._uncloseCallback);E.detachEvent(T,"mouseout",U._closeCallback);}}}function F(V,U){var T=V;while(T){if(T.open||T.openPopup){if(T.set){T.set("ignoreHover",U);}else{T.ignoreHover=U;}}T=T.opener||T.parent;if(T&&T.shouldPropagateLockHover&&!T.shouldPropagateLockHover()){break;}}}function D(){var T=this._lockHoverCallback;if(T){E.detachEvent(document.body,O,T,true);delete this._lockHoverCallback;}}mstrmojo._CanAutoClose=mstrmojo.provide("mstrmojo._CanAutoClose",{autoCloses:false,autoCloseDelay:100,locksHover:false,hotSlot:null,closeOnClick:false,curtainNode:null,postBuildRendering:function Q(){this._super();if(this.autoCloses){S(this);}this.oncloseOnClickChange();},onautoClosesChange:function L(){var T=(this.autoCloses)?S:B;T(this);},oncloseOnClickChange:function H(){if(!this.curtainNode){return ;}var V=this,U="click",T=(mstrApp&&mstrApp.isTouchApp&&mstrApp.isTouchApp());if(T){U="touchstart";}E.attachEvent(V.curtainNode,U,function(){V.close();if(T){mstrmojo.touchManager.notify([]);}});},autoUnclose:function G(){var T=this._autoCloseTimer;if(T){self.clearTimeout(T);delete this._autoCloseTimer;}},autoClose:function J(){if(this.ignoreHover){return ;}if(this._autoCloseTimer){self.clearTimeout(this._autoCloseTimer);}if(this.opener){if(this.autoCloseDelay){var T=this.opener.id;this._autoCloseTimer=self.setTimeout(function(){mstrmojo.all[T].closePopup();},this.autoCloseDelay);}else{this.opener.closePopup();}}},destroy:function R(T){D.call(this);this._super(T);},lockHover:function N(){F(this,true);if(!this._lockHoverCallback){var U=this.id,T=this._lockHoverCallback=function(V){mstrmojo.all[U]._unlockHoverCheck(V,self);};if((E.isIE7||E.isIE8)&&window.event&&(window.event.type===O)&&this.opener){this.opener._ignoreMousedown=true;}E.attachEvent(document.body,O,T,true);}},unlockHover:function M(){F(this,false);D.call(this);},_unlockHoverCheck:function C(X,T){var U=this.opener;if(U&&U._ignoreMousedown){delete U._ignoreMousedown;return ;}var W=E.eventTarget(T,X);if(!P.contains(this.domNode,W,true,document.body)){var V=P.findWidget(W);while(V){if(V===this){return ;}V=V.parent||V.opener;}if(U&&U.onPopupAutoClosed){U.onPopupAutoClosed(X,T);}this.close();}},open:function I(U,T){if(this.autoCloses){this.autoUnclose();}this._super(U,T);if(this.locksHover){this.lockHover();}},close:function K(T){if(this.locksHover){this.unlockHover();}this._super(T);},shouldPropagateLockHover:function A(){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");function G(J){return(J&&J.id);}mstrmojo._HasScrollbox=mstrmojo.provide("mstrmojo._HasScrollbox",{_mixinName:"mstrmojo._HasScrollbox",scrollListeners:null,scrollListenerCount:0,scrollInterval:50,scrollboxNode:undefined,scrollTo:function F(L,K){var J=this.scrollboxNode;J.scrollLeft=L.x;J.scrollTop=L.y;if(K){this.notifyScrollListeners(L);}},connectScrollbox:function E(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(!L){L={};this.scrollListeners=L;}if(!L[J]){L[J]=K;this.scrollListenerCount++;if(this.scrollListenerCount===1){this._attachScrollDom();}}},disconnectScrollbox:function D(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(L&&L.hasOwnProperty(J)){delete this.scrollListeners[J];this.scrollListenerCount--;if(!this.scrollListenerCount){this._detachScrollDom();}}},notifyScrollListeners:function C(K){var N=K||this.getScrollPos(),M=N.y,L=N.x;this.scrollboxTop=M;this.scrollboxLeft=L;this.scrollboxRight=L+this.scrollboxWidth;this.scrollboxBottom=M+this.scrollboxHeight;var J=this.scrollListeners,O;for(O in J){J[O].onscroll(this);}},getScrollPos:function H(){var J=this.scrollboxNode;return{x:J.scrollLeft,y:J.scrollTop};},_attachScrollDom:function A(){var M=this.scrollboxNode;if(M){var L=this.usesTouches;if(!L){if(!this.scrollCallback){var K=this.id;this.scrollCallback=function(){mstrmojo.all[K].notifyScrollListeners();};}mstrmojo.dom.attachBufferedEvent(M,"scroll",this.scrollCallback,this.scrollInterval);}if(this.scrollboxTop===null){this.scrollboxTop=L?0:M.scrollTop;}if(this.scrollboxLeft===null){this.scrollboxLeft=L?0:M.scrollLeft;}var J=function(P){var O=P.toLowerCase();var N=M.style[O];return(!isNaN(N)&&N.charAt(N.length-1)!=="%")?parseInt(N,10):M["client"+P];};if(this.scrollboxHeight===null){this.scrollboxHeight=J("Height");}if(this.scrollboxWidth===null){this.scrollboxWidth=J("Width");}this.scrollboxBottom=this.scrollboxTop+this.scrollboxHeight;this.scrollboxRight=this.scrollboxLeft+this.scrollboxWidth;this._attachedScrollbox=M;}},_detachScrollDom:function I(){var J=this._attachedScrollbox;if(J&&this.scrollCallback){mstrmojo.dom.detachBufferedEvent(J,"scroll",this.scrollCallback,this.scrollInterval);}delete this._attachedScrollbox;},scrollboxTop:null,scrollboxLeft:null,scrollboxHeight:null,scrollboxBottom:null,buildRendering:function B(){this._detachScrollDom();this._super();if(this.scrollListenerCount){this._attachScrollDom();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;mstrmojo._FillsBrowser=mstrmojo.provide("mstrmojo._FillsBrowser",{_mixinName:"mstrmojo._FillsBrowser",getBrowserDimensions:function E(G){if(G){return{w:G.innerWidth,h:G.innerHeight};}var F=C.windowDim(),H=(C.isFF||C.isWK)?0:2;return{w:Math.max(F.w,0)+"px",h:Math.max(F.h-H,0)+"px"};},preBuildRendering:function A(){var H=this._super(),G=this.getBrowserDimensions();if(!this.browserResized||this.browserResized(G)!==true){this.height=G.h;this.width=G.w;}if(!this._listenerProc){window._monitor=this;var I=this.id,F=this._listenerProc=function(K){var J=K||window.event;mstrmojo.all[I].monitorWindow(J);};C.attachEvent(window,"resize",F);}return H;},destroy:function B(F){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);}this._super(F);},monitorWindow:function D(F){var I=F.currentTarget,H=this.getBrowserDimensions(),G={w:(I?I.innerWidth+"px":H.w),h:(I?I.innerHeight+"px":H.h)};if((G.h===this.height&&G.w===this.width)||parseInt(G.h,10)<=20||parseInt(G.w,10)<=20){return ;}if(!this.browserResized||this.browserResized(G,true)!==true){if(G.h!==this.height){this.set("height",G.h);}if(G.w!==this.width){this.set("width",G.w);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.ListSelector");var C=mstrmojo.dom,B=C.isIE;mstrmojo.TreeNodeSelector=mstrmojo.provide("mstrmojo.TreeNodeSelector",mstrmojo.mixin({premousedown:function A(E,I,D){var G=(E&&E.tree)||E,H=D&&D.e;if(!H){return false;}var F=G.lastMouseDown;if(F){if((F.e===H)||(B&&((new Date())-F.dt<50))){return false;}}this._super(E,I,D);if(G){if(G.onnodemousedown){G.onnodemousedown(D);}G.lastMouseDown={e:H,dt:new Date()};}return true;}},mstrmojo.hash.copy(mstrmojo.ListSelector)));}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.dnd");var E=mstrmojo.dom;function B(I){return E.contains(this.getMovingHandle(),I.src.node,true,document.body);}mstrmojo._IsMovable=mstrmojo.provide("mstrmojo._IsMovable",{draggable:true,ownAvatar:true,getMovingHandle:function G(){return this.domNode;},getMovingTarget:function H(){return this.domNode;},isDragValid:function A(I){return B.call(this,I)||(this._super&&this._super(I))||false;},ondragstart:function C(J){if(B.call(this,J)){var K=this.getMovingHandle(),I=this.getMovingTarget().style;this._leftPos=parseInt(I.left,10);this._topPos=parseInt(I.top,10);this._hWidth=K.clientWidth;this._hHeight=K.clientHeight;}if(this._super){this._super();}},ondragmove:function F(L){if(B.call(this,L)){var M=L.tgt.pos,J=L.src.pos,K=this.getMovingTarget().style,I=E.windowDim();K.left=this.left=Math.min(Math.max(this._leftPos+M.x-J.x,-this._hWidth+40),I.w-40)+"px";K.top=this.top=Math.min(Math.max(this._topPos+M.y-J.y,-this._hHeight+20),I.h-20)+"px";}if(this._super){this._super();}},ondragend:function D(I){if(B.call(this,I)){delete this._leftPos;delete this._topPos;delete this._hWidth;delete this._hHeight;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.locales");var c=mstrmojo.array,P=mstrmojo.meta.TP,G=mstrmojo.meta.STP,O=mstrmojo.hash,F={ANDOR:14,MQ:10,MC:12,AQ:2,AL:6,AC:9,AE:5,F:13,R:21,B:20,XML:1,RLS:15},B={};var W;for(W in F){B[F[W]]=true;}var a={};a[F.AQ]="a";a[F.AL]="a";a[F.AC]="a";a[F.AE]="a";a[F.MQ]="m";a[F.MC]="m";a[F.F]="f";a[F.R]="r";a[F.XML]="p";var K={};K[F.MQ]=["not","m","fn","fnt","cs","dmy","idcsi"];K[F.MC]=["not","m","fn","fnt","m2","m3","p","dmy","idcsi"];K[F.AE]=["not","a","fn","es","a2","fm2","p"];K[F.AQ]=["not","a","fm","fn","cs"];K[F.AL]=["not","a","fm","fn","cs"];K[F.AC]=["not","a","fm","a2","fm2","a3","fm3","fn","cs"];K[F.R]=["not","r"];K[F.F]=["not","f"];K[F.XML]=["not","n","p"];var M={};M[F.MQ]="METRIC_FNS";M[F.MC]="METRIC_FNS";M[F.AQ]="FORM_FNS";M[F.AL]="FORM_FNS";M[F.AC]="FORM_FNS";M[F.AE]="ELEM_FNS";var N={FILTER:1,REPORT:3,METRIC:4,FOLDER:8,PROMPT:10,FUNCTION:11,ATTR:12,FACT:13,DIM:14,FORM:21,ROLE:43,CONS:47},b={FILTER:256,CUSTOMGROUP:257,PROMPT:2560,PROMPT_BOOLEAN:2561,PROMPT_LONG:2562,PROMPT_STRING:2563,PROMPT_DOUBLE:2564,PROMPT_DATE:2565,PROMPT_OBJECTS:2566,PROMPT_ELEMENTS:2567,PROMPT_EXPRESSION:2568,PROMPT_EXPRESSION_DRAFT:2569,PROMPT_DIMTY:2570,PROMPT_BIGDECIMAL:2571,REPORT_GRID:768,REPORT_GRAPH:769,REPORT_ENGINE:770,REPORT_TEXT:771,REPORT_DATAMART:772,REPORT_BASE:773,REPORT_GRIDGRAPH:774,REPORT_NONINTERACTIVE:775,REPORT_CUBE:776,REPORT_EMMACUBE:779,CONS:12032,NDE:12033},T={a:N.ATTR,a2:N.ATTR,m:N.METRIC,m2:N.METRIC,r:N.REPORT,f:N.FILTER,p:N.PROMPT},U={f:b.FILTER};var V={};V[F.MQ]=N.METRIC;V[F.MC]=N.METRIC;V[F.AQ]=N.ATTR;V[F.AL]=N.ATTR;V[F.AC]=N.ATTR;V[F.AE]=N.ATTR;V[F.F]=N.FILTER;V[F.R]=N.REPORT;var J=function(d){var H=d.length,g={},e;for(e=0;e<H;e++){var h=d[e];g[h.did]=h.n;}return g;},E=function(e){var H=e.length,f;for(f=0;f<H;f++){var d=e[f];if("tp" in d){d.t=d.tp;}}return e;},X=function(e,g){var H=e.length,f;for(f=0;f<H;f++){var d=e[f];if("tp" in d){if(g){d.t=g;}else{delete d.t;}}}return e;},Z=function(d,f){if(!f){f=[];}f.length=0;var e,H;for(e=0,H=d.length;e<H;e++){f[e]=d[e];}return f;},L={0:[{did:"1,76"},{did:"1,79"},{did:"1,77"},{did:"1,80"},{did:"1,78"},{did:"1,81"},{did:"1,18"},{did:"1,43"}],1:[{did:"2,1"},{did:"2,2"},{did:"3,1"},{did:"3,2"}]};var R={0:[{did:"1,22"},{did:"1,57"}]};mstrmojo.expr=mstrmojo.provide("mstrmojo.expr",{ET:F,ETs:B,ET2TGT:a,ET2COND:K,ET2TP:V,FN:{EQUAL:6,NOT_EQUAL:7,GREATER:8,LESS:9,GREATER_EQUAL:10,LESS_EQUAL:11,IN_LIST:22,NOT_IN_LIST:57,BETWEEN:17,NOT_BETWEEN:44,IS_NULL:54,IS_NOT_NULL:55,AND:19,OR:20,NOT:21,SEARCH:158},FN_MRP:{BETWEEN:3,EXCLUDE_TOP:4,EXCLUDE_BOTTOM:5,BETWEEN_DESCENDING:13},FNT:{DEF:1,RANK:2,PER:3},FN_SEP:",",TP:N,STP:b,DMY_TP:{ATTR:-1,DIM:-2},DTP:{UNKNOWN:-1,INTEGER:1,UNSIGNED:2,NUMERIC:3,DECIMAL:4,REAL:5,DOUBLE:6,FLOAT:7,CHAR:8,VARCHAR:9,LONGVARCHAR:10,BINARY:11,VARBIN:12,LONGVARBIN:13,DATE:14,TIME:15,TIMESTAMP:16,SHORT:21,LONG:22,MBCHAR:23,BOOLEAN:24,PATTERN:25,BIGDECIMAL:30},BFTP:{RESERVED:0,HIDDEN:-1,DATETIME:1,NUMBER:2,TEXT:3,PICTURE:4,URL:5,EMAIL:6,TAG:7,DATE:8,TIME:9,SYMBOL:10,BIGDECIMAL:11,PHONENUMBER:12},METRIC_DTP:3,FN_DTP:{NUM:0,CHAR:1,DATE:2},DTP2PROMPT_STP:{"-1":b.PROMPT,1:b.PROMPT_LONG,2:b.PROMPT_LONG,3:b.PROMPT_LONG,4:b.PROMPT_DOUBLE,5:b.PROMPT_DOUBLE,6:b.PROMPT_DOUBLE,7:b.PROMPT_DOUBLE,8:b.PROMPT_STRING,9:b.PROMPT_STRING,10:b.PROMPT_STRING,14:b.PROMPT_DATE,15:b.PROMPT_DATE,16:b.PROMPT_DATE,21:b.PROMPT_LONG,22:b.PROMPT_LONG,23:b.PROMPT_STRING,24:b.PROMPT_BOOLEAN,30:b.PROMPT_BIGDECIMAL},DTP2FN_DTP:{"-1":0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1,9:1,10:1,11:0,12:0,13:0,14:0,15:0,16:0,21:0,22:0,23:1,24:0,25:1,30:0,34:0},fnCstCount:function A(e,d){var g=this.FN,h=this.FN_MRP,H=this.FNT;if(d===H.DEF||d===undefined){switch(e){case g.BETWEEN:case g.NOT_BETWEEN:return 2;case g.IS_NULL:case g.IS_NOT_NULL:return 0;}}else{if(d===H.PER||d===H.RANK){switch(e){case h.BETWEEN:case h.BETWEEN_DESCENDING:return 2;}}}return 1;},fn_List:function S(d,H){var e=this.FN;return d==e.IN_LIST||d==e.NOT_IN_LIST;},fn_AC_MC:function Y(d,H){var e=this.FN;return(d==e.EQUAL)||(d==e.NOT_EQUAL)||(d==e.GREATER)||(d==e.LESS)||(d==e.GREATER_EQUAL)||(d==e.LESS_EQUAL);},fnName:function Q(h,g,d,f){var H=this[M[h]];if(H&&H.constructor===Object){H=H[this.DTP2FN_DTP[f]]||H["*"];}if(h===F.MQ){H=H.concat(mstrmojo.locales.expression.MetricRP);}var e=c.find(H,"did",(d||1)+this.FN_SEP+g);if(e>-1){return H[e].n;}return"";},findTargets:function I(n,f,p){if(!p){p={};}if(n){var m;for(m in T){var AA=n[m];if(AA){if(!AA[P]){AA[P]=T[m];}if(!AA[G]&&U[m]){AA[G]=U[m];}p[AA[f]]=AA;}}if(n.dmy){var j=this.TP.ATTR,q=this.DMY_TP.ATTR,e=n.dmy.uts,z,d;for(z=0,d=(e&&e.length)||0;z<d;z++){var l=e[z];if(l&&l.utp===q){var g=l.utgt;if(!g.t){g.t=j;}p[g[f]]=g;}}}var H=n.nds,o,w;for(o=0,w=(H&&H.length)||0;o<w;o++){this.findTargets(H[o],f,p);}var r=n.cs,x=r&&r.length;if(x){for(o=0;o<x;o++){this.findTargets(r[o],f,p);}}}return p;},onLocaleUpdated:function(){var d=mstrmojo.locales.expression,H=mstrmojo.expr;H.BRANCH_FNS=O.copy(J(d.BranchQual),H.BRANCH_FNS);H.ELEM_FNS=Z(X(d.Element,"fn"),H.ELEM_FNS);H.METRIC_FNS={"*":X(c.filter(d.Metric.concat(d.MetricRP),function(e){return e.did&&(c.find(R["0"],"did",e.did)<0);}))};H.FORM_FNS={0:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["0"],"did",e.did)<0);})),1:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["1"],"did",e.did)<0);})),2:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["0"],"did",e.did)<0)&&(c.find(L["1"],"did",e.did)<0);}))};H.DIMTYLEVELS=Z(X(d.DimtyLevels),H.DIMTYLEVELS);},getSortedObjectsByTypeGroup:function D(f){var H=0,d=1,e=2;function g(h){switch(h.t){case N.METRIC:return d;case N.ATTR:case N.DIM:case N.CONS:return H;case N.FILTER:return h.st===b.CUSTOMGROUP?H:e;default:return e;}}return f.slice(0).sort(function(m,l){var n=g(m)-g(l);if(n){return n;}var k=m.n.toUpperCase(),j=l.n.toUpperCase(),h=k.localeCompare(j);if(h){return h;}return m.n.localeCompare(l.n);});},mapBaseFormTypeToDataType:function C(e){e=parseInt(e);if(e===NaN){return -1;}var d=this.BFTP,H=this.DTP;switch(e){case d.DATETIME:return H.TIMESTAMP;case d.DATE:return H.DATE;case d.TIME:return H.TIME;case d.NUMBER:return H.REAL;case d.TEXT:return H.CHAR;case d.BIGDECIMAL:return H.BIGDECIMAL;default:return H.CHAR;}}});mstrmojo.expr.onLocaleUpdated();}());(function(){mstrmojo.requiresCls("mstrmojo.locales");var X=function(){return mstrmojo.locales.datetime;},L=mstrmojo.string;mstrmojo.date=mstrmojo.provide("mstrmojo.date",{monthNumbers:{Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12},REGEXPS:{DATES:{},TIMES:{}},CACHE:{PARSEDATE:{CONTAINS:{},EQUALS:{}},PARSETIME:{CONTAINS:{},EQUALS:{}}},now:Date.now||function D(){return new Date().getTime();},isDate:function Y(b,f,a){var d=this.parseDate(b,a);var e=!!(d&&this.doesDateExist(d.month,d.day,d.year));if(f){if(e){var c=this.formatDateInfo(d,X().DATEOUTPUTFORMAT);if(a){return{match:d.match,formatted:c};}return c;}return null;}return !!e;},formatDateInfo:function R(d,f){if(!f){return"";}var a=d.day,e=d.month,c=d.year;var b=f.replace(/dd/g,this.formatInteger(a,2)).replace(/d/g,Number(a)).replace(/yyyy/g,Number(c)).replace(/yy/g,this.formatInteger(Number(c)%100,2)).replace(/MMM/g,"~~~~").replace(/MM/g,"@@").replace(/M/g,"^").replace(/MMMM/g,X().MONTHNAME_FULL[Number(e)-1]).replace(/\~\~\~\~/g,X().MONTHNAME_SHORT[Number(e)-1]).replace(/\@\@/g,this.formatInteger(e,2)).replace(/\^/g,Number(d.month));return b;},parseDate:function Z(l,f,j){if(l==null){return false;}if(typeof l!=="string"){l=String(l);}l=L.trim(l);var a=this.CACHE.PARSEDATE[f?"CONTAINS":"EQUALS"],c=a[l];if(c||(c===null)){return c;}var b=null;var h;if(j){h=[j];}else{h=[].concat(X().DATEINPUTFORMATS);h.unshift(X().DATEOUTPUTFORMAT);}var d,e;for(d=0,e=h.length;d<e;d++){var g=this._buildRegExp4DateFormat(h[d]),k=g&&l.match(f?g.reContains:g.reEquals);if(k){b={match:k[0],year:g.yearIndex&&this.fourDigitYear(k[g.yearIndex]),day:g.dayIndex&&parseInt(Number(k[g.dayIndex]),10),month:g.monthIndex&&this.numericMonth(k[g.monthIndex])};break;}}a[l]=b;return b;},isTime:function I(b,e,a){var f=this.parseTime(b,a);var d=!!(f&&this.doesTimeExist(f.hour,f.min,f.sec));if(e){if(d){var c=this.formatTimeInfo(f,X().TIMEOUTPUTFORMAT);if(a){return{match:f.match,formatted:c};}return c;}return null;}return !!d;},parseTime:function J(m,f,k){if(m==null){return false;}if(typeof m!=="string"){m=String(m);}m=L.trim(m);var a=this.CACHE.PARSETIME[f?"CONTAINS":"EQUALS"],c=a[m];if(c||(c===null)){return c;}var b=null;var j;if(k){j=[k];}else{j=[].concat(X().TIMEINPUTFORMATS);j.unshift(X().TIMEOUTPUTFORMAT);}var d,e;for(d=0,e=j.length;d<e;d++){var h=this._buildRegExp4TimeFormat(j[d]),l=h&&m.match(f?h.reContains:h.reEquals);if(l){var g=h.ampmIndex&&l[h.ampmIndex];b={match:l[0],hour:h.hourIndex&&this.capitalHour(l[h.hourIndex],g),min:h.minIndex&&parseInt(Number(l[h.minIndex]),10),sec:h.secIndex&&parseInt(Number(l[h.secIndex]),10)};break;}}a[m]=b;return b;},formatTimeInfo:function S(d,b){if(!b){return"";}var c=!(Number(d.hour)%12)?12:(Number(d.hour)%12),a=b.replace(/HH/g,this.formatInteger(d.hour,2)).replace(/H/g,Number(d.hour)).replace(/hh/g,this.formatInteger(c,2)).replace(/h/g,c).replace(/mm/g,this.formatInteger(Number(d.min)||0,2)).replace(/m/g,Number(d.min)||0).replace(/ss/g,this.formatInteger(Number(d.sec)||0,2)).replace(/s/g,Number(d.sec)||0).replace(/a/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME).replace(/tt/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME).replace(/AM\/PM/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME);return a;},doesTimeExist:function G(f,b,e){var d=parseInt(f,10);if(d>=0&&d<=23){var a=parseInt(b,10);if(a>=0&&a<=59){if(!e){return true;}var c=parseInt(e,10);if(c>=0&&c<=59){return true;}}}return false;},capitalHour:function C(a,b){a=parseInt(Number(a),10);if(b&&(b.match(X().AM_NAME)||b.match(/AM/i))){return a%12;}if(b&&(b.match(X().PM_NAME)||b.match(/PM/i))){return 12+(a%12);}return a;},getTimeStamp:function O(){var b=new Date();var a=[b.getMonth()+1,b.getDate(),b.getFullYear()];var e=[b.getHours(),b.getMinutes(),b.getSeconds()];var d=(e[0]<12)?"AM":"PM";e[0]=(e[0]<12)?e[0]:e[0]-12;e[0]=e[0]||12;for(var c=1;c<3;c++){if(e[c]<10){e[c]="0"+e[c];}}return a.join("-")+" "+e.join(":")+" "+d;},isDateAndOrTime:function V(a,b){return this.isDateTime(a,b)||this.isDate(a,b)||this.isTime(a,b);},isDateTime:function B(k,a){var e=this.parseDateAndOrTime(k),h=e&&e.date,d=e&&e.time,g=!!h&&!!d&&this.doesDateExist(h.month,h.day,h.year)&&this.doesTimeExist(d.hour,d.min,d.sec);if(a){if(g){var b=this.formatDateInfo(h,X().DATEOUTPUTFORMAT),c=this.formatTimeInfo(d,X().TIMEOUTPUTFORMAT),j=k.indexOf(h.match),f=k.indexOf(d.match);return(f<j)?c+" "+b:b+" "+c;}return null;}return !!g;},parseDateAndOrTime:function Q(b,a,f){var c=this.parseDate(b,true,a);var d=L.trim((c&&c.match)?b.replace(c.match,""):b),e=this.parseTime(d,false,f);if(!c&&!e){return null;}return{date:c,time:e};},inDateTimeRange:function P(c,e,h){var b=this.parseDateAndOrTime(c),f=b&&b.date,j=b&&b.time;if(!f&&!j){return 0;}if(e!=null){var d=this.parseDateAndOrTime(e);if(f&&d&&d.date){var k=this.compareDate(f,d.date);if(k<0){return -1;}if(k==0){if(j&&d.time&&(this.compareTime(j,d.time)<0)){return -1;}}}}if(h!=null){var a=this.parseDateAndOrTime(h);if(f&&a&&a.date){var g=this.compareDate(f,a.date);if(g>0){return 1;}if(g==0){if(j&&a.time&&(this.compareTime(j,a.time)>0)){return 1;}}}}return 0;},compareDate:function A(c,a){if(c===a){return 0;}var d=typeof c==="string"?this.parseDate(c):c,b=typeof a==="string"?this.parseDate(a):a;if(!d){return -1;}if(!b){return 1;}return(d.year-b.year)||(d.month-b.month)||(d.day-b.day)||0;},compareTime:function K(b,a){if(b===a){return 0;}var d=typeof b==="string"?this.parseTime(b):b,c=typeof a==="string"?this.parseTime(a):a;if(!d){return -1;}if(!c){return 1;}return(d.hour-c.hour)||(d.min-c.min)||(d.sec-c.sec)||0;},compareDateTime:function U(b,a){return this.compareDate(b,a)||this.compareTime(b,a);},compareDateAndOrTime:function E(h,f){if(h===f){return 0;}var b=typeof h==="string"?this.parseDateAndOrTime(h):h,a=typeof f==="string"?this.parseDateAndOrTime(f):f;if(!b){return -1;}if(!a){return 1;}var g=b.date,e=a.date,d=b.time,c=a.time;return this.compareDate(g,e)||this.compareTime(d,c);},_buildRegExp4DateFormat:function N(c){if(!c){return null;}var e=this.REGEXPS.DATES[c];if(!e){if(!this.REGEXPS.MONTHNAME_FULL){this.REGEXPS.MONTHNAME_FULL=X().MONTHNAME_FULL.join("|");this.REGEXPS.MONTHNAME_SHORT=X().MONTHNAME_SHORT.join("|");}e=this.REGEXPS.DATES[c]={};e.formatStr=c;var b=e.reStr=c.replace(/([^M|d|y|\s])/g,"\\$1").replace(/dd/g,"~~~~").replace(/d/g,"(\\d{1,2})").replace(/\~\~\~\~/g,"(\\d\\d)").replace(/yyyy/g,"(\\d\\d\\d\\d)").replace(/yy/g,"(\\d\\d)").replace(/MMMM/g,"@@@@").replace(/MMM/g,"@@@").replace(/MM/g,"(\\d\\d)").replace(/M/g,"(\\d{1,2})").replace("@@@@","("+this.REGEXPS.MONTHNAME_FULL+")").replace("@@@","("+this.REGEXPS.MONTHNAME_SHORT+")");e.reEquals=new RegExp("^"+b+"$");e.reContains=new RegExp("^"+b+"\\b");var f=[{key:"monthIndex",index:c.indexOf("M")},{key:"dayIndex",index:c.indexOf("d")},{key:"yearIndex",index:c.indexOf("y")}];f.sort(function(h,g){return h.index-g.index;});var a=1,d;for(d=0;d<3;d++){e[f[d].key]=f[d].index>-1?a++:null;}}return e;},_buildRegExp4TimeFormat:function F(d){if(!d){return null;}var f=this.REGEXPS.TIMES[d];if(!f){if(!this.REGEXPSTR_AMPM){this.REGEXPSTR_AMPM=[X().AM_NAME,X().PM_NAME,String(X().AM_NAME).toLowerCase(),String(X().PM_NAME).toLowerCase()].join("|");}f=this.REGEXPS.TIMES[d]={};f.formatStr=d;var c=d.replace(/\'\'/g,'"');var g=c.match(/\'(.+?)\'/g);c.replace(/\'(.+?)\'/g,"*");c=c.replace(/([^H|h|m|s|z|Z|a|t|\s|A|P|M|\/])/g,"\\$1").replace(/HH|hh/g,"(\\d\\d)").replace(/H|h/g,"(\\d{1,2})").replace(/mm/g,"(\\d\\d)").replace(/m/g,"(\\d{1,2})").replace(/ss/g,"(\\d\\d)").replace(/s/g,"(\\d{1,2})").replace(/a/g,"("+this.REGEXPSTR_AMPM+")").replace(/AM\/PM/,"("+this.REGEXPSTR_AMPM+")").replace(/tt/g,"("+this.REGEXPSTR_AMPM+")").replace(/z|Z/g,"(.+?)");var e,a;for(e=1,a=(g&&g.length)||0;e<a;e++){c=c.replace(/\*/,g[e]);}c=c.replace(/\"/g,"'");f.reEquals=new RegExp("^"+c+"$");f.reContains=new RegExp(c);var h=[{key:"hourIndex",index:d.search(/h|H/)},{key:"minIndex",index:d.indexOf("m")},{key:"secIndex",index:d.indexOf("s")},{key:"ampmIndex",index:d.search(/tt|a|AM\/PM/)},{key:"zoneIndex",index:d.search(/z|Z/)}];h.sort(function(k,j){return k.index-j.index;});var b=1;for(e=0;e<5;e++){f[h[e].key]=h[e].index>-1?b++:null;}}return f;},doesDateExist:function M(d,a,b){var c=new Date(b,d-1,a);return b==c.getFullYear()&&d==c.getMonth()+1&&a==c.getDate();},fourDigitYear:function T(b){b=parseInt(Number(b),10);if(!isNaN(b)){var a=(X().TWODIGITYEARSTART%100)||0;if(b>=0&&b<=a){b=2000+b;}else{if(b>a&&b<100){b=1900+b;}}}return b;},numericMonth:function W(e){var d=parseInt(Number(e),10),c=mstrmojo.array;if(!isNaN(d)){return d;}var a=(e&&e.length)||0,b=-1;if(a){if(a<=3){b=c.indexOf(X().MONTHNAME_SHORT,e);}if(b===-1){b=c.indexOf(X().MONTHNAME_FULL,e);}}return b+1;},formatInteger:function H(c,b){var f=String(c),e=Math.max(b-f.length,0);if(e>0){var a=[f],d;for(d=1;d<=e;d++){a.push("0");}f=a.reverse().join("");}return f;},getFirstDateOfMonth:function(b,a){return new Date(b,a-1,1);},getDateObject:function(g,a,f,c,e,b){g=g||0;a=a||1;f=f||1;c=c||0;e=e||0;b=b||0;return new Date(g,a-1,f,c,e,b);},getDateFromDateInfo:function(a){return this.getDateObject(a.date&&a.date.year,a.date&&a.date.month,a.date&&a.date.day,a.time&&a.time.hour,a.time&&a.time.min,a.time&&a.time.sec);},getDateJson:function(a){return{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),hour:a.getHours(),min:a.getMinutes(),sec:a.getSeconds()};},isLeapYear:function(a){return !(a%400)||(!(a%4)&&!!(a%100));},getDaysOfMonth:function(c,a){var b=[31,28,31,30,31,30,31,31,30,31,30,31];if(a==2&&this.isLeapYear(c)){return 29;}return b[a-1];},getPreMonth:function(b,a){if(a===1){return{y:b-1,m:12};}return{y:b,m:a-1};},getNextMonth:function(b,a){if(a===12){return{y:b+1,m:1};}return{y:b,m:a+1};}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.string","mstrmojo.array");var N=mstrmojo.locales,I=mstrmojo.string,Q=window.mstrConfig,F=mstrmojo.array,K=function(){return mstrmojo.locales.number.THOUSANDSEPARATOR;},R=function(){return mstrmojo.locales.number.DECIMALSEPARATOR;},C=Q.units,T={CM:1,IN:2,MM:3,PT:4,PC:5,PX:6},A={1:"cm",2:"in",3:"mm",4:"pt",5:"pc",6:"px"},E={DEFAULT:-2,FIXED:0,CURR:1,PERCENT:4,FRACTION:5,SCIENTIFIC:6,GENERAL:9};var G=96;String.prototype.reverse=function(){var W="",V;for(V=this.length;V>0;--V){W+=this.charAt(V-1);}return W;};function M(V,X){V=V||"";X=X||V.match(/\".+?\"/g)||[];for(var W=0;W<X.length;W++){V=V.replace(X[W],X[W].substring(1,X[W].length-1).replace(/\$/g,"$$$$"));}return V;}function U(a){var V=86400000,Z=new Date(1900,0,1,0,0,0,0),W=Math.floor(a)-1,Y=a-W-1;if(a>=59){W--;}var X=new Date(Z.getTime()+(W*V));X.setTime(X.getTime()+Y*V+500);return X;}function H(Z,g,j){var a={"d+":Z.getDate(),"h+|H":Z.getHours(),"s+":Z.getSeconds()},V=N.datetime,b;if(/(y+)/.test(g)){var Y=Z.getFullYear().toString(),f=RegExp.$1,X=f.length===2,W=Y.length;g=g.replace(f,Y.substr(X?W-2:0,X?2:W));}if(/(^\[h\])/.test(g)&&j){g=g.replace(RegExp.$1,""+(Math.floor(j*24)));}if(/(\"?:\"?mm)/.test(g)){var c=Z.getMinutes();g=g.replace(RegExp.$1,":"+(RegExp.$1.length===1?c:("00"+c).substr(c.toString().length)));}if(/(AM\/PM)/.test(g)){var h=a["h+"],d=h>11;a["h+"]=h-(d?12:0);g=g.replace(RegExp.$1,d?"PM":"AM");}for(b in a){if(new RegExp("("+b+")").test(g)){g=g.replace(RegExp.$1,RegExp.$1.length===1?a[b]:("00"+a[b]).substr((a[b].toString()).length));}}if(/(mmmm)/.test(g)){g=g.replace(RegExp.$1,V.MONTHNAME_FULL[Z.getMonth()]);}else{if(/(mmm)/.test(g)){g=g.replace(RegExp.$1,V.MONTHNAME_SHORT[Z.getMonth()].substr(0,3));}else{if(/((m|M)+)/.test(g)){var e=(Z.getMonth()+1).toString();g=g.replace(RegExp.$1,RegExp.$1.length===1?e:("00"+e).substr(e.length));}}}return M(g);}function O(W,Z){var X=0,V=Z.length,Y=0;for(;X<V;X++){if(Z[X]==="0"){Y++;}else{if(Z[X]==="#"){if(Y<W){Y++;}}else{continue;}}}return Y;}mstrmojo.num=mstrmojo.provide("mstrmojo.num",{isInt:function D(V){var Y=K(),X=new RegExp("^(-)?[0-9]{1,3}(\\"+Y+"[0-9]{3})*$"),W=new RegExp("^(-)?[0-9]+$");return(String(V).indexOf(Y)&&X.test(V))||W.test(V);},isNumeric:function P(Y,Z){var X=R(),a=K(),W=new RegExp("^(-)?[0-9]{1,3}(\\"+a+"[0-9]{3})*(\\"+X+"[0-9]+)?$"),V=new RegExp("^(-)?[0-9]*(\\"+X+")?[0-9]+$");return(String(Y).indexOf(a)&&W.test(Y))||V.test(Y);},parseInteger:function L(V,W){if(!this.isInt(V)){return Number.NaN;}return parseInt(this.toString(V,true),W);},parseNumeric:function B(V){if(!this.isNumeric(V)){return Number.NaN;}return parseFloat(this.toString(V,true));},inNumericRange:function S(W,X,V){W=this.parseNumeric(W);V=(V!=null)?this.parseNumeric(String(V)):Number.NaN;X=(X!=null)?this.parseNumeric(String(X)):Number.NaN;if(V!=Number.NaN&&(W>V||isNaN(W))){return 1;}if(X!=Number.NaN&&(W<X||isNaN(W))){return -1;}return 0;},convertToUSUnits:function(Y,X,W){var V=Y;X=X||C;switch(parseInt(X,10)){case T.CM:V=parseFloat(this.toString(Y))/2.54+"";break;case T.MM:V=parseFloat(this.toString(Y))/25.4+"";break;case T.PT:V=parseFloat(this.toString(Y))/72+"";break;case T.PC:V=parseFloat(this.toString(Y))/6+"";break;case T.PX:V=parseFloat(this.toString(Y))/G+"";break;}return W?V:this.toLocaleString(V);},convertToLocalUnits:function(Y,X,W){var V;X=X||C;switch(parseInt(X,10)){case T.CM:V=(parseFloat(this.toString(Y))*2.54).toFixed(4)+"";break;case T.MM:V=(parseFloat(this.toString(Y))*25.4).toFixed(4)+"";break;case T.PT:V=(parseFloat(this.toString(Y))*72).toFixed(4)+"";break;case T.PC:V=(parseFloat(this.toString(Y))*6).toFixed(4)+"";break;case T.PX:V=(parseFloat(this.toString(Y))*G)+"";break;default:V=parseFloat(this.toString(Y)).toFixed(4)+"";}return W?V:this.toLocaleString(V);},convertUnits:function(W,X,V){return this.convertToLocalUnits(this.convertToUSUnits(V,W,true),X,true);},toLocaleString:function(V){return(V+"").replace(".",R());},toString:function(X,V){if(V===true){var W=this.getThousandSepRegex();if(W){X=String(X).replace(W,"");}}return String(X).replace(R(),".");},getThousandSepRegex:function(){if(this.thousandSeparatorRegex==null){this.thousandSeparatorRegex=new RegExp(K().replace(/(\W){1}/g,"\\$1"),"g");}return this.thousandSeparatorRegex;},addSeparators:function(X,W){var V=W;if(W=="."||W=="*"||W=="\\"){V="\\"+W;}return X.reverse().replace(/(\d{3})/g,"$1"+W).reverse().replace(new RegExp("^(-)?"+V),"$1");},format:function(Z,Y,c,V){var b="",a=(Y>0)?".":"",W=[];c=(c)?c:"";for(var X=0;X<Y;X++){W.push("0");}W=W.join("");switch(Z){case E.GENERAL:b="0.00";break;case E.PERCENT:b="0"+a+W+"%";break;case E.SCIENTIFIC:b="0"+a+W+"E+00";break;default:b='"'+c+'"#,##0'+a+W;}return this.formatByMask(b,V);},getDecimalLength:function J(X){var V=X.indexOf("."),Y=0;if(V!==-1){var W=X.substr(V+1,X.length).match(/\d+/);if(W&&W.length>0){Y=W[0].length;}}return Y;},formatByMask:function(AD,AT){var AA,r;if(isNaN(AT)){AA=new Date(AT);if(isNaN(AA)){return AT;}r=true;}if(AD==="General"){return String(parseFloat(AT).toFixed(2));}var q=String(AD).split(";"),l="",Y=q[0],h="\u00A4",AM=/"[^"]*"/g,k=(AD&&AD.replace(AM,h).replace(/\[.*\]/g,h))||"",AS=["m","y","d","h","s"],AI=false;F.forEach(AS,function(j){AI=AI||k.indexOf(j,0)!==-1;});if(AI){if(window.SSF){l=window.SSF.format(AD,AT);}if(l!==""){return l;}else{return H(r?AA:U(AT),AD,AT);}}var AH=Y.indexOf("E+"),e=Y.indexOf("%"),w=Y.match(/\".+?\"/g),x=Y.indexOf("?/?")>-1,AB=(AH!=-1)?E.SCIENTIFIC:((e!=-1)?E.PERCENT:((w)?E.CURR:x?E.FRACTION:E.FIXED)),p="",AO="",n=false,W=new String(AT),d=this.parseNumeric(AT)||parseFloat(AT);if(w){if(Y.match(/\[\$.+?\]/g)){for(var f=0;f<w.length;f++){Y=Y.replace(w[f],w[f].substring(1,w[f].length-1));if(w[f].match(/\[\$.+?\]/g)){w[f]=w[f].replace(/\[\$.+?\]/g,w[f][w[f].indexOf("[$")+2]);}}Y=Y.replace(/\[\$.+?\]/g,'"#"'.replace("#",Y[Y.indexOf("[$")+2]));}p=M(Y,w);p=p.replace(Y.replace(/\".+?\"/g,""),h);}if(d<0){W=W.substring(1,W.length);d=-d,n=true;if(q.length>1){var b=q[1].replace(/\[.*\]/,"");AO=M(b.replace(q[0],h));}}var c=function(m,j){return(j)?j.replace(h,m):"-"+m;};if(AB==E.FRACTION){var AL,AK,AR,o=10,z,u=0,AF,AN,Z,X=false,AC;if(AD.indexOf("# ")>-1){X=true;}for(AL=5;AL>0;AL--){AC="/";for(AK=0;AK<AL;AK++){AC+="?";}if(AD.indexOf(AC)>-1){for(AK=1;AK<AL;AK++){o*=10;}break;}}if(X){u=Math.floor(Number(d));d-=u;}AN=o/2;AR=-1;AF=d*o;for(AL=o-1;AL>=2;AL--){Z=(AF*AL)/o;Z=Z-Math.floor(Z);Z=Z*o;if(Math.abs(Z-o)<Z){Z=Math.abs(Z-o);}Z=Z/AL;if(Z<AN){AN=Z;AR=AL;}else{if((Z==AN)&&(Z==0)){AN=Z;AR=AL;}}}z=Math.round(AR*AF/o);for(AL=AR;AL>=2;AL--){if((z%AL==0)&&(AR%AL==0)){z=z/AL;AR=AR/AL;break;}}if(AR==o){AR=1;z=0;}if(z==0){AR=1;}if(z==AR){if(X){l=""+(u+1);}else{l="1";}}else{if(X&&u>0){if(z==0){l=u;}else{l=u+" "+z+"/"+AR;}}else{if(z==0){l="0";}else{l=z+"/"+AR;}}}if(n){l=c(l,AO);}}else{if(AB==E.SCIENTIFIC){if(d!=0){var AU=Math.floor(Math.log(d)/Math.LN10),AJ=d/Math.pow(10,AU),AV=Y.substring(0,AH),g=AV.indexOf("."),AE=Y.length-Y.indexOf("E+")-(""+Math.abs(AU)).length-2,AL,V=AU<0;AU=Math.abs(AU);for(AL=0;AL<AE;AL++){AU="0"+AU;}l+=Number(AJ).toFixed((g!=-1)?AV.length-g-1:0);l=((n)?c(l,AO):l)+"E"+(V?"-":"+")+AU;}else{l="0";}}else{if(AB==E.PERCENT){Y=Y.substring(0,Y.length-1);W=String(d*100);}var g=Y.indexOf("."),a=0,AQ,t=g>=0?Y.substring(0,g):Y;if(t.match(/[#0\?],$/)){d/=1000;W=String(d);}AQ=this.getDecimalLength(W);if(g!=-1){a=O(AQ,Y.substr(g+1,Y.length));}l=String(parseFloat(W).toFixed(Math.min(a,20)));var AP=l.split(".");var AG=Y.replace(/"[^"]*"/g,"").match(/[#\d]+[^\.\d#]+[#\d]+/);if(AG!==null){AP[0]=this.addSeparators(AP[0],K());}l=AP.join(R());if(AB==E.CURR){l=p.replace(h,l);if(l===p&&window.SSF){l=window.SSF.format(AD,AT);}}if(AB==E.PERCENT){l+="%";}if(n){l=c(l,AO);}}}return l;},validateFormat:function(V){var W=true,X=String(V).split(";");if(X[1]&&X[1].indexOf(X[0])<0){W=false;}return W;},generateUniqueID:function(V){var X="0123456789ABCDEF".split(""),Y=[];for(var W=0;W<V;W++){Y[W]=X[0|Math.random()*16];}return Y.join("");},countOfDecimals:function(W,X){var V=String(W);return V.length-(V.indexOf(X!==undefined?X:R())+1);}});mstrmojo.num.UNIT=T;mstrmojo.num.UNIT_SYMBOL=A;})();(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.array","mstrmojo.publisher");var D=mstrmojo.registry,K=mstrmojo.array,I=mstrmojo.publisher;function G(Q,R){if(R){R.parent=Q;var P=D.ref(R);if(R!==P){delete R.parent;}return P;}return null;}function L(Q,R){var P=R.alias;if(P!==null&&P!==""){Q[P]=R;}}function N(Q,R){var P=R.alias;if(R.parent===Q){delete R.parent;}if((P!==null&&P!=="")&&(Q[P]===R)){delete Q[P];}}function A(T,Q){var P=Q&&Q.length,S,R;if(P){S=[];for(R=0;R<P;R++){var U=G(T,Q[R]);if(!U){continue;}S.push(U);L(T,U);}}return S;}mstrmojo._HasChildren=mstrmojo.provide("mstrmojo._HasChildren",{_meta_usesSuper:false,children:null,postCreateChildren:mstrmojo.emptyFn,onaddChild:null,onremoveChild:null,initChildren:function F(){var P="children",Q=this[P];if(!Q){return ;}this[P]=null;this._set_children(P,Q,true);this.postCreateChildren();},_set_children:function E(S,Q,P){var R=this.children;if(Q!==R){if(R){this.removeChildren(null,P);}this.addChildren(Q,0,P);}return false;},destroyChildren:function C(S){var R=this.children,P=(R&&R.length)||0,Q;if(P){for(Q=P-1;Q>-1;Q--){var T=R[Q];if(T&&T.destroy){T.destroy(S);if(!S){N(this,T);}}}if(!S){R.length=0;}}},invalidateChildren:function B(){mstrmojo.array.forEach(this.children,function(P){P.invalidate();});},invalidate:function H(){this.invalidateChildren();},addChildren:function O(U,Q,R){if(!U){return U;}var T=U.constructor===Array,P=A(this,T?U:[U]);if(P&&P.length){var S=this.children||[];if(Q===null||Q===undefined){Q=S.length;}this.children=K.insert(S,Q,P);if(!R&&(this.onaddChild||I.hasSubs(this.id,"addChild"))){this.raiseEvent({name:"addChild",value:P,index:Q});}}return T?P:(P&&P[0]);},removeChildren:function J(V,R){var T=this.children,U=V?[V]:(this.children||[]).concat(),Q=U.length,P=-1,S;if(Q){for(S=Q-1;S>-1;S--){N(this,U[S]);}if(V){P=K.removeItem(T,V);}else{if(T){T.length=0;P=0;}}if(!R&&(this.onremoveChild||I.hasSubs(this.id,"removeChild"))){this.raiseEvent({name:"removeChild",value:U,index:P});}}return P;},removeAndDestroyChild:function M(R,P,Q){if(R){if(R.parent!==this){throw"Unable to remove an object that is not in the children collection.";}this.removeChildren(R,P);R.destroy(Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash");var A=false,D="mstrmojo.Binding",I="bindings",H=mstrmojo.registry;function B(K){var L;for(L in K){var J=K[L];if(J&&J.disable){J.destroy();}}}function C(K,M){if(!A){mstrmojo.requiresCls(D);A=true;}var N;for(N in K){var J=K[N];if(J===null||J===undefined){continue;}var L=typeof J;if(L==="string"||L==="function"){J={destination:N,source:J,scriptClass:D};}J.parent=M;J=H.ref(J,{skipLoadChecks:true});K[N]=J;J.enable();}}mstrmojo._HasBindings=mstrmojo.provide("mstrmojo._HasBindings",{_meta_usesSuper:false,initBindings:function E(){this.hasInitBindings=true;var K=mstrmojo.hash.copy(this[I]);if(K){delete this[I];this._set_bindings(I,K);if(this.postCreateBindings){this.postCreateBindings();}}var M=this.children,J=(M&&M.length)||0;if(J){var L;for(L=0;L<J;L++){var N=M[L];if(N&&N.initBindings){N.initBindings();}}}},destroyBindings:function G(){var J=this.bindings;if(J){B(J);delete this.bindings;}},_set_bindings:function F(L,J){var K=this[I];if(J!==K){if(K){B(K);}this[I]=J;if(J){C(J,this);}return true;}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry");mstrmojo._PagingList=mstrmojo.provide("mstrmojo._PagingList",{usePaging:false,page:0,totalPages:1,_set_page:function(B,A){if(this.page!==A&&this.usePaging){if(A>=0&&A<this.totalPages){this.page=A;}return true;}return false;},_inScroll:false,_inPaging:false,onscroll:function(){if(this.usePaging&&!this._inPaging){this._inScroll=true;this.set("page",this.listMapper.whichPage(this));this._inScroll=false;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.hash");var M=mstrmojo.string,L=mstrmojo.hash,E=mstrmojo.dom;var R=mstrmojo.usesFrames?null:document.createElement("span");var J=/mstrAttach:([\w,]+)/g;var Q;function U(a){if(Q===undefined){Q=(mstrApp!==undefined&&mstrApp.isTouchApp&&mstrApp.isTouchApp())||false;}return a.replace(J,function Z(g,j){var c=j.split(","),d=[],b=c.length,f;for(f=0;f<b;f++){var h=c[f];if(h){if(Q){if(h.indexOf("mouse")>-1){continue;}else{if(h==="click"){h="touchend";}}}d.push("on"+h+"=\"mstrmojo.dom.captureDomEvent('{@id}','"+h+"', self, event)\"");}}return d.join(" ");});}var N="preBuildRendering",C="buildRendering",B="postBuildRendering";function X(b){var a=b.markupString;if(a.match(/mstrAttach:/)){a=U(a);if(b.markupString===b.constructor.prototype.markupString){b.constructor.prototype.markupString=a;}}var Z=M.apply(a,b);if(Z){if(mstrmojo.usesFrames){var c=(b.domNode&&b.domNode.ownerDocument)||window.document;if(!R||R.ownerDocument!==c){R=c.createElement("span");}}R.innerHTML=Z;var e=R.removeChild(R.firstChild);e.mstrmojoId=b.id;return e;}return null;}function A(b){var a=b.markupSlots,Z,c;if(a){Z={};for(c in a){Z[c]=a[c].call(b);}}return Z;}mstrmojo._HasMarkup=mstrmojo.provide("mstrmojo._HasMarkup",{markupString:null,markupMethods:null,markupSlots:null,onRender:mstrmojo.emptyFn,onUnRender:mstrmojo.emptyFn,render:function Y(){if((this[N]&&this[N]()===false)||(this[C]()===false)||(this[B]&&this[B]()===false)){return false;}this.hasRendered=!!this.domNode;this.onRender();var Z="renderComplete";if(mstrmojo.publisher.hasSubs(this.id,Z)){this.raiseEvent({name:Z});}return true;},buildDom:function T(){return X(this);},postBuildDom:null,preBuildRendering:mstrmojo.emptyFn,buildRendering:function F(){var Z=this.domNode,a=this.buildDom();this.domNode=a;if(this.postBuildDom){this.postBuildDom();}if(this.slotNames){this.removeSlots(this.slotNames);}this.addSlots(A(this));this.paint();if(a){var d=Z;if(!d){d=this.placeholder;if(d){if(typeof d==="string"){d=document.getElementById(d);}delete this.placeholder;}}if(d){E.replace(d,a);}}var b="onchildRenderingChange",c=this.parent;if(c&&c[b]){c[b](this);}return true;},postBuildRendering:mstrmojo.emptyFn,unrender:function S(b){if(this.hasRendered){if(!b){try{var Z=this.domNode;if(Z.parentNode){Z.parentNode.removeChild(Z);}if(mstrmojo.dom.isIE&&Z.outerHTML!=="undefined"){Z.outerHTML="";}}catch(a){}}this.domNode=null;this.removeSlots(this.slotNames);this.hasRendered=false;this.onUnRender();}},paint:function K(){var a=this.markupMethods;if(!a){return ;}var d=this,e=function(j){var h=a[j];if(h){try{h.apply(d,[true]);}catch(g){throw new Error(["Error in markup method.","Script class: "+d.scriptClass,"Widget id: "+d.id,"Method name: "+j,"Err: "+g.message].join("\n\n"));}}};var c=a.sequence,Z,b,f;if(c){Z=c.length||0;for(b=0;b<Z;b++){e(c[b]);}}else{for(f in a){e(f);}}},redraw:function P(){return false;},refresh:function D(Z){if(this.hasRendered){if(this.redraw()!==true){var a=this.domNode;this.unrender(true);this.placeholder=a;if(Z){Z();}this.render();}}},set:function I(c,Z){this._super(c,Z);if(this.domNode){var a=this.markupMethods,b=a&&a["on"+c+"Change"];if(b){b.apply(this);}}return this;},slotNames:null,addSlots:function G(a){var Z=this.slotNames,b;if(!Z){Z={};this.slotNames=Z;}for(b in a){this[b]=a[b];Z[b]=true;}},removeSlots:function H(Z){if(Z){var a=this.slotNames,b;for(b in Z){delete this[b];if(a){delete a[b];}}}},captureDomEvent:function W(b,Z,c,a){if(this.enabled!==false){this.raiseEvent(mstrmojo._HasMarkup.newDomEvent(b,Z,c||Z.event,a));}},playEffect:function V(a){var Z=this[a];if(Z&&Z.constructor===Object){Z=mstrmojo.insert(mstrmojo.hash.clone(Z));Z.widget=this;this[a]=Z;}if(Z){Z.play();}}});mstrmojo._HasMarkup.addMarkupMethods=function O(a,Z){a.prototype.markupMethods=L.copy(Z,L.copy(a.prototype.markupMethods));};mstrmojo._HasMarkup.MSTRDomEventType=null;mstrmojo._HasMarkup.newDomEvent=function(c,Z,b,a){return{name:c,hWin:Z,e:b,config:a,ctrlKey:E.ctrlKey(Z,b),shiftKey:E.shiftKey(Z,b),metaKey:E.isMetaKey(Z,b),cancel:function(){E.stopPropogation(Z,b);},preventDefault:function(){E.preventDefault(Z,b);},getTarget:function(){return E.eventTarget(Z,b);}};};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.string");var T=mstrmojo.dom,K=mstrmojo.string,X=mstrmojo.array;mstrmojo.css=mstrmojo.provide("mstrmojo.css",{DISPLAY_TABLE:T.isNSIE?"block":"table",DISPLAY_CELL:T.isNSIE?"block":"table-cell",MINHEIGHT:T.isIE6?"height":"minHeight",addClass:function L(e,d){if(e){if(d.constructor!==Array){d=[d];}var Z=e.className||"",g=" "+Z+" ",a=false,Y=d.length,b;for(b=0;b<Y;b++){var f=d[b];if(!g.match(new RegExp("\\s"+f+"\\s"))){Z+=" "+f;a=true;}}if(a){e.className=K.trim(Z);}}return e;},removeClass:function N(c,b){if(!c){return ;}if(b.constructor!==Array){b=[b];}var Z=" "+(c.className||"")+" ",Y=b.length,a;for(a=0;a<Y;a++){Z=Z.replace(new RegExp("\\s"+b[a]+"\\s","g")," ");}c.className=K.trim(Z);},addWidgetCssClass:function M(d,b){var Z=d.cssClass,c=(Z&&Z.split(" "))||[],a;b=[].concat(b);for(a=0;a<b.length;a++){var Y=b[a];if(X.indexOf(c,Y)===-1){c.push(Y);}}d.cssClass=c.join(" ");},removeWidgetCssClass:function F(e,c){var Z=e.cssClass,d=(Z&&Z.split(" "))||[],b;c=[].concat(c);for(b=0;b<c.length;b++){var Y=c[b];var a=X.indexOf(d,Y);if(a!==-1){d.splice(a,1);}}e.cssClass=d.join(" ");},toggleClass:function S(a,Z,Y){if(Y){this.addClass(a,Z);}else{this.removeClass(a,Z);}},applyShadow:function G(c,d,b,a,Y){var Z=c.style;if(T.isDXIE){Z.filter+="progid:DXImageTransform.Microsoft.dropshadow(OffX="+d+"px, OffY="+b+"px, Color='"+Y+"')";}else{if(T.isFF||T.isWK||T.isIE10){Z[T.CSS3_BOXSHADOW]=d+"px "+b+"px "+a+"px "+Y;}}},removeShadow:function B(Z){var Y=Z.style;if(T.isFF||T.isWK||T.isIE10){Y[T.CSS3_BOXSHADOW]="";}},setOpacity:function U(Z,b){if(T.isDXIE&&!T.isIE9){var c=Z.currentStyle.filter;var Y=null;if(c.length>0){Y=Z.filters["DXImageTransform.Microsoft.Alpha"];}if(Y){Y.opacity=b;Y.enabled=(b!==100);}else{if(b<100){var a="progid:DXImageTransform.Microsoft.Alpha(Opacity="+b+")";Z.style.filter=(c||"")+" "+a;}}}else{Z.style.opacity=b/100-(T.isIE9?0.00001:0);}},buildGradient:function O(Z,b,Y){if(T.supports(T.cssFeatures.GRADIENTS)){var a={};if(T.isDXIE){a.n="filter";a.v="progid:DXImageTransform.Microsoft.Gradient(GradientType="+Z+",StartColorStr='"+b+"',EndColorStr='"+Y+"')";}else{if(T.isFF){a.n="background-image";a.v="-moz-linear-gradient("+((Z===0)?"top":"left")+","+b+","+Y+")";}else{if(T.isWK){a.n="background";a.v="-webkit-gradient(linear,"+((Z===0)?"left top, left bottom":"left top, right top")+",from("+b+"),to("+Y+"))";}else{if(T.isIE10||T.isIEW3C){a.n="background";a.v="linear-gradient("+((Z===0)?"to bottom":"to right")+","+b+","+Y+")";}}}}return a;}return null;},buildRoundCorners:function Q(d,c){if(T.supports(T.cssFeatures.ROUND_CORNERS)){var Z=d+"px";var f=Z+(c?" "+Z+" 0 0":"")+";";if(T.isFF||T.isWinPhone||T.isIE10){return"border-radius:"+f;}if(T.isWK){if(!c){return"-webkit-border-radius:"+Z+";";}var e=["left","right"],b=[],Y=-1,a;for(a=0;a<2;a++){b[++Y]="-webkit-border-top-"+e[a]+"-radius:"+Z;b[++Y]="-webkit-border-bottom-"+e[a]+"-radius:0";}return b.join(";");}}return"";},getBorderWidthsOrPaddings:function D(Z,e){var f={t:0,r:0,b:0,l:0,h:0,w:0};if(!Z){return f;}var c=Z.split(" "),Y=c.length,d;for(d=0;d<Y;d++){c[d]=Math.round(e*parseFloat(c[d])/72);}if(Y<4){if(Y===1){c[1]=c[2]=c[3]=c[0];}else{c[3]=c[1];if(Y===2){c[2]=c[0];}}}f.t=c[0];f.r=c[1];f.b=c[2];f.l=c[3];f.h=f.t+f.b;f.w=f.l+f.r;return f;},getBorderWidths:function H(Z,Y){return this.getBorderWidthsOrPaddings(Z,Y);},getPaddings:function C(Z,Y){return this.getBorderWidthsOrPaddings(Z,Y);},parkAfterFade:function A(Y){var Z=Y.target.style;if(Z.opacity===0){Z.left="-10000px";window.setTimeout(function(){Z.opacity=0.99;},0);return true;}return false;},getStyleValue:function I(Y,c){var a=(c==="float"),b;if(Y.currentStyle){c=a?"styleFloat":c;b=Y.currentStyle[c];}else{if(document.defaultView&&document.defaultView.getComputedStyle){c=a?"cssFloat":c;var Z=document.defaultView.getComputedStyle(Y,null);b=Z?Z[c]:null;}}return b;},getComputedStyle:function R(Y,a){var Z=(window.getComputedStyle)?function(b,c){return window.getComputedStyle(b,c||null);}:function(b){return b.currentStyle||{};};mstrmojo.css.getComputedStyle=Z;return Z(Y,a);},getCssTextFromObj:function E(a){var Z="",Y;for(Y in a){Z+=Y+":"+a[Y]+";";}return Z;},onTransitionEnd:function W(a,Y){var Z="transition",b=window.Modernizr;if(b.testProp(Z)){T.attachOneTimeEvent(a,T.transEndEvtNames[b.prefixed(Z)],Y);}else{window.setTimeout(Y,0);}},flashClass:function P(Z,Y,b){this.toggleClass(Z,Y,true);var a=this;window.setTimeout(function(){a.toggleClass(Z,Y,false);},b);},convertCssToCamelCase:function J(Y){return Y.replace(/\-([a-z])/gi,function(Z,a){return a.toUpperCase();});},printCSSInfo:function V(c){var g=document.styleSheets,l=g.length,d,e;for(e=0;e<l;e++){var f=g[e],h=f.cssRules,a=h?h.length:0,k=0;for(d=0;d<a;d++){var Y=h[d].selectorText;if(Y){try{k+=Y.split(",").length;}catch(b){}}}var Z=f.href;if(!c||(Z&&X.indexOf(Z,c)>-1)){console.log("Stylesheet: "+Z||"Inline CSS Block");console.log("Total rules: "+a);console.log("Total selectors: "+k);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.string");var D=mstrmojo.string,F=1;mstrmojo.ListBuilder=mstrmojo.provide("mstrmojo.ListBuilder",{newContext:function E(G){var I=G.itemMarkupFunction;if(!I){var H=G.itemMarkup||(G.itemField&&'<div class="mstrmojo-text">{@'+G.itemField+"}</div>");I=H?function(K,J,L){return D.apply(H,K);}:null;}return{itemStatus:[],itemFunc:I};},build:function A(I,H,J,G){H.itemStatus[G]=F;return H.itemFunc(J,G,I);},onadd:function B(I,G,H){if(G){mstrmojo.array.insert(G.itemStatus,H.index,new Array(H.value.length));}},onremove:function C(I,G,H){if(G){G.itemStatus.splice(H.index,H.value.length);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher");var C=mstrmojo.publisher;mstrmojo._Provider=mstrmojo.provide("mstrmojo._Provider",{_meta_usesSuper:false,audibles:{"*":true},set:function F(N,H){var G=false,K=this["_set_"+N],I=this[N];if(K){G=K.apply(this,arguments);}else{this[N]=H;G=(I!==H);}if(G){var L=N+"Change",M=this.audibles||{},J=(M[N]===true)||((M[N]!==false)&&(M["*"]!==false));if(J&&(this["pre"+L]||this["on"+L]||this["post"+L]||C.hasSubs(this.id,L))){this.raiseEvent({name:L,prop:N,value:H,valueWas:I});}}return this;},raiseEvent:function B(H){var M=H&&H.name;if(!M){return null;}H.src=this;this.preHandleEvent(H);var K=["pre","on","post"],L=false,I,G;for(I=0,G=K.length;I<G;I++){var J=K[I]+M;if(this[J]){if(this[J](H)===false){L=true;break;}}}if(!L){this.postHandleEvent(H);C.publish(this.id,M,H);}return H;},preHandleEvent:mstrmojo.emptyFn,postHandleEvent:mstrmojo.emptyFn,attachEventListener:function A(G,H,I){return C.subscribe(this.id,G,I,H);},detachEventListener:function E(G){C.unsubscribe(G);},destroy:function D(){C.clearSubscriptions(this.id);if(this._super){this._super();}}});}());(function(){var D={};var B="XHRServerTransport";mstrmojo.XHRServerTransport={serverRequest:function A(I,G,F){var E=mstrmojo.all[I],H=D[G]=new mstrmojo.SimpleXHR();$MAPF(true,B,"transportRequest");if(F.params&&!F.params.sessionState&&mstrConfig&&mstrConfig.isAddSessionState&&mstrApp&&mstrApp.sessionState){F.params.sessionState=mstrApp.sessionState;}H.request(F.config.method||"POST",F.taskURL||mstrConfig.taskURL,{success:function(J){if(J.mstrerr){J.code=J.mstrerr.code;J.message=J.mstrerr.message;}E.response(G,true,J);},failure:function(J){E.response(G,false,{code:J.getResponseHeader("X-MSTR-TaskErrorCode"),message:J.getResponseHeader("X-MSTR-TaskFailureMsg")});},complete:function(){delete D[G];},textResponse:F.callback.textResponse},F.params);},cancelRequest:function C(F){var G=D[F],E=false;if(G){E=G.cancel();delete D[F];}$MAPF(false,B,"transportRequest");return E;}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.registry","mstrmojo.publisher","mstrmojo._Provider");var G=mstrmojo.hash,A=mstrmojo.array,B=mstrmojo.registry,D=mstrmojo.publisher;mstrmojo.Arr=mstrmojo.declare(null,[mstrmojo._Provider],{scriptClass:"mstrmojo.Arr",postApplyProperties:null,postCreate:null,length_bindEvents:["add","remove"],init:function H(K){var J;if(K&&K.data){J=K.data;delete K.data;}else{if(K){J=K;K=null;}}if(!J||J.constructor!==Array){J=[];}G.copy(mstrmojo.Arr.prototype,J);if(K){G.copy(K,J);}if(J.postApplyProperties){J.postApplyProperties();}B.add(J);if(J.postCreate){J.postCreate();}return J;},destroy:function E(){D.clearSubscriptions(this.id);B.remove(this);},add:function I(L,J,K){var M=L&&L.length;if(M){if(J==null){J=this.length;}A.insert(this,J,L);if(!K&&(this.onadd||D.hasSubs(this.id,"add"))){this.raiseEvent({name:"add",value:L,index:J});}}},remove:function F(J,L,K){if(L==null){L=1;}if((J!=null)&&L){var M=this.splice(J,L);if(!K&&(this.onremove||D.hasSubs(this.id,"remove"))){this.raiseEvent({name:"remove",value:M,index:J});}}}});mstrmojo.Arr.makeObservable=function C(J,K){if(!J){return ;}if(!K){K={};}K.data=J;return this.prototype.init(K);};})();(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.registry","mstrmojo._Provider","mstrmojo.array");var B=mstrmojo.registry,F=mstrmojo.array;mstrmojo.Obj=mstrmojo.declare(mstrmojo.Base,[mstrmojo._Provider],{scriptClass:"mstrmojo.Obj",id:"",init:function I(J){this.disposables=[];this._super(J);B.add(this);if(this.postCreate){this.postCreate();}},addDisposable:function G(M){var K=this.disposables,L,J;if(M.constructor===Array){for(L=0,J=M.length;L<J;L++){K.push(M[L]);}}else{K.push(M);}return M;},destroyDisposables:function D(J){F.forEach(this.disposables,function(K){if(K.destroy){K.destroy(J);}else{if(K.clear){K.clear();}}});this.disposables=[];},throwAbstractMethodError:function A(J){throw new Error(this.scriptClass+" must implement "+J+".");},destroy:function H(J){if(this.destroyed){return ;}this._super(J);this.destroyDisposables(J);B.remove(this);delete this.parent;this.destroyed=true;}});var C=mstrmojo.Obj;C.free=function E(J){if(J instanceof C){J.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.registry","mstrmojo.ListBuilder");var H=mstrmojo.hash,E=mstrmojo.registry,G=1;mstrmojo.WidgetListBuilder=mstrmojo.provide("mstrmojo.WidgetListBuilder",mstrmojo.mixin({newContext:function F(J){var K=J.itemFunction;if(!K){var I=J.itemConfig;K=I?function(M,L,N){var O=H.clone(I);O.data=M;O.parent=N;return E.ref(O);}:null;}return{itemStatus:[],itemWidgets:[],itemFunc:K};},build:function A(K,J,N,I){var L=J.itemFunc(N,I,K);if(L){J.itemStatus[I]=G;J.itemWidgets[I]=L;if(L.set){var M=K.selectedIndices;if(M&&M[I]){L.set("selected",true);}}}return L;},onadd:function C(K,I,J){if(I){mstrmojo.array.insert(I.itemWidgets,J.index,new Array(J.value.length));}this._super(K,I,J);},onremove:function D(L,J,K){if(J){var O=J.itemWidgets.splice(K.index,K.value.length),N,I;for(N=0,I=O.length;N<I;N++){var M=O[N];if(M&&M.destroy){delete M.parent;M.destroy();}}}this._super(L,J,K);},onchange:function B(S,J,P,T){if(T){var N=P.itemWidgets,L,O,I,R;for(O=0,I=T.removed,R=I&&I.length;O<R;O++){L=N[I[O]];if(L&&L.set){L.set("selected",false);}}var M,Q,K;for(M=0,Q=T.added,K=Q&&Q.length;M<K;M++){L=N[Q[M]];if(L&&L.set){L.set("selected",true);}}}}},H.copy(mstrmojo.ListBuilder)));}());(function(){mstrmojo.requiresCls("mstrmojo.css");var F=mstrmojo.css,E="px",J="hasOwnAvatar",I={x:0,y:0};function B(L){var K=this.createAvatar(L.src.node,L);if(K){F.addClass(K,[this.avatarCssClass,J]);this.avatar=L.avatar=document.body.appendChild(K);}}function C(){var K=this.avatar;if(K){K.parentNode.removeChild(K);delete this.avatar;F.removeClass(K,[this.avatarCssClass,J]);}}mstrmojo._HasOwnAvatar=mstrmojo.provide("mstrmojo._HasOwnAvatar",{_mixinName:"mstrmojo._HasOwnAvatar",draggable:true,ownAvatar:true,avatarCssClass:"",restrictedToAxis:undefined,isDragValid:function H(K){if(this._super){return this._super(K);}return false;},ondragstart:function D(K){B.call(this,K);this.positionAvatar(K.src.pos,K);if(this._super){this._super(K);}},ondragmove:function A(K){this.positionAvatar(K.tgt.pos,K);if(this._super){this._super(K);}},ondragend:function A(K){C.call(this);if(this._super){this._super(K);}},createAvatar:mstrmojo.emptyFn,positionAvatar:function G(O,L){var N=this.avatar.style,M=this.restrictedToAxis,K=(L&&L.dragOffsets)||I;if(M!=="y"){N.left=O.x+K.x+E;}if(M!=="x"){N.top=O.y+K.y+E;}}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.hash","mstrmojo.css");var F=mstrmojo.hash,C=mstrmojo.css;var D="open";function E(G){return G?G.popupConfig.hostElement:null;}mstrmojo.ui.menus._HasMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._HasMenuPopup",F.copy(mstrmojo._HasPopup));mstrmojo.ui.menus._HasMenuPopup.openPopup=function A(I,G){var H=this._lastOpened;if(H){this.closePopup();}mstrmojo._HasPopup.openPopup.call(this,I,G);C.addClass(E(I),D);};mstrmojo.ui.menus._HasMenuPopup.closePopup=function B(){C.removeClass(E(this._lastOpened),D);mstrmojo._HasPopup.closePopup.call(this);};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.css");var A=1,K="mstrmojo-itemwrap",J="&nbsp;",I=mstrmojo.array;function B(V){if(!V.pageSize||V.pageSize<=0){var W=V.scrollboxNode;V.pageSize=W&&W.clientHeight||0;}return V.pageSize;}function T(V,W){if(V.usePaging){V.totalPages=1;var Y=V.itemsContainerNode,X=B(V);if(V.usePaging&&Y&&X){V.totalPages=Math.ceil((Y.clientHeight-parseInt(Y.style&&Y.style.paddingBottom||0,10))/X);}if(Y){V.itemsContainerNode.style.paddingBottom=X+"px";}}}mstrmojo.ListMapper=mstrmojo.provide("mstrmojo.ListMapper",{markupPrefix:"",markupSuffix:"",itemWrapperPrefix:function(V){return'<div class="'+this.getWrapperCss(V)+'">';},itemWrapperSuffix:"</div>",itemWrapperPrefill:"&nbsp",wrapperNodes:function C(V){return V.childNodes;},wrapperParentNode:function D(V){return V;},createWrapperNode:function G(V){var W=V.ownerDocument,X=W.createElement("div");return X;},findScrollRange:function N(k,Z,j,n,W,c,o,m){if(!Z){return{start:0,end:0};}var e=this.wrapperNodes(k),g=parseInt(Z/2,10),Y=parseInt(Math.log(Z)/Math.log(2),10),X=0,V=Z-1,f=j+n,d=e[0].offsetTop,b;for(var l=1;l<=Y;l++){b=e[g].offsetTop-d+m;if(b<j){X=g;}else{if(b>f){V=g;}}var a=Math.round(Z/Math.pow(2,l+1));g+=(b>j)?-a:a;g=Math.min(Math.max(0,g),Z-1);}return{start:X,end:V};},findWrapper:function L(X,V){var W=this.wrapperNodes(X);return W&&W[V];},findIndex:function F(V,Y,X){var W=this._nd2iw(V,Y,X);return W?this._iw2idx(V,Y,W):-1;},itemOffsetTop:function U(W,a,V,Y){if(!Y){var X=this.wrapperNodes(a);Y=X&&X[V];if(!Y){return 0;}}var Z=a.firstChild;if(!Z||(Z===Y)){return 0;}else{return Y.offsetTop-Z.offsetTop;}},whereDrop:function S(c,V,X,b,W){var Y=this._nd2iw(c,V,X),d,a,e;if(Y){a=this._iw2idx(c,V,Y);d=a;e=this.itemOffsetTop(c,V,null,Y);var Z=Y.offsetHeight;if(b.y>W.top+e+Z/2){d++;e+=Z;}}else{return c.dropCuePos;}return{left:0,top:e,idx:d,idxActual:a};},getWrapperCss:function(V){return K;},postBuildRendering:function(Z,Y,X,W,V){T(W,this);},buildItemWrappers:function P(e,b,h,d,a,l){var m=this.itemWrapperPrefix(h),g=this.itemWrapperSuffix,Z=m+this.itemWrapperPrefill+g,Y=[this.markupPrefix],W=1,V=h.selectedIndices||{},o=function n(k,j){for(var p=k;p<j;p++){Y[W++]=m;var q=b.build(h,d,e[p],p);if(V[p]){q=q.replace(/class\=\"([^\"]*)\"/,'class="$1 selected"');}Y[W++]=q;Y[W++]=g;}};var c=(e&&e.length)||0;a=a&&b?Math.min(a,c):0;if(a){o(0,a);}l=l&&b?Math.min(l,c-a):0;var f=c-l;for(var X=a;X<f;X++){Y[W++]=Z;}if(l){o(f,c);}Y.push(this.markupSuffix);return Y;},fillItemWrappers:function H(X,g,d,m,f,W,b,l){var e=(g&&g.length)||0,j=this.wrapperNodes(X),n=f.itemStatus,V=mstrmojo.css,Z=m.selectedIndices||{};for(var c=W,h=Math.min(b+1,e),a=0;c<h;c++){if(n[c]!==A){j[c].innerHTML=d.build(m,f,g[c],c);if(Z[c]){var Y=j[c].firstChild;if(Y){V.addClass(Y,["selected"]);}}a++;if(a===l){break;}}}return a;},onadd:function O(e,V,Z,f){if(V&&f){var a=f.value.length,b=this.wrapperNodes(V),d=b[f.index],Y=this.getWrapperCss(e);for(var X=0;X<a;X++){var W=this.createWrapperNode(V);W.className=Y;W.innerHTML=J;if(d){this.wrapperParentNode(V).insertBefore(W,d);}else{this.wrapperParentNode(V).appendChild(W);}}T(e,this);}},onremove:function Q(Y,b,V,X){if(b&&X){var a=this.wrapperNodes(b);if(a){var d=X.value.length;for(var Z=X.index+d-1,W=X.index;Z>=W;Z--){this.wrapperParentNode(b).removeChild(a[Z]);}}T(Y,this);}},onchange:function R(g,X,c,k){if(X&&k){var d=this.wrapperNodes(X);if(d){var W=mstrmojo.css,l=c.itemStatus,h;for(var b=0,V=k.removed,f=V&&V.length;b<f;b++){h=V[b];if(l[h]){W.removeClass(d[h].firstChild,["selected"]);}}for(var Z=0,e=k.added,Y=e&&e.length;Z<Y;Z++){h=e[Z];if(l[h]){W.addClass(d[h].firstChild,["selected"]);}}}}},_nd2iw:function E(W,Z,Y){Z=this.wrapperParentNode(Z);if(Z&&Y&&Z!==Y){var V=W.domNode,X=Y.parentNode;while(X){if(X===Z){return Y;}if(X===V){break;}Y=X;X=Y.parentNode;}}return null;},_iw2idx:function M(X,b,a){var W=X.items&&X.items.length,Y=this.wrapperNodes(b),V=I.findBin(Y,a,"offsetTop",W);for(var Z=V;Z<W;Z++){if(Y[Z].offsetHeight){return Z;}}return -1;},toPage:function(V,X){var W=V.scrollboxNode;if(V.usePaging&&W){W.scrollTop=X*B(V);}else{mstrmojo.alert("paging is not setup, can not perform paging.");}},whichPage:function(V){var W=V.scrollboxNode,X=B(V);return Math.round((W&&X&&W.scrollTop/X)||0);},toItem:function(Z,a){var X=Z&&Z.itemsContainerNode,e=Z.scrollboxNode,V=this.itemOffsetTop(Z,X,a),b=this.wrapperNodes(X)[a].clientHeight,W=e.clientHeight,d=e.scrollTop,Y=d;if(V<d){Y=V;}else{if(d+W-b<V){Y=Math.min(V,V-W+b);}}e.scrollTop=Y;}});})();(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var G=mstrmojo.dom,J=mstrmojo.css,H="selected";function B(S,T,U,R,W){var V=W.listHooks[S];if(V&&V.call(W,T,U,R)){return ;}J.toggleClass(T,H,S==="select");}function I(U,T,S){var V=this[U],R=V?V.split(T):[];this[U]=mstrmojo.array.distinct(R.concat(S.split(T))).join(T);}mstrmojo._IsList=mstrmojo.provide("mstrmojo._IsList",{_mixinName:"mstrmojo._IsList",listHooks:{},useListModKeys:false,init:function Q(R){this._super(R);this._shiftStartIndex=-1;},getItemMarkup:function O(S,R){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@en@n}</{@tag}>';},getItemDisplayName:function E(R){return R.n||"";},getItemProps:function K(V,R){var S=!!this.selectedIndices[R],W={tag:"div",sel:S,cls:"",n:this.getItemDisplayName(V),style:"",idx:R,addCls:function T(Y){I.call(this,"cls"," ",Y);},addStyle:function U(Y){I.call(this,"style",";",Y);},title:V.title||""};if(S){W.addCls(H);}var X=V.cls;if(X){W.addCls(X);}return W;},itemRenderer:{render:function A(S,R,T){S._renderIdx=R;return mstrmojo.string.apply(T.getItemMarkup(S,R),T.getItemProps(S,R));},select:function L(S,T,R,U){B("select",S,T,R,U);},unselect:function D(S,T,R,U){B("unselect",S,T,R,U);}},onclick:function P(R){try{var T=this.getItemFromTarget(R.getTarget());if(T){R.cancel();this.doItemSelect(T,R||{});}}catch(S){mstrApp.onerror(S);}},doItemSelect:function F(j,b){var R=b.hWin,h=b.e,c=j._renderIdx,W=j._positionIdx,S=G.isMetaKey(R,h),Z=G.shiftKey(R,h),Y=this.multiSelect,U=this.useListModKeys,d=this._shiftStartIndex,X=this.selectedIndices;if(Y&&U&&Z&&d>-1){var g=[],T=[],V=Math.min(d,c),k=Math.max(d,c),f;for(f=0;f<this.items.length;f++){if(V<=f&&f<=k){if(!X[f]){g.push(f);}}else{if(X[f]){T.push(f);}}}this.addSelect(g);this.removeSelect(T);}else{if(Y&&(!U||S)){var a=(X[c])?"remove":"add";this[a+"Select"](c,false,W);}else{this.singleSelect(c,false,W);}this._shiftStartIndex=c;}},onclearSelection:function N(){this._shiftStartIndex=-1;},getItemNodeFromTarget:function C(S){var R=G.findAncestorByAttr(S,"idx",true,this.domNode);return(R&&R.node)||null;},getItemFromTarget:function M(T){var S=this.getItemNodeFromTarget(T),R=S&&parseInt(S.getAttribute("idx"),10);if(R!==null&&!isNaN(R)&&this.items){return this.items[R];}return undefined;}});mstrmojo._IsList.SELECTED_CLS=H;}());(function(){mstrmojo.requiresCls("mstrmojo.css");var A=mstrmojo.css;mstrmojo.ui._HasUITheme=mstrmojo.provide("mstrmojo.ui._HasUITheme",{_mixinName:"mstrmojo.ui._HasUITheme",themeClassName:"",postBuildRendering:function B(){var D=this.themeClassName;if(D){this.onthemeClassNameChange({value:D});}return this._super();},onthemeClassNameChange:function C(D){var F=this.domNode;if(F){var G=D.value,E=D.valueWas;if(G){A.addClass(F,D.value);}if(E){A.removeClass(F,D.valueWas);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.fx");var Y=mstrmojo.css,H=mstrmojo.dom,O=mstrmojo.array,K={v:{styleDim:"height",styleDir:"top",dimension:"h",position:"y",scroll:"scrollTop",scrollDimension:"scrollHeight",cls:"vertical",hostCls:"hasVertical",scrollNodeCls:"hasVertical"},h:{styleDim:"width",styleDir:"left",dimension:"w",position:"x",scroll:"scrollLeft",scrollDimension:"scrollWidth",cls:"horizontal",hostCls:"hasHorizontal",scrollNodeCls:"hasHorizontal"}},W="scrollingMode",R="scrolling",b=3;var L=H.getOSInfo().name.toLowerCase().indexOf("mac")>=0;function J(){return(this.scrollbarHostNode||(this.scrollNode&&this.scrollNode.parentNode));}function P(d,c){var j=H.eventTarget(c,d),g=this.scrollNode,f=H.position(g),h=this.scrollTrackNodes,e=this.scrollBarNodes,k=function k(t){var q=j===h[t];if(q){var u=K[t],l=e[t],w=H.position(l),n=H.getMousePosition(d,c)[u.position],o=n-w[u.position],m=o>0?1:-1,r=g[u.scrollDimension],x=Math.abs(o-(w.h/2))*(r/f[u.dimension]),p={};p[u.scroll]={isStyle:false,start:g[u.scroll],stop:g[u.scroll]+(m*Math.min(r/3,500,x)),ease:mstrmojo.ease.linear};(new mstrmojo.fx.AnimateProp({props:p,duration:200,interval:10,target:g})).play();}};k.call(this,"h");k.call(this,"v");}function B(d,c){var g=this.scrollNode,f=d.type==="mousewheel",e=f?-1:1;mstrmojo.array.forEach(["h","v"],function(o){var m=K[o],j=f?"wheelDelta":"delta",l=d[j+{h:"X",v:"Y"}[o]]*e,k=Math.abs(l),h=l/k,n=k===3&&H.isFF&&!L;g[m.scroll]+=n?h*40:l;});H.stopPropogation(c,d);H.preventDefault(c,d);}function a(h){var g=K[h],f=this.scrollNode,e=H.position(f),d=e[g.dimension],j=f[g.scrollDimension],c=Math.ceil(d)/j;return A(c,d,j);}function A(d,c,e){return(!isNaN(d)&&d<1)&&(Math.abs(c-e)>b);}function C(AB){var r="px",l=K[AB],e=this.scrollNode,m=J.call(this),AC=H.position(e),n=AC[l.dimension],u=e[l.scrollDimension],d=Math.ceil(n)/u,AA=this.scrollBarNodes,j=AA[AB],p=this.scrollTrackNodes,q=p[AB],x=A(d,n,u),f=l.cls;if(!j){q=p[AB]=document.createElement("div");var g=this,o=function(AE){P.call(g,AE);},k=function(AE){B.call(g,AE);},w=function(AG,AE,AF){H.attachEvent(AG,AE,AF);g.installedEventListeners.push({e:AG,evt:AE,fn:AF});};w(q,"click",o);q.className="mstrmojo-scrolltrack "+f;j=AA[AB]=document.createElement("div");j.className="mstrmojo-scrollbar "+f;q.appendChild(j);m.appendChild(q);var z=mstrApp.isSingleTier?"mousewheel":"wheel";w(q,z,k);w(j,z,k);}var AD=j.style,h=(e[l.scroll]/e[l.scrollDimension]),c=H.delta(e,J.call(this))[l.position],t=q.style;if(x){t[l.styleDir]=c+r;AD[l.styleDim]=(d*n)+r;AD[l.styleDir]=(n*h)+r;}Y.toggleClass(m,l.hostCls,x);Y.toggleClass(e,l.scrollNodeCls,x);return x;}function G(){return !(mstrApp.isSingleTier&&L);}mstrmojo.ui._HasScroller=mstrmojo.provide("mstrmojo.ui._HasScroller",{_mixinName:"mstrmojo.ui._HasScroller",hasCustomScrollbar:null,draggable:true,ownAvatar:true,scrollNode:undefined,scrollbarHostNode:undefined,scrollBarNodes:undefined,setupScrollNodes:mstrmojo.emptyFn,installedEventListeners:null,init:function T(c){this._super(c);if(this.hasCustomScrollbar===null){this.hasCustomScrollbar=G();}this.installedEventListeners=[];},onRender:function I(){if(this._super){this._super();}this.updateScrollbars();this.addScrollNodeProperties();},addScrollNodeProperties:function F(){var d=this.scrollNode;if(d){var c=H.attachMarkupEvent(this.id,d,"scroll");this.installedEventListeners.push({e:d,evt:"scroll",fn:c});}if(!this.hasCustomScrollbar){Y.addClass(d,"mstrmojo-sb-show-default");return ;}if(d){Y.addClass(J.call(this),"mstrmojo-scrollbar-host");Y.addClass(d,"mstrmojo-scrollNode");}},updateScrollbars:function Z(){if(!this.hasRendered){return ;}this.setupScrollNodes();if(!this.hasCustomScrollbar){if(this.scrollNode){this.scrollNode.style.overflowX=a.call(this,"h")?"scroll":"hidden";}return ;}if(this.scrollNode){this.scrollBarNodes=this.scrollBarNodes||{};this.scrollTrackNodes=this.scrollTrackNodes||{};var c=this.scrollNode.style;c.overflowY=C.call(this,"v")?"scroll":"hidden";c.overflowX=C.call(this,"h")?"scroll":"hidden";}},onscroll:function V(){var k=this.scrollNode;if(k&&this.hasCustomScrollbar){var g=function g(l){var m=parseInt(l);return m===null||isNaN(m)?0:m;},h=H.position(k),j=h.h-g(Y.getStyleValue(k,"padding-bottom")),d=h.w-g(Y.getStyleValue(k,"padding-right")),f=this.scrollBarNodes,e=f.v,c=f.h;if(k.scrollHeight-j>0){e.style.top=((j-H.position(e).h)*(k.scrollTop/(k.scrollHeight-j)))+"px";}if(k.scrollWidth-d>0){c.style.left=((d-H.position(c).w)*(k.scrollLeft/(k.scrollWidth-d)))+"px";}}if(this._super){this._super();}if(this.onScrollEnd){this.onScrollEnd();}},getDragData:function E(d){var g=this.scrollNode,f=H.position(g),e=d.src.node,c=this.scrollBarNodes;if(this.isDraggingScrollBar(d)){return{isScrollBar:true,direction:e===c.v?"v":"h",scrollTop:g.scrollTop,scrollLeft:g.scrollLeft,conversionRatio:{y:g.scrollHeight/f.h,x:g.scrollWidth/f.w}};}return(this._super&&this._super(d));},isDragValid:function D(c){return this.isDraggingScrollBar(c)||(this._super&&this._super(c))||false;},isDraggingScrollBar:function S(d){var e=d.src.node,c=this.scrollBarNodes;return !!c&&(e===c.v||e===c.h);},ondragstart:function X(c){if(this.isDraggingScrollBar(c)){Y.addClass(c.src.node,R);Y.addClass(J.call(this),W);}if(this._super){this._super(c);}},shouldDragBubble:function Q(c){var d=c.src.node,e=this.scrollTrackNodes;return !!e&&(d===e.v||d===e.h);},ondragmove:function N(d){if(this.isDraggingScrollBar(d)){var m=d.tgt,c=d.src,n=m.pos,e=c.pos,j=c.node,h=this.scrollNode,l=this.scrollBarNodes,k=c.data,g={y:(n.y-e.y),x:(n.x-e.x)},f=k.conversionRatio;if(j===l.v){h.scrollTop=k.scrollTop+(g.y*f.y);}else{h.scrollLeft=k.scrollLeft+(g.x*f.x);}}if(this._super){this._super(d);}},ondragend:function N(c){if(this.isDraggingScrollBar(c)){Y.toggleClass(c.src.node,R,false);Y.toggleClass(J.call(this),W,false);}if(this._super){this._super(c);}},widgetResized:function M(){if(this._super){this._super();}this.updateScrollbars();},unrender:function U(c){O.forEach(this.installedEventListeners,function(d){H.detachEvent(d.e,d.evt,d.fn);});delete this.scrollNode;delete this.scrollbarHostNode;delete this.scrollBarNodes;delete this.scrollTrackNodes;this._super(c);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var J={T:["top","left"],D:["height","width"],B:["border","border-color","border-style","border-width"],F:["font","color","text-decoration"],P:["padding"],BG:["background-color","fx"],RW:[]};J.RW=["z-index"].concat(J.T.concat(J.D));var D=mstrmojo.dom,O=mstrmojo.css;function N(T,V,S){var U=T[V]||[];U.push(S);T[V]=U;}function L(W,V){var U=((W&&W.fmts)||null);if(V){var Y=W.thresholds,T=Y&&Y[V];if(T){var X={},Z;for(Z in U){X[Z]=T[Z]||U[Z];}for(Z in T){var S=T[Z];X[Z]=(typeof S==="string")?(S+" !important"):S;}U=X;}}return U;}mstrmojo._Formattable=mstrmojo.provide("mstrmojo._Formattable",{_mixinName:"mstrmojo._Formattable",formatHandlers:null,thresholdId:null,getCacheKey:function E(){return"css_cache"+(this.thresholdId||"");},update:function G(T){var S=true;this.invisible=!!(T&&T.data&&T.data.invisible);if(this._super){S=this._super(T);}return S;},buildCSSFormatString:function H(U,d){var h=this.formatHandlers[U],k=h.src?d[h.src]:d;if(!k){return null;}var b=h.props||h;if(!b){return null;}var X=[],g=-1;var V=b.length-1;for(V;V>=0;V--){var j=b[V];var c=J[j]||[j];var a=c.length-1;for(a;a>=0;a--){j=c[a];var T=k[j];if(T!==undefined){if(j==="fx"){var Y=T,S={};var e=Y.gd;if(e){this.formatGradient(e,S);}var W=parseInt(Y.rt,10);if(W){if(W===1||W===3){this.formatTextRotation(Y.rt,S);}}if(Y.ds){this.formatDropShadow(Y,S);}var Z;for(Z in S){X[++g]=Z+":"+S[Z].join(" ");}}else{X[++g]=j+":"+T;}}}}if(this.invisible){X.push("visibility:hidden");}return X.join(";")+";";},applyCSSFormatToNode:function I(U,S){var V=this[U],T=V&&V.style;if(T){this.buildCSSFormatString(U,S).split(";").forEach(function(W){var X=W.split(":");T[O.convertCssToCamelCase(X[0])]=X[1];});}},clearSlotBackgroundCSS:function F(T){var U=this[T],S=U&&U.style;if(S){S.background="transparent none 0 0 no-repeat";S.filter="none";}},preBuildRendering:function B(){this._super();var V=this.formatHandlers,S=this.getFormats();if(V&&S){var W=this.defn=this.defn||{},X=this.getCacheKey(),U=W[X];if(!U){U=W[X]={};for(var T in V){var Z=T+"CssText";this[Z]=U[Z]=this.buildCSSFormatString(T,S)||"";}}else{var Y;for(Y in U){this[Y]=U[Y];}}}return true;},formatGradient:function P(S,U){var T=O.buildGradient(S.t,S.sc,S.ec);if(T){N(U,T.n,T.v);}},formatDropShadow:function K(W,U){if(D.supports(D.cssFeatures.DROP_SHADOW)){var V=W.ds;if(D.isDXIE){N(U,"filter","progid:DXImageTransform.Microsoft.DropShadow(Color='#66000000',Positive='true',OffX="+V+",OffY="+V+")");}else{var S=[V,V],T=parseInt(W.rt,10);if(T===1||T===3){S[((T===1)?1:0)]=-V;}N(U,(D.isWK?"-webkit-":"")+"box-shadow",S.join("px ")+"px 3px 0px #888");}}},formatTextRotation:function C(T,S){if(D.supports(D.cssFeatures.TEXT_ROTATION)){if(D.isDXIE){N(S,"filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+T+")");}else{var U=(T===1)?90:-90;N(S,D.CSS3_PREFIX+"transform-origin","top left");N(S,D.CSS3_PREFIX+"transform","rotate("+U+"deg)");}}},getFormats:function R(){if(!this.fmts){this.fmts=L.call(this,this.defn,this.thresholdId);}return this.fmts;},clearFormats:function A(){this.fmts=undefined;},createEmptyFormats:function(){return(this.fmts=this.fmts||{});},clearCache:function Q(){delete this.defn[this.getCacheKey()];},unrender:function M(S){if(this.thresholdId){this.fmts=null;}this._super(S);}});mstrmojo._Formattable.getBorderWidths=function(W){var V=W.getFormats(),S=(V.border)?V.border.match(/(\d*|\d*\.\d*)pt/)[0]:V["border-width"],U=W.model,T=U.docModel;return O.getBorderWidths(S,(T&&T.dpi)||U.dpi);};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.string","mstrmojo.css");var K=mstrmojo.css,N=mstrmojo.string,H=mstrmojo.dom,L=13,C=27;function I(S){if(this._editComplete){return ;}var W,Q=false,V=this.text,T=false;if(S===C){W=V;T=true;Q=true;}if(!S||(!this.allowNewLine&&S===L)){var R=this[this.editableSlot],U=R.innerText||R.textContent||"";if(!this.allowNewLine){W=U.replace(/\n/g,"");}else{W=U;}Q=true;if(!this.allowEmptyText&&W.length===0){W=V;T=true;}}if(Q){this._editComplete=true;W=W.replace(/\u00A0/g,"\u0020");this.text=W;this.set("isEditing",false);this.onTextEditComplete(W!==V,V);delete this._editComplete;}if(T){this.refresh();}}function E(Q){var R={dblclick:"editOnDoubleClick",click:"editOnClick"};if(this[R[Q.name]]&&Q.getTarget()===this[this.editableSlot]){this.set("isEditing",true);}}function F(S,R,Q){if(typeof R["on"+Q]!=="function"){H.attachMarkupEvent(S,R,Q);}}mstrmojo._HasEditableText=mstrmojo.provide("mstrmojo._HasEditableText",{_mixinName:"mstrmojo._HasEditableText",editableSlot:"domNode",editButtonSlot:null,isEditing:false,editOnClick:true,allowEmptyText:false,allowNewLine:false,editOnDoubleClick:false,onTextEditComplete:mstrmojo.emptyFn,postBuildRendering:function A(){this._super();var S=this.editableSlot,Q=this[S],T=this[this.editButtonSlot||S];K.addClass(Q,"hasEditableText");this.text=this.text||Q.innerText||Q.textContent||"";Q.innerHTML=N.encodeHtmlString(this.text,true).replace(/ (?= )/g,"&nbsp;");var R=this.id;if(this.editOnClick){F(R,T,"click");}F(R,T,"dblclick");F(R,Q,"blur");F(R,Q,"keyup");F(R,Q,"keydown");},onclick:function P(Q){E.call(this,Q);if(this._super){this._super(Q);}},ondblclick:function G(Q){E.call(this,Q);},onblur:function M(){I.call(this);},onkeyup:function B(R){var Q=window.event||R.e;I.call(this,Q.keyCode);},onkeydown:function J(R){var Q=window.event||R.e;if(Q.keyCode===L){I.call(this,Q.keyCode);R.cancel();}},_set_text:function D(S,Q){var R=this.text;this.text=Q;if(this.hasRendered){this[this.editableSlot].innerHTML=N.encodeHtmlString(Q||"",true);}return(R!==Q);},onisEditingChange:function O(){if(this.hasRendered){var Q=this[this.editableSlot],R=!!this.isEditing;Q.contentEditable=R;Q.spellcheck=false;K.toggleClass(Q,"editable",R);if(R){Q.focus();H.setElementSelection(Q);}else{Q.blur();Q.scrollLeft=0;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.expr","mstrmojo.css");var G=mstrmojo.array,F=mstrmojo.expr,H=mstrmojo.css;mstrmojo._IsExprNode=mstrmojo.provide("mstrmojo._IsExprNode",{ind:function B(){var L=this.parent;if(L&&L.indent){var K=this.childIndex();K=(K>-1&&(K>0))?[K,K-1]:null;if(K){L.indent(K);}}},out:function D(){var L=this.parent;if(L&&L.outdent){var K=this.childIndex();K=(K>-1&&(K>0))?[K,K-1]:null;if(K){L.outdent(K);}}},andOrTxt:function A(){var M=this.parent,K=M&&M.data,L="",N=this.data;if(K&&(K.et===F.ET.ANDOR)&&K.fn){L=K.fn+(N&&N.not?"_"+F.FN.NOT:"");L=F.BRANCH_FNS[L];}return'<span class="mstrmojo-text mstrmojo-andor">'+L+"</span>";},getPrefixAndOrToolsMarkup:function(){return('<span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()" mstrAttach:mouseover,mouseout>'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()" mstrAttach:mouseover,mouseout>'+mstrmojo.desc(5896,"Ungroup Conditions")+"</span>");},premousedown:function J(K){var L=mstrmojo.dom.eventTarget(K.hWin,K.e);if(this.prefixHoverNode&&mstrmojo.dom.contains(this.prefixHoverNode,L,false)){mstrmojo.dom.stopPropogation(K.hWin,K.e);return ;}if(this._super){this._super(K);}},isSelectableArea:function E(K){return true;},childIndex:function I(){var M=this.parent,K=M&&M.data,L=K&&K.nds,N=this.data;if(L&&N){return G.indexOf(L,N);}return -1;},toggleGroupBorder:function C(K){H.toggleClass(this.parent.itemsContainerNode.childNodes[this.childIndex()-1].firstChild,"upgroup",K);H.toggleClass(this.domNode,"downgroup",K);}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.num","mstrmojo.string");mstrmojo.validation={STATUSCODE:{UNKNOWN:-1,VALID:0,INVALID:1,INVALID_EMPTY:2,INVALID_CHAR:3,INVALID_OUTOFRANGE:4,INVALID_REGEX:5,INVALID_VALIDATOR:6,INVALID_BAD_NUMERICFORMAT:7,INVALID_BAD_DATESTRING:8},TRIGGER:{NONE:0,ONBLUR:1,ONKEYUP:2,VALUESET:4,ALL:7},REGEXP:{US_ZIP:/^\d{5}([\- ]?\d{4})?$/,EMAIL_ADDRESS:/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+[\.])+([a-zA-Z0-9]{2,4})+$/,SOCIAL_SECURITY_NUMBER:/^((?!000)(?!666)\d{3})(\s|\-)?((?!00)\d{2})\2((?!0000)\d{4})$/,PHONE_NUMBER:/^(?!-)[ \d\-\(\)\.\+]+$/,FILE_NAME:new RegExp('^[^:*?"<>|/\\\\()]+$'),FOLDER_PATH_WIN:new RegExp('^([a-zA-Z]:|\\\\\\\\[^:*?"<>|/\\\\]+|[^:*?"<>|/\\\\]*)(\\\\[^:*?"<>|/\\\\]+)*(\\\\){0,1}$'),FOLDER_PATH_UNIX:new RegExp('^(/){0,1}([^:*?"<>|/\\\\]+/)*([^:*?"<>|/\\\\]+){0,1}$'),PRINTER_PATH_SINGLE:new RegExp('^[^$%:*?"<>|/\\\\]*$'),PRINTER_PATH_MULTIPLE:new RegExp('^((/|\\\\\\\\)[^$%:*?"<>|/\\\\]+)((/|\\\\)[^$%:*?"<>|/\\\\]+)*(/|\\\\){0,1}$')}};var H=mstrmojo.validation,B=H.TRIGGER,b=H.STATUSCODE,A={"-1":-1,1:1,2:1,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:4,12:4,13:4,14:6,15:6,16:6,17:3,18:3,21:2,22:2,23:3,24:4,25:3,30:5,34:5};H.VALIDATOR={DEMO:function N(e){var d=parseInt(e,10),f=mstrmojo.validation.STATUSCODE;if(d===0||d===1||d>10){return{code:f.VALID};}return{code:f.INVALID,msg:"This field must be either 0, 1 or greater than 10"};},VALIDATE_PHONENO:function I(d){var e=String(d).replace(/[^\d]/g,"");if(e.length<10){return{code:b.INVALID,msg:mstrmojo.desc(9203,"A telephone number must contain at least 10 digits.")};}if(!H.REGEXP.PHONE_NUMBER.test(d)){return{code:b.INVALID,msg:mstrmojo.desc(9204,"The telephone number contains invalid characters.")};}return{code:b.VALID};},VALIDATE_ZIPCODE:function G(d){var f="",e=this.dtp;if(!H.REGEXP.US_ZIP.test(d)){if(H.isNumeric(e)||H.isInt(e)){f=mstrmojo.desc(9208,"A zip code must be 5 digits or 5+4 digits.");}else{if(H.isString(e)){f=mstrmojo.desc(9206,"The zip code is invalid");}}return{code:b.INVALID,msg:f};}return{code:b.VALID};},VALIDATE_EMAIL:function T(d){var e=d.indexOf("@");if(e===-1){return{code:b.INVALID,msg:mstrmojo.desc(9197,"The email address is missing an at sign (@).")};}if(d.substring(e).indexOf(".")===-1){return{code:b.INVALID,msg:mstrmojo.desc(9198,"The email address is missing a period on the domain.")};}return H.REGEXP.EMAIL_ADDRESS.test(d)?{code:b.VALID}:{code:b.INVALID,msg:mstrmojo.desc(9207,"The email address is invalid.")};},VALIDATE_SSN:function Q(d){var f=this.dtp,e;if(H.isNumeric(f)||H.isInt(f)){e=String(d).replace(/[^\d]/g,"");if(e.length!==9){return{code:b.INVALID,msg:mstrmojo.desc(9209,"A Social Security Number must be 9 digits.")};}}if(!H.REGEXP.SOCIAL_SECURITY_NUMBER.test(d)){return{code:b.INVALID,msg:mstrmojo.desc(9210,"The Social Security Number is invalid.")};}return{code:b.VALID};}};H.isInt=function D(d){return A[d]===1;};H.isNumeric=function Y(d){return A[d]===2||A[d]===5;};H.isString=function J(d){return A[d]===3;};var C=window.mstrConfig,L=C.listSep,S=mstrmojo.expr,M=S.DTP,Z=mstrmojo.num,U=mstrmojo.string,F=mstrmojo.date;function P(l,m){var h=l.dtp,k=l.constraints,o=k.allowedFormatChars||"",g=(A[h]===1),d=(A[h]===2),e=(A[h]===6),n=mstrmojo.locales.number.THOUSANDSEPARATOR,f=mstrmojo.locales.number.DECIMALSEPARATOR,j;if(g){if(!l._intRegExp){o+="0-9-"+(l.isList?L:"")+n;l._intRegExp=new RegExp("[^"+o+"]");}j=l._intRegExp;}if(d){if(!l._numericRegExp){o+="0-9-"+(l.isList?L:"")+f+n;l._numericRegExp=new RegExp("[^"+o+"]");}j=l._numericRegExp;}return !!j&&j.test(m);}function c(l,n){var h=l.dtp,k=l.constraints,g=(A[h]===1),d=(A[h]===2),e=(A[h]===6),f=k.min,m=k.max,j;if(f===undefined&&m===undefined){return false;}if(g||d){return Z.inNumericRange(n,f,m)!==0;}if(e){return F.inDateTimeRange(n,f,m)!==0;}return false;}function K(e,d){return !Z.isNumeric(d);}function R(g,e){var f=(g.dtp===M.DATE),d=(g.dtp===M.TIME);return(f?!F.isDate(e):(d?!F.isTime(e):!F.isDateAndOrTime(e)));}mstrmojo._CanValidate=mstrmojo.provide("mstrmojo._CanValidate",{constraints:null,required:false,dtp:M.INTEGER,isList:false,autoFormat:false,validationStatus:null,init:function W(d){this._super(d);if(!this.constraints){this.constraints={};}var e=this.constraints;if(!e.hasOwnProperty("trigger")){e.trigger=B.NONE;}},_set_value:function(j,f){var g=this.value,e=(g!==f);if(e){this.value=f;var h=this.constraints.trigger,d=(h&B.VALUESET)>0;if(d){this.validate(f);}}return e;},validate:function O(){var f=(this.value!==null&&this.value!==undefined)?this.value:"",j=this.isList?f.split(L):[f],h,e,k,d=j.length,g;for(g=0;g<d;g++){h=this.doValidation(j[g]);e=(h.code>b.VALID);if(e){if(d>1){h.msg=mstrmojo.locales.validation.invalidValueInListError.replace("#",j[g]||" ");}break;}}k=e?"onInvalid":"onValid";if(!e&&this.autoFormat){this.format();}this.set("validationStatus",h);if(this[k]){this[k](h);}},format:function X(){var j=this.dtp,f=(A[j]===6);if(!f){return ;}var l=mstrConfig.listSep,o=this.value||"",e=this.isList?o.split(l):[o],n=j===14,m=[],d,g=mstrmojo.locales.datetime,k=e.length,h;for(h=0;h<k;h++){o=e[h];d=F.parseDateAndOrTime(o);if(d){if(n&&d.date){m.push(F.formatDateInfo(d.date,g.DATEOUTPUTFORMAT));}else{m.push((d.date?F.formatDateInfo(d.date,g.DATEOUTPUTFORMAT):"")+" "+(d.time?F.formatTimeInfo(d.time,g.TIMEOUTPUTFORMAT):""));}}}this.set("value",m.join(l));},isValid:function V(){var d=this.validationStatus;if(!d){this.validate();}return this.validationStatus.code===b.VALID;},clearValidation:function a(){this.set("validationStatus",{code:b.VALID});if(this.onClearValidation){this.onClearValidation();}},doValidation:function E(q){var n=this.constraints,o=n.regExp,f=n.validator,d={id:this.id,code:b.VALID,msg:""},m=this.dtp,l=(A[m]===1),e=(A[m]===2||A[m]===5),g=(A[m]===3),h=(A[m]===6),k=U.isEmpty(q),p=String(q).length,j="",u=mstrmojo.locales.validation;if(this.required&&k){d.code=b.INVALID_EMPTY;d.msg=u.requiredFieldError;return d;}q=U.trim(q);if(!k&&P(this,q)){if(l){j=u.integerDataType;}if(e){j=u.numericDataType;}if(h){j=u.dateDataType;}d.code=b.INVALID_CHAR;d.msg=u.invalidCharError.replace("#",j);return d;}if(!k&&h&&R(this,q)){d.code=b.INVALID_BAD_DATESTRING;d.msg=u.invalidDateStringError;return d;}if(!k&&(e||l)&&K(this,q)){d.code=b.INVALID_BAD_NUMERICFORMAT;d.msg=u.invalidNumericFormatError;return d;}if(!k&&(l||e||h)&&c(this,q)){d.code=b.INVALID_OUTOFRANGE;if(n.min!==null&&n.max!==null){j=u.outofRangeError.replace("# ","").replace("##",n.min).replace("###",n.max);}else{if(n.min!==null){j=u.noLessMinError.replace("##",n.min).replace("# ","");}else{if(n.max!==null){j=u.noGreaterMaxError.replace("###",n.max).replace("# ","");}}}d.msg=j;return d;}if(g&&n.minLen!==null&&n.maxLen!==null){if(p<n.minLen||p>n.maxLen){d.code=b.INVALID;d.msg=mstrmojo.desc(9211).replace(/#/,n.minLen).replace(/##/,n.maxLen);return d;}}if(o&&!o.test(q)){d.code=b.INVALID_REGEX;d.msg=mstrmojo.desc(9205);return d;}var t=f&&f.apply(this,[q]);if(t){d.code=t.code;d.msg=t.msg;return d;}return d;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var D=1,B="mstrmojo-itemwrap";mstrmojo.ListMapperHoriz=mstrmojo.provide("mstrmojo.ListMapperHoriz",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table" cellspacing="0" cellpadding="0"><tbody><tr>',markupSuffix:"</tr></tbody></table>",itemWrapperPrefix:function(H){return'<td class="'+this.getWrapperCss(H)+'">';},getWrapperCss:function(H){return"mstrmojo-itemwrap-td";},itemWrapperPrefill:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",itemWrapperSuffix:"</td>",wrapperNodes:function G(H){return this.wrapperParentNode(H).cells;},wrapperParentNode:function F(H){return H.firstChild.rows[0];},createWrapperNode:function E(H){var I=H.ownerDocument,J=I.createElement("td");return J;},findScrollRange:function C(U,L,S,X,I,P,Y,W){var Q=this.wrapperNodes(U),R=parseInt(L/2,10),K=parseInt(Math.log(L)/Math.log(2),10),J=0,H=L-1,T=I+P,M=Q[0].offsetLeft,O;for(var V=1;V<=K;V++){O=Q[R].offsetLeft-M+Y;if(O<=I){J=R;}else{if(O>=T){H=R;}}var N=Math.round(L/Math.pow(2,V+1));R+=(O>I)?-N:N;R=Math.min(Math.max(0,R),L-1);}return{start:J,end:H};},findIndex:function A(I,M,K){if(M&&K){var H=I.domNode,L=this.wrapperParentNode(M),J=K.parentNode;while(J){if(J===L){return mstrmojo.array.findBin(this.wrapperNodes(M),K,"offsetLeft",I.items&&I.items.length);}else{if(J===H){break;}}K=J;J=K.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.WidgetListBuilder");mstrmojo.WidgetTreeBuilder=mstrmojo.provide("mstrmojo.WidgetTreeBuilder",mstrmojo.mixin({newContext:function A(B){var D=this._super(B);if(!B.itemFunction&&D.itemFunc){var C=D.itemFunc;D.itemFunc=function(G,F,H){var E=C(G,F,H);if(E){E.tree=H.tree||H;}return E;};}return D;}},mstrmojo.hash.copy(mstrmojo.WidgetListBuilder)));})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");mstrmojo.requiresDescs(889,7405,11163,12369);var V=mstrmojo.hash,M=mstrmojo.desc;var u=M(889,"Please wait...");function K(AG,AF,AE){var AC=AF.showWait,AD=AF.suppressError,AB=AF.waitMsg;delete AF.showWait;delete AF.suppressError;delete AF.waitMsg;mstrApp.serverRequest(AF,AG,AC,AD,AB,undefined,undefined,AE);}mstrmojo.qb.DataService=mstrmojo.provide("mstrmojo.qb.DataService",{submitRequest:function t(AC,AB){K.call(this,AC,AB);},pollingStatus:function Z(AI,AC,AF,AG){var AE=this;if(mstrApp.isSingleTier){if(AI.success){AI.success(AC);}return ;}K.call(AE,{success:function AH(AJ){if(AJ.status==="1"){if(AI.success){AI.success(AC);}}else{AE.pollingStatus(AI,AC,AF);}},failure:function AD(AJ){if(AI.failure){AI.failure(AJ);}},canceled:function AB(AJ){if(AI.canceled){AI.canceled(AJ,AC);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:AF},AG);},prepareDataPollStatus:function J(AG,AJ,AI,AF){var AD=this,AE="pollStatus";if(mstrApp.isSingleTier){AE="DIPollStatus";}K.call(AD,{success:function AH(AK){if(AK.status==="1"||AK.status===1){if(AG.success){AG.success(AJ);}}else{AD.prepareDataPollStatus(AG,AJ,AI,AF);}},failure:function AB(AK){if(AG.failure){AG.failure(AK);}},canceled:function AC(AK){if(AG.canceled){AG.canceled(AK,AJ);}}},{taskId:AE,resultSetType:3,pollingFrequency:500,threadId:AJ.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:AI},AF);},search:function x(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"arch.search",showWait:true}));},searchFolderContents:function A(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:u});},createReportInstance:function W(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.CreateQBReportInstance",showWait:true,suppressError:true}));},createEmmaInstance:function B(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:u}));},createEmmaTable:function p(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"DICreateEMMASourceTable",showWait:true,waitMsg:u}));},changeMapping:function q(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.RemapObject",showWait:true,waitMsg:u}));},buildRelations:function Y(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"DIDetectRelationshipEMMASourceTable",showWait:true,waitMsg:u}));},setDBRole:function l(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.SetDBRole",showWait:false}));},getShapeKeys:function AA(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"getMapShapes",showWait:false}));},addTable:function e(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.AddTable",showWait:true,waitMsg:u}));},removeTable:function T(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.RemoveTable",showWait:true,waitMsg:u}));},editTable:function G(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.EditTable",showWait:true}));},addColumn:function f(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.AddSelectedColumn",showWait:true}));},addSelectedColumns:function O(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.AddMultiSelectedColumns",showWait:true}));},editColumn:function P(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.EditSelectedColumn",showWait:true}));},removeColumn:function H(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.RemoveSelectedColumn",showWait:true}));},addJoin:function a(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.AddJoin",showWait:true}));},removeJoin:function r(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.RemoveSelectedJoin",showWait:true}));},editJoin:function j(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.EditJoin",showWait:true}));},autoJoin:function U(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.GenerateJoins",showWait:true}));},editCondition:function D(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"qBuilder.EditCondition",showWait:true}));},remapObject:function N(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.RemapObject",showWait:true}));},updateTableStructure:function F(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.UpdateWHTable",showWait:true}));},parse:function Q(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.Parse",showWait:true}));},getReportDefinition:function n(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.GetReportXDADefinition",showWait:true}));},saveReport:function C(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.SaveReportXDADefinition",showWait:true,suppressError:true,waitMsg:mstrmojo.desc(7405,"Saving changes...")}));},getSystemFunctions:function o(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"getSystemFunctions",showWait:false,suppressError:true}));},convertToQB:function I(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.ConvertToQueryBuilder",showWait:true}));},convertToFFSQL:function g(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.ConvertToFreeFormSQL",showWait:true}));},editFFSQL:function k(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.EditFreeFormSQL",showWait:true}));},catalogAction:function z(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"arch.catalogAction",showWait:true}));},getDocumentAttributes:function h(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"getDocumentAttributes",showWait:true}));},autoClosePrompt:function L(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.AutoClosePrompt",showWait:true}));},publishCube:function S(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.PublishCube",showWait:true,suppressError:true,waitMsg:mstrmojo.desc(11163,"Publishing...")}));},getAttributeForms:function m(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"getAttributeForms"}));},searchMetadata:function E(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"searchMetadata"}));},getFunctionDetails:function w(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"getSystemFunctions"}));},signOutOAuthSource:function c(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.FetchSourceObjects",flags:8,showWait:true,waitMsg:M(12369,"Signing out...")}));},removeEmmaTable:function X(AE,AD){var AB=this;K.call(AB,{success:function AC(AF){mstrApp.msgid=AF.msgid;AB.pollingStatus(AE,AF,u);}},V.copy(AD,{taskId:"DIRemoveEMMASourceTable",showWait:true,waitMsg:u}));},removeOrDuplicateRI:function b(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"qBuilder.RemoveOrDuplicateRI",showWait:true}));},prepareData:function d(AJ,AD,AE,AG,AC){var AB=AC||M(13196,"Prepare data ## of ### tables...").replace("##",AE).replace("###",AG);var AF=this,AH={showCancel:true};K.call(AF,{success:function AI(AK){AF.prepareDataPollStatus(AJ,AK,AB,AH);},canceled:function(AK){if(AJ.canceled){AJ.canceled(AK);}}},V.copy(AD,{taskId:"DIDataPreparation",showWait:true,waitMsg:AB}),AH);},killJob:function R(AC,AB){K.call(this,AC,V.copy(AB,{taskId:"DIKillJob",showWait:true,suppressError:true,waitMsg:u}));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var I=mstrmojo.array,E=mstrmojo.hash,N=mstrmojo.func.wrapMethods;function M(T){var R=[],O=mstrApp.getRootController().model.dbObjectsDisplayOptions,P=mstrApp.getRootController().model.dbObjectsConnectionType,S=this,Q=this.dbmsTypeFilter;I.forEach(T,function(U){if((U.disp&O)===O&&(Q.length===0||I.indexOf(Q,U.dbType)>-1)){if((U.connType&4)===4){R.push(U);}else{if((U.connType&P)===P){R.push(U);}}}});if(!S.dbVersion2dbId){S.dbVersion2dbId={};I.forEach(R,function(U){I.forEach(U.dbVersions,function(V){S.dbVersion2dbId[V.v]=U.id;});});}this.dsnMapDBs=T;this.supportedDBs=R;}function C(){var O=this;E.forEach(O.dbTypes,function(P){if(P.catSQL===1){O.catalogDbTypes.push(P);}});}function B(O){O=O.sort(function(Q,P){return Q.n.toLowerCase().localeCompare(P.n.toLowerCase());});O.unshift({n:mstrmojo.desc(8526,"select a dsn"),nU:mstrmojo.desc(8526,"select a dsn").toUpperCase(),des:0});return O;}function F(O){O=O.sort(function(Q,P){return Q.n.toLowerCase().localeCompare(P.n.toLowerCase());});return O;}function A(R){if(!(R.DBInfo&&R.DBInfo.Preferences)){return R;}var P,Q=JSON.stringify(R),S,O=R.DBInfo.Preferences.driverNameSuffix;if(mstrApp.isSingleTier){if(navigator.platform.indexOf("Win")===-1){P=I.find(O,"n","DesktopMac");}else{P=I.find(O,"n","DesktopWin");}}else{P=I.find(O,"n","Platform");}S=O[P];return JSON.parse(Q.replace(/!#DRIVERSUFFIX#!/g,S.value));}function L(P){var O=this;if(O.loaded){P.success();}else{if(this.dbmsTypeFilter.length>0){this.dbmsTypeFilter.push(1100);}mstrApp.getRootController().model.submitRequest(N({success:function(R){R=A(R);var Q=(R.DBMS.dbmss.dbms?[].concat(R.DBMS.dbmss.dbms):[]);O.dbms=Q;O.dbms.sort(function(T,S){var V=T.db_ver;var U=S.db_ver;if(V<U){return 1;}if(V>U){return -1;}return 0;});O.dsndbms=Q.sort(function(T,S){return T.n.toLowerCase().localeCompare(S.n.toLowerCase());});M.call(O,R.DBInfo.DBS);O.dbVersions=R.DBInfo.dbVersions;O.dbTypes=R.DBInfo.dbTypes;C.call(O);O.dbIDs=R.DBInfo.dbIDs;O.drivers=F(R.Drivers.Drivers);O.preferences=R.DBInfo.Preferences;O.dsns=B(R.DSNs.Dsns);O.loaded=true;}},P),{taskId:"arch.getDBObjects",skipSchemaIDCheck:true,showWait:true,typeFilter:this.dbmsTypeFilter,versionFilter:this.dbmsVersionFilter,typeExcludeFilter:O.dbmsTypeExcludeFilter.join(","),versionExcludeFilter:O.dbmsVersionExcludeFilter.join(","),flags:15});}}function D(O,Q){var P=this;mstrApp.getRootController().model.submitRequest(N({success:function(R){R=A(R);if(R.DBInfo){M.call(P,R.DBInfo.DBS);P.dbVersions=R.DBInfo.dbVersions;P.dbTypes=R.DBInfo.dbTypes;C.call(P);P.dbIDs=R.DBInfo.dbIDs;P.preferences=R.DBInfo.Preferences;}if(R.Drivers){P.drivers=F(R.Drivers.Drivers);}if(R.DSNs){P.dsns=B(R.DSNs.Dsns);}}},Q),{taskId:"arch.getDBObjects",skipSchemaIDCheck:true,showWait:true,flags:O});}mstrmojo.warehouse.obj.DBObjects=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.obj.DBObjects",dbms:[],dsndbms:[],supportedDBs:[],dsnMapDBs:[],drivers:[],dsns:[],dbVersions:undefined,dbTypes:undefined,catalogDbTypes:[],dbIDs:undefined,preferences:undefined,dbmsTypeFilter:[],dbmsVersionFilter:[],dbmsTypeExcludeFilter:[],dbmsVersionExcludeFilter:[],DBInfo:undefined,DBS:undefined,DSNs:undefined,Dsns:undefined,Preferences:undefined,Drivers:undefined,DBMS:undefined,dbmss:undefined,disp:undefined,dbVersion2dbId:undefined,load:function K(P,O,Q){this.dbmsTypeFilter=P;this.dbmsVersionFilter=O;L.call(this,Q);},populateDBProperties:function J(O){if(this.supportedDBs.length>0){O.success();}else{D.call(this,8,O);}},reloadDrivers:function G(O){D.call(this,2,O);},reloadDSNs:function H(O){D.call(this,4,O);},loaded:false});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.Obj","mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.architect.EnumColumnDataTypes");var S=mstrmojo.func.wrapMethods,J=mstrmojo.hash,O=mstrmojo.array,G=mstrmojo.string,T=26,L=15,Q=mstrmojo.desc(11428,"[unknown]"),B=mstrmojo.architect.EnumColumnDataTypes,I=mstrmojo.warehouse.EnumDataChangeEvents,H=I.DBTABLES_CHANGED;function E(W){var V,X=W.tp;V=(X===undefined?W:B[X].n);return("["+(V||Q)+"]");}function F(V){return G.decodeHtmlString(V).replace(/&apos;/g,"'");}mstrmojo.qb.bigquery._hasBigQueryModel=mstrmojo.provide("mstrmojo.qb.bigquery._hasBigQueryModel",{projects:[],datasets:[],warehouseTables:{},selectedProject:undefined,selectedDataset:undefined,getColDataType:function M(W){var V=W.dt.tp;return V===undefined?W.dt:V;},loadDBRoles:function A(W){var V=this;mstrApp.getRootController().getDataService().submitRequest(S({success:function(Z){var Y=Z.mi.gbqht.gbqp,a=[],X;if(!Y){Y=[];}if(!(Y instanceof Array)){Y=[Y];}O.forEach(Y,function(c){X=c.n||c.id;a.push(J.copy({did:String(c.id),n:X,des:X,tp:29,isPrimary:function b(){return this.data.isPrimary;},data:{isPrimary:false}},c));});V.set("projects",a);V.raiseEvent({name:I.DBROLES_LOADED,items:a});}},W),{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,flags:64});},_set_selectedProject:function R(X,V){var W=this;this.selectedProject=V;this.selectedDataset=undefined;this.SelDBRoleID=undefined;this.set("SelDBRoleID",mstrApp.dbroleID);O.forEach(W.projects,function(Y){if(Y.data.isPrimary){Y.data.isPrimary=false;W.raiseEvent({name:I.DBROLE_CHANGED,item:Y});}if(Y.did==V){Y.data.isPrimary=true;W.raiseEvent({name:I.DBROLE_CHANGED,item:Y});}});this.getDatasets();},getAccountInfo:function U(W,V,X){mstrApp.getRootController().getDataService().submitRequest({success:function(Y){X&&X(Y);}},{taskId:"qBuilder.FetchSourceObjects",sourceAccountID:W,dbRoleID:V,flags:2,showWait:true});},getProject:function N(W){var V=null;O.forEach(this.projects,function(X){if(W===X.id){V=X;return false;}});return V;},getDatasets:function C(){var W=this,V=W.selectedProject;W.raiseEvent({name:H,items:[],selectedItems:[]});W.raiseEvent({name:I.NAMESPACES_REQUESTED});mstrApp.getRootController().getDataService().submitRequest({success:function(Y){var Z=Y.mi.gbqht.gbqp.gbqd,X=[];if(!Z){Z=[];}if(!(Z instanceof Array)){X.push({n:Z.id||""});}else{O.forEach(Z,function(a){X.push({n:a.id});});}W.datasets=X;W.raiseEvent({name:I.NAMESPACES_CHANGED,namespaces:X,usecCache:X.length,dbRoleID:V});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:V,flags:64,showWait:true});},onselectedDatasetChange:function K(V){this.selectedDataset=V.value;this.getDatasetTables({blockBegin:0,blockCount:1000,filterText:""});},getDatasetTables:function D(Z,c){var a=this,f=a.selectedProject,d=a.selectedDataset,Y=Z.filterText,e,W=false,b=[],V=[],X;X=a.warehouseTables[f]=a.warehouseTables[f]||{};if(!a.catalogRefresh&&d&&(X[d]!==undefined)){J.forEach(X[d],function(j,h){W=true;e={id:j.id,n:h,did:h,dbtn:h,st:8405,tag:j,ns:j.ns,tp:L,isVisible:function g(){},items:[]};if(Y!==""&&h.toUpperCase().indexOf(Y.toUpperCase())>-1){b.push(e);}V.push(e);});if(W){a.raiseEvent({name:H,items:(Y!=="")?b:V,selectedItems:[]});return ;}}a.raiseEvent({name:I.DBTABLES_REQUESTED,sourceInfo:Z.sourceInfo||""});mstrApp.getRootController().getDataService().submitRequest({success:function(k){var m=k.mi.gbqht.gbqp.gbqd,j=m&&m.gbqt,h=[],g,l;a.catalogRefresh=false;a.selectedDataset=d=m.id;l=X[d]={};if(!j){j=[];}if(!(j instanceof Array)){j=[j];}O.forEach(j,function(n){g=n.id;e={n:g,id:g,ns:f+":"+d,did:g,dbtn:g,st:8405,tag:n,tp:L,isVisible:function(p,o){return a.handleVisibleAction(p,o);},isChecked:function(p,o){return a.handleCheckAction(p,o);},isEnabled:function(p,o){return a.handleEnabledAction(p,o);},items:[]};l[g]=e;h.push(e);});a.raiseEvent({name:H,items:h,selectedItems:[]});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:f,dsid:d,flags:64,showWait:true});},getColumnsForDBTable:function P(W,a){var Z=this,f=Z.selectedProject,X=W.getFresh,Y=W.data,e=Y.datasetID||Z.selectedDataset,b=Y.did,c=Y.n,V;if(!X){V=Z.warehouseTables[f]&&Z.warehouseTables[f][e][b].columns;if(V){a.success({src:W,items:V,selDBRole:e});Z.raiseEvent({name:"dbTablesPopulated",items:{id:b,n:c,items:V}});if(a&&a.complete){a.complete();}return ;}}mstrApp.getRootController().getDataService().submitRequest(S({success:function d(j){var h=j.mi.gbqcs.gbqc,g=[],k;O.forEach(h,function(m){k=F(m.id);g.push({n:k+": "+E(m.dt),cln:m.id,dt:m.dt,id:m.id,did:k,st:26,tp:T,isVisible:function l(){}});});if((g.length>0)&&!X){Z.warehouseTables[f][e][b].columns=g;}j.items=g;}},a),{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:f,dsid:e,tbid:b,flags:1,showWait:false});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumObjectTypes");var B=mstrmojo,C=B.hash,F=B.array,G=mstrmojo.warehouse.EnumObjectTypes;function D(K,L){var M=[];F.forEach(K,function(N){if(N.tp===L){M.push(N);}});return M.sort(function(O,N){return(O.n<N.n)?-1:(O.n>N.n)?1:0;});}mstrmojo.warehouse.obj.TableData=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.TableData",init:function I(N){var M=N.model,L=function(Q,P){return M.handleVisibleAction(Q,P);},K=function(Q,P){return M.handleCheckAction(Q,P);},O=function(Q,P){return M.handleEnabledAction(Q,P);};this.did=N.id;this.n=N.n;this.items=[];this.isVisible=L;this.isChecked=K;this.isEnabled=O;this.tp=N.tp;this.model=M;this.multi=N.multi;this.isLeaf=N.isLeaf;this.bold=N.bold;this.dbrole=N.dbrole;this.ns=N.ns||"";this.isError=N.isError;this.ttp=N.ttp||"";this.sta=N.sta||0;this.isLocked=N.isLocked;this.size=N.size;this.dbtn=N.dbtn||N.n;this.isView=N.isView;this.icntp=N.icntp;},model:undefined,multi:false,did:undefined,n:undefined,items:undefined,isVisible:undefined,isEnabled:undefined,isChecked:undefined,isLocked:false,size:0,isLeaf:false,bold:false,dbrole:undefined,tp:undefined,x:undefined,y:undefined,w:undefined,h:undefined,isError:false,ttp:"",sta:0,dbtn:undefined,ns:"",italics:false,addItem:function H(L,K,Q,R,T,N,P,O){var M=this,S={pdid:M.did,did:L,n:K,tp:Q,bfIdx:R,isVisible:M.isVisible,isChecked:M.isChecked,items:[],ttp:T,isLeaf:N,bold:P,unused:O};M.items.push(S);return S;},addSubItem:function J(Q,L,K,P,R,S,U,N,O){var M=this,T={pdid:M.did,did:L,sid:Q,n:K,tp:P,bfIdx:R,fcatId:S,isVisible:M.isVisible,isChecked:M.isChecked,ttp:U,isLeaf:N,bold:O};C.forEach(M.items,function(V){if(V.did===Q){V.items.push(T);return false;}return true;});return T;},addSubItemItem:function A(P,R,L,K,Q,S,T,V,N,O){var M=this,U={pdid:M.did,did:L,sid:P,n:K,tp:Q,bfIdx:S,fcatId:T,isVisible:M.isVisible,isChecked:M.isChecked,ttp:V,isLeaf:N,bold:O};C.forEach(M.items,function(W){if(W.did===P){C.forEach(W.items,function(X){if(X.did===R){X.items=X.items||[];X.items.push(U);return false;}return true;});return false;}return true;});return U;},sortElements:function E(){var M=this,K=M.items,L=[];M.items=L.concat(D(K,G.ATTRIBUTE),D(K,G.FACT),D(K,G.COLUMN));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B={TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};mstrmojo.ui.PopupConfig=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ui.PopupConfig",ENUM_CORNERS:B,isHostedWithin:true,position:null,hostProxyCssClass:"",hostId:"",hostElement:null,anchorElement:null,popupHandlers:null,alignment:null,alignWithAnchor:false,useTooltip:false,init:function E(F){this.clear();this._super(F);},setAlignment:function C(F,G){this.alignment={host:F,popup:G};},addPopupHandlers:function D(F,H,G){this.popupHandlers[F]={open:H,close:G};},clear:function A(){this.popupHandlers={};var F=this.ENUM_CORNERS;this.alignment={host:F.BOTTOM_LEFT,popup:F.TOP_LEFT};}});mstrmojo.ui.PopupConfig.ENUM_CORNERS=B;}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.Obj");var K=mstrmojo.hash;var P=0;var F=[];var J={};var L=false;function I(T){var U=T.callback;if(U.submission){U.submission(T.id,this.userInteractionRequired(T),T);}this.submitRequest(T);}function G(){if(F.length&&!L){I.call(this,F.shift());}}mstrmojo.ServerProxy=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ServerProxy",transport:null,cnt:0,request:function E(d,a,U,V){if(U){this.cancelRequests();}var X=this.id,Y=this.transport,T=mstrmojo.now()+a.taskId+P++,W=d.canceled||mstrmojo.emptyFn;d.canceled=function(e){W();d.complete(true);return Y.cancelRequest(e);};d=mstrmojo.func.wrapMethods(d,{complete:function(e){mstrmojo.all[X].deleteRequest(e);}});var Z=!K.isEmpty(this._requests),b=this.createRequest(T,d,a,V),c=(L||Z)&&!V.doNotHold;if(c){F.push(b);}else{I.call(this,b);}return T;},hasRequests:function O(){return !K.isEmpty(this._requests)||L;},createRequest:function Q(V,X,W,T){var U=this._requests;if(!U){U=this._requests={};}U[V]={id:V,callback:X,params:W,config:T};return U[V];},submitRequest:function M(T){this.transport.serverRequest(this.id,T.id,T);},cancelRequests:function S(){var T=false;K.forEach(this._requests,function(U){if(U.gotResponse===undefined){T|=U.callback.canceled(U.id);}});this._requests={};F=[];return T;},cancelRequest:function B(X){var U=false,W=this._requests[X],V,T=F.length;for(V=0;V<T;V++){if(F[V]===W){break;}}if(V<T){F.splice(V,1);delete this._requests[X];U|=W.callback.canceled(W.id);}return U;},response:function A(X,T,V){$MAPF(false,"AndroidServerTransport","transportRequest");var W=this.getRequest(X);if(W){W.gotResponse=true;var Y=W.callback,U=(T&&!V.mstrerr)?"success":"failure";try{if(Y[U]){Y[U](V,W);}}finally{Y.complete(X);}}G.call(this);},deleteRequest:function N(U){var T=this._requests;delete T[U];},getRequest:function H(U){var T=this._requests;return T&&T[U];},userInteractionRequired:function C(T){return false;},addLoadingGraph:function D(T){J[T]=true;L=true;},removeLoadingGraph:function R(T){delete J[T];if(K.isEmpty(J)){L=false;G.call(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.locales","mstrmojo.date");mstrmojo.requiresDescs(2052,2170,2265,3434,3544,4530,4699,8002,8984,9614,9919,9920,9921,9922,12491,12492,12493,12494,12495,12509,12771,13031,13131,13132);var J=mstrmojo.DI.DIConstants,E=mstrmojo.dom,F=mstrmojo.array;mstrmojo.DI.DIHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIHelpers.isIE7=function B(){return mstrmojo.dom.isIE7;};mstrmojo.DI.DIHelpers.isIE=function(){return E.isIE||!!E.userAgent.match(/Trident\/7\.0/);};mstrmojo.DI.DIHelpers.getURLCaption=function(){var K="";if(mstrApp.diParams&&mstrApp.diParams.EnableURLImport){if(mstrApp.diParams.EnableFileImport){if(mstrApp.isSingleTier){if(window.FormWrapper!==window.client){K+="File://";}}else{K+="File://";}}if(mstrApp.diParams.EnableHttpImport){if(K!==""){K+=", ";}K+="Http://, Https://";}if(mstrApp.diParams.EnableFTPImport){if(K!==""){K+=", ";}K+="Ftp://";}}return K;};mstrmojo.DI.DIHelpers.getUrlTooltip=function A(){var K="";if(!mstrApp.diParams){return K;}if(!mstrApp.diParams.EnableURLImport){K=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{K=mstrmojo.desc(12492,"Use one of the following URL formats to upload your file:")+" ";K+=mstrmojo.DI.DIHelpers.getURLCaption();if(mstrApp.enableFileImport){K+="\r\r";K+=mstrmojo.desc(12493,"'File://' format allows you to upload files in your local machine. For example: File://ComputerName/path/FileName.");}if(mstrApp.enableHttpImport||mstrApp.enableHttpsImport){K+="\r\r";if(mstrApp.enableFileImport){K+=mstrmojo.desc(12494,"Some other examples are:");}else{K+=mstrmojo.desc(12495,"Some examples are:");}}if(mstrApp.enableHttpImport){K+="\r";K+="http://host/path/FileName";K+="\r";K+="https://user:password@host/path/FileName";}if(mstrApp.enableFtpImport){K+="\r";K+="ftp://user:password@host/path/FileName";K+="\r";K+="ftp://user:password@host:port/path/FileName";}}return K;};mstrmojo.DI.DIHelpers.createMSTRObjects=function(M,O){var K,N,L;if(M.constructor===Array){K=M;for(L=0;L<K.length;L++){K[L]=mstrmojo.DI.DIHelpers.createMSTRObjects(M[L],O);}}else{if(typeof M==="object"){K=new mstrmojo.Obj(M);for(N in M){if(!O||O.indexOf(N)===-1){if(M.hasOwnProperty(N)){K.set(N,mstrmojo.DI.DIHelpers.createMSTRObjects(M[N],O));}}}}else{K=M;}}return K;};mstrmojo.DI.DIHelpers.getURLParameters=function(K){var L;var O;var N=[];if(K){if(K.indexOf("?")>0){K=K.substr(K.indexOf("?")+1);}O=K.split("&");for(L=0;L<O.length;L++){var M=O[L].split("=");if(M.length===2){N[M[0]]=M[1];}}}return N;};mstrmojo.DI.DIHelpers.getBackendSourceType=function(K){var L=J.backendSourceSubtype.localFile;switch(K){case J.sourceSubtype.dropbox:L=J.backendSourceSubtype.dropbox;break;case J.sourceSubtype.bisource:L=J.backendSourceSubtype.bISources;break;case J.sourceSubtype.clipboard:L=J.backendSourceSubtype.clipboard;break;case J.sourceSubtype.facebook:L=J.backendSourceSubtype.facebook;break;case J.sourceSubtype.googleAnalytics:L=J.backendSourceSubtype.googleAnalytics;break;case J.sourceSubtype.googleBigQuery:L=J.backendSourceSubtype.googleBigQuery;break;case J.sourceSubtype.googleBigQueryFFSQL:L=J.backendSourceSubtype.googleBigQueryFFSQLModel;break;case J.sourceSubtype.googleBigQuerySingleTable:L=J.backendSourceSubtype.googleBigQuerySingleTable;break;case J.sourceSubtype.googleDrive:L=J.backendSourceSubtype.googleDrive;break;case J.sourceSubtype.hadoop:L=J.backendSourceSubtype.hadoopFileBrowser;break;case J.sourceSubtype.localFile:L=J.backendSourceSubtype.localFile;break;case J.sourceSubtype.mdx:L=J.backendSourceSubtype.OLAPSources;break;case J.sourceSubtype.salesforce:L=J.backendSourceSubtype.salesforce;break;case J.sourceSubtype.samplefile:L=J.backendSourceSubtype.samplefile;break;case J.sourceSubtype.searchOnSource:L=J.backendSourceSubtype.searchAsASource;break;case J.sourceSubtype.twitter:L=J.backendSourceSubtype.twitter;break;case J.sourceSubtype.url:L=J.backendSourceSubtype.url;break;case J.sourceSubtype.publicData:L=J.backendSourceSubtype.publicData;break;}return L;};mstrmojo.DI.DIHelpers.getStateParameters=function(L){var K;var O;var M=[];if(L.indexOf(":")>=0){O=L.split(":");}else{O=L.split("%3A");}for(K=0;K<O.length;K++){var N=O[K];if(N.substr(2,1)==="_"){M[N.substr(0,2)]=N.substr(3);}}return M;};mstrmojo.DI.DIHelpers.getExtensionType=function(M){var L=M.toLowerCase(),K;if(L===".xls"||L===".xlsx"||L===".xlsm"){K=J.xdaType.excel;}else{if(L===".txt"||L===".csv"||L===".tsv"||L===".prn"){K=J.xdaType.text;}else{K=0;}}return K;};mstrmojo.DI.DIHelpers.setTablesrc=function(K,M,L){if(M){if(!K.tablesSrc[M]){K.tablesSrc[M]=[];}K.tablesSrc[M].push(L);}};function C(K){var M={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2},P={1:J.columnDataTypes.integer,2:J.columnDataTypes.integer,6:J.columnDataTypes.dtdouble,7:J.columnDataTypes.dtfloat,21:J.columnDataTypes.integer,22:J.columnDataTypes.nlong,30:J.columnDataTypes.bigDecimal,34:J.columnDataTypes.int64},L=M[K],O=P[K],N="";switch(L.toString()){case J.dataTypeMenuItems.NUMBER:switch(O){case J.columnDataTypes.integer:N=mstrmojo.desc(9614,"Integer");break;case J.columnDataTypes.nlong:N=mstrmojo.desc(13131,"Long");break;case J.columnDataTypes.int64:N=mstrmojo.desc(13132,"Big Integer");break;case J.columnDataTypes.dtfloat:N=mstrmojo.desc(8002,"Float");break;case J.columnDataTypes.dtdouble:N=mstrmojo.desc(2265,"Double");break;case J.columnDataTypes.bigDecimal:N=mstrmojo.desc(9920,"Big Decimal");break;default:N=mstrmojo.desc(3434,"Number");break;}break;case J.dataTypeMenuItems.DATE:N=mstrmojo.desc(2052,"Date");break;case J.dataTypeMenuItems.DATE_TIME:N=mstrmojo.desc(9919,"DateTime");break;case J.dataTypeMenuItems.TIME:N=mstrmojo.desc(2170,"Time");break;case J.dataTypeMenuItems.TEXT:N=mstrmojo.desc(3544,"Text");break;case J.dataTypeMenuItems.HTML_TAG:N=mstrmojo.desc(9921,"HTML Tag");break;case J.dataTypeMenuItems.PHONE_NUMBER:N=mstrmojo.desc(8984,"Phone Number");break;case J.dataTypeMenuItems.SYMBOL:N=mstrmojo.desc(4530,"Symbol");break;case J.dataTypeMenuItems.URL:N=mstrmojo.desc(9922,"URL");break;case J.dataTypeMenuItems.EMAIL:N=mstrmojo.desc(4699,"Email");break;}return N;}mstrmojo.DI.DIHelpers.getDataTypeString=C;mstrmojo.DI.DIHelpers.parseAlternateSourceValidationResults=function H(S){var Q=[],O,P,R,T,K,M,N,L;F.forEach(S,function(U){O=P=R=T="";M=(U.vt===3)?1:0;switch(U.vt){case 0:case 1:case 2:case 3:O=U.n;P=C(U.ddt);K=U.src;R=K.n;T=C(K.ddt);break;case 4:O=U.n;P=C(U.ddt);break;case 8:K=U.src;R=K.n;T=C(K.ddt);break;}N=P?O+"("+P+")":O;L=T?R+"("+T+")":R;Q.push([N,M,L]);});return Q;};mstrmojo.DI.DIHelpers.getURLFileName=function(L){var K=L.lastIndexOf("/");return K>=0&&K+1!==L.length?L.substr(K+1):L;};mstrmojo.DI.DIHelpers.isOperationMode=function(K){return K!==undefined&&K!==null;};mstrmojo.DI.DIHelpers.isCtrlKey=function(K,M){var L=M||(K||window).event;return L.ctrlKey||L.metaKey;};mstrmojo.DI.DIHelpers.isRefreshable=function(L){var K,M=0;for(K in L.importSources){var N=L.importSources[K];if(N.type===J.sourceType.file&&(N.subtype===J.sourceSubtype.url||N.subtype===J.sourceSubtype.publicData)){if(!N.sourceInfo||N.sourceInfo.url.indexOf("http://mirror.microstrategy.com/datahub/samples")!==0){M++;}}}if(L.getAllTableID().length===M&&!mstrApp.diParams.EnableHttpImport&&!mstrApp.diParams.EnableFTPImport&&!mstrApp.diParams.EnableFileImport&&!mstrApp.diParams.EnableURLImport){return false;}return true;};mstrmojo.DI.DIHelpers.strStartsWith=function(L,K){return L.indexOf(K)===0;};mstrmojo.DI.DIHelpers.adjustDataIdx=function(N,M){var K=[],L;if(!N||N.length===0){return ;}F.forEach(N,function(O){L=O.subColumns;if(L&&L.length>1){K=K.concat(L);}else{K.push(O);}});K.sort(function(P,O){return P[M]-O[M];});};mstrmojo.DI.DIHelpers.setDataIdx=function(M,L,K){if(!L||L.length===0){return ;}if(L[0].hasOwnProperty("clix")){F.forEach(M,function(O){var N=O.ix;O[K]=F.find(L,"clix",N);if(O.isMultiForm){F.forEach(O.subColumns,function(P){P[K]=F.find(L,"clix",P.ix);});}});}if(L[0].hasOwnProperty("did")){F.forEach(M,function(P){var O=P.did;var N=F.find(L,"did",O);if(N!==-1){P[K]=N;}if(P.isMultiForm){F.forEach(P.subColumns,function(Q){N=F.find(L,"did",Q.did);if(N!==-1){Q[K]=N;}});}});}};mstrmojo.DI.DIHelpers.encodeData=function(K){var L="";if(K!==undefined){if(typeof K==="number"){L=K;}else{L=mstrmojo.string.encodeHtmlString(K,false,true);}}return L;};var I={0:"Bytes",1:"KB",2:"MB",3:"GB",4:"TB",5:"PB"};function D(K){return I[K]||"unknown";}mstrmojo.DI.DIHelpers.getRoundSize=function G(L){var K;for(K=0;(L/1024)>1;K++){L=L/1024;}L=L.toPrecision(3);return L+D(K);};mstrmojo.DI.DIHelpers.findNewElements=function(M,N){var L=[],K;if(M&&M.length){F.forEach(N,function(O){K=F.indexOf(M,O);if(K===-1){L.push(O);}});}else{if(N&&N.length){L=[].concat(N);}}return L;};mstrmojo.DI.DIHelpers.generateCubeName=function(L){var K,M,N=30;K=L.join(" ");if(K.length>N){K=K.slice(0,N)+"...";}M=L.length;if(M>1){K+=" ("+M+" tables)";}return K;};mstrmojo.DI.DIHelpers.parseValidateSourceResults=function(L){var K={isValidate:true,hasError:false,tbids:[],tableValidate:[],missingColumnTbids:[],mismatchedDatatypeTbids:[],missingTableTbids:[],errorTableTbids:[],missingColumns:{},mismatchedDatatypeColumns:{},missingTablesColumns:{},errorTableErrCode:{}},M=L&&L.vts;F.forEach(M,function(T){var N=T.tbid,U=T.vt,R=T.cols||[],O=true,S=false,Q,V=[],P=[];if(U===1){O=true;}else{switch(U){case J.backendError.switchingFileType:case J.backendError.noExternalSession:case J.backendError.databaseCredentialsNotAvailable:S=true;break;}F.forEach(R,function(W){var X=W.vt;switch(X){case 1:P.push(W);break;case 4:V.push(W);break;}});}if(S){K.errorTableTbids.push(N);K.errorTableErrCode[N]=U;K.isValidate=false;K.hasError=true;}Q=V.length>0&&V.length===R.length;if(V.length>0||P.length>0){O=false;}else{O=true;}if(O===false){K.isValidate=false;}K.tbids.push(N);K.tableValidate.push(O);if(V.length>0){if(Q){K.missingTableTbids.push(N);K.missingTablesColumns[N]=V;}else{K.missingColumnTbids.push(N);K.missingColumns[N]=V;}}if(P.length>0){K.mismatchedDatatypeTbids.push(N);K.mismatchedDatatypeColumns[N]=P;}});return K;};mstrmojo.DI.DIHelpers.truncate=function(M,O,K){if(M&&M.length>O){var Q=3,L=O-Q,P=Math.ceil(L/2),N=Math.floor(L/2);if(K){return M.substr(0,L)+"...";}else{return M.substr(0,P)+"..."+M.substr(M.length-N);}}else{return M;}};mstrmojo.DI.DIHelpers.getAbsoluteFileName=function(K){var L,M=K.lastIndexOf("\\");if(M===-1){M=K.lastIndexOf("/");}L=K.substring(M+1,K.length);return L;};mstrmojo.DI.DIHelpers.reevaluatePopupPosition=function(K){if(K){var L=K.style,O=L.display,N=L.left,M=L.top;L.display="block";if(parseInt(N.substring(0,N.length-2))<0){L.left="0px";}if(parseInt(M.substring(0,M.length-2))<0){L.top="0px";}L.display=O;}};mstrmojo.DI.DIHelpers.expandNode=function(L){var K=L.visible;L.set("visible",!K);return !K;};mstrmojo.DI.DIHelpers.normalizeTimestamp=function(M){var L=M.replace(/-/g,"/");var K=L.indexOf(".");if(K>0){L=L.substring(0,K);}return L;};mstrmojo.DI.DIHelpers.getBackendErrorStr=function(L,K){var M="";switch(L){case J.backendError.switchingFileType:M=mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube.");break;case J.backendError.noExternalSession:case J.backendError.databaseCredentialsNotAvailable:M=mstrmojo.desc(14392,"We do not have the credentials needed to get the data for this table. Please provide the credentials to proceed publishing this table.");break;}return M;};mstrmojo.DI.DIHelpers.getCommonElements=function(N,P,O){var L=[],M,K;for(M=0;N&&M<N.length;M++){for(K=0;P&&K<P.length;K++){if(O(N[M],P[K])){L.push(N[M]);break;}}}return L;};mstrmojo.DI.DIHelpers.formatDateAndTime=function(S,N){var R=mstrmojo.date;var L=mstrmojo.locales;var M,T,Q,P,K,O;M=R.parseDateAndOrTime(S);T=M.date;Q=M.time;if(N){O=new Date(Date.UTC(T.year,T.month-1,T.day,Q.hour,Q.min,Q.sec));M=R.getDateJson(O);T=M;Q=M;}P=R.formatDateInfo(T,L.datetime.DATEDISPLAYFORMAT);K=R.formatTimeInfo(Q,L.datetime.TIMEDISPLAYFORMAT);return P+" "+K;};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");mstrmojo.requiresDescs(889,13196);var O=mstrmojo.hash,F=mstrmojo.desc;var G=F(889,"Please wait...");function A(c,b,a){var W=b.showWait,X=b.suppressError,V=b.waitMsg,Y=b.msgid,Z=b.alertCfg;delete b.showWait;delete b.suppressError;delete b.waitMsg;delete b.msgid;delete b.alertCfg;mstrApp.serverRequest(b,c,W,X,V,Y,Z,a);}mstrmojo.qb.es.DataService=mstrmojo.provide("mstrmojo.qb.es.DataService",{emmaIRRMessageID:null,submitRequest:function N(W,V){A.call(this,W,V);},setDBRole:function R(W,V){A.call(this,W,O.copy(V,{taskId:"qBuilder.SetDBRole",showWait:true}));},signOutOAuthSource:function S(W,V){A.call(this,W,O.copy(V,{taskId:"qBuilder.FetchSourceObjects",flags:8,showWait:true,waitMsg:F(12369,"Signing out...")}));},pollingStatus:function D(c,W,Z,a){var Y=this;if(mstrApp.isSingleTier){if(c.success){c.success(W);}return ;}A.call(Y,{success:function b(d){if(d.status==="1"){if(c.success){c.success(W);}}else{Y.pollingStatus(c,W,Z);}},failure:function X(d){if(c.failure){c.failure(d);}},canceled:function V(d){if(c.canceled){c.canceled(d,W);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:Z},a);},prepareDataPollStatus:function Q(a,d,c,Z){var X=this,Y="pollStatus";if(mstrApp.isSingleTier){Y="DIPollStatus";}A.call(X,{success:function b(e){if(e.status==="1"||e.status===1){if(a.success){a.success(d);}}else{X.prepareDataPollStatus(a,d,c,Z);}},failure:function V(e){if(a.failure){a.failure(e);}},canceled:function W(e){if(a.canceled){a.canceled(e,d);}}},{taskId:Y,resultSetType:3,pollingFrequency:500,threadId:d.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:c},Z);},createEmmaTables:function P(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"qBuilder.CreateEmmaTables",showWait:true,waitMsg:G}));},createEmmaInstance:function U(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:G}));},removeEMMATable:function B(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"DIRemoveEMMASourceTable",showWait:true,waitMsg:G}));},changePartition:function M(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"DIChangePartition",showWait:true,waitMsg:G}));},editEmmaIRRSourceTable:function I(Z,Y){var W=this,V;V={success:function X(a){W.emmaIRRMessageID=a.msgid;}};A.call(W,mstrmojo.func.wrapMethods(V,Z),O.copy(Y,{taskId:"DIEditEmmaIRRSourceTable",msgid:W.emmaIRRMessageID,showWait:true}));},search:function J(W,V){A.call(this,W,O.copy(V,{taskId:"arch.search",showWait:true}));},searchFolderContents:function T(W,V){A.call(this,W,O.copy(V,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:G});},validateEmmaIRRAlternateSource:function C(W,V){A.call(this,W,O.copy(V,{taskId:"DIValidateEmmaIRRAlternateSource",msgid:this.emmaIRRMessageID,showWait:true}));},prepareData:function H(d,X,Y,a,W){var V=W||F(13196,"Prepare data ## of ### tables...").replace("##",Y).replace("###",a);var Z=this,b={showCancel:true};A.call(Z,{success:function c(e){Z.prepareDataPollStatus(d,e,V,b);},canceled:function(e){if(d.canceled){d.canceled(e);}}},O.copy(X,{taskId:"DIDataPreparation",showWait:true,waitMsg:V}),b);},catalogAction:function L(W,V){A.call(this,W,O.copy(V,{taskId:"arch.catalogAction",showWait:true}));},autoMap:function K(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"qBuilder.AutoMapTables",showWait:true,waitMsg:G}));},killJob:function E(W,V){A.call(this,W,O.copy(V,{taskId:"DIKillJob",showWait:true,suppressError:true,waitMsg:G}));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.EnumColumnDataTypes","mstrmojo.warehouse.EnumObjectTypes");var F=mstrmojo.string,C=mstrmojo.warehouse.EnumObjectTypes.COLUMN,A=mstrmojo.desc(11428,"[unknown]");function E(H){var G=mstrmojo.architect.EnumColumnDataTypes;return("["+G[H].n+"]"||A);}mstrmojo.architect.obj.Column=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Column",init:function D(G){this._super(G);var I,H;if(G){if(G.dbInfo){I=G.dbInfo;this.cln=F.decodeHtmlString(I.cln).replace(/&apos;/g,"'");this.cmid=I.cmid;this.sta=parseInt(I.sta,10);this.dt={tp:I.dt.tp,ps:I.dt.prec,sc:I.dt.scl};this.n=this.cln+": "+this.getDataTypeName();}else{if(G.tableInfo){I=G.tableInfo;H=I.def;this.cln=F.decodeHtmlString(H.cln).replace(/&apos;/g,"'");this.cmid=I.did;this.dt={tp:H.dt.tp,ps:H.dt.ps,sc:H.dt.sc};this.n=this.cln;}else{if(G.colDef){H=G.colDef;this.cln=F.decodeHtmlString(H.cln).replace(/&apos;/g,"'");this.cmid="";this.dt={tp:H.dt.tp,ps:H.dt.ps,sc:H.dt.sc};this.n=this.cln;}}}}},cln:undefined,n:undefined,tp:C,t:C,cmid:undefined,def:undefined,dt:undefined,getDataTypeName:function B(){return E(this.dt.tp);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array");var B=mstrmojo.array;mstrmojo.ObjectBrowserDataProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ObjectBrowserDataProvider",path:mstrConfig.taskURL,serverRequest:function(C,D){if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(C,D,{silent:true});}else{mstrmojo.xhr.request("POST",this.path,D,C,undefined,this.XServer,this.baseParams);}},fetchFolderContents:function(C,D,G){var E=C.blockCount,F={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockCount:E,includeAncestorInfo:"true",includeObjectDesc:C.includeObjectDesc};if(C.folderLinksContextId){F.folderLinksContextId=C.folderLinksContextId;}if(C.sId){F.sessionState=C.sId;}if(D.fid){F.rootFolderID=D.fid;}else{if(D.fty){F.rootFolderType=D.fty;}}if(C.browsableTypes){F.objectType=C.browsableTypes;}if(D.blockBegin){F.blockBegin=D.blockBegin;}if(D.searchPattern){if(C.enableQuickSearch){F.quickSearch=C.enableQuickSearch;}F.searchPattern=D.searchPattern;if(D.recursive){F.recursive=D.recursive;}}this.serverRequest(F,G);},newFolder:function(F,G,E,C){var D={taskId:"createFolder",taskContentType:"json",folderID:F,name:G,description:E};this.serverRequest(D,C);},loadObjects:function A(G,H,C,F){var D=[],E=[];B.forEach(G,function(I){D.push(I.did);E.push(I.t);});if(G.length>0&&F){this.serverRequest({taskId:"getObjectInfo",objectIDs:D.join(","),objectTypes:E.join(","),includeDetails:true},H,C);}else{H.success();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._LoadsScript","mstrmojo.Binding","mstrmojo._HasBindings","mstrmojo._HasMarkup","mstrmojo._HasTooltip","mstrmojo.css");mstrmojo.Widget=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._LoadsScript,mstrmojo._HasBindings,mstrmojo._HasMarkup,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.Widget",domNode:null,hasRendered:false,visible:true,enabled:true,tooltip:"",cssClass:"",cssText:"",cssDisplay:"block",slot:"",alias:"",parent:null,init:function A(C){this._super(C);var D=this.parent;if(!D||D.hasInitBindings){this.initBindings();}},destroy:function B(C){if(this.hasRendered){this.unrender(C);}if(this.bindings){this.destroyBindings();}this._super();},invalidate:mstrmojo.emptyFn,widgetResized:mstrmojo.emptyFn});mstrmojo.Widget.cssTextMarkupMethod=function(){this.domNode.style.cssText=this.cssText||"";};mstrmojo.Widget.visibleMarkupMethod=function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";};mstrmojo.Widget.topMarkupMethod=function(){var C=this.top;if(C){this.domNode.style.top=C;}};mstrmojo.Widget.leftMarkupMethod=function(){var C=this.left;if(C){this.domNode.style.left=C;}};mstrmojo.Widget.heightMarkupMethod=function(){var C=this.height;if(C){this.domNode.style.height=C;}this.widgetResized();};mstrmojo.Widget.widthMarkupMethod=function(){var C=this.width;if(C){this.domNode.style.width=C;}this.widgetResized();};mstrmojo.Widget.enabledMarkupMethod=function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");mstrmojo.requiresDescs(889);var C=mstrmojo.hash;var H=mstrmojo.desc(889,"Please wait...");function E(R,Q){var O=Q.showWait,P=Q.suppressError,N=Q.waitMsg;delete Q.showWait;delete Q.suppressError;delete Q.waitMsg;mstrApp.serverRequest(Q,R,O,P,N);}mstrmojo.qb.mdx.DataService=mstrmojo.provide("mstrmojo.qb.mdx.DataService",{submitRequest:function B(O,N){E.call(this,O,N);},pollingStatus:function M(S,N,Q){var P=this;if(mstrApp.isSingleTier){if(S.success){S.success(N);}return ;}E.call(P,{success:function R(T){if(T.status==="1"){if(S.success){S.success(N);}}else{P.pollingStatus(S,N,Q);}},failure:function O(T){if(S.failure){S.failure(T);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:Q});},addCubes:function D(Q,P){var N=this;E.call(this,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"qBuilder.AddMDXCubes",showWait:true,waitMsg:H}));},updateCubes:function K(Q,P){var N=this;E.call(this,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"qBuilder.UpdateMDXCubes",showWait:true,waitMsg:H}));},setDBRole:function F(Q,P){var N=this;E.call(this,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"qBuilder.SetDBRole",showWait:true,waitMsg:H}));},search:function L(O,N){E.call(this,O,C.copy(N,{taskId:"arch.search",showWait:true}));},searchFolderContents:function J(O,N){E.call(this,O,C.copy(N,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:H});},createEmmaTable:function A(Q,P){var N=this;E.call(N,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"DICreateEMMASourceTable",showWait:true,waitMsg:H}));},createEmmaInstance:function G(Q,P){var N=this;E.call(N,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:H}));},getObjectFolder:function I(O,N){E.call(this,O,C.copy(N,{taskId:"DIGetObjectFolder",showWait:true,waitMsg:H}));}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.Widget");var J=["(",")","{","}","-","+","*","/","<",">","=","|","~",","," ","\t","\n",";","'",'"'],F=null;function D(O){if(!F){F={};var N,M;for(N=0,M=J.length;N<M;N++){F[J[N]]=true;}}return F[O];}mstrmojo.qb.FFsqlToken=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.qb.FFsqlToken",data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}"></span>',active:false,dropZone:true,allowDrop:function H(M){return this.dropZone;},ondrop:function(M){mstrmojo.all.FFsql.ondrop(M);},markupMethods:{ondataChange:function(){var M=this.data;if(M.v===","){this.domNode.innerHTML=mstrmojo.string.encodeHtmlString(String(M.v));}else{if(M.v=="\n"){this.domNode.innerHTML="<br>";}else{this.domNode.innerHTML=mstrmojo.string.encodeHtmlString(String(M.v));}}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());mstrmojo.css.toggleClass(this.domNode,["sql"],this.isSql());mstrmojo.css.toggleClass(this.domNode,["invalid"],M.sta===-1);},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);if(!this.active){var N=mstrmojo.all.FFsql;if(!this.isMstrO()&&!this.isDelimiter()){var M=N.candidates.items,P=this.data,O=P.v.toLowerCase();mstrmojo.array.forEach(M,function(Q){if(O===Q.n.toLowerCase()){P.oi=Q;return false;}});}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());mstrmojo.css.toggleClass(this.domNode,["sql"],this.isSql());}}},isMstrO:function I(){var M=this.data;return(!!M.oi&&M.oi.sta!==2)||!!M.rfd;},isSql:function L(){return this.data.oi&&this.data.oi.sta===100;},length:function B(){return this.data.v.length;},isDelimiter:function A(){return this.data.isDelimiter||(this.length()===1&&D(this.data.v));},split2Tokens:function E(Q,N){var P=this.data,O=P&&P.v,R=O.substring(0,Q),M=O.substring(Q);return[{v:R,isNew:true,did:P.did},{v:M,isNew:true,did:N}];},mergeTo:function C(N){var P=this.data,O=P&&P.v,M=N.data.v;return{v:O+M,isNew:true};},setItemInfo:function G(M){var N=this.data;N.v=M.n;N.oi=M;N.sta=1;N.isNew=true;this.set("data",N);this.paint();},spliceContent:function K(S,Q,N){var R=this.data,P=R&&R.v,T=P.substring(0,S);Q=(Q===null||Q===undefined)?(P.length-S):Q;var M=P.substring(S+Q),O=T+(N||"")+M;R.v=O;R.isNew=true;R.sta=1;delete R.oi;this.set("data",R);this.paint();}});mstrmojo.qb.FFsqlToken.isDelimiter=D;})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string");var B=mstrmojo.string;mstrmojo.Label=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Label",allowHTML:false,text:"",title:"",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click></div>',markupMethods:{ontitleChange:function(){this.domNode.title=this.title;},ontextChange:function(){var C=this.text;C=B.isEmpty(C)?"":C.toString();this.domNode.innerHTML=this.allowHTML?C:B.encodeHtmlString(C,true);},oncssTextChange:mstrmojo.Widget.cssTextMarkupMethod,onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod},autoHide:false,_set_text:function A(E,C){if(this.autoHide){this.set("visible",(C!==null)&&(C!=="")&&(C!==undefined));}var D=this.text;this.text=C;return(D!==C);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.Widget");var R=["(",")","{","}","-","+","*","/","<",">","|","~",","],G={" ":true,"@":true},Q=null;function J(V){if(!Q){Q={};var U,T;for(U=0,T=R.length;U<T;U++){Q[R[U]]=true;}}return Q.hasOwnProperty(V);}function S(V){if(!V){return false;}var T=V.length,U,W;for(U=0;U<T;U++){W=V.charAt(U);if(J(W)||G[W]){return true;}}return false;}function A(T){return S(T)?"["+T+"]":T;}var M={8:true,9:true,10:true};var C=function(U,T){return M[U]&&!/^\".*\"$/.test(T)?'"'+T+'"':T;};var D=function(U,T,V){var W=typeof V==="undefined"?true:M[V];return U.tp===261&&T.length>=2&&W?(/^\s+$/.test(T.substr(1,T.length-2))?T:T.substr(1,T.length-2)):T;};mstrmojo.ME.MetricToken=mstrmojo.declare(mstrmojo.Widget,null,{data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}"></span>',active:false,markupMethods:{ondataChange:function(){var U=this.data,T=mstrmojo.string.encodeHtmlString(String(U.v));if(U.v===","){this.domNode.innerHTML=T+"&nbsp;";}else{if(U.tp===259&&U.v==="Desc"){this.domNode.innerHTML="&nbsp;"+T;}else{this.domNode.innerHTML=T;}}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());mstrmojo.css.toggleClass(this.domNode,["nfn"],!this.isFunction());mstrmojo.css.toggleClass(this.domNode,["invalid"],U.sta===-1);},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);}},isMstrO:function P(){return !!this.data.oi||!!this.data.rfd;},isFunction:function B(){return this.isMstrO()&&(this.data.oi&&this.data.oi.t==11);},brackets:A,length:function E(){return this.data.v.toString().length;},isDelimiter:function O(){return this.data.isDelimiter||(this.length()===1&&J(this.data.v));},split2Tokens:function H(W){var V=this.data,U=V&&V.v.toString(),X=U.substring(0,W),T=U.substring(W);return[{v:X,isNew:true},{v:T,isNew:true}];},mergeTo:function I(U){var W=this.data,V=W&&W.v.toString(),T=U.data.v.toString();return{v:V+T,isNew:true};},brackets:A,setItemInfo:function N(T){var U=this.data;U.v=this.brackets(T.n);U.oi=T;U.sta=1;U.isNew=true;this.set("data",U);this.paint();},spliceContent:function K(Z,X,U){var Y=this.data,W=Y&&Y.v.toString(),a=W.substring(0,Z);X=(X===null||X===undefined)?(W.length-Z):X;var T=W.substring(Z+X),V=a+(U||"")+T;Y.v=V;Y.isNew=true;Y.sta=1;Y.ift=(this.isAttributeToken()||Y.at)&&(Y.v.indexOf("@")>=0);if(Y.ift){Y.at=Y.oi||Y.at;}else{delete Y.at;}delete Y.oi;delete Y.exv;delete Y.extp;delete Y.tp;this.set("data",Y);this.paint();},isAttributeToken:function F(){return this.data&&this.data.oi&&this.data.oi.t===12;},setFormInfo:function L(U){var V=this.data,T=V.oi||V.at;V.v=this.brackets(T.n)+"@"+this.brackets(U.n);V.exv=U.did;V.extp=8;V.sta=1;V.isNew=true;V.oi=V.at;delete V.at;this.set("data",V);this.paint();}});mstrmojo.ME.MetricToken.isDelimiter=J;mstrmojo.ME.MetricToken.brackets=A;mstrmojo.ME.MetricToken.quotes=C;mstrmojo.ME.MetricToken.unquotes=D;mstrmojo.ME.MetricToken.QUOTABLE_DATATYPES=M;mstrmojo.ME.MetricToken.argDelimiter={".":",",",":";"}[mstrConfig&&mstrConfig.decimalSep]||",";})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.WaitIcon=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.WaitIcon",cssFloat:"left",visible:false,markupString:'<div id="{@id}" class="mstrmojo-WaitIcon {@cssClass}" style="float:{@cssFloat};{@cssText};"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{}});}());(function(){mstrmojo.requiresCls("mstrmojo.boxmodel","mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Widget","mstrmojo.Arr","mstrmojo._HasLayout","mstrmojo._ListBase2Selections","mstrmojo.ListSelector","mstrmojo._TouchScrolling","mstrmojo._PagingList");var a=mstrmojo.hash,f=mstrmojo.array,e=mstrmojo.boxmodel,c=mstrmojo.dom;function A(j,l,h){var k=j.listSelector;if(k){k[l](j,j.itemsContainerNode,h);}}function L(j,h){var k=j.lastPagePos;if(!k||k.dragId!==h){k=e.offset(j.itemsContainerNode);k.dragId=h;j.lastPagePos=k;var l=j.scrollboxNode;j.lastScrollPos={left:l.scrollLeft,top:l.scrollTop,width:l.clientWidth,height:l.clientHeight};}}function O(l,o,j){var k=o&&o.node;if(k===l.dropCueNode||k===l.dropCueNode.firstChild){return l.dropCuePos;}var m=l.listMapper;var h=m&&m.whereDrop(l,l.itemsContainerNode,k,o.pos,{left:l.lastPagePos.left-l.lastScrollPos.left,top:l.lastPagePos.top-l.lastScrollPos.top,width:l.lastScrollPos.width,height:l.lastScrollPos.height});var n=l.dropCuePos;return((j!==false)&&n&&h&&(n.idx===h.idx)&&(n.left===h.left)&&(n.top===h.top))?n:h;}var g="attachEventListener";function D(j,h){if(j.makeObservable){h=h||[];if(!h[g]){mstrmojo.hash.make(h,j.itemsScriptClass||mstrmojo.Arr);}}return h;}function H(j,h){if(h&&h[g]){j._sub_its=h;j._sub_add=h[g]("add",j.id,"preadd");j._sub_rmv=h[g]("remove",j.id,"preremove");}}function G(h){if(h._sub_its){var j=mstrmojo.publisher;j.unsubscribe(h._sub_add);j.unsubscribe(h._sub_rmv);delete h._sub_add;delete h._sub_rmv;delete h._sub_its;}}mstrmojo.ListBase2=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListBase2Selections,mstrmojo._TouchScrolling,mstrmojo._PagingList,mstrmojo._HasLayout],{scriptClass:"mstrmojo.ListBase2",items:null,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode;},itemsContainerNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},ondropCuePosChange:function(){var j=this.dropCueNode,h=j&&j.style;if(!h){return ;}var l=this.dropCuePos,k=!!l;if(k){h.left=l.left+"px";h.top=l.top+"px";}h.display=k?"block":"none";},onpageChange:function(){if(this.usePaging&&!this._inScroll){this._inPaging=true;this.listMapper.toPage(this,this.page);this._inPaging=false;}},onwidthChange:function(){if(!isNaN(parseInt(this.width))){this.domNode.style.width=this.width;}},onheightChange:function(){if(!isNaN(parseInt(this.height))){this.domNode.style.height=this.height;}}},autoHide:false,renderOnScroll:false,firstRenderBlockSize:50,renderBlockSize:50,listMapper:null,listBuilder:null,listSelector:mstrmojo.ListSelector,animate:false,itemsEffect:null,containerResizable:true,init:function Z(m){this._super(m);this.items=this.initItems(this.items);var l=this.selectedIndices,j=this.selectedIndicesList,k=this.selectedIndex,n=this.selectedItem;this.selectedIndices={};this.selectedIndex=-1;delete this.selectedIndicesList;delete this.selectedItem;if(l||j||(k>-1)||n){this.initSelections(l,j,k,n);}if(this.postInitItems){this.postInitItems();}},initItems:function I(h){return D(this,h);},preBuildRendering:function W(){var m=this.listBuilder,p=m.newContext(this);this.ctxtBuilder=p;var j=this.markupSlots,l=!!(this.renderOnScroll&&this.renderBlockSize&&j&&j.scrollboxNode),k=this.items,h=(k&&k.length)||0,n=l?this.firstRenderBlockSize:h,o=l?this.firstRenderBlockSize:0;this._eros=l;this.paused=false;this.itemsHtml=this.listMapper.buildItemWrappers(k,m,this,p,n,o).join("");this.itemsContainerCssText="visibility: hidden";if(this._super){this._super();}},postBuildRendering:function E(){delete this.itemsHtml;var m=this.listMapper;if(m&&m.postBuildRendering){m.postBuildRendering(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder);}H(this,this.items);if(this._eros||this.usePaging){if(!this._cb_scroll){var p=this.id;this._cb_scroll=function(){var n=mstrmojo.all[p];n.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);this.onscroll();}if(this.animate){for(var k=0,j=["itemsEffect","scrollEffect"],h=j.length;k<h;k++){var o=j[k],l=this[o];if(l&&l.constructor===Object){l=mstrmojo.insert(mstrmojo.hash.clone(l));l.widget=this;this[o]=l;}}if(this.itemsEffect){this.itemsEffect.play();}}this.itemsContainerNode.style.visibility="inherit";if(this.containerResizable&&this.itemsContainerNode.scrollWidth<this.domNode.scrollWidth){this.itemsContainerNode.style.width=this.domNode.scrollWidth+"px";}if(this._super){this._super();}},unrender:function X(l){G(this);if(this._eros){mstrmojo.dom.detachEvent(this.scrollboxNode,"scroll",this._cb_scroll);delete this._cb_scroll;}for(var j=0,k=["itemsEffect","scrollEffect"],h=k.length;j<h;j++){var m=this[k[j]];if(m&&m.isPlaying){m.cancel();}}this._super(l);},pauseScrollRendering:function P(k,h,j){if(k!==false){k=true;}if(this.paused===!!k){return ;}this.paused=!!k;if(k){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}}else{this.fill(h,j);}},onscroll:function K(){if(this.paused){return ;}if(this._eros){if(!this._fillTmr){var h=this;this._fillTmr=self.setTimeout(function(){h.fill();h=null;},50);}}if(this._super){this._super();}},fill:function b(h,m){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}var n=(this.items&&this.items.length)||0;if(!n){if(m){m();}}else{var k=this.scrollboxNode,o=this.itemsContainerNode,l=mstrmojo.boxmodel.offset(o,k),q=this.listMapper,p=q.findScrollRange(o,n,(this.usesTouches&&this.pos&&parseInt(this.pos.y,10))||k.scrollTop,k.clientHeight,(this.usesTouches&&this.pos&&parseInt(this.pos.x,10))||k.scrollLeft,k.clientWidth,l.left,l.top);if(this.fillAt(p.start,p.end)){if(h){h();}var j=this.id;this._fillTmr=window.setTimeout(function(){mstrmojo.all[j].fill(h,m);},100);}else{if(m){m();}}}},fillAt:function M(k,j){var h=this.listMapper;if(h){return h.fillItemWrappers(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder,k,j,this.renderBlockSize);}else{return false;}},add:function R(j,h){if(!j||!j.length){return -1;}var k=this.items;if(h==null){h=a.min(this.selectedIndices,false,true);if(h!==null&&h!==undefined){h++;}}if(h==null||h===-1){h=(k&&k.length)||0;}if(k&&k.add){k.add(j,h);}else{this.set("items",k?f.insert(k.concat(),h,j):j);}return h;},preadd:function B(k){if(this.hasRendered){var n=this.listMapper;if(n){n.onadd(this,this.itemsContainerNode,this.ctxtBuilder,k);}var m=this.listBuilder;if(m){m.onadd(this,this.ctxtBuilder,k);}var j=this.listSelector;if(j){j.onadd(this,k);}if(this._eros){this.onscroll();}else{var l=k.index,h=k.value.length;this.fillAt(l,l+h-1);}}if(this.onadd){this.onadd(k);}if(this._super){this._super(k);}},remove:function U(h){if(h==null){return -1;}if(h.constructor!==Array){return this._remove(h);}var k=this.items;if(k){var j;if(k.remove){for(j=h.length-1;j>-1;j--){k.remove(h[j],1);}}else{k=k.concat();for(j=h.length-1;j>-1;j--){k.splice(h[j],1);}this.set("items",k);}return h[0];}return -1;},_remove:function U(k){var j=this.items;if(!j||(k==null)){return -1;}var h;if(!isNaN(k)){h=k;}else{h=this.itemIndex(k);}if(h>-1){if(j.remove){j.remove(h,1);}else{j=j.concat();j.splice(h,1);this.set("items",j);}}return h;},duplicate:function Y(n,j,k){var l=this.items,h=-1;if(!l||(n==null)){return -1;}if(!isNaN(n)){if(j===null||j===undefined){j=n+1;}n=l[n];}else{if(j===null||j===undefined){j=this.itemIndex(n)+1;}}if(n){var m;m=a.copy(k,a.clone(n));h=this.add([m],j);}return h;},preremove:function N(j){if(this.hasRendered){var l=this.listMapper;if(l){l.onremove(this,this.itemsContainerNode,this.ctxtBuilder,j);}var k=this.listBuilder;if(k){k.onremove(this,this.ctxtBuilder,j);}var h=this.listSelector;if(h){h.onremove(this,j);}if(this._eros){this.onscroll();}}if(this.onremove){this.onremove(j);}if(this._super){this._super(j);}},move:function S(l,r){function p(u,t){u=parseInt(u,10);return t===1||(r>=u&&r<u+t);}var q=(this.items&&this.items.length)||0;if(r===-1||r==null||isNaN(r)){r=q;}else{r=Math.min(r,q);}var k,h,n,m;if(l.constructor===Array){h=l;n=l;m=(h&&h.length)||0;if(p(l[0],l.length)){return false;}k=f.get(this.items,l);}else{if(typeof (l)==="object"){k=[l];m=1;h=this.itemIndex(k[0]);n=[h];if(p(h,1)){return false;}}else{h=l;n=[l];m=1;if(p(h,1)){return false;}k=[this.items[h]];}}var o=0;for(var j=0;j<m;j++){if(n[j]<=r){r--;o++;}}if(o==n.length){r++;}if(k[0]!=null){this.remove(h);this.add(k,r);}return true;},itemIndex:function F(h){if(h==null){return -1;}var j=this.itemIdField;return j?f.find(this.items,j,h[j]):f.indexOf(this.items,h);},prechange:function T(k){if(this.hasRendered){var j=[this.listBuilder,this.listMapper];for(var l=0,h=j.length;l<h;l++){var m=j[l];if(m&&m.onchange){m.onchange(this,this.itemsContainerNode,this.ctxtBuilder,k);}}}},makeObservable:false,_set_items:function J(o,h){var m=this.items;h=this.initItems(h);this.items=h;if(m!==h){var l=this,k=function(){if(l.autoHide){l.set("visible",!!(h&&h.length));}l=null;},j=this.hasRendered;if(j){this.refresh(k);}else{k();}}return m!==h;},premousedown:function d(h){A(this,"premousedown",h);},premouseup:function Q(h){A(this,"premouseup",h);},scrollTo:function V(j){var h,k=this.listMapper;if(k&&k.toItem){if(!isNaN(j)){h=j;}else{h=this.itemIndex(j);}if(h>=0){k.toItem(this,h);}}},draggable:false,getDragData:function(m){L(this,m.id);var k=O(this,m.src),j=k&&k.idxActual;if((j>-1)&&this.selectedIndices[j]){var l=this.sortSelectedIndices(),h=f.get(this.items,l)||[];switch(h.length){case 1:return a.copy({html:h[0][this.itemDisplayField],index:l[0]},a.copy(h[0]));case 0:return null;default:return a.copy({html:h.length+" selections",indices:l},h);}}},dropZone:false,ondragenter:function(h){L(this,h.id);this.set("dropCuePos",O(this,h.tgt));},ondragover:function(h){this.set("dropCuePos",O(this,h.tgt));},ondragleave:function(h){this.set("dropCuePos",null);},isDragValid:function C(h){return h&&h.src&&h.src.data;},ondragstart:function(h){if(!(h&&h.src&&h.src.data)){return false;}},allowCopy:false,ondragend:function(l){var j=l&&l.tgt,h=j&&j.widget;if(h===this){}else{if(this.tree&&h&&h.tree===this.tree){if(!this.allowCopy||!c.ctrlKey(j.hWin,j.e)){var k=l.src&&l.src.data;if(k&&(k.indices||(k.index!==null))){this.remove(k.indices||k.index);}}}}},ondrop:function(q){var u=q&&q.src,p=u&&u.data;if(p){var k=O(this,q.tgt,false),r=k&&k.idx,l=(p&&p.constructor===Array),j=this.sortSelectedIndices();var n=this.items;r=Math.min(r,n&&n.length)||0;var t=true;if(u.widget===this){t=this.move(j,r);f.forEach(j,function(w){if(w<=r){r--;}});}else{this.add(l?p:[p],r);}if(t){var o=l?p.length:1,h={};for(var m=0;m<o;m++){h[r+m]=true;}this.set("selectedIndices",h);}}this.set("dropCuePos",null);}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.registry","mstrmojo._HasContextMenu","mstrmojo.Widget");var F=mstrmojo.dom,K=mstrmojo.css,N=16;mstrmojo.ContextMenuItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasContextMenu],{scriptClass:"mstrmojo.ContextMenuItem",SUBMENU_SHIFT:3,visible:true,checked:false,enabled:true,buildDom:function(){var U=document.createElement("tr"),V=this.data,Y=this._cmSource,R,S;U.id=this.id;U.className="mstrmojo-ContextMenuItem "+(Y.isSeparatorItem(V)?"separator":Y.item2textCss(V));var W=this,X=function(){W.handleMouseOver();},T=function(){W.handleMouseOut();},Q=function(){W.handleClick();};F.attachEvent(U,"mouseover",X);F.attachEvent(U,"mouseout",T);F.attachEvent(U,"click",Q);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-left";S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-text";if(Y.isSeparatorItem(V)){S=document.createElement("img");S.src="../images/1ptrans.gif";}else{S=document.createElement("div");S.className="mstrmojo-CMI-content";R.innerHTML=V.itemWidget?"&nbsp":V[this.itemField];}R.appendChild(S);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-right "+(this.hasSubmenu?"sm":"");S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);return U;},buildRendering:function L(){this._super();var Q=this.data.itemWidget;if(Q){Q.placeholder=this.domNode.cells[1].children[0];Q.data=this.data;Q=mstrmojo.insert(Q);Q.render();Q.parent=this;this.itemWidget=Q;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"":"none";},oncheckedChange:function(){K.toggleClass(this.domNode,["checked"],this.checked);},onenabledChange:function(){K.toggleClass(this.domNode,["disabled"],!this.enabled);}},getMenuPosition:function I(){var Q=F.position(this.domNode,true);return{x:Math.round(Q.x+Q.w-this.SUBMENU_SHIFT),y:Math.round(Q.y)};},getContextMenuItems:function B(){return this.data[this.itemChildrenField];},getContextMenuCssClass:function D(){return this.data.cmCssClass||"";},callOnContextMenuOpen:function M(){var Q=this.data;if(Q.onContextMenuOpen){Q.onContextMenuOpen.apply(this,[]);}},callOnContextMenuClose:function A(){var Q=this.data;if(Q.onContextMenuClose){Q.onContextMenuClose.apply(this,[]);}},attachMousedownEvent:function J(){},getContextMenuSource:function P(){return this._cmSource;},adjustMenuPosition:function G(){var Q=this._subMenu,T=this._subMenu.domNode,S=T.offsetHeight,R=T.offsetWidth,W=F.windowDim(),V=F.position(T,false),U=F.position(T,true);if((V.x+R+N)>W.w){Q.set("left",(F.position(this.domNode,true).x-R)+"px");}if((V.y+S+N)>W.h){Q.set("top",(W.h-S-N+(U.y-V.y))+"px");}},handleMouseOver:function O(){var Q=this,R=function(){if(Q.hasSubmenu){Q.showContextMenu();}Q._cmSource.closeMenuTree(Q);Q._mouseOverTimer=null;};if(this._cmSource.activeMenuItem!==this){this._mouseOverTimer=window.setTimeout(R,80);}},handleMouseOut:function H(){if(this._mouseOverTimer){window.clearTimeout(this._mouseOverTimer);this._mouseOverTimer=null;}},closeMenuTree:function C(){this._cmSource.closeMenuTree();},handleClick:function E(){if(this.hasSubmenu){return ;}var Q=this._cmSource,R=this.data;if(!this.itemWidget){if(!Q.isSeparatorItem(R)&&Q.queryEnabled(R)){if(Q.executeCommand){Q.executeCommand(this.data);}Q.closeMenuTree();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.ui._HasScroller","mstrmojo.css");var C=mstrmojo.css,E=mstrmojo.desc(14058,"Show Details"),A=mstrmojo.desc(14059,"Hide Details"),F=mstrmojo.desc(14060,"We are sorry for the inconvenience. Please {contact} your administrator for help.").replace("{",'<span class="dyn-link">').replace("}","</span>");mstrmojo.ui.editors.ErrorDialogContent=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",markupString:'<div class="mstrmojo-error-content" mstrAttach:click><div class="scroll-container"><div>{@shortDesc}</div><div>'+F+'</div><div class="toggle-details-link" >'+E+'</div><div class="error-details">{@en@longDesc}</div></div></div>',markupSlots:{scrollNode:function(){return this.domNode.firstChild;},contactNode:function(){return this.domNode.firstChild.children[1].getElementsByClassName("dyn-link")[0];},toggleDetailsNode:function(){return this.domNode.firstChild.children[2];}},markupMethods:{onshowDetailsChange:function(){var H=this.showDetails;this.toggleDetailsNode.innerHTML=H?A:E;C.toggleClass(this.domNode,"show-details",H);this.updateScrollbars();}},shortDesc:undefined,longDesc:undefined,showDetails:false,init:function G(H){this._super(H);this.shortDesc=this.shortDesc||mstrmojo.desc(14061,"An error has occurred");},onclick:function B(H){var J=H.getTarget(),I,K=this.longDesc;if(J===this.contactNode){I="mailto:?subject="+encodeURI("Issue: "+this.shortDesc)+(K?("&body="+encodeURI("Detail:\r\n"+K)):"");mstrApp.openPage(I,"_self");}else{if(J===this.toggleDetailsNode){this.set("showDetails",!this.showDetails);}}},setupScrollNodes:function D(){this.scrollNode=this.scrollNode;}});})();(function(){mstrmojo.requiresCls("mstrmojo.publisher","mstrmojo.Widget","mstrmojo.array","mstrmojo._HasChildren");var G=mstrmojo.array;function E(P){if(!this.shouldPropagateEnabled){return ;}var O=this._disabledChildren;G.forEach(P,function(Q){if(Q.enabled){O.push(Q.id);Q.set("enabled",false);}});}function J(){G.forEach(this._disabledChildren,function(O){var P=mstrmojo.all[O];if(P&&P.parent===this){P.set("enabled",true);}},this);this._disabledChildren=[];}mstrmojo.Container=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasChildren],{scriptClass:"mstrmojo.Container",defaultChildSlot:"containerNode",containerNode:null,preserveChildDomOrder:true,shouldPropagateEnabled:false,init:function M(P){this._super(P);this._disabledChildren=[];this.attachEventListener("addChild",this.id,function(Q){if(this.shouldPropagateEnabled&&!this.enabled){E.call(this,Q.value);}});if(this.children){this.initChildren();}var O=this.parent;if(!O||O.hasInitBindings){this.initBindings();}},destroy:function H(O){if(this.children){this.destroyChildren(true);}if(this.bindings){this.destroyBindings();}this._super(O);},unrender:function I(Q){var R=this.children,O=(R&&R.length)||0,P;for(P=O-1;P>-1;P--){R[P].unrender(true);}this._super(Q);},postBuildRendering:function A(){if(this._super()!==false){this.renderChildren();return true;}return false;},renderChildren:function L(){var Q=this.children,O=(Q&&Q.length)||0,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}}},childRenderCheck:function D(P){if(P&&!P.hasRendered){var O=P.slot||this.defaultChildSlot;return !!this[O];}return false;},addChildren:function N(R,P,Q){var O=this._super(R,P,Q);if(O){this.childRenderOnAddCheck(O);}return O;},removeChildren:function F(V,R){var U=V?[V]:(this.children||[]),O=U.length,S;for(S=O-1;S>-1;S--){var Q=U[S],P=Q&&Q.domNode;if(P){var T=this[(Q.slot||this.defaultChildSlot)];if(P.parentNode===T){T.removeChild(P);}}}return this._super(V,R);},childRenderOnAddCheck:function B(Q){if(this.hasRendered&&Q){var O=Q.length,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}else{if(R&&R.hasRendered){this.onchildRenderingChange(R);}}}}},onchildRenderingChange:function K(O){var W=O&&O.domNode;if(!W){return ;}var P=this.defaultChildSlot,V=O.slot||P,Y=this[V],Q=this.children;if(!Y){if(W.parentNode){W.parentNode.removeChild(W);}}else{if(W.parentNode===Y){return ;}if(!this.preserveChildDomOrder){Y.appendChild(W);}else{var R,U;for(U=Q.length-1;U>=0;U--){var X=Q[U];if(X===O){break;}if(V===(X.slot||P)){var Z=X.domNode;if(Z&&Z.parentNode===Y){R=Z;}}}if(R){Y.insertBefore(W,R);}else{Y.appendChild(W);}}}if(mstrmojo.publisher.hasSubs(this.id,"childrenRendered")){var S=Q.length,T;for(T=0;T<S;T++){if(!Q[T].domNode){return ;}}this.raiseEvent({name:"childrenRendered"});}},propagateChildProps:function C(S){var R=this[S],Q=this.children||[],O=Q.length,P;for(P=0;P<O;P++){Q[P].set(S,R);}}});mstrmojo.Container.enabledMarkupMethod=function(){mstrmojo.Widget.enabledMarkupMethod.apply(this,arguments);if(this.shouldPropagateEnabled){if(this.enabled){J.call(this);}else{E.call(this,this.children);}}};}());(function(){mstrmojo.requiresCls("mstrmojo._HasScrollbox","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.string","mstrmojo.Widget");var R=mstrmojo,S=R.array,A=R.css,I=R.dom,P=R.hash,j=R.string,V="selected",H="open",W="leaf",c="loading",f=":",b="li",n="ul",l="idx",m="level";function F(AA,q,x,u){var w=this.renderIndex*this.renderBlockSize,p=x.split(":"),z=parseInt(p[0],10)+w,r=!!this.selectedIndices[z],o=!!this.expandedIndices[z],t=(AA.isLeaf||(!this.dataHelper&&!(AA.items&&AA.items.length)));p[0]=z;return j.apply('<{@tag} class="{@cls}" level="{@level}" idx="{@idx}">{@itemMkp}{@childMkp}</{@tag}>',{tag:b,cls:(r?V:"")+(o?" "+H:"")+(t?" "+W:""),level:q,idx:p.join(":"),itemMkp:this.itemRenderer.render(AA,q,x,this),childMkp:u||""});}function a(z,p,t){var AC=[],r=0,AA=this.itemRenderer,x=AA&&AA.render,o=z&&z.length,w,u,AB,q;AC[r++]="<"+n+">";if(x&&typeof x==="function"&&o){for(q=0;q<z.length;q++){AB=z[q];w=t.concat([q]);u=w.join(f);AC[r++]=F.call(this,AB,p,u,a.call(this,AB.items,p+1,w));}}AC[r]="</"+n+">";return AC.join("");}function L(p,q){var o=q[0];if(q&&q.length===1){return p[o];}return L(p[o].items,q.slice(1));}function K(p,q,r,w,o,u){var t=u.treeHooks[p];if(t&&t.call(u,q,r,w,o)){return ;}A.toggleClass(q,V,p==="select");}function T(p,t,AD,o,AB,x){var AA=x.treeHooks[p],u=AD.items,z=(!u||u.length===0),r=p==="expand",w=x.dataHelper;if(AA&&AA.call(x,t,AD,o,AB)){return ;}if(r&&!w&&z){A.addClass(t,W);return ;}if(r&&w){if(z){if(AD.tp==="search"){A.toggleClass(t,H,r);return ;}A.toggleClass(t,c,true);w.fetch(AD,{success:function AC(AF){var AE=AD.items=AF.items;if(AE&&AE.length>0){t.innerHTML+=a.call(x,AE,(parseInt(o,10)+1),AD._renderIdx.split(f));}else{A.addClass(t,W);}},complete:function q(){A.toggleClass(t,c,false);}});}}A.toggleClass(t,H,r);}mstrmojo.ui.SimpleTree=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.ui.SimpleTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree {@cssClass}" mstrAttach:click>{@itemsHTML}</div>',markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},markupSlots:{scrollboxNode:function M(){return this.domNode;}},items:undefined,dataHelper:undefined,treeHooks:{},init:function h(o){this._super(o);this.expandedIndices={};this.selectedIndices={};},buildRendering:function Z(){var o=this.items,p;if(this.renderOnScroll&&this.items){this.renderIndex=0;o=this.items.slice(this.renderIndex,this.renderBlockSize);}p=o&&o.length;this.itemsHTML=p?a.call(this,o,0,[]):"";this._super();delete this.itemsHTML;},renderOnScroll:false,_cb_scroll:undefined,renderBlockSize:50,renderIndex:0,onscroll:function d(){if(this.renderOnScroll){var r=this.domNode,q=parseInt(r.style.height,10),o=(this.renderIndex+1)*this.renderBlockSize;if(o>=this.items.length){return ;}if(Math.ceil(q+r.scrollTop)>=r.scrollHeight){this.renderIndex++;var p=this.items.slice(o,o+this.renderBlockSize);this.domNode.innerHTML+=a.call(this,p,0,[]);}}},postBuildRendering:function N(){if(!this._cb_scroll){var p=this.id;this._cb_scroll=function o(){var q=mstrmojo.all[p];q.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);if(this._super){this._super();}},getItemMarkup:function(){return'<{@tag} class="{@cls}" style="{@style}">{@n}</{@tag}>';},getItemProps:function U(p,q,o){return{tag:"div",cls:"item ",n:p.n||"",style:"",idx:o};},itemRenderer:{render:function(p,r,o,q){p._renderIdx=o;p._renderLvl=r;return j.apply(q.getItemMarkup(p,r,o),q.getItemProps(p,r,o));},select:function e(p,q,t,o,r){K("select",p,q,t,o,r);},unselect:function G(p,q,t,o,r){K("unselect",p,q,t,o,r);},expand:function B(p,q,t,o,r){T("expand",p,q,t,o,r);},collapse:function O(p,q,t,o,r){T("collapse",p,q,t,o,r);}},_set_items:function Q(p,r){var q=this.items;this.items=r;if(q!==r){var o=this.hasRendered;if(o){this.unrender(false);}if(o){this.render();}return true;}return false;},getTreeItem:function C(o){if(o!==null){return L(this.items,o.split(f));}},getLeafNode:function D(p){var o=this.domNode.children[0].children;if((p>=0)&&(p<o.length)){return o[p];}},addChild:function J(r,p){var u=this,o=u.getTreeItem(r).items,q=r.split(f);q.push(o.length);if(this.hasRendered){var t=this.domNode.getElementsByTagName(b);S.forEach(t,function(x){if(x.getAttribute(l)===r){var w=p[0];var z=document.createElement("div");z.innerHTML=F.call(u,w,parseInt(x.getAttribute(m),10)+1,q.join(f),a.call(u,w.items,parseInt(x.getAttribute(m),10)+2,q));x.lastChild.appendChild(z.firstChild);o.push(w);return false;}return true;});}},updateChild:function g(p,o){var r=this;P.copy(o,r.getTreeItem(p));if(this.hasRendered){var q=this.domNode.getElementsByTagName(b);S.forEach(q,function(t){if(t.getAttribute(l)===p){var u=parseInt(t.getAttribute(m),10);t.innerHTML=r.itemRenderer.render(o,u,p,r)+a.call(r,o.items,u+1,p.split(f));return false;}return true;});}},toggleChildSelection:function k(p,o){var q=this.domNode.getElementsByTagName(b);S.forEach(q,function(r){if(r.getAttribute(l)===p){A.toggleClass(r,V,o);this.selectedIndices[p]=o;return false;}return true;},this);},removeChild:function E(q){var p=q.split(f),t=p.length,r=p[t-1],o=this;if(t>1){p=p.splice(0,t-1);o=this.getTreeItem(p.join(f));o.items.splice(r,1);this.updateChild(o._renderIdx,o);}else{this.items.splice(r,1);this.refresh();}},getItemWithPropName:function Y(q,u,x){var p=S.find(q,u,x);var r,t=[];if(p!==-1){t.push(q[p]);}for(r=0;r<q.length;r++){var o=q[r].items;if(o&&o.length){var w=this.getItemWithPropName(o,u,x);if(w&&w.length){t=t.concat(w);}}}return t;},onclick:function X(w){try{var r=w.target||I.eventTarget(w.hWin,w.e),p=r.tagName.toLowerCase(),AA=I.findAncestorByAttr(r,l,true,this.domNode),o=AA&&AA.node.getAttribute(m),u=AA&&AA.value;if(p===n){return ;}if(u!==null&&!isNaN(parseInt(o,10))){var q={sel:{indicesName:"selected",enabledFn:"select",disabledFn:"unselect"},ex:{indicesName:"expanded",enabledFn:"expand",disabledFn:"collapse"}}[(p!==b)?"sel":"ex"];var x=this[q.indicesName+"Indices"],z=x[u];if(z){delete x[u];}else{x[u]=true;}this.itemRenderer[z?q.disabledFn:q.enabledFn](AA.node,this.getTreeItem(u),o,u,this);}}catch(t){mstrApp.onerror(t);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var C=mstrmojo.dom,B=mstrmojo.hash,E=mstrmojo.css;mstrmojo.Button=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Button",iconClass:"",innerIconClass:"",title:"",text:"&nbsp;",enabled:true,selected:false,markupString:'<div id="{@id}" class="mstrmojo-Button {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:touchstart,click,mousedown,mouseup><div class="mstrmojo-Button-text {@innerIconClass}"></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){E.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){E.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;},onwidthChange:mstrmojo.Widget.widthMarkupMethod},oniconClassChange:function D(J){var K=this.domNode;if(this.hasRendered&&K){K.className=K.className.replace(J.valueWas,"")+" "+J.value;}},onclick:mstrmojo.emptyFn,ontouchend:function I(J){this.onclick(J);}});mstrmojo.Button.newIconButton=function H(L,O,M,J,N){var K={scriptClass:"mstrmojo.Button",title:L,cssClass:O,text:"",onclick:M};if(J){K.bindings=J;}B.copy(N,K);return K;};function F(M,N,J,P){var L=[];if(J){L.push(J);}var O=P&&P.cssClass;if(O){L.push(O);delete P.cssClass;}var K={scriptClass:"mstrmojo.Button",cssClass:L.join(" "),text:M};if(N){K.onclick=N;}return B.copy(P,K);}mstrmojo.Button.newInteractiveButton=function G(M,N,P,O){var L={glowClass:"glow"};if(P&&(C.isFF||C.isWK)){B.copy({onmousedown:function J(){E.applyShadow(this.domNode,0,0,10,P);},onmouseup:function K(){E.removeShadow(this.domNode);}},L);}return F(M,N,"mstrmojo-InteractiveButton",B.copy(O,L));};mstrmojo.Button.newWebButton=function A(K,J,M,L){return F(K,J,"mstrmojo-WebButton"+(M?" hot":""),L);};mstrmojo.Button.newActionButton=function(K,L,M){var J=mstrmojo.Button.newWebButton(K,L,false,M);J.cssClass=J.cssClass+" action-button";return J;};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Widget");var B=mstrmojo.dom;mstrmojo.InlineEditBox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.InlineEditBox",text:null,editMode:false,allowEdit:true,okSave:false,emptyHint:"Enter your text here.",markupString:'<div id="{@id}" class="mstrmojo-InlineEditBox {@cssClass}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-InlineEditBox-text"></div><div class="mstrmojo-InlineEditBox-edit"><input type="text" class="mstrmojo-InlineEditBox-input" mstrAttach:keyup/><img class="mstrmojo-InlineEditBox-ok" src="../images/1ptrans.gif" title="Save"/><img class="mstrmojo-InlineEditBox-cancel" src="../images/1ptrans.gif" title="Cancel"/></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.lastChild;},inputNode:function(){return this.domNode.lastChild.firstChild;},okNode:function(){return this.domNode.lastChild.childNodes[1];},cancelNode:function(){return this.domNode.lastChild.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text||this.emptyHint||"");},oneditModeChange:function(){var H=this.editMode,E=this.domNode,D=this.textNode,G=this.editNode;mstrmojo.css.toggleClass(E,["edit"],H);if(H){D.style.display="none";G.style.display="block";D=this.inputNode;var F=D.style;D.value=this.text||"";F.width=(E.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";F.height=E.clientHeight+"px";D.focus();if(D.createTextRange){var I=D.createTextRange(),C=D.value.length;I.move("character",C);I.select();}}else{D.style.display="block";G.style.display="none";}},onokSaveChange:function(){var C=this.okSave?"inline":"none";this.okNode.style.display=C;this.cancelNode.style.display=C;},onallowEditChange:function(){mstrmojo.css.toggleClass(this.domNode,["disable"],!this.allowEdit);}},onvisibleChange:function A(){if(this.domNode){this.domNode.style.display=(this.visible?"block":"none");}},preclick:function(C){var E=C.e,D=B.eventTarget(C.hWin,E);if(D===this.okNode){this.save();}else{if(D===this.cancelNode){this.cancel();}else{if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}}}},prekeyup:function(C){var E=C.e,D=E.keyCode||E.charCode;if(D===mstrmojo.Enum_Keys.ENTER){this.save();}else{if(D===mstrmojo.Enum_Keys.ESCAPE){this.cancel();}}},_attachEvents:function(){var C=this;if(this.editMode){if(!this._save_handler){this._save_handler=function(){var D=B.eventTarget(self,arguments[0]);if(!B.contains(C.domNode,D,true,document.body)){C.save();}};}B.attachEvent(document.body,"mousedown",this._save_handler);}else{if(this._save_handler){B.detachEvent(document.body,"mousedown",this._save_handler);}}},postBuildRendering:function(){if(this._super){this._super();}this._em_sub=this.attachEventListener("editModeChange",this.id,"_attachEvents");},destroy:function(){this.detachEventListener(this._em_sub);if(this._super){this._super();}},save:function(){this.set("text",this.inputNode.value);this.set("editMode",false);if(this.onSave){this.onSave();}},cancel:function(){this.set("editMode",false);if(this.onCancel){this.onCancel();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.css");var G=mstrmojo.css,E={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"},C="sbClear",K="sbSearch";mstrmojo.SearchWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchWidget",quickSearch:false,placeholderText:"",markupString:'<table id={@id} cellspacing="0" cellpadding="0" class="mstrmojo-SearchWidget mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" style="width:{@width};" placeholder="{@placeholderText}" mstrAttach:keyup,blur/></div></td><td><div class="mstrmojo-SearchBox-clear" id="{@id}'+C+'" mstrAttach:click></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}'+K+'" mstrAttach:click ></div></div></td></tr></table>',markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},clearNode:function(){return this.domNode.rows[0].cells[1].firstChild;},searchNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},markupMethods:{onquickSearchChange:function(){G.toggleClass(this.domNode,"quick-search",this.quickSearch);},onwidthChange:function(){if(this.inputNode&&this.inputNode.style&&this.inputNode.style.width){this.inputNode.style.width=this.width;}}},clearNode:null,searchNode:null,onsearch:mstrmojo.emptyFn,onclear:mstrmojo.emptyFn,prekeyup:function J(M){var L=M.hWin,Q=M.e||L.event;var O=this.getSearchPattern(),N=(O.length===0),P=this.quickSearch;G.toggleClass(this.clearNode,"show",!N&&!P);G.toggleClass(this.searchNode,"clear",!N&&P);if(P){this[N?"clearSearch":"onsearch"](O);}var R=E[Q.keyCode];if(this["on"+R]){this["on"+R](M);}},onEnter:function B(L){this.onsearch(this.getSearchPattern());},onEsc:function A(L){this.clearSearch();},getSearchPattern:function H(){return mstrmojo.string.trim(this.inputNode.value);},preclick:function F(L){var N=L.getTarget(),M=N&&N.id;switch(M.replace(this.id,"")){case K:if(this.quickSearch){this.clearSearch();}else{this.onsearch(this.getSearchPattern());}break;case C:this.clearSearch();break;}},clearSearch:function I(){var L=this.getSearchPattern();this.reset();this.onclear(L);},reset:function D(){this.inputNode.value="";G.removeClass(this.clearNode,"show");G.removeClass(this.searchNode,"clear");}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.css","mstrmojo.string","mstrmojo._IsExprNode","mstrmojo._HasPopup","mstrmojo.Widget");var O=mstrmojo.dom,B=mstrmojo.css,E=mstrmojo.string.htmlAngles,M=mstrmojo.expr,N=M.ET,K=M.FN,A=M.BRANCH_FNS[K.NOT],D={};D[K.BETWEEN]=1;D[K.NOT_BETWEEN]=1;var C={"*":function(Q,P){return Q?('<span class="mstrmojo-unknown">'+(E(Q.n||Q.xml)||"...")+"</span>"):null;}};function H(Q,P,S,R){return S&&((R?'<span class="mstrmojo-ListIcon t'+R+'"></span>':"")+'<span class="mstrmojo-text mstrmojo-embedobj">'+E(S)+"</span>");}C[N.R]=function(Q,P){return H(Q,P,Q.r&&Q.r.n,Q.r&&Q.r.t);};C[N.F]=function(Q,P){return H(Q,P,Q.f&&Q.f.n,Q.f&&Q.f.t);};C[N.XML]=function(Q,P){return H(Q,P,Q.n||Q.p&&Q.p.n||Q.xml,Q.p&&Q.p.t);};C[N.AE]=function(V,S){var R=[];if(V&&V.a&&V.a.n){R.push('<span class="mstrmojo-text mstrmojo-attr">'+E(V.a.n)+"</span>");if(V.fn!==M.FN.IN_LIST){R.push('<span class="mstrmojo-text mstrmojo-fn">'+E(M.fnName(V.et,V.fn,V.fnt))+"</span>");}var U=V.es,P=U&&U.length||0;if(P){R.push('<span class="mstrmojo-elems">');var Q=R.length;for(var T=0;T<P;T++){R[Q++]='<span class="mstrmojo-text mstrmojo-elem">';R[Q++]=E(U[T].n);if(T<P-1){R[Q++]=", ";}R[Q++]="</span>";}R[Q++]="</span>";}else{R.push('<span class="mstrmojo-text mstrmojo-emptyelems">(Empty)</span>');}}return R.join("");};C[N.AQ]=function(W,X){var T=[];if(W&&W.a&&W.a.n){T.push('<span class="mstrmojo-text mstrmojo-attr">'+E(W.a.n)+"</span>");if(W.fm&&W.fm.n){T.push('<span class="mstrmojo-text mstrmojo-form">'+E(W.fm.n)+"</span>");if(W.fn!=null){T.push('<span class="mstrmojo-text mstrmojo-fn">'+E(M.fnName(W.et,W.fn,W.fnt,W.fm.dtp))+"</span>");var P=M.fnCstCount(W.fn,W.fnt);if(W.et===N.AC){if(P>=1){if(W.a2&&W.a2.n){T.push('<span class="mstrmojo-text mstrmojo-attr2">'+E(W.a2.n)+"</span>");if(W.fm2&&W.fm2.n){T.push('<span class="mstrmojo-text mstrmojo-form2">'+E(W.fm2.n)+"</span>");}}if(P>1){T.push('<span class="mstrmojo-text mstrmojo-btwn">'+X.betweenText+"</span>");if(W.a3&&W.a3.n){T.push('<span class="mstrmojo-text mstrmojo-attr3">'+E(W.a3.n)+"</span>");if(W.fm3&&W.fm3.n){T.push('<span class="mstrmojo-text mstrmojo-form3">'+E(W.fm3.n)+"</span>");}}}}}else{if(W.et===N.AL){var U=W.cs,Y=[];for(var R=0,V=U.length;R<V;R++){Y.push(U[R].v);}T.push('<span class="mstrmojo-text mstrmojo-c1">'+Y.join(mstrConfig.listSep)+"</span>");}else{if(P>=1){var U=W.cs,S=U&&U[0];T.push('<span class="mstrmojo-text mstrmojo-c1">'+E(S&&S.p&&S.p.n||S&&S.v)+"</span>");if(P>1){var Q=U&&U[1];T.push('<span class="mstrmojo-text mstrmojo-btwn">'+X.betweenText+"</span>");T.push('<span class="mstrmojo-text mstrmojo-c1">'+E(Q&&Q.p&&Q.p.n||Q&&Q.v)+"</span>");}}}}}}}return T.join("");};C[N.AC]=C[N.AQ];C[N.AL]=C[N.AQ];C[N.MQ]=function(f,g){var e=[],Z=f&&f.m,k=Z&&Z.n;if(k){var Q=f.fnt,U=M.FNT.PER,c=M.FNT.RANK;k=Q===U?mstrmojo.desc(2787,"Percentage of ##").replace("##",k):Q===c?mstrmojo.desc(2788,"Rank of ##").replace("##",k):k;e.push('<span class="mstrmojo-text mstrmojo-metric">'+E(k)+"</span>");if(f.fn!=null){e.push('<span class="mstrmojo-text mstrmojo-fn">'+E(M.fnName(f.et,f.fn,Q,M.DTP.REAL))+"</span>");var X=M.fnCstCount(f.fn,Q);if(f.et==M.ET.MC){if(X>=1){var j=(f.m2&&f.m2.n)||"?";e.push('<span class="mstrmojo-text mstrmojo-m2">'+E(j)+"</span>");if(X>1){e.push('<span class="mstrmojo-text mstrmojo-btwn">'+g.betweenText+"</span>");var S=(f.m3&&f.m3.n)||"?";e.push('<span class="mstrmojo-text mstrmojo-m3">'+E(S)+"</span>");}}}else{if(X>=1){var R=f.cs,a=R&&R[0];var P=function(h){var d=h.v;if(f.fnt==U){if(d.replace){h.v=d.replace(/%$/,"");}d=h.v+"%";}return d;};e.push('<span class="mstrmojo-text mstrmojo-c1">'+E(a&&a.p&&a.p.n||a&&a.v&&P(a))+"</span>");if(X>1){var Y=R&&R[1];e.push('<span class="mstrmojo-text mstrmojo-btwn">'+g.betweenText+"</span>");e.push('<span class="mstrmojo-text mstrmojo-c2">'+E(Y&&Y.p&&Y.p.n||Y&&Y.v&&P(Y))+"</span>");}}}var b=f.dmy&&f.dmy.uts,W=b&&b.length;if(W){e.push('<span class="mstrmojo-text mstrmojo-at">'+g.atText+"</span>");e.push('<span class="mstrmojo-dmy">');for(var V=0;V<W;V++){var T=b[V];e.push('<span class="mstrmojo-text mstrmojo-dmyunit">');e.push(E(T.utgt?T.utgt.n:T.n));if(V<W-1){e.push(",");}e.push("</span>");}e.push("</span>");}}}return e.join("");};C[N.MC]=C[N.MQ];function G(P){var Q=P.data;if(Q.not){return'<span class="mstrmojo-text mstrmojo-not">'+A+"</span>";}return"";}function F(P){var R=P.data,Q=C[R&&R.et]||C["*"];return G(P)+((Q&&Q(R,P))||('<span class="mstrmojo-text">'+P.emptyText+"</span>"));}mstrmojo.ConditionNode=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._IsExprNode,mstrmojo._HasPopup],{scriptClass:"mstrmojo.ConditionNode",data:null,editable:false,prefixedAndOrEditable:false,markupString:'<div id="{@id}" class="mstrmojo-cond mstrmojo-ConditionNode {@cssClass}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-cond-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-onhoverparent mstrmojo-cond-contents {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-text {@cssClass}" mstrAttach:click></span><span class="mstrmojo-cond-text-postfix {@cssClass}"></span><span class="mstrmojo-rel mstrmojo-cond-popupNode {@cssClass}"></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" tooltip="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" /></span></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},condNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.childNodes[1].firstChild;},textPostfixNode:function(){return this.domNode.childNodes[1].childNodes[1];},popupNode:function(){return this.domNode.childNodes[1].childNodes[2];}},markupMethods:{onprefixedAndOrEditableChange:function(){B.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},oneditableChange:function(){B.toggleClass(this.textNode,["editable"],this.editable);},onselectedChange:function(){B.toggleClass(this.condNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=F(this);this.textPostfixNode.innerHTML=this.getConditionTextPostfix();}},betweenText:mstrmojo.desc(308,"and"),atText:mstrmojo.desc(5923,"at"),emptyText:mstrmojo.desc(7930,"Empty condition"),init:function L(P){this._super(P);this.markupString=this.markupString.replace("{@_prefixAndOrToolsMarkup}",this.getPrefixAndOrToolsMarkup());},getConditionTextPostfix:function(){return"";},del:function J(){var P=this.parent;if(P&&P.remove&&this.data){P.remove(this.data);}},isEmpty:function(){var Q=this.data,P=Q&&Q.et,R=P&&mstrmojo.expr.ET2TGT[P];return !(R&&Q[R]);},isSelectableArea:function(P){return O.contains(this.condNode,P,true);},preclick:function I(P){var R=null,Q=O.eventTarget(P.hWin,P.e);if(O.contains(this.prefixNode,Q,true)){R="andor";}else{if(O.contains(this.textNode,Q,true)){R="condition";}else{if(O.contains(this.textPostfixNode,Q,true)){O.stopPropogation(P.hWin,P.e);return false;}}}P.part=R;}});mstrmojo.ConditionNode.getFunctionNode=F;})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");var C=mstrmojo.css,G=mstrmojo.array;function F(H,J){var I={searchMetadata:{taskId:"searchMetadata",styleName:this.searchStyleName,rootFolderID:this.rootID,searchPattern:this.searchPattern+"*",nameWildcards:(this.qse?16:1),quickSearch:this.qse,sortKey:(this.qse?-1:6),blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:1,folderBrowserStyle:0,includeAncestorInfo:"true",includeObjectDesc:this.includeObjectDesc,searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseFolder:{taskId:"searchMetadata",rootFolderID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,recursive:this.hierarchical?0:(this.searchXML?"":1),folderBrowserStyle:this.hierarchical?1:0,includeAncestorInfo:String(!!this.hierarchical),searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseElements:{taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,filterXML:this.filterXML||"",searchPattern:this.searchPattern||"",matchCase:!!this.matchCase,dataSourcesXML:this.dataSourcesXML||"",includeFormNames:!!this.collectForms,includeFormValues:!!this.bIncludeFormValues,displayedForms:this.displayedForms||1,dimensionID:this.dimensionId||""}}[H]||{};if(typeof J==="object"){mstrmojo.hash.copy(J,I);}return I;}var B="##searchPattern";mstrmojo.SearchBox2=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchBox2",taskId:"searchMetadata",rootID:null,searchStyleName:"MojoFolderStyle",objectTypes:"3,14,256,257,1024,1027,2048,3072,10",token:{searchMetadata:/\//,browseElements:/(^-)|(,)|( OR )|( AND)|([<>]=?)|(&)|( )|(["\[\]\/])/},blockCount:50,blockBegin:1,minSearchLength:2,matchCase:false,enableMatchCase:true,supportIncFetch:true,quickSearch:false,searchAfterSearchPatternRestored:false,includeObjectDesc:true,forceResetCache:false,onUpdateSearchParams:mstrmojo.emptyFn,markupString:'<table id={@id} cellspacing=0 cellpadding=0 class="mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" mstrAttach:keyup,blur /></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}sbSearch" mstrAttach:click ></div></div></td><td><div class="mstrmojo-SearchBox-options" style="{@cssTextShowMC}"><input id="{@id}sbMatchCase" type="checkbox" mstrAttach:click /><label for="{@id}sbMatchCase">'+mstrmojo.desc(4326,"Case Sensitive")+"</label></div></td></tr></table>",markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},searchNode:function(){return this.domNode.rows[0].cells[1].firstChild.firstChild;},optionNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},preBuildRendering:function(){this.cssTextShowMC=this.enableMatchCase?"":"display: none";},postBuildRendering:function(){if(this._super){this._super();}this.matchCase=this.optionNode.checked;},onkeyup:function E(H){var J=this;var I=J.searchTimer;if(I){window.clearTimeout(I);}J.searchTimer=window.setTimeout(function(){J.onkeyupDelayed(H);delete J._searchTimer;},parseInt(H.e.keyCode||H.e.charCode,10)===13?0:J.searchDelay);},onkeyupDelayed:function A(I){var H=I.hWin,K=I.e||H.event;var J=mstrmojo.string.trim(this.inputNode.value);if(this.searchNode){C.toggleClass(this.searchNode,["clear"],J.length>0);}this.showTaskError=false;this.click2Search=false;if(J.length==0||this.autoSubmit||this.onEnter&&K.keyCode===13){this._onsearch();}},onEnter:function(){this._onsearch();},onclick:function(I){var H=I.hWin,K=I.e||H.event,M=K.target||K.srcElement,L=M&&M.id;switch(L.replace(this.id,"")){case"sbDown":if(this.enableMatchCase){var J=this.optionNode.parentNode.style;J.display=J.display=="block"?"none":"block";}break;case"sbSearch":if(this.inputNode.value.length>0){this.clearSearch();}break;case"sbMatchCase":this.set("matchCase",this.optionNode.checked);break;case"sbSpinner":break;}},clearSearch:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);var I=this.searchCache,H=this.rootID;if(I&&I[H]){I[H][B]="";}this._onsearch(true);},onmatchCaseChange:function(){this.matchCaseChanged=true;this._onsearch();},onrootIDChange:function(){this.rootChanged=true;this._setupCache(this.forceResetCache);var I=this.searchCache[this.rootID];if(I){var H=I[B]||"";this.inputNode.value=H;if(H.length>0){if(H.length>=this.minSearchLength&&this.searchAfterSearchPatternRestored){this._onsearch();}}}},getRootID:function(){},contentWidget:null,_notifyContentWidget:function(I){var H=this.contentWidget||this;H.set("items",I[0]);if(this.supportIncFetch){var J=I[1],L=I[2],K=this.blockCount;H.set("ifs",{np:Math.floor(J/K)+((J%K>0)?1:0),cp:Math.floor(L/K)+((L%K>0)?1:0)});}},_onsearch:function(H){this.getRootID();this._setupCache();var K=mstrmojo.string.trim(this.inputNode.value);if(K.length===0){H=true;}var L=this.token[this.taskId];if(L.test(K)){}if(this.searchPattern==K&&!this.rootChanged&&!this.matchCaseChanged&&!this.click2Search){return ;}var M=this.rootID,J=this.searchCache[M];if((K.length<this.minSearchLength&&!this.click2Search)&&!H){if(this.searchPattern&&this.searchPattern.length>=this.minSearchLength){this._notifyContentWidget(J[M]);this.searchPattern=K;}}else{this.searchPattern=K;J[B]=this.searchPattern;var I=this.filterCache(K,J,H);if((this.click2Search||I===null)&&!H){this.blockBegin=1;this.fetch();return ;}else{this._notifyContentWidget(I);}}J[B]=K;},_setupCache:function(J){var K=this.searchCache,I=this.rootID;if(K&&(J||!K[I])){K[I]=K[I]||{};var H=this.contentWidget&&this.contentWidget.items||this.rootCacheItems||[];K[I][I]=[H,this.totalSize||0,this.blockBegin||1].concat();}},taskCallId:0,path:mstrConfig.taskURL,method:"POST",serverRequest:function D(H,I){mstrmojo.xhr.request("POST",this.path,I,H,undefined,this.XServer,this.baseParams);},fetch:function(){this.rootChanged=false;this.matchCaseChanged=false;if(this.spinnerNode){this.spinnerNode.style.display="block";}if(this.preFetch){this.preFetch();}var H=this,I=F.apply(this,[this.taskId]);I.searchPattern=this.searchPattern;this.onUpdateSearchParams(I);var J={success:function(K){var L=K.items||K.es||[];L=[L,K.totalSize||K.sz||0,K.blockBegin||K.bb];mstrmojo.all[H.id].searchCache[H.rootID][(I.searchPattern.length==0?H.rootID:H.buildIndex(I.searchPattern))]=L;H._notifyContentWidget(L);},failure:function(K){if(H.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+K.getResponseHeader("X-MSTR-TaskFailureMsg"));}},complete:function(){if(H.spinnerNode){H.spinnerNode.style.display="none";}if(H.postFetch){H.postFetch();}}};this.serverRequest(I,J);},fetchPage:function(H){this.blockBegin=H*this.blockCount+1;this.fetch();},filterCache:function(J,M,I){var H=M&&M[I?this.rootID:this.buildIndex(J)];if(H){return H;}var K=this.token[this.taskId];if(K.test(J)||this.totalSize>this.blockCount){return null;}var O=J.replace(/.$/,"");H=M&&M[this.buildIndex(O)];while(H===undefined&&(O=O.replace(/.$/,"")).length>0){H=M&&M[this.buildIndex(O)];}if(H!==undefined){if(H[1]>this.blockCount){return null;}var L=H[0],N=[];G.forEach(L,function(P){if(P.n.search(new RegExp(J,this.matchCase?"":"i"))>-1){N.push(P);}});this.totalSize=N.length;return(M[this.buildIndex(J)]=[N,N.length,this.blockBegin].concat());}return null;},buildIndex:function(H){if(H.replace(/^\s|\s$/g,"").length===0){return"";}return !this.matchCase?H.toUpperCase():H+"::0";},init:function(H){if(this._super){this._super(H);}this.qse=mstrApp.useQuickSearch&&mstrApp.useQuickSearch()||0;this.autoSubmit=this.quickSearch&&(mstrApp.searchAutoComplete&&mstrApp.searchAutoComplete()||false);this.searchDelay=mstrApp.searchAutoCompleteDelay&&mstrApp.searchAutoCompleteDelay()||0;this.xhr=new mstrmojo.SimpleXHR();this.searchCache=this.searchCache||{};},clear:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");var E=mstrmojo.Widget;mstrmojo.ui._IsPulldown=mstrmojo.provide("mstrmojo.ui._IsPulldown",{scriptClass:"mstrmojo.ui._IsPulldown",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-text {@cssTextClass}" title="{@title}" style="{@labelCssText}">{@value}</div><div class="container"></div></div>',markupSlots:{selectedNode:function D(){return this.domNode.firstChild;},containerNode:function A(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:E.visibleMarkupMethod,onheightChange:E.heightMarkupMethod,onwidthChange:E.widthMarkupMethod,onvalueChange:function F(){this.selectedNode.innerHTML=this.value||"";},onenabledChange:mstrmojo.Widget.enabledMarkupMethod},getPopupList:mstrmojo.emptyFn,anchorSlot:"selectedNode",postBuildRendering:function B(){this._super();this.getPopupList().set("items",this.items);var G=this.selectedIndex,H=this.selectedIndices;if(G!==undefined){this.set("selectedIndex",G);}if(H!==undefined){this.set("selectedIndices",mstrmojo.hash.copy(H||{}));}},onitemsChange:function C(){var G=this.getPopupList();if(G){G.set("items",this.items);}},onPopupWidgetOpened:function(){var G=this.getPopupList();if(G&&(!G.items||G.items.length===0)){G.close();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash");function A(H,E,G,F){var D=mstrmojo.hash.copy(F,{props:{left:{isStyle:true,start:H,stop:E,suffix:"px",ease:mstrmojo.ease.linear}},duration:G});(new mstrmojo.fx.AnimateProp(D)).play();}function B(K,N,G,L){var I=K.domNode,M=I.offsetWidth,D=K.scrollableIncFetch;var E=K.hasAnimation&&(!(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent))||Number(RegExp.$1)>3.5),J=L?1:-1,F=parseInt(M,10)*J,H=E?500:0;A(0,-F,H,{target:G,duration:H,preStart:function(){this.target.style.overflowY="hidden";},onEnd:function(){this.target.style.display="none";}});A(F,0,H,{target:N,preStart:function(){this.target.style.display="block";this.target.style.overflowY=(D?"visible":"auto");}});if(K.waiting){A(0,-F,H,{widget:K,slot:"loaderNode",onEnd:function(){this.widget.waiting=false;}});}}var C=function(D){var E=D.currentPage;if(E===D.p1Node){E=D.p2Node;}else{E=D.p1Node;}D.currentPage=E;};mstrmojo.Booklet=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Booklet",pageClass:"mstrmojo-BookletPage",markupString:'<div id="{@id}" class="mstrmojo-Booklet {@cssClass}" style="{@cssText}"><div id="{@id}_p1" class="mstrmojo-BookletPage" ></div><div id="{@id}_p2" class="mstrmojo-BookletPage" style="left:-100%;"></div><div id="{@id}_ldr" class="mstrmojo-BookletLoader" ></div></div>',markupSlots:{containerNode:function(){return this.domNode;},p1Node:function(){return this.domNode.firstChild;},p2Node:function(){return this.domNode.childNodes[1];},loaderNode:function(){return this.domNode.childNodes[2];}},markupMethods:{onnextChange:function(){var G=this.next;if(!G){return ;}var D=this.currentPage,F=this.p1Node,E=this.currentPage=(D==F)?this.p2Node:F;if(!(G instanceof mstrmojo.Obj)){G=this.next=mstrmojo.insert(G);}if(!G.hasRendered){G.placeholder=E.appendChild(document.createElement("span"));G.render();}else{if(E.firstChild){E.replaceChild(G.domNode,E.firstChild);}else{E.appendChild(G.domNode);}}this.set("waiting",false);if(E&&D){B(this,E,D,this.turnDirFwd);}else{if(this.scrollableIncFetch){E.style.overflowY="visible";}}},onwaitingChange:function(D){this.loaderNode.style.left=(this.waiting)?0:"-100%";},onheightChange:function(D){if(this.height){this.domNode.style.height=this.height;}},onwidthChange:function(D){if(this.width){this.domNode.style.width=this.width;}}},enabled:true,waiting:false,next:null,currentPage:null,turnDirFwd:true,hasAnimation:true,scrollableIncFetch:false,FORWARD:true,REVERSE:false,turnFwd:function(D){this.turn(D,this.FORWARD);},turnBack:function(D){this.turn(D,this.REVERSE);},turn:function(D,E){this.set("turnDirFwd",E);this.set("next",D);}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Widget","mstrmojo._ListSelections");var E=mstrmojo.dom;mstrmojo.ListBase=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.ListBase",selectionPolicy:null,itemRenderer:null,icnCssText:"",icnCss:"",markupString:'<div id="{@id}" tstid="{@tstid}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div>',markupSlots:{itemsContainerNode:function G(){return this.domNode.firstChild;},scrollboxNode:function A(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},autoHide:false,itemsContainerNode:null,_markupPrefix:null,_markupSuffix:null,_itemPrefix:null,_itemSuffix:null,init:function J(K){this._super(K);if(this.autoHide){this.visible=!!(this.items&&this.items.length);}},buildRendering:function D(){this.itemsHtml="";var K=(this.renderOnScroll?this.items&&((this.renderIndex+1)*this.renderBlockSize):this.items&&this.items.length);if(K){this.itemsHtml=this._buildItemsMarkup(0,K-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");}this._super();delete this.itemsHtml;this.addSlots({itemsNode:this.itemsContainerNode.firstChild});},_buildItemsMarkup:function B(K,N,U,L,V,M){var W=[],Q=0;W[Q++]=U||"";var P=this.itemRenderer,T=P&&P.render;if(T&&typeof T==="function"){var R=this.items,S=Math.min(N+1,((R&&R.length)||0)),O;for(O=K;O<S;O++){W[Q++]=V||"";W[Q++]=T(R[O],O,this);W[Q++]=M||"";}}W[Q+1]=L||"";return W;},onselectionChange:function H(V){if(!V){return ;}var S=this.itemRenderer;if(!S){return ;}var O=S.unselect,R=this.items||[],W=V.removed,N,M,L,P,X;if(O&&W){for(P=0,X=W.length;P<X;P++){N=W[P];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){O(L,R[N],M,this);}}}var K=S.select,U=V.added,Q,T;if(K&&U){for(Q=0,T=U.length;Q<T;Q++){N=U[Q];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){K(L,R[N],M,this);}}}if(this.onchange){this.onchange({added:V.added,removed:V.removed});}},_set_items:function C(N,K){this.renderIndex=0;if(this.autoHide){this.set("visible",!!(K&&K.length));}var M=this.items;this.items=K;if(M!==K){var L=this.hasRendered;if(L){this.unrender(false);}this.clearSelect();if(L){this.render();}return true;}return false;},onItemContextMenu:mstrmojo.emptyFn,oncontextmenu:function F(K){E.preventDefault(window,K.e);var M=K.getTarget(),L=this.getItemFromTarget&&this.getItemFromTarget(M);if(L){if(this.onItemContextMenu(L,K)){K.cancel();}}},_getItemNode:function I(K){var L=this.itemsContainerNode;return(L&&L.childNodes[K])||null;},renderOnScroll:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash","mstrmojo.css","mstrmojo.string");function A(C,B){return mstrmojo.hash.copy(B,{label:"",tabIndex:"",cssDisplay:"inline",name:null,markupString:'<span id="{@id}" class="'+C+' {@cssClass}" style="{@cssText}" title="{@tooltip}"><input id="{@id}_input"  type="{@type}" name="{@name}" value="{@value}" tabIndex="{@tabIndex}" mstrAttach:click tstid="{@tstid}"/><label for="{@id}_input">{@label}</label></span>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},labelNode:function(){return this.domNode.childNodes[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";},onenabledChange:function(){this.inputNode.disabled=!this.enabled;mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,"disabled");},onlabelChange:function(){this.labelNode.innerHTML=mstrmojo.string.encodeHtmlString(this.label);},oncheckedChange:function(){this.inputNode.checked=this.checked;}},checked:false,preclick:function(){this.set("checked",this.inputNode.checked);},isChecked:function(){return this.inputNode.checked;}});}mstrmojo.CheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox",{scriptClass:"mstrmojo.CheckBox",type:"checkbox"}));mstrmojo.ImageCheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox mstrmojo-ImageCheckBox",{scriptClass:"mstrmojo.CheckBox",type:"image",cssDisplay:"block",preclick:function(){this.set("checked",!this.checked);},postCreate:function(){this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.oncheckedChange=function(){mstrmojo.css.toggleClass(this.inputNode,["checked"],this.checked);};},postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";if(this._super){return this._super();}return true;}}));mstrmojo.RadioButton=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-RadioButton",{scriptClass:"mstrmojo.RadioButton",type:"radio",postBuildRendering:function(){if(mstrmojo.dom.isIE){this.inputNode.checked=this.checked;}}}));}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom");var B="mstrmojo-Image";mstrmojo.Image=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Image",markupString:'<div id="{@id}" class="'+B+' {@cssClass}" style="{@cssText}" mstrAttach:click><image src="{@src}" mstrAttach:load /></div>',markupSlots:{imgNode:function(){return this.domNode.firstChild;}},markupMethods:{onsrcChange:function(){var C=this.imgNode;if(C){C.src=this.src||"../javascript/mojo/css/images/1ptrans.gif";}},oncssClassChange:function(){var C=this.domNode;if(C){C.className=this.cssClass||B;}},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},src:"",getImageSize:function A(){var C=this.imgNode;return{w:C.clientWidth,h:C.clientHeight};}});mstrmojo.Image.baseCssClass=B;}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport");var BasicAggMap={"8107C31BDD9911D3B98100C04F2233EA":"Sum","548C68A0F60811D3ACC300C04F0423DE":"StdevP","8107C31FDD9911D3B98100C04F2233EA":"Max","8107C331DD9911D3B98100C04F2233EA":"GeoMean",B2C0FA4220C711D6AD1400C04F0423DE:"First","8107C32CDD9911D3B98100C04F2233EA":"Product",B2C0FA4020C711D6AD1400C04F0423DE:"Greatest","8107C330DD9911D3B98100C04F2233EA":"Var","8107C32FDD9911D3B98100C04F2233EA":"Stdev","8107C32DDD9911D3B98100C04F2233EA":"Median",B2C0FA4320C711D6AD1400C04F0423DE:"Last","8107C31CDD9911D3B98100C04F2233EA":"Count","8107C31DDD9911D3B98100C04F2233EA":"Avg","8107C31EDD9911D3B98100C04F2233EA":"Min","8107C32EDD9911D3B98100C04F2233EA":"Mode",D64F1B10F6C011D3ACC300C04F0423DE:"VarP",B2C0FA4120C711D6AD1400C04F0423DE:"Least"},RankMap={"8107C326DD9911D3B98100C04F2233EA":"Rank"},OLAPAggMap={D221F90EB35540E3A1204ED6CC9A8267:"Avg",D221F90FB35540E3A1204ED6CC9A8267:"Count",D221F910B35540E3A1204ED6CC9A8267:"Max",D221F911B35540E3A1204ED6CC9A8267:"Min",D221F90DB35540E3A1204ED6CC9A8267:"Sum"},MovingAggMap={"8107C32ADD9911D3B98100C04F2233EA":"Avg","8107C350DD9911D3B98100C04F2233EA":"Count","8107C34BDD9911D3B98100C04F2233EA":"Max","8107C34CDD9911D3B98100C04F2233EA":"Min","8107C32BDD9911D3B98100C04F2233EA":"Sum"},RunningAggMap={"8107C329DD9911D3B98100C04F2233EA":"Avg","8107C354DD9911D3B98100C04F2233EA":"Count","8107C351DD9911D3B98100C04F2233EA":"Max","8107C352DD9911D3B98100C04F2233EA":"Min","8107C328DD9911D3B98100C04F2233EA":"Sum"},BandingMap={"8107C337DD9911D3B98100C04F2233EA":"Banding","8107C338DD9911D3B98100C04F2233EA":"BandingC","8107C339DD9911D3B98100C04F2233EA":"BandingP"};function _sortFunctions(fcts){var fs=function(a,b){return mstrmojo.array.stringSorter(a.n,b.n);},i,len;fcts=fcts.sort(fs);for(i=0,len=fcts.length;i<len;i++){fcts[i].fns=fcts[i].fns.sort(fs);}return fcts;}function getFuncCatIndex(fcts,funcDid){var len=fcts.length,ci;for(ci=0;ci<len;ci++){var fns=fcts[ci].fns;if(mstrmojo.array.find(fns,"did",funcDid)>-1){return ci;}}return -1;}function buildTaskParams(params){var qse=mstrApp&&mstrApp.useQuickSearch&&mstrApp.useQuickSearch();params=mstrmojo.hash.copy(params,{taskId:"searchMetadata",recursive:true,styleName:"MojoFolderStyle",includeObjectDesc:true,includeAncestorInfo:false});if(qse){params.quickSearch=qse;params.nameWildcards=16;params.sortKey=-1;}return params;}function serverRequest(callback,taskParams){if(mstrApp.serverRequest){mstrApp.serverRequest(taskParams,callback);}else{window.$MAPF=function(){return false;};this.getServerProxy().request(callback,taskParams,false,{});}}mstrmojo.ME.MetricDataService=mstrmojo.provide("mstrmojo.ME.MetricDataService",{rootFolderTypes:{ALL:39,FILTERS:4,METRICS:5,FACTS:29,SCHEMA:24,ATTRIBUTES:26,TRANSFORMATIONS:38},blockCount:10,suggestCount:10,suggestDelay:200,noCache:true,functions:null,metricComponents:null,functionsDetails:null,getServerProxy:function getServerProxy(){if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}return this.serverProxy;},getMetricDefintion:function getMetricDefintion(params,callbacks){var taskParams={taskId:"getMetricDefinition",metricId:params.id,outputFlags:65599};if(params.msgID){taskParams.msgID=params.msgID;}serverRequest.call(this,callbacks,taskParams);},validateMetric:function validateMetric(params,callbacks){var taskParams={taskId:"validateMetric",metricId:params.metricId,tokenStreamXML:params.tokenStreamXML,metricXML:params.metricXML,outputFlags:327695};if(mstrmojo.string.isEmpty(params.metricId)){taskParams.isNew=true;}if(params.msgID){taskParams.msgID=params.msgID;}if(params.formID){taskParams.frmid=params.formID;}if(params.isIDForm){taskParams.isIDForm=params.isIDForm;}if(params.objectType){taskParams.objectType=params.objectType;}serverRequest.call(this,callbacks,taskParams);},getMetricComponents:function getMetricComponents(params,callbacks){var me=this,mc=this.metricComponents;if(!this.noCache&&mc&&mc.items.length==mc.sz){callbacks.success(mc);return ;}callbacks.success=mstrmojo.func.composite([callbacks.success,function(res){if(me.metricComponents&&me.metricComponents.items){me.metricComponents.items.push(res.items);}else{me.metricComponents=res;}}]);var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||24,objectType:params.objectType||"12,13,43"});serverRequest.call(this,callbacks,taskParams);},getAttributes:function getAttributes(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||26,objectType:12});serverRequest.call(this,callbacks,taskParams);},getFacts:function getFacts(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||29,objectType:13});serverRequest.call(this,callbacks,taskParams);},getMetrics:function getMetrics(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||5,objectType:4});if(params.isVerify){taskParams.nameWildcards=2;}serverRequest.call(this,callbacks,taskParams);},getFunctions:function getFunctions(callbacks){var me=this,wss=window.sessionStorage,fcts=this.functions||(wss&&wss.getItem("functions")),localeId=wss&&wss.getItem("mstrLocaleId"),cLocaleId=mstrApp&&mstrApp.localeId;if(fcts&&localeId==cLocaleId){fcts=_sortFunctions(eval("("+fcts+")").fncs);callbacks.success(fcts);}else{var cb={failure:callbacks.failure,textResponse:true},taskParams={taskId:"getSystemFunctions",includeFunctionDetails:true,functionFlags:2|2147483648,includeFunctionHelpTopic:true};cb.success=function(res){if(typeof res==="string"||!mstrApp.isSingleTier){if(wss){wss.setItem("functions",res);wss.setItem("mstrLocaleId",cLocaleId);}me.functions=res;fcts=_sortFunctions(eval("("+res+")").fncs);}else{fcts=_sortFunctions(res.fncs);me.functions=JSON.stringify(res);}callbacks.success(fcts);};serverRequest.call(this,cb,taskParams);}},getAggFunctions:function getAggFunctions(){if(this._aggFunctions){return this._aggFunctions;}var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.array.filter(fcts[this.getBasicCategoryIndex(fcts)].fns,function(item){var did=item.did,retVal;if(did!=="B2C0FA4020C711D6AD1400C04F0423DE"&&did!=="B2C0FA4120C711D6AD1400C04F0423DE"){retVal=BasicAggMap[did];}return retVal;});return fcts;},getOLAPAggFunctions:function getOLAPAggFunctions(type){var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.array.filter(fcts[this.getOLAPCategoryIndex(fcts)].fns,function(item){switch(type){case"moving":return MovingAggMap[item.did];case"running":return RunningAggMap[item.did];case"olap":default:return OLAPAggMap[item.did];}return false;});return fcts;},getFunctionCatList:function getFunctionCatList(){if(this._functionCatList){return this._functionCatList;}var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.hash.make(fcts,mstrmojo.Arr);this._functionCatList=fcts;return fcts;},getCategoryIndex:function getCategoryIndex(funcDid,fcts){return getFuncCatIndex(fcts||this.getFunctionCatList(),funcDid);},getBasicCategoryIndex:function getBasicCategoryIndex(fcts){var Agg_Func_Greatest="B2C0FA4020C711D6AD1400C04F0423DE";return getFuncCatIndex(fcts||this.getFunctionCatList(),Agg_Func_Greatest);},getDataMiningCatIndex:function getDataMiningCatIndex(fcts){var DataMining_Func_MiningModel="F17CD4F3FF134D91B80DDAB9CA73C919";return getFuncCatIndex(fcts||this.getFunctionCatList(),DataMining_Func_MiningModel);},getDateTimeCategoryIndex:function getDateTimeCategoryIndex(fcts){var DateTime_Func_Date="C50F2A4F75AE49D6B20E00224967B500";return getFuncCatIndex(fcts||this.getFunctionCatList(),DateTime_Func_Date);},getStringCategoryIndex:function getStringCategoryIndex(fcts){var String_Func_Concat="6F7DF5FF449111D5BEA300B0D01A55EF";return getFuncCatIndex(fcts||this.getFunctionCatList(),String_Func_Concat);},getOLAPCategoryIndex:function getBasicCategoryIndex(fcts){var OLAP_Func_Avg="D221F90EB35540E3A1204ED6CC9A8267";return getFuncCatIndex(fcts||this.getFunctionCatList(),OLAP_Func_Avg);},getInternalCategoryIndex:function getInternalCategoryIndex(fcts){var INTER_Func_Band="8107C337DD9911D3B98100C04F2233EA";return getFuncCatIndex(fcts||this.getFunctionCatList(),INTER_Func_Band);},getFunctionDetails:function getFunctionDetails(params,callbacks){var taskParams={taskId:"getSystemFunctions",functionId:params.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};serverRequest.call(this,callbacks,taskParams);},getTransformations:function getTransformations(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||38,objectType:43});serverRequest.call(this,callbacks,taskParams);},getFilters:function getFilters(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||4,objectType:1});serverRequest.call(this,callbacks,taskParams);},getAttributeForms:function getAttributeForms(params,callbacks){var taskParams={taskId:"getAttributeForms",attributeID:params.attributeID,displayedForms:params.displayedForms,styleName:"WidgetElementListStyle"};serverRequest.call(this,callbacks,taskParams);},getSubtotalFunctions:function getSubTotalFunctions(params,callbacks){var taskParams=buildTaskParams({objectType:"1025,1026",searchPattern:""});serverRequest.call(this,callbacks,taskParams);},isBasicAggMap:function isBasicAggMap(did){var retVal=!!BasicAggMap[did];if(did==="B2C0FA4020C711D6AD1400C04F0423DE"||did==="B2C0FA4120C711D6AD1400C04F0423DE"){retVal=false;}return retVal;},isOLAPAgg:function isOLAPAgg(did){return !!OLAPAggMap[did];},isMovingAgg:function isMovingAgg(did){return !!MovingAggMap[did];},isRunningAgg:function isRunningAgg(did){return !!RunningAggMap[did];},isBanding:function isBanding(did){return !!BandingMap[did];},isOLAP:function isOLAP(did){var fcts=this.getFunctionCatList(),olapFns=fcts[this.getOLAPCategoryIndex(fcts)].fns;return mstrmojo.array.find(olapFns,"did",did)>-1;},isRank:function isRank(did){return !!RankMap[did];},isScalar:function isScalar(fctOi){return(fctOi||{}).sqt===3;},getFunctionHelpTopic:function getFunctionHelpTopic(h){return'<a href="'+((mstrApp.helpUrl||"../help/")+"FunctionsRef/index.html?context=functionsref&topic="+(h||""))+'" target="_new">'+mstrmojo.desc(5811,"Details ...")+"</a>";},sortFunctions:function sortFunctions(functions){var allfuncs={},fs=function(a,b){return mstrmojo.array.stringSorter(a.n,b.n);};mstrmojo.array.forEach(functions,function(funcs){mstrmojo.array.forEach(funcs&&funcs.fns,function(func){if(func&&func.did){allfuncs[func.did]=func;}});});return mstrmojo.hash.valarray(allfuncs).sort(fs);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom");function Z(a,c){if(!mstrmojo.DocInfoWindow){return ;}var b=a;while(b){if(b instanceof mstrmojo.DocInfoWindow){b[c?"registerScrollLock":"releaseScrollLock"](this);break;}b=b.parent;}}var L=mstrmojo.array,C=mstrmojo.dom,P=mstrmojo.hash,W=mstrmojo.css,F="px";var B=false;function K(a,c){if(!mstrmojo.DocInfoWindow){return ;}var b=a;while(b){if(b instanceof mstrmojo.DocInfoWindow){b[c?"registerLock":"releaseLock"](this);this.lockIW=c?b:null;break;}b=b.parent;}}var A=mstrmojo.ui.PopupConfig.ENUM_CORNERS,T=A.TOP_LEFT,R=A.TOP_RIGHT,H=A.BOTTOM_RIGHT,G=A.BOTTOM_LEFT;function I(a){return(a===G||a===T);}function X(a){return(a===R||a===H);}function N(a){return(a===H||a===G);}function Q(a){return(a===R||a===T);}function U(h,c,o,u){var z=o.x,x=o.y,t=o.w||0,k=o.h||0,b=u.w,p=u.h,r=h.alignment,f=r.popup,e=r.host,w=X(e),AA=N(e),q=false,m=false,d=false,n=false;if(I(f)){var g=z+b+(w?t:0);q=c.w<g;}if(Q(f)){var l=x+p+(AA?k:0);m=c.h<l;}if(X(f)){var j=z-b+(w?t:0);d=j<0;}if(N(f)){var a=x-p+(AA?k:0);n=a<0;}return{top:n,bottom:m,left:d,right:q};}function E(b){var a=this.popupConfig;if(a){P.forEach(a.popupHandlers,function(d,e){var c=d[b?"open":"close"];if(c){c.call(mstrmojo.all[e]||c,!!b);}});}}function J(b){var a=this.popupConfig;if(a&&!a.isHostedWithin){var c=this.hostProxy;if(c){c.style.display=b?"":"none";}}}function Y(a){return a!==undefined&&a!==null&&!isNaN(a);}mstrmojo._IsPopup={visible:false,lockIWForScroll:false,disposable:true,opener:null,onOpen:mstrmojo.emptyFn,onClose:mstrmojo.emptyFn,popupConfig:null,hostProxy:undefined,open:function M(c,a){E.call(this,true);if(this.updatePopupConfig){this.updatePopupConfig(a,c);}else{P.forEach(a,function(f,e){this.set(e,f);},this);}var b="popup-mid-render";this.set("opener",c);if(!this.hasRendered){var d=this.visible;this.visible=false;this.render();W.addClass(this.domNode,b);this.set("visible",d);}if(this.nudge){this.domNode.style.top="-10000px";}J.call(this,true);this.set("visible",true);if(this.lockIWForScroll){Z.call(this,this.opener,true);}if(a&&a.lockIW){K.call(this,a.lockIW,true);}if(this.nudge){this.nudge();}this.adjustCornersForPopupOverflow();this.onOpen();W.removeClass(this.domNode,b);},adjustCornersForPopupOverflow:function V(){var l=this.popupConfig;if(!l){return false;}var AK=(l.includeScroll!==undefined)?l.includeScroll:true;var o=l.position||C.position(l.anchorElement||l.hostElement,AK);if(!l.isHostedWithin){var AA=this.hostProxy,r=this.hostProxy=document.createElement("div");document.body.appendChild(r);r.appendChild(this.domNode);if(AA){AA.parentNode.removeChild(AA);}var e=r.style,t={x:"left",y:"top",w:"width"};r.className=l.hostProxyCssClass;e.position="absolute";e.background="none";e.height="0";L.forEach(["x","y","w"],function(AN){var AM=o[AN];if(Y(AM)){e[t[AN]]=AM+F;}});}var AH=l.ENUM_CORNERS,x=AH.BOTTOM_LEFT,j=AH.BOTTOM_RIGHT,h=AH.TOP_RIGHT,AD=AH.TOP_LEFT;var AE=U(l,C.position(document.body),o,C.position(this.domNode)),z=AE.right,p=AE.bottom,d=AE.left,w=AE.top,AC=l.alignment,q=AC.popup,AL=AC.host,g=q,c=AL;if(z||d){if(I(c)){c=Q(c)?h:j;}else{if(X(c)){c=Q(c)?AD:x;}}if(z&&I(g)){g=Q(g)?h:j;}else{if(d&&X(g)){g=Q(g)?AD:x;}}}if(p||w){if(I(c)){c=Q(c)?x:AD;}else{if(X(c)){c=Q(c)?j:h;}}if(p&&Q(g)){g=I(g)?x:j;}else{if(w&&N(g)){g=I(g)?AD:h;}}}if(w||z||p||d){if(B){console.log("Overflow directions: "+JSON.stringify(AE));}this._orgalgn={host:AL,popup:q};l.setAlignment(c,g);}if(!l.isHostedWithin){if(Y(o.y)&&Y(o.h)){this.hostProxy.style.top=(o.y+(N(g)?(l.alignWithAnchor===true?o.h:0):(l.alignWithAnchor===true?0:o.h)))+F;}}var AB=N(c),AG=X(c),AF=N(g),n=X(g),k="auto",b="100%",a="0";var u=k,AI=k,m=k,f=k;if(AF){m=AB?a:b;}else{u=AB?b:a;}if(n){AI=AG?a:b;}else{f=AG?b:a;}var AJ=this.domNode.style;AJ.top=u;AJ.right=AI;AJ.bottom=m;AJ.left=f;return true;},close:function O(b){if(this.onClose){this.onClose(b);}J.call(this,false);if(this.lockIWForScroll){Z.call(this,this.opener,false);}this.set("visible",false);this.set("opener",null);if(this.lockIW){K.call(this,this.lockIW,false);}E.call(this,false);var a=this._orgalgn;if(a){this.popupConfig.setAlignment(a.host,a.popup);}},buildRendering:function D(){var a=this._super();if(a){if(!this.parent&&!this.domNode.parentElement){document.body.appendChild(this.domNode);}}return a;},unrender:function S(a){if(this.popupConfig&&!this.popupConfig.isHostedWithin&&this.hostProxy){document.body.removeChild(this.hostProxy);delete this.hostProxy;}this._super(a);}};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.dbroles.DBRoleHelper");mstrmojo.requiresDescs(4572,11138,3651);var H=mstrmojo.array,G=mstrmojo.warehouse.dbroles.DBRoleHelper,C="PWDHIDDEN123!@#",A=mstrmojo.desc(4572,"Primary"),D=mstrmojo.warehouse.EnumObjectTypes.DBROLE;mstrmojo.warehouse.obj.DBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.obj.DBRole",init:function K(O){var M=this,L=(O&&O.mdDBRole);if(L){M.mdDBRole=L;M.n=L.n.toString();M.did=L.did;M.des=(!(L.des&&mstrApp.rootController.isCloud())?L.n:L.des||"").toString();M.data=new mstrmojo.warehouse.obj.TableData({id:L.did,n:L.n,tp:L.stp,model:O.mdl});}else{M.mdDBRole={n:G.getUniqueName(mstrmojo.desc(11138,"new data source #").replace("#","")),did:"",tp:29,stp:7424,writable:"1",vldbProperties:{}};M.n=M.mdDBRole.n;M.did=M.mdDBRole.did;M.data=new mstrmojo.warehouse.obj.TableData({id:M.mdDBRole.did,n:M.mdDBRole.n,tp:M.mdDBRole.stp,model:O.mdl});var N=mstrApp.rootController.getDBObjects().preferences;if(N&&N.vldbProperties){H.forEach(N.vldbProperties,function(P){M.mdDBRole.vldbProperties[P.propset]={};});}M.populated=true;}M.data.isPrimary=M.isPrimary();},dbmsCatalogCacheMode:undefined,mdDBRole:{},n:"",did:"",tp:D,supportsNameSpaces:false,avoidColumnCaching:false,displayName:function J(){return this.n+(this.isPrimary()?" ("+A+")":"");},isPrimary:function I(){return(this.did===mstrApp.getRootController().getProjectPrimaryDBRoleID());},data:undefined,populated:false,populate:function F(M){var L=this;if(this.populated){M(L);}else{mstrApp.getRootController().populateDBRole(this.mdDBRole.did,{success:function(O){L.populated=true;L.mdDBRole=O.dbrs[0];if(typeof L.mdDBRole.vldbProperties==="string"){L.mdDBRole.vldbProperties=JSON.parse(L.mdDBRole.vldbProperties);}L.n=L.mdDBRole.n.toString();L.did=L.mdDBRole.did;var N=parseInt(L.mdDBRole.dbmsCatalogCacheMode,10);L.supportsNameSpaces=((N&1)===1);L.avoidColumnCaching=((N&2)===2||(N&4)===4);M(L);}});}},rename:function B(L){var M=mstrApp.rootController;this.mdDBRole.n=L;if(M.isCloud()){this.des=L;this.n=this.des+"___"+new Date().getTime();}else{this.n=L;}if(this.did!==""){this.mdDBRole.connstr=G.cleanDSNConnection(this.mdDBRole.connstr);M.saveDBRole(this,false,{success:function(){}});}},duplicate:function E(){var M=mstrApp.rootController,O=new mstrmojo.warehouse.obj.DBRole({mdDBRole:this.mdDBRole,mdl:this.data.model}),N=mstrApp.isSingleTier?"copy of ##":mstrmojo.desc(3651,"copy of ##"),L=G.getUniqueName(N.replace("##",M.isCloud()?this.des:this.n));O.did="";O.mdDBRole.did="";O.rename(L);O.mdDBRole.connstr=G.cleanDSNConnection(O.mdDBRole.connstr);O.mdDBRole.originalID=this.did;if(O.mdDBRole.password===C){delete O.mdDBRole.password;}M.saveDBRole(O,true,{success:function(){}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var C=1;mstrmojo._hasWidgetListMapper={buildItemWrappers:function A(H,G,F,E,J,I){E.first=J;E.last=I;return this._super(H,G,F,E,0,0);},postBuildRendering:function B(K,I,H,G,F){var J=F.first;if(J){this.fillItemWrappers(K,I,H,G,F,0,J);}if(F.last){var E=I&&I.length||0,L=Math.max(Math.max(0,E-F.last),J);this.fillItemWrappers(K,I,H,G,F,L,E);}if(this._super){this._super(K,I,H,G,F);}},fillItemWrappers:function D(F,N,K,R,M,E,I,Q){var L=(N&&N.length)||0,P=this.wrapperNodes(F),S=M.itemStatus;for(var J=E,O=Math.min(I+1,L),H=0;J<O;J++){if(S[J]!==C){var G=K.build(R,M,N[J],J);if(G){G.placeholder=P[J].firstChild;G.render();}H++;if(H===Q){break;}}}return H;},onchange:null};mstrmojo.WidgetListMapper=mstrmojo.provide("mstrmojo.WidgetListMapper",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.WidgetListMapper.RENDERED=C;mstrmojo.requiresCls("mstrmojo.ListMapperHoriz");mstrmojo.WidgetListMapperHoriz=mstrmojo.provide("mstrmojo.WidgetListMapperHoriz",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperHoriz)));})();(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");mstrmojo.ListMapperTable=mstrmojo.provide("mstrmojo.ListMapperTable",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table">',markupSuffix:"</table>",itemWrapperPrefix:function(E){return'<tbody class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"<tr><td>&nbsp;</td></tr>",itemWrapperSuffix:"</tbody>",wrapperNodes:function D(E){return this.wrapperParentNode(E).tBodies;},wrapperParentNode:function C(E){return E.getElementsByTagName("table")[0];},createWrapperNode:function B(E){var F=E.ownerDocument,G=F.createElement("tbody");return G;},findIndex:function A(G,J,I){if(J&&I){var F=G.domNode,E=this.wrapperParentNode(J),H=I.parentNode;while(H){if(H===E){return mstrmojo.array.findBin(this.wrapperNodes(J),I,"offsetTop",G.items&&G.items.length);}else{if(H===F){break;}}I=H;H=I.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.requiresCls("mstrmojo.WidgetListMapper");mstrmojo.WidgetListMapperTable=mstrmojo.provide("mstrmojo.WidgetListMapperTable",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperTable)));})();(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.Obj","mstrmojo.date","mstrmojo.hash","mstrmojo.array","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.obj.DBObjects","mstrmojo.warehouse.obj.DBRole");mstrmojo.requiresDescs(12934,5160,11426,11427,11429,11430,11436,11437,11432,11434,12935,12936,11442,12942,10068,12943,12944,12945,12946);var R=mstrmojo,M=R.func.wrapMethods,p=R.date,U=R.hash,e=R.array,O=R.string,F=R.architect.menu.EnumMenuActions,P=mstrmojo.warehouse.EnumDataChangeEvents,V=P.DBTABLES_CHANGED,T=P.DBTABLES_REQUESTED,r=3000,AE=mstrmojo.warehouse.EnumDatabaseType.SAPHana,a=mstrmojo.warehouse.EnumNamespaceMode.ALL,f=mstrmojo.warehouse.EnumNamespaceMode.CURRENT,x=R.warehouse.EnumObjectTypes,AI=x.ATTRIBUTE,G=x.FACT,z=x.TABLE,AF=x.COLUMN,l=x.FORM,g=x.LAYER,I=x.DIMENSION,q=x.PROJECT,o=x.TRANSFORMATION,j=x.DBROLE;var AG={DssCatalogDefault:0,DssCatalogGetTables:1,DssCatalogGetColumns:2,DssCatalogGetTablePrimaryKeys:4,DssCatalogGetTableForeignKeys:8,DssCatalogGetTableKeys:12,DssCatalogGetTableSize:16,DssCatalogGetTableContent:32,DssCatalogGetColumnCardinality:64,DssCatalogGetColumnContent:128,DssCatalogGetFullCatalog:255,DssCatalogSelectedOnly:256,DssCatalogApplyConnectionMapping:512,DssCatalogAllNamespaces:1024,DssCatalogGetFresh:4096,DssCatalogIgnoreNamespace:8192,DssCatalogIgnoreCase:16384,DssCatalogIgnoreInvalidNames:32768,DssCatalogReuseMatching:65536,DssCatalogReuseCompatible:131072,DssCatalogReuseAny:262144,DssCatalogAugmentExisting:524288,DssCatalogSortDescending:1048576,DssCatalogSortTableNameFirst:2097152,DssCatalogGetNamespaces:16777216,DssCatalogCompareWithMetadata:134217728};var k={DssCatalogStateDefault:0,DssCatalogStateSelected:1,DssCatalogStateFresh:2,DssCatalogStateMissing:4,DssCatalogStateUnexpected:8,DssCatalogStateCompatibleSmaller:16,DssCatalogStateCompatibleLarger:32,DssCatalogStateCompatible:64,DssCatalogStateIncompatible:128,DssCatalogStateCompatibilityMask:240,DssCatalogStateFreshTables:256,DssCatalogStateMissingTables:512,DssCatalogStateFreshColumns:1024,DssCatalogStateMissingColumns:2048,DssCatalogStatePartitionMappingTable:65536,DssCatalogStateDummyPartitionMappingTable:131072,DssCatalogStateDummyPartitionSliceTable:262144};function d(AJ){return O.decodeHtmlString(AJ).replace(/&apos;/g,"'");}function J(){var AJ=new Date();return" - "+[("00"+AJ.getHours()).slice(-2),("00"+AJ.getMinutes()).slice(-2),("00"+AJ.getSeconds()).slice(-2)].join(":");}function L(AJ){var AK=" ",AO="-",AP=":",AN=AJ.split(AK),AL=AN[0].split(AO),AM=AN[1].split(AP);return new Date(Date.UTC(AL[0],parseInt(AL[1],10)-1,AL[2],AM[0],AM[1],AM[2]));}function n(AL,AK,AJ){mstrApp.getRootController().getDataService()[AJ||"submitRequest"](AL,AK);}function u(AL,AK,AJ){AK.showWait=AJ;mstrApp.getRootController().getDataService().submitRequest(AL,AK);}function Q(AJ){var AL={},AK=[];e.forEach(AJ,function(AM){AL[AM.propset]=AM.propset;AK.push(AM.propset+","+AM.prop);});return U.valarray(AL).join(",,")+";"+AK.join(",,");}function m(AK){var AJ=AK.ab;if(AJ===0){AJ=this.dbObjects.dbVersion2dbId[AK.db_ver];}return AJ;}function B(AL,AK,AJ){var AM=true;e.forEach(AJ,function(AN){if(AN===AL){AM=false;return false;}});if(!AM){return false;}if(!AK||!AK.length){return true;}AM=false;e.forEach(AK,function(AN){if(AN===AL){AM=true;return false;}});return AM;}mstrmojo.warehouse.WHModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.WHModel",schemaInstanceID:"",dbtbls:{},dbtables:[],cachedStamp:{},dbrs:[],dbObjects:undefined,namespaces:[],catalogStamp:"",SelDBRoleID:null,SelNameSpaceID:null,catalogRefresh:false,privileges:{},dbRolesTypeFilter:[],dbRolesVersionFilter:[],dbmsTypeFilter:[],dbmsVersionFilter:[],dbRolesTypeExcludeFilter:[],dbRolesVersionExcludeFilter:[],dbmsTypeExcludeFilter:[],dbmsVersionExcludeFilter:[],dbObjectsDisplayOptions:1,dbObjectsConnectionType:1,showAddDriver:false,usingCookieNamespace:false,currentDBRole:undefined,allDBRoleNames:undefined,cas:undefined,tis:undefined,xrc:undefined,vldbProperties:undefined,propset:undefined,ns:undefined,did:undefined,clis:undefined,cln:undefined,dbRoleEditorCfg:{},databaseType:undefined,isDataImport:undefined,postCreate:function X(){var AJ=this;this.dbObjects=new mstrmojo.warehouse.obj.DBObjects();if(mstrApp.isSingleTier){if(navigator.platform.indexOf("Win")===-1){this.dbObjectsConnectionType=2;this.showAddDriver=true;}return ;}u({success:function(AK){AJ.privileges=AK.privileges;}},{taskId:"arch.checkPrivileges",skipSchemaIDCheck:true},true);},loadDBTypeFilters:function C(AL){var AJ=this;AJ.dbObjects.populateDBProperties(M({success:function AK(){var AN=[],AM=AJ.dbObjectsDisplayOptions;U.forEach(AJ.dbObjects.dbTypes,function(AO){if((AO.disp&AM)===AM){AN.push(AO.v);}});AJ.dbmsTypeFilter=AN;AJ.dbRolesTypeFilter=AN.slice(0);}},AL));},loadDBRoles:function D(AQ,AK){var AL=this,AP;AL.raiseEvent({name:P.DBROLES_REQUESTED});var AO={taskId:"arch.search",objecttypes:j,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:AL.dbRolesTypeFilter.join(","),versionFilter:AL.dbRolesVersionFilter.join(","),typeExcludeFilter:AL.dbRolesTypeExcludeFilter.join(","),versionExcludeFilter:AL.dbRolesVersionExcludeFilter.join(",")};var AJ=M({success:function AN(AV,AW){var AR=[],AU=AL.currentDBRole,AT=0,AX=(AL.dbIds&&AL.dbIds.length===1),AS;e.forEach(AV.dbRoles,function(AY,AZ){if(AW){if(!B(AY.db_type,AL.dbRolesTypeFilter,AL.dbRolesTypeExcludeFilter)||!B(AY.db_ver,AL.dbRolesVersionFilter,AL.dbRolesVersionExcludeFilter)){return ;}}if(AX){AS=m.call(AL,AY);if(AY.ab===0&&(AS===9||AS===125)&&(AL.dbIds[0]===9||AL.dbIds[0]===125)){AR.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AY,mdl:AL}));}else{if(AL.dbIds[0]===AS||AY.db_ver===-1){AR.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AY,mdl:AL}));}else{if(AL.dbObjectsDisplayOptions===1&&AY.ab===0&&AS===undefined){AR.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AY,mdl:AL}));}else{if(AL.dbObjectsDisplayOptions===16&&AY.ab===0){AR.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AY,mdl:AL}));}}}}}else{AR.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AY,mdl:AL}));}if(AU&&AY.did===AU.did){AT=AZ;}});AL.currentDBRole=undefined;AL.set("dbrs",AR);AL.raiseEvent({name:P.DBROLES_LOADED,items:AR,offset:AT});AL.allDBRoleNames={};e.forEach(AV.allNames||[],function(AY){AL.allDBRoleNames[AY.did]=AY;});}},AQ);if(AL.isDataImport!==undefined){AO.isDataImport=AL.isDataImport;}if(!mstrApp.isSingleTier&&mstrApp.placeholder==="QBApp"&&!AK&&AL.isDataImport){AP=mstrApp.type;var AM=mstrmojo.qb.EnumQBAppType;if((AP===AM.QueryBuilder||AP===AM.FFSQL||AP===AM.EmmaSingleTable)&&AL.dbObjectsDisplayOptions!==16&&AL.dbObjectsDisplayOptions!==4){if(mstrApp.dbRoles){AJ.success(mstrApp.dbRoles,true);}else{mstrApp.serverRequestParallel(AO,AJ,true);}return ;}}if(!mstrApp.isSingleTier&&AK&&mstrApp.dbRoles){mstrApp.dbRoles=undefined;if(mstrApp.container&&mstrApp.container.launchingApp){mstrApp.container.launchingApp.dbRoles=undefined;}}n(AJ,AO,"search");},loadDBObjects:function S(AJ){this.dbObjects.load(this.dbmsTypeFilter,this.dbmsVersionFilter,AJ);},_set_SelDBRoleID:function c(AM,AL){var AK=this,AJ=this.getDBRole(AL);AK.SelDBRoleID=AL;AK.SelNameSpaceID=undefined;if(AJ&&AJ.mdDBRole){AK.getNameSpaces({sourceInfo:"tablesPanel"});}else{if(!AL){AK.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:""});AK.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:[],namespaceMode:f,dbRoleID:AL,error:true});}}AK.raiseEvent({name:P.DBROLE_SELECTION,value:AK.SelDBRoleID});},onSelNameSpaceIDChange:function A(AJ){this.SelNameSpaceID=AJ.value;this.getSelectedDBRoleTables({blockBegin:0,blockCount:1000,filterText:""},{failure:function AK(AM){if(AM){R.alert(AM.getResponseHeader("X-MSTR-TaskFailureMsg"));}}});var AL=window.localStorage;if(AL){AL.setItem(this.SelDBRoleID,this.SelNameSpaceID);}},getDBRole:function h(AK){var AL="00000000000000000000000000000000";var AJ=e.find(this.dbrs,"did",(AK===AL)?this.projPrimaryDBRoleID:AK);if(AJ>=0){return this.dbrs[AJ];}return null;},getNameSpaces:function AB(AO){var AP=this,AJ=AO.dbRoleID||AP.SelDBRoleID,AN=AG.DssCatalogGetNamespaces|AG.DssCatalogApplyConnectionMapping,AQ=this.getDBRole(AJ),AM=false,AK=false,AL=AQ&&AQ.mdDBRole&&AQ.mdDBRole.db_type,AR;switch(AL){case 4000:AM=true;break;case 3000:AK=true;break;default:break;}if(AO.getFresh){AN=(AN|AG.DssCatalogGetFresh);}AP.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:AO.sourceInfo||""});AR={success:function(AS){AP.namespaces=AS.ns;AP.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:AM?[]:AP.namespaces,namespaceMode:a,dbRoleID:AJ,namespace:AP.SelNameSpaceID,sourceInfo:AO.sourceInfo||""});},failure:function(AS){AP.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:[],namespaceMode:f,dbRoleID:AJ,sourceInfo:AO.sourceInfo||"",error:true});if(AS){R.alert(AS.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(AK){AR.success({ns:[]});return ;}if(!AM){AP.raiseEvent({name:P.NAMESPACES_REQUESTED,sourceInfo:AO.sourceInfo||""});}u(AR,{taskId:"arch.catalogAction",dbrid:AJ,flags:AN},false);},getSelectedDBRoleTables:function t(AZ,AM){var AL=this,AK=AZ.getFresh||false,Ab=AZ.dbRoleID||AL.SelDBRoleID||AL.projPrimaryDBRoleID,AQ=AL.cachedStamp,AJ=AL.dbtbls,AU=AZ.filterText.toString(),Aa=AL.getDBRole(Ab);if(AK){AL.catalogRefresh=true;}if(!Aa||Aa.mdDBRole.db_type===r){AL.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:AZ.sourceInfo||""});return ;}var AR=(AJ[Ab]=AJ[Ab]||{}),AV=(AQ[Ab]=AQ[Ab]||{}),AS=O.decodeHtmlString(AZ.nameSpace||AL.SelNameSpaceID||""),AO=false,AT=[],AW=[],AY,AP=AR[AS],AX=(Aa.mdDBRole.db_type===AE);if(!AL.catalogRefresh&&AR&&(AP!==undefined)){U.forEach(AP,function(Ad,Ac){AO=true;AY=new mstrmojo.warehouse.obj.TableData({id:Ac,n:Ac,tp:z,model:AL,ns:Ad.ns,did:Ac,sta:parseInt(Ad.sta,10),items:[],dbtn:Ad.tbn});if(AX){AY.extt=Ad.extt;AY.hanai=Ad.hanai;}if(AU!==""&&Ac.toUpperCase().indexOf(AU.toUpperCase())>-1){AT.push(AY);}AW.push(AY);});if(AO){AL.set("catalogStamp",AV[AS]);AL.raiseEvent({name:V,items:(AU!=="")?AT:AW,selectedItems:AL.getDBRoleTablesInUse(Ab)||[],sourceInfo:AZ.sourceInfo||""});if(AM&&AM.success){AM.success({items:(AU!=="")?AT:AW});}return ;}}AP=(AR[AS]={});AV[AS]=null;var AN=AG.DssCatalogGetTables|AG.DssCatalogApplyConnectionMapping;AN=AL.catalogRefresh?(AN|AG.DssCatalogGetFresh):AN;AL.raiseEvent({name:T,sourceInfo:AZ.sourceInfo||""});u(M({success:function(Af){var Ac=Af.xrc.cas[0],Ai=Ac.timestamp,Ad=Ac.tis,Ae,Ag;if(Ai){var Ah=p.getDateJson(L(Ai.replace(/&apos;/,"")));Ai=[p.formatDateInfo(Ah,"yyyy-MM-dd")," ",p.formatTimeInfo(Ah,"hh:mm a")].join("");}AV[AS]=Ai;AL.set("catalogStamp",Ai);AL.catalogRefresh=false;e.forEach(Ad,function(Aj){Ae=Aj.tbn=d(Aj.tbn);Ag=Aj.ns=d(Aj.ns);if(!AP[Ae]){AP[Ae]=Aj;AR[Ag]=AR[Ag]||{};AR[Ag][Ae]=Aj;}});U.forEach(AP,function(Ak,Aj){AY=new mstrmojo.warehouse.obj.TableData({id:Aj,n:Aj,tp:z,model:AL,ns:Ak.ns,did:Aj,sta:parseInt(Ak.sta,10),items:[],dbtn:Ak.tbn});if(AX){AY.extt=Ak.extt;AY.hanai=Ak.hanai;}AW.push(AY);});AL.raiseEvent({name:V,items:AW,selectedItems:AL.getDBRoleTablesInUse(Ab)||[],sourceInfo:AZ.sourceInfo||""});},failure:function(){AL.raiseEvent({name:V,items:AW,selectedItems:AL.getDBRoleTablesInUse(Ab)||[],sourceInfo:AZ.sourceInfo||""});}},AM),{taskId:"arch.catalogAction",dbrid:Ab,flags:AN,ns:AS},false);},getDBRoleTablesAndColumns:function AH(AK,AL){var AJ=this;if(!AK.dbRoleID){return ;}u(M({success:function(AP){var AM=AP.xrc.cas[0],AN=AM.tis,AS=[],AR={},AO,AQ;e.forEach(AN,function(AT){AQ=d(AT.ns);AO=d(AT.tbn);AS.push({n:(AQ?AQ+"."+AO:AO),tp:z});e.forEach(AT.clis,function(AU){AR[AU.cln]={n:AU.cln,tp:AF};});});AP.tables=AS;AP.columns=U.valarray(AR);}},AL),{taskId:"arch.catalogAction",dbrid:AK.dbRoleID,flags:AG.DssCatalogGetTables+AG.DssCatalogGetColumns,ns:O.decodeHtmlString(AJ.SelNameSpaceID||"")},true);},getDBRoleTablesInUse:mstrmojo.emptyFn,getColumnsForDBTable:function b(AN,AR){var AQ=this,AJ=AN.data.dbrole||AQ.SelDBRoleID,AP=AN.data,AO=AN.getFresh||false,AV=AP.n,AM=AP.ns,AS=AP.tableId,AL,AK=AG.DssCatalogGetColumns+AG.DssCatalogApplyConnectionMapping+AG.DssCatalogIgnoreCase+(AN.compareWithMD?AG.DssCatalogCompareWithMetadata:0),AU;if(AJ){if(!AO){if(AM){AU=AQ.dbtbls[AJ][AM][AV];AL=AU.columns;}else{AU=AQ.dbtbls[AJ][AV];if(AU){AL=AU.columns;}}if(AL){AR.success({src:AN,items:AL,selDBRole:AJ,hanaInfo:AU.hanaInfo});if(AR&&AR.complete){AR.complete();}return ;}}AK=AO?(AK|AG.DssCatalogGetFresh):AK;u(M({success:function AT(AX){var AY=AX.xrc.cas[0].tis[0],AW=[],AZ=AY.hanai;AL=AY.clis;e.forEach(AL,function(Aa){AW.push(new mstrmojo.architect.obj.Column({dbInfo:Aa}));});AU=AQ.dbtbls[AJ][AM][AV];if(AW.length>0){AU.columns=AW;}AU.hanaInfo=mstrmojo.hash.clone(AZ);AX.items=AW;AX.hanaInfo=AU.hanaInfo;}},AR),{taskId:"arch.catalogAction",dbrid:AJ,schemaid:AQ.schemaInstanceID,ns:AM,dbts:JSON.stringify([{tbn:AP.dbtn,ns:AM,tbid:AS}]),flags:AK},true);}},saveDBRole:function H(AK,AJ,AN){var AL=this;u(M({success:function AM(AP){if(!AJ){var AO=AL.getDBRole(AP.dbr.did);AO.populated=false;AO.populate(function AQ(){AL.raiseEvent({name:AJ?P.DBROLES_ADD:P.DBROLES_RENAME,item:AO});});}else{AL.currentDBRole=AP.dbr;AL.loadDBRoles(undefined,true);}}},AN),{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",dbroleinfo:JSON.stringify(AK),showWait:true},true);},deleteDBRole:function K(AK,AM){var AJ=this;u(M(AM,{success:function AL(){var AN=e.find(AJ.dbrs,"did",AK);if(AN>-1){AJ.dbrs.splice(AN,1);}delete AJ.allDBRoleNames[AK];if(AJ.SelDBRoleID===AK){AJ.set("SelDBRoleID",AJ.projPrimaryDBRoleID);}AJ.raiseEvent({name:P.DBROLES_DELETE,item:{did:AK}});}}),{taskId:"arch.deleteObject",schemaid:AJ.schemaInstanceID,objectid:AK,objecttype:29,showWait:true},true);},populateDBRole:function Z(AJ,AK){u(AK,{isDataImport:false,reverseOrder:true,verbose:true,taskId:"getDBInstances",vldbProperties:Q(this.dbObjects.preferences.vldbProperties),objectID:AJ,skipSchemaIDCheck:true,showWait:false},false);},handleEnabledAction:function E(){return true;},handleVisibleAction:function w(AL,AK){if(!AK){return true;}switch(AK.action){case F.SET_AS_PRIMARY:return mstrApp.isArchitect&&!AL.isPrimary;case F.IS_PRIMARY:return mstrApp.isArchitect&&AL.isPrimary;case F.UPSTRUCT:return true;case F.CATALOG_SQL:var AJ=this.getDBRole(AL.did);return(mstrApp.getRootController().canDisplayCatalogSQL(this.dbObjects.dbTypes,AJ.mdDBRole.db_type));}return true;},handleCheckAction:function AD(AK,AJ){switch(AJ.action){case F.IS_PRIMARY:return AK.isPrimary;}return false;},findNameInHash:function W(AM,AJ){var AL=false,AK="";U.forEach(AM,function(AN){AK=AN.name||AN.n;if(AK.toString().toUpperCase()===AJ){AL=true;return false;}return true;});return AL;},validateName:function Y(AR,AQ,AJ,AN){var AL=this,AT=10000,AM={},AU,AK,AP=R.desc(12934,"Object names need to be less than 250 characters"),AO=R.desc(5160,'An object name cannot contain the following characters " \\ [ ]');switch(AR){case AI:case l:AM=AL.getAttributes();AU=R.desc(11426,"The attribute name cannot be empty.");AK=R.desc(11427,"The name is currently in use by another attribute.");break;case G:AM=AL.getFacts();AU=R.desc(11429,"The fact name cannot be empty.");AK=R.desc(11430,"The name is currently in use by another fact.");break;case z:AM=AL.tables;AU=R.desc(11436,"The table name cannot be empty.");AK=R.desc(11437,"The name is currently in use by another table.");break;case g:AM=AL.layers;AU=R.desc(11432,"The layer name cannot be empty.");AK=R.desc(11434,"The name is currently in use by another layer.");break;case I:AM=AL.userHierarchies;AU=R.desc(12935,"The hierarchy name cannot be empty.");AK=R.desc(12936,"The name is currently in use by another hierarchy.");break;case q:AM=AN;AU=R.desc(11442,"The project name cannot be empty.");AK=R.desc(12942,"The project name already exists.");break;case j:AM=AL.allDBRoleNames;e.forEach(AL.dbrs,function(AV){AM[AV.did]=AV;});AU=R.desc(10068,"The Database Connection name can't be empty");AK=R.desc(12943,"The database connection name already exists.");break;case o:AM=AL.transformations;AU=R.desc(12944,"The transformation name cannot be empty.");AK=R.desc(12945,"The transformation name already exists.");break;default:R.alert(R.desc(12946,"object type cannot be validated, it's not defined yet"),undefined,undefined,AT);return false;}if(AQ===""){R.alert(AU,undefined,undefined,AT);return false;}if(AJ){if(AJ.toString().toUpperCase()===AQ.toString().toUpperCase()){return true;}}if(AQ.length>250){R.alert(AP,undefined,undefined,AT);return false;}var AS=/[\[\]\\"]/;if(AS.test(AQ)){R.alert(AO,undefined,undefined,AT);return false;}if(this.findNameInHash(AM,AQ.toUpperCase())){R.alert(AK,undefined,undefined,AT);return false;}return true;},findinArray:function AC(AK,AP,AL){var AN=AL.toUpperCase(),AJ=(AK&&AK.length)||0,AM,AO;for(AM=0;AM<AJ;AM++){AO=AK[AM];if(AO&&AO[AP].toUpperCase()===AN){return AM;}}return -1;},findNextName:function AA(AK,AM,AO){AK+=(J());var AL=1,AJ=AK,AN=AJ.toUpperCase();do{if(this.findinArray(AM,AO,AN)>=0){AJ=AK+" "+AL++;AN=AJ.toUpperCase();}else{return AJ;}}while(AL<100);return"Temp Object";}});var N=mstrmojo.warehouse.WHModel;N.DssCatalogFlags=AG;N.DSSCatalogStateFlags=k;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Container","mstrmojo._IsPopup","mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.ui._HasScroller");var L=mstrmojo.boxmodel,I=mstrmojo.dom,M=mstrmojo.css,O="mstrmojo-Tooltip",A="mstrmojo-scrollNode",E=20;function C(S,T,R){var U="connectScrollbox";if(R){U="dis"+U;}var Q=S&&S.parent;while(Q){if(Q[U]){Q[U](T);}Q=Q.parent;}}function G(){if(!this._paintHandle){var R=this.id,Q=function(V){var Z=mstrmojo.all[R];if(!Z){return ;}delete Z._paintHandle;var T=[O],a=Z.cssClass;if(a){T.push(a);}var S=mstrApp.getThemeClassName&&mstrApp.getThemeClassName(),X=Z.opener;if(X&&X.getTooltipThemeClass){S=X.getTooltipThemeClass();}T.push(S);Z.domNode.className=T.join(" ");var Y=Z.content,U=Z.contentNode,W=Z.arrowNode;U.className=(O+"-content "+A+" "+Z.contentNodeCssClass);U.style.cssText=Z.contentNodeCssText;U.innerHTML=Y;W.style.cssText="";Z.domNode.style.visibility=!!Y?"visible":"hidden";Z.updatePosition();if(!V&&Z.optimizePos){Z.optimizePos();}Z.updateScrollbars();};if(!this._hasPaint){Q(true);this._hasPaint=true;}else{this._paintHandle=window.setTimeout(Q,0);}}}function B(h,c,a,Y){var T=c&&(c.richTooltip||c.tooltip),f=a?I.getMousePosition(a,Y||self):null,Q=T&&(typeof T==="string");var U="",g="",d="",Z=T,X=null,W=mstrmojo.tooltip.POS_TOPLEFT,S=null,b=null;var V=false,R=false;if(T&&!Q){g=T.cssClass||g;U=T.contentNodeCssClass||U;d=T.contentNodeCssText||d;Z=T.content||"";X=T.refNode||X;W=T.posType||W;S=T.left||0;b=T.top||0;V=T.keepArrowXPos||V;R=T.keepArrowYPos||R;}h.set("contentNodeCssClass",U);h.set("cssClass",g);h.set("contentNodeCssText",d);h.set("content",Z);h.set("refNode",X);h.set("posType",W);h.set("left",Q?((f&&f.x)||h.left):S);h.set("top",(Q||!T)?((f&&(f.y+E))||h.top):b);h.set("keepArrowXPos",V);h.set("keepArrowYPos",R);}mstrmojo.Tooltip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Tooltip",content:null,top:null,left:null,refNode:null,keepArrowXPos:false,keepArrowYPos:false,posType:"TL",markupString:'<div id="{@id}" class="'+O+' {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout><div class="'+O+'-shadow {@shadowNodeCssClass}"></div><div class="'+O+'-contentWrapper"><div class="'+O+"-content "+A+' {@contentNodeCssClass}" style="{@contentNodeCssText}"></div></div><div class="'+O+'-arrow"></div></div>',markupSlots:{containerNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[1].firstChild;},shadowNode:function(){return this.domNode.firstChild;},arrowNode:function(){return this.domNode.children[2];}},setupScrollNodes:function D(){this.scrollNode=this.contentNode;this.scrollbarHostNode=this.containerNode;},_previousVisible:false,markupMethods:{onvisibleChange:function(){var R=this.domNode.style,Q=!!this.visible;if(this._previousVisible!==Q){R.visibility="hidden";}R.display=Q?"block":"none";this._previousVisible=Q;if(Q){this.updatePosition();if(this.content){G.call(this);}}},onleftChange:G,ontopChange:G,onrefNodeChange:G,onposTypeChange:G,oncontentNodeCssClassChange:G,oncontentNodeCssTextChange:G,oncontentChange:G,oncssClassChange:G},preBuildRendering:function N(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},updatePosition:function H(V){if(!this.visible&&!V){return ;}var U=this.refNode,T=U?L.offset(U,document.body):{left:I.getHorizontalScroll(),top:I.getVerticalScroll()},l=this.domNode.style,e=this.containerNode,g=e.offsetWidth,Y=e.offsetHeight,R=this.posType,b=R.indexOf("R")>-1,W=R.indexOf("B")>-1,a=this.top!==null?parseInt(this.top,10)+T.top-(W?Y:0):null,S=this.left!==null?parseInt(this.left,10)+T.left-(b?g:((R.indexOf("C")>-1)?Math.floor(g/2):0)):null,j=false,Z=false,c,X,h=I.windowDim(),f=I.getHorizontalScroll()+h.w,Q=I.getVerticalScroll()+h.h,d=this.arrowNode,k=null;if(S!==null){c=Math.min(Math.max(S,0),f-g);l.left=c+"px";j=S!==c;}if(a!==null){X=Math.min(Math.max(a,0),Q-Y);l.top=X+"px";Z=a!==X;}if(j||Z){if((this.keepArrowXPos&&j)||(this.keepArrowYPos&&Z)){k=M.getComputedStyle(d);}if(this.keepArrowXPos&&j){d.style.left=(parseInt(k.left,10)+S-c)+"px";}if(this.keepArrowYPos&&Z){d.style.top=(parseInt(k.top,10)+a-X)+"px";}}M.toggleClass(this.domNode,"offset",j||Z);},_on_tooltip_change:function(Q){B(this,Q&&Q.src);},_set_opener:function(T,S){var R=this.opener,Q=S!==R;if(Q){if(S){C(S,this);}if(R){C(S,this,true);}if(R&&R.detachEventListener){R.detachEventListener(this._richSubs);R.detachEventListener(this._ttpSubs);}if(S&&S.attachEventListener){this._richSubs=S.attachEventListener("richTooltipChange",this.id,"_on_tooltip_change");this._ttpSubs=S.attachEventListener("tooltipChange",this.id,"_on_tooltip_change");}this.opener=S;}return Q;},updatePopupConfig:function(Q,R){B(this,R,Q&&Q.e,Q&&Q.win);},onscroll:function K(){if(this.visible&&this.nudge){this.nudge();}this._super();},onmouseover:mstrmojo.emptyFn,onmouseout:mstrmojo.emptyFn});var J=null;mstrmojo.tooltip={POS_TOPLEFT:"TL",POS_BOTTOMLEFT:"BL",POS_TOPRIGHT:"TR",POS_BOTTOMRIGHT:"BR",POS_BOTTOMCENTER:"BC",POS_TOPCENTER:"TC",open:function F(R,T,S,Q){if(!J||!mstrmojo.all[J.id]){J=new mstrmojo.Tooltip();}Q=Q||{};Q.e=T;Q.win=S;J.open(R,Q);R.tooltip=J;},close:function P(){if(J){if(J.opener){J.opener.tooltip=null;}J.close();}}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsPopup","mstrmojo._CanAutoClose");function A(B){return function(){this.domNode.style[B]=this[B]||"";};}mstrmojo.Popup=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.Popup",shadowNodeCssClass:"mstrmojo-popup-shadow",titleNodeCssClass:"mstrmojo-popup-title",contentNodeCssClass:"mstrmojo-popup-content",cssDisplay:"block",markupString:'<div id="{@id}" class="mstrmojo-Popup {@cssClass}" style="{@cssText}"><div class="mstrmojo-Popup-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Popup-title {@titleNodeCssClass}">{@title}</div><div class="mstrmojo-Popup-content {@contentNodeCssClass}"></div></div>',markupSlots:{containerNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onleftChange:A("left"),ontopChange:A("top"),onzIndexChange:A("zIndex")}});}());(function(){mstrmojo.requiresCls("mstrmojo.RadioButton");var C=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton=mstrmojo.declare(mstrmojo.RadioButton,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton",cssClass:"mstrmojo-wh-DBRoleRadioButton",enableChildren:function A(){var G=this.parent,F=this;C.forEach(G.children,function(H){if(H.parentRBAlias&&(H.parentRBAlias===F.alias)){H.set("enabled",F.checked);}});},enabled:true,getValue:function B(){return this.checked;},setValue:function E(F){this.checked=F;this.onclick();},isValid:function D(){return{val:true,msg:""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");var D=mstrmojo.dom,F=mstrmojo.array,E=mstrmojo.hash;var A;mstrmojo.SuggestionList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.SuggestionList",itemField:"n",getItemMarkup:function(H,G){if(!A){var I=this.itemField;A=this._super(H).replace(">{@en@n}<",' title="{@en@'+I+'}">{@en@'+I+"}<");}return A;},getItemProps:function C(I,G){var H=this._super(I,G),J=this.itemField;H[J]=I[J];return H;},onclick:function B(G){if(this.disableClick){return false;}var L=this,I=this.parent,K=I.opener,H=D.isMetaKey(G.hWin,G.e);if(H&&!this.multiSelect){this.multiSelect=K.parent.defn.multi;if(this.multiSelect){D.attachOneTimeEvent(document.documentElement,"keyup",function(){var N=L.selectedIndices;if(K){K.suggestionShown=false;if(N&&!E.isEmpty(N)){var M=[];E.forEach(L.selectedIndices,function(P,O){M.push(L.items[O]);});K.handleSuggestionItemSelect(M);}I.close();}L.multiSelect=false;});}}this._super(G);if(!this.multiSelect){K.suggestionShown=false;var J=this.selectedItem;if(J){K.handleSuggestionItemSelect(J);}I.close();}},bindings:{itemField:"this.parent.opener.itemField",items:"this.parent.opener.suggestionItems",disableClick:"this.parent.opener.disableClick"}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo._IsList","mstrmojo.ListBase");var D=mstrmojo.dom,G=mstrmojo.array,C=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.es.TableList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.es.TableList",cssClass:"mstrmojo-qb-emma-tablelist",itemMaxWidth:"",onitemMaxWidthChange:function F(I){var H=this.itemsContainerNode,J=H&&H.children,K=I.value;G.forEach(J,function(L){L.children[1].style.maxWidth=K;});},init:function E(K){this._super(K);var M=this,L={},J=L[this.id]={};J.refreshTables=function I(N){M.set("items",N.items);};J[C.DBROLES_DELETE]=function H(N){mstrApp.getRootController().removeDBRoleTables(N.item.did);};mstrApp.getRootController().attachDataChangeListeners(L);},getItemMarkup:function(I,H){return'<div class="item cf {@cls}" idx="{@idx}" style="{@style}"><div class="item-ic"></div><div class="item-n" title="{@title}" style="max-width: {@maxWidth}">{@n}</div><div class="item-del"></div></div>';},getItemProps:function B(I,H){return{cls:"tp"+I.tp,n:I.n,idx:H,title:[I.n," [",I.dbrn,"]"].join(""),maxWidth:this.itemMaxWidth};},onclick:function A(I){try{var L=I.target||D.eventTarget(I.hWin,I.e),K=D.findAncestorByAttr(L,"idx",true,this.domNode),H=K&&parseInt(K.value,10);if(H!==null&&!isNaN(H)){if(L.className==="item-del"){mstrApp.getRootController().removeTable(H);}}}catch(J){mstrApp.onerror(J);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");mstrmojo.ui.List=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.List",postselectionChange:function C(D){var G=D.added||[],F=G.length,I=D.removed||[],E=I.length;if(E){this.selectionRemoved({added:G,removed:I,isReselect:false});}if(F){var H=function(J){return[].concat(J).sort().join(",");};this.selectionAdded({added:G,removed:I,isReselect:H(G)===H(I)});}},selectionAdded:function A(D){},selectionRemoved:function B(D){}});mstrmojo.ui.List.SelectionChangeEvtType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo._IsList","mstrmojo.ListBase");mstrmojo.requiresDescs(505,629);var C=mstrmojo.dom;mstrmojo.qb.mdx.CubeList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.mdx.CubeList",cssClass:"mstrmojo-qb-emma-tablelist",init:function D(G){this._super(G);var I=this,H={},F=H[this.id]={};F.refreshTables=function E(J){I.set("items",J.items);};mstrApp.getRootController().attachDataChangeListeners(H);},getItemMarkup:function(F,E){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><div class="item-ic"></div><div class="item-n" title="{@n}"> {@n} </div><div class="item-refresh {@isNew}" title="'+mstrmojo.desc(505,"Update")+'"></div><div class="item-del {@isNew}" title="'+mstrmojo.desc(629,"Delete")+'"></div></div>';},getItemProps:function B(F,E){return{cls:"tp"+F.tp,n:F.n,isNew:F.isNew?"new":"exist",idx:E};},onclick:function A(F){try{var I=F.target||C.eventTarget(F.hWin,F.e),H=C.findAncestorByAttr(I,"idx",true,this.domNode),E=H&&parseInt(H.value,10);if(E!==null&&!isNaN(E)){if(I.className.indexOf("item-del")>-1){mstrApp.getRootController().removeCube(E);}else{if(I.className.indexOf("item-refresh")>-1){mstrApp.getRootController().updateCube(E);}}}}catch(G){mstrApp.onerror(G);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.InlineEditBox","mstrmojo.Button");var B=": ";mstrmojo.qb.thirdParty.InlineEditBox=mstrmojo.declare(mstrmojo.InlineEditBox,null,{postCreate:function A(){if(this._super){this._super();}this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.oneditModeChange=function(){var I=this.editMode,F=this.domNode,E=this.textNode,H=this.editNode;mstrmojo.css.toggleClass(F,["edit"],I);if(I){E.style.display="none";H.style.display="block";E=this.inputNode;var G=E.style;E.value=this.parent.url||"";G.width=(F.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";G.height=F.clientHeight+"px";E.focus();if(E.createTextRange){var J=E.createTextRange(),D=E.value.length;J.move("character",D);J.select();}}else{E.style.display="block";H.style.display="none";}};},save:function(){this.set("text",this.parent.dbRoleName+B+this.inputNode.value);this.set("editMode",false);if(this.onSave){this.onSave();}},rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){this.parent.set("url",this.inputNode.value);},bindings:{text:function(){return this.parent.dbRoleName+B+this.parent.url;}}});mstrmojo.qb.thirdParty.UrlSourceItem=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.thirdParty.UrlSourceItem",markupString:"<div class='qb-bi-source-url-list' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},iconNode:function(){return this.domNode.children[0];},contentNode:function(){return this.domNode.children[1];},deleteNode:function(){return this.domNode.children[2];}},allowEdit:true,url:"",dbRoleID:"",dbRoleName:"",children:[{slot:"iconNode",alias:"icon",cssClass:"mstrmojo-di-url-icon",scriptClass:"mstrmojo.Label"},{slot:"contentNode",alias:"text",cssClass:"urlItem-text-div",scriptClass:"mstrmojo.qb.thirdParty.InlineEditBox"},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-url-delete-button",innerIconClass:"close-button",onclick:function(){this.parent.deleteURL();}}],deleteURL:function C(){this.parent.deleteURL(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button");mstrmojo.HTMLButton=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.HTMLButton",markupString:'<input id="{@id}" type="button" class="mstrmojo-text mstrmojo-HTMLButton mstrButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:click />',markupSlots:{inputNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline":"none";},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onselectedChange:function(){mstrmojo.css[this.selected?"addClass":"removeClass"](this.domNode,["selected"]);},ontextChange:function(){this.inputNode.value=this.text!=null?this.text:"";},oniconClassChange:function(){this.domNode.className="mstrmojo-text mstrmojo-HTMLButton mstrButton "+this.cssClass+" "+this.iconClass+(this.enabled?"":" disabled");}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.dom","mstrmojo.hash");var V=mstrmojo.hash,X=mstrmojo.dom,F="h",S="w",G="100%",L="none",U={HORIZONTAL:0,VERTICAL:1},D=U.HORIZONTAL,B="horizontal",H="vertical",J={firstSplitNode:"300px",resizeHandleNode:"5px",secondSplitNode:G};function Q(){var b=this.config,Z=this.orientation,d=(Z===D)?S:F,Y=(Z===D)?F:S,a="Node",e=this.layoutConfig||{};e.xt=true;e[d]=e[d]||V.copy(J);e[Y]=e[Y]||{firstSplitNode:G,resizeHandleNode:G,secondSplitNode:G};var c=e[d];V.forEach(b,function(g,f){c[f+a]=g.v;});return e;}function I(j){var b=this._wPos,Z=(this.orientation===D)?"x":"y",m=j[Z]-b[Z],d=this.config,l=d.firstSplit,o=d.secondSplit,k=parseInt(l.min,10),a=parseInt(o.min,10),f=(l.v.indexOf("px")>-1),c=parseInt((this.orientation===D)?this.width:this.height,10);if(!f){if(m===c){m=c*(parseInt(l.v,10)/100);}}var g=c-a,Y=Math.floor(Math.min(Math.max(m,k),g));if(this.applyPercentage){var n=Math.round((Y/c)*100),h=(c-parseInt(d.resizeHandle.v,10)-Y),e=Math.round((h/c)*100);if((n+e)<100){e+=(100-(n+e));}l.v=n+"%";o.v=e+"%";}else{l.v=Y+"px";o.v="100%";}this.layoutConfig=Q.call(this,d);this.doLayout();}mstrmojo.ui.Splitter=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.ui.Splitter",markupString:'<div id="{@id}" class="mstrmojo-Splitter {@orientationCss} {@cssClass}"><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-SplitterHandle"></div><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-clearingDiv"></div></div>',markupSlots:{firstSplitNode:function C(){return this.domNode.firstChild;},resizeHandleNode:function A(){return this.domNode.children[1];},secondSplitNode:function K(){return this.domNode.children[2];}},orientation:D,orientationCss:"",applyPercentage:false,onRender:function O(){if(this.applyPercentage){var Z=(this.orientation===D)?"x":"y",Y={};this._wPos={};Y[Z]=parseInt((this.orientation===D)?this.width:this.height,10);this._wPos[Z]=0;I.call(this,Y);}},config:{firstSplit:{v:"50%",min:"100px",max:undefined},secondSplit:{v:"50%",min:"100px",max:undefined},resizeHandle:{v:"5px"}},init:function W(Y){this._super(Y);var Z=(this.orientation===D);this.orientationCss=Z?B:H;this.restrictedToAxis=Z?"x":"y";this.config=V.clone(this.config);this.layoutConfig=Q.call(this);},toggleFirstItemVisibility:function N(Y){if(Y){this.layoutConfig=Q.call(this);}else{this.layoutConfig[(this.orientation===D)?S:F]={firstSplitNode:"0px",resizeHandleNode:"0px",secondSplitNode:G};}this.doLayout();},toggleSecondItemVisibility:function P(Y){if(Y){this.layoutConfig=Q.call(this);}else{this.layoutConfig[(this.orientation===D)?S:F]={firstSplitNode:G,resizeHandleNode:"0px",secondSplitNode:"0px"};}this.doLayout();},draggable:true,dropZone:false,avatarCssClass:"mstrmojo-Splitter-av",delayResizing:false,createAvatar:function T(){var c=document.createElement("div"),b=(this.orientation===D),Z=this._wPos=X.position(this.domNode),a="2px",Y=c.style;Y.top=(b?Z.y:0)+"px";Y.left=(b?0:Z.x)+"px";Y.height=b?this.height:a;Y.width=b?a:this.width;Y.display=this.delayResizing?"block":L;return c;},isDragValid:function E(Y){return Y.src.node===this.resizeHandleNode||this._super(Y);},ondragmove:function R(Y){if(!this.delayResizing){I.call(this,Y.tgt.pos);}if(this._super){this._super(Y);}},ondragend:function M(Y){if(this.delayResizing){I.call(this,Y.tgt.pos);}delete this._wPos;if(this._super){this._super(Y);}}});mstrmojo.ui.Splitter.ENUM_OR=U;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.hash");var K=mstrmojo.hash,Q=mstrmojo.css,S="hidden",P=mstrmojo.Widget,R="mstrmojo-wh-pn-",A="titleIconsNode";mstrmojo.warehouse.ui.BasePanel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.warehouse.ui.BasePanel",markupString:'<div id="{@id}" class="mstrmojo-wh-Panel {@cssClass}" mstrAttach:click><div class="'+R+'header"><div class="'+R+'title tp{@icntp}"><span>{@title}</span></div><div class="'+R+'ttl-icons"></div></div><div><div class="'+R+'instructions-text">{@instructionsText}</div></div></div>',markupSlots:{headerNode:function F(){return this.domNode.firstChild;},titleNode:function J(){return this.domNode.firstChild.firstChild;},titleTextNode:function L(){return this.domNode.firstChild.firstChild.firstChild;},titleIconsNode:function C(){return this.domNode.firstChild.children[1];},instructionsNode:function E(){return this.domNode.lastChild.children[0];},containerNode:function M(){return this.domNode;}},markupMethods:{onvisibleChange:P.visibleMarkupMethod,onheightChange:P.heightMarkupMethod,onwidthChange:P.widthMarkupMethod},onRender:function G(){this._super();if(this.instructionsHeight){this.oninstructionsHeightChange({value:this.instructionsHeight});}this.oninstructionsVisibleChange({value:this.instructionsVisible});},title:"",titleTooltip:"",icntp:"",postBuildRendering:function N(){this._super();if(this.editableSlot){this.setEditableTitle("");}},ontitleChange:function O(){this.titleTextNode.innerHTML=this.title;},addNewTitleButton:function B(T){this.addChildren(K.copy(T,{scriptClass:"mstrmojo.Widget",markupString:'<span id="{@id}" class="{@cssClass}" mstrAttach:click>{@text}</span>',onvisibleChange:function U(){this.domNode.style.display=this.visible?"":"none";},useRichTooltip:true,showTooltip:function V(W,X){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.domNode,top:32,content:this.title||""};this.constructor.prototype.showTooltip.call(this,W,X);},slot:A}));},setEditableTitle:function I(T){Q.toggleClass(this.titleNode,S,(T===""));Q.toggleClass(this.titleIconsNode,S,(T===""));this.set("text",T);this.set("title",T);},instructionsText:"",instructionsHeight:undefined,oninstructionsHeightChange:function H(T){var V=this.instructionsNode,U=T.value;if(V){V.style.height=U;V.style.lineHeight=U;}else{this.instructionsHeight=undefined;}},instructionsVisible:false,oninstructionsVisibleChange:function D(T){if(T.value){this.instructionsNode.style.display="block";}else{this.instructionsNode.style.display="none";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var D=function(){var F=this.opener;if(F.direction.toLowerCase()==="up"){this.domNode.style.top=-F.domNode.offsetHeight+"px";}};mstrmojo.DropDownButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DropDownButton",height:"19px",text:"",direction:"down",enabled:true,title:"",markupString:'<div id="{@id}" class="mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}" mstrAttach:mousedown><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode">{@text}</div></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:{boxNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onheightChange:function(){this.boxNode.style.height=this.height||"";},ontextChange:function(){this.iconNode.innerHTML=this.text;},ontitleChange:function(){this.boxNode.title=this.title;},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function B(){if(this._super){this._super();}var F=this.popupRef;if(F){if(F.nudge){F.nudge=mstrmojo.func.composite([F.nudge,D]);}else{if(this.direction.toLowerCase()!=="down"){F.nudge=D;}}}},popupRef:null,popupOpenConfig:null,destroy:function C(F){var G=this.popupRef;if(G&&G.hasRendered){G.destroy(false);}if(this._super){this._super(F);}},togglePopup:function E(){var F=this._lastOpened;if(F&&F.visible){this.closePopup();}else{this.openPopup("popupRef",this.popupOpenConfig);}},premousedown:function A(F){this.togglePopup();}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var B=mstrmojo.func,C=mstrmojo.dom,F="mstrmojo-popup-widget-hosted";mstrmojo.ui.PopupButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ui.PopupButton",onPopupWidgetClosed:mstrmojo.emptyFn,onPopupWidgetOpened:mstrmojo.emptyFn,anchorSlot:"domNode",isHostedWithin:true,hostedCSSClass:"",destroy:function H(L){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);}this._super(L);},getPopupWidget:mstrmojo.emptyFn,postCreateChildren:function D(){var L=this.getPopupWidget();if(!L||L._pbCfg){return ;}var M=function M(O,N){return function(){O.apply(N,arguments);};};L.onOpen=B.composite([M(this.onPopupWidgetOpened,this),L.onOpen||mstrmojo.emptyFn]);L.onClose=B.composite([M(this.onPopupWidgetClosed,this),L.onClose||mstrmojo.emptyFn]);L._pbCfg=true;},onclick:function K(L){var N=L.getTarget();if(N===this[this.anchorSlot]||N.parentNode===this[this.anchorSlot]){var M=this.getPopupWidget();if(!M.visible){this.openPopup(M);}else{this.closePopup();}}},onPopupAutoClosed:function I(M,L){if(C.contains(this[this.anchorSlot],C.eventTarget(L,M),true)){return false;}},getPopupHostNode:function J(){return this.containerNode;},getPopupConfig:function G(){var M=[F],L=this.hostedCSSClass;if(L){M.push(L);}return new mstrmojo.ui.PopupConfig({hostId:this.id,hostElement:this.getPopupHostNode(),anchorElement:this[this.anchorSlot],isHostedWithin:this.isHostedWithin,hostProxyCssClass:M.join(" ")});},unrender:function E(L){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);delete this._listenerProc;}this._super(L);},postBuildRendering:function A(){var P=this.getPopupWidget();if(P){var R=this.getPopupConfig();if(!R.isHostedWithin){var N=this.parent||this.opener,M=R.hostProxyCssClass.split(" ");M.push(this.domNode.className);while(N){var Q=N.themeClassName;if(Q){M.push(Q);break;}N=N.parent||N.opener;}R.hostProxyCssClass=M.join(" ");}P.popupConfig=P.addDisposable(R);}var L=P.id,O=this._listenerProc=function(){var S=mstrmojo.all[L];if(S&&S.visible&&S.adjustCornersForPopupOverflow){S.adjustCornersForPopupOverflow();}};if(this.isHostedWithin===false){C.attachEvent(window,"resize",O);}return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.css");var F="",B="row-",E=mstrmojo.css.DISPLAY_TABLE;mstrmojo.Table=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Table",cellCssClass:"",rows:-1,cols:-1,_trows:-1,cellPadding:0,cellSpacing:0,layout:null,markupString:'<table id="{@id}" class="mstrmojo-Table {@cssClass}" style="{@cssText}" cellpadding="{@cellPadding}" cellspacing="{@cellSpacing}">{@tableHtml}</table>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?E:"none";}},preBuildRendering:function G(){var I=[],P=this.cellCssClass;if(this.layout){var Q=this._trows=this.layout.length;for(var K=0;K<Q;K++){var H=this.layout[K],R=H.cells,O=R.length,L=[];for(var J=0;J<O;J++){var N=R[J],M="";M+=((N.cssClass||P)?' class="'+(N.cssClass||P)+'"':"");M+=(N.cssText?' style="'+N.cssText+'"':"");M+=(N.rowSpan?' rowspan="'+N.rowSpan+'"':"");M+=(N.colSpan?' colspan="'+N.colSpan+'"':"");L[J]="<td"+M+"></td>";}var S="";S+=(H.cssClass?' class="'+H.cssClass+'"':"");S+=(H.cssText?' style="'+H.cssText+'"':"");I[K]="<tr"+S+">"+L.join("")+"</tr>";}}else{this._trows=this.rows;var M=(P?' class="'+P+'"':""),L=[];for(var K=0;K<this.rows;K++){for(var J=0;J<this.cols;J++){L[J]="<td"+M+"></td>";}I[K]="<tr>"+L.join("")+"</tr>";}}this.tableHtml=I.join("");if(this._super){this._super();}},postBuildRendering:function C(){if(this._trows){var M={},I=this.containerNode.rows,N=I.length;for(var L=0;L<N;L++){var K=I[L].cells,H=K.length;M[B+L]=I[L];for(var J=0;J<H;J++){M[F+L+","+J]=K[J];}}this.addSlots(M);}this._super();},childRenderCheck:function D(I){if(I&&!I.hasRendered){var H=I.slot||this.defaultChildSlot;return !!this[H]||H.match(/^([\d]+),([\d]+)$/);}return false;},on_child_change_rendering:function A(L){var H=(L&&L.src)||L,O=H&&H.domNode;if(O){var U=H.slot;if(!this[U]){var M=U&&U.match(/^([\d]+),([\d]+)$/);if(M){var R=parseInt(M[1],10),V=parseInt(M[2],10),Q=this.containerNode,T=this[(B+R)],N=[];if(!T){var J=Q.rows,S=J&&J.length||0;for(var K=S;K<=R;K++){N[B+K]=Q.insertRow();}T=N[B+R];}var P=T.cells&&T.cells.length||0;for(var K=P;K<=V;K++){var I=T.insertCell(K);N[F+R+","+K]=I;if(this.cellCssClass){I.className=this.cellCssClass;}}this.addSlots(N);}}}this._super(L);}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Container");var D="slot";mstrmojo.HBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.HBox",cellCssClass:"",cellSpacing:0,cellPadding:0,markupString:'<table id="{@id}" class="mstrmojo-HBox {@cssClass}" style="{@cssText}" cellspacing="{@cellSpacing}" cellpadding="{@cellPadding}">{@colHTML}<tr>{@tableHtml}</tr></table>',colHTML:"",markupSlots:{containerNode:function(){return this.domNode.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildRendering:function B(){this.tableHtml="";var N=[],F=this.children,K=(F&&F.length)||0,I;if(K){var G=0,J=this.cellCssClass?' class="mstrmojo-HBox-cell '+this.cellCssClass+'" ':"",M="<td "+J+"></td>";for(I=0;I<K;I++){N[G++]=M;F[I].slot=D+I;}this.tableHtml=N.join("");}this._super();if(K){var L={},H=this.containerNode.cells;for(I=0;I<K;I++){L["slot"+I]=H[I];}this.addSlots(L);}},addChildren:function E(K,F,G){if(!K){return K;}if(F===undefined||isNaN(F)||F<0){var J=this.children;F=(J&&J.length)||0;}var I=0,H;if(K.constructor===Array){for(I=0,H=K.length;I<H;I++){K[I].slot=D+(F+I);}}else{K.slot=D+F;}return this._super(K,F,G);},childRenderCheck:function C(G){if(G&&!G.hasRendered){var F=G.slot||this.defaultChildSlot;return !!this[F]||F.match(/^slot[\d]+$/);}return false;},onchildRenderingChange:function A(I){var F=(I&&I.src)||I,L=F&&F.domNode;if(L){var Q=F.slot;if(!this[Q]){var J=Q&&Q.match(/^slot([\d]+)$/);if(J){var O=parseInt(J[1],10),N=this.containerNode,P=N.cells,M=(P&&P.length)||0,K={};for(var H=M;H<=O;H++){var G=N.insertCell(H);K["slot"+H]=G;if(this.cellCssClass){G.className=this.cellCssClass;}}this.addSlots(K);}}}this._super(I);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.Widget;mstrmojo.Box=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:A.visibleMarkupMethod,onheightChange:A.heightMarkupMethod,onwidthChange:A.widthMarkupMethod}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css");var A=mstrmojo.css;var I=mstrmojo.dom;function B(K){var M=document.createElement("div"),L=M.style,J=K.domNode;M.className="mstrmojo-qb-SplitPanel-avatar";L.height=J.clientHeight+"px";J.appendChild(M);K.avatar=M;return M;}mstrmojo.qb.SplitPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.SplitPanel",draggable:true,dropZone:false,marginSpan:10,minSpan:200,leftItemVisible:true,rightItemVisible:true,lp:25,markupString:'<div id="{@id}" class="mstrmojo-SplitPanel {@cssClass}" style="{@cssText}" ><table cellpadding=0 cellspacing=0><tr><td><div></div></td><td style="padding-left:{@marginSpan}px;"><div class="mstrmojo-qb-SplitPanel-resizeHandle" style="height:{@height};width:{@marginSpan}px;margin-left:-{@marginSpan}px;" ></div><div></div></td></tr></table></div>',markupSlots:{leftItem:function(){return this.domNode.firstChild.firstChild.firstChild.firstChild.firstChild;},rightItem:function(){return this.domNode.firstChild.firstChild.firstChild.children[1].children[1];}},getDragData:function H(J){var K=J.src,M=K.node;if(M.className&&M.className.indexOf("mstrmojo-qb-SplitPanel-resizeHandle")>=0){var L=I.position(this.domNode);return{node:M,x:L.x,y:L.y,w:L.w,h:L.h};}else{if(this._super){return this.dropZone&&this._super(J);}}return null;},allowDrop:function E(J){var K=J.src,L=K&&K.data;if(L&&L.node){return true;}else{return this.dropZone;}},ondragmove:function F(J){var L=J.src,N=L&&L.data;if(N&&N.node){var K=J.tgt,M=this.avatar;if(M){M.style.left=Math.min(Math.max(N.x+this.minSpan,K.pos.x),N.x+N.w-this.minSpan)+"px";}}},isDragValid:function G(J){var K=J.src,L=K&&K.data;return !!(L&&L.node);},ondragstart:function C(J){var K=J.src,M=K&&K.data;var L=this.avatar||B(this);this.ownAvatar=true;L.style.left=K.pos.x+"px";L.style.top=M.y+"px";L.style.display="block";L.style.zIndex="9999";L.style.height=M.h+"px";},ondragend:function D(J){var L=J.src,O=L&&L.data;if(O&&O.node){var N=this.avatar;if(N){N.style.display="none";var K=parseInt(N.style.left)-O.x-this.marginSpan/2,M=this.domNode.clientWidth;this.lp=K*100/M;this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};this.doLayout();}this.ownAvatar=false;}},children:[{scripClass:"mstrmojo.Box",slot:"leftItem"},{scripClass:"mstrmojo.Box",slot:"rightItem"}],layoutConfig:{w:{leftItem:"20%",rightItem:"80%"},h:{leftItem:"100%",rightItem:"100%"}},afterLayout:function(){if(this.domNode){var J=this.domNode.firstChild.firstChild.firstChild.children[1].children[0].style;if(this.leftItemVisible&&this.rightItemVisible){J.display="block";this.children[0].set("visible",true);this.children[1].set("visible",true);J.height=this.height;var L=parseInt(this.children[0].width);this.children[0].set("width",L+"px");this.rightItem.style.width=parseInt(this.width)-L-this.marginSpan+"px";this.children[1].set("width",this.rightItem.style.width);}else{J.display="none";if(this.leftItemVisible){this.children[0].set("width",this.width);this.children[1].set("visible",false);}else{this.children[1].set("width",this.width);this.children[0].set("visible",false);var K=this.rightItem.parentNode;K.style["padding-left"]="0px";}}}},_set_leftItemVisible:function(L,J){if(this.leftItemVisible!=J){this.leftItemVisible=J;if(J){this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};if(this.rightItem){var K=this.rightItem.parentNode;K.style["padding-left"]=this.marginSpan+"px";}}else{this.layoutConfig.w={leftItem:"0%",rightItem:"100%"};if(this.rightItem){var K=this.rightItem.parentNode;K.style["padding-left"]="0px";}}this.doLayout();}},_set_rightItemVisible:function(K,J){if(this.rightItemVisible!=J){this.rightItemVisible=J;if(J){this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};}else{this.layoutConfig.w={leftItem:"100%",rightItem:"0%"};}this.doLayout();}},postBuildRendering:function(){if(this._super){this._super();}this.height=this.domNode.clientHeight+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.css","mstrmojo.dom");var Y=mstrmojo.css,F=mstrmojo.dom;var Z={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};function A(){var c=this.value,b=this.inputNode,d=b.value,a=(c!==null&&c!==undefined)?String(c):"";if(a!==d&&(!this.keepEmpty||d!==this.emptyText)){b.value=a;}if(b.mstrmojoEmpty){Y.removeClass(b,[this.emptyClass]);b.mstrmojoEmpty=null;}}function X(){var a=this.inputNode;a.value=this.emptyText||"";Y.addClass(a,[this.emptyClass]);a.mstrmojoEmpty=true;}function N(){var a=this.inputNode;if(a){this.readingDom=true;this.set("value",a.value);this.readingDom=false;}}function U(a){var b=this;if(a===-1){N.call(this);}else{if(this._lastTimeoutId){window.clearTimeout(this._lastTimeoutId);}this._lastTimeoutId=window.setTimeout(function(){delete b._lastTimeoutId;N.call(b);},a||100);}}mstrmojo.TextBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.TextBox",value:"",type:"text",hint:"",readOnly:false,size:"",maxLength:"",cssDisplay:"inline",tabIndex:"",emptyText:"",keepEmpty:false,emptyClass:"mstrmojo-empty",valueChangeDelay:-1,textValid:true,autoComplete:true,autoCorrect:true,autoCapitalize:true,markupString:'<input id="{@id}" class="mstrmojo-TextBox {@cssClass}"  style="{@cssText}" title="{@tooltip}" type="{@type}" value="" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}"min="{@min}" max="{@max}" placeholder="{@hint}" mstrAttach:focus,keyup,blur,paste,cut,input,click,keydown  tstid="{@tstid}"/>',markupSlots:{inputNode:function D(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,oncssClassChange:function S(){this.inputNode.className="mstrmojo-TextBox "+(this.cssClass||"");},onhintChange:function O(){this.inputNode.setAttribute("placeholder",this.hint);},onenabledChange:function E(){var a=this.inputNode;a.disabled=!this.enabled;Y.toggleClass(a,"disabled",!this.enabled);},onvalueChange:function P(){var a=this.value,b=(a===undefined)||(a===null)||(a==="");if(b){if(!this.hasFocus){X.call(this);}else{this.inputNode.value="";}}else{A.call(this);}if(F.isIE9){this.inputNode.type=b?"text":this.type;}},ontooltipChange:function R(){this.domNode.title=this.tooltip;},onreadOnlyChange:function H(){this.inputNode.readOnly=this.readOnly;},ontextValidChange:function B(){Y.toggleClass(this.inputNode,["err"],!this.textValid);}},postBuildRendering:function V(){this._super();var a=this.inputNode;a.setAttribute("autocomplete",this.autoComplete?"on":"off");a.setAttribute("autocorrect",this.autoCorrect?"on":"off");a.setAttribute("autocapitalize",this.autoCapitalize?"on":"off");},focus:function Q(){if(this.inputNode&&this.inputNode.offsetParent){try{this.inputNode.focus();}catch(a){}}},prefocus:function M(){this.hasFocus=true;A.call(this);},blur:function T(){this.inputNode.blur();},preblur:function W(){window.setTimeout(function(){},200);this.hasFocus=false;N.call(this);var a=this.value;if(((a===null||a==="")&&this.emptyText)||(this.keepEmpty&&a===this.emptyText)){X.call(this);}},prekeyup:function I(b){var a=b.hWin,c=b.e||a.event;U.call(this,this.valueChangeDelay);var d=Z[c.keyCode];if(this["on"+d]){this["on"+d](b);}},preinput:function J(){U.call(this,this.valueChangeDelay);},prepaste:function K(){U.call(this);},precut:function G(){U.call(this);},setInvalidState:function C(a){this.set("textValid",true);if(a){this.domNode.setAttribute("title",a);}},cleanUp:function L(){this.inputNode.value="";this.set("textValid",false);this.domNode.setAttribute("title",this.tooltip);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapper","mstrmojo.ListBuilder","mstrmojo.ListSelector");mstrmojo.List=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.List",renderOnScroll:true,listMapper:mstrmojo.ListMapper,listBuilder:mstrmojo.ListBuilder,listSelector:mstrmojo.ListSelector,itemIdField:"dssid",itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapperHoriz","mstrmojo.ListBuilder");mstrmojo.ListHoriz=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.ListHoriz",renderOnScroll:true,listMapper:mstrmojo.ListMapperHoriz,listBuilder:mstrmojo.ListBuilder,itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2");function B(E){var I=E.ctxtBuilder;if(I){var H=I.itemWidgets,G;for(G=H.length-1;G>-1;G--){var F=H[G];if(F){F.destroy(true);}}}}mstrmojo.WidgetListBase=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.WidgetListBase",unrender:function C(G){var I=this.ctxtBuilder;if(I){var H=I.itemWidgets,F;for(F=H.length-1;F>-1;F--){var E=H[F];if(E&&E.hasRendered){E.unrender(true);}}}this._super(G);},refresh:function A(E){B(this);if(this._super){this._super(E);}},destroy:function D(E){B(this);this._super(E);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo._HasEditableText","mstrmojo.css");var B=mstrmojo.css;mstrmojo.EditableLabel=mstrmojo.declare(mstrmojo.Label,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.EditableLabel",autoApplyDelay:-1,markupString:'<div id="{@id}" class="mstrmojo-EditableLabel {@cssClass}" title="{@title}" contenteditable="{@isEditing}" style="{@cssText}" mstrAttach:click,mousedown,blur,keydown,keyup></div>',onkeyup:function C(D){this._super(D);if(this._autoApplyTimer){window.clearTimeout(this._autoApplyTimer);}if(this.autoApplyDelay!==-1){var E=this;this._autoApplyTimer=window.setTimeout(function(){E.set("isEditing",false);},this.autoApplyDelay);}},selectable:true});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.EditableLabel,{onselectableChange:function A(){var E=this[this.editableSlot],D=!!this.selectable;E.selectable=D;E.setAttribute("unselectable",!D?"on":"off");B.toggleClass(E,"unselectable",!D);}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetListBase","mstrmojo.WidgetListMapper","mstrmojo.WidgetListBuilder");mstrmojo.WidgetList=mstrmojo.declare(mstrmojo.WidgetListBase,null,{scriptClass:"mstrmojo.WidgetList",renderOnScroll:true,listMapper:mstrmojo.WidgetListMapper,listBuilder:mstrmojo.WidgetListBuilder,itemConfig:null,itemFunction:null,initBindings:function(){this._super();var E=this.ctxtBuilder,D=E&&E.itemWidgets;if(D){for(var C=0,A=D.length;C<A;C++){var B=D[C];if(B&&B.initBindings){B.initBindings();}}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListHoriz","mstrmojo.fx");mstrmojo.FishEye=mstrmojo.declare(mstrmojo.ListHoriz,null,{scriptClass:"mstrmojo.FishEye",width:16,size:10,step:16,speed:2,cssClass:"mstrmojo-FishEye",cssClassItem:"mstrmojo-dot",itemMarkupFunction:function(B,A,C){return'<div class="mstrmojo-fisheye-item '+C.cssClassItem+'" title="'+B.n+'" idx="'+A+'" did="'+B.did+'">&nbsp;</div>';},onchange:function(){this.scroll2();this.parent.set("selectedIndex",this.selectedIndex);},as:new mstrmojo.fx.AnimateProp(),onitemsChange:function(){if(this._super){this._super();}this.last=this.items.length-1;this.first=Math.max(0,this.last-this.size);if(this.items.length>this.size){this.scroll("left",this.width);}},scroll2:function(){var A=this.selectedIndex-this.last;if(this.selectedIndex==this.first&&this.first>0){this.scroll("right",this.width);}else{if(this.selectedIndex==this.last&&this.last<this.items.length-1){this.scroll("left",this.width);}else{if(this.selectedIndex>this.last){A=this.selectedIndex-this.last;this.scroll("left",this.width*A,A);this.last=Math.min(this.items.length-1,this.last+A);}else{if(this.selectedIndex<this.first){A=this.first-this.selectedIndex;this.scroll("right",this.width*A,A);this.first=Math.max(0,this.first-A);}}}}},scroll:function(C,F,E){var B=this.itemsContainerNode,I=B&&B.style;var D=this.as,H=parseInt(mstrmojo.css.getStyleValue(B,{left:"right",right:"left"}[C]),10),H=isNaN(H)?0:H,A=parseInt(I.left,10)||0,G=A+(C=="left"?-1:1)*(F||(Math.min(this.step,(-1)*H)));D.target=B;D.props={left:{start:A,stop:G,duration:100,interval:10,suffix:"px"}};D.play();E=E===undefined?1:E;this.first+=(C=="left"?1:-1)*E;this.last=this.first+this.size-1;this.parent.set("scrollable",this.last<this.items.length-1);this.parent.set("rightScrollable",this.first>0);return G;},srcId:null,postBuildRendering:function(){if(this._super){this._super();}this.hasRendered=!!this.domNode;var E=this.itemsContainerNode,A=E&&E.firstChild,B=A&&A.rows&&A.rows[0],D=B&&B.cells&&B.cells[0];this.first=0;this.last=this.size-1;var C=this.srcId;if(C&&mstrmojo.all[C]&&mstrmojo.all[C].attachEventListener){mstrmojo.all[C].attachEventListener("change",this.id,function(F){if(this.items[this.items.length-1]!=F.src.selectedItem){this.items.add([mstrmojo.hash.copy(F.src.selectedItem)]);this.set("selectedIndex",this.items.length-1);}if(this.items.length>this.size){this.set("rightScrollable",this.items.length>this.size);this.scroll("left",this.width*(this.selectedIndex-this.last),(this.selectedIndex-this.last));}});}this.itemsContainerNode.style.left=Math.min(0,(this.size-this.items.length+1))*this.width+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListSelector","mstrmojo.List","mstrmojo.string");mstrmojo.OBList=mstrmojo.declare(mstrmojo.List,null,{scriptClass:"mstrmojo.OBList",cssClass:"mstrmojo-OBList",itemClass:"mstrmojo-OBListItem",iconClass:"mstrmojo-OBListItemIcon",textClass:"mstrmojo-OBListItemText",iconCssPrefx:"mstrmojo-OBIcon_",itemMarkupFunction:function(C,A,B){return'<div class="'+B.itemClass+(C[B.itemType]?" t_"+C[B.itemType]:"")+(C[B.itemSubType]?" st_"+C[B.itemSubType]:"")+(C[this.itemISC]?" isc":"")+(C[B.itemViewMedia]?" vm_"+C[B.itemViewMedia]:"")+'"><table cellspacing="0" cellpadding="0"><tbody><tr><td>'+B.getIcon(C)+'</td><td><div class="'+B.textClass+'" title="'+B.getTooltip(C)+'">'+mstrmojo.string.htmlAngles(C.n)+"</div></td></tr></tbody></table></div>";},getIcon:function(F){var E=F[this.itemType],D=F[this.itemSubType],B=" t"+E,C=(parseInt(E,10)===1||parseInt(E,10)===3||parseInt(D,10)===14082)?" st"+D:"",G=F[this.itemISC]?'class="mstrmojo-ListIcon isc"':"",A=(F[this.itemViewMedia]===2048||F[this.itemViewMedia]===8192)?" hvi":"";return'<span class="mstrmojo-ListIcon '+B+C+A+'"><span '+G+"></span></span>";},getTooltip:function(C){var D="",F=C.anc&&C.anc.items,A=F&&F.length,B;if(A>0){for(B=0;B<A-1;B++){D+=F[B].n+" > ";}D+=F[A-1].n;}var E=C.desc,G=128;if(E){D+="\r\n\r\n"+E.substring(0,G)+(E.length>G?"...":"");}return D;},listSelector:mstrmojo.ListSelector,selectionPolicy:"reselect",itemType:"t",itemSubType:"st",itemISC:"isc",itemViewMedia:"dvm",useDblSelect:false});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.Popup","mstrmojo.List","mstrmojo.DropDownButton");var B=mstrmojo.dom;mstrmojo.Pulldown=mstrmojo.declare(mstrmojo.DropDownButton,null,{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-Pulldown",items:null,itemIdField:"dssid",itemField:"n",itemCSS:"css",itemTitleField:null,defaultSelection:0,defaultText:null,title:"",value:null,popupToBody:false,popupCssClass:"",popupZIndex:null,fixWidth:false,fixHeight:false,_set_items:function(H,F){var G=this.items;this.items=F||[];return G!==this.items;},markupMethods:mstrmojo.hash.copy({onvalueChange:function(){var G=this.value,F=this.selectedIndex,I=this.items||[],J,H;if(F===undefined||(G!==null&&(F===-1||(F!==-1&&I[F]&&I[F][this.itemIdField]!==G)))){F=mstrmojo.array.find(I,this.itemIdField,G);F=(F>-1)?F:this.defaultSelection;this.selectedIndex=F;}else{if(G===null){this.selectedIndex=this.defaultSelection;}}this.selectedItem=J=I[this.selectedIndex];if(J){H=J[this.itemField];}else{H=this.defaultText||"";}this.set("text",H);}},mstrmojo.hash.copy(mstrmojo.DropDownButton.prototype.markupMethods)),prevalueChange:function D(){var G=this.value,F=-1;if(G!==null){F=mstrmojo.array.find(this.items,this.itemIdField,G);}if(F>-1){this.selectedItem=this.items[F];this.selectedIndex=F;}},togglePopup:function E(){if(this.popupToBody){var I=B.position(this.popupNode,true),H=this.popupRef,F={left:Math.round(I.x)+"px",top:Math.round(I.y)+"px"};if(!H.hasRendered){delete H.slot;F.placeholder=document.body.appendChild(document.createElement("div"));}this.popupOpenConfig=this.popupOpenConfig||{};mstrmojo.hash.copy(F,this.popupOpenConfig);}else{this.popupRef.slot="popupNode";}if(this._super){this._super();}var G=this.popupRef.domNode;if(G){if(this.fixWidth){G.style.width=(this.domNode.offsetWidth-2)+"px";}else{G.style.minWidth=(this.domNode.offsetWidth-2)+"px";}}},premousedown:function A(F){if(B.getButton(F.hWin,F.e)===B.MOUSE_BUTTON.LEFT){this.togglePopup();}},unrender:function C(F){var G=this.popupRef;if(this.popupToBody&&G.hasRendered){G.unrender(false);}if(this._super){this._super(F);}},itemName:function(H,F,G){return mstrmojo.string.encodeHtmlString(H[G.itemField]);},popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",cssClass:"mstrmojo-Pulldown-Popup",autoCloses:false,modal:false,autoClose:true,locksHover:true,onOpen:function(){var H=this.opener,G=H&&H.popupZIndex,I=(H&&H.popupCssClass)||"",F=this.domNode;if(G){F.style.zIndex=G;}if(I){mstrmojo.css.addClass(F,[I]);}if(H&&H.fixWidth){mstrmojo.css.addClass(F,["fix-width"]);}if(H&&H.fixHeight){mstrmojo.css.addClass(F,["fix-height"]);}},children:[{scriptClass:"mstrmojo.List",alias:"list",itemMarkupFunction:function(I,F,G){var H=I[G.itemCSS]||G.parent.opener.item2textCss&&G.parent.opener.item2textCss(I)||"",J=G.parent.opener.itemName;return'<div class="mstrmojo-Pulldown-listItem"><div class="mstrmojo-text '+H+'" title="'+I[G.itemTitleField||G.itemField]+'">'+(J(I,F,G)||"&nbsp;")+"</div></div>";},renderOnScroll:false,bindings:{itemIdField:"this.parent.opener.itemIdField",itemField:"this.parent.opener.itemField",itemCSS:"this.parent.opener.itemCSS",itemTitleField:"this.parent.opener.itemTitleField",items:"this.parent.opener.items",selectionPolicy:"this.parent.opener.selectionPolicy",selectedIndex:"this.parent.opener.selectedIndex"},onmousedown:function(){this.parent.close();},onchange:function(){var H=this.parent,I=H.visible,F=H.opener,G=this.selectedItem;if(!F||!G||!I){return ;}F.set("value",G[this.itemIdField]);}}]}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.TextBox");var A=mstrmojo.css,C=mstrmojo.dom;mstrmojo.TextArea=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextArea",markupString:'<textarea id="{@id}" class="mstrmojo-TextArea {@cssClass}"  style="{@cssText}" title="{@tooltip}" placeholder="{@placeholderText}" rows="{@rows}" cols="{@cols}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keydown,keyup,blur></textarea>',maxLength:256,onkeydown:function B(K){var I=this.inputNode,J=this.value,E=this.maxLength,F=(J&&J.length)||0,M=K.e,L=M.keyCode;this.isDeleteKeys=L===8||L===46;this.isArrowKeys=L===37||L===38||L===39||L===40;if(E!==undefined&&E<=F){var G=I.selectionEnd,H=(G!==undefined)?(G-I.selectionStart)>0:document.selection.createRange().text.length>0;if(!this.isDeleteKeys&&!this.isArrowKeys&&!H){if(C.isIE7||C.isIE8||C.isIE9){I.blur();window.setTimeout(function(){I.focus();},1);}C.preventDefault(window,M);return false;}}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.TextArea,{oncssClassChange:function D(){A.addClass(this.domNode,this.cssClass||"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.warehouse.dbroles.DBRoleHelper");mstrmojo.requiresDescs(12937,12938);var G=mstrmojo.warehouse.dbroles.DBRoleHelper,F=mstrmojo.dom,K=mstrmojo.string;mstrmojo.warehouse.dbroles.DBRoleSetting=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",cssClass:"mstrmojo-wh-DBRoleSetting",postBuildRendering:function A(){if(this._super){this._super();}this.infobox.captionlbl.set("text",this.caption);var N=F.position(this.infobox.captionlbl.domNode).w,O=F.position(this.infobox.txt.domNode).w,P=F.position(this.infobox.domNode).w;if((N+O)>P){this.infobox.txt.domNode.style.width=(P-N-10)+"px";}},caption:"",text:"",infobox:undefined,captionlbl:undefined,ontextChange:function B(){this.infobox.txt.set("value",this.text);},isNumeric:false,isPassword:false,hiddenPwd:"",isRequired:false,enabled:true,field:undefined,parentRBAlias:"",focus:function M(){this.infobox.txt.focus();},getValue:function D(){return this.text;},setValue:function C(N){this.set("text",N);this.set("value",N);},onenabledChange:function H(){this.infobox.captionlbl.set("enabled",this.enabled);this.infobox.txt.set("enabled",this.enabled);},isValid:function L(){var N=K.trim(this.getValue()),O={val:true,msg:""};if(!this.enabled){return O;}if(!this.isRequired&&N===""){return O;}if(this.isRequired&&N===""){O.val=false;O.msg=mstrmojo.desc(12937,"Value for '##' cannot be empty").replace("##",this.caption);return O;}if(this.isNumeric&&!G.isNumeric(N)){O.val=false;O.msg=mstrmojo.desc(12938,"Only numeric values are allowed for '##'").replace("##",this.caption);return O;}return O;},children:[{scriptClass:"mstrmojo.Box",alias:"infobox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",alias:"captionlbl",text:"this.parent.caption"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-DBRoleSetting-Info",alias:"txt",preBuildRendering:function J(){var N=this.parent.parent;if(N.isPassword){this.set("type","password");this.set("autoComplete",(mstrApp.autocomplete==="1"));}},onEnter:function E(){var N=this.parent.parent;if(N.onEnter){N.onEnter(N.parent.parent);}},onvalueChange:function I(N){this.parent.parent.setValue(N.value);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextBox");mstrmojo.requiresDescs(7564);var F,I=mstrmojo.string,J=mstrmojo.desc(7564,"Select...");mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector",postBuildRendering:function A(){if(this._super){this._super();}this.infobox.captionlbl.set("text",this.caption);},caption:"",text:"",infobox:undefined,captionlbl:undefined,ontextChange:function B(){this.infobox.txt.set("value",this.text);},isRequired:false,enabled:true,field:undefined,selectorOption:0,parentRBAlias:"",focus:function M(){this.infobox.txt.focus();},getValue:function D(){return this.text;},setValue:function C(N){this.set("text",N);this.set("value",N);},onenabledChange:function G(){this.infobox.captionlbl.set("enabled",this.enabled);this.infobox.txt.set("enabled",this.enabled);},isValid:function L(){var N=I.trim(this.getValue()),O={val:true,msg:""};if(!this.enabled){return O;}if(!this.isRequired&&N===""){return O;}if(this.isRequired&&N===""){O.val=false;O.msg=mstrmojo.desc(12937,"Value for '##' cannot be empty").replace("##",this.caption);return O;}return O;},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-InfoBox",alias:"infobox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Label",alias:"captionlbl"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Info",alias:"txt",onEnter:function E(){var N=this.parent.parent;if(N.onEnter){N.onEnter(N.parent.parent);}},onvalueChange:function H(N){this.parent.parent.setValue(N.value);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Select",alias:"fileSelector",text:J,bindings:{visible:function(){var O=this.parent.parent.selectorOption,N=!!(mstrApp.isSingleTier),P=(navigator.platform.indexOf("Win")!==-1),Q=!P;if(((O&1)===1)&&!N){return true;}if(((O&2)===2)&&N&&P){return true;}if(((O&4)===4)&&N&&Q){return true;}return false;}},onclick:function K(){F=this.parent;mstrApp.rootController.launchOneTierAccessFileBrowser("mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector.oneTierFileSelector");}}]}]});mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector.oneTierFileSelector=function(N){F.txt.set("value",N);};}());(function(){mstrmojo.requiresCls("mstrmojo._HasLayout","mstrmojo.Box","mstrmojo.css","mstrmojo.HBox","mstrmojo.string","mstrmojo.TextBox");var H=mstrmojo.css,E=mstrmojo.dom,C=mstrmojo.desc(505,"Update"),D="clear";mstrmojo.warehouse.ui.SearchBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.ui.SearchBox",cssClass:"mstrmojo-wh-SearchBox",tableBox:undefined,inputBox:undefined,clearBtn:undefined,refreshBtn:undefined,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-wh-SearchBox-contents",alias:"tableBox",children:[{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-sb-input",alias:"inputBox",oldText:"",onkeydown:function G(){this.oldText=this.value;},onkeyup:function B(){var P=this,N=this.value,M=this.parent.clearBtn,Q=this._searchTimeoutId,O=this._hasText=N.length>0;if(this.oldText!==N){H.toggleClass(M.domNode,[D],O);window.clearTimeout(Q);this._searchTimeoutId=window.setTimeout(function(){P.parent.parent.triggerSearch();},this.searchDelay);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-sb-btn",alias:"clearBtn",onclick:function L(){var M=this.parent;if(M.inputBox._hasText){M.parent.clearSearch();}else{M.parent.triggerSearch();}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-sb-refresh",alias:"refreshBtn",visible:false,onclick:function L(){if(this.parent.parent._onRefresh){this.parent.parent._onRefresh();}},title:C,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var M=E.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",top:Math.max(M.y+40,0),left:Math.max(M.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});}}]}],title:"",tooltipOpenDelay:0,useRichTooltip:true,_preSearch:undefined,_onRefresh:undefined,searchDelay:-1,init:function K(N){this._super(N);var M=this.searchDelay;if(M===-1||isNaN(M)){this.searchDelay=parseInt(mstrApp.getSearchAutoCompleteDelay(),10);}},postBuildRendering:function A(){this._super();this.tableBox.inputBox.domNode.maxLength=248;this.tableBox.inputBox.value="";},clearSearch:function I(M){if(!this.hasRendered){return ;}this.tableBox.inputBox.set("value","");H.removeClass(this.tableBox.clearBtn.domNode,[D]);delete this.tableBox.inputBox._hasText;if(!M){this.triggerSearch();}},triggerSearch:function F(){var M=true;if(this._preSearch){M=this._preSearch();}if(M){this.raiseEvent({name:"searchTriggered",searchValue:mstrmojo.string.trim(this.tableBox.inputBox.value)});}},showTooltip:function J(R,Q){var P=this,N=E.findAncestorByAttr(E.eventTarget(Q,R),"tooltip",true,this.domNode),O=N&&N.value;if(!P.hasOpenTooltip&&O){var M=E.position(N.node);P.richTooltip={cssClass:"vi-regular vi-tooltip-A",content:O,top:Math.max(M.y+40,0),left:Math.max(M.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT};this._super(R,Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.DI.DIConstants","mstrmojo.qb.thirdParty.UrlSourceItem");mstrmojo.requiresDescs(11098,12850,13992);var H=mstrmojo.css,F=mstrmojo.array;mstrmojo.qb.thirdParty.SourceInput=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.thirdParty.SourceInput",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload mstrmojo-di-fu mstrmojo-qb-thirdParty-SourceInput {@cssClass}" style="{@cssText}" ><div></div><div class="url-input"></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},instructionNode:function(){return this.domNode.firstChild;},urlInputNode:function(){return this.domNode.children[1];},urlContainerNode:function(){return this.domNode.lastChild;}},children:[{slot:"instructionNode",scriptClass:"mstrmojo.Label",cssClass:"connection-info-label",text:mstrmojo.desc(13992,"Please select a connection first"),postCreate:function(){var L=mstrApp.getRootController().model;L.attachEventListener("SelDBRoleNameChange",this.id,"updateInstruction");},updateInstruction:function E(L){var M=L.value?L.value:mstrmojo.desc(13992,"Please select a connection first");this.set("text",M);this.parent.enableFooterBtn();}},{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",emptyText:mstrmojo.desc(12850,"Enter URL"),onvalueChange:function(L){var M=!L.value||L.value==="";this.parent.toggleAddBtnState(!M);this.parent.enableFooterBtn();}},{slot:"urlInputNode",alias:"addBtn",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",cssDisplay:"inline-block",text:mstrmojo.desc(531,"Add"),onclick:function(){this.parent.addURL();}},{slot:"urlContainerNode",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-thirdParty-url-holder",alias:"urlList",bindings:{visible:function(){return this.getSrcCnt()>0;}},addURL:function G(O){var N=mstrApp.getRootController();var L=mstrmojo.insert({scriptClass:"mstrmojo.qb.thirdParty.UrlSourceItem",url:O,dbRoleID:N.model.SelDBRoleID,dbRoleName:N.model.SelDBRoleName});var M=this.addChildren(L);M.render();if(!this.visible){this.set("visible",true);}},deleteURL:function I(L){this.removeChildren(L);if(this.getSrcCnt()===0){this.set("visible",false);}this.parent.enableFooterBtn();},getSrcCnt:function(){return this.children?this.children.length:0;},getSrcs:function(){var L=[];F.forEach(this.children,function(M){L.push({url:M.url,dbRoleID:M.dbRoleID});});return L;}}],addURL:function G(){var L=mstrApp.getRootController();var N=L.model;var M=this.urlInput.value;M=M.replace(/^\s+|\s+$/g,"");if(M.length===0){return ;}if(!N.isNew){this.urlList.removeChildren();}this.urlList.addURL(M);this.urlInput.set("value","");},enableFooterBtn:function A(){var L=mstrApp.getRootController();var O=L.model;var P=this.urlList.getSrcCnt();var M=this.urlInput.value;if(P===0){var N=M&&O.SelDBRoleID;L.enableButton(N);}else{if(!O.isNew&&P===1){L.enableButton(M.length<1);}}},getSrcs:function C(){this.addURL();return this.urlList.getSrcs();},removeSrcs:function B(O){var L=this.urlList;var M=L.children,N=[];F.forEach(O,function(P){F.forEach(M,function(Q){if(Q.url===P.url){N.push(Q);return false;}});});F.forEach(N,function(P){L.removeChildren(P);});},initURL:function J(){var L=mstrApp.getRootController().model.SQLstmt;if(L&&L.length>0){this.urlList.addURL(L);this.enableFooterBtn();}},postBuildRendering:function D(){if(this._super){this._super();}var L=mstrApp.getRootController().model;L.attachEventListener("reportDefLoaded",this.id,this.initURL);},toggleAddBtnState:function K(L){H[L?"addClass":"removeClass"](this.addBtn.domNode,["hot"]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.dom","mstrmojo.string","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(5,49,2918,3289,8042,9948,8042,13305,13306,13307,12187);var D=mstrmojo.array,E=mstrmojo.dom,F=mstrmojo.string;function C(){var G=[],H=mstrApp.diParams,J=(E.isIE8||E.isIE7)&&!(H.flashVI||H.smartVI),I=mstrmojo.DI.DIExitOptions.pageRedirect;if(H.CreateAnalysis===1){G.push({hot:true,icon:"newvi",n:mstrmojo.desc(8042,"Create Dashboard"),desc:mstrmojo.desc(9948,"Explore data visually and discover trends, patterns, relationships and outliers"),redirect:J?I.unsupportedBrowser:I.analysis});}if(H.CreateReportServices===1){G.push({icon:"newdoc",n:mstrmojo.desc(2918,"Create Document"),desc:mstrmojo.desc(13858,"Create an enterprise report, scorecard, or dashboard"),redirect:I.doc});}if(H.CreateViewReport===1&&mstrApp.getRootController().model.isDirectDataAccess===false){G.push({icon:"newreport",n:mstrmojo.desc(5,"Create Report"),desc:mstrmojo.desc(13859,"Create a grid or graph report"),redirect:I.report});}return G;}mstrmojo.DI.DIExitOptions=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIExitOptions",cssClass:"mstrmojo-di-DIExitOptions",redirectToPage:function B(G){var H=mstrmojo.DI.DIExitOptions;if(G===H.pageRedirect.unsupportedBrowser){mstrmojo.alert(mstrmojo.desc(12187,"Unsupported browser."));}else{mstrApp.redirectToPage(H.getRedirectParams(G,this.model.cubeID,this.model.isDirectDataAccess));}},onCancelButtonClick:function(){mstrApp.getRootController().exitApplication();return true;},preBuildRendering:function(){var I=[],H,J,G=["mstrmojo-di-button","mstrmojo-WebButton"];if(this._super){this._super();}H=C();G.push("cnt"+H.length);D.forEach(H,function(L,K){J=new mstrmojo.Button({cssClass:K===0?G.concat(["hot",L.icon]).join(" "):G.concat(L.icon).join(" "),text:L.n,useRichTooltip:true,updateTooltipConfig:function(){var N=this,M=E.position(N.domNode);N.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:L.desc,top:Math.max(M.y+40,0),left:Math.max(M.x+M.w/2,0),posType:mstrmojo.tooltip.POS_TOPCENTER};},redirect:L.redirect,onclick:function(){this.parent.redirectToPage(this.redirect);}});I.push(J);});this.addChildren(I);},children:[{scriptClass:"mstrmojo.Label",cssClass:"title-one",useRichTooltip:true,allowHTML:true,updateTooltipConfig:function(){var G;if(this.title){G=E.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(G.y,0),left:Math.max(G.x+G.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});}},ontextChange:function(){var H=this;var G=function(){var O=H.parent.model.isDirectDataAccess?mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###."):mstrmojo.desc(13305,"Success! Your data was imported as ###."),K=H.domNode,Q=H.parent.model.path,J=H.parent.model.cubeName,P,M,N,L,I;if(!K){return ;}P=K.scrollWidth>K.clientWidth;M=Q;L=I=Q.indexOf(J);while(P&&(L>=0||I<=Q.length)){if(L>0){L--;}else{I++;}N=L>0?[Q.substr(0,L)]:[];N.push("...");if(I<Q.length){N.push(Q.substr(I));}M=O.replace("###","<b>"+F.encodeHtmlString(N.join(""),true,true)+"</b>");K.innerHTML=M;P=K.scrollWidth>K.clientWidth;}};if(H.domNode){G();}else{window.setTimeout(G,0);}},preBuildRendering:function(){var H=mstrmojo.desc(13305,"Success! Your data was imported as ###."),G;if(this.parent.model.isDirectDataAccess){H=mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###.");}G=H.replace("###","<b>"+F.encodeHtmlString(this.parent.model.path,true,true)+"</b>");this.set("text",G);this.set("title",G);}},{scriptClass:"mstrmojo.Label",cssClass:"title-two",text:mstrmojo.desc(13307,"What would you like to do now?")}]});mstrmojo.DI.DIExitOptions.pageRedirect={exit:0,report:1,doc:2,analysis:3,flashVI:4,historyList:5,existingAnalysis:6,unsupportedBrowser:7};mstrmojo.DI.DIExitOptions.getRedirectParams=function A(M,J,I,H){var L={},K=mstrmojo.DI.DIExitOptions.pageRedirect,G=mstrApp.name||microstrategy.servletName;switch(M){case K.analysis:if(mstrApp.diParams.flashVI){L={evt:"3104",src:G+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:"16",rwViewMode:"2048"};}else{L={evt:"3185",src:mstrApp.name+".3185",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:64};if(I){L.rwCreateFlags|=128;}if(mstrApp.cubeSaveFolderId){L.saveFolderId=mstrApp.cubeSaveFolderId;}}break;case K.doc:L={evt:"3104",src:mstrApp.name+".3104",executionMode:"2",rwDesignMode:"1",objectType:"3",objectID:J,rwCreateFlags:0};if(I){L.rwCreateFlags|=128;}if(mstrApp.cubeSaveFolderId){L.saveFolderId=mstrApp.cubeSaveFolderId;}break;case K.flashVI:L={evt:"3104",src:G+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:16,rwViewMode:"2048"};if(I){L.rwCreateFlags|=128;}break;case K.report:L={iframe:"true",evt:["5005","17004"],src:[mstrApp.name+".create.5005",mstrApp.name+".create.ObjectExplorer.17004"],selectedObjectID:J,defaultevtlist:"17004"};break;case K.exit:L={evt:"3010"};break;case K.historyList:L={evt:"3018",src:G+".3018"};break;case K.existingAnalysis:L={evt:"3140",src:G+".3140",documentID:H};break;}return L;};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.func","mstrmojo.array","mstrmojo.Button","mstrmojo.HBox","mstrmojo.dom","mstrmojo.Box");var D=mstrmojo.dom;mstrmojo.Dialog=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Dialog",title:"",buttons:null,alignment:"center",btnAlignment:"right",zIndex:10,modal:true,markupString:'<div id="{@id}" class="mstrmojo-Dialog {@cssClass}" style="z-index: 1100;" tabindex="0" mstrAttach:click><div class="win mstrmojo-Editor" style="{@cssText}"><div class="mstrmojo-Editor-titlebar"><div class="mstrmojo-Editor-title">{@title}</div></div><div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div><div class="mstrmojo-Editor-tip"></div></div>',markupSlots:{editorNode:function(){return this.domNode.firstChild;},curtainNode:function(){return this.domNode.childNodes[1];},titleNode:function(){return this.domNode.firstChild.firstChild;},containerNode:function(){return this.domNode.firstChild.childNodes[1];},buttonNode:function(){return this.domNode.firstChild.lastChild;},tipNode:function(){return this.domNode.lastChild;}},editorNode:null,btnHbox:null,markupMethods:{onzIndexChange:function(){this.editorNode.style.zIndex=this.zIndex;this.curtainNode.style.zIndex=this.zIndex-1;},onwidthChange:function(){this.editorNode.style.width=this.width||"auto";},onvisibleChange:function(L){if(L){return ;}var J=this.visible,K=J?"block":"none";this.editorNode.style.display=K;if(this.modal){this.curtainNode.style.display=K;}},onleftChange:function(){this.editorNode.style.left=this.left||"";},ontopChange:function(){this.editorNode.style.top=this.top||"";},ontitleChange:function(){this.titleNode.firstChild.innerHTML=this.title||"";}},preBuildRendering:function F(){var J;var K=this.buttons;if(K&&!this.btnHbox){for(J in K){K[J].cssClass=(K[J].cssClass||"")+(this.noButtonCls?"":" mstrmojo-Editor-button");}this.addChildren([{scriptClass:"mstrmojo.HBox",cssText:"float:"+this.btnAlignment,slot:"buttonNode",alias:"btnHbox",children:K},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-clearMe",slot:"buttonNode"}]);}if(this.modal){this.cssClass+=" modal";}return this._super();},buildRendering:function B(){var J=this.placeholder;if(this._super()){if(!this.parent&&!J){document.body.appendChild(this.domNode);}return true;}return false;},getResizeHandler:function E(){var J=this.id;return function(){var K=mstrmojo.all[J];K.resizeDialog();K.positionDialog();};},postBuildRendering:function A(){this._super();if(this.modal&&this.visible){this.curtainNode.style.display="block";}if(!this._resizeHandler){var K=this._resizeHandler=this.getResizeHandler();D.attachEvent(window,"resize",K);}this.resizeDialog();this.positionDialog();try{this.domNode.focus();}catch(J){}return true;},resizeDialog:function G(){if(this.modal){this.resizeCurtain();}},resizeCurtain:function C(){var K=this,O=K.curtainNode,J=document.body,M=document.documentElement,N=O.style,L=K.curtainPosition;N.width=Math.max(J.clientWidth,M.scrollWidth)+"px";if(L&&L.h){N.height=L.h+"px";}else{N.height=Math.max(J.clientHeight,M.scrollHeight)+"px";}if(L&&L.y){N.top=L.y+"px";}K.raiseEvent({name:"resizeCurtain"});},positionDialog:function H(){var K=this.editorNode,M=this.left,L=this.top;if(!M||!L){D.center(K);var J=K.style;if(this.alignment==="top"){J.top="10px";}if(M){J.left=M;}if(L){J.top=L;}}},destroy:function(K){var J=this._resizeHandler;if(J){D.detachEvent(window,"resize",J);}this._super(K);}});mstrmojo.toast=function I(O,M,Q,J){var P="mojoToast9",N,L=M||3000;if(J&&J.id){P=J.id+"-"+P;}try{mstrmojo.all[P].destroy();}catch(K){}mstrmojo.insert({id:P,scriptClass:"mstrmojo.Label",cssClass:(J&&J.cssClass)?J.cssClass:"toastCss",text:O}).render();N=mstrmojo.all[P].domNode;if(J&&J.dom){J.dom.appendChild(N);}else{document.body.appendChild(N);D.bottomCenter(N);}window.setTimeout(function(){if(Q){Q();}try{mstrmojo.all[P].destroy();}catch(R){}},L);};mstrmojo.mask={show:function(){var J=mstrmojo.mask.win=mstrmojo.insert({scriptClass:"mstrmojo.Box",cssClass:"fullscreen-mask"});J.render();document.body.appendChild(J.domNode);},hide:function(){mstrmojo.mask.win.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.es.TableList","mstrmojo.Label");mstrmojo.requiresDescs(12930,2121);var I="addTable";mstrmojo.qb.es.TableDropbox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.es.TableDropbox",markupString:'<div id="{@id}" class="mstrmojo-qb-EmmaTableDropbox {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-emma-container" style="margin-left: 12px"><div class="mstrmojo-qb-emma-EmptyHint">{@emptyHint}</div><div class="mstrmojo-qb-emma-TableCount"></div><div class="mstrmojo-qb-emma-content"></div></div></div>',markupSlots:{hintNode:function F(){return this.domNode.firstChild.firstChild;},countNode:function E(){return this.domNode.firstChild.children[1];},containerNode:function B(){return this.domNode.firstChild.lastChild;},panelNode:function N(){return this.domNode.firstChild;}},emptyHint:mstrmojo.desc(13246,"Drag and Drop table(s) from any database connections"),children:[{scriptClass:"mstrmojo.Label",alias:"tableCount",slot:"countNode",visible:false,postCreate:function J(){if(this._super){this._super();}var Q={},P=Q[this.id]={},O=mstrmojo.desc(2121,"Total");P.refreshTables=function(R){var S=R.items.length;this.set("visible",S>1);if(S>1){this.set("text",O+": "+S);}};mstrApp.getRootController().attachDataChangeListeners(Q);}},{scriptClass:"mstrmojo.qb.es.TableList",alias:"tableList"}],init:function L(P){this._super(P);var Q={},O=Q[this.id]={};O.refreshTables=this.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(Q);},onTableRefresh:function M(O){var P=O.items.length>0;mstrmojo.css.toggleClass(this.hintNode,["off"],P);mstrmojo.css.toggleClass(this.panelNode,["active"],P);},dropZone:true,allowDrop:function D(O){return I===O.action;},ondrop:function H(O){var P=O.action,R=O.src;if(R&&R.data){var Q=R.data;if(P===I){mstrApp.getRootController().addTable(Q);}}mstrmojo.css.removeClass(this.panelNode,"dragging");},getAvatarIconClass:function C(){return"enabled";},ondragenter:function G(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),true);}mstrmojo.css.addClass(this.panelNode,"dragging");},ondragleave:function K(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),false);}mstrmojo.css.removeClass(this.panelNode,"dragging");},onwidthChange:function A(O){var P=parseInt(O.value,10);if(isNaN(P)){return ;}P=P-140;P=(P<=0)?"20px":P+"px";this.tableList.set("itemMaxWidth",P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box");var B=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox",cssClass:"mstrmojo-wh-DBRoleSettingGroupBox",groupbox:undefined,isRequired:false,isGroupSetting:true,enabled:true,onenabledChange:function E(){var F=this.enabled;B.forEach(this.children,function(G){G.set("enabled",F);});},getValue:function A(){return"";},setValue:function D(F){},isValid:function C(){return{val:true,msg:""};},children:[{scriptClass:"mstrmojo.Box",alias:"groupbox",children:[]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.css");var A=mstrmojo.css;var I=mstrmojo.dom;function B(K){var M=document.createElement("div"),L=M.style,J=K.domNode;M.className="mstrmojo-qb-VSplitPanel-avatar";L.width=J.clientWidth+"px";J.appendChild(M);K.avatar=M;return M;}mstrmojo.qb.VSplitPanel=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.VSplitPanel",draggable:true,dropZone:false,width:0,topP:40,topItemVisible:true,bottomItemVisible:true,borderoffset:0,marginSpan:20,minSpan:80,markupString:'<div id="{@id}" class="mstrmojo-VSplitPanel {@cssClass}" style="{@cssText}" mstrAttach:mouseup,mousemove ><div></div><div style="padding-top:{@marginSpan}px;"><div class="mstrmojo-qb-VSplitPanel-resizeHandle" style="width:{@width};height:{@marginSpan}px;margin-top:-{@marginSpan}px"></div></div></div>',markupSlots:{topItem:function(){return this.domNode.children[0];},bottomItem:function(){return this.domNode.children[1];}},children:[{scripClass:"mstrmojo.Box",slot:"topItem"},{scripClass:"mstrmojo.Box",slot:"bottomItem"}],getDragData:function H(J){var K=J.src,M=K.node;if(M.className&&M.className.indexOf("mstrmojo-qb-VSplitPanel-resizeHandle")>=0){var L=I.position(this.domNode);return{node:M,x:L.x,y:L.y,h:L.h,w:L.w};}else{if(this._super){return this.dropZone&&this._super(J);}}return null;},allowDrop:function E(J){var K=J.src,L=K&&K.data;if(L&&L.node){return true;}else{return this.dropZone;}},ondragmove:function F(J){var L=J.src,N=L&&L.data;if(N&&N.node){var K=J.tgt,M=this.avatar;if(M){M.style.top=Math.min(Math.max(N.y+this.minSpan,K.pos.y),N.y+N.h-this.minSpan)+"px";}}},isDragValid:function G(J){var K=J.src,L=K&&K.data;return !!(L&&L.node);},ondragstart:function C(J){var K=J.src,M=K&&K.data;var L=this.avatar||B(this);this.ownAvatar=true;L.style.top=Math.max(M.y,K.pos.y)+"px";L.style.left=M.x+"px";L.style.display="block";L.style.zIndex="9999";L.style.width=M.w+"px";},ondragend:function D(J){var M=J.src,O=M&&M.data;if(O&&O.node){var N=this.avatar;if(N){N.style.display="none";var K=parseInt(N.style.top)-O.y,L=this.domNode.clientHeight;this.topP=K*100/L;this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};this.doLayout();}this.ownAvatar=false;}else{if(this._super){this._super(J);}}},layoutConfig:{w:{topItem:"100%",bottomItem:"100%"},h:{topItem:"40%",bottomItem:"60%"}},afterLayout:function(){if(this.domNode){var K=this.domNode.children[1].children[0].style;if(this.topItemVisible&&this.bottomItemVisible){K.display="block";this.children[0].set("visible",true);this.children[1].set("visible",true);K.width=this.width;var J=parseInt(this.children[0].height);this.children[0].set("height",J+"px");this.bottomItem.style.height=parseInt(this.height)-J-this.marginSpan+"px";this.children[1].set("height",this.bottomItem.style.height);}else{K.display="none";if(this.topItemVisible){this.children[0].set("width",this.width);this.children[1].set("visible",false);}else{this.children[1].set("width",this.width);this.children[0].set("visible",false);}}}},_set_topItemVisible:function(L,J){if(this.topItemVisible!=J){this.topItemVisible=J;if(J){this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};if(this.bottomItem){var K=this.bottomItem;K.style["padding-top"]=this.marginSpan+"px";}}else{this.layoutConfig.h={topItem:"0%",bottomItem:"100%"};if(this.bottomItem){var K=this.bottomItem.parentNode;K.style["padding-top"]="0px";}}this.doLayout();}},_set_bottomItemVisible:function(K,J){if(this.bottomItemVisible!=J){this.bottomItemVisible=J;if(J){this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};}else{this.layoutConfig.h={topItem:"100%",bottomItem:"0%"};}this.doLayout();}},postBuildRendering:function(){if(this._super){this._super();}this.width=this.domNode.clientWidth+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.css","mstrmojo.Button");mstrmojo.requiresDescs(1143,8338,9111,9113);var M=mstrmojo.css,G=mstrmojo.dom,I=mstrmojo.array,F="mstrmojo-qb-toolbarIcon",N="on",J="connectionview",C="viewtable",B="conditionview",L="refreshOption",O="help",E=" ";function K(R){return mstrmojo.hash.copy(R,{scriptClass:"mstrmojo.Button",onactiveChange:function Q(){M.toggleClass(this.domNode,N,this.active);},onclick:function P(){this.set("active",!this.active);if(this.cmd){mstrApp.getRootController()[this.cmd](this.active);}if(!this.persistSelection){var S=this;window.setTimeout(function(){S.set("active",false);},100);}}});}function A(R){var Q="mstr-qb-oAuthSourcelogout",P=document.getElementById(Q);if(!P){P=document.createElement("IFRAME");P.id=Q;document.body.appendChild(P);P.style.display="none";G.attachEvent(P,"load",function(S){var U={};var V={success:function T(W){mstrApp.getRootController().handleLogout();}};U.dbRoleID=mstrApp.dbrid;if(mstrApp.said){U.sourceAccountID=mstrApp.said;}mstrApp.getRootController().getDataService().signOutOAuthSource(V,U);});}P.src=R;}function D(){var R={scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-toolbar-bigquery",bindings:{visible:function(){return mstrApp.said&&mstrApp.dbrid;}},children:[{scriptClass:"mstrmojo.Label",postCreate:function Q(){if(this._super){this._super();}var S=mstrApp.userName;if(mstrApp.userEmail){S+=" ("+mstrApp.userEmail+")";}this.set("text",S);this.set("title",S);},cssClass:"mstrmojo-qb-toolbar-bigquery-username"},{scriptClass:"mstrmojo.Label",text:"|",cssClass:"splitText"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(8338,"sign out"),cssClass:"mstrmojo-qb-toolbar-bigquery-signout",onclick:function P(){A("https://www.google.com/accounts/logout");}}]};return R;}function H(){var Q=[{cmd:"toggleDatabaseView",active:true,iconClass:[F,J,N].join(E),title:mstrmojo.desc(9111,"Database View"),persistSelection:true},{cmd:"toggleDataPreview",active:false,iconClass:[F,C].join(E),title:mstrmojo.desc(9113,"Data Preview"),persistSelection:true,postBuildRendering:function P(){var R=mstrApp.getRootController(),S=this.id;R.attachEventListener("dataPreview",S,function(){this.set("active",true);});R.attachEventListener("reportModeChange",S,function(T){this.set("active",T.showPreview);});}},{cmd:"openHelp",iconClass:[F,O].join(E),title:mstrmojo.desc(1143,"help")}];I.forEach(Q,function(S,R,T){T[R]=K(S);});Q.push(D());return Q;}mstrmojo.qb.Toolbar=mstrmojo.declare(mstrmojo.Box,null,{children:H()});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.mdx.CubeList");mstrmojo.requiresDescs(12931,14545);var B="addCube";mstrmojo.qb.mdx.CubeDropbox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.mdx.CubeDropbox",markupString:'<div id="{@id}" class="mstrmojo-qb-MDXCubeDropbox {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-emma-container" style="margin-left: 12px"><div class="mstrmojo-qb-emma-EmptyHint">{@emptyHint}</div><div class="mstrmojo-qb-emma-content"></div></div></div>',markupSlots:{hintNode:function G(){return this.domNode.firstChild.firstChild;},containerNode:function C(){return this.domNode.firstChild.lastChild;},panelNode:function N(){return this.domNode.firstChild;},outerContainerNode:function A(){return this.domNode;}},emptyHint:mstrmojo.desc(13246,"Drag and Drop table(s) from any database connections"),children:[{scriptClass:"mstrmojo.qb.mdx.CubeList"},{scriptClass:"mstrmojo.CheckBox",slot:"outerContainerNode",label:mstrmojo.desc(14545,"Import as Recursive Attribute"),alias:"recursive",oncheckedChange:function D(){mstrApp.getRootController().setRecursive(this.checked?1:0);},postCreate:function J(){if(this._super){this._super();}var Q=this,P={},O=P[this.id]={};O.recursiveChange=function(R){Q.set("checked",R.value?true:false);};mstrApp.getRootController().attachDataChangeListeners(P);this.enabled=!mstrApp.tableID;}}],init:function M(P){this._super(P);var Q={},O=Q[this.id]={};O.refreshTables=this.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(Q);},onTableRefresh:function L(O){var P=O.items.length>0;mstrmojo.css.toggleClass(this.hintNode,["off"],P);mstrmojo.css.toggleClass(this.panelNode,["active"],P);},dropZone:true,allowDrop:function F(O){return B===O.action;},ondrop:function I(O){var P=O.action,R=O.src,Q;if(R&&R.data){Q=R.data;if(P===B){mstrApp.getRootController().addCubes([Q]);}}mstrmojo.css.removeClass(this.panelNode,"dragging");},getAvatarIconClass:function E(){return"enabled";},ondragenter:function H(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),true);}mstrmojo.css.addClass(this.panelNode,"dragging");},ondragleave:function K(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),false);}mstrmojo.css.removeClass(this.panelNode,"dragging");}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Box","mstrmojo.ui._HasScroller","mstrmojo.ME.Enum");mstrmojo.requiresDescs();var M=mstrmojo.dom,B=mstrmojo.string,D=mstrmojo.Widget;var H=/\r?\n?----\r?\n?/;function F(N){var O=B.decodeHtmlString((N||{}).desc||"",true).split(H);return{desc:O[0],example:O.length===2?O[1]:""};}mstrmojo.ME.FunctionInfo=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionInfo",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="mstrmojo-FunctionInfo-container"><div class="mstrmojo-FunctionInfo-syntax"></div><div class="mstrmojo-FunctionInfo-desc"></div><div class="mstrmojo-FunctionInfo-eg"><span class="icon" t="icon"></span><span class="text"></span></div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},syntaxNode:function(){return this.domNode.firstChild.firstChild;},descNode:function(){return this.domNode.firstChild.childNodes[1];},egNode:function(){return this.domNode.firstChild.lastChild;},egTextNode:function(){return this.domNode.firstChild.lastChild.lastChild;}},markupMethods:{onvisibleChange:D.visibleMarkupMethod,onfoiChange:function(){this.syntaxNode.innerHTML=B.htmlAngles(this.syntax)||"";this.descNode.innerHTML=this.desc;this.egTextNode.innerHTML=this.example;this.egNode.style.display=this.example?"block":"none";this.updateScrollbars();}},foi:{},syntax:"",desc:"",example:"",init:function L(N){this._super(N);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-FunctionInfo");},setupScrollNodes:function C(){if(!mstrmojo.dom.ISIE8){this.scrollNode=this.containerNode;}},onfoiChange:function A(){this.set("syntax",this.getFunctionSyntax());this.set("desc",this.getDesc()+" "+this.getHelpTopic());this.set("example",this.getExample());},getFunctionSyntax:function K(R){var T=R||this.foi;if(!T){return"";}if(T.did<0){return T.n;}var Q=T.pars,S=T.pros,O=[],P,N;O.push(T.n);S=mstrmojo.hash.clone(S)||[];if(T.ios){S.push({n:"SortBy"});}if(T.sqt===5){S.push({n:"BreakBy"});}if(this.showFullSyntax){if(S.length>0){O.push("<");for(P=0,N=S.length;P<N;P++){if(mstrmojo.array.indexOf(mstrmojo.ME.Enum.NonExposableParams,S[P].n)===-1){O.push(S[P].n);O.push(", ");}}O.pop();O.push(">");}}O.push("(");for(P=0,N=Q.length;P<N;P++){O.push(Q[P].n);if(P!==(N-1)){O.push(", ");}}O.push(")");return O.join("");},getDesc:function E(){return F(this.foi).desc;},getExample:function J(){return F(this.foi).example;},getHelpTopic:function G(N){var O=N||this.foi;if(!O||O.did===mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(O.h);},useRichTooltip:true,showTooltip:function I(N,Q){var P=M.eventTarget(Q,N),O=this.foi;if(P&&P.getAttribute("t")==="icon"){this.richTooltip=this.getTooltip(O,P);if(this.richTooltip){this._super(N,Q);}}},getTooltip:function(Q,R){var O=M.position(R),P=R.egTip||"";var N={areaId:Q._renderIdx+"text",cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:P,top:O.y-75,left:O.x+O.w-30,enableHover:false};return N;}});mstrmojo.ME.FunctionInfo.getDescAndExample=F;}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HBox","mstrmojo.CheckBox");mstrmojo.requiresDescs(1143);var E=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",cssClass:"mstrmojo-wh-DBRoleCheckBox",postBuildRendering:function A(){if(this._super){this._super();}this.checkbox.set("label",this.label);this.helpBtn.set("visible",!!(this.helpLink));},children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",oncheckedChange:function C(){if(this._super){this._super();}this.parent.checked=this.checked;this.parent.oncheckedChange();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-wh-DBRoleCheckBox-help",alias:"helpBtn",visible:false,title:mstrmojo.desc(1143,"help"),onclick:function I(){E.showHelp(this.parent.helpLink);}}],checkbox:undefined,helpBtn:undefined,onlabelChange:function G(){this.checkbox.set("label",this.label);},helpLink:undefined,enabled:true,onenabledChange:function F(){this.checkbox.set("enabled",this.enabled);},isNumeric:false,getValue:function D(){if(this.isNumeric){return(this.checkbox.checked?"1":"0");}return(this.checkbox.checked?"true":"false");},setValue:function B(J){this.checkbox.set("checked",((J==="true")||(J===true)||(J==="1")));},isValid:function H(){return{val:true,msg:""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo._HasBuilder");mstrmojo.ToolBar=mstrmojo.declare(mstrmojo.HBox,[mstrmojo._HasBuilder],{scriptClass:"mstrmojo.ToolBar",cellCssClass:"mstrmojo-ToolBar-cell",markupString:'<table id="{@id}" class="mstrmojo-ToolBar {@cssClass}" style="{@cssText}" cellspacing="0" cellpadding="0"><tr><td class="mstrmojo-ToolBar-outercell"><table class="mstrmojo-ToolBar-innertable" cellspacing="0" cellpadding="0"><tr>{@tableHtml}</tr></table></td></tr></table>',markupSlots:{containerNode:function(){return this.domNode.rows[0].cells[0].firstChild.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildChildren:function A(){var B=this.buildConfig;if(!B){this.buildConfig={};B=this.buildConfig;}B.target=this.target;return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.DropDownButton","mstrmojo.Label","mstrmojo.WaitIcon");mstrmojo.IncFetch=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.IncFetch",markupString:'<div id="{@id}" class="mstrmojo-IncFetch {@cssClass}" style="{@cssText}"><div class="mstrmojo-IncFetch-content"></div><div class="mstrmojo-clearMe"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},preBuildRendering:function A(){var J=[],F=this.ds,M=this.cp,P=this.np,C=this.ps,E=this.id,G=2;var L=function(){mstrmojo.all[E].set("cp",this.text);};var H={f:1,p:Math.max(M-1,1),n:Math.min(M+1,P),l:P};for(var O in H){J.push(new mstrmojo.Button({iconClass:"arrow "+O,title:F[O],enabled:(H[O]!==M),text:H[O],onclick:L}));}var D=Math.max(Math.min(M-2,P-4),1),I=Math.min(D+4,P);for(var K=D;K<=I;K++){var N;if(K===M){if(I-D===4&&P!==5){N=new mstrmojo.DropDownButton({height:"13px",title:F.a?F.a:"",text:K,direction:"up",popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",contentNodeCssClass:"goto",autoCloses:false,locksHover:true,children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.Label",cssText:"float:left;",text:F.gt},{scriptClass:"mstrmojo.TextBox",cssText:"float:left;",size:3,maxLength:String(P).length,onEnter:function(){var R=this.inputNode.value,T=this.parent.parent;if(R===""){T.close();return ;}var Q=parseInt(R,10),S=!(isNaN(Q)||Q<1||Q>P);if(S){mstrmojo.all[E].set("cp",Q);T.close();}else{this.setInvalidState(F.v.replace("###",P).replace("##",1).replace(" #",""));}}},{scriptClass:"mstrmojo.Button",cssText:"float:left",iconClass:"apply",title:F.ap?F.ap:"",onclick:function(){this.parent.children[1].onEnter();}}]}],onOpen:function(){mstrmojo.css.addClass(this.parent.domNode,["open"]);var Q=this.children[0].children[1].inputNode;window.setTimeout(function(){Q.focus();},0);},onClose:function(){mstrmojo.css.removeClass(this.parent.domNode,["open"]);this.children[0].children[1].cleanUp();}}});}else{N=new mstrmojo.Button({iconClass:"pg on",text:K});}}else{N=new mstrmojo.Button({iconClass:"pg",text:K,onclick:L});}J.splice(G++,0,N);}J.splice(G++,0,new mstrmojo.Label({text:F.pgs.replace("###",P).replace("##",""),cssText:"float:left;margin:1px 1px 1px 3px;"}));this._iWait=new mstrmojo.WaitIcon({cssText:"margin-top:-2px;"});J.push(this._iWait);this.addChildren(J);return this._super?this._super():true;},_set_cp:function B(D,C){if(parseInt(C,10)!==this.cp){this.raiseEvent({name:"fetch",v:C,iWait:this._iWait});}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller");mstrmojo.ui.ScrollableList=mstrmojo.declare(mstrmojo.ui.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableList",markupString:'<div id="{@id}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function C(){return this.domNode.firstChild.firstChild;},scrollboxNode:function D(){return this.domNode.firstChild;},scrollNode:function E(){return this.domNode.firstChild;}},postBuildRendering:function B(){if(this.renderOnScroll){if(!this.onScrollEnd){var G=this.id;this.onScrollEnd=function F(){var H=mstrmojo.all[G];H.doScroll();H.updateScrollbars();};}}if(this._super){this._super();}},renderBlockSize:150,renderIndex:0,onScrollEnd:undefined,doScroll:function A(){if(this.renderOnScroll){var G,H=this.scrollNode,F=(this.renderIndex+1)*this.renderBlockSize;if(F>=this.items.length){return ;}if(mstrmojo.dom.position(H).h===H.scrollHeight){G=this.domNode;}else{G=H;}if((mstrmojo.dom.position(G).h+G.scrollTop)>=G.scrollHeight){this.renderIndex++;var I=this._buildItemsMarkup(this.renderIndex*this.renderBlockSize,((this.renderIndex+1)*this.renderBlockSize)-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");G.innerHTML+=I;this.itemsContainerNode.innerHTML+=I;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.SuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var C=function(S,U,T){var R=S.parent.opener,J=R&&R.showDesc,Q=R&&R.showPath,I=U[S.itemField];var P=mstrmojo.string.escape4HTMLText,V="";if(Q){var M=U.anc&&U.anc.items,O=M&&M.length;if(O>0){for(var L=0;L<O-1;L++){V+=M[L].n+" > ";}V+=P(M[O-1].n);}else{if(U.path){V+=U.path;}}}if(!T){V+=(V.length===0?"":" > ")+P(I);}if(J){var N=U[S.itemDescField],K=120;if(N){V+="\r\n\r\n<br>"+P(N.substring(0,K)+(N.length>K?"...":""));}}return V;};var A=function(I,J,K){I.path=null;if(!J||!K||K.path){if(K&&K.path){I.set("path",K.path);}return ;}window.clearTimeout(this.pathTmr);this.pathTmr=window.setTimeout(function(){var L=J.path||J.getAttribute("path");if(L){I.set("path",K.path);return ;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(M){var N=H(M.toString())||"";K.path=N;I.set("path",N);}},{taskId:"getObjectDetails",objectID:K.did,objectType:K.t},undefined);},200);};var H=function(K){var N;if(window.DOMParser){N=(new DOMParser()).parseFromString(K,"text/xml");}else{N=new ActiveXObject("Microsoft.XMLDOM");N.async="false";N.loadXML(K);}var P=N.getElementsByTagName("path")[0],L=P.childNodes,O="";if(L){for(var J=0,I=L.length;J<I;J++){var M=L[J].childNodes&&L[J].childNodes[0];if(M){O+=mstrmojo.string.escape4HTMLText(M.nodeValue)+(J<I-1?"> ":"");}}}return O;};mstrmojo.LegacySuggestionList=mstrmojo.declare(mstrmojo.SuggestionList,null,{scriptClass:"mstrmojo.LegacySuggestionList",useRichTooltip:false,itemDescField:"desc",getItemMarkup:function(K,I){var J=this.parent.opener,L=this.useRichTooltip?"":this.buildTooltip(K);return'<div class="mstrmojo-suggest-text '+((J&&J.item2textCss(K))||"")+'" idx="'+I+'" title="'+L+'">'+J.getHighlightedText(J.getSearchPattern(),mstrmojo.string.escape4HTMLText(K[this.itemField]))+"</div>";},getItemProps:function E(){return{};},onmouseover:function(J){var M=this.parent.opener;if(M&&M.showPath){var K=mstrmojo.dom.eventTarget(J.hWin,J.e),I=K.getAttribute("idx"),L=I!=null?this.items[I]:null;if(L&&L.t>-1){this.targetEl=K;this.targetItem=L;this.requestPath(K,L);}}},requestPath:function D(I,K){var J=this.parent.opener;if(K.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function&&J.showFunctionSyntaxAsPath){this.buildFunctionSyntax(K);}else{A(this,I,K);}},buildFunctionSyntax:function G(J){var K=J.path;if(!K&&J.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){var I=function I(P){if(P.did<0){return P.n;}var O=P.pars,M=[],N,L;M.push(P.n);if(O){M.push("(");for(N=0,L=O.length;N<L;N++){M.push(O[N].n);if(N!==(L-1)){M.push(", ");}}M.push(")");}return M.join("");};J.path=I(J);}this.set("path",{path:J.path,excludeSelf:true});},buildTooltip:function B(I,J){return C(this,I,J);},onpathChange:function F(){var I=this.targetEl;I.path=1;var J=this.buildTooltip(this.targetItem,this.path.excludeSelf);if(this.useRichTooltip){this.useRichTooltip=true;this.hasOpenTooltip=false;if(!I.ttp){I.ttp=J;this.showTooltip();}}else{I.title=J;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.hash","mstrmojo.string");mstrmojo.requiresDescs(11038,11935,11936,11937,11856,11938,13138,13230,13260,14633,14636);var C=mstrmojo.hash.copy,P=mstrmojo.css,J=mstrmojo.dom,N=mstrmojo.array,E=mstrmojo.string,Q=function Q(V,T){if(!V){return ;}var S=T&&T.length||0,U;for(U=S;U>0;U--){V=V.replace(new Array(U+2).join("#"),T[U-1]);}return V;},L=function L(T){if(!T){return ;}var Z=this,V=J.position(T.refNode||Z.refNode),Y=J.position(Z.domNode),X=T.position||R.RIGHT,U=0,a=0,S=9+(T.margin!==undefined?T.margin:0),W=" ";switch(X){case R.TOP:a=-Y.h-S;W+="t";break;case R.BOTTOM:a=V.h+S;W+="b";break;case R.LEFT:U=-Y.w-S;W+="l";break;case R.RIGHT:U=V.w+S;W+="r";break;}mstrmojo.hash.forEach(C(T,{left:U,top:a,contentNodeCssClass:W,visible:false}),function(b,c){this[c]=b;},this);this.set("visible",T.invalid);},A=function A(S){var W=this,U,V=S.errorCode,X=S.errorMsg,T=S.args,Y=mstrmojo.vi.ui.rw.selectors.EnumWarningMessages;if(S.invalid){U={content:V!==null?(W.generateContentHTML(Q(Y[V],T))||Y["*"]):X};}return U;};mstrmojo.vi.ui.rw.selectors.EnumWarningMessages=C(mstrmojo.locales.validation,{"*":mstrmojo.desc(11038,"Invalid"),invalidValueVIWarning:mstrmojo.desc(11935,"Invalid characters"),emptyValueVIWarning:mstrmojo.desc(11936,"Please enter a number"),notIntegerVIWarning:mstrmojo.desc(11937,"Please enter an integer"),outOfRangeVIWarning:mstrmojo.desc(11856,"Please enter value between ## and ###."),noMultiSelectionVIWaring:mstrmojo.desc(11938,"This selector does not support multiple selections."),continuousSelectionVIWaring:mstrmojo.desc(13138,"This selector does not support non-continuous selections."),bigDecimalMetricSliderVIWaring:mstrmojo.desc(13230,"Cannot qualify on big decimal value. Please change qualification type to Rank"),unableDisplaySelectionVIWarning:mstrmojo.desc(13260,"Filter cannot display actual selections."),imageSizeExceedLimitVIWarning:mstrmojo.desc(14633,"Cannot embed an image larger than ##MB. Your image is still ###MB after compression. Enter a URL to the image instead."),imageFileTypeNotSupportedVIWarning:mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."),imageOverSizeNoCompessionVIWarning:mstrmojo.desc(14665,"Cannot embed an image larger than ##MB. Enter a URL to the image instead.")});mstrmojo.vi.ui.rw.selectors.EnumWarningPosition={TOP:1,BOTTOM:2,LEFT:3,RIGHT:4};var R=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition;mstrmojo.vi.ui.rw.selectors._HasWarningMessage=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._HasWarningMessage",{_mixinName:"mstrmojo.vi.ui.rw.selectors._HasWarningMessage",warningSlotName:"warning",showWarning:function G(U){var Y=this,a=Y.warningSlotName,c=Y[a],S=U&&U.lasting||6000,X=U.refNode||this.domNode,T=U.highlight!==false,b=U.closeOnClick===false?false:true,Z;if(!c){c=new mstrmojo.Tooltip({refNode:X,highlight:T,closeOnClick:b,updatePopupConfig:null,cssClass:"vi-warning vi-tooltip-V"});Y.addDisposable(c);Y[a]=c;Z=Y.closeOnClick=Y.getCloseOnClickListener();J.attachEvent(document.body,"click",Z);}var W=U.position||R.TOP,V="vi-warning vi-tooltip-";switch(W){case R.TOP:c.cssClass=V+"V";break;case R.BOTTOM:c.cssClass=V+"A";break;case R.LEFT:c.cssClass=V+"D";break;case R.RIGHT:c.cssClass=V+"C";break;}c.open(Y,A.call(Y,U));this.adjustPosition(U);if(T){P.toggleClass(c.refNode,"mstrmojo-Warning",true);}window.clearTimeout(Y._warningTimeOut);Y._warningTimeOut=window.setTimeout(function(){Y.hideWarning();},S);},hideWarning:function H(){var T=this,S=T[T.warningSlotName];if(S&&S.visible&&S.close){if(S.highlight){P.toggleClass(S.refNode,"mstrmojo-Warning",false);}S.close();window.clearTimeout(T._warningTimeOut);delete T._warningTimeOut;}},getCloseOnClickListener:function I(){var S=this;return function(){var T=S[S.warningSlotName];if(T.closeOnClick){S.hideWarning();}};},adjustPosition:function M(S){var T=this;L.call(T[T.warningSlotName],S);},generateContentHTML:function D(S){return E.encodeHtmlString(S,true);},bindWarningHandler:function F(){N.forEach(arguments,function S(U){if(!U||!U.attachEventListener){return ;}var V=U._validationEventListener,T;if(V){U.detachEventListener(V);delete U._validationEventListener;}T=this.getValidationEvtListener();if(T){U._validationEventListener=U.attachEventListener("validationChange",this.id,T);}},this);},getValidationEvtListener:function B(){var T=this;return function S(U){var V=U.value;T[(V&&V.invalid?"show":"hide")+"Warning"](V);};},unrender:function K(S){var T=this[this.warningSlotName];if(T){T.unrender();}this._super(S);},destroy:function O(S){J.detachEvent(document.body,"click",this.closeOnClick);return this._super(S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.tooltip");var E=mstrmojo.dom,D=mstrmojo.string,F=mstrmojo.hash,H=mstrmojo.array,C=mstrmojo.tooltip;mstrmojo.ui._HasListTooltip=mstrmojo.provide("mstrmojo.ui._HasListTooltip",{_mixinName:"mstrmojo.ui._HasListTooltip",tooltipOrientation:"horizontal",tooltipOffset:8,tooltipMarkup:'<div class="content" style="{@style}">{@c}</div>',tooltipCss:{},tooltipContrast:false,getTooltipText:function A(I){return I&&(I.ttp||I.n);},showTooltip:function G(W,M){var O=this;if(!O.hasOpenTooltip&&!(O._lastOpened&&O._lastOpened.visible)){var b=E.eventTarget(M,W),X=O.getItemFromTarget(b),R=O.getItemNodeFromTarget(b),d=O.getTooltipText(X),N=O.tooltipCss;if(!d){return ;}var c=E.position(R),V,P,L,T="",U=O.tooltipOffset;if(this.tooltipOrientation==="vertical"){V=c.x+c.w/2;L=C.POS_TOPCENTER;P=c.y+c.h+U;O.tooltipCss=F.copy({cssClass:"vi-regular vi-tooltip-A A-center"},N);}else{var K=E.windowDim(),S=40,Y=c.x+c.w+U,J=c.x-U,a=J-S,I=K.w-(Y+S),Z="vi-regular vi-tooltip-",Q;P=c.y;if(I>=a){V=Y;Q=I;L=C.POS_TOPLEFT;N.cssClass=Z+"C  "+N.rightCssClass;}else{V=J;Q=a;L=C.POS_TOPRIGHT;N.cssClass=Z+"D  "+N.leftCssClass;}T="max-width: "+Q+"px;";}if(O.tooltipContrast){N.cssClass=N.cssClass+" contrast";}if(N&&N.getItemCssClass){N.cssClass=H.filter([N.cssClass,N.getItemCssClass(X)],function(e){return !!e;}).join(" ");}O.richTooltip=F.copy(O.tooltipCss,{content:D.apply(O.tooltipMarkup,{c:d,style:T}),top:P,left:V,posType:L});O.richTooltip.keepArrowXPos=!!O.keepArrowXPos;O.richTooltip.keepArrowYPos=!!O.keepArrowYPos;this._super(W,M);}},onclick:function B(I){var J=this;window.setTimeout(function(){if(J.hasOpenTooltip){J.hideTooltip();}window.clearTimeout(J._tooltipTimeOut);},0);this._super(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12370);var M=mstrmojo.hash,S=mstrmojo.array,H=mstrmojo.string,I=mstrmojo.warehouse.EnumDatabaseType,J=mstrmojo.warehouse.EnumDataChangeEvents.DBTABLES_CHANGED,R=mstrmojo.warehouse.EnumDataChangeEvents.DBTABLES_REQUESTED,T=mstrmojo.architect.menu.EnumMenuActions,F=7425,B=7426,V=mstrmojo.DI.DIConstants;mstrmojo.qb.mdx.Model=mstrmojo.declare(mstrmojo.warehouse.WHModel,null,{scriptClass:"mstrmojo.qb.mdx.Model",cubes:[],dbRoleEditorCfg:{hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[36,37,38,39],help:"Creating_a_data_source_connection_to_an_OLAP_source.htm"},dbObjectsDisplayOptions:2,dbRolesTypeFilter:[I.SAP,I.MSAS,I.EssBase,I.TM1],recursive:0,addCubes:function K(Z){var X=[],Y=this;if(!this.canAddCube(false)){return ;}mstrmojo.array.forEach(Z,function(b){X.push({n:b.n&&b.n.toString(),tp:b.cubetp.toString(),des:b.des&&b.des.toString(),ctn:b.ctn,tn:b.tn&&b.tn.toString(),isNew:true,dbrid:Y.SelDBRoleID});});Y.cubes=Y.cubes.concat(X);mstrApp.getRootController().getDataService().pollingStatus({success:function a(){Y.raiseEvent({name:"refreshTables",items:Y.cubes.slice(0)});}},null,mstrmojo.desc(12370,"Please wait..."));},canAddCube:function O(X){if(this.cubes.length>0){if(!X){this.raiseEvent({name:"maxCubeError"});}return false;}return true;},commitChanges:function C(b){var Y=this,X=function(c){var d=Y.recursive.toString();S.forEach(Y.cubes,function(e){e.rec=d;});mstrApp.getRootController().getDataService().addCubes(c,{cubes:JSON.stringify(Y.cubes),tbid:Y.tableID,dbrid:Y.cubes[0].dbrid,showWait:true});},Z=function(c){if(Y.isManagedCube){if(c&&c.success){c.success();}}else{var d={success:function(e){if(e&&e.items&&e.items.length===1){Y.folderID=e.items[0].fid;}Y.submitRequest(c,{taskId:"saveAndPublishCube",displayMode:12,shouldRefresh:false,saveAsFlags:V.saveAsFlags.saveAsDDA|V.saveAsFlags.saveAsOverWrite,folderID:Y.folderID||"",objName:Y.cubeName||"",objDesc:Y.cubeDesc||"",showWait:true});}};if(!Y.folderID&&Y.cubeID){mstrApp.getRootController().getDataService().getObjectFolder(d,{dids:Y.cubeID,types:3});}else{d.success();}}};if(this.original){if(Y.cubes[0].isNew){X({success:function a(){Z(b);}});}else{Z(b);}}else{X({success:function a(){Z(b);}});}},removeCube:function N(X){mstrmojo.array.removeIndices(this.cubes,X,1);this.raiseEvent({name:"refreshTables",items:this.cubes.slice(0)});},updateCube:function W(){var X=this;mstrApp.getRootController().getDataService().updateCubes({success:function Y(){X.raiseEvent({name:"refreshTables",items:X.cubes.slice(0)});}},{tbid:X.tableID,showWait:true});},initialize:function A(){var Y=this,X=Y.isNew=!mstrApp.tableID,Z=2,a=327681,c=mstrApp.getRootController().getDataService(),d=function d(){c.createEmmaTable({success:function e(f){Y.tableID=f.tbid;Y.isFREnabled=f.frFlag;mstrApp.msgid=f.msgid;}},{xt:Z,dict:a});};Y.tableID=mstrApp.tableID;Y.folderID=mstrApp.folderID;Y.cubeName=mstrApp.cubeName;Y.cubeDesc=mstrApp.cubeDesc;Y.cubeID=mstrApp.reportID;mstrApp.msgid=mstrApp.msgID;Y.cubes=[];Y.dbtbls={};Y.original=undefined;Y.SelDBRoleID=undefined;Y.recursive=0;if(X){if(mstrApp.msgid){d();}else{c.createEmmaInstance({success:function b(e){mstrApp.msgid=e.msgid;d();}});}}else{Y.loadTable(Y.tableID);}},loadTable:function G(X){var Y=this;Y.tableID=X;Y.submitRequest({success:function Z(c){var d=c.datap.srce,a=d.dbrid,e=d.tbal&&d.tbal.toString(),b=d.recurisve||0;Y.original=d;Y.cubes.push({n:e,tp:d.dbtp&&d.dbtp.toString(),des:d.des&&d.des.toString(),ctn:d.ctn,tn:e});Y.raiseEvent({name:"refreshTables",items:Y.cubes.slice(0)});Y.set("SelDBRoleID",a);Y.set("recursive",b);}},{taskId:"qBuilder.GetReportXDADefinition",showWait:true,tableID:X,browsetype:4,previewflag:8});},_set_SelDBRoleID:function P(c,Z){var X=this,b=(X.SelDBRoleID!==Z),Y=mstrmojo.warehouse.EnumDataChangeEvents;if(this._super){this._super(c,Z);}X.SelDBRoleID=Z;if(b&&Z){mstrApp.getRootController().getDataService().setDBRole({success:function a(d){mstrApp.msgid=d.msgid;}},{dbrid:Z,tbid:X.tableID});}S.forEach(X.dbrs,function(d){if(d.data.isPrimary){d.data.isPrimary=false;X.raiseEvent({name:Y.DBROLE_CHANGED,item:d});}if(d.did===Z){d.data.isPrimary=true;X.raiseEvent({name:Y.DBROLE_CHANGED,item:d});var e=mstrApp.diFooterID,f=e?mstrmojo.all[e]:undefined;if(f){f.mdxRA.update((!X.isNew||X.isFREnabled)&&!X.hasNonRADataset&&(d.mdDBRole.db_type===I.EssBase||d.mdDBRole.db_type===I.MSAS));}}});return b;},getNameSpaces:function D(){var X=this.SelDBRoleID;this.raiseEvent({name:mstrmojo.warehouse.EnumDataChangeEvents.NAMESPACES_CHANGED,namespaces:undefined,namespaceMode:mstrmojo.warehouse.EnumNamespaceMode.ALL,dbRoleID:X,namespace:undefined});},getSelectedDBRoleTables:function E(o){var Y=this,q=Y.SelDBRoleID,X=Y.dbtbls,m=o.blockCount,h=o.filterText,p=Y.getDBRole(q),a=false,d,c=[],g=[],l=[],r,n,j,Z,k=X[q],b,f={};if(!p){return ;}if(!Y.catalogRefresh&&k!==undefined){h=h&&h.toUpperCase();M.forEach(k,function(t,u){a=true;b=H.decodeHtmlString(t.n);Z=[];j=t.cuis;j=[].concat((j&&j.cui)||[]);d=false;r=[];if(h!==""){S.forEach(j,function(w){if(w.n.toUpperCase().indexOf(h)>-1){r.push(w);d=true;}});}else{r=j;d=true;}if(d){n=new mstrmojo.warehouse.obj.TableData({id:u,n:b,tn:u,tp:15,model:Y,ns:""});n.items=r.slice(0);g.push(n);}});if(a){if(h!==""){S.forEach(g,function(u,t){f[t]=true;});}Y.raiseEvent({name:J,items:g,expandedIndices:f,selectedItems:Y.getDBRoleTablesInUse(q)||[]});return ;}}k=X[q]={};Y.raiseEvent({name:R,sourceInfo:o.sourceInfo||""});this.submitRequest({success:function(u){var w=u.mi.cas,x,t;Y.catalogRefresh=false;w=[].concat((w&&w.ca)||[]);S.forEach(w,function(AA,z){x=H.decodeHtmlString(AA.n&&AA.n.toString());t=H.decodeHtmlString(AA.tn&&AA.tn.toString())||x;if(!k[t]){k[t]=AA;Z=[];j=AA.cuis;j=[].concat((j&&j.cui)||[]);S.forEach(j,function AB(AC){AC.cubetp=AC.tp;AC.tp=26;AC.ctn=x;AC.tn=t;AC.n=AC.n&&AC.n.toString();AC.des=AC.des&&AC.des.toString();Z.push(AC);});n=new mstrmojo.warehouse.obj.TableData({id:t,n:x,tp:15,model:Y,ns:"",did:x,items:Z});k[t].cubes=Z;l.push(n);if(z<m){c.push(n);}}});Y.raiseEvent({name:J,items:l,selectedItems:Y.getDBRoleTablesInUse(q)||[]});},failure:function e(){Y.raiseEvent({name:J,items:l,selectedItems:Y.getDBRoleTablesInUse(q)||[]});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:q,mdx:1,showWait:false});},getColumnsForDBTable:function U(e,Z){var Y=this,d=e.data.dbrole||Y.SelDBRoleID,b=e.data,a=b.n,c=b.did,X=Y.dbtbls[d][c].cubes;Z.success({src:e,items:X,selDBRole:d});Y.raiseEvent({name:"dbTablesPopulated",items:{id:a,n:a,items:X}});if(Z&&Z.complete){Z.complete();}},handleVisibleAction:function Q(Y,X){var Z;if(!X){return true;}if(X.action===T.EDIT){Z=Y.tp===F||Y.tp===B;}else{Z=this._super(Y,X);}return Z;},submitRequest:function L(Z,Y,X){mstrApp.getRootController().getDataService()[X||"submitRequest"](Z,Y);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(14098,12406,13534,13535,12383,14666);var D=mstrmojo.DI.DIConstants,P=mstrmojo.warehouse.EnumDatabaseType,T=mstrmojo.warehouse.EnumDataChangeEvents,F=mstrmojo.qb.EnumQBAppType,M=mstrmojo.array,Y={SET_SINGLE_PARTITION_EMMA:4},H=P.SAPHana,I={SPECIAL_SOURCE:1,ALTERNATE_SOURCE:2,REFRESH_DATA:3},C={1:mstrmojo.desc(12406,"Multiple tables cannot be added to the selection list as this data source has a special restriction which allows only a single table to be present in the data cube."),2:mstrmojo.desc(13534,"Multiple tables cannot be added to the selection list when setting Alternate Source."),3:mstrmojo.desc(13535,"Multiple tables cannot be added to the selection list when refreshing data for a table which is not a partition table.")},O=10,X=0,S=0;function Q(f){var h={isPartition:false},j,e=[],g;if(!f){return h;}h.type=f.tp;h.isPartition=h.type!==0;j=f.ptabs||[];M.forEach(j,function(k){g={};if(k.n){g.name=k.n;}if(k.hasOwnProperty("shnb")){g.sheetIndex=k.shnb;}e.push(g);});h.tables=e;return h;}function U(e){var f=[],g;M.forEach(e,function(h){g={n:h.dbtn||h.n,ns:h.ns,dbr:h.dbr,dbrn:h.dbrn,tid:h.tid||"",gbqpid:h.gbqpid||""};if(h.extt){g.extt=h.extt;}if(h.clis){g.clis=h.clis;}if(h.hanai){g.afis=h.hanai.afis;g.hieris=h.hanai.hieris;g.varis=h.hanai.varis;}f.push(g);});return f;}function N(n,m,j){var k=mstrApp.getRootController().getDataService(),h,g,o=n.length,e={success:function l(){var p={};X+=O;if(X>=o){h=JSON.stringify(U(n));p.tables=h;if(j!==undefined){p.flag=j;}k.autoMap(m,p);}else{g=[];M.forEach(n.slice(X,X+O),function(q){g.push(q.tid);});k.prepareData(e,{tables:g.join(",")},Math.min(X+O,o),o);}},failure:function f(){X+=O;},canceled:function(r,q){var p={success:function(){m.canceled();},failure:function(){m.canceled();}};if(q&&(q.tid||q.jid)){k.killJob(p,{threadId:q.tid,jobid:q.jid});}else{p.success();}}};g=[];M.forEach(n.slice(X,X+O),function(p){g.push(p.tid);});k.prepareData(e,{tables:g.join(",")},Math.min(X+O,o),o);}function A(){this.raiseEvent({name:"refreshTables",items:this.tables.slice(0),tablesEnabled:this.getAvailableTablesEnabled()});}mstrmojo.qb.es.Model=mstrmojo.declare(mstrmojo.warehouse.WHModel,null,{scriptClass:"mstrmojo.qb.es.Model",tables:[],addTableErrorMsg:undefined,dbRolesVersionExcludeFilter:[223],isDataImport:true,init:function W(e){if(this._super){this._super(e);}if(e===undefined||e.tables===undefined){this.tables=[];}if(e===undefined){return ;}if(this.isForAlternateSource){this.maxTableCount=1;this.addTableErrorMsg=C[I.ALTERNATE_SOURCE];}if(e.dbTypes!==undefined){this.specifyDBTypes=true;var f=e.dbTypes;if(e.hasNonSapHana||mstrApp.isSingleTier){M.removeItem(f,H);}this.dbRolesTypeFilter=f;this.dbmsTypeFilter=f.slice(0);}if(e.dbIds){this.dbRoleEditorCfg={dbIdFilter:e.dbIds};}if(e.dbVersions){this.dbRolesVersionFilter=e.dbVersions;this.dbmsVersionFilter=e.dbVersions;}this.dbRolesVersionExcludeFilter=(e.dbRolesVersionExcludeFilter!==undefined)?[223].concat(e.dbRolesVersionExcludeFilter):[223];if(mstrApp.isSingleTier){this.dbRolesVersionExcludeFilter=[203,220,228,252].concat(this.dbRolesVersionExcludeFilter);this.dbRoleEditorCfg=this.dbRoleEditorCfg||{};this.dbRoleEditorCfg.dsnDbTypeExcludeFilter=[4000];}if(e.dbObjects!==undefined){this.dbObjects=e.dbObjects;}if(e.isSapHanaSingleTable){this.isDDA=true;this.origIsDDA=true;this.dbObjectsDisplayOptions=1;this.specifyDBTypes=true;this.dbRolesTypeFilter=[P.SAPHana];this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);}if(e.isHadoopQB){this.dbObjectsDisplayOptions=16;this.specifyDBTypes=true;this.dbRolesTypeFilter=D.hadoopDbTypes.slice(0);this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);this.dbRolesVersionExcludeFilter=D.ibmDb2Versions.concat(this.dbRolesVersionExcludeFilter);}if(e.subtype!==undefined){switch(e.subtype){case D.sourceSubtype.searchOnSource:this.maxTableCount=1;this.addTableErrorMsg=C[I.SPECIAL_SOURCE];this.isDDA=true;this.origIsDDA=true;this.dbRoleEditorCfg={hideDSNOption:true,hideDriverCheck:true,requiresLogin:false,dbIdFilter:[40]};this.helpTopic="importing_data_using_a_search_as_a_source.htm";this.dbObjectsDisplayOptions=4;this.specifyDBTypes=true;this.dbRolesTypeFilter=[P.SearchEngineSOLR,P.SearchEngineSPLUNK];break;}}this.dbRoleEditorCfg.dbIdExcludeFilter=[41,15];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=[3000];},helpTopic:"importing_data_from_relational_tables.htm",dbRoleEditorCfg:{dbIdExcludeFilter:[41]},canAddTableInDDA:function V(j){var h=this.tables,f=this.SelDBRoleID,g,e;if(this.isDDA){g=this.dbridForDDA;if(g&&f!==g){e={name:"directDataAccessTableError"};}else{if(!g&&h.length>0&&f!==h[0].dbr){e={name:"directDataAccessTableError"};}}}if(e){if(!j){this.raiseEvent(e);}return false;}return true;},canAddTable:function d(f,j){var k=this.tables,n=j?j.length:0,g=this.maxTableCount,m=[],h,p={OLAP:4+262144000,JOIN:5+262144000,CALC:7+262144000};if(!this.canAddTableInDDA(f)){return false;}if(g&&k.length+n>g){if(!f){this.raiseEvent({name:"maxTableError"});}return false;}var l=this.SelDBRoleID,e=this.getDBRole(l),o=false;if(e&&e.mdDBRole&&e.mdDBRole.db_type===H){mstrmojo.array.forEach(j,function(q){h=parseInt(q.extt,10);if(h!==p.OLAP&&h!==p.JOIN&&h!==p.CALC){m.push(q);}});mstrmojo.array.removeItems(j,"did",m);if(m.length>0){this.raiseEvent({name:"SapHanaIncompatibleTypeError",data:m});}if(n!==0&&j.length===0){return false;}mstrmojo.array.forEach(k,function(q){if(l!==q.dbr){o=true;return false;}});}else{mstrmojo.array.forEach(k,function(q){if(q.hanai){o=true;return false;}});}if(o){this.raiseEvent({name:"SaPHanaError"});return false;}return true;},addTable:function a(g){var f=this.tables,e=this.SelDBRoleID,j=this.getDBRole(e),l=j.n,k,h=this;if(!this.canAddTable(false,g)){return ;}if(j.mdDBRole&&j.mdDBRole.db_type===H){mstrmojo.array.forEach(g,function(m){f.push({n:m.n,ns:m.ns,dbr:e,dbrn:l,dbtn:m.dbtn,extt:m.extt,hanai:m.hanai,clis:m.clis});});A.call(h);}else{mstrmojo.array.forEach(g,function(m){f.push({n:m.n,ns:m.ns,dbr:e,dbrn:l,dbtn:m.dbtn,gbqpid:h.selectedProject});});if(!this.isDDA){k=mstrApp.getRootController().getDDAController();k.tryEnableDDACheckbox(false);}if(mstrApp.msgid&&mstrApp.sessionManager){mstrApp.sessionManager.keepSessionAlive();}A.call(h);}},removeTable:function c(e){var k=mstrApp.getRootController().getDataService(),f=this.tables,h,g=this,j;j=f[e].tid;f.splice(e,1);if(f.length===0&&this.canAddTable(true)){this.raiseEvent({name:T.DBTABLES_ENABLED,value:true});}if(!this.isDDA){h=mstrApp.getRootController().getDDAController();h.tryEnableDDACheckbox(true);}if(j&&!g.original){k.removeEMMATable({success:function(){A.call(g);}},{did:j});}else{if(mstrApp.msgid&&mstrApp.sessionManager){mstrApp.sessionManager.keepSessionAlive();}A.call(g);}},removeDBRoleTables:function G(h){var e=this.tables,f=[],g;if(!h){return ;}M.forEach(e,function(j){if(j.dbr!==h){f.push(j);}});if(f.length===e.length){return ;}e=this.tables=f;A.call(this);if(e.length===0&&this.canAddTable(true)){this.raiseEvent({name:T.DBTABLES_ENABLED,value:true});}if(!this.isDDA){g=mstrApp.getRootController().getDDAController();g.tryEnableDDACheckbox(true);}},getAvailableTablesEnabled:function b(){return this.canAddTableInDDA(true);},commitChangesEditPartition:function J(m){var k=this,l=mstrApp.getRootController().getDataService(),f,h=[],n=k.tables,j,g,e=true;if(n.length===0){return ;}j=n[0].dbr;g=n[0].ns;M.forEach(n,function(o){e=o.dbr&&o.dbr===j&&((!o.ns&&!g)||(o.ns===g));if(!e){return false;}h.push(o.n);return true;});if(!e){mstrmojo.alert(mstrmojo.desc(12383,"Error: All the tables should share the same database and namespace when refreshing a partition table"),null,null);return ;}f={mode:Y.SET_SINGLE_PARTITION_EMMA,partitionId:k.tableID,addTables:JSON.stringify(h)};l.changePartition(m,f);},commitChanges:function B(l){var k=!!(this.tableID&&this.partition&&this.partition.isPartition),f=l,g=false,e=this,j=mstrmojo.desc(14666,"Do you want to group these tables into a single partition table?");if(!k&&this.tableID&&this.tables.length>1){k=true;g=true;}if(!k){e._commitChanges(l);return ;}l={success:function h(){e._commitChanges(f,true);}};if(g){mstrmojo.confirm(j,{confirmBtn:{fn:function(){e.commitChangesEditPartition(l);}}});}else{e.commitChangesEditPartition(l);}},_commitChanges:function Z(o,m){var j=o;var n=mstrApp.getRootController().getDataService(),l=this,f=false,g,k,h=false,e=function e(u){if(l.tables.length===0){if(u&&u.success){u.success({msgid:mstrApp.msgid});}return ;}M.forEach(l.tables,function(w){if(w.extt){h=true;return false;}});if(h){l.isDDA=true;}var r=function r(){g=JSON.stringify(U(m?[l.tables[0]]:l.tables));if(mstrApp.msgid){k=h?64:0;k=k|(l.original?16:0);n.createEmmaTables(u,{tables:g,skip:f,flag:k,said:mstrApp.said||"",xt:mstrApp.type,sap:h});}else{n.createEmmaInstance({success:function w(x){mstrApp.msgid=x.msgid;n.createEmmaTables(u,{tables:g,skip:f});}});}};if(!m&&l.tables.length>0&&!h&&mstrApp.type!==F.BigQuerySingleTable){f=true;X=0;u={success:function t(w){M.forEach(l.tables,function(z,x){z.tid=w.tables[x].id;});N(l.tables,mstrmojo.func.wrapMethods(j,{canceled:function(){}}),k);}};}else{if(h){S=0;var q={success:function t(x){var w=[],z=l.tables[S];M.forEach(x.items,function(AA){w.push(AA.dbInfo);});z.clis=w;z.hanai=x.hanaInfo;S++;if(S>=l.tables.length){r();}else{l.getColumnsForDBTable({data:l.tables[S]},mstrmojo.hash.copy(q,{}));}},failure:function p(){S++;}};l.getColumnsForDBTable({data:l.tables[S]},mstrmojo.hash.copy(q,{}));return ;}}r();};if(l.original){l.tables[0].tid=l.tableID;}e(o);},loadTable:function L(f){var g=this,e=mstrApp.getRootController();g.tableID=f;g.submitRequest({success:function h(t){var z=t.datap.srce,j=z.dbrid,r,w=g.tables,l,n=z.ns||"",k=z.gbqp||"",q=(z.dbtp===H),m,p,x=(mstrApp.type===F.BigQuerySingleTable);g.original=z;g.usingCookieNamespace=true;if(!x){p=g.getDBRole(j);l=(p&&p.n)||"";}else{l=z.gbqp;}r=g.partition=Q(z.pti);if(r.isPartition){M.forEach(r.tables,function(AA){w.push({n:AA.name,ns:n,dbr:j,dbrn:l});});}else{w.push({n:z.tbn,ns:n,dbr:j,dbrn:l,gbqpid:k});}A.call(g);if(x){e.selectDBRole(k);if(g.getProject(k)===null){m=mstrmojo.desc(14098,"There is no project ## in ###").replace("##",k).replace("###",mstrApp.userEmail);mstrmojo.alert(m);}}else{e.selectDBRole(j);if(q){var o=w[0];g.getSelectedDBRoleTables({dbRoleID:j,filterText:""},{success:function u(AA){var AC=AA.items||AA.xrc.cas[0].tis;M.forEach(AC,function(AD){if((AD.tbn||AD.dbtn)===z.tbn&&AD.ns===z.ns){o.extt=AD.extt;o.hanai=AD.hanai;return false;}});g.getColumnsForDBTable({getFresh:true,data:{n:z.tbn,dbtn:z.tbn,ns:n}},{success:function AB(AE){var AD=[];M.forEach(AE.items,function(AF){AD.push(AF.dbInfo);});o.clis=AD;}});}});}}}},{taskId:"qBuilder.GetReportXDADefinition",showWait:true,tableID:f,browsetype:4,previewflag:this.isRefined?4:8});},_set_SelDBRoleID:function(h,f){var e=this,g=(e.SelDBRoleID!==f);this._super&&this._super(h,f);e.SelDBRoleID=f;if(g&&f){e.setDBRole&&e.setDBRole(f);}mstrmojo.array.forEach(e.dbrs,function(j){if(j.data.isPrimary){j.data.isPrimary=false;e.raiseEvent({name:T.DBROLE_CHANGED,item:j});}if(j.did===f){j.data.isPrimary=true;e.raiseEvent({name:T.DBROLE_CHANGED,item:j});}});if(g){e.raiseEvent({name:T.DBTABLES_ENABLED,value:e.getAvailableTablesEnabled()});A.call(e);}return g;},submitRequest:function R(g,f,e){mstrApp.getRootController().getDataService()[e||"submitRequest"](g,f);},onisDDAChange:function E(e){var f=this;mstrApp.getRootController().getDDAController().checkDDACheckbox(e.value);f.raiseEvent({name:T.DBTABLES_ENABLED,value:f.getAvailableTablesEnabled()});A.call(f);},getHelpTopic:function K(){return this.helpTopic;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._hasBigQueryModel","mstrmojo.qb.es.Model");mstrmojo.qb.bigquery.ESModel=mstrmojo.declare(mstrmojo.qb.es.Model,[mstrmojo.qb.bigquery._hasBigQueryModel],{scriptClass:"mstrmojo.qb.bigquery.ESModel",getDBRole:function A(){return{n:this.selectedProject};}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.ui.menus._HasMenuPopup","mstrmojo._CanAutoClose","mstrmojo._IsPopup","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.ui.PopupConfig","mstrmojo.ui._HasScroller","mstrmojo.ui._HasUITheme","mstrmojo.dom","mstrmojo.css","mstrmojo.ui._HasListTooltip");var D=mstrmojo.dom,P=mstrmojo.css,I=mstrmojo.ui.PopupConfig.directionCfg;var Q={};var K=false;function F(V,W){if(V.pop){if(W&&V.ax){window.clearTimeout(this._popupAxTimeout);V.actionFn();this.closeAllMenus();}else{var T=V.fn.call(mstrmojo.all[V.scope],V.ctxt);var U=T.ENUM_CORNERS;T.setAlignment(U.TOP_RIGHT,U.TOP_LEFT);T.hostId=this.id;T.hostElement=this._getItemNode(V._renderIdx);this.openPopup(T.newInstance());}}else{if(V.dsbld!==true){if(V.fn(V,this)!==false){this.closeAllMenus();}}}}function G(T){var U=parseInt(T);return U===null||isNaN(U)?0:U;}mstrmojo.ui.menus.Menu=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup,mstrmojo._IsPopup,mstrmojo.ui.menus._IsMenuPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip,mstrmojo.ui._HasScroller,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.ui.menus.Menu",selectionPolicy:"reselect",locksHover:true,closeOnClick:true,themeClassName:"mojo-theme-dark",icnCss:"mstrmojo-ui-Menu-item-container",popupConfig:null,tooltipCss:{leftCssClass:"menuTooltip",rightCssClass:"menuTooltip"},setupScrollNodes:function(){if(this.popupConfig&&this.popupConfig.supportsScroll){this.scrollNode=this.itemsContainerNode;this.scrollbarHostNode=this.domNode;}},updateScrollbars:function(){this._super();if(this.popupConfig&&this.popupConfig.supportsScroll&&this.hasCustomScrollbar){var V=this.scrollNode;if(!V){return ;}var T=(getComputedStyle&&getComputedStyle(V,null))||V.currentStyle,U=V.offsetWidth-G(T.borderLeftWidth)-G(T.borderRightWidth)-V.clientWidth;V.style.marginRight=-U+"px";V.style.paddingRight=0;}},onscroll:function(){this.closePopup();this._super();},init:function L(V){this._super(V);var T=this.popupConfig;this.items=T.getMenuItems();var U=["mstrmojo-ui-Menu","unselectable"],W=T.menuCssClass;if(W){U.push(W);}P.addWidgetCssClass(this,U);if(T&&T.supportsScroll&&T.maxHeight>0){this.icnCssText=(this.icnCssText||"")+";max-height:"+T.maxHeight+"px";}this.useRichTooltip=!!T.useTooltip;this.tstid=T.tstid;},markupMethods:{onvisibleChange:function J(){var T=this.visible;if(!K||T){P.toggleClass(this.domNode,"visible",T);}}},getItemMarkup:function C(X,T){if(X.getItemMarkup){return X.getItemMarkup.apply(this,[X,T]);}var V=!!X.pop,W=V?"submenu":"item",U=Q[W];if(!U){U=this._super(X,T).replace("{@en@n}",'<div class="micn"></div>{@en@n}');if(V){U=U.replace("{@en@n}",'{@en@n}<div class="arw"></div>');}Q[W]=U;}if(X.tstid){U=U.replace("{@tag}","{@tag} "+mstrmojo.tstid(X)+" ");}return U;},getItemProps:function R(V,T){var U=this._super(V,T);U.tag="a";U.addCls("mstrmojo-ui-Menu-item");U.addCls(V.cls);return U;},adjustCornersForPopupOverflow:function O(){var V=this._super(),Z=this.domNode,Y,X,T,U,W;if(V){Y=D.position(Z);T=Y.y;X=Z.style;U=this.popupConfig;W=U.position||D.position(U.hostElement);if(T<0||(T+Y.h>D.position(document.body).h)){X.top=(-W.y+5)+"px";X.bottom="auto";}}return V;},onmouseover:function E(T){var Y=T.getTarget(),X=this.getItemFromTarget(Y),W=this,V=W._lastOpened,a=V&&this.getItemFromTarget(V.popupConfig.hostElement)._renderIdx,Z=this.getItemNodeFromTarget(Y),U=(a!==undefined&&D.contains(this._getItemNode(a),Y,true,this.domNode));if(X){this._lastHoverIx=X._renderIdx;window.clearTimeout(this._popupTimeOut);window.clearTimeout(this._popupAxTimeout);if(this._lastHoverIx!==a&&!U){this._popupTimeOut=window.setTimeout(function(){if(W._lastOpened&&W._lastOpened.visible){W.closePopup();}if(W.visible&&X.pop){if(X.ax){W._popupAxTimeout=window.setTimeout(function(){P.removeClass(Z,"hlt-ax");F.call(W,X);},0);}else{F.call(W,X);}}},400);if(X.pop&&X.ax){P.addClass(Z,"hlt-ax");}}}},onclick:function S(T){this._evtTarget=T.getTarget();this._super(T);T.cancel();},postselectionChange:function H(T){var U=T.added;if(U){var V=this.items[U[0]];F.call(this,V,!(V.ax&&this._evtTarget.className==="arw"));delete this._evtTarget;}},oncontextmenu:function M(T){D.preventDefault(window,T.e);return false;},postBuildRendering:function N(T){this._super(T);if(this.popupConfig.supportsScroll){var U=this;window.setTimeout(function(){U.updateScrollbars();},10);}},showTooltip:function B(X,W){var V=D.eventTarget(W,X),U=this.getItemNodeFromTarget(V),T=this.getItemFromTarget(V);if(U&&((T&&T.ttp)||(U.scrollWidth>U.clientWidth))){this._super(X,W);}},onClose:function A(T){if(this._super){this._super(T);}this.closePopup();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.ui._HasListTooltip");mstrmojo.ui.PopupList=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo._IsPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.PopupList",autoCloses:true,locksHover:true,closeOnClick:true,parentDomNode:undefined,markupString:'<div id="{@id}" class="mstrmojo-PopupList {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu><div class="mstrmojo-popupList-scrollBar"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function D(){return this.domNode.firstChild.firstChild;},scrollboxNode:function F(){return this.domNode.firstChild;}},setupScrollNodes:function E(){this.scrollNode=this.scrollboxNode;},onOpen:function B(){this._super();this.updateScrollbars();},postBuildRendering:function C(){var H=this._super();if(!this.parent){var G=this.parentDomNode=this.parentDomNode||document.body;G.appendChild(this.domNode);}return H;},closePopup:function A(){this.set("visible",false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo._CanValidate","mstrmojo.css","mstrmojo.validation","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");var H=mstrmojo.css,E=mstrmojo.validation,G=E.TRIGGER,J=E.STATUSCODE;function F(L){if((this.constraints.trigger&L)>0){this.validate();}}mstrmojo.ValidationTextBox=mstrmojo.declare(mstrmojo.TextBox,[mstrmojo._CanValidate,mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.ValidationTextBox",validationDelay:500,getInvalidMsg:function K(L){return(L&&L.msg?L.msg:"");},postBuildRendering:function A(){this._super();this._original_tooltip=this.inputNode.title;},prekeyup:function I(L){this._super(L);var P=(this.constraints.trigger&G.ONKEYUP)>0;if(P){var M=this.validationDelay;if(M){this.clearValDelayTimer();var O=this._validateHandler;if(!O){var N=this;this._validateHandler=O=function(){N.validate();if(N._valDelayTimer){window.clearTimeout(N._valDelayTimer);delete N._valDelayTimer;}};}this._valDelayTimer=window.setTimeout(O,M);}else{this.validate();}}},preinput:function D(L){this._super(L);F.call(this,G.ONKEYUP);},preblur:function B(L){this._super(L);F.call(this,G.ONBLUR);},clearValidation:function C(){this._super();var L=this.inputNode;H.removeClass(L,this.constraints.invalidCssClass||"mstrmojo-TextBox-ErrValidation");L.title=this._original_tooltip;},clearValDelayTimer:function(){var L=this._valDelayTimer;if(L){window.clearTimeout(L);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ValidationTextBox,{onvalidationStatusChange:function(){var P=this.validationStatus;if(!P){return ;}var N=this.inputNode,L=(P.code>J.VALID),M=this.constraints.invalidCssClass;H.toggleClass(N,M||"mstrmojo-TextBox-ErrValidation",L);var O=L?this.getInvalidMsg(P):this._original_tooltip;if(!this.useRichTooltip&&O!==undefined&&O!==null){N.setAttribute("title",O);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.LegacySuggestionList","mstrmojo.ui._HasScroller");var C=mstrmojo.dom;mstrmojo.ui.ScrollableSuggestionList=mstrmojo.declare(mstrmojo.LegacySuggestionList,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",markupString:'<div id="{@id}" class="mstrmojo-ListBase mstrmojo-scrollable-suggestlist {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function B(){return this.domNode.firstChild.firstChild;},scrollboxNode:function E(){return this.domNode.firstChild;},scrollNode:function H(){return this.domNode.firstChild;}},onclick:function A(I){var J=this.getItemFromTarget(I.getTarget());if(J){this._super(I);}},onitemsChange:function D(){var I=this;window.setTimeout(function(){I.hideTooltip();I.updateScrollbars();},0);},updateScrollbars:function F(){this._super();var K=this,M=K.scrollNode,I=M.clientWidth,L=K.itemsContainerNode,J=L.clientWidth;L.style.width="auto";window.setTimeout(function(){if(I>J){L.style.width=J+(I-J)+"px";}},10);},useRichTooltip:true,getItemTooltip:function(L,M){var J=C.position(M),K=M.ttp;var I={areaId:L._renderIdx+"text",cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:K,top:J.y,left:J.x+J.w+6,enableHover:false};return I;},showTooltip:function G(I,L){var K=this.targetEl,J=this.targetItem;if(K&&K.ttp){this.richTooltip=this.getItemTooltip(J,K);if(this.richTooltip){this._super(I,L);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ToolBar","mstrmojo.boxmodel","mstrmojo.array","mstrmojo.EnumRWUnitType","mstrmojo.dom","mstrmojo.css");var Q=["background-color","border","border-color","border-left","border-style","border-top","border-width","filter","top","left","z-index","fx","normWidth","normHeight","normZIndex","normTop","normLeft","tbborder","lrborder","ttl"],X=["width","height"],o="p_fmts";var l="px";var j={getContentHeight:function(r,u){var t=u.ttl&&u.ttl.height;if(r&&t&&!this.floatingToolbar){return Math.max(parseInt(r,10)-parseInt(t,10),0)+l;}return"";},getPortletMinHeight:function(r){return r.ttl.height;},adjustTitleCss:function(){return ;}};var f={getContentHeight:function(r){return r;},getPortletMinHeight:function(){return 0;},adjustTitleCss:function(r){r.titlebarNodeClass+=" floating";return ;}};function A(w,t){var u=this.parent,r=w+"DirtyKey";if(u[r]){u[r](t);}}function P(){this.toolbarTitleTextNode.innerHTML=this.title+(this.count?" ("+this.count+")":"");}function h(){var t=this.parent,w=t&&t.defn;if(w&&parseInt(w.t,10)===mstrmojo.EnumRWUnitType.PANEL){var r=t.parent,u=r.defn;if(u&&u.ifp){return r;}}return null;}var R=mstrmojo.hash,G=2;mstrmojo.DocPortlet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable],{scriptClass:"mstrmojo.DocPortlet",floatingTitle:false,floatingTitleHeight:30,n:"",buttonWidth:17,markupString:'<div class="mstrmojo-portlet {@borderCss}" nm="{@n}" style="{@portletNodeCssText}"><div class="mstrmojo-portlet-slot-shadow" style="{@shadowNodeCssText}"></div><div class="mstrmojo-portlet-container" style="{@portletContainerNodeCssText}"><div class="mstrmojo-portlet-titlebar {@titlebarNodeClass}" style="{@titlebarNodeCssText}"><table style="height:100%;width:100%" class="mstrmojo-portlet-titlebar-table" cellspacing="0" cellpadding="0"><tr><td class="mstrmojo-portlet-slot-toolbar-left {@leftToolbarNodeClass}" style="{@leftToolbarNodeCssText}"></td><td class="mstrmojo-portlet-title" style="{@titleNodeCssText}"><div style="overflow: hidden;"></div></td><td class="mstrmojo-portlet-slot-toolbar {@toolbarNodeClass}" style="{@rightToolbarNodeCssText}"></td></tr></table></div><div class="mstrmojo-portlet-buttonbar {@buttonbarNodeClass}" style="{@buttonbarNodeCssText}"></div><div class="mstrmojo-portlet-slot-content" style="{@contentNodeCssText}"></div></div></div>',rightToolbarNodeCssText:"",leftToolbarNodeCssText:"",titleNodeCssText:"",titlebarNodeClass:"",titlebarNodeCssText:"",contentNodeCssText:"",borderCss:"no-border",buttonbarNodeClass:"",buttonbarNodeCssText:"",markupSlots:{containerNode:function(){return this.domNode.lastChild;},portletNode:function(){return this.domNode;},portletContainerNode:function(){return this.domNode.lastChild;},dimNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;},titleNode:function(){return this.domNode.lastChild.childNodes[0];},buttonbarNode:function(){return this.domNode.lastChild.childNodes[1];},toolbarNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[2];},toolbarTitleTextNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[1].firstChild;},leftToolbarNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[0];},contentNode:function(){return this.domNode.lastChild.lastChild;}},markupMethods:{ontitleChange:function(){P.call(this);},oncountChange:function(){P.call(this);},onfcChange:function(){if(this.fc&&this.content){this.updateContentHeight();}}},formatHandlers:{portletContainerNode:["RW","B","fx","background-color"],shadowNode:["RW","B","fx","background-color"],buttonbarNode:{src:"ttl",props:["background-color"]},titlebarNode:{src:"ttl",props:["F","B","background-color","height","fx","text-align","vertical-align"]},titleNode:{src:"ttl",props:["vertical-align","P","text-decoration"]}},updateServer:true,fc:false,content:null,rightToolbar:null,leftToolbar:null,floatingToolbar:false,_ts:j,getCacheKey:function F(){return this._super()+"-portlet";},getFormats:function M(){var t=this.content,r=t&&t.getFormats();return r&&r[o];},updateContentHeight:function d(x){var r=this.getFormats(),t=this.content,w=t.dimNode||t.domNode,u=((r.ttl&&parseInt(r.ttl.height,10))||0);if(w){if(!x){u+=((this.fc||this.isInFilterPanel())?w.offsetHeight:(r.height?parseInt(r.height,10):0));}this.containerNode.style.height=u+l;this.shadowNode.style.height=u+l;}},init:function p(r){this._super(r);var t=this.content;this.n=(r&&r.defn&&r.defn.n)||"";if(t&&t.getFormats()&&!this.getFormats()){this._createFormats();}},preBuildRendering:function B(){var t=this._ts=(this.floatingTitle)?f:j;if(this.isInFilterPanel()){var u=R.clone(this.formatHandlers);u.portletContainerNode=["z-index","height","B","backgroud-color"];u.shadowNode=["z-index","height","B","fx","background-color"];this.formatHandlers=u;}this._super();t.adjustTitleCss(this);var r="display:none;";if(!this.leftToolbar){this.leftToolbarNodeCssText+=r;}if(!this.toolbar){this.toolbarNodeCssText+=r;}var w=mstrmojo._Formattable.getBorderWidths(this);if(w.l||w.t||w.r){this.borderCss="has-border";}},postBuildRendering:function Y(){var w=mstrmojo.dom,AE=this.titleNode,AD=this.onclicktitle;if(this.floatingTitle&&this.titleNode){document.body.appendChild(this.titleNode);var x=mstrmojo.css,AA=this.contentNode,AB=this;if(!this._onhover){this._onhovertt=function(){x.addClass(AB.titleNode,["visible"]);AB._onflt=true;return true;};this._onhoverofftt=function(){x.removeClass(AB.titleNode,["visible"]);AB._onflt=false;return true;};this._onhover=function(){var AF=AB.titleNode;x.addClass(AF,["visible"]);var AG=w.position(AB.contentNode,true);AF.style.top=(AG.y-AF.clientHeight+2)+l;AF.style.left=AG.x+l;return true;};this._onhoveroff=function(){x.removeClass(AB.titleNode,["visible"]);return true;};}w.attachEvent(AA,"mouseover",this._onhover);w.attachEvent(AA,"mouseout",this._onhoveroff);w.attachEvent(AE,"mouseover",this._onhovertt);w.attachEvent(AE,"mouseout",this._onhoverofftt);}if(AE&&AD){w.attachEvent(AE,"click",AD);}if(this._super){this._super();}var z=this.getFormats();this.set("fc",z&&!z.height);if(this.isInFilterPanel()&&!this.isHorizFP()){var r=this.portletContainerNode.style,u=this.shadowNode.style,AC=this.parent;r.width=u.width="99%";r.top=u.top=AC.topStart+l;r.left=u.left=G+l;}else{if(this.isInFilterPanel()&&this.isHorizFP()){G=8;this.portletContainerNode.style.left=this.shadowNode.style.left=parseInt(z.left,10)+G*this.orgPos+l;}else{if(this.defn.ifp){this.adjustFPHeight2Fit();}}}if(this.buttonbarNode.clientHeight>0){this.buttonbarNode.style.height=this.buttonbarNode.clientHeight*this.model.getZoomFactor()+"px";}},adjustFPHeight2Fit:function(){var u=mstrmojo.dom,r=u.position(this.titleNode),t=u.position(this.contentNode).y-r.y-r.h;this.content.domNode.style.height=parseInt(this.defn.fmts.height,10)-t+"px";},unrender:function E(u){if(this.floatingTitle&&this.titleNode){var x=this.domNode,r=this.titleNode,w=mstrmojo.dom;if(x&&this._onhover){w.detachEvent(x,"mouseover",this._onhover);}if(x&&this._onhoveroff){w.detachEvent(x,"mouseout",this._onhoveroff);}if(r&&this._onhovertt){w.detachEvent(r,"mouseover",this._onhovertt);}if(r&&this._onhoverofftt){w.detachEvent(r,"mouseout",this._onhoverofftt);}if(r){document.body.removeChild(r);}}if(this._super){this._super(u);}},updateStyle:function(t,r){var x=this.shadowNode.style,u=this.containerNode.style;x.height=u.height=t;x.width=u.width=r;},_createFormats:function V(){var z=this.content&&this.content.getFormats(),w;w=z.p_fmts={};var r,x;for(r in Q){x=Q[r];if(z[x]!==undefined){w[x]=z[x];delete z[x];}}for(r in X){x=X[r];if(z[x]!==undefined){w[x]=z[x];}}z.height=this._ts.getContentHeight(z.height,w);if(mstrmojo.dom.isIE&&w.fx&&w.fx.ds&&!w["background-color"]){w["background-color"]="#ffffff";}var u=w.ttl,t=u&&u["background-color"];if(t){this.titlebarNodeClass=mstrmojo.color.getContrastingColor(t,"light","dark");}},refresh:function q(){if(!this.hasRendered){return ;}var t=this.children,r;for(r=t.length-1;r>=0;r--){t[r].refresh();}},isInFilterPanel:function L(){return(h.call(this)!==null);},isHorizFP:function(){if(this.isInFilterPanel()){var r=this.getFilterPanel();return r&&r.defn&&parseInt(r.defn.fds,10)===2;}return false;},getFilterPanel:function H(){return h.call(this);},getContainerHeight:function c(){return this.containerNode.clientHeight;},relocate:function C(r){if(this.isInFilterPanel()&&!this.isHorizFP()){this.portletContainerNode.style.top=this.shadowNode.style.top=r+l;}},setInfoWindowDimensions:function n(x){var t=this.domNode.style,r=this.shadowNode.style,u=this.portletContainerNode.style,w=mstrmojo._Formattable.getBorderWidths(this);x.h-=w.h;x.w-=w.w;r.height=u.height=t.height=x.h+l;r.width=u.width=t.width=x.w+l;x.h-=this.titleNode.offsetHeight;this.toolbarNode.style.display="none";},addDirtyKey:function K(r){A.call(this,"add",r);},removeDirtyKey:function J(r){A.call(this,"remove",r);},setDirtyChildren:function Z(){var r=this.content;if(r&&r.setDirtyChildren){r.setDirtyChildren.apply(r,arguments);}}});var W=0,O=1,k=2;function N(r){var t=this.content.defn;if(t){t.set("ds",r);}}function m(r){return{FormattingOrder:{ZIndex:this.getFormats()["z-index"]},FormattingView:{WindowState:r}};}function a(AF,AD,r,AG){var AC=this.content,AE=AC.k,AB=mstrmojo.boxmodel.px2Inches,u=AC.model.docModel||AC.model,AI=u.getZoomProps(),x=this.getFormats(),t=AD!==undefined&&r!==undefined,AH={},z=this,AA=m.call(this,AF);if(t){AA.FormattingSize={OldHeight:AB(AI,AD),OldWidth:AB(AI,r),Height:AB(AI,parseInt(x.height,10)),Width:AB(AI,parseInt(x.width,10))};}AH.success=function(w){var AJ=w&&w.data;if(AJ){u.loadPartialData(AJ,AE);}N.call(z,AF);var AK=z.parent;if(AK.adjustSectionSize&&t){AK.adjustSectionSize();}};u.updateUnitFormat(AC,1,AA,AH,{params:{suppressData:true},config:t?null:{silent:true},preserveUndo:true});if(!t&&!(AG&&AG.all)){u.saveRWProps(AE,props,1,this.loadDataOnResize,AH,true);}}function T(){var AA=this.content;if(!AA){return ;}var x=function(AE){mstrmojo.array.forEach(AE,function(AF){if(AF.ds!==undefined){AF.set("visible",(AF.ds!==AA.defn.ds));}});},AB;if(this.isInFilterPanel()){var u=(parseInt(this.defn.ds,10)===W);AA.set("visible",u);this.updateContentHeight(!u);AB=this.leftToolbar;x(AB&&AB.children);var w=this.parent;if(w.refreshFP){w.refreshFP();}}else{var r=AA.getFormats(),AC=this.getFormats(),t=this.portletContainerNode.style,AD=this.shadowNode.style,z=this.contentNode.firstChild.style;z.height=r.height;z.width=r.width;AD.height=t.height=AC.height;AD.width=t.width=AC.width;AD.top=t.top=AC.top;AD.left=t.left=AC.left;if(AC["z-index"]!==undefined){AD.zIndex=t.zIndex=AC["z-index"];}AB=this.rightToolbar;x(AB&&AB.children);if(AA.resize){AA.resize();}}}mstrmojo.DocResizablePortlet=mstrmojo.declare(mstrmojo.DocPortlet,null,{scriptClass:"mstrmojo.DocResizablePortlet",loadDataOnResize:false,_createFormats:function V(){this._super();var t=this.getFormats();var r=parseInt(this.defn.ds,10);if(r===W){t.normHeight=t.height;t.normWidth=t.width;if(t["z-index"]!==null&&t["z-index"]!==undefined){t.normZIndex=t["z-index"];}}if(r!==k){t.normTop=t.top;t.normLeft=t.left;}},onmaximize:function e(){var w=this.parent,AA=this.content,z=AA&&AA.getFormats(),u=this.getFormats(),t=u.height,r=u.width,x=mstrmojo._Formattable.getBorderWidths(this);this.clearCache();AA.clearCache();u.height=(parseInt(w.getHeight(),10)-x.h)+l;z.height=this._ts.getContentHeight(u.height,u);u.width=z.width=(w.getWidth()-x.w)+l;u.top=u.left=0;u["z-index"]=w.getMaxZIndex()+1;a.call(this,k,t,r);},onminimize:function b(){var z=this.content,t=z.dimNode||z.domNode,x=z&&z.getFormats(),w=this.getFormats(),u=w.height||t.offsetHeight,r=w.width;this.clearCache();z.clearCache();w.width=x.width=w.normWidth;w.top=w.normTop;w.left=w.normLeft;if(w.normZIndex!==null&&w.normZIndex!==undefined){w["z-index"]=w.normZIndex;}x.height=0;w.height=this._ts.getPortletMinHeight(w);a.call(this,O,u,r);},onrestore:function S(){var x=this.content,w=x&&x.getFormats(),u=this.getFormats(),t=u.height,r=u.width;this.clearCache();x.clearCache();u.height=u.normHeight;w.height=this._ts.getContentHeight(u.height,u);u.width=w.width=u.normWidth;u.top=u.normTop;u.left=u.normLeft;if(u.normZIndex!==null&&u.normZIndex!==undefined){u["z-index"]=u.normZIndex;}a.call(this,W,t,r);},changeWindowState:function I(u){N.call(this,u);var t=this.content,x=m.call(t,u),r=t.model.docModel||t.model;return r.getUnitFormatAction(t,1,x);},oncollapse:function U(r){a.call(this,O,undefined,undefined,r);},onexpand:function D(r){a.call(this,W,undefined,undefined,r);},adjustFP:function g(){var t=(parseInt(this.defn.ds,10)===W);this.content.set("visible",t);this.updateContentHeight(!t);var r=this.parent;if(r.refreshFP){r.refreshFP();}},postBuildRendering:function Y(){if(!this._sub_dsChange){this._sub_dsChange=this.defn.attachEventListener("dsChange",this.id,T);}this._super();if(this.isInFilterPanel()){var r=(parseInt(this.defn.ds,10)===W);this.updateContentHeight(!r);}}});mstrmojo.DocPortlet.ST_RESTORE=W;mstrmojo.DocPortlet.ST_MAX=k;mstrmojo.DocPortlet.ST_MIN=O;}());(function(){mstrmojo.requiresCls("mstrmojo.Dialog","mstrmojo.Button");mstrmojo.requiresDescs(1442,3610,11581,11582);var E=mstrmojo.css,A="on",D=mstrmojo.desc(11581,"Click for more details"),B=mstrmojo.desc(11582,"Collapse");mstrmojo.qb.QBAlertDialog=mstrmojo.declare(mstrmojo.Dialog,null,{scriptClass:"mstrmojo.qb.QBAlertDialog",cssClass:"mstrmojo-qb-AlertDialog",title:mstrmojo.desc(3610),genericMsg:"",detailedMsg:"",width:"475px",isExpanded:false,buttons:[mstrmojo.Button.newInteractiveButton(mstrmojo.desc(1442),function(H){var I=this.parent.parent;I.destroy();if(I.callback){I.callback();}},"#666666")],children:[{scriptClass:"mstrmojo.Label",alias:"genericLabel",text:"",cssClass:"mstrmojo-qb-alertdialog-genericlabel"},{scriptClass:"mstrmojo.Label",alias:"expandButton",text:"",cssClass:"mstrmojo-qb-alertdialog-expandbutton",cssDisplay:"",onclick:function C(H){var I=this.parent;I.isExpanded=!I.isExpanded;I.expandButton.set("text",I.isExpanded?B:D);E.toggleClass(I.detailedLabel.domNode,A,I.isExpanded);}},{scriptClass:"mstrmojo.Label",alias:"detailedLabel",text:"",cssClass:"mstrmojo-qb-alertdialog-detailedlabel",cssDisplay:""}],postBuildRendering:function F(){if(this._super){this._super();}this.isExpanded=false;this.genericLabel.set("text",this.genericMsg);this.detailedLabel.set("text",this.detailedMsg||"");this.expandButton.set("text",D);E.toggleClass(this.expandButton.domNode,A,!!this.detailedMsg);}});mstrmojo.qb.old_alert=function G(I,M,O,N,J){var H="mstr-qb-alert",P,K={id:H,zIndex:1000};try{mstrmojo.all[H].destroy();}catch(L){}if(J){mstrmojo.hash.copy(J,K);}P=new mstrmojo.qb.QBAlertDialog(K);P.title=N||mstrmojo.desc(3610);P.genericMsg=I;P.detailedMsg=M;P.callback=O;P.render();};mstrmojo.qb.alert=function G(H,L,K,J,I){if(mstrApp.isBISource){mstrApp.getRootController().handleServerRequestError(H,L,K,J);}else{mstrmojo.DI.controller.DIDialogController.showErrorDialog(H,L,K,J,I);}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.fx","mstrmojo.Dialog","mstrmojo.Label","mstrmojo._IsPopup","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ui._HasUITheme","mstrmojo.Button","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.tooltip","mstrmojo.ui.editors.ErrorDialogContent");var h=mstrmojo.func.composite,M=mstrmojo.dom,Z=mstrmojo.Button.newWebButton,C=mstrmojo.css,Y=mstrmojo.all,N=mstrmojo.hash,W=mstrmojo.array;function V(o){if(!this.modal){return ;}var p=window.mstrApp;if(p&&p.modalEditorChange){p.modalEditorChange(this.id,o);}}mstrmojo.Editor=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsPopup,mstrmojo._HasPopup,mstrmojo._IsMovable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.Editor",title:"",help:"",autoClose:false,showTitle:true,openEffect:null,themeClassName:"mojo-theme-light",useRichTooltip:true,closeEffect:null,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mouseup,mousedown,click,contextmenu>{@titlebarHTML}<div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',titleMarkupString:'<div class="mstrmojo-Editor-title-container"><div class="mstrmojo-Editor-title"></div><div class="edt-title-btn mstrmojo-Editor-help" tooltip="'+mstrmojo.desc(1143,"help")+'"></div><div class="edt-title-btn mstrmojo-Editor-close" tooltip="'+mstrmojo.desc(2102,"Close")+'"></div></div><div class="mstrmojo-Editor-titleSpacer"></div>',markupSlots:{editorNode:function X(){return this.domNode.firstChild;},titlebarNode:function k(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},titleNode:function R(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},helpNode:function l(){return this.showTitle?this.domNode.firstChild.firstChild.children[1]:null;},closeNode:function E(){return this.showTitle?this.domNode.firstChild.firstChild.lastChild:null;},containerNode:function S(){return this.domNode.firstChild.childNodes[2];},buttonNode:function I(){return this.domNode.firstChild.childNodes[3];},curtainNode:function m(){return this.domNode.lastChild;}},markupMethods:{ontitleChange:function(){if(this.showTitle){this.titleNode.innerHTML=this.title;}},onzIndexChange:function(){var o=this.zIndex;this.editorNode.style.zIndex=o;this.curtainNode.style.zIndex=o-1;},onvisibleChange:function(r){if(r){return ;}var q=this.visible,p="closeEffect",o="none";if(q){p="openEffect";o="block";}if(this[p]){this.playEffect(p);}else{this.editorNode.style.display=o;if(this.modal){this.curtainNode.style.display=o;}}},onhelpChange:function d(){if(this.showTitle){var p=this.help,o=this.helpNode;if(!p){o.style.display="none";}else{o.style.display="block";}}},onleftChange:function F(){this.editorNode.style.left=this.left||"";},ontopChange:function H(){this.editorNode.style.top=this.top||"";}},open:function Q(p,o){this._super(p,o);V.call(this,true);},close:function f(o){this._super(o);V.call(this,false);},unrender:function B(o){this._super(o);V.call(this,false);},destroy:function g(o){this._super(o);V.call(this,false);},preBuildRendering:function A(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));this._curtain_to_body=true;V.call(this,true);}this.titlebarHTML=(this.showTitle)?this.titleMarkupString:"<div></div><div></div>";return this._super();},getMovingHandle:function j(){return this.titlebarNode;},getMovingTarget:function U(){return this.editorNode;},onPreClose:function G(){this.hideTooltip();return true;},premousedown:function P(o){var p=o.getTarget();if(p===this.closeNode||p===this.helpNode){C.toggleClass(p,"active",true);}},premouseup:function O(o){var p=o.getTarget();if(p===this.closeNode||p===this.helpNode){C.toggleClass(p,"active",false);}if(o.getTarget()===this.closeNode&&this.onPreClose()){this.close();}},onclick:function c(p){if(p.getTarget()===this.helpNode){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(this.help);}else{var o=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");window.open(o+(this.help||""),"_blank");return false;}}},_set_visible:function b(u,q){var p=(this[u]!==q);if(p){this[u]=q;var t=this._close_handler;if(q){if(this._curtain_to_body){this.resizeDialog();this.positionDialog();}if(this.autoClose){var r=this;t=this._close_handler=t||function(w){var x=M.eventTarget(self,w);if(x&&x.parentNode&&!M.contains(r.editorNode,x,true,document.body)){r.close();}};M.attachEvent(document.body,"mousedown",t);}}else{var o=this._curtain_handler;if(o){M.detachEvent(window,"resize",o);}if(t){M.detachEvent(document.body,"mousedown",t);}}}return p;},showTooltip:function n(w,u){var r=this,p=M.findAncestorByAttr(M.eventTarget(u,w),"tooltip",true,this.domNode),q=p&&p.value;if(!r.hasOpenTooltip&&q){var o=M.position(p.node);r.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:q,top:Math.max(o.y+40,0),left:Math.max(o.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER};this._super(w,u);}}});mstrmojo.Editor.openEffect_fadeIn={scriptClass:"mstrmojo.fx.AnimateProp",slot:"curtainNode",props:{backgroundColor:{start:255,stop:0,fn:function(o){o=Math.round(o);return["rgb(",o,",",o,",",o,")"].join("");}}},preStart:function(){var p=this.target,o=this.widget;o.editorNode.style.display="block";if(!o.modal){return false;}p.style.display="block";C.setOpacity(p,60);return true;}};mstrmojo.Editor.closeEffect_fadeOut={scriptClass:"mstrmojo.fx.FadeOut",slot:"curtainNode",start:0.6,stop:0,preStart:function(){var o=this.widget;o.editorNode.style.display="none";return !!o.modal;}};function D(o){return function(){Y[o].destroy();};}function J(p,z,AA,AB){var o=z.id||"mojoAlertx9",u,x=z.buttons;W.forEach(x,function(AD){var AC=AD.onclick;AD.onclick=function(AE){var AF=Y[o];if(AC&&AC.call(AD,AE)===false){return ;}AF.destroy();AF=null;};});try{Y[o].destroy();}catch(w){}var q=z.cssClass,r=[];if(q){r.push(q);delete z.cssClass;}if(AB){r.push(AB);}r.push("mstrmojo-alert");u={scriptClass:"mstrmojo.Editor",id:o,width:"475px",zIndex:1000,title:AA||mstrmojo.desc(11812,"Notification"),cssClass:r.join(" "),children:[{scriptClass:"mstrmojo.Label",cssClass:"alert-content",text:p,allowHTML:z.allowHTML}],visible:true};var t=new mstrmojo.Editor(N.copy(z,u));t.render();return t;}if(window.mstrConfig&&!window.mstrConfig.simpleDialog){mstrmojo.notify=function L(p,x,q){q=q||{};var z=q.forceClose,w=q.callback||mstrmojo.emptyFn,u=N.copy(x||{},{buttons:z?[mstrmojo.Button.newActionButton((q.buttonText||mstrmojo.desc(8607,"Dismiss")),w)]:null,showTitle:false,modal:false,top:"42px"}),r=q.duration||6000;var t=J(p,u,"",z?"ed-notify":"ed-toast"),o=t.id;if(!z){window.setTimeout(h([w,D(o)]),r);}else{window.setTimeout(function(){if(Y[o]){Y[o].editorNode.style.opacity=0.75;}},6000);}return t;};mstrmojo.confirm=function e(u,p,t){p=p||{};var o=p.confirmBtn||{},r=p.cancelBtn||{},q=[Z(o.t||mstrmojo.desc(219,"Yes"),o.fn,true),Z(r.t||mstrmojo.desc(218,"No"),r.fn)];return J(u,N.copy(t||{},{buttons:q,onPreClose:function(){if(r&&r.fn){r.fn();}return true;}}));};mstrmojo.warn=function K(q,o,p){p=p||{};p.cssClass=(p.cssClass||"")+" mstrmojo-warning";mstrmojo.confirm(q,o,p);};mstrmojo.alert=function a(u,q,t,w,o,r){var p={title:t,zIndex:w,cssClass:o,buttons:[Z(mstrmojo.desc(1442,"OK"),q,true)],onPreClose:function(){if(q){q();}return true;}};N.forEach(p,function(z,x){if(!z){delete p[x];}});return J(u,N.copy(r,p));};mstrmojo.error=function T(t,o,r){var p=t||{};var q=mstrmojo.desc(96,"Error");if(r){q=(r.title)?r.title:mstrmojo.desc(96,"Error");}J("",N.copy(r||{},{buttons:[Z(mstrmojo.desc(1442,"OK"),o,true)],children:[{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",shortDesc:p.shortDesc,longDesc:p.longDesc}]}),q);};}mstrmojo.Editor.ButtonConfigType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo._HasPopup","mstrmojo.string","mstrmojo.Pulldown","mstrmojo.Container");var C=mstrmojo.css;mstrmojo.CustomGroupEl=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.CustomGroupEl",markupString:'<div id="{@id}" class="mstrmojo-onhoverparent mstrmojo-CustomGroupEl {@cssClass}" style="{@cssText}" mstrAttach:mouseover><div class="mstrmojo-CustomGroupEl-title {@cssClass}" mstrAttach:click><img class="mstrmojo-CustomGroupEl-state {@cssClass}" src="../images/1ptrans.gif" align="absmiddle" onclick="var w = mstrmojo.all[\'{@id}\']; w.set(\'state\', !w.state)" /><span class="mstrmojo-text"></span></div><div class="mstrmojo-onhover mstrmojo-abs mstrmojo-topright mstrmojo-CustomGroupEl-tools {@cssClass}"><img class="mstrmojo-dup" src="../images/1ptrans.gif" title="'+mstrmojo.desc(3397,"Duplicate")+'" onclick="mstrmojo.all[\'{@id}\'].dup()" /><img class="mstrmojo-ops" src="../images/1ptrans.gif"onclick="var w = mstrmojo.all[\'{@id}\'].showOps();" title="'+mstrmojo.desc(7932,"Element display options")+'" /><img class="mstrmojo-del" src="../images/1ptrans.gif" onclick="mstrmojo.all[\'{@id}\'].del()" title="'+mstrmojo.desc(7933,"Delete element")+'"/></div><div class="mstrmojo-CustomGroupEl-details {@cssClass}"><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr-tools {@cssClass}"></div></div></div>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},titleNode:function(){return this.domNode.firstChild.lastChild;},detailsNode:function(){return this.domNode.lastChild;},exprNode:function(){return this.domNode.lastChild.firstChild;},exprToolsNode:function(){return this.domNode.lastChild.lastChild;},titlebarNode:function(){return this.domNode.firstChild;}},markupMethods:{ondataChange:function(){var G=this.data,F=G&&G.n;this.titleNode.innerHTML=(F!=null)?mstrmojo.string.encodeHtmlString(F):"";},onstateChange:function(){var F=this.stateNode;F.className="mstrmojo-CustomGroupEl-state "+(this.state?"opened":"closed");this.detailsNode.style.display=this.state?"block":"none";},onselectedChange:function(){C.toggleClass(this.domNode,["selected"],this.selected);},onshowaddChange:function(){this.exprToolsNode.style.display=this.showadd?"block":"none";}},_set_data:function A(H,F){var G=this.data;this.data=F;this.set("expr",F&&F.expr);return G!==F;},optionsRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(7934,"Element Options"),contentNodeCssClass:"mstrmojo-balloon",cssClass:"mstrmojo-CGEOptionsEditor",help:"element_options_dialog_box.htm",ce:false,isp:false,onOpen:function(){var F=this.opener.data,G=this.ops.dsplb.dspl;G.set("value",F.ce?2:(F.isp?1:0));},save:function(){var F=this.ops.dsplb.dspl.value,G=this.opener.data;G.ce=(F==2);G.isp=(F==1);this.close();},children:[{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-ElementOptions",alias:"ops",children:[{scriptClass:"mstrmojo.HBox",alias:"dsplb",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(168,"Display:"),cssText:"margin: 0 5px;"},{alias:"dspl",scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:[{n:mstrmojo.desc(7935,"Display element name only (Default)"),v:0},{n:mstrmojo.desc(7936,"Display individual items only"),v:1},{n:mstrmojo.desc(7937,"Display element name and individual items"),v:2}]}]},{scriptClass:"mstrmojo.HBox",alias:"btns",cssText:"float:right;width:150px;margin:5px;",children:[{scriptClass:"mstrmojo.HTMLButton",alias:"ok",text:mstrmojo.desc(118,"Save"),cssClass:"mstrmojo-Editor-button",cssText:"width:72px;",onclick:function(){this.parent.parent.parent.save();}},{scriptClass:"mstrmojo.HTMLButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-Editor-button",cssText:"width:72px;margin: 5px;",onclick:function(){this.parent.parent.parent.close();}}]}]}]},showOps:function(){var G=this.titlebarNode,F=mstrmojo.dom.position(G,true);this.openPopup("optionsRef",{zIndex:30,left:Math.round(F.x+F.w-300)+"px",top:Math.round(F.y+F.h)+"px"});},init:function E(F){this._super(F);var G=this.data;if(G){delete this.data;this._set_data(null,G);}},del:function B(){var F=this.parent;if(F&&F.remove){F.remove(this.data);}},dup:function D(){var F=this.parent;if(F&&F.duplicate){var K=this.data,L=F.items,N=K.did,M=1,O=new RegExp(K.n+"_(\\d+)");for(var I=0,J=L.length;I<J;I++){var H=L[I],G=H.n&&H.n.match(O);if(G){M=Math.max(M,G[1]);}N=Math.max(N,parseInt(H.did,10));}F.duplicate(this.data,null,{n:mstrmojo.desc(3651,"Copy of ##").replace("##",K.n),did:F.getNextId(),state:1});}},onmouseover:function(F){this.set("showadd",this.state?true:false);}});})();(function(){var F=mstrmojo.string;function H(Q,R,K){var L,O,J,M=[],N,S;try{N=new RegExp(mstrmojo.string.regEscape(Q),"i");}catch(P){return M;}for(L=0,O=R.length;L<O;L++){J=R[L][K];N.lastIndex=0;if(N.test(J)){M.push(R[L]);}}return M;}function C(){if(this.searchEnabled){this.iconNode.style.display="none";this.inputBar.style.display="";if(this.autofocus){this.inputNode.focus();this.inputNode.select();}}else{this.hideInputNode();if(this.autofocus){if(mstrmojo.dom.isIE7||mstrmojo.dom.isIE8){var J=this;window.setTimeout(function(){try{J.iconNode.focus();}catch(K){}},100);}else{this.iconNode.focus();}}}}var G={8:"BackSpace",9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};mstrmojo.SearchableDropDownList=mstrmojo.declare(mstrmojo.Pulldown,null,{scriptClass:"mstrmojo.SearchableDropDownList",markupString:'<div id="{@id}" class="mstrmojo-SearchableDropDownList mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}"><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" tabindex="0" mstrAttach:mousedown,keyup>{@text}</div><table class="mstrmojo-InputNodeBar"><colgroup><col class="inputCol"/><col class="iconCol"/></colgroup><tr><td><input class="mstrmojo-SearchableDropDownList-inputNode" value="{@text}" placeholder="{@placeholderText}" mstrAttach:keyup,blur,click/></td><td><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" mstrAttach:mousedown></div></td></tr></table></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupSlots,{inputBar:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.firstChild.lastChild.rows[0].cells[0].firstChild;}}),markupMethods:mstrmojo.hash.copy({ontextChange:function(){this.iconNode.innerHTML=F.decodeHtmlString(this.text);this.inputNode.value=this.text;},onheightChange:function(){var J=parseInt(this.height,10);if(J>=0){this.domNode.style.height=J+"px";this.inputBar.style.height=J+"px";}}},mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupMethods)),popupToBody:true,searchEnabled:false,selectedIndex:-1,placeholderText:"",allItems:null,autofocus:true,focus:function(){C.call(this);},hideInputNode:function B(){this.inputBar.style.display="none";this.iconNode.style.display="block";},postBuildRendering:function A(){if(!this.allItems){this.allItems=this.items;}this._super();C.call(this);},clickInput2pop:false,onclick:function I(J){if(this.clickInput2pop){this.togglePopup();}},prekeyup:function E(R){var K=this.getSearchPattern(),P=[],M,Q=this.inputNode,O=R.e,J,L,N=this.items.length;if(G[O.keyCode]==="Enter"){if(this.items.length>0){this.set("selectedIndex",this.selectedIndex===-1?0:this.selectedIndex);}this.onEnter&&this.onEnter();this.closePopup();return ;}else{if(G[O.keyCode]==="Esc"){this.onEsc&&this.onEsc();if(this.popupRef.visible){this.popupRef.close();}return ;}else{if(G[O.keyCode]==="ArrowDown"){if(!this.popupRef.visible){this.togglePopup();}this.set("selectedIndex",(this.selectedIndex+1)%N);}else{if(G[O.keyCode]==="ArrowUp"){if(this.popupRef.visible&&N>0){this.set("selectedIndex",(this.selectedIndex+N-1)%N);}}else{if(this.searchEnabled){if(K&&K.length>0&&K.indexOf(this.lastSearchPattern)>-1){P=H(K,this.items,this.itemField);}else{P=H(K,this.allItems,this.itemField);}this.set("selectedIndex",-1);this.set("items",P);N=P.length;if(N===0){this.closePopup();}else{if(!this.popupRef.visible){this.togglePopup();}}if(K&&K.length>0){this.set("selectedIndex",mstrmojo.array.find(P,this.itemField,Q.value));}}}}}}this.lastSearchPattern=K;},getSearchPattern:function D(){return F.trim(this.inputNode.value);}});}());(function(){mstrmojo.requiresCls("mstrmojo.OBList","mstrmojo.ui._IsIncFetchList","mstrmojo.ui._HasScroller");var F=mstrmojo.array,A=mstrmojo.chart.model.enums.EnumDSSObjectType;function D(G){return{browseConfig:null,parent:G,next:function(J){var I=this.browseConfig;if(!I){return ;}I.blockBegin+=I.blockCount;var H={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockBegin:I.blockBegin,blockCount:I.blockCount,includeAncestorInfo:true};if(I.folderLinksContextId){H.folderLinksContextId=I.folderLinksContextId;}if(I.includeObjectDesc){H.includeObjectDesc=I.includeObjectDesc;}if(I.rootFolderID){H.rootFolderID=I.rootFolderID;}else{if(I.rootFolderType){H.rootFolderType=I.rootFolderType;}}if(I.browsableTypes){H.objectType=I.browsableTypes;}if(I.searchPattern){H.searchPattern=I.searchPattern;if(I.recursive){H.recursive=I.recursive;}}this.parent.set("waiting",true);if(I.dataProvider){I.dataProvider.serverRequest(H,J);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,J,H);}},hasNext:function(){var H=this.browseConfig;return(H.blockBegin+H.blockCount-1)<H.totalSize;}};}mstrmojo.mstr.ui.IncFetchOBList=mstrmojo.declare(mstrmojo.OBList,[mstrmojo.ui._IsIncFetchList,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.mstr.ui.IncFetchOBList",cssClass:"mstrmojo-OBList mstrmojo-IF-OBList",makeObservable:true,renderOnScroll:false,waiting:false,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keypress,mousedown,mouseup,dblclick><div class="scroll-box" style="{@scrollBoxCssText}"><div class="mstrmojo-ListBase2-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onwaitingChange:function(){this.onwaitingChange();}},init:function E(G){if(this._super){this._super(G);}this.ifDataHelper=D(this);if(G.browseConfig){this.ifDataHelper.browseConfig=G.browseConfig;}},onwaitingChange:mstrmojo.emptyFn,addItems:function B(G){var H=this.browseConfig.browsableViewMedias;if(G&&H){var I={};F.forEach(H.split(","),function(J){I[parseInt(J,10)]=true;});G=F.filter(G,function(J){return(J.t!==A.DssTypeDocumentDefinition)||I[J.dvm];});}this.add(G,-1);this.set("waiting",false);if(this._super){this._super(G);}if(this.scrollNode){this.updateScrollbars();}},setupScrollNodes:function C(){this.scrollNode=this.scrollboxNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Arr","mstrmojo.Button","mstrmojo.HBox","mstrmojo.FishEye");var A=function(B){return mstrmojo.hash.copy(B,{scriptClass:"mstrmojo.Button",text:"",enabled:false,dir:"left",cssClass:"mstrmojo-icon left",onclick:function(){var D=this.parent.fishEyeList,C=D&&D.scroll(this.dir,D.step);}});};mstrmojo.FishEyeContainer=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.FishEyeContainer",cssClass:"mstrmojo-FishEyeContainer",selectedIndex:-1,setItems:function(B){this.fishEyeList.set("items",B);},setSelectedIndex:function(B){this.fishEyeList.set("selectedIndex",B);},scrollable:false,rightScrollbale:false,children:[A({bindings:{enabled:"!!this.parent.scrollable"}}),({scriptClass:"mstrmojo.FishEye",alias:"fishEyeList",items:mstrmojo.Arr.makeObservable([]),srcId:"obList"}),A({alias:"feScrollRight",cssClass:"mstrmojo-icon right",dir:"right",bindings:{enabled:"!!this.parent.rightScrollable"}})]});mstrmojo.css=mstrmojo.hash.copy({getStyleValue:function(D,E){var B=null;if(D.currentStyle){E=(E==="float"?"styleFloat":E);B=D.currentStyle[E];}if(document.defaultView&&document.defaultView.getComputedStyle){E=(E==="float"?"cssFloat":E);var C=document.defaultView.getComputedStyle(D,null);B=C?C[E]:null;}return B;},setStyleValue:function(D,F,E){var B=function(G){return !!(G&&(typeof G==="object")&&(typeof G.length==="number"));};if(B(F)&&B(E)){var C;for(C in F){D.style[F[C]]=E[C];}}else{D.style[F]=E;}}},mstrmojo.css);}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.dom","mstrmojo.TreeNodeSelector");var B=mstrmojo.dom,A={0:"closed",1:"opened",2:"leaf"};mstrmojo.TreeNode=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.TreeNode",markupString:'<li id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseover><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><ul class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</ul></li>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);},onstateChange:function(){this.stateNode.className="mstrmojo-TreeNode-state "+(A[this.state]||"closed");this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},onselectedChange:function(){var D=this.selected?"addClass":"removeClass";mstrmojo.css[D](this.domNode.firstChild,["selected"]);},ondropCuePosChange:mstrmojo.WidgetList.prototype.markupMethods.ondropCuePosChange},renderOnScroll:false,listSelector:mstrmojo.TreeNodeSelector,premousedown:function C(D){var E=this._super(D),F=B.eventTarget(D.hWin,D.e);if(F===this.stateNode){if(this.state!==2){this.set("state",this.state===1?0:1);}}return E;},preclick:function(D){mstrmojo.dom.stopPropogation(D.hWin,D.e);},prechange:function(D){var E=this._super(D);if(E!==false){var F=this.tree;if(F&&F.onnodechange){F.onnodechange(D);}}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dnd","mstrmojo.ui._HasScroller");function Z(f){var h=document.createElement("div"),g=h.style,e=f.domNode;h.className="mstrmojo-DataGrid-avatar";g.height=e.clientHeight+"px";e.appendChild(h);f.avatar=h;return h;}function Q(e){var f=mstrmojo.dom.position(e.domNode,true);return f.x;}function O(e){return'<div class="mstrmojo-DataGrid-resizeHandle" unselectable="on" onselectstart="return false" rh="'+e+'"></div>';}function b(g){var f=g.getAttribute("rh"),e=f&&parseInt(f,10);return e;}function Y(f,j,e){var h=e.src,k=h&&h.data,g=k&&k.resizingIdx;if(!(g&&g>0)){return j&&j.apply(f,[e]);}}mstrmojo.RESIZE_NEXT_COLUMN_MODE={getRange:function G(h,g){var e=h.colSizeArray;var f=[-e[g-1]+h.minColWidth,(g==e.length-1)?e[g]-h.resizeHandleWidth-h.minColWidth:e[g]-h.minColWidth];return f;},updateSize:function F(h,g,f){var e=h.colSizeArray;e[g-1]=e[g-1]+f;e[g]=e[g]-f;},updateColumnWidth:function T(h,f,j,g){var e=h.colSizeArray;f[g-1].style.width=e[g-1]+"px";j[g-1].style.width=e[g-1]+"px";f[g].style.width=e[g]+"px";j[g].style.width=e[g]+"px";}};mstrmojo.RESIZE_ALL_COLUMN_MODE={getRange:function G(k,j){var l=k.minColWidth+k.resizeHandleWidth,e=k.colSizeArray,g=0;for(var h=j;h<e.length;++h){g+=e[h]-l;}var f=[-e[j-1]+l,g];return f;},updateSize:function F(h,m,f){var l=h.minColWidth+h.resizeHandleWidth,j=h.colSizeArray;j[m-1]=j[m-1]+f;var e=[];for(var g=0;g<j.length-m;++g){e[g]=m+g;}e.sort(function(o,p){return j[o]-j[p];});for(var g=0;g<e.length;++g){var n=f/(e.length-g);var k=j[e[g]];f-=(k>=n+l)?n:k-l;j[e[g]]=(k>=n+l)?k-n:l;}},updateColumnWidth:function T(j,f,k,h){var e=j.colSizeArray;for(var g=h-1;g<e.length;++g){f[g].style.width=e[g]+"px";k[g].style.width=e[g]+"px";}}};mstrmojo._CanResizeColumn=mstrmojo.provide("mstrmojo._CanResizeColumn",{draggable:true,dropZone:false,avatar:null,colSizeArray:null,resizableColumns:true,resizeHandleWidth:10,minColWidth:5,resizeColumnBehavior:mstrmojo.RESIZE_NEXT_COLUMN_MODE,createColSizeArray:function c(){var f,k,h,g,j,e;k=this.headerContainerNode;h=k&&k.getElementsByTagName("table")[0];g=h.rows[0].cells;f=[];for(j=0,e=g.length;j<e;j++){f.push(g[j].offsetWidth);}return f;},postBuildRendering:function V(){if(this._super){this._super();}if(this.avatar){this.domNode.appendChild(this.avatar);}this.colSizeArray=null;},getDragData:function E(e){var g=e.src,h=g.node,f=b(h);if(f&&f>0){return{resizingIdx:f,startingX:g.pos.x,baseX:Q(this)};}if(this._super){return this.dropZone&&this._super(e);}return null;},allowDrop:function K(e){var g=e.src,h=g&&g.data,f=h&&h.resizingIdx;if(f&&f>0){return true;}return this.dropZone;},ondragenter:function R(e){Y(this,this._super,e);},ondragover:function S(e){Y(this,this._super,e);},ondragleave:function B(e){Y(this,this._super,e);},ondrop:function W(e){Y(this,this._super,e);},isDragValid:function C(e){var g=e.src,h=g&&g.data,f=h&&h.resizingIdx;if(f&&f>0){return true;}if(this._super){return this._super(e);}return false;},ondragstart:function X(e){var h=e.src,j=h&&h.data,g=j&&j.resizingIdx;if(g&&g>0){var f=this.avatar||Z(this);this.ownAvatar=true;f.style.left=(j.startingX-j.baseX)+"px";f.style.display="block";document.body.style.cursor="col-resize";if(!this.colSizeArray){this.colSizeArray=this.createColSizeArray();this._firstTimeResize=true;}j.resizingRange=this.resizeColumnBehavior.getRange(this,g);return ;}if(this._super){this._super(e);}},ondragmove:function P(f){var n=f.src,g=n&&n.data,l=g&&g.resizingIdx;if(l&&l>0){var m=f.tgt,h=this.avatar,k=g.resizingRange,j=m.pos.x-g.startingX,e=Math.min(k[1],Math.max(j,k[0]));g.deltaX=e;if(h){h.style.left=(g.startingX-g.baseX+e)+"px";}}else{if(this._super){this._super(f);}}},ondragend:function L(j){var q=j.src,k=q&&q.data,o=k&&k.resizingIdx;if(o&&o>0){var e=this.titleColGroup,p=e&&e.childNodes,m=this.dataColGroup,n=m&&m.childNodes,h=p.length,l=this.colSizeArray,f=k.deltaX;this.resizeColumnBehavior.updateSize(this,o,f);if(this._firstTimeResize){var g;for(g=0;g<h;g++){p[g].style.width=l[g]+"px";n[g].style.width=l[g]+"px";}this._firstTimeResize=false;}else{this.resizeColumnBehavior.updateColumnWidth(this,p,n,o);}this.avatar.style.display="none";document.body.style.cursor="";this.ownAvatar=false;}else{if(this._super){this._super(j);}}}});mstrmojo.requiresCls("mstrmojo._CanResizeColumn","mstrmojo.ListMapperTable","mstrmojo.WidgetList");function J(g){var k=document.createElement("colgroup"),e=g.length,f,j;for(j=0;j<e;j++){var h=document.createElement("col");f=g[j];if(f.colWidth){h.style.width=f.colWidth+"px";}h.className=f.colCss||("col"+j);k.appendChild(h);}return k;}function I(f){var g=f._headerWidgets_,e=g&&g.length;if(e>0){var h;for(h=0;h<e;h++){g[h].destroy(true);}}}function A(j,e,h,l,f){var g=[],k=j.headerWidget;h=h?(" "+h):"";l=l||this._headerWidgets;f=f?(" "+f):' w="1"';g.push("<td"+h+">");if(e>0&&this.resizableColumns){g.push(O(e));}g.push('<div class="mstrmojo-DataGrid-headerText');g.push(j.headerCss?" "+j.headerCss:"");if(k){l.push(mstrmojo.hash.copy(k));g.push('"'+f+">");}else{g.push('">');}g.push(j.headerText||"&nbsp");g.push("</div>");g.push("</td>");return g.join("");}function a(e,m){var g,k,l,f,n,j,h=[];e=e||"_headerWidgets";m=m||"1";g=this[e];k=g.length;if(k>0){l=this.headerContainerNode.getElementsByTagName("div");f=mstrmojo.array.filter(l,function(o){return o.getAttribute("w")==m;});for(j=0;j<k;j++){g[j].placeholder=f[j].firstChild;g[j].dataGrid=this;n=mstrmojo.registry.ref(g[j]);n.render();h.push(n);}}this[e+"_"]=h;}mstrmojo.DataGrid=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._CanResizeColumn,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DataGrid",banding:true,resizableColumns:true,columns:null,items:null,listMapper:mstrmojo.WidgetListMapperTable,lockHeader:false,contentWidth:"",renderHook:{},markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild.firstChild;},dropCueNode:function(){return this.domNode.lastChild.lastChild;},headerContainerNode:function(){return this.domNode.firstChild;}},markupMethods:{oncontentWidthChange:function(){var f=this.contentWidth,g=this.headerContainerNode,e=this.itemsContainerNode;if(f&&g&&e){g.style.width=f;e.style.width=f;}},onlockHeaderChange:function(){mstrmojo.css.toggleClass(this.domNode,"lockHeader",this.lockHeader);},onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";}},setupScrollNodes:function M(){this.scrollNode=this.scrollboxNode;},itemFunction:function(g,e,f){var h=new mstrmojo.DataRow({columns:f.columns,data:g,idx:e,dataGrid:f,parent:f});return h;},preBuildRendering:function D(){var k=this.renderHook;if(k&&k.pre){k.pre.apply(this,[A]);}else{var f=this.columns,e=f.length,g=['<table class="mstrmojo-DataGrid-headerTable" cellspacing="0" cellpadding="0"><tr>'],j;this._headerWidgets=[];var h;for(h=0;h<e;h++){j=A.apply(this,[f[h],h]);g.push(j);}g.push("</tr></table>");this.headerHtml=g.join("");}if(this._super){this._super();}},postBuildRendering:function V(){if(this._super){this._super();}var g=this.renderHook;if(g&&g.post){g.post.apply(this,[J,a]);}else{a.apply(this);this.titleColGroup=J(this.columns);}var e=this.titleColGroup,m=e.cloneNode(true),j=this.headerContainerNode,l=j&&j.getElementsByTagName("table")[0],n=this.itemsContainerNode,k=this.scrollboxNode,h=this.domNode,f=n&&n.getElementsByTagName("table")[0];this.dataColGroup=m;if(l&&f){l.insertBefore(e,l.firstChild);f.insertBefore(m,f.firstChild);}if(this.lockHeader){k.style.height=h.offsetHeight-j.offsetHeight+"px";mstrmojo.dom.attachEvent(k,"scroll",function(o){j.style.left=-k.scrollLeft+"px";});}},refresh:function H(e){I(this);if(this._super){this._super(e);}},destroy:function d(e){I(this);this._super(e);},unrender:function U(j){var g=this._headerWidgets_,f=g&&g.length,e;if(f>0){var h;for(h=0;h<f;h++){e=g[h];if(e&&e.hasRendered){e.unrender(true);}}}this._super(j);}});mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Container");mstrmojo.DataRow=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DataRow",cssClass:"mstrmojo-DataRow",columns:null,markupMethods:{onselectedChange:function(){mstrmojo.css.toggleClass(this.domNode,"selected",this.selected);}},buildDom:function(){this.children=[];var k=document.createElement("tr"),o=this.data,r=this.idx,f=this.dataGrid,l=this.cssClass,u=this.columns,e=this.children,g,p=-1,t,q;k.setAttribute("id",this.id);if(f.banding){l+=(r%2==1)?" odd":" even";}k.className=l+(mstrmojo.string.isEmpty(o[f.itemDisplayField||"n"])?" empty-row":"")+(" "+o[f.itemCSSField||"itemCss"]||"");var j,n;for(j=0,n=u.length;j<n;j++){t=u[j];q=(t.dataWidgetBuilder&&t.dataWidgetBuilder(o))||t.dataWidget;g=document.createElement("td");if(t.applyStyle2Cell&&t.colCss){g.setAttribute("class",t.colCss);}k.appendChild(g);if(q){g.setAttribute("w","1");p++;e.push(mstrmojo.hash.copy(q,{slot:"slot"+p,data:o,idx:r,dataGrid:f}));}else{if(t.dataFunction){g.innerHTML=t.dataFunction(o,r,f);}else{var h=mstrmojo.string.htmlAngles(o[t.dataField||"n"])||"&nbsp",m=t.tooltip?' title="'+h+'"':"";g.innerHTML='<div class="mstrmojo-DataRow-text" '+m+">"+h+"</div>";}}}this.initChildren();k.mstrmojoId=this.id;return k;},buildRendering:function N(){this._super();var j=this.domNode.childNodes,e=j.length,h={},g=0,k,f;for(f=0;f<e;f++){k=j[f];if(k.getAttribute("w")=="1"){h["slot"+g]=k;g++;}}this.addSlots(h);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.ContextMenuItem","mstrmojo.WidgetList","mstrmojo.ListMapperTable");var H=false,B=20;function G(J,K){var L=J.itemsContainerNode;L.scrollTop=Math.min(Math.max(L.scrollTop+K,0),L.scrollHeight-L.offsetHeight);}function I(K,J){if(!K._scrollInter){var L=B*(J?-1:1);K._scrollInter=window.setInterval(function(){G(K,L);},50);}}function E(J){if(J._scrollInter){window.clearInterval(J._scrollInter);J._scrollInter=null;}}mstrmojo.ContextMenu=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.ContextMenu",zIndex:100,visible:true,makeObservable:true,markupString:'<div id={@id} class="mstrmojo-ContextMenu {@cssClass}" style="z-index: {@zIndex};{@cssText}"><div class="mstrmojo-CM-scrollup" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], true)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], true)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], true)" ></div><div class="mstrmojo-CM-itemsContainer">{@itemsHtml}</div><div class="mstrmojo-CM-scrolldown" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], false)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], false)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], false)" ></div></div>',markupSlots:{scrollupNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1];},scrolldownNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){var K=this.domNode,P=this.itemsContainerNode,N=this.scrollupNode,M=this.scrolldownNode;K.style.display=this.visible?"block":"none";if(this.visible){N.style.display="none";M.style.display="none";P.style.overflow="auto";P.style.height="auto";var J=mstrmojo.dom.windowDim().h,O=K.offsetHeight,L=K.offsetWidth;if(J<O){N.style.display="block";N.style.minWidth=L+"px";M.style.display="block";M.style.minWidth=L+"px";P.style.overflow="hidden";P.style.height=(J-42)+"px";}}},onleftChange:function(){this.domNode.style.left=(this.left!=null)?this.left:"";},ontopChange:function(){this.domNode.style.top=(this.top!=null)?this.top:"";}},listMapper:mstrmojo.WidgetListMapperTable,itemFunction:function C(N,J,L){if(!H){mstrmojo.requiresCls("mstrmojo.ContextMenuItem");H=true;}var K={data:N,parent:L,hasSubmenu:L._cmSource.hasSubmenu(N),dynamicUpdate:L.dynamicUpdate,_cmSource:L._cmSource,zIndex:L.zIndex,itemIdField:L.itemIdField,itemField:L.itemField,itemChildrenField:L.itemChildrenField,itemFunction:L.itemFunction},M=new mstrmojo.ContextMenuItem(K);return M;},onmousedownarrow:function A(L,K,J){I(this,J);},onclickarrow:function F(L,K,J){G(this,B*(J?-1:1));},onmouseuparrow:function D(L,K,J){E(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.HTMLButton","mstrmojo._HasContextMenu","mstrmojo.ContextMenu");mstrmojo.MenuButton=mstrmojo.declare(mstrmojo.Button,[mstrmojo._HasContextMenu],{preclick:function A(B){this.showContextMenu();},openPopupMenu:function(){this.showContextMenu();}});})();(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.DataGrid");mstrmojo.requiresDescs(14615,1442,12381,12382,12403,12404,12405);var C=mstrmojo.desc;mstrmojo.qb.es.AlternateSourceDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.es.AlternateSourceDialog",cssClass:"mstrmojo-qb-ValidateAlternateSource-dialog",title:C(12405,"Alert"),items:null,onOpen:function A(){var I=this.table,E=[],D,G=[C(14615,"Match Status"),C(12403,"Original Table"),C(12404,"New Table")],K,F=this.items.length;MATCH_RESULT_COLUMN=0;function H(P,R,N){var O=[P[1],P[0],P[2]],Q=this.dataField,M=O[Q],L;if(parseInt(Q,10)===MATCH_RESULT_COLUMN){if(M<0){L="";}else{L=M?'<div class="matched-item"></div>':'<div class="unmatched-item"></div>';}}else{L=M;}return L;}for(D=0;D<G.length;D++){K={headerText:G[D],colWidth:(D===MATCH_RESULT_COLUMN)?"88":"261",dataFunction:H,dataField:D.toString()};E.push(K);}for(D=0;D<9-F;D++){var J={0:"",1:-1,2:""};J.prototype=this.items[0];this.items.push(J);}I.set("columns",E);I.set("items",this.items);},children:[{scriptClass:"mstrmojo.Label",cssClass:"validation-note1",text:C(12382,"The selected table cannot serve as an alternate source due to the above mismatches. Please select an alternate table.")},{scriptClass:"mstrmojo.DataGrid",alias:"table",cssClass:"validation-table",resizableColumns:false,columns:[]},{scriptClass:"mstrmojo.Label",cssClass:"validation-note2",text:C(12381,"Note: The column names and the data types have to match between the currently uploaded table and the original table for relational sources.")},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-Button mstrmojo-WebButton",onclick:function(){var D=this.parent.parent;D.close();}}]}],postBuildRendering:function B(){if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.WidgetTreeBuilder","mstrmojo.TreeNodeSelector");var E=false;mstrmojo.WidgetTree=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.WidgetTree",listBuilder:mstrmojo.WidgetTreeBuilder,listSelector:mstrmojo.TreeNodeSelector,renderOnScroll:true,itemIdField:"dssid",itemDisplayField:"n",itemIconField:"tp",itemChildrenField:"items",itemFunction:function D(L,I,J){if(!E){mstrmojo.requiresCls("mstrmojo.TreeNode");E=true;}var H=J.tree||J,K=new mstrmojo.TreeNode({data:L,state:0,parent:J,tree:H,multiSelect:J.multiSelect,text:L[J.itemDisplayField],textCssClass:H.item2textCss(L),items:L[J.itemChildrenField],itemIdField:J.itemIdField,itemDisplayField:J.itemDisplayField,itemIconField:J.itemIconField,itemChildrenField:J.itemChildrenField,itemFunction:J.itemFunction,listSelector:J.listSelector});return K;},item2textCss:function B(H){return H[this.itemIconField];},selectionParentNode:null,init:function F(H){this._super(H);this.selectionParentNode=this;this.tree=this;},clearTreeSelect:function A(){(this.selectionParentNode||this).clearSelect();},prechange:function G(H){var I=this._super(H);this.onnodechange(H);return I;},onnodechange:function C(I){if(!I){return ;}var J=mstrmojo.hash,M=this.selectionParentNode,L=I.src;if(L===M){if(J.isEmpty(L.selectedIndices)){L=this;this.selectionParentNode=this;}this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:I.removed});}else{if(I.added&&I.added.length){var K=[];if(!J.isEmpty(M.selectedIndices)){K=mstrmojo.hash.keyarray(M.selectedIndices,true);M.clearSelect();}this.selectionParentNode=L;this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:K});}else{}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.TreeNode","mstrmojo._IsExprNode","mstrmojo.array","mstrmojo.dom","mstrmojo.css","mstrmojo.expr","mstrmojo._HasOwnAvatar");var F=mstrmojo.array,M=mstrmojo.expr,P=mstrmojo.dom,A=mstrmojo.css;function J(R,Q){var T=R.data,S=T&&T.nds;if(!S){return null;}if(Q){Q.sort(F.numSorter);}else{Q=R.sortSelectedIndices();}if(!Q.length){return null;}return{idxs:Q,nds:F.get(S,Q)};}function N(S){var R=S.ctxtBuilder,U=R&&R.itemWidgets,Q=U&&U[0],T=Q&&Q.data;if(T&&T.not&&(U.length>0)){delete T.not;Q.paint();}}mstrmojo.AndOrNode=mstrmojo.declare(mstrmojo.TreeNode,[mstrmojo._IsExprNode,mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.AndOrNode",data:null,editable:false,prefixedAndOrEditable:false,markupString:'<div id="{@id}" class="mstrmojo-andor mstrmojo-AndOrNode {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-andor-prefix" mstrAttach:click><span class="mstrmojo-textset mstrmojo-andor-prefix-text"></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-andor-top"></div><div class="mstrmojo-andor-contentsWrapper" style="position:relative"><div class="mstrmojo-andor-contents" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue mstrmojo-AndOrNode-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner mstrmojo-AndOrNode-dropCue-inner"></div></div></div><div class="mstrmojo-andor-bottom"></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},itemsContainerPrefix:function(){return this.domNode.childNodes[1];},itemsContainerNode:function(){return this.domNode.childNodes[2].firstChild;},dropCueNode:function(){return this.domNode.childNodes[2].lastChild;},itemsContainerSuffix:function(){return this.domNode.lastChild;},scrollboxNode:function(){return this.domNode;}},markupMethods:{onitemCntChange:function(){A.toggleClass(this.itemsContainerNode,["multi"],this.itemCnt>2);},onprefixedAndOrEditableChange:function(){A.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();},ondropCuePosChange:mstrmojo.TreeNode.prototype.markupMethods.ondropCuePosChange},multiSelect:true,itemIdField:null,init:function(Q){this._super(Q);this.markupString=this.markupString.replace("{@_prefixAndOrToolsMarkup}",this.getPrefixAndOrToolsMarkup());var R=this.data;if(R){delete this.data;this._set_data(null,R);}},itemCnt:0,postBuildRendering:function(){var Q;this.set("itemCnt",this.items.length);if(this._super){Q=this._super();}N(this);return Q;},preadd:function L(Q){if(this._super){this._super(Q);}this.set("itemCnt",this.items.length);N(this);},preremove:function O(Q){if(this._super){this._super(Q);}this.set("itemCnt",this.items.length);N(this);},_set_data:function(T,Q){var R=this.data,S=(R!==Q);if(S){this.data=Q;if(Q&&!Q.nds){Q.nds=[];}this.set("items",Q&&Q.nds);}return S;},isDragValid:function K(){return true;},isSelectableArea:function(Q){return false;},getDragData:function(Q){var S=this._super(Q);if(S&&!S.html){var R=S.et&&M.ET2TGT[S.et];S.html=R?S[R]&&S[R].n||"":S.n||"";}return S;},remove:function I(R,S){var Q=this._super(R);if(Q>-1){var T=S||this.suppressConsolidation;if(!T){this.consolidate(false);}}return Q;},move:function(R,Q){this.suppressConsolidation=true;var S;if(this._super){S=this._super(R,Q);}this.suppressConsolidation=false;return S;},consolidate:function E(){var U=this.parent;if(!U||!U.remove){return ;}var S=this.items,R=S&&S.length;if(R<2){var T=R?S[0]:null,Q=this.childIndex();if(T){U.add([T],Q);}U.remove(this.data);}},indent:function G(S,Q){var R=J(this,S);if(!R){return ;}this.remove(R.idxs,true);var W=R.nds,V=Q&&Q.fn||this.data&&this.data.fn,U={et:M.ET.ANDOR,nds:W,fn:V};if(W.length===2&&W[0].not){if(W[1].not){delete W[0].not;delete W[1].not;U.not=true;U.fn=(V===M.FN.AND?M.FN.OR:M.FN.AND);}else{var T=W[0];W[0]=W[1];W[1]=T;}}this.add([U],R.idxs[0]);this.consolidate(false);},outdent:function C(R){var S=this.parent,Q=S&&S.data;if(!Q||Q.et!==M.ET.ANDOR){return ;}var T=J(this,R);if(!T){return ;}this.remove(T.idxs,true);if(this.data.not){T.nds[0].not=true;}S.add(T.nds,this.childIndex());this.consolidate(false);},edit:function D(Z,a,S){if(!Z){return ;}var Y=this.data,X=Y&&Y.fn,R=Z.data,f=R&&R.not;if(!R){R={};Z.data=R;}R.not=!!S;if(X!==a){var Q=Y.nds;if(Q&&Q.length>2){var e=Z.childIndex();if(e>0){this.indent([e-1,e],{fn:a});}}else{Y.fn=a;var V=this.ctxtBuilder,U=V&&V.itemWidgets;for(var T=0,W=(U&&U.length)||0;T<W;T++){var b=U[T];if(b){b.paint();}}}}else{Z.paint();}},preclick:function H(Q){var S=null,R=P.eventTarget(Q.hWin,Q.e);if(R===this.prefixNode){}else{if(P.contains(this.prefixNode,R,true)){S="andor";}}Q.part=S;},createAvatar:function B(S){var R=document.createElement("div"),T=P.findWidget(S),Q=T.getAvatarNode&&T.getAvatarNode();if(!Q){Q=T.condNode.cloneNode(true);Q.style.boxSizing="border-box";Q.style.width=T.condNode.offsetWidth+"px";}R.appendChild(Q);A.addClass(R,T.avatarCssCls||"mstrmojo-FE mstrmojo-ConditionNode");R.style.zIndex=20;return R;},_ndsToMove:J});})();(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(12726,13016,13588,13589,13590,13591,13611);var B=mstrmojo.array,C=mstrmojo.dom;function A(){var D=[{dda:true,n:mstrmojo.desc(12726,"Connect Live"),desc:mstrmojo.desc(13588,"Access up-to-the-minute data via live queries."),hot:true},{dda:false,n:mstrmojo.desc(13589,"Import as an In-memory Dataset"),desc:mstrmojo.desc(13590,"Upload your data and build an in-memory dataset for rapid analysis."),hot:true}];return D;}mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog",callback:null,title:mstrmojo.desc(11922,"Data Access Mode"),cssClass:"mstrmojo-di-dda-confirm",selectedIndex:0,help:"",preBuildRendering:function(){var F=[],D=["mstrmojo-di-button","mstrmojo-WebButton"],E,G;if(this._super){this._super();}E=A();B.forEach(E,function(H){G=new mstrmojo.Button({cssClass:H.hot?D.concat(["hot",H.icon||""]).join(" "):D.concat(H.icon||"").join(" "),text:H.n,useRichTooltip:true,updateTooltipConfig:function(){var J=this,I=C.position(J.domNode);J.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:H.desc,top:Math.max(I.y+40,0),left:Math.max(I.x+I.w/2,0),posType:mstrmojo.tooltip.POS_TOPCENTER};},slot:"containerNode",onclick:function(){this.parent.handleContinue(H);}});F.push(G);});this.addChildren(F);},handleContinue:function(F){var D=mstrApp.getRootController(),H=this.callback,G=D.getDDAController(),E=this;G.onToggleDDA(F.dda);G.askUserAboutDDA(true);if(!H){D.getPublishController().saveAndPublishNoConfirm();}else{if(H.onOK){H.onOK();}}E.close();},children:[{scriptClass:"mstrmojo.Label",cssClass:"confirm-title",text:mstrmojo.desc(13591,"How would you like to access your data?")}]});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo.Editor","mstrmojo.Label","mstrmojo.HBox");mstrmojo.requiresDescs(218,219,3610,9161,10040,10041,13318,13073,13074,13075,13076,13077,13078,13079,13080,13081);var C=[mstrmojo.desc(13073,"The following attribute, which is currently used to personalize the dashboard, is missing. ")+'<span style="color:red;"><u>'+mstrmojo.desc(13074,"If you do not include it, personalization will not be applied")+"</u></span>"+mstrmojo.desc(13075," and users could have access to more data than they are currently allowed to view."),mstrmojo.desc(13076,"The following attributes, which are currently used to personalize the dashboard, are missing. ")+'<span style="color:red;"><u>'+mstrmojo.desc(13077,"If you do not include them, personalization will not be applied")+"</u></span>"+mstrmojo.desc(13075," and users could have access to more data than they are currently allowed to view.")],B=[mstrmojo.desc(13078,"If you still want to make this change please unmap the attributes by going to Share>Personalize."),mstrmojo.desc(13079,"If you still want to make this change please unmap the attribute from your Recipient List by going to Share>Deliver.")],A=[mstrmojo.desc(13080,"The following object is missing which could affect your dashboard definition."),mstrmojo.desc(13081,"The following objects are missing which could affect your dashboard definition.")];mstrmojo.qb.MissingColumnWarning=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.MissingColumnWarning",cssClass:"",title:mstrmojo.desc(3610),hasPT:false,isCube:true,warning:mstrmojo.desc(10040,"Some of the previously uploaded columns are missing"),details:mstrmojo.desc(10041,"If you do not import previously used columns, existing reports, documents and analyses might be affected. Do you still want to continue?"),onOpen:function(){var F=this.mappings,E=this.hasPT,D=this.buttonBox,G=(F.length>1)?1:0;this.set("title",mstrApp.isCloudPro?(E?mstrmojo.desc(9161,"Oops!"):mstrmojo.desc(13318,"Just Checking")):mstrmojo.desc(3610));this.list.set("items",F);this.warningLabel.set("text",E?C[G]:(mstrApp.isCloudPro?A[G]:this.warning));this.detailLabel.set("text",E?B[this.isCube?0:1]:this.details);D.YesButton.set("visible",!E);D.NoButton.set("visible",!E);D.OKButton.set("visible",E);},cssText:"width: 400px",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-MissingColumns-title",alias:"warningLabel"},{scriptClass:"mstrmojo.List",alias:"list",cssClass:"mstrmojo-qb-MissingColumns-list",itemIdField:"did",itemMarkupFunction:function(D,F,G){var E='<div class="mstrmojo-qb-MissingColumns-bullet mstrmojo-qb-MissingColumns-Icon t'+D.tp+'">'+D.n+"</div>";return E;}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-MissingColumns-instruction",alias:"detailLabel"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-MissingColumns-buttonBox",slot:"buttonNode",alias:"buttonBox",cssText:"float:right;background:transparent;height:45px;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-Yes",text:mstrmojo.desc(219,"Yes"),alias:"YesButton",onclick:function(D){var F=this.parent.parent;var E=true;if(F.onOK){E=F.onOK();}if(E){F.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-No",text:mstrmojo.desc(218,"No"),alias:"NoButton",onclick:function(D){var E=this.parent.parent;if(E.onCancel){E.onCancel();}E.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-OK",alias:"OKButton",onclick:function(D){this.parent.parent.close();}}]}],onRender:function(){this.helpNode&&(this.helpNode.style.display="none");this.closeNode&&(this.closeNode.style.display="none");}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo._HasPopup","mstrmojo.ListBase","mstrmojo.Popup","mstrmojo.Editor","mstrmojo.SuggestionList");function D(Y){var X=this.list,V=X.selectedIndex,U=X.items.length,W=Y?U-1:0;if(V===W){X.clearSelect();return ;}if(V===null||V<0){V=Y?0:U-1;}else{V+=Y?1:-1;}X.singleSelect(V);}mstrmojo._HasSuggestion=mstrmojo.provide("mstrmojo._HasSuggestion",mstrmojo.hash.copy(mstrmojo._HasPopup,{blockBegin:1,blockCount:-1,suggestCount:15,autoSelect:true,itemField:"n",candidates:null,suggestionShown:false,suggestionItems:null,_last_hit:null,_request_pattern:null,browseItemVisible:false,folderLinksContextId:25,browsableTypes:"1,8",REQUEST_THRESHOLD:20,noCache:false,disableClick:false,getCandidatesThroughTaskCall:mstrmojo.emptyFn,onSuggestionItemSelect:function J(U){this.hideSuggestion();},getSearchPattern:function T(){return"";},getSuggestionPos:function N(){return{left:"100px",top:"100px"};},getSuggestionTarget:function G(){return this;},showSuggestion:function B(V){var U=this.getSuggestion(V);if(!this.noCache&&U!==-1){this.updateSuggestion(U);}},hideSuggestion:function C(){this.suggestionShown=false;if(this.suggestionPopup.visible){this.suggestionPopup.close();}},getSelected:function M(){return(this.suggestionShown)?this._lastOpened.getSelected():null;},nextHighlight:function E(){if(this.suggestionShown){this._lastOpened.nextHighlight();}},preHighlight:function H(){if(this.suggestionShown){this._lastOpened.preHighlight();}},getSuggestion:function S(h){var d=this.candidates,a=d&&d.items,X=d&&d.isComplete,g=this._last_hit;if(!this.noCache&&(d||g)){var f=this.filterCandidates(a,h,this.REQUEST_THRESHOLD),b=f.length,e=this.suggestCount,U=false;if(!X&&b<e){var V=g&&g.pattern;if(g&&V&&(h.indexOf(V)>-1)){U=true;var k=this.filterCandidates(g.items,h,this.REQUEST_THRESHOLD),Y=k&&k.length,W=mstrmojo.array,j=this.itemField,Z;for(Z=0;Z<Y;Z++){if(W.find(f,j,k[Z][j])===-1){f.push(k[Z]);}}b=f.length;}}if(!X&&((h.length>2&&b<this.REQUEST_THRESHOLD)||(b<e))){this.requestCandidates(h);return -1;}return(b<e)?f:f.slice(0,e);}this.requestCandidates(h);return -1;},requestCandidates:function A(U){this._request_pattern=U;var X=this,V=this.getSuggestionTarget(),W={success:function(e){if(!e){return ;}var d=X.getSuggestionTarget();if(!d||(V!==d)){return ;}var j=d.getSearchPattern(),a=e.items;X._last_hit={items:a,pattern:U};X.sz=e.sz;if(!X.noCache&&a){var f=(X.candidates&&X.candidates.items)||[],g=[].concat(a),b=a.length,Z;for(Z=0;Z<b;Z++){var Y=g[Z];if(mstrmojo.array.indexOf(f,Y)>-1){mstrmojo.array.removeItem(a,Y);}}if(X.candidates){X.candidates.items=f.concat(a);}}if(j&&j.indexOf(U)>-1){var h=X.filterCandidates(a,j);X.updateSuggestion(h);}},failure:function(Y){if(Y.getResponseHeader){mstrmojo.alert(Y.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};this.getCandidatesThroughTaskCall({pattern:U,blockBegin:this.blockBegin,blockCount:this.blockCount,isSuggest:true},W);},filterCandidates:function Q(X,W,U){U=U||this.suggestCount;W=mstrmojo.string.regEscape(W);var Y=this.itemField,V=mstrmojo.array.filter(X,function(Z){return(new RegExp("\\s"+W+"|^"+W,"i")).test(Z[Y]);},{max:U});return V;},getHighlightedText:function P(W,Z){if(!this.highlightPattern||mstrmojo.string.isEmpty(W)){return Z;}try{if(!this.nameWildcards||mstr.$A.find([2,32],parseInt(this.nameWildcards,10))>-1){Z=Z.replace(new RegExp("(^|\\s)("+W+")","gi"),"$1<b>$2</b>");}else{var Y=W.split(" "),V,U;for(V=0,U=Y.length;V<U;V++){if(Y[V]!==""){Z=Z.replace(new RegExp("("+Y[V]+")","gi"),"<b>$1</b>");}}}}catch(X){}return Z;},updateSuggestion:function O(X){var V=X&&X.length,U=this.browseItemVisible;if(V||U){if(U){X=X||[];X.push({n:"Browse...",t:-99,cssClass:(V?"br":"bro")});}this.set("suggestionItems",X);if(this.suggestionShown){var W=this._lastOpened;if(W&&W.nudge){W.nudge();}if(this.autoSelect&&W){W.list.singleSelect(0);}}else{this.openPopup("suggestionPopup",this.getSuggestionPos());this.suggestionShown=true;}}else{this.hideSuggestion();}},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",onClose:function(){var U=this.opener;if(U&&U.onBrowserClose){U.onBrowserClose();}},onOpen:function(){var U=this.opener;if(U&&U.onBrowserOpen){U.onBrowserOpen();}},children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},onBrowserClose:function L(){this.browserShown=false;},handleSuggestionItemSelect:function K(U,V){if(this.browseItemVisible&&U.t===-99){this.hideSuggestion();mstrmojo.requiresCls("mstrmojo.ObjectBrowser");var W=this.zIndex;this.openPopup("ob",{zIndex:(W&&(W+10))||110});this.ob.browser.browse(mstrmojo.hash.copy(V,{folderLinksContextId:this.folderLinksContextId,onSelectCB:[this,"onSuggestionItemSelect"],browsableTypes:this.browsableTypes}));this.browserShown=true;}else{this.onSuggestionItemSelect(U);}},highlightPattern:true,suggestionPopupCssClss:"",suggestionPopup:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-ObjectInputBox-suggest",autoClose:true,locksHover:true,nextHighlight:function(){D.call(this,true);},preHighlight:function(){D.call(this,false);},getSelected:function M(){var U=this.list;return U.items[U.selectedIndex];},onOpen:function I(){var U=this.opener;if(U){mstrmojo.css.addClass(this.domNode,U.suggestionPopupCssClss||"");if(U.autoSelect){this.list.singleSelect(0);}if(U.nudge){U.nudge(this);}}},onClose:function F(){this.list.clearSelect();var U=this.opener;if(U){U.suggestionShown=false;mstrmojo.css.removeClass(this.domNode,U.suggestionPopupCssClss||"");}}},suggestionListClass:"mstrmojo.SuggestionList",postApplyProperties:function R(){this.suggestionPopup.children=[{scriptClass:this.suggestionListClass,alias:"list",cssClass:"mstrmojo-suggest-list"}];}}));}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Editor","mstrmojo.Box","mstrmojo.CheckBox","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(4531,8262,12437,12438,12439);var D=mstrmojo.hash;var E={Automatic:0,Manual:3};var I={Automatic:-1,False:0,True:1};var H={Automatic:-1,False:1,True:2};var F={mps:{afb:I.False,sfb:H.False,fbf:E.Automatic}};var B=["mps"],K=function(P,N){var O=this.parent.parent,L=O.cloneModel,M=L.mps||{};if(M[P]!==N){M[P]=N;O.set("dirty",true);}};mstrmojo.ME.DerivedMetricOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ME.DerivedMetricOptions",cssClass:"mstrmojo-DerivedMetricOptions",dirty:false,init:function J(L){this._super(L);mstrmojo.css.addWidgetCssClass(this,"dme");},updateModel:function C(){var M=this.model,L=this.cloneModel,N=L.mps;if(N.fbf===E.Automatic){N.afb=I.Automatic;N.sfb=H.Automatic;}N.dirty=true;M.mps=L.mps;},onOpen:function A(){var N=this.cloneModel||{};D.make(N,mstrmojo.Obj);var M=mstrmojo.hash.copy(this.model,mstrmojo.hash.copy(F)),O,L;for(O=0,L=B.length;O<L;O++){N.set(B[O],D.clone(M[B[O]]));}this.cloneModel=null;this.set("cloneModel",N);},onClose:function G(){this.set("dirty",false);delete this.cloneModel;},children:[{scriptClass:"mstrmojo.HBox",alias:"fbFlagBox",cssClass:"mstrmojo-DerivedMetricOptions-aggBox",children:[{scriptClass:"mstrmojo.Label",cssText:"white-space: nowrap; margin-right: 8px; vertical-align: top;",text:mstrmojo.desc(12437,"Aggregation And Subtotal Behavior:")},{scriptClass:"mstrmojo.Pulldown",alias:"fbFlag",cssText:"min-width: 100px;",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"v",items:[{n:mstrmojo.desc(4531,"Automatic"),v:E.Automatic},{n:mstrmojo.desc(8262,"Manual"),v:E.Manual}],bindings:{value:function(){return this.parent.parent.cloneModel.mps.fbf||E.Automatic;}},onvalueChange:function(L){if(L.value!==undefined&&L.valueWas!==undefined){K.call(this,"fbf",L.value);}}}]},{scriptClass:"mstrmojo.Box",cssText:"height: 30px",cssClass:"mstrmojo-DerivedMetricOptions-afbBox",children:[{scriptClass:"mstrmojo.CheckBox",alias:"afb",cssDisplay:"inline-block",label:mstrmojo.desc(12438,"Aggregate From Base"),bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.afb===I.True;}},onclick:function(L){var M=this.parent.parent.fbFlagBox.fbFlag.value;K.call(this,"afb",M===E.Automatic?I.Automatic:(this.checked?I.True:I.False));}},{scriptClass:"mstrmojo.CheckBox",alias:"sfb",cssDisplay:"inline-block",label:mstrmojo.desc(12439,"Subtotals From Base"),oncheckedChange:function(L){var M=this.parent.afb;if(L.value){M.checked=I.True;M.onclick();if(M.inputNode){M.inputNode.checked=true;M.inputNode.disabled=true;}}else{if(M.inputNode){M.inputNode.disabled=false;}}},bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.sfb===H.True;}},onclick:function(){var L=this.parent.parent.fbFlagBox.fbFlag.value;K.call(this,"sfb",L===E.Automatic?H.Automatic:(this.checked?H.True:H.False));}}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:mstrmojo.desc(2397,"OK"),bindings:{enabled:function(){return this.parent.parent.dirty;}},onclick:function(){var L=this.parent.parent;L.updateModel();if(L.onOK){L.onOK();}L.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){var L=this.parent.parent;L.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.warehouse.EnumObjectTypes");var K=mstrmojo.warehouse.EnumObjectTypes,H=mstrmojo.desc(12218,"Rename Object"),C=mstrmojo.desc(11457,"Please enter name:"),G=mstrmojo.desc(11440,"(lookup)"),D=mstrmojo.desc(518,"Attribute"),I=mstrmojo.desc(1821,"db conn"),J=mstrmojo.desc(11458,"Fact"),B=mstrmojo.desc(7755,"Table");function E(){var M=mstrmojo.string.trim(this.txtbox.value);if(!this.isNew){if(M===this.originalName){if(this.onCancel){this.onCancel();}this.close();return ;}}if(mstrApp.getRootController().validateName(this.tp||this.data.tp,M,((this.isNew?undefined:this.originalName)))){this.onOK(M);this.close();}}mstrmojo.architect.ui.editors.NameEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.NameEditor",cssClass:"mstrmojo-ar-ne",isNew:false,originalName:"",tp:undefined,txtbox:undefined,error:undefined,onOpen:function F(){var O=this.data,N=O.n||O.name,M=this.txtbox,P=M.domNode;N=(N.indexOf(G,0)>0)?N.substr(0,N.indexOf(G)):N;this.originalName=N;M.set("value",N);P.focus();P.select();switch(O.tp){case K.ATTRIBUTE:this.set("title",D+" - "+O.n);break;case K.FACT:this.set("title",J+" - "+O.n);break;case K.TABLE:this.set("title",B+" - "+O.n);this.warningBox.set("visible",true);break;case K.DBROLE:this.set("title",I);break;default:this.set("title",H);break;}},children:[{scriptClass:"mstrmojo.Label",text:C},{scriptClass:"mstrmojo.TextBox",alias:"txtbox",onkeyup:function A(M){switch(M.e.keyCode){case 13:E.call(this.parent);break;case 27:this.parent.close();break;default:break;}}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Warning-Box",alias:"warningBox",visible:false,children:[{scriptClass:"mstrmojo.Box",cssClass:"icon"},{scriptClass:"mstrmojo.Label",text:"This operation requries a schema update and can take a while",cssClass:"message"}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button rightfloat mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function L(){E.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function L(){var M=this.parent.parent;if(M.onCancel){M.onCancel();}M.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Editor");mstrmojo.requiresDescs(221,1442,3393,5282,9124,12407);var S=mstrmojo.hash,X=mstrmojo.css,D=mstrmojo.dom,J=mstrmojo.desc,L=mstrmojo.array,C="on";var V={2219:[" IN "],2220:["[Not In]"]},B={525:[" LIKE "],526:["[Not Like]"],686:[" Contains "],2784:["[Not Contains]"],687:["[Begins With]"],2785:["[Not Begins With]"],688:["[Ends with]"],2786:["[Not ends with]"]},U=S.copy(V,{520:["="],612:["<>"],521:[">"],523:["<"],522:[">="],524:["<="],Between:[" between ","AND"],"Not between":["[Not Between]","AND"]});U=S.copy(B,U);var F=mstrmojo.desc(5282,"AND"),N={Between:[F],"Not between":[F]};var P={numeric:{2219:["1234,12345,123456"],2220:["1234,12345,123456"],520:["123456"],612:["123456"],521:["123456"],523:["123456"],522:["123456"],524:["123456"],Between:["1234","123456"],"Not between":["1234","123456"],525:["1%4_6"],526:["1%4_6"],686:["1%4_6"],2784:["1%4_6"],687:["1%4_6"],2785:["1%4_6"],688:["1%4_6"],2786:["1%4_6"]},vchar:{2219:["abcde,abcdef"],2220:["abcde,abcdef"],520:["abcde"],612:["abcde"],521:["aa"],523:["zz"],522:["aa"],524:["zz"],Between:["aa","zz"],"Not between":["mn","zz"],525:["a%d_f"],526:["a%d_f"],686:["a%d_f"],2784:["a%d_f"],687:["a%d_f"],2785:["a%d_f"],688:["a%d_f"],2786:["a%d_f"]},date:{2219:["2014-02-14,2014-12-25 00:00:00"],2220:["2014-02-14,2014-12-25 00:00:00"],520:["2014-12-25"],612:["2014-12-25"],521:["2014-12-25"],523:["2014-12-25"],522:["2014-12-25"],524:["2014-12-25"],Between:["2014-02-14","2014-12-25"],"Not between":["2014-02-14","2014-12-25"],525:["2014-0_-25%"],526:["2014-0_-25%"],686:["2014-0_-25%"],2784:["2014-0_-25%"],687:["2__4-"],2785:["2__4-"],688:["-25%"],2786:["-25%"]}};var R=",",I="'",W='"',G={"'":1,'"':1},M="(",O=")";function H(a){var Z=a.length;a=a.substring(G[a[0]]?1:0,(G[a[Z-1]]?Z-1:Z));return[I,a,I].join("");}function K(a){var Z=a.toString();if(Z.match(/#\d+#/)){return Z;}return"#"+Z+"#";}function Q(b){var a=b.split(R),Z=[];L.forEach(a,function(c){Z.push(H(c));});return Z.join(R);}function A(a,Z){var c,d=[],b=a;if(Z){c=a.split(R);L.forEach(c,function(e){d.push(W+e+W);});b=d.join(R);}return M+b+O;}mstrmojo.qb.FilterValueEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FilterValueEditor",init:function T(Z){this._super(Z);this.help=this.help||(mstrApp&&mstrApp.helpTopics&&mstrApp.helpTopics.filterValue)||"Enter_Value_dialog_box.htm";},zIndex:100,title:mstrmojo.desc(9124,"Enter Value"),cssClass:"mstrmojo-qb-filtervalue-editor",help:"",column:null,operatorID:null,paraNum:null,MAX_PARA_NUM:2,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-filtervalue-box",alias:"box",children:[{scriptClass:"mstrmojo.Label",alias:"label0",cssClass:"mstrmojo-qb-filtervalue-name1",cssDisplay:""},{scriptClass:"mstrmojo.TextBox",alias:"input0",cssClass:"mstrmojo-qb-filtervalue-textbox1",cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"label1",cssClass:"mstrmojo-qb-filtervalue-name2",cssDisplay:""},{scriptClass:"mstrmojo.TextBox",alias:"input1",cssClass:"mstrmojo-qb-filtervalue-textbox2",cssDisplay:""}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-filterexample-box",alias:"exampleBox",children:[{scriptClass:"mstrmojo.Label",alias:"exampleLabel",cssClass:"mstrmojo-qb-example-label",text:mstrmojo.desc(3993,"Example:")},{scriptClass:"mstrmojo.Label",alias:"exampleLabel0",cssClass:"mstrmojo-qb-example-name0",cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"exampleAndLabel",cssClass:"mstrmojo-qb-example-and-label",text:F,cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"exampleLabel1",cssClass:"mstrmojo-qb-example-name1",cssDisplay:""}]},{scriptClass:"mstrmojo.Label",alias:"err",cssClass:"mstrmojo-qb-filtervalue-errmsg",text:""},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonBox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),alias:"ok",onclick:function Y(){var k=this.parent.parent,d=k.box,Z=k.operatorID,j,m=k.isDateTime,p=k.isBigDecimal,a=k.isString,g,o=k.paraNum,c=[],b,n="["+k.column+"]",h,f=B.hasOwnProperty(Z),l=V.hasOwnProperty(Z),e;if(o<=0||o>k.MAX_PARA_NUM){return ;}for(b=0;b<o;b++){j=d["input"+b].value;if(j===""){return ;}if(m&&!f){j=Q(j);}else{if(p){j=K(j);}}if(l){j=A(j,a);}else{if(f||a){j=W+j+W;}}c.push(j);}e=U[Z];if(!e||e.length!==o){return ;}for(b=0,h=[n];b<o;b++){h.push(" ",e[b]," ",c[b]);}g=h.join("");mstrApp.getRootController().parseExpression({expr:g,qbrex:2,cIndex:1,vo:1},{success:function(r){if(r&&r.mi){var q=r.mi,t=q.reject_error_description;if(t){if(m&&q.reject_error_code===-2147214817){t=J(12407,"(Please enter a valid date/time value.)");}k.err.set("text",t);}else{k.close();mstrApp.getRootController().addNewFilter({et:"*",expr:q.items,n:g,sqltp:q.exp.sqltp});mstrApp.getRootController().refreshConditionDialog();}}}});}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),alias:"cancel",onclick:function(Z){var a=this.parent.parent;if(a.onCancel){a.onCancel();}a.close();}}]}],onOpen:function E(){var d=this.box,k=this.paraNum,j=this.MAX_PARA_NUM,b,l,n,m,a=this.buttonBox,g,o=this.exampleBox,c=o.exampleAndLabel,e,h=this.isDateTime,Z=this.isString;m=[this.n].concat(N[this.operatorID]||[]);var f=h?"date":(Z?"vchar":"numeric");e=P[f][this.operatorID]||[];this.err.set("text","");d.input0.focus();X.toggleClass(this.editorNode,"multi",k>1);for(b=0;b<j;b++){l=d["label"+b];l.set("text",m[b]||"");n=d["input"+b];n.set("value","");X.toggleClass(l.domNode,C,b<k);X.toggleClass(n.domNode,C,b<k);l=o["exampleLabel"+b];l.set("text",e[b]||"");X.toggleClass(l.domNode,C,b<k);X.toggleClass(c.domNode,C,b<k);}if(D.isIE7||D.isIE8){g=[a.ok,a.cancel];for(b=0;b<g.length;b++){g[b].inputNode.style.minWidth=(k===1)?"70px":"";}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.TextArea","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Editor");function C(E,F){var D=this;if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(E,F,{silent:true});}else{mstrmojo.xhr.request("POST",D.path,F,E,undefined,D.XServer,D.baseParams);}}function A(H,I,G,D){var E=this,F={taskId:"createFolder",taskContentType:"json",folderID:H,name:I,description:G};C.call(E,F,D);}function B(E,I,F){if(!E){mstrmojo.alert(mstrmojo.desc(3380));return false;}var G=this,H=G.fId,D={success:function(J){G.contPanel.name.set("value","");G.contPanel.desc.set("value","");if(G.okFn){G.okFn(J,F);}},failure:function(J){if(J.getResponseHeader){mstrmojo.alert(J.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(mstrApp.isSingleTier&&this.dp){this.dp.newFolder(H,E,I,D);}else{A.call(G,H,E,I,D);}}mstrmojo.NewFolderEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.NewFolderEditor",cssClass:"mstrmojo-NewFolderEditor",title:mstrmojo.desc(663,"Create Folder"),help:"Create_a_new_folder.htm",navigateAfter:false,okFn:mstrmojo.emptyFn,path:mstrConfig.taskURL,fId:null,children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:2,cols:2,alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Name-Label",slot:"0,0",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",slot:"0,1",value:mstrmojo.desc(8116,"New Folder"),alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput"},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Desc-Label",slot:"1,0",text:mstrmojo.desc(1154,"Description:")},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",slot:"1,1",alias:"desc",rows:5}]},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"ok",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,G=E&&E.opener,D=E.contPanel.name.value,F=E.contPanel.desc.value;if(!B.call(E,D,F,E.navigateAfter)){E.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Box","mstrmojo.Label","mstrmojo.expr","mstrmojo.ValidationTextBox","mstrmojo.Dialog","mstrmojo.cookies");mstrmojo.requiresDescs(17,18,221,9772,11773,14028,14136,14137,14138,14139,14140,14149,14522,14523,14524,14525,14526,14527);var CSS=mstrmojo.css,DOM=mstrmojo.dom,HASH=mstrmojo.hash;var _VAL=mstrmojo.validation,_SC=_VAL.STATUSCODE,_TR=_VAL.TRIGGER,_VALIDATOR=_VAL.VALIDATOR,DTP=mstrmojo.expr.DTP;var usherProps={intervalCtr:0,qrLoaded:false,maxPollingAttempts:80,timeDelay:3000};var DEFAULT_BADGE={mini_badge:"#ddd",mini_badge_icon:"https://uvs-v2.usher.com/assets/images/img_badge_placeholder.png",t_color:"#797979",appName:"",name:""};var userInfo={firstName:"",badgeId:""};var notificationTimer={duration:undefined,elem:undefined,callback:undefined,timerInterval:null,init:function(duration,elem,callback){this.duration=duration;this.elem=elem;this.callback=callback;},startTimer:function(){this.stopTimer();var start=Date.now(),diff,minutes,seconds;var me=this;function timer(){diff=me.duration-(((Date.now()-start)/1000)|0);minutes=(diff/60)|0;seconds=(diff%60)|0;minutes=minutes<10?"0"+minutes:minutes;seconds=seconds<10?"0"+seconds:seconds;me.elem.set("text",minutes+":"+seconds);if(diff<=0){start=Date.now()+1000;me.callback();me.stopTimer();}}timer();this.timerInterval=setInterval(timer,1000);},stopTimer:function(){if(this.timerInterval){clearInterval(this.timerInterval);}}};function addExtraParams(params){params.sn=this.serverName||mstrConfig.serverName;params.sp=this.serverPort||mstrConfig.serverPort;params.connectionId=this.connectionId||"";return params;}function disableQRCode(){this.set("expired",true);this.usherProps.qrLoaded=false;}function checkForUsherScan(){try{var widgetUsherProps=this.usherProps;var me=this;if(widgetUsherProps.qrLoaded){if(widgetUsherProps.intervalCtr>widgetUsherProps.maxPollingAttempts){disableQRCode.call(me);}else{clearTimeout(this.pullTimeout);this.pullTimeout=setTimeout(function(){widgetUsherProps.intervalCtr+=1;if(!me.stopPolling){usherPollForScan.call(me);}},widgetUsherProps.timeDelay);}}}catch(e){}}function serverRequest(params,callbacks,config){if(mstrApp.serverRequest){mstrApp.serverRequest(params,callbacks,config);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,callbacks,params);}}function usherPollForScan(){var me=this,widgetUsherProps=this.usherProps,params={taskId:"usherLoginWeb",pollOnly:"true",server:this.serverName||mstrConfig.serverName,port:this.serverPort||mstrConfig.serverPort,project:this.projectName||mstrConfig.projectName,connectionId:this.connectionId},callbacks={success:function(res){try{if(res.status=="invalid"){checkForUsherScan.call(me);}else{if(res.status=="success"){function doUsherLogin(res){me.onUsherLogin(res);widgetUsherProps.qrLoaded=false;}if(me.rememberMe===true){var callbacks={success:function(res){doUsherLogin(res);},failure:function(res){me.onUsherError(res);}};var params={taskId:"usherRememberMe"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(params,callbacks,{doNotHold:true});}else{doUsherLogin(res);}}}}catch(e){mstrmojo.alert("usherPollForScan:\n "+e.messsage);}},failure:function(res){disableQRCode.call(me);me.onUsherError(res);}};serverRequest(params,callbacks,{doNotHold:true});}function updateUserDetails(msg){this.userDetails.set("text",msg||"");}function toggleLoginNotification(show){var me=this;me.loginButton.set("visible",show);me.loginNotificationBox.set("visible",!show);}function submitLogin(){var widgetUsherProps=this.usherProps;var notificationTimer=this.notificationTimer;var me=this,callbacks={success:function(res){try{if(res.status==1){function callback(){toggleLoginNotification.call(me,true);}function submitForPolling(){if(me.pullTimeout){clearTimeout(me.pullTimeout);}me.usherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;checkForUsherScan.call(me);}var fiveMinutes=60*5;notificationTimer.init(fiveMinutes,me.loginNotificationBox.timer,callback);notificationTimer.startTimer();toggleLoginNotification.call(me,false);submitForPolling();}else{me.onUsherError(res);}}catch(e){mstrmojo.alert("Error:\n"+e.message);}},failure:function(res){me.onUsherError(res);}},params={taskId:"usherNotifyMe"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function forgetMe(){var me=this,callbacks={success:function(res){try{me.set("notificationMode",false);me.reloadQR();}catch(e){mstrmojo.alert("Error:\n"+e.messsage);}},failure:function(res){me.onUsherError(res);}},params={taskId:"usherRememberMe",rememberMe:false};if(me.userInfo.badgeId!==""){params.badgeId=me.userInfo.badgeId;}params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function getQRCode(ignoreNotificationMode){if(this.notificationMode==true&&!ignoreNotificationMode){return ;}var widgetUsherProps=this.usherProps;this.showQRLoading(true);var me=this,callbacks={success:function(res){try{if(res.img){me.set("notificationMode",false);me.updateQRCode(res.img);me.set("badge",res.badgeInfo&&res.badgeInfo[0]);widgetUsherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;this.stopPolling=false;checkForUsherScan.call(me);}else{var data=JSON.parse(res.data);var pn=data.pnEnabled||data.isPNEnabled;me.set("isPnEnabled",pn);if(data.code||data.proximityBasedLogin){me.set("notificationMode",false);if(data.proximityBasedLogin&&!ignoreNotificationMode){me.updateQRCodeProximity();me.set("proximityMode",true);}else{me.updateQRCode(data.code);me.set("proximityMode",false);}me.set("badge",res.badgeInfo&&res.badgeInfo[0]);widgetUsherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;this.stopPolling=false;mstrmojo.cookies.updateCookieSetting("usher_sso_device",res.device_id);checkForUsherScan.call(me);}else{me.set("proximityMode",false);me.set("notificationMode",true);me.refresh.set("visible",false);if(me.userInfoNode){me.userInfoNode.src="data:image/png;base64,"+data.photoData;}me.userInfo.firstName=data.firstName;me.userInfo.badgeId=data.badgeId;toggleLoginNotification.call(me,true);me.set("badge",res.badgeInfo&&res.badgeInfo[0]);}}}catch(e){mstrmojo.alert("getQRCode:\n "+e.messsage);}},failure:function(res){me.handleQRCodeError(res);disableQRCode.call(me);me.onUsherError(res);},complete:function(){me.showQRLoading(false);}},params={taskId:"usherQRWeb"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function registerHandler(){var me=this,regBtn=this.registerButton,dotsNode=this.parent.badgeNode.childNodes[1];if(regBtn.enabled){regBtn.set("enabled",false);CSS.addClass(dotsNode,["anim"]);var regMsg={},callbacks={success:function(res){var successful=res&&res.name==me.user.value;regMsg={msg:successful?mstrmojo.desc(14139,"You've successfully registered. Please check your email to continue.")+" "+mstrmojo.desc(14177,"Or perform an Usher badge recovery."):res.getResponseHeader("X-MSTR-TaskFailureMsg"),successful:successful};},failure:function(res){regMsg={msg:res.getResponseHeader("X-MSTR-TaskFailureMsg"),successful:false};},complete:function(){regBtn.set("enabled",true);CSS.removeClass(dotsNode,["anim"]);me.set("regMsg",regMsg);}},params={taskId:"usherRegUsr",server:this.serverName||mstrConfig.serverName,project:mstrConfig.projectName,port:this.serverPort||mstrConfig.serverPort,email:this.email.value,userid:this.user.value,password:this.pwd.value};serverRequest(params,callbacks);}}function getTextBoxJson(props){return mstrmojo.hash.copy(props,{scriptClass:"mstrmojo.ValidationTextBox",cssDisplay:"block",postCreate:function(){if(DOM.isIE9||DOM.isIE8||DOM.isIE7){this.emptyText=this.hint;}},onEnter:function(){registerHandler.call(this.parent);}});}mstrmojo.UsherLogin=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.UsherLogin",markupString:'<div id="{@id}" class="mstrmojo-UsherLogin-Container {@cssClass}" style="{@cssText}" ><div class="mstrmojo-UsherLogin-badge"><div class="icn"><img src="../images/1ptrans.gif"/></div><div class="dots"><div class="dot1"></div><div class="dot2"></div><div class="dot3"></div></div><div class="app"><img src="../style/mstr/images/badge-app.png"/></div></div><div class="mstrmojo-UsherLogin-badgeLabel"><div class="app-name"></div><div class="badge-name"></div></div><div class="mstrmojo-UsherLogin"><div class="mstrmojo-UsherLogin-QR mode"><img class="QR" src="../images/1ptrans.gif" alt="" /></div><div class="mstrmojo-UsherLogin-register mode"></div></div><div class="mstrmojo-UsherLogin-userInfo mode"><img class="userInfo" src="../images/1ptrans.gif" alt="" /></div><div class="mstrmojo-UsherLogin-notification"></div><div class="mstrmojo-UsherLogin-remember-setting"><div class = "mstrmojo-UsherLogin-remember"></div><div class = "mstrmojo-UsherLogin-forget"></div></div><div class="mstrmojo-UsherLogin-link"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},badgeNode:function(){return this.domNode.firstChild;},badgeIconNode:function(){return this.domNode.firstChild.firstChild.firstChild;},badgeLabelNode:function(){return this.domNode.childNodes[1];},usherNode:function(){return this.domNode.childNodes[2];},qrNode:function(){return this.domNode.childNodes[2].firstChild;},qrCodeNode:function(){return this.domNode.childNodes[2].firstChild.firstChild;},refreshNode:function(){return this.domNode.childNodes[2].firstChild.lastChild;},registerNode:function(){return this.domNode.childNodes[2].lastChild;},userNode:function(){return this.domNode.childNodes[3];},userInfoNode:function(){return this.domNode.childNodes[3].firstChild;},notificationNode:function(){return this.domNode.childNodes[4];},rememberSettingsNode:function(){return this.domNode.childNodes[5];},rememberNode:function(){return this.domNode.childNodes[5].firstChild;},forgetNode:function(){return this.domNode.childNodes[5].lastChild;},linksNode:function(){return this.domNode.lastChild;}},markupMethods:{onqrCodeChange:function(){if(this.qrCodeNode){this.qrCodeNode.src=this.qrCode;}},onbadgeChange:function(){var badge=this.badge||DEFAULT_BADGE,badgeFormat=badge.badgeFormat,fmt=badgeFormat&&(window.JSON?JSON.parse(badgeFormat):eval("("+badgeFormat+")"))||{isnull:true},labelNode=this.badgeLabelNode,iconNode=this.badgeIconNode,domNode=this.domNode;if(this.showBadgeBackgroundImage){domNode.style.backgroundColor=fmt.mini_badge;if(fmt.bg_4){domNode.style.backgroundImage="url("+fmt.bg_4+")";}}iconNode.src=fmt.mini_badge_icon||DEFAULT_BADGE.mini_badge_icon;if(!fmt.isnull&&!fmt.mini_badge_icon){CSS.addClass(iconNode.parentNode,"default");}labelNode.firstChild.innerHTML=badge.appName||DEFAULT_BADGE.appName;labelNode.lastChild.innerHTML=badge.name||DEFAULT_BADGE.name;labelNode.lastChild.title=badge.name||DEFAULT_BADGE.name;labelNode.style.color=fmt.t_color||DEFAULT_BADGE.t_color;this.linksNode.style.color=fmt.t_color||DEFAULT_BADGE.t_color;},onexpiredChange:function(){CSS.toggleClass(this.usherNode,"expired",this.expired);},onloadingChange:function(){CSS.toggleClass(this.usherNode,"loading",this.loading);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(this.visible&&this.canRequestQR()&&!this._lastVisible){getQRCode.call(this);}this.stopPolling=!this.visible;this._lastVisible=this.visible;},onnotificationModeChange:function(evt){CSS.toggleClass(this.containerNode,"notificationMode",this.notificationMode);},onproximityModeChange:function(evt){CSS.toggleClass(this.containerNode,"proximityMode",this.proximityMode);},onisPnEnabledChange:function(){this.hideRememberMe(!this.isPnEnabled);}},qrCode:"../images/1ptrans.gif",badge:DEFAULT_BADGE,expired:false,onUsherLogin:mstrmojo.emptyFn,onUsherError:mstrmojo.emptyFn,showBadgeBackgroundImage:true,usherProps:null,serverName:null,serverPort:null,rememberMe:false,userInfo:null,notificationTimer:null,loadQR:false,notificationMode:false,isPnEnabled:false,init:function init(props){if(this._super){this._super(props);}CSS.addWidgetCssClass(this,"");this.usherProps=this.usherProps?HASH.copy(this.usherProps,HASH.clone(usherProps)):HASH.clone(usherProps);this.userInfo=this.userInfo?HASH.copy(this.userInfo,HASH.clone(userInfo)):HASH.clone(userInfo);this.notificationTimer=this.notificationTimer?HASH.copy(this.notificationTimer,HASH.clone(notificationTimer)):HASH.clone(notificationTimer);},destroy:function destroy(ignoreDOM){this.stopPolling=true;clearTimeout(this.pullTimeout);this._super(ignoreDOM);},canRequestQR:function(){return this.usherProps&&(this.loadQR||(this.serverName||mstrConfig.serverName));},showUserInfo:function(res){this.refresh.set("visible",false);this.refresh.set("visible",false);},updateQRCode:function(res){this.set("qrCode","data:image/png;base64,"+res);this.set("expired",false);this.refresh.set("visible",false);},updateQRCodeProximity:function(){this.set("qrCode","../images/WaitUsherRadar.gif");this.set("expired",false);this.refresh.set("visible",false);},handleQRCodeError:function(){this.set("qrCode","../style/mstr/images/msgError.gif");this.set("expired",true);this.refresh.set("visible",true);},showQRLoading:function showQRLoading(show){this.set("loading",show);if(show){this.refresh.set("visible",false);}},postBuildRendering:function(){this._super();this.registerForm.set("tabIndex",-1);},toggleRegister:function(force){this.registerVisible=(force!==undefined)?force:!this.registerVisible;CSS.toggleClass(this.usherNode,"show-register",this.registerVisible);this.registerLink.set("text",this.registerLink.texts[this.registerVisible?1:0]);if(this.isPnEnabled===true){this.hideRememberMe(this.registerVisible&&this.isPnEnabled);}},hideRememberMe:function(force){CSS.toggleClass(this.rememberSettingsNode,"hide-rememeber",force);},reloadQR:function(){if(this.canRequestQR()){if(this.pullTimeout){clearTimeout(this.pullTimeout);}this.usherProps.intervalCtr=0;this.usherProps.qrLoaded=false;if(this.visible){getQRCode.call(this);}}},children:[{scriptClass:"mstrmojo.Label",slot:"qrNode",alias:"refresh",cssClass:"refresh",text:mstrmojo.desc(14028,"Refresh QR Code"),visible:false,onclick:function(){getQRCode.call(this.parent);}},{scriptClass:"mstrmojo.Box",slot:"registerNode",alias:"registerForm",regMsg:null,children:[getTextBoxJson({alias:"user",cssClass:"login-username",cssDisplay:"block",hint:mstrmojo.desc(17,"User name")}),getTextBoxJson({alias:"pwd",cssClass:"login-pwd",hint:mstrmojo.desc(18,"Password"),type:"password"}),getTextBoxJson({alias:"email",cssClass:"login-email",dtp:DTP.VARCHAR,constraints:{validator:_VALIDATOR.VALIDATE_EMAIL,trigger:mstrmojo.validation.TRIGGER.ONKEYUP},bindings:{visible:"this.parent.parent.usherRegistrationOption > 2"},hint:mstrmojo.desc(9772,"Email")}),getTextBoxJson({alias:"confirmEmail",cssClass:"login-email",bindings:{visible:function(){return this.parent.parent.usherRegistrationOption>2;}},hint:mstrmojo.desc(14149,"Confirm Email"),onpaste:function(evt){DOM.preventDefault(evt.hWin,evt.e||evt.hWin.event);}}),{scriptClass:"mstrmojo.Box",alias:"regMsg",cssClass:"register-msg",bindings:{regMsg:function(){return this.parent.regMsg;},visible:function(){return this.parent.regMsg;}},onregMsgChange:function(){if(this.domNode){this.domNode.style.color=this.regMsg&&this.regMsg.successful?"#42C31E":"#f00";}},children:[{scriptClass:"mstrmojo.Label",alias:"msg",cssClass:"register-msg-txt",bindings:{text:function(){return this.parent.regMsg.msg;}}},{scriptClass:"mstrmojo.Label",alias:"icn",cssClass:"register-msg-icn",onclick:function(){this.parent.parent.parent.toggleRegister();this.parent.parent.set("regMsg",null);}}]},{scriptClass:"mstrmojo.Button",alias:"registerButton",cssClass:"register mstrmojo-WebButton hot",cssDisplay:"inline-block",text:mstrmojo.desc(11773,"Register"),bindings:{enabled:function(){var username=this.parent.user.value,email=this.parent.email.value,confirmEmail=this.parent.confirmEmail.value;var registerStatus=username.length>0;if(registerStatus){if(this.parent.parent.usherRegistrationOption>1){var emailStatus=email.length>=3&&confirmEmail.length>=3&&email.toUpperCase()===confirmEmail.toUpperCase()&&this.parent.email.validationStatus.code===_SC.VALID;if(emailStatus){if(this.parent.parent.usherRegistrationOption==7){var restrictedDomains=this.parent.parent.usherRegistrationDomain.toUpperCase();var emailDomain=email.substr(email.indexOf("@")+1).toUpperCase();return restrictedDomains.indexOf(emailDomain)>=0;}}return emailStatus;}}return registerStatus;}},onclick:function(){registerHandler.call(this.parent);}},{scriptClass:"mstrmojo.Button",alias:"registerCancelButton",cssClass:"register-cancel",cssDisplay:"inline-block",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var p=this.parent;p.parent.toggleRegister();p.set("regMsg",null);p.user.set("value","");p.pwd.set("value","");p.email.set("value","");p.confirmEmail.set("value","");p.user.domNode.focus();}}]},{scriptClass:"mstrmojo.CheckBox",slot:"rememberNode",alias:"remember-me",label:mstrmojo.desc(14522,"Remember me"),onclick:function onclick(){this.parent.set("rememberMe",this.checked);}},{scriptClass:"mstrmojo.Label",slot:"forgetNode",allowHTML:true,text:mstrmojo.desc(14527,"Forget me/Switch user"),onclick:function(){forgetMe.call(this.parent);}},{scriptClass:"mstrmojo.Label",slot:"linksNode",allowHTML:true,text:'<a id="proximityProblems" href="#">Login via Phone</a>',onclick:function(evt){getQRCode.call(this.parent,true);return false;},bindings:{visible:"this.parent.proximityMode"},},{scriptClass:"mstrmojo.Label",slot:"linksNode",allowHTML:true,text:mstrmojo.desc(14136,"Use your ###Usher## app to scan the QR Code.").replace("###",'<a href="https://itunes.apple.com/us/app/usher-identity/id776079205" target="_blank">').replace("##","</a>"),},{scriptClass:"mstrmojo.Label",slot:"linksNode",alias:"registerLink",cssClass:"register-label",allowHTML:true,bindings:{visible:"this.parent.usherRegistrationOption > 0"},text:"",texts:[mstrmojo.desc(14137,"Don't have an Usher Badge? Click ###here## to register."),mstrmojo.desc(14140,"Display your ###QR Code##.")],postCreate:function(){this.set("text",this.texts[0]);},ontextChange:function(){this.text=this.text.replace("###",'<a href="#" onclick="mstrmojo.all.'+this.parent.id+'.toggleRegister(); return false;">').replace("##","</a>");}},{scriptClass:"mstrmojo.Label",alias:"userDetails",cssClass:"user-details",slot:"userNode"},{scriptClass:"mstrmojo.Button",alias:"loginButton",cssClass:"mstrmojo-WebButton login-button .mstrButton",cssDisplay:"inline-block",text:mstrmojo.desc(14525,"Login with Usher"),slot:"notificationNode",visible:false,onclick:function(){submitLogin.call(this.parent);},onvisibleChange:function(){var node=this.parent,msg=mstrmojo.desc(14523,"Hi ")+" "+node.userInfo.firstName;this.visible?msg+="!":msg+=mstrmojo.desc(14524,", please approve on your device.");updateUserDetails.call(node,msg);}},{scriptClass:"mstrmojo.Box",alias:"loginNotificationBox",cssClass:"login-notification",slot:"notificationNode",visible:false,children:[{scriptClass:"mstrmojo.Label",alias:"timer",cssClass:"notification-timer"},{scriptClass:"mstrmojo.Label",alias:"notificationFailure",cssClass:"notification-failure",text:mstrmojo.desc(14526,"Did not get notification"),onclick:function(){toggleLoginNotification.call(this.parent.parent,true);}}]},]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo.ui._IsPulldown","mstrmojo.ui.PopupList","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var I=mstrmojo.css,G=mstrmojo.array,F=mstrmojo.dom;mstrmojo.ui.Pulldown=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo.ui._IsPulldown],{scriptClass:"mstrmojo.ui.Pulldown",onitemSelected:mstrmojo.emptyFn,allowHTML:true,init:function N(O){this._super(O);I.addWidgetCssClass(this.list,"ctrl-popup-list");},initChildren:function E(){this.children=this.getPopupListConfig();this._super();},getSelectedItem:function H(){var O=this.items;return O&&O[this.selectedIndex];},selectItemByField:function J(P,O){this.set("selectedIndex",G.find(this.items||[],P,O));},getPopupWidget:function D(){return this.list;},getPopupList:function K(){return this.list;},_set_items:function B(R,O){var Q=this.items;this.items=O;delete this.selectedIndex;if(Q!==O){var P=this.hasRendered;if(P){this.refresh();}return true;}return false;},onclick:function M(O){this._super(O);var Q=this,P=Q.getPopupWidget();Q.mw=Q.mw||function(R){if(!F.contains(P.domNode,F.eventTarget(self,R),true,document.body)){P.close();F.detachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Q.mw);}};F.attachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Q.mw);},_set_selectedIndex:function A(T,R){if((R!==0&&!R)||R<0){return false;}var P=this.selectedIndex=R,O=this.getPopupList(),Q=O.items,S=this.selectedNode;O.set("selectedIndex",P);if(S&&Q&&Q[P]){S.innerHTML=this.allowHTML?Q[P].n:mstrmojo.string.encodeHtmlString(Q[P].n);S.title=Q[P].title||"";}this.onitemSelected(Q[P],P);return true;},getPopupListConfig:function C(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,listHooks:{select:function O(R,S,Q){this.parent.set("selectedIndex",Q);this.close();}},getItemProps:function P(S,Q){var R=mstrmojo._IsList.getItemProps.call(this,S,Q);R.style=this.parent.itemCssText||"";return R;}};},children:[]});mstrmojo.ui.Pulldown.newPulldown=function L(P,T,O,S,R){S=S||{};S.items=P;var Q;if(R===true){Q=mstrmojo.hash.copy({scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:O||0},S);}else{Q=new mstrmojo.ui.Pulldown(S);if(O!==undefined){Q.set("selectedIndex",O);}}Q.postselectedIndexChange=function(U){var X=U.value,W=U.valueWas;if(X!==W){var V=this.items;T.call(this,V[X],V[W]);}};return Q;};}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.Menu","mstrmojo.hash","mstrmojo.array");mstrmojo.ui.menus.MenuItemType=null;var U="separator";mstrmojo.ui.menus.MenuConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.MenuConfig",menus:null,menuCssClass:"",supportsScroll:false,maxHeight:0,hasMenuItems:function Q(){return !!this.menus.length;},getMenuItems:function E(V){return mstrmojo.array.filter(this.menus.slice().reverse(),function(Z,Y,X){var W=X[Y+1];return V||Z.cls!==U||(Y&&W&&W.cls!==U);}).reverse();},getMenuItem:function C(Y){var X=this.menus,V;if(X!==null){for(V=0;V<X.length;V++){var W=X[V];if(W.cls===Y){return W;}}}return null;},absorbMenuItems:function S(V){this.menus=this.menus.concat(V.menus);},addMenuItem:function I(c,Y,a,W,Z){var b,X,V;if(!c||typeof c==="string"){b=c;}else{b=c.n;X=c.ttp;}V={n:b,ttp:X,cls:Y,fn:a,ctxt:W};if(isNaN(Z)||Z>=this.menus.length){this.menus.push(V);}else{this.menus.splice(Z,0,V);}return V;},addCustomMenuItem:function T(a,X,Z,W,V){var Y=this.addMenuItem(a,X,Z,V);Y.getItemMarkup=W;return Y;},addDisabledMenuItem:function O(W,V){this.addNonInteractiveMenuItem(W,V,true);},addNonInteractiveMenuItem:function M(Z,W,V){var X=["non-int"];if(W){X.push(W);}if(V){X.push("disabled");}var Y=this.addMenuItem(Z,X.join(" "),mstrmojo.emptyFn);Y.dsbld=true;},addSeparator:function D(){this.addMenuItem("",U,function(){return false;});},addPopupMenuItem:function R(c,X,b,Y,W,Z){var a=["pop "];if(Y){a.push(Y);}var V=this.addMenuItem(c,a.join(" "),b,W,Z);V.pop=true;V.scope=X;return V;},addActionPopupMenuItem:function L(c,W,a,b,X,V,Z){var Y=this.addPopupMenuItem(c,W,b,(X||"")+" ax",V,Z);Y.actionFn=a;Y.ax=true;},addSubMenuItem:function K(Z,X,W,Y,V){this.addPopupMenuItem(Z,W,Y,X,V);},addEditorMenuItem:function P(Z,W,Y,V,X){this.addPopupMenuItem(Z,W,Y,"",V,X);},getToggleItemStates:function F(d,f,V,b,X,a){var Y,Z,W,c;if(typeof d==="string"){Y=Z=d;W=c="";}else{Y=d.on||"";Z=d.off||"";W=d.ttpOn||"";c=d.ttpOff||"";}var e=[{n:Y,ttp:W,cls:f+" on",fn:b,ctxt:a},{n:Z,ttp:c,cls:f,fn:V,ctxt:a}];if(!X){e.reverse();}return e;},addToggleMenuItem:function J(c,Y,a,X,W,b,V){var Z=this.getToggleItemStates(c,Y,a,X,b,V);return this.addDualStateItem(W,Z[0],Z[1]);},addDualStateItem:function G(W,V,X){return this.addMenuItem({n:V.n,ttp:V.ttp},V.cls,this.getDualStateHandler(W,V,X),V.ctxt);},getDualStateHandler:function H(W,V,X){return function(Z,a){var Y=[V,X];if(Z.cls===V.cls){Y.reverse();}Y[1].fn.call(mstrmojo.all[W],Z,a);Z.n=Y[0].n;Z.ttp=Y[0].ttp;Z.cls=Y[0].cls;};},addRadioMenuGroup:function B(X,c,Y,W,V,b,a){var Z=[];Y.forEach(function(g,d){if(g.separator){this.addSeparator();return ;}var j=g.text,h=(W||"")+" "+(g.cls||"")+(b?"":" radio")+(g.value===X?" on":""),f=function(){if(c.call(this.ctxt,g.value,X,g)===false){return false;}X=g.value;Z.forEach(function(k){k.cls=k.cls.replace(/ on$/,"")+(k.radioValue===X?" on":"");});return true;},e=a?this.addCustomMenuItem(j,h,f,a(g,d),V):this.addMenuItem(j,h,f,V);e.radioValue=g.value;Z.push(e);},this);},clear:function N(){this._super();this.menus=[];},newInstance:function A(V){return new mstrmojo.ui.menus.Menu(mstrmojo.hash.copy({popupConfig:this},V));}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.SimpleTree","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.warehouse.EnumObjectTypes");var Y=mstrmojo.array,a=mstrmojo.css,G=mstrmojo.dom,W=mstrmojo.hash,c="item-mn",K="item-n",A="userSel",T="mltSel",B=mstrmojo.warehouse.EnumObjectTypes,N=B.TABLE,D="li",L="ul",V="idx",H=":";function U(e){if(this.hasRendered){var f=this.domNode.getElementsByTagName(D);Y.forEach(f,e,this);}}function I(){var e=[];W.forEach(this.userSelections,function(f,g){e.push(this.getTreeItem(g));},this);return(e.length>1)?e:null;}mstrmojo.warehouse.ui.TablesTree=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._HasOwnAvatar,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.warehouse.ui.TablesTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree {@cssClass}" mstrAttach:click,dblclick>{@itemsHTML}</div>',userSelections:undefined,draggable:true,dropZone:true,getMenuHelper:mstrmojo.emptyFn,showTablesNum:true,init:function X(e){this._super(e);this.cssClass+=" mstrmojo-wh-TablesTree";this.userSelections=[];},getItemMarkup:function F(){return'<div class="{@cls}" title="{@ttp}"><span class='+K+' unselectable="on">{@n}</span><span class='+c+"></span></div>";},treeHooks:{select:function S(g,z,f){var e=G.findAncestorByAttr(g,"idx",true,this.domNode),AA=e.value,AD=this.userSelections,r=this.rangeSelect,AC,x,l=Number.MAX_VALUE,k=Number.MIN_VALUE,m,w,h,o,p,u,t,q=this.shiftStartIndex,AB=parseInt(f,10),j=AD[AA]===true;if(z.tp===N){if(j){delete AD[AA];}else{AD[AA]=true;}AC=W.keyarray(AD);x=AC.length;a.toggleClass(this.domNode,T,x>1);a.toggleClass(g,A,!j);if(r&&x&&q){o=q.split(H);h=AA.split(H);if(o&&h&&(o.length===h.length)&&o.length===(AB+1)){for(t=0;t<o.length;t++){if(o[t]!==h[t]){break;}}if(t===AB){m=parseInt(h[AB],10);w=parseInt(o[AB],10);if(!isNaN(m)&&!isNaN(w)){l=(m<w)?m:w;k=(m>w)?m:w;}for(var n=l;n<=k;n++){h[f]=n.toString();p=h.join(H);u=this.getTreeItem(p);if(u&&u.tp===N){AD[p]=true;delete this.selectedIndices[p];}}U.call(this,function(AF){var AE=AF.getAttribute(V);if(AD[AE]===true){a.toggleClass(AF,A,true);}});}}}}delete this.selectedIndices[AA];return true;},unselect:function M(f,g,h,e){this.itemRenderer.select(f,g,h,e,this);this.selectedIndices[g._renderIdx]=true;return true;}},tablesTreeHooks:{},showMenu:function Q(f){var g=this.getMenuHelper(),h=1;mstrApp.getRootController().setTableMenuContext(h);g.target=this;g.data=f.data;var e=g.getMenuConfig();e.hostId=this.id;e.hostElement=f.menuNode;e.isHostedWithin=false;e.hostProxyCssClass="item-mn-proxy";this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:e}));},onclick:function d(f){var k=f.target||G.eventTarget(f.hWin,f.e),j=G.findAncestorByAttr(k,"idx",true,this.domNode),l=j&&j.node.getAttribute("level"),h=G.shiftKey(f.hWin,f.e),g=j&&j.value,e=k.className===c&&g!==null&&!isNaN(l);if(!(G.ctrlKey(f.hWin,f.e)||G.metaKey(f.hWin,f.e)||h)){if(!e||!this.userSelections[g]){this.clearUserSelections(W.copy(this.userSelections));}else{this.userSelections[g]=false;}}if(h){this.rangeSelect=true;}else{this.shiftStartIndex=g;}this._super(f);if(e){this.showMenu({data:I.call(this)||this.getTreeItem(g),menuNode:k});}this.rangeSelect=false;},ondblclick:function J(n){var k=this,j=n.target||G.eventTarget(n.hWin,n.e),f=j.nodeName.toLowerCase(),q=G.findAncestorByAttr(j,"idx",true,this.domNode),e=q&&q.node.getAttribute("level"),m=q&&q.value,o=this.selectedIndices,l,p=o[m],g,h=k.tablesTreeHooks;k.onclick(n);if((f!==L)&&(f!==D)&&m!==null&&!isNaN(parseInt(e,10))){g=this.getTreeItem(m);if(h.isTable===undefined||h.isTable(g)){if(p){l=h.removeItem;}else{l=h.addItem;}if(l){l.call(k,q.node,g,e,m,o,this);}}}},createAvatar:function O(e){var g=document.createElement("div"),f=G.findAncestorByAttr(e,V,true,this.domNode);if(f&&f.node){g.appendChild(f.node.cloneNode(true));g.appendChild(document.createElement("div"));}g.className=this.domNode.className;return g;},toggleAvatarClass:function P(e,f){a.toggleClass(this.avatar,e,f);},getDragData:function E(f){var e=this.getNodeAttributes(f.src.node).index,h=this.getTreeItem(e),g=this.userSelections;if(h.tp===N){if(g[e]===true){return I.call(this)||[h];}this.clearUserSelections(W.copy(g));return[h];}return h;},isDragValid:function C(){return true;},ondragstart:function Z(e){this._super(e);var f=e.src.data;if(this.showTablesNum&&f&&f.length>1){this.avatar.getElementsByClassName(K)[0].innerHTML=f.length;}},getNodeAttributes:function b(f){var e=G.findAncestorByAttr(f,V,true,this.domNode),g=e&&e.node.getAttribute("level");return{index:e&&e.value,level:parseInt(g,10)};},clearUserSelections:function R(e){U.call(this,function(g){var f=g.getAttribute(V);if(e[f]===true){a.toggleClass(g,A,false);delete this.userSelections[f];}});a.toggleClass(this.domNode,T,false);}});}());(function(){var H=mstrmojo.array,A={NONE:0,EDIT:1,DELETE:2};function E(L,J){var K=this.data,I=(K&&K.length)?K[0]:K;return(I&&I[L])?I[L](K,J):true;}mstrmojo.qb.menu.SimpleGridMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.menu.SimpleGridMenu",dynamicUpdate:true,queryEnabled:function G(I){return E.call(this,"isEnabled",I);},queryVisible:function D(I){return E.call(this,"isVisible",I);},queryChecked:function C(I){return E.call(this,"isChecked",I);},executeCommand:function B(J){var K=this.data,I=mstrApp.getRootController();switch(J.action){case A.EDIT:I.editColumn(K);break;case A.DELETE:I.deleteColumn(K);break;}},getMenuConfig:function F(I){var L=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-qb-simplegrid-menu"}),K=I||this.cm,J=this;H.forEach(K,function(N){if(this.queryVisible(N)){var M=["xt "+(N.icn||"")],O=function O(){J.executeCommand(N);};L.addMenuItem(N.n||"",M.join(" "),O);}},this);return L;},cm:[{action:A.EDIT,n:mstrmojo.desc(1088,"Edit"),icn:"edit"},{action:A.DELETE,n:mstrmojo.desc(629,"Delete"),icn:"del"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.array","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._Formattable","mstrmojo._IsDocumentTemplate","mstrmojo.Label","mstrmojo.ui.menus.MenuConfig");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVisualizationTemplates","EnumVizStyles","EnumWidgetTypes");var T={top:"top",left:"left","z-index":"zIndex",width:"width",height:"height"};var D=["background-color","fx"],I=mstrmojo.array;mstrmojo.VisBase=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._Formattable,mstrmojo._IsDocumentTemplate],{scriptClass:"mstrmojo.VisBase",updated:false,waitingForData:false,node:null,skipReRender:false,updateFormatsOnUpdate:true,setModel:function M(Z){this.set("model",Z);},destroy:function W(){var Z=this.model;if(Z&&Z.destroy){Z.destroy();delete this.model;}this._super();},resize:function X(){var Z=this.getFormats();if(parseInt(Z.height,10)===0||parseInt(Z.width,10)===0){this.domNode.style.display="none";}else{this.setDimensions(Z.height,Z.width);this.domNode.style.display="";}},setDimensions:function O(b,a){var Z=this._super(b,a);if(Z&&this.hasRendered&&!this.skipReRender){this.reRender();}return Z;},reRender:function F(){this.unrender();this.render();},getWidth:function B(){return parseInt(this.width,10);},getHeight:function K(){return parseInt(this.height,10);},getLeft:function R(){return parseInt(this.left,10);},getTop:function A(){return parseInt(this.top,10);},buildRendering:function H(){this.height=this.getHeight();this.width=this.getWidth();this.left=this.getLeft();this.top=this.getTop();if(!this.updated){this.update();}this._super();},initFromVisProps:function V(){},postBuildRendering:function(){var Z=this.isEmpty();this._super();this.raiseEvent({name:"toggleCtrlOverlay",visible:Z,controls:this.getVisEmptyMsgControls()});this.applyBackground();return !Z;},applyBackground:function(){var a=this.defn&&this.defn.fmts,f=(a&&a.p_fmts)||a,c={},d,Z,e,b;if(mstrApp.isExpress&&f){d=this.formatHandlers=this.formatHandlers||{};e=d.domNode=d.domNode||[];Z="BG";b=I.indexOf(e,Z);if(b<0){e.push(Z);}I.forEach(D,function(g){if(f[g]){c[g]=f[g];}});this.applyCSSFormatToNode("domNode",c);}},update:function G(c){c=c||this.node;if(c){var Z=c.data;if(Z){this.model.set("data",Z);}this.waitingForData=!!Z.nsj;if(this.waitingForData){var a="ServerJsonRWDStyle";var d=this.model,b=d.getDataService(),e={host:this,nodes:[this.k]},g;if(Z.wid!==undefined){e.slices=[Z.wid];}g=mstrmojo.func.wrapMethods(d.docModel.getUpdateColorMapCallback(),d.docModel.getUpdateThemePaletteCallback(true),d.controller._getXtabCallback(this));b.retrieveServerJson(e,g,{preserveUndo:true,style:{name:a,params:{treesToRender:3}},params:{styleName:a}});this.updated=true;return false;}this.updateContentFormats(c);}if(this.model){var h=this.model&&this.model.docModel;this.initFromVisProps(this.model.vp);if(h&&h.getDocBuilder){var f=h.getDocBuilder().getMojoVisName(c);if(f){c.data.visName=f;}}}this.updated=true;if(this._super){return this._super(c);}return true;},updateContentFormats:function(e){var d=this.parent,c=e.defn,Z=c&&c.fmts;if(this.updateFormatsOnUpdate&&Z){if(this.clearFormats){this.clearFormats();}if(d&&d._createFormats&&!Z.p_fmts){d._createFormats();}Z=(this.getFormats&&this.getFormats())||Z;for(var b in T){if(T.hasOwnProperty(b)){var a=T[b];if(b in Z){this[a]=Z[b];}}}}},isEmpty:function L(){return false;},getVisEmptyMsgControls:function C(){return[{scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:mstrmojo.desc(11668,"Drag objects here.")}];},getModel:function N(){return this.model;},getData:function J(){return this.model.data;},getRowsAndCols:function(){var Z=this.model.data.gts;return(Z.row||[]).concat(Z.col||[]);},getExp:function(){var Z=this.model.data,a=Z&&Z.sc&&Z.sc.exp;return a;},getDocModel:function S(){return this.model&&this.model.docModel;},getTitleRMCPopup:mstrmojo.emptyFn,getMenuHandler:function U(){return mstrmojo.emptyFn;},renderErrorMessage:function Y(Z){this.domNode.innerHTML='<div class="mstrmojo-message">'+Z+"</div>";},getMessageID:function E(){return this.model.docModel.mid||this.model.mid;},performAction:function Q(Z){var b=this.model.getAction(Z),a=b&&b.h;if(a&&this.controller[a]){this.controller[a](this,b.a);return true;}return false;},findSelectorControl:function P(){var a=this.getData(),Z=a&&a.sc;if(Z&&parseInt(Z.ct,10)===6){this.selectorControl=Z;this.isMultiSelect=true;}else{delete this.selectorControl;}return this.selectorControl;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.EditableLabel","mstrmojo.ui.menus.MenuConfig","mstrmojo.css");var b=mstrmojo.css,N=1,L=2,F=4,c=8,K=16;function E(e){return function(){b.toggleClass(this.menuBtnNode,"active",e);};}function H(f){var k=new mstrmojo.ui.menus.MenuConfig(),j=this.getMenuActions(),e=this.index,l=this.id,g=this.total;if((j&K)>0){this.addNewTabMenuItem(k);}if((j&F)>0){k.addMenuItem(mstrmojo.desc(3397,"Duplicate"),"dup",function(){mstrmojo.all[l].tabDuplicated();});}if((j&L)>0){if(e){k.addMenuItem(mstrmojo.desc(5362,"Move Left"),"lft",function(){mstrmojo.all[l].tabMoved(true);});}if(e<g-1){k.addMenuItem(mstrmojo.desc(5363,"Move Right"),"rgt",function(){mstrmojo.all[l].tabMoved(false);});}}k.addSeparator();if((j&N)>0){k.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){mstrmojo.all[l].lbl.set("isEditing",true);});}if((j&c)>0){if(g>1){k.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){mstrmojo.all[l].tabDeleted();});}}var h=this.getCustomMenu();if(h&&h.hasMenuItems()){k.addSeparator();k.absorbMenuItems(h);}k.addPopupHandlers(this.id,E(true),E(false));this.showTabMenu(this.updateMenuCfg(k),f);}mstrmojo.vi.ui.tabs.Tab=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.Tab",markupString:'<div id="{@id}" class="mstrmojo-VITab unselectable {@cssClass}" style="{@cssText}" unselectable="on" mstrAttach:click><div><div class="mstrmojo-VITab-tab"></div><div class="mstrmojo-VITab-menu"></div></div></div>',markupSlots:{containerNode:function W(){return this.domNode.firstChild.firstChild;},menuBtnNode:function a(){return this.domNode.firstChild.lastChild;}},markupMethods:{ontitleChange:function Z(){this.lbl.set("text",this.title);},onisSelectedChange:function V(){mstrmojo.css.toggleClass(this.domNode,"selected",this.isSelected);},onzIndexChange:function D(){this.domNode.style.zIndex=this.zIndex;}},zIndex:1,menuBtnNode:null,lbl:null,title:"",index:-1,total:-1,isSelected:false,children:[{scriptClass:"mstrmojo.EditableLabel",alias:"lbl",editOnClick:false,onTextEditComplete:function Q(f,e){if(f){this.parent.titleEdited(this.text,e);}}}],postBuildRendering:function X(){if(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()){this.draggable=false;}this._super();},onclick:function d(e){var f=e.getTarget();if(f===this.menuBtnNode){H.call(this,f);}else{if(!this.isSelected){this.tabSelected();}}},getMenuActions:function I(){return 0;},getCustomMenu:function B(){return null;},isDragValid:function A(){return this.parent.children.length>1&&!this.lbl.isEditing;},createAvatar:function S(){var e=document.createElement("div");e.appendChild(this.domNode.cloneNode(true));e.style.margin="-5px 0 0 10px";return e;},allowDrop:function G(e){var f=e.src.widget;return f&&f.parent===this.parent;},ondrop:function Y(e){var f=e.src.data;this.parent.moveTab(f.idx,this.index,f.fromIdx);this._super(e);},ondragenter:function P(f){this._super(f);var g=f.src.data,e=this.index;this.parent.moveTab(g.idx,e);g.idx=e;},ondragover:function T(g){var e=g.tgt.node,f=g.tgtData,h=f&&f.node;if(!f||h!==e){g.tgtData={node:e};if(h){h.style.borderColor="";}}e.style.borderColor="#0fe88f";},getDragData:function C(){var g=this.id,e=this.index;return{setAvatarClass:function f(h){var l=mstrmojo.all[g],j=l.avatar;if(j){var k=[l.avatarCssClass,"hasOwnAvatar",h];j.className=k.join(" ");}},fromIdx:e,idx:e};},getDropAvatarIcon:function R(){return"pivot";},cleanUpAfterTarget:function J(f){var e=f.tgtData&&f.tgtData.node;if(e){e.style.borderColor="";}this._super(f);},onAppStateChange:function U(e){var f=this.lbl,g=e.value===mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;f.set("isEditing",false);f.set("editOnDoubleClick",!g);this.draggable=!g;},addNewTabMenuItem:function O(e){this.throwAbstractMethodError("addNewTabMenuItem");},tabSelected:mstrmojo.emptyFn,titleEdited:mstrmojo.emptyFn,tabMoved:mstrmojo.emptyFn,tabDeleted:mstrmojo.emptyFn,tabDuplicated:mstrmojo.emptyFn,showTabMenu:mstrmojo.emptyFn,updateMenuCfg:function M(e){return e;}});mstrmojo.vi.ui.tabs.Tab.ACTIONS={NEW_TAB:K,RENAME:N,MOVE:L,DUPLICATE:F,DELETE:c};}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.requiresDescs(2131,2122,2127,2125,2123,9938,2219,2220,520,612,521,523,522,524,525,526,686,2784,687,2785,688,2786,696,746,7555,13083,13084,4561,12939,12940,7227,13387,12078,12736);function L(r,n,q,AD,t,AA,o){var u=t?"height:"+t+"px;":"";var z=AA?"width:"+AA+"px;":"",AC=q[1],x="";var AB='<div class="mstrmojo-qb-DBTableRow-bullet" style="'+u+z+'">';if(AC==="tick"||AC==="mix"){x='style="font-weight: bold;"';AC=(AC==="tick")?0:16;}AB+='<div class="icon t'+AC+'"></div>';AB+='<div class="text" '+x+">"+r+"</div>";if(o&&o.length){for(var p=0;p<o.length;p++){AB+='<div class="cxtmenu '+o[p].n+'"></div>';}}AB+="</div></div>";return AB;}var I=mstrmojo.dom,F=mstrmojo.global.document,c=mstrmojo.array,J=mstrmojo.desc;var D,g,A;var a;function h(p,n,o){if(o!=null){g.innerHTML=o;}A.left=p.x+"px";A.top=p.y+"px";}function P(n,o){if(!D){D=F.createElement("div");A=D.style;A.position="absolute";A["z-index"]=9999;D.className="mstrmojo-qb-TableRow-avatar";D.innerHTML="<div></div>";g=D.firstChild;F.body.appendChild(D);}h(o,true,n);A.display="block";}function e(){if(D){A.display="none";}}function Z(o,n,q){if(!o.domNode){return false;}var p=I.position(o.domNode,true);return((p.y<=q)&&(p.x<=n)&&(p.x+p.w>=n)&&(p.y+p.h>=q));}function Y(p,n,r){var q=document.elementFromPoint(n,r);var o=I.findWidget(q);while(o){if(o.dropZone){if(o.allowDrop&&o.allowDrop(p)){return o;}}o=o.parent;}return null;}mstrmojo.qb.DBTableRow=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.DBTableRow",indent:0,text:"",checkBox:false,draggable:true,ownAvatar:true,dropZone:true,cxtmenus:null,allowDrop:function C(n){return true;},ondrop:function b(q){var p=q.src.widget,n=q.tgt.widget,o=mstrmojo.all.QBuilderModel;if(p.domNode.className.indexOf("mstrmojo-qb-DBTableRow")<0){return ;}if(p.srcID==n.srcID){return ;}if(o.joinsInfo[p.srcID+n.srcID]){o.addLink(p,n,p.srcID+n.srcID);}else{if(o.joinsInfo[n.srcID+p.srcID]){o.addLink(n,p,n.srcID+p.srcID);}else{o.addJoin(p,n,0,null);}}},_leftPos:0,_topPos:0,movable:false,dropTarget:null,markupString:'<div id="{@id}" class="mstrmojo-qb-DBTableRow {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,contextmenu></div>',markupMethods:{ontextChange:function(){this.domNode.innerHTML=L(this.text,this.indent,this.images,this.selected,null,null,this.cxtmenus);},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,oncssClassChange:function U(){this.domNode.className="mstrmojo-qb-DBTableRow "+(this.cssClass||"");}},getDragData:function(o){var n={};if(this.domNode){n.html=L(this.text,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth);n.n=this.text;}return n;},isDragValid:function S(n){return I.contains(this.domNode,n.src.node,true,document.body);},ondragstart:function(n){if(I.isWK){document.onselectstart=function(o){o.preventDefault();return false;};}this.domNode.style.cssText="opacity:0.3; filter: alpha(opacity=30);";a=I.position(this.domNode);P(L(this.text,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth),a);},ondragmove:function(o){var n=o.tgt.pos;h({x:n.x+5,y:n.y+5},true,L(this.text,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth));},ondragend:function(){if(I.isWK){document.onselectstart=function(){return true;};}if(this.domNode){this.domNode.style.cssText="opacity:1; filter: alpha(opacity=100);";}e();},onclick:function(o){var n=o.hWin,p=o.e||n.event,q=p.target||p.srcElement;if(q.type==="checkbox"){if(this.onCheck){this.onCheck(q.checked);}}},postBuildRendering:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-D",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPRIGHT,content:this.rIndex>=0?this.text:mstrmojo.desc(12736,"Add all columns")});if(!this._ontooltipover){var n=this.id;this._ontooltipover=function(p){var o=mstrmojo.all[n];o.showTooltip(p,self);};this._ontooltipout=function(p){var o=mstrmojo.all[n];o.hideTooltip(p,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return this._super();}});var W=[{n:J(2131,"Sum"),idx:1},{n:J(2122,"Average"),idx:2},{n:J(2127,"Minimum"),idx:3},{n:J(2125,"Maximum"),idx:4},{n:J(2123,"Count"),idx:5},{n:J(9938,"Count Distinct"),idx:6}];var d={SEPARATOR:-1,IN_LIST:0,NOT_IN_LIST:1,EXACTLY:2,NOT_EXACTLY:3,GREATER_THAN:4,LESS_THAN:5,GREATER_THAN_EQ:6,LESS_THAN_EQ:7,LIKE:8,NOT_LIKE:9,CONTAIN:10,NOT_CONTAIN:11,BEGIN_WITH:12,NOT_BEGIN_WITH:13,END_WITH:14,NOT_END_WITH:15,BETWEEN:16,NOT_BETWEEN:17},K={0:{did:2219,n:J(2219,"In list")},1:{did:2220,n:J(2220,"Not in list")},2:{did:520,n:J(520,"Exactly")},3:{did:612,n:J(612,"Not Exactly")},4:{did:521,n:J(521,"Greater than")},5:{did:523,n:J(523,"Less than")},6:{did:522,n:J(522,"Greater than equal")},7:{did:524,n:J(524,"Less than equal")},8:{did:525,n:J(525,"Like")},9:{did:526,n:J(526,"Not like")},10:{did:686,n:J(686,"Contains")},11:{did:2784,n:J(2784,"Does not contain")},12:{did:687,n:J(687,"Begins with")},13:{did:2785,n:J(2785,"Does not begin with")},14:{did:688,n:J(688,"Ends with")},15:{did:2786,n:J(2786,"Does not end with")},16:{did:"Between",n:J(696,"Between")},17:{did:"Not between",n:J(746,"Not between")}};var B=[d.IN_LIST,d.NOT_IN_LIST,d.SEPARATOR,d.EXACTLY,d.NOT_EXACTLY,d.SEPARATOR,d.GREATER_THAN,d.LESS_THAN,d.SEPARATOR,d.LIKE,d.NOT_LIKE],f=[d.IN_LIST,d.NOT_IN_LIST,d.SEPARATOR,d.EXACTLY,d.NOT_EXACTLY],V=[d.GREATER_THAN,d.LESS_THAN,d.SEPARATOR,d.GREATER_THAN_EQ,d.LESS_THAN_EQ,d.SEPARATOR,d.BETWEEN,d.NOT_BETWEEN],k=[d.LIKE,d.NOT_LIKE,d.SEPARATOR,d.CONTAIN,d.NOT_CONTAIN,d.SEPARATOR,d.BEGIN_WITH,d.NOT_BEGIN_WITH,d.SEPARATOR,d.END_WITH,d.NOT_END_WITH];mstrmojo.qb.DBTableRowMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.DBTableRowMenu",menuCssClass:"mstrmojo-qb-DBTableRowMenu",menuCfg:null,tableRow:null,handleAddColumn:function T(q){var n=this.tableRow,r=[n],p,o=mstrApp.getRootController(),t;p=o.gettIndex(n.parent.parent.id);t={success:function(){n.updateState(1);n.count++;}};o.addSelectedColumns(r,p,null,t);return true;},handleAddExpression:function m(p){var o=this.tableRow,n=0;mstrApp.getRootController().openExpressionEditor({type:n,w:o,tkn:o.expr});return true;},handleAddAggrColumn:function E(r){var o=r.ctxt,n=this.tableRow,u=o.aggrFuncIdx,t=[n],q,p=mstrApp.getRootController(),w;q=p.gettIndex(n.srcID);w={success:function(){if(n.state==0||n.state==2){n.state++;n.images[1]=n.img[n.state];n.render();}n.count++;}};p.addSelectedColumns(t,q,u,w);return true;},handleAddFuncExpr:function O(p){var n=p.ctxt,o=this.tableRow;mstrApp.getRootController().openExpressionEditor({type:0,selFuncItem:n,w:o});},getSubMenuConfigComFuncs:function X(n){var o=new mstrmojo.ui.menus.MenuConfig(),q,p=this;q=function(r){p.handleAddAggrColumn(r);};c.forEach(W,function(r){if(r.idx==6&&mstrApp.getRootController()&&mstrApp.getRootController().isBDE&&mstrApp.getRootController().isBDE==true){o.addDisabledMenuItem(r.n,"");}else{o.addMenuItem(r.n,"",q,{aggrFuncIdx:r.idx});}});return o;},getSubMenuConfigFuncs:function H(n){var p=new mstrmojo.ui.menus.MenuConfig(),u=this.id,q,r=this,o,t;q=function(w){r.handleAddFuncExpr(w);};if(!n){o=mstrApp.getRootController().getFunctionList();t=1;}else{o=n.funcList;t=n.depth;}c.forEach(o,function(w){if(w.fns&&w.fns.length){p.addSubMenuItem(w.n,"depth"+t.toString(),u,this.getSubMenuConfigFuncs,{funcList:w.fns,depth:t+1});}else{p.addMenuItem(w.n,"",q,w);}},this);return p;},handleAddFilter:function M(AA){var t=AA.ctxt,o=this.tableRow,n=t.opID,q=o.dt.tp,w={14:true,15:true,16:true},z={30:true},r={8:true,9:true,10:true,17:true,18:true,33:true},u,p,x;mstrApp.getRootController().openConditionDialog();switch(n){case K[d.BETWEEN].did:case K[d.NOT_BETWEEN].did:x=2;break;default:x=1;}p="mstr-qb-fve";u=mstrmojo.all[p]||(new mstrmojo.qb.FilterValueEditor({id:p,zIndex:1000}));u.n=AA.n;u.operatorID=n;u.column=o.oriexpr;u.isDateTime=!!w[q];u.isBigDecimal=!!z[q];u.isString=!!r[q];u.paraNum=x;u.open();},getSubMenuConfigClauses:function Q(r,n){var o=new mstrmojo.ui.menus.MenuConfig(),p,u=this,t,q;p=function(w){u.handleAddFilter(w);};switch(r){case"common":q=B;break;case"basic":q=f;break;case"numeric":q=V;break;case"string":q=k;break;}c.forEach(q,function(w){if(w===d.SEPARATOR){o.addSeparator();}else{t=K[w];o.addMenuItem(t.n,"",p,{opID:t.did});}});return o;},getSubMenuConfigComClauses:function G(n){return this.getSubMenuConfigClauses("common",n);},getSubMenuConfigAllClauses:function N(n){var o=new mstrmojo.ui.menus.MenuConfig(),p=this.id;o.addSubMenuItem(J(7227,"Basic"),"",p,this.getSubMenuConfigAllClausesBasic,n);o.addSubMenuItem(J(13387,"Comparison"),"",p,this.getSubMenuConfigAllClausesNumeric,n);o.addSubMenuItem(J(12078,"Pattern"),"",p,this.getSubMenuConfigAllClausesString,n);return o;},getSubMenuConfigAllClausesBasic:function R(n){return this.getSubMenuConfigClauses("basic",n);},getSubMenuConfigAllClausesNumeric:function j(n){return this.getSubMenuConfigClauses("numeric",n);},getSubMenuConfigAllClausesString:function l(n){return this.getSubMenuConfigClauses("string",n);},getMenuConfig:function(){var o=this.menuCfg,r=this.id,n,p,q=this;if(!o){o=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{o.clear();}n=function(t){q.handleAddColumn(t);};p=function(t){q.handleAddExpression(t);};o.addMenuItem(J(7555,"Add Column"),"",n);if(q.tableRow.enableExpr){o.addMenuItem(J(13083,"Edit Column"),"",p);}o.addSeparator();o.addSubMenuItem(J(13084,"Basic Functions"),"",r,this.getSubMenuConfigComFuncs);o.addSubMenuItem(J(4561,"All Functions"),"",r,this.getSubMenuConfigFuncs);o.addSeparator();o.addSubMenuItem(J(12939,"Basic Filters"),"",r,this.getSubMenuConfigComClauses);o.addSubMenuItem(J(12940,"All Filters"),"",r,this.getSubMenuConfigAllClauses);return o;}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown");var H=mstrmojo.array,C=mstrmojo.hash,B=19,J=13,D=27;mstrmojo.ui.SearchablePulldown=mstrmojo.declare(mstrmojo.ui.Pulldown,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.ui.SearchablePulldown",editableSlot:"selectedNode",allowCustomText:false,isSearching:false,editOnClick:false,init:function K(P){this._super(P);var M=this.getPopupList();M.renderOnScroll=this.renderOnScroll||M.renderOnScroll;M.renderBlockSize=this.renderBlockSize||M.renderBlockSize;mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-SearchablePulldown");var O=M.constructor.prototype,N=M.getItemProps?M.getItemProps:O.getItemProps,Q=M.getItemMarkup?M.getItemMarkup:O.getItemMarkup;M.getItemProps=function(V,R){var S=this._spft||"",W=V.n,T=W.toUpperCase().indexOf(S);if(T===-1){S="";}var U=N.call(this,V,R);U.before=W.slice(0,T);U.input=W.substring(T,T+S.length);U.after=W.slice(T+S.length,W.length);return U;};M.getItemMarkup=function(S,R){return Q.call(this,S,R).replace("{@en@n}","{@en@before}<span class='sp-highlight'>{@en@input}</span>{@en@after}");};},onclick:function L(M){var P=this.selectedNode,Q=M.getTarget(),R=M.e.offsetX>=(P.offsetWidth-B),O=this.getPopupWidget(),N=O.visible;if(Q===P&&(!N||(N&&R))){this.set("isEditing",!N);this._super(M);}},onPopupWidgetClosed:function F(){this.set("isEditing",false);var P=this.getPopupList(),Q=P._oldItems,N=this.text;delete P._oldItems;if(Q){var M=H.find(Q,"n",N);if(M===-1&&!this.allowCustomText){var O=P.items[0]||Q[0];M=H.find(Q,"n",O.n);}P.set("items",Q);this.set("selectedIndex",M);}},_set_selectedIndex:function E(O,M){if(this.allowCustomText&&M===-1){this.selectedIndex=-1;this.onitemSelected(null,M);}else{this.isSearching=false;this._super(O,M);if(this.hasRendered){var N=this.selectedNode;this.text=N.innerText?N.innerText:N.textContent;}}return true;},onkeydown:function G(N){this._super(N);var M=window.event||N.e;if(M.keyCode===J){this.getPopupList().close();}},onkeyup:function A(O){this._super(O);var M=window.event||O.e,P=M.keyCode,N=this.getPopupList();if(P===D||P===J){N.close();}else{this.processSearch();}},processSearch:function I(){this.isSearching=true;this.hideTooltip();var M=[],O=this.getPopupList(),P=this.selectedNode.innerHTML,Q=O._oldItems||O.items,N=P.toUpperCase();N=N.replace(/<BR>/,"");if(N.length>0){H.forEach(Q,function(R){if(R.n.toUpperCase().indexOf(N)>-1){M.push(C.clone(R));}},this);}else{M=Q;}O._spft=N;if(this.customizeSearchResult){this.customizeSearchResult(M);}O.set("items",M);O.adjustCornersForPopupOverflow();delete O._spft;O._oldItems=Q;O.set("visible",M.length!==0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.array","mstrmojo.Editor","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.Button","mstrmojo.Label","mstrmojo.DynamicClassFactory","mstrmojo.ui.Pulldown");var E=mstrmojo.array,D=mstrmojo.DynamicClassFactory.newComponent;mstrmojo.architect.ui.SimpleList=D(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.architect.ui.SimpleList"});function C(){var F=this.secondaryList,G=this.primaryDBRole;this.close();this.onSubmit({did:this.dataSources.did,primaryId:G.id,primaryName:G.n,secondary:F.getSelectedItems()});}mstrmojo.architect.ui.editors.DataSourceEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.DataSourceEditor",cssClass:"mstrmojo-ar-DataSourceEditor",title:mstrmojo.desc(4381,"Data Sources"),help:null,primaryPulldown:undefined,secondaryList:undefined,onSubmit:mstrmojo.emptyFn,onOpen:function A(){var F=this.dataSources.dbRoles;this.primaryPulldown.set("items",F);this.primaryPulldown.set("selectedIndex",E.find(F,"id",this.dataSources.primaryId));},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11387,"Primary Data Source")+":"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"primaryPulldown",onitemSelected:function B(L,I){var H=this.items.concat(),K=this.parent,G=K.secondaryList;H.splice(I,1);G.clearSelect(true);G.set("visible",H.length!==0);G.set("items",H);var J={};E.forEach(H,function F(N,M){J[M]=true;});G.set("selectedIndices",J);K.primaryDBRole=L;}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11389,"Secondary Data Source(s):")},{scriptClass:"mstrmojo.architect.ui.SimpleList",cssClass:"mstrmojo-ar-SecondaryDBRoles",multiSelect:true,selectionPolicty:"reselect",alias:"secondaryList"},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(1442,"OK"),slot:"buttonNode",onclick:function(){C.call(this.parent);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui.Pulldown");var F=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingPulldown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",cssClass:"mstrmojo-wh-DBRolePulldown",postBuildRendering:function A(){if(this._super){this._super();}this.captionlbl.set("text",this.caption);this.list.set("itemIdField",this.itemIdField);this.list.set("itemField",this.itemField);this.onenabledChange();if(typeof this.allowHTML==="boolean"){this.list.set("allowHTML",this.allowHTML);}},caption:"",contains:function C(M){var L=mstrmojo.array.find(this.items,this.itemIdField,M);return(L>0);},itemIdField:"",itemField:"n",items:null,onitemsChange:function K(){this.list.set("items",this.items);},selectedID:null,onselectedIDChange:function E(){var L=Math.max(F.find(this.items,this.itemIdField,this.selectedID),0);if(this.items&&this.items[L]){this.list.set("selectedIndex",L);}if(this.selectedID){this.selectedItem=this.items[L];}},selectedItem:undefined,enabled:true,onenabledChange:function G(){this.captionlbl.set("enabled",this.enabled);this.list.set("enabled",this.enabled);},getValue:function D(){var L=this.selectedItem||this.items[0];if(L){return L.v;}return"";},setValue:function B(L){this.set("selectedID",L);},isValid:function J(){return{val:true,msg:""};},onChange:mstrmojo.emptyFn,captionlbl:undefined,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",alias:"captionlbl"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"list",onitemSelected:function H(O,M){var N=this.parent,L=(N.selectedItem?N.selectedItem.id:"");if(O[this.itemIdField]!==L){N.set("selectedItem",O);if(N.onChange){N.onChange(O,M);}}},onitemsChange:function I(){var L=this.parent;L.selectedID=null;}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.HBox","mstrmojo.EnumAuthenticationModes","mstrmojo.UsherLogin","mstrmojo.string","mstrmojo.cookies");mstrmojo.requiresDescs(17,18,221,11804,11863);var E=mstrmojo.EnumAuthenticationModes,D={};D[E.LDAP]=mstrmojo.desc(1947,"LDAP Authentication");D[E.DATABASE]=mstrmojo.desc(1948,"Database Authentication");var K={LIVE_OR_HL:0,PERSISTED:1};function B(){return(JSON.parse(decodeURIComponent(mstrmojo.cookies.getCookieSetting("lastMsgID")||"{}")))[mstrConfig.lastMsgKey];}function C(){var P=this,Q=P.stdLoginInfo,N=Q.user.value,M=Q.tsvCode.value,R=Q.pwd.value,S={taskId:"login",server:mstrConfig.serverName,project:mstrmojo.string.decodeHtmlString(mstrConfig.projectName),port:mstrConfig.serverPort,authMode:mstrConfig.authMode,setAsActiveSession:true};var O=B();if(O){S.msgID=O;}if((this.authMode&(E.STANDARD|E.LDAP|E.DATABASE))>0){S.userid=N;S.password=R;S.tsvCode=M;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(V){if(V&&V.sessionState){mstrApp.updateSessionState(V.sessionState);if(mstrApp.sessionManager){mstrApp.sessionManager.restart();}var X=V;var U=V.resCode;if(U==K.LIVE_OR_HL&&(mstrApp.isVI||mstrApp.scriptClass==="mstrmojo.OIVMApp"||mstrApp.analysisID)){mstrmojo.xhr.request("post",mstrConfig.taskURL,{success:function(){var Y=P.config.callback,Z=Y.success;if(Z){Z(X);}},failure:function(){mstrmojo.form.send({evt:3010,src:mstrApp.name+".3010"},null,"POST");}},{taskId:"docXMLResults",sessionState:V.sessionState,msgID:V.msgID,resultFlags:33554432});}else{var T=P.config.callback,W=T.success;if(W){W(X);}}}P.destroy();},failure:function(T){mstrmojo.alert(T.getResponseHeader("X-MSTR-TaskFailureMsg"),null,null,P.zIndex);}},S);}function L(){if(mstrApp.sessionManager){mstrApp.sessionManager.gotoLogoutPage();}}mstrmojo.LoginEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.LoginEditor",cssClass:"mstrmojo-LoginEditor",title:mstrmojo.desc(11804,"Log in to"),btnAlignment:"right",help:"login_box",config:{callback:{},taskParams:{}},authMode:E.STANDARD,usherEnabled:false,init:function J(M){this._super(M);this.title+=" "+mstrApp.projectName;this.set("authMode",parseInt(mstrConfig.authMode,10));if(this.isUsherLogin()){mstrmojo.css.addWidgetCssClass(this,"usher");}},isUsherLogin:function(){return this.authMode===E.USHER;},onvisibleChange:function I(){if(this.visible&&(mstrmojo.dom.isFF||mstrmojo.dom.isWK)){var M=this.stdLoginInfo.user;window.setTimeout(function(){M.focus();},50);}},onClose:function F(){L();},destroy:function H(){mstrmojo.dom.detachEvent(document.body,"mousedown",this.stopPropagation,true);this._super();},postBuildRendering:function A(){if(this.authMode===mstrmojo.EnumAuthenticationModes.NTCREDENTIAL){C.call(this);return ;}else{var M=this._super();this.stopPropagation=function(N){N.stopPropagation();};mstrmojo.dom.attachEvent(document.body,"mousedown",this.stopPropagation,true);return M;}},preBuildRendering:function G(){if(this.isUsherLogin()){var N=this,M=mstrmojo.insert({scriptClass:"mstrmojo.UsherLogin",alias:"usherLogin",onUsherLogin:function(){mstrConfig.authMode=E.USHER;C.call(N);}});this.addChildren([M],1);}return this._super();},children:[{scriptClass:"mstrmojo.Label",cssText:"margin-bottom: 20px; line-height: 1.5em;",text:mstrmojo.desc(11863,"Your user session has timed out due to inactivity, and you have been automatically logged out. Please log in again.")},{scriptClass:"mstrmojo.Box",alias:"stdLoginInfo",cssClass:"std-login-container",bindings:{visible:function(){return this.parent.authMode!==E.USHER;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"user",cssClass:"login-username",cssDisplay:"block",hint:mstrmojo.desc(17,"User name"),postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(17,"User name");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.TextBox",alias:"pwd",cssClass:"login-pwd",cssDisplay:"block",hint:mstrmojo.desc(18,"Password"),type:"password",postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(18,"Password");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.TextBox",alias:"tsvCode",cssClass:"login-tsvCode",cssDisplay:"block",hint:mstrmojo.desc(13825,"Usher code"),bindings:{visible:function(){return mstrConfig.features["is-two-step-verification-required"];}},postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(13825,"Usher code");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-LoginEditor-authMode",bindings:{visible:function(){return this.parent.parent.authMode===E.LDAP||this.parent.parent.authMode===E.DATABASE;},text:function(){return D[this.parent.parent.authMode]||"";}}}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",alias:"btns",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:mstrmojo.desc(26,"Login"),bindings:{enabled:"this.parent.parent.stdLoginInfo.user.value.length > 0",visible:function(){return this.parent.parent.authMode!==E.USHER;}},onclick:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){L();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME.DerivedMetricOptions");mstrmojo.requiresDescs(2140);var B=mstrmojo.array;mstrmojo.ME._DerivedMetricEditorHelper=mstrmojo.provide("mstrmojo.ME._DerivedMetricEditorHelper",{isDME:true,noCache:false,closeLabel:mstrmojo.desc(2140,"Cancel"),saveAsEnabled:false,tbBrowsable:false,init:function C(D){this._super(D);},onApplyMetricCallback:mstrmojo.emptyFn,optionPopupRef:{scriptClass:"mstrmojo.ME.DerivedMetricOptions",title:mstrmojo.desc(13035,"Metric Options"),help:"Metric_Options_dialog_box.htm",width:300},replaceAttributeWithForms:function A(E){var D=[];B.forEach(E,function(F){if(F.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Attribute&&F.fs){B.forEach(F.fs,function(G){if(G.obf||F.da){D.push({n:F.n+"@"+G.fnm,did:F.did+"@"+G.fid,fmdid:G.fid,fnm:G.fnm,t:G.t,frm:G,oi:F,path:F.path});}});}else{D.push(F);}});return D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo._HasSuggestion");var F=-1,E=0,D=1;mstrmojo._ValidateSuggestions=mstrmojo.provide("mstrmojo._ValidateSuggestions",mstrmojo.hash.copy(mstrmojo._HasSuggestion,{_mixinName:"mstrmojo._ValidateSuggestions",itemValidationField:"did",verifyObject:function C(J,H){var M=this.candidates,L;if(M){var I=M.items,G=mstrmojo.array.find(I,this.itemValidationField,H.data[this.itemValidationField]);G=G>-1?G:mstrmojo.array.find(I,this.itemField,J);if(G>-1){H.updateData(I[G]);L=E;}else{if(M.isComplete){L=D;}}}if(L!==undefined){return L;}var K=this._vqueue=this._vqueue||[];K.push({pattern:J,id:H.data[this.itemIdField]});if(!this._vInProgress){this.verifyNextCandidate();}return F;},verifyNextCandidate:function B(){var G=this._vqueue;if(!G||G.length===0){this._vInProgress=false;return ;}this.verifyCandidate(G.shift());},verifyCandidate:function A(H){var G=this;this._vInProgress=true;this.getCandidatesThroughTaskCall({pattern:H.pattern,blockBegin:1,blockCount:G.noCache?-1:this.suggestCount,isVerify:true},{success:function(N){var K=G.ctxtBuilder.itemWidgets,J=K&&K.length,O,M;for(M=0;M<J;M++){if(K[M].data[G.itemIdField]===H.id){O=K[M];break;}}if(!O){return ;}var L=N.items;if(L&&L.length===1){O.updateData(L[0]);}else{if(L&&L.length>1){var I=mstrmojo.array.find(L,"did",O.data.did);if(I>-1){O.updateData(L[I]);}else{O.set("state",D);}}else{O.set("state",D);}}},failure:function(I){mstrmojo.alert(I.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){G.verifyNextCandidate();}});}}));mstrmojo._ValidateSuggestions.ENUM_STATES={UNDETERMINED:F,VALID:E,INVALID:D};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.range","mstrmojo.Widget","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo._HasSuggestion","mstrmojo.ME.MetricToken","mstrmojo.ME.MetricDataService","mstrmojo.ui.ScrollableSuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var M=mstrmojo.dom,O=mstrmojo.css,AA=mstrmojo.Enum_Keys,D=mstrmojo.range,c=D.EDGE,q=mstrmojo.ME.MetricToken.isDelimiter,L=mstrmojo.expr,h=mstrmojo.array,H=mstrmojo.hash;function AH(E){return E.ctrlKey||M.isMetaKey(window,E);}mstrmojo.ME.SpanListMapper=mstrmojo.provide("mstrmojo.SpanListMapper",mstrmojo.mixin({itemWrapperPrefix:function(E){return'<span class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"&nbsp;",itemWrapperSuffix:"</span>",createWrapperNode:function N(E){var AI=E.ownerDocument,AJ=AI.createElement("span");return AJ;},_iw2idx:function P(AI,AL,AK){var AJ=this.wrapperNodes(AL),E=mstrmojo.array.indexOf(AJ,AK);return E===-1?AJ.length:E;},itemOffsetLeft:function a(AI,AM,E,AK){if(!AK){var AJ=this.wrapperNodes(AM);AK=AJ&&AJ[E];if(!AK){return 0;}}var AL=AM.firstChild;if(!AL||(AL===AK)){return 0;}return AK.offsetLeft-AL.offsetLeft;},whereDrop:function AG(AQ,E,AK,AP,AI){var AM=this._nd2iw(AQ,E,AK),AR,AO,AL,AN,AJ;if(AM){AO=this._iw2idx(AQ,E,AM);AR=AO;AL=this.itemOffsetLeft(AQ,E,null,AM);AN=AM.offsetTop;AJ=AM.offsetWidth;if(AP.x>AI.left+AL+AJ/2){AR++;AL+=AJ;}}else{return AQ.dropCuePos;}return{left:AL,top:AN,idx:AR,idxActual:AO};}},mstrmojo.hash.copy(mstrmojo.WidgetListMapper)));mstrmojo.ME.TokenInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._HasSuggestion],{scriptClass:"mstrmojo.ME.TokenInputBox",containerResizable:false,dropZone:true,suggestionPopupCssClss:"mstrmojo-ME-TokenInputBox-suggest",allowDrop:function C(E){var AI=E.src.data;return !!AI;},ondrop:function(E){E.src.data={v:mstrmojo.ME.MetricToken.brackets(E.src.data.item.n),oi:H.copyProps(["did","n","t"],E.src.data.item),isNew:true};if(this.prepareDropItem){this.prepareDropItem(E);}this.insertTokens([E.src.data]);this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");},ondragenter:function F(E){this.dragdata=E.src.data;this._super(E);this.set("dropCuePos",{left:0,top:0});mstrmojo.css.addClass(this.domNode,"unselectable");},ondragleave:function Q(){this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");},ondropCuePosChange:function S(AI){var AJ=AI.value,E=this.dragdata;if(E&&E.setAvatarClass){if(AJ){E.setAvatarClass("add");}else{E.setInvalidAvatarClass();}}},makeObservable:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,markupString:'<div id={@id} class="mstrmojo-TokenInputBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-TokenInputBox-edit" contenteditable="true" tabindex="1" spellcheck="false"ondragstart = "return false;" oncontextmenu = "document.oncontextmenu =  mstrmojo.all.{@id}.fnContextMenu;" onkeydown = "return mstrmojo.all.{@id}.handlekeydown(event);" onkeypress = "return mstrmojo.all.{@id}.handlekeypress(event);" onkeyup = "return mstrmojo.all.{@id}.handlekeyup(event);" onmouseup = "return mstrmojo.all.{@id}.handlemouseup(event);" onpaste = "return mstrmojo.all.{@id}.handlepasteDirect(event);" >{@itemsHtml}</div><textarea class = "mstrmojo-TokenInputBox-clipboard" onkeyup = "return mstrmojo.all.{@id}.handlepaste(event);"></textarea><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild;},clipboardNode:function(){return this.domNode.childNodes[1];},scrollboxNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",items:null,itemFunction:function G(AJ,E,AI){return new mstrmojo.ME.MetricToken({data:AJ,parent:AI});},listMapper:mstrmojo.ME.SpanListMapper,_set_items:function R(AI,E){if(this._super){this._super(AI,E);}if(!this.tokensCacheInitilized){this.pretokensModify();this.tokensCacheInitilized=true;}},tokensCache:[],tokensCachePointer:0,isDelimiter:q,postBuildRendering:function X(){if(this._super){this._super();}this._eros=false;if(M.isFF){document.body.spellCheck=false;}},fnContextMenu:function I(E){if(E){E.cancelBubble=true;E.returnValue=false;}return false;},handlekeydown:function V(AN){AN=AN||window.event;var AL=AN.keyCode||AN.charCode,AJ=false,AO=D.getRangeInfo();if((AH(AN)||AL===AA.LEFT_ARROW||AL===AA.RIGHT_ARROW)&&this.doubleByte){this.doubleByte=false;var AM=this.prev_rInfo,AI=AO,AP=AI.startContainer.data.slice(AM.startOffset,AO.startOffset);this.widgetHandleImeInput(AM,AP);return ;}switch(AL){case AA.DELETE:if(!this.doubleByte){try{this.widgetHandleDelete(AO);this.startTokenSuggestion();this.raiseChangeEvent({type:"delete"});}catch(AK){}AJ=true;}break;case AA.BACKSPACE:if(!this.doubleByte){try{this.widgetHandleBackspace(AO);this.raiseChangeEvent({type:"backspace"});this.startTokenSuggestion();this.editNode.focus();}catch(E){}AJ=true;}break;case AA.ENTER:if(this.breakOnEnterKeyDown&&this.breakOnEnterKeyDown()){break;}case AA.TAB:this._startDebug=true;if(this.suggestionShown){this.handleSuggestionItemSelect(this.getSelected());}else{this.startTokenSuggestion();}AJ=true;break;case AA.ESCAPE:this.endTokenSuggestion();AJ=true;break;case 86:if(AH(AN)){this._saveRangeInfo=D.getRangeInfo();if(!this._saveRangeInfo.collapsed){this.widgetHandleDelete(this._saveRangeInfo);this._saveRangeInfo=D.getRangeInfo();}this.clipboardNode.focus();AJ=false;}break;case 89:if(AH(AN)){this.widgetHandleUndoRedo("redo");AJ=true;}break;case 90:if(AH(AN)){this.widgetHandleUndoRedo("undo");AJ=true;}break;case 229:if(!this.doubleByte){this.doubleByte=true;this.prev_rInfo=AO;this.prev_items=this.items;}break;default:}if(AJ){M.stopPropogation(window,AN);M.preventDefault(window,AN);return false;}return true;},getCharacter:function AC(AI){var E=(M.isIE&&!M.isIE9)?AI.keyCode:AI.charCode;return(E>0)?String.fromCharCode(E):null;},handlekeypress:function A(AK){AK=AK||window.event;var AL=this.getCharacter(AK),AI=false;if(AL&&!((AL==="c"||AL==="a")&&AH(AK))){try{this.widgetHandleInput(D.getRangeInfo(),AL);this.raiseChangeEvent({type:"input",character:AL});if(!this.isDelimiter(AL)){if(this.useKeyDelay){var AJ=this;window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){AJ.startTokenSuggestion();},mstrmojo.ME.MetricDataService.suggestDelay);}else{this.startTokenSuggestion();}}else{this.endTokenSuggestion(true);}}catch(E){}AI=true;}if(AI){M.stopPropogation(window,AK);M.preventDefault(window,AK);return false;}return true;},handlekeyup:function Y(AJ){var E=AJ.keyCode||AJ.charCode,AI;if(E===AA.LEFT_ARROW||E===AA.RIGHT_ARROW){AI=this.findObjectToken();if(AI&&AI===this._saveActiveToken){this.startTokenSuggestion(AI);}else{this.endTokenSuggestion();}}else{if(E===AA.UP_ARROW){this.preHighlight();}else{if(E===AA.DOWN_ARROW){this.nextHighlight();}}}this._saveRangeInfo=D.getRangeInfo();},handlemouseup:function g(AN){if(this.dropCuePos){return false;}var AJ=this.findObjectToken();if(AJ&&AJ===this._saveActiveToken){this.startTokenSuggestion(AJ);}else{this.endTokenSuggestion();}var AL=D.getRangeInfo();if(this.doubleByte){this.doubleByte=false;var AM=this.prev_rInfo,AK=this._saveRangeInfo,AI=AK.startContainer.data.slice(AM.startOffset,AK.startOffset+1);if(AI!==""){var E=this.widgetHandleImeInput(AM,AI);this.prev_items=this.items;AJ=M.findWidget(AL.startContainer);if(AJ){this._delaySetTextCaretPos(AJ.domNode,AL.startOffset);}else{this._delaySetTextCaretPos(E.domNode,AL.startOffset-1);}}this.prev_rInfo=AL;}this._saveRangeInfo=AL;},handlepasteDirect:function w(E){this.clipboardNode.value=E.clipboardData.getData("Text");this.handlepaste(E);M.stopPropogation(window,E);M.preventDefault(window,E);return false;},handlepaste:function e(AM){var AI=this.clipboardNode.value;this.clipboardNode.value="";var AL=[],E=AI&&AI.length,AK,AJ="",AN;if(E>0){for(AK=0;AK<E;AK++){AN=AI.charAt(AK);if(this.isDelimiter(AN)){if(!mstrmojo.string.isEmpty(AJ)){AL.push({v:AJ,isNew:true});AJ="";}AL.push({v:AN,isDelimiter:true,isNew:true});}else{AJ=AJ+AN;}}if(!mstrmojo.string.isEmpty(AJ)){AL.push({v:AJ,isNew:true});AJ="";}this.insertTokens(AL);}},raiseChangeEvent:function(E){E.name="tokensModify";this.raiseEvent(E);},getTokensAsString:function AF(){var AI=[],AK=this.items,AJ,E;for(AJ=0,E=AK.length;AJ<E;AJ++){AI[AJ]=AK[AJ].v;}return AI.join("| ");},replaceErrorToken:function j(AK){var AJ=this.items||[],AL=mstrmojo.array.find(AJ,"sta",-1),AI,AM=function(AS,AQ,AT){var AP=(AS&&AS.items)||[],AO=h.find(AP,"did",AQ),AN,AR;if(AO>-1){AN=AP[AO].fs;AR=h.filterOne(AN,function(AU){return AU.fnm&&AU.fnm.toUpperCase()===AT.toUpperCase();});}return AR;},E=function(AS,AQ,AR){var AN={v:AQ.n,oi:AQ,isNew:true},AP=AS.v&&AS.v.split("@"),AO;if(AP&&AP.length>1){AO=AM(AR,AQ.did,AP[1]);if(AO){AN.exv=AO.fmdid||AO.fid;AN.extp=8;AN.v=mstrmojo.ME.MetricToken.brackets(AQ.n)+"@"+AO.fnm;}}return AN;};if(AL>-1){AI=E(AJ[AL],AK,this.candidates);this.remove(AL);this.add([AI],AL);}},widgetHandleDelete:function Z(AL){if(AL.collapsed){var AK,AJ,E,AM=AL.startOffset,AI=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AL.startContainer,false,document.body)){D.collapseOnNode(this.editNode,false);return ;}AK=D.getEdgeInfo(AL.startContainer,AL.startOffset);AJ=M.findWidget(AL.startContainer);E=this.itemIndex(AJ.data);if(AK===c.EDGE_END){E++;AJ=AI[E];AM=0;}if(!AJ){D.collapseOnNode(this.editNode,false);return ;}if(AJ.length()===1){this.remove(E);AJ=AI[E];if(AJ){D.collapseOnNode(AJ.domNode,true);}else{D.collapseOnNode(this.editNode,false);}this.checkMergeTwoTokens(E-1,E);}else{AJ.spliceContent(AM,1);D.collapseOnTextNode(AJ.domNode,AM);}}else{this.widgetDeleteTokens(AL);}},widgetHandleBackspace:function p(AL){if(AL.collapsed){var AK,AJ,E,AM=AL.startOffset,AI=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AL.startContainer,false,document.body)){if(AL.startOffset>0&&M.isFF){AJ=AI[this.items.length-1];D.collapseOnNode(AJ.domNode,false);AL=D.getRangeInfo();AK=D.getEdgeInfo(AL.startContainer,AL.startOffset);}else{D.collapseOnNode(this.editNode,true);return ;}}AK=D.getEdgeInfo(AL.startContainer,AL.startOffset);AJ=M.findWidget(AL.startContainer);E=this.itemIndex(AJ.data);if(AK===c.EDGE_BEGIN){E--;AJ=AI[E];AM=AJ.length();}if(!AJ){D.collapseOnNode(this.editNode,true);return ;}if(AJ.length()===1){this.remove(E);AJ=AI[E-1];if(AJ){D.collapseOnNode(AJ.domNode,false);this.checkMergeTwoTokens(E-1,E);AJ=AI[E-1];}else{D.collapseOnNode(this.editNode,true);}}else{AJ.spliceContent(AM-1,1);D.collapseOnTextNode(AJ.domNode,AM-1);}}else{this.widgetDeleteTokens(AL);}},widgetHandleInput:function r(AM,AN){if(!AM.collapsed){this.widgetDeleteTokens(AM);AM=D.getRangeInfo();}var AJ,AO,AP,AQ,E,AI,AK=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AM.startContainer,false,document.body)){this.add([{v:AN,isDelimiter:this.isDelimiter(AN),isNew:true}],0);AO=AK[0];D.collapseOnTextNode(AO.domNode,1);return ;}AJ=D.getEdgeInfo(AM.startContainer,AM.startOffset);AO=M.findWidget(AM.startContainer);AP=this.itemIndex(AO.data);if(this.isDelimiter(AN)){AQ={v:AN,isDelimiter:true,isNew:true};if(AJ===c.EDGE_MIDDLE){var AL=AO.split2Tokens(AM.startOffset);this.remove(AP);this.add([AL[0],AQ,AL[1]],AP);AP=AP+1;}else{AP=(AJ===c.EDGE_BEGIN)?AP:AP+1;this.add([AQ],AP);}AO=AK[AP];D.collapseOnNode(AO.domNode,false);}else{AI=AM.startOffset;if(AO.isDelimiter()){E=AK[(AJ===c.EDGE_BEGIN)?AP-1:AP+1];if(E&&!E.isDelimiter()){AO=E;AI=(AJ===c.EDGE_BEGIN)?AO.length():0;}}if(!AO.isDelimiter()){AO.spliceContent(AI,0,AN);D.collapseOnTextNode(AO.domNode,AI+1);}else{this.add([{v:AN,isNew:true}],(AJ===c.EDGE_BEGIN)?AP:AP+1);AO=AK[(AJ===c.EDGE_BEGIN)?AP:AP+1];D.collapseOnNode(AO.domNode,false);}}},widgetHandleImeInput:function r(AL,AM){if(!AL.collapsed){this.widgetDeleteTokens(AL);AL=D.getRangeInfo();}var AJ,AN,AO,AP,E,AI,AK=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AL.startContainer,false,document.body)){this.clearTokens();this.add([{v:AM,isDelimiter:this.isDelimiter(AM),isNew:true}],0);AK=this.ctxtBuilder.itemWidgets;AN=AK[0];D.collapseOnTextNode(AN.domNode,1);this._delaySetCaretPos(AN.domNode,false);return ;}AJ=D.getEdgeInfo(AL.startContainer,AL.startOffset);AN=M.findWidget(AL.startContainer);AO=this.itemIndex(AN.data);AI=AL.startOffset;if(AN.isDelimiter()){this.clearTokens();this.set("items",this.prev_items);AK=this.ctxtBuilder.itemWidgets;E=AK[(AJ===c.EDGE_BEGIN)?AO-1:AO+1];if(E&&!E.isDelimiter()){AN=E;AI=(AJ===c.EDGE_BEGIN)?AN.length():0;}}if(!AN.isDelimiter()){AN.spliceContent(AI,0,AM);this._delaySetTextCaretPos(AN.domNode,AI+AM.length);}else{this.add([{v:AM,isNew:true}],(AJ===c.EDGE_BEGIN)?AO:AO+1);AN=AK[(AJ===c.EDGE_BEGIN)?AO:AO+1];this._delaySetCaretPos(AN.domNode,false);}this.startTokenSuggestion();return AN;},findObjectToken:function B(){var AL=D.getRangeInfo(),AJ=M.findWidget(AL.startContainer);if(!M.contains(this.editNode,AL.startContainer,false,document.body)){return null;}if(!AJ||AJ===this||!AJ.isDelimiter){return null;}if(AJ&&!AJ.isDelimiter()){return AJ;}var AK=D.getEdgeInfo(AL.startContainer,AL.startOffset),AI=this.ctxtBuilder.itemWidgets,E=this.itemIndex(AJ.data);AJ=AI[(AK===c.EDGE_BEGIN)?E-1:E+1];if(AJ&&!AJ.isDelimiter()){return AJ;}return null;},checkMergeTwoTokens:function n(AL,AJ){var AK=this.ctxtBuilder.itemWidgets,AI=AK[AL],E=AK[AJ];if((AI&&!AI.isDelimiter())&&(E&&!E.isDelimiter())){this.remove([AL,AJ]);this.add([AI.mergeTo(E)],AL);D.collapseOnTextNode(AK[AL].domNode,AI.length());}},insertTokens:function u(AO){var E=0,AI=this.editNode;var AN=this._saveRangeInfo||D.getRangeInfo();if(!AN||!M.contains(AI,AN.startContainer,false,document.body)){this.add(AO);E=this.items.length-1;this._delaySetTextCaretPos(AI,(AI.innerText||AI.textContent).length);}else{var AM=D.getEdgeInfo(AN.startContainer,AN.startOffset),AJ=M.findWidget(AN.startContainer);E=this.itemIndex(AJ.data);if(AM===c.EDGE_MIDDLE){var AL=AJ.split2Tokens(AN.startOffset);this.remove(E);AO.unshift(AL[0]);AO.push(AL[1]);this.add(AO,E);}else{E=(AM===c.EDGE_BEGIN?E:E+1);this.add(AO,E);}E=E+AO.length-1;AJ=this.ctxtBuilder.itemWidgets[E];this._delaySetCaretPos(AJ.domNode,false);}this.raiseChangeEvent({type:"insert"});var AK=this;window.setTimeout(function(){AK._saveRangeInfo=D.getRangeInfo();},50);return E;},insertParenthesisTokens:function z(AI){var E=this;window.setTimeout(function(){var AJ=E.insertTokens([{v:"(",isDelimiter:true,isNew:true},{v:")",isDelimiter:true,isNew:true}]);E._delaySetTextCaretPos(E.itemsContainerNode.childNodes[AJ]);},AI||50);},clearTokens:function m(E){this.set("items",E||[]);this._saveRangeInfo=null;this._delaySetCaretPos(this.editNode,false);},focus:function t(){var AI=this.ctxtBuilder.itemWidgets,E=AI.length;this._delaySetCaretPos(E>0?AI[E-1].domNode:this.editNode,false);},startTokenSuggestion:function AB(E){this.endTokenSuggestion();if(!E){E=this.findObjectToken();}if(E&&!E.isDelimiter()){E.set("active",true);this._saveActiveToken=E;this.showSuggestion(this.getSearchPattern());}if(!E||this.getSearchPattern().length===0){this.hideSuggestion();}},browseItemVisible:true,folderLinksContextId:25,browsableTypes:[L.TP.FOLDER,L.TP.FACT,L.TP.ATTR,L.TP.FUNCTION,L.TP.FILTER,L.STP.PROMPT_OBJECTS,L.TP.ATTR,L.TP.DIM,L.TP.METRIC,L.TP.ROLE].join(","),getSearchPattern:function U(){var AI=this._saveActiveToken,AK=AI&&AI.data.v,E=AK&&AK.length;if(E>2){if(AK.charAt(0)==="["){AK=AK.substring(1);}if(AK.charAt(AK.length-1)==="]"){AK=AK.substring(0,AK.length-1);}}if(AI&&AI.data.ift){var AJ=AI.data.v,AL=AJ&&AJ.indexOf("@");if(AL>=0){AK=AJ.substring(AL);}}return AK||"";},getSuggestionPos:function b(){var E=this._saveActiveToken,AI=null,AK,AJ;if(E){AK=E.data&&E.data.ift;AJ=mstrmojo.dom.position(E.domNode,true);AI={left:Math.round(AJ.x+(AK?AJ.w:0))+"px",top:Math.round(AJ.y+AJ.h)+"px",zIndex:100};}return AI;},item2textCss:function J(AI){var E=(this._super&&this._super(AI))||{4:"m",11:"fx",12:"a",13:"fc",43:"tr",21:"afm","-99":"br"}[AI.t]||"";E+=AI.da?" da":"";E+=(AI.dm||AI.um)?" dm":"";E+=AI.de?" de":"";E+=AI.fs&&AI.fs.length&&AI.fs.some(function(AJ){return AJ.fgr>0;})?" g":"";return E;},onBrowserOpen:function o(){this.editNode.blur();},onSuggestionItemSelect:function x(AI){var E=this._saveActiveToken;this.endTokenSuggestion();if(E){if(E.data.ift&&AI.t===21){E.setFormInfo(AI);}else{E.setItemInfo(AI);if(AI.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){this.insertParenthesisTokens();}}this._delaySetCaretPos(E.domNode,false);}this.closePopup();},_delaySetCaretPos:function AD(E,AJ){var AI=this.editNode,AK=this,AL=function(){AI.focus();AI.focus();D.collapseOnNode(E,AJ);AK._saveRangeInfo=D.getRangeInfo();};window.setTimeout(AL,0);},_delaySetTextCaretPos:function AD(E,AL){var AI=this.editNode,AJ=this,AK=function(){AI.focus();AI.focus();D.collapseOnTextNode(E,AL);AJ._saveRangeInfo=D.getRangeInfo();};window.setTimeout(AK,0);},getCandidatesThroughTaskCall:function W(AI,E){AI.objectType="11,12,13,43,4";AI.rootFolderType=39;AI.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AI,E);},filterCandidates:function l(AL,AK,E){var AI=this._saveActiveToken,AM=AI&&(AI.data.oi||AI.data.at),AJ;if(AM&&AI.data.ift){E=E||this.suggestCount;AK=mstrmojo.string.regEscape(AK);AJ=h.filter(AL,function(AN){return AN.t===21&&AN.attid===AM.did&&(new RegExp("^"+AK,"i")).test("@"+AN.n);},{max:E});}else{AJ=h.filter(AL,function(AN){return AN.t!==21;});AJ=this._super(AJ,AK,E);}return AJ;},endTokenSuggestion:function AE(AI){var E=this._saveActiveToken;if(E){if(AI){this.hideSuggestion();}E.set("active",false);this._saveActiveToken=null;}},widgetDeleteTokens:function f(AQ){var AI=AQ.startOffset,E=AQ.endOffset,AT=M.findWidget(AQ.startContainer),AR=M.findWidget(AQ.endContainer),AM=this.itemIndex(AT.data),AK=this.itemIndex(AR.data),AN=[],AO=D.getEdgeInfo(AQ.startContainer,AI),AS=D.getEdgeInfo(AQ.endContainer,E),AP=(AO===c.EDGE_BEGIN?AM:AM+1),AJ=(AS===c.EDGE_END?AK:AK-1),AL;if(AT===AR){if((AO===c.EDGE_BEGIN)&&(AS===c.EDGE_END)){this.remove(AM);AR=this.ctxtBuilder.itemWidgets[AM===0?AM:AM-1];if(AR){D.collapseOnNode(AR.domNode,AM===0);}else{D.collapseOnNode(this.editNode,true);}}else{AT.spliceContent(AI,E-AI);D.collapseOnTextNode(AR.domNode,AI);}}else{for(AL=AP;AL<=AJ;AL++){AN.push(AL);}this.remove(AN);if(AO===c.EDGE_MIDDLE){AT.spliceContent(AI);}if(AS===c.EDGE_MIDDLE){AR.spliceContent(0,E);}if(AO===c.EDGE_BEGIN){AT=this.ctxtBuilder.itemWidgets[AM===0?AM:AM-1];}if(AT){D.collapseOnNode(AT.domNode,AM===0);}else{D.collapseOnNode(this.editNode,false);}AM=(AO===c.EDGE_BEGIN)?AM-1:AM;this.checkMergeTwoTokens(AM,AM+1);}this.editNode.focus();},oncandidatesChange:function k(){var AI=this.candidates,E=(AI&&AI.items)||[];if(!this.noCache&&AI&&AI.isComplete){this.suggestCount=this.REQUEST_THRESHOLD=E.length;}else{this.suggestCount=mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=20;}},nudge:function(E){var AI=this.getSuggestionPos();if(AI){E.set("left",AI.left);E.set("top",AI.top);}},pretokensModify:function K(){this.tokensCache=this.tokensCache.slice(0,this.tokensCachePointer);var E=this.findObjectToken();this.tokensCache.push({items:H.clone(this.items),rInfo:D.getRangeInfo(),idx:E!==null?this.itemIndex(E.data):-1});this.tokensCachePointer=this.tokensCache.length;},widgetHandleUndoRedo:function d(AJ){var AK,E,AI=function(AM){if(!AM){return ;}AM=AM||{};this.set("items",H.clone(AM.items));var AP=this.ctxtBuilder.itemWidgets,AL=AP[AM.idx],AO=AL&&AL.domNode||this.editNode,AN=AM.rInfo;this._delaySetTextCaretPos(AO,AN&&AN.startOffset||0);};switch(AJ){case"undo":AK=--this.tokensCachePointer;if(AK>-1){E=this.tokensCache[AK-1];AI.call(this,E);}else{this.tokensCachePointer=1;}break;case"redo":AK=this.tokensCachePointer++;if(AK>-1&&AK<this.tokensCache.length){E=this.tokensCache[AK];AI.call(this,E);}else{this.tokensCachePointer=Math.min(Math.max(this.tokensCachePointer,1),this.tokensCache.length);}break;}},resetTokensCache:function T(){this.tokensCache=[];this.tokensCachePointer=-1;this.tokensCacheInitilized=false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetTree","mstrmojo.expr","mstrmojo.AndOrNode","mstrmojo.ConditionNode");var F=mstrmojo.expr,B=F.ET;function A(G){var I=G&&G.src,J=I&&I.data,H=J&&J.et;return(H in F.ETs);}mstrmojo.FilterExpr=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.FilterExpr",allowDrop:A,renderOnScroll:false,itemIdField:null,nodeClassMap:{14:mstrmojo.AndOrNode,"*":mstrmojo.ConditionNode},onBlankClick:function(G){this.clearTreeSelect();},onnodemousedown:function(H){var I=mstrmojo.dom.eventTarget(H.hWin,H.e),J=H.src,G=J.listMapper.findIndex(J,J.itemsContainerNode,I),K=G>=0?J.ctxtBuilder.itemWidgets[G]:null;if(!K||(K.isSelectableArea&&!K.isSelectableArea(I))){this.onBlankClick(H);}},getItemIdentityProp:function(G){return G.et;},itemFunction:function(L,I,M){var H=M.tree,J=H.getItemConfig(L,I,M),K=H.nodeClassMap,G=K[H.getItemIdentityProp(L)]||K["*"];return G&&(new G(J));},getItemConfig:function(J,G,K){var H=(J.et===B.ANDOR),I=K.tree||K;return{data:J,tree:I,parent:K,bindings:{prefixedAndOrEditable:"this.parent.editable"},itemFunction:(H)?K.itemFunction:null,draggable:H?I.draggable:false,dropZone:H?I.dropZone:false,allowDrop:H&&I.dropZone?I.allowDrop:null,allowCopy:H?I.allowCopy:false,editable:I.isEditable?I.isEditable(J):I.editable,makeObservable:H&&K.makeObservable,onclick:I.onnodeclick,onadd:I.onnodeadd,onremove:I.onnoderemove};},getDragData:function(G){var I=this._super(G);if(I&&!I.html){var H=I.et&&F.ET2TGT[I.et];I.html=H?I[H]&&I[H].n||"":I.n||"";}return I;},newCondition:function E(K){K=K||{et:B.AQ};var J=this.selectionParentNode,G;J=(J&&J.hasRendered)?J:this;if(J!==this){G=J.add([K]);}else{var I=this.addCondition([K],null,true);G=I.index;J=I.widget;}var H={widget:J,index:G,data:K};if(this.onNew){this.onNew(H);}return H;},addCondition:function D(I,K){var L=this.items,H=L&&L.length,N=I&&I.length;if(!N){return null;}var J,G;if(H&&L[0].et===B.ANDOR){J=this.ctxtBuilder.itemWidgets[0];G=J.add(I,null);}else{if(!H&&(N===1)){J=this;G=0;this.add(I,0);}else{if(H){var M=L[0];this.remove(M);I.unshift(M);}this.add([{et:B.ANDOR,fn:F.FN.AND,nds:I}],0);J=this.ctxtBuilder.itemWidgets[0];G=H?1:0;}}return{widget:J,index:G};},addSingleCondition:function C(H,G){var I=this.addCondition([H],G);return I.widget.ctxtBuilder.itemWidgets[I.index];},ondrop:function(J){if(this._super){this._super(J);}var H=this.items,G=H&&H.length,I=H.concat();if(G>1){if(H.remove){H.remove(0,H.length);}else{this.set("items",null);}this.add([{et:B.ANDOR,fn:F.FN.AND,nds:I}],0);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.hash","mstrmojo.func","mstrmojo.css","mstrmojo.HBox","mstrmojo.Box","mstrmojo.DropDownButton","mstrmojo.Popup","mstrmojo.WidgetTree","mstrmojo.ObjectBrowserDataProvider","mstrmojo.OBList","mstrmojo.FishEyeContainer","mstrmojo.SearchBox2","mstrmojo.Booklet","mstrmojo.IncFetch","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.mstr.ui.IncFetchOBList");var O=mstrmojo.hash,W=mstrmojo.func,L=mstrmojo.meta.TP,F="5CECE58CC1D549F890EB61C4DB2156A3",T="E0CCB9CF22104A489CBE78D974AFD19E",Q=mstrmojo.chart.model.enums.EnumDSSObjectType,K=mstrmojo.array,D=mstrmojo.dom,X=function(f,g,a){var d=f.scrollableIncFetch,c=d?"mstrmojo.mstr.ui.IncFetchOBList":"mstrmojo.OBList",e={scriptClass:c,items:g.items,multiSelect:a};if(d){e.browseConfig={blockBegin:g.bb,blockCount:g.bc,totalSize:g.sz,folderLinksContextId:f.folderLinksContextId,rootFolderID:g.did,browsableTypes:f.browsableTypes,browsableViewMedias:f.browsableViewMedias,dataProvider:f.dataProvider};e.onwaitingChange=function(){if(f.booklet){f.booklet.set("waiting",this.waiting);}};}var b=mstrmojo.insert(e);b.render();return b;},A=function(c,d,a){var b=mstrmojo.ObjectBrowser.widgetHandler||X;return b(c,d,a);},N={success:function(c){var d=this.ob,b=c.items,e=d.pageCache[d.currentPage],a=e._w;e.items=b;a.set("items",b);this.ob=null;this.item=null;window.clearTimeout(d._btm);d.booklet.set("waiting",false);if(d.scrollableIncFetch&&a.scrollNode){a.initScroll();a.updateScrollbars();}},failure:function(a){window.alert(a.getResponseHeader("X-MSTR-TaskFailureMsg"));this.ob.booklet.set("waiting",false);}},S=function(f,e,c){var d=c?-1:1,b=f.pageCache.length,g;for(g=f.currentPage+d;g<b&&g>=0;g+=d){var a=f.pageCache[g];if(a._k===e.k){return{steps:g-f.currentPage,cache:a};}}return null;},C=function(e,d,c,f){var g=e.currentPage+1,b=e.pageCache.length,a;for(a=g;a<b;a++){e.pageCache[a]._w.destroy();delete e.pageCache[a].items;}e.pageCache=e.pageCache.slice(0,g);f._w=c;f._k=d.k;e.pageCache[g]=f;e.cacheChange();},H=function(b){var a=mstrmojo.hash.walk("anc.items.0.items",b);this.set("canGoUp",!(!b.pf||!a));},I=function(e,d,f,c,b){delete e._btm;var a;if(!c){a=A(e,f,e.multiSelect);a.attachEventListener("change",e.id,"navigate");if(e.useDblSelect||e.useBothSglDblSelect){a.attachEventListener("dblclick",e.id,"dblselect");}}else{a=f._w;}e.obList=a;e.booklet.turn(a,b>0);window.setTimeout(function(){e.onBrowsing=false;},300);if(!c){C(e,d,a,f);}e.set("currentFolder",f);e.set("currentPage",e.currentPage+b);e.updateUpButton(f);if(e.scrollableIncFetch&&a.scrollNode){a.initScroll();a.updateScrollbars();}},P=function(c,b,a){var d=S(c,b,false);d=d||S(c,b,true);if(!d){window.clearTimeout(c._btm);c._btm=window.setTimeout(function(){c.booklet.set("waiting",true);},300);a.ob=c;a.item=b;c.getDataProvider().fetchFolderContents(c,b,a);}else{I(c,b,d.cache,true,d.steps);}},B=function(b,c,d,a){P(b,{fid:b.pageCache[b.currentPage].did,blockBegin:c,searchPattern:d,recursive:a},N);},J={success:function(b){var c=this.ob;if(c){window.clearTimeout(c._btm);if(!b.items){b.items=[{did:"empty",n:"("+mstrmojo.desc(2210)+")",t:"e"}];}var a=function e(f){var j=f.length,g;for(g=0;g<j;g++){var h=f[g];if(h.did===F||h.did===T){h.n=(h.did===F)?mstrmojo.desc(8112):mstrmojo.desc(9277);}if(h.items){a(h.items);}}};if(b.did===F||b.did===T){b.n=(b.did===F)?mstrmojo.desc(8112):mstrmojo.desc(9277);if(b.anc&&b.anc.items){a(b.anc.items);}}if(b&&b.items&&c.browsableViewMedias){var d={};K.forEach(c.browsableViewMedias.split(","),function(f){d[parseInt(f,10)]=true;});b.items=K.filter(b.items,function(f){return(f.t!==Q.DssTypeDocumentDefinition)||d[f.dvm];});}if(b&&b.items&&mstrApp&&mstrApp.isSingleTier){b.items=K.filter(b.items,function(f){return(f.st!==772);});}if(b.did&&this.item.k!==b.did){this.item.k=b.did;}I(c,this.item,b,false,1);this.ob=null;this.item=null;}},failure:function(a){this.ob.booklet.set("waiting",false);if(this.ob.onError){this.ob.onError(a);}else{if(a.getResponseHeader){mstrmojo.alert(a.getResponseHeader("X-MSTR-TaskFailureMsg"));}else{mstrmojo.alert(a.message);}}},complete:function(){if(this.ob){this.ob.onBrowsing=false;}}},Z=function(c){var b=c.pageCache.length,a;for(a=0;a<b;a++){c.pageCache[a]._w.destroy();}c.pageCache=[];c.currentPage=-1;c.cacheChange();},M=function(d,c,e){var a=d.onBrowseFolder;if(a){a[0][a[1]](c);}if(c&&parseInt(c.acg,10)===33){return ;}var b={};if(c){b.k=c.did;b.fid=c.did;}else{if(d.rootFolderID){b.k=d.rootFolderID;b.fid=d.rootFolderID;}else{if(d.rootFolderType){b.k=d.rootFolderType;b.fty=d.rootFolderType;}else{if(d.folderLinksContextId){b.k=d.folderLinksContextId;}}}}P(d,b,W.wrapMethods(e,O.copy(J)));},V=function(f,a,c){if(!c){return a;}var d=f.showCompletePath,h=a[0],e,b;while(h){var g;for(g=c.length-1;g>=0;g--){if(h.did===c[g].did){c.splice(g,1);h._isSc=true;}}b=h;h._open=true;h=h.items;h=h&&h[0];if(!h){b.lastLeaf=true;}}if(!d){h=a[0];while(h){if(h._isSc){a[0]=h;break;}h=h.items;h=h&&h[0];}}return a.concat(c);},U=function(b,a,c){b._naviInfo=V(b,a,c);};mstrmojo.ObjectBrowser=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.ObjectBrowser",rootFolderType:null,rootFolderID:null,sId:null,closeOnSelect:true,browsableTypes:null,browsableViewMedias:null,includeObjectDesc:false,closeable:true,fishEyeVisible:false,searchVisible:true,upButtonVisible:false,currentFolder:null,pageCache:[],currentPage:-1,blockCount:50,canGoUp:true,folderLinksContextId:null,minSearchLength:2,showCompletePath:true,multiSelect:false,onCloseCB:null,onSelectCB:null,onBrowseFolder:null,scrollableIncFetch:false,useBothSglDblSelect:false,displaySaveLabel:false,useOldSearch:false,getDataProvider:function(){if(!this.dataProvider){this.dataProvider=mstrmojo.insert({scriptClass:"mstrmojo.ObjectBrowserDataProvider"});}return this.dataProvider;},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{scriptClass:"mstrmojo.HBox",alias:"titleBar",cssClass:"mstrmojo-OB-titleTable",children:[{alias:"saveLabel",scriptClass:"mstrmojo.Label",cssClass:"msrmojo-save-label",text:mstrmojo.desc(3178,"Save in:"),bindings:{visible:"this.parent.parent.displaySaveLabel"}},{alias:"title",scriptClass:"mstrmojo.DropDownButton",cssClass:"mstrmojo-FormatEditor-DropDownButton",cssText:"margin:0px;",popupRef:{scriptClass:"mstrmojo.Popup",contentNodeCssClass:"mstrmojo-OBNavigatorPopup",cssText:"position:relative;",slot:"popupNode",locksHover:true,onOpen:function(){var a=this.opener.parent.parent,d=this.tree,c=a._naviInfo,b=this.parent.parent.parent.extraDDItems;if(d.items!==c){d._pup=this;this.ob=a;if(b){K.forEach(b,function(e){e.isExtra=true;});c=c.concat(b);}d.set("items",c);}},children:[{alias:"tree",scriptClass:"mstrmojo.WidgetTree",itemIdField:"did",itemFunction:function(e,a,b){var d=mstrmojo.WidgetTree.prototype.itemFunction(e,a,b);if(e.isExtra){if(e.cssClass){d.cssClass=e.cssClass;}d.onmousedown=e.onmousedown||mstrmojo.emptyFn;return d;}if(e._open){d.state=1;}d._ll=!!e.lastLeaf;d._pup=b._pup;d.onmousedown=function(f){var g=mstrmojo.dom.eventTarget(f.hWin,f.e),h=this._pup;if(g===this.domNode||g===this.textNode){if(!this._ll){M(h.ob,this.data);}h.close();}};d.markupMethods=O.copy(d.markupMethods);d.markupMethods.onstateChange=function(){var f=this.data.items?this.state:0;this.stateNode.className="mstrmojo-TreeNode-state "+({0:"closed",1:"opened",2:"leaf"}[f]||"closed");this.itemsContainerNode.style.display=(f===1)?"block":"none";};d.useRichTooltip=true;var c=d.postBuildRendering;d.postBuildRendering=function(){if(c){c.call(d);}if(d.textNode.parentNode.clientWidth){d.textNode.style.width=(d.textNode.parentNode.clientWidth-20)+"px";}};d.premouseover=function(h){if(this.useRichTooltip){var g=this.textNode;if(g.clientWidth<g.scrollWidth){var f=D.position(g);this.richTooltip={areaId:this.id,cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.data[this.itemDisplayField],top:f.y-2,left:f.x+f.w+6};}else{this.richTooltip=null;}mstrmojo.dom.stopPropogation(h.hWin,h.e);}return true;};return d;}}]}},{alias:"upButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-OBListItemIcon up",title:mstrmojo.desc(1152,"Up One Level"),onclick:function(){this.parent.parent.goUp();},bindings:{enabled:"this.parent.parent.canGoUp",visible:"this.parent.parent.upButtonVisible"}},{alias:"closebtn",scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-OBCloseButton",title:mstrmojo.desc(2102,"Close"),bindings:{visible:"this.parent.parent.closeable"},onclick:function(){this.parent.parent.close();}}]},{alias:"fishEye",scriptClass:"mstrmojo.FishEyeContainer",cssText:"width:100%",bindings:{visible:"this.parent.fishEyeVisible"}},{alias:"searchUpBar",scriptClass:"mstrmojo.HBox",cssClass:"searchBox",children:[{alias:"obSearchBox",scriptClass:"mstrmojo.SearchBox2",cssClass:"mstrmojo-charcoalbox mstrmojo-dxsprite",cssText:"margin: 3px 0; ",contentWidget:mstrmojo.all.obList,taskId:"searchMetadata",searchIncFetch:true,enableMatchCase:false,forceResetCache:true,bindings:{minSearchLength:"this.parent.parent.minSearchLength",quickSearch:"this.parent.parent.quickSearch"},serverRequest:function(a,b){this.parent.parent.getDataProvider().serverRequest(a,b);},preFetch:function(){this.objectTypes=this.parent.parent.browsableTypes||this.objectTypes;this.parent.parent.booklet.set("waiting",true);},postFetch:function(){this.parent.parent.booklet.set("waiting",false);},onUpdateSearchParams:function G(c){var b=this.parent.parent,a=b.sId;if(a){c.sessionState=a;}if(b.useOldSearch){c.quickSearch=0;c.nameWildcards=1;c.sortKey=6;}}}],bindings:{visible:"this.parent.searchVisible"}},{scriptClass:"mstrmojo.Booklet",cssClass:"mstrmojo-OB-booklet",alias:"booklet",hasAnimation:false,bindings:{scrollableIncFetch:"this.parent.scrollableIncFetch"}},{alias:"obIncFetch",scriptClass:"mstrmojo.IncFetch",height:"17px",cssText:"height:0px;overflow:hidden;",visible:false,np:0,cp:0,ds:{f:mstrmojo.desc(4046,"First"),p:mstrmojo.desc(1058,"Previous"),n:mstrmojo.desc(1059,"Next"),l:mstrmojo.desc(4049,"Last"),pgs:mstrmojo.desc(5972,"## of ### pages"),gt:mstrmojo.desc(5878,"Go to:"),v:mstrmojo.desc(6079,"This field should be # between ## and ###.")},onvisibleChange:function(b){var d=parseInt(this.height,10),a=this.np>1,c={target:this.domNode,props:{height:{start:(a?0:d),stop:(a?d:0),suffix:"px"}},onEnd:function(){if(a){this.target.style.overflow="visible";}}},e=new mstrmojo.fx.AnimateProp(c);this.domNode.style.overflow="hidden";mstrmojo.css.toggleClass(this.parent.domNode,"show-inc-fetch",this.visible);e.play();},onifsChange:function(a){var b=this.np;mstrmojo.hash.copy(a.value,this);if(this.np>1){this.children=null;this.refresh();}if((b<=1&&this.np>1)||(b>1&&this.np<=1)||(b===0&&this.np>0)){this.set("visible",this.np>1);}this.cssText="";}}],destroy:function Y(){Z(this);if(this._super){this._super();}},postBuildRendering:function(){if(this._super){this._super();}if(this.fishEye&&this.fishEyeVisible){this.fishEye.attachEventListener("selectedIndexChange",this.id,"onFishEyeChange");}var c=this.searchUpBar;if(c&&c.obSearchBox&&this.searchVisible){this.obSearchBox=this.searchUpBar.obSearchBox;this.obSearchBox.attachEventListener("itemsChange",this.id,"onSearchItemsChange");var a=this.obSearchBox.contentWidget||this.obSearchBox;if(!this.scrollableIncFetch){a.attachEventListener("ifsChange",this.id,function(d){if(!this.scrollableIncFetch){this.obIncFetch.set("ifs",d.value);}});}}if(!this.scrollableIncFetch&&this.obIncFetch){var b=this.obIncFetch;b.attachEventListener("fetch",this.id,function(d){b.cp=d.v;b.children=null;b.refresh();B(this,(d.v-1)*this.blockCount+1,this.searchVisible?this.obSearchBox.inputNode.value:"",1);});}mstrmojo.css.addClass(this.domNode,"mstrmojo-ObjectBrowser");},onSearchItemsChange:function(b){var c=b.value,a=this.pageCache[this.currentPage]._w;if(!c||c.length===0){c=[{did:"empty",n:"("+mstrmojo.desc(2210,"")+")",t:"e"}];}else{if(this.browsableViewMedias){var d={};K.forEach(this.browsableViewMedias.split(","),function(e){d[parseInt(e,10)]=true;});c=K.filter(c,function(e){return(e.t!==Q.DssTypeDocumentDefinition)||d[e.dvm];});}}a.set("items",c);},navigate:function(h){var a=h.src,j=a.selectedItem,c=this.multiSelect,f=c&&a.getSelectedItems(),g=this,b=h.added&&h.added.length,e=h.removed&&h.removed.length,d=c?f.length===1&&(!e||b):!!j;if(d&&j.did==="empty"){return ;}if(d&&parseInt(j[L],10)===8){if(!this.onBrowsing){this.onBrowsing=true;M(this,j);}}else{if((j&&(!this.useDblSelect||this.useBothSglDblSelect))||f){this.select(c?f:j);}}},browseFolder:function(a,b){M(this,{did:a,n:b});},onFishEyeChange:function(a){this.goToPage(a.value);},goToPage:function(a){if(a<this.pageCache.length&&a!==this.currentPage){var c=a>this.currentPage,b=this.pageCache[a];this.set("currentPage",a);this.booklet.turn(b._w,c);this.set("currentFolder",b);H.call(this,b);}},oncurrentPageChange:function(a){if(this.fishEye){this.fishEye.setSelectedIndex(a.value);}var b=this.pageCache[this.currentPage];this.titleBar.title.set("text",mstrmojo.string.encodeHtmlString(b.n));if(this.searchVisible&&this.obSearchBox){this.obSearchBox.set("rootCacheItems",b.items||[]);this.obSearchBox.set("totalSize",b.sz);this.obSearchBox.set("rootID",b.did);this.obSearchBox.clearSearch();}if(!this.scrollableIncFetch&&this.obIncFetch){this.obIncFetch.set("ifs",{np:Math.floor(b.sz/b.bc)+((b.sz%b.bc>0)?1:0),cp:Math.floor(b.bb/b.bc)+((b.bb%b.bc>0)?1:0)});}},cacheChange:function(){if(this.fishEye&&this.fishEyeVisible){this.fishEye.setItems(this.pageCache);}},browse:function(b,a){O.copy(b,this);if(this.searchVisible&&this.obSearchBox){this.obSearchBox.clear();}Z(this);M(this,undefined,a);},close:function(){var b=this.ctx||this,a=b.onCloseCB;if(a){a[0][a[1]]();}b.set("visible",false);},select:function(b){var a=this.onSelectCB;if(a){a[0][a[1]](b);}if(this.closeOnSelect){this.close();}},dblselect:function R(b){var c=b&&b.src.selectedItem;if(!c||(c&&c.did==="empty")||c[L]===8){return ;}if(this.useBothSglDblSelect){var a=this.onDblSelectCB;if(a){a[0][a[1]](c);}if(this.closeOnSelect){this.close();}}else{this.select(c);}},goUp:function(){if(this.canGoUp){M(this,{did:this.currentFolder.pf});}},updateUpButton:function E(a){H.call(this,a);},oncurrentFolderChange:function(a){var b=a.value;U(this,b.anc.items,b.sc);},refreshContent:function(a){B(this,a);},onError:null,onheightChange:function(){var a=["titleBar","fishEye","searchUpBar","obIncFetch"],c=0,b;for(b in a){c+=parseInt(this[a[b]].domNode.offsetHeight,10);}this.booklet.set("height",parseInt(this.height,10)-c+"px");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.Button","mstrmojo.MenuButton");mstrmojo.requiresDescs(212,2140);var C="mstrmojo-qb-footerIcon",F="cancel",B="publish",E="disabled",H="new",D=" ";function I(L){return mstrmojo.hash.copy(L,{scriptClass:"mstrmojo.Button",onclick:function K(){if(this.cmd){mstrApp.getRootController()[this.cmd]();}}});}mstrmojo.qb.Footer=mstrmojo.declare(mstrmojo.Box,null,{hidePublish:function G(){this.publish.set("visible",false);},children:[I({cmd:"publish",enabled:false,text:mstrmojo.desc(212,"Continue"),alias:"publish",postBuildRendering:function A(){mstrApp.getRootController().attachEventListener("allowSave",this.id,function(K){this.set("enabled",K.value);});}}),I({cmd:"cancel",iconClass:[C,F].join(D),text:mstrmojo.desc(2140,"Cancel")})],addChildren:function J(N,K,L){var M=N[0];if(M.alias==="publish"){M.iconClass=[C,B,(mstrApp.reportID?"":H),E].join(D);}this._super(N,K,L);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.TextArea","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Editor","mstrmojo.ObjectBrowser","mstrmojo.NewFolderEditor");function B(){var E={alias:"newFolder",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-createfolder",text:mstrmojo.desc(3245,"Create New Folder"),onclick:function(){var G=this.parent.parent,F={zIndex:G.zIndex+10,navigateAfter:false,fId:G.ob.currentFolder.did,okFn:function(H,I){G.ob.refreshContent();if(I){G.ob.browseFolder(H.fid,G.newFolder);}}};if(G.ob.dataProvider){F.dp=G.ob.dataProvider;}G.openPopup("newFolder",F);},postCreate:function(){this.set("visible",mstrmojo.resolveFeature("create-folder"));}},D=mstrmojo.hash.clone(mstrmojo.ObjectBrowser.prototype.children);D.push(E);return D;}mstrmojo.SaveAsObjectBrowser=mstrmojo.declare(mstrmojo.ObjectBrowser,null,{scriptClass:"mstrmojo.SaveAsObjectBrowser",cssClass:"mstrmojo-SaveAs-OB",children:B()});var A={success:function(D){var E=this.parent;if(E.onObjectSaved){E.onObjectSaved({name:E.name,did:D.did,desc:E.desc});}mstrmojo.alert(mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",E.typeDesc||"Object").replace("###",E.name),null,mstrmojo.desc(7984,"Object Saved"));E.ob.refreshContent();E.close();},failure:function(E){var D=parseInt(E.getResponseHeader("X-MSTR-TaskErrorCode"),10)+4294967296,F=this.parent;if(D==2147749923){mstrmojo.confirm(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",F&&F.typeDesc||"Object").replace("'###'",F&&F.name?'"'+F.name+'"':""),{confirmBtn:{fn:function(){F.saveAs(true);}}},{title:mstrmojo.desc(3179),zIndex:F&&F.zIndex+10});}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+E.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};mstrmojo.SaveAsEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SaveAsEditor",cssClass:"mstrmojo-SaveAsEditor",title:mstrmojo.desc(3167,"Save As"),sId:null,rootFolderID:null,rootFolderType:null,folderLinksContextId:null,browsableTypes:null,showCompletePath:true,desc:"",name:"",help:"Save_As_dialog_box.htm",displaySaveLabel:true,searchVisible:true,upButtonVisible:true,children:[{scriptClass:"mstrmojo.SaveAsObjectBrowser",alias:"ob",closeable:false,closeOnSelect:false,fishEyeVisible:false,bindings:{showCompletePath:"this.parent.showCompletePath",rootFolderID:"this.parent.rootFolderID",rootFolderType:"this.parent.rootFolderType",folderLinksContextId:"this.parent.folderLinksContextId",browsableTypes:"this.parent.browsableTypes",displaySaveLabel:"this.parent.displaySaveLabel",searchVisible:"this.parent.searchVisible",upButtonVisible:"this.parent.upButtonVisible",sId:"this.parent.sId"},postCreate:function(){this.onSelectCB=[this.parent,"onOBSelect"];this.onBrowseFolder=[this.parent,"onOBBrowseFolder"];}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:2,cols:2,alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Name-Label",slot:"0,0",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",slot:"0,1",value:mstrmojo.desc(8116,"New Folder"),alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput",bindings:{value:"this.parent.parent.name"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Desc-Label",slot:"1,0",text:mstrmojo.desc(1154,"Description:")},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",slot:"1,1",alias:"desc",bindings:{value:"this.parent.parent.desc"},rows:5}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot okButton",alias:"ok",text:mstrmojo.desc(2400,"Save"),onclick:function(){this.parent.parent.saveAs();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],newFolder:{scriptClass:"mstrmojo.NewFolderEditor"},onOpen:function(){this.ob.browse();},onOBBrowseFolder:mstrmojo.emptyFn,onOBSelect:function(D){this.set("name",D.n);},saveAsCallback:function C(){return A;},saveAs:function(F){var E=this.contPanel;this.name=E.name.value;this.desc=E.desc.value;if(!this.name){mstrmojo.alert(mstrmojo.desc(3380,"Please enter valid name"));return ;}var G=this.saveParams||{};G.folderID=this.ob.currentFolder.did;G.description=this.desc||"";G.name=this.name||"";G.saveAsOverwrite=!!F;var D=this.saveAsCallback();D.parent=this;mstrmojo.xhr.request("POST",mstrConfig.taskURL,D,G);}});mstrmojo.SaveAsEditor.SAVEAS_CALLBACK=A;})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.expr","mstrmojo.FilterExpr");var J=mstrmojo.expr,L=J.ET,C={},G=mstrmojo.hash,M=mstrmojo.dom;C[L.ANDOR]=mstrmojo.AndOrNode;C["*"]=mstrmojo.ConditionNode;function A(){var O=this.tree,N=O.parent,P=M.delta(this.domNode,O.domNode);if(this.data.sqltp===1){P.y+=parseInt(N.filterExpr.domNode.offsetHeight,10)+15;}N.parent.openPopup("andOrPopupRef",{condition:this,zIndex:this.zIndex?this.zIndex+100:100,left:P.x+40+"px",top:P.y+65-N.domNode.scrollTop+"px"});}function I(P){if(P.constructor!==Array){P=[P];}var T,S={b:0,c:0},U,R,O;for(var Q=0,N=P.length;Q<N;Q++){T=P[Q];if(!(T&&T.et)){continue;}U=T.nds;if(U){R=I(U);S.b+=R.b;S.c+=R.c;}else{O=(T.et===L.B);S[O?"b":"c"]++;}}return S;}function H(O){var P=O.parent.data;if(P){var N=O.items;if(O.alias==="filterExpr"){P.expr=N&&N[0];}else{P.aggexpr=N&&N[0];}}}function D(N){var P=I(N.value),O=this.tree;O.set("bandingCount",O.bandingCount+P.b);O.set("conditionCount",O.conditionCount+P.c);}function B(N){var P=I(N.value),O=this.tree;O.set("bandingCount",O.bandingCount-P.b);O.set("conditionCount",O.conditionCount-P.c);}mstrmojo.qb.FilterTree=mstrmojo.declare(mstrmojo.FilterExpr,null,{scriptClass:"mstrmojo.qb.FilterTree",draggable:true,dropZone:true,allowCopy:false,makeObservable:true,bandingCount:0,conditionCount:0,onadd:function(N){H(this);D.apply(this,[N]);},onremove:function(N){H(this);B.apply(this,[N]);},editable:true,onRender:function(){var O=I(this.items),N=this.tree;N.set("bandingCount",O.b);N.set("conditionCount",O.c);},itemFunction:function(S,O,T){var Q=(S.et===L.ANDOR),R=T.tree||T,P={data:S,tree:R,parent:T,itemFunction:Q?T.itemFunction:null,draggable:Q?R.draggable:false,dropZone:Q?R.dropZone:false,allowDrop:Q&&R.dropZone?R.allowDrop:null,allowCopy:Q?R.allowCopy:false,editable:R.isEditable?R.isEditable(S):R.editable,makeObservable:Q&&T.makeObservable,onclick:R.onnodeclick,onadd:R.onnodeadd,onremove:R.onnoderemove},N=C[S.et]||C["*"];return N&&(new N(P));},isEditable:function K(O){if(!this.editable){return false;}var N=false;switch(O&&O.et){case L.AQ:case L.ANDOR:case L.RLS:case"*":N=true;break;}return N;},onnodeclick:function F(O){if(!this.editable){return ;}if(O&&O.part==="andor"){A.call(this);}else{var N=this.tree;N.onexprclick&&N.onexprclick(this);}},onnodeadd:D,onnoderemove:B,allowDrop:function E(N){var P=N&&N.src,S=P&&P.data,R=S&&S.et,Q=(R===L.B),O=this.tree;return R&&((Q&&(O.conditionCount===0))||(!Q&&(O.bandingCount===0)));}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.range","mstrmojo.array","mstrmojo.WidgetListMapper","mstrmojo._HasSuggestion","mstrmojo.qb.FFsqlToken","mstrmojo.warehouse.EnumDataChangeEvents");var n=mstrmojo.dom,K=mstrmojo.array,N=mstrmojo.hash,AO=mstrmojo.Enum_Keys,k=mstrmojo.range,Q=mstrmojo.string,AD=k.EDGE,AQ=mstrmojo.qb.FFsqlToken.isDelimiter,AH=67,P=86,AL=88,d=90,AS="\n",m="\t",J=" ",H="c",AW="v",T="x",o="z",AG="a",t=";",w=".",AJ="[",l="]",I="addTable",F="addColumn",AB="compositionstart",a="compositionupdate",p="compositionend",AK="DOMCharacterDataModified",e="paste",E=mstrmojo.warehouse.EnumDataChangeEvents;function AR(AZ){var AY=(n.isIE&&!n.isIE9)?AZ.keyCode:AZ.charCode;return(AY>0)?String.fromCharCode(AY):null;}var R,AU=100,c={" ":true,"\t":true,"\n":true},A=["select","update","insert","delete","create","drop","alter","set","exec"],S=A.concat(["from","where","having","in","group","by","order","into","on","values","table","case","then","else","join","as"]),AI={};S=S.concat(["left","right","full","outer"]);function V(){if(!R){R=[];K.forEach(S,function(AY){R.push({n:AY,sta:AU,t:AU});});}return R;}mstrmojo.qb.FFsqlInput=mstrmojo.declare(mstrmojo.ME.TokenInputBox,null,{scriptClass:"mstrmojo.qb.FFsqlInput",renderBlockSize:50000,renderOnScroll:false,init:function q(AZ){this._super(AZ);var Ab={},Aa=this,AY=Ab[this.id]={};AY.sqlTokensAdded=this.onsqlTokensAdded;AY[E.DBROLE_CHANGED]=function Ac(){mstrApp.getRootController().enableButton(Aa.getSQLstmt());};AY[E.DBTABLES_ENABLED]=function(Ad){if(this.parent.visible){this.editNode.contentEditable=Ad.value?"true":"false";}};mstrApp.getRootController().attachDataChangeListeners(Ab);this.autoSelect=false;this.openPopup("suggestionPopup");this.suggestionPopup.close();this.autoSelect=true;},itemFunction:function AN(AZ,AY,Aa){return new mstrmojo.qb.FFsqlToken({data:AZ});},item2textCss:function AF(AY){return" mstrmojo-qb-SuggestIcon t"+AY.t;},itemIdField:"did",itemCount:0,ostack:[],sqlTokens:V(),browseItemVisible:false,customFunctionVisible:false,raiseChangeEvent:function(Aa){var AZ=Q.trim(this.getSQLstmt()),AY=mstrApp.getRootController();Aa.name="tokensModify";this.raiseEvent(Aa);AY.enableButton(AZ);if(!AZ&&AY.canAddTableSQL(true,AZ)){AY.enableAvailableTables();}},getSQLstmt:function(){if(!this.items){return"";}var AY=[];K.forEach(this.items,function(Aa,AZ){AY[AZ]=Aa.v;});return AY.join("");},onsqlTokensAdded:function r(AY){var Ab=AY.value,Aa=this.itemCount,AZ=this.items;if(Aa>0&&AZ[Aa-1]!==AS){AZ.push({isNew:true,v:AS,isDelimiter:true,did:Aa++});}K.forEach(Ab,function(Ac){Ac=N.copy({isNew:true,did:Aa++},Ac);});AZ=AZ.concat(Ab);this.itemCount=Aa;this.set("items",AZ);this.parent.updatepasses();},postBuildRendering:function AV(){var AY=this.editNode;if(this._super){this._super();}n.detachEvent(AY,AB,this.oncompositionstart);n.detachEvent(AY,a,this.oncompositionupdate);n.detachEvent(AY,p,this.oncompositionend);if(n.isIE9||n.isIE10||n.isIEW3C){n.detachEvent(AY,AK,this.ondomcharmodifed);}n.attachEvent(AY,AB,this.oncompositionstart);n.attachEvent(AY,a,this.oncompositionupdate);n.attachEvent(AY,p,this.oncompositionend);if(n.isIE9||n.isIE10||n.isIEW3C){n.attachEvent(AY,AK,this.ondomcharmodifed);}n.detachEvent(AY,e,this.onpaste);n.attachEvent(AY,e,this.onpaste);mstrApp.getRootController().attachEventListener("failureLabel",this.id,function(AZ){this.markFailureLabel(AZ.value);});},handlekeydown:function U(Ai){var Au=this,Aa=Ai.keyCode||Ai.charCode;if(this.editNode.contentEditable==="false"){return true;}if(this._inComposition){return true;}if(Au._inHandleImeInputTimeout&&Aa===AO.ENTER){window.setTimeout(function(){Au.handlekeydown(Ai);},0);n.stopPropogation(window,Ai);n.preventDefault(window,Ai);return false;}Ai=Ai||window.event;var AY,Ao=false,Ag=k.getRangeInfo(),AZ=Ag.range.startContainer,Aq=Ag.range.startOffset;switch(Aa){case AO.DELETE:if(!this.doubleByte){try{this.widgetHandleDelete(Ag);this.startTokenSuggestion();this.raiseChangeEvent({type:"delete"});this.parent.updatepasses();}catch(An){}Ao=true;}break;case AO.BACKSPACE:if(!this.doubleByte){try{this.widgetHandleBackspace(Ag);this.raiseChangeEvent({type:"backspace"});this.startTokenSuggestion();}catch(Am){}Ao=true;}break;case AO.ENTER:if(this.suggestionShown){AY=this.getSelected();if(AY){this.handleSuggestionItemSelect(AY);if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}}this.hideSuggestion();}else{var Ac,Ab,Aj,Ar=this.ctxtBuilder.itemWidgets,Av,Ae={v:AS,isDelimiter:true,isNew:true,did:this.itemCount++},At={v:J,isDelimiter:true,isNew:true,did:this.itemCount++},As=null;Ab=n.findWidget(AZ);if(Ab.data!==undefined){Ac=k.getEdgeInfo(AZ,Aq);Aj=this.itemIndex(Ab.data);Av=Ar[Aj].data.v===AS;}else{Ac=AD.EDGE_END;Aj=-1;Av=false;}if(n.isFF){As=this.itemsContainerNode.scrollTop;}if(Ac===AD.EDGE_MIDDLE){var Ah=Ab.split2Tokens(Ag.startOffset,this.itemCount++);this.remove(Aj);this.add([Ah[0],Ae,Ah[1]],Aj);Aj=Aj+1;}else{if(Ac===AD.EDGE_BEGIN){this.add([Ae],Aj);}else{Aj=Aj+1;if((n.isFF||n.isIE||n.isIEW3C)&&Av){this.add([At,Ae],Aj);}else{this.add([Ae,At],Aj);}}}if(n.isFF||n.isIE||n.isIEW3C){Aj=Av?Aj:Aj+1;Ab=Ar[Aj];this._delaySetCaretPos(Ab.domNode,true);}else{Ab=Ar[Aj];this._delaySetCaretPos(Ab.domNode,false);}this.delayedScrollToItem(Aj,As);this.parent.updatepasses();}Ao=true;break;case AO.TAB:if(this.suggestionShown){AY=this.getSelected();if(AY){this.handleSuggestionItemSelect(AY);if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}}}else{this.startTokenSuggestion();}Ao=true;break;case AO.ESCAPE:this.endTokenSuggestion();Ao=true;break;case AH:if(Ai.ctrlKey||Ai.metaKey){this.ctrx=false;Ao=false;}break;case P:if(Ai.ctrlKey||Ai.metaKey){this._saveRangeInfo=k.getRangeInfo();if(!this._saveRangeInfo.collapsed){this.widgetDeleteTokens(this._saveRangeInfo);this._saveRangeInfo=k.getRangeInfo();}if(this.ctrx){this.handlepaste(this.cutstr);Ao=true;}else{this.clipboardNode.focus();Ao=false;}this.parent.updatepasses();}break;case AL:if(Ai.ctrlKey||Ai.metaKey){try{var Af=document.createElement("div");Af.appendChild(Ag.range.cloneContents());Af.innerHTML=Af.innerHTML.replace(/<br\>/gi,"\n");this.cutstr=Af.textContent.replace(/\u00A0/gi," ");this.widgetHandleDelete(Ag);this.startTokenSuggestion();this.ctrx=true;this.raiseChangeEvent({type:"cut"});}catch(Al){}Ao=true;}break;case d:if(Ai.ctrlKey||Ai.metaKey){try{var Ad=this.ostack,Ap=Ad.length;if(Ap>1){Ad.pop();this.set("items",Ad[Ap-2].its);this.parent.updatepasses();this.focus();this.raiseChangeEvent({type:"undo"});}}catch(Ak){}Ao=true;}break;case AO.LEFT_ARROW:case AO.RIGHT_ARROW:this.endTokenSuggestion(true);break;case 229:if(!this.doubleByte){this.doubleByte=true;this.prev_rInfo=Ag;this.prev_items=this.items;}break;}if(Ao){n.stopPropogation(window,Ai);n.preventDefault(window,Ai);return false;}return true;},handlekeypress:function L(AY){if(this.editNode.contentEditable==="false"){return true;}if(this._inComposition){return true;}AY=AY||window.event;var Ac=AR(AY),AZ=false,Aa=this,Ab;function Ad(){try{this.widgetHandleInput(k.getRangeInfo(),Ac);this.raiseChangeEvent({type:"input",characeter:Ac});var Ae=this._saveActiveToken;if(!AQ(Ac)){if(!Ae){Ab=this.findObjectToken();if(Ab&&!Ab.isDelimiter()){this._saveActiveToken=Ae=Ab;}}if(Ae&&Ac===w){var Ag=AI[Ae.data.v.toLowerCase().slice(0,-1)];if(Ag){if(Ag.columns){this.startTokenSuggestion();}else{var Ah=this;mstrApp.getRootController().getColumnsForDBTable({data:Ag},{success:function Ai(Al){var Ak=Al.items,Aj=[],Am=Ae.data.v;Ag.columns=Ak;K.forEach(Ak,function(An){Aj.push({n:Am+An.n,sta:2,t:26});});Ah.set("candidates",{items:Ah.candidates.items.concat(Aj),isComplete:true});Ah.startTokenSuggestion();}});}}else{Ae.isCol=false;Ae.col=null;this.startTokenSuggestion();}}else{this.startTokenSuggestion();}}else{this.endTokenSuggestion(true);}}catch(Af){}}if(Ac&&!((Ac===H||Ac===T||Ac===AW||Ac===o||Ac===AG)&&AY.ctrlKey)){if(Aa._inHandleImeInputTimeout||(n.isIE||n.isIEW3C)){if(Aa._inHandleImeInputTimeout&&(n.isIE9||n.isIE10||n.isIEW3C)&&Ac===" "){}else{window.setTimeout(function(){Ad.call(Aa);},1);}}else{Ad.call(Aa);}AZ=true;}if(AZ){n.stopPropogation(window,AY);n.preventDefault(window,AY);return false;}return true;},handlekeyup:function M(Aa){var Ab,AY,AZ;if(this.doubleByte&&!this._inComposition){Ab=this.prev_rInfo;AY=k.getRangeInfo();AZ=AY.startContainer.data.slice(Ab.startOffset,AY.startOffset);if(AZ){this.widgetHandleImeInput(Ab,AZ);}this.doubleByte=false;}else{if(this._super){this._super(Aa);}}},oncompositionstart:function Y(AY){var AZ=n.findWidget(this);AZ._inComposition=true;AZ.doubleByte=true;AZ._savedCompositionData=null;if(!AZ._compositionDataArr){AZ.prev_rInfo=k.getRangeInfo();AZ.prev_items=AZ.items;AZ._compositionDataArr=[];AZ._savedCompositionData=null;AZ._beforeCompositionDOMChars=null;AZ._hasBeforeCompositionDOMChars=false;AZ._compositionDOMChars=null;}},oncompositionupdate:function AX(AY){var AZ=n.findWidget(this);if(AZ._inComposition){AZ._savedCompositionData=AY.data;}},ondomcharmodifed:function Z(AY){var Ac=n.findWidget(this),Ab=AY.newValue,Aa=AY.prevValue,AZ;if(Ac._inComposition){if(Ac._savedCompositionData===null){Ac._beforeCompositionDOMChars=Aa;Ac._hasBeforeCompositionDOMChars=true;}else{Ac._compositionDOMChars=Ab;}if(n.isIEW3C&&!Ac._hasBeforeCompositionDOMChars){AZ=Ab.length<=Aa.length?Ab:Aa;Ac._beforeCompositionDOMChars=AZ;Ac._hasBeforeCompositionDOMChars=true;}}},oncompositionend:function G(AY){var Ab=n.findWidget(this),AZ=Ab.prev_rInfo,Ac=AZ.range.startOffset,Ad,Aa;Ab._inComposition=false;Ab.doubleByte=false;Aa=AY.data||Ab._savedCompositionData;if(Aa!==null&&Aa!==undefined){Ab._compositionDataArr.push(Aa);}if(n.isIE9||n.isIE10||n.isIEW3C){if(Ab._compositionDOMChars&&Ab._compositionDOMChars.length){if(Ab._beforeCompositionDOMChars!==null){Ad=Ab._compositionDOMChars.substr(Math.min(Ac,Ab._beforeCompositionDOMChars.length),Ab._compositionDOMChars.length-Ab._beforeCompositionDOMChars.length);}else{Ad=Ab._compositionDOMChars;}if(Ad.length){Ab._compositionDataArr=Ad.split("");}}}if(Ab._compositionDataArr.length){Ab._inHandleImeInputTimeout=true;window.setTimeout(function(){Ab._inHandleImeInputTimeout=false;if(!Ab._inComposition&&Ab._compositionDataArr){if(n.findWidget(AZ.startContainer.parentNode?AZ.startContainer:AZ.range.startContainer)){Aa=Ab._compositionDataArr.join("");Ab._compositionDataArr=null;Ab.widgetHandleImeInput(AZ,Aa);Ab.raiseChangeEvent({type:"insert"});}}},0);}},markFailureLabel:function AM(AY){this.pnum=AY;this.parent.updatepasses();},getPassLabelYCoords:function W(){var Aa=[],AZ=this.ctxtBuilder.itemWidgets,Ad=true,AY=n.position(this.domNode).y,Ac,Ab;K.forEach(AZ,function(Ae){Ac=Ae.data;Ab=Ac.v;if(Ad&&!c[Ab]){if(Ab&&K.indexOf(A,Ab.toString().toLowerCase())>-1){Aa.push(n.position(Ae.domNode).y-AY);}Ad=false;}else{if(Ab===t){Ad=true;}}});if(Aa.length===1){Aa=[];}return Aa;},widgetHandleBackspace:function x(Ad){if(Ad.collapsed){var AZ=this._saveActiveToken,Aa,Af;if(AZ&&AZ.data){Af=AZ.data.v;if(Af&&Af[Af.length-1]===w&&AZ.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});AZ.isCol=false;AZ.col=null;}}var AY,Ac,Ag,Ae=Ad.startOffset,Ab=this.ctxtBuilder.itemWidgets;if(!n.contains(this.editNode,Ad.startContainer,false,document.body)){if(Ad.startOffset>0&&n.isFF){Ac=Ab[this.items.length-1];k.collapseOnNode(Ac.domNode,false);Ad=k.getRangeInfo();AY=k.getEdgeInfo(Ad.range.startContainer,Ad.range.startOffset);}else{k.collapseOnNode(this.editNode,true);return ;}}AY=k.getEdgeInfo(Ad.range.startContainer,Ad.range.startOffset);Ac=n.findWidget(Ad.range.startContainer);Ag=this.itemIndex(Ac.data);if(AY===AD.EDGE_BEGIN){Ag--;Ac=Ab[Ag];Ae=Ac.length();}if(!Ac){k.collapseOnNode(this.editNode,true);return ;}if(Ac.length()<=1){this.remove(Ag);if(Ac.data.v===t||Ac.data.v===AS){this.parent.updatepasses();}Ac=Ab[Ag-1];if(Ac){k.collapseOnNode(Ac.domNode,false);this.checkMergeTwoTokens(Ag-1,Ag);Ac=Ab[Ag-1];}else{k.collapseOnNode(this.editNode,true);}}else{Ac.spliceContent(Ae-1,1);if(Ac.isCol){this.set("candidates",{items:Ac.col,isComplete:true,isCol:true});}k.collapseOnTextNode(Ac.domNode,Ae-1);}}else{this.widgetDeleteTokens(Ad);this.parent.updatepasses();}},onpaste:function AE(AY){var Aa=n.findWidget(this),Ab,AZ;if(!Aa){return ;}if(AY&&AY.clipboardData&&AY.clipboardData.getData){Ab=AY.clipboardData.getData("text/plain");}else{if(window.clipboardData&&window.clipboardData.getData){Ab=window.clipboardData.getData("Text");}}if(typeof Ab!=="string"){return ;}AZ=Ab.replace(/\r/g,"");if(AZ===""){return ;}Aa.handlepaste(AZ);n.stopPropogation(window,AY);n.preventDefault(window,AY);return false;},handlepaste:function h(AZ){var Aa;if(typeof AZ!=="string"){Aa=this.clipboardNode.value;}else{Aa=AZ;}this.clipboardNode.value="";var Ae=[],AY=Aa&&Aa.length,Ab,Ac="",Ad;if(AY>0){for(Ab=0;Ab<AY;Ab++){Ad=Aa.charAt(Ab);if(AQ(Ad)){if(!Q.isEmpty(Ac)){Ae.push({v:Ac,isNew:true,did:this.itemCount++});Ac="";}Ae.push({v:Ad,isDelimiter:true,isNew:true,did:this.itemCount++});}else{Ac=Ac+Ad;}}if(!Q.isEmpty(Ac)){Ae.push({v:Ac,isNew:true,did:this.itemCount++});}this.insertTokens(Ae);}},insertTokens:function f(Ae){var Ad=this._saveRangeInfo,Aa,Ac,Ab,AY;if(!Ad||!n.contains(this.editNode,Ad.startContainer,false,document.body)){this.add(Ae);Aa=this.ctxtBuilder.itemWidgets;AY=Aa.length-1;Ac=Aa[AY];this._delaySetCaretPos(Ac.domNode,false);this.delayedScrollToItem(AY);this.raiseChangeEvent({type:"insert"});return ;}Ab=k.getEdgeInfo(Ad.startContainer,Ad.startOffset);Ac=n.findWidget(Ad.startContainer);AY=this.itemIndex(Ac.data);if(Ab===AD.EDGE_MIDDLE){var AZ=Ac.split2Tokens(Ad.startOffset,this.itemCount++);this.remove(AY);Ae.unshift(AZ[0]);Ae.push(AZ[1]);this.add(Ae,AY);}else{AY=(Ab===AD.EDGE_BEGIN?AY:AY+1);this.add(Ae,AY);}AY=AY+Ae.length-1;Ac=this.ctxtBuilder.itemWidgets[AY];this._delaySetCaretPos(Ac.domNode,false);this.delayedScrollToItem(AY);this.raiseChangeEvent({type:"insert"});},widgetHandleInput:function AA(Ag,Ae){if(!Ag.collapsed){this.widgetDeleteTokens(Ag);Ag=k.getRangeInfo();}var AZ,Ad,Al,Aa,Ah,Ai,Ac=this.ctxtBuilder.itemWidgets,Ak=this,Aj=Ag.startContainer,AY=Ag.startOffset,Ab;if(!n.contains(this.editNode,Aj,false,document.body)||!Ac||Ac.length===0){this.add([{v:Ae,isDelimiter:AQ(Ae),isNew:true,did:this.itemCount++}],0);Ad=Ac[0];k.collapseOnTextNode(Ad.domNode,1);this.delayedScrollToItem(0);return ;}AZ=k.getEdgeInfo(Aj,AY);Ad=n.findWidget(Aj);Al=this.itemIndex(Ad.data);if(AQ(Ae)){if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}Aa={v:Ae,isDelimiter:true,isNew:true,did:this.itemCount++};if(AZ===AD.EDGE_MIDDLE){var Af=Ad.split2Tokens(AY,this.itemCount++);this.remove(Al);this.add([Af[0],Aa,Af[1]],Al);Al=Al+1;}else{Al=(AZ===AD.EDGE_BEGIN)?Al:Al+1;this.add([Aa],Al);}Ad=Ac[Al];k.collapseOnNode(Ad.domNode,false);this._delaySetCaretPos(Ad.domNode,false);if(Ae===t){this.parent.updatepasses();}}else{Ai=AY;if(Ad.isDelimiter()){Ah=Ac[(AZ===AD.EDGE_BEGIN)?Al-1:Al+1];if(Ah&&!Ah.isDelimiter()){Ad=Ah;Ai=(AZ===AD.EDGE_BEGIN)?Ad.length():0;}Al=(AZ===AD.EDGE_BEGIN)?Al:Al+1;this.add([{v:Ae,isNew:true,did:this.itemCount++}],Al);Ad=Ac[Al];k.collapseOnNode(Ad.domNode,false);this.parent.updatepasses();}else{Ab=Ad.data.v;Ag=k.getRangeInfo();Ad.spliceContent(Ai,0,Ae);if(n.isIE||n.isIEW3C){k.collapseOnTextNodeIE(Ad.domNode,Ai+1);window.setTimeout(function(){Ak.editNode.focus();Ak.editNode.focus();k.collapseOnTextNodeIE(Ad.domNode,Ai+1);},0);}else{k.collapseOnTextNode(Ad.domNode,Ai+1);this._delaySetTextCaretPos(Ad.domNode,Ai+1);}}}this.delayedScrollToItem(Al);},widgetHandleImeInput:function X(Af,AY){if(!Af.collapsed){this.widgetDeleteTokens(Af);Af=k.getRangeInfo();}var Aa,Ad,Ak,Ag,Ah,Ac=this.ctxtBuilder.itemWidgets,Aj=this,Ae,Ai=Af.range.startContainer,AZ=Af.range.startOffset,Ab=this.itemsContainerNode.scrollTop;if(!n.contains(this.editNode,Ai,false,document.body)||!Ac||Ac.length===0){this.clearTokens();this.add([{v:AY,isDelimiter:this.isDelimiter(AY),isNew:true,did:this.itemCount++,isIME:true}],0);Ac=this.ctxtBuilder.itemWidgets;Ad=Ac[0];k.collapseOnTextNode(Ad.domNode,Ad.data.v.length||1);this._delaySetCaretPos(Ad.domNode,false);this.delayedScrollToItem(0,Ab);return ;}Aa=k.getEdgeInfo(Ai,AZ);Ad=n.findWidget(Ai);Ak=this.itemIndex(Ad.data);Ah=AZ;if(Ad.isDelimiter()){this.clearTokens();this.set("items",this.prev_items);Ac=this.ctxtBuilder.itemWidgets;Ae=(Aa===AD.EDGE_BEGIN)?Ak-1:Ak+1;Ag=Ac[Ae];if(Ag&&!Ag.isDelimiter()){Ad=Ag;Ah=(Aa===AD.EDGE_BEGIN)?Ad.length():0;Ak=Ae;}}if(!Ad.isDelimiter()){Ad.spliceContent(Ah,0,AY);if(n.isIE||n.isIEW3C){k.collapseOnTextNodeIE(Ad.domNode,Ah+AY.length);window.setTimeout(function(){Aj.editNode.focus();Aj.editNode.focus();k.collapseOnTextNodeIE(Ad.domNode,Ah+AY.length);},0);}else{k.collapseOnTextNode(Ad.domNode,Ah+AY.length);this._delaySetTextCaretPos(Ad.domNode,Ah+AY.length);}}else{Ak=(Aa===AD.EDGE_BEGIN)?Ak:Ak+1;this.add([{v:AY,isNew:true,did:this.itemCount++}],Ak);Ad=Ac[Ak];k.collapseOnNode(Ad.domNode,false);this._delaySetCaretPos(Ad.domNode,false);}this.delayedScrollToItem(Ak,Ab);this.startTokenSuggestion();return Ad;},getSearchPattern:function z(){var AZ=this._saveActiveToken,Ab,AY;if(AZ.isCol){var Aa=AZ.data.v;Ab=Aa.slice(Aa.lastIndexOf(w)+1,Aa.length);}else{Ab=AZ&&AZ.data.v;}AY=Ab&&Ab.length;if(AY>2){if(Ab.charAt(0)===AJ){Ab=Ab.substring(1);}if(Ab.charAt(Ab.length-1)===l){Ab=Ab.substring(0,Ab.length-1);}}return Ab;},getSuggestionPos:function AP(){var Ag=this._saveActiveToken,Ac=null,Aa,Ae=0;if(Ag&&Ag.isCol){Ae=Ag.domNode.offsetWidth;}if(Ag){Aa=n.position(Ag.domNode,true);var Ah=Math.round(Aa.y+Aa.h),Ad=this.suggestionItems.length*19,Af=mstrmojo.all.QBuilderPage,AY=parseInt(Af.height,10),AZ=n.position(Af.domNode,true),Ab=(AY>Ah-40-AZ.y+Ad)?Ah:Aa.y-Ad;Ac={left:Math.round(Aa.x)+Ae+"px",top:Ab+"px",zIndex:100};}return Ac;},onSuggestionItemSelect:function AC(Aa){var AZ=this._saveActiveToken,Ab,Ad=this;this.endTokenSuggestion();if(Aa.t===-98){Ab=this.items;this.clearTokens();K.forEach(Ab,function(Ag){Ag.did=Ad.itemCount++;});this.customFunctionMode=true;Ab=[{v:"{",isDelimiter:true,sta:1,isNew:true,did:this.itemCount++}].concat(Ab).concat([{v:"}",isDelimiter:true,sta:1,isNew:true,did:this.itemCount++}]);this.set("items",Ab);var AY=this.itemIndex({did:this.itemCount-1}),Af=this.ctxtBuilder.itemWidgets[AY-1];this._delaySetCaretPos(Af.domNode,false);}else{if(AZ){if(AZ.isCol){var Ac=AZ.data.v,Ae={};N.copy(Aa,Ae);Ae.n=Ac.slice(0,Ac.lastIndexOf(w)+1)+Aa.n;AZ.setItemInfo(Ae);}else{AZ.setItemInfo(Aa);}this._delaySetCaretPos(AZ.domNode,false);}}},ontokensModify:function(AY){this.ostack.push({its:N.cloneArray(this.items)});this.pnum=-1;this.parent.updatepasses();},dropZone:true,allowDrop:function B(AY){return(AY.action===I||AY.action===F);},getAvatarIconClass:function C(AY){return"enabled";},ondragenter:function D(AY){var AZ=AY.src.widget;if(AZ&&AZ.toggleAvatarClass&&this.allowDrop(AY)){AZ.toggleAvatarClass(this.getAvatarIconClass(AY),true);}},ondragleave:function b(AY){var AZ=AY.src.widget;if(AZ&&AZ.toggleAvatarClass&&this.allowDrop(AY)){AZ.toggleAvatarClass(this.getAvatarIconClass(AY),false);}},ondragover:function j(Ad){var Aa=Ad.tgt.widget,Ai=Ad.tgt.pos.x,Ah=Ad.tgt.pos.y;var Af=Aa.ctxtBuilder.itemWidgets,Ac=Af.length;if(Ac===0){return ;}var Ab=Af[Ac-1].domNode,Ae=n.position(Ab),AZ;if(Ah>Ae.y+Ab.clientHeight){Aa._delaySetCaretPos(Ab,false);}else{for(AZ=Ac-1;AZ>-1;AZ--){if(Af[AZ].data.v===AS||Af[AZ].data.v===m){continue;}var Ag=Af[AZ].domNode,AY=n.position(Ag).y;if(AY<Ah&&!(AY+14<Ah)){Aa._delaySetCaretPos(Ag,false);break;}}}},ondrop:function(AZ){var Ac=AZ.action,Af=AZ.src,AY=mstrApp.getRootController(),Ab=this;if(Af&&Af.data){var Ae=Af.data;if(Ac===I){var Ad=Af.widget.dataHelper;if(!AY.canAddTableSQL()){return ;}K.forEach(Ae,function(Ah){Ad.fetch(Ah,{success:function Ag(Ai){AY.addTableSQL(Ah,Ai.items);AY.enableButton(Ab.getSQLstmt());}});});}else{if(Ac===F){if(!AY.canAddTableSQL()){return ;}var Aa=Af.widget.items[parseInt(Ae._renderIdx.split(":")[0],10)];AY.addTableSQL(Aa,[Ae]);AY.enableButton(Ab.getSQLstmt());}}}},onscroll:function(AY){if(n.isIE8){editNode=AY.srcElement;}if(this.parentNode){mstrmojo.all[this.parentNode.id].parent.updatepasses();}},onRender:function O(){if(this.hasRendered){n.attachEvent(this.editNode,"scroll",this.onscroll);this.itemsContainerNode.style.height="100%";}},addCandidateTables:function AT(AY){var AZ=[],Aa,Ab=AY.value;AI={};K.forEach(Ab,function(Ac){Aa=Ac.ns?Ac.ns+w+Ac.n:Ac.n;AZ.push({n:Aa,sta:2,t:15});AI[Aa.toLowerCase()]=Ac;});this.set("candidates",{items:this.sqlTokens.concat(AZ).concat(mstrApp.getRootController().getSuggestionItems(true)),isComplete:true});},scrollToItem:function g(Ae,Aa){var AY=this.itemsContainerNode,Ac=AY.childNodes[Ae],Ad,AZ,Ab=AY.clientHeight,Af;if(typeof Aa!=="number"){Aa=AY.scrollTop;}AZ=Aa;if(!Ac){return ;}Af=Ac.offsetHeight;Ad=Ac.offsetTop;if(Ad<Aa){AZ=Ad;}else{if(Aa+Ab<Ad+Af){AZ=Math.min(Ad,Ad+Af-Ab);}}AY.scrollTop=AZ;},delayedScrollToItem:function u(Aa,AY){var AZ=this;if(typeof AY!=="number"){AY=this.itemsContainerNode.scrollTop;}window.setTimeout(function(){AZ.scrollToItem(Aa,AY);},0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ME.TokenInputBox");mstrmojo.requiresDescs(13542,13543);var B=mstrmojo.array;var L={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3,AMBIGUITY:4},G={0:"valid",1:"unknown",2:"validating",3:"error",4:"ambiguity"},H={0:mstrmojo.desc(9565,"Valid Metric Formula."),1:mstrmojo.desc(9106,"Require Validation?"),2:mstrmojo.desc(9566,"Validation in Progress..."),3:mstrmojo.desc(9567,"Validation Failed with Syntax Error!"),4:mstrmojo.desc(9568,"Validation Failed with Object Ambiguity!")};function D(O){if(!O){return L.VALID;}return{"-2147214845":L.ERROR,"-2147214846":L.AMBIGUITY}[O]||L.ERROR;}mstrmojo.ME.MetricEditBox=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.MetricEditBox",vStatus:L.VALID,iStatus:"",showStatus:true,browseItemVisible:true,absorbAmbiguity:true,isObjectVisible:function(O){return true;},markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-MEBox-edit"></div><div class="mstrmojo-MEBox-status {@statusCssClass}"><div class="mstrmojo-MEBox-vStatus"></div><div class="mstrmojo-MEBox-iStatus"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},iStatusNode:function(){return this.domNode.lastChild.lastChild;},vStatusNode:function(){return this.domNode.lastChild.firstChild;}},markupMethods:{onvStatusChange:function(){var P=this.vStatus,O=this.vStatusNode;O.className="mstrmojo-MEBox-vStatus "+G[P];O.innerHTML=(this.getStatusDesc&&this.getStatusDesc(P))||H[P]||"";},oniStatusChange:function(){this.iStatusNode.innerHTML=this.iStatus;this.iStatusNode.title=this.iStatus;}},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",renderOnScroll:false,renderBlockSize:0,bindings:{browseItemVisible:"this.parent.browseItemVisible",candidates:"this.parent.candidates"}}],init:function N(O){if(this._super){this._super(O);}this.statusCssClass=this.showStatus?"":"hidden";},getSearchPattern:function M(){return this.inputBox.getSearchPattern();},getHighlightedText:function I(P,O){return this.inputBox.getHighlightedText(P,O);},item2textCss:function F(O){return{4:"m",7:"am",11:"fx",12:"a",13:"fc",43:"tr",47:"cs"}[O.t]||"";},handleSuggestionItemSelect:function E(O){var P=this.abiguityDialog;if(O){P.onItemSelect(O);}P.close();},showDesc:true,showPath:true,abiguityDialog:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-ME-ambiguityDialog",onOpen:function(){this.set("title",mstrmojo.desc(13542,"Object Ambiguity - ##").replace("##",this.ambiguousName));this.list.clearSelect();this.list.set("items",this.items);this.list.singleSelect(0);this.label.set("text",mstrmojo.desc(13543,"More than one object with the name '##' were found.").replace("##",this.ambiguousName));},children:[{scriptClass:"mstrmojo.Label",alias:"label",text:""},{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",alias:"list",cssClass:"mstrmojo-ME-ambiguityList",bindings:{items:"this.parent.opener.suggestionItems"},onclick:function(O){mstrmojo._IsList.onclick.call(this,O);}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:mstrmojo.desc(547,"Select"),onclick:function(){var O=this.parent.parent;O.opener.handleSuggestionItemSelect(O.list.selectedItem);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]},defaultOnTokensModify:function(){this.set("vStatus",L.UNKNOWN);this.set("iStatus","");},postBuildRendering:function A(){this._super();this.inputBox.attachEventListener("tokensModify",this.id,"defaultOnTokensModify");this.inputBox.attachEventListener("tokensModify",this.id,"ontokensModify");},updateInputBoxItems:function K(O){this.inputBox.set("items",O.items);},replaceErrorToken:function C(O){this.inputBox.replaceErrorToken(O);},handleValidation:function J(O){if(!O){this.set("vStatus",L.ERROR);return ;}O.vs=D(O.rjec);this.set("vStatus",O.vs);this.set("iStatus",O.rjed||"");this.updateInputBoxItems(O);this.inputBox.focus();if(O.vs===L.AMBIGUITY){var W=this,T=O.items,S=B.find(T,"sta",-1),P=T[S].v,U=function(X){W.replaceErrorToken(X);W.set("iStatus","");W.set("vStatus",L.UNKNOWN);if(W.continueValidataion){W.continueValidataion();}};var Q=B.filter(O.srfd.items,this.isObjectVisible);var V=this.parent.candidates,R=V&&V.items;if(R){B.forEach(Q,function(Y){var X=B.find(R,"did",Y.did);if(X===-1){if(this.absorbAmbiguity){R.push(Y);}}else{Y.path=R[X].path;}});}if(Q.length===1){U(Q[0]);return ;}this.openPopup("abiguityDialog",{zIndex:100,items:Q,ambiguousName:P,onItemSelect:U});}else{if(this.postHandleValidation){this.postHandleValidation();}}}});mstrmojo.ME.MetricEditBox.VALIDATION_STATUS=L;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo._ValidateSuggestions","mstrmojo.WidgetList","mstrmojo.Editor","mstrmojo.LegacySuggestionList");mstrmojo.Enum_OIB_States=mstrmojo.hash.copy(mstrmojo._ValidateSuggestions.ENUM_STATES,{EDITING:2,ADDING:3,EMPTY:4});mstrmojo.Enum_OIB_States_CSS=(function(){var AE=mstrmojo.Enum_OIB_States,AD={},AF;for(AF in AE){if(AE.hasOwnProperty(AF)){AD[String(AE[AF])]=AF;}}return AD;}());var Q=mstrmojo.dom,S=mstrmojo.hash,Z=mstrmojo.Enum_OIB_States,I=0,b="_did_",z=mstrmojo.Enum_Keys,AB=80,U=200;function P(){return I++;}function g(AD){return(AD&&AD.state===Z.ADDING);}function p(AD){var AE={n:AD||"",state:Z.EMPTY};AE[b]=-2;return AE;}function O(AD){return(AD&&AD.state===Z.EMPTY);}function u(AE){var AF=AE.items,AD=AF&&AF.length;if(!AD){return true;}return(AD===1&&g(AF[0]))||(AD===2&&O(AF[0])&&g(AF[1]));}function l(){var AE=this.ctxtBuilder.itemWidgets,AD=AE[AE.length-1];if(AD&&AD.isAdding){var AF=this;Q.attachEvent(AD.domNode,"click",function(){AF.editingIdx=null;});return AD;}return null;}function L(){var AD=this.editingIdx;if(AD!==null){return this.ctxtBuilder.itemWidgets[AD];}return l.call(this);}function D(){this.isActive=false;var AE=this.emptyText||"",AF=this.items;if(u(this)&&!O(AF[0])&&(AE.length>0)){this.add([p(AE)],0);var AG=this.ctxtBuilder.itemWidgets[0];AG.set("shouldEllipsize",true);AG.doEllipsize();}var AD=L.call(this);if(AD){if(g(AD)&&this.showEmptyItem){AD.domNode.style.display="none";}this.scrollTo(this.items[0]);AD.blur();}Q.detachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.detachEvent(AD.inputNode,"keydown",this._tabKeyHander);}}function N(){if(!this.enabled){return ;}this.isActive=true;if(O(this.items[0])){this.remove(0);}var AD=L.call(this);if(AD){if(g(AD)&&!this.isFull){AD.domNode.style.display="block";}this.scrollTo(AD.data);AD.focus();}Q.attachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.attachEvent(AD.inputNode,"keydown",this._tabKeyHander);}}mstrmojo.ObjectInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._ValidateSuggestions],{scriptClass:"mstrmojo.ObjectInputBox",cssClass:"mstrmojo-ObjectInputBox",emptyText:"",showEmptyItem:true,items:null,itemField:"n",dynamicVerify:true,suggestCount:10,candidates:null,makeObservable:true,renderOnScroll:false,editingIdx:null,isActive:false,maxObjectCount:null,isFull:false,suggestionListClass:"mstrmojo.LegacySuggestionList",acptSugItemOnly:false,useKeyDelay:false,showSuggestionOnEdit:true,tabNavigable:false,getSearchPattern:function(){var AD=L.call(this);if(AD){return AD.getSearchPattern();}return"";},getSuggestionTarget:function m(){return this.suggestTarget;},onsuggestTargetChanged:function o(AD){this._request_pattern=null;},getSuggestionPos:function c(){return this._pop_cfg;},onSuggestionItemSelect:function w(AD){if(this.suggestTarget){this.suggestTarget.setItem(AD[this.itemField],AD,false);}this.hideSuggestion();this.closePopup();},hideEditButton:function(AD){return !!this.noEditButton;},_set_items:function k(AI,AF){AF=mstrmojo.hash.clone(AF)||[];var AH=this.maxObjectCount;this.set("isFull",(AH&&AF.length>=AH));if(AF.length===0){var AE=this.emptyText||"";if(AE.length>0){AF.push(p(AE));}}var AG={n:"",state:Z.ADDING};AG[b]=-1;AF.push(AG);var AD=AF[AF.length-1];if(AD&&g(AD)&&this.maxObjectCount&&(this.getSelectedObjects().length>=this.maxObjectCount)){this.set("isFull",true);}this.itemIdField=b;return this._super(AI,AF);},add:function E(AE,AD){var AF=l.call(this);if(!this.maxObjectCount||this.getSelectedObjects().length<this.maxObjectCount){this._super(AE,AD);}if(!u(this)&&O(this.items[0])){this.remove(0);}if(AF){AF.adjustInputWidth();if(this.maxObjectCount&&(this.getSelectedObjects().length===this.maxObjectCount)){this.set("isFull",true);AF.domNode.style.display="none";}else{AF.domNode.style.display=this.showEmptyItem?"none":"";}}},remove:function a(AD){this._super(AD);var AE=l.call(this);if(AE){if(this.maxObjectCount&&(this.getSelectedObjects().length<this.maxObjectCount)){this.set("isFull",false);}AE.adjustInputWidth();}},preBuildRendering:function(){if(this.items==null||this.items.length==0){this.set("items",[]);}if(this._super){this._super();}},postBuildRendering:function Y(){this._super();var AE=this,AD=l.call(AE);if(AD&&(this.showEmptyItem||this.isFull)){AD.domNode.style.display="none";}this._clickHandler=function(){N.call(AE);};this._mousedownHandler=function(AF){if(!AE.isActive||AE.browserShown){return ;}var AG=Q.eventTarget(self,AF);if(AG&&AG.parentNode&&!Q.contains(L.call(AE).domNode,AG,false,document.body)&&!Q.contains(AE.suggestionPopup.domNode,AG,false,document.body)){D.call(AE);}};if(this.tabNavigable){this._tabKeyHander=function(AF){var AG=parseInt(AF.keyCode||AF.charCode,10);if(AG===z.TAB){if(!AE.isActive||AE.browserShown){return ;}D.call(AE);}};}Q.attachEvent(this.domNode,"click",this._clickHandler);},nextId:P,item2textCss:function M(AD){return AD.cssClass||"";},itemFunction:function G(AF,AD,AE){AF[AE.itemIdField]=P();var AG=new mstrmojo.ObjectItem({parent:AE,itemField:AE.itemField,cssClass:AE.item2textCss(AF),data:AF,showSuggestionOnEdit:this.showSuggestionOnEdit,enabled:AE.enabled});AE.attachEventListener4ItemWidget(AG,AE);return AG;},attachEventListener4ItemWidget:function h(AH,AF){var AE=["ItemEditBegin","ItemEditEnd","ItemDeletePrev","ItemDelete","ItemAdd","SuggestionOn","SuggestionOff","ItemEditing"],AD=AE.length,AG;for(AG=0;AG<AD;AG++){AH.attachEventListener(AE[AG],AF.id,"_itemChangeHandler");}return AH;},getSelectedObjects:function j(){if(u(this)){return[];}var AD=this.items,AE=AD.length-1;if((AE>-1)&&g(AD[AE])){return AD.slice(0,AE);}return AD.concat();},isValid:function C(){var AE=this.ctxtBuilder.itemWidgets,AD=AE&&AE.length,AF;for(AF=0;AF<AD;AF++){if(!AE[AF].isValid()){return false;}}return true;},isEmpty:function V(){return u(this);},_itemChangeHandler:function(AG){var AI=AG.name,AJ=AG.d,AE,AD=this.items.length,AF;switch(AI){case"ItemEditBegin":if(this.editingIdx!==null){AF=L.call(this);if(AF){AF.blur();}}AE=this.itemIndex(AJ);this.editingIdx=AE;N.call(this);break;case"ItemEditEnd":this.editingIdx=null;if(AG.deactivate){D.call(this);}else{N.call(this);}AF=l.call(this);if(AF){AF.adjustInputWidth();}break;case"ItemDelete":if(this.editingIdx!==null){AF=L.call(this);if(AF){AF.blur();}this.editingIdx=null;}AE=this.itemIndex(AJ);this.remove(AE);if(!AG.deactivate){this.editingIdx=null;N.call(this);}else{if(!this.isActive){D.call(this);}else{N.call(this);}}break;case"ItemDeletePrev":if(AD>1){this.remove(AD-2);}break;case"ItemAdd":var AH=S.copy(AG.d);this.add([AH],AD-1);if(AG.deactivate){D.call(this);}else{N.call(this);}break;case"SuggestionOn":this.set("suggestTarget",AG.target);this._pop_cfg={target:AG.target,left:AG.l,top:AG.t,zIndex:this.zIndex?this.zIndex:100};this.showSuggestion(AG.pattern);break;case"SuggestionOff":this.set("suggestTarget",null);this.hideSuggestion();break;}if(this.onitemchange&&(AI==="ItemEditEnd"||AI==="ItemAdd"||AI==="ItemDelete"||AI==="ItemDeletePrev"||AI==="ItemEditing")){this.onitemchange();}},unrender:function B(AE){var AD=this.suggestionPopup;if(AD.hasRendered){AD.unrender(false);}if(this._super){this._super(AE);}},destroy:function t(AE){var AD=this.suggestionPopup;if(AD&&AD.hasRendered){AD.destroy(false);}if(this._super){this._super(AE);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ObjectInputBox,{onenabledChange:mstrmojo.Widget.enabledMarkupMethod});mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasEllipsis");var q="mstrmojo-ObjectItem-text";mstrmojo.ObjectItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasEllipsis],{scriptClass:"mstrmojo.ObjectItem",markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode"><span title=" {@title}" class="'+q+' {@cssClass}"></span><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])"/></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" mstrAttach:keyup,keydown/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},editButtonNode:function(){return this.domNode.firstChild.childNodes[1];},delButonNode:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},markupMethods:{oncssClassChange:function(){this.textNode.className=q+" "+this.cssClass;},onstateChange:function(){var AG=this.state,AF=mstrmojo.Enum_OIB_States_CSS[AG],AE=this.domNode;if(AG===Z.EMPTY){AE.innerHTML=this.enabled?'<div class="mstrmojo-ObjectItem-emptyText">'+this.text+"</div>":"";}else{if(AG===Z.EDITING){var AD=Math.round(this.displayNode.clientWidth);this.editNode.style.width=AD-4+"px";this.inputNode.style.width=AD-9+"px";}}AE.className="mstrmojo-ObjectItem "+AF;this.updateButtonsVisibility(this.data);},ontextChange:function(){this.inputNode.value=this.text;this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);}},updateButtonsVisibility:function AC(){if(this.parent.hideEditButton(this.data)){this.editButtonNode.style.display="none";}},state:Z.VALID,onstateChange:function e(AD){this.data.state=this.state;},ontextChange:function H(AD){this.data[this.itemField]=this.text;},updateData:function F(AD){S.copy(AD,this.data);this.set("state",Z.VALID);this.set("text",this.data[this.itemField]);this.set("cssClass",this.parent.item2textCss(this.data));},init:function x(AE){this._super(AE);var AG=this.data,AD=AG.state,AF=this.parent;AD=this.initState();this.cssClass=AF.item2textCss(AG);this.text=AG[this.itemField];this.state=AD;this.isAdding=g(AG);this.useRichTooltip=true;this.title=this.text;},initState:function K(){var AE=this.parent,AF=this.data,AD=AF.state;if(AF&&AF.did){AF.state=Z.VALID;return AF.state;}if(typeof AD==="undefined"){AD=AE.dynamicVerify?AE.verifyObject(AF[this.itemField],this):Z.UNDETERMINED;AF.state=AD;}return AD;},isValid:function C(){var AD=parseInt(this.state,10);return(AD!==Z.INVALID&&AD!==Z.UNDETERMINED);},adjustInputWidth:function A(){if(this.isAdding){var AG=this.inputNode.style;AG.width=AB+"px";var AF=this.domNode.parentNode,AD=AF.parentNode.offsetWidth,AE=Math.max(AD-AF.offsetLeft-20,AB);if(!isNaN(AE)){AG.width=AE+"px";}}},blur:function T(){this.hideSuggestion();if(!this.isActive){return ;}this.isActive=false;var AF=this.inputNode,AD=AF.value,AE=this.parent;window.setTimeout(function(){try{AF.blur();}catch(AG){}},0);if(!AD){return ;}if(AE.acptSugItemOnly&&this._tWas_){this.set("text",AD);this.set("text","");this._tWas_=null;return ;}this.setItem(AD,null,true);},focus:function r(){var AE=this.inputNode,AD=this.isActive;window.setTimeout(function(){try{AE.focus();if(AE.createTextRange&&!AD){var AG=AE.createTextRange(),AF=AE.value.length;AG.move("character",AF);AG.select();}else{if(AE.setSelectionRange&&!AD){var AF=AE.value.length;AE.setSelectionRange(AF,AF);}}}catch(AH){}},0);this.isActive=true;},prekeydown:function J(AD){var AF=this.inputNode.value,AE=parseInt(AD.e.keyCode||AD.e.charCode,10),AH=this.parent;if(!AF){return ;}if(AE===z.TAB||AE===z.ENTER){if(AE===z.ENTER){Q.preventDefault(AD.hWin,AD.e);}var AG=AH.getSelected();if(AG&&AG.did){AH.handleSuggestionItemSelect(AG);}else{this.hideSuggestion();if(!AH.acptSugItemOnly){this.setItem(AF,null,false);}else{this.set("text",AF);this.set("text","");}}}else{if(AE===z.DOWN_ARROW){if(!AH.noCache&&!AH.suggestionShown){this.showSuggestion(AF);AH.preHighlight();}AH.nextHighlight();}else{if(AE===z.UP_ARROW){AH.preHighlight();}}}},prekeyup:function AA(AD){var AF=this.inputNode.value,AE=parseInt(AD.e.keyCode||AD.e.charCode,10),AI=this.isAdding,AH=this.parent;if(!AF){if(AI){if(AE===z.BACKSPACE&&!this._tWas_){this.raiseEvent({name:"ItemDeletePrev"});Q.preventDefault(AD.hWin,AD.e);}this._tWas_=null;}else{this.raiseEvent({name:"ItemDelete",d:this.data});}this.hideSuggestion();return ;}if(AE===z.ESCAPE||AE===z.TAB){this.hideSuggestion();if(AH.acptSugItemOnly){this.set("text",AF);this.set("text","");this._tWas_=null;return ;}}else{if(this._tWas_!==AF){this.textChanged=true;this.raiseEvent({name:"ItemEditing",d:this.data});if(AH.useKeyDelay){window.clearTimeout(this._timerID);var AG=this;this._timerID=window.setTimeout(function(){var AJ=AG.inputNode.value;if(AJ){AG.showSuggestion(AJ);}AG._timerID=null;},U);}else{this.showSuggestion(AF);}}}this._tWas_=AF;},setItem:function(AD,AF,AE){var AG=this.isAdding;AE=AE||false;this.set("text",AD);if(AG){this.setItem_Adding(AD,AF,AE);}else{this.setItem_Editing(AD,AF,AE);}this._tWas_=null;},setItem_Adding:function(AD,AF,AE){this.set("text","");if(!AF){AF={};AF[this.itemField]=AD;}else{AF.state=Z.VALID;}this.raiseEvent({name:"ItemAdd",d:AF,deactivate:AE});},setItem_Editing:function(AD,AF,AE){var AG=this.parent;this.set("text",AD);if(AF){this.updateData(AF);}else{if(this.textChanged){var AH={};AH[b]=this.data[b];delete this.data.did;this.data=AH;this.textChanged=false;}this.set("state",AG.verifyObject(AD,this));this.set("cssClass",AG.item2textCss(this.data));}this.isActive=false;this.raiseEvent({name:"ItemEditEnd",d:AF,deactivate:AE});},getSearchPattern:function W(){return this.inputNode.value;},showSuggestion:function n(AD){var AE=mstrmojo.dom.position(this.domNode,true);this.raiseEvent({name:"SuggestionOn",l:Math.round(AE.x)+"px",t:Math.round(AE.y+AE.h)+"px",pattern:AD,target:this});},hideSuggestion:function f(){this.raiseEvent({name:"SuggestionOff"});},del:function R(AD){AD=AD||self.event;Q.stopPropogation(self,AD);this.raiseEvent({name:"ItemDelete",d:this.data,deactivate:true});if(this.useRichTooltip&&this.hideTooltip){this.hideTooltip();}},edit:function X(){this.set("state",Z.EDITING);this.raiseEvent({name:"ItemEditBegin",d:this.data});if(this.showSuggestionOnEdit){this.showSuggestion(this.text);}},doEllipsize:function d(){if(!this.shouldEllipsize){return ;}var AE=this.maxItemWidth,AD;if(AE){this.domNode.style.maxWidth=AE;switch(parseInt(this.state,10)){case Z.VALID:case Z.UNDETERMINED:case Z.INVALID:AD=this.textNode;break;case Z.EMPTY:AD=this.domNode.firstChild;break;}if(AD){this.set("richTooltip",{content:this.text,contentNodeCssClass:"sp-tooltip",posType:mstrmojo.tooltip.POS_TOPLEFT,left:0,top:30,refNode:this.domNode});mstrmojo.css.addClass(AD,"truncated");}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Dialog","mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.form","mstrmojo.LoginEditor");mstrmojo.requiresDescs(2699,7773,11812,11865,13380,13381,13382);var D=mstrmojo.desc(13382,"Your user session will time out due to inactivity in # ##."),S=60,M=false,G=null,A=null,H=null;function N(){return mstrApp.sessionState||microstrategy.sessionState;}function K(V,U){if(mstrApp.is508){for(var T in U){V.setAttribute(T,U[T]);}}}mstrmojo.SessionManager=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SessionManager",cssClass:"mstrmojo-SessionManager",width:"370px",title:mstrmojo.desc(11812,"Notification"),msgInterval:1,checkSessionInterval:20,zIndex:10000,maxSessionIdleTime:600,timeBeforeSessionTimeoutWarning:60,remainingTime:60,sessionTimedout:false,buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(13381,"Stay logged in"),function(){var T=this.parent.parent;if(A){T.keepSessionAlive();}T.hideMessage();},true,{onRender:function(){K(this.domNode,{tabindex:0,role:"button","aria-label":mstrmojo.desc(13381,"Stay logged in")});}}),mstrmojo.Button.newWebButton(mstrmojo.desc(13380,"Log out"),function(){this.parent.parent.hideMessage();mstrmojo.form.send({evt:3019,src:mstrApp.name+".3019"});},null,{onRender:function(){K(this.domNode,{tabindex:0,role:"button","aria-label":mstrmojo.desc(13380,"Log out")});}})],children:[{scriptClass:"mstrmojo.Label",alias:"message",cssClass:"mstrmojo-SessionManager-msg",text:"",allowHTML:true,ontextChange:function(){if(mstrApp.is508){this.refresh();var T=this.domNode;K(T,{tabindex:-1,role:"alert"});window.setTimeout(function(){T.focus();},0);}}}],postBuildRendering:function(){this._super();if(mstrApp.is508){this.msgInterval=10;K(this.editorNode,{role:"alertdialog",tabindex:-1});}},updateMsg:function B(U){var T;if(U>60){T=D.replace("##",mstrmojo.desc(2699,"minutes")).replace("#","<b>"+Math.ceil(U/S)+"</b>");}else{if(U>-1){T=D.replace("##",mstrmojo.desc(7773,"seconds")).replace("#","<b>"+U+"</b>");}else{T=mstrmojo.desc(11865,"Your session is expired.");}}this.message.text="";this.message.set("text",T);this.remainingTime=U;},showMessage:function F(T){this.updateMsg(T);this.set("visible",true);M=true;},hideMessage:function I(){if(A){window.clearInterval(A);A=null;window.clearInterval(H);H=null;}this.set("visible",false);M=false;},popupTimeoutWarning:function L(X){if(M){return ;}var V=this,W=(typeof X==="number")?X:V.timeBeforeSessionTimeoutWarning,T=W,U=mstrmojo.now();if(mstrApp.enableWarningSessionTimeout){if(!this.hasRendered){this.render();}this.showMessage(T);}window.clearInterval(A);A=window.setInterval(function(){if(T<1){window.clearInterval(A);A=null;window.setTimeout(function(){if(mstrApp.enableWarningSessionTimeout){V.gotoLogoutPage();}else{V.sessionTimedout=true;V.closeSession();}},200);}var Y=Math.round((mstrmojo.now()-U)/1000);T=W-Y;V.updateMsg(T);},this.msgInterval*1000);window.clearInterval(H);H=window.setInterval(function(){V.isSessionAlive();},this.checkSessionInterval*1000);},warningTimeoutTimer:function Q(T){var U=this;window.clearTimeout(G);G=window.setTimeout(function(){G=null;U.isSessionAlive();},(T-this.timeBeforeSessionTimeoutWarning)*1000);},isSessionAlive:function E(){var T=this,V={success:function(W){var X=parseInt(W,10);if(X!==-1){if(X>T.remainingTime){T.hideMessage();}if(X>T.timeBeforeSessionTimeoutWarning){T.warningTimeoutTimer(X);}else{T.popupTimeoutWarning(X);}}else{window.clearInterval(H);T.popupTimeoutWarning(0);}},failure:function(){mstrmojo.alert("Problems encountered during checking for whether session is alive. Connection is down or session already time out.");}},U={taskId:"isSessionAlive",notRestartSessionManager:true};mstrmojo.xhr.request("POST",mstrConfig.taskURL,V,U);},keepSessionAlive:function R(){var T=this,V={success:function(W){if(W){T.warningTimeoutTimer(T.maxSessionIdleTime);}else{T.sessionTimedout=true;mstrmojo.alert("Your session is expired.");}},failure:function(){mstrmojo.alert("Problems encountered during activating session. Connection is down or session already time out.");}},U={taskId:"keepSessionAlive"};mstrmojo.xhr.request("POST",mstrConfig.taskURL,V,U);},closeSession:function J(){var T=this;mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(){T.sessionTimedout=true;}},{taskId:"closeSessions",sessionStates:N(),notRestartSessionManager:true});},restart:function(){this.sessionTimedout=false;this.hideMessage();if(this.maxSessionIdleTime>this.timeBeforeSessionTimeoutWarning){this.warningTimeoutTimer(this.maxSessionIdleTime);}},start:function C(){var V=mstrConfig.lastMsgKey;if(this.maxSessionIdleTime>this.timeBeforeSessionTimeoutWarning){this.warningTimeoutTimer(this.maxSessionIdleTime);}var U=function(){window.localStorage.setItem("msg_recovery_notify"+V,1);};if(window.addEventListener){window.addEventListener("beforeunload",U);}else{window.attachEvent("onbeforeunload",U);}var T=window.sessionStorage;if(T){T.setItem("msg_browser_not_closed"+V,1);T.setItem("msg_user_login",0);}},openLoginEditor:function P(V){var U="LoginEditor",T=mstrmojo.all[U];if(!T){T=mstrmojo.insert({id:U,scriptClass:"mstrmojo.LoginEditor",config:{callback:{}},zIndex:10000});}T.config.callback=V;T.open();},gotoLogoutPage:function O(){mstrmojo.form.send({evt:3008,src:mstrApp.name+".3008",autoLoggedout:true,Server:mstrConfig.serverName,Port:mstrConfig.serverPort,Project:mstrConfig.projectName,loginReq:true},null,"POST");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox","mstrmojo.warehouse.dbroles.DBRoleSettingPulldown");mstrmojo.requiresDescs(14036,14037,14038,14467);var K=mstrmojo.array,D=mstrmojo.hash,G=mstrmojo.warehouse.dbroles.DBRoleHelper,P="MSTR_CUSTOM=true;",I=mstrmojo.desc(14036,"Show connection string"),J=mstrmojo.desc(14037,"Hide connection string"),C=mstrmojo.desc(14038,"Edit connection string");mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor",cssClass:"mstrmojo-wh-DBRoleSettingConnectionStringEditor",enabled:true,getValue:function F(){if(this.visibleContents&&this.enabledContents){var Q=this.contents.connectionArea.value;return G.cleanDSNConnection(Q+(Q.slice(-1)===";"?"":";")+P);}return"";},setValue:function B(Q){var R=this.contents;this.toggleContents();R.editString.setValue(true);R.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(Q).replace(P,""));},isValid:function O(){return{val:true,msg:""};},connectionArea:undefined,driverList:undefined,showLabel:undefined,editString:undefined,info:{},drivers:[],enableFn:mstrmojo.emptyFn,generateConnectionStringFn:mstrmojo.emptyFn,dbID:{},dbms:{},load:function L(){var Y=this.contents,Z=this.dbID,U=this.dbms,S=Z.dbVersions[K.find(Z.dbVersions,"v",U.db_ver)],R=S.connections[0],T=G.driverExists.call(this,[R]),V={},W=[];K.forEach(this.dbIDVersions,function(a){K.forEach(a.dbVersions,function(b){K.forEach(b.connections.concat(b.altconnections),function(c){V[c.driver]=c;});});});var Q;D.forEach(this.drivers,function(a){Q=mstrmojo.hash.clone(a);if(V[a.n]){Q.n=Q.n+" (Certified)";Q.title=Q.n;Q.str=V[a.n].str;}W.push(Q);});Y.driverList.set("items",W);if(T.exists){var X=K.find(this.drivers,"n",T.driver);if(X<0){X=0;}Y.driverList.set("selectedID",W[X].n);}this.updateString();},visibleContents:false,enabledContents:false,toggleContents:function A(){this.visibleContents=!this.visibleContents;this.contents.set("visible",this.visibleContents);this.showLabel.set("text",(this.visibleContents?J:I));if(!this.visibleContents){this.contents.editString.setValue(false);this.enableFn(true);}else{this.load();}},updateString:function N(){if(this.visibleContents){this.contents.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(this.generateConnectionStringFn()));}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-ShowConnection",alias:"showLabel",text:I,onclick:function M(){this.parent.toggleContents();}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionStringContents",alias:"contents",visible:false,children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",label:C,alias:"editString",oncheckedChange:function E(){var Q=this.parent;Q.parent.enableFn(!this.checked);Q.connectionArea.set("enabled",this.checked);Q.driverList.set("enabled",this.checked);Q.parent.enabledContents=this.checked;}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",cssClass:"mstrmojo-wh-DBRolePulldown mstrmojo-wh-DBRoleConnection-driverList",caption:mstrmojo.desc(14467,"Driver"),alias:"driverList",itemIdField:"n",itemField:"n",enabled:false,bindings:{visible:function(){var Q=this.parent.parent;return(Q.dbID.connType&4)!==4;}},onChange:function H(Q){var R=this.parent.parent,T=this.parent.parent.contents,S;if(R.enabledContents){S=Q.str||"";}T.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(R.generateConnectionStringFn(S).replace(P,"")));}},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionString",value:"",alias:"connectionArea",enabled:false}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.architect.ui.editors.DataSourceEditor","mstrmojo.warehouse.EnumObjectTypes");var J=mstrmojo.array,C=mstrmojo.architect.menu.EnumMenuActions,L=mstrmojo.warehouse.EnumObjectTypes,E=mstrmojo.desc(11398,"Functionality not yet implemented."),G=mstrmojo.desc(6722,"Are you sure you want to delete '##'?"),I="Are you sure you want to delete these ## objects?";var K=false;function F(P,N){var O=this.data,M=(O&&O.length)?O[0]:O;return(M&&M[P])?M[P](O,N):true;}mstrmojo.architect.menu.ArchitectMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.menu.ArchitectMenu",dynamicUpdate:true,queryEnabled:function H(M){return F.call(this,"isEnabled",M)||K;},queryVisible:function D(M){return F.call(this,"isVisible",M)||K;},queryChecked:function B(M){return F.call(this,"isChecked",M)||K;},executeCommand:function(V){var U=mstrmojo.architect.menu.ArchitectMenu.EnumRelationType,Q=this.data,R=mstrApp.getRootController(),P=Q.parentAttributeId,M=Q.childAttributeId,N=Q.relationTableId;switch(V.action){case C.NONE:break;case C.DELETE:var O;if(Q.length){O=I.replace("##",Q.length);}else{O=G.replace("##",Q.n);}mstrmojo.confirm(O,{confirmBtn:{fn:function(){R.deleteObject(Q);}}});break;case C.RENAME:R.renameObject(Q);break;case C.AUTOMAP:R.autoMapTable([].concat(Q));break;case C.SAMPLE_DATA:R.showSampleData(Q);break;case C.CONVERT_ATTR_TO_FACT:R.convertAttributeToFact(Q);break;case C.CONVERT_ATTR_TO_FORM:R.convertAttributeToForm(Q,V);break;case C.LOGICAL_TABLE_SIZE:R.setTableLogicalSize(Q);break;case C.CONVERT_COLUMN_TO_FORM:R.convertColumnToForm(Q,V);break;case C.SET_AS_MULTILINGUAL:R.setAsMultiLingual(Q);break;case C.CONVERT_FACT_TO_ATTR:R.convertFactToAttribute(Q);break;case C.REMOVE_FROM_TABLE:R.removeFromTable(Q);break;case C.SET_AS_LOOKUP:R.setAsLookup(Q);break;case C.NEW_FACT:V.tp=L.FACT;V.isNew=true;R.openExpressionEditor(Q,V);break;case C.NEW_ATTR:V.tp=L.ATTRIBUTE;V.isNew=true;R.openExpressionEditor(Q,V);break;case C.UPDATE_FORMAT:R.updateFormFormat(Q,V);break;case C.EDIT:V.tp=Q.tp;V.isNew=false;R.openExpressionEditor(Q,V);break;case C.MAPPING:R.updateMappingMethod(Q,V);break;case C.UPDATE_AGGR:R.updateAggregation(Q,V);break;case C.REMOVE_TABLE:R.removeFromCurrentLayer(Q);break;case C.ADD_ATTRIBUTE:R.createAttribute(Q);break;case C.ADD_FACT:R.createFact(Q);break;case C.DATA_SOURCES:var T=mstrmojo.all[this._dseid]||new mstrmojo.architect.ui.editors.DataSourceEditor({onSubmit:function S(W){R.setTableDBRoles(W);}});this._dseid=T.id;T.open(undefined,{dataSources:R.getTableDBRoles(Q)});break;case C.REMOVE_ATTR_FROM_RELATIONSHIP:R.removeAttributeFromRelation(Q);break;case C.DELETE_RELATIONSHIP:R.removeRelation(P,M);return ;case C.ONE_TO_ONE:R.updateRelation(P,M,U.ONE_TO_ONE,N);break;case C.ONE_TO_MANY:R.updateRelation(P,M,U.ONE_TO_MANY,N);break;case C.MANY_TO_MANY:R.updateRelation(P,M,U.MANY_TO_MANY,N);break;case C.RELATIONSHIP_TABLE_ENTRY:R.updateRelation(P,M,Q.relationType,V.did);break;case C.SHOW_UNUSED_COLUMNS:R.changeLayerTableColumnView([].concat(Q),V);break;case C.ADD_TO_LAYER:R.addOrRemoveTables([].concat(Q),true);break;case C.REMOVE_FROM_LAYER:R.addOrRemoveTables([].concat(Q),false);break;case C.UPSTRUCT:R.handleUpdateStructures([].concat(Q));break;case C.CREATE_ALIAS:R.createTableAlias([].concat(Q));break;case C.LINKS:R.showLinks(Q);break;case C.UPDATE_CATEGORY:R.updateFormCategory(Q,V);break;case C.UNGROUP_FORMS:R.unGroupForms(Q,V);break;case C.UPDATE_GROUP:R.groupForms([Q],V);break;case C.UNGROUP_FORM:R.unGroupForms(Q,V);break;case C.TX_ONE_TO_ONE:R.setTransformationCardinality(Q.did,true);break;case C.TX_MANY_TO_MANY:R.setTransformationCardinality(Q.did,false);break;case C.TX_APPLY_TO_ALL:R.setTransformationAllAttributes(Q.did,true);break;case C.TX_APPLY_TO_HIGHEST:R.setTransformationAllAttributes(Q.did,false);break;case C.SET_ENTRY_POINT:R.addEntryPoint(Q.attributeId);break;case C.REMOVE_ENTRY_POINT:R.removeEntryPoint(Q.attributeId);break;case C.ATTRIBUTE_FILTERS:R.editFilters(Q.attributeId,undefined,undefined);break;case C.ADD_JOIN_CHILDREN:R.addJointChildren(Q,V.did);break;case C.USE_AS_DRILL:R.updateHiearchySubtype(true);break;case C.USE_AS_BROWSE:R.updateHiearchySubtype(false);break;default:mstrmojo.alert(E);break;}},getMenuConfig:function A(N){var Q=new mstrmojo.ui.menus.MenuConfig(),R=this.id,O=false,M,P=N||this.cm;J.forEach(P,function(T){M=T.action===C.NONE;if(this.queryVisible(T)){var S=["xt "+(T.icn||"")],U=function U(){this.executeCommand(T);};if((this.queryEnabled(T)===false)||M){if((M&&!O)||!M){S.push(M?"sep":"");Q.addDisabledMenuItem(T.n,S.join(" "));}if(M){O=true;}}else{if(T.items){Q.addSubMenuItem(T.n,"",R,T.buildSubMenuConfig||this.getMenuConfig,T.items);O=false;}else{if(T.hasEdt){Q.addEditorMenuItem(T.n,R,T.buildSubMenuConfig);O=false;}else{Q.addToggleMenuItem(T.n||"",S.join(" "),U,U,R,this.queryChecked(T));O=false;}}}}},this);return Q;}});mstrmojo.architect.menu.ArchitectMenu.EnumRelationType={ONE_TO_ONE:1,ONE_TO_MANY:2,MANY_TO_MANY:4,PARENT_CHILD:0};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Box","mstrmojo.ui.SearchablePulldown");mstrmojo.requiresDescs(14185,14186,14187);var K=mstrmojo.array,J=mstrmojo.dom,M=mstrmojo.desc(14185,"Search for a namespace"),F=mstrmojo.desc(14186,"Loading namespaces..."),I=mstrmojo.desc(14187,"Update namespaces"),Q=mstrmojo.warehouse.EnumDataChangeEvents;var D=31;mstrmojo.warehouse.ui.NameSpacePullDown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.NameSpacePullDown",cssClass:"mstrmojo-wh-NameSpacePullDown",visible:false,pulldown:undefined,btnRefreshNS:undefined,selectedIndex:undefined,children:[{scriptClass:"mstrmojo.ui.SearchablePulldown",alias:"pulldown",isHostedWithin:false,hostedCSSClass:"mstrmojo-wh-Panel.AvailableTables",visible:false,nameSpacesLoaded:undefined,renderOnScroll:true,updateText:function E(R){this.selectedNode.textContent=R;},onPopupWidgetOpened:function H(){this.getPopupWidget().set("width",mstrmojo.dom.position(this.domNode).w+"px");},onitemSelected:function B(R){if(this.parent.mode===1){if(this.getPopupList()._oldItems!==undefined){return ;}this.parent.selectedIndex=this.selectedIndex;if(this.parent.onItemSelectedCallback){this.parent.onItemSelectedCallback(R);}}else{this.updateText(F);this.parent.selectedIndex=undefined;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-btnRefreshNS",alias:"btnRefreshNS",visible:false,onclick:function P(){mstrApp.rootController.getNameSpaces({sourceInfo:this.parent.sourceInfo,getFresh:true});},title:I,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var R=J.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",top:Math.max(R.y+40,0),left:Math.max(R.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});},onvisibleChange:function N(R){var S=this.parent.domNode.clientWidth||parseInt(this.parent.width,10);if(typeof S==="number"&&S>0){this.parent.pulldown.set("width",S-(this.visible?D:0)+"px");}}}],onwidthChange:function G(R){var S=parseInt(R.value,10);if(S>0){this.pulldown.set("width",S-(this.btnRefreshNS.visible?D:0)+"px");}},onvisibleChange:function N(R){var S=this.domNode.clientWidth||parseInt(this.width,10);if(this.visible&&typeof S==="number"&&S>0){this.pulldown.set("width",S-D+"px");}},postBuildRendering:function A(){if(this._super){this._super();}if(J.isIE8||J.isIE9){mstrmojo.css.addClass(this.domNode,"ie9");}},init:function O(S){this._super(S);var V=this,T={},R=T[this.id]={};R[Q.NAMESPACES_CHANGED]=function U(W){V.loadNameSpaces(W);};R[Q.NAMESPACES_REQUESTED]=function U(W){V.preLoadNameSpaces(W);};mstrApp.getRootController().attachDataChangeListeners(T);},mode:0,preLoadNameSpaces:function C(R){if(!((this.sourceInfo===R.sourceInfo)||(R.sourceInfo==="")||(R.sourceInfo===undefined))){return ;}var S=[];this.mode=0;S[0]={n:""};S[1]={n:F};this.pulldown.set("items",S);this.pulldown.set("selectedIndex",0);this.pulldown.set("visible",true);this.set("visible",true);this.pulldown.updateText(M);},loadNameSpaces:function L(V){if(!((this.sourceInfo===V.sourceInfo)||(V.sourceInfo==="")||(V.sourceInfo===undefined))){return ;}var S=V.namespaces||[],X=true,Y=V.dbRoleID,T,W,Z=-1;if(S.length===0){S.push({n:""});X=false;}S=S.sort(function(d,c){return d.n.toLowerCase().localeCompare(c.n.toLowerCase());});var U=this.pulldown.selectedNode.innerHTML,R=this.pulldown.getPopupList().visible;if(R){this.pulldown.getPopupList().close();}this.mode=1;this.pulldown.set("items",S);this.pulldown.set("visible",X);this.set("visible",X);this.btnRefreshNS.set("visible",X);if(!X&&!V.error){this.pulldown.set("selectedIndex",0);}this.dbRoleID=Y;if(this.nameSpacesLoaded){this.nameSpacesLoaded();}if(X){if(R){this.pulldown.getPopupList().open();}if(mstrApp.getRootController().isUsingCookieNamespace()){T=window.localStorage;W=(T&&T.getItem(Y));Z=K.find(S,"n",W);}if(Z>=0){this.pulldown.set("selectedIndex",Z);}else{this.pulldown.updateText(U);}if(U!==M){this.pulldown.processSearch();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.array","mstrmojo.qb.DBTableRow");mstrmojo.requiresDescs(629,12912,12913,12914,10);var N=mstrmojo.string,Y=mstrmojo.dom,a=mstrmojo.css,K=mstrmojo.array;function C(b,d,e){var c=b.editorNode.style;d=(d<0)?0:d+"px";e=(e<0)?0:e+"px";c.left=d;b.set("left",d);b.left=d;c.top=e;b.set("top",e);b.top=e;}function A(b){var c=b.children[0].children;K.forEach(c,function(e,d){if(b.selectedIndex[d]){a.addClass(e.domNode,["selected"]);}else{a.removeClass(e.domNode,["selected"]);}});}function X(c,b){c.canvasbox.domNode.style.width=c.maxWidth+"px";c.canvasbox.width=c.maxWidth+"px";c.linker.width=c.maxWidth;b.linkerNeedRender=true;c.linker.drawLinks();}function R(d,c,b){d.canvasbox.domNode.style.height=d.maxHeight+"px";d.canvasbox.height=d.maxHeight+"px";d.linker.height=d.maxHeight;c.linkerNeedRender=true;if(!b){d.linker.drawLinks();}}function D(b,d){var c=22;d=d?d+2:1;if(b.searchBox.visible){d++;}return c*d;}function Q(d,e){var f=d.editorNode.style,k=parseInt(f.top),c=parseInt(f.height),j=d.container,g,b=false;if(k+c>j.maxHeight){j.maxHeight=k+c+10;g=parseInt(j.domNode.clientHeight);if(j.maxHeight>g){R(j,e,true);b=true;}else{j.domNode.scrollTop=0;}}return b;}function E(b){var c=this.Rows.children;K.forEach(c,function(d){d.domNode.firstChild.childNodes[1].style.width=(b-20)+"px";});}mstrmojo.qb.DBTable=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.DBTable",title:"",left:"",top:"",minWidth:80,maxWidth:250,maxHeight:300,minHeight:20,model:null,prevPos:{},container:null,selectedIndex:[],draggable:true,noCheckBox:true,topAnchor:function I(){return(this.titlebarNode)?parseInt(this.top,10)+(this.titlebarNode.clientHeight/2)+"px":"0px";},leftAnchor:function T(){return this.left;},rightAnchor:function V(){return(this.editorNode)?parseInt(this.left,10)+this.editorNode.clientWidth+"px":"0px";},modal:false,zIndex:7,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor mstrmojo-qb-DBTable {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,mouseup,click><div class = "mstrmojo-qb-DBTable-header" style="position:absolute;"><table cellspacing="0" cellpadding="0" class="mstrmojo-qb-DBTable-titlebar"><tr><td><input id="{@id}check" type="checkbox" mstrAttach:click></td><td><div class="mstrmojo-qb-DBTable-titleIcon"></div></td><td class="mstrmojo-Editor-titleCell"><div id="{@id}title" class="mstrmojo-qb-DBTable-title"  mstrAttach:dblclick></div></td><td><div class="mstrmojo-qb-DBTable-searchIcon" title="'+mstrmojo.desc(10,"Search")+'"></div></td><td><div class="mstrmojo-qb-DBTable-close" title="'+mstrmojo.desc(629,"Delete")+'"></div></td><td><div style="display:none;"></div></td></tr></table></div><div class="mstrmojo-Editor-titleSpacer"></div>{@titlebarHTML}<div class="mstrmojo-qb-DBTable-searchBox"></div><div class="mstrmojo-Editor-content" style="padding:0px;" mstrAttach:scroll,mouseover,mouseout></div><div class="mstrmojo-qb-table-resize-handle north" id="{@id}north" ></div><div class="mstrmojo-qb-table-resize-handle east" id="{@id}east"></div><div class="mstrmojo-qb-table-resize-handle south" id="{@id}south"></div><div class="mstrmojo-qb-table-resize-handle west" id="{@id}west"></div></div></div>',titleMarkupString:"",children:[{scriptClass:"mstrmojo.Box",alias:"Rows",cssText:"width:100%; background-color:white; border-top: 1px solid #C6C6C6; height:100%;white-space: nowrap;"},{scriptClass:"mstrmojo.TextBox",slot:"searchBoxNode",alias:"searchBox",visible:false,cssClass:"mstrmojo-qb-DBTable-searchInput",onvisibleChange:function O(d){var c=this.parent,f,j=22,h=this.visible?j:-j,b,e=mstrmojo.all.QBuilderModel,g=this;f=c.editorNode.style;f.height=parseInt(f.height)+h+"px";c.maxHeight+=h;if(this.visible){this.set("width",parseInt(f.width)-48+"px");window.setTimeout(function(){g.focus();},0);}b=Q(c,e);if(mstrApp.getRootController().hasTableJoin(c.id)||b){window.setTimeout(function(){c.container.linker.drawLinks();},0);}},onvalueChange:function P(){var n=this.parent,e,k=n.Rows.children,m,h=this.inputNode.value.toLowerCase(),d=0,c,f,j=264,l=false,g,b=mstrmojo.all.QBuilderModel;for(e=1;e<k.length;e++){m=k[e];if(m.text.toLowerCase().indexOf(h)>=0){d++;f=true;}else{f=false;}if(m.visible!==f){m.set("visible",f);l=true;}if(l&&f){m.set("cssClass",(d-1)%2?"odd":"even");}}if(!l){return ;}k[0].set("visible",d>0);c=D(n,d);n.maxHeight=c;n.set("height",(c>j)?j:c);g=Q(n,b);if(l||g){n.container.linker.drawLinks();}}}],markupSlots:{editorNode:function(){return this.domNode.firstChild;},titlebarNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},checkBoxNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[0].firstChild:null;},titleIconNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[1].firstChild:null;},titleNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[2].firstChild:null;},helpNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[5].firstChild:null;},searchIconNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[3].firstChild:null;},closeNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[4].firstChild:null;},searchBoxNode:function(){return this.domNode.firstChild.childNodes[2];},containerNode:function(){return this.domNode.firstChild.childNodes[3];},buttonNode:function(){return this.domNode.firstChild.childNodes[4];},curtainNode:function(){return this.domNode.lastChild;},leftanchor:function(){return this.left;}},onscroll:function(){this.parent.parent.linker.drawLinks();},premousedown:function M(c){var d=mstrmojo.dom.eventTarget(c.hWin,c.e),b;if(d===this.closeNode){if(!this.readOnly){this.close();}}else{if(d===this.searchIconNode){b=this.searchBox.visible;this.searchBox.set("visible",!b);}}},onmousedown:function(b){this.editorNode.style.zIndex=8;},onmouseup:function(b){this.editorNode.style.zIndex=7;},toggleSelect:function(b){var d,c;if(this.selectedIndex[b]){this.selectedIndex[b]=false;}else{this.selectedIndex[b]=true;}A(this);},rangeSelect:function(b){},singleSelect:function(c){var d,b;for(d=0,b=this.selectedIndex.length;d<b;d++){this.selectedIndex[d]=false;}this.selectedIndex[c]=true;A(this);},clearSelect:function(){var c,b;for(c=0,b=this.selectedIndex.length;c<b;c++){this.selectedIndex[c]=false;}A(this);},onmouseover:function(c){var b=parseInt(this.editorNode.style.height);this.containerNode.style.overflowY=(b>=this.minHeight&&b<this.maxHeight)?"auto":"hidden";this.containerNode.style.overflowX="hidden";},onmouseout:function H(){this.containerNode.style.overflow="hidden";},touchBegin:function U(c){var b=this.editorNode.style;this._tl=parseInt(b.left);this._tt=parseInt(b.top);},touchSwipeMove:function S(e){var b=mstrmojo.all.QBuilderModel,c=this.container,d=b.tables[this.id];C(this,e.delta.x+this._tl,e.delta.y+this._tt);if(d&&d.njoins>0){c.linker.drawLinks();}},addRow:function L(b,g,c,d){var e=this.children[0];var f={scriptClass:"mstrmojo.qb.DBTableRow",images:c,indent:g,text:b};e.addChildren([f]);},onclick:function(m){var g=m.hWin,h=m.e||g.event,f=h.target||h.srcElement,d=document.elementFromPoint(h.clientX,h.clientY),b=f&&f.id;if(b.replace(this.id,"")=="check"){if(this.onCheck){this.onCheck(f.checked);}}var k=Y.findWidget(d);if(!k||!k.srcData){this.clearSelect();return ;}var l=k.rIndex,j=Y.ctrlKey(g,h),n=Y.shiftKey(g,h);if(j||n){Y.clearBrowserHighlights(g);}if(j){this.toggleSelect(l);}else{this.singleSelect(l);}},ondblclick:function(c){var b=c.hWin,f=c.e||b.event,k=f.target||f.srcElement,j=k&&k.id;if(j.replace(this.id,"")=="title"){var h=Y.delta(this.titleNode,this.titlebarNode);var g=this.title,d=this.titleNode.clientWidth-6;this.openPopup("inlineTextRef",{left:h.x+"px",top:(Y.isIE?0:-1)+"px",txtConfig:{cssClass:"mstrmojo-qb-tablealias-edit",width:d+"px",value:N.decodeHtmlString(g)||"",onEnter:function(){var n=N.trim(this.value);this.parent.close({enter:true});if(n){var q=this.parent.parent;if(N.encodeHtmlString(n)!==q.title){var e=q.model;if(e&&e.tbns){var p="";if(n.match(/[~#'"?;:[\]]/)){p=mstrmojo.desc(12912,"A table alias cannot contain the following characters: ~#'\"?;:/[]");mstrmojo.alert(p);return ;}if(!n.match(/^[a-zA-Z]/)){n=n.replace(/^\S/,"L");p=mstrmojo.desc(12913,"Table alias starting with non alphabetic character will be replaced by the character L.");}var o=N.encodeHtmlString(n);if(e.tbns[n]&&(o!==q.title)){p+=mstrmojo.desc(12914,"'##' has been used as the alias of another table. Please give a new name.").replace("##",o);mstrmojo.alert(p);return ;}if(p){mstrmojo.alert(p);}}var l=N.decodeHtmlString(q.title);if(e&&e.renameTable){e.renameTable(q.id,l,n);}q.set("title",N.encodeHtmlString(n));if(q.onHeaderChange){q.onHeaderChange(l,n);}}}},onCancel:function(){this.set("value",this.parent.title);}}});}},onCheck:function(b){},postBuildRendering:function W(){if(this._super){this._super();}if(this.noCheckBox){this.checkBoxNode.style.display="none";}},getDragData:function F(b){var c=b.src,e=c.node,d=e.id;if(d){switch(d.replace(this.id,"")){case"north":case"east":case"south":case"west":return{dir:d.replace(this.id,""),startX:c.pos.x,startY:c.pos.y};break;default:break;}}else{if(this._super){return this.dropZone&&this._super(b);}}return null;},isDragValid:function B(b){return true;},ondragstart:function Z(b){var e=b.src,f=e&&e.data,c=f&&f.dir;if(c){this.prevPos={x:e.pos.x,y:e.pos.y};return true;}else{if(this._super){return this._super(b);}}},ondragmove:function J(k){var o=k.src,AH=o&&o.data,t=AH&&AH.dir,q,r,c,u,b,g,AB,n,l,x,AD,m,AF,AG,z,j,AA,AC;b=this.container;g=mstrmojo.all.QBuilderModel;if(t){switch(t){case"north":case"south":AB=k.tgt;l=AB.pos.y-this.prevPos.y;l=(t==="north")?l:-l;this.prevPos=AB.pos;x=this.editorNode.style;if(parseInt(x.height)-l>=this.minHeight&&parseInt(x.height)-l<=this.maxHeight){q=parseInt(x.top);if(t==="north"){q+=l;if(q<0){q=0;}x.top=q+"px";this.top=x.top;}r=parseInt(x.height)-l;x.height=r+"px";this.containerNode.style.height=r-this.titlebarNode.clientHeight-1-(this.searchBox.visible?this.searchBoxNode.clientHeight:0)+"px";if(q+r>b.maxHeight){b.maxHeight=q+r+10;AD=parseInt(b.domNode.clientHeight);if(b.maxHeight>AD){R(b,g);}else{b.domNode.scrollTop=0;}}}break;case"east":case"west":AB=k.tgt;j=this.noCheckBox?57:77;n=AB.pos.x-this.prevPos.x;n=(t==="east")?n:-n;this.prevPos=AB.pos;x=this.editorNode.style;if(parseInt(x.width)+n>=this.minWidth&&parseInt(x.width)+n<=this.maxWidth){c=parseInt(x.left);if(t==="west"){c-=n;if(c<0){c=0;}x.left=c+"px";this.left=x.left;}u=parseInt(x.width)+n;x.width=u+"px";this.titleNode.style.width=u-j+"px";this.titlebarNode.style.width=u+"px";if(this.searchBox.visible){this.searchBox.set("width",u-48+"px");}if(c+u>b.maxWidth){b.maxWidth=c+u+10;m=parseInt(b.domNode.clientWidth);if(b.maxWidth>m){X(b,g);}else{b.domNode.scrollLeft=0;}}E.call(this,u);}break;}b.linker.drawLinks();}else{AD=parseInt(b.domNode.clientHeight);m=parseInt(b.domNode.clientWidth);AF=k.tgt.pos;o=k.src.pos;n=AF.x-o.x;l=AF.y-o.y;x=this.getMovingTarget().style;AG=this._leftPos+n;z=this._topPos+l;AG=(AG<0)?0:AG;z=(z<0)?0:z;var p=true,AI=true,AE=b.canvasbox.children;for(AA=0,AC=AE.length;AA<AC;AA++){if(!AE[AA].visible){continue;}if(this.id!=AE[AA].id&&AG+this.editorNode.clientWidth<parseInt(AE[AA].left)+AE[AA].editorNode.clientWidth){p=false;break;}}if(p){b.maxWidth=AG+this.editorNode.clientWidth;if(b.maxWidth>m){X(b,g);}}for(AA=0,AC=AE.length;AA<AC;AA++){if(!AE[AA].visible){continue;}if(this.id!=AE[AA].id&&z+this.editorNode.clientHeight<parseInt(AE[AA].top)+AE[AA].editorNode.clientHeight){AI=false;break;}}if(AI){b.maxHeight=z+this.editorNode.clientHeight+10;if(b.maxHeight>AD){R(b,g);}}x.left=AG+"px";x.top=z+"px";this.top=z+"px";this.left=AG+"px";var f=g.tables[this.id];if(f&&f.njoins>0){b.linker.drawLinks();}if(b.maxWidth<=m){b.domNode.scrollLeft=0;}if(b.maxHeight<=AD){b.domNode.scrollTop=0;}}},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,slot:"containerNode",children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onEsc:function(){if(this.onCancel){this.onCancel();}this.parent.close({cancel:true});}}],onOpen:function(){var d=this.txt,e=this.txtConfig;if(e){for(var b in e){d.set(b,e[b]);}}d.domNode.style.width=d.width;d.focus();},onClose:function(b){if(!b||(!b.cancel&&!b.enter)){this.txt.onEnter();}}},_set_height:function(e,d){var c=this.searchBox.visible?this.searchBoxNode.clientHeight:0;if(this.editorNode&&parseInt(d)>this.titlebarNode.clientHeight+c){var b=this.editorNode.style;b.height=parseInt(d)+"px";this.containerNode.style.height=parseInt(b.height)-this.titlebarNode.clientHeight-1-c+"px";}},useRichTooltip:true,showTooltip:function G(c,f){var e=mstrmojo.dom;var d=c.target||e.eventTarget(c.hWin,c.e);if(d.className&&((d.className==="mstrmojo-qb-DBTable-title")||(d.className==="mstrmojo-qb-DBTable-titleIcon"))){d=d.parentNode.parentNode.parentNode.children[0].children[2].children[0];var b=e.position(d);this.set("richTooltip",{posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:d.textContent,top:b.y+b.h+5,left:b.x});mstrmojo._HasTooltip.showTooltip.call(this,c,f);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.tabs.Tab","mstrmojo.dom","mstrmojo.css");var G=mstrmojo.dom,R=mstrmojo.array,d=mstrmojo.css,c="animate",W="31px";function X(){var j=window.Modernizr,h="transition";if(j.testProp(h)){return G.transEndEvtNames[j.prefixed(h)];}return null;}function D(h){return function(){this.menuNode.style.display=h?"block":"none";};}function I(h){return Math.min(h.offsetWidth-h.firstChild.offsetWidth,0);}function S(h){return h.isAlignRight?"right":"left";}function e(h,j){return parseInt(h.style[S(j)],10)||0;}function O(){var j=this.tabContainerNode,k=false,h=false;if(I(j)<0){var m=G.position(j),l=G.position(j.firstChild);k=(l.x<m.x);h=(l.x+l.w>m.x+m.w+0.1);}this.downBtnNode.style.display=k?"block":"none";this.upBtnNode.style.display=h?"block":"none";}function T(h,j){h=(h||[]);if(!h.filter){return R.filter(h,j);}return h.filter(j);}function Q(h,j){h=(h||[]);if(!h.map){return R.map(h,j);}return h.map(j);}function J(AA,k){if(this.isStatic){return ;}var x=this.tabContainerNode,w=T(this.children,function(AB){return AB.isSelected;})[0],r=w&&w.domNode;if(!x||!r){return ;}var l=G.position(x),p=x.firstChild,z=I(x),m=e(p,this),j=Math.max(m,z);if(AA){if(z<0){var o=G.position(r),q=o.x-l.x,u=o.x+o.w-(l.x+l.w),t=this.isAlignRight,h=function(AB){j=t?j+AB:j-AB;};if(q<0){h(q);}else{if(u>0){h(u);}}}}if(j!==m){var n=X();if(k&&n){d.addClass(p,c);G.attachOneTimeEvent(p,n,function(){d.removeClass(p,c);});}p.style[S(this)]=Math.max(z,Math.min(j,0))+"px";}O.call(this);}function K(h){return h.hasOwnProperty("index");}function H(){var h=this.children,j=0;(h||[]).every(function(l,k){if(!K(l)){return false;}j++;l.index=k;return true;});(h||[]).every(function(k){if(!K(k)){return false;}k.total=j;return true;});}function B(m,j){var q=m.ENUM_CORNERS,n=[q.TOP_RIGHT,q.BOTTOM_RIGHT],o=this.parent;if(o.position!=="bottom"){n.reverse();}m.setAlignment(n[0],n[1]);var l=G.position(o.domNode),h=G.position(j),k=o.menuNode;var p=k.style;p.top=(h.y-l.y)+"px";p.left=(h.x-l.x)+"px";m.addPopupHandlers(o.id,D(true),D(false));m.hostId=o.id;m.hostElement=k;m.isHostedWithin=false;o.openPopup(m.newInstance());}function Y(h){h.raiseEvent({name:"TabsChange"});}mstrmojo.vi.ui.tabs.TabStrip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",markupString:'<div id="{@id}" class="mstrmojo-VITabStrip {@cssClass}" style="{@cssText}" ><div class="mstrmojo-VITabStrip-tabs"><div style="display:table"><div style="display:table-row"></div></div></div><div class="mstrmojo-VITabStrip-addBtn" mstrAttach:click><div></div></div><div class="mstrmojo-VITabStrip-downBtn" mstrAttach:click,mousedown><div></div></div><div class="mstrmojo-VITabStrip-upBtn" mstrAttach:click,mousedown><div></div></div><div class="mstrmojo-VITabStrip-menuHost"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{tabContainerNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.firstChild.firstChild.firstChild;},addBtnNode:function(){return this.domNode.childNodes[1];},addBtnImgNode:function(){return this.domNode.childNodes[1].firstChild;},downBtnNode:function(){return this.domNode.childNodes[2];},upBtnNode:function(){return this.domNode.childNodes[3];},menuNode:function(){return this.domNode.childNodes[4];},maskNode:function(){return this.domNode.lastChild;}},isStatic:false,isAlignRight:true,tabContainerNode:null,downBtnNode:null,upBtnNode:null,menuNode:null,position:"bottom",layoutConfig:{w:{tabContainerNode:"100%",addBtnNode:W},xt:true},onAppStateChange:function V(j){var h=mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;if(j.value===h||j.valueWas===h){this.layoutConfig.w.addBtnNode=mstrApp.appState===h?"0px":W;this.doLayout();}},setStatic:function U(h,j){this.isStatic=h;if(!h){J.call(this,true,j);}},setTabs:function C(k,h){this.removeChildren();var l=this,j=k.length;this.addChildren(Q(k,function(o,m){var n=o.k;return l.getTabCfg(k,o,{scriptClass:"mstrmojo.vi.ui.tabs.Tab",index:m,total:j,draggable:!!j,dropZone:!!j,k:n,isSelected:n===h,showTabMenu:B,tabMoved:function(q){var p=this.index;this.parent.moveTab(p,p+(q?-1:1),p);}});}));J.call(this,true);Y(this);},getTabs:function N(){return T(this.children,K);},getTabCfg:function F(j,k,h){return h;},deleteTab:function P(h){var o=this.id,n=this.children[h],m=X(),l=function(){var p=mstrmojo.all[o];p.removeChildren(n);n.destroy();H.call(p);O.call(p);Y(p);};if(m){var k=n.domNode.firstChild,j=k.style;j.width=k.offsetWidth+"px";window.setTimeout(function(){d.addClass(k,c);G.attachOneTimeEvent(k,m,l);j.width=0;},0);}else{l();}},buildRendering:function E(){this._super();d.toggleClass(this.domNode,"alignLeft",!this.isAlignRight);},postBuildRendering:function Z(){var h=this._super();J.call(this,true);return h;},doLayout:function A(){this._super();J.call(this);},setSelectedTab:function b(h){(this.children||[]).forEach(function(j){j.set("isSelected",j.k===h);});Y(this);},getSelectedTab:function M(){var k=null,j=this.children||[],h;for(h=0;h<j.length;h++){if(j[h].isSelected){k=j[h];break;}}return k;},onclick:function g(h){if(h.getTarget()===this.addBtnImgNode){this.addTab();}},addTab:mstrmojo.emptyFn,onmousedown:function f(u){var p=u.getTarget().parentNode,w=(p===this.downBtnNode);if(w||p===this.upBtnNode){var t=this.tabContainerNode,o=t.firstChild,j=I(t),l=e(o,this),n=this.isAlignRight?(w?-10:10):(w?10:-10),k=this.id,q=this,m;if(mstrApp.setInteractive){mstrApp.setInteractive(false);}d.addClass(p,"active");var r=function(){window.clearInterval(m);d.removeClass(p,"active");O.call(mstrmojo.all[k]);if(mstrApp.setInteractive){mstrApp.setInteractive(true);}};G.attachOneTimeEvent(document.body,"mouseup",r);m=window.setInterval(function(){l=Math.min(Math.max(j,l+n),0);o.style[S(q)]=l+"px";if(l===j||l===0){r();}},33);}},moveTab:function L(h,q,o,n){var j=this.children,r=j.splice(h,1)[0];j.splice(q,0,r);H.call(this);var k=this.containerNode,l=k.childNodes,p=k.removeChild(l[h]),m=l[q];if(m){k.insertBefore(p,m);}else{k.appendChild(p);}if(r.isSelected){J.call(this,true,true);}if(!n&&o!==undefined&&o!==q){this.commitTabMove(o,q);Y(this);}},commitTabMove:function a(h,j){throw new Error(this.scriptClass+" must implement commitTabMove.");}});}());(function(){mstrmojo.requiresCls("mstrmojo.VisBase","mstrmojo.DocPortlet");var L={top:"top",left:"left","z-index":"zIndex",width:"width",height:"height"},P,B;mstrmojo.Vis=mstrmojo.declare(mstrmojo.VisBase,null,{scriptClass:"mstrmojo.Vis",offsetTop:0,offsetLeft:0,isAndroid:window.navigator.userAgent.indexOf("Android")!=-1,reRenderOnDimensionChg:true,isVis:function(){return true;},setModel:function Q(R){this._super(R);if(R.data){this.set("model",R.data);}this.xtabModel=R;if(this.controller&&typeof (this.controller.getPageByTree)!="undefined"){this.controller.getPageByTree(false);}},destroy:function O(){this._super();var R=this.xtabModel;if(R&&R.destroy){R.destroy();delete this.xtabModel;}},setDimensions:function N(T,S){var R=this._super(T,S);if(R&&this.hasRendered&&this.reRenderOnDimensionChg){this.reRender();}return R;},buildRendering:function M(){if(this.parent instanceof mstrmojo.DocPortlet){delete this.left;delete this.top;this.height=this.fmts&&this.fmts.height;}this._super();},postBuildRendering:function G(){P=this.width;B=this.height;this.adjustWidgetOffsets();this._super();},adjustWidgetOffsets:function E(){var R=this.domNode,S={top:0,left:0};if(typeof (mstr)!="undefined"&&mstr.utils.BoxModel){S.top=mstr.utils.BoxModel.getElementSumOffsetTop(R);S.left=mstr.utils.BoxModel.getElementSumOffsetLeft(R);}else{if(typeof (mstrmojo)!="undefined"){S=mstrmojo.boxmodel.offset(R);}}this.offsetTop=S.top;this.offsetLeft=S.left;},update:function F(V){V=V||this.node;if(V){if(V.data){this.set("model",V.data);if(this.xtabModel&&this.xtabModel.set){this.xtabModel.set("data",V.data);}this.model=V.data;if(this.model.layoutModel){this.layoutModel=this.model.layoutModel;}if(this.model.layoutNode){this.layoutNode=this.model.layoutNode;}mstrmojo.hash.copy(V.data.extProps,this);}var T=this.controller,S=T.view,X=(S.hasRendered&&S.getCurrentLayout&&S.getCurrentLayout());if(T.view.fullScreenInfoWindow&&(X&&X.defn.visName)){var W=mstrApp.rootView.getContentDimensions();this.height=W.h+"px";this.width=W.w+"px";}else{this.fmts=V.defn.fmts||V.defn.units[this.model.k].fmts;var R=this.fmts;if(R){for(var U in L){v=L[U];if(U in R){this[v]=R[U];}}}}}if(this.model){this.initFromVisProps(this.model.vp);}this.updated=true;return true;},getModel:function A(S){if(S){var R=mstrmojo.Vis.getVisGrid(this.layoutModel,this.layoutNode,S);if(R){return R.data;}else{alert(mstrmojo.desc(8427,"Incorrect visualization properties encountered.  Data may be inconsistent.  Please reset your properties."));return{};}}else{return this.model;}},getDataParser:function K(R){return new mstrmojo.Vis.DataParser(this.getModel(R));},renderErrorMessage:function H(R){this.domNode.innerHTML='<div class="mstrmojo-message">'+R+"</div>";},getMessageID:function J(){return this.model.mid&&this.model.mid||this.xtabModel&&this.xtabModel.docModel&&this.xtabModel.docModel.mid;},hasNoninfowindowTarget:function D(U){var b=this.xtabModel,a=(b&&b.docModel);var c=false;if(a){var Z=a.defn&&a.defn.layouts,T=null;var S;if(Z){for(S in Z){if(Z[S].loaded){T=Z[S];break;}}}var V=T&&T.units;this.selectorTargets={};if(V&&U.scObjList){for(var S=0;S<U.scObjList.length;S++){var W=U.scObjList[S];var X=W.sc.tks.split("\x1E");for(var R=0;R<X.length;R++){var Y=V[X[R]];if(Y){this.selectorTargets[X[R]]=Y;if(!this.isChildOfIfw(V,Y)){c=true;}}}}}}return c;},isChildOfIfw:function I(R,S){while(S){if(S.ifw){return true;}S=R[S.pnk];}return false;},performAction:function C(R){var T=this.xtabModel.getAction(R),S=T&&T.h;if(S&&this.controller[S]){this.controller[S](this,T.a);return true;}return false;}});mstrmojo.Vis.getVisGrid=function(R,Y,S){var W=Y;var U=R.getChildren(Y,false);for(var T=0;T<U.length;T++){var X=U[T];if(X.k==S){return X;}else{var V=mstrmojo.Vis.getVisGrid(R,X,S);if(V){Y=W;return V;}}}};mstrmojo.Vis.DataParser=function(T){var a=mstrmojo.Vis;return{getRowTitles:function(){return new a.Titles(T,true);},getColTitles:function(){return new a.Titles(T,false);},findMetricValue:function(f,k){var j=T.ghs.rhs.items;for(var g in j){var h=j[g].items;var d=true;for(var b in f){if(f[b]!=h[b].idx){d=false;break;}}if(d){return new mstrmojo.Vis.MetricValue(T.gvs.items[g].items[k]);}}},getTotalRows:function W(){var b=T.ghs&&T.ghs.rhs&&T.ghs.rhs.items;return(T.eg||!b)?0:b.length;},getTotalColHeaderRows:function U(){return(!T.ghs.chs.items?0:T.ghs.chs.items.length);},getTotalCols:function R(){return this.getColHeaders(0).size();},getRowHeaders:function Z(b){return new a.Headers(T,b,true);},getColHeaders:function Y(b){return new a.Headers(T,b,false);},getMetricValue:function X(c,b){return new a.MetricValue(T,T.gvs.items[c].items[b]);},getColumnHeaderCount:function V(){return T.gvs.items[0].items.length;},getCSSString:function S(){return T.cssString;}};};mstrmojo.Vis.Titles=function(R,W){var V=(W)?R.gts.row:R.gts.col;return{size:function U(){return V.length;},getTitle:function T(X){return new mstrmojo.Vis.Title(V[X]);},getCSS:function S(X){return R.css[V[X].cni].n;}};};mstrmojo.Vis.Headers=function(S,T,X){var Y=(X)?S.gts.row:S.gts.col;var W=(X)?S.ghs.rhs:S.ghs.chs;var U=W.items&&W.items[T].items;return{size:function Z(){return(!U?0:U.length);},getHeader:function R(a){return U&&U[a]&&new mstrmojo.Vis.Header(U[a],X?Y[a]:Y[T]);},getCSS:function V(a){return U&&S.css[U[a].cni].n;},getHeaderCell:function(a){return U&&U[a];}};};mstrmojo.Vis.Title=function(S){return{getActionType:function(){return S.at;},getDrillPath:function(){return S.dp;},getHeaderValues:function R(){return S.es;},getHeaderName:function T(V){return S.es[V].n;},getHeaderId:function T(V){return S.es[V].id;},getForms:function U(){return S.fs;},getFormId:function(){return S.fid;},getFormType:function(){return S.ftp;},getUnitId:function(){return S.id;},getLinkMap:function(){return S.lm;},getName:function(){return S.n;},getUnitDssType:function(){return S.otp;},getSelectorControl:function(){return S.sc;}};};mstrmojo.Vis.Header=function(T,R){return{getName:function V(){return(T.idx===-1)?"":R.es[T.idx].n;},getElementId:function Y(){return(T.idx===-1)?"":R.es[T.idx].id;},getObjectId:function U(){return(T.idx===-1)?"":R.es[T.idx].oid;},getElementIndex:function S(){return T.idx;},getActionType:function X(){return T.at;},isTotal:function W(){return T.otr===1;}};};mstrmojo.Vis.MetricValue=function(R,Y){var X=Y;return{getValue:function S(){return X.v;},getThresholdType:function T(){return X.ty;},getRawValue:function W(){return X.rv;},getCSS:function U(){return R.css[X.cni].n;},getThresholdValue:function Z(a){if(X.ti==undefined){return a;}return R.th[X.ti].n;},getFillColor:function V(a){if(X.ci==undefined){return a;}return R.fc[X.ci].n;}};};})();(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.qb.menu.SimpleGridMenu");var I=mstrmojo.string,H=mstrmojo.array;var C;function G(K){var J=[];H.forEach(K,function(L){J.push(L.v);});return J.join("");}mstrmojo.qb.QBSimplePreview=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.qb.QBSimplePreview",resizeColumnBehavior:mstrmojo.RESIZE_ALL_COLUMN_MODE,dataset:null,mappings:null,selectedColumns:null,visible:false,cssClass:"lockHeader mstrmojo-qb-simplepreview",lockHeader:true,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},menuButton:null,adjustSize:function(N){var M=200,L=this.parent&&this.parent.domNode,P=M*N;if(!L||!this.scrollboxNode){return ;}this.scrollboxNode.style.overflow="hidden";this.contentWidth=Math.max(P,L.clientWidth)+"px";var K=this.contentWidth,O=this.headerContainerNode,J=this.itemsContainerNode;if(K&&O&&J){O.style.width=K;J.style.width=K;}},onmouseover:function(){var L=200,K=this.mappings.length,J=this.parent&&this.parent.domNode,M=L*K;this.scrollboxNode.style.overflowX=(M>J.clientWidth)?"auto":"hidden";this.scrollboxNode.style.overflowY="auto";},onmouseout:function(){this.scrollboxNode.style.overflow="hidden";},onheightChange:function D(){var L=this.height,J=this.headerContainerNode,K=this.scrollboxNode;if(L&&J&&K){K.style.height=parseInt(L,10)-J.clientHeight+"px";}this.domNode.style.height=this.height;},onwidthChange:function E(){if(this.domNode&&this.mappings){this.domNode.style.width="100%";this.adjustSize(this.mappings.length);}},postBuildRendering:function B(){if(this._super){this._super();}mstrmojo.dom.attachMarkupEvent(this.id,this.domNode,"mouseover");mstrmojo.dom.attachMarkupEvent(this.id,this.domNode,"mouseout");},populatePreview:function A(){var O=this.mappings,R=this.selectedColumns,K=0,J=this.scrollboxNode,N,Q,L,M,S=this;this.columns=[];if(J){K=J.scrollLeft||0;}this.unrender();if(this.isRefined&&!mstrApp.isFFSQLMode){H.forEach(R,function(W,Z){var b=W.colo,a,V;a=mstrApp.isFFSQLMode?W.n:G(R[Z].expr);V={tag:W,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:Z,headerText:a,menuCssClass:mstrApp.isFFSQLMode?"":"mstrmojo-qb-simplegrid-itemmenu",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@headerText}</span><span class="{@menuCssClass}" mstrAttach:click></span></div>',useRichTooltip:true,postBuildRendering:function Y(){if(this._super){this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:a});if(!this._ontooltipover){var c=this.id;this._ontooltipover=function(f){var d=mstrmojo.all[c];d.showTooltip(f,self);};this._ontooltipout=function(f){var d=mstrmojo.all[c];d.hideTooltip(f,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);},onclick:function X(){var e=this.columnIndex,d=mstrApp.isFFSQLMode;if(d){return ;}C.showPopupMenu(S,{menuNode:this.domNode.lastChild,data:{columnIndex:e,isVisible:function c(g,f){return d?false:true;}}});}},colWidth:"60",dataFunction:function(h,e,g){var c=h[this.dataField],f="mstrmojo-di-datapreview-DataRow-text";f+=(e%2===1)?" odd":" even";return'<div class="'+f+'" title="'+c+'">'+c+"</div>";},dataField:Z.toString()};S.columns.push(V);});}else{H.forEach(O,function(W,Z){var b=W.colo,a,V;a=mstrApp.isFFSQLMode?W.n:G(R[b].expr);V={tag:W,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:b,headerText:a,menuCssClass:mstrApp.isFFSQLMode?"":"mstrmojo-qb-simplegrid-itemmenu",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@headerText}</span><span class="{@menuCssClass}" mstrAttach:click></span></div>',useRichTooltip:true,postBuildRendering:function Y(){if(this._super){this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:a});if(!this._ontooltipover){var c=this.id;this._ontooltipover=function(f){var d=mstrmojo.all[c];d.showTooltip(f,self);};this._ontooltipout=function(f){var d=mstrmojo.all[c];d.hideTooltip(f,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);},onclick:function X(){var e=this.columnIndex,d=mstrApp.isFFSQLMode;if(d){return ;}C.showPopupMenu(S,{menuNode:this.domNode.lastChild,data:{columnIndex:e,isVisible:function c(g,f){return d?false:true;}}});}},colWidth:"60",dataFunction:function(h,e,g){var c=h[this.dataField],f="mstrmojo-di-datapreview-DataRow-text";f+=(e%2===1)?" odd":" even";return'<div class="'+f+'" title="'+c+'">'+c+"</div>";},dataField:Z.toString()};S.columns.push(V);});}L=this.dataset;if(L.length===0&&this.columns.length>0){var T=21;var P=parseInt(parseInt(this.parent.height,10)/T,10)-1;P=P>0?P:1;var U;for(N=0;N<P;N++){U=[];for(M=0,Q=this.columns.length;M<Q;M++){U.push("");}L.push(U);}}this.items=L;this.render();this.adjustSize(O.length);this.scrollboxNode.scrollLeft=K;},onvisibleChange:function(J){if(J.value){this.populatePreview();}}});C=mstrmojo.qb.QBSimplePreview;C.showPopupMenu=function F(M,K){var L=C.menuHelper=C.menuHelper||new mstrmojo.qb.menu.SimpleGridMenu();L.target=M;L.data=K.data;var J=L.getMenuConfig();J.hostId=M.id;J.hostElement=K.menuNode;J.isHostedWithin=false;J.position=mstrmojo.dom.position(K.menuNode,true);M.openPopup(J.newInstance());};}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.qb.QBSimplePreview");mstrmojo.requiresDescs(13033,12419);var H=mstrmojo.desc;var E;mstrmojo.qb.QBMappings=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBMappings",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},cssClass:"mstrmojo-di-datapreview",cssText:"position:relative;overflow:hidden;border-bottom-right-radius:6px;border-bottom-left-radius:6px;padding:0px;",width:0,height:0,dropZone:false,active:false,children:[{scriptClass:"mstrmojo.Box",alias:"previewInfo",cssClass:"mstrmojo-qb-preview-info",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-preview-text">'+H(13033,"Sample Preview")+'</span><span class="mstrmojo-qb-preview-menu" mstrAttach:click></span></div>',visible:false,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.domNode.lastChild.style.display=(mstrApp.isFFSQL||mstrApp.isFFSQLMode)?"none":"block";}},onclick:function D(){E.showPopupMenu(this.parent,{menuNode:this.domNode.lastChild});}},{scriptClass:"mstrmojo.qb.QBSimplePreview",alias:"content",columns:[],cssText:"width:100%"},{scriptClass:"mstrmojo.Label",alias:"notice",cssClass:"warnLabel",text:H(12419,"No preview available.")}],init:function G(J){var K,I;this._super(J);K={};I=K[this.id]={};I.dataPreview=this.handleDataPreview;mstrApp.getRootController().attachDataChangeListeners(K);},handleDataPreview:function A(J){mstrApp.getRootController().toggleDataPreview(true);var K=this.content,L=this.notice,P=J.mappings,M=J.dataset,I=J.selectedColumns,O=J.isRefined,N=(P&&P.length>0);K.mappings=P;K.dataset=M;K.selectedColumns=I;K.isRefined=O;K.set("visible",N);L.set("visible",!N);this.previewInfo.set("visible",N);N&&K.populatePreview();},onheightChange:function(K){if(this.domNode){var L=Math.max(parseInt(K.value,10)-2,0),I=38,J;this.domNode.style.height=L+"px";J=Math.max(L-I,0);this.content.set("height",J+"px");}},onwidthChange:function B(J){if(this.domNode){var I=parseInt(J.value,10)+"px";if(I!=="NaNpx"){this.domNode.style.width=I;this.content.set("width",I);}}}});function C(){mstrApp.getRootController().deleteAllColumns();}E=mstrmojo.qb.QBMappings;E.showPopupMenu=function F(L,J){var K=E.menuHelper=E.menuHelper||new mstrmojo.qb.QBPreviewMenu();K.target=L;var I=K.getMenuConfig();I.hostId=L.id;I.hostElement=J.menuNode;I.isHostedWithin=false;I.position=mstrmojo.dom.position(J.menuNode,true);L.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:I}));};mstrmojo.qb.QBPreviewMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.DBTableRowMenu",menuCssClass:"mstrmojo-qb-DBTableRowMenu",menuCfg:null,getMenuConfig:function(){var I=this.menuCfg;if(!I){I=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{I.clear();}I.addMenuItem(H(5186,"Delete All"),"",C);return I;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Vis","mstrmojo.color");var A=mstrmojo.css,G=mstrmojo.dom,D;mstrmojo.qb.QBTableLinker=mstrmojo.declare(mstrmojo.Vis,null,{scriptClass:"mstrmojo.qb.QBTableLinker",width:null,height:0,context:0,markupString:'<div id="{@id}" class="mstrmojo-Chart {@cssClass}" style="position:absolute;left:0px;top:0px;width:{@width}px;height:{@height}px;overflow:hidden;"  mstrAttach:mouseover,mousemove,click ><canvas width="{@width}px" height="{@height}px"></canvas><canvas style="position:absolute;left:0;top:0" width="{@width}px" height="{@height}px"></canvas><div id="{@id}-tooltip" class="mstrmojo-Map-tooltip"></div></div>',markupSlots:{canvas:function(){return this.domNode.firstChild;},highlightCanvas:function(){return this.domNode.childNodes[1];},tooltip:function(){return this.domNode.childNodes[2];}},postBuildRendering:function F(){if(this._super){this._super();}if(D===undefined){D=this.canvas&&this.canvas.getContext&&this.canvas.getContext("2d");}if(D){this.context=this.canvas.getContext("2d");this.highlight=this.highlightCanvas.getContext("2d");}else{this.createVMLCanvas();}this.model=mstrmojo.all.QBuilderModel;},getCordValue:function H(L){return CordValue;},drawLinks:function I(){this.clearCanvas();var R=mstrmojo.all.QBuilderModel;if(R.linkerNeedRender){this.render();R.linkerNeedRender=false;}var L=this.model&&this.model.joinsInfo;for(var Q in L){var X=L[Q],N=X.links;for(linkid in N){var T=N[linkid].srcw,O=N[linkid].tgtw,V=T.parent.parent,S=O.parent.parent,Z=parseInt(V.leftAnchor()),P=parseInt(V.rightAnchor()),M=parseInt(S.leftAnchor()),Y=parseInt(S.rightAnchor()),d=V.containerNode.clientWidth,U=G.position(T.domNode),W=G.position(O.domNode),b=G.position(this.domNode),c=G.position(V.containerNode),a=G.position(S.containerNode);if(U.y>c.y&&U.y+0.5*U.h<c.y+c.h){srcwy=U.y-b.y+0.5*T.domNode.clientHeight;}else{srcwy=c.y-b.y-0.5*V.titleNode.clientHeight;}if(W.y>a.y&&W.y+0.5*W.h<a.y+a.h){tgtwy=W.y-b.y+0.5*O.domNode.clientHeight;}else{tgtwy=a.y-b.y-0.5*S.titleNode.clientHeight;}if(M>Z+0.5*d){srcwx=P;srcwx1=srcwx+20;tgtwx=M;tgtwx1=tgtwx-20;}else{if(M>Z&&M<Z+0.5*d){srcwx=P;srcwx1=srcwx+20;tgtwx=Y;tgtwx1=tgtwx+20;}else{if(M<Z&&Y>Z+0.5*d){srcwx=Z;srcwx1=srcwx-20;tgtwx=M;tgtwx1=tgtwx-20;}else{srcwx=Z;srcwx1=srcwx-20;tgtwx=Y;tgtwx1=tgtwx+20;}}}N[linkid].marker=[{x:srcwx,y:srcwy},{x:srcwx1,y:srcwy},{x:tgtwx1,y:tgtwy},{x:tgtwx,y:tgtwy}];N[linkid].coords=[srcwx,srcwy+5,srcwx,srcwy-5,srcwx1,srcwy-5,tgtwx1,tgtwy-5,tgtwx,tgtwy-5,tgtwx,tgtwy+5,tgtwx1,tgtwy+5,srcwx1,srcwy+5];this.drawLine(srcwx,srcwy,srcwx1,srcwy);this.drawLine(srcwx1,srcwy,tgtwx1,tgtwy);this.drawLine(tgtwx1,tgtwy,tgtwx,tgtwy);switch(X.jt){case"3":this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy+5);this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy+5);break;case"1":this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy+5);this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy-5);break;case"2":this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy+5);break;default:break;}}}if(D){this.context.stroke();}this.drawMarker();},clearCanvas:function K(){if(D){this.context.clearRect(0,0,this.width,this.height);this.context.beginPath();}else{var L=document.getElementById("vmlCanvas");if(L&&L.hasChildNodes()){while(L.childNodes.length>=1){L.removeChild(L.firstChild);}this.createVMLCanvasFrame();}}},clearHighLightCanvas:function(){if(D){this.highlight.clearRect(0,0,this.width,this.height);this.highlight.beginPath();}},drawMarker:function(){if(D){this.clearHighLightCanvas();if(!this.model.selLink){return ;}var P=this.model;var O=P.joinsInfo[P.selLink[0]].links[P.selLink[1]].marker,M=this.highlight;for(var N=0,L=O.length;N<L;N++){M.strokeStyle="blue";M.beginPath();M.arc(O[N].x,O[N].y,3,0,Math.PI*2,true);M.closePath();M.stroke();}}},drawLine:function C(N,P,M,O){if(D){this.context=this.canvas.getContext("2d");this.context.moveTo(N,P);this.context.lineTo(M,O);}else{var L=document.createElement("v:line");L.setAttribute("from",N+" "+P);L.setAttribute("to",M+" "+O);document.getElementById("vmlCanvas").appendChild(L);}},createVMLCanvasFrame:function J(){var L=document.createElement("v:rect");L.setAttribute("id","vmlFrame");L.setAttribute("stroke","true");L.setAttribute("strokecolor","red");L.style.width=isNaN(this.width)?"auto":this.width;L.style.height=isNaN(this.height)?"auto":this.height;L.style.zindex="-1";document.getElementById("vmlCanvas").appendChild(L);},createVMLCanvas:function E(){var N=parseInt(this.width);var M=parseInt(this.height);var L=document.createElement("v:group");L.setAttribute("id","vmlCanvas");L.style.width=isNaN(this.width)?"auto":this.width;L.style.height=isNaN(this.height)?"auto":this.height;L.setAttribute("coordorigin","0, 0");L.setAttribute("coordsize",N+", "+M);this.domNode.appendChild(L);this.createVMLCanvasFrame();return ;},renderTooltip:function B(O,R,Q,S){var L=this.model.gts;if(S>=0){var N=L.row[0].n+": "+O;var M;for(M=0,len=L.col[0].es.length;L&&L.col&&M<len;M++){var T=this.model.gvs.items[S].items[M];var P=T.v;if(T.ty==4){P='<img src="'+P+'" >';}N+="<br>"+L.col[0].es[M].n+": "+P;}this.tooltip.innerHTML=N;}if(R+this.tooltip.offsetWidth>this.width){R=R-this.tooltip.offsetWidth;}this.tooltip.style.webkitTransform="translate3d("+R+"px, "+Q+"px, 0)";this.tooltip.style.MozTransform="translate("+R+"px, "+Q+"px)";if(this.tooltip.className.indexOf("fadeIn")<0){this.tooltip.className=this.tooltip.className+" fadeIn";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui.tabs.Tab","mstrmojo.ME.MetricEditBox","mstrmojo.array","mstrmojo.hash");var Z=mstrmojo.array,M=mstrmojo.hash,K=mstrmojo.ME.MetricToken.brackets,L=mstrmojo.dom,B=mstrmojo.css,Q=mstrmojo.vi.ui.tabs.Tab.ACTIONS,g=Q.DELETE+Q.RENAME,j=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,D=mstrmojo.string,l="This@ID",T="45C11FA478E745FEA08D781CEA190FE5";function G(p){return{n:p,k:p,ftk:[],vs:1,is:""};}function O(w,x,p,t){var r=w.forms[x]||{},u=w.forms[p],q=w.inputBox;if(x!==p){r.vs=w.vStatus;r.is=w.iStatus;r.ftk=q.items;w.set("vStatus",j.UNKNOWN);}w.set("vStatus",u.vs);w.set("iStatus",u.is);w.updateInputBoxItems({items:u.ftk});if(w.curFormIdx!==p){w.curFormIdx=p;w.tabstrip.setSelectedTab(u.k);}w.raiseEvent({name:"tabSwitch",tks:u.ftk,vs:u.vs,is:u.is,oidx:x,nidx:p,toNewTab:t});}function N(q){var p=q.forms[q.curFormIdx];if(p){p.ftk=q.inputBox.items;p.vs=q.vStatus;p.is=q.iStatus;}}var e=0;function W(p){e=Math.max(p.length-1,e);}function V(){e=0;}function m(p){var q="DESC"+(e?" "+e:"");e++;if(Z.find(p,"n",q)>=0){return m(p);}return q;}function I(u){var r={v:K(u.n),oi:u,isNew:true},q,p;if(u.t===12){q=Z.filter(u.fs,function(t){return t.obf||u.da;}).length;if(q===1){p=u.fs[0];r=M.copy({v:K(u.n)+"@"+K(p.fnm),ift:true,exv:p.fid,extp:8},r);}else{r=M.copy({v:K(u.n)+"@",ift:true},r);}}return r;}function E(q,p){q.set("enabled",!p);var r="mstrmojo-InlineWaitIcon";if(q.iconClass){q.set("iconClass",q.iconClass.replace(new RegExp(r),"")+" "+(p?r:""));}else{mstrmojo.css.toggleClass(q.domNode,r,p);}}var U=function(AA){var t=AA.items,u=t.length,w=t[t.length-1],r,q,z=[],p="",x;if(t[0]&&t[0].tp!==33){z.push({v:"!",tp:33,lv:4,sta:2});}for(r=0;r<u;r++){q=t[r];if(q.isNew&&!q.oi){p+=q.v;}else{if(!D.isEmpty(p)){z.push({v:p,tp:2,lv:1});p="";}if(q.v&&q.v.indexOf(l)>=0){q.v=q.v.replace("["+l+"]",l);q.exv=T;q.extp=8;delete q.oi;}z.push(q);}}if(!D.isEmpty(p)){z.push({v:p,tp:2,lv:1});p="";}if(w&&w.tp!==-1){z.push({v:"",tp:-1,lv:4,sta:2});}return{items:z};},a=function(r){var p=r.items||[],q=p[p.length-1];if(q&&q.tp===-1){p.pop();}if(p[0]&&(p[0].tp===33||p[0].tp===37)){p.splice(0,1);}Z.forEach(p,function(t){if(t.v&&t.v.indexOf(l)>=0){M.copy({extp:8,exv:T,oi:{n:"This",did:"This",t:12}},t);}});},Y=function(p){if(!p){return j.VALID;}return{"-2147214845":j.ERROR,"-2147214846":j.AMBIGUITY}[p]||j.ERROR;},R=function(r){r=U(r);var q={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true,vtp:true},p={getArrItemName:function(){return"tkn";},isSerializable:function(t){return(q[t])?true:false;}};return D.json2xml("tknstrm",r,p);},F=function(r,w,u,q){var t=R(w),x=function(z){if(z&&z.tks){var AA=z.tks;a(AA);AA.vs=Y(AA.rjec);AA.tokenXML=t;if(q){q(AA);}}},p=function(z){mstrmojo.alert(z.message||z.getResponseHeader&&z.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:t,localSymbolFolderXML:"",metricXML:"",metricId:r||"",isNew:true,objectType:12,isIDForm:u,msgID:mstrApp.getMsgID()},{success:x,failure:p});};mstrmojo.ME.DerivedAttributeFormTab=mstrmojo.declare(mstrmojo.vi.ui.tabs.Tab,null,{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",valid:true,editable:true,postBuildRendering:function S(){if(this._super){this._super();}var p=this,q=p.lbl;q.editOnDoubleClick=this.editable;q.onTextEditComplete=function(t,r){if(p.validate(q.text)){p.titleEdited(q.text,r);}};},onclick:function d(p){var q=mstrmojo.dom.eventTarget(p.hWin,p.e);if(q===this.menuBtnNode){this.tabDeleted();}else{if(!this.isSelected){this.tabSelected();}}},validate:function(p){var q=!/[\[\]\"\\]/g.test(p);if(!q){this.lbl.set("isEditing",true);}this.set("valid",q);return q;},showErrTooltip:function o(u,r){var p=mstrmojo.dom.position(this.domNode),q=this,t=q.errTooltip;if(!t){q.errTooltip=t=new mstrmojo.Tooltip({contentNodeCssClass:"me-tooltip-content up me-err",updatePopupConfig:null});this.addDisposable(t);}t.set("top",p.y+p.h+2);t.set("left",p.x+p.w/2-r);t.set("content",'<div class="content"><span>'+u+"</span></div>");t.open();window.setTimeout(function(){t.close();},2500);},onvalidChange:function(){if(this.valid){this.hideTooltip();}else{this.showErrTooltip(mstrmojo.desc(11569,"Input contains invalid character"),95);}}});function f(t,u,w){var r=Z.find(u,"k",w.k);return{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",title:w.n,draggable:false,editable:r!==0,cssClass:"mstrmojo-AEB-Tab "+(r===0?"mstrmojo-AEB-IDTab":""),getMenuActions:function(){return g;},tabSelected:function(){O(t,t.curFormIdx,r);},titleEdited:function q(z,x){if(z!==x){if(Z.find(t.forms,"n",z)>=0){this.showErrTooltip(mstrmojo.desc(7209,"Name already exists"),69);}var AA=t.forms[r];AA.n=z;}},tabDeleted:function p(){var x=t.forms.length,AB=(t.curFormIdx===x-1)?0:t.curFormIdx,z=t.forms.slice(0),AA=z[r];if(AA&&AA.did){t.delForms.push({n:AA.n,did:AA.did});}z.splice(r,1);t.curFormIdx=AB;t.set("forms",z);O(t,-1,AB);t.set("dirty",true);}};}mstrmojo.ME.AttributeEditBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,null,{scriptClass:"mstrmojo.ME.AttributeEditBox",markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-AEB-TabStrip"></div><div class="mstrmojo-MEBox-edit mstrmojo-AEB-edit"></div><div class="mstrmojo-MEBox-status {@statusCssClass}"><div class="mstrmojo-MEBox-vStatus"></div><div class="mstrmojo-MEBox-iStatus"></div></div></div>',markupSlots:{tabstripNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},statusNode:function(){return this.domNode.lastChild;},iStatusNode:function(){return this.domNode.lastChild.lastChild;},vStatusNode:function(){return this.domNode.lastChild.firstChild;}},forms:null,delForms:[],curFormIdx:0,attrid:null,absorbAmbiguity:false,init:function k(r){var t=this;t.children=[{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",alias:"tabstrip",position:"top",slot:"tabstripNode",isAlignRight:false,getTabCfg:function q(x,z,w){return M.copy(f(t,x,z),w);},addTab:function u(){var z=t.forms,w=z.length,AA=m(z),x=z.slice(0);x.push(G(AA));t.set("forms",x);O(t,t.curFormIdx,w,true);t.set("dirty",true);},clear:function p(){Z.forEach(this.children,function(w){w.hideTooltip();});}},{scriptClass:"mstrmojo.Button",alias:"clearBtn",slot:"tabstripNode",text:mstrmojo.desc(1763,"Clear All"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-clearAll",onclick:function(){t.inputBox.clearTokens([]);}},{scriptClass:"mstrmojo.Button",alias:"validateBtn",slot:"tabstripNode",text:mstrmojo.desc(11897,"Validate"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-validate",onclick:function(){t.validateCurrentForm();}}].concat(this.children);this._super(r);},item2textCss:function J(p){return this._super(p)||{21:"afm"}[p.t]||"";},onformsChange:function X(){var p=this.forms,q=p[this.curFormIdx].k;Z.forEach(p,function(r){a({items:r.ftk});});this.tabstrip.setTabs(p,q);W(p);},selectFormTab:function A(p){O(this,this.curFormIdx,p);},postBuildRendering:function S(){if(this._super){this._super();}this.clear();var p=this;this.inputBox.ondrop=function(AA){if(!AA.src.data||!AA.src.data.item){return ;}var z=p.inputBox,u=z.ctxtBuilder.itemWidgets,w=M.copyProps(["did","n","t","fs"],AA.src.data.item),t=I(w),x,q,r;AA.src.data=t;mstrmojo.ListBase2.prototype.ondrop.call(this,AA);if(p.ontokensModify){p.ontokensModify();}x=this.selectedIndices;if(w.t===12&&t.ift&&!t.exv){for(q in x){r=u[q];if(r){z.startTokenSuggestion(r);}}}z.clearSelect(true);B.removeClass(z.domNode,"unselectable");};},clear:function c(){this.curFormIdx=0;this.delForms=[];this.attrid=null;V();this.set("forms",[G("ID")]);this.inputBox.set("items",[]);this.inputBox.resetTokensCache();this.set("vStatus",j.UNKNOWN);this.set("iStatus","");this.tabstrip.clear();},validateCurrentForm:function C(q){var r=this,t=this.validateBtn,p=function(u){E(t,false);r.set("vStatus",u.vs);r.set("iStatus",u.rjed||"");r.updateInputBoxItems({items:u.items});r.statusNode.style.display="block";r.handleValidation(u);if(q){q(u.items,u.vs===j.VALID);}};r.set("vStatus",j.VALIDATING);E(t,true);F(this.attrid,{items:this.inputBox.items},r.curFormIdx===0,p);},validateAllForms:function n(r){var t=this,q=t.forms,p=0,u=function(z){var x=(p===0);if(z){var w=q[p-1];w.ftk=z.items;w.vs=z.vs;w.is=z.rjed||"";w.tokenXML=R({items:z.items});if(z.vs!==j.VALID){t.selectFormTab(p-1);t.handleValidation(z);if(r){r(null,false);}return ;}}if(p===q.length){if(r){r(q,true);}return ;}F(t.attrid,{items:q[p++].ftk},x,u);};N(t);u();},continueValidataion:function P(){this.validateCurrentForm();},getStatusDesc:function b(p){return{0:mstrmojo.desc(11655,"Valid Formula.")}[p];},onvStatusChange:function h(){this.statusNode.style.display=this.vStatus>=j.VALIDATING?"block":"none";},onObjectInsert:function H(t){var u=this.inputBox,r=I(t),p=u.insertTokens([r]),q;if(t.t===12&&r.ift&&!r.exv){q=u.ctxtBuilder.itemWidgets[p];if(q){u.startTokenSuggestion(q);}}}});mstrmojo.ME.AttributeEditBox.preprocessTokenStream=a;mstrmojo.ME.AttributeEditBox.postprocessTokenStream=U;mstrmojo.ME.AttributeEditBox.mapErrorCode=Y;mstrmojo.ME.AttributeEditBox.getTokenStreamXML=R;mstrmojo.ME.AttributeEditBox.validateSyntax=F;mstrmojo.ME.AttributeEditBox.prepareInsertToken=I;}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu");mstrmojo.requiresDescs(11411,11424,11417);var D=mstrmojo.architect.menu.EnumMenuActions,E=mstrmojo.desc(11411,"Sample Data"),A=mstrmojo.desc(11424,"Add to Project"),C=mstrmojo.desc(11417,"Update Structure");mstrmojo.warehouse.menu.AvailableTablesMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.AvailableTablesMenu",cm:[{action:D.ADD_TO_PROJECT,n:A},{action:D.UPSTRUCT,n:C},{action:D.NONE},{action:D.SAMPLE_DATA,n:E,icn:"smpl"}],executeCommand:function B(G){var H=this.data,F=mstrApp.getRootController();switch(G.action){case D.UPSTRUCT:F.getColumnsForDBTables({tables:[].concat(H),getFresh:true},{});break;case D.ADD_TO_PROJECT:F.addTables([].concat(H));break;case D.SAMPLE_DATA:F.showSampleData(H);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.EnumMenuActions");mstrmojo.requiresDescs(1088,629,1388,3397,12259,11425,4572);var G=mstrmojo.architect.menu.EnumMenuActions,C=G.NONE,E=G.EDIT,J=G.DELETE,N=G.RENAME,O=G.DUPLICATE,Q=G.CATALOG_SQL,D=G.SET_AS_PRIMARY,P=G.IS_PRIMARY,I=mstrmojo.desc(1088,"Edit"),B=mstrmojo.desc(629,"Delete"),H=mstrmojo.desc(1388,"Rename"),M=mstrmojo.desc(3397,"Duplicate"),L=mstrmojo.desc(12259,"Catalog SQL"),A=mstrmojo.desc(11425,"Set as Primary"),F=mstrmojo.desc(4572,"Primary");mstrmojo.warehouse.menu.DBConnectionsMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.DBConnectionsMenu",cm:[{action:E,n:I,icn:"edt"},{action:J,n:B,icn:"del"},{action:N,n:H,icn:"rnm"},{action:O,n:M},{action:D,n:A},{action:C},{action:P,n:F},{action:C},{action:Q,n:L,icn:"catsql"}],executeCommand:function K(S){var T=this.data,R=mstrApp.getRootController();switch(S.action){case E:R.editDBRole(T);break;case N:R.renameDBRole(T);break;case J:R.deleteDBRole(T);break;case O:R.duplicateDBRole(T);break;case D:R.setProjectPrimaryDBRole(T);break;case Q:R.displayCatalogSQL(T.did);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.dbroles.DBRoleSetting","mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox","mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor","mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector","mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox","mstrmojo.warehouse.dbroles.DBRoleSettingPulldown","mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton");mstrmojo.requiresDescs(15,260,512,689,1034,2523,3332,3989,7790,7952,8517,8518,8519,8521,8522,8523,8524,8526,8528,8529,8530,8532,8533,8534,8536,8538,8539,8540,8546,8547,8548,8549,8550,8560,10055,10058,10059,10061,10064,10065,11392,11394,12308,12309,12310,12312,12313,12542,12752,12758,12997,13100,13101,13103,13104,13105,13106,13107,13108,13109,13110,13111,13112,13113,13114,13115,13116,13117,13118,13119,13121,13122,13123,13124,13125,13126,13234,13373,13531,13532,13533,13540,13541,13904,13905,13906,13907,13908,13909,13910,13944,13945,13946,13947,13948,13949,13950,13951,13952,13962,13979,13980,13981,13982,13990,14002,14005,14620,14621,14641,14685,14686,14687);var g=mstrmojo.array,a=mstrmojo.hash,N=mstrmojo.string,f="hideUnavailableDrivers",M="FULLCONNECTION",j,E=mstrmojo.warehouse.dbroles.DBRoleHelper,q=mstrmojo.desc(8538,"Database:"),T=mstrmojo.desc(2523,"Version:"),I=mstrmojo.desc(13540,"Show databases whose certified drivers were not found"),d=mstrmojo.desc(13990,"Show databases which are not certified for the DSNs driver"),P=mstrmojo.desc(13234,"Add driver"),h=mstrmojo.desc(11392,"Missing parameters"),m=" ("+mstrmojo.desc(13541,"Certified driver not found")+")",G=mstrmojo.desc(11394,"The ODBC driver used by this database connection is currently not installed, until that happens this connection may not work"),D=mstrmojo.desc(14002,"The JDBC driver used by this database connection is currently not installed, until that happens this connection may not work"),k=mstrmojo.desc(8526,"select a dsn");function u(AD,AO,AR){var AP,AF="";if(this.isDSNLess){var AC={},AQ,AG=this.contents.children,AU=1;if(AR===undefined){var AT=this.dbIDSelectList.selectedItem,AH=AT.dbVersions[g.find(AT.dbVersions,"v",this.dbmsList.selectedItem.db_ver)],AL=AH.connections[this.selectedSection],AI=E.driverExists.call(this,[AL]);if(AI.exists){AQ=AL.str;}else{if(AH.altconnections.length>0){AQ=AH.altconnections[this.selectedSection].str;}else{AQ=AL.str;AF=G;if(AQ.indexOf("JDBC;")>=0){AF=D;}}}}else{AQ=AR;}g.forEach(AG,function(AW){var AV=AW.getValue();if(AW.field){if(typeof AV==="string"){AC[AW.field]=N.trim(AV);}else{AC[AW.field]=AV;}}if((!!AV)&&AW.driverMode){AU=AW.driverMode;}});this.driverMode=AU;AP=AQ.replace(/@([\w\d]+)/gm,function AK(AV,AW){return(AC.hasOwnProperty(AW)&&AC[AW]!==null)?AC[AW]:"";});if(AO){var AE="=;",AM,AN,AJ,AS=/[\s\x28\x29\x3B]/g;do{AM=AP.indexOf(AE);if(AM>-1){AN=AP.substring(0,AM);while(AS.test(AN)){AM=AS.lastIndex;}AJ=AN.substring(AM);AP=AP.replace(AJ+AE,"");}}while(AP.indexOf(AE)>0);}}else{AP="DSN="+this.dsnBox.dsnList.selectedItem.n+";";}if(AD){AP=E.cleanDSNConnection(AP);}return{str:AP,err:AF};}function l(AF,AS){var AG=mstrApp.rootController,AM="XQUERY",AH="@",AD,AP,AQ="",AJ="",AN=[],AX="",AE={},AR=/[,:]/g,AI=0,AT=/[\x28\x29\x3B\x7D]|(!#)/g,AY,AO="",AK=/[\x29\x3B\x7D\/!]/g,AL=E.cleanDriver(AS),AU,AC={},AW=0,AV=0;g.forEach(AF,function(Aa){AD=Aa.str;AN=[];AE={};AU=E.cleanDriver(AD);AI++;if(AD.indexOf(M)===0){if(Aa.driver===AM){AJ=AD.replace(M+"="+AM+";"+AH,"");var Ab=AS.indexOf(";;");if(Ab>=0){AS=AS.substring(0,Ab+1);}AE[AJ]=AS.replace(AM+";","");AC=AE;AV=AG.getObjectCount(AE);return false;}AD=AD.replace(M+"=",";");}if(AL.toUpperCase()!==AU.toUpperCase()){return true;}do{AP=AD.indexOf(AH);AQ=AD.substring(0,AP);AT.lastIndex=0;while(AT.test(AQ)){AP=AT.lastIndex;}AJ=N.trim(AQ.substring(AP));AD=AD.replace(AQ,"").replace(AH,"");AK.test(AD);AY=AK.lastIndex-1;AO=AD[AY];AK.lastIndex=1;AX=AD.substring(0,AY).replace("@","");AN.push({key:AX,token:AJ,endoftokenChar:AO});}while(AD.indexOf(AH,AY)>0);var AZ;g.forEach(AN,function(Ag,Ac){AZ=Ag.token;Ac=AS.toUpperCase().indexOf(AZ.toUpperCase());if(Ac>-1){Ac+=AZ.length;AT.lastIndex=0;var Af=AS.substring(Ac);var Ae=AT.exec(Af);if(Ae){var Ai=Af.substring(0,Ae.index);if(Af[Ae.index]!==Ag.endoftokenChar&&Ai.length){if(Ai[Ai.length-1]===Ag.endoftokenChar){Ai=Ai.substring(0,Ai.length-1);}}AR.test(Ai);var Ad=Ai.substring(AR.lastIndex-1,AR.lastIndex)||",",Aj=Ag.key.split(Ad),Ah=Ai.split(Ad);if(Aj.length===Ah.length){g.forEach(Aj,function(Ak,Al){AE[Ak]=Ah[Al];});}else{AE[Ag.key]=Ai;}}}});if(AG.getObjectCount(AE)>AV){AC=AE;AV=AG.getObjectCount(AE);AW=AI;}return true;});AC["RB"+AW]=true;return AC;}function S(AF){var AE={},AC=AF.split(";"),AD=[];g.forEach(AC,function(AG){AD=AG.split("=");if(AD[0]!==""){AE[AD[0]]=AD[1];}});return AE;}function C(AC,AH){var AG,AF,AD=[],AE={};g.forEach(a.keyarray(AH),function(AI){AG=AH[AI];if(AI){AE[AI]=AI+"="+AG;}else{g.forEach(a.keyarray(AE),function(AJ){AD.push(AJ);});g.forEach(AD,function(AJ){AF=false;g.forEach(AC.parent.children,function(AK){if(AK.propfield===AJ){AF=true;return !AF;}});if(!AF){delete AE[AJ];}});AE[AI]=AG;}});return a.valarray(AE).join(";");}function t(AF,AI,AD){var AH,AE;if(AF.field){AH=AI[AF.field];}else{if(AF.propset){AE=AD[AF.propset][AF.prop];if(AF.propformat==="json"){AH=JSON.parse(AE||"{}")[AF.propfield];}else{if((AF.propformat==="text")){if(AF.propfield){AH=(S(AE||"")[AF.propfield]);}else{var AC=S(AE||"");g.forEach(AF.parent.children,function(AJ){if(AJ.propfield){delete AC[AJ.propfield];}});var AG=[];g.forEach(a.keyarray(AC),function(AJ){AG.push(AJ+"="+AC[AJ]);});AH=AG.join(";");}}else{AH=AE;}}}else{g.forEach(AF.children,function(AJ){t(AJ,AI,AD);});}}if(AH){AF.setValue(AH);}}function Z(AH,AD){var AI,AG,AE,AC={},AF={};if(AH.propset){AI=AH.getValue();if(typeof AI==="string"){AG=N.trim(AI).replace(/\\/g,"\\\\");}else{AG=AI;}AE=AD[AH.propset][AH.prop];if(AH.propformat==="json"){AF=JSON.parse(AE||"{}");AF[AH.propfield]=AG;AD[AH.propset][AH.prop]=JSON.stringify(AF).replace(/\\"/g,'"');}else{if((AH.propformat==="text")){AC=S(AE||"");AC[AH.propfield]=AG;AD[AH.propset][AH.prop]=C(AH,AC);}else{AD[AH.propset][AH.prop]=AG;}}}else{g.forEach(AH.children,function(AJ){Z(AJ,AD);});}}function R(AI){if(this.info.connstr){var AH=this.contents;var AE=this.info.connstr.split(";")[0],AD=(AE.split("=")[0]).toUpperCase();switch(AD){case"DSN":AH=this.dsnBox;AE=AE.substring(AD.length+1,AE.length);AH.dsnList.set("selectedID",AE.toUpperCase());break;default:AE=E.cleanLoadedDSNConnection(this.info.connstr,AI.dbID);var AJ=this.supportedDBs[g.find(this.supportedDBs,"id",AI.dbID)],AC=AJ.dbVersions[g.find(AJ.dbVersions,"v",AI.dbver)],AK=AC.connections.concat(AC.altconnections);var AF=l(AK,AE);var AG=this.info.vldbProperties;g.forEach(AH.children,function(AL){t(AL,AF,AG);});if(E.isCustomConnection(AE)||mstrApp.rootController.getObjectCount(AF)<=AC.DBPS.length){AH.stringEditor.setValue(AE);}}}}function z(){var AG;if(this.info.connstr){var AN=E.cleanDriver(this.info.connstr),AK=E.isCustomConnection(this.info.connstr),AC=(AN.split("=")[0]).toUpperCase(),AJ=this.dbObjects.dbms,AE=AJ[g.find(AJ,"did",this.info.dbms)],AL,AH=function AD(AP,AO){g.forEach(AP,function(AQ){if(AE.db_ver===AQ.v){AL=AQ.connections.concat(AQ.altconnections);if(AN!==""&&!AK){if(g.find(AL,"driver",AN)>=0){AG={dbver:AQ.v,dbID:AO};}}else{AG={dbver:AQ.v,dbID:AO};}}if(AG){return false;}return true;});};switch(AC){case"DSN":AG={dbver:AE.db_ver,dbID:this.dbIDs.Undefined};break;default:var AF=parseInt(this.info.ab,10)||0;if(AF>=0){var AI=g.find(this.supportedDBs,"id",AF),AM;if(AI>=0){AM=this.supportedDBs[AI];AH(AM.dbVersions,AM.id);}}if(!AG){g.forEach(this.supportedDBs,function(AO){AH(AO.dbVersions,AO.id);if(AG){return false;}return true;});}if(!AG){AK=true;g.forEach(this.supportedDBs,function(AO){AH(AO.dbVersions,AO.id);if(AG){return false;}return true;});}break;}}if(!AG){AG={dbID:-1};}return AG;}function Q(AF,AE,AD,AC){var AI=this,AH=[],AJ,AG;AG=new mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox({alias:AF.alias+"groupBox"});AI.contents.addChildren([AG]);g.forEach(AE,function(AK){if(AK.group===AD){AJ=a.clone(AK);delete AJ.group;AH.push(AJ);}});AC.call(AI,AH,AG.alias,AG);if(AF.oncheckedChange){AF.checked=true;AF.set("checked",false);}}function AB(AH,AD,AC){var AF=this,AE=[];g.forEach(AH,function(AI){if(!!(AI.group)){AE.push(AI);}});var AG;g.forEach(AH,function(AP,AQ){AG=false;if(mstrApp.isSingleTier){if((AP.scope&2)===2){AG=true;}}else{if((AP.scope&1)===1){AG=true;}}if(!AG){return ;}var AS,AR=mstrmojo.desc(AP.IDS,AP.n),AL="dbp"+AQ,AO=(AP.isgroup===1);if(AR&&AR[AR.length-1]!==":"){AR+=":";}if(AP.group){return true;}switch(AP.tp){case"text":AS=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AR,alias:AL,isRequired:AP.req,onEnter:AF.onEnterFn,onvalueChange:function AJ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"number":AS=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AR,alias:AL,isNumeric:true,isRequired:AP.req,onEnter:AF.onEnterFn,onvalueChange:function AJ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"list":var AN="v",AI=AP.options;if(AI[0].n){AN="n";g.forEach(AI,function(AT){AT.n=mstrmojo.desc(AT.IDS,AT.n);});}else{g.forEach(AI,function(AT){AT.n=AT.v;});}AS=new mstrmojo.warehouse.dbroles.DBRoleSettingPulldown({caption:AR,alias:AL,itemIdField:"v",itemField:AN,onChange:function AM(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});AS.render();AS.set("items",AI);AS.set("selectedID",AI[0].v);break;case"boolean":AS=new mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox({label:AR,alias:AL,isGroup:AO,isNumeric:(AP.stp&&(AP.stp==="numeric")),driverMode:1,helpLink:AP.help,driverModeChecked:AP.driverMode||1,display:AP.display,oncheckedChange:function AK(){if(this.parent.stringEditor){this.parent.stringEditor.updateString();}this.driverMode=(this.checked?this.driverModeChecked:1);if(!this.isGroup){return ;}var AT=(this.checked&&(this.display==="onChecked"))||(!this.checked&&(this.display==="onUnChecked"));this.parent[this.alias+"groupBox"].set("visible",AT);}});break;case"file":AS=new mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector({caption:AR,alias:AL,isRequired:AP.req,selectorOption:AP.selectorOption,onEnter:AF.onEnterFn,onvalueChange:function AJ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;}AS.field=AP.field;AS.parentRBAlias=AD;AS.propset=AP.propset;AS.prop=AP.prop;AS.propformat=AP.propformat;AS.propfield=AP.propfield;if(AP.defaultValue){AS.setValue(AP.defaultValue);}AC.addChildren([AS]);if(AO){Q.call(AF,AS,AE,AP.groupid,AB);}});}function V(AE,AD,AC){return new mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton({label:mstrmojo.desc(AE.IDS,AE.n),index:AD,alias:"RB"+AD,count:AC,field:"RB"+(AD+1),onclick:function AF(){var AH;if(this.checked){for(AH=0;AH<this.count;AH++){this.parent["RB"+AH].set("checked",false);this.parent["RB"+AH].enableChildren();}this.set("checked",true);this.enableChildren();}},oncheckedChange:function AG(){if(this.checked){this.parent.parent.selectedSection=this.index;}}});}function r(){if(!this.isDSNLess){return ;}var AG=this.contents,AJ,AE,AH=this;if(!AG){return ;}if(AG.children){AG.removeChildren(null,true);}if(!this.dbmsList.selectedItem){return ;}AJ=this.dbIDSelectList.selectedItem||this.dbIDSelectList.items[0];var AC=AJ.dbVersions[g.find(AJ.dbVersions,"v",this.dbmsList.selectedItem.db_ver)];if(!AC){return ;}if(!E.driverExists.call(this,AC.connections).exists&&(AC.altDBPS.length>0)){AE=AC.altDBPS;}else{AE=AC.DBPS;}if(AE&&AE.length>1){var AF=AE.length;g.forEach(AE,function(AM,AL){if(AM.defaultSection){AH.selectedSection=AL;}var AN=V(AM,AL,AF);AG.addChildren([AN]);AB.call(AH,AM.DBP,AN.alias,AH.contents);});AG["RB"+AH.selectedSection].checked=true;AG["RB"+AH.selectedSection].onclick();}else{AB.call(AH,AE[0].DBP,"",AH.contents);}var AK=new mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor({alias:"stringEditor",drivers:AH.drivers,dbIDVersions:this.dbIDSelectList.items,info:AH.info,dbID:AH.dbIDSelectList.selectedItem,dbms:AH.dbmsList.selectedItem,enableFn:function AI(AM){var AN=this.parent.parent,AL=AN.contents["RB"+AN.selectedSection];g.forEach(AG.children,function(AO){if(!AO.isGroupSetting&&!AO.isGroup){AO.set("enabled",AM);}});if(AM&&AL){AL.setValue(true);}},generateConnectionStringFn:function AD(AL){return u.call(AH,false,false,AL).str.replace(M+"=","");}});AG.addChildren([AK]);}function x(AD){var AC=this.dbObjects.dbms;return AC[g.find(AC,"db_ver",AD)];}function H(){var AL=this,AH=false,AK=this.dbObjects.supportedDBs,AM=this.dbIdFilter||[],AN=this.dbIdExcludeFilter||[],AG=[],AF,AJ=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")===-1)),AI=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")!==-1)),AD=(mstrApp.isSingleTier&&window.FormWrapper.isWin32&&window.FormWrapper.isWin32()),AE=function AE(AP){if(AJ){var AQ=a.clone(AP);AQ.n=N.trim(AP.n.replace("(JDBC)",""));return AQ;}if(AI){var AO=a.clone(AP);AO.n=N.trim(AP.n.replace("(32 bit)",""));return AO;}return AP;},AC=[6800,5300,5600,6600,7000];g.forEach(AK,function(AO){AH=false;if(mstrApp.isSingleTier&&AJ&&AO.dbType===100){return true;}if(mstrApp.isSingleTier){if(g.indexOf(AC,AO.dbType)!==-1){return true;}}g.forEach(AO.dbVersions,function(AP){if(AP.dsnless){if(!AL.showUnavailable){g.forEach(AP.connections.concat(AP.altconnections),function(AQ){if(E.driverAvailable.call(AL,AQ)){AH=true;}return !AH;});}else{AH=true;}return !AH;}return !AH;});if(AH){AF=false;g.forEach(AN,function(AP){if(AP===AO.id){AF=true;return false;}});if(!AF){if(AM.length>0){g.forEach(AM,function(AP){if(AP===AO.id){AG.push(AE(AO));}});}else{AG.push(AE(AO));}}}});this.dbIDSelectList.set("items",AG);if(AG.length===0&&!AL.showUnavailable){AL.showUnavailable=true;this.driverBox.hideUnavailable.setValue(true);}}function w(AF,AE){var AK=this.dbObjects.dbms,AM=this.dbmsList;if(AF.length===0){var AC,AG=this.dbObjects.dsndbms,AH={};if(this.cfgDbmsTypeExcludeFilter&&this.cfgDbmsTypeExcludeFilter.length>0){g.forEach(this.cfgDbmsTypeExcludeFilter,function(AN){AH[AN]=true;});AG=g.filter(this.dbObjects.dsndbms,function(AN){return !AH[AN.db_type];});}AC=a.cloneArray(AG);g.forEach(AE,function(AO){if(AO.v>-1){var AN=g.find(AC,"db_ver",AO.v);if(AN>=0){AC[AN].n+=" (Certified for DSN)";}}});AM.set("items",AC);}else{var AI={},AL=this;g.forEach(AK,function(AN){AN.enabled=true;if(!(AF.length===1&&AF[0].v===-1)){if((AN.db_type===AL.dbTypes.Generic.v)||(AN.db_ver===-1)){if(!AL.alwaysShowGeneric){return true;}}}g.forEach(AF,function(AR){if(AN.db_ver===AR.v){if((AR.dsnless&&AL.isDSNLess)||(!AL.isDSNLess)){var AP=AR.connections.concat(AR.altconnections);if(!AL.showUnavailable){g.forEach(AP,function(AS){if(E.driverAvailable.call(AL,AS)){AI[AN.did]=AN;}return true;});}else{var AO=false;g.forEach(AP,function(AS){if(E.driverAvailable.call(AL,AS)){AO=true;}return !AO;});if(AO){AN.title=(AN.n.length>50)?AN.n:"";AI[AN.did]=AN;}else{var AQ=mstrmojo.hash.clone(AN);AQ.n=AQ.n+m;AN.enabled=false;AQ.title=(AQ.n.length>50)?AQ.n:"";AI[AQ.did]=AQ;}}}}});});if(mstrApp.rootController.getObjectCount(AI)===0){var AD=x.call(this,-1);if(AD){AI[AD.did]=AD;}}AM.set("items",mstrmojo.hash.valarray(AI));}var AJ=AM.items;if(AJ.length>0){if(this.info&&this.info.dbms){AM.set("selectedID",this.info.dbms);}else{if(AM.selectedItem&&(g.find(AJ,"did",AM.selectedItem.did)>-1)){AM.set("selectedID",AM.selectedItem.did);}else{AM.set("selectedID",AJ[0].did);}}AM.onChange();}else{AM.set("selectedID","");}}function Y(){var AK=this,AL={n:k,nU:k.toUpperCase(),des:0};var AJ={},AH=AK.dbObjects.dsns,AD=[];AJ[AL.nU]=AL;if(AK.dbIdFilter.length===1){g.forEach(AK.supportedDBs,function(AM){g.forEach(AM.dbVersions,function(AN){g.forEach(AN.connections.concat(AN.altconnections),function(AO){g.forEach(AH,function(AP){if(AO.driver===AP.des){AJ[AP.nU]=AP;}return true;});});});});AD=a.cloneArray(a.valarray(AJ));}else{AD=a.cloneArray(AK.dbObjects.dsns);}var AC={};if(AK.dsnDbTypeExcludeFilter&&AK.dsnDbTypeExcludeFilter.length>0){g.forEach(AK.dsnDbTypeExcludeFilter,function(AM){g.forEach(AK.dsnMapDBs,function(AN){if(AN.dbType===AM){g.forEach(AN.dbVersions,function(AO){g.forEach(AO.connections.concat(AO.altconnections),function(AP){g.forEach(AD,function(AQ){if(AP.driver===AQ.des){AC[AQ.nU]=AQ;}return true;});});});}});});var AF,AI,AE=a.valarray(AC),AG=AE.length;for(AF=0;AF<AG;AF++){AI=g.find(AD,"nU",AE[AF].nU);if(AI>=0){AD.splice(AI,1);}}}this.dsnBox.dsnList.set("items",AD);this.onisDSNLessChange();}mstrmojo.warehouse.dbroles.DBRoleDSNConnection=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleDSNConnection",cssClass:"mstrmojo-wh-DBRoleDSNConnection",postCreate:function c(){var AC=mstrApp.rootController.getDBObjects();this.dbObjects=AC;this.dbTypes=AC.dbTypes;this.dbIDs=AC.dbIDs;this.dbVersions=AC.dbVersions;this.supportedDBs=AC.supportedDBs;this.dsnMapDBs=AC.dsnMapDBs;this.drivers=AC.drivers;this.preferences=AC.preferences;},onEnterFn:mstrmojo.emptyFn,info:undefined,oninfoChange:function K(){var AE=this.info.connstr;if(AE&&(AE.substring(0,1)===";")){this.info.connstr=this.info.connstr.replace(";","");}H.call(this);var AC=z.call(this);var AD=window.localStorage,AF=(AD&&AD.getItem(f));this.driverBox.hideUnavailable.setValue((AF?(AF==="1"):false));if((mstrApp.rootController.getObjectCount(this.info)>0)&&(this.info.did!=="")&&(g.find(this.dbIDSelectList.items,"id",AC.dbID)<0)){this.driverBox.hideUnavailable.setValue(true);}if(this.isDSNLess){this.dbIDSelectList.set("selectedID",AC.dbID);this.dbmsList.set("selectedID",this.info.dbms);}else{if(this.info.n){Y.call(this);}}R.call(this,AC);this.driverBox.hideUnavailable.set("visible",!this.hideDriverCheck);},selectedSection:0,isDSNLess:undefined,dbIdFilter:[],dbIdExcludeFilter:[],dsnDbTypeExcludeFilter:[],driverMode:1,singleType:false,onisDSNLessChange:function L(){var AI=this.dbIDSelectList,AF=this.dsnBox,AH=AF.dsnList,AC=this.info&&this.info.connstr,AE,AG,AD;if(this.isDSNLess){AI.set("selectedItem",null);AI.set("selectedID",this.supportedDBs[0].id);this.driverBox.hideUnavailable.set("label",I);}else{if(!(AH.items&&AH.items.length>0)){Y.call(this);}if(AC){AE=AC.split(";")[0];AG=(AE.split("=")[0]).toUpperCase();if(AG==="DSN"){AE=AE.substring(AG.length+1,AE.length);AD=AE.toUpperCase();}}if(AD===undefined){AD=AH.items[0].nU;}AH.set("selectedID",AD);AH.onChange();this.driverBox.hideUnavailable.set("label",d);}AI.set("visible",this.isDSNLess&&!this.singleType);this.contents.set("visible",this.isDSNLess);AF.set("visible",!this.isDSNLess);},dsnBox:undefined,dsnList:undefined,dbIDSelectList:undefined,dbmsList:undefined,contents:undefined,hideUnavailable:undefined,hideDriverCheck:false,onhideDriverCheckChange:function e(){this.driverBox.hideUnavailable.set("visible",!this.hideDriverCheck);},driverBox:undefined,addDriver:undefined,showAddDriver:false,showConnectionString:false,Hive:undefined,db_ver:undefined,DBP:undefined,DBPS:undefined,altDBPS:undefined,IDS:undefined,connections:undefined,altconnections:undefined,dsnless:undefined,Undefined:undefined,isgroup:undefined,groupid:undefined,showUnavailable:false,alwaysShowGeneric:false,children:[{scriptClass:"mstrmojo.Table",rows:1,cols:2,alias:"dsnBox",postCreate:function c(){this.cssClass="mstrmojo-wh-DSNConnection-Box "+((mstrApp.isSingleTier&&navigator.platform.indexOf("Win")!==-1)?"one-tier-win":"");},layout:[{cells:[{cssClass:"mstrmojo-wh-DSNConnection-Box-list"},{cssClass:"mstrmojo-wh-DSNConnection-Box-btn"}]}],children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",slot:"0,0",caption:"dsn:",alias:"dsnList",itemIdField:"nU",allowHTML:false,onChange:function X(){var AE=this.parent.parent,AD=AE.dsnBox.dsnList.selectedItem,AC=[];if(AD){g.forEach(AE.supportedDBs,function(AF){g.forEach(AF.dbVersions,function(AG){g.forEach(AG.connections.concat(AG.altconnections),function(AH){if(AH.driver===AD.des){AC.push(AG);return false;}return true;});});});}if(AE.showUnavailable){w.call(AE,[],AC);}else{w.call(AE,AC);}}},{scriptClass:"mstrmojo.Button",slot:"0,1",onclick:function p(){var AC=this.parent.parent.parent.parent.buttonsbox.buttonCancel;if(AC){AC.onclick();}mstrApp.getRootController().getDataService().submitRequest({},{taskId:"openODBCAdmin"});}}]},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dbIDSelectList",itemIdField:"id",caption:q,bindings:{visible:function(){return !this.parent.singleType;}},onChange:function X(AC){var AD=this.parent,AE;if(AC){AE=AC.id;w.call(AD,AD.supportedDBs[g.find(AD.supportedDBs,"id",AE)].dbVersions);this.set("selectedID",AE);if((AC.connType&4)!==4){AD.driverBox.addDriver.set("visible",AD.showAddDriver);}AD.updateLoginFn(AC.stdLogin!==0);}}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dbmsList",itemIdField:"did",caption:T,bindings:{visible:function(){return !this.parent.singleType;}},onChange:function X(){var AC=this.parent;if(AC.isDSNLess&&AC.dbIDSelectList.selectedItem){r.call(AC);}this.selectedID=this.selectedItem.did;if(AC.onDBMSSelectFn){AC.onDBMSSelectFn(this.selectedItem);}}},{scriptClass:"mstrmojo.Box",alias:"driverBox",children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",alias:"hideUnavailable",label:I,oncheckedChange:function W(){var AF=window.localStorage;if(AF){AF.setItem(f,this.checked?"1":"0");}var AE=this.parent.parent,AC,AD;if(AE.dbIDSelectList.items){AC=AE.dbIDSelectList.selectedID;}if(AE.dbmsList.items){AD=AE.dbmsList.selectedID;}AE.showUnavailable=(this.checked);if(AE.isDSNLess){H.call(AE);if(AE.dbIDSelectList.hasRendered){if(!!(AE.dbIDSelectList.items.length)&&((!AC)||(g.find(AE.dbIDSelectList.items,"id",AC)<0))){AC=AE.dbIDSelectList.items[0].id;AE.dbIDSelectList.selectedID=-1;AE.dbIDSelectList.set("selectedID",AC);}else{AE.dbIDSelectList.onChange(AE.dbIDSelectList.selectedItem);}}}else{if(this.parent.parent.hasRendered){this.parent.parent.dsnBox.dsnList.onChange();}}if(AE.dbmsList.hasRendered){if(((!AD)||(g.find(AE.dbmsList.items,"did",AD)<0))&&(AE.dbmsList.items&&AE.dbmsList.items[0])){AD=AE.dbmsList.items[0].id;AE.dbmsList.selectedID=-1;AE.dbmsList.set("selectedID",AD);}}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-AddDriver",visible:false,alias:"addDriver",text:P,onclick:function p(){j=this.parent.parent;mstrApp.rootController.launchOneTierFileBrowser("mstrmojo.warehouse.dbroles.DBRoleDSNConnection.oneTierFileUploader");}}]},{scriptClass:"mstrmojo.Box",alias:"contents",cssClass:"mstrmojo-wh-DBRoleConnection-Box"}],dbObjects:{},dbVersions:[],dbTypes:[],preferences:{},dbIDs:{},supportedDBs:[],dsnMapDBs:[],drivers:[],getConnectionStr:function O(){if(this.isDSNLess){var AC=this.contents.stringEditor;if(AC.visibleContents&&AC.enabledContents){return{str:AC.getValue(),err:""};}}return u.call(this,true,true,undefined);},getVLDBProperties:function B(AC){if(this.isDSNLess&&AC){g.forEach(this.contents.children,function(AD){if(!(AD.field)){Z(AD,AC);}});}},isValidInput:function F(){var AC=this.contents.children,AD={val:false,msg:h};if(this.isDSNLess){g.forEach(AC,function(AE){if(AE.isGroupSetting&&AE.visible){g.forEach(AE.children,function(AF){if(AF.alias!=="groupbox"){AD=AF.isValid();return(AD.val);}return true;});}else{AD=AE.isValid();}return(AD.val);});return AD;}return this.dsnBox.dsnList.isValid();},getDbmsID:function J(){return this.dbmsList.selectedItem.did;},getDBId:function A(){if(this.dbIDSelectList.selectedItem&&this.isDSNLess){return this.dbIDSelectList.selectedItem.id;}return 0;},getDBType:function AA(){return this.dbmsList.selectedItem.db_type;},getCharEncodingForUnix:function b(){var AE=this.dbmsList.selectedItem,AD=AE.db_ver,AC=g.find(this.dbVersions,"v",AD);if(AC>=0){return this.dbVersions[AC].unixEncoding;}return 1;},getDriverMode:function U(){return this.driverMode;},getOdbcv:function o(){if(this.getDBType()===this.dbTypes.Hive.v){return"20";}return"";},clear:function n(){this.set("info",{});}});mstrmojo.warehouse.dbroles.DBRoleDSNConnection.oneTierFileUploader=function(AC){mstrApp.rootController.oneTierFileUploader({success:function AD(){j.dbObjects.reloadDrivers({success:function AE(){j.drivers=j.dbObjects.drivers;j.oninfoChange.call(j);}});}},{fp:AC});};}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.dom","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.LoginEditor","mstrmojo.SessionManager");function O(b,Z){var a=(Z?"add":"remove")+"LoadingGraph";this.serverProxy[a](b);}var K=true,N="waitBox";mstrmojo._IsWebApp=mstrmojo.provide("mstrmojo._IsWebApp",{_mixinName:"mstrmojo._IsWebApp",serverProxy:null,init:function T(Z){this._super(Z);if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}},start:mstrmojo.emptyFn,styleName:"RWDocumentMojoStyle",modelFactory:null,enableWaitBox:false,onMobileDevice:function D(){return false;},isTouchApp:function G(){return false;},getContentDimensions:function X(Z){return null;},getConfiguration:mstrmojo.emptyFn,setInteractive:function J(Z){if(K!==Z){K=Z;mstrmojo.dom.toggleSelection(window.document.body,Z);return true;}return false;},isInteractive:function W(){return K;},addLoadingGraph:function E(Z){O.call(this,Z,true);},removeLoadingGraph:function U(Z){O.call(this,Z);},serverRequest:function R(f,g,a){try{g=g||{};a=a||{};var c=a.src||(arguments.callee&&arguments.callee.caller.name),Z=!this.enableWaitBox||a.silent,e=a.hideFailureErr,d=this;f.styleName=f.styleName||this.styleName;g=mstrmojo.func.wrapMethods(g,{submission:function(h){if(!Z){mstrmojo.all[N].requestId=h;}},failure:function(h){if(!Z){h.method=c;if(!(mstrApp.isSingleTier&&h.code===403)&&!e){mstrmojo.err(typeof h.mstrerr==="object"?h.mstrerr:h);}}},complete:function(){if(!Z){if(mstrmojo.all[N]){delete mstrmojo.all[N].requestId;}d.hideWait();}}});if(!Z){this.showWait(a&&a.waitBoxCfg);}window.setTimeout(function(){d.serverProxy.request(g,f,!!a.override,a);},0);}catch(b){mstrmojo.err(b);}},hasRequests:function Q(){return this.serverProxy.hasRequests();},getWaitBoxPosition:function(){return null;},isWaiting:function B(){var Z=mstrmojo.all[N];return !!(Z&&Z.visible);},showWait:function F(a){var c=this,d=mstrmojo.all[N]||mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:N,cssClass:"mstrWaitBox",draggable:false,showTitle:false,zIndex:99999,counter:0,displayMsg:null,position:null,ondisplayMsgChange:function b(){this.msgfield.set("text",this.displayMsg);},oncounterChange:function Z(){var f=this.counter,j=this.visible;if(f===0&&j){this.close();}else{if(f>0&&!j){this.open();mstrmojo.dom.center(this.editorNode);var e=this.position||c.getWaitBoxPosition();if(e){var h=e.top,g=e.left;if(h!==undefined){this.set("top",h+"px");}if(g!==undefined){this.set("left",g+"px");}}}}},children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrIcon-wait",alias:"icon"},{scriptClass:"mstrmojo.Label",cssClass:"mstrWaitMsg",alias:"msgfield"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrWaitCancel",alias:"cancelBtn",text:mstrmojo.desc(2140,"Cancel")}]});d.cancelBtn.set("visible",!!(a&&a.showCancel));d.cancelBtn.onclick=function(){c.serverProxy.cancelRequests();};if(a&&a.position){d.position=a.position;}else{d.position=null;}d.set("displayMsg",(a&&a.message)||mstrmojo.desc(11960,"Loading Data..."));if(!this._waitUserLogin){d.set("counter",d.counter+1);}else{this._waitCounter=this._waitCounter+1;}return d;},hideWait:function L(Z){var a=mstrmojo.all[N];if(a){a.set("counter",Z?0:Math.max(0,a.counter-1));}},startSessionManager:function S(a){var b=mstrApp,Z=b.enableAutomaticSessionRecovery&&b.maxSessionIdleTime;b.sessionManager=b.addDisposable(new mstrmojo.SessionManager(mstrmojo.hash.copy(a,Z?{timeBeforeSessionTimeoutWarning:mstrApp.timeBeforeSessionTimeoutWarning,maxSessionIdleTime:b.maxSessionIdleTime}:{})));if(Z){b.sessionManager.start();}},isSessionExpiredError:function Y(e){var d=2147760371,b=2147760372,a=2147758245,Z=2147759877;e=(e<0)?(4294967296+parseInt(e,10)):e;switch(e){case d:case b:case a:case Z:return true;}return false;},onSessionExpired:function V(b){if(mstrApp.authMode==mstrmojo.EnumAuthenticationModes.INTEGRATED){var e={evt:5005,src:mstrApp.name+"."+mstrApp.pageName+".5005"},a=(mstrApp.docModel&&mstrApp.docModel.bs)||(mstrApp.rootCtrl&&mstrApp.rootCtrl.docCtrl&&mstrApp.rootCtrl.docCtrl.model&&mstrApp.rootCtrl.docCtrl.model.bs)||(mstrApp.docModelData&&mstrApp.docModelData.bs);if(a){e.rwb=a;}mstrmojo.form.send(e);return ;}if(mstrApp.sessionManager){var d=mstrmojo.all[N],Z=d&&d.counter>0,c=this;this._waitCounter=-1;if(Z){this._waitCounter=d.counter-1;c.hideWait(true);}this._waitUserLogin=true;mstrApp.sessionManager.openLoginEditor({success:function(f){c._waitUserLogin=false;if(f&&f.sessionState){if(b){if(b.params.sessionState){b.params.sessionState=f.sessionState;}if(Z){d.counter=c._waitCounter;c.showWait();}mstrmojo.xhr.request(b.method,b.baseUrl,b.callback,b.params);}}},cancelRequests:function(){mstrApp.serverProxy.cancelRequests();}});}},updateSessionState:function M(Z){this.sessionState=Z;},onNavigateOut:mstrmojo.emptyFn,showHelpTopic:function A(a){var Z=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");if(a&&typeof a==="string"){Z+=a;}if(mstrApp.isSingleTier){window.FormWrapper.openPage(Z);}else{mstrApp.openPage(Z);}return false;},getSearchAutoCompleteDelay:function P(){return parseInt(mstrConfig&&mstrConfig.searchAutoCompleteDelay,10)||200;},getThemeClassName:function C(){return"mojo-theme-light";},openPage:function I(Z,a){window.open(Z,a);},modalEditorChange:function H(a,Z){}});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.ObjectInputBox","mstrmojo.DataGrid","mstrmojo.Editor");mstrmojo.requiresDescs(221,629,945,1442,1825,3095,4114,4115,4563,5298,8246,9125,12173,12916,12918,12947);var F=mstrmojo.hash,D=mstrmojo.expr,A=mstrmojo.ME.MetricToken.brackets,G=function(M){var J=null;if(M.isParam){J={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",alias:"paramInput",slot:"0,0",itemValidationField:"_did_",item2textCss:function E(N){return" mstrmojo-qb-SuggestIcon t"+N.t;},hideEditButton:function(){return false;},browseItemVisible:false,dynamicVerify:false,emptyText:mstrmojo.desc(9125,"Type here to input columns..."),postCreate:function(O){var N=this.parent.dataGrid,P=N&&N.parent;this.candidates=P.getCandidates(function(Q){return Q.t===26;});if(!O){N.candidatesListener.push(this);}this.autoSelect=false;this.openPopup("suggestionPopup");this.suggestionPopup.close();this.autoSelect=true;}}],onParamAdded:function(P){var O=this.dataGrid.parent,N=this.paramInput;O.closePopup();P.state=0;N.add([P],N.items.length-1);},getTokens:function(){var Q=this.paramInput.getSelectedObjects(),N=Q.length,P,R=[],O;if(N>0){for(P=0;P<N;P++){if(Q[P].state===mstrmojo.Enum_OIB_States.VALID){O={v:A(Q[P].n)};O.oi=Q[P];}else{O={v:Q[P].n};}R.push(O);R.push({v:",",isDelimiter:true});}R.pop();}return R;}};var K=J.children[0];if(!M.isRepeated){K.cssClass="mstrmojo-ObjectInputBox singleObject noVerify";K.maxObjectCount=1;}else{K.cssClass="mstrmojo-ObjectInputBox noVerify";}}else{switch(M&&M.dtp){case 11:J={scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-functionArgs-pulldown mstrmojo-Pulldown",items:[{n:mstrmojo.desc(4115,"False"),did:"0"},{n:mstrmojo.desc(4114,"True"),did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(N){this.value=this.data.dfv||0;},getTokens:function(){var N=this.data;if(this.value!==N.dfv){return[{v:N.n},{v:"=",isDelimiter:true},{v:String(this.value)==="-1"?"True":"False"}];}return[];}};break;case -2:J={scriptClass:"mstrmojo.Table",cssClass:"breakBy",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",slot:"0,0",alias:"breakByInput",item2textCss:function E(N){return(this._super&&this._super(N))||{12:"a","-99":"br"}[N.t]||"";},emptyText:mstrmojo.desc(12916,"Type here to input breakby attributes..."),noEditButton:true,browseItemVisible:true,folderLinksContextId:16,browsableTypes:[D.TP.FOLDER,D.TP.ATTR].join(","),getCandidatesThroughTaskCall:function L(O,N){mstrmojo.ME.MetricDataService.getAttributes(O,N);},postCreate:function(O){var N=this.parent.dataGrid,P=N&&N.parent;this.candidates=P.getCandidates(function(Q){return Q.t===12;});if(!O){N.candidatesListener.push(this);}}},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var O=this.parent.parent.dataGrid.parent;O.openPopup("ob",{zIndex:O.zIndex+10});var N=O.ob.browser;N.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onBreakByAdded"],browsableTypes:[D.TP.ATTR,D.TP.FOLDER].join(",")});}}]}],onBreakByAdded:function(P){var O=this.dataGrid.parent,N=this.breakByInput;O.closePopup();N.add([P],N.items.length-1);},getTokens:function(){var P=this.breakByInput.getSelectedObjects(),N=P.length,O,Q=[];if(N>0){Q.push({v:"BreakBy"});Q.push({v:"=",isDelimiter:true});Q.push({v:"{",isDelimiter:true});for(O=0;O<N;O++){Q.push({v:A(P[O].n),oi:P[O]});if(O!==(N-1)){Q.push({v:",",isDelimiter:true});}}Q.push({v:"}",isDelimiter:true});}return Q;}};break;case -1:J={scriptClass:"mstrmojo.Table",cssClass:"sortBy",layout:[{cells:[{cssText:"width: 330px"},{}]}],getTokens:function(){var Q=this.sortByGrid.items,N=Q.length,P,T=[];if(N>0){T.push({v:"SortBy"});T.push({v:"=",isDelimiter:true});T.push({v:"(",isDelimiter:true});for(P=0;P<N;P++){var R=Q[P],S=R.selFrm||(R.dssforms&&R.dssforms[0]),O={v:A(R.n),oi:R};if(S&&parseInt(R.t,10)===12){F.copy({v:A(R.n)+"@"+A(S.n),exv:S.dssid,extp:S.dtp},O);}T.push(O);if(P!==(N-1)){T.push({v:",",isDelimiter:true});}}T.push({v:")",isDelimiter:true});}return T;},children:[{scriptClass:"mstrmojo.DataGrid",slot:"0,0",cssClass:"mstrmojo-functionArgs-sort",alias:"sortByGrid",renderOnScroll:false,resizableColumns:true,makeObservable:true,itemDisplayField:"n",columns:[{headerText:mstrmojo.desc(945,"Name"),dataField:"n",colCss:"nmCol"},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(3095,"Order"),dataField:"order",colCss:"ordCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.asc=this.value;}}},{dataWidget:{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(N){this.dataGrid.remove(this.data);}},headerText:"&nbsp",colCss:"actionsCol"}]},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var O=this.parent.parent.dataGrid.parent;O.openPopup("ob",{zIndex:O.zIndex+10});var N=O.ob.browser;N.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onSortByAdded"],browsableTypes:[D.TP.ATTR,D.TP.METRIC,D.TP.FOLDER].join(",")});}}]}],onSortByAdded:function(Q){var O=this.dataGrid.parent,P=this.sortByGrid;O.closePopup();if(Q){switch(Q.t){case 12:var R=function(S){if(S){var T=S.container;if(T&&T.dssforms){Q.dssforms=T.dssforms;P.add([Q]);}}},N=function(S){mstrmojo.alert(S.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:Q.did,displayedForms:0},{success:R,failure:N});break;case 4:Q.dssforms=[{n:"Value"}];default:P.add([Q]);}}}};break;default:J={scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(N){var O=this.data;this.value=(O.dfv||O.dfv===0)?O.dfv:"";},getTokens:function(){var N=this.data;if(this.value!==N.dfv){return[{v:N.n},{v:"=",isDelimiter:true},{v:this.value}];}return[];}};break;}}J.alias="inputWidget";return J;},I=function(K,E,J){return'<div class="mstrmojo-DataRow-text"title="'+(K.desc||"")+'">'+K.n+(K.isParam?"*":"")+":</div>";};mstrmojo.qb.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FunctionWizard",init:function H(E){this._super(E);this.help=this.help||(mstrApp&&mstrApp.helpTopics&&mstrApp.helpTopics.fnWiz);},cssClass:"mstrmojo-FunctionWidzard",title:mstrmojo.desc(4563,"Function Arguments"),help:"",fctOi:null,fctArgs:null,fctSyntax:"",bindings:{candidates:"this.opener.candidates"},getCandidates:function B(K){var J=this.candidates,E;if(J){E=mstrmojo.array.filter(J.items,K);return{items:E,isComplete:J.isComplete};}return null;},_set_candidates:function(N,J){this.candidates=J;if(this.hasRendered&&this.visible){var L=this.argsGrid,M=L.candidatesListener,E=M.length,K;for(K=0;K<E;K++){M.postCreate(true);}}return true;},onOpen:function(){var J=this,L,K=function(P){if(P){J.set("fctOi",P);var R=[],O,M,Q,N=[];N.push(P.n);N.push("(");M=(P.pars&&P.pars.length)||0;for(O=0;O<M;O++){Q=F.copy(P.pars[O]);Q.isParam=true;R.push(Q);N.push(P.pars[O].n);if(O!==(M-1)){N.push(", ");}}N.push(")");if(P.rpc>0){Q.isRepeated=true;}M=(P.pros&&P.pros.length)||0;if(P.did==="6F7DF5FF449111D5BEA300B0D01A55EF"){M=0;}for(O=0;O<M;O++){if(P.pros[O].n!=="UseLookupForAttributes"){R.push(F.copy(P.pros[O]));}}if(P.sqt===5){R.push({n:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:mstrmojo.desc(12918,"Break By is a parameter representing the break by levels for this function.")});}J.set("fctArgs",R);J.set("fctSyntax",N.join(""));}mstrmojo.css.removeClass(J.argsGrid.domNode,["loading"]);},E=function(M){mstrmojo.alert(M.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));mstrmojo.css.removeClass(this.argsGrid.domNode,["loading"]);};this.argsGrid.set("items",[]);mstrmojo.css.addClass(this.argsGrid.domNode,["loading"]);this.set("fctSyntax","");this.set("title",mstrmojo.desc(12947,"Function arguments for:")+this.fctOi.n);L={functionId:this.fctOi.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};mstrApp.getRootController().getDataService().getFunctionDetails({success:K,failure:E},L);},getTokens:function C(){var L=this.argsGrid.ctxtBuilder.itemWidgets,O=L.length,N,S,P=[],K=[],T=[],Q,M,J,E,R=this.fctOi;for(N=0;N<O;N++){S=L[N].inputWidget;if(S.data.isParam){K.push(S.getTokens());}else{P.push(S.getTokens());}}T.push({v:R.n,oi:R});O=P.length;if(O>0){E=false;T.push({v:"<",isDelimiter:true});for(N=0;N<O;N++){Q=P[N];J=Q.length;if(J===0){continue;}E=true;for(M=0;M<J;M++){T.push(Q[M]);}T.push({v:",",isDelimiter:true});}T.pop();if(E){T.push({v:">",isDelimiter:true});}}O=K.length;T.push({v:"(",isDelimiter:true});E=false;for(N=0;N<O;N++){Q=K[N];J=Q.length;if(J===0){continue;}E=true;for(M=0;M<J;M++){T.push(Q[M]);}T.push({v:",",isDelimiter:true});}if(E){T.pop();}T.push({v:")",isDelimiter:true});return T;},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},children:[{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:"functionArgs",banding:false,columns:[{headerText:"Property Name",dataFunction:I,colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:G,colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-syntaxLabel",text:"",bindings:{text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-descLabel",text:"",bindings:{text:function(){return this.parent.fctOi.desc;}}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-FW-buttonBox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;if(E.insertOnFinish){E.insertOnFinish(E.getTokens());}E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.ME.MetricEditBox","mstrmojo.warehouse._CanToggleAvatarClass");var T=mstrmojo.array,I=mstrmojo.string,W=mstrmojo.css,U=mstrmojo.dom,Q="visible",Y=["(",")","{","}","-","+","*","/","<",">","=","|","~",","," ","\t","\n",";"],X=null,A=mstrmojo.warehouse.EnumObjectTypes,L=A.TABLE,O=A.COLUMN;function M(a){var Z;if(!X){X={};for(Z=0;Z<Y.length;Z++){X[Y[Z]]=true;}}return X[a];}mstrmojo.architect.ui.SQLInputBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,[mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.SQLInputBox",cssClass:"mstrmojo-ar-sqlInput-inputbox",dropZone:true,allowDrop:function B(a){var b=[].concat(a.src.data)[0],Z=mstrApp.rootController.model;if(!b){return false;}if(!((b.tp===O)||(b.tp===L))){return false;}return(Z.SelDBRoleID===Z.projPrimaryDBRoleID);},ondrop:function S(b){var d=this,c=[].concat(b.src.data)[0],a=this.inputBox.items,f=function f(g){a=[{v:"select"}];a.push({v:String.fromCharCode(10)});T.forEach(g,function(h){a.push({v:h.cln});a.push({v:", "});});a.pop();a.push({v:String.fromCharCode(10)});a.push({v:"from"});a.push({v:String.fromCharCode(10)});a.push({v:c.n});d.inputBox.set("items",a);d.parent.execSQL.onclick({cancel:mstrmojo.emptyFn});d.inputBox.focus();};if(!c){return ;}this.inputBox.set("items",[]);switch(c.tp){case O:a.push({v:c.cln});this.inputBox.set("items",a);break;case L:var Z=(b.src.widget.alias==="dbTableTree");if(Z){mstrApp.rootController.getColumnsForDBTable({data:c},{success:function e(g){f(g.items);}});}else{mstrApp.rootController.model.getAttributesFactsInTable(c.did,{success:function e(){f(mstrApp.rootController.model.getTable(c.did).columns);}});}break;}},postBuildRendering:function R(){if(this._super){this._super();}this.onheightChange({value:this.height});this.onwidthChange({value:this.width});this.reset();},onheightChange:function G(a){var b=this.inputBox,Z=a.value;if(b.hasRendered&&Z!==undefined){b.height=Z;b.domNode.style.height=Z;b.editNode.style.height=Z;}},onwidthChange:function J(Z){var b=this.inputBox,a=Z.value;if(b.hasRendered&&a!==undefined){b.width=a;b.editNode.style.width=a;}},tables:[],columns:[],sqlFunctions:[{n:"Select"},{n:"Update"},{n:"Insert"},{n:"Delete"},{n:"Create"},{n:"Drop"},{n:"Alter"},{n:"Set"},{n:"Exec"},{n:"From"},{n:"Where"},{n:"Having"},{n:"In"},{n:"Group"},{n:"By"},{n:"Order"},{n:"Into"},{n:"On"},{n:"Values"},{n:"Table"},{n:"Case"},{n:"Then"},{n:"Else"},{n:"Join"},{n:"As"}],getSQLStatement:function E(){var Z=[];T.forEach(this.inputBox.items,function(a){Z.push(a.v);});return I.trim(Z.join("").replace(/<\s/g,"<").replace(/>\s/g,">"));},setSQLStatement:function H(f){var c=[],b,d="\n",Z=", ",e=f.split(d),a;T.forEach(e,function(g){b=I.trim(g);if(b.indexOf(Z)>0){a=b.split(Z);T.forEach(a,function(h){c.push({v:I.trim(h)});c.push({v:Z});});c.pop();}else{c.push({v:b});}c.push({v:d});});this.inputBox.set("items",c);},onvisibleChange:function N(){W.toggleClass(this.domNode,Q,this.visible);W.toggleClass(this.inputBox.domNode,Q,this.visible);},reset:function V(){var Z={items:this.sqlFunctions.concat(this.tables).concat(this.columns),isComplete:true};this.inputBox.set("candidates",Z);this.inputBox.set("items",[]);},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",cssClass:"mstrmojo-ar-sqlInput-tokenbox",alias:"inputBox",slot:"editNode",browseItemVisible:false,renderBlockSize:1000,lastPagePos:{left:0,top:0,width:0,height:0},lastScrollPos:{left:0,top:0,width:0,height:0},breakOnEnterKeyDown:function P(){return !this.suggestionShown;},getCharacter:function C(a){var Z=(U.isIE&&!U.isIE9)?a.keyCode:a.charCode;return(Z>0)?((Z===13)?"\n":String.fromCharCode(Z)):null;},ondrop:function(Z){this.parent.ondrop(Z);},ondragenter:function K(Z){this.parent.ondragenter(Z);},allowDrop:function B(Z){return this.parent.allowDrop(Z);},item2textCss:function F(Z){return{15:" mstrmojo-ArchitectListIconSuggest t15 ",26:" mstrmojo-ArchitectListIconSuggest t26 "}[Z.tp||Z.t]||"";},itemFunction:function D(a){return new mstrmojo.ME.MetricToken({data:a,brackets:function(b){return b;},isDelimiter:function Z(){var b=this.data,c=b.v.length;if(b){return b.isDelimiter||(c===1&&M(b.v));}return false;}});},isDelimiter:M}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.string","mstrmojo.form","mstrmojo._FormatDefinition","mstrmojo.ME.MetricDataService","mstrmojo.ME.MetricEditBox","mstrmojo.mstr.EnumDataType","mstrmojo.ME.Enum");mstrmojo.requiresDescs(218,219,221,531,628,1442,1918,2102,2116,2154,2213,2919,5298,5424,5728,5891,7558,7984,7987,11566,13249);var F=mstrmojo.string,n=mstrmojo.mstr.EnumDataType,A=mstrmojo.ME.MetricDataService;function R(t){var p=t.items,S=p.length,r="",q;for(q=0;q<S;q++){r+=p[q].v;}return r;}var J=mstrmojo.dom,E=mstrmojo.string,P=mstrmojo._FormatDefinition,k=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,C=mstrmojo.ME.Enum.METRIC_EDIT_TYPES;var U=function(S){if(!S){return k.VALID;}return{"-2147214845":k.ERROR,"-2147214846":k.AMBIGUITY}[S]||k.ERROR;},T=function(x){var t=x.items,p=t.length,w=t[t.length-1],r,u,q=[],S="";if(t[0]&&t[0].tp!==38){q.push({v:"&",tp:38,lv:4,sta:2});}for(r=0,p=t.length;r<p;r++){u=t[r];if(u.isNew&&!u.oi){S+=u.v;}else{if(!E.isEmpty(S)){q.push({v:S,tp:2,lv:1});S="";}q.push(u);}}if(!E.isEmpty(S)){q.push({v:S,tp:2,lv:1});S="";}if(w&&w.tp!==-1){q.push({v:"",tp:-1,lv:4,sta:2});}return{items:q};},N=function(q){var r=T(q.tks);var p={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true},S={getArrItemName:function(w,t,u){return"tkn";},isSerializable:function(w,u,t){return(p[w])?true:false;}};return E.json2xml("tknstrm",r,S);},j=function(r){var p=r.items,S=p.length,q=p[p.length-1];if(q&&q.tp===-1){p.pop();}if(p[0]&&p[0].tp===38){p.splice(0,1);}},l=function(S){return"";},g=function(S,q){var p=[];S.oi.tks.items=p;q.clearTokens(p);},K=function(u,t){var r=[];r.push("<mt>");if(u.fmt&&!t){var S={getArrItemName:function(z,w,x){return z.substr(0,z.length-1);},isSerializable:function(AE,AC,AB){if(mstrmojo.array.indexOf(["header_format","grid_format"],AE)>-1){var AF=AC[AB][AE];if(!AF){return{};}var z="<"+AE+">",AD;for(AD in AF){z+="<prs n='"+AD+"'>";var x=AF[AD],w;for(w in x){var AA=x[w];z+="<pr n='"+w+"' v='"+(AA==="pru"?"":AA)+"'";z+=AA==="pru"?' pru="1"':"";z+="/>";}z+="</prs>";}z+="</"+AE+">";return{child:z};}return true;},skipNull:true};r.push(E.json2xml("fmt",u.fmt,S));}if(u.prss&&!t){var q={getArrItemName:function(z,w,x){return z.substr(0,z.length-1);},isSerializable:function(AE,AB,z){if(mstrmojo.array.indexOf(["AnalyticalEngineProperties","DatamartProperties","VLDBSelect","VLDBFunction","VLDBReport"],AE)>-1){var AA=AB[z][AE];if(!AA){return{};}var x=[],AC=[],AD;x.push("<prs n='"+AE+"' ");for(AD in AA){var w=AA[AD];if(w!=null){if(typeof w==="object"){AC.push(E.json2xml("pr",w,{skipNull:true,convertBoolean:true,isSerializable:function(AH,AG,AF){return true;}}));}else{x.push(AD+"='"+w+"' ");}}}x.push(">");x.push(AC.join(""));x.push("</prs>");return{child:x.join("")};}return true;},skipNull:true};r.push(E.json2xml("prss",u.prss,q));}if(u.mps){r.push(E.json2xml("mps",u.mps,{skipNull:true,convertBoolean:true,isSerializable:function(z,x,w){return true;}}));}if(u.datp&&!t){r.push(E.json2xml("datp",u.datp,{skipNull:true,convertBoolean:true,isSerializable:function(z,x,w){return true;}}));}if(u.sbs&&!t){var p={getArrItemName:function(z,w,x){return(z==="avs")?"sb":z.substr(0,z.length-1);},isSerializable:function(z,x,w){return true;},skipNull:true};r.push(E.json2xml("sbs",u.sbs,p));}r.push("</mt>");return r.join("");},G=function(p,S){p.set("enabled",!S);var q="mstrmojo-InlineWaitIcon";if(p.iconClass){p.set("iconClass",p.iconClass.replace(new RegExp(q),"")+" "+(S?q:""));}else{mstrmojo.css.toggleClass(p.domNode,q,S);}},H=function(p,S){var q={taskId:"saveMetricDefinition",tokenStreamXML:N(p),localSymbolFolderXML:l(p),metricXML:K(p),metricId:p.did||"",outputFlags:327695,description:p.desc||"",name:p.n||"",saveAs:S};if(E.isEmpty(p.metricId)){q.isNew=true;}return q;},M=function(q){var p=function(r){var u=this.parent;var t=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##","Object").replace("'###'","");if(u){u.ob.refreshContent();u.onObjectSaved({name:u.name,did:r.did,desc:u.desc});t=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",u.typeDesc||"Object").replace("###",u.name);}mstrmojo.alert(t,q.onSaved,mstrmojo.desc(7984,"Object Saved"));if(u){u.close();}q.dirty=false;},S={success:p,failure:mstrmojo.SaveAsEditor.SAVEAS_CALLBACK.failure};return S;},L=function(x,t){var q=this;G(q,true);var z=mstrmojo.ME._MetricEditorHelper.oi=x.oi,r=N(z),u=l(z),w=K(z,true),AA=function(AB){if(AB&&AB.tks){var AC=AB.tks;j(AC);z.tks=AC;x.checkEditorFallback(x.ide.candidates.items,z);AC.vs=U(AC.rjec);x.set("vStatus",AC.vs);x.set("iStatus",AC.rjed||"");if(x.handleValidation){x.handleValidation(AC);}if(t&&(AC.vs===k.VALID)){switch(t){case"save":case"saveAs":if(x.isDME){x.handleDerivedMetricAction(t,z);}else{x.handleMetricAction(t,z);}break;case"switch":if(x.cbSwtichEditor){x.cbSwtichEditor(x);}break;}}else{if(t&&AC.vs===k.ERROR){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));}}}},p=function(AB){mstrmojo.alert(AB.message||AB.getResponseHeader("X-MSTR-TaskFailureMsg"));},S=function(AB){G(q,false);};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:r,localSymbolFolderXML:u,metricXML:w,metricId:z.did,isNew:E.isEmpty(z.did),msgID:x.ide.isDME?mstrApp.getMsgID():null},{success:AA,failure:p,complete:S});},D=function(p,r){var t=r,S=t.oi.fmt,q=P.MetricFormatTarget;G(p,true);window.setTimeout(function(){if(!S){S=t.oi.fmt={};var u;for(u=0;u<q.length;u++){S[q[u].p]={};}}var w=J.position(p.domNode,true);t.openPopup("formatPopupRef",{zIndex:t.zIndex+10,model:S,left:Math.max(0,(w.x-(t.formatPopupRef.width||565)))+"px",top:w.y+"px"});G(p,false);},50);},e=function(q,r){var t=r,S=t.oi,p=function(){var u=J.position(q.domNode,true);t.openPopup(mstrmojo.all.mstrMEOptionsDialog||"optionPopupRef",{zIndex:t.zIndex+10,model:S,funcs:t.funcs,left:Math.max(0,(u.x-(t.optionPopupRef.width||565)))+"px",top:u.y+"px"});};if(!t.isDME&&!t.funcs){G(q,true);mstrmojo.ME.MetricDataService.getSubtotalFunctions(null,{success:function(u){if(u.items){t.funcs=u.items;p();G(q,false);}},failure:function(u){mstrmojo.alert(u.message||u.getResponseHeader("X-MSTR-TaskFailureMsg"));G(q,false);}});}else{p();}};mstrmojo.ME._MetricEditorHelper=mstrmojo.provide("mstrmojo.ME._MetricEditorHelper",{noCache:true,useKeyDelay:true,tbBrowsable:true,functionNameRef:{scriptClass:"mstrmojo.Label",alias:"fnLabel",cssClass:"mstrmojo-ME-fct-name",bindings:{visible:function(){return !this.parent.insertMode;},text:function(){return mstrmojo.desc(5424,"Function:")+" "+this.parent.fctName;}}},nameEditBoxRef:{scriptClass:"mstrmojo.Box",alias:"nameEditBox",cssClass:"mstrmojo-ME-nameEditBox",cssDisplay:"inline-block",visible:false,bindings:{visible:function(){return !this.parent.insertMode&&this.parent.visible;}},onvisibleChange:function(S){if(S.value==false){return ;}var p=this;if(!p.tmr){p.tmr=window.setInterval(function(){if(p.domNode){window.clearInterval(p.tmr);delete p.tmr;p.nameInput.inputNode.select();}},50);}},children:[{alias:"nameInput",scriptClass:"mstrmojo.TextBoxWithLabel",inputNodeCssClass:"mstrmojo-ME-nameInput",value:mstrmojo.desc(2213,"New metric"),size:20,useRichTooltip:true,showErrTooltip:function o(){var p=J.position(this.domNode),S=E.isEmpty(this.value)?mstrmojo.desc(9122,"Name cannot be empty"):mstrmojo.desc(11569,"Input contains invalid character");this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+S+"</span></div>",top:p.y-5,left:p.x+p.w+10};this.hasOpenTooltip=false;this.showTooltip();},bindings:{value:function(){var S=this.parent.visible;return this.parent.parent.oi.alias||this.parent.parent.oi.n;},label:function(){var p=this.parent.parent.ide||{},S=p.nameLabel||mstrmojo.desc(11566,"Metric Name:");return this.parent.parent.oi.alias?mstrmojo.desc(13249,"Display Name:"):S;}},onvalueChange:function(q){var S=this.parent.parent.ide.action.alias,w=function(x){return !E.isEmpty(x)&&(S?true:!/[\[\]\"\\]/g.test(x));},u=w(this.value);if(u){this.hideTooltip();}else{this.showErrTooltip();}mstrmojo.css.toggleClass(this.parent.domNode,"err",!u);var r=this.parent.parent;r.set("cValid",u);var t=r.oi;if(t){var p={n:t.n,alias:t.alias};t.n=this.value;t.alias=this.value;if(t.n!==p.n&&t.alias!==p.alias){r.dirty=true;}}}}]},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:"Metric",browsableTypes:"4,8",onObjectSaved:function(r){var q=this.opener,S=q&&q.oi;if(q&&S){S.did=r.did;S.n=r.name;S.desc=r.desc;q.set("title",mstrmojo.desc(2154,"Metric:")+" "+r.name);}}},optionPopupRef:{id:"mstrMEOptionsDialog",scriptClass:"mstrmojo.ME.OptionDialog",title:mstrmojo.desc(9572,"Advanced Metric Options"),help:"Advanced_Metric_Options_dialog_box.htm",height:340},formatPopupRef:{scriptClass:"mstrmojo.ME.MetricFormatEditor",contentNodeCssClass:"mstrmojo-balloon",alias:"formatEditor",title:mstrmojo.desc(2116,"Format"),left:"100px",top:"100px",useAnimate:false,height:360,width:565,help:"Format_Metric_dialog_box.htm",locksHover:true},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px;",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},switchRef:{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"switchToMetricEdtior",cssClass:"mstrmojo-ME-switch mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(9563,"Switch to Formula Editor"),closeAfterSwitch:true,bindings:{visible:function(){return !this.parent.insertMode;}},getEditor:function(){return this.parent;},getFormulaEditorId:function(){var S=this.getEditor();return(S.ide&&S.ide.formulaEditorId)||"mstrME";},onclick:function(){var q=this.getEditor(),p=this.getFormulaEditorId();q.oi.tks.items=q.getMetricDefAsTokens();var S={vStatus:mstrmojo.ME.MetricEditBox.VALIDATION_STATUS.UNKNOWN,oi:q.oi,did:q.oi.did};if(q.dirty){S.dirty=q.dirty;}q.switch2Editor(p,S);if(q.ide){q.ide.set("showLeftPanel",true);q.set("simple",false);}}},formatAndOptionsBarRef:{scriptClass:"mstrmojo.HBox",alias:"formatbar",cssClass:"mstrmojo-ME-formatbar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link format",alias:"formatButton",text:mstrmojo.desc(1918,"Format"),bindings:{visible:function(){return this.parent.parent.tbFormatable&&!this.parent.parent.insertMode;}},onclick:function(){D(this,this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link property",alias:"optButton",text:mstrmojo.desc(13035,"Metric Options"),bindings:{visible:function(){var S=this.parent.parent;return !S.insertMode&&!S.ide.disableAFB;}},onclick:function(){e(this,this.parent.parent);}}]},saveLabel:mstrmojo.desc(5891,"Save"),saveAsLabel:mstrmojo.desc(628,"Save As"),closeLabel:mstrmojo.desc(221,"Cancel"),saveAsEnabled:true,cValid:true,buttonBarRef:{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:"",bindings:{enabled:function(){return this.parent.parent.cValid;},text:function(){return this.parent.parent.insertMode?mstrmojo.desc(531,"Add"):this.parent.parent.saveLabel;}},onclick:function(){var p=this.parent.parent;if(!p.insertMode&&p.isDirty&&!p.isDirty()){p.close();p.onCancel();return ;}if(!p.cValid){return ;}if(p.insertMode){p.insertOnFinish(p.getMetricDefAsTokens());p.close();}else{if(p.getMetricDefAsTokens){p.oi.tks.items=p.getMetricDefAsTokens();}var S=this;if(p.validateAndSave){G(S,true);p.validateAndSave(p.oi,function(){G(S,false);});}else{if(p.ide&&p.ide.validateAndSave){G(S,true);p.ide.validateAndSave(p.oi,function(){G(S,false);});}else{p.tbValidate=this;L.call(this,p,"save");}}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",alias:"btnSaveAs",text:mstrmojo.desc(628,"Save As"),bindings:{visible:function(){return !this.parent.parent.insertMode&&!this.parent.parent.isDME;},text:function(){return this.parent.parent.saveAsLabel;}},onclick:function(){var S=this.parent.parent;if(S.getMetricDefAsTokens){S.oi.tks.items=S.getMetricDefAsTokens();}S.tbValidate=this;L.call(this,this.parent.parent,"saveAs");}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.parent.closeLabel;}},onclick:function(){var S=this.parent.parent;if(S.onPreClose()){S.close();if(!S.insertMode){S.onCancel();}}}}]},validateSyntax:function B(S){L.call(S,this);},validateSyntaxAndSwitch:function Y(S){L.call(S,this,"switch");},preprocessTokenStram:function Q(S){j(S);},isDirty:function f(){if(this.insertMode){return false;}return this.dirty||this.oi.dirty||(this.oi.fmt||{}).dirty||(this.oi.mps||{}).dirty;},onmetricModify:function d(){this.dirty=true;},save:function O(){this.buttonBar.btnSaveAs.onclick();},prompt2saveRef:{scriptClass:"mstrmojo.Editor",cssText:"width:350px;",title:mstrmojo.desc(5728,"Confirm save"),children:[{scriptClass:"mstrmojo.Label",cssText:"margin:5px 5px 20px;",allowHTML:true,bindings:{text:function(){return mstrmojo.desc(9573,"Do you want to save changes made to #?").replace("#","<b>"+this.parent.opener.oi.n+"</b>");}}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"left",cssText:"width:10px;"},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(219,"Yes"),onclick:function(){var S=this.parent.parent;S.opener.save();S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(218,"No"),onclick:function(){var S=this.parent.parent;S.opener.close();if(S.opener.onCancel){S.opener.onCancel();}S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var S=this.parent.parent;S.close();}}]}]},prompt2save:function(){if(this.getMetricDefAsTokens){this.oi.tks.items=this.getMetricDefAsTokens();}this.openPopup("prompt2saveRef",{zIndex:this.zIndex+1});},handleMetricAction:function b(q,p){var S=this;var r=H(p,false);if((q==="save")&&p.did){mstrmojo.xhr.request("POST",mstrConfig.taskURL,M(S),r);}else{if(((q==="save")&&E.isEmpty(p.did))||q==="saveAs"){r.saveAs=true;S.openPopup("saveasRef",{zIndex:S.zIndex+10,folderLinksContextId:17,name:p.n||p.name||(S.name&&S.name.value)||mstrmojo.desc(2213,"New Metric"),saveParams:r,saveAsCallback:function(){var t=M(S);if(t.success){var u=t.success;t.success=function(w){u.call(this,w);if(S.ide.noRefresh!==true){var x=mstrApp;mstrmojo.form.send({evt:5005,src:x.name+"."+x.pageName+".5005"});}};}return t;}});}}},handleDerivedMetricAction:function c(t,r){r=r||this.oi;if(t==="save"){var S={tokenStreamXML:N(r),alias:r.n};var p=r.mps||{};if(p.dirty){if(p.fbf===0){p.afb=p.sfb=-1;}S.afb=p.afb;S.sfb=p.sfb;}var u=mstrmojo.all.mstrMetricIDE,q=u.disableAFB;if(q){S.afb=0;S.sfb=1;}u.onApplyMetricCallback(S);u.close();}},onPreClose:function(){var S=this;if(S.isDirty&&S.isDirty()&&!this.isDME){S.prompt2save();return false;}return true;},onClose:function W(){this.dirty=false;if(this.onPostClose){this.onPostClose();}},init:function m(q){if(this._super){this._super(q);}var r=mstrApp,S=r&&r.useQuickSearch&&r.useQuickSearch(),p=S?((r&&r.searchAutoCompleteDelay&&r.searchAutoCompleteDelay())||0):0;this.suggestDelay=p||200;this.noCache=this.noCache&&S&&!this.isDME;this.ob.children[0].quickSearch=S;mstrmojo.ME.MetricDataService.suggestDelay=this.suggestDelay;mstrmojo.ME.MetricDataService.noCache=this.noCache;},_setupCandidatesCache:function h(S){if(this.candidates&&S){S.candidates=null;S.set("candidates",this.candidates);}},item2textCss:function I(S){return"mstrmojo-ME-icon t"+S.t+(S.st?" st"+S.st:(S.um||S.da?"d":""));},getSpecialFunctionEditorId:function a(S,r){var q=S&&S.did,p;if(q){if(mstrmojo.ME.MetricDataService.isBasicAggMap(q)){p="mstrSME";}else{if(mstrmojo.ME.MetricDataService.isRank(q)){p="mstrRFE";}else{if(A.isOLAPAgg(q)){p="mstrOFE";}else{p="mstrFE";}}}if(p){p+=r?"_1":"";}}return p;},isDimty:function(p,S){return(/^@[a-z]{1,}(\s*[+-]\s*\d{1,})?$/i).test(F.trim(p));},validateByDataType:function Z(p,S){var q=false;switch(p){case n.DataTypeInteger:q=/^(-)?\d+$/.test(S);break;case n.DataTypeNumeric:case n.DataTypeReal:case n.DataTypeDouble:q=mstrmojo.num.isNumeric(S);break;case n.DataTypeChar:case n.DataTypeVarChar:q=true;break;case n.DataTypeDate:case n.DataTypeTimeStamp:q=true;break;default:q=true;}return q;},getRootFunction:function X(q){var p,S=q&&q.tks&&q.tks.met;if(S!==C.ADVANCED){var r=q.tks.items[0];p=r&&r.oi;}return p;},checkEditorFallback:function V(S,r){var p=this.getRootFunction(r),q=mstrmojo.array.find(S,"did",p&&p.did)===-1;if(q&&r&&r.tks&&r.tks.items&&r.tks.items.length>0){r.tks.met=C.ADVANCED;}return q;}});mstrmojo.ME._MetricEditorHelper.getTokenStreamXML=N;}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.qb.FFsqlInput");var H=mstrmojo.array,G=mstrmojo.hash;function C(J,K){var I=K?"\n":"",L;for(L=0;L<J;++L){I+=" ";}return I;}mstrmojo.qb.FFsqlEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.FFsqlEditor",cssClass:"mstrmojo-qb-ffsqlview",children:[{scriptClass:"mstrmojo.Box",alias:"passlabel",cssClass:"mstrmojo-qb-ffsqlview-passlabel"},{scriptClass:"mstrmojo.qb.FFsqlInput",alias:"ffsql",cssClass:"mstrmojo-qb-ffsqlview-editnode",id:"FFsql",txt:"",dropZone:true,onwidthChange:function B(){if(this.hasRendered){this.parent.updatepasses();}},onheightChange:function E(){if(this.hasRendered){this.parent.updatepasses();}},updateSQL:function D(I){if(!this.candidates){this.set("candidates",{items:this.sqlTokens.concat(mstrApp.getRootController().getSuggestionItems(true)),isComplete:true});}this.clearTokens();this.txt=I.value;this.clipboardNode.value=I.keepFormat?this.txt:this.formatSQL(this.txt);this.handlepaste();if(I.value===""){this.parent.updatepasses();}this.oriSQL=this.getSQLstmt();},formatSQL:function A(P){var N,L=false,J=C(2,false),Q=C(1,false),M="\n",O=C(9,true),K=C(10,true),I=false;N=P.replace(/,/g," ,").replace(/;/g," ;").replace(/\n/g," ").replace(/ +/g," ").split(" ");H.forEach(N,function(S,R){switch(S){case"from":case"having":N[R]="\n"+N[R]+J;break;case"group":if(N[R+1]==="by"){N[R]="\n"+N[R]+Q;}break;case"where":N[R]=M+N[R];break;case"join":case"outer":if(L){break;}case"full":case"left":case"right":N[R]=K+N[R];L=true;break;case",":if(!I){N[R]=N[R]+O;}break;case"on":N[R]=K+N[R];L=false;break;case";":N[R]=N[R]+"\n";break;case"in":I=true;break;default:if(I&&S.length>=1&&S[S.length-1]===")"){I=false;}break;}});return N.join(" ").replace(/ ,/g,",");}}],onwidthChange:function B(I){var L=this.ffsql,K=L.domNode,J;J=Math.max(parseInt(I.value,10)-10,0)+"px";L.set("width",J);if(K){K.style.width=J;}},updatepasses:function F(){var L,N=this.ffsql,M=[],K={scriptClass:"mstrmojo.Button"},I=this.domNode.clientHeight,J=this.passlabel;L=N.getPassLabelYCoords();H.forEach(L,function(P,O){if(P>=0&&P<=I){M.push(G.copy(K,{cssText:["top:",P,"px;"].join(""),cssClass:(N.pnum===O?"error":"")}));}});J.removeChildren(null,true);J.addChildren(M,0,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.WidgetList","mstrmojo.qb.FilterTree","mstrmojo.CustomGroupEl","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ConditionNode","mstrmojo._IsPopup");mstrmojo.requiresDescs(1994,2550,3415,3416,5893,7953,12367,12368);var D=mstrmojo.hash,G=mstrmojo.array,M=mstrmojo.expr,H=M.BRANCH_FNS,N=mstrmojo.dom,E=mstrmojo.desc;function B(O){if(!O){return undefined;}var P=O.nds;if(!P){return O;}G.forEach(P,function(R,Q){P[Q]=B(R);});O.nds=P.slice(0);return O;}function I(O,Q,P){G.forEach(O,function(S,R){if(S.nds){I(S.nds,Q,P);}else{if(S===Q){O[R]=P;}}});}function L(P,O){var Q=P.data;mstrApp.getRootController().openExpressionEditor({n:O?mstrmojo.desc(5893,"New Condition"):mstrmojo.desc(7953,"Condition Editor"),tkn:O?[]:Q.expr,callbacks:{success:function R(T){var V={0:"filterExpr",1:"aggfilterExpr"},S=T.mi,U=S.exp.sqltp;var W={et:"*",expr:S.items,n:T.expr,sqltp:U};if(O){P[V[U]].newCondition(W);}else{if(Q.sqltp===U){I(P.tree.items,P.data,W);P.data=W;P.paint();}else{P.del();P.tree.parent[V[U]].newCondition(W);}}}}});}function F(O){var P=O&&O.items;if(P){O.remove(P);}}mstrmojo.qb.ConditionEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._HasPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.qb.ConditionEditor",cssClass:"mstrmojo-qb-filterEditor",title:mstrmojo.desc(2550,"Filters"),ondataChange:function C(){var O=this.CEl,Q=this.data,P=Q.having,R=D.clone(Q.where);O.filterExpr.set("items",[]);O.filterExpr.add(R?[R]:[],0);O.aggfilterExpr.set("items",[]);O.aggfilterExpr.add(P?[P]:[],0);},children:[{scriptClass:"mstrmojo.CustomGroupEl",cssClass:"mstrmojo-qb-filterTreeBox",alias:"CEl",markupString:'<div id="{@id}" class="mstrmojo-onhoverparent mstrmojo-CustomGroupEl {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-cond-details" {@cssClass}"><div class="mstrmojo-qb-expr-tools {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"><br></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div></div></div>',markupMethods:{onstateChange:function(){this.detailsNode.style.display=this.state?"block":"none";}},markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},detailsNode:function(){return this.domNode.lastChild;},exprNode:function(){return this.domNode.lastChild.children[2];},expr2Node:function(){return this.domNode.lastChild.children[4];},exprToolsNode:function(){return this.domNode.lastChild.firstChild;}},parent:this.parent,children:[{scriptClass:"mstrmojo.qb.FilterTree",slot:"exprNode",alias:"filterExpr",onexprclick:function A(O){L(O,false);}},{scriptClass:"mstrmojo.qb.FilterTree",slot:"expr2Node",alias:"aggfilterExpr",onexprclick:function A(O){L(O,false);}},{scriptClass:"mstrmojo.Box",slot:"exprToolsNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-CGE-addCondition",text:mstrmojo.desc(1994,"Add Condition"),onclick:function(){L(this.parent.parent,true);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5186,"Delete All"),cssClass:"mstrmojo-qb-deleteAll",onclick:function(){var O=this.parent.parent;F(O.filterExpr);F(O.aggfilterExpr);}}]}],state:true}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function K(){var P=this.parent.parent,O=P.CEl;mstrApp.getRootController().updateFilters(B(O.filterExpr.items[0]),B(O.aggfilterExpr.items[0]));P.set("visible",false);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(3416,"Cancel"),onclick:function K(){var Q=this.parent.parent,P=Q.CEl,R=Q.data,T=1000;if(D.equals(B(P.filterExpr.items[0]),R.where)&&D.equals(B(P.aggfilterExpr.items[0]),R.having)){Q.set("visible",false);return ;}var O=mstrmojo.Button.newInteractiveButton;mstrmojo.confirm(E(12367,"All your changes on the filter will be lost. Do you want to exit?"),null,{buttons:[O(mstrmojo.desc(1442,"OK"),function S(){Q.set("visible",false);},null,{onRender:function(){if(mstrApp.isCloudPro){mstrmojo.css.addClass(this.domNode,"cloud");}else{mstrmojo.css.addClass(this.domNode,["mstrmojo-di-button","mstrmojo-WebButton","hot"]);}}}),O(mstrmojo.desc(3416,"Cancel"),mstrmojo.emptyFn,null,{onRender:function(){if(mstrApp.isCloudPro){mstrmojo.css.addClass(this.domNode,"cloud cancel");}else{mstrmojo.css.addClass(this.domNode,["mstrmojo-di-button","mstrmojo-WebButton"]);}}})],title:E(12368,"Lose Your Changes?"),zIndex:T});}}],getMovingHandle:function J(){return this.children[0].domNode;},andOrPopupRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-CGE-andOrPopup mstrmojo-ConditionWalk",cssText:"width: auto;",contentNodeCssClass:"mstrmojo-balloon",left:"250px",top:"15px",slot:"containerNode",autoClose:true,showTitle:false,draggable:false,openEffect:null,closeEffect:null,onOpen:function(){var O=this.condition,R=O&&O.data&&O.data.not,T=O&&O.parent,P=T&&T.data,Q=(P&&P.fn)+(R?21:0),S=this.list;S.opening=true;S.set("selectedItem",isNaN(Q)?null:{did:Q});S.opening=false;this.curtainNode.style.position="fixed";},children:[{scriptClass:"mstrmojo.Dial",cssClass:"mstrmojo-CGE-andOrDial",alias:"list",itemMarkup:'<div class="dial-item {@css}">{@n}</div>',itemIdField:"did",items:[{did:19,n:H[19]},{did:20,n:H[20]},{did:19+21,n:H["19_21"]},{did:20+21,n:H["20_21"]}],onchange:function(){if(this.opening){return ;}var P=this.parent,O=P.condition,U=this.selectedItem,T=U&&U.did,S=T>21?true:null,R=T-(S?21:0);P.close();var Q=O&&O.parent;if(Q&&Q.data&&Q.data.et===M.ET.ANDOR){Q.edit(O,R,S);}else{var V=O&&O.data;if(V&&(V.not!==S)){V.not=S;O.paint();}}}}]},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onTab:function(P){if(this.onEnter){this.onEnter();}var O=N.shiftKey(P.hWin,P.e)?this.prevTab:this.nextTab;if(O&&O.onclick){O.onclick();}},onblur:function(){if(this.onEnter){this.onEnter();}},onEsc:function(){if(this.onCancel){this.onCancel();}this.parent.close({cancel:true});}}],onOpen:function(){var P=this.txt,O=this.txtConfig;D.forEach(O,function(Q){P.set(Q,O[Q]);});P.focus();},onClose:function(O){if(!O||(!O.cancel&&!O.enter)){this.txt.onEnter();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.SaveAsEditor","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(1442,12376,12377,12908);var E=mstrmojo.array,G=mstrmojo.DI.DIConstants,B=mstrmojo.desc;var C=0,D=-1,A=-2;mstrmojo.DI.ui.dialogs.DISaveAsDialog=mstrmojo.declare(mstrmojo.SaveAsEditor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DISaveAsDialog",cssClass:"mstrmojo-SaveAsEditor",typeDesc:"Cube",browsableTypes:"776,779,8",zIndex:1000,folderLinksContextId:28,onRender:function H(){this.ob.set("scrollableIncFetch",true);},validateInput:function(N,P){var M=mstrApp.getRootController(),J=this.contPanel,L=this.ob.currentFolder,Q=J.name.value,O=this,R=C,K;this.name=J.name.value;this.desc=J.desc.value;this.folderID=L.did;this.saveAsOverwrite=!!N;if(!this.name){R=D;P(R);return ;}E.forEach(L.items,function(S){if(S.t===3&&S.n.toUpperCase()===Q.toUpperCase()){R=A;return false;}});if(R!==C){P(R);return ;}K={rootFolderID:L.did,searchPattern:Q,objectType:O.browsableTypes,nameWildcards:0};if(this.ob.enableQuickSearch){K.quickSearch=this.ob.enableQuickSearch;}M.dataService.searchFolderContents({success:function(S){if(S&&S.items){E.forEach(S.items,function(T){if(T.t===3&&T.n.toUpperCase()===Q.toUpperCase()){R=A;return false;}});}P(R);},failure:function(S){M.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,S.message);}},K);},saveCube:function I(){var O=mstrApp.getRootController(),N=O.getModel();var L=this.saveParams||{};L.folderID=this.folderID;L.objDesc=this.desc||"";L.objName=this.name||"";L.saveAsOverwrite=this.saveAsOverwrite;var K=this.saveAsCallback();K.parent=this;var P=N.isDirectDataAccess?true:false;mstrApp.serverRequest(L,K,{showProgress:P});this.close();var M,Q=[],R=N.importSources;for(M in R){var J=R[M].sourceInfo.name;R[M].status="0";Q.push({n:J,complete:false});}N.cubeName=this.name||"";if(!N.isDirectDataAccess){N.raiseEvent({name:"PublishStatusUpdate"});O.showDialog(G.dialogType.publishStatusDialog,{model:N,zIndex:mstrApp.getRootController().dialogController.getNextZIndex()});}O.enableFinishButton(false);},saveAs:function(J){var K=this;this.validateInput(J,function(L){switch(L){case C:K.saveCube();break;case D:mstrmojo.alert(B(12376,"Please enter a valid cube name"));break;case A:var M=B(12377,"Saving cube with the same name");mstrApp.getRootController().displayWarning(mstrmojo.desc(12908,"The name #### already exists. Do you want to replace the existing one?").replace("####",this.name),M,function(){K.saveCube();});break;}});},getObjectPath:function F(){var L=this.ob.currentFolder,M=this.name,K="\\",N="",J;if(L){J=L.anc&&L.anc.items;while(J[0].n!==L.n&&J[0].n!=="Shared Reports"&&J[0].n!=="My Reports"){J=J[0].items;}while(J){N=N+J[0].n+K;J=J[0].items;}}N+=M;return N;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.ui.dialogs.DISaveAsDialog");mstrmojo.requiresDescs(1442,3415,3416,12376,12377,12925);var D=mstrmojo.desc;var B;mstrmojo.qb.QBHelpers={showSaveAsDialog:function A(J,I){var E=0,H=-1,F=-2;var G;G=B&&mstrmojo.all[B];if(!G){G=new mstrmojo.DI.ui.dialogs.DISaveAsDialog();B=G.id;}G.set("name",I.name||"");G.set("desc",I.desc||"");G.set("saveParams",{});G.set("retainPrevFolder",true);if(mstrApp.cubeSaveFolderId){G.set("rootFolderID",mstrApp.cubeSaveFolderId);}G.saveAs=function(K){var L=G.zIndex+2;this.validateInput(K,function(M){var N={folderID:G.folderID,objDesc:G.desc||"",objName:G.name||"",saveAsOverwrite:G.saveAsOverwrite,objPath:G.getObjectPath()};switch(M){case E:G.close();J.onOK(N);break;case H:mstrmojo.alert(D(12376,"Please enter a valid cube name"),null,"",L);break;case F:mstrmojo.confirm(mstrmojo.desc(12925,"The name ## already exists. Do you want to replace the existing one?").replace("##",this.name),{confirmBtn:{fn:function(){G.close();J.onOK(N);}}},{title:D(12377,"Saving cube with the same name"),zIndex:L});break;}});};G.open();return G;},clone:function C(I){if(!I){return null;}var K;if(I.constructor===Array){K=I.concat();var J=K[0];if(J&&typeof J==="object"){var E=K.length,H;for(H=0;H<E;H++){K[H]=this.clone(I[H]);}}}else{K={};var G,F;for(G in I){if(G==="parent"){continue;}F=I[G];if(F&&typeof F==="object"){K[G]=this.clone(F);}else{K[G]=F;}}}return K;}};}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.Box","mstrmojo.qb.FilterValueEditor","mstrmojo.qb.QBTableLinker","mstrmojo.qb.ConditionEditor","mstrmojo.qb.DBTable","mstrmojo.ui.menus.Menu","mstrmojo.qb.DBTableRowMenu");mstrmojo.requiresDescs(221,520,521,522,523,524,525,526,612,629,686,687,688,696,746,1442,2122,2123,2125,2127,2131,2151,2219,2220,2784,2785,2786,4449,5893,8571,9126,9127,9128,9129,9640,9641,9913,9938,9939,9940,9941,12736,12928);var Y=mstrmojo.dom,L=mstrmojo.array,K="addTable",X="264px",Z=22;var N=[0,"tick",16,"mix"];var H=[{did:"Delete",n:mstrmojo.desc(629,"Delete")},{did:-1,n:"-"},{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:"2",n:mstrmojo.desc(9941,"Right Outer Join")},{did:"3",n:mstrmojo.desc(9641,"Outer Join")},{did:-1,n:"-"},{did:"More Options",n:mstrmojo.desc(9126,"More Options")}];var F=[{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:"2",n:mstrmojo.desc(9941,"Right Outer Join")},{did:"3",n:mstrmojo.desc(9641,"Outer Join")}];var P=[{n:"=",dssid:"0"},{n:">",dssid:"1"},{n:">=",dssid:"2"},{n:"<",dssid:"3"},{n:"<=",dssid:"4"},{n:"<>",dssid:"5"}];var c=[{did:"-2",n:mstrmojo.desc(4449,"Expression")},{did:-1,n:"-"},{did:2219,n:mstrmojo.desc(2219,"In list")},{did:2220,n:mstrmojo.desc(2220,"Not in list")},{did:-1,n:"-"},{did:520,n:mstrmojo.desc(520,"Exactly")},{did:612,n:mstrmojo.desc(612,"Not Exactly")},{did:-1,n:"-"},{did:521,n:mstrmojo.desc(521,"Greater than")},{did:523,n:mstrmojo.desc(523,"Less than")},{did:522,n:mstrmojo.desc(522,"Greater than equal")},{did:524,n:mstrmojo.desc(524,"Less than equal")},{did:-1,n:"-"},{did:"-5",n:mstrmojo.desc(9939,"Strings"),fns:[{did:525,n:mstrmojo.desc(525,"Like")},{did:526,n:mstrmojo.desc(526,"Not like")},{did:686,n:mstrmojo.desc(686,"Contains")},{did:2784,n:mstrmojo.desc(2784,"Does not contain")},{did:687,n:mstrmojo.desc(687,"Begins with")},{did:2785,n:mstrmojo.desc(2785,"Does not begin with")},{did:688,n:mstrmojo.desc(688,"Ends with")},{did:2786,n:mstrmojo.desc(2786,"Does not end with")}]},{did:-1,n:"-"},{did:"Between",n:mstrmojo.desc(696,"Between")},{did:"Not between",n:mstrmojo.desc(746,"Not between")}];var a=[{did:"0",n:mstrmojo.desc(4449,"Expression")},{did:"1",n:mstrmojo.desc(9913,"Aggregation Function"),fns:[{did:"-6",n:mstrmojo.desc(2131,"Sum"),idx:1},{did:"-6",n:mstrmojo.desc(2122,"Average"),idx:2},{did:"-6",n:mstrmojo.desc(2127,"Minimum"),idx:3},{did:"-6",n:mstrmojo.desc(2125,"Maximum"),idx:4},{did:"-6",n:mstrmojo.desc(2123,"Count"),idx:5},{did:"-6",n:mstrmojo.desc(9938,"Count Distinct"),idx:6}]},{did:"2",n:mstrmojo.desc(2151,"Filter"),fns:c}];function T(j){return Z*(j?(j+2):1);}function M(p){var k=mstrmojo.all.QBuilderModel,m,n=[],o;if(!p.srcData){m=k.gettIndex(p.id);for(var l=1,j=p.Rows.children.length;l<j;l++){o=p.Rows.children[l];if(o.visible){n.push(o);}}}else{n.push(p);m=k.gettIndex(p.parent.parent.id);}k.addSelectedColumns(n,m,null,{success:function(){var t=0,q=n.length,r;for(t;t<q;t++){r=n[t];r.updateState(1);r.count++;}}});}var B=0,J=1,h=3;function f(j,l,n){var o="mstr-qb-table-moreCM",m=mstrmojo.all[o];if(!m){m=new mstrmojo.MenuButton({id:o,cmCssClass:"mstrmojo-CXM",alias:"fctmenu",itemChildrenField:"fns",itemIdField:"did",itemField:"n",iconClass:"mstrmojo-qb-ListIcon div",cm:a,domSrc:l,obj:n,dynamicUpdate:true,getMenuPosition:function k(){var p=mstrmojo.dom.position(this.domSrc,true);return{x:Math.round(p.x),y:Math.round(p.y+p.h)};},executeCommand:function(AJ){var AC=this.obj,u=mstrmojo.all.QBuilderModel,t=AC.parent.parent,AI=u.gettIndex(AC.srcID);switch(AJ.did){case"0":mstrApp.getRootController().openExpressionEditor({type:B,w:AC,tkn:AC.expr});break;case"-2":mstrApp.getRootController().openExpressionEditor({n:mstrmojo.desc(5893,"New Condition"),w:AC,tkn:AC.expr,callbacks:{success:function AB(AM){var w=AM.mi;mstrApp.getRootController().addNewFilter({et:"*",expr:w.items,n:AM.expr,sqltp:w.exp.sqltp});}}});break;case"-6":var p=u.selectedClns,AF=p.length,AH=new Array(),x=AC.parent.children,AG=t.selectedIndex;AH.push(AC);var AE={success:function(){var AO=0,AM=AH.length,AN;for(AO;AO<AM;AO++){AN=AH[AO];if(AN.state==0||AN.state==2){AN.state++;AN.images[1]=AN.img[AN.state];AN.render();}AN.count++;}},failure:function(){}};u.addSelectedColumns(AH,AI,AJ.idx,AE);break;default:var r=this.obj,AD=r.dt.tp,z={14:true,15:true,16:true},AK={30:true},AA,AL,q;switch(AJ.did){case"Between":case"Not between":q=2;break;default:q=1;}AL="mstr-qb-fve";AA=mstrmojo.all[AL]||(new mstrmojo.qb.FilterValueEditor({id:AL}));AA.n=AJ.n;AA.operatorID=AJ.did;AA.column=r.oriexpr;AA.isDateTime=z[AD];AA.isBigDecimal=AK[AD];AA.paraNum=q;AA.open();}}});m.render();}else{m.set("domSrc",l);m.set("obj",n);}m.showContextMenu();m.onContextMenuClose=function(){l.style.visibility="inherit";};}function d(k,l){var n={success:function(){var p,o;p=k.menuHelper;if(!p){p=k.menuHelper=new mstrmojo.qb.DBTableRowMenu();}p.tableRow=k;o=p.getMenuConfig();o.hostId=k.id;o.hostElement=k.domNode;if(l.position){o.position=l.position;}o.isHostedWithin=false;k.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:o}));}},j=mstrApp.getRootController();if(j.getFunctionList()){n.success();return ;}j.model.getFunctions(false,{success:function m(){n.success();}},{showWait:true});}function G(n,m,l){var j=mstrmojo.all.QBuilderModel,o=Y.position(l.domNode),r=n.clientX,p=n.clientY,q=j.getTouchValue(r-o.x,p-o.y),k=Y.position(l.domNode,true);if(q){j.selLink=q;m.drawMarker();e.call(this,n,q,m,{x:r+(k.x-o.x),y:p+(k.y-o.y)});}else{j.selLink=null;m.clearHighLightCanvas();}}var S={};function e(u,k,n,r){var l=mstrApp.diCurrentZIndex,m=l>999?l+1:999,q=this,t=q.joinMenuOption.mappingKey,j=q.joinMenuOption.menuItems,o=S[t];if(!o){o=S[t]=new mstrmojo.MenuButton({cmCssClass:"mstrmojo-CXM",cm:j,zIndex:m,itemChildrenField:"fns",itemIdField:"did",itemField:"n",dynamicUpdate:true,obj:k,pos:r,linker:n,getMenuPosition:function p(){return this.pos;},queryChecked:function(z){switch(z.did){case"Delete":case -1:case"More Options":return false;default:var w=mstrmojo.all.QBuilderModel;var x=w.selLink[0];return(w.joinsInfo[x].jt==z.did);}},executeCommand:function(AB){var AC=this.linker;var x=mstrmojo.all.QBuilderModel;var AA=this.obj,z=AB.did;switch(z){case"Delete":var w={success:function(){x.selLink=null;AC.drawLinks();},failure:function(){}};x.removeLink(AA[1],AA[0],w);break;case"0":case"1":case"2":case"3":x.editJoin({joinID:AA[0],linkID:AA[1],type:z});break;case"More Options":R.call(q,u,AA,AC);break;default:break;}}});}else{o.set("pos",r);o.set("obj",k);o.set("linker",n);}o.showContextMenu();}var U={};function R(t,q,m,p){var w=this.joinMenuOption.joinItems,r=this.joinMenuOption.mappingKey,n=U[r],l=this.joinMenuOption.joinOperators;if(!n){n=U[r]=new mstrmojo.Editor({slink:q,linker:m,title:mstrmojo.desc(9127,"Join Options"),help:(mstrApp.helpTopics&&mstrApp.helpTopics.tableJoin)||"join_options_dialog_box.htm",zIndex:100,cssText:"width:350px;",children:[{scriptClass:"mstrmojo.Label",cssText:"font-weight:bold; width:100%; padding: 5px;",text:mstrmojo.desc(9128,"Join")},{scriptClass:"mstrmojo.RadioList",alias:"radiolist",cssText:"padding-left:25px;",itemCssClass:"mstrmojo-QB-radiolist-item",items:w},{scriptClass:"mstrmojo.Label",cssText:"font-weight:bold; width:100%; padding-left: 5px;",text:mstrmojo.desc(9129,"Join Operator")},{scriptClass:"mstrmojo.Label",cssText:"padding-left:100px;",bindings:{text:"this.parent.srcText"}},{scriptClass:"mstrmojo.HBox",alias:"jop",cssText:"position:relative;left:100px;",children:[{scriptClass:"mstrmojo.Pulldown",items:l,popupToBody:true}]},{scriptClass:"mstrmojo.Label",cssText:"padding-left:100px;",bindings:{text:"this.parent.tgtText"}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),onclick:function(x){var AF=this.parent.parent;var z=mstrmojo.all.QBuilderModel,AD=AF.radiolist.selectedItem.did,AC=AF.slink[1],AA=AF.slink[0],AB=AF.jop.children[0].selectedItem,AE=z.brackets(AF.srcText)+AB.n+z.brackets(AF.tgtText);z.editJoin({joinID:AA,linkID:AC,type:AD,exp:AE,op:AB.dssid});if(AF.onOK){AF.onOK();}AF.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(x){var z=this.parent.parent;if(z.onCancel){z.onCancel();}z.close();}}]}]});}else{n.set("slink",q);n.set("linker",m);}var j=mstrmojo.all.QBuilderModel,u=j.joinsInfo[q[0]].links[q[1]],k=u.srcw.oriexpr,o=u.tgtw.oriexpr;n.set("srcText",k);n.set("tgtText",o);n.radiolist.set("selectedIndex",parseInt(j.joinsInfo[q[0]].jt));n.jop.children[0].set("value",u.op||"0");n.open();}function C(m,n,q,p,l){var j=mstrmojo.all.QBuilderModel;var w=new mstrmojo.qb.DBTable({scriptClass:"mstrmojo.qb.DBTable",cssText:"opacity:0.3;filter:alpha(opacity=30);left:0px;top:0px;width:180px;height:"+n+"px;",title:l,visible:false,noCheckBox:true});w.container=m.parent;w.selectedIndex=new Array();var t=j.gettIndex(w.id);m.addChildren([w]);w.maxHeight=w.editorNode.clientHeight;w.maxWidth=Math.max(w.Rows.domNode.clientWidth,w.titlebarNode.clientWidth);if(w.maxHeight>parseInt(X)){w.set("height",X);}var k=q+"px",r=p+"px",z=q+w.editorNode.clientWidth,o=p+w.editorNode.clientHeight,u=w.editorNode.style;u.left=k;u.top=r;u.width=w.titlebarNode.clientWidth+"px";w.left=k;w.top=r;return w;}function E(n){var m,l,k=0,p,o=20,j;L.forEach(n,function(q){j=mstrmojo.all[q];l=parseInt(j.left)+parseInt(j.editorNode.style.width);if(l>k){k=l;m=j;}});p=Math.ceil(k/200)*200+20;return{left:p,top:o};}function Q(u,AP){var AM=AP.h,t=AP.w,r=AP.x,q=AP.y,l=AP.tbn,AN=AP.did,z=AP.dbtbn,AA=AP.ns,AJ=AP.readOnly,n=mstrmojo.all.QBuilderModel,AR;var AB=T(u.length);AR=E(n.dbtables);r=AR.left;q=AR.top;var AE=new mstrmojo.qb.DBTable({scriptClass:"mstrmojo.qb.DBTable",cssText:"position:absolute;left:0px;top:0px;width:"+(t?t:180)+"px;height:"+AB+"px;",left:r+"px",top:q+"px",readOnly:AJ,title:l,visible:true,readOnly:AJ,noCheckBox:true,onClose:function(){var x=this;var w={success:function(){x.parent.parent.linker.drawLinks();},failure:function(){}};n.removeTable(this,w);},onRender:function(){if(AJ&&this.closeNode){this.closeNode.title=mstrmojo.desc(12928,"Cannot delete this table since it is being used by the dashboard");mstrmojo.css.addClass(this.closeNode,"readonly");}}});n.upttIndex(l,z,AE.id,true,AN,AA);n.raiseEvent({name:"refreshTables",items:n.dbtables.slice(0)});if(AN){n.uiids[AN]=AE.id;}AE.model=n;AE.container=this.parent;AE.selectedIndex=new Array();var AO=n.gettIndex(AE.id);var o,p,AD,AI,AL=u.length;if(AL){AE.addRow(('* <span class = "all"> '+mstrmojo.desc(12736,"Add all columns")+"</span>"),0,["0","0"],"");o=AE.Rows.children[0];o.draggable=false;o.dropZone=false;o.allowDrop=false;o.rIndex=-1;o.table=AE;o.ondblclick=function(w){if(mstrmojo.dom.eventTarget(w.hWin,w.e).className.indexOf("add")<0){M(AE);}};o.oncontextmenu=function AK(w){Y.preventDefault(window,w.e);};}for(AI=0;AI<AL;AI++){p=u[AI].cln;AD=u[AI].state?["0",N[u[AI].state]]:["0","0"];AE.addRow(u[AI].cln,0,AD,"");AE.selectedIndex[AI]=false;o=AE.Rows.children[AI+1];o.cssClass=(AI%2)?"odd":"even";o.srcTable=l;o.srcID=AE.id;o.srcData=u[AI];o.oriexpr=u[AI].exp?u[AI].exp:(l+"."+u[AI].cln);o.expr=[{isNew:true,v:n.brackets(o.oriexpr),oi:{tIndex:AO,rIndex:AI+1,t:"26",n:o.oriexpr}}];o.img=N;o.enableExpr=!u[AI].hideExpr;o.state=!u[AI].state?0:u[AI].state;n.tables[AE.id].rows[o.id]=o;o.rIndex=AI;o.count=!u[AI].count?0:u[AI].count;o.dt=u[AI].dt;o.updateState=function(x){if(this.count<=0){this.state=this.state&2;}this.state=this.state|x;var w=(this.state&1)+(this.state&2);this.images[1]=this.img[w];this.render();};o.ondblclick=function(w){if(mstrmojo.dom.eventTarget(w.hWin,w.e).className.indexOf("add")<0){M(this);}};o.oncontextmenu=function AK(w){Y.preventDefault(window,w.e);d(this,{position:Y.getMousePosition(w.e,window)});};if(AN){n.uiids[AN+u[AI].did]=o.id;}}this.addChildren([AE]);AE.maxHeight=AB;var AS=AE.Rows.domNode.clientWidth;mstrmojo.array.forEach(AE.Rows.domNode.children,function(w){AS=Math.max(AS,w.firstChild.children[1].clientWidth+30);});AE.maxWidth=Math.max(AS,AE.titlebarNode.clientWidth);if(AM<AB){AE.set("height",AM+"px");}var AQ=r+"px",AG=q+"px",AH=r+AE.editorNode.clientWidth,k=q+AE.editorNode.clientHeight+10,AF=AE.editorNode.style,j=this.parent,m=this.domNode.style,AC=j.linker;AE.titlebarNode.style.width=parseInt(AF.width,10)-56+"px";AE.titleNode.style.width=AE.titlebarNode.style.width;AM=parseInt(j.domNode.clientHeight);t=parseInt(j.domNode.clientWidth);if(t<AH&&j.maxWidth<AH){j.maxWidth=AH;j.canvasbox.set("width",j.maxWidth+"px");j.linker.set("width",j.maxWidth+"px");n.linkerNeedRender=true;}if(AM<k&&j.maxHeight<k){j.maxHeight=k;j.canvasbox.set("height",j.maxHeight+"px");j.linker.set("height",j.maxHeight+"px");n.linkerNeedRender=true;}j.domNode.style["overflow-x"]=(j.maxWidth>t)?"auto":"hidden";j.domNode.style["overflow-y"]=(j.maxHeight>AM)?"auto":"hidden";return AE;}mstrmojo.qb.QBTableView=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.QBTableView",joinMenuOption:{menuItems:H,joinItems:F,mappingKey:"database",joinOperators:P},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},init:function W(l){this._super(l);var o={},k=o[this.id]={},n=this;k.joinChanged=k.JoinsLoaded=k.JoinsAdded=function j(){n.scrollBox.linker.drawLinks();};k.BindingTableLoaded=function m(p){n.scrollBox.canvasbox.displayBindingTable(p);};k.refreshTables=n.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(o);},onTableRefresh:function V(j){var k=j.items.length>0;var l=this.scrollBox;mstrmojo.css.toggleClass(l.hintbox.domNode,["off"],k);mstrmojo.css.toggleClass(l.domNode,["active"],k);if(!k){mstrApp.getRootController().toggleDataPreview(false);}},children:[{scriptClass:"mstrmojo.Box",alias:"scrollBox",cssClass:"mstrmojo-qb-tableview-box",maxWidth:0,maxHeight:0,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout></div>',onmouseover:function(){var j=parseInt(this.domNode.clientHeight),l=parseInt(this.domNode.clientWidth),k=this.domNode.style;if(l<this.maxWidth){k.overflowX="auto";}else{k.overflowX="hidden";this.domNode.scrollLeft=0;}if(j<this.maxHeight){k.overflowY="auto";}else{k.overflowY="hidden";this.domNode.scrollTop=0;}},onmouseout:function(){this.domNode.style.overflow="hidden";},children:[{scriptClass:"mstrmojo.Box",alias:"hintbox",markupString:'<div class="mstrmojo-qb-EmptyHint">{@emptyHint}</div>',cssDisplay:"",emptyHint:mstrmojo.desc(13246,"Drag and Drop table(s) from any database connections")},{scriptClass:"mstrmojo.qb.QBTableLinker",alias:"linker",cssClass:"mstrmojo-qb-tableview-linker",dropZone:true,allowDrop:function D(j){return(j.action===K);},ondrop:function b(j){this.parent.canvasbox.ondrop(j);mstrmojo.css.removeClass(this.domNode,"dragging");},ondragenter:function O(j){this.parent.canvasbox.ondragenter(j);mstrmojo.css.addClass(this.parent.domNode,"dragging");},ondragleave:function O(j){this.parent.canvasbox.ondragleave(j);mstrmojo.css.removeClass(this.domNode,"dragging");},onclick:function g(k){var j=this.parent.parent;G.call(j,k.e,this,this);}},{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousemove> </div>',cssClass:"mstrmojo-qb-tableview-canvas",alias:"canvasbox",dropZone:true,allowDrop:function D(j){return(j.action===K);},onclick:function g(k){var j=this.parent.parent;G.call(j,k.e,this.parent.linker,this);},displayBindingTable:function(r){var u=r.value,k=0,o=20,q=20,w=0,j=0,p,z,l=0;for(var m=0,n=u.length;m<n;m++){z=u[m];p=z.pos;if(p){q=p.t;k=p.l;w=p.h;j=p.w;}else{w=T(z.cs.length);k+=l+o;}z.h=w;z.w=j;z.x=k;z.y=q;var x=Q.call(this,z.cs,z);l=x.editorNode.clientWidth;}},updateTableName:function(o){var n=o.tid;if(n&&mstrmojo.all[n]){var l=mstrmojo.all.QBuilderModel,m=mstrmojo.all[n],k=m.Rows.children,p,j=o.value;mstrmojo.array.forEach(k,function(r,q){if(q>0){r.oriexpr=j+"."+r.srcData.cln;r.expr[0].v=l.brackets(r.oriexpr);r.expr[0].n=r.oriexpr;l.tables[n].rows[r.id]=r;}});}},postCreate:function(){var j=mstrmojo.all.QBuilderModel;if(!j){return ;}j.attachEventListener("TableAdded",this.id,"drawTable");j.attachEventListener("TableNameChanged",this.id,"updateTableName");},ondrop:function b(j){var q=j.action,m=j.src;if(m&&m.data){var n=m.data;if(q===K){var l=j.tgt.pos,o=mstrmojo.dom.position(j.tgt.node),r=l.x-o.x;y=l.y-o.y;var k=m.widget.dataHelper,p=0;mstrmojo.array.forEach(n,function(u){k.fetch(u,{success:function t(w){u.x=r+p*15;u.y=y+p*15;p++;mstrApp.getRootController().addTable(u,w.items);}});});}}mstrmojo.css.removeClass(this.parent.domNode,"dragging");},getAvatarIconClass:function I(j){return"enabled";},ondragenter:function O(j){var k=j.src.widget;if(k&&k.toggleAvatarClass&&this.allowDrop(j)){k.toggleAvatarClass(this.getAvatarIconClass(j),true);}mstrmojo.css.addClass(this.parent.domNode,"dragging");},ondragleave:function A(j){var k=j.src.widget;if(k&&k.toggleAvatarClass&&this.allowDrop(j)){k.toggleAvatarClass(this.getAvatarIconClass(j),false);}mstrmojo.css.removeClass(this.parent.domNode,"dragging");},drawTable:function(j){var m=j.data,l=j.table,k=T(m.length);k=(k>parseInt(X,10))?parseInt(X,10):k;l.h=k;l.w=null;Q.call(this,m,l);}}]}],onheightChange:function(l){var k=parseInt(l.value)-3;this.scrollBox.set("height",k+"px");var j=this.scrollBox.canvasbox;if((!j.height)||(j.domNode&&k>j.domNode.clientHeight)){j.set("height",k+"px");this.scrollBox.linker.set("height",k);}if(this.scrollBox.domNode){this.scrollBox.hintbox.domNode.style.lineHeight=k+100+"px";this.scrollBox.domNode.style.height=this.scrollBox.height;if(parseInt(this.scrollBox.height)<this.scrollBox.maxHeight){this.scrollBox.linker.set("height",parseInt(this.scrollBox.maxHeight));this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();this.scrollBox.canvasbox.domNode.style.height=parseInt(this.scrollBox.maxHeight)+"px";}else{this.scrollBox.linker.set("height",k);this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();j.domNode.style.height=k+"px";j.height=j.domNode.style.height;}}},onwidthChange:function(l){var j=parseInt(l.value)-2;this.scrollBox.set("width",j+"px");var k=this.scrollBox.canvasbox;if((!k.width)||(k.domNode&&j>k.domNode.clientWidth)){k.set("width",j+"px");this.scrollBox.linker.set("width",j);}if(this.scrollBox.domNode){this.scrollBox.domNode.style.width=this.scrollBox.width;if(parseInt(this.scrollBox.width)<this.scrollBox.maxWidth){this.scrollBox.linker.set("width",parseInt(this.scrollBox.maxWidth));this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();this.scrollBox.canvasbox.domNode.style.width=parseInt(this.scrollBox.maxWidth)+"px";}else{this.scrollBox.linker.set("width",j);this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();k.domNode.style.width=j+"px";k.width=k.domNode.style.width;}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper","mstrmojo.ui.ScrollableSuggestionList");var H=mstrmojo.expr,O=mstrmojo.Enum_OIB_States,J=mstrmojo.ME._MetricEditorHelper,R=mstrmojo.dom;mstrmojo.ME.ObjectInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{cssClass:"",autoSelect:false,suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",suggestionPopupCssClss:"mstrmojo-ME-ObjectInputBox-suggest",blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,useKeyDelay:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,emptyText:"Search for an object",showEmptyItem:false,noEditButton:true,browseItemVisible:true,click2edit:true,showSuggestionOnEdit:false,tabNavigable:true,obCfg:{},dynamicVerify:true,init:function P(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-ObjectInputBox");if(this.isDME){this.browseItemVisible=!this.isDME;this.suggestCount=this.isDME?1000:mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=1000;this.dynamicVerify=false;}},item2textCss:function D(W){if(this.isDME){return mstrmojo.ME._MetricEditorHelper.item2textCss(W);}var E=this._super(W)||{1:"f",4:"m",12:"a",13:"fc",43:"tr","-1":"rl","-99":"br"}[W.t]||"";return E?" icn "+E:"";},itemFunction:function B(X,E,W,Y){X[W.itemIdField]=W.nextId();var Z=Y||mstrmojo.ME.ObjectItem,a=new Z({parent:W,itemField:W.itemField,cssClass:W.item2textCss(X),data:X,bindings:{isFull:"this.parent.isFull"},onisFullChange:function(){if(this.hasRendered){this.updateButtonsVisibility();}}});W.attachEventListener4ItemWidget(a,W);return a;},getActiveItem:function M(){var E=this.editingIdx,X,W;if(E>-1){X=this.ctxtBuilder.itemWidgets[E];W=X&&X.data;}return W;},showObjectBrowser:function(E){this.set("suggestTarget",E);this.handleSuggestionItemSelect({t:-99},this.obCfg);},hideItemWidgetBrowseButton:function S(){return false;},hidePulldownButton:function G(){return true;},hideDelButton:function A(){return false;},dtp:0,verifyObject:function C(W,E){if(!this.dynamicVerify){return O.VALID;}var Y=E.data;var X=parseInt(this.dtp,10);switch(X){case -1:case -2:case -4:case -5:case -6:if(Y.t===-1||J.isDimty(W,X===-1)){return O.VALID;}if(this.dynamicVerify){return this._super(W,E);}return Y.did?O.VALID:O.INVALID;case 1:case 2:case 3:case 4:case 5:case 6:case 7:if(Y.t<0){return O.VALID;}if(/^\d{1,}$/.test(mstrmojo.string.trim(W))||Y.did){return O.VALID;}if(this.dynamicVerify){return this._super(W,E);}return O.INVALID;default:return O.VALID;}},getItemsToFilterOut:function N(){return this.items;},updateSuggestion:function Q(E){var X=this.getActiveItem();var W=this.getItemsToFilterOut();E=mstrmojo.array.filter(E,function(a){var Z=a.did,Y=false,c;var b=function(d){mstrmojo.array.forEach(W,function(e){if(e!==X&&e.did===d){Y=true;return false;}});};b(Z);if(!Y){c=a;}return c;});if(this._super){this._super(E);}},nudge:function I(W){W.domNode.style.minWidth=this.suggestTarget.domNode.offsetWidth+(this.isDME?13:0)+"px";var X=R.position(W.domNode),Y=R.position(this.suggestTarget.domNode),E=R.windowDim();if(X.y+X.h>E.h){W.domNode.style.top=(Y.y-X.h-5)+"px";}}});mstrmojo.ME.ObjectItem=mstrmojo.declare(mstrmojo.ObjectItem,[mstrmojo._HasPopup],{markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode" tabindex="0" mstrAttach:click,focus><span class="mstrmojo-ObjectItem-text {@cssClass}"></span></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" placeholder="{@placeholderText}" mstrAttach:keyup,keydown/></div><div class="mstrmojo-ObjectItem-icons"><div class="mstrmojo-ObjectItem-down" onclick="mstrmojo.all[\'{@id}\'].showSuggestion(\'\')"></div><img class="mstrmojo-ObjectItem-browse" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1825,"Browse")+'" onclick="mstrmojo.all[\'{@id}\'].browse()"/><div class="mstrmojo-ObjectItem-opts" title="'+mstrmojo.desc(9598,"Level options")+'" onclick="mstrmojo.all[\'{@id}\'].options(arguments[0])" style="display:none;"></div><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])" style="display:none;"/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},pulldownButtonNode:function(){return this.domNode.lastChild.childNodes[0];},browseButtonNode:function(){return this.domNode.lastChild.childNodes[1];},optionButtonNode:function(){return this.domNode.lastChild.childNodes[2];},editButtonNode:function(){return this.domNode.lastChild.childNodes[3];},delButtonNode:function(){return this.domNode.lastChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},init:function P(E){this._super(E);this.placeholderText=this.parent.emptyText;},initState:function T(){var W=this.parent,X=this.data,E=X.state;if(W.dynamicVerify){return this._super();}if(typeof E==="undefined"){E=W.verifyObject(X[this.itemField],this);X.state=E;}return E;},updateButtonsVisibility:function F(){if(this._super){this._super();}if(this.parent.hidePulldownButton()){this.pulldownButtonNode.style.display="none";}if(this.parent.hideItemWidgetBrowseButton()){this.browseButtonNode.style.display="none";}this.optionButtonNode.style.display=this.data.state!==O.ADDING&&this.optionButtonVisible?"":"none";this.delButtonNode.style.display=this.data.state!==O.ADDING&&!this.parent.hideDelButton()&&!this.isFull?"":"none";},browse:function L(){this.set("state",this.data.state===O.ADDING?O.ADDING:O.EDITING);this.parent.showObjectBrowser(this);},click2edit:function K(){if(this.parent.click2edit){this.edit();}},onclick:function V(){this.click2edit();},onfocus:function U(){this.click2edit();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Button","mstrmojo.Editor","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper");mstrmojo.requiresDescs(12852);var J=mstrmojo.expr,A=mstrmojo.array,G=mstrmojo.hash,M=mstrmojo.ME._MetricEditorHelper,B=mstrmojo.ME.Enum.DYNAMIC_DIMTY,L=mstrmojo.ME.Enum.UI_DATA_TYPE,I=mstrmojo.ME.Enum.UI_OBJECT_TYPE,F=mstrmojo.ME.MetricToken.brackets;var K;function Q(){var E=mstrmojo.all[K];if(E&&E.onmetricModify){E.onmetricModify();}}function C(){var E=mstrmojo.all[K];if(E&&E.updateScrollbars){E.updateScrollbars();}}mstrmojo.ME.SortByInputList=mstrmojo.declare(mstrmojo.WidgetList,null,{makeObservable:true,isNewDef:true,isDME:false,init:function R(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-sortby");},preBuildRendering:function(){var E=this.items||[];if(this.isNewDef&&this.isDME){E.push(B.getAutomaticDimtyObject());}E.push({n:""});this.items=E;if(this._super){this._super();}},getTokens:function(){var W=this.items,E=W.length-1,V,a=[];if(E>0){a.push({v:"SortBy"});a.push({v:"=",isDelimiter:true});a.push({v:"(",isDelimiter:true});for(V=0;V<E;V++){var Y=W[V],Z=Y.selFrm,U,X=false;if(M.isDimty(Y.n)){U={v:Y.n};X=true;}else{if(/^@/.test(Y.did)){U={v:Y.did};X=true;}else{U={v:F(Y.n),oi:Y};}}if(Z&&(Y.t===J.TP.ATTR||(Y.t===J.TP.CONS&&Y.st===J.STP.NDE))){G.copy({v:F(Y.n)+"@"+F(Z.n),exv:Z.dssid,extp:8},U);}a.push(U);if(!X){if(!!Y.asc){a.push({v:"Desc",tp:259});}}if(V!==(E-1)){a.push({v:",",isDelimiter:true});}}a.push({v:")",isDelimiter:true});}return a;},itemFunction:function(X,E,U){return new mstrmojo.Box({cssClass:"mstrmojo-ME-sortby-item",alias:"sortByItem",parent:U,children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"sortByInput",cssClass:"mstrmojo-ME-ObjectInputBox-sortby",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),isDME:U.isDME,dtp:L.Sortby,maxObjectCount:1,folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(","),getCandidatesThroughTaskCall:function Z(c,b){c.objectType=J.TP.ATTR+","+J.TP.METRIC;c.rootFolderType=39;c.blockCount=c.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(c,b);},obCfg:{folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(",")},bindings:{candidates:"this.parent.parent.candidates"},postCreate:function(b){if(!b){this.set("items",X.did||X.dimty?[X]:null);}},onitemchange:function(){var d=this.getSelectedObjects()[0];if(!d||!d.did&&!d.n){return ;}X.selFrm=null;mstrmojo.hash.copy(d,X);var c=this.parent.formsPulldown;if(c){c.updateForms(d);}var b=this.parent.ascPulldown;if(b){b.set("visible",X.t===4||X.st===J.STP.NDE);}Q();},onadd:function V(){if(this.getSelectedObjects().length===0){return ;}if(this.parent===U.ctxtBuilder.itemWidgets[U.items.length-1]){U.add([{n:""}]);this.parent.del.set("visible",true);}},hidePulldownButton:function(){return !U.isDME;},hideDelButton:function(){return true;},hideItemWidgetBrowseButton:function(){return U.isDME;},getItemsToFilterOut:function(){return U.items;}},{scriptClass:"mstrmojo.Pulldown",alias:"formsPulldown",cssClass:"mstrmojo-ME-sortby-forms mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",defaultSelection:-1,bindings:{visible:function(){return this.items&&this.items.length>0;}},popupToBody:true,popupZIndex:100,postCreate:function(){this.retrieveDssForms(X);},retrieveDssForms:function W(d){var c=this,b=function(){var l=function(m){d.dssforms=m;c.set("items",d.dssforms);c.selectedIndex=-1;c.selectedItem=null;c.value=null;c.set("value",d.selFrm);};var j=c.parent.sortByInput.candidates,e=j&&j.items;if(d.did&&e){var h=A.find(e,"did",d.did);if(h>-1){var g=mstrmojo.hash.clone(e[h].fs);if(g){A.forEach(g,function(m){m[c.itemIdField]=m.fid;m[c.itemField]=m.fnm;});l(g);return ;}}}var k=function(m){if(m){var n=m.container;if(n&&n.dssforms){d.dssforms=n.dssforms;l(d.dssforms);}}},f=function(m){mstrmojo.alert(m.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:d.did,displayedForms:0},{success:k,failure:f});};switch(d.t){case J.TP.ATTR:b();break;case J.TP.CONS:if(d.st===J.STP.NDE){c.set("visible",false);}break;case J.TP.METRIC:c.set("visible",false);break;case I.Dimty:c.set("visible",false);break;}},updateForms:function Y(b){this.retrieveDssForms(b);},onvalueChange:function a(){if(this.selectedItem){X.selFrm=this.selectedItem;}if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Pulldown",alias:"ascPulldown",cssClass:"mstrmojo-ME-sortby-asc mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,visible:false,bindings:{value:function(){return this.parent.parent.items[E].asc;},visible:function(){var b=this.parent.sortByInput.getSelectedObjects()[0];return this.parent.formsPulldown.visible&&this.parent.formsPulldown.value||b.t===J.TP.METRIC||b.st===J.STP.NDE;}},onvalueChange:function(b){X.asc=this.value;if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Button",alias:"del",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),bindings:{visible:function(){var b=U.itemIndex(X);return this.parent.parent.items[b].did;}},onclick:function(){U.remove(U.items[U.itemIndex(X)]);Q();}}]});},onadd:function H(){C();},onremove:function S(){C();}});mstrmojo.ME._HasSortBy=mstrmojo.provide("mstrmojo.ME._HasSortBy",{_mixinName:"mstrmojo.ME._HasSortBy",ios:false,oniosChange:function P(E){this.sortByContainer.set("visible",E.value);},onOpen:function(){if(this._super){this._super();}K=this.id;var U=this.oi.tks,V=!U.met;var E=this.sortByContainer&&this.sortByContainer.sortByWidgetList;if(E){E.set("isNewDef",V);E.set("isDME",this.isDME);E.set("candidates",this.getCandidates4Sortby());E.set("items",this.getSortByDefFromTokens().items||[]);}},getCandidates4Sortby:function T(){var U=this.candidates,E;if(U&&!this.noCache){E=A.filter(U.items,function(V){return V.t===J.TP.ATTR||V.t===J.TP.METRIC||V.st===J.STP.NDE;});if(this.isDME){E=B.getItems("sortby").concat(E);}}return{items:E||[],isComplete:U&&U.isComplete};},getSortByWidget:function D(E){var W=this,V=[{scriptClass:"mstrmojo.ME.SortByInputList",alias:"sortByWidgetList",cssClass:"sortBy mstrmojo-ME-sortby",cssDisplay:"table-cell"}],U={scriptClass:"mstrmojo.Label",alias:"sortByLabel",cssClass:"mstrmojo-ME-SortBy-label",cssDisplay:"table-cell",text:mstrmojo.desc(12852,"Sort By")};if(E){V.unshift(U);}return{scriptClass:"mstrmojo.Box",alias:"sortByContainer",cssClass:"mstrmojo-ME-SortBy-Container",cssDisplay:"table-row",visible:W.ios,postCreate:function(){W.sortByContainer=this;this.editor=W;},getTokens:function(){return this.sortByWidgetList.getTokens();},children:V};},getSortByDefFromTokens:function N(){var a=this.oi.tks.items,W=a.length,b,Y,U,V,X={};for(V=0;V<W;V++){b=a[V];Y=b.tp;U=b.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(b.v)&&(b.v!=="("&&b.v!==")")||b.v==="&gt;"||b.v==="&lt;"){continue;}switch(U){case 131072:if(Y===302){b=a[++V];while(b){if(b.tp!==282){if(b.oi){b.oi.selFrm=b.exv;var Z=a[V+1];if(Z.v==="Desc"&&Z.tp===259){b.oi.asc=1;V++;}X.items=X.items||[];X.items.push(b.oi);}else{if(b.tp===64){X.items=X.items||[];var E=b.v+a[++V].v;b=a[V+1];if(b.tp===43||b.tp===45){E+=a[++V].v;E+=a[++V].v;}X.items.push(B.getDimtyObject(E,this.isDME));}}}if((b=a[++V])["v"]===")"){break;}}}}}return X;},getSortByDefAsTokens:function O(){return this.sortByContainer.getTokens();}});}());(function(){mstrmojo.requiresCls("mstrmojo.HTMLButton","mstrmojo.CheckBox","mstrmojo.Editor","mstrmojo.HBox","mstrmojo.Label","mstrmojo.RadioButton","mstrmojo.warehouse.dbroles.DBRoleDSNConnection","mstrmojo.warehouse.dbroles.DBRoleSetting","mstrmojo.warehouse.obj.DBRole");mstrmojo.requiresDescs(10070,12933,12949,11139,8513,1162,11134,10071,1442,221);var G=mstrmojo.array,M=mstrmojo.string,K=mstrmojo.warehouse.EnumObjectTypes,B="PWDHIDDEN123!@#",L=57;function J(){var P=this,N=this.dbrole.mdDBRole,Q=M.trim(P.container.txtname.text),R;if(Q!==N.n){if(!mstrApp.getRootController().validateName(K.DBROLE,Q,N.n)){return false;}}if(P.container.txtlogin.visible){R=P.container.txtlogin.isValid();if(!R.val){mstrmojo.alert(R.msg);return false;}}if(P.container.txtpwd.visible){R=P.container.txtpwd.isValid();if(!R.val){mstrmojo.alert(R.msg);return false;}}if(P.container.dsnSelector.WHDSNLIST.selectedIndex===1){var O=P.container.dsninfo.dsnBox.dsnList.selectedItem;if(!O||O.des==="0"){mstrmojo.alert(mstrmojo.desc(10070,"Please select a DSN first"));return false;}}else{R=P.container.dsninfo.isValidInput();if(!R.val){mstrmojo.alert(R.msg);return false;}}return true;}function F(){var Q=this,V=this.container.dsninfo,R=this.dbrole.mdDBRole,O=this.config,N=R.connstr,P=this.container,S=false,T=function T(){V.clear();if(!N){var Y=window.localStorage,W=parseInt((Y&&Y.getItem("dbRoleDSNOption"))||0,10);if(W===0||S){P.dsnSelector.WHDSNLIST.set("selectedIndex",0);}else{P.dsnSelector.WHDSNLIST.set("selectedIndex",1);}}else{var X=(N.split("=")[0]).toUpperCase();if(X==="DSN"){P.dsnSelector.WHDSNLIST.set("selectedIndex",1);}else{P.dsnSelector.WHDSNLIST.set("selectedIndex",0);}}V.set("info",R);if(!R.shared){R.shared="0";}if(mstrApp.isSingleTier){P.sharedConnection.domNode.style.display="none";}else{P.sharedConnection.checked=(R.shared==="1");P.sharedConnection.refresh();}R.des=(mstrApp.rootController.isCloud()?R.n:"");R.ln=R.ln||"";P.txtlogin.set("text",R.ln);if(R.did===""){R.password=R.password||"";}else{R.password=R.password||B;}P.txtpwd.set("text",R.password);P.txtname.set("text",R.n||R.des);};if(O||mstrApp.isSingleTier){mstrApp.rootController.getDBObjects().reloadDSNs({success:function U(){T.call(Q);}});if(O.hideDSNOption||(mstrApp.isSingleTier&&navigator.userAgent.indexOf("Macintosh")>-1)){P.dsnSelector.domNode.style.display="none";S=true;}if(O.hideDriverCheck){P.dsninfo.set("hideDriverCheck",O.hideDriverCheck);}if(O.requiresLogin!==undefined){P.txtlogin.isRequired=O.requiresLogin;P.txtpwd.isRequired=O.requiresLogin;}if(O.dbIdFilter){P.dsninfo.dbIdFilter=O.dbIdFilter.sort(G.numSorter);}if(O.dbIdExcludeFilter){P.dsninfo.dbIdExcludeFilter=O.dbIdExcludeFilter.sort(G.numSorter);}if(O.dsnDbTypeExcludeFilter){P.dsninfo.dsnDbTypeExcludeFilter=O.dsnDbTypeExcludeFilter.sort(G.numSorter);}if(O.showAddDriver){P.dsninfo.set("showAddDriver",O.showAddDriver);}if(O.singleType){P.dsninfo.set("singleType",true);}if(O.cfgDbmsTypeExcludeFilter){P.dsninfo.set("cfgDbmsTypeExcludeFilter",O.cfgDbmsTypeExcludeFilter);}P.sharedConnection.set("visible",!(O.hideShareConnection||false));}else{T.call(Q);}}function H(T){var R=this;var U=this.container,P=U.dsninfo,N=this.dbrole.mdDBRole;if(mstrApp.rootController.isCloud()){N.des=M.trim(U.txtname.text);N.n=N.des+"___"+new Date().getTime();}else{N.n=M.trim(U.txtname.text);}N.des=N.des.replace(",","%%%");N.n=N.n.replace(",","%%%");N.dbr_type="2";N.owned="1";N.writable="1";if(U.sharedConnection.isChecked()){N.shared="1";}else{N.shared="0";}if(U.txtlogin.visible){N.ln=M.trim(U.txtlogin.text);}else{N.ln="";}if((U.txtpwd.text!==B)&&(U.txtpwd.visible)){N.password=U.txtpwd.text;}else{delete N.password;}var Q=P.getConnectionStr();N.connstr=Q.str;N.db_type=P.getDBType();N.cefu=P.getCharEncodingForUnix();N.driverMode=P.getDriverMode();N.odbcv=P.getOdbcv();N.dbms=P.getDbmsID();N.ab=P.getDBId();P.getVLDBProperties(N.vldbProperties);mstrApp.rootController.saveDBRole(this.dbrole,(N.did===""),{errorMsg:Q.err,success:function S(){if(R.callback&&R.callback.success){R.callback.success(R.dbrole);}if(T&&T.keepOpen){T.success();}else{R.close();}},complete:function O(){if(this.errorMsg!==""){mstrmojo.alert(this.errorMsg);}}});}function A(P,Q){var O=(P.dbrole?P:P.parent),N=O.dbrole.mdDBRole;if(N.writable==="1"&&mstrApp.rootController.hasPrivilege(L)){if(J.call(O)){H.call(O,Q);}}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}mstrmojo.warehouse.dbroles.DBRoleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleEditor",cssClass:"mstrmojo-wh-DBRoleEditor",title:mstrmojo.desc(12949,"Data Source"),zIndex:100,dbrole:undefined,useDSN:true,callback:mstrmojo.emptyFn(),onOpen:function C(){F.call(this);},onClose:function I(){if(this.callback&&this.callback.close){this.callback.close();}},container:undefined,dsnSelector:undefined,WHDSNLIST:undefined,dsninfo:undefined,txtlogin:undefined,txtpwd:undefined,sharedConnection:undefined,hideDSNOption:undefined,hideDriverCheck:undefined,requiresLogin:undefined,children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DBRoleEditor-container",alias:"container",children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DSNSelector",alias:"dsnSelector",children:[{scriptClass:"mstrmojo.ui.CheckList",cssClass:"mstrmojo-wh-DSNSelector-radio",multiSelect:false,orientation:"h",alias:"WHDSNLIST",items:[{did:"0",n:mstrmojo.desc(11132,"DSN less data sources")},{did:"1",n:mstrmojo.desc(11133,"DSN data sources")}],onchange:function(){if(this.selectedIndex===0){this.parent.parent.dsninfo.set("isDSNLess",true);}else{this.parent.parent.dsninfo.set("isDSNLess",false);}var N=window.localStorage;if(N){N.setItem("dbRoleDSNOption",this.selectedIndex);}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleEditor-info",text:mstrmojo.desc(11139,"Connection Information"),visible:false},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleDSNConnection",alias:"dsninfo",onEnterFn:function E(N){A(N.parent.parent);},updateLoginFn:function D(N){this.parent.txtlogin.set("visible",N);this.parent.txtpwd.set("visible",N);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtlogin",isRequired:true,caption:mstrmojo.desc(8513,"login:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtpwd",isPassword:true,hiddenPwd:B,isRequired:true,caption:mstrmojo.desc(1162,"password:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtname",caption:mstrmojo.desc(11134,"ds name:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.CheckBox",cssClass:"mstrmojo-wh-DBRoleEditor-infoCheckbox",alias:"sharedConnection",label:mstrmojo.desc(10071,"Share this connection with everybody")}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonsbox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button rightfloat mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){A(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"buttonCancel",onclick:function(){var N=this.parent.parent;if(N.onCancel){N.onCancel();}N.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo._IsList","mstrmojo.ListBase","mstrmojo.array","mstrmojo.string","mstrmojo.dom","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.Menu","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.menu.DBConnectionsMenu");mstrmojo.requiresDescs(2901);var H=mstrmojo.array,G=mstrmojo.dom,M=mstrmojo.string,C="item-mn",Q=mstrmojo.warehouse.EnumDataChangeEvents,N=mstrmojo.desc(2901,"Loading..."),J=57;function B(S){var U=S.item,R=this.items,T=H.find(R,"did",U.did);R[T]=U;this._getItemNode(T).outerHTML=this.itemRenderer.render(U,T,this);}function D(T){var U=T.item,S=this.items.concat(),R=H.find(S,"did",U.did);if(R>-1){S.splice(R,1);}this.set("items",S);}mstrmojo.warehouse.ui.DBConnectionsList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.architect.ui.DBConnectionsList",cssClass:"mstrmojo-wh-dbConnectionslist",selectionPolicy:"reselect",useRichTooltip:true,showTooltip:function L(S,V){var U=S.target||G.eventTarget(S.hWin,S.e),T=this.getItemFromTarget(U);if(U.className&&(U.className.indexOf("item-n")>-1)){U=U.parentNode;}if(T&&T.n&&(U.scrollWidth>U.clientWidth)){var R=G.position(U);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:M.encodeHtmlString(T.n+"",true),top:R.y+R.h+5,left:R.x};this._super(S,V);}},postBuildRendering:function A(){if(G.isChrome){G.attachEvent(this.domNode,"mousedown",function(R){if(R.which===2){G.stopPropogation(window,R);G.preventDefault(window,R);}});}if(this._super){this._super();}},init:function P(V){this._super(V);var X=this,W={},T=W[this.id]={};T[Q.DBROLES_REQUESTED]=function R(){var Y={n:N,tp:"0",isPrimary:function(){return false;}};X.set("items",[Y]);};T[Q.DBROLES_LOADED]=function U(Y){var Z=Y.offset||0;X.set("items",Y.items);if(Z>0){X.adjustScrollPosition(Z);}};T[Q.DBROLES_ADD]=function S(Y){X.addItems([Y.item]);};T[Q.DBROLE_CHANGED]=B;T[Q.DBROLES_RENAME]=B;T[Q.DBROLES_DELETE]=D;mstrApp.getRootController().attachDataChangeListeners(W);},getItemMarkup:function K(S){var R=(S.mdDBRole&&S.mdDBRole.shared==="1"?" shared":"");return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-ic'+R+'"></span><span class="item-n" >{@n}</span><span class='+C+"></span></div>";},getItemProps:function I(U,R){var V=!!this.selectedIndices[R],T=M.encodeHtmlString(U.n),S=mstrApp.rootController.hasPrivilege(J)?"":" hide-menu";return{sel:V,cls:"tp"+U.tp+(U.isPrimary()?" primary":"")+(V?" selected":"")+S,n:T,idx:R};},onclick:function O(Y){try{var U=Y.target||G.eventTarget(Y.hWin,Y.e),Z=G.findAncestorByAttr(U,"idx",true,this.domNode),X=Z&&parseInt(Z.value,10),R=this.items[X];if(U.className===C&&X!==null&&!isNaN(X)){var W=mstrmojo.warehouse.ui.DBConnectionsList,S=W.dbCtxMenu=W.dbCtxMenu||new mstrmojo.warehouse.menu.DBConnectionsMenu();S.data=R.data;var T=S.getMenuConfig();T.hostId=this.id;T.hostElement=U;T.isHostedWithin=false;T.hostProxyCssClass="item-mn-proxy";T.position=G.position(T.hostElement,true);this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:T}));}else{if(X!==null){this._super(Y);}}}catch(V){throw V;}},onchange:function E(){if(this.selectedItem){mstrApp.getRootController().setSelectedDBRoleID(this.selectedItem);}},adjustScrollPosition:function F(U){var R=this.domNode.clientHeight,T=this.domNode.scrollHeight,S=this.items.length;if(S>0&&T>R){this.domNode.scrollTop=U*(T/S);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.ui.TablesTree","mstrmojo.warehouse.menu.AvailableTablesMenu");mstrmojo.requiresDescs(2901);var R=mstrmojo.array,N=mstrmojo.hash,A=mstrmojo.string,S=mstrmojo.css,J="loading",C=mstrmojo.dom,L=mstrmojo.warehouse.EnumDataChangeEvents,K=mstrmojo.architect.EnumDragActions,F=mstrmojo.warehouse.EnumObjectTypes,M=mstrmojo.desc(2901,"Loading..."),Q;mstrmojo.warehouse.ui.AvailableTablesTree=mstrmojo.declare(mstrmojo.warehouse.ui.TablesTree,null,{scriptClass:"mstrmojo.architect.ui.AvailableTablesTree",cssClass:"mstrmojo-wh-AvailableTablesTree",tablesTreeHooks:{addItem:function(W,X){var V=mstrApp.getRootController();V.addTables([].concat(X));},isTable:function U(V){return V&&V.tp===F.TABLE;}},createAvatarFunc:undefined,positionAvatarFunc:undefined,useRichTooltip:true,showTooltip:function B(W,Y){var X=W.target||C.eventTarget(W.hWin,W.e);if(X.className&&(X.className.indexOf("item-n")>-1)){X=X.parentNode;}if(X.className.indexOf("item tp")>-1&&(X.scrollWidth>X.clientWidth)){var V=C.position(X);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:X.textContent,top:V.y+V.h+5,left:V.x};this._super(W,Y);}},init:function P(b){this._super(b);var c={},Y=mstrApp.getRootController(),W=c[this.id]={};W[L.DBTABLES_CHANGED]=function Z(e){if(!((this.sourceInfo===e.sourceInfo)||(e.sourceInfo==="")||(e.sourceInfo===undefined))){return ;}this.cleanUp();var h=e.selectedItems||[],g=this.selectedIndices={},f=e.items;R.forEach(h,function(j){g[R.find(f,"n",j)]=true;});this.expandedIndices=e.expandedIndices||{};this.set("items",f);if(this.domNode){this.domNode.onmousedown=function(j){C.preventDefault(window,j);};}};W[L.DBTABLES_REQUESTED]=function a(f){if(!((this.sourceInfo===f.sourceInfo)||(f.sourceInfo===""))){return ;}this.cleanUp();var g=[];g.push({n:M,tp:"0",isVisible:function e(){return true;}});this.set("items",g);S.toggleClass(this.getLeafNode(0),J,true);};W[L.DBTABLE_UPDATED]=function d(e){R.forEach(this.getItemWithPropName(this.items,"did",e.item.did),function(f){this.updateChild(f._renderIdx,e.item);},this);};W[L.DBTABLES_USED]=function X(e){var g=e.items||[],f=this.items;N.forEach(this.selectedIndices,function(h,j){this.toggleChildSelection(String(j),false);},this);R.forEach(g,function(h){this.toggleChildSelection(String(R.find(f,"n",h)),true);},this);};Y.attachDataChangeListeners(c);this.dataHelper={fetch:function V(e,f){if(e.tp===F.TABLE){Y.getColumnsForDBTable({data:e},f);}else{f.success({items:[]});}}};},createAvatar:function I(V){if(this.createAvatarFunc){return this.createAvatarFunc.call(this,V);}else{return this._super(V);}},positionAvatar:function E(W,V){if(this.positionAvatarFunc){this.positionAvatarFunc.call(this,W,V);}else{this._super(W,V);}},cleanUp:function H(){this.expandedIndices={};this.selectedIndices={};this.userSelections={};},onitemsChange:function O(V){if(this._super){this._super(V);}delete this._oldItems;},getItemProps:function T(X,Y,W){var V=A.encodeHtmlString((X.n&&(X.n+""))||"");return{tag:"div",cls:"item "+(X.tp?("tp"+X.tp):""),n:V,idx:W};},getMenuHelper:function D(){Q.menuHelper=Q.menuHelper||new mstrmojo.warehouse.menu.AvailableTablesMenu();return Q.menuHelper;},getDragAction:function G(W){var X=this.getNodeAttributes(W.src.node),V=X&&this.getTreeItem(X.index);switch(V&&V.tp){case F.TABLE:return K.ADD_TABLE;}}});Q=mstrmojo.warehouse.ui.AvailableTablesTree;}());(function(){mstrmojo.requiresCls("mstrmojo.ui.Splitter","mstrmojo.qb.QBMappings");mstrmojo.requiresDescs(12735);var C="firstSplitNode",B="secondSplitNode";mstrmojo.qb.QBPageLayout=mstrmojo.declare(mstrmojo.ui.Splitter,null,{cssClass:"mstrmojo-qb-whole-panel",config:{firstSplit:{v:"20%",min:"150px",max:undefined},secondSplit:{v:"80%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function E(){return{w:36,h:0};},toggleDatabaseView:function A(F){this.toggleFirstItemVisibility(F);},toggleDataPreview:function D(F){this.workPanel.toggleSecondItemVisibility(F);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",slot:C,config:{firstSplit:{v:"40%",min:"100px"},secondSplit:{v:"60%",min:"100px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-main-panel",alias:"workPanel",slot:B,orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,getLayoutOffsets:function E(){return{h:0,w:12};},children:[{scriptClass:"mstrmojo.qb.QBPanel",slot:C},{scriptClass:"mstrmojo.qb.QBMappings",alias:"mappingPanel",slot:B}],config:{firstSplit:{v:"50%",min:"150px",max:undefined},secondSplit:{v:"50%",min:"150px",max:undefined},resizeHandle:{v:"5px"}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.SearchablePulldown","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.NameSpacePullDown","mstrmojo.warehouse.ui.SearchBox");mstrmojo.requiresDescs(12260,9142,12259);var I=mstrmojo.array,J=mstrmojo.css,E="mstrmojo-wh-",G=mstrmojo.dom,A=mstrmojo.desc(12260,"%% Tables, Last cache update: $$"),K=mstrmojo.desc(9142,"Available Tables"),F=mstrmojo.desc(12259,"Catalog SQL"),P=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.ui.AvailableTablesPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",cssClass:"AvailableTables",title:K,dbTableTree:undefined,searchBox:undefined,nameSpaces:undefined,catalogSQLBtn:undefined,refreshBtn:undefined,catSQL:undefined,useRichTooltip:true,showTooltip:function L(Q,S){var R=Q.target||G.eventTarget(Q.hWin,Q.e);if(R===this.titleNode||R===this.titleTextNode){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.titleNode,top:32,content:this.titleTooltip};this._super(Q,S);}},init:function M(T){this._super(T);var W=this.searchBox,S=this.dbTableTree;W.attachEventListener("searchTriggered",this.id,function(X){S.userSelections={};mstrApp.getRootController().availableTableSearch(X.searchValue);});this.addNewTitleButton({alias:"catalogSQLBtn",title:F,cssClass:E+"catalogSQL hidden",onclick:function Q(){mstrApp.getRootController().displayCatalogSQL();}});var V=this,U={},R=U[this.id]={};R[P.DBTABLES_CHANGED]=function(X){V.set("titleTooltip",A.replace("%%",X.items.length.toString()).replace("$$",X.src.catalogStamp||""));};R[P.DBROLE_SELECTION]=function(Y){var Z=this,X=Y.src.dbrs[I.find(Y.src.dbrs,"did",Y.value)];W.tableBox.refreshBtn.set("visible",false);if(X){X.populate(function a(b){W.clearSearch(true);J.toggleClass(Z.catalogSQLBtn.domNode,"hidden",!(mstrApp.getRootController().canDisplayCatalogSQL(Y.src.dbObjects.dbTypes,b.mdDBRole.db_type)));W.tableBox.refreshBtn.set("visible",W._preSearch?W._preSearch():false);});}else{if(!Y.value){W.clearSearch(true);J.toggleClass(Z.catalogSQLBtn.domNode,"hidden",true);}}};mstrApp.getRootController().attachDataChangeListeners(U);},onheightChange:function B(Q){if(!this.nameSpaces.heightOffset){this.nameSpaces.heightOffset=21;}if(!this.heightOffset){this.heightOffset=85;}this.dbTableTree.set("height",parseInt(Q.value,10)-this.heightOffset-(this.nameSpaces.visible?this.nameSpaces.heightOffset:0)+"px");},onwidthChange:function D(Q){if(!this.searchBox.widthOffset){this.searchBox.widthOffset=0;}var R=parseInt(Q.value,10);this.searchBox.set("width",R-6-this.searchBox.widthOffset+"px");this.nameSpaces.set("width",R-12+"px");},children:[{alias:"nameSpaces",scriptClass:"mstrmojo.warehouse.ui.NameSpacePullDown",sourceInfo:"tablesPanel",nameSpacesLoaded:function C(){this.parent.searchBox.clearSearch(true);this.parent.onheightChange({value:this.parent.height});},onItemSelectedCallback:function O(Q){var R=this.parent.searchBox;R.clearSearch(true);mstrApp.getRootController().setNameSpaceID(Q.n);R.tableBox.refreshBtn.set("visible",R._preSearch?R._preSearch():false);}},{scriptClass:"mstrmojo.warehouse.ui.SearchBox",alias:"searchBox",_preSearch:function N(){if(this.parent.nameSpaces.visible){return(this.parent.nameSpaces.selectedIndex!==undefined);}return true;},_onRefresh:function H(){this.clearSearch(true);mstrApp.getRootController().handleDBTableRefresh();}},{alias:"dbTableTree",scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",sourceInfo:"tablesPanel",renderOnScroll:true}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.DataGrid","mstrmojo.dom","mstrmojo.Editor","mstrmojo.RadioButton","mstrmojo.architect.ui.SQLInputBox","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.NameSpacePullDown");var j=mstrmojo.array,c=mstrmojo.hash,D=mstrmojo.css,U=mstrmojo.dom,h="1",l="2",n="0",g="2",u="4",f=mstrmojo.warehouse.EnumNamespaceMode.ALL,m=mstrmojo.warehouse.EnumNamespaceMode.CURRENT,T="mstrmojo-ar-catSQL",t=mstrmojo.desc(12261,"Catalog Options"),b=mstrmojo.desc(12262,"Catalog mode"),P=mstrmojo.desc(12263,"Data source SQL"),W=mstrmojo.desc(12264,"ODBC calls"),V=mstrmojo.desc(8368,"Caching"),H=mstrmojo.desc(12265,"Table names only"),L=mstrmojo.desc(12266,"Table and column names"),q=mstrmojo.desc(2057,"None"),k=mstrmojo.desc(12267,"Cannot guarantee caching when using non-default SQL"),E=mstrmojo.desc(2177,"Close"),M=mstrmojo.desc(12268,"Namespaces"),F=mstrmojo.desc(3524,"All"),A=mstrmojo.desc(12269,"Current only"),J=mstrmojo.desc(12270,"SQL statement to retrieve table and column names for this data source"),Z=mstrmojo.desc(12271,"SQL statement to retrieve tables available in the data source"),X=mstrmojo.desc(12272,"SQL statement to retrieve columns for the selected tables"),I=mstrmojo.desc(3389,"Preview"),O=mstrmojo.desc(134,"Apply"),G=mstrmojo.desc(12273,"Use default value"),C={full:J,table:Z,column:X};var r;var Y;function S(w){return w.replace(/[ \n\r\t]/g,"");}function e(AE,z,AB){var AA=new mstrmojo.Box({alias:"sqlBox",cssClass:T+"-sqlBox",defaultSQL:"",useDefaultSQL:function AD(){return(S(this.defaultSQL)===S(this.currentSQL));},currentSQL:"",resize:function x(){var AJ=this.sqlText.domNode,AH=U.position(AJ).h,AG=AJ.offsetTop,AF=U.position(AJ).w,AI=this.curtain;AI.domNode.style.height=AH+"px";AI.domNode.style.width=AF+"px";AI.domNode.style.top=AG+"px";},children:[{scriptClass:"mstrmojo.HBox",alias:"sqlHead",cssClass:"sqlSection-box",children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sqlLabel",text:C[AB]},{scriptClass:"mstrmojo.CheckBox",cssClass:T+"-check",alias:"sqlCheck",index:AB,label:G,oncheckedChange:function AC(){var AG=this.parent.parent,AF=AG.parent.parent.parent,AH;AG.curtain.set("visible",this.checked);if(this.checked){AG.sqlText.setSQLStatement(AG.defaultSQL);}else{if(!AF.loadingPanel){switch(AF.options.cacheMode.value){case n:AH=L;break;case g:if(this.index==="column"){return ;}AH=H;break;case u:return ;}mstrmojo.alert(k,undefined,V+": "+AH);}}}}]},{scriptClass:"mstrmojo.architect.ui.SQLInputBox",cssClass:"mstrmojo-ar-sqlInput-inputbox visible "+T,alias:"sqlText"},{scriptClass:"mstrmojo.Label",cssClass:T+"-curtain",alias:"curtain"}]});this.contents.rightPanel.addChildren([AA]);var w=AA.sqlText;D.toggleClass(w.domNode,"full",(this.options.cacheMode.value===n));AA.resize();AA.defaultSQL=AE[j.find(AE,"tp",AB)].sql;AA.currentSQL=z[j.find(z,"tp",AB)].sql;w.setSQLStatement(AA.currentSQL);AA.sqlHead.sqlCheck.checked=!AA.useDefaultSQL();AA.sqlHead.sqlCheck.set("checked",AA.useDefaultSQL());return AA;}function R(AE,z,AC,x){var AB=this,AA,w,AD;w=AE[j.find(AE,"tp",AC)];AA=z[j.find(z,"tp",AC)];AD=AB.contents.rightPanel.children[x].sqlText.getSQLStatement();if(AD===w.sql){AD="";}AA.sql=AD;return AA;}function N(AB,AA,z,w){var x,AE;if((AA.value===f)){x=c.cloneArray(AB.SQLStatements.currentSQLs.allNS);AE=c.cloneArray(AB.SQLStatements.defaultSQLs.allNS);if(z.value===u){if(AB.supportsNameSpaces){x=c.cloneArray(AB.SQLStatements.currentSQLs.currentNS);AE=c.cloneArray(AB.SQLStatements.defaultSQLs.currentNS);}}else{if(z.value===g){if(AB.supportsNameSpaces){var AD=AB.SQLStatements.currentSQLs.currentNS,AC=AB.SQLStatements.defaultSQLs.currentNS;x[j.find(x,"tp","column")]=AD[j.find(AD,"tp","column")];AE[j.find(AE,"tp","column")]=AC[j.find(AC,"tp","column")];}}}}else{x=c.cloneArray(AB.SQLStatements.currentSQLs.currentNS);AE=c.cloneArray(AB.SQLStatements.defaultSQLs.currentNS);}if(w){return x;}return AE;}function B(){var AA=this,x=new mstrmojo.Box({alias:"sqlPreviewBox",cssClass:T+"-sqlBox",children:[{scriptClass:"mstrmojo.Box",cssClass:T+"-preview",alias:"sqlPreviewContents",children:[{scriptClass:"mstrmojo.Table",alias:"sqlPreviewTable",rows:1,cols:3,children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sqlPreviewLabel",slot:"0,0",text:I},{scriptClass:"mstrmojo.warehouse.ui.NameSpacePullDown",alias:"nameSpaces",sourceInfo:"CatSQL",slot:"0,1",onItemSelectedCallback:function AB(AC){AA.selectedNS=AC.n;}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+T+"-button",slot:"0,2",text:O,onclick:function w(){var AF=AA.options,AC=AF.catalogMode,AG=AF.nsMode,AE=AF.cacheMode,AD,AI,AH=[];AH.push(AC);AH.push(AG);AH.push(AE);if(AF.catalogMode.value===h){AD=N(AA,AG,AE,true);AI=N(AA,AG,AE,false);switch(AE.value){case n:AH.push(R.call(AA,AI,AD,"full",0));break;case g:AH.push(R.call(AA,AI,AD,"table",0));AH.push(R.call(AA,AI,AD,"column",1));break;case u:AH.push(R.call(AA,AI,AD,"table",0));AH.push(R.call(AA,AI,AD,"column",1));break;}}AA.onUpdateInfo({options:AH});if((AA.supportsNameSpaces&&AA.selectedNS)||(!AA.supportsNameSpaces)){mstrApp.rootController.availableTableSearch("",{dbRoleID:AA.dbRole.did,nameSpace:AA.selectedNS||"",getFresh:true,sourceInfo:"CatSQL"});}}}]}]},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",alias:"dbTableTree",cssClass:"mstrmojo-wh-AvailableTablesTree "+T+"-dbTablesTree",sourceInfo:"CatSQL",editor:AA,postCreate:function z(){if(this.editor.options.catalogMode.value===l){this.cssClass+="-none";}}}]});this.contents.rightPanel.addChildren([x]);}function Q(){var w,x=this.parent.count,z=this.parent.prefix;if(this.checked){for(w=0;w<x;w++){this.parent[z+w].set("checked",false);}this.set("checked",true);}}function K(){var AB=this,x=AB.options,AA=AB.contents.rightPanel,w,AC,z;if(AB.loading){return ;}this.loadingPanel=true;AA.removeChildren();if(x.catalogMode.value===h){w=N(AB,x.nsMode,x.cacheMode,true);AC=N(AB,x.nsMode,x.cacheMode,false);Y=[];switch(x.cacheMode.value){case n:z=e.call(AB,AC,w,"full");Y.push(z);break;case g:Y.push(e.call(AB,AC,w,"table"));Y.push(e.call(AB,AC,w,"column"));break;case u:Y.push(e.call(AB,AC,w,"table"));Y.push(e.call(AB,AC,w,"column"));break;}}B.call(AB);AB.contents.rightPanel.sqlPreviewBox.sqlPreviewContents.sqlPreviewTable.nameSpaces.domNode.style.visibility=(AB.supportsNameSpaces?"":"hidden");if(AB.supportsNameSpaces){mstrApp.rootController.getNameSpaces({dbRoleID:AB.dbRole.did,sourceInfo:"CatSQL"});}this.loadingPanel=false;}mstrmojo.warehouse.ui.editors.CatalogSQLEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.warehouse.ui.editors.CatalogSQLEditor",cssClass:T,title:t,options:{},SQLStatements:[],onUpdateInfo:undefined,supportsNameSpaces:false,dbRole:undefined,sql:"",curtain:undefined,useDefaultSQL:undefined,contents:undefined,rightPanel:undefined,sqlPreviewBox:undefined,sqlPreviewContents:undefined,sqlPreviewTable:undefined,leftPanel:undefined,currentSQLs:undefined,defaultSQLs:undefined,catalogModeRBBox:undefined,catalogModeRB0:undefined,catalogModeRB1:undefined,cacheMode:undefined,nsMode:undefined,catalogMode:undefined,sqlCheck:undefined,allNS:undefined,currentNS:undefined,cacheModeRBBox:undefined,nsModeRBBox:undefined,nsModeRB1:undefined,browserResized:function p(w){var x=parseInt(w.w,10);r=w;if(isNaN(x)||x<0||!this.domNode){return ;}if(x<800){x=760;}else{if(x>1063){x=1010;}else{x=Math.ceil(x*0.95);}}this.domNode.children[0].style.width=x+"px";this.contents.rightPanel.domNode.style.width=(x-219)+"px";j.forEach(Y,function(z){z.resize();});},onOpen:function d(){var z=this.contents.leftPanel,x,AA,AB;this.loading=true;var w=(j.find(mstrApp.rootController.getDBObjects().catalogDbTypes,"v",this.dbRole.mdDBRole.db_type)>=0);z.catalogModeRBBox.catalogModeRB0.set("enabled",w);if((this.options.catalogMode.value===h)&&w){x=0;}else{x=1;}z.catalogModeRBBox["catalogModeRB"+x].set("checked",true);z.catalogModeRBBox["catalogModeRB"+x].onclick();z.nsModeRBBox.nsModeRB1.set("enabled",this.supportsNameSpaces);if(this.supportsNameSpaces){if(this.options.nsMode.value===n){x=0;}else{x=1;}}else{x=0;}z.nsModeRBBox["nsModeRB"+x].set("checked",true);z.nsModeRBBox["nsModeRB"+x].onclick();if(this.options.cacheMode.value===n){x=0;}else{if(this.options.cacheMode.value===g){x=1;}else{if(this.options.cacheMode.value===u){x=2;}}}z.cacheModeRBBox["cacheModeRB"+x].set("checked",true);z.cacheModeRBBox["cacheModeRB"+x].onclick();this.selectedNS=undefined;this.loading=false;K.call(this);AA=this.domNode.children[0];AB=parseInt(AA.style.top,10);if(AB<0){AA.style.top="0px";}if(r){this.browserResized(r);U.center(AA);}},children:[{scriptClass:"mstrmojo.HBox",alias:"contents",cssClass:"catsql-hbox",children:[{scriptClass:"mstrmojo.Box",cssClass:T+"-leftPanel",alias:"leftPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:b},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:2,prefix:"catalogModeRB",alias:"catalogModeRBBox",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:P,index:0,alias:"catalogModeRB0",onclick:function o(){Q.call(this);},oncheckedChange:function a(){}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:W,index:1,alias:"catalogModeRB1",onclick:function o(){Q.call(this);},oncheckedChange:function a(){var w=this.parent.parent.parent.parent;w.options.catalogMode.value=(this.checked?l:h);K.call(w);}}]},{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:M},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:2,alias:"nsModeRBBox",prefix:"nsModeRB",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:F,index:0,alias:"nsModeRB0",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var w=this.parent.parent.parent.parent;w.options.nsMode.value=f;K.call(w);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:A,index:1,alias:"nsModeRB1",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var w=this.parent.parent.parent.parent;w.options.nsMode.value=m;K.call(w);}}]},{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:V},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:3,alias:"cacheModeRBBox",prefix:"cacheModeRB",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:L,index:0,alias:"cacheModeRB0",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var w=this.parent.parent.parent.parent;w.options.cacheMode.value=n;K.call(w);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:H,index:1,alias:"cacheModeRB1",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var w=this.parent.parent.parent.parent;w.options.cacheMode.value=g;K.call(w);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:q,index:2,alias:"cacheModeRB2",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var w=this.parent.parent.parent.parent;w.options.cacheMode.value=u;K.call(w);}}]}]},{scriptClass:"mstrmojo.Box",cssClass:T+"-rightPanel",alias:"rightPanel",children:[]}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+T+"-closeBtn",text:E,onclick:function o(){var w=this.parent.parent;j.forEach(w.contents.rightPanel.sqlPreviewBox.dbTableTree.items,function(x){delete x.items;});w.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.warehouse.ui.DBConnectionsList");mstrmojo.requiresDescs(13531,13532,13533,14034,14035);var E=57,D="reportDefLoaded",C=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.thirdParty.BISourceSelector=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.thirdParty.BISourceSelector",cssClass:"mstrmojo-qb-thirdParty-BISourceSelector",title:mstrmojo.desc(4381,"data sources"),newDBBtn:undefined,dbConnections:undefined,onheightChange:function B(G){if(!this.heightOffset){this.heightOffset=37;}this.dbConnections.set("height",parseInt(G.value,10)-this.heightOffset+"px");},children:[{scriptClass:"mstrmojo.Box",cssClass:"selector-panel-header cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"title-label",text:mstrmojo.desc(14034,"Select a source connection")+":"},{scriptClass:"mstrmojo.Button",cssClass:"add-connection-button",text:mstrmojo.desc(14035,"Add a new connection")+"...",onclick:function F(){if(mstrApp.rootController.hasPrivilege(E)){mstrApp.getRootController().editDBRole();}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}}]},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"source-type-selector",visible:false,items:[{id:0,n:"All"},{id:1,n:"SAP Business Objects"},{id:2,n:"OBIEE"},{id:3,n:"Cognos"}],selectedIndex:0,onitemSelected:function(G){this.parent.dbConnections.filterBySource(G.n);}},{scriptClass:"mstrmojo.warehouse.ui.DBConnectionsList",alias:"dbConnections",postCreate:function(){var H={},G=H[this.id]={};G[C.DBROLES_LOADED]=this.onDBRolesLoaded;G[D]=this.onReportDefLoaded;mstrApp.getRootController().attachDataChangeListeners(H);},onDBRolesLoaded:function(G){this.allDBRoles=G.items;},onReportDefLoaded:function(){var G=mstrApp.getRootController().model;this.singleSelectByField(G.SelDBRoleID,"did");},onchange:function(){var H=this.selectedItem,G=mstrApp.getRootController().model;if(H){G.SelDBRoleID=H.did;G.set("SelDBRoleName",H.n);}else{if(G.SelDBRoleID){this.singleSelectByField(G.SelDBRoleID,"did");}else{G.set("SelDBRoleName","");}}},filterBySource:function A(G){}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.DBConnectionsList");mstrmojo.requiresDescs(4381,11131,12933);var B=57;mstrmojo.warehouse.DBRoleSelector=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.DBRoleSelector",cssClass:"DBConnections",title:mstrmojo.desc(4381,"data sources"),newDBBtn:undefined,dbConnections:undefined,init:function C(D){this._super(D);this.addNewTitleButton({alias:"newDBBtn",cssClass:"mstrmojo-wh-addDB",title:mstrmojo.desc(11131,"New data source"),onclick:function E(){if(mstrApp.rootController.hasPrivilege(B)){mstrApp.getRootController().editDBRole();}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}});},onheightChange:function A(D){if(!this.heightOffset){this.heightOffset=30;}this.dbConnections.set("height",parseInt(D.value,10)-this.heightOffset+"px");},children:[{scriptClass:"mstrmojo.warehouse.ui.DBConnectionsList",alias:"dbConnections"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.TransformInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-transform",items:[],noEditButton:true,folderLinksContextId:26,browsableTypes:[B.TP.FOLDER,B.TP.ROLE].join(","),getCandidatesThroughTaskCall:function A(E,D){mstrmojo.ME.MetricDataService.getTransformations(E,D);},hideItemWidgetBrowseButton:function C(){return this.isDME;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.ConditionInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-condition",folderLinksContextId:10,browsableTypes:[B.TP.FOLDER,B.TP.FILTER,B.STP.PROMPT_OBJECTS].join(","),noEditButton:true,maxObjectCount:1,getCandidatesThroughTaskCall:function A(D,C){D.rootFolderType=39;D.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getFilters(D,C);},hideItemWidgetBrowseButton:function(){return this.isDME;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ME.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME.Enum");mstrmojo.requiresDescs(1107,12178);var J=mstrmojo.expr,D=mstrmojo.ME.Enum.DYNAMIC_DIMTY;mstrmojo.ME.LevelInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-level",oncandidatesChange:function F(E){this.candidates.items=D.getItems("level").concat(this.candidates.items);},hidePulldownButton:function(){return !this.isDME;},hideItemWidgetBrowseButton:function(){return this.isDME;},folderLinksContextId:16,browsableTypes:[J.TP.FOLDER,J.TP.ATTR,J.TP.DIM].join(","),getCandidatesThroughTaskCall:function K(L,E){L.rootFolderType=39;L.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(L,E);},itemFunction:function B(M,E,L){M.filtering=M.filtering||1;M.grouping=M.grouping||1;var N=this._super(M,E,L,mstrmojo.ME.LevelObjectItem);N.optionButtonVisible=true;return N;},updateSuggestion:function C(E){E=[{n:this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level"),did:-1,t:-1,state:0}].concat(E);if(this._super){this._super(E);}},add:function H(L,E){var N=true,M=this.items;mstrmojo.array.forEach(L,function(O){mstrmojo.array.forEach(M,function(P){if(P.did&&P.did===O.did){N=false;return false;}});});if(N){this._super(L,E);}}});mstrmojo.ME.LevelObjectItem=mstrmojo.declare(mstrmojo.ME.ObjectItem,[mstrmojo._HasPopup],{optsRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9598,"Level Options"),cssText:"width: 450px;",onOpen:function A(){var E=this.opener.data;this.filterOption.set("value",E.filtering);this.groupOption.set("value",E.grouping);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9599,"Relationship with Report Filter:")},{scriptClass:"mstrmojo.Pulldown",alias:"filterOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9600,"Standard - Metric calculates only for elements found in the filter"),did:1},{n:mstrmojo.desc(9601,"Absolute - Raises the calculation to the selected level, if possible"),did:2},{n:mstrmojo.desc(9602,"Ignore - Omit filtering criteria based on selected level and its related attributes"),did:3},{n:mstrmojo.desc(9603,"None - Unspecified - the selected level and group components define the filter"),did:4}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9604,"Metric Aggregations:")},{scriptClass:"mstrmojo.Pulldown",alias:"groupOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9605,"Standard - Metric calculates at the selected level, if possible"),did:1},{n:mstrmojo.desc(9606,"None - Exclude the selected level and children from the GROUP BY clause in the SQL"),did:2},{n:mstrmojo.desc(9607,"Beginning lookup - Use the first value of the lookup table"),did:3},{n:mstrmojo.desc(9608,"Ending lookup - Use the last value of the lookup table"),did:4},{n:mstrmojo.desc(9609,"Beginning fact - Use the first value of the fact table"),did:5},{n:mstrmojo.desc(9610,"Ending fact - Use the last value of the fact table"),did:6}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,L=E.opener;if(L.saveOnClose){L.saveOnClose(E.filterOption.value,E.groupOption.value);}E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},saveOnClose:function G(E,M){var L=this.data;L.filtering=E;L.grouping=M;if(this.parent.onSaveOnClose){this.parent.onSaveOnClose();}},options:function I(){this.openPopup("optsRef",{title:'"'+this.data[this.itemField]+'" '+mstrmojo.desc(9598,"Level Options"),zIndex:40});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.css","mstrmojo.string","mstrmojo.qb.QBTableView","mstrmojo.qb.FFsqlEditor","mstrmojo.Label","mstrmojo.Table","mstrmojo.Button");mstrmojo.requiresDescs(2827,9130,9137,9141,9215,9927,12378,12417,13403);var K=mstrmojo.string,F=mstrmojo.css,D=mstrmojo.desc,H="on",N=mstrmojo.warehouse.EnumDataChangeEvents;var G=1,I=2;var B=mstrmojo.desc(9215,"Type multi-pass SQL or double-click a table name");mstrmojo.qb.Button=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.qb.Button",markupString:'<div id="{@id}" class="mstrmojo-Button mstrmojo-qb-Button {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:touchstart,click,mousedown,mouseup><div class="mstrmojo-qb-Button-icon {@innerIconClass}"></div><div class="mstrmojo-Button-text mstrmojo-qb-Button-text {@innerIconClass}"></div></div>',markupSlots:{iconNode:function(){return this.domNode.firstChild;},textNode:function(){return this.domNode.lastChild;}},postBuildRendering:function(){var P;if(this._super){P=this._super();}var O=this;this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:this.text||""});if(!this._ontooltipover){this._ontooltipover=function(Q){var R=O.textNode;if(R.offsetWidth<R.scrollWidth){O.showTooltip(Q,self);}};this._ontooltipout=function(Q){var R=O.textNode;if(R.offsetWidth<R.scrollWidth){O.hideTooltip(Q,self);}};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return P;}});mstrmojo.qb.QBPanel=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.QBPanel",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},cssText:"position:relative;",mode:G,children:[{scriptClass:"mstrmojo.Box",alias:"header",cssClass:"mstrmojo-qb-tableview-toolbar",children:[{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon play",text:D(9130,"Execute SQL"),postCreate:function L(){var P={},O=P[this.id]={};O[N.DBTABLES_ENABLED]=function(Q){this.set("enabled",Q.value);};mstrApp.getRootController().attachDataChangeListeners(P);},onclick:function(){var P=mstrApp.getRootController(),O=this.parent.parent;if(O.mode===G){P.autoMap();}else{P.autoMapFFSQL(O.SQL.ffsql.getSQLstmt());}}},{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon erase",text:D(2827,"Clear"),bindings:{visible:function(){return this.parent.parent.mode===I;}},postCreate:function L(){var P={},O=P[this.id]={};O[N.DBTABLES_ENABLED]=function(Q){this.set("enabled",Q.value);};mstrApp.getRootController().attachDataChangeListeners(P);},onclick:function M(){var P=this.parent.parent.SQL,Q=P.ffsql,O=mstrApp.getRootController();Q.clearTokens();P.updatepasses();O.autoMapFFSQL("");if(O.canAddTableSQL(true,"")){O.enableAvailableTables();}}},{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon refresh",text:D(9927,"Update Tables"),bindings:{visible:function(){return(this.parent.parent.mode===G&&!mstrApp.isBigQuery);}},onclick:function(){mstrApp.getRootController().updateTableStructure();}},{scriptClass:"mstrmojo.Label",cssClass:"condition",text:D(12378,"Filter..."),postBuildRendering:function A(){var P=this;mstrApp.getRootController().attachEventListener("reportModeChange",this.id,function(Q){P.set("visible",Q.mode!==2);});var O;if(this._super){O=this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:D(12378,"Filter...")});if(!this._ontooltipover){this._ontooltipover=function(Q){P.showTooltip(Q,self);};this._ontooltipout=function(Q){P.hideTooltip(Q,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return O;},onclick:function(){mstrApp.getRootController().openConditionDialog();}},{scriptClass:"mstrmojo.Button",cssClass:"FFSQL_QB_converter",useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-A",top:32,posType:mstrmojo.tooltip.POS_TOPLEFT},bindings:{text:function(){var O=this.parent.parent.mode===G;return O?D(9137,"Edit SQL"):D(13403,"Switch to Build a Query");},visible:function(){return !mstrApp.isFFSQL;}},onclick:function(){if(!mstrApp.isCloudPro||mstrApp.said){mstrApp.getRootController().convertMode(this.parent.parent.mode===G);}},postBuildRendering:function A(){var Q=this;var P;if(this._super){P=this._super();}var O;if(!this._ontooltipover){this._ontooltipover=function(R){if(R.relatedTarget!==Q.domNode&&R.relatedTarget!==Q.domNode.childNodes[0]){O=mstrApp.isCloudPro?D(12417,"View SQL"):D(9137,"Edit SQL");Q.richTooltip.refNode=Q.domNode;if(Q.parent.parent.mode===G){mstrApp.getRootController().getSQLPreview({success:function T(U){Q.richTooltip.content=U?O+"<br><br>"+U.replace("\n","<br>"):O;Q.showTooltip(R,self);},failure:function S(){Q.richTooltip.content=O;Q.showTooltip(R,self);}});}else{Q.richTooltip.content=Q.text;Q.showTooltip(R,self);}}};this._ontooltipout=function(R){Q.hideTooltip(R,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return P;}}]},{scriptClass:"mstrmojo.qb.QBTableView",cssClass:"mstrmojo-qb-tableview on",alias:"tables",bindings:{visible:function(){return(this.parent.mode===G);}}},{scriptClass:"mstrmojo.qb.FFsqlEditor",cssClass:"mstrmojo-qb-ffsqlview",alias:"SQL",bindings:{visible:function(){return(this.parent.mode===I);}}}],enterMode:function J(O){var R=O.mode;this.set("mode",R);var P=(R===I);this.tables.set("visible",!P);F.toggleClass(this.tables.domNode,H,!P);F.toggleClass(this.SQL.domNode,H,P);this.SQL.set("visible",P);if(P){var Q=this.SQL.ffsql;Q.updateSQL(O);}else{this.tables.scrollBox.linker.drawLinks();}},onheightChange:function(O){if(this.domNode&&this.header.domNode){this.tables.set("height",parseInt(O.value,10)-this.header.domNode.clientHeight+"px");this.SQL.set("height",this.tables.height);}},onwidthChange:function C(O){if(this.width!=="NaNpx"){this.tables.set("width",this.width);this.SQL.set("width",this.width);}},postBuildRendering:function E(){if(this._super){this._super();}var O=mstrApp.getRootController();O.attachEventListener("reportModeChange",this.id,this.enterMode);O.attachEventListener("addCandidateTables",this.SQL.ffsql.id,"addCandidateTables");}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Table","mstrmojo.CheckBox","mstrmojo.ME.LevelInputBox","mstrmojo.ME.ConditionInputBox","mstrmojo.ME.TransformInputBox","mstrmojo.ME.MetricDataService","mstrmojo.Button","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.mstr.EnumFunction");mstrmojo.requiresDescs(1107,1281,2148,2397,2399,3324,3377,4788,6223,9577,9579,9581,9582,9583,9584,11564,11565,12178,12179,12853);var Q=mstrmojo.expr,G=mstrmojo.array,B=mstrmojo.mstr.EnumFunction,R=mstrmojo.ME._MetricEditorHelper,A=mstrmojo.ME.MetricToken.brackets;var N,M;var C=function(){var E=this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level");return mstrmojo.hash.copy({n:E,did:-1,t:-1,state:0});};var X={level:-4,condition:-5,transformation:-6,simple:-7},O=function(E){return !(E===-4||E===-5||E===-6);},L=function(Y,E){return O(Y)||parseInt(Y,10)===X[E];},U=function(E){return E===-4||E===-5||E===-6||E===-7;};var W={n:"",did:"-1",desc:""},D={1:"+",2:"*",3:"%",4:""},F={1:"",2:"!",3:"<",4:">",5:"<|",6:">|"},H=function(a,Z){var c,E,b;switch(Z){case"level":c=[Q.TP.ATTR,Q.TP.DIM];E="onLevelAdded";b=16;break;case"transform":c=[Q.TP.ROLE];E="onTransformAdded";b=26;break;case"condition":c=[Q.TP.FILTER,Q.STP.PROMPT_OBJECTS];E="onConditionAdded";b=10;break;case"expression":c=[Q.TP.FACT,Q.TP.ATTR,Q.TP.FUNCTION,Q.TP.METRIC];E="onExpressionAdded";b=25;break;default:}c[c.length]=Q.TP.FOLDER;a.openPopup("ob",{zIndex:a.zIndex+10});var Y=a.ob.browser;Y.browse({folderLinksContextId:b,onSelectCB:[a,E],browsableTypes:c.join(","),includeObjectDesc:true});};mstrmojo.ME._HasLevel=mstrmojo.provide("mstrmojo.ME._HasLevel",{_mixinName:"mstrmojo.ME._HasLevel",isAggFunction:false,init:function V(E){if(this._super){this._super(E);}N=this.id;M=this;},onOpen:function K(){if(this._super){this._super();}if(!this.isAggFunction){return ;}M=this;var Y=this.getLCTDefFromTokens();this.updateToggleBarStatus(Y);var E=this.metricLCT.levelInput;E.set("candidates",this.getCandidates4LCT([Q.TP.ATTR,Q.STP.NDE]));E.set("items",Y.level);var Z=this.metricLCT.conditionInput;if(!this.noCache&&!Z.candidates&&!this.isDME){mstrmojo.ME.MetricDataService.getFilters({pattern:"*",blockBegin:1,blockCount:-1},{success:function(b){if(b){Z.set("candidates",{items:b.items,isComplete:(b.bc===-1||(b.bb+b.bc>b.sz))});}},failure:function(b){mstrmojo.alert(b.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{Z.candidates=this.getCandidates4LCT([Q.TP.FILTER,Q.STP.PROMPT_OBJECTS]);this.metricLCT.lblCondition.set("visible",Y.filter.length>0);}Z.set("items",Y.filter);var a=this.metricLCT.transformInput;if(!this.noCache&&!a.candidates&&!this.isDME){mstrmojo.ME.MetricDataService.getTransformations({pattern:"*",blockBegin:1,blockCount:-1},{success:function(b){if(b){a.set("candidates",{items:b.items,isComplete:(b.bc===-1||(b.bb+b.bc>b.sz))});}},failure:function(b){mstrmojo.alert(b.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{a.candidates=this.getCandidates4LCT(Q.TP.ROLE);this.metricLCT.lblTransform.set("visible",Y.tranformation.length>0);}a.set("items",Y.tranformation);},getLCTDefAsTokens:function P(){if(!this.isAggFunction){return[];}var h=this.metricLCT.levelInput.getSelectedObjects(),b=this.metricLCT.conditionInput.getSelectedObjects(),Z=this.metricLCT.transformInput.getSelectedObjects(),e=[],Y,a,c,E=function(k,j){return k.filtering===1?"("+j+")":j;};e.push({v:"{",isDelimiter:true});var f=null;for(a=0,c=h.length;a<c;a++){f=h[a];e.push({v:F[f.grouping],isDelimiter:true});if(R.isDimty(f.n)){e.push({v:E(f,f.n)});}else{if(/^@/.test(f.did)){e.push({v:E(f,f.did)});}else{if(f.did===-1){e.push({v:"~",isDelimiter:true});}else{e.push({v:A(f.n),oi:f});}}}e.push({v:D[f.filtering],isDelimiter:true});if(a<(c-1)){e.push({v:", ",isDelimiter:true});}}if(!this.levelFilterRest){e.push({v:";",isDelimiter:true});e.push({v:"-",isDelimiter:true});}if(!this.levelCanContinue){e.push({v:";",isDelimiter:true});e.push({v:"/",isDelimiter:true});}e.push({v:"}",isDelimiter:true});if(b.length>0){e.push({v:"<",isDelimiter:true});Y={v:A(b[0].n)};if(b[0].did){Y.oi=b[0];}e.push(Y);e.push({v:";",isDelimiter:true});e.push({v:"@",isDelimiter:true});e.push({v:this.conditionEmbedMethod});e.push({v:";",isDelimiter:true});e.push({v:this.conditionIgnoreFilterElem?"-":"+",isDelimiter:true});e.push({v:">",isDelimiter:true});}var g=G.indexOf(Z,W);c=g<0?Z.length:g;if(c>0){e.push({v:"|",isDelimiter:true});var d=null;for(a=0;a<c;a++){d=Z[a];Y={v:A(d.n)};if(d.did){Y.oi=d;}e.push(Y);if(a<(c-1)){e.push({v:", ",isDelimiter:true});}}e.push({v:"|",isDelimiter:true});}for(a=0,c=e.length;a<c;a++){e[a].isNew=true;}return e;},getLCTDefFromTokens:function S(){var Y=[],a=false,f=[],d=[],h=this.oi.tks.items,g=h.length,e;if(this.insertMode||g===0){Y.push(C.call(this));}else{for(e=0;e<g;e++){var b=h[e],j=b.tp,Z=b.sctt;switch(Z){case 262144:a=true;switch(j){case 64:case 126:case 264:case 265:case 310:var c=e,k;if(j===64){var E=b.v+h[++e].v;b=h[e+1];if(b.tp===43||b.tp===45){E+=h[++e].v;E+=h[++e].v;}else{if(b.tp===41){e++;}}k=mstrmojo.ME.Enum.DYNAMIC_DIMTY.getDimtyObject(E,this.isDME);}else{k=j===126?C.call(this):b.oi;}k.grouping=1;k.filtering=4;switch(h[c-1].tp){case 33:k.grouping=2;break;case 60:k.grouping=3;break;case 62:k.grouping=4;break;case 297:k.grouping=5;break;case 298:k.grouping=6;break;}switch(h[e+1].tp){case 37:k.filtering=3;break;case 42:k.filtering=2;break;case 43:k.filtering=1;break;}Y.push(k);break;case 45:this.levelFilterRest=false;break;case 47:this.levelCanContinue=false;break;}break;case 327680:switch(j){case 270:case 273:f.push(b.oi);break;case 262:this.conditionEmbedMethod=b.v;break;case 43:this.conditionIgnoreFilterElem=false;break;case 45:this.conditionIgnoreFilterElem=true;break;}break;case 393216:switch(j){case 271:d.push(b.oi);break;}break;}}if(Y.length===0&&!a){Y.push(C.call(this));}}return{level:Y,filter:f,tranformation:d};},levelCanContinue:true,levelFilterRest:true,conditionEmbedMethod:2,conditionIgnoreFilterElem:true,_set_candidates:function(b,Y){this.candidates=Y;if(this.hasRendered){var E=this.metricLCT.levelInput,Z=this.metricLCT.conditionInput,a=this.metricLCT.transformInput;E.candidates=this.getCandidates4LCT([Q.TP.ATTR,Q.STP.NDE]);Z.candidates=this.getCandidates4LCT([Q.TP.FILTER]);a.candidates=this.getCandidates4LCT([Q.TP.ROLE]);}return true;},getCandidates4LCT:function J(a,E){var Z=this.candidates,Y;if(Z){a=G.ensureArray(a);Y=G.filter(Z.items,function(b){return G.indexOf(a,b.t)>-1||G.indexOf(a,b.st)>-1;});if(G.indexOf(a,12)>-1&&E){if(this.replaceAttributeWithForms){Y=this.replaceAttributeWithForms(Y);}}return{items:Y,isComplete:Z.isComplete};}return null;},updateToggleBarStatus:function I(E){var Y=false;if(E.level){Y=E.level.length>1||E.level.length==1&&E.level[0].did!==-1;}if(E.filter){Y=Y||E.filter.length>0;}if(E.transformation){Y=Y||E.transformation.length>0;}if(U(this.did)){Y=true;}this.metricLCT.toggle.set("selected",Y);},levelAdvRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9577,"Level Advanced Options"),help:"Level_Advanced_Options_dialog_box.htm",cssClass:"mstrmojo-ME-level-options",onOpen:function(){var E=this.opener;this.contentTable.ccCheckBox.set("checked",E.levelCanContinue);this.contentTable.frCheckBox.set("checked",E.levelFilterRest);},children:[{scriptClass:"mstrmojo.Table",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.CheckBox",alias:"ccCheckBox",slot:"0,0",label:mstrmojo.desc(9583,"Allow other users to add extra units to this definition")},{scriptClass:"mstrmojo.CheckBox",alias:"frCheckBox",slot:"1,0",label:mstrmojo.desc(9584,"Include filter attributes which are not in report or level in metric calculation")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveLevelOptions(E.contentTable.ccCheckBox.checked,E.contentTable.frCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},conditionAdvRef:{scriptClass:"mstrmojo.Editor",title:"Condition Advanced Options",help:"Condition_Advanced_Options_dialog_box.htm",cssText:"width: 286px;",onOpen:function(){var E=this.opener;this.contentTable.emPulldown.set("value",E.conditionEmbedMethod);this.contentTable.irfeCheckBox.set("checked",E.conditionIgnoreFilterElem);},children:[{scriptClass:"mstrmojo.Table",cssText:"margin-top:5px;",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.Label",slot:"0,0",text:mstrmojo.desc(9585,"Interaction between metric filter and report filter: ")},{scriptClass:"mstrmojo.Pulldown",alias:"emPulldown",itemField:"n",itemIdField:"did",slot:"1,0",value:2,items:[{n:mstrmojo.desc(9586,"Merge into new"),did:1},{n:mstrmojo.desc(9587,"Merge report filter into metric"),did:2},{n:mstrmojo.desc(9588,"Merge metric condition into report"),did:3}]},{scriptClass:"mstrmojo.CheckBox",alias:"irfeCheckBox",slot:"2,0",label:mstrmojo.desc(9589,"Ignore related report filter elements")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveConditionOptions(E.contentTable.emPulldown.value,E.contentTable.irfeCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},getLCTComponent:function T(){return{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-ME-LCT",alias:"metricLCT",layout:[{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{cssText:"width:252px;padding-right:6px;"}]}],bindings:{visible:function(){return this.parent.isAggFunction;}},labelWidth:"auto",children:[{scriptClass:"mstrmojo.Button",cssClass:"toggle",alias:"toggle",text:mstrmojo.desc(6223,"Show All"),selected:false,bindings:{visible:function(){return !this.parent.parent.isDME;}},onclick:function(E){var Y=!this.selected;this.set("selected",Y);},slot:"0,0"},{scriptClass:"mstrmojo.Label",alias:"lblLevel",text:mstrmojo.desc(4788,"Level"),bindings:{visible:function(){return this.parent.parent.isDME||!this.parent.parent.isDME&&this.parent.toggle.selected;},width:"this.parent.labelWidth"},onwidthChange:function(){if(this.hasRendered){this.domNode.style.width=this.width;}},slot:"1,0"},{scriptClass:"mstrmojo.ME.LevelInputBox",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),alias:"levelInput",dtp:-4,xacptSugItemOnly:true,bindings:{noCache:function(){return this.parent.parent.noCache;},isDME:function(){return this.parent.parent.isDME;},visible:function(){return this.parent.lblLevel.visible;}},reportLevelAdded:true,onadd:function(E){var Y=this.getSelectedObjects();this.set("reportLevelAdded",G.find(Y,"did",-1)>-1);},onremove:function(E){var Y=this.getSelectedObjects();this.set("reportLevelAdded",G.find(Y,"did",-1)>-1);},onitemchange:function(){this.parent.parent.onmetricModify();if(M.updateScrollbars){M.updateScrollbars();}},onSaveOnClose:function(){this.parent.parent.onmetricModify();},slot:"1,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold",text:mstrmojo.desc(9577,"Level Advanced Options"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},onclick:function(){var E=this.parent.parent;E.openPopup("levelAdvRef",{saveLevelOptions:function(Z,Y){E.levelCanContinue=Z;E.levelFilterRest=Y;},zIndex:E.zIndex+10});},slot:"1,1"},{scriptClass:"mstrmojo.Label",alias:"lblCondition",text:mstrmojo.desc(9579,"Condition"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"2,0"},{scriptClass:"mstrmojo.ME.ConditionInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-condition singleObject",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(1281,"Filter").toLowerCase()),alias:"conditionInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblCondition.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();},slot:"2,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold condition",text:mstrmojo.desc(9581,"Condition Advanced Options"),bindings:{visible:function(){return this.parent.lblCondition.visible&&!this.parent.parent.isDME;}},onclick:function(){var E=this.parent.parent;E.openPopup("conditionAdvRef",{saveConditionOptions:function(Z,Y){E.conditionEmbedMethod=Z;E.conditionIgnoreFilterElem=Y;},zIndex:E.zIndex+10});},slot:"2,1"},{scriptClass:"mstrmojo.Label",alias:"lblTransform",text:mstrmojo.desc(3324,"Transformation"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"3,0"},{scriptClass:"mstrmojo.ME.TransformInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-transform",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),alias:"transformInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblTransform.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();if(M.updateScrollbars){M.updateScrollbars();}},slot:"3,1"}]};}});mstrmojo.ME._HasLevel.EnumEditorComponents=X;}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.DBRoleSelector","mstrmojo.ui.Splitter","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.ui.AvailableTablesPanel");var A=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.WHPanel=mstrmojo.declare(mstrmojo.ui.Splitter,null,{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"WHPanel",orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,config:{firstSplit:{v:"300px",min:"100px"},secondSplit:{v:"100%",min:"100px"},resizeHandle:{v:"2px"}},getLayoutOffsets:function C(){return{h:0,w:0};},init:function B(E){this._super(E);var F={},D=F[this.id]={};D[A.DBROLE_SELECTION]=this.onDBRoleSelection;mstrApp.getRootController().attachDataChangeListeners(F);},onDBRoleSelection:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.warehouse.DBRoleSelector",slot:"firstSplitNode",alias:"topPanel"},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",slot:"secondSplitNode",alias:"bottomPanel"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.qb.thirdParty.BISourceSelector","mstrmojo.qb.thirdParty.SourceInput");mstrmojo.requiresDescs(12384);var C="firstSplitNode",H="secondSplitNode";var G=0,B=1;mstrmojo.qb.thirdParty.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.thirdParty.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},onError:mstrmojo.emptyFn,loadView:mstrmojo.emptyFn,toggleDatabaseView:mstrmojo.emptyFn,viewMode:G,fixedViewSize:null,init:function I(N){this._super(N);var O={},M=O[this.id]={},L,J,K;M.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(O);if(this.viewMode===G&&!mstrApp.isCloudPro){this.viewMode=B;K=mstrApp.container.size;if(K){L=parseInt(K.w,10);J=parseInt(K.h,10);}this.fixedViewSize=(!isNaN(L)&&!isNaN(J))?{w:L+"px",h:J+"px"}:{w:"1006px",h:"540px"};}if(this.viewMode===B){this.getBrowserDimensions=function P(){return this.fixedViewSize;};}},preBuildRendering:function F(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size});},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"40%",min:"335px",max:undefined},secondSplit:{v:"60%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function E(){return{h:0,w:48};},slot:"layout",alias:"main",children:[{scriptClass:"mstrmojo.qb.thirdParty.BISourceSelector",slot:C,alias:"srcSelector"},{scriptClass:"mstrmojo.qb.thirdParty.SourceInput",slot:H,alias:"srcInput"}]}],adjustSize:function(K){var L=K.size,N=mstrApp.isCloudPro,P=N?40:0,O=N?180:104;var M=parseInt(L.w,10)-P+"px",J=parseInt(L.h,10)-O+"px";if(this.height&&J!==this.height){this.set("height",J);}else{this.height=J;}if(this.width&&M!==this.width){this.set("width",M);}else{this.width=M;}return true;},getSrcCnt:function(){return this.main.srcInput.children.length;},getSrcUrls:function D(){return this.main.srcInput.getSrcs();},removeSrcs:function A(J){this.main.srcInput.removeSrcs(J);}});}());(function(){mstrmojo.requiresCls("mstrmojo.form","mstrmojo.hash","mstrmojo.Obj","mstrmojo.architect.ui.editors.NameEditor","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.obj.DBRole","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.warehouse.ui.editors.CatalogSQLEditor","mstrmojo.DI.DIConstants");var O=mstrmojo.hash,L=mstrmojo.func.wrapMethods,M=mstrmojo.warehouse.EnumDataChangeEvents,Q=M.DBTABLES_CHANGED,t=mstrmojo.warehouse.EnumObjectTypes,d=t.DBROLE,k=mstrmojo.DI.DIConstants,P,C,Z=57;function l(AG,AF){var AE;if(AG){AE=this.model.getDBRole(AG.did);if(AE){return AE;}}if(AF){AE=new mstrmojo.warehouse.obj.DBRole({mdl:this.model});if(AG&&AG.did){AE.did=AG.did;}return AE;}return null;}function S(){var AE="creating_a_database_connection.htm";if(mstrApp.type===k.xdaType.mdx){AE="Creating_a_data_source_connection_to_an_OLAP_source.htm";}else{if(mstrApp.subtype===k.sourceSubtype.searchOnSource){AE="Creating_a_data_source_connection_to_search.htm";}}return AE;}mstrmojo.warehouse.WHController=mstrmojo.declare(mstrmojo.Obj,null,{start:mstrmojo.emptyFn,getDataService:mstrmojo.emptyFn,loadDBRoles:function D(AE){this.model.loadDBRoles(AE);},isCloud:function R(){return false;},isUsingCookieNamespace:function A(){return this.model.usingCookieNamespace;},getDBRoles:function E(){return this.model.dbrs;},getAllDBRoleNames:function Y(){return this.model.allDBRoleNames;},loadDBObjects:function N(AE){this.model.loadDBObjects(AE);},getDBObjects:function T(){return this.model.dbObjects;},setNameSpaceID:function b(AE){this.model.set("SelNameSpaceID",AE);},getNameSpaceID:function r(){return this.model.SelNameSpaceID;},getNameSpaces:function z(AE){this.model.SelNameSpaceID=undefined;this.model.getNameSpaces(AE);},getColumnsForDBTables:function F(AH,AI){var AE=this.model,AF=AH.tables,AG=AH.getFresh;O.forEach(AF,function(AK){AE.getColumnsForDBTable({data:AK,getFresh:AG},L({success:function AL(AM){AK.items=O.clone(AM.items);},complete:function AJ(){AE.raiseEvent({name:M.DBTABLE_UPDATED,item:AK});}},AI));});},getColumnsForDBTable:function W(AE,AF){if(P&&P.visible){AE.data.dbrole=P.dbRole.did;}this.model.getColumnsForDBTable(AE,AF);},setSelectedDBRoleID:function J(AE){this.model.set("SelDBRoleID",AE.did);},handleDBTableRefresh:function a(AF){var AE=this.model;AE.catalogRefresh=true;this.availableTableSearch("",O.copy(AF,{sourceInfo:"tablesPanel"}));},sqls:undefined,getCurrentZIndex:function X(){if(mstrApp.sessionManager){return mstrApp.sessionManager.zIndex;}return undefined;},displayCatalogSQL:function u(AG){var AF=this,AE=this.model,AH=AG||AE.SelDBRoleID;P=P||new mstrmojo.warehouse.ui.editors.CatalogSQLEditor({help:"defining_tables_are_retrieved_and_cached_for_a_data_source.htm"});AF.getDataService().catalogAction({success:function AI(AK){P.options=AK.options;P.SQLStatements=AK.sqls;AE.getDBRole(AH).populate(function AJ(AM){P.dbRole=AM;P.supportsNameSpaces=AM.supportsNameSpaces;P.onUpdateInfo=function AO(AP){AF.getDataService().catalogAction({success:function AQ(){if(AE.SelDBRoleID===AH&&AE.SelNameSpaceID){AF.availableTableSearch("",{sourceInfo:"tablesPanel"});}}},{dbrid:AH,info:JSON.stringify(AP.options),flags:10003});};var AN=AF.getCurrentZIndex(),AL={};if(AN){AL.zIndex=AN+1;}P.open(null,AL);});}},{dbrid:AH,flags:10002});},attachDataChangeListeners:function g(AF){var AE=this.model;O.forEach(AF,function(AG,AH){O.forEach(AG,function(AJ,AI){AE.attachEventListener(AI,AH,AJ);});});},editDBRole:function c(AE,AG){var AF=this;l.call(this,AE,true).populate(function(AH){AF.loadDBObjects({success:function AI(){C=C||new mstrmojo.warehouse.dbroles.DBRoleEditor({help:S()});C.config=AF.model.dbRoleEditorCfg;C.config.showAddDriver=AF.model.showAddDriver;C.callback=AG||mstrmojo.emptyFn;C.dbrole=AH;C.container.dsninfo.clear();C.open();}});});},renameDBRole:function AD(AE){l.call(this,AE,false).populate(function(AF){if(!AF){return ;}var AH=new mstrmojo.architect.ui.editors.NameEditor({data:AF,tp:d,zIndex:9999,isNew:false,help:S(),onOK:function AG(AI){AF.rename(AI);}});AH.open();});},duplicateDBRole:function o(AE){var AF=this;l.call(AF,AE,false).populate(function(AG){if(!AG){return ;}AG.duplicate();});},deleteDBRole:function K(AE){var AF=this;l.call(AF,AE,false).populate(function(AH){var AG=mstrmojo.Button.newInteractiveButton;if(!AH){return ;}mstrmojo.confirm(mstrmojo.desc(10073,"Are you sure you want to delete the Database Connection")+" "+AH.n+"?",null,{buttons:[AG(mstrmojo.desc(219,"Yes"),function AI(){AF.model.deleteDBRole(AH.mdDBRole.did,{success:function AJ(){}});},null,{iconClass:"mstrmojo-Editor-button-Yes"}),AG(mstrmojo.desc(218,"no"),null,null,{iconClass:"mstrmojo-Editor-button-No"})],title:mstrmojo.desc(3169,"delete"),zIndex:9999});});},setProjectPrimaryDBRole:function e(AF,AG){var AE=this.model;AE.SelDBRoleID=AF.did;AE.setProjectPrimaryDBRole(true,AG);},getProjectPrimaryDBRoleID:function I(){return this.model.projPrimaryDBRoleID;},saveDBRole:function G(AF,AE,AI){var AG=this;AG.model.saveDBRole(AF.mdDBRole,AE,L(AI,{success:function AH(AK){var AL=AK.dbr.did,AM=AK.dbr.n,AJ=l.call(AG,{did:AL},true);AJ.populated=false;AJ.n=AM;}}));},populateDBRole:function V(AE,AF){this.model.populateDBRole(AE,AF);},navigateProject:function h(AE){if(AE){mstrmojo.form.send({evt:3010,Server:AE.sname,Project:AE.pname,Port:AE.port,loginReq:true},mstrApp.name,"POST",null,null,false);}else{mstrmojo.form.send({evt:3010},mstrApp.name,"POST",null,null,false);}},navigateArchitect:function AC(AE){mstrmojo.form.send({evt:3176,Server:AE.sname,Project:AE.pname,Port:AE.port,loginReq:true},mstrApp.name,"POST",null,null,false);},availableTableSearch:function x(AE,AF){this.model.getSelectedDBRoleTables(L({blockBegin:0,blockCount:1000,filterText:AE},AF||{}));},getPrimaryDBRoleTablesAndColumns:function AB(AE){this.model.getDBRoleTablesAndColumns({dbRoleID:this.model.projPrimaryDBRoleID},AE);},hasPrivilege:function f(AE){return mstrApp.isSingleTier||this.model.privileges[AE]||false;},validateName:function U(AG,AE,AF,AH){return this.model.validateName(AG,AE,AF,AH);},findNextName:function w(AE,AF,AG){return this.model.findNextName(AE,AF,AG);},findinArray:function AA(AE,AG,AF){return this.model.findinArray(AE,AG,AF);},getObjectCount:function B(AG){if(Object.keys){return Object.keys(AG).length;}var AE,AF=[];for(AE in AG){if(AG.hasOwnProperty(AE)){AF.push(AE);}}return AF.length;},destroy:function q(AE){if(C){C.destroy(AE);C=null;}this._super(AE);},cleanError:function n(AE){AE=AE.replace("com.microstrategy.webapi.MSTRWebAPIException:","");AE=AE.replace("Internal Error:","");return mstrmojo.string.trim(AE);},launchOneTierFileBrowser:function j(AE){window.FormWrapper.openFileDialog(AE);},launchOneTierAccessFileBrowser:function j(AE){window.FormWrapper.openAccessDialog(AE);},oneTierFileUploader:function m(AF,AE){mstrApp.serverRequest(O.copy(AE,{taskId:"addDriver"}),AF,true);},clearDBTables:function H(){this.model.raiseEvent({name:Q,items:[],selectedItems:[]});},canDisplayCatalogSQL:function p(AI,AH){var AE=mstrmojo.hash.valarray(AI),AG=mstrmojo.array.find(AE,"v",AH),AF=AE[AG];if(mstrApp.isSingleTier){return false;}if((AF.disp&2)===2||(AF.disp&4)===4){return false;}if(!this.hasPrivilege(Z)){return false;}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.mdx.DataService","mstrmojo.warehouse.WHController","mstrmojo.qb.QBHelpers");var O=mstrmojo.hash,I=mstrmojo.qb.QBHelpers,S=mstrmojo.DI.DIConstants;function B(X){var Y=mstrApp.diShowFooterFunction;if(Y){Y({finish:{visible:X}});}}function H(a){var Z=a.SelDBRoleID;var c=a.dbrs;var b;var Y;var X;for(b=0;b<c.length;b++){if(Z===c[b].did){Y=c[b].n;break;}}X=a.cubes[0].n;return{name:X,desc:Y};}mstrmojo.qb.mdx.Controller=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{start:function G(){var b=this.rootView,X=this.model,Y,d,a,Z;this.dataService=mstrmojo.qb.mdx.DataService;b.render();this.toggleDatabaseView(true);X.loadDBTypeFilters({success:function c(){X.loadDBRoles({success:function e(){B(true);X.initialize();}});}});Y=mstrApp.diFooterID;d=Y?mstrmojo.all[Y]:undefined;if(d){a=d.next;Z=d.finish;X.attachEventListener("refreshTables",a.id,d.enableButton);X.attachEventListener("refreshTables",Z.id,d.enableButton);setTimeout(function(){d.mdxRA.update();},0);}},getDataService:function J(){return this.dataService;},toggleDatabaseView:function W(X){this.rootView.toggleDatabaseView(X);},addCubes:function N(X){this.model.addCubes(X);},addTables:function K(X){this.model.addCubes(X);},removeCube:function P(X){this.model.removeCube(X);},updateCube:function U(X){this.model.updateCube(X);},handleDBTableRefresh:function R(){var Y=this.model,X=Y.SelDBRoleID;Y.catalogRefresh=true;Y.onSelNameSpaceIDChange({value:Y.SelNameSpaceID});},attachDataChangeListeners:function M(Y){var X=this.model;O.forEach(Y,function(Z,a){O.forEach(Z,function(c,b){X.attachEventListener(b,a,c);});});},detachDataChangeListeners:function E(Y){var X=this.model;mstrmojo.array.forEach(Y,function(Z){X.detachEventListener(Z);});},onCancelButtonClick:function F(){mstrApp.container.unloadQB();mstrApp.getRootController().onCancelButtonClick();},onFinishButtonClick:function T(){var X=this.model,Y={};Y.onOK=function(a){if(a){X.folderID=a.folderID;X.cubeDesc=a.objDesc;X.cubeName=a.objName;}X.commitChanges({success:function Z(e){var c=mstrApp.msgid,d=X.isManagedCube,j,b;mstrApp.container.unloadQB();mstrApp.messageID=c;mstrApp.isDDA=true;mstrApp.saveCubeParams=a;mstrApp.isManagedCube=d;j=mstrApp.getRootController();if(X.isNew){j.getDDAController().setDirectDataAccess(mstrApp.isDDA);j.dataService.set("messageID",mstrApp.messageID);j.model.isManagedCube=mstrApp.isManagedCube;b=j.model;b.cubeName=H(X).name;if(mstrApp.isSingleTier){var g={isDirectDataAccess:b.isDirectDataAccess},h={success:function(k){if(k.objectId){b.cubeID=k.objectId;}j.wrapUpDataImport();},failure:function(k){mstrApp.hideProgress();j.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,k&&k.message);}},f={success:function(){j.dataService.createOneTierDoc(h,g);},failure:function(k){mstrApp.hideProgress();j.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,k&&k.message);}};if(b.operationMode===S.operationMode.edit||b.operationMode===S.operationMode.refresh){j.dataService.duplicateReportInstance(f,{messageID:b.analysisID,datasetID:b.cubeID,duplicateRIMsgID:j.dataService.messageID});}else{j.dataService.createOneTierDoc(h,g);}return ;}if(d){j.wrapUpDataImport();return ;}b=j.model;if(e&&e.objectId){b.cubeID=e.objectId;}b.path=a&&a.objPath;j.wrapUpDataImport();}else{j.wrapUpDataImport();return ;}}});};if(!X.isManagedCube&&X.isNew&&!mstrApp.isSingleTier){I.showSaveAsDialog(Y,H(this.model));}else{Y.onOK();}},onBackButtonClick:function A(){mstrApp.container.unloadQB();mstrApp.getRootController().backFromQB();},exitApplication:function D(){mstrApp.container.unloadQB();mstrApp.getRootController().exitApplication();},onHelpButtonClick:function Q(){mstrApp.showHelpTopic("importing_data_from_an_OLAP_source.htm");},getProjectPrimaryDBRoleID:function V(){return this.model.SelDBRoleID;},setRecursive:function L(X){this.model.set("recursive",X);},getRecursive:function C(){return this.model.recursive;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.es.DataService","mstrmojo.warehouse.WHController","mstrmojo.qb.es.AlternateSourceDialog","mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog","mstrmojo.qb.QBHelpers","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12379,12380,2171,9614,9621,1395,9613,9619,2265,8002,9612,9623,9616,9611,9622,9615,2052,2170,9620,9617,9618,5471,4444);var b=mstrmojo.array,U=mstrmojo.hash,e=mstrmojo.qb.QBHelpers,L=mstrmojo.desc,c=mstrmojo.DI.DIHelpers,j=mstrmojo.qb.EnumQBAppType,O=mstrmojo.DI.DIConstants;var h=1,R="mstr-qb-alternatesource";var H={1:L(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),2:L(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this.")};function E(n){var o=mstrApp.diShowFooterFunction;if(o){o({finish:{visible:n}});}}function I(n,p){var o;o=mstrmojo.all[R]||(new mstrmojo.qb.es.AlternateSourceDialog({id:R}));if(p){o.set("zIndex",p);}o.items=n;o.open();}var G={0:L(2171,"Default"),1:L(9614,"Integer"),2:L(9621,"Unsigned"),3:L(1395,"Numeric"),4:L(9613,"Decimal"),5:L(9619,"Real"),6:L(2265,"Double"),7:L(8002,"Float"),8:L(9612,"Char"),9:L(9623,"VarChar"),10:L(9616,"Long VarChar"),11:L(9611,"Binary"),12:L(9622,"VarBin"),13:L(9615,"Long VarBin"),14:L(2052,"Date"),15:L(2170,"Time"),16:L(9620,"TimeStamp"),17:L(9617,"NChar"),18:L(9618,"NVarChar"),30:L(5471,"Big decimal")};function P(n){return G[n]||L(4444,"Unknown");}function C(x){var u=[],r,t,w,z,n,p,q,o;b.forEach(x,function(AA){r=t=w=z="";p=(AA.vt===3)?1:0;switch(AA.vt){case 0:case 1:case 2:case 3:r=AA.n;t=P(AA.ddt);n=AA.src;w=n.n;z=P(n.ddt);break;case 4:r=AA.n;t=P(AA.ddt);break;case 8:n=AA.src;w=n.n;z=P(n.ddt);break;}q=t?r+"("+t+")":r;o=z?w+"("+z+")":w;u.push([q,p,o]);});return u;}function X(o){var n=[];b.forEach(o.tables,function(p){n.push(p.dbtn||"");});return{name:c.generateCubeName(n)};}mstrmojo.qb.es.Controller=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{ddaController:null,start:function V(){var r=this.rootView,p=this.model,q=this,n,t,o,x;this.dataService=mstrmojo.qb.es.DataService;if(mstrApp.emmaIRRMessageID){this.dataService.emmaIRRMessageID=mstrApp.emmaIRRMessageID;}r.render();this.toggleDatabaseView(true);var u=function u(){q.loadDBRoles({success:function z(){var AA;AA=(mstrApp.emmaTablesNum===0);E(AA);if(mstrApp.tableID&&mstrApp.msgid){p.loadTable(mstrApp.tableID);}else{if(!q.model.isForAlternateSource&&!mstrApp.msgid){q.dataService.createEmmaInstance({success:function AB(AC){mstrApp.msgid=AC.msgid;}});}}}});};if(p.specifyDBTypes){p.dbObjects.populateDBProperties({success:function w(){u();}});}else{p.loadDBTypeFilters({success:function w(){u();}});}n=mstrApp.diFooterID;t=n?mstrmojo.all[n]:undefined;if(t){o=t.next;x=t.finish;p.attachEventListener("refreshTables",o.id,t.enableButton);p.attachEventListener("refreshTables",x.id,t.enableButton);}},getCurrentZIndex:function W(){return mstrApp.diCurrentZIndex;},getDataService:function M(){return this.dataService;},toggleDatabaseView:function g(n){this.rootView.toggleDatabaseView(n);},openHelp:function Q(){var n=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/MicroStrategy_Web_Help.htm#"+(mstrApp.isFFSQL?"freeform_import_page.htm":"database_import_page.htm");window.open(n);},addTable:function a(n){this.model.addTable(n);},addTables:function d(n){this.model.addTable(n);},removeTable:function T(n){this.model.removeTable(n);},removeDBRoleTables:function k(n){if(mstrApp.type===j.EmmaSingleTable){this.model.removeDBRoleTables(n);}},cancel:function F(){if(!mstrApp.isFromDI){var n=mstrApp.origin?"-2":"-1";mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:n},mstrApp.name,"POST",null,null,false);}},commitChanges:function Z(){this.model.commitChanges({success:function n(o){var p=o.msgid;mstrmojo.form.send({evt:"3172",messageID:p,launchingApp:"QB"},mstrApp.name,"POST",null,null,false);}});},onNextButtonClick:function K(){this.model.commitChanges({success:function n(q){var o=mstrApp.getRootController().model,r=o.isDDA,p=o.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=q.msgid;mstrApp.isDDA=r;mstrApp.isManagedCube=p;mstrApp.getRootController().afterQBProcess();}});},saveDDACube:function m(o){var p=this.model,q={},r;r={success:function(AB){var t=mstrApp.msgid,w=p.isDDA,x,AC,z,AA,u,AD=p.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=t;mstrApp.isDDA=w;mstrApp.isManagedCube=AD;x=mstrApp.getRootController();AC=x.model;x.getDDAController().setDirectDataAccess(mstrApp.isDDA);x.dataService.set("messageID",mstrApp.messageID);AC.isManagedCube=mstrApp.isManagedCube;AC.cubeName=X(p).name;if(mstrApp.isSingleTier){z={isDirectDataAccess:AC.isDirectDataAccess,name:AC.cubeName};AA={success:function(AE){if(AE.objectId){AC.cubeID=AE.objectId;}x.wrapUpDataImport();},failure:function(AE){mstrApp.hideProgress();x.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,AE&&AE.message);}};u={success:function(){x.dataService.createOneTierDoc(AA,z);},failure:function(AE){mstrApp.hideProgress();x.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,AE&&AE.message);}};if(AC.operationMode===O.operationMode.edit||AC.operationMode===O.operationMode.refresh){x.dataService.duplicateReportInstance(u,{messageID:AC.analysisID,datasetID:AC.cubeID,duplicateRIMsgID:x.dataService.messageID});}else{x.dataService.createOneTierDoc(AA,z);}return ;}if(AD){x.wrapUpDataImport();return ;}AC=x.model;if(AB&&AB.objectId){AC.cubeID=AB.objectId;}AC.path=o&&o.objPath;x.wrapUpDataImport();}};function n(){if(p.isManagedCube){r.success();return ;}q.displayMode=12;q.shouldRefresh=false;if(p.isDDA){q.shouldRefresh=false;q.saveAsFlags=O.saveAsFlags.saveAsDDA|O.saveAsFlags.saveAsOverWrite;}else{q.saveAsFlags=O.saveAsFlags.saveAsInMemory|O.saveAsFlags.saveAsOverWrite;}q.taskId="saveAndPublishCube";q.showWait=true;q=U.copy(o,q);q.saveAsOverwrite=true;delete q.objPath;mstrApp.getRootController().model.submitRequest(r,q);}mstrApp.getRootController().model.submitRequest({success:function(){if(p.operationMode!==2){mstrApp.getRootController().model.submitRequest({success:function(){n();}},{taskId:"DIClearRelationshipEMMASourceTable",showWait:true});}else{n();}}},{taskId:"DIToggleDatasetServeMode",serveMode:p.isDDA?O.datasetServeMode.dda:O.datasetServeMode.inMemory,showWait:true});},handleFinish:function N(){var n=this.model,p=this,o=n.operationMode,q={};q.onOK=function(t){n.commitChanges({success:function r(x){var u=x.msgid,z=n.isDDA,w=n.isManagedCube;if(z&&o!==1){p.saveDDACube(t);}else{mstrApp.container.unloadQB();mstrApp.messageID=u;mstrApp.isDDA=z;mstrApp.saveCubeParams=t;mstrApp.isManagedCube=w;mstrApp.getRootController().afterQBProcess(true);}}});};if(o===1){q.onOK();}else{if(!n.isManagedCube&&!mstrApp.isSingleTier){e.showSaveAsDialog(q,X(this.model));}else{q.onOK();}}},onFinishButtonClick:function l(){var o=this,n=this.model,q=o.getDDAController(),w,u,p,t=mstrApp.diCurrentZIndex,r=t?t+1:10;b.forEach(n.tables,function(x){if(x.extt||x.hanai){u=true;n.isDDA=true;}});if(!n.origIsDDA&&q.allowDDA()&&!u){w={onOK:function(){o.handleFinish();}};p={callback:w,selectedIndex:n.isDDA?0:1,zIndex:r};q.showDDAConfirmDialog(p);return ;}this.handleFinish();},onBackButtonClick:function S(){mstrApp.container.unloadQB();mstrApp.getRootController().backFromQB();},onCancelButtonClick:function f(){this.exitApplication();},exitApplication:function D(){mstrApp.container.unloadQB();mstrApp.getRootController().onCancelButtonClick();},getTableErrorMsg:function(){return this.model.addTableErrorMsg;},selectAlternateSource:function Y(w,z,q){var t=this,x=t.dataService,r=this.model,AA=r.tables,AB,p,n,o=null,u={zIndex:q+1000};if(AA.length===0){return ;}AB=AA[0];if(z.failure){o=function(AC){z.failure(AC);};}p={success:function(){var AC;mstrApp.hasEditEmmaIRRSource=true;AC={success:function(AF){var AG,AE,AH,AD;if(AF.vt===1){AE=mstrApp.msgid;AH=x.emmaIRRMessageID;mstrApp.container.unloadQB();AG=mstrApp.getRootController().dataService;mstrApp.messageID=AE;if(AE){AG.set("messageID",AE);}if(AH){AG.set("emmaIRRMessageID",AH);}if(z.success){z.success({tableName:AB.n});}}else{AD=C(AF.cols);I(AD,q);}},failure:o};x.validateEmmaIRRAlternateSource(AC,{tbid:w,alertCfg:u});},failure:o};n={sourceType:h,tables:w,deleteTables:"0",dbRoleID:AB.dbr,dbTableName:AB.n,alertCfg:u};if(AB.ns){n.dbNamespace=AB.ns;}x.editEmmaIRRSourceTable(p,n);},getDDAController:function J(){if(this.ddaController===null){this.ddaController={shouldAskUser:true,allowDDA:function r(){var z=mstrApp.getRootController().model,x=null,AB=!!z.canSupportDDA,w,AA=z.tables;if(!AB){return false;}if(AA.length>0){x=AA[0].dbr;}w=z.dbridForDDA;if(w&&x!==null&&w!==x){AB=false;}if(!AB){return false;}b.forEach(AA,function(AC){if(AC.dbr!==x){AB=false;return false;}return true;});return AB;},onlyAllowDDA:function u(){return !!mstrApp.getRootController().model.shouldSupportDDA;},onToggleDDA:function n(AA){var x=mstrApp.getRootController().model,w=0,z;if(x.isDDA===AA){return ;}if(AA){x.set("isDDA",true);if(!this.allowDDA()){w=1;z=false;}}else{x.set("isDDA",false);if(this.onlyAllowDDA()){w=2;z=true;}}if(w){mstrmojo.qb.alert(H[w]);x.set("isDDA",z);}},checkDDACheckbox:function p(z){var w=mstrApp.getRootController().model.ddaCheckboxID,x;if(w){x=mstrmojo.all[w];if(x){x.set("checked",z);}}},tryEnableDDACheckbox:function q(z){var w=mstrApp.getRootController().model.ddaCheckboxID,x;if(w){x=mstrmojo.all[w];}if(!x||!x.visible){return ;}if(!z){if(x.enabled&&!x.checked&&!this.allowDDA()){x.set("enabled",false);}}else{if(!x.enabled&&!x.checked&&this.allowDDA()){x.set("enabled",true);}}},askUserAboutDDA:function t(w){if(w){this.shouldAskUser=false;}return this.shouldAskUser;},showDDAConfirmDialog:function o(w){var x=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog(w||{});x.open();}};}return this.ddaController;},onHelpButtonClick:function A(){mstrApp.showHelpTopic(this.model.getHelpTopic());},selectDBRole:function B(p){var o,n;if(!p){return ;}o=this.rootView.getDBConnectionList();n=b.find(o.items,"did",p);if(n>=0){o.set("selectedIndex",n);o.adjustScrollPosition(n);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.Label","mstrmojo.warehouse.DBRoleSelector","mstrmojo.warehouse.WHPanel","mstrmojo.warehouse.ui.AvailableTablesPanel");var B=mstrmojo.dom,C=mstrmojo.css,I=mstrmojo.warehouse.EnumDataChangeEvents;function A(O){var N="mstr-qb-oAuthSourcelogout",K=document.getElementById(N),J=mstrApp.getRootController().model,L=J.tableID,M=mstrApp.getRootController().getDataService();if(!K){K=document.createElement("IFRAME");K.id=N;document.body.appendChild(K);K.style.display="none";B.attachEvent(K,"load",function(Q){var R={};var P=function P(){M.signOutOAuthSource({success:function S(){mstrApp.getRootController().handleLogout();}},R);};R.dbRoleID=mstrApp.dbrid;if(mstrApp.said){R.sourceAccountID=mstrApp.said;}if(J.isNew&&L){M.removeEmmaTable({success:P},{did:L});}else{P();}});}K.src=O;}mstrmojo.qb.bigquery.BigQuerySignOut=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.bigquery.BigQuerySignOut",cssClass:"mstrmojo-qb-bigquery-signout",bindings:{visible:function(){var K=mstrmojo.qb.EnumQBAppType,J=mstrApp.type;return J===K.BigQuery||J===K.BigQueryFFSQL||J===K.BigQuerySingleTable;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"username",postCreate:function F(){if(this._super){this._super();}this.set("text",mstrApp.userEmail||"");}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12735,"Sign Off..."),cssClass:"signout",onclick:function H(){A("https://www.google.com/accounts/logout");}}]});mstrmojo.qb.bigquery.DBRoleSelector=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.bigquery.DBRoleSelector",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{bqSignOutNode:function(){return this.domNode.children[0];},dbSelectorNode:function(){return this.domNode.children[1];}},slot:"firstSplitNode",alias:"topPanel",children:[{scriptClass:"mstrmojo.qb.bigquery.BigQuerySignOut",alias:"bqSignOut",slot:"bqSignOutNode"},{scriptClass:"mstrmojo.warehouse.DBRoleSelector",alias:"dbSelector",slot:"dbSelectorNode"}],init:function G(J){if(this._super){this._super(J);}var K=this.dbSelector.dbConnections;K.onclick=function(M){try{var P=M.target||B.eventTarget(M.hWin,M.e),O=B.findAncestorByAttr(P,"idx",true,this.domNode),L=O&&parseInt(O.value,10);if(P.className==="item-mn"&&L!==null&&!isNaN(L)){return false;}if(L!==null){mstrmojo.warehouse.ui.DBConnectionsList.prototype.onclick.call(K,M);}}catch(N){throw N;}};},setDimensions:function D(N,K){var J=parseInt(N,10);var M=parseInt(K,10),L;if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}L=this.layoutConfig;if(this.bqSignOut.visible){L.h.bqSignOutNode="38px";L.h.dbSelectorNode=(J-38)+"px";}else{L.h.dbSelectorNode=J+"px";}L.w.bqSignOutNode=M+"px";L.w.dbSelectorNode=M+"px";if(this._super){this._super(J+"px",K);}}});mstrmojo.qb.bigquery.BigQueryWHPanel=mstrmojo.declare(mstrmojo.warehouse.WHPanel,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.bigquery.BigQueryWHPanel",cssClass:"mstrmojo-qb-whpanel",children:[{scriptClass:"mstrmojo.qb.bigquery.DBRoleSelector",slot:"firstSplitNode",alias:"topPanel"},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",slot:"secondSplitNode",alias:"bottomPanel"}],init:function G(K){if(this._super){this._super(K);}var L={},J,M;J=L[this.id]={};M=this.bottomPanel;J[I.DBROLE_SELECTION]=function(N){if(M.refreshBtn){C.toggleClass(M.refreshBtn.domNode,"hidden",false);}};mstrApp.getRootController().attachDataChangeListeners(L);},preBuildRendering:function E(){if(this._super){this._super();}var J,K;J=this.topPanel.dbSelector;K=this.bottomPanel;J.title=mstrmojo.desc(37,"Projects");J.cssClass="bigquery-projects";K.title=mstrmojo.desc(12569,"Available Datasets");K.cssClass="AvailableTables bigquery-datasets";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.qb.es.TableDropbox","mstrmojo.warehouse.WHPanel");mstrmojo.requiresDescs(531,12384,14083);var D=mstrmojo.desc,C=mstrmojo.dom,R=mstrmojo.array;var S="firstSplitNode",P="secondSplitNode";var W=0,I=1;var N="idx",A="li";var M=D(12384,"LIVE Data Connection does NOT support connection to multiple Database Instances currently. Please uncheck LIVE Data Connection to add table(s) from this Database Instance.");var L=D(14083,"The following table(s) cannot be added since they are not Information Views: ###");function J(a){var Y=document.createElement("div"),g=C.findAncestorByAttr(a,N,true,this.domNode),e='<div class="item-ic"></div><div class="item-n" title="" style="max-width: 340px">{@n}</div><div class="item-del"></div>',b,f,X;function c(h){b=document.createElement("div");b.className="item cf";b.innerHTML=e.replace("{@n}",h).replace("\n","");return b;}if(g&&g.node){var Z=this.userSelections;if(Z[g.value]){var d=this.domNode.getElementsByTagName(A);R.forEach(d,function(h){X=h.getAttribute(N);if(Z[X]===true){f=this.items[X].n;b=c(f);Y.appendChild(b);}},this);}else{f=this.items[parseInt(g.value)].n;b=c(f);Y.appendChild(b);}Y.appendChild(document.createElement("div"));}Y.className="mstrmojo-qb-emma-tablelist";return Y;}function F(a,X){var Z=this.avatar.style,Y=this.restrictedToAxis;if(Y!=="y"){Z.left=a.x+1+"px";}if(Y!=="x"){Z.top=a.y+1+"px";}}mstrmojo.qb.es.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.es.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},onError:mstrmojo.emptyFn,init:function O(a){this._super(a);var b={},Z={},Y;b[this.id]=Z;Z.directDataAccessTableError=this.onTableAdded;Z.maxTableError=this.onTableAdded;Z.SapHanaIncompatibleTypeError=this.onTableAdded;Z.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(b);var c=this.getDBRoleSelector();var X=this.main.children[0].bottomPanel;X.getLayoutOffsets=function(){return{h:32,w:0};};c.getLayoutOffsets=function(){return{h:32,w:0};};X.searchBox.widthOffset=21;X.nameSpaces.heightOffset=35;c.heightOffset=31;X.heightOffset=31;c.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");Y=X.dbTableTree;Y.createAvatarFunc=J;Y.positionAvatarFunc=F;Y.showTablesNum=false;},getDBRoleSelector:function G(){return this.main.children[0].topPanel;},getDBConnectionList:function H(){return this.getDBRoleSelector().dbConnections;},preBuildRendering:function B(){if(this._super){this._super();}if(this.viewMode===I){if(this._listenerProc){mstrmojo.dom.detachEvent(window,"resize",this._listenerProc);this._listenerProc=null;}}},onTableAdded:function K(X){var Y="",Z=[];switch(X.name){case"maxTableError":Y=mstrApp.getRootController().getTableErrorMsg();break;case"directDataAccessTableError":Y=M;break;case"SapHanaIncompatibleTypeError":R.forEach(X.data,function(a){Z.push(a.n);});Y=L.replace("###",Z.join(", "));break;}mstrmojo.qb.alert(Y,null,null,null,this.alertCfg);},renderPageLoadError:function E(){var Z=this.error,Y=Z.message,a=Z.title,X=Z.btns;this.onError(Z);if(!X||!X.length){mstrmojo.alert(Y,null,a);}else{mstrmojo.confirm(Y,null,{buttons:X,title:a});}},render:function V(){if(this.error){this.renderPageLoadError();}else{this._super();}},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"50%",min:"350px",max:undefined},secondSplit:{v:"50%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function T(){return{h:0,w:36};},slot:"layout",alias:"main",toggleDatabaseView:function U(X){this.toggleFirstItemVisibility(X);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"mstrmojo-qb-es-whpanel",slot:S,orientation:mstrmojo.ui.Splitter.ENUM_OR.HORIZONTAL,config:{firstSplit:{v:"50%",min:"200px"},secondSplit:{v:"50%",min:"200px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.qb.es.TableDropbox",slot:P}]}],toggleDatabaseView:function U(X){this.main.toggleDatabaseView(X);},adjustSize:function(Y){var Z=Y.size,b=mstrApp.isCloudPro,d=b?40:0,c=b?180:104;var a=parseInt(Z.w,10)-d+"px",X=parseInt(Z.h,10)-c+"px";if(this.height&&X!==this.height){this.set("height",X);}else{this.height=X;}if(this.width&&a!==this.width){this.set("width",a);}else{this.width=a;}return true;},postBuildRendering:function Q(){if(this._super){this._super();}if(mstrApp.size){this.adjustSize({size:mstrApp.size});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.warehouse.WHPanel","mstrmojo.qb.mdx.CubeDropbox","mstrmojo.hash");mstrmojo.requiresDescs(531,12932,12923,12941);var B=mstrmojo.hash;var D="firstSplitNode",J="secondSplitNode";var C=1;mstrmojo.qb.mdx.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.mdx.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},viewMode:C,init:function K(P){this._super(P);var R={};R[this.id]={maxCubeError:this.onErrorDisplay};R[this.id].windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(R);var L=this.main.whPanel;L.topPanel.title=mstrmojo.desc(12923,"MDX Connections");L.bottomPanel.title=mstrmojo.desc(12941,"Browse Catalog");L.bottomPanel.dbTableTree.getDragAction=function Q(V){var W=this.getNodeAttributes(V.src.node),U=W&&this.getTreeItem(W.index);if(U&&U.cubetp){return"addCube";}};this.getBrowserDimensions=function T(){return{w:"1010px",h:"552px"};};var O=L.bottomPanel;O.searchBox.widthOffset=21;var M=this.getDBRoleSelector();M.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");O.getLayoutOffsets=function(){return{h:32,w:0};};M.getLayoutOffsets=function(){return{h:32,w:0};};O.heightOffset=59;var S=O.dbTableTree,N=B.clone(S.tablesTreeHooks);N.isTable=function(U){return U&&U.cubetp;};S.tablesTreeHooks=N;},getDBRoleSelector:function H(){return this.main.children[0].topPanel;},preBuildRendering:function I(){var L=true;if(this._super){L=this._super();}if(this.viewMode===C){if(this._listenerProc){mstrmojo.dom.detachEvent(window,"resize",this._listenerProc);this._listenerProc=null;}}return L;},onErrorDisplay:function E(L){var M="";if(L.name==="maxCubeError"){M=mstrmojo.desc(12932,"A dataset can have only a single OLAP cube. Please create another dataset to import the second OLAP cube.");}mstrmojo.qb.alert(M,null,null,null,this.alertCfg);},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"50%",min:"350px",max:undefined},secondSplit:{v:"50%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function G(){return{h:0,w:36};},slot:"layout",alias:"main",toggleDatabaseView:function F(L){this.toggleFirstItemVisibility(L);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"mstrmojo-qb-es-whpanel mdx-panel",alias:"whPanel",slot:D,orientation:mstrmojo.ui.Splitter.ENUM_OR.HORIZONTAL,config:{firstSplit:{v:"50%",min:"200px"},secondSplit:{v:"50%",min:"200px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.qb.mdx.CubeDropbox",slot:J}]}],toggleDatabaseView:function F(L){this.main.toggleDatabaseView(L);},adjustSize:function(M){var N=M.size,P=mstrApp.isCloudPro,R=P?40:0,Q=P?180:104;var O=parseInt(N.w,10)-R+"px",L=parseInt(N.h,10)-Q+"px";if(this.height&&L!==this.height){this.set("height",L);}else{this.height=L;}if(this.width&&O!==this.width){this.set("width",O);}else{this.width=O;}return true;},postBuildRendering:function A(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.DataGrid","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.ObjectInputBox","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME._HasLevel","mstrmojo.ME._HasSortBy","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(629,2148,3377,9582,12173,12179,12852);var J=mstrmojo.hash,l=mstrmojo.array,M=mstrmojo.expr,h=mstrmojo.ME._MetricEditorHelper,A=mstrmojo.ME.MetricDataService,c=mstrmojo.mstr.EnumDSSXMLObjectTypes,o=mstrmojo.ME.Enum.DYNAMIC_DIMTY,O=mstrmojo.ME.Enum.UI_OBJECT_TYPE;var U,X;var e=function(E){if(E.onmetricModify){E.onmetricModify();}},b=function(){if(X.updateScrollbars){X.updateScrollbars();}};var Y=mstrmojo.ME.MetricToken.brackets,L=mstrmojo.ME.MetricToken.quotes,Z=mstrmojo.ME.MetricToken.unquotes;var d=function(){var E={"9C374236DD9F11D3B98100C04F2233EA":"Forecast","9C374233DD9F11D3B98100C04F2233EA":"Growth","9C374233DD9F11D3B98100C04F2233EA":"Trend","677E93B2786B11D4B82F00C04F356781":"Case",C41C34F0786B11D4B82F00C04F356781:"CaseV",B2C0FA4420C711D6AD1400C04F0423DE:"IF","8107C324DD9911D3B98100C04F2233EA":"Not"};return E.hasOwnProperty(this.fctOi.did);};var g=function(t){var r=t.split(",")[0],q=r.replace(/\d$/,""),E=r.replace(q,"");return{prefix:q,startAt:parseInt(E,10)};};var G=function(AA){var z=function(){if(AA.isRepeated){var w=this.parent.dataGrid.ctxtBuilder.itemWidgets[this.parent.idx].labelWidget;if(w){w.set("count",this.getSelectedObjects().length);}}};var q=X.getParamObjectTypes();var E={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"paramInput",slot:"0,0",cssClass:"mstrmojo-ME-param",dtp:AA.dtp,isDME:X.isDME,hideEditButton:function(w){return true;},hideDelButton:function(w){return this.isFull;},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},browsableTypes:q.concat([M.TP.FOLDER]).join(","),folderLinksContextId:17,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),getCandidatesThroughTaskCall:function x(AB,w){AB.objectType=q.join(",");AB.rootFolderType=39;AB.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AB,w);},postCreate:function(AE){var AD=this.parent.dataGrid,AG=AD&&AD.parent;this.noCache=AG.noCache;if(!this.noCache){this.candidates=AG.getCandidates(function(AH){return mstrmojo.array.indexOf(q,AH.t)>-1;});var w=this.candidates.items||[];if(X.isDME){w=X.replaceAttributeWithForms(l.filter(w,function(AH){return l.indexOf(q,AH.t)>-1&&AH.st!==M.STP.NDE;}));}for(var AC=0,AB=(AA.items||[]).length;AC<AB;AC++){var AF=AA.items[AC];if(AF&&AF.t===mstrmojo.ME.Enum.UI_OBJECT_TYPE.Sub_Expression){w.push(AF);}}this.candidates.items=w;if(!AE){AD.candidatesListener.push(this.id);}}if(!AE){this.set("items",AA.items);}},onitemchange:function(){e(this.parent.dataGrid.parent);},onadd:function r(){z.call(this);},onremove:function u(){z.call(this);},obCfg:{folderLinksContextId:17,browsableTypes:q.concat([M.TP.FOLDER]).join(",")}}],getTokens:function(){var AD=this.paramInput.getSelectedObjects(),AE,w=AD.length,AC,AF=[],AB;if(w>0){for(AC=0;AC<w;AC++){AE=AD[AC];if(AE.state===mstrmojo.Enum_OIB_States.VALID&&AE.did){if(AE.t===O.Sub_Expression){AF=AF.concat(AE.tks);}else{AB={v:Y(AE.n)};if(AE.t===21){AB.oi=AE.oi;AB.exv=AE.fmdid||AE.exv;AB.extp=8;AB.v=AE.fnm?Y(AE.oi.n)+"@"+Y(AE.fnm):AB.v;}else{AB.oi=AE;}AF.push(AB);}}else{AB={v:L(AA.dtp,AE.n)};AF.push(AB);}AF.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}AF.pop();}return AF;}};var t=E.children&&E.children[0];if(!AA.isRepeated){t.cssClass="mstrmojo-ME-ObjectInputBox-param singleObject noVerify";t.maxObjectCount=1;}else{t.cssClass="mstrmojo-ME-ObjectInputBox-param noVerify";}return E;};var C=function(r){var q=mstrmojo.all[U];var E=null;if(r.isParam){E=q.getParamWidget(r);}else{switch(r&&r.dtp){case 11:E={scriptClass:"mstrmojo.Pulldown",cssClass:"bool mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"False",did:"0"},{n:"True",did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(t){var u=this.data;this.value=!!u.v?(u.v==="False"?0:-1):(u.dfv||0);},getTokens:function(){var t=this.data;if(this.value!==t.dfv){return[{v:t.n},{v:"=",isDelimiter:true},{v:this.value=="-1"?"True":"False"}];}return[];},onvalueChange:function(){e(this.parent.dataGrid.parent);}};break;case -2:E=q.getBreakByWidget(r);break;case -1:E=q.getSortByWidget(r);break;default:E=q.getTextWidget(r);break;}}E.alias="inputWidget";return E;};var W=function(t,E,q){var r={scriptClass:"mstrmojo.ui.List",alias:"labelWidget",cssClass:"mstrmojo-FunctionWidzard-labels",count:t.items&&t.items.length||0,buildItems:function(){var u=[],x=this.count,AA=(t.isParam?"*":"")+":",z=t.np;if(z){for(var w=0;w<=x;w++){u.push({n:z.n+(z.startAt+w)+AA,title:t.desc||""});}}else{u.push({n:(t.dn||t.n)+AA,title:t.desc||""});}this.set("items",u);},postCreate:function(){this.buildItems();},oncountChange:function(){this.buildItems();}};return r;};var P=function(u){var q=mstrmojo.all[U];return{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"breakByInput",cssClass:"mstrmojo-ME-breakby",isDME:q.isDME,dtp:u.dtp,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),folderLinksContextId:16,browsableTypes:[M.TP.FOLDER,M.TP.ATTR].join(","),getCandidatesThroughTaskCall:function t(x,w){x.rootFolderType=39;x.blockCount=x.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(x,w);},obCfg:{folderLinksContextId:16,browsableTypes:[M.TP.ATTR,M.TP.FOLDER].join(",")},postCreate:function(z){var w=this.parent.dataGrid,AA=w&&w.parent;this.noCache=AA.noCache;if(!this.noCache){this.candidates=AA.getCandidates(function(AD){return AD.t===c.Attribute||AD.t===c.Consolidation;});if(this.isDME){this.candidates.items=o.getItems("breakby").concat(this.candidates.items);}if(!z){w.candidatesListener.push(this.id);}}if(!z){var x=u.items||[],AB=q.oi.tks,AC=!AB.met||AB.items&&(AB.items.length===0);if(AC&&this.isDME){x.push(o.getAutomaticDimtyObject());}this.set("items",x);}},onitemchange:function(){e(this.parent.dataGrid.parent);},onadd:function E(){b();},onremove:function r(){b();},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},getTokens:function(){var AA=this.getSelectedObjects(),w=AA.length,z,AC=[];if(w>0){AC.push({v:"BreakBy"});AC.push({v:"=",isDelimiter:true});AC.push({v:"{",isDelimiter:true});for(z=0;z<w;z++){var AB=AA[z],x;if(h.isDimty(AB.n)){x={v:AB.n};}else{if(/^@/.test(AB.did)){x={v:AB.did};}else{x={v:Y(AB.n),oi:AB};}}AC.push(x);if(z!==(w-1)){AC.push({v:",",isDelimiter:true});}}AC.push({v:"}",isDelimiter:true});}return AC;}};};var F=function(t,u){var q=t.length,E;for(E=0;E<q;E++){var r=mstrmojo.array.find(t[E].fns,"n",u);if(r>-1){return J.clone(t[E].fns[r]);}}return null;};var S=function(r,t){var q,E=t.length,u=r&&r.length;if(u>0){for(q=0;q<u-1;q++){r[q].items=[t[q]];r[q].dynamicVerify=true;}r[u-1].items=[];for(q=u-1;q<E;q++){r[u-1].items.push(t[q]);r[u-1].dynamicVerify=true;}}return r;};var N=function(q,r,w){var u={items:[]},t={301:"}",302:")"}[w],E=r[++q];while(E){if(E.oi){if(w==302){E.oi.selFrm=E.exv;E.oi.asc=E.asc;}u.items.push(E.oi);}if((E=r[++q]).v===t){break;}}return u;};mstrmojo.ME.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ME._MetricEditorHelper,mstrmojo.ME._HasLevel,mstrmojo.ME._HasSortBy],{scriptClass:"mstrmojo.ME.FunctionWizard",cssClass:"mstrmojo-Editor-me mstrmojo-FunctionWidzard",title:mstrmojo.desc(9582,"Function Editor: "),help:"Function_Arguments_dialog_box.htm",fctOi:null,fctArgs:null,fctArgsDataGridCssClass:"functionArgs",fctSyntax:"",fctDesc:"",hiddenPs:[],bindings:{candidates:"this.opener.candidates"},getParamObjectTypes:function f(){var E=[M.TP.METRIC,M.TP.FACT];if(this.isAgg(this.fctOi)){E.push(M.TP.ATTR);}return E;},getCandidates:function R(r){var q=this.candidates,E;if(q){E=mstrmojo.array.filter(q.items,r);return{items:E,isComplete:q.isComplete};}return{};},_set_candidates:function(w,q){this.candidates=q;if(this.hasRendered&&this.visible){var t=this.argsGrid,u=t.candidatesListener,E=u.length,r;for(r=0;r<E;r++){if(mstrmojo.all[u[r]]){mstrmojo.all[u[r]].postCreate(true);}}}if(this._super){this._super(w,q);}return true;},postProcessParamsFromToken:function(t){if(this.refOi&&this.candidates){var u=this.refOi.did;this.refOi=mstrmojo.array.filterOne(this.candidates.items,function(AA){return AA.did===u;});}var z=[],w,r,q=t.pars,E=(q&&q.length)||0;for(r=0;r<E;r++){w=J.copy(q[r]);w.isParam=true;if(r===0&&this.refOi){w.items=[this.refOi];this.refOi=null;}z.push(w);}if(t.rpc>0&&!d.call(this)){w.isRepeated=true;var x=g(w.n);w.np={n:x.prefix,startAt:x.startAt||1};}return z;},postProcessProsFromToken:function(t){var u=[],r,E=(t.pros&&t.pros.length)||0,q=function(w){if(l.indexOf(mstrmojo.ME.Enum.NonExposableParams,w.n)>-1){w.itemCss="hidden";}return w;};for(r=0;r<E;r++){u.push(q(J.copy(t.pros[r])));}return u;},buildSyntax:function(r){var q=[],t,E;q.push(r.n);q.push("(");E=(r.pars&&r.pars.length)||0;for(t=0;t<E;t++){q.push(r.pars[t].n);if(t!==(E-1)){q.push(", ");}}q.push(")");return q;},onOpen:function(){U=this.id;this._setupCandidatesCache();var r=this.getArgsFromTokens();var u=this,t=r||this.fctOi;var E=this.buildSyntax(t),w=this.postProcessParamsFromToken(t);w=w.concat(this.postProcessProsFromToken(t));if(t.sqt===5){w.push({n:"BreakBy",dn:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:"Break By is a parameter representing the break by levels for this function.",items:t.bb&&t.bb.items});}if(t.ios){w.push({n:"SortBy",dn:mstrmojo.desc(12852,"Sort By"),dtp:-1,desc:"Sort By is a parameter representing the sort by levels for this function.",items:t.sb&&t.sb.items});}w=w.concat(this.hiddenPs||[]);u.set("fctArgs",w);u.set("fctSyntax",E.join(""));u.set("fctDesc",mstrmojo.ME.FunctionInfo.getDescAndExample(this.fctOi).desc+"  "+mstrmojo.ME.MetricDataService.getFunctionHelpTopic(t.h));u.set("title",this.insertMode?t.n:mstrmojo.desc(9582,"Function Editor: ")+" "+this.oi.n);u.set("fctName",t.n);this.raiseEvent({name:"fctDidChange",did:this.fctOi.did});this.set("isAggFunction",this.isAgg());this.set("ios",t.ios);if(this._super){this._super();}if(this.isAggFunction){var q=this.argsGrid.ctxtBuilder.itemWidgets;if(q&&q.length>0){this.metricLCT.set("labelWidth",q[0].labelWidget&&q[0].labelWidget.domNode.clientWidth+"px");}}},getArgsFromTokens:function Q(){if(!this.oi||this.oi.tks.items.length===0){return null;}var t={},w=this.oi.tks.items,AL=w.length,AG=[],q=[],AF=0,E=[],AK;for(AK=0;AK<AL;AK++){var z=w[AK],r=z.tp,AN=z.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(z.v)&&(z.v!=="("&&z.v!==")")||z.v==="&gt;"||z.v==="&lt;"){continue;}switch(AN){case 65536:t.n=z.oi?z.oi.n:z.v;var AA=this.fctOi=F(this.functions,t.n);AG=AA.pars||[];q=AA.pros||[];t.rpc=AA.rpc;t.sqt=AA.sqt;t.ios=AA.ios;break;case 196608:var AJ=[],AE=[],AC,AI,AH;z=w[++AK];while(z&&(z.sctt===196608||z.sctt===196609)){if(z.sctt===196608){AE.push(z);}else{AJ.push(AE);AE=[];}z=w[++AK];}AJ.push(AE);AJ[AJ.length-1].pop();for(AH=0;AH<AJ.length;AH++){AE=AJ[AH];var u={n:""};AC=AE.length;if(AC===1){z=AE[0];if(z.extp){u={n:z.v,did:z.oi.did+"@"+z.exv,exv:z.exv,extp:z.extp,oi:z.oi,t:21,tk:z};}else{var AD=Math.min(AG.length-1,E.length),AM=Z(z,z.v,AG[AD].dtp);u=z.oi||{n:AM,v:AM};}}else{for(AI=0;AI<AC;AI++){u.n+=AE[AI].v;}u.v=u.n;u.did=u.n;u.t=O.Sub_Expression;u.tks=AE;}E.push(u);}break;case 131072:if(r==301){var AB={};z=w[++AK];while(z){if(z.tp!=282){if(z.oi){AB.items=AB.items||[];AB.items.push(z.oi);}else{if(z.tp===64){AB.items=AB.items||[];var x=z.v+w[++AK].v;z=w[AK+1];if(z.tp===43||z.tp===45){x+=w[++AK].v;x+=w[++AK].v;}AB.items.push(o.getDimtyObject(x,this.isDME));}}}if((z=w[++AK])["v"]==="}"){break;}}t.bb=AB;}else{if(r==302){t.sb={};}else{if(r==259){mstrmojo.array.forEach(q,function(AQ){if(AQ.n===w[AK].v){AK=AK+2;var AP=w[AK],AO=[];do{AO.push(w[AK++].v);if(w[AK].sctt===131072&&w[AK].tp===62||w[AK].sctt===131073){break;}}while(true);AO=AO.join("");AO=Z(AP,AO,AQ.dtp);AQ.v=AO;return false;}});}}}break;}}t.pars=S(AG,E);t.pros=q;return t;},getTokens:function H(){var t=this.argsGrid.ctxtBuilder.itemWidgets,z=t.length,x,AD,AA=[],r=[],AE=[],AB,u,q,E,AC=this.fctOi;for(x=0;x<z;x++){AD=t[x].inputWidget;if(AD.data.isParam){r.push(AD.getTokens());}else{AA.push(AD.getTokens());}}AE.push({v:AC.n,oi:AC});z=AA.length;if(z>0){E=false;AE.push({v:"<",isDelimiter:true});for(x=0;x<z;x++){AB=AA[x];q=AB.length;if(q===0){continue;}E=true;for(u=0;u<q;u++){AE.push(AB[u]);}AE.push({v:",",isDelimiter:true});}AE.pop();if(E){AE.push({v:">",isDelimiter:true});}}z=r.length;AE.push({v:"(",isDelimiter:true});E=false;for(x=0;x<z;x++){AB=r[x];q=AB.length;if(q===0){continue;}E=true;for(u=0;u<q;u++){AE.push(AB[u]);}AE.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}if(E){AE.pop();}AE.push({v:")",isDelimiter:true});for(x=0,z=AE.length;x<z;x++){AE[x].isNew=true;}return AE;},getMetricDefAsTokens:function p(){var E=this.getTokens();if(this.getLCTDefAsTokens){E=E.concat(this.getLCTDefAsTokens());}return E;},handleValidation:function n(u){if(u&&!u.rjec){return ;}var t=u&&u.rjec==="-2147214846";if(t){var q=u.items,w=mstrmojo.array.find(q,"sta",-1),E=q[w].v;mstrmojo.alert('More than one object with the name "#" found. Browse to select the object or retype to select it from the search autocomplete list.'.replace("#",E));}else{mstrmojo.alert(u&&u.rjed);}},getPROPBuilder:function a(){return W;},getDTPBuilder:function j(){return C;},getParamWidget:function B(E){return G(E);},getBreakByWidget:function T(E){return P(E);},getSortByWidget:function k(E){return this._super();},getTextWidget:function V(E){return{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(q){var r=this.data;this.value=r.v||((r.dfv||r.dfv===0)?r.dfv:"");},getTokens:function(){var q=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==q.dfv){return[{v:q.n},{v:"=",isDelimiter:true},{v:L(q.dtp,this.value)}];}return[];},onvalueChange:function(){e(this.parent.dataGrid.parent);}};},getDataGridRef:function D(){return{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:this.fctArgsDataGridCssClass,makeObservable:true,banding:false,columns:[{headerText:"Property Name",dataWidgetBuilder:this.getPROPBuilder(),colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:this.getDTPBuilder(),colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"},onadd:function(){b();}};},init:function m(E){this.children=this.getChildren();this._super(E);U=this.id;X=this;},isAgg:function K(E){return(E||this.fctOi||{}).sqt===1;},getChildren:function I(){return[mstrmojo.ME._MetricEditorHelper.formatAndOptionsBarRef,mstrmojo.ME._MetricEditorHelper.nameEditBoxRef,mstrmojo.ME._MetricEditorHelper.functionNameRef,this.getDataGridRef(),this.getLCTComponent(),{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionSyntax",bindings:{visible:"this.parent.insertMode",text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionDesc",allowHTML:true,bindings:{visible:"this.parent.insertMode || this.parent.simplex",text:function(){return this.parent.fctDesc;}}},mstrmojo.ME._MetricEditorHelper.switchRef,mstrmojo.ME._MetricEditorHelper.buttonBarRef];}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.ui._HasScroller","mstrmojo.SearchableDropDownList","mstrmojo.ME.FunctionWizard","mstrmojo.ME._DerivedMetricEditorHelper");mstrmojo.requiresDescs(3377,11569,12179);var A,C;mstrmojo.ME.DerivedFunctionWizard=mstrmojo.declare(mstrmojo.ME.FunctionWizard,[mstrmojo.ME._DerivedMetricEditorHelper,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.DerivedFunctionWizard",init:function F(G){mstrmojo.css.addWidgetCssClass(this,"dme");this._super(G);A=this.id;C=this;},setupScrollNodes:function E(){this.scrollNode=this.containerNode;},onOpen:function B(){this._super();if(this.updateScrollbars){this.updateScrollbars();}},getParamObjectTypes:function D(){var G=this.opener||{};return G.getValidFuncParamTypes?G.getValidFuncParamTypes(this.fctOi):this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.es.RootView","mstrmojo.qb.QBHelpers");var C=mstrmojo.qb.QBHelpers;mstrmojo.qb.bigquery.ESRootView=mstrmojo.declare(mstrmojo.qb.es.RootView,null,{scriptClass:"mstrmojo.qb.bigquery.ESRootView",init:function A(D){this.children=C.clone(this.children);this.children[0].children[0].scriptClass="mstrmojo.qb.bigquery.BigQueryWHPanel";if(this._super){this._super(D);}},getDBRoleSelector:function B(){return this.main.children[0].topPanel.dbSelector;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._BigQueryController","mstrmojo.qb.es.Controller");mstrmojo.qb.bigquery.ESController=mstrmojo.declare(mstrmojo.qb.es.Controller,[mstrmojo.qb.bigquery._BigQueryController],{scriptClass:"mstrmojo.qb.bigquery.ESController"});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME.MetricDataService","mstrmojo.ME.AttributeEditBox","mstrmojo.expr","mstrmojo.array","mstrmojo.hash");var G;var e=mstrmojo.ME.MetricDataService,U=mstrmojo.hash,N=mstrmojo.array,W=mstrmojo.ME.AttributeEditBox.getTokenStreamXML,a=mstrmojo.expr.DTP,Q={SHOW_BAND_NAMES:-4,BANDON_UNITS:-6},B={START_END:'BandNames<ResidueName="All Others">(this@ID, "#s - #e")',BAND_NUM:'BandNames<ResidueName="All Others">(this@ID, "Band #b")',BAND_NUM_START_END:'BandNames<ResidueName="All Others">(this@ID, "Band #b: #s - #e")',NO:"No"},R=[{n:mstrmojo.desc(14145,"Start - End"),v:B.START_END},{n:mstrmojo.desc(14146,"Band #"),v:B.BAND_NUM},{n:mstrmojo.desc(14147,"Band #: Start - End"),v:B.BAND_NUM_START_END},{n:mstrmojo.desc(218,"No"),v:B.NO}],K={"8107C337DD9911D3B98100C04F2233EA":"BAND_SIZE","8107C338DD9911D3B98100C04F2233EA":"BAND_COUNT","8107C339DD9911D3B98100C04F2233EA":"BAND_POINTS"},D=function(){return[];};function Y(f){return f.replace(/\s/g,"").toLowerCase();}function O(f){var g=[{v:"BandNames",tp:279,lv:1,oi:{did:"ACA96B1F9F99412B867045747DD88575",n:"BandNames",st:2816,t:11}},{v:"<",tp:60,lv:1},{v:"ResidueName",tp:259,lv:1},{v:"=",tp:282,lv:1},{v:'"All Others"',tp:261,lv:1},{v:">",tp:62,lv:1},{v:"(",tp:40,lv:1},{lv:1,tp:275,v:"this@ID"},{v:",",tp:44,lv:1}];switch(f){case B.BAND_NUM:g.push({v:'"Band #b"',tp:261,lv:1});break;case B.BAND_NUM_START_END:g.push({v:'"Band #b: #s - #e"',tp:261,lv:1});break;case B.START_END:g.push({v:'"#s - #e"',tp:261,lv:1});break;}g.push({v:")",tp:41,lv:1});return g;}function d(f){var g="";N.forEach(f.slice(1,-1),function(h){g+=h.v;});return g;}function J(f){if(f.t===4){return"BandOn";}return f.n;}function E(f){if(f.t===4){return Q.BANDON_UNITS;}return f.dtp;}var C=function(f,g){return{did:"",n:"New Attribute",forms:[{n:"ID",tks:{items:[]}}]};};function T(g,f){return g.dtp===8&&g.n==="Delimiter"?'"'+f+'"':f;}function P(j){var h=j.split(",")[0],g=h.replace(/\d$/,""),f=h.replace(g,"");return{prefix:g,startAt:parseInt(f,10)};}function L(f,g){return{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:f,popupToBody:true,itemIdField:"v",postCreate:function(){var h=this.data;this.value=h.v||h.dfv;},getTokens:g||D,onvalueChange:function(){G.set("dirty",true);}};}function I(g,j){var f=function(k){return k.inputWidget&&k.inputWidget.widgetName===j;},h=mstrmojo.array.filterOne(g.argsGrid.ctxtBuilder.itemWidgets,f);return h&&h.inputWidget;}var H=function(g){var f=null;switch(g&&g.dtp){case Q.SHOW_BAND_NAMES:f=L(R);f.widgetName="bandNames";f.getDescTokens=function(){var h=this.selectedItem&&this.selectedItem.v;return h===B.NO?null:O(h);};break;case Q.BANDON_UNITS:f=G.getParamWidget(g);f.widgetName="bandOn";break;case a.DOUBLE:case a.INTEGER:case a.VARCHAR:f=G.getTextWidget(g);break;default:f=G.getParamWidget(g);f.onitemsChange=mstrmojo.emptyFn;break;}if(f){f.alias="inputWidget";}return f;};var M=function(n,o,k,p){var l=n.did,h=n.n,f=n.dsid,g=n.forms,m={items:o},j=function(q){if(q.vs!==0){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));return ;}var t,r={n:"ID",formula:q.tokenXML};if(l){r.did=g[0].did;t={act:"updateDA",name:h,dsid:f,attrId:l,isTokenStream:true,update:[r]};if(k){if(k.did&&!k.del){t.update.push(k);}else{if(k.did&&k.del){t.del=[{did:k.did}];}else{t.add=[k];}}}}else{t={act:"addDAToDataset",dsid:f,name:h,evFlags:1,isTokenStream:true,forms:[r].concat(k?[k]:[])};}p(t);};mstrmojo.ME.AttributeEditBox.validateSyntax(l,m,true,j);};var Z=function(l){var k=l.forms,g=k&&k.length,j=g&&k[0],h=g&&k[1],n=N.some(j&&j.ftk,function(o){return o.oi&&K[o.oi.did];});if(!n){return false;}if(g===1){return true;}if(h&&h.ftk&&g===2){var f=false,m=Y(d(h.ftk));U.forEach(B,function(o){if(Y(o)===m){f=true;return false;}});return f;}return false;};mstrmojo.ME.BandingDAEditor=mstrmojo.declare(mstrmojo.ME.DerivedFunctionWizard,null,{scriptClass:"mstrmojo.ME.BandingDAEditor",ide:null,insertMode:false,init:function V(f){this._super(f);G=this;},getDTPBuilder:function X(){return H;},getParamObjectTypes:function S(){return[mstrmojo.expr.TP.METRIC];},getTextWidget:function b(g){var h=P(g.n).prefix;return{scriptClass:"mstrmojo.ValidationTextBox",emptyText:(g.dtp===a.DOUBLE||g.dtp===a.INTEGER)?mstrmojo.desc(14143,"Type a number"):"",postCreate:function(){this.value=(g.items&&g.items[0].v)||g.dfv;},oninput:function j(k){G.set("dirty",true);this.createNextInputParamWidget();},constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP,min:1},dtp:g.dtp,getTokens:function(){var k=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==k.dfv){return[{v:T(k,this.value)}];}return[];},createNextInputParamWidget:function f(){var o=this.data,n=this.dataGrid,p=G._lastRpIdx;if(!(o.isRepeated&&o.rpIdx===p)){return ;}var l=p+1,m=h+l,k=mstrmojo.hash.copy({desc:m,n:m,items:null,dn:m,rpIdx:l},mstrmojo.hash.copy(o));n.items.add([k],mstrmojo.array.indexOf(n.items,o)+1);G._lastRpIdx=k.rpIdx;if(G.updateScrollbars){G.updateScrollbars();}}};},onOpen:function F(){G=this;this.oi.tks=this.oi.forms[0].tks||{items:this.oi.forms[0].ftk};this._super();if(this.updateScrollbars){this.updateScrollbars();}},insertOnFinish:function(){var k=mstrmojo.all.mstrDAE.attrEditBox,f=k.inputBox,j=I(this,"bandNames"),g=this.getTokens(),h=j.getDescTokens();f.insertTokens(g);if(h){k.tabstrip.addTab();f.insertTokens(h);}},validateAndSave:function A(m,l){var k=this,j=k.ide.action,f=m.forms,g=I(this,"bandNames"),o=g.getDescTokens(),h=U.copy(o?{n:"DESC",formula:W({items:o})}:null,f[1]?{did:f[1].did}:null),n=function(q){l();k.ide.close();var p=m.did?j.onupdate:j.oncreate;if(p){p(q);}};if(o===null&&h){h.del=true;}M.call(k,k.oi,this.getTokens(),h,n);},postProcessParamsFromToken:function(j){var l=[],k,h,g=j.pars,f=(g&&g.length)||0;for(h=0;h<f;h++){k=U.copy(g[h]);k.dtp=E(k);k.n=J(k);k.isParam=true;l.push(k);}k=l[l.length-1];if(j.rpc>0){l=l.concat(this.postProcessRepeatParam(k));}return l;},postProcessRepeatParam:function c(n){var m=P(n.n),l=m.prefix,h=m.startAt||1,f=[],k,g;n.isRepeated=true;n.rpIdx=this._lastRpIdx=h;n.n=l+(h++);var j=n.items||[];if(j.length>0){n.items=[j[0]];for(g=1;g<=j.length;g++){k=U.copy(n);k.rpIdx=h;k.n=l+(h++);k.items=(g===j.length?null:[j[g]]);f.push(k);}this._lastRpIdx=k.rpIdx;}return f;},postProcessProsFromToken:function(f){var h=[],g={dfv:B.START_END,n:"ShowBandNames",desc:mstrmojo.desc(14144,"Show band names"),dtp:Q.SHOW_BAND_NAMES};if(this.oi.forms.length>1){var j=Y(d(this.oi.forms[1].ftk));U.forEach(B,function(k){if(Y(k)===j){g.v=k;return false;}});}else{if(this.oi.did!==""){g.v=B.NO;}}h.push(g);return h;}});mstrmojo.ME.BandingDAEditor.getNewDefinition=C;mstrmojo.ME.BandingDAEditor.showAsBandingEditor=Z;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Editor","mstrmojo.tooltip","mstrmojo.SearchWidget","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.BandingDAEditor","mstrmojo.ME.Enum","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(13141);var R=mstrmojo.hash,W=mstrmojo.dom,M=mstrmojo.css,Y=mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS;var D={n:mstrmojo.desc(9590,"Search Result"),did:-1,fns:[]},E={n:mstrmojo.desc(4561,"All Functions"),did:-2,fns:[]},Q={n:mstrmojo.desc(9591,"Metric Templates"),did:-3,fns:[{n:mstrmojo.desc(3273,"Level"),did:Y.Level,desc:mstrmojo.desc(9592,"Create a level metric."),h:"standard_functions_Level"},{n:mstrmojo.desc(9579,"Condition"),did:Y.Condition,desc:mstrmojo.desc(9593,"Create a conditional metric."),h:"standard_functions_condition"},{n:mstrmojo.desc(3324,"Transformation"),did:Y.Transformation,desc:mstrmojo.desc(9594,"Create a transformation metric."),h:"standard_functions_transformation"},{n:mstrmojo.desc(11656,"Row Count"),desc:mstrmojo.desc(11657,"Row Count calculates the total number of rows in the dataset."),did:Y.Row_Count,tks:{items:[{v:"Count",tp:280,oi:{n:"Count",did:"8107C31CDD9911D3B98100C04F2233EA",t:11,st:2816}},{v:"<",tp:60},{v:"Null",tp:259},{v:"=",tp:282},{v:"True",tp:299},{v:",",tp:44},{v:"UseLookupForAttributes",tp:259},{v:"=",tp:282},{v:"False",tp:300},{v:">",tp:62},{v:"(",tp:40},{v:'"*"',tp:261},{v:")",tp:41},{v:"{",tp:123},{v:"~",tp:126},{v:"}",tp:125}]}}]},G={n:mstrmojo.desc(4565,"Select a category:"),did:-4,fns:[]},F=function(Z,a){var b=Z.functionList;Z.openWizard(b.items[b.selectedIndex],a);},H=function(){return mstrmojo.hash.copy(mstrmojo.ME.ENUM.NEW_METRIC_DEFINITION);};var X=function(a){var Z="mstrmojo-ME-fct-tip",b=this.tooltip&&this.tooltip.domNode;if(b){M.toggleClass(b,Z,a);}};mstrmojo.ME.FunctionSelector=mstrmojo.declare(mstrmojo.Editor,[],{scriptClass:"mstrmojo.ME.FunctionSelector",title:mstrmojo.desc(9595,"Select a function or template"),help:"Select_a_Function_dialog_box.htm",isDME:false,functions:null,includeFakeFuncs:true,functionItems:null,selectedCategory:1,selectedIndex:-1,init:function T(Z){this._super(Z);M.addWidgetCssClass(this,"mstrmojo-FunctionSelector");},getFunctionSyntax:function L(g,b){var d=this.functionItems;if(!d){return"";}var e=d[g].fns[b];if(e.did<0){return e.n;}var Z=e.pars,j=e.pros,h=[],a,c;h.push(e.n);j=mstrmojo.hash.clone(j)||[];if(e.ios){j.push({n:"SortBy"});}if(e.sqt===5){j.push({n:"BreakBy"});}if(this.showFullSyntax){if(j.length>0){h.push("<");for(a=0,c=j.length;a<c;a++){h.push(j[a].n);h.push(", ");}h.pop();h.push(">");}}h.push("(");for(a=0,c=Z.length;a<c;a++){h.push(Z[a].n);if(a!==(c-1)){h.push(", ");}}h.push(")");return h.join("");},getFunctionDesc:function P(c,Z){var b=this.functionItems;if(!b){return"";}var a=b[c].fns[Z];return mstrmojo.ME.FunctionInfo.getDescAndExample(a).desc;},getFunctionHelpTopic:function O(c,Z){var b=this.functionItems;if(!b){return"";}var a=b[c].fns[Z];if(a.did===Y.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(a.h);},getMetricDefAsTokens:function S(){return this.getTokens();},getTokens:function K(){var a=this.functionList,Z=a.items[a.selectedIndex],b=[];if(Z){if(Z.did<-1){switch(Z.did){case -7:b=Z.tks.items;break;case -4:case -5:case -6:break;}}else{b.push({v:Z.n,oi:Z,isNew:true});}}return b;},onfunctionsChange:function V(){if(!this.functions){return ;}this.selectedCategory=0;this.set("selectedCategory",1);this.set("selectedIndex",-1);var b=mstrmojo.hash.clone(this.functions),Z=b.length;if(!b.add){b=R.make(b,mstrmojo.Arr);}if(Z>=1&&this.includeFakeFuncs){var a=b[mstrmojo.ME.MetricDataService.getBasicCategoryIndex(b)];a.fns.push(Q.fns[0]);if(!this.isDME){a.fns.push(Q.fns[1]);a.fns.push(Q.fns[2]);}else{a.fns.push(Q.fns[3]);}}this.set("functionItems",b);},onPreClose:function N(){this.cleanup();return true;},cleanup:function I(){this.searchWidget.clearSearch();this.set("selectedIndex",-1);},handleCloseAction:function C(){this.close();},clearSearchResult:function U(a){var b=this.fcHBox.fcPulldown,c=this.functionItems,Z=c.length-1;if(Z>-1&&c[Z]===D){if(this.selectedCategory===Z){if(a!==false){this.set("selectedCategory",1);this.set("selectedIndex",-1);}}c.remove(Z);b.refresh();}},clearSearchPattern:function A(){var Z=this.searchWidget;if(Z&&Z.hasRendered){Z.reset();this.clearSearchResult(false);}},openWizard:function J(c,b){var a=this,Z;if(mstrmojo.ME.MetricDataService.isBasicAggMap(c.did)||c.did<-1){Z={zIndex:a.zIndex+10,did:c.did,oi:H};Z.insertMode=false;Z.id="mstrSME";}else{Z={functions:mstrmojo.ME.MetricDataService.getFunctionCatList(),fctOi:c,zIndex:a.zIndex+10,oi:H};Z.id="mstrFE";}Z.insertMode=this.insertMode;if(Z.insertMode){Z.insertOnFinish=this.insertOnFinish;}a.switch2Editor(Z.id,Z);},handleSelectedFunction:function(Z){F(this);},onshowFullSyntaxChange:function B(){this.functionList.onchange();},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FunctionSelector-label",text:mstrmojo.desc(9925,"Functions")},{scriptClass:"mstrmojo.SearchWidget",alias:"searchWidget",cssClass:"mstrmojo-FunctionSelector-search",width:"65px",quickSearch:true,placeholderText:"",onsearch:function(g){var Z=this.parent,f=Z.fcHBox.fcPulldown,d=Z.functionItems,h=Z.functionList.itemDisplayField,e=[],a=function(k){var j=mstrmojo.hash.copy(k),m=j.n,l;try{l=new RegExp(g,"ig");}catch(n){l=new RegExp(mstrmojo.string.regEscape(g),"ig");}if(l.test(m)){j[h]=m.replace(l,function(o){return"<em>"+mstrmojo.string.encodeHtmlString(o)+"</em>";});e.push(j);}},b,c;for(b=0,c=d.length;b<c;b++){if(d[b]===D||d[b].did===E.did){continue;}if(g){mstrmojo.array.forEach(d[b].fns,a);}}D.fns=e;if(d[d.length-1]!==D){d.add([D]);}f.refresh();Z.selectedCategory=0;Z.set("selectedCategory",d.length-1);Z.set("selectedIndex",-1);},onclear:function(Z){if(Z){this.parent.clearSearchResult();}}},{scriptClass:"mstrmojo.HBox",alias:"fcHBox",cssClass:"mstrmojo-FunctionSelector-fctBox",children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",alias:"fcPulldown",itemIdField:"did",itemField:"n",items:[],bindings:{items:function(){var a=this.parent.parent.functionItems,b=[];if(!a){return a;}b=mstrmojo.ME.MetricDataService.sortFunctions(a);if(a[0].did!==E.did){var Z=E;Z.fns=b;a.unshift(Z);}return a;},selectedIndex:"this.parent.parent.selectedCategory",value:function(){var Z=this.parent.parent.selectedCategory;return this.items[Z][this.itemIdField];}},onvalueChange:function(Z){var a=this.parent.parent;a.set("selectedCategory",this.selectedIndex);a.set("selectedIndex",-1);if(Z.valueWas===D.did&&this.selectedItem.did!==D.did){this.parent.parent.clearSearchPattern();}}}]},{scriptClass:"mstrmojo.ME.FunctionList",alias:"functionList",itemIdField:"dssid",itemField:"n",itemDisplayField:"dn",items:[{n:"",cls:"wait"}],cssClass:"mstrmojo-FE-functionList mstrmojo-suggest-list",renderOnScroll:false,itemMarkupFunction:function(b,Z,a){return'<div class="mstrmojo-suggest-text '+(b.cls||"fn")+'" idx="'+Z+'"'+(b.did<0?'did="'+b.did+'"':"")+" onmouseover=\"mstrmojo.all['"+a.id+"'].onmouseover(this, event)\" onmouseout=\"mstrmojo.all['"+a.id+"'].onmouseout(this, event)\">"+((a.itemDisplayField&&b[a.itemDisplayField])||b[a.itemField])+'<div class="mstrmojo-Button mstrmojo-Editor-button mstrmojo-WebButton hot tbFunction" t="edt"><div class="mstrmojo-Button-text" t="edt">'+mstrmojo.desc(1088,"Edit")+"</div></div></div>";},bindings:{items:function(){var Z=this.parent.functionItems,a=this.parent.selectedCategory;return(Z&&Z[a].fns)||this.items;},selectedIndex:"this.parent.selectedIndex"},buffer:"",onkeypress:function(l){var j=this,g=l.e,c=g.keyCode||g.charCode,m=mstrmojo.Enum_Keys,Z=function(o){var n=(W.isIE&&!W.isIE9)?o.keyCode:o.charCode;return(n>0)?String.fromCharCode(n):"";},h=this.items,f=h.length,a=this.selectedIndex,b=function(e){j.scrollTo(e);};switch(c){case m.UP_ARROW:this.set("selectedIndex",(a+f-1)%f);break;case m.DOWN_ARROW:this.set("selectedIndex",(a+1)%f);break;default:var d=(this.buffer+=Z(g));if(f>0&&d.length>0){mstrmojo.array.forEach(h,function(o,k,e){var n=new RegExp("^"+d,"i");if(n.test(o[j.itemField])){if(k>-1){this.selectedIndex=-1;this.set("selectedIndex",k);}return false;}},this);}}if(this.selectedIndex>-1){b(this.selectedIndex);}window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){j.buffer="";},300);mstrmojo.dom.stopPropogation(l.hWin,g);return false;},onkeyup:function(Z){this.onkeypress(Z);},onchange:function(Z){var b=this.parent;if(this.selectedIndex!==b.selectedIndex){b.set("selectedIndex",this.selectedIndex);}var d=b.selectedCategory,a=b.selectedIndex,c=d>-1&&a>-1;b.set("funcSyntax",c?b.getFunctionSyntax(d,a):"");b.set("funcDesc",c?b.getFunctionDesc(d,a)+"  "+b.getFunctionHelpTopic(d,a):"");if(this.changeByMouse){if(b.selectedCategory>-1&&b.selectedIndex>-1){b.handleSelectedFunction(false);}this.changeByMouse=false;}},onmouseup:function(Z){var b=Z.getTarget(),a=b.getAttribute("t");if(a==="edt"){mstrmojo.dom.stopPropogation(Z.hWin,Z.e);mstrmojo.dom.preventDefault(Z.hWin,Z.e);this.openFunctionEditor();return false;}},openFunctionEditor:function(){var b=this.parent.parent.parent,c=b.getTokenInputBox(),Z={zIndex:b.zIndex+1,insertMode:true,oi:mstrmojo.ME.ENUM.getNewDefinition(),insertOnFinish:function(d){c.insertTokens(d);}},a=this.parent.functionList.selectedItem;if(b.isBanding&&b.isBanding(a.did)){Z={zIndex:b.zIndex+1,insertMode:true,fctOi:a,id:"mstrBDAE_1",oi:mstrmojo.ME.BandingDAEditor.getNewDefinition(),ide:b};}else{if(mstrmojo.ME.MetricDataService.isBasicAggMap(a.did)||a.did<-1){Z.candidates=c.candidates;Z.did=a.did;Z.id="mstrSME_1";Z.useGUIDefault=true;}else{Z.fctOi=a;Z.id="mstrFE_1";Z.paramItemsPath=b.feParamItemsPath;}}Z.modal=true;b.getModalEditor(Z).open(b);},ondblclick:function(Z){var b=this.getItemNodeFromTarget(Z.getTarget());if(b){var a=this.parent;if(a.selectedCategory>-1&&a.selectedIndex>-1){a.handleSelectedFunction(true);}}},useRichTooltip:false,onmouseover:function(b,j){var l=this,a=this.parent,k=a.selectedCategory,d=b.getAttribute("idx"),c=W.eventTarget(window,j),Z=c.getAttribute("t")==="edt";if((!isNaN(d)&&d>-1)||Z){window.clearTimeout(l.hideTmr);var h='<dl class="fct-info"><dt class="fct-syntax">'+a.getFunctionSyntax(k,d)+'</dt><dd class="fct-desc">'+(a.getFunctionDesc(k,d)+"  "+a.getFunctionHelpTopic(k,d))+"</dd></dl>";var m=mstrmojo.dom.position(b,true),n=function(){var p=(l.tooltip&&l.tooltip.domNode.offsetWidth+15)||200,e=m.x,t=m.y-b.offsetHeight/2,r=e<p?"left":"right",q=e<p?mstrmojo.tooltip.POS_TOPLEFT:mstrmojo.tooltip.POS_TOPRIGHT;e=e<p?m.x+m.w+8:e-10;return{arrow_css:r,contentNodeCssClass:"me-tooltip-content "+r,posType:q,left:e,top:t};},g=n(),f="hidden";l.richTooltip=Z?l.getEditBtnTooltip(c,d):{cssClass:f,contentNodeCssClass:"me-tooltip-content "+g.arrow_css,posType:g.posType,left:g.left,top:g.top,content:h,areaId:d};l.useRichTooltip=true;l.hasOpenTooltip=false;l.showTooltip();window.clearInterval(l.posTmr);var o=0;if(!l.posTmr){l.posTmr=window.setInterval(function(){if(l.tooltip){var q=l.tooltip.domNode,p=q.childNodes[1].firstChild,e=g.posType;g=n();if(g.posType!==e){q.style.left=g.left+"px";M.addClass(p,[g.arrow_css]);}window.setTimeout(function(){M.removeClass(q,f);},10);window.clearInterval(l.posTmr);delete l.posTmr;}else{if(o++>10){window.clearInterval(l.posTmr);}}},200);}X.call(this,!Z);}},getEditBtnTooltip:function(Z,a){return{posType:mstrmojo.tooltip.POS_TOPRIGHT,contentNodeCssClass:"me-tooltip-content regular up tbFunction",top:28,left:67,refNode:Z,content:mstrmojo.desc(13141,"Edit function parameters"),areaId:a};},onmouseout:function(){var Z=this;this.hideTmr=window.setTimeout(function(){X.call(Z);Z.hideTooltip();Z.useRichTooltip=false;},500);}},R.copy({slot:"buttonNode",cssText:"text-align: center; float:left;",text:mstrmojo.desc(9563,"Switch to Formula Editor"),title:mstrmojo.desc(9597,"Build a metric formula using metrics, facts, attributes and functions."),closeAfterSwitch:false,getEditor:function(){return this.parent;},postclick:function(){this.getEditor().buttonNode.style.visibility="hidden";},bindings:{visible:function(){return !this.parent.insertMode;}}},R.copy(mstrmojo.ME._MetricEditorHelper.switchRef)),{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.handleCloseAction();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo.ui._HasScroller");var D=mstrmojo.dom;mstrmojo.ME.FunctionList=mstrmojo.declare(mstrmojo.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionList",setupScrollNodes:function C(){this.scrollNode=this.itemsContainerNode;this.scrollNode.style.height=this.scrollboxNode.offsetHeight+"px";this.scrollboxNode=this.itemsContainerNode;},getItemNodeFromTarget:function B(G){var F=mstrmojo.dom.findAncestorByAttr(G,"idx",true,this.domNode);return(F&&F.node)||null;},premousedown:function A(G){this.changeByMouse=false;if(D.isPrimaryMouseBtn(G.e)){var H=this.getItemNodeFromTarget(G.getTarget()),F=H&&parseInt(H.getAttribute("idx"));if(F!==null&&!isNaN(F)&&F!==this.selectedIndex){this.domNode.tabIndex=0;this.domNode.focus();this.changeByMouse=true;}this._super(G);}},premouseup:function E(F){if(D.getButton(F.hWin,F.e)===D.MOUSE_BUTTON.LEFT){this._super(F);return true;}mstrmojo.dom.stopPropogation(F.hWin,F.e);mstrmojo.dom.preventDefault(F.hWin,F.e);return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Editor","mstrmojo.List","mstrmojo.ME.MetricEditBox","mstrmojo.ME.FunctionSelector","mstrmojo.qb.FunctionWizard","mstrmojo.MenuButton","mstrmojo.qb.FFsqlToken","mstrmojo.array");mstrmojo.requiresDescs(221,2827,2919,4449,5891,9105,9106,9107,9108,9109,9110,9925);var Q=mstrmojo.string,S=mstrmojo.hash,O=mstrmojo.array,P={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3},X={0:"valid",1:"unknown",2:"validating",3:"error"},T={0:mstrmojo.desc(9105,"Valid Expression Formula."),1:mstrmojo.desc(9106,"Require Validation?"),2:mstrmojo.desc(9107,"Validation in Progress..."),3:mstrmojo.desc(9108,"Validation Failed with Syntax Error")},B=0,Y=3;function D(Z){return(Z?P.ERROR:P.VALID);}function M(Z){var a=[];O.forEach(Z,function(b){a.push(b.v);});return a.join("").replace(/<\s/g,"<").replace(/>\s/g,">");}function A(e){var d=e[e.length-1],b,c,a=[],Z="";if(e[0]&&e[0].tp!==64){a.push({v:"",tp:64,lv:3,sta:1});}O.forEach(e,function(f){if(!f.oi){Z+=f.v;}else{if(!Q.isEmpty(Z)){a.push({v:Z,tp:2,lv:1});Z="";}a.push(S.copy(f,{lv:1,tp:2,sta:1}));}});if(!Q.isEmpty(Z)){a.push({v:Z,tp:2,lv:1});Z="";}if(d&&d.tp!==-1){a.push({v:"",tp:-1,lv:2,sta:1});}return{omit:a,cn:a.length};}function N(c){var b=A(c),a={v:true,tp:true,lv:true,n:true,did:true,t:true,st:true,cn:true,mi:true,omit:true,extra:true,tknctx:true,sqlti:true,tindex:true,cli:true,sta:true,ix:true},Z={getArrItemName:function(){return"tkn";},isSerializable:function(d){return(a[d])?true:false;}};return mstrApp.getRootController().exprjson2xml("mi",b,Z);}function R(e){var a="",d=1,c="",Z=this.exprEditBox.inputBox;if(Z.doubleByte){c=Z.editNode.innerText||Z.editNode.textContent;Z.ime=false;}else{if(this.oi.type!==0&&this.oi.type!==3){c=M(Z.items);d=2;}else{a=N(Z.items);}}var b=this;mstrApp.getRootController().parseExpression({expr:c,tKnStrm:a,isNew:true,qbrex:d,vo:1},{success:function(g){if(g&&g.mi&&g.mi.items){var f=g.mi.exp.sqltp;if(f!==null){b.sqltp=f;}b.exprEditBox.handleValidation(g.mi,false);if(!g.mi.reject_error_code&&e&&e.success){e.success(g);}else{if(e&&e.failure){e.failure(g);}}}}});}function W(a){var b=[],Z=a.length;O.forEach(a,function(d,c){var e=d.v;if(typeof e!=="string"&&e.toString){e=d.v=e.toString();}if(d.orf){if(c>0&&e.slice(0,1)!==" "){b.push({v:" "});}b.push(d);if(c<Z-1&&e.slice(-1)!==" "){b.push({v:" "});}}else{b.push(d);}});O.forEach(b,function(d,c){a[c]=d;});}function U(a){if(!a.length){return ;}var Z=a[a.length-1];if(Z&&Z.tp===-1){a.pop();}if(a[0]&&(a[0].tp===64||(a[0].tp===36&&a[0].v==="$"))){a.splice(0,1);}W(a);}function K(Z){return["[",Z,"]"].join("");}mstrmojo.qb.ExpressionEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.ExpressionEditor",cssClass:"mstrmojo-MetricEditor mstrmojo-qb-ExpressionEditor",zIndex:70,title:mstrmojo.desc(4449,"Expression"),functionSelector:{scriptClass:"mstrmojo.ME.FunctionSelector"},wizard:{scriptClass:"mstrmojo.qb.FunctionWizard"},model:null,selFuncItem:null,onfunclistChange:function I(){this.toolBox.toolBar.func.set("cm",[{n:mstrmojo.desc(9925,"Functions"),did:-3,fns:this.funclist}]);},onOpen:function E(){var c=this,b=this.oi,f=this.exprEditBox,g=f.inputBox;g.customFunctionMode=false;g.doubleByte=false;b.isSave=false;this.set("funclist",(this.funclist||mstrApp.getRootController().getFunctionList()));var e={items:mstrApp.getRootController().getSuggestionItems(false),isComplete:true};g.set("candidates",e);c.set("candidates",e);f.set("iStatus","");f.set("vStatus",0);var a={0:mstrmojo.desc(4449,"Expression"),1:mstrmojo.desc(9109,"Filter Expression"),3:mstrmojo.desc(4449,"Expression")},d={0:(mstrApp.helpTopics&&mstrApp.helpTopics.expression)||"expression_dialog_box.htm",3:(mstrApp.helpTopics&&mstrApp.helpTopics.expression)||"expression_dialog_box.htm"};this.set("title",[a[b.type]||"",b.n].join(""));this.set("help",d[b.type]||((mstrApp.helpTopics&&mstrApp.helpTopics.condition)||"new_condition_dialog_box.htm"));var Z;if(b&&b.tkn){Z=S.clone(b.tkn);U(Z);g.set("items",Z);}if(b&&b.selFuncItem){c.openPopup("wizard",{fctOi:b.selFuncItem,zIndex:c.zIndex+10,insertOnFinish:function(h){g.insertTokens(h);}});}},onClose:function C(){var Z=this.exprEditBox.inputBox;Z.set("items",[]);Z.itemcount=0;},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-toolBox",alias:"toolBox",children:[{scriptClass:"mstrmojo.Label",cssText:"font-size: 10pt",text:mstrmojo.desc(4449,"Expression")+":"},{scriptClass:"mstrmojo.ToolBar",cssClass:"mstrmojo-oivmSprite grouped",alias:"toolBar",cssText:"float: right",children:[{scriptClass:"mstrmojo.MenuButton",alias:"func",iconClass:"tbInsert",title:mstrmojo.desc(2919,"Insert"),zIndex:80,itemIdField:"did",itemField:"n",itemChildrenField:"fns",isSeparatorItem:function L(Z){return Z[this.itemIdField]===-1;},executeCommand:function V(a){var Z=this.parent.parent.parent,b=Z.exprEditBox.inputBox;if(a.did===-999){Z.openPopup("functionSelector",{functions:Z.funclist,zIndex:Z.zIndex+10,openWizard:function(c){Z.openPopup("wizard",{fctOi:c,zIndex:Z.zIndex+10,insertOnFinish:function(d){b.insertTokens(d);}});}});}else{Z.openPopup("wizard",{fctOi:a,zIndex:Z.zIndex+10,insertOnFinish:function(c){b.insertTokens(c);}});}}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(9110,"Syntax Validation"),iconClass:"tbValidate",onclick:function(){R.call(this.parent.parent.parent);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(2827,"Clear"),iconClass:"tbClear",onclick:function(){var Z=this.parent.parent.parent,a=[];Z.oi.tkn=a;Z.exprEditBox.inputBox.clearTokens(a);Z.exprEditBox.resizeInputBox();}}]}]},{scriptClass:"mstrmojo.ME.MetricEditBox",alias:"exprEditBox",cssText:"height:132px;",children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",browseItemVisible:false,renderBlockSize:1000,item2textCss:function J(Z){return" mstrmojo-qb-SuggestIcon t"+Z.t;},itemFunction:function G(c,Z,a){return new mstrmojo.ME.MetricToken({data:c,brackets:K,isDelimiter:function b(){return this.data.isDelimiter||(this.length()===1&&mstrmojo.qb.FFsqlToken.isDelimiter(this.data.v));}});},isDelimiter:mstrmojo.qb.FFsqlToken.isDelimiter}],markupMethods:{onvStatusChange:function(){var a=this.vStatus,Z=this.vStatusNode;Z.className="mstrmojo-MEBox-vStatus "+X[a];Z.innerHTML=T[a];},oniStatusChange:function(){this.iStatusNode.innerHTML=this.iStatus;this.resizeInputBox();}},handleValidation:function F(c,e){if(!c){this.set("vStatus",P.ERROR);return ;}c.vs=D(c.reject_error_code);this.set("vStatus",c.vs);this.set("iStatus",c.reject_error_description||"");var d=c.items,g=[],f,Z=".",b,a;O.forEach(d,function(j,h){g[h]={};if(j.tp===304&&!/^'.*'$/.test(j.v)){j.v=["'",j.v,"'"].join("");}if(j.tp===309){f=j.v;b=f.lastIndexOf(Z);if(b>=1){j.v=f;g[h].oi={tn:f.slice(0,b),rn:f.slice(b+1),tp:26};}else{g[h].oi={tn:null,rn:f,tp:26};}}if(j.orf){g[h].oi=j.orf;j.v=[" ",j.v," "].join("");}g[h].v=!j.v||(typeof j.v)==="string"?j.v:j.v.toString();g[h].sta=j.sta;});this.inputBox.set("items",g);this.resizeInputBox();if(!e){this.inputBox.focus();}},resizeInputBox:function H(){var b=this.inputBox.domNode,a=this.iStatusNode.parentNode,c=parseInt(this.domNode.clientHeight,10)-7,Z=a.offsetHeight;if(b){b.style.height=c-Z+"px";}}},{scriptClass:"mstrmojo.HBox",cssText:"float: right; border-collapse: separate;margin:10px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(5891,"Save"),onclick:function(){var e=this.parent.parent,d=e.oi,a=d.type,c=d.w,Z=e.exprEditBox.inputBox,b=M(Z.items),g={success:function f(){e.close();}};d.isSave=true;switch(a){case B:R.call(e,{success:function f(){mstrApp.getRootController().addColumnWithExpression(c,b,Z.items,g);}});break;case Y:R.call(e,{success:function f(){mstrApp.getRootController().editColumnExpression(d.cIndex,b,Z.items,g);}});break;default:R.call(e,mstrmojo.func.wrapMethods(d.callbacks,g));}}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.form","mstrmojo.qb.ExpressionEditor","mstrmojo.qb.MissingColumnWarning","mstrmojo.qb.DataService","mstrmojo.warehouse.EnumDataChangeEvents");mstrmojo.requiresDescs(218,219,1442,9220,9221,9222,9223,9224,9225,9226,9227,9228,9229,9230,9945,9946,11164);var P=mstrmojo.string,U=mstrmojo.hash,Y=mstrmojo.array,X=mstrmojo.css,BU=mstrmojo.DI.DIHelpers,AN=mstrmojo.DI.DIConstants,BQ=P.decodeHtmlString,A5=mstrmojo.warehouse.EnumDataChangeEvents,BS="    ",A6="A61B85F4485D3B953003B195E58B5138",BT=15,L=200,A3=200,l=0,R=0,a=["0DFE6FB4356F4FA2A0C1C10D0B415355","375104850C3E45EA889D9F5FEB37D317","B2C0FA4020C711D6AD1400C04F0423DE","B2C0FA4120C711D6AD1400C04F0423DE","9AD889E56E4D4E56A127207B4AF77166","AB08D4FC700B4EE58C021BFA2ABD77D0","993F6897863E43CFBEA4969F68BBDED7","C50F2A4F75AE49D6B20E00224967B500","0150F348CB0B4D9AB8CCA458C1ACC4B0","6F7DF5F2449111D5BEA300B0D01A55EF","6F7DF5F3449111D5BEA300B0D01A55EF","6F7DF5F4449111D5BEA300B0D01A55EF","6F7DF5FB449111D5BEA300B0D01A55EF","6F7DF5FE449111D5BEA300B0D01A55EF","6F7DF5FC449111D5BEA300B0D01A55EF","6F7DF5F6449111D5BEA300B0D01A55EF","A9A5B40DF7204F27A04AB3C74225477E","B651EC29A3074BA68F31DE99FC300AF7","7C63D4E70B2741C3A5B54A2EFD40961B","6F7DF5F7449111D5BEA300B0D01A55EF","6F7DF5FD449111D5BEA300B0D01A55EF","6F7DF5F5449111D5BEA300B0D01A55EF","6F7DF5F8449111D5BEA300B0D01A55EF","2146A148C528458181CD816CD96E71D3","8F090B600594488A8FF89A5867C78973","8107C33EDD9911D3B98100C04F2233EA","8107C33FDD9911D3B98100C04F2233EA","6F7DF5FF449111D5BEA300B0D01A55EF","8107C357DD9911D3B98100C04F2233EA","6F7DF606449111D5BEA300B0D01A55EF","6F7DF609449111D5BEA300B0D01A55EF","6F7DF600449111D5BEA300B0D01A55EF","6F7DF601449111D5BEA300B0D01A55EF","6F7DF602449111D5BEA300B0D01A55EF","6F7DF603449111D5BEA300B0D01A55EF","6F7DF608449111D5BEA300B0D01A55EF","6F7DF604449111D5BEA300B0D01A55EF","6F7DF605449111D5BEA300B0D01A55EF","6F7DF607449111D5BEA300B0D01A55EF","8107C347DD9911D3B98100C04F2233EA","8107C327DD9911D3B98100C04F2233EA","F262C811DDA611D3B98100C04F2233EA","F262C812DDA611D3B98100C04F2233EA","F262C813DDA611D3B98100C04F2233EA","F262C830DDA611D3B98100C04F2233EA","F262C814DDA611D3B98100C04F2233EA","F262C815DDA611D3B98100C04F2233EA","F262C816DDA611D3B98100C04F2233EA","F262C817DDA611D3B98100C04F2233EA","F262C818DDA611D3B98100C04F2233EA","F262C819DDA611D3B98100C04F2233EA","F262C81ADDA611D3B98100C04F2233EA","F262C81BDDA611D3B98100C04F2233EA","F262C81CDDA611D3B98100C04F2233EA","F262C81DDDA611D3B98100C04F2233EA","F262C81EDDA611D3B98100C04F2233EA","F262C81FDDA611D3B98100C04F2233EA","F262C820DDA611D3B98100C04F2233EA","F262C821DDA611D3B98100C04F2233EA","F262C822DDA611D3B98100C04F2233EA","F262C831DDA611D3B98100C04F2233EA","F262C824DDA611D3B98100C04F2233EA","F262C825DDA611D3B98100C04F2233EA","F262C826DDA611D3B98100C04F2233EA","F262C828DDA611D3B98100C04F2233EA","F262C829DDA611D3B98100C04F2233EA","5CCBF590DAB311D5AD0E00C04F0423DE","F262C82ADDA611D3B98100C04F2233EA","F262C82BDDA611D3B98100C04F2233EA","F262C82CDDA611D3B98100C04F2233EA","F262C82DDDA611D3B98100C04F2233EA","F262C82EDDA611D3B98100C04F2233EA","F262C82FDDA611D3B98100C04F2233EA","A202C222DD9D11D3B98100C04F2233EA","A202C223DD9D11D3B98100C04F2233EA","A202C224DD9D11D3B98100C04F2233EA","A202C225DD9D11D3B98100C04F2233EA","A202C226DD9D11D3B98100C04F2233EA","A202C228DD9D11D3B98100C04F2233EA","A202C227DD9D11D3B98100C04F2233EA","A202C229DD9D11D3B98100C04F2233EA","A202C210DD9D11D3B98100C04F2233EA","A202C211DD9D11D3B98100C04F2233EA","A202C212DD9D11D3B98100C04F2233EA","A202C213DD9D11D3B98100C04F2233EA","A202C22ADD9D11D3B98100C04F2233EA","A202C22BDD9D11D3B98100C04F2233EA","A202C214DD9D11D3B98100C04F2233EA","A202C215DD9D11D3B98100C04F2233EA","A202C216DD9D11D3B98100C04F2233EA","A202C217DD9D11D3B98100C04F2233EA","A202C22DDD9D11D3B98100C04F2233EA","A202C218DD9D11D3B98100C04F2233EA","A202C22CDD9D11D3B98100C04F2233EA","A202C219DD9D11D3B98100C04F2233EA","A202C21ADD9D11D3B98100C04F2233EA","A202C22EDD9D11D3B98100C04F2233EA","A202C22FDD9D11D3B98100C04F2233EA","A202C230DD9D11D3B98100C04F2233EA","A202C231DD9D11D3B98100C04F2233EA","A202C21BDD9D11D3B98100C04F2233EA","A202C21CDD9D11D3B98100C04F2233EA","A202C232DD9D11D3B98100C04F2233EA","A202C233DD9D11D3B98100C04F2233EA","A202C234DD9D11D3B98100C04F2233EA","A202C21DDD9D11D3B98100C04F2233EA","A202C21EDD9D11D3B98100C04F2233EA","A202C236DD9D11D3B98100C04F2233EA","A202C21FDD9D11D3B98100C04F2233EA","A202C220DD9D11D3B98100C04F2233EA","A202C237DD9D11D3B98100C04F2233EA","A202C238DD9D11D3B98100C04F2233EA","A202C239DD9D11D3B98100C04F2233EA","A202C221DD9D11D3B98100C04F2233EA","A202C235DD9D11D3B98100C04F2233EA","A202C23ADD9D11D3B98100C04F2233EA","A202C23BDD9D11D3B98100C04F2233EA","9C374206DD9F11D3B98100C04F2233EA","9C374207DD9F11D3B98100C04F2233EA","9C374209DD9F11D3B98100C04F2233EA","9C374220DD9F11D3B98100C04F2233EA","9C37421CDD9F11D3B98100C04F2233EA","9C37420CDD9F11D3B98100C04F2233EA","9C374208DD9F11D3B98100C04F2233EA","9C37421DDD9F11D3B98100C04F2233EA","9C374236DD9F11D3B98100C04F2233EA","9C37420DDD9F11D3B98100C04F2233EA","9C374233DD9F11D3B98100C04F2233EA","9C37420EDD9F11D3B98100C04F2233EA","9C374214DD9F11D3B98100C04F2233EA","9C374216DD9F11D3B98100C04F2233EA","9C374215DD9F11D3B98100C04F2233EA","9C37421EDD9F11D3B98100C04F2233EA","9C374219DD9F11D3B98100C04F2233EA","9C37421ADD9F11D3B98100C04F2233EA","9C374218DD9F11D3B98100C04F2233EA","9C37421BDD9F11D3B98100C04F2233EA","9C37420FDD9F11D3B98100C04F2233EA","9C374210DD9F11D3B98100C04F2233EA","9C37420BDD9F11D3B98100C04F2233EA","9C37421FDD9F11D3B98100C04F2233EA","9C374211DD9F11D3B98100C04F2233EA","9C374221DD9F11D3B98100C04F2233EA","9C37420ADD9F11D3B98100C04F2233EA","9C374212DD9F11D3B98100C04F2233EA","9C374213DD9F11D3B98100C04F2233EA"],BE=12,B=4,AD=1,A1=2,Bd=4,BB=256,BO=15,Bb=1,A9=2,AO=4,Aq=8,b=1,Al=2,AJ=8,Bl=16,AL=1,H=0,E=" ",c=".",Q="/",At=";";function K(Bm){var Bn=P.trim(Bm);if(Bn.slice(-1)===At){Bn=Bn.slice(0,-1);}return Bn;}function w(Bm,Bn){if(!Bn){return Bm;}return(Bm.indexOf(E)>-1||Bm.indexOf(c)>-1||Bm.indexOf(Q)>-1)?Bn.replace("#0",Bm):Bm;}function j(Bo,Br,Bp){var Bt=[],Bn=Bp.length,Bs,Bm,Bq,Bu=10;Bm=mstrApp.isBigQuery?"":((this.getDBRole&&this.getDBRole(this.SelDBRoleID).mdDBRole.cpat)||"");Bt.push({v:"select",oi:{n:"select",sta:100,t:100}},{isNew:true,v:" ",isDelimiter:true});Y.forEach(Bp,function(Bw,Bv){Bt.push({v:w(Bw.cln,Bm)});Bs=Bv<Bn-1;if(Bs){Bt.push({v:",",isDelimiter:true});}Bt.push({v:"\n",isDelimiter:true});if(Bs){for(Bq=0;Bq<Bu;++Bq){Bt.push({v:" ",isDelimiter:true});}}});Br=w(Br,Bm);Bt.push({v:"from",oi:{n:"from",sta:100,t:100}},{v:" ",isDelimiter:true},{v:" ",isDelimiter:true},{v:" ",isDelimiter:true},{v:(Bo?w(Bo,Bm)+c+Br:Br)},{v:";"});this.raiseEvent({name:"sqlTokensAdded",value:Bt});}function z(Bn){if(!Bn||!Bn.length){return ;}var Bm=Bn[Bn.length-1];if(Bm&&Bm.tp===-1){Bn.pop();}if(Bn[0]&&(Bn[0].tp===64||(Bn[0].tp===36&&Bn[0].v==="$"))){Bn.splice(0,1);}}function C(Bn){var Bm=[];Y.forEach(Bn,function(Bo){Bm.push(Bo.v);});return Bm.join(" ");}function Ah(Bn){var Bm={">=":2,"<>":5,"<=":4,"<":3,">":1},Bo;for(Bo in Bm){if(Bn.indexOf(Bo)>-1){return Bm[Bo];}}return 0;}function D(Bo,Bq){var Bm=function(Bs,Br){return mstrmojo.array.stringSorter(Bs.n||Bs.did,Br.n||Br.did);},Bp,Bn=[];if(Bq){Y.forEach(Bo,function(Br){Y.forEach(Br.fns,function(Bs){if(Y.indexOf(a,Bs.did)>-1){Br.fns=Br.fns.sort(Bm);Bp=[];Y.forEach(Br.fns,function(Bt){if(Y.indexOf(a,Bt.did)>-1){Bp.push(Bt);}});Br.fns=Bp;Bn.push(Br);return false;}});});}else{Y.forEach(Bo,function(Br){Y.forEach(Br.fns,function(Bs){if(Y.indexOf(BV,Bs.did)>-1){Br.fns=Br.fns.sort(Bm);if(mstrApp.isCloudPro&&Bs.did===BV[2]){Y.removeItems(Br.fns,"did",[{did:BL}]);}Bn.push(Br);return false;}});});}Bn=Bn.sort(Bm);return Bn;}var AQ={1:"Sum",2:"Avg",3:"Min",4:"Max",5:"Count",6:"Count<Distinct=true>"};var BV=["8107C31BDD9911D3B98100C04F2233EA","6F7DF5F8449111D5BEA300B0D01A55EF","4A257916A153468384320E8DB7FD338B","8107C345DD9911D3B98100C04F2233EA","6F7DF605449111D5BEA300B0D01A55EF","8107C324DD9911D3B98100C04F2233EA","F262C81CDDA611D3B98100C04F2233EA"];var BL="8107C344DD9911D3B98100C04F2233EA",Bg=".";function BD(Bn){var Bo=Bn.indexOf(Bg),Bm;if(Bo>=1){Bm=Bn.slice(0,Bo).toLowerCase();}return Bm;}function AA(Bt,Bn){if(!Bt){return false;}var Bq=Bt.nds,Bs;if(Bq){var Br=[],Bm,Bo;Y.forEach(Bq,function(Bv,Bu){AA(Bv,Bn)&&Br.push(Bu);});for(Bm=Br.length-1;Bm>-1;Bm--){Bq.splice(Br[Bm],1);}Bo=Bq.length;if(Bo===1){Bt=Bq[0];}return(Bo===0);}var Bp;Y.forEach(Bt.expr,function(Bu){if(Bu.tp===309){Bs=BD(Bu.v);if(Bs!==undefined&&Bn===Bs){Bp=true;return false;}}});return Bp;}function A4(Bq,Bm,Br){if(!Br){return ;}var Bp=Br.expr,Bn,Bo=Br.cols;Y.forEach(Bp,function(Bs){Bn=Bs.tknctx&&Bs.tknctx.oi;if(Bn&&Bn.tp===26){if(Bs.extra.sqlti.als===Bq){Bs.extra.sqlti.als=Bm;Bs.v=(Bs.v+"").replace(Bq,Bm);}}});Y.forEach(Bo,function(Bs){if(Bs.t===Bq){Bs.t=Bm;Bs.v=(Bs.v+"").replace(Bq,Bm);}});Br.n=(Br.n+"").replace(Bq,Bm);Y.forEach(Br.nds,function(Bs){A4(Bq,Bm,Bs);});}function I(Bo,Bt){Bo=Bo||{};if(!Bt){return ;}var Br=Bt.expr,Bn,Bm,Bq=Bt.cols,Bs,Bp;Y.forEach(Br,function(Bu){if(Bu.tp===309){var Bw=Bu.v.toString().indexOf(Bg),Bv=Bu.v.toString();if(Bw>=1){Bm=Bv.slice(0,Bw).toLowerCase();Bp=Bv.slice(Bw+1).toLowerCase();if(Bm&&Bp){Bo[Bm]=Bo[Bm]||{};Bo[Bm][Bp]=true;}}}});Y.forEach(Bq,function(Bu){Bm=Bu.t.toLowerCase();Bo[Bm]=Bo[Bm]||{};Bo[Bm][Bu.col.toLowerCase()]=true;});Y.forEach(Bt.nds,function(Bu){I(Bo,Bu);});}var W=mstrmojo.expr,BF=W.ET,A={19:" AND ",20:" OR ",21:"(NOT( "},AT="))";function Am(Bq){if(!Bq){return"";}if(!Bq.nds){return Bq.n||"";}var Bo=[],Bp=Bq.nds,Bn=Bq.fn,Bm;Y.forEach(Bp,function(Bs,Br){Bm=Bs.not;if(Br!==0){Bo.push(A[Bn]);}Bm&&Bo.push(A[21]);Bo.push("(");Bo.push(Am(Bs));Bo.push(")");Bm&&Bo.push(AT);});return Bo.join("");}function AI(Bm){return BQ(Bm).replace(/&apos;/g,"'");}function Ag(Bm){return Bm.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}var BH=function(Bm){if(Bm==null){return"null";}var Bn=typeof (Bm);if(Bn!="object"){return Bn;}else{if(Bm.length===undefined){return"object";}else{return"array";}}};var AE=[{n:"Text",v:"3"},{n:"Number",v:"2"},{n:"Date",v:"8"},{n:"Time",v:"9"},{n:"DateTime",v:"1"},{n:"URL",v:"5"},{n:"Email",v:"6"},{n:"HTML Tag",v:"7"},{n:"Symbol",v:"10"},{n:"Big Decimal",v:"11"},{n:"Phone Number",v:"12"}];function t(Bq){var Bo=[],Bn=[];var Bp={mi:true,cn:true,v:true,tp:true,lv:true,sta:true,tkn:true};Bo.push({lv:3,sta:1,tp:64,v:""});Bo.push({lv:1,sta:1,tp:2,v:Bq});Bo.push({lv:2,sta:1,tp:-1,v:""});var Bm={getArrItemName:function(Bt,Br,Bs){return"tkn";},isSerializable:function(Bt,Bs,Br){return(Bp[Bt])?true:false;}};Bn.push('<mi cn="3">');Bn.push(P.json2xml("tkn",Bo[0],Bm));Bn.push(P.json2xml("tkn",Bo[1],Bm));Bn.push(P.json2xml("tkn",Bo[2],Bm));Bn.push("</mi>");return Bn.join("");}var Aj=0,f=1,o=2,Bf=3,Be=4,Au=5,F=6,AH=7,BP=8,BG=9,Ap=10,Ac=11,AR=12;var Ak={0:Aj,1:o,2:o,3:o,4:o,5:o,6:o,7:o,8:Bf,9:Bf,10:Bf,11:Bf,12:Bf,13:Bf,14:BP,15:BG,16:f,17:Bf,18:Bf,30:Ac,31:Aj,33:Aj};function q(Bo,Bs){var Bq=[],Bn,Br;for(var Bp=0,Bm=Bs.length;Bp<Bm;Bp++){Bn=Bs[Bp];if(Bo.uiids[Bn.tid+Bn.cid]){Br=Bo.uiids[Bn.tid+Bn.cid];Bq.push(Br);}}return Bq;}function AV(Br,Bo,Bs,Bm,By,Bv){if(!Bo.ftype){var Bn=Ag(Bo.exp);if(Bn.indexOf("? aptqbr_prompt")>-1){Bv.push({n:Bn,cid:Bm.chn[0].cmid});return ;}var Bz=q(Br,AX(Bm,[])),Bu,Bw=[];Y.forEach(Bz,function(B0){Bu=mstrmojo.all[B0];Bu&&Bu.updateState&&Bu.updateState(2);Bw.push({t:Bu.srcTable,col:Bu.text});});return Bs.push({et:"*",n:Bn,expr:[{v:Bn}],sqltp:By,cols:Bw});}switch(Bo.ftype){case 19:case 20:case 21:var Bq=[],Bx;for(var Bp=0,Bt=Bo.children.length;Bp<Bt;Bp++){Bx=Bo.children[Bp];AV(Br,Bx,Bq,Bm.chn[Bp],By,Bv);}if(Bq.length==0){return ;}if(Bq.length<Bt&&Bq.length==1){Bs.push(Bq[0]);}else{Bs.push({et:14,fn:Bo.ftype,nds:Bq,not:(Bo.ftype==21),sqltp:By});}break;default:break;}}function M(Bo,Bq,Bm){if(!Bq.ftype){Bm.push({lcid:Bo.chn[0].col,rcid:Bo.chn[1].col,exp:Bq.exp});return Bq.exp;}var Bp,Bn,Br;switch(Bq.ftype){case 19:case 20:Bp=M(Bo.chn[0],Bq.children[0],Bm);Bn=M(Bo.chn[1],Bq.children[1],Bm);Br=Bp+((Bq.ftype==19)?" AND ":" OR ")+Bn;break;case 21:Br=" NOT "+M(Bo.chn[0],Bq.children[0],Bm);break;default:break;}return Br;}function AX(Bo,Bp){var Bq=Bo.chn;if(!Bq){if(Bo.col&&Bo.stbid){Bp.push({cid:Bo.col,tid:Bo.stbid});}return Bp;}for(var Bn=0,Bm=Bq.length;Bn<Bm;Bn++){Bp=AX(Bq[Bn],Bp);}return Bp;}function g(Bm){Bm.raiseEvent({name:"dataPreview",mappings:Bm.mappings,dataset:Bm.dataset,selectedColumns:Bm.selectedClns,isRefined:Bm.isRefined});}function BI(Bm,Bp,Bn){var Bo=Bm[Bm.length-1].oi.def.csl.roo.chn[0].va.vv;Bo=Bo?Ag(Bo):"";mstrApp.getRootController().raiseEvent({name:"reportModeChange",mode:2,value:Bo});Bn.populateFFSQLMapping(Bp);if(Bn.firstTimeLoading){g(Bn);Bn.firstTimeLoading=false;}}function As(CO,Br){if(!CO||!CO.btb){return ;}var B9=CO.btb;var CT=CO.datap.maps;if(Br.firstTimeLoading){Br.orimaps=CT;}Br.refresh_opt=B9[0].oi.def.crpt;var B8=null;if(B9[0].oi.ext_type===304){Br.set("isFFSQL",true);Br.set("FFSQLMode",true);mstrApp.isFFSQL=mstrApp.isFFSQLMode=true;for(var CZ=0,CA=B9.length;CZ<CA;CZ++){if(B9[CZ].oi.tp===53){B8=B9[CZ].oi.def.dbr.did;}}B8&&Br._set_SelDBRoleID("SelDBRoleID",B8,false);BI(B9,CT,Br);return ;}var Cb={},Bo={},Bn,Bq;for(var CZ=0,CA=B9.length;CZ<CA;CZ++){Bq=B9[CZ].oi;switch(Bq.tp){case 53:Cb[Bq.did]={cs:Bq.def.cs.cs,tbn:AI(Bq.def.tbn),did:Bq.did,ns:Bq.def.ns};break;case 26:Bo[Bq.did]={did:Bq.did,cln:AI(Bq.def.cln),dttp:Bq.def.dt.tp,dtps:Bq.def.dt.ps,dtsc:Bq.def.dt.sc};break;case 3:Bn=Bq.efd;break;default:break;}}var CB=null,CP=null;for(var CZ=0,CA=Bn.length;CZ<CA;CZ++){CP=Bn[CZ].oi;switch(CP.tp){case 53:CB=CP.def.sqs.c_c[0];B8=CP.def.dbr.did;break;default:break;}}Br._set_SelDBRoleID("SelDBRoleID",B8,false);if(CB===null){return ;}var CI=CB.sqcs.c_c;var B4=CB.sjs.c_c;var Ca=CB.stbs.c_c;var B0=CB.whe;var CR=CB.w_cond;var Ce=CB.he;var Bt=CB.h_cond;Br.selectedClns=[];Br.dbtables=[];Br.joins=[];Br.joinsInfo={};Br.uiids={};Br.tables={};var CW=Br.selectedClns;var CN={},B7,Cc,Bz,B3,Bw;for(var CZ=0,CA=CI.length;CZ<CA;CZ++){if(CI[CZ].der&2147483648){CW.push({isDerived:true,existing:true});continue;}B7=AX(CI[CZ].exp.roo,[]);Cc=AI(CI[CZ].exp.exp);CW.push({wid:[],expr:[{v:Cc}],existing:true});for(var CY=0;CY<B7.length;CY++){Bw=B7[CY];Bz=Bw.cid;B3=Bw.tid;CN[B3]=CN[B3]||{};CN[B3][Bz]=CN[B3][Bz]||{};CN[B3][Bz].state=1;CN[B3][Bz].count=!CN[B3][Bz].count?1:CN[B3][Bz].count+1;CW[CZ].wid.push(B3+Bz);}}Br.tbns={};var B2=Br.pos_hash;var Bv=Br.tbns,CX=[];var CU,Bu,Bs,Bz,CF,CS,B6;for(var CZ=0,CA=Ca.length;CZ<CA;CZ++){CX[CZ]={};CU=Ca[CZ];B3=CU.id;Bu=CU.dbt.did;B6=CU.als?AI(CU.als):Cb[Bu].tbn;CF=Cb[Bu].cs;if(B2&&B2[B6]){CX[CZ].pos={w:B2[B6].w,h:B2[B6].h,t:B2[B6].t,l:B2[B6].l};}else{Bs=CU.sqltf;if(Bs&&Bs.length){CX[CZ].pos={w:(Bs[0]&&Bs[0].pdv)/BT||A3,h:(Bs[1]&&Bs[1].pdv)/BT||L,t:(Bs[2]&&Bs[2].pdv)/BT||l,l:(Bs[3]&&Bs[3].pdv)/BT||R};}}CS=[];for(var CY=0,CD=CF.length;CY<CD;CY++){Bz=CF[CY].did;CS.push(U.copy(Bo[Bz]));if(CN[B3]&&CN[B3][Bz]){CS[CY].state=1;CS[CY].count=CN[B3][Bz].count;}}CX[CZ].did=B3;CX[CZ].cs=CS;CX[CZ].tbn=B6;CX[CZ].ns=Cb[Bu].ns;CX[CZ].dbtbn=Cb[Bu].tbn;Bv[B6]=B6;}if(Br.firstTimeLoading&&!Br.isNew){Br.orits=Br.orits||CX.slice(0);}var B5=Br.orits;Y.forEach(CX,function(Cf){if(Y.find(B5,"did",Cf.did)>-1){Cf.existing=true;Cf.readOnly=mstrApp.isCloudPro;}});Br.raiseEvent({name:"BindingTableLoaded",value:CX});for(var CZ=0,CA=CW.length;CZ<CA;CZ++){var CV=CW[CZ].wid;if(CV){for(var CY=0,CD=CV.length;CY<CD;CY++){CV[CY]=Br.uiids[CV[CY]];}}}Br.populateMappings(CT);if(CO.datap.data){Br.populateDataset(CO.datap.data);}g(Br);var B1,CL,Bp,Bx,CM,CG,CJ,Bm,Cc,CC,Cd;for(var CZ=0,CA=B4.length;CZ<CA;CZ++){B1=B4[CZ];CL=B1.ltid,Bp=B1.rtid,Bx=B1.jt,idx=B1.ix;CG=B1.cdn.roo;Cd=[];Cc=AI(M(CG,B1.exp_bo,Cd));CC=Br.uiids[CL]+Br.uiids[Bp];Br.joins.push(CC);Br.joinsInfo[CC]=new Object();Br.joinsInfo[CC].jt=""+Bx;Br.joinsInfo[CC].exp=Cc;Br.joinsInfo[CC].srctID=Br.uiids[CL];Br.joinsInfo[CC].tgttID=Br.uiids[Bp];if(!Br.joinsInfo[CC].links){Br.joinsInfo[CC].links=new Object();}if(Br.tables[Br.uiids[CL]].njoins){Br.tables[Br.uiids[CL]].njoins++;}else{Br.tables[Br.uiids[CL]].njoins=1;}if(Br.tables[Br.uiids[Bp]].njoins){Br.tables[Br.uiids[Bp]].njoins++;}else{Br.tables[Br.uiids[Bp]].njoins=1;}for(var CY=0;CY<Cd.length;CY++){CJ=Cd[CY].lcid;Bm=Cd[CY].rcid;Cc=AI(Cd[CY].exp);var CQ=Br.uiids[CL+CJ],By=Br.uiids[Bp+Bm];Br.joinsInfo[CC].links[CQ+By]={srcw:mstrmojo.all[CQ],tgtw:mstrmojo.all[By],coords:[],exp:Cc,jid:CC,op:Ah(Cc)};if(Br.joinsInfo[CC].nlinks){Br.joinsInfo[CC].nlinks++;}else{Br.joinsInfo[CC].nlinks=1;}}}Br.raiseEvent({name:"JoinsLoaded"});var B9=[],CH=[];if(B0.exp!=""){AV(Br,CR,B9,B0.roo,0,CH);B9.length&&(Br.conditions.where=B9[0]);if(CH.length&&!Br.isCubeReport){Br.pattrs={};var CE=CT.amps,CK;Y.forEach(CE,function(Cf){if(Y.find(CH,"cid",Cf.afmps[0].sqc.id)>=0){CK=Cf.aimp;Br.pattrs[CK.atid]={n:CK.atnm,tp:12};}});}}if(Ce.exp!=""){B9=[];AV(Br,Bt,B9,Ce.roo,1);B9.length&&(Br.conditions.having=B9[0]);}Br.firstTimeLoading=false;}function AP(Bo,Bn,Bm){mstrApp.getRootController().getDataService()[Bm||"submitRequest"](Bo,Bn);}function G(Bm,Bp,Bo){var Bn={};if(!Bm[Bp]){Bm[Bp]=Bo;}else{if(!Bm[Bo]){Bm[Bo]=Bp;}else{while(Bm[Bp]){Bn[Bp]=true;Bp=Bm[Bp];if(Bn[Bp]){return ;}}Bm[Bp]=Bo;}}}function BM(Bm,Bo,Bn){if(Bm[Bo]){delete Bm[Bo];}else{if(Bm[Bn]){delete Bm[Bn];}}}function BC(Bm,Bp,Bo){var Bn={};while(Bm[Bp]){Bn[Bp]=true;Bp=Bm[Bp];if(Bn[Bp]){return true;}}while(Bm[Bo]){Bn[Bo]=true;Bo=Bm[Bo];if(Bn[Bo]){return true;}}return Bp===Bo;}function Bi(Br,Bp){var Bs=[],Bo,Bn,Bm,Bq;for(Bn in Br){Bm=Br[Bn].links;Bq=Bm[0];Bo={srcIndex:Bp.gettIndex(Bq.srcw.srcID),destIndex:Bp.gettIndex(Bq.tgtw.srcID),jtype:Bq.jtype,jexp:Br[Bn].jexp};Bs.push(Bo);}return Bs;}mstrmojo.qb._hasQBModel=mstrmojo.provide("mstrmojo.qb._hasQBModel",{id:"QBuilderModel",tables:{},selLink:null,dbtbls:{},uiids:{},riid:"",analysisID:null,alertTitle:null,msgid:"",dbtables:[],selectedClns:[],joins:[],joinsInfo:{},joinCols:{},dbrs:[],dsns:[],drivers:[],dbms:[],suppdbs:[],pos_hash:{},bindingT:[],tbns:{},catalogRefresh:false,SelDBRoleID:null,prevDBRoleID:null,isDI:false,FFSQLMode:false,isFFSQL:false,isCloud:false,supportTimeGeo:true,isCubeReport:true,autoRefreshSQL:false,isDirty:false,SQLPreviewStmt:"",SQLstmt:undefined,refresh_opt:1,mappings:[],cloneMappings:[],dataset:[],cacheMP:[],cacheDS:[],conditions:{},cnum:0,datatypes:AE,init:function Bh(Bm){if(this._super){this._super(Bm);}this.dbtables=[];this.tables={};this.selectedClns=[];this.tbns={};this.joins=[];this.joinsInfo={};this.joinCols={};this.uiids={};this.conditions={};this.mappings=[];this.cloneMappings=[];this.dataset=[];this.cacheMP=[];this.cacheDS=[];},addLink:function m(Bo,Bs,Bn,Br){var Bp=this,Bw=Bo.id+Bs.id,Bx=Bp.joinsInfo[Bn].links,Bq=Bp.joinsInfo[Bn].jt;var Bv=this.getjIndex(Bn),Bm=this.brackets(Bo.oriexpr)+"="+this.brackets(Bs.oriexpr),Bu=Bp.joinsInfo[Bn].exp+" AND "+Bm;if(Bx[Bw]||Bx[Bs.id+Bo.id]){return ;}var Bt={success:function(By){Bp.joinsInfo[Bn].exp=Bu;Bx[Bw]={};Bx[Bw].srcw=Bo;Bx[Bw].tgtw=Bs;Bx[Bw].coords=[];Bx[Bw].exp=Bm;Bx[Bw].jid=Bn;Bp.joinsInfo[Bn].exp=Bu;if(Br&&Br.success){Br.success();}Bp.raiseEvent({name:"JoinsAdded"});}};G(Bp.joinCols,Bo.id,Bs.id);mstrApp.getRootController().getDataService().editJoin(Bt,{jindex:Bv,exp:Bu,tbid:Bp.tableID||"",jtype:Bq});},removeLink:function AB(Bs,Bm,Bp){var Bn=this,Bv=Bn.joinsInfo[Bm].links,Bo=Bn.joinsInfo[Bm].jt,Bu=Bn.getjIndex(Bm),Br="",Bt=Bv[Bs];U.forEach(Bv,function(Bx,Bw){if(Bw!==Bs){Br+=(Br?" AND ":"")+Bx.exp;}});BM(Bn.joinCols,Bt.srcw.id,Bt.tgtw.id);if(!Br){Bn.removeJoin(Bm,Bp);}else{var Bq={success:function(Bw){mstrApp.msgid=Bw.msgid;Bn.joinsInfo[Bm].exp=Br;delete Bv[Bs];if(Bp&&Bp.success){Bp.success();}}};mstrApp.getRootController().getDataService().editJoin(Bq,{jindex:Bu,exp:Br,tbid:Bn.tableID||"",jtype:Bo});}},getTouchValue:function Av(Bm,Br){for(var Bp in this.joinsInfo){var Bo=this.joinsInfo[Bp].links;for(var Bq in Bo){var Bn=Bo[Bq].coords;if(this.inPoly(Bn,Bm,Br)){return[Bp,Bq];}}}return null;},inPoly:function BA(Bo,By,Bx){var Bu=Bo.length;var Br,Bm,Bz,Bt,Bp,Bw,Bn,Bv,Bs;var Bq=false;if(Bu/2<3){return false;}Bz=Bo[Bu-2];Bt=Bo[Bu-1];for(Bs=0;Bs<Bu;Bs=Bs+2){Br=Bo[Bs];Bm=Bo[Bs+1];if(Br>Bz){Bp=Bz;Bn=Br;Bw=Bt;Bv=Bm;}else{Bp=Br;Bn=Bz;Bw=Bm;Bv=Bt;}if((Br<By)==(By<=Bz)&&((Bx-Bw)*(Bn-Bp)<(Bv-Bw)*(By-Bp))){Bq=!Bq;}Bz=Br;Bt=Bm;}return Bq;},exprEditor:function(Bn,Bo,Bp,Bm){this.getFunctions();},brackets:function(Bm){return"["+Bm+"]";},isEquivalentExpr:function(Bo,Bn){var Bm=function Bm(Bp){return Bp.replace(/\s/g,"").replace(/\[+(.*?)\]+/g,"$1").replace(/\(+(.*?)\)+/g,"($1)").toUpperCase();};return(Bm(Bo)===Bm(Bn));},_set_SelDBRoleID:function(Bp,Bn){var Bm=this,Bo=(Bm.SelDBRoleID!==Bn);this._super&&this._super(Bp,Bn);Bm.SelDBRoleID=Bn;if(Bo&&Bn){Bm.setDBRole&&Bm.setDBRole(Bn);}Y.forEach(Bm.dbrs,function(Bq){if(Bq.data.isPrimary){Bq.data.isPrimary=false;Bm.raiseEvent({name:A5.DBROLE_CHANGED,item:Bq});}if(Bq.did===Bn){Bq.data.isPrimary=true;Bm.raiseEvent({name:A5.DBROLE_CHANGED,item:Bq});}});if(Bo){Bm.raiseEvent({name:A5.DBTABLES_ENABLED,value:Bm.getAvailableTablesEnabled()});mstrApp.getRootController().enableButton();}return Bo;},setDBRole:function(Bn){var Bm=this;Bm.connectLiveSupport=undefined;mstrApp.getRootController().getDataService().setDBRole({success:function(Bo){mstrApp.msgid=Bo.msgid;Bm.loadConnectLiveSupport();}},{dbrid:Bn,tbid:this.tableID||""});},autoMap:function(Bo,Bn,Bq){var Bp=this;if(!Bp.FFSQLMode){if(Bp.getColumnsCount()===0){mstrmojo.alert(mstrmojo.desc(9945,"Please add at least one column and try again."));if(Bo&&Bo.failure){Bo.failure();}return ;}else{if(Bp.getTablesCount()===0){mstrmojo.alert(mstrmojo.desc(9946,"Please add at least one table and try again."));if(Bo&&Bo.failure){Bo.failure();}return ;}}}var Bm={success:function(Bs){Bp.isDirty=false;if(!Bn){var Br=Bs.datap,Bv=Br.maps,Bt=Br.data;if(Bp.FFSQLMode){var Bu=[];Bp.populateFFSQLMapping(Bv);Bp.populateDataset(Bt);}else{Bp.populatePreview(Bv,Bt);}g(Bp);}if(Bo&&Bo.success){Bo.success(Bs);}}};Bp.loadReport(Bd,BO,b+Al,Bq?H:AL,Bm);},convertToQueryBuilder:function x(Bm){var Bn=this;mstrApp.getRootController().getDataService().convertToQB({success:function Bo(Bp){mstrApp.msgid=Bp.msgid;mstrApp.isFFSQLMode=false;Bn.isDirty=true;Bn.FFSQLMode=false;Bn.mappings=Bn.cacheMP;Bn.dataset=Bn.cacheDS;g(Bn);Bm&&Bm.success&&Bm.success(Bp);}},{tbid:Bn.tableID||""});},convertToFFSQL:function AG(Bp,Bn,Bm){var Bo=this;Bo.SQLstmt=Bp;mstrApp.getRootController().getDataService().convertToFFSQL({success:function Bq(Br){mstrApp.msgid=Br.msgid;Bo.isDirty=true;Bo.FFSQLMode=true;mstrApp.isFFSQLMode=true;Bo.cacheMP=Bo.mappings;Bo.cacheDS=Bo.dataset;Bo.dataset=[];Bo.mappings=[];if(!Bm){g(Bo);}Bn&&Bn.success&&Bn.success(Br);}},{tbid:Bo.tableID||"",exp:P.encodeXMLAttribute(Bp)});},isMultiPassSQL:function Ab(Bm){return K(Bm).indexOf(At)>-1;},autoMapFFSQL:function Aa(Bn,Bp){var Bm=this;Bn=K(Bn);mstrApp.getRootController().getDataService().editFFSQL({success:function Bo(Bq){Bm.isDirty=Bm.isDirty||(P.trim(Bm.SQLstmt)===P.trim(Bn)?false:true);Bm.SQLstmt=Bn;Bm.isDDA=Bm.isDDA&&!Bm.isMultiPassSQL(Bn);if(Bn){Bm.autoMap(Bp);}else{Bm.dataset=[];Bm.mappings=[];g(Bm);Bp&&Bp.success&&Bp.success({msgid:mstrApp.msgid});}}},{exp:P.encodeXMLAttribute(Bn).replace(/\t/g,BS),tbid:Bm.tableID||""});},editFFSQL:function BW(Bn,Bo){var Bm=this;if(this.SQLstmt===Bo){if(Bn&&Bn.success){Bn.success();return ;}}Bo=K(Bo);mstrApp.getRootController().getDataService().editFFSQL({success:function Bp(Bq){mstrApp.msgid=Bq.msgid;Bm.isDirty=true;Bm.SQLstmt=Bo;Bn&&Bn.success&&Bn.success(Bq);}},{exp:P.encodeXMLAttribute(Bo).replace(/\t/g,BS),tbid:Bm.tableID||""});},updateSQL:function(Bm){this.getSQL(Bm);},getSQL:function e(Bn){var Bo=this;if((!Bo.SelDBRoleID&&Bo.riid===A6)||Bo.dbtables.length===0){var Bm="";if(Bn&&Bn.success){Bn.success(Bm);}}else{Bo.loadReport(A1,BO,null,null,{success:function Bp(Br){var Bs=Br.sqls[Br.sqls.length-1],Bq=Bs?Ag(Bs):"";if(Bn&&Bn.success){Bn.success(Bq);}}},true);}},isNameUnique:function(Br,Bn,Bo){var Bs=this,Bq=Bs.mappings;for(var Bp=0,Bm=Bq.length;Bp<Bm;Bp++){if(Bp!=Bn){if(Bo===Bq[Bp].alias&&Bq[Bn].tp==Bq[Bp].tp){return false;}}}return true;},mapAttribute:function(By,Bn,Bp,Bu,Bv,Bw){var Bo=this,Br=Bo.mappings;for(var Bq=0,Bt=Br.length;Bq<Bt;Bq++){if(Br[Bq].afid===(Bn+Bp)){if(Bv&&Bv.failure){Bv.failure(mstrmojo.desc(9926,"The attribute form you select has been mapped. Please choose a different one."));}return false;}}var Bs=Y.find(Br,"did",By),Bm=Br[Bs],Bx=function Bx(Bz){mstrApp.getRootController().getDataService().remapObject({success:function B0(B1){Bo.autoMap();if(Bv&&Bv.success){Bv.success(B1);}}},{mpcs:JSON.stringify(Bz),docid:mstrApp.docID||"",suppressError:true});};if(Bm.isIDForm&&Bm.multiForms&&!Bm.ipa){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:function(){var Bz=[];Y.forEach(Br,function(B0){if(B0.oid===Bw&&B0.did!==By){Bz.push({did:B0.did,aid:"",ot:BE});}});Bz.push({did:By,aid:Bn,fid:Bp});Bx(Bz);}}});}else{Bx([{did:By,aid:Bn,fid:Bp}]);}},unmap:function(Bq,Bp){var Br=this,Bs=Br.mappings,Bn=Y.find(Bs,"did",Bq),Bm=Bs[Bn],Bo=function Bo(Bt){mstrApp.getRootController().getDataService().remapObject({success:function Bu(Bv){Br.autoMap();}},{mpcs:JSON.stringify(Bt),docid:mstrApp.docID||"",suppressError:true});};if(Bm.isIDForm&&Bm.multiForms){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:function(){var Bt=[];Y.forEach(Bs,function(Bu){if(Bu.oid===Bp&&Bu.did!==Bq){Bt.push({did:Bu.did,aid:"",ot:BE});}});Bt.push({did:Bq,aid:"",ot:BE});Bo(Bt);}}});}else{Bo([{did:Bq,aid:"",ot:BE}]);}},remap:function S(Bn,Bm){mstrApp.getRootController().getDataService().changeMapping({success:function Bo(Bp){if(Bm&&Bm.success){Bm.success(Bp);}}},{tbid:this.tableID||"",mpcs:JSON.stringify([Bn]),docid:mstrApp.docID||""});},commitMapping:function(Bt){var Bn=this;var Bu=this.cloneMappings,Bv=this.mappings;var Bq,Br=[],Bm,Bo,Bw;for(var Bp=0,Bs=Bu.length;Bp<Bs;Bp++){Bo=Bu[Bp];Bw=Bv[Bp];Bq={};Bm=false;if(!Bw.selected){Br.push({did:Bw.did,cmf:0});}else{if(Bw.alias!=Bo.alias){Bq.alias=Bw.alias;Bm=true;}if(Bw.dtp!=Bo.dtp){Bq.bft=Bw.dtp;Bm=true;}if(Bw.tp!=Bo.tp){Bq.ot=Bw.tp;Bm=true;}if(Bm){Bq.did=Bw.did;Br.push(Bq);}}}if(Br.length>0){mstrApp.getRootController().getDataService().remapObject({success:function(Bx){if(Bt&&Bt.success){Bt.success(Bx);}}},{mpcs:JSON.stringify(Br),docid:mstrApp.docID||""});}else{if(Bt&&Bt.success){Bt.success();}}},validateExpr:function J(Bn,Bm){this.parseExpression(Bn.vo===1,1,Bn.cIndex,null,Bn.qbrex,Bn.expr,Bn.tKnStrm,Bm);},parseExpression:function AK(Bt,Bn,Bu,Bm,Bs,Bp,Br,Bq){var Bo={qbrex:Bs};Bo.qindex=Bn||1;Bo.tbid=this.tableID||"";if(Bm!=null){Bo.jindex=Bm;}if(Bp!=null){Bo.exp=Bp;}if(Br){Bo.tokenStrm=Br;}Bo.vo=1;mstrApp.getRootController().getDataService().parse({success:function(Bv){if(Bv&&Bv.mi&&Bv.mi.items){var Bw=Bv.mi.items;z(Bw);Bv.expr=C(Bw);}if(Bq&&Bq.success){Bq.success(Bv);}}},Bo);},canAddTable:function Ao(Bq){var Bp=this,Bn=Bp.SelDBRoleID,Bo=Bp.dbridForDDA,Bm;if(Bp.isDDA&&Bo&&Bn!==Bo){Bm={name:"directDataAccessTableError"};}if(Bm){if(!Bq){this.raiseEvent(Bm);}return false;}return true;},addTable:function V(By,Bz){var Br=this,Bq=By.tbn||By.did,Bw=Br.tbns,Bx,Bt=1,Bu=[],Bp,Bs=Br.SelDBRoleID,Bv;if(!this.canAddTable()){return ;}Bq=Bq.replace(/^[0-9]/,"L");Bx=Bq;while(Bw[Bx]){Bx=Bq+"_"+(Bt++);}Bq=Bx;Y.forEach(Bz,function(B0){Bp=B0.dt;Bu.push({cln:B0.cln,dtps:Bp.ps,dttp:Bp.tp,dtsc:Bp.sc});});var Bo={tbn:By.dbtn||By.tbn||By.did,clns:JSON.stringify(Bu),ns:By.ns,alias:Bq,tbid:Br.tableID||""},Bn=this.getMissingTableID(By.tbn,Bq,By.ns);if(Bn){Bo.stbid=Bn;}var Bm={success:function(B0){Bw[Bq]=Bq;Br.isDirty=true;mstrApp.msgid=B0.msgid;Br.raiseEvent({name:"TableAdded",data:Bz,table:{x:By.x,y:By.y,tbn:Bq,dbtbn:By.tbn||By.did,ns:By.ns,did:Bn}});if(Br.dbtables.length>1){Br.autoJoin();}Br.prevDBRoleID=Bs;if(!Br.isDDA){Bv=mstrApp.getRootController().getDDAController();Bv.tryEnableDDACheckbox(false);}}};mstrApp.getRootController().getDataService().addTable(Bm,Bo);},removeTable:function(Bn,Bp){var Br=this,Bo=this.gettIndex(Bn.id),Bq=Bn.Rows.children;var Bm={widget:Bn,success:function(B0){mstrApp.msgid=B0.msgid;Br.isDirty=true;var B4,B5,B8=this.widget.id;var B3=Br.tbns,B6=Br.tables[B8],Bv=B6.tbn,Bs=B6.dbtbn,B1=B6.ns;if(B3[Bv]){delete B3[Bv];}for(var Bu in Br.joinsInfo){var Bx=Br.joinsInfo[Bu].srctID,Bt=Br.joinsInfo[Bu].tgttID;if(B8==Bx||B8==Bt){B5=Br.joinsInfo[Bu].links;for(B4 in B5){BM(Br.joinCols,B5[B4].srcw.id,B5[B4].tgtw.id);}delete Br.joinsInfo[Bu];mstrmojo.array.removeItem(Br.joins,Bu);Br.tables[Bx].njoins--;Br.tables[Bt].njoins--;}if(Br.selLink&&Y.indexOf(Br.selLink[0],B8)>-1){Br.selLink=null;}}Br.upttIndex(Bv,Bs,B8,false,B6.did,B1);if(Br.dbtables.length===0&&Br.canAddTable(true)){Br.raiseEvent({name:A5.DBTABLES_ENABLED,value:true});mstrApp.getRootController().enableButton();}if(!Br.isDDA){ddaController=mstrApp.getRootController().getDDAController();ddaController.tryEnableDDACheckbox(true);}var Bz=Br.selectedClns,B7=[],By;Y.forEach(Bq,function(B9){Y.forEach(Bz,function(CB,CA){By=Y.indexOf(CB.wid,B9.id);if(By>-1){Y.removeIndices(CB.wid,By,1);if(Y.indexOf(B7,CA)==-1){B7.push(CA);}}});});B7.sort(mstrmojo.array.numSorter);for(var Bw=B7.length-1;Bw>-1;Bw--){Br.removeExpression(B7[Bw],true);}if(B7.length>0){g(Br);}Br.raiseEvent({name:"refreshTables",items:Br.dbtables.slice(0)});var B2=Br.conditions;Bv=Bv.toLowerCase();AA(B2.where,Bv)&&(delete B2.where);AA(B2.having,Bv)&&(delete B2.having);Br.updateFilterLabel(B2);if(Bp&&Bp.success){Bp.success();}}};mstrApp.getRootController().getDataService().removeTable(Bm,{tbid:Br.tableID||"",tindex:Bo});},getAvailableTablesEnabled:function An(){return(!mstrApp.isFFSQLMode)?this.canAddTable(true):this.canAddTableSQL(true);},addExpression:function A2(Bm,Bn){var Bs=C(this.selectedClns[Bm].expr);var Bq={did:Bm+Bs,alias:Bs,n:Bs,selected:false,hasMapped:false,isQB:!this.FFSQLMode,expr:this.selectedClns[Bm].expr,dtp:1,colo:Bm,ix:Bm,tp:0};this.mappings.push(Bq);var Bp=this.dataset.length;if(Bp>0){for(var Bo=0;Bo<Bp;Bo++){var Br=this.dataset[Bo];Br.push("");}}if(!Bn){mstrApp.getRootController().toggleDataPreview(true);g(this);}},removeExpression:function Bc(Bn,Bp){var Bm=this.selectedClns,Bq,Br=0,Bo;Y.forEach(Bm[Bn].wid,function(Bs){Bq=mstrmojo.all[Bs];Bq.count--;Bq.updateState(0);});Bm.splice(Bn,1);if(this.isRefined&&!mstrApp.isFFSQLMode){}else{Bo=this.mappings[Bn].ix;Y.forEach(this.mappings,function(Bs){if(Bs.ix>Bo){Br=Br?Math.min(Br,Bs.ix-Bo):Bs.ix-Bo;}});Y.forEach(this.mappings,function(Bs){if(Bs.ix>Bo){Bs.ix=Bs.ix-Br;Bs.colo=Bs.colo-1;}});Y.removeIndices(this.mappings,Bn,1);}Y.forEach(this.dataset,function(Bs){Y.removeIndices(Bs,Bn,1);});if(!Bp){g(this);}},editExpression:function(Bm){var Bo=this.selectedClns[Bm-1],Bn=Bo.wid;this.exprEditor(Bo,3,null,Bm);},updateExpression:function Bj(Bm){var Br=C(this.selectedClns[Bm].expr);var Bp=this.mappings[Bm];if(!Bp){return ;}Bp.did=Bm+Br;Bp.alias=Br;Bp.n=Br;Bp.expr=this.selectedClns[Bm].expr,Bp.selected=false;Bp.hasMapped=false;Bp.tp=0;var Bo=this.dataset.length;if(Bo>0){for(var Bn=0;Bn<Bo;Bn++){var Bq=this.dataset[Bn];Bq[Bm]="";}}g(this);},addSelectedColumns:function AS(Bn,Bq,Bp,Bw){var Bo=this,Bm,Bx,Bz=[],Bv,Bt,Bu,Bs=Bo.tables[Bo.dbtables[Bq-1]].existing;for(i=0;i<Bn.length;i++){Bv=Bn[i];Bu=Bv.dt;Bx={dt:Bu.tp,ps:Bu.ps,sc:Bu.sc,clix:Bv.rIndex+1,tblIdx:Bq};if(Bp!=null){Bx.findex=Bp;Bt=[AQ[Bp],"(",Bv.oriexpr,")"].join("");}else{Bt=Bv.expr[0].oi.n;}if(Bs){Bm=this.getMissingColumnID(Bt);if(Bm){Bx.cmid=Bm;}}Bz.push(Bx);}var By=JSON.stringify(Bz);var Br={success:function(B2){Bo.isDirty=true;mstrApp.msgid=B2.msgid;for(var B1=0,B0=Bn.length;B1<B0;B1++){Bo.addColumnIndex(Bn[B1],Bp,null,!Bs,Bz[B1].cmid,true);}mstrApp.getRootController().toggleDataPreview(true);g(Bo);if(Bw&&Bw.success){Bw.success(Bv);}}};mstrApp.getRootController().getDataService().addSelectedColumns(Br,{tbid:Bo.tableID||"",colArray:By});},addColumnWithExpression:function BZ(Bp,Bt,Bu,Bs){var Br=this,Bq=Bp.dt,Bo={dt:Bq.tp,ps:Bq.ps,sc:Bq.sc,tbid:Br.tableID||"",exp:Bt||""},Bn=Br.tables[Bp.srcID].existing;if(Bn){var Bm=this.getMissingColumnID(expr);if(Bm){Bo.cmid=Bm;}}mstrApp.getRootController().getDataService().addColumn({success:function(Bv){Br.isDirty=true;mstrApp.msgid=Bv.msgid;Bv.cIndex=Br.addColumnIndex(Bp,null,Bt,!Bn,Bm);mstrApp.getRootController().updateTableViewWithExpression(Bv.cIndex,Bu,true);if(Bs&&Bs.success){Bs.success();}}},Bo);},removeSelectedColumn:function(Bm,Bq){var Bo=this,Bn=Bo.mappings,Bp;if(this.isRefined&&!mstrApp.isFFSQLMode){Bp=Bo.selectedClns[Bm].ix+1;}else{Bp=Bn[Bm].ix+1;}mstrApp.getRootController().getDataService().removeColumn({success:function(Br){Bo.isDirty=true;mstrApp.msgid=Br.msgid;Bo.removeExpression(Bm);if(Bq&&Bq.success){Bq.success();}}},{cindex:Bp,tbid:Bo.tableID||""});},removeAllColumns:function AU(){var Bm=this,Bn=Bm.mappings;mstrApp.getRootController().getDataService().removeColumn({success:function(Bo){Bm.isDirty=true;mstrApp.msgid=Bo.msgid;Y.forEach(Bm.selectedClns,function(Bp){row=mstrmojo.all[Bp.wid[0]];row.count--;row.updateState(0);});Bm.selectedClns=[];Bm.mappings=[];g(Bm);}},{count:Bn.length,tbid:Bm.tableID||""});},editColumnExpression:function Af(Bm,Br,Bp,Bo){var Bn=this,Bq={cindex:Bn.mappings[Bm].ix+1,exp:Br||"",tbid:Bn.tableID||""};mstrApp.getRootController().getDataService().editColumn({success:function(Bs){Bn.isDirty=true;mstrApp.msgid=Bs.msgid;mstrApp.getRootController().updateTableViewWithExpression(Bm,Bp);if(Bo&&Bo.success){Bo.success();}}},Bq);},editExpr:function(Bm){var Bn=this.selectedClns[Bm-1];this.exprEditor(Bn,3,null,Bm);},getColDataType:function Ae(Bm){return parseInt(Bm.dt.tp,10);},addJoinColInfo:function A8(Bn,Bm){G(this.joinCols,Bn,Bm);},autoJoin:function BR(){var B1=this.dbtables.length,Bz,B2,B0,Bt=this.tables,Bw,Br,Bu,B3,Bo,Bx,Bn,Bs,Bp,Bm={},By,Bv,Bq;Bz=this.dbtables[B1-1];B0=Bt[Bz];B3=B0.rows;for(B2 in Bt){if(B2===Bz){continue;}Bw=Bt[B2].rows;Bq=Bz+B2;for(Bo in B3){Bs=B3[Bo];Bx=Bs.srcData;Bn=this.getColDataType(Bx);if(Bn===AN.columnDataTypes.integer||Bn===AN.columnDataTypes.unsigned||Bn===AN.columnDataTypes.int64||Bn==="INTEGER"){for(Br in Bw){Bp=Bw[Br];Bu=Bp.srcData;if(Bx.cln===Bu.cln&&Bn===this.getColDataType(Bu)&&!BC(this.joinCols,Bo,Br)){Bv=this.brackets(Bs.oriexpr)+"="+this.brackets(Bp.oriexpr);if(Bm[Bq]){Bm[Bq].jexp=Bm[Bq].jexp+" AND "+Bv;}else{Bm[Bq]={jexp:Bv,links:[]};}By={srcw:Bs,tgtw:Bp,jtype:0,jexp:Bv};Bm[Bq].links.push(By);G(this.joinCols,Bs.id,Bp.id);break;}}}}}if(!U.isEmpty(Bm)){this.addJoins(Bm);}},addJoin:function T(Bo,Bm,Bn,Bt,Bq){var Bp,Br,Bs={};Bp=Bo.srcID+Bm.srcID;Br={srcw:Bo,tgtw:Bm,jtype:Bn,jexp:this.brackets(Bo.oriexpr)+"="+this.brackets(Bm.oriexpr)};Bs[Bp]={links:[Br],jexp:Br.jexp};G(this.joinCols,Bo.id,Bm.id);this.addJoins(Bs,Bq);},addJoins:function n(Br,Bu){var Bq=this,Bs,Bo,Bw,Bp,Bv,Bn,Bt,Bm={success:function(Bx){Bq.isDirty=true;mstrApp.msgid=Bx.msgid;for(Bp in Br){Bv=Br[Bp].jexp;Bw=Br[Bp].links;Bq.joinsInfo[Bp]={jt:0,exp:Bv,links:{},nlinks:Bw.length};for(i=0;i<Bw.length;i++){Bo=Bw[i];Bn=Bo.srcw;Bt=Bo.tgtw;Bq.joinsInfo[Bp].links[Bn.id+Bt.id]={srcw:Bn,tgtw:Bt,coords:[],exp:Bo.jexp,jid:Bp};Bq.tables[Bn.srcID].njoins++;Bq.tables[Bt.srcID].njoins++;}Bq.joinsInfo[Bp].srctID=Bn.srcID;Bq.joinsInfo[Bp].tgttID=Bt.srcID;Bq.joins.push(Bp);}if(Bu&&Bu.success){Bu.success();}Bq.raiseEvent({name:"JoinsAdded"});}};Bs=JSON.stringify(Bi(Br,Bq));mstrApp.getRootController().getDataService().addJoin(Bm,{joins:Bs,tbid:Bq.tableID||""});},removeJoin:function(Bo,Bq){var Br=this;var Bp=Br.joinsInfo[Bo],Bs=Bp.srctID,Bn=Bp.tgttID;var Bm={success:function(Bt){Br.isDirty=true;mstrApp.msgid=Bt.msgid;Y.removeItem(Br.joins,Bo);delete Br.joinsInfo[Bo];Br.tables[Bs].njoins--;Br.tables[Bn].njoins--;if(Bq&&Bq.success){Bq.success();}}};mstrApp.getRootController().getDataService().removeJoin(Bm,{jindex:Br.getjIndex(Bo),tbid:Br.tableID||""});},editJoin:function r(Br){var Bt=this,Bp=Br.linkID,Bm=Br.joinID,Bu=Br.exp||"",Bn=Br.op,Bx=Br.type,By=Bt.joinsInfo[Bm].links,Bv=Bt.getjIndex(Bm),Bo="",Bq={jindex:Bv,jtype:Bx,tbid:Bt.tableID||""},Bs={success:function Bw(Bz){mstrApp.msgid=Bz.msgid;Bt.isDirty=true;Bt.joinsInfo[Bm].jt=Bx;if(Bu){By[Bp].op=Bn;By[Bp].exp=Bu;Bt.joinsInfo[Bm].exp=Bo;}Bt.raiseEvent({name:"joinChanged"});}};if(Bu){U.forEach(By,function(B0,Bz){Bo+=(Bo?" AND ":"")+((Bz!==Bp)?B0.exp:Bu);});Bq.exp=Bo;}mstrApp.getRootController().getDataService().editJoin(Bs,Bq);},renameTable:function BX(Bp,Bm,Bo){var Bn=this;mstrApp.getRootController().getDataService().editTable({success:function(Bq){mstrApp.msgid=Bq.msgid;delete Bn.tbns[Bm];Bn.tbns[Bo]=Bo;Bn.tables[Bp].tbn=Bo;U.forEach(Bn.conditions,function(Br){A4(Bm,Bo,Br);});Bn.raiseEvent({name:"TableNameChanged",value:Bo,tid:Bp});}},{tbid:Bn.tableID||"",tables:JSON.stringify([{alias:Bo,tindex:Bn.gettIndex(Bp)}])});},saveTableLayout:function BK(Bo){var Bn=[];for(var Bp in this.tables){var Bm=mstrmojo.all[Bp];if(Bm&&Bm.editorNode){Bn.push({tindex:this.gettIndex(Bp),t:parseInt(Bm.top,10)*BT,l:parseInt(Bm.left,10)*BT,w:Bm.editorNode.clientWidth*BT,h:Bm.editorNode.clientHeight*BT});}}mstrApp.getRootController().getDataService().editTable({success:function Bq(Br){mstrApp.msgid=Br.msgid;if(Bo&&Bo.success){Bo.success();}}},{tbid:this.tableID||"",tables:JSON.stringify(Bn)});},loadReport:function Ay(Bs,Bu,Bt,Bq,Br,Bm){var Bn=this;Bu=Bu||BO;var Bp={browsetype:Bs,bindingflag:Bu,suppressError:true,showWait:!Bm};if(Bt!=null){Bp.previewflag=Bt;}if(Bq!=null){Bp.automap=Bq;Bp.docid=mstrApp.docID||"";}Bp.tableID=Bn.tableID||"";var Bo={success:function(Bv){if(Bs&AD){if(Bv.btb){Bn.bindingT=Bv.btb.slice(0);}}if(Br&&Br.success){Br.success(Bv);}}};mstrApp.getRootController().getDataService().getReportDefinition(Bo,Bp);},loadConnectLiveSupport:function p(){var Bn=this,Bm,Bo={browsetype:BB,bindingflag:0,previewflag:0,tableID:Bn.tableID||"",showWait:false};Bn.connectLiveSupport=undefined;Bm={success:function(Bp){if(Bp.prs&&Bp.prs.dda!==undefined){Bn.connectLiveSupport=Bp.prs.dda;}}};mstrApp.getRootController().getDataService().getReportDefinition(Bm,Bo);},getcIndex:function Aw(Bm){return mstrmojo.array.indexOf(this.selectedClns,Bm)+1;},getRowWidget:function k(Bm,Bq){var Br=this.tables;Bq=Bq.toLowerCase();if(!Bm){for(var Bn in Br){var Bp=Br[Bn].rows;for(var Bo in Bp){if(Bp[Bo].text.toLowerCase()===Bq){return mstrmojo.all[Bo];}}}}else{Bm=Bm.toLowerCase();for(var Bn in Br){if(Br[Bn].tbn.toLowerCase()===Bm){var Bp=Br[Bn].rows;for(var Bo in Bp){if(Bp[Bo].text.toLowerCase()===Bq){return mstrmojo.all[Bo];}}}}}},uptcIndex:function Ai(Bn,Bm){while(Bm>this.selectedClns.length){this.selectedClns.push("");}this.selectedClns[Bm]=Bn;},getjIndex:function AZ(Bm){return mstrmojo.array.indexOf(this.joins,Bm)+1;},gettIndex:function O(Bm){return mstrmojo.array.indexOf(this.dbtables,Bm)+1;},upttIndex:function Bk(Bo,Bm,Bn,Bu,Bt,Br){var Bs=this.dbtables,Bq=this.tables,Bp=function Bp(By,Bw,Bv,Bx){return{rows:{},njoins:0,tbn:By,ns:Bw,alias:"",dbtbn:Bv,did:Bx};};if(Bu){Bq[Bn]=Bp(Bo,Br,Bm,Bt);Bs.push(Bn);}else{delete Bq[Bn];mstrmojo.array.removeItem(Bs,Bn);}},save:function(Bn,Bw,Bp,Bx,Bu,Bv,By){var Bs=this;var Bm={success:function(B1){var B0=B1.did;Bs.riid=B0;mstrApp.path=B1.path;mstrApp.reportID=B0;mstrApp.folderID=Bp;var Bz={success:function(B2){if(By&&By.success){By.success({did:B0,path:mstrApp.path});}},failure:function(B7){var B6=Bs.dbtables,B4,B3=Bs.pos_hash;for(var B5=0,B2=B6.length;B5<B2;B5++){B4=mstrmojo.all[B6[B5]];if(B4&&B4.editorNode){B3[B4.title]={t:parseInt(B4.top,10),l:parseInt(B4.left,10),w:B4.editorNode.clientWidth,h:B4.editorNode.clientHeight};}if(B4){B4.set("visible",false);B4.set("opener",null);}delete mstrmojo.all[B6[B5]];}var B9=mstrmojo.all.CE,B8;if(B9&&(B8=B9.CEl)){B8.filterExpr.set("items",[]);B8.aggfilterExpr.set("items",[]);}Bs.createReportInstance();}};mstrApp.getRootController().getDataService().publishCube(Bz,{reportid:B0});}};var Bo={success:function(){params={reportid:Bs.riid,folderID:Bp,isCube:Bs.isCubeReport,crb:Bs.refresh_opt,overwrite:!!Bx,autoName:!!Bu};if(Bn){params.name=Bn;}if(Bw){params.desc=Bw;}mstrApp.getRootController().getDataService().saveReport(Bm,params);}};var Bq={success:function(){Bs.updateDerivedFlags(Bo);}};var Br={success:function(){if(Bs.skipMissingCheck){Bq.success();return ;}var B2=[],B1=Bs.getMissingMaps(B2);if(B1){var B0=B2.length>0,Bz=mstrmojo.insert({scriptClass:"mstrmojo.qb.MissingColumnWarning",hasPT:B0,mappings:B0?B2:B1,isCube:Bs.isCubeReport,onOK:function(){Bq.success();return true;}});Bz.open();}else{Bq.success();}}};var Bt={success:function(){if(Bs.isDirty){Bs.autoMap(Br);}else{Br.success();}}};if(!Bs.FFSQLMode){Bs.saveTableLayout(Bt);}else{Bs.editFFSQL(Bt,Bv);}},populatePreview:function BJ(Bn,Bm){this.populateMappings(Bn);this.populateDataset(Bm);},populateMappings:function h(Bt){var Bu=Bt.amps,B1=Bt.mtmps,Bs=!mstrApp.isCloudPro&&(mstrApp.saveAsCube==2)&&(!this.isNew),B4=[];var B5=this.mappings.slice(0);this.mappings=[];this.cloneMappings=[];var Bw,Bv,Bp,Bm,B6,Bx=0,Bq,Bn,B3,B0,Br=function(B7){var B8=0;Y.forEach(B7,function(B9){if(!(B9.sqc.der&2147483648)){B8++;}});return B8;};for(var By=0,Bz=Bu.length;By<Bz;By++){Bv=Bu[By];Bp=Bv.aimp;Bn=Bp.ipa;Bm=Bv.afmps;Bx+=Bm.length;B0=Br(Bm);for(Bw=0,aflen=Bm.length;Bw<aflen;Bw++){B6=Bm[Bw].sqc;Bq=mstrmojo.array.find(B5,"did",B6.id);B3=(B6.der&2147483648)?true:false;B4.push({did:B6.id,alias:AI(Bp.atnm),n:AI(Bv.afmps[Bw].cln),selected:(B6.se==1),hasMapped:true,isReadOnly:Bs,isDI:this.isDI,isQB:!(this.FFSQLMode),dtp:Bm[Bw].bft,colo:Bm[Bw].colo-1,ix:B6.ix,tp:12,ipa:Bn,georole:(Bq>=0)?B5[Bq].georole:B6.geo,der:(Bq>=0)?B5[Bq].der:B6.der,oid:Bp.atid,fmid:Bm[Bw].fmid,afid:Bp.atid+Bm[Bw].fmid,fmn:AI(Bm[Bw].fmn),shapeKey:AI((Bq>=0)?B5[Bq].shapeKey:Bm[Bw].sha),toDel:(B6.ups&4)?true:false,isDerived:B3,multiForms:B0>1,isIDForm:Bw===0});}}for(var By=0,Bz=B1.length;By<Bz;By++){var Bo=B1[By],B6=Bo.sqc;B4.push({did:B6.id,alias:AI(Bo.mtn),n:AI(Bo.cln),selected:(B6.se==1),isReadOnly:Bs,hasMapped:true,isDI:this.isDI,isQB:!(this.FFSQLMode),dtp:Ak[B6.dt.tp],colo:Bo.colo-1,ix:B6.ix,tp:4,oid:Bo.mtid,georole:B6.geo,der:B6.der,toDel:(B6.ups&4)?true:false});}Y.forEach(Bt.cmps,function(B7){B6=B7.sqc;B4.push({did:B6.id,alias:AI(B6.exp.exp),n:AI(B6.exp.exp),selected:false,hasMapped:false,isQB:!this.FFSQLMode,expr:B6.exp.exp,dtp:Ak[B6.dt.tp],colo:B7.colo-1,ix:B6.ix,tp:0});});var B2;B4.sort(function(B8,B7){return(B8.ix<B7.ix)?-1:1;});for(var By=0,Bz=B4.length;By<Bz;By++){B2=B4[By];if(B2.toDel){this.selectedClns&&this.selectedClns[By]&&(this.selectedClns[By].missing=true);}else{if(B2.isDerived){this.selectedClns&&this.selectedClns[By]&&(this.selectedClns[By].isDerived=true);}else{this.mappings.push(B2);this.cloneMappings.push(U.copy(B2));}}}},populateDataset:function BN(Bm){var Bn;if(!(Bm instanceof Array)){Bm=Bm.dcs;if(!Bm||!Bm.length){this.dataset=[];return ;}}Bn=[];Y.forEach(Bm,function(Bo){Y.forEach(Bo.dvs,function(Bq,Bp){Bq=(Bq===null)?"":BU.encodeData(Bq);Bn[Bp]=Bn[Bp]||[];Bn[Bp].push(Bq);});});this.dataset=Bn;},populateFFSQLMapping:function Z(Bu){var Bv=Bu.amps,B2=Bu.mtmps;var Bn={};var B7=this.mappings.slice(0);this.mappings=[];this.cloneMappings=[];var Bx,Bw,Bq,B5,By=0,B3,Bm,B4,Bo,B6,B1,Bs=function Bs(B8){var B9=0;Y.forEach(B8,function(CA){if(!(CA.col.oi.def.dicl.der&2147483648)){B9++;}});return B9;};for(var Bz=0,B0=Bv.length;Bz<B0;Bz++){Bw=Bv[Bz];Bq=Bw.aimp;Bo=Bq.ipa;Bm=Bw.afmps;B1=Bs(Bm);for(Bx=0,B3=Bm.length;Bx<B3;Bx++){B5=Bm[Bx].col.oi;pos=mstrmojo.array.find(B7,"did",B5.did);if(B5.def.dicl.ups&4){break;}B6=(B5.def.dicl.der&2147483648)?true:false;By++;B4={did:B5.did,alias:AI(Bq.atnm),n:BU.encodeData(B5.def.cln),selected:true,hasMapped:true,dtp:Bm[Bx].bft,georole:(pos>=0)?B7[pos].georole:B5.def.dicl.geo,shapeKey:AI((pos>=0)?B7[pos].shapeKey:Bm[Bx].sha),oid:Bq.atid,fmid:Bm[Bx].fmid,afid:Bq.atid+Bm[Bx].fmid,fmn:AI(Bm[Bx].fmn),ipa:Bo,colo:Bm[Bx].colo-1,ix:B5.def.dicl.clix-1,tp:12,der:(pos>=0)?B7[pos].der:B5.def.dicl.der,isDerived:B6,multiForms:B1>1,isIDform:Bx===0};Bn[B4.ix]=B4;}}var Bt=Bv.length;for(var Bz=0,B0=B2.length;Bz<B0;Bz++){var Bp=B2[Bz],B5=Bp.col.oi;if(B5.def.dicl.ups&4){continue;}By++;var B4={did:B5.did,alias:AI(Bp.mtn),n:AI(B5.def.cln),selected:true,hasMapped:true,dtp:Ak[B5.def.dt.tp],colo:Bp.colo-1,ix:B5.def.dicl.clix-1,oid:Bp.mtid,tp:4,georole:B5.def.dicl.geo,der:B5.def.dicl.der};Bn[B4.ix]=B4;}var B4;var Br=[];U.forEach(Bn,function(B9,B8){Br.push(parseInt(B8,10));});Br.sort(function(B9,B8){return B9-B8;});for(var Bz=0;Bz<Br.length;Bz++){B4=Bn[Br[Bz]];if(B4&&!B4.isDerived){this.mappings.push(B4);this.cloneMappings.push(U.copy(B4));}}},updateDerivedFlags:function(Bp){var Bs=this.mappings;var Bn=[],Bq;for(var Bo=0,Bm=Bs.length;Bo<Bm;Bo++){if(Bs[Bo].hasMapped){Bn.push({did:Bs[Bo].did,georole:Bs[Bo].georole,shapekey:Bs[Bo].shapeKey,drvflgs:Bs[Bo].der});}}if(Bn.length===0){Bp&&Bp.success&&Bp.success();}else{mstrApp.getRootController().getDataService().remapObject({success:function Br(Bt){if(Bp&&Bp.success){Bp.success(Bt);}}},{mpcs:JSON.stringify(Bn),docid:mstrApp.docID||"",utm:1});}},getMissingMaps:function(B8){if(!this.orimaps){return null;}var Bx=[],B3,B2,B4,B5;var B6=this.orimaps;var Bp=this.mappings;var Bv=B6.amps,Bw=B6.mtmps;B6={};var Br,B1,Bn,By,B7,Bt,Bz,Bu=mstrApp.isFFSQL;for(B3=0,B4=Bv.length;B3<B4;B3++){B5=Bv[B3].aimp;Br=B5.atid;B1=AI(B5.atnm);B5=Bv[B3].afmps;for(B2=0;B2<B5.length;B2++){if(Bu){By=B5[B2].col.oi.def;if(By.dicl.der&2147483648){break;}Bt=By.cln;Bz=B5[B2].col.oi.did;}else{B7=B5[B2].sqc;if(B7.der&2147483648){break;}Bt=B7.exp.exp;Bz=B7.id;}B6[Br]=B6[Br]||{n:B1,oid:Br,tp:12,fms:[]};B6[Br].fms.push({fmid:B5[B2].fmid,fnm:AI(B5[B2].fmn),exp:AI(Bt),cmid:Bz});}}for(B3=0,B4=Bw.length;B3<B4;B3++){if(Bu){Bt=Bw[B3].col.oi.def.cln;Bz=Bw[B3].col.oi.did;}else{B7=Bw[B3].sqc;Bt=B7.exp.exp;Bz=B7.id;}B6[Bw[B3].mtid]={oid:Bw[B3].mtid,n:AI(Bw[B3].mtn),tp:4,exp:AI(Bt),cmid:Bz};}var B0=mstrmojo.hash.copy((this.pattrs||{}));var B4=Bp.length,Bm,Bo,Bq,Bs;for(B3=0;B3<B4;B3++){Bm=Bp[B3].oid;Bo=B6[Bm];if(Bo&&Bo.tp==Bp[B3].tp){Bq=Bo.fms;if(Bq){Bs=Y.find(Bq,"fmid",Bp[B3].fmid);if(Bs>-1){Y.removeIndices(Bq,Bs,1);}}else{delete B6[Bm];}}if(B0[Bm]&&B0[Bm].tp==Bp[B3].tp){delete B0[Bm];}}if(B8){for(Bm in B0){B5=B0[Bm];B8.push(B5);}}for(Bm in B6){B5=B6[Bm];if(B5.tp===12){if(B5.fms.length){Bx.push(B5);}}else{Bx.push(B5);}}return((Bx.length>0)?Bx:null);},getMissingColumnID:function(Bq){var Bn=this,Bm=Bn.getMissingMaps();if(!Bm){return null;}var Bp=null,Br,Bo=Bn.mappings;Y.forEach(Bm,function(Bs){Br=(Bs.tp===4)?[Bs]:Bs.fms;Y.forEach(Br,function(Bt){if(Y.find(Bo,"did",Bt.cmid)===-1&&Bn.isEquivalentExpr(Bt.exp,Bq)){Bp=Bt.cmid;return false;}});if(Bp){return false;}});if(Bp){Y.forEach(Bn.selectedClns,function(Bs){if(Bs.cmid===Bp&&!Bs.missing){Bp=null;return false;}});}return Bp;},getMissingTableID:function(Bm,Bo,Br){var Bt=this.orits;if(!Bt){return null;}var Bs=this.dbtables,Bq=this.tables,Bu;for(var Bn=0,Bp=Bs.length;Bn<Bp;Bn++){Bu=Bq[Bs[Bn]];if(Bu.existing&&Bu.missing&&Bu.tbn===Bo&&Bu.dbtbn===Bm&&Bu.ns===Br){return(!Bu.did?null:Bu.did);}}return null;},getTablesCount:function(){var Bp=this.tables,Bq=this.dbtables,Bo=0;for(var Bn=0,Bm=Bq.length;Bn<Bm;Bn++){!Bp[Bq[Bn]].missing&&(Bo++);}return Bo;},getColumnsCount:function(){var Bn=this.selectedClns,Bp=0;for(var Bo=0,Bm=Bn.length;Bo<Bm;Bo++){!Bn[Bo].missing&&(Bp++);}return Bp;},addColumnIndex:function(Bz,Bq,Bw,Bm,Bo,Bu){var Bt=this.selectedClns,Bx=this.gettIndex(Bz.parent.parent.id),Bp,Bv,By,Bs=Bt.length,Br,Bn;if(!!Bw){Bp=Bw;}else{if(Bq){Bp=AQ[Bq]+"("+(Bz.oriexpr)+")";}else{Bp=this.brackets(Bz.oriexpr);}}if(!Bm){for(Br=0;Br<Bs;Br++){Bn=Bt[Br];if(Bn.missing&&Bn.expr&&this.isEquivalentExpr(Bn.expr[0].v,Bp)){Bn.missing=false;Bn.wid=[Bz.id];Bn.cmid=Bo;By=true;break;}}Bv=Br;}else{Bv=Bs;}if(!By){if(Bq){if(Bq===6){Bt.push({wid:[Bz.id],expr:[{isNew:true,v:"Count",oi:{t:"11",n:"Count"}},{isNew:true,v:"<Distinct=true>",oi:{t:"11",n:"<Distinct=true>"}},{isNew:true,v:"(",isDelimiter:true},{isNew:true,v:this.brackets(Bz.oriexpr),oi:{tIndex:Bx,rIndex:Bz.rIndex,t:"26",n:Bz.oriexpr}},{isNew:true,v:")",isDelimiter:true}]});}else{Bt.push({wid:[Bz.id],expr:[{isNew:true,v:AQ[Bq],oi:{t:"11",n:AQ[Bq]}},{isNew:true,v:"(",isDelimiter:true},{isNew:true,v:this.brackets(Bz.oriexpr),oi:{tIndex:Bx,rIndex:Bz.rIndex,t:"26",n:Bz.oriexpr}},{isNew:true,v:")",isDelimiter:true}]});}}else{Bt.push({wid:[Bz.id],expr:[{isNew:true,v:Bp,oi:{tIndex:Bx,rIndex:Bz.rIndex,t:"26",n:Bz.oriexpr}}]});}}this.addExpression(Bv,Bu);return Bv;},compareDBTables:function(Bo){var Bn=this;if(Bn.dbtables.length===0){return ;}var Bm={success:function(Bs){var Bp=Bs.btb,Bq=[],Bu,Bt;Y.forEach(Bp,function(Bv){Bu=Bv.oi;Bt=Bu.def;(Bu.tp===53&&Bt.xt===1)&&Bq.push({tbid:Bu.did,tbn:AI(Bt.tbn),ns:AI(Bt.ns)});});if(Bq.length==0){return ;}Bn.whts=Bq;mstrApp.getRootController().getDataService().catalogAction({success:function Br(Bv){var Bw=Bv.xrc.cas[0];Bn.whdef=Bw.tis?Bw.tis:[Bw];Bo&&Bo.success&&Bo.success();}},{dbrid:Bn.SelDBRoleID,flags:1073741824|2|524288,mid:mstrApp.msgid,dbts:JSON.stringify(Bq),showWait:true});}};Bn.loadReport(AD+Bd,BO,b,null,Bm);},updateDBTables:function(Bw){var Bo=this,By,Bs,Bn=[],Bp,Bm,Bu,Bt,Br,Bv,Bx;for(Bt=0,Bv=Bo.whdef.length;Bt<Bv;Bt++){By=Bo.whdef[Bt];if(By.sta!=0){Bp={ns:By.ns,sta:By.sta,tbid:By.tbid,tbn:AI(By.tbn),clis:[]};Bu=Bp.clis;Bm=By.clis;for(Br=0;Br<Bm.length;Br++){Bx=Bm[Br];Bu.push({cln:AI(Bx.cln),cmid:Bx.cmid,sta:Bx.sta,prec:Bx.dt.prec,scl:Bx.dt.scl,tp:Bx.dt.tp});}Bn.push(Bp);}}if(Bn.length==0){return ;}var Bq={success:function(B0){mstrApp.msgid=B0.msgid;var Bz={success:function(B4){var B9=Bo.dbtables,B8,B3=Bo.pos_hash,B7;for(var B1=0,B2=B9.length;B1<B2;B1++){B8=mstrmojo.all[B9[B1]];if(B8&&B8.editorNode){B3[B8.title]={t:parseInt(B8.top,10),l:parseInt(B8.left,10),w:B8.editorNode.clientWidth,h:B8.editorNode.clientHeight};}B8.set("visible",false);B8.set("opener",null);delete mstrmojo.all[B9[B1]];}var B6=mstrmojo.all.CE,B5;if(B6&&(B5=B6.CEl)){B5.filterExpr.set("items",[]);B5.aggfilterExpr.set("items",[]);}Bo.isDirty=true;if(Bo.loadDefinition){B7=Bo.firstTimeLoading;Bo.loadDefinition(B4);if(!B7){g(Bo);}}else{As(B4,Bo);}}};Bo.loadReport(AD+Bd,BO,b,null,Bz);}};mstrApp.getRootController().getDataService().updateTableStructure(Bq,{tables:JSON.stringify(Bn),tbid:Bo.tableID||""});},isColumnUsed:function(Bu,Bs){var Bo=Bu.tbn,Bn=Bs.cln,Bp,Bq,Bv;var Br=this.tables;for(var Bm in Br){if(Br[Bm].dbtbn===Bo){Bv=Br[Bm].rows;for(var Bt in Bv){if((Bv[Bt].text===Bn)&&(Bv[Bt].state!=0)){return true;}}}}return false;},hasMissingUsedDBColumns:function(){var Bp=this.whdef,Bt,Bs,Br,Bm,Bo,Bn,Bq;for(Bs=0,Bm=Bp.length;Bs<Bm;Bs++){Bt=Bp[Bs];switch(parseInt(Bt.sta,10)){case 0:case 64:break;default:Bq=Bt.clis;for(Br=0,Bo=Bq.length;Br<Bo;Br++){Bn=Bq[Br];if(parseInt(Bn.sta,10)===4){if(this.isColumnUsed(Bt,Bn)){return true;}}}break;}if(Bt.sta==4){Bq=Bt.clis;for(Br=0,Bo=Bq.length;Br<Bo;Br++){Bn=Bq[Br];if(this.isColumnUsed(Bt,Bn)){return true;}}}}return false;},getShapeKeys:function(){var Bn=this;var Bm={success:function(Br){if(Br&&Br.ShapeFileMaps&&Br.ShapeFileMaps.ShapeFileMap){var Bs=Br.ShapeFileMaps.ShapeFileMap,Bp=[],Bt,Bq,Bo=function Bo(Bw,Bv){var Bu=Bw.n.toLowerCase();var Bx=Bv.n.toLowerCase();if(Bu<Bx){return -1;}else{if(Bu>Bx){return 1;}else{return 0;}}};Y.forEach(Bs,function(Bu){Bt=Bu.descWeb;Bq=Bt?mstrmojo.desc(Bt.slice(8)):AI(Bu.name);Bp.push({did:Bu.shapeKey,n:Bq});});Bp.sort(Bo);Bn.shapeKeys=Bp;}}};mstrApp.getRootController().getDataService().getShapeKeys(Bm,{});},createEmmaTable:function A7(){var Bq=mstrApp.getRootController().getDataService(),Bo=this,Bn=mstrApp.isFFSQL,Bm=(Bn?304:352),Br=function Br(Bs){Bq.createEmmaTable({success:function Bt(Bu){Bo.tableID=Bu.tbid;mstrApp.msgid=Bu.msgid;}},{xt:Bs});};mstrApp.msgid=mstrApp.msgID;if(mstrApp.msgid){Br(Bm);}else{Bq.createEmmaInstance({success:function Bp(Bs){mstrApp.msgid=Bs.msgid;Br(Bm);}});}if(mstrApp.isFFSQL){Bo.set("isFFSQL",true);Bo.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},createReportInstance:function BY(){var Bp=this,Bo=mstrApp.isCloudPro;Bp.msgid=mstrApp.msgid;Bp.riid=mstrApp.reportID||A6;Bp.supportTimeGeo=true;Bp.analysisID=mstrApp.analysisID;Bp.isNew=(Bp.riid==A6);Bp.alertTitle=Bo?"Oops!":null;if(mstrApp.isEMMACube){this.createEmmaTable();return ;}var Bn={success:function Bm(Bq){Bp.msgid=Bq.msgid;mstrApp.msgid=Bq.msgid;if(Bp.riid!==A6){Bp.firstTimeLoading=true;var Br={success:function Bs(Bu){var Bt;if(Bu&&(Bt=Bu.items)&&Bt.length){Bp.pattrs={};Y.forEach(Bt,function(Bv){Bv.ismapped&&(Bp.pattrs[Bv.did]={n:Bv.n,tp:12});});}Bp.loadReport(AD+Bd,BO,b,null,{success:function(Bv){As(Bv,Bp);if(Bo){mstrApp.getRootController().getDataService().autoClosePrompt({success:function Bw(Bx){mstrApp.msgid=Bx.msgid;}});}}});}};if(Bo&&mstrApp.analysisID&&mstrApp.saveAsCube!=2){mstrApp.getRootController().getDataService().getDocumentAttributes(Br,{objectID:mstrApp.analysisID});}else{Br.success();}}else{Bp.skipMissingCheck=true;if(mstrApp.isFFSQL){Bp.set("isFFSQL",true);Bp.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;Bp.convertToFFSQL("",null,true);}}Bp.set("isCloud",Bo);Bp.set("isCubeReport",mstrApp.saveAsCube!=2);}};mstrApp.getRootController().getDataService().createReportInstance(Bn,{reportid:Bp.riid});if(!mstrApp.isCloudPro){Bp.getShapeKeys();}Bp.getFunctions();},getAllowSave:function u(Bo){var Bn,Bm=mstrApp.isFFSQLMode;if(Bm&&Bo===undefined){Bo=mstrApp.getRootController().rootView.getSQLStatement();}if(this.isNew){Bn=Bm?(!!P.trim(Bo)):(this.dbtables.length>0&&this.selectedClns.length>0);Bn=Bn&&(!!this.SelDBRoleID);}else{Bn=Bm?(!!P.trim(Bo)):true;}Bn=Bn&&this.getAvailableTablesEnabled();return Bn;},getAutoReportName:function Ax(){var Bm=this.tbns,Bn=[];U.forEach(Bm,function(Bp,Bo){Bn.push(Bo);});Bn=Bn.join("_");if(Bn==""){Bn="FFSQL";}return Bn.substring(0,252);},getFunctions:function Ar(Bp,Bo,Bn){var Bm=this;if(!this.functions){mstrApp.getRootController().getDataService().getSystemFunctions({success:function(Bq){Bm.functions=D(Bq.fncs,Bp);if(Bo&&Bo.success){Bo.success();}}},U.copy(Bn,{includeFunctionDetails:false,functionFlags:2}));}},getFunctionList:function Ba(){return this.functions;},getSuggestionItems:function AF(Bo){var Bm=[],Bp;if(Bo){var Bn=this.dbtbls[this.SelDBRoleID];U.forEach(Bn,function(Bq,Br){Bm.push({n:Br,sta:2,t:15});});}else{U.forEach(this.tables,function(Bq){U.forEach(Bq.rows,function(Br){Bp=Br.oriexpr;Bm.push({n:Bp,cmid:Br.srcData.id,rIndex:Br.rIndex+1,t:26,display:['<span class="mstrmojo-qb-ListIconBlock t26 "></span><span>',Bp,"</span>"].join("")});});});}Y.forEach(this.functions,function(Bq){Y.forEach(Bq.fns,function(Br){Bm.push(Br);});});if(Bo){this.FFsqlComp=Bm;}return Bm;},getConditions:function AM(){return this.conditions;},setCondition:function AC(Bn,Bq,Bo){var Bm=this;mstrApp.getRootController().getDataService().editCondition({success:function Bp(Br){mstrApp.msgid=Br.msgid;Bm.isDirty=true;if(Bo&&Bo.success){Bo.success(Br);}}},{tbid:Bm.tableID||"",clause:Bn?"where":"having",exp:Bq});},updateConditions:function d(Bq,Bs){var Bn=this,Br=this.conditions,Bp={success:function Bo(Bu){Br.having=Bs;Bn.updateFilterLabel(Br);}},Bm=function Bm(Bu){Br.where=Bq;if(Bs){Bn.setCondition(false,Am(Bs),Bp);}else{if(Br.having){Bn.setCondition(false,"",Bp);}else{Bp.success();}}},Bt={success:Bm};if(Bq){this.setCondition(true,Am(Bq),Bt);}else{if(Br.where){this.setCondition(true,"",Bt);}else{Bm();}}},appendCondition:function A0(Bn){var Bo=this.conditions,Bm=Bn.sqltp===0;condition=Bm?Bo.where:Bo.having;if(!condition){condition=Bn;}else{if(condition.nds){condition.nds.push(Bn);}else{condition={et:BF.ANDOR,fn:W.FN.AND,nds:[U.copy(condition),Bn]};}}Bo[Bm?"where":"having"]=condition;this.setCondition(Bm,Am(condition),null);this.updateFilterLabel(Bo);},canAddTableSQL:function N(Bq,Bp){var Bo=this,Bn=Bo.SelDBRoleID,Bm;dbridForDDA=this.dbridForDDA;if(Bo.isDDA&&dbridForDDA&&Bn!==dbridForDDA){Bm={name:"directDataAccessTableError"};}if(Bm){if(!Bq){this.raiseEvent(Bm);}return false;}return true;},addTableSQL:function Az(Bn,Bm){j.call(this,Bn.ns,Bn.n,Bm);this.prevDBRoleID=this.SelDBRoleID;},updateFilterLabel:function AW(Bt){var Bn={},Bo=this.tables,Bp,Bs,Bq,Bm,Br;U.forEach(Bt,function(Bu){I(Bn,Bu);});U.forEach(Bo,function(Bu){Bs=Bu.rows;Bp=Bu.tbn.toLowerCase();Bm=Bn[Bp];U.forEach(Bs,function(Bv){Br=Bv.state;Br=(Bm&&Bm[Bv.text.toLowerCase()])?(Br|2):(Br&(~2));if(Bv.state!==Br){Bv.state=Br;Bv.images[1]=Bv.img[Br];Bv.render();}});});},submitRequest:function Ad(Bo,Bn,Bm){AP(Bo,Bn,Bm);},onisDDAChange:function AY(Bm){var Bn=this;mstrApp.getRootController().getDDAController().checkDDACheckbox(Bm.value);Bn.raiseEvent({name:A5.DBTABLES_ENABLED,value:Bn.getAvailableTablesEnabled()});mstrApp.getRootController().enableButton();}});})();(function(){mstrmojo.requiresCls("mstrmojo.qb._hasQBModel");mstrmojo.qb.QBuilderModel=mstrmojo.declare(mstrmojo.warehouse.WHModel,[mstrmojo.qb._hasQBModel],{scriptClass:"mstrmojo.qb.QBuilderModel"});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.qb._hasQBModel","mstrmojo.warehouse.WHModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(14098,9945,9946);var a=1,e=4,c=15,D=1,p=2,H=4,q=2048,g=mstrmojo.string.decodeHtmlString,P=mstrmojo.hash,h=mstrmojo.array,X=mstrmojo.DI.DIConstants,K=4000,T=15,S=200,L=200,o=0,f=0,m=mstrmojo.desc(14098,"There is no project ## in ###.");var I=mstrmojo.desc;function Z(r){return r.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function U(r){return g(r).replace(/&apos;/g,"'");}function V(r){r.raiseEvent({name:"dataPreview",mappings:r.mappings,dataset:r.dataset,selectedColumns:r.selectedClns,isRefined:r.isRefined});}function n(z){var w=z.datap,AB=w.maps,x=w.srce,AA=x.csl,r=mstrApp.getRootController(),t=this,u=x.gbqp;if(this.firstTimeLoading){this.orimaps=AB;}t.usingCookieNamespace=true;if(x.xt===304){t.prevDBRoleID=x.dbrid;r.selectDBRole(x.dbrid);}else{r.selectDBRole(u);if(t.getProject(u)===null){mstrmojo.alert(m.replace("##",u).replace("###",mstrApp.userEmail));}}AA=Z(AA);this.SQLstmt=AA;mstrApp.getRootController().raiseEvent({name:"reportModeChange",mode:2,value:AA,keepFormat:true});this.populateFFSQLMapping(AB);if(this.firstTimeLoading){V(this);this.firstTimeLoading=false;}}function W(r,t){var u=r.chn;if(!u){if(r.col&&r.stbid){t.push({cid:r.col,tid:r.stbid});}return t;}h.forEach(u,function(w){t=W(w,t);});return t;}function F(r){return r.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function d(t){var r={">=":2,"<>":5,"<=":4,"<":3,">":1},u;for(u in r){if(t.indexOf(u)>-1){return r[u];}}return 0;}function E(r,t){var u=[],w;h.forEach(t,function(x){w=r.uiids[x.tid+x.cid];if(w){u.push(w);}});return u;}function J(w,z,r){if(!z.ftype){r.push({lcid:w.chn[0].col,rcid:w.chn[1].col,exp:z.exp});return z.exp;}var x,u,t;switch(z.ftype){case 19:case 20:x=J(w.chn[0],z.children[0],r);u=J(w.chn[1],z.children[1],r);t=x+((z.ftype===19)?" AND ":" OR ")+u;break;case 21:t=" NOT "+J(w.chn[0],z.children[0],r);break;default:break;}return t;}function G(x,u,z,r,AD,AB){if(!u.ftype){var t=F(u.exp);if(t.indexOf("? aptqbr_prompt")>-1){AB.push({n:t,cid:r.chn[0].cmid});return ;}var AE=E(x,W(r,[])),AA,AC=[];h.forEach(AE,function(AF){AA=mstrmojo.all[AF];if(AA&&AA.updateState){AA.updateState(2);}AC.push({t:AA.srcTable,col:AA.text});});return z.push({et:"*",n:t,expr:[{v:t}],sqltp:AD,cols:AC});}switch(u.ftype){case 19:case 20:case 21:var w=[];h.forEach(u.children,function(AG,AF){G(x,AG,w,r.chn[AF],AD,AB);});if(!w.length){return ;}if(w.length<u.children.length&&w.length===1){z.push(w[0]);}else{z.push({et:14,fn:u.ftype,nds:w,not:(u.ftype===21),sqltp:AD});}break;default:break;}}function O(Av){var AP=Av.datap||[],Am=AP.maps,x=this,AS,AM,Au=mstrApp.getRootController();if(x.firstTimeLoading){x.orimaps=Am;}var AU,AR,Aw={},u={},An,t=true,Ac={53:function AN(Az){if(Az.ext_type===352||Az.ext_type===341){AU=Az.def.sqs.c_c[0];AR=Az.def.dbr.did;AS=Az.ext_type;AM=Az.def.sqs.big;}else{Aw[Az.did]={cs:Az.def.cs.cs,tbn:U(Az.def.tbn),did:Az.did,ns:Az.def.ns};if(An===undefined){An=Az.def.ns;}t=t&&(An===Az.def.ns);if(Az.ext_type===288){Aw[Az.did].alias=U(Az.n);}}},26:function Ap(Az){u[Az.did]={did:Az.did,cln:U(Az.def.cln),dt:Az.def.dt};}};h.forEach(Av.btb,function(Az){Az=Az.oi;if(Ac[Az.tp]){Ac[Az.tp](Az);}});x.usingCookieNamespace=true;if(AS===341){Au.selectDBRole(AM);if(x.getProject(AM)===null){mstrmojo.alert(m.replace("##",AM).replace("###",mstrApp.userEmail));}}else{Au.selectDBRole(AR);}x.prevDBRoleID=AR;if(!AU){return ;}var Ad=AU.sqcs.c_c,AH=AU.whe,Aj=AU.w_cond,Ay=AU.he,AB=AU.h_cond;x.selectedClns=[];x.dbtables=[];x.joins=[];x.joinsInfo={};x.uiids={};x.tables={};var As=x.selectedClns,Ai={},AQ,Ar,Ax,AG,AL;h.forEach(Ad,function(Az){if(!(Az.der&2147483648)){AQ=W(Az.exp.roo,[]);Ax=U(Az.exp.exp);Ar=[];h.forEach(AQ,function(A0){AG=A0.cid;AL=A0.tid;Ai[AL]=Ai[AL]||{};Ai[AL][AG]=Ai[AL][AG]||{};Ai[AL][AG].state=1;Ai[AL][AG].count=!Ai[AL][AG].count?1:Ai[AL][AG].count+1;Ar.push(AL+AG);});As.push({wid:Ar,expr:[{v:Ax}],existing:true,ix:Az.ix});}});x.tbns={};var AJ=x.pos_hash,AE=x.tbns,At=[],AC,z,Ae,Al,Ao,w,AZ;h.forEach(AU.stbs.c_c,function(A0,Az){AZ={};AL=A0.id;AC=A0.dbt.did;Ao=A0.als?U(A0.als):(Aw[AC].alias||Aw[AC].tbn);Ae=Aw[AC].cs;if(AJ&&AJ[Ao]){AZ.pos={w:AJ[Ao].w||L,h:AJ[Ao].h||S,t:AJ[Ao].t||o,l:AJ[Ao].l||f};}else{z=A0.sqltf;if(z&&z.length){AZ.pos={w:(z[0]&&z[0].pdv)/T||L,h:(z[1]&&z[1].pdv)/T||S,t:(z[2]&&z[2].pdv)/T||o,l:(z[3]&&z[3].pdv)/T||f};}}Al=[];h.forEach(Ae,function(A1){AG=A1.did;w=P.copy(u[AG]);if(Ai[AL]&&Ai[AL][AG]){w.state=1;w.count=Ai[AL][AG].count;}Al.push(w);});AZ.did=AL;AZ.cs=Al;AZ.tbn=Ao;AZ.ns=Aw[AC].ns;AZ.dbtbn=Aw[AC].tbn;At[Az]=AZ;AE[Ao]=Ao;});if(x.firstTimeLoading&&!x.isNew){x.orits=x.orits||At.slice(0);}var AO=x.orits;h.forEach(At,function(Az){if(h.find(AO,"did",Az.did)>-1){Az.existing=true;Az.readOnly=mstrApp.isCloudPro;}});x.raiseEvent({name:"BindingTableLoaded",value:At});h.forEach(As,function(Az){Ar=Az.wid;h.forEach(Ar,function(A1,A0){Ar[A0]=x.uiids[A1];});});if(Am){x.populateMappings(Am);}if(AP.data){x.populateDataset(AP.data);}if(this.firstTimeLoading){V(x);}var AF,Ak,Ah,AA,Aq,AV,Aa,AK,AY,Af,r,AD,AI,AX;h.forEach(AU.sjs.c_c,function(Az){AF=Az.ltid;Ah=Az.rtid;Aa=Az.jt;AK=Az.ix;AY=Az.cdn.roo;AI=[];AD=x.uiids[AF]+x.uiids[Ah];x.joins.push(AD);AX={jt:Aa+"",exp:U(J(AY,Az.exp_bo,AI)),srctID:x.uiids[AF],tgttID:x.uiids[Ah],links:{}};Ak=x.tables[x.uiids[AF]];AA=x.tables[x.uiids[Ah]];Ak.njoins=(Ak.njoins||0)+1;AA.njoins=(AA.njoins||0)+1;h.forEach(AI,function(A0){Af=A0.lcid;r=A0.rcid;Ax=U(A0.exp);Aq=x.uiids[AF+Af];AV=x.uiids[Ah+r];AX.links[Aq+AV]={srcw:mstrmojo.all[Aq],tgtw:mstrmojo.all[AV],coords:[],exp:Ax,jid:AD,op:d(Ax)};AX.nlinks=(AX.nlinks||0)+1;x.addJoinColInfo(Aq,AV);});x.joinsInfo[AD]=AX;});x.raiseEvent({name:"JoinsLoaded"});var AT=[],Ab=[];if(AH.exp!==""){G(x,Aj,AT,AH.roo,0,Ab);if(AT.length){x.conditions.where=AT[0];}if(Ab.length&&!x.isCubeReport){x.pattrs={};var AW=Am.amps,Ag;h.forEach(AW,function(Az){if(h.find(Ab,"cid",Az.afmps[0].sqc.id)>=0){Ag=Az.aimp;x.pattrs[Ag.atid]={n:Ag.atnm,tp:12};}});}}if(Ay.exp!==""){AT=[];G(x,AB,AT,Ay.roo,1);if(AT.length){x.conditions.having=AT[0];}}x.firstTimeLoading=false;}function C(t){var r=this;if(!r.FFSQLMode){if(r.getColumnsCount()===0){mstrmojo.alert(mstrmojo.desc(9945,"Please add at least one column and try again."));if(t&&t.failure){t.failure();}return false;}if(r.getTablesCount()===0){mstrmojo.alert(mstrmojo.desc(9946,"Please add at least one table and try again."));if(t&&t.failure){t.failure();}return false;}}return true;}mstrmojo.qb.EmmaModel=mstrmojo.declare(mstrmojo.warehouse.WHModel,[mstrmojo.qb._hasQBModel],{scriptClass:"mstrmojo.qb.EmmaModel",originalMsgID:undefined,dbRolesVersionExcludeFilter:[223],isDataImport:true,init:function l(r){if(this._super){this._super(r);}if(r.dbIds){this.dbRoleEditorCfg.dbIdFilter=r.dbIds;}if(r.dbTypes!==undefined){this.specifyDBTypes=true;this.dbRolesTypeFilter=r.dbTypes;this.dbmsTypeFilter=this.dbRolesTypeFilter;}if(r.dbVersions){this.dbRolesVersionFilter=r.dbVersions;this.dbmsVersionFilter=r.dbVersions;}if(r.dbObjects!==undefined){this.dbObjects=r.dbObjects;}if(r.isHadoopQB){this.dbObjectsDisplayOptions=16;this.specifyDBTypes=true;this.dbRolesTypeFilter=X.hadoopDbTypes.slice(0);this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);this.dbRolesVersionExcludeFilter=X.ibmDb2Versions.concat(this.dbRolesVersionExcludeFilter?this.dbRolesVersionExcludeFilter:[]);}this.dbRoleEditorCfg.dbIdExcludeFilter=!mstrApp.isFFSQL?[41,15]:[41];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=!mstrApp.isFFSQL?[3000]:[];},dbRoleEditorCfg:{dbIdExcludeFilter:[41]},createReportInstance:function Q(u,t){var x=this,r=x.isNew=!mstrApp.tableID;x.supportTimeGeo=true;x.analysisID=mstrApp.analysisID;x.tableID=mstrApp.tableID;var AA=mstrApp.getRootController().getDataService(),w=mstrApp.isFFSQL,AB=function AB(AD,AC){AA.createEmmaTable({success:function AE(AF){x.tableID=AF.tbid;mstrApp.msgid=AF.msgid;}},{xt:AD,dict:AC});};mstrApp.msgid=mstrApp.msgID;if(r){if(mstrApp.msgid){x.originalMsgID=mstrApp.msgid;AA.removeOrDuplicateRI({success:function(AC){mstrApp.msgid=AC.msgid;AB(u,t);}},{messageID:mstrApp.msgid});}else{AA.createEmmaInstance({success:function z(AC){mstrApp.msgid=AC.msgid;AB(u,t);}});}}else{x.originalMsgID=mstrApp.msgid;AA.removeOrDuplicateRI({success:function(AC){mstrApp.msgid=AC.msgid;x.firstTimeLoading=true;var AD=e;AD=AD+(w?0:a);x.loadReport(AD,c,D+H,null,{success:function AE(AF){if(w){n.call(x,AF);}else{O.call(x,AF);}if(mstrApp.isCloud){mstrApp.getRootController().getDataService().autoClosePrompt({success:function AG(AH){mstrApp.msgid=AH.msgid;}});}}});}},{messageID:mstrApp.msgid});}if(mstrApp.isFFSQL){x.set("isFFSQL",true);x.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},loadDefinition:function B(r){O.call(this,r);},remap:function j(t,r){mstrApp.getRootController().getDataService().changeMapping({success:function u(w){if(r&&r.success){r.success(w);}}},{tbid:this.tableID,mpcs:JSON.stringify([t]),docid:mstrApp.docID||""});},loadEmmaReport:function M(u,r,AB,x){var t=this,AA=!x?e:a+e,w=D+p;if(!C.call(t,u)){return ;}if(t.isRefined&&!mstrApp.isFFSQLMode){w=D+q;}t.loadReport(AA,c,w,null,{success:function z(AD){t.isDirty=false;if(!r){var AC=AD.datap,AF=AC.maps,AE=AC.data;if(t.FFSQLMode){t.populateFFSQLMapping(AF);t.populateDataset(AE);}else{t.populatePreview(AF,AE);}V(t);}if(u&&u.success){u.success(AD);}}});},autoMap:function b(z,AA,r,u){var AB=mstrApp.getRootController().getDataService(),w=this,t;if(!C.call(w,z)){return ;}t={tbid:w.tableID,isDB:true,taskId:"DIAutoMappingEMMASourceTable"};if(!w.isNew&&(mstrApp.isFFSQL||!w.FFSQLMode)){t.behaviorFlags=16;}if(!w.isDirty&&w.isNew){w.loadEmmaReport(z,AA,r,u);return ;}var x=function(){w.submitRequest({success:function AE(){w.loadEmmaReport(z,AA,r,u);},failure:function AD(AF){if(z&&z.failure){z.failure(AF);}}},t);};w.processEmmaTable({success:function AC(){x();},canceled:function(AF,AE){var AD={success:function(){if(z.canceled){z.canceled();}},failure:function(){if(z.canceled){z.canceled();}}};if(AE&&(AE.tid||AE.jid)){AB.killJob(AD,{threadId:AE.tid,jobid:AE.jid});}else{AD.success();}}},{tables:w.tableID});},processEmmaTable:function(u,t){var r=mstrApp.getRootController().getDataService();r.prepareData(u,t,1,1,I(9130,"Execute SQL"));},buildRelations:function R(r){mstrApp.getRootController().getDataService().buildRelations({success:function t(u){if(r&&r.success){r.success(u);}}},{did:this.tableID});},loadDBTypeFilters:function A(u){var r=this;r.dbObjects.populateDBProperties(mstrmojo.func.wrapMethods({success:function t(){var x=[],w=r.dbObjectsDisplayOptions;P.forEach(r.dbObjects.dbTypes,function(z){if((z.disp&w)===w){x.push(z.v);}});r.dbmsTypeFilter=x;r.dbRolesTypeFilter=x;}},u));},cleanDuplicateRI:function N(t){var r;if(this.originalMsgID&&this.originalMsgID!==mstrApp.msgid){if(t){r=mstrApp.msgid;mstrApp.msgid=this.originalMsgID;}else{r=this.originalMsgID;}mstrApp.getRootController().getDataService().removeOrDuplicateRI({success:mstrmojo.emptyFn},{add:false,messageID:r,showWait:false});delete this.originalMsgID;}},submitRequest:function k(u,t,r){if(t.showWait===undefined){t.showWait=true;}mstrApp.getRootController().getDataService()[r||"submitRequest"](u,t);},getHelpTopic:function Y(){return this.FFSQLMode?"importing_data_using_freeform_script.htm":"importing_data_from_a_database.htm";}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDataChangeEvents");var F=mstrmojo.string;var E=4,A=15,D=8;function G(M){return M.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function I(O){var M=O.datap,N=M.srce,P=N.csl;this.set("SelDBRoleID",N.dbrid);P=G(P);this.SQLstmt=P;this.raiseEvent({name:"reportDefLoaded"});}function C(M){return M.dbRoleID+M.url;}mstrmojo.qb.thirdParty.Model=mstrmojo.declare(mstrmojo.qb.EmmaModel,null,{scriptClass:"mstrmojo.qb.thirdParty.Model",dbRolesVersionFilter:[223],dbRolesVersionExcludeFilter:[],dbObjectsDisplayOptions:8,xdaType:304,connectorType:131076,dbRoleEditorCfg:{hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[41],singleType:true},urlSrc:null,init:function L(M){this.dbRoleEditorCfg.showAddDriver=false;M.dbIds=null;M.dbVersions=null;this._super(M);this.urlSrc=[];this.dbRoleEditorCfg.dbIdExcludeFilter=[];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=[];},createReportInstance:function K(){var O=this,N=mstrApp.isFFSQL,M=O.isNew=!mstrApp.tableID,Q=mstrApp.getRootController().getDataService();O.supportTimeGeo=true;O.analysisID=mstrApp.analysisID;O.tableID=mstrApp.tableID;mstrApp.msgid=mstrApp.msgID;if(M){if(mstrApp.msgid){O.originalMsgID=mstrApp.msgid;Q.removeOrDuplicateRI({success:function(R){mstrApp.msgid=R.msgid;}},{messageID:mstrApp.msgid});}else{Q.createEmmaInstance({success:function P(R){mstrApp.msgid=R.msgid;}});}}else{O.originalMsgID=mstrApp.msgid;Q.removeOrDuplicateRI({success:function(R){mstrApp.msgid=R.msgid;var S=E;O.loadReport(S,A,D,null,{success:function T(U){if(N){I.call(O,U);}if(mstrApp.isCloud){mstrApp.getRootController().getDataService().autoClosePrompt({success:function V(W){mstrApp.msgid=W.msgid;}});}}});}},{messageID:mstrApp.msgid});}if(mstrApp.isFFSQL){O.set("isFFSQL",true);O.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},getAllowSave:function H(M){if(M&&M!==""){return true;}return false;},getHelpTopic:function J(){return"importing_data_from_a_BI_source.htm";},getNameSpaces:mstrmojo.emptyFn,autoMapFFSQL:function B(N,P){var M=this;mstrApp.getRootController().getDataService().editFFSQL({success:function O(){M.isDirty=true;M.SQLstmt=N;if(N){M.autoMap(P);}}},{exp:F.encodeXMLAttribute(N),tbid:M.tableID||""});}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._hasBigQueryModel","mstrmojo.hash");var C=mstrmojo.hash;mstrmojo.qb.bigquery.Model=mstrmojo.declare(mstrmojo.qb.EmmaModel,[mstrmojo.qb.bigquery._hasBigQueryModel],{setDBRole:function A(D){mstrApp.getRootController().getDataService().setDBRole({success:function(E){mstrApp.msgid=E.msgid;}},{dbrid:D,said:mstrApp.said,pid:this.selectedProject,tbid:this.tableID||""});},getRowWidget:function B(D,F){var G=this.tables,E,I=D.toLowerCase()+"."+F.toLowerCase(),H;C.forEach(G,function(J){E=J.tbn.toLowerCase();C.forEach(J.rows,function(K){if(E+"."+K.text.toLowerCase()===I){H=K;return false;}});});return H;},catalogRefresh:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasPopup","mstrmojo._FillsBrowser","mstrmojo.Box","mstrmojo.Table","mstrmojo.Image","mstrmojo.Button","mstrmojo.qb.SplitPanel","mstrmojo.qb.VSplitPanel","mstrmojo.qb.QBuilderModel","mstrmojo.qb.QBPanel","mstrmojo.qb.QBMappings","mstrmojo.qb.MissingColumnWarning","mstrmojo.form","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.Toolbar","mstrmojo.qb.QBPageLayout","mstrmojo.qb.Footer","mstrmojo.DI.DIExitOptions");mstrmojo.requiresDescs(531,1143,3377,12408,12484);var Q=mstrmojo.hash,E=mstrmojo.desc;var L="qbexpr",V={scriptClass:"mstrmojo.qb.ExpressionEditor",id:L};var A=" ",K=".";var M=E(12408,"Please add tables from the same DB connection.");function B(Z,a){if(!a){return Z;}return(Z.indexOf(A)>-1||Z.indexOf(K)>-1)?a.replace("#0",Z):Z;}function P(b,e,c){var k=[],a=mstrmojo.all.FFsql,l,g,h=c.length,j=a.items,f,d=this.main.WHTableTree,Z=d.getDBRole(d.getDBRoleID()).cpat;l=g=a.itemCount;k.push({isNew:true,v:"select",oi:{n:"select",sta:100,t:100},did:g++},{isNew:true,v:" ",isDelimiter:true,did:g++});mstrmojo.array.forEach(c,function(n,m){k.push({isNew:true,v:B(n.cln,Z),did:g++});f=m<h-1;if(f){k.push({isNew:true,v:",",isDelimiter:true,did:g++});}k.push({isNew:true,v:"\n",isDelimiter:true,did:g++});if(f){k.push({isNew:true,v:" ",isDelimiter:true,did:g++});}});e=B(e,Z);k.push({isNew:true,v:"from",oi:{n:"from",sta:100,t:100},did:g++},{isNew:true,v:" ",isDelimiter:true,did:g++},{isNew:true,v:(b?B(b,Z)+K+e:e),did:g++},{isNew:true,v:";",did:g++});if(l>0&&j[l-1]!=="\n"){j.push({isNew:true,v:"\n",isDelimiter:true,did:g++});}j=j.concat(k);a.itemCount=g;a.set("items",j);a.parent.updatepasses();}mstrmojo.qb.QBuilderPage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBuilderPage",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},id:"QBuilderPage",onError:mstrmojo.emptyFn,renderPageLoadError:function G(){var b=this.error,a=b.message,c=b.title,Z=b.btns;this.onError(b);if(!Z||!Z.length){mstrmojo.alert(a,null,c);}else{mstrmojo.confirm(a,null,{buttons:Z,title:c});}},render:function Y(){if(this.error){this.renderPageLoadError();}else{this._super();}},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:mstrmojo.desc(3377,"Object"),browsableTypes:"3,8",showCompletePath:false,onObjectSaved:function(b){var a=this.opener,Z=a&&a.oi;if(a&&Z){Z.did=b.did;Z.n=b.name;Z.desc=b.desc;a.set("title","QBReport: "+b.name);}}},children:[{scriptClass:"mstrmojo.qb.QBPageLayout",slot:"layout",alias:"main"}],init:function T(b){this._super(b);var c={},a=c[this.id]={};a.directDataAccessTableError=this.onTableAdded;a.diffDBInstTableError=this.onTableAdded;a.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(c);var d=this.getDBRoleSelector(),Z=this.main.children[0].bottomPanel;d.getLayoutOffsets=function(){return{h:9,w:0};};Z.getLayoutOffsets=function(){return{h:16,w:0};};Z.searchBox.widthOffset=10;Z.nameSpaces.heightOffset=30;d.heightOffset=38;Z.heightOffset=73;this.main.workPanel.getLayoutOffsets=function(){return{h:16,w:12};};d.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");},getDBRoleSelector:function I(){return this.main.children[0].topPanel;},getDBConnectionList:function J(){return this.getDBRoleSelector().dbConnections;},onTableAdded:function O(Z){var a="";switch(Z.name){case"diffDBInstTableError":a=M;break;case"directDataAccessTableError":a=M;break;}mstrmojo.qb.alert(a);},openDialog:function W(Z){this.openPopup(Z);},openExpressionEditor:function H(a,b){var Z=mstrmojo.all[L]||mstrmojo.insert(V);Z.set("oi",Q.copy(a,{mhfts:{},mvfts:{}}));Z.open(null,{zIndex:b||50});},addSQLFromColumn:function S(Z){P.call(this,Z.ns,Z.tbn,[Z]);},addSQLFromTable:function R(a,b,Z){P.call(this,a,b,Z);},getSQLStatement:function D(){return mstrmojo.all.FFsql.getSQLstmt();},toggleDatabaseView:function X(Z){this.main.toggleDatabaseView(Z);},toggleDataPreview:function C(Z){this.main.toggleDataPreview(Z);},loadView:function N(){this.toggleDataPreview(true);this.toggleDataPreview(false);},showRedirectionPage:function F(Z,a){this.set("children",[{scriptClass:"mstrmojo.Label",slot:"toolbar",text:mstrmojo.desc(12484,"Data Imported"),cssClass:"mstrmojo-qb-title"},{scriptClass:"mstrmojo.Image",cssClass:"mstrmojo-qb-toolbarIcon help",slot:"toolbar",title:mstrmojo.desc(1143,"help"),onclick:function(){var b=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId?mstrApp.helpLocaleId:mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm")+"#"+((mstrApp.helpTopics&&mstrApp.helpTopics.general)||"About_importing_data.htm");window.open(b);}},{scriptClass:"mstrmojo.DI.DIExitOptions",privileges:{CreateViewReport:mstrConfig.canCreateReport,CreateReportServices:mstrConfig.canCreateDocument,CreateAnalysis:mstrConfig.canCreateAnalysis},model:{cubeID:Z,path:a,operationMode:mstrApp.getRootController().getOperationMode()},slot:"layout"},{scriptClass:"mstrmojo.qb.Footer",slot:"footer",alias:"footerWidget"}]);this.footerWidget.hidePublish();},adjustSize:function(a){var b=a.size,d=mstrApp.isCloudPro,f=d?40:0,e=d?180:101;var c,Z;Z=parseInt(b.h,10)-e+"px";c=parseInt(b.w,10)-f+"px";if(this.height&&Z!==this.height){this.set("height",Z);}else{this.height=Z;}if(this.width&&c!==this.width){this.set("width",c);}else{this.width=c;}return true;},postBuildRendering:function U(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size});}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.Serializer","mstrmojo.array","mstrmojo.qb.QBuilderPage","mstrmojo.qb.QBuilderModel","mstrmojo.warehouse.WHController","mstrmojo.qb.QBHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(218,219,221,1442,3179,3377,7985,7986,8041,9114,9139,9523,9915,11299,12379,12380,12922,13137);var n=mstrmojo.hash,u=mstrmojo.array,AQ=mstrmojo.string,h=mstrmojo.warehouse.EnumDataChangeEvents,AJ=mstrmojo.qb.QBHelpers,g=mstrmojo.DI.DIConstants,X=mstrmojo.desc;var N={1:X(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),2:X(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this.")};var M=function(AV){if(AV===null){return"null";}var AW=typeof (AV);if(AW!=="object"){return AW;}else{if(AV.length===undefined){return"object";}else{return"array";}}};function H(AV){var AW=mstrApp.diShowFooterFunction;if(AW){AW({finish:{visible:AV}});}}function w(AW){var AV=AW.FFSQLMode?"Type Query":"Build Query";return{name:AV};}mstrmojo.qb.RootController=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{ddaController:null,start:function o(Ah,AY){var Ab=this.rootView,Aa=this.model,Ac=this,AW,AZ,AV,Ae,AX,Ag;this.dataService=mstrmojo.qb.DataService;Ab.render();if(mstrApp.isCloudPro){mstrApp.docID=mstrApp.docID||"";}else{mstrApp.docID=mstrApp.docID||mstrApp.analysisID||"";}if(mstrApp.isFFSQL){this.raiseEvent({name:"reportModeChange",mode:2,value:""});}this.toggleDatabaseView(true);Ab.loadView();var Ad=function Ad(){Ac.loadDBRoles({success:function Ai(){Aa.createReportInstance(Ah,AY);var Aj;Aj=(Aa.isNew&&mstrApp.emmaTablesNum===0);H(Aj);}});};if(Aa.specifyDBTypes){Aa.dbObjects.populateDBProperties({success:function Af(){Ad();}});}else{Aa.loadDBTypeFilters({success:function Af(){Ad();}});}AW=mstrApp.diRootViewID;this.header=AZ=(AW?(mstrmojo.all[AW]&&mstrmojo.all[AW].header):undefined);if(AZ){AZ.closeBtn.set("visible",!mstrApp.tableID);}Aa.attachEventListener("dataPreview",this.id,function(){Ac.enableButton(Aa.SQLstmt);});AV=mstrApp.diFooterID;Ae=AV?mstrmojo.all[AV]:undefined;if(Ae){AX=Ae.next;Ag=Ae.finish;Ac.attachEventListener("allowSave",AX.id,Ae.enableButton);Ac.attachEventListener("allowSave",Ag.id,Ae.enableButton);}},getDataService:function Y(){return this.dataService;},toggleDatabaseView:function AN(AV){this.rootView.toggleDatabaseView(AV);},toggleDataPreview:function AD(AV){var AX=this.rootView,AW=this.model.FFSQLMode;AX.toggleDataPreview(AV);if(!AW){AX.showQBPreview=AV;}if(AV){this.raiseEvent({name:"dataPreview"});}},openConditionDialog:function e(){var AW=this.model,AZ=mstrApp.diCurrentZIndex,AY=AZ?AZ+1:(this.zIndex||10)+1;if(AW.dbtables.length===0){mstrmojo.alert(mstrmojo.desc(9114,"Cannot add Filter without any Tables being added, please add some Tables first"));return ;}var AX="qbcondition",AV=mstrmojo.all[AX]||mstrmojo.insert({scriptClass:"mstrmojo.qb.ConditionEditor",id:AX});AV.set("zIndex",AY);if(!AV.hasRendered){AV.render();}AV.domNode.style.zIndex=AV.zIndex;AV.set("data",n.clone(AW.getConditions()));AV.set("visible",true);},refreshConditionDialog:function L(){var AW=this.model,AX="qbcondition",AV=mstrmojo.all[AX];if(AV&&AV.visible){AV.set("data",n.copy(AW.getConditions()));}},openHelp:function k(){var AV=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId?mstrApp.helpLocaleId:mstrApp.localeId)+"/MicroStrategy_Web_Help.htm#"+(mstrApp.isFFSQL?"freeform_import_page.htm":"database_import_page.htm");window.open(AV);},openExpressionEditor:function S(AW){var AV=this,AY={success:function AX(){var Aa=mstrApp.diCurrentZIndex,AZ=Aa?Aa+3:AV.zIndex;AV.rootView.openExpressionEditor(AW,AZ);}};if(this.getFunctionList()){AY.success();return ;}this.model.getFunctions(false,{success:function AX(){AY.success();}},{showWait:true});},getFunctionList:function z(){return this.model.getFunctionList();},getSuggestionItems:function AO(AV){return this.model.getSuggestionItems(AV);},exprjson2xml:function d(Ah,Ae,AY){if(!(Ae instanceof Array)){Ae=[Ae];}var AW=AY&&AY.isSerializable,Ac=(AY.convertBoolean===false)?false:true;var Af=[],AV=[],AX,Ai;for(var Ab=0,Aj=Ae.length;Ab<Aj;Ab++){var Ak=Ae[Ab];for(AX in Ak){if(AW){var Ad=AW(AX,Ae,Ab);if(Ad!==true){if(Ad===false){continue;}else{if(Ad.att){Af.push(Ad.att);}if(Ad.child){AV.push(Ad.child);}continue;}}}Ai=Ak[AX];switch(M(Ai)){case"array":var AZ,Aa,Ag;if(AX!=="omit"){AV.push(["<",AX,">"].join(""));for(AZ=0,Aa=Ai.length;AZ<Aa;AZ++){Ag=AY.getArrItemName(AX,Ai,AZ)||AZ;AV.push(this.exprjson2xml(Ag,Ai[AZ],AY));}AV.push("</"+AX+">");}else{for(AZ=0,Aa=Ai.length;AZ<Aa;AZ++){Ag=AY.getArrItemName(AX,Ai,AZ)||AZ;AV.push(this.exprjson2xml(Ag,Ai[AZ],AY));}}break;case"object":AV.push(this.exprjson2xml(AX,Ai,AY));break;case"string":Af.push([AX,'="',mstrmojo.string.encodeXMLAttribute(Ai),'"'].join(""));break;case"boolean":Af.push([AX,'="',((Ac)?(Ai?"-1":"0"):Ai),'"'].join(""));break;case"null":if(!AY.skipNull){Af.push([AX,'="',AY.nullValue,'"'].join(""));}break;default:Af.push([AX,'="',Ai,'"'].join(""));break;}}}return["<",Ah," ",Af.join(" "),">",AV.join(""),"</",Ah,">"].join("");},parseExpression:function D(AW,AV){this.model.validateExpr(AW,AV);},autoMap:function AE(){var AV=this;if(!AV.hasDBConnection()){return ;}AV.model.autoMap({success:function(){AV.toggleDataPreview(true);}},false,false);},autoMapFFSQL:function q(AW){var AV=this;if(!AV.hasDBConnection()){return ;}AV.model.autoMapFFSQL(AW,{success:function AX(){AV.enableButton(AW);}});},getSQLPreview:function l(AV){this.model.getSQL(AV);},convertMode:function AL(Ab){var AX=this,Aa=mstrApp.diCurrentZIndex,AZ=Aa?Aa+1:1000;AX.model.connectLiveSupport=undefined;if(Ab){this.model.getSQL({success:function AY(Ad){AX.model.convertToFFSQL(Ad,{success:function Ae(){AX.toggleDataPreview(false);AX.raiseEvent({name:"reportModeChange",mode:2,value:Ad});}});}});}else{var AW=AX.rootView.showQBPreview,Ac={success:function(){AX.toggleDataPreview(AW);AX.raiseEvent({name:"reportModeChange",mode:1,showPreview:AW});}},AV=mstrmojo.all.FFsql;if(AV.oriSQL===AV.getSQLstmt()){AX.model.convertToQueryBuilder(Ac);}else{mstrmojo.confirm(mstrmojo.desc(9139,"All changes performed in FFSQL mode will be lost. Do you want to leave FFSQL mode?"),{confirmBtn:{fn:function(){AX.model.convertToQueryBuilder(Ac);}}},{zIndex:AZ});}}},editSQL:function AR(AV,AW){this.model.editFFSQL(AW,AV);},addTable:function AA(AW,AV){this.model.addTable(AW,AV);},addTables:function AI(AW){var AX=this,AV=AX.model;u.forEach(AW,function(AZ){AX.getColumnsForDBTable({data:AZ},{success:function AY(Aa){if(AV.FFSQLMode){AX.addTableSQL(AZ,Aa.items);AX.enableButton();}else{AX.addTable(AZ,Aa.items);}}});});},addSQLFromTable:function AG(AW,AX,AV){this.rootView.addSQLFromTable(AW,AX,AV);},addSQLFromColumn:function AB(AV){this.rootView.addSQLFromColumn(AV);},addSelectedColumns:function b(AY,AV,AX,AW){this.model.addSelectedColumns(AY,AV,AX,AW);},addColumnWithExpression:function R(AV,AY,AX,AW){this.model.addColumnWithExpression(AV,AY,AX,AW);},editColumnExpression:function r(AV,AY,AX,AW){this.model.editColumnExpression(AV,AY,AX,AW);},gettIndex:function a(AV){return this.model.gettIndex(AV);},updateTableViewWithExpression:function Q(AW,AV,Ac){var Aa=this.model,AZ=Aa.selectedClns[AW],AY=AZ.wid,AX,Ab;AZ.expr=AV;u.forEach(AY,function(Ad){AX=mstrmojo.all[Ad];if(AX&&!Ac){if(AX.count>0){AX.count--;}AX.updateState(0);}});AY=[];u.forEach(AV,function(Ad){Ab=Ad.oi;if(Ab&&Ab.tp===26){AX=Aa.getRowWidget(Ab.tn,Ab.rn);if(AX){AX.count++;AX.updateState(1);AY.push(AX.id);}}});AZ.wid=AY;Aa.updateExpression(AW);},updateFilters:function AM(AV,AW){this.model.updateConditions(AV,AW);},addNewFilter:function U(AV){this.model.appendCondition(AV);},cancel:function K(){var AV=mstrApp.origin?(mstrApp.isBigQuery?"-3":"-2"):"-1";mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:AV},mstrApp.name,"POST",null,null,false);},onCancelButtonClick:function AK(){var AV;this.model.cleanDuplicateRI(true);AV=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=AV;mstrApp.getRootController().onCancelButtonClick();},onNextButtonClick:function W(){var AV=this;this.commit({success:function AW(){var AX,AY=mstrApp.getRootController().model,Aa=AY.isDDA,AZ=AY.isManagedCube;if(AV.header&&AV.header.closeBtn){AV.header.closeBtn.set("visible",true);}AY.cleanDuplicateRI(false);AX=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=AX;mstrApp.isDDA=Aa;mstrApp.isManagedCube=AZ;mstrApp.getRootController().afterQBProcess();}});},saveDDACube:function AS(AW){var AX=this.model,AY={},AZ;AZ={success:function(Ag){var Aa,Ac=AX.isDDA,Ad,Ah,Ae,Af,Ab,Ai=AX.isManagedCube;AX.cleanDuplicateRI(false);Aa=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=Aa;mstrApp.isDDA=Ac;mstrApp.isManagedCube=Ai;Ad=mstrApp.getRootController();Ah=Ad.model;Ad.getDDAController().setDirectDataAccess(mstrApp.isDDA);Ad.dataService.set("messageID",mstrApp.messageID);Ad.model.isManagedCube=mstrApp.isManagedCube;Ah.cubeName=w(AX).name;if(mstrApp.isSingleTier){Ae={isDirectDataAccess:Ah.isDirectDataAccess,name:Ah.cubeName};Af={success:function(Aj){if(Aj.objectId){Ah.cubeID=Aj.objectId;}Ad.wrapUpDataImport();},failure:function(Aj){mstrApp.hideProgress();Ad.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,Aj&&Aj.message);}};Ab={success:function(){Ad.dataService.createOneTierDoc(Af,Ae);},failure:function(Aj){mstrApp.hideProgress();Ad.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,Aj&&Aj.message);}};if(Ah.operationMode===g.operationMode.edit||Ah.operationMode===g.operationMode.refresh){Ad.dataService.duplicateReportInstance(Ab,{messageID:Ah.analysisID,datasetID:Ah.cubeID,duplicateRIMsgID:Ad.dataService.messageID});}else{Ad.dataService.createOneTierDoc(Af,Ae);}return ;}if(Ai){Ad.wrapUpDataImport();return ;}Ah=Ad.model;if(Ag&&Ag.objectId){Ah.cubeID=Ag.objectId;}Ah.path=AW&&AW.objPath;Ad.wrapUpDataImport();}};function AV(){if(AX.isManagedCube){AZ.success();return ;}AY.displayMode=12;AY.shouldRefresh=false;if(AX.isDDA){AY.shouldRefresh=false;AY.saveAsFlags=g.saveAsFlags.saveAsDDA|g.saveAsFlags.saveAsOverWrite;}else{AY.saveAsFlags=g.saveAsFlags.saveAsInMemory|g.saveAsFlags.saveAsOverWrite;}AY.taskId="saveAndPublishCube";AY.showWait=true;AY=n.copy(AW,AY);AY.saveAsOverwrite=true;delete AY.objPath;mstrApp.getRootController().model.submitRequest(AZ,AY);}mstrApp.getRootController().model.submitRequest({success:function(){if(AX.operationMode!==2){mstrApp.getRootController().model.submitRequest({success:function(){AV();}},{taskId:"DIClearRelationshipEMMASourceTable",showWait:true});}else{AV();}}},{taskId:"DIToggleDatasetServeMode",serveMode:AX.isDDA?g.datasetServeMode.dda:g.datasetServeMode.inMemory,showWait:true});},handleFinish:function Z(){var AV=this.model,AX=this,AW=AV.operationMode,AY={};AY.onOK=function(Aa){AX.commit({success:function AZ(){var Ab,Ad=AV.isDDA,Ac=AV.isManagedCube;if(Ad&&AW!==1){AX.saveDDACube(Aa);}else{AV.cleanDuplicateRI(false);Ab=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=Ab;mstrApp.isDDA=Ad;mstrApp.saveCubeParams=Aa;mstrApp.isManagedCube=Ac;mstrApp.getRootController().afterQBProcess(true);}}});};if(AW===1){AY.onOK();}else{if(!AV.isManagedCube&&!mstrApp.isSingleTier){AJ.showSaveAsDialog(AY,w(this.model));}else{AY.onOK();}}},onBackButtonClick:function m(){var AW=this.model,AX=AW.tableID,AV=this,AZ;AZ={success:function AY(){var Aa=mstrApp.msgid,Ab;mstrApp.container.unloadQB();mstrApp.messageID=Aa;Ab=mstrApp.getRootController();if(Aa){Ab.dataService.set("messageID",Aa);}Ab.backFromQB();}};if(AW.isNew&&AX){AV.getDataService().removeEmmaTable(AZ,{did:AX});}else{AZ.success();}},onFinishButtonClick:function AP(){var AW=this,AV=this.model,AY=AW.getDDAController(),Ab,AX,Aa=mstrApp.diCurrentZIndex,AZ=Aa?Aa+1:10;if(!AV.origIsDDA&&AY.allowDDA()){Ab={onOK:function(){AW.handleFinish();}};AX={callback:Ab,selectedIndex:AV.isDDA?0:1,zIndex:AZ};AY.showDDAConfirmDialog(AX);return ;}this.handleFinish();},exitApplication:function G(){mstrApp.container.unloadQB();mstrApp.getRootController().exitApplication();},addSQLCandidateTables:function t(AV){this.model.raiseEvent({name:"addCandidateTables",value:AV});},hasDBConnection:function x(){if(this.model.SelDBRoleID){return true;}mstrmojo.alert(mstrmojo.desc(9915,"Please select a database connection first."));return false;},publish:function f(){var AX=this.model,AV=AX.FFSQLMode?this.rootView.getSQLStatement():"",AZ=AX.isNew,Aa=mstrApp.folderID,AY=this,AW={success:function(Af){if(mstrApp.analysisID||mstrApp.msgID){var Ag=mstrApp.analysisID?[3169,mstrApp.name+".3169","messageID",mstrApp.analysisID]:[3104,mstrApp.name+".3104","messageID",mstrApp.msgID,"rwDesignMode",1,"executionMode",2],Ae=[Ag,[2048007,mstrApp.name+".rwd.rwframe.rwb.2048007","dsObjectID",Af.did,"dsType",3,"isDatasetAdded",false,"isDefault",false]];mstrApp.redirectToPage({evt:"1024001",events:mstrmojo.Serializer.serializeValueGroup(Ae),src:mstrApp.name+"."+mstrApp.pageName+".1024001","1024001":"1",evtorder:"1024001"});}else{if(mstrApp.isCloudPro){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:Af.did,rwCreateFlags:"16",rwViewMode:"2048"});}else{AY.gotoRedirectionPage(Af.did,Af.path);}}}};if(!this.hasDBConnection()){return ;}AX.recoverMode=0;if(Aa||!AZ){var Ad=AZ&&mstrApp.isCloudPro;AX.save((Ad?AX.getAutoReportName():null),null,Aa,!AZ,Ad,AV,{success:function(Ai){var Ah=mstrApp.analysisID,Ak=!AX.isCubeReport,Ae=mstrApp.folderID,Ag=mstrApp.reportID,Aj=mstrApp.refreshInDoc;if(!AZ&&Ah){mstrApp.hideWait(true);if(Aj){if(rrLockAndRunDashboard){rrLockAndRunDashboard(Ah);}else{mstrApp.redirectToPage({evt:"3104",rwDesignMode:"0",rwViewMode:"2048",executionMode:"1",objectType:"55",objectID:Ah});}}else{var Af=mstrmojo.insert({scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-qb-ObjectInfoEditor run-dashboard",showTitle:false,analysisID:Ah,cssText:"width: 260px",children:[{scriptClass:"mstrmojo.Label",text:Ak?mstrmojo.desc(13137,"Edit data successfully!"):mstrmojo.desc(11299,"Data refresh successful!"),cssClass:"mstrmojo-AttCreator-Text"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-RunDashboard",onclick:function(Am){var Al=this.parent.parent;Al.close();if(rrLockAndRunDashboard){rrLockAndRunDashboard(Ah);}else{mstrApp.redirectToPage({evt:"3104",rwDesignMode:"0",rwViewMode:"2048",executionMode:"1",objectType:"55",objectID:Ah});}}},{scriptClass:"mstrmojo.Button",id:"RefreshData",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-"+(Ak?"EditData":"RefreshData"),cssDisplay:"none",onclick:function(){if(Ak){refreshCube(Ah,Ae,"0",Ag,RRDIExtentedType.DATAIMPORT_DATABASE,false,true);}else{openCubeRefreshStatus(Ah,Ae);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-Exit",onclick:function(){var Al=this.parent.parent;Al.close();mstrApp.showWait();if(mstrApp.isCloud){rrOpenHomePage&&rrOpenHomePage();}else{mstrApp.redirectToPage({evt:3010});}}}]}]});Af.open();}}else{AW.success(Ai);}}});}else{var Ab=this.rootView,Ac=function Ac(){Ab.openPopup("saveasRef",{folderLinksContextId:mstrConfig.hasProfileReports?28:1,name:mstrmojo.desc(8041,"New Cube"),saveAs:function(){var Al=this,Ae=Al.contPanel,Af=Ae.name.value,Ak=Al.ob.currentFolder,Ah=Ak.did,Ag={success:function Aj(An){AW.success(An);},failure:function Ai(Ao){var An=parseInt(Ao.getResponseHeader("X-MSTR-TaskErrorCode"),10)+4294967296;if(An===2147749923){mstrmojo.confirm(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",mstrmojo.desc(3377)).replace("###",Af),{confirmBtn:{fn:function(){Am(true);}}},{title:mstrmojo.desc(3179,"Confirm Overwrite")});}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+Ao.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(!Af){mstrmojo.alert(mstrmojo.desc(9523,"Enter a Name"));return ;}var Am=function Am(An){AX.save(Af||"",Ae.desc.value||"",Ah,An,mstrApp.isCloudPro,AV,Ag);Al.close();};Am();}});};Ac();}},updateTableStructure:function I(){var AV=this.model;AV.compareDBTables({success:function(){if(AV.hasMissingUsedDBColumns()){mstrmojo.confirm(mstrmojo.desc(12922,"There are missing columns used in expressions. Do you want to update?"),null,{buttons:[mstrmojo.Button.newInteractiveButton(mstrmojo.desc(219),function(){AV.updateDBTables(true);},null,{iconClass:"mstrmojo-Editor-button-Yes"}),mstrmojo.Button.newInteractiveButton(mstrmojo.desc(218),null,null,{iconClass:"mstrmojo-Editor-button-No"})],title:mstrmojo.desc(3179)});}else{AV.updateDBTables();}}});},gotoRedirectionPage:function C(AV,AW){if(mstrApp.isNewAnalysis){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:AV,rwCreateFlags:"16",rwViewMode:"2048"});return ;}if(mstrApp.msgID){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"2",rwDesignMode:"1",objectType:"3",objectID:AV});return ;}this.rootView.showRedirectionPage(AV,AW);},save:function j(){this.model.save();},enableButton:function(AW){var AV=this.model.getAllowSave(AW);this.raiseEvent({name:"allowSave",value:AV});},addWHTable:function J(AY){var AX=this.model,AW=0,AV=AY.x,AZ=AY.y;u.forEach(AY,function(Ab){AX.getColumnsForDBTable({data:Ab},{success:function Aa(Ac){Ab.x=AV+AW*15;Ab.y=AZ+AW*15;AW++;AX.addTable(Ab,Ac.items);}},this);});},canAddTableSQL:function AC(AW,AV){return this.model.canAddTableSQL(AW,AV);},addTableSQL:function O(AW,AV){this.model.addTableSQL(AW,AV);},getFFsqlComp:function AT(){return this.model.FFsqlComp;},getOperationMode:function AH(){return(this.model.isNew)?0:1;},checkDBTables:function p(){this.model.checkDBTables();},markFailureLabel:function T(AV){this.raiseEvent({name:"failureLabel",value:AV});},attachDataChangeListeners:function AF(AW){var AV=this.model;n.forEach(AW,function(AX,AY){n.forEach(AX,function(Aa,AZ){AV.attachEventListener(AZ,AY,Aa);});});},editColumn:function c(AY){var AZ=3,AX=AY.columnIndex,AV=this.model,AW=AV.selectedClns[AX];this.openExpressionEditor({type:AZ,w:AW,tkn:AW.expr,cIndex:AX});},deleteColumn:function B(AX){var AW=AX.columnIndex,AV=this.model;if(AV.removeSelectedColumn){AV.removeSelectedColumn(AW);}},deleteAllColumns:function P(){this.model.removeAllColumns();},enableAvailableTables:function AU(){this.model.raiseEvent({name:h.DBTABLES_ENABLED,value:true});mstrApp.getRootController().enableButton();},getDDAController:function V(){if(this.ddaController===null){this.ddaController={shouldAskUser:true,allowDDA:function AZ(){var Ag=mstrApp.getRootController(),Ah=Ag.model,Ai=Ag.rootView,Ae=!!Ah.canSupportDDA,Ac,Aj,Af=Ah.connectLiveSupport,Ak,Ad;if(!Ae||(Af===g.connectLiveSupport.connectLiveSupportInMemoryOnly)){return false;}else{if(Af===undefined||!mstrApp.isFFSQLMode){Ak=Ah.getDBRole(Ah.SelDBRoleID);Ad=Ak&&Ak.mdDBRole&&Ak.mdDBRole.db_type===3000;if(Ad){return false;}}}Ac=Ah.dbridForDDA;if(Ac){if(!mstrApp.isFFSQLMode&&Ah.dbtables.length>0&&Ac!==Ah.prevDBRoleID){Ae=false;}else{if(mstrApp.isFFSQLMode){Aj=Ai.getSQLStatement();if(Ah.prevDBRoleID&&AQ.trim(Aj)&&Ac!==Ah.prevDBRoleID){Ae=false;}}}}return Ae&&!(mstrApp.isFFSQLMode&&Ah.isMultiPassSQL(Ai.getSQLStatement()));},onlyAllowDDA:function Ab(){return !!mstrApp.getRootController().model.shouldSupportDDA;},onToggleDDA:function AV(Af){var Ad=mstrApp.getRootController().model,Ac=0,Ae;if(Ad.isDDA===Af){return ;}if(Af){Ad.set("isDDA",true);if(!this.allowDDA()){Ac=1;Ae=false;}}else{Ad.set("isDDA",false);if(this.onlyAllowDDA()){Ac=2;Ae=true;}}if(Ac){mstrmojo.qb.alert(N[Ac]);Ad.set("isDDA",Ae);}},checkDDACheckbox:function AX(Ae){var Ac=mstrApp.getRootController().model.ddaCheckboxID,Ad;if(Ac){Ad=mstrmojo.all[Ac];if(Ad){Ad.set("checked",Ae);}}},tryEnableDDACheckbox:function AY(Ae){var Ac=mstrApp.getRootController().model.ddaCheckboxID,Ad;if(Ac){Ad=mstrmojo.all[Ac];}if(!Ad||!Ad.visible){return ;}if(!Ae){if(Ad.enabled&&!Ad.checked&&!this.allowDDA()){Ad.set("enabled",false);}}else{if(!Ad.enabled&&!Ad.checked&&this.allowDDA()){Ad.set("enabled",true);}}},askUserAboutDDA:function Aa(Ac){if(Ac){this.shouldAskUser=false;}return this.shouldAskUser;},showDDAConfirmDialog:function AW(Ac){var Ad=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog(Ac||{});Ad.open();}};}return this.ddaController;},onHelpButtonClick:function A(){mstrApp.showHelpTopic(this.model.getHelpTopic());},selectDBRole:function E(AX){var AW,AV;if(!AX){return ;}AW=this.rootView.getDBConnectionList&&this.rootView.getDBConnectionList();if(!AW){return ;}AV=u.find(AW.items,"did",AX);if(AV>=0){AW.set("selectedIndex",AV);AW.adjustScrollPosition(AV);}},hasTableJoin:function F(AV){var AW=this.model.tables[AV];return(AW&&AW.njoins>0)?true:false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBPageLayout","mstrmojo.qb.QBuilderPage","mstrmojo.qb.bigquery.BigQueryWHPanel","mstrmojo.qb.QBHelpers");var F=mstrmojo.qb.QBHelpers;var B=[{did:"Delete",n:mstrmojo.desc(629,"Delete")},{did:-1,n:"-"},{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:-1,n:"-"},{did:"More Options",n:mstrmojo.desc(9126,"More Options")}];var C=[{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")}];var A=[{n:"=",dssid:"0"}];mstrmojo.qb.bigquery.QBPageLayout=mstrmojo.declare(mstrmojo.qb.QBPageLayout,null,{scriptClass:"mstrmojo.qb.bigquery.QBPageLayout",init:function D(H){var G;this.children=F.clone(this.children);this.children[0].scriptClass="mstrmojo.qb.bigquery.BigQueryWHPanel";if(this._super){this._super(H);}G=this.workPanel.children[0].tables;G.joinMenuOption={menuItems:B,joinItems:C,mappingKey:"bigquery",joinOperators:A};}});mstrmojo.qb.bigquery.BigQueryBuilderPage=mstrmojo.declare(mstrmojo.qb.QBuilderPage,null,{scriptClass:"mstrmojo.qb.bigquery.BigQueryBuilderPage",init:function D(G){this.children=F.clone(this.children);this.children[0].scriptClass="mstrmojo.qb.bigquery.QBPageLayout";if(this._super){this._super(G);}},getDBRoleSelector:function E(){return this.main.children[0].topPanel.dbSelector;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController","mstrmojo.warehouse.WHController");mstrmojo.qb.EmmaController=mstrmojo.declare(mstrmojo.qb.RootController,null,{commit:function A(F){var C=this.model,D,B={success:function E(){C.buildRelations(F);}};if(C.FFSQLMode){C.autoMapFFSQL(mstrApp.getRootController().rootView.getSQLStatement(),B);}else{C.autoMap(B);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController","mstrmojo.warehouse.WHController");mstrmojo.requiresDescs(12752,12898,13324);var K=mstrmojo.array;function G(){return mstrApp.container.launchingApp.getRootController();}function E(R){var Q=[];var S=[];var T=R.urlSrc;var U="<ul>";mstrmojo.hash.forEach(T,function(V){if(V.fail===true){Q.push(V.tableID);U+="<li>"+V.url+"<br>"+V.errorMsg||" </li>";}else{S.push(V.tableID);}});U+="</ul>";return U;}function H(R,V,U){var X=E(R);var Q={detailErrorMessage:X,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:U};var W=mstrmojo.desc(12752,"BI Sources"),T=mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),S=G();S.displayWarning(T,W,V,Q);}function O(Q){var R=G();var S=E(Q);R.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,S);}function L(U,V,T,R,X){var Q={success:function W(){U.buildRelations(X);},failure:function S(){U.urlSrc[R].fail=true;X.success();}};U.setDBRole(V);U.autoMapFFSQL(T,Q);}function C(S,V,W,Q){var U=mstrApp.getRootController().getDataService();U.createEmmaTable({success:function T(X){S.tableID=X.tbid;mstrApp.msgid=X.msgid;V.tableID=X.tbid;L(S,V.dbRoleID,V.url,Q,W);},failure:function R(){S.urlSrc[Q].fail=true;O(S);}},{xt:S.xdaType,dict:S.connectorType});}function B(T){var Q=T.getDBRole(T.SelDBRoleID);var R=Q?Q.n:"";var S="BI Source from "+R;return{name:S};}function N(Y,c){var a=mstrApp.getRootController().getDataService();var U=Y.urlSrc,W=[],R=[];K.forEach(U,function(d){if(d.fail){R.push(d.tableID);}else{W.push(d);}});var V=function(){c.success();},T=function(){var d=mstrApp.getRootController();d.removeImportedSrc(W);};var Z=(R.length===U.length);var X={success:function b(){if(Z){O(Y);}else{H(Y,V,T);}},failure:function Q(){var d=G();d.displayError(mstrmojo.desc(12898,"Delete failed table failure!"),true);}};var S=R.length;if(S===0){c.success();}else{if(Y.isNew){a.removeEmmaTable(X,{did:R.join()});}else{O(Y);}}}mstrmojo.qb.thirdParty.Controller=mstrmojo.declare(mstrmojo.qb.RootController,null,{scriptClass:"mstrmojo.qb.thirdParty.Controller",proIdx:-1,commit:function I(X){var R=this.model,U=mstrApp.getRootController().rootView,S=U.getSrcUrls(),W=S.length,T=this,V;R.urlSrc=S;T.proIdx=0;if(W>0){V=S[0];var Q={success:function(){T.proIdx++;V=S[T.proIdx];if(V){C(R,V,Q,T.proIdx);}else{N(R,X);}}};if(R.isNew){C(R,V,Q,T.proIdx);}else{L(R,V.dbRoleID,V.url,0,X);}}},onBackButtonClick:function P(){mstrApp.container.unloadQB();var Q=mstrApp.getRootController();var R=Q.rootView.header;if(R){R.subtitle.set("text","");}Q.backFromQB();},handleFinish:function J(){var Q=this.model,S=this,R=Q.operationMode,T={};T.onOK=function(V){S.commit({success:function U(){var W=mstrApp.msgid,X=Q.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=W;mstrApp.saveCubeParams=V;mstrApp.isManagedCube=X;mstrApp.getRootController().afterQBProcess(true);}});};if(R===1){T.onOK();}else{if(!Q.isManagedCube&&!mstrApp.isSingleTier){mstrmojo.qb.QBHelpers.showSaveAsDialog(T,B(this.model));}else{T.onOK();}}},onFinishButtonClick:function F(){this.handleFinish();},removeImportedSrc:function D(Q){this.rootView.removeSrcs(Q);},canDisplayCatalogSQL:function M(){return false;},handleServerRequestError:function A(R,W,V,U,S){var Q=this.proIdx;if(Q<0){mstrmojo.DI.controller.DIDialogController.showErrorDialog(R,W,V,U,S);}else{var T=this.model.urlSrc[Q];if(T){T.errorMsg=W;}if(V){V();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.qb.bigquery._BigQueryController");mstrmojo.requiresDescs(12385);var F=mstrmojo.hash,E=mstrmojo.desc;mstrmojo.qb.bigquery.RootController=mstrmojo.declare(mstrmojo.qb.EmmaController,[mstrmojo.qb.bigquery._BigQueryController],{scriptClass:"mstrmojo.qb.bigquery.RootController",isCloud:function C(){return mstrApp.isCloudPro;},getColumnsForDBTable:function A(G,H){this.model.getColumnsForDBTable(G,H);},attachDataChangeListeners:function D(H){var G=this.model;F.forEach(H,function(I,J){F.forEach(I,function(L,K){G.attachEventListener(K,J,L);});});},hasDBConnection:function B(){if(this.model.selectedProject){return true;}mstrmojo.alert(E(12385,"Please select a project first."));return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._IsWebApp","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.warehouse.WHModel","mstrmojo.warehouse.WHController","mstrmojo.qb.QBuilderPage","mstrmojo.qb.QBuilderModel","mstrmojo.qb.EmmaModel","mstrmojo.qb.RootController","mstrmojo.qb.EmmaController","mstrmojo.qb.bigquery.RootController","mstrmojo.qb.bigquery.ESRootView","mstrmojo.qb.bigquery.BigQueryBuilderPage","mstrmojo.qb.es.Model","mstrmojo.qb.es.Controller","mstrmojo.qb.EnumQBAppType","mstrmojo.qb.QBAlertDialog","mstrmojo.qb.thirdParty.Controller","mstrmojo.qb.thirdParty.Model","mstrmojo.qb.thirdParty.RootView","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(37,889,1442,9944,11583,11584,11585,11622,11623,11624,11625,12569,12920,12921,12923,12941,5781,14297);var N="QBwaitBox",S={scriptClass:"mstrmojo.Editor",id:N,draggable:false,showTitle:false,zIndex:9999,cssClass:"mstrmojo-di-progressBar",children:[{scriptClass:"mstrmojo.ProgressBar",alias:"progress",cssClass:"mstrmojo-di-progress stripes"}],counter:0,displayMsg:null,ondisplayMsgChange:function I(){if(this.progress){this.progress.set("progressText",this.displayMsg);}},oncounterChange:function Y(){var b=this.counter,d=this.visible;if(b===0&&d){this.close();}else{if(b>0&&!d){var a=mstrApp.container;var c={};if(a&&a.domNode){var Z=mstrmojo.dom.position(a.domNode);if(Z){c={top:Z.y+"px"};}}this.open(null,c);}}}};var L=-2147215346,J=-2147071825,X=-2147212035,G=-2147206925,A=-2147206924,F=-2147209051,D=-2147207419,V=-2147071870,B=-2147216373;var W={};W[L]=mstrmojo.desc(11583,"Failed to execute query.");W[J]=mstrmojo.desc(11584,"Insufficient storage space to upload your data.");W[X]=mstrmojo.desc(11622,"Please unmap the attribute's non-key form first.");W[G]=mstrmojo.desc(11623,"Your session has expired.");W[A]=mstrmojo.desc(11623,"Your session has expired.");W[F]=mstrmojo.desc(11623,"Your session has expired.");W[D]=mstrmojo.desc(11623,"Your session has expired.");W[V]=mstrmojo.desc(11624,"No quota left to create cube.");W[B]=mstrmojo.desc(11625,"Failed to create report instance.");var O="A61B85F4485D3B953003B195E58B5138";var C=mstrmojo.DI.DIConstants;function T(h,Z,g){var d=mstrApp.isSingleTier?mstrmojo.desc(14297,"There is an error."):mstrmojo.desc(11585,"There is an error on the server."),f=mstrApp.getRootController(),k=h.code||(h.getResponseHeader&&h.getResponseHeader("X-MSTR-TaskErrorCode"))||"",b=h.message||(h.getResponseHeader&&h.getResponseHeader("X-MSTR-TaskFailureMsg"))||"",a="",e="",j;b=(b.length>2000)?b.substring(0,2000)+"...":b;j=b.replace(/com\.microstrategy(\.\w+)*: \(?/,"").replace(/\)$/,"");k=parseInt(k,10);switch(k){case L:if(f.model.FFSQLMode){a=b.replace(/com\.microstrategy(\.\w+)*: \(/,"").replace(/\)$/,"");if(a.match(/(.\s)*DataImport\)?\[(\d+)\](.\s)*/)){var c=parseInt(RegExp.$2,10);f.markFailureLabel(c);e=mstrmojo.desc(9944,"SQL Pass ## failed to execute.").replace("##",c);j=a;}}mstrmojo.qb.alert(e||W[k],j,Z,null,g);break;case J:b=b.match(/currently using(.*)space/g)[0];b=b.match(/\d+../g);a=mstrmojo.desc(12920,"You are currently using ## of the allocated ### space.");mstrmojo.qb.alert(W[k],a.replace("##",b[0]).replace("###",b[1]),Z,null,g);break;case X:mstrmojo.qb.alert(W[k],j,Z,null,g);break;case V:mstrmojo.qb.alert(W[k],j,function(){mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:"-1"},mstrApp.name,"POST",null,null,false);},null,g);break;case B:if(f.model.riid===O){mstrmojo.alert(mstrmojo.desc(12921,"Please contact your Administrator to update the Project Metadata."),function(){mstrApp.redirectToPage({evt:3010});});}else{mstrmojo.qb.alert(W[k],j,Z,null,g);}break;case G:case A:case F:case D:if(mstrApp.isCloudPro){rrOpenHomePage&&rrOpenHomePage();}else{mstrmojo.form.send({evt:"3010"},mstrApp.name,"POST",null,null,false);}break;default:if(j){mstrmojo.qb.alert(d,j,Z,null,g);}else{b=h.responseText;b=b&&b.match(/\[HttpException \(0x80004005\): (.)+\]/);mstrmojo.qb.alert(d,(b&&b[0]&&b[0].replace(/\[HttpException \(0x80004005\): |\]/gi,""))||mstrmojo.desc(5781,"Request timed out."),Z,null,g);}break;}}mstrmojo.qb.QBApp=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsWebApp],{scriptClass:"mstrmojo.qb.QBApp",enableWaitBox:true,getWaitBoxPosition:function(){var a=mstrApp.container;var b={};if(a&&a.domNode){var Z=mstrmojo.dom.position(a.domNode);if(Z){b={top:Z.y};}}return b;},init:function R(Z){this._super(Z);if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}},start:function E(h,b){var f,a=mstrmojo.qb.EnumQBAppType,j,g,e=mstrmojo.hash.clone(b),d,Z=C.backendSourceSubtype,c=false;switch(parseInt(h,10)){case a.BigQuery:case a.BigQueryFFSQL:mstrApp.isBigQuery=true;j=mstrApp.isFFSQL?342:341;this.dbroleID=mstrApp.dbrid;f=this.rootController=new mstrmojo.qb.bigquery.RootController();f.dataService=mstrmojo.qb.DataService;e.id="QBuilderModel";f.model=new mstrmojo.qb.bigquery.Model(e);f.rootView=new mstrmojo.qb.bigquery.BigQueryBuilderPage({placeholder:this.placeholder});break;case a.BigQuerySingleTable:mstrApp.isBigQuery=true;j=345;this.dbroleID=mstrApp.dbrid;f=this.rootController=new mstrmojo.qb.bigquery.ESController();f.dataService=mstrmojo.qb.es.DataService;f.model=new mstrmojo.qb.bigquery.ESModel(e);f.rootView=new mstrmojo.qb.bigquery.ESRootView({placeholder:this.placeholder});this.msgid=this.msgID;break;case a.EmmaSingleTable:f=this.rootController=new mstrmojo.qb.es.Controller();f.dataService=mstrmojo.qb.es.DataService;if(e.hasOwnProperty("emmaSingleIsForAlternateSource")){e.isForAlternateSource=e.emmaSingleIsForAlternateSource;delete e.emmaSingleIsForAlternateSource;}f.model=new mstrmojo.qb.es.Model(e);g={placeholder:this.placeholder};if(e.hasOwnProperty("emmaSingleAlertCfg")){g.alertCfg=e.emmaSingleAlertCfg;}f.rootView=new mstrmojo.qb.es.RootView(g);this.msgid=this.msgID;c=true;break;case a.MDX:f=this.rootController=new mstrmojo.qb.mdx.Controller();f.dataService=mstrmojo.qb.mdx.DataService;delete e.dbObjectsDisplayOptions;f.model=new mstrmojo.qb.mdx.Model(e);f.rootView=new mstrmojo.qb.mdx.RootView({placeholder:this.placeholder});this.msgid=this.msgID;break;case a.BISource:mstrApp.isBISource=true;j=mstrApp.isFFSQL?304:352;f=this.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.thirdParty.Controller"});f.dataService=mstrmojo.qb.DataService;f.model=new mstrmojo.qb.thirdParty.Model(e);f.rootView=new mstrmojo.qb.thirdParty.RootView({placeholder:this.placeholder});break;default:j=mstrApp.isFFSQL?304:352;d=mstrApp.isFFSQL?Z.customSQL:Z.customSQLWizard;if(mstrApp.isEMMACube){f=this.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.EmmaController"});f.dataService=mstrmojo.qb.DataService;e.canSupportDDA=mstrApp.canSupportDDA;e.shouldSupportDDA=mstrApp.shouldSupportDDA;e.dbridForDDA=mstrApp.dbridForDDA;e.isDDA=mstrApp.isDDA;e.ddaCheckboxID=mstrApp.ddaCheckboxID;f.model=new mstrmojo.qb.EmmaModel(e);f.model.set("id","QBuilderModel");c=true;}else{f=this.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.RootController"});f.dataService=mstrmojo.qb.DataService;f.model=new mstrmojo.qb.QBuilderModel({id:"QBuilderModel"});}f.rootView=new mstrmojo.qb.QBuilderPage({placeholder:this.placeholder});break;}if(!c){f.model.dbObjects.populateDBProperties({});}f.start(j,d);},getRootController:function Q(){return this.rootController;},hideProgress:function M(a){var b=mstrmojo.all.progressBar,Z={manually:!!a};if(b){b.close(Z);}},redirectToPage:function U(Z){this.showWait();mstrmojo.form.send(Z,mstrApp.name,"POST",null,null,false);},serverResponse:function K(d,a,b,Z,c){mstrmojo.all[d][a](b,!!Z,c);},serverRequest:function P(e,j,d,f,k,Z,g,h){var c={},a;if(!e.sessionState&&this.sessionState){e.sessionState=this.sessionState;}e.msgid=Z||mstrApp.msgid;c.hideFailureErr=true;if(!f){a=j.failure;j.failure=function b(l){T(l,a,g);};}c.waitBoxCfg=h||{showCancel:false};c.waitBoxCfg.position=this.getWaitBoxPosition();c.waitBoxCfg.message=k;c.silent=!d;this._super(e,j,c);},serverRequestParallel:function H(b,g,a,c,h,Z,d){if(a===true){this.showWait(h);}if(!b.sessionState&&this.sessionState){b.sessionState=this.sessionState;}b.msgid=Z||mstrApp.msgid;try{var f=this;window.setTimeout(function(){var l=g.failure;g.failure=function k(o){T(o,l,d);};var m=mstrmojo.func.wrapMethods(g,{complete:function j(){if(a){f.hideWait();}}});var n=new mstrmojo.SimpleXHR();n.request("POST",mstrConfig.taskURL,{success:function(o){if(m.success){m.success(o);}},failure:function(o){if(m.failure){m.failure({code:o.getResponseHeader("X-MSTR-TaskErrorCode"),message:o.getResponseHeader("X-MSTR-TaskFailureMsg")});}},complete:function(){if(m.complete){m.complete();}}},b);},0);}catch(e){mstrmojo.err(e);}},serverRequestParallel:function H(b,g,a,c,h,Z,d){if(a===true){this.showWait(h);}if(!b.sessionState&&this.sessionState){b.sessionState=this.sessionState;}b.msgid=Z||mstrApp.msgid;try{var f=this;window.setTimeout(function(){var l=g.failure;g.failure=function k(o){T(o,l,d);};var m=mstrmojo.func.wrapMethods(g,{complete:function j(){if(a){f.hideWait();}}});var n=new mstrmojo.SimpleXHR();n.request("POST",mstrConfig.taskURL,{success:function(o){if(m.success){m.success(o);}},failure:function(o){if(m.failure){m.failure({code:o.getResponseHeader("X-MSTR-TaskErrorCode"),message:o.getResponseHeader("X-MSTR-TaskFailureMsg")});}},complete:function(){if(m.complete){m.complete();}}},b);},0);}catch(e){mstrmojo.err(e);}},getSearchAutoCompleteDelay:mstrmojo.emptyFn});window.$MAPF=function(){return false;};}());