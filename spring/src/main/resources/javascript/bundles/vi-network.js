mstrmojo.chart.enums.EnumLineStyle={LS_SOLID:0,LS_DASH:1,LS_DOT:2,LS_DOT_DASH:3,LS_DASH_DOT_DOT:4,LS_MEDIUM_DASH:5,LS_SHORT_DASH:6,LS_LONGEST_DASH:7,LS_LONG_DOT:8,LS_DOT_DOT_DOT:9,LS_DASH_DASH_DOT:10,LS_DASH_DASH_DOT_DOT:11,LS_LONG_DASH_DOT:12,LS_LONG_DASH_DOT_DOT:13,LS_LONG_DASH_DASH:14,LS_LONG_DASH_DASH_DASH:15,LS_GRADIENT:16,LS_NONE:99};(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.VisEnum");var D=mstrmojo.array,A=mstrmojo.VisEnum,B=A.NETWORK_LAYOUT.LINEAR;mstrmojo.netviz._LinearLayout=mstrmojo.provide("mstrmojo.netviz._LinearLayout",{_mixinName:"mstrmojo.netviz._LinearLayout",init:function(E){if(this._super){this._super(E);}if(this.layouts===undefined){this.layouts={};}this.layouts[B]=C;}});function C(H,J,G){var E=H.nodes,I=E.length,M=G.dimension,K=Math.max(10,(180-M)/I)/2,F=J.height,L=-1*K,N=F/2;J.currentLayout=B;D.forEach(H.nodes,function(P){if(P.isExcluded){return ;}var O=P.sprite,Q=O.getGeometry(),R=Q.s;Q.x=L+R+K;Q.y=N;O.setGeometry(Q);L+=2*(R+K);});D.forEach(H.edges,function(Q){var V=Q.from.sprite,W=Q.to.sprite,O=V.getGeometry(),P=W.getGeometry(),T=P.x-O.x,S=P.y-O.y,X=(O.x+P.x)/2,U=(O.y+P.y)/2;Q=Q.sprite;var R={x:X-S*0.5,y:U+T*0.5};Q.setGeometry(R);});}}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.VisEnum");var D=mstrmojo.array,A=mstrmojo.VisEnum,B=A.NETWORK_LAYOUT.CIRCULAR;mstrmojo.netviz._CircularLayout=mstrmojo.provide("mstrmojo.netviz._CircularLayout",{_mixinName:"mstrmojo.netviz._CircularLayout",init:function(E){if(this._super){this._super(E);}if(this.layouts===undefined){this.layouts={};}this.layouts[B]=C;}});function C(L,N,J){function K(Q){if(Q.isExcluded){return ;}var R=Q.sprite.getGeometry(),P,O;G+=F;R.x=Math.cos(G)*E+E+I;R.y=Math.sin(G)*E+E+I;Q.sprite.setGeometry(R);if(Q.edges){for(P=0,O=Q.edges.length;P<O;P++){Q.edges[P].sprite.setGeometry({x:E+I,y:E+I,type:"bezier"});}}G+=F;}var G=0,I=J.maxR+A.NETWORK_CIRCLE_BORDER_WIDTH,M=J.circleCount,H=M*I*2,E=Math.max(Math.min(N.width,N.height)/2-I,H/(2*Math.PI)),F=Math.PI/M;N.currentLayout=B;D.forEach(L.nodes,K);}}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom,D=Math;mstrmojo.gm._IsAnchorable={PLACEMENT_ABOVE:1,PLACEMENT_BELOW:2,PLACEMENT_LEFT:3,PLACEMENT_RIGHT:4,anchor:null,anchorPosition:null,boundary:null,boundaryPosition:null,popupNodeName:"infoNode",tipNodeName:"tipNode",baseTipClass:"arrow",infoNodeOffset:25,popupNodeOffset:0,placementOrder:[this.PLACEMENT_ABOVE,this.PLACEMENT_BELOW,this.PLACEMENT_LEFT,this.PLACEMENT_RIGHT],hasScrollbars:function G(){return(!mstrApp.isTouchApp||!mstrApp.isTouchApp());},positionDialog:function E(){if(!this.anchorPopup()){if(typeof this._super==="function"){this._super();}}},positionTipNode:function A(I){var J=this.baseTipClass,K=this[this.tipNodeName];K.className=J+" "+I;},getTipDimension:function B(){var J=this[this.tipNodeName],I=C.position(J);return I;},anchorPopup:function F(){this.positionTipNode("top");var K=this.anchor,b=this.boundary,n=this[this.popupNodeName],q=this.infoNodeOffset,h=this.popupNodeOffset,k=this.hasScrollbars(),Y=this.anchorPosition||C.position(K,true),M=this.boundaryPosition||C.position(b,true),s=M.w,L=M.h,c=n.offsetWidth,O=n.offsetHeight,U=c/2,I=O/2,W=this.getTipDimension(),g=D.min(W.h,W.w),P=D.max(W.h,W.w)/2;if(k){s-=15;L-=15;}var Z=C.contains(b,n),j=Z?0:M.y,r=s/2-U,Q=L/2-I+j,m=-1000,t=-1000;if(Z){Y.x=Y.x-M.x;Y.y=Y.y-M.y;}var f=Y.y+Y.h,N=Y.x+Y.w,e=Y.x>c,o=((N+c)<s),R=Y.y>O,l=((f+O)<L),T=this,V=function(i,v,u){return D.min(D.max(i,u),D.max(v,0));},d=function(){if((Y.x<s)&&R){var i=Y.x+(Y.w/2);T.positionTipNode("bottom");t=Y.y-g-h;Q=t-O+q;r=V(0,s-c,i-U);m=V(Y.x,N,i)-P;return true;}return false;},J=function(){if((Y.x<s)&&l){var i=Y.x+(Y.w/2);T.positionTipNode("top");t=f+h;Q=t+g-q;r=V(0,s-c,i-U);m=V(Y.x,N,i)-P;return true;}return false;},a=function(){if((Y.y<L)&&e){var i=Y.y+(Y.h/2);T.positionTipNode("right");m=Y.x-g-h;r=m-c+q;Q=V(j,L-O,i-I);t=V(Y.y,f,i)-P;return true;}return false;},X=function(){if((Y.y<L)&&o){var i=Y.y+(Y.h/2);T.positionTipNode("left");m=N+h;r=m+g-q;Q=V(j,L-O,i-I);t=V(Y.y,f,i)-P;return true;}return false;},S=[],p;for(p=0;p<this.placementOrder.length;p++){switch(this.placementOrder[p]){case this.PLACEMENT_ABOVE:S.push(d);break;case this.PLACEMENT_BELOW:S.push(J);break;case this.PLACEMENT_LEFT:S.push(a);break;case this.PLACEMENT_RIGHT:S.push(X);break;}}for(p=0;p<S.length;p++){if(S[p]()){break;}}Q=D.round(Q);r=D.round(r);t=D.round(t);m=D.round(m);this.applyPopupNodePos(Q,r,t,m);return true;},applyPopupNodePos:function H(K,J,M,I){var O=this[this.tipNodeName],L=O.style,P=this[this.popupNodeName],N=P.style;L.top=M+"px";L.left=I+"px";N.top=K+"px";N.left=J+"px";}};}());(function(){var E=false;mstrmojo.requiresCls("mstrmojo.Base");mstrmojo.netviz.PropertyParser=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.netviz.PropertyParser",methods:{unmarshal:function(W,V){var U=this;U._withConfig({unmarshal:true},function(){U.parsedProps[W]=V;});},marshal:function(V){var U=this;return U._withConfig({marshal:true},function(){return U.parsedProps[V];});}},init:function(U){if(this._super){this._super(U);}this.config={marshal:false,unmarshal:false};this.parsedProps={};},parse:function(V,X){var W=this,Y=this.parsedProps,U=this.methods;this.raw=V;this.schema=X;Object.keys(U).forEach(function(Z){W.defineMethod(Z,U[Z]);});Object.keys(X).forEach(function(Z){var a=X[Z];W.defineProperty(Z,a.type);Y.unmarshal(Z,V[a.key]);});return Y;},defineProperty:function(U,c){var b=this,W=b.config,a=this.parsedProps,V=(this.schema||{})[U]||{},g=V.preSet,Y=V.postSet,X=V.preGet,d=V.postGet,f=V.key,e=this.raw,Z;if(!T(c)){throw new TypeError("type does not implement required methods");}Object.defineProperty(a,U,{enumerable:true,get:function(){var h=Z;if(h!==undefined&&W.marshal){if(X instanceof Function){h=X.call(a,h,U,e,f);}h=c.marshal(h);if(d instanceof Function){h=d.call(a,h,U,e,f);}}return h;},set:function(i){var h=i;if(W.unmarshal){if(g instanceof Function){h=g.call(a,h,U,e,f);}h=c.unmarshal(h);if(Y instanceof Function){h=Y.call(a,h,U,e,f);}}if(h!==undefined&&!c.validate(h)){throw new TypeError("Invalid value in setter. Consider unmarshal(prop, val).");}Z=h;}});},defineMethod:function(X,U){var V=this,W=V.parsedProps;if(!L(X)||!(U instanceof Function)){return ;}Object.defineProperty(W,X,{enumerable:false,value:U.bind(V)});},_withConfig:function(W,Z){var X=this.config,Y=Object.keys(W||{}),V=Y.reduce(function(b,a){b[a]=X[a];return b;},{}),U;Y.forEach(function(a){X[a]=W[a];});U=Z();Y.forEach(function(a){X[a]=V[a];});return U;}});var O=Object.prototype.toString,G=mstrmojo.netviz.PropertyParser;function J(X,W,V){var U=parseInt(X,W);return isNaN(U)?V:U;}function N(U){return O.call(U)==="[object Number]";}function L(U){return O.call(U)==="[object String]";}var I=mstrmojo.declare(mstrmojo.Base,[],{scriptClass:"mstrmojo.netviz.PropertyParser.Property",init:function(U){if(this._super){this._super();}this.defval=U.defval;},marshal:function(U){return JSON.stringify(U).replace(/"/g,"'");}});G.BooleanProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.BooleanProperty",unmarshal:function(U){if(U===undefined){return this.defval;}return U.toString()==="true";},validate:function(U){return U===true||U===false||O.call(U)==="[object Boolean]";}});G.IntegerProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.IntegerProperty",unmarshal:function(U){return J(U,10,this.defval);},validate:N});G.FloatProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.FloatProperty",unmarshal:function(V){var U=parseFloat(V);return isNaN(U)?this.defval:U;},validate:N});G.JsonProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.JsonProperty",unmarshal:function(U){function V(X){var W;if(X!==undefined){try{W=JSON.parse(X.replace(/'/g,'"'));}catch(Y){W=X;}}return W;}if(typeof U==="string"){return V(U);}if(U!==undefined&&U!==null){return U;}return this.defval;},validate:function(U){return true;}});G.StringProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.StringProperty",unmarshal:function(U){if(U!==undefined&&U!==null){return U.toString();}return this.defval;},marshal:function(U){return U;},validate:L});var K=["BooleanProperty","StringProperty","JsonProperty","IntegerProperty","FloatProperty"];K.forEach(function(U){var V=G[U];V.preset=function(W){return new V({defval:W});};});function T(U){return Q(U,["marshal","unmarshal","validate"]);}function Q(V,U){if(!V){return false;}return(U||[]).every(function(W){return V[W] instanceof Function;});}if(E){var C=new G(),F=G.BooleanProperty,H=G.IntegerProperty,B=G.FloatProperty,S=G.StringProperty,M=G.JsonProperty;var R={x:1,y:{x:"n+1"},z:true,m:3.14};var P={bp1:"false",bp2:"true",bp3:"",dp1:"12",dp2:22,fp1:23.3,fp2:"3.14",sp1:"foobar",jp1:R,jp3:"transparent"};var A={boolProp1:{key:"bp1",type:F.preset(false)},boolProp2:{key:"bp2",type:F.preset(false)},boolProp3:{key:"bp3",type:F.preset(false)},boolProp4:{key:"bp4",type:F.preset(false)},boolProp5:{key:"bp5",type:F.preset(true)},decimalProp1:{key:"dp1",type:H.preset(-1)},decimalProp2:{key:"dp2",type:H.preset(-1)},decimalPropn:{key:"dpn",type:H.preset(-1)},floatProp1:{key:"fp1",type:B.preset(0)},floatProp2:{key:"fp2",type:B.preset(0)},floatProp3:{key:"fp3",type:B.preset(0.03)},stringProp1:{key:"sp1",type:S.preset("")},stringProp2:{key:"sp2",type:S.preset("string")},jsonProp1:{key:"jp1",type:M.preset({})},jsonProp2:{key:"jp2",type:M.preset({})},jsonProp3:{key:"jp3",type:M.preset("error")}};var D=C.parse(P,A);console.assert(Object.keys(D).length===Object.keys(A).length,"wrong property count");console.assert(D.unmarshal instanceof Function,"unmarshal not found");console.assert(D.marshal instanceof Function,"marshal not found");console.assert(D.boolProp1===false);console.assert(D.boolProp2===true);console.assert(D.boolProp3===false);console.assert(D.boolProp4===false);console.assert(D.boolProp5===true);console.assert(D.marshal("boolProp5")==="true");D.unmarshal("boolProp5","false");console.assert(D.boolProp5===false);console.assert(D.marshal("boolProp5")==="false");console.assert(D.decimalProp1===12);console.assert(D.decimalProp2===22);console.assert(D.decimalPropn===-1);D.unmarshal("decimalProp1",42);console.assert(D.decimalProp1===42);console.assert(D.marshal("decimalProp1")==="42");console.assert(D.floatProp1===23.3);console.assert(D.marshal("floatProp1")==="23.3");console.assert(D.floatProp2===3.14);console.assert(D.floatProp3===0.03);D.unmarshal("floatProp3",100);console.assert(D.floatProp3===100);console.assert(D.stringProp1==="foobar");console.assert(D.stringProp2==="string");D.unmarshal("stringProp2","quux");console.assert(D.marshal("stringProp2")==="quux");D.unmarshal("stringProp2",42);console.assert(D.stringProp2==="42");console.assert(JSON.stringify(D.jsonProp1)===JSON.stringify(R));console.assert(Object.keys(D.jsonProp2).length===0);console.assert(D.jsonProp3==="transparent");console.assert(D.marshal("jsonProp1")===JSON.stringify(R).replace(/"/g,"'"));D.unmarshal("jsonProp2",true);console.assert(D.jsonProp2===true);console.assert(D.marshal("jsonProp2")==="true");console.info("PropertyParser: all tests processed");}}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.gm.GMEnums");var A=mstrmojo.gm.EnumIdentityType;mstrmojo.gm.GMIdentities=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GMIdentities"});mstrmojo.gm.HeaderCellIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.HeaderCellIdentity",eid:undefined,v:undefined,tid:undefined,n:undefined,tui:undefined,fid:undefined,o:undefined,isRowAttribute:undefined,at:undefined,dei:undefined,dpt:undefined});mstrmojo.gm.GeneralIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GeneralIdentity",objType:undefined});mstrmojo.gm.TitleCellIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.TitleCellIdentity",tid:undefined,fid:undefined,n:undefined,tui:undefined,isRowAttribute:undefined,otp:undefined,init:function(B){this.fid=B.fid;this.tid=B.id;this.isRowAttribute=B.isRowAttribute;if(B.isRowAttribute){this.objType=A.ROW_TITLE;}else{this.objType=A.COL_TITLE;}this.n=B.n;this.otp=B.otp;this.ost=B.ost;this.tui=B.tui;}});mstrmojo.gm.MetricAxisTitleIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.MetricAxisTitleIdentity",init:function(B){this._super(B);}});mstrmojo.gm.AttributeAxisTitleIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.AttributeAxiTitleIdentity",init:function(B){this._super(B);}});mstrmojo.gm.AxisIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.AxisIdentity",isNumericAxis:undefined,metricIdxArr:undefined,attrIdArr:undefined});mstrmojo.gm.ColorSquareIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.ColorSquareIdentity",init:function(B){this._super(B);this.comb=this.getElementsCombination();},getElementsCombination:function(){var B,F=this.token,C,H,G,E,I,D;if(F){D=[];C=F.levels;H=F.elements;G=F.types;B=C.length;for(E=0;E<B;E++){I={eid:H[E],tid:C[E]};if(G){I.tp=G[E];}D.push(I);}return D;}return undefined;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Base");var B=false;mstrmojo.netviz.Bitmap=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.netviz.Bitmap",init:function(F){if(this._super){this._super();}var I=F.scale||1,H=F.left,G=F.top,E=F.right,D=F.bottom;if(I>1){H/=I;G/=I;E/=I;D/=I;}this._colCnt=Math.ceil(E)-Math.floor(H)+1;this._rowCnt=Math.ceil(D)-Math.floor(G)+1;this._scale=I;this._bits=[];},testZeros:function(H){var J=C.call(this,H),G=J.left,I=J.top,L=J.right,D=J.bottom,M=this._bits,K=this._colCnt,N,F,E;for(N=I;N<=D;N+=1){for(F=G;F<=L;F+=1){E=M[N*K+F];if(E&&A(E,H)){return false;}}}return true;},set:function(G){var I=C.call(this,G),F=I.left,H=I.top,L=I.right,D=I.bottom,M=this._bits,K=this._colCnt,N,E,J;for(N=H;N<=D;N+=1){for(E=F;E<=L;E+=1){J=N*K+E;if(!M[J]){M[J]=G;}}}}});function A(E,D){if(E.left>D.right||D.left>E.right){return false;}if(E.top>D.bottom||D.top>E.bottom){return false;}return true;}function C(G){var I=G.left,H=G.top,F=G.right,D=G.bottom,E=this._colCnt,K=this._rowCnt,J=this._scale;if(J>1){I/=J;H/=J;F/=J;D/=J;}I=Math.floor(I);F=Math.ceil(F);H=Math.floor(H);D=Math.ceil(D);if(F>=E){F=E-1;}if(I<0){I=0;}if(I>F){I=F;}if(D>=K){D=K-1;}if(H<0){H=0;}if(H>D){H=D;}return{top:H,left:I,bottom:D,right:F};}if(B){(function(){function D(I,H,G,F){return{left:I,top:H,right:G,bottom:F};}var E=new mstrmojo.netviz.Bitmap({left:0,top:0,right:100,bottom:100});console.assert(E.testZeros(D(10,15,50,20)));E.set(D(10,25,50,50));console.assert(E._bits.reduce(function(F){return F+1;},0)===41*26);console.assert(E.testZeros(D(10,15,50,20)));console.assert(!E.testZeros(D(10,15,50,25)));console.assert(!E.testZeros(D(0,0,100,100)));console.assert(E.testZeros(D(75,70,100,75)));console.assert(E.testZeros(D(-1,-1,-1,-1)));console.assert(E.testZeros(D(-1,100,1000,1000)));console.assert(!E.testZeros(D(50,50,50,50)));}());}}());(function(){mstrmojo.requiresCls("mstrmojo.color","mstrmojo.css","mstrmojo.hash");var A=mstrmojo.color,C=mstrmojo.css,H=mstrmojo.hash;function B(I){I=G(I);if(isNaN(I)){I=0;}I%=16777216;return{b:I%(1<<8),g:(I%(1<<16))>>8,r:(I%(1<<24))>>16};}function F(M,N,L){M=G(M);L=H.copy(L,{retainGradientObject:false});if(D(M)){var K=F(M.c1,N),I=F(M.c2,N);if(L.retainGradientObject){return{c1:K,c2:I,or:M.or};}return C.buildGradient(M.or,K,I).v;}if(typeof N==="number"){var J=B(M);if(isNaN(M)){N=0;}return"rgba("+J.r+" ,"+J.g+" ,"+J.b+" ,"+N+" )";}else{if(isNaN(M)){M=0;}return"#"+(16777216+M%16777216).toString(16).substring(1,7);}}function G(K){var J=K.c1,I=K.c2;if(D(K)){return{c1:G(J),c2:G(I),or:K.or};}if(typeof K==="number"){return K;}if(typeof K!=="string"){return NaN;}if(K[0]!=="#"){return parseInt(K,10);}if(K.length===4){K=K[0]+K[1]+K[1]+K[2]+K[2]+K[3]+K[3];}return parseInt(K.substring(1,7),16);}function E(K,I){var N=K.value,P=K.opacity;if(D(N)){return["c1","c2"].reduce(function(U,V,T){var W=E({value:N[V],opacity:P},I);U.value[V]=W.value;if(T===0){U.opacity=W.opacity;}return U;},{value:{or:N.or}});}if(N==="transparent"){K.value=I.value;}var M=A.hex2rgb(F(K.value)),L=A.hex2rgb(F(I.value)),S=K.opacity,R=I.opacity,Q=1-S,O,J;J=S+R*Q;O=M.map(function(T,U){return(T*S+L[U]*R*Q)/J;});return{value:"#"+A.rgb2hex.apply(undefined,O),opacity:J};}function D(I){return I&&["c1","c2","or"].every(function(J){return I.hasOwnProperty(J);});}mstrmojo.util.color=mstrmojo.provide("mstrmojo.util.color",{getCSSColorString:F,getColorValue:G,mix:E,isGradientColor:D,getRGB:B,createCanvasFillPattern:function(K,Q,J,P,I,O){var L=K.value,N=K.opacity,M;if(D(L)){M=Q.createLinearGradient(J,P,I,O);M.addColorStop(0,F(L.c1,N));M.addColorStop(1,F(L.c2,N));}else{M=F(L,N);}return M;}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var C=Math,I=mstrmojo.dom,K=mstrmojo.css,E="active",L="ready",J=6,F=10,O=10,P={LASSO_SELECTOR:"lasso-selector",LASSO_RESIZER:"lasso-resizer",BUTTON:"button"};mstrmojo.util.ui.LassoSelectorParamsType=null;function Q(S,R,T){return function(U){S.call(mstrmojo.all[R],U,T);};}function M(S){var U=S.view,T=I.eventTarget(window,S),R=this.lassoSelector;if(this.clickFromLassoResizer||(T!==R&&this.clickFromCreatingLasso)){I.stopPropogation(U,S);I.preventDefault(U,S);}delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;}function D(b,U){var R,d,S,Z,a=b.clientX,Y=b.clientY,T=this.lassoSelector,X=U.startX,W=U.startY,V=U.containerPos,e=a-V.x,c=Y-V.y;e=C.min(e,U.maxX);e=C.max(e,U.minX);c=C.min(c,U.maxY);c=C.max(c,U.minY);R=C.abs(e-X);d=C.abs(c-W);Z=C.min(W,c);S=C.min(X,e);T.style.width=R+"px";T.style.height=d+"px";T.style.left=S+"px";T.style.top=Z+"px";U.width=R;U.height=d;U.left=S;U.top=Z;if(R<=O&&d<=O){T.style.visibility="hidden";K.removeClass(T,E);}else{T.style.visibility="visible";K.addClass(T,E);document.body.style.cursor="crosshair";}}function H(T,W){var V=window.document,S=this.lassoSelector,U=W.width,R=W.height;I.detachEvent(V,"mousemove",W.fnMove);I.detachEvent(V,"mouseup",W.fnUp);delete W.fnMove;delete W.fnUp;document.body.style.cursor="default";if(!U||U===0||!R||R===0){this.dismissLassoSelector();}else{W.ctrlKey=T.ctrlKey;this.lassoSelected(W);this.clickFromCreatingLasso=true;K.addClass(S,L);this.positionBoxResizers();}}function N(g){var Z,c=g.view,b,a,d=I.eventTarget(window,g),R=d.getAttribute("type"),V=this.lassoSelector,S=this.lassoContainer,h=this.excludeAttrArr,U=h.length,Y,X={};delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;if(!V||!S||!this.lassoSelectorEnabled){return ;}if(I.contains(this.dropDownBtn,d,true)){return ;}for(Z=0;Z<U;Z++){if(R===h[Z]){return ;}}this.lassoSelecting();Y=I.position(S);b=g.clientX-Y.x;a=g.clientY-Y.y;X.containerPos=Y;X.maxX=Y.w;X.maxY=Y.h;X.startX=b;X.startY=a;X.minX=0;X.minY=0;X.info=this.getLassoSelectionInfo(d);X.useAsSelectorOrBrushes=this.useAsSelectorOrBrushes||((this.hasAssociatedNodes&&this.hasAssociatedNodes())||this.selectorControl);V.style.visibility="hidden";V.style.left=b+"px";V.style.top=a+"px";V.style.width="0px";V.style.height="0px";K.removeClass(V,L);S.appendChild(V);var T=this.id,e=document,W=Q(D,T,X),f=Q(H,T,X);I.attachEvent(e,"mousemove",W);I.attachEvent(e,"mouseup",f);X.fnMove=W;X.fnUp=f;I.stopPropogation(c,g);I.preventDefault(c,g);}function G(a,U){var Y=U.index,X=U.startX,W=U.startY,V=U.containerPos,f=a.clientX-V.x,e=a.clientY-V.y,T=this.lassoSelector;f=C.min(f,U.maxX);f=C.max(f,U.minX);e=C.min(e,U.maxY);e=C.max(e,U.minY);var d=f-X,c=e-W;if(Y%3===1){d=0;}if(Y===3||Y===5){c=0;}var R=U.selWidth,b=U.selHeight,S=U.selLeft,Z=U.selTop;if(d!==0){if(Y%3===0){S+=d;R-=d;}else{R+=d;}}if(c!==0){if(Y<3){Z+=c;b-=c;}else{b+=c;}}T.style.width=R+"px";T.style.left=S+"px";T.style.top=Z+"px";T.style.height=b+"px";U.width=R;U.left=S;U.height=b;U.top=Z;this.positionBoxResizers();}function B(R,U){var T=R.view,S=window.document;I.detachEvent(S,"mousemove",U.fnMove);I.detachEvent(S,"mouseup",U.fnUp);delete U.fnMove;delete U.fnUp;this.clickFromLassoResizer=true;I.stopPropogation(T,R);I.preventDefault(T,R);this.lassoSelectorResized(U);}function A(V){var T=V.view,h=I.eventTarget(window,V),U=parseInt(h.getAttribute("index"),10),a=this.lassoSelector,Z=a.offsetLeft,j=a.offsetTop,Y=Z+a.offsetWidth,g=j+a.offsetHeight,R=I.position(this.lassoContainer),f=0,c=0,d=R.w,b=R.h,e={};if(U%3===0){d=Y-F;}if(U%3===2){f=Z+F;}if(U<3){b=g-F;}if(U>=6){c=j+F;}e.minX=f;e.minY=c;e.maxX=d;e.maxY=b;e.startX=V.clientX-R.x;e.startY=V.clientY-R.y;e.index=U;e.containerPos=R;e.selWidth=a.clientWidth;e.selHeight=a.clientHeight;e.selLeft=a.offsetLeft;e.selTop=a.offsetTop;var X=this.id,i=document,S=Q(G,X,e),W=Q(B,X,e);I.attachEvent(i,"mousemove",S);I.attachEvent(i,"mouseup",W);e.fnMove=S;e.fnUp=W;I.stopPropogation(T,V);I.preventDefault(T,V);}mstrmojo.util.ui._LassoSelector=mstrmojo.provide("mstrmojo.util.ui._LassoSelector",{_mixinName:"mstrmojo.util.ui._LassoSelector",lassoContainer:undefined,lassoSelector:undefined,lassoSelectorEnabled:true,excludeAttrArr:null,boxResizers:null,useDropDownBtn:false,dropDownBtn:undefined,init:function(R){if(this._super){this._super(R);}this.excludeAttrArr=[];this.boxResizers=[];},registerLassoSelector:function(S,V,U){V=V||[];V.push(P.LASSO_SELECTOR);V.push(P.LASSO_RESIZER);V.push(P.BUTTON);this.lassoContainer=S;this.excludeAttrArr=V;this.useDropDownBtn=U||false;I.attachEvent(S,"mousedown",Q(N,this.id));I.attachEvent(S,"click",Q(M,this.id));var R=this.lassoSelector;if(!R){R=this.createLassoSelector();this.lassoSelector=R;}var T=R.parentNode;if(T){T.removeChild(R);}},createLassoSelector:function(){var U,V,S,T=this.boxResizers,R=document.createElement("div");R.setAttribute("class","lasso-selector");R.setAttribute("type",P.LASSO_SELECTOR);R.setAttribute("draggable",false);R.draggable=false;for(U=0;U<9;U++){if(U!==4){V=document.createElement("div");V.setAttribute("class","lasso-selector-resizer");V.setAttribute("type",P.LASSO_RESIZER);V.setAttribute("index",String(U));V.setAttribute("draggable",false);V.draggable=false;R.appendChild(V);T[U]=V;I.attachEvent(V,"mousedown",Q(A,this.id));}}K.addClass(T[0],["top","left"]);K.addClass(T[1],["top"]);K.addClass(T[2],["top","right"]);K.addClass(T[3],["left"]);K.addClass(T[5],["right"]);K.addClass(T[6],["bottom","left"]);K.addClass(T[7],["bottom"]);K.addClass(T[8],["bottom","right"]);if(this.useDropDownBtn===true){S=document.createElement("div");S.setAttribute("type",P.BUTTON);S.setAttribute("class","lasso-selector-dropdown-button");R.appendChild(S);I.attachEvent(S,"click",Q(this.lassoButtonClicked,this.id));this.dropDownBtn=S;}return R;},positionBoxResizers:function(){var T=this.boxResizers,S=this.lassoSelector,U=S.clientWidth,R=S.clientHeight,W=(U-J)>>1,V=(R-J)>>1;T[1].style.left=W+"px";T[3].style.top=V+"px";T[5].style.top=V+"px";T[7].style.left=W+"px";},dismissLassoSelector:function(){var R=this.lassoSelector;if(R){K.removeClass(R,[E,L]);if(R.parentNode){R.parentNode.removeChild(R);}}},isLassoSelectorActive:function(){function S(V,U){var W=V.className.split(/\s+/),T;for(T=0;T<W.length;T++){if(W[T]===U){return true;}}return false;}var R=this.lassoSelector;if(R){return S(R,E);}return false;},getLassoSelectionInfo:mstrmojo.emptyFn,lassoSelected:mstrmojo.emptyFn,lassoSelecting:mstrmojo.emptyFn,lassoButtonClicked:mstrmojo.emptyFn,lassoSelectorResized:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");var B="___value",E="___parent",A="___key_map",D="___IS_LEAF";mstrmojo.netviz.ObservableModel=mstrmojo.declare(mstrmojo.Obj,[],{scriptClass:"mstrmojo.netviz.ObservableModel",init:function(H){var G=[];H=H||{};H=mstrmojo.hash.clone(H);var L=Object.keys(H),F=L.length,K,J;for(K=0;K<F;K++){var I=L[K],M=H[I];if(!(M instanceof Object)){J=new C();J[B]=M;J[D]=true;H[I]=J;}else{H[I]=J=new C(M);}G.push(J);H[I][E]=this;}if(this._super){this._super(H);}this.addDisposable(G);this[A]=H;},getParent:function(){return this[E];},getChildrenKeys:function(){return Object.keys(this[A]);},isLeafNode:function(){return this[D];},getValue:function(){if(this.isLeafNode()){return this[B];}return this.getRawObject();},setValue:function(G,K){var F=this.getValue();var M,J,I,L,H;if(this.isLeafNode()){if(!(G instanceof Object)){if(F!==G){this[B]=G;if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}else{this[B]=undefined;this[D]=undefined;this[A]=G;M=Object.keys(G);J=M.length;H=this.addDisposable(new C(G));for(I=0;I<J;I++){L=M[I];this[L]=H[L];H[E]=this;}if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}else{var N=this.getChildrenKeys();J=N.length;for(I=0;I<J;I++){L=N[I];this[L]=undefined;}if(!(G instanceof Object)){this[D]=true;this[B]=G;this[A]=undefined;this[B]=G;if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}else{this[A]=G;M=Object.keys(G);J=M.length;H=this.addDisposable(new C(G));for(I=0;I<J;I++){L=M[I];this[L]=H[L];H[E]=this;}if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}},stopPropagation:function(F){F._isStopped=true;},raiseEvent:function(G){if(this._super){this._super(G);}if(G._isStopped){return ;}var F=this.getParent();if(F){F.raiseEvent(G);}},getRawObject:function(){var G={},J=this.getChildrenKeys(),F=J.length,I;for(I=0;I<F;I++){var H=J[I],K=this[H];if(K.isLeafNode()){G[H]=K.getValue();}else{G[H]=K.getRawObject();}}return G;}});var C=mstrmojo.netviz.ObservableModel;}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.Button","mstrmojo.dom","mstrmojo.Container");mstrmojo.requiresDescs(1442,2140);var C=mstrmojo.dom;mstrmojo.ui.menus.ToolbarEditor=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._IsMenuPopup,mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.menus.ToolbarEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-ToolbarEditor mstrmojo-ui-MenuEditor {@cssClass}" style="..." mstrAttach:mouseover,mouseout,click><div class="te-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},popupConfig:null,children:null,autoCloses:false,locksHover:true,visible:true,onclick:function B(E){C.stopPropogation(null,E.e);},init:function D(F){this._super(F);var E=this.popupConfig,G=E.contents;if(!G){throw new Error("Cannot open editor without editor content.");}this.cssClass=E.cssClass;this.addChildren(G);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.ToolbarEditor","mstrmojo.hash");mstrmojo.ui.menus.ToolbarEditorConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.ToolbarEditorConfig",cssClass:"",contents:null,init:function C(D){this._super(D);this.initBindings();},clear:function A(){this._super();this.contents=null;},newInstance:function B(D){return new mstrmojo.ui.menus.ToolbarEditor(mstrmojo.hash.copy({popupConfig:this},D));}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Vis","mstrmojo._HasOwnAvatar");var K=mstrmojo.css,I=mstrmojo.dom,F="px";function B(Q,P){return{x:Q.x-P.x,y:Q.y-P.y};}function M(Q,P){return(Q.x-P.x)*(Q.x-P.x)+(Q.y-P.y)*(Q.y-P.y);}function N(P){var Q=P.src.data;return(!Q||!Q.isScrollBar);}mstrmojo.VisLegend=mstrmojo.declare(mstrmojo.Vis,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.gm.VisLegend",bodyCssClass:"",avatarCssClass:"legend-dragged",dropZoneHighlightCss:"legend-dropZone",ownAvatar:true,draggable:true,dropZone:true,dockedPositions:null,calculateDockedPositions:mstrmojo.emptyFn,widget:null,boundaryNode:null,draggableNodeName:"domLegend",legendMarkup:"",extrasMarkup:"",markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}px;height:{@height}px;top:{@top}px;left:{@left}px;position:absolute;" mstrAttach:click,mouseover,mouseout><div class="gm-legend-bg"><div class="{@bodyCssClass}" style="width:{@width}px;height:{@height}px;text-decoration:inherit">{@legendMarkup}</div></div><div class="gm-anchor-point topLeft"></div><div class="gm-anchor-point topRight"></div><div class="gm-anchor-point bottomLeft"></div><div class="gm-anchor-point bottomRight"></div>{@extrasMarkup}</div>',markupSlots:{dropZoneNode:function(){return this.domNode;},domLegend:function(){return this.domNode.firstChild.firstChild;}},postBuildRendering:function(){this._super();this.calculateDockedPositions(this.widget.getWidth(),this.widget.getHeight());this.boundaryNode=this.widget.domNode;this.boundaryPosition=I.position(this.boundaryNode,true);},createAvatar:function D(){return this[this.draggableNodeName];},updateDropZoneNode:function C(R){var P=this.dockedPositions;if(P&&P.length>0){var W=B(R.tgt.pos,this.boundaryPosition);var U=M(W,P[0]),T=0,Q,V;for(Q=1;Q<P.length;Q++){V=M(W,P[Q]);if(V<U){U=V;T=Q;}}if(T!==this.currDockedPositionIdx){var S=this.dropZoneNode.style;S.left=P[T].x+F;S.top=P[T].y+F;if(this.widget.onLegendDropZoneChange){this.widget.onLegendDropZoneChange(P[T],T);}this.currDockedPositionIdx=T;this.updateAlignClass();return true;}}return false;},toggleDropZoneBorder:function O(P){K.toggleClass(this.dropZoneNode,this.dropZoneHighlightCss,P);},isDragValid:N,ondragstart:function E(P){if(!N(P)){return ;}this._super(P);this.toggleDropZoneBorder(true);},ondragmove:function A(P){if(!N(P)){return ;}this.updateDropZoneNode(P);this._super(P);},allowDrop:function H(P){var R=P.src,Q=R&&R.widget;return(Q&&Q!==this&&Q.parent===this.parent);},ondrop:function J(R){var P=this.domLegend;K.removeClass(P,this.avatarCssClass);var S=P.style;S.left="0";S.top="0";this.dropZoneNode.firstChild.appendChild(P);if(this.widget.onLegendDropped){var Q=this.getDockedPosition();this.widget.onLegendDropped(Q&&Q.pos);}R.dropSuccessful=true;},getDockedPosition:function G(){return this.dockedPositions&&this.dockedPositions[this.currDockedPositionIdx];},ondragend:function A(P){if(!N(P)){return ;}this._super(P);if(!P.dropSuccessful){this.ondrop(P);}this.toggleDropZoneBorder(false);},positionAvatar:function L(U){var R=this,Q=this.avatar,S=Q.style,T=this.boundaryPosition;var P=function(V,W){if(V==="x"){if(W<T.x){return T.x;}return Math.min(W,T.x+T.w-R.domNode.offsetWidth);}if(V==="y"){if(W<T.y){return T.y;}return Math.min(W,T.y+T.h-R.domNode.offsetHeight);}};S.left=P("x",U.x)+F;S.top=P("y",U.y)+F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css","mstrmojo.VisEnum","mstrmojo.VisUtility");var A=mstrmojo.VisEnum.NETWORK_LOCAL_PROPS,B=mstrmojo.VisEnum.NETWORK_DRAG_MODE;var C=mstrmojo.css,E=mstrmojo.dom,D=mstrmojo.VisUtility;mstrmojo.netviz.VisNetworkStageScaleBar=mstrmojo.declare(mstrmojo.Container,[],{scriptClass:"mstrmojo.netviz.VisNetworkStageScaleBar",markupString:'<div class="VisNetworkStageScaleBar" id="{@id}-networkStageScaleBar" style="position: absolute; top:{@top}px; left:{@left}px; height: {@height}px; width: {@width}px; z-index: 2;" mstrAttach:mousedown,click><div class="_label"></div><div style="position: relative"><div class="_zoomTool"><div class="_FTWTrigger"></div><div class="_zoomInButton"></div><div class="_scaleBar"><div class="_bar"></div><div class="_slider"></div></div><div class="_zoomOutButton"></div></div><div class="pan-select-tool"><input class="_inputPan" type="radio" id="{@id}-panButton" name="{@id}-sptype"><label for="{@id}-panButton" class="_panButton"></label><input class="_inputSelect" type="radio" id="{@id}-selectButton" name="{@id}-sptype"><label for="{@id}-selectButton" class="_selectButton"></label></div></div></div>',markupSlots:{label:function(){return this.domNode.childNodes[0];},fitToWindowTrigger:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0];},zoomInButton:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[1];},zoomTool:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[2].childNodes[0];},slider:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[2].childNodes[1];},zoomOutButton:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[3];},SPTrigger:function(){return this.domNode.childNodes[1].childNodes[1];},inputPan:function(){return this.domNode.childNodes[1].childNodes[1].childNodes[0];},panButton:function(){return this.domNode.childNodes[1].childNodes[1].childNodes[1];},inputSelect:function(){return this.domNode.childNodes[1].childNodes[1].childNodes[2];},selectButton:function(){return this.domNode.childNodes[1].childNodes[1].childNodes[3];}},init:function(F){if(this._super){this._super(F);}if(!this.placeholder){D.visPrint("A placeholder is needed for set the position for the ScaleBar. Init failed.");return ;}this.left=this.placeholder.offsetLeft;this.top=this.placeholder.offsetTop;},postBuildRendering:function(){if(this._super){this._super();}var I=["mousedown","mouseup","mousemove","click","mousewheel"],H,F=I.length;for(H=0;H<F;H++){var J=I[H],G="on"+J;if(this[G]){this.attachEventListener(J,this.id,this[G]);}}this.setScaleFactor(this.scaleFactor);this.initSPType();},initSPType:function(){var G=this.dragMode,F=this.owner;F.dragMode=G;if(G===B.pan){this.inputPan.checked=true;this.owner.lassoSelectorEnabled=false;}else{if(G===B.select){this.inputSelect.checked=true;this.owner.lassoSelectorEnabled=true;}}},onclick:function(H){H=H.e||H;H.stopPropagation();var G=H.target;var F;if(G===this.fitToWindowTrigger){this.resetScene.call(this.owner);this.setScaleFactor(1);var I=this;this._deActiveTimer=window.setTimeout(function(){I.setScaleFactorDone();},1000);}else{if(G===this.zoomInButton){this.setScaleFactor(this.scaleFactor+0.1,false,true);}else{if(G===this.zoomOutButton){this.setScaleFactor(this.scaleFactor-0.1,false,true);}else{if(G===this.panButton){F=B.pan;}else{if(G===this.selectButton){F=B.select;}}}}}if(F!==undefined){this.setSPType(F);}},setSPType:function(F){if(this.hasInterface("setDragType")){this.setDragType.call(this.owner,F);}},onmousedown:function(G){G=G.e||G;this.owner.dismissLassoSelector();G.stopPropagation();var F=G.target;if(F===this.slider){E.attachMouseMoveEvents(this.onmousemove.bind(this),this.onmouseup.bind(this));this._oldPageY=G.pageY;}},onmousemove:function(J){J=J.e||J;J.stopPropagation();var F=J.pageY-this._oldPageY;this._oldPageY=J.pageY;var K=this.slider.offsetTop+this.slider.offsetHeight/2+F-this.zoomTool.offsetTop,G=this.zoomTool.offsetHeight,I;if(this.hasInterface("range")){var H=this.range;I=(G-K)/G*(H.max-H.min)+H.min;}this.setScaleFactor(I);},onmouseup:function(F){F=F.e||F;F.stopPropagation();this.setScaleFactorDone();},setScaleFactor:function(P,K,F){if(isNaN(P)){D.visPrint("Invalid scale factor");return ;}if(this.hasInterface("owner")&&this.hasInterface("scale")&&this.hasInterface("range")){var Q,I;var O;var J=this.range;var G=1;if(P<J.min){O=J.min;}else{if(P>J.max){O=J.max;}else{O=P;}}if(O>this.scaleFactor){Q=true;}if(O<this.scaleFactor){I=true;}G=O/this.scaleFactor;this.scaleFactor=O;this.slider.style.top=(J.max-this.scaleFactor)/(J.max-J.min)*this.zoomTool.offsetHeight+this.zoomTool.offsetTop-this.slider.offsetHeight/2+"px";var H,L;if(Q){H=this.zoomInButton;L="_zoomInButtonActive";}if(I){H=this.zoomOutButton;L="_zoomOutButtonActive";}if(H){this.setScaleFactorDone();this._zoomButtonDomNode=H;this._zoomButtonActiveClassName=L;if(!F){C.addClass(H,L);}}var N=this.label;N.innerHTML=Math.floor(this.scaleFactor*100)+"%";this.owner.setLocalProp(A.ZOOM_FACTOR,this.scaleFactor);if(this.fadeLabelTimer){window.clearInterval(this.fadeLabelTimer);N.style.opacity=1;}var M=this;this.fadeLabelTimer=window.setInterval(function(){var R=N.style.opacity,S=0.01;if(R>S){R-=S;}else{R=0;if(M.fadeLabelTimer){window.clearInterval(M.fadeLabelTimer);}}N.style.opacity=R;},10);if(!K){this.scale.call(this.owner,G);}}},setScaleFactorDone:function(){if(this._zoomButtonActiveClassName&&this._zoomButtonDomNode){C.removeClass(this._zoomButtonDomNode,this._zoomButtonActiveClassName);delete this._zoomButtonActiveClassName;delete this._zoomButtonDomNode;}if(this._deActiveTimer){window.clearTimeout(this._deActiveTimer);}},hasInterface:function(F){if(this[F]){return true;}D.visPrint("warning: no interface found: "+F);return false;},scaleFactor:1,savedScaleFactor:1,range:null,scale:null,owner:null,dragMode:B.pan});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.VisEnum","mstrmojo.VisUtility");var S=mstrmojo,N=S.array,M=S.VisEnum,L=S.VisUtility,J=M.NETWORK_LAYOUT.FORCE_DIRECTED,E=M.NETWORK_FORCE_DIRECTED_LAYOUT_EDGE_CURVATURE,A=Math.ceil,U=Math.sqrt,O=Math.abs,I=0.1,T=U(I/2),C=L.isNearZero,D=(window.env||{}).isDebugging;function G(V){if(D){L.visPrint(V);}}mstrmojo.netviz._ForceDirectedLayout=mstrmojo.provide("mstrmojo.netviz._ForceDirectedLayout",{_mixinName:"mstrmojo.netviz._ForceDirectedLayout",init:function(V){if(this._super){this._super(V);}if(this.layouts===undefined){this.layouts={};}this.layouts[J]=R;}});function R(e,g){function Z(){var h=0,i;F(f);H(e.edges);g.setScene();g.draw();i=setInterval(function(){if(l>0){Q(f,a,l,Y,V);l-=W;F(f);H(e.edges);g.setScene();g.draw(false,true);G("iteration: "+h++);}else{clearInterval(i);}},17);}var f=[],a=[],j=100,d=100;g.currentLayout=J;B(e,f,a,j,d);var X=200,c=f.length,Y=U(j*d/c),V=Y*Y,l=j/(2*U(c)),W=l/X,b;if(D){Z();}else{for(b=0;b<X;b++){Q(f,a,l,Y,V);l-=W;}F(f,e.nodesIdHash);H(e.edges);}}function B(X,a,W,V,Y){function Z(g){var k=g.length,d=A(U(k)),b=V/d,m=Y/d,f,e;for(f=0;f<d;f++){for(e=0;e<d;e++){var h=f*d+e;if(h<k){var l=g[h];l.px=f*b-V/2;l.py=e*m-Y/2;}}}}N.forEach(X.nodes,function(c){if(!c.isExcluded){var b=c.getSize();var d={m:b*b,px:0,py:0,ax:0,ay:0,nodeId:c.id};c._shadowSprite=d;a.push(d);}});N.forEach(X.edges,function(b){if(!b.isExcluded){W.push({from:b.from._shadowSprite,to:b.to._shadowSprite});}});Z(a);}function K(c,e,X){var b=e.px-c.px,a=e.py-c.py,Z,Y,W,V;if(!C(b)&&!C(a)){Z=U(b*b+a*a);Y=Z*Z/X;W=b/Z*Y;V=a/Z*Y;c.ax+=W;c.ay+=V;e.ax-=W;e.ay-=V;}}function P(c,d,V){var b=d.px-c.px,Z=d.py-c.py,Y=b*b+Z*Z,a,X,W;if(Y<I){Y=I;b=(b>=0?1:-1)*T;Z=(Z>=0?1:-1)*T;}a=V/Y;X=-b*a;W=-Z*a;c.ax+=X;c.ay+=W;d.ax-=X;d.ay-=W;}function Q(a,Y,e,W,V){N.forEach(a,function(g){g.ax=0;g.ay=0;});var Z,b=a.length,X,f;for(Z=0;Z<b;Z++){f=a[Z];for(X=Z+1;X<b;X++){P(f,a[X],V);}}N.forEach(Y,function(c){K(c.from,c.to,W);});for(Z=0;Z<b;Z++){var d=a[Z];d.ax+=-d.px;d.ay+=-d.py;}N.forEach(a,function(g){if(O(g.ax)>e){g.ax=(g.ax>=0?1:-1)*e;}if(O(g.ay)>e){g.ay=(g.ay>=0?1:-1)*e;}g.px=g.px+g.ax;g.py=g.py+g.ay;});}function F(X,V){var W;N.forEach(X,function(Y){W=V[Y.nodeId];W.sprite.setGeometry({x:Y.px,y:Y.py});delete W._shadowSprite;});}function H(V){N.forEach(V,function(Y){Y=Y.sprite;var b=Y.from,a=Y.to,X=b.getGeometry(),W=a.getGeometry(),Z=E[(Y.unit.reversedEdge?1:0)];Y.setGeometry({x:(X.x+W.x)/2+(X.y-W.y)*Z,y:(X.y+W.y)/2+(W.x-X.x)*Z,type:"bezier"});});}}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.VisUtility");var R=mstrmojo.css,A=mstrmojo.VisUtility,H=mstrmojo.array,D=mstrmojo.string,I="vis-tooltip",N=20,P=165,L=350,E=350,G="px";function Q(){var U=this.domNode;U.innerHTML="";var S=document.createElement("div");S.className=I+"-container";var V=document.createElement("table");V.className=I+"-table";for(var T=0;T<3;T++){V.appendChild(document.createElement("COL"));}S.appendChild(V);this.domNode.appendChild(S);return V;}function K(T){var S=[],U=false;H.forEach(T,function(V){if(!V.isSuper){S.push(V.v);}else{U=true;S.push("<sup>"+V.v+"</sup>");}});return{hasSuper:U,htmlText:S.join("")};}mstrmojo.VisTooltip=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.VisTooltip",init:function O(S){this._super(S);R.addWidgetCssClass(this,(S&&S.widgetClass)?[S.widgetClass,I]:I);},toggle:function M(S){var T=mstrApp.isAppStatePrintPreview&&mstrApp.isAppStatePrintPreview();if(this.domNode){this.domNode.style.display=S&&!T?"block":"none";}},displayInfo:function C(V,c,S){var U=this.domNode,d=Q.call(this),a=false,T=0,b=0,W=10,Z=false,Y=d.childNodes[0],X=d.childNodes[2];V.forEach(function(m){var s,l,u,p,e,k,q,o,v,n,t,r;if(!Z){var g=d.insertRow(-1),j=g.insertCell(-1),i=g.insertCell(-1),h=g.insertCell(-1);g.className=I+"-tr";j.className=I+"-name";i.className=I+"-space";h.className=I+"-value";if(m===null){R.addClass(g,"separator");a=true;}else{if(a){R.addClass(g,"below-separator");}if(!S){i.innerHTML=":";}s=m.n;r=!m.skipEncode;j.innerHTML=r?D.encodeHtmlString(s,true):s;u=A.getComputedFontStyle(j);p=Math.ceil(A.measureTextWidth(j.innerHTML,u,u.bonus));q=U.offsetHeight>=E?1:2;if(p>P){o=A.truncateTextToLineWithWordWrap(s,u,P,q,true);if(o.canWordWrap){j.innerHTML=r?D.encodeHtmlString(o.text,true):o.text;}else{o=A.truncateTextToLineWithWordWrap(s,u,P,1);j.innerHTML=r?D.encodeHtmlString(o,true):o;}}T=Math.min(Math.max(T,p),P);l=m.v;n=m.isTrendLineFuncToken;if(n){v=K(l);}if(!n||!v.hasSuper){if(n){l=v.htmlText;}h.innerHTML=r?D.encodeHtmlString(l,true):l;e=A.getComputedFontStyle(h);k=Math.ceil(A.measureTextWidth(h.innerHTML,e,e.bonus,null,true));if(k>P){o=A.truncateTextToLineWithWordWrap(l,e,P,m.noTruncate?100:q,true);if(!o.canWordWrap){o=A.truncateTextToLineWithWordWrap(l,e,P,1,true);}h.innerHTML=r?D.encodeHtmlString(o.text,true):o.text;k=o.maxLineLen;}b=Math.min(Math.max(b,k),P);}else{h.innerHTML=v.htmlText;e=A.getComputedFontStyle(h);k=0;H.forEach(l,function(w){w.textWidth=A.measureSuperTextWidth(w.isSuper,w.v,e,e.bonus);k+=w.textWidth;});k=Math.ceil(k);if(k>P){o=A.truncateTextToLineWithWordWrapForTokens(l,e,P,m.noTruncate?100:q,true,true);if(!o.canWordWrap){o=A.truncateTextToLineWithWordWrapForTokens(l,e,P,1,true);}h.innerHTML=K(o.text).htmlText;k=o.maxLineLen;}b=Math.min(Math.max(b,k),P);}Y.style.width=T+"px";X.style.width=b+"px";t=T+b+W;d.style.width=mstrmojo.dom.isIE9?(t+2)+"px":t+"px";a=false;}if(U.offsetHeight>=E){var f=d.lastChild;f&&f.removeChild(f.lastChild);Z=true;}}});if(c){this.moveTo(c.x,c.y);}},moveTo:function(a,Z){var Y=mstrmojo.dom.position(document.body),W=this.domNode,b=W.offsetWidth,X=W.offsetHeight,V=Y.x+Y.w,c=Y.y+Y.h,T=a+N,S=Z+N;if(T>V-b||S>c-X){if(T<=V-b){S=c-X;}else{if(S<=c-X){T=V-b;}else{T=V-b;S=Z-N-X;}}}var U=W.style;U.left=T+G;U.top=S+G;},doLayout:function B(S){var U=this.domNode.getElementsByTagName("table")[0];if(!U){return ;}var V=R.getComputedStyle(this.domNode),T=S-parseInt(V.paddingLeft,10)-parseInt(V.paddingRight,10);T-=U.rows[0].cells[0].offsetWidth;T-=10;U.getElementsByClassName(I+"-value").forEach(function(W){W.style.maxWidth=T+G;});},posTo:function J(T){var S=this.domNode.style;S.left=T.x+G;S.top=T.y+G;},renderErrMsg:function F(S){Q.call(this).insertRow(-1).insertCell(-1).innerText=S;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.gm._IsAnchorable","mstrmojo.ui._HasUITheme","mstrmojo.VisUtility");var D=mstrmojo.dom,E=mstrmojo.VisUtility;mstrmojo.gm.DndTooltip=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.gm._IsAnchorable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.gm.DndTooltip",left:0,top:0,zIndex:10,boundaryNodeName:"boundary",popupNodeName:"infoNode",baseTipClass:"arrow",infoNodeOffset:0,popupNodeOffset:5,anchor:null,boundary:null,utils:mstrmojo.VisChartUtils,themeClassName:"mojo-theme-light",markupString:'<div id="{@id}" class="mstrmojo-Tooltip {@cssClass}" style="top:{@top}px;left:{@left}px;z-index:{@zIndex};position:absolute;{@cssText};"><div class="mstrmojo-Tooltip-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Tooltip-content {@contentNodeCssClass}" style="{@contentNodeCssText}"><div class="content"></div><div class="arrow"><div class="after"></div><div class="before"></div></div></div></div>',markupSlots:{infoNode:function(){return this.domNode.childNodes[1];},contentNode:function(){return this.domNode.childNodes[1].firstChild;},tipNode:function(){return this.domNode.childNodes[1].lastChild;}},toggle:function A(G){if(G){this.domNode.style.display="block";}else{this.domNode.style.display="none";}},updateContent:function(G,I,H){this.set("themeClassName",mstrApp.getThemeClassName());this.fillContent(G,I,H);this.positionDialog();},fillContent:function C(I,M,K){this.anchor=I;this.anchorPosition=M;this.contentNode.innerHTML=K||this.anchor.innerText||this.anchor.textContent;this.toggle(true);var G=E.getComputedFontStyle(this.contentNode),L=this.contentNode.innerHTML,H=E.measureTextWidth(L,G),J=130;if(H<=J){this.contentNode.style.width=H+"px";}else{this.contentNode.innerHTML=E.truncateTextToLineWithWordWrap(L,G,J,3);this.contentNode.style.width=J+"px";}},getTipDimension:function B(){var H=this[this.tipNodeName],G=D.position(H.firstChild);return G;},applyPopupNodePos:function F(I,H,K,G){var M=this[this.tipNodeName],J=M.style,N=this[this.popupNodeName],L=N.style;L.top=I+"px";L.left=H+"px";J.top=(K-I)+"px";J.left=(G-H)+"px";}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash","mstrmojo.Label","mstrmojo.array","mstrmojo.Popup","mstrmojo.Box","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.PopupConfig","mstrmojo.ui.Pulldown","mstrmojo.ui.editors.controls.LineStyleButton","mstrmojo.dom","mstrmojo.models.FormatModel","mstrmojo.VisUtility");var K=mstrmojo.array,B=mstrmojo.hash,J=mstrmojo.dom,E=mstrmojo.VisUtility,D=11,G=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES;function O(){var R=D,S,Q=[],U=Math.round(100/(R-1));for(S=0;S<R;S++){var T=(S*U)/100,P=(S*U)+"%";if(S===R-1){P="100%";T=1;}Q.push({n:P,did:T});}return Q;}function I(){var P=[{n:mstrmojo.desc(12100,"Circle"),did:"Circle"},{n:mstrmojo.desc(12101,"Square"),did:"Square"},{n:mstrmojo.desc(14433,"Diamond"),did:"Diamond"},{n:mstrmojo.desc(14434,"Hexagon"),did:"Hexagon"},{n:mstrmojo.desc(14435,"Triangle"),did:"Triangle"},{n:mstrmojo.desc(12103,"Ring"),did:"Ring"}];return P;}function N(S){var Q=D,R,P=0,T=Math.round(100/(Q-1));S=Math.round(S*100);for(R=0;R<Q;R++){if(Math.abs(S-R*T)<0.5*T){P=R;break;}}return P;}function L(P){P=P||[];K.forEach(P,function(Q){Q.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.Box",cssClass:"row-container",children:P};}function H(Q,P,R,T){T=T||"60px";var S=new mstrmojo.ui.Pulldown({items:Q,width:T});S.set("selectedIndex",P);S.postselectedIndexChange=function(U){var V=U.value,W=Q[V]&&Q[V].did;R.setValue(W);};return{scriptClass:"mstrmojo.Box",children:[S]};}function F(Q,P){return B.copy(P,{scriptClass:"mstrmojo.Label",text:Q,cssText:"width: 60px;"});}function A(P,R){var Q;K.forEach(P,function(T,S){if(T===R||T.did===R){Q=S;return false;}});return Q;}var C={background:function(Q,P){var S=(P&&P.label)||mstrmojo.desc(3905,"Background"),R=mstrApp.getThemeClassName()||"";return{scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+R,locksHover:true,children:[L([F(S),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:R,selectedValue:Q.value.getValue(),model:Q.value,showNoFill:false,width:"60px",postselectedValueChange:function(T){this.model.setValue(T.value);}}]}])]};},bubble:function(Q,P){var S=mstrApp.getThemeClassName()||"",R=P.alignment.attSrc==="from"?Q.circleStyle.fromNode:Q.circleStyle.toNode;return{scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+S,locksHover:true,children:[L([F(mstrmojo.desc(2923,"Shape")),H(I(),A(I(),R.shape.getValue()),R.shape,"128px")]),L([F(mstrmojo.desc(2885,"Fill")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:S,showNoFill:false,selectedValue:R.color.value.getValue(),model:R.color.value,width:"60px",postselectedValueChange:function(T){if(!B.equals(T.value,T.valueWas)){this.model.setValue(T.value);}}}]},H(O(),N(R.color.opacity.getValue()),R.color.opacity)]),L([F(mstrmojo.desc(9736,"Border")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:S,showNoFill:false,showGradient:false,selectedValue:R.border.color.value.getValue(),model:R.border.color.value,width:"60px",postselectedValueChange:function(T){this.model.setValue(T.value);}}]},{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.LineStyleButton",width:"60px",isHostedWithin:true,model:R.border.style,selectedValue:R.border.style.getValue(),postselectedValueChange:function(T){this.model.setValue(T.value);}}]}]),L([F(mstrmojo.desc(11993,"Data Labels")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.CharacterGroup",cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,showNoFillInColor:false,width:"380px",height:"22px,",onGroupValueChange:E.getCharGroupValueChangeCb(Q.circleLabelStyle)}]}])]};}};function M(V,T,U,Q){var S=C[V];if(S){var P=S(T,Q),W=J.position(this.containerNode,true),Y=U.pageX-W.x,X=U.pageY-W.y;var R=this._contextMenuAnchor;if(!R||!R.parentElement){R=document.createElement("div");R.style.position="absolute";this._contextMenuAnchor=R;this.containerNode.appendChild(R);}R.style.left=Y+1+"px";R.style.top=X+1+"px";var Z={hostId:this.id,hostElement:R,isHostedWithin:false};if(Q&&Q.alignment){Z.alignment=Q.alignment;}P.popupConfig=new mstrmojo.ui.PopupConfig(Z);P.visible=true;P.onClose=function(){this.unrender();};return P;}}mstrmojo.netviz._HasNetworkContextMenu=mstrmojo.provide("mstrmojo.netviz._HasNetworkContextMenu",{getWidget:function(){return this.owner;},showContextMenu:function(T,S,U,P){var R=M.call(this,T,S,U,P);if(P&&E.getPropertyByPath(P,"alignment.attSrc",false)!==false){if(P.alignment.attSrc==="from"){this.parent.textSelectedIndex=1;}else{this.parent.textSelectedIndex=2;}}if(T==="bubble"){R=mstrmojo.registry.ref(R);var Q=E.getPropertyByPath(R,"children.3.children.1.children.0");if(Q!==undefined){Q.setFormatSource(this.getDataLabelFormats());Q.fontColor.isHostedWithin=true;Q.fontSize.isHostedWithin=true;Q.fontFamily.isHostedWithin=true;}}this.openPopup(R);},unrender:function(P){this._contextMenuAnchor=undefined;this._super(P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.VisUtility");var D=mstrmojo.array;var E=mstrmojo.VisUtility;var C=mstrmojo.vi.ui.rw.SelectionType;var F=2;function B(I){var H=-1;var J=this.modelData.gts.row||[],G=J.length,K;for(K=0;K<G;K++){if(J[K].id===I){H=K;}}return H;}mstrmojo.netviz._SupportNetworkBrushesAndHighlights=mstrmojo.provide("mstrmojo.netviz._SupportNetworkBrushesAndHighlights",{_mixinName:"mstrmojo.netviz._SupportNetworkBrushesAndHighlights",prepareSelectedNodesInfo:function(G){this.clearSelections();var H=this.getSelectedNodes();if(G instanceof Function){H=G.call(this,H);}D.forEach(H,function(J){var I=J.attributeElements;this.addAttributeSelection(J.attribute.id,I[0].id,E.pluck(I,"name").join(":"));},this);},highlight:function(X,e){if(this._super){this._super.apply(this,arguments);}if(this.noHighlightAfterKeepOnlyExcludeDrill){return ;}var J,I,G,Z,T,a=[],W,S,Q=[],b=this.stage,V=(b&&b.spriteCollection)||[],L,K,O,M,N=this.model;if(!this.stage){return ;}function P(l,i){var m,k,h,g,j=[],f;if(l){j.push(l);}if(i){j.push(i);}D.forEach(j,function(n){m=n.sprite;if(m&&a.indexOf(m)===-1){a.push(m);}});f=j.length;if(f===2){h=j[0].edges;g=j[1].edges;D.forEach(h,function(n){S=n&&n.sprite;if(g.indexOf(n)!==-1&&Q.indexOf(S)===-1){Q.push(S);}});}else{if(f===1){k=j[0].edges;D.forEach(k,function(n){S=n&&n.sprite;if(S&&Q.indexOf(S)===-1){Q.push(S);}});}}}function U(f){var g=null;D.forEach(V,function(h){if(h.type==="Circle"&&h.text===f){g=h;return false;}});return g;}function R(f){var j=null,g,i,h=[];D.forEach(V,function(k){if(k.type==="Circle"){g=k.unit;i=g?g.attributeElements:[];if(g&&g.hasSelfLoop){h=g.secondaryAttributeElements;}i=i.concat(h);D.forEach(i,function(l){if(N.compareElementsId(l.id,f)){j=k;return false;}});if(j){return false;}}});return j;}function Y(f){D.forEach(f,function(g){if(g){b.addToSelection(g);}});}function d(f){D.forEach(f,function(g){b.addToSelection(g);});}function c(){Y(a);d(Q);b.draw();}function H(f){var g="";D.forEach(f||[],function(h){g+=h.n+" ";});g=g.substring(0,g.length-1);return g;}if(X===C.ATTS){b.clearSelection();for(J in e){if(e.hasOwnProperty(J)){I=e[J];for(G in I){if(I.hasOwnProperty(G)){Z=B.call(this,G);if(Z<0){continue;}T=I[G];if(T&&T.length>0){W=R.call(this,T[0].id);}if(W&&a.indexOf(W)===-1){a.push(W);}}}}}c();}else{if(X===C.METRICS){b.clearSelection();for(J in e){if(!e.hasOwnProperty(J)){continue;}I=e[J];L=null;K=null;O=null;M=null;for(G in I){if(!I.hasOwnProperty(G)){continue;}Z=B.call(this,G);if(Z<0||Z>1){continue;}else{if(Z===0){T=I[G];if(T&&T.length>0){O=R.call(this,T[0].id);}L=O&&O.unit;}else{if(Z===1){T=I[G];if(T&&T.length>0){M=R.call(this,T[0].id);}K=M&&M.unit;}}}}P(L,K);}c();}else{if(X===C.EMPTY){b.clearSelection();b.draw();}}}},singleUnitSelect:function A(){var I=this.getSelections().length>0||this.clearSelectionsFlag;if(this.clearSelectionsFlag){delete this.clearSelectionsFlag;}if(I){var H=function(){var K=this.model.scm,M=Object.keys(K||{}),O=(M&&M[0])||"",N=this.model.data.gts.row,L=this.model.data.gts.col;D.forEach(N.concat(L),function(P){if(M.indexOf(P.id)!==-1){O=P.id;return false;}});return O;};var J=function(){var K={};K.tid=H.call(this);K.eid="";K.isClearAll=false;K.anchor=this.domNode;K.at=F;K.selections=this.getSelections();K.selectionType=this.getSelectionType();return K;};var G=J.call(this);this.performAction([G]);}},clearSelections:function(G){this.clearSelectionsFlag=true;if(this._super){this._super();}if(G&&this.stage){this.stage.dismissLassoSelector();this.stage.clearSelection();this.stage.draw(false);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var N=mstrmojo.gm.EnumTRFManipulations;var J=mstrmojo.array,C=mstrmojo.hash,M=mstrmojo.func.wrapMethods,G=mstrmojo.func.composite,I=mstrmojo.VisEnum.GMLegendFormatingPropertyTag;var D={silent:false,undo:mstrmojo.emptyFn,redo:mstrmojo.emptyFn};function K(O){return O.model.controller.cmdMgr;}function L(){return(this.getDocModel&&this.getDocModel())||this.model.docModel;}function H(){return{success:function O(){this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}function E(P,R){var O,U,Q,S,T={};T.tks=this.k;T.selectorObjects=P;T.keepOnly=!!R;T.isDocVis=true;O=L.call(this);U=O.getDataService();Q=U.getGMViewFilterAction(T);S=O.getSliceCallback(T);return{action:Q,callbacks:S};}function B(Q,P){var O,S,R;O=L.call(this);R=O.getDataService();if(!this.isXMLDirty()){R.submitUpdates(Q,P);}else{S=this.getPersistAction();R.submitUpdates([Q,S],P);this.resetXMLDirtyFlag();}}function A(){var b=this.modelData||this.model.data,S=b.k,Z,Y="FormattingWidget",U,T,X,P,Q,R=[],W=[],V=this.edtModel;if(!b){console.log("warning: modelData is missing");return null;}var a=function(d,f){var c=T.createElement(f),e;if(d instanceof Object){for(e in d){if(d.hasOwnProperty(e)){var g=a(d[e],e);if(g){c.appendChild(g);}}}}else{c.setAttribute("value",d);}return c;};var O=function(c){return c.replace(/</g,"&lt;").replace(/"/g,"&quot;");};W=!!V&&!!V.getActionsWithUpdateProperty?V.getActionsWithUpdateProperty():[];X=this.createWidgetPropsXML?this.createWidgetPropsXML():null;if(!X||X.length===0){U=this.getProperties();if(this.useCompatibleXML){T=(new DOMParser()).parseFromString("<widgetProps></widgetProps>","text/xml");T.firstChild.appendChild(a(U,"fmt"));}else{T=(new DOMParser()).parseFromString("<props><widgetProps></widgetProps></props>","text/xml");T.firstChild.firstChild.appendChild(a(U,"fmt"));}X=(new XMLSerializer()).serializeToString(T);}P=O(X);Q={act:"setProperty",nodeKey:S,prs:Y,pri:4,v:P};R.push(Q);if(!!W){R=R.concat(W);}return R;}function F(P,Q,O,T){if(!(T instanceof Function)){return D;}var S=this.id;function R(U){return function(){var W=mstrmojo.all[S],V=W.getProperties();V[P]=U;T.call(W,U,true);W.getDocModel().selectVIUnit(W.parent.id,true);};}return{silent:true,undo:R(O),redo:R(Q)};}mstrmojo._VizSelectionHelper=mstrmojo.provide("mstrmojo._VizSelectionHelper",{postBuilderingCalled:false,listenToUpdateColorMap:function(R){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var Q=this,P,O=(Q.getDocModel&&Q.getDocModel())||Q.model.docModel;if(O){return O.attachEventListener("colorMapChanged",Q.id,function(T){P=Q.parent&&Q.parent.parent;if(Q.forceUpdateColorMap||(P&&P.isPanelDisplaying())){R.call(Q);}else{var S=P.attachEventListener("panelDisplaying",Q.id,function(U){if(Q.postBuilderingCalled){R.call(Q);}P.detachEventListener(S);});}});}},detachUpdateColorMapListener:function(P){if(!P){return ;}var O=(this.getDocModel&&this.getDocModel())||this.model.docModel;O.detachEventListener(P);},updateTargets:function(P){var S={},Q=this,O=L.call(this);S.fromGM=true;S.type=1;S.src=this.k;S.selectorObjects=P;function R(V){var T=Q.modelData||Q.model.data,U=T.sc;if(U!==undefined){return U[V];}return undefined;}S.keepOnly=true;S.ck=R.call(this,"ck");S.keyContext=S.ck;S.tks=R.call(this,"tks");S.ckey=R.call(this,"ckey");S.isDocVis=true;S.include=true;S.showall=R.call(this,"showall");O.slice(S);},updateAfterViewFilter:function(Q,O){var V,U,P,T,S,W,R;V=L.call(this);U=V.getDataService();T=E.call(this,Q,O);P=T.action;S=T.callbacks;R=this.model.controller||V.controller;if(this.currKeepOnlyAction){W=[C.clone(this.currKeepOnlyAction)];}else{W=E.call(this,[],false).action;}this.currKeepOnlyAction=P;R.submitUndoRedoUpdates([P],W,S);},updateAfterKeepOnly:function(Q){var P=L.call(this),O=this.model.controller||P.controller,R=M(O._getXtabCallback(this),H.call(this));O.applyKeepOnly(this,R,{keepOnly:Q,data:this.getSelections()},Q?-2:undefined);},updateAfterDrill:function(O,Y){var V=this,Z=L.call(this),X=Z.getDataService(),R=X.newUpdate(),Q=this.getSelections(),U=this.model.getSelectorDataFromViewFilter(V.model.data.vfexpr).concat({keepOnly:true,data:Q}),P=Z.getKeepOnlyOrExcludeAction(V.k,U),S=V.model.controller||Z.controller,T=S._getXtabCallback(V);R.add(O,M(Y,T));R.add(P,H.call(V));K(V).execute({execute:function W(){this.submitUpdate(R);},urInfo:{callback:R.callback}});},updateAfterSort:function(R){var P=this,O=L.call(this),S=O.getDataService(),T=O.getSliceCallback({tks:P.k});K(P).execute({execute:function Q(){var V=S.newUpdate(this,undefined),U={act:"sortGM",nodeKey:P.k,subActions:R};V.add(U,T,undefined);if(P.isXMLDirty()){V.addActions(P.getPersistAction());}this.submitUpdate(V,undefined);},urInfo:{callback:T}});},updateAfterAction:function(T,O,P,a,X){if(!T){return ;}var V=this,Q=V.parent&&V.parent.id,b=V.model.docModel,U=V.model.controller||b.controller,Z,Y,S={},W,R=X||D;if(P){Z=mstrmojo.emptyFn;W=function(){this.submitSilent(T);};}else{Z=b.getSliceCallback({tks:this.k});Z.success=G([Z.success,function(){b.selectVIUnit(Q,true);}]);W=function(){this.submit(T,Z,S);};}Y=U._getXtabCallback(V);if(O){Z=M(Z,O);Y=M(Y,O);}Y.success=G([Y.success,function(){b.selectVIUnit(Q,true);}]);if(P){C.copy(mstrmojo.DocDataService.SUPPRESS_DATA,S);}if(a){C.copy(mstrmojo.DocDataService.REQUEST_DEFN_DATA,S);}K(this).execute({execute:W,urInfo:{silent:R.silent,callback:Y,redo:R.redo,undo:R.undo}});},getProperties:mstrmojo.emptyFn,getSetPropertiesAction:A,updateAfterPropertiesChange:function(P,Q,O,R){this.updateAfterAction(A.call(this),P,Q,O,R);},setProperty:function(V,R,T){var P=T.callback,Q=!!T.suppressData,X=T.requestDefinition,S=T.clientUndoRedoCallback,W=this.getProperties(),O=W[V],U;if(V===I.COLOR_SQUARE_COLOR){if(this.colorSqureIdentity){this.updateColorMap(this.colorSqureIdentity.comb,R);}}else{if(W&&(W[V]===undefined||W[V].toString()!==R.toString())){W[V]=R;U=F.call(this,V,R,O,S);this.updateAfterPropertiesChange(P,Q,X,U);}}},showData:function(O){if(!this.gridData){this.gridData=this.model.data;}mstrmojo.vi.ui.ViewDataDialog.open(this.parent,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.gm.DndTooltip","mstrmojo.VisUtility","mstrmojo.vi.models.EnumDragSources");var N=mstrmojo,I=N.dom,K=N.VisUtility,C=N.vi.models.EnumDragSources,J=N.array;mstrmojo.gm._SupportDndAsBlackBox=mstrmojo.provide("mstrmojo.gm._SupportDndAsBlackBox",{_mixinName:"mstrmojo.gm._SupportDndAsBlackBox",mainContainerNode:"domNode",handleDndForParentNode:true,dndAsBlackBox:true,allowDrop:function H(R){var S=R.src.data,Q=S&&S.src;if(Q===C.DATASETS||Q===C.VIZ_EDITOR||Q===C.VIZ||Q===C.ALL_OBJECT_LIST){return true;}return false;},cleanUpAfterTarget:function E(Q){this._super(Q);if(this.domNode.contains(this.dndHighlightCanvas)){this.domNode.removeChild(this.dndHighlightCanvas);}delete this.dndHighlightCanvas;if(this.dndTooltip){this.dndTooltip.destroy();}delete this.dndTooltip;},ondragenter:function M(R){if(this._super){this._super(R);}var W=this.isEmpty();if(W){R.tgt.widget=this;this.raiseEvent({name:"toggleCtrlOverlay",visible:false,controls:this.getVisEmptyMsgControls()});}var V;if(!this.dndHighlightCanvas){var Q=document.createElement("canvas"),U=I.position(this.domNode),T=I.position(this[this.mainContainerNode]);this.domNode.appendChild(Q);Q.style.position="absolute";Q.style.zIndex=1000;Q.width=T.w||U.w;Q.height=T.h||U.h;Q.style.top=(T.y-U.y)+"px";Q.style.left=(T.x-U.x)+"px";this.dndHighlightCanvas=Q;}if(!this.dndTooltip){V=document.createElement("div");document.body.appendChild(V);var S={placeholder:V,contentNodeCssClass:"gm-dnd-replace-node-tooltip",boundary:document.body};this.dndTooltip=new mstrmojo.gm.DndTooltip(S);this.dndTooltip.render();this.dndTooltip.parent=this;}this.ondragover(R);},ondragover:function B(Q){if(this._super){this._super(Q);}if(this.dndAsBlackBox){this.clearHighlightDropZoneOnGraph();this.drawBlackBoxHighlight(Q);}},ondragleave:function P(Q){var R=this.isEmpty();if(R){this.raiseEvent({name:"toggleCtrlOverlay",visible:true,controls:this.getVisEmptyMsgControls()});}if(this._super){this._super(Q);}},ondrop:function L(R){if(this._super){this._super(R);}if(this.dndAsBlackBox){var U=this.zonesModel,T=R.src.data,Q=T.items,S=R.getCtxtDragData().src;U.addUnitsFromDataSource(Q,T.dsid,R.actions,S===C.ALL_OBJECT_LIST?R.callback:null);}},clearHighlightDropZoneOnGraph:function G(){var R=this.dndHighlightCanvas,Q=R.getContext("2d");Q.clearRect(0,0,R.width,R.height);this.dndTooltip.toggle(false);},isMetric:function O(Q){return Q&&Q.t===4;},isAttrCategory:function D(Q){return Q&&(Q.t===12||Q.t===1||Q.t===47);},singleTypeObject:function F(Q){var T=0,S=0,R=this;J.forEach(Q.src.data.items,function(U){if(R.isAttrCategory(U)){T++;}else{if(R.isMetric(U)){S++;}}});return !(T>0&&S>0);},drawBlackBoxHighlight:function A(S){var T=this.dndHighlightCanvas,a=T.getContext("2d"),X=I.position(this[this.mainContainerNode]),Q=I.position(this.domNode),R=X.w||Q.w,Z=X.h||Q.h,W=Math.min(30,0.25*R),b=Math.min(30,0.25*Z);a.save();a.beginPath();a.rect(W,b,R-2*W,Z-2*b);a.fillStyle="#bce8ff";a.globalAlpha=0.4;a.fill();a.strokeStyle="#34abeb";a.globalAlpha=1;K.drawDashLine(a,W,b,W,Z-b,2,2);K.drawDashLine(a,W,b,R-W,b,2,2);K.drawDashLine(a,R-W,b,R-W,Z-b,2,2);K.drawDashLine(a,W,Z-b,R-W,Z-b,2,2);a.restore();if(!this.singleTypeObject(S)){var U=this.dndTooltip,Y={x:S.tgt.e.x,y:S.tgt.e.y,w:0,h:0},V=S.src.widget.avatar;if(V){Y=I.position(V);}U.placementOrder=[U.PLACEMENT_ABOVE];U.popupNodeOffset=5;U.updateContent(null,Y,"Add Attributes and Metrics");}}});}());(function(){var x=false,D=function(Au){if(x){AK.visPrint(Au);}};mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Base","mstrmojo.dom","mstrmojo.Container","mstrmojo.hash","mstrmojo.array","mstrmojo.netviz.VisNetworkStageScaleBar","mstrmojo.css","mstrmojo.netviz.ObservableModel","mstrmojo._HasPopup","mstrmojo.netviz._HasNetworkContextMenu","mstrmojo.VisEnum","mstrmojo.VisTooltip","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.chart.enums.EnumLineStyle","mstrmojo.ui.PopupConfig","mstrmojo.VisUtility","mstrmojo.gm.GMUtility","mstrmojo.util.ui._LassoSelector","mstrmojo.netviz.Bitmap","mstrmojo.util.color","mstrmojo.ui.menus.MenuConfig");var AY=mstrmojo.dom,AP=AY.position,Aa=mstrmojo.VisEnum.NETWORK_DRAG_MODE,AR=mstrmojo.netviz.ObservableModel,Ak=mstrmojo.css,N=mstrmojo.hash,J=mstrmojo.array,Q=mstrmojo.VisEnum,AK=mstrmojo.VisUtility,AQ=mstrmojo.gm.GMUtility,g=mstrmojo.util.color,F=mstrmojo.color;var Aj=Q.NETWORK_LOCAL_PROPS,X=Q.FormNameDisplayType,j=Q.NETWORK_FORCE_DIRECTED_LAYOUT_EDGE_CURVATURE,AZ=mstrmojo.chart.enums.EnumFontStyle,e=Q.NETWORK_LAYOUT;var O=["Select","Swipe","Multi","Tap",""],AE=["Begin","End","Move","Cancel",""];var An=["click","dblclick","drage","dragend","dragenter","dragleave","dragover","dragstart","drop","mousedown","mousemove","mouseup","mouseout","mouseover","mousewheel","scroll","contextmenu"];var p=["mousemove","mouseup"];var Ag=[];J.forEach(O,function(Au){J.forEach(AE,function(Av){Ag.push("touch"+Au+Av);});});var Ac=5*1000;var f=6;var V=40*Math.PI/180;var Z=3,k=30*Math.PI/180,M=Math.pow(Z,2)+1-2*Math.cos(k)*Z,AG=Math.cos(k)*Z,AV=Math.sin(k)*Z;var AL=500;var AI=26,At=5,Af=25,T=350,AM={EDGE:0,CIRCLE:1,HIGHLIGHT:2},Ad={BASE:0,HIGHLIGHT:1};var AD={fontFamily:"Helvetica",fontSize:AK.psPt2CssPt("12pt",Math.round),fontStyle:AZ.FS_BOLD},w=4,R=3,Ai=5;(function(){var Ax=["ms","moz","webkit","o"],Aw=0,Av,Au=Ax.length;for(Av=0;Av<Au&&!window.requestAnimationFrame;Av+=1){window.requestAnimationFrame=window[Ax[Av]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[Ax[Av]+"CancelAnimationFrame"]||window[Ax[Av]+"CancelRequestAnimationFrame"];}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(A1){var A0=new Date().getTime(),Ay=16-(A0-Aw),Az;if(Ay<0){Aw=A0;Az=0;}else{Az=Ay;}return setTimeout(function(){A1(Aw);},Az);};}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=clearTimeout;}}());function AW(Ax,Ay){if(typeof Ax!=="object"){return ;}var Aw=Object.keys(Ax),Av,Au;for(Av=0,Au=Aw.length;Av<Au;Av++){Ay(Aw[Av]);}}function Al(Au){var Av=[];if(Au&AZ.FS_BOLD){Av.push("bold");}if(Au&AZ.FS_ITALIC){Av.push("italic");}return Av.join(" ");}function S(Au){return[Al(Au.fontStyle),Au.fontSize,Au.fontFamily].join(" ");}function s(Au){var Av=[];if(Au&AZ.FS_UNDERLINE){Av.push("underline");}if(Au&AZ.FS_STRIKETHROUGH){Av.push("line-through");}return Av.join(" ");}var H=(function(){var Au={},Av=new RegExp("(\\d+)(p[xt])","i");return function Aw(Ay){var Ax,A0,Az;if(Au.hasOwnProperty(Ay)){return Au[Ay];}Ax=Av.exec(Ay);if(!Ax){return ;}A0=parseInt(Ax[1],10);Az=Ax[2].toLowerCase();if(Az==="pt"){A0*=96/72;}A0=Math.ceil(A0);Au[Ay]=A0;return A0;};}());function AN(Av,A0){if(A0 instanceof Object){var Ay=Object.keys(A0),Au=Ay.length,Ax,Aw,Az;for(Ax=0;Ax<Au;Ax++){Aw=Ay[Ax];Az=A0[Aw];if(!(Az instanceof Object)){Av[Aw]=Az;}else{if(!Av[Aw]){Av[Aw]={};}AN(Av[Aw],Az);}}}return Av;}function A(Av){var Au=arguments.length,Aw,Ax;Av=N.clone(Av||{});for(Aw=1;Aw<Au;Aw++){Ax=arguments[Aw];if(Ax instanceof Object){AN(Av,Ax);}}return Av;}function Ap(Av){var Au;if(Av.which===undefined||Av.which===null){Au=(Av.button<2)?0:((Av.button===4)?1:2);}else{Au=(Av.which<2)?0:((Av.which===2)?1:2);}return Au;}function B(Au){var Av=Au._delayHideTimerId;if(Av){clearTimeout(Av);delete Au._delayHideTimerId;}}function G(Au){B(Au);Au._delayHideTimerId=setTimeout(function(){Au.toggle(false);delete this._isTooltipShown;},Ac);}function L(Av){var Ax=[],Au,Aw;Av=Av||[];for(Aw=0,Au=Av.length;Aw!==Au;Aw++){Ax.push(Aw);}return Ax;}function r(A0){var Au=mstrmojo.ui.PopupConfig.ENUM_CORNERS,A2={pageX:A0.pageX,pageY:A0.pageY-6},Aw=this,Av=Aw.owner;Av.closePopup();var Ay="";if(Aw.selectedSprites[Aw.selectedSprites.length-1].attSrc==="to"){Ay="to";}else{Ay="from";}Aw.showContextMenu("bubble",Aw.observableModel,A2,{alignment:{host:Au.TOP_LEFT,popup:Au.BOTTOM_LEFT,attSrc:Ay}});var A1=Aw._lastOpened;Av.showMenu(Aw.owner.getFormatMenuConfig(),A0);var Ax=Av._lastOpened,Az=Ax._unlockHoverCheck;Ax._unlockHoverCheck=function(A4,A3){if(!AY.contains(A1.domNode,AY.eventTarget(A3,A4),true)){Ax._unlockHoverCheck=Az;Ax._unlockHoverCheck(A4,A3);}};}function c(Av,A1,A0,Az){var Ax,Aw,Au,Ay;if(isNaN(Av)||Av<0||Av>1){return{x:NaN,y:NaN};}Ax=1-Av;Au=Ax*Ax;Aw=Av*Av;Ay=2*Ax*Av;return{x:Au*A1.x+Ay*A0.x+Aw*Az.x,y:Au*A1.y+Ay*A0.y+Aw*Az.y};}var Am=mstrmojo.chart.enums.EnumLineStyle;function t(Au){var Ax=1,Aw=Am.LS_SOLID;if(Au){if(Au==="none"){Aw=Am.LS_NONE;}else{var Av=parseInt(Au,10);if(!isNaN(Av)){Ax=Av;}if(/dotted/.test(Au)){Aw=Am.LS_DOT;}else{if(/dashed/.test(Au)){Aw=Am.LS_DASH;}else{if(/solid/.test(Au)){Aw=Am.LS_SOLID;}}}}}return{ceLnStyle:Aw,thk:Ax};}var I=mstrmojo.declare(mstrmojo.Base,[],{scriptClass:"mstrmojo.netviz.VisNetworkStage.Sprite",init:function(Ay){this.zIndex=0;this.selectionState={};this.geometry={x:0,y:0,s:0};this.record();if(this._super){this._super(Ay);}var Au=this.stage,Aw=this,Av=An;var Ax=function(A1){var Az=A1.layerX,A2=A1.layerY,A0=A1.name;if(!Au.transitionTimer&&!Au.eventHasBeenHandled&&this["on"+A0]&&(p.indexOf(A0)!==-1||Aw.isHit(Az,A2))&&!this.isExcluded){Aw["on"+A0](A1);}};J.forEach(Av,function(Az){Au.attachEventListenerForSprites(Az,Aw,Ax);});},updateZIndex:function(){var Az=this.stage&&this.stage.layers&&this.stage.layers[this.layerIndex];if(!(Az instanceof Array&&Az.length>0)){return ;}var Au=Az.length,Ay=this.type,Aw,Av,Ax;for(Aw=0;Aw<Au;Aw++){Ax=Az[Aw];if(Ax.type===Ay){if(Ax!==this){Av=Az.indexOf(this);this.zIndex=Ax.zIndex+1;Ax.zIndex=Az[Aw-1]?Az[Aw-1]-1:0;Az[Av]=Ax;Az[Aw]=this;this.stylesChanged();}break;}}},stopPropagation:function(){this.stage.eventHasBeenHandled=true;},draw:function(){this.record();},record:function(){var Au=this.getGeometry();this.oldGeometry=N.clone(Au);},drawStage:function(Au,Av){this.stage.draw(Au,Av);},stylesChanged:function(){this.hasStyleChanged=true;var Au=this.stage;if(Au){if(Au.onSpriteStyleChange&&Au.hasRendered){Au.onSpriteStyleChange(this.layerIndex);}}},highlight:function(){this.stage.addSpriteToLayer(this,AM.HIGHLIGHT);},unHighlight:function(){var Au=this.selectionState;if(!Au.selected&&!Au.hovered){this.stage.removeSpriteFromLayer(this,AM.HIGHLIGHT);var Av=this.type==="Circle"?AM.CIRCLE:AM.EDGE;this.stage.addSpriteToLayer(this,Av);}},showTooltip:function(Au){var Av=this.stage.tooltip;if(!this._isTooltipShown){this._isTooltipShown=true;Av.displayInfo(this.getTooltipInfo(),Au);}else{Av.moveTo(Au.x,Au.y);}Av.toggle(true);G(Av);},hideTooltip:function(){var Au=this.stage.tooltip;B(Au);Au.toggle(false);delete this._isTooltipShown;}});var U={normal:{color:{value:2212863,opacity:0.8},border:{color:{value:8487297,opacity:0.8},width:3,style:"2pt solid"}},hovered:{color:{opacity:0.5},highlightBorder:{color:{value:16777215,opacity:1},width:2,distance:3}},selected:{color:{opacity:1},selectionBorders:{inner:{color:{value:0,opacity:1},width:1},outer:{color:{value:16777215,opacity:1},width:2}}}};var Ao={normal:{color:{value:2062260,opacity:0.7},border:{color:{value:2062260,opacity:1},width:3,style:"1pt solid"}},hovered:{color:{opacity:0.35},fromNode:{color:{opacity:0.35}},toNode:{color:{opacity:0.35}},highlightBorder:{color:{value:0,opacity:1},width:2,distance:3}},selected:{color:{opacity:1},fromNode:{color:{opacity:1}},toNode:{color:{opacity:1}},selectionBorders:{inner:{color:{value:16777215,opacity:1},width:1},outer:{color:{value:0,opacity:1},width:2}}},selectedHovered:{color:{opacity:0.7},fromNode:{color:{opacity:0.7}},toNode:{color:{opacity:0.7}}}};function Ae(Av,Au,Az,Ax,Ay,Aw){Av.arc(Au,Az,Ax,Ay,Aw);}function C(Av,Au,Ax,Aw){Av.rect(Au-Math.sqrt(2)*Aw/2,Ax-Math.sqrt(2)*Aw/2,Math.sqrt(2)*Aw,Math.sqrt(2)*Aw);}function AJ(Av,Au,Ax,Aw){Av.moveTo(Au,Ax-Aw);Av.lineTo(Au+Aw,Ax);Av.lineTo(Au,Ax+Aw);Av.lineTo(Au-Aw,Ax);Av.lineTo(Au,Ax-Aw);}function Ab(Av,Au,Ax,Aw){Av.moveTo(Au,Ax-Aw);Av.lineTo(Au+Aw*Math.sqrt(3)/2,Ax-Aw/2);Av.lineTo(Au+Aw*Math.sqrt(3)/2,Ax+Aw/2);Av.lineTo(Au,Ax+Aw);Av.lineTo(Au-Aw*Math.sqrt(3)/2,Ax+Aw/2);Av.lineTo(Au-Aw*Math.sqrt(3)/2,Ax-Aw/2);Av.lineTo(Au,Ax-Aw);}function m(Av,Au,Ax,Aw){Av.moveTo(Au,Ax-Aw);Av.lineTo(Au+Aw*Math.sqrt(3)/2,Ax+Aw/2);Av.lineTo(Au-Aw*Math.sqrt(3)/2,Ax+Aw/2);Av.lineTo(Au,Ax-Aw);}var b={Circle:Ae,Square:C,Diamond:AJ,Hexagon:Ab,Triangle:m,Ring:Ae};function v(A7,A1,Az,A3,BA,BJ){if(!A7||!A3){return A3;}BA=BA||{color:{value:0,opacity:1},width:1};var BH=Am.LS_SOLID,Av=BA.distance||0;if(BA.style){var Ax=t(BA.style);BH=Ax.ceLnStyle;BA.width=Ax.thk+1;}A3+=Av;var A2=BA.width,A5=BA.color,BG=g.getCSSColorString(A5.value,A5.opacity);if(BH===Am.LS_NONE){return A3;}A7.save();var BI=A3+A2*0.5,BF=Math.PI*2;A7.strokeStyle=BG;A7.lineWidth=A2;A7.beginPath();if(BH===Am.LS_SOLID){b[BJ](A7,A1,Az,BI,0,BF,true);}else{var A0=BH===Am.LS_DASH?0.5:0.2;var A6=BI/A0,Aw=Math.PI*2/A6,A9=[],A8=-1,Ay,A4,BD=(Math.cos(Aw)*BI)+A1,Au=(Math.sin(Aw)*BI)+Az,BE=(Math.cos(2*Aw)*BI)+A1,BC=(Math.sin(2*Aw)*BI)+Az,BB=Math.sqrt(Math.pow(BD-BE,2)+Math.pow(Au-BC,2));if(BJ==="Ring"||BJ==="Circle"){while(A8<A6){Ay=Aw*A8;A4=Aw*(A8+1);A9.push({x:(Math.cos(Ay)*BI)+A1,y:(Math.sin(Ay)*BI)+Az,ex:(Math.cos(A4)*BI)+A1,ey:(Math.sin(A4)*BI)+Az});A8+=2;}J.forEach(A9,function(BK){A7.moveTo(BK.x,BK.y);A7.lineTo(BK.ex,BK.ey);});}else{A7.setLineDash([BB,BB]);A7.lineWidth=2;b[BJ](A7,A1,Az,A3);}}A7.stroke();A7.closePath();A7.restore();return A3+A2;}function AU(A3,Aw,Az,A0,Ax){var A2=Az.x,A1=Az.y,Au=0,Av=0,Ay=Aw.value;if(g.isGradientColor(Ay)){Au=Ay.or;Av=1-Au;}A3.save();A3.fillStyle=g.createCanvasFillPattern(Aw,A3,A2-A0*Au,A1-A0*Av,A2+A0*Au,A1+A0*Av);A3.beginPath();if(Ax==="Ring"){A3.lineWidth=A0*0.3;A3.strokeStyle=A3.fillStyle;Ae(A3,Az.x,Az.y,A0*0.85,0,2*Math.PI,true);A3.stroke();}else{b[Ax](A3,Az.x,Az.y,A0,0,2*Math.PI,true);}A3.closePath();if(Ax!=="Ring"){A3.fill();}A3.restore();}var W={dark:U,light:Ao},Ar={dark:{stroke:{value:"#1f1f1f",opacity:1},fill:{value:"#ffffff",opacity:1}},light:{stroke:{value:"#ffffff",opacity:1},fill:{value:"#000000",opacity:1}}};var AS=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.VisNetworkStage.CircleSprite",init:function(Au){this.position={x:0,y:0,r:0};this.style=null;if(this._super){this._super(Au);}var Av=this.position;Av.x=isNaN(Av.x)||Math.abs(Av.x)===Infinity?0:Av.x;Av.y=isNaN(Av.y)||Math.abs(Av.y)===Infinity?0:Av.y;Av.r=isNaN(Av.r)||Math.abs(Av.r)===Infinity?0:Av.r;this.updateTextSize();},getTooltipInfo:function(){var Au=this.getTooltipAttrInfo();if(this.aggregationName){Au.push({n:this.aggregationName,v:this.displayValue});}return Au;},getTooltipAttrInfo:function(Aw){var Av=this.stage.owner.abstractedModel.formNameDisplayType,Au=this.forms,Az=this.formValues,Ay=Aw||this.title,Ax;if(Av===X.OFF||this.selfLoop){Ax=[{n:Ay,v:this.text}];}else{Ax=Au.map(function(A1,A0){return{n:A1,v:Az[A0]};});}return Ax;},onclick:function(){this.stopPropagation();},onmousedown:function(Av){Av=Av.e||Av;var Ax=Av.srcElement||Av.target,Aw=this.stage,Au=Aw&&Aw.lassoSelector;this.stopPropagation();if(!(Ap(Av)===2&&Ax===Au)){this.stage.dismissLassoSelector();}if(Aw.dragMode===Aa.select){Aw.lassoSelectorEnabled=false;}this._isMouseDown=true;this._selectionState=N.clone(this.selectionState);this._lastMousePosition={x:Av.pageX,y:Av.pageY};},onmousemove:function(A2){var Ax,A1,Az;var A5=A2.layerX,A4=A2.layerY,Av=this.stage,Aw=false;A2=A2.e||A2;if(this._isMouseDown&&Ap(window.event||A2)===0){var A0=this._lastMousePosition,A9=A2.pageX-A0.x,A6=A2.pageY-A0.y;this._lastMousePosition={x:A2.pageX,y:A2.pageY};this.stopPropagation();if(A9!==0||A6!==0){if(!this._dragged){Av.onSpriteStyleChange(AM.EDGE);Av.onSpriteStyleChange(AM.CIRCLE);}this._dragged=true;if(!this.selectionState.selected){if(!(A2.ctrlKey||A2.metaKey)){Av.clearSelection();}Av.addToSelection(this);Aw=true;Av.owner.doSelection();}var A8=this.stage.selectedSprites,Ay=this.stage.currentLayout;J.forEach(A8,function(BA){Az=BA.getGeometry();Az.x+=A9;Az.y+=A6;BA.setGeometry(Az);if(Ay===e.LINEAR||Ay===e.FORCE_DIRECTED){J.forEach(BA.unit.edges,function(BC){var BB=BC.from.sprite.getGeometry(),BD=BC.to.sprite.getGeometry(),BF,BE;if(Ay===e.LINEAR){BE={x:(BB.x+BD.x)*0.5-(BD.y-BB.y)*0.5,y:(BB.y+BD.y)*0.5+(BD.x-BB.x)*0.5};}else{if(Ay===e.FORCE_DIRECTED){BF=j[BC.reversedEdge?1:0];BE={x:(BB.x+BD.x)*0.5+(BB.y-BD.y)*BF,y:(BB.y+BD.y)*0.5+(BD.x-BB.x)*BF};}}BC.sprite.setGeometry(BE);});}});this.drawStage(false,Aw);}}else{var A3,A7,Au=this.isHit(A5,A4);if(Au){this.stopPropagation();}if(this._hoverHighlighted){if(!Au){A3=this.getInvolvedSprites();A1=A3.length;for(Ax=0;Ax<A1;Ax++){A7=A3[Ax];A3[Ax].unHoverHighlight();}delete this._hoverHighlighted;this.hideTooltip();if(Av._pendingRefresh){Av.onSpriteStyleChange(AM.CIRCLE);Av.onSpriteStyleChange(AM.EDGE);}Aw=true;if(Av._pendingRefresh){delete Av._pendingRefresh;}}}else{if(Au){A3=this.getInvolvedSprites();A1=A3.length;for(Ax=0;Ax<A1;Ax++){A7=A3[Ax];A7.hoverHighlight();}this._hoverHighlighted=true;Aw=true;}}if(Av.selectedSprites.length>0){Av.onSpriteStyleChange(AM.HIGHLIGHT);}this.drawStage(false,Aw);}if(this._hoverHighlighted){this.showTooltip({x:A2.clientX,y:A2.clientY});}},onmouseup:function(Au){var Av=this.stage;Au=Au.e||Au;if(this._isMouseDown){this.stopPropagation();if(!this._dragged){if(Au.button===0){this.clickHandler(Au);}}Av._bubbleToolbarPos=Au;Av._pendingRefresh=true;delete this._selectionState;delete this._isMouseDown;delete this._lastMousePosition;delete this._dragged;}},clickHandler:function(Ay,Aw){Ay=Ay.e||Ay;var Ax=this.selectionState.selected,A0=Ay.ctrlKey||Ay.metaKey,Az=this.stage,Au=Az.selectedSprites.length>1,Av=Az.isClearAllEnabled(this);if(Ax&&!Au){if(!Aw&&Av){Az.clearSelection();}}if((Ax&&!A0&&Au&&!Aw)||(!Ax&&!A0)){Az.clearSelection();Az.addToSelection(this);}if(!Ax&&A0){Az.addToSelection(this);}if(Ax&&A0&&Au){if(!Aw){Az.removeFromSelection(this);}}this.drawStage(false,true);Az.owner.doSelection();},oncontextmenu:function AO(Av){var Ax=this.stage,Au=Ax.owner,Aw=Av.e||Av;Av.preventDefault();Av.cancel();this.stopPropagation();this.clickHandler(Aw,true);if(this._isMouseDown){delete this._selectionState;delete this._isMouseDown;delete this._lastMousePosition;delete this._dragged;}if(Ax.isOnFormattingMode){r.call(Ax,Aw);}else{Au.showSelectionMenu(Aw,function(){r.call(Ax,Aw);AK.selectPropertyPanel(Au,"de");});}this.hideTooltip();return false;},getInvolvedSprites:function(){var Aw=[],Az;Aw.push(this);var Ay=this.unit;if(Ay){var Av=Ay.edges,Au=Av.length,Ax;for(Ax=0;Ax<Au;Ax++){Az=Av[Ax];Aw.push(Az.sprite);if(Az.from===Ay){Aw.push(Az.to.sprite);}else{Aw.push(Az.from.sprite);}}}return Aw;},touchSwipeMove:function(Ax){var Au=Ax.layerX,Aw=Ax.layerY,Av=this.getGeometry();Av.x=Au;Av.y=Aw;this.setGeometry(Av);this.drawStage(false);},hoverHighlight:function(){if(!this.selectionState.hovered){this.selectionState.hovered=true;this.highlight();}},unHoverHighlight:function(){if(this.selectionState.hovered){this.selectionState.hovered=false;this.unHighlight();}},getStyle:function(){var Aw=this.selectionState,Au=this.stage,Av=this.stage.themeType==="dark"?Au.circleStyle.dark:Au.circleStyle.light;return A(Av.normal,Aw.hovered&&Av.hovered,Aw.selected&&Av.selected,Aw.hovered&&Aw.selected&&Av.selectedHovered);},getLabelBoundingBox:function(){var A3=this.textSize,Aw=this.stage,Ax=(Aw.currentLayout===e.LINEAR),Au=this.position,A1=Au.x,A0=Au.y,A2,Az,Ay,Av;if(Ax){A2=A3.height;Az=A3.width;}else{A2=A3.width;Az=A3.height;}Ay=(A2+Ai)/2;Av=(Az+Ai)/2;return{top:A0-Av,left:A1-Ay,bottom:A0+Av,right:A1+Ay};},isShowLabel:function AB(){var Az=this.stage,Aw=Az.circleStyle.showNodeLabel||(this.selectionState.hovered&&!this._hoverHighlighted),Au=!Az.transitionTimer&&Aw,Ax=this.getLabelBoundingBox(),Ay=Az.labelBitmap,Av;if(Au){Av=Ay&&Ay.testZeros(Ax);if(Av){Ay.set(Ax);}}return Au&&Av;},draw:function Ae(Ay,A0){if(this.isExcluded){return ;}this._super();var A1=this.stage,Ax=this.getCanvas(),A5=A1.background;if(!Ax){D("cannot find the corresponding canvas.");return ;}var A6=Ax.getContext("2d"),Aw=this.position,Au=Aw.r>1?Aw.r:1,Av=this.getStyle(),A3;var Az,A2=[];function A4(A7){Az=Av[A7+"Node"].shape;A3=Av[A7+"Node"].color;if(!Av.selectionBorders){A2.push(Av[A7+"Node"].border);}return A2;}A2=A4(A0);if(Ay){A3=g.mix(A3,A5);}AU(A6,A3,Aw,Au,Az);if(Av.selectionBorders){A2.push(Av.selectionBorders.inner);A2.push(Av.selectionBorders.outer);}if(Av.highlightBorder){A2.push(Av.highlightBorder);}J.forEach(A2,function(A7){if(Ay){A7.color=g.mix(A7.color,A5);}Au=v(A6,Aw.x,Aw.y,Au,A7,Az);});if(A1.onDraw){A1.onDraw(this);}this.drawText();},drawText:function(){function A1(A5,A3,A9){function A6(BB,BF,BC){var BE=BF.x,BD=BF.y,BA=A3&AZ.FS_BOLD?2:1;BB.save();BB.lineWidth=1;BB.strokeRect(BE-1,BD-1,BC+2,BA+2);BB.fillRect(BE,BD,BC,BA);BB.restore();}var A7=this.textSize,A4=A7.width,A8=A9.x-A4/2;if(A3&AZ.FS_UNDERLINE){A6(A5,{x:A8,y:A9.y+A7.height/2},A4);}if(A3&AZ.FS_STRIKETHROUGH){A6(A5,{x:A8,y:A9.y},A4);}}var Ay=this.stage,Av=this.getCanvas(),A2=Av.getContext("2d"),Au=this.position,A0=Au,Az=this.stage.circleLabelStyle,Ax=Az.fontColor,Aw=Az.fontStyle;if(!this.isShowLabel()){this.hasDrawnLabel=false;return ;}A2.save();A2.font=S(Az);A2.lineWidth=w;A2.fillStyle=g.getCSSColorString(Ax.fill.value,Ax.fill.opacity);A2.strokeStyle=g.getCSSColorString(Ax.stroke.value,Ax.stroke.opacity);A2.lineJoin="round";A2.textBaseline="middle";A2.textAlign="center";if(Ay.currentLayout===e.LINEAR){A2.translate(Au.x,Au.y);A2.rotate(-Math.PI/2);A0={x:0,y:0};}A2.strokeText(this.text,A0.x,A0.y);A2.fillText(this.text,A0.x,A0.y);A1.call(this,A2,Aw,A0);A2.restore();this.hasDrawnLabel=true;},isHit:function(Au,A0){var Ay=this.position,Aw=Ay.x-Au,Av=Ay.y-A0,Ax=Ay.r,Az=Aw*Aw+Av*Av;return(Az<=Ax*Ax);},setGeometry:function(Ay){if(Ay){var Au=Ay.x,A0=Ay.y,Aw=Ay.s,Ax=this.position,Az=false,Av;if(!isNaN(Au)&&Math.abs(Au)!==Infinity){if(Au!==Ax.x){Az=true;Ax.x=Au;}}if(!isNaN(A0)&&Math.abs(A0)!==Infinity){if(A0!==Ax.y){Az=true;Ax.y=A0;}}if(!isNaN(Aw)&&Math.abs(Aw)!==Infinity){if(Aw!==Ax.r){Az=true;Ax.r=Aw;}}if(Az){this.stylesChanged();Av=this.unit&&this.unit.edges;J.forEach(Av,function(A1){A1=A1.sprite;A1.stylesChanged(true);});}}},getGeometry:function(){var Av=this.position,Au=this.geometry;Au.x=Av.x;Au.y=Av.y;Au.s=Av.r;return Au;},getBorderWidth:function(){var Aw,Au,Ay=this.getStyle(),Az=[],Av,Ax=0;if(Ay.selectionBorders){Az.push(Ay.selectionBorders.inner);Az.push(Ay.selectionBorders.outer);}else{if(AK.getPropertyByPath(Ay,"fromNode.border",false)===false&&AK.getPropertyByPath(Ay,"toNode.border",false)===false){Az.push(Ay.border);}else{Az.push(Ay.fromNode.border);Az.push(Ay.toNode.border);}}for(Aw=0,Au=Az.length;Aw!==Au;Aw++){Ay=Az[Aw];if(Ay.style){Av=t(Ay.style);Ax+=Av.thk+1;}else{Ax+=Ay.width||1;}}return Ax;},updateTextSize:function(){var Au=this.text,Aw=this.stage.circleLabelStyle,Ax=H(Aw.fontSize),Av=AK.measureTextWidth(Au,{fontSize:Aw.fontSize,fontFamily:Aw.fontFamily,fontStyle:Al(Aw.fontStyle)},R);this.textSize={width:Av,height:Ax};}});var E={hovered:"white"};var a={hovered:"black"};function AA(Ax){var Ay=Ax.start,Au=Ax.end,Av,Aw=false;if(Ay>Au){Av=Ay;Ay=Au;Au=Av;Aw=!Aw;}if(Ay<=Math.PI&&Au>Ay+Math.PI){Av=Ay;Ay=Au;Au=Av;Aw=!Aw;}if(Aw){Av=Ax.p1;Ax.p1=Ax.p2;Ax.p2=Av;}Ax.start=Ay;Ax.end=Au;}function Y(Au,Ay){var Aw=Ay.x-Au.x,Av=Ay.y-Au.y,Ax=Math.acos(Aw/Math.sqrt(Aw*Aw+Av*Av));if(Av>=0){return Ax;}return 2*Math.PI-Ax;}function d(BE,A6,A0,A1,A8){var Aw=AK.isNearZero,BC=A8/2,BA=A1*Math.cos(BC)+Math.sqrt(A0*A0-A1*A1*Math.pow(Math.sin(BC),2)),A4=A6.x-BE.x,A3=A6.y-BE.y,A9,Ay,Ax,BD,Az,BB,A7,A5,A2,Av,Au;A9=Math.sqrt(A4*A4+A3*A3);Ay=A4*BA/A9;Ax=A3*BA/A9;Az=Math.acos((A0*A0+BA*BA-A1*A1)/(2*A0*BA));BB=Ax/BA;if(Aw(Math.abs(Ax)-Math.abs(BA))){if(Ax<0){BB=-1;}else{if(Ax>0){BB=1;}}}BB=Math.asin(BB);A7=BB+Az;A5=BB-Az;A2=A4/Math.abs(A4);BD={x:A6.x+Ay,y:A6.y+Ax};if(isNaN(A2)){Av={x:A6.x+A0*Math.cos(A7),y:A6.y+A0*Math.sin(A7)};Au={x:A6.x+A0*Math.cos(A5),y:A6.y+A0*Math.sin(A5)};}else{Av={x:A6.x+A0*Math.abs(Math.cos(A7))*A2,y:A6.y+A0*Math.sin(A7)};Au={x:A6.x+A0*Math.abs(Math.cos(A5))*A2,y:A6.y+A0*Math.sin(A5)};}return{center:BD,p1:Av,p2:Au};}function u(){var A4=this,A2=this.stage,A0=A2.currentLayout,Aw=A4.from.position,Ay;var Ax=A4.width>1?A4.width:1,Au=Aw.r+A4.from.getBorderWidth()/2,A5=f+Ax/2;if(A0===e.CIRCULAR){Ay=A2.graphCenter;}else{if(A0===e.FORCE_DIRECTED){Ay=A2.findForceDirectedGraphCenter(A4.from);}else{Ay=A2.findLinearLayoutGraphCenter(A4.from);}}var A3=d(Ay,Aw,Au,A5,V);var Av=Y(A3.center,A3.p1);var Az=Y(A3.center,A3.p2);var A1=A3;A1.start=Av;A1.end=Az;A1.r=A5;AA(A1);return A1;}function l(A1){var Av=this,Az=u.call(Av),A3,A2,A0,Au=Az.start,Ax=Az.end,Ay=Math.max(Av.width,1),Aw;if(isNaN(Az.center.x)||isNaN(Az.center.y)){return false;}A3=A1.x-Az.center.x;A2=A1.y-Az.center.y;A0=Math.sqrt(A3*A3+A2*A2)-f;if(A0<0||A0>Ay){return false;}Aw=Y(Az.center,A1);if(Au<Ax){return Aw<=Au||Aw>=Ax;}if(Au>Ax){return Ax<=Aw&&Aw<=Au;}return true;}function AT(Aw,Av,Au){Au.save();Au.fillStyle=Av;Au.lineWidth=Aw.width;Au.lineJoin="round";Au.lineCap="round";Au.miterLimit=0;Au.beginPath();Au.moveTo(Aw.tip.x,Aw.tip.y);Au.lineTo(Aw.wing1.x,Aw.wing1.y);Au.lineTo(Aw.crossing1.x,Aw.crossing1.y);Au.lineTo(Aw.crossing2.x,Aw.crossing2.y);Au.lineTo(Aw.wing2.x,Aw.wing2.y);Au.closePath();Au.fill();Au.restore();}function y(Au,Az,A0){var A6=Az.x-Au.x,A5=Az.y-Au.y,A1=AK.isNearZero,Ax=A1(A6),Av=A1(A5),Aw,Ay,A2,A4,A3;if(Ax&&Av){return{x:Az.x,y:Az.y};}if(Ax){return{x:Az.x,y:Az.y-(A5>0?A0:-A0)};}if(Av){return{x:Az.x-(A6>0?A0:-A0),y:Az.y};}Ay=A6/A5;Aw=A5>0?-1:1;A2=Math.sqrt(A0*A0/(Ay*Ay+1));A3=Az.y+Aw*A2;A4=Az.x+Ay*(A3-Az.y);return{x:A4,y:A3};}function Aq(A0,Au,Av){var A2=Au.x-A0.x,A1=Au.y-A0.y,Az=AK.isNearZero,Ax=Az(A2),Aw=Az(A1),Ay;if(Ax&&Aw){return{a:Av.y/Av.x,b:-1,c:0};}if(Ax){return{a:0,b:1,c:-Av.y};}if(Aw){return{a:1,b:0,c:-Av.x};}Ay=A2/A1;return{a:-A2,b:-A1,c:(Av.x*Ay+Av.y)*A1};}function K(A1,BM,Au,BD){var BK=A1.a,BJ=A1.b,BH=A1.c,Aw=AK.isNearZero,A8=Aw(BK),Az=Aw(BJ);if(A8||Az){var A0=AG*BD,BI=y(BM,Au,A0),A2=AV*BD;if(A8&&Az){return[{x:Au.x,y:Au.y},{x:Au.x,y:Au.y}];}if(A8){return[{x:BI.x+A2,y:BI.y},{x:BI.x-A2,y:BI.y}];}if(Az){return[{x:BI.x,y:BI.y+A2},{x:BI.x,y:BI.y-A2}];}}var BL=BK*BK,BG=BM.x,Ay=BM.y,BC=Math.sqrt(BK*BK+BJ*BJ),BB=AV*BD*BC,BA=M*BD*BD,A9=BB-BH,A7=BK*BK+BJ*BJ,A6=2*(BG*BK*BJ-BJ*A9-BL*Ay),A5=A9*A9+BL*BG*BG-2*BG*BK*A9+BL*Ay*Ay-BA*BL,A4=Math.sqrt(A6*A6-4*A7*A5),A3=2*A7,Ax=(-A6+A4)/A3,Av=(-A6-A4)/A3,BF=(A9-BJ*Ax)/BK,BE=(A9-BJ*Av)/BK;return[{x:BF,y:Ax},{x:BE,y:Av}];}function i(A1,Av,A0,Aw){var A3=y(A1,Av,A0),A4=y(A1,Av,A0+Aw),A2=Aq(A1,Av,A4),Au=K(A2,A4,A3,Aw),Az=M*Aw/3,Ay=y(A4,Au[0],Az),Ax=y(A4,Au[1],Az);return{tip:A3,inner:A4,wing1:Au[0],wing2:Au[1],crossing1:Ay,crossing2:Ax,width:Aw};}function q(A2,Aw,A1){var Az=A2.x,Ay=A2.y,Av=Aw.x,Au=Aw.y,A0=A1.x,Ax=A1.y;return AK.isNearZero(Az*(Au-Ax)+Av*(Ax-Ay)+A0*(Ay-Au));}var o=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.VisNetworkStage.EdgeSprite",init:function(Au){this.controlPoint={x:0,y:0};if(this._super){this._super(Au);}},getTooltipInfo:function(){function Aw(A3){var A4=A3.unit;return[].concat(A3.from.getTooltipAttrInfo(A2),A3.to.getTooltipAttrInfo(Ax),A4.values.map(function(A5,A6){return{n:A5.metricName,v:A4.format(A5.value,A6)};}));}var Av,Au=this.unit.reversedEdge,Ay=this.stage.currentLayout===e.CIRCULAR,A0=this.stage.owner.abstractedModel||{},A1=A0.indexes,Az=A0.attributes,A2,Ax;if(A1&&Az){A2=(Az[A1.fromIndex]||{}).name;Ax=(Az[A1.toIndex]||{}).name;}Av=Aw(this);if(Ay&&Au){Av=Av.concat(null,Aw(Au.sprite));}return Av;},onmousemove:function(Ax){var Au=Ax.layerX,Az=Ax.layerY,Av=this.isHit(Au,Az),Ay=this.stage,Aw=false;Ax=Ax.e||Ax;if(this.selectionState.hovered&&!Av){this.unHoverHighlight();this.hideTooltip();delete Ay._isEdgeHovered;if(Ay._pendingRefresh){Ay.onSpriteStyleChange(AM.CIRCLE);Ay.onSpriteStyleChange(AM.EDGE);}Aw=true;}else{if(!this.selectionState.hovered&&Av){this.stopPropagation();this.hoverHighlight();Ay._isEdgeHovered=true;Aw=true;}}if(Aw){if(Ay.selectedSprites.length>0){Ay.onSpriteStyleChange(AM.HIGHLIGHT);}Ay.draw(false,true);if(!this.selectionState.hovered){delete Ay._pendingRefresh;}}if(this.selectionState.hovered){this.stopPropagation();this.showTooltip({x:Ax.clientX,y:Ax.clientY});}},oncontextmenu:function(Ay){Ay=Ay.e||Ay;this.stopPropagation();var Av=new mstrmojo.ui.menus.MenuConfig(),Ax=this.stage,Aw=Ax.owner,A0=Aw.getColorByMetric();if(A0){Av.addMenuItem(mstrmojo.desc(13174,"Select color ranges..."),"",function(){Aw.model.openThresholdEditor(A0,true,false);});}var Au=Aw.observableModel.showEdgeDirection,Az=Au.getValue();Av.addMenuItem(mstrmojo.desc(12080,"Show Edge Direction"),Az?"on":"",function(){Au.setValue(!Az);});Aw.showMenu(Av,Ay);},hoverHighlight:function(){this.selectionState.hovered=true;if(this.from){this.from.hoverHighlight();}if(this.to){this.to.hoverHighlight();}this.highlight();},unHoverHighlight:function(){this.selectionState.hovered=false;if(this.from){this.from.unHoverHighlight();}if(this.to){this.to.unHoverHighlight();}this.unHighlight();},getEndPoint:function(){var Av=this.stage,Ax=Av.showEdgeDirection,A3=this,Ay=A3.to,A2=Ay.getGeometry(),A0=A2,Az=A3.controlPoint,Au=A3.width>1?A3.width:1,Aw=Au<4?4:Au,A4,A1;if(Ax){A4=A3.arrow||i(Az,A2,A2.s+Ay.getBorderWidth(),Aw);A1={x:(A4.crossing1.x+A4.crossing2.x)/2,y:(A4.crossing1.y+A4.crossing2.y)/2};A0=y(A2,A1,0.15);if(!A3.arrow){A3.arrow=A4;}}return{pos:A0,arrow:A4};},draw:function h(){if(this.isExcluded){return ;}var BB=this.stage,A4=BB.currentLayout===e.CIRCULAR,A6=this.unit,A5,A7=this,Aw=this.getCanvas(),A9=Aw.getContext("2d"),A3=A7.to,Av=A7.from.position,Au=A3.position,A2=A7.controlPoint,A8=A7.width>1?A7.width:1,A0=A7.selectionState,BA,BC,BD,Ay,A1,Az=Av,Ax;if(A4&&this.skipBidirectional){return ;}if(A0.hovered||A0.selected){BA=this.stage.themeType==="dark"?E.hovered:a.hovered;}else{BA=A7.color;}A9.strokeStyle=BA;A9.lineWidth=A8;if(Av===Au){BC=u.call(this);A9.beginPath();A9.arc(BC.center.x,BC.center.y,BC.r,BC.start,BC.end,true);A9.stroke();}else{BD=this.getEndPoint();Ax=BD.pos;A1=BD.arrow;A5=A6.reversedEdge;if(A4&&A5){A5=A5.sprite;A5.skipBidirectional=true;A7.skipBidirectional=false;BD=A5.getEndPoint();Az=BD.pos;Ay=BD.arrow;}A9.beginPath();A9.moveTo(Az.x,Az.y);if(q(Az,A2,Ax)){A9.lineTo(Ax.x,Ax.y);}else{A9.quadraticCurveTo(A2.x,A2.y,Ax.x,Ax.y);}A9.stroke();}if(Ay){AT(Ay,A9.strokeStyle,A9);}if(A1){AT(A1,A9.strokeStyle,A9);}if(BB.onDraw){BB.onDraw(this);}this._super();},isHit:function(A7,A4){var BD=Math.max(1,this.width/2),Av=this.controlPoint,Au=this.to.position,Aw=this.from.position,A8=Aw.x-2*Av.x+Au.x,BC=2*(Av.x-Aw.x),Az=Aw.x-A7,A3=BC*BC-4*A8*Az,A6=Aw.y-2*Av.y+Au.y,BB=2*(Av.y-Aw.y),Ax=Aw.y-A4,A1=BB*BB-4*A6*Ax,BE;function Ay(BH,BG){return Math.sqrt(Math.pow((BH.x-BG.x),2)+Math.pow((BH.y-BG.y),2));}if(this.from===this.to){return l.call(this,{x:A7,y:A4});}var A0=[];var A9,A5,A2;if(A8===0){if(BC!==0){A9=(A7-Aw.x)/(2*(Av.x-Aw.x));}else{A9=0;}A0.push(A9);}else{if(A3>=0){A5=(Math.sqrt(A3)-BC)/(2*A8);A2=(-1*Math.sqrt(A3)-BC)/(2*A8);A0.push(A5);A0.push(A2);}}if(A6===0){if(BB!==0){A9=(A4-Aw.y)/(2*(Av.y-Aw.y));}else{A9=0;}A0.push(A9);}else{if(A1>=0){A5=(Math.sqrt(A1)-BB)/(2*A6);A2=(-1*Math.sqrt(A1)-BB)/(2*A6);A0.push(A5);A0.push(A2);}}var BA,BF;for(BA=0;BA<A0.length;BA++){BF=c(A0[BA],Aw,Av,Au);BE=Ay({x:A7,y:A4},BF);if(BE<=BD){return true;}}return false;},getGeometry:function(){var Av=this.controlPoint,Au=this.geometry;Au.x=Av.x;Au.y=Av.y;Au.s=this.width;return Au;},setGeometry:function(Ax){if(Ax){var Au=Ax.x,Az=Ax.y,Av=Ax.s,Aw=this.controlPoint,Ay=false;if(!isNaN(Au)&&Math.abs(Au)!==Infinity){if(Au!==Aw.x){Aw.x=Au;Ay=true;}}if(!isNaN(Az)&&Math.abs(Az)!==Infinity){if(Az!==Aw.y){Aw.y=Az;Ay=true;}}if(!isNaN(Av)&&Math.abs(Av)!==Infinity){if(Av!==this.width){this.width=Av;Ay=true;}}if(Ay){this.stylesChanged();}}},stylesChanged:function(Au){if(this._super){this._super();}if(Au){this.arrow=undefined;}}});function AH(){function Av(){var Aw=this.circleStyle,A0=this.themeType==="dark"?Aw.dark:Aw.light,Ax=N.clone(A0.normal),A1=AK.getPropertyByPath(Ax,"color.value",false)!==false?g.getCSSColorString(Ax.color.value):undefined,A8=AK.getPropertyByPath(Ax,"border.color.value",false)!==false?g.getCSSColorString(Ax.border.color.value):undefined,A5=AK.getPropertyByPath(Ax,"fromNode.color.value",false),A7=AK.getPropertyByPath(Ax,"toNode.color.value",false),Az=AK.getPropertyByPath(Ax,"fromNode.border.color.value",false),A3=AK.getPropertyByPath(Ax,"toNode.border.color.value",false),A4=A5===false?A1:A5,A6=A7===false?A1:A7,Ay=Az===false?A8:Az,A2=A3===false?A8:A3;Ax={fromNode:{border:AK.getPropertyByPath(Ax,"fromNode.border",false)!==false?Ax.fromNode.border:Ax.border,color:AK.getPropertyByPath(Ax,"fromNode.color",false)!==false?Ax.fromNode.color:Ax.color,shape:Ax.fromNode!==undefined?Ax.fromNode.shape:"Circle"},toNode:{border:AK.getPropertyByPath(Ax,"toNode.border",false)!==false?Ax.toNode.border:Ax.border,color:AK.getPropertyByPath(Ax,"toNode.color",false)!==false?Ax.toNode.color:Ax.color,shape:Ax.toNode!==undefined?Ax.toNode.shape:"Circle"}};Ax.fromNode.border.color.value=g.getCSSColorString(Ay);Ax.fromNode.color.value=g.getCSSColorString(A4,undefined,{retainGradientObject:true});Ax.toNode.border.color.value=g.getCSSColorString(A2);Ax.toNode.color.value=g.getCSSColorString(A6,undefined,{retainGradientObject:true});Ax.showNodeLabel=Aw.showNodeLabel;A0.normal=Ax;return Ax;}var Au=this.addDisposable(new AR({background:this.background,circleStyle:Av.call(this),circleLabelStyle:this.circleLabelStyle,dragMode:this.dragMode}));Au.background.attachEventListener("valueChanged",this.id,function(Ax){var Az=Au.background.getRawObject();this.background=Az;var Aw=this.owner,Ay=F.encodeColor(Aw.getFormats()["background-color"],10),A0=F.encodeColor(Ax.newValue,10);if(Ay!==A0){AK.changeWidgetBackground(Aw,Ax.newValue,Ax.oldValue);}Aw.onStylesModified("background",Az);});Au.circleStyle.attachEventListener("valueChanged",this.id,function(){function Ay(A2,A1){var Az=this.observableModel,A0=A2;this.circleStyle=A2;Ah.call(this);if(A1){A0=Av.call(this);Az.circleStyle.setValue(A0,true);}this.draw(false,true,true);}var Aw=Au.circleStyle.getRawObject();Aw.fromNode.border.color.value=g.getColorValue(Aw.fromNode.border.color.value);Aw.fromNode.color.value=g.getColorValue(Aw.fromNode.color.value);Aw.toNode.border.color.value=g.getColorValue(Aw.toNode.border.color.value);Aw.toNode.color.value=g.getColorValue(Aw.toNode.color.value);var Ax=this.themeType==="dark"?this.circleStyle.dark:this.circleStyle.light;Ax.normal=Aw;this.circleStyle.showNodeLabel=Aw.showNodeLabel;this.owner.onStylesModified("circleStyle",Aw,Ay);Ay.call(this,this.circleStyle);});Au.circleLabelStyle.attachEventListener("valueChanged",this.id,function(Aw){function Ay(A1,A0){var Az=this.observableModel;this.circleLabelStyle=A1;if(A0){P.call(this);Az.circleLabelStyle.setValue(this.circleLabelStyle,true);}if(Ax){(this.spriteCollection||[]).forEach(function(A2){if(A2.type==="Circle"){A2.updateTextSize();}});}this.draw(false,true,true);}var Ax=(Aw.target!==Au.circleLabelStyle.fontColor.fill.value);this.owner.onStylesModified("circleLabelStyle",Au.circleLabelStyle.getRawObject(),Ay);Ay.call(this,Au.circleLabelStyle.getRawObject());});Au.dragMode.attachEventListener("valueChanged",this.id,function(Aw){function Ay(A0,Az){this.dragMode=A0;if(Az){this.observableModel.dragMode.setValue(A0,true);}if(A0===Aa.pan){this.dismissLassoSelector();this.lassoSelectorEnabled=false;this.scaleBar.inputPan.checked=true;}else{if(A0===Aa.select){this.lassoSelectorEnabled=true;this.scaleBar.inputSelect.checked=true;}}}var Ax=Aw.newValue;Ay.call(this,Ax);this.owner.onStylesModified("dragMode",Ax,Ay);});return Au;}function P(){var Au=this.circleLabelStyle,Av=N.clone(AD);N.copy(Au||{},Av);if(!Av.fontColor){Av.fontColor=N.clone(this.themeType==="dark"?Ar.dark:Ar.light);}this.circleLabelStyle=Av;this.owner.propInfo.circleLabelStyle=Av;}function Ah(){var Aw=this.circleStyle,Av=Object.keys(Aw),Au;if(!Aw||(Av.length===1&&Av[0]==="showNodeLabel")){Au=Aw.showNodeLabel;this.circleStyle=N.clone(W);this.circleStyle.showNodeLabel=Au;}else{if(!this.circleStyle.light||!this.circleStyle.dark){var Ay=N.clone(W),Ax=this.themeType==="dark"?Ay.dark:Ay.light;Ax.normal=this.circleStyle;Ay.showNodeLabel=this.circleStyle.showNodeLabel;delete this.circleStyle.showNodeLabel;this.circleStyle=Ay;}}}mstrmojo.netviz.VisNetworkStage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.netviz._HasNetworkContextMenu,mstrmojo.util.ui._LassoSelector],{scriptClass:"mstrmojo.netviz.VisNetworkStage",markupString:'<div id="{@id}-networkstage" style="position: absolute; left: {@left}px; top: {@top}px; width: {@width}px; height:{@height}px;" mstrAttach:mousedown,mousemove,click,contextmenu><div id="{@id}-canvas-parent-parent" style="position: absolute; width: {@width}px; height: {@height}px;"><div id="{@id}-canvas-parent" style="position: relative; z-index: 0;"><canvas id="{@id}-canvas" style="position: absolute; z-index: {@canvasCount}" id="canvas" width= "{@width}" height="{@height}"></canvas></div></div><div style="position: absolute; display:none; border: 2px dotted white; -webkit-user-select: none;"></div><div style="position: absolute; left: '+AI+"px; top: "+At+'px;"></div><div style="position: absolute;"></div></div>',markupSlots:{baseCanvas:function(){return this.domNode.firstChild.firstChild.firstChild;},canvasContainer:function(){return this.domNode.firstChild.firstChild;},canvasOuterContainer:function(){return this.domNode.firstChild;},selectionRectangle:function(){return this.domNode.childNodes[1];},scaleBarPlaceHolder:function(){return this.domNode.childNodes[2];},containerNode:function(){return this.domNode.childNodes[0];}},init:function(Au){this.spriteCollection=[];this.selectedSprites=[];this.frameRate=60;this.frameInterval=Math.ceil(1000/this.frameRate);this.eventHasBeenHandled=false;this.isOnFormattingMode=false;this.dragMode=Aa.pan;this.canvases=[];this.canvasCount=2;this.layers=[];this.transitionDuration=AL;if(this._super){this._super(Au);}this.scaleBarRect={x:AI,y:At,w:Af,h:T};Ah.call(this);P.call(this);if(this.showTransition){this.enableTransition();}this.observableModel=AH.call(this);if(!this.tooltip){this.tooltip=this.addDisposable(new mstrmojo.VisTooltip({placeholder:document.body.appendChild(document.createElement("div")),owner:this}));this.tooltip.render();this.tooltip.domNode.style.display="none";}this.enableRaiseEventsForGestures();},themeType:"dark",destroy:function(){var Au=this.tooltip;if(Au.domNode&&Au.domNode.parentNode){Au.domNode.parentNode.removeChild(Au.domNode);}delete this.spriteCollection;delete this.selectedSprites;delete this.canvases;delete this.layers;if(this._super){this._super();}},preBuildRendering:function(Au){this._super(Au);},postBuildRendering:function(Av){if(this._super){this._super(Av);}var Au=this.baseCanvas;if(!Au){D("No canvas found. Init failed");return ;}this.putSpritesInCanvases();J.forEach(this.layers,function(Ax){if(Ax){Ax.sort(function(Az,Ay){if(Az.zIndex>Ay.zIndex){return 1;}if(Az.zIndex===Ay.zIndex){return 0;}return -1;});}});this.clear();this.updateCanvasPosition();this.draw();this.scaleBar=this.addDisposable(new mstrmojo.netviz.VisNetworkStageScaleBar({owner:this,placeholder:this.scaleBarPlaceHolder,width:this.scaleBarRect.w,height:this.scaleBarRect.h,scale:this.scale,range:{min:x?0.00001:0.5,max:x?10:2},setDragType:this.setDragType,resetScene:this.resetScene,dragMode:this.dragMode}));this.scaleBar.render();var Aw=this;AK.addWheelListener(this.domNode,function(A0){A0.preventDefault();Aw.dismissLassoSelector();if(Aw.transitionTimer){return ;}var Ax=Aw.scaleBar,Az=A0.deltaY>0?-1:1,A1=0.1,Ay=isNaN(Ax.scaleFactor)?1:Ax.scaleFactor;Ay+=Az*A1;Ax.setScaleFactor(Ay);Ax._deActoniveTimer=window.setTimeout(function(){Ax.setScaleFactorDone();},1000);});this.registerLassoSelector(this.domNode,[],false);},lassoSelecting:function(){Ak.removeClass(this.lassoSelector,"lasso-selector-hasContent");},lassoSelected:function(Aw){var Av=this,Au=Av.owner;Av.areaSelect({x0:Aw.left,y0:Aw.top,x1:Aw.left+Aw.width,y1:Aw.top+Aw.height},Aw);if(Av.selectedSprites.length){Ak.addClass(this.lassoSelector,"lasso-selector-hasContent");}Au.doSelection();},lassoSelectorResized:function(Au){this.lassoSelecting();this.lassoSelected(Au);},initScaleBar:function(Av){var Au=this.scaleBar;var Aw=Av||this.getLocalProp(Aj.ZOOM_FACTOR);if(!isNaN(Aw)&&Aw!==1){Au.setScaleFactor(Aw);}},getLocalProp:function(Av){var Au=this.owner;return Au&&Au.getLocalProp(Av);},setLocalProp:function(Aw,Av){var Au=this.owner;return Au&&Au.setLocalProp(Aw,Av);},setMainRect:function(Au){if(!Au){return ;}this.scaleBarRect.x=Au.x+AI;if(this.scaleBar&&this.scaleBar.domNode){this.scaleBar.domNode.style.left=this.scaleBarRect.x+"px";}Au.x=this.scaleBarRect.x+this.scaleBarRect.w;Au.w=Au.w-this.scaleBarRect.w-AI;this.mainRect=Au;},onSpriteStyleChange:function(Av){if(!this.toBeDrawnLayersIndexes){this.toBeDrawnLayersIndexes=[];}var Au=this.toBeDrawnLayersIndexes;if(!isNaN(Av)&&Au.indexOf(Av)===-1){Au.push(Av);}},removeSpriteFromLayer:function(Aw,Av){var Au=false,Ay=this.layers[Av],Ax=Ay.indexOf(Aw);if(Ax!==-1){Ay.splice(Ax,1);Au=true;if(this.hasRendered){this.onSpriteStyleChange(Av);}}return Au;},addSpriteToLayer:function(Aw,Av){var Ax=this.layers[Av],Au=false;if(Ax){Aw.layerIndex=Av;if(Ax.indexOf(Aw)===-1){Ax.push(Aw);Au=true;}if(this.hasRendered){this.onSpriteStyleChange(Av);}}return Au;},putSpritesInCanvases:function(){this.canvases=[];var Au=this.canvasCount-1,Ax=this.canvases,Az=[],Aw,Av=document.createDocumentFragment(),A1;[AM.EDGE,AM.CIRCLE,AM.HIGHLIGHT].forEach(function(A3){var A2=Az[A3]=[];A2.canvasIndex=A3===AM.HIGHLIGHT?Ad.HIGHLIGHT:Ad.BASE;});function Ay(A4,A3){var A2=Az[A3];if(A2.indexOf(A4)===-1){A4.layerIndex=A3;A2.push(A4);}A4.getCanvas=function(){return this.stage.canvases[this.stage.layers[this.layerIndex].canvasIndex];};}for(Aw=0;Aw<Au;Aw++){A1=document.createElement("canvas");A1.width=this.width;A1.height=this.height;A1.style.position="absolute";A1.style.zIndex=(Aw+1).toString();Av.appendChild(A1);Ax.push(A1);}this.canvasContainer.appendChild(Av);this.canvases.push(this.baseCanvas);var A0=this.spriteCollection;J.forEach(A0,function(A2){if(A2.type==="Circle"){Ay(A2,AM.CIRCLE);J.forEach(A2.unit.edges,function(A3){A3=A3.sprite;Ay(A3,AM.EDGE);});}});this.layers=Az;},unrender:function(Au){if(this.scaleBar&&this.scaleBar.unrender){this.scaleBar.unrender(Au);}if(this._super){this._super(Au);}},updateCanvasPosition:function(){this.canvasPosition=AP(this.baseCanvas,true);},enableRaiseEventsForGestures:function(){var Az=An;var Ay=this,Ax,A0,A3=this.id;var A2=function(A8,A7){return function(BB){var BA=AP(this.baseCanvas,true),A9=BB.e||BB.evt||BB;BB.name=A8;BB.layerX=A9.pageX-BA.x;BB.layerY=A9.pageY-BA.y;mstrmojo.all[A3].eventHasBeenHandled=false;mstrmojo.all[A3].raiseEventForSprites(BB);if(A7){A7.call(mstrmojo.all[A3],BB);}};};var A1=Ay.onmousemove,A5,Av,Aw,Au,A4,A6;for(Ax=0,A0=Az.length;Ax<A0;Ax++){A5=Az[Ax];Av="on"+A5;Aw=Ay[Av];Ay[Av]=A2(A5,Aw);}Au=Ay.onmousemove;Ay.onmousemove=function(A7){if(!mstrmojo.all[A3]._isMouseDown){Au.call(mstrmojo.all[A3],A7);}else{A1.call(mstrmojo.all[A3],A7);}};A4=Ay.onmousedown;A6=Ay.onmouseup;Ay.onmousedown=function(A7){A4.call(mstrmojo.all[A3],A7);AK.captureEventOnce("mouseup",A6,mstrmojo.all[A3]);};},clear:function z(Ax){var Aw=[],Ay=this,Au=this.width,Av=this.height;if(Ax instanceof Array){Ax.forEach(function(A0){var Az=Ay.canvases[Ay.layers[A0].canvasIndex];if(Aw.indexOf(Az)===-1){Aw.push(Az);}});}else{Aw=this.canvases;}Aw.forEach(function(A0){var Az;Az=A0.getContext("2d");Az.clearRect(0,0,Au,Av);Az.fillStyle="rgba(0, 0, 0, 0)";Az.fillRect(0,0,Au,Av);});},applyScaleAndPosition:function(){var Az=this.spriteCollection,Ay=Az.length,Av=this.sceneInformation.position,Ax=this.scaleFactor,A2=this.width/2,A0=this.height/2,Aw,A3,Au;if(isNaN(Ax)){Ax=1;}for(Aw=0;Aw<Ay;Aw++){A3=Az[Aw];Au=A3.getGeometry();Au.s=Au.s*Ax;Au.x=(Au.x-A2)*Ax+A2+Av.x;Au.y=(Au.y-A0)*Ax+A0+Av.y;A3.setGeometry(Au);}if(this.currentLayout===e.CIRCULAR){var A1=this.graphCenter;if(A1){A1.x=(A1.x-A2)*Ax+A2+Av.x;A1.y=(A1.y-A0)*Ax+A0+Av.y;}}this.scaleFactor=1;Av.x=0;Av.y=0;},setDragType:function(Av){var Au=AK.getPropertyByPath(this,"observableModel.dragMode");if(Au!==undefined){Au.setValue(Av);}},drawLayer:function AF(Aw,Ay){if(!Aw){return ;}var Au=Aw.length,Av,Ax;for(Av=Au-1;Av>=0;Av--){Ax=Aw[Av];Ax.draw(Ay,Ax.attSrc);delete Ax.hasStyleChanged;}},drawFrame:function AX(Av,A8){var BD,BC,Au,A9,Ax,A5,A3,A0,BB,BF,A7,A2,BH=this;function BE(BK){var BI=A5["diff"+BK],BJ=BI*A2;if(!isNaN(BJ)){A5[BK]=A5["start"+BK]+BJ;}}if(!BH._hasDrawnTheFirstFrame){AQ.startTimer({functionName:"VisNetworkStage.draw",purpose:"Rendering the canvas"});}BH.clear(A8);A3=[];if(A8 instanceof Array){for(BC=0;BC<A8.length;BC++){A0=A8[BC];BF=BH.layers.length;for(BB=0;BB<BF;BB++){var BA=BH.layers[A0],A6=BH.layers[BB];if(BB!==A0&&BA&&A6&&BA.canvasIndex===A6.canvasIndex&&A8.indexOf(BB)===-1){A8.push(BB);}}}A8.sort();J.forEach(A8,function(BJ){var BI=BH.layers[BJ];if(BI){A3.push(BI);}});}else{A3=BH.layers;}if(!A3.length){D("nothing to draw");return ;}if(BH.transitionTimer){Au=BH.spriteCollection;BD=Au.length;A7=Av-BH.transitionStartTime;if(A7>BH.transitionDuration){for(BC=0;BC<BD;BC++){A9=Au[BC];Ax=A9.newGeometry;A9.setGeometry(Ax);delete A9.transitionGeometry;}BH.onDrawTransitionEnd();}else{A2=A7/BH.transitionDuration;for(BC=0;BC<BD;BC++){A9=Au[BC];A5=A9.transitionGeometry;Ax=A9.getGeometry();AW(Ax,BE);A9.setGeometry(A5);}}}var BG=BH.labelBitmap,Ay=A8||N.valarray(AM),Az=Ay.some(function(BI){return BI===AM.CIRCLE;}),Aw=Ay.some(function(BI){return BI===AM.HIGHLIGHT;})?BH.layers[AM.HIGHLIGHT]:[];BH.spriteCollection.forEach(function(BJ){var BK,BI;if(BJ.type==="Circle"&&BJ.hasDrawnLabel){BI=Az||Aw.some(function(BL){return BL===BJ;});if(!BI){BK=BJ.getLabelBoundingBox();BG.set(BK.left,BK.top,BK.right,BK.bottom);}}});var A1=A3.length;if(A3[AM.HIGHLIGHT]!==undefined&&A1>1){if(A1===2){D("WARN: refresh only two layers: highlight and [circle|edge]");}A3=A3.slice();A3.splice(AM.HIGHLIGHT,1);}var A4=BH.layers[AM.HIGHLIGHT];J.forEach(A3,function(BI){if(BI){BH.drawLayer(BI,BI===A4);}});D("draw done");BH.toBeDrawnLayersIndexes=[];if(!BH._hasDrawnTheFirstFrame){BH._hasDrawnTheFirstFrame=true;AQ.endTimer();}},draw:function AC(Au,A6,Ay){var Av,A2,A0,Aw,A5,A4,A3,Az=this;function A1(A7){A4["diff"+A7]=A3[A7]-A4[A7];A4["start"+A7]=A4[A7];}function Ax(A8){if(!A6&&Az.transitionTimer===undefined){if(Az.lastDrawTime!==undefined&&A8-Az.lastDrawTime<Az.frameInterval){D("draw ignored");return ;}}if(Az.transitionTimer&&!Az.transitionStartTime){Az.transitionStartTime=A8;}Az.labelBitmap=Az.addDisposable(new mstrmojo.netviz.Bitmap({left:0,top:0,right:Az.width,bottom:Az.height,scale:4}));var A7=Az.id;Az.drawFrame.call(mstrmojo.all[A7],A8,Av);Az.toBeDrawnLayersIndexes=[];Az.lastDrawTime=A8;if(Az.transitionTimer){Az.transitionTimer=window.requestAnimationFrame(Ax);}}this.onDrawTransitionEnd();Av=this.toBeDrawnLayersIndexes;if(typeof Av==="number"&&this.layers[Av]){Av=[Av];}if(Ay){Av=L(this.layers);}if(!Au){window.requestAnimationFrame(Ax);}else{A2=this.spriteCollection;A0=A2.length;for(Aw=0;Aw<A0;Aw++){A5=A2[Aw];A4=N.clone(A5.oldGeometry);A3=N.clone(A5.getGeometry());AW(A3,A1);A5.newGeometry=A3;A5.transitionGeometry=A4;}this.transitionTimer=window.requestAnimationFrame(Ax);}},onDrawTransitionEnd:function(){if(this.transitionTimer){window.cancelAnimationFrame(this.transitionTimer);delete this.transitionTimer;delete this.transitionStartTime;}},clearHoverHighlight:function(){var Av=this.spriteCollection,Au=Av.length,Ax,Aw;for(Aw=0;Aw<Au;Aw++){Ax=Av[Aw];if(Ax.type==="Edge"){Ax.unHoverHighlight();}}},clearSelection:function(){var Aw=this.selectedSprites,Au=Aw.length,Av,Ax;for(Av=0;Av<Au;Av++){Ax=Aw[Av];Ax.selectionState.selected=false;Ax.unHighlight();}this.selectedSprites=[];},addToSelection:function(Av){var Au=this.selectedSprites;if(Au.indexOf(Av)===-1){Av.selectionState.selected=true;Av.highlight();Au.push(Av);}},removeFromSelection:function(Aw){var Av=this.selectedSprites,Au=Av.indexOf(Aw);if(Au!==-1){Aw.selectionState.selected=false;Aw.unHighlight();Av.splice(Au,1);}},onclick:function(){},onmousedown:function(Au){Au=Au.e||Au;if(this.eventHasBeenHandled||this.transitionTimer||(this.lassoSelector!==Au.target&&this.canvases.indexOf(Au.target)===-1)){return ;}if(this.dragMode===Aa.select){this.lassoSelectorEnabled=true;}this._isMouseDown=true;this._lastMousePosition={x:Au.pageX,y:Au.pageY};if(this._isEdgeHovered){delete this._isEdgeHovered;this._isEdgeMouseDown=true;}},onmousemove:function(Az){Az=Az.e||Az;if(this.eventHasBeenHandled||this.transitionTimer||!this._isMouseDown){return ;}var Aw=this._lastMousePosition,Ay={x:Az.pageX,y:Az.pageY},Av=Ay.x-Aw.x,Au=Ay.y-Aw.y;if(!this._isDragged){if(Av||Au){this._isDragged=true;if(this._isEdgeMouseDown){this._pendingRefresh=true;delete this._isEdgeMouseDown;}}}if(this.dragMode===Aa.pan&&Az.button===0){var Ax=this.sceneInformation.position;Ax.x+=Av;Ax.y+=Au;this.applyScaleAndPosition();this.draw(false);}this._lastMousePosition=Ay;},onmouseup:function(Av){var Ax=Av.e||Av,Ay=Ax.srcElement||Ax.target,Au=this.owner,Aw;if(this.eventHasBeenHandled||this.transitionTimer||!this._isMouseDown){return ;}if(!this._isDragged){if(!(Ap(Ax)===2&&this.lassoSelector===Ay)){Aw=(this.selectedSprites||[]).filter(this.isClearAllEnabled,this);Aw.forEach(function(Az){if(this.isClearAllEnabled(Az)){this.removeFromSelection(Az);}},this);if(Aw.length>0){Au.doSelection();this.draw(false);}}}delete this._isMouseDown;delete this._lastMousePosition;delete this._isDragged;delete this._isEdgeMouseDown;},oncontextmenu:function AO(Av){var Ax=Av.e||Av,Az=Ax.target||Ax.srcElement,Aw=this.lassoSelector;AY.stopPropogation(window,Ax);AY.preventDefault(window,Ax);if(this.eventHasBeenHandled||this.transitionTimer){return ;}if(this.isOnFormattingMode){this.showContextMenu("background",this.observableModel.background,Ax);}else{var Au=this.owner;if(Az===Aw){Au.showSelectionMenu(Ax);}else{if(!AY.contains(this.scaleBar.domNode,Az,true)){var Ay=this;Au.showBlankSpaceMenu(Ax,function(){Ay.showContextMenu("background",Ay.observableModel.background,Ax);AK.selectPropertyPanel(Ay.owner,0);});}}}if(this._isMouseDown){delete this._selectionState;delete this._isMouseDown;delete this._lastMousePosition;delete this._dragged;}},getCircleSpriteItems:function(){var Au=[];J.forEach(this.spriteCollection,function(Av){if(Av.type==="Circle"){Au.push({n:Av.text,id:Av});}});return Au;},areaSelect:function(Av,Az){if(isNaN(Av.x0)||isNaN(Av.x1)||isNaN(Av.y0)||isNaN(Av.y1)){D("Invalid selection area.");return ;}var A1=this.spriteCollection,Au=A1.length,Ax,Aw,Ay;if(!Az.ctrlKey){this.clearSelection();}for(Ax=0;Ax<Au;Ax++){Aw=A1[Ax];if(Aw.type==="Circle"){Ay=Aw.getGeometry();if((Ay.x-Av.x0)*(Ay.x-Av.x1)<=0&&(Ay.y-Av.y0)*(Ay.y-Av.y1)<=0){this.addToSelection(Aw);}}}var A0=AP(this.baseCanvas,true);this._bubbleToolbarPos={pageX:Av.x0+A0.x,pageY:Av.y0+A0.y};this.draw(false);},enableTransition:function(Au){this.showTransition=true;if(isNaN(Au)){Au=AL;}this.transitionDuration=Au;},disableTransition:function(){this.showTransition=false;delete this.transitionDuration;var Aw=this.spriteCollection,Au=Aw.len,Av;for(Av=0;Av<Au;Av++){delete Aw[Av].oldGeometry;delete Aw[Av].newGeometry;}},getSpriteIndex:function As(Aw){var Au=this.spriteCollection,Av;for(Av=0;Au[Av];Av++){if(Aw===Au[Av]){return Av;}}return null;},createSprite:function(Av){Av.stage=this;var Au=null;if(Av.type==="Circle"){Au=this.addDisposable(new AS(Av));}if(Av.type==="Edge"){Au=this.addDisposable(new o(Av));}return Au;},addSprite:function n(Av,Au){if(!isNaN(Au)){this.spriteCollection.splice(Au,0,Av);}else{this.spriteCollection.push(Av);}},clearSprites:function(){this.spriteCollection=[];},removeSprite:function(Av,Au){if(isNaN(Au)){Au=this.getInex(Av);}if(!isNaN(Au)){this.spriteCollection.splice(Au,1);}},attachEventListenerForSprites:function(Av,Au,Aw){if(!Au.eventHandlers){Au.eventHandlers={};}var Ax=Au.eventHandlers;Ax["on"+Av]=Aw;},removeEventListenerForSprites:function(Av,Au){var Aw=Av.eventHandlers;if(Aw){delete Aw[Au];if(Object.keys(Aw).length===0){delete Av.eventHandlers;}}},raiseEventForSprites:function(A0){if(this.eventHasBeenHandled){return ;}var A1=A0.name;if(A1){var Aw=[];J.forEach(this.layers,function(A4){var A3=[];Aw.push(A3);J.forEach(A4,function(A5){A3.push(A5);});});var Az=Aw.length,Ax,Av,Ay,A2,Au;for(Ax=Az-1;Ax>=0;Ax--){Ay=Aw[Ax];for(Av=0;Av<Ay.length;Av++){A2=Ay[Av];Au=A2.eventHandlers;if(Au&&Au["on"+A1]){Au["on"+A1].call(A2,A0);}if(this.eventHasBeenHandled){return ;}}}}},mainRect:null,setScene:function(){function A3(BR,BQ,BP){function BS(BU,BT){return AK.isNearZero(BU.x-BT.x)&&AK.isNearZero(BU.y-BT.y);}var BN=["x","y"].map(function BO(BV){var BT=(BR[BV]-2*BP[BV]+BQ[BV]),BU=AK.isNearZero(BT)?1:(BR[BV]-BP[BV])/BT;if(BU<0||BU>=1){return BQ;}return c(BU,BR,BP,BQ);}).filter(function(BT){return !(BS(BT,BR)||BS(BT,BQ));}),BM=BN.length;if(BM===2&&BS.apply(undefined,BN)){BN.pop();BM=1;}if(BM===0){return BQ;}else{return BN[0];}}this.sceneInformation={};this.scaleFactor=1;var A8=this.mainRect||{x:0,y:0,w:this.width,h:this.height},Av,BB,A9,A7=[],A4=null,BG=null,BK=Q.NETWORK_CIRCLE_BORDER_WIDTH,BH=4,BF=Infinity,Ay=this.showEdgeDirection,BA=Math.max,A6=Math.min,Aw=Math.ceil,Az=Math.pow,BJ=Math.sqrt,BC,Au,BL,BE,A5;Av=this.spriteCollection||[];J.forEach(Av,function(BP){var BT,BS,BR,BN,BM,BQ,BO;if(BP.isExcluded){return ;}BT=BP.getGeometry();if(BP.type==="Circle"){BS=BT.s+BK;BR=BT;A7.push(BP);}else{BS=BA(Aw(BT.s/2),BH);if(Ay){A5=BP.getEndPoint().pos;}else{A5=BP.to.getGeometry();}BR=A3(BP.from.getGeometry(),A5,BT);}BN=BR.x-BS;BM=BR.x+BS;BQ=BR.y-BS;BO=BR.y+BS;if(!A4){A4={x1:BN,x2:BM,y1:BQ,y2:BO};}else{A4.x1=A6(A4.x1,BN);A4.x2=BA(A4.x2,BM);A4.y1=A6(A4.y1,BQ);A4.y2=BA(A4.y2,BO);}if(!BG){BG={x1:BR.x,x2:BR.x,y1:BR.y,y2:BR.y};}else{BG.x1=A6(BG.x1,BR.x);BG.x2=BA(BG.x2,BR.x);BG.y1=A6(BG.y1,BR.y);BG.y2=BA(BG.y2,BR.y);}});if(!A4){A4={x1:0,x2:0,y1:0,y2:0};BG={x1:0,x2:0,y1:0,y2:0};}this.sceneInformation.position={x:0,y:0};var A0={left:BG.x1-A4.x1,top:BG.y1-A4.y1,bottom:A4.y2-BG.y2,right:A4.x2-BG.x2},BD,Ax,BI;if(AK.isNearZero(BG.x2-BG.x1)){BD=0;}else{BD=(A8.w-A0.left-A0.right)/(BG.x2-BG.x1);}if(AK.isNearZero(BG.y2-BG.y1)){Ax=0;}else{Ax=(A8.h-A0.top-A0.bottom)/(BG.y2-BG.y1);}if(BD===0&&Ax!==0){BI=Ax;}else{if(Ax===0&&BD!==0){BI=BD;}else{BI=A6(BD,Ax);}}if(Math.abs(BI)===Infinity){return ;}var A2=(A8.w-(BG.x2-BG.x1)*BI-A0.left-A0.right)/2+A0.left,A1=(A8.h-(BG.y2-BG.y1)*BI-A0.top-A0.bottom)/2+A0.top;J.forEach(Av,function(BN){var BO=BN.getGeometry(),BM=BO.x,BP=BO.y;BM-=BG.x1;BM*=BI;BO.x=BM+A8.x+A2;BP-=BG.y1;BP*=BI;BO.y=BP+A8.y+A1;BN.setGeometry(BO);});if(this.currentLayout===e.CIRCULAR){this.graphCenter={x:A8.w/2+A8.x,y:A8.h/2+A8.y};}for(BB=0,BC=A7.length;BB<BC;BB++){Au=A7[BB].getGeometry();for(A9=BB+1;A9<BC;A9++){BL=A7[A9].getGeometry();BE=BJ(Az(Au.x-BL.x,2)+Az(Au.y-BL.y,2));if(BE>2){BF=A6(BF,BE/(Au.s+BL.s));}}}if(BF<1){J.forEach(Av,function(BM){BM.setGeometry({s:BM.getGeometry().s*BF});});}},resetScene:function(){if(this.sceneInformation){this.sceneInformation.position={x:0,y:0};}this.setScene();},scale:function(Au){if(!this.sceneInformation){this.sceneInformation={size:{width:this.width,height:this.height},position:{x:0,y:0}};}this.scaleFactor=Au;this.applyScaleAndPosition();this.draw(false);},findForceDirectedGraphCenter:function(Av){var A0=this.spriteCollection,Aw={x:0,y:0},Ax=0,Ay,Az,A5,A4,A3,A1,A2={x:0,y:0},Au={};for(Ay=0,Az=A0.length;Ay!==Az;Ay++){A5=A0[Ay];if(A5 instanceof o){A4=A5.from;A3=A5.to;if(A4===Av&&!Au.hasOwnProperty(A3.id)){A1=A3.position;Ax++;Au[A3.id]=true;}else{if(A3===Av&&!Au.hasOwnProperty(A4.id)){A1=A4.position;Ax++;Au[A4.id]=true;}else{A1=A2;}}Aw.x+=A1.x;Aw.y+=A1.y;}}Aw.x/=Ax;Aw.y/=Ax;return Aw;},findLinearLayoutGraphCenter:function(Au){var Az=this.spriteCollection,Av=Au.position,A1=0,Ax,Ay,A2,A0,Aw;for(Ax=0,Ay=Az.length;Ax!==Ay;Ax++){A2=Az[Ax];if(A2 instanceof o){if(A2.from===A2.to){continue;}A0=A2.controlPoint;if(A0.y<Av.y){A1++;}else{A1--;}}}if(A1>=0){Aw={x:Av.x,y:0};}else{Aw={x:Av.x,y:2*Av.y};}return Aw;},getDataLabelFormats:function(){var Au=this.circleLabelStyle;return{color:g.getCSSColorString(Au.fontColor.fill.value),font:S(Au),"text-decoration":s(Au.fontStyle)};},execFormatHandler:function(){var Au=this.selectedSprites;if(Au&&Au.length>0){r.call(this,this._bubbleToolbarPos);AK.selectPropertyPanel(this.owner,"de");}else{AK.selectPropertyPanel(this.owner,0);}},isClearAllEnabled:function(Au){return this.owner.isClearAllEnabled(Au.unit);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.gm.GMUtility","mstrmojo.color","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus.ToolbarEditorConfig","mstrmojo.vi.ui.editors.EditorGroup","mstrmojo.ui.editors.controls.LineConfigGroup","mstrmojo.ui.editors.controls.FillConfigGroup","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.AdvancedColorPicker");var Z=mstrmojo,I=Z.dom,K=Z.hash,a=Z.array,A=Z.css,i=Z.VisEnum.ControlType,h=mstrmojo.gm,F=mstrmojo.color,U=h.GMUtility,R=Z.VisUtility,j=h.FormatingPropertyTag,e=mstrmojo.models.FormatModel,c=e.ENUM_PROPERTY_NAMES,P=mstrmojo.chart.enums.EnumFontStyle,f=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,G=mstrmojo.VisEnum.NetworkLegendFormattingCategory,V=mstrmojo.ui.editors.controls.AdvancedColorPicker,W={GLOBAL:"glb",FORMATTING:"fmt"},D={FONT_COMP:"FntCmp",FONT_FAMILY:"FntFml",FONT_STYLE:"FntStyle",FONT_SIZE:"FntSz",FONT_COLOR:"FntClr",LINE_COMP:"LnCmp",SHOW:"Shw",COLOR:"Clr",STYLE:"Style",THICKNESS:"Thk"};function N(q,n){var m=this.widget,o=m.domToolbarPH,p=this;m._lastOpened=null;o.innerHTML="";document.body.appendChild(o);A.toggleClass(o,mstrApp.getThemeClassName(),true);this.configureLegendPopup(n,o);m.toolEditor=n.newInstance({unrender:function(){}});m.toolEditorClosefn=function(r){var t=r.target,s=m.toolEditor.domNode;if(!I.contains(s,t,true,s)&&!R.isHostedPopupNode(t,"class",true,document.body)){p.hideToolbar();}};I.attachEvent(document.body,"mousedown",m.toolEditorClosefn,true);m.openPopup(this.widget.toolEditor);A.toggleClass(document.body,"hasToolbarPopup",true);}function L(n,m){var o;if(m===W.GLOBAL){o=this.readGlobalProperty(n);}else{if(m===W.FORMATTING){o=this.widget.getPropertiesOfFormatable();}}if(n.slice(-3)===D.COLOR){if(n!==j.COLOR_SQUARE_COLOR||m!==W.GLOBAL){o=U.decodeColor(o);}}return o;}function Q(n,m){var o=this;if(m===W.GLOBAL){return function(q){var p=L.call(o,n,W.GLOBAL);if(n===j.COLOR_SQUARE_COLOR){p=p.color;}if(!K.equals(q,p)){if(n.indexOf(D.COLOR)!==-1){q=U.encodeColor(q);}o.writeGlobalProperty(n,q);}};}return function(r,p){var q=L.call(o,n,W.FORMATTING);if(r!==q){if(n.indexOf(D.COLOR)!==-1){r=F.encodeColor(r);}o.widget.writeFormatableProperties(n,r,p);}};}function O(n,m){n=n||[];m=m||"";a.forEach(n,function(o){o.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.HBox",cssClass:m,children:n};}function d(n,o){n=n||[];var m=new mstrmojo.Box({children:n,cssText:o});return m;}function B(q,r,m){var p="white-space: nowrap; width: 50px;";if(q===mstrmojo.desc(3905,"Background")||q===mstrmojo.desc(6242,"Color")){p="white-space: nowrap;";}else{if(q===mstrmojo.desc(2885,"Fill")){p="white-space: nowrap; margin-right: 9px;";}}var n=new mstrmojo.Label({text:q}),o=d(n,p);return O([o,r],m);}function b(n,o,m){var p=this;n=n||{};if(n.propNames===undefined){n.propNames=o;}n.onGroupValueChange=function(q,s,r){if(s!==r&&s!==undefined){(Q.call(p,q,m))(s,r);}};return n;}function S(o,n,m){var p=this;a.forEach(n,function(q){var r=L.call(p,q,m);if(r!==undefined){o.setChildValue(q,r);}});}function C(m,p,o,n){n=b.call(this,n,p,o);K.copy({width:"140px",height:"22px",colorPickerHostWithin:true},n);var q=new mstrmojo.ui.editors.controls.FillConfigGroup(n);if(q){q.iniChildrenComp(p);S.call(this,q,p,o);}if(typeof m==="string"){return B(m,q,(n||[]).rowContainerCSSClass);}return q;}function Y(o,n,m){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-ToolBoxBackgroundFill",children:[C.call(this,mstrmojo.desc(2885,"Fill"),o,n,K.copy({rowContainerCSSClass:"mstrmojo-ui-rowContainer"},m))]}]});}function k(q,o,s,r,n){var p=L.call(this,s,r),t=this;var m=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:!!n,isHostedWithin:true,width:"40px",selectedValue:p,showNoFill:false,postselectedValueChange:function(u){(Q.call(t,s,r))(u.value,u.valueWas);}});if(q){m.alias=q;}if(typeof o==="string"){return B(o,m);}return m;}function l(n){var m;if(n.listenToUpdateColorMap instanceof Function){m=n.listenToUpdateColorMap(function(){n.raiseEvent({name:"colorByColorChange",type:"invalidateCache"});if(m&&n.detachUpdateColorMapListener instanceof Function){n.detachUpdateColorMapListener(m);}});}}function g(o,n){var m=L.call(this,o,n),p=this;return new mstrmojo.ui.menus.ToolbarEditorConfig({cssClass:"cbsquare-colorpicker",contents:[new mstrmojo.ui.editors.controls.AdvancedColorPicker({showAutomatic:!m.isDefaultColor,color:m.color,colorChanged:function(q){q=(this.showAutomatic&&q===V.VAL_AUTOMATIC)?"default":q;l(p.widget);(Q.call(p,o,n))(q,m.color);p.hideToolbar();},colorCanceled:function(){p.hideToolbar();}})]});}function T(s,n){var m={},r=L.call(this,n+D.FONT_STYLE,W.GLOBAL),p=L.call(this,n+D.FONT_COLOR,W.GLOBAL),o=L.call(this,n+D.FONT_FAMILY,W.GLOBAL),q=L.call(this,n+D.FONT_SIZE,W.GLOBAL);if(r!==undefined){m[c.FONT_WEIGHT]=(!isNaN(r)&&((r&P.FS_BOLD)>0));m[c.FONT_STYLE]=(!isNaN(r)&&((r&P.FS_ITALIC)>0));m[c.UNDERLINE]=(!isNaN(r)&&((r&P.FS_UNDERLINE)>0));m[c.LINE_THROUGH]=(!isNaN(r)&&((r&P.FS_STRIKETHROUGH)>0));}if(p!==undefined){m[c.COLOR]=p;}if(q!==undefined){m[c.FONT_SIZE]=q;}if(o!==undefined){m[c.FONT_FAMILY]=o;}s.setFormatSource(m);}function H(n,m){var o=null;if(m.indexOf(D.FONT_FAMILY)!==-1){o=n.fontFamily;}else{if(m.indexOf(D.FONT_STYLE)!==-1){o=n.fontStyle;}else{if(m.indexOf(D.FONT_SIZE)!==-1){o=n.fontSize;}else{if(m.indexOf(D.FONT_COLOR)!==-1){o=n.fontColor;}}}}return o;}function M(p,o,m){var n={bold:P.FS_BOLD,italic:P.FS_ITALIC,underline:P.FS_UNDERLINE,strikeout:P.FS_STRIKETHROUGH},q=this;o.forEach(function(r){var s=H(p,r);if(s){s.propName=r;if(r.indexOf(D.FONT_STYLE)!==-1){s.postselectionChange=function(t){var w=t.added,x=s.items[(w&&w[0]!==undefined)?w[0]:t.removed[0]],v=!!w,u=L.call(q,r,m),y=(u===undefined?0:u);if(v){y=y|n[x.css];}else{y=y&(~n[x.css]);}s.parent.raiseFormatValueChange(r,y,u);};}else{if(r.indexOf(D.FONT_FAMILY)!==-1){s.postselectedIndexChange=function(t){var w=t.value,v=t.valueWas;if(w!==v){var u=s.items;s.parent.raiseFormatValueChange(r,u[w].id,u[v]&&u[v].id);}};}else{if(r.indexOf(D.FONT_SIZE)!==-1){s.postselectedValueChange=function(t){var v=parseInt(t.value,10)+"pt",u=parseInt(t.valueWas,10)+"pt";if(v!==u){s.parent.parent.raiseFormatValueChange(r,v,u);}};}else{s.postselectedValueChange=function(t){s.parent.parent.raiseFormatValueChange(r,t.value,t.valueWas);};}}}}});}function X(n,q,p,o){var t=this;o=o||{};if(o.propNames===undefined){o.propNames=q;}if(o.onGroupValueChange===undefined){o.onGroupValueChange=function(u,w,v){if(w!==v&&w!==undefined){(Q.call(t,u,W.GLOBAL))(w,v);}};}var m={cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,width:"381px",height:"22px"};o=K.copy(m,o);var s=new mstrmojo.ui.editors.controls.CharacterGroup(o),r=H(s,j.LEGEND_FONT_COLOR);r.showNoFill=false;M.call(this,s,q,p);T.call(this,s,n);return s;}function J(q,p){var u=p.firstChild,y=u?u.offsetWidth:0,n=u?u.offsetHeight:0,r=document.body.offsetWidth,x=document.body.offsetHeight,s=10,t=5,w=5;if(u){u.style.left="0";u.style.right="auto";u.style.top="0";u.style.bottom="auto";}var v={w:y,h:0};var o=n>0;if(o){v.h=n;}else{return false;}if(o){p.style.left=q.x+"px";p.style.top=q.y-n-s/2+"px";}if(q.x+v.w>r){p.style.left=q.x-y+"px";}if(o){var m=0;if(q.y-n-s/2<t){m=t;p.style.top=m+"px";}else{if(q.y+s/2>x){m=Math.max(x-s-n,t);p.style.top=m+"px";}}}}function E(m,p,o,n){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",showDivider:false,children:[X.call(this,m,p,o,n)]}]});}mstrmojo._FormateVisLegend=mstrmojo.provide("mstrmojo._FormateVisLegend",{_mixinName:"mstrmojo._FormateVisLegend",widget:null,readGlobalProperty:undefined,writeGlobalProperty:undefined,configureLegendPopup:undefined,init:function(m){this.widget=null;if(this._super){this._super(m);}if(this.widget&&!this.widget.domToolbarPH){var n;n=document.createElement("div");n.setAttribute("class","gm-menu-placeholder");this.widget.domToolbarPH=n;}},handleRMCOnLegend:function(x){var r=x.getTarget(),s=x.e,v={x:s.pageX,y:s.pageY},u=r.getAttribute("type"),n,t,p,q=this,o=this.widget;x.cancel();x.preventDefault();if(mstrApp.isAppStatePresentation()||!mstrApp.allowWebDashboardDesign()){return ;}var w,m=function(y){switch(y){case i.LGD_COLORBOX_CTN:case i.LGD_COLORBOX:if(y===i.LGD_COLORBOX){r=r.parentNode;}t=r.firstChild.identity;if(t&&t.comb){this.widget.colorSqureIdentity=t;this.selectColorBox(r,this.fmtMode);n=g.call(this,j.COLOR_SQUARE_COLOR,W.GLOBAL);v=this.adjustColorPickerPos(r);if(!v.alignLeft){p=n.ENUM_CORNERS;n.setAlignment(p.BOTTOM_LEFT,p.TOP_RIGHT);}}break;case i.LGD_TITLE:case i.LGD_TEXT:this.selectText(true);var z=[j.LEGEND_FONT_SIZE,j.LEGEND_FONT_FAMILY,j.LEGEND_FONT_STYLE,j.LEGEND_FONT_COLOR];n=E.call(this,"lgd",z,W.GLOBAL);w="lgd";break;default:this.selectLegendBody();var AA=[j.LEGEND_BG_COLOR,j.LEGEND_BG_FILL_TRANSPARENCY];n=Y.call(this,AA,W.GLOBAL);w="lgd";break;}if(n){N.call(this,v,n);if(!!w){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");o.parent.selectVIUnit();var AB=o.edtModel._targetPulldown;if(AB){AB.selectItemByField("v",w);}}}};m.call(this,u);J.call(this,v,this.widget.domToolbarPH);},hideToolbar:function(){var n=this.widget,o=n.domToolbarPH,q=o.firstChild,m=o.parentNode;if(q){o.removeChild(q);}if(m){m.removeChild(o);}var p=n.toolEditor;if(p){p.unrender=function(){p._super();};p.destroy();p.unrender=function(){};delete n.toolEditor;A.toggleClass(document.body,"hasToolbarPopup",false);A.toggleClass(o,mstrApp.getThemeClassName(),false);}if(n.toolEditorClosefn){I.detachEvent(document.body,"mousedown",n.toolEditorClosefn,true);delete n.toolEditorClosefn;}},highlightText:function(m){throw new Error("subclass need to implement highlightText function");}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.VisEnum","mstrmojo.VisLegend","mstrmojo.VisUtility","mstrmojo.gm.GMEnums","mstrmojo.gm.GMIdentities","mstrmojo.gm.GMUtility","mstrmojo.array","mstrmojo.string","mstrmojo.hash","mstrmojo._FormateVisLegend","mstrmojo.ui._HasScroller");var Ad=mstrmojo,Aa=Ad.gm,y=Ad.dom,AZ=Ad.css,R=Ad.hash,AL=Ad.VisUtility,Z=Aa.GMUtility,O=mstrmojo.array,X=mstrmojo.string,e=Aa.ColorSquareIdentity,C=Ad.VisEnum.ControlType,i=Aa.EnumLegendSlot,AJ=Aa.EnumDockPosition,m=Aa.EnumLegendSlot,AD=Aa.EnumIdentityType,AB=Aa.EnumShape,AV=Ad.VisEnum.GMLegendDataType,I=mstrmojo.desc(13966,"Size by:"),u="px",E=1.35,Y=0.75,V=5,J=20,k=J,AC=5,A=5,v=16,d=15,G=16,AG=20,q=15,Ab=1,x="setAttribute",j=3,g=2,P=8,p=15,AQ=14,s=1,Q=2,f=4,Ae=8,Ac=16,K=10,AS=3,AH=50,AN=-3,r=5,AO="gm-legend-lock-icon",AK=mstrmojo.desc(14442,"This metric has its axis scale set to custom min and max values"),N="http://www.w3.org/2000/svg",t="\u2026",M=/[ \-]/;function AP(Ak,Am,Af,An){if(!Ak){return ;}var Ah,Aq,Ai,Ap,Al=Ak.style,Ar=Am===AJ.TOP,Ag=Am===AJ.BOTTOM,Ao=Am===AJ.LEFT,Aj=Am===AJ.RIGHT;if(Ar||Ag){Ah=Af;Aq=1;Ai=-1;Ap=AN;if(Ag){Ap+=An;}}else{if(Ao||Aj){Ah=1;Aq=An;Ap=-1;Ai=AN;if(Aj){Ai+=Af;}}}Al.cssText="left:"+Ai+u+";top:"+Ap+u+";width:"+Ah+u+";height:"+Aq+u+";";}function H(Ag){var Af=String(Ag);return Af.indexOf(" ")>=0||Af.indexOf("-")>=0;}function W(Ah,Ag,Ai){var Af=typeof Ah==="string"?Z.restoreSpecialChars(Ah):Ah;return AL.measureTextWidth(Af,Ag,Ai);}function AF(Aj,Ai,Ag,Af){var Ah=W(Ai,Ag,K);Aj.setAttribute("measureWidth",Ah);if(Ah>Af){Ah=Af;}else{Aj.style.overflow="visible";}Aj.setAttribute("displayWidth",Ah);Aj.style.width=Ah+u;return Ah;}function B(Ag){var Af;if(Ag.textContent&&typeof (Ag.textContent)!==undefined){Af=Ag.textContent;}else{Af=Ag.innerText;}return Af;}function a(Ah){var Ag=Ah.getAttribute("measureWidth"),Af=Ah.getAttribute("displayWidth");if(!Ag){Ah[x]("title","");}Ag=parseFloat(Ag,10);Af=parseFloat(Af,10);if((Ag-Af)>0.1){Ah[x]("title",B(Ah));}else{Ah[x]("title","");}}function AI(Aj,Af,Ag,Ai){var Ah=document.createElement("div");Ah[x]("class","gm-legend-underLine");Ah.style.width=Ai-K+u;Ah.style.left=Af+5+u;Ah.style.top=Ag+u;Aj.appendChild(Ah);}function AU(Ai,Af,Ag){var Ah=document.createElement("div");Ah[x]("class","gm-legend-underLine-anchorPoint");Ah.style.left=Af+u;Ah.style.top=Ag-3+u;Ai.appendChild(Ah);}function AE(Ai,Af,Ag,Ah){AI(Ai,Af,Ag,Ah);AU(Ai,Af,Ag);}function l(Ah,As,Ao,Am,Aq){var An,Ai,Ap,Af,Ar=Z.restoreSpecialChars(Ah.innerHTML),Al=Ar.length,Aj=0,Ag=Al,Ak=false;if(Ah.scrollHeight>1.5*G){An=W(Ah.innerHTML,As,K);Ai=An-Ao+K;if(Ai>Aq){while((Ag-Aj)>1){Ap=(Aj+Ag)>>1;Af=Ar.substring(0,Ap)+t;An=W(Af,As,K);Ai=An-Ao+K;if(Ai>Aq){Ag=Ap;}else{Aj=Ap;}}Ah.innerHTML=X.encodeHtmlString(Ar.substring(0,Aj)+t,true);Ah[x]("title",Ar);Ak=true;An=W(Ah.innerHTML,As,K);Ai=An-Ao+K;}AI(Ah,0,Am+G,(Ai<Aq)?Ai:Aq);}if(Ao>Aq){Ah[x]("title",Ar);}else{if(!Ak){Ah[x]("title","");}}}function w(Af,Ao,Ak,Ag,An,Ap){var Ah,Aj,Al,Am,Ai=document.createElement("div");Ai[x]("class","gm-legend-textcell");Ai[x]("type",C.LGD_TEXT);Ai.style.lineHeight=d+u;if(An){Am=AF(Ai,Ao,Ap,An);}if(Ag&s){Ah=(AG+AQ)/2+Ak*AG;Al=v;}else{Ah=(q+AQ)/2+Ak*q;if(Ag&Ae){if(Ag&Ac){Al=0;}else{Al=p;}}else{if(Ag&f){Al=P;}else{Al=0;}}}Aj=Am||p+K;Ai.innerHTML=Ao;Ai.identity={objType:AD.LEGEND_TEXT};AE(Af,Al,Ah,Aj);this.textDivs.push(Ai);Af.appendChild(Ai);}function AX(Af,Ai){var Ag,Ak,Aj,Ah=0;if(Af){Aj=Af.elements;for(Ag=0,Ak=Aj.length;Ag<Ak;Ag++){Ah=Math.max(Ah,W(Aj[Ag].label,Ai,K));}Ah+=v+A*2+AS;}return Ah;}function U(Ai,Ah){var Al,Af,Ak,Aj=Ai.items,Ag=0;if(!Aj){return 0;}Al=Aj.length;Ak=Ai.custMetrics;for(Af=0;Af<Al;Af++){if(Ak&&Ak.indexOf(Aj[Af])!==-1){Ag=Math.max(Ag,W(Aj[Af],Ah,K)+P);}else{Ag=Math.max(Ag,W(Aj[Af],Ah,K));}}return Ag;}function AM(Ai,Ah){var Af,Ak,Aj,Ag=0;if(Ai){Aj=Ai.elements;Ak=Aj.length;if(Ai.caseFlag===1){Ag=U(Ai,Ah);}else{if(Ai.caseFlag===0){for(Af=0;Af<Ak;Af++){Ag=Math.max(Ag,W("Max: "+Aj[Af].v,Ah,K));}Ag+=q*j;Ag=Math.max(Ag,U(Ai,Ah));}else{if(Ai.caseFlag===2){for(Af=0;Af<Ak;Af++){Ag=Math.max(Ag,W(Aj[Af].v,Ah,K));}Ag+=q*Ak+p;Ag=Math.max(Ag,U(Ai,Ah));}else{if(Ai.caseFlag===3){for(Af=0;Af<Ak;Af++){Ag=Math.max(Ag,W(Aj[Af].v,Ah,K));}Ag+=q*r;}}}}Ag=Math.max(Ag,W(I,Ah,K));Ag+=A*3;}return Ag;}function c(Aq,Ai,Au){if(!Aq||!Aq.length||Aq.length<1){return 0;}var Aj,Ag,At,Af,Am,Ap,Al,Ao,An,Ah,Ak,As=k+2*Ab,Ar=As;for(Aj=0;Aj<Aq.length;Aj++){Al=Aq[Aj];if(Al.dataType===AV.COLOR_BY){Ao=Al.dataObj;if(Ao){Ah=2*AC+G;At=Z.removeExtraSpace(Ao.item);Ap=W(At,Au,K);if((Ap+2*A>Ai-2*Ab)&&H(At)){Ah+=G;}Af=Ao.elements;Ag=Af.length;Ah+=A;Ah+=g;As+=Ah+AG*Ag;Ar+=Ah+(Ag>0?AG:0);}}else{if(Al.dataType===AV.SIZE_BY){An=Al.dataObj;if(An){Ak=2*AC+G;At=Z.removeExtraSpace(An.item);Ap=W(At,Au,K);if((Ap+2*A>Ai-2*Ab)&&H(At)){Ak+=G;}Am=An.caseFlag;if(Am===1){Ag=0;}else{if(Am===0){Ag=2;}else{if(An.caseFlag===2||Am===3){Ag=An.elements.length;}}}Ag+=(An.items&&An.items.length)||0;Ak+=q*Ag;Ak+=A;Ak+=g;As+=Ak;Ar+=Ak;}}}}return{height:As,minHeight:Ar};}function AY(Af,Ag){var Ai=0,Ah=0;O.forEach(Af||[],function(Aj){var Ak;if(Aj.dataType===AV.COLOR_BY){Ak=AX(Aj.dataObj,Ag);if(Ak>Ai){Ai=Ak;}}else{if(Aj.dataType===AV.SIZE_BY){Ak=AM(Aj.dataObj,Ag);if(Ak>Ah){Ah=Ak;}}}});return Math.max(Ai,Ah)+2*Ab;}function h(Ag,Am,Ak,Aj){var Ah=c(Ag,Am,Aj),Af=Ah.height,Al=Ak-V*2,Ai={};Ai.autoCollapse=Ah.minHeight>Al;Ai.minHeight=Ah.minHeight;Ai.width=Am;Ai.height=Math.min(Af,Al);if(Af>Al){Ai.cutBy=Af-Al;}return Ai;}function F(Ag,Ah){var Ai=Ag.decodedColor||Ag.color,Af;if(Ai.c1){Af=AZ.buildGradient(Ai.or,Ai.c1,Ai.c2);Ah.style[AZ.convertCssToCamelCase(Af.n)]=Af.v;}else{Ah.style.backgroundColor=Ai;}if(Ag.image){Ah.style.backgroundImage=Ag.image;}Ah.identity=new e({objType:AD.COLOR_SQUARE,parentIdentity:this.identity,token:Ag.token,decodedColor:Ag.decodedColor,encodedColor:Ag.encodedColor,isDefaultColor:Ag.isDefaultColor});}function AR(){var Au,Ar,Ap,Af,Aq,Aw,Ag,An,Al,Ai,Ay=document,Ax=this.triBtn,At=this.closeBtn,Ak=this.cbContainer,Ah=this.sb1Container,As=this.sb2Container,Am=this.cbTableContainer,Aj=null,Av=this.height-k-A-2*Ab,Ao=this.width-2*A-2*Ab;Ax[x]("class","gm-legend-tri-button-collapsed");if(this.autoCollapse){Ax[x]("title",mstrmojo.desc(13682,"There is not enough space to display the legend"));}else{Ax[x]("title",mstrmojo.desc(13683,"Maximize Legend"));}At.style.display="none";this.splitter.style.display="none";this.domNode.style.overflow="hidden";for(Au=0;this.dataArray&&Au<this.dataArray.length;Au++){Af=this.dataArray[Au];if(Af.dataType===AV.COLOR_BY){Aj=Af.dataObj;break;}}Ak.style.display=Aj?"block":"none";Ah.style.display="none";As.style.display="none";if(Aj){Ap=Aj.elements;Ar=Ap.length;Aq=this.cbTitle;Aq.style.display="none";Ak.style.top=k+u;Ak.style.width=Ao+u;Am.style.top="0px";Aw=this.cbTable;Aw.innerHTML="";for(Au=0;Au<Ar;Au++){Ag=Ay.createElement("tr");An=Ay.createElement("td");Ai=Ay.createElement("div");Al=Ay.createElement("div");Ai[x]("class","gm-legend-colorbox-ctn-div");Ai[x]("type",C.LGD_COLORBOX_CTN);Ai[x]("title",Ap[Au].label);Al[x]("class","gm-legend-colorbox-div");Al[x]("type",C.LGD_COLORBOX);F.call(this,Ap[Au],Al);Ag[x]("class","gm-legend-tr");Ag.style.height=AG+u;An[x]("class","gm-legend-colorbox");Ai.appendChild(Al);An.appendChild(Ai);Ag.appendChild(An);Aw.appendChild(Ag);if(Aw.offsetHeight+AG>Av){break;}}Aw.style.top="0px";Aw.style.marginLeft="0px";Am.style.top=A+u;Am.style.height=Aw.offsetHeight+u;}Ak.style.height=Av+u;}function n(Ah,Ag,Aj,Af){var Ai=document.createElementNS(N,"circle");Ai.setAttribute("cx",Ag);Ai.setAttribute("cy",Aj);Ai.setAttribute("r",Af);Ai.setAttribute("class","gm-legend-sizeby-circle");Ah.appendChild(Ai);}function AA(Ah,Ai,Al,Ag,Ak,Am,Aj){var Af=document.createElementNS(N,"line");Af.setAttribute("x1",Ai);Af.setAttribute("y1",Al);Af.setAttribute("x2",Ag);Af.setAttribute("y2",Ak);Af.style.strokeWidth=Am;if(Aj){Af.setAttribute("class",Aj);}Ah.appendChild(Af);}function AW(Ag,Au){var At,Ah,Aj,Ak,Ai,Af,As,Al,Av,Am,Aq=Math.PI,An=Au.elements,Ao=An.length,Ap=Ao*q,Ar=Ag.getContext("2d"),Aw={LINE_COLOR:"#b0b0b0",MIN_WIDTH:1,MAX_WIDTH:10},Ax=AL.getPropertyByPath(this,"widget.model.data.visName")||AL.getPropertyByPath(this,"widget.model.data.vis.vn");switch(Ax){case"GraphMatrixVisualizationStyle":if(this.shapeType===AB.SQUARE||this.shapeType===AB.TICK||this.shapeType===AB.LINE||this.shapeType===AB.BAR||this.shapeType===AB.AREA||this.shapeType===AB.RECTANGLE){Am="rectangle";}else{Am="circle";}break;case"VIHeatMapVisualizationStyle":Am="rectangle";break;default:Am="circle";break;}switch(Au.caseFlag){case 0:Ar.save();if(mstrApp.getThemeClassName().indexOf("dark")>=0){Ar.strokeStyle="rgba(116, 116, 117, 0.7)";Ar.fillStyle="rgba(116, 116, 117, 0.7)";}else{Ar.strokeStyle="rgba(188, 188, 189, 0.7)";Ar.fillStyle="rgba(188, 188, 189, 0.7)";}Ap=q*j;Av=Math.floor(q*0.75+0.5);Ah=Math.floor(Av/3.5+0.5);if(Am==="circle"){Ak=Av+1;Ai=q;Ar.beginPath();Ar.arc(Ak,Ai,Av,0,2*Aq,false);Ar.fill();Ar.stroke();Ak=2*Ak+2*Ah;Ai=Math.floor(0.53*q+0.5);Ar.beginPath();Ar.arc(Ak,Ai,Ah,0,2*Aq,false);Ar.fill();Ar.stroke();}else{Ak=1;Ai=q-Av;Ar.beginPath();Ar.fillRect(Ak,Ai,2*Av,2*Av);Ak=2*Av+2+Ah;Ai=Math.floor(0.53*q-Ah+0.5);Ar.beginPath();Ar.fillRect(Ak,Ai,2*Ah,2*Ah);}Ar.translate(0.5,0.5);Ar.lineWidth=1;Ar.strokeStyle="#9C9C9C";Ak=2*Av+3*Ah+3;Ai=Math.floor(0.53*q+0.5);Ar.beginPath();Ar.moveTo(Ak,Ai);Ar.lineTo(Ap,Ai);Ar.stroke();Ak=2*Av+2;Ai=Math.floor(1.53*q-Ah+0.5);Ar.beginPath();Ar.moveTo(Ak,Ai);Ar.lineTo(Ak+Ah,Ai+Ah);Ar.lineTo(Ap,Ai+Ah);Ar.stroke();Ar.restore();break;case 1:break;case 2:Aj=parseInt(An[0].diameter,10);Aj=Math.min(Aj,Ap);Ar.fillStyle="#ADADAC";Ar.strokeStyle="#ADADAC";if(Am==="circle"){Ak=Ap>>1;Ai=Ak;Ar.arc(Ak,Ai,Aj>>1,0,2*Aq,false);Ar.fill();Ar.stroke();}else{Ak=(Ap-Aj)>>1;Ai=Ak;Ar.rect(Ak,Ai,Aj,Aj);Ar.fill();Ar.stroke();}break;case 3:Af=Aw.MIN_WIDTH;As=(Ao===1?0:(Aw.MAX_WIDTH-Aw.MIN_WIDTH)/(Ao-1));Ap=Ag.width;Al=q;Ak=0;Ai=q/2;Ar.strokeStyle=Aw.LINE_COLOR;for(At=0;At<Ao;At++){Ar.lineWidth=Af;Ar.beginPath();Ar.moveTo(Ak,Ai);Ar.lineTo(Ap-Ak,Ai);Ar.stroke();Ai+=Al;Af+=As;}break;default:break;}}function AT(Ag,Ao){var Am=1,Af,Ak=1.5*G,An=Ag.innerHTML,Al=Z.restoreSpecialChars(An),Ah=Al.split(M),Ap,Ai;var Aj=function(Aq){Ai=Al[Aq];return Ai!==undefined?Ai:"";};if(Ag.scrollHeight>Ak){if(!Ah[0]){return 0;}Af=Ah[0]+Aj(Ah[0].length);while(Ah[Am]!==undefined){Ap=Af+Ah[Am];Ap+=Aj(Ap.length);Ag.innerHTML=Z.replaceSpecialChars(Ap);if(Ag.scrollHeight>Ak){break;}Af=Ap;Am++;}Ag.innerHTML=An;}else{Af=Al;}return W(Af,Ao,K);}function b(Av,At,Au,Ap){var As,Ah,Ak,Aj,Ao,Ar,An=At.elements,Aq=An.length,Am=[],Aw=document,Af=Aw.createDocumentFragment(),Ai=false,Al=this.styles,Ag=Au;switch(Ap){case 0:if(Aq>0){Am.push({v:"Min: "+An[Aq-1].v});Am.push({v:"Max: "+An[0].v});Aq=2;}break;case 1:An=At.items;O.forEach(An,function(Ax){Am.push({v:Ax});});break;case 3:Am=An;break;default:Am=An;Ai=true;break;}Aq=Am.length;for(As=0;As<Aq;As++){Ah=Aw.createElement("tr");Ah[x]("class","gm-legend-tr2");Ah.style.height=q+u;if(Ai){Ak=Aw.createElement("td");w.call(this,Ak,Am[As].sign,As,Q|Ae|Ac);Ak[x]("class","gm-legend-sign");Ah.appendChild(Ak);Ag-=p;}Aj=Aw.createElement("td");Aj[x]("class","gm-legend-desc");if(At.custMetrics&&At.custMetrics.indexOf(Am[As].v)!==-1){w.call(this,Aj,Am[As].v,As,Q|f,Ag-P,Al);Ar=parseInt(Aj.lastChild.style.width,10);Ao=Aw.createElement("div");Ao.setAttribute("class",AO);Ao.setAttribute("title",AK);Aj.appendChild(Ao);Ao.style.top=(q-8)/2+As*q+u;Aj.lastChild.style.marginLeft=Ar+u;}else{if(Ai){w.call(this,Aj,Am[As].v,As,Q|Ae,Ag,Al);}else{w.call(this,Aj,Am[As].v,As,Q,Ag,Al);}}Ah.appendChild(Aj);Af.appendChild(Ah);}Av.appendChild(Af);}function T(){var Ah="."+AO,Af=this.domLegend.querySelectorAll(Ah),Ag;O.forEach(Af,function(Ai){Ag=Ai.parentNode;if(Ag){Ag.removeChild(Ai);}});}function S(){var A8,A0,BD=0,BE,Av,A2,Aw,Ai,A6,A9,Am,BC,A7,Af=this.width-2*Ab,Aq=Af-2*A,Ak=document,Ah=this.triBtn,A1=this.closeBtn,Az=this.cbContainer,Ar=this.cbTableContainer,BF=this.sb1Container,Al=this.sb2Container,Ap,An,Aj,Ao,A4,At,A3=this.cutBy,Ay=k,BA=0,Ax=this.styles,A5,BB,Au=(G+AQ)/2,Ag,As;Ah[x]("class","gm-legend-tri-button");Ah[x]("title",mstrmojo.desc(13684,"Minimize Legend"));A1.style.display="block";A1[x]("title",mstrmojo.desc(12002,"Hide Legend"));this.updateSplitter();T.call(this);this.domNode.style.overflow="visible";Az.style.display="none";BF.style.display="none";Al.style.display="none";for(A0=0;this.dataArray&&A0<this.dataArray.length;A0++){An=this.dataArray[A0];A4=null;At=null;if(An.dataType===AV.COLOR_BY){A4=An.dataObj;if(A4){Az.style.display="block";Aw=Z.removeExtraSpace(A4.item);Ai=A4.elements;A8=Ai.length;Az.style.top=Ay+u;Az.style.width=Aq+u;BC=0;if(BA===0){AZ.addClass(this.sepLine1,"toggleHide");BA++;}BE=this.cbTitle;BE.style.display="block";AF(BE,Aw,Ax,Aq);BE.innerHTML=X.encodeHtmlString(Aw,true);BC+=BE.offsetHeight+2*AC;Ag=AT(BE,Ax);l(BE,Ax,Ag,Au,Aq);AE(BE,0,Au,(Ag<Aq)?Ag:Aq);Av=this.cbTable;Av.style.display="block";Av.style.width=(Aq-AS)+u;Av.style.marginLeft=AS+u;Av.innerHTML="";Av.appendChild(this.fillColorByTable(A4,0));A6=AG*A8+1;Ar.style.top=BC+u;Av.style.display="table";BC+=A6+A;if(A3){BC-=A3;A6-=A3;}Az.style.height=BC+u;Ar.style.height=A6+u;Ay+=BC+g;}}else{if(An.dataType===AV.SIZE_BY){At=An.dataObj;if(At){BD++;if(BD===1){Aj=BF;Ao=this.sb1Title;A2=this.sb1MetricNamesTable;Av=this.sb1DataTable;Ap=this.sb1Canvas;}else{Aj=Al;Ao=this.sb2Title;A2=this.sb2MetricNamesTable;Av=this.sb2DataTable;Ap=this.sb2Canvas;}Aj.style.display="block";Aw=Z.removeExtraSpace(At.item);Ai=At.elements;A8=Ai.length;Aj.style.top=Ay+u;Aj.style.width=Aq+u;BC=0;if(BA===0){AZ.addClass(this.sepLine2,"toggleHide");BA++;}if(At.caseFlag===0){A9=j*q;Am=2*q;}else{if(At.caseFlag===3){A9=r*q;Am=A8*q;}else{A9=A8*q;Am=A9;}}BE=Ao;BE.innerHTML=X.encodeHtmlString(Aw,true);BB=At.custMetrics&&At.custMetrics.indexOf(Aw)!==-1;if(BB){As=Aq-P;}else{As=Aq;}AF(BE,Aw,Ax,As);if(BB){A5=Ak.createElement("div");A5.setAttribute("class",AO);A5.setAttribute("title",AK);Aj.appendChild(A5);A5.style.top=(BE.offsetHeight-8)/2+AC+g+u;A5.style.left=BE.offsetWidth+"px";}Ag=AT(BE,Ax);l(BE,Ax,Ag,Au,As);AE(BE,0,Au,(Ag<As)?Ag:As);BC+=BE.offsetHeight+2*AC;A7=Aq;A2.innerHTML="";if(At.items&&At.items.length>0){A2.style.display="block";b.call(this,A2,At,A7,1);}else{A2.style.display="none";}A2.style.top=BC+u;A2.style.left="0"+u;A2.style.width=A7+u;BC+=A2.offsetHeight;if(A9>0){A7-=A9+A;}Av.innerHTML="";if(At.elements&&At.elements.length>0){Av.style.display="block";b.call(this,Av,At,A7,At.caseFlag);}else{Av.style.display="none";}Ap.style.position="absolute";Ap.style.top=BC+u;Ap.style.marginLeft=A+u;Av.style.top=BC+u;Av.style.left=(A9+A)+u;Av.style.width=A7+u;BC+=Av.offsetHeight+A;Aj.style.height=BC+u;Av.style.display="table";Ap.width=A9;Ap.height=Am;AW.call(this,Ap,At);Ay+=BC+g;}}}}}function o(){var Af,Ag=this.textDivs,Ah=Ag.length;for(Af=0;Af<Ah;Af++){a(Ag[Af]);}}mstrmojo.gm.GMLegend=mstrmojo.declare(mstrmojo.VisLegend,[mstrmojo._FormateVisLegend,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.gm.GMLegend",cssClass:"gm-legend",dropZoneHighlightCss:"gm-legend-slot",dockedPositions:[{pos:m.LEFT_TOP},{pos:m.LEFT_MIDDLE},{pos:m.LEFT_BOTTOM},{pos:m.RIGHT_TOP},{pos:m.RIGHT_MIDDLE},{pos:m.RIGHT_BOTTOM}],dockPos:AJ.LEFT,GMW:0,GMH:0,isMinimal:false,shapeType:undefined,legendMarkup:'<div class="gm-legend-tri-button"></div><div class="gm-legend-close-button"></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><div class="gm-legend-table-container"><table class="gm-legend-table"></table></div></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><table class="gm-legend-table"></table><table class="gm-legend-table"></table><canvas type="lgd-canvas"></canvas></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><table class="gm-legend-table"></table><table class="gm-legend-table"></table><canvas type="lgd-canvas"></canvas></div><div class="gm-legend-resizer-v" draggable="false"></div><div class="gm-legend-resizeRect"></div>',init:function z(Ag){this.styles={};this.cutBy=null;this.dataArray=null;this.textDivs=[];var Ah=Ag.placeholder,Af=Ah.style;if(Ah){this.cssClass=Ah.getAttribute("class");if(!this.cssClass){this.cssClass="";}if(Ag.hasOwnProperty("width")===false){Ag.width=(Af&&Af.width)||Ah.clientWidth;}if(Ag.hasOwnProperty("height")===false){Ag.height=(Af&&Af.height)||Ah.clientHeight;}if(Ag.hasOwnProperty("left")===false){Ag.left=Ah.offsetLeft;}if(Ag.hasOwnProperty("top")===false){Ag.top=Ah.offsetTop;}}this._super(Ag);},setupScrollNodes:function L(){this.scrollNode=this.cbTableContainer;},getSplitterDockPos:function(){return(this.currDockedPositionIdx<3)?AJ.RIGHT:AJ.LEFT;},updateAlignClass:function(){var Aj=this.getDockedPosition(),Ak=Aj&&Aj.pos,Ah=(Ak===m.RIGHT_MIDDLE||Ak===m.RIGHT_TOP||Ak===m.RIGHT_BOTTOM||Ak===m.RIGHT),Af=this.domLegend,Ag=this.domNode,Ai=this.resizeRect;if(Ah){AZ.removeClass(Af,"gm-align-left");AZ.addClass(Af,"gm-align-right");AZ.toggleClass(Af,"gm-legend-alignRight",true);AZ.toggleClass(Af,"gm-legend-alignLeft",false);AZ.toggleClass(Ag,"gm-legend-alignRight",true);AZ.toggleClass(Ag,"gm-legend-alignLeft",false);AZ.toggleClass(Ai,"gm-legend-alignRight",true);AZ.toggleClass(Ai,"gm-legend-alignLeft",false);}else{AZ.removeClass(Af,"gm-align-right");AZ.addClass(Af,"gm-align-left");AZ.toggleClass(Af,"gm-legend-alignRight",false);AZ.toggleClass(Af,"gm-legend-alignLeft",true);AZ.toggleClass(Ag,"gm-legend-alignRight",false);AZ.toggleClass(Ag,"gm-legend-alignLeft",true);AZ.toggleClass(Ai,"gm-legend-alignRight",false);AZ.toggleClass(Ai,"gm-legend-alignLeft",true);}},postBuildRendering:function(){this._super();var Ar=this.styles,At=this.domNode,Ai=this.domLegend.childNodes,Am=Ai[2],Ak=Ai[3],As=Ai[4],Aw={objType:AD.LEGEND};this.addSlots({triBtn:Ai[0],closeBtn:Ai[1],cbContainer:Ai[2],sepLine1:Am.firstChild,cbTitle:Am.childNodes[1],cbTableContainer:Am.childNodes[2],cbTable:Am.childNodes[2].firstChild,sb1Container:Ak,sepLine2:Ak.firstChild,sb1Title:Ak.childNodes[1],sb1MetricNamesTable:Ak.childNodes[2],sb1DataTable:Ak.childNodes[3],sb1Canvas:Ak.childNodes[4],sb2Container:As,sepLine3:As.firstChild,sb2Title:As.childNodes[1],sb2MetricNamesTable:Ak.childNodes[2],sb2DataTable:As.childNodes[3],sb2Canvas:As.childNodes[4],splitter:Ai[5],resizeRect:Ai[6]});Aa.GMLegend.applyHTML5Props(Ar);this.bgColor=Ar.background||Ar.backgroundColor||"transparent";AL.applyStyle2Legend(Ar,At,this.domLegend);var Al=this.getSplitterDockPos(),Av=this.width-2*A-2*Ab,An=this.cbTitle,Ag=An.style,Ah=this.sb1Title,Aj=this.sb2Title,Au=Ah.style,Af=Aj.style,Aq=this.sepLine1,Ap=this.sepLine2,Ao=this.sepLine3;Aq.style.width=Av+u;Ap.style.width=Av+u;Ao.style.width=Av+u;Ag.lineHeight=G+u;Au.lineHeight=G+u;Af.lineHeight=G+u;Ag.maxHeight=2*G+u;Au.maxHeight=2*G+u;Af.maxHeight=2*G+u;An.identity={objType:AD.LEGEND_TEXT,parentIdentity:Aw};Ah.identity={objType:AD.LEGEND_TEXT,parentIdentity:Aw};Aj.identity={objType:AD.LEGEND_TEXT,parentIdentity:Aw};this.dockPos=Al;this.identity=At.identity=Aw;this.updateAlignClass();},feedData:function(Af,Ag){this.dataArray=Af;this.isMinimal=Ag;this.textDivs=[];Aa.GMLegend.applyHTML5Props(this.styles);this.autoCollapseLegend();if(Ag||this.autoCollapse){AR.call(this);this.draggable=false;}else{S.call(this);this.draggable=true;}o.call(this);this.updateScrollbars();},autoCollapseLegend:function(){this.autoCollapse=this.minHeight&&(this.minHeight>(this.GMH-V*2));},updateColorBySquare:function(Ah){var Ai,Aj,Ag,Af;if(Ah){Af=this.domNode.querySelectorAll(".gm-legend-colorbox-div");Ai=Ah.elements;Aj=Math.min(Ai.length,Af.length);for(Ag=0;Ag<Aj;Ag++){F.call(this,Ai[Ag],Af[Ag]);}}},updateContainerSize:function(Af,Ag){this.GMW=Af;this.GMH=Ag;this.calculateDockedPositions(Af,Ag);},updateAfterResize:function(){Aa.GMLegend.applyHTML5Props(this.styles);var Ak=0,Aj=this.width,Al=this.cbContainer,An=this.sb1Container,Ah=this.sb2Container,Ai=this.sepLine1,Ag=this.sepLine2,Af=this.sepLine3,Am=Aj-2*A-2*Ab;O.forEach(this.dataArray||[],function(Ao){if(Ao.dataType===AV.COLOR_BY){if(Ao.dataObj){if(Al){Al.style.width=Am+u;}}}else{if(Ao.dataType===AV.SIZE_BY){if(Ao.dataObj){Ak++;if(Ak===1&&An){An.style.width=Am+u;}if(Ak===2&&Ah){Ah.style.width=Am+u;}}}}});if(Ai){Ai.style.width=Am+u;}if(Ag){Ag.style.width=Am+u;}if(Af){Af.style.width=Am+u;}this.domLegend.style.width=this.width+u;this.domLegend.style.height=this.height+u;},updateStyle:function(Af){this.styles=Af;this.bgColor=Af.background||Af.backgroundColor||"transparent";AL.applyStyle2Legend(Af,this.domNode,this.domLegend);},updateTitleLineHeight:function(){var Ag=this.cbTitle,Aj=Ag.style,Ah=this.sb1Title,Af=this.sb2Title,Ak=Ah.style,Ai=Af.style;Aa.GMLegend.applyHTML5Props(this.styles);Aj.lineHeight=G+u;Ak.lineHeight=G+u;Ai.lineHeight=G+u;Aj.maxHeight=2*G+u;Ak.maxHeight=2*G+u;Ai.maxHeight=2*G+u;},getSplitterPosition:function(Ah){var Ag=Ah.src.startPos+Ah.tgt.pos.x-Ah.src.pos.x,Aj=Ah.src.posInfo,Ai=Aj&&Aj.min,Af=Aj&&Aj.max;if(Ai!==undefined){Ag=Math.max(Ag,Ai);}if(Af!==undefined){Ag=Math.min(Ag,Af);}return Ag;},positionResizeRect:function(Af,Ag){var Ai=Af.src.posInfo.dockPosition===AJ.LEFT,Aj=Ag-AN,Ak=Ai?Aj:0,Ah=Ai?this.width-Aj:Aj;this.resizeRect.style.left=(Ak-1)+u;this.resizeRect.style.width=(Ah-2)+u;},updateLegendSlot:function(Ai,Af){var Ah=this.getDockedPosition(),Ag=Ah&&Ah.pos;if(Ag!==Ai){this.currDockedPositionIdx=Af;this.dockPos=this.getSplitterDockPos();this.updateDropZonePosition();this.updateAlignClass();this.updateSplitter();this.widget.onLegendDropZoneChange(this.getDockedPosition());}},ondragstart:function(Af){var Ah=Af.src.e.target,Ag=Af.src.data;if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(false);}if(Ah===this.splitter){Af.src.startPos=Ah.offsetLeft;Af.src.posInfo=this.getSplitterInfo(Ah);this.positionResizeRect(Af,Af.src.startPos);AZ.addClass(this.resizeRect,"resizing");}else{this.cbTableScrollTop=this.cbTableContainer.scrollTop;this._super(Af);if(!Ag||!Ag.isScrollBar){this.clearSelectedTargets();AZ.toggleClass(this.domNode,"gm-legend-hover",false);AZ.toggleClass(this.domLegend,"active",false);this.cbTableContainer.scrollTop=this.cbTableScrollTop;this.domLegend.style.background=this.bgColor;this.isDragging=true;}}},ondragmove:function D(Af){var Ah=Af.src.e.target,Ag;if(Ah===this.splitter){Ag=this.getSplitterPosition(Af);Ah.style.left=Ag+u;this.positionResizeRect(Af,Ag);}else{this._super(Af);}},ondragend:function(Af){var Ah=Af.src.e.target;if(Ah===this.splitter){AZ.removeClass(this.resizeRect,"resizing");this.splitterMoved(this.getSplitterPosition(Af)-Af.src.startPos,Af.src.posInfo);}else{this._super(Af);var Ag=Af.src.data;if(!Ag||!Ag.isScrollBar){this.cbTableContainer.scrollTop=this.cbTableScrollTop;this.domLegend.style.background="transparent";this.isDragging=false;}delete this.cbTableScrollTop;}if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(true);}},onscroll:function(){var Ag,Ak,Aj=this.scrollNode.scrollTop,Ai,Ah,Af;if(this.prevScrpllTop===Aj){return ;}Ak=(this.dataArray&&this.dataArray.length)||0;for(Ag=0;Ag<Ak;Ag++){Ah=this.dataArray[Ag];if(Ah.dataType===AV.COLOR_BY){Af=Ah.dataObj;break;}}if(Af){Ai=this.cbTable;Ai.innerHTML="";Ai.appendChild(this.fillColorByTable(Af,Math.floor(Aj/AG)));this.prevScrpllTop=Aj;this.scrollNode.scrollTop=Aj;this._super();}},fillColorByTable:function(Av,Al){var Aw,At,Ah,Ak,Aj,Am,An,Ao=this.styles,Af,Ar=this.cutBy,Ap=this.width-2*Ab-2*A,Aq,Ai,Ag,Ax,As;Aq=Av.elements;At=Aq.length;Af=document.createDocumentFragment();Ai=Ap-v-AS;Ag=0;Ax=AG*At;As=Al*AG;function Au(Ay){Ah=document.createElement("tr");Ak=document.createElement("td");Ah.style.height=Ay+u;Ak[x]("class","gm-legend-colorbox");Ah.appendChild(Ak);Af.appendChild(Ah);}if(Al>0){Au(As);}for(Aw=Al;Aw<At;Aw++){Ah=document.createElement("tr");Ak=document.createElement("td");Aj=document.createElement("td");Am=document.createElement("div");An=document.createElement("div");Am[x]("class","gm-legend-colorbox-ctn-div");Am[x]("type",C.LGD_COLORBOX_CTN);An[x]("class","gm-legend-colorbox-div");An[x]("type",C.LGD_COLORBOX);F.call(this,Aq[Aw],An);Ah[x]("class","gm-legend-tr");Ah.style.height=AG+u;Ak[x]("class","gm-legend-colorbox");Aj[x]("class","gm-legend-desc");w.call(this,Aj,Aq[Aw].label,Aw,s,Ai,Ao);Am.appendChild(An);Ak.appendChild(Am);Ah.appendChild(Ak);Ah.appendChild(Aj);Af.appendChild(Ah);Ag+=AG;if(Ar&&(Ar+Ag-AG)>Ax){Au(Ax-Ag-As);break;}}return Af;},calculateDockedPositions:function(Ag,Aj){var Ai,Al=this.getWidth(),Af=this.getHeight(),Ah=this.dockedPositions,Ak=function(Am){switch(Am.pos){case i.LEFT_TOP:Am.x=0;Am.y=V;break;case i.LEFT_MIDDLE:Am.x=0;Am.y=Math.max(V,(Aj-Af)>>1);break;case i.LEFT_BOTTOM:Am.x=0;Am.y=Math.max(0,Aj-Af-V);break;case i.RIGHT_TOP:Am.x=Ag-Al;Am.y=V;break;case i.RIGHT_MIDDLE:Am.x=Ag-Al;Am.y=Math.max(V,(Aj-Af)>>1);break;case i.RIGHT_BOTTOM:Am.x=Ag-Al;Am.y=Math.max(0,Aj-Af-V);break;}};for(Ai=0;Ai<Ah.length;Ai++){Ak(Ah[Ai]);}this.updateDropZonePosition();},updateDropZonePosition:function(){var Af=this.getDockedPosition(),Ag=this.dropZoneNode.style;Ag.left=Af.x+u;Ag.top=Af.y+u;},updateDropZoneNode:function(Af){this._super(Af);this.dockPos=this.getSplitterDockPos();this.updateSplitter();},onmouseover:function(Af){var Ah=this.domLegend,Al=Af.getTarget(),Ai=Al.getAttribute("type"),Ak=this.widget,Ag;if(this.isDragging){return ;}var Aj=R.copy(this.styles);Aj.opacity+=0.4;AL.applyStyles2DomNode(this.domNode,Aj);if(y.contains(Ah,Al,true)){AZ.addClass(Ah,"active");}if(Ai===C.LGD_COLORBOX){Al=Al.parentNode;Ai=Al.getAttribute("type");}if(Ai===C.LGD_COLORBOX_CTN){Ag=Al.firstChild.identity;if(!Ag||!Ag.comb){return ;}AZ.toggleClass(Al,"hover-colorsquare",true);return ;}if(Ak.formattingMode){switch(Ai){case C.LGD_TITLE:case C.LGD_TEXT:AZ.toggleClass(Ah,"hover-txt",true);break;default:AZ.toggleClass(this.domNode,"gm-legend-hover",true);break;}}},onmouseout:function(Ag){var Ai=this.domLegend,Af=Ag.e.toElement||Ag.e.relatedTarget,Al=Ag.getTarget(),Aj=Al.getAttribute("type"),Ak=this.widget,Ah;AL.applyStyles2DomNode(this.domNode,this.styles);if(!y.contains(Ai,Af,true)){AZ.removeClass(Ai,"active");}if(Aj===C.LGD_COLORBOX){Al=Al.parentNode;Aj=Al.getAttribute("type");}if(Aj===C.LGD_COLORBOX_CTN){Ah=Al.firstChild.identity;if(!Ah||!Ah.comb){return ;}AZ.toggleClass(Al,"hover-colorsquare",false);return ;}if(Ak.formattingMode||Ak.isOnFormattingMode){switch(Aj){case C.LGD_COLORBOX_CTN:case C.LGD_COLORBOX:break;case C.LGD_TITLE:case C.LGD_TEXT:AZ.toggleClass(Ai,"hover-txt",false);break;default:AZ.toggleClass(this.domNode,"gm-legend-hover",false);break;}}},onclick:function(Af){var Ai=Af.getTarget(),Ag=Ai.getAttribute("type"),Ah=this.widget;if(Ai===this.triBtn){if(!this.autoCollapse){this.raiseEvent({name:"gm-legend-clicked",action:(this.isMinimal?"restore":"minimize")});}}else{if(Ai===this.closeBtn){this.raiseEvent({name:"gm-legend-clicked",action:"close"});}else{if(Ag===C.LGD_COLORBOX){Ai=Ai.parentNode;Ag=Ai.getAttribute("type");}if(Ah.formattingMode||Ah.isOnFormattingMode){if(Ag===C.LGD_COLORBOX_CTN){this.selectColorBox(Ai,true);}else{if(Ag===C.LGD_TEXT||Ag===C.LGD_TITLE){this.selectText();}else{this.selectLegendBody();}}}else{this.clearSelectedColorBox();}}}y.stopPropogation(null,Af.e);},attachClearEvent:function(){if(this.clearSelectTargetfn){return ;}var Ag=this,Af=this.domLegend;this.clearSelectTargetfn=function(Ak){var Aj=Ak.target,Ah=Ag.widget.toolEditor,Ai;if(!y.contains(Af,Aj,true,Af)){if(Ah){Ai=Ah.domNode;if(!y.contains(Ai,Aj,true,Ai)){Ag.clearSelectedTargets();}}else{Ag.clearSelectedTargets();}}};y.attachEvent(document.body,"mousedown",this.clearSelectTargetfn,true);},clearSelectedColorBox:function(){var Af=this.selectedColorBox;if(Af){AZ.toggleClass(Af,"select",false);AZ.toggleClass(Af,"selectfmt",false);this.selectedColorBox=undefined;}},clearSelectedText:function(){AZ.removeClass(this.domNode,"select-txt");},clearSelectedLegendBody:function(){AZ.removeClass(this.domNode,"gm-legend-select");},clearSelectedTargets:function(){this.clearSelectedColorBox();this.clearSelectedText();this.clearSelectedLegendBody();if(this.clearSelectTargetfn){y.detachEvent(document.body,"mousedown",this.clearSelectTargetfn,true);delete this.clearSelectTargetfn;}},selectColorBox:function(Ah,Ag){var Af=Ah.firstChild.identity;if(!Af||!Af.comb){return ;}this.clearSelectedText();this.clearSelectedLegendBody();if(this.selectedColorBox!==Ah){this.clearSelectedColorBox();this.selectedColorBox=Ah;if(Ag){AZ.toggleClass(Ah,"selectfmt",true);}else{AZ.toggleClass(Ah,"select",true);}this.attachClearEvent();}},selectText:function(){this.clearSelectedColorBox();this.clearSelectedLegendBody();AZ.addClass(this.domNode,"select-txt");this.attachClearEvent();},selectLegendBody:function(){this.clearSelectedColorBox();this.clearSelectedText();AZ.addClass(this.domNode,"gm-legend-select");this.attachClearEvent();},adjustColorPickerPos:function(Af){var Ai=y.position(Af),Ag=0,Ah={};if(this.currDockedPositionIdx<3){Ah.x=Ai.x+Ai.w+Ag;Ah.alignLeft=true;}else{Ah.x=Ai.x-Ag;Ah.alignLeft=false;}Ah.y=Ai.y+Ai.h+Ag;return Ah;},getSplitterInfo:function(Ak){if(!Ak){return{};}var Ag=this.dockPos,Aj={},Ai=this.width,Af=AH,Ah=Math.floor(this.GMW/3);Aj.dockPosition=Ag;if(Ag===AJ.LEFT){Aj.min=Math.min(Ai-Ah,0);Aj.max=Math.max(Ai-Af,0);}else{if(Ag===AJ.RIGHT){Aj.min=Af;Aj.max=Ah;}}Aj.min+=AN;Aj.max+=AN;return Aj;},splitterMoved:function(Af,Ag){if(Af===0){return ;}if(Ag.dockPosition===AJ.LEFT){Af=-Af;}this.raiseEvent({name:"gm-legend-resized",position:Af});this.updateSplitter();if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(true);}},updateSplitter:function(){AP(this.splitter,this.dockPos,this.width,this.height);this.resizeRect.style.height=this.height-2+u;}});Aa.GMLegend.applyHTML5Props=function(Ah){var Ai=parseInt(Ah.fontSize,10)||8,Ag;if(Ah.fontSize.indexOf("px")>=0){Ai=Math.floor(Ai*Y+0.5);}Ag=Math.floor(Ai/Y*E+0.5);G=Math.max(Ai,8)+9;AQ=Math.floor(Ai/Y+0.5);d=Math.max(Ag,15);AG=Math.max(Ag,20)+2;q=Math.max(Ag,14)+2;Ab=parseInt(Ah.borderWidth,10)||1;var Af=parseInt(Ah.tbHeight,10);k=isNaN(Af)?J:Af;};Aa.GMLegend.getLegendSize4MinMode=function(Ag,Ah){var Aj,Ai,Af=k+2*Ab;if(Ag){Ai=Ag.elements;Aj=Ai.length;Af+=AG*Aj;Af+=2*A;}Af=Math.min(Af,Ah-V*2);return{width:v+5+7+2*Ab,height:Af};};Aa.GMLegend.getLegendSize=function(At,Ai,Af,Al,Av,Am){var An,Ag,Au,Ak,Aj=Al-V*2,Ar=0,Ah=0,Aq={},Ap,Ao,As;if(!At||!At.length||At.length<1){return{};}if(Ai!==undefined){if(!Am){Am=Math.floor(AY(At,Av)*Ai);}Ak=Math.min(Am,Math.floor(Af/3));Ak=Math.max(Ak,50);return h(At,Ak,Al,Av);}Ak=Math.min(Math.floor(0.2*Af),300);for(An=0;An<At.length;An++){Ao=At[An];if(Ao.dataType===AV.COLOR_BY){Ap=AX(Ao.dataObj,Av);if(Ap>Ar){Ar=Ap;}}else{if(Ao.dataType===AV.SIZE_BY){Ap=AM(Ao.dataObj,Av);if(Ap>Ah){Ah=Ap;}}}}Ag=Math.max(Ar,Ah)+2*Ab;Aq.width=Math.min(Ag,Ak);Aq.scale=Aq.width/Ag;As=c(At,Aq.width,Av);Au=As.height;Aq.autoCollapse=As.minHeight>Aj;Aq.minHeight=As.minHeight;Aq.height=Math.min(Au,Aj);if(Au>Aj){Aq.cutBy=Au-Aj;}return Aq;};}());(function(){if(!window.env){window.env={};}var h=window.env;h.isDebugging=false;var v=h.isDebugging;function I(Aa){if(v){AE.visPrint(Aa);}}mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.num","mstrmojo.hash","mstrmojo.color","mstrmojo.dom","mstrmojo.Base","mstrmojo.Container","mstrmojo.Label","mstrmojo.VisBase","mstrmojo.ui.Pulldown","mstrmojo.VisMenuList","mstrmojo._VizSelectionHelper","mstrmojo._LoadsScript","mstrmojo.VisUtility","mstrmojo.VisEnum","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.vi._MonitorsAppState","mstrmojo.chart.common.Utility","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.util.color");mstrmojo.requiresClsP("mstrmojo.ui.menus","MenuConfig","_HasMenuPopup","EditorConfig");mstrmojo.requiresClsP("mstrmojo.gm","GMLegend","GMUtility","EnumLegendSlot","_SupportDndAsBlackBox");mstrmojo.requiresClsP("mstrmojo.netviz","_SupportNetworkBrushesAndHighlights","VisNetworkStage","ObservableModel","PropertyParser","_ForceDirectedLayout","_CircularLayout","_LinearLayout");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_HasVisSelections","selectors._IsMultiUnitControl","selectors._BrushesAndHighlights","_XtabDE");var AR={lgdBgFillClr:[15461355,1710618],lgdBgFillStyle:[0,0],lgdBgFillEff:[1,1],lgdBgFillTrans:[0,100],lgdFntSz:["8pt","8pt"],lgdFntFml:["Arial","Arial"],lgdFntStyle:[0,0],lgdFntClr:[6710886,16777215],lgdBdrShw:[false,false],lgdBdrClr:[11579568,5855577],lgdBdrThk:["1px","1px"],lgdBdrLnStyle:[0,0],lm:[0,0],lwr:[undefined,undefined]};function AG(Aa){var Ab={};mstrmojo.hash.keyarray(AR).forEach(function(Ac){Ab[Ac]=AR[Ac][Aa];});return Ab;}var c=mstrmojo,AQ=c.dom,AE=c.VisUtility,AW=c.num,Q=c.array,T=c.hash,AL=c.netviz.ObservableModel,x=c.util.color,AX=c.gm,S=AX.GMLegend,e=5,m=AX.EnumLegendSlot,AS=c.VisEnum.GMLegendDataType,G=c.chart.enums.EnumFontStyle,AT=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,W=c.VisEnum,AO=W.LegendPropertyTag,AH=W.EnumLegendMode,AK=AX.GMUtility,AD=W.NETWORK_AGGREGATION_METHOD,AB=W.NETWORK_PROPERTIES,k=W.NETWORK_LAYOUT,A=mstrmojo.vi.viz.EnumDSSDropZones,Z=mstrmojo.chart.model.enums.EnumDSSObjectType,b=W.NETWORK_MAX_NODE_SIZE_TYPE,y=W.NETWORK_MIN_NODE_SIZE_TYPE;var V=24,s=24,R=76,O=28;var p=[{pos:m.LEFT_TOP},{pos:m.LEFT_MIDDLE},{pos:m.LEFT_BOTTOM},{pos:m.RIGHT_TOP},{pos:m.RIGHT_MIDDLE},{pos:m.RIGHT_BOTTOM}];var AM=0.5;var AZ=W.SERVER_JSON_ERROR_TYPE;var H=[k.CIRCULAR,k.LINEAR,k.FORCE_DIRECTED];var M=50;var AN=4;var X=0.2;var i={};i[b.AUTOMATIC]={"size-by":0.9,"no-size-by":0.08};i[b.MANUAL]={"size-by":0.5,"no-size-by":0.16};var E=["click","contextmenu","mouseup"];function AF(Ah,Ae){function Aj(Ar){var Ap=Ag.getDropZone();var Aq={from:A.FromItem,to:A.ToItem};var As;Object.keys(Aq).some(function(At){var Au=At+".TemplateUnit.0.id";if(AE.getPropertyByPath(Ap,Au)===Ar){As=Aq[At];return true;}return false;});return As;}var Ag=this,Al={act:"updateTemplate",keyContext:Ag.k,actions:[]},Ab=Al.actions,Ao=[AE.pick(Ah,["did","t"])];var Ac=Ae.drillFromUnit.id;var Ad=Aj(Ac);if(Ad===undefined){return Al;}var Ak={id:Ad},Ai=Ag.zonesModel,Af=Ai.getZoneModelByZoneId(Ad),An=Af.items||[],Am;var Aa=AE.findInArray(An,function(Ap){return Ap.did===Ac;});if(Aa!==-1){Am=An[Aa];}if(Am){Ab.push(Ai.getRemoveDropZoneUnitAction(Ak,Am));Array.prototype.push.apply(Ab,Ai.getAddDropZoneUnitsActions(Ak,Ao,Am.idx));}return Al;}function D(){var Aa=this.propInfo.layoutMode,Ab=H[Aa];if(Ab===k.LINEAR){this.inputLinearIcon.checked=true;}else{if(Ab===k.CIRCULAR){this.inputCircularIcon.checked=true;}else{if(Ab===k.FORCE_DIRECTED){this.inputForceDirectedIcon.checked=true;}}}}function q(Ac){var Aa,Ab=p.length;for(Aa=0;Aa<Ab;Aa++){if(Ac===p[Aa].pos){return Aa;}}return -1;}function L(Aa,Ab){if(isNaN(Aa)){return"rgba(0,0,0,1)";}Aa=parseInt(Aa,10);if(isNaN(Ab)){Ab=1;}return x.getCSSColorString(Aa,Ab);}function AV(Aa){var Ab=0;Q.forEach(Aa,function(Ad){var Ac=parseFloat(Ad);if(!isNaN(Ac)){Ab+=Ac;}});return Ab;}var j={COUNT:"Count of",SUM:"Sum of",AVERAGE:"Average of",MIN:"Min of",MAX:"Max of"};var C={};C[j.COUNT]=function(Aa){return Aa.length;};C[j.SUM]=AV;C[j.AVERAGE]=function(Ab){var Aa=Ab.length;return(Aa>0?AV(Ab)/Aa:NaN);};C[j.MIN]=function(Ac){var Aa=Ac.length,Ae,Ad,Ab;if(Aa<1){return NaN;}Ae=Ac[0];for(Ad=1;Ad<Aa;Ad++){Ab=Ac[Ad];if(Ae>Ab){Ae=Ab;}}return Ae;};C[j.MAX]=function(Ad){var Ab=Ad.length,Aa,Ae,Ac;if(Ab<1){return NaN;}Aa=Ad[0];for(Ae=1;Ae<Ab;Ae++){Ac=Ad[Ae];if(Aa<Ac){Aa=Ac;}}return Aa;};function AU(Af){if(!this.range||!this.sizeRange){I("No value range or size range available, cannot calculate size.");return 0;}var Ab=this.range,Ad=this.sizeRange,Aa=Math.max(Ab.max,Ab.min*Ad.max/Ad.min);var Ae=Aa-Ab.min||Infinity;var Ac=(Af-Ab.min)/Ae*(Ad.max-Ad.min)+Ad.min;if(isNaN(Ac)){I("something wrong in linear interpolation");Ac=0;}return Ac;}function d(){var Aa=this.stage;if(Aa){if(Aa.parent!==undefined){this.removeChildren(Aa);}Aa.destroy();delete this.stage;}}var AY=0;var AP=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.netviz.VisNetwork.Node",init:function(Aa){this.adjacence=[];this.edges=[];this.properties={};this.range={};this.attribute={};this.attributeElements=[];this.aggregationName=0;this.aggregationMethod=null;this.itemSizeMetricName=null;this.size=0;this.style=null;this._super(Aa);this.id="x"+(++AY);},getAttributeName:function(){return this.hasSelfLoop?"Name":this.attribute&&this.attribute.name;},getName:function g(){var Aa="";Q.forEach(this.attributeElements||[],function(Ab){Aa+=(Ab.name+" ");});return Aa.slice(0,Aa.length-1);},getFormNames:function(){var Aa=[];Q.forEach(this.attribute.forms,function(Ab){Aa.push(Ab.name);});return Aa;},getFormValues:function(){var Aa=[];Q.forEach(this.attributeElements,function(Ab){Aa.push(Ab.name);});return Aa;},setAggregationMethod:function(){var Aa=j.SUM;this.aggregationMethodName=(this.properties&&this.properties.nodeSizeAggregation)||Aa;if(!AD.hasOwnProperty(this.aggregationMethodName)){this.aggregationMethodName=Aa;}this.aggregationMethod=C[this.aggregationMethodName];},getAggregatedValue:function(){if(!this.aggregationMethod){this.setAggregationMethod();}var Ac=this.edges,Ab=[],Ad,Aa;this.aggregationName=this.aggregationMethodName+" "+(this.itemSizeMetricName||"");if(this.itemSizeMetricName!==null){for(Ad=0,Aa=Ac.length;Ad<Aa;Ad++){var Ae=Ac[Ad];if(Ae&&Ae.itemSizeValue&&!Ae.isExcluded&&!isNaN(Ae.itemSizeValue)){Ab.push(Ae.itemSizeValue);}}return this.aggregationMethod(Ab);}return 0;},getSize:function(){if(isNaN(this.aggregatedValue)){this.aggregatedValue=this.getAggregatedValue();}return this.valueToSize(this.aggregatedValue);},valueToSize:function(Ah){var Ab=this.getNodeSizeRange();var Af=this.range;var Ac=Ab.min,Ag=Ab.max,Ae=Af.min,Aj=Af.max,Aa=Ab.area;var Ai,Ad;if(Ae===Aj){Ai=Ag;}else{Ad=(Ah-Ae)/(Aj-Ae);if(Aa){Ad=Math.sqrt(Ad);}Ai=Ac+(Ag-Ac)*Ad;}return Ai;},getNodeSizeRange:function(){var Ad=this.properties;var Af=this.range;var Ac=Ad.maxNodeSize;var Ag=Ad.minNodeSize;var Aj=Af.max,Ae=Af.min,Ak=false,Ah=M,Ab=AN;var Ai,Aa;if(this.isMetricSizeBy){switch(Ag.type){case y.PROPORTIONAL:Ai=Ac.ratio*Ah;if(Aj===0){Aa=Ab;}else{Aa=Ai*Math.sqrt(Ae/Aj);}Ak=true;break;case y.FULL_RANGE:Ai=Ac.ratio*Ah;Aa=Ab;break;case y.ADJUSTED_RANGE:Ai=Ac.ratio*Ah;Aa=Ai*Ag.ratio;break;default:Ai=Ac.ratio*Ah;Aa=Ab;break;}}else{Ai=Ah*Ac.ratio;Aa=Ai;}if(Ai<Ab){Ai=Ab;}if(Ai>Ah){Ai=Ah;}if(Aa<Ab){Aa=Ab;}return{min:Aa,max:Ai,area:Ak};},updateValues:function(){var Aa=this.getAggregatedValue();if(!isNaN(Aa)){if(this.itemSizeMetricName!==undefined&&this.itemSizeMetricName!==null&&this.properties.minNodeSize.type===y.PROPORTIONAL){if(Aa<0&&Math.abs(Aa)<this.range.min){this.range.minNegtive=true;}if(Aa<0&&Math.abs(Aa)>this.range.max){this.range.maxNegtive=true;}Aa=Math.abs(Aa);}this.aggregatedValue=Aa;this.range.min=Math.min(this.range.min,Aa);this.range.max=Math.max(this.range.max,Aa);}},updateStyles:function(){this.size=this.getSize();},update:function(){this.updateValues();this.updateStyles();},exclude:function(){this.isExcluded=true;this.sprite.isExcluded=true;var Ai=this.edges,Ae=Ai.length,Ac=this.adjacence,Aa=Ac.length,Aj;for(Aj=0;Aj<Ae;Aj++){var Ak=Ai[Aj];Ak.isExcluded=true;Ak.sprite.isExcluded=true;}for(Aj=0;Aj<Aa;Aj++){var Af=Ac[Aj],Ad=0,Ag=Af.edges,Ab=Ag.length,Ah;for(Ah=0;Ah<Ab;Ah++){if(!Ag[Ah].isExcluded){Ad++;}}if(Ad===0){Af.isExcluded=true;Af.sprite.isExcluded=true;}Af.update();}},format:function(Ac){if(this.edges&&this.edges.length){var Ab=this.edges[0];var Aa;if(this.aggregationMethodName===j.COUNT){Aa=null;}else{if(Ab&&Ab.values[Ab.indexes.nodeSizeMIndex]){Aa=Ab.values[Ab.indexes.nodeSizeMIndex].formatString;}else{Aa=null;}}return AW.formatByMask(Aa,Ac);}return Ac.toString();},getActionInfo:function(){var Ab=[],Aa=this;Q.forEach(Aa.attributeElements,function(Ac){Ab.push({n:Aa.attribute.name,tid:Aa.attribute.id,v:Ac.name,eid:Ac.id});});return Ab;}});var J=[13376797,16734244,16749895,16762209,6672939];J.MISSING=5066061;J.FIRST_PALETTE_COLOR=2062260;var n=mstrmojo.declare(mstrmojo.Base,[],{scriptClass:"mstrmojo.netviz.VisNetwork.Edge",sizeRange:{min:1,max:16},valueToWidth:AU,init:function(Aa){this.from=null;this.to=null;this.values=[];this.indexes={};this.properties={};this.range={};this.colorValueRange={};this.sizeValue=0;this.colorValue=0;this.itemSizeValue=0;this.width=0;this.color=0;if(this._super){this._super(Aa);}},update:function(){this.updateValues();this.updateStyles();},updateValues:function(){if(!this.values){return ;}var Aa=this.values[this.indexes.edgeColorMIndex],Ab=this.values[this.indexes.edgeSizeMIndex],Ac=this.values[this.indexes.nodeSizeMIndex];this.colorValue=Aa?parseFloat(Aa.value):"missing";this.sizeValue=Ab?parseFloat(Ab.value):"missing";this.itemSizeValue=Ac?parseFloat(Ac.value):"missing";if(!isNaN(this.sizeValue)){this.range.min=Math.min(this.sizeValue,this.range.min);this.range.max=Math.max(this.sizeValue,this.range.max);}if(!isNaN(this.colorValue)){this.colorValueRange.min=Math.min(this.colorValue,this.colorValueRange.min);this.colorValueRange.max=Math.max(this.colorValue,this.colorValueRange.max);}},updateStyles:function(){this.width=this.valueToWidth(this.sizeValue);},format:function(Ac,Ab){var Aa=(this.values[Ab]&&this.values[Ab].formatString)||null;return AW.formatByMask(Aa,Ac);}});function K(Ag,Ac){var Ai=mstrmojo.netviz.PropertyParser,Ab=Ai.BooleanProperty,Ah=Ai.IntegerProperty,Ad=Ai.FloatProperty,Aa=Ai.StringProperty,Af=Ai.JsonProperty;var Ae={showLegend:{key:AB.showLegend,type:Ab.preset(true)},showEdgeDirection:{key:AB.showEdgeDirection,type:Ab.preset(false)},showTransition:{key:AB.showTransition,type:Ab.preset(false)},nodeSizeAggregation:{key:AB.nodeSizeAggregation,type:Aa.preset(j.SUM)},minNodeSize:{key:AB.minNodeSize,type:Af.preset({type:y.PROPORTIONAL}),postSet:function(Al,Am,Aj,Ak){if(Al.type!==y.ADJUSTED_RANGE){Al.ratio=AN/M;}else{if(Al.ratio===undefined){Al.ratio=X;}}return Al;}},maxNodeSize:{key:AB.maxNodeSize,type:Af.preset({type:b.AUTOMATIC}),postSet:function(Am,An,Aj,Ak){var Al=Ag.hasSizeByMetric()?"size-by":"no-size-by";if(Am.type===b.AUTOMATIC||Am.type===b.MANUAL&&Am.ratio===undefined){Am.ratio=i[Am.type][Al];}return Am;}},themeType:{key:AB.themeType,type:Aa.preset("light"),preSet:function(Al,Am,Aj,Ak){return(parseInt(Al,10)===0)?"dark":"light";}},background:{key:AB.background,type:Af.preset({})},circleStyle:{key:AB.bubbleStyle,type:Af.preset({}),postSet:function(Am,An,Ak,Al){var Aj=Ak.shownodelabel;if(Am.showNodeLabel===undefined){Am.showNodeLabel=!!(Aj!==undefined&&Aj.toString()==="true");}return Am;}},circleLabelStyle:{key:AB.circleLabelFont,type:Af.preset({})},layoutMode:{key:AB.layoutMode,type:Ah.preset(0)},dragMode:{key:AB.dragMode,type:Ah.preset(W.NETWORK_DRAG_MODE.pan)},lgdBgFillClr:{key:AT.LEGEND_BG_COLOR,type:Af.preset(undefined)},lgdBgFillStyle:{key:AT.LEGEND_BG_FILL_STYLE,type:Aa.preset(undefined)},lgdBgFillEff:{key:AT.LEGEND_BG_FILL_EFFECT,type:Aa.preset(undefined)},lgdBgFillTrans:{key:AT.LEGEND_BG_FILL_TRANSPARENCY,type:Aa.preset(undefined)},lgdFntSz:{key:AT.LEGEND_FONT_SIZE,type:Aa.preset(undefined)},lgdFntFml:{key:AT.LEGEND_FONT_FAMILY,type:Aa.preset(undefined)},lgdFntStyle:{key:AT.LEGEND_FONT_STYLE,type:Ah.preset(undefined)},lgdFntClr:{key:AT.LEGEND_FONT_COLOR,type:Ah.preset(undefined)},lgdBdrShw:{key:AT.LEGEND_BORDER_SHOW,type:Ab.preset(undefined)},lgdBdrClr:{key:AT.LEGEND_BORDER_COLOR,type:Aa.preset(undefined)},lgdBdrStyle:{key:AT.LEGEND_BORDER_LINE_STYLE,type:Aa.preset(undefined)},lm:{key:AO.LEGEND_MODE,type:Ah.preset(undefined)},LegendPosition:{key:AO.LEGEND_POSITION,type:Ah.preset(2)},lwr:{key:AO.SCALE_LEGEND_WIDTH,type:Ad.preset(undefined)}};return new Ai().parse(Ac,Ae);}function AJ(Aa){function Ab(Ae){var Ac=Aa[Ae],Ad=Ac&&(Ac.TemplateUnit||Ac.TemplateMetric);return(Ad&&Ad[0])||{};}return{edgeColor:Ab("ColorBy"),edgeSize:Ab("SizeBy"),itemSize:Ab("itemsz"),from:Ab("from"),to:Ab("to")};}var AA=["at","dei","dpt","o","tui","ui"];function U(Bi,BO,Af){BO=BO||{};BO.nodeValueRange=BO.nodeValueRange||{min:Infinity,max:-Infinity};BO.edgeValueRange=BO.edgeValueRange||{min:Infinity,max:-Infinity};BO.edgeColorValueRange=BO.edgeColorValueRange||{min:Infinity,max:-Infinity};BO.circleStyle.fromNode.shape=BO.circleStyle.fromNode.shape||"Circle";BO.circleStyle.toNode.shape=BO.circleStyle.toNode.shape||"Circle";var Ae=[],A4=[],Bf=[],BK=[],Be={};var Ap=Af.edgeColor.id,Ak=Af.edgeSize.id,BY=Af.itemSize.id,BP=Af.from.id,Ar=Af.to.id;var Ax={nodes:Ae,edges:A4,nodesIdHash:Be,attributes:Bf,metrics:BK,indexes:{edgeColorMIndex:-1,edgeSizeMIndex:-1,nodeSizeMIndex:-1,fromIndex:-1,toIndex:-1},modifiedNodes:[],formNameDisplayType:Bi.lnm};var BX=this.model;function Bj(Bx,By,Bw){return new AP({attribute:Bx,attributeElements:By,adjacence:[],edges:[],properties:BO,range:BO.nodeValueRange,isMetricSizeBy:BY!==undefined,attSrc:Bx.id===Bw?"from":"to",shape:Bx.id===Bw?BO.circleStyle.fromNode.shape:BO.circleStyle.toNode.shape});}function BE(By,Bx,Bw){return new n({from:By,to:Bx,values:[],indexes:Bw,properties:BO,range:BO.edgeValueRange,colorValueRange:BO.edgeColorValueRange});}var BT=Bi.gts.row;var BR=Bi.gts.col;var Bc=Bi.ghs.rhs.items;var BB=Bi.gvs.items||[];var Am={};var An=true,Ag;Q.forEach(BT,function(Bz,By){var B0=[],Bw=[],Bx;Q.forEach(Bz.es,function(B1){B0.push({id:B1.id,name:B1.n});});Q.forEach(Bz.fs,function(B1){Bw.push({name:B1.n});});Ag=BX.supportsViewFilterActions(Bz.id);An=An&&Ag;Bx={id:Bz.id,name:Bz.n,elements:B0,supportsViewFilter:Ag,forms:Bw,formsLength:(Bz.fs&&Bz.fs.length)||1};if(Bz.sc!==undefined){Bx.sc=Bz.sc;}Bf.push(Bx);Am[Bz.id]=By;});Ax.allSupportsViewFilter=An;var BZ=(Bi.gsi&&Bi.gsi.mx)||[];try{Q.forEach(BZ,function(Bw,Bx){BK.push({id:Bw.did,name:Bw.n,formatString:AE.getNumberFormat(Bi,Bx)||""});Am[Bw.did]=Bx;});}catch(Bv){mstrmojo.err(Bv);}var BM=Ax.indexes;BM.edgeColorMIndex=Am[Ap];BM.edgeSizeMIndex=Am[Ak];BM.nodeSizeMIndex=Am[BY];BM.fromIndex=Am[BP];BM.toIndex=Am[Ar];var Ao=[];if(BM.edgeColorMIndex!==undefined){var A2=Bi.gsi&&Bi.gsi.thresholds[BK[BM.edgeColorMIndex].id],BC;if(A2!==undefined&&A2.length>0){for(BC=0;BC<A2.length;BC++){if(A2[BC].fmt&&A2[BC].fmt.bc){Ao[BC]=mstrmojo.VisUtility.parseCSSColor(A2[BC].fmt.bc);}else{Ao[BC]=J.FIRST_PALETTE_COLOR;}}}}var Ay={max:-Infinity,min:Infinity};if(AE.isOnExpressMode()){var A7=BM.edgeColorMIndex;Q.forEach(BB,function(Bx){var Bw=Bx&&Bx.items&&Bx.items[A7];if(Bw){Ay.max=Math.max(Ay.max,Bw.rv);Ay.min=Math.min(Ay.min,Bw.rv);}});}var A5={},Ad={};var Ac=(Bc&&Bc.length)||0,BJ,BI,BG,Bh,Aj,Bu,Bb,Bm,A6,Bp,Ab,BU,Br,Bn,A3,BF,Ai,BH=AA.length,Av,BQ,BW;for(BJ=0;BJ<Ac;++BJ){Bh=Bc[BJ].items;Aj=Bh.length;Bu=[];Bb=0;Bm=1;BW=1;if(Bi.gts.row[0].cs){BW=Bi.gts.row[0].cs;}if(Bf[0].formsLength>1){BW=Bf[0].formsLength;}for(BI=0;BI<Aj;BI+=BW,Bb++){if(Bb!==BM.fromIndex&&Bb!==BM.toIndex){Bu.push(null);continue;}A6=Bf[Bb];Bp=A6.elements;Ab=[];BU="";Bm=A6.formsLength;Av=[];for(BG=BI;BG<BI+Bm;BG++){A3=Bh[BG];Br=Bp[A3.idx];if(Av.indexOf(Br)===-1){for(BF=0;BF!==BH;BF+=1){Ai=AA[BF];Br[Ai]=A3[Ai];}BU+=Br.name;Av.push(Br);Ab.push(Br);}}if(!A5[BU]){BQ=Bj(A6,Ab,BP,Ar);A5[BU]=Be[BQ.id]=BQ;Ae.push(BQ);}else{Bn=A5[BU];if(Bn.attSrc==="to"&&BI===0){Bn.attSrc="from";Bn.shape=BO.circleStyle.fromNode.shape;}if(Bn.attribute!==A6){Bn.hasSelfLoop=true;Bn.secondaryAttribute=A6;Bn.secondaryAttributeElements=Ab;}}Bu.push(A5[BU]);}var Bg=Bu[BM.fromIndex],BL=Bu[BM.toIndex];try{if(Bg&&BL){var Au=BE(Bg,BL,Ax.indexes),A8=Au.from.id+Au.to.id,Aw=Au.to.id+Au.from.id,Bs,Az=BB[BJ]?BB[BJ].items:[];if(Az!==null){var Ba=BK.length;for(BI=0;BI<Ba;++BI){var At={},Bd=BK[BI],A0=Az[BI];At.metricName=Bd.name;At.value=A0.rv;At.formatString=Bd.formatString;Au.values[BI]=At;if(BM.edgeColorMIndex!==undefined&&BM.edgeColorMIndex===BI&&Ao.length>0){var BV=A0.ti;if(BV===undefined&&AE.isOnExpressMode()){var BD,As=Ay.max,Bt=Ay.min,Bl=A0.rv;if(As===Bt){BD=0;}else{BD=(Bl-Bt)/(As-Bt);}if(BD<0.1){BV=0;}else{if(BD>=0.1&&BD<0.3){BV=1;}else{if(BD>=0.3&&BD<0.5){BV=2;}else{if(BD>=0.5&&BD<0.7){BV=3;}else{if(BD>=0.7&&BD<0.9){BV=4;}else{if(BD>=0.9){BV=5;}}}}}}}Au.color=L(Ao[BV],AM);}}if(BM.edgeColorMIndex===undefined||Ao.length===0){Au.color=L(J.MISSING,AM);}}if(Ad[A8]){var BN=Ad[A8],BS=Au.values||[],Al=BS.length,Ah;for(Ah=0;Ah<Al;Ah++){BN.values[Ah].value+=BS[Ah].value;}}else{Bs=Ad[Aw];if(Bs){Au.reversedEdge=Bs;Bs.reversedEdge=Au;}Ad[A8]=Au;A4.push(Au);Bg.adjacence.push(BL);Bg.edges.push(Au);if(Bg!==BL){BL.adjacence.push(Bg);BL.edges.push(Au);}}}}catch(Bv){mstrmojo.err(Bv);}}Q.forEach(A4,function(Bw){Bw.updateValues();});Q.forEach(A4,function(Bw){Bw.updateStyles();});var Bk=BM.nodeSizeMIndex,A9=(BK[Bk]&&BK[Bk].name)||null;Q.forEach(Ae,function(Bw){Bw.itemSizeMetricName=A9;Bw.updateValues();});Q.forEach(Ae,function(Bw){Bw.updateStyles();});Q.forEach(BO.modifiedNodes,function(Bx){var Bw=A5[Bx.name];if(Bw){Bw.style=Bx.style;if(Ax.modifiedNodes.indexOf(Bw)===-1){Ax.modifiedNodes.push(Bw);}else{I("warning: duplicated nodes are store in the server.");}}});function Bq(Bw){var Bx;Q.forEach(BR[0].es,function(By){if(By.oid===Bw){Bx=By.n;return false;}});return Bx;}function BA(Bx,By){var Bw;if(isNaN(By)){Bw="--";}else{Bw=Bx.format(By);}return Bw;}function Bo(){if(Af&&Af.itemSize&&Af.itemSize.id){var Bz=Ax.nodes[0]||new AP(),Bx={},B2=[],B3=Bz.range.minNegtive?(-Bz.range.min):Bz.range.min,By=Bz.range.maxNegtive?(-Bz.range.max):Bz.range.max,B1,B0,Bw;B1=parseFloat(By);if(By===B3){B1=parseFloat(By);B2.push({label:BA(Bz,B1)});}else{[By,B3].forEach(function(B4){B1=parseFloat(B4);B2.push({label:BA(Bz,B1)});});}Bx.item=mstrmojo.desc(13616,"Item size:")+" "+Bq(Af.itemSize.id);if(B2.length>1){B0=Bx.elements=[];Q.forEach(B2,function(B4){B0.push({sign:"=",v:B4.label});});Bx.caseFlag=0;}else{if(B2.length===1){Bx.elements=[{diameter:12,shape:"rect",sign:"=",v:B2[0].label}];Bx.caseFlag=2;}}return Bx;}}Ax.itemSizeByInfo=Bo();function Aq(Bx,B1,B4,By){var B6=[];if(!B4||B4.length<2){for(BJ=0;BJ<By;BJ++){B6.push(Bx);}return B6;}var B5=(B1-Bx)/(By-1),Bz=B4[2]?(B4[2]-B4[1]):(B4[1]-B4[0]),B2,B0=B4[1],Bw=1,B3,B7;while(Bz<1){Bz*=10;Bw/=10;}while(Bz>=10){Bz/=10;Bw*=10;}B6.push(Bx);while(B0>Bx){B0-=Bw;}for(BJ=1;BJ<By-1;BJ++){B2=parseFloat(Bx+BJ*B5);B7=Number.POSITIVE_INFINITY;B3=Math.abs(B2-B0);while(B3<B7){B7=B3;B0+=Bw;B3=Math.abs(B2-B0);}B0-=Bw;B6.push(B0);}B6.push(B1);return B6;}function A1(){if(Af&&Af.edgeSize&&Af.edgeSize.id){var By=Ax.edges[0]||new n(),B6=5,B5=[],Bw,B0={},B7=By.range.min,CA=By.range.max,B2=By.indexes.edgeSizeMIndex,B8,Bz=c.chart.common.Utility,B9,Bx,B1,B3,B4=[];if((!B7&&B7!==0)||(!CA&&CA!==0)||!isFinite(B7)||!isFinite(CA)||(CA<B7)){B4.push("Error");}else{if(B7===CA){B4.push(B7);}else{B9=Bz.prepareScalePlateOptions(false,0,4);Bx=Bz.getScalePlate(true);Bx.computeTicks(B9,4,CA,B7);Bx.GetTicks(B4);B4=Aq(B7,CA,B4,B6);}}for(B1=0,B3=B4.length;B1<B3;B1++){if(!isFinite(B4[B1])){B8="--";}else{B8=By.format(B4[B1],B2);}B5.push({label:B8});}B0.item=mstrmojo.desc(13617,"Edge size:")+" "+Bq(Af.edgeSize.id);Bw=B0.elements=[];Q.forEach(B5,function(CB){Bw.push({sign:"<",v:CB.label});});B3=Bw.length;if(B3===5){Bw[0].sign="=";Bw[4].sign="=";}if(B3===1){Bw[0].sign="=";}B0.caseFlag=3;return B0;}}Ax.edgeSizeByInfo=A1();function Aa(B4){var Bw=Af&&Af.edgeColor&&Af.edgeColor.id,B3=Bi.gsi.mx,Bz;if(Bw&&B4!==undefined){Q.forEach(B3,function(B5){if(B5.did===Bw){Bz=B5;}});if(Bz){var B0=B4[Bw];if(B0&&B0.length>0&&B0[0].fmt&&B0[0].fmt.bc){var B2=mstrmojo.VisUtility.getRankMode(B0),By=AE.getNumberFormat(Bi,Ax.indexes.edgeColorMIndex),B1=By?mstrmojo.VisUtility.getColorByFormatStr(By.replace(/\'/g,'"'),B2):"",Bx=mstrmojo.VisUtility.getColorByItems(B0,B2,Bz.max,Bz.min,Bz.cnt,B1,L(J.FIRST_PALETTE_COLOR));return{item:mstrmojo.desc(13618,"Edge color:")+" "+mstrmojo.VisUtility.getColorByTitle(Bq(Bw),B2),elements:Bx};}}}}Ax.edgeColorByInfo=Aa(Bi.gsi.thresholds);return Ax;}function AC(){function Ac(Ah,Ak,Aj){var Ag=this.propInfo,Ai;Ag.unmarshal(Ah,Ak);Ai=Ag[Ah];if(Aj){this.observableModel[Ah].setValue(Ai,true);}return Ai;}function Af(Ag,Ai,Ah,Ak){function Aj(An,Am){var Al=this.legend;if(!Al||!Al.hasRendered){return ;}Ac.call(this,Ag,An,Am);this.initHTML5Props(this.HTML5PROPS);Al.updateStyle(this.HTML5PROPS.LEGEND);if(Ak){Al.updateTitleLineHeight();this.hEvalSize4Legend();this.updateLegend();Al.updateSplitter();this.updateStageContentForLegendChanged(p[Al.currDockedPositionIdx].pos);}}Aj.call(this,Ai);this.setProperty(Ah,this.propInfo.marshal(Ag),{suppressData:true,clientUndoRedoCallback:Aj});}function Ae(Ah){return function Ag(Aj){var Ai=Aj.newValue;function Ak(An,Am){var Al=this.propInfo;Ac.call(this,Ah,An,Am);Al.nodeValueRange={min:Infinity,max:-Infinity};Al.edgeValueRange={min:Infinity,max:-Infinity};Al.edgeColorValueRange={min:Infinity,max:-Infinity};this.abstractedModel=U.call(this,this.modelData,Al,this.dropZoneInfo);this.generateSprites(this.abstractedModel,this.stage);this.refresh();}Ak.call(this,Ai);this.setProperty(AB[Ah],this.propInfo.marshal(Ah),{suppressData:true,clientUndoRedoCallback:Ak});};}var Aa=this.propInfo,Ad=["showEdgeDirection","showTransition","nodeSizeAggregation","layoutMode","lgdBgFillTrans","lgdBgFillClr","lgdFntClr","lgdFntSz","lgdFntFml","lgdFntStyle","showLegend","maxNodeSize","minNodeSize"],Ab=this.addDisposable(new AL(Ad.reduce(function(Ag,Ah){Ag[Ah]=Aa[Ah];return Ag;},{})));Ab.showEdgeDirection.attachEventListener("valueChanged",this.id,function(Ai){var Ah=Ai.newValue,Ag="showEdgeDirection";function Aj(Am,Al){var Ak=Ac.call(this,Ag,Am,Al);this.stage.showEdgeDirection=Ak;this.stage.draw(false,true,true);}Aj.call(this,Ah);this.setProperty(AB.showEdgeDirection,this.propInfo.marshal(Ag),{suppressData:true,clientUndoRedoCallback:Aj});});Ab.showTransition.attachEventListener("valueChanged",this.id,function(Ai){var Ah=Ai.newValue,Ag="showTransition";function Aj(Am,Al){var Ak=Ac.call(this,Ag,Am,Al);this.stage.showTransition=Ak;}Aj.call(this,Ah);this.setProperty(AB.showTransition,this.propInfo.marshal(Ag),{suppressData:true,clientUndoRedoCallback:Aj});});Ab.nodeSizeAggregation.attachEventListener("valueChanged",this.id,Ae("nodeSizeAggregation"));Ab.maxNodeSize.attachEventListener("valueChanged",this.id,Ae("maxNodeSize"));Ab.minNodeSize.attachEventListener("valueChanged",this.id,Ae("minNodeSize"));Ab.layoutMode.attachEventListener("valueChanged",this.id,function(Ai){var Ah=Ai.newValue,Ag="layoutMode";function Aj(Am,Al){var Ak=Ac.call(this,Ag,Am,Al);D.call(this);this.layoutSprites(this.abstractedModel,this.stage,H[Ak]);this.stage.draw(this.propInfo.showTransition,true,true);}Aj.call(this,Ah);this.setProperty(AB.layoutMode,this.propInfo.marshal(Ag),{suppressData:true,clientUndoRedoCallback:Aj});});Ab.lgdBgFillTrans.attachEventListener("valueChanged",this.id,function(Ag){Af.call(this,"lgdBgFillTrans",Ag.newValue,AB.lgdBgFillTrans);});Ab.lgdBgFillClr.attachEventListener("valueChanged",this.id,function(Ag){Af.call(this,"lgdBgFillClr",Ag.newValue,AB.lgdBgFillClr);});Ab.lgdFntClr.attachEventListener("valueChanged",this.id,function(Ag){Af.call(this,"lgdFntClr",Ag.newValue,AB.lgdFntClr);});Ab.lgdFntSz.attachEventListener("valueChanged",this.id,function(Ag){Af.call(this,"lgdFntSz",Ag.newValue,AB.lgdFntSz,true);});Ab.lgdFntFml.attachEventListener("valueChanged",this.id,function(Ag){Af.call(this,"lgdFntFml",Ag.newValue,AB.lgdFntFml,true);});Ab.lgdFntStyle.attachEventListener("valueChanged",this.id,function(Ag){Af.call(this,"lgdFntStyle",Ag.newValue,AB.lgdFntStyle,true);});Ab.showLegend.attachEventListener("valueChanged",this.id,function(Ai){var Ah=Ai.newValue,Ag="showLegend";function Aj(Am,Al){var Ak=Ac.call(this,Ag,Am,Al);this.toggleLegend(Ak);this.updateStageContentForLegendChanged(p[this.legend.currDockedPositionIdx].pos,(Aa.showLegend?this.legendW:0));}Aj.call(this,Ah);this.setProperty(AB.showLegend,this.propInfo.marshal(Ag),{suppressData:true,clientUndoRedoCallback:Aj});});return Ab;}function AI(){var Ad=this.selectedSprites,Ac,Ab,Aa;for(Ac=0,Ab=Ad.length;Ac!==Ab;Ac++){Aa=Ad[Ac].unit.attribute;if(!Aa.supportsViewFilter){return false;}}return true;}function l(Ac,Aa){var Ab=this.menuAnchor;if(!Ab){Ab=document.createElement("div");Ab.id=this.id+"-netviz-menu-anchor";Ab.style.position="absolute";document.body.appendChild(Ab);this.menuAnchor=Ab;}Ab.style.left=Aa.pageX+"px";Ab.style.top=Aa.pageY+"px";this.configurePopup(Ac,Ab);this.openPopup(Ac.newInstance());}function w(){function Ac(Af){var Ae=AE.getPropertyByPath(this,"modelData.gts.row",[]);var Ad=AE.findInArray(Ae,function(Ag){return Ag.id===Af;});if(Ad!==-1){return Ae[Ad];}}function Ab(){var Ad=this.getDropZone();var Ae=this;return["to","from"].map(function(Ag){var Aj=Ag+".TemplateUnit.0.id";var Ai=AE.getPropertyByPath(Ad,Aj);var Af=Ac.call(Ae,Ai);var Ah=AE.pick(Af,["n","id"]);Ah.title=Ah.n;return Ah;});}var Aa=this;return function(){return new mstrmojo.ui.menus.EditorConfig({cssClass:"base-on-calculation-editor",data:{},contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11859,"Based on")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"attributeList",items:Ab.call(Aa),selectedIndex:0},{scriptClass:"mstrmojo.VisMenuList",alias:"candidateList",itemField:"n",items:AE.getDrillCandidates(Aa)}],bindings:{okEnabled:"this.valid",valid:function(){return this.data.valid;}},fnOk:function(Ah,Af){var Ae=AE.getPropertyByPath(Af,"candidateList.selectedItem");var Ag=AE.pick(Af.attributeList.getSelectedItem(),["id","n"]);Aa.doSelection(function Ad(Aj){var Ai=Ag.id;return Aj.filter(function(Ak){return Ak.hasSelfLoop||Ak.attribute.id===Ai;}).map(function(Al){var Ak=Al;if(Al.hasSelfLoop&&Al.attribute.id!==Ai){Ak={attribute:Al.secondaryAttribute,attributeElements:Al.secondaryAttributeElements};}return Ak;});});AE.doDrill(Aa,Ae,AF,{drillFromUnit:Ag});}});};}function F(){var Ac=this.abstractedModel.allSupportsViewFilter||AI.call(this.stage),Ae=new mstrmojo.ui.menus.MenuConfig(),Ag=new mstrmojo.ui.menus.MenuConfig(),Ab={filter:Ae,showData:Ag},Af=this,Ad=function(Aj){var Ai=Af.stage.selectedSprites;var Ah=N(Ai);if(Ah.isSameAttr){return AE.getDrillMenuItemsCallback(Af,Aj,{drillFromUnit:AE.pick(Ah.nonLoopAttr,["id","n"])});}else{return w.call(Af);}};if(Ac){Ae.addMenuItem(mstrmojo.desc(11701,"Keep only"),"xt",this.getMenuHandler("keepOnly"));Ae.addMenuItem(mstrmojo.desc(3946,"Exclude"),"xt",this.getMenuHandler("exclude"));var Aa=AE.getDrillCandidates(this);if(Aa.length>0){Ae.addPopupMenuItem(mstrmojo.desc(145,"Drill"),this.id,Ad(this.getMenuHandler("drill")),"xt");}else{Ae.addNonInteractiveMenuItem(mstrmojo.desc(145,"Drill"),"",true);}Ag.addMenuItem(mstrmojo.desc(13537,"Show Data..."),"xt",this.getMenuHandler("showData"));}return Ab;}function N(Ab){var Aa,Ac=Ab.every(function(Af){var Ae=Af.unit,Ad=Ae.attribute;if(!Ae.hasSelfLoop){if(Aa===undefined){Aa=Ad;}return Aa===Ad;}return false;});return{isSameAttr:Ac,allSelfloops:Aa===undefined,nonLoopAttr:Aa};}function r(Ad){if(Ad.length===0){return{isSameAttr:false,allSelfloops:false,selection:[]};}var Ac=N(Ad),Af=Ac.isSameAttr,Ab=Ac.allSelfloops,Ae=Ac.nonLoopAttr;var Aa=Ad.reduce(function(Ah,Ak){var Aj=Ak.unit,Ag=Aj.attribute,Ai;if(Aj.hasSelfLoop){if(Ab||Ag!==Ae){Ai={attribute:Aj.secondaryAttribute,attributeElements:Aj.secondaryAttributeElements};Ah.push({text:Ak.text,unit:Ai,title:Ai.attribute.name});}if(Ab||Ag===Ae){Ai={attribute:Ag,attributeElements:Aj.attributeElements};Ah.push({text:Ak.text,unit:Ai,title:Ag.name});}}else{Ai={attribute:Ag,attributeElements:Aj.attributeElements};Ah.push({text:Ak.text,unit:Ai,title:Ag.name});}return Ah;},[]);return{allSelfloops:Ab,isSameAttr:Af,selection:Aa};}function a(){var Ab={};if(mstrApp.isAppStatePresentation()){return Ab;}var Af=this.stage.selectedSprites,Ad,Aa,Ag,Ae=function(Ah){return Ah.text;},Ac=function(Ah){return Ah;};if(Af&&Af.length>0){Ad=r(Af);Af=Ad.selection;Aa=Ad.allSelfloops;if(!Aa&&Ad.isSameAttr){Ag=this.getCellForNode(Af[0]);Ab=AE.getGroupAndCalculationContextMenu(this,Ag,{selection:Af,skipSingleAttrCheck:true,fnCellName:Ae});}else{if(Aa){Ab=AE.getGroupAndCalculationContextMenuForDataPoints(this,{selection:Af,fnCellName:Ae,fnUnique:Ac,fnMakeNode:Ac});}}}return Ab;}function P(Ab){var Aa=0,Ae=0,Ac=0;function Ad(Af){if(Af.isExcluded){return ;}var Ag=Af.sprite.getGeometry();Aa++;if(!isNaN(Ag.s)){Ae+=Ag.s*2;if(Ac<Ag.s){Ac=Ag.s;}}}Q.forEach(Ab.nodes,Ad);return{circleCount:Aa,dimension:Ae,maxR:Ac};}function u(Ab){var Aa=Ab.nodes.reduce(function(Af,Ae,Ad){Af[Ae.id]=Ad;return Af;},{});Ab.nodes.sort(function Ac(Ae,Ad){var Ah=Ae.sprite.getGeometry().s,Ag=Ad.sprite.getGeometry().s,Af;if(Ah>Ag){Af=1;}else{if(Ah===Ag){Af=Aa[Ae.id]>Aa[Ad.id]?1:-1;}else{Af=-1;}}return Af;});}mstrmojo.netviz.VisNetwork=mstrmojo.declare(mstrmojo.VisBase,[mstrmojo._VizSelectionHelper,mstrmojo._LoadsScript,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.vi.ui.rw._XtabDE,mstrmojo.vi.ui._IsDropTarget,mstrmojo.gm._SupportDndAsBlackBox,mstrmojo.netviz._ForceDirectedLayout,mstrmojo.netviz._CircularLayout,mstrmojo.netviz._LinearLayout,mstrmojo.netviz._SupportNetworkBrushesAndHighlights,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.netviz.VisNetwork",localProps:null,normalizedIdCache:{},markupString:'<div class="VisNetwork network-{@themeType}-theme mil-{@themeType} gm-{@themeType}-theme" id={@id} style="position: absolute; left: {@left}px; top: {@top}px; width: {@width}px; height: {@height}px; z-index: 1;" mstrAttach:'+E.join(",")+'><div style="width: {@width}px; height:{@height}px;"></div><div></div><div class="_layoutIcons" style="position: absolute; right: '+V+"px; top: "+s+"px; width: "+R+"px; height: "+O+'px"><input id="{@id}-inputForceDirectedIcon" class="_inputForceDirectedIcon" type="radio" name="{@id}-layoutTypes" style="display:none;"><label for="{@id}-inputForceDirectedIcon" class="_forceDirectedIcon" style=""></label><input id="{@id}-inputCircularIcon" class="_inputCircularIcon" type="radio" name="{@id}-layoutTypes" style="display:none;"><label for="{@id}-inputCircularIcon" class="_circularIcon" style=""></label><input id="{@id}-inputLinearIcon" class="_inputLinearIcon" type="radio" name="{@id}-layoutTypes" style="display:none;"><label for="{@id}-inputLinearIcon" class="_linearIcon" style=""></label></div>',markupSlots:{stageContainer:function(){return this.domNode.firstChild;},legendPlaceholder:function(){return this.domNode.childNodes[1];},modeSwitchButton:function(){return this.domNode.childNodes[2];},inputForceDirectedIcon:function(){return this.domNode.childNodes[2].childNodes[0];},forceDirectedIcon:function(){return this.domNode.childNodes[2].childNodes[1];},inputCircularIcon:function(){return this.domNode.childNodes[2].childNodes[2];},circularIcon:function(){return this.domNode.childNodes[2].childNodes[3];},inputLinearIcon:function(){return this.domNode.childNodes[2].childNodes[4];},linearIcon:function(){return this.domNode.childNodes[2].childNodes[5];}},init:function(Aa){this._super(Aa);this.modeSwitchButtonRect={r:V,t:s,w:R,h:O};this.HTML5PROPS={};this.localProps={};this.canOnlyDragOnTitleBar=true;},update:function(Ab){var Ad,Ae,Ai,Aa,Ac;AK.startTimer({functionName:"VisNetwork.update",purpose:"JSON loading and consuming"});Ad=this._super(Ab);if(Ad!==false){this.clearError();Ai=this.model.data||{};Aa=Ai.egt;Ac=Ai.eg;if(Aa!==undefined||Ac!==undefined){this.setError(Ac,Aa);return Ad;}this.modelData=this.model.data;this.dropZoneInfo=AJ(this.getDropZone());this.propInfo=K(this,this.getProperties());var Ah=this.getFormats()["background-color"];if(Ah===undefined){Ah=this.propInfo.themeType==="dark"?"#333333":"#ffffff";}this.propInfo.background={value:Ah,opacity:1};this.observableModel=AC.call(this);d.call(this);Ae=this.propInfo;this.stage=this.addDisposable(new mstrmojo.netviz.VisNetworkStage({owner:this,slot:"stageContainer",showTransition:Ae.showTransition,showEdgeDirection:Ae.showEdgeDirection,themeType:Ae.themeType,background:T.clone(Ae.background),circleStyle:T.clone(Ae.circleStyle),circleLabelStyle:T.clone(Ae.circleLabelStyle),dragMode:Ae.dragMode}));this.propInfo.circleStyle=this.stage.observableModel&&this.stage.observableModel.circleStyle;this.layoutMode=H[Ae.layoutMode];this.themeType=Ae.themeType;if(AE.isOnExpressMode()&&this.dropZoneInfo.edgeColor.id){var Ag=this.modelData.gsi;if(Object.keys(Ag.thresholds).length===0){var Af=this.dropZoneInfo.edgeColor;Ag.thresholds=AE.getMockUpThresholds(Af.id,Af.n);}}if(AE.hasMergedRowCells(this.modelData)){this.error=mstrmojo.desc(13702,"The Network doesn't support grid data with merged row cell. Please disable cell merge and retry");}else{if(this.dropZoneInfo.from.id||this.dropZoneInfo.to.id){if(Ae.showLegend&&!this.hasSizebyOrColorby()){Ae.showLegend=false;}this.abstractedModel=U.call(this,this.modelData,Ae,this.dropZoneInfo);this.generateSprites(this.abstractedModel,this.stage);}else{this.setError(null,AZ.NO_TEMPLATE_UNIT);}}}AK.endTimer();return Ad;},getColorByMetric:function(){return AE.getMetricsInDropZone(this.zonesModel,mstrmojo.vi.viz.EnumDSSDropZones.ColorBy)[0]||null;},hasSizebyOrColorby:function(){return AE.getPropertyByPath(this,"dropZoneInfo.edgeColor.id",false)||AE.getPropertyByPath(this,"dropZoneInfo.edgeSize.id",false)||AE.getPropertyByPath(this,"dropZoneInfo.itemSize.id",false);},hasSizeByMetric:function(){return AE.getPropertyByPath(this,"dropZoneInfo.itemSize.t")===Z.DssTypeMetric;},setError:function(Ac,Ab){var Aa=AE.translateGridError(Ac,Ab);this.error=Aa.msg;this.errorType=Aa.type;},clearError:function(){this.error=undefined;this.errorType=undefined;},hasError:function(){return this.error!==undefined||this.errorType!==undefined;},isEmpty:function(){return this.hasError();},getVisEmptyMsgControls:function(){var Ab=this.error,Aa=this.errorType,Ac;if(!this.hasError()){return ;}switch(Aa){case AZ.NO_DATASET:case AZ.NO_TEMPLATE_UNIT:Ac=[{scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:Ab}];break;case AZ.AE_ERROR:Ac=[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:AE.getVisEmptyMsg("AE_ERROR"),markupSlots:{containerNode:function(){return this.domNode;}}}];break;default:Ac=[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:'<div class="{@cssClass}"><div class="error-content">'+Ab+"</div></div>",markupSlots:{containerNode:function(){return this.domNode;}}}];break;}return Ac;},preBuildRendering:function(){if(this.waitingForData){return ;}this._super();var Aa=this.stage;if(Aa){Aa.height=parseInt(this.height,10);Aa.width=parseInt(this.width,10);if(!this.hasError()&&!this.waitingForData){this.defaultsLegendPop=AG.call(this,(this.themeType==="light"?0:1));this.initHTML5Props(this.HTML5PROPS);}}},postBuildRendering:function(){if(this.waitingForData){return ;}if(this.isEmpty()){if(AE.isOnExpressMode()){AE.renderWidgetErrorRSD(this,this.error,E);}else{this._super();}return ;}this.addChildren(this.stage);this.stage.render();this.initLegend();D.call(this);this.layoutSprites(this.abstractedModel,this.stage,H[this.propInfo.layoutMode]);this.stage.draw(false);this.attachEventListener("click",this.id,this.onclick);var Aa=this.getExp(),Ab=this.getRowsAndCols();AE.modifyScExp(Aa,Ab,this.model,this.normalizedIdCache);if(this._super){this._super();}},destroy:function(){if(this.legend){this.legend.hideToolbar();}d.call(this);delete this.modelData;delete this.propInfo;delete this.legend;delete this.abstractedModel;if(this._super){this._super();}},getProperties:function(){return(this.modelData&&this.modelData.vp)||{};},getProperty:function(Aa){var Ab=this.getProperties();return Ab[Aa];},getDropZone:function(){var Ab=this.modelData&&this.modelData.dz;if(!AE.isValidDropZone(Ab)){Ab={};var Ag=this.model&&this.model.data;if(Ag){var Ac=Ag.gts||{},Ad=Ac.row||[],Af=(Ac.col&&Ac.col[0]&&Ac.col[0].es)||[],Ah=["from","to"],Aa=["SizeBy","ColorBy","itemsz"],Ae=[{units:Ad,unitKeys:Ah,setKey:"TemplateUnit"},{units:Af,unitKeys:Aa,setKey:"TemplateMetric"}];Q.forEach(Ae,function(Ai){Q.forEach(Ai.units,function(Ak,Am){var Aj=Ai.unitKeys[Am];if(Aj){var Al={};Al[Ai.setKey]=[{id:Ak.oid||Ak.id,t:Ak.otp}];Ab[Aj]=Al;}});});}}return Ab;},onAppStateChange:function z(Aa){this._super(Aa);if(!this.selectorControl){this.clearSelections(true);}},onclick:function(Aa){delete this.noHighlightAfterKeepOnlyExcludeDrill;var Ad=Aa.e||Aa,Ac=Ad.target,Ab;if(Ac===this.circularIcon){Ab="0";}if(Ac===this.linearIcon){Ab="1";}if(Ac===this.forceDirectedIcon){Ab="2";}if(Ab){this.observableModel.layoutMode.setValue(Ab);}this.stage.dismissLassoSelector();if(this.legend){this.legend.hideToolbar();}},oncontextmenu:function(Aa){delete this.noHighlightAfterKeepOnlyExcludeDrill;var Ab=Aa.getTarget();Aa.cancel();Aa.preventDefault();if(this.legend){if(AQ.contains(this.legend.domNode,Ab,true)){this.legend.handleRMCOnLegend(Aa);}else{this.legend.hideToolbar();}}},onmouseup:function(Aa){var Ac=Aa.e||Aa,Ad=this.stage,Ab=Ac.target||Ac.srcElement;if(!AQ.contains(Ad.domNode,Ab,true)){Ad.dismissLassoSelector();}},initLegend:function(){var Ab=0,Aa=0;this.hEvalSize4Legend();if(this.propInfo.showLegend){this.renderLegend();var Ac=p[this.legend.currDockedPositionIdx];Ab=this.isOnRight(Ac.pos)?0:this.legendW;if(this.isLegendSwitchOverlap()){Aa=V+this.modeSwitchButtonRect.w;this.modeSwitchButtonRect.r=this.legendW+V;}else{this.modeSwitchButtonRect.r=V;}}this.modeSwitchButton.style.right=this.modeSwitchButtonRect.r+"px";this.stage.setMainRect({x:Ab,y:0,w:parseInt(this.width-Aa-this.legendW,10),h:parseInt(this.height,10)});},hEvalSize4Legend:function(){var Af,Ad=this.abstractedModel.edgeColorByInfo,Ac=this.abstractedModel.itemSizeByInfo,Ab=this.abstractedModel.edgeSizeByInfo,Ae=this.getWidth(),Aa=this.getHeight(),Ag=this.HTML5PROPS.LEGEND,Ah;if(this.propInfo.showLegend===false){this.legendW=this.legendH=this.legendP=0;}else{S.applyHTML5Props(Ag);this.legendP=e;Ah=this.readGlobalProperty(AO.SCALE_LEGEND_WIDTH);if(Ah===undefined||!this.legendScale||this.legendScale!==Ah){this.legendScale=Ah;this.legendResized=true;this.legendFixedW=undefined;}Af=S.getLegendSize([{dataType:AS.COLOR_BY,dataObj:Ad},{dataType:AS.SIZE_BY,dataObj:Ac},{dataType:AS.SIZE_BY,dataObj:Ab}],this.legendResized?this.legendScale:undefined,Ae,Aa,Ag,this.legendFixedW);this.legendCutBy=Af.cutBy;this.legendMinHeight=Af.minHeight;this.legendFixedW=Af.width;if(Af.scale){this.legendScale=Af.scale;}if(this.readGlobalProperty(AO.LEGEND_MODE)===AH.MINIMIZED||Af.autoCollapse){Af=S.getLegendSize4MinMode(Ad,Aa);this.legendCutBy=undefined;}this.legendW=Af.width;this.legendH=Af.height;}},hInitLegendListeners:function(){var Aa=this,Ab=this.id;if(this.legend){this.legendResizeListener=this.legend.attachEventListener("gm-legend-resized",Ab,function(Ac){Aa.onLegendResized(Ac.position);});this.legendClickListener=this.legend.attachEventListener("gm-legend-clicked",Ab,function(Ac){Aa.onLegendClicked(Ac);});}},onLegendResized:function(Ac){function Aa(){var Ad=this.legend;if(Ad){this.hEvalSize4Legend();this.updateLegend();Ad.updateAfterResize();this.updateStageContentForLegendChanged(p[Ad.currDockedPositionIdx].pos);}}function Ab(Ae,Ad){if(Ad){this.legendScale=Ae;this.legendResized=true;this.legendFixedW=undefined;Aa.call(this);}}if(this.legend){this.legendFixedW=this.legendW+Ac;this.legendScale=(this.legendFixedW)/(this.legendW/this.legendScale);this.legendResized=true;this.writeLgendFormatProperty(AO.SCALE_LEGEND_WIDTH,this.legendScale,{success:Ab});Aa.call(this);}},onLegendClicked:function(Aa){var Ac=Aa.action,Ab=this.legend,Ad={success:function(){this.hEvalSize4Legend();this.updateLegend();this.updateStageContentForLegendChanged(p[Ab.currDockedPositionIdx].pos);}};if(Ac==="close"){this.observableModel.showLegend.setValue(false);return ;}if(Ac==="minimize"){this.writeLgendFormatProperty(AO.LEGEND_MODE,AH.MINIMIZED,Ad);}else{if(Ac==="restore"){this.writeLgendFormatProperty(AO.LEGEND_MODE,AH.RESTORED,Ad);}}},renderLegend:function(){var Aa=this.legendPlaceholder;if(!this.propInfo.showLegend){Aa.style.display="none";}Aa.style.width=this.legendW+"px";Aa.style.height=this.legendH+"px";this.legend=this.addDisposable(new AX.GMLegend({widget:this,model:this.model,placeholder:Aa,currDockedPositionIdx:q(this.readGlobalProperty(AO.LEGEND_POSITION)),cutBy:this.legendCutBy,cssClass:"gm-legend",styles:this.HTML5PROPS.LEGEND,readGlobalProperty:function(Ab){return this.widget.readGlobalProperty(Ab);},writeGlobalProperty:function(Ab,Ac){this.widget.writeLgendFormatProperty(Ab,Ac,{success:function(){this.widget.reRender();}.bind(this)});},configureLegendPopup:function(Ab,Ac){return this.widget.configurePopup(Ab,Ac);}}));this.legend.render();this.legend.parent=this;this.legend.cutBy=this.legendCutBy;this.legend.minHeight=this.legendMinHeight;this.legend.updateContainerSize(this.getWidth(),this.getHeight());this.legendPlaceholder=this.legend.domNode;this.hInitLegendListeners();this.legend.feedData([{dataType:AS.COLOR_BY,dataObj:this.abstractedModel.edgeColorByInfo},{dataType:AS.SIZE_BY,dataObj:this.abstractedModel.edgeSizeByInfo},{dataType:AS.SIZE_BY,dataObj:this.abstractedModel.itemSizeByInfo}],(this.readGlobalProperty(AO.LEGEND_MODE)===AH.MINIMIZED));},showMenu:l,showSelectionMenu:function(Ab,Ac){var Aa;if(!AE.isOnExpressMode()){Aa=this.getSelectionMenuConfig();if(!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign()&&Ac){if(Aa.hasMenuItems()){Aa.addSeparator();}Aa.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",Ac);}if(Aa.hasMenuItems()){this.showMenu(Aa,Ab);}}},showBlankSpaceMenu:function(Aa,Ab){if(!AE.isOnExpressMode()&&!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign()){this.showMenu(this.getBlankSpaceMenuConfig(Ab),Aa);}},getSelectionMenuConfig:function(){var Aa=AE.mergeHashes(F.call(this),a.call(this)),Ab=[{name:"filter"},{name:"editGroup"},{name:"editCalculation"},{name:"createDe"},{name:"showData"},{name:"renameDe"}];return AE.mergeMenuConfigs(Aa,Ab);},getFormatMenuConfig:function(){var Aa=this.addDisposable(new mstrmojo.ui.menus.MenuConfig()),Ab=AE.getPropertyByPath(this,"stage.observableModel.circleStyle.showNodeLabel"),Ad=!!(Ab&&Ab.getValue()),Ac;if(Ad){Ac=mstrmojo.desc(13688,"Hide Node Label");}else{Ac=mstrmojo.desc(12079,"Show Node Label");}Aa.addMenuItem(Ac,"xt",function(){Ab.setValue(!Ad);});return Aa;},getBlankSpaceMenuConfig:function(Ac){var Aa=this.addDisposable(new mstrmojo.ui.menus.MenuConfig()),Ab=this;Ac=Ac||function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");};Aa.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",Ac);if(this.hasSizebyOrColorby()){if(!Ab.propInfo.showLegend){Aa.addMenuItem(mstrmojo.desc(12001,"Show Legend"),"xt",this.getMenuHandler("showLegend"));}}return Aa;},getLocalProp:function(Aa){return this.localProps[Aa];},setLocalProp:function(Ab,Aa){this.localProps[Ab]=Aa;},unrender:function(){if(this.legendResizeListener){this.legendResizeListener.clear();}if(this.legendClickListener){this.legendClickListener.clear();}if(this.legend){this.legend.unrender();}if(this.stage){this.removeChildren(this.stage);}if(this.menuAnchor){document.body.removeChild(this.menuAnchor);this.menuAnchor=undefined;}if(this._super){this._super();}},generateSprites:function o(Ab,Ac){function Ad(Ae){Ae.sprite=Ac.createSprite({type:"Circle",position:{x:0,y:0,r:Ae.size},text:Ae.getName(),title:Ae.getAttributeName(),attSrc:Ae.attSrc,forms:Ae.getFormNames(),formValues:Ae.getFormValues(),displayValue:Ae.format(Ae.getAggregatedValue()),aggregationName:Ae.itemSizeMetricName?Ae.aggregationName:null,unit:Ae,style:Ae.style,selfLoop:Ae.hasSelfLoop});Ac.addSprite(Ae.sprite);}function Aa(Ae){Ae.sprite=Ac.createSprite({type:"Edge",from:Ae.from.sprite,to:Ae.to.sprite,controlPoint:{x:Ac.width/2,y:Ac.height/2},color:Ae.color,width:Ae.width,unit:Ae});Ac.addSprite(Ae.sprite);}Ac.clearSprites();Q.forEach(Ab.nodes,Ad);Q.forEach(Ab.edges,Aa);},getSelectedNodes:function(){return AE.pluck((this.stage.selectedSprites||[]).filter(function(Aa){return Aa.type==="Circle"&&Aa.unit;}),"unit");},keepOnly:function(){var Aa=this.abstractedModel.nodes,Ah=Aa.length,Ai=this.getSelectedNodes(),Ad=Ai.length,Af,Ab;for(Af=0;Af<Ad;Af++){Ab=Ai[Af];var Ac=Ab.adjacence,Ag=Ac.length,Ae;for(Ae=0;Ae<Ag;Ae++){if(!Ac[Ae].isExcluded&&Ai.indexOf(Ac[Ae])===-1){Ai.push(Ac[Ae]);}}}for(Af=0;Af<Ah;Af++){Ab=Aa[Af];if(Ai.indexOf(Ab)===-1){Ab.exclude();}}this.stage.draw(false);},exclude:function(){var Ac=this.getSelectedNodes(),Aa=Ac.length,Ab;for(Ab=0;Ab<Aa;Ab++){Ac[Ab].exclude();}this.stage.draw(false);},getSelectedNodesInfo:function(){var Aa=[];Q.forEach(this.getSelectedNodes(),function(Ab){Aa.push(Ab.getActionInfo());});return Aa;},getMenuHandler:function(Ab){var Ag=this,Aj=this._super(Ab);if(Aj!==mstrmojo.emptyFn){return Aj;}var Ac={keepOnly:function Ad(){Ag.updateAfterKeepOnly(true);Ag.noHighlightAfterKeepOnlyExcludeDrill=true;},exclude:function Ai(){Ag.updateAfterKeepOnly(false);Ag.noHighlightAfterKeepOnlyExcludeDrill=true;},drill:function Af(Ak){AE.doDrill(Ag,Ak.ctxt.drillUnit,AF,Ak.ctxt);Ag.noHighlightAfterKeepOnlyExcludeDrill=true;},showData:function Ae(){Ag.showData(Ag.getSelectedNodesInfo());},showLegend:function Ah(){Ag.observableModel.showLegend.setValue(true);},hideLegend:function Aa(){Ag.observableModel.showLegend.setValue(false);}};if(Ac.hasOwnProperty(Ab)){return Ac[Ab];}return mstrmojo.emptyFn;},doSelection:function(Aa){this.prepareSelectedNodesInfo(Aa);this.endSelections();},onStylesModified:function(Ac,Ad,Af){var Ae=function(Ag){return function(Aj,Ai){var Ah=this.propInfo;Ah.unmarshal(Ag,Aj);Af.call(this.stage,Ah[Ag],Ai);};};var Aa={circleStyle:function(Ag){this.setProperty(AB.bubbleStyle,Ag,{suppressData:true,clientUndoRedoCallback:Ae("circleStyle")});},background:function(Ag){this.propInfo.background=Ag;},circleLabelStyle:function(Ag){this.setProperty(AB.circleLabelFont,Ag,{suppressData:true,clientUndoRedoCallback:Ae("circleLabelStyle")});},dragMode:function(Ag){this.setProperty(AB.dragMode,Ag,{suppressData:true,clientUndoRedoCallback:Ae("dragMode")});}};if(Aa[Ac]){this.propInfo[Ac]=Ad;var Ab=Aa[Ac];if(Ab instanceof Function){Ab.call(this,this.propInfo.marshal(Ac));}}},layoutSprites:function(Ab,Ac,Aa){AK.startTimer({functionName:"VisNetwork.layoutSprites",purpose:"layout the bubbles"});u(Ab);Q.forEach(Ab.nodes,function(Ad){Ad.sprite.setGeometry({s:Ad.size});});Q.forEach(Ab.edges,function(Ad){Ad.sprite.setGeometry({s:Ad.width});});this.layouts[Aa].call(this,Ab,Ac,P(Ab));Ac.setScene();AK.endTimer();},readGlobalProperty:function(Aa){var Ab;switch(Aa){case AT.LEGEND_BG_COLOR:Ab=this.propInfo.lgdBgFillClr;break;case AT.LEGEND_BG_FILL_STYLE:Ab=this.propInfo.lgdBgFillStyle;break;case AT.LEGEND_BG_FILL_EFFECT:Ab=this.propInfo.lgdBgFillEff;break;case AT.LEGEND_BG_FILL_TRANSPARENCY:Ab=this.propInfo.lgdBgFillTrans;break;case AT.LEGEND_FONT_SIZE:Ab=this.propInfo.lgdFntSz;break;case AT.LEGEND_FONT_FAMILY:Ab=this.propInfo.lgdFntFml;break;case AT.LEGEND_FONT_STYLE:Ab=this.propInfo.lgdFntStyle;break;case AT.LEGEND_FONT_COLOR:Ab=this.propInfo.lgdFntClr;break;case AT.LEGEND_BORDER_SHOW:Ab=this.propInfo.lgdBdrShw;break;case AT.LEGEND_BORDER_COLOR:Ab=this.propInfo.lgdBdrClr;break;case AT.LEGEND_BORDER_LINE_STYLE:Ab=this.propInfo.lgdBdrStyle;break;case AT.COLOR_SQUARE_COLOR:Ab=this.propInfo.clrSqrClr;break;case AO.LEGEND_MODE:Ab=this.propInfo.lm;break;case AO.LEGEND_POSITION:Ab=this.propInfo.LegendPosition;break;case AO.SCALE_LEGEND_WIDTH:Ab=this.propInfo.lwr;break;}if(Ab===undefined||((typeof Ab)==="number"&&isNaN(Ab))){Ab=this.defaultsLegendPop[Aa];}return Ab;},initHTML5Props:function(Ac){function Ab(Ae,Ad){Ae.fontWeight=(Ad&G.FS_BOLD?"bold":"normal");Ae.fontStyle=(Ad&G.FS_ITALIC?"italic":"normal");if((Ad&G.FS_STRIKETHROUGH)&&(Ad&G.FS_UNDERLINE)){Ae.textDecoration="line-through underline";}else{if(Ad&G.FS_STRIKETHROUGH){Ae.textDecoration="line-through";}else{if(Ad&G.FS_UNDERLINE){Ae.textDecoration="underline";}else{Ae.textDecoration="none";}}}}var Aa={};Aa.fontFamily=this.readGlobalProperty(AT.LEGEND_FONT_FAMILY);Aa.fontSize=this.readGlobalProperty(AT.LEGEND_FONT_SIZE);Ab(Aa,this.readGlobalProperty(AT.LEGEND_FONT_STYLE));Aa.color=AK.decodeColor(this.readGlobalProperty(AT.LEGEND_FONT_COLOR));Aa.backgroundColor=AK.decodeColor(this.readGlobalProperty(AT.LEGEND_BG_COLOR));Aa.opacity=this.readGlobalProperty(AT.LEGEND_BG_FILL_TRANSPARENCY)/100;if(this.readGlobalProperty(AT.LEGEND_BORDER_SHOW)){Aa.borderWidth=AE.translateLineStyle(this.readGlobalProperty(AT.LEGEND_BORDER_LINE_STYLE)).width;Aa.borderStyle=AE.translateLineStyle(this.readGlobalProperty(AT.LEGEND_BORDER_LINE_STYLE)).style;Aa.borderColor=AK.decodeColor(this.readGlobalProperty(AT.LEGEND_BORDER_COLOR));}Ac.LEGEND=Aa;},configurePopup:function t(Aa,Ab){Aa.hostId=this.id;Aa.hostElement=Ab;},writeLgendFormatProperty:function(Ac,Ad,Af){var Ab=!!(Af&&Af.success),Ae=function(Ai,Ah){var Ag=this.propInfo;Ag.unmarshal(Ac,Ai);if(Ab){Af.success.call(this,Ag[Ac],Ah);}},Aa;if(Ac===AT.COLOR_SQUARE_COLOR){this.propInfo.unmarshal(Ac,Ad);this.setProperty(Ac,Ad,{callback:Af});}else{if(this.observableModel[Ac]){Aa=this.observableModel[Ac];Aa.setValue(Ad);}else{Ae.call(this,Ad,false);this.setProperty(Ac,Ad,{suppressData:true,clientUndoRedoCallback:Ab?Ae:undefined});}}},onLegendDropZoneChange:function Y(Aa,Ab){this.setLegendSlot(Aa,Ab);},onLegendDropped:function(Aa){this.writeLgendFormatProperty(AO.LEGEND_POSITION,Aa,{success:function(Ac,Ab){if(Ab){this.renderLegend();this.updateStageContentForLegendChanged(Ac);}}});},setLegendSlot:function(Ad,Ag){var Af=this.legend.currDockedPositionIdx;if(Ag!==Af){var Aa=this.isOnRight(p[Af].pos),Ae=this.isOnRight(Ad.pos),Ab=this.isOnRightTop(p[Af].pos),Ac=this.isOnRightTop(Ad.pos);if(Aa!==Ae||(Aa&&Ae&&Ab!==Ac)){this.updateStageContentForLegendChanged(Ad.pos);}}},isOnRight:function(Aa){return(Aa===m.RIGHT_MIDDLE||Aa===m.RIGHT_TOP||Aa===m.RIGHT_BOTTOM);},isOnRightTop:function(Aa){return Aa===m.RIGHT_TOP;},isLegendSwitchOverlap:function(){var Ad=AQ.position(this.legend.domNode),Ab=AQ.position(this.modeSwitchButton),Ac=Ad.x,Aj=Ad.y,Af=Ac+Ad.w,Ah=Aj+Ad.h,Aa=Ab.x,Ai=Ab.y,Ae=Aa+Ab.w,Ag=Ai+Ab.h;return !(Ac>=Ae||Aj>=Ag||Aa>=Af||Ai>=Ah);},updateStageContentForLegendChanged:function(Ad,Ac){var Ab=0,Aa=0;Ac=(typeof Ac==="number")?Ac:this.legendW;this.modeSwitchButtonRect.r=V;if(this.propInfo.showLegend){Ad=Ad||this.readGlobalProperty(AO.LEGEND_POSITION);Ab=this.isOnRight(Ad)?0:Ac;if(this.isLegendSwitchOverlap()){Aa=V+this.modeSwitchButtonRect.w;this.modeSwitchButtonRect.r=Ac+V;}}this.stage.setMainRect({x:Ab,y:0,w:parseInt(this.width-Aa-Ac,10),h:parseInt(this.height,10)});this.modeSwitchButton.style.right=this.modeSwitchButtonRect.r+"px";D.call(this);this.stage.setScene();this.stage.draw(false);},updateLegend:function(){var Aa=this.legend,Ac=this.abstractedModel,Ab=this.legendPlaceholder.style;Ab.width=this.legendW+"px";Ab.height=this.legendH+"px";Aa.width=this.legendW;Aa.height=this.legendH;Aa.cutBy=this.legendCutBy;Aa.minHeight=this.legendMinHeight;Aa.updateContainerSize(this.getWidth(),this.getHeight());Aa.feedData([{dataType:AS.COLOR_BY,dataObj:Ac.edgeColorByInfo},{dataType:AS.SIZE_BY,dataObj:Ac.edgeSizeByInfo},{dataType:AS.SIZE_BY,dataObj:Ac.itemSizeByInfo}],(this.readGlobalProperty(AO.LEGEND_MODE)===AH.MINIMIZED));Aa.updateAfterResize();},toggleLegend:function(Aa){var Ac=this.legend,Ab;if(!Ac||!Ac.hasRendered||!Ac.domNode){this.initLegend();Ac=this.legend;}Ab=Ac.domNode.style;if(!Aa){Ac.hideToolbar();Ab.display="none";}else{if(Ab.display!=="block"){Ab.display="block";}}},getCellForNode:function f(Ab){var Ad=Ab.unit,Aa=Ad.attribute,Ac=Ad.attributeElements[0];return{at:Ac.at,dei:Ac.dei,dpt:Ac.dpt,o:Ac.o,n:Ab.title,tui:Ac.tui,ui:Ac.tui,axis:1,v:Ab.text,tid:Aa.id};},getCellUnitIndex:function B(Aa){return Aa.o;},execFormatHandler:function(){var Aa=this.stage;if(Aa){Aa.execFormatHandler();}},onNDECreated:function(Aa){var Ac=this.stage,Ab=Ac.spriteCollection;Aa.forEach(function(Ag){var Ad=Ag.id,Af=Ag.unitId;var Ae=AE.findInArray(Ab,function(Ah){var Ai=Ah.unit;return Ah.type==="Circle"&&Ai.attribute.id===Af&&Ai.attributeElements.some(function(Aj){return Aj.id.indexOf(Ad)!==-1;});});if(Ae!==-1){Ac.addToSelection(Ab[Ae]);}});Ac.draw(false,true);},isClearAllEnabled:function(Ab){var Aa=AE.getPropertyByPath(this,"modelData",{}),Ac=AE.getPropertyByPath(Ab,"attribute.sc",Aa.sc);return !!(Ac===undefined||Ac.showall);}});}());