(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom,D=Math;mstrmojo.gm._IsAnchorable={PLACEMENT_ABOVE:1,PLACEMENT_BELOW:2,PLACEMENT_LEFT:3,PLACEMENT_RIGHT:4,anchor:null,anchorPosition:null,boundary:null,boundaryPosition:null,popupNodeName:"infoNode",tipNodeName:"tipNode",baseTipClass:"arrow",infoNodeOffset:25,popupNodeOffset:0,placementOrder:[this.PLACEMENT_ABOVE,this.PLACEMENT_BELOW,this.PLACEMENT_LEFT,this.PLACEMENT_RIGHT],hasScrollbars:function G(){return(!mstrApp.isTouchApp||!mstrApp.isTouchApp());},positionDialog:function E(){if(!this.anchorPopup()){if(typeof this._super==="function"){this._super();}}},positionTipNode:function A(I){var J=this.baseTipClass,K=this[this.tipNodeName];K.className=J+" "+I;},getTipDimension:function B(){var J=this[this.tipNodeName],I=C.position(J);return I;},anchorPopup:function F(){this.positionTipNode("top");var K=this.anchor,b=this.boundary,n=this[this.popupNodeName],q=this.infoNodeOffset,h=this.popupNodeOffset,k=this.hasScrollbars(),Y=this.anchorPosition||C.position(K,true),M=this.boundaryPosition||C.position(b,true),s=M.w,L=M.h,c=n.offsetWidth,O=n.offsetHeight,U=c/2,I=O/2,W=this.getTipDimension(),g=D.min(W.h,W.w),P=D.max(W.h,W.w)/2;if(k){s-=15;L-=15;}var Z=C.contains(b,n),j=Z?0:M.y,r=s/2-U,Q=L/2-I+j,m=-1000,t=-1000;if(Z){Y.x=Y.x-M.x;Y.y=Y.y-M.y;}var f=Y.y+Y.h,N=Y.x+Y.w,e=Y.x>c,o=((N+c)<s),R=Y.y>O,l=((f+O)<L),T=this,V=function(i,v,u){return D.min(D.max(i,u),D.max(v,0));},d=function(){if((Y.x<s)&&R){var i=Y.x+(Y.w/2);T.positionTipNode("bottom");t=Y.y-g-h;Q=t-O+q;r=V(0,s-c,i-U);m=V(Y.x,N,i)-P;return true;}return false;},J=function(){if((Y.x<s)&&l){var i=Y.x+(Y.w/2);T.positionTipNode("top");t=f+h;Q=t+g-q;r=V(0,s-c,i-U);m=V(Y.x,N,i)-P;return true;}return false;},a=function(){if((Y.y<L)&&e){var i=Y.y+(Y.h/2);T.positionTipNode("right");m=Y.x-g-h;r=m-c+q;Q=V(j,L-O,i-I);t=V(Y.y,f,i)-P;return true;}return false;},X=function(){if((Y.y<L)&&o){var i=Y.y+(Y.h/2);T.positionTipNode("left");m=N+h;r=m+g-q;Q=V(j,L-O,i-I);t=V(Y.y,f,i)-P;return true;}return false;},S=[],p;for(p=0;p<this.placementOrder.length;p++){switch(this.placementOrder[p]){case this.PLACEMENT_ABOVE:S.push(d);break;case this.PLACEMENT_BELOW:S.push(J);break;case this.PLACEMENT_LEFT:S.push(a);break;case this.PLACEMENT_RIGHT:S.push(X);break;}}for(p=0;p<S.length;p++){if(S[p]()){break;}}Q=D.round(Q);r=D.round(r);t=D.round(t);m=D.round(m);this.applyPopupNodePos(Q,r,t,m);return true;},applyPopupNodePos:function H(K,J,M,I){var O=this[this.tipNodeName],L=O.style,P=this[this.popupNodeName],N=P.style;L.top=M+"px";L.left=I+"px";N.top=K+"px";N.left=J+"px";}};}());(function(){var E=false;mstrmojo.requiresCls("mstrmojo.Base");mstrmojo.netviz.PropertyParser=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.netviz.PropertyParser",methods:{unmarshal:function(W,V){var U=this;U._withConfig({unmarshal:true},function(){U.parsedProps[W]=V;});},marshal:function(V){var U=this;return U._withConfig({marshal:true},function(){return U.parsedProps[V];});}},init:function(U){if(this._super){this._super(U);}this.config={marshal:false,unmarshal:false};this.parsedProps={};},parse:function(V,X){var W=this,Y=this.parsedProps,U=this.methods;this.raw=V;this.schema=X;Object.keys(U).forEach(function(Z){W.defineMethod(Z,U[Z]);});Object.keys(X).forEach(function(Z){var a=X[Z];W.defineProperty(Z,a.type);Y.unmarshal(Z,V[a.key]);});return Y;},defineProperty:function(U,c){var b=this,W=b.config,a=this.parsedProps,V=(this.schema||{})[U]||{},g=V.preSet,Y=V.postSet,X=V.preGet,d=V.postGet,f=V.key,e=this.raw,Z;if(!T(c)){throw new TypeError("type does not implement required methods");}Object.defineProperty(a,U,{enumerable:true,get:function(){var h=Z;if(h!==undefined&&W.marshal){if(X instanceof Function){h=X.call(a,h,U,e,f);}h=c.marshal(h);if(d instanceof Function){h=d.call(a,h,U,e,f);}}return h;},set:function(i){var h=i;if(W.unmarshal){if(g instanceof Function){h=g.call(a,h,U,e,f);}h=c.unmarshal(h);if(Y instanceof Function){h=Y.call(a,h,U,e,f);}}if(h!==undefined&&!c.validate(h)){throw new TypeError("Invalid value in setter. Consider unmarshal(prop, val).");}Z=h;}});},defineMethod:function(X,U){var V=this,W=V.parsedProps;if(!L(X)||!(U instanceof Function)){return ;}Object.defineProperty(W,X,{enumerable:false,value:U.bind(V)});},_withConfig:function(W,Z){var X=this.config,Y=Object.keys(W||{}),V=Y.reduce(function(b,a){b[a]=X[a];return b;},{}),U;Y.forEach(function(a){X[a]=W[a];});U=Z();Y.forEach(function(a){X[a]=V[a];});return U;}});var O=Object.prototype.toString,G=mstrmojo.netviz.PropertyParser;function J(X,W,V){var U=parseInt(X,W);return isNaN(U)?V:U;}function N(U){return O.call(U)==="[object Number]";}function L(U){return O.call(U)==="[object String]";}var I=mstrmojo.declare(mstrmojo.Base,[],{scriptClass:"mstrmojo.netviz.PropertyParser.Property",init:function(U){if(this._super){this._super();}this.defval=U.defval;},marshal:function(U){return JSON.stringify(U).replace(/"/g,"'");}});G.BooleanProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.BooleanProperty",unmarshal:function(U){if(U===undefined){return this.defval;}return U.toString()==="true";},validate:function(U){return U===true||U===false||O.call(U)==="[object Boolean]";}});G.IntegerProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.IntegerProperty",unmarshal:function(U){return J(U,10,this.defval);},validate:N});G.FloatProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.FloatProperty",unmarshal:function(V){var U=parseFloat(V);return isNaN(U)?this.defval:U;},validate:N});G.JsonProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.JsonProperty",unmarshal:function(U){function V(X){var W;if(X!==undefined){try{W=JSON.parse(X.replace(/'/g,'"'));}catch(Y){W=X;}}return W;}if(typeof U==="string"){return V(U);}if(U!==undefined&&U!==null){return U;}return this.defval;},validate:function(U){return true;}});G.StringProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.StringProperty",unmarshal:function(U){if(U!==undefined&&U!==null){return U.toString();}return this.defval;},marshal:function(U){return U;},validate:L});var K=["BooleanProperty","StringProperty","JsonProperty","IntegerProperty","FloatProperty"];K.forEach(function(U){var V=G[U];V.preset=function(W){return new V({defval:W});};});function T(U){return Q(U,["marshal","unmarshal","validate"]);}function Q(V,U){if(!V){return false;}return(U||[]).every(function(W){return V[W] instanceof Function;});}if(E){var C=new G(),F=G.BooleanProperty,H=G.IntegerProperty,B=G.FloatProperty,S=G.StringProperty,M=G.JsonProperty;var R={x:1,y:{x:"n+1"},z:true,m:3.14};var P={bp1:"false",bp2:"true",bp3:"",dp1:"12",dp2:22,fp1:23.3,fp2:"3.14",sp1:"foobar",jp1:R,jp3:"transparent"};var A={boolProp1:{key:"bp1",type:F.preset(false)},boolProp2:{key:"bp2",type:F.preset(false)},boolProp3:{key:"bp3",type:F.preset(false)},boolProp4:{key:"bp4",type:F.preset(false)},boolProp5:{key:"bp5",type:F.preset(true)},decimalProp1:{key:"dp1",type:H.preset(-1)},decimalProp2:{key:"dp2",type:H.preset(-1)},decimalPropn:{key:"dpn",type:H.preset(-1)},floatProp1:{key:"fp1",type:B.preset(0)},floatProp2:{key:"fp2",type:B.preset(0)},floatProp3:{key:"fp3",type:B.preset(0.03)},stringProp1:{key:"sp1",type:S.preset("")},stringProp2:{key:"sp2",type:S.preset("string")},jsonProp1:{key:"jp1",type:M.preset({})},jsonProp2:{key:"jp2",type:M.preset({})},jsonProp3:{key:"jp3",type:M.preset("error")}};var D=C.parse(P,A);console.assert(Object.keys(D).length===Object.keys(A).length,"wrong property count");console.assert(D.unmarshal instanceof Function,"unmarshal not found");console.assert(D.marshal instanceof Function,"marshal not found");console.assert(D.boolProp1===false);console.assert(D.boolProp2===true);console.assert(D.boolProp3===false);console.assert(D.boolProp4===false);console.assert(D.boolProp5===true);console.assert(D.marshal("boolProp5")==="true");D.unmarshal("boolProp5","false");console.assert(D.boolProp5===false);console.assert(D.marshal("boolProp5")==="false");console.assert(D.decimalProp1===12);console.assert(D.decimalProp2===22);console.assert(D.decimalPropn===-1);D.unmarshal("decimalProp1",42);console.assert(D.decimalProp1===42);console.assert(D.marshal("decimalProp1")==="42");console.assert(D.floatProp1===23.3);console.assert(D.marshal("floatProp1")==="23.3");console.assert(D.floatProp2===3.14);console.assert(D.floatProp3===0.03);D.unmarshal("floatProp3",100);console.assert(D.floatProp3===100);console.assert(D.stringProp1==="foobar");console.assert(D.stringProp2==="string");D.unmarshal("stringProp2","quux");console.assert(D.marshal("stringProp2")==="quux");D.unmarshal("stringProp2",42);console.assert(D.stringProp2==="42");console.assert(JSON.stringify(D.jsonProp1)===JSON.stringify(R));console.assert(Object.keys(D.jsonProp2).length===0);console.assert(D.jsonProp3==="transparent");console.assert(D.marshal("jsonProp1")===JSON.stringify(R).replace(/"/g,"'"));D.unmarshal("jsonProp2",true);console.assert(D.jsonProp2===true);console.assert(D.marshal("jsonProp2")==="true");console.info("PropertyParser: all tests processed");}}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.gm.GMEnums");var A=mstrmojo.gm.EnumIdentityType;mstrmojo.gm.GMIdentities=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GMIdentities"});mstrmojo.gm.HeaderCellIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.HeaderCellIdentity",eid:undefined,v:undefined,tid:undefined,n:undefined,tui:undefined,fid:undefined,o:undefined,isRowAttribute:undefined,at:undefined,dei:undefined,dpt:undefined});mstrmojo.gm.GeneralIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GeneralIdentity",objType:undefined});mstrmojo.gm.TitleCellIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.TitleCellIdentity",tid:undefined,fid:undefined,n:undefined,tui:undefined,isRowAttribute:undefined,otp:undefined,init:function(B){this.fid=B.fid;this.tid=B.id;this.isRowAttribute=B.isRowAttribute;if(B.isRowAttribute){this.objType=A.ROW_TITLE;}else{this.objType=A.COL_TITLE;}this.n=B.n;this.otp=B.otp;this.ost=B.ost;this.tui=B.tui;}});mstrmojo.gm.MetricAxisTitleIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.MetricAxisTitleIdentity",init:function(B){this._super(B);}});mstrmojo.gm.AttributeAxisTitleIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.AttributeAxiTitleIdentity",init:function(B){this._super(B);}});mstrmojo.gm.AxisIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.AxisIdentity",isNumericAxis:undefined,metricIdxArr:undefined,attrIdArr:undefined});mstrmojo.gm.ColorSquareIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.ColorSquareIdentity",init:function(B){this._super(B);this.comb=this.getElementsCombination();},getElementsCombination:function(){var B,F=this.token,C,H,G,E,I,D;if(F){D=[];C=F.levels;H=F.elements;G=F.types;B=C.length;for(E=0;E<B;E++){I={eid:H[E],tid:C[E]};if(G){I.tp=G[E];}D.push(I);}return D;}return undefined;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.vi.ui.rw._HasVisSelections");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_HasVisSelections","SelectionType");var B=mstrmojo,D=B.array,E=B.hash;var F=2;function C(I){var H=-1;var J=this.modelData.gts.row||[],G=J.length,K;for(K=0;K<G;K++){if(J[K].id===I){H=K;}}return H;}mstrmojo.heatmap.vi._SupportHeatmapBrushesAndHighlights=mstrmojo.provide("mstrmojo.heatmap.vi._SupportHeatmapBrushesAndHighlights",{_mixinName:"mstrmojo.heatmap.vi._SupportHeatmapBrushesAndHighlights",prepareSelectedNodesInfo:function(){this.clearSelections();var J=this,H=this.attSpan,M=this.modelData.ghs.rhs.items,I=this.modelData.gts.row,K=[],L=this.previousSelected,G={};D.forEach(L,function(V){var b=0,O=V.level,T=(V.index===undefined)?V.indices[0]:V.index,U=M[T].items,W,Z,R,a,S,Q,X=[],Y,P;G={};for(S=V.entityChildren?O:0;S<=O;S++){b=0;var N;for(Q=0;Q<S;Q++){N=(!(I[Q].otp===47&&I[Q].ost===12033)&&!!I[Q].cs)?I[Q].cs:1;b+=(N>1)?N:H[Q];}W=I[S];G[W.id]=[];a=[];P=[];Y={n:W.n,tid:W.id};for(Q=b;Q<b+H[S];Q++){Z=U[Q].idx;if(Z===-1){continue;}R=W.es[Z];if(a.indexOf(R)===-1){P.push(R.n);a.push(R);if(Y.eid===undefined){Y.eid=R.id;}}}Y.v=P.join(":");G[W.id].push({id:Y.eid,n:Y.v});X.push(Y);}K.push(X);if(O<I.length-1){J.addAttributeSelection(W.id,Y.eid,Y.v);}else{J.addMetricValueSelection(G);}});return K;},highlight:function(R,I){if(this._super){this._super.apply(this,arguments);}if(this.noHighlightAfterKeepOnlyExcludeDrill){return ;}var S,H,P,G,L,J,K,Q,N=[];function O(f,Y){var d=this.root,b=d&&d.entityChildren,h=this.modelData.gts.row||[],j,a,V,T,U=h.length,c=[],Z=this;if(!Y){Y=[];}if(!E.isEmpty(f)){c.push(d);for(T=0;T<U;T++){j=f[T];a=j&&j.eNm;V=j&&j.eId;var g=[];D.forEach(c,function(k,l){b=k.entityChildren||[];var i=false;D.forEach(b,function(m){if(m.level===T&&((!a&&f.maxIndex>T)||Z.model.compareElementsId(m.id,V))){c.push(m);i=true;}});if(!i&&a){g.push(l);}});D.forEach(g,function(k,i){c.splice(k-i,1);});if(T===0){c.splice(0,1);}var X=c.length,W,e=0;for(W=0;W<X;W++){if(c[W].level===T){e=W;break;}}if(e>0){c.splice(0,e);}}}return Y.concat(c);}if(this.isEmpty()){return ;}var M=function(T){L+=T.n+" ";};for(H in I){if(!I.hasOwnProperty(H)){continue;}S=I[H];Q={};for(P in S){if(!S.hasOwnProperty(P)){continue;}K=C.call(this,P);if(K<0){continue;}if(!Q.hasOwnProperty("maxIndex")){Q.maxIndex=0;}G=S[P]||[];L="";D.forEach(G,M);L=L.substring(0,L.length-1);J=G.length>0?G[0].id:"";Q[K]={eNm:L,eId:J};Q.maxIndex=Math.max(K,Q.maxIndex);}N=O.call(this,Q,N);}this.removeAllSelections();this.previousSelected=N;this.refreshHighlights();},singleUnitSelect:function A(){var I=this.getSelections().length>0||this.clearSelectionsFlag;if(this.clearSelectionsFlag){delete this.clearSelectionsFlag;}if(I){var H=function(){var K=this.model.scm,M=Object.keys(K||{}),O=(M&&M[0])||"",N=this.model.data.gts.row,L=this.model.data.gts.col;D.forEach(N.concat(L),function(P){if(M.indexOf(P.id)!==-1){O=P.id;return false;}});return O;};var J=function(){var K={};K.tid=H.call(this);K.eid="";K.isClearAll=false;K.anchor=this.domNode;K.at=F;K.selections=this.getSelections();K.selectionType=this.getSelectionType();return K;};var G=J.call(this);this.performAction([G]);}},clearSelections:function(){this.clearSelectionsFlag=true;if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.color","mstrmojo.css","mstrmojo.hash");var A=mstrmojo.color,C=mstrmojo.css,H=mstrmojo.hash;function B(I){I=G(I);if(isNaN(I)){I=0;}I%=16777216;return{b:I%(1<<8),g:(I%(1<<16))>>8,r:(I%(1<<24))>>16};}function F(M,N,L){M=G(M);L=H.copy(L,{retainGradientObject:false});if(D(M)){var K=F(M.c1,N),I=F(M.c2,N);if(L.retainGradientObject){return{c1:K,c2:I,or:M.or};}return C.buildGradient(M.or,K,I).v;}if(typeof N==="number"){var J=B(M);if(isNaN(M)){N=0;}return"rgba("+J.r+" ,"+J.g+" ,"+J.b+" ,"+N+" )";}else{if(isNaN(M)){M=0;}return"#"+(16777216+M%16777216).toString(16).substring(1,7);}}function G(K){var J=K.c1,I=K.c2;if(D(K)){return{c1:G(J),c2:G(I),or:K.or};}if(typeof K==="number"){return K;}if(typeof K!=="string"){return NaN;}if(K[0]!=="#"){return parseInt(K,10);}if(K.length===4){K=K[0]+K[1]+K[1]+K[2]+K[2]+K[3]+K[3];}return parseInt(K.substring(1,7),16);}function E(K,I){var N=K.value,P=K.opacity;if(D(N)){return["c1","c2"].reduce(function(U,V,T){var W=E({value:N[V],opacity:P},I);U.value[V]=W.value;if(T===0){U.opacity=W.opacity;}return U;},{value:{or:N.or}});}if(N==="transparent"){K.value=I.value;}var M=A.hex2rgb(F(K.value)),L=A.hex2rgb(F(I.value)),S=K.opacity,R=I.opacity,Q=1-S,O,J;J=S+R*Q;O=M.map(function(T,U){return(T*S+L[U]*R*Q)/J;});return{value:"#"+A.rgb2hex.apply(undefined,O),opacity:J};}function D(I){return I&&["c1","c2","or"].every(function(J){return I.hasOwnProperty(J);});}mstrmojo.util.color=mstrmojo.provide("mstrmojo.util.color",{getCSSColorString:F,getColorValue:G,mix:E,isGradientColor:D,getRGB:B,createCanvasFillPattern:function(K,Q,J,P,I,O){var L=K.value,N=K.opacity,M;if(D(L)){M=Q.createLinearGradient(J,P,I,O);M.addColorStop(0,F(L.c1,N));M.addColorStop(1,F(L.c2,N));}else{M=F(L,N);}return M;}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var C=Math,I=mstrmojo.dom,K=mstrmojo.css,E="active",L="ready",J=6,F=10,O=10,P={LASSO_SELECTOR:"lasso-selector",LASSO_RESIZER:"lasso-resizer",BUTTON:"button"};mstrmojo.util.ui.LassoSelectorParamsType=null;function Q(S,R,T){return function(U){S.call(mstrmojo.all[R],U,T);};}function M(S){var U=S.view,T=I.eventTarget(window,S),R=this.lassoSelector;if(this.clickFromLassoResizer||(T!==R&&this.clickFromCreatingLasso)){I.stopPropogation(U,S);I.preventDefault(U,S);}delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;}function D(b,U){var R,d,S,Z,a=b.clientX,Y=b.clientY,T=this.lassoSelector,X=U.startX,W=U.startY,V=U.containerPos,e=a-V.x,c=Y-V.y;e=C.min(e,U.maxX);e=C.max(e,U.minX);c=C.min(c,U.maxY);c=C.max(c,U.minY);R=C.abs(e-X);d=C.abs(c-W);Z=C.min(W,c);S=C.min(X,e);T.style.width=R+"px";T.style.height=d+"px";T.style.left=S+"px";T.style.top=Z+"px";U.width=R;U.height=d;U.left=S;U.top=Z;if(R<=O&&d<=O){T.style.visibility="hidden";K.removeClass(T,E);}else{T.style.visibility="visible";K.addClass(T,E);document.body.style.cursor="crosshair";}}function H(T,W){var V=window.document,S=this.lassoSelector,U=W.width,R=W.height;I.detachEvent(V,"mousemove",W.fnMove);I.detachEvent(V,"mouseup",W.fnUp);delete W.fnMove;delete W.fnUp;document.body.style.cursor="default";if(!U||U===0||!R||R===0){this.dismissLassoSelector();}else{W.ctrlKey=T.ctrlKey;this.lassoSelected(W);this.clickFromCreatingLasso=true;K.addClass(S,L);this.positionBoxResizers();}}function N(g){var Z,c=g.view,b,a,d=I.eventTarget(window,g),R=d.getAttribute("type"),V=this.lassoSelector,S=this.lassoContainer,h=this.excludeAttrArr,U=h.length,Y,X={};delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;if(!V||!S||!this.lassoSelectorEnabled){return ;}if(I.contains(this.dropDownBtn,d,true)){return ;}for(Z=0;Z<U;Z++){if(R===h[Z]){return ;}}this.lassoSelecting();Y=I.position(S);b=g.clientX-Y.x;a=g.clientY-Y.y;X.containerPos=Y;X.maxX=Y.w;X.maxY=Y.h;X.startX=b;X.startY=a;X.minX=0;X.minY=0;X.info=this.getLassoSelectionInfo(d);X.useAsSelectorOrBrushes=this.useAsSelectorOrBrushes||((this.hasAssociatedNodes&&this.hasAssociatedNodes())||this.selectorControl);V.style.visibility="hidden";V.style.left=b+"px";V.style.top=a+"px";V.style.width="0px";V.style.height="0px";K.removeClass(V,L);S.appendChild(V);var T=this.id,e=document,W=Q(D,T,X),f=Q(H,T,X);I.attachEvent(e,"mousemove",W);I.attachEvent(e,"mouseup",f);X.fnMove=W;X.fnUp=f;I.stopPropogation(c,g);I.preventDefault(c,g);}function G(a,U){var Y=U.index,X=U.startX,W=U.startY,V=U.containerPos,f=a.clientX-V.x,e=a.clientY-V.y,T=this.lassoSelector;f=C.min(f,U.maxX);f=C.max(f,U.minX);e=C.min(e,U.maxY);e=C.max(e,U.minY);var d=f-X,c=e-W;if(Y%3===1){d=0;}if(Y===3||Y===5){c=0;}var R=U.selWidth,b=U.selHeight,S=U.selLeft,Z=U.selTop;if(d!==0){if(Y%3===0){S+=d;R-=d;}else{R+=d;}}if(c!==0){if(Y<3){Z+=c;b-=c;}else{b+=c;}}T.style.width=R+"px";T.style.left=S+"px";T.style.top=Z+"px";T.style.height=b+"px";U.width=R;U.left=S;U.height=b;U.top=Z;this.positionBoxResizers();}function B(R,U){var T=R.view,S=window.document;I.detachEvent(S,"mousemove",U.fnMove);I.detachEvent(S,"mouseup",U.fnUp);delete U.fnMove;delete U.fnUp;this.clickFromLassoResizer=true;I.stopPropogation(T,R);I.preventDefault(T,R);this.lassoSelectorResized(U);}function A(V){var T=V.view,h=I.eventTarget(window,V),U=parseInt(h.getAttribute("index"),10),a=this.lassoSelector,Z=a.offsetLeft,j=a.offsetTop,Y=Z+a.offsetWidth,g=j+a.offsetHeight,R=I.position(this.lassoContainer),f=0,c=0,d=R.w,b=R.h,e={};if(U%3===0){d=Y-F;}if(U%3===2){f=Z+F;}if(U<3){b=g-F;}if(U>=6){c=j+F;}e.minX=f;e.minY=c;e.maxX=d;e.maxY=b;e.startX=V.clientX-R.x;e.startY=V.clientY-R.y;e.index=U;e.containerPos=R;e.selWidth=a.clientWidth;e.selHeight=a.clientHeight;e.selLeft=a.offsetLeft;e.selTop=a.offsetTop;var X=this.id,i=document,S=Q(G,X,e),W=Q(B,X,e);I.attachEvent(i,"mousemove",S);I.attachEvent(i,"mouseup",W);e.fnMove=S;e.fnUp=W;I.stopPropogation(T,V);I.preventDefault(T,V);}mstrmojo.util.ui._LassoSelector=mstrmojo.provide("mstrmojo.util.ui._LassoSelector",{_mixinName:"mstrmojo.util.ui._LassoSelector",lassoContainer:undefined,lassoSelector:undefined,lassoSelectorEnabled:true,excludeAttrArr:null,boxResizers:null,useDropDownBtn:false,dropDownBtn:undefined,init:function(R){if(this._super){this._super(R);}this.excludeAttrArr=[];this.boxResizers=[];},registerLassoSelector:function(S,V,U){V=V||[];V.push(P.LASSO_SELECTOR);V.push(P.LASSO_RESIZER);V.push(P.BUTTON);this.lassoContainer=S;this.excludeAttrArr=V;this.useDropDownBtn=U||false;I.attachEvent(S,"mousedown",Q(N,this.id));I.attachEvent(S,"click",Q(M,this.id));var R=this.lassoSelector;if(!R){R=this.createLassoSelector();this.lassoSelector=R;}var T=R.parentNode;if(T){T.removeChild(R);}},createLassoSelector:function(){var U,V,S,T=this.boxResizers,R=document.createElement("div");R.setAttribute("class","lasso-selector");R.setAttribute("type",P.LASSO_SELECTOR);R.setAttribute("draggable",false);R.draggable=false;for(U=0;U<9;U++){if(U!==4){V=document.createElement("div");V.setAttribute("class","lasso-selector-resizer");V.setAttribute("type",P.LASSO_RESIZER);V.setAttribute("index",String(U));V.setAttribute("draggable",false);V.draggable=false;R.appendChild(V);T[U]=V;I.attachEvent(V,"mousedown",Q(A,this.id));}}K.addClass(T[0],["top","left"]);K.addClass(T[1],["top"]);K.addClass(T[2],["top","right"]);K.addClass(T[3],["left"]);K.addClass(T[5],["right"]);K.addClass(T[6],["bottom","left"]);K.addClass(T[7],["bottom"]);K.addClass(T[8],["bottom","right"]);if(this.useDropDownBtn===true){S=document.createElement("div");S.setAttribute("type",P.BUTTON);S.setAttribute("class","lasso-selector-dropdown-button");R.appendChild(S);I.attachEvent(S,"click",Q(this.lassoButtonClicked,this.id));this.dropDownBtn=S;}return R;},positionBoxResizers:function(){var T=this.boxResizers,S=this.lassoSelector,U=S.clientWidth,R=S.clientHeight,W=(U-J)>>1,V=(R-J)>>1;T[1].style.left=W+"px";T[3].style.top=V+"px";T[5].style.top=V+"px";T[7].style.left=W+"px";},dismissLassoSelector:function(){var R=this.lassoSelector;if(R){K.removeClass(R,[E,L]);if(R.parentNode){R.parentNode.removeChild(R);}}},isLassoSelectorActive:function(){function S(V,U){var W=V.className.split(/\s+/),T;for(T=0;T<W.length;T++){if(W[T]===U){return true;}}return false;}var R=this.lassoSelector;if(R){return S(R,E);}return false;},getLassoSelectionInfo:mstrmojo.emptyFn,lassoSelected:mstrmojo.emptyFn,lassoSelecting:mstrmojo.emptyFn,lassoButtonClicked:mstrmojo.emptyFn,lassoSelectorResized:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");var B="___value",E="___parent",A="___key_map",D="___IS_LEAF";mstrmojo.netviz.ObservableModel=mstrmojo.declare(mstrmojo.Obj,[],{scriptClass:"mstrmojo.netviz.ObservableModel",init:function(H){var G=[];H=H||{};H=mstrmojo.hash.clone(H);var L=Object.keys(H),F=L.length,K,J;for(K=0;K<F;K++){var I=L[K],M=H[I];if(!(M instanceof Object)){J=new C();J[B]=M;J[D]=true;H[I]=J;}else{H[I]=J=new C(M);}G.push(J);H[I][E]=this;}if(this._super){this._super(H);}this.addDisposable(G);this[A]=H;},getParent:function(){return this[E];},getChildrenKeys:function(){return Object.keys(this[A]);},isLeafNode:function(){return this[D];},getValue:function(){if(this.isLeafNode()){return this[B];}return this.getRawObject();},setValue:function(G,K){var F=this.getValue();var M,J,I,L,H;if(this.isLeafNode()){if(!(G instanceof Object)){if(F!==G){this[B]=G;if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}else{this[B]=undefined;this[D]=undefined;this[A]=G;M=Object.keys(G);J=M.length;H=this.addDisposable(new C(G));for(I=0;I<J;I++){L=M[I];this[L]=H[L];H[E]=this;}if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}else{var N=this.getChildrenKeys();J=N.length;for(I=0;I<J;I++){L=N[I];this[L]=undefined;}if(!(G instanceof Object)){this[D]=true;this[B]=G;this[A]=undefined;this[B]=G;if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}else{this[A]=G;M=Object.keys(G);J=M.length;H=this.addDisposable(new C(G));for(I=0;I<J;I++){L=M[I];this[L]=H[L];H[E]=this;}if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}},stopPropagation:function(F){F._isStopped=true;},raiseEvent:function(G){if(this._super){this._super(G);}if(G._isStopped){return ;}var F=this.getParent();if(F){F.raiseEvent(G);}},getRawObject:function(){var G={},J=this.getChildrenKeys(),F=J.length,I;for(I=0;I<F;I++){var H=J[I],K=this[H];if(K.isLeafNode()){G[H]=K.getValue();}else{G[H]=K.getRawObject();}}return G;}});var C=mstrmojo.netviz.ObservableModel;}());(function(){mstrmojo.requiresCls("mstrmojo.util.color");var Q=mstrmojo.util.color;var O={Min:15872549,Max:1489202,Invalid:0,NoColorMetric:16119287};var G={LeftToRight:0,RightToLeft:1,Center:2,None:3};var M={dark:[1487103,16725801,309794,16750094,11434462,13421861,1691360,11119017,11783663,16754582,10018698,16760704,14337004,14803088,10608618,14079702],light:[2062260,14034728,2924588,16744206,9725885,12369186,1556175,8355711,11454440,16750742,10018698,16759672,12955861,14408589,10410725,13092807]};function K(V,h,Z){if(V<0||V>1){return 0;}var W=256,Y=V*W,R,X,a,U=h>>16,T=Z>>16,d=(h&65280)>>8,c=(Z&65280)>>8,S=(h&255),f=(Z&255);R=U+Math.floor((Y*(T-U)/W));X=d+Math.floor((Y*(c-d)/W));a=S+Math.floor((Y*(f-S)/W));return a+(X<<8)+(R<<16);}function F(S,V){var U=S>>16,T=(S&65280)>>8,R=(S&255);U=Math.floor((1-V)*U);T=Math.floor((1-V)*T);R=Math.floor((1-V)*R);return R+(T<<8)+(U<<16);}function J(R){var X=[],W,S,U=R.dp,T=U.length,Y,Z,V;if(R===null||R.length===0){return[];}for(V=0;V<T;V++){S={};if(V>0){Y=W;W=Z;}else{W=U[V];}if(V<T-1){Z=U[V+1];}S.sv=(V===0)?W.v:(Y.v+W.v)/2;S.ev=(V===T-1)?W.v:(Z.v+W.v)/2;S.c=W.c;S.d=(V===0)?G.LeftToRight:(V===T-1?G.RightToLeft:G.Center);X[V]=S;}return X;}function E(Y){var X=[],W,V,U=Y.dp,R=U.length,S;if(Y===null||Y.length===0){return[];}for(S=0;S<R;S++){W={};V=U[S];W.c=V.c;switch(V.d){case G.LeftToRight:W.v=V.s;break;case G.RightToLeft:W.v=V.e;break;default:var T=(V.s+V.e)/2;W.v=T;break;}X[S]=W;}return X;}function L(a){if(isNaN(a)){return O.Invalid;}if(this.max===this.min){return this.blendEqualColor;}var T=this.blend.dp,S=T.length;if(!this.valid){var d=T[0],W=T[S-1];if(a<this.min){return d.c;}return W.c;}var U,Y=T[0],b=Y.v,X=Y.c,Z,V;for(U=1;U<S;U++){Y=T[U];if(Y.v>=a){break;}b=Y.v;X=Y.c;}U=Math.min(U,S-1);Y=T[U];Z=Y.v;V=Y.c;if(a<b){return X;}if(a>Z){return V;}if(b===Z){return K(0.5,X,V);}var R=(a-b)/(Z-b);return K(R,X,V);}function D(V,a){var R=[],S=[],X=[];if(this.min===this.max||isNaN(V)||isNaN(a)||V===a){R[0]=L.call(this,V);R[1]=L.call(this,a);S[0]=1;S[1]=1;X[0]=0;X[1]=1;}else{if(this.min<this.max){var Z,U=this.blend.dp,T=U.length,Y=0,W;R[Y]=L.call(this,V);S[Y]=1;X[Y]=0;Y++;for(W=0;W<T;W++){Z=U[W];if(Z.v>=V&&Z.v<=a){R[Y]=Z.c;S[Y]=1;X[Y]=(Z.v-V)/(a-V);Y++;}}R[Y]=L.call(this,a);S[Y]=1;X[Y]=1;}}return{c:R,a:S,r:X};}function I(T,W){var U=0.4,S=F(W.c,U),R,V;switch(W.d){case G.LeftToRight:if(T<W.s){return W.c;}if(T>W.e){return S;}if(W.s===W.e){return K(0.5,W.c,S);}V=(T-W.s)/(W.e-W.s);return K(V,W.c,S);case G.RightToLeft:if(T<W.s){return S;}if(T>W.e){return W.c;}if(W.s===W.e){return K(0.5,S,W.c);}V=(T-W.s)/(W.e-W.s);return K(V,S,W.c);case G.Center:R=(W.s+W.e)/2;if(T<W.s||T>W.e){return S;}if(W.s===W.e){return S;}if(T<=R){V=(T-W.s)/(R-W.s);return K(V,S,W.c);}V=(T-R)/(W.e-R);return K(V,W.c,S);default:return W.c;}}function B(S){if(isNaN(S)){return O.Invalid;}if(this.min===this.max){return this.bandEqualColor;}var X=this.band.dp,R=X.length;if(!this.valid){var U=X[0],V=X[R-1];if(S<this.min){return I(V.s,U);}if(S>=this.min){return I(V.e,V);}}var W=X[0],T;if(W.s>=S){return I(S,W);}for(T=0;T<R;T++){W=X[T];if(W.s<=S&&S<W.e){return I(S,W);}}return I(S,W);}function A(V,f){var R=[],S=[],X=[];if(this.min===this.max||isNaN(V)||isNaN(f)||V===f){R[0]=B.call(this,V);R[1]=B.call(this,f);S[0]=1;S[1]=1;X[0]=0;X[1]=1;}else{if(this.min<this.max){var U=this.band.dp,T=U.length,g=0.4,b,e,j,W,Z=0;if(V<0){R[Z]=B(V);S[Z]=1;X[Z]=0;Z++;if(f<1){R[Z]=B(f);S[Z]=1;X[Z]=1;Z++;}}for(W=0;W<T;W++){b=U[W];if(b.s>f||b.e<V){continue;}e=b.c;j=F(e,g);var h=Math.max(b.s,V),d=Math.min(b.e,f);if(d!==h){switch(b.d){case G.LeftToRight:case G.RightToLeft:case G.Center:if(h===b.s){R[Z]=(b.d!==G.LeftToRight)?j:e;}else{R[Z]=B.call(this,h);}X[Z]=(h-V)/(f-V);S[Z]=1;Z++;if(b.d===G.Center){var Y=(b.s+b.e)/2;if(Y>h&&Y<d){R[Z]=e;X[Z]=(Y-V)/(f-V);S[Z]=1;Z++;}}if(d===b.e){R[Z]=(b.d!==G.RightToLeft)?j:e;}else{R[Z]=B.call(this,d);}X[Z]=(d-V)/(f-V);S[Z]=1;Z++;break;default:R[Z]=e;X[Z]=(h-V)/(f-V);S[Z]=1;Z++;R[Z]=e;X[Z]=(d-V)/(f-V);S[Z]=1;Z++;break;}}}if(f>1){if(V>1){R[Z]=B.call(this,V);X[Z]=0;S[Z]=1;Z++;}R[Z]=B.call(this,f);X[Z]=1;S[Z]=1;}}}return{c:R,a:S,r:X};}function P(S,R){this.blend.dp=[];var U=this.blend.dp,T;T={};T.c=S;T.v=0;U[0]=T;T={};T.c=R;T.v=1;U[1]=T;}function N(S,R){this.band.dp=[];var U=this.band.dp,T;T={};T.d=G.LeftToRight;T.s=0;T.e=0.5;T.c=S;U[0]=T;T={};T.d=G.LeftToRight;T.s=0.5;T.e=1;T.c=R;U[1]=T;}function C(r,U,q){var W=[],V=0,Z,o,e=this.min,h=this.max,T=q.legendTickCount,S={},R,Y=!isNaN(this.min)&&!isNaN(this.max),j;if(this.min>=this.max||this.blend.dp.length<=2){var k=(h-e)/T;for(j=0;j<r;j++){S={x:V,w:Math.floor(U/T)};V+=S.w;if(Y){Z=e+j*k;o=Z+k;R=this.getColor((Z+o)/2);}else{Z="Null";o="Null";R=0;}W.push({r:S,c:R,sv:Z,ev:o});}}else{var b=this.blend.dp,g=b.length;for(j=0;j<g;j++){var m=b[j],X,a;if(j===0){Z=e;}else{X=b[j-1];Z=e+(h-e)*(m.v+X.v)/2;}if(j===g-1){o=h;}else{a=b[j+1];o=e+(h-e)*(m.v+a.v)/2;}S={x:V,w:Math.floor(U*(o-Z)/(h-e))};V+=S.w;if(Y){R=this.getColor((Z+o)/2);}else{Z="Null";o="Null";R=0;}W.push({r:S,c:R,sv:Z,ev:o});}}this.tooltipInfo=W;}function H(o,U,n){var W=[],V=0,Y,m,f=this.min,g=this.max,T=n.legendTickCount,S={},R,a="",X=!isNaN(this.min)&&!isNaN(this.max),h,k;if(this.min>=this.max){for(h=0;h<o;h++){S={x:V,w:Math.floor(U/T)};a+=S.w;if(X){R=this.getColor(f);}else{Y="Null";m="Null";R=0;}W.push({r:S,c:R,sv:Y,ev:m});}}else{var Z=this.band.dp,e=Z.length,j,b;if(e<=2){for(h=0;h<e;h++){k=Z[h];if(h===0){Y=f;}else{Y=f+(g-f)*k.s;}if(h===e-1){m=g;}else{m=f+(g-f)*k.e;}S={x:V,w:Math.floor(U*(m-Y)/(g-f)/2)};V+=S.w;if(X){m=(Y+m)/2;R=this.getColor((Y+m)/2);}else{Y="Null";m="Null";R=0;}W.push({r:S,c:R,sv:Y,ev:m});V+=S.w;j=U*(m-Y)/(g-f)/2;S={x:V,w:Math.ceil(j)};if(h>0){b=W[W.length-1].r;if(S.x<b.x+b.w+1){b.w=S.x-b.x;}}V+=Math.floor(j);if(X){Y=(Y+m)/2;R=this.getColor((Y+m)/2);}else{Y="Null";m="Null";R=0;}W.push({r:S,c:R,sv:Y,ev:m});}}else{for(h=0;h<e;h++){k=Z[h];if(h===0){Y=n.props.legendAsc?f:g;}else{Y=n.props.legendAsc?f+(g-f)*k.s:g+(f-g)*k.s;}if(h===e-1){m=n.props.legendAsc?g:f;}else{m=n.props.legendAsc?f+(g-f)*k.e:g+(f-g)*k.e;}j=U*(m-Y)/(g-f);S={x:V,w:Math.ceil(j)};if(h>0){b=W[W.length-1].r;if(S.x<b.x+b.w+1){b.w=S.x-b.x;}}if(h===e-1){S.w=U-V;}V+=Math.floor(j);var p=n.props.legendAsc?" < ":" > ";if(X){R=this.getColor((Y+m)/2);}else{Y="Null";m="Null";R=0;}if(p){W.push({r:S,c:R,sv:Y,ev:m});}else{W.push({r:S,c:R,sv:Y,ev:m,sign:">"});}}}}this.tooltipInfo=W;}mstrmojo.heatmap.vi.VisHeatMapColorTheme={newInstance:function(){return{initialize:function V(){this.blend={};this.band={};this.valid=true;this.blendEqualColor=0;this.bandEqualColor=0;this.isBlend=true;this.style="dark";this.setDefaultDataProvider();this.checkMinMax();},getGradientFillInfo:function Y(e,b){var f,c;if(isNaN(e)||isNaN(b)){if(this.isBlend){return D.call(this,e,b);}return A.call(this,e,b);}if(this.min===this.max){if(e<this.min){f=0;}else{f=1;}if(b<this.max){c=0;}else{c=1;}}else{var g;if(this.isFixedColorBanding){g=this.initMax-this.initMin;f=(e-this.initMin)/g;c=(b-this.initMin)/g;}else{g=this.max-this.min;f=(e-this.min)/g;c=(b-this.min)/g;}}if(this.isBlend){return D.call(this,f,c);}return A.call(this,f,c);},checkMinMax:function W(){var h=this.min,b=this.max;if(h>b){this.valid=false;}else{if(h===b){h=b=1;var k=this.blend.dp,d=k.length,j,g,f;for(g=d-1;g>=0;g--){j=k[g];if(g===d-1&&j.v<=h){this.blendEqualColor=j.c;break;}if(g===0&&j.c>=h){this.blendEqualColor=j.c;break;}if(g>0&&j.c>=h){var e=k[g-1];if(e.c<h){f=(h-e.v)/(j.v-e.v);this.blendEqualColor=K(f,e.c,j.c);break;}}}k=this.band.dp;d=k.length;for(g=0;g<d;g++){j=k[g];if((g===0&&j.s>=h)||(g===d-1&&j.e<=h)||(j.s<=h&&j.e>=h)){this.bandEqualColor=j.c;break;}}}}},setDefaultDataProvider:function a(){P.call(this,O.Min,O.Max);N.call(this,O.Min,O.Max);this.useDefault=true;},getColor:function S(b){if(this.colorByType==="attribute"){return M[this.themeType][b%16];}if(this.hasNoColorMetric){return O.NoColorMetric;}var c=NaN;if(isNaN(b)){c=0;}else{if(this.min===this.max){c=b<this.min?0:1;}else{if(this.isFixedColorBanding){c=(b-this.initMin)/(this.initMax-this.initMin);}else{c=(b-this.min)/(this.max-this.min);}}}if(this.isBlend){return L.call(this,c);}return B.call(this,c);},isBrightColor:function Z(i){var f=i>>16,e=(i&65280)>>8,d=(i&255),h=(f*299+e*587+d*114)/1000;if(h>150){return true;}return false;},getContrastColor:function R(b){if(Q.isGradientColor(b)){b=b.c1;}if(this.isBrightColor(b)){return 0;}return 16777215;},createTooltipInfo:function U(e,c,g){var f=0;if(this.min>=this.max){f=1;}else{var b;if(this.isBlend){b=this.blend.dp.length;f=(b<=2)?5:b;}else{b=this.band.dp.length;f=(b<=2)?4:b;}}if(this.isBlend){C.call(this,f,c,g);}else{H.call(this,f,c,g);}},getTooltipInfo:function T(b){var d=this.tooltipInfo;var c;for(c=0;c<d.length;c++){var f=d[c],e=f.r;if(b>=e.x&&b<e.x+e.w){return c;}}return c-1;},getMaxMinByMetricID:function(o,c){var d=o.gts.col,l=d.length,g=0,k=null,h={min:null,max:null};for(g=0;g<l&&k===null;g++){var n=d[g].es,b=n.length,f;for(f=0;f<b;f++){if(n[f].oid===c){k=f;break;}}}if(k===null){return h;}var e=o.gvs.items||[];l=e.length;for(g=0;g<l;g++){var m=parseFloat(e[g].items[k].rv);if(h.min===null){h.min=m;}if(h.max===null){h.max=m;}if(h.min>m){h.min=m;}if(h.max<m){h.max=m;}}return h;},convertFixedValueToBlendString:function(f,e){var l="";if(f.length%2===0){var b=f.length,c=e.min,g=e.max,d=0;var k=g-c;l="0,"+f[1];for(d=2;d<b-2;d+=2){var j=parseInt(f[d],10);if(j<c||j>g){continue;}else{var h=(j-c)/k;l+=","+h+","+f[d+1];}}l+=",1,"+f[b-1];}return l;},convertAbsoluteToBlend:function(d,f){this.useDefault=false;this.isColorBanding=true;var b=f.abs.replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");b=(new window.DOMParser()).parseFromString(b,"text/xml");var e=b.getElementsByTagName("m")[0];d.absoluteColorID=e.getAttribute("id");this.isFixedColorBanding=true;this.fixedBandingArray=e.getAttribute("bl").split(",");var c;if(!isNaN(this.min)&&!isNaN(this.max)){c={max:this.max,min:this.min};}else{c=this.getMaxMinByMetricID(d.modelData,d.absoluteColorID);this.max=c.max;this.min=c.min;}if(isNaN(this.initMax)||isNaN(this.initMin)){c=this.getMaxMinByMetricID(d.modelData,d.absoluteColorID);this.max=c.max;this.min=c.min;this.initMax=c.max;this.initMin=c.min;}f.bandColors=e.getAttribute("ba");f.gradientColors=this.convertFixedValueToBlendString(this.fixedBandingArray,c);},createDataProviderFromString:function X(j,h){var b=j.split(","),d=0,g,f;this.blend.dp=[];this.useDefault=false;g=this.blend.dp;if(b.length%2===0){while(d<b.length){f={};f.v=parseFloat(b[d]);d++;f.c=parseInt(b[d],10);d++;g[g.length]=f;}}d=0;b=h.split(",");this.band.dp=[];g=this.band.dp;if(b.length%4===0){while(d<b.length){f={};f.s=parseFloat(b[d]);d++;f.e=parseFloat(b[d]);d++;f.c=parseInt(b[d],10);d++;var e=b[d];switch(e){case"leftToRight":f.d=G.LeftToRight;break;case"rightToLeft":f.d=G.RightToLeft;break;case"center":f.d=G.Center;break;default:f.d=G.None;}d++;g[g.length]=f;}}},getBackgroundColor:function(){if(this.style==="light"){return"#ffffff";}return"#333333";},decodeAttriColorByColor:function(c){if(typeof c==="object"){return c;}var b=this.RGB_BRG_Switch(c);return mstrmojo.color.decodeColor(b);},RGB_BRG_Switch:function(c){var e=(c>>16)&255,d=(c>>8)&255,b=(c>>0)&255;return(b<<16)|(d<<8)|(e<<0);}};}};}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.Button","mstrmojo.dom","mstrmojo.Container");mstrmojo.requiresDescs(1442,2140);var C=mstrmojo.dom;mstrmojo.ui.menus.ToolbarEditor=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._IsMenuPopup,mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.menus.ToolbarEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-ToolbarEditor mstrmojo-ui-MenuEditor {@cssClass}" style="..." mstrAttach:mouseover,mouseout,click><div class="te-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},popupConfig:null,children:null,autoCloses:false,locksHover:true,visible:true,onclick:function B(E){C.stopPropogation(null,E.e);},init:function D(F){this._super(F);var E=this.popupConfig,G=E.contents;if(!G){throw new Error("Cannot open editor without editor content.");}this.cssClass=E.cssClass;this.addChildren(G);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.ToolbarEditor","mstrmojo.hash");mstrmojo.ui.menus.ToolbarEditorConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.ToolbarEditorConfig",cssClass:"",contents:null,init:function C(D){this._super(D);this.initBindings();},clear:function A(){this._super();this.contents=null;},newInstance:function B(D){return new mstrmojo.ui.menus.ToolbarEditor(mstrmojo.hash.copy({popupConfig:this},D));}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Vis","mstrmojo._HasOwnAvatar");var K=mstrmojo.css,I=mstrmojo.dom,F="px";function B(Q,P){return{x:Q.x-P.x,y:Q.y-P.y};}function M(Q,P){return(Q.x-P.x)*(Q.x-P.x)+(Q.y-P.y)*(Q.y-P.y);}function N(P){var Q=P.src.data;return(!Q||!Q.isScrollBar);}mstrmojo.VisLegend=mstrmojo.declare(mstrmojo.Vis,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.gm.VisLegend",bodyCssClass:"",avatarCssClass:"legend-dragged",dropZoneHighlightCss:"legend-dropZone",ownAvatar:true,draggable:true,dropZone:true,dockedPositions:null,calculateDockedPositions:mstrmojo.emptyFn,widget:null,boundaryNode:null,draggableNodeName:"domLegend",legendMarkup:"",extrasMarkup:"",markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}px;height:{@height}px;top:{@top}px;left:{@left}px;position:absolute;" mstrAttach:click,mouseover,mouseout><div class="gm-legend-bg"><div class="{@bodyCssClass}" style="width:{@width}px;height:{@height}px;text-decoration:inherit">{@legendMarkup}</div></div><div class="gm-anchor-point topLeft"></div><div class="gm-anchor-point topRight"></div><div class="gm-anchor-point bottomLeft"></div><div class="gm-anchor-point bottomRight"></div>{@extrasMarkup}</div>',markupSlots:{dropZoneNode:function(){return this.domNode;},domLegend:function(){return this.domNode.firstChild.firstChild;}},postBuildRendering:function(){this._super();this.calculateDockedPositions(this.widget.getWidth(),this.widget.getHeight());this.boundaryNode=this.widget.domNode;this.boundaryPosition=I.position(this.boundaryNode,true);},createAvatar:function D(){return this[this.draggableNodeName];},updateDropZoneNode:function C(R){var P=this.dockedPositions;if(P&&P.length>0){var W=B(R.tgt.pos,this.boundaryPosition);var U=M(W,P[0]),T=0,Q,V;for(Q=1;Q<P.length;Q++){V=M(W,P[Q]);if(V<U){U=V;T=Q;}}if(T!==this.currDockedPositionIdx){var S=this.dropZoneNode.style;S.left=P[T].x+F;S.top=P[T].y+F;if(this.widget.onLegendDropZoneChange){this.widget.onLegendDropZoneChange(P[T],T);}this.currDockedPositionIdx=T;this.updateAlignClass();return true;}}return false;},toggleDropZoneBorder:function O(P){K.toggleClass(this.dropZoneNode,this.dropZoneHighlightCss,P);},isDragValid:N,ondragstart:function E(P){if(!N(P)){return ;}this._super(P);this.toggleDropZoneBorder(true);},ondragmove:function A(P){if(!N(P)){return ;}this.updateDropZoneNode(P);this._super(P);},allowDrop:function H(P){var R=P.src,Q=R&&R.widget;return(Q&&Q!==this&&Q.parent===this.parent);},ondrop:function J(R){var P=this.domLegend;K.removeClass(P,this.avatarCssClass);var S=P.style;S.left="0";S.top="0";this.dropZoneNode.firstChild.appendChild(P);if(this.widget.onLegendDropped){var Q=this.getDockedPosition();this.widget.onLegendDropped(Q&&Q.pos);}R.dropSuccessful=true;},getDockedPosition:function G(){return this.dockedPositions&&this.dockedPositions[this.currDockedPositionIdx];},ondragend:function A(P){if(!N(P)){return ;}this._super(P);if(!P.dropSuccessful){this.ondrop(P);}this.toggleDropZoneBorder(false);},positionAvatar:function L(U){var R=this,Q=this.avatar,S=Q.style,T=this.boundaryPosition;var P=function(V,W){if(V==="x"){if(W<T.x){return T.x;}return Math.min(W,T.x+T.w-R.domNode.offsetWidth);}if(V==="y"){if(W<T.y){return T.y;}return Math.min(W,T.y+T.h-R.domNode.offsetHeight);}};S.left=P("x",U.x)+F;S.top=P("y",U.y)+F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var N=mstrmojo.gm.EnumTRFManipulations;var J=mstrmojo.array,C=mstrmojo.hash,M=mstrmojo.func.wrapMethods,G=mstrmojo.func.composite,I=mstrmojo.VisEnum.GMLegendFormatingPropertyTag;var D={silent:false,undo:mstrmojo.emptyFn,redo:mstrmojo.emptyFn};function K(O){return O.model.controller.cmdMgr;}function L(){return(this.getDocModel&&this.getDocModel())||this.model.docModel;}function H(){return{success:function O(){this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}function E(P,R){var O,U,Q,S,T={};T.tks=this.k;T.selectorObjects=P;T.keepOnly=!!R;T.isDocVis=true;O=L.call(this);U=O.getDataService();Q=U.getGMViewFilterAction(T);S=O.getSliceCallback(T);return{action:Q,callbacks:S};}function B(Q,P){var O,S,R;O=L.call(this);R=O.getDataService();if(!this.isXMLDirty()){R.submitUpdates(Q,P);}else{S=this.getPersistAction();R.submitUpdates([Q,S],P);this.resetXMLDirtyFlag();}}function A(){var b=this.modelData||this.model.data,S=b.k,Z,Y="FormattingWidget",U,T,X,P,Q,R=[],W=[],V=this.edtModel;if(!b){console.log("warning: modelData is missing");return null;}var a=function(d,f){var c=T.createElement(f),e;if(d instanceof Object){for(e in d){if(d.hasOwnProperty(e)){var g=a(d[e],e);if(g){c.appendChild(g);}}}}else{c.setAttribute("value",d);}return c;};var O=function(c){return c.replace(/</g,"&lt;").replace(/"/g,"&quot;");};W=!!V&&!!V.getActionsWithUpdateProperty?V.getActionsWithUpdateProperty():[];X=this.createWidgetPropsXML?this.createWidgetPropsXML():null;if(!X||X.length===0){U=this.getProperties();if(this.useCompatibleXML){T=(new DOMParser()).parseFromString("<widgetProps></widgetProps>","text/xml");T.firstChild.appendChild(a(U,"fmt"));}else{T=(new DOMParser()).parseFromString("<props><widgetProps></widgetProps></props>","text/xml");T.firstChild.firstChild.appendChild(a(U,"fmt"));}X=(new XMLSerializer()).serializeToString(T);}P=O(X);Q={act:"setProperty",nodeKey:S,prs:Y,pri:4,v:P};R.push(Q);if(!!W){R=R.concat(W);}return R;}function F(P,Q,O,T){if(!(T instanceof Function)){return D;}var S=this.id;function R(U){return function(){var W=mstrmojo.all[S],V=W.getProperties();V[P]=U;T.call(W,U,true);W.getDocModel().selectVIUnit(W.parent.id,true);};}return{silent:true,undo:R(O),redo:R(Q)};}mstrmojo._VizSelectionHelper=mstrmojo.provide("mstrmojo._VizSelectionHelper",{postBuilderingCalled:false,listenToUpdateColorMap:function(R){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var Q=this,P,O=(Q.getDocModel&&Q.getDocModel())||Q.model.docModel;if(O){return O.attachEventListener("colorMapChanged",Q.id,function(T){P=Q.parent&&Q.parent.parent;if(Q.forceUpdateColorMap||(P&&P.isPanelDisplaying())){R.call(Q);}else{var S=P.attachEventListener("panelDisplaying",Q.id,function(U){if(Q.postBuilderingCalled){R.call(Q);}P.detachEventListener(S);});}});}},detachUpdateColorMapListener:function(P){if(!P){return ;}var O=(this.getDocModel&&this.getDocModel())||this.model.docModel;O.detachEventListener(P);},updateTargets:function(P){var S={},Q=this,O=L.call(this);S.fromGM=true;S.type=1;S.src=this.k;S.selectorObjects=P;function R(V){var T=Q.modelData||Q.model.data,U=T.sc;if(U!==undefined){return U[V];}return undefined;}S.keepOnly=true;S.ck=R.call(this,"ck");S.keyContext=S.ck;S.tks=R.call(this,"tks");S.ckey=R.call(this,"ckey");S.isDocVis=true;S.include=true;S.showall=R.call(this,"showall");O.slice(S);},updateAfterViewFilter:function(Q,O){var V,U,P,T,S,W,R;V=L.call(this);U=V.getDataService();T=E.call(this,Q,O);P=T.action;S=T.callbacks;R=this.model.controller||V.controller;if(this.currKeepOnlyAction){W=[C.clone(this.currKeepOnlyAction)];}else{W=E.call(this,[],false).action;}this.currKeepOnlyAction=P;R.submitUndoRedoUpdates([P],W,S);},updateAfterKeepOnly:function(Q){var P=L.call(this),O=this.model.controller||P.controller,R=M(O._getXtabCallback(this),H.call(this));O.applyKeepOnly(this,R,{keepOnly:Q,data:this.getSelections()},Q?-2:undefined);},updateAfterDrill:function(O,Y){var V=this,Z=L.call(this),X=Z.getDataService(),R=X.newUpdate(),Q=this.getSelections(),U=this.model.getSelectorDataFromViewFilter(V.model.data.vfexpr).concat({keepOnly:true,data:Q}),P=Z.getKeepOnlyOrExcludeAction(V.k,U),S=V.model.controller||Z.controller,T=S._getXtabCallback(V);R.add(O,M(Y,T));R.add(P,H.call(V));K(V).execute({execute:function W(){this.submitUpdate(R);},urInfo:{callback:R.callback}});},updateAfterSort:function(R){var P=this,O=L.call(this),S=O.getDataService(),T=O.getSliceCallback({tks:P.k});K(P).execute({execute:function Q(){var V=S.newUpdate(this,undefined),U={act:"sortGM",nodeKey:P.k,subActions:R};V.add(U,T,undefined);if(P.isXMLDirty()){V.addActions(P.getPersistAction());}this.submitUpdate(V,undefined);},urInfo:{callback:T}});},updateAfterAction:function(T,O,P,a,X){if(!T){return ;}var V=this,Q=V.parent&&V.parent.id,b=V.model.docModel,U=V.model.controller||b.controller,Z,Y,S={},W,R=X||D;if(P){Z=mstrmojo.emptyFn;W=function(){this.submitSilent(T);};}else{Z=b.getSliceCallback({tks:this.k});Z.success=G([Z.success,function(){b.selectVIUnit(Q,true);}]);W=function(){this.submit(T,Z,S);};}Y=U._getXtabCallback(V);if(O){Z=M(Z,O);Y=M(Y,O);}Y.success=G([Y.success,function(){b.selectVIUnit(Q,true);}]);if(P){C.copy(mstrmojo.DocDataService.SUPPRESS_DATA,S);}if(a){C.copy(mstrmojo.DocDataService.REQUEST_DEFN_DATA,S);}K(this).execute({execute:W,urInfo:{silent:R.silent,callback:Y,redo:R.redo,undo:R.undo}});},getProperties:mstrmojo.emptyFn,getSetPropertiesAction:A,updateAfterPropertiesChange:function(P,Q,O,R){this.updateAfterAction(A.call(this),P,Q,O,R);},setProperty:function(V,R,T){var P=T.callback,Q=!!T.suppressData,X=T.requestDefinition,S=T.clientUndoRedoCallback,W=this.getProperties(),O=W[V],U;if(V===I.COLOR_SQUARE_COLOR){if(this.colorSqureIdentity){this.updateColorMap(this.colorSqureIdentity.comb,R);}}else{if(W&&(W[V]===undefined||W[V].toString()!==R.toString())){W[V]=R;U=F.call(this,V,R,O,S);this.updateAfterPropertiesChange(P,Q,X,U);}}},showData:function(O){if(!this.gridData){this.gridData=this.model.data;}mstrmojo.vi.ui.ViewDataDialog.open(this.parent,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.VisUtility");var R=mstrmojo.css,A=mstrmojo.VisUtility,H=mstrmojo.array,D=mstrmojo.string,I="vis-tooltip",N=20,P=165,L=350,E=350,G="px";function Q(){var U=this.domNode;U.innerHTML="";var S=document.createElement("div");S.className=I+"-container";var V=document.createElement("table");V.className=I+"-table";for(var T=0;T<3;T++){V.appendChild(document.createElement("COL"));}S.appendChild(V);this.domNode.appendChild(S);return V;}function K(T){var S=[],U=false;H.forEach(T,function(V){if(!V.isSuper){S.push(V.v);}else{U=true;S.push("<sup>"+V.v+"</sup>");}});return{hasSuper:U,htmlText:S.join("")};}mstrmojo.VisTooltip=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.VisTooltip",init:function O(S){this._super(S);R.addWidgetCssClass(this,(S&&S.widgetClass)?[S.widgetClass,I]:I);},toggle:function M(S){var T=mstrApp.isAppStatePrintPreview&&mstrApp.isAppStatePrintPreview();if(this.domNode){this.domNode.style.display=S&&!T?"block":"none";}},displayInfo:function C(V,c,S){var U=this.domNode,d=Q.call(this),a=false,T=0,b=0,W=10,Z=false,Y=d.childNodes[0],X=d.childNodes[2];V.forEach(function(m){var s,l,u,p,e,k,q,o,v,n,t,r;if(!Z){var g=d.insertRow(-1),j=g.insertCell(-1),i=g.insertCell(-1),h=g.insertCell(-1);g.className=I+"-tr";j.className=I+"-name";i.className=I+"-space";h.className=I+"-value";if(m===null){R.addClass(g,"separator");a=true;}else{if(a){R.addClass(g,"below-separator");}if(!S){i.innerHTML=":";}s=m.n;r=!m.skipEncode;j.innerHTML=r?D.encodeHtmlString(s,true):s;u=A.getComputedFontStyle(j);p=Math.ceil(A.measureTextWidth(j.innerHTML,u,u.bonus));q=U.offsetHeight>=E?1:2;if(p>P){o=A.truncateTextToLineWithWordWrap(s,u,P,q,true);if(o.canWordWrap){j.innerHTML=r?D.encodeHtmlString(o.text,true):o.text;}else{o=A.truncateTextToLineWithWordWrap(s,u,P,1);j.innerHTML=r?D.encodeHtmlString(o,true):o;}}T=Math.min(Math.max(T,p),P);l=m.v;n=m.isTrendLineFuncToken;if(n){v=K(l);}if(!n||!v.hasSuper){if(n){l=v.htmlText;}h.innerHTML=r?D.encodeHtmlString(l,true):l;e=A.getComputedFontStyle(h);k=Math.ceil(A.measureTextWidth(h.innerHTML,e,e.bonus,null,true));if(k>P){o=A.truncateTextToLineWithWordWrap(l,e,P,m.noTruncate?100:q,true);if(!o.canWordWrap){o=A.truncateTextToLineWithWordWrap(l,e,P,1,true);}h.innerHTML=r?D.encodeHtmlString(o.text,true):o.text;k=o.maxLineLen;}b=Math.min(Math.max(b,k),P);}else{h.innerHTML=v.htmlText;e=A.getComputedFontStyle(h);k=0;H.forEach(l,function(w){w.textWidth=A.measureSuperTextWidth(w.isSuper,w.v,e,e.bonus);k+=w.textWidth;});k=Math.ceil(k);if(k>P){o=A.truncateTextToLineWithWordWrapForTokens(l,e,P,m.noTruncate?100:q,true,true);if(!o.canWordWrap){o=A.truncateTextToLineWithWordWrapForTokens(l,e,P,1,true);}h.innerHTML=K(o.text).htmlText;k=o.maxLineLen;}b=Math.min(Math.max(b,k),P);}Y.style.width=T+"px";X.style.width=b+"px";t=T+b+W;d.style.width=mstrmojo.dom.isIE9?(t+2)+"px":t+"px";a=false;}if(U.offsetHeight>=E){var f=d.lastChild;f&&f.removeChild(f.lastChild);Z=true;}}});if(c){this.moveTo(c.x,c.y);}},moveTo:function(a,Z){var Y=mstrmojo.dom.position(document.body),W=this.domNode,b=W.offsetWidth,X=W.offsetHeight,V=Y.x+Y.w,c=Y.y+Y.h,T=a+N,S=Z+N;if(T>V-b||S>c-X){if(T<=V-b){S=c-X;}else{if(S<=c-X){T=V-b;}else{T=V-b;S=Z-N-X;}}}var U=W.style;U.left=T+G;U.top=S+G;},doLayout:function B(S){var U=this.domNode.getElementsByTagName("table")[0];if(!U){return ;}var V=R.getComputedStyle(this.domNode),T=S-parseInt(V.paddingLeft,10)-parseInt(V.paddingRight,10);T-=U.rows[0].cells[0].offsetWidth;T-=10;U.getElementsByClassName(I+"-value").forEach(function(W){W.style.maxWidth=T+G;});},posTo:function J(T){var S=this.domNode.style;S.left=T.x+G;S.top=T.y+G;},renderErrMsg:function F(S){Q.call(this).insertRow(-1).insertCell(-1).innerText=S;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.gm._IsAnchorable","mstrmojo.ui._HasUITheme","mstrmojo.VisUtility");var D=mstrmojo.dom,E=mstrmojo.VisUtility;mstrmojo.gm.DndTooltip=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.gm._IsAnchorable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.gm.DndTooltip",left:0,top:0,zIndex:10,boundaryNodeName:"boundary",popupNodeName:"infoNode",baseTipClass:"arrow",infoNodeOffset:0,popupNodeOffset:5,anchor:null,boundary:null,utils:mstrmojo.VisChartUtils,themeClassName:"mojo-theme-light",markupString:'<div id="{@id}" class="mstrmojo-Tooltip {@cssClass}" style="top:{@top}px;left:{@left}px;z-index:{@zIndex};position:absolute;{@cssText};"><div class="mstrmojo-Tooltip-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Tooltip-content {@contentNodeCssClass}" style="{@contentNodeCssText}"><div class="content"></div><div class="arrow"><div class="after"></div><div class="before"></div></div></div></div>',markupSlots:{infoNode:function(){return this.domNode.childNodes[1];},contentNode:function(){return this.domNode.childNodes[1].firstChild;},tipNode:function(){return this.domNode.childNodes[1].lastChild;}},toggle:function A(G){if(G){this.domNode.style.display="block";}else{this.domNode.style.display="none";}},updateContent:function(G,I,H){this.set("themeClassName",mstrApp.getThemeClassName());this.fillContent(G,I,H);this.positionDialog();},fillContent:function C(I,M,K){this.anchor=I;this.anchorPosition=M;this.contentNode.innerHTML=K||this.anchor.innerText||this.anchor.textContent;this.toggle(true);var G=E.getComputedFontStyle(this.contentNode),L=this.contentNode.innerHTML,H=E.measureTextWidth(L,G),J=130;if(H<=J){this.contentNode.style.width=H+"px";}else{this.contentNode.innerHTML=E.truncateTextToLineWithWordWrap(L,G,J,3);this.contentNode.style.width=J+"px";}},getTipDimension:function B(){var H=this[this.tipNodeName],G=D.position(H.firstChild);return G;},applyPopupNodePos:function F(I,H,K,G){var M=this[this.tipNodeName],J=M.style,N=this[this.popupNodeName],L=N.style;L.top=I+"px";L.left=H+"px";J.top=(K-I)+"px";J.left=(G-H)+"px";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.heatmap.vi.VisHeatMapColorTheme","mstrmojo.dom","mstrmojo.hash","mstrmojo.css","mstrmojo.VisUtility","mstrmojo.util.color");var E=mstrmojo.util.color,G=mstrmojo.VisUtility,C=mstrmojo.hash;var H={ON:0,OFF:1,PROPORTIONAL:2};var J={LABEL_CTNR_THRES:6,LABEL_CTNR_WIDTH_THRES:32,LGD_GUTTER:5,LABEL_PADDING:5};var L=0.5;function F(R,V){var P=[R];while(P.length!==0){var U=P.shift();if(U===undefined||U.deleted){continue;}V(U);var T=U.entityChildren;if(T!==undefined){var Q=T.length,S;for(S=0;S<Q;S++){P.push(T[S]);}}}}function D(R,U,S){if(R.deleted){return ;}if(S===undefined){U(R);}else{U(R,S);}if(R.entityChildren===undefined){return ;}var P=R.entityChildren,Q=P.length,T;for(T=0;T<Q;T++){var V=P[T];if(S===undefined){D(V,U);}else{var W=S;if(!W){W=T.toString();}else{W=W+":"+T;}D(V,U,W);}}}function K(T,S){var R=parseFloat(T),P=R.toString().length,Q=T.substring(P);return R*S+Q;}function O(P,S,Q){var R;if(Q){if(P===0){R="heatmap-level-1-header-on-top";}else{if(P===1){R="heatmap-level-2-header-on-top";}else{R="heatmap-level-3-header-on-top";}}}else{if(S===1){if(P===0){R="heatmap-one-level-1";}}else{if(S===2){if(P===0){R="heatmap-multi-level-1";}else{if(P===1){R="heatmap-two-level-2";}}}else{if(S>=3){if(P===0){R="heatmap-multi-level-1";}else{if(P===1){R="heatmap-multi-level-2";}else{if(P===2){R="heatmap-multi-level-3";}}}}}}}return R;}function B(P,Q){if(!P||!Q){return false;}return !(Q.x>=P.x+P.w||Q.y>=P.y+P.h||Q.x+Q.w<=P.x||Q.y+Q.h<=P.y);}function A(S,Q){var P=Math.max(S.x,Q.x);var U=Math.max(S.y,Q.y);var R=Math.min(S.x+S.w,Q.x+Q.w)-P;var T=Math.min(S.y+S.h,Q.y+Q.h)-U;if(R<0||T<0){return{x:NaN,y:NaN,w:NaN,h:NaN};}return{x:P,y:U,w:R,h:T};}function N(P){var Q=this.domSpan;Object.keys(P||[]).forEach(function(S){if(S!=="scale"&&S!=="family"){Q.className=S;var T=P[S];if(T){Q.style.fontFamily=P.family;Q.style.fontSize=K(T,P.scale);}var R=document.defaultView.getComputedStyle(Q);P[S]={fontSize:parseInt(R.fontSize,10),fontWeight:R.fontWeight};}});}function I(Q){var P=this.bgColor,R={value:P!==undefined?P:"#ffffff",opacity:1};return E.mix(Q,R);}function M(T){var X=T.e,V=T.css,Z=T.s,P=document.createElement("div"),U=this.getLabelColor(X,Z),Q=P.style;P.className=V+" heatmap-trun-text";Q.position="absolute";Q.width=Z.w+"px";Q.height=(Z.h+0.5)+"px";Q.lineHeight=T.lh+"px";Q.zIndex=1;Q.color=U;if(T.fontSize){Q.fontSize=T.fontSize;}if(T.fontFamily){Q.fontFamily=T.fontFamily;}if(T.fontWeight){Q.fontWeight=T.fontWeight;}P.innerHTML="<span>#label</span>".replace("#label",X.text);P.firstChild.setAttribute("idx",X.idx);X.labelDomNode=P;var R=document.createElement("div"),W=R.style;W.position="absolute";W.left=Z.x+"px";W.top=Z.y+"px";W.width=Z.w+"px";W.height=Z.h+"px";R.appendChild(P);var Y=document.createElement("div");Y.className="heatmap-label-square";var S=4;Y.style.width=S+"px";Y.style.height=S+"px";Y.style.top=(T.lh-S)+"px";R.appendChild(Y);return R;}mstrmojo.heatmap.vi.VisHeatMapCanvas=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.heatmap.vi.VisHeatMapCanvas",parent:null,root:null,colorTheme:null,attributes:[],scale:1,labelSetting:0,showMetric:false,bgColor:"#333333",numImages:0,offsetX:0,offsetY:0,markupString:'<div style="position:absolute; width:{@width}px; height:{@height}px"><canvas width={@width} height={@height} style="visibility: hidden; z-index:0"></canvas><span></span></div>',markupSlots:{domCanvas:function(){return this.domNode.firstChild;},domSpan:function(){return this.domNode.childNodes[1];},domImage:function(){return this.domNode.childNodes[2];}},init:function(P){if(this._super){this._super(P);}this.canvasStepX=this.scale*this.width;this.canvasStepY=this.scale*this.height;},postBuildRendering:function(){if(!this.isFontHeightMeasured){this.measureFontHeight();}this.draw();this._super();},removeImageAndLabels:function(){var R=this.domNode,T=R.childNodes,S=T.length,P;for(P=S-1;P>1;P--){var Q=T[P];R.removeChild(Q);}this.numImages=0;},removeLabels:function(){var S=this.domNode,U=S.childNodes,T=U.length,Q=1+this.numImages,P;for(P=T-1;P>Q;P--){var R=U[P];S.removeChild(R);}},updateOffsets:function(P,Q){this.offsetX=P;this.offsetY=Q;this.removeLabels();this.drawLabels();},draw:function(P,Q){if(P!==undefined){this.offsetX=P;}if(Q!==undefined){this.offsetY=Q;}this.removeImageAndLabels();this.drawRects();this.drawLabels();},drawRects:function(){var X=this.width,f=this.height,c=this.scale,Q=Math.ceil(X*c),Z=Math.ceil(f*c),Y=this.domCanvas,g=this.domNode,P=document.createDocumentFragment(),W=this.canvasStepX,V=this.canvasStepY,T=Math.ceil(Z/V),R=Math.ceil(Q/W),U=0,e,d,b,a;var S=function(p,t){var r,j,k,o,n,v,u;if(!p.deleted){if(p.entityChildren===undefined){r=p.size;j=p.color;}else{if(p.headerSize){r=p.headerSize;j=p.headerColor;}}if(B(a,r)){var i=Math.max(r.x-a.x,0),s=Math.max(r.y-a.y,0),h=Math.min(r.x+r.w-a.x,a.w),q=Math.min(r.y+r.h-a.y,a.h);k=j.value;if(E.isGradientColor(k)&&k.or===1){o=i;n=s;v=h;u=s;}else{o=i;n=s;v=i;u=q;}b.fillStyle=E.createCanvasFillPattern(j,b,o,n,v,u);b.fillRect(i,s,h-i,q-s);}}p.idx=t;};for(e=0;e<T;e++){for(d=0;d<R;d++){a={x:d*W,y:e*V,w:W,h:V};if(e+1===T){a.h=Z-a.y;}if(d+1===R){a.w=Q-a.x;}Y.width=a.w;Y.height=a.h;b=Y.getContext("2d");b.fillStyle="rgba(0, 0, 0, 0)";b.fillRect(0,0,a.w,a.h);D(this.root,S,"");var m=Y.toDataURL();var l=document.createElement("img");l.src=m;l.style.position="absolute";l.style.left=a.x+"px";l.style.top=a.y+"px";l.draggable=false;l.setAttribute("orgx",a.x);l.setAttribute("orgy",a.y);P.appendChild(l);U++;}}Y.width=0;Y.height=0;g.style.width=Q+"px";g.style.height=Z+"px";g.appendChild(P);this.numImages=U;},drawLabels:function(){var P=this.attributes.length,X=this,S=J.LGD_GUTTER*2,b=2*J.LABEL_PADDING,Z={x:this.offsetX,y:this.offsetY,w:this.width,h:this.height},a=[],W=[{},{},{}];var R=Math.floor(Math.log(this.scale)/Math.log(2));R=Math.min(R,P-3);R=Math.max(R,0);this._ext=R;var Q=this.labelSetting===H.OFF;var c="\u2026";function V(m,k,h,l){var f=9,j=8,i=false,g=X.getTextSize(m,k,f,h,false,l.w);while(j>=1){if(g.h<l.h){f+=j;}else{if(f===9){break;}if(f>=l.w){break;}if(!i){j/=2;}i=true;f-=j;}g=X.getTextSize(m,k,f,h,false,l.w);if(i){j=j>>1;}}if(g.h>l.h&&f>9){f--;}if(f>l.w){f=l.w;}return{fontSize:f,loc:l};}function d(m,q,o,p,v,r){var t=q&&(q.w-b),k=q&&(q.h-b);var g={drop:true};var j,i,s,u,f;if(X.labelSetting===H.PROPORTIONAL){var l=mstrmojo.hash.copy(q);l.w=t;l.h=k;var n=V(o,p,r,l);s=n.fontSize;l=n.loc;m.fs=s;m.lh=s;u=X.getTextSize(o,p,s,r,false,t);if(u.h>l.h){return g;}j=u.w;i=u.h;v=s;}else{s=v;u=X.getTextSize(o,p,s,r,false,t,true);f=X.getTextSize(c,p,s,r,false).scrollWidth;i=u.h;j=u.w;m.lh=s;if(u.scrollWidth/2+f+L>t){return g;}if(i>k){return g;}}m.isLowestLevel=true;return{w:j,h:i,fontSize:v};}function Y(j,n,q,o,p,v,r){var s=q&&q.w,m=q&&q.h,u=!X.isHeaderOnTop,t={drop:true};if(u&&P>1&&j===0){s-=S;m-=S;}var g,k,l,i;if(X.showMetric){g=X.getTextSize(o,p,v,r,false);}else{if(!a[j]){a[j]={};}var f=a[j];g=f[o];if(!g){g=X.getTextSize(o,p,v,r,false,s,true);f[o]=g;}}k=g.h;l=Math.min(g.w,s);if(u){i=0;}else{i=X.getTextSize(c,p,v,r,false).scrollWidth;}if(g.scrollWidth/2+i+L>s){return t;}if(k>m){return t;}n.lh=k;return{w:l,h:k,fontSize:v};}function e(f,o,m,i,k){var j=i.w;var g=i.h;var p=i.fontSize;var n=m.x+((m.w-j)/2);var l=m.y+((m.h-g)/2);k.s={x:n,y:l,w:j,h:g};if(W[f]===undefined){W[f]={};}var h=X.getFontGroup(X.fonts,f);if(h){k.fontFamily=h.family;}k.fontSize=p+"px";W[f][o]=k;}function T(g){if(g===X.root||g.deleted||(Q&&!g.entityChildren)){return true;}var f=(X.isHeaderOnTop&&g.entityChildren)?g.headerSize:g.size;if(!B(Z,f)){return true;}if(f.w<J.LABEL_CTNR_WIDTH_THRES+2*J.LABEL_PADDING||f.h<J.LABEL_CTNR_THRES){return true;}if(!X.isHeaderOnTop){var h=g.level-R;if(h<0||h>=3){return true;}}return false;}function U(l){if(T(l)){return ;}var p,f;if(X.isHeaderOnTop){p=l.entityChildren?l.headerSize:l.size;f=l.level;}else{p=l.size;f=l.level-R;}var i,n=l.text,q=l.idx,j=O(f,P,X.isHeaderOnTop),g=X.getFontGroup(X.measuredFonts,l.level),m=g.family,h=g[j],r=h.fontSize,o=h.fontWeight,k={s:{},e:l,m:0,css:j};if(!l.entityChildren){i=d(k,p,n,m,r,o);}else{i=Y(f,k,p,n,m,r,o);}if(i.drop){return ;}e(f,q,p,i,k);}F(this.root,U);if(this.isHeaderOnTop){this.layoutLabelsOnTop(W);}else{this.layoutLabelsOnMiddle(W);}},layoutLabelsOnTop:function(S){var V=document.createDocumentFragment(),U=S.length,R,T=this;for(R=0;R<U;R++){var W=S[R],Y;for(Y in W){var Q=W[Y],X=M.call(this,Q),P=X.firstChild.style;if(Q.isLowestLevel||T.isHeaderColorsModified()){P.color=T.getLabelColor(Q.e);}if(Q.isLowestLevel&&T.labelSetting===H.PROPORTIONAL){P.wordBreak="break-all";}else{P.textOverflow="ellipsis";P.wordBreak="normal";}V.appendChild(X);}}this.domNode.appendChild(V);},layoutLabelsOnMiddle:function(n){var q=document,R=q.createDocumentFragment(),g=this;function a(t){var r=M.call(g,t);var s=r.firstChild.style;if(t.isLowestLevel&&g.labelSetting===H.PROPORTIONAL){s.wordBreak="break-all";}else{s.wordBreak="normal";}R.appendChild(r);}var l=n[0],k=n[1],j=n[2],d,e;for(d in k){var m=k[d],Q=m.s,f=m.e,W=f.parentEntity,p=l[W.idx];if(p===undefined){a(m);}if(!!p){var U=p.s,X=A(Q,U);if(X.w>5||X.h>5){var o;if(U.y<=Q.y){o=((U.y+U.h-Q.y)>>1)+1;if(p.m!==2&&(U.y-o>=W.size.y)&&(Q.y+Q.h+o<=f.size.y+f.size.h)){U.y-=o;Q.y+=o;p.m=1;}else{e=true;}}else{o=((Q.y+Q.h-U.y)>>1)+1;if(p.m!==1&&(U.y+U.h+o<=W.size.y+W.size.h)&&(Q.y-o>=f.size.y)){U.y+=o;Q.y-=o;p.m=2;}else{e=true;}}}if(e!==true){a(m);}}}for(d in l){a(l[d]);}for(d in j){e=false;var Y=j[d],P=Y.e,S=P.parentEntity,T=S.parentEntity,h=S.idx,i=T.idx,Z=k[h],b=l[i];if(Z!==undefined){var c=A(Z.s,Y.s);if(!isNaN(c.w)){e=true;}}if(e===false&&b!==undefined){var V=A(b.s,Y.s);if(!isNaN(V.w)){e=true;}}if(e!==true){a(Y);}}this.domNode.appendChild(R);},getLabelColor:function(h,Z,W){var j,R=this.colorTheme,Y=I.bind(this),f,c,P,S;if(W){S=function(e){return W(Y(e));};}else{S=Y;}if(this.isHeaderOnTop){if(!h.entityChildren){f=h.color;}else{f=h.headerColor;}f=S(f);c=E.getColorValue(f.value);j=E.getCSSColorString(R.getContrastColor(c));}else{P=h.level-this._ext;if(P===0){return"#FFFFFF";}if(h.entityChildren===undefined){f=S(h.color);c=E.getColorValue(f.value);return E.getCSSColorString(R.getContrastColor(c));}var U=[h],V=0,a=0;while(U.length!==0){var d=U.shift(),X=d.entityChildren,b=d.entityChildren.length,g;for(g=0;g<b;g++){var T=X[g];if(T.deleted){continue;}var Q=A(Z,T.size);if(T.entityChildren===undefined){if(!isNaN(Q.w)){f=S(T.color);c=E.getColorValue(f.value);if(R.isBrightColor(c)){V+=Q.w*Q.h;}else{a+=Q.w*Q.h;}}}else{if(!isNaN(Q.w)){U.push(T);}}}}if(V>a){j="#000000";}else{if(P===1){j="#e6e7e8";}else{j="#d1d3d4";}}}return j;},getEntity:function(U){var Q=U.x,P=U.y,S;var R=function(a){if(a.deleted){return ;}var Y;if(a.entityChildren===undefined){Y=a.size;}else{if(a.entityChildren&&a.headerSize!==undefined){Y=a.headerSize;}}if(Y){var W=Y.x,Z=Y.y,V=W+Y.w,X=Z+Y.h;if(Q>=W&&Q<=V&&P>=Z&&P<=X){S=a;}}};var T=function(X,Z){if(X.deleted){return ;}Z(X);var V=X.entityChildren;if(V!==undefined){var W=V.length,Y;for(Y=0;Y<W;Y++){var a=V[Y];T(a,Z);if(S!==undefined){return ;}}}};T(this.root,R);return S;},getFontGroup:function(R,Q){if(!this.isHeaderOnTop){return R.headerOnMiddle;}var P=this.attributes.length;return P===Q+1?R.headerOnTop.cell:R.headerOnTop.header;},clearFontCache:function(){this.isFontHeightMeasured=false;},measureFontHeight:function(){this.measuredFonts=C.clone(this.fonts);var P=this.measuredFonts;N.call(this,P.headerOnMiddle);N.call(this,P.headerOnTop.header);N.call(this,P.headerOnTop.cell);this.isFontHeightMeasured=true;},getTextSize:function(Y,Q,c,Z,P,R,T){function S(g){var i=this.domSpan,d,f,e;i.className="";i.innerHTML=Y;i.style.cssText="position:absolute; visibility:hidden; z-index:-1; font-family:"+Q+"; font-size:"+c+"px; font-weight:"+Z+"; font-style:"+(P?"italic":"normal")+"; line-height:"+c+"px;";if(!g){d=i.offsetWidth;f=i.offsetHeight;}if(g||(R!==undefined&&d>R)){i.style.cssText+="overflow:hidden; word-break:"+X+"; width:"+R+"px;";f=i.offsetHeight;d=i.offsetWidth;if(g){e=i.scrollWidth;}}return{w:d,h:f,scrollWidth:g?e:d};}var a,U,b,W,V;var X="break-all";if(T){X="normal";}if(typeof c==="number"){W=c+"px";}Z=Z||"normal";if(this.showMetric){b=S.call(this);}else{V={fontFamily:Q,fontSize:W,fontWeight:Z,fontStyle:P?"italic":"normal"};a=Math.ceil(G.measureTextWidth(Y.trim(),V));U=c;if(R!==undefined&&a>R){b=S.call(this,true);}else{b={w:a,h:U,scrollWidth:a};}}b.w+=L;return b;}});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var E=mstrmojo.array,D=mstrmojo.hash,A=mstrmojo.func.wrapMethods;function B(F){return F.model.controller.cmdMgr;}mstrmojo._colorPalette=mstrmojo.provide("mstrmojo._colorPalette",{listenToUpdateColorMap:function(I){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var H=this,G,F=(H.getDocModel&&H.getDocModel())||H.model.docModel;if(F){return F.attachEventListener("colorMapChanged",H.id,function(K){G=H.parent.parent;if(G.isPanelDisplaying()){I.call(H);}else{var J=G.attachEventListener("panelDisplaying",H.id,function(L){if(H.postBuilderingCalled){I.call(H);}G.detachEventListener(J);});}});}},detachUpdateColorMapListener:function(G){if(!G){return ;}var F=(this.getDocModel&&this.getDocModel())||this.model.docModel;F.detachEventListener(G);},submitUpdatesAndPersistXML:function C(H,L,F,P){if(!H||H.length===0){return ;}var G={},M=this,Q=(M.getDocModel&&M.getDocModel())||M.model.docModel,O=Q.getDataService(),I=M.model.controller||Q.controller,J=I._getXtabCallback(M);if(F){D.copy(mstrmojo.DocDataService.SUPPRESS_DATA,G);}if(P){D.copy(mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION,G);}var K=false;E.forEach(H,function(R){if(R.act==="updateElementsPropertiesMap"){K=true;}});if(K){A(Q.getUpdateColorMapCallback(),J);}B(M).execute({execute:function N(){var R=O.newUpdate(this,undefined);R.add(H,L,G);this.submitUpdate(R);},urInfo:{callback:J}});},updateColorMap:function(I,G){if(!E.isArray((G))){G=[G];I=[I];}if(I.length!==G.length){throw new Error("comb and color number mismatch");}var F=(this.getDocModel&&this.getDocModel())||this.model.docModel,J=mstrmojo.VisUtility.getUpdateColorMapAction.bind(this),H=I.map(function(L,K){return J(L,JSON.stringify({color:G[K]}));});this.submitUpdatesAndPersistXML(H,F.getUpdateColorMapCallback(),false,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Container","mstrmojo.util.color","mstrmojo.VisUtility");var O=mstrmojo.util.color,F=mstrmojo.hash;var C={DARK:{BASE_FILL_COLOR:"#20516b",HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.4,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:"#34abeb",FONT_COLOR:"#34abeb"},LIGHT:{BASE_FILL_COLOR:"#bce8ff",HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.4,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:"#34abeb",FONT_COLOR:"#007ebe"}};function H(Q,P){return{x:Q.x+P,y:Q.y+P,w:Math.max(Q.w-2*P,0),h:Math.max(Q.h-2*P,0)};}function N(P,S,U,Q){var T=Q/2,R={x:S.x+T,y:S.y+T,w:Math.max(S.w-Q,0),h:Math.max(S.h-Q,0)};P.save();P.strokeStyle=U;P.lineWidth=Q;P.strokeRect(R.x,R.y,R.w,R.h);P.restore();}function G(P){return"_"+P;}function D(R,Q,S){if(!R){return ;}var T=R.style;if(T[Q]===S){return ;}var P=G(Q);if(R[P]===undefined){R[P]=getComputedStyle(R)[Q];T[Q]=S;}}function J(S,R){if(!S){return ;}var P=G(R),Q=S[P];if(Q!==undefined){S.style[R]=Q;S[P]=undefined;}}function M(P,R){var Q=H(R,this.outerBorderWidth);N(P,R,this.outerBorderColor,this.outerBorderWidth);N(P,Q,this.innerBorderColor,this.innerBorderWidth);}function I(P,R){var Q=H(R,this.outerBorderWidth);P.save();P.fillStyle=O.getCSSColorString(this.backgroundColor,0.3);P.fillRect(Q.x,Q.y,Q.w,Q.h);P.restore();}function E(P,T,R,S,U){D(R,"color",S.FONT_COLOR);var Q=H(T,1);P.save();if(U){P.fillStyle=O.getCSSColorString(S.BASE_FILL_COLOR,S.HOVER_SELECTED_FILL_OPACITY);}else{P.fillStyle=O.getCSSColorString(S.BASE_FILL_COLOR,S.SELECTED_FILL_OPACITY);}P.fillRect(Q.x,Q.y,Q.w,Q.h);P.restore();N(P,T,S.BORDER_COLOR,1);}function B(R,P,Q){if(P&&!R){Q.selected();}else{if(!P&&R){Q.hover();}else{if(P&&R){Q.hoverSelected();}}}}function L(P,Q){return{hover:function(){I.call(this,P,Q);}.bind(this),selected:function(){M.call(this,P,Q);}.bind(this),hoverSelected:function(){M.call(this,P,Q);I.call(this,P,H(Q,1));}.bind(this)};}function A(U,V,R){var S=R.isEntityContainer,P=R.isSelected,T=R.isHovered,X=this.canvas.getContext("2d"),W=this.themeType==="dark"?C.DARK:C.LIGHT;var Q;if(S){Q={hover:function(){J(V,"color");var Y=H(U,1);X.save();X.fillStyle=O.getCSSColorString(W.BASE_FILL_COLOR,W.HOVER_FILL_OPACITY);X.fillRect(Y.x,Y.y,Y.w,Y.h);X.restore();},selected:function(){E(X,U,V,W,false);},hoverSelected:function(){E(X,U,V,W,true);}};}else{Q=L.call(this,X,U);}D(V&&V.parentNode,"zIndex",3);X.clearRect(U.x,U.y,U.w,U.h);B(T,P,Q);}function K(V,W,R){var S=R.isEntityContainer,P=R.isSelected,T=R.isHovered,X=this.canvas.getContext("2d");var U=this,Q;if(S){Q={hover:function(){J(W,"textDecoration");X.clearRect(V.x,V.y,V.w,V.h);I.call(U,X,V);},selected:function(){U.clear();D(W,"textDecoration","underline");},hoverSelected:function(){X.clearRect(V.x,V.y,V.w,V.h);I.call(U,X,V);D(W,"textDecoration","underline");}};}else{X.clearRect(V.x,V.y,V.w,V.h);Q=L.call(this,X,V);}D(W&&W.parentNode,"zIndex",3);B(T,P,Q);}mstrmojo.heatmap.vi.VisHeatMapHighlightCanvas=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.heatmap.vi.VisHeatMapHighlightCanvas",markupString:'<div id={@id}-HeatMapHighlightCanvas style="z-index: 2; position: absolute; left: {@left}px; top: {@top}px; width: {@width}px; height: {@height}px;"><canvas width={@width} height={@height}></canvas></div>',markupSlots:{canvas:function(){return this.domNode.firstChild;}},backgroundColor:"#ffffff",init:function(P){this.isOnSelectionMode=mstrmojo.emptyFn;this.alpha=0.4;this.themeType="dark";if(this._super){this._super(P);}if(this.themeType==="dark"){this.outerBorderColor="#ffffff";this.innerBorderColor="#000000";}else{this.outerBorderColor="#000000";this.innerBorderColor="#ffffff";}this.outerBorderWidth=2;this.innerBorderWidth=1;this.maskColor="#1f1f1f";},preBuildRendering:function(){var P=this.placeholder;this.width=P.offsetWidth;this.height=P.offsetHeight;if(this._super){this._super();}},hide:function(){this.domNode.style.display="none";},show:function(){this.domNode.style.display="block";},clear:function(Q){this.show();if(!Q){Q={x:0,y:0,w:this.width,h:this.height};}var P=this.canvas.getContext("2d");P.save();P.clearRect(Q.x,Q.y,Q.w,Q.h);if(this.isOnSelectionMode()){P.fillStyle=O.getCSSColorString(this.maskColor,this.alpha);P.fillRect(Q.x,Q.y,Q.w,Q.h);}P.restore();},resetCanvasRect:function(P){this.width=P.w;this.height=P.h;this.domNode.style.width=P.w+"px";this.domNode.style.height=P.h+"px";this.canvas.width=P.w;this.canvas.height=P.h;},highlight:function(U,T,S){S=F.copy(S,{isHovered:false,isSelected:false,isEntityContainer:false,isHeaderOnTop:false});var R=S.isHeaderOnTop,Q=S.isSelected,W=S.isHovered,V=this.isOnSelectionMode(),P=this.canvas.getContext("2d");this.show();if(!W&&!Q){J(T&&T.parentNode,"zIndex");J(T,"textDecoration");J(T,"color");P.clearRect(U.x,U.y,U.w,U.h);if(V){this.clear(U);}else{this.clear();}return ;}if(R){A.call(this,U,T,S);}else{K.call(this,U,T,S);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.gm.DndTooltip","mstrmojo.VisUtility","mstrmojo.vi.models.EnumDragSources");var N=mstrmojo,I=N.dom,K=N.VisUtility,C=N.vi.models.EnumDragSources,J=N.array;mstrmojo.gm._SupportDndAsBlackBox=mstrmojo.provide("mstrmojo.gm._SupportDndAsBlackBox",{_mixinName:"mstrmojo.gm._SupportDndAsBlackBox",mainContainerNode:"domNode",handleDndForParentNode:true,dndAsBlackBox:true,allowDrop:function H(R){var S=R.src.data,Q=S&&S.src;if(Q===C.DATASETS||Q===C.VIZ_EDITOR||Q===C.VIZ||Q===C.ALL_OBJECT_LIST){return true;}return false;},cleanUpAfterTarget:function E(Q){this._super(Q);if(this.domNode.contains(this.dndHighlightCanvas)){this.domNode.removeChild(this.dndHighlightCanvas);}delete this.dndHighlightCanvas;if(this.dndTooltip){this.dndTooltip.destroy();}delete this.dndTooltip;},ondragenter:function M(R){if(this._super){this._super(R);}var W=this.isEmpty();if(W){R.tgt.widget=this;this.raiseEvent({name:"toggleCtrlOverlay",visible:false,controls:this.getVisEmptyMsgControls()});}var V;if(!this.dndHighlightCanvas){var Q=document.createElement("canvas"),U=I.position(this.domNode),T=I.position(this[this.mainContainerNode]);this.domNode.appendChild(Q);Q.style.position="absolute";Q.style.zIndex=1000;Q.width=T.w||U.w;Q.height=T.h||U.h;Q.style.top=(T.y-U.y)+"px";Q.style.left=(T.x-U.x)+"px";this.dndHighlightCanvas=Q;}if(!this.dndTooltip){V=document.createElement("div");document.body.appendChild(V);var S={placeholder:V,contentNodeCssClass:"gm-dnd-replace-node-tooltip",boundary:document.body};this.dndTooltip=new mstrmojo.gm.DndTooltip(S);this.dndTooltip.render();this.dndTooltip.parent=this;}this.ondragover(R);},ondragover:function B(Q){if(this._super){this._super(Q);}if(this.dndAsBlackBox){this.clearHighlightDropZoneOnGraph();this.drawBlackBoxHighlight(Q);}},ondragleave:function P(Q){var R=this.isEmpty();if(R){this.raiseEvent({name:"toggleCtrlOverlay",visible:true,controls:this.getVisEmptyMsgControls()});}if(this._super){this._super(Q);}},ondrop:function L(R){if(this._super){this._super(R);}if(this.dndAsBlackBox){var U=this.zonesModel,T=R.src.data,Q=T.items,S=R.getCtxtDragData().src;U.addUnitsFromDataSource(Q,T.dsid,R.actions,S===C.ALL_OBJECT_LIST?R.callback:null);}},clearHighlightDropZoneOnGraph:function G(){var R=this.dndHighlightCanvas,Q=R.getContext("2d");Q.clearRect(0,0,R.width,R.height);this.dndTooltip.toggle(false);},isMetric:function O(Q){return Q&&Q.t===4;},isAttrCategory:function D(Q){return Q&&(Q.t===12||Q.t===1||Q.t===47);},singleTypeObject:function F(Q){var T=0,S=0,R=this;J.forEach(Q.src.data.items,function(U){if(R.isAttrCategory(U)){T++;}else{if(R.isMetric(U)){S++;}}});return !(T>0&&S>0);},drawBlackBoxHighlight:function A(S){var T=this.dndHighlightCanvas,a=T.getContext("2d"),X=I.position(this[this.mainContainerNode]),Q=I.position(this.domNode),R=X.w||Q.w,Z=X.h||Q.h,W=Math.min(30,0.25*R),b=Math.min(30,0.25*Z);a.save();a.beginPath();a.rect(W,b,R-2*W,Z-2*b);a.fillStyle="#bce8ff";a.globalAlpha=0.4;a.fill();a.strokeStyle="#34abeb";a.globalAlpha=1;K.drawDashLine(a,W,b,W,Z-b,2,2);K.drawDashLine(a,W,b,R-W,b,2,2);K.drawDashLine(a,R-W,b,R-W,Z-b,2,2);K.drawDashLine(a,W,Z-b,R-W,Z-b,2,2);a.restore();if(!this.singleTypeObject(S)){var U=this.dndTooltip,Y={x:S.tgt.e.x,y:S.tgt.e.y,w:0,h:0},V=S.src.widget.avatar;if(V){Y=I.position(V);}U.placementOrder=[U.PLACEMENT_ABOVE];U.popupNodeOffset=5;U.updateContent(null,Y,"Add Attributes and Metrics");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.Label","mstrmojo.array","mstrmojo.hash","mstrmojo.Popup","mstrmojo.Box","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.PopupConfig","mstrmojo.ui.Pulldown","mstrmojo.dom","mstrmojo._FormatDefinition","mstrmojo.Button","mstrmojo.models.FormatModel","mstrmojo.VisUtility","mstrmojo.heatmap.vi.VisHeatmapUtility");var J=mstrmojo.array,B=mstrmojo.hash,I=mstrmojo.dom,D=mstrmojo.VisUtility,G=mstrmojo.heatmap.vi.VisHeatmapUtility,H=mstrmojo._FormatDefinition,L=mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS;var M=H.Families.slice(1).map(function(P){return{n:P.n,did:P.n};});function O(Q,S){var P=Q.length,R;for(R=0;R<P;R++){if(S===Q[R].did){return R;}}}function K(Q,P){Q=Q||[];J.forEach(Q,function(R){R.cssDisplay="inline-block";});return B.copy(P||{},{scriptClass:"mstrmojo.Box",cssClass:"row-container",children:Q});}function E(R,Q,S,T){var P=function(U){var V=U.value,W=R[V]&&R[V].did;S.setValue(W);};return A(R,Q,P,T);}function A(Q,P,T,S){S=S||"60px";var R=new mstrmojo.ui.Pulldown({items:Q,width:S,postselectedIndexChange:T});R.set("selectedIndex",P);return{scriptClass:"mstrmojo.Box",children:[R]};}function F(S,Q){Q=B.copy(Q,{label:mstrmojo.desc(3905,"Background"),noOpacity:false,showNoFill:true});var R=!Q.noOpacity;var V,T,P;var X="ColorClr",Y="ColorFillTrans";if(R){V=L.FILL_COLOR|L.FILL_TRANSPARENCY;T=[X,Y];P="125px";}else{V=L.FILL_COLOR;T=[X];P="60px";}var U=new mstrmojo.ui.editors.controls.FillConfigGroup({colorPickerHostWithin:true,showNoFill:Q.showNoFill,visibleControls:V,onGroupValueChange:function(Z,a){if(Z===X){S.value.setValue(a);}if(Z===Y){S.opacity.setValue(a/100);}},width:P});if(U){if(R){U.fillColorAndTrans.layoutConfig={w:{col1Node:"50%",dividerNode:"5px",col2Node:"50%"},xt:true};}U.iniChildrenComp(T);U.syncControls(function(){this.setChildValue(X,S.value.getValue());if(R){this.setChildValue(Y,S.opacity.getValue()*100);}});}var W=[{scriptClass:"mstrmojo.Box",width:"60px",children:[{scriptClass:"mstrmojo.Label",text:Q.label}]},U];return[K(W)];}var C={background:F,headerFill:F,font:function(R,S){var P=G.getStepper(function(T){if(T>0){R.scale.setValue(R.scale.getValue()+0.1);}else{R.scale.setValue(Math.max(0.1,R.scale.getValue()-0.1));}},{width:"62px"});this.attachEventListener("fontScaleChange",this.id,function(T){G.setStepperEnabled(P,[S.modelPath],T.limits);if(S.disableFontSize){P.set("enabled",false);}});var Q=[K([{scriptClass:"mstrmojo.Box",width:"60px",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3544,"Text")}]},P,E(M,O(M,R.family.getValue()),R.family)])];this.triggerFontScaleChangeEvent();return Q;},attributeColorBy:function(W,S){S=S||{};var V=mstrmojo.desc(2885,"Fill"),X=S.callback;var U="ShapeClr",Q="ShapeFillTrans",P=X&&X.onFillChanged&&X.onOpacityChanged,R=P?function(Z,Y){if(Z===U){X.onFillChanged.call(this,Y,function(a){T.syncControls(function(){this.setChildValue(U,a);});});D.setColorPickerShowAutomatic(T,Y!=="automatic");}else{if(Z===Q){X.onOpacityChanged.call(this,Y);}}}:mstrmojo.emptyFn,T=new mstrmojo.ui.editors.controls.FillConfigGroup({colorPickerHostWithin:true,onGroupValueChange:R,width:"125px"});if(T){T.fillColorAndTrans.layoutConfig={w:{col1Node:"50%",dividerNode:"5px",col2Node:"50%"},xt:true};T.iniChildrenComp([U,Q]);T.syncControls(function(){this.setChildValue(U,W.color);this.setChildValue(Q,W.opacity);});D.setColorPickerShowAutomatic(T,W.showAutomatic);}return[K([{scriptClass:"mstrmojo.Box",width:"60px",children:[{scriptClass:"mstrmojo.Label",text:V}]},T],{width:"147px"})];},metricColorByOpacity:function(Q){var R="ShapeFillTrans";var P=new mstrmojo.ui.editors.controls.FillConfigGroup({visibleControls:L.FILL_TRANSPARENCY,onGroupValueChange:function(T,S){if(T===R&&Q){Q.setValue(S/100);}},width:"60px"});if(P&&Q){P.iniChildrenComp([R]);P.syncControls(function(){this.setChildValue(R,Q.getValue()*100);});}return[K([{scriptClass:"mstrmojo.Box",width:"60px",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2885,"Fill")}]},P])];}};function N(Y,S,T){var X=[],R=this;Y.forEach(function(f){var c=f.type,b=f.model,a=C[c],e=R.getWidget();if(a){X=X.concat(a.call(e,b,f));}});if(X.length){var U=I.position(this.containerNode,true),W=S.pageX-U.x,V=S.pageY-U.y;var P={scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+mstrApp.getThemeClassName(),locksHover:true,children:X};var Q=this._contextMenuAnchor;if(!Q||!Q.parentElement){Q=document.createElement("div");Q.style.position="absolute";this._contextMenuAnchor=Q;this.containerNode.appendChild(Q);}Q.style.left=W+1+"px";Q.style.top=V+1+"px";var Z={hostId:this.id,hostElement:Q,isHostedWithin:false};if(T){Z.alignment=T;}P.popupConfig=new mstrmojo.ui.PopupConfig(Z);P.visible=true;P.onClose=function(){this.unrender();};return P;}}mstrmojo.heatmap.vi._HasHeatmapContextMenu=mstrmojo.provide("mstrmojo.heatmap.vi._HasHeatmapContextMenu",{getWidget:function(){return this;},showContextMenu:function(P,Q,R){P=[].concat(P);this.openPopup(N.call(this,P,Q,R));},unrender:function(P){this._contextMenuAnchor=undefined;this._super(P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.gm.GMUtility","mstrmojo.color","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus.ToolbarEditorConfig","mstrmojo.vi.ui.editors.EditorGroup","mstrmojo.ui.editors.controls.LineConfigGroup","mstrmojo.ui.editors.controls.FillConfigGroup","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.AdvancedColorPicker");var Z=mstrmojo,I=Z.dom,K=Z.hash,a=Z.array,A=Z.css,i=Z.VisEnum.ControlType,h=mstrmojo.gm,F=mstrmojo.color,U=h.GMUtility,R=Z.VisUtility,j=h.FormatingPropertyTag,e=mstrmojo.models.FormatModel,c=e.ENUM_PROPERTY_NAMES,P=mstrmojo.chart.enums.EnumFontStyle,f=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,G=mstrmojo.VisEnum.NetworkLegendFormattingCategory,V=mstrmojo.ui.editors.controls.AdvancedColorPicker,W={GLOBAL:"glb",FORMATTING:"fmt"},D={FONT_COMP:"FntCmp",FONT_FAMILY:"FntFml",FONT_STYLE:"FntStyle",FONT_SIZE:"FntSz",FONT_COLOR:"FntClr",LINE_COMP:"LnCmp",SHOW:"Shw",COLOR:"Clr",STYLE:"Style",THICKNESS:"Thk"};function N(q,n){var m=this.widget,o=m.domToolbarPH,p=this;m._lastOpened=null;o.innerHTML="";document.body.appendChild(o);A.toggleClass(o,mstrApp.getThemeClassName(),true);this.configureLegendPopup(n,o);m.toolEditor=n.newInstance({unrender:function(){}});m.toolEditorClosefn=function(r){var t=r.target,s=m.toolEditor.domNode;if(!I.contains(s,t,true,s)&&!R.isHostedPopupNode(t,"class",true,document.body)){p.hideToolbar();}};I.attachEvent(document.body,"mousedown",m.toolEditorClosefn,true);m.openPopup(this.widget.toolEditor);A.toggleClass(document.body,"hasToolbarPopup",true);}function L(n,m){var o;if(m===W.GLOBAL){o=this.readGlobalProperty(n);}else{if(m===W.FORMATTING){o=this.widget.getPropertiesOfFormatable();}}if(n.slice(-3)===D.COLOR){if(n!==j.COLOR_SQUARE_COLOR||m!==W.GLOBAL){o=U.decodeColor(o);}}return o;}function Q(n,m){var o=this;if(m===W.GLOBAL){return function(q){var p=L.call(o,n,W.GLOBAL);if(n===j.COLOR_SQUARE_COLOR){p=p.color;}if(!K.equals(q,p)){if(n.indexOf(D.COLOR)!==-1){q=U.encodeColor(q);}o.writeGlobalProperty(n,q);}};}return function(r,p){var q=L.call(o,n,W.FORMATTING);if(r!==q){if(n.indexOf(D.COLOR)!==-1){r=F.encodeColor(r);}o.widget.writeFormatableProperties(n,r,p);}};}function O(n,m){n=n||[];m=m||"";a.forEach(n,function(o){o.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.HBox",cssClass:m,children:n};}function d(n,o){n=n||[];var m=new mstrmojo.Box({children:n,cssText:o});return m;}function B(q,r,m){var p="white-space: nowrap; width: 50px;";if(q===mstrmojo.desc(3905,"Background")||q===mstrmojo.desc(6242,"Color")){p="white-space: nowrap;";}else{if(q===mstrmojo.desc(2885,"Fill")){p="white-space: nowrap; margin-right: 9px;";}}var n=new mstrmojo.Label({text:q}),o=d(n,p);return O([o,r],m);}function b(n,o,m){var p=this;n=n||{};if(n.propNames===undefined){n.propNames=o;}n.onGroupValueChange=function(q,s,r){if(s!==r&&s!==undefined){(Q.call(p,q,m))(s,r);}};return n;}function S(o,n,m){var p=this;a.forEach(n,function(q){var r=L.call(p,q,m);if(r!==undefined){o.setChildValue(q,r);}});}function C(m,p,o,n){n=b.call(this,n,p,o);K.copy({width:"140px",height:"22px",colorPickerHostWithin:true},n);var q=new mstrmojo.ui.editors.controls.FillConfigGroup(n);if(q){q.iniChildrenComp(p);S.call(this,q,p,o);}if(typeof m==="string"){return B(m,q,(n||[]).rowContainerCSSClass);}return q;}function Y(o,n,m){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-ToolBoxBackgroundFill",children:[C.call(this,mstrmojo.desc(2885,"Fill"),o,n,K.copy({rowContainerCSSClass:"mstrmojo-ui-rowContainer"},m))]}]});}function k(q,o,s,r,n){var p=L.call(this,s,r),t=this;var m=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:!!n,isHostedWithin:true,width:"40px",selectedValue:p,showNoFill:false,postselectedValueChange:function(u){(Q.call(t,s,r))(u.value,u.valueWas);}});if(q){m.alias=q;}if(typeof o==="string"){return B(o,m);}return m;}function l(n){var m;if(n.listenToUpdateColorMap instanceof Function){m=n.listenToUpdateColorMap(function(){n.raiseEvent({name:"colorByColorChange",type:"invalidateCache"});if(m&&n.detachUpdateColorMapListener instanceof Function){n.detachUpdateColorMapListener(m);}});}}function g(o,n){var m=L.call(this,o,n),p=this;return new mstrmojo.ui.menus.ToolbarEditorConfig({cssClass:"cbsquare-colorpicker",contents:[new mstrmojo.ui.editors.controls.AdvancedColorPicker({showAutomatic:!m.isDefaultColor,color:m.color,colorChanged:function(q){q=(this.showAutomatic&&q===V.VAL_AUTOMATIC)?"default":q;l(p.widget);(Q.call(p,o,n))(q,m.color);p.hideToolbar();},colorCanceled:function(){p.hideToolbar();}})]});}function T(s,n){var m={},r=L.call(this,n+D.FONT_STYLE,W.GLOBAL),p=L.call(this,n+D.FONT_COLOR,W.GLOBAL),o=L.call(this,n+D.FONT_FAMILY,W.GLOBAL),q=L.call(this,n+D.FONT_SIZE,W.GLOBAL);if(r!==undefined){m[c.FONT_WEIGHT]=(!isNaN(r)&&((r&P.FS_BOLD)>0));m[c.FONT_STYLE]=(!isNaN(r)&&((r&P.FS_ITALIC)>0));m[c.UNDERLINE]=(!isNaN(r)&&((r&P.FS_UNDERLINE)>0));m[c.LINE_THROUGH]=(!isNaN(r)&&((r&P.FS_STRIKETHROUGH)>0));}if(p!==undefined){m[c.COLOR]=p;}if(q!==undefined){m[c.FONT_SIZE]=q;}if(o!==undefined){m[c.FONT_FAMILY]=o;}s.setFormatSource(m);}function H(n,m){var o=null;if(m.indexOf(D.FONT_FAMILY)!==-1){o=n.fontFamily;}else{if(m.indexOf(D.FONT_STYLE)!==-1){o=n.fontStyle;}else{if(m.indexOf(D.FONT_SIZE)!==-1){o=n.fontSize;}else{if(m.indexOf(D.FONT_COLOR)!==-1){o=n.fontColor;}}}}return o;}function M(p,o,m){var n={bold:P.FS_BOLD,italic:P.FS_ITALIC,underline:P.FS_UNDERLINE,strikeout:P.FS_STRIKETHROUGH},q=this;o.forEach(function(r){var s=H(p,r);if(s){s.propName=r;if(r.indexOf(D.FONT_STYLE)!==-1){s.postselectionChange=function(t){var w=t.added,x=s.items[(w&&w[0]!==undefined)?w[0]:t.removed[0]],v=!!w,u=L.call(q,r,m),y=(u===undefined?0:u);if(v){y=y|n[x.css];}else{y=y&(~n[x.css]);}s.parent.raiseFormatValueChange(r,y,u);};}else{if(r.indexOf(D.FONT_FAMILY)!==-1){s.postselectedIndexChange=function(t){var w=t.value,v=t.valueWas;if(w!==v){var u=s.items;s.parent.raiseFormatValueChange(r,u[w].id,u[v]&&u[v].id);}};}else{if(r.indexOf(D.FONT_SIZE)!==-1){s.postselectedValueChange=function(t){var v=parseInt(t.value,10)+"pt",u=parseInt(t.valueWas,10)+"pt";if(v!==u){s.parent.parent.raiseFormatValueChange(r,v,u);}};}else{s.postselectedValueChange=function(t){s.parent.parent.raiseFormatValueChange(r,t.value,t.valueWas);};}}}}});}function X(n,q,p,o){var t=this;o=o||{};if(o.propNames===undefined){o.propNames=q;}if(o.onGroupValueChange===undefined){o.onGroupValueChange=function(u,w,v){if(w!==v&&w!==undefined){(Q.call(t,u,W.GLOBAL))(w,v);}};}var m={cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,width:"381px",height:"22px"};o=K.copy(m,o);var s=new mstrmojo.ui.editors.controls.CharacterGroup(o),r=H(s,j.LEGEND_FONT_COLOR);r.showNoFill=false;M.call(this,s,q,p);T.call(this,s,n);return s;}function J(q,p){var u=p.firstChild,y=u?u.offsetWidth:0,n=u?u.offsetHeight:0,r=document.body.offsetWidth,x=document.body.offsetHeight,s=10,t=5,w=5;if(u){u.style.left="0";u.style.right="auto";u.style.top="0";u.style.bottom="auto";}var v={w:y,h:0};var o=n>0;if(o){v.h=n;}else{return false;}if(o){p.style.left=q.x+"px";p.style.top=q.y-n-s/2+"px";}if(q.x+v.w>r){p.style.left=q.x-y+"px";}if(o){var m=0;if(q.y-n-s/2<t){m=t;p.style.top=m+"px";}else{if(q.y+s/2>x){m=Math.max(x-s-n,t);p.style.top=m+"px";}}}}function E(m,p,o,n){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",showDivider:false,children:[X.call(this,m,p,o,n)]}]});}mstrmojo._FormateVisLegend=mstrmojo.provide("mstrmojo._FormateVisLegend",{_mixinName:"mstrmojo._FormateVisLegend",widget:null,readGlobalProperty:undefined,writeGlobalProperty:undefined,configureLegendPopup:undefined,init:function(m){this.widget=null;if(this._super){this._super(m);}if(this.widget&&!this.widget.domToolbarPH){var n;n=document.createElement("div");n.setAttribute("class","gm-menu-placeholder");this.widget.domToolbarPH=n;}},handleRMCOnLegend:function(x){var r=x.getTarget(),s=x.e,v={x:s.pageX,y:s.pageY},u=r.getAttribute("type"),n,t,p,q=this,o=this.widget;x.cancel();x.preventDefault();if(mstrApp.isAppStatePresentation()||!mstrApp.allowWebDashboardDesign()){return ;}var w,m=function(y){switch(y){case i.LGD_COLORBOX_CTN:case i.LGD_COLORBOX:if(y===i.LGD_COLORBOX){r=r.parentNode;}t=r.firstChild.identity;if(t&&t.comb){this.widget.colorSqureIdentity=t;this.selectColorBox(r,this.fmtMode);n=g.call(this,j.COLOR_SQUARE_COLOR,W.GLOBAL);v=this.adjustColorPickerPos(r);if(!v.alignLeft){p=n.ENUM_CORNERS;n.setAlignment(p.BOTTOM_LEFT,p.TOP_RIGHT);}}break;case i.LGD_TITLE:case i.LGD_TEXT:this.selectText(true);var z=[j.LEGEND_FONT_SIZE,j.LEGEND_FONT_FAMILY,j.LEGEND_FONT_STYLE,j.LEGEND_FONT_COLOR];n=E.call(this,"lgd",z,W.GLOBAL);w="lgd";break;default:this.selectLegendBody();var AA=[j.LEGEND_BG_COLOR,j.LEGEND_BG_FILL_TRANSPARENCY];n=Y.call(this,AA,W.GLOBAL);w="lgd";break;}if(n){N.call(this,v,n);if(!!w){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");o.parent.selectVIUnit();var AB=o.edtModel._targetPulldown;if(AB){AB.selectItemByField("v",w);}}}};m.call(this,u);J.call(this,v,this.widget.domToolbarPH);},hideToolbar:function(){var n=this.widget,o=n.domToolbarPH,q=o.firstChild,m=o.parentNode;if(q){o.removeChild(q);}if(m){m.removeChild(o);}var p=n.toolEditor;if(p){p.unrender=function(){p._super();};p.destroy();p.unrender=function(){};delete n.toolEditor;A.toggleClass(document.body,"hasToolbarPopup",false);A.toggleClass(o,mstrApp.getThemeClassName(),false);}if(n.toolEditorClosefn){I.detachEvent(document.body,"mousedown",n.toolEditorClosefn,true);delete n.toolEditorClosefn;}},highlightText:function(m){throw new Error("subclass need to implement highlightText function");}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.VisEnum","mstrmojo.VisLegend","mstrmojo.VisUtility","mstrmojo.gm.GMEnums","mstrmojo.gm.GMIdentities","mstrmojo.gm.GMUtility","mstrmojo.array","mstrmojo.string","mstrmojo.hash","mstrmojo._FormateVisLegend","mstrmojo.ui._HasScroller");var Ad=mstrmojo,Aa=Ad.gm,y=Ad.dom,AZ=Ad.css,R=Ad.hash,AL=Ad.VisUtility,Z=Aa.GMUtility,O=mstrmojo.array,X=mstrmojo.string,e=Aa.ColorSquareIdentity,C=Ad.VisEnum.ControlType,i=Aa.EnumLegendSlot,AJ=Aa.EnumDockPosition,m=Aa.EnumLegendSlot,AD=Aa.EnumIdentityType,AB=Aa.EnumShape,AV=Ad.VisEnum.GMLegendDataType,I=mstrmojo.desc(13966,"Size by:"),u="px",E=1.35,Y=0.75,V=5,J=20,k=J,AC=5,A=5,v=16,d=15,G=16,AG=20,q=15,Ab=1,x="setAttribute",j=3,g=2,P=8,p=15,AQ=14,s=1,Q=2,f=4,Ae=8,Ac=16,K=10,AS=3,AH=50,AN=-3,r=5,AO="gm-legend-lock-icon",AK=mstrmojo.desc(14442,"This metric has its axis scale set to custom min and max values"),N="http://www.w3.org/2000/svg",t="\u2026",M=/[ \-]/;function AP(Ak,Am,Af,An){if(!Ak){return ;}var Ah,Aq,Ai,Ap,Al=Ak.style,Ar=Am===AJ.TOP,Ag=Am===AJ.BOTTOM,Ao=Am===AJ.LEFT,Aj=Am===AJ.RIGHT;if(Ar||Ag){Ah=Af;Aq=1;Ai=-1;Ap=AN;if(Ag){Ap+=An;}}else{if(Ao||Aj){Ah=1;Aq=An;Ap=-1;Ai=AN;if(Aj){Ai+=Af;}}}Al.cssText="left:"+Ai+u+";top:"+Ap+u+";width:"+Ah+u+";height:"+Aq+u+";";}function H(Ag){var Af=String(Ag);return Af.indexOf(" ")>=0||Af.indexOf("-")>=0;}function W(Ah,Ag,Ai){var Af=typeof Ah==="string"?Z.restoreSpecialChars(Ah):Ah;return AL.measureTextWidth(Af,Ag,Ai);}function AF(Aj,Ai,Ag,Af){var Ah=W(Ai,Ag,K);Aj.setAttribute("measureWidth",Ah);if(Ah>Af){Ah=Af;}else{Aj.style.overflow="visible";}Aj.setAttribute("displayWidth",Ah);Aj.style.width=Ah+u;return Ah;}function B(Ag){var Af;if(Ag.textContent&&typeof (Ag.textContent)!==undefined){Af=Ag.textContent;}else{Af=Ag.innerText;}return Af;}function a(Ah){var Ag=Ah.getAttribute("measureWidth"),Af=Ah.getAttribute("displayWidth");if(!Ag){Ah[x]("title","");}Ag=parseFloat(Ag,10);Af=parseFloat(Af,10);if((Ag-Af)>0.1){Ah[x]("title",B(Ah));}else{Ah[x]("title","");}}function AI(Aj,Af,Ag,Ai){var Ah=document.createElement("div");Ah[x]("class","gm-legend-underLine");Ah.style.width=Ai-K+u;Ah.style.left=Af+5+u;Ah.style.top=Ag+u;Aj.appendChild(Ah);}function AU(Ai,Af,Ag){var Ah=document.createElement("div");Ah[x]("class","gm-legend-underLine-anchorPoint");Ah.style.left=Af+u;Ah.style.top=Ag-3+u;Ai.appendChild(Ah);}function AE(Ai,Af,Ag,Ah){AI(Ai,Af,Ag,Ah);AU(Ai,Af,Ag);}function l(Ah,As,Ao,Am,Aq){var An,Ai,Ap,Af,Ar=Z.restoreSpecialChars(Ah.innerHTML),Al=Ar.length,Aj=0,Ag=Al,Ak=false;if(Ah.scrollHeight>1.5*G){An=W(Ah.innerHTML,As,K);Ai=An-Ao+K;if(Ai>Aq){while((Ag-Aj)>1){Ap=(Aj+Ag)>>1;Af=Ar.substring(0,Ap)+t;An=W(Af,As,K);Ai=An-Ao+K;if(Ai>Aq){Ag=Ap;}else{Aj=Ap;}}Ah.innerHTML=X.encodeHtmlString(Ar.substring(0,Aj)+t,true);Ah[x]("title",Ar);Ak=true;An=W(Ah.innerHTML,As,K);Ai=An-Ao+K;}AI(Ah,0,Am+G,(Ai<Aq)?Ai:Aq);}if(Ao>Aq){Ah[x]("title",Ar);}else{if(!Ak){Ah[x]("title","");}}}function w(Af,Ao,Ak,Ag,An,Ap){var Ah,Aj,Al,Am,Ai=document.createElement("div");Ai[x]("class","gm-legend-textcell");Ai[x]("type",C.LGD_TEXT);Ai.style.lineHeight=d+u;if(An){Am=AF(Ai,Ao,Ap,An);}if(Ag&s){Ah=(AG+AQ)/2+Ak*AG;Al=v;}else{Ah=(q+AQ)/2+Ak*q;if(Ag&Ae){if(Ag&Ac){Al=0;}else{Al=p;}}else{if(Ag&f){Al=P;}else{Al=0;}}}Aj=Am||p+K;Ai.innerHTML=Ao;Ai.identity={objType:AD.LEGEND_TEXT};AE(Af,Al,Ah,Aj);this.textDivs.push(Ai);Af.appendChild(Ai);}function AX(Af,Ai){var Ag,Ak,Aj,Ah=0;if(Af){Aj=Af.elements;for(Ag=0,Ak=Aj.length;Ag<Ak;Ag++){Ah=Math.max(Ah,W(Aj[Ag].label,Ai,K));}Ah+=v+A*2+AS;}return Ah;}function U(Ai,Ah){var Al,Af,Ak,Aj=Ai.items,Ag=0;if(!Aj){return 0;}Al=Aj.length;Ak=Ai.custMetrics;for(Af=0;Af<Al;Af++){if(Ak&&Ak.indexOf(Aj[Af])!==-1){Ag=Math.max(Ag,W(Aj[Af],Ah,K)+P);}else{Ag=Math.max(Ag,W(Aj[Af],Ah,K));}}return Ag;}function AM(Ai,Ah){var Af,Ak,Aj,Ag=0;if(Ai){Aj=Ai.elements;Ak=Aj.length;if(Ai.caseFlag===1){Ag=U(Ai,Ah);}else{if(Ai.caseFlag===0){for(Af=0;Af<Ak;Af++){Ag=Math.max(Ag,W("Max: "+Aj[Af].v,Ah,K));}Ag+=q*j;Ag=Math.max(Ag,U(Ai,Ah));}else{if(Ai.caseFlag===2){for(Af=0;Af<Ak;Af++){Ag=Math.max(Ag,W(Aj[Af].v,Ah,K));}Ag+=q*Ak+p;Ag=Math.max(Ag,U(Ai,Ah));}else{if(Ai.caseFlag===3){for(Af=0;Af<Ak;Af++){Ag=Math.max(Ag,W(Aj[Af].v,Ah,K));}Ag+=q*r;}}}}Ag=Math.max(Ag,W(I,Ah,K));Ag+=A*3;}return Ag;}function c(Aq,Ai,Au){if(!Aq||!Aq.length||Aq.length<1){return 0;}var Aj,Ag,At,Af,Am,Ap,Al,Ao,An,Ah,Ak,As=k+2*Ab,Ar=As;for(Aj=0;Aj<Aq.length;Aj++){Al=Aq[Aj];if(Al.dataType===AV.COLOR_BY){Ao=Al.dataObj;if(Ao){Ah=2*AC+G;At=Z.removeExtraSpace(Ao.item);Ap=W(At,Au,K);if((Ap+2*A>Ai-2*Ab)&&H(At)){Ah+=G;}Af=Ao.elements;Ag=Af.length;Ah+=A;Ah+=g;As+=Ah+AG*Ag;Ar+=Ah+(Ag>0?AG:0);}}else{if(Al.dataType===AV.SIZE_BY){An=Al.dataObj;if(An){Ak=2*AC+G;At=Z.removeExtraSpace(An.item);Ap=W(At,Au,K);if((Ap+2*A>Ai-2*Ab)&&H(At)){Ak+=G;}Am=An.caseFlag;if(Am===1){Ag=0;}else{if(Am===0){Ag=2;}else{if(An.caseFlag===2||Am===3){Ag=An.elements.length;}}}Ag+=(An.items&&An.items.length)||0;Ak+=q*Ag;Ak+=A;Ak+=g;As+=Ak;Ar+=Ak;}}}}return{height:As,minHeight:Ar};}function AY(Af,Ag){var Ai=0,Ah=0;O.forEach(Af||[],function(Aj){var Ak;if(Aj.dataType===AV.COLOR_BY){Ak=AX(Aj.dataObj,Ag);if(Ak>Ai){Ai=Ak;}}else{if(Aj.dataType===AV.SIZE_BY){Ak=AM(Aj.dataObj,Ag);if(Ak>Ah){Ah=Ak;}}}});return Math.max(Ai,Ah)+2*Ab;}function h(Ag,Am,Ak,Aj){var Ah=c(Ag,Am,Aj),Af=Ah.height,Al=Ak-V*2,Ai={};Ai.autoCollapse=Ah.minHeight>Al;Ai.minHeight=Ah.minHeight;Ai.width=Am;Ai.height=Math.min(Af,Al);if(Af>Al){Ai.cutBy=Af-Al;}return Ai;}function F(Ag,Ah){var Ai=Ag.decodedColor||Ag.color,Af;if(Ai.c1){Af=AZ.buildGradient(Ai.or,Ai.c1,Ai.c2);Ah.style[AZ.convertCssToCamelCase(Af.n)]=Af.v;}else{Ah.style.backgroundColor=Ai;}if(Ag.image){Ah.style.backgroundImage=Ag.image;}Ah.identity=new e({objType:AD.COLOR_SQUARE,parentIdentity:this.identity,token:Ag.token,decodedColor:Ag.decodedColor,encodedColor:Ag.encodedColor,isDefaultColor:Ag.isDefaultColor});}function AR(){var Au,Ar,Ap,Af,Aq,Aw,Ag,An,Al,Ai,Ay=document,Ax=this.triBtn,At=this.closeBtn,Ak=this.cbContainer,Ah=this.sb1Container,As=this.sb2Container,Am=this.cbTableContainer,Aj=null,Av=this.height-k-A-2*Ab,Ao=this.width-2*A-2*Ab;Ax[x]("class","gm-legend-tri-button-collapsed");if(this.autoCollapse){Ax[x]("title",mstrmojo.desc(13682,"There is not enough space to display the legend"));}else{Ax[x]("title",mstrmojo.desc(13683,"Maximize Legend"));}At.style.display="none";this.splitter.style.display="none";this.domNode.style.overflow="hidden";for(Au=0;this.dataArray&&Au<this.dataArray.length;Au++){Af=this.dataArray[Au];if(Af.dataType===AV.COLOR_BY){Aj=Af.dataObj;break;}}Ak.style.display=Aj?"block":"none";Ah.style.display="none";As.style.display="none";if(Aj){Ap=Aj.elements;Ar=Ap.length;Aq=this.cbTitle;Aq.style.display="none";Ak.style.top=k+u;Ak.style.width=Ao+u;Am.style.top="0px";Aw=this.cbTable;Aw.innerHTML="";for(Au=0;Au<Ar;Au++){Ag=Ay.createElement("tr");An=Ay.createElement("td");Ai=Ay.createElement("div");Al=Ay.createElement("div");Ai[x]("class","gm-legend-colorbox-ctn-div");Ai[x]("type",C.LGD_COLORBOX_CTN);Ai[x]("title",Ap[Au].label);Al[x]("class","gm-legend-colorbox-div");Al[x]("type",C.LGD_COLORBOX);F.call(this,Ap[Au],Al);Ag[x]("class","gm-legend-tr");Ag.style.height=AG+u;An[x]("class","gm-legend-colorbox");Ai.appendChild(Al);An.appendChild(Ai);Ag.appendChild(An);Aw.appendChild(Ag);if(Aw.offsetHeight+AG>Av){break;}}Aw.style.top="0px";Aw.style.marginLeft="0px";Am.style.top=A+u;Am.style.height=Aw.offsetHeight+u;}Ak.style.height=Av+u;}function n(Ah,Ag,Aj,Af){var Ai=document.createElementNS(N,"circle");Ai.setAttribute("cx",Ag);Ai.setAttribute("cy",Aj);Ai.setAttribute("r",Af);Ai.setAttribute("class","gm-legend-sizeby-circle");Ah.appendChild(Ai);}function AA(Ah,Ai,Al,Ag,Ak,Am,Aj){var Af=document.createElementNS(N,"line");Af.setAttribute("x1",Ai);Af.setAttribute("y1",Al);Af.setAttribute("x2",Ag);Af.setAttribute("y2",Ak);Af.style.strokeWidth=Am;if(Aj){Af.setAttribute("class",Aj);}Ah.appendChild(Af);}function AW(Ag,Au){var At,Ah,Aj,Ak,Ai,Af,As,Al,Av,Am,Aq=Math.PI,An=Au.elements,Ao=An.length,Ap=Ao*q,Ar=Ag.getContext("2d"),Aw={LINE_COLOR:"#b0b0b0",MIN_WIDTH:1,MAX_WIDTH:10},Ax=AL.getPropertyByPath(this,"widget.model.data.visName")||AL.getPropertyByPath(this,"widget.model.data.vis.vn");switch(Ax){case"GraphMatrixVisualizationStyle":if(this.shapeType===AB.SQUARE||this.shapeType===AB.TICK||this.shapeType===AB.LINE||this.shapeType===AB.BAR||this.shapeType===AB.AREA||this.shapeType===AB.RECTANGLE){Am="rectangle";}else{Am="circle";}break;case"VIHeatMapVisualizationStyle":Am="rectangle";break;default:Am="circle";break;}switch(Au.caseFlag){case 0:Ar.save();if(mstrApp.getThemeClassName().indexOf("dark")>=0){Ar.strokeStyle="rgba(116, 116, 117, 0.7)";Ar.fillStyle="rgba(116, 116, 117, 0.7)";}else{Ar.strokeStyle="rgba(188, 188, 189, 0.7)";Ar.fillStyle="rgba(188, 188, 189, 0.7)";}Ap=q*j;Av=Math.floor(q*0.75+0.5);Ah=Math.floor(Av/3.5+0.5);if(Am==="circle"){Ak=Av+1;Ai=q;Ar.beginPath();Ar.arc(Ak,Ai,Av,0,2*Aq,false);Ar.fill();Ar.stroke();Ak=2*Ak+2*Ah;Ai=Math.floor(0.53*q+0.5);Ar.beginPath();Ar.arc(Ak,Ai,Ah,0,2*Aq,false);Ar.fill();Ar.stroke();}else{Ak=1;Ai=q-Av;Ar.beginPath();Ar.fillRect(Ak,Ai,2*Av,2*Av);Ak=2*Av+2+Ah;Ai=Math.floor(0.53*q-Ah+0.5);Ar.beginPath();Ar.fillRect(Ak,Ai,2*Ah,2*Ah);}Ar.translate(0.5,0.5);Ar.lineWidth=1;Ar.strokeStyle="#9C9C9C";Ak=2*Av+3*Ah+3;Ai=Math.floor(0.53*q+0.5);Ar.beginPath();Ar.moveTo(Ak,Ai);Ar.lineTo(Ap,Ai);Ar.stroke();Ak=2*Av+2;Ai=Math.floor(1.53*q-Ah+0.5);Ar.beginPath();Ar.moveTo(Ak,Ai);Ar.lineTo(Ak+Ah,Ai+Ah);Ar.lineTo(Ap,Ai+Ah);Ar.stroke();Ar.restore();break;case 1:break;case 2:Aj=parseInt(An[0].diameter,10);Aj=Math.min(Aj,Ap);Ar.fillStyle="#ADADAC";Ar.strokeStyle="#ADADAC";if(Am==="circle"){Ak=Ap>>1;Ai=Ak;Ar.arc(Ak,Ai,Aj>>1,0,2*Aq,false);Ar.fill();Ar.stroke();}else{Ak=(Ap-Aj)>>1;Ai=Ak;Ar.rect(Ak,Ai,Aj,Aj);Ar.fill();Ar.stroke();}break;case 3:Af=Aw.MIN_WIDTH;As=(Ao===1?0:(Aw.MAX_WIDTH-Aw.MIN_WIDTH)/(Ao-1));Ap=Ag.width;Al=q;Ak=0;Ai=q/2;Ar.strokeStyle=Aw.LINE_COLOR;for(At=0;At<Ao;At++){Ar.lineWidth=Af;Ar.beginPath();Ar.moveTo(Ak,Ai);Ar.lineTo(Ap-Ak,Ai);Ar.stroke();Ai+=Al;Af+=As;}break;default:break;}}function AT(Ag,Ao){var Am=1,Af,Ak=1.5*G,An=Ag.innerHTML,Al=Z.restoreSpecialChars(An),Ah=Al.split(M),Ap,Ai;var Aj=function(Aq){Ai=Al[Aq];return Ai!==undefined?Ai:"";};if(Ag.scrollHeight>Ak){if(!Ah[0]){return 0;}Af=Ah[0]+Aj(Ah[0].length);while(Ah[Am]!==undefined){Ap=Af+Ah[Am];Ap+=Aj(Ap.length);Ag.innerHTML=Z.replaceSpecialChars(Ap);if(Ag.scrollHeight>Ak){break;}Af=Ap;Am++;}Ag.innerHTML=An;}else{Af=Al;}return W(Af,Ao,K);}function b(Av,At,Au,Ap){var As,Ah,Ak,Aj,Ao,Ar,An=At.elements,Aq=An.length,Am=[],Aw=document,Af=Aw.createDocumentFragment(),Ai=false,Al=this.styles,Ag=Au;switch(Ap){case 0:if(Aq>0){Am.push({v:"Min: "+An[Aq-1].v});Am.push({v:"Max: "+An[0].v});Aq=2;}break;case 1:An=At.items;O.forEach(An,function(Ax){Am.push({v:Ax});});break;case 3:Am=An;break;default:Am=An;Ai=true;break;}Aq=Am.length;for(As=0;As<Aq;As++){Ah=Aw.createElement("tr");Ah[x]("class","gm-legend-tr2");Ah.style.height=q+u;if(Ai){Ak=Aw.createElement("td");w.call(this,Ak,Am[As].sign,As,Q|Ae|Ac);Ak[x]("class","gm-legend-sign");Ah.appendChild(Ak);Ag-=p;}Aj=Aw.createElement("td");Aj[x]("class","gm-legend-desc");if(At.custMetrics&&At.custMetrics.indexOf(Am[As].v)!==-1){w.call(this,Aj,Am[As].v,As,Q|f,Ag-P,Al);Ar=parseInt(Aj.lastChild.style.width,10);Ao=Aw.createElement("div");Ao.setAttribute("class",AO);Ao.setAttribute("title",AK);Aj.appendChild(Ao);Ao.style.top=(q-8)/2+As*q+u;Aj.lastChild.style.marginLeft=Ar+u;}else{if(Ai){w.call(this,Aj,Am[As].v,As,Q|Ae,Ag,Al);}else{w.call(this,Aj,Am[As].v,As,Q,Ag,Al);}}Ah.appendChild(Aj);Af.appendChild(Ah);}Av.appendChild(Af);}function T(){var Ah="."+AO,Af=this.domLegend.querySelectorAll(Ah),Ag;O.forEach(Af,function(Ai){Ag=Ai.parentNode;if(Ag){Ag.removeChild(Ai);}});}function S(){var A8,A0,BD=0,BE,Av,A2,Aw,Ai,A6,A9,Am,BC,A7,Af=this.width-2*Ab,Aq=Af-2*A,Ak=document,Ah=this.triBtn,A1=this.closeBtn,Az=this.cbContainer,Ar=this.cbTableContainer,BF=this.sb1Container,Al=this.sb2Container,Ap,An,Aj,Ao,A4,At,A3=this.cutBy,Ay=k,BA=0,Ax=this.styles,A5,BB,Au=(G+AQ)/2,Ag,As;Ah[x]("class","gm-legend-tri-button");Ah[x]("title",mstrmojo.desc(13684,"Minimize Legend"));A1.style.display="block";A1[x]("title",mstrmojo.desc(12002,"Hide Legend"));this.updateSplitter();T.call(this);this.domNode.style.overflow="visible";Az.style.display="none";BF.style.display="none";Al.style.display="none";for(A0=0;this.dataArray&&A0<this.dataArray.length;A0++){An=this.dataArray[A0];A4=null;At=null;if(An.dataType===AV.COLOR_BY){A4=An.dataObj;if(A4){Az.style.display="block";Aw=Z.removeExtraSpace(A4.item);Ai=A4.elements;A8=Ai.length;Az.style.top=Ay+u;Az.style.width=Aq+u;BC=0;if(BA===0){AZ.addClass(this.sepLine1,"toggleHide");BA++;}BE=this.cbTitle;BE.style.display="block";AF(BE,Aw,Ax,Aq);BE.innerHTML=X.encodeHtmlString(Aw,true);BC+=BE.offsetHeight+2*AC;Ag=AT(BE,Ax);l(BE,Ax,Ag,Au,Aq);AE(BE,0,Au,(Ag<Aq)?Ag:Aq);Av=this.cbTable;Av.style.display="block";Av.style.width=(Aq-AS)+u;Av.style.marginLeft=AS+u;Av.innerHTML="";Av.appendChild(this.fillColorByTable(A4,0));A6=AG*A8+1;Ar.style.top=BC+u;Av.style.display="table";BC+=A6+A;if(A3){BC-=A3;A6-=A3;}Az.style.height=BC+u;Ar.style.height=A6+u;Ay+=BC+g;}}else{if(An.dataType===AV.SIZE_BY){At=An.dataObj;if(At){BD++;if(BD===1){Aj=BF;Ao=this.sb1Title;A2=this.sb1MetricNamesTable;Av=this.sb1DataTable;Ap=this.sb1Canvas;}else{Aj=Al;Ao=this.sb2Title;A2=this.sb2MetricNamesTable;Av=this.sb2DataTable;Ap=this.sb2Canvas;}Aj.style.display="block";Aw=Z.removeExtraSpace(At.item);Ai=At.elements;A8=Ai.length;Aj.style.top=Ay+u;Aj.style.width=Aq+u;BC=0;if(BA===0){AZ.addClass(this.sepLine2,"toggleHide");BA++;}if(At.caseFlag===0){A9=j*q;Am=2*q;}else{if(At.caseFlag===3){A9=r*q;Am=A8*q;}else{A9=A8*q;Am=A9;}}BE=Ao;BE.innerHTML=X.encodeHtmlString(Aw,true);BB=At.custMetrics&&At.custMetrics.indexOf(Aw)!==-1;if(BB){As=Aq-P;}else{As=Aq;}AF(BE,Aw,Ax,As);if(BB){A5=Ak.createElement("div");A5.setAttribute("class",AO);A5.setAttribute("title",AK);Aj.appendChild(A5);A5.style.top=(BE.offsetHeight-8)/2+AC+g+u;A5.style.left=BE.offsetWidth+"px";}Ag=AT(BE,Ax);l(BE,Ax,Ag,Au,As);AE(BE,0,Au,(Ag<As)?Ag:As);BC+=BE.offsetHeight+2*AC;A7=Aq;A2.innerHTML="";if(At.items&&At.items.length>0){A2.style.display="block";b.call(this,A2,At,A7,1);}else{A2.style.display="none";}A2.style.top=BC+u;A2.style.left="0"+u;A2.style.width=A7+u;BC+=A2.offsetHeight;if(A9>0){A7-=A9+A;}Av.innerHTML="";if(At.elements&&At.elements.length>0){Av.style.display="block";b.call(this,Av,At,A7,At.caseFlag);}else{Av.style.display="none";}Ap.style.position="absolute";Ap.style.top=BC+u;Ap.style.marginLeft=A+u;Av.style.top=BC+u;Av.style.left=(A9+A)+u;Av.style.width=A7+u;BC+=Av.offsetHeight+A;Aj.style.height=BC+u;Av.style.display="table";Ap.width=A9;Ap.height=Am;AW.call(this,Ap,At);Ay+=BC+g;}}}}}function o(){var Af,Ag=this.textDivs,Ah=Ag.length;for(Af=0;Af<Ah;Af++){a(Ag[Af]);}}mstrmojo.gm.GMLegend=mstrmojo.declare(mstrmojo.VisLegend,[mstrmojo._FormateVisLegend,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.gm.GMLegend",cssClass:"gm-legend",dropZoneHighlightCss:"gm-legend-slot",dockedPositions:[{pos:m.LEFT_TOP},{pos:m.LEFT_MIDDLE},{pos:m.LEFT_BOTTOM},{pos:m.RIGHT_TOP},{pos:m.RIGHT_MIDDLE},{pos:m.RIGHT_BOTTOM}],dockPos:AJ.LEFT,GMW:0,GMH:0,isMinimal:false,shapeType:undefined,legendMarkup:'<div class="gm-legend-tri-button"></div><div class="gm-legend-close-button"></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><div class="gm-legend-table-container"><table class="gm-legend-table"></table></div></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><table class="gm-legend-table"></table><table class="gm-legend-table"></table><canvas type="lgd-canvas"></canvas></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><table class="gm-legend-table"></table><table class="gm-legend-table"></table><canvas type="lgd-canvas"></canvas></div><div class="gm-legend-resizer-v" draggable="false"></div><div class="gm-legend-resizeRect"></div>',init:function z(Ag){this.styles={};this.cutBy=null;this.dataArray=null;this.textDivs=[];var Ah=Ag.placeholder,Af=Ah.style;if(Ah){this.cssClass=Ah.getAttribute("class");if(!this.cssClass){this.cssClass="";}if(Ag.hasOwnProperty("width")===false){Ag.width=(Af&&Af.width)||Ah.clientWidth;}if(Ag.hasOwnProperty("height")===false){Ag.height=(Af&&Af.height)||Ah.clientHeight;}if(Ag.hasOwnProperty("left")===false){Ag.left=Ah.offsetLeft;}if(Ag.hasOwnProperty("top")===false){Ag.top=Ah.offsetTop;}}this._super(Ag);},setupScrollNodes:function L(){this.scrollNode=this.cbTableContainer;},getSplitterDockPos:function(){return(this.currDockedPositionIdx<3)?AJ.RIGHT:AJ.LEFT;},updateAlignClass:function(){var Aj=this.getDockedPosition(),Ak=Aj&&Aj.pos,Ah=(Ak===m.RIGHT_MIDDLE||Ak===m.RIGHT_TOP||Ak===m.RIGHT_BOTTOM||Ak===m.RIGHT),Af=this.domLegend,Ag=this.domNode,Ai=this.resizeRect;if(Ah){AZ.removeClass(Af,"gm-align-left");AZ.addClass(Af,"gm-align-right");AZ.toggleClass(Af,"gm-legend-alignRight",true);AZ.toggleClass(Af,"gm-legend-alignLeft",false);AZ.toggleClass(Ag,"gm-legend-alignRight",true);AZ.toggleClass(Ag,"gm-legend-alignLeft",false);AZ.toggleClass(Ai,"gm-legend-alignRight",true);AZ.toggleClass(Ai,"gm-legend-alignLeft",false);}else{AZ.removeClass(Af,"gm-align-right");AZ.addClass(Af,"gm-align-left");AZ.toggleClass(Af,"gm-legend-alignRight",false);AZ.toggleClass(Af,"gm-legend-alignLeft",true);AZ.toggleClass(Ag,"gm-legend-alignRight",false);AZ.toggleClass(Ag,"gm-legend-alignLeft",true);AZ.toggleClass(Ai,"gm-legend-alignRight",false);AZ.toggleClass(Ai,"gm-legend-alignLeft",true);}},postBuildRendering:function(){this._super();var Ar=this.styles,At=this.domNode,Ai=this.domLegend.childNodes,Am=Ai[2],Ak=Ai[3],As=Ai[4],Aw={objType:AD.LEGEND};this.addSlots({triBtn:Ai[0],closeBtn:Ai[1],cbContainer:Ai[2],sepLine1:Am.firstChild,cbTitle:Am.childNodes[1],cbTableContainer:Am.childNodes[2],cbTable:Am.childNodes[2].firstChild,sb1Container:Ak,sepLine2:Ak.firstChild,sb1Title:Ak.childNodes[1],sb1MetricNamesTable:Ak.childNodes[2],sb1DataTable:Ak.childNodes[3],sb1Canvas:Ak.childNodes[4],sb2Container:As,sepLine3:As.firstChild,sb2Title:As.childNodes[1],sb2MetricNamesTable:Ak.childNodes[2],sb2DataTable:As.childNodes[3],sb2Canvas:As.childNodes[4],splitter:Ai[5],resizeRect:Ai[6]});Aa.GMLegend.applyHTML5Props(Ar);this.bgColor=Ar.background||Ar.backgroundColor||"transparent";AL.applyStyle2Legend(Ar,At,this.domLegend);var Al=this.getSplitterDockPos(),Av=this.width-2*A-2*Ab,An=this.cbTitle,Ag=An.style,Ah=this.sb1Title,Aj=this.sb2Title,Au=Ah.style,Af=Aj.style,Aq=this.sepLine1,Ap=this.sepLine2,Ao=this.sepLine3;Aq.style.width=Av+u;Ap.style.width=Av+u;Ao.style.width=Av+u;Ag.lineHeight=G+u;Au.lineHeight=G+u;Af.lineHeight=G+u;Ag.maxHeight=2*G+u;Au.maxHeight=2*G+u;Af.maxHeight=2*G+u;An.identity={objType:AD.LEGEND_TEXT,parentIdentity:Aw};Ah.identity={objType:AD.LEGEND_TEXT,parentIdentity:Aw};Aj.identity={objType:AD.LEGEND_TEXT,parentIdentity:Aw};this.dockPos=Al;this.identity=At.identity=Aw;this.updateAlignClass();},feedData:function(Af,Ag){this.dataArray=Af;this.isMinimal=Ag;this.textDivs=[];Aa.GMLegend.applyHTML5Props(this.styles);this.autoCollapseLegend();if(Ag||this.autoCollapse){AR.call(this);this.draggable=false;}else{S.call(this);this.draggable=true;}o.call(this);this.updateScrollbars();},autoCollapseLegend:function(){this.autoCollapse=this.minHeight&&(this.minHeight>(this.GMH-V*2));},updateColorBySquare:function(Ah){var Ai,Aj,Ag,Af;if(Ah){Af=this.domNode.querySelectorAll(".gm-legend-colorbox-div");Ai=Ah.elements;Aj=Math.min(Ai.length,Af.length);for(Ag=0;Ag<Aj;Ag++){F.call(this,Ai[Ag],Af[Ag]);}}},updateContainerSize:function(Af,Ag){this.GMW=Af;this.GMH=Ag;this.calculateDockedPositions(Af,Ag);},updateAfterResize:function(){Aa.GMLegend.applyHTML5Props(this.styles);var Ak=0,Aj=this.width,Al=this.cbContainer,An=this.sb1Container,Ah=this.sb2Container,Ai=this.sepLine1,Ag=this.sepLine2,Af=this.sepLine3,Am=Aj-2*A-2*Ab;O.forEach(this.dataArray||[],function(Ao){if(Ao.dataType===AV.COLOR_BY){if(Ao.dataObj){if(Al){Al.style.width=Am+u;}}}else{if(Ao.dataType===AV.SIZE_BY){if(Ao.dataObj){Ak++;if(Ak===1&&An){An.style.width=Am+u;}if(Ak===2&&Ah){Ah.style.width=Am+u;}}}}});if(Ai){Ai.style.width=Am+u;}if(Ag){Ag.style.width=Am+u;}if(Af){Af.style.width=Am+u;}this.domLegend.style.width=this.width+u;this.domLegend.style.height=this.height+u;},updateStyle:function(Af){this.styles=Af;this.bgColor=Af.background||Af.backgroundColor||"transparent";AL.applyStyle2Legend(Af,this.domNode,this.domLegend);},updateTitleLineHeight:function(){var Ag=this.cbTitle,Aj=Ag.style,Ah=this.sb1Title,Af=this.sb2Title,Ak=Ah.style,Ai=Af.style;Aa.GMLegend.applyHTML5Props(this.styles);Aj.lineHeight=G+u;Ak.lineHeight=G+u;Ai.lineHeight=G+u;Aj.maxHeight=2*G+u;Ak.maxHeight=2*G+u;Ai.maxHeight=2*G+u;},getSplitterPosition:function(Ah){var Ag=Ah.src.startPos+Ah.tgt.pos.x-Ah.src.pos.x,Aj=Ah.src.posInfo,Ai=Aj&&Aj.min,Af=Aj&&Aj.max;if(Ai!==undefined){Ag=Math.max(Ag,Ai);}if(Af!==undefined){Ag=Math.min(Ag,Af);}return Ag;},positionResizeRect:function(Af,Ag){var Ai=Af.src.posInfo.dockPosition===AJ.LEFT,Aj=Ag-AN,Ak=Ai?Aj:0,Ah=Ai?this.width-Aj:Aj;this.resizeRect.style.left=(Ak-1)+u;this.resizeRect.style.width=(Ah-2)+u;},updateLegendSlot:function(Ai,Af){var Ah=this.getDockedPosition(),Ag=Ah&&Ah.pos;if(Ag!==Ai){this.currDockedPositionIdx=Af;this.dockPos=this.getSplitterDockPos();this.updateDropZonePosition();this.updateAlignClass();this.updateSplitter();this.widget.onLegendDropZoneChange(this.getDockedPosition());}},ondragstart:function(Af){var Ah=Af.src.e.target,Ag=Af.src.data;if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(false);}if(Ah===this.splitter){Af.src.startPos=Ah.offsetLeft;Af.src.posInfo=this.getSplitterInfo(Ah);this.positionResizeRect(Af,Af.src.startPos);AZ.addClass(this.resizeRect,"resizing");}else{this.cbTableScrollTop=this.cbTableContainer.scrollTop;this._super(Af);if(!Ag||!Ag.isScrollBar){this.clearSelectedTargets();AZ.toggleClass(this.domNode,"gm-legend-hover",false);AZ.toggleClass(this.domLegend,"active",false);this.cbTableContainer.scrollTop=this.cbTableScrollTop;this.domLegend.style.background=this.bgColor;this.isDragging=true;}}},ondragmove:function D(Af){var Ah=Af.src.e.target,Ag;if(Ah===this.splitter){Ag=this.getSplitterPosition(Af);Ah.style.left=Ag+u;this.positionResizeRect(Af,Ag);}else{this._super(Af);}},ondragend:function(Af){var Ah=Af.src.e.target;if(Ah===this.splitter){AZ.removeClass(this.resizeRect,"resizing");this.splitterMoved(this.getSplitterPosition(Af)-Af.src.startPos,Af.src.posInfo);}else{this._super(Af);var Ag=Af.src.data;if(!Ag||!Ag.isScrollBar){this.cbTableContainer.scrollTop=this.cbTableScrollTop;this.domLegend.style.background="transparent";this.isDragging=false;}delete this.cbTableScrollTop;}if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(true);}},onscroll:function(){var Ag,Ak,Aj=this.scrollNode.scrollTop,Ai,Ah,Af;if(this.prevScrpllTop===Aj){return ;}Ak=(this.dataArray&&this.dataArray.length)||0;for(Ag=0;Ag<Ak;Ag++){Ah=this.dataArray[Ag];if(Ah.dataType===AV.COLOR_BY){Af=Ah.dataObj;break;}}if(Af){Ai=this.cbTable;Ai.innerHTML="";Ai.appendChild(this.fillColorByTable(Af,Math.floor(Aj/AG)));this.prevScrpllTop=Aj;this.scrollNode.scrollTop=Aj;this._super();}},fillColorByTable:function(Av,Al){var Aw,At,Ah,Ak,Aj,Am,An,Ao=this.styles,Af,Ar=this.cutBy,Ap=this.width-2*Ab-2*A,Aq,Ai,Ag,Ax,As;Aq=Av.elements;At=Aq.length;Af=document.createDocumentFragment();Ai=Ap-v-AS;Ag=0;Ax=AG*At;As=Al*AG;function Au(Ay){Ah=document.createElement("tr");Ak=document.createElement("td");Ah.style.height=Ay+u;Ak[x]("class","gm-legend-colorbox");Ah.appendChild(Ak);Af.appendChild(Ah);}if(Al>0){Au(As);}for(Aw=Al;Aw<At;Aw++){Ah=document.createElement("tr");Ak=document.createElement("td");Aj=document.createElement("td");Am=document.createElement("div");An=document.createElement("div");Am[x]("class","gm-legend-colorbox-ctn-div");Am[x]("type",C.LGD_COLORBOX_CTN);An[x]("class","gm-legend-colorbox-div");An[x]("type",C.LGD_COLORBOX);F.call(this,Aq[Aw],An);Ah[x]("class","gm-legend-tr");Ah.style.height=AG+u;Ak[x]("class","gm-legend-colorbox");Aj[x]("class","gm-legend-desc");w.call(this,Aj,Aq[Aw].label,Aw,s,Ai,Ao);Am.appendChild(An);Ak.appendChild(Am);Ah.appendChild(Ak);Ah.appendChild(Aj);Af.appendChild(Ah);Ag+=AG;if(Ar&&(Ar+Ag-AG)>Ax){Au(Ax-Ag-As);break;}}return Af;},calculateDockedPositions:function(Ag,Aj){var Ai,Al=this.getWidth(),Af=this.getHeight(),Ah=this.dockedPositions,Ak=function(Am){switch(Am.pos){case i.LEFT_TOP:Am.x=0;Am.y=V;break;case i.LEFT_MIDDLE:Am.x=0;Am.y=Math.max(V,(Aj-Af)>>1);break;case i.LEFT_BOTTOM:Am.x=0;Am.y=Math.max(0,Aj-Af-V);break;case i.RIGHT_TOP:Am.x=Ag-Al;Am.y=V;break;case i.RIGHT_MIDDLE:Am.x=Ag-Al;Am.y=Math.max(V,(Aj-Af)>>1);break;case i.RIGHT_BOTTOM:Am.x=Ag-Al;Am.y=Math.max(0,Aj-Af-V);break;}};for(Ai=0;Ai<Ah.length;Ai++){Ak(Ah[Ai]);}this.updateDropZonePosition();},updateDropZonePosition:function(){var Af=this.getDockedPosition(),Ag=this.dropZoneNode.style;Ag.left=Af.x+u;Ag.top=Af.y+u;},updateDropZoneNode:function(Af){this._super(Af);this.dockPos=this.getSplitterDockPos();this.updateSplitter();},onmouseover:function(Af){var Ah=this.domLegend,Al=Af.getTarget(),Ai=Al.getAttribute("type"),Ak=this.widget,Ag;if(this.isDragging){return ;}var Aj=R.copy(this.styles);Aj.opacity+=0.4;AL.applyStyles2DomNode(this.domNode,Aj);if(y.contains(Ah,Al,true)){AZ.addClass(Ah,"active");}if(Ai===C.LGD_COLORBOX){Al=Al.parentNode;Ai=Al.getAttribute("type");}if(Ai===C.LGD_COLORBOX_CTN){Ag=Al.firstChild.identity;if(!Ag||!Ag.comb){return ;}AZ.toggleClass(Al,"hover-colorsquare",true);return ;}if(Ak.formattingMode){switch(Ai){case C.LGD_TITLE:case C.LGD_TEXT:AZ.toggleClass(Ah,"hover-txt",true);break;default:AZ.toggleClass(this.domNode,"gm-legend-hover",true);break;}}},onmouseout:function(Ag){var Ai=this.domLegend,Af=Ag.e.toElement||Ag.e.relatedTarget,Al=Ag.getTarget(),Aj=Al.getAttribute("type"),Ak=this.widget,Ah;AL.applyStyles2DomNode(this.domNode,this.styles);if(!y.contains(Ai,Af,true)){AZ.removeClass(Ai,"active");}if(Aj===C.LGD_COLORBOX){Al=Al.parentNode;Aj=Al.getAttribute("type");}if(Aj===C.LGD_COLORBOX_CTN){Ah=Al.firstChild.identity;if(!Ah||!Ah.comb){return ;}AZ.toggleClass(Al,"hover-colorsquare",false);return ;}if(Ak.formattingMode||Ak.isOnFormattingMode){switch(Aj){case C.LGD_COLORBOX_CTN:case C.LGD_COLORBOX:break;case C.LGD_TITLE:case C.LGD_TEXT:AZ.toggleClass(Ai,"hover-txt",false);break;default:AZ.toggleClass(this.domNode,"gm-legend-hover",false);break;}}},onclick:function(Af){var Ai=Af.getTarget(),Ag=Ai.getAttribute("type"),Ah=this.widget;if(Ai===this.triBtn){if(!this.autoCollapse){this.raiseEvent({name:"gm-legend-clicked",action:(this.isMinimal?"restore":"minimize")});}}else{if(Ai===this.closeBtn){this.raiseEvent({name:"gm-legend-clicked",action:"close"});}else{if(Ag===C.LGD_COLORBOX){Ai=Ai.parentNode;Ag=Ai.getAttribute("type");}if(Ah.formattingMode||Ah.isOnFormattingMode){if(Ag===C.LGD_COLORBOX_CTN){this.selectColorBox(Ai,true);}else{if(Ag===C.LGD_TEXT||Ag===C.LGD_TITLE){this.selectText();}else{this.selectLegendBody();}}}else{this.clearSelectedColorBox();}}}y.stopPropogation(null,Af.e);},attachClearEvent:function(){if(this.clearSelectTargetfn){return ;}var Ag=this,Af=this.domLegend;this.clearSelectTargetfn=function(Ak){var Aj=Ak.target,Ah=Ag.widget.toolEditor,Ai;if(!y.contains(Af,Aj,true,Af)){if(Ah){Ai=Ah.domNode;if(!y.contains(Ai,Aj,true,Ai)){Ag.clearSelectedTargets();}}else{Ag.clearSelectedTargets();}}};y.attachEvent(document.body,"mousedown",this.clearSelectTargetfn,true);},clearSelectedColorBox:function(){var Af=this.selectedColorBox;if(Af){AZ.toggleClass(Af,"select",false);AZ.toggleClass(Af,"selectfmt",false);this.selectedColorBox=undefined;}},clearSelectedText:function(){AZ.removeClass(this.domNode,"select-txt");},clearSelectedLegendBody:function(){AZ.removeClass(this.domNode,"gm-legend-select");},clearSelectedTargets:function(){this.clearSelectedColorBox();this.clearSelectedText();this.clearSelectedLegendBody();if(this.clearSelectTargetfn){y.detachEvent(document.body,"mousedown",this.clearSelectTargetfn,true);delete this.clearSelectTargetfn;}},selectColorBox:function(Ah,Ag){var Af=Ah.firstChild.identity;if(!Af||!Af.comb){return ;}this.clearSelectedText();this.clearSelectedLegendBody();if(this.selectedColorBox!==Ah){this.clearSelectedColorBox();this.selectedColorBox=Ah;if(Ag){AZ.toggleClass(Ah,"selectfmt",true);}else{AZ.toggleClass(Ah,"select",true);}this.attachClearEvent();}},selectText:function(){this.clearSelectedColorBox();this.clearSelectedLegendBody();AZ.addClass(this.domNode,"select-txt");this.attachClearEvent();},selectLegendBody:function(){this.clearSelectedColorBox();this.clearSelectedText();AZ.addClass(this.domNode,"gm-legend-select");this.attachClearEvent();},adjustColorPickerPos:function(Af){var Ai=y.position(Af),Ag=0,Ah={};if(this.currDockedPositionIdx<3){Ah.x=Ai.x+Ai.w+Ag;Ah.alignLeft=true;}else{Ah.x=Ai.x-Ag;Ah.alignLeft=false;}Ah.y=Ai.y+Ai.h+Ag;return Ah;},getSplitterInfo:function(Ak){if(!Ak){return{};}var Ag=this.dockPos,Aj={},Ai=this.width,Af=AH,Ah=Math.floor(this.GMW/3);Aj.dockPosition=Ag;if(Ag===AJ.LEFT){Aj.min=Math.min(Ai-Ah,0);Aj.max=Math.max(Ai-Af,0);}else{if(Ag===AJ.RIGHT){Aj.min=Af;Aj.max=Ah;}}Aj.min+=AN;Aj.max+=AN;return Aj;},splitterMoved:function(Af,Ag){if(Af===0){return ;}if(Ag.dockPosition===AJ.LEFT){Af=-Af;}this.raiseEvent({name:"gm-legend-resized",position:Af});this.updateSplitter();if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(true);}},updateSplitter:function(){AP(this.splitter,this.dockPos,this.width,this.height);this.resizeRect.style.height=this.height-2+u;}});Aa.GMLegend.applyHTML5Props=function(Ah){var Ai=parseInt(Ah.fontSize,10)||8,Ag;if(Ah.fontSize.indexOf("px")>=0){Ai=Math.floor(Ai*Y+0.5);}Ag=Math.floor(Ai/Y*E+0.5);G=Math.max(Ai,8)+9;AQ=Math.floor(Ai/Y+0.5);d=Math.max(Ag,15);AG=Math.max(Ag,20)+2;q=Math.max(Ag,14)+2;Ab=parseInt(Ah.borderWidth,10)||1;var Af=parseInt(Ah.tbHeight,10);k=isNaN(Af)?J:Af;};Aa.GMLegend.getLegendSize4MinMode=function(Ag,Ah){var Aj,Ai,Af=k+2*Ab;if(Ag){Ai=Ag.elements;Aj=Ai.length;Af+=AG*Aj;Af+=2*A;}Af=Math.min(Af,Ah-V*2);return{width:v+5+7+2*Ab,height:Af};};Aa.GMLegend.getLegendSize=function(At,Ai,Af,Al,Av,Am){var An,Ag,Au,Ak,Aj=Al-V*2,Ar=0,Ah=0,Aq={},Ap,Ao,As;if(!At||!At.length||At.length<1){return{};}if(Ai!==undefined){if(!Am){Am=Math.floor(AY(At,Av)*Ai);}Ak=Math.min(Am,Math.floor(Af/3));Ak=Math.max(Ak,50);return h(At,Ak,Al,Av);}Ak=Math.min(Math.floor(0.2*Af),300);for(An=0;An<At.length;An++){Ao=At[An];if(Ao.dataType===AV.COLOR_BY){Ap=AX(Ao.dataObj,Av);if(Ap>Ar){Ar=Ap;}}else{if(Ao.dataType===AV.SIZE_BY){Ap=AM(Ao.dataObj,Av);if(Ap>Ah){Ah=Ap;}}}}Ag=Math.max(Ar,Ah)+2*Ab;Aq.width=Math.min(Ag,Ak);Aq.scale=Aq.width/Ag;As=c(At,Aq.width,Av);Au=As.height;Aq.autoCollapse=As.minHeight>Aj;Aq.minHeight=As.minHeight;Aq.height=Math.min(Au,Aj);if(Au>Aj){Aq.cutBy=Au-Aj;}return Aq;};}());(function(){mstrmojo.requiresCls("mstrmojo.VisBase","mstrmojo.dom","mstrmojo.array","mstrmojo.num","mstrmojo.hash","mstrmojo.color","mstrmojo.css","mstrmojo.VisEnum","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.VisUtility","mstrmojo.util.ui._LassoSelector","mstrmojo.ui.menus._HasMenuPopup","mstrmojo._colorPalette","mstrmojo._VizSelectionHelper","mstrmojo.VisTooltip","mstrmojo.vi._MonitorsAppState","mstrmojo.heatmap.vi._HasHeatmapContextMenu","mstrmojo.netviz.ObservableModel","mstrmojo.chart.model.enums.EnumDSSDefaultFormats","mstrmojo.util.color","mstrmojo.vi.ui._IsDropTarget","mstrmojo.gm._SupportDndAsBlackBox","mstrmojo.ui.PopupConfig","mstrmojo.netviz.PropertyParser","mstrmojo.vi.viz.EnumDSSDropZones");mstrmojo.requiresClsP("mstrmojo.gm","GMLegend","EnumLegendSlot","GMUtility");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_HasVisSelections","selectors._IsMultiUnitControl","selectors._BrushesAndHighlights","_XtabDE");mstrmojo.requiresClsP("mstrmojo.heatmap.vi","_SupportHeatmapBrushesAndHighlights","VisHeatMapColorTheme","VisHeatMapCanvas","VisHeatMapHighlightCanvas");var p=mstrmojo,BM=p.css,BR=p.array,AU=p.VisUtility,BP=p.gm,V=BP.GMLegend,AF=BP.EnumLegendSlot,Ay=BP.GMUtility,A7=p.VisEnum.GMLegendDataType,H=p.chart.enums.EnumFontStyle,A5=p.VisEnum,BD=A5.GMLegendFormatingPropertyTag,A0=A5.LegendPropertyTag,Av=A5.EnumLegendMode,t=A5.FormNameDisplayType,AL=A5.EnumColorRankMode,a=mstrmojo.hash,AY=p.dom,Ah=p.util.color,K=p.color,F=mstrmojo.VisEnum.HEATMAP_PROPERTIES,A=mstrmojo.vi.viz.EnumDSSDropZones;var BZ=A5.SERVER_JSON_ERROR_TYPE;var Ao=["at","dei","dpt","o","tui","ui"],Am=Ao.length;var k=["mousedown","mouseup","mousemove","mouseout","click","contextmenu"];var s=5;var A2={lgdBgFillClr:[15461355,1710618],lgdBgFillStyle:[0,0],lgdBgFillEff:[1,1],lgdBgFillTrans:[0,100],lgdFntSz:["8pt","8pt"],lgdFntFml:["Arial","Arial"],lgdFntStyle:[0,0],lgdFntClr:[6710886,16777215],lgdBdrShw:[false,false],lgdBdrClr:[11579568,5855577],lgdBdrThk:[1,1],lgdBdrStyle:[0,0],lm:[1,1],lwr:[undefined,undefined]},c;var AO=[{pos:AF.LEFT_TOP},{pos:AF.LEFT_MIDDLE},{pos:AF.LEFT_BOTTOM},{pos:AF.RIGHT_TOP},{pos:AF.RIGHT_MIDDLE},{pos:AF.RIGHT_BOTTOM}];var A8={VERTICAL:0,HORIZONTAL:1};var BQ="Absolute value of ";var AE="-";var AW=false;function BT(){var Bc=this.modelData,Bh=Bc.gsi.mx,Be=this.props.sizeMetricID,Bb=AU.findInArray(Bh,function(Bi){return Bi.did===Be;}),Bf=false,Bg={min:-Infinity,max:Infinity},Bd={min:Infinity,max:-Infinity};if(Bb===-1){return Bg;}this.dfs(this.root,function(Bj){if(Bj.entityChildren!==undefined){return ;}var Bl=Bj.aggValues||[],Bi=Bl[Bb],Bk=Bi.value;if(Bi.count===0||isNaN(Bk)){return ;}Bf=true;if(Bk<0){Bd.hasNegativeValue=true;Bk=Math.abs(Bk);}Bd.min=Math.min(Bd.min,Bk);Bd.max=Math.max(Bd.max,Bk);});return Bf?Bd:Bg;}function BH(Bc){if(!Bc||Bc.length!==3){return true;}var Bb=Bc[0];return Bc.slice(1).every(function(Bd){return a.equals(Bb,Bd);});}function BE(){var Bb=this;return{colorTheme:this.colorTheme,alias:"canvasObject",slot:"canvasSlot",root:this.root,width:this.heatMapSize.w,height:this.heatMapSize.h,attributes:this.levelAttributes,showMetric:this.props.showMetricValues,labelSetting:this.props.labelSize,isHeaderOnTop:this.props.isHeaderOnTop,fonts:this.props.fonts,bgColor:this.getSingleBackgroundColor(),isHeaderColorsModified:function(){return BH(Bb.props.headerColors);}};}function M(Bc,Bb){if(!Array.isArray(Bc)||!Array.isArray(Bb)){return false;}if(Bc===Bb){return true;}if(Bc.length!==Bb.length){return false;}return Bc.every(function(Bd){return Bb.indexOf(Bd)!==-1;});}function A6(Bc){Bc=Bc||[];var Bd={name:"selectionChange",type:[],selectedEntities:Bc},Bb;if(Al.call(this)){Bb=BU(Bc);if(Bb.length>0){Bd.type.push("shapeColor");Bd.colorbyElements=Bb;}this.edtModelCbInitSelection=Bb;}this.raiseEvent(Bd);}function BU(Bc){var Bb=Bc.filter(function(Bd){var Be=Bd.colorByAttributeIds,Bf=Bd.colorByElementIds;return Be&&Bf&&Be.length===Bf.length;}).map(function(Bd){var Be=Bd.colorByAttributeIds,Bf=Bd.colorByElementIds;return Be.map(function(Bh,Bg){return{tid:Bh,eid:Bf[Bg]};});});return AU.arrayUnique(Bb,function(Bd,Be){Bd=a.clone(Bd);Be=a.clone(Be);return Ay.isEqualComb(Bd,Be);});}function BC(Bh,Bd){var Bf=this.getPropsInfo().attrColorByOpacity||{},Bg,Bc,Bb,Be;Bh=Bh||[];Bd=Bd||[];Bg=Bh.join("|");Bc=Bd.join("|");Bb=Bf[Bg]||{};Be=Bb[Bc];if(Be===undefined){Be=100;}return Be;}function AP(Bd){var Bb,Bc=AO.length;for(Bb=0;Bb<Bc;Bb++){if(Bd===AO[Bb].pos){return Bb;}}return -1;}function Au(Bb){var Bc={};a.keyarray(A2).forEach(function(Bd){Bc[Bd]=A2[Bd][Bb];});return Bc;}var x=A5.HEATMAP_LABEL_SIZE;var r={Sum:0,Avg:1,Cnt:2,Max:3,Min:4,GeoAvg:5,AESum:6};var Aq={Squarified:0,PivotByMiddle:1,SliceAndDice:2};var Az={Padding:5,headerOnTopPadding:5,MaxLegendHeight:60,AttributeColorByLegendWidth:140,LegendMenuEditorWidth:0,LegendMinWidth:15,LegendTickLength:4,LegendMaxBandWidth:400,LegendWidthPercent:0.9,LegendMinPadding:15,LegendBottomPadding:3,LegendGutter:5,LegendBandAspect:10,MinShowLabelDimension:6,DeletedListHeight:500,EditorDialogWidth:565,EditorDialogHeight:574,EditButtonWidth:0,EditButtonHeight:0,EditButtonRight:0,HeaderPixels:19};function BN(Bb){return Bb&&Bb.value!==undefined&&Bb.opacity!==undefined;}var BG=[{value:"#efefef",opacity:1},{value:"#e4e4e4",opacity:1},{value:"#e4e4e4",opacity:0.7}];var BV=["headerOnMiddle","headerOnTop.header","headerOnTop.cell"];var v=(function(){var Bb={headerOnMiddle:{scale:1,family:"Arial","heatmap-one-level-1":"14pt","heatmap-multi-level-1":"24pt","heatmap-two-level-2":"14pt","heatmap-multi-level-2":"20pt","heatmap-multi-level-3":"10pt"},headerOnTop:{header:{scale:1,family:"Arial","heatmap-level-1-header-on-top":"12pt","heatmap-level-2-header-on-top":"11pt","heatmap-level-3-header-on-top":"11pt"},cell:{scale:1,family:"Arial","heatmap-level-1-header-on-top":"12pt","heatmap-level-2-header-on-top":"12pt","heatmap-level-3-header-on-top":"12pt"}}};var Bc=a.clone(Bb);BV.forEach(function(Be){var Bd=AU.getPropertyByPath(Bc,Be,{});Object.keys(Bd).filter(function(Bf){return AU.strStartsWith(Bf,"heatmap-");}).forEach(function(Bf){Bd[Bf]=AU.psPt2CssPt(Bd[Bf]);});});return Bc;}());var Z={headerOnTop:{header:{max:16/12,min:8/11},cell:{max:16/12,min:8/11}},headerOnMiddle:{max:36/24,min:8/10}};var m="--";var L=16119287;function O(Bc,Bb){BV.forEach(function(Bg){var Bk=AU.getPropertyByPath(Bc,Bg,{}),Bf=AU.getPropertyByPath(Z,Bg),Be=AU.getPropertyByPath(Bb,Bg,mstrmojo.emptyFn);var Bj,Bd,Bh,Bi;if(Bf){Bj=Bk.scale;Bd=Bf.max;Bh=Bf.min;Bi={valid:true,min:"gt",max:"lt"};if(Bj>=Bd){Bj=Bd;Bi.valid=false;Bi.max=Bj===Bd?"eq":"gt";}if(Bj<=Bh){Bj=Bh;Bi.valid=false;Bi.min=Bj===Bh?"eq":"lt";}Be(Bi,Bj);}});}function n(Bc,Bb){return Bc.reduce(function(Bh,Bg){var Bd=Bg.split("."),Be=Bd.length,Bf=Bh;Bd.forEach(function(Bj,Bi){if(Bi===Be-1){Bf[Bj]=Bb(Bg);}if(Bf[Bj]===undefined){Bf[Bj]={};}Bf=Bf[Bj];});return Bh;},{});}function f(Bd){var Bb=n(BV,function(){return false;}),Bc=n(BV,function(Be){return function(Bi,Bg){var Bf=Be.split("."),Bk=Bf.length-1,Bj=Bf[Bk],Bh=Bk===0?Bb:AU.getPropertyByPath(Bb,Bf.slice(0,Bk).join("."));if(Bh!==undefined){Bh[Bj]=Bi;}};});O(Bd,Bc);this.raiseEvent({name:"fontScaleChange",type:"*",limits:Bb});}function As(Bt,Bu){var Bv=this,Bk={act:"updateTemplate",keyContext:Bv.k,actions:[]},Bp=Bk.actions,Bn=Bv.zonesModel,Bj=[AU.pick(Bt,["did","t"])],Bb={id:A.Grouping},Bf=Bv.getSelections(),Bg=Bv.modelData.datasetId,Bo="00000000000000000000000000000000",Bm=0,Bd=3,Bs=Bu.headerDrill,Bl=Bu.keepParent;var Bh={datasetId:Bg,datasetType:Bg===Bo?Bm:Bd};var Bi=Array.prototype.push;if(Bs&&Bf.length>0){var Bc=null,Br=Bn.getZoneModelByZoneId(Bb.id),Bq=Bf[Bf.length-1][0].tid;Br.items.forEach(function(Bw){if(Bw.did===Bq){Bc=Bw;return false;}});if(Bl){Bi.apply(Bp,Bn.getAddDropZoneUnitsActions(Bb,Bj,Bc?Bc.idx+1:0));}else{if(Bc){Bp.push(Bn.getRemoveDropZoneUnitAction(Bb,Bc));Bi.apply(Bp,Bn.getAddDropZoneUnitsActions(Bb,Bj,Bc.idx));}}}else{var Be=Bn.getItemCountInZone(Bb.id);Bi.apply(Bp,Bn.getAddDropZoneUnitsActions(Bb,Bj,Be,Bh));}return Bk;}function AD(Be,Bf,Bg){var Bd=Bg.needsCopy,Bc=Bg.invalidReplacement;if(Bd&&Be.total===undefined){Be.avgTotal=Be.total=Be.geomProduct=Be.max=Be.min=Be.value;Be.positiveCount=Be.value>0?1:0;}var Bb=!isNaN(Bf);Be.value=Bb?Bf:Bc;Be.count+=Bb?1:0;Be.allValueCount+=1;this.aggregated=Bb;if(Bb){if(isNaN(Be.total)){Be.total=Bf;}else{Be.total+=Bf;}if(isNaN(Be.avgTotal)){Be.avgTotal=Bf;}else{Be.avgTotal+=Bf;}if(isNaN(Be.max)){Be.max=Bf;}else{Be.max=Math.max(Be.max,Bf);}if(isNaN(Be.min)){Be.min=Bf;}else{Be.min=Math.min(Be.min,Bf);}if(isNaN(Be.geomProduct)){if(Bf>0){Be.geomProduct=Bf;Be.positiveCount++;}}else{if(Bf>0){Be.geomProduct*=Bf;Be.positiveCount++;}}Be.count++;}}function Ax(Bb){return Bb.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"');}var T={dftUnDel:0,dftDel:1,usrDel:2};var AR=(function(){var Be=new window.DOMParser(),Bb,Bc;try{Bb=Be.parseFromString("<","text/xml");Bc=Bb.getElementsByTagName("parsererror")[0].namespaceURI;return function(Bf){return Bf.getElementsByTagNameNS(Bc,"parsererror").length>0;};}catch(Bd){return null;}}());function J(Bp){if(Bp.trim()===""){return{};}var Bb=new window.DOMParser(),Bk=false,Bn;try{Bn=Bb.parseFromString(Ax(Bp),"text/xml");Bk=AR&&AR(Bn);}catch(Bm){Bk=true;}if(Bk){return{};}var Bc=Bn.childNodes[0]||{},Bi=Bn.childNodes[0].childElementCount||0,Bl=Bc.firstElementChild,Bd=Bl&&Bl.attributes,Bh=Bd&&Bd.length||0,Bj={},Bg=0,Be,Bo,Bf;while(Bg<Bi){Be=Bj;Bd=Bl.attributes;for(Bf=0;Bf<Bh;Bf++){Bo=Bd[Bf].value;if(Bf===(Bh-1)){Be[Bo]=T.dftDel;}else{if(!Be[Bo]){Be[Bo]={};}Be=Be[Bo];}}Bg++;Bl=Bl.nextElementSibling;}return Bj;}function y(Bb){return parseInt(Bb,10);}function C(Bb){return !!(Bb&&Bb.toString()==="true");}function BF(){var Bb=this.modelData.dz,Bc=this.props;if(Bb){if(Bb.ColorBy&&Bb.ColorBy.TemplateMetric&&Bb.ColorBy.TemplateMetric[0]&&Bb.ColorBy.TemplateMetric[0].id){Bc.colorMetricID=Bb.ColorBy.TemplateMetric[0].id;this.setColorByType("metric");}else{Bc.colorMetricID=m;if(Bb.ColorBy&&Bb.ColorBy.TemplateUnit){AZ.call(this,Bc,Bb.ColorBy.TemplateUnit,An);this.setColorByType("attribute");}}if(Bb.SizeBy&&Bb.SizeBy.TemplateMetric&&Bb.SizeBy.TemplateMetric[0]&&Bb.SizeBy.TemplateMetric[0].id){Bc.sizeMetricID=Bb.SizeBy.TemplateMetric[0].id;}else{Bc.sizeMetricID=m;}}}function W(Bb){return AU.getPropertyByPath(Bb,"ghs.chs.items.0.items",[]);}function AI(Bj){var Bi="",Be=this.modelData,Bd=Be.ghs.chs.items,Bc=Bd.length,Bf=Bd[0].items.length,Bl=Be.gts.col,Bg;if(Bj<0||Bj>=Bf){return"";}for(Bg=0;Bg<Bc;Bg++){var Bh=Bd[Bg].items[Bj].idx;var Bk=Bl[Bg].es[Bh];var Bb=(Bk.oid!==undefined)?Bk.oid:Bk.id;Bi+=Bb+" ";}return Bi.slice(0,Bi.length-1);}function D(){var Bd=this.modelData,Be=W(Bd).length,Bb=this.props.sizeMetricID,Bi=this.props.colorMetricID,Bj=[],Bg;this.metricArray=Bj;for(Bg=0;Bg<Be;Bg++){Bj.push(AI.call(this,Bg));}Bj.push(m);Be++;this.sizeMetricIndex=0;this.colorMetricIndex=Be>2?1:0;for(Bg=0;Bg<Be;Bg++){if(Bb===Bj[Bg]){this.sizeMetricIndex=Bg;}if(Bi===Bj[Bg]){this.colorMetricIndex=Bg;}}if(Bb===undefined){Bb=Bj[this.sizeMetricIndex];this.props.sizeMetricID=Bb;}if(Bi===undefined){Bi=Bj[this.colorMetricIndex];this.props.colorMetricID=Bi;}if(this.props.sizeMetricID===m){this.props.sizeMetricEnabled=false;}if(this.props.colorMetricID===m){this.props.colorMetricEnabled=false;this.colorTheme.hasNoColorMetric=true;}if(AU.isOnExpressMode()&&this.props.colorMetricEnabled){this.setColorByType("metric");var Bc=Bd.gsi.thresholds;if(!Bc||Object.keys(Bd.gsi.thresholds).length===0){Bd.gsi.thresholds=AU.getMockUpThresholds(this.props.colorMetricID,this.getMetricName(this.colorMetricIndex));}}this.props.hasColorInThresholds=false;if(this.isMetricColorByType()&&Bd.gsi.thresholds[this.props.colorMetricID]!==undefined){var Bk=Bd.gsi.thresholds[this.props.colorMetricID];for(Bg=0;Bg<Bk.length;Bg++){var Bh=Bk[Bg];if(Bh&&Bh.fmt){var Bf=Bh.fmt;if(Bf.bc===undefined&&typeof Bf.fc=="string"){Bh.fmt.bc=Bf.fc;Bh.fmt.bgs=Bh.fmt.bgs||0;this.props.hasColorInThresholds=true;}else{if(Bf.bc){this.props.hasColorInThresholds=true;break;}}}}}if(this.isMetricColorByType()&&this.props.sizeMetricEnabled===false&&this.props.hasColorInThresholds===false){this.props.showLegend=false;}}function N(Bc,Bb){return this.getAttributeIndex({id:Bc},Bb);}function An(Be,Bg){var Bc=this.modelData,Bd=Bc&&Bc.gts,Bf=Bd&&Bd.row,Bh=Be.id,Bb=AU.isHierarchyObject(Be)?"hid":"id";return AU.findInArray(Bf,function(Bi){return Bi[Bb]===Bh;},Bg);}function AZ(Bi,Bd,Bb){var Bh=(Bd||[]).length,Be,Bf=[],Bc=[],Bj=this.modelData&&this.modelData.gts&&this.modelData.gts.row,Bg;for(Be=0;Be<Bh;Be++){Bg=-1;while(true){Bg=Bb.call(this,Bd[Be],Bg+1);if(Bg!==-1){Bf.push(Bg);}else{break;}}}Bf.sort();for(Be=0,Bh=Bf.length;Be<Bh;Be++){Bc.push(Bj[Bf[Be]]);}Bi.colorAttributeIndexes=Bf;Bi.colorAttributes=Bc;}function z(){var Bn=mstrmojo.netviz.PropertyParser,Bc=Bn.BooleanProperty,Bh=Bn.IntegerProperty,Be=Bn.FloatProperty,Bb=Bn.StringProperty,Bf=Bn.JsonProperty;var Bd=this.getProperties(),Bg={deletedList:{key:F.deletedList,type:Bf.preset({}),preSet:function(Bq,Br,Bo,Bp){return Bq===undefined?Bq:J(Bq);}},showMetricValues:{key:F.showMetricValues,type:Bc.preset(false)},labelSize:{key:F.labelSize,type:Bh.preset(x.On),preSet:function(Bq,Br,Bo,Bp){return x[Bq];},postGet:function(Bq,Bs,Bo,Bp){var Br="On";Object.keys(x).some(function(Bt){if(x[Bt]===parseInt(Bq,10)){Br=Bt;return true;}return false;});return Br;}},showLegend:{key:F.showLegend,type:Bc.preset(true)},layout:{key:F.layout,type:Bh.preset(Aq.Squarified)},isHeaderOnTop:{key:F.headerType,type:Bc.preset(true),preSet:function(Bq,Bs,Bo,Bp){if(Bq===undefined){return ;}var Br=Bq.toString();if(Br==="true"||Br==="false"){return Br==="true";}return y(Bq)!==0;},postGet:function(Bq,Br,Bo,Bp){return Bq==="true"?1:0;}},themeType:{key:F.themeType,type:Bb.preset("light"),preSet:function(Bq,Br,Bo,Bp){return y(Bq)!==0?"light":"dark";},postGet:function(Bq,Br,Bo,Bp){return Bq==="dark"?0:1;}},headerColors:{key:F.headerColors,type:Bf.preset(a.clone(BG)),postSet:function(Bs,Bt,Bp,Bq){var Br=true;if(Bs){if(!(Bs instanceof Array)){Bs=[Bs,Bs,Bs];}BR.forEach(Bs,function(Bu){if(!BN(Bu)){if(Bu&&Bu.color!==undefined){Bu.value=Ah.getCSSColorString(Bu.color);Bu.opacity=1;Bu.color=undefined;}else{Br=false;return false;}}});}else{Br=false;}var Bo=Br?Bs:a.clone(BG);this.isDefaultHeaderColor=BH(Bo)===false;return Bo;}},fonts:{key:F.fonts,type:Bf.preset(a.clone(v)),postSet:function(Bq,Br,Bo,Bp){return a.mergeHashes(a.clone(v),Bq);}},attrColorByOpacity:{key:F.attrColorByOpacity,type:Bf.preset({})},metricColorByOpacity:{key:F.metricColorByOpacity,type:Be.preset(1)},lgdBgFillClr:{key:BD.LEGEND_BG_COLOR,type:Bf.preset(undefined)},lgdBgFillStyle:{key:BD.LEGEND_BG_FILL_STYLE,type:Bb.preset(undefined)},lgdBgFillEff:{key:BD.LEGEND_BG_FILL_EFFECT,type:Bb.preset(undefined)},lgdBgFillTrans:{key:BD.LEGEND_BG_FILL_TRANSPARENCY,type:Bb.preset(undefined)},lgdFntSz:{key:BD.LEGEND_FONT_SIZE,type:Bb.preset(undefined)},lgdFntFml:{key:BD.LEGEND_FONT_FAMILY,type:Bb.preset(undefined)},lgdFntStyle:{key:BD.LEGEND_FONT_STYLE,type:Bh.preset(undefined)},lgdFntClr:{key:BD.LEGEND_FONT_COLOR,type:Bh.preset(undefined)},lgdBdrShw:{key:BD.LEGEND_BORDER_SHOW,type:Bc.preset(undefined)},lgdBdrClr:{key:BD.LEGEND_BORDER_COLOR,type:Bb.preset(undefined)},lgdBdrStyle:{key:BD.LEGEND_BORDER_LINE_STYLE,type:Bb.preset(undefined)},lgdBdrThk:{key:BD.LEGEND_BORDER_THICKNESS,type:Bb.preset(undefined)},lm:{key:A0.LEGEND_MODE,type:Bh.preset(undefined)},LegendPosition:{key:A0.LEGEND_POSITION,type:Bh.preset(2)},lwr:{key:A0.SCALE_LEGEND_WIDTH,type:Be.preset(undefined)}};var Bj=mstrmojo.heatmap.vi.VisHeatMapColorTheme.newInstance();Bj.initialize();this.colorTheme=Bj;this.props=new Bn().parse(Bd,Bg)||{};var Bi=this.props;Bj.style=Bi.themeType;if(Bi.showLegend&&!Bi.colorByType&&Bi.sizeMetricID===m){Bi.showLegend=false;}Bi.sizeMetricEnabled=true;Bi.colorMetricEnabled=true;Bi.legendAsc=true;Bi.headerPixels=Az.HeaderPixels;var Bm="metric",Bl=this.modelData.dz,Bk;if(AU.isValidDropZone(Bl)){BF.call(this);}else{if(Bd[F.metricList]){Bk=Bd[F.metricList].split(",");if(Bk.length>=2){Bi.sizeMetricID=Bk[0]||m;if(y(Bd[F.colorByType])===1){this.setColorByType("attribute");Bk.splice(0,1);Bi.colorAttributeIDs=Bk;AZ.call(this,Bi,Bk,N);}else{this.setColorByType(Bm);Bi.colorMetricID=Bk[1];}}else{Bi.sizeMetricID=m;}}}if(Bd.rlp==="false"&&Bd[F.absoluteFixed]){Bj.convertAbsoluteToBlend(this,Bd);}Bj.isBlend=true;if(Bd[F.blendColor]){Bj.isBlend=C(Bd[F.blendColor]);}if(Bd.gradientColors&&Bd.bandColors){Bj.createDataProviderFromString(Bd.gradientColors,Bd.bandColors);}if(Bd.rlp==="false"&&Bd[F.absoluteFixed]){this.colorTheme.convertAbsoluteToBlend(this,Bd);this.colorTheme.createDataProviderFromString(Bd.gradientColors,Bd.bandColors);}this.bgColor=this.getFormats()["background-color"]||Bj.getBackgroundColor();this.background={value:this.bgColor,opacity:1};D.call(this);}function e(){this.aggFunctions=[];var Bj=this.props,Bi=Bj.colorMetricID,Bl=this.aggFunctions,Be=this.modelData,Bc=Be.vp||{},Bf=this.metricArray,Bg=Bf.length-1,Bh;if(Bi!==m){var Bk=Bc["mle"+Bi]==="true";if(Bk){var Bd=parseFloat(Bc["mlma"+Bi]);if(!isNaN(Bd)){this.mlmax=Bd;}Bd=parseFloat(Bc["mlmi"+Bi]);if(!isNaN(Bd)){this.mlmin=Bd;}}}for(Bh=0;Bh<Bg;Bh++){var Bb="agf"+Bf[Bh];if(Bc[Bb]!==undefined){Bl.push(parseInt(Bc[Bb],10));}else{Bl.push(r.AESum);}}}function X(){e.call(this);var CP=this.modelData,CU=this.props.deletedList,CE=(CP.gts&&CP.gts.row)||[],CI=CE.length,Bk=(CP.gvs&&CP.gvs.items)||[],CA=(CP.ghs&&CP.ghs.rhs&&CP.ghs.rhs.items)||[],CB=CA.length,Bp=W(CP).length,Br=AU.range(0,Bp).map(AU.hasValidValueInMetric.bind(this,this)),B8=this.colorMetricIndex,Bd={max:-Infinity,min:Infinity};if(CI<=0&&!AU.isOnExpressMode()){this.setError(null,BZ.NO_TEMPLATE_UNIT);return ;}if(AU.isOnExpressMode()&&(!AU.hasOnlyMetricsOnColumn(CP)||!AU.hasNoMetricOnRow(CP))){this.setError(mstrmojo.desc(13685,"The Heat Map requires at least one attribute on the row axis to render properly; it is recommended that two metrics be placed on the column axis as well"));return ;}if(AU.hasMergedRowCells(CP)){this.setError(mstrmojo.desc(13686,"The HeatMap doesn't support grid data with merged row cell. Please disable cell merge and retry"));return ;}if(AU.isOnExpressMode()&&this.props.colorMetricEnabled&&Br[B8]){BR.forEach(Bk,function(CY){var CX=CY&&CY.items&&CY.items[B8];if(CX){Bd.max=Math.max(Bd.max,CX.rv);Bd.min=Math.min(Bd.min,CX.rv);}});}this.hasNegativeSizeValue=false;this.levelAttributes=[];this.root={aggValues:[],entityChildren:[],level:0};var CS,CV=true,Bo,CN=this.model;for(CS=0;CS<CI;CS++){Bo=CN.supportsViewFilterActions(CE[CS].id);CV=CV&&Bo;this.levelAttributes[CS]={index:CS,order:CS+1,isInLOA:CS+1>0,supportsViewFilter:Bo,name:CE[CS].n,id:CE[CS].id};}this.allSupportsViewFilter=CV;var By={},B9=[];for(CS=0;CS<CI;CS++){var CM=CE[CS].fs;B9[CS]=Math.max(1,CM?CM.length:1);}this.attSpan=B9;var Bz=true,Bx,Bj,Bh,B3,Bn,CL,CO,B4,Bv,CC,B1,Bw=Bd.max,CW=Bd.min,CK;for(CS=0;CS<CB;CS++){var Bm=CA[CS].items,CR,CQ;var B0="",Bc=CU,Bl=this.root,CF,Bi=0,Bs,B7,CD,CH=-1,Bu;for(CR=0;CR<CI;CR++){var Bf,CJ,Be,Bt=1;if(!(CP.gts.row[CR].otp===47&&CP.gts.row[CR].ost===12033)&&!!CP.gts.row[CR].cs){Bt=CP.gts.row[CR].cs;Bu=true;}if(Bm[Bi].etk===-1||Bm[Bi].etk==="-1"){if(Bl){Be=Bl.aggValues;for(CQ=0;CQ<Bp;CQ++){Bf=parseFloat(AU.getPropertyByPath(Bk,CS+".items."+CQ+".rv"));if(isNaN(Bf)){continue;}Be[CQ]={AETotal:Bf};}}break;}else{var B6,CT;B7="";CD="";B4=CE[CR];Bv=B9[CR];B1=[];for(CQ=0;CQ<Bv;CQ++,Bi+=Bt){B6=Bm[Bi].idx;if(B6===-1){continue;}CC=B4.es[B6];if(B1.indexOf(CC)===-1){B7+=CC.n+" ";if(CQ===0){CD=CC.id;B0+=B6;}B1.push(CC);}}B7=B7.substring(0,B7.length-1);if(Bc){Bc=Bc[Ax(B7)];}var Bg;if(CR!==CI-1){if(By[B0]!==undefined){Bl=By[B0];}else{CF={aggValues:[],entityChildren:[],parentEntity:Bl};Bg=Bl.entityChildren;Bg.push(CF);By[B0]=CF;Bl=CF;CF.deleted=false;CF.text=B7;CF.label=B7;CF.id=CD;CF.level=CR;CF.index=CS;CO=Bm[Bi-Bt];for(Bn=0;Bn!==Am;Bn+=1){CL=Ao[Bn];CF[CL]=CO[CL];}}B0+=":";CT=CF;}else{var B5;if(By[B0]!==undefined){Bs=By[B0];B5=Bs.indices;B5.push(CS);for(CQ=0;CQ<Bp+1;CQ++){CJ=Bs.aggValues[CQ];Bf=parseFloat(CQ===Bp?1:Bk[CS].items[CQ].rv);if(!Bu){AD.call(this,CJ,Bf,{needsCopy:true,invalidReplacement:Br[CQ]?0:1});}}}else{Bs={indices:[],aggValues:[],parentEntity:Bl};B5=Bs.indices;B5.push(CS);Be=Bs.aggValues;for(CQ=0;CQ<Bp+1;CQ++){CJ={};Be[CQ]=CJ;Bf=parseFloat(CQ===Bp?1:Bk[CS].items[CQ].rv);if(isNaN(Bf)){CJ.value=Br[CQ]?0:1;CJ.count=0;}else{CJ.value=Bf;CJ.count=1;}CJ.allValueCount=1;}this.aggregated=false;if(Bc){Bs.deleted=true;this.colorTheme.useDefault=false;}if(this.isMetricColorByType()&&this.props.colorMetricID!==m&&Br[B8]){var CG=Bk[CS].items[B8],Bb=CG.ti,B2=parseFloat(CG.rv);if(B2===""||B2===undefined||B2===null){Bb=-1;}else{if(Bb===undefined){if(AU.isOnExpressMode()){if(Bw===CW){CK=0;}else{CK=(B2-CW)/(Bw-CW);}if(CK<0.1){Bb=0;}else{if(CK>=0.1&&CK<0.3){Bb=1;}else{if(CK>=0.3&&CK<0.5){Bb=2;}else{if(CK>=0.5&&CK<0.7){Bb=3;}else{if(CK>=0.7&&CK<0.9){Bb=4;}else{if(CK>=0.9){Bb=5;}}}}}}}else{Bb=-1;}}}Bs.thrColorIndex=Bb;}else{Bs.thrColorIndex=-1;}Bg=Bl.entityChildren;Bg.push(Bs);Bs.level=CI-1;Bs.text=B7;Bs.label=B7;Bs.id=CD;By[B0]=Bs;CO=Bm[Bi-Bt];for(Bn=0;Bn!==Am;Bn+=1){CL=Ao[Bn];Bs[CL]=CO[CL];}}CT=Bs;}if(Bm[CR].cet!==undefined){if(CR-CH!==1||(!isNaN(Bx)&&Bx!==CS)){Bz=false;}if(Bz){Bj=CT;CH=CR;Bx=CS;}if(isNaN(B3)||B3<CR){B3=CR;Bh=CT;}}}}}function Bq(CY){var CZ=[];var CX;if(CY.entityChildren){for(CX=0;CX<Bp+1;CX++){if(!CZ[CX]){CZ[CX]={AETotal:0,isAETotalFaked:false};}}BR.forEach(CY.entityChildren,function(Cd){var Cb=Bq(Cd);var Ca,Cf,Ce,Cc;for(CX=0;CX<Bp+1;CX++){Cf=CZ[CX];Ca=Cb[CX];if(Cd.entityChildren){Cf.AETotal+=Ca.AETotal;Cf.isAETotalFaked|=Ca.isAETotalFaked;}else{Ce=Ca.total;if(Ce===undefined){Ce=Ca.value;}Cc=Ca.allValueCount!==0&&Ca.count!==0;CZ[CX].AETotal+=Ce;CZ[CX].isAETotalFaked|=!Cc;}}});for(CX=0;CX<Bp+1;CX++){if(!CY.aggValues[CX]){CY.aggValues[CX]=CZ[CX];}}}return CY.aggValues;}Bq(this.root);if(Bz&&Bj){this.previousSelected=[Bj];}else{if(Bh){this.previousSelected=[Bh];}}}function BI(Bf,Bd,Bc){var Bb=Bf.aggValues;if(Bd>=Bb.length){return NaN;}var Be=Bb[Bd];if(Bf.entityChildren===undefined&&Be.allValueCount===1){return Be.value;}else{return Be.AETotal;}}function S(Bd,Bc){var Bb=Bc.sizeMetricIndex,Be=BI(Bd,Bb,Bc);if(Be<0){Bc.hasNegativeSizeValue=true;return Math.abs(Be);}return Be;}function AA(Bc){var Bb={};Bb.x=Bc.x;Bb.y=Bc.y;Bb.w=Bc.w;Bb.h=Bc.h;return Bb;}function j(Bd){var Be=Bd.level,Bb=this.levelAttributes.length,Bc;switch(Bb){case 1:Bc={v:1,h:1};break;case 2:switch(Be){case 0:Bc={v:1,h:3};break;default:Bc={v:1,h:1};}break;case 3:switch(Be){case 0:Bc={v:1,h:6};break;case 1:Bc={v:1,h:3};break;default:Bc={v:1,h:1};}break;default:switch(Be){case 0:Bc={v:1,h:8};break;case 1:Bc={v:1,h:4};break;case 2:Bc={v:1,h:2};break;default:Bc={v:1,h:1};}}if(!this.props.isHeaderOnTop){Bc.v=Bc.h;}return Bc;}function h(Bb){return Bb.w>0&&Bb.h>0;}function BX(Bb){var Bc=AA(Bb);if(!h(Bb)){Bc.w=0;Bc.h=0;}return Bc;}function A1(Bb){var Bc=Bb.x;Bb.x=Bb.y;Bb.y=Bc;Bc=Bb.w;Bb.w=Bb.h;Bb.h=Bc;return Bb;}function Ac(Be,Bc){var Bb=Math.max(Be.x,Bc.x);var Bg=Math.max(Be.y,Bc.y);var Bd=Math.min(Be.x+Be.w,Bc.x+Bc.w)-Bb;var Bf=Math.min(Be.y+Be.h,Bc.y+Bc.h)-Bg;if(Bd<0||Bf<0){return{x:NaN,y:NaN,w:NaN,h:NaN};}return{x:Bb,y:Bg,w:Bd,h:Bf};}function AK(Be,Bc){var Bb=BX(Bc);Be.size=Bb;if(this.props.isHeaderOnTop&&Be.entityChildren){var Bd=this.props.headerPixels,Bf=j.call(this,Be).v;Be.headerSize=BX({x:Bb.x,y:Bb.y,w:Bb.w,h:Math.min(Bd,Bb.h)});Be.contentSize=BX({x:Bb.x,y:Bb.y+Bd+Bf,w:Bb.w,h:Bb.h-Bd-Bf});Be.size=AA(Be.contentSize);Bc.y=Be.contentSize.y;Bc.h=Be.contentSize.h;}else{delete Be.headerSize;delete Be.contentSize;}}function w(Bs,B5,Bw,Bf,B7){var Bx,Bt,Bo=Bs.r||[],By=Bo.length,Bn,B1,Bu,B6=false;if(By===0){return ;}if(Bw<B5.h){Bn=Bw;B1=B5.h;Bu=B5;}else{Bn=B5.h;B1=Bw;Bu=AA(B5);A1(Bu);B6=true;}var Bl=Bu.x,Bk=Bu.y,Bc={x:Bl,y:Bk,w:Bn,h:B1};var Bv=j.call(this,Bo[0]),B0,Be=this;var Bh={v:Bv.v,h:Bv.h};if((B7===true&&B6!==true)||(B7===false&&B6===true)){Bh={v:Bv.h,h:Bv.v};}var B2=function B2(CA,B9){var CC=S(CA,Be),CB=S(B9,Be),B8;if(isNaN(CC)){if(isNaN(CB)){B8=0;}else{B8=1;}}else{if(isNaN(CB)){B8=-1;}else{B8=CC<CB?1:-1;}}return B8;};var Bp=function(CC,CD,CA){if(Bq){return 1;}var CB=S(CC,CD),B9=B1*CB/Bf;var B8=(Bf<=0||CC.deleted)?0:Math.ceil(B9);if(B8>0){B3+=B8-B9;}if(CB<Bf){if(CA===0&&By>1){if(Bi>1){if(B8>(Bi>>1)){B8-=(Bi>>1);}}else{if(B8>1){B8--;}}if(B8+(By-1)*(Bi+1)>=B1){B8=B1-(By-1)*(Bi+1);Bq=true;}}else{if(CA<By-1){if(Bi>1){if(B8>(Bi>>1)){B8-=Bi;}else{B8=1;}}else{if(B8>1){B8--;}}if(B3>1&&B8>1){B8--;B3-=1;}}else{B8=Math.max(B1+Bu.y-Bk,1);}}}return B8;};var Bm=0,B4,Bz,Bi=Bh.v,Bg=Math.max(1,Math.floor((B1+Bi)/(1+Bi)));if(By>Bg){for(B0=0;B0<By;B0++){B4=Bo[B0];if(B4.deleted){continue;}Bm++;}}for(Bz=By-1,B0=Bm-Bg;B0>0;Bz--){B4=Bo[Bz];if(!B4.deleted){Bf-=S(B4,this);B0--;}}var B3=0,Bq=false;for(Bz=0,B0=0,Bm=Bo.length,By=Math.min(By,Bg);B0<Bm;Bz++){var Bd,Br;B4=Bo[Bz];if(B4.deleted){continue;}if(B0>=By){Bt=0;}else{Bt=Bp(B4,this,B0);}B0++;Bx=Bn;var Bj={x:Bl,y:Bk,w:Bx,h:Bt};Bd=Ac(Bj,Bc);if((B7===true&&B6!==true)||(B7===false&&B6===true)){A1(Bd);}AK.call(this,B4,Bd);Bk+=Bt+Bi;if(B4.entityChildren!==undefined){Br=Math.min(Bd.w,Bd.h);var Bb=B4.entityChildren.slice(0);Bb.sort(B2);BW.call(this,Bb,{r:[]},Br,Bd);}}}function Y(Bk,Bv){var Bd=0,Bb=Bk.r,Bo=Bb.length;if(Bo===0){return ;}var Bp,Bm=Bb[0].parentEntity,Bi=Bm.entityChildren,Bf=Bi.length;var Bq,Bs,Bg;for(Bq=0;Bq<Bo;Bq++){Bs=Bb[Bq];Bg=S(Bs,this);if(!Bs.deleted&&Bg>0){Bd+=Bg;}}if(Bk.t===undefined){var Bj=0;for(Bq=0;Bq<Bf;Bq++){Bs=Bi[Bq];Bg=S(Bs,this);if(!Bs.deleted&&Bg>0){Bj+=Bg;}}Bk.t=Bj;}Bs=Bb[0];var Bl=j.call(this,Bs),Bc={x:0,y:0,w:0,h:0};if(Bs===this.root){Bp=this.heatMapSize.w*this.scaleFactor*this.heatMapSize.h*this.scaleFactor;Bc.w=this.heatMapSize.w*this.scaleFactor;Bc.h=this.heatMapSize.h*this.scaleFactor;}else{if(Bm===this.root){Bp=this.heatMapSize.w*this.scaleFactor*this.heatMapSize.h*this.scaleFactor;Bc.w=this.heatMapSize.w*this.scaleFactor;Bc.h=this.heatMapSize.h*this.scaleFactor;}else{var Bx=Bm.size;Bp=Bx.w*Bx.h;Bc=AA(Bx);}if(Bk.t===0){Bp=0;}else{Bp*=Bd/Bk.t;}}var Bh=Bv.w,Br=Bv.h,Bw=false;if(Bv.h>=Bv.w){Bw=true;A1(Bv);A1(Bc);var Bt=Bh;Bh=Br;Br=Bt;Bl={h:Bl.v,v:Bl.h};}if((Bc.x<Bv.x)||(Bc.x+Bc.w>Bv.x+Bv.w)){if(Bl.h>1){Bh+=(Bl.h>>1);}}if((Bc.y<Bv.y)||(Bc.y+Bc.h>Bv.y+Bv.h)){if(Bl.v>1){Br+=(Bl.v>>1);}}var Bn=Br===0?0:Math.min(Bv.w,Math.ceil(Bp/Br));if(Bd<Bk.t&&Bd>0){if(Bv.x+Bn<Bc.x+Bc.w){if(Bl.h>1){if(Bn>Bl.h>>1){Bn-=(Bl.h>>1);}}else{if(Bn>1){Bn--;}}}}w.call(this,Bk,Bv,Bn,Bd,Bw);var Bu=Bv.x+Bn,Be=Bv.w-Bn;if(Bd<Bk.t&&Bd>0){if(Bv.x+Bn<Bc.x+Bc.w){if(Bl.h>1){if(Be>Bl.h){Bu+=Bl.h;Be-=Bl.h;}}else{if(Be>1){Bu++;Be--;}}}}Bv.x=Bu;Bv.w=Math.max(0,Be);if(Bw){A1(Bv);}}function Ag(Bi,Bk,Bt){var Bl,Bb=Bi.r,Bn=Bb.length;if(Bn>0&&Bt>0){var Bs=Bb[0];var Bj=0,Bo=this;if(Bi.t===undefined){BR.forEach(Bs.parentEntity.entityChildren,function(Bv){if(!Bv.deleted){Bj+=S(Bv,Bo);}});Bi.t=Bj;}else{Bj=Bi.t;}if(isNaN(Bj)||Bj<=0){return -1;}var Bm,Bp,Bc=0,Bu,Br=false,Bq;for(Bq=0;Bq<Bn;Bq++){Bs=Bb[Bq];if(!Bs.deleted){Bu=S(Bs,this);if(!isNaN(Bu)){if(Br===false){Bp=Bm=Bu;Br=true;}else{Bp=Math.max(Bu,Bp);Bm=Math.min(Bu,Bm);}Bc+=Bu;}}}var Bd=Bt*Bc/Bj,Bg=Bd/Bk,Bh=(Bk<Bg)?Bk:Bg;Bp=Bt*Bp/Bj;Bm=Bt*Bm/Bj;var Bf=Bp/(Bh*Bh);var Be=Bm/(Bh*Bh);Bf=(Bf>1)?Bf:(1/Bf);Be=(Be>1)?Be:(1/Be);Bl=Math.max(Bf,Be);}else{Bl=-1;}return Bl;}function BW(Bn,Bb,Be,Bk,Bl){var Bf=[[this,Bn,Bb,Be,Bk,Bl]];while(Bf.length){var Bd=Bf.pop();var Bj=Bd.shift();Bn=Bd.shift();Bb=Bd.shift();Be=Bd.shift();Bk=Bd.shift();Bl=Bd.shift();if(Bn.length===0){Y.call(Bj,Bb,Bk);}else{var Bc=Bk.w*Bk.h;var Bm;if(Bl!==undefined){Bm=Bl;}else{Bm=Ag.call(Bj,Bb,Be,Bc);}var Bg=Bn[0],Bh=Bb.r;Bh.push(Bg);var Bi=Ag.call(Bj,Bb,Be,Bc);if(Bm>=Bi||Bm===-1){Bn.shift();Bf.push([Bj,Bn,Bb,Be,Bk,Bi]);}else{Bb.r.pop();Y.call(Bj,Bb,Bk);Be=Math.min(Bk.w,Bk.h);Bf.push([Bj,Bn,{r:[],t:Bb.t},Be,Bk]);}}}}function AM(Bd){if(Bd===null){return[];}var Bb=Bd.slice(0),Bf=0,Bc=Bb.length,Be;Bb.t=[];for(Be=0;Be<Bc;Be++){var Bg=Bb[Be],Bh=S(Bg,this);if(Bg.deleted||isNaN(Bh)||Bh<=0){Bb.splice(Be,1);Be--;Bc--;continue;}Bf+=Bh;Bb.t[Be]=Bf;}return Bb;}function d(Bf,Bi,Bh,Bg){var Bd=AA(Bi);if(Bh===true){A1(Bd);}AK.call(this,Bf,Bd);var Be=Bf.entityChildren;if(Be!==undefined){var Bb=AM.call(this,Be),Bc=Bb.length;if(Bc>0&&Bg){Bg.push([this,Bb,0,Bc-1,Bd]);}}}function BK(Bk,Bw,Bm,B2){var B3=[[this,Bk,Bw,Bm,B2]];while(B3.length){var Bg=B3.pop();var By=Bg[0];Bk=Bg[1];Bw=Bg[2];Bm=Bg[3];B2=Bg[4];var B0=Bk[0],Bs=j.call(By,B0),Bu,Bx,Be,Bf,Bi,B6=false,Bt=Bm-Bw+1,Bh=(Bt>2?((Bt-1)>>1):(Bt>>1))+Bw,Bq;Bq=AA(B2);if(Bq.w<=Bq.h){A1(Bq);Bs={v:Bs.h,h:Bs.v};B6=true;}Bu=AA(Bq);Bx=AA(Bq);if(Bw===Bm){B0=Bk[Bw];d.call(By,B0,Bq,B6,B3);continue;}if(Bw+1===Bm){B0=Bk[Bw];Be=S(B0,By);B0=Bk[Bm];Bf=S(B0,By);}else{if(Bw===0){Be=Bk.t[Bh-1];}else{Be=Bk.t[Bh-1]-Bk.t[Bw-1];}if(Bh===0){Bf=Bk.t[Bm];}else{Bf=Bk.t[Bm]-Bk.t[Bh-1];}}Bi=Be/(Be+Bf);Bu.w=Math.ceil(Bu.w*Bi);if(Bu.w<B2.w){if(Bs.h>1){if(Bu.w>(Bs.h>>1)){Bu.w-=(Bs.h>>1);}}else{if(Bu.w>1){Bu.w--;}}}if(Bw+1===Bm){Bx.w-=Bu.w+Bs.h;Bx.x+=Bu.w+Bs.h;B0=Bk[Bw];d.call(By,B0,Bu,B6,B3);B0=Bk[Bm];d.call(By,B0,Bx,B6,B3);continue;}var B8=AA(Bq),Bl,Bp,Bd=0,B1=-1,Bv=1,Br;if(Bh>Bw){var Bj=AA(Bu);if(B6){A1(Bj);}B3.push([By,Bk,Bw,Bh-1,Bj]);}B8.w-=Bu.w+Bs.h;B8.x+=Bu.w+Bs.h;Bx.w=B8.w;Bx.x=B8.x;Bl=B8.w/B8.h;B0=Bk[Bh];Br=S(B0,By);Bp=Br/Bf;var Bz;for(Bz=Bh;Bz<=Bm;Bz++){B0=Bk[Bz];Bd+=S(B0,By);if(Bz===Bm-1){continue;}var Bc=Bd/Bf,B7=Br/Bd,B5=Bc/B7*Bl;if(B5>=1){if(Bv<1&&Bv*B5>1){B1=(Bz===Bm)?Bz-2:Bz-1;}else{B1=Bz;}break;}Bv=B5;}B1=B1<0?Bm:B1;var Bo,Bn,B4;if(Bh===0){Bo=Bk.t[B1];}else{Bo=Bk.t[B1]-Bk.t[Bh-1];}Bn=Math.min(Math.ceil(B8.w*(Bo/Bf)),B8.w);B4=Math.min(Math.ceil(B8.h*(Br/Bo)),B8.h);if(Bn<B8.w){if(Bs.h>1){if(Bn>(Bs.h>>1)){Bn-=(Bs.h>>1);}}else{if(Bn>1){Bn--;}}}if(B4<B8.h){if(Bs.v>1){if(B4>(Bs.v>>1)){B4-=(Bs.v>>1);}}else{if(B4>1){B4--;}}}var Bb={x:B8.x,y:B8.y,w:Bn,h:B4};B0=Bk[Bh];d.call(By,B0,Bb,B6,B3);if(Bh<B1){B8.y+=B4+Bs.v;B8.w=Bn;B8.h-=B4+Bs.v;if(B6){A1(B8);}B3.push([By,Bk,Bh+1,B1,B8]);}if(B1<Bm){Bx.x+=Bn+Bs.h;Bx.w-=Bn+Bs.h;if(B6){A1(Bx);}B3.push([By,Bk,B1+1,Bm,Bx]);}}}function BA(Bi,Bs){var Bt=[[this,Bi,Bs]];while(Bt.length){var Bc=Bt.pop();var Bo=Bc[0];Bi=Bc[1];Bs=Bc[2];if(Bi===null||Bi.length===0){continue;}var Bh=0,Br=Bi[0],Bv,Bl=j.call(Bo,Br),Bu=false,Bn=Bi.length,Bf,Be,Bg,Bq;var Bp;for(Bp=0;Bp<Bn;Bp++){Br=Bi[Bp];Bv=S(Br,Bo);if(!Br.deleted&&Bv>0){Bh+=Bv;}}if(Bs.w>=Bs.h){Bu=true;A1(Bs);Bl={h:Bl.v,v:Bl.h};}Bg=Bs.w;Bq=Bs.h;Bf=Bs.x;Be=Bs.y;for(Bp=0;Bp<Bn;Bp++){Br=Bi[Bp];Bv=S(Br,Bo);if(!Br.deleted&&Bv>0){var Bm,Bk;Bk=Bh<=0?0:Math.ceil(Bv/Bh*Bq);Bm=Bg;if(Bv<Bh){if(Bp===0||Bp===Bn-1){if(Bl.v>1){if(Bk>(Bl.v>>1)){Bk-=(Bl.v>>1);}}else{if(Bk>1){Bk--;}}}else{if(Bk>Bl.v){Bk-=Bl.v;}}}Bm=Math.max(0,Bm);Bk=Math.max(0,Bk);var Bd={x:Bf,y:Be,w:Bm,h:Bk},Bb=Ac(Bd,Bs);Be+=Bk+Bl.v;if(Be>=Bs.y+Bq){Bb.h=Bs.y+Bq-Bb.y;}if(Bu){A1(Bb);}AK.call(Bo,Br,Bb);if(Br.entityChildren!==undefined){Bt.push([Bo,Br.entityChildren,Bb]);}}else{var Bj={x:Bf,y:Be,w:0,h:0};if(Bu){A1(Bj);}AK.call(Bo,Br,Bj);continue;}}if(Bu){A1(Bs);}}}function Ab(){var Bd=0;if(this.props.showLegend){Bd=Math.min(Math.floor(0.2*(parseInt(this.height,10)-2*this.LayoutProperties.Padding)),this.LayoutProperties.MaxLegendHeight);}var Bi=this,Bh=AA(this.heatMapSize);Bh.x=0;var Be=Math.min(Bh.w,Bh.h);var Bf=this.root.entityChildren;var Bb;switch(this.props.layout){case Aq.Squarified:Bb=Bf.slice(0);Bb.sort(function Bg(Bk,Bj){var Bm=S(Bk,Bi);var Bl=S(Bj,Bi);if(isNaN(Bm)){if(isNaN(Bl)){return 0;}return 1;}if(isNaN(Bl)){return -1;}return Bm<Bl?1:-1;});BW.call(this,Bb,{r:[]},Be,Bh);break;case Aq.SliceAndDice:BA.call(this,Bf,Bh);break;case Aq.PivotByMiddle:Bb=AM.call(this,Bf);var Bc=Bb.length;if(Bc>0){BK.call(this,Bb,0,Bc-1,Bh);}break;}}function AT(Bd,Bb){var Bc=mstrmojo.desc(14109,"Total of")+" {0}";return Bc.replace("{0}",Bd);}function A3(Bg,Bk,Bc,Bb){var Bf=(Bg.index===undefined)?Bg.indices[0]:Bg.index;var Bm=AU.getPropertyByPath(Bk,"modelData.gvs.items",[]);var Bi=Bk.getMetricName(Bc);var Bj,Bl,Bh,Be;if(Bc===-1){Bj=AE;}else{if(Bg.entityChildren!==undefined||Bk.aggregated){Bl=Bk.aggFunctions[Bc];Bi=AT(Bi,Bl);Bj=BI(Bg,Bc,Bk);Bh=AU.getPropertyByPath(Bg,"aggValues."+Bc);if(Bh.isAETotalFaked||isNaN(Bj)){Bj=AE;}else{var Bd=Bk.getFormatString(Bc);Bj=Bk.nf.formatByMask(Bd,Bj);}}else{Bj=AU.getPropertyByPath(Bm,Bf+".items."+Bc+".v");if(Bj===""||Bj===undefined||Bj===null){Bj=AE;}}}Be={n:Bi,v:Bj};if(Bb){Bb.push(Be);}return Be;}function AS(Bg,Bb){var Bf=AU.getPropertyByPath(Bg,"modelData.gts.col.0.es.length",0);var Be=[];var Bc=Bg.sizeMetricIndex,Bd=Bg.colorMetricIndex;if(Bc!==undefined&&Bc!==Bf){Be.push(Bc);}if(!Bg.isAttributeColorByType()&&Bb.entityChildren===undefined&&Bd!==undefined&&Bd!==Bf&&Bd!==Bc){Be.push(Bd);}AU.range(0,Bf).forEach(function(Bh){if(Be.indexOf(Bh)===-1){Be.push(Bh);}});return Be;}function AH(Bt,Bf){var Bc=Bt.level,Be=(Bt.index===undefined)?Bt.indices[0]:Bt.index,Bk=0,Bj=Bf.attSpan,Bb=Bf.modelData.ghs.rhs.items,Bv=Bb[Be].items,Bn=Bf.modelData.gts.row,Bm;var Bx="",Bl="",Bg,Bh;var Bu=[];var Bq,Bi,Bo,Bs,Bd,Br;for(Bq=0;Bq<=Bc;Bq++){if(Bq>0&&Bq===Bc){Bu.push(null);}Bm=Bn[Bq];var Bp=!!Bn[Bq].cs?Bn[Bq].cs:1;if(Bf.modelData.lnm===t.OFF){Bx=Bm.n;Bg=Bm.id;Bl="";Br=[];for(Bo=Bk,Bs=Bk+Bj[Bq];Bo<Bs;Bo++){Bi=Bv[Bo].idx;if(Bi===-1){continue;}Bd=Bm.es[Bi];if(Br.indexOf(Bd)===-1){Bl+=Bd.n+" ";if(Bo===Bk){Bh=Bd.id;}Br.push(Bd);}}Bl=Bl.substring(0,Bl.length-1);Bu.push({n:Bx,v:Bl,tid:Bg,eid:Bh});}else{for(Bo=Bk,Bs=Bk+Bj[Bq];Bo!==Bs;Bo++){Bi=Bv[Bo].idx;if(Bi===-1){continue;}Bu.push({n:Bm.fs[Bo-Bk].n,v:Bm.es[Bi].n});}}Bk+=Bp>1?Bp:Bj[Bq];}var Bw=AS(Bf,Bt);if(AW){Bw.push(-1);}Bw.forEach(function(By){A3(Bt,Bf,By,Bu);});return Bu;}function R(Bb){return{evt:Bb,target:Bb.getTarget(),pageX:Bb.e.pageX,pageY:Bb.e.pageY,clientX:Bb.e.clientX,clientY:Bb.e.clientY};}var Af=function(Bf,Be){if(AU.isOnExpressMode()){return ;}var Bc=Bf.e||Bf,Bb=this.getSelectionMenuConfig();if(!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign()&&Be){var Bd=this;Bb.addSeparator();Bb.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");Bd.parent.selectVIUnit();Be(Bf);});}if(Bb.hasMenuItems()){this.showMenu(Bb,Bc);}};function AQ(Bb){if(AU.isOnExpressMode()||mstrApp.isAppStatePresentation()||!mstrApp.allowWebDashboardDesign()){return ;}Bb=Bb.e||Bb;this.showMenu(this.getBlankSpaceMenuConfig(Bb),Bb);}var Aa={BACKGROUND:"background",RECTANGLE:"rectangle",RECTANGLE_LABEL:"rectangleLabel",LEGEND_BACKGROUND:"legendBackground"};function Ap(){function Bh(Bm,Br,Bl){var Bk=this.props,Bo=Bl.updateModel,Bq=Bl.toModelValue,Bp=Bl.toModelPropName,Bn;Bk.unmarshal(Bm,Br);Bn=Bk[Bm];if(Bo){if(Bq instanceof Function){Bn=Bq.call(this,Bm,Bn);}if(Bp instanceof Function){Bm=Bp.call(this,Bm);}this.observableModel[Bm].setValue(Bn,true);}return Bn;}var Bi=function(){var Bl=this.props,Bk=Bl.themeType==="light"?0:1,Bm={value:this.bgColor,opacity:A2.lgdBgFillTrans[Bk]/100};if(Bl.lgdBgFillClr){Bm.value=Ay.decodeColor(Bl.lgdBgFillClr);}if(Bl.lgdBgFillTrans){Bm.opacity=Bl.lgdBgFillTrans/100;}return Bm;};var Bd=function(Bk,Bm,Bl,Bo){function Bn(Br,Bq){var Bp=this.attributeColorByLegend;if(!Bp||!Bp.hasRendered){return ;}Bh.call(this,Bk,Br,{updateModel:Bq,toModelPropName:function(Bs){if(Bs===BD.LEGEND_BG_COLOR||Bs===BD.LEGEND_BG_FILL_TRANSPARENCY){return"legendBackground";}return Bs;},toModelValue:function(Bt,Bs){if(Bt===BD.LEGEND_BG_COLOR||Bt===BD.LEGEND_BG_FILL_TRANSPARENCY){return Bi.call(this);}return Bs;}});this.initHTML5Props(this.HTML5PROPS);Bp.updateStyle(this.HTML5PROPS.LEGEND);if(Bo){Bp.updateTitleLineHeight();this.hEvalSize4Legend();this.updateLegend();Bp.updateSplitter();this.updateCanvasAfterAttributeLegendChanged(AO[Bp.currDockedPositionIdx].pos,this.legendW);}}Bn.call(this,Bm);this.setProperty(Bl,this.props.marshal(Bk),{suppressData:true,clientUndoRedoCallback:Bn});}.bind(this);function Bj(Bm,Bl,Bk){return function(){function Bp(Br,Bq){Bh.call(this,Bl,Br,a.copy(Bn,{updateModel:Bq}));this.refreshWidget();if(Bq&&Bo){this.parent.selectVIUnit(true);}}Bk=a.copy(Bk,{refreshPropertyPanel:true});var Bo=Bk.refreshPropertyPanel;var Bn=Bk.modelConfig;Bp.call(this,Bf[Bl].getValue(),false);this.setProperty(Bm,this.props.marshal(Bl),{suppressData:true,clientUndoRedoCallback:Bp});};}var Be=this.props.headerColors,Bg=this.getPropsInfo(),Bb=this.isAttributeColorByType()?"attrColorByOpacity":"metricColorByOpacity",Bf=new mstrmojo.netviz.ObservableModel({isHeaderOnTop:Bg.isHeaderOnTop,labelSize:Bg.labelSize,showMetricValues:Bg.showMetricValues,layout:Bg.layout,background:this.background,headerColors:Be[0],fonts:Bg.fonts,legendBackground:Bi.call(this),showLegend:Bg.showLegend,colorByOpacity:Bg[Bb],lgdFntSz:Bg.lgdFntSz,lgdFntFml:Bg.lgdFntFml,lgdFntClr:Bg.lgdFntClr,lgdFntStyle:Bg.lgdFntStyle}),Bc=this.id;Bf.isHeaderOnTop.attachEventListener("valueChanged",Bc,Bj(F.headerType,"isHeaderOnTop"));Bf.labelSize.attachEventListener("valueChanged",Bc,Bj(F.labelSize,"labelSize"));Bf.showMetricValues.attachEventListener("valueChanged",Bc,Bj(F.showMetricValues,"showMetricValues"));Bf.layout.attachEventListener("valueChanged",Bc,Bj(F.layout,"layout"));Bf.headerColors.attachEventListener("valueChanged",Bc,Bj(F.headerColors,"headerColors",{refreshPropertyPanel:false,modelConfig:{toModelValue:function(Bl,Bk){return Bk&&Bk[0];}}}));Bf.background.attachEventListener("valueChanged",Bc,function(Bl){this.background=Bf.background.getValue();var Bk=this.getSingleBackgroundColor();this.canvasObject.bgColor=Bk;this.highlightCanvas.backgroundColor=Bk;var Bm=K.encodeColor(this.getFormats()["background-color"],10),Bn=K.encodeColor(Bl.newValue,10);if(Bm!==Bn){AU.changeWidgetBackground(this,Bl.newValue,Bl.oldValue);}this.canvasObject.removeLabels();this.canvasObject.drawLabels();});Bf.fonts.attachEventListener("valueChanged",Bc,function(){var Bk="fonts";function Bl(Bn,Bm){function Bp(Bq){return function(Bu,Bs){if(Bu.valid){return ;}var Bt=AU.getPropertyByPath(Bo,Bq),Br=AU.getPropertyByPath(Bf.fonts,Bq);if(Bt&&Br){Bt.scale=Bs;Br.scale.setValue(Bs,true);}};}var Bo=Bh.call(this,Bk,Bn,{updateModel:Bm});O(Bo,n(BV,Bp));f.call(this,Bo);this.canvasObject.fonts=this.props.fonts;this.refreshWidget();}Bl.call(this,Bf.fonts.getValue(),false);this.setProperty(F.fonts,this.props.marshal(Bk),{suppressData:true,clientUndoRedoCallback:Bl});});Bf.legendBackground.attachEventListener("valueChanged",Bc,function(Bm){var Bk,Bl=Bm.newValue;if(isNaN(Bl)){Bl=Ay.encodeColor(Bl);Bk=BD.LEGEND_BG_COLOR;}else{Bl*=100;Bk=BD.LEGEND_BG_FILL_TRANSPARENCY;}Bd(Bk,Bl,Bk,false);});Bf.lgdFntSz.attachEventListener("valueChanged",Bc,function(Bk){Bd("lgdFntSz",Bk.newValue,BD.LEGEND_FONT_SIZE,true);});Bf.lgdFntFml.attachEventListener("valueChanged",Bc,function(Bk){Bd("lgdFntFml",Bk.newValue,BD.LEGEND_FONT_FAMILY,true);});Bf.lgdFntClr.attachEventListener("valueChanged",Bc,function(Bk){Bd("lgdFntClr",Bk.newValue,BD.LEGEND_FONT_COLOR,false);});Bf.lgdFntStyle.attachEventListener("valueChanged",Bc,function(Bk){Bd("lgdFntStyle",Bk.newValue,BD.LEGEND_FONT_STYLE,true);});Bf.showLegend.attachEventListener("valueChanged",Bc,function(Bk){var Bl="showLegend";function Bm(Bq,Bp){var Bn=Bh.call(this,Bl,Bq,{updateModel:Bp});var Bo=this.attributeColorByLegend;if(!Bo){this.reRender();return ;}this.toggleLegend(Bn);this.updateCanvasAfterAttributeLegendChanged(AO[Bo.currDockedPositionIdx].pos,(Bn?this.legendW:0));}Bm.call(this,Bk.newValue,false);this.setProperty(F.showLegend,this.props.marshal(Bl),{suppressData:true,clientUndoRedoCallback:Bm});});Bf.colorByOpacity.attachEventListener("valueChanged",Bc,function(Bk){function Bl(Bn,Bm){Bh.call(this,Bb,Bn,{updateModel:Bm,toModelPropName:function(Bo){return"colorByOpacity";}});this.refreshWidget();}Bl.call(this,Bk.newValue,false);this.setProperty(F[Bb],this.props.marshal(Bb),{suppressData:true,clientUndoRedoCallback:Bl});});return Bf;}function Ba(Bb,Bc){if(Bb===undefined||Bb===null||Bb.length===0){return false;}return Bb.every(function(Bd){return Bc(Bd.level);});}function AV(){var Bb=this.levelAttributes.length-1,Bc;return Ba(this.previousSelected,function(Bd){if(Bd===Bb){return false;}if(Bc===undefined){Bc=Bd;}return Bc===Bd;});}function Q(){var Bb=this.levelAttributes.length-1;return Ba(this.previousSelected,function(Bc){return Bc!==Bb;});}function Al(){var Bb=this.levelAttributes.length-1;return Ba(this.previousSelected,function(Bc){return Bc===Bb;});}function A9(Bg){var Bc={},Bf=[],Be,Bh,Bd,Bb;for(Bd=0,Bb=Bg.length;Bd!==Bb;Bd+=1){Be=Bg[Bd];Bh=Be&&Be.id;if(Bh!==undefined&&!Bc.hasOwnProperty(Bh)){Bc[Bh]=true;Bf.push(Be);}}return Bf;}function Ad(Bd,Be){var Bc=(Bd.level===Be.length-1),Bf=Bd,Bb=Be[Bd.level].supportsViewFilter;if(Bc){while(Bb&&Bf.parentEntity){Bf=Bf.parentEntity;Bb=Be[Bf.level].supportsViewFilter;}}return Bb;}function Aw(Be,Bc){var Bd,Bb;for(Bd=0,Bb=Be.length;Bd!==Bb;Bd++){if(!Ad(Be[Bd],Bc)){return false;}}return true;}function b(Bb,Bc){return Bc.map(function(Be,Bd){return{eid:Be,tid:Bb[Bd]};});}function BB(Bb){Bb=a.clone(Bb);this.dfs(this.root,function(Bc){var Be=Bc.colorByAttributeIds||[],Bf=Bc.colorByElementIds||[],Bd=b(Be,Bf);if(Ay.isEqualComb(Bd,Bb)){this.addToSelection(Bc);}}.bind(this));}function A4(){return{type:"metricColorByOpacity",model:this.observableModel.colorByOpacity};}function AC(){var Bb=this.edtModelCbInitSelection,Bj=this.getColorByElements(),Bg=this,Bh,Bf,Bd,Bc,Be,Bi;if(Bb===undefined||Bb.length===0){return ;}Bh=Bb.length;if(Bh>1){Bf=Bj[0];}else{Bd=a.clone(Bb[0]);Bc=AU.findInArray(Bj,function(Bk){return Ay.isEqualComb(Bd,a.clone(Bk.comb));});if(Bc===-1){return ;}Bf=Bj[Bc];}Be={color:Bf.color,opacity:Bf.opacity,showAutomatic:Bb.some(function(Bk){return AU.isColorManuallySet(Bg,Bk);})};Bi={onFillChanged:function(Bo,Bm){var Bn=Bo,Bk=Bn==="automatic",Bl;if(Bk){Bo="default";}else{Bo=Ay.encodeColor(Bo);}Bl=Bg.listenToUpdateColorMap(function(){var Bp="#ffffff",Bq=Bb.length;if(Bk){if(Bq===1){Bp=Ay.decodeColor(AU.getCombColor(Bg,Bf.comb));}if(Bm instanceof Function){Bm(Bp);}Bn=Bp;}Bg.raiseEvent({name:"colorByColorChange",type:"invalidateCache"});Bg.raiseEvent({name:"colorByColorChange",type:"fill",fill:Bn,showAutomatic:!Bk});Bg.detachUpdateColorMapListener(Bl);});Bg.updateColorMap(Bb,AU.repeat(Bo,Bb.length));},onOpacityChanged:function(Bk){Bg.updateColorByOpacity(Bb,AU.repeat(Bk,Bb.length));Bg.raiseEvent({name:"colorByColorChange",type:"opacity",opacity:Bk});}};Bb.forEach(BB.bind(this));this.refreshHighlights();return{type:"attributeColorBy",model:Be,callback:Bi};}function AN(){return{type:"headerFill",model:this.observableModel.headerColors,label:mstrmojo.desc(12105,"Header Fill")};}function o(Bl,Bu){var Bk=this.levelAttributes,Br=this,Bh=function(Bw){return Br.props.isHeaderOnTop&&Bw.level!==Bk.length-1;},Bb=Bh(Bl),Bp,Bg;if(this.props.isHeaderOnTop){var Bs=this.observableModel.fonts.headerOnTop;if(Bb){Bp=Bs.header;Bg="headerOnTop.header";}else{Bp=Bs.cell;Bg="headerOnTop.cell";}}else{Bp=this.observableModel.fonts.headerOnMiddle;Bg="headerOnMiddle";}var Bq=this.root;this.preorderTraverse(Bq,function(Bx){var By=Bx.labelDomNode;if(By&&Bh(Bx)===Bb){By._oldTextDecoration=By.style.textDecoration;By.style.textDecoration="underline";var Bz=By.parentNode.querySelector(".heatmap-label-square"),Bw=getComputedStyle(By).color;if(Bz){Bz.style.background=Bw;Bz.style.display="block";}}});var Bv=[];if(this.props.isHeaderOnTop&&Bl.entityChildren&&Bl.headerColor){Bv.push(AN.call(this));}if(!Bl.entityChildren&&this.isAttributeColorByType()){Bv.push(AC.call(this));}var Bd=this.props.labelSize===x.Proportional;if(this.props.isHeaderOnTop&&Bb){Bd=false;}Bv.push({type:"font",model:Bp,disableFontSize:Bd,modelPath:Bg});var Bj,Bo=Bu.e||Bu,Bt=AU.getMetricsInDropZone(this.zonesModel,A.ColorBy)[0]||null,Bf=this.isMetricColorByType()&&Bt;if(Bf&&!Bh(Bl)){var Bn=mstrmojo.ui.PopupConfig.ENUM_CORNERS;Bo={pageX:Bo.pageX,pageY:Bo.pageY-6};Bj={host:Bn.TOP_LEFT,popup:Bn.BOTTOM_LEFT};Bv.unshift(A4.call(this));}this.closePopup();this.showContextMenu(Bv,Bo,Bj);this._lastOpened.onClose=function(){Br.preorderTraverse(Bq,function(Bw){var Bx=Bw.labelDomNode;if(Bx&&Bh(Bw)===Bb){Bx.style.textDecoration=Bx._oldTextDecoration;Bx._oldTextDecoration=undefined;var By=Bx.parentNode.querySelector(".heatmap-label-square");if(By){By.style.display="none";}}});};if(Bf&&!Bh(Bl)){var Bm=this._lastOpened;this._lastOpened=null;var Bi=new mstrmojo.ui.menus.MenuConfig();Bi.addMenuItem(mstrmojo.desc(13174,"Select color ranges..."),"",function(){Br.model.openThresholdEditor(Bt,true,false);});this.showMenu(Bi,Bu);var Bc=this._lastOpened,Be=Bc._unlockHoverCheck;Bc._unlockHoverCheck=function(Bx,Bw){if(!AY.contains(Bm.domNode,AY.eventTarget(Bw,Bx),true)){Bc._unlockHoverCheck=Be;Bc._unlockHoverCheck(Bx,Bw);}};}this.raiseEvent({name:"formatclick",type:"format",formatValue:Bg});AU.selectPropertyPanel(this,"de");}function At(Bb){return function(Bd){var Be=R(Bd),Bc=this.getEntityByTouch(Be);if(this.isOnFormattingMode){Bb.call(this,Bc,Bd);}else{Af.call(this,Bd,Bb.bind(this,Bc));}};}function l(Bc){var Bb=this;Bb.showContextMenu({type:"background",model:Bb.observableModel.background,noOpacity:true,showNoFill:false},Bc);AU.selectPropertyPanel(Bb,0);}var U={};U[Aa.BACKGROUND]=function(Bb){if(this.isOnFormattingMode){l.call(this,Bb);}else{AQ.call(this,Bb);}};var Ak=At(o);U[Aa.RECTANGLE_LABEL]=Ak;U[Aa.RECTANGLE]=Ak;function G(){var Be=this.allSupportsViewFilter||Aw(this.previousSelected,this.levelAttributes),Bh=new mstrmojo.ui.menus.MenuConfig(),Bi=new mstrmojo.ui.menus.MenuConfig(),Bd={filter:Bh,showData:Bi};if(!Be){return Bd;}var Bc=AU.getDrillMenuItemsCallback.bind(AU,this),Bg=Q.call(this),Bb=Al.call(this),Bf;if(Bg){Bf=Bc(this.getMenuHandler("headerDrill"));}if(Bb){Bf=Bc(this.getMenuHandler("rectangleDrill"));}Bh.addMenuItem(mstrmojo.desc(11701,"Keep only"),"xt",this.getMenuHandler("keepOnly"));Bh.addMenuItem(mstrmojo.desc(3946,"Exclude"),"xt",this.getMenuHandler("exclude"));Bi.addMenuItem(mstrmojo.desc(13537,"Show Data..."),"xt",this.getMenuHandler("showData"));if(Bf&&Bf().hasMenuItems()){Bh.addPopupMenuItem(mstrmojo.desc(145,"Drill"),this.id,Bf,"xt");}else{Bh.addNonInteractiveMenuItem(mstrmojo.desc(145,"Drill"),"",true);}return Bd;}function i(){var Bb={};if(mstrApp.isAppStatePresentation()){return Bb;}var Bc=AV.call(this),Bh=Al.call(this),Bd=this.previousSelected,Bg=function(Bi){return Bi.label;},Be=this,Bf;if(Bc){Bf=this.getCellForNode(Bd[0]);Bb=AU.getGroupAndCalculationContextMenu(this,Bf,{skipSingleAttrCheck:true,selection:A9(Bd),fnCellName:Bg});}if(Bh){Bb=AU.getGroupAndCalculationContextMenuForDataPoints(this,{selection:Bd,fnCellName:Bg,fnUnique:function(Br){var Bl=[],Bq=Be.root,Bo=Br,Bp=Bo.length,Bn,Bm,Bj,Bs,Bi,Bk;while(Bp>0){if(Bp===1){Bm=Bo[0];while(Bm!==Bq){Bl.push(Bm);Bm=Bm.parentEntity;}Bp=0;}else{Bs=[];Bi={};for(Bn=0;Bn!==Bp;Bn+=1){Bm=Bo[Bn];Bj=Bm.parentEntity;Bk=Bm.id;if(!Bi.hasOwnProperty(Bk)){Bi[Bk]=true;Bl.push(Bm);}if(Bs.indexOf(Bj)===-1){Bs.push(Bj);}}Bo=Bs;Bp=Bo.length;}}return Bl;},fnMakeNode:function(Bi){return Bi;}});}return Bb;}function AJ(Bc,Bb){var Bd=Bc;if(!this.nf.validateFormat(Bd)){Bd="#,##0.00;(#,##0.00)";}return this.nf.formatByMask(Bd,Bb);}mstrmojo.heatmap.vi.VisHeatMap=mstrmojo.declare(mstrmojo.VisBase,[mstrmojo.util.ui._LassoSelector,mstrmojo.ui.menus._HasMenuPopup,mstrmojo._colorPalette,mstrmojo._VizSelectionHelper,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.heatmap.vi._SupportHeatmapBrushesAndHighlights,mstrmojo.heatmap.vi._HasHeatmapContextMenu,mstrmojo.vi._MonitorsAppState,mstrmojo.vi.ui.rw._XtabDE,mstrmojo.vi.ui._IsDropTarget,mstrmojo.gm._SupportDndAsBlackBox],{scriptClass:"mstrmojo.heatmap.vi.VisHeatMap",selectedStyle:"background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #058CF5), color-stop(1, #015DE6));color:#FFFFFF;",selectedClass:"",insertedStyles:[],LayoutProperties:{},normalizedIdCache:{},highlightBoxWidth:3,waitIconString:mstrmojo.desc("8445","Loading"),markupString:'<div id="{@id}" class="heatmap-{@themeType}-theme mil-{@themeType} gm-{@themeType}-theme" style="width:{@width}px;height:{@height}px; left:{@left}px; top:{@top}px; z-index: {@zIndex}; position:absolute;" mstrAttach:'+k.join(",")+'><div class="heatmap-canvas-outer-container" style="padding: {@LayoutProperties.Padding}px; height:{@heatMapSize.h}px; width:{@heatMapSize.w}px; left: {@heatMapSize.x}px;"><div id ="{@id}-heatmap-canvas-container" class="heatmap-canvas-container" style="left: {@LayoutProperties.Padding}px; top: {@LayoutProperties.Padding}px; height:{@heatMapSize.h}px; width:{@heatMapSize.w}px"><div style="z-index: 1;"><div></div><div style="width: {@heatMapSize.w}px; height: {@heatMapSize.h}px;"></div></div></div></div><div></div><div style="width: {@legendSize.w}px; height: {@legendSize.h}px"></div></div>',markupSlots:{canvasSlot:function(){return this.domNode.childNodes[0].childNodes[0].childNodes[0].childNodes[0];},highlightCanvasPlaceholder:function(){return this.domNode.childNodes[0].childNodes[0].childNodes[0].childNodes[1];},canvasContainer:function(){return this.domNode.childNodes[0].childNodes[0];},canvasOuterContainer:function(){return this.domNode.childNodes[0];},containerNode:function(){return this.domNode;},scrollNode:function(){return this.domNode.childNodes[0].childNodes[0].childNodes[0];},textSpan:function(){return this.domNode.childNodes[1];},infoBoxPuppet:function(){return this.domNode.childNodes[1];},attributeColorByLegendPlaceHolder:function(){return this.domNode.childNodes[2];}},onAppStateChange:function Ai(Bb){this._super(Bb);if(!this.selectorControl){this.removeAllSelections();this.clearSelections();}this.isOnFormattingMode=(Bb.value===mstrmojo.vi.VisualInsightApp.APP_STATES.FORMATTING);},getProperties:function(){var Bb=this.modelData;return(Bb&&Bb.vp)||{};},getPropsInfo:function(){return this.props||{};},init:function(Bd){this.props={};this.previousSelected=[];this._super(Bd);var Bc=document.createElement("canvas");var Bb=Bc.getContext;this.nf=mstrmojo.num;if(!Bb){this.browserSupportsHtml5=false;}else{this.browserSupportsHtml5=true;}this.HTML5PROPS={};if(!c){c=new mstrmojo.VisTooltip();c.render();}this.legendType=A8.VERTICAL;this.isOnFormattingMode=false;},update:function(Be){Ay.startTimer({functionName:"VisHeatMap.update",purpose:"JSON loading and consuming, generate the labels and colors"});var Bd=this._super(Be),Bb,Bf,Bc;if(Bd!==false){this.clearError();Bb=AU.getPropertyByPath(this,"model.data.egt");Bf=AU.getPropertyByPath(this,"model.data.eg");Bc=AU.getPropertyByPath(this,"model.data.err");if(Bb!==undefined||Bf!==undefined){this.setError(Bf,Bb);}if(Bc!==undefined){this.setError(Bc);}if(!this.browserSupportsHtml5){this.setError(mstrmojo.desc(8126,"Your browser does not support HTML5"));}this.modelData=this.model.data;if(!this.modelData){this.setError(mstrmojo.desc(8426,"No model provided"));}if(this.hasError()){Ay.endTimer();return Bd;}delete this.verticalLegendColorByElements;delete this.verticalLegendSizeByElements;delete this.colorByMetricThreshold;z.call(this);X.call(this);if(this.hasError()){Ay.endTimer();return Bd;}this.loadDefinedFormat();this.observableModel=this.addDisposable(Ap.call(this));this.refreshLabelInTree();this.refreshColorInTree();}Ay.endTimer();return Bd;},preBuildRendering:function(){if(this.hasError()||this.waitingForData){return ;}this._super();var Bc=this.getPropsInfo(),Bb=Bc.showLegend;if(Bb&&this.legendType===A8.VERTICAL){this.defaultsLegendPop=Au.call(this,(this.props.themeType==="light"?0:1));this.initHTML5Props(this.HTML5PROPS);}this.LayoutProperties=Az;this.zIndex=null;Ay.startTimer({functionName:"VisHeatMap.preBuildRendering",purpose:"layout of the rectangles"});if(Bb){if(this.isAttributeColorByType()||Bc.hasColorInThresholds){this.getVerticalLegendColorByInfo();}if(Bc.sizeMetricEnabled){this.getVerticalLegendSizeByInfo();}}this.setLayout();Ab.call(this);Ay.endTimer();},setModel:function I(Bb){this._super(Bb);this.listenToUpdateColorMap(this.refreshWidget);},setError:function(Bd,Bc){var Bb=AU.translateGridError(Bd,Bc);this.error=Bb.msg;this.errorType=Bb.type;},clearError:function(){this.error=undefined;this.errorType=undefined;},hasError:function(){return this.error!==undefined||this.errorType!==undefined;},isEmpty:function(){return this.hasError();},getVisEmptyMsgControls:function(){var Bc=this.error,Bb=this.errorType,Bd;if(!this.hasError()){return ;}switch(Bb){case BZ.NO_DATASET:case BZ.NO_TEMPLATE_UNIT:Bd=[{scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:Bc}];break;case BZ.AE_ERROR:Bd=[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:AU.getVisEmptyMsg("AE_ERROR"),markupSlots:{containerNode:function(){return this.domNode;}}}];break;default:Bd=[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:'<div class="{@cssClass}"><div class="error-content">'+Bc+"</div></div>",markupSlots:{containerNode:function(){return this.domNode;}}}];break;}return Bd;},postBuildRendering:function BY(){if(this.waitingForData){return ;}if(this.isEmpty()){if(AU.isOnExpressMode()){AU.renderWidgetErrorRSD(this,this.error,k);}else{this._super();}return ;}Ay.startTimer({functionName:"VisHeatMap.postBuildRendering",purpose:"Rendering of HeatMap"});this.initCanvas();this.renderLegend();this.hInitListeners();this.registerLassoSelector(this.canvasOuterContainer,[],false);this.lassoSelectorEnabled=true;var Bd=this.getExp(),Be=this.getRowsAndCols();AU.modifyScExp(Bd,Be,this.model,this.normalizedIdCache);var Bb=this._super();var Bc=this.previousSelected;if(Bc&&Bc.length>0){this.edtModelCbInitSelection=BU(Bc);}Ay.endTimer();return Bb;},hasSizebyOrColorby:function(){var Bb=this.getPropsInfo();return Bb.colorByType||Bb.sizeMetricID!==m;},hInitListeners:function(){var Bb=this.id;if(this.attributeColorByLegend){this.legendResizeListener=this.attributeColorByLegend.attachEventListener("gm-legend-resized",Bb,function(Bc){this.onLegendResized(Bc.position);});this.legendClickListener=this.attributeColorByLegend.attachEventListener("gm-legend-clicked",Bb,function(Bc){this.onLegendClicked(Bc);});}},onLegendResized:function(Bd){function Bb(){var Be=this.attributeColorByLegend;if(Be){this.hEvalSize4Legend();this.updateLegend();Be.updateAfterResize();this.updateCanvasAfterAttributeLegendChanged(AO[Be.currDockedPositionIdx].pos,this.legendW);}}function Bc(Bf,Be){if(Be){this.legendScale=Bf;this.legendResized=true;this.legendFixedW=undefined;Bb.call(this);}}if(this.attributeColorByLegend){this.legendFixedW=this.legendW+Bd;this.legendScale=(this.legendFixedW)/(this.legendW/this.legendScale);this.legendResized=true;this.writeGlobalAttriLegndProperty(A0.SCALE_LEGEND_WIDTH,this.legendScale,{success:Bc});Bb.call(this);}},onLegendClicked:function(Bb){var Bd=Bb.action,Bc=this.attributeColorByLegend,Be={success:function(){this.hEvalSize4Legend();this.updateLegend();this.updateCanvasAfterAttributeLegendChanged(AO[Bc.currDockedPositionIdx].pos,this.legendW);}};if(Bd==="close"){this.observableModel.showLegend.setValue(false);return ;}if(Bd==="minimize"){this.writeGlobalAttriLegndProperty(A0.LEGEND_MODE,Av.MINIMIZED,Be);}else{if(Bd==="restore"){this.writeGlobalAttriLegndProperty(A0.LEGEND_MODE,Av.RESTORED,Be);}}},unrender:function(){this.previousSelected=[];var Bc=AY.detachEvent,Bb=AY.TOUCHSTART;Bc(this._tn,Bb,this._tsCallback);this.hideInfoBox();if(this.attributeColorByLegend){this.attributeColorByLegend.unrender();delete this.attributeColorByLegend;}if(this.legendResizeListener){this.legendResizeListener.clear();}if(this.legendClickListener){this.legendClickListener.clear();}if(this.menuAnchor){document.body.removeChild(this.menuAnchor);this.menuAnchor=undefined;}this.destroyCanvas();this._super();},loadDefinedFormat:function(){if(this.defn&&this.defn.fmts){var Bb=this.defn.fmts;if(Bb["z-index"]){this.zIndex=Bb["z-index"];}}},refreshLabelInTree:function(){var Bb=function(Bd,Bc){if(Bd===this.root){return ;}Bd.text=this.getLabelForEntity(Bd);Bd.idx=Bc;};this.dfs(this.root,Bb,"");},getColorByAttrsByID:function(Bc,Bf,Be){var Bb=AU.isHierarchyObject(Bf)?"hid":"id",Bg=Bf.id,Bd="";BR.forEach(Bc,function(Bh){if(Bh[Bb]===Bg){Be.push(Bh.id);Bd+=(Bh.dn||Bh.n)+" ";}});return Bd;},getVerticalLegendColorByInfo:function(){if(this.isAttributeColorByType()){var Bv=this.attributeColorByElementsTemp;if(Bv===undefined){return ;}var Bq,Bp,Bj,Bm,Bd,Bk,Bl,Be,Bs,Bu,Br="",Bw=[],Bo=this.props.colorAttributes,Bc=Bo.length,Bf=Bv.length,Bt=this.modelData.dz.ColorBy.TemplateUnit,Bi,Bn=(Bt&&Bt.length)||0,Bb=[];for(Bq=0;Bq<Bn;Bq++){Bi=Bt[Bq];Br+=this.getColorByAttrsByID(Bo,Bi,Bb);}Br=Br.substring(0,Br.length-1);for(Bq=0;Bq<Bf;Bq++){Bd={};Bk="";Bl=[];Be=[];Bs=Bv[Bq];Bu=[];Bd.color=Bs.color.value;Bd.decodedColor=Bd.color;Bd.encodedColor=Ay.encodeColor(Bd.color);Bd.isDefaultColor=Bs.isDefaultColor;while(Bs&&Bs.parentEntity){if(this.props.colorAttributeIndexes.indexOf(Bs.level)!==-1){Bj=Bs.id.split(";")[1];Bu.push({id:Bj,text:Bs.label});Bl.splice(0,0,Bs.id);}Bs=Bs.parentEntity;}for(Bp=0;Bp<Bu.length;Bp++){Bm=BR.find(Bu,"id",Bb[Bp]);Bk=Bk+Bu[Bm].text+" ";}Bu=[];Bk=Bk.substring(0,Bk.length-1);Bd.label=Bk;for(Bp=0;Bp<Bc;Bp++){Be.push(Bo[Bp].id);}Bd.token={elements:Bl,levels:Be};Bw.push(Bd);}delete this.attributeColorByElementsTemp;this.verticalLegendColorByElements={item:Br,elements:Bw};}else{if(this.props.hasColorInThresholds){var Bh=this.getColorByMetricThreshold(),Bg;if(Bh){Bg=AU.getColorByTitle(this.getMetricName(this.colorMetricIndex),Bh.rankMode);this.verticalLegendColorByElements={item:Bg,elements:Bh.items};}else{this.verticalLegendColorByElements=undefined;}}}},getVerticalLegendSizeByInfo:function(){var Bh=BT.call(this);if(Bh.max===Infinity&&Bh.min===-Infinity){this.verticalLegendSizeByElements=undefined;return ;}var Bi=this.getFormatString(this.sizeMetricIndex);var Bg=[],Bf,Bc=Bh.min,Bd=Bh.max,Bk=(Bd-Bc)/4;for(Bf=0;Bf<5;Bf++){Bg.push(AJ.call(this,Bi,Bd-Bf*Bk));}var Bj={},Bb;var Be=this.getMetricName(this.sizeMetricIndex);if(Bh.hasNegativeValue){Be=BQ+Be;}Bj.item=Be;if(Bg.length>1){Bb=Bj.elements=[];BR.forEach(Bg,function(Bl){Bb.push({sign:"<",v:Bl});});if(Bb.length===5){Bb[0].sign="=";Bb[4].sign="=";}Bj.caseFlag=0;}if(Bg.length===1){Bj.elements=[{diameter:12,shape:"rect",sign:"=",v:Bg[0]}];Bj.caseFlag=2;}this.verticalLegendSizeByElements=Bj;},getHeaderColor:function(Bc){var Bb=a.clone(this.props.headerColors[Math.min(Bc.level,2)]);if(Bc.level!==0&&!this.props.isDefaultHeaderColor){Bb.opacity*=0.7;}return Bb;},refreshColorInTree:function(){var Be=[],Bd=[];var Bg=function(Bq){if(Bq===this.root){return ;}var Bo=this.props.colorAttributeIndexes,Bi=Bo[Bo.length-1];if(Bq.level===Bi){var Bk,Bp=Bo.length,Bl=this.modelData.gts.row,Bj,Br=[],Bn=[],Bs=[],Bm="";Bj=Bq;for(Bk=0;Bk<=Bi;Bk++){Br.splice(0,0,Bj);Bj=Bj.parentEntity;}for(Bk=0;Bk<Bp;Bk++){Bn.push(Bl[Bo[Bk]].id);Bm+=Br[Bo[Bk]].id+":";Bs.push(Br[Bo[Bk]].id);}if(Be.indexOf(Bm)===-1){this.attributeColorByElementsTemp.push(Bq);Be.push(Bm);}this.preorderTraverse(Bq,function(Bt){Bt.colorByAttributeIds=Bn;Bt.colorByElementIds=Bs;});}};if(this.isAttributeColorByType()){this.attributeColorByElementsTemp=[];this.preorderTraverse(this.root,Bg);}else{var Bb=this.modelData;if(this.props.colorMetricID!==m&&Bb.gsi.thresholds[this.props.colorMetricID]!==undefined){var Bh=Bb.gsi.thresholds[this.props.colorMetricID],Bf;for(Bf=0;Bf<Bh.length;Bf++){if(Bh[Bf].fmt&&Bh[Bf].fmt.bc){Bd[Bf]=Bh[Bf].fmt.bc;}else{Bd[Bf]=Ah.getCSSColorString(L);}}}}var Bc=function(Bm){if(Bm===this.root){return ;}var Bi,Bk=this.colorTheme,Bj=1,Bl,Bn,Bo;if(this.isAttributeColorByType()&&Bm.colorByAttributeIds&&Bm.colorByElementIds){Bn=Bm.colorByAttributeIds;Bo=Bm.colorByElementIds;Bl=this.model.docModel.getColorBy(Bn,Bo);Bi=Ay.decodeColor(Bl.color);Bj=BC.call(this,Bn,Bo)/100;Bm.isDefaultColor=!Bl.isManual;}else{if(this.props.colorMetricID!==m&&Bd.length>0&&Bm.thrColorIndex>=0){Bi=Ah.getCSSColorString(Bd[Bm.thrColorIndex]);Bj=this.getPropsInfo().metricColorByOpacity;}else{Bi=Ah.getCSSColorString(L);}}Bm.color={value:Bi,opacity:Bj};if(this.props.isHeaderOnTop){Bm.headerColor=this.getHeaderColor(Bm,Bk.style==="light");}};this.dfs(this.root,Bc,"");},dfs:function(Bd,Bg,Be){if(!Bd||Bd.deleted){return ;}if(Be===undefined){Bg.call(this,Bd);}else{Bg.call(this,Bd,Be);}if(Bd.entityChildren===undefined){return ;}var Bb=Bd.entityChildren,Bc=Bb.length,Bf;for(Bf=0;Bf<Bc;Bf++){var Bh=Bb[Bf];if(Be===undefined){this.dfs(Bh,Bg);}else{var Bi=Be;if(!Bi){Bi=Bf.toString();}else{Bi=Bi+":"+Bf;}this.dfs(Bh,Bg,Bi);}}},preorderTraverse:function(Bc,Bg){if(Bc){var Bd=Bg.call(this,Bc);if(Bd===false){return ;}var Bf=Bc.entityChildren||[],Bb=Bf.length,Be;for(Be=0;Be<Bb;Be++){this.preorderTraverse(Bf[Be],Bg);}}},getSingleBackgroundColor:function(){return this.background&&this.background.value&&(this.background.value.c1||this.background.value);},initCanvas:function(){var Bc=this,Bb=BE.call(this);this.destroyCanvas();this.addChildren(new mstrmojo.heatmap.vi.VisHeatMapCanvas(Bb));this.highlightCanvas=this.canvasObject.addDisposable(new mstrmojo.heatmap.vi.VisHeatMapHighlightCanvas({placeholder:this.highlightCanvasPlaceholder,isOnSelectionMode:function(){return Bc.previousSelected.length>0;},themeType:this.props.themeType,backgroundColor:this.getSingleBackgroundColor()}));this.highlightCanvas.render();this.highlightCanvas.parent=this;},destroyCanvas:function BO(){var Bb=this.canvasObject;if(Bb){this.highlightCanvas=null;this.removeChildren(Bb);Bb.destroy();}},scaleFactor:1,renderRectangles:function(){this.canvasObject.clearFontCache();this.refreshLabelInTree();this.refreshColorInTree();this.canvasObject.isHeaderOnTop=this.props.isHeaderOnTop;this.canvasObject.render();},renderLegend:function BL(){if(!this.props.showLegend){if(this.attributeColorByLegendPlaceHolder){this.attributeColorByLegendPlaceHolder.style.display="none";}return ;}if(!this.attributeColorByLegend){var Bd=this;var Bc=this.canvasObject.addDisposable(new BP.GMLegend({widget:this,model:this.model,placeholder:this.attributeColorByLegendPlaceHolder,currDockedPositionIdx:AP(this.readGlobalAttriLegndProperty(A0.LEGEND_POSITION)),cutBy:this.legendCutBy,cssClass:"gm-legend",styles:this.HTML5PROPS.LEGEND,readGlobalProperty:function(Be){return Bd.readGlobalAttriLegndProperty(Be);},writeGlobalProperty:function(Be,Bf){if(Be===BD.LEGEND_BG_COLOR){Bd.observableModel.legendBackground.value.setValue(Ay.decodeColor(Bf));}else{if(Be===BD.LEGEND_BG_FILL_TRANSPARENCY){Bd.observableModel.legendBackground.opacity.setValue(Bf/100);}else{if(Bd.observableModel[Be]){Bd.observableModel[Be].setValue(Bf);}else{Bd.writeGlobalAttriLegndProperty(Be,Bf,{success:function(){Bd.reRender();}});}}}},configureLegendPopup:function(Be,Bf){return Bd.configureAttriLegendPopup(Be,Bf);}}));Bc.render();Bc.parent=this;this.attributeColorByLegend=Bc;this.attributeColorByLegendPlaceHolder=Bc.domNode;}else{var Bb=this.attributeColorByLegend;Bb.currDockedPositionIdx=AP(this.readGlobalAttriLegndProperty(A0.LEGEND_POSITION));this.initHTML5Props(this.HTML5PROPS);Bb.updateStyle(this.HTML5PROPS.LEGEND);Bb.updateTitleLineHeight();this.hEvalSize4Legend();this.updateLegend();Bb.updateSplitter();this.updateCanvasAfterAttributeLegendChanged(AO[Bb.currDockedPositionIdx].pos,this.legendW);}this.attributeColorByLegend.cutBy=this.legendCutBy;this.attributeColorByLegend.minHeight=this.legendMinHeight;this.attributeColorByLegend.updateContainerSize(this.getWidth(),this.getHeight());this.attributeColorByLegend.feedData([{dataType:A7.COLOR_BY,dataObj:this.verticalLegendColorByElements},{dataType:A7.SIZE_BY,dataObj:this.verticalLegendSizeByElements}],(this.readGlobalAttriLegndProperty(A0.LEGEND_MODE)===Av.MINIMIZED));},getColorByMetricThreshold:function(){if(!this.props.hasColorInThresholds){return undefined;}var Bg;if(this.colorByMetricThreshold){Bg=this.colorByMetricThreshold;}else{var Bd=this.modelData,Bh=Bd.gsi.mx,Bb=this.props.colorMetricID,Bi={max:"",min:""},Bf,Bc;BR.forEach(Bh,function(Bk){if(Bk.did===Bb){Bi=Bk;return false;}});if(Bi.max===""&&Bi.min===""){this.colorByMetricThreshold=undefined;return ;}if(Bd.gsi.thresholds[Bb]&&Bi){var Bj,Be;Bj=Bd.gsi.thresholds[Bb];Bf=AU.getRankMode(Bj);Be=AU.getColorByFormatStr(this.getFormatString(this.colorMetricIndex),Bf);Bc=AU.getColorByItems(Bj,Bf,Bi.max,Bi.min,Bi.cnt,Be,Ah.getCSSColorString(L));Bc.sort(function(Bl,Bk){var Bm;if(Bl.ceil>Bk.ceil){Bm=1;}else{if(Bl.ceil===Bk.ceil){Bm=0;}else{Bm=-1;}}return Bm;});}else{if(Bi){Bc=AU.getDefaultColorByItems(Ah.getCSSColorString(L),Bi.max,Bi.min);}else{Bc=AU.getDefaultColorByItems(Ah.getCSSColorString(L),1,0);}Bf=AL.VALUE;}Bg={rankMode:Bf,items:Bc};this.colorByMetricThreshold=Bg;}return Bg;},render:function(Bb){if(this.hasRendered&&this.unrender){this.unrender();}this._super(Bb);},reRender:function Aj(){if(this.hasError()){return ;}this._super();},loadDeleteStatus:function(Bf,Bb){if(!Bf.entityChildren){if(Bb===T.dftDel||Bb===T.usrDel){Bf.deleted=true;}else{delete Bf.deleted;}return ;}if((!Bb||Object.keys(Bb).length===0)&&!Bf.hasChildDeleted){return ;}var Be=Bf.entityChildren,Bd;for(Bd=0;Bd<Be.length;Bd++){var Bh=Be[Bd];var Bc=this.getEntityDisplayName(Bh);var Bg=Bb&&Bb[Bc];this.loadDeleteStatus(Bh,Bg);}},getFormatString:function Ae(Be){var Bd=this.modelData,Bf=Bd.nf||[],Bc=Bf.length,Bb;if(Be>=0&&Be<Bc){Bb=AU.getNumberFormat(Bd,Be);return Bb.replace(/\'/g,'"');}return"";},checkMetricValid:function AB(Bc){var Bb=this.modelData,Bd=Bb.ghs.chs.items,Be=Bd[0]?Bd[0].items.length:0;return !(Bc<0||Bc>=Be);},getMetricName:function BJ(Bi){var Bh="",Be=this.modelData,Bd=Be.ghs.chs.items,Bc=Bd.length,Bj=Be.gts.col,Bf;if(!this.checkMetricValid(Bi)){return m;}for(Bf=0;Bf<Bc;Bf++){var Bg=Bd[Bf].items[Bi].idx;var Bb=Bj[Bf].es[Bg].n;Bh+=Bb+" ";}return Bh.slice(0,Bh.length-1);},getEntityDisplayName:function AX(Bi){var Bb=Bi.level,Bf=(Bi.index===undefined)?Bi.indices[0]:Bi.index,Bn=0,Bk="",Bd=this.attSpan,Bh=this.modelData.ghs.rhs.items,Bg=Bh[Bf].items,Bj=this.modelData.gts.row[Bb],Be,Bc,Bm=[];for(Be=0;Be<Bb;Be++){Bn+=!!this.modelData.gts.row[Be].cs?this.modelData.gts.row[Be].cs:Bd[Be];}for(Be=Bn;Be<Bn+Bd[Bb];Be++){var Bl=Bg[Be].idx;if(Bl===-1){continue;}Bc=Bj.es[Bl];if(Bm.indexOf(Bc)===-1){Bk+=Bc.n+" ";Bm.push(Bc);}}Bk=Bk.substring(0,Bk.length-1);return Bk;},previousTooltip:null,previousSelected:[],drawHighlight:function(Bb){if(!Bb){return null;}var Bf=Bb===this.previousTooltip,Bc=this.props.isHeaderOnTop,Bd=Bb.headerSize||Bb.size,Be=!!Bb.entityChildren,Bg=this.highlightCanvas;Bg.highlight(Bd,Bb.labelDomNode,{isHovered:Bf,isSelected:this.previousSelected.indexOf(Bb)!==-1,isEntityContainer:Be,isHeaderOnTop:Bc});return Bd;},updateEntityHighlight:function(Bb){if(!Bb){return ;}this.drawHighlight(Bb);var Be=Bb===this.previousTooltip,Bc=this.props.isHeaderOnTop,Bf=this.highlightCanvas;if(!Bc){var Bd=function(Bg,Bh){while(Bh){Bh=Bh.parentEntity;if(Bh===Bg){return true;}}return false;};(this.previousSelected||[]).forEach(function(Bg){if(Bd(Bb,Bg)){Bf.highlight(Bg.size,Bg.labelDomNode,{isHovered:Be,isSelected:true,isEntityContainer:!!Bg.entityChildren,isHeaderOnTop:false});}});}},refreshHighlights:function(Bb){if(!this.highlightCanvas){return ;}Bb=Bb||this.previousSelected||[];if(!this.props.isHeaderOnTop){Bb.sort(function(Bd,Bc){var Bf=Bd.level,Be=Bc.level;if(Bf<Be){return -1;}else{if(Bf>Be){return 1;}else{return 0;}}});}this.highlightCanvas.clear();Bb.forEach(this.drawHighlight,this);},getLowestLevelRectangle:function(Bd){var Bc=document.elementFromPoint(Bd.pageX,Bd.pageY);var Bb=[];while(!this.isLowestLevelRectangle(Bc)){Bc.style.display="none";Bb.push(Bc);Bc=document.elementFromPoint(Bd.pageX,Bd.pageY);}while(Bb.length){Bb.pop().style.display="block";}return Bc;},areaSelect:function(Bd,Be){var Bb=this.previousSelected.slice();if(!Be.ctrlKey){this.removeAllSelections();}this.preorderTraverse(this.root,function(Bg){if(Bg===this.root||!Bg.size){return ;}if(!Bg.entityChildren&&!isNaN(Ac(Bg.size,Bd).x)){this.addToSelection(Bg);return false;}});this.doSelection();this.refreshHighlights();if(!M(Bb,this.previousSelected)){A6.call(this,this.previousSelected);}var Bf,Bc=this.previousSelected;if(Bc&&Bc.length>0){Bf=AY.position(this.canvasObject.domNode,true);this._toolbarContext={type:Aa.RECTANGLE,pos:{e:{pageX:Bd.x+Bf.x,pageY:Bd.y+Bf.y},getTarget:function(){return undefined;}},entity:Bc[0]};}},getEntityByTouch:function(Bh,Bn){var Bk=this.getElementBehindCurtains(Bh.evt);if(!Bk){return null;}var Bf=Bh.pageX,Bd=Bh.pageY;if(Bn){var Bb=Bk,Bm=[];while(Bk!==this.domNode&&Bk.tagName.toLowerCase()!=="img"){Bm.push(Bk);Bk.style.visibility="hidden";Bk=document.elementFromPoint(Bf,Bd);if(!Bk||Bk===Bb){break;}Bb=Bk;}while(Bm.length>0){var Bc=Bm.pop();Bc.style.visibility="visible";}}if(!Bk){return null;}var Be;if(Bk!==this.domNode){if(Bk.getAttribute("idx")&&!Bn){Be=this.getIdxObjectByTarget(Bk);}else{var Bl=AY.position(this.canvasObject.domNode,true),Bj=Bf-Bl.x,Bg=Bd-Bl.y;var Bi={x:Bj,y:Bg};Be=this.canvasObject.getEntity(Bi);}}return Be;},getLabelForEntity:function(Bf){if(!this.props.showMetricValues||Bf.entityChildren!==undefined){return this.getEntityDisplayName(Bf);}var Be=this;var Bd=AS(this,Bf);var Bb=Bd.map(function(Bg){return A3(Bf,Be,Bg).v;});Bb.unshift(this.getEntityDisplayName(Bf));var Bc="<span>"+Bb.join("<br>")+"</span>";return Bc;},lassoSelecting:function(){BM.removeClass(this.lassoSelector,"lasso-selector-hasContent");},lassoSelected:function(Bb){this.areaSelect({x:Bb.left,y:Bb.top,w:Bb.width,h:Bb.height},Bb);if(this.previousSelected.length){BM.addClass(this.lassoSelector,"lasso-selector-hasContent");}},lassoSelectorResized:function(Bb){this.lassoSelecting();this.lassoSelected(Bb);},configurePopup:function(Bb,Bc){Bb.hostId=this.id;Bb.hostElement=Bc;},showMenu:function(Be,Bb){var Bd=this.menuAnchor,Bc;if(!Bd){Bd=document.createElement("div");Bd.id=this.id+"-hm-menu-anchor";Bd.style.position="absolute";document.body.appendChild(Bd);this.menuAnchor=Bd;}Bc=Bd.style;Bc.left=Bb.pageX+"px";Bc.top=Bb.pageY+"px";this.configurePopup(Be,Bd);this.openPopup(Be.newInstance());},getSelectionMenuConfig:function(){var Bb=AU.mergeHashes(G.call(this),i.call(this)),Bc=[{name:"filter"},{name:"editGroup"},{name:"editCalculation"},{name:"createDe"},{name:"showData"},{name:"renameDe"}];return AU.mergeMenuConfigs(Bb,Bc);},getBlankSpaceMenuConfig:function(Bg){var Bc=new mstrmojo.ui.menus.MenuConfig(),Be=this,Bd=Be.props;Bc.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",function(){l.call(Be,Bg);});if(this.hasSizebyOrColorby()){if(!Bd.showLegend){var Bf=mstrmojo.desc(12001,"Show Legend"),Bb="showLegend";Bc.addMenuItem(Bf,"xt",this.getMenuHandler(Bb));}}return Bc;},keepOnly:function(){this.updateAfterKeepOnly(true);},exclude:function(){this.updateAfterKeepOnly(false);},getMenuHandler:function(Bc){var Bl=this._super(Bc);if(Bl!==mstrmojo.emptyFn){return Bl;}var Bh=this,Be={keepOnly:function Bg(){Bh.keepOnly();Bh.noHighlightAfterKeepOnlyExcludeDrill=true;},exclude:function Bj(){Bh.exclude();Bh.noHighlightAfterKeepOnlyExcludeDrill=true;},showData:function Bd(){Bh.showData();},rectangleDrill:function Bf(Bm){AU.doDrill(Bh,Bm.ctxt.drillUnit,As,{headerDrill:false});Bh.noHighlightAfterKeepOnlyExcludeDrill=true;},headerDrill:function Bk(Bm){AU.doDrill(Bh,Bm.ctxt.drillUnit,As,{headerDrill:true});Bh.noHighlightAfterKeepOnlyExcludeDrill=true;},showLegend:function Bi(){Bh.observableModel.showLegend.setValue(true);},hideLegend:function Bb(){Bh.observableModel.showLegend.setValue(false);}};if(Be.hasOwnProperty(Bc)){return Be[Bc];}return mstrmojo.emptyFn;},isClearAllEnabled:function(Bf){var Bc=this.modelData||{},Be=AU.getPropertyByPath(Bc,"gts.row",[]),Bb,Bg,Bh=Bc.sc,Bd;if(Bf){Bd=Bf.id||"";Bb=AU.findInArray(Be,function(Bi){return Bd.indexOf(Bi.id)!==-1;});if(Bb!==-1){Bg=Be[Bb];Bh=Bg.sc||Bh;}}return !!(Bh===undefined||Bh.showall);},addToSelection:function(Bb){var Bc=this.previousSelected||[];if(Bc.indexOf(Bb)===-1){Bc.push(Bb);}},removeFromSelection:function(Bb){var Bd=this.previousSelected||[],Bc=Bd.indexOf(Bb);if(Bc!==-1){Bd.splice(Bc,1);return true;}return false;},removeAllSelections:function(Bc){var Bb=(this.previousSelected||[]).slice();this.previousSelected=[];if(!Bc&&Bb.length>0){this.raiseEvent({name:"selectionBatchRemove",entities:Bb});}return Bb;},onclick:function(Bq,Bf){delete this.noHighlightAfterKeepOnlyExcludeDrill;if(!Bf){this.dismissLassoSelector();}var Bs=Bq.getTarget(),Bc=false,Bk=false,Bg=false,Bo=false,Bi,Bp,Bm,Br,Be,Bb,Bn,Bt=Al.call(this),Bd=Q.call(this),Bj;if(this.isRectangle(Bs)){Bi=this.getEntityByTouch(R(Bq));if(Bi){Bj=Bi.level===this.levelAttributes.length-1;Bm=this.previousSelected;Bp=Bm.length;Br=Bp===0;Be=Bm.indexOf(Bi)!==-1;Bb=Bq.e.ctrlKey||Bq.e.metaKey;Bn=Bp>1;if(Be&&!Bn){if(!Bf&&this.isClearAllEnabled(Bi)){Bk=true;this.removeAllSelections();}}if((Be&&!Bb&&Bn&&!Bf)||(!Be&&!Bb)||(Bt^Bj&&!Be&&Bb)||(!(Bt||Bd)&&Be)){Bk=true;Bg=true;this.removeAllSelections();this.addToSelection(Bi);}if(!Be&&Bb){Bg=true;this.addToSelection(Bi);}if(Be&&Bb&&Bn){if(!Bf){Bo=true;this.removeFromSelection(Bi);}}Bk=Bk||Br===(this.previousSelected.length>0);if(Bk){this.highlightCanvas.clear();}if(Bg||Bo){this.updateEntityHighlight(Bi);}if(Bk||Bg||Bo){this.doSelection();Bc=true;}if(!Be){this.dismissLassoSelector();}}}var Bh=this.getComponentType(Bq),Bl;if(!Bf){if(Bh.type===Aa.BACKGROUND||Bh.type===Aa.LEGEND_BACKGROUND){Bl=(this.previousSelected||[]).filter(this.isClearAllEnabled,this);if(Bl.length>0){Bl.forEach(function(Bu){this.removeFromSelection(Bu);},this);this.doSelection();Bc=true;this.refreshHighlights(Bl);this.refreshHighlights();}}}if(this.attributeColorByLegend){this.attributeColorByLegend.hideToolbar();}if(Bc){A6.call(this,this.previousSelected);}this._toolbarContext={type:Bh.type,pos:Bq};},getElementBehindCurtains:function(Bd){var Bb=[this.highlightCanvas.domNode,this.lassoSelector];BR.forEach(Bb,function(Be){Be._visibility=Be.style.visibility;Be.style.visibility="hidden";});var Bc=document.elementFromPoint(Bd.e.pageX,Bd.e.pageY);BR.forEach(Bb,function(Be){Be.style.visibility=Be._visibility;Be._visibility=undefined;});return Bc;},getComponentType:function(Be){var Bc;var Bd=this.getElementBehindCurtains(Be);if(this.isRectangle(Bd)){if(Bd.getAttribute("idx")||(Bd.tagName==="SPAN"&&Bd.parentNode.getAttribute("idx"))){Bc=Aa.RECTANGLE_LABEL;}else{var Bb=this.getEntityByTouch(R(Be));if(Bb){Bc=Aa.RECTANGLE;}else{Bc=Aa.BACKGROUND;}}}else{if(this.attributeColorByLegend.domLegend===Bd){Bc=Aa.LEGEND_BACKGROUND;}else{if(Bd===this.domNode){Bc=Aa.BACKGROUND;}}}return{type:Bc,target:Bd};},isRectangle:function(Bb){return AY.contains(this.canvasObject.domNode,Bb,true)||AY.contains(this.highlightCanvas.domNode,Bb,true)||AY.contains(this.lassoSelector,Bb,true);},isLowestLevelRectangle:function(Bb){return Bb.getAttribute&&Bb.getAttribute("idx")&&!(Bb.innerHTML);},toggleSelectAll:function(Bb){var Bc=this.modelData.gts.row[Bb.level].sc;if((Bc&&Bc.all!=="false"&&Bc.all!==false)||!this.hasGridTarget){this.selectAll=!this.selectAll;return true;}return false;},doSelection:function(){this.prepareSelectedNodesInfo();this.endSelections();},getObjectByIdx:function(Bb){if(Bb){var Bc=Bb.split(":");var Be=this.root,Bd;for(Bd=0;Bd<Bc.length;Bd++){Be=Be.entityChildren[Bc[Bd]];}return Be;}return null;},setColorByType:function(Bb){if(Bb==="attribute"){this.props.colorByType="attribute";this.colorTheme.colorByType="attribute";}else{this.props.colorByType="metric";delete this.colorTheme.colorByType;}},clearChildren:function(Bb){if(!Bb){return ;}while(Bb.firstChild){Bb.removeChild(Bb.firstChild);}},setLayout:function BS(Bb){var Be=parseInt(this.width,10),Bc=parseInt(this.height,10),Bf=this.LayoutProperties.Padding,Bg=Be-2*Bf,Bi=Bc-2*Bf,Bd=0;if(!this.legendSize){this.legendSize={};}var Bh=this.legendSize;if(this.props.showLegend){if(this.legendType===A8.VERTICAL){if(!Bb){if(this.attributeColorByLegend){Bb=AO[this.attributeColorByLegend.currDockedPositionIdx].pos;}else{Bb=this.readGlobalAttriLegndProperty(A0.LEGEND_POSITION);}}this.hEvalSize4Legend();Bh.w=this.legendW;Bh.h=this.legendH;Bg-=Bh.w;if(!this.isOnRight(Bb)){Bd=Bh.w;}}}this.heatMapSize={x:Bd,y:0,w:Bg,h:Bi};this.maxScale=10;},hEvalSize4Legend:function(){var Bf,Bd=this.verticalLegendColorByElements,Bc=this.verticalLegendSizeByElements,Be=this.getWidth(),Bb=this.getHeight(),Bg=this.HTML5PROPS.LEGEND,Bh;if(this.props.showLegend===false){this.legendW=this.legendH=this.legendP=0;}else{V.applyHTML5Props(Bg);this.legendP=s;if(!this.legendScale){Bh=this.readGlobalAttriLegndProperty(A0.SCALE_LEGEND_WIDTH);if(Bh){this.legendScale=Bh;this.legendResized=true;}}Bf=V.getLegendSize([{dataType:A7.COLOR_BY,dataObj:Bd},{dataType:A7.SIZE_BY,dataObj:Bc}],this.legendResized?this.legendScale:undefined,Be,Bb,Bg,this.legendFixedW);this.legendCutBy=Bf.cutBy;this.legendMinHeight=Bf.minHeight;this.legendFixedW=Bf.width;if(Bf.scale){this.legendScale=Bf.scale;}if(this.readGlobalAttriLegndProperty(A0.LEGEND_MODE)===Av.MINIMIZED||Bf.autoCollapse){Bf=V.getLegendSize4MinMode(Bd,Bb);this.legendCutBy=undefined;}this.legendW=Bf.width;this.legendH=Bf.height;}},applyLayout:function(){if(this.heatMapSize){if(this.canvasOuterContainer){var Bb=this.canvasOuterContainer.style;Bb.left=this.heatMapSize.x+"px";Bb.top=this.heatMapSize.y+"px";Bb.width=this.heatMapSize.w+"px";Bb.height=this.heatMapSize.h+"px";}if(this.canvasContainer){var Bd=this.canvasContainer.style;Bd.width=this.heatMapSize.w+"px";Bd.height=this.heatMapSize.h+"px";}if(this.canvasObject){var Bc=this.canvasObject;Bc.width=this.heatMapSize.w;Bc.height=this.heatMapSize.h;}}},refreshWidget:function(){var Bb=BE.call(this);a.copy(Bb,this.canvasObject);this.setLayout();this.applyLayout();Ab.call(this);this.renderRectangles();this.refreshHighlights();if(this.props.showLegend){if(this.isAttributeColorByType()||this.props.hasColorInThresholds){this.getVerticalLegendColorByInfo();}if(this.props.sizeMetricEnabled){this.getVerticalLegendSizeByInfo();}}this.renderLegend();},hideInfoBox:function(){var Bc=c.domNode;if(Bc&&Bc.parentNode){var Bb=this.previousTooltip;this.previousTooltip=undefined;this.updateEntityHighlight(Bb);Bc.parentNode.removeChild(Bc);}},getIdxObjectByTarget:function(Bd){var Bc=AY.findAncestorByAttr(Bd,"idx",true,this.domNode);var Bb=Bc&&Bc.value;if(!Bb){return null;}return this.getObjectByIdx(Bb);},showInfoBox:function(Bc,Bf){if(!Bc){return ;}c.toggle(true);if(Bc===this.previousTooltip){c.moveTo(Bf.x,Bf.y);return ;}var Be=this.previousTooltip;this.previousTooltip=Bc;this.updateEntityHighlight(Be);this.updateEntityHighlight(Bc);var Bb=Bc.headerSize||Bc.size;if(!Bb||isNaN(Bb.x)){return ;}var Bd=AH(Bc,this);if(Bd){if(!c.domNode.parentNode){document.body.appendChild(c.domNode);}c.displayInfo(Bd,Bf);}},onmousedown:function(){this._isMouseDown=true;},onmousemove:function(Bd){if(!this._isMouseDown){var Be=R(Bd);var Bc=Be.target;if(!Bc||!this.isRectangle(Bc)){return ;}var Bb=this.getEntityByTouch(Be);if(Bb){this.showInfoBox(Bb,{x:Bd.e.pageX,y:Bd.e.pageY});}}},onmouseup:function(){delete this._isMouseDown;},onmouseout:function AG(Bd){var Bc=this.canvasContainer,Bb=Bd.e.toElement||Bd.e.relatedTarget;if(!AY.contains(Bc,Bb,true)){this.hideInfoBox();}},oncontextmenu:function Ar(Bb){this.onclick(Bb,true);this.hideInfoBox();var Bc=this.getComponentType(Bb),Be=U[Bc.type];if(Be){Be.call(this,Bb,Bc.target);Bb.cancel();}if(this.attributeColorByLegend){var Bf=Bb.getTarget(),Bd=this.attributeColorByLegend;if(AY.contains(Bd.domNode,Bf,true)){Bd.handleRMCOnLegend(Bb);}else{Bd.hideToolbar();}}Bb.preventDefault();return false;},destroy:function(Bc){var Bb=this.attributeColorByLegend;if(Bb){Bb.hideToolbar();}this._super(Bc);},readGlobalAttriLegndProperty:function P(Bd){var Bc=this.props,Bb,Be;switch(Bd){case BD.LEGEND_BG_COLOR:Be=Bc.lgdBgFillClr;break;case BD.LEGEND_BG_FILL_STYLE:Be=Bc.lgdBgFillStyle;break;case BD.LEGEND_BG_FILL_EFFECT:Be=Bc.lgdBgFillEff;break;case BD.LEGEND_BG_FILL_TRANSPARENCY:Be=Bc.lgdBgFillTrans;break;case BD.LEGEND_FONT_SIZE:Be=Bc.lgdFntSz;break;case BD.LEGEND_FONT_FAMILY:Be=Bc.lgdFntFml;break;case BD.LEGEND_FONT_STYLE:Be=Bc.lgdFntStyle;break;case BD.LEGEND_FONT_COLOR:Be=Bc.lgdFntClr;break;case BD.LEGEND_BORDER_SHOW:Be=Bc.lgdBdrShw;break;case BD.LEGEND_BORDER_COLOR:Be=Bc.lgdBdrClr;break;case BD.LEGEND_BORDER_THICKNESS:Be=Bc.lgdBdrThk;break;case BD.LEGEND_BORDER_LINE_STYLE:Be=Bc.lgdBdrStyle;break;case BD.COLOR_SQUARE_COLOR:Bb=this.colorSqureIdentity;if(Bb){Be={color:Bb.decodedColor,isDefaultColor:Bb.isDefaultColor};}else{Be={color:"#0000FF",isDefaultColor:true};}break;case A0.LEGEND_MODE:Be=Bc.lm;break;case A0.LEGEND_POSITION:Be=Bc.LegendPosition;break;case A0.SCALE_LEGEND_WIDTH:Be=Bc.lwr;break;}if(Be===undefined||((typeof Be)==="number"&&isNaN(Be))){Be=this.defaultsLegendPop&&this.defaultsLegendPop[Bd];}return Be;},initHTML5Props:function(Be){var Bc=Be.LEGEND={},Bd=function(Bg,Bf){Bg.fontWeight=(Bf&H.FS_BOLD?"bold":"normal");Bg.fontStyle=(Bf&H.FS_ITALIC?"italic":"normal");if((Bf&H.FS_STRIKETHROUGH)&&(Bf&H.FS_UNDERLINE)){Bg.textDecoration="line-through underline";}else{if(Bf&H.FS_STRIKETHROUGH){Bg.textDecoration="line-through";}else{if(Bf&H.FS_UNDERLINE){Bg.textDecoration="underline";}else{Bg.textDecoration="none";}}}},Bb=function(Bf){var Bg=["solid","dashed","dotted"];return Bg[Bf]||"none";};Bc.fontFamily=this.readGlobalAttriLegndProperty(BD.LEGEND_FONT_FAMILY);Bc.fontSize=this.readGlobalAttriLegndProperty(BD.LEGEND_FONT_SIZE);Bd(Bc,this.readGlobalAttriLegndProperty(BD.LEGEND_FONT_STYLE));Bc.color=Ay.decodeColor(this.readGlobalAttriLegndProperty(BD.LEGEND_FONT_COLOR));Bc.backgroundColor=Ay.decodeColor(this.readGlobalAttriLegndProperty(BD.LEGEND_BG_COLOR));Bc.opacity=this.readGlobalAttriLegndProperty(BD.LEGEND_BG_FILL_TRANSPARENCY)/100;if(this.readGlobalAttriLegndProperty(BD.LEGEND_BORDER_SHOW)){Bc.borderWidth=this.readGlobalAttriLegndProperty(BD.LEGEND_BORDER_THICKNESS);Bc.borderStyle=Bb(this.readGlobalAttriLegndProperty(BD.LEGEND_BORDER_LINE_STYLE));Bc.borderColor=Ay.decodeColor(this.readGlobalAttriLegndProperty(BD.LEGEND_BORDER_COLOR));}},configureAttriLegendPopup:function q(Bb,Bc){Bb.hostId=this.id;Bb.hostElement=Bc;},writeGlobalAttriLegndProperty:function(Bc,Bd,Bf){var Bb=!!(Bf&&Bf.success),Be=function(Bi,Bh){var Bg=this.props;Bg.unmarshal(Bc,Bi);if(Bb){Bf.success.call(this,Bg[Bc],Bh);}};if(Bc===BD.COLOR_SQUARE_COLOR){this.props.unmarshal(Bc,Bd);this.setProperty(Bc,Bd,{callback:Bf});}else{Be.call(this,Bd,false);this.setProperty(Bc,this.props.marshal(Bc),{suppressData:true,clientUndoRedoCallback:Bb?Be:undefined});}},onLegendDropZoneChange:function g(Bb,Bc){this.setLegendSlot(Bb,Bc);},onLegendDropped:function(Bb){this.writeGlobalAttriLegndProperty(A0.LEGEND_POSITION,Bb,{success:function(Bd,Bc){if(Bc){this.renderLegend();this.updateCanvasAfterAttributeLegendChanged(Bd,this.legendW);}}});},setLegendSlot:function(Bc,Bf){var Be=this.attributeColorByLegend.currDockedPositionIdx,Bg=this.canvasOuterContainer;if(Bf!==Be){var Bb=this.isOnRight(AO[Be].pos),Bd=this.isOnRight(Bc.pos);if(Bb!==Bd){Bg.style.left=Bd?"0px":this.legendW+"px";}}},isOnRight:function(Bb){return(Bb===AF.RIGHT_MIDDLE||Bb===AF.RIGHT_TOP||Bb===AF.RIGHT_BOTTOM);},updateLegend:function(){var Bb=this.attributeColorByLegend;this.attributeColorByLegendPlaceHolder.style.width=this.legendW+"px";this.attributeColorByLegendPlaceHolder.style.height=this.legendH+"px";Bb.width=this.legendW;Bb.height=this.legendH;Bb.cutBy=this.legendCutBy;Bb.minHeight=this.legendMinHeight;Bb.updateContainerSize(this.getWidth(),this.getHeight());Bb.feedData([{dataType:A7.COLOR_BY,dataObj:this.verticalLegendColorByElements},{dataType:A7.SIZE_BY,dataObj:this.verticalLegendSizeByElements}],(this.readGlobalAttriLegndProperty(A0.LEGEND_MODE)===Av.MINIMIZED));Bb.updateAfterResize();},toggleLegend:function(Bb){var Bd=this.attributeColorByLegend,Bc;Bc=Bd.domNode.style;if(!Bb){Bd.hideToolbar();Bc.display="none";}else{if(Bc.display!=="block"){Bc.display="block";}}},updateCanvasAfterAttributeLegendChanged:function(Bb,Bf){var Be=parseInt(this.width,10),Bc=parseInt(this.height,10),Bg=this.LayoutProperties.Padding,Bh=Be-2*Bg-Bf,Bi=Bc-2*Bg,Bd=0;if(this.props.showLegend&&!this.isOnRight(Bb)){Bd=Bf;}this.heatMapSize={x:Bd,y:0,w:Bh,h:Bi};this.applyLayout();Ab.call(this);this.renderRectangles();this.highlightCanvas.resetCanvasRect(this.heatMapSize);this.refreshHighlights();},getCellForNode:function u(Bc){var Bb=this.levelAttributes[Bc.level];return{at:Bc.at,dei:Bc.dei,dpt:Bc.dpt,o:Bc.o,n:Bb.name,tui:Bc.tui,ui:Bc.ui,axis:1,v:Bc.label,tid:Bb.id};},getCellUnitIndex:function E(Bb){return Bb.o;},getColorByElements:function B(){var Bb=this.verticalLegendColorByElements,Bc=this,Bd;if(Bb===undefined){this.getVerticalLegendColorByInfo();Bb=this.verticalLegendColorByElements||{};}Bd=(Bb.elements||[]).map(function(Bf){var Be=Bf.token,Bh=Be.elements||[],Bg=Be.levels||[];return{text:Bf.label,color:Bf.color,opacity:BC.call(Bc,Bg,Bh),comb:b(Bg,Bh)};});Bd.unshift({text:mstrmojo.desc(2461,"All"),color:"#ffffff",opacity:100,comb:[]});return Bd;},updateColorByOpacity:function(Bd,Bb){Bd=[].concat(Bd);Bb=[].concat(Bb);if(Bd.length!==Bb.length){throw new Error("comb and opacity number not match");}var Bc=this.getPropsInfo(),Be=Bc.attrColorByOpacity||{};Bd.forEach(function(Bh,Bg){var Bj=Bh.map(function(Bk){return Bk.tid;}).join("|"),Bi=Bh.map(function(Bk){return Bk.eid;}).join("|"),Bf=Be[Bj];if(Bf===undefined){Bf={};Be={};}Bf[Bi]=Bb[Bg];Be[Bj]=Bf;});this.observableModel.colorByOpacity.setValue(Be);},execFormatHandler:function(){var Bg=function(){AU.selectPropertyPanel(this,0);}.bind(this);var Bf=this.previousSelected;if(Bf===undefined||Bf.length===0){Bg();return ;}var Bh=Al.call(this),Bc=Q.call(this),Bd=this._toolbarContext,Bi,Be,Bb;if(!Bh&&!Bc){return ;}if(Bd===undefined){Bg();return ;}Bi=Bd.pos;Be=Bd.type;Bb=Bd.entity||this.getEntityByTouch(R(Bi));switch(Be){case Aa.RECTANGLE_LABEL:case Aa.RECTANGLE:o.call(this,Bb,Bi);break;default:Bg();break;}},onNDECreated:function(Bb){Bb.forEach(function(Be){var Bc=Be.id,Bd=Be.unitId;this.dfs(this.root,function(Bf){var Bg=Bf.id||"";if(Bg.indexOf(Bc)!==-1&&Bg.indexOf(Bd)!==-1){this.addToSelection(Bf);}}.bind(this));},this);this.doSelection();this.refreshHighlights();},triggerFontScaleChangeEvent:function(){f.call(this,this.props.fonts);},isAttributeColorByType:function(){return this.props.colorByType==="attribute";},isMetricColorByType:function(){return this.props.colorByType==="metric";},onselectionBatchRemove:function(Bb){this.refreshHighlights(Bb.entities);}});}());