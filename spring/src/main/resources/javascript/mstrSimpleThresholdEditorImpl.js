mstrSimpleThresholdEditorImplScript=true;mstrSimpleThresholdEditorImpl.prototype=new mstrThresholdEditor();mstrSimpleThresholdEditorImpl.prototype.slider=null;mstrSimpleThresholdEditorImpl.prototype.buttonBar=null;mstrSimpleThresholdEditorImpl.prototype.metricSelector=null;mstrSimpleThresholdEditorImpl.prototype.typeSelector=null;mstrSimpleThresholdEditorImpl.prototype.basedOnSelector=null;mstrSimpleThresholdEditorImpl.prototype.removeButton=null;mstrSimpleThresholdEditorImpl.prototype.autoButton=null;mstrSimpleThresholdEditorImpl.prototype.propsButton=null;mstrSimpleThresholdEditorImpl.prototype.formatObject=null;mstrSimpleThresholdEditorImpl.prototype.autoApply=false;mstrSimpleThresholdEditorImpl.prototype.showLabels=false;mstrSimpleThresholdEditorImpl.prototype.currentRangeBoundaries="";mstrSimpleThresholdEditorImpl.prototype.selectedThreshold=null;mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_NONE=-2;mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_COMPLEX=-1;mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT=1;mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT=2;mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST=4;mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST=5;mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE=7;mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_DESCRIPTORS=[0,4406,4407,0,530,529,0,527,512,4410];mstrSimpleThresholdEditorImpl.prototype.onload=function(){try{mstrThresholdEditor.prototype.onload.call(this);if(!this.elem||!this.elem.innerHTML){this.unregister();return ;}this.isLoading=true;this.slider=new mstrThresholdSliderImpl(this.id+"_ChildSlider",this.containers,"microstrategy.bone('"+this.id+"').slider");this.slider.setContainerKey(this.currentContainerKey);this.slider.setAutoApply(this.autoApply);this.slider.setShowLabels(this.showLabels);this.slider.setSelectedType(this.selectedType);this.slider.setIsCondFormat(this.isCondFormat);this.slider.parentBone=this;this.slider.onload();this.slider.observer.register(this.id);this.removeButton=document.getElementById(this.id+"_remove");if(this.removeButton){this.removeButton.onclick=new Function("microstrategy.bone('"+this.id+"').removeThreshold();");}this.autoButton=document.getElementById(this.id+"_auto");if(this.autoButton){this.autoButton.onclick=new Function("microstrategy.bone('"+this.id+"').toggleAuto();");}this.buttonBar=document.getElementById(this.id+"_actionButtonsBar");this.propsButton=document.getElementById(this.id+"_propsButton");if(this.propsButton){this.propsButton.onclick=new Function("microstrategy.bone('"+this.id+"').toggleProps(true);");}this.metricSelector=document.getElementById(this.id+"_metricSelector");this.typeSelector=document.getElementById(this.id+"_typeSelector");this.basedOnSelector=document.getElementById(this.id+"_basedOnSelector");this.syncProperties();this.elem.onmousedown=new Function("e","microstrategy.bone('"+this.id+"').oneditorclick(e);");this.commands=new mstrSTECommandsImpl(this);this.isLoading=false;}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.onreload=function(){try{mstrThresholdEditor.prototype.onreload.call(this);if(!this.elem||!this.elem.innerHTML){this.unregister();return ;}}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.onunload=function(e){try{if(this.slider){this.slider.onunload(e);}mstrEditorImpl.prototype.onunload.call(this);}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.onselectionchange=function(){try{if(!this.removeButton||!this.removeButton.firstChild){return ;}if(this.slider&&this.slider.selections&&this.slider.selections.isActive()){this.removeButton.firstChild.data=microstrategy.descriptors.getDescriptor("190");}else{this.removeButton.firstChild.data=microstrategy.descriptors.getDescriptor("4400");}}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.onwinresize=function(){try{if(this.slider&&!this.isLoading&&microstrategy.EXECUTION_SCOPE!=microstrategy.RWD_EXECUTION){this.slider.render();}}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.ondialogresize=function(){try{this.onwinresize();}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.changeMetric=function(select){try{this.currentContainerKey=select.options[select.selectedIndex].value;this.slider.setCurrentContainerKey(this.currentContainerKey);this.syncProperties();}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.changeMetricProps=function(){try{var container=this.getCurrentContainer();var newType=parseInt(this.typeSelector.options[this.typeSelector.selectedIndex].value);var newBasedOn=this.basedOnSelector.options[this.basedOnSelector.selectedIndex].value;var redraw=(newType!=container.thresholdType||newBasedOn!=container.basedOn);if(redraw){this.slider.applyNewType(newType,newBasedOn);}this.toggleProps(false);if(redraw&&this.autoApply&&!container.isOnStarting){this.applyChanges();}}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.removeThreshold=function(){try{if(this.slider.selections.isActive()){this.slider.deleteThreshold();}else{this.getCurrentContainer().thresholds=new Array();this.slider.render();if(this.autoApply){this.applyChanges();}}}catch(err){microstrategy.errors.log(err);}return false;};mstrSimpleThresholdEditorImpl.prototype.clearComplexThresholds=function(){try{var cm=this.getCurrentContainer();cm.thresholdType=this.isCondFormat?mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE:mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT;cm.thresholds=new Array();this.slider.render();this.syncProperties();if(this.autoApply){this.applyChanges();}}catch(err){microstrategy.errors.log(err);}return false;};mstrSimpleThresholdEditorImpl.prototype.toggleAuto=function(){try{var autoValue=this.autoApply?0:1;var um=microstrategy.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.SET_THRESHOLDS_AUTO_APPLY,this.beanPath,["111017"],[autoValue],[],[])]);if(autoValue){this.applyChanges();}else{um.flushAndSubmitChanges();}}catch(err){microstrategy.errors.log(err);}return false;};mstrSimpleThresholdEditorImpl.prototype.toggleProps=function(show){try{if(this.propsButton&&this.propsButton.className!="complex"){this.propsButton.parentNode.style.display=(show)?"none":"inline";this.propsButton.parentNode.nextSibling.style.display=(show)?"inline":"none";}this.syncProperties();}catch(err){microstrategy.errors.log(err);}return false;};mstrSimpleThresholdEditorImpl.prototype.oneditorclick=function(e){try{if(this.slider&&this.slider.selections&&this.slider.selections.ondocumentclick){this.slider.selections.ondocumentclick(e);}}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.syncProperties=function(){try{var display=microstrategy.descriptors.getDescriptor("2961")+" ";var type=this.getCurrentContainer().thresholdType;var isTS=(type>mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_COMPLEX);if(isTS){this.typeSelector.options.namedItem(type).selected=true;display+=microstrategy.descriptors.getDescriptor(mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_DESCRIPTORS[type]);}else{this.typeSelector.options[0].selected=true;display+=microstrategy.descriptors.getDescriptor(mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_DESCRIPTORS[type+10]);if(this.propsButton){this.propsButton.parentNode.style.display="inline";this.propsButton.parentNode.nextSibling.style.display="none";}}var c=this.getCurrentContainer();if(!this.isCondFormat){this.basedOnSelector.options[0].value=c.id;this.basedOnSelector.options[0].setAttribute("name",c.id);this.basedOnSelector.options[0].selected=true;var ml=this.metricList,len=ml.length,opts=this.basedOnSelector.options,m,o,ct=1;for(var i=0;i<len;i++){m=ml[i];o=opts[ct];if(m.id!=c.id){o.value=m.id;o.setAttribute("name",m.id);o.text=m.name;ct++;}}}if(c.basedOn&&c.basedOn.length>0){var opts=this.basedOnSelector.options;for(var i=0;i<opts.length;i++){if(opts[i].value==c.basedOn){opts[i].selected=true;break;}}}else{this.basedOnSelector.selectedIndex=0;}if(type>mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_COMPLEX&&c.basedOn!=c.id){display+="; "+microstrategy.descriptors.getDescriptor("4402")+" "+this.basedOnSelector.options[this.basedOnSelector.selectedIndex].text;}if(this.metricSelector&&this.metricSelector.options.namedItem(this.currentContainerKey)){this.metricSelector.options.namedItem(this.currentContainerKey).selected=true;}if(this.propsButton){this.propsButton.innerHTML=display;this.propsButton.className=(isTS?"simple":"complex");}}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.getCurrentContainer=function(){try{return this.containers[this.currentContainerKey];}catch(err){microstrategy.errors.log(err);return null;}};mstrSimpleThresholdEditorImpl.prototype.applyChanges=function(){try{this.saveChanges();var um=microstrategy.updateManager;um.add([um.createActionObject(this.elem,mstrUpdateManager.APPLY_THRESHOLD_CHANGES,this.beanPath,[],[],[],[])]);um.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.saveChanges=function(){try{var um=microstrategy.updateManager;var ac=new Array();for(var id in this.containers){var container=this.containers[id];var thresholdType=container.thresholdType;if(thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_COMPLEX){continue;}ac.push(um.createActionObject(null,mstrUpdateManager.CLEAR_THRESHOLDS,this.beanPath,["111009","111013"],[id,mstrUpdateManager.UPDATE_LATER]));if(container.isOnStarting){continue;}for(var i=0;i<container.thresholds.length;i++){var t=container.thresholds[i];if(t.isInterpolate==false){var names=new Array();var values=new Array();var formattingProps=this.buildFormattingUpdateStrings(container.defaultFormatting,t.formatting);if(formattingProps.length>0){names.push("111002");values.push(formattingProps);}var r=parseInt(t.formatting.rplc.type);if(r==mstrThresholdEditor.TEXT||r==mstrThresholdEditor.IMAGE||r==mstrThresholdEditor.QUICK_SYMBOL){names.push("111003");values.push(t.formatting.rplc.type);names.push("111004");values.push(t.formatting.rplc.src);}else{if(r==mstrThresholdEditor.HIDE){names.push("111003");values.push(t.formatting.rplc.type);}}if(t.floor!=mstrThresholdSliderImpl.MINUS_INFINITY&&(thresholdType==mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_VALUE||t.floor>0)){names.push("111005");values.push(microstrategy.number.toLocaleString(t.floor));}if(t.ceil!=mstrThresholdSliderImpl.INFINITY&&(t.ceil!=100||(thresholdType!=mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_LOWEST_PERCENT&&thresholdType!=mstrSimpleThresholdEditorImpl.THRESHOLD_TYPE_HIGHEST_PERCENT))){names.push("111006");values.push(microstrategy.number.toLocaleString(t.ceil));}if(t.scp){names.push("111016");values.push(t.scp);}names.push("111007");values.push(thresholdType);names.push("111008");if(!container.basedOn||container.basedOn.length==0){values.push(this.basedOnSelector.options[this.basedOnSelector.selectedIndex].value);}else{values.push(container.basedOn);}names.push("111009");values.push(id);names.push("111010");values.push(t.name);names.push("111013");values.push(mstrUpdateManager.UPDATE_NOW);ac.push(um.createActionObject(null,mstrUpdateManager.ADD_THRESHOLD,this.beanPath,names,values));}}}um.add(ac);microstrategy.updateManager.addURL("container="+this.currentContainerKey+"&labels="+this.showLabels);}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.buildFormattingUpdateStrings=function(df,tf){var __result="";try{var delimiter="";for(var id in tf){if(id!="rplc"&&df[id]!=tf[id]){__result+=delimiter+mstrThresholdEditor.PROPERTY_CONVERSION[id].ps+this.valueSeparator+mstrThresholdEditor.PROPERTY_CONVERSION[id].p+this.valueSeparator+tf[id];delimiter=this.propSeparator;}}if("bc" in tf&&"pfs" in tf){__result+=delimiter+mstrThresholdEditor.PROPERTY_CONVERSION.pfs.ps+this.valueSeparator+mstrThresholdEditor.PROPERTY_CONVERSION.pfs.p+this.valueSeparator+tf.pfs;}}catch(err){microstrategy.errors.log(err);}return __result;};mstrSimpleThresholdEditorImpl.prototype.okChanges=function(){try{this.close();this.applyChanges();microstrategy.unRegisterBone(this.id);}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.cancelChanges=function(){try{var um=microstrategy.updateManager;um.add(um.createActionObject(null,mstrUpdateManager.CANCEL_THRESHOLD_CHANGES,this.beanPath,[],[],null));this.closeEditor();}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.setCurrentRangeBoundaries=function(value){try{this.currentRangeBoundaries=value;this.selectedThreshold=null;}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.getSelectedThreshold=function(){try{if(this.currentRangeBoundaries.length==0){return null;}if(!this.selectedThreshold){var val=this.currentRangeBoundaries.split("|");this.selectedThreshold=this.slider.getThresholdByValues(parseFloat(val[0]),parseFloat(val[1]));}return this.selectedThreshold;}catch(err){microstrategy.errors.log(err);return null;}};mstrSimpleThresholdEditorImpl.prototype.getThresholdFormatValue=function(format,propName){try{return this.slider.extractFormatValue(format,propName);}catch(err){microstrategy.errors.log(err);return"";}};mstrSimpleThresholdEditorImpl.prototype.changeThresholdFormatProp=function(fName,fValue){try{var isReplace=(fName=="type"||fName=="src");var t=this.getSelectedThreshold();if(t){t.isInterpolate=false;var f=(isReplace)?t.formatting.rplc:t.formatting;var df=(isReplace)?this.getCurrentContainer().defaultFormatting.rplc:this.getCurrentContainer().defaultFormatting;if((f&&fName in f&&fValue!=f[fName])||(fValue!=df[fName])){f[fName]=fValue;}}}catch(err){microstrategy.errors.log(err);}};mstrSimpleThresholdEditorImpl.prototype.changeThresholdName=function(tName){try{var t=this.getSelectedThreshold();if(t){t.name=tName;}}catch(err){microstrategy.errors.log(err);}};function mstrSimpleThresholdEditorImpl(id){this.inherits=mstrThresholdEditor;this.inherits(id);delete this.inherits;return this;}mstrSTECommandsImpl.prototype=new mstrTECommandsImpl();mstrSTECommandsImpl.prototype.exec=function(cmdId,cmdVal){try{if(mstrTECommandsImpl.prototype.exec.call(this,cmdId,cmdVal)){this.parentBone.slider.render();}if(cmdId=="formatBulk"&&this.parentBone.autoApply){this.parentBone.applyChanges();}return true;}catch(err){microstrategy.errors.log(err);}return null;};mstrSTECommandsImpl.prototype.queryState=function(cmdId,cmdVal){try{switch(cmdId){case"gradientcolor":return mstrTECommandsImpl.prototype.queryState.call(this,"gradient");break;default:return mstrTECommandsImpl.prototype.queryState.call(this,cmdId);break;}}catch(err){microstrategy.errors.log(err);}return null;};function mstrSTECommandsImpl(p){this.inherits=mstrTECommandsImpl;this.inherits(p);delete this.inherits;return this;}