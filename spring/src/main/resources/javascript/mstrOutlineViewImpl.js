mstrOutlineViewImplScript=true;mstrOutlineViewImpl.prototype=new mstrTreeViewImpl();mstrOutlineViewImpl.prototype.mainUL=null;mstrOutlineViewImpl.prototype.treeJsonObj=null;mstrOutlineViewImpl.prototype.onload=function(){try{this.initTree();this.resizeContents();}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.onrepostload=function(){try{var mainUL=document.getElementById("main");if(mainUL){mainUL.parentNode.removeChild(mainUL);}this.onload();}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.onreload=function(){try{}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.initTree=function(){try{mstrTreeViewImpl.prototype.initTree.call(this);if(!this.treeDiv){return ;}mainUL=document.createElement("ul");mainUL.setAttribute("id","main");mainUL.style.display="block";mainUL.className="firstLevel";mainUL.setAttribute("commandId","unit");this.treeDiv.onmousedown=new Function("e","microstrategy.bone('"+this.id+"').onmousedown(e); return false;");var at=microstrategy.getViewerBone();at.documentStructureTreeBone=this;this.appliesTo=at.id;if(at.observer){at.observer.register(this.id);}this.treeJsonObj=at.hierarchyAttribute;for(var i=0,cnt=this.treeJsonObj.sections.length;i<cnt;i++){this.initTreeHelper(at,this.treeJsonObj.sections[i],mainUL);if((i+1<cnt)&&(this.treeJsonObj.sections[i].id==this.treeJsonObj.sections[i+1].id)){i++;}}this.treeDiv.appendChild(mainUL);this.onselectionchange();}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.initTreeHelper=function(at,parentNode,parentHTMLNode){try{var id=parentNode.id.replace("_","");var tp=parentNode.type;var nm;var icon=tp;if(tp==2||tp==3||tp==5||tp==6||tp==7){var list=at.commands.queryState("sectionsList");for(var i=0,cnt=list.length;i<cnt;i++){if(list[i].dssid==id){nm=list[i].n;break;}}icon=4;if(parentNode.objects&&parentNode.objects.length==1){this.initTreeHelper(at,parentNode.objects[0],parentHTMLNode);return ;}if(parentNode.objects&&parentNode.objects.length==0){return ;}}else{if(tp==microstrategy.SUBOBJTYPE_DOC_PANEL){nm=parentNode.nm;icon=4;}else{nm=this.getCtrlName(id);icon=this.getCtrlIcon(id);}}if(nm&&mstr&&mstr.utils&&mstr.utils.String){nm=mstr.utils.String.escape4HTMLText(nm);}var isChild=false;var node=this.createNode(id,nm,tp,icon,isChild);parentHTMLNode.appendChild(node);var childUL=this.createChildNode(id);var objLen=parentNode.objects&&parentNode.objects.length;var bone=mstr.$obj(id),preventRenderingChildren;if(bone&&bone.isTable){preventRenderingChildren=true;}if(objLen&&!preventRenderingChildren){node.firstChild.className="";for(var j=0;j<objLen;j++){this.initTreeHelper(at,parentNode.objects[j],childUL);}}parentHTMLNode.appendChild(childUL);}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.onredo=function(action){try{this.onundo(action);}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.onundo=function(action){try{var at=this.getAppliesTo();if(!at){return ;}if(!action.elem){if(action.cachedArray&&action.cachedArray.elements){var array=action.cachedArray.elements;var selItems=new Object();for(var i in array){var tempId=array[i].id;var tempObj=null;if(document.getElementById(tempId)){tempObj=document.getElementById(tempId);selItems[tempId]=tempObj;}}this.selectionHelper(null,at,selItems);this.handleTreeSelections();}return ;}var id=action.elem&&action.elem.id;if(!id){return ;}if(!document.getElementById(id)){if(action.elem.getAttribute("sty")==microstrategy.SUBOBJTYPE_DOC_PANEL){var treePanel=document.getElementById("node_"+id);if(!treePanel){return ;}var panelStack=document.getElementById(treePanel.parentNode.id.replace("childOf_",""));this.handleUndoPanel(panelStack);this.handleTreeSelections();}return ;}else{if(this.getCtrlType(id)!=microstrategy.SUBOBJTYPE_DOC_PANEL){if(document.getElementById(id)){action.elem=document.getElementById(id);}var selItem={};selItem[id]=action.elem;this.selectionHelper(null,at,selItem);this.handleTreeSelections();}else{if(this.getCtrlType(id)==microstrategy.SUBOBJTYPE_DOC_PANEL){var panel=document.getElementById(id);var panelStack=this.getParentType(panel,microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);this.handleUndoPanel(panelStack);this.handleTreeSelections();}}}}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.handleTreeSelections=function(){var at=this.getAppliesTo();if(!at){return ;}var selItems=at.commands.queryState("selectedItems");var isMultiSelection=at.commands.queryEnabled("multiselect");if(at.commands.queryState("unit").id==-1&&!isMultiSelection){this.util_unselectNodes(null,mainUL);}else{this.selectionHelper(null,at,selItems);}};mstrOutlineViewImpl.prototype.handleUndoPanel=function(panelStack){var id=panelStack.id;var selItem=new Object();selItem[id]=panelStack;this.panelChangeHelper(selItem);};mstrOutlineViewImpl.prototype.util_unselectNodes=function(oTarget,oTree){try{var oLIs=microstrategy.findChildrenWithAtt(oTree,"LI","sel","1");if((oLIs)&&(oLIs.length)){for(var i=0;i<oLIs.length;i++){this.util_markNodeAsUnselected(oLIs[i]);}}}catch(err){microstrategy.errors.log(err);return false;}};mstrOutlineViewImpl.prototype.ondialogresize=function(){this.resizeContents();};mstrOutlineViewImpl.prototype.onwinresize=function(){this.resizeContents();};mstrOutlineViewImpl.prototype.resizeContents=function(){try{var accordionTabManager=microstrategy.findAncestorWithAtt(this.elem,"scriptClass","mstrAccordionTabManagerImpl");if(accordionTabManager){var accordionTabManagerBone=microstrategy.findBone(accordionTabManager);if(accordionTabManagerBone){var height=Math.max(accordionTabManagerBone.getAvailableHeight(),0)-3;var width=Math.max(accordionTabManagerBone.getAvailableWidth(),0);this.elem.parentNode.style.height=Math.max(height,0)+"px";this.elem.parentNode.style.width=Math.max(width,0)+"px";this.elem.parentNode.style.overflow="auto";}}}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.onbonedeleted=function(e){try{var deletedItemsArray=e.split("|");for(var i=0;i<deletedItemsArray.length;i++){if(deletedItemsArray[i]!=""){this.deleteNode(mainUL,deletedItemsArray[i]);}}}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.deleteNode=function(parentHTMLNode,deletionID){try{var node=document.getElementById("node_"+deletionID);if(!node){return false;}if(node.getAttribute("sty")=="4"){return false;}var child=node.nextSibling;var parentNode=node.parentNode;parentNode.removeChild(node);parentNode.removeChild(child);window.setTimeout("if(microstrategy.bone('"+this.id+"')) microstrategy.bone('"+this.id+"').updateJson('"+parentNode.id.replace("childOf_","")+"', '"+node.id+"', null , null , 'del');",0);if(!parentNode.hasChildNodes()){parentNode.previousSibling.firstChild.className="leaf";parentNode.style.display="none";}return true;}catch(err){microstrategy.errors.log(err);}return false;};mstrOutlineViewImpl.prototype.onpanelchange=function(e){try{var at=this.getAppliesTo();if(!at){return ;}var mainUL=document.getElementById("main");if(!mainUL){return ;}var selItem=at.commands.queryState("selectedItems");this.panelChangeHelper(selItem);}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.panelChangeHelper=function(selItem,addedPanelId){try{var returnVal=false;for(var id in selItem){var bone=mstr.$obj(id),isTable=bone&&bone.isTable;if(selItem[id].getAttribute("sty")==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK&&!isTable){var panels=this.getPanel(selItem[id]);if(!panels){return ;}var panelStack=this.getParentType(panels,microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);var panelStackBone=microstrategy.findBone(panelStack);var treePanels=document.getElementById("childOf_"+panelStack.id);if(!treePanels){return ;}var curPanelId;var treePanelLength=treePanels.childNodes.length/2;var panelsLength=panels.childNodes.length;if(panelsLength>treePanelLength){curPanelId=panelStackBone.currentPanelId;var newPanel=panelStackBone.panels[panelStackBone.panelMap[curPanelId]];var panelNm=newPanel.elem.getAttribute("nm");var panelTp=newPanel.elem.getAttribute("sty");var panelIcon=newPanel.elem.getAttribute("ty");var newTreePanel=this.createNode(curPanelId,panelNm,panelTp,panelIcon,true);this.addNode(mainUL,id,newTreePanel);}else{if(panelsLength<treePanelLength){for(var i=0;i<(treePanelLength*2);i=i+2){var flag=0;var treePanel=treePanels.childNodes[i];for(var k=0;k<panelsLength;k++){if(("node_"+panels.childNodes[k].id)==treePanel.id){flag++;}}if(flag==0){var treePanelChild=treePanel.nextSibling;treePanels.removeChild(treePanel);treePanels.removeChild(treePanelChild);break;}}}}if(panels.childNodes.length==(treePanels.childNodes.length/2)){for(var panelId in panelStackBone.getPanelMap()){var curNode=document.getElementById("node_"+panelId);if(curNode){var curSibling=curNode.nextSibling;treePanels.appendChild(curNode);treePanels.appendChild(curSibling);}}curPanelId=panelStackBone.currentPanelId;returnVal=this.findNode(mainUL,id,id,returnVal);returnVal=this.findNode(mainUL,curPanelId,curPanelId,returnVal);this.updatePanelName(panelStackBone);continue;}}else{returnVal=this.findNode(mainUL,id,id,returnVal);}}}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.onselectionchange=function(e){try{if(!e){e=window.event;}var at=this.getAppliesTo();var selItem=at.commands.queryState("selectedItems");this.selectionHelper(e,at,selItem);}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.selectionHelper=function(e,at,selItem){try{var unit=at.commands.queryState("unit");if(unit.id==-1){this.util_unselectNodes(null,mainUL);}var isMultiSelect=false;for(var id in selItem){var section=at.commands.queryState("selectedSection");var parentID=(section&&section.id)||id;isMultiSelect=this.findNode(mainUL,id,parentID,isMultiSelect);if(selItem[id].getAttribute("sty")==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){var panelStackBone=microstrategy.findBone(selItem[id]);if(panelStackBone instanceof mstrPanelStack){this.findNode(mainUL,panelStackBone.currentPanelId,panelStackBone.currentPanelId,true);this.findNode(mainUL,id,id,true);this.updatePanelName(panelStackBone);}}}if(!isMultiSelect){for(var id in selItem){isMultiSelect=this.addChildren(at,id,selItem[id],isMultiSelect,true);}}if(unit.id!=-1&&unit.id==id){this.updateName(document.getElementById("node_"+id),unit.name);}}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.addChildren=function(at,id,item,isMultiSelect,select){if(!item.parentNode){item=document.getElementById(id);}var parentID=item.parentNode.id;var newChild=this.createNode(id,this.getCtrlName(id),this.getCtrlType(id),this.getCtrlIcon(id),true);this.addNode(mainUL,parentID,newChild);if(select){isMultiSelect=this.findNode(mainUL,id,parentID,isMultiSelect);}var isPanelStack=item.getAttribute("sty")==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK.toString();var isTable=mstr.$obj(id)&&mstr.$obj(id).isTable;if(isPanelStack&&!isTable){var panels=this.getPanel(item);for(i=0,cnt=panels.childNodes.length;i<cnt;i++){var panel=panels.childNodes[i];var panelNm=panel.getAttribute("nm");var panelTp=panel.getAttribute("sty");var panelIcon=panel.getAttribute("ty");var newPanel=this.createNode(panel.id,panelNm,panelTp,panelIcon,true);this.addNode(mainUL,id,newPanel);for(var k=0,panelLength=panel.childNodes.length;k<panelLength;k++){var object=panel.childNodes[k];if(object.id!=""&&object.getAttribute("cmdid")!="cm"){isMultiSelect=this.addChildren(at,object.id,object,isMultiSelect,false);}}}panelStack=this.getParentType(panels,microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);var panelStackBone=microstrategy.findBone(panelStack);if(select){isMultiSelect=this.findNode(mainUL,panelStackBone.currentPanelId,panelStackBone.currentPanelId,isMultiSelect);}}return isMultiSelect;};mstrOutlineViewImpl.prototype.addNode=function(parentHTMLNode,parentSectionID,newChild){try{var parentNode=document.getElementById("node_"+parentSectionID);if(!parentNode){return false;}var childUL=parentNode.nextSibling;if(childUL.tagName.toUpperCase()=="UL"){parentNode.firstChild.className="";childUL.appendChild(newChild);var id=newChild.getAttribute("node_id");var UL=this.createChildNode(id);childUL.appendChild(UL);this.updateJson(parentSectionID,id,newChild.getAttribute("sty"),newChild.getAttribute("nm"),"add");return true;}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrOutlineViewImpl.prototype.updateJson=function(parentId,childId,childTp,childNm,operation){try{if(!this.treeJsonObj){return ;}for(var i=0,cnt=this.treeJsonObj.sections.length;i<cnt;i=i+1){this.updateJsonHelper(this.treeJsonObj.sections[i],parentId,childId,childTp,childNm,operation);if((i+1!=this.treeJsonObj.sections.length)&&(this.treeJsonObj.sections[i].id==this.treeJsonObj.sections[i+1].id)){i++;}}}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.updateJsonHelper=function(parentNode,parentId,childId,childTp,childNm,operation){try{var objLen=parentNode.objects&&parentNode.objects.length;var j;if(parentNode.id==parentId){if(operation=="add"){var newObj={id:childId,nm:childNm,type:childTp,objects:[]};parentNode.objects.push(newObj);return true;}else{if(operation=="del"){for(j=0;j<objLen;j++){if(parentNode.objects[j].id==childId){mstr.utils.Arrays.remove(parentNode.objects,[j],true);return true;}}}}}else{for(j=0;j<objLen;j++){if(this.updateJsonHelper(parentNode.objects[j],parentId,childId,childTp,childNm,operation)){return true;}}}}catch(err){microstrategy.errors.log(err);}return false;};mstrOutlineViewImpl.prototype.getPanel=function(oTarget){try{var at=this.getAppliesTo();for(var i=0,cnt=oTarget.childNodes.length;i<cnt;i++){var child=oTarget.childNodes[i];if(child.className=="panels"){return child;}var returnVal=this.getPanel(child);if(returnVal){return returnVal;}}}catch(err){microstrategy.errors.log(err);}return null;};mstrOutlineViewImpl.prototype.getParentType=function(oTarget,targetType){try{var at=this.getAppliesTo();oTarget=oTarget.parentNode;while(oTarget){if((oTarget.getAttribute("ty")==targetType)||(oTarget.getAttribute("sty")==targetType)){return oTarget;}oTarget=oTarget.parentNode;}return oTarget;}catch(err){microstrategy.errors.log(err);return null;}};mstrOutlineViewImpl.prototype.findNode=function(parentHTMLNode,selID,parentID,isMultiSelect){try{if(!isMultiSelect){this.util_unselectNodes(null,mainUL);}var selectedNode=document.getElementById("node_"+selID);if(!selectedNode){return false;}var pN=selectedNode.parentNode;if(parentID!=selID&&pN.id.replace("childOf_","")!=parentID){this.deleteNode(mainUL,selID);return false;}while(pN!=mainUL){pN.previousSibling.firstChild.className="open";pN.style.display="block";pN=pN.parentNode;}this.util_markNodeAsSelected(selectedNode.childNodes[0],isMultiSelect);return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrOutlineViewImpl.prototype.getAppliesTo=function(bone){try{if(!(this.appliesTo&&this.appliesTo.length>0)){var at=microstrategy.getViewerBone();this.appliesTo=at.id;}return microstrategy.bone(this.appliesTo);}catch(err){microstrategy.errors.log(err);}return null;};mstrOutlineViewImpl.prototype.updatePanelName=function(panelStackBone){try{var node=document.getElementById("node_"+panelStackBone.currentPanelId);var name=panelStackBone.getCurrentPanel().elem.getAttribute("wt");if(!name){name=panelStackBone.getCurrentPanel().elem.getAttribute("nm");}this.updateName(node,name);}catch(err){microstrategy.errors.log(err);}return false;};mstrOutlineViewImpl.prototype.updateName=function(node,name){try{if(!node){return false;}var nodeContent=microstrategy.findChildWithAtt(node,"span","id","node_content");if(mstr&&mstr.utils&&mstr.utils.String){name=mstr.utils.String.escape4HTMLText(name);}nodeContent.innerHTML=name;}catch(err){microstrategy.errors.log(err);}return false;};mstrOutlineViewImpl.prototype.createNode=function(id,content,type,icon,isChild){try{var div=document.createElement("div");div.setAttribute("nowrap","");div.setAttribute("node_id",id);div.setAttribute("sty",type);div.setAttribute("nm",content);div.id="node_"+id;var li=document.createElement("li");li.setAttribute("multi","1");li.setAttribute("did",id);li.className="leaf";li.setAttribute("selected","true");var span1=document.createElement("span");span1.className="itemContainer";var span2=document.createElement("span");span2.className="iconContainer null";span2.setAttribute("id",("pkrunit"+icon));var span3=document.createElement("span");span3.className="mstrIcon-tb";var a=document.createElement("a");a.setAttribute("dum","1");var span=document.createElement("span");span.id="node_content";span.innerHTML=content;a.appendChild(span);span2.appendChild(span3);span1.appendChild(span2);span1.appendChild(a);li.appendChild(span1);div.appendChild(li);return div;}catch(err){microstrategy.errors.log(err);return null;}};mstrOutlineViewImpl.prototype.createChildNode=function(id){try{var UL=document.createElement("ul");UL.setAttribute("id","childOf_"+id);UL.style.display="none";return UL;}catch(err){microstrategy.errors.log(err);return null;}};mstrOutlineViewImpl.prototype.onContextMenu=function(e){try{if(!e){e=window.event;}var oTarget=getEventTarget(e);if(!oTarget||oTarget==this.elem){return ;}}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.onkeypress=function(e){try{}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.onkeydown=function(e){};mstrOutlineViewImpl.prototype.onmousedown=function(e){e=e||window.event;if((e.which==3)||(e.button==2)){this.onClickTree(e);}};mstrOutlineViewImpl.prototype.onClickTree=function(e){try{if(!e){e=window.event;}var oTarget=getEventTarget(e);if(!oTarget){return ;}mstrTreeViewImpl.prototype.onClickTree.call(this,e);var at=this.getAppliesTo();this.selectedHiddenSection=null;if((oTarget.tagName=="A")||(oTarget.tagName=="SPAN")){var id=microstrategy.findAncestorWithTag(oTarget,"DIV").getAttribute("node_id");var sty=microstrategy.findAncestorWithTag(oTarget,"DIV").getAttribute("sty");}else{return ;}var cmd="select";if(e.ctrlKey&&this.needDetectCtrlKey()){cmd=cmd+"_multiple";}if(sty=="2"||sty=="3"||sty=="5"||sty=="6"||sty=="7"){var mapChild=document.getElementById("childOf_"+id).childNodes[0];id=mapChild.id.replace("node_","");sty=mapChild.getAttribute("sty");cmd="select";}if(sty=="4"){var docBone=microstrategy.getViewerBone().doc;var curSubSection=microstrategy.findBone(document.getElementById(id));if(!curSubSection){at.doc.selections.clear();this.selectedHiddenSection=id;microstrategy.getContextMenuManager("RWM").getMenu("rw_subsection_menu").registerTrigger(microstrategy.findAncestorWithTag(oTarget,"DIV"),[microstrategy.OBJTYPE_DOC_SUBSECTION]);return ;}curSubSection.parentBone.currentSubSection=curSubSection;docBone.currentSection=curSubSection.parentBone;}if(sty!=microstrategy.SUBOBJTYPE_DOC_PANEL){if(!document.getElementById(id)){return ;}if(e.button==0||(e.button==2&&cmd!="select_multiple"&&!at.doc.selections.items[id])){at.commands.exec(cmd,(id+"|"+sty));}}var src=microstrategy.eventManager.getSource(e);var rwContextMenu;if(sty==4){rwContextMenu=microstrategy.getContextMenuManager("RWM").getMenu("rw_subsection_menu");}else{rwContextMenu=microstrategy.getContextMenuManager("RWM").getMenu("rw_context_menu");}rwContextMenu.registerTrigger(microstrategy.findAncestorWithTag(oTarget,"DIV"),at.doc.selections.path+".getTypes()");if(sty==microstrategy.SUBOBJTYPE_DOC_PANEL){var panelStack;var panelHTML=document.getElementById(id);panelStack=this.getParentType(panelHTML,microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);var panelStackBone=microstrategy.findBone(panelStack);var oldPanel=document.getElementById(panelStackBone.currentPanelId);this.util_markNodeAsUnselected(document.getElementById("node_"+oldPanel.id).childNodes[0]);panelStackBone.setCurrentPanel(id,true);this.findNode(mainUL,panelStack.id,panelStack.id,true);this.findNode(mainUL,id,id,true);sty=panelStack.getAttribute("sty");if(e.button==0||(e.button==2&&cmd!="select_multiple"&&!at.doc.selections.items[id])){at.commands.exec(cmd,(panelStack.id+"|"+sty));}}else{if(sty==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK.toString()){this.findNode(mainUL,id,id,true);}}}catch(err){microstrategy.errors.log(err);}};mstrOutlineViewImpl.prototype.getCtrlName=function(id){try{var at=this.getAppliesTo();if(!at||!at.formattingAttributes[id]){return null;}return at.formattingAttributes[id].nm;}catch(err){microstrategy.errors.log(err);return null;}};mstrOutlineViewImpl.prototype.getCtrlType=function(id){try{var at=this.getAppliesTo();var type="";if(!at){return null;}if(at.formattingAttributes[id]&&at.formattingAttributes[id].ty){type=at.formattingAttributes[id].ty;}else{var object=document.getElementById(id);if(object){type=object.getAttribute("sty");}}return type;}catch(err){microstrategy.errors.log(err);return null;}};mstrOutlineViewImpl.prototype.getCtrlIcon=function(id){try{var at=this.getAppliesTo();if(!at||!at.formattingAttributes[id]){return null;}if(at.formattingAttributes[id].styst){return(this.getCtrlType(id)+"-"+at.formattingAttributes[id].styst);}else{var ty=this.getCtrlType(id);var dm=at.formattingAttributes[id].dm;if(ty==52&&(dm=="1"||dm=="2"||dm=="7")){ty=ty+"-"+dm;}return ty;}}catch(err){microstrategy.errors.log(err);}return null;};function mstrOutlineViewImpl(id){this.inherits=mstrTreeViewImpl;this.inherits(id);delete this.inherits;return this;}