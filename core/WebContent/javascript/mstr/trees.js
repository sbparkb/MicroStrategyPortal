mstr.utils.Trees=(function(){var T={};T.insertChildNodes=function T_insertChildNodes(parent,children,index,treeId){if(!parent){return false;}var len=mstr.$A.len(children);if(!len){return false;}parent.children=mstr.$A.insert(parent.children||[],children,index);for(var i=0;i<len;i++){children[i].parent=parent;children[i].treeId=treeId;}return true;};T.removeChildNode=function T_rmvCN(parent,child){var childIndex=this.findChildIndex(parent,child);if(childIndex>-1){return this.removeChildNodeAt(parent,childIndex);}return false;};T.removeChildNodeAt=function T_rmvCNAt(parent,childIndex){var child=parent&&parent.children&&parent.children[childIndex];if(child){parent.children.splice(childIndex,1);child.parent=null;child.treeId=null;}return child;};T.removeAllChildNodes=function T_rmvAllCNs(parent){if(!parent){return ;}var c=parent.children,child;for(var i=0,len=mstr.$A.len(c);i<len;i++){child=c[i];if(!child){continue;}child.parent=null;child.treeId=null;}parent.children=[];return c;};T.removeNodeAtPath=function T_removeNodeAtPath(tree,path){if(!tree||(path==null)){return null;}var pathParts=tree._pathParts(paths[i]);if(pathParts.length>1){var childIndex=pathParts.pop();var parentNode=tree.getNodeAt(pathParts.join(mstr.models.AbstractTreeBase.PATHDELIM));return this.removeChildNodeAt(parentNode,childIndex);}else{var wasRoot=tree.getRootNode();tree.setRootNode(null);return wasRoot;}};T.previousSibling=function T_previousSibling(node){if(node){var i=this.findChildIndex(node.parent,node);if(i>0){return node.parent.children[i-1];}}return null;};T.nextSibling=function T_nextSibling(node){if(node){var i=this.findChildIndex(node.parent,node);if(i>-1){return node.parent.children[i+1];}}return null;};T.findChildIndex=function T_findChildIndex(parent,child){if(parent&&child&&(child.parent==parent)&&parent.children){return mstr.$A.find(parent.children,child);}return -1;};T.find=function T_find(start,item){if(!start){return null;}if(start.value==item){return start;}else{if(start.children){var c=start.children;var len=c.length||0;for(var i=0;i<len;i++){var match=this.find(c[i],item);if(match){return match;}}}}return null;};T.findByForm=function T_findByForm(start,formValue,formName){if(!start){return null;}if(start.value&&start.value[formName]==formValue){return start;}else{if(start.children){var c=start.children;var len=c.length||0;for(var i=0;i<len;i++){var match=this.findByForm(c[i],formValue,formName);if(match){return match;}}}}return null;};T.findByNodeForm=function T_findByNodeForm(start,formValue,formName){if(!start){return null;}if(start[formName]==formValue){return start;}else{if(start.children){var c=start.children;var len=c.length||0;for(var i=0;i<len;i++){var match=this.findByNodeForm(c[i],formValue,formName);if(match){return match;}}}}return null;};T.matchByForm=function T_matchByForm(arr,regExp,formName,start){var len=mstr.utils.Arrays.len(arr),start=(start&&(start>-1))?start:0,v,node;for(var i=start;i<len;i++){node=arr[i];if(regExp.test(String(node&&node.value&&node.value[formName]))){return i;}}if(start>0){for(var i=0;i<start;i++){node=arr[i];if(regExp.test(String(node&&node.value&&node.value[formName]))){return i;}}}return -1;};T.cloneSubTree=function T_cloneSubTree(start,bFastClone){if(!start){return null;}var clone={value:bFastClone?start.value:mstr.$H.clone(start.value)};var c=start.children;var len=mstr.$A.len(c);if(len){clone.children=new Array(len);var child;for(var i=0;i<len;i++){child=this.cloneSubTree(c[i],bFastClone);child&&(child.parent=clone);clone.children[i]=child;}}return clone;};return T;})();mstr.models.AbstractCartBase=(function(){mstr.$O.extendsClass(ACB,mstr.models.BaseModel);ACB.prototype.canAdd=function LC_canAdd(item){var n=this.props.allowedItemFormName;if(n!=null){if(this.props.allowedItemFormValues){if(!this.props.allowedItemFormValuesHash){this.props.allowedItemFormValuesHash=mstr.$A.toHash(this.props.allowedItemFormValues&&this.props.allowedItemFormValues.split(","));}return !!this.props.allowedItemFormValuesHash[item[n]];}else{if(this.props.prohibitedItemFormValues){if(!this.props.prohibitedItemFormValuesHash){this.props.prohibitedItemFormValuesHash=mstr.$A.toHash(this.props.prohibitedItemFormValues&&this.props.prohibitedItemFormValues.split(","));}return !this.props.prohibitedItemFormValuesHash[item[n]];}}}return true;};ACB.prototype._hasMetAddMax=function LC_hasMetAddMax(){var max=Math.max(0,parseInt(this.props.max)||0);if(max){var sel=this.props.selected;var selItems=sel&&sel.getItems();return(mstr.$A.len(selItems)>=max);}return false;};ACB.prototype._findAddableItem=function LC_findAddableItem(items){if(items){for(var i=0,len=items.length;i<len;i++){if(mstr.utils.ListModelHelper.canAdd(this,items[i])){return items[i];}}}return null;};ACB.prototype._addItemsToSelectedModel=function LC_addItemsToSelectedModel(items){var lm=this.props.selected;if(!lm){return ;}var selIndices=lm.getSelectedIndices();var firstIndex=mstr.$A.sortNumericArray(mstr.$A.fromHashKeys(selIndices,true))[0];lm.insertItemsAt(items,(firstIndex!=null)?firstIndex:-1);};ACB.prototype._getAvailableOriginInfo=function ACB_avOriginInfo(){var av=this.get("available"),conNode=av&&av.getContainer(),conId=conNode&&conNode.value&&conNode.value.dssid,blockBegin=(av&&av.get("blockBegin"))||1,searchPattern=(av&&av.get("searchPattern"))||"";return{containerId:conId,searchPattern:searchPattern,blockBegin:blockBegin};};ACB.prototype._markItemsWithOrigin=function ACB_markItemsWithOrigin(items){var len=items&&items.length;if(!len){return null;}var avOrigin=this._getAvailableOriginInfo(),conId=avOrigin.containerId,blockBegin=avOrigin.blockBegin,searchPattern=avOrigin.searchPattern;var av=this.props.available,avItems=av&&av.getItems(),searchResult=avItems&&mstr.$A.findByFormMultiple(avItems,items,"dssid",true),searchIndices=searchResult&&searchResult.indices||[];for(var i=0;i<len;i++){var item=items[i];if(searchIndices[i]>-1){item.origin={containerId:conId,searchPattern:searchPattern,blockOrdinal:blockBegin+searchIndices[i]};}else{if(!item.origin){items.origin={containerId:null,searchPattern:"",blockOrdinal:null};}}}return searchResult;};ACB.prototype._computeAllowedAddCount=function LC_compAllowedAddCount(){var sel=this.props.selected;if(!sel){return 0;}if(!this.props.allowAddAlways){var max=Math.max(0,parseInt(this.props.max)||0);if(max){var items=sel.getItems();max-=mstr.$A.len(items);return Math.max(0,max);}}return -1;};ACB.prototype.updateCommandEnabledRemove=function LC_upCERemove(){var sel=this.props.selected;var selItems=sel&&sel.getSelectedItems();var bRemoveEnabled=!!mstr.$A.len(selItems);this.set("CommandEnabledRemove",bRemoveEnabled);};ACB.prototype.updateCommandEnabledRemoveAll=function LC_upCERemoveAll(){var sel=this.props.selected;var items=sel&&sel.getItems();var bRemoveAllEnabled=!!mstr.$A.len(items);this.set("CommandEnabledRemoveAll",bRemoveAllEnabled);};function ACB(props){mstr.models.BaseModel.apply(this,[props]);}return ACB;})();mstr.models.ListCart=(function(){mstr.$O.extendsClass(LC,mstr.models.AbstractCartBase);LC.prototype.init=function LC_init(){mstr.models.AbstractCartBase.prototype.init.apply(this);this._initAvailableFilteredList();this._updateAvailableFilteredItems();this.updateCommandEnabledAdd();this.updateCommandEnabledAddAll();this.updateCommandEnabledRemove();this.updateCommandEnabledRemoveAll();var av=this.props.available;if(av){av.attachEventListener(this,"set_readyState","_updateAvailableFilteredItems");}var avf=this.props.availableFiltered;if(avf){avf.attachEventListener(this,"listadd_items","onAddRmvItemsFromAvailFilt");avf.attachEventListener(this,"listremove_items","onAddRmvItemsFromAvailFilt");avf.attachEventListener(this,"hashadd_selectedIndices","updateCommandEnabledAdd");avf.attachEventListener(this,"hashremove_selectedIndices","updateCommandEnabledAdd");}var sel=this.props.selected;if(sel){sel.attachEventListener(this,"listadd_items","onAddItemsToSelectedModel");sel.attachEventListener(this,"listremove_items","onRemoveItemsFromSelectedModel");sel.attachEventListener(this,"hashadd_selectedIndices","updateCommandEnabledRemove");sel.attachEventListener(this,"hashremove_selectedIndices","updateCommandEnabledRemove");}};LC.prototype.onAddRmvItemsFromAvailFilt=function LC_onAddRmvAvF(){this.updateCommandEnabledAdd();this.updateCommandEnabledAddAll();};LC.prototype.onAddItemsToSelectedModel=function LC_onAddToSel(){this.updateCommandEnabledRemoveAll();var max=Math.max(0,parseInt(this.props.max)||0);if(max){this.updateCommandEnabledAdd();this.updateCommandEnabledAddAll();}};LC.prototype.onRemoveItemsFromSelectedModel=function LC_onRmvFromSel(){this.updateCommandEnabledRemoveAll();this.updateCommandEnabledRemove();var max=Math.max(0,parseInt(this.props.max)||0);if(max){this.updateCommandEnabledAdd();this.updateCommandEnabledAddAll();}};LC.prototype._initAvailableFilteredList=function LC_initAvailableFilteredList(){var ps=this.props.available&&this.props.available.props;ps=mstr.$H.clone(ps);ps.items=[];ps.id=mstr.controllers.Factory.nextFreeId();ps.parent=this;var avf=new mstr.models.ListModel(ps);if(!avf){return ;}this.props.availableFiltered=avf;mstr.controllers.Factory.add(avf);avf.init&&avf.init();};LC.prototype._updateAvailableFilteredItems=function LC_updateAvailableFilteredItems(){var av=this.props.available;if(!av){return ;}if(this.props.keepAvailableSorted!==false){var avItems=av.getItems(),len=avItems&&avItems.length||0;if(len){var avOrigin=this._getAvailableOriginInfo(),conId=avOrigin.containerId,blockBegin=avOrigin.blockBegin,searchPattern=avOrigin.searchPattern;for(var i=0;i<len;i++){avItems[i].origin={containerId:conId,searchPattern:searchPattern,blockOrdinal:blockBegin+i};}}}var avf=this.props.availableFiltered;if(!avf){return ;}avf.set("searchPattern",this._getAvailableOriginInfo().searchPattern||"");var rs=av.get("readyState");avf.props.requestContext=av.props.requestContext;avf.set("readyState",rs);this.updateCommandEnabledAdd();this.updateCommandEnabledAddAll();if(rs!=mstr.Enum.Widget.READYSTATE.IDLE){return ;}var itemsCopy=[].concat(av.getItems());if(!this.props.keepAvailableItems){if(this.props.selected){var itemsToRemove=this.props.selected.getItems();var f=avf.get("valueForm");if(f){if(this.props.keepAvailableSorted===false){itemsCopy=mstr.$A.removeItemsByForm(itemsCopy,itemsToRemove,f);}else{var searchResult=this._markItemsWithOrigin(itemsToRemove);if(searchResult){itemsCopy=mstr.$A.remove(itemsCopy,searchResult.indices);}}}else{itemsCopy=mstr.$A.removeItems(itemsCopy,itemsToRemove);}}}avf.setItems(itemsCopy);if(itemsCopy&&itemsCopy.length){avf.execCommand("SingleSelect",0);}};LC.prototype.execAdd=function LC_execAdd(){var allowedCount=this._computeAllowedAddCount();if(!allowedCount){return ;}var avfModel=this.props.availableFiltered;if(!avfModel){return ;}var avfIndices=avfModel.getSelectedIndices();var avfCount=mstr.$H.len(avfIndices);if(!avfCount){return ;}var addableInfo=this._findAddableItemsInIndices(mstr.$A.sortNumericArray(mstr.$A.fromHashKeys(avfIndices,true)),allowedCount);if(addableInfo.count){this._addItemsToSelectedModel(addableInfo.itemsToAdd);if(!this.props.keepAvailableItems){avfModel.removeItemsAt(addableInfo.indicesToAdd);}else{var results=avfModel.indexOfMultiple(addableInfo.itemsToAdd);if(results&&results.foundCount){var lastIndex=results.indices[results.foundCount-1];avfModel.execCommand("SingleSelect",lastIndex+1);}}}};LC.prototype.execAddAll=function LC_execAddAll(){var t1=new Date();var allowedCount=this._computeAllowedAddCount();if(!allowedCount){return ;}var avfModel=this.props.availableFiltered;if(!avfModel){return ;}var avfItems=avfModel.getItems();var avfCount=mstr.$A.len(avfItems);if(!avfCount){return ;}var arrIndices=new Array(avfCount);for(var i=0;i<avfCount;i++){arrIndices[i]=i;}var addableInfo=this._findAddableItemsInIndices(arrIndices,allowedCount);if(addableInfo.count){this._addItemsToSelectedModel(addableInfo.itemsToAdd);if(!this.props.keepAvailableItems){avfModel.removeItemsAt(addableInfo.indicesToAdd,true);}}};LC.prototype.execRemove=function LC_execRemove(){var selModel=this.props.selected;if(!selModel){return ;}var selIndices=selModel.getSelectedIndices();var selCount=mstr.$H.len(selIndices);if(!selCount){return ;}var arrIndices=mstr.$A.sortNumericArray(mstr.$A.fromHashKeys(selIndices,true));var items=selModel.getItems();var itemsToRemove=new Array(selCount);for(var i=0;i<selCount;i++){itemsToRemove[i]=items[arrIndices[i]];}selModel.removeItemsAt(arrIndices,true);if(!this.props.keepAvailableItems){this._addItemsToAvailableFilteredModel(itemsToRemove);}};LC.prototype.execRemoveAll=function LC_execRemoveAll(){var selModel=this.props.selected;if(!selModel){return ;}var selItems=selModel.getItems();var selCount=mstr.$A.len(selItems);if(!selCount){return ;}if(!this.props.keepAvailableItems){this._addItemsToAvailableFilteredModel(selItems.slice(0,selCount));}selModel.removeItemsAtRanges([{min:0,max:selCount-1}],true);};LC.prototype.updateCommandEnabledAdd=function LC_upCEAdd(){var bAddEnabled=true;if(!this.props.allowAddAlways&&this._hasMetAddMax()){bAddEnabled=false;}else{var avf=this.props.availableFiltered;if(!avf||!this._findAddableItem(avf.getSelectedItems())||avf.get("readyState")==mstr.Enum.Widget.READYSTATE.ERROR){bAddEnabled=false;}}this.set("CommandEnabledAdd",bAddEnabled);};LC.prototype.updateCommandEnabledAddAll=function LC_upCEAddAll(){var bAddAllEnabled=true;if(!this.props.allowAddAlways&&this._hasMetAddMax()){bAddAllEnabled=false;}else{var avf=this.props.availableFiltered;if(!avf||!this._findAddableItem(avf.getItems())||avf.get("readyState")==mstr.Enum.Widget.READYSTATE.ERROR){bAddAllEnabled=false;}}this.set("CommandEnabledAddAll",bAddAllEnabled);};LC.prototype._addItemsToAvailableFilteredModel=function LC_addItemsToAFM(items){var lm=this.props.availableFiltered;if(!lm){return ;}if(this.props.keepAvailableSorted===false){this._insertItemsIntoAvailableFiltered(items,-1);}else{var groups=this._groupByOrigin(items),firstInsertAt=null;for(var groupId in groups){var groupItems=groups[groupId],sortedItems=groupItems&&groupItems.sort(LC.ordinalSorter),contigItems=sortedItems&&this._contiguousOrdinals(sortedItems);for(var key in contigItems){var contigGroup=contigItems[key],insertAt=this._computeInsertionIndexForAvailableFiltered(contigGroup);if(firstInsertAt==null){firstInsertAt=insertAt>-1?insertAt:(lm.props.items||[]).length;lm.execCommand("ClearSelect");}this._insertItemsIntoAvailableFiltered(contigGroup,insertAt);this.execCommand("Select",mstr.utils.Hash.fromRanges([{min:insertAt,max:insertAt+contigGroup.length-1}]));}}lm.set("leadIndex",firstInsertAt);}};LC.prototype._contiguousOrdinals=function LC_contOrds(items){var groups={},lastKey=null,lastOrdinal=null;for(var i=0,len=items&&items.length||0;i<len;i++){var item=items[i],origin=item&&item.origin,ord=origin&&origin.blockOrdinal;if(lastKey!=null&&(lastOrdinal==ord-1)){groups[lastKey].push(item);}else{lastKey=ord;if(groups[lastKey]){groups[lastKey].push(item);}else{groups[lastKey]=[item];}}lastOrdinal=ord;}return groups;};LC.prototype._groupByOrigin=function LC_groupByOrigin(items){var groups={};for(var i=0,len=items&&items.length||0;i<len;i++){var item=items[i],origin=item&&item.origin,conId=origin&&origin.containerId||"null",search=origin&&origin.searchPattern||"",groupId=conId+"-"+search,arr=groups[groupId];if(!arr){arr=groups[groupId]=[];}arr.push(item);}return groups;};LC.ordinalSorter=function LC_ordinalSorter(item1,item2){var org1=item1&&item1.origin,ord1=org1&&org1.blockOrdinal,org2=item2&&item2.origin,ord2=org2&&org2.blockOrdinal;if(ord1!=null&&ord2!=null){return ord1-ord2;}else{if(ord1!=null){return -1;}else{if(ord2!=null){return 1;}else{return 0;}}}};LC.prototype._computeInsertionIndexForAvailableFiltered=function LC_cmpAFInsertIndex(items){var o=items&&items[0],origin=o&&o.origin,conId=origin&&origin.containerId,search=origin&&origin.searchPattern,ordinal=origin&&origin.blockOrdinal;if(!o){return -1;}var avf=this.props.availableFiltered,avfItems=avf&&avf.getItems(),avOrigin=this._getAvailableOriginInfo(),avConId=avOrigin.containerId,avSearch=avOrigin.searchPattern;var insertAt=-1;if(avConId&&avConId==conId&&avSearch==search){for(var i=0,len=avfItems&&avfItems.length||0;i<len;i++){var avfItem=avfItems[i];if(avfItem.origin&&avfItem.origin.containerId==conId&&avfItem.origin.searchPattern==search){if(avfItem.origin.blockOrdinal>ordinal){insertAt=i;break;}}else{insertAt=i;break;}}}return insertAt;};LC.prototype._insertItemsIntoAvailableFiltered=function LC_insItemsIntoAF(items,index){var lm=this.props.availableFiltered;if(!lm){return ;}lm.insertItemsAt(items,index);var indices={},start=(index>-1)?index:mstr.$A.len(lm.getItems()),count=mstr.$A.len(items);for(i=0;i<count;i++){indices[start+i]=true;}lm.execCommand("Select",indices);lm.set("leadIndex",start);};LC.prototype._findAddableItemsInIndices=function LC_findAddableItemsInIndices(indices,maxCount){var result={indicesToAdd:[],itemsToAdd:[],count:0};var avf=this.props.availableFiltered;var items=avf&&avf.getItems();if(!items){return result;}var sel=this.props.selected;if(!sel){return result;}var formName=sel.get("valueForm");var lookup=null;for(var i=0,len=mstr.$A.len(indices);i<len;i++){var index=indices[i];var item=items[index];if(mstr.utils.ListModelHelper.canAdd(this,item)){var bAlreadyAdded=false;if(formName){if(!lookup){lookup=mstr.utils.Hash.generateItemArrayLookup(sel.getItems(),formName);}var formValue=item[formName];bAlreadyAdded=(lookup[formValue]!=null);}else{bAlreadyAdded=(sel.indexOfItem(item)>-1);}if(!bAlreadyAdded){result.indicesToAdd[result.count]=index;result.itemsToAdd[result.count]=item;result.count++;if(result.count==maxCount){break;}}}}return result;};function LC(props){mstr.models.AbstractCartBase.apply(this,[props]);}return LC;})();mstr.models.AbstractTreeBase=(function(){mstr.$O.extendsClass(ATB,mstr.models.BaseModel);ATB.NEXT_NODE_ID=0;ATB.PATHDELIM="/";ATB.prototype.getNodeAt=function ATB_getNodeAt(path){var parts=this._pathParts(path);switch(parts.length){case 0:return null;case 1:return this.props.rootNode;default:var node=this.props.rootNode;var len=parts.length;for(var i=1;i<len;i++){node=node.children&&node.children[parts[i]];if(!node){break;}}return node;}};ATB.prototype.getNodePath=function ATB_getNodePath(node,nodeAncestorLimit){var indices=this.getNodePathIndices(node,nodeAncestorLimit);if(indices&&indices.join){return indices.join(ATB.PATHDELIM);}};ATB.prototype.getNodePathIndices=function ATB_getNodePathIndices(node,nodeAncestorLimit){if(!node){return null;}if(!nodeAncestorLimit){nodeAncestorLimit=this.props.rootNode;}var indices=[];while(node){var index=node.parent?mstr.utils.Trees.findChildIndex(node.parent,node):0;if(index>-1){indices.push(index);node=node.parent;}else{break;}}return indices.reverse();};ATB.prototype._silentInsertNodesAt=function ATB_silentInsertNodesAt(nodes,path){var len=mstr.$A.len(nodes);if(!len||path==null){return false;}var pathParts=this._pathParts(path);if(pathParts.length>1){var childIndex=pathParts.pop();var parentNode=this.getNodeAt(pathParts.join(ATB.PATHDELIM));if(!mstr.utils.Trees.insertChildNodes(parentNode,nodes,childIndex,this.getId())){return false;}}else{len=1;nodes=[nodes[0]];this.props.rootNode=nodes[0];nodes[0].parent=null;}for(var i=0;i<len;i++){this._validateNodeId(nodes[i]);}return true;};ATB.prototype._silentRemoveNode=function ATB_silentRemoveNode(node){if(!node){return false;}if(node.parent){return mstr.utils.Trees.removeChildNode(node.parent,node);}else{if(node==this.props.rootNode){this.props.rootNode=null;node.treeId=null;return true;}}return false;};ATB.prototype.getSelectedNodes=function ATB_getSelectedNodes(){return this.props.selections;};ATB.prototype.getSelectedNode=function ATB_getSelectedNode(){return mstr.$H.firstItem(this.props.selections);};ATB.prototype._isSingleFilterNode=function ATB_isSingleFilterNode(node){var nv=node&&node.value;if(nv&&(nv.stp==256||nv.tp==1)){var p=node.parent&&node.parent.value;if(p&&p.filters&&p.filters.length==1){return true;}}return false;};ATB.prototype.getViewableSelectedItems=function LM_getViewableSelectedItems(){var items=[];var nodes=this.props.selections;for(var id in nodes){var node=nodes[id];if(node&&node.value){if(this._isSingleFilterNode(node)){items.push(node.parent.value);}else{items.push(node.value);}}}return items;};ATB.prototype.getSelectedItems=function ATB_getSelectedItems(){var items=[];var nodes=this.props.selections;for(var id in nodes){var node=nodes[id];if(node&&node.value){items.push(node.value);}}return items;};ATB.prototype.getSelectedItem=function ATB_getSelectedItem(){var nodes=this.props.selections,node;for(var id in nodes){node=nodes[id];if(node&&node.value){return node.value;}}return null;};ATB.prototype.getSelectedPaths=function ATB_getSelectedPaths(bSorted){var selNodes=this.props.selections;var selNode,count=0,arrPaths=[];for(var id in selNodes){selNode=selNodes[id];if(selNode){arrPaths[count]=this.getNodePath(selNode);count++;}}if(count>1&&bSorted){arrPaths=this._sortPaths(arrPaths);}return arrPaths;};ATB.prototype.setSelectedPaths=function ATB_setSelectedPaths(paths){var len=mstr.$A.len(paths);var nodes=new Array(len);for(var i=0;i<len;i++){nodes[i]=this.getNodeAt(paths[i]);}return this.execSelect(nodes);};ATB.prototype._selectNodes=function ATB_selectNodes(nodes){var len=mstr.$A.len(nodes);if(len){var keys={};for(var i=0;i<len;i++){var node=nodes[i];if(!node){continue;}this._validateNodeId(node);keys[node.id]=node;}return this.hashadd("selections",keys);}return false;};ATB.prototype._unselectNodes=function ATB_unselectNodes(nodes){var len=mstr.$A.len(nodes);if(len){var keys={};for(var i=0;i<len;i++){var node=nodes[i];if(!node||!node.id){continue;}keys[node.id]=true;}return this.hashremove("selections",keys);}return false;};ATB.prototype._isNodeSelected=function ATB_isNodeSelected(node){if(node&&node.id){var sel=this.props.selections;return !!(sel&&sel[node.id]);}return false;};ATB.prototype._hasMultiSelections=function ATB_hasMultiSelections(){return !!mstr.utils.Hash.lenGreaterThan(this.props.selections,1);};ATB.prototype.execClearSelect=function ATB_exClearSelect(){var currentSel=mstr.$H.clone(this.props.selections);this.hashremove("selections",currentSel);this.props.anchorNode=null;};ATB.prototype.execSelect=function ATB_exSelect(nodes){this.execClearSelect();this.props.anchorNode=nodes&&nodes[0];return this._selectNodes(nodes);};ATB.prototype.execSingleSelect=function ATB_exSingleSelect(node){if(this._isNodeSelected(node)&&!this._hasMultiSelections()){return false;}return this.execSelect([node]);};ATB.prototype.execEditNode=function ATB_execEditNode(node){this.set("editNode",node);return !!node;};ATB.prototype.find=function ATB_find(start,item){return mstr.utils.Trees.find(start,item);};ATB.prototype.findByNodeId=function ATB_findByNodeId(id){return mstr.utils.Trees.findByNodeForm(this.props.rootNode,id,"id");};ATB.prototype.findByForm=function ATB_findByForm(start,formValue,formName){return mstr.utils.Trees.findByForm(start,formValue,formName);};ATB.prototype.pathOfItem=function ATB_pathOfItem(item){var vf=this.props.valueForm;if(vf!=null){return this.pathOfValue(item&&item[vf]);}else{var node=this.find(this.props.rootNode,item);return node?this.getNodePath(node):null;}};ATB.prototype.pathOfValue=function ATB_pathOfValue(value){var vf=this.props.valueForm;if(vf!=null){var node=this.findByForm(this.props.rootNode,value,vf);return node?this.getNodePath(node):null;}return null;};ATB.prototype._pathParts=function ATB_pathParts(path){var parts=[];if(path){parts=path&&path.split(ATB.PATHDELIM);for(var i=0,len=parts.length;i<len;i++){parts[i]=parseInt(parts[i]);}}return parts;};ATB.prototype._validateNodeId=function ATB_validateNodeId(node){if(node){if(!node.id){node.id=this.props.id+"_"+ATB.NEXT_NODE_ID++;}node.treeId=this.props.id;if(node.children){var c=node.children;for(var i=0,len=mstr.$A.len(c);i<len;i++){this._validateNodeId(c[i]);}}}};ATB.prototype._unflattenNodes=function ATB_unflattenNodes(nodes){var len=mstr.$A.len(nodes);if(!len){return ;}for(var i=0;i<len;i++){this._silentInsertNodesAt([{value:nodes[i].value}],nodes[i].path);}};ATB.prototype._sortPaths=function ATB_sortPaths(paths){var len=mstr.$A.len(paths);if(!len){return[];}var pathList=new Array(len);for(var i=0;i<len;i++){pathList[i]={originalIndex:i,pathIndices:this._pathParts(paths[i])};}pathList=pathList.sort(ATB._pathListSorter);var sortedPaths=new Array(len);for(var i=0;i<len;i++){sortedPaths[i]=paths[pathList[i].originalIndex];}return sortedPaths;};ATB._pathListSorter=function ATB_pathListSorter(pathInfo1,pathInfo2){return mstr.models.AbstractTreeBase._comparePathIndices(pathInfo1&&pathInfo1.pathIndices,pathInfo2&&pathInfo2.pathIndices);};ATB._comparePathIndices=function ATB_comparePathIndices(indices1,indices2){var len=Math.max(indices1&&indices1.length,indices2&&indices2.length);if(len&&indices1&&indices2){for(var i=0;i<len;i++){if((indices1[i]==null)&&(indices2[i]!=null)){return -1;}else{if((indices1[i]!=null)&&(indices2[i]==null)){return 1;}else{if(indices1[i]<indices2[i]){return -1;}else{if(indices1[i]>indices2[i]){return 1;}}}}}}return 0;};ATB.prototype.clone=function ATB_clone(){var ps=mstr.$H.clone(this.props);ps.id=mstr.controllers.Factory.nextFreeId();if(ps.rootNode){ps.rootNode=mstr.utils.Trees.cloneSubTree(ps.rootNode);}ps.selections={};var m=mstr.controllers.Factory.create(ps);if(!m){return null;}mstr.controllers.Factory.add(m);m.init&&m.init();m.setSelectedPaths(this.getSelectedPaths());return m;};ATB.prototype.init=function ATB_init(){mstr.models.BaseModel.prototype.init.apply(this);this._initRoot();this._initSelectedPathList(this.props.selectedPathList);};ATB.prototype._initRoot=function ATB_initRoot(){var root=this.props.rootNode;if(root){this._validateNodeId(root);}else{if(this.props.flattenedNodes){this._unflattenNodes(this.props.flattenedNodes);}}};ATB.prototype._initSelectedPathList=function ATB_initSelPathList(pathList){if(!pathList){return ;}var paths=pathList.split(",");var len=paths.length;var nodes=[];var node;for(var i=0;i<len;i++){node=this.getNodeAt(paths[i]);if(node){nodes.push(node);}}this.execSelect(nodes);};function ATB(props){mstr.models.BaseModel.apply(this,[props]);if(!this.props.selections){this.props.selections={};}}return ATB;})();mstr.models.TreeModel=(function(){mstr.$O.extendsClass(TM,mstr.models.AbstractTreeBase);TM.prototype.getRootNode=function TM_getRootNode(){return this.props.rootNode;};TM.prototype.setRootNode=function TM_setRootNode(root){var wasRoot=this.props.rootNode;if(wasRoot==root){return true;}if(wasRoot){if(!this.removeNodesAt(["0"])){return false;}}if(root){return this.insertNodesAt([root],"0");}else{return !!wasRoot;}};TM.prototype.insertNodesAt=function TM_insertNodesAt(nodes,path){if(this._silentInsertNodesAt(nodes,path)){this.raiseEvent("insertNodes",{nodes:nodes,at:path,count:nodes.length});return true;}return false;};TM.prototype.removeNodesAt=function TM_removeNodesAt(paths,bSorted){var len=mstr.$A.len(paths);if(!len){return false;}if(!bSorted){paths=this._sortPaths(paths);}var pathsRemoved=[],node,path;for(var i=len-1;i>-1;i--){path=paths[i];node=this.getNodeAt(path);if(this._silentRemoveNode(node)){pathsRemoved.push(path);}}if(pathsRemoved.length){this.raiseEvent("removeNodes",{at:pathsRemoved});return true;}return false;};TM.prototype.removeAllChildNodes=function TM_removeAllChildNodes(node){if(!node){return false;}var len=mstr.$A.len(node.children);if(!len){return false;}if(mstr.utils.Trees.removeAllChildNodes(node)){var path=this.getNodePath(node);var paths=new Array(len);var counter=0;for(var i=len-1;i>-1;i--){paths[counter]=path+mstr.models.AbstractTreeBase.PATHDELIM+i;counter++;}this.raiseEvent("removeNodes",{at:paths});return true;}return false;};TM.prototype.execToggleSelect=function TM_exToggleSelect(node){if(!node){return false;}if(this._isNodeSelected(node)){return this._unselectNodes([node]);}else{var sib=mstr.$H.firstItem(this.props.selections);if(sib&&sib.parent==node.parent){this.props.anchorNode=node;return this._selectNodes([node]);}else{return this.execSingleSelect(node);}}};TM.prototype.execRangeSelect=function TM_exRangeSelect(node){var anchor=this.props.anchorNode;var nodes=this._buildNodeRange(node,anchor);if(mstr.$A.len(nodes)){var retVal=this.execSelect(nodes);this.props.anchorNode=anchor;return retVal;}else{return this.execSingleSelect(node);}};TM.prototype.execSelectString=function TM_execSelectString(s){if(!s){return false;}var info=this.firstSelectionByIndex(),sibs=info&&info.node&&info.node.parent&&info.node.parent.children;if(!sibs){return false;}var regExp=new RegExp("^"+s,"i"),index=mstr.utils.Trees.matchByForm(sibs,regExp,"n",info.childIndex+1);return(index>-1)&&this.execSingleSelect(sibs[index]);};TM.prototype.firstSelectionByIndex=function TM_firstSelectionByIndex(){var sel=this.props.selections;node=mstr.$H.firstItem(sel),childIndex=mstr.utils.Trees.findChildIndex(node&&node.parent,node);if((childIndex>-1)&&mstr.$H.lenGreaterThan(sel,1)){var p=node.parent,c=p&&p.children;for(var i=0;i<childIndex;i++){if(sel[c[i].id]){childIndex=i;break;}}}return{node:node,childIndex:childIndex};};TM.prototype.lastSelectionByIndex=function TM_lastSelectionByIndex(){var sel=this.props.selections;node=mstr.$H.firstItem(sel),childIndex=mstr.utils.Trees.findChildIndex(node&&node.parent,node);if((childIndex>-1)&&mstr.$H.lenGreaterThan(sel,1)){var p=node.parent,c=p&&p.children;for(var i=mstr.$A.len(c)-1;i>childIndex;i--){if(sel[c[i].id]){childIndex=i;break;}}}return{node:node,childIndex:childIndex};};TM.prototype._buildNodeRange=function TM_buildNodeRange(node1,node2){if(node1&&node2&&node1.parent&&node1.parent==node2.parent){var nodes=[],p=node1.parent,c=p.children,index1=mstr.utils.Trees.findChildIndex(p,node1),index2=mstr.utils.Trees.findChildIndex(p,node2),start=Math.min(index1,index2),fin=Math.max(index1,index2);var child;for(var i=start;i<=fin;i++){child=c[i];if(child){nodes.push(child);}}return nodes;}return null;};TM.prototype.importListModel=function TM_importListModel(lm,autoExpandSelectedNode){if(!lm){return ;}var ps=["dataSourcesXML","objectType","elementSearchRequired","hierarchical","searchMatchCase","searchMatchCaseAvailable"];for(var i=0,l=ps.length;i<l;i++){this.props[ps[i]]=lm.get(ps[i]);}var lmTreeRoot=lm.props&&lm.props.tree&&lm.props.tree.getRootNode(),selNode;var pt=lm.getContainerTree();var ptRoot=pt&&pt.getRootNode();if(ptRoot){selNode=pt.getSelectedNode();if(selNode){ps=["blockBegin","blockCount","totalSize","readyState","searchXML","leafElements"];for(var i=0,l=ps.length;i<l;i++){selNode[ps[i]]=lm.get(ps[i]);}selNode.drillPaths=lm.get("rmc")&&lm.get("rmc").getItems();if(autoExpandSelectedNode){selNode.autoExpand=true;}}}if(lmTreeRoot){var lmTreeParent=selNode||ptRoot;if(lmTreeParent){mstr.utils.Trees.insertChildNodes(lmTreeParent,[lmTreeRoot],0,this.getId());}else{ptRoot=lmTreeRoot;}}if(ptRoot){this.setRootNode(ptRoot);this.execCommand("SingleSelect",selNode);}var items=lm.getItems();var len=mstr.$A.len(items);if(!len){return ;}var newNodes=new Array(len);for(var i=0;i<len;i++){newNodes[i]={value:items[i]};}var insertPathPrefix=null;if(this.getRootNode()){insertPathPrefix=this.getNodePath(this.getSelectedNode());if(insertPathPrefix!=null){insertPathPrefix+=mstr.models.AbstractTreeBase.PATHDELIM;}}else{if(len==1){insertPathPrefix="";}else{this.setRootNode({value:null});insertPathPrefix="0"+mstr.models.AbstractTreeBase.PATHDELIM;}}if(insertPathPrefix!=null){this.insertNodesAt(newNodes,insertPathPrefix+"0");var selNodes=[];var selIndices=lm.getSelectedIndices();if(selIndices){for(var index in selIndices){selNodes.push(newNodes[parseInt(index)]);}}else{selNodes.push(newNodes[0]);}this.execCommand("Select",selNodes);}};TM.prototype.execFetchBlock=function TM_execFetchBlock(blockBegin,node){if(!node){node=this.props.editNode;}if(!node||!blockBegin){return ;}return this.fetchBlock(node,blockBegin,node.searchPattern);};TM.prototype.execFetchFirst=function TM_execFetchFirst(node){return this.execFetchBlock(1,node);};TM.prototype.execFetchPrevious=function TM_execFetchPrevious(node){return this.execFetchBlock(this._computePreviousBlockBegin(node),node);};TM.prototype.execFetchNext=function TM_execFetchNext(node){return this.execFetchBlock(this._computeNextBlockBegin(node),node);};TM.prototype.execFetchLast=function TM_execFetchLast(node){return this.execFetchBlock(this._computeLastBlockBegin(node),node);};TM.prototype.queryEnabledFetchFirst=function TM_qryEnFetchFirst(node){if(node){var s=node.totalSize;var bc=node.blockCount;return(s>0)&&(bc>0)&&(node.blockBegin>1);}return false;};TM.prototype.queryEnabledFetchPrevious=function TM_qryEnFetchPrevious(node){if(node){var b=node.blockBegin;return(b>1)&&(this._computePreviousBlockBegin(node)<b);}return false;};TM.prototype.queryEnabledFetchNext=function TM_qryEnFetchNext(node){return this._computeNextBlockBegin(node)>0;};TM.prototype.queryEnabledFetchLast=function TM_qryEnFetchLast(node){if(node){var b=node.blockBegin;return b>0&&(this._computeLastBlockBegin(node)>b);}return false;};TM.prototype.queryEnabledFetchBlock=function TM_qryEnFetchBlock(node){if(!node||!node.value){node=this.props.editNode;}if(node){var bc=node.blockCount;var s=node.totalSize;return(node.readyState==mstr.Enum.Widget.READYSTATE.IDLE)&&(bc>0)&&(s>0)&&(bc<s);}return(!node);};TM.prototype._computePreviousBlockBegin=function TM_compPrevBB(node){if(node){var s=node.totalSize;var bc=node.blockCount;if(s>0&&bc>0){return Math.max(1,node.blockBegin-bc);}}return -1;};TM.prototype._computeNextBlockBegin=function TM_compNextBB(node){if(node){var s=node.totalSize;var bc=node.blockCount;if(s>0&&bc>0){if(node.blockBegin+bc<=s){return node.blockBegin+bc;}}}return -1;};TM.prototype._computeLastBlockBegin=function TM_compLastBB(node){if(node){var s=node.totalSize;var bc=node.blockCount;if(s>0&&bc>0){var offset=s%bc;if(offset==0){offset=bc;}return s-offset+1;}}return -1;};TM.prototype.getFetchBlockModel=function TM_getFetchBlockModel(){var model=this.props.fetchBlockModel;if(!model){model=new mstr.models.ConstantPromptAnswer({parent:this,dataType:mstr.Enum.Nodes.DATATYPE.INTEGER});if(!model){return null;}mstr.controllers.Factory.add(model);model.init&&model.init();this.props.fetchBlockModel=model;}var node=this.props.editNode;if(!node){return null;}var s=parseInt(node.totalSize)||0;model.set("min",Math.min(1,s));model.set("max",s);model.set("valueString",parseInt(node.blockBegin)||"");return model;};TM.prototype.getNodeBrowseType=function TM_getNodeBrowseType(node,bAllowBrowseFolder,bAllowBrowseAttribute,bAllowBrowseHierarchy){if(bAllowBrowseFolder==null){bAllowBrowseFolder=true;}if(bAllowBrowseAttribute==null){bAllowBrowseAttribute=true;}if(bAllowBrowseHierarchy==null){bAllowBrowseHierarchy=true;}if(!bAllowBrowseFolder&&!bAllowBrowseAttribute&&!bAllowBrowseHierarchy){return null;}var nv=node&&node.value;if(!nv){return null;}if(nv.locked){return null;}switch(parseInt(nv.tp)){case mstr.Enum.MSTRFolderItem.TYPE.PROJECT:return null;case mstr.Enum.MSTRFolderItem.TYPE.FOLDER:return bAllowBrowseFolder?"BrowseFolder":null;break;default:if(!bAllowBrowseHierarchy&&!bAllowBrowseAttribute){return null;}if(node.isWithinHierarchy==null){node.isWithinHierarchy=mstr.utils.ListViewHelper.isWithinHierarchy(node);}if(node.isWithinHierarchy){return bAllowBrowseHierarchy?"BrowseHierarchyItem":null;}else{if(bAllowBrowseAttribute){if(parseInt(node.value.tp)==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE){return"BrowseAttribute";}}}break;}};TM.prototype.fetchBlock=function TM_fetchBlock(node,blockBegin,searchPattern){var buildNewNode=function(node,fv,downPathCount){var newNode={value:fv,autoExpand:true};this.insertNodesAt([newNode],this.getNodePath(node)+mstr.models.AbstractTreeBase.PATHDELIM+"0");this.setNodeReadyState(node,mstr.Enum.Widget.READYSTATE.IDLE);node.totalSize=downPathCount;node.blockCount=downPathCount;node.blockBegin=1;node.leafElements=false;return newNode;};switch(this.getNodeBrowseType(node)){case"BrowseFolder":return this.browseFolderBlock(node.value.dssid,blockBegin,searchPattern,node);break;case"BrowseAttribute":return this.browseAttributeBlock(node.value.dssid,blockBegin,searchPattern,node);break;case"BrowseHierarchyItem":var path=this._buildHierarchyPathForNode(node);var downPaths=[],downPathCount=0,drillPaths=node&&(node.parent&&node.parent.drillPaths||node.value&&node.value.filters);for(var i=0,len=mstr.$A.len(drillPaths);i<len;i++){if(drillPaths[i]&&(drillPaths[i]["drillDir"]=="down"||drillPaths[i]["tp"]=="1")){downPaths.push(drillPaths[i]);downPathCount++;}}if((downPathCount>1&&!searchPattern)||((downPathCount==1)&&downPaths[0]["locked"])){var newNodes=[];for(var i=0;i<downPathCount;i++){newNodes.push({value:downPaths[i]});}this.insertNodesAt(newNodes,this.getNodePath(node)+mstr.models.AbstractTreeBase.PATHDELIM+"0");this.setNodeReadyState(node,mstr.Enum.Widget.READYSTATE.IDLE);node.totalSize=downPathCount;node.blockCount=downPathCount;node.blockBegin=1;node.leafElements=false;}else{var searchOnAttWithFilter=downPathCount>0&&downPaths[0]["tp"]=="1"&&searchPattern;var autoExpand=this.canAutoExpandOnDrill()||searchOnAttWithFilter;if(autoExpand&&(downPathCount==1||searchOnAttWithFilter)&&(!downPaths[0]["locked"]||drillPaths[i]["tp"]=="1")){path+=(downPaths[0].tp=="1"?TM.ELE_FILTER_ATT_DELIM:TM.HIERARCHY_PATHDELIM)+encodeBrowsePathElement(downPaths[0][this.props.valueForm]);node=buildNewNode.call(this,node,downPaths[0],downPathCount);if(node.value.tp=="12"&&node.value.filters&&node.value.filters.length==1){var fv=node.value.filters[0];path+=(fv.tp=="1"?TM.ELE_FILTER_ATT_DELIM:TM.HIERARCHY_PATHDELIM)+encodeBrowsePathElement(fv[this.props.valueForm]);node=buildNewNode.call(this,node,fv,1);}}if(!searchPattern&&this.props.elementSearchRequired){var nv=node&&node.value,ntp=parseInt(nv.tp);if(ntp==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE||ntp==mstr.Enum.MSTRFolderItem.TYPE.FILTER){var npar=node.parent,nparv=npar&&npar.value,npartp=nparv&&nparv.tp;nparpartp=npar&&npar.parent&&npar.parent.value&&npar.parent.value.tp;if((ntp==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE&&npartp==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY&&!mstr.$A.len(nv.filters))||(ntp==mstr.Enum.MSTRFolderItem.TYPE.FILTER&&npartp==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE&&nparpartp==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY)){node.elementSearchRequired=true;this.setNodeReadyState(node,mstr.Enum.Widget.READYSTATE.ERROR);return true;}}}return this.browseHierarchyBlock(path,blockBegin,searchPattern,{commandId:"BrowseHierarchyItem",node:node,searchPattern:searchPattern});}break;}return false;};TM.prototype.browseFolderBlock=function TM_browseFolderBlock(folderId,blockBegin,searchPattern,node){if(!node||!blockBegin||blockBegin<0){return false;}var searchXML="",n=node;while(n&&!searchXML){searchXML=n.searchXML;n=n.parent;}if(!searchXML){searchXML="";}if(!folderId&&!searchXML){return false;}var inputs,memo;if(searchPattern!=null&&searchPattern!=""){inputs=new mstr.http.MetadataSearchRequestInputs(folderId||"",blockBegin,mstr.utils.ListViewHelper.getFetchBlockForTask("searchMetadata"),node.totalSize||0,this.props.objectType||"",searchXML,searchPattern,this.props.dataSourcesXML);memo={commandId:"Search",searchPattern:searchPattern,node:node};}else{inputs=new mstr.http.BrowseFolderRequestInputs(folderId||"",blockBegin,mstr.utils.ListViewHelper.getFetchBlockForTask("searchMetadata"),node.totalSize||0,this.props.hierarchical,this.props.objectType||"",searchXML,this.props.dataSourcesXML);memo={commandId:"BrowseFolder",node:node};}this.submitRequest(inputs,memo);return true;};TM.prototype.browseAttributeBlock=function TM_browseAttributeBlock(attrId,blockBegin,searchPattern,node){if(!node||!attrId||!blockBegin||blockBegin<0){return false;}if(searchPattern==null){searchPattern="";}var inputs=new mstr.http.BrowseAttributeRequestInputs(attrId,blockBegin,mstr.utils.ListViewHelper.getFetchBlockForTask("browseElements"),node.totalSize||0,false,searchPattern,this.props.searchMatchCaseAvailable&&this.props.searchMatchCase,node.filterXML||(node.parent&&node.parent.filterXML)||"",this.props.dataSourcesXML||"");var memo={commandId:"BrowseAttribute",searchPattern:searchPattern,node:node};this.submitRequest(inputs,memo);return true;};TM.prototype.browseHierarchyBlock=function TM_browseHierarchyBlock(path,blockBegin,searchPattern,memo){if(!blockBegin||blockBegin<0){return false;}if(searchPattern==null){searchPattern="";}var inputs=new mstr.http.DataExploreRequestInputs(path,searchPattern,this.props.searchMatchCaseAvailable&&this.props.searchMatchCase,blockBegin,mstr.utils.ListViewHelper.getFetchBlockForTask("browseHierarchy"),this.props.dataSourcesXML||"");this.submitRequest(inputs,memo);return true;};TM.prototype.canAutoExpandOnDrill=function TM_canAEonDrill(){var ae=this.props.autoExpandOnDrill;return(ae===false||ae===true)?ae:mstr.Settings.DataExplorer.AUTOEXPANDONDRILL;};TM.HIERARCHY_PATHDELIM="~";TM.ELE_FILTER_ATT_DELIM=",";TM.prototype._buildHierarchyPathForNode=function LM_buildHIPathForNode(node){var path=[],vf=this.props.valueForm,item,tp,filter;while(node){if(node.hierarchyPath!=null){if(filter&&node.value&&parseInt(node.value.tp)==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE){path.unshift((node.hierarchyPath)+TM.ELE_FILTER_ATT_DELIM+encodeBrowsePathElement(filter[vf]));filter=null;}else{path.unshift((node.hierarchyPath));}break;}else{item=node.value;if(!item){break;}tp=parseInt(item.tp);switch(tp){case mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE:if(filter){path.unshift(encodeBrowsePathElement(item[vf])+TM.ELE_FILTER_ATT_DELIM+encodeBrowsePathElement(filter[vf]));filter=null;break;}case mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY:case mstr.Enum.MSTRFolderItem.TYPE.ELEMENT:path.unshift(encodeBrowsePathElement(item[vf]));filter=null;break;case mstr.Enum.MSTRFolderItem.TYPE.FILTER:filter=item;break;case mstr.Enum.MSTRFolderItem.TYPE.PROJECT:case mstr.Enum.MSTRFolderItem.TYPE.FOLDER:default:tp=null;node=null;filter=null;break;}}if(tp==mstr.Enum.MSTRFolderItem.TYPE.HIERARCHY){break;}node=node&&node.parent;}return path.join(TM.HIERARCHY_PATHDELIM);};TM.prototype.onRequestCallback=function TM_onRequestCallback(req){var ctxt=this.props.requestContext;if(!req||!ctxt||(ctxt.id!=req.id)){return ;}var retVal=mstr.models.AbstractTreeBase.prototype.onRequestCallback.apply(this,[req]);var node=ctxt.memo&&ctxt.memo.node;if(node){this.setNodeReadyState(node,req.readyState);}return retVal;};TM.prototype.setNodeReadyState=function TM_setNodeReadyState(node,rs){if(node){var rsOld=node.readyState;if(parseInt(rsOld)!=parseInt(rs)){node.readyState=rs;this.raiseEvent("set_nodeReadyState",{name:"readyState",node:node,value:rs,valueWas:rsOld});return true;}}return false;};TM.prototype.loadRequestResponse=function TM_loadReqRes(){var ctxt=this.props.requestContext;var node=ctxt&&ctxt.memo&&ctxt.memo.node;if(!node){this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);return ;}var res=ctxt.response;if(!res||!res.data){this.setNodeReadyState(node,mstr.Enum.Widget.READYSTATE.ERROR);this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);return ;}var data=res.data;var lmTreeRoot=data.props&&data.props.tree&&data.props.tree.getRootNode();if(!node.value.did&&!node.value.dssid&&this.getRootNode()==node){var hier=this.props.hierarchical;this.importListModel(data,true);if(hier&&!this.props.hierarchical){this.props.hierarchical=hier;}}else{if(lmTreeRoot){node=node.parent;this.removeAllChildNodes(node);node.children=[lmTreeRoot];lmTreeRoot.parent=node;this.insertNodesAt([lmTreeRoot],this.getNodePath(node)+mstr.models.AbstractTreeBase.PATHDELIM+"0");this.execSingleSelect(node);}else{var ns=["totalSize","blockCount","blockBegin","leafElements"];for(var i=0;i<ns.length;i++){node[ns[i]]=data.get(ns[i]);}node.searchPattern=ctxt.memo.searchPattern;node.drillPaths=data.get("rmc")&&data.get("rmc").getItems();this.removeAllChildNodes(node);var items=data.getItems();var len=mstr.$A.len(items);if(len){var isDimAttNode=node&&node.isWithinHierarchy&&(node.value&&node.value.tp==mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE);var nodes=new Array(len);for(var i=0;i<len;i++){nodes[i]={value:items[i]};if(isDimAttNode&&items[i]&&items[i].tp==mstr.Enum.MSTRFolderItem.TYPE.FILTER){if(node.value&&!node.value.filters){node.value.filters=[];}var filters=node.value&&node.value.filters;if(filters&&(mstr.utils.Arrays.findByForm(filters,items[i][this.props.valueForm],this.props.valueForm)<0)){node.value.filters[node.value.filters.length]=items[i];}}}this.insertNodesAt(nodes,this.getNodePath(node)+mstr.models.AbstractTreeBase.PATHDELIM+"0");}var selNode=this.getSelectedNode();if(selNode&&selNode.parent){this.execSingleSelect(selNode);}else{this.execClearSelect();}}}this.props.requestContext={};this.setNodeReadyState(node,mstr.Enum.Widget.READYSTATE.IDLE);this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);};TM.prototype.cancelRequest=function TM_cancelRequest(reqId){var ctxt=this.props.requestContext;var node=ctxt&&ctxt.memo&&ctxt.memo.node;if(node&&(node.readyState==mstr.Enum.Widget.READYSTATE.WAITING||node.readyState==mstr.Enum.Widget.READYSTATE.SUCCESS)){this.setNodeReadyState(node,mstr.Enum.Widget.READYSTATE.CANCELLED);}var result=mstr.models.AbstractTreeBase.prototype.cancelRequest.apply(this,[reqId]);return result;};TM.prototype.execSearch=function TM_execSearch(searchPattern){return this.execSearchNode({node:this.getSelectedNode(),searchPattern:searchPattern});};TM.prototype.execSearchNode=function TM_execSearchNode(argHash){var node=argHash&&argHash.node,searchPattern=argHash&&argHash.searchPattern;if(!node){return false;}var lastSearch=this.props.searchResultsNode;if(lastSearch&&lastSearch.parent){this.removeNodesAt([this.getNodePath(lastSearch)]);}var resultsNode=this.props.searchResultsNode=this._createSearchResultsNode(node,searchPattern);if(resultsNode){var root=this.props.rootNode;if(!root){return null;}var len=mstr.$A.len(root.children);this.insertNodesAt([resultsNode],"0"+mstr.models.AbstractTreeBase.PATHDELIM+len);var nodeToFetch=resultsNode.children[0];if(nodeToFetch.children&&nodeToFetch.children.length){nodeToFetch=nodeToFetch.children[0];}this.fetchBlock(nodeToFetch,1,searchPattern);this.execSingleSelect(nodeToFetch);return true;}return false;};TM.prototype._createSearchResultsNode=function TM_createSearchResultsNode(searchRootNode,searchPattern){var node=mstr.$H.clone(searchRootNode);node.value=mstr.$H.clone(searchRootNode.value);var searchXML="",n=node;while(n&&!searchXML){searchXML=n.searchXML;n=n.parent;}if(!searchXML){searchXML="";}node.parent=null;node.children=[];node.id=null;node.readyState=mstr.Enum.Widget.READYSTATE.WAITING;node.isWithinHierarchy=mstr.utils.ListViewHelper.isWithinHierarchy(searchRootNode);if(node.isWithinHierarchy){node.hierarchyPath=this._buildHierarchyPathForNode(searchRootNode);if(node.value&&node.value.tp==mstr.Enum.MSTRFolderItem.TYPE.FILTER&&searchRootNode.parent){var attNode=mstr.$H.clone(searchRootNode.parent);attNode.value=mstr.$H.clone(searchRootNode.parent.value);attNode.parent=null;attNode.children=[node];attNode.id=null;attNode.hierarchyPath=this._buildHierarchyPathForNode(searchRootNode.parent);node.parent=attNode;node=attNode;}}var searchFolderNode={value:{icon:"f",tp:-1,n:(microstrategy.descriptors.getDescriptor("538"))+" "+searchPattern,dssid:null},searchXML:searchXML};searchFolderNode.children=[node];node.parent=searchFolderNode;return searchFolderNode;};TM.prototype._updateCommandEnabledSearch=function TM_updateCommandEnabledSearch(){var en=false;var mcAvail=false;var sel=this.props.selections;if(!mstr.$H.lenGreaterThan(sel,1)&&!mstr.$H.isEmpty(sel)){var node=mstr.$H.firstItem(sel);switch(node&&node.value&&parseInt(node.value.tp)){case mstr.Enum.MSTRFolderItem.TYPE.FOLDER:mcAvail=false;en=true;break;case mstr.Enum.MSTRFolderItem.TYPE.ATTRIBUTE:if(node.value.locked){mcAvail=en=false;}else{if(mstr.utils.ListViewHelper.isWithinHierarchy(node)){mcAvail=en=true;}else{mcAvail=en=false;}}break;case mstr.Enum.MSTRFolderItem.TYPE.FILTER:en=mstr.utils.ListViewHelper.isWithinHierarchy(node);mcAvail=en;break;}}this.set("CommandEnabledSearch",en);this.set("searchMatchCaseAvailable",mcAvail);};TM.prototype.on_hashadd_selections=TM.prototype.on_hashremove_selections=function TM_on_change_selections(evt){if(evt&&evt.src==this){this._updateCommandEnabledSearch();}};function TM(props){mstr.models.AbstractTreeBase.apply(this,[props]);}return TM;})();mstr.behaviors.FetchControl=(function(){var FC={};FC.fireFetchCommand=function FC_fireFetchCommand(viewId,cmdId,cmdValue){var v=mstr.$obj(viewId);var m=v&&v.getModel();var t=v.get("targetView");if(!t&&v.get("targetViewPath")){v.props.targetView=t=mstr.controllers.Factory.getPath(v.get("targetViewPath"),v);}if(t&&t.restoreFocus){t.restoreFocus();}if(m&&m.queryCommandEnabled(cmdId)){m.execCommand(cmdId,cmdValue);}};FC.on_set_enabled=function FC_on_set_enabled(view,model,rootTag){var enabled=view.props.enabled;var cells=rootTag.rows[0].cells;enabled=view.props.enabledCaption=enabled&&model&&model.queryCommandEnabled("FetchBlock");var elCaption=cells[2].childNodes[0];elCaption.disabled=!enabled;var cmds=["FetchFirst","FetchPrevious",null,"FetchNext","FetchLast"],gifs=["fetchFirst","fetchPrevious",null,"fetchNext","fetchLast"];for(var i=0;i<cmds.length;i++){if(!cmds[i]){continue;}var en=enabled&&model&&model.queryCommandEnabled(cmds[i]);var iconSuffix=gifs[i]+(en?"":"Disabled");mstr.utils.Dom.setBGIconClass(cells[i].firstChild,iconSuffix);cells[i].firstChild.style.cursor=en?"pointer":"";}};FC.on_set_visible=function FC_on_set_visible(view,model,rootTag){FC.update_css_display(view,rootTag);if(view.props.visible){this.updateCaption(view,model,rootTag);}};FC.update_css_display=function FC_update_css_display(view,rootTag){var ps=view.props,vis=ps.visible,nf=ps.needsFetch;mstr.behaviors.Generic.set_css_display(rootTag,"table","none",!!vis!==false);var cells=rootTag.rows[0].cells;mstr.behaviors.Generic.set_css_display(cells[0].firstChild,"block","none",!!nf!==false);mstr.behaviors.Generic.set_css_display(cells[1].firstChild,"block","none",!!nf!==false);mstr.behaviors.Generic.set_css_display(cells[3].firstChild,"block","none",!!nf!==false);mstr.behaviors.Generic.set_css_display(cells[4].firstChild,"block","none",!!nf!==false);};FC.on_model_set_readyState=function FC_on_model_set_readyState(view,model,rootTag){if(model&&model.get("readyState")==mstr.Enum.Widget.READYSTATE.IDLE){this.updateCaption(view,model,rootTag);}};FC.updateCaption=function FC_updateCaption(view,model,rootTag){var caption=view.props.descriptors.noItems,bNeedsFetch=false;if(model){var b=parseInt(model.props.blockBegin)||0;var c=parseInt(model.props.blockCount)||0;var s=parseInt(model.props.totalSize)||0;if(s&&b){var e=(c>0)?Math.min(b+c-1,s):s;caption=microstrategy.descriptors.getDescriptor("117");caption=caption.replace(/####/,s).replace(/###/,e).replace(/##/,b);bNeedsFetch=(b>1)||(c<s);}}var elCaption=rootTag.rows[0].cells[2].childNodes[0];elCaption.innerHTML=caption;view.props.needsFetch=bNeedsFetch;FC.update_css_display(view,rootTag);};FC.on_mousedown=function(viewId){var view=mstr.$obj(viewId);if(view&&view.props.enabled){view.execCommand("OpenPopup",{popup:mstr.$obj("FetchBlockPopup1")});}return true;};return FC;})();mstr.behaviors.TreeView=(function(){var TV={};TV.isTargetTextbox=function TV_itt(e,hWin){var target=mstr.utils.Events.target(e,hWin);return !!(target&&target.type=="text");};TV.redirectFocus=function TV_redirectFocus(e,hWin,viewId){if(!this.isTargetTextbox(e,hWin)){try{document.getElementById(viewId+"TabStop").focus();}catch(localerr){}}return true;};TV.onmouseupRootParent=function(e,hWin,viewId){if(mstr.utils.ISFF||!this.isTargetTextbox(e,hWin)){mstr.behaviors.Generic.clearBrowserHighlights(hWin);}this.redirectFocus(e,hWin,viewId);return true;};TV.onmousedownRootParent=function(e,hWin,viewId){this.onmousedown(e,hWin,viewId);this.redirectFocus(e,hWin,viewId);return true;};TV.onmousedown=function TV_onmousedown(e,hWin,viewId){var evt=new mstr.lang.Event(e,hWin);var bCTRL=evt.ctrl(),bSHIFT=evt.shift();if(bCTRL||bSHIFT){mstr.utils.Dom.clearBrowserHighlights(hWin);}var view=mstr.$obj(viewId);if(!view||!view.fireCommands){return true;}var cmdValue={nodeId:null,ctrl:bCTRL,shift:bSHIFT,x:evt.x+3,y:evt.y+3};var elTarget=evt.target();var elTargetAnc=mstr.utils.Dom.findAncestor(elTarget,"mstrTreeNodeInfo",null,view.props[mstr.$W.ELEMENT],true);if(elTargetAnc){cmdValue.nodeId=elTargetAnc.mstrTreeNodeInfo;cmdValue.elNode=elTargetAnc;var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(view);cmdValue.expandState=itemRenderer&&itemRenderer.getNodeExpandState&&itemRenderer.getNodeExpandState(elTargetAnc);var elTargetAnc2=mstr.utils.Dom.findAncestor(elTarget,"mstrTreeNodePart",null,elTargetAnc,true);cmdValue.elNodePart=elTargetAnc2;cmdValue.part=elTargetAnc2&&!elTargetAnc2.disabled?elTargetAnc2.mstrTreeNodePart:null;var elTargetAnc3=mstr.utils.Dom.findAncestor(elTarget,"mstrPopupInfo",null,elTargetAnc,true);cmdValue.popup=elTargetAnc3&&!elTargetAnc3.disabled?elTargetAnc3.mstrPopupInfo:null;}view.fireCommands(null,cmdValue);return true;};TV.ondblclick=function TV_ondblclick(e,hWin,viewId){var view=mstr.$obj(viewId);if(!view||!view.fireCommands){return true;}var cmds=view.props.cmdsDblClick;if(!cmds){return true;}view.fireCommands(cmds,null);return true;};return TV;})();mstr.behaviors.ExpandableTreeView=(function(){var ETV={};ETV.renderNode=function ETV_renderTreeNode(view,model,rootTag,context){if(!context||!context.node){return null;}var cssPrefix=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||""),node=context.node,nv=node.value;var bHidden=false;if(!node.parent&&view.props.hideRootNodeTypes&&nv&&nv.tp){var hash=mstr.$A.toHash(String(view.props.hideRootNodeTypes).split(","));bHidden=!!hash[nv.tp];}var el=this.generateNodeElement(node,view.props.document,cssPrefix,bHidden);var extraCss=view&&view.getExtraNodeCssClass&&view.getExtraNodeCssClass(node)||"";if(extraCss){el.className=el.className+" "+extraCss;}var state;if(bHidden||mstr.$A.len(node.children)){state=1;}else{if(node.autoExpand){state=1;}else{switch(parseInt(node.readyState)){case mstr.Enum.Widget.READYSTATE.WAITING:case mstr.Enum.Widget.READYSTATE.SUCCESS:state=1;break;default:state=context.browseType?0:2;break;}}}this._renderNodeExpandState(el,state,view.props.allowExpandCollapse,view.props.autoCollapse&&(node.parent));var parent=context.node.parent;this._renderNodePosition(el,!parent||(parent.children[0]==context.node),!parent||(parent.children[parent.children.length-1]==context.node),!parent);if(model&&model._isNodeSelected(node)){this._renderNodeValueState(view,el,true);}var rs=node.readyState;if(rs!=null){this._renderNodeReadyState(view,model,node,el);}var loc=this.findLocationForNode(context.treeRootParent,model._pathParts(context.path),cssPrefix);mstr.utils.Dom.insertNode(el,loc.parent,loc.before);return el;};ETV.scrollToNode=function ETV_scrollToNode(view,model,rootTag,context){if(!context){return ;}if(context.paddingLeft==null){context.paddingLeft=0;}if(context.paddingRight==null){context.paddingRight=35;}if(context.paddingTop==null){context.paddingTop=0;}if(context.paddingBottom==null){context.paddingBottom=35;}var elScroll=context.treeRootParent.parentNode;if(!elScroll){return ;}if(!context.el){var loc=this.findLocationForNode(context.treeRootParent,model._pathParts(context.path));context.el=loc&&loc.before;}if(!context.el){return ;}var x=(mstr.utils.ISIE4&&!mstr.utils.ISIE8PLUS)?mstr.utils.BoxModel.getElementSumOffsetLeft(context.el,elScroll):mstr.utils.BoxModel.getElementSumOffsetLeftAccurately(context.el,elScroll);var y=(mstr.utils.ISIE4&&!mstr.utils.ISIE8PLUS)?mstr.utils.BoxModel.getElementSumOffsetTop(context.el,elScroll):mstr.utils.BoxModel.getElementSumOffsetTopAccurately(context.el,elScroll);var scrollTo={x:null,y:null};var scrollWidth=elScroll.clientWidth;var scrollLeft=elScroll.scrollLeft;if(x<scrollLeft+context.paddingLeft){scrollTo.x=x+context.paddingLeft;}else{if(x>scrollLeft+scrollWidth-context.paddingRight){scrollTo.x=Math.max(x-scrollWidth+context.paddingRight,0);}}var scrollHeight=elScroll.clientHeight;var scrollTop=elScroll.scrollTop;if(y<scrollTop+context.paddingTop){scrollTo.y=y;}else{if(y>scrollTop+scrollHeight-context.paddingBottom){scrollTo.y=Math.max(y-scrollHeight+context.paddingBottom,0);}}if(scrollTo.x!=null||scrollTo.y!=null){mstr.utils.Animations.scroll(elScroll,scrollTo.x,scrollTo.y);}};ETV.markNodePosition=function ETV_markNodePosition(view,model,rootTag,context){var loc=this.findLocationForNode(context.treeRootParent,model._pathParts(context.path));if(!loc||!loc.before){return ;}var parent=context.node.parent;this._renderNodePosition(loc.before,!parent||(parent.children[0]==context.node),!parent||(parent.children[parent.children.length-1]==context.node),!parent);};ETV._renderNodePosition=function EVT_renderNodePosition(el,bFirst,bLast,bOrphan){var src="",repeat="no-repeat";if(!bOrphan){if(bLast){src="treeViewChildConnectorLast";}else{src="treeViewChildConnector";repeat="repeat-y";}}if(src){mstr.utils.Dom.setBGIconClass(el,src);}"";el.style.backgroundRepeat=repeat;};ETV.markNodeReadyState=function ETV_markNodeReadyState(view,model,rootTag,context){if(model&&context&&context.node&&context.treeRootParent){var path=model.getNodePath(context.node);var loc=this.findLocationForNode(context.treeRootParent,model._pathParts(path));if(!loc||!loc.before){return ;}this._renderNodeReadyState(view,model,context.node,loc.before);}};ETV._renderNodeReadyState=function ETV_renderNodeReadyState(view,model,node,el){if(!node){return ;}var elLong=el.childNodes[1];var elFetch=elLong.childNodes[0],elMsg=elLong.childNodes[1],elChildrenCont=elLong.childNodes[2],elFetch2=elLong.childNodes[3];if(!elFetch){var css=elLong.className;elFetch=elLong.ownerDocument.createElement("div");elLong.appendChild(elFetch);elFetch.className=css.replace("LongDisplay","Fetch");elMsg=elLong.ownerDocument.createElement("div");elLong.appendChild(elMsg);elMsg.className=css.replace("LongDisplay","Msg");var elChildrenCont=elLong.ownerDocument.createElement("div");elLong.appendChild(elChildrenCont);elChildrenCont.className=css.replace("LongDisplay","ChildrenContainer");elFetch2=doc.createElement("div");elLong.appendChild(elFetch2);elFetch2.className=css.replace("LongDisplay","FetchBottom");}var rs=parseInt(node.readyState);if(rs==mstr.Enum.Widget.READYSTATE.IDLE){this._updateFetchControls(view,model,node,elFetch);this._updateFetchControls(view,model,node,elFetch2);}var msg=null,src=null;var descs=view.props.descriptors;switch(rs){case mstr.Enum.Widget.READYSTATE.ERROR:if(node.elementSearchRequired){msg=view.props.descriptors.searchRequiredText+'<br><input type="text" class="mstrTreeViewSearch" onkeypress="mstr.behaviors.ExpandableTreeView.onSearchKeyPress(arguments[0], self, \''+view.props.id+"' ,this.value, '"+node.id+'\' )" /><img src="../style/mstr/images/tbSearchEnabled.gif" align="absmiddle" title="" alt="Search"  onclick="mstr.behaviors.ExpandableTreeView.onClickSearchBtn(\''+view.props.id+"' ,this.previousSibling.value, '"+node.id+"' )\" />";}else{var ctxt=model&&model.props.requestContext,res=ctxt&&ctxt.response,msgDetail=res&&res.errorMessage,msg=descs&&descs.errorText;if(msgDetail){msg=msg+' <a href="javascript:void(0)" onclick="alert(\''+msgDetail.replace(/'/g,"\\'").replace(/[\r\n]/g,"")+"');return false;\">"+(descs&&descs.errorDetailsText)+"</a>";}}src="exclamRed.gif";break;case mstr.Enum.Widget.READYSTATE.WAITING:msg=descs&&descs.waitingText;src="treeLoading.gif";break;case mstr.Enum.Widget.READYSTATE.SUCCESS:msg=descs&&descs.loadingText;src="treeLoading.gif";break;case mstr.Enum.Widget.READYSTATE.CANCELLED:msg=descs&&descs.requestCancelledText;src="exclamRed.gif";break;case mstr.Enum.Widget.READYSTATE.TIMEOUT:msg=descs&&descs.requestTimeOutText;src="exclamRed.gif";break;default:break;}elMsg.style.display=msg?"block":"none";if(msg){elMsg.innerHTML=msg;}elMsg.style.backgroundImage=src?"url(../style/mstr/images/"+src+")":"";};ETV.onSearchKeyPress=function ETV_onSearchKeyPress(e,hWin,viewId,txtValue,nodeId){e=e||hWin.event;if(e.keyCode==13){this.onClickSearchBtn(viewId,txtValue,nodeId);return false;}return true;};ETV.onClickSearchBtn=function ETV_onClkSrchBtn(viewId,txtValue,nodeId){var view=mstr.$obj(viewId),ps=view&&view.props,cmds=ps&&ps.cmdsSearch;if(view&&cmds&&txtValue){var model=ps.model,node=model&&mstr.utils.Trees.findByNodeForm(model.props.rootNode,nodeId,"id");if(node){view.fireCommands(cmds,{node:node,searchPattern:txtValue});}}return true;};ETV._updateFetchControls=function ETV_updateFetchControls(view,model,node,elFetch){if(!node){return ;}if(!elFetch.childNodes[0]){this._buildFetchControls(view,elFetch);if(!elFetch.childNodes[0]){return ;}}var bShow=(node.blockCount>0&&node.totalSize>node.blockCount);if(bShow){elFetch.style.display="block";var elCells=elFetch.childNodes[0].rows[0].cells;var cmds=["FetchFirst","FetchPrevious",null,"FetchNext","FetchLast"];var srcsEnabled=["fetchFirst","fetchPrevious",null,"fetchNext","fetchLast"];var srcsDisabled=["fetchFirstDisabled","fetchPreviousDisabled",null,"fetchNextDisabled","fetchLastDisabled"];var en,elBtn;for(var i=0;i<cmds.length;i++){if(!cmds[i]){continue;}elBtn=elCells[i].childNodes[0];en=!!(model&&model.queryCommandEnabled(cmds[i],node));elBtn.disabled=!en;mstr.utils.Dom.setBGIconClass(elBtn,(en?srcsEnabled[i]:srcsDisabled[i]));elBtn.style.cursor=en?"pointer":"default";}var elCaption=elCells[2].childNodes[0];elCaption.disabled=!(model&&model.queryCommandEnabled("FetchBlock",node));var caption=view.props.descriptors.noItems;if(model&&node){var b=parseInt(node.blockBegin)||0;var c=parseInt(node.blockCount)||0;var s=parseInt(node.totalSize)||0;if(s&&b){var e=(c>0)?Math.min(b+c-1,s):s;caption=view.props.descriptors.incrementalFetchSeparator;caption=caption.replace(/##/,b).replace(/###/,e).replace(/####/,s);}}elCaption.innerHTML=caption;}else{elFetch.style.display="none";}};ETV._buildFetchControls=function ETV_buildFetchControls(view,elNodeFetch){var s='<table cellspacing="0" cellpadding="0" class="{@cssPrefix}TreeViewFetchControl"><tr><td><div class="{@cssPrefix}{@cssClass}FetchButton" mstrTreeNodePart="FetchFirst" >&nbsp;</div></td><td><div class="{@cssPrefix}{@cssClass}FetchButton" mstrTreeNodePart="FetchPrevious" >&nbsp;</div></td><td><div class="{@cssPrefix}{@cssClass}FetchControlText"  onmouseover="if (!this.disabled) this.className += \'Hover\'"  onmouseout="this.className = this.className.replace(/Hover/,\'\')" > </div></td><td><div class="{@cssPrefix}{@cssClass}FetchButton" mstrTreeNodePart="FetchNext" >&nbsp;</div></td><td><div class="{@cssPrefix}{@cssClass}FetchButton" mstrTreeNodePart="FetchLast" >&nbsp;</div></td></tr></table>';s=s.replace(/\{\@cssPrefix\}/gm,view.props.cssPrefix||"");s=s.replace(/\{\@cssClass\}/gm,view.props.cssClass||"");elNodeFetch.innerHTML=s;var elCells=elNodeFetch.childNodes[0].rows[0].cells;elCells[0].childNodes[0].mstrTreeNodePart="FetchFirst";elCells[1].childNodes[0].mstrTreeNodePart="FetchPrevious";elCells[2].childNodes[0].mstrPopupInfo="FetchBlockPopup1";elCells[3].childNodes[0].mstrTreeNodePart="FetchNext";elCells[4].childNodes[0].mstrTreeNodePart="FetchLast";};ETV.markNodeExpandState=function ETV_markNodeExpandState(view,model,rootTag,context){if(!context){return ;}if(!context.el){if(context.path==null){context.path=context.node&&model&&model.getNodePath(context.node);}var loc=this.findLocationForNode(context.treeRootParent,model._pathParts(context.path));if(!loc||!loc.before){return ;}context.el=loc.before;}this._renderNodeExpandState(context.el,context.state,view.props.allowExpandCollapse);if(context.scroll){if(context.state==1){this.scrollToNode(view,model,rootTag,{el:context.el,paddingBottom:70,treeRootParent:view.props.treeRootParent});}}};ETV.getNodeExpandState=function ETV_getNodeExpandState(el){var img=el&&el.childNodes[0]&&el.childNodes[0].childNodes[0];var src=img&&img.className;if(src){if(/Opened/.test(src)){return 1;}else{if(/Closed/.test(src)){return 0;}else{if(/Leaf/.test(src)){return 2;}}}}return 2;};ETV._renderNodeExpandState=function ETV_renderNodeExpandState(el,state,bAllowExpandCollapse,bAutoCollapse){var bgIconSuffix="",display="";state=(state==1&&bAutoCollapse)?0:state;switch(state){case 1:bgIconSuffix="treeNodeOpenedOrphan";display="block";break;case 0:bgIconSuffix="treeNodeClosedOrphan";display="none";break;case 2:bgIconSuffix="treeLeafOrphan";el.onclick=null;display="none";break;default:bgIconSuffix="treeNodeClosedOrphan";display="none";break;}if(!bAllowExpandCollapse){bgIconSuffix="treeLeafOrphan";el.onclick=null;}var img=el&&el.childNodes[0]&&el.childNodes[0].childNodes[0];if(img){mstr.utils.Dom.setBGIconClass(img,bgIconSuffix);}var elLong=el&&el.childNodes[1];if(elLong){elLong.style.display=display;}};ETV.markNodeAsSelected=function ETV_markNodeAsSelected(view,model,rootTag,context){var loc=this.findLocationForNode(context.treeRootParent,model._pathParts(context.path));if(!loc||!loc.before){return ;}this._renderNodeValueState(view,loc.before,true);};ETV.markNodeAsUnselected=function ETV_markNodeAsUnselected(view,model,rootTag,context){var loc=this.findLocationForNode(context.treeRootParent,model._pathParts(context.path));if(!loc||!loc.before){return ;}this._renderNodeValueState(view,loc.before,false);};ETV._renderNodeValueState=function ETV_renderNodeValueState(view,elNode,state){elNode.childNodes[0].childNodes[1].className=state?"Selected":"";};ETV.removeNode=function ETV_removeNode(view,model,rootTag,context){if(!view){return ;}var loc=this.findLocationForNode(view.props.treeRootParent,model._pathParts(context.path));if(!loc||!loc.parent||!loc.before){return ;}loc.parent.removeChild(loc.before);};ETV.generateNodeElement=function ETV_generateNodeElement(node,doc,cssPrefix,bHidden){var nv=node&&node.value;if(!nv){return null;}var el=doc.createElement("div");el.className=cssPrefix+"Node";var elShort=doc.createElement("div");el.appendChild(elShort);elShort.className=cssPrefix+"NodeShortDisplay";elShort.mstrTreeNodePart="value";if(bHidden){elShort.style.display="none";}elShort.onmouseover=this.hover;elShort.onmouseout=this.unhover;var nv=node.value;var icon=nv.icon;if(nv.locked){icon+="_locked";}if(icon){mstr.utils.Dom.setBGIconClass(elShort,icon);}var elConn=doc.createElement("img");elShort.appendChild(elConn);elConn.className=cssPrefix+"NodeConnector";elConn.align="absmiddle";elConn.src="../images/1ptrans.gif";mstr.utils.Dom.setBGIconClass(elConn,"treeLeafLast");elConn.mstrTreeNodePart="connector";if(bHidden){elConn.style.display="none";}var elSpan=doc.createElement("span");elShort.appendChild(elSpan);elSpan.appendChild(doc.createTextNode(nv.n));var desc=nv.desc;elShort.title=(desc!=null&&desc!="")?nv.n+". "+desc:nv.n;var elLong=doc.createElement("div");el.appendChild(elLong);elLong.className=cssPrefix+"NodeLongDisplay";if(bHidden){elLong.style.marginLeft="0px";}var elFetch=doc.createElement("div");elLong.appendChild(elFetch);elFetch.className=cssPrefix+"NodeFetch";if(bHidden){elFetch.style.backgroundImage="none";}var elMsg=doc.createElement("div");elLong.appendChild(elMsg);elMsg.className=cssPrefix+"NodeMsg";var elChildrenCont=doc.createElement("div");elLong.appendChild(elChildrenCont);elChildrenCont.className=cssPrefix+"NodeChildrenContainer";var elFetch2=doc.createElement("div");elLong.appendChild(elFetch2);elFetch2.className=cssPrefix+"NodeFetchBottom";if(bHidden){elFetch2.style.backgroundImage="none";}return el;};ETV.hover=function(e){this.childNodes[1].className+="Hover";};ETV.unhover=function(e){var elSpan=this.childNodes[1];elSpan.className=elSpan.className.replace(/Hover/,"");};ETV.findLocationForNode=function ETV_findLocForNode(elRootParent,pathParts,cssPrefix){var doc=elRootParent&&elRootParent.ownerDocument;if(!doc){return ;}var loc={};loc.parent=elRootParent;loc.before=elRootParent.childNodes[0];for(var i=1,len=pathParts.length;i<len;i++){if(!loc.before){break;}var index=pathParts[i];var elChildrenCont=loc.before.childNodes[1].childNodes[2];loc.parent=elChildrenCont;loc.before=elChildrenCont.childNodes[index];}return loc;};ETV.on_model_set_readyState=function ETV_on_model_set_readyState(model,view,rootTag){var readyState=model&&model.get("readyState");if(readyState==null){readyState=mstr.Enum.Widget.READYSTATE.IDLE;}rootTag.childNodes[0].childNodes[1].style.cursor=(readyState==mstr.Enum.Widget.READYSTATE.WAITING)?"wait":"default";switch(readyState){case mstr.Enum.Widget.READYSTATE.WAITING:var obj=mstr.$obj(rootTag.id);if(!obj){return ;}var ip=obj.getInsertionPoint();if(!ip){return ;}var pp=ip.substr(0,ip.lastIndexOf(mstr.util.Trees.PATH_DELIM));var parentNode=obj.getNodeAt(pp);if(!parentNode){return ;}try{var info=mstr.behaviors.ExpandableTreeView.findElementByPath.apply(rootTag,[pp,false]);var elScrolling=rootTag.childNodes[0].childNodes[1];var el=info.elChild;mstr.util.BoxModel.scrollToElement(elScrolling,el);}catch(localerr){mstr.debug("Inside mstr.layouts.ExpandableTreeView: "+localerr.message);}var blockInfo=obj.getBlockInfoForRequest(obj.getRequestId(),parentNode);var blockInfoText;if(blockInfo){if(blockInfo.blockBegin&&blockInfo.blockEnd>0){blockInfoText=" "+String(blockInfo.blockBegin)+" to "+String(blockInfo.blockEnd);}else{blockInfoText=" all blocks";}}var divClassName="leafLast";if(parentNode&&obj.getFetchState(parentNode)==mstr.features.net.BrowseableTreeNodes.FETCHEDSOME){divClassName="leaf";}var nameNodes=[];var nameNode=rootTag.ownerDocument.createTextNode("Loading "+blockInfoText+"...\xA0\xA0");nameNodes.push(nameNode);var anchor=rootTag.ownerDocument.createElement("a");nameNodes.push(anchor);var f=function(){mstr.$obj(rootTag.id).execCommand(mstr.Cmd.CANCELREQUEST);};anchor.onclick=f;anchor.href="javascript:void(0)";anchor.appendChild(rootTag.ownerDocument.createTextNode("Cancel"));mstr.behaviors.ExpandableTreeView.addSpecialNodeAtInsertionPoint.apply(rootTag,[divClassName,"wait",nameNodes]);anchor=null;break;case mstr.Enum.Widget.READYSTATE.ERROR:var msgNode=rootTag.ownerDocument.createTextNode("{@errorText}");mstr.behaviors.ExpandableTreeView.replaceSpecialNodeAtInsertionPointWithRetryRemove.apply(rootTag,[msgNode]);break;case mstr.Enum.Widget.READYSTATE.TIMEOUT:var msgNode=rootTag.ownerDocument.createTextNode("Timeout");mstr.behaviors.ExpandableTreeView.replaceSpecialNodeAtInsertionPointWithRetryRemove.apply(rootTag,[msgNode]);break;case mstr.Enum.Widget.READYSTATE.CANCELLED:mstr.behaviors.ExpandableTreeView.removeSpecialNodeAtInsertionPoint.apply(rootTag,[]);break;case mstr.Enum.Widget.READYSTATE.SUCCESS:mstr.behaviors.ExpandableTreeView.removeSpecialNodeAtInsertionPoint.apply(rootTag,[]);mstr.behaviors.ExpandableTreeView.addFetchControl.apply(rootTag,[]);break;}};return ETV;})();mstr.views.TreeView=(function(){mstr.$O.extendsClass(TV,mstr.views.BaseView);TV.prototype._attachLayoutHandlers=function TV_attachLayoutHandlers(){mstr.views.BaseView.prototype._attachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){model.attachEventListener(this,"insertNodes","onInsertNodes");model.attachEventListener(this,"removeNodes","onRemoveNodes");model.attachEventListener(this,"set_nodeReadyState","onSetNodeReadyState");model.attachEventListener(this,"hashadd_selections","onAddSelections");model.attachEventListener(this,"hashremove_selections","onRemoveSelections");}};TV.prototype._detachLayoutHandlers=function TV_detachLayoutHandlers(){mstr.views.BaseView.prototype._detachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){model.detachEventListener(this,"insertNodes");model.detachEventListener(this,"removeNodes");model.detachEventListener(this,"hashadd_selections");model.detachEventListener(this,"hashremove_selections");}};TV.prototype.onInsertNodes=function TV_onInsertNodes(evt){var at=evt&&evt.memo&&evt.memo.at;var count=evt&&evt.memo&&evt.memo.count;var nodes=evt&&evt.memo&&evt.memo.nodes;if(!count||!nodes||(at==null)){return ;}var m=this.props.model,nodeRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!m||!nodeRenderer){return ;}var parts=m._pathParts(at);var childIndex=parts.pop();if(!this.props.allowExpandCollapse){var parent=nodes[0]&&nodes[0].parent;if(parent){nodeRenderer.markNodeExpandState&&nodeRenderer.markNodeExpandState(this,m,this.props.element,{node:parent,path:parts.join(mstr.models.AbstractTreeBase.PATHDELIM),state:1,treeRootParent:this.props.treeRootParent});}}var path;for(var i=0;i<count;i++){path=parts.concat([childIndex+i]).join(mstr.models.AbstractTreeBase.PATHDELIM);this.renderSubTree(nodes[i],nodeRenderer,path);}};TV.prototype.onRemoveNodes=function TV_onRemoveNodes(evt){var paths=evt&&evt.memo&&evt.memo.at;var len=mstr.$A.len(paths);if(!len){return ;}var v=this,m=this.props.model,rt=this.props[mstr.$W.ELEMENT],nodeRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!m||!nodeRenderer){return ;}for(var i=0,len=mstr.$A.len(paths);i<len;i++){nodeRenderer.removeNode(v,m,rt,{path:paths[i]});}};TV.prototype.onSetNodeReadyState=function TV_onSetNodeReadyState(evt){var node=evt&&evt.memo&&evt.memo.node;if(!node){return ;}var nodeRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!nodeRenderer||!nodeRenderer.markNodeReadyState){return ;}nodeRenderer.markNodeReadyState(this,this.props.model,this.props.element,{node:node,treeRootParent:this.props.treeRootParent});};TV.prototype.onAddSelections=function TV_onAddSelections(evt){this._toggleSelections(evt.memo.at,"markNodeAsSelected");var nr=mstr.utils.ListViewHelper.getItemRenderer(this);if(nr&&nr.scrollToNode){var node=mstr.$H.firstItem(evt.memo.at);var m=this.props.model;nr.scrollToNode(this,m,this.props.element,{path:m.getNodePath(node),node:node,treeRootParent:this.props.treeRootParent});}};TV.prototype.onRemoveSelections=function TV_onRemoveSelections(evt){this._toggleSelections(evt.memo.at,"markNodeAsUnselected");};TV.prototype._toggleSelections=function TV_toggleSelections(nodes,methodName){if(!nodes){return ;}var nodeRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);var v=this,m=this.props.model,rn=this.props[mstr.$W.ELEMENT],trp=this.props.treeRootParent;if(!m){return ;}for(var id in nodes){nodeRenderer[methodName](v,m,rn,{path:m.getNodePath(nodes[id]),node:nodes[id],treeRootParent:trp});}};TV.prototype.render=function TV_render(){mstr.views.BaseView.prototype.render.apply(this);var el=this.execLayoutHandler("treeRootParent");this.props.treeRootParent=el;var m=this.getModel();var root=m&&m.getRootNode();if(root&&(root.value.dssid||mstr.$A.len(root.children))){this.renderSubTree(root,mstr.utils.ListViewHelper.getItemRenderer(this),"0",this.props.model,this.props.element,el);}mstr.timers.renderStop=new Date();mstr.timers.render=mstr.timers.renderStop-mstr.timers.renderStart;};TV.prototype.renderSubTree=function TV_renderSubTree(root,nodeRenderer,path,model,rootTag,trp){this.renderNode(root,nodeRenderer,path,model,rootTag,trp);for(var i=0,len=mstr.$A.len(root.children);i<len;i++){this.renderSubTree(root.children[i],nodeRenderer,path+mstr.models.AbstractTreeBase.PATHDELIM+i,model,rootTag,trp);}};TV.prototype.renderNodesAt=function TV_renderNodesAt(startPath,count){var m=this.props.model,rt=this.props[mstr.$W.ELEMENT],trp=this.props.treeRootParent,nodeRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!m||!nodeRenderer){return ;}var firstNode=m.getNodeAt(startPath);var pathParts=m._pathParts(startPath);var firstIndex=pathParts.pop();var parentNode=(pathParts.length)?firstNode.parent:null;for(var i=0;i<count;i++){var node=parentNode?parentNode.children[firstIndex+i]:m.getRootNode();if(node){this.renderNode(node,nodeRenderer,pathParts.join(".")+(firstIndex+i),m,rt,trp);}}};TV.prototype.renderNode=function TV_renderNode(node,nodeRenderer,path,model,rootTag,trp){if(!node){return ;}if(!model){model=this.props.model;}if(!path){path=model.getNodePath(node);}if(!rootTag){rootTag=this.props.element;}if(!trp){trp=this.props.treeRootParent;}var browseType=null;if(!node.parent||!node.parent.leafElements){browseType=model&&model.getNodeBrowseType(node,this.props.allowBrowseFolder,this.props.allowBrowseAttribute,this.props.allowBrowseHierarchy);}var el=nodeRenderer.renderNode(this,model,rootTag,{path:path,node:node,browseType:browseType,treeRootParent:trp});el.mstrTreeNodeInfo=node.id;};TV.prototype.execClickTreeNode=function LV_execClickTreeNode(cmdValue){var m=this.props.model;if(!m){return false;}var node=cmdValue&&cmdValue.nodeId&&m.findByNodeId(cmdValue.nodeId);if(!node){return false;}switch(cmdValue.part){case"connector":var state;switch(cmdValue.expandState){case 2:state=null;break;case 1:state=0;break;case 0:state=1;break;}if(state!=null){var nodeRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);if(!nodeRenderer){return ;}nodeRenderer.markNodeExpandState(this,this.props.model,this.props.element,{el:cmdValue.elNode,state:state,scroll:true});}return false;break;case"value":return this._clickTreeNodeValue(node,cmdValue);break;}return false;};TV.prototype._clickTreeNodeValue=function LV_clickTreeNodeValue(node,cmdValue){var m=this.props.model;if(!m){return false;}var bMulti=!!this.props.multiSelect;if(node){var cmdId=null;if(cmdValue.ctrl&&bMulti){cmdId="ToggleSelect";}else{if(cmdValue.shift&&bMulti){cmdId="RangeSelect";}else{cmdId="SingleSelect";}}m.execCommand(cmdId,node);return true;}else{if(bMulti){m.execCommand("ClearSelect");}return false;}};TV.prototype.execBrowseTreeNode=function TV_execBrowseTreeNode(cmdValue){var m=this.props.model;var node=m&&m.findByNodeId(cmdValue.nodeId);if(!node){return false;}if(cmdValue.popup){var popup=mstr.$obj(cmdValue.popup);if(popup){if(m.execCommand("EditNode",node)){return this.execCommand("OpenPopup",{popup:popup,x:cmdValue.x,y:cmdValue.y,orientation:1});}}}else{if(cmdValue.part=="connector"&&cmdValue.expandState==0){var en=mstr.Enum.Widget.READYSTATE;switch(node.readyState){case null:case undefined:case en.CANCELLED:case en.ERROR:if(!mstr.$A.len(node.children)){return m.execCommand("FetchFirst",node);}}}else{if(/Fetch/.test(cmdValue.part)){return m.execCommand(cmdValue.part,node);}}}return false;};TV.prototype.execSearch=function TV_execSearch(searchPattern){var m=this.props.model;var node=m&&m.getSelectedNode();if(!node){return false;}var lastSearch=this.props.searchResultsNode;if(lastSearch){m.removeNodesAt([this.getNodePath(lastSearch)]);}var resultsNode=this.props.searchResultsNode=this._createSearchResultsNode(node,searchPattern);if(resultsNode){var root=m.get("rootNode");if(!root){return null;}var len=mstr.$A.len(root.children);this.insertNodesAt([searchFolderNode],"0"+mstr.models.AbstractTreeBase.PATHDELIM+len);m.fetchBlock(resultsNode.children[0],1,searchPattern);}return true;};TV.prototype._createSearchResultsNode=function TV_createSearchResultsNode(searchRootNode,searchPattern){var node=mstr.$H.clone(searchRootNode);node.value=mstr.$H.clone(searchRootNode.value);node.parent=null;node.children=[];node.id=null;node.isWithinHierarchy=mstr.utils.ListViewHelper.isWithinHierarchy(searchRootNode);if(node.isWithinHierarchy){var m=this.props.model;node.hierarchyPath=m&&m._buildHierarchyPathForNode(searchRootNode);}var searchFolderNode={value:{icon:"f",tp:-1,n:(this.props.descriptors.searchResultsCaption||"Search for:")+" "+searchPattern,dssid:null}};searchFolderNode.children=[node];node.parent=searchFolderNode;return searchFolderNode;};TV.prototype.onkeypress=function TV_onkeypress(e,hWin){var m=this.getModel();if(!m){return true;}var s=mstr.utils.Events.keyChar(e,hWin),isTab=(s==String.fromCharCode(9));if(mstr.Enum.REGEXP_RESERVED_CHARS[s]){s="\\"+s;}m.execCommand("SelectString",s);if(!isTab){mstr.utils.Events.cancel(e,hWin);}return isTab;};TV.prototype.onkeydown=function TV_onkeydown(e,hWin){var m=this.getModel();if(!m){return true;}var key=mstr.utils.Events.keyCode(e,hWin),shift=mstr.utils.Events.shiftKey(e,hWin);switch(key){case 38:this.execSelectPrevious(shift);mstr.utils.Events.cancel(e,hWin);return false;case 40:this.execSelectNext(shift);mstr.utils.Events.cancel(e,hWin);return false;case 37:this.execSelectParent();mstr.utils.Events.cancel(e,hWin);return false;case 39:this.execSelectChild();mstr.utils.Events.cancel(e,hWin);return false;default:return true;}};TV.prototype.execSelectPrevious=function TV_execSelectPrevious(){var m=this.getModel(),info=m&&m.firstSelectionByIndex();if(info&&info.node){if(info.childIndex>0){return m.execCommand("SingleSelect",info.node.parent.children[info.childIndex-1]);}else{if(info.node.parent){return m.execCommand("SingleSelect",info.node.parent);}}}return false;};TV.prototype.execSelectNext=function TV_execSelectNext(){var m=this.getModel(),info=m&&m.lastSelectionByIndex();if(info&&info.node){if((this.getNodeExpandState(info.node)==1)&&info.node.children&&info.node.children[0]){return m.execCommand("SingleSelect",info.node.children[0]);}else{if((info.childIndex>-1)&&info.node.parent&&info.node.parent.children&&info.node.parent.children[info.childIndex+1]){return m.execCommand("SingleSelect",info.node.parent.children[info.childIndex+1]);}else{if(info.parent){var next=mstr.utils.Trees.nextSibling(info.node.parent);if(next){return m.execCommand("SingleSelect",next);}}}}}return false;};TV.prototype.execSelectParent=function TV_execSelectParent(){var m=this.getModel(),sel=m&&m.getSelectedNodes(),first=m&&m.getSelectedNode();if(first&&mstr.$H.lenGreaterThan(sel,1)){if(first.parent){return m.execCommand("SingleSelect",first.parent);}}else{if(first){if(this.getNodeExpandState(first)==1){this.setNodeExpandState(first,0);}else{if(first.parent){return m.execCommand("SingleSelect",first.parent);}}}}return false;};TV.prototype.execSelectChild=function TV_execSelectChild(){var m=this.getModel(),sel=m&&m.getSelectedNodes(),first=m&&m.getSelectedNode();if(first&&!mstr.$H.lenGreaterThan(sel,1)){switch(this.getNodeExpandState(first)){case 0:this.setNodeExpandState(first,1);if(first.readyState==null){if(!mstr.$A.len(first.children)){return m.execCommand("FetchFirst",first);}}break;case 1:default:if(first.children&&first.children[0]){return m.execCommand("SingleSelect",first.children[0]);}break;}}return false;};TV.prototype.getNodeExpandState=function TV_getNodeExpandState(node){var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this),m=this.getModel();if(m&&itemRenderer&&itemRenderer.findLocationForNode&&itemRenderer.getNodeExpandState){var loc=itemRenderer.findLocationForNode(this.props.treeRootParent,m.getNodePathIndices(node));if(loc&&loc.before){return itemRenderer.getNodeExpandState(loc.before);}}};TV.prototype.setNodeExpandState=function TV_setNodeExpandState(node,state){var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this),m=this.getModel();if(m&&itemRenderer&&itemRenderer.markNodeExpandState&&itemRenderer.findLocationForNode){var loc=itemRenderer.findLocationForNode(this.props.treeRootParent,m.getNodePathIndices(node));return itemRenderer.markNodeExpandState(this,m,this.props.element,{el:loc.before,state:state,scroll:true});}};TV.prototype.getExtraNodeCssClass=function TV_getExtraNodeCssClass(node){var ext="",css=this.props.singleFilterCssClass,nv=node&&node.value;if(css&&(nv&&(nv.stp==256||nv.tp==1))){var p=node.parent&&node.parent.value;if(p&&p.filters&&p.filters.length==1){ext=css;}}return ext;};function TV(props){mstr.views.BaseView.apply(this,[props]);}return TV;})();