mstr.Enum.ColorPickerFlags={NO_COLOR:1,MORE_COLORS:2,GRADIENT_COLORS:4,USER_COLORS:8,GRAPH_GRADIENTS:16,AUTOMATIC:32};mstr.Enum.AttrFormSelector={AUTOMATIC:1,CUSTOM:4,DEFAULT_SORT:1};mstr.bones={};mstr.bones.editors={};mstr.bones.editors.Map={};mstr.controllers.ExportTypes=(function(){var X={};X.exportSet=[{c:"Excel",d:"4",n:"3958",f:"web-export-to-excel;enable-export"},{c:"PDF",d:"3",n:"1877",f:"web-export-to-pdf;enable-pdf;document-html-view-mode"},{c:"HTML",d:"-1",n:"3957",f:"web-export-to-html;enable-html-export;document-html-view-mode"},{c:"Flash",d:"7",n:"14513",f:"rw-flash-view-mode-enabled;web-export-to-flash;enable-flash"}];X.getExportModes=function X_getExportModes(){var xportModes={items:[],value:""};for(var i in this.exportSet){var opt=this.exportSet[i];if(mstr.behaviors.featureResolver.resolveFeatSet(opt.f)){xportModes.items.push({dssid:opt.d,n:microstrategy.descriptors.getDescriptor(opt.n),cssClass:"ToolbarList x"+opt.c});}}xportModes.value=xportModes.items[0]?xportModes.items[0].dssid:"";return xportModes;};return X;})();mstr.controllers.ZoomFactors=(function(){var X={};var zfValues;X.getZoomFactors=function X_getZoomFactors(zoomType,value,flashMode){if(!zfValues){zfValues={items:[{n:"400%",dssid:"400"},{n:"300%",dssid:"300"},{n:"200%",dssid:"200"},{n:"150%",dssid:"150"},{n:"125%",dssid:"125"},{n:"100%",dssid:"100"},{n:"75%",dssid:"75"},{n:"50%",dssid:"50"},{n:"25%",dssid:"25"},{n:microstrategy.descriptors.getDescriptor("4809"),dssid:"Width"},{n:microstrategy.descriptors.getDescriptor("4808"),dssid:"Page"}]};}if(typeof (value)=="undefined"){return zfValues;}if(flashMode&&zoomType!=microstrategy.ZOOM_STATIC){zfValues.value=(zoomType==microstrategy.ZOOM_FIT_WIDTH)?"Width":"Page";return zfValues;}var insertValue=[{n:value+"%",dssid:value}];var items=zfValues.items;var insertIndex=0,intValue;for(;insertIndex<items.length-2;insertIndex++){intValue=parseInt(items[insertIndex].dssid);if(intValue==value){zfValues.value=value;return zfValues;}if(intValue<value){break;}}var newValues={};newValues.items=mstr.$A.insert(zfValues.items,insertValue,insertIndex);newValues.value=value;return newValues;};return X;})();mstr.models.ChangeTrackingModel=(function(){mstr.$O.extendsClass(CTM,mstr.models.BaseModel);CTM.prototype.init=function CTM_init(){mstr.models.BaseModel.prototype.init.apply(this);for(var prop in this.props){var propVal=this.props[prop];if(propVal instanceof mstr.models.ListModel){propVal.attachEventListener(this,"hashadd_selectedIndices","onHashAdd");propVal.attachEventListener(this,"hashremove_selectedIndices","onHashRemove");propVal.set("propName",prop);}}};CTM.prototype.set=function CTM_set(n,v){var result=mstr.models.BaseModel.prototype.set.apply(this,[n,v]);if(result){this.changedProps[n]=v;}return result;};CTM.prototype.onHashAdd=function CTM_onHashAdd(evt){var propName=evt.src.get("propName");this._updateChangedProp(propName);};CTM.prototype.onHashRemove=function CTM_onHashRemove(evt){var propName=evt.src.get("propName");this._updateChangedProp(propName);};CTM.prototype._updateChangedProp=function CTM__updateChangedProp(propName){var propModel=this.get(propName);var valForm=propModel.get("valueForm");var selectedItems=propModel.getSelectedItems();var newVal="";for(var i=0;i<selectedItems.length;i++){newVal+=selectedItems[i][valForm]+"|";}if(newVal.charAt(newVal.length-1)=="|"){newVal=newVal.substring(0,newVal.length-1);}this.changedProps[propName]=newVal;};CTM.prototype.getChanges=function CTM_getChanges(){return this.changedProps;};function CTM(props){mstr.models.BaseModel.apply(this,[props]);this.changedProps={};}return CTM;})();mstr.models.ChangeTrackingModelManager=(function(){mstr.$O.extendsClass(CTMM,mstr.models.BaseModel);CTMM.prototype.getChangesAsString=function CTMM_getChangesAsString(delimeter){var result="";var changes;var changePerChild;var changedPropVal;if(!delimeter){delimeter=UNIT_SEPARATOR;}for(var prop in this.props){var propVal=this.props[prop];changePerChild="";if(propVal instanceof mstr.models.ChangeTrackingModel){changes=item.getChanges();for(var changedProp in changes){changedPropVal=changes[changedProp];if(isNaN(changedPropVal)){changedPropVal='"'+changedPropVal+'"';}changePerChild+=changedProp+"="+changes[changedProp]+delimeter;}changePerChild=changePerChild.substring(0,changePerChild.length-1);result+=changePerChild+delimeter;}else{if(propVal instanceof mstr.models.ListModel){var items=propVal.props.items;for(var i=0;i<items.length;i++){var item=items[i];changePerChild="";if(item instanceof mstr.models.ChangeTrackingModel){changes=item.getChanges();for(var changedProp in changes){changedPropVal=changes[changedProp];if(isNaN(changedPropVal)){changedPropVal='"'+changedPropVal+'"';}changePerChild+=changedProp+"="+changedPropVal+delimeter;}if(changePerChild.charAt(changePerChild.length-1)==delimeter){changePerChild=changePerChild.substring(0,changePerChild.length-1);}if(changePerChild.length>0){result+=changePerChild+delimeter;}}}}}}if(result.charAt(result.length-1)==delimeter){result=result.substring(0,result.length-1);}return result;};CTMM.prototype.execSubmitChanges=function CTMM_execSubmitChanges(delimeter){};CTMM.prototype.execCancelChanges=function CTMM_execCancelChanges(){};function CTMM(props){mstr.models.BaseModel.apply(this,[props]);}return CTMM;})();mstr.models.FilterDetailsEditor=(function(){mstr.$O.extendsClass(FDE,mstr.models.ChangeTrackingModelManager);FDE.prototype.PROPERTY_SET_NAME="FilterDetailsFormatProperties";FDE.prototype.PROPERTY_NAME="FilterDetailsFormat";FDE.prototype.getChangesAsString=function FDE_getChangesAsString(delimeter){var changedProps=mstr.models.ChangeTrackingModelManager.prototype.getChangesAsString.apply(this,[delimeter]);changedProps=this.updateRelatedProperties(changedProps);if(!changedProps||changedProps.length==0){return changedProps;}if(!delimeter){delimeter=UNIT_SEPARATOR;}var oldPropValue=this.props.oldValue||"";var prop;var val;var posOfEquals;var propPos;var temp;var pattern='\\s*\\b[A-Za-z]+\\b\\s*=\\s*([0-9]+|"[^"]*")\\s*';var propNvalTokens=changedProps.split(delimeter);for(var i=0;i<propNvalTokens.length;i++){posOfEquals=propNvalTokens[i].indexOf("=");if(posOfEquals==-1){continue;}prop=propNvalTokens[i].substring(0,posOfEquals);val=propNvalTokens[i].substring(posOfEquals+1);if(prop=="isComplex"){continue;}if(isNaN(val)){val=val.substring(1,val.length-1);if(val.indexOf("\\")>=0){val=val.replace("\\","\\\\");}if(val.indexOf('"')>=0){val=val.replace('"','\\",');}val='"'+val+'"';}propPos=oldPropValue.indexOf(prop);if(propPos>=0){temp=oldPropValue.substring(propPos);temp=temp.match(pattern);if(temp){if(val!="-1"&&val!=""){oldPropValue=oldPropValue.replace(temp[0],propNvalTokens[i]);}else{oldPropValue=oldPropValue.replace(temp[0],"");}}}else{if(val!="-1"){oldPropValue+=","+propNvalTokens[i];}}}if(oldPropValue.charAt(0)==","){oldPropValue=oldPropValue.substring(1);}if(oldPropValue.charAt(oldPropValue.length-1)==","){oldPropValue=oldPropValue.substring(0,oldPropValue.length-1);}return oldPropValue;};FDE.prototype.execSubmitChanges=function FDE_execSubmitChanges(delimeter){var changes=this.getChangesAsString(delimeter);var um=microstrategy.updateManager;if(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION){var doc=microstrategy.getViewerBone().doc;var actionCollection=[];if(doc){if(!this.props.objId){doc.processRWDocProperty(this.PROPERTY_NAME,changes);}else{var data=mstrUpdateManager.createPropertyEditString(this.props.objId,this.PROPERTY_NAME,changes);actionCollection.push(um.createActionObject(null,mstrUpdateManager.EDIT_PROPS,doc.parentBone.beanPath,["2048018","2048035"],[mstrUpdateManager.UPDATE_NOW,data],[]));actionCollection.push(um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,doc.parentBone.beanPath,["2048018","2048035"],[mstrUpdateManager.UPDATE_NOW,data],[]));um.add(actionCollection);um.flushAndSubmitChanges();}}}else{var gridBone=microstrategy.bone("UniqueReportID");var actionCollection=new Array();gridBone.setReportProp(this.PROPERTY_SET_NAME,this.PROPERTY_NAME,changes,actionCollection);um.add(actionCollection);um.flushAndSubmitChanges();}return true;};FDE.prototype.updateRelatedProperties=function FDE_updateRelatedProperties(propStr){var temp=propStr.replace(" ","");if(temp.indexOf("SBLT=-1")>=0){propStr+=UNIT_SEPARATOR+"CDLT=";}return propStr;};FDE.prototype.execCancelChanges=function FDE_execCancelChanges(){return true;};function FDE(props){mstr.models.ChangeTrackingModelManager.apply(this,[props]);}return FDE;})();mstr.models.TaskModel=(function(){mstr.$O.extendsClass(TM,mstr.models.BaseModel);TM.prototype.execFetchBlock=function TM_execFetchBlock(reqInputs,element,memo){var ctxt=this.props.requestContext;if(ctxt&&ctxt.id){this.cancelRequest(ctxt.id);this.set("readyState",mstr.Enum.Widget.READYSTATE.CANCELLED);}this.waitingElement=element;this.submitRequest(reqInputs,memo);};TM.prototype.loadRequestResponse=function TM_loadRequestResponse(){var ctxt=this.props.requestContext;var res=ctxt&&ctxt.response;if(!res||!res.data){if(this.get("readyState")!=mstr.Enum.Widget.READYSTATE.WAITING){this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);}return ;}var data=res.data;this.set("models",data.get("models"));this.set("views",data.get("views"));var v=data.get("views")[0];v.set("element",this.waitingElement);v.set("document",this.waitingElement.ownerDocument);this.set("renderableView",v);this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);this.props.requestContext={};};function TM(props){mstr.models.BaseModel.apply(this,[props]);}return TM;})();mstr.models.SelectDataSetModel=(function(){mstr.$O.extendsClass(SDS,mstr.models.ListModel);SDS.prototype.setItems=function SDS_setItems(items){for(var i=0;i<items.length;i++){if(items[i].tp===microstrategy.DSSTYPE_FOLDER){items[i].did=items[i].dssid;}else{items[i].did=items[i].did||items[i].dssid;}}mstr.models.ListModel.prototype.setItems.apply(this,[items]);};SDS.prototype.execSelectDataset=function SDS_execSelectDataset(){var items=this.getSelectedItems();if(items==null){return false;}var oldDSID=this.get("oldDSID");var isReplaceAllDatasets=this.get("ReplaceAllDS");var isReplaceDataset=(oldDSID&&(oldDSID.length>0))||isReplaceAllDatasets;this.get("opener").handleDatasetExplorer({items:items,formatting:this.get("addWithFormatting"),oldDSID:oldDSID,oldDSType:this.get("oldDSType"),ReplaceAllDS:isReplaceAllDatasets});return true;};SDS.prototype._showWarningMessage=function SDS_showWarningMessage(descId){showMessage({contents:microstrategy.descriptors.getDescriptor(descId),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});document.getElementById(currentModalEditor[0]).style.zIndex=9999;};SDS.prototype._updateCommandEnabledSelectDataset=function SDS_updateCommandSelectDataset(){this.set("CommandEnabledSelectDataset",(this.getSelectedItem()!=null));};SDS.prototype.on_hashadd_selectedIndices=function SDS_on_hashadd_selectedIndices(evt){mstr.models.ListModel.prototype.on_hashadd_selectedIndices.apply(this,[evt]);if(evt&&evt.src==this){this._updateCommandEnabledSelectDataset();}};SDS.prototype.on_hashremove_selectedIndices=function SDS_on_hashremove_selectedIndices(evt){mstr.models.ListModel.prototype.on_hashremove_selectedIndices.apply(this,[evt]);if(evt&&evt.src==this){this._updateCommandEnabledSelectDataset();}};SDS.prototype.execOpenImportData=function SDS_execOpenImportData(){var me=this,callback=function callback(datasets){if(!datasets||!datasets.length){return false;}me.get("opener").handleDatasetExplorer({items:datasets,oldDSID:me.get("oldDSID"),oldDSType:me.get("oldDSType"),ReplaceAllDS:me.get("ReplaceAllDS")});return true;};microstrategy.openDataImport({AnalysisId:microstrategy.bone("rwb_viewer").messageID,callback:callback});};function SDS(props){mstr.models.ListModel.apply(this,[props]);this._updateCommandEnabledSelectDataset();}return SDS;})();mstr.models.AnnotationModel=(function(){mstr.$O.extendsClass(AM,mstr.models.BaseModel);AM.ADDITION_MAX_LENGTH=32000;AM.NOTES_MAX_LENGTH=65535;AM.prototype.execSetMode=function AM_execSetMode(mode){this.set("mode",mode);};AM.prototype.loadRequestResponse=function AM_loadRequestResponse(){var ctxt=this.props.requestContext;var res=ctxt&&ctxt.response;if(!res||!res.data){this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);return ;}var data=res.data;if(ctxt.memo.command=="fetch"||ctxt.memo.command=="add"||ctxt.memo.command=="save"){this.set("value",decode(data.annotation));}this.props.requestContext={};this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);};AM.prototype.execSave=function AM_execSave(){var inputs=new mstr.http.SaveAnnotationsInputs(this.get("objectID"),this.get("objectType"),this.get("value").substring(0,AM.NOTES_MAX_LENGTH-this.get("postfixLen")),0);this.submitRequest(inputs,{command:"save"});return true;};AM.prototype.execAdd=function AM_execAdd(addition){var inputs=new mstr.http.SaveAnnotationsInputs(this.get("objectID"),this.get("objectType"),addition.substring(0,AM.ADDITION_MAX_LENGTH-this.get("addition").get("prefixLen")-this.get("addition").get("postfixLen")),1);this.submitRequest(inputs,{command:"add"});return true;};AM.prototype.execFetch=function AM_execFetch(){var inputs=new mstr.http.GetAnnotationsInput(this.get("objectID"),this.get("objectType"),"GetAnnotationsStyle");this.submitRequest(inputs,{command:"fetch"});return true;};AM.prototype.updateValue=function AM_updateValue(newValue){if(newValue!=this.get("value")){this.set("CommandEnabledValidateEdit",true);}};AM.prototype.execValidateEdit=function AM_execValidateEdit(content){return true;};function AM(props){if(props.value){props.value=decode(props.value);}mstr.models.BaseModel.apply(this,[props]);this.set("CommandEnabledValidateEdit",false);}return AM;})();mstr.models.AnnotationAddArea=(function(){mstr.$O.extendsClass(AAA,mstr.models.BaseModel);AAA.prototype.execClear=function AAA_execClear(){this.set("value","");return true;};AAA.prototype.execValidateAdd=function AAA_execValidateAdd(addition,prefix){return true;};AAA.prototype.updateValue=function AAA_updateValue(newValue){this.set("CommandEnabledValidateAdd",true);};function AAA(props){mstr.models.BaseModel.apply(this,[props]);this.set("CommandEnabledValidateAdd",false);}return AAA;})();mstr.models.NotesIconModel=(function(){mstr.$O.extendsClass(NIM,mstr.models.BaseModel);NIM.prototype.loadRequestResponse=function NIM_loadRequestResponse(){var ctxt=this.props.requestContext;var res=ctxt&&ctxt.response;if(!res||!res.data){this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);return ;}var data=res.data;this.set("hasAnnotation",data.hasAnnotation);this.props.requestContext={};this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);};NIM.prototype.execCheck=function NIM_execCheck(){this.set("hasAnnotation",false);var inputs=new mstr.http.GetAnnotationsInput(this.get("objectID"),this.get("objectType"),"CheckAnnotationsStyle");this.submitRequest(inputs,{});return true;};function NIM(props){mstr.models.BaseModel.apply(this,[props]);}return NIM;})();mstr.models.ColorPicker=(function(){mstr.$O.extendsClass(CPM,mstr.models.ListModel);CPM.prototype.init=function CPM_init(){mstr.models.ListModel.prototype.init.apply(this);var item=this.getItems()&&this.getItems()[0];if(item){this.set("hasColor",item[this.get("valueForm")]!="transparent");}};CPM.prototype.on_hashadd_selectedIndices=function CPM_on_hashadd_selectedIndices(evt){mstr.models.ListModel.prototype.on_hashadd_selectedIndices.apply(this,[evt]);var item=this.getSelectedItem();if(item){var v=this.set("actualColor",item[this.get("valueForm")]);}};CPM.prototype.execSelectValue=function CPM_execSelectValue(v){if(v==null||v==""){v="#000000";}if(v!="transparent"&&v!="automatic"){v=v.toUpperCase();}if(mstr.models.ListModel.prototype.execSelectValue.apply(this,[v])){return true;}this.set("actualColor",v);this.execClearSelect();this.raiseEvent("hashremove_selectedIndices",{name:"selectedIndices",at:{}});return true;};CPM.prototype.set=function BM_set(n,v){if(n=="actualColor"&&this.props.enableReselect&&this.props[n]==v){this.raiseEvent("set_"+n,{name:n,value:v,valueWas:v});return true;}else{return mstr.models.ListModel.prototype.set.apply(this,arguments);}};CPM.prototype.execInsertCustomColor=function CPM_execInsertCustomColor(v){if(!v||!this.getItems()||!this.getItems()[0]){return ;}var vf=this.get("valueForm");var newItem=mstr.$H.clone(this.getItems()[0]);newItem[vf]=v;if(vf!="n"){newItem.n=microstrategy.descriptors.getDescriptor("2133")+" "+v;}var index=-1;var size=mstr.$A.len(this.props.items);var maxSize=this.get("maxSize");if(maxSize>-1&&maxSize<=size){index=0;var range={min:maxSize-1,max:size-1};this.removeItemsAtRanges([range],true);}this.execSingleSelect(this.insertItemsAt([newItem],index));this.set("hasColor",true);var um=microstrategy&&microstrategy.updateManager;if(um){var newColors="";var d="";var items=this.getItems();for(var i=0;i<8;i++){if(items[i][vf]=="transparent"){break;}newColors+=d+items[i][vf];d=",";}um.add([um.createActionObject(null,mstrUpdateManager.SET_PREFERENCE,mstr.$obj("mstrPageInfo").get("beanPath"),["5003","5004"],["userPalette",newColors],[],null)],true);}};function CPM(props){mstr.models.ListModel.apply(this,[props]);}return CPM;})();mstr.models.AdvancedColorPicker=(function(){mstr.$O.extendsClass(ACP,mstr.models.BaseModel);ACP.monitoredFields=["color","rootColor","hex","r","g","b","h","s","v"];ACP.prototype.init=function ACP_init(){mstr.models.BaseModel.prototype.init.apply(this);for(var i=0;i<9;i++){this["on_set_"+ACP.monitoredFields[i]]=this.synchFields;}this.get("basicColors").attachEventListener(this,"set_actualColor","synchFields");this.getTarget()&&this.initFromTarget();};ACP.prototype.getTarget=function ACP_getTarget(){return this.get("targetPath")?mstr.controllers.Factory.getPath(this.get("targetPath"),this):null;};ACP.prototype.initFromTarget=function ACP_initFromTarget(){if(!this.getTarget()){return ;}this.set("color",this.getTarget().getCurrentColor());this.set("activeControlId",this.getTarget().getActiveControlId());};ACP.prototype.execUpdateTarget=function ACP_execUpdateTarget(){if(!this.getTarget()){return ;}this.getTarget().exec("advColorPicker",this.get("activeControlId")+"|"+this.get("color"));};ACP.prototype.set=function ACP_set(n,v){mstr.models.BaseModel.prototype.set.apply(this,[n,v]);if(n=="opener"){var m=v&&v.getModel&&v.getModel();if(!m){return ;}var c=m.get("actualColor");if(c){c=c.split(",")[0];if(c=="transparent"){c="#ffffff";}else{if(c.charAt(0)!="#"){c="#"+c;}}this.set("color",c);}mstr.$obj("mstrPageInfo").get("userPalette").attachEventListener(this,"set_actualColor","synchFields");}if(n=="targetPath"){this.getTarget()&&this.initFromTarget();mstr.$obj("mstrPageInfo").get("userPalette").attachEventListener(this,"set_actualColor","synchFields");}};ACP.prototype.synchFields=function ACP_synchFields(evt){if(this.synchronizing){return ;}switch(evt.name){case"set_color":this.synchronizing=true;var newColor=evt.memo.value;this.set("hex",newColor.substr(1));var rgb=mstr.utils.Color.hex2rgb(newColor);this.set("r",rgb[0]);this.set("g",rgb[1]);this.set("b",rgb[2]);var hsv=mstr.utils.Color.rgb2hsv(rgb[0],rgb[1],rgb[2]);this.set("h",hsv[0]);this.set("s",hsv[1]);this.set("v",hsv[2]);this.set("rootColor","#"+mstr.utils.Color.hsv2hex(hsv[0],100,100));this.synchronizing=false;break;case"set_hex":this.set("color","#"+(this.get("hex")||"000000"));break;case"set_r":case"set_g":case"set_b":this.set("color","#"+mstr.utils.Color.rgb2hex(this.get("r"),this.get("g"),this.get("b")));break;case"set_h":case"set_s":case"set_v":this.set("color","#"+mstr.utils.Color.hsv2hex(this.get("h"),this.get("s"),this.get("v")));break;case"set_actualColor":var newColor=evt.src.get("actualColor");if(newColor!="transparent"){this.set("color",newColor);}break;}};ACP.prototype.execDetachUserPalette=function ACP_execDetachUserPalette(evt){mstr.$obj("mstrPageInfo").get("userPalette").detachEventListener(this,"set_actualColor");};ACP.prototype.execAddUserColor=function ACP_execAddUserColor(evt){var newColor=this.get("color");if(this.get("basicColors").indexOfValue(newColor)!=-1){return ;}var uc=mstr&&mstr.$obj("mstrPageInfo")&&mstr.$obj("mstrPageInfo").get("userPalette");if(!uc||uc.indexOfValue(newColor)!=-1){return ;}uc.execInsertCustomColor(newColor);};function ACP(props){mstr.models.BaseModel.apply(this,[props]);}return ACP;})();mstr.models.GradientEditor=(function(){mstr.$O.extendsClass(GE,mstr.models.BaseModel);GE.prototype.init=function GE_init(){mstr.models.BaseModel.prototype.init.apply(this);this["on_set_gradient"]=this.gradientChange;this.get("color1").attachEventListener(this,"set_actualColor","gradientChange");this.get("color2").attachEventListener(this,"set_actualColor","gradientChange");this.get("gradientType").attachEventListener(this,"hashadd_selectedIndices","gradientChange");this.get("variants").attachEventListener(this,"hashadd_selectedIndices","gradientChange");};GE.prototype.set=function GE_set(n,v){mstr.models.BaseModel.prototype.set.apply(this,[n,v]);if(n=="opener"){var m=v&&v.getModel&&v.getModel();if(!m){return ;}var c=m.get("actualColor");if(c&&c.indexOf(",")>-1){this.set("gradient",c);}else{c=(c&&c!="transparent")?c.substr(1):"000000";this.set("gradient",c+",ffffff,14,0,0,0");}}};GE.prototype.gradientChange=function GE_gradientChange(evt){if(this.changingGradient){return ;}switch(evt.name){case"set_gradient":this.changingGradient=true;var parts=evt.memo.value.split(",");this.get("color1").execSelectValue("#"+parts[0]);this.get("color2").execSelectValue("#"+parts[1]);var model,i,cnt;var g=parts.slice(2).join(",");var cache=this.get("variantsCache");var type=cache.length+1;for(i=0,cnt=cache.length;i<cnt;i++){var m=cache[i];var s=m.indexOfValue(g);if(s!=-1){type=i+1;model=m;break;}}this.get("gradientType").execSelectValue(type);if(type==gradientUtil.GRADIENTSHADING_STYLE_CUSTOM){this.customGradientInit(g);}if(model){var newItems=mstr.utils.Hash.deepClone(model.getItems());for(i=0,cnt=newItems.length;i<cnt;i++){newItems[i].dssid=parts[0]+","+parts[1]+","+newItems[i].dssid;}var variants=this.get("variants");variants.setItems(newItems);variants.execSelectValue(evt.memo.value);}this.changingGradient=false;break;case"set_actualColor":case"hashadd_selectedIndices":if(evt.src==this.get("variants")){this.changingGradient=true;this.set("gradient",this.get("variants").getSelectedItemValue());this.changingGradient=false;}else{var g=this.get("color1").get("actualColor").substr(1)+",";g+=this.get("color2").get("actualColor").substr(1)+",";var index=this.get("gradientType").getSelectedIndex();var vc=this.get("variantsCache");if(!vc[index]){return ;}g+=vc[index].getSelectedItemValue();this.set("gradient",g);}break;}};GE.prototype.customGradientInit=function GE_customGradientInit(g){};function GE(props){mstr.models.BaseModel.apply(this,[props]);}return GE;})();mstr.models.GraphGradientEditor=(function(){mstr.$O.extendsClass(GGE,mstr.models.GradientEditor);GGE.prototype.init=function GGE_init(){mstr.models.GradientEditor.prototype.init.apply(this);this.get("transitionType").attachEventListener(this,"hashadd_selectedIndices","customGradientChange");this.attachEventListener(this,"set_angle","customGradientChange");this.attachEventListener(this,"set_xOffset","customGradientChange");this.attachEventListener(this,"set_yOffset","customGradientChange");};GGE.prototype.customGradientChange=function GGE_customGradientChange(evt){var g=this.get("color1").get("actualColor").substr(1)+",";g+=this.get("color2").get("actualColor").substr(1)+",";g+=this.get("transitionType").getSelectedItemValue()+",";g+=this.get("angle")+","+this.get("xOffset")+","+this.get("yOffset");this.changingGradient=true;this.set("gradient",g);this.changingGradient=false;};GGE.prototype.customGradientInit=function GGE_customGradientInit(g){var parts=g.split(",");if(parts.length==4){this.get("transitionType").execSelectValue(parts[0]);this.set("angle",parts[1]);this.set("xOffset",parts[2]);this.set("yOffset",parts[3]);}};GGE.prototype.gradientChange=function GGE_gradientChange(evt){if(this.changingGradient){return ;}if(this.get("gradientType").getSelectedItemValue()==gradientUtil.GRADIENTSHADING_STYLE_CUSTOM){this.customGradientChange(null);return ;}mstr.models.GradientEditor.prototype.gradientChange.apply(this,arguments);};function GGE(props){mstr.models.GradientEditor.apply(this,[props]);}return GGE;})();mstr.models.Validator=(function(){mstr.$O.extendsClass(V,mstr.models.BaseModel);V.prototype.setValidationStatus=function V_setValidationStatus(msg){var parent=this.get("parent");if(!parent){return true;}if(msg.length==0){parent.set("validationStatus",{statusCode:mstr.Enum.Validation.STATUSCODE.VALID,message:"",bubble:true});return true;}var s=this.get("errMessage")||msg;parent.set("validationStatus",{statusCode:mstr.Enum.Validation.STATUSCODE.INVALID_ANSWERS,message:s,bubble:true});return false;};function V(props){mstr.models.BaseModel.apply(this,[props]);}return V;})();mstr.models.FieldValidator=(function(){mstr.$O.extendsClass(FV,mstr.models.Validator);FV.EXCEPTION_DELIMITER=";";FV.prototype.intRegExp=/(^-?\d\d*$)/;FV.prototype.validate=function FV_validate(v){var msg="",descs=this.props.descriptors;var isExcepted=false,exceptions;if(this.get("exceptions")){exceptions=mstr.utils.String.trimDelimited(FV.EXCEPTION_DELIMITER+this.get("exceptions")+FV.EXCEPTION_DELIMITER,FV.EXCEPTION_DELIMITER);if(exceptions.indexOf(mstr.utils.String.trimDelimited(FV.EXCEPTION_DELIMITER+v+FV.EXCEPTION_DELIMITER,FV.EXCEPTION_DELIMITER))!=-1){isExcepted=true;}if(isExcepted){return this.setValidationStatus(msg);}}var isEmpty=(v==null||(typeof (v)=="string"&&v.length==0));if(this.get("required")&&isEmpty){msg=descs.errRequired;}if(msg.length==0&&!isEmpty){var typeErr=rangeErr=regErr=0;var invalidMessage="";var max=this.get("max");var min=this.get("min");if(max=="x"){max=null;}if(min=="x"){min=null;}var ltv=this._resolveComparisonFields("lessThan");var gtv=this._resolveComparisonFields("greaterThan");var regEx=this.get("regEx");var dt=this.get("type");if(min&&max||min&&ltv||max&&gtv||ltv&&gtv){invalidMessage=descs.errMinMax;}else{if(min||gtv){invalidMessage=descs.errMinOrGreater;}else{if(max||ltv){invalidMessage=descs.errMaxOrLess;}else{if(regEx){invalidMessage=descs.errRegEx;}else{if(dt){invalidMessage=descs.errType;}}}}}switch(dt){case mstr.Enum.Nodes.DATATYPE.INTEGER:if((!this.intRegExp.test(v)&&!this.snRegExp.test(v))||parseInt(v,10)!=parseFloat(v)){invalidMessage=invalidMessage.replace("#",descs.errTypeInt);typeErr=1;}break;case mstr.Enum.Nodes.DATATYPE.FLOAT:if(!this.floatRegExp.test(v)&&!this.snRegExp.test(v)){invalidMessage=invalidMessage.replace("#",descs.errTypeNum);typeErr=1;}break;}if(!typeErr){invalidMessage=invalidMessage.replace("# ","");}if((max||min)&&mstr.utils.Math.inNumericRange(v,min,max)){rangeErr=1;}if(min){invalidMessage=invalidMessage.replace("##",min);}if(max){invalidMessage=invalidMessage.replace("###",max);}if(!isNaN(ltv)){if(v>ltv||typeErr){rangeErr=1;}invalidMessage=invalidMessage.replace("###",ltv);}if(!isNaN(gtv)){if(v<gtv||typeErr){rangeErr=1;}invalidMessage=invalidMessage.replace("##",gtv);}if(regEx&&!(new RegExp(regEx,"g").test(v))){regErr=1;}if(typeErr||rangeErr||regErr){msg=invalidMessage;}}return this.setValidationStatus(msg);};FV.prototype._resolveComparisonFields=function FV__resolveComparisonFields(fieldName){var fields=this.get(fieldName);if(!fields){return NaN;}var v=0;var p,i,cnt;var x=fields.split("|");if(x[0]){var a=x[0].split(";");for(i=0,cnt=a.length;i<cnt;i++){p=mstr.$path(a[i],this.get("parent"));v+=parseFloat(p,10);}}if(x[1]){var s=x[1].split(";");for(i=0,cnt=s.length;i<cnt;i++){p=mstr.$path(s[i],this.get("parent"));v-=parseFloat(p,10);}}return v;};function FV(props){mstr.models.Validator.apply(this,[props]);var d=mstr.controllers.Factory.getPath("userInfo/decimalSeparator",mstr.$obj("mstrPageInfo"));this.floatRegExp=new RegExp("(^-?\\d\\d*\\"+d+"\\d*$)|(^-?\\d\\d*\\"+d+"?\\d*e(\\+|-)\\d+$)|(^-?\\d\\d*$)|(^-?\\"+d+"\\d\\d*$)");this.snRegExp=new RegExp("^-?[1-9](\\"+d+"\\d+)?[Ee]([+-]?\\d+)$");}return FV;})();mstr.models.ListValidator=(function(){mstr.$O.extendsClass(LV,mstr.models.Validator);LV.prototype.validate=function LV_validate(cmdId,index){var m=this.get("parent").getModel();if(this.get("required")&&cmdId=="ToggleSelect"){var msg=[];if(m.getSelectedIndices()[index]&&m.getSelectedItems().length==1){msg=[microstrategy.descriptors.getDescriptor("6076")];}return this.setValidationStatus(msg);}return true;};function LV(props){mstr.models.Validator.apply(this,[props]);}return LV;})();mstr.models.RibbonToolbarModel=(function(){mstr.$O.extendsClass(RTM,mstr.models.ListModel);RTM.prototype.init=function RTM_init(){microstrategy.bones[this.getId()]=this;mstr.models.ListModel.prototype.init.apply(this,[]);if(microstrategy.pageScreenMode==microstrategy.PAGE_FULL_SCREEN_MODE){this.set("selectedToolbar",0);}this.selectToolbar();};RTM.prototype.onreload=function RTM_onreload(){var item=this.getSelectedItem();var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){var m=items[i];var fv=m.visibleFeatures;var fe=m.enabledFeatures;var v=mstr.behaviors.featureResolver.resolveFeatSet(fv,true);var e=mstr.behaviors.featureResolver.resolveFeatSet(fe,true);if(v&&!m.visible){this.get("toolbarModels").getItems()[i].execSynchronizeControls();}m.visible=v;}if(!item.visible||!e){this.execSelectValue(0);}this.raiseEvent("featuresChanged");};RTM.prototype.onload=function RTM_onload(){this.onreload();};RTM.prototype.selectToolbar=function RTM_selectToolbar(){this.set("initializing",true);if(!this.execSelectValue(this.get("selectedToolbar"))){var index=0;while(!this.execSelectValue(index)){index++;}}this.set("initializing",false);};RTM.prototype.execSingleSelect=function RTM_execSingleSelect(index){mstr.controllers.EventManager.notifyWindowListeners({name:"closeMenus"});if(this.props.items[index].enabledFeatures){if(!mstr.behaviors.featureResolver.resolveFeatSet(this.props.items[index].enabledFeatures)){return false;}}mstr.models.ListModel.prototype.execSingleSelect.call(this,index);if((mstrUpdateManager.SET_REPORT_SELECTED_RIBBON||mstrUpdateManager.SET_RW_SELECTED_RIBBON)&&!this.get("initializing")){var um=microstrategy.updateManager;if(!this.action){this.action=um.createActionObject(null,mstrUpdateManager.SET_REPORT_SELECTED_RIBBON||mstrUpdateManager.SET_RW_SELECTED_RIBBON,this.get("beanPath").replace("mstrWeb",microstrategy.servletName),["120005"],[],[],null);um.add([this.action],true);}this.action.newArgs=[this.getSelectedItemValue()];}var tm=this.get("toolbarModels");tm.execSingleSelect(index);if(tm.getSelectedItem().get("requestToolbar")){this.requestToolbar(index);}return true;};RTM.prototype.requestToolbar=function RTM_requestToolbar(idx){var ctxt=this.props.requestContext;if(ctxt&&ctxt.id){this.cancelRequest(ctxt.id);}var req=new mstr.http.LoadToolbarInput();req.params.viewer=this.get("targetPath");req.params.toolbarName=this.getItems()[idx]["toolbarName"];req.params.ribbonListName=this.get("ribbonListName");this.submitRequest(req,{index:idx});};RTM.prototype.on_set_readyState=function RTM_on_set_on_set_readyState(evt){if(evt.memo.value==mstr.Enum.Widget.READYSTATE.ERROR){microstrategy.handleTaskModelError(evt);}mstr.models.ListModel.prototype.on_set_readyState.apply(evt);};RTM.prototype.loadRequestResponse=function RTM_loadRequestResponse(){var ctxt=this.props.requestContext;var res=ctxt&&ctxt.response;if(!res||!res.data){return ;}var data=res.data.props.n;var tm=this.get("toolbarModels");var items=tm.getItems();var idx=ctxt.memo.index;var newItems=data.getItems();for(var i=0,cnt=newItems.length;i<cnt;i++){if(newItems[i].set){newItems[i].set("parent",items[idx]);}}var tp=data.get("targetPath");if(tp){items[idx].set("targetPath",tp);}items[idx].setItems(newItems);items[idx].set("requestToolbar",false);this.props.requestContext={};};function RTM(props){mstr.models.ListModel.apply(this,[props]);}return RTM;})();mstr.models.Toolbar=(function(){mstr.$O.extendsClass(T,mstr.models.ListModel);T.prototype.queueStatus={};T.prototype.init=function T_init(excludedProps){if(!this.props.targetPath){var ph=this.getAncestorByProperty("targetPath",true);if(ph){this.props.targetPath=ph.get("targetPath");}}if(this.props.targetPath){var items=this.get("items");for(var i=0,cnt=items.length;i<cnt;i++){if(!items[i].targetPath){mstr.controllers.Factory.safeset(items[i],"targetPath",this.props.targetPath);}}}mstr.models.ListModel.prototype.init.apply(this,arguments);};T.prototype.clearQueuedValues=function T_clearQueuedValues(grpId,cmdId){if(!this.queue){return ;}var group=this.queue[grpId];if(!group){return ;}if(cmdId){delete group[cmdId];if(mstr.utils.Hash.isEmpty(group)){delete this.queue[grpId];}}else{delete this.queue[grpId];}this.set("CommandEnabledSubmitQueue",!this.get("CommandEnabledSubmitQueue"));};T.prototype.queueValue=function T_queueValue(grpId,cmdId,v){var queue=this.queue||{};var group=queue[grpId]||{};group[cmdId]=v;queue[grpId]=group;this.queue=queue;this.set("CommandEnabledSubmitQueue",!this.get("CommandEnabledSubmitQueue"));};T.prototype.execSubmitQueue=function T_execSubmitQueue(grpId){if(!this.isQueueStatusValid(grpId)){return ;}var target=mstr.controllers.Factory.getPath(this.get("targetPath"),this);var zz=target&&target.commands&&target.commands.exec(grpId,this.queue[grpId]);this.clearQueuedValues(grpId);};T.prototype.queryCommandEnabled=function T_queryCommandEnabled(n,v){if(n=="SubmitQueue"&&v&&v[0]){return this.isQueueStatusValid(v[0]);}else{return mstr.models.BaseModel.prototype.queryCommandEnabled.apply(this,arguments);}};T.prototype.setQueueValidationStatus=function T_setQueueValidationStatus(q,s){this.queueStatus[q]=s;this.set("CommandEnabledSubmitQueue",!this.get("CommandEnabledSubmitQueue"));};T.prototype.isQueueStatusValid=function T_isQueueStatusValid(q){return this.queue&&this.queue[q]&&!(this.queueStatus[q]>mstr.Enum.Validation.STATUSCODE.VALID);};T.prototype.execSynchronizeControls=function T_execSynchronizeControls(){var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){var cth=items[i].get&&items[i].get("toolbarHelper");if(cth){cth.synchronizeControl();}}};function T(props){mstr.models.ListModel.apply(this,[props]);}return T;})();mstr.models.TextBoxModel=(function(){mstr.$O.extendsClass(TBM,mstr.models.BaseModel);TBM.prototype.submitParentQueue=function TBM_submitParentQueue(){var fsq=this.props&&this.props.parent&&this.props.parent.execSubmitQueue;if(fsq&&this.props.queueGroup){this.props.parent.execSubmitQueue(this.props.queueGroup);}};function TBM(props){mstr.models.BaseModel.apply(this,[props]);}return TBM;})();mstr.models.ToolbarControlHelper=(function(){mstr.$O.extendsClass(TCH,mstr.models.BaseModel);TCH.prototype.init=function TCH_init(excludedProps){mstr.models.BaseModel.prototype.init.apply(this,arguments);var path=this.get("parent").get("targetPath");if(!path){return ;}this.set("targetPath",path);var that=this;var fn=function(){that.synchronizeControl();};var methods=this.get("parent").get("listenerMethods").split(",");for(var i=0,cnt=methods.length;i<cnt;i++){this[methods[i]]=fn;}if(this.get("targetPath")&&!this.getTarget()){this.synchronizeControl();var h=window.setInterval(function(){if(that.attachToTarget()){window.clearInterval(h);}},100);return ;}this.attachToTarget();};TCH.prototype.attachToTarget=function TCH_attachToTarget(){var target=this.getTarget();if(!target){return false;}this.synchronizeControl();var zz=target.observer&&target.observer.register(this.get("id"));return true;};TCH.prototype.getCmdId=function(){var parent=this.get("parent");return parent&&parent.get("cmdid");};TCH.prototype.getTarget=function(){return mstr.controllers.Factory.getPath(this.get("targetPath"),this);};TCH.prototype.synchronizeControl=function TCH_synchronizeControl(){var target=this.getTarget();var cmdId=this.getCmdId();var b=this.get("visible");var parent=this.get("parent");var vFeatures=parent.get("visibleFeatures");if(vFeatures){b=mstr.behaviors.featureResolver.resolveFeatSet(vFeatures);}if((cmdId&&target)&&(!vFeatures||b)){b=target.commands.queryVisible(cmdId);}this.set("visible",b);if(!b){return false;}b=this.get("enabled");var eFeatures=parent.get("enabledFeatures");if(eFeatures){b=mstr.behaviors.featureResolver.resolveFeatSet(eFeatures);}else{if(cmdId&&target){b=target.commands.queryEnabled(cmdId);}}this.set("enabled",b);return b;};TCH.prototype._getCustomizationInfo=function TCH__getCustomizationInfo(n){return this.get("parent").get(n);};TCH.prototype.processCustomizations=function TCH_processCustomizations(){var ext=this._getCustomizationInfo("extra-url");if(ext){microstrategy.updateManager.addURL(ext);}var js=this._getCustomizationInfo("on-click");if(js){eval(js);}this.execHyperlink(this._getCustomizationInfo("link"),ext);this.execEvent(this._getCustomizationInfo("event"),ext);};TCH.prototype.execHyperlink=function TCH_execHyperlink(link,extraUrl){if(!link){return ;}var h=link.href;if(!h){return ;}var p=link.params;if(link["append-state"]||p){if(!(/\?$/.test(h))){h+="?";}if(link["append-state"]){h=updateLink(h);}h=this._parameterizeUrl(h,p);}if(extraUrl){h+="&"+extraUrl;}var t=this._resolveTarget(link);window.open(h,t);};TCH.prototype.execEvent=function TCH_execEvent(evt,extraUrl){if(!evt){return ;}var p=this.getAncestorByProperty("evtInfo");if(!p){p=this.getAncestorByProperty("ribbonId");p=mstr.$obj(p.get("ribbonId")).getAncestorByProperty("evtInfo",true);}var h=p&&p.get("evtInfo").get(evt["action-id"]);if(!h){return ;}if(evt.iframe){h+="&iframe=true";}var t=this._resolveTarget(evt);if(evt["append-state"]){submitLink({href:h,target:t});}else{if(extraUrl){h+="&"+extraUrl;}window.open(h,t);}};TCH.prototype._parameterizeUrl=function TCH__parameterizeUrl(h,p){if(!p){return h;}var delim=(/\?$/.test(h))?"":"&";var parent=this.get("parent");for(var i=0,cnt=p.length;i<cnt;i++){var v=mstr.controllers.Factory.getPath(p[i].value,parent);v=(v!=undefined)?v:p[i].value;h+=delim+escape(p[i].n)+"="+escape(v);delim="&";}return h;};TCH.prototype._resolveTarget=function TCH__resolveTarget(info){var t="_self";if(info.target){t=info.target;}else{if(info.iframe){t="frameManager";}else{if(info["use-window-open"]){t="_blank";}}}return t;};function TCH(props){mstr.models.BaseModel.apply(this,[props]);}return TCH;})();mstr.models.ToolbarButtonHelper=(function(){mstr.$O.extendsClass(TBH,mstr.models.ToolbarControlHelper);TBH.prototype.execPressed=function TBH_execPressed(){var cmdId=this.getCmdId();if(cmdId){var target=this.getTarget();var zz=target&&target.commands&&target.commands.exec(cmdId);}this.processCustomizations();};function TBH(props){mstr.models.ToolbarControlHelper.apply(this,[props]);}return TBH;})();mstr.models.ToolbarDualStateButtonHelper=(function(){mstr.$O.extendsClass(TDBH,mstr.models.ToolbarButtonHelper);TDBH.prototype.synchronizeControl=function TDBH_synchronizeControl(){if(!mstr.models.ToolbarButtonHelper.prototype.synchronizeControl.apply(this,arguments)){return false;}var target=this.getTarget();this.get("parent").set("state",target&&target.commands.queryState(this.getCmdId()));};TDBH.prototype.execPressed=function TDBH_execPressed(){var parent=this.get("parent");var newState=!parent.get("state");parent.set("state",newState);var cmdId=this.getCmdId();if(cmdId){var target=this.getTarget();var zz=target&&target.commands&&target.commands.exec(cmdId,newState);}this.processCustomizations();};function TDBH(props){mstr.models.ToolbarButtonHelper.apply(this,[props]);}return TDBH;})();mstr.models.ToolbarListHelper=(function(){mstr.$O.extendsClass(TLH,mstr.models.ToolbarControlHelper);TLH.prototype.init=function TLH_init(excludedProps){mstr.models.ToolbarControlHelper.prototype.init.apply(this,arguments);var parent=this.get("parent");parent.attachEventListener(this,"hashadd_selectedIndices","updateTarget");};TLH.prototype._getCustomizationInfo=function TLH__getCustomizationInfo(n){var p=this.get("parent");var item=p&&p.getSelectedItem();return(item&&mstr.controllers.Factory.safeget(item,n))||p.get(n);};TLH.prototype.updateTarget=function TLH_updateTarget(evt){if(this.get("synchronizing")){return ;}var p=this.get("parent");var item=p.getSelectedItem();if(!item){return ;}var cmdId=this.getCmdId();if(cmdId){var target=this.getTarget();var zz=target.commands&&target.commands.exec(cmdId,item[p.get("valueForm")]);}this.processCustomizations();};TLH.prototype.synchronizeControl=function TLH_synchronizeControl(){if(!mstr.models.ToolbarControlHelper.prototype.synchronizeControl.apply(this,arguments)){return false;}var target=this.getTarget();var value=target&&target.commands.queryState(this.getCmdId());if(!value){return true;}this.set("synchronizing",true);this.checkItemFeatures();var fn=(mstr.$A.isArray(value))?"execSelectValues":"execSelectValue";var success=this.get("parent")[fn](value);if(!success){this.get("parent").execClearSelect();}this.set("synchronizing",false);return true;};TLH.prototype.checkItemFeatures=function TLH_checkItemFeatures(){if(this.get("noFeatures")){return ;}var i,cnt;var p=this.get("parent");var c=this.get("cachedItems");if(!c){var items=p.getItems();var b=false;for(i=0,cnt=items.length;i<cnt;i++){if(items[i]["visibleFeatures"]){b=true;break;}}if(b){c=mstr.utils.Hash.deepClone(p.getItems());this.set("cachedItems",c);}else{this.set("noFeatures",true);return ;}}c=mstr.utils.Hash.deepClone(c);for(i=c.length-1;i>=0;i--){var f=c[i]["visibleFeatures"];if(!f){continue;}if(!mstr.behaviors.featureResolver.resolveFeatSet(f)){c.splice(i,1);}}p.setItems(c);};TLH.prototype.pickerButtonPushed=function TCPH_pickerButtonPushed(){if(this.get("parent").get("updateOnClick")){this.updateTarget();this.synchronizeControl();return true;}else{return false;}};function TLH(props){mstr.models.ToolbarControlHelper.apply(this,[props]);}return TLH;})();mstr.models.ToolbarCheckListHelper=(function(){mstr.$O.extendsClass(TCLH,mstr.models.ToolbarListHelper);TCLH.prototype.init=function TCLH_init(excludedProps){mstr.models.ToolbarListHelper.prototype.init.apply(this,arguments);var parent=this.get("parent");parent.attachEventListener(this,"hashremove_selectedIndices","cacheAction");parent.attachEventListener(this,"hashadd_selectedIndices","cacheAction");};TCLH.prototype.cacheAction=function TCLH_cacheAction(evt){if(this.get("synchronizing")){return ;}var v=this._killUpdateTimeout();v.push(this._packageValue(mstr.utils.Arrays.fromHashKeys(evt.memo.at,true),(evt.name=="hashadd_selectedIndices")));this._setUpdateTimeout(v);};TCLH.prototype.updateTarget=function TCLH_updateTarget(){if(this.get("synchronizing")){return ;}var ls=this.get("parent").get("lastSelection");var value=this.get("updateCache")||[this._packageValue(ls?[ls]:[],true)];this.set("updateCache",null);var cmdId=this.getCmdId();if(cmdId){var target=this.getTarget();var zz=target.commands&&target.commands.exec(cmdId,value);}};TCLH.prototype._packageValue=function TCLH__packageValue(indices,addition){addition=!!addition;var p=this.get("parent");var items=p.getItems();var vf=p.get("valueForm");var values=[];for(var i=0,cnt=indices.length;i<cnt;i++){values.push(items[indices[i]][vf]);}return{cl:addition,v:values};};TCLH.prototype._killUpdateTimeout=function TCLH_killUpdateTimeout(){if(this.get("updateHandle")){window.clearTimeout(this.get("updateHandle"));this.set("updateHandle",null);if(!!!this.get("discardQueue")){return this.get("updateCache");}}return[];};TCLH.prototype._setUpdateTimeout=function TCLH_setUpdateTimeout(v){this.set("updateCache",v);this.set("updateHandle",window.setTimeout('mstr.$obj("'+this.getId()+'").updateTarget();',0));};function TCLH(props){mstr.models.ToolbarListHelper.apply(this,[props]);}return TCLH;})();mstr.models.ToolbarDynamicListHelper=(function(){mstr.$O.extendsClass(TDLH,mstr.models.ToolbarListHelper);TDLH.prototype.synchronizeControl=function TDLH_synchronizeControl(){if(!mstr.models.ToolbarControlHelper.prototype.synchronizeControl.apply(this,arguments)){return false;}var target=this.getTarget();var state=target.commands.queryState(this.getCmdId());this.set("synchronizing",true);this.get("parent").setItems(state.items);var success=this.get("parent").execSelectValue(state.value);if(!success){this.get("parent").execClearSelect();}this.set("synchronizing",false);return true;};function TDLH(props){mstr.models.ToolbarListHelper.apply(this,[props]);}return TDLH;})();mstr.models.ToolbarColorPickerHelper=(function(){mstr.$O.extendsClass(TCPH,mstr.models.ToolbarControlHelper);TCPH.prototype.init=function TCPH_init(excludedProps){mstr.models.ToolbarControlHelper.prototype.init.apply(this,arguments);var parent=this.get("parent");parent.attachEventListener(this,"set_actualColor","updateTarget");};TCPH.prototype.updateTarget=function TCPH_updateTarget(evt){if(this.get("synchronizing")){return ;}var v=evt.memo.value;this.get("parent").set("lastColor",v);this.getTarget().commands.exec(this.getCmdId(),v);};TCPH.prototype.synchronizeControl=function TCPH_synchronizeControl(){if(!mstr.models.ToolbarControlHelper.prototype.synchronizeControl.apply(this,arguments)){return ;}var target=this.getTarget();var value=target.commands.queryState(this.getCmdId());this.set("synchronizing",true);this.get("parent").execSelectValue(value);this.set("synchronizing",false);value=target.commands.queryState(this.getCmdId()+"_vf");if(value!=""){this.get("parent").set("popup|viewFlags",value);}};TCPH.prototype.pickerButtonPushed=function TCPH_pickerButtonPushed(){var p=this.get("parent");var lc=p.get("lastColor");if(lc){p.set("actualColor",lc);this.synchronizeControl();}return true;};function TCPH(props){mstr.models.ToolbarControlHelper.apply(this,[props]);}return TCPH;})();mstr.models.ToolbarTextBoxHelper=(function(){mstr.$O.extendsClass(TTBH,mstr.models.ToolbarControlHelper);TTBH.prototype.init=function TTBH_init(){mstr.models.ToolbarControlHelper.prototype.init.apply(this,arguments);var parent=this.get("parent");parent.attachEventListener(this,"set_value","queueValue");};TTBH.prototype.queueValue=function TTBH_queueValue(evt){if(this.get("synchronizing")){return ;}var v=evt.memo.value;var parent=this.get("parent");var toolbar=parent.get("parent");toolbar.queueValue(parent.get("queueGroup"),this.getCmdId(),v);};TTBH.prototype.synchronizeControl=function TTBH_synchronizeControl(){var parent=this.get("parent");parent.get("parent").clearQueuedValues(parent.get("queueGroup"),this.getCmdId());var value="";if(mstr.models.ToolbarControlHelper.prototype.synchronizeControl.apply(this,arguments)){var target=this.getTarget();value=target.commands.queryState(this.getCmdId())||"";}this.set("synchronizing",true);this.get("parent").set("value",value);this.set("synchronizing",false);};function TTBH(props){mstr.models.ToolbarControlHelper.apply(this,[props]);}return TTBH;})();mstr.models.ToolbarButtonModel=(function(){mstr.$O.extendsClass(TBM,mstr.models.BaseModel);TBM.prototype.DEFAULTS={tooltip:"",enabled:true,visible:true};function TBM(props){mstr.models.BaseModel.apply(this,[props]);}return TBM;})();mstr.models.BlockContainer=(function(){mstr.$O.extendsClass(BC,mstr.models.BaseModel);BC.prototype.init=function BC_init(){mstr.models.BaseModel.prototype.init.call(this,["models","views"]);var i,p,obj,zz;var doc=this.props[mstr.$W.DOCUMENT];p=this.props.models;for(i=0;p&&p.length&&i<p.length;i++){obj=p[i][mstr.$W.SCRIPTCLASS]&&mstr.controllers.Factory.registerJSON(p[i],doc);if(obj){p[i]=obj;zz=obj.props&&(obj.props[mstr.$W.PARENT]=this);zz=obj.init&&obj.init();}}p=this.props.views;for(i=0;p&&p.length&&i<p.length;i++){obj=p[i][mstr.$W.SCRIPTCLASS]&&mstr.controllers.Factory.registerJSON(p[i],doc);if(obj){p[i]=obj;zz=obj.props&&(obj.props[mstr.$W.PARENT]=this);zz=obj.init&&obj.init();}}};function BC(props){mstr.models.BaseModel.apply(this,[props]);}return BC;})();mstr.models.InsertLayoutEditor=(function(){mstr.$O.extendsClass(ILE,mstr.models.BaseModel);ILE.prototype.init=function ILE_init(){this.props.existingLayouts.styleName="WidgetFolderStyle";mstr.models.BaseModel.prototype.init.call(this,["models","views"]);var models=["tabList","newDashboardLayouts","newDocumentLayouts","existingLayouts"];for(var i=0;i<4;i++){var m=this.get(models[i]);m.attachEventListener(this,"hashadd_selectedIndices","updateCommandEnabledSubmitModel");m.attachEventListener(this,"hashremove_selectedIndices","updateCommandEnabledSubmitModel");}};ILE.prototype.updateCommandEnabledSubmitModel=function ILE_CommandEnabledSubmitModel(){this.set("CommandEnabledSubmitModel",(this._getSelectedItem()!=null));};ILE.prototype.execSubmitModel=function ILE_execSubmitModel(){var item=this._getSelectedItem();if(!item){return false;}var target=mstr.$obj(this.props.boneId);if(target){target.commands.exec("unloadDocViewer");}var isLayout=this.get("tabList").getSelectedIndex()!=2?"1":"0";var um=microstrategy.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.RW_IMPORT_DOC,mstr.$obj("mstrPageInfo").get("beanPath"),["2048001","2048175"],[item.dssid,isLayout])]);um.flushAndSubmitChanges();return true;};ILE.prototype._getSelectedItem=function ILE__getSelectedItem(){var index=this.get("tabList").getSelectedIndex();if(index==NaN||index==-1){return null;}if(index==0){p="newDashboardLayouts";}else{if(index==1){p="newDocumentLayouts";}else{if(index==2){p="existingLayouts";}}}return this.get(p).getSelectedItem();};function ILE(props){mstr.models.BaseModel.apply(this,[props]);}return ILE;})();mstr.models.ContextMenuModel=(function(){mstr.$O.extendsClass(CMM,mstr.models.BaseModel);CMM.prototype.execPopulate=function CMM_execPopulate(){if(this.gridMenuItemsMap[this.getGridKey()]==null){var ondemandMenusRequestInputs=null;ondemandMenusRequestInputs=new mstr.http.OndemandContextMenuInputs(this.getGridKey());this.submitRequest(ondemandMenusRequestInputs,{});}else{this.raiseEvent("set_menu_ready",null);}};CMM.prototype.clearMenuItems=function CMM_clearMenuItems(gridKey){this.gridMenuItemsMap[gridKey]=null;this.submittedGridKeys[gridKey]=null;};CMM.prototype.submitRequest=function CMM_submitRequest(reqInputs,memo){this.raiseEvent("set_menu_processing",null);if(this.submittedGridKeys[this.getGridKey()]==null){var id=mstr.models.BaseModel.prototype.submitRequest.apply(this,[reqInputs,memo]);this.submittedGridKeys[this.getGridKey()]=id;}};CMM.prototype.setGridKey=function CMM_setGridKey(key){this.gridKey=key;};CMM.prototype.getGridKey=function CMM_getGridKey(){return this.gridKey;};CMM.prototype.setCurrentDynamicMenuKey=function CMM_setCurrentDynamicMenuKey(key){this.currentDynamicMenuKey=key;};CMM.prototype.getCurrentDynamicMenuKey=function CMM_getCurrentDynamicMenuKey(){return this.currentDynamicMenuKey;};CMM.prototype.onRequestCallback=function CMM_onRequestCallback(req){mstr.models.BaseModel.prototype.onRequestCallback.apply(this,[req]);switch(this.props.readyState){case mstr.Enum.Widget.READYSTATE.ERROR:this.raiseEvent("set_hide_menu_processing",null);this.submittedGridKeys[this.getGridKey()]=null;break;}};CMM.prototype.loadRequestResponse=function CMM_loadRequestResponse(){var ctxt=this.props.requestContext;var data=ctxt&&ctxt.response&&ctxt.response.data;if(!data){this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);this.submittedGridKeys[this.getGridKey()]=null;return ;}if(data.dynamicMenus&&data.menuItems){var dyn_avItems=eval(data.dynamicMenus);var gridKey=this.getGridKey();for(var i=0;i<dyn_avItems.length;i++){var dynamicMenuKey=dyn_avItems[i][0];this.dynamicMenusMap[gridKey+dynamicMenuKey]=dyn_avItems[i][1];}this.gridMenuItemsMap[gridKey]=eval(data.menuItems);}this.props.requestContext={};this.set("readyState",mstr.Enum.Widget.READYSTATE.IDLE);this.raiseEvent("set_hide_menu_processing",null);this.raiseEvent("set_menu_ready",null);};CMM.prototype.getMenuItems=function CMM_getMenuItems(){return this.gridMenuItemsMap[this.getGridKey()];};CMM.prototype.getCurrentMenuItemIndices=function(){var hashKey=this.getGridKey()+this.getCurrentDynamicMenuKey();return this.dynamicMenusMap[hashKey]||null;};function CMM(props){mstr.models.BaseModel.apply(this,[props]);this.gridMenuItemsMap=[];this.dynamicMenusMap=[];this.currentDynamicMenuKey=null;this.gridKey=null;this.submittedGridKeys=[];}return CMM;})();mstr.models.ToolbarPickerListModel=(function(){mstr.$O.extendsClass(TPLM,mstr.models.ListModel);TPLM.prototype.on_hashadd_selectedIndices=function TPLM_on_hashadd_selectedIndices(evt){this._storeLastSelection(evt);mstr.models.ListModel.prototype.on_hashadd_selectedIndices.apply(this,arguments);};TPLM.prototype.on_hashremove_selectedIndices=function TPLM_on_hashremove_selectedIndices(evt){this._storeLastSelection(evt);mstr.models.ListModel.prototype.on_hashremove_selectedIndices.apply(this,arguments);};TPLM.prototype._storeLastSelection=function TPLM_storeLastSelection(evt){var th=this.get("toolbarHelper");if(!th||!th.get||th.get("synchronizing")){return ;}this.set("lastSelection",mstr.utils.Hash.firstKey(evt.memo.at));};function TPLM(props){mstr.models.ListModel.apply(this,[props]);}return TPLM;})();mstr.models.ToolbarBorderListModel=(function(){mstr.$O.extendsClass(TBLM,mstr.models.ToolbarPickerListModel);TBLM.prototype.execToggleSelect=function TBLM_exToggleSelect(index){var indices=this.props.selectedIndices;if(indices[index]){if(index<2){return false;}else{if(indices[0]){this.execRemoveSelect(0);}}this.execRemoveSelect(index);if(!indices[2]&&!indices[3]&&!indices[4]&&!indices[5]){index=1;this.execAddSelect(index);}}else{if(index==1){this.execClearSelect();}else{if(indices[1]){this.execRemoveSelect(1);}if(index==0){for(var i=2;i<6;i++){if(!indices[i]){this.execAddSelect(i);}}}else{var newIndices=mstr.utils.Hash.clone(indices);newIndices[index]=true;if(newIndices[2]&&newIndices[3]&&newIndices[4]&&newIndices[5]){this.execAddSelect(0);}}}this.execAddSelect(index);}this.set("leadIndex",index);return true;};function TBLM(props){mstr.models.ToolbarPickerListModel.apply(this,[props]);}return TBLM;})();mstr.behaviors.TriStateCheckBox=(function(){var T={};T._DISABLED="Disabled";T._INTERMEDIATE="Intermediate";T._ON="On";T._OFF="Off";T.on_set_enabled=function T_on_set_enabled(view,model,rootTag){var imgDivTag=rootTag.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0];var captionTag=rootTag.childNodes[0].childNodes[0].childNodes[0].childNodes[1].childNodes[0];var cssPrefix=view.props.cssPrefix+view.props.cssClass;if(view.props.enabled==false){imgDivTag.className=cssPrefix+this._DISABLED;captionTag.className=cssPrefix+"Caption"+this._DISABLED;return ;}else{this.setTriState(view,model,rootTag);}};T.on_model_hashadd_selectedIndices=function T_on_model_hashadd_selectedIndices(view,model,rootTag){if(view.get("enabled")){this.setTriState(view,model,rootTag);}};T.setTriState=function T_setTriState(view,model,rootTag){var imgDivTag=rootTag.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0];var captionTag=rootTag.childNodes[0].childNodes[0].childNodes[0].childNodes[1].childNodes[0];var cssPrefix=view.props.cssPrefix+view.props.cssClass;var selectedIndex=model.getSelectedIndex();var cssClass=model.props.items[selectedIndex].cssClass;switch(selectedIndex){case 0:imgDivTag.className=cssPrefix+(cssClass||this._INTERMEDIATE);break;case 1:imgDivTag.className=cssPrefix+(cssClass||this._ON);captionTag.className=cssPrefix+"Caption"+(cssClass||this._ON);break;case 2:imgDivTag.className=cssPrefix+(cssClass||this._OFF);captionTag.className=cssPrefix+"Caption"+(cssClass||this._OFF);break;}};return T;})();mstr.behaviors.ToolbarPickerButton=(function(){var TPB=mstr.$H.clone(mstr.behaviors.Pulldown);TPB.on_set_enabled=function TPB_on_set_enabled(view,model,rootTag){var en=!!view.props.enabled;rootTag.disabled=!en;var h="0px",w="0px";if(!en){h="20px";w="22px";}var mask=rootTag.childNodes[1].rows[0].cells[1].firstChild.childNodes[3];mask.style.height=h;mask.style.width=w;};TPB.pickerButtonPushed=function TPB_pickerButtonPushed(viewId){var v=mstr.$obj(viewId);if(!v.get("enabled")){return ;}var m=v.getModel();var h=m.get("toolbarHelper");if(h&&h.pickerButtonPushed&&!h.pickerButtonPushed()){mstr.behaviors.ToolbarPickerButton.onmousedown(viewId);}};return TPB;})();mstr.behaviors.ColorPickerPopup=(function(){var CPP={elements:{0:mstr.Enum.ColorPickerFlags.NO_COLOR,1:mstr.Enum.ColorPickerFlags.AUTOMATIC,3:mstr.Enum.ColorPickerFlags.USER_COLORS,4:mstr.Enum.ColorPickerFlags.MORE_COLORS,5:mstr.Enum.ColorPickerFlags.GRADIENT_COLORS,6:mstr.Enum.ColorPickerFlags.GRAPH_GRADIENTS}};CPP.resolveViewFlags=function TPB_resolveViewFlags(view){var vf=view.props.viewFlags;for(var index in CPP.elements){if(!!(vf&CPP.elements[index])){view._showChildViewAtPath("children/"+index);}else{mstr.controllers.Factory.safeset(view.props.children[index],"visible",false);}}};return CPP;})();mstr.itemrenderers.FastTileView=(function(){var FTV=mstr.$H.clone(mstr.itemrenderers.FastListView);FTV.renderListItem=function FTV_renderListItem(view,model,rootTag,context,noIcon){var item=context.item;var doc=view.props[mstr.$W.DOCUMENT];var css=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||"");if("enabled" in item&&!item.enabled){css+="Disabled";}var elDiv=doc.createElement("div");if(item.cssClass){elDiv.className=item.cssClass+" "+css;}else{elDiv.className=css;}if(item.cssText){elDiv.style.cssText=item.cssText;}if(item.desc!=null&&item.desc!=""){elDiv.title=item.n+". "+item.desc;}else{elDiv.title=item.n||"";}var elDivName=doc.createElement("div");elDiv.appendChild(elDivName);elDivName.className=css+"Name";if(view.props.showDescriptions&&item.desc){var elDivDesc=doc.createElement("div");elDiv.appendChild(elDivDesc);elDivDesc.className=css+"Desc";elDivDesc.appendChild(doc.createTextNode(item.desc));}else{var elDivDesc=null;}if(view.props.itemCSSPrefix!="TileViewItem"){var elNameText=doc.createTextNode(item.n||"");var browseCommand=context.browseCommand;if(browseCommand&&!item.locked){var elHlink=doc.createElement("a");elDivName.appendChild(elHlink);elHlink.appendChild(elNameText);elHlink.href="javascript:void(0)";browseCommand=null;}else{elDivName.appendChild(elNameText);}}if(view.props.showIcons&&!noIcon){var icon=item.icon;if(item.locked){icon+="_locked";}var elDivNameImg=doc.createElement("div");elDivNameImg.className="mstrTileViewImgContainer";elDivName.appendChild(elDivNameImg);var src;if(!icon){var grpTp=microstrategy.bones.ribbon_graphToolbar.block.get("major").getSelectedItems();if(grpTp){var type=mstr.Settings.Scheme.LARGEPREVIEWS[grpTp[0].icon];src=type+"_"+item.dssid;elDivNameImg.className+=" "+type+"_subtype";}}else{src=mstr.Settings.Scheme.LARGEPREVIEWS[icon];}if(src){if(src.substr(0,5)=="graph"&&icon){elDivNameImg.className+=" graphBgImg";}elDivNameImg.className+=" "+src;if(view.props.itemCSSPrefix!="TileViewItem"){elDivName.style.paddingLeft="23px";if(elDivDesc){elDivDesc.style.paddingLeft="23px";}}}else{if(icon){elDivNameImg.className+=" "+icon;if(view.props.itemCSSPrefix!="TileViewItem"){elDivName.style.paddingLeft="23px";if(elDivDesc){elDivDesc.style.paddingLeft="23px";}}}}var elDivNameImgHvr=doc.createElement("div");elDivNameImgHvr.className=css+"NameImg";elDivNameImg.appendChild(elDivNameImgHvr);elDivNameImgHvr.onmouseover=this.hover;elDivNameImgHvr.onmouseout=this.unhover;}return elDiv;};return FTV;})();mstr.itemrenderers.PreviewPickerView=(function(){var PPV=mstr.$H.clone(mstr.itemrenderers.ListPulldownView);PPV.renderListItem=function(view,model,rootTag,context){var elDiv=mstr.itemrenderers.FastTileView.renderListItem(view,model,rootTag,context,true);var elCont=this._getContentContainer(rootTag);mstr.utils.Dom.clearChild(elCont,0);elCont.appendChild(elDiv);elCont.title=elDiv.title||"";if(mstr.utils.ISIE4){var s=elCont.style,wasWidth=s.width;if(wasWidth==null){wasWidth="";}s.width="1px";s.width=wasWidth;}};return PPV;})();mstr.itemrenderers.ColorPickerView=(function(){var CPV=mstr.$H.clone(mstr.itemrenderers.ListPulldownView);CPV.renderListItem=function(view,model,rootTag,context){this._renderItem(view,model,rootTag,context.item);};CPV.renderEmpty=function(view,model,rootTag,context){var value=model&&model.get("actualColor");if(value){var vf=model.get("valueForm");var item={};item[vf]=value;if(vf!="n"){item.n=microstrategy.descriptors.getDescriptor("2133")+" "+value;}this._renderItem(view,model,rootTag,item);}else{mstr.itemrenderers.ListPulldownView.renderEmpty(view,model,rootTag,context);}};CPV._renderItem=function(view,model,rootTag,item){var doc=view.props[mstr.$W.DOCUMENT];var css=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||"");var elDiv=doc.createElement("div");elDiv.className=css+"ColorItem";var value=item[model.get("valueForm")];if(value!=null&&value.indexOf(",")>-1){mstr.itemrenderers.GradientItem.renderGradientItem(elDiv,value,80,12);}else{if(value!="#"&&(!(bIsIE6||bIsIE7||bIsIE8||bIsIE9)||value!="0")){elDiv.style.backgroundColor=(value!="automatic")?value:"transparent";}if(item.n){elDiv.setAttribute("title",item.n);}if(value.toLowerCase()=="transparent"||value.toLowerCase()=="automatic"){elDiv.style.border="1px dashed #999999";}}var elCont=this._getContentContainer(rootTag);mstr.utils.Dom.clearChild(elCont,0);elCont.appendChild(elDiv);};return CPV;})();mstr.itemrenderers.ColorPickerListView=(function(){var SCP=mstr.$H.clone(mstr.itemrenderers.ListView);SCP.renderListItem=function(view,model,rootTag,context){var item=context.item;var doc=view.props[mstr.$W.DOCUMENT];var css=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||"");var isTransparent=(item.dssid=="transparent");if(!view.props.renderTransparent&&isTransparent){return null;}var isAutomatic=(item.dssid=="automatic");if(!view.props.renderAutomatic&&isAutomatic){return null;}if(item.dssid.indexOf(",")>-1){return null;}var elSpan=doc.createElement("span");elSpan.className=css+view.props.itemCssClass;elSpan.style.backgroundColor=item.dssid;elSpan.setAttribute("title",item.n);elSpan.onmouseover=this.hover;elSpan.onmouseout=this.unhover;if(isTransparent){elSpan.style.cursor="default";}this._insertElementForIndex(view,rootTag,context.at,elSpan);return elSpan;};SCP.on_set_visible=function T_on_set_visible(view,model,rootTag){var visible=view.props.visible;if(visible){var uc=mstr.$obj("mstrPageInfo")&&mstr.$obj("mstrPageInfo").get("userPalette");if(uc){if(model&&model.getSelectedItem()){uc.execClearSelect();}else{var v=model&&model.get("actualColor");if(v){uc.execSelectValue(v.toUpperCase());}}}}mstr.behaviors.Generic.set_css_display(rootTag,"block","none",view.props.visible);};SCP.hover=function SCP_hover(){this.className+="Hover";};SCP.unhover=function SCP_hover(){this.className=this.className.replace(/Hover/,"");};return SCP;})();mstr.itemrenderers.GradientItem=(function(){var GI={};GI.renderGradientItem=function(el,g,w,h){var parts=g.split(",");var c1=mstr.utils.Color.hex2rgb(parts[0]);var c2=mstr.utils.Color.hex2rgb(parts[1]);var d=gradientUtil.GRADIENTSHADING_STYLE_CUSTOM;var box=1;var type=parts[2];var angle=parseInt(parts[3],10);var x=parseInt(parts[4],10);var y=parseInt(parts[5],10);if(type=="9"){d=gradientUtil.GRADIENTSHADING_STYLE_FROMCENTER;box=3;}else{if(type=="10"){if(x==50){d=gradientUtil.GRADIENTSHADING_STYLE_FROMCENTER;if(angle==45){box=2;}}else{d=gradientUtil.GRADIENTSHADING_STYLE_FROMCORNER;if(x+y==200){box=3;}else{if(x+y==100){box=(x==100)?2:4;}}}}else{if(angle==0||angle==90){d=(angle==0)?gradientUtil.GRADIENTSHADING_STYLE_HORIZONTAL:gradientUtil.GRADIENTSHADING_STYLE_VERTICAL;}else{d=(angle==135)?gradientUtil.GRADIENTSHADING_STYLE_DIAGONALUP:gradientUtil.GRADIENTSHADING_STYLE_DIAGONALDOWN;}var f=(angle==0)?x:y;if(f==100){box=2;}else{if(f==50){box=3;}}}}var limit=(w/gradientUtil.PIXEL_WIDTH)*(h/gradientUtil.PIXEL_WIDTH);for(var i=0;i<limit;i++){var p=document.createElement("div");p.className="pixel";var comp=gradientUtil.getColorPercent(gradientUtil.getXCoordinate(i,w),gradientUtil.getYCoordinate(i,h),box,w,d);var r=parseInt(comp*(c2[0]-c1[0]))+c1[0];var g=parseInt(comp*(c2[1]-c1[1]))+c1[1];var b=parseInt(comp*(c2[2]-c1[2]))+c1[2];p.style.backgroundColor="rgb("+r+", "+g+", "+b+")";el.appendChild(p);}};return GI;})();mstr.itemrenderers.GradientListView=(function(){var GLV=mstr.$H.clone(mstr.itemrenderers.ListView);GLV.renderListItem=function(view,model,rootTag,context){var item=context.item;var doc=view.props[mstr.$W.DOCUMENT];var css=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||"");var elSpan=doc.createElement("span");elSpan.className=css;elSpan.setAttribute("title",mstr.itemrenderers.GradientListView._buildTooltip(item.dssid,item.flashOnly));mstr.itemrenderers.GradientItem.renderGradientItem(elSpan,item.dssid,50,50);var fos=document.createElement("span");var vp=view.props;fos.className=vp.cssPrefix+vp.cssClass+"ItemContainer";var txt=document.createElement("span");txt.innerHTML=item.flashOnly?microstrategy.descriptors.getDescriptor("4875"):"&nbsp;";txt.style.paddingLeft="5px";fos.appendChild(txt);fos.appendChild(elSpan);elSpan=fos;this._insertElementForIndex(view,rootTag,context.at,elSpan);return elSpan;};GLV._buildTooltip=function GLV__buildTooltip(g,fo){var parts=g.split(",");var t=microstrategy.descriptors.getDescriptor("4883")+" ";if(parts[2]=="9"){t+=microstrategy.descriptors.getDescriptor("4889");}else{if(parts[2]=="10"){t+=microstrategy.descriptors.getDescriptor("4862");}else{t+=microstrategy.descriptors.getDescriptor("4888");}}t+="; "+microstrategy.descriptors.getDescriptor("4884")+" "+parts[3]+"; "+microstrategy.descriptors.getDescriptor("4885")+" "+parts[5]+"; "+microstrategy.descriptors.getDescriptor("4886")+" "+parts[4];if(fo){t+="; "+microstrategy.descriptors.getDescriptor("4875");}return t;};return GLV;})();mstr.itemrenderers.ToolbarRadioButtons=(function(){var TRB=mstr.$H.clone(mstr.itemrenderers.ListView);TRB.renderListItem=function(view,model,rootTag,context){var item=context.item;var doc=view.props[mstr.$W.DOCUMENT];var css=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||"");var a=doc.createElement("a");a.className=css;a.setAttribute("title",item.n);var s=doc.createElement("span");if(item.id){s.setAttribute("id",item.id);}s.setAttribute("align","absmiddle");s.onmouseover=function(){mstr.itemrenderers.ToolbarRadioButtons.markListItemAsSelected(view,model,rootTag,context);};s.onmouseout=function(){mstr.itemrenderers.ToolbarRadioButtons.markListItemAsUnselected(view,model,rootTag,context);};a.appendChild(s);this._insertElementForIndex(view,rootTag,context.at,a);return a;};TRB.markListItemAsSelected=function TRB_mLIasSelected(view,model,rootTag,context){var item=this._findElementForIndex(view,rootTag,context.at);if(item){item.className+=" on";}};TRB.markListItemAsUnselected=function TRB_mLIasUnselected(view,model,rootTag,context){var item=this._findElementForIndex(view,rootTag,context.at);if(item){item.className=item.className.replace(" on","");}};return TRB;})();mstr.itemrenderers.ToolbarPickerButton=(function(){var TPB=mstr.$H.clone(mstr.itemrenderers.ListPulldownView);TPB.renderListItem=function(view,model,rootTag,context){if(view.get("showLastSelection")){var ls=model.get("lastSelection");if(!isNaN(ls)){context.item=model.getItems()[model.get("lastSelection")];}else{return ;}}mstr.itemrenderers.ListPulldownView.renderListItem.apply(this,[view,model,rootTag,context]);this._updatePickerButton(view,rootTag);};TPB.renderMultipleItems=function(view,model,rootTag,context){this.renderListItem(view,model,rootTag,context);};TPB._updatePickerButton=function(view,rootTag){var tt=view.getModel().get("tooltip");var el=this._getContentContainer(rootTag);var ttEls=[el];if(view.get("useDynamicBtnImg")){if(el.firstChild.nodeType==3){el.innerHTML="";}else{el.replaceChild(el.firstChild.cloneNode(false),el.firstChild);ttEls.push(el.firstChild);}}else{el.removeChild(el.firstChild);}if(tt){for(var i=0,cnt=ttEls.length;i<cnt;i++){ttEls[i].setAttribute("title",tt);}}};TPB.renderEmpty=function(view,model,rootTag,context){};TPB._getContentContainer=function(rootTag){return rootTag.childNodes[1].rows[0].cells[1].firstChild.childNodes[1];};return TPB;})();mstr.itemrenderers.VerticalTileList=(function(){var VT=mstr.$H.clone(mstr.itemrenderers.ListView);VT.renderListItem=function(view,model,rootTag,context){var item=context.item;var doc=view.props[mstr.$W.DOCUMENT];var css=(view.props.cssPrefix||"")+(view.props.itemCSSPrefix||"");var elDiv=doc.createElement("div");elDiv.className=css;elDiv.setAttribute("id","vt_"+item.dssid);if(view.props.showDescriptions&&item.desc){elDiv.setAttribute("title",item.desc);}if(view.props.showIcons){var imgDiv=doc.createElement("div");imgDiv.className=css+"Img";elDiv.appendChild(imgDiv);}var txtDiv=doc.createElement("div");txtDiv.className=css+"Txt";txtDiv.innerHTML=item.n;elDiv.appendChild(txtDiv);this._insertElementForIndex(view,rootTag,context.at,elDiv);return elDiv;};return VT;})();mstr.itemrenderers.FontList=(function(){var FL={};FL.renderListItem=function TTL_renderListItem(view,model,rootTag,context){var itemDiv=mstr.itemrenderers.FastListView.renderListItem.apply(this,[view,model,rootTag,context]);itemDiv.style.fontFamily=context.item[model.get("valueForm")];return itemDiv;};FL.hover=function(e){this.className+="Hover";};FL.unhover=function(e){this.className=this.className.replace(/Hover/,"");};FL.markListItemAsSelected=function FLV_mLIasSelected(view,model,rootTag,context){mstr.itemrenderers.FastListView.markListItemAsSelected.apply(this,[view,model,rootTag,context]);};FL.markListItemAsUnselected=function FLV_mLIasUnselected(view,model,rootTag,context){mstr.itemrenderers.FastListView.markListItemAsUnselected.apply(this,[view,model,rootTag,context]);};FL.on_set_leadIndex=function FL_on_set_leadIndex(view,model,rootTag){mstr.itemrenderers.FastListView.on_set_leadIndex.apply(this,[view,model,rootTag]);};return FL;})();mstr.itemrenderers.TabTreeList=(function(){var TTL={};var f=function(evt){var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);itemRenderer&&itemRenderer.on_target_object_change(this,this.getModel(),this.get("element"),{item:evt.src,at:this.getModel().indexOfItem(evt.src)});};TTL.on_target_object_change=function TTL_on_target_object_change(view,model,rootTag,context){var item=context.item;var el=mstr.itemrenderers.TabTreeList.findElementFromIndex(view,model,rootTag,context);var vz=item.get(item.get("visibleField"));el.style.display=(vz)?"block":"none";var category=item.get("categoryText");var celem=view.props.categoryElems;if(celem&&celem[category]){var velem=celem[category]["visibleElems"];velem+=item.get(item.get("visibleField"))?1:-1;celem[category]["visibleElems"]=velem;celem[category]["elem"].style.display=(velem==0)?"none":"block";}};TTL.renderListItem=function TTL_renderListItem(view,model,rootTag,context){var doc=view.props.document;var css=(view.props.cssPrefix||"")+(view.props.cssClass||"");var contents=view.get("scrollArea").childNodes[0];var items=model.getItems();var item=context.item;var category=item.get("categoryText");var itemDiv=null;var valueForm=model.get("valueForm");var celem=view.props.categoryElems;if(!celem){celem=[];view.props.categoryElems=celem;}if(context.at==0||category!=items[context.at-1].get("categoryText")){itemDiv=doc.createElement("div");itemDiv.className=css+"TabTreeItemCategory";itemDiv.appendChild(doc.createTextNode(category));contents.appendChild(itemDiv);var valueFormValue=item[valueForm];if(valueFormValue==null&&item.get){valueFormValue=item.get(valueForm);}itemDiv.mstrListItemInfo=view.getId()+"/"+(valueFormValue||"")+"/"+context.browseCommand;celem[category]={elem:itemDiv,visibleElems:0};itemDiv.style.display="none";}var titleField=item.get("titleField"),title=item.get("titleText"),titleDiv=doc.createElement("div");if(titleField!=null){title=item.get(titleField);view._notifyTitleChanged=function(){title=item.get(titleField);titleDiv.innerHTML="";titleDiv.appendChild(doc.createTextNode(title));};item.attachEventListener(view,"set_"+titleField,"_notifyTitleChanged");}titleDiv.className=css+"TabTreeItem";contents.appendChild(titleDiv);titleDiv.onmouseover=this.hover;titleDiv.onmouseout=this.unhover;titleDiv.appendChild(doc.createTextNode(title));var visibleField=item.get("visibleField");var visible=false;if(visibleField!=null){visible=item.get(visibleField);if(!view._notifyItemRenderer){view._notifyItemRenderer=f;}item.attachEventListener(view,"set_"+visibleField,"_notifyItemRenderer");}else{visible=item.get("visible");}titleDiv.style.display=visible?"block":"none";if(visible){celem[category]["elem"].style.display="block";celem[category]["visibleElems"]++;}return titleDiv;};TTL.markListItemAsSelected=function TTL_mLIasSelected(view,model,rootTag,context){var el=mstr.itemrenderers.TabTreeList.findElementFromIndex(view,model,rootTag,context);if(!el){return ;}var c=el.className;if(/Hover/.test(c)){c=c.replace(/Hover/,"SelectedHover");}else{c+="Selected";}el.className=c;};TTL.markListItemAsUnselected=function TTL_mLIasUnselected(view,model,rootTag,context){var el=mstr.itemrenderers.TabTreeList.findElementFromIndex(view,model,rootTag,context);if(el){el.className=el.className.replace(/Selected/,"");}};TTL.hover=function TTL_hover(){this.className+="Hover";};TTL.unhover=function TTL_unhover(css){this.className=this.className.replace(/Hover/,"");};TTL.findElementFromIndex=function TTL_findElementFromIndex(view,model,rootTag,context){var index=parseInt(context.at);if(isNaN(index)||index<0){return null;}var items=model.getItems();var delta=0;var oldCategory="";for(var i=0;i<=index;i++){var category=items[i].get("categoryText");if(category!=oldCategory){delta++;}oldCategory=category;}return view.get("scrollArea").childNodes[0].childNodes[index+delta];};return TTL;})();mstr.behaviors.FontPreview=(function(){var FP={};FP.on_set_enabled=function(rootTag,enabled){if(enabled){rootTag.className=rootTag.className.replace("Disabled","");}else{if(rootTag.className.indexOf("Disabled")==-1){rootTag.className+="Disabled";}}};FP.on_model_set_prop=function(rootTag,prop,view,model){var value=model&&model.get(view.get(prop));if(value instanceof mstr.models.ColorPicker){value=value.get("actualColor");}else{if(value instanceof mstr.models.ListModel){var item=value.getSelectedItem();var vf=value.get("valueForm");value=(item&&item[vf])||(prop=="fontFamily"&&"Arial")||(prop=="fontSize"&&"10")||value.getItems()[0][vf];}}if(isNaN(value)&&!value){return ;}var previewNode=rootTag.childNodes[1];if(prop=="boldItalic"){previewNode.style.fontWeight=(value==1||value==3)?"bold":"normal";previewNode.style.fontStyle=(value==2||value==3)?"italic":"normal";}else{switch(prop){case"fontSize":value+="pt";break;case"textUnderline":case"textStrikeout":prop="textDecoration";var isUnderline=model.get(view.get("textUnderline"));var isStrikeout=model.get(view.get("textStrikeout"));if(!isUnderline&&!isStrikeout){value="none";}else{value=(isUnderline)?"underline":"";value+=(isStrikeout)?" line-through":"";}break;case"fontColor":prop="color";previewNode.style.backgroundColor=mstr.utils.Color.getContrastingColor(value,["#ffffff","#000000"]);break;}previewNode.style[prop]=value;}};return FP;})();mstr.behaviors.ImagePreview=(function(){var IP={};IP.on_set_src=function(rootTag,view,model){if(rootTag.intervalHandle){window.clearInterval(rootTag.intervalHandle);}mstr.$D.clearChilds(rootTag);var src=model.get(view.get("valueField"));if(!src||src.length==0){return ;}if(src!==""){var imgUrl=document.getElementById("imgUrl_txt");if(imgUrl){var preID=microstrategy.getViewerBone().doc.prevSelectedId,preEl=document.getElementById(preID),urlType=Number(preEl.getAttribute("ut")),_S=mstrmojo.string;switch(urlType){case mstr.Enum.IMAGE_URL_TYPE.DUMMY_URL:imgUrl.value="";return ;case mstr.Enum.IMAGE_URL_TYPE.TASK_URL:imgUrl.value=decodeURIComponent(preEl.getAttribute("n"));break;case mstr.Enum.IMAGE_URL_TYPE.BLOB_URL:case mstr.Enum.IMAGE_URL_TYPE.IMAGE_NAME:src=rootTag.blobURL;imgUrl.value=rootTag.imgName;break;}}}if(mstr.utils.ISFF){var t=src.split("?");if(t.length>1){t[0]=t[0].replace(/\\/g,"/");src=t.join("?");}else{src=t[0].replace(/\\/g,"/");}}var img=view.get("document").createElement("img");img.style.visibility="hidden";img.src=src;var el=view.get(mstr.Props.Widget.ELEMENT);var pw=mstr.utils.BoxModel.getElementInnerWidth(el),ph=mstr.utils.BoxModel.getElementInnerHeight(el);if(!pw||!ph){pw=parseInt(mstr.utils.CSS.getStyleValue(el,"width"));ph=parseInt(mstr.utils.CSS.getStyleValue(el,"height"));}pw=Math.max(pw-6,0);ph=Math.max(ph-6,0);var pRatio=pw/ph;var start=new Date();var error=false;rootTag.intervalHandle=window.setInterval(function(){var ready=(img.readyState=="complete"||img.complete);var timeOut=(new Date()-start>=5000);var iw=mstr.utils.BoxModel.getElementOuterWidth(img);var ih=mstr.utils.BoxModel.getElementOuterHeight(img);var isLoading=mstr.utils.ISIE4?(img.readyState=="loading"):(iw&&ih);if(ready||timeOut||error||isLoading){window.clearInterval(rootTag.intervalHandle);(isLoading||ready)&&fitIntoBox();}img.style.visibility="visible";},100);var fitIntoBox=function(){var iw=mstr.utils.BoxModel.getElementOuterWidth(img);var ih=mstr.utils.BoxModel.getElementOuterHeight(img);var iRatio=iw/ih;if(ih>ph||iw>pw){if(iRatio>pRatio){iw=pw;ih=(pw/iRatio);}else{ih=ph;iw=ih*iRatio;}img.style.width=iw+"px";img.style.height=ih+"px";}img.style.marginTop=Math.abs(((ph-ih)/2))+3+"px";};img.onload=fitIntoBox;img.onerror=function(){error=true;fitIntoBox();};rootTag.appendChild(img);};IP.on_set_visible=function IP_on_set_visible(el,displayShow,displayHide,bShow){mstr.behaviors.Generic.set_css_display(el,displayShow,displayHide,bShow);if(!mstr.utils.ISIE4){return ;}var imgs=el.getElementsByTagName("img");if(imgs[0]){imgs[0].style.visibility=(!!bShow)?"visible":"hidden";}};return IP;})();mstr.behaviors.Tab=(function(){var TAB={};TAB.on_set_visible=function(rootTag,view,model){var vis=!!view.props.visible;var s=rootTag.style;s.display=vis?"block":"none";s.visibility=vis?"inherit":"hidden";var helpTopic=(view.get("helpTopic")==null?"":view.get("helpTopic"));var p=view.props[mstr.$W.PARENT];while(p&&!(p instanceof mstr.views.FloatingEditor)){p=p.props[mstr.$W.PARENT];}if(p&&(p instanceof mstr.views.FloatingEditor)){p.set("helpTopic",helpTopic);}};return TAB;})();mstr.itemrenderers.TabbedToolbarView=(function(){var TTV=mstr.$H.clone(mstr.itemrenderers.ListView);TTV.markListItemAsUnselected=function TTV_mLIasUnselected(view,model,rootTag,context){var el=this._findElementForIndex(view,rootTag,context.at);if(!el){return ;}el.className=el.className.replace(/SelectedHover/,"");el.className=el.className.replace(/Selected/,"");el.className=el.className.replace(/pinned/,"");};TTV.markListItemAsSelected=function TTV_mLIasSelected(view,model,rootTag,context){var el=this._findElementForIndex(view,rootTag,context.at);if(!el){return ;}var c=el.className;if(/Selected/.test(c)){c=c.replace(/Selected/,"");}if(/Hover/.test(c)){c=c.replace(/Hover/,"SelectedHover");}else{c+="Selected";}if(model.get("items")[context.at]["pinned"]){c="pinned "+c;}else{if(/pinned/.test(c)){c=c.replace(/pinned/,"");}}el.className=c;};TTV.renderListItem=function(view,model,rootTag,context){var elDiv=mstr.itemrenderers.FastListView.renderListItem(view,model,rootTag,context);elDiv.title="";var table=document.createElement("table");var row=table.insertRow(0);var preTab=row.insertCell(0);preTab.className="left";var tab=row.insertCell(1);var postTab=row.insertCell(2);var el=elDiv.childNodes[0];tab.appendChild(el);tab.className=el.className;el.className="";tab.onmousedown=function(evt){mstr.behaviors.ListView.onmousedown(evt||window.event,self,view.get("id"));};var disabled=false;var tabMdl,feat;if((tabMdl=model.get("items")[context.at])&&(feats=tabMdl.enabledFeatures)){disabled=!mstr.behaviors.featureResolver.resolveFeatSet(feats);}if(context.item.menuModel){postTab.className="right menu";var fn=function(evt){evt=evt||window.event;mstr.behaviors.ToolbarListView.displayMenu(evt,view,model,context,table);};postTab.onmouseover=fn;postTab.onmousedown=fn;if(disabled){tab.onmousedown=fn;}postTab=null;}else{postTab.className="right";if(disabled){elDiv.onmouseover=null;elDiv.onmouseout=null;}}tab=null;elDiv.appendChild(table);table.cellSpacing=0;this._insertElementForIndex(view,rootTag,context.at,elDiv);elDiv.style.display=(context.item.visible)?"block":"none";return elDiv;};TTV.hover=function(e){mstr.itemrenderers.FastListView.hover.apply(this,arguments);};TTV.unhover=function(e){mstr.itemrenderers.FastListView.unhover.apply(this,arguments);};return TTV;})();mstr.behaviors.ToolbarListView=(function(){var TLV={};TLV.displayMenu=function TLV_displayMenu(evt,view,model,context,rootTag){if(!mstr.controllers.Factory.getPath(view.getModel().get("targetPath"),view)||!mstr.behaviors.ToolbarListView.shouldProcessEvt(evt,model)){return ;}if(context&&context.item){var style=context.item.menuStyle?context.item.menuStyle:model.props.menuStyle;var modelName=context.item.menuModel;var layouts=context.item.layouts;}if(!style){return ;}var m=mstr.$obj(mstr.behaviors.FloatingMenu.getMenuId({modelName:modelName,layouts:layouts}));if(m&&m.get("visible")){if(evt.type==="mousedown"){m.execCloseMenu();}return ;}var menus=view.get("menus")||{};for(var id in menus){if(id!==style){var mnu=mstr.$obj(id);if(mnu&&mnu.get&&mnu.get("visible")){mnu.execCloseMenu();}}}menus[mstr.behaviors.FloatingMenu.getMenuId({modelName:modelName,layouts:layouts})]=true;view.set("menus",menus);var p=rootTag.parentNode;view.set("openerEl",p);mstr.behaviors.FloatingMenu.toggleOpenerHoverEffect(view,true);var x=mstr.utils.BoxModel.getElementSumOffsetLeft(rootTag);var y=mstr.utils.BoxModel.getElementSumOffsetTop(rootTag)+mstr.utils.BoxModel.getElementOuterHeight(rootTag);x+=getDocumentScrollLeft();y+=getDocumentScrollTop();mstr.behaviors.FloatingMenu.displayMenu(view,x,y,style,modelName,layouts,document.body);};TLV.shouldProcessEvt=function TLV_shouldProcessEvt(evt,model){return(!mstr.behaviors.featureResolver.featAvailable(model.get("featurePopMenus"))||evt.type!=="mouseover");};return TLV;})();mstr.behaviors.ToolbarButton=(function(){var TBB2={};TBB2.setButtonClassName=function(view,hover){var css=view.get("cssPrefix")+view.get("cssClass");var exc=view.get("extraCssClass");if(exc){css+=" "+exc;}var enabled=view.get("enabled");if(!enabled){css+=" disabled";}if(view.getModel().get("state")||(hover&&enabled)){css+=" on";}view.get("element").className=css;};return TBB2;})();mstr.behaviors.FloatingMenu=(function(){var FM={};FM.displayMenu=function(view,x,y,style,modelName,layouts,parentNode){if(view.get("requestingMenu")){return ;}microstrategy.setJLSCXMenuOpen(true);var viewProps={cssText:"top:"+y+"px;left:"+x+"px;z-index:"+mstr.views.FloatingMenuBook.prototype.getZIndex()+";",showing:view.get("mOverOpen")?false:true,viewer:view.getModel().get("targetPath"),modelName:modelName,ribbonId:view.getModel().get("id")};if(layouts){viewProps.layouts=layouts;}var e=microstrategy.getBlockEditorFromCache(this.getMenuId(viewProps),null,viewProps,view,parentNode);if(e){return ;}mstr.behaviors.FloatingMenu.showProgressIndicator(view,x,y,parentNode);view.set("requestingMenu",true);microstrategy.openBlockLoaderEditor(this.getMenuId(viewProps),style,null,viewProps,view,{scope:this,method:this.menuDisplayed},parentNode);};FM.getMenuId=function(viewProps){var layouts=viewProps.layouts?viewProps.layouts.replace(/[.,\/]/g,""):"";return viewProps.modelName+"_"+layouts;};FM.menuDisplayed=function(evt){var rc=evt.src.get("requestContext");var v=rc&&rc.memo&&rc.memo.opener;if(v){this.killProgressIndicator(v);}var evtName=evt&&evt.memo&&evt.memo.name;if(evtName=="readyState"){if(evt.memo.value==mstr.Enum.Widget.READYSTATE.ERROR||evt.memo.value==mstr.Enum.Widget.READYSTATE.CANCELLED){mstr.behaviors.FloatingMenu.toggleOpenerHoverEffect(v,false);}}};FM.showProgressIndicator=function(view,x,y,parentNode){var o={pn:parentNode,handle:window.setTimeout(function(){var doc=view.get("element").ownerDocument;var tbl=doc.createElement("table");tbl.className="select-free mstrFloatingMenu mstrFloatingMenuProgress";tbl.style.top=y+"px";tbl.style.left=x+"px";var td=tbl.insertRow(-1).insertCell(-1);td.appendChild(doc.createTextNode(microstrategy.descriptors.getDescriptor("2901")));var p=o.pn||doc.body;p.appendChild(tbl);o.indicator=tbl;},3000)};view.set("progressIndicator",o);parentNode=null;};FM.killProgressIndicator=function(view){var o=view&&view.get("progressIndicator");if(!o){return ;}var pg=o.indicator;if(!pg){window.clearTimeout(o.handle);}else{if(pg.parentNode){pg.parentNode.removeChild(pg);}}view.set("progressIndicator",null);view.set("requestingMenu",false);};FM.toggleOpenerHoverEffect=function FM_toggleOpenerHoverEffect(view,hideEffect){var p=view&&view.get&&view.get("openerEl");if(!p){return ;}var ir=mstr.utils.ListViewHelper.getItemRenderer(view);if(hideEffect){if(ir&&ir.hover){ir.hover.call(p);}p.ignoreMouseEvents=true;}else{p.ignoreMouseEvents=false;if(ir&&ir.unhover){ir.unhover.call(p);}}};FM.adjustMenuPosition=function FM_adjustMenuPosition(view){if(view.get("useFixedPosition")){return ;}var el=view.get("element");var p=el.parentNode;var doc=view.get("document");var x=parseInt(el.style.left,10);var y=parseInt(el.style.top,10);var w=mstr.utils.BoxModel.getElementOuterWidth(el);var h=mstr.utils.BoxModel.getElementOuterHeight(el);var boundX=0;var boundY=0;var scrollX=0;var scrollY=0;if(p==doc.body){scrollX=getDocumentScrollLeft();scrollY=getDocumentScrollTop();boundX=mstr.utils.BoxModel.getBrowserWindowWidth(doc)+scrollX;boundY=mstr.utils.BoxModel.getBrowserWindowHeight(doc)+scrollY;}else{scrollX=p.scrollLeft;scrollY=p.scrollTop;boundX=mstr.utils.BoxModel.getElementInnerWidth(p)+scrollX;boundY=mstr.utils.BoxModel.getElementInnerHeight(p)+scrollY;}if(x+w>boundX){var newX=x;if(view.get("opener").get){newX-=w;newX-=mstr.utils.BoxModel.getElementOuterWidth(view.get("opener").get("element"));}else{newX=boundX-w;}el.style.left=Math.max(newX,scrollX)+"px";}if(y+h>boundY){el.style.top=Math.max(boundY-h,scrollY)+"px";}};FM.onmouseout=function(id){var view=mstr.$obj(id);if(view.get&&view.get("hasToClose")){if(view.timeout){clearTimeout(view.timeout);}view.timeout=setTimeout("mstr.$obj('"+view.get("id")+"').set('visible',false);",2000);}};FM.onmouseover=function(id){var view=mstr.$obj(id);if(view.timeout){clearTimeout(view.timeout);}};return FM;})();mstr.behaviors.MenuOption=(function(){var MOP={};MOP.onmouseover=function MOP_onmouseover(view){var p=view.get("parent");p=p&&p.get("opener");if(p&&p.get){p=p.get("menuCloserTO");clearTimeout(p);}if(view.get("cmds")=="OpenSubMenu"){var to=view.get("menuCloserTO");if(to){clearTimeout(to);}to=window.setTimeout(function(){view.set("mOverOpen",true);mstr.behaviors.MenuOption.fireCommands(view,null);},250);view.set("menuOpenerTO",to);}};MOP.onmouseout=function MOP_onmouseout(view){if(view.get("cmds")!="OpenSubMenu"){return ;}var to=view.get("menuOpenerTO");if(to){clearTimeout(to);}to=window.setTimeout(function(){view.execCloseSubMenu();},350);view.set("menuCloserTO",to);};MOP.fireCommands=function MOP_fireCommands(view,evt){if(!view.get("enabled")){return ;}view.fireCommands();if(!view.getModel().get("menuModel")){view.get("parent").execCloseMenu();}};MOP.updateCSS=function MOP_updateCSS(view,hover){var prefix=view.get("cssPrefix");var cssClass=view.get("cssClass");cssClass+=view.get("extraCssClass")?" "+view.get("extraCssClass"):"";var postFix="";if(!view.get("enabled")){postFix=" disabled";}if(view.props.pressed||(view.props.model&&view.props.model.props.state)){postFix+=" pressed";}if(hover&&view.get("enabled")){postFix+=" hover";}view.get("element").className=prefix+cssClass+postFix;};return MOP;})();mstr.behaviors.FieldSet=(function(){var FS={};FS.set_fieldSet_enabled=function FS_set_fieldSet_enabled(rootTag,enabled){if(!enabled){var div=rootTag.childNodes[1];var mask=div&&div.lastChild;if(mask&&mask.id&&mask.id.substring(0,12)=="fieldSetMask"){mask.style.display="block";}else{rootTag.style.position="relative";div.style.position="relative";var mask=document.createElement("div");mask.setAttribute("id","fieldSetMask_"+rootTag.getAttribute("id"));var ms=mask.style;ms.top="0px";ms.left="0px";ms.width="100%";ms.height="100%";ms.position="absolute";ms.background="transparent url(images/1ptrans.gif) repeat";div.appendChild(mask);}if(mstr.utils.ISFF||mstr.utils.ISWK||mstr.utils.ISIE10||mstr.utils.ISW3CIE){mask.style.opacity="0.8";mask.style.backgroundColor="#fafafa";}else{div.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=30)";if(mstr.utils.ISIE6){window.setTimeout(function a_c(){mask.style.height=div.offsetHeight;},0);}}}else{var div=rootTag.childNodes[1];var mask=div&&div.lastChild;if(mask&&mask.id&&mask.id.substring(0,12)=="fieldSetMask"){mask.style.display="none";if(mstr.utils.ISFF||mstr.utils.ISWK||mstr.utils.ISIE10||mstr.utils.ISW3CIE){div.style.opacity="1";}else{div.style.filter="";}}}};return FS;})();mstr.http.SaveAnnotationsInputs=(function(){function SAI(objectID,objectType,annotation,isAppend){this.params={taskId:"setAnnotations",objectID:objectID,objectType:objectType,annotation:annotation,isAppend:(typeof (isAppend)!="undefined")?isAppend:0,locale:mstr.Settings.Locale.ID};}return SAI;})();mstr.http.GetAnnotationsInput=(function(){function GAI(objectID,objectType,styleToUse,juil){this.params={taskId:"getAnnotations",objectID:objectID,objectType:objectType,locale:mstr.Settings.Locale.ID,counter:counter++};if(styleToUse){this.params.styleName=styleToUse;}else{this.params.styleName="AnnotationsStyle";}if(typeof (juil)!="undefined"){this.params.juil=juil;}}var counter=0;return GAI;})();mstr.http.PingServer=(function(){function PS(){this.params={taskId:"keepSessionAlive"};}return PS;})();mstr.http.BlockLoaderInput=(function(){function BLI(styleName){this.params={taskId:"loadBlocks",styleName:styleName,juil:true};}return BLI;})();mstr.http.LoadToolbarInput=(function(){function LTI(){this.params={taskId:"loadToolbar",juil:true};}return LTI;})();mstr.http.FolderBlockLoaderInput=(function(){function FBLI(styleName,folderProps){this.params={taskId:"folderBrowse",styleName:styleName,juil:true};mstr.utils.Hash.overwrite(this.params,folderProps);}return FBLI;})();mstr.http.RwBlockLoaderInput=(function(){function RBLI(styleName,beanName,hWin){this.params={taskId:"loadDocBlocks",styleName:styleName,juil:true};if(pageState){var ps=(pageState+"&").match(/rwb=(.*?)\&/);if(ps!=-1){this.params[beanName]=ps[1];}}}return RBLI;})();mstr.http.ReportBlockLoaderInput=(function(){function RptBLI(styleName,beanName,hWin){this.params={taskId:"loadReportBlocks",styleName:styleName,juil:true};if(pageState){var ps=pageState.match(/rb=[^\&]*/);ps=ps[0].replace("rb=","");if(ps!=-1){this.params[beanName]=ps;}}}return RptBLI;})();mstr.http.GetGridFormats=(function(){function GGF(key,msgID){this.params={taskId:"getDocGridFormat",juil:true,docGridKey:key,msgID:msgID};}return GGF;})();mstr.http.GetRWGraphProperties=(function(){function GGP(key,msgID){this.params={taskId:"getRWGraphProperties",juil:true,docGridKey:key,msgID:msgID};}return GGP;})();mstr.http.GetReportGraphProperties=(function(){function GGP(msgID,stateID){this.params={taskId:"getReportGraphProperties",juil:true,stateID:stateID,msgID:msgID};}return GGP;})();mstr.http.OndemandContextMenuInputs=(function(){OCMI.prototype.setDrillParams=function OCMI_setDrillParams(nodeKey){var bone=microstrategy.findBone(microstrategy.activeCXMenu);var isReport=false;if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){isReport=true;}if(isReport){this.params={taskId:"ReportOndemandDrill",juil:true,styleName:"OndemandContextMenusStyle",ondemandDrillMinimalXML:true};if(pageState){var ps=pageState.match(/rb=(.*?)(\&|$)/);if(ps!=-1){this.params.rb=ps[1];}}}else{this.params={taskId:"RWOnDemandDrill",juil:true,styleName:"OndemandContextMenusStyle",viewMode:bone&&bone.effectiveView||1,usePartDisplay:1,docGridKey:nodeKey,isQuickSwitchEnabled:bone&&bone.quickSwitchCurrent||false};if(pageState){var ps=pageState.match(/rwb=(.*?)(\&|$)/);if(ps!=-1){this.params.rwb=ps[1];}}}};function OCMI(nodeKey){this.setDrillParams(nodeKey);}return OCMI;})();mstr.views.BaseView.prototype.taskModelCallback=function BV_taskModelCallback(evt){switch(evt.name){case"set_readyState":this.set("readyState",evt.memo.value);if(evt.memo.value==mstr.Enum.Widget.READYSTATE.IDLE){var m=this.taskModel.get("models")&&this.taskModel.get("models")[0];if(m){m.set("opener",this);}var v=this.taskModel.get("views")[0];if(v){v.set("opener",this);v.render();}}break;}};mstr.views.BaseView.prototype.execOpenModalPopup=function BV_execOpenModalPopup(popupId,viewProps,modelProps){self.supressWaitPage=true;viewProps=viewProps||{};modelProps=modelProps||{};var p,parts;var cp=mstr.$obj(popupId);if(cp){var m=cp.getModel();if(m){for(p in modelProps){mstr.controllers.Factory.setPath(p,m,modelProps[p],false);}m.set("opener",this);}for(p in viewProps){mstr.controllers.Factory.setPath(p,cp,viewProps[p],false);}cp.set("opener",this);cp.set("visible",true);}else{var ta=document.createElement("textarea");ta.setAttribute("id",popupId);ta.className="mstrJSON";this.get(mstr.$W.DOCUMENT).body.appendChild(ta);var req=new mstr.http.BlockLoaderInput(popupId);for(p in modelProps){req.params[p]=modelProps[p];}for(p in viewProps){req.params[p]=viewProps[p];}if(!this.taskModel){this.taskModel=new mstr.models.TaskModel({parent:this});mstr.controllers.Factory.add(this.taskModel);var zz=this.taskModel&&this.taskModel.init&&this.taskModel.init();this.taskModel.attachEventListener(this,"set_readyState","taskModelCallback");}this.set("readyState",mstr.Enum.Widget.READYSTATE.WAITING);this.taskModel.execFetchBlock(req,ta);}window.setTimeout("self.supressWaitPage = false;",10);};mstr.views.FastTileView=(function(){mstr.$O.extendsClass(FTV,mstr.views.FastListView);FTV.DEFAULT_LIST_ITEM_HEIGHT=75;FTV.DEFAULT_LIST_ITEM_WIDTH=76;FTV.prototype._computeVisibleItemsRange=function FTV_cVIR(){var range=mstr.views.FastListView.prototype._computeVisibleItemsRange.apply(this);if(range){var ipr=Math.max(parseInt(this.props.itemsPerRow)||1,1);range.min=range.min*ipr;range.max=(range.max+1)*ipr-1;}return range;};FTV.prototype._updateItemsContainerDimensions=function FTV_uICDimensions(){mstr.views.FastListView.prototype._updateItemsContainerDimensions.apply(this);this._updateItemsContainerWidth();};FTV.prototype._updateItemsContainerHeight=function FTV_uICHeight(){var el=this.props.listItemsContainer;if(!el){return ;}var r=mstr.utils.ListViewHelper.getItemRenderer(this);var h=FTV.DEFAULT_LIST_ITEM_HEIGHT;if(h){var m=this.getModel();var len=mstr.$A.len(m&&m.getItems&&m.getItems()),ipr=Math.max(parseInt(this.props.itemsPerRow)||1,1),rows=parseInt(len/ipr);if(len%ipr){rows++;}h=h*rows;}if(h){el.style.height=h+"px";}else{el.style.height=mstr.utils.ISIE4?"1px":"auto";}if(mstr.utils.ISIE4){el.style.overflow=h?"visible":"hidden";}};FTV.prototype._updateItemsContainerWidth=function FTV_uICWidth(){var el=this.props.listItemsContainer;if(!el){return ;}var m=this.getModel();var len=mstr.$A.len(m&&m.getItems&&m.getItems()),ipr=Math.max(parseInt(this.props.itemsPerRow)||1,1);el.style.width=(FTV.DEFAULT_LIST_ITEM_WIDTH*Math.min(len,ipr))+"px";var rows=parseInt(len/ipr);if(mstr.utils.ISW3C&&(rows*FTV.DEFAULT_LIST_ITEM_WIDTH>parseInt(this.props.height))){el.style.width=(parseInt(el.style.width)+SCROLLBAR_SIZE)+"px";}};FTV.prototype._adjustWhiteSpaceAboveItem=function FTV_aWSAbove(index,el){return ;};FTV.prototype._adjustWhiteSpaceBelowItem=function FTV_aWSBelow(index,el){return ;};function FTV(props){mstr.views.FastListView.apply(this,[props]);}return FTV;})();mstr.views.TabTreeListView=(function(){mstr.$O.extendsClass(TTLV,mstr.views.ListView);TTLV.prototype.execClickListItem=function TTLV_execClickListItem(cmdValue){var m=this.props.model;var index=m.indexOfValue(cmdValue.valueForm);if(index!=-1){var items=m.getItems();var item=items[index];var vf=item&&item.get&&item.get("visibleField");if(vf){if(!item.get(vf)){for(var i=index,cnt=items.length;i<cnt;i++){vf=items[i].get("visibleField");if(!vf||items[i].get(vf)){cmdValue.valueForm=items[i].getId();break;}}}}}return mstr.views.ListView.prototype.execClickListItem.apply(this,[cmdValue]);};function TTLV(props){mstr.views.ListView.apply(this,[props]);}return TTLV;})();mstr.views.AnnotationView=(function(){mstr.$O.extendsClass(AV,mstr.views.BaseView);AV.prototype.execResize=function AV_execResize(){this.resize();return true;};AV.prototype.resize=function AV_resize(width,height){if(height==null){height=mstr.utils.BoxModel.getElementOuterHeight(this.props[mstr.$W.ELEMENT]);}else{this.props[mstr.$W.ELEMENT].style.height=Math.max(height-26,0)+"px";}if(width==null){width=mstr.utils.BoxModel.getElementOuterWidth(this.props[mstr.$W.ELEMENT]);}else{this.props[mstr.$W.ELEMENT].style.width=Math.max(width-26,0)+"px";}this.nonEditableArea=this.nonEditableArea||document.getElementById("nonEditableArea");this.editableArea=this.editableArea||document.getElementById("editableArea");this.addArea=this.addArea||document.getElementById("addArea");this.editButtons=this.editButtons||document.getElementById("editButtons");this.scratchPad=this.scratchPad||document.getElementById("scratchPad");if(this.editableArea&&this.nonEditableArea){if(this.scratchPad){this.scratchPad.style.width=Math.max(parseInt(this.props[mstr.$W.ELEMENT].style.width),0)+"px";}this.editableArea.style.height=Math.max(parseInt(this.props[mstr.$W.ELEMENT].style.height)-mstr.utils.BoxModel.getElementOuterHeight(this.addArea)-mstr.utils.BoxModel.getElementOuterHeight(this.editButtons)-10,0)+"px";this.editableArea.style.width=Math.max(parseInt(this.props[mstr.$W.ELEMENT].style.width),0)+"px";this.nonEditableArea.style.height=this.editableArea.style.height;this.nonEditableArea.style.width=Math.max(parseInt(this.props[mstr.$W.ELEMENT].style.width),0)+"px";}};AV.prototype.execUpdate=function AV_execUpdate(isAdd){if(isAdd=="true"){this.addArea=this.addArea||document.getElementById("addArea");this.getModel().get("addition").set("value",this.addArea.firstChild.value);}else{this.editableArea=this.editableArea||document.getElementById("editableArea");this.getModel().set("value",this.editableArea.value);}};AV.prototype.execValidateAdd=function AV_execValidateAdd(addition,prefix){if(!addition||addition.length==0){this.execConfirm(microstrategy.descriptors.getDescriptor("6156"));return false;}else{if((addition.length+this.getModel().get("addition").get("prefixLen")+this.getModel().get("addition").get("postfixLen"))>mstr.models.AnnotationModel.ADDITION_MAX_LENGTH){return this.execConfirm("*Additional notes cannot be longer than ## characters. The note you are adding will be truncated if you proceed.*".replace(/##/,mstr.models.AnnotationModel.ADDITION_MAX_LENGTH));}else{if(this.getModel().get("value")&&((this.getModel().get("value").length+addition.length)>mstr.models.AnnotationModel.NOTES_MAX_LENGTH)){return this.execConfirm("*Notes cannot be longer than ## characters. The note you are editing will be truncated if you proceed.*".replace(/##/,mstr.models.AnnotationModel.NOTES_MAX_LENGTH));}}}return true;};AV.prototype.execValidateEdit=function AV_execValidateEdit(content){if((content.length+this.getModel().get("postfixLen"))>mstr.models.AnnotationModel.NOTES_MAX_LENGTH){return this.execConfirm("*Notes cannot be longer than ## characters. The note you are editing will be truncated if you proceed.*".replace(/##/,mstr.models.AnnotationModel.NOTES_MAX_LENGTH));}return true;};AV.prototype.setEditCursor=function AV_setEditCursor(){if(this.editableArea){this.editableArea.focus();if(mstr.utils.ISW3C){this.editableArea.scrollTop=this.editableArea.scrollHeight;}else{var range=this.editableArea.createTextRange();range.collapse(false);range.select();}}};function AV(props){mstr.views.BaseView.apply(this,[props]);}return AV;})();mstr.views.Slider=(function(){mstr.$O.extendsClass(S,mstr.views.BaseView);S.prototype._getThumb=function S__getThumb(){var el=this.get(mstr.Props.Widget.ELEMENT);return el&&el.lastChild.firstChild;};S.prototype._getTooltip=function S__getTooltip(){var el=this.get(mstr.Props.Widget.ELEMENT);return el&&el.lastChild.lastChild;};S.prototype.init=function S_init(){mstr.views.BaseView.prototype.init.apply(this,arguments);var m=this.getModel();if(m&&m.attachEventListener){m.attachEventListener(this,"set_"+this.get("xField"),"schedule_thumb_move");m.attachEventListener(this,"set_"+this.get("yField"),"schedule_thumb_move");}};S.prototype.render=function S_render(){mstr.views.BaseView.prototype.render.apply(this,arguments);this.schedule_thumb_move(null,true);if(!this.get("dnd")){return null;}var el=this.get("element").lastChild;var thumb=this._getThumb();var props={view:this};var f1,f2;var o=this.get("orientation");if(o=="h"||o=="b"){f1=function(){return Math.round(mstr.utils.BoxModel.getElementSumOffsetLeft(el)-(mstr.utils.BoxModel.getElementOuterWidth(thumb)/2));};props.xMin=f1;props.xMax=function(){return f1()+mstr.utils.BoxModel.getElementInnerWidth(el);};}else{f1=function(){return mstr.utils.BoxModel.getElementSumOffsetLeft(el);};props.xMin=f1;props.xMax=f1;}if(o=="v"||o=="b"){f2=function(){return Math.round(mstr.utils.BoxModel.getElementSumOffsetTop(el)-(mstr.utils.BoxModel.getElementOuterHeight(thumb)/2));};props.yMin=f2;props.yMax=function(){return f2()+mstr.utils.BoxModel.getElementInnerHeight(el);};}else{f2=function(){return mstr.utils.BoxModel.getElementSumOffsetTop(el);};props.yMin=f2;props.yMax=f2;}this.set("dz",new mstr.models.dnd.DragZone(props,{findTarget:function(view,e){var t=mstr.utils.Dom.findAncestor(e.target(),"className",thumb.className);return(t&&t==thumb)?t:null;},startDrag:function(view){if(!view.get("dndGhost")){thumb.style.visibility="hidden";}var origClickJump=!!view.get("enableClickJumps");if(!origClickJump){view.set("enableClickJumps",true);}},drag:function(view,l,t){l=l+Math.round(mstr.utils.BoxModel.getElementOuterWidth(thumb)/2);t=t+Math.round(mstr.utils.BoxModel.getElementOuterHeight(thumb)/2);view.repositionThumb({x:l,y:t},1);},endDrag:function(view,l,t){var origClickJump=!!view.get("enableClickJumps");if(!origClickJump){view.set("enableClickJumps",true);}var origAnimation=!!view.get("animate");if(origAnimation){view.set("animate",false);}l=l+Math.round(mstr.utils.BoxModel.getElementOuterWidth(thumb)/2);t=t+Math.round(mstr.utils.BoxModel.getElementOuterHeight(thumb)/2);view.repositionThumb({x:l,y:t},1);if(!origClickJump){view.set("enableClickJumps",false);}if(origAnimation){view.set("animate",true);}if(!view.get("dndGhost")){thumb.style.visibility="visible";}}}));return null;};S.prototype.on_click=function S_on_click(e,hWin){if(!this.get("enabled")||(!this.get("xField")&&!this.get("yField"))){return ;}e=e||window.event;if((e.target||e.srcElement).tagName!="DIV"){return ;}var evt=new mstr.lang.Event(e,hWin,this);var el=this.get(mstr.Props.Widget.ELEMENT).lastChild;var h=parseInt(this.get("height"),10);var offset=(mstr.utils.ISW3C)?(mstr.utils.BoxModel.getElementOuterHeight(el)-h)/2:4;this.repositionThumb(evt,offset);};S.prototype.repositionThumb=function S_repositionThumb(evt,offset){var x,y;var h=parseInt(this.get("height"),10);var w=parseInt(this.get("width"),10);var el=this.get(mstr.Props.Widget.ELEMENT).lastChild;var or=this.get("orientation");var og=this.get("origin");if(or=="h"||or=="b"){x=evt.x-mstr.utils.BoxModel.getElementSumOffsetLeft(el)-offset;if(og==2||og==6){x=NaN;}else{if(og==3||og==4||og==5){x=w-x;}}}if(or=="v"||or=="b"){y=evt.y-mstr.utils.BoxModel.getElementSumOffsetTop(el)-offset;if(og==4||og==8){y=NaN;}else{if(og==5||og==6||og==7){y=h-y;}}}var info={x:{n:x,d:w},y:{n:y,d:h}};var m=this.getModel();for(var id in info){if(!isNaN(info[id]["n"])){var f=this.get(id+"Field");if(!f){continue;}var min=this.get(id+"Min");var max=this.get(id+"Max");var v=Math.round(((info[id]["n"]/info[id]["d"])*(max-min))+min);if(this.get("enableClickJumps")){m.set(f,v);}else{var ov=m.get(f);v=(ov<v)?ov++:ov--;m.set(f,ov);}}}if(!isNaN(x)){var thumb=this._getThumb();thumb.style.left=(x-Math.round(mstr.utils.BoxModel.getElementOuterWidth(thumb)/2)-(mstr.utils.ISIE6||mstr.utils.ISIE7?1:0))+"px";}this.showTooltip(true);};S.prototype._buildTooltipText=function S__buildTooltipText(){var tf=this.get("tooltipFunction");if(tf){eval("var f ="+tf);}var s="";var m=this.getModel();var or=this.get("orientation");if(this.get("xField")&&(or=="h"||or=="b")){s+=(tf)?f(m.get(this.get("xField"))):microstrategy.descriptors.getDescriptor("4891").replace("##",m.get(this.get("xField"))).replace("###",this.get("xMax"));}if(this.get("yField")&&(or=="v"||or=="b")){if(s.length>0){s+="<br />";}s+=(tf)?f(m.get(this.get("yField"))):microstrategy.descriptors.getDescriptor("4891").replace("##",m.get(this.get("yField"))).replace("###",this.get("yMax"));}return s;};S.prototype._moveTooltip=function S__moveTooltip(){if(!this.get("showTooltip")){return ;}var el=this.get(mstr.Props.Widget.ELEMENT);var tooltip=this._getTooltip();if(!tooltip){return ;}var or=this.get("orientation");tooltip.lastChild.innerHTML=this._buildTooltipText();var x,y;var h=mstr.utils.BoxModel.getElementOuterHeight(tooltip);var w=mstr.utils.BoxModel.getElementOuterWidth(tooltip);var thumb=this._getThumb();var tt=mstr.utils.BoxModel.getElementSumOffsetTop(thumb)-mstr.utils.BoxModel.getElementSumOffsetTop(el.lastChild);var tl=mstr.utils.BoxModel.getElementSumOffsetLeft(thumb)-mstr.utils.BoxModel.getElementSumOffsetLeft(el.lastChild);var th=mstr.utils.BoxModel.getElementOuterHeight(thumb);var tw=mstr.utils.BoxModel.getElementOuterWidth(thumb);switch(or){case"h":x=Math.round(tl+(tw/2)-(w/2));y=Math.round(tt-h-1);break;case"v":x=Math.round(tl+tw+1);y=Math.round(tt+(th/2)-(h/2));break;case"b":x=Math.round(tl+tw+1);y=Math.round(tt-h-1);break;}tooltip.style.left=x+"px";tooltip.style.top=y+"px";};S.prototype.showTooltip=function S_showTooltip(show){if(!this.get("showTooltip")){return ;}var tooltip=this._getTooltip();if(!tooltip){return ;}if(this.get("enabled")&&show){tooltip.style.display="inline";tooltip.style.visibility="visible";this._moveTooltip();}else{tooltip.style.visibility="hidden";}};S.prototype.schedule_thumb_move=function S_schedule_thumb_move(evt,noAnimation){if(!isNaN(this.get("animationTimeout"))){self.clearTimeout(this.get("animationTimeout"));this.set("animationTimeout",null);}var thumb=this._getThumb();var og="|"+this.get("origin")+"|";var tempT=thumb.cloneNode(true);tempT.style.display="block";tempT.style.position="absolute";tempT.style.left="3000px";tempT.style.top="2000px";tempT=document.body.appendChild(tempT);var info={x:{d:parseInt(this.get("width"),10),i:"|2|6|",o:"|3|4|5|",t:mstr.utils.BoxModel.getElementOuterWidth(tempT)/2,v:NaN},y:{d:parseInt(this.get("height"),10),i:"|4|8|",o:"|5|6|7|",t:mstr.utils.BoxModel.getElementOuterHeight(tempT)/2,v:NaN}};document.body.removeChild(tempT);var model=this.getModel();for(var id in info){var f=this.get(id+"Field");if(!f){continue;}var min=this.get(id+"Min");var n=(model.get(f)-min)/(this.get(id+"Max")-min);if(info[id]["i"].indexOf(og)>-1){n=NaN;}else{if(info[id]["o"].indexOf(og)>-1){n=1-n;}}info[id]["v"]=Math.round(n*info[id]["d"]-info[id]["t"]);}var x=info.x["v"]||null;var y=info.y["v"]||null;if(noAnimation||!this.get("animate")||this.get("animationStep")<=1){if(x&&!isNaN(x)){thumb.style.left=x+"px";}if(y&&!isNaN(y)){thumb.style.top=y+"px";}}else{this.props.animationTimeout=self.setTimeout("mstr.$obj('"+this.get("id")+"').move_thumb("+x+", "+y+")",10);}this._moveTooltip();};S.prototype.move_thumb=function S_move_thumb(x,y){var thumb=this._getThumb();if(thumb){mstr.utils.Animations.move(thumb,x,y,this.get("animationStep"));this.set("animationTimeout",null);}};S.prototype.after_set_enabled=function S_after_set_enabled(evt){var thumb=this._getThumb();if(thumb){thumb.style.display=(this.get("enabled"))?"inline":"none";}};function S(props){mstr.views.BaseView.apply(this,[props]);}return S;})();mstr.views.FontFormatter=(function(){mstr.$O.extendsClass(FF,mstr.views.BaseView);FF.pathMap={nameModelPath:{p:"children/0/children/0",f:"fontFamily",vp:"parent/parent/model/"},styleModelPath:{p:"children/1/children/0/children/0",f:"boldItalic",vp:"parent/model/"},sizeModelPath:{p:"children/1/children/0/children/1",f:"fontSize",vp:"parent/model/"},underlineField:{p:"children/0/children/1/children/0",f:"textUnderline",vp:"parent/model/"},strikeoutField:{p:"children/0/children/1/children/1",f:"textStrikeout",vp:"parent/model/"},colorModelPath:{p:"children/1/children/1",f:"fontColor",vp:"parent/model/"}};FF.prototype.init=function FF_init(){var that=this;var fn=function(evt){var p=evt.name.split("_").pop();that._updateViewProperties(p);};for(var id in mstr.views.FontFormatter.pathMap){this._updateViewProperties(id);this["after_set_"+id]=fn;}mstr.views.BaseView.prototype.init.apply(this);};FF.prototype._updateViewProperties=function FF_updateViewProperties(id){var view=mstr.$path(mstr.views.FontFormatter.pathMap[id].p,this);var field=this.get(id);if(id.indexOf("Field")>-1){mstr.controllers.Factory.safeset(view,"valueField",field);}else{var path=mstr.views.FontFormatter.pathMap[id].vp+field;mstr.controllers.Factory.safeset(view,"modelPath",path);}var ef=this.get("enabledField");if(ef){var ePath=mstr.views.FontFormatter.pathMap[id].vp+ef;mstr.controllers.Factory.safeset(view,"enabledField",ePath);}var fontPreview=mstr.$path("children/1/children/2",this);mstr.controllers.Factory.safeset(fontPreview,mstr.views.FontFormatter.pathMap[id].f,field);};function FF(props){mstr.views.BaseView.apply(this,[props]);}return FF;})();mstr.views.ToolbarListView=(function(){mstr.$O.extendsClass(TLV,mstr.views.ListView);TLV.prototype.init=function TLV_init(){mstr.views.ListView.prototype.init.apply(this);this.getModel().attachEventListener(this,"featuresChanged","render");};TLV.prototype.render=function TLV_render(){if(!this.props.model.get("items")[1]&&!this.props.model.get("items")[0]["menuModel"]&&mstr.utils.Hash.isEmpty(this.props.rightIcons)){var cssNoTabs=" mstrNoTabs";if(document.body.className.indexOf(cssNoTabs)==-1){document.body.className+=cssNoTabs;}return ;}mstr.views.ListView.prototype.render.call(this,[]);var p=this.get("rightIcons"),elScroll=this.props.scrollArea,tabHolder=elScroll&&elScroll.firstChild;if(!tabHolder||!p){return ;}for(var i=0,cnt=p.length;i<cnt;i++){var icon=p[i];if(icon.get){tabHolder.appendChild(icon.get(mstr.$W.ELEMENT));}else{icon=mstr.controllers.Factory.registerJSON(p[i],this.props[mstr.$W.DOCUMENT]);icon.set("parent",this);icon.init();icon.set(mstr.$W.ELEMENT,tabHolder.appendChild(document.createElement("div")));}icon.render();p[i]=icon;}};function TLV(props){mstr.views.ListView.apply(this,[props]);}return TLV;})();mstr.views.FloatingMenuOption=(function(){mstr.$O.extendsClass(FTM,mstr.views.BaseView);FTM.prototype.execOpenSubMenu=function FTM_execOpenSubMenu(){var style=this.getModel().get("style");var modelName=this.getModel().get("menuModel");var layouts=this.getModel().get("layouts");if(!style){style=this.props.parent.props.model.props.styleName;}if(!style||!modelName){return ;}this.get("parent").execCloseSubMenus();var el=this.get("element");var p=this.get("parent").get("element");var x=parseInt(p.style.left,10)+mstr.utils.BoxModel.getElementOuterWidth(p)-12;var y=parseInt(p.style.top,10)+mstr.utils.BoxModel.getElementSumOffsetTop(el)-mstr.utils.BoxModel.getElementSumOffsetTop(p);mstr.behaviors.FloatingMenu.displayMenu(this,x,y,style,modelName,layouts,p.parentNode);};FTM.prototype.execCloseSubMenu=function FTM_execCloseSubMenu(){if(!this.getModel().get("menuModel")){return ;}var submenu=mstr.$obj(mstr.behaviors.FloatingMenu.getMenuId({layouts:this.getModel().get("layouts"),modelName:this.getModel().get("menuModel")}));var zz=submenu&&submenu.execCloseMenu();};function FTM(props){mstr.views.BaseView.apply(this,[props]);}return FTM;})();mstr.views.ToolbarButton=(function(){mstr.$O.extendsClass(TBV,mstr.views.BaseView);TBV.prototype._attachLayoutHandlers=function TBV_attachLayoutHandlers(){mstr.views.BaseView.prototype._attachLayoutHandlers.apply(this,[]);var model=this.props.model;if(!model){return ;}model.attachEventListener(this,"set_showPressed","set_pressed");};TBV.prototype.set_pressed=function TBV_set_pressed(evt){this.set("pressed",evt.memo.value);};function TBV(props){mstr.views.BaseView.apply(this,[props]);}return TBV;})();mstr.views.LastUpdateView=(function(){mstr.$O.extendsClass(LUV,mstr.views.BaseView);LUV.prototype.render=function LUV_render(){var target=mstr.$path(mstr.$path("parent/model/targetPath",this),this);if(!target){return ;}mstr.views.BaseView.prototype.render.apply(this,arguments);var e=this.get(mstr.$W.ELEMENT);if(target.lastUpdate){e.innerHTML=target.lastUpdate;}e.className=this.get("cssPrefix")+this.get("cssClass");};function LUV(props){mstr.views.BaseView.apply(this,[props]);}return LUV;})();mstr.views.Toolbar=(function(){mstr.$O.extendsClass(TB,mstr.views.ViewBook);TB.prototype.render=function TB_render(){mstr.views.ViewBook.prototype.render.apply(this);this.checkAllSeparators();var views=this.get("views");for(var i=0,cnt=views.length;i<cnt;i++){var obj=views[i];if(!(obj.get("ge"))){var zz=obj.attachEventListener&&obj.attachEventListener(this,"set_visible","checkSeparators");}}};TB.prototype.checkAllSeparators=function TB_checkAllSeparators(){var views=this.get("views");var first=false;var isSep;for(var i=0,cnt=views.length;i<cnt;i++){isSep=views[i].get("ge");if(!this.renderFirstSeparator&&views[i].get("visible")&&!first){first=true;if(isSep){views[i].set("visible",false);continue;}}if(isSep&&i+1<cnt){this.checkSeparators({src:views[i+1]});}}};TB.prototype.checkSeparators=function TB_checkSeparators(evt){var views=this.get("views");var index=mstr.$A.find(views,evt.src);var visible=evt.src.get("visible");var obj,c,cnt;var leftTsIndex;for(c=index-1;c>=0;c--){obj=views[c];if(obj.get("ge")){leftTsIndex=c;break;}}for(c=leftTsIndex+1,cnt=views.length;c<cnt;c++){obj=views[c];if(obj.get("ge")){views[leftTsIndex].set("visible",false);break;}if(obj.get("visible")){views[leftTsIndex].set("visible",true);break;}}if(c==views.length&&!this.renderLastSeparator){views[leftTsIndex].set("visible",false);}};TB.prototype.after_set_childValidationStatus=function TB_after_set_childValidationStatus(evt){var m=evt.memo;var qGroup=mstr.$obj(m.id).getModel().get("queueGroup");this.childValidationStatus=this.childValidationStatus||{};var gStatus=this.childValidationStatus[qGroup]=this.childValidationStatus[qGroup]||{};var tm=this.get("model");if(m.code==mstr.Enum.Validation.STATUSCODE.VALID){if(m.id in gStatus){delete gStatus[m.id];if(mstr.utils.Hash.isEmpty(gStatus)){tm.setQueueValidationStatus(qGroup,mstr.Enum.Validation.STATUSCODE.VALID);}}}else{if(mstr.utils.Hash.isEmpty(gStatus)){tm.setQueueValidationStatus(qGroup,mstr.Enum.Validation.STATUSCODE.INVALID_ANSWERS);}gStatus[m.id]=m.code;}};function TB(props){this.renderFirstSeparator=true;this.renderLastSeparator=true;mstr.views.ViewBook.apply(this,[props]);}return TB;})();mstr.views.ClickableMessage=(function(){mstr.$O.extendsClass(CM,mstr.views.BaseView);CM.prototype.showMessage=function CM_showMessage(){showMessage({contents:this.get("dlgText"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,zIndex:1001,okEval:'mstr.$obj("'+this.get("id")+'").handleOK()',type:mstrMsgBoxImpl.MSG_WARNING});};CM.prototype.handleOK=function CM_handleOK(){};CM.prototype.render=function CM_render(){mstr.views.BaseView.prototype.render.apply(this,arguments);var elem=this.get("element");var s=this.get("msgText");var link=s.match(/##(.*)##/);if(link&&link.length>0){var span="<span style='text-decoration:underline;cursor:pointer' onclick='mstr.$obj(\""+this.get("id")+"\").showMessage();'>"+link[1]+"</span>";s=s.replace(/##.*##/,span);elem.innerHTML=s;}};function CM(props){mstr.views.BaseView.apply(this,[props]);}return CM;})();mstr.views.TooltipText=(function(){mstr.$O.extendsClass(TT,mstr.views.BaseView);TT.prototype.render=function TT_render(){mstr.views.BaseView.prototype.render.apply(this,arguments);var elem=this.get("element");model=this.getModel();currAttr=model.getSelectedItemValue();attrName=currAttr.split("|")[2];abbr=attrName;if(attrName.length>20){abbr=attrName.substring(0,17)+"...";}elem.innerHTML="<div style='margin-top:6px;' title='"+attrName+"'>"+abbr+":</div>";};function TT(props){mstr.views.BaseView.apply(this,[props]);}return TT;})();mstr.views.DisableAutowireMessage=(function(){mstr.$O.extendsClass(FM,mstr.views.ClickableMessage);FM.prototype.handleOK=function FM_handleOK(){microstrategy.getViewerBone().commands.exec("disableAutowire");this.get("parent").getModel().set("Autowire",false);};function FM(props){mstr.views.BaseView.apply(this,[props]);}return FM;})();mstr.views.FloatingMenuBook=(function(){mstr.$O.extendsClass(FM,mstr.views.Toolbar);FM.prototype.zIndex=1000;FM.prototype.getZIndex=function FM_zindex(){return this.zIndex++;};FM.prototype.init=function FM_init(){mstr.views.Toolbar.prototype.init.apply(this);mstr.controllers.EventManager.attachWindowEventListener(this,"mousedown","documentClick");mstr.controllers.EventManager.attachWindowEventListener(this,"closeMenus","documentClick");};FM.prototype.after_set_visible=function FM_after_set_visible(evt){if(this.props.visible){mstr.behaviors.FloatingMenu.adjustMenuPosition(this);}else{mstr.behaviors.FloatingMenu.toggleOpenerHoverEffect(this.props.opener,false);}};FM.prototype.render=function FM_render(){mstr.views.Toolbar.prototype.render.apply(this);mstr.utils.Dom.insertPopupMask(this.get("element"),this.execLayoutHandler("maskContainer"));var o=this.get("opener");if(o&&o.get&&o.get("visible")===false){this.execCloseMenu();}else{mstr.behaviors.FloatingMenu.adjustMenuPosition(this);}};FM.prototype.documentClick=function FM_documentClick(evt){if(this.props.visible===false){return ;}if(this.props.showing){this.set("showing",false);return ;}var elTarget=evt&&evt.target&&evt.target();if(elTarget&&elTarget.tagName&&elTarget.tagName.toLowerCase()=="html"){return ;}if(((!elTarget&&evt.name=="closeMenus")||!mstr.utils.Dom.containsElement(this.props.element,elTarget,true))&&!(this.props.opener.props&&mstr.utils.Dom.containsElement(this.props.opener.props.element,elTarget,true))&&!this.isSubMenu(elTarget)){this.execCloseMenu();}};FM.prototype.isSubMenu=function FM_isSubMenu(target){var pn=target,ob,el,cmd,id;while(pn){id=(pn.getAttribute&&pn.getAttribute("blockId"))||pn.id;if(id){ob=mstr.$obj(id);if(ob&&ob.props){cmd=cmd||(ob.props.cmds);el=ob.props.opener;el=el&&el.props.element;if(el){return cmd=="OpenSubMenu"&&mstr.utils.Dom.containsElement(this.props.element,el,true);}}}pn=pn.parentNode;}return false;};FM.prototype.isSubMenu=function FM_isSubMenu(target){var pn=target,ob,el,cmd,id;while(pn){id=(pn.getAttribute&&pn.getAttribute("blockId"))||pn.id;if(id){ob=mstr.$obj(id);if(ob&&ob.props){cmd=cmd||(ob.props.cmds);el=ob.props.opener;el=el&&el.props.element;if(el){return cmd=="OpenSubMenu"&&mstr.utils.Dom.containsElement(this.props.element,el,true);}}}pn=pn.parentNode;}return false;};FM.prototype.execCloseMenu=function FM_execCloseMenu(){if(this.props.visible===false){return ;}if(!(this.props.opener instanceof mstr.views.FloatingMenuOption)){microstrategy.setJLSCXMenuOpen(false);}this.set("visible",false);this.set("cssText","left:-2000px;top:-2000px");};FM.prototype.execCloseSubMenus=function FM_execCloseSubMenus(){if(!this.props.views){return ;}for(var i=0,cnt=this.props.views.length;i<cnt;i++){var child=this.props.views[i];var zz=child.execCloseSubMenu&&child.execCloseSubMenu();}};function FM(props){mstr.views.Toolbar.apply(this,[props]);this.renderLastSeparator=false;this.renderFirstSeparator=false;}return FM;})();mstr.views.ContextMenuProcessingView=(function(){mstr.$O.extendsClass(CMPV,mstr.views.BaseView);CMPV.prototype.setModel=function(m){mstr.views.BaseView.prototype.setModel.apply(this,[m]);m.attachEventListener(this,"set_menu_ready","on_menu_ready");m.attachEventListener(this,"set_menu_processing","on_menu_processing");m.attachEventListener(this,"set_hide_menu_processing","on_hide_menu_processing");};CMPV.prototype.on_menu_processing=function(){addProcessingMenuItem(this.getMenuLevel());};CMPV.prototype.on_hide_menu_processing=function(){removeProcessingMenuItem(this.getMenuLevel());};CMPV.prototype.on_menu_ready=function(){var aMenuItems=this.getModel().getMenuItems();var menuItemIndices=this.getModel().getCurrentMenuItemIndices();if(aMenuItems!=null&&menuItemIndices!=null){addDynamicMenus(this.getMenuLevel(),aMenuItems,menuItemIndices);}};CMPV.prototype.setMenuLevel=function(val){this.iMenu=val;};CMPV.prototype.getMenuLevel=function(){return this.iMenu;};function CMPV(props){mstr.views.BaseView.apply(this,[props]);}return CMPV;})();mstr.views.ToolbarColorPickerButton=(function(){mstr.$O.extendsClass(TCPB,mstr.views.Pulldown);TCPB.prototype._attachLayoutHandlers=function TCPB_attachLayoutHandlers(){mstr.views.Pulldown.prototype._attachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.attachEventListener){model.attachEventListener(this,"set_lastColor","lastColorChanged");}this.lastColorChanged();};TCPB.prototype._detachLayoutHandlers=function TCPB_detachLayoutHandlers(){mstr.views.Pulldown.prototype._detachLayoutHandlers.apply(this);var model=this.props.model;if(model&&model.detachEventListener){model.detachEventListener(this,"set_lastColor");}};TCPB.prototype.lastColorChanged=function TCPB_lastColorChanged(){var m=this.getModel();var value=m.get("lastColor");value=(value.indexOf(",")>-1)?value.split(",")[0]:value;var itemRenderer=mstr.utils.ListViewHelper.getItemRenderer(this);var el=itemRenderer._getContentContainer(this.props[mstr.$W.ELEMENT]);if(/^#[0-9a-f]{6}$/i.test(value)){el.style.backgroundColor=value;}};function TCPB(props){mstr.views.Pulldown.apply(this,[props]);}return TCPB;})();mstr.bones.editors.BoneTranslator=(function(){mstr.$O.extendsClass(BT,mstr.models.BaseModel);BT.prototype.translating=false;BT.prototype._createNewModel=function BT_createNewModel(properties){var scriptClass=properties.scriptClass;if(!scriptClass||!mstr.models[scriptClass]){return null;}var m=new mstr.models[scriptClass](properties);if(!m){return null;}mstr.controllers.Factory.add(m);var zz=m.init&&m.init();return m;};BT.prototype._initializeDynamicModel=function BT_initializeDynamicModel(propertyName,model,source){this._setDynamicModelValues(propertyName,model,source);this.props[propertyName]=model;this._setModelChangeEventListeners(model,propertyName);this.dynamicModels=this.dynamicModels||[];this.dynamicModels.push({dm:model,p:propertyName,s:source});if(propertyName==="EditSelectorTargets"&&source==="availableTemplates"){var src=this.get("EditSelectorSource"),olap=src&&src.getSelectedItem()&&src.getSelectedItem().olap,sel=src&&src.getSelectedItem(),de=sel&&sel.de&&sel.sty!=12033;if(olap){this._setDynamicModelValues("EditSelectorTargetsNoPlaceholder",model,"availableTemplatesNoPlaceholder");}if(de){this._setDynamicModelValues("EditSelectorTargetsNoPlaceholder",model,"availableTemplatesNoPlaceholder");}}};BT.prototype._setModelChangeEventListeners=function BT_setModelEventListeners(model,propertyName){if(model instanceof mstr.models.ListModel){if(model instanceof mstr.models.ColorPicker){model.attachEventListener(this,"set_actualColor","onModelPropertyChange");}else{model.attachEventListener(this,"hashadd_selectedIndices","onModelPropertyChange");model.attachEventListener(this,"hashremove_selectedIndices","onModelPropertyChange");}model.set("mappedPropertyName",propertyName);}else{if(mstr.models.ListCart&&model instanceof mstr.models.ListCart){var s=model.get("selected");s.attachEventListener(this,"listadd_items","onModelPropertyChange");s.attachEventListener(this,"listremove_items","onModelPropertyChange");s.set("mappedPropertyName",propertyName);}}};BT.prototype._setDynamicModelValues=function BT_setDynamicModelValues(propertyName,model,source){var items=(typeof (source)=="string")?this.getBone().commands.queryState(source):source;if(model instanceof mstr.models.ListModel){this._setDynamicListModelValues(model,items,propertyName);}else{if(mstr.models.ListCart&&model instanceof mstr.models.ListCart){this._setDynamicCartModelValues(model,items,propertyName);}}};BT.prototype._setDynamicListModelValues=function BT_setDynamicListModelValues(model,items,propertyName){model.setItems(items);var value=this.getBone().commands.queryState(propertyName);var fn=(mstr.$A.isArray(value))?"execSelectValues":"execSelectValue";model[fn](value);};BT.prototype._setDynamicCartModelValues=function BT_setDynamicCartModelValues(model,items,propertyName){model.get("available").setItems(items);var selectedItems=this.getBone().commands.queryState(propertyName);model.get("selected").setItems(selectedItems);model._updateAvailableFilteredItems();};BT.prototype._resolveDynamicModelSource=function BT_resolveDynamicModelSource(source){return(source in this.props&&"getItems" in this.props[source])?this.get(source).getItems():source;};BT.prototype._getPropertyCategory=function BT_getPropertyCategory(){return"default";};BT.prototype._storeDeltaProp=function BT_storeDeltaProp(n,v){if(this.get("previewDisabledFields")&&this.get("previewDisabledFields")[n]){this.props.parent.set("disablePreview",true);this.props.parent.set("enablePreview",false);}var category=this._getPropertyCategory();this.deltaProps[category]=this.deltaProps[category]||{};this.deltaProps[category][n]=v;this.raiseEvent("store_deltaProp",{category:category,name:n,value:v});mstr.models.BaseModel.prototype.set.apply(this,["hasChanges",true]);};BT.prototype._getDeltaProp=function BT_getDeltaProp(n){var category=this._getPropertyCategory();if(!(category in this.deltaProps)||!(n in this.deltaProps[category])){return null;}return this.deltaProps[category][n];};BT.prototype.getBone=function BT_getBone(){return mstr.$obj(this.props.boneId);};BT.prototype.reinitializeModel=function BT_reinitializeModel(){var restoreDynamicModels=("dynamicModels" in this);this.translateBone();if(!this.get("enabled")){return ;}if(!restoreDynamicModels){return ;}var ov=this.translating;this.translating=true;for(var i=0,cnt=this.dynamicModels.length;i<cnt;i++){var d=this.dynamicModels[i];if(d.p==="EditSelectorTargets"&&d.s==="availableTemplates"){var src=this.get("EditSelectorSource"),olap=src&&src.getSelectedItem()&&src.getSelectedItem().olap,sel=src&&src.getSelectedItem(),de=sel&&sel.de&&sel.sty!=12033;if(olap){this._setDynamicModelValues("EditSelectorTargetsNoPlaceholder",d.dm,"availableTemplatesNoPlaceholder");continue;}if(de){this._setDynamicModelValues("EditSelectorTargetsNoPlaceholder",d.dm,"availableTemplatesNoPlaceholder");continue;}}this._setDynamicModelValues(d.p,d.dm,d.s);}this.translating=ov;};BT.prototype.getDynamicListModel=function BT_getDynamicListModel(sourceName,propertyName){var src=this._resolveDynamicModelSource(sourceName);var m=this._createNewModel({scriptClass:"ListModel",parent:this,valueForm:"dssid"});if(m){this._initializeDynamicModel(propertyName,m,src);}return m;};BT.prototype.getDynamicCartModel=function BT_getDynamicCartModel(sourceName,propertyName){var src=this._resolveDynamicModelSource(sourceName);var m=this._createNewModel({scriptClass:"ListCart",parent:this,available:{scriptClass:"mstr.models.ListModel",valueForm:"dssid"},selected:{scriptClass:"mstr.models.ListModel",valueForm:"dssid"}});if(m){this._initializeDynamicModel(propertyName,m,src);}return m;};BT.prototype.set=function BT_set(n,v){var changed=mstr.models.BaseModel.prototype.set.apply(this,[n,v]);if(!changed){return ;}if(!this.translating&&this._isTranslatedProperty(n)){this._storeDeltaProp(n,v);}var bcProps=this.get("broadcastProperties");if(bcProps&&bcProps[n]){this.get("parent").notifyPropertyChange(n,{memo:{value:v}});}};BT.prototype.translateBone=function BT_translateBone(){var boneModel=this.getBone();var visibleField=this.props.visibleField;if(visibleField!=null&&visibleField.length>0){this.set(visibleField,boneModel.commands.queryEnabled(visibleField));if(!this.props[visibleField]){return ;}}if(!this.get("enabled")||!boneModel){return ;}var fields=this.get("fields");if(!fields){return ;}fields=fields.split("|");if(fields[0]==""){fields.shift();}if(fields[fields.length-1]==""){fields.pop();}if(!fields){return ;}this.translating=true;for(var i=0,cnt=fields.length;i<cnt;i++){var p=fields[i];if(!boneModel.commands.queryEnabled(p)){continue;}var value=this._getDeltaProp(p);if(value==null){value=boneModel.commands.queryState(p);}if(value&&typeof value=="string"){value=value.replace(/'+/g,"");}var prop=this.props[p];if(mstr.models.ListCart&&prop instanceof mstr.models.ListCart){prop.get("selected").setItems(value);this._setModelChangeEventListeners(prop,p);}else{if(prop instanceof mstr.models.ListModel){var fn=(mstr.$A.isArray(value))?"execSelectValues":"execSelectValue";var success=prop[fn](value);if(!success&&prop.execClearSelect){prop.execClearSelect();}this._setModelChangeEventListeners(prop,p);}else{this.set(p,value);}}}this.translating=false;};BT.prototype.onModelPropertyChange=function BT_onModelPropertyChange(evt){var model=evt.src;var v="";var valueWas=null;if(evt.name=="set_actualColor"){v=model.get("actualColor");valueWas=evt.memo.valueWas;}else{var items=[];switch(evt.name){case"hashadd_selectedIndices":case"hashremove_selectedIndices":items=model.getSelectedItems();valueWas=evt.memo.at;break;case"listadd_items":case"listremove_items":items=model.getItems();break;default:return ;}var vf=model.get("valueForm");var d="";for(var i=0,cnt=items.length;i<cnt;i++){v+=d+items[i][vf];d=CLIPBOARD_ITEM_SEPARATOR;}}var propName=model.get("mappedPropertyName");this.raiseEvent("set_"+propName,{name:propName,src:evt.name,value:v,valueWas:valueWas});if(this.translating){return ;}this._storeDeltaProp(propName,v);};BT.prototype.resetDeltas=function BT_resetDeltas(){this.deltaProps={};mstr.models.BaseModel.prototype.set.apply(this,["hasChanges",false]);};BT.prototype.collectChanges=function BT_collectChanges(propertyChanges){for(var cat in this.deltaProps){var m=(cat.indexOf("|")==-1)?{}:mstr.utils.Arrays.toHashProperties(cat.split("|"),["category","unit","format"]);for(var prop in this.deltaProps[cat]){propertyChanges.push({obj:null,cmdId:prop,value:this.deltaProps[cat][prop],memo:m,performFormatChange:true,submitUpdateManager:false});}}};BT.prototype._isTranslatedProperty=function BT_isModelProperty(n){var fields=this.props.fields;if(!fields){return false;}var regex=new RegExp("\\|"+n+"\\||^"+n+"\\||\\|"+n+"$|^"+n+"$");return regex.test(fields);};function BT(props){mstr.models.BaseModel.apply(this,[props]);this.resetDeltas();}return BT;})();mstr.bones.editors.BoneTranslatorManager=(function(){mstr.$O.extendsClass(BTM,mstr.models.ListModel);BTM.prototype.init=function BTM_init(){mstr.models.BaseModel.prototype.init.apply(this);this.attachEventListener(this,"set_lockedTab","_lockTabs");this._lockTabs();var items=this.getItems();var cnt=items.length;for(var i=0;i<cnt;i++){items[i].attachEventListener(this,"set_hasChanges","handleChanges");}this._startBoneTranslation();this._fixSelection();};BTM.prototype.on_set_viewDisabled=function BTM_on_set_viewDisabled(evt){this.set("CommandEnabledOkChanges",(!evt.memo.value&&this.get("enableOk")));this.set("CommandEnabledPreviewChanges",(!evt.memo.value&&this.get("enablePreview")));};BTM.prototype.on_set_enableOk=function BTM_on_set_enableOk(evt){this.set("CommandEnabledOkChanges",(evt.memo.value&&!this.get("viewDisabled")));};BTM.prototype.on_set_enablePreview=function BTM_on_set_enablePreview(evt){this.set("CommandEnabledPreviewChanges",(evt.memo.value&&!this.get("viewDisabled")&&!this.get("disablePreview")));};BTM.prototype._startBoneTranslation=function BTM__startBoneTranslation(){var items=this.getItems();var cnt=items.length;for(var i=0;i<cnt;i++){items[i].translateBone();}};BTM.prototype._lockTabs=function BTM__lockTabs(){var lockedTab=this.get("lockedTab");if(lockedTab!=-1){this.execSingleSelect(lockedTab);this.set("disableList",true);}else{this.set("disableList",false);}};BTM.prototype.execReinitializeModel=function BTM_execReinitializeModel(){this.set("hasChanges",false);this.set("previewCount",0);this.props.enableOk=false;this.props.enablePreview=false;this.set("viewDisabled",false);this.set("disablePreview",false);this._reinitializeChildModels();this._fixSelection();};BTM.prototype._reinitializeChildModels=function BTM__reinitializeChildModels(){var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){items[i].reinitializeModel();}};BTM.prototype.handleChanges=function BTM_handleChanges(evt){this.set("hasChanges",evt.memo.value);if(!evt.memo.value){return ;}this.set("enableOk",true);this.set("enablePreview",true);if(this.get("lockedTab")!=-1&&!this.get("viewDisabled")){this.set("lockedTab",-1);}};BTM.prototype.disableModelFromView=function BTM_disableModelFromView(b){this.set("viewDisabled",b);};BTM.prototype.execOkChanges=function BTM_execOkChanges(){this.saveModelChanges();this.set("enableOk",false);this.set("enablePreview",false);return true;};BTM.prototype.execPreviewChanges=function BTM_execPreviewChanges(){var um=microstrategy.updateManager;if(um){um.observer.register(this.props.id);}this.saveModelChanges();this.set("enablePreview",false);this.props.previewCount++;if(um&&!um.isFlushing()){var bone=mstr.$obj(this.get("boneId"));if(bone&&bone.commands.queryEnabled("oneTable")){this._initializeSelectors();}this._reinitializeChildModels();um.observer.unregister(this.props.id);}return true;};BTM.prototype.saveModelChanges=function BTM_saveModelChanges(){var propertyChanges=new Array();var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){items[i].collectChanges(propertyChanges);}if(propertyChanges.length>0){var target=mstr.$obj(this.props.boneId);if(target){if(!(target.commands.exec(this.props.boneCmdId,propertyChanges))){return false;}}}this.execClearChanges();return true;};BTM.prototype.execClearChanges=function BTM_execClearChanges(){var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){items[i].resetDeltas();}};BTM.prototype.execCancelChanges=function BTM_execCancelModelChanges(){this.execClearChanges();var target=mstr.$obj(this.props.boneId);if(target){target.commands.exec("cancelEdit",this.get("previewCount"));}this.set("lockedTab",-1);this.set("enablePreview",false);this.set("enableOk",false);};BTM.prototype._fixSelection=function BTM_fixSelection(){var sel=this.getSelectedItem();if(!sel.get(sel.get("visibleField"))){var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){if(items[i].get(items[i].get("visibleField"))){this.execSingleSelect(i);return ;}}}};function BTM(props){mstr.models.ListModel.apply(this,[props]);}return BTM;})();mstr.bones.editors.PropertiesBoneTranslatorManager=(function(){mstr.$O.extendsClass(PBTM,mstr.bones.editors.BoneTranslatorManager);PBTM.prototype._initializeSelectors=function PBTM_initializeSelectors(){var bone=mstr.$obj(this.get("boneId"));this.set("showGridSelectors",bone.commands.queryEnabled("showGridSelectors"));this.set("showPanelSelector",bone.commands.queryEnabled("showPanelSelector"));var modelProps=["edtUnitSelector","edtValueSelector"];for(var i=0;i<2;i++){this._initializeSingleSelector(modelProps[i]);}};PBTM.prototype._initializeSingleSelector=function PBTM__initializeSingleSelector(cmdId){var bone=mstr.$obj(this.get("boneId"));var m=this.get(cmdId);m.detachEventListener(this,"hashadd_selectedIndices");m.set("cmdId",cmdId);var p=bone.commands.queryState(cmdId,this._getTabName());if(p.isFetching&&(!this.pollInterval)){this._setGridModelEnablement(false);this.pollInterval=self.setInterval("mstr.$obj('"+this.get("id")+"').pollForGridFormat();",100);}m.set("visible",p.visible);m.set("enabled",p.enabled);if(p.items){m.setItems(p.items);if("value" in p){m.execSelectValue(p.value);}}m.attachEventListener(this,"hashadd_selectedIndices","updateTargetFromUnitSelectors");};PBTM.prototype._getTabName=function PBTM__getTabName(){return mstr.controllers.Factory.safeget(this.getSelectedItem(),"tabName");};PBTM.prototype._setGridModelEnablement=function PBTM__setGridModelEnablement(enabled){var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){var changeField=mstr.controllers.Factory.safeget(items[i],"unitSelectorChange");if(changeField&&(changeField.indexOf("Grid")>-1)){mstr.controllers.Factory.safeset(items[i],"enabled",enabled);if(enabled&&items[i].reinitializeModel){items[i].reinitializeModel();}}}};PBTM.prototype.on_set_enablePreview=function PBTM_on_set_enablePreview(evt){if(!evt.memo.value||this.get("viewDisabled")){mstr.bones.editors.BoneTranslatorManager.prototype.on_set_enablePreview.apply(this,[evt]);return ;}this.set("CommandEnabledPreviewChanges",!this.get("isGridFormatted"));};PBTM.prototype.pollForGridFormat=function PBTM_pollForGridFormat(){var bone=mstr.$obj(this.get("boneId"));if(bone.commands.queryState("areGridFormatsReady")){this._clearGridFormatPoll();this._setGridModelEnablement(true);}};PBTM.prototype._clearGridFormatPoll=function PBTM__clearGridFormatPoll(){if(this.pollInterval){self.clearInterval(this.pollInterval);delete this.pollInterval;}};PBTM.prototype._cancelGridFormatPoll=function PBTM__cancelGridFormatPoll(){if(!this.pollInterval){return ;}this._clearGridFormatPoll();var bone=mstr.$obj(this.get("boneId"));bone.commands.exec("cancelGridFormatRequest");var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){mstr.controllers.Factory.safeset(items[i],"enabled",true);}};PBTM.prototype._startBoneTranslation=function PBTM__startBoneTranslation(){this._initializeSelectors();mstr.bones.editors.BoneTranslatorManager.prototype._startBoneTranslation.apply(this);};PBTM.prototype._handleDeltaPropStorage=function PBTM__handleDeltaPropStorage(evt){return ;var parts=evt.memo.category.split("|");if(parts.length==3){if(parts[0]=="Grid"||(parts[0]=="AllGrid"&&parts[1]!="0")){this.set("isGridFormatted",true);this.set("enablePreview",false);}}};PBTM.prototype.init=function PBTM_init(){mstr.bones.editors.BoneTranslatorManager.prototype.init.apply(this);this.set("isGridFormatted",false);var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){items[i].attachEventListener(this,"store_deltaProp","_handleDeltaPropStorage");}};PBTM.prototype.acknowledgeReloadEnd=function PBTM_acknowledgeReloadEnd(){this.execReinitializeModel();var um=microstrategy.updateManager;if(um){um.observer.unregister(this.props.id);}};PBTM.prototype.execReinitializeModel=function PBTM_execReinitializeModel(){this._initializeSelectors();this.set("isGridFormatted",false);this.set("showCancelButton",true);mstr.bones.editors.BoneTranslatorManager.prototype.execReinitializeModel.apply(this);var item=this.getSelectedItem();if(!item.get(item.get("visibleField"))){this.execSingleSelect(0);}};PBTM.prototype.updateTargetFromUnitSelectors=function PBTM_updateTargetFromUnitSelectors(evt){var cmdId=evt.src.get("cmdId");var m=this.get(cmdId);var props={src:cmdId,v:m.getSelectedItem()[m.get("valueForm")],t:this._getTabName()};mstr.$obj(this.get("boneId")).commands.exec("setUnitFormatLevels",props);if(cmdId=="edtUnitSelector"){this._initializeSingleSelector("edtValueSelector");}this._reinitializeSelectorBasedModels();};PBTM.prototype._reinitializeSelectorBasedModels=function PBTM__reinitializeSelectorBasedModels(){if(this.pollInterval){return ;}var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){var changeField=items[i].get("unitSelectorChange");if(changeField){items[i].reinitializeModel();}}};PBTM.prototype.execClearChanges=function PBTM_execClearChanges(){mstr.bones.editors.BoneTranslatorManager.prototype.execClearChanges.apply(this);this._cancelGridFormatPoll();};PBTM.prototype.execOpenWebHyperLinkEditor=function PBTM_execOpenWebHyperLinkEditor(){mstr.$obj("rwb_viewer").doc.commands.exec("WebHyperLinkEditor");this.set("showCancelButton",false);};PBTM.prototype.handleChanges=function PBTM_handleChanges(evt){mstr.bones.editors.BoneTranslatorManager.prototype.handleChanges.apply(this,[evt]);evt.memo.value&&this.set("showCancelButton",true);};PBTM.prototype.on_hashadd_selectedIndices=function PBTM_on_hashadd_selectedIndices(evt){mstr.bones.editors.BoneTranslatorManager.prototype.on_hashadd_selectedIndices.call(this,evt);var tabName=this._getTabName();if(tabName){mstr.$obj(this.get("boneId")).commands.exec("edtTabChange",tabName);}var items=this.getItems();if(items.length>0&&items[0].get){this._initializeSelectors();this._reinitializeSelectorBasedModels();}};PBTM.prototype.notifyPropertyChange=function PBTM_notifyPropertyChange(propertyName,evt){var items=this.getItems();for(var i=0,cnt=items.length;i<cnt;i++){if(items[i]["on_set_ext_prop_"+propertyName]){items[i]["on_set_ext_prop_"+propertyName](evt);}}};function PBTM(props){mstr.bones.editors.BoneTranslatorManager.apply(this,[props]);}return PBTM;})();mstr.bones.editors.FormatEditingBoneTranslator=(function(){mstr.$O.extendsClass(FBT,mstr.bones.editors.BoneTranslator);FBT.prototype._getPropertyCategory=function BT_getPropertyCategory(){var defaultCat=mstr.bones.editors.BoneTranslator.prototype._getPropertyCategory.apply(this);var p=this.get("parent");var unit=p.get("edtUnitSelector");var format=p.get("edtValueSelector");var cat=((p.get("showGridSelectors"))?"Grid":"default")+"|";var item=unit.getSelectedItem();if(!item){return defaultCat;}cat+=unit.getSelectedItem()[unit.get("valueForm")]+"|";item=format.getSelectedItem();if(!item){return defaultCat;}cat+=format.getSelectedItem()[format.get("valueForm")];return cat;};FBT.prototype.refreshForSearchBox=function FBT_refreshForSearchBox(base,isSearchBox){if(isSearchBox){var visibleField=base.get("visibleField");if(visibleField=="alignmentTabEnabled"||visibleField=="effectsTabEnabled"){base.set(visibleField,false);}}};FBT.prototype.translateBone=function FBT_translateBone(){mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);this.translating=true;var isSearchBox=mstr.bones.editors.LayoutPropertiesBoneTranslator.prototype.isSearchBox(this);this.refreshForSearchBox(this,isSearchBox);this.translating=false;};function FBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return FBT;})();mstr.bones.editors.EffectsPropertiesBoneTranslator=(function(){mstr.$O.extendsClass(EPBT,mstr.bones.editors.FormatEditingBoneTranslator);EPBT.prototype.on_set_ext_prop_showTranslucent=function EPBT_on_set_ext_prop_showTranslucent(evt){var iwm=evt.InfoWindowMode;this.set("showTranslucent",(evt.UseAsInformationWindow&&(iwm==="2"||iwm==="3"||iwm==="4")));};function EPBT(props){mstr.bones.editors.FormatEditingBoneTranslator.apply(this,[props]);}return EPBT;})();mstr.bones.editors.FontPropertiesBoneTranslator=(function(){mstr.$O.extendsClass(FPBT,mstr.bones.editors.FormatEditingBoneTranslator);FPBT.prototype._getPropertyCategory=function FPBT_getPropertyCategory(){return mstr.bones.editors.FormatEditingBoneTranslator.prototype._getPropertyCategory.apply(this);};FPBT.prototype.on_set_ext_prop_ButtonDisplayStyle=function FPBT_on_set_ext_prop_ButtonDisplayStyle(evt){var displayStyle=Number(evt.memo.value);var visibleField=this.get("visibleField");switch(displayStyle){case microstrategy.BUTTON_STYLE_CAPTION_ONLY:case microstrategy.BUTTON_STYLE_ICON_LEFT:case microstrategy.BUTTON_STYLE_ICON_RIGHT:case microstrategy.BUTTON_STYLE_ICON_TOP:this.set(visibleField,true);break;case microstrategy.BUTTON_STYLE_ICON_ONLY:case microstrategy.BUTTON_STYLE_CUSTOM:this.set(visibleField,false);break;}};function FPBT(props){mstr.bones.editors.FormatEditingBoneTranslator.apply(this,[props]);}return FPBT;})();mstr.bones.editors.LayoutPropertiesBoneTranslator=(function(){mstr.$O.extendsClass(LBT,mstr.bones.editors.BoneTranslator);var _xTabViewWidgetItem=null;var lockRatio={};LBT.prototype.init=function LBT_init(){mstr.bones.editors.BoneTranslator.prototype.init.apply(this);_xTabViewWidgetItem=this.get("XTabView").getItems()[this.get("XTabView").indexOfValue("50")];};LBT.prototype.translateBone=function LBT_translateBone(){mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);var viewMode=this.get("XTabView").getSelectedItemValue();this.set("ExportOverflowVisible",!this.get("IsPortal")&&(viewMode==1||viewMode==3));this.on_set_DataSource();lockRatio={};};LBT.prototype.getDynamicListModel=function LBT_getDynamicListModel(sourceName,propertyName){var m=mstr.bones.editors.BoneTranslator.prototype.getDynamicListModel.apply(this,[sourceName,propertyName]);if(propertyName=="DataSource"){this.on_set_DataSource();}else{if(propertyName=="EditSelectorStyle"){this.on_set_EditSelectorStyle();}}return m;};LBT.prototype._setDynamicModelValues=function LBT_setDynamicModelValues(propertyName,model,source){if(propertyName=="EditSelectorStyle"){this.isNde=this._isNde();var items=this._getApplicableStyles(this.isNde);this._setDynamicListModelValues(model,items,propertyName);}else{mstr.bones.editors.BoneTranslator.prototype._setDynamicModelValues.apply(this,[propertyName,model,source]);}};LBT.prototype._isNde=function LBT_isNde(){var selSrc=mstr.controllers.Factory.getPath("parent/items/6/EditSelectorSource",this);var ix=selSrc&&selSrc.get("selectedIndicesList"),isNde,val;if(ix!=undefined){val=selSrc.get("items")[ix];isNde=val.sty==12033;}else{val=microstrategy.getViewerBone()&&microstrategy.getViewerBone().commands.queryState("EditSelectorSource");if(val){isNde=val.split("|")[1]==47;}}return isNde;};LBT.prototype._getApplicableStyles=function LBT_getSelectorStyles(isNde){var styles=[],st=this.get("SelectorStyles").get("items"),i,item;for(i=0;i<st.length;i++){item=st[i];if(isNde&&item.dssid==9){continue;}styles.push(item);}this.isNde=isNde;return styles;};LBT.prototype.on_set_ext_prop_EditSelectorSource=function LBT_on_set_ext_prop_EditSelectorSource(evt){var isNde=this._isNde();if(isNde!=this.isNde){this.isNde=isNde;var ss=this.get("EditSelectorStyle");if(ss){var newItems=this._getApplicableStyles(isNde),selection=ss.getSelectedItemValue();ss.setItems(newItems);if(selection){ss.execSelectValue(selection);}}}};LBT.prototype.on_set_ext_prop_IsPortal=function LBT_on_set_ext_prop_IsPortal(evt){var isPortal=evt.memo.value;var oldT=this.translating;this.translating=true;this.set("IsPortal",isPortal);this.translating=oldT;if(!this.get("isOneGrid")){return ;}this.set("showFixedHeightOnly",isPortal);this.set("showFixedFitHeight",!isPortal);this.set("showFixedWidthOnly",isPortal);this.set("showFixedFitWidth",!isPortal);this.set("ExportOverflowVisible",!isPortal&&this.props.XTabView.getSelectedIndex()!=1);};LBT.prototype.on_set_DataSource=function LBT_on_set_DataSource(evt){this.set("enableShortcut",this.props.DataSource&&this.props.DataSource.props.selectedCount>0&&!this.props.isCubeReportDataset);};LBT.prototype.on_set_XTabView=function LBT_on_set_XTabView(evt){if(!this.translating){this.get("parent").notifyPropertyChange("XTabView",evt);this.set("ExportOverflowVisible",!this.get("IsPortal")&&(evt.memo.value==1||evt.memo.value==3));}};LBT.prototype.on_set_Height=function LBT_on_set_Height(evt){if(this._shouldLockRatio()){this._lockRatio(evt,"Width");}};LBT.prototype.on_set_Width=function LBT_on_set_Width(evt){if(this._shouldLockRatio()){this._lockRatio(evt,"Height");}};LBT.prototype.on_set_ext_prop_EditSelectorType=function LBT_on_set_ext_prop_EditSelectorType(evt){this.on_set_EditSelectorStyle(evt);};LBT.prototype.on_set_EnableSelCount=function LBT_on_set_ext_prop_EditSelectorType(evt){if(!this.get("EnableSelCount")){this.set("MaxSel","");this.set("MinSel","");}};LBT.prototype.on_set_ext_prop_isDSAsTarget=function LBT_on_set_ext_prop_isDSAsTarget(evt){this._checkSearchBoxProps(evt);};LBT.prototype.on_set_ext_prop_EditSelectorStyle=function LBT_on_set_ext_prop_EditSelectorStyle(evt){this._checkSearchBoxProps(evt);};LBT.prototype._checkSearchBoxProps=function LBT_checkSearchBoxProps(evt){var isSearchBox=this.isSearchBox(this);this.set("visibleSearchOnServ",isSearchBox);this.set("ItemWidthModeEnabled",!isSearchBox);if(isSearchBox){this.get("EditSelectorOrientation").set("selectedIndicesList",0);var swm=this.get("setWidget");if(swm){swm.set("selectedIndicesList",0);}}mstr.bones.editors.ColorLinesPropertiesBoneTranslator.prototype.refreshForSearchBox(this.get("parent").get("items")[8],isSearchBox);mstr.bones.editors.FormatEditingBoneTranslator.prototype.refreshForSearchBox(this.get("parent").get("items")[11],isSearchBox);mstr.bones.editors.FormatEditingBoneTranslator.prototype.refreshForSearchBox(this.get("parent").get("items")[12],isSearchBox);mstr.bones.editors.SelectorPageBoneTranslator.prototype.refreshForSearchBox(this.get("parent").get("items")[6],isSearchBox);};LBT.prototype.on_set_EditSelectorStyle=function LBT_on_set_EditSelectorStyle(evt){var selType=mstr.controllers.Factory.getPath("parent/items/6/EditSelectorType",this);var isPanelSelector,isTextSelector,isAttrSelector;this._checkSearchBoxProps(evt);if(selType.props&&selType.props.selectedIndicesList!=undefined){isPanelSelector=selType.props.selectedIndicesList=="2";isTextSelector=selType.props.selectedIndicesList=="4";isAttrSelector=selType.props.selectedIndicesList=="5";}else{isPanelSelector=microstrategy.getViewerBone()&&microstrategy.getViewerBone().commands.queryState("EditSelectorType")=="3";isTextSelector=microstrategy.getViewerBone()&&microstrategy.getViewerBone().commands.queryState("EditSelectorType")=="5";isAttrSelector=microstrategy.getViewerBone()&&microstrategy.getViewerBone().commands.queryState("EditSelectorType")=="8";}if(isPanelSelector||isAttrSelector){this.set("EditSelectorMultiSelectEnabled",false);return ;}if(isTextSelector){this.set("EditSelectorMultiSelectEnabled",true);return ;}var style=this.get("EditSelectorStyle"),idx=style&&style.props.selectedIndicesList;switch(idx){case"1":case"2":case"3":case"5":case"6":case"7":this.set("EditSelectorMultiSelectEnabled",true);break;default:this.set("EditSelectorMultiSelectEnabled",false);}this.set("ChangeSelectionOnMouseOverEnabled",(this.props.isSlicingSelector&&idx!=7));};LBT.prototype._shouldLockRatio=function LBT__shouldLockRatio(){return(!this.translating&&!this.adjustingRatio&&this.get("LockAspectRatio"));};LBT.prototype._lockRatio=function LBT__lockRation(evt,n){var memo=evt.memo,v=memo.value,source=memo.name,dest=n;if(!(lockRatio[source]&&lockRatio[source].hasOwnProperty(dest))){if(!lockRatio[source]){lockRatio[source]={};}var d=this.get(dest)/memo.valueWas;d=isNaN(d)||!isFinite(d)?0:d;lockRatio[source][dest]=d;if(!lockRatio[dest]){lockRatio[dest]={};}lockRatio[dest][source]=1/d;}this.adjustingRatio=true;this.set(n,v*lockRatio[source][dest]);this.adjustingRatio=false;};LBT.prototype.on_set_LockAspectRatio=function LBT_on_set_LockAspectRatio(evt){if(!evt.memo.value){lockRatio={};}};LBT.prototype.isSearchBox=function LBT_isSearchBox(base){var typeLM=mstr.controllers.Factory.getPath("parent/items/6/EditSelectorType",base);var styleLM=mstr.controllers.Factory.getPath("parent/items/1/EditSelectorStyle",base);if(typeLM&&styleLM){var ctlType=typeLM.getSelectedItemValue()!=null?typeLM.getSelectedItemValue():microstrategy.getViewerBone().commands.queryState("EditSelectorType");var ctlStyle=styleLM.getSelectedItemValue()!=null?styleLM.getSelectedItemValue():microstrategy.getViewerBone().commands.queryState("EditSelectorStyle");return(ctlType=="1"&&ctlStyle=="9");}return false;};function LBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return LBT;})();mstr.bones.editors.GridPropertiesBoneTranslator=(function(){mstr.$O.extendsClass(GPBT,mstr.bones.editors.BoneTranslator);GPBT.prototype.translateBone=function GPBT_translateBone(){mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);this.translating=true;this.on_set_DrillOptions();this.translating=false;};GPBT.prototype.on_set_DrillOptions=function GPBT_on_set_DrillOptions(evt){var v=(evt&&evt.memo&&evt.memo.value);if(v==null){v=this.get("DrillOptions").getSelectedItemValue();}if(v==""){return ;}this.set("showSyncDrillingOpt",(v==2)&&mstr.behaviors.featureResolver.featAvailable(microstrategy.FEATURE_RW_EDITABLE_VIEW_MODE_EPLUS));};GPBT.prototype.IF_MODE_ROWS="1";GPBT.prototype.IF_MODE_BLOCKS="2";GPBT.prototype.on_set_gridIfRowMode=function GPBT_on_set_RowIFMode(evt){var newMode=(evt&&evt.memo&&evt.memo.value);if(newMode==null){newMode=this.get("gridIfRowMode").getSelectedItemValue();}if(newMode==""){return ;}var boneModel=this.getBone(),gridElem=boneModel.doc.selections.getSelectedGrid(),gridBone=microstrategy.findBone(gridElem),totalRows=gridBone.ifTotalRows,totalBlocks=gridBone.ifTotalBlocks,oldMaxRows=this.get("gridIfMaxRows"),newMaxRows=oldMaxRows;if(totalRows&&totalBlocks){if(newMode===this.IF_MODE_ROWS){newMaxRows=Math.round(oldMaxRows*totalRows/totalBlocks)||1;}else{newMaxRows=Math.round(oldMaxRows*totalBlocks/totalRows)||1;}}else{newMaxRows=1;}this.set("gridIfMaxRows",newMaxRows);};function GPBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return GPBT;})();mstr.bones.editors.NumberPropertiesBoneTranslator=(function(){mstr.$O.extendsClass(NP,mstr.bones.editors.FormatEditingBoneTranslator);NP.prototype.init=function NP_init(){mstr.bones.editors.FormatEditingBoneTranslator.prototype.init.apply(this);this.attachEventListener(this,"set_Category","_buildFormatString");this.attachEventListener(this,"set_DecimalPlaces","_buildFormatString");this.attachEventListener(this,"set_ThousandSeparator","_buildFormatString");this.attachEventListener(this,"set_CurrencySymbol","_buildFormatString");this.attachEventListener(this,"set_CurrencyPosition","_buildFormatString");this.get("NegativeNumbers").attachEventListener(this,"hashadd_selectedIndices","_buildFormatString");this.get("Date").attachEventListener(this,"hashadd_selectedIndices","_buildFormatString");this.get("Time").attachEventListener(this,"hashadd_selectedIndices","_buildFormatString");this.get("Fraction").attachEventListener(this,"hashadd_selectedIndices","_buildFormatString");};NP.prototype.translateBone=function NP_translateBone(){mstr.bones.editors.FormatEditingBoneTranslator.prototype.translateBone.apply(this);var formatStr=this.get("Format");var selItem=this.get("Category").getSelectedItem();selItem=selItem?parseInt(selItem.dssid):-2;switch(selItem){case -2:case 9:if(this.get("Format")=="General"){var ov=this.translating;this.translating=true;this.set("Format","");this.translating=ov;}break;case 0:case 1:case 4:this._rebuildNegativeNumberField(this._buildDecimalString(true));break;case 2:this.get("Date").execSelectValue(formatStr);break;case 3:this.get("Time").execSelectValue(formatStr);break;case 5:this.get("Fraction").execSelectValue(formatStr);break;}};NP.prototype.onModelPropertyChange=function NP_onModelPropertyChange(evt){mstr.bones.editors.FormatEditingBoneTranslator.prototype.onModelPropertyChange.apply(this,[evt]);this._buildFormatString(evt);};NP.prototype._buildDecimalString=function NP__buildDecimalString(useLocale){var decimal="";var cnt=parseInt(this.get("DecimalPlaces"));for(var i=0;i<cnt;i++){decimal+="0";}var decimalSep=".";if(useLocale){decimalSep=mstr.$obj("mstrPageInfo").get("userInfo").get("decimalSeparator");}return(decimal.length>0)?decimalSep+decimal:"";};NP.prototype._addNegativeFormatString=function NP__addNegativeFormatString(formatStr){switch(this.get("NegativeNumbers").getSelectedIndex()){case 1:return formatStr+";[RED]-"+formatStr;case 2:return formatStr+";[RED]"+formatStr;case 3:return formatStr+";("+formatStr+")";case 4:return formatStr+";[RED]("+formatStr+")";default:return formatStr;}};NP.prototype._addCurrencySymbolFormatString=function NP__addCurrencySymbolFormatString(formatStr){var s="";var symbol=this.get("CurrencySymbol");switch(this.get("CurrencyPosition").getSelectedIndex()){case 1:s=formatStr+'"'+symbol+'"';break;case 2:s='"'+symbol+' "'+formatStr;break;case 3:s=formatStr+'" '+symbol+'"';break;default:s='"'+symbol+'"'+formatStr;}return this._addNegativeFormatString(s);};NP.prototype._buildFormatString=function NP__buildFormatString(evt){var item=this.get("Category").getSelectedItem();if(!item){return ;}var cat=parseInt(item.dssid);if(cat==7){return ;}var decimalStr=this._buildDecimalString();if(cat==0||cat==1||cat==4){this._rebuildNegativeNumberField(this._buildDecimalString(true));}var tSep=(this.get("ThousandSeparator"))?",":"";var formatStr="";switch(cat){case 0:formatStr=this._addNegativeFormatString("#"+tSep+"##0"+decimalStr);break;case 1:formatStr=this._addCurrencySymbolFormatString("#,##0"+decimalStr);break;case 2:formatStr=this.get("Date").getSelectedItem()["dssid"];break;case 3:formatStr=this.get("Time").getSelectedItem()["dssid"];break;case 4:formatStr=this._addNegativeFormatString("0"+decimalStr+"%");break;case 5:formatStr=this.get("Fraction").getSelectedItem()["dssid"];break;case 6:formatStr="0"+decimalStr+"E+00";}this.set("Format",formatStr);};NP.prototype._rebuildNegativeNumberField=function NP__rebuildNegativeNumberField(decimalStr){var ov=this.translating;this.translating=true;var n=this.get("NegativeNumbers");var items=mstr.utils.Hash.deepClone(n.getItems());var value=n.getSelectedItem()&&n.getSelectedItem()["dssid"];n.detachEventListener(this,"hashadd_selectedIndices");n.detachEventListener(this,"hashremove_selectedIndices");var red=this.get("Red");var cssText=this.getBone().commands.queryState("textfieldSelected")?"color:red;display:block;":"color:red;display:none;";var tSep=mstr.Settings.Locale.THOUSANDSEP;var cat=parseInt(this.get("Category").getSelectedItem()["dssid"]);switch(cat){case 0:tSep=(this.get("ThousandSeparator"))?tSep:"";items[0]["n"]="-1"+tSep+"234"+decimalStr;items[1]["n"]="-1"+tSep+"234"+decimalStr+" ["+red+"]";items[1]["cssText"]=cssText;items[2]["n"]="1"+tSep+"234"+decimalStr+" ["+red+"]";items[2]["cssText"]=cssText;items[3]["n"]="(1"+tSep+"234"+decimalStr+")";items[4]["n"]="(1"+tSep+"234"+decimalStr+") ["+red+"]";items[4]["cssText"]=cssText;break;case 1:var prefix="";var suffix="";var symbol=this.get("CurrencySymbol");switch(this.get("CurrencyPosition").getSelectedIndex()){case 2:prefix+=" ";case 0:prefix=symbol+prefix;break;case 3:suffix+=" ";case 1:suffix+=symbol;break;}items[0]["n"]=prefix+"-1"+tSep+"234"+decimalStr+suffix;items[1]["n"]=prefix+"-1"+tSep+"234"+decimalStr+suffix+" ["+red+"]";items[1]["cssText"]=cssText;items[2]["n"]=prefix+"1"+tSep+"234"+decimalStr+suffix+" ["+red+"]";items[2]["cssText"]=cssText;items[3]["n"]="("+prefix+"1"+tSep+"234"+decimalStr+suffix+")";items[4]["n"]="("+prefix+"1"+tSep+"234"+decimalStr+suffix+") ["+red+"]";items[4]["cssText"]=cssText;break;case 4:items[0]["n"]="-123"+decimalStr+"%";items[1]["n"]="-123"+decimalStr+"% ["+red+"]";items[1]["cssText"]=cssText;items[2]["n"]="123"+decimalStr+"% ["+red+"]";items[2]["cssText"]=cssText;items[3]["n"]="(123"+decimalStr+"%)";items[4]["n"]="(123"+decimalStr+"%) ["+red+"]";items[4]["cssText"]=cssText;break;}n.setItems(items);if(value){n.execSelectValue(value);}n.attachEventListener(this,"hashadd_selectedIndices","onModelPropertyChange");n.attachEventListener(this,"hashremove_selectedIndices","onModelPropertyChange");this.translating=ov;};function NP(props){mstr.bones.editors.FormatEditingBoneTranslator.apply(this,[props]);}return NP;})();mstr.bones.editors.ColorLinesPropertiesBoneTranslator=(function(){mstr.$O.extendsClass(CLE,mstr.bones.editors.FormatEditingBoneTranslator);CLE.prototype.on_set_enableBorders=function CLE_on_set_enableBorders(evt){var sg=mstr.controllers.Factory.safeget;this.resolveBorderEnablement(evt.memo.value,sg(this.get("parent").get("items")[12],"enabled3d"));};CLE.prototype.on_set_ext_prop_enabled3d=function CLE_on_set_ext_prop_enabled3d(evt){this.resolveBorderEnablement(this.get("enableBorders"),evt.memo.value);};CLE.prototype.resolveBorderEnablement=function CLE_resolveBorderEnablement(borders,is3D){this.set("enableBordersNot3d",borders&&!is3D);};CLE.prototype.translateBone=function CLE_translateBone(){mstr.bones.editors.FormatEditingBoneTranslator.prototype.translateBone.apply(this);this.translating=true;var isSearchBox=mstr.bones.editors.LayoutPropertiesBoneTranslator.prototype.isSearchBox(this);this.refreshForSearchBox(this,isSearchBox);this.translating=false;};CLE.prototype.refreshForSearchBox=function CLE_refreshForSearchBox(base,isSearchBox){var ft=microstrategy.formatType;var m=base.get("parent").get("edtValueSelector");var its=m.get("items");var idx=mstr.$A.findByForm(its,4,"dssid",false);if(isSearchBox&&idx>=0){m.set("selectedIndicesList",idx);}m.set("formatEnabled",!isSearchBox);microstrategy.formatType=ft;};CLE.prototype.on_set_ext_prop_ButtonDisplayStyle=function CLE_on_set_ext_prop_ButtonDisplayStyle(evt){var displayStyle=Number(evt.memo.value);var visibleField=this.get("visibleField");switch(displayStyle){case microstrategy.BUTTON_STYLE_CAPTION_ONLY:case microstrategy.BUTTON_STYLE_ICON_LEFT:case microstrategy.BUTTON_STYLE_ICON_RIGHT:case microstrategy.BUTTON_STYLE_ICON_TOP:case microstrategy.BUTTON_STYLE_ICON_ONLY:this.set(visibleField,true);break;case microstrategy.BUTTON_STYLE_CUSTOM:this.set(visibleField,false);break;}};function CLE(props){mstr.bones.editors.FormatEditingBoneTranslator.apply(this,[props]);}return CLE;})();mstr.bones.editors.ThemePropertiesBoneTranslator=(function(){mstr.$O.extendsClass(THE,mstr.bones.editors.FormatEditingBoneTranslator);function THE(props){mstr.bones.editors.FormatEditingBoneTranslator.apply(this,[props]);}THE.prototype._resolveAppliedThemeTypeSelected=function THE_resolveAppliedThemeTypeSelected(){var thmid=this.get("appliedThemeID"),thmType=this.get("appliedThemeType"),thmTypes=this.get("appliedThemeTypes");if(!thmTypes){return ;}switch(thmType){case microstrategy.APPLIED_THEME_NONE:case microstrategy.APPLIED_THEME_CUSTOM:thmTypes.execSelectValue(thmType);break;case microstrategy.APPLIED_THEME_DEFAULT:thmTypes.execSelectValue(thmid);break;}};THE.prototype._resolveAppliedThemeAsLink=function THE_resolveAppliedThemeAsLink(){var thmlnk=this.get("appliedThemeAsLink"),thmAsTypes=this.get("appliedThemeAsTypes");if(!thmAsTypes){return ;}thmAsTypes.execSelectValue(thmlnk?"1":"0");};THE.prototype.translateBone=function BBT_translateBone(){mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);this.translating=true;this._resolveAppliedThemeTypeSelected();this._resolveAppliedThemeAsLink();this.translating=false;};THE.prototype._handleAppliedThemeTypeChange=function THE_handleAppliedThemeTypeChange(evt){if(this.translating){return ;}var thmTypes=this.get("appliedThemeTypes"),v=thmTypes.getSelectedItemValue();if(v===microstrategy.APPLIED_THEME_CUSTOM){this.set("appliedThemeType",v);this.set("appliedThemeID",null);this.set("showAppliedThemeAsType",true);this.set("showCustomThemePicker",true);}else{if(v===microstrategy.APPLIED_THEME_NONE){this.set("appliedThemeType",v);this.set("appliedThemeID",null);this.set("showAppliedThemeAsType",false);this.set("showCustomThemePicker",false);}else{this.set("appliedThemeType",microstrategy.APPLIED_THEME_DEFAULT);this.set("appliedThemeID",v);this.set("showAppliedThemeAsType",true);this.set("showCustomThemePicker",false);}}};THE.prototype._handleAppliedThemeAsTypeChange=function THE_handleAppliedThemeTypeAsChange(evt){if(this.translating){return ;}var thmAsTypes=this.get("appliedThemeAsTypes"),v=thmAsTypes.getSelectedItemValue();this.set("appliedThemeAsLink",v==="0"?false:true);};THE.prototype.onModelPropertyChange=function THE_onModelPropertyChange(evt){mstr.bones.editors.BoneTranslator.prototype.onModelPropertyChange.apply(this,[evt]);if(this.get("appliedThemeTypes")==evt.src&&evt.name=="hashadd_selectedIndices"){this._handleAppliedThemeTypeChange(evt);}else{if(this.get("appliedThemeAsTypes")==evt.src&&evt.name=="hashadd_selectedIndices"){this._handleAppliedThemeAsTypeChange(evt);}}};THE.prototype.execBrowseTheme=function THE_browseTheme(evt){var viewerBone=microstrategy.getViewerBone(),folderId=viewerBone.saveFolderId?viewerBone.saveFolderId:viewerBone.parentFolderID,me=this;microstrategy.showApplyThemeEditor(false,null,function(thmID,applyAsLink,currentThemePath){me.set("appliedThemeID",thmID);me.set("appliedThemePath",encode(currentThemePath));});};return THE;})();mstr.bones.editors.DocAdvancedBoneTranslator=(function(){mstr.$O.extendsClass(DABT,mstr.bones.editors.BoneTranslator);DABT.prototype._storeDeltaProp=function DABT_storeDeltaProp(n,v){mstr.bones.editors.BoneTranslator.prototype._storeDeltaProp.apply(this,arguments);if(n=="RefreshDocument"&&v){var p="RefreshFrequency";this._storeDeltaProp(p,this.get(p));}};function DABT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return DABT;})();mstr.bones.editors.DocMobileBoneTranslator=(function(){mstr.$O.extendsClass(DMBT,mstr.bones.editors.BoneTranslator);DMBT.prototype.set=function DMBT_set(n,v){mstr.bones.editors.BoneTranslator.prototype.set.apply(this,[n,v]);};function DMBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return DMBT;})();mstr.bones.editors.PageSetupPageBoneTranslator=(function(){mstr.$O.extendsClass(PSP,mstr.bones.editors.BoneTranslator);PSP.prototype.init=function PSP_init(){mstr.bones.editors.BoneTranslator.prototype.init.apply(this);this.attachEventListener(this,"set_PageWidth","_handlePaperSizeChange");this.attachEventListener(this,"set_PageHeight","_handlePaperSizeChange");this.attachEventListener(this,"set_ScalePercentage","_handleScalingChange");this.attachEventListener(this,"set_ScalePagesWide","_handleScalingChange");this.attachEventListener(this,"set_ScalePagesTall","_handleScalingChange");};PSP.prototype._handlePaperSizeChange=function PSP__handlePaperSizeChange(evt){if(this.translating||this.changingPaperSize){return ;}if(evt.name=="hashremove_selectedIndices"){return ;}this.changingPaperSize=true;var h,w,v,min,max;var pt=this.get("PaperType");var o=this.get("PaperOrientation");var src=evt.src;if(src==this){h=parseFloat(microstrategy.number.toUSUnits(this.get("PageHeight"),true),10);w=parseFloat(microstrategy.number.toUSUnits(this.get("PageWidth"),true),10);v=o.getSelectedIndex();if(v==0&&w>h){o.execSingleSelect(1);}else{if(v==1&&h>w){o.execSingleSelect(0);}}min=Math.min(h,w);max=Math.max(h,w);if(!pt.execSelectString(".*,"+min+","+max,pt.get("valueForm"))){pt.execClearSelect();}}else{if(src==pt){var v=pt.getSelectedItemValue().split(",").slice(1);var fields=["PageWidth","PageHeight"];if(o.getSelectedIndex()!=0){fields.reverse();}for(var i=0;i<v.length;i++){this.set(fields[i],microstrategy.number.toUserUnits(v[i]));}}else{h=parseFloat(microstrategy.number.toUSUnits(this.get("PageHeight")),10);w=parseFloat(microstrategy.number.toUSUnits(this.get("PageWidth")),10);min=Math.min(h,w);max=Math.max(h,w);min=microstrategy.number.toUserUnits(min);max=microstrategy.number.toUserUnits(max);v=o.getSelectedIndex();if(v==0){if(h!=max){this.set("PageHeight",max);this.set("PageWidth",min);}}else{if(h!=min){this.set("PageHeight",min);this.set("PageWidth",max);}}}}this.changingPaperSize=false;};PSP.prototype.onModelPropertyChange=function PSP_onModelPropertyChange(evt){mstr.bones.editors.BoneTranslator.prototype.onModelPropertyChange.apply(this,[evt]);if(evt.src==this.get("PaperType")||evt.src==this.get("PaperOrientation")){this._handlePaperSizeChange(evt);}};PSP.prototype._handleScalingChange=function PSP__handleScalingChange(evt){if(this.translating||this.changingScale){return ;}this.changingScale=true;var s=this.get("Scaling");var v=s.getSelectedIndex();if(evt.name=="set_ScalePercentage"){if(v!=0){s.execSingleSelect(0);}}else{if(v!=1){s.execSingleSelect(1);}}this.changingScale=false;};function PSP(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return PSP;})();mstr.bones.editors.ButtonPropertiesBoneTranslator=(function(){mstr.$O.extendsClass(BBT,mstr.bones.editors.BoneTranslator);BBT.prototype.on_set_DisplayStyle=function BBT_on_set_DisplayStyle(evt){var value=evt.memo.value;this._onSetDisplayStyle(value);this.get("parent").notifyPropertyChange("ButtonDisplayStyle",evt);};BBT.prototype._onSetDisplayStyle=function BBT_onSetDisplayStyle(value){value=Number(value);var me=this;function fnSetURLEnable(enable){me.set("normalURLEnable",enable);me.set("highlightURLEnable",enable);}switch(value){case microstrategy.BUTTON_STYLE_CAPTION_ONLY:fnSetURLEnable(false);break;case microstrategy.BUTTON_STYLE_ICON_ONLY:case microstrategy.BUTTON_STYLE_ICON_LEFT:case microstrategy.BUTTON_STYLE_ICON_RIGHT:case microstrategy.BUTTON_STYLE_ICON_TOP:case microstrategy.BUTTON_STYLE_CUSTOM:fnSetURLEnable(true);break;}if(this.get("isInsideNavBar")){this.set("highlightURLEnable",false);}};BBT.prototype.translateBone=function BBT_translateBone(){mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);this.translating=true;displayStyleValue=this.get("DisplayStyle").getSelectedItemValue();this._onSetDisplayStyle(displayStyleValue);this.translating=false;};function BBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return BBT;})();mstr.bones.editors.DocumentTabBoneTranslator=(function(){mstr.$O.extendsClass(DTBT,mstr.bones.editors.BoneTranslator);DTBT.prototype.on_set_ExecutionFullScreenMode=function DTBT__on_set_ExecutionFullScreenMode(evt){if(evt.memo.value){this.set("ShowingBarsTemporarily",true);}};DTBT.prototype.on_set_DefaultViewMode=function DTBT__on_set_DefaultViewMode(evt){var m=this.get("DefaultViewMode");var key=mstr.utils.Hash.firstKey(evt.memo.valueWas);var v=m.getItems()[key][m.get("valueForm")];switch(evt.memo.src){case"hashremove_selectedIndices":this.cache={};this.cache[v]=true;break;case"hashadd_selectedIndices":this.cache[v]=false;this.changingRunMode=true;var avm=this.get("AvailableViewModes");var aem=this.get("AvailableExportModes");var avmSel=avm.getSelectedItems();var aemSel=aem.getSelectedItems();avm.execEnableIndices(this.cache);aem.execEnableIndices(this.cache);var f=function(m,mSel,cache){var mSel2=m.getSelectedItems();outer:for(f1 in mSel2){if(cache[mSel2[f1].dssid]!=undefined){continue;}for(f2 in mSel){if(mSel[f2].dssid==mSel2[f1].dssid){continue outer;}}var index=m.indexOfItem(mSel2[f1]);m.execRemoveSelect(index);}};f(aem,aemSel,this.cache);f(avm,avmSel,this.cache);this.changingRunMode=false;if(!this._selectDefaultRunMode(avm,v)){this._selectDefaultRunMode(aem,v);}break;}};DTBT.prototype._selectDefaultRunMode=function DTBT__selectDefaultRunMode(m,v){var index=m.indexOfValue(v);if(index==-1){return false;}var indices=m.getSelectedIndices();if(!(index in indices)){m.execAddSelect(index);}return true;};DTBT.prototype.onModelPropertyChange=function DTBT_onModelPropertyChange(evt){if(this.changingRunMode){return ;}mstr.bones.editors.BoneTranslator.prototype.onModelPropertyChange.apply(this,[evt]);};function DTBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return DTBT;})();mstr.bones.editors.WidgetBoneTranslator=(function(){mstr.$O.extendsClass(WBT,mstr.bones.editors.BoneTranslator);WBT.prototype.execOpenWidgets=function WBT_OpenWidgets(target){var x=getObjSumLeft(target),y=getObjSumTop(target)+getObjHeight(target),elem;microstrategy.openBlockLoaderEditor("addWidgetMenu","InsertMenuBlockLoader",null,{cssText:"position:absolute;top:"+y+"px;left:"+x+"px;z-index:"+mstr.views.FloatingMenuBook.prototype.getZIndex()+";",useFixedPosition:"false",contextMenuName:"insertWidgetEditor",viewer:"#widgetBoneTranslator"},this,null,elem);};WBT.prototype.execOpenVisPropsEditor=function WBT_OpenVisPropsEditor(target){var vwr=microstrategy.getViewerBone();if(vwr){var lst=vwr.gridWidgets.lst;var wgt=lst[this.props.widgetId];if(wgt&&wgt.edt){var oGrid=vwr.doc.selections.getSelectedGrid();if(oGrid){var gBone=microstrategy.findBone(oGrid);if(gBone){if(this.isMojoVis(wgt.edt)){if(this.props.hasChanges){var pbtm=this.props.parent.props.parent.props.models[0];pbtm.execPreviewChanges();}return gBone.docViewer.commands.exec("mojoVisPropsEditor",wgt.edt);}var scp=microstrategy.VIS_EDITOR_SCOPE_RW_GRID;var args=[scp,wgt.edt,""];args.push(this.props.WidgetProps||"");var dft=this.deltaProps["default"];var sdp=(dft&&dft.SecondaryDataProviders)?dft.SecondaryDataProviders:this.props.SecondaryDataProvidersValue;args.push(sdp||"");gBone.commands.exec("visPropsEditor",args);}}}}};WBT.prototype.commands={getTranslator:function(){if(!this.t){this.t=mstr.$obj("widgetBoneTranslator");}return this.t;},queryEnabled:function(){return true;},queryVisible:function(){return true;},queryState:function(){return true;},exec:function(cmdId){var t=this.getTranslator();var v=cmdId.split(";")[1];t.set("widgetId",v);}};WBT.prototype.on_set_widgetId=function WBT_on_set_widgetId(evt){var v=evt.memo.value;this.set("ADisplayEnabled",v!="");this.updateWidgetInfo(v);};WBT.prototype.updateWidgetInfo=function WBT_updateWidgetInfo(selWgtId){var wgt=this.getWidgetObj(selWgtId);if(wgt){var vwr=microstrategy.getViewerBone();this.setupSecondaryDataProviders(wgt);this.set("widgetName",wgt.t);this.set("FlashDisplayEnabled",!!wgt.wgt);this.set("DHTMLDisplayEnabled",!!wgt.vis);this.set("iPhoneDisplayEnabled",!!wgt.iphVis);this.set("iPadDisplayEnabled",!!wgt.ipadVis);this.updateIPhoneFullscreen();this.set("AndroidDisplayEnabled",!!wgt.aVis);this.set("AndroidTabletDisplayEnabled",!!wgt.atVis);this.set("AndroidDisplayFullScreenEnabled",!!this.props.AndroidDisplayEnabled&&vwr.isMultiLayout);if(!this.translating){this.sureBoolSet("FlashDisplay",!!this.props.FlashDisplayEnabled);this.sureBoolSet("DHTMLDisplay",!!this.props.DHTMLDisplayEnabled&&wgt.vis.vm!=50);this.sureBoolSet("iPhoneDisplay",!!this.props.iPhoneDisplayEnabled);this.sureBoolSet("iPhoneDisplayFullScreen",!!this.props.iPhoneDisplayEnabled);this.sureBoolSet("iPadDisplay",!!this.props.iPadDisplayEnabled);this.sureBoolSet("AndroidDisplay",!!this.props.AndroidDisplayEnabled);this.sureBoolSet("AndroidTabletDisplay",!!this.props.AndroidTabletDisplayEnabled);this.sureBoolSet("AndroidDisplayFullScreen",!!this.props.AndroidDisplayEnabled);this.set("WidgetProps","");}else{var wgtOnGrid=vwr.commands.queryState("setWidget");if(wgtOnGrid&&wgtOnGrid!="None"){var vwr=microstrategy.getViewerBone(),lst=!!vwr&&vwr.gridWidgets&&vwr.gridWidgets.lst;for(var i in lst){var w=lst[i];if(w.wgt&&(w.wgt.rsl==wgtOnGrid||w.wgt.cn==wgtOnGrid)){this.set("FlashDisplay",selWgtId==i);break;}}}var oGrid=vwr.doc.selections.getSelectedGrid();if(oGrid){var gBone=microstrategy.findBone(oGrid);if(gBone){this.set("DHTMLDisplay",wgt.vis&&wgt.vis.s==gBone.selectedVisualization&&gBone.isVisualization);this.set("iPadDisplay",wgt.ipadVis&&wgt.ipadVis.s==gBone.iPadVis);}}var isLayoutIPhoneVis=wgt.iphVis&&wgt.iphVis.s==vwr.iPhoneVis;var isGridIPhoneVis=wgt.iphVis&&wgt.iphVis.s==gBone.iPhoneVis;this.set("iPhoneDisplay",isLayoutIPhoneVis||isGridIPhoneVis);this.set("iPhoneDisplayFullScreen",isLayoutIPhoneVis);var isLayoutAVis=wgt.aVis&&wgt.aVis.s==vwr.aVis;var isGridAVis=wgt.aVis&&wgt.aVis.s==gBone.aVis;this.set("AndroidDisplay",isLayoutAVis||isGridAVis);if(vwr.aVis){this._storeDeltaProp("AndroidDisplay",true);}var isATVis=wgt.atVis&&wgt.atVis.s==gBone.atVis;this.set("AndroidTabletDisplay",isATVis);}this.set("OpenVisPropsEditor",wgt.edt);}else{this.props.NonFlashRender.execSelectValue(0);this.set("widgetName",microstrategy.descriptors.getDescriptor(181));this.sureBoolSet("FlashDisplayEnabled",false);this.sureBoolSet("DHTMLDisplayEnabled",false);this.sureBoolSet("iPhoneDisplayEnabled",false);this.sureBoolSet("iPadDisplayEnabled",false);this.sureBoolSet("AndroidDisplayEnabled",false);this.sureBoolSet("AndroidTabletDisplayEnabled",false);this.sureBoolSet("FlashDisplay",false);this.sureBoolSet("DHTMLDisplay",false);this.sureBoolSet("iPadDisplay",false);this.sureBoolSet("AndroidDisplay",false);this.sureBoolSet("AndroidTabletDisplay",false);this.sureBoolSet("iPhoneDisplay",false);this.sureBoolSet("iPhoneDisplayFullScreen",false);this.sureBoolSet("AndroidDisplayFullScreen",false);}this.updateLabelsForAltDisplay();this.updateFlashDisplayLabel();this.updateIPhoneDisplayLabel();this.updateIPadDisplayLabel();this.updateAndroidDisplayLabel();this.updateAndroidTabletDisplayLabel();};WBT.prototype.sureBoolSet=function WBT_sureBoolSet(n,v){if(v==this.props[n]){this.props[n]=!v;}this.set(n,v);};WBT.prototype.setupSecondaryDataProviders=function WBT_setupSecondaryDataProviders(wgt){if(!wgt){wgt=this.getWidgetObj(this.props.widgetId);}if(!wgt){this.set("showSecondaryDataProviders",false);return ;}if((!!this.props.FlashDisplay||!!this.props.DHTMLDisplay||!!this.props.iPadDisplay||!!this.props.AndroidDisplay||!!this.props.AndroidTabletDisplay||!!this.props.iPhoneDisplay)&&(wgt.smn>0||wgt.smx>0)){this.set("showSecondaryDataProviders",true);this.validateSecondaryDataProviders();}else{this.set("showSecondaryDataProviders",false);if(!this.translating){this.get("parent").set("enableOk",true);this.get("parent").set("enablePreview",true);}}};WBT.prototype.validateSecondaryDataProviders=function WBT_validateSecondaryDataProviders(evt){var sd=this.get("SecondaryDataProviders"),dp=sd&&sd.get("selected").get("items").length,wgt=this.getWidgetObj(this.get("widgetId"));if(!wgt){return ;}if(dp<wgt.smn||dp>wgt.smx){this.get("parent").set("enableOk",false);this.get("parent").set("enablePreview",false);}else{this.get("parent").set("enableOk",true);this.get("parent").set("enablePreview",true);}};WBT.prototype.on_set_SecondaryDataProviders=function WBT_on_set_SecondaryDataProviders(evt){this.validateSecondaryDataProviders();};WBT.prototype.on_set_FlashDisplay=function WBT_on_set_FlashDisplay(evt){this.setupSecondaryDataProviders();this.updateFlashDisplayLabel();};WBT.prototype.updateFlashDisplayLabel=function WBT_updateFlashDisplayLabel(){this.set("FlashDisplayLabel",!!this.props.FlashDisplay?this.props.widgetName:microstrategy.descriptors.getDescriptor(7759));};WBT.prototype.on_set_DHTMLDisplay=function WBT_on_set_DHTMLDisplay(evt){this.setupSecondaryDataProviders();this.set("DHTMLDisplayLabel",evt.memo.value?this.props.widgetName:this.props.PDFExcelDisplayLabel);};WBT.prototype.on_set_iPhoneDisplay=function WBT_on_set_iPhoneDisplay(evt){this.setupSecondaryDataProviders();this.updateIPhoneDisplayLabel();};WBT.prototype.on_set_iPhoneDisplayFullScreen=function WBT_on_set_iPhoneDisplayFullScreen(evt){this.sureBoolSet("iPhoneDisplay",!!this.props.iPhoneDisplay);};WBT.prototype.updateIPhoneDisplayLabel=function WBT_updateIPhoneDisplayLabel(){this.set("iPhoneDisplayLabel",!!this.props.iPhoneDisplay?this.props.widgetName:microstrategy.descriptors.getDescriptor(7759));};WBT.prototype.updateIPhoneFullscreen=function WBT_updateIPhoneFullscreen(){this.set("iPhoneDisplayFullScreenEnabled",!!this.props.iPhoneDisplay&&!!this.props.iPhoneDisplayEnabled&&microstrategy.getViewerBone().isMultiLayout);};WBT.prototype.on_set_iPadDisplay=function WBT_on_set_iPadDisplay(evt){this.setupSecondaryDataProviders();this.updateIPadDisplayLabel();};WBT.prototype.updateIPadDisplayLabel=function WBT_updateIPadDisplayLabel(){this.set("iPadDisplayLabel",!!this.props.iPadDisplay?this.props.widgetName:microstrategy.descriptors.getDescriptor(7759));};WBT.prototype.on_set_AndroidDisplay=function WBT_on_set_AndroidDisplay(evt){this.setupSecondaryDataProviders();this.updateAndroidDisplayLabel();};WBT.prototype.on_set_AndroidTabletDisplay=function WBT_on_set_AndroidTabletDisplay(evt){this.setupSecondaryDataProviders();this.updateAndroidTabletDisplayLabel();};WBT.prototype.on_set_AndroidDisplayFullScreen=function WBT_on_set_AndroidDisplayFullScreen(evt){this.sureBoolSet("AndroidDisplay",!!this.props.AndroidDisplay);};WBT.prototype.on_set_mojoVisPropsChanged=function WBT_on_set_mojoVisPropsChanged(evt){if(evt.memo.value){this.setupSecondaryDataProviders();}};WBT.prototype.updateAndroidDisplayLabel=function WBT_updateAndroidDisplayLabel(){this.set("AndroidDisplayLabel",!!this.props.AndroidDisplay?this.props.widgetName:microstrategy.descriptors.getDescriptor(7759));};WBT.prototype.updateAndroidTabletDisplayLabel=function WBT_updateAndroidTabletDisplayLabel(){this.set("AndroidTabletDisplayLabel",!!this.props.AndroidTabletDisplay?this.props.widgetName:microstrategy.descriptors.getDescriptor(7759));};WBT.prototype.on_set_NonFlashRender=function WBT_on_set_NonFlashRender(evt){this.updateLabelsForAltDisplay();};WBT.prototype.updateLabelsForAltDisplay=function WBT_updateLabelsForAltDisplay(){this.set("PDFExcelDisplayLabel",this.getAltDisplayLabel(this.props.NonFlashRender.props.selectedIndicesList));this.set("DHTMLDisplayLabel",!!this.props.DHTMLDisplay?this.props.widgetName:this.props.PDFExcelDisplayLabel);};WBT.prototype.getAltDisplayLabel=function WBT_getAltDisplayLabel(v){var id=7759;if(v=="1"){id=7760;}else{if(v=="2"){id=7761;}}return microstrategy.descriptors.getDescriptor(id);};WBT.prototype.getWidgetObj=function WBT_getSelectedWidget(selWgtId){var vwr=microstrategy.getViewerBone(),lst=!!vwr&&vwr.gridWidgets&&vwr.gridWidgets.lst;return !!lst&&lst[selWgtId];};WBT.prototype.isMojoVis=function WBT_isMojoVis(edt){return["GraphMatrixVisualizationStyle","VIHeatMapVisualizationStyle","NetworkVisualizationStyle"].indexOf(edt)>-1;};WBT.prototype.onModelPropertyChange=function WBT_onModelPropertyChange(evt){mstr.bones.editors.BoneTranslator.prototype.onModelPropertyChange.apply(this,[evt]);this.validateSecondaryDataProviders(evt);};WBT.prototype.translateBone=function WBT_translateBone(){this.props.widgetId="-1";mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);};function WBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return WBT;})();mstr.bones.editors.OnlineBoneTranslator=(function(){mstr.$O.extendsClass(OBT,mstr.bones.editors.BoneTranslator);OBT.prototype.init=function OBT_init(){mstr.bones.editors.BoneTranslator.prototype.init.apply(this);if(!this.get("boneModel")){return ;}var btm=this.props.parent;if(btm){var target=mstr.$obj(btm.props.boneId);if(target&&target.observer){target.observer.register(this.get("id"));}}};OBT.prototype.onselectionchange=function(){this.translateBone();};OBT.prototype.translateBone=function OBT_translateBone(){var boneModel=this.get("boneModel");var enabledField=this.props.enabledField;if(enabledField!=null&&enabledField.length>0){var newStatus=boneModel.commands.queryEnabled(enabledField);if(newStatus!=this.props[enabledField]){this.set(enabledField,newStatus);}if(!this.props[enabledField]){return ;}}mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);};OBT.prototype.on_set_fontTabEnabled=function OBT_on_set_enabled(evt){var fields=this.props.fields;var blocksToChange=fields&&fields.length>0?fields.split("|"):[];var blockName;for(var index=0;index<blocksToChange.length;index++){blockName=blocksToChange[index];if(!blockName||!blockName.length>0){continue;}this.props[blockName]&&this.props[blockName].set&&this.props[blockName].set(evt.memo.name,evt.memo.value);}};OBT.prototype._storeDeltaProp=function OBT_flush(n,v){this.exec(n,v);};OBT.prototype.exec=function OBT_exec(n,v){var btm=this.props.parent;if(btm){var target=mstr.$obj(btm.props.boneId);if(target){var propertyChanges=[{obj:null,cmdId:n,value:v,memo:{},performFormatChange:true,submitUpdateManager:false}];if(!(target.commands.exec(btm.props.boneCmdId,propertyChanges))){return false;}}}};function OBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return OBT;})();mstr.bones.editors.TOCPageBoneTranslator=(function(){mstr.$O.extendsClass(TOCP,mstr.bones.editors.BoneTranslator);TOCP.prototype._resolveTOCTitleSet=function _resolveTOCTitleSet(src){if(src&&src.props&&src.props.selectedCount&&src.props.selectedCount==1&&src.props.selectedIndicesList){if(src.props.selectedIndicesList=="0"||src.props.selectedIndicesList==""){this.set("TOCBorderStyleEnable",false);}else{this.set("TOCBorderStyleEnable",true);}}};TOCP.prototype.onModelPropertyChange=function TOCP_onModelPropertyChange(evt){mstr.bones.editors.BoneTranslator.prototype.onModelPropertyChange.apply(this,[evt]);if(evt.src==this.get("TOCBorderStyle")){this._resolveTOCTitleSet(evt.src);}};TOCP.prototype.set=function BT_set(n,v){mstr.bones.editors.BoneTranslator.prototype.set.apply(this,[n,v]);if(n=="EnableToc"||n=="TOCTitleEnableInherit"){var enableTOC=this.get("EnableToc");var enableInherit=this.get("TOCTitleEnableInherit");if(enableTOC&&!enableInherit){this.set("TOCTitleSetEnable",true);}else{this.set("TOCTitleSetEnable",false);}}if(n=="EnableToc"){this._resolveTOCTitleSet(this.get("TOCBorderStyle"));}};function TOCP(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return TOCP;})();mstr.bones.editors.SelectorPageBoneTranslator=(function(){mstr.$O.extendsClass(SP,mstr.bones.editors.BoneTranslator);SP.prototype.init=function SP_init(){mstr.bones.editors.BoneTranslator.prototype.init.apply(this);this.attachEventListener(this,"openPopup","_handleOpenPopup");};SP.prototype.reinitializeModel=function SP_reinitializeModel(){mstr.bones.editors.BoneTranslator.prototype.reinitializeModel.apply(this);if(this.get(this.props.visibleField)){this._resolveUCLogic();}this._resolveStateEnabled();var attrFormSelectedIndex=null;var attrFormSelectedItems=null;var t=this.translating;this.translating=true;this._resolveDelimiterSelected();this._resolveAttrFormSelected();this._resolveAttrFormEnabled();this.translating=t;};SP.prototype._resolveDelimiterSelected=function SP_resolveDelimiterSelected(){if(!this.get("EditSelectorSource")){return ;}var delimiterListView=this.get("showFormDelimiters");if(this.get("EditSelectorSource").getSelectedIndex()==0){delimiterListView.execSingleSelect(0);}else{var delimiter=this.get("EditFormDelimiter");if(delimiter==" "){delimiter="SPACE";}delimiterListView.execSelectValue(delimiter)||delimiterListView.execSingleSelect(4);}};SP.prototype._resolveAttrFormSelected=function SP__resolveAttrFormSelected(){if(!this.get("EditSelectorSource")){return ;}var displayFormList=this.get("displayForms");if(this.get("EditSelectorSource").getSelectedIndex()==0){this.updateDisplayFormList(null);displayFormList.execSingleSelect(0);this.attrFormSelectedIndex=0;this.attrFormSelectedItems=null;}else{var displayForm=this.get("EditDisplayForm");if(displayForm==mstr.Enum.AttrFormSelector.CUSTOM){var items=this.get("selectedAttrForms");this.updateDisplayFormList(items);this.checkAvailabilityAndSelect(items);this.attrFormSelectedIndex=1;this.attrFormSelectedItems=items;}else{this.updateDisplayFormList(null);displayFormList.execSingleSelect(0);this.attrFormSelectedIndex=0;this.attrFormSelectedItems=null;}}};SP.prototype._resolveAttrFormEnabled=function SP__resolveAttrFormEnabled(){if(!this.get("EditSelectorSource")){return ;}this.set("displayFormsEnable",true);var selectIndex=this.get("EditSelectorSource").getSelectedIndex();if(selectIndex<0){return ;}if(selectIndex==0){this.set("displayFormsEnable",false);}else{var itemType=this.getBone().commands.queryState("documentAttributesType")[selectIndex];if(!itemType){return ;}var srcTy=itemType.type.split("|")[0];var srcSty=itemType.type.split("|")[1];if(srcTy&&(srcTy==microstrategy.DSSTYPE_CONSOLIDATION||(srcTy==microstrategy.DSSTYPE_FILTER&&srcSty==microstrategy.DSSTYPE_CUSTOM_GROUP))){this.set("displayFormsEnable",false);}else{this.set("displayFormsEnable",true);}}};SP.prototype._initializeDynamicModel=function SP_initializeDynamicModel(propertyName,model,source){if(propertyName=="selectedAttrForms"){this._setDynamicModelValues(propertyName,model,source);this.set("afCartModel",model);var s=model.get("selected");s.attachEventListener(this,"listadd_items","onOkEnabledChange");s.attachEventListener(this,"listremove_items","onOkEnabledChange");this.set("okBtnEnable",!!(model&&model.props&&model.props.selected&&model.props.selected.getItems().length>0));}else{if(propertyName=="sortAttrForm"){this._setDynamicModelValues(propertyName,model,source);this.set("afListModel",model);model.attachEventListener(this,"hashadd_selectedIndices","onModelPropertyChange");this._resolveSortType();}else{mstr.bones.editors.BoneTranslator.prototype._initializeDynamicModel.apply(this,[propertyName,model,source]);if(propertyName=="EditSelectorTargets"){var t=this.translating;this.translating=true;this._resolveUCLogic();this.translating=t;}if(propertyName=="selectorCurrentState"){var t=this.translating;this.translating=true;this._resolveCountEnabled();this._resolveStateEnabled();this._resolveAllEnabled();this.translating=t;}if(propertyName=="EditSelectorSource"){var t=this.translating;this.translating=true;this._resolveDelimiterSelected();this._resolveAttrFormSelected();this._resolveAttrFormEnabled();this.translating=t;}}}};SP.prototype.checkAvailabilityAndSelect=function checkAvailabilityAndSelect(selectedItems){if(this.availAttrForms==null){this.availAttrForms={};}var currAttr=this.get("EditSelectorSource")&&this.get("EditSelectorSource").getSelectedItemValue();if(currAttr){var attrId=currAttr.split("|")[0];if(this.availAttrForms[attrId]==null){var me=this;var cb={success:function(res){var items=[];var hashForExist={};for(var i in res.objects){var o=res.objects[i];var dssid=o.did+"|"+o.t+"|"+o.n;items.push({dssid:dssid,n:o.n});hashForExist[dssid]=true;}me.availAttrForms[attrId]=items;var filteredItems=[];for(var i in selectedItems){if(hashForExist[selectedItems[i].dssid]){filteredItems.push(selectedItems[i]);}}var t=me.translating;me.translating=true;me.updateDisplayFormList(filteredItems);me.translating=t;},failure:function(res){me.updateDisplayFormList([]);}},params={taskId:"getWSAttributeForms",attributeID:attrId,objectType:55,msgID:this.getBone().messageID};mstr.$XHR.request(mstrConfig.taskURL,params,cb);}}};SP.prototype._getAvailableSortForm=function SP_getAvailableSortForm(value,items){if(!value||!items){return undefined;}var selectedID=value.split("|")[0],len=items.length,currItemDssid;for(var i=0;i<len;i++){currItemDssid=items[i].dssid;if(selectedID==currItemDssid.split("|")[0]){return currItemDssid;}}return undefined;};SP.prototype._setDynamicModelValues=function BT_setDynamicModelValues(propertyName,model,source){if(source=="availAttrFormsList"||source=="availAttrFormsCart"){if(this.availAttrForms==null){this.availAttrForms={};}var currAttr=this.get("EditSelectorSource")&&this.get("EditSelectorSource").getSelectedItemValue();if(currAttr){var attrId=currAttr.split("|")[0];if(this.availAttrForms[attrId]==null){return ;}else{if(source=="availAttrFormsList"){this._setDynamicListModelValues(model,this.availAttrForms[attrId],propertyName);}else{this._setDynamicCartModelValues(model,this.availAttrForms[attrId],propertyName);}}}}else{mstr.bones.editors.BoneTranslator.prototype._setDynamicModelValues.apply(this,[propertyName,model,source]);}};SP.prototype._setDynamicListModelValues=function SP_setDynamicListModelValues(model,items,propertyName){if(propertyName=="sortAttrForm"){var defaultOpt=microstrategy.descriptors.getDescriptor("959"),selectedItem=this.get(propertyName)||this.getBone().commands.queryState(propertyName),value=selectedItem.dssid,items,defaultSort=mstr.Enum.AttrFormSelector.DEFAULT_SORT;if(value){value=this._getAvailableSortForm(value,items)||defaultSort;}else{value=defaultSort;}items=items&&[{dssid:defaultSort,n:defaultOpt}].concat(items);}else{var value=this.getBone().commands.queryState(propertyName);}if(propertyName=="EditSelectorSource"){var isSearchBox=mstr.bones.editors.LayoutPropertiesBoneTranslator.prototype.isSearchBox(this);if(isSearchBox){items=this.getBone().commands.queryState("documentPureAttributes");}}var isAQSelector=this.getBone().commands.queryState("isAQSelector");if(isAQSelector){items=this.getBone().commands.queryState("documentAttributesWithDateForm");}model.setItems(items);var fn=(mstr.$A.isArray(value))?"execSelectValues":"execSelectValue";var isValidSelect=model[fn](value);if(propertyName=="EditSelectorSource"&&!isValidSelect){model.execSingleSelect(0);}};SP.prototype._setDynamicCartModelValues=function SP_setDynamicCartModelValues(model,items,propertyName){model.get("available").setItems(items);if(propertyName=="selectedAttrForms"){var selectedItems=this.get(propertyName)||this.getBone().commands.queryState(propertyName);}else{var selectedItems=this.getBone().commands.queryState(propertyName);}model.get("selected").setItems(selectedItems);model._updateAvailableFilteredItems();};SP.prototype._resolveSelecotrSourceForUConDS=function _resolveSelecotrSourceForUConDS(props){if(props&&props.selectedCount==1){if(isNaN(props.selectedIndicesList)){return false;}var selectedIndex=parseInt(props.selectedIndicesList);if(props.items[selectedIndex]){var selectedItem=props.items[selectedIndex],itemType=-1,itemSubtype=selectedItem.sty;var src=selectedItem.dssid.split("|");if(src.length>2&&!isNaN(src[1])){itemType=parseInt(src[1]);}var dsChkBoxVisible=this.get("dsAsTgtChkVisible"),isDSAsTarget=this.get("isDSAsTarget"),editST=this.get("EditSelectorType"),st=editST.getSelectedItemValue();if(itemType===parseInt(microstrategy.DSSTYPE_ATTRIBUTE)&&itemSubtype!==microstrategy.DSSSUB_TYPE_DERIVED_ATTRIBUTE&&st!==mstrRWControlImpl.CTL_TYPE_ATTR_QUAL&&st!==mstrRWControlImpl.CTL_TYPE_ATTR_LIST){if(!dsChkBoxVisible){this.set("dsAsTgtChkVisible",true);}}else{if(isDSAsTarget){this.set("isDSAsTarget",false);}if(dsChkBoxVisible){this.set("dsAsTgtChkVisible",false);}}}}};SP.prototype._resolveEditSelectorTargetsCartList=function _resolveEditSelectorTargetsCartList(evt){var src=this.get("EditSelectorSource");if(!src||!src.getSelectedItem()){return ;}var olap=src.getSelectedItem().olap,sel=src&&src.getSelectedItem(),de=sel&&sel.de&&sel.sty!=12033;lastSelectedItem=src.getItems()[this.lastSelectedSourceIdx],lastde=lastSelectedItem&&lastSelectedItem.de&&lastSelectedItem.sty!=12003,lastOlap=lastSelectedItem&&lastSelectedItem.olap;if(olap&&!lastOlap||de&&!lastde){this._setDynamicModelValues("EditSelectorTargetsNoPlaceholder",this.get("EditSelectorTargets"),"availableTemplatesNoPlaceholder");}else{if(!olap&&lastOlap||!de&&lastde){this._setDynamicModelValues("EditSelectorTargets",this.get("EditSelectorTargets"),"availableTemplates");}}};SP.prototype._storeLastSelectedSourceIdx=function _storeLastSelectedSourceIdx(evt){if(evt&&evt.memo){this.lastSelectedSourceIdx=mstr.utils.Hash.firstKey(evt.memo.at);}};SP.prototype.onModelPropertyChange=function SP_onModelPropertyChange(evt){mstr.bones.editors.BoneTranslator.prototype.onModelPropertyChange.apply(this,[evt]);if(evt.src==this.get("EditSelectorType")){this._handleSelectorTypeChange();this.get("parent").notifyPropertyChange("EditSelectorType",evt);this._resolveUCLogic();this._resolveStateUCVisible();this._resolveCountEnabled();this._resolveStateEnabled();this._resolveAllEnabled();this._resolveGUIComponentsVisible();this._resolveCartListVisible();}else{if(evt.src==this.get("DataFilterMode")){this._resolveTotalAndAutoSynchEnabled();this._resolveCountEnabled();this._resolveStateUCVisible();this._resolveUpdateFilterTargetEnabled();}else{if(this.get("EditSelectorTargets")&&(evt.src==this.get("EditSelectorTargets").get("selected")||this.get("EditSelectorSource")==evt.src)){this._resolveUCLogic();if(this.get("EditSelectorSource")==evt.src){this._resolveAttrFormEnabled();this._resolveEditSelectorTargetsCartList(evt);this._storeLastSelectedSourceIdx(evt);}if(evt.name!="listremove_items"&&!this.translating){this._resolveDataFilterMode();}}else{if(this.get("EditSelectorTargets")&&(evt.src==this.get("EditSelectorTargets").get("selected")||this.get("EditSelectorSourceDDIC")==evt.src)){this._resolveUCLogic();if(evt.name!="listremove_items"&&!this.translating){this._resolveDataFilterMode();}}else{if(this.get("selectorCurrentState")==evt.src){this._resolveCountEnabled();}else{if(this.get("EditSelectorSelectionType")==evt.src){this._resolveAllEnabled();}else{if(this.get("showFormDelimiters")==evt.src&&evt.name=="hashadd_selectedIndices"){this._resolveDelimiter();}else{if(this.get("displayForms")==evt.src&&evt.name=="hashadd_selectedIndices"){this._resolveDisplayForm();}else{if(this.get("afListModel")==evt.src&&evt.name=="hashadd_selectedIndices"){this._resolveSortType();}}}}}}}}}if(this.get("EditSelectorSource")==evt.src&&evt.name=="hashadd_selectedIndices"){this._clearAttrFormSelector();this.get("parent").notifyPropertyChange("EditSelectorSource",evt);this._resolveSelecotrSourceForUConDS(evt.src.props);}};SP.prototype.set=function SP_set(n,v){mstr.bones.editors.BoneTranslator.prototype.set.apply(this,[n,v]);if(n=="isDSAsTarget"){var st=this.get("EditSelectorType");if(v){this.set("DataFilterVisible",false);this.set("attrLCVisible",false);this.set("metricLCVisible",false);this.set("datasetLCVisible",true);this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",false);this.set("selectorAutoSyncVisible",false);this.set("showTotalVisible",false);this.set("countVisible",false);this.set("selectionTypeVisible",false);this._moveSelectedBack("EditSelectorTargets");}else{if(st.getSelectedItemValue()==1){if(!this.getBone().commands.queryState("isMetricQualifier")){this.set("DataFilterVisible",true);}this.set("attrLCVisible",true);this.set("metricLCVisible",false);this.set("datasetLCVisible",false);this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",false);this.set("selectorAutoSyncVisible",true);var isDDIC=this.getBone().commands.queryState("isDDIC");this.set("showTotalVisible",!isDDIC);this.set("countVisible",!isDDIC);this.set("selectionTypeVisible",!isDDIC);this._moveSelectedBack("EditSelectorTargetsDataset");}}this._resolveStateUCVisible();}else{if(n=="Autowire"){this.set("showAutoWireMessage",v);}}};SP.prototype._moveSelectedBack=function _moveSelectedBack(cartName){var cartTree=this.get(cartName);if(cartTree){cartTree.execRemoveAll();}};SP.prototype._resolveStateUCVisible=function _resolveStateUCVisible(){var st=this.get("EditSelectorType")&&this.get("EditSelectorType").getSelectedItemValue();var filter=this.get("DataFilterMode");var filterValue=filter&&filter.getSelectedItemValue();var isDSTarget=this.get("isDSAsTarget");if(filterValue==null||filterValue==undefined){filterValue=this.getBone().commands.queryState("DataFilterMode");}if(filterValue=="1"||(st=="1"&&isDSTarget)){this.set("stateUCVisible",true);}else{this.set("stateUCVisible",false);}};SP.prototype._resolveGUIComponentsVisible=function _resolveGUIComponentsVisible(){var st=this.get("EditSelectorType")&&this.get("EditSelectorType").getSelectedItemValue();this.set("DataFilterVisible",true);this.set("selectionTypeVisible",false);this.set("showAdvanced",true);if(st==1){this.set("dsAsTgtChkVisible",true);var isDataset=this.get("isDSAsTarget");if(isDataset){this.set("attrLCVisible",false);this.set("metricLCVisible",false);this.set("datasetLCVisible",true);this.set("attrReplaceLCVisible",false);this.set("DataFilterVisible",false);this.set("submissionLCVisible",false);}else{this.set("attrLCVisible",true);this.set("metricLCVisible",false);this.set("datasetLCVisible",false);this.set("attrReplaceLCVisible",false);this.set("selectionTypeVisible",true);this.set("submissionLCVisible",false);}}else{if(st==2){this.set("dsAsTgtChkVisible",false);this.set("isDSAsTarget",false);this.set("attrLCVisible",false);this.set("metricLCVisible",true);this.set("datasetLCVisible",false);this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",false);}else{if(st==3){this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",false);}else{if(st==4){this.set("attrLCVisible",false);this.set("metricLCVisible",false);this.set("datasetLCVisible",false);this.set("DataFilterVisible",false);this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",true);}else{if(st==8){this.set("dsAsTgtChkVisible",false);this.set("isDSAsTarget",false);this.set("attrLCVisible",false);this.set("metricLCVisible",false);this.set("datasetLCVisible",false);this.set("attrReplaceLCVisible",true);this.set("DataFilterVisible",false);this.set("showAdvanced",false);this.set("submissionLCVisible",false);this.set("EditSelectorShowAll",false);this.set("EditSelectorMultiSelect",false);}}}}}this._resolveStateUCVisible();};SP.prototype._clearAttrFormSelector=function _clearAttrFormSelector(){if(!this.translating){this._clearPopupDelta();this.get("displayForms").execSingleSelect(0);this.get("showFormDelimiters").execSingleSelect(0);if(this.get("stRadioList")){this.get("stRadioList").execClearSelect();}}};SP.prototype._resolveSortType=function _resolveSortType(){if(this.translating){return ;}if(!this.get("stRadioList")){this.getSortTypeModel();}if(this.get("afListModel").getSelectedItemValue()==mstr.Enum.AttrFormSelector.DEFAULT_SORT){this.get("stRadioList").execClearSelect();this.set("SortTypeEnabled",false);}else{var curValue=this.get("sortType");this.get("stRadioList").execSelectValue(curValue);this.set("SortTypeEnabled",true);}};SP.prototype._resolveDisplayForm=function _resolveDisplayForm(){if(!this.translating){displayFormList=this.get("displayForms");if(!displayFormList){return ;}var afStyle=displayFormList.getSelectedItemValue();if(afStyle==mstr.Enum.AttrFormSelector.AUTOMATIC){if(displayFormList.props.items.length>2){this._removeCustom(displayFormList);}this.set("EditDisplayForm",afStyle);this.attrFormSelectedIndex=0;this.attrFormSelectedItems=null;}else{if(afStyle=="custom"){this.execTryOpenPopup("AttrFormsEditor","AttrFormsCartBlock","selectedAttrForms","availAttrFormsCart");this.set("EditDisplayForm",mstr.Enum.AttrFormSelector.CUSTOM);}}}};SP.prototype._clearPopupDelta=function _clearPopupDelta(){this.set("selectedAttrForms",[]);this.set("sortAttrForm",mstr.Enum.AttrFormSelector.DEFAULT_SORT);};SP.prototype.execTryOpenPopup=function _tryOpenPopUp(editorId,editorStyle,propertyName,source){if(this.availAttrForms==null){this.availAttrForms={};}var currAttr=this.get("EditSelectorSource")&&this.get("EditSelectorSource").getSelectedItemValue(),name=this.get("EditSelectorSource")&&this.get("EditSelectorSource").getSelectedItem().n;if(currAttr){var attrId=currAttr.split("|")[0],evtArgs=arguments;evtArgs.title=microstrategy.descriptors.getDescriptor("2890")+(name?" - "+name:"");if(this.availAttrForms[attrId]==null){var me=this;var cb={success:function(res){var items=[];for(var i in res.objects){var o=res.objects[i];items.push({dssid:o.did+"|"+o.t+"|"+o.n,n:o.n});}me.availAttrForms[attrId]=items;me.raiseEvent("openPopup",{args:evtArgs});},failure:function(res){showMessage({contents:res.getResponseHeader("X-MSTR-TaskFailureMsg"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});}},params={taskId:"getWSAttributeForms",attributeID:attrId,objectType:55,msgID:this.getBone().messageID};mstr.$XHR.request(mstrConfig.taskURL,params,cb);}else{this.raiseEvent("openPopup",{args:evtArgs});}}};SP.prototype._handleOpenPopup=function _handleOpenPopup(evt){args=evt&&evt.memo&&evt.memo.args;editorId=args[0],editorStyle=args[1],propertyName=args[2],source=args[3];microstrategy.openBlockLoaderEditor(editorId,editorStyle,{},{title:(args&&args.title)||""},this,null,null);if(propertyName=="selectedAttrForms"&&this.get("afCartModel")){this._setDynamicModelValues(propertyName,this.get("afCartModel"),source);}else{if(propertyName=="sortAttrForm"&&this.get("afListModel")){this._setDynamicModelValues(propertyName,this.get("afListModel"),source);mstr.$obj("tt").render();}}};SP.prototype.onOkEnabledChange=function SP_onOkEnabledChange(evt){model=evt&&evt.src;this.set("okBtnEnable",!!(model&&model.getItems().length>0));};SP.prototype.execSelectAttrForms=function SP_execSelectAttrForms(lcm){if(lcm&&lcm.get("selected")){var model=lcm.get("selected"),items=model.getItems();if(this.translating){return ;}this.updateDisplayFormList(items);items=items&&[].concat(items);this.set("selectedAttrForms",items);this.attrFormSelectedIndex=1;this.attrFormSelectedItems=items;}};SP.prototype.updateDisplayFormList=function SP_updateDisplayFormList(items){displayFormList=this.get("displayForms");if(displayFormList.get("items").length>2){this._removeCustom(displayFormList);}if(!items||items.length==0){displayFormList.execSingleSelect(0);return ;}this.set("selectedAttrForms",items);itemValue=items[0].n;for(i=1;i<items.length;i++){itemValue+=","+items[i].n;}var customDssid=mstr.Enum.AttrFormSelector.CUSTOM;displayFormList.insertItemsAt([{dssid:customDssid,n:itemValue}],2);displayFormList.execSingleSelect(2);};SP.prototype._removeCustom=function _removeCustom(displayFormList){this.set("selectedAttrForms",[]);displayFormList.removeItemsAt([2]);var formLPD=mstr.$obj("formLPD");if(formLPD&&formLPD.props.currentPopUp){formLPD.props.currentPopUp.props.scrollArea.children[0].style.width="200px";}};SP.prototype.execCancelSelectAttrForms=function SP_execCancelSelectAttrForms(){if(this.attrFormSelectedIndex==0){this.get("displayForms").execSingleSelect(0);return ;}else{if(this.attrFormSelectedIndex==1&&this.attrFormSelectedItems){this.updateDisplayFormList(this.attrFormSelectedItems);return ;}}this.get("displayForms").execSingleSelect(0);};SP.prototype.execSelectSortAttrForm=function _selectSortAttrForm(){if(this.translating){return ;}var attrForm=this.get("afListModel").getSelectedItem();var forkAttrForm=mstr.$H.clone(attrForm);forkAttrForm.attr=this.get("EditSelectorSource")&&this.get("EditSelectorSource").getSelectedItemValue();this.set("sortAttrForm",forkAttrForm);this.set("sortType","-1");this.set("sortType",this.get("stRadioList").getSelectedItemValue());};SP.prototype._resolveDelimiter=function _resolveDelimiter(){var delimiterListView=this.get("showFormDelimiters");var value=delimiterListView.getSelectedItemValue()||"";if(value=="OTHER"){var old=this.get("EditFormDelimiter");if(old==":"||old==";"||old==","||old==" "){old=":";}this.set("EditFormDelimiter",old);}else{if(value=="SPACE"){value=" ";}this.set("EditFormDelimiter",value);}};SP.prototype.getSortTypeModel=function _getSortTypeModel(){var m=this._createNewModel({scriptClass:"ListModel",parent:this,valueForm:"dssid"});var asc=microstrategy.descriptors.getDescriptor("1885"),desc=microstrategy.descriptors.getDescriptor("1886");m.setItems([{dssid:"1",n:asc},{dssid:"0",n:desc}]);this.set("stRadioList",m);return m;};SP.prototype._moveSelectedBack=function _moveSelectedBack(cartName){var cartTree=this.get(cartName);if(cartTree){cartTree.execRemoveAll();}};SP.prototype._resolveCartListVisible=function _resolveCartListVisible(){var st=this.get("EditSelectorType")&&this.get("EditSelectorType").getSelectedItemValue();this.set("DataFilterVisible",true);this.set("showAdvanced",true);if(st==1){var isDataset=this.get("isDSAsTarget");if(isDataset){this.set("attrLCVisible",false);this.set("metricLCVisible",false);this.set("datasetLCVisible",true);this.set("attrReplaceLCVisible",false);this.set("DataFilterVisible",false);this.set("submissionLCVisible",false);}else{this.set("attrLCVisible",true);this.set("metricLCVisible",false);this.set("datasetLCVisible",false);this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",false);}}else{if(st==2){this.set("attrLCVisible",false);this.set("metricLCVisible",true);this.set("datasetLCVisible",false);this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",false);}else{if(st==3){this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",false);}else{if(st==4){this.set("attrLCVisible",false);this.set("metricLCVisible",false);this.set("datasetLCVisible",false);this.set("DataFilterVisible",false);this.set("attrReplaceLCVisible",false);this.set("submissionLCVisible",true);}else{if(st==8){this.set("attrLCVisible",false);this.set("metricLCVisible",false);this.set("datasetLCVisible",false);this.set("attrReplaceLCVisible",true);this.set("DataFilterVisible",false);this.set("showAdvanced",false);this.set("submissionLCVisible",false);this.set("EditSelectorShowAll",false);this.set("EditSelectorMultiSelect",false);}}}}}};SP.prototype._resolveCountEnabled=function _resolveCountEnabled(){var st=this.get("EditSelectorType").getSelectedItemValue(),filter=this.get("DataFilterMode"),v=filter&&filter.getSelectedItemValue(),s=this.get("selectorCurrentState"),s=s&&s.getSelectedItemValue(),d=(s&&s!="-1");this.set("countEnabled",st=="1"&&d);this.set("nonMixed",(v!="-1"));};SP.prototype._resolveStateEnabled=function _resolveStateEnabled(){var st=this.get("EditSelectorType").getSelectedItemValue();this.set("stateEnabled",st=="1");};SP.prototype._resolveAllEnabled=function _resolveAllEnabled(){this._handleSelectorTypeChange();var st=this.get("EditSelectorType"),v=st.getSelectedItemValue(),allEnabled=v!=="3";if(allEnabled){st=this.get("EditSelectorSelectionType");v=st.getSelectedItemValue();allEnabled=v!=="0";}if(!allEnabled){this.set("EditSelectorShowAll",false);}this.set("OptionAllEnabled",allEnabled);};SP.prototype._handleSelectorTypeChange=function _handleSelectorTypeChange(){if(this.translating){return ;}var st=this.get("EditSelectorType"),v=st.getSelectedItemValue();switch(v){case"3":this.set("EditSelectorShowAll",false);case"2":this.set("EditSelectorShowTotal",false);break;}this._clearAttrFormSelector();};SP.prototype._resolveUCLogic=function _resolveUCLogic(){this._resolveDataFilterModeEnabled();this._resolveTotalAndAutoSynchEnabled();this._resolveUpdateFilterTargetEnabled();};SP.prototype._resolveDataFilterModeEnabled=function _resolveDataFilterModeEnabled(){var st=this.get("EditSelectorType");var src=this.props["EditSelectorSource"+(this.get("isMetricQualifier")?"Metrics":this.get("isDDIC")?"DDIC":"")];if(!src){return ;}var olap=src&&src.getSelectedItem()&&src.getSelectedItem().olap,sty=src&&src.getSelectedItem()&&src.getSelectedItem().sty;src=src&&src.getSelectedItemValue();src=src&&src.split("|");src=src&&src.length>2&&(src[1]==microstrategy.DSSTYPE_ATTRIBUTE||(src[1]==microstrategy.DSSTYPE_CONSOLIDATION&&sty=="12033"));var selItems=this.get("EditSelectorTargets").get("selected").props.items;var hasPh=false;for(var i=0;selItems&&i<selItems.length;i++){var item=selItems[i];if(item.dssid.indexOf("_")>-1){hasPh=true;break;}}this.set("DataFilterModeEnabled",(selItems&&selItems.length>0)&&(st.getSelectedItemValue()==1)&&!!src&&!olap&&!hasPh);};SP.prototype._resolveDataFilterMode=function _resolveDataFilterMode(){var selSrc=this.get("EditSelectorSource"),selItem=selSrc&&selSrc.getSelectedItem(),selItemValue=selSrc&&selSrc.getSelectedItemValue(),values=selItemValue&&selItemValue.split("|"),isCG=selItem&&selItem.sty===257,isConsol=values&&values.length>2&&values[1]==microstrategy.DSSTYPE_CONSOLIDATION&&selItem.sty===12032;var dfmModel=this.get("DataFilterMode"),dfmItems=dfmModel.getItems(),valueForm=dfmModel.get("valueForm");dfmModel.setItems(dfmItems.map(function(item){if(item[valueForm]==="-1"){if(isCG||isConsol){item.cssClass="Disabled";}else{delete item.cssClass;}}return item;}));this.get("DataFilterMode").execSelectValue((isCG||isConsol)?"-1":"1");};SP.prototype._resolveTotalAndAutoSynchEnabled=function _resolveTotalEnabled(){var filter=this.get("DataFilterMode");var v=filter&&filter.getSelectedItemValue();var dfe=this.get("DataFilterModeEnabled");var st=this.get("EditSelectorType")&&this.get("EditSelectorType").getSelectedItemValue();var isSearchBox=mstr.bones.editors.LayoutPropertiesBoneTranslator.prototype.isSearchBox(this);this.set("showTotalEnabled",(v=="0"||!dfe)&&st==1&&!isSearchBox);this.set("selectorAutoSyncEnabled",v=="0"||!dfe);if(!((v=="0"||!dfe)&&st==1)){this.set("EditSelectorShowTotal",false);}if(v!="0"&&dfe){this.set("EditSelectorAutoSync",false);}};SP.prototype._resolveUpdateFilterTargetEnabled=function _resolveUpdateFilterTargetEnabled(){var filter=this.get("DataFilterMode");var v=filter&&filter.getSelectedItemValue();var dfe=this.get("DataFilterModeEnabled");var st=this.get("EditSelectorType")&&this.get("EditSelectorType").getSelectedItemValue();this.set("updateFilterTargetEnabled",(v!="0"&&dfe)&&st==1);};SP.prototype.execSelectObject=function SP_openObjBrowser(item){this.set("runReportDocName",item[0].n);this.set("runReportDocId",item[0].dssid);this.set("runObjectType",item[0].tp);};SP.prototype.refreshForSearchBox=function SP_refreshForSearchBox(base,isSearchBox){base.set("showTotalEnabled",!isSearchBox);var srcm=base.get("EditSelectorSource"),val=srcm&&srcm.getSelectedItemValue();if(srcm){var items=base.getBone().commands.queryState(isSearchBox?"documentPureAttributes":"documentAttributes"),oits=srcm.getItems()||[];if(oits.length!=items.length){srcm.setItems(items);var isValidSelect=srcm.execSelectValue(val);if(!isValidSelect){srcm.execSingleSelect(0);}}}if(isSearchBox){base.get("EditSelectorType").set("selectedIndicesList",0);if(!srcm){var selSrc=base.getBone().commands.queryState("EditSelectorSource")||"",srcTy=selSrc.split("|")[1];if(srcTy&&srcTy!=microstrategy.DSSTYPE_ATTRIBUTE){base._storeDeltaProp("EditSelectorSource","");}}}};SP.prototype.on_set_ext_prop_UseAsInformationWindow=function SP_on_set_ext_prop_UseAsInformationWindow(evt){if(this.get("showTableDisplayMode")){var mstr_desc=microstrategy.descriptors;this.set("TableCancelType",evt.memo.value?mstr_desc.getDescriptor("11174"):mstr_desc.getDescriptor("11175"));this.set("TableCancelText",evt.memo.value?mstr_desc.getDescriptor("221"):mstr_desc.getDescriptor("2827"));}};SP.prototype.translateBone=function SP_translateBone(){this.translating=true;var ats=this.props.EditSelectorType,its=ats&&ats.getItems().concat(),pos=(its&&mstr.$A.findByForm(its,3,"dssid",false))||-1,iifp=this.getBone().commands.queryState("isInFilterPanel"),oiifp=!!ats.iifp;isAQ=microstrategy.getViewerBone()&&microstrategy.getViewerBone().commands.queryState("EditSelectorStyle")=="11";mstr.$A.forEach(its,function(item){var ct=item.dssid;if(ct!=4){if(isAQ){item.cssText=(ct==7)?"":"display: none;";}else{item.cssText=(ct==7)?"display: none;":"";}}});if(iifp!=oiifp){its[pos].cssText=iifp?"display: none;":"";ats.iifp=iifp;}ats.setItems(its);this.translating=false;mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);};function SP(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return SP;})();mstr.bones.editors.GeneralTabBoneTranslator=(function(){mstr.$O.extendsClass(GBT,mstr.bones.editors.BoneTranslator);GBT.prototype.init=function GBT_init(){mstr.bones.editors.BoneTranslator.prototype.init.apply(this);this.attachEventListener(this,"set_Visible","_handleVisiblilityChange");};GBT.prototype._handleVisiblilityChange=function GBT__handleVisiblilityChange(evt){if(this.translating){return ;}if(!evt.memo.value){this.set("VisibleHTML",false);}};GBT.prototype.on_set_IsPortal=function GBT_on_set_IsPortal(evt){if(this.translating){return ;}this.get("parent").notifyPropertyChange("IsPortal",evt);this.updatePanelCustomTitle();};GBT.prototype.on_set_TitleBarDisplay=function GBT_on_set_TitleBarDisplay(evt){if(this.translating){return ;}this.updatePanelCustomTitle();};GBT.prototype.updateShowTranslucent=function GBT_updateShowTranslucent(usiw,iwm){var evt={};evt.UseAsInformationWindow=usiw;evt.InfoWindowMode=iwm;this.get("parent").notifyPropertyChange("showTranslucent",evt);};GBT.prototype.updateInitialSlidingInWidthAndHeightEnabled=function GBT_updateInitialSlidingInWidthAndHeightEnabled(params){var usiw=params.usiw!==undefined?params.usiw:this.get("UseAsInformationWindow"),dips=params.dips!==undefined?params.dips:this.get("DisplayInPartialScreen"),iwm=params.iwm!==undefined?params.iwm:this.get("InfoWindowMode").getSelectedItemValue(),iwp=params.iwp!==undefined?params.iwp:this.get("InfoWindowPosition").getSelectedItemValue();this.set("InitialSlidingInHeightEnabled",usiw&&dips&&iwm==="4"&&(iwp==="1"||iwp==="2"));this.set("InitialSlidingInWidthEnabled",usiw&&dips&&iwm==="4"&&(iwp==="3"||iwp==="4"));};GBT.prototype.on_set_InfoWindowMode=function GBT_on_set_InfoWindowMode(evt){if(this.translating){return ;}this.updateShowTranslucent(this.get("UseAsInformationWindow"),evt.memo.value);this.updateInfoWinPosition();this.updateInitialSlidingInWidthAndHeightEnabled({iwm:evt.memo.value});};GBT.prototype.on_set_UseAsInformationWindow=function GBT_on_set_UseAsInformationWindow(evt){if(this.translating){return ;}this.updateShowTranslucent(evt.memo.value,this.get("InfoWindowMode").getSelectedItemValue());if(this.get("showTableDisplayMode")){!evt.memo.value&&this.set("IsPortal",evt.memo.value);this.get("parent").notifyPropertyChange("UseAsInformationWindow",evt);}if(evt.memo.value){this.set("ShowAsCollapsiblePanel",false);}this.updateInfoWinPosition();this.updateInitialSlidingInWidthAndHeightEnabled({usiw:evt.memo.value});};GBT.prototype.on_set_DisplayInPartialScreen=function GBT_on_set_DisplayInPartialScreen(evt){this.updateInitialSlidingInWidthAndHeightEnabled({dips:evt.memo.value});};GBT.prototype.on_set_InfoWindowPosition=function GBT_on_set_InfoWindowPosition(evt){this.updateInitialSlidingInWidthAndHeightEnabled({iwp:evt.memo.value});};GBT.prototype.updateInfoWinPosition=function GBT_updateInfoWinPosition(){var ifwMode=this.get("InfoWindowMode").getSelectedItemValue(),usIfw=this.get("UseAsInformationWindow");this.set("InfoWindowPositionEnabled",usIfw&&(ifwMode==4));};GBT.prototype.updatePanelCustomTitle=function GBT_updatePanelCustomTitle(){var selValue=this.get("TitleBarDisplay").getSelectedItemValue();this.set("panelCustomTitle",selValue&&selValue=="1"&&this.get("IsPortal"));};GBT.prototype.onModelPropertyChange=function GBT_onModelPropertyChange(evt){mstr.bones.editors.BoneTranslator.prototype.onModelPropertyChange.apply(this,[evt]);if(evt.src==this.get("titleTriState")){if(this.translating){return ;}var v=(this.get("titleTriState").getSelectedItemValue()=="1");this.set("ShowWidgetTitleBar",v);this.set("IsPortal",v);}};GBT.prototype.translateBone=function GBT_translateBone(){mstr.bones.editors.BoneTranslator.prototype.translateBone.apply(this);this.translating=true;var v=!this.get("IsPortal")?"0":(this.get("ShowWidgetTitleBar")?"1":"-1");this.get("titleTriState").execSelectValue(v);this.translating=false;};function GBT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return GBT;})();mstr.bones.editors.ActionsBoneTranslator=(function(){mstr.$O.extendsClass(ABT,mstr.bones.editors.BoneTranslator);ABT.prototype.getDynamicListModel=function ABT_getDynamicListModel(sourceName,propertyName){var m=mstr.bones.editors.BoneTranslator.prototype.getDynamicListModel.apply(this,arguments);if(propertyName=="ControlGroupByList"){m.detachEventListener(this,"hashadd_selectedIndices");m.detachEventListener(this,"hashremove_selectedIndices");m.attachEventListener(this,"listadd_items","onControlGroupByChange");}return m;};ABT.prototype.onControlGroupByChange=function ABT_onControlGroupByChange(evt){var model=evt.src;var v="";var valueWas=null;var items=[];v=model.getItems();var propName=model.get("mappedPropertyName");this.raiseEvent("set_"+propName,{name:propName,src:evt.name,value:v,valueWas:valueWas});if(this.translating){return ;}this._storeDeltaProp(propName,v);};ABT.prototype.on_set_ext_prop_XTabView=function ABT_on_set_ext_prop_XTabView(evt){var viewMode=evt.memo.value;var oldT=this.translating;this.translating=true;this.set("showGridIf",viewMode==1||viewMode==3);this.translating=oldT;};ABT.prototype.on_set_expandPanels=function ABT_on_set_expandPanels(evt){var ep=evt.memo.value;var oldT=this.translating;this.translating=true;this.set("allowPanelsToSplitAcrossPages",ep==0);this.set("panelOverflowSpacingEnabled",this.get("ClipOnExport")&&ep!=0);this.translating=oldT;};ABT.prototype.on_set_ClipOnExport=function ABT_onControlGroupByChange(evt){var oldT=this.translating;if(oldT){return ;}this.translating=true;var cone=evt.memo.value;var ep=this.get("expandPanels");this.set("panelOverflowSpacingEnabled",cone&&ep.getSelectedIndex()!=0);this.translating=oldT;};ABT.prototype.joinTypeChange=function ABT_joinTypeChange(mid,value){var joinTypes=this._getDeltaProp("joinTypes");if(!joinTypes){joinTypes={};}joinTypes[mid]=value;this._storeDeltaProp("joinTypes",joinTypes);};function ABT(props){mstr.bones.editors.BoneTranslator.apply(this,[props]);}return ABT;})();mstr.models.TriStateListModel=(function(){mstr.$O.extendsClass(TSLM,mstr.models.ListModel);TSLM.prototype.execSingleSelectNextAndLoop=function LM_exSingleSelectNextAndLoo(){mstr.models.ListModel.prototype.execSingleSelectNextAndLoop.apply(this);var selectedIndicesList=this.props.selectedIndicesList;if(isNaN(selectedIndicesList)){return false;}var selectedIndex=parseInt(selectedIndicesList);var eiol=this.get("ExcludedItemsOnLoop");eiol=eiol&&eiol.split(",");if(eiol&&selectedIndex in eiol){this.execSingleSelectNextAndLoop();}return true;};function TSLM(props){mstr.models.ListModel.apply(this,[props]);}return TSLM;})();mstr.models.IPhoneTimeSeriesEditorModel=(function(){mstr.$O.extendsClass(GE,mstr.models.BaseModel);GE.prototype.init=function GE_init(){mstr.models.BaseModel.prototype.init.apply(this);this.set("granularity","");if(this.props.isReport){this.selectItemFromId(this.props.dataSets,"r");}this.aeh();this.changeSelectedNode();this.ROOT_NODE="rl";this.ITEM_NODE="it";this.TEMPLATE_NODE="nk";this.NAME_NODE="lbl";this.LEVEL_NODE="lvl";this.RANGE_NODE="rng";this.RANGE_ATT_NODE="ut";this.RANGE_SIZE_NODE="v";};GE.prototype.aeh=function GE_aeh(){this.props.nodes.attachEventListener(this,"hashadd_selectedIndices","changeSelectedNode");this.props.rangeList.attachEventListener(this,"hashadd_selectedIndices","changeRangeList");this.props.dataSets.attachEventListener(this,"hashadd_selectedIndices","changeDataSet");};GE.prototype.changeSelectedNode=function GE_changeNode(evt){var n=this.props.nodes,item=n.getSelectedItem();if(item){if(item.dssid=="-1"){if(!this.props.justRemoved){this.execAdd();}return ;}this.set("empty",false);this.set("downEnabled",!evt.memo.at[mstr.$A.len(n.props.items)-2]);this.set("upEnabled",!n.props.selectedIndices[0]);var c=this.changingN;this.changingN=true;var snief=mstr.$obj("selectedNameIphoneEditorField");if(snief){snief.textBoxInitialized=false;}this.set("selectedName",item.n);this.set("selectedRangeSize",item.rs);var dsSelected=this.selectItemFromId(this.props.dataSets,item.ds);this.selectItemFromId(this.props.rangeList,item.sr);if(!dsSelected){this.set("attEnabled",false);}this.changingN=c;}else{this.set("empty",true);}this.updatePreview();};GE.prototype.updatePreview=function GE_updatePreview(){var p=microstrategy.descriptors.getDescriptor("7678"),item=this.props.nodes.getSelectedItem(),ds=this.props.dataSets.getSelectedItem(),si=this.props.rangeList.getSelectedItem(),g=this.props.granularity;v=ds&&g&&si&&item;p=p.replace("######",ds?ds.n:"").replace("#####",g?g:"").replace("####",si?si.n:"").replace("###",item?item.rs:"").replace("##",item?item.n:"");this.props.preview.set("value",v?p:"");};GE.prototype.selectItemFromId=function GE_selectItemFromId(list,id){var items=list.getItems();for(var i in items){if(items[i][list.props.valueForm]==id){list.setSelectedItems([items[i]]);return true;}}list.execClearSelect();return false;};GE.prototype.on_set_selectedRangeSize=function GE_setRangeSize(){this.props.nodes.getSelectedItem().rs=this.props.selectedRangeSize;this.updatePreview();};GE.prototype.on_set_selectedName=function GE_selectedName(){if(this.changingN){return ;}var c=this.changingN;this.changingN=true;this.props.justRemoved=true;this.props.nodes.execRenameSelectedItem(this.props.selectedName);this.props.justRemoved=false;this.changingN=c;this.updatePreview();};GE.prototype.changeRangeList=function GE_selectedRange(){this.props.nodes.getSelectedItem().sr=this.props.rangeList.getSelectedItem()[this.props.rangeList.props.valueForm];this.updatePreview();};GE.prototype.changeDataSet=function GE_changeDataSet(){this.set("attEnabled",true);this.props.rangeList.execClearSelect();this.props.rangeList.removeItems(this.props.rangeList.getItems());var sel=this.props.dataSets.getSelectedItem();var atts=this.props.__atts[sel.dssid];this.set("granularity",atts[atts.length-1].n);this.props.rangeList.insertItemsAt(atts);var selItem=this.props.nodes.getSelectedItem();selItem.ds=this.props.dataSets.getSelectedItem()[this.props.dataSets.props.valueForm];selItem.sl=atts[atts.length-1].dssid;if(!this.changingN){selItem.sr=null;}this.updatePreview();};GE.prototype.execAdd=function GE_execAdd(){this.set("empty",false);this.set("downEnabled",false);this.set("attEnabled",false);this.set("upEnabled",false);var item={dssid:Math.random(),n:microstrategy.descriptors.getDescriptor(945),sl:null,sr:null,rs:"1",ds:null},n=this.props.nodes,l=n.props.items.length;n.insertItemsAt([item],l-1);n.execSingleSelect(l-1);this.props.rangeList.execClearSelect();this.set("granularity","");if(this.props.isReport){this.selectItemFromId(this.props.dataSets,"r");}else{this.props.dataSets.execClearSelect();}};GE.prototype.execRemove=function GE_execRemove(){this.props.justRemoved=true;};GE.prototype.execPostRemove=function GE_execPostRemove(){var n=this.props.nodes,len=mstr.$A.len(n.props.items);this.props.justRemoved=false;this.set("empty",len==1);this.set("attEnabled",len>1);if(len==1){n.execClearSelect();}else{if(parseInt(n.props.selectedIndicesList)==(len-1)){n.execSingleSelect(len-2);}}};GE.prototype.execCheckDown=function GE_execCheckDown(){var n=this.props.nodes,len=mstr.$A.len(n.props.items);this.set("downEnabled",!n.props.selectedIndices[len-2]);this.set("upEnabled",!n.props.selectedIndices[0]);};GE.prototype.getXMLValue=function GE_getXMLValue(){var items=this.props.nodes.getItems();var res="<"+this.ROOT_NODE+">";for(var i in items){if(i==items.length-1){continue;}res+=this.appendItemXML(items[i]);}res+="</"+this.ROOT_NODE+">";return res;};GE.prototype.appendItemXML=function GE_appendItemXML(item){var res="<"+this.ITEM_NODE+"><"+this.TEMPLATE_NODE+">"+item.ds+"</"+this.TEMPLATE_NODE+"><"+this.NAME_NODE+">"+item.n+"</"+this.NAME_NODE+"><"+this.LEVEL_NODE+">"+item.sl+"</"+this.LEVEL_NODE+"><"+this.RANGE_NODE+"><"+this.RANGE_SIZE_NODE+">"+item.rs+"</"+this.RANGE_SIZE_NODE+"><"+this.RANGE_ATT_NODE+">"+item.sr+"</"+this.RANGE_ATT_NODE+"></"+this.RANGE_NODE+"></"+this.ITEM_NODE+">";return res;};GE.prototype.validate=function GE_validate(){var items=this.props.nodes.getItems(),item,id="";for(var x in items){if(x==items.length-1){continue;}item=items[x];if(!item.n||!item.sl||!item.sr||!item.ds||!/^\d+$/.test(item.rs)){id+=" "+item.n+",";}}if(id){id=id.substring(0,id.length-1);return microstrategy.descriptors.getDescriptor(7565)+" "+id;}return true;};GE.prototype.checkValidationStatus=function GE_checkValidationStatus(){var n=this.props.nodes.props.items,elem=microstrategy.bone("visPropsEditor_VisualizationPropertiesEditorStyle").elem,input=microstrategy.findChildWithAtt(elem,"input","id","ok");for(var ni in n){if(n[ni].invalidRS){input.disabled=true;return ;}}input.disabled=false;};function GE(props){mstr.models.BaseModel.apply(this,[props]);}return GE;})();mstr.models.IphoneTSFieldValidator=(function(){mstr.$O.extendsClass(FV,mstr.models.FieldValidator);FV.prototype.validate=function FV_validate(v){this.props.theValue=v;var isValid=mstr.models.FieldValidator.prototype.validate.apply(this,[v]);};FV.prototype.setValidationStatus=function FV_setValidationStatus(msg){var isValid=mstr.models.FieldValidator.prototype.setValidationStatus.apply(this,[msg]);var m=this.props.parent;m=m&&m.props.model;var i=m&&m.props.nodes,v=this.props.theValue;i=i&&i.getSelectedItem();if(i){i.rs=v;i.invalidRS=!isValid;m.set("selectedRangeSize",v);m.checkValidationStatus();}return isValid;};function FV(props){mstr.models.FieldValidator.apply(this,[props]);}return FV;})();mstr.behaviors.ToolbarContextMenuOpener=(function(){var CMO={};CMO.openMenu=function CMO_openMenu(view){var target=view.props.element,x=getObjSumLeft(target),y=getObjSumTop(target)+getObjHeight(target),model=view.getModel();microstrategy.openBlockLoaderEditor("addWidgetToolbarMenu","InsertMenuBlockLoader",null,{cssText:"position:absolute;top:"+y+"px;left:"+x+"px;z-index:"+mstr.views.FloatingMenuBook.prototype.getZIndex()+";",useFixedPosition:"false",contextMenuName:model.get("contextMenuName"),viewer:"#"+model.props.id},view,null,document.body);};CMO.changeIcon=function CMO_changeIcon(view,model,elem){var item=model.props.cmdid.split(";");item=item.length>1?item[1]:item.join();elem.className=view.props.cssBaseIcon+item;};return CMO;})();mstr.models.ToolbarContextMenuOpenerModel=(function(){mstr.$O.extendsClass(CMOM,mstr.models.BaseModel);CMOM.prototype.init=function CMOM_init(){mstr.models.BaseModel.prototype.init.apply(this);this.commands.p=this;this.commands.h=this.props.toolbarHelper;};CMOM.prototype.commands={queryEnabled:function(){return true;},queryVisible:function(){return true;},queryState:function(){return true;},exec:function(cmdId){this.p.set("cmdid",cmdId);this.h.execPressed();}};function CMOM(props){mstr.models.BaseModel.apply(this,[props]);}return CMOM;})();mstr.itemrenderers.IPhoneTimeSeriesItemRenderer=(function(){LV=mstr.$H.clone(mstr.itemrenderers.ListView);LV.renderListItem=function(view,model,rootTag,context){var elDiv=mstr.itemrenderers.FastListView.renderListItem(view,model,rootTag,context);this._insertElementForIndex(view,rootTag,context.at,elDiv);if(context&&context.item&&context.item.dssid==-1){var s=elDiv.style;s.fontStyle="italic";s.textDecoration="underline";s.cursor="pointer";elDiv.className="";elDiv.title="";}return elDiv;};return LV;})();