mstrGraphDropZonesEditorScript=true;mstrGraphDropZonesEditor.prototype=new mstrEditorImpl();mstrGraphDropZonesEditor.prototype.boneID="";mstrGraphDropZonesEditor.prototype.selections=null;mstrGraphDropZonesEditor.prototype.isDropZoneEditor=true;mstrGraphDropZonesEditor.prototype.gridStructureInfo=null;mstrGraphDropZonesEditor.prototype.dSetId="";mstrGraphDropZonesEditor.prototype.doSlide=false;mstrGraphDropZonesEditor.prototype.img=null;mstrGraphDropZonesEditor.prototype.showGraphDropZones=true;mstrGraphDropZonesEditor.prototype.disabled=false;mstrGraphDropZonesEditor.prototype.useDNDMapping=true;mstrGraphDropZonesEditor.prototype.mask=null;mstrGraphDropZonesEditor.prototype.maskFor=null;mstrGraphDropZonesEditor.prototype.maskArea=null;mstrGraphDropZonesEditor.prototype.dndHelper=null;mstrGraphDropZonesEditor.prototype.dragDisplay=null;mstrGraphDropZonesEditor.prototype.dragSource=null;mstrGraphDropZonesEditor.prototype.x=0;mstrGraphDropZonesEditor.prototype.y=0;mstrGraphDropZonesEditor.prototype.activeElement=null;mstrGraphDropZonesEditor.prototype.type=microstrategy.OBJTYPE_GRAPH_ZONES;mstrGraphDropZonesEditor.prototype.onload=function(){try{if(!this.getGraphBone()){microstrategy.unRegisterBone(this.id);return ;}mstrEditorImpl.prototype.onload.call(this);var imgs=this.elem.getElementsByTagName("img");if(imgs.length>0){this.img=imgs[imgs.length-1];if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE){this.changeImageSrc(this.getGraphBone().commands.queryState("imgSrc"));}this.img.style.visibility="visible";}this.elem.onmousedown=new Function("e","return microstrategy.bone('"+this.id+"').onmousedown(e)");this.initMapper();this.initMask();}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.onmousedown=function(e){try{microstrategy.getViewerBone().commands.exec("select",(this.boneKey+"|52"));mstrReportGraphImpl.prototype.initSelections.call(this);return mstrReportGraphImpl.prototype.onmousedown.call(this,e);}catch(err){microstrategy.errors.log(err);return true;}};mstrGraphDropZonesEditor.prototype.ondragstart=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}return mstrReportGraphImpl.prototype.ondragstart.call(this,e);}catch(err){microstrategy.errors.log(err);return true;}};mstrGraphDropZonesEditor.prototype.ondrag=function(e){try{if(e.e){e=e.e;}mstrReportGraphImpl.prototype.ondrag.call(this,e);}catch(err){microstrategy.errors.log(err);}return false;};mstrGraphDropZonesEditor.prototype.ondragend=function(e){try{mstrReportGraphImpl.prototype.ondragend.call(this,e);}catch(err){microstrategy.errors.log(err);}return false;};mstrGraphDropZonesEditor.prototype.initializeDragDisplay=function(){try{mstrReportGraphImpl.prototype.initializeDragDisplay.call(this);}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.ondrop=function(area,selections){try{if(!this.getGraphBone()){return ;}this.getGraphBone().ondrop(area,selections);if(this.useDNDMapping&&this.mask!=null){this.mask.onmaskedobjectresize();}}catch(err){microstrategy.errors.log(err);}return false;};mstrGraphDropZonesEditor.prototype.onnotifydrag=function(items,bone,types){try{if(!this.getGraphBone()){return ;}mstrReportGraphImpl.prototype.onnotifydrag.call(this,items,bone,types);this.getGraphBone().dragSource=this.dragSource;}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.onnotifydragend=function(){try{mstrReportGraphImpl.prototype.onnotifydragend.call(this);}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.onmouseup=function(e){try{mstrReportGraphImpl.prototype.onmouseup.call(this,e);}catch(err){microstrategy.errors.log(err);}return false;};mstrGraphDropZonesEditor.prototype.isTargetGridSelected=function(boneIds){var ids=boneIds.split("|");for(var i=0;i<ids.length;i++){if(ids[i]!=""){if(ids[i]==this.boneKey){return true;}}}return false;};mstrGraphDropZonesEditor.prototype.onboneaftermove=function(movedBoneIds,activeSectionSN){try{if(this.isTargetGridSelected(movedBoneIds)){this.ondialogresize(null);}}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.onObjectBrowserTabChange=function(){this.ondialogresize(null);};mstrGraphDropZonesEditor.prototype.ondialogresize=function(e){try{if(!this.getGraphBone()){return ;}var b=this.getGraphBone();if(b&&"getDropZonesPosition" in b&&this.elem){var moveTo=b.getDropZonesPosition(this);this.moveTo(moveTo.left-getObjSumLeft(this.elem.parentNode),moveTo.top-getObjSumTop(this.elem.parentNode));}}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.onbonedeleted=function(deletedBoneIds){try{if(this.isTargetGridSelected(deletedBoneIds)){this.closeEditor();}}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.initMapper=function(){try{if(!this.getGraphBone()){return ;}this.dndHelper=new mstrDNDHelperImpl(this);var zonesId="UniqueReportID";if(this.getGraphBone().commands.queryState("effectiveView")==microstrategy.DISPLAY_MODE_GRID_AND_GRAPH){zonesId+="_graph";}this.mapper=new mstrGraphMapperImpl(zonesId,this);this.maskFor=microstrategy.DSSTYPE_METRIC+microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_ATTRIBUTE;this.maskArea=this.elem;}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.initMask=function(){try{this.mask=new mstrMaskMappedImpl();this.mask.onload(this);if(this.dragDisplay==null){node=document.createElement("span");node.className="mstrDnDReportDragItem";node.appendChild(document.createTextNode(""));this.dragDisplay=document.body.appendChild(node);}}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.getGraphBone=function(){try{for(var id in microstrategy.bones){var b=microstrategy.bones[id];if(id.indexOf(this.boneKey)>-1&&b.RWUnitId==this.boneKey){if(b.isGraph&&!b.isGrid){return b;}}}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrGraphDropZonesEditor.prototype.deleteItems=function(items){try{if(!this.getGraphBone()){return ;}this.getGraphBone().deleteItems(items);if(this.useDNDMapping&&this.mask!=null){this.mask.onmaskedobjectresize();}}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.getDNDHelperImage=function(bone,pointsTo){try{return mstrReportGraphImpl.prototype.getDNDHelperImage.call(this,bone,pointsTo);}catch(err){microstrategy.errors.log(err);return null;}};mstrGraphDropZonesEditor.prototype.show=function(){try{if(!this.getGraphBone()){return ;}if(!this.elem){return ;}var v=microstrategy.getViewerBone();var ve=v&&v.elem;if(ve&&this.elem.parentNode!=ve){ve.appendChild(this.elem);}var bone=this.getGraphBone();if(bone&&"getDropZonesPosition" in bone){var zIndex=this.computeZIndex();var moveTo=bone.getDropZonesPosition(this);this.moveTo(moveTo.left-getObjSumLeft(this.elem.parentNode),moveTo.top-getObjSumTop(this.elem.parentNode));this.elem.style.zIndex=zIndex+1;if(!this.doSlide){displayObj(this.elem);}this.gridStructureInfo=bone.gridStructureInfo;this.features=bone.features;this.dSetId=bone.dSetId;}}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.hide=function(){try{var b=mstrEditorImpl.prototype.hide.apply(this,arguments);document.body.appendChild(this.elem);return b;}catch(err){microstrategy.errors.log(err);return false;}};mstrGraphDropZonesEditor.prototype.processContextMenus=function(cmdId,cmdVal){try{if(!this.getGraphBone()){return ;}var bone=this.getGraphBone();bone.processContextMenus(cmdId,cmdVal);}catch(err){microstrategy.errors.log(err);}};mstrGraphDropZonesEditor.prototype.changeImageSrc=function(src){try{if(this.img){this.img.src=src;}}catch(err){microstrategy.errors.log(err);}};function mstrGraphDropZonesEditor(id){this.inherits=mstrEditorImpl;this.inherits(id);delete this.inherits;return this;}