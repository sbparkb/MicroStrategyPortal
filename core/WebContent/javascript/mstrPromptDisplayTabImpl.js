mstrPromptDisplayTabImplScript=true;mstrPromptDisplayTabImpl.prototype=new mstrPromptDefTabImpl();mstrPromptDisplayTabImpl.prototype.minValue=null;mstrPromptDisplayTabImpl.prototype.maxValue=null;mstrPromptDisplayTabImpl.prototype.minCheck=null;mstrPromptDisplayTabImpl.prototype.maxCheck=null;mstrPromptDisplayTabImpl.prototype.showTime=false;var TIME_HOUR=1;var TIME_MINUTE=2;var TIME_SECOND=3;mstrPromptDisplayTabImpl.prototype.onload=function(){try{mstrPromptDefTabImpl.prototype.onload.call(this);var answerRestrictList=getObj("p_ansAllowed");if(answerRestrictList){answerRestrictList.prev=answerRestrictList.value;}var setTab=function(fld){if(typeof (fld)=="string"){fld=getObj(fld);}if(fld){fld.setAttribute("tab","2");}};setTab("p_min_value");setTab("p_max_value");}catch(err){microstrategy.errors.log(err);return false;}};mstrPromptDisplayTabImpl.prototype.onpostswitch=function(){this.updateTitleAndDesc();};mstrPromptDisplayTabImpl.prototype.updateMaxCheck=function(obj){try{this.updateCheck(obj);if(this.getPromptType()!=mstrPromptDefImpl.CONSTANT_PROMPT){this.maxCheck=getObj("p_max_check").checked;}this.updateMaxValue(getObj("p_max_value"));}catch(err){microstrategy.errors.log(err);return false;}};mstrPromptDisplayTabImpl.prototype.updateMinCheck=function(obj){try{this.updateCheck(obj);if(this.getPromptType()!=mstrPromptDefImpl.CONSTANT_PROMPT){this.minCheck=getObj("p_min_check").checked;}this.updateMinValue(getObj("p_min_value"));}catch(err){microstrategy.errors.log(err);return false;}};mstrPromptDisplayTabImpl.prototype.validateInputs=function(){try{this.updateTitleAndDesc();var succeed=true;if(this.getPromptType()!=mstrPromptDefImpl.CONSTANT_PROMPT){if(getObj("p_min_check").checked&&this.minValue!=getObj("p_min_value").value){succeed=this.updateMinValue(getObj("p_min_value"),true);}if(succeed&&getObj("p_max_check").checked&&this.maxValue!=getObj("p_max_value").value){succeed=this.updateMaxValue(getObj("p_max_value"),true);}}else{var dataType=this.getConstantPromptDataType();switch(dataType){case mstrPromptDefTabImpl.prototype.VPDate:if(getObj("vp_d_min_check").checked&&this.minValue!=this.getTime(getObj("vp_d_min_value"))){succeed=this.updateMinDate(getObj("vp_d_min_value"),true,true);}if(succeed&&getObj("vp_d_max_check").checked&&this.maxValue!=this.getTime(getObj("vp_d_max_value"))){succeed=this.updateMaxDate(getObj("vp_d_max_value"),true,true);}break;case mstrPromptDefTabImpl.prototype.VPText:break;case mstrPromptDefTabImpl.prototype.VPNum:if(getObj("vp_num_min_check").checked&&this.minValue!=getObj("vp_num_min_value").value){succeed=this.updateMinValue(getObj("vp_num_min_value"),true);}if(succeed&&getObj("vp_num_max_check").checked&&this.maxValue!=getObj("vp_num_max_value").value){succeed=this.updateMaxValue(getObj("vp_num_max_value"),true);}break;case mstrPromptDefTabImpl.prototype.VPBigDec:if(getObj("vp_bigdec_min_check").checked&&this.minValue!=getObj("vp_bigdec_min_value").value){succeed=this.updateMinValue(getObj("vp_bigdec_min_value"),true);}if(succeed&&getObj("vp_bigdec_max_check").checked&&this.maxValue!=getObj("vp_bigdec_max_value").value){succeed=this.updateMaxValue(getObj("vp_bigdec_max_value"),true);}break;}}return succeed;}catch(err){microstrategy.errors.log(err);return false;}};mstrPromptDisplayTabImpl.prototype.initSettings=function(){try{var at=this.getAppliesTo();this.promptEditorType=at.webPromptType;if(at.webPromptType==mstrPromptDefImpl.CONSTANT_PROMPT){if(at.isNew&&!at.isInFilter){this.settings=this.getSettings(new Array("p_name","p_title","p_desc","p_required","p_ansAllowed"));}else{var dataType=this.getConstantPromptDataType();switch(dataType){case mstrPromptDefTabImpl.prototype.VPDate:this.settings=this.getSettings(new Array("p_name","p_title","p_desc","p_required","p_ansAllowed","vp_d_min_check","vp_d_min_value","vp_d_max_check","vp_d_max_value"));break;case mstrPromptDefTabImpl.prototype.VPText:this.settings=this.getSettings(new Array("p_name","p_title","p_desc","p_required","p_ansAllowed","vp_text_min_check","vp_text_min_value","vp_text_max_check","vp_text_max_value"));break;case mstrPromptDefTabImpl.prototype.VPNum:this.settings=this.getSettings(new Array("p_name","p_title","p_desc","p_required","p_ansAllowed","vp_num_min_check","vp_num_min_value","vp_num_max_check","vp_num_max_value"));var displayStyle=getObj("p_dispStyle");if(displayStyle&&displayStyle.value==mstrPromptDefCommandsImpl.prototype.DISPLAYSTYLE_SLIDER){var mn=getObj("vp_num_min_check");var mx=getObj("vp_num_max_check");if(mn&&mx){mn.setAttribute("disabled","1");mx.setAttribute("disabled","1");}}break;case mstrPromptDefTabImpl.prototype.VPBigDec:this.settings=this.getSettings(new Array("p_name","p_title","p_desc","p_required","p_ansAllowed","vp_bigdec_min_check","vp_bigdec_min_value","vp_bigdec_max_check","vp_bigdec_max_value"));break;}}}else{this.settings=this.getSettings(new Array("p_name","p_title","p_desc","p_required","p_ansAllowed","p_min_check","p_min_value","p_max_check","p_max_value"));}if(this.getPromptType()==mstrPromptDefImpl.CONSTANT_PROMPT){this.switchVPMinMaxSection(this.getConstantPromptDataType());}else{this.minCheck=getObj("p_min_check").checked;this.maxCheck=getObj("p_max_check").checked;if(this.minCheck){this.updateMinValue(getObj("p_min_value"),true);}if(this.maxCheck){this.updateMaxValue(getObj("p_max_value"),true);}}this.initializeDisables();}catch(err){microstrategy.errors.log(err);return false;}};mstrPromptDisplayTabImpl.prototype.initializeDisables=function(){var at=this.getAppliesTo();if(at&&at.webPromptType==mstrPromptDefImpl.CONSTANT_PROMPT){var dateMinCheck=getObj("vp_d_min_check");this.checkDisabled(dateMinCheck.checked,dateMinCheck);var dateMaxCheck=getObj("vp_d_max_check");this.checkDisabled(dateMaxCheck.checked,dateMaxCheck);var numMinCheck=getObj("vp_num_min_check");this.checkDisabled(numMinCheck.checked,numMinCheck);var numMaxCheck=getObj("vp_num_max_check");this.checkDisabled(numMaxCheck.checked,numMaxCheck);var textMinCheck=getObj("vp_text_min_check");this.checkDisabled(textMinCheck.checked,textMinCheck);var textMaxCheck=getObj("vp_text_max_check");this.checkDisabled(textMaxCheck.checked,textMaxCheck);var bigDecMinCheck=getObj("vp_bigdec_min_check");this.checkDisabled(bigDecMinCheck.checked,bigDecMinCheck);var bigDecMaxCheck=getObj("vp_bigdec_max_check");this.checkDisabled(bigDecMaxCheck.checked,bigDecMaxCheck);}else{var minCheck=getObj("p_min_check");if(minCheck){this.checkDisabled(minCheck.checked,minCheck);}var maxCheck=getObj("p_max_check");if(maxCheck){this.checkDisabled(maxCheck.checked,maxCheck);}}};mstrPromptDisplayTabImpl.prototype.getTimeFromFormat=function(obj,type){if(obj.length<10||obj.length>11){return -1;}var tp=obj.split(" ");if(tp[1]==null||(tp[1]!="PM"&&tp[1]!="AM")){return -1;}var ts=tp[0].split(":");if(isNaN(parseInt(ts[0]))||ts[0]<=0||ts[0]>12){return -1;}for(var i=1;i<3;i++){if(isNaN(parseInt(ts[i]))||ts[i].length!=2||ts[i]<0||ts[i]>59){return -1;}}switch(type){case TIME_HOUR:return tp[1]=="AM"?ts[0]:parseInt(ts[0])+12+"";case TIME_MINUTE:return ts[1];case TIME_SECOND:return ts[2];default:return -1;}};mstrPromptDisplayTabImpl.prototype.getTime=function(obj){var at=this.getAppliesTo();var format=at.dateFormat;if(this.showTime){var split=obj.value.indexOf(" ");if(split<0){return 0;}var dateStr=obj.value.substring(0,split);var timeStr=obj.value.substring(split+1,obj.value.length);var y=getDateFromFormat(dateStr,format,DATE_YEAR);var m=getDateFromFormat(dateStr,format,DATE_MONTH)-1;var d=getDateFromFormat(dateStr,format,DATE_DAY);var hour=this.getTimeFromFormat(timeStr,TIME_HOUR);var min=this.getTimeFromFormat(timeStr,TIME_MINUTE);var sec=this.getTimeFromFormat(timeStr,TIME_SECOND);if(y>0&&m>=0&&d>0&&hour>0&&min>=0&&sec>=0){return(new Date(y,m,d,hour,min,sec)).getTime();}else{return 0;}}else{var y=getDateFromFormat(obj.value,format,DATE_YEAR);var m=getDateFromFormat(obj.value,format,DATE_MONTH)-1;var d=getDateFromFormat(obj.value,format,DATE_DAY);if(y>0&&m>=0&&d>0){return(new Date(y,m,d)).getTime();}else{return 0;}}};mstrPromptDisplayTabImpl.prototype.updateMinDate=function(obj,skipCmd,validate){if(obj.value==""){if(!skipCmd){this.updateText(obj);}return true;}var parsedValue=this.getTime(obj);if(isNaN(parsedValue)||parsedValue<=0||(this.maxValue&&getObj("vp_d_max_check").checked&&parsedValue>this.maxValue)){if(validate){showMessage({contents:microstrategy.descriptors.getDescriptor(5970),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_ERROR});obj.value=obj.getAttribute(microstrategy.HTMLATTR_CMD_VALUE);this.synchTimePicker(obj);}return false;}if(!skipCmd){this.updateText(obj);}this.minValue=parsedValue;if(microstrategy.bone("tabPromptStyleId")!=null){microstrategy.bone("tabPromptStyleId").adjustStyleListForMinMax(skipCmd);}if(microstrategy.bone("tabPromptQualId")!=null){microstrategy.bone("tabPromptQualId").updateQualSections(skipCmd);}this.synchTimePicker(obj);return true;};mstrPromptDisplayTabImpl.prototype.updateMinValue=function(obj,skipCmd){if(obj.value==""){if(!skipCmd){this.updateText(obj);}return true;}var parsedValue=parseInt(obj.value);if(!skipCmd){this.updateText(obj);}this.minValue=parsedValue;if(microstrategy.bone("tabPromptStyleId")!=null){microstrategy.bone("tabPromptStyleId").adjustStyleListForMinMax(skipCmd);}if(microstrategy.bone("tabPromptQualId")!=null){microstrategy.bone("tabPromptQualId").updateQualSections(skipCmd);}return true;};mstrPromptDisplayTabImpl.prototype.updateMaxDate=function(obj,skipCmd,validate){if(obj.value==""){if(!skipCmd){this.updateText(obj);}return true;}var parsedValue=this.getTime(obj);if(isNaN(parsedValue)||parsedValue<=0||(this.minValue&&getObj("vp_d_min_check").checked&&parsedValue<this.minValue)){if(validate){showMessage({contents:microstrategy.descriptors.getDescriptor(5971),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_ERROR});obj.value=obj.getAttribute(microstrategy.HTMLATTR_CMD_VALUE);this.synchTimePicker(obj);}return false;}if(!skipCmd){this.updateText(obj);}this.maxValue=parsedValue;if(microstrategy.bone("tabPromptStyleId")!=null){microstrategy.bone("tabPromptStyleId").adjustStyleListForMinMax(skipCmd);}if(microstrategy.bone("tabPromptQualId")!=null){microstrategy.bone("tabPromptQualId").updateQualSections(skipCmd);}this.synchTimePicker(obj);return true;};mstrPromptDisplayTabImpl.prototype.updateMaxValue=function(obj,skipCmd){if(obj.value==""){if(!skipCmd){this.updateText(obj);}return true;}var parsedValue=parseInt(obj.value);if(!skipCmd){this.updateText(obj);}this.maxValue=parsedValue;if(microstrategy.bone("tabPromptStyleId")!=null){microstrategy.bone("tabPromptStyleId").adjustStyleListForMinMax(skipCmd);}if(microstrategy.bone("tabPromptQualId")!=null){microstrategy.bone("tabPromptQualId").updateQualSections(skipCmd);}return true;};mstrPromptDisplayTabImpl.prototype.appendTime=function(obj,skipEmpty){if(!this.showTime){return ;}if(skipEmpty&&obj.value==""){return ;}this.cutTime(obj);var isMin=(obj.id=="vp_d_min_value");var hour=isMin?getObj("vp_h_min_value"):getObj("vp_h_max_value");var min=isMin?getObj("vp_m_min_value"):getObj("vp_m_max_value");var sec=isMin?getObj("vp_s_min_value"):getObj("vp_s_max_value");var timeStr=""+(hour.value<13?hour.value:hour.value-12)+":"+min.options[min.value].text+":"+sec.options[sec.value].text;obj.value+=" "+timeStr+(hour.value<13?" AM":" PM");if(isMin){this.updateMinDate(obj);}else{this.updateMaxDate(obj);}};mstrPromptDisplayTabImpl.prototype.cutTime=function(obj){if(obj.value.indexOf(" ")<0){return ;}obj.value=obj.value.split(" ")[0];var isMin=(obj.id=="vp_d_min_value");if(isMin){this.updateMinDate(obj);}else{this.updateMaxDate(obj);}};mstrPromptDisplayTabImpl.prototype.synchTimePicker=function(obj){if(!this.showTime){return ;}var isMin=(obj.id=="vp_d_min_value");if((isMin&&!getObj("vp_d_min_check").checked)||(!isMin&&!getObj("vp_d_max_check").checked)){return ;}var split=obj.value.indexOf(" ");if(split<0){return ;}var timeStr=obj.value.substring(split+1,obj.value.length);var h=this.getTimeFromFormat(timeStr,TIME_HOUR);var m=this.getTimeFromFormat(timeStr,TIME_MINUTE);var s=this.getTimeFromFormat(timeStr,TIME_SECOND);var hour=isMin?getObj("vp_h_min_value"):getObj("vp_h_max_value");var min=isMin?getObj("vp_m_min_value"):getObj("vp_m_max_value");var sec=isMin?getObj("vp_s_min_value"):getObj("vp_s_max_value");if(hour.value!=h){hour.options.selectedIndex=h-1;}if(min.value!=m){min.options.selectedIndex=m;}if(sec.value!=s){sec.options.selectedIndex=s;}};mstrPromptDisplayTabImpl.prototype.enableTimePicker=function(showTime,initialize){this.showTime=showTime;var maxpicker=getObj("vp_max_timepicker");maxpicker.style.display=showTime?"inline":"none";var minpicker=getObj("vp_min_timepicker");minpicker.style.display=showTime?"inline":"none";var minInput=getObj("vp_d_min_value");var maxInput=getObj("vp_d_max_value");if(initialize&&showTime){this.getTime(minInput);this.getTime(maxInput);}else{if(showTime){this.appendTime(minInput,true);this.appendTime(maxInput,true);}else{this.cutTime(minInput);this.cutTime(maxInput);}}this.synchTimePicker(minInput);this.synchTimePicker(maxInput);};mstrPromptDisplayTabImpl.prototype.updateAnswerRestrictionList=function(obj){obj.prev=obj.value;this.updateList(obj);};mstrPromptDisplayTabImpl.prototype.rollbackPulldownSelection=function(pulldownId){var obj=getObj(pulldownId);obj.value=obj.prev;this.updateList(obj);};mstrPromptDisplayTabImpl.prototype.commitPulldownSelection=function(pulldownId){var obj=getObj(pulldownId);obj.prev=obj.value;this.updateList(obj);};function mstrPromptDisplayTabImpl(id){this.inherits=mstrPromptDefTabImpl;this.inherits(id);this.inherits=null;return this;}