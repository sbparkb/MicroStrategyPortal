mstrAdvancedThresholdEditorScript=true;mstrAdvancedThresholdEditor.prototype=new mstrThresholdEditor();mstrAdvancedThresholdEditor.prototype.selections=null;mstrAdvancedThresholdEditor.prototype.observer=null;mstrAdvancedThresholdEditor.prototype.metricOptions=null;mstrAdvancedThresholdEditor.prototype.currentThresholdProps=null;mstrAdvancedThresholdEditor.prototype.enablePaste=false;mstrAdvancedThresholdEditor.prototype.um=null;mstrAdvancedThresholdEditor.prototype.currentThresholdId="";mstrAdvancedThresholdEditor.prototype.copyThresholdId="";mstrAdvancedThresholdEditor.prototype.thresholdExpressionBeanPath="";mstrAdvancedThresholdEditor.prototype.viewBeanPath="";mstrAdvancedThresholdEditor.prototype.isModified=false;mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_METRIC="ateM";mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_THRESHOLD="ateT";mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_EXPRESSION="ateExp";mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_PREVIEW="atePrv";mstrAdvancedThresholdEditor.EXP_COUNT="expcount";mstrAdvancedThresholdEditor.EDIT_EXP="expedit";mstrAdvancedThresholdEditor.EXP_EDIT_MODE="expeditmode";mstrAdvancedThresholdEditor.EXP_IS_ON_GRID="isongrid";mstrAdvancedThresholdEditor.EXP_MODE_VIEW_MODE=1;mstrAdvancedThresholdEditor.EXP_MODE_SELECT_UNIT=2;mstrAdvancedThresholdEditor.ATT_KEY="key";mstrAdvancedThresholdEditor.CONTAINER_TYPE="ctnrTp";mstrAdvancedThresholdEditor.prototype.onload=function(){try{mstrThresholdEditor.prototype.onload.call(this);this.commands=new mstrATECommandsImpl(this);this.selections=new mstrAdvancedThresholdsEditorSelectionsImpl(this);this.observer=new mstrObserverImpl();this.metricOptions=new mstrPulldownOptions();var body=microstrategy.subObjectFind(this.elem,["TD"],microstrategy.SUBOBJTYPE_BODY);body.onclick=new Function("e","if (microstrategy.bone('"+this.id+"')) return microstrategy.bone('"+this.id+"').onclick(e);");body.ondblclick=new Function("e","if (microstrategy.bone('"+this.id+"')) return microstrategy.bone('"+this.id+"').ondblclick(e);");this.containers=new Object();for(var i=0;i<body.childNodes.length;i++){var c=body.childNodes[i];if(c.getAttribute){var type=c.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);if(type==mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_METRIC){var key=c.getAttribute(mstrAdvancedThresholdEditor.ATT_KEY);this.containers[key]=c;if(!this.isCondFormat){this.metricOptions.add(parseInt(key),c.getAttribute(microstrategy.HTMLATTR_DESCRIPTION),(key==this.currentContainerKey),parseInt(c.getAttribute(microstrategy.HTMLATTR_DSS_TYPE)));}}}}this.um=microstrategy.updateManager;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.onpostload=function(){try{mstrBoneImpl.prototype.onpostload.call(this);var t=document.getElementById("ate_"+this.currentContainerKey+"_"+this.currentThresholdId);if(t){this.selections.add(t);}else{if(this.observer){this.observer.notifyAll("onselectionchange");}}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.onselectionchange=function(){try{if(this.selections==null){return true;}this.currentThresholdId=(this.selections.isActive())?this.extractThresholdId(this.selections.firstItem()):"";for(var k in this.containers){var n=this.containers[k].childNodes.length;for(var j=0;j<n;j++){this.containers[k].childNodes[j].style.backgroundColor="";}}if(this.selections.isActive()){this.selections.firstItem().style.backgroundColor="#a6a6a6";if(!this.shouldEnableFormatButton()){var prev=microstrategy.findChildWithAtt(this.selections.firstItem(),"div","sty","atePrv");if(prev!=null){prev.disable=true;prev.title=microstrategy.descriptors.getDescriptor("6064");}}}if(this.observer){this.observer.notifyAll("onselectionchange");}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.onclick=function(e){try{if(!e){e=window.event;}var src=getEventTarget(e);var obj=findTarget(src,microstrategy.HTMLATTR_SUBOBJTYPE);if(!obj){return true;}var subType=obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);switch(subType){case mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_THRESHOLD:this.selections.add(obj);break;case mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_PREVIEW:return false;break;case mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_EXPRESSION:this.selections.add(findTarget(obj.parentNode,microstrategy.HTMLATTR_SUBOBJTYPE));return true;break;default:this.resetSelections();return true;}return false;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.ondblclick=function(e){try{if(!e){e=window.event;}var src=getEventTarget(e);var obj=findTarget(src,microstrategy.HTMLATTR_SUBOBJTYPE);if(!obj){return true;}if(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_PREVIEW){this.selections.add(findTarget(obj.parentNode,microstrategy.HTMLATTR_SUBOBJTYPE));if(this.shouldEnableFormatButton()){this.showFormatDialog();}}return false;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.setExpViewMode=function(){try{var selectItem=this.selections.firstItem();if(selectItem){selectItem.setAttribute(mstrAdvancedThresholdEditor.EXP_EDIT_MODE,mstrAdvancedThresholdEditor.EXP_MODE_VIEW_MODE);selectItem.setAttribute(mstrAdvancedThresholdEditor.EDIT_EXP,0);}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.findThresholdElem=function(obj){try{var src=findTarget(obj,microstrategy.HTMLATTR_SUBOBJTYPE);while(src){if(src.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_THRESHOLD){return src;}src=findTarget(src.parentNode,microstrategy.HTMLATTR_SUBOBJTYPE);}return src;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.showFormatDialog=function(){try{if(!this.validateAndShowMsg()){return ;}var addUrl=this.getExtraURL()+"&appliesToID="+this.id;if(this.selectedType>-1){addUrl+="&selectedTypes=obj."+this.selectedType;}this.um.addURL(addUrl);toggleShowBean("thresholdsFormatEditor",true,"");}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.changeMetric=function(key){try{this.currentContainerKey=key;if(!isNaN(parseInt(key))){this.metricOptions.setSelectedOption(parseInt(key));}for(var k in this.containers){this.containers[k].style.display="none";}this.containers[key].style.display="block";var div=document.getElementById("addThresholdLink");if(div!=null){if(this.containers[key].childNodes.length==0&&this.shouldEnableNewButton()){div.style.display="block";}else{div.style.display="none";}}this.resetSelections();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.resetSelections=function(){try{this.selections.clear();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.shouldEnableNewButton=function(){try{return this.isEditingOnCurrentContainer();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.shouldEnableDeleteButton=function(){try{return(this.selections.isActive()&&this.containers[this.currentContainerKey].childNodes.length>0);}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.shouldEnableDeleteAllButton=function(){try{if(!this.containers[this.currentContainerKey]){return false;}return(this.containers[this.currentContainerKey].childNodes.length>0);}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.shouldEnableMoveButtons=function(){try{return(this.selections.isActive()&&this.containers[this.currentContainerKey]&&this.containers[this.currentContainerKey].childNodes.length>1&&parseInt(this.selections.firstItem().getAttribute(mstrAdvancedThresholdEditor.EXP_COUNT))>0);}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.shouldEnableMoveUpButton=function(){try{if(!this.shouldEnableMoveButtons()){return false;}var t=this.selections.firstItem();return(t.previousSibling&&t.previousSibling.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_THRESHOLD);}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.shouldEnableMoveDownButton=function(){try{if(!this.shouldEnableMoveButtons()){return false;}var t=this.selections.firstItem();return(t.nextSibling&&t.nextSibling.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_THRESHOLD);}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.shouldEnableFormatButton=function(){try{return(this.selections.isActive())&&(this.selections.firstItem().getAttribute(mstrAdvancedThresholdEditor.EXP_COUNT)>0)&&(!this.isEditing(this.selections.firstItem()));}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.isAttributeSelected=function(){try{var meOpt=this.metricOptions,opt,isAtt=false,i;for(i=0;i<meOpt.length;i++){opt=meOpt.options[i];if(meOpt.currentOptionValue===opt.text){isAtt=(opt.oty==12);}}return isAtt;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.shouldEnableCopyButton=function(){try{return this.shouldEnableFormatButton();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.isEditingOnCurrentContainer=function(){if(!this.containers[this.currentContainerKey]){return false;}var ths=this.containers[this.currentContainerKey].childNodes;for(var i=0;i<ths.length;i++){if(this.isEditing(ths[i])){return false;}}return true;};mstrAdvancedThresholdEditor.prototype.isContainerEmpty=function(){var container=this.containers[this.currentContainerKey];return container&&(container.childNodes.length==0);};mstrAdvancedThresholdEditor.prototype.isEditing=function(targetItem){return targetItem&&(targetItem.getAttribute("expedit")==microstrategy.TRUE)&&(targetItem.getAttribute(mstrAdvancedThresholdEditor.EXP_EDIT_MODE)!=mstrAdvancedThresholdEditor.EXP_MODE_VIEW_MODE);};mstrAdvancedThresholdEditor.prototype.extractThresholdId=function(t){try{var id=t.getAttribute("id");return id.substr(id.lastIndexOf("_")+1);}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.moveThresholdDown=function(){try{if(!this.selections.isActive()){return ;}var t=this.selections.firstItem();var n=t.nextSibling;var n2=n.nextSibling;if(n2&&n2.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_THRESHOLD){t.parentNode.insertBefore(t,n2);this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.MOVE_THRESHOLD,this.beanPath,["111009","111001","111011"],[this.currentContainerKey,this.extractThresholdId(t),this.extractThresholdId(n2)],[],null)]);}else{var p=t.parentNode;p.removeChild(t);p.appendChild(t);this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.MOVE_THRESHOLD,this.beanPath,["111009","111001"],[this.currentContainerKey,this.extractThresholdId(t)],[],null)]);}this.observer.notifyAll("onselectionchange");this.isModified=true;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.moveThresholdUp=function(){try{if(!this.selections.isActive()){return ;}var t=this.selections.firstItem();var n=t.previousSibling;t.parentNode.insertBefore(t,n);this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.MOVE_THRESHOLD,this.beanPath,["111009","111001","111011"],[this.currentContainerKey,this.extractThresholdId(t),this.extractThresholdId(n)],[],null)]);this.observer.notifyAll("onselectionchange");this.isModified=true;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.copy=function(){try{this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.COPY_THRESHOLD,this.beanPath,["111009","111001"],[this.currentContainerKey,this.currentThresholdId],[],null)],true);this.enablePaste=true;this.onselectionchange();this.copyThresholdId=this.currentThresholdId;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.confirmPaste=function(type){try{var isEdit=false;for(var k in this.containers){var ths=this.containers[k].childNodes;for(var i=0;i<ths.length;i++){if(ths[i].getAttribute(mstrAdvancedThresholdEditor.EDIT_EXP)=="-1"&&ths[i].getAttribute(mstrAdvancedThresholdEditor.EXP_EDIT_MODE)!=mstrAdvancedThresholdEditor.EXP_MODE_VIEW_MODE){isEdit=true;var thElemId=ths[i].id;showMessage({contents:microstrategy.descriptors.getDescriptor("5981"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').deleteSingleThresholdById('"+thElemId+"','"+k+"');microstrategy.bone('"+this.id+"').paste();",cancelEval:"microstrategy.bone('"+this.id+"').changeMetric('"+k+"');",type:mstrMsgBoxImpl.MSG_WARNING});break;}}}if(!isEdit){this.paste();}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.paste=function(){try{this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.PASTE_THRESHOLD,this.beanPath,["111014"],[this.currentContainerKey],[],null)],true);this.submitUpdateManager();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.setEditorThresholdExpression=function(src){try{var obj=findTarget(src,microstrategy.HTMLATTR_SUBOBJTYPE);if(!obj){return true;}if(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_EXPRESSION){obj=findTarget(obj.parentNode,microstrategy.HTMLATTR_SUBOBJTYPE);}if(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==mstrAdvancedThresholdEditor.SUBOBJTYPE_ATE_THRESHOLD){this.selections.add(obj);}this.addSetEditorThresholdExpressionEvent();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.addSetEditorThresholdExpressionEvent=function(){try{this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.SET_EDITOR_THRESHOLD_EXPRESSION,this.beanPath,["111001","111009"],[this.currentThresholdId,this.currentContainerKey],[],null)]);}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.addSubExpression=function(){try{if(!this.validateAndShowMsg()){return ;}this.addSetEditorThresholdExpressionEvent();this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.SELECT_EXPRESSION_UNIT,this.thresholdExpressionBeanPath,[],[],[],null)]);this.submitUpdateManager();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.clearExpression=function(){try{if(!this.validateAndShowMsg()){return ;}this.addSetEditorThresholdExpressionEvent();this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.EXPRESSION_CLEAR_ALL,this.thresholdExpressionBeanPath,[],[],[],null)]);this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.EXPRESSION_SYNCHRONIZE,this.thresholdExpressionBeanPath,[],[],[],null)]);this.submitUpdateManager();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.validateAndShowMsg=function(){try{if(!this.validateThresholds(false)){showMessage({contents:microstrategy.descriptors.getDescriptor("5982"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return false;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrAdvancedThresholdEditor.prototype.confirmAddNewThreshold=function(type){try{var isEdit=false;for(var k in this.containers){var ths=this.containers[k].childNodes;for(var i=0;i<ths.length;i++){if(ths[i].getAttribute(mstrAdvancedThresholdEditor.EDIT_EXP)=="-1"&&ths[i].getAttribute(mstrAdvancedThresholdEditor.EXP_EDIT_MODE)!=mstrAdvancedThresholdEditor.EXP_MODE_VIEW_MODE){isEdit=true;var thElemId=ths[i].id;if(type){type="'"+type+"'";}showMessage({contents:microstrategy.descriptors.getDescriptor("5981"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').deleteSingleThresholdById('"+thElemId+"','"+k+"');microstrategy.bone('"+this.id+"').addNewThreshold("+type+");",cancelEval:"microstrategy.bone('"+this.id+"').changeMetric('"+k+"');",type:mstrMsgBoxImpl.MSG_WARNING});break;}}}if(!isEdit){this.addNewThreshold(type);}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.addNewThreshold=function(type){try{var div=document.getElementById("addThresholdLink");if(div!=null){div.style.display="none";}if(type){this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.ADD_SHORTCUT_THRESHOLD,this.beanPath,["111007","111009","111010"],[type.substr(3),this.currentContainerKey,microstrategy.descriptors.getDescriptor("4585")],[],null)]);}else{this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.ADD_THRESHOLD,this.beanPath,["111009","111010","111015"],[this.currentContainerKey,microstrategy.descriptors.getDescriptor("4585"),"1"],[],null)]);}this.submitUpdateManager();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.deleteSingleThreshold=function(t){try{if(t){this.deleteSingleThresholdById(t.id,this.currentContainerKey);}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.deleteSingleThresholdById=function(threshElemId,containerKey,norefresh){try{var threshElem=document.getElementById(threshElemId);if(threshElem){var tid=this.extractThresholdId(threshElem);this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.REMOVE_THRESHOLD,this.beanPath,["111009","111001","111013"],[containerKey,tid,mstrUpdateManager.UPDATE_LATER],[],null)]);threshElem.parentNode.removeChild(threshElem);if(this.containers[this.currentContainerKey].childNodes.length==0&&this.shouldEnableNewButton()){var div=document.getElementById("addThresholdLink");if(div!=null){div.style.display="block";}}if(this.currentThresholdId==this.copyThresholdId){this.enablePaste=false;}if(!norefresh){this.selections.clear(true);this.observer.notifyAll("onselectionchange");}this.validateThresholds(false);this.isModified=true;}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.deleteAllThresholds=function(){try{this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.CLEAR_THRESHOLDS,this.beanPath,["111009","111013"],[this.currentContainerKey,mstrUpdateManager.UPDATE_LATER],[],null)]);var container=this.containers[this.currentContainerKey];while(container.childNodes.length>0){container.removeChild(container.childNodes[0]);}this.selections.clear(true);this.observer.notifyAll("onselectionchange");this.validateThresholds(false);var div=document.getElementById("addThresholdLink");if(div!=null){div.style.display="block";}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.setScope=function(scope){try{var div=this.selections.firstItem();if(div.getAttribute("scp")!=scope){div.setAttribute("scp",scope);this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.EDIT_THRESHOLD,this.beanPath,["111001","111009","111016"],[this.currentThresholdId,this.currentContainerKey,scope],[],null)]);this.observer.notifyAll("onselectionchange");this.isModified=true;}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.setGraph=function(graph){try{graph=Math.min(graph,0);var div=this.selections.firstItem();if(div.getAttribute("grph")!=graph){div.setAttribute("grph",graph);this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.EDIT_THRESHOLD,this.beanPath,["111001","111009","111002"],[this.currentThresholdId,this.currentContainerKey,"FormattingPatterns"+this.valueSeparator+"ApplyToGraphThreshold"+this.valueSeparator+graph],[],null)]);this.observer.notifyAll("onselectionchange");this.isModified=true;}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.getSelectedThreshold=function(){try{return this.currentThresholdProps;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.changeThresholdFormatProp=function(fName,fValue){try{var f=(fName=="type"||fName=="src")?this.getSelectedThreshold().formatting.rplc:this.getSelectedThreshold().formatting;var forceApply=fName=="pfs"||fName=="btc"||fName=="bbc"||fName=="blc"||fName=="brc"||fName=="bts"||fName=="bbs"||fName=="bls"||fName=="brs";if(f&&fName in f&&(forceApply||fValue!=f[fName])){f[fName]=fValue;var propNames=["111001","111009"];var propValues=[this.currentThresholdId,this.currentContainerKey];switch(fName){case"type":propNames.push("111003");propValues.push(fValue);break;case"src":propNames.push("111004");propValues.push(fValue);break;default:propNames.push("111002");propValues.push(mstrThresholdEditor.PROPERTY_CONVERSION[fName].ps+this.valueSeparator+mstrThresholdEditor.PROPERTY_CONVERSION[fName].p+this.valueSeparator+fValue);break;}this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.EDIT_THRESHOLD,this.beanPath,propNames,propValues,[],null)]);}}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.getThresholdFormatValue=function(format,propName){try{if(propName=="type"||propName=="src"){return format.rplc[propName];}else{return format[propName];}}catch(err){microstrategy.errors.log(err);}return null;};mstrAdvancedThresholdEditor.prototype.changeThresholdName=function(tName){try{this.currentThresholdProps.name=tName;this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.EDIT_THRESHOLD,this.beanPath,["111001","111010"],[this.currentThresholdId,tName],[],null)]);}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.onchangeAllowToggleThresholds=function(){var checkbox=document.getElementById("allowToggleThresholds");if(checkbox!=null){var value=checkbox.checked?"-1":"0";this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.ALLOW_TOGGLE_THRESHOLDS,this.beanPath,["111012"],[value],[],[])]);}};mstrAdvancedThresholdEditor.prototype.cancelChanges=function(){try{this.closeEditor();this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.CANCEL_THRESHOLD_CHANGES,this.beanPath,[],[],[],[])]);return false;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.validateThresholds=function(hardValidation){try{for(var k in this.containers){for(var i=0;i<this.containers[k].childNodes.length;i++){var thresholdElem=this.containers[k].childNodes[i];if(thresholdElem.getAttribute(mstrAdvancedThresholdEditor.EXP_COUNT)=="0"){if(hardValidation){if(thresholdElem.getAttribute(mstrAdvancedThresholdEditor.EXP_EDIT_MODE)==mstrAdvancedThresholdEditor.EXP_MODE_SELECT_UNIT){this.deleteSingleThresholdById(thresholdElem.id,k,true);if(this.statusBar){this.statusBar.innerHTML="";}return true;}}this.changeMetric(k);thresholdElem.style.backgroundColor="#FF5959";if(hardValidation||thresholdElem.getAttribute(mstrAdvancedThresholdEditor.EDIT_EXP)!=microstrategy.TRUE){if(this.statusBar){this.statusBar.innerHTML=microstrategy.descriptors.getDescriptor("7495").replace("##",this.containers[k].getAttribute(microstrategy.HTMLATTR_DESCRIPTION));}}return false;}}}if(this.statusBar){this.statusBar.innerHTML="";}}catch(err){microstrategy.errors.log(err);}return true;};mstrAdvancedThresholdEditor.prototype.okChanges=function(){try{if(!this.validateThresholds(true)){return ;}this.close();this.applyChanges(true);microstrategy.unRegisterBone(this.id);this.submitUpdateManager();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.applyChanges=function(noSubmit){try{if(!this.validateThresholds(true)){return false;}noSubmit=noSubmit||false;this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.APPLY_THRESHOLD_CHANGES,this.beanPath,[],[],[],[])]);if(!noSubmit){this.submitUpdateManager();}return true;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.submitUpdateManager=function(){try{this.um.addURL(this.getExtraURL());this.um.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.getExtraURL=function(){try{return"container="+this.currentContainerKey+"&thresholdId="+this.currentThresholdId;}catch(err){microstrategy.errors.log(err);}};mstrAdvancedThresholdEditor.prototype.openAlertsEditor=function(shouldSave,deliveryMode){try{var res=true;if(shouldSave){res=this.applyChanges(true);}if(res){this.close();this.um.add([this.um.createActionObject(this.elem,mstrUpdateManager.COPY_THRESHOLDS_TO_ALERTS,this.viewBeanPath,["4010","4238","4110"],[this.currentContainerKey,this.currentThresholdId,"true"],[],[])]);this.um.replaceURL("container",this.currentContainerKey);if(deliveryMode){this.um.replaceURL("deliveryMode",deliveryMode);}if(parseInt(deliveryMode)==1){toggleShowBean("alertsEditor",true,"");}else{toggleShowBean("mobileAlertsEditor",true,"");}}}catch(err){microstrategy.errors.log(err);}};function mstrAdvancedThresholdEditor(id){this.inherits=mstrThresholdEditor;this.inherits(id);delete this.inherits;return this;}mstrATECommandsImpl.prototype=new mstrTECommandsImpl();mstrATECommandsImpl.prototype.exec=function(cmdId,cmdVal){try{switch(cmdId){case"ateMetrics":this.parentBone.changeMetric(cmdVal);return true;case"ateCopy":this.parentBone.copy();break;case"atePaste":this.parentBone.confirmPaste();return true;case"ateNewThreshold":this.parentBone.confirmAddNewThreshold(cmdVal);return true;break;case"ateMoveDown":this.parentBone.moveThresholdDown();return true;case"ateMoveUp":this.parentBone.moveThresholdUp();return true;case"ateDelete":this.parentBone.deleteSingleThreshold(this.parentBone.selections.firstItem());return true;case"ateDeleteAll":this.parentBone.deleteAllThresholds();return true;case"ateClearSE":this.parentBone.clearExpression();return true;case"ateAddSE":this.parentBone.addSubExpression();return true;case"ateFormat":this.parentBone.showFormatDialog();break;case"ateGraph":this.parentBone.setGraph(cmdVal);break;case"ateScope":this.parentBone.setScope(cmdVal);break;case"ateAlerts":if(this.parentBone.selections.firstItem().getAttribute(mstrAdvancedThresholdEditor.EXP_IS_ON_GRID)=="0"){showMessage({contents:microstrategy.descriptors.getDescriptor("7498"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});}else{if(this.parentBone.isModified){var okJS="microstrategy.bone('"+this.parentBone.id+"').openAlertsEditor(true,"+cmdVal+")";var cancelJS="microstrategy.bone('"+this.parentBone.id+"').openAlertsEditor(false,"+cmdVal+")";showMessage({contents:microstrategy.descriptors.getDescriptor("6065"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:okJS,cancelEval:cancelJS,title:microstrategy.descriptors.getDescriptor("5728")});}else{this.parentBone.openAlertsEditor(false,cmdVal);}}break;case"formatBulk":if(mstrTECommandsImpl.prototype.exec.call(this,cmdId,cmdVal)){this.parentBone.submitUpdateManager();}return true;default:return mstrTECommandsImpl.prototype.exec.call(this,cmdId,cmdVal);break;}}catch(err){microstrategy.errors.log(err);}return null;};mstrATECommandsImpl.prototype.customUpdate=function(ctrl){var name=ctrl.getAttribute("name"),descM=ctrl.getAttribute("descidm"),descA=ctrl.getAttribute("descida"),isAtt=this.parentBone.isAttributeSelected();try{switch(name){case"tbMetricOnly":ctrl.id=isAtt?"tbAttributeOnly":"tbMetricOnly";ctrl.title=isAtt?microstrategy.descriptors.getDescriptor(descA):microstrategy.descriptors.getDescriptor(descM);break;case"tbMetricAndSub":ctrl.id=isAtt?"tbAttributeAndSub":"tbMetricAndSub";ctrl.title=isAtt?microstrategy.descriptors.getDescriptor(descA):microstrategy.descriptors.getDescriptor(descM);break;}}catch(err){microstrategy.errors.log(err);}return true;};mstrATECommandsImpl.prototype.queryEnabled=function(cmdId){try{if(cmdId=="onegrid"){return false;}if(!cmdId||cmdId=="isSelectionsPresent"){return true;}switch(cmdId){case"ateMetrics":return this.parentBone.metricOptions.length>0;case"ateNewThreshold":return this.parentBone.shouldEnableNewButton();case"ateCopy":return this.parentBone.shouldEnableCopyButton();break;case"ateAddSE":return this.parentBone.selections.isActive()&&this.parentBone.isEditingOnCurrentContainer();case"ateClearSE":return this.queryEnabled("ateAddSE")&&!this.parentBone.isContainerEmpty();case"ateFormat":return this.parentBone.shouldEnableFormatButton();case"ateGraph":var selections=this.parentBone.selections,isAct=selections.isActive(),validType=true;if(isAct){var containerType=parseInt(this.parentBone[mstrAdvancedThresholdEditor.CONTAINER_TYPE]);if(containerType){validType=containerType!=microstrategy.SUBOBJTYPE_DOC_LINE&&containerType!=microstrategy.SUBOBJTYPE_DOC_SHAPE&&containerType!=microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND;}}return isAct&&parseInt(selections.firstItem().getAttribute(mstrAdvancedThresholdEditor.EXP_COUNT))>0&&validType&&!this.parentBone.isAttributeSelected();case"ateScope":var selections=this.parentBone.selections,isAct=selections.isActive(),validType=true;if(isAct){var containerType=parseInt(this.parentBone[mstrAdvancedThresholdEditor.CONTAINER_TYPE]);if(containerType){validType=containerType!=microstrategy.SUBOBJTYPE_DOC_LINE&&containerType!=microstrategy.SUBOBJTYPE_DOC_SHAPE&&containerType!=microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND;}}return isAct&&parseInt(selections.firstItem().getAttribute(mstrAdvancedThresholdEditor.EXP_COUNT))>0&&validType;case"ateAlerts":return this.parentBone.selections.isActive()&&this.parentBone.isEditingOnCurrentContainer();case"atePaste":return this.parentBone.enablePaste;case"ateDelete":return this.parentBone.shouldEnableDeleteButton();break;case"ateDeleteAll":return this.parentBone.shouldEnableDeleteAllButton();break;case"ateMoveDown":return this.parentBone.shouldEnableMoveDownButton();break;case"ateMoveUp":return this.parentBone.shouldEnableMoveUpButton();break;case"DecimalPlaces":case"CurrencySymbol":case"ThousandSeparator":case"CurrencyPosition":case"NegativeNumbers":case"font":case"fsize":case"fstyle":case"color":case"Horizontal":case"bgcolor":case"LeftStyle":case"LeftColor":case"TopStyle":case"TopColor":case"RightStyle":case"RightColor":case"BottomStyle":case"BottomColor":case"replaceValue":return true;break;default:return mstrTECommandsImpl.prototype.queryEnabled.call(this,cmdId);break;}}catch(err){microstrategy.errors.log(err);}return false;};mstrATECommandsImpl.prototype.queryState=function(cmdId){try{switch(cmdId){case"selectedItems":return this.item;break;case"ateMetrics":return this.parentBone.metricOptions;case"ateNewThreshold":return true;case"ateAlerts":case"ateCopy":case"atePaste":case"ateDelete":case"ateDeleteAll":case"ateMoveDown":case"ateMoveUp":case"ateClearSE":case"ateAddSE":case"ateFormat":return false;break;case"ateGraph":var t=this.parentBone.selections.firstItem();return parseInt(t.getAttribute("grph"));break;case"ateScope":var t=this.parentBone.selections.firstItem();return parseInt(t.getAttribute("scp"));break;case"gradientcolor":return mstrTECommandsImpl.prototype.queryState.call(this,"gradient");break;default:return mstrTECommandsImpl.prototype.queryState.call(this,cmdId);break;}}catch(err){microstrategy.errors.log(err);}return null;};function mstrATECommandsImpl(p){this.inherits=mstrTECommandsImpl;this.inherits(p);delete this.inherits;return this;}mstrAdvancedThresholdsEditorSelectionsImpl.prototype=new mstrSelectionsImpl();mstrAdvancedThresholdsEditorSelectionsImpl.prototype.add=function(obj){try{this.clear(false);mstrSelectionsImpl.prototype.add.call(this,obj);}catch(err){microstrategy.errors.log(err);}};function mstrAdvancedThresholdsEditorSelectionsImpl(bone){this.inherits=mstrSelectionsImpl;this.inherits(bone);delete this.inherits;return this;}