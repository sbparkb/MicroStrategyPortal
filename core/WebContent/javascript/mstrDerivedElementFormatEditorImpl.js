mstrDerivedElementFormatEditorImplScript=true;mstrDerivedElementFormatEditorImpl.prototype=new mstrFormatImpl();mstrDerivedElementFormatEditorImpl.prototype.formatSelector=null;mstrDerivedElementFormatEditorImpl.prototype.formats=null;mstrDerivedElementFormatEditorImpl.prototype.curFormat=null;mstrDerivedElementFormatEditorImpl.prototype.targetPath=null;mstrDerivedElementFormatEditorImpl.prototype.onload=function(){mstrFormatImpl.prototype.onload.call(this);this.setAppliesTo(this);this.commands=new mstrDEFCommandsImpl(this);this.formatSelector=microstrategy.findChildWithAtt(this.elem,"select","id","deFormatSelector");if(this.formatSelector){this.formatSelector.onclick=new Function("e","return microstrategy.bone('"+this.id+"').onFormatSelectorChange();");}if(this.formats){for(var i=0;i<this.formats.length;i++){this.formats[i]=new mstrFormatHelper(this.formats[i]);}this.curFormat=this.formats[this.formatSelector.value];}};mstrDerivedElementFormatEditorImpl.prototype.onFormatSelectorChange=function(){try{if(!this.formatSelector){return ;}var optionSelected=this.formatSelector.value;var newCurFormat=this.formats[optionSelected];if(newCurFormat!=this.curFormat){this.applyFormatChanges();this.curFormat=newCurFormat;this.onpostload();}}catch(err){microstrategy.errors.log(err);}};mstrDerivedElementFormatEditorImpl.prototype.initSelections=function(){};mstrDerivedElementFormatEditorImpl.prototype.okChanges=function(){try{this.close();this.applyChanges();}catch(err){microstrategy.errors.log(err);}};mstrDerivedElementFormatEditorImpl.prototype.applyChanges=function(){try{this.applyFormatChanges();this.saveChanges();}catch(err){microstrategy.errors.log(err);}};mstrDerivedElementFormatEditorImpl.prototype.saveChanges=function(){try{var um=microstrategy.updateManager;var ac=new Array();for(var i=0;i<this.formats.length;i++){var format=this.formats[i];var updateString=format.buildUpdateString();if(updateString.length>0){var names=new Array();var values=new Array();names.push("109004");values.push(updateString);names.push("109003");values.push(i);ac.push(um.createActionObject(null,mstrUpdateManager.DE_UPDATE_FORMAT,this.targetPath,names,values));}}um.add(ac);}catch(err){microstrategy.errors.log(err);}};mstrDerivedElementFormatEditorImpl.prototype.cancelChanges=function(){try{this.close();for(var i=0;i<this.formats.length;i++){this.formats[i].cancelChanges();}this.onpostload();return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDerivedElementFormatEditorImpl.prototype.closeEditor=function(){try{this.cancelChanges();return true;}catch(err){microstrategy.errors.log(err);return false;}};function mstrDerivedElementFormatEditorImpl(id){this.inherits=mstrFormatImpl;this.inherits(id);delete this.inherits;return this;}mstrDEFCommandsImpl.prototype=new Object();mstrDEFCommandsImpl.prototype.item=null;mstrDEFCommandsImpl.prototype.exec=function(cmdId,cmdValue){try{if(cmdId=="edtColorPicker"){var params=cmdValue.split("|");microstrategy.openDialog("edtColorPicker",null,null,microstrategy.servletName+"."+microstrategy.pageName,{activeBoneID:params[0],activeControlID:params[1],currentColor:params[2]});microstrategy.updateManager.replaceURL("selectedTabOptions",params[3]);microstrategy.updateManager.replaceURL("selectedFormatIdx",this.parentBone.formatSelector.value);microstrategy.updateManager.flushAndSubmitChanges();}else{if(cmdId=="edtColorGradient"){var dialogName=(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION)?"gridEdtColorGradient":"rwdEdtColorGradient";var params=cmdValue.split("|");var url,selectedTabOptions;if(params.length>6){url="parentBoneID="+params[0]+"&controlID="+params[1]+"&activeViewKey="+params[2]+"startFromSolid="+false+"&retrieveGradient="+false+"&color1="+params[4]+"&color2="+params[5]+"&angle="+params[6]+"&xOffset="+params[7]+"&yOffset="+params[8]+"&formatType="+microstrategy.formatType;selectedTabOptions=params[9];}else{if(params.length==6){var startColor=(params[4]=="transparent")?"#FFFFFF":params[4];url="parentBoneID="+params[0]+"&controlID="+params[1]+"&activeViewKey="+params[2]+"&retrieveGradient="+false+"&color1="+startColor+"&startFromSolid="+true+"&formatType="+microstrategy.formatType;selectedTabOptions=params[5];}}microstrategy.openDialog(dialogName,url,null,microstrategy.servletName+"."+microstrategy.pageName);microstrategy.updateManager.replaceURL("selectedTabOptions",selectedTabOptions);microstrategy.updateManager.replaceURL("selectedFormatIdx",this.parentBone.formatSelector.value);microstrategy.updateManager.flushAndSubmitChanges();}else{if(this.parentBone.curFormat){return this.parentBone.curFormat.exec(cmdId,cmdValue);}}}return false;}catch(err){microstrategy.errors.log(err);}};mstrDEFCommandsImpl.prototype.queryEnabled=function(cmdId){try{if(!cmdId){return true;}switch(cmdId){case"isSelectionsPresent":return true;default:if(this.parentBone.curFormat){return this.parentBone.curFormat&&this.parentBone.curFormat.queryEnabled(cmdId);}return false;}}catch(err){microstrategy.errors.log(err);}};mstrDEFCommandsImpl.prototype.queryState=function(cmdId){try{switch(cmdId){case"selectedItems":return this.item;break;case"gradientcolor":if(this.parentBone.curFormat){return this.parentBone.curFormat.queryState("gradient");}break;default:if(this.parentBone.curFormat){return this.parentBone.curFormat.queryState(cmdId);}return false;}}catch(err){microstrategy.errors.log(err);}return null;};function mstrDEFCommandsImpl(p){if(p){this.parentBone=p;var s=document.createElement("span");s.setAttribute(microstrategy.HTMLATTR_OBJTYPE,microstrategy.FORMATTING_PROP_DERIVED_ELEMENT);this.item={"1":s};}return this;}