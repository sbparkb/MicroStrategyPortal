mstrTemplateImpl.prototype={};mstrTemplateImpl.prototype.parentBone=null;mstrTemplateImpl.prototype.target=null;mstrTemplateImpl.prototype.gridInfo=null;mstrTemplateImpl.prototype.fp=null;mstrTemplateImpl.prototype.showAttForms=true;mstrTemplateImpl.prototype.onload=function(template,parent,fp){try{this.target=template;this.parentBone=parent;this.showAttForms=this.parentBone.showAttForms;this.fp=fp;this.gridInfo=this.parentBone.gridStructureInfo;return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrTemplateImpl.prototype.prepareColGroupAndHandles=function(){try{if(!this.parentBone.quickSearchEnabled||!mstrGridReport.isDesignMode()||!(this.parentBone.isGrid&&mstrGridReport.isReport())){return ;}var template=this.target;var colgroup=template.getElementsByTagName("COLGROUP")[0];if(colgroup){template.removeChild(colgroup);}colgroup=document.createElement("colgroup");var tbody=template.getElementsByTagName("TBODY")[0];var colCount=tbody.rows[0].childNodes.length;for(var i=0;i<colCount;i++){var col=document.createElement("col");colgroup.appendChild(col);}template.insertBefore(colgroup,tbody);var div=template.parentNode;var handles=microstrategy.findChildrenWithAtt(div,"div","sty","vline");for(var i in handles){div.removeChild(handles[i]);}this.parentBone.initColResize();}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.buildEmptyTemplate=function(cellPrefix,hasMetrics){try{var gridTable=document.createElement("table");gridTable.setAttribute("width","100%");gridTable.border=0;gridTable.cellSpacing=0;gridTable.cellPadding=0;gridTable.className=cellPrefix+"default";gridTable.style.fontSize=(8*(microstrategy.ZOOM_FACTOR/100))+"pt";gridTable.appendChild(document.createElement("tbody"));mstrTemplateImpl.buildEmptyTemplateRows(gridTable,cellPrefix,hasMetrics);return gridTable;}catch(err){microstrategy.errors.log(err);return null;}};mstrTemplateImpl.buildEmptyTemplateRows=function(gridTable,cellPrefix,hasMetrics){try{var tbody=gridTable.getElementsByTagName("TBODY")[0];mstrTemplateImpl.removeAllChildren(tbody);var row=tbody.insertRow(-1);mstrTemplateImpl.buildEmptyTemplateCell(row.insertCell(row.cells.length),null,cellPrefix);mstrTemplateImpl.buildEmptyTemplateCell(row.insertCell(row.cells.length),microstrategy.GRIDCELL_AXIS_COLUMNS,cellPrefix);row=tbody.insertRow(-1);mstrTemplateImpl.buildEmptyTemplateCell(row.insertCell(row.cells.length),microstrategy.GRIDCELL_AXIS_ROWS,cellPrefix);if(hasMetrics){row.appendChild(mstrTemplateImpl.buildEmptyCell(microstrategy.GRIDCELL_AXIS_METRICS,cellPrefix));}else{mstrTemplateImpl.buildEmptyTemplateCell(row.insertCell(row.cells.length),microstrategy.GRIDCELL_AXIS_METRICS,cellPrefix);}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.buildEmptyTemplateCell=function(td,axis,cellPrefix){try{switch(axis){case null:td.className="r-rowTitle r-cell";td.innerHTML="&nbsp;";break;case microstrategy.GRIDCELL_AXIS_ROWS:td.className="r-rowHeader r-cell";td.appendChild(document.createTextNode(microstrategy.descriptors.getDescriptor("4500")));break;case microstrategy.GRIDCELL_AXIS_COLUMNS:td.className="r-colHeader r-cell";td.appendChild(document.createTextNode(microstrategy.descriptors.getDescriptor("4502")));break;case microstrategy.GRIDCELL_AXIS_METRICS:td.className="r-metricValue r-cell";td.appendChild(document.createTextNode(microstrategy.descriptors.getDescriptor("4501")));break;}td.appendChild(document.createElement("br"));if(axis&&mstrGridReport.createQuickSearchPlaceHolder){td.appendChild(mstrGridReport.createQuickSearchPlaceHolder(axis));}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.buildEmptyCell=function(axis,cellPrefix){try{var td=document.createElement("td");td.innerHTML="&nbsp;";td.appendChild(document.createElement("br"));td.className=(axis==microstrategy.GRIDCELL_AXIS_ROWS)?cellPrefix+"rowTitle":cellPrefix+"metricValue";return td;}catch(err){microstrategy.errors.log(err);return false;}};mstrTemplateImpl.removeAllChildren=function(elem){try{while(elem.hasChildNodes()){elem.removeChild(elem.firstChild);}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.buildPreviewCell=function(cell,className,label){try{var td=cell.cloneNode(true);td.className+=" "+className;td.innerHTML="&lt;"+label+"&gt;";return td;}catch(err){microstrategy.errors.log(err);}return cell;};mstrTemplateImpl.prototype.buildEmptyRows=function(rowCells,colCells,metricCells){try{this.target.className=this.target.className.replace("metricsOnRows","");var tbody=this.target.getElementsByTagName("TBODY")[0];var tr=tbody.insertRow(-1);var td,i;if(!rowCells||rowCells.length==0){mstrTemplateImpl.buildEmptyTemplateCell(tr.insertCell(tr.cells.length),microstrategy.GRIDCELL_AXIS_ROWS,this.parentBone.gridCellCssPrefix);}else{td=this.buildHeaderCell(microstrategy.GRIDCELL_AXIS_ROWS);for(i=0;i<rowCells.length;i++){tr.appendChild(this.buildPreviewCell(td,"r-cell-preview",rowCells[i].getAttribute(microstrategy.HTMLATTR_DESCRIPTION)));}}if(colCells&&colCells.length>0){tr.appendChild(this.buildHeaderCell(microstrategy.GRIDCELL_AXIS_ROWS));}if(!metricCells||metricCells.length==0){mstrTemplateImpl.buildEmptyTemplateCell(tr.insertCell(tr.cells.length),microstrategy.GRIDCELL_AXIS_METRICS,this.parentBone.gridCellCssPrefix);}else{if(this.gridInfo.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS){td=mstrTemplateImpl.buildEmptyCell(microstrategy.GRIDCELL_AXIS_METRICS,this.parentBone.gridCellCssPrefix);for(i=0;i<metricCells.length;i++){tr.appendChild(this.buildPreviewCell(td,"r-cell-preview",metricCells[i].getAttribute(microstrategy.HTMLATTR_DESCRIPTION)));}}else{tr.appendChild(this.buildPreviewCell(mstrTemplateImpl.buildEmptyCell(microstrategy.GRIDCELL_AXIS_METRICS,this.parentBone.gridCellCssPrefix),"r-cell-preview",metricCells[0].getAttribute(microstrategy.HTMLATTR_DESCRIPTION)));}}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.buildMetricsRows=function(rowCells,metricCells){try{if(this.target.className.indexOf("metricsOnRows")==-1){this.target.className+=" metricsOnRows";}var tbody=this.target.getElementsByTagName("TBODY")[0];var td=this.buildHeaderCell(microstrategy.GRIDCELL_AXIS_ROWS);var depth=this.gridInfo.rowAxis.unitLength(this.gridInfo.metricsDepth);var j;for(var i=0;i<metricCells.length;i++){var row=tbody.insertRow(-1);for(j=1;j<depth;j++){row.appendChild(this.buildPreviewCell(td,"r-cell-preview",rowCells[j-1].getAttribute(microstrategy.HTMLATTR_DESCRIPTION)));}row.appendChild(metricCells[i]);for(j=depth;j<rowCells.length;j++){row.appendChild(this.buildPreviewCell(td,"r-cell-preview",rowCells[j].getAttribute(microstrategy.HTMLATTR_DESCRIPTION)));}if(this.gridInfo.colAxis.size()>0){row.appendChild(td.cloneNode(true));}row.appendChild(this.buildPreviewCell(mstrTemplateImpl.buildEmptyCell(microstrategy.GRIDCELL_AXIS_METRICS,this.parentBone.gridCellCssPrefix)," ",metricCells[i].getAttribute(microstrategy.HTMLATTR_DESCRIPTION)));}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.buildHeaderCell=function(axis){try{var td=document.createElement("td");td.innerHTML="&nbsp;";td.appendChild(document.createElement("br"));var cellPrefix=this.parentBone.gridCellCssPrefix;td.className=(axis==microstrategy.GRIDCELL_AXIS_ROWS)?cellPrefix+"rowHeader":cellPrefix+"colHeader";return td;}catch(err){microstrategy.errors.log(err);return false;}};mstrTemplateImpl.prototype.buildTitleCell=function(objInfo){try{var td=document.createElement("td");td.setAttribute(microstrategy.HTMLATTR_TARGET,"TRUE",0);td.setAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH.toUpperCase(),objInfo.depth,0);td.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,objInfo.subtype,0);if(objInfo.isLocked){td.setAttribute(microstrategy.HTMLATTR_IS_LOCKED,microstrategy.TRUE);}if(objInfo.dssId!=null&&objInfo.dssId.length>0){td.setAttribute(microstrategy.HTMLATTR_DSS_ID,objInfo.dssId,0);td.setAttribute(microstrategy.HTMLATTR_DSS_TYPE,objInfo.dssType,0);if(objInfo.dssSubtype){td.setAttribute(microstrategy.HTMLATTR_DSS_SUBTYPE,objInfo.dssSubtype,0);}}else{if(objInfo.alias){td.setAttribute("mh","TRUE",0);}}var alias=objInfo.alias;var cellPrefix=this.parentBone.gridCellCssPrefix;if(objInfo.subtype==microstrategy.SUBOBJTYPE_METRIC){var axis=this.gridInfo.metricsAxis;td.setAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS,axis,0);if(axis==microstrategy.GRIDCELL_AXIS_ROWS){td.setAttribute(microstrategy.HTMLATTR_ORIENTATION,microstrategy.GRIDCELL_ORIENTATION_HORIZONTAL,0);td.className=cellPrefix+"rowHeader";}else{td.setAttribute(microstrategy.HTMLATTR_ORIENTATION,microstrategy.GRIDCELL_ORIENTATION_VERTICAL,0);td.className=cellPrefix+"colHeader";}}else{td.setAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS,objInfo.axis,0);td.setAttribute(microstrategy.HTMLATTR_FORM_ID,objInfo.attFormId,0);td.setAttribute(microstrategy.HTMLATTR_FORM_NAME,objInfo.attFormName,0);if(objInfo.attFormList!=null){td.setAttribute(microstrategy.HTMLATTR_FORM_LIST,objInfo.attFormList.toString(),0);}td.setAttribute(microstrategy.HTMLATTR_FORM_POS,objInfo.subDepth,0);if(objInfo.subtype==microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM){td.setAttribute(microstrategy.HTMLATTR_DSS_ID,objInfo.parentDssId,0);alias=objInfo.parentAlias+" "+objInfo.alias;}if(objInfo.axis==microstrategy.GRIDCELL_AXIS_ROWS){td.setAttribute(microstrategy.HTMLATTR_GRIDROW_MAX_DEPTH,(this.gridInfo.colAxis.size()>0)?this.gridInfo.colAxis.size():1,0);td.setAttribute(microstrategy.HTMLATTR_ORIENTATION,microstrategy.GRIDCELL_ORIENTATION_VERTICAL,0);td.className=cellPrefix+"rowTitle";}else{td.setAttribute(microstrategy.HTMLATTR_GRIDROW_MAX_DEPTH,this.gridInfo.rowAxis.size()+1,0);td.setAttribute(microstrategy.HTMLATTR_ORIENTATION,microstrategy.GRIDCELL_ORIENTATION_HORIZONTAL,0);td.className=cellPrefix+"colTitle";}}if(alias!=null&&alias.length>0){if(this.fp.isDragAndDropEnabled||this.parentBone.showGraphDropZones){td.setAttribute("dg","TRUE",0);td.style.cursor=(bIsIE4)?"hand":"pointer";}var tip=alias;if(this.fp.showDescriptionAsTooltip!=microstrategy.FALSE&&objInfo.description.length>0){tip+="; "+objInfo.description;}else{if((this.fp.isDragAndDropEnabled||this.parentBone.showGraphDropZones)&&!this.parentBone.commands.queryEnabled("isLinkedGrid")){tip+="; "+microstrategy.descriptors.getDescriptor("2146");}if(this.fp.isContextMenuEnabled&&!this.parentBone.commands.queryEnabled("isLinkedGrid")){tip+="; "+microstrategy.descriptors.getDescriptor("2142");}}td.setAttribute("title",tip,0);td.setAttribute(microstrategy.HTMLATTR_DESCRIPTION,alias,0);td.setAttribute(microstrategy.HTMLATTR_DSS_DESCRIPTION,objInfo.description,0);td.appendChild(document.createTextNode(alias));}td.appendChild(document.createElement("br"));objInfo.src=td;return td;}catch(err){microstrategy.errors.log(err);return false;}};mstrTemplateImpl.prototype.buildTitleCellCollection=function(axis){try{var __result=null;var axisLength=axis.size();if(axisLength>0){__result=[];for(var i=0;i<axisLength;i++){var gridInfo=axis.units[i];if(this.showAttForms&&gridInfo.attForms!=null&&gridInfo.attForms.size()>1){for(var j=0;j<gridInfo.attForms.size();j++){__result.push(this.buildTitleCell(gridInfo.attForms.units[j]));}gridInfo.src=gridInfo.attForms.units[0].src;}else{__result.push(this.buildTitleCell(gridInfo));if(gridInfo.hasAttForms()){gridInfo.attForms.units[0].src=gridInfo.src;}}}if(axis.axisType!=microstrategy.GRIDCELL_AXIS_METRICS||this.gridInfo.metricsAxis!=microstrategy.GRIDCELL_AXIS_ROWS){__result=this.buildAxisPivotButtons(__result);}__result=this.buildAxisContextMenus(__result);}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrTemplateImpl.prototype.buildAxisPivotButtons=function(cells){try{if(this.fp.showPivot&&cells.length>0&&!this.parentBone.commands.queryEnabled("isLinkedGrid")){var pbSpan=document.createElement("span");pbSpan.className="mstrIconPivot";pbSpan.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_BTN);var axisLength=cells.length;var axis=(cells[0].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_METRIC)?microstrategy.GRIDCELL_AXIS_METRICS:parseInt(cells[0].getAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS));var orientation=cells[0].getAttribute(microstrategy.HTMLATTR_ORIENTATION);for(var i=0;i<axisLength;i++){if(orientation==microstrategy.GRIDCELL_ORIENTATION_VERTICAL){if(i>0){cells[i].appendChild(this.addPivotImage(pbSpan,microstrategy.FOLDER_IMAGES+this.fp.imgShiftLeft,microstrategy.descriptors.getDescriptor("142"),"l"));}if(i<axisLength-1){cells[i].appendChild(this.addPivotImage(pbSpan,microstrategy.FOLDER_IMAGES+this.fp.imgShiftRight,microstrategy.descriptors.getDescriptor("143"),"r"));}if(axis==microstrategy.GRIDCELL_AXIS_ROWS){cells[i].appendChild(this.addPivotImage(pbSpan,microstrategy.FOLDER_IMAGES+this.fp.imgShiftRightUp,microstrategy.descriptors.getDescriptor("141"),"c"));}}else{if(axis==microstrategy.GRIDCELL_AXIS_COLUMNS){cells[i].appendChild(this.addPivotImage(pbSpan,microstrategy.FOLDER_IMAGES+this.fp.imgShiftLeftDown,microstrategy.descriptors.getDescriptor("137"),"c"));}if(i>0){cells[i].appendChild(this.addPivotImage(pbSpan,microstrategy.FOLDER_IMAGES+this.fp.imgShiftUp,microstrategy.descriptors.getDescriptor("138"),"u"));}if(i<axisLength-1){cells[i].appendChild(this.addPivotImage(pbSpan,microstrategy.FOLDER_IMAGES+this.fp.imgShiftDown,microstrategy.descriptors.getDescriptor("139"),"d"));}}if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){if(cells[i].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_METRIC){cells[i].appendChild(this.addPivotImage(pbSpan,microstrategy.FOLDER_IMAGES+this.fp.imgToPageBy,microstrategy.descriptors.getDescriptor("140"),"p"));}}if(this.fp.showRemove){var tooltipDescId=this.parentBone.isFeatureAvailable(microstrategy.FEATURE_WEB_REMOVE_FROM_GRID)?"2214":"2216";cells[i].appendChild(this.addPivotImage(pbSpan,microstrategy.FOLDER_IMAGES+this.fp.imgRemove,microstrategy.descriptors.getDescriptor(tooltipDescId),"x"));}}}return cells;}catch(err){microstrategy.errors.log(err);return cells;}};mstrTemplateImpl.prototype.addPivotImage=function(pbSpan,src,title,id){try{var i=pbSpan.cloneNode(false);i.setAttribute("title",title);i.setAttribute("id",id);i.className+=" "+id;return i;}catch(err){microstrategy.errors.log(err);return img;}};mstrTemplateImpl.prototype.buildShortcutContextMenus=function(root,parentMenu){try{var cmm=microstrategy.getContextMenuManager("vb_GM");var menu=cmm.getMenu();var ptmMenu=cmm.getMenu();var rMenu=cmm.getMenu();var exclusionFilter=[microstrategy.DSSTYPE_FILTER];var breakBy=microstrategy.descriptors.getDescriptor("3331").split("##");var sortMenu=cmm.getMenu();sortMenu.addItem(microstrategy.descriptors.getDescriptor("1885"),root+"('rm', '"+SORT_ASCENDING+",n');","");sortMenu.addItem(microstrategy.descriptors.getDescriptor("1886"),root+"('rm', '"+SORT_DESCENDING+",n');","");rMenu.addItem(breakBy[0]+microstrategy.descriptors.getDescriptor("2057"),sortMenu);if(this.gridInfo.hasNonMetricUnitsOnAxis(microstrategy.GRIDCELL_AXIS_ROWS)&&!this.gridInfo.unitTypeExistsOnAxis(microstrategy.GRIDCELL_AXIS_COLUMNS,exclusionFilter)&&!this.gridInfo.unitTypeExistsOnAxis(microstrategy.GRIDCELL_AXIS_PAGE_BY,exclusionFilter)){ptmMenu.addItem(microstrategy.descriptors.getDescriptor("3326"),root+"('pttm', 'r');","");}if(this.gridInfo.hasNonMetricUnitsOnAxis(microstrategy.GRIDCELL_AXIS_COLUMNS)&&!this.gridInfo.unitTypeExistsOnAxis(microstrategy.GRIDCELL_AXIS_ROWS,exclusionFilter)&&!this.gridInfo.unitTypeExistsOnAxis(microstrategy.GRIDCELL_AXIS_PAGE_BY,exclusionFilter)){ptmMenu.addItem(microstrategy.descriptors.getDescriptor("3327"),root+"('pttm', 'c');","");}if(this.gridInfo.hasNonMetricUnitsOnAxis(microstrategy.GRIDCELL_AXIS_PAGE_BY)&&!this.gridInfo.unitTypeExistsOnAxis(microstrategy.GRIDCELL_AXIS_PAGE_BY,exclusionFilter)){ptmMenu.addItem(microstrategy.descriptors.getDescriptor("3328"),root+"('pttm', 'p');","");}ptmMenu.addItem(microstrategy.descriptors.getDescriptor("3329"),root+"('pttm', 'g');","");var attributes=this.gridInfo.getAttributes();if(attributes!=null&&attributes.length>0){var attribMenuForPtt=cmm.getMenu();if(attributes!=null){for(var i=0;i<attributes.length;i++){attribMenuForPtt.addItem(attributes[i].alias,root+"('pttm', 'a,"+attributes[i].dssId+"');","");sortMenu=cmm.getMenu();sortMenu.addItem(microstrategy.descriptors.getDescriptor("1885"),root+"('rm', '"+SORT_ASCENDING+",a,"+attributes[i].dssId+"');","");sortMenu.addItem(microstrategy.descriptors.getDescriptor("1886"),root+"('rm', '"+SORT_DESCENDING+",a,"+attributes[i].dssId+"');","");rMenu.addItem(breakBy[0]+attributes[i].alias,sortMenu);}}ptmMenu.addItem(microstrategy.descriptors.getDescriptor("3330"),attribMenuForPtt);}menu.addItem(microstrategy.descriptors.getDescriptor("3323"),ptmMenu);if(this.parentBone.isFeatureAvailable(microstrategy.FEATURE_INSERT_TRANSFORMATION_METRICS)&&microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){var transformationMenu=cmm.getMenu();if(this.parentBone.transformationRoles!=null){for(var role in this.parentBone.transformationRoles){var roleMenu=cmm.getMenu();roleMenu.addItem(microstrategy.descriptors.getDescriptor("2120"),root+"('tm', '"+role+",1');","");roleMenu.addItem(microstrategy.descriptors.getDescriptor("2132"),root+"('tm', '"+role+",2');","");roleMenu.addItem(microstrategy.descriptors.getDescriptor("3325"),root+"('tm', '"+role+",3');","");transformationMenu.addItem(this.parentBone.transformationRoles[role],roleMenu);}}menu.addItem(microstrategy.descriptors.getDescriptor("3324"),transformationMenu);}menu.addItem(microstrategy.descriptors.getDescriptor("2789"),rMenu);if(this.parentBone.isFeatureAvailable(microstrategy.FEATURE_INSERT_NEW_METRIC)){menu.addSeparator();menu.addItem(microstrategy.descriptors.getDescriptor("1895"),"microstrategy.bone('rwb_viewer').commands.exec('edtDMetric');","microstrategy.bone('rwb_viewer').commands.queryEnabled('edtDMetric');","microstrategy.EXECUTION_SCOPE == microstrategy.RWD_EXECUTION");}parentMenu.addItem(microstrategy.descriptors.getDescriptor("3322"),menu);}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.buildAxisContextMenus=function(cells){try{if(this.fp.isContextMenuEnabled&&cells.length>0&&!this.parentBone.commands.queryEnabled("isLinkedGrid")){var axisLength=cells.length;var axis=(cells[0].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_METRIC)?microstrategy.GRIDCELL_AXIS_METRICS:parseInt(cells[0].getAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS));var orientation=cells[0].getAttribute(microstrategy.HTMLATTR_ORIENTATION);var cmm=microstrategy.getContextMenuManager("vb_GM");var root="var bone = microstrategy.findBone(microstrategy.activeCXMenu); bone.processContextMenus";for(var i=0;i<cells.length;i++){var parentMenu=cmm.getMenu();if(this.parentBone.isFeatureAvailable(microstrategy.FEATURE_ENABLE_SORT)&&cells[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)!=microstrategy.DSSTYPE_CONSOLIDATION&&cells[i].getAttribute(microstrategy.HTMLATTR_DSS_SUBTYPE)!=microstrategy.DSSTYPE_CUSTOM_GROUP){var sourceAxis=(axis==microstrategy.GRIDCELL_AXIS_ROWS)?microstrategy.GRIDCELL_AXIS_ROWS:microstrategy.GRIDCELL_AXIS_COLUMNS;if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){parentMenu.addItem(microstrategy.descriptors.getDescriptor("3200"),"var bone = microstrategy.findBone(microstrategy.activeCXMenu); bone.commands.exec('sort', "+sourceAxis+");");}else{parentMenu.addItem(microstrategy.descriptors.getDescriptor("3200"),"microstrategy.bone('rwb_viewer').commands.exec('edtSortGrid',"+sourceAxis+");");}parentMenu.addSeparator();}if(axis==microstrategy.GRIDCELL_AXIS_METRICS&&this.parentBone.isFeatureAvailable(microstrategy.FEATURE_INSERT_NEW_METRIC)){this.buildShortcutContextMenus(root,parentMenu);}if(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION&&axis!=microstrategy.GRIDCELL_AXIS_METRICS){var tuceCommand=root+"('tuce');";var cgsCommand=root+"('cgs');";parentMenu.addItem(microstrategy.descriptors.getDescriptor("6152"),tuceCommand,"","microstrategy.bone('rwb_viewer').commands.queryState('hasNoTargets') && !microstrategy.bone('rwb_viewer').autoWire");parentMenu.addItem(microstrategy.descriptors.getDescriptor("7483"),cgsCommand,"","microstrategy.bone('rwb_viewer').commands.queryState('hasNoTargets') && microstrategy.bone('rwb_viewer').autoWire");parentMenu.addItem(microstrategy.descriptors.getDescriptor("4964"),tuceCommand,"","!microstrategy.bone('rwb_viewer').commands.queryState('hasNoTargets')");parentMenu.addItem(microstrategy.descriptors.getDescriptor("6151"),"microstrategy.bone('rwb_viewer').commands.exec('removeTargets')","","!microstrategy.bone('rwb_viewer').commands.queryState('hasNoTargets')");parentMenu.addItem(microstrategy.descriptors.getDescriptor("4724"),root+"('sct');");parentMenu.addItem(microstrategy.descriptors.getDescriptor("4725"),root+"('csc');");}if(this.fp.showPivotRMC){var menu=cmm.getMenu();if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION&&axis!=microstrategy.GRIDCELL_AXIS_METRICS){menu.addItem(microstrategy.descriptors.getDescriptor("1892"),root+"('p');");}if(orientation==microstrategy.GRIDCELL_ORIENTATION_VERTICAL){if(axis==microstrategy.GRIDCELL_AXIS_ROWS){menu.addItem(microstrategy.descriptors.getDescriptor("3048"),root+"('c');");menu.addSeparator();}else{if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION&&(i>0||i<axisLength-1)){menu.addSeparator();}}if(i>0){menu.addItem(microstrategy.descriptors.getDescriptor("3049"),root+"('l');");}if(i<axisLength-1){menu.addItem(microstrategy.descriptors.getDescriptor("3050"),root+"('r');");}}else{if(axis==microstrategy.GRIDCELL_AXIS_COLUMNS){menu.addItem(microstrategy.descriptors.getDescriptor("3051"),root+"('c');");menu.addSeparator();}else{if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION&&(i>0||i<axisLength-1)){menu.addSeparator();}}if(i>0){menu.addItem(microstrategy.descriptors.getDescriptor("3052"),root+"('u');");}if(i<axisLength-1){menu.addItem(microstrategy.descriptors.getDescriptor("3053"),root+"('d');");}}if(menu.length>0){parentMenu.addItem(microstrategy.descriptors.getDescriptor("3054"),menu);}}this.buildRemoveContextMenus(parentMenu,"x");if(this.fp.showFormattingRMC){parentMenu.addItem(microstrategy.descriptors.getDescriptor("2215"),root+"('gridFormat');","microstrategy.bone('rwb_viewer').commands.queryEnabled('onegrid');");}if(this.parentBone.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY)){var dssType=cells[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(dssType==microstrategy.DSSTYPE_ATTRIBUTE||dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){var formsMenu=cmm.getMenu();if(cells[i].getAttribute(microstrategy.HTMLATTR_FORM_LIST)){var formsList=cells[i].getAttribute(microstrategy.HTMLATTR_FORM_LIST).split(unescape(UNIT_SEPARATOR));var formsOnViewList=[];var formsOnWsList=[];var formsNotOnWsList=[];var j;for(j=0;j<formsList.length;j++){form=formsList[j].split(unescape(mstrUpdateManager.ITEM_SEPARATOR));switch(parseInt(form[microstrategy.FORM_LIST_STATUS])){case microstrategy.FORM_NOT_ON_WS:formsNotOnWsList.push(formsList[j]);break;case microstrategy.FORM_ON_VIEW:formsOnViewList.push(formsList[j]);break;case microstrategy.FORM_ON_WS:formsOnWsList.push(formsList[j]);break;}}for(j=0;(formsOnViewList!=null)&&(j<formsOnViewList.length);j++){form=formsOnViewList[j].split(unescape(mstrUpdateManager.ITEM_SEPARATOR));formsMenu.addItem(form[microstrategy.FORM_LIST_NAME],root+"('atfr', '"+form[microstrategy.FORM_LIST_ID]+"');","","",mstrContextMenuImpl.IMG_CHECK);}for(j=0;(formsOnWsList!=null)&&(j<formsOnWsList.length);j++){form=formsOnWsList[j].split(unescape(mstrUpdateManager.ITEM_SEPARATOR));formsMenu.addItem(form[microstrategy.FORM_LIST_NAME],root+"('atfa', '"+form[microstrategy.FORM_LIST_ID]+EXPRESSION_SEPARATOR+form[microstrategy.FORM_LIST_NAME]+"');");}if(microstrategy.EXECUTION_SCOPE!=microstrategy.RWD_EXECUTION){formsMenu.addSeparator();formsMenu.addItem(microstrategy.descriptors.getDescriptor("1005"),root+"('atfm');");}}if(formsMenu.length>0){parentMenu.addItem(microstrategy.descriptors.getDescriptor("2890"),formsMenu);}}}if(this.fp.showRenameRMC){axis=cells[i].getAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS);var depth=cells[i].getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH);var subDepth=this.gridInfo.getAttrFormPos(cells[i]);if(microstrategy.subObjectType(cells[i])==microstrategy.SUBOBJTYPE_METRIC){axis=microstrategy.GRIDCELL_AXIS_METRICS;subDepth=1;}parentMenu.addItem(microstrategy.descriptors.getDescriptor("2453"),root+"('rename', "+this.gridInfo.getUnitIndex(axis,depth,subDepth)+");");}if(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION&&cells[i].getAttribute(microstrategy.HTMLATTR_DSS_ID)){parentMenu.addItem(microstrategy.descriptors.getDescriptor("5140"),"microstrategy.bone('rwb_viewer').commands.exec('WebHyperLinkEditor');");}parentMenu.registerTrigger(cells[i]);}}return cells;}catch(err){microstrategy.errors.log(err);return cells;}};mstrTemplateImpl.prototype.buildRemoveContextMenus=function(parentMenu,cmdId){try{var root="var bone = microstrategy.findBone(microstrategy.activeCXMenu); bone.processContextMenus";var showRemoveFromGrid=false;if((this.fp.showRemoveRMC||this.parentBone.showGraphDropZones)&&(this.parentBone.isFeatureAvailable(microstrategy.FEATURE_WEB_REMOVE_FROM_GRID)||microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION)){parentMenu.addItem(microstrategy.descriptors.getDescriptor("2214"),root+"('"+cmdId+"');","","",mstrContextMenuImpl.IMG_REMOVE);showRemoveFromGrid=true;}if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION&&this.parentBone.isFeatureAvailable(microstrategy.FEATURE_MODIFY_REPORT_LIST)&&this.parentBone.isFeatureAvailable(microstrategy.FEATURE_REPORT_FROM_REPORT)&&(!showRemoveFromGrid||this.fp.showExtraRemoveRMC||this.parentBone.showGraphDropZones)){parentMenu.addItem(microstrategy.descriptors.getDescriptor("2216"),root+"('"+cmdId+"x');","","",mstrContextMenuImpl.IMG_REMOVE);}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.generateTemplate=function(){try{var tbody=this.target.getElementsByTagName("TBODY")[0];mstrTemplateImpl.removeAllChildren(tbody);if(this.gridInfo.isEmptyTemplate){mstrTemplateImpl.buildEmptyTemplateRows(this.target,this.parentBone.gridCellCssPrefix,this.gridInfo.hasMetrics);}else{var colPreviewCount=1;var rowSpacer=colSpacer=null;var i,j,tr;var gi=this.gridInfo;if(gi.rowAxis.size()==0||gi.colAxis.headerSize()>1){rowSpacer=mstrTemplateImpl.buildEmptyCell(microstrategy.GRIDCELL_AXIS_ROWS,this.parentBone.gridCellCssPrefix);rowSpacer.colSpan=Math.max(gi.rowAxis.headerSize(),1);}if(gi.metricsAxis!=microstrategy.GRIDCELL_AXIS_COLUMNS||gi.colAxis.headerSize()>1){colSpacer=this.buildHeaderCell(microstrategy.GRIDCELL_AXIS_COLUMNS);if(gi.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS){colPreviewCount=gi.metricAxis.headerSize();}}var metricCells=this.buildTitleCellCollection(gi.metricAxis);var rowCells=this.buildTitleCellCollection(gi.rowAxis);var colCells=this.buildTitleCellCollection(gi.colAxis);var metricsTotalDepth=-1;if(gi.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS){metricsTotalDepth=gi.colAxis.unitLength(gi.metricsDepth);}else{if(gi.metricsAxis==microstrategy.GRIDCELL_AXIS_ROWS){metricsTotalDepth=gi.rowAxis.unitLength(gi.metricsDepth);}}if(colCells!=null){for(i=0;i<colCells.length-1;i++){tr=tbody.insertRow(-1);if(rowSpacer!=null){tr.appendChild(rowSpacer.cloneNode(true));}tr.appendChild(colCells[i]);if(gi.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS&&(metricsTotalDepth-1==i)){for(j=0;j<metricCells.length;j++){tr.appendChild(metricCells[j]);}}else{if(colSpacer!=null){for(j=0;j<colPreviewCount;j++){tr.appendChild(this.buildPreviewCell(colSpacer,"previewHeaderCell",colCells[i].getAttribute(microstrategy.HTMLATTR_DESCRIPTION)));}}}}}if(rowCells!=null||colCells!=null){tr=tbody.insertRow(-1);if(rowCells==null){tr.appendChild(rowSpacer.cloneNode(true));}else{for(i=0;i<rowCells.length;i++){tr.appendChild(rowCells[i]);}}if(colCells==null){mstrTemplateImpl.buildEmptyTemplateCell(tr.insertCell(tr.cells.length),microstrategy.GRIDCELL_AXIS_COLUMNS,this.parentBone.gridCellCssPrefix);}else{tr.appendChild(colCells[colCells.length-1]);if(gi.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS&&metricsTotalDepth==colCells.length){for(j=0;j<metricCells.length;j++){tr.appendChild(metricCells[j]);}}else{if(colSpacer!=null){for(j=0;j<colPreviewCount;j++){tr.appendChild(this.buildPreviewCell(colSpacer,"previewHeaderCell",colCells[colCells.length-1].getAttribute(microstrategy.HTMLATTR_DESCRIPTION)));}}}}}if(gi.metricsAxis==microstrategy.GRIDCELL_AXIS_ROWS&&metricCells!=null){this.buildMetricsRows(rowCells,metricCells);}else{this.buildEmptyRows(rowCells,colCells,metricCells);}}if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){this.renderPageBy();}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.adjustPageByMetrics=function(metricsSpan){try{var mid="";for(var j=0;j<this.gridInfo.metricAxis.size();j++){var metric=this.gridInfo.metricAxis.units[j];mid+=metric.dssId+"|"+metric.alias+ITEM_SEPARATOR;metric.src=metricsSpan;}if(mid.length>0){metricsSpan.setAttribute("mid",mid.substr(0,mid.length-1));}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.generatePageBySpan=function(unit,depth){try{var span=document.createElement("span");span.setAttribute("id","pbk"+depth);if(this.fp.isDragAndDropEnabled||this.parentBone.showGraphDropZones){span.setAttribute("dg","TRUE");}span.setAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS,microstrategy.GRIDCELL_AXIS_PAGE_BY);if(unit.hasAttForms()){span.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_ATTRIBUTE_FORM);}else{span.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_ATTRIBUTE);}span.setAttribute(microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_PAGE_BY_ELEM);span.setAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH,depth);span.setAttribute(microstrategy.HTMLATTR_FORM_POS,"1");if(unit.isMetricTemplateUnit){span.setAttribute("MH","TRUE");this.adjustPageByMetrics(span);}else{span.setAttribute(microstrategy.HTMLATTR_DSS_ID,unit.dssId);span.setAttribute(microstrategy.HTMLATTR_DSS_TYPE,unit.dssType);}if(unit.attFormList.forms){var i,form,formList=[];for(i=0;form=unit.attFormList.forms[i];i++){formList.push(form.join(unescape(mstrUpdateManager.ITEM_SEPARATOR)));}span.setAttribute(microstrategy.HTMLATTR_FORM_LIST,formList.join(unescape(UNIT_SEPARATOR)));}span.setAttribute(microstrategy.HTMLATTR_DESCRIPTION,unit.alias);span.className="pgby"+(mstrGridReport.isDesignMode()?"Design":"");span.onmouseover=new Function("this.className+=' pgbyHover';");span.onmouseout=new Function("this.className = this.className.replace(' pgbyHover','');");span.setAttribute("nowrap","1");span.appendChild(document.createTextNode(unit.alias+" "));span.style.cursor=(bIsIE4)?"hand":"pointer";return span;}catch(err){microstrategy.errors.log(err);}return null;};mstrTemplateImpl.prototype.renderPageBy=function(){try{var axis=this.gridInfo.pageAxis;var pageElem=document.getElementById("pbb_PageByStyle");if(pageElem!=null){var pageBody=microstrategy.subObjectFind(pageElem,"div",microstrategy.SUBOBJTYPE_BODY);mstrTemplateImpl.removeAllChildren(pageBody);var span;var axisLength=axis.size();if(axisLength>0){for(var i=0;i<axisLength;i++){var unit=axis.units[i];var depth=i+1;span=this.generatePageBySpan(unit,depth);unit.src=span;if(unit.attForms){unit.attForms.setUnitSource(span);}pageBody.appendChild(span);}this.buildPageByAxisPivotButtons();this.buildPageByAxisContextMenus();}else{span=document.createElement("span");var noneNode=document.createTextNode(microstrategy.descriptors.getDescriptor("2020"));span.className="pgbyNone";span.appendChild(noneNode);pageBody.appendChild(span);}microstrategy.eventManager.notifyOrphanBones("onpagebychange");if(mstrGridReport.createQuickSearchPlaceHolder){pageBody.appendChild(mstrGridReport.createQuickSearchPlaceHolder(microstrategy.GRIDCELL_AXIS_PAGE_BY));}var clearDiv=document.createElement("div");clearDiv.setAttribute("style","clear:both;height:0;line-height:0");pageBody.appendChild(clearDiv);}}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.buildPageByAxisPivotButtons=function(){try{var axis=this.gridInfo.pageAxis;if((this.fp.showPivot||this.parentBone.showGraphDropZones)&&axis.size()>0){var pbSpan=document.createElement("span");pbSpan.className="mstrIconPivot";var axisLength=axis.size();for(var i=0;i<axisLength;i++){var span=axis.units[i].src;if(i>0){span.appendChild(this.buildPageByPivotImage(pbSpan,"pivotLeft",microstrategy.descriptors.getDescriptor("142"),"move","l"));}if(i<axisLength-1){span.appendChild(this.buildPageByPivotImage(pbSpan,"pivotRight",microstrategy.descriptors.getDescriptor("143"),"move","r"));}span.appendChild(this.buildPageByPivotImage(pbSpan,"pivotToRows",microstrategy.descriptors.getDescriptor("137"),"move","tr"));span.appendChild(this.buildPageByPivotImage(pbSpan,"pivotToCols",microstrategy.descriptors.getDescriptor("141"),"move","tc"));if(this.fp.showRemove||this.parentBone.showGraphDropZones){var tooltipDescId=this.parentBone.isFeatureAvailable(microstrategy.FEATURE_WEB_REMOVE_FROM_GRID)?"2214":"2216";span.appendChild(this.buildPageByPivotImage(pbSpan,"pivotRemove",microstrategy.descriptors.getDescriptor(tooltipDescId),"rmv","x"));}}}return axis;}catch(err){microstrategy.errors.log(err);return axis;}};mstrTemplateImpl.prototype.buildPageByPivotImage=function(pbSpan,cssClass,title,cmdId,cmdVal){try{var i=pbSpan.cloneNode(false);i.setAttribute("title",title);i.setAttribute("cmdid",cmdId);i.setAttribute("cmdvl",cmdVal);i.className+=" "+cssClass;return i;}catch(err){microstrategy.errors.log(err);return pbSpan;}};mstrTemplateImpl.prototype.buildPageByAxisContextMenus=function(){try{var axis=this.gridInfo.pageAxis;if((this.fp.isContextMenuEnabled||this.parentBone.showGraphDropZones)&&axis.size()>0){var axisLength=axis.size();if(microstrategy.getContextMenuManager!=undefined){var cmm=microstrategy.getContextMenuManager("vb_GM");var root="var bone = microstrategy.findBone(microstrategy.activeCXMenu); bone.processContextMenus";for(var i=0;i<axisLength;i++){var parentMenu=cmm.getMenu();if(this.fp.showPivotRMC||this.parentBone.showGraphDropZones){var menu=cmm.getMenu();menu.addItem(microstrategy.descriptors.getDescriptor("3051"),root+"('move', 'tr');");menu.addItem(microstrategy.descriptors.getDescriptor("3048"),root+"('move', 'tc');");menu.addSeparator();if(i>0){menu.addItem(microstrategy.descriptors.getDescriptor("3049"),root+"('move', 'l');");}if(i<axisLength-1){menu.addItem(microstrategy.descriptors.getDescriptor("3050"),root+"('move', 'r');");}if(menu.length>0){parentMenu.addItem(microstrategy.descriptors.getDescriptor("3054"),menu);}}this.buildRemoveContextMenus(parentMenu,"rmv");parentMenu.registerTrigger(axis.units[i].src);}}}return axis;}catch(err){microstrategy.errors.log(err);return axis;}};mstrTemplateImpl.prototype.add=function(element,axis,depth,subdepth){try{var objInfo=this.gridInfo.buildGridUnitInfo(element,axis,depth,subdepth);this.addFromObjInfo(objInfo);return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrTemplateImpl.prototype.addFromObjInfo=function(objInfo){try{this.gridInfo.add(objInfo,true);this.generateTemplate();this.sendUpdate();return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrTemplateImpl.prototype.pivot=function(unit,axis,depth,subdepth){try{if(!unit){this.gridInfo.pivotUnit(this.gridInfo.metricsAxis,this.gridInfo.metricsDepth,1,axis,depth,1);}else{var oldObjInfo=this.gridInfo.getGridUnitInfo(unit);var newObjInfo=this.gridInfo.buildGridUnitInfo(unit,axis,depth,subdepth);this.gridInfo.pivot(oldObjInfo,newObjInfo);}this.generateTemplate();this.sendUpdate();return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrTemplateImpl.prototype.remove=function(objInfo){try{this.gridInfo.remove(objInfo);this.generateTemplate();this.sendUpdate();}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.swapAxes=function(){try{this.gridInfo.swapAxes();this.generateTemplate();this.sendUpdate();}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.sendUpdate=function(){try{this.parentBone.hasNoMetrics=!this.gridInfo.hasMetrics;if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION&&microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE){var btn=document.getElementById("btnApplyDesignChanges");if(btn){btn.disabled=(this.gridInfo.hasNoUnits);}btn=document.getElementById("3013");if(btn){btn.disabled=(this.gridInfo.hasNoUnits);}}microstrategy.eventManager.notifyOrphanBones("onselectedgridstructurechange");}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.undo=function(action){try{var unit,axis,depth,subDepth,subUnit;var actionID=action.id;switch(actionID){case mstrUpdateManager.PIVOT_TEMPLATE_UNIT:unit=this.gridInfo.findUnit(action.elem.dssId);if(unit){axis=parseInt(action.args[1]);depth=parseInt(action.args[2]);this.pivot(unit.src,axis,depth,1);}break;case mstrUpdateManager.PIVOT_TEMPLATE_METRIC:unit=this.gridInfo.findUnit(action.elem.dssId);if(unit){depth=parseInt(action.args[1]);this.pivot(unit.src,this.gridInfo.metricsAxis,depth);}break;case mstrUpdateManager.ADD_TEMPLATE_UNIT:case mstrUpdateManager.ADD_TEMPLATE_METRIC:unit=this.gridInfo.findUnit(action.elem.dssId);if(unit){this.remove(unit);}break;case mstrUpdateManager.ADD_FORM:axis=parseInt(action.args[3]);depth=parseInt(action.args[4]);subDepth=parseInt(action.args[5]);unit=this.gridInfo.findUnit(action.elem.parentDssId);if(action.cachedArray.pivot){if(unit){subUnit=unit.attForms.findUnit(action.elem.dssId);if(subUnit){this.pivot(subUnit.src,axis,depth,subDepth);}}}else{if(action.cachedArray.allForms){this.remove(unit);}else{subUnit=unit.attForms.findUnit(action.elem.dssId);if(subUnit){this.remove(subUnit);}}}break;case mstrUpdateManager.REMOVE_TEMPLATE_UNIT:axis=parseInt(action.args[1]);depth=parseInt(action.args[2]);if(action.elem.isMetricTemplateUnit){var metrics=action.cachedArray.metrics;this.add(metrics[0].src,axis,depth,1);for(var i=1;i<metrics.length;i++){this.add(metrics[i].src,axis,i+1,1);}}else{this.add(action.elem.src,axis,depth,1);}break;case mstrUpdateManager.REMOVE_TEMPLATE_METRIC:axis=action.cachedArray.metricsAxis;depth=(action.cachedArray.metricsDepth!=null)?action.cachedArray.metricsDepth:parseInt(action.args[1]);this.add(action.elem.src,action.cachedArray.metricsAxis,depth,1);break;case mstrUpdateManager.REMOVE_FORM:if(action.elem.isVisible){this.add(action.elem.src,action.elem.axis,action.elem.depth,action.elem.subDepth);}else{this.addFromObjInfo(action.elem);}break;case mstrUpdateManager.SWAP_TEMPLATE_AXES:this.swapAxes();break;}microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridInfo);}catch(err){microstrategy.errors.log(err);}};mstrTemplateImpl.prototype.redo=function(action){try{var actionID=action.id;var unit=this.gridInfo.findUnit(action.elem.dssId);switch(actionID){case mstrUpdateManager.PIVOT_TEMPLATE_UNIT:this.pivot(unit.src,parseInt(action.args[3]),parseInt(action.args[4]),1);break;case mstrUpdateManager.PIVOT_TEMPLATE_METRIC:this.pivot(unit.src,this.gridInfo.metricsAxis,parseInt(action.args[2]),1);break;case mstrUpdateManager.ADD_TEMPLATE_UNIT:this.add(action.elem.src,parseInt(action.args[1]),parseInt(action.args[2]),1);break;case mstrUpdateManager.ADD_TEMPLATE_METRIC:if(this.gridInfo.hasMetrics){this.add(action.elem,this.gridInfo.metricsAxis,parseInt(action.args[1]),1);}else{this.add(action.elem,parseInt(action.args[2]),parseInt(action.args[3]),1);}break;case mstrUpdateManager.ADD_FORM:var axis=parseInt(action.args[3]);var depth=parseInt(action.args[4]);var subDepth=parseInt(action.args[5]);if(action.cachedArray.pivot){unit=this.gridInfo.findUnit(action.elem.parentDssId);if(unit){var subUnit=unit.attForms.findUnit(action.elem.dssId);if(subUnit){this.pivot(subUnit.src,axis,depth,subDepth);}}}else{this.add(action.elem.src,axis,depth,subDepth);}break;case mstrUpdateManager.REMOVE_TEMPLATE_UNIT:case mstrUpdateManager.REMOVE_TEMPLATE_METRIC:this.remove(unit);break;case mstrUpdateManager.REMOVE_FORM:this.remove(action.elem);break;case mstrUpdateManager.SWAP_TEMPLATE_AXES:this.swapAxes();break;}microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridInfo);}catch(err){microstrategy.errors.log(err);}};function mstrTemplateImpl(){return this;}mstrGraphTemplateImpl.prototype=new mstrTemplateImpl();mstrGraphTemplateImpl.prototype.onload=function(template,parent,fp){try{mstrTemplateImpl.prototype.onload.call(this,template,parent,fp);this.showAttForms=false;return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGraphTemplateImpl.prototype.generatePageBySpan=function(unit,depth){try{var span=mstrTemplateImpl.prototype.generatePageBySpan.call(this,unit,depth);if(span!=null&&this.parentBone.showGraphDropZones){span.setAttribute("dg","TRUE");}return span;}catch(err){microstrategy.errors.log(err);}return null;};mstrGraphTemplateImpl.prototype.adjustPageByMetrics=function(metricsSpan){try{}catch(err){microstrategy.errors.log(err);}};mstrGraphTemplateImpl.prototype.generateTemplate=function(){try{var series=document.getElementById(this.parentBone.zonesTargetId+"_gdz1");var categories=document.getElementById(this.parentBone.zonesTargetId+"_gdz2");if(this.parentBone.seriesLayout=="1"){this.renderAxisDropUnits(series,this.gridInfo.colAxis);this.renderAxisDropUnits(categories,this.gridInfo.rowAxis);}else{this.renderAxisDropUnits(series,this.gridInfo.rowAxis);this.renderAxisDropUnits(categories,this.gridInfo.colAxis);}var metrics=document.getElementById(this.parentBone.zonesTargetId+"_gdz3");if(this.gridInfo.metricsAxis==microstrategy.GRIDCELL_AXIS_PAGE_BY){mstrTemplateImpl.removeAllChildren(metrics);metrics.parentNode.style.display="none";}else{this.renderAxisDropUnits(metrics,this.gridInfo.metricAxis);metrics.parentNode.style.display="";}if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){this.renderPageBy();}}catch(err){microstrategy.errors.log(err);}};mstrGraphTemplateImpl.prototype.renderAxisDropUnits=function(div,axis){try{mstrTemplateImpl.removeAllChildren(div);if(axis.size()>0){for(var i=0;i<axis.size();i++){var unit=axis.get(i);if(!unit){continue;}if(unit.isMetricTemplateUnit&&!this.parentBone.renderMetricsZone){unit.src=null;unit.isVisible=false;continue;}var span=document.createElement("span");span.appendChild(document.createTextNode(unit.alias));if(unit.isMetricTemplateUnit){span.setAttribute("mh","true");}else{span.setAttribute(microstrategy.HTMLATTR_DSS_ID,unit.dssId);span.setAttribute(microstrategy.HTMLATTR_DSS_TYPE,unit.dssType);}span.setAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH,(i+1));span.setAttribute(microstrategy.HTMLATTR_FORM_POS,"1");span.setAttribute(microstrategy.HTMLATTR_GRIDCELL_AXIS,axis.axisType);span.setAttribute("id",this.parentBone.zonesTargetId+"_"+axis.axisType+"_"+(i+1)+"_1");span.setAttribute("dg","1");if(axis.axisType==microstrategy.GRIDCELL_AXIS_METRICS){span.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,"MV");}else{span.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,"ATT");}if(unit.attFormList.forms){var j,form,formList=[];for(j=0;form=unit.attFormList.forms[j];j++){formList.push(form.join(unescape(mstrUpdateManager.ITEM_SEPARATOR)));}span.setAttribute(microstrategy.HTMLATTR_FORM_LIST,formList.join(unescape(UNIT_SEPARATOR)));}div.appendChild(span);if(mstr.utils.ISIE6||mstr.utils.ISIE7){var img=document.createElement("img");span.appendChild(img);span.removeChild(img);}unit.src=span;if(microstrategy.getContextMenuManager!=undefined){var cmm=microstrategy.getContextMenuManager("vb_GM");var sctCommand="var bone = microstrategy.getActiveCXBone(); bone.processContextMenus('sct');";var tuceCommand="var bone = microstrategy.getActiveCXBone(); bone.processContextMenus('tuce');";var cgsCommand="var bone = microstrategy.getActiveCXBone(); bone.processContextMenus('cgs');";var parentMenu=cmm.getMenu();if(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION&&axis.axisType!=microstrategy.GRIDCELL_AXIS_METRICS){parentMenu.addItem(microstrategy.descriptors.getDescriptor("4724"),sctCommand);parentMenu.addItem(microstrategy.descriptors.getDescriptor("6152"),tuceCommand,"","microstrategy.bone('rwb_viewer').commands.queryState('hasNoTargets') && !microstrategy.bone('rwb_viewer').autoWire");parentMenu.addItem(microstrategy.descriptors.getDescriptor("7483"),cgsCommand,"","microstrategy.bone('rwb_viewer').commands.queryState('hasNoTargets') && microstrategy.bone('rwb_viewer').autoWire");parentMenu.addItem(microstrategy.descriptors.getDescriptor("4964"),tuceCommand,"","!microstrategy.bone('rwb_viewer').commands.queryState('hasNoTargets')");parentMenu.addItem(microstrategy.descriptors.getDescriptor("6151"),"microstrategy.bone('rwb_viewer').commands.exec('removeTargets')","","!microstrategy.bone('rwb_viewer').commands.queryState('hasNoTargets')");}parentMenu.registerTrigger(span);}}}else{div.innerHTML="<br />&nbsp;<br />";}}catch(err){microstrategy.errors.log(err);}};function mstrGraphTemplateImpl(){this.inherits=mstrTemplateImpl;this.inherits();delete this.inherits;return this;}