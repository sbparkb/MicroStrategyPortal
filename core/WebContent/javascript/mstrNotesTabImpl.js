mstrNotesTabImplScript=true;mstrNotesTabImpl.prototype=new mstrTabImpl();mstrNotesTabImpl.prototype.initializing=false;mstrNotesTabImpl.prototype.block=null;mstrNotesTabImpl.prototype.blockId="annotationView";mstrNotesTabImpl.prototype.taskModel=null;mstrNotesTabImpl.prototype.objectID=null;mstrNotesTabImpl.prototype.objectType=null;mstrNotesTabImpl.prototype.notesMsg=null;mstrNotesTabImpl.prototype.onload=function(){try{mstrTabImpl.prototype.onload.call(this);if(microstrategy.needSaveBeforeNotes()){this.showNotesMsg(true);}else{this.showNotesMsg(false);this.block=document.getElementById(this.blockId);if(!this.block){var ta=document.createElement("textarea");ta.setAttribute("id","nde");ta.className="mstrJSON";this.elem.childNodes[0].appendChild(ta);var req=new mstr.http.GetAnnotationsInput(this.tabManager.objectID,this.tabManager.objectType,null,true);if(!this.taskModel){this.taskModel=new mstr.models.TaskModel({parent:this});mstr.controllers.Factory.add(this.taskModel);this.taskModel&&this.taskModel.init&&this.taskModel.init();this.taskModel.attachEventListener(this,"set_readyState","taskModelCallback");}this.taskModel.execFetchBlock(req,ta);}else{this.block=mstr.$obj(this.block.id);}}}catch(err){microstrategy.errors.log(err);return false;}};mstrNotesTabImpl.prototype.showNotesMsg=function(show){try{var notesMsg=microstrategy.findChildWithAtt(this.elem,"div",(bIsW3C)?"class":"className","notesMessage");if(notesMsg){if(microstrategy.EXECUTION_SCOPE==microstrategy.REPORT_EXECUTION){notesMsg.innerHTML=microstrategy.descriptors.getDescriptor("5365");}else{notesMsg.innerHTML=microstrategy.descriptors.getDescriptor("5366");}notesMsg.innerHTML=notesMsg.innerHTML.replace("##","<span>").replace("#","</span>");notesMsg.style.display=((show)?"block":"none");if(show){var saveSpan=notesMsg.getElementsByTagName("span")[0];saveSpan.innerHTML=microstrategy.descriptors.getDescriptor("118");if(microstrategy.EXECUTION_SCOPE!=microstrategy.REPORT_EXECUTION||microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE||(microstrategy.bone("UniqueReportID")&&microstrategy.bone("UniqueReportID").commands.queryEnabled("dmSave"))){saveSpan.onclick=new Function("microstrategy.performSave();");saveSpan.className="save";}else{saveSpan.onclick=null;saveSpan.className=null;}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrNotesTabImpl.prototype.taskModelCallback=function(evt){try{switch(evt.name){case"set_readyState":this.handleTaskModelReadyStateChange(evt);break;}}catch(err){microstrategy.errors.log(err);}};mstrNotesTabImpl.prototype.handleTaskModelReadyStateChange=function(evt){try{switch(evt.memo.value){case mstr.Enum.Widget.READYSTATE.ERROR:microstrategy.errors.log("Annnotation blocks call failed.");return ;case mstr.Enum.Widget.READYSTATE.IDLE:if(!this.taskModel){return ;}this.block=this.taskModel.get("renderableView");if(!this.block){return ;}else{this.block.render();}this.resize();if(bIsW3C){window.setTimeout("microstrategy.bone('"+this.id+"'). forcerepaint();",0);}break;}}catch(err){microstrategy.errors.log(err);}};mstrNotesTabImpl.prototype.resize=function(){try{var height=(this.tabManager.getAvailableHeight)?parseInt(this.tabManager.getAvailableHeight()):null;var width=(this.tabManager.getAvailableWidth)?parseInt(this.tabManager.getAvailableWidth()):null;if(this.block&&this.block.resize){this.block.resize(width,height);}}catch(err){microstrategy.errors.log(err);return false;}};mstrNotesTabImpl.prototype.onSwitchToCurrent=function(){try{if(this.block){this.block.getModel().execFetch();if(bIsW3C){window.setTimeout("microstrategy.bone('"+this.id+"'). forcerepaint();",0);}}}catch(err){microstrategy.errors.log(err);return false;}};mstrNotesTabImpl.prototype.repaint=function(){try{if(bIsW3C){window.setTimeout("microstrategy.bone('"+this.id+"'). forcerepaint();",0);}}catch(err){microstrategy.errors.log(err);return false;}};mstrNotesTabImpl.prototype.forcerepaint=function(){try{var i=document.createElement("img");this.elem.appendChild(i);i.parentNode.removeChild(i);}catch(err){microstrategy.errors.log(err);return false;}};function mstrNotesTabImpl(id){this.inherits=mstrTabImpl;this.inherits(id);this.inherits=null;return this;}