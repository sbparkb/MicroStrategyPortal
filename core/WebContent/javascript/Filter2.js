Filter2Script=true;var sOriginalHTML;var sOriginalFilterHTML;var isFirstEdit=true;var isAnotherEditOpen=false;var sLastSpanID;var aOperatorsList=new Array(24);var bIsOperatorsListInitialized=false;var OP_Equals=0;var OP_Not_Equals=1;var OP_Greater=2;var OP_Greater_Equal=3;var OP_Less=4;var OP_Less_Equal=5;var OP_Between=6;var OP_Not_Between=7;var OP_Is_Null=8;var OP_Is_Not_Null=9;var OP_In=10;var OP_Not_In=11;var OP_Contains=12;var OP_Not_Contains=13;var OP_Begins_With=14;var OP_Not_Begins_With=15;var OP_Ends_With=16;var OP_Not_Ends_With=17;var OP_Like=18;var OP_Not_Like=19;var OP_Highest_Rank=20;var OP_Lowest_Rank=21;var OP_Highest_Percentage=22;var OP_Lowest_Percentage=23;var ATTR_FORM_QUAL=0;var METRIC_QUAL=1;var METRIC_EXPR_QUAL=2;var DATA_TYPE_NUMERIC=0;var DATA_TYPE_TEXT=1;var DATA_TYPE_DATE=2;var aValid_AttrFormQual_DatatypeOperators=new Array(3);var aValid_MetricQual_DatatypeOperators=new Array(3);var aValid_MetricExprQual_DatatypeOperators=new Array(3);var aInvalid_Prompt_Operators=[OP_In,OP_Not_In,OP_Between,OP_Not_Between,OP_Is_Null,OP_Is_Not_Null];aValid_AttrFormQual_DatatypeOperators[DATA_TYPE_NUMERIC]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal,OP_Between,OP_Not_Between,OP_Is_Null,OP_Is_Not_Null,OP_In,OP_Not_In];aValid_AttrFormQual_DatatypeOperators[DATA_TYPE_TEXT]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal,OP_Between,OP_Not_Between,OP_Contains,OP_Not_Contains,OP_Begins_With,OP_Not_Begins_With,OP_Ends_With,OP_Not_Ends_With,OP_Like,OP_Not_Like,OP_Is_Null,OP_Is_Not_Null,OP_In,OP_Not_In];aValid_AttrFormQual_DatatypeOperators[DATA_TYPE_DATE]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal,OP_Between,OP_Not_Between,OP_Is_Null,OP_Is_Not_Null,OP_In,OP_Not_In];aValid_MetricQual_DatatypeOperators[DATA_TYPE_NUMERIC]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal,OP_Between,OP_Not_Between,OP_Is_Null,OP_Is_Not_Null,OP_In,OP_Not_In,OP_Highest_Rank,OP_Lowest_Rank,OP_Highest_Percentage,OP_Lowest_Percentage];aValid_MetricQual_DatatypeOperators[DATA_TYPE_TEXT]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal,OP_Between,OP_Not_Between,OP_Contains,OP_Not_Contains,OP_Begins_With,OP_Not_Begins_With,OP_Ends_With,OP_Not_Ends_With,OP_Like,OP_Not_Like,OP_Is_Null,OP_Is_Not_Null,OP_In,OP_Not_In];aValid_MetricQual_DatatypeOperators[DATA_TYPE_DATE]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal,OP_Between,OP_Not_Between,OP_Is_Null,OP_Is_Not_Null,OP_In,OP_Not_In];aValid_MetricExprQual_DatatypeOperators[DATA_TYPE_NUMERIC]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal];aValid_MetricExprQual_DatatypeOperators[DATA_TYPE_TEXT]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal];aValid_MetricExprQual_DatatypeOperators[DATA_TYPE_DATE]=[OP_Equals,OP_Not_Equals,OP_Greater,OP_Greater_Equal,OP_Less,OP_Less_Equal];var oOpListCopy=null;var getOptionValue=function(option){try{var v=option.value;if(option.value==undefined){v=option.attributes&&option.attributes.value&&option.attributes.value.value;}return v;}catch(err){microstrategy.errors.log(err);}};function initialise(){if(isFirstEdit){oDiv=getObj("Filter");if(oDiv){sOriginalFilterHTML=oDiv.innerHTML;}isFirstEdit=false;}}function initializeOperatorsList(sOpList){if(!bIsOperatorsListInitialized&&aOperatorsList&&(aOperatorsList.length>0)){aOperatorsList[OP_Equals]="6"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Not_Equals]="7"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Greater]="8"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Greater_Equal]="10"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Less]="9"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Less_Equal]="11"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Between]="17"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Not_Between]="44"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Is_Null]="54"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Is_Not_Null]="55"+ITEM_SEPARATOR+"1";aOperatorsList[OP_In]="22"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Not_In]="57"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Contains]="76"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Not_Contains]="79"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Begins_With]="77"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Not_Begins_With]="80"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Ends_With]="78"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Not_Ends_With]="81"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Like]="18"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Not_Like]="43"+ITEM_SEPARATOR+"1";aOperatorsList[OP_Highest_Rank]="1"+ITEM_SEPARATOR+"2";aOperatorsList[OP_Lowest_Rank]="2"+ITEM_SEPARATOR+"2";aOperatorsList[OP_Highest_Percentage]="1"+ITEM_SEPARATOR+"3";aOperatorsList[OP_Lowest_Percentage]="2"+ITEM_SEPARATOR+"3";bIsOperatorsListInitialized=true;}var opList=getObj(sOpList);if(opList&&(!opList.getAttribute("cloned"))){oOpListCopy=opList.cloneNode&&opList.cloneNode(true);opList.setAttribute("cloned","1");}}function updateOperatorsListBasedOnUnitDatatype(sUnitList,sOperatorListName,iQualType,extra){updateOperatorsListBasedOnUnitDatatypeAndPrompts(sUnitList,sOperatorListName,iQualType,false,extra);}function updateOperatorsListBasedOnUnitDatatypeAndPrompts(sUnitList,sOperatorListName,iQualType,bIsPrompted,extra){try{initializeOperatorsList(sOperatorListName);if(sUnitList&&sOperatorListName){var oUnitList=getObj(sUnitList);var oOperatorListName=getObj(sOperatorListName);if(oUnitList&&oOperatorListName){var iSelectedDatatype=null;var isIdForm;if((iQualType==ATTR_FORM_QUAL)&&oUnitList.options){for(var count=0;count<oUnitList.options.length;count++){if(oUnitList.options[count].selected){iSelectedDatatype=oUnitList.options[count].getAttribute("DATATYPE");isIdForm=oUnitList.options[count].getAttribute("isId");break;}}}else{iSelectedDatatype=oUnitList.getAttribute("DATATYPE");}if(iSelectedDatatype!=null){filterEditorBone=microstrategy.bone(this.filterEditorBoneId);if(filterEditorBone!=null&&filterEditorBone.setSelectedDataType){filterEditorBone.setSelectedDataType(iSelectedDatatype);}var aValidOperatorsList=null;var iDatatype=DATA_TYPE_NUMERIC;if((iSelectedDatatype==8)||(iSelectedDatatype==9)||(iSelectedDatatype==10)){iDatatype=DATA_TYPE_TEXT;}if((iSelectedDatatype==14)||(iSelectedDatatype==15)||(iSelectedDatatype==16)){iDatatype=DATA_TYPE_DATE;}switch(iQualType){case ATTR_FORM_QUAL:aValidOperatorsList=aValid_AttrFormQual_DatatypeOperators[iDatatype];break;case METRIC_QUAL:aValidOperatorsList=aValid_MetricQual_DatatypeOperators[iDatatype];break;case METRIC_EXPR_QUAL:aValidOperatorsList=aValid_MetricExprQual_DatatypeOperators[iDatatype];break;}if(aValidOperatorsList!=null&&oOpListCopy!=null){var currentValue=oOperatorListName.value;var selected=false;oOperatorListName.options.length=0;var childItems=oOpListCopy.childNodes;var totalItems=childItems.length;for(var x=0;x<totalItems;x++){var bOpInValidList=false;var oOption=childItems[x];var ov=getOptionValue(oOption);var skipIt=false;if(extra){if(iQualType==ATTR_FORM_QUAL&&extra.isDE){skipIt=ov==aOperatorsList[OP_Is_Null]||ov==aOperatorsList[OP_Is_Not_Null]||ov==aOperatorsList[OP_In]||ov==aOperatorsList[OP_Not_In];}else{if(iQualType==METRIC_QUAL&&extra.isCondFormatting){skipIt=ov==aOperatorsList[OP_Highest_Rank]||ov==aOperatorsList[OP_Lowest_Rank]||ov==aOperatorsList[OP_Highest_Percentage]||ov==aOperatorsList[OP_Lowest_Percentage];}}}if(!skipIt){for(var y=0;y<aValidOperatorsList.length;y++){if(ov==aOperatorsList[aValidOperatorsList[y]]){bOpInValidList=true;break;}}}if(bOpInValidList&&bIsPrompted){for(var z=0;z<aInvalid_Prompt_Operators.length;z++){if(ov==aOperatorsList[aInvalid_Prompt_Operators[z]]){bOpInValidList=false;break;}}}if(bOpInValidList){var newOp=new Option((mstr.utils.ISFF?oOption.text:oOption.innerText),ov,false,false);oOperatorListName.options[oOperatorListName.options.length]=newOp;var newOv=getOptionValue(newOp);if(newOv==currentValue){newOp.selected=true;selected=true;}}}if(!selected&&oOperatorListName.options.length>0){oOperatorListName.options[0].selected=true;}}}}}}catch(err){microstrategy.errors.log(err);}}function isMarked(oOption){return(oOption.tagName=="div"||oOption.tagName=="DIV");}function getMarkedOption(oOption){return oOption.firstChild;}function addMarked(oSelect,oOption){var markedNode=document.createElement("div");markedNode.style.display="none";var clonedOption=oOption.cloneNode(true);markedNode.appendChild(clonedOption);oSelect.replaceChild(markedNode,oOption);}function removeMarked(oSelect,oOption){var markedNode=oOption.parentNode;var clonedOption=oOption.cloneNode(true);oSelect.replaceChild(clonedOption,markedNode);}function removeConstantPrompt(sConstPromptContainerName,sConstPromptReplaceName,sConstFieldCorrectName){var node=getObj(sConstPromptContainerName);var replaceNode=getObj(sConstPromptReplaceName);if(node){if(replaceNode){node.parentNode.replaceChild(replaceNode,node);replaceNode.style.visibility="visible";replaceNode.style.display="inline";var constNode=getObj("disabled_"+sConstFieldCorrectName);if(constNode){constNode.id=sConstFieldCorrectName;constNode.name=sConstFieldCorrectName;}var hiddenNode=document.createElement("input");hiddenNode.setAttribute("type","hidden");hiddenNode.setAttribute("name","removeConstPrompt");hiddenNode.setAttribute("value","1");node.appendChild(hiddenNode);}}}function onChangeCheckForDisabledOps(oOperatorListName){if(oOperatorListName&&(oOperatorListName.options.selectedIndex>-1)){var disableValue=oOperatorListName.options[oOperatorListName.options.selectedIndex].getAttribute("disable");if(disableValue){if(disableValue=="1"){oOperatorListName.options[oOperatorListName.options.selectedIndex].selected=false;for(var count=0;count<oOperatorListName.options.length;count++){var sDisableProp=oOperatorListName.options[count].getAttribute("disable");if(sDisableProp&&(sDisableProp=="0")){oOperatorListName.options[count].selected=true;break;}}}}}}function onChangeDisableConstPrompt(oOperatorListName){if(oOperatorListName&&(oOperatorListName.options.selectedIndex>-1)){var optionValue=oOperatorListName.options[oOperatorListName.options.selectedIndex].value;var disablePromptButton=false;for(var z=0;z<aInvalid_Prompt_Operators.length;z++){if(optionValue==aOperatorsList[aInvalid_Prompt_Operators[z]]){disablePromptButton=true;break;}}var promptButton=getObj("constantPromptButton");if(promptButton){if(disablePromptButton){if(!promptButton.disabled){promptButton.className="promptButtonDisabled";promptButton.disabled=true;}}else{if(promptButton.disabled){promptButton.className="promptButton";promptButton.disabled=false;}}}}}function submitAddWizardOnChange(oPulldownName,sFormName,sExpression,sDisableButton){var bSubmit="1";if(oPulldownName&&(oPulldownName.options.selectedIndex>-1)){var disableValue=oPulldownName.options[oPulldownName.options.selectedIndex].getAttribute("disable");if(disableValue){if(disableValue=="1"){bSubmit="0";}}if(bSubmit=="1"){if(sDisableButton){objTargetButton=document.getElementById(sDisableButton);objTargetButton.disabled=true;}submitFE(sFormName,sExpression);}}}function hideValueTextbox(operatorPulldown,valueTextbox,calendarButton){var oOperator=getObj(operatorPulldown);var oValue=getObj(valueTextbox);var oCalendar=getObj(calendarButton);if(oOperator&&oValue){var opKeys=oOperator.value.split(ITEM_SEPARATOR);if((opKeys[0]=="54")||(opKeys[0]=="55")){if((oValue.parentNode!=null)&&(oValue.parentNode.nodeName=="DIV")){oValue.parentNode.style.visibility="hidden";}else{oValue.style.visibility="hidden";}if(oCalendar){oCalendar.style.visibility="hidden";}}else{if((oValue.parentNode!=null)&&(oValue.parentNode.nodeName=="DIV")){oValue.parentNode.style.visibility="visible";}else{oValue.style.visibility="visible";}if(oCalendar){oCalendar.style.visibility="visible";}}}}function showHideTextBox(){var oSpan=getObj("Text2");var oSelect=getObj("ConditionSelect");if(oSelect.options[oSelect.selectedIndex].value=="Between"){if(arguments.length==1){sTextBox='and <INPUT ID="ValueText2" SIZE="10" TYPE="TEXT" VALUE="'+arguments[0]+'" STYLE="font-size: 7pt; font-family: Verdana; z-index: 199;">';}else{sTextBox='and <INPUT ID="ValueText2" SIZE="10" TYPE="TEXT" VALUE="" STYLE="font-size: 7pt; font-family: Verdana; z-index: 199;">';}sTextBox+='<IMG SRC="Images/List.gif" ALIGN="ABSMIDDLE" HEIGHT="19" WIDTH="19" ALT="List" BORDER="0" STYLE="cursor: hand;" />&nbsp;';writeToDiv(sTextBox,oSpan);}else{writeToDiv("",oSpan);}}function isItemInList(option,oList){var bIsInList=false;for(j=oList.length-1;j>=0;j--){if(option.value==oList.options[j].value){bIsInList=true;break;}}return bIsInList;}function MoveItemsbyListObject(sFromList,sToList,sAnswerList,sSelectedAnswerList,bRemoveFromItem,bAddToItem,moveAll,isRA){try{var oForm=getObj("feForm");var i;var lLength;var bFlag=true;var oFromList=getObj(sFromList);var oToList=getObj(sToList);var lIndexSelected=-1;var lNumSelections=0;var toAvail=sFromList===sSelectedAnswerList;var toSelected=!toAvail;var toLength=oToList.options.length;if(bRemoveFromItem==null){bRemoveFromItem=true;}if(bAddToItem==null){bAddToItem=true;}lLength=oFromList.options.length;for(i=0;i<lLength;i++){var option=oFromList.options[i];if(option&&!option.disabled&&(option.selected||moveAll)&&(getOptionValue(option)!="-none-")){var bAddItemToList=true;if(!bRemoveFromItem){if(isItemInList(option,oToList)){bAddItemToList=false;}}if(bAddToItem&&bAddItemToList){var text=option.text;if(isRA&&toSelected){var level=option.getAttribute("lvl");if(level>0){text=text.substring(2*level);}}var oOption=new Option(text,getOptionValue(option),false,true);oOption.title=option.title;if((oToList.length==1)&&(getOptionValue(oToList.options[0])=="-none-")){oToList.options[0]=oOption;}else{oToList.options[oToList.length]=oOption;}if(oToList.options[oToList.length-1]){oToList.options[oToList.length-1].selected=false;}}else{if(isRA&&toAvail){var j,toOption;for(j=0;j<toLength;j++){toOption=oToList.options[j];if(toOption.value===option.value){toOption.disabled=false;break;}}}}lIndexSelected=i;lNumSelections=lNumSelections+1;}}if(bRemoveFromItem){for(i=lLength-1;i>=0;i--){if(oFromList.options[i]&&(oFromList.options[i].selected==true||moveAll)&&(getOptionValue(oFromList.options[i])!="-none-")){oFromList.options[i]=null;}}}if(oFromList.options.length==0){var oOption=new Option("--- "+microstrategy.descriptors.getDescriptor(2020)+" ---","-none-",false,false);oFromList.options[0]=oOption;oFromList.options[0].selected=false;}if(!bRemoveFromItem&&(oFromList.options.length>1)){if(lNumSelections>0){for(i=0;i<=lIndexSelected;i++){var opt=oFromList.options[i];if(opt.selected||moveAll){opt.selected=false;if(isRA){opt.disabled=true;}}}}if((lIndexSelected>=0)&&(oFromList.options[lIndexSelected+1]!=null)){oFromList.options[lIndexSelected+1].selected=true;}else{if(lIndexSelected==-1){}}}else{if((lIndexSelected>0)&&(oFromList.options.length>0)){if(lIndexSelected>=lNumSelections){if(oFromList.options.length>lIndexSelected-lNumSelections+1){oFromList.options[lIndexSelected-lNumSelections+1].selected=true;}else{oFromList.options[oFromList.options.length-1].selected=true;}}else{lNumSelections=lNumSelections-1;oFromList.options[lIndexSelected-lNumSelections].selected=true;}}else{if(lIndexSelected>-1){oFromList.options[0].selected=true;}}}BuildFilterSelections(sAnswerList,sSelectedAnswerList);if(sSelectedAnswerList==oToList.id){updateAddRemoveButtons(oFromList,oToList);}else{updateAddRemoveButtons(oToList,oFromList);}if(mstrFilterEditorImpl.setupShoppingCartScrollable){mstrFilterEditorImpl.setupShoppingCartScrollable(microstrategy.findAncestorWithTag(oFromList,"TABLE"));}}catch(err){alert(err.value);}}function updateAddRemoveButtons(oAvailable,oSelected){if(oAvailable){updateMoveButton(oAvailable,"262144005");}if(oSelected){updateMoveButton(oSelected,"262144006");}}function updateMoveButton(oList,moveSingleId){if(oList){var moveSingleButton=document.getElementById(moveSingleId);var lLength=oList.options.length;var oOption;var bSelected=false;if(moveSingleButton){moveSingleButton.firstChild.className=moveSingleButton.firstChild.className.replace("Disabled","");if(moveSingleButton.getAttribute("disabled")){moveSingleButton.removeAttribute("disabled");}for(var i=0;i<lLength;i++){oOption=oList.options[i];if(oOption.selected&&oOption.value!="-none-"){bSelected=true;break;}}if(!bSelected){moveSingleButton.firstChild.className+="Disabled";moveSingleButton.setAttribute("disabled","true");}}}}function BuildFilterSelections(sAnswerName,sListBoxName){var i;var j;var lLength;var oOptions;var oListBox;var oAnswer;if(sListBoxName!=null){oListBox=getObj(sListBoxName);oAnswer=getObj(sAnswerName);if(oListBox!=null){oOptions=oListBox.options;lLength=oOptions.length;if(oOptions[0]!=null){oAnswer.value="";if(oOptions[0].value!="-none-"){for(j=0;j<lLength;j++){if(oOptions[j]!=null){oAnswer.value+=getOptionValue(oOptions[j])+unescape(UNIT_SEPARATOR);}}}}}}return(true);}function submitFE(sFormName,sExpression){var oForm=getObj(sFormName);if(oForm!=null){var oNewItem=document.createElement("INPUT");if(oNewItem!=null){oNewItem.type="HIDDEN";oForm.insertAdjacentElement("beforeEnd",oNewItem);oNewItem.name=sExpression;submitForm(oForm,true);}}}function submitFEArgs(sFormName,sEvent,sArguments){var oldForm=getObj(sFormName);if(!oldForm){return ;}var oForm=oldForm.cloneNode(true);oForm.onsubmit=oldForm.onsubmit;updateDynamicInput(oForm,sEvent);if(sArguments!=null){var sPartialStr=sArguments;var iIndex=sPartialStr.indexOf("~");var nameStr="";var valueStr="";var iCount=0;while(iIndex!=-1){if(iCount==0){nameStr=sPartialStr.substr(0,iIndex);iCount=1;}else{if(iCount==1){valueStr=sPartialStr.substr(0,iIndex);updateDynamicInput(oForm,nameStr,valueStr);iCount=0;}}sPartialStr=sPartialStr.substr(iIndex+1);iIndex=sPartialStr.indexOf("~");}if(iCount==1){updateDynamicInput(oForm,nameStr,sPartialStr);}}oldForm.parentNode.appendChild(oForm);submitForm(oForm,true);oldForm.parentNode.removeChild(oForm);}function submitUpdateManagerEvent(obj,beanPath,eventID,paramIDs,paramVals){if(microstrategy){var updateManager=microstrategy.updateManager;var actionCollection=new Array();actionCollection.push(updateManager.createActionObject(obj,eventID,beanPath,paramIDs,paramVals));updateManager.add(actionCollection);obj.isSubmitting=true;}}function submitUpdateManagerChanges(){if(microstrategy){var updateManager=microstrategy.updateManager;updateManager.flushAndSubmitChanges();}}function checkFormSubmission(e,obj,targetButton){if(!e){e=window.event;}if(e!=null&&e.keyCode==13){var objTargetButton=targetButton;if(typeof (objTargetButton)=="string"){objTargetButton=document.getElementById(targetButton);}if(objTargetButton!=null&&objTargetButton.focus){objTargetButton.focus();}}}function cancelEnterKey(e,tagName){if(!e){e=window.event;}if(e!=null&&e.keyCode==13){var tgt=e.target||e.srcElement;if(tgt.tagName==tagName){e.preventDefault();return false;}}}function checkEnterKeyDown(obj,e,tagName){if(obj.isSubmitting){cancelEnterKey(e,tagName);}}