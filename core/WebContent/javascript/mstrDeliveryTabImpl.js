mstrDeliveryTabImplScript=true;mstrDeliveryTabImpl.prototype=new mstrTabImpl();mstrDeliveryTabImpl.TAB_INDEX=4;mstrDeliveryTabImpl.prototype.onload=function(){try{this.initEditor();if(this.tabManager.currentTab==4){this.onpostswitch();}}catch(err){microstrategy.errors.log(err);}};mstrDeliveryTabImpl.prototype.onreload=function(){try{if(this.tabManager.currentTab==mstrDeliveryTabImpl.TAB_INDEX){this.tabManager.deliveryTab=this;this.onpostswitch();}}catch(err){microstrategy.errors.log(err);}};mstrDeliveryTabImpl.prototype.initUserInfo=function(async){try{var tb=this;if(!!tb.asLoaded){return ;}iframe.showWaitPage();var at=this.getAppliesTo();mstr.$XHR.request(mstrApp.taskURL||mstrConfig.taskURL,{taskId:"getSubscriptionAssociatedInformation",loadInfo:"user",objectID:at.reportID,objectType:at.objTypeReport,msgID:at.messageID},{success:function(res){tb.asLoaded=true;tb.canBeSubscribed=!res.user.nc;tb.userType=res.user.ut;tb.userTypeWas=tb.userType;tb.selectedUsers=res.user.items;tb.userSubscribeRights=res.user.rgts;}},async);iframe.hideWaitPage();}catch(err){microstrategy.errors.log(err);}};mstrDeliveryTabImpl.prototype.toggleOverlay=function(){try{var aclEditor=microstrategy.findChildWithAtt(this.elem,"div","id","mstr"+this.id),container=aclEditor.firstChild,curtain=aclEditor.lastChild;curtain.style.cssText+=";height:"+container.offsetHeight+"px; width:"+container.offsetWidth+"px;display:"+(this.getUserType()!=2?"block":"none");}catch(err){microstrategy.errors.log(err);}};mstrDeliveryTabImpl.prototype.onpostswitch=function(){try{var at=this.getAppliesTo();if(at.isReportBlank){return ;}this.tabManager.deliveryTab=this;this.initUserInfo(false);if(!this.canBeSubscribed){this.elem.style.display="none";return ;}var tb=this,ut=tb.userType,elInputs=microstrategy.findChildrenWithAtt(this.elem,"input","type","radio");for(var i=0,len=elInputs.length;i<len;i++){var el=elInputs[i];el.checked=el.value==ut;}this.aclPlaceholder=this.aclPlacholder||document.getElementById("aclEditorPlaceholder");var mojoid="mstr"+tb.id,aclEditor=window.mstrmojo&&mstrmojo.all[mojoid];if(!aclEditor){this.renderACLEditor(mojoid);}else{if(aclEditor&&aclEditor.hasRendered){try{if(!aclEditor.domNode.offsetParent){aclEditor.unrender();aclEditor.placeholder=this.aclPlaceholder;aclEditor.set("oi",mstrmojo.hash.copy({acls:tb.selectedUsers},aclEditor.oi));aclEditor.render();}}catch(err){if(mstr.utils.ISIE8&&err.number==-2147467259){aclEditor.unrender();aclEditor.placeholder=this.aclPlaceholder;aclEditor.set("oi",mstrmojo.hash.copy({acls:tb.selectedUsers},aclEditor.oi));aclEditor.render();}}}}tb.tmr=window.setInterval(function(){if(window.mstrmojo&&mstrmojo.all[mojoid]){tb.toggleOverlay();window.clearInterval(tb.tmr);}},100);var ov=this.getAssociatedUserInfo();tb.userTypeWas=ov.userType;tb.usersWas=ov.users;}catch(err){microstrategy.errors.log(err);}};mstrDeliveryTabImpl.prototype.renderACLEditor=function(mojoId){try{var tb=this;microstrategy.showSharingEditor(null,null,null,{id:mojoId,modal:false,showSharingOptions:false,showButtonBar:false,cssClass:"mstrmojo-SharingEditor ReportDeliveryACL",cssText:"position:static; border:0 none; box-shadow:none;",left:"1px",top:"1px",showTitle:false,showACLHint:false,showPublisAccess:false,placeholder:tb.aclPlaceholder,acls:tb.selectedUsers,onhasChangedChange:function(){microstrategy.bones[tb.id].selectedUsers=this.getACLItems();},getAvailableRightsForSelection:function(){return tb.userSubscribeRights.items;}});}catch(err){microstrategy.errors.log(err);}};mstrDeliveryTabImpl.prototype.onclick=function(){try{this.userType=this.getUserType();this.toggleOverlay();}catch(err){microstrategy.errors.log(err);}};mstrDeliveryTabImpl.prototype.getAssociatedUserInfo=function(){try{var tb=this,userType=this.getUserType(),selectedUsers=tb.selectedUsers;var allowType={0:1,1:0,2:1}[userType];var v=[];if(userType===2){for(var i=0,len=selectedUsers.length;i<len;i++){var user=selectedUsers[i],allow=tb.userSubscribeRights[user.rgt];v.push(user.did+ITEM_SEPARATOR+allow+ITEM_SEPARATOR+user.n);}}var users=v.join(CLIPBOARD_ITEM_SEPARATOR);return{userType:userType,allowType:allowType,users:users};}catch(err){microstrategy.errors.log(err);}};mstrDeliveryTabImpl.prototype.getUserType=function(){try{var ut=0,elInputs=document.getElementsByName("userType");for(var i=0,len=elInputs.length;i<len;i++){if(elInputs[i].checked){ut=elInputs[i].value;break;}}return parseInt(ut,10);}catch(err){microstrategy.errors.log(err);}};function mstrDeliveryTabImpl(id){this.inherits=mstrTabImpl;this.inherits(id);delete this.inherits;return this;}