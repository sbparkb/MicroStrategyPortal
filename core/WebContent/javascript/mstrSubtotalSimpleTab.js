mstrSubtotalSimpleTabScript=true;mstrSubtotalSimpleTab.prototype=new mstrTabImpl();mstrSubtotalSimpleTab.prototype.path="";mstrSubtotalSimpleTab.prototype.verifiedPath="";mstrSubtotalSimpleTab.GRAND_TOTAL_CHECKBOX_NAME="grandTotalCheckBox";mstrSubtotalSimpleTab.ALL_SUBTOTAL_CHECKBOX_NAME="subtotalCheckBox";mstrSubtotalSimpleTab.GRAND_TOTAL_ID_PREFIX="gtc";mstrSubtotalSimpleTab.ALL_SUBTOTAL_ID_PREFIX="stc";mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNDEFINED="checkUndefined";mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED="checkOff";mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED="checkOn";mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_DISABLED="checkDisabled";mstrSubtotalSimpleTab.SUBTOTAL_INDEX_NO_SUBTOTALS=1000;mstrSubtotalSimpleTab.prototype.onload=function(){try{this.initializing=true;this.path="microstrategy.bone('"+this.id+"')";this.initEditor();this.initSettings();this.initializing=false;}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.onreload=function(){try{this.settingsInitialzed=false;mstrTabImpl.prototype.onreload.call(this);if(!this.settingsInitialzed){this.initSettings();}}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.onpostload=function(){try{mstrBoneImpl.prototype.onpostload.call(this);var at=this.getAppliesTo();this.initializing=true;this.initValues();this.initializing=false;}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.initSharedObj=function(sharedObj){if(!sharedObj.initialized){mstrSubtotalsObjImpl.initSubtotalsArray(sharedObj);}};mstrSubtotalSimpleTab.prototype.initSettings=function(){try{var subtotalCheckBoxes=microstrategy.findChildrenWithAtt(this.elem,"div","name",mstrSubtotalSimpleTab.ALL_SUBTOTAL_CHECKBOX_NAME);var grandTotalCheckBoxes=microstrategy.findChildrenWithAtt(this.elem,"div","name",mstrSubtotalSimpleTab.GRAND_TOTAL_CHECKBOX_NAME);this.verifiedPath=microstrategy.getEventHandlerString(this.path);if(subtotalCheckBoxes!=null&&grandTotalCheckBoxes!=null){for(var i=0;i<subtotalCheckBoxes.length;i++){subtotalCheckBoxes[i].onclick=new Function("e",this.verifiedPath+" { return "+this.path+".onclick(e); }");grandTotalCheckBoxes[i].onclick=new Function("e",this.verifiedPath+" { return "+this.path+".onclick(e); }");}}this.settingsInitialzed=true;}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.initValues=function(){try{var at=this.getAppliesTo();this.initializing=true;if(this.tabManager.sharedObj){this.initSharedObj(this.tabManager.sharedObj);}var subtotals=(this.tabManager.sharedObj)?this.tabManager.sharedObj.subtotals:null;if(subtotals==null){return false;}for(var i in subtotals){var index=subtotals[i].index;var allSubtotalState=this.getAllSubtotalsState(subtotals[i]);var grandTotalState=this.getGrandTotalsState(subtotals[i]);this.changeCheckBoxBasedOnState(index,allSubtotalState,grandTotalState);}if(this.tabManager.sharedObj.currentIndex==0){this.tabManager.sharedObj.currentIndex=this.getHighestCheckedSubtotalIndex();}this.initializing=false;}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.onclick=function(e){try{if(!e){e=window.event;}var src=getEventTarget(e);var srcCheckBoxName=src.getAttribute("name");var sbIndex=src.getAttribute("value");var currentState=src.className;if(currentState==mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_DISABLED){return ;}var subtotalObj=this.tabManager.sharedObj.subtotals[sbIndex];var subtotalCheckBox=document.getElementById(mstrSubtotalSimpleTab.ALL_SUBTOTAL_ID_PREFIX+sbIndex.toString());var grandTotalCheckBox=document.getElementById(mstrSubtotalSimpleTab.GRAND_TOTAL_ID_PREFIX+sbIndex.toString());var states=this.getNextCheckBoxState(srcCheckBoxName,currentState,subtotalCheckBox,grandTotalCheckBox);if(states!=null){this.updateCheckBox(subtotalCheckBox,states[0]);this.updateCheckBox(grandTotalCheckBox,states[1]);this.updateSubtotalObjState(subtotalObj,states[0],states[1]);this.updateCurrentSubtotalIndex(sbIndex,states[0],states[1]);}}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.changeCheckBoxBasedOnState=function(subtotalIndex,allSubtotalState,grandTotalState){try{var subtotalCheckBox=document.getElementById(mstrSubtotalSimpleTab.ALL_SUBTOTAL_ID_PREFIX+subtotalIndex.toString());var grandTotalCheckBox=document.getElementById(mstrSubtotalSimpleTab.GRAND_TOTAL_ID_PREFIX+subtotalIndex.toString());if(subtotalCheckBox){this.updateCheckBox(subtotalCheckBox,allSubtotalState);}if(grandTotalCheckBox){this.updateCheckBox(grandTotalCheckBox,grandTotalState);}}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.updateCheckBox=function(checkBox,state){try{checkBox.className=state;}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.getNextCheckBoxState=function(srcCheckBoxName,currentState,subtotalCheckBox,grandTotalCheckBox){try{var nextState=currentState;var allSubtotalState;var grandSubtotalState;switch(currentState){case mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED:nextState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED;break;case mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED:nextState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED;break;case mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNDEFINED:nextState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED;break;default:break;}if(srcCheckBoxName==mstrSubtotalSimpleTab.ALL_SUBTOTAL_CHECKBOX_NAME){allSubtotalState=nextState;if(nextState==mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED){grandSubtotalState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_DISABLED;}else{if(nextState==mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED){grandSubtotalState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED;}}}else{if(srcCheckBoxName==mstrSubtotalSimpleTab.GRAND_TOTAL_CHECKBOX_NAME){grandSubtotalState=nextState;allSubtotalState=subtotalCheckBox.className;}}var _result=new Array();_result[0]=allSubtotalState;_result[1]=grandSubtotalState;return _result;}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.updateSubtotalObjState=function(subtotalObj,allSubtotalState,grandTotalState){try{subtotalObj.clear();if(allSubtotalState==mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED){subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_ROWS,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_OUTLINE);subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_COLUMNS,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_OUTLINE);subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_PAGE_BY,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_GRANDTOTAL);}else{if(grandTotalState==mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED){subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_ROWS,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_GRANDTOTAL);subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_COLUMNS,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_GRANDTOTAL);subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_PAGE_BY,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_GRANDTOTAL);}else{if(allSubtotalState==mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED&&grandTotalState==mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED){subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_ROWS,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_NONE);subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_COLUMNS,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_NONE);subtotalObj.setStyleByAxis(microstrategy.GRIDCELL_AXIS_PAGE_BY,mstrSubtotalsObjImpl.SUBTOTAL_STYLE_NONE);}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.getSimpleSubtotalsState=function(subtotalObj){var allSubtotalsState;var grandSubtotalsState;var state=subtotalObj.getState();if(state==mstrSubtotalsObjImpl.SUBTOTAL_STATE_IN_ACTIVE){allSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED;grandSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED;}else{if(state!=mstrSubtotalsObjImpl.SUBTOTAL_STATE_BY_POSITION){allSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNDEFINED;grandSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_DISABLED;}else{var rowStyle=subtotalObj.getStyleByAxis(microstrategy.GRIDCELL_AXIS_ROWS);var colStyle=subtotalObj.getStyleByAxis(microstrategy.GRIDCELL_AXIS_COLUMNS);var pageStyle=subtotalObj.getStyleByAxis(microstrategy.GRIDCELL_AXIS_PAGE_BY);var rowIsOutline=(rowStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_OUTLINE);var rowIsGrand=(rowStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_GRANDTOTAL);var rowIsNone=(rowStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_NONE);var colIsOutline=(colStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_OUTLINE);var colIsGrand=(colStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_GRANDTOTAL);var colIsNone=(colStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_NONE);var pageIsOutline=(pageStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_OUTLINE);var pageIsGrand=(pageStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_GRANDTOTAL);var pageIsNone=(pageStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_NONE);var pageIsCube=(pageStyle==mstrSubtotalsObjImpl.SUBTOTAL_STYLE_CUBE);if(rowIsOutline&&colIsOutline&&pageIsGrand){allSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED;grandSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_DISABLED;}else{if(rowIsGrand&&colIsGrand&&pageIsGrand){allSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED;grandSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_CHECKED;}else{if(rowIsOutline||colIsOutline||pageIsOutline){allSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNDEFINED;grandSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_DISABLED;}else{if(rowIsGrand||colIsGrand||pageIsGrand){allSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED;grandSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNDEFINED;}else{if(colIsNone&&rowIsNone){if(pageIsNone){allSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED;grandSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED;}else{if(pageIsCube){allSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNDEFINED;grandSubtotalsState=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_DISABLED;}}}}}}}}}var _result=new Array();_result[0]=allSubtotalsState;_result[1]=grandSubtotalsState;return _result;};mstrSubtotalSimpleTab.prototype.getAllSubtotalsState=function(subtotalObj){var totalsArray=this.getSimpleSubtotalsState(subtotalObj);return totalsArray[0];};mstrSubtotalSimpleTab.prototype.getGrandTotalsState=function(subtotalObj){var totalsArray=this.getSimpleSubtotalsState(subtotalObj);return totalsArray[1];};mstrSubtotalSimpleTab.prototype.getHighestCheckedSubtotalIndex=function(){var _result=mstrSubtotalSimpleTab.SUBTOTAL_INDEX_NO_SUBTOTALS;var subtotals=this.tabManager.sharedObj.subtotals;var posLookupTable=new Object();var index=1;for(var subtotalIndex in subtotals){posLookupTable[subtotalIndex]=index;index++;}for(var i in subtotals){var allsubtotalState=this.getAllSubtotalsState(subtotals[i]);var grandTotalState=this.getGrandTotalsState(subtotals[i]);if(allsubtotalState!=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED||grandTotalState!=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED){if(posLookupTable[i]<_result){_result=i;}}}return _result;};mstrSubtotalSimpleTab.prototype.updateCurrentSubtotalIndex=function(newIndex,allsubtotalState,grandTotalState){if(allsubtotalState!=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED||grandTotalState!=mstrSubtotalSimpleTab.SUBTOTAL_CHECKBOXSTATE_UNCHECKED){this.tabManager.sharedObj.currentIndex=newIndex;}else{this.tabManager.sharedObj.currentIndex=this.getHighestCheckedSubtotalIndex();}};mstrSubtotalSimpleTab.prototype.onstatechange=function(){try{this.initValues();}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.applyPropertyChanges=function(propertiesArray){};mstrSubtotalSimpleTab.prototype.applySharedObjChanges=function(propertiesArray){try{var subtotals=this.tabManager.sharedObj.subtotals;var len=mstr.utils.Hash.len(subtotals);var index=null;for(i=len;i>=1;i--){if(!subtotals[i]){continue;}if(subtotals[i].isChanged){index=subtotals[i].index;if(subtotals[i].axisStyles!=null&&mstr.utils.Hash.len(subtotals[i].axisStyles)>0){for(var axis in subtotals[i].axisStyles){var propChange=new this.propChangeObject(null,"setSubtotalAxisStyle",axis+"|"+index+"|"+subtotals[i].axisStyles[axis]);propertiesArray.push(propChange);}}else{if(subtotals[i].selectedUnits!=null&&mstr.utils.Hash.len(subtotals[i].selectedUnits)>0){var propChange=new this.propChangeObject(null,"setSubtotalSelectedUnit",index+"|"+subtotals[i].getSelectedUnitsAsString());propertiesArray.push(propChange);}else{var propChange=new this.propChangeObject(null,"disableSubtotal",index);propertiesArray.push(propChange);}}}}if(index!=null){this.setCurrentSubtotalIndex(index);}}catch(err){microstrategy.errors.log(err);return false;}};mstrSubtotalSimpleTab.prototype.setCurrentSubtotalIndex=function(index){try{var um=microstrategy.updateManager;var actionArray=new Array();var action=um.createActionObject(null,mstrUpdateManager.SET_CURRENT_SUBTOTAL_INDEX,this.tabManager.sharedObj.subtotalBeanPath,["66004"],[index],[]);actionArray.push(action);um.add(actionArray);}catch(err){microstrategy.errors.log(err);return false;}};function mstrSubtotalSimpleTab(id){this.inherits=mstrTabImpl;this.inherits(id);delete this.inherits;return this;}