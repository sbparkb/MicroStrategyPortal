mstrSearchTabsImpl.prototype=new mstrBoneImpl();mstrSearchTabsImpl.prototype.visible=true;mstrSearchTabsImpl.prototype.searchOptionsVisible=true;mstrSearchTabsImpl.prototype.selectedIndex=0;mstrSearchTabsImpl.prototype.width=220;mstrSearchTabsImpl.prototype.width_minimized=30;mstrSearchTabsImpl.NODE_TYPE_TAB="tab";mstrSearchTabsImpl.NODE_TYPE_TITLE="ttl";mstrSearchTabsImpl.NODE_TYPE_TITLE_ACTION="act";mstrSearchTabsImpl.NODE_TYPE_CONTENT="cnt";mstrSearchTabsImpl.NODE_TYPE_BUTTON="btn";mstrSearchTabsImpl.NODE_ATT_INDEX="o";mstrSearchTabsImpl.prototype.onload=function(){try{this.initBone();this.tabs=microstrategy.findChildrenWithAtt(this.elem,"div","ty",mstrSearchTabsImpl.NODE_TYPE_TAB);var b=microstrategy.bone(this.id);for(var i=0,len=this.tabs.length;i<len;i++){this.tabs[i].onclick=function(e){b.onclick(e);};this.tabs[i].setAttribute(mstrSearchTabsImpl.NODE_ATT_INDEX,i);}this.elTitles=microstrategy.findChildrenWithAtt(this.elem,"div","ty",mstrSearchTabsImpl.NODE_TYPE_TITLE);this.elContents=microstrategy.findChildrenWithAtt(this.elem,"div","ty",mstrSearchTabsImpl.NODE_TYPE_CONTENT);this.btnAction=microstrategy.findChildWithAtt(this.elem,"div","ty",mstrSearchTabsImpl.NODE_TYPE_TITLE_ACTION);this.btnAction.onclick=function(e){b.toggleSearchOptions(e);};this.btnToggler=microstrategy.findChildWithAtt(this.elem,"div","ty",mstrSearchTabsImpl.NODE_TYPE_BUTTON).firstChild;if(this.btnToggler){this.btnToggler.onclick=function(e){b.toggleSidebar(e);};}this.updateAvailableHeight();var searchBone=microstrategy.bone("mstrSearchSuggest");if(searchBone){this.selectedIndex=searchBone.hasSearchPattern?0:this.selectedIndex;}this.setTab(this.selectedIndex||0,true);this.elem.style.height=this.totalHeight+"px";microstrategy.eventManager.notifyOrphanBones("onselectionchange");this.initSidebarStatus();}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.onpostload=function(){try{mstrBoneImpl.prototype.onpostload.call(this);microstrategy.eventManager.notifyOrphanBones("onselectedSearchTabChange",this.selectedIndex);}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.initSidebarStatus=function(){try{this.visible=this.visible==undefined||this.visible==1?true:false;if(this.visible){this.setCssClass(this.tabs[this.selectedIndex],"selected",true);}this.slideSidebar();if(!this.visible){this.updateTooltip();}this.updateToggleButton();}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.updateToggleButton=function(){try{this.btnToggler.className=this.btnToggler.className.replace(/ expand/,"")+(this.visible?"":" expand");this.btnToggler.title=microstrategy.descriptors.getDescriptor(this.visible?1995:2969);}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.updateAvailableHeight=function(){try{var bm=mstr.utils.BoxModel,bH=bm.getBrowserWindowHeight(document),tabTop=parseInt(bm.position(this.elem).top,10),tabH=microstrategy.findChildWithAtt(this.tabs[0],"div","ty",mstrSearchTabsImpl.NODE_TYPE_TITLE).offsetHeight,togglerH=this.btnToggler.offsetHeight+2,adjust=15;var minH=tabH*this.tabs.length+togglerH+adjust;this.totalHeight=Math.max(minH,(bm.getBrowserWindowHeight(document)-parseInt(bm.position(this.elem).top,10)))-5;this.tabContentHeight=(bH-tabTop-minH);}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.onwinresize=function(){try{if(!this.elem){return ;}this.updateAvailableHeight();var curTabContent=this.elContents[this.selectedIndex];if(curTabContent.innerHTML&&curTabContent.expanded){curTabContent.style.height=this.tabContentHeight+"px";}this.elem.style.height=this.totalHeight+"px";}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.updateTooltip=function(){try{for(var i=0,len=this.elTitles.length;i<len;i++){var el=this.elTitles[i];el.title=this.visible?"":el.textContent||el.innerText;}}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.toggleSidebar=function(){try{var show=(this.visible=!this.visible);microstrategy.updateCookieSetting("sps",show?1:0);microstrategy.updateBrowserSetting("sps",show?1:0);this.slideSidebar();this.slide(this.selectedIndex,show&&this.searchOptionsVisible);}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.slideSidebar=function(){try{var show=this.visible;if(!show){start=this.elem.offsetWidth;end=this.width_minimized;}else{start=this.width_minimized;end=mstr.utils.ISIE7?275:this.width;}var elem=this.elem;var fnOnEnd=show&&!mstr.utils.ISIE7?function(){elem.style.width="auto";}:null;this.fx(elem,"width",start,end,10,100,"px",fnOnEnd);this.updateTooltip();this.updateToggleButton();this.toggleActionButton();}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.fx=function(target,prop,start,end,interval,duration,suffix,onEnd){try{var sb=microstrategy.bone("mstrSearchSuggest");if(sb){sb.fx(target,prop,start,end,interval,duration,suffix,onEnd);}}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.toggleSearchOptions=function(e){try{e=e||window.event;var idx=0;var tab=this.tabs[idx];if(e){var tgt=getEventTarget(e);var _tab=microstrategy.findAncestorWithAtt(tgt,"ty",mstrSearchTabsImpl.NODE_TYPE_TAB);if(_tab){tab=_tab;idx=parseInt(tab.getAttribute(mstrSearchTabsImpl.NODE_ATT_INDEX),10)||idx;}}var b=this;var show=(b.searchOptionsVisible=!b.searchOptionsVisible)&&b.visible;b.setCurrentTab(idx);this.setCssClass(tab,"expanded",show);this.slide(0,show);this.btnAction.className=this.btnAction.className.replace(/ collapsed/,"")+(show?"":" collapsed");if(tgt){tgt.title=microstrategy.descriptors.getDescriptor(show?8952:8951);}}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.toggleActionButton=function(e){try{var btn=this.btnAction;btn.className=this.btnAction.className.replace(/ collapsed/,"")+(this.searchOptionsVisible?"":" collapsed");if(btn){btn.title=microstrategy.descriptors.getDescriptor(this.searchOptionsVisible?8952:8951);}}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.onclick=function(e){try{e=e||window.event;var tgt=e.target||e.srcElement,idx=parseInt(tgt.getAttribute(mstrSearchTabsImpl.NODE_ATT_INDEX)||tgt.parentNode.getAttribute(mstrSearchTabsImpl.NODE_ATT_INDEX));this.setCurrentTab(idx);}catch(err){microstrategy.errors.log(err);return false;}};mstrSearchTabsImpl.prototype.setCurrentTab=function(idx){try{var b=this;if(b&&!isNaN(idx)&&idx!=b.selectedIndex){b.setTab(b.selectedIndex||0,false);b.selectedIndex=idx;b.setTab(b.selectedIndex,true);microstrategy.updateCookieSetting("sidx",idx);microstrategy.updateBrowserSetting("sidx",idx);microstrategy.eventManager.notifyOrphanBones("onselectedSearchTabChange",this.selectedIndex);}}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.setTab=function(idx,selected){try{var tab=this.tabs[idx];this.toggleHilite(tab,selected);this.setCssClass(tab,"selected",selected);if(idx!=0||idx==0&&this.searchOptionsVisible&&this.visible){this.slide(idx,selected);}this.setSiblingTab(idx,!selected);this.setCurrentStack(idx,selected);}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.setSiblingTab=function(idx,clear){try{var add=clear?false:true;if(idx>0){this.setCssClass(this.tabs[idx-1],"prev",add);}if(idx<this.tabs.length-1){this.setCssClass(this.tabs[idx+1],"next",add);}}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.setCssClass=function(tab,cssClass,add){try{if(add){tab.className+=" "+cssClass;}else{tab.className=tab.className.replace(new RegExp(cssClass,"g"),"");}}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.setCurrentStack=function(idx,selected){try{var stack=this.stacks[idx];if(stack){this.toggleHilite(stack,selected);}}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.toggleHilite=function(node,selected){try{if(node){node.className=node.className.replace(/ selected/,"")+(selected?" selected":"");}}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.slide=function(idx,selected){try{var el=this.elContents[idx];if(el){el.expanded=selected;var show=selected;var h=el.innerHTML?this.tabContentHeight:0;if(show){el.style.display="block";el.style.height=0;start=0;end=h;}else{start=h;end=0;}this.fx(el,"height",start,end,10,100,"px",(show?function(){el.style.heightx="auto";}:function(){el.style.display="none";}));}}catch(err){microstrategy.errors.log(err);}};mstrSearchTabsImpl.prototype.oncontentexpand=function(el){try{var elScroll=this.elContents[this.selectedIndex];mstr.utils.BoxModel.scrollToElement(elScroll,el);}catch(err){microstrategy.errors.log(err);}};function mstrSearchTabsImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;return this;}