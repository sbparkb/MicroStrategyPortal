mstrPortalImplScript=true;mstrPortalImpl.prototype=new mstrBoneImpl();mstrPortalImpl.prototype.path=null;mstrPortalImpl.prototype.onload=function(){try{this.initBone();this.path="microstrategy.bone('"+this.id+"')";this.viewer=microstrategy.bone("rwb_viewer");var targetObj=microstrategy.findAncestor(this.elem);this.targetObjID=microstrategy.styleObj.getAttValue(targetObj,microstrategy.HTMLATTR_ID);this.attachEvents();var buttons=microstrategy.findChildrenWithAtt(this.elem,"img",microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_WINDOW_BUTTON);if(buttons!=null&&(buttons.length>0)){var titleHeight=getObjHeight(this.elem);if(titleHeight==0){if(this.elem.currentStyle&&"auto"!=this.elem.currentStyle.height){titleHeight=parseInt(this.elem.currentStyle.height);}else{var cs=document.defaultView&&document.defaultView.getComputedStyle;var ch=NaN;if(cs){var s=cs(this.elem,"");if(s){ch=parseInt(s.getPropertyValue("height"));}}if(!isNaN(ch)){titleHeight=ch;}}}for(var i=0;i<buttons.length;i++){if(buttons[i].id=="maximize"){this.btnMax=buttons[i];}else{if(buttons[i].id=="minimize"){this.btnMin=buttons[i];}else{if(buttons[i].id=="restore"){this.btnRestore=buttons[i];}else{if(buttons[i].id=="delete"){this.btnDelete=buttons[i];}}}}buttons[i].style.height=Math.min(Math.max(titleHeight-4,1),15)+"px";buttons[i].style.width=Math.min(Math.max(titleHeight-3,1),15)+"px";}buttons[0].parentNode.parentNode.style.width=buttons.length*Math.min(Math.max(titleHeight-4,1),15)+"px";}this.togglePulldowns();}catch(err){microstrategy.errors.log(err);return false;}};mstrPortalImpl.prototype.onreload=function(){try{mstrBoneImpl.prototype.onreload.call(this);this.togglePulldowns();}catch(err){microstrategy.errors.log(err);return false;}};mstrPortalImpl.prototype.togglePulldowns=function(){try{if(!this.elem||!this.elem.parentNode){return ;}if(this.btnMax&&this.btnMax.style.display=="none"){togglePulldowns(this.elem.parentNode,false);}else{togglePulldowns(this.elem.parentNode,true);}}catch(err){microstrategy.errors.log(err);return false;}};mstrPortalImpl.prototype.attachEvents=function(){try{this.elem=document.getElementById(this.id);this.elem.onmousedown=new Function("e","if ("+this.path+" != null) { return "+this.path+".onmousedown(e); }");this.elem.onclick=new Function("e","if ("+this.path+" != null) { return "+this.path+".onbtnclick(e); }");}catch(err){microstrategy.errors.log(err);}return false;};mstrPortalImpl.prototype.onmousedown=function(e){try{microstrategy.hidePopups();if(!e){e=window.event;}var btn=getEventTarget(e);if(btn==null||(btn.tagName.toLowerCase()=="img"&&btn.id.substr(0,btn.id.indexOf("_"))!="localDataMenu")){if(typeof (e.cancelBubble)!="undefined"){this.onbtnclick(e);e.cancelBubble=true;}return false;}}catch(err){microstrategy.errors.log(err);}return false;};mstrPortalImpl.prototype.onmouseup=function(e){try{}catch(err){microstrategy.errors.log(err);}return false;};mstrPortalImpl.prototype.onbtnclick=function(e){try{if(!e){e=window.event;}var btn=getEventTarget(e);if(btn.tagName.toLowerCase()!="img"||this.viewer==null){return ;}var selections=this.viewer&&this.viewer.doc&&this.viewer.doc.selections;var grid=microstrategy.findAncestor(btn);if(selections&&grid){selections.addToSelection(e.ctrlKey,grid);}this.viewer.commands.exec("resetObjectFormatLevel");switch(btn.getAttribute("id")){case"minimize":this.viewer.commands.exec("minimizePortal",this.targetObjID);break;case"restore":this.viewer.commands.exec("restorePortal",this.targetObjID);break;case"maximize":this.viewer.commands.exec("maximizePortal",this.targetObjID);break;case"delete":showMessage({contents:microstrategy.descriptors.getDescriptor("637"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').deleteWindow();",type:mstrMsgBoxImpl.MSG_WARNING});break;case"collapse":this.viewer.commands.exec("collapsePortal",this.targetObjID);break;case"expand":this.viewer.commands.exec("expandPortal",this.targetObjID);break;}var btnType=btn.id.substr(0,btn.id.indexOf("_"));if(btnType=="localDataMenu"){if((e.which==3)||(e.button==2)){btn.setAttribute("cx","");return false;}var gridID=btn.id.replace("localDataMenu_","");var isCtl=gridID.indexOf("Ctl_");if(isCtl>-1){gridID=gridID.substring(0,isCtl+3);}var bone=microstrategy.bones[gridID];if(bone){bone["show"+(bone.isGridBone||bone.isGraph?"Grid":"Control")+"Options"](e);}}}catch(err){microstrategy.errors.log(err);}};mstrPortalImpl.prototype.deleteWindow=function(){microstrategy.eventManager.notifyOrphanBones("portalWindowResize","delete",this.targetObjID);this.viewer.commands.exec("deleteFromPortal",this.targetObjID);};mstrPortalImpl.prototype.portalWindowResize=function(btn,targetObjID){try{if(this.targetObjID==targetObjID){switch(btn){case"minimize":this.hideButton(this.btnMin);this.showButton(this.btnRestore);this.showButton(this.btnMax);togglePulldowns(this.elem.parentNode,true);break;case"restore":this.hideButton(this.btnRestore);this.showButton(this.btnMin);this.showButton(this.btnMax);this.elem.nextSibling.style.display="";togglePulldowns(this.elem.parentNode,true);break;case"maximize":this.hideButton(this.btnMax);this.showButton(this.btnMin);this.showButton(this.btnRestore);this.elem.nextSibling.style.display="";togglePulldowns(this.elem.parentNode,false);break;}}}catch(err){microstrategy.errors.log(err);}};mstrPortalImpl.prototype.showButton=function(btn){try{if(btn){btn.style.display="";}}catch(err){microstrategy.errors.log(err);}return false;};mstrPortalImpl.prototype.hideButton=function(btn){try{if(btn){btn.style.display="none";}}catch(err){microstrategy.errors.log(err);}return false;};mstrPortalImpl.prototype.ongriddatasourcechange=function(){try{var targetObj=microstrategy.findAncestor(this.elem),gridObj=microstrategy.findChildWithAtt(targetObj,"div",microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_GRID_TABLE),gridBone=microstrategy.findBone(gridObj);if(gridBone&&microstrategy.isEnabledForItem(targetObj,"windowTitle")){var portalTitle=this.viewer.doc.styleObj.getAttValue(targetObj,microstrategy.HTMLATTR_WINDOW_TITLE);if(portalTitle==null||portalTitle.length==0){var docDataSets=this.viewer.documentDataSets,dataSetId=gridBone.gridStructureInfo?gridBone.gridStructureInfo.dataSetId:gridBone.dSetId,dataSetName=docDataSets[dataSetId],titleBar=microstrategy.findChildWithAtt(targetObj,"div","id","titleBar");titleBar.innerText=dataSetName;}}}catch(err){microstrategy.errors.log(err);}return false;};function mstrPortalImpl(id){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;return this;}