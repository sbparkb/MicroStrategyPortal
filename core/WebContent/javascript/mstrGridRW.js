mstrGridRWScript=true;var mstrGrid=mstrGridRW;var $ARR=mstrmojo.array;mstrGridRW.prototype=new mstrGridReport();mstrGridRW.prototype.quickSwitchCurrent=false;mstrGridRW.prototype.toolbarTimer=null;mstrGridRW.prototype.sliceID=null;mstrGridRW.prototype.gridUnitFormat=microstrategy.GRID_UNIT_CONTAINER;mstrGridRW.prototype.gridValueFormat=1;mstrGridRW.INC_FETCH_BAR_HEIGHT=26;mstrGridRW.prototype.hasFeature=function(s){return this.isFeatureAvailable(microstrategy["FEATURE_"+s]);};mstrGridRW.prototype.isModifyGridInDoc=function(){return this.hasFeature("MODIFY_GRID_LEVEL_IN_DOCUMENTS");};mstrGridRW.prototype.onload=function(){try{if(mstrGridReport.isDesignMode()){this.showEmptyAxis=true;}this.initObjId();var vb=microstrategy.getViewerBone();var obj=vb&&vb.commands&&vb.commands.queryState("getCachedObjectFormatLevels");var id=this.objId;if(obj&&obj.id==id){this.gridUnitFormat=obj.unit;this.gridValueFormat=obj.value;}this.viewerId="rwb_viewer";var viewer=microstrategy.bone(this.viewerId);if(viewer){this.fp=this.fp||viewer.gridFP;this.bp=this.bp||viewer.gridBP;if(!this.itemFormats){var f=viewer.gridItemFormats;f=f||(viewer.gridItemFormats={});if(!f[id]){f[id]={};f[id][mstrPanelStack.FMT_TYPE_TITLE]=viewer.objProps.createFormatObject(microstrategy.SUBOBJTYPE_DOC_TEMPLATE,mstrGridReport.FMT_TYPE_TITLE);}this.itemFormats=f[id];}if(!this.hasFeatures()){for(var id in viewer.gridFeatures){this.features[id]=viewer.gridFeatures[id];}}}mstrGridReport.prototype.onload.call(this);this.initHiliteForSelectors();if(mstrGridReport.allowEdit()){obj=findTarget(this.elem,microstrategy.HTMLATTR_OBJTYPE);if(mstrGridReport.styAttrValue(obj,"SHOW_WINDOW_TITLE")!=microstrategy.TRUE&&!(this.visualizationMode==50&&!this.docViewer.isEditableViewModeEplus())){this.elem.onmouseover=this.addBoneHandler(this.id,"onmouseover");this.elem.onmouseout=this.addBoneHandler(this.id,"onmouseout");}}if(this.curWgtId){this.buildWidgetPreview(this.curWgtId);}var dcm=mstr.$obj("dcmmID");if(dcm&&id){dcm.clearMenuItems(id);}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.onunload=function(){if(this.gridSpan&&this.gridSpan.lastChild&&!this.gridSpan.lastChild.innerHTML){this.gridSpan.style.display="none";this.gridSpan.setAttribute("disp","none");this.callSectionResize();}var s=this.getDocSelections();var g=document.getElementById(this.objId);if(s&&g&&s.isSelected(g)){s.remove(g);}if(!this.isBoneInPage()){this.hideToolbar(true);}mstrGridReport.prototype.onunload.apply(this,arguments);};mstrGridRW.prototype.isDndMapping=function(){try{if(this.isVisualization&&!this.docViewer.isInteractiveViewModeEplus()){return false;}return mstrGridReport.prototype.isDndMapping.call(this);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridRW.prototype.onreload=function(e){try{mstrGridReport.prototype.onreload.call(this,e);var that=this;window.setTimeout(function(){mstrStaticDocViewer.onUnitReload(that);},0);if(this.objId&&microstrategy.gridFormatCache&&microstrategy.gridFormatCache[this.objId]){delete microstrategy.gridFormatCache[this.objId];}this.getDocViewer().setNeedWidthAdjustment(true);if(this.elem){this.relinkToolbar();}else{var fn=function(s){that.activeRWUnit["onmouse"+s]=null;};fn("over");fn("out");}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.ondialogresize=function(e){};mstrGridRW.prototype.onnotifydrag=function(items,bone,types){try{if(bone.type==microstrategy.OBJTYPE_PAGE_BY){return ;}if((mstrGridReport.isViewMode())&&!this.isFeatureAvailable(microstrategy.FEATURE_DOCUMENTS_DESIGN_MODE)&&!this.hasFeature("MODIFY_GRID_LEVEL_IN_DOCUMENTS")){return ;}mstrGridReport.prototype.onnotifydrag.apply(this,arguments);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.onresize=function(){try{mstrGridReport.prototype.onresize.apply(this,arguments);var c=document.getElementById(this.objId);var s=this.getDocSelections();if(s&&c&&s.isSelected(c)){s.syncUp(c);}if(mstr.utils.ISIE7){var so=this.getDocViewer().doc.styleObj;var gridSpan=this.getGridContainerSpan();if((so&&so.getAttValue(gridSpan,"wm")==2)&&gridSpan){var gridContainer=this.gridTable.parentNode;if(this.gridTable&&gridContainer){gridSpan.style.width=gridContainer.scrollWidth+(gridContainer.offsetHeight-gridContainer.clientHeight)+"px";}}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.initMapper=function(){try{mstrGridReport.prototype.initMapper.call(this);if(this.maskFor){this.maskFor+=microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_RPT_DEFINITION;}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.getExecTarget=function(){try{this.getParentSubsection();return(this.parentSubsection!=null)?microstrategy.findAncestorBone(this,"mstrDocViewerImpl").doc.selections:null;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridRW.prototype.processRightMouseClick=function(e,cellSrc){mstrGridReport.prototype.processRightMouseClick.call(this,e,cellSrc);var rwm=microstrategy.getContextMenuManager("RWM");if(rwm){var cm=rwm.getMenu("rw_context_menu");if(cm&&this.getDocSelections()){cm.registerTrigger(this.elem,this.getDocSelections().path+".getTypes()");}}};mstrGridRW.prototype.ondrop=function(area,selections){try{var items=selections.getItems();if(this.dragSource.type==microstrategy.OBJTYPE_OBJBROWSER){if((microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE)&&!this.isModifyGridInDoc()){return ;}}if(this.isSingleDataSetSelected(selections)){this.populateTemplateWithDataSet(items[0],selections.shiftKey);return ;}mstrGridReport.prototype.ondrop.apply(this,arguments);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.initGrid=function(){try{var rwdObj=microstrategy.findAncestor(this.elem.parentNode);if(rwdObj!=null){this.gridPosition=parseInt(mstrGridReport.styAttrValue(rwdObj,"GRID_POS"));this.gridArea=parseInt(mstrGridReport.styAttrValue(rwdObj,"GRID_AREA_PCT"))/100;}mstrGridReport.prototype.initGrid.call(this);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.callSectionResize=function(){var pn=this.activeRWUnit.parentNode;if(pn&&pn.getAttribute&&pn.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_PANEL&&microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){var ssID=pn.id;var subsInSec=this.docViewer.doc.subSectionsInSection;var sID;for(sID in subsInSec){if(RegExp(",?"+ssID+"(,|$)").test(subsInSec[sID])){break;}}var ss=this.docViewer.doc.sections[sID].subsections[ssID];ss.needToUpdateMaxContentHeight=true;ss.forceGrowOnResize=true;ss.adjustSubsectionHeight();ss.forceGrowOnResize=false;}};mstrGridRW.getChildAtt=function(c,d,s,t){var v=t.charAt(0)=="_"?microstrategy["SUBOBJTYPE"+t]:t;return microstrategy.findChildWithAtt(c,d,microstrategy["HTMLATTR_"+s],v);};mstrGridRW.prototype.onpostload=function(){try{var gridSpan=this.getGridContainerSpan();if(gridSpan){this.titleBarObj=this.titleBarObj||mstrGridRW.getChildAtt(gridSpan,"DIV","SUBOBJTYPE","_CONTAINER_TITLEBAR");}var so=this.getDocViewer().doc.styleObj;if(so&&gridSpan){this.isTitleVisible=so.getAttValue(gridSpan,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE)==microstrategy.TRUE;if(this.gridSpan.getAttribute("disp")=="none"){this.gridSpan.style.display="block";this.callSectionResize();this.gridSpan.removeAttribute("disp");}this.isLocked=so.getAttValue(gridSpan,microstrategy.HTMLATTR_LOCKED)==microstrategy.TRUE;if(this.gridWidthInfo&&this.gridWidthInfo.colScenario==mstrGridReport.COL_WIDTH_FIT_TO_DISPLAY&&this.gridTable){this.gridTable.style.tableLayout="auto";var me=this;window.setTimeout(function(){me.resizeLockSet(true);},1);if(mstr.utils.ISIE7&&this.gridTable.parentNode.clientWidth>0){this.gridTable.style.width=(this.gridTable.parentNode.clientWidth)+"px";}}if(mstr.utils.ISIE7&&this.gridTable&&this.gridTable.parentNode){var gridContainer=this.gridTable.parentNode;if(so.getAttValue(gridSpan,"hm")==2){var h=(gridContainer.offsetHeight-gridContainer.clientHeight);if(gridContainer.clientHeight>0&&h==16){gridContainer.style.height=gridContainer.offsetHeight+h+"px";}}if((so.getAttValue(gridSpan,"wm")==2)){gridSpan.style.width=gridContainer.scrollWidth+(gridContainer.offsetHeight-gridContainer.clientHeight)+"px";}}if(mstr.utils.ISIE7&&this.lockSet){this.elem.parentNode.style.position="relative";}}if(this.getDocViewer().adjustWidth){this.getDocViewer().adjustWidth();}mstrGridReport.prototype.onpostload.call(this);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.onGridSelectionHandleMousedown=function(e){return true;};mstrGridRW.prototype.populateTemplateWithDataSet=function(dataSetItem,withShiftKey){try{var populateOption=withShiftKey?"2":"1";var dataSetId=dataSetItem.getAttribute(microstrategy.HTMLATTR_DSS_ID);this.addAction(dataSetItem,mstrUpdateManager.POPULATE_TEMPLATE_FROM_DATASET,this.beanPath,["2048032","2048033","2048012","2048135"],[dataSetId,"3",this.objId,populateOption]);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.getGraidentProperties=function(obj,format,style){try{var u_sp=mstrUpdateManager.UNIT_SEPARATOR;return obj.getAttribute("id")+u_sp+format.getPropertySetName(style)+u_sp+format.getPropertyName(style)+u_sp;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridRW.prototype.applyGradientOnItem=function(formatType,prop,value,ac,format){try{var gridSpan=this.getGridContainerSpan();var titleBar=mstrGridRW.getChildAtt(gridSpan,"DIV","SUBOBJTYPE","_CONTAINER_TITLEBAR");if(titleBar&&formatType==mstrGridReport.FMT_TYPE_TITLE){var oldData;var oldValue;if(titleBar.getAttribute("gradientcolor")==null){oldData=this.getGraidentProperties(titleBar,format,"backgroundColor");oldValue=this.getFormatValue(formatType,"backgroundColor");}else{oldData=titleBar.getAttribute("id")+mstrUpdateManager.UNIT_SEPARATOR+"Gradient"+mstrUpdateManager.UNIT_SEPARATOR;oldValue=titleBar.getAttribute("gradientcolor");}var gs=value.split(",");var ogs=oldValue.split(",");var gv=function(s,vs){return vs[gradientUtil["GRADIENT_"+s+"_INDEX"]];};if(titleBar.getAttribute("gradientcolor")){ogs=["#"+gv("START_COLOR",ogs),"#"+gv("END_COLOR",ogs),oldValue,gv("ANGLE",ogs),gv("XOFFSET",ogs),gv("YOFFSET",ogs)];}if(ac){ac.push(this.um.createEditPropsAction(gridSpan,gridSpan.getAttribute("id"),this.docViewer.beanPath,["backgroundColor","gradientColor","backgroundStyle","gradientAngle","gradientXOffset","gradientYOffset"],["#"+gv("START_COLOR",gs),"#"+gv("END_COLOR",gs),value,gv("ANGLE",gs),gv("XOFFSET",gs),gv("YOFFSET",gs)],ogs));}titleBar.setAttribute("bgstyle","2");titleBar.setAttribute("gradientcolor",value);gradientUtil.applyGradient(titleBar,gv("START_COLOR",gs),gv("END_COLOR",gs),gv("ANGLE",gs),gv("XOFFSET",gs),gv("YOFFSET",gs),this.docViewer.doc.styleObj);}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.buildWidgetPreview=function(id){try{if(!mstrGridReport.isDesignMode()){return ;}var img=this.widgetPreview;if(!id){if(img){img.className="";img.id="";img.setAttribute("title","");}}else{var title=microstrategy.getViewerBone().gridWidgets.lst[id].t;if(!img){img=document.createElement("img");img.src="../images/1ptrans.gif";this.widgetPreview=this.elem.parentNode.appendChild(img);}img.className="widgetPreview wdgtImg";img.id="mnuInsertWg"+id;img.setAttribute("title",title);}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.relinkToolbar=function(e){try{var ds=this.getDocSelections();if(this.sibBoneSelected()&&ds.isOnlyOneGridSelected()&&(ds.getActiveSectionIndex(ds.getSelectedGrid())==ds.getActiveSectionIndex(this.elem))){var toolbar=document.getElementById("toolbar_"+this.id);if(toolbar){this.boneSelected=true;this.toolbarShown=toolbar.getAttribute("shown")==1;this.toolbar=toolbar;}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.updatePortalTitle=function(title){try{if(this.titleBarObj){var titleText=mstrGridRW.getChildAtt(this.titleBarObj,"DIV","ID","titleBar");title=title||this.docViewer.doc.commands.queryState("PortalTitle");titleText.innerHTML=(title&&title.length>0)?title:this.dSetName;var gS=(this.titleBarObj.getAttribute("gradientcolor"))?this.titleBarObj.getAttribute("gradientcolor").split(","):null;if(gS){gradientUtil.applyGradient(this.titleBarObj,gS[gradientUtil.GRADIENT_START_COLOR_INDEX],gS[gradientUtil.GRADIENT_END_COLOR_INDEX],gS[gradientUtil.GRADIENT_ANGLE_INDEX],gS[gradientUtil.GRADIENT_XOFFSET_INDEX],gS[gradientUtil.GRADIENT_YOFFSET_INDEX]);}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.toggleTitleBars=function(){try{var gridContainer=this.getGridContainerSpan();if(gridContainer){this.titleBarObj=this.titleBarObj||mstrGridRW.getChildAtt(gridContainer,"DIV","SUBOBJTYPE","_CONTAINER_TITLEBAR");}var o=this.titleBarObj;if(o){this.isTitleVisible?displayObj(o):removeObj(o);}else{if(this.isTitleVisible){o=this.titleBarObj=this.docViewer.doc.createTitleBar(null,"portal_"+this.id,{boneId:this.id,objKey:this.objId,treeType:this.treeType,displayMode:this.displayMode});o.style.height="auto";gridContainer.insertBefore(o,gridContainer.firstChild);insertDynamicScript("mstrPortalImpl",javaScriptPath+"mstrPortalImpl.js");var bone=microstrategy.registerBone(o.id,"mstrPortalImpl",null);bone.onload();this.updatePortalTitle();}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.showTitleBar=function(){return this.isTitleVisible||false;};mstrGridRW.prototype.isMode=function(s){return(this.currentView==microstrategy["DISPLAY_MODE_"+(s?s:"GRID_AND_GRAPH")]);};mstrGridRW.prototype.getView=function(){return(mstrGridReport.isDesignMode()||!this.isMode("GRAPH"))&&!(this.visualizationMode==50&&!this.docViewer.isEditableViewModeEplus());};mstrGridRW.prototype.onboneselected=function(selectedBoneIds){try{if(!selectedBoneIds||selectedBoneIds.indexOf("|"+this.RWUnitId+"|")>-1){if(this.checkToolbarCondition()&&this.showTBSelected){var ds=this.getDocSelections();if(this.sibBoneSelected()){if(ds.getActiveSectionIndex(ds.getSelectedGrid())==ds.getActiveSectionIndex(this.elem)){this.boneSelected=true;if(this.getView()){this.showToolbarWithDelay(this.TIME_DELAY_SHOW_TOOLBAR);}}}}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.sibBoneSelected=function(){try{var s=this.getDocSelections();return(s&&(typeof (s.items[this.RWUnitId])!="undefined"));}catch(err){microstrategy.errors.log(err);return false;}};mstrGridRW.prototype.handleSiblingsQuickSwitch=function(){try{var sibSpans=document.getElementsByName(this.RWUnitId);var sibBone=null;for(var i=0,cnt=sibSpans.length;i<cnt;i++){sibBone=microstrategy.findRWObjectBone(sibSpans[i],this.isGridBone?"mstrGridRW":"mstrReportGraphImpl");if(sibBone&&sibBone.id!=this.id){sibBone.handleQuickSwitch();}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.handleQuickSwitch=function(submitEvent){try{this.quickSwitchCurrent=false;var containers=document.getElementsByName(this.RWUnitId+"_"+this.sliceID+"_container");var view=null;var fn=function(o,s){return microstrategy.findRegisteredChildBone(o,"div",s);};for(var i=0,cnt=containers.length;i<cnt;i++){view=containers[i].getAttribute("view");if(view==this.currentView){var thisBone=fn(containers[i],(view==microstrategy.DISPLAY_MODE_GRID)?"mstrGridRW":"mstrReportGraphImpl");removeObj(containers[i]);thisBone.hideToolbar(true);}}this.currentView=microstrategy["DISPLAY_MODE_"+(this.isMode("GRID")?"GRAPH":"GRID")];thisBone.currentView=this.currentView;if(this.currentView==microstrategy.DISPLAY_MODE_GRID){thisBone.toggleZonesEditor(null,false);}for(i=0,cnt=containers.length;i<cnt;i++){view=containers[i].getAttribute("view");if(view==this.currentView){var nextBone=fn(containers[i],(view==microstrategy.DISPLAY_MODE_GRID)?"mstrGridRW":"mstrReportGraphImpl");var nextViewMode=microstrategy["DISPLAY_MODE_"+(this.isGrid?"GRAPH":"GRID")];nextBone.currentView=this.currentView;nextBone.quickSwitchCurrent=true;nextBone.updateViewMode(nextViewMode);displayObj(containers[i]);var _tmp=nextBone.mask&&nextBone.mask.onmaskedobjectresize();if(thisBone&&thisBone.boneSelected){nextBone.boneSelected=true;}nextBone.attachToolbarEvents();if(submitEvent){nextBone.showToolbar();}if(mstrGridReport.allowEdit()){if(!nextBone.selections){nextBone.initSelections&&nextBone.initSelections(false);}}if(nextViewMode==microstrategy.DISPLAY_MODE_GRID){window.setTimeout("microstrategy.bone('"+nextBone.id+"'). resizeLockSet();",0);window.setTimeout("microstrategy.bone('"+nextBone.id+"'). resizeLockSet();",0);}}}if(submitEvent){var ac=[];nextBone.handleViewMode(nextViewMode,ac,true);nextBone.um.add(ac);}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.attachToolbarEvents=function(){try{if(this.getView()){this.activeRWUnit.onmouseover=this.addBoneHandler(this.id,"onmouseover");this.activeRWUnit.onmouseout=this.addBoneHandler(this.id,"onmouseout");}var o=this.titleBarObj;if(o&&o.id&&microstrategy.bone(o.id)){microstrategy.bone(o.id).attachEvents();}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.showGridOptions=function(e){try{target=getEventTarget(e);var cm=microstrategy.getContextMenuManager("RWM").getMenu("gridLocalDataMenu");if(!target.getAttribute("cx")){cm.registerTrigger(target,null);}displayContextMenu(target,e,true);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.onQuickSwitchClick=function(e){try{if(this.hasResized){var nextViewMode=(this.isGrid)?microstrategy.DISPLAY_MODE_GRAPH:microstrategy.DISPLAY_MODE_GRID;var nextViewCmd=(this.isGrid)?"graphMode":"gridMode";this.commands.exec(nextViewCmd,nextViewMode);}else{this.handleQuickSwitch(true);this.handleSiblingsQuickSwitch();this.notifySelectionChange("onselectionchange");}this.resetToolbar();}catch(err){microstrategy.errors.log(err);}finally{stopEventBubbling(e||window.event);}};mstrGridRW.prototype.onLinkDataset=function(){try{microstrategy.openFolderBasedBlockEditor("linkDatasetEditor","AddDatasetBlockLoader",null,{targetKey:this.objId,objectType:"2048,768,769,774"},{multiSelect:false},this);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.synchronizeSize=function(){try{var so=this.getDocViewer().doc.styleObj;var format=microstrategy.getFormatObject();var that=this;var fn=function(s){var c=format.decodeValue(s,so.getAttValue(that.activeRWUnit,microstrategy["HTMLATTR_"+s.toUpperCase()]));return parseFloat(c)-that.getBorderAdjust(s);};this.resizeGridAndGraph(fn("height"),fn("width"));}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.getBorderAdjust=function(direction){try{var format=mstrFormatObject;var borderAdjust=0;var styleObj=this.getDocViewer().doc.styleObj;if(styleObj.getAttValue(this.activeRWUnit,microstrategy.HTMLATTR_BORDER_3D_STYLE)=="1"){borderAdjust=2*microstrategy.number.convertUnit(mstrNumber.UNIT_PT,mstrNumber.UNIT_PX,styleObj.getAttValue(this.activeRWUnit,microstrategy.HTMLATTR_BORDER_3D_WEIGHT));}else{var value=null;var settings=(direction=="width")?["bt","bb"]:["bl","br"];for(var x=0,cnt=settings.length;x<cnt;x++){value=format.decodeValue("borderTopStyle",styleObj.getAttValue(this.activeRWUnit,settings[x]+"s"));if(value&&value!=""){var temp=value.indexOf(" ");borderAdjust+=parseInt(value.slice(0,temp));}}borderAdjust=microstrategy.number.convertUnit(mstrNumber.UNIT_PT,mstrNumber.UNIT_PX,borderAdjust);}return borderAdjust;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridRW.prototype.resizeGridAndGraph=function(h,w){try{var titleBarHeight=this.getTitleHeight();var grid={el:null,height:Math.max(h-titleBarHeight,0),width:w};var graph=mstr.utils.Hash.clone(grid);if(this.isGrid&&this.isGraph){grid.el=microstrategy.subObjectFind(this.activeRWUnit,["DIV"],microstrategy.SUBOBJTYPE_DOC_GRID_TEMPLATE)||this.elem;graph.el=microstrategy.objectFind(this.activeRWUnit,["IMG","INPUT"],microstrategy.OBJTYPE_GRAPH);var dso=this.getDocViewer().doc.styleObj;var gap=dso.getAttValue(this.activeRWUnit,microstrategy.HTMLATTR_GRID_AREA_PCT)||50;var gpos=dso.getAttValue(this.activeRWUnit,microstrategy.HTMLATTR_GRID_POS)||0;if(gpos==0||gpos==1){var gh=Math.max((h*(gap/100))-titleBarHeight,0);grid.height=gh;graph.height=h-gh;}else{var gw=w*gap/100;grid.width=gw;graph.width=w-grid.width;}}else{if(this.isGraph){graph.el=microstrategy.objectFind(this.activeRWUnit,["IMG","INPUT"],microstrategy.OBJTYPE_GRAPH);}else{grid.el=microstrategy.subObjectFind(this.activeRWUnit,["DIV"],microstrategy.SUBOBJTYPE_DOC_GRID_TEMPLATE)||this.elem;}}if(grid.el){this.setGridDimension(grid.el,grid.height,grid.width);}if(graph.el){this.setGraphDimension(graph.el,graph.height,graph.width);this.setGridDimension(graph.el.parentNode,graph.height,graph.width);}var flashDiv=microstrategy.findChildWithAtt(this.elem,"DIV","scriptclass","mstrFlashViewerImpl");if(flashDiv){var embedObjs=(mstr.utils.ISIE4)?flashDiv.getElementsByTagName("object"):flashDiv.getElementsByTagName("embed");if(embedObjs){embedObjs[0].width=grid.width;embedObjs[0].height=grid.height;}}this.onresize();if(this.isGridPostLoaded&&this.quickSwitch){this.hasResized=true;}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.setGridDimension=function(grid,h,w){try{if(grid){var s=grid.style;if(h!=null){s.height=s.height&&(Math.max(mstrGridRW.INC_FETCH_BAR_HEIGHT,(h||0)-(this.incfetchvisible?mstrGridRW.INC_FETCH_BAR_HEIGHT:0))+"px");}if(w!=null){s.width=s.width&&(Math.max((w||0),0)+"px");}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.setGraphDimension=function(graph,h,w){try{if(graph){graph.height=h;graph.width=w;if(this.docViewer.isEditableViewModeEplus()&&mstr.utils.ISFF){var src=graph.src;graph.src=src.replace(/graphHeight=0/,"graphHeight="+h);}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.checkToolbarCondition=function(){try{if(this.docViewer==null){this.getDocViewer();}if(this.docViewer){return this.docViewer.isInteractiveViewModeEplus()||(mstrGridReport.isDesignMode());}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridRW.prototype.showToolbar=function(stick){try{var containers=document.getElementsByName(this.RWUnitId+"_"+this.sliceID+"_container");var view=null;var fn=function(o,s){return microstrategy.findRegisteredChildBone(o,"div",s);};var thisBone=this;for(var i=0,cnt=containers.length;i<cnt;i++){view=containers[i].getAttribute("view");if(view==this.currentView){thisBone=fn(containers[i],(view==microstrategy.DISPLAY_MODE_GRID)?"mstrGridRW":"mstrReportGraphImpl");}}if(!this.toolbar){this.toolbar=document.getElementById("toolbar_"+this.id);}mstrRWUnitBoneImpl.prototype.showToolbar.call(thisBone,stick);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.createToolbar=function(){try{mstrRWUnitBoneImpl.prototype.createToolbar.call(this);var that=this;var fn=function(att,cn,h,t){var s=null;s=document.createElement("div");s.setAttribute("id",that.id+att);s.className=cn;if(t){s.setAttribute("title",mstrGridReport.desp(t));}s.onclick=that.addBoneHandler(that.id,h);that.toolbar.appendChild(s);};if(this.docViewer.isEditableViewModeEplus()&&this.hasFeature("MANAGE_DATASETS")){fn("_DS","addDataset","onLinkDataset","3033");}if(this.isGrid&&this.isGraph&&this.isGridBone){var gridId=this.elem.id;var graphId=gridId+"_graph";var graphBone=microstrategy.bone(graphId);if(graphBone){graphBone.createToolbar();this.toolbar=graphBone.toolbar;}return ;}if(mstrGridReport.isDesignMode()||this.isMode()){return ;}if(this.docViewer.isInteractiveViewModeEplus()&&this.quickSwitch){fn("_gridTb",this.isGridBone?"toGraph":"toGrid","onQuickSwitchClick",this.isGridBone?"3548":"3547");}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.computeToolbarPos=function(){try{mstrRWUnitBoneImpl.prototype.computeToolbarPos.call(this);if(this.toolbar_pos_x+2<0||this.toolbar_pos_y<0){this.toolbar_pos_x=getObjSumLeft(this.activeRWUnit)-getObjSumLeft(this.docViewer.doc.elem);this.toolbar_pos_y=getObjSumTop(this.activeRWUnit)-this.docViewer.doc.top;}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.getDocSelections=function(){try{var vb=microstrategy.getViewerBone();return vb&&vb.doc&&vb.doc.selections;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridRW.prototype.switchToContainerSelectionMode=function(){try{var ds=this.getDocSelections();var _tmp=ds&&ds.remove(findTarget(this.elem,microstrategy.HTMLATTR_OBJTYPE));}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.switchToCellSelectionMode=function(){try{var ds=this.getDocSelections();if(ds){ds.clear(true);ds.add(findTarget(this.elem,microstrategy.HTMLATTR_OBJTYPE),true,false);}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.getDocBone=function(){try{var vb=microstrategy.getViewerBone();return vb&&vb.doc;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridRW.prototype.ignoreGridMouseEvent=function(e){try{e=e||window.event;if(this.getDocBone()&&this.getDocBone().isInsertMode){e.cancelBubble=false;return true;}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridRW.prototype.processMousedown=function(e,cellSrc){try{if(this.ignoreGridMouseEvent(e)){return false;}var ds=this.getDocSelections();if(ds){var obj=findTarget(this.elem,microstrategy.HTMLATTR_OBJTYPE);if(e.ctrlKey&&ds!=null&&!(ds.length==1&&ds.isSelected(obj))){if(this.isGridInCellSelectionMode()){this.selections.clearAll(true);}return this.onGridSelectionHandleMousedown(e);}if(!this.isGridInCellSelectionMode()){this.switchToCellSelectionMode();}}mstrGridReport.prototype.processMousedown.apply(this,arguments);}catch(err){microstrategy.errors.log(err);}return null;};mstrGridRW.prototype.postmousedown=function(e,cellSrc){try{if(cellSrc&&this.selections!=null&&cellSrc.nodeName.toLowerCase()!="td"){var srcId=cellSrc.getAttribute("id");if(srcId!=null&&srcId==this.id){var ds=this.getDocSelections();if(ds){var obj=findTarget(this.elem,microstrategy.HTMLATTR_OBJTYPE);return ds.addToSelection(e,obj);}return null;}}mstrGridReport.prototype.postmousedown.apply(this,arguments);}catch(err){microstrategy.errors.log(err);}return false;};mstrGridRW.prototype.applyAddQuickThresholds=function(){try{this.um.replaceURL("activeViewID",this.objId);mstrGridReport.prototype.applyAddQuickThresholds.call(this);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.updateSelected=function(position,level,isMetric){try{if(level==null||level=="none"){return ;}if(position!="0,-99,7"&&position!="0,-9,7"&&!this.isGridInCellSelectionMode()){this.switchToCellSelectionMode();}mstrGridReport.prototype.updateSelected.apply(this,arguments);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.createDrillActions=function(valueDrillKey,retainParent,retainThreshold,valueDrillElementList,valueDisplayMode,isWithin){try{if(isWithin=="0"){var rwBone=microstrategy.bone(this.viewerId);if(rwBone){this.drillIframeEnabled=false;return this.um.createActionObject(this.elem,mstrUpdateManager.GRID_DRILL_OUTSIDE,microstrategy.servletName,["3141","3142","3144","3143","3146","3010","3151","3152"],[valueDrillKey,retainParent,retainThreshold,valueDrillElementList,valueDisplayMode,rwBone.messageID,this.getGroupByElements(),this.sliceID],[]);}}return mstrGridReport.prototype.createDrillActions.apply(this,arguments);}catch(err){microstrategy.errors.log(err);}return null;};mstrGridRW.prototype.getGroupByElements=function(){try{var pbes="";var s=findTarget(this.elem,microstrategy.HTMLATTR_SCRIPTCLASS,"mstrDocSectionImpl");if(s!=null&&s.getAttribute("pbes")!=null){pbes=s.getAttribute("pbes");}return pbes;}catch(err){microstrategy.errors.log(err);return"";}};mstrGridRW.prototype.initHiliteForSelectors=function(){try{if(this.selectedElementsCount&&this.selectedElems&&parseInt(this.selectedElementsCount)>0){var ci=this.controlLinks;if(ci){for(var i in ci){var controlKey=ci[i].ck;var s=getElementById(this.selectedElems[controlKey]);if(s){this.hiliteCell[controlKey]=s;this.hiliteObj(s,mstrGridReport.OPACITY_SELECTED,mstrGridReport.SELECTOR_HILITE_CLASS);}}}}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.drillOutToFixedTemplate=function(nodeKey,treeType,displayMode){try{var rwBone=microstrategy.bone(this.viewerId);if(rwBone){this.drillIframeEnabled=false;var messageID=rwBone.messageID;action=this.um.createActionObject(this.elem,mstrUpdateManager.DRILL_OUT_TO_FIXED_TEMPLATE,microstrategy.servletName,["3149","3150","3146","3010","3151","3152"],[nodeKey,treeType,displayMode,messageID,this.getGroupByElements(),this.sliceID?this.sliceID:0],[]);}if(this.drillOpenInNewWindow){this.um.newWindow=true;}this.um.useIframe=this.drillIframeEnabled;if(action){this.um.add([action]);this.um.flushAndSubmitChanges();this.um.acknowledgeRequest();}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.getObjectValue=function(formatType,p,v){try{if(typeof (formatType)=="object"&&"unit" in formatType){return this.getGridFormatValue(formatType,p,v=="Format"?true:false);}else{if(formatType==="GRID"){if(this.gridUnitFormat==-1||this.gridValueFormat==-1){return null;}else{return this.getGridFormatValue({unit:this.gridUnitFormat,format:this.gridValueFormat},p,true);}}else{return mstrGridReport.prototype["get"+v+"Value"].apply(this,arguments);}}}catch(err){microstrategy.errors.log(err);}return null;};mstrGridRW.prototype.getAttValue=function(formatType,att){return this.getObjectValue(formatType,att,"Att");};mstrGridRW.prototype.getFormatValue=function(formatType,prop){return this.getObjectValue(formatType,prop,"Format");};mstrGridRW.prototype.isSingleDataSetSelected=function(selections){try{if(selections.length==1&&selections.firstItem().getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_RPT_DEFINITION){return true;}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridRW.prototype.getDNDHelperImage=function(bone,pointsTo){try{if(pointsTo==null||pointsTo.length==0){return null;}if((bone.type!=this.type||bone.id==this.id)){if(this.isSingleDataSetSelected&&this.isSingleDataSetSelected(bone.selections)&&pointsTo==this.id){return microstrategy.FOLDER_IMAGES+"1ptrans.gif";}return mstrGridReport.prototype.getDNDHelperImage.apply(this,arguments);}}catch(err){microstrategy.errors.log(err);}return null;};mstrGridRW.prototype.adjustGraphSize=function(position,factor,ac){try{if(!this.isGraph){return ac;}position=position||"1";facotr=factor||"50";var nac=false;if(!ac){ac=[];nac=true;}var container=microstrategy.findAncestor(this.elem.parentNode);if(container){var containerHeight=mstrGridReport.styAttrValue(container,"HEIGHT");var containerWidth=mstrGridReport.styAttrValue(container,"WIDTH");if(containerHeight&&containerWidth){var format=microstrategy.getFormatObject();containerHeight=parseInt(format.decodeValue("height",containerHeight));containerWidth=parseInt(format.decodeValue("width",containerWidth));if(this.isGrid){containerHeight=(position=="0"||position=="1")?parseInt(containerHeight*(100-factor)/100):containerHeight;containerWidth=(position!="0"&&position!="1")?parseInt(containerWidth*(100-factor)/100):containerWidth;}this.addAction(this.elem,mstrUpdateManager.EDIT_GRAPH_PROPS,this.beanPath,["4080","4081"],[containerHeight,containerWidth],ac);}}if(nac){this.um.add(ac);}return ac;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridRW.prototype.handleViewMode=function(viewMode,ac,quickSwitch){try{if(this.isGraph){this.adjustGraphSize(this.commands.queryState("gridPosition"),this.commands.queryState("gridFactor"),ac);}if(ac&&quickSwitch&&this.gridGraphUnitKeyContext&&this.gridGraphUnitKeyContext.length>0){this.addAction(this.elem,mstrUpdateManager.SET_GRID_GRAPH_DISPLAY_MODE,this.docViewer.beanPath,["2048137","2048025"],[this.gridGraphUnitKeyContext,viewMode],ac);}else{return mstrGridReport.prototype.handleViewMode.apply(this,arguments);}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridRW.prototype.raiseColResizeEvent=function(cmdId,cmdValue1,cmdValue2){try{microstrategy.eventManager.notifyOrphanBones("oncolresize",this,cmdId,cmdValue1,cmdValue2);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.initColResize=function(extraColTag){try{this.colResizeExtraTag=extraColTag;this.nowrapHiddenColumn();}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.onmouseover=function(e){try{if(this.ignoreGridMouseEvent(e)){return ;}if(this.commands){this.commands.exec("ensureColWidthsReady");}mstrGridReport.prototype.onmouseover.apply(this,arguments);}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.processGridFormattingProperties=function(deltas,ac){try{var origCount=ac.length;var id=this.id;var fm=this.getGridFormatMap();if(!this.getGridFormats()){window.setTimeout(function(){var ac2=[];var submit=microstrategy.bone(id).processGridFormattingProperties(deltas,ac2);if(ac2.length>0){microstrategy.updateManager.add(ac2);if(submit){microstrategy.updateManager.flushAndSubmitChanges();}}},250);return false;}var value;var argIds=["4006","4007","4108","4109","4126"];var PBS="propBorderStyle";var AS="AllStyle";var AC="AllColor";var a_s=["LeftStyle","TopStyle","RightStyle","BottomStyle"];var a_c=["LeftColor","TopColor","RightColor","BottomColor"];for(var i=0,cnt=deltas.length;i<cnt;i++){var item=deltas[i];if(item.n!="borders"){this.saveGridFormattingChange(argIds,item,ac);}else{id=mstrUpdateManager.SAVE_GRID_BORDER_PROPERTIES;for(var cat in item.v){var c=cat.split("|");if(c[0]=="default"){break;}var memo={unit:c[0],format:c[1]};var target=this.resolveGridTargetProperties(memo);var argValues=[target.axis,target.position,target.unit,target.level,this.styleName];var bv=item.v[cat];var borders=(PBS in bv)?bv[PBS]:this.getGridFormatValue(memo,PBS);var that=this;var fn=function(a,o){for(var k in a){that.packageGridFormat(ac,id,argIds.concat(fm.getArgId(a[k])),o,null,memo,a[k],value);}};switch(parseInt(borders)){case 0:this.setGridFormatValue(memo,PBS,0);value=0;var noBorderArgs=argValues.concat(value);fn(a_s,noBorderArgs);break;case 1:this.setGridFormatValue(memo,PBS,1);value=(AS in bv)?bv[AS]:this.getGridFormatValue(memo,a_s[0]);if(!(AS in bv)&&value==0){value="1";}var allStyleArgs=argValues.concat(value);fn(a_s,allStyleArgs);value=(AC in bv)?bv[AC]:this.getGridFormatValue(memo,a_c[0]);var allColorArgs=argValues.concat(fm.encode("color",value));fn(a_c,allColorArgs);break;case 2:this.setGridFormatValue(memo,PBS,2);for(var b in bv){if(b==PBS){continue;}this.packageGridFormat(ac,id,argIds.concat(fm.getArgId(b)),argValues.concat(fm.encode(b,bv[b])),null,memo,b,bv[b]);}break;}}}}return(origCount<ac.length);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridRW.prototype.notifySelectionChange=function(evt){try{var vb=microstrategy.getViewerBone();if(vb){if(evt=="ongridselectionschange"){vb.commands.exec("synchronizeGridSelections");}vb.commands.exec("proxyForGridObservers",evt);}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.getActiveUnitString=function(src){var evtStr="activeViewID="+this.objId;if(src.getAttribute(microstrategy.HTMLATTR_DSS_ID)!=null){evtStr+="&activeUnitId="+src.getAttribute(microstrategy.HTMLATTR_DSS_ID);}var unitType=src.getAttribute(microstrategy.HTMLATTR_DSS_TYPE);if(unitType){if(unitType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){unitType=microstrategy.DSSTYPE_ATTRIBUTE;}evtStr+="&activeUnitType="+unitType;}if(src.getAttribute(microstrategy.HTMLATTR_DSS_SUBTYPE)!=null){evtStr+="&activeUnitSubType="+src.getAttribute(microstrategy.HTMLATTR_DSS_SUBTYPE);}return evtStr;};mstrGridRW.prototype.processContextMenus=function(evtId,evtArgs){try{var um=microstrategy.updateManager;if(!um){return null;}var src=microstrategy.activeCXMenu;if(src){switch(evtId){case"sct":case"csc":microstrategy.bone("rwb_viewer").commands.exec(evtId);break;case"tuce":case"cgs":if(microstrategy.bone("rwb_viewer").autoWire&&evtId=="cgs"){microstrategy.bone("rwb_viewer").commands.exec("createAutowireSelector");}else{var evtStr=this.getActiveUnitString(src);toggleShowBean("rwaceb",true,evtStr);}break;case"deopenSort":var deopenForSort=true;case"deopen":var prop={activeViewKey:this.objId,attributeId:src.getAttribute(microstrategy.HTMLATTR_DSS_ID)};if(deopenForSort){prop.forSortStr="true";}this.openDialog("deed",null,null,microstrategy.servletName+"."+microstrategy.pageName,prop);um.flushAndSubmitChanges();break;case"editDerived":var mid=mstrApp.getMsgID();var refreshCB={success:function(res){um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[])]);um.flushAndSubmitChanges();}};var dss=microstrategy.bone("rwb_viewer")["datasetInfos"],curId=src.getAttribute(microstrategy.HTMLATTR_DSS_ID),curName=src.getAttribute(microstrategy.HTMLATTR_DISPLAY_NAME),datasetID=this.dSetId,tmpProps=this.editorProperties&&this.editorProperties.tmsProps,config={datasets:dss,dsid:datasetID,msgID:mid},actions=[];var submitAction=function(actions){mstrmojo.xhr.request("POST",mstrConfig.taskURL,refreshCB,{taskId:"mojoRWManipulation",rwb:um.getRWBState(),messageID:mid,suppressData:true,params:JSON.stringify({actions:actions,style:{params:{treesToRender:0},name:"RWIVEMojoStyle"}})});};var getTargetDSID=function(){var curdsId;for(var dsid in dss){var els=dss[dsid].mx.concat(dss[dsid].att);$ARR.forEach(els,function(el){if(el.did===curId){curdsId=dsid;return false;}});if(curdsId){break;}}return curdsId;};config.metricId=curId;config.action={cmd:"edit",n:curName};config.onApplyMetricCallback=function(cfg){actions.push({act:"editDM",formula:cfg.tokenStreamXML,isTokenStream:!mstrmojo.string.isEmpty(cfg.tokenStreamXML),afb:cfg.afb,sfb:cfg.sfb,alias:cfg.alias,name:cfg.alias,dsid:getTargetDSID()||datasetID,did:curId});submitAction.call(this,actions);};microstrategy.openDerivedMetricEditor(config);break;default:return mstrGridReport.prototype.processContextMenus.apply(this,arguments);}return true;}}catch(err){microstrategy.errors.log(err);}return false;};mstrGridRW.prototype.isRemoveFromGrid=function(featureId){return true;};mstrGridRW.prototype.onApplyDefaultFormat=function(){try{var docViewer=this.docViewer;var so=docViewer.doc.styleObj;var objProps=docViewer.objProps;var gridSpan=this.getGridContainerSpan();if(so&&gridSpan){gridSpan.setAttribute(microstrategy.HTMLATTR_SHOW_WINDOW_TITLE,so.getAttValue(gridSpan,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE));this.isTitleVisible=so.getAttValue(gridSpan,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE)==microstrategy.TRUE;}this.toggleTitleBars();if(this.titleBarObj){objProps.initObjectFormat(this.titleBarObj,false,microstrategy.SUBOBJTYPE_DOC_TEMPLATE,mstrGridReport.FMT_TYPE_TITLE);}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.getGridContainerSpan=function(){try{this.gridSpan=this.gridSpan||microstrategy.findAncestorWithAtt(this.elem,microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_DOC_TEMPLATE);return this.gridSpan;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridRW.prototype.handleFit=function(ac,v){try{if(this.commands&&this.commands.queryState("isLinkedTemplate")){return true;}var gwi=this.gridWidthInfo;var action1=this.um.createActionObject(this.elem,mstrUpdateManager.SET_RESIZE_COLUMNS_SCENARIO,this.beanPath,["4153"],[v],[gwi.colScenario],{objId:this.RWUnitId});var action2=this.um.createActionObject(this.elem,mstrUpdateManager.SET_RESIZE_ROW_SCENARIO,this.beanPath,["4154"],["2",""],[gwi.rowScenario,gwi.rowHeight],{objId:this.RWUnitId});if(ac){ac.push(action1,action2);}else{um=this.um;um.add([action1]);um.add([action2]);um.flushAndSubmitChanges();}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrGridRW.prototype.handleFitToContent=function(ac){this.handleFit(ac,mstrGridReport.COL_WIDTH_FIT_TO_CONTENT);};mstrGridRW.prototype.handleFitToWindow=function(ac){this.handleFit(ac,mstrGridReport.COL_WIDTH_FIT_TO_DISPLAY);};mstrGridRW.prototype.getParentSubsection=function(){try{var ps=this.parentSubsection;if(ps==null){var a=microstrategy.findAncestor(this.elem);if(a!=null){a=a.parentNode;if(a!=null){ps=this.parentSubsection=microstrategy.findBone(a);}}}}catch(err){microstrategy.errors.log(err);}return ps;};mstrGridRW.prototype.getTitleHeight=function(){try{var titleHeight=0;if(this.isTitleVisible){this.titleBarObj=this.titleBarObj||document.getElementById("portal_"+this.id);titleHeight=this.titleBarObj&&getObjHeight(this.titleBarObj)||titleHeight;}return titleHeight;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridRW.prototype.selectAxis=function(axisObj,level){try{if(level==null||level=="none"){return false;}if(!this.isGridInCellSelectionMode()){this.switchToCellSelectionMode();}return mstrGridReport.prototype.selectAxis.apply(this,arguments);}catch(err){microstrategy.errors.log(err);return false;}};mstrGridRW.prototype.getGridFormats=function(){try{if(!(this.objId in microstrategy.gridFormatCache)&&!this.gridFormatReqId){var req=new mstr.http.GetGridFormats(this.objId,mstr.$obj("mstrPageInfo").get("messageID"));this.gridFormatReqId=mstr.http.Governor.submitRequest(req,this.id,"setGridFormats");return null;}else{return microstrategy.gridFormatCache[this.objId];}}catch(err){microstrategy.errors.log(err);}return null;};mstrGridRW.prototype.setGridFormats=function(evt){try{var wr=mstr.Enum.Widget.READYSTATE;switch(evt.readyState){case wr.SUCCESS:microstrategy.gridFormatCache[this.objId]=evt.response.data;this.notifySelectionChange("ongridformatready");case wr.ERROR:case wr.TIMEOUT:this.cancelGridFormatRequest();break;}}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.cancelGridFormatRequest=function(){try{if(!this.gridFormatReqId){return ;}mstr.http.Governor.removeRequest(this.gridFormatReqId);delete this.gridFormatReqId;}catch(err){microstrategy.errors.log(err);}};mstrGridRW.prototype.resetGridUnitSelections=function(){this.gridUnitFormat=microstrategy.GRID_UNIT_CONTAINER;this.gridValueFormat=0;};mstrGridRW.prototype.genericUndoRedo=function(action){if(action.elem&&(action.elem==this.elem||(action.elem.getAttribute&&action.elem.getAttribute("id")==this.RWUnitId))){if(action.id==mstrUpdateManager.EDIT_PROPS){if(action.args[1]){var format=microstrategy.getFormatObject();var a=action.args[1].split(mstrUpdateManager.UNIT_SEPARATOR);if(a[1]=="Gradient"){return ;}var prop=format[a[1]][a[2]][mstrFormatObject.HTML_PROP_NAME];var value=a[3];value=(value.substr(value.length-1)==mstrUpdateManager.ITEM_SEPARATOR)?value.substr(0,value.length-1):value;value=format.decodeValue(prop,value);if(a[1]=="FormattingSize"&&prop=="width"){this.synchronizeSize();}else{if(a[1]=="FormattingView"&&prop=="showTitleBar"){this.isTitleVisible=value==microstrategy.TRUE;this.toggleTitleBars();}else{if(a[1]=="FormattingPosition"&&prop=="locked"){this.isLocked=value==microstrategy.TRUE;this.resetToolbar();}}}}}else{if(action.id==mstrUpdateManager.SET_GRID_GRAPH_DISPLAY_MODE){this.handleQuickSwitch(false);}}}return true;};mstrGridRW.prototype.onundoredo=function(action,ur){mstrGridReport.prototype["on"+ur].call(this,action);this.genericUndoRedo(action);return true;};mstrGridRW.prototype.onundo=function(action){this.onundoredo(action,"undo");};mstrGridRW.prototype.onredo=function(action){this.onundoredo(action,"redo");};mstrGridRW.prototype.delegateSelectAll=function delegateSelectAll(){var gridCommands=this.commands,selectedUnits=gridCommands.queryState("tbGridUnitSelector"),selectedValues=gridCommands.queryState("tbGridValueSelector"),returnVal=false;if(selectedUnits.value==mstrGridReport.ALL_UNITS&&selectedValues.value==mstrGridReport.ALL_FORMAT_VALUES){microstrategy.bone(this.viewerId).doc.selections.selectAll();returnVal=true;}return returnVal;};function mstrGridRW(id){this.inherits=mstrGridReport;this.inherits(id);delete this.inherits;this.primaryBone=true;return this;}