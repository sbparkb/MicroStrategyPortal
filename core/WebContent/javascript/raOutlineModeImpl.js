mstrRaOutlineModeImplScript=true;mstrRaOutlineModeImpl.prototype=new Object();mstrRaOutlineModeImpl.prototype.expandImage="";mstrRaOutlineModeImpl.prototype.contractImage="";mstrRaOutlineModeImpl.prototype.startRow=0;mstrRaOutlineModeImpl.prototype.endRow=0;mstrRaOutlineModeImpl.prototype.gridBone=null;function mstrRaOutlineModeImpl(startRow,endRow,gridBone){this.startRow=startRow;this.endRow=endRow;this.expandImage="../images/expand.gif";this.contractImage="../images/contract.gif";this.gridBone=gridBone;return this;}mstrRaOutlineModeImpl.prototype.showHideRows=function(srcSpan){var srcRaCell=new RaGridCell(microstrategy.findParentWithTag(srcSpan,"td"));var scannedRow=this.findScanScopeStartRow(srcRaCell);var iDisplayedRows=0;while(scannedRow){var scannedRaGridRow=new RaGridRow(scannedRow);if(this.isOutOfScanScope(srcRaCell,scannedRaGridRow)||(scannedRaGridRow.getFirstCellIdOrdinal()==srcRaCell.gridCellId.iOrdinal&&scannedRaGridRow.getFirstCellRaLvl()<=srcRaCell.iRaElementLevel)){break;}scannedRaGridRow.updateCollapseTime(!srcRaCell.bExpandable);if((!srcRaCell.bExpandable&&!scannedRaGridRow.isHidden())||(srcRaCell.bExpandable&&scannedRaGridRow.isCollapseTimeCleared())){scannedRaGridRow.updateDisplayStatus(srcRaCell.bExpandable);iDisplayedRows+=(srcRaCell.bExpandable?1:-1);}scannedRow=scannedRow.nextElementSibling;}if(iDisplayedRows!=0){var iTargetCellIdOrdinal=srcRaCell.gridCellId.iOrdinal-1;var scannedRow=srcRaCell.srcHtmlTableCell.parentNode;while(iTargetCellIdOrdinal>0){while(scannedRow){var scannedRaGridRow=new RaGridRow(scannedRow);var targetCells=scannedRaGridRow.findCellsWithTargetIdOrdinal(iTargetCellIdOrdinal);if(targetCells&&targetCells.length>0){for(var i=0;i<targetCells.length;i++){this.updateRowSpan(targetCells[i],iDisplayedRows);}break;}scannedRow=scannedRow.previousSibling;}iTargetCellIdOrdinal--;}}else{srcRaCell.hideCollapseExpandIcon();}srcRaCell.updateExpdAndImg(this.expandImage,this.contractImage,srcRaCell.bExpandable);this.resize();};mstrRaOutlineModeImpl.prototype.findScanScopeStartRow=function(srcRaCell){var scannedRow=srcRaCell.srcHtmlTableCell.parentNode.nextSibling;while(scannedRow){var iFirstCellIdOrdinal=new RaGridRow(scannedRow).getFirstCellIdOrdinal();if(iFirstCellIdOrdinal<srcRaCell.gridCellId.iOrdinal){scannedRow=null;break;}if(iFirstCellIdOrdinal==srcRaCell.gridCellId.iOrdinal){break;}scannedRow=scannedRow.nextSibling;}return scannedRow;};mstrRaOutlineModeImpl.prototype.isOutOfScanScope=function(srcRaCell,scannedRaGridRow){return scannedRaGridRow.getFirstCellIdOrdinal()<srcRaCell.gridCellId.iOrdinal;};mstrRaOutlineModeImpl.prototype.updateRowSpan=function(targetCell,iIncreaseValue){var iCurrentRowspan=parseInt(targetCell.getAttribute("rowspan")||"0");targetCell.setAttribute("rowspan",iCurrentRowspan+iIncreaseValue);};mstrRaOutlineModeImpl.prototype.resize=function(){if(this.gridBone&&this.gridBone.lockSet&&this.gridBone.lockSet.resize){this.gridBone.lockSet.resize(true);}};function RaGridCell(htmlTableCell){this.srcHtmlTableCell=htmlTableCell;var sGridCellId=htmlTableCell.getAttribute(microstrategy.HTMLATTR_GRIDCELL_ID);this.gridCellId={sGridCellId:sGridCellId,iAxis:parseInt(sGridCellId.split("A")[0]),iOrdinal:parseInt(sGridCellId.split("A")[1])};this.iRaElementLevel=parseInt(htmlTableCell.firstElementChild.getAttribute(microstrategy.HTMLATTR_RA_LEVEL));this.bExpandable=htmlTableCell.firstElementChild.firstElementChild.getAttribute(microstrategy.HTMLATTR_RA_EXPAND)=="1";}RaGridCell.prototype.updateExpdAndImg=function(sExpandImage,sContractImage,isExpand){this.srcHtmlTableCell.firstElementChild.firstElementChild.setAttribute(microstrategy.HTMLATTR_RA_EXPAND,isExpand?"0":"1");this.srcHtmlTableCell.firstElementChild.firstElementChild.setAttribute("src",isExpand?sContractImage:sExpandImage);};RaGridCell.prototype.hideCollapseExpandIcon=function(){this.srcHtmlTableCell.getElementsByTagName("span")[0].style.visibility="hidden";};function RaGridRow(htmlTableRow){this.srcHtmlTableRow=htmlTableRow;}RaGridRow.prototype.getFirstCellIdOrdinal=function(){var sGridCellId=this.srcHtmlTableRow.getElementsByTagName("td")[0].getAttribute(microstrategy.HTMLATTR_GRIDCELL_ID);return parseInt(sGridCellId.split("A")[1]);};RaGridRow.prototype.getFirstCellRaLvl=function(){return parseInt(this.srcHtmlTableRow.getElementsByTagName("span")[0].getAttribute(microstrategy.HTMLATTR_RA_LEVEL));};RaGridRow.prototype.updateCollapseTime=function(isIncrease){var currentCollapseTime=parseInt(this.srcHtmlTableRow.getAttribute(microstrategy.HTMLATTR_RA_COLLAPSE_TIME)||"0");this.srcHtmlTableRow.setAttribute(microstrategy.HTMLATTR_RA_COLLAPSE_TIME,currentCollapseTime+(isIncrease?1:-1));};RaGridRow.prototype.isHidden=function(){return(this.srcHtmlTableRow.style.display=="none");};RaGridRow.prototype.isCollapseTimeCleared=function(){var oriHideTime=parseInt(this.srcHtmlTableRow.getAttribute(microstrategy.HTMLATTR_RA_COLLAPSE_TIME)||"0");return oriHideTime<=0;};RaGridRow.prototype.updateDisplayStatus=function(isDisplay){this.srcHtmlTableRow.style.display=(isDisplay?"":"none");};RaGridRow.prototype.findCellsWithTargetIdOrdinal=function(iTargetCellIdOrdinal){return microstrategy.findChildrenWithAtt(this.srcHtmlTableRow,"td","i",1+"A"+iTargetCellIdOrdinal);};