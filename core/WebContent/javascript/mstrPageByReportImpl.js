mstrPageByReportImplScript=true;mstrPageByReportImpl.prototype=new mstrEditorImpl();mstrPageByReportImpl.prototype.updateManager=microstrategy.updateManager;mstrPageByReportImpl.prototype.activeElement=null;mstrPageByReportImpl.prototype.mapper=null;mstrPageByReportImpl.prototype.type=microstrategy.OBJTYPE_PAGE_BY;mstrPageByReportImpl.prototype.autoSubmit=false;mstrPageByReportImpl.prototype.dragSource=null;mstrPageByReportImpl.prototype.isMDXCube=false;mstrPageByReportImpl.prototype.selections=null;mstrPageByReportImpl.prototype.dndHelper=null;mstrPageByReportImpl.prototype.gridBone=null;mstrPageByReportImpl.prototype.gridInfo=null;mstrPageByReportImpl.prototype.onload=function(){try{this.initEditor();if(!(this.body)){microstrategy.unRegisterBone(this.id);return ;}var submitButton=document.getElementById("pagebyApply");this.autoSubmit=(submitButton)?false:true;this.onpagebychange();this.useClientSideManipulations=(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE);if(microstrategy.EDIT_MODE==microstrategy.ALLOW_EDIT_MODE){var span=document.createElement("span");span.className="mstrDnDReportDragItem";span.appendChild(document.createTextNode(""));this.dragDisplay=document.body.appendChild(span);this.dndHelper=new mstrDNDHelperImpl(this);}this.gridBone=microstrategy.bone("UniqueReportID");if(this.gridBone!=null){this.gridInfo=this.gridBone.gridStructureInfo;this.isMDXCube=this.gridBone.isMdxCube;if(this.gridInfo.pageAxis&&this.gridInfo.pageAxis.units.length<1){var pb=document.getElementById("pbb_PageByStyle");if(pb){var cells=pb.getElementsByTagName("span");for(var i=0,cnt=cells.length;i<cnt;i++){if(cells[i].getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_PAGE_BY_ELEM){this.gridInfo.add(this.gridInfo.buildGridUnitInfo(cells[i]));}}}}this.initQuickSearch();}}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.initQuickSearch=function(items,bone,types){try{if(!this.gridBone.quickSearchEnabled||microstrategy.findChildWithAtt(this.body,"div","ty","qs")){return ;}var pl=mstrGridReport.createQuickSearchPlaceHolder(microstrategy.GRIDCELL_AXIS_PAGE_BY);if(this.units&&this.units.length>0){this.body.insertBefore(pl,this.units[this.units.length-1].nextSibling);}else{this.body.appendChild(pl);}}catch(err){microstrategy.errors.log(err);}};mstrPageByReportImpl.prototype.unregister=function(){try{var qs=this.gridBone.quickSearch;if(qs){qs.set("visible",false);document.body.appendChild(qs.domNode);}mstrEditorImpl.prototype.unregister.call(this);}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.onnotifydrag=function(items,bone,types){try{if(this.gridInfo==null){return ;}if(bone==this||bone.type==microstrategy.OBJTYPE_OBJBROWSER||bone.type==microstrategy.OBJTYPE_GRID){if(bone==this||bone.type==microstrategy.OBJTYPE_GRID){if(!this.isFeatureAvailable(microstrategy.FEATURE_WEB_PIVOT)){return ;}}if(bone.type==microstrategy.OBJTYPE_OBJBROWSER){if(!this.isFeatureAvailable(microstrategy.FEATURE_WEB_PIVOT)){return ;}for(var id in items){if(this.getUnit(items[id])!=null){return ;}if(!microstrategy.checkACL(items[id],[microstrategy.ACL_EXECUTE,microstrategy.ACL_USE])){return ;}var objInfo=new mstrObjectInfoImpl(items[id]);if(objInfo.dssType==microstrategy.DSSTYPE_RPT_DEFINITION){return ;}if(objInfo.dssType==microstrategy.DISPUNITTYPE_ELEMENT){return ;}if(objInfo.dssType==microstrategy.DSSTYPE_FILTER&&objInfo.dssSubType!=microstrategy.DSSTYPE_CUSTOM_GROUP){return ;}if(objInfo.dssType==microstrategy.DSSTYPE_PROMPT&&objInfo.dssSubType!=microstrategy.DSSSUB_TYPE_PROMPT_OBJECTS){return ;}if(objInfo.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM&&!this.isFeatureAvailable(microstrategy.FEATURE_SET_ATTRIBUTEFORM_DISPLAY)){return ;}if(mstrGridReport.isReport()&&this.gridBone&&this.gridBone.isMdxCube&&!this.gridBone.canAddMDXUnit(items[id])){return ;}}}if(this.units.length==0||types[0]==microstrategy.DSSTYPE_TEMPLATE){types[0]=mstrMaskMappedImpl.MASK_TYPE;}this.toggleSelectBoxes(true);if(types[0]==microstrategy.DSSTYPE_PROMPT){types[0]=microstrategy.DSSTYPE_ATTRIBUTE;}this.mask.toggle(true,types[0]);this.dragSource=bone;}}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.onnotifydragend=function(){try{mstrEditorImpl.prototype.onnotifydragend.call(this);this.toggleSelectBoxes(false);}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.toggleSelectBoxes=function(isDisabled){try{var boxes=this.elem.getElementsByTagName("select");for(var i=0;i<boxes.length;i++){boxes[i].disabled=isDisabled;}}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.onmousedown=function(e){try{if(!e){e=window.event;}if(e.button==2){return false;}else{var src=getEventTarget(e);if(src&&src.tagName.toLowerCase()!="select"&&src.tagName.toLowerCase()!="option"){var page=microstrategy.findAncestor(src);if(page&&(page.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_PAGE_BY_ELEM||page.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_FAKED_PAGE_BY_ELEM)){var cmdId=src.getAttribute(microstrategy.HTMLATTR_CMD_ID);var cmdVal=src.getAttribute(microstrategy.HTMLATTR_CMD_VALUE);if(cmdId){this.exec(cmdId,cmdVal,page);}else{var canDrag=page.getAttribute(microstrategy.HTMLATTR_DND_SOURCE);if(canDrag!=null&&canDrag.toLowerCase()=="true"){this.activeElement=page;if(typeof (mstr)!="undefined"){this.attachWinListener(this,"mousemove","ondragstart");this.attachWinListener(this,"mouseup","onmouseup");}else{document.onmousemove=new Function("e","return microstrategy.bone('"+this.id+"').ondragstart(e);");document.onmouseup=new Function("e","return microstrategy.bone('"+this.id+"').onmouseup(e);");}}}return false;}}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.ondragstart=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}getMouse(e);microstrategy.eventManager.onnotifydrag(microstrategy.createAssociativeArray(this.activeElement),this,[microstrategy.DSSTYPE_ATTRIBUTE]);this.selections.clear();this.selections.add(this.activeElement);if(typeof (mstr)!="undefined"){this.attachWinListener(this,"mousemove","ondrag");this.attachWinListener(this,"mouseup","ondragend");}else{document.onmousemove=new Function("e","return microstrategy.bone('"+this.id+"').ondrag(e);");document.onmouseup=new Function("e","return microstrategy.bone('"+this.id+"').ondragend(e);");}this.ondrag(e);}catch(err){microstrategy.errors.log(err);}return false;};mstrPageByReportImpl.prototype.ondrag=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}getMouse(e);this.dragDisplay.replaceChild(document.createTextNode(this.activeElement.getAttribute("ds")),this.dragDisplay.firstChild);moveObjTo(this.dragDisplay,lMouseX-getObjWidth(this.dragDisplay)-microstrategy.CURSOR_OFFSET,lMouseY-getObjHeight(this.dragDisplay)-microstrategy.CURSOR_OFFSET);this.dndHelper.moveHelperImage(e);}catch(err){microstrategy.errors.log(err);}return false;};mstrPageByReportImpl.prototype.ondragend=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}this.dndHelper.parkObject(this.dragDisplay);var page=this.activeElement;var unit=this.gridInfo.findUnit(page.getAttribute(microstrategy.HTMLATTR_DSS_ID));this.onmouseup(e);microstrategy.eventManager.notifyOrphanBones("onnotifydragend");var mask=microstrategy.findAncestor(getEventTarget(e));if(mask){var pointsTo=mask.getAttribute(microstrategy.HTMLATTR_POINTS_TO);var bone=microstrategy.boneForMask(mask);if(bone){if(bone==this){if(pointsTo==bone.id){this.pivotUnit(unit,microstrategy.GRIDCELL_AXIS_PAGE_BY,this.units.length);}else{if(pointsTo!=page.getAttribute("id")){this.pivotUnit(unit,microstrategy.GRIDCELL_AXIS_PAGE_BY,pointsTo.slice(3));}}}else{if(bone&&bone.type!=null){var items=new Array(page);switch(bone.type){case microstrategy.OBJTYPE_OBJBROWSER:this.deleteItems(items);break;case microstrategy.OBJTYPE_GRID:bone.ondrop(mask,this.selections);break;case microstrategy.OBJTYPE_FILTER_EDITOR:bone.ondrop(mask,this.selections);break;}}}}}}catch(err){microstrategy.errors.log(err);}return false;};mstrPageByReportImpl.prototype.onmouseup=function(e){try{this.activeElement=null;this.dndHelper.onmouseup(this.id);}catch(err){microstrategy.errors.log(err);}return false;};mstrPageByReportImpl.prototype.ondrop=function(src,selections){try{var um=this.updateManager;var mask=microstrategy.findAncestor(src);if(mask){var pointsTo=mask.getAttribute(microstrategy.HTMLATTR_POINTS_TO);var depth=(pointsTo==this.id)?this.units.length+1:pointsTo.substr(3);var items=selections.getItems();var ac=new Array();if(this.dragSource.type==microstrategy.OBJTYPE_OBJBROWSER){var isMultipleItems=selections.isMulti();var isOnlyMetrics=(isMultipleItems)?selections.isOnlyMetrics():true;var metricUnitPivot=false;for(var i=items.length-1;i>=0;i--){if(items[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_TEMPLATE&&pointsTo==this.id){ac=this.gridBone.replaceTemplate(items[i],true,ac);continue;}if(isMultipleItems&&!isOnlyMetrics&&this.gridInfo.hasMetrics&&(items[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_METRIC||items[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_USER_METRIC)){if(!this.gridInfo.findUnit(items[i].getAttribute(microstrategy.HTMLATTR_DSS_ID))){ac=this.addUnit(items[i],microstrategy.GRIDCELL_AXIS_METRICS,-1,ac);}}else{if(this.gridInfo.hasMetrics&&(items[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_METRIC||items[i].getAttribute(microstrategy.HTMLATTR_DSS_TYPE)==microstrategy.DSSTYPE_USER_METRIC)){if(this.gridInfo.metricsAxis!=microstrategy.GRIDCELL_AXIS_PAGE_BY||this.gridInfo.metricsDepth!=depth){if(!metricUnitPivot){var unit=this.gridInfo.getUnit(this.gridInfo.metricsAxis,this.gridInfo.metricsDepth,1);if(unit){ac=this.pivotUnit(unit,microstrategy.GRIDCELL_AXIS_PAGE_BY,depth,ac);}metricUnitPivot=true;}if(this.gridInfo.metricAxis.findUnit(items[i].getAttribute(microstrategy.HTMLATTR_DSS_ID))==null){ac=this.addUnit(items[i],microstrategy.GRIDCELL_AXIS_METRICS,-1,ac);}}else{if(this.gridInfo.metricAxis.findUnit(items[i].getAttribute(microstrategy.HTMLATTR_DSS_ID))==null){ac=this.addUnit(items[i],microstrategy.GRIDCELL_AXIS_METRICS,-1,ac);}}}else{ac=this.addUnit(items[i],microstrategy.GRIDCELL_AXIS_PAGE_BY,depth,ac);}}}}else{if(this.dragSource.type==microstrategy.OBJTYPE_GRID){if(items.length==1){var unit=this.gridInfo.findUnit(items[0].getAttribute(microstrategy.HTMLATTR_DSS_ID));ac=this.pivotUnit(unit,microstrategy.GRIDCELL_AXIS_PAGE_BY,depth,ac);}else{var objInfoList=this.gridBone.getObjInfoList(items);ac=this.gridBone.pivotUnits(objInfoList,microstrategy.GRIDCELL_AXIS_PAGE_BY,depth,1,ac);}}}if(ac.length>0){um.add(ac);if(this.gridBone&&this.gridBone.selections){this.gridBone.selections.clearAll();}if(this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridInfo);}else{this.updateManager.flushAndSubmitChanges();}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.drill=function(valueDrillKey,valueDisplayMode,valueDrillElementList){try{if(this.gridBone!=null){this.gridBone.drill(valueDrillKey,valueDisplayMode,valueDrillElementList);}}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.onpagechange=function(e){try{if(!e){e=window.event;}if(this.autoSubmit){if(this.gridBone&&this.gridBone.selections){this.gridBone.selections.clearAll();}var src=getEventTarget(e);if(src){var form=this.elem.getElementsByTagName("form")[0];if(form){if(src.id==="elemKey"){mstr.$A.forEach(form.elements,function(elem){if(elem.id==="elemKey"&&elem!==src){elem.disabled=true;}});}submitForm(form);}}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.onpagebychange=function(){try{this.mapper=new mstrPageByMapperImpl();this.maskFor=microstrategy.DSSTYPE_ATTRIBUTE_FORM+microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_METRIC+microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_USER_METRIC+microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_ATTRIBUTE+microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_CONSOLIDATION+microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_HIERARCHY+microstrategy.HTMLATTR_MASKFOR_DELIM+microstrategy.DSSTYPE_FILTER;this.units=microstrategy.objectListFind(this.body,"SPAN",microstrategy.OBJTYPE_PAGE_BY_ELEM);this.maskArea=this.elem.getElementsByTagName("div")[0];this.body.onmousedown=new Function("e","return microstrategy.bone('"+this.id+"').onmousedown(e);");if(this.units&&this.units.length>0){var selects=this.body.getElementsByTagName("select");for(var i=0;i<selects.length;i++){selects[i].onchange=new Function("e","return microstrategy.bone('"+this.id+"').onpagechange(e);");}}else{this.units=new Array();}this.mask=new mstrMaskMappedImpl();window.setTimeout("microstrategy.bone('"+this.id+"').mask.onload(microstrategy.bone('"+this.id+"'))",0);}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.getDNDHelperImage=function(bone,pointsTo){try{return microstrategy.FOLDER_IMAGES+"DPageBy.gif";}catch(err){microstrategy.errors.log(err);}return null;};mstrPageByReportImpl.prototype.processPivotButtons=function(element,cmdVal){try{if(element){var unit=this.gridInfo.findUnit(element.getAttribute(microstrategy.HTMLATTR_DSS_ID));var toAxis=microstrategy.GRIDCELL_AXIS_PAGE_BY;var toDepth=parseInt(element.getAttribute("id").substr(3));switch(cmdVal){case"l":toDepth--;break;case"r":toDepth++;break;case"tr":toDepth=1;toAxis=microstrategy.GRIDCELL_AXIS_ROWS;break;case"tc":toDepth=1;toAxis=microstrategy.GRIDCELL_AXIS_COLUMNS;break;}this.pivotUnit(unit,toAxis,toDepth);}}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.processContextMenus=function(cmdId,cmdVal){try{this.exec(cmdId,cmdVal,microstrategy.activeCXMenu);}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.exec=function(cmdId,cmdVal,unit){try{if(!unit){unit=this.activeElement;}if(unit){switch(cmdId){case"move":this.processPivotButtons(unit,cmdVal);break;case"rmvx":microstrategy.eventManager.notifyOrphanBones("onunitsremoved",this.gridBone.getObjInfoList([unit]));case"rmv":this.deleteItems([unit],null,(cmdId=="rmvx"));break;case"rnm":this.renameUnit(unit,cmdVal);break;case"addPage":this.addUnit(unit,microstrategy.GRIDCELL_AXIS_PAGE_BY,this.units.length+1);break;}}}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.executeHyperLink=function(position,linkIndex){try{var grid=this.gridBone;var elem=microstrategy.activeCXMenu;var unit=this.gridInfo.findUnit(elem.getAttribute(microstrategy.HTMLATTR_DSS_ID));var parentElemsIndex=[{elements:[]}];grid.execHL(3,position,parentElemsIndex,linkIndex);}catch(err){microstrategy.errors.log(err);}};mstrPageByReportImpl.prototype.deleteItems=function(objs,ac,removeFromReport){try{var submit=false;if(ac==null){ac=new Array();submit=true;}if(typeof (objs)=="string"){objs=[document.getElementById(objs)];}if(objs){for(var i=0;i<objs.length;i++){ac=this.gridBone.deleteUnit(this.gridInfo.findUnit(objs[i].getAttribute(microstrategy.HTMLATTR_DSS_ID)),ac,removeFromReport);}if(submit&&ac.length>0){this.updateManager.add(ac);if(this.gridBone&&this.gridBone.selections){this.gridBone.selections.clearAll();}if(this.useClientSideManipulations&&!this.isMDXCube){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridInfo);}else{this.updateManager.flushAndSubmitChanges();}}}return ac;}catch(err){microstrategy.errors.log(err);return false;}};mstrPageByReportImpl.prototype.pivotUnit=function(objInfo,toAxis,toDepth,ac){try{var submit=false;if(ac==null){ac=new Array();submit=true;}ac=this.gridBone.pivotUnit(objInfo,toAxis,toDepth,1,ac);if(submit&&ac.length>0){this.updateManager.add(ac);if(this.gridBone&&this.gridBone.selections){this.gridBone.selections.clearAll();}if(this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridInfo);}else{this.updateManager.flushAndSubmitChanges();}}return ac;}catch(err){microstrategy.errors.log(err);return null;}};mstrPageByReportImpl.prototype.addUnit=function(src,axis,depth,ac){try{var submit=false;if(ac==null){ac=new Array();submit=true;}ac=this.gridBone.addUnit(src,axis,depth,1,ac);if(submit&&ac.length>0){this.updateManager.add(ac);if(this.gridBone&&this.gridBone.selections){this.gridBone.selections.clearAll();}if(this.useClientSideManipulations){microstrategy.eventManager.notifyOrphanBones("ongridstructurechange",this.gridInfo);}else{this.updateManager.flushAndSubmitChanges();}}return ac;}catch(err){microstrategy.errors.log(err);return null;}};mstrPageByReportImpl.prototype.renameUnit=function(src,index){try{var ac=new Array();ac.push(this.updateManager.createActionObject(this.elem,mstrUpdateManager.OPEN_FORMULA_EDITOR,this.beanPath,["6037","6036"],["true",index],[]));microstrategy.updateManager.add(ac);microstrategy.updateManager.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);return null;}};mstrPageByReportImpl.prototype.getUnit=function(obj){try{if(this.units){var id=obj.getAttribute(microstrategy.HTMLATTR_DSS_ID);for(var i=0;i<this.units.length;i++){if(id==this.units[i].getAttribute(microstrategy.HTMLATTR_DSS_ID)){return this.units[i];}}}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrPageByReportImpl.prototype.onwinresize=function(){if(this.mask){this.mask.onmaskedobjectresize();}};mstrPageByReportImpl.prototype.showAdvDrillEditor=function(valueDrillAxis,valueDrillPosition,isIFrameEnabled){if(this.gridBone&&this.gridBone.showAdvDrillEditor){this.gridBone.showAdvDrillEditor(valueDrillAxis,valueDrillPosition,isIFrameEnabled);}};function mstrPageByReportImpl(id){this.inherits=mstrEditorImpl;this.inherits(id);this.inherits=null;this.selections=new mstrSelectionsImpl();this.selections.parentBone=this;return this;}