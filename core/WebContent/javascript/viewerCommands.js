mstrViewerCommandsImpl.prototype=new Object();mstrViewerCommandsImpl.prototype.itemSep="~";mstrViewerCommandsImpl.prototype.unitSep="\u001F";mstrViewerCommandsImpl.prototype.clipboardItemSep="\u001E";mstrViewerCommandsImpl.prototype.valueField="dssid";mstrViewerCommandsImpl.prototype.nameField="n";mstrViewerCommandsImpl.prototype.typeField="t";mstrViewerCommandsImpl.prototype.exec=function(cmdId,cmdValue,allPanels){try{var um=microstrategy.updateManager;switch(cmdId){case"ping":return this.execPingServer();case"undo":return um.undo();case"redo":return um.redo();case"doFlush":um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[])]);return um.flushAndSubmitChanges();case"IVEMode":if(microstrategy.pageScreenMode!=microstrategy.PAGE_FULL_SCREEN_MODE){toggleScreenMode();}case"interactiveViewMode":case"editableMode":case"flashViewMode":var viewMaps={interactiveViewMode:microstrategy.RW_VIEW_MODE_INTERACTIVE,editableMode:microstrategy.RW_VIEW_MODE_EDITABLE,flashViewMode:microstrategy.RW_VIEW_MODE_FLASH,IVEMode:microstrategy.RW_VIEW_MODE_VIEWANALYSIS};cmdValue=viewMaps[cmdId];case"rwCurrentViewMode":um.add([um.createActionObject(null,mstrUpdateManager.SET_CURRENT_VIEW_MODE,this.parentBone.beanPath,["55004"],[cmdValue],[])],true);um.useIframe=false;um.flushAndSubmitChanges();return true;case"staticViewMode":case"publishViewMode":var newVisMode=this.parentBone.visualizationMode;var vm=this.parentBone.currentRWViewMode;if(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE){var visModes=microstrategy.RW_VIEW_MODE_STATIC|microstrategy.RW_VIEW_MODE_INTERACTIVE|microstrategy.RW_VIEW_MODE_FLASH;if(vm&visModes){newVisMode="0";}}if(this.parentBone.isLayoutLevelVis){newVisMode="0";}um.add([um.createActionObject(null,mstrUpdateManager.RUN_RW_DOCUMENT,microstrategy.servletName,["2048174","2048002","2048109"],["1",this.parentBone.messageID,newVisMode],[])],true);if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE){vm=0;}um.replaceURL("prevViewMedia",vm);um.useIframe=false;um.flushAndSubmitChanges();return true;case"designViewMode":case"convertToDoc":cmdValue=1;if(cmdId=="convertToDoc"){this.showMessageForIVE("rwChangeDesignMode",cmdValue,allPanels);return true;}case"rwChangeDesignMode":um.add([um.createActionObject(null,mstrUpdateManager.CHANGE_DESIGN_MODE,this.parentBone.beanPath,["3017"],[cmdValue],[])],true);um.useIframe=false;um.flushAndSubmitChanges();return true;case"docVisualizationModeAJAX":return this.exec("docVisualizationMode",51);case"docVisualizationModeFlash":return this.exec("docVisualizationMode",50);case"docVisualizationMode":um.useIframe=false;microstrategy.adjustSelectedVisualization(this.parentBone,cmdValue);var vm=(this.parentBone.visualizationMode==cmdValue)?"0":cmdValue;um.add([um.createActionObject(this.elem,mstrUpdateManager.SET_VISUALIZATION_MODE,this.parentBone.beanPath,["2048109","2048212"],[vm,this.parentBone.isLayoutLevelVis?"-1":""],[],[])]);um.add([um.createActionObject(this.elem,mstrUpdateManager.APPLY_CHANGES,this.parentBone.beanPath,[],[],[])]);um.flushAndSubmitChanges();this.parentBone.isVisualization=(vm>=microstrategy.FIRST_VISUALIZATION_VIEW_MODE);this.parentBone.visualizationMode=vm;return true;case"ZoomType":var format=mstrFormatObject;var data=format.getPropertySetName(cmdId)+mstrUpdateManager.UNIT_SEPARATOR+format.getPropertyName(cmdId)+mstrUpdateManager.UNIT_SEPARATOR+cmdValue+mstrUpdateManager.ITEM_SEPARATOR;um.add([um.createActionObject(null,mstrUpdateManager.SET_DOCUMENT_ZOOM,this.parentBone.beanPath,["2048018","2048065"],[mstrUpdateManager.UPDATE_NOW,data],[])]);return true;case"zoom":var objValue=cmdValue,newZoomType,rwCurrentViewMode=this.queryState("rwCurrentViewMode"),isFlashViewMode=(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&(rwCurrentViewMode==microstrategy.RW_VIEW_MODE_FLASH||rwCurrentViewMode==microstrategy.RW_VIEW_MODE_VIEWANALYSIS)),vm=this.parentBone.isVisualization;if(objValue=="Width"){if(!isFlashViewMode||vm){objValue=this.queryState("widthZoomFactor");}newZoomType=microstrategy.ZOOM_FIT_WIDTH;}else{if(objValue=="Page"){if(!isFlashViewMode||vm){objValue=Math.min(this.queryState("heightZoomFactor"),this.queryState("widthZoomFactor"));}newZoomType=microstrategy.ZOOM_FIT_PAGE;}else{newZoomType=microstrategy.ZOOM_STATIC;}}if(objValue!=microstrategy.ZOOM_FACTOR||newZoomType!=microstrategy.zoomType){microstrategy.ZOOM_FACTOR=objValue;microstrategy.zoomType=newZoomType;this.exec("ZoomType",newZoomType);var doExec=false;if(isFlashViewMode&&!vm){microstrategy.getViewerBone().callFlashPlayerFn("changeZoomType",[objValue,newZoomType]);if(newZoomType==microstrategy.ZOOM_STATIC){doExec=true;}}else{doExec=true;}if(doExec){objValue=objValue/100;var format=mstrFormatObject;var data=format.getPropertySetName(cmdId)+mstrUpdateManager.UNIT_SEPARATOR+format.getPropertyName(cmdId)+mstrUpdateManager.UNIT_SEPARATOR+format.encodeValue(cmdId,objValue)+mstrUpdateManager.ITEM_SEPARATOR;if(!isFlashViewMode||vm){um.add([um.createActionObject(null,mstrUpdateManager.RW_GRAPH_DZ_SET_ZOOMFACTOR,this.parentBone.gdzBeanPath,["121002"],[microstrategy.ZOOM_FACTOR],[])]);}um.add([um.createActionObject(null,mstrUpdateManager.SET_DOCUMENT_ZOOM,this.parentBone.beanPath,["2048018","2048065"],[mstrUpdateManager.UPDATE_NOW,data],[])]);if(vm){um.useIframe=false;}if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE||this.queryState("rwCurrentViewMode")!=microstrategy.RW_VIEW_MODE_FLASH||vm){um.flushAndSubmitChanges();}}}if(!isFlashViewMode){this.parentBone.onselectionchange();}return true;case"showBean":this.showBean(um,cmdValue);return true;case"sendNow":this.exec("showBean","ncSendNow",allPanels);return true;case"scheduleHL":this.exec("showBean","subs",allPanels);return true;case"mobileSubs":case"ncSubs":case"ncFileSubs":case"ncFtpSubs":case"ncPrintSubs":case"ncCacheSubs":this.exec("showBean",cmdId,allPanels);return true;case"save":var askBeforeSaveCheckbox=document.getElementById("askBeforeSaveCheckbox");if(askBeforeSaveCheckbox&&askBeforeSaveCheckbox.checked&&this.parentBone.isFeatureAvailable(microstrategy.FEATURE_ASK_BEFORE_SAVE_CHANGES)){this.exec("forceSaveAs");}var fromDesignMode=(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE)?"true":"false";var folderId=(this.parentBone.saveFolderId)?this.parentBone.saveFolderId:this.parentBone.parentFolderID;var args=["3013","3014","3017"];var values=["false",folderId,fromDesignMode];if(cmdValue&&cmdValue.origin){args.push("3031");values.push(cmdValue.origin);}var action=um.createActionObject(null,mstrUpdateManager.RW_SAVE_AS,microstrategy.servletName,args,values,[],null);um.useIframe=false;um.add([action],true);um.flushAndSubmitChanges();return true;case"dSave":var savefolderId=this.parentBone.saveFolderId,parentfolderId=this.parentBone.parentFolderID;if(savefolderId||this.isNew(parentfolderId)||this.parentBone.isRWReadonly){return this.exec("save",cmdId,allPanels);}else{if(this.parentBone.isFeatureAvailable(microstrategy.FEATURE_ASK_BEFORE_SAVE_CHANGES)){this.askBeforeSaveOverwrite();}else{this.submitSave();}return true;}case"dontAskAgain":var prefValue=0;this.parentBone.setFeature("ask-before-save-changes",0);var action=um.createActionObject(null,mstrUpdateManager.SET_PREFERENCE,this.parentBone.beanPath,["5003","5004"],["askBeforeSaveChanges",prefValue],[],null);um.add([action],true);um.flushAndSubmitChanges();return true;case"forceSaveAs":var prefValue=2;this.parentBone.setFeature(microstrategy.FEATURE_FORCE_SAVE_AS,0);var action=um.createActionObject(null,mstrUpdateManager.SET_PREFERENCE,this.parentBone.beanPath,["5003","5004"],["askBeforeSaveChanges",prefValue],[],null);um.add([action],true);um.flushAndSubmitChanges();return true;case"reprompt":this.refreshViewer(um,true,false,false);return true;case"refresh":this.refreshViewer(um,false,false,false);return true;case"rerun":this.refreshViewer(um,false,true,false);return true;case"regenerate":this.refreshViewer(um,false,false,true);return true;case"browseParent":var pb=this.parentBone,argIds=["1001"],args=[pb.parentFolderID];if(pb.goBackOverride){this.exec("openPage","-1");return true;}else{if(!pb.parentFolderID||pb.isParentFolderHidden){return this.exec("openHome");}}if(pb.sysFolderId){argIds.push("2023");args.push(pb.sysFolderId);}var action=um.createActionObject(null,mstrUpdateManager.BROWSE_FOLDER,microstrategy.servletName,argIds,args,[],null);um.useIframe=false;um.add([action],true);um.flushAndSubmitChanges();return true;case"openDefaultHome":case"openHome":var openHomeEvt={openHome:mstrUpdateManager.OPEN_DESKTOP,openDefaultHome:mstrUpdateManager.OPEN_DEFAULT_DESKTOP}[cmdId];var action=um.createActionObject(null,openHomeEvt,microstrategy.servletName,[],[],[],null);um.useIframe=false;um.add([action],true);um.flushAndSubmitChanges();return true;case"restoreScreenMode":var action=um.createActionObject(null,mstrUpdateManager.SWITCH_FULL_SCREEN_MODE,this.parentBone.beanPath,["5028"],[cmdValue],[],null);um.useIframe=false;um.add([action],true);um.flushAndSubmitChanges();return true;case"saveToInbox":this.parentBone.sentToInbox=true;var action=um.createActionObject(null,mstrUpdateManager.RW_SAVE_TO_INBOX,this.parentBone.beanPath,[],[],[],null);um.add([action],true);um.flushAndSubmitChanges();return true;case"docDetails":um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[])]);var action=um.createActionObject(null,mstrUpdateManager.RW_DOC_DETAILS,microstrategy.servletName,["3010","3016"],[this.parentBone.messageID,"0"],[],null);um.useIframe=false;um.add([action],true);um.flushAndSubmitChanges();return true;case"setPreference":var action=um.createActionObject(null,mstrUpdateManager.SET_PREFERENCE,this.parentBone.beanPath,["5003","5004"],[cmdValue.prefName,cmdValue.prefValue],[],null);um.useIframe=false;um.add([action],true);um.flushAndSubmitChanges();return true;case"toggleConditionalFormatting":var action=um.createActionObject(this.elem,mstrUpdateManager.TOGGLE_DOC_THRESHOLDS,this.parentBone.beanPath,[],[],[],[]);um.add([action],true);um.flushAndSubmitChanges();return true;case"datasetObjPanel":microstrategy.toggleAccordion(microstrategy.ACCORDION_RW_DATASET_PANEL);return true;case"relatedReportsPanel":microstrategy.toggleAccordion(microstrategy.ACCORDION_RW_RELATED_RP_PANEL);return true;case"notesPanel":microstrategy.toggleAccordion(microstrategy.ACCORDION_RW_NOTES_PANEL);return true;case"outlinePanel":microstrategy.toggleAccordion(microstrategy.ACCORDION_RW_OUTLINE_PANEL);return true;case"newRW":var action=um.createActionObject(this.elem,mstrUpdateManager.CREATE_NEW_DOCUMENT,microstrategy.servletName,[],[],[],[]);um.useIframe=false;um.add([action],true);um.flushAndSubmitChanges();return true;case"browseParent":case"openHome":return true;case"toggleScreenMode":toggleScreenMode();return true;case"exportExcel":return this.exec("export",4);case"exportHtml":return this.exec("export",-1);case"exportFlash":return this.exec("export",7);case"printPDF":return this.exec("export",3);case"export":if(cmdValue==7&&this.parentBone.hasUCSelectors){showMessage({contents:microstrategy.descriptors.getDescriptor("7482"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"mstr.$obj('"+this.parentBone.id+"').commands.exec('trueExport',"+cmdValue+");",type:mstrMsgBoxImpl.MSG_WARNING});}else{return this.exec("trueExport",cmdValue);}return true;case"trueExport":var target=this.parentBone.isFeatureAvailable("export-new-window")?"_blank":"mstrExportWindow";exportRW(cmdValue,target);case"proxyForGridObservers":if(this.parentBone.observer){this.parentBone.observer.notifyAll(cmdValue);}return true;case"toggleFlashGrouping":this.parentBone.toggleGrouping();return true;case"IVEHelp":window.open(this.parentBone.helpPath+"#about_interactive_visual_data_exploration.htm","_blank");return true;case"close":if(mstrApp.pathInfo.nb[1].href==="#"||mstrApp.isHomePage){return this.exec(mstrApp.preferences.startPage=="3187"?"openDefaultHome":"openHome");}cmdValue="-1";case"openPage":um.useIframe=false;var actionCollection=new Array();actionCollection.push(um.createActionObject(this.elem,mstrUpdateManager.OPEN_HISTORY_PAGE,microstrategy.servletName+"."+microstrategy.pageName,["3140"],[cmdValue]));um.add(actionCollection,true);um.flushAndSubmitChanges();return true;case"setUnsetFalse":cmdValue;var c=this.parentBone.formattingAttributes[cmdValue];if(c){c.isUs=false;}return true;case"createPersonalView":this.exec("showBean","pvsubs",allPanels);return true;case"ShowSharingEditor":var pb=this.parentBone,isBlank=microstrategy.getViewerBone().isDocBlank||microstrategy.getViewerBone().isBlankAnalysis,callback={success:function(){var state=pb.stateID,$ID="sharingEditor",sharingEditor=window.mstrmojo&&mstrmojo.all[$ID];microstrategy.showSharingEditor(null,{lastState:state},true);},failure:function(){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){}},updateManager=microstrategy.updateManager;if(isBlank){showMessage({contents:microstrategy.descriptors.getDescriptor("14121"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"mstr.$obj('"+this.parentBone.id+"').commands.exec('save', {origin:"+microstrategy.SAVE_AS_SHARE_EDITOR+"});",buttonLabels:{Ok:microstrategy.descriptors.getDescriptor("118")},type:mstrMsgBoxImpl.MSG_WARNING});}else{if(updateManager.newActions){updateManager.add([updateManager.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,this.parentBone.beanPath,[],[],[],null)]);updateManager.flushAndSubmitChanges(false,callback);}else{callback.success();}}return true;}if(!this.parentBone.doc){return ;}switch(cmdId){case"rulers":return this.parentBone.toggleRuler();break;case"grid":return this.parentBone.toggleGrid();break;case"divider":return this.parentBone.toggleDivider();break;case"unloadDocViewer":if(this.parentBone.doc.selections){this.parentBone.doc.selections.clear();}microstrategy.unregisterGridBones();window.setTimeout("microstrategy.unRegisterBone('"+this.parentBone.id+"')",0);break;case"activeTab":if(cmdValue!=this.parentBone.currentLayout){var um=this.parentBone.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.SET_CURRENT_LAYOUT,this.parentBone.beanPath,["2048007"],[cmdValue],[])]);this.exec("unloadDocViewer");um.flushAndSubmitChanges();}break;case"moveTab":var um=this.parentBone.updateManager;var ids=["2048007"];var values=[cmdValue[0]];if(cmdValue[1]){ids.push("2048036");values.push(cmdValue[1]);}um.add([um.createActionObject(null,mstrUpdateManager.MOVE_LAYOUT,this.parentBone.beanPath,ids,values,[])],true);break;case"addTab":case"addNewLayout":case"addExistingLayout":var modelProps={};if(cmdId=="addNewLayout"||cmdId=="addTab"){modelProps["tabList/selectedIndicesList"]=0;}else{if(cmdId=="addExistingLayout"){modelProps["tabList/selectedIndicesList"]=2;}}microstrategy.openFolderBasedBlockEditor("insertLayoutEditor","InsertLayoutEditorBlockLoader",{folderID:"FCA4BAFE4AF0D00088028989D7497A4F",typeRestriction:"14081"},modelProps);break;case"removeTab":showMessage({contents:microstrategy.descriptors.getDescriptor("4360"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.parentBone.id+"').commands.exec('confirmRemoveTab', "+((cmdValue)?"'"+cmdValue+"'":"null")+");",type:mstrMsgBoxImpl.MSG_WARNING,title:microstrategy.descriptors.getDescriptor("5678")+": "+this.parentBone.currentLayoutName});break;case"confirmRemoveTab":var um=this.parentBone.updateManager;var deleteLayoutTab=(cmdValue)?cmdValue:this.parentBone.currentLayout;var bfli=this.parentBone.BeforeLayoutItems;var bl=this.parentBone.BeforeLayout;for(var i=0;i<bfli.length;i++){var item=bfli[i];if(item.key==deleteLayoutTab){if(item.dssid==bl&&bfli[i+1]){this.parentBone.BeforeLayout=bfli[i+1]["dssid"];}bfli.splice(i,1);break;}}var isCurrent=deleteLayoutTab==this.parentBone.currentLayout;um.add([um.createActionObject(null,mstrUpdateManager.REMOVE_LAYOUT,this.parentBone.beanPath,["2048007","2048176"],[deleteLayoutTab,isCurrent],[])],true);if(isCurrent){um.flushAndSubmitChanges();}else{this.parentBone.observer.notifyAll("onDeleteLayoutTab");}break;case"TabName":var format=mstrFormatObject;var prop="name";var um=this.parentBone.updateManager;var data=this.parentBone.currentLayout+mstrUpdateManager.UNIT_SEPARATOR+format.getPropertySetName(prop)+mstrUpdateManager.UNIT_SEPARATOR+format.getPropertyName(prop)+mstrUpdateManager.UNIT_SEPARATOR+format.encodeValue(prop,cmdValue.value)+mstrUpdateManager.ITEM_SEPARATOR;um.add(um.createActionObject(null,mstrUpdateManager.EDIT_PROPS,this.parentBone.beanPath,["2048018","2048035"],[mstrUpdateManager.UPDATE_LATER,data],[]));break;case"tabMPHF":var format=mstrFormatObject;var prop="TabMPHF";var um=this.parentBone.updateManager;um.add(um.createActionObject(null,mstrUpdateManager.EDIT_PROPS,this.parentBone.beanPath,["2048018","2048035"],[mstrUpdateManager.UPDATE_LATER,this.parentBone.currentLayout+mstrUpdateManager.UNIT_SEPARATOR+format.getPropertySetName(prop)+mstrUpdateManager.UNIT_SEPARATOR+format.getPropertyName(prop)+mstrUpdateManager.UNIT_SEPARATOR+format.encodeValue(prop,cmdValue.value)+mstrUpdateManager.ITEM_SEPARATOR],[]));break;case"VisibleSections":var format=mstrFormatObject;var prop="visibility";var um=this.parentBone.updateManager;var data=cmdValue.obj.id+mstrUpdateManager.UNIT_SEPARATOR+format.getPropertySetName(prop)+mstrUpdateManager.UNIT_SEPARATOR+format.getPropertyName(prop)+mstrUpdateManager.UNIT_SEPARATOR+cmdValue.value+mstrUpdateManager.ITEM_SEPARATOR;um.add(um.createActionObject(cmdValue.obj,mstrUpdateManager.EDIT_PROPS,this.parentBone.beanPath,["2048018","2048035"],[mstrUpdateManager.UPDATE_LATER,data],[]));break;case"formatMultiLevelBulk":for(var i=cmdValue.length-1;i>=0;i--){var arValues=cmdValue[i].split("|");if(arValues[0]==microstrategy.FORMAT_LEVEL_FLAG_VIEWER){var noUsed=cmdValue.splice(i,1)[0];this.exec(arValues[1],arValues[2]);}}if(cmdValue.length>0){this.parentBone.doc.commands.exec(cmdId,cmdValue);}break;case"MultiLevelPropertyChanges":for(var i=cmdValue.length-1;i>=0;i--){if(cmdValue[i].level==microstrategy.FORMAT_LEVEL_FLAG_VIEWER){var propChange=cmdValue.splice(i,1)[0];this.exec(propChange.cmdId,propChange);}}if(cmdValue.length>0){this.parentBone.doc.commands.exec(cmdId,cmdValue);}break;default:return this.parentBone.doc.commands.exec(cmdId,cmdValue,allPanels);break;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrViewerCommandsImpl.prototype.askBeforeSaveOverwrite=function(){try{var textLabel=microstrategy.descriptors.getDescriptor("11165").replace(/##/,"<b>"+encode(this.parentBone.objectName)+"</b>");var checkBoxLabel="<label for='askBeforeSaveCheckbox' id='glabel'> "+microstrategy.descriptors.getDescriptor("211")+" </label>";var askCheckbox="<input name='askBeforeSave' id='askBeforeSaveCheckbox' type='checkbox'/> ";showMessage({contents:"<div style='overflow:auto'>"+textLabel+"</div><br/><br/><div style='overflow:auto' text-align:center>"+askCheckbox+checkBoxLabel+"</div>",elements:microstrategy.OK_BUTTON+microstrategy.APPLY_BUTTON+microstrategy.CANCEL_BUTTON,applyEval:"microstrategy.bones['"+this.parentBone.id+"'].commands.submitSave()",okEval:"microstrategy.bones['"+this.parentBone.id+"'].commands.exec('save')",buttonLabels:{Apply:microstrategy.descriptors.getDescriptor("219"),Ok:microstrategy.descriptors.getDescriptor("218")},title:microstrategy.descriptors.getDescriptor("5728"),type:mstrMsgBoxImpl.MSG_TEXT_ONLY});}catch(err){microstrategy.errors.log(err);}};mstrViewerCommandsImpl.prototype.submitSave=function(){try{var askBeforeSaveCheckbox=document.getElementById("askBeforeSaveCheckbox");if(askBeforeSaveCheckbox&&askBeforeSaveCheckbox.checked&&this.parentBone.isFeatureAvailable("ask-before-save-changes")){this.exec("dontAskAgain");}var um=microstrategy.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,this.parentBone.beanPath,[],[],[],null)]);um.add([um.createActionObject(null,mstrUpdateManager.SAVE_OBJECT,this.parentBone.beanPath,["89001"],["0"],[],null)]);um.flushAndSubmitChanges();}catch(err){microstrategy.errors.log(err);}};mstrViewerCommandsImpl.prototype.isNew=function(folderId){return(folderId=="6C87013036D94E65B9FD227CF919327E"||folderId=="FCA4BAFE4AF0D00088028989D7497A4F"||folderId=="C1EDA6CB4A7933A0C0B3AF92EEBBFC2E");};mstrViewerCommandsImpl.prototype.showMessageForIVE=function(cmdId,cmdVal,allPanels){var cmd=typeof (cmdId)=="string"?"'"+cmdId+"'":cmdId,cmdVl=typeof (cmdVal)=="string"?"'"+cmdVal+"'":cmdVal,allPnls=typeof (allPanels)=="string"?"'"+allPanels+"'":allPanels;showMessage({contents:microstrategy.descriptors.getDescriptor("8127"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bones['"+this.parentBone.id+"'].commands.askedForIVE = true; microstrategy.bones['"+this.parentBone.id+"'].commands.exec("+cmd+","+cmdVl+","+allPnls+");",type:mstrMsgBoxImpl.MSG_WARNING});if(this.parentBone.observer){this.parentBone.observer.notifyAll("onselectionchange");}};mstrViewerCommandsImpl.prototype.refreshViewer=function(um,reprompt,refresh,regenerate){var action=um.createActionObject(null,mstrUpdateManager.RW_REFRESH,this.parentBone.beanPath,["2048059","2048060","2048143"],[reprompt,refresh,regenerate],[],null);um.useIframe=false;um.add([action],true);um.flushAndSubmitChanges();};mstrViewerCommandsImpl.prototype.showBean=function(um,beanName){var action=um.createActionObject(null,mstrUpdateManager.SHOW_BEAN,microstrategy.servletName+"."+microstrategy.pageName,["5017","5018"],[true,beanName],[],null);um.add([action],true);um.flushAndSubmitChanges();return true;};mstrViewerCommandsImpl.prototype.queryEnabled=function(cmdId,cmdValue){try{var um=microstrategy.updateManager;switch(cmdId){case"redoq":return um.anyNonStatic(true);break;case"undoq":return um.anyNonStatic(false);break;case"doFlush":return um.hasChangesToSubmit();break;case"IVEMode":case"designViewMode":case"convertToDoc":case"staticViewMode":case"publishViewMode":case"interactiveViewMode":case"editableMode":case"flashViewMode":case"export":case"printPDF":case"exportExcel":case"exportHtml":case"exportFlash":case"exportPDF":case"save":case"dSave":case"newRW":case"datasetObjPanel":case"relatedReportsPanel":case"outlinePanel":case"notesPanel":case"groupBy":case"zoom":case"grid":case"rwCurrentViewMode":case"rwChangeDesignMode":case"activeTab":case"moveTab":case"addTab":case"TabName":case"tabMPHF":case"addNewLayout":case"addExistingLayout":case"toggleScreenMode":case"openHome":case"sendNow":case"scheduleHL":case"mobileSubs":case"ncSubs":case"ncFileSubs":case"ncCacheSubs":case"ncFtpSubs":case"ncPrintSubs":case"createPersonalView":case"ShowSharingEditor":case"docVisualizationModeFlash":case"docVisualizationModeAJAX":case"toggleFlashGrouping":case"docDetails":case"hasMultipleLayouts":case"close":case"IVEHelp":case"canBeScheduled":case"canBeSubscribed":case"selectedUsers":case"userSubscribeRights":return true;break;case"browseParent":return !this.parentBone.isBlankAnalysis;case"removeTab":return this.queryState("hasMultipleLayouts");break;case"docVisualizationMode":return this.parentBone.visualizationsEnabled;case"refresh":return true;case"reprompt":return this.parentBone.isFeatureAvailable("enable-reprompt");case"rerun":case"regenerate":return this.parentBone.isFeatureAvailable("enable-reexecute");case"toggleConditionalFormatting":return this.parentBone.isFeatureAvailable("rw-document-has-thresholds");case"saveToInbox":var sent=microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE||!this.parentBone.sentToInbox;return mstr.behaviors.featureResolver.featAvailable("enable-add-history-list")&&sent;case"createCalculationCM":case"customGroupCM":var gridOrPanel=this.parentBone.doc.selections.getSelectedGrid();var g=microstrategy.findBone(gridOrPanel);if(!(g&&g.selections&&g.selections.singleAttributeElementsAreSelected()&&g.selections.getSelectedGridTarget)){return false;}var depth="";var subDepth="";var unit=null;var attrId="";var axis="";var selectedGridTarget=g.selections.getSelectedGridTarget();if(selectedGridTarget&&selectedGridTarget.length>0){var values=selectedGridTarget.split(",");if(values!=null&&values.length>=2){axis=values[0];depth=values[1];subDepth=values[2];unit=g.gridStructureInfo.getUnit(axis,depth,subDepth);if(unit!=null){if(unit.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){unit=g.gridStructureInfo.findUnit(unit.parentDssId);}attrId=unit.dssId;}}}if(!attrId){return false;}var cgl=(g&&g.commands)?g.commands.queryState("getControlGroupByList"):false;if(cgl){all:for(var gbNodeId in cgl){if(cgl[gbNodeId].dfm!="1"){continue;}var gbNodeOId=cgl[gbNodeId].oid;if(attrId==gbNodeOId){return false;}}}return true;default:return(this.parentBone&&this.parentBone.doc&&this.parentBone.doc.commands)?this.parentBone.doc.commands.queryEnabled(cmdId,cmdValue):false;break;}}catch(err){microstrategy.errors.log(err);return false;}};mstrViewerCommandsImpl.prototype.queryState=function(cmdId,allPanels){try{var me=this;var pb=this.parentBone;var fnBuildListModelItems=function(str){var modelItems=[];if(mstr.utils.String.trim(str).length>0){var items=str.split(me.clipboardItemSep);for(var i=0,len=items.length;i<len;i++){var item=items[i],parts=item.split(me.itemSep);var obj={};obj[me.valueField]=item;obj[me.typeField]=parts[1];obj[me.nameField]=parts[2];modelItems.push(obj);}}return modelItems;};var fnGetAssociatedSchedules=function(){try{if(!!pb.asLoaded){return ;}iframe.showWaitPage();var fnBuildSelectedItemsAsString=function(items){var str="";for(var i=0,len=items.length;i<len;i++){var item=items[i];str+=item[me.valueField];if(i<len-1){str+=me.clipboardItemSep;}}return str;};mstr.$XHR.request(mstrApp.taskURL||mstrConfig.taskURL,{taskId:"getSubscriptionAssociatedInformation",objectID:pb.objectID,objectType:pb.objectType,msgID:pb.messageID},{success:function(res){pb.asLoaded=true;pb.canBeScheduled=!res.o.nc;pb.scheduleType=res.o.st;pb.selectedSchedules=fnBuildSelectedItemsAsString(res.o.items);pb.availableSchedules=res.p.items;pb.canBeSubscribed=!res.user.nc;pb.userType=res.user.ut;pb.selectedUsers=res.user.items||[];pb.userSubscribeRights=res.user.rgts;}},false);iframe.hideWaitPage();}catch(err){microstrategy.errors.log(err);}};switch(cmdId){case"canBeScheduled":fnGetAssociatedSchedules();return pb[cmdId];case"scheduleType":pb[cmdId+"Was"]=pb[cmdId];return pb[cmdId];case"availableSchedules":return pb[cmdId];case"selectedSchedules":pb[cmdId+"Was"]=pb[cmdId];return fnBuildListModelItems(pb[cmdId]||"");case"canBeSubscribed":fnGetAssociatedSchedules();return pb[cmdId];case"userType":pb[cmdId+"Was"]=pb[cmdId];return pb[cmdId];case"selectedUsers":return pb[cmdId];case"userSubscribeRights":return pb[cmdId];case"rwCurrentViewMode":return pb.currentRWViewMode;case"rulers":return pb.rulerOn;case"grid":return pb.gridOn;case"divider":return pb.dividerOn;case"groupByDssIds":return(typeof (pb.groupByDssIds!="undefined"))?pb.groupByDssIds:null;case"TabName":return pb.currentLayoutName;case"tabMPHF":return pb.currentLayoutMPHF;case"zoom":var flashMode=(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&pb.currentRWViewMode==microstrategy.RW_VIEW_MODE_FLASH);return mstr.controllers.ZoomFactors.getZoomFactors(microstrategy.zoomType,microstrategy.ZOOM_FACTOR,flashMode);case"docVisualizationModeFlash":return pb.visualizationMode==50;case"docVisualizationModeAJAX":return pb.visualizationMode==51;case"docVisualizationMode":return pb.visualizationMode;case"documentDataSets":return[{dssid:"",n:microstrategy.descriptors.getDescriptor("181")}].concat(pb.getAvailableDatasets());case"datasetObjPanel":b=microstrategy.bone("accordion_AccordionTabManagerStyle");return(b&&b.currentTabName==microstrategy.ACCORDION_RW_DATASET_PANEL);case"relatedReportsPanel":b=microstrategy.bone("accordion_AccordionTabManagerStyle");return(b&&b.currentTabName==microstrategy.ACCORDION_RW_RELATED_RP_PANEL);case"notesPanel":b=microstrategy.bone("accordion_AccordionTabManagerStyle");return(b&&b.currentTabName==microstrategy.ACCORDION_RW_NOTES_PANEL);case"outlinePanel":b=microstrategy.bone("accordion_AccordionTabManagerStyle");return(b&&b.currentTabName==microstrategy.ACCORDION_RW_OUTLINE_PANEL);case"documentAttributes":return[{dssid:"",n:microstrategy.descriptors.getDescriptor("181")}].concat(pb.getAvailableAttributes());case"documentPureAttributes":return[{dssid:"",n:microstrategy.descriptors.getDescriptor("181")}].concat(pb.getPureAttributes());case"documentAttributesWithDateForm":return[{dssid:"",n:microstrategy.descriptors.getDescriptor("181")}].concat(pb.getAttributesWithDateForms());case"documentMetrics":return[{dssid:"",n:microstrategy.descriptors.getDescriptor("181")}].concat(pb.getAvailableMetrics());case"documentAttributesType":return[{dssid:"",n:microstrategy.descriptors.getDescriptor("181")}].concat(pb.getAttributesType());case"widthZoomFactor":var docArea=document.getElementById("page");var viewer=document.getElementById("rwb_viewer");if(docArea&&viewer){var docWidthOffset=0;var vRulerWidth=0;if(docArea.style.borderLeftWidth&&(docArea.style.borderLeftWidth.indexOf("pt")>-1)){docWidthOffset+=parseInt(microstrategy.number.convertUnit(mstrNumber.UNIT_PT,mstrNumber.UNIT_PX,parseInt(docArea.style.borderLeftWidth)));}if(docArea.style.borderRightWidth&&(docArea.style.borderRightWidth.indexOf("pt")>-1)){docWidthOffset+=parseInt(microstrategy.number.convertUnit(mstrNumber.UNIT_PT,mstrNumber.UNIT_PX,parseInt(docArea.style.borderRightWidth)));}docWidthOffset+=getObjWidth(document.getElementById("docRszHandler"));if(document.getElementById("vRulerCol")){vRulerWidth=getObjWidth(document.getElementById("vRulerCol"));}var viewerScrollbar=mstr.utils.BoxModel.hasScrollbar(viewer,"y")?SCROLLBAR_SIZE:0;var browserScrollbar=mstr.utils.BoxModel.hasScrollbar(document.documentElement,"y")?SCROLLBAR_SIZE:0;var zoomFactor=((getObjWidth(viewer)-docWidthOffset-viewerScrollbar-browserScrollbar)/(getObjWidth(docArea)+vRulerWidth-docWidthOffset)*microstrategy.ZOOM_FACTOR-0.5).toFixed(0);if(zoomFactor<0){return 1;}return zoomFactor;}return 0;case"heightZoomFactor":var docArea=document.getElementById("page");var viewer=document.getElementById("rwb_viewer");var rulerTable=document.getElementById("rwb_ruler_table");if(docArea&&viewer){var docHeightOffset=0;var hRulerHeight=0;if(docArea.style.borderTopWidth&&(docArea.style.borderTopWidth.indexOf("pt")>-1)){docHeightOffset+=parseInt(microstrategy.number.toLocalUnits(mstrNumber.UNIT_PX,microstrategy.number.convertToUSUnits(mstrNumber.UNIT_PT,parseInt(docArea.style.borderTopWidth),true),true));}if(docArea.style.borderBottomWidth&&(docArea.style.borderBottomWidth.indexOf("pt")>-1)){docHeightOffset+=parseInt(microstrategy.number.toLocalUnits(mstrNumber.UNIT_PX,microstrategy.number.convertToUSUnits(mstrNumber.UNIT_PT,parseInt(docArea.style.borderBottomWidth),true),true));}if(document.getElementById("hRulerRow")){hRulerHeight=getObjHeight(document.getElementById("hRulerRow"));}var titleHeight=0;var titles=microstrategy.objectListFind(docArea,"div","dsec");for(var i=0;i<titles.length;i++){var title=titles[i].firstChild;var isTitleDisplay=(title.style.display=="block"||title.style.display=="");if(title.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_TITLEBAR&&isTitleDisplay){titleHeight+=getObjHeight(title);}}var zoomFactor=((getObjHeight(viewer)-docHeightOffset-2*SCROLLBAR_SIZE-titleHeight)/(getObjHeight(docArea)+hRulerHeight-titleHeight-docHeightOffset)*microstrategy.ZOOM_FACTOR-0.5).toFixed(0);if(zoomFactor<0){return 1;}return zoomFactor;}return 0;case"IVEMode":return microstrategy.DISPLAY_MODE===microstrategy.VIEW_MODE&&pb.currentRWViewMode===microstrategy.RW_VIEW_MODE_VIEWANALYSIS;case"designViewMode":case"convertToDoc":return microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE;case"publishViewMode":case"staticViewMode":return microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&pb.currentRWViewMode==microstrategy.RW_VIEW_MODE_STATIC;case"interactiveViewMode":return microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&pb.currentRWViewMode==microstrategy.RW_VIEW_MODE_INTERACTIVE;case"editableMode":return microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&pb.currentRWViewMode==microstrategy.RW_VIEW_MODE_EDITABLE;case"flashViewMode":return microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&pb.currentRWViewMode==microstrategy.RW_VIEW_MODE_FLASH;case"export":return mstr.controllers.ExportTypes.getExportModes();case"docSelectedVisualization":var visualizationItems=[];var selected=-1;var visList=pb.visualizationList;if(pb.isVisualization&&visList&&visList.length>0){for(var i=0;i<visList.length;i++){if(visList[i].vm==pb.visualizationMode){if(pb.selectedVisualization==visList[i].name){selected=i;}visualizationItems.push({dssid:visList[i].name+"|"+visList[i].vm,n:visList[i].desc});}}return{items:visualizationItems,value:visList[selected].name+"|"+visList[selected].vm};}return{items:[]};case"toggleFlashGrouping":return pb.groupingChecked&&pb.groupingChecked();case"toggleConditionalFormatting":return pb.isFeatureAvailable("rw-check-document-thresholds");case"hasMultipleLayouts":return pb.isMultiLayout&&pb.BeforeLayoutItems&&pb.BeforeLayoutItems.length>1;case"showJoinBehavior":var g=microstrategy.findBone(pb.doc.selections.getSelectedGrid());return g&&g.isGrid;case"gridJoinType":var bone=microstrategy.findBone(pb.doc.selections.getSelectedGrid()),items=[];if(bone){var editorProps=bone.editorProperties,ojt=editorProps&&editorProps.outerJoinType,allAttrs={alias:microstrategy.descriptors.getDescriptor("13185"),dssId:"allAttrs",jt:ojt||"dft",n:"allAttrs",ic:"jt-allattrs"},metrics=bone.gridStructureInfo.metricAxis.units,tmsProps=editorProps&&editorProps.tmsProps,dmsProps=editorProps&&editorProps.dmsProps;items.push(allAttrs);metrics=metrics&&mstr.$A.filter(metrics,{filter:function(metric){var id=metric.dssId,prop;if(tmsProps&&tmsProps[id]){prop=tmsProps[id];if(prop.isDerived&&!prop.afb&&prop.isSmart&&!prop.isSmartCalInBase){return false;}}return true;}},"filter");var key,id,added={};for(key in metrics){id=metrics[key].dssId;items.push({dssId:id,alias:metrics[key].alias,jt:(tmsProps&&tmsProps[id]&&tmsProps[id].outerJoinType)||"dft",n:"metric",ic:"jt-metric"});added[id]=true;}for(id in dmsProps){var prop=dmsProps[id];if(!added[id]&&(!prop.isDerived||prop.afb||!prop.isSmart||prop.isSmartCalInBase)){items.push({dssId:id,alias:prop.alias,jt:prop.outerJoinType||"dft",n:"metric",ic:"jt-metric"});}}}return items;case"candidateAttributes":return pb.getPureAttributes();default:return(pb&&pb.doc&&pb.doc.commands)?pb.doc.commands.queryState(cmdId,allPanels):null;break;}}catch(err){microstrategy.errors.log(err);return false;}};mstrViewerCommandsImpl.prototype.queryVisible=function(cmdId){try{var pb=this.parentBone;switch(cmdId){case"docSelectedVisualization":var visList=pb.visualizationList;return pb.isVisualization&&visList&&visList.length>1&&pb.getAllVisList()&&pb.getAllVisList()[pb.selectedVisualization].sw!="0";case"docVisualizationModeFlash":return pb.visualizationsEnabled&&this.isVisModeEnabled(50);case"docVisualizationModeAJAX":return pb.visualizationsEnabled&&this.isVisModeEnabled(51);case"tbLoading":return false;case"openPage":return microstrategy.pageScreenMode==microstrategy.PAGE_FULL_SCREEN_MODE;}return(pb.doc&&pb.doc.commands)?pb.doc.commands.queryVisible(cmdId):true;}catch(err){microstrategy.errors.log(err);return true;}};mstrViewerCommandsImpl.prototype.isVisModeEnabled=function(viewMode){for(var x in this.parentBone.visualizationList){if(this.parentBone.visualizationList[x].vm==viewMode){return true;}}return false;};mstrViewerCommandsImpl.prototype.execPingServer=function(){if(this.pingServer&&mstr.http.PingServer&&mstr.models.BooleanTaskModel){var um=microstrategy.updateManager;if(um.hasNewChanges()){var req=new mstr.http.PingServer();if(!this.booleanTaskModel){this.booleanTaskModel=new mstr.models.BooleanTaskModel({parent:this});mstr.controllers.Factory.add(this.booleanTaskModel);this.booleanTaskModel&&this.booleanTaskModel.init&&this.booleanTaskModel.init();this.booleanTaskModel.attachEventListener(this,"set_readyState","pingCallback");}this.booleanTaskModel.execSubmit(req);}if(this.parentBone.keepAlive){window.setTimeout("microstrategy.getViewerBone().commands.exec('ping');",this.parentBone.keepAlive);}return true;}return false;};mstrViewerCommandsImpl.prototype.pingCallback=function(evt){try{switch(evt.name){case"set_readyState":switch(evt.memo.value){case mstr.Enum.Widget.READYSTATE.ERROR:this.pingServer=false;return ;}break;}}catch(err){microstrategy.errors.log(err);}};function mstrViewerCommandsImpl(){this.pingServer=true;return this;}