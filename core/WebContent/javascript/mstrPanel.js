mstrPanel.prototype=new mstrSubSection();mstrPanel.prototype.subsectionType=mstrSubSection.TYPE_PANEL;mstrPanel.prototype.onShowCalled=false;mstrPanel.prototype.contentsMenu=null;mstrPanel.prototype.docViewer=null;mstrPanel.prototype.isFilterPanel=false;mstrPanel.prototype.onload=function(){try{mstrSubSection.prototype.onload.call(this);this.docViewer=microstrategy.getViewerBone();var docStyleObj=this.docViewer.doc.styleObj;microstrategy.formatType=1;var w=docStyleObj.getValue(this.parentBone.elem,"width");var h=parseInt(docStyleObj.getValue(this.parentBone.elem,"height"));if(this.parentBone.isTitleVisible&&h>getObjHeight(this.parentBone.titleBars[0])){h-=getObjHeight(this.parentBone.titleBars[0]);}var canEdit=microstrategy.EDIT_MODE==microstrategy.ALLOW_EDIT_MODE;this.isFilterPanel=this.parentBone.isFilterPanel;for(var i=0;i<this.sibs.length;i++){var l=this.sibs[i];if(canEdit){l.onmousedown=new Function("e",this.verifiedPath+" { return "+this.path+".onmousedown(e); }");l.onclick=new Function("e",this.verifiedPath+" { return "+this.path+".onclick(e); }");l.ondblclick=new Function("e",this.verifiedPath+" { return "+this.path+".ondblclick(e); }");l.onselectstart=new Function("return false");}l.style.width=w;l.style.height=h+"px";this.clearContentsMenu();this.updateContentsMenu();}}catch(err){microstrategy.errors.log(err);}};mstrPanel.prototype.onpostload=function(){try{if(this.isFilterPanel){this.adjustChnPos();}}catch(err){microstrategy.errors.log(err);}};mstrPanel.prototype.adjustChnPos=function(){try{var docBone=this.doc,cns=this.elem.childNodes,so=microstrategy.styleObj,i;if(cns&&cns.length>0){var arr=[];for(i=0;i<cns.length;i++){arr.push(cns[i]);}arr.sort(function(a,b){var az=parseInt(so.getValue(a,"zIndex")),bz=parseInt(so.getValue(b,"zIndex"));return az-bz;});var th=mstrFilterPanelMaskImpl.ITEM_SPA;for(i=0;i<cns.length;i++){var l=so.getValue(cns[i],"left"),t=th;moveObjTo(cns[i],l,t);th=t+getObjHeight(cns[i])+mstrFilterPanelMaskImpl.ITEM_SPA;}}}catch(err){microstrategy.errors.log(err);}};mstrPanel.prototype.synchronizeSize=function(){try{if(!!this.sibs.length&&!!this.sibs[0]){if(!this.sibs[0].style.width){this.onShowCalled=false;var w=parseInt(microstrategy.styleObj.getValue(this.parentBone.elem,"width"));var h=parseInt(microstrategy.styleObj.getValue(this.parentBone.elem,"height"));if(this.parentBone.isTitleVisible&&h>getObjHeight(this.parentBone.titleBars[0])){h-=getObjHeight(this.parentBone.titleBars[0]);}this.resize(h,w);this.onShow();}}}catch(err){microstrategy.errors.log(err);}};mstrPanel.prototype.resetElement=function(){this.elem=document.getElementById(this.id);var child=null;for(var i=0;i<this.elem.childNodes.length;i++){child=this.elem.childNodes[i];if((child.tagName=="SPAN")&&(child.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK)){var panelStacksBone=microstrategy.bone(child.id);if(panelStacksBone){panelStacksBone.resetElement();}}}};mstrPanel.prototype.clearContentsMenu=function(){var cm=document.getElementById(this.id+"_contentsMenu");if(cm){this.elem.removeChild(cm);this.contentsMenu=null;}};mstrPanel.prototype.addContentsMenu=function(){if(!this.isPanelEmpty()||!this.docViewer.isFeatureAvailable(microstrategy.FEATURE_INSERT_INTO_PANEL)){return ;}this.contentsMenu=document.createElement("div");this.contentsMenu.setAttribute("id",this.id+"_contentsMenu");this.contentsMenu.className="contentsMenu";this.contentsMenu.setAttribute(microstrategy.HTMLATTR_CMD_ID,"cm");this.contentsMenu.onmousedown=new Function("e","microstrategy.bone('"+this.parentBone.id+"').onmousedown(e);");this.elem.appendChild(this.contentsMenu);var imgSpan=this.contentsMenu.appendChild(document.createElement("span"));imgSpan.setAttribute("id","contentsMenuIcon");imgSpan.className="addContents";imgSpan.setAttribute(microstrategy.HTMLATTR_CMD_ID,"cm");imgSpan=this.contentsMenu.appendChild(document.createElement("span"));imgSpan.setAttribute("id","contentsMenuIconPD");imgSpan.className="contentsPD";imgSpan.setAttribute(microstrategy.HTMLATTR_CMD_ID,"cm");imgSpan=this.contentsMenu.appendChild(document.createElement("span"));imgSpan.innerHTML=microstrategy.descriptors.getDescriptor((this.isFilterPanel)?"9241":"5702");imgSpan.setAttribute("id","addContents");imgSpan.className="addContentsText";imgSpan.setAttribute(microstrategy.HTMLATTR_CMD_ID,"cm");};mstrPanel.prototype.updateContentsMenu=function(){if(!this.docViewer.isEditableViewModeEplus()){return ;}if(this.contentsMenu){if(!this.isPanelEmpty()){this.clearContentsMenu();}}else{this.addContentsMenu();}};mstrPanel.prototype.isPanelEmpty=function(){var len=this.elem.childNodes.length;if(len>1){return false;}else{if(len==1){var id=this.elem.childNodes[0].id;if(id!=""){return false;}}}return true;};mstrPanel.prototype.onmousedown=function(e){try{if(!e){e=window.event;}mstr.controllers.EventManager.notifyWindowListeners({name:"closeMenus"});var bone=microstrategy.findBone(getEventTarget(e));if(bone&&(bone.isTable||bone.isVisualization)){return true;}e.cancelBubble=true;return(this.doc.selections.onmousedown)?this.doc.selections.onmousedown(e):false;}catch(err){microstrategy.errors.log(err);return false;}};mstrPanel.prototype.hideMask=function(){try{var masks=document.getElementsByName(this.id+"_mask");for(var i=0;i<masks.length;i++){masks[i].style.display="none";masks[i].setAttribute("isCollapsed","true");}}catch(err){microstrategy.errors.log(err);}};mstrPanel.prototype.showMask=function(topOffset,leftOffset){try{var masks=document.getElementsByName(this.id+"_mask");if(masks.length>0){var panelStack=(this.parentBone.elem);var h=getObjHeight(panelStack);if(this.parentBone.isTitleVisible&&h>getObjHeight(this.parentBone.titleBars[0])){h-=getObjHeight(this.parentBone.titleBars[0]);}var w=getObjWidth(panelStack);for(var i=0;i<masks.length;i++){masks[i].setAttribute("isCollapsed","false");with(masks[i].style){height=h+"px";width=w+"px";top=(getObjSumTop(this.sibs[i])-this.doc.top+topOffset)+"px";left=(getObjSumLeft(panelStack)-this.doc.left+leftOffset)+"px";display="block";}}if(this.isFilterPanel&&this.docViewer.doc){var sec=microstrategy.findAncestorWithAtt(this.elem,microstrategy.HTMLATTR_OBJTYPE,"dsec");var maskBone=this.docViewer.doc.getSubMaskBone(sec.id,this.id,0);if(maskBone){maskBone.updateImageMap();}}}}catch(err){microstrategy.errors.log(err);}};mstrPanel.prototype.onclick=function(e){try{return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrPanel.prototype.resize=function(height,width){try{if(height<=0||width<=0){return ;}for(var i=0;i<this.sibs.length;i++){this.sibs[i].style.height=height+"px";this.sibs[i].style.width=width+"px";}microstrategy.getViewerBone().resize100HMObjects(this.id);microstrategy.getViewerBone().resize100WMObjects(this.id,true);}catch(err){microstrategy.errors.log(err);}};mstrPanel.prototype.applyGradient=function(){};mstrPanel.prototype.onShow=function(){try{if(!this.onShowCalled){var roundedCornerRects=microstrategy.findChildrenWithAtt(this.elem,"span",microstrategy.HTMLATTR_STYLE,microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND);if(roundedCornerRects){for(var i=0;i<roundedCornerRects.length;i++){var roundedCornerRectBone=microstrategy.bone(roundedCornerRects[i].id);if(roundedCornerRectBone){roundedCornerRectBone.synchronizeSize();}}}var scrollers=microstrategy.findChildrenWithAtt(this.elem,"div",microstrategy.HTMLATTR_SCRIPTCLASS,"mstrScrollerImpl");if(scrollers){for(var i=0;i<scrollers.length;i++){var scrollerBone=microstrategy.bone(scrollers[i].id);if(scrollerBone){scrollerBone.reset();}}}var panelStacks=microstrategy.findChildrenWithAtt(this.elem,"span",microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);if(panelStacks){for(var i=0;i<panelStacks.length;i++){var panelStacksBone=microstrategy.bone(panelStacks[i].id);if(panelStacksBone&&panelStacksBone.isLoaded){panelStacksBone.synchronizeSize();}}}var grids=microstrategy.findChildrenWithAtt(this.elem,"div",microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_DOC_GRID_TEMPLATE);if(grids){for(var i=0;i<grids.length;i++){var gridBone=microstrategy.bone(grids[i].id);if(gridBone){gridBone.onresize();}}}var grids=microstrategy.findChildrenWithAtt(this.elem,"div",microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_GRID_TABLE);if(grids){for(var i=0;i<grids.length;i++){var gridBone=microstrategy.bone(grids[i].id);if(gridBone){gridBone.onresize();window.setTimeout("microstrategy.bone('"+grids[i].id+"').resizeLockSet()",0);}}}var gradientValue=this.elem.getAttribute("gradientcolor");if(gradientValue){var objs=document.getElementsByName(this.elem.getAttribute("id"));var gradientSettings=gradientValue.split(",");for(var i=0;i<objs.length;i++){gradientUtil.applyGradient(objs[i],gradientSettings[gradientUtil.GRADIENT_START_COLOR_INDEX],gradientSettings[gradientUtil.GRADIENT_END_COLOR_INDEX],gradientSettings[gradientUtil.GRADIENT_ANGLE_INDEX],gradientSettings[gradientUtil.GRADIENT_XOFFSET_INDEX],gradientSettings[gradientUtil.GRADIENT_YOFFSET_INDEX],microstrategy.styleObj);}}var gmaps=microstrategy.findChildrenWithAtt(this.elem,"div",microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_GMAP);if(window.mstrmojo&&gmaps){for(i=0;i<gmaps.length;i++){var map=mstrmojo.all[gmaps[i].id];if(map){map.onShow();}}}var esrimaps=microstrategy.findChildrenWithAtt(this.elem,"div",microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_ESRIMAP);if(window.mstrmojo&&esrimaps){for(i=0;i<esrimaps.length;i++){var esrimap=mstrmojo.all[esrimaps[i].id];if(esrimap){esrimap.onShow();}}}this.onShowCalled=true;}}catch(err){microstrategy.errors.log(err);}};mstrPanel.prototype.updatePortalTitle=function(title){this.parentBone.adjustTitle(this.elem);};mstrPanel.prototype.deletePanel=function(){try{microstrategy.eventManager.notifyOrphanBones("onPanelDeleted",this.id);}catch(err){microstrategy.errors.log(err);}};function mstrPanel(id,parentBone,path){this.inherits=mstrSubSection;this.inherits(id);delete this.inherits;this.parentBone=parentBone;this.path=path;}