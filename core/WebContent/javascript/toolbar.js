mstrToolbarImplScript=true;mstrToolbarImpl.prototype=new mstrEditorImpl();mstrToolbarImpl.CMD_TYPE_SIMPLE=0;mstrToolbarImpl.CMD_TYPE_RADIO=1;mstrToolbarImpl.CMD_TYPE_CHECK=2;mstrToolbarImpl.CMD_TYPE_PULLDOWN=3;mstrToolbarImpl.CMD_TYPE_COMBO=4;mstrToolbarImpl.CMD_TYPE_CAPTION=5;mstrToolbarImpl.CMD_TYPE_TEXT=6;mstrToolbarImpl.PULLDOWN_DISABLED="mstrPulldowndisabled";mstrToolbarImpl.COMBODOWN_DISABLED="mstrCombodowndisabled";mstrToolbarImpl.DISABLED="mstrIcon-tb disabled";mstrToolbarImpl.PULLDOWN_ENABLED="mstrPulldown";mstrToolbarImpl.COMBODOWN_ENABLED="mstrCombodown";mstrToolbarImpl.ENABLED="mstrIcon-tb selected";mstrToolbarImpl.ICON="mstrIcon-tb";mstrToolbarImpl.RADIO_DISABLED="mstrIcon-tb disabled";mstrToolbarImpl.prototype.onload=function(){try{this.initToolbar();}catch(err){microstrategy.errors.log(err);return false;}};mstrToolbarImpl.prototype.onunload=function(e){try{mstrEditorImpl.prototype.onunload.call(this,e);var bone=this.getAppliesTo();if(bone&&bone.observer){bone.observer.unregister(this.id);}}catch(err){microstrategy.errors.log(err);}return true;};mstrToolbarImpl.prototype.ondocumentclick=function(e){try{if(!e){e=window.event;}if(this.currentPicker){this.closePicker(e);}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.ondblclick=function(e){try{return false;}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.onclick=function(e){try{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.start("mstrToolbarImpl.onclick",mstrLogImpl.CLICK_TOOLBAR);}if(!e){e=window.event;}if(this.getAppliesTo()==null){return ;}var obj=getEventTarget(e);if(obj==null){return ;}var cmdObj=obj;if(cmdObj.getAttribute(microstrategy.HTMLATTR_CMD_ID)==null){cmdObj=findTarget(obj,microstrategy.HTMLATTR_CMD_ID);}if(cmdObj==null){return ;}var className=cmdObj.className;if(className.indexOf("disabled")!=-1){return ;}var cmdId=cmdObj.getAttribute(microstrategy.HTMLATTR_CMD_ID);if(cmdId==null){return ;}var cmdVal=cmdObj.getAttribute(microstrategy.HTMLATTR_CMD_VALUE);var cmdPicker=cmdObj.getAttribute(microstrategy.HTMLATTR_CMD_PICKER);var cmdTp=this.getCmdType(cmdObj);switch(cmdTp){case mstrToolbarImpl.CMD_TYPE_RADIO:if(obj.className!=mstrToolbarImpl.ENABLED){var btns=obj.parentNode.childNodes;for(var i=0;i<btns.length;i++){if(btns[i].nodeType==1){btns[i].className=(btns[i]==obj)?mstrToolbarImpl.ENABLED:mstrToolbarImpl.ICON;}}this.exec(cmdId,cmdVal);}break;case mstrToolbarImpl.CMD_TYPE_CHECK:var isSelected=(obj.className.indexOf("selected")>=0);if(typeof (cmdVal)=="number"||Number(cmdVal)!=NaN){cmdVal=(isSelected)?-cmdVal:cmdVal;}obj.className=(isSelected)?mstrToolbarImpl.ICON:mstrToolbarImpl.ENABLED;this.exec(cmdId,cmdVal);break;case mstrToolbarImpl.CMD_TYPE_PULLDOWN:this.togglePicker(true,cmdPicker,obj);break;case mstrToolbarImpl.CMD_TYPE_COMBO:if(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_BTN_HANDLE){this.togglePicker(true,cmdPicker,cmdObj);}else{this.exec(cmdId,cmdVal);}break;default:this.exec(cmdId,cmdVal);break;}}catch(err){microstrategy.errors.log(err);}finally{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.stop("mstrToolbarImpl.onclick",mstrLogImpl.CLICK_TOOLBAR);}}return false;};mstrToolbarImpl.prototype.onselectionchange=function(e){return this.update(e);};mstrToolbarImpl.prototype.getQueryState=function(at,ctrl){try{return at.commands.queryState(ctrl.getAttribute(microstrategy.HTMLATTR_CMD_ID));}catch(err){microstrategy.errors.log(err);}return"";};mstrToolbarImpl.prototype.update=function(e){try{var at=this.getAppliesTo();if(at&&at.commands){for(var ctrlId in this.controls){var ctrl=this.controls[ctrlId];var cmdId=ctrl.getAttribute(microstrategy.HTMLATTR_CMD_ID);if(cmdId){var enabled=at.commands.queryEnabled(cmdId);if(enabled){ctrl.className=mstrToolbarImpl.ICON;ctrl.disabled=false;this.enable(ctrl,this.getQueryState(at,ctrl),at,cmdId);}else{ctrl.disabled=true;this.disableCtrl(ctrl);}if(at.commands.customUpdate){at.commands.customUpdate(ctrl);}}if(ctrl.getAttribute(microstrategy.HTMLATTR_DYN_TITLE)!=null){ctrl.setAttribute("title",at.commands.queryState(ctrl.getAttribute(microstrategy.HTMLATTR_DYN_TITLE)));}}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrToolbarImpl.prototype.getBeanName=function(){try{var sEditorName=this.elem.parentNode.id;if(sEditorName.indexOf("_")>0){sEditorName=sEditorName.substr(0,sEditorName.indexOf("_"));}return sEditorName;}catch(err){microstrategy.errors.log(err);return false;}};mstrToolbarImpl.prototype.onmouseover=function(e){try{var btn=this.getButton(e);if(btn==null){return ;}var cn=btn.className.toLowerCase();if(cn.indexOf("disabled")>-1){return ;}if(btn.className.indexOf(" highlighted")==-1){btn.className+=" highlighted";}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.onmouseout=function(e){try{var btn=this.getButton(e);if(btn==null){return ;}btn.className=btn.className.replace(" highlighted","");}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.togglePicker=function(show,id,tool){try{dropDown.togglePicker(show,id,tool,this);}catch(err){microstrategy.errors.log(err);}return false;};mstrToolbarImpl.prototype.closePicker=function(e){try{dropDown.closePicker(e,this);return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrToolbarImpl.prototype.selectPickerElement=function(picker){try{var cmdId=picker.commandId;var at=this.getAppliesTo();if(at){var selected=at.commands.queryState(cmdId);if(selected!=null){var item=document.getElementById("pkr"+selected);if(item){item.className=mstrToolbarImpl.ENABLED;picker.selected=item;}}}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.exec=function(cmdId,cmdVal){try{if(!cmdId){return ;}var at=this.getAppliesTo();if(!at){return ;}if(!at.commands.queryEnabled(cmdId)){return ;}at.commands.exec(cmdId,cmdVal);return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrToolbarImpl.prototype.execPicker=function(picker,obj){try{var bClose=true;var cmdId=picker.commandId;var at=this.getAppliesTo();if(at&&cmdId&&at.commands.queryEnabled(cmdId)){bClose=at.commands.exec(cmdId,obj.getAttribute("id").slice(3));if(bClose){var ctrl=this.getControlFromCmdId(cmdId);if(this.getCmdType(ctrl)==mstrToolbarImpl.CMD_TYPE_PULLDOWN){this.enable(ctrl,this.getQueryState(at,ctrl),at,cmdId);}}}return bClose;}catch(err){microstrategy.errors.log(err);return false;}};mstrToolbarImpl.prototype.initToolbar=function(){try{this.initEditor();this.controls=new Object();this.currentPicker=null;if(this.elem){var appliesTo=this.appliesTo||this.elem.getAttribute("at");this.setAppliesTo(appliesTo);var beanPath=this.elem.getAttribute("beanPath");if(beanPath&&beanPath.length>0){this.beanPath=beanPath;}var oncl=new Function("e","return microstrategy.bone('"+this.id+"').onclick(e);");var ondbl=new Function("e","return microstrategy.bone('"+this.id+"').ondblclick(e);");this.elem.onmouseover=new Function("e","if (typeof(microstrategy) != 'undefined' && microstrategy.bone('"+this.id+"') != null) { return microstrategy.bone('"+this.id+"').onmouseover(e); }");this.elem.onmouseout=new Function("e","if (typeof(microstrategy) != 'undefined' && microstrategy.bone('"+this.id+"') != null) { return microstrategy.bone('"+this.id+"').onmouseout(e); }");if(!this.body){return ;}function getObjInnerText(vObject){var obj=getObj(vObject);if(typeof (obj.innerText)!="undefined"){return obj.innerText;}if(bIsW3C&&obj.childNodes&&obj.childNodes[0]&&(obj.childNodes[0].nodeValue!=null)){if(obj.childNodes[0].nodeValue!=obj.innerHTML){microstrategy.err.log("Please forward the reproduction scenario to reproduce this error to either Mark or Yong.  Do not log a TQMS issue.");}return obj.childNodes[0].nodeValue;}}var groups=this.body.getElementsByTagName("div");for(var i=0;i<groups.length;i++){if(groups[i].getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_BTN_GROUP){for(var j=0;j<groups[i].childNodes.length;j++){if(groups[i].childNodes[j].nodeType==1){var tool=groups[i].childNodes[j];var id=tool.getAttribute("id");if(tool.getAttribute(microstrategy.HTMLATTR_CMD_ID)&&tool.getAttribute(microstrategy.HTMLATTR_CMD_TYPE)!=mstrToolbarImpl.CMD_TYPE_TEXT&&tool.tagName.toLowerCase()!="label"){tool.onclick=oncl;tool.ondblclick=ondbl;}this.controls[id]=tool;if(tool.firstChild&&tool.firstChild.tagName=="SPAN"){this.controls[id].origName=tool.firstChild.innerHTML;}else{this.controls[id].origName=getObjInnerText(tool);}}}}}}}catch(err){microstrategy.errors.log(err);return false;}};mstrToolbarImpl.prototype.setAppliesTo=function(bone){try{if(bone==null){bone=microstrategy.getViewerBone();}if(typeof (bone)=="string"){bone=microstrategy.bone(bone);}if(bone){this.appliesTo=bone.id;if(bone.observer){bone.observer.register(this.id);}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrToolbarImpl.prototype.getAppliesTo=function(bone){try{if(this.appliesTo&&this.appliesTo.length>0){return microstrategy.bone(this.appliesTo);}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrToolbarImpl.prototype.getControlFromCmdId=function(cmdId){try{for(var c in this.controls){if((this.controls[c])&&(this.controls[c].getAttribute(microstrategy.HTMLATTR_CMD_ID)==cmdId)){return this.controls[c];break;}}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrToolbarImpl.prototype.getCmdType=function(tool){try{if(tool.getAttribute(microstrategy.HTMLATTR_CMD_TYPE)==null){return mstrToolbarImpl.CMD_TYPE_SIMPLE;}else{return parseInt(tool.getAttribute(microstrategy.HTMLATTR_CMD_TYPE));}}catch(err){microstrategy.errors.log(err);return null;}};mstrToolbarImpl.prototype.getButton=function(e){try{if(!e){e=window.event;}var btn=findTarget(getEventTarget(e),microstrategy.HTMLATTR_SUBOBJTYPE);if(btn==null){return null;}if(btn.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_BTN_HANDLE){btn=btn.parentNode;}if(btn.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_BTN){return null;}return btn;}catch(err){microstrategy.errors.log(err);return null;}};mstrToolbarImpl.prototype.updatePulldownDisplayValue=function(ctrlDiv,newDisplayValue,className){try{if(ctrlDiv.firstChild&&ctrlDiv.firstChild.tagName=="SPAN"){ctrlDiv.firstChild.innerHTML=(newDisplayValue.name)?newDisplayValue.name:newDisplayValue;if(className){ctrlDiv.firstChild.className=className;}}else{ctrlDiv.innerHTML=(newDisplayValue.name)?newDisplayValue.name:newDisplayValue;if(className){ctrlDiv.className=className;}}ctrlDiv.setAttribute("title",newDisplayValue);}catch(err){microstrategy.errors.log(err);return null;}};mstrToolbarImpl.prototype.addPickerOption=function(picker,text,value,extraAttributes,className,dssType){var oOption=null;try{if(typeof (text)!="undefined"&&picker){oOption=document.createElement("span");oOption.setAttribute("name","pkr"+value);oOption.setAttribute("id","pkr"+value);oOption.displayName=text;var icon=document.createElement("span");icon.className="mstrIcon-tb";if(dssType===12){icon.className+=" attr";}oOption.appendChild(icon);oOption.appendChild(document.createTextNode(text));if(extraAttributes){for(var attribute in extraAttributes){var attrValue=extraAttributes[attribute];oOption.setAttribute(attribute,attrValue);}}if(className){oOption.className=className;}picker.appendChild(oOption);}}catch(err){microstrategy.errors.log(err);}return oOption;};mstrToolbarImpl.prototype.displayVisModeButton=function(cmdId){try{var at=this.getAppliesTo();if(at){var show=at.commands.queryEnabled(cmdId);for(var c in this.controls){if(this.controls[c]&&this.controls[c].getAttribute(microstrategy.HTMLATTR_CMD_ID)==cmdId){if(show&&this.visAvailable(this.controls[c].getAttribute(microstrategy.HTMLATTR_CMD_VALUE))){displayObj(this.controls[c]);}else{removeObj(this.controls[c]);}}}}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.visAvailable=function(viewMode){try{var at=this.getAppliesTo();if(at){var visList;if(at.doc&&at.doc.selections&&at.doc.selections.getSelectedGrid()){var oGrid=at.doc.selections.getSelectedGrid();if(oGrid){targetGrid=microstrategy.findBone(oGrid);if(targetGrid){visList=targetGrid.visualizationList;}}}else{visList=at.visualizationList;}if(visList){for(var i=0;i<visList.length;i++){if(visList[i].vm==viewMode){return true;}}}}}catch(err){microstrategy.errors.log(err);}return false;};mstrToolbarImpl.prototype.removePickerOption=function(picker,value){try{if(picker){for(var i=0;picker.childNodes&&i<picker.childNodes.length;i++){if(picker.childNodes[i].getAttribute("id")=="pkr"+value){picker.removeChild(picker.childNodes[i]);}}}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.disablePulldownCtrl=function(ctrl,resetName){try{ctrl.className=mstrToolbarImpl.PULLDOWN_DISABLED;var needToReset=true;if(resetName!=null&&resetName==false){needToReset=false;}if(needToReset){this.updatePulldownDisplayValue(ctrl,ctrl.origName);}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.enablePulldownCtrl=function(ctrl,value){try{ctrl.className=mstrToolbarImpl.PULLDOWN_ENABLED;if(value==null){value=ctrl.origName;}this.updatePulldownDisplayValue(ctrl,value);}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.enableCtrl=function(ctrl){try{ctrl.className=mstrToolbarImpl.PULLDOWN_ENABLED;}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.populatePulldownCtrl=function(ctrl,options){try{var picker=document.getElementById(ctrl.getAttribute(microstrategy.HTMLATTR_CMD_PICKER));if(!picker){return ;}while(picker.hasChildNodes()){picker.removeChild(picker.firstChild);}for(var i=0;i<options.length;i++){var o=options.get(i);this.addPickerOption(picker,o.text,o.value,null,undefined,o.oty);}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.disableCtrl=function(ctrl,resetName){try{switch(this.getCmdType(ctrl)){case mstrToolbarImpl.CMD_TYPE_PULLDOWN:this.disablePulldownCtrl(ctrl,resetName);break;case mstrToolbarImpl.CMD_TYPE_COMBO:ctrl.className=mstrToolbarImpl.COMBODOWN_DISABLED;if("true"==ctrl.childNodes[0].getAttribute("fillColorContent")){ctrl.childNodes[0].childNodes[0].className=mstrToolbarImpl.DISABLED;}else{ctrl.childNodes[0].className=mstrToolbarImpl.DISABLED;}break;case mstrToolbarImpl.CMD_TYPE_CAPTION:break;case mstrToolbarImpl.CMD_TYPE_RADIO:case mstrToolbarImpl.CMD_TYPE_CHECK:if(!ctrl.className.match(mstrToolbarImpl.RADIO_DISABLED)){ctrl.className=ctrl.className+"  "+mstrToolbarImpl.RADIO_DISABLED;}break;default:if(ctrl.tagName!="A"){ctrl.className=ctrl.className.replace(mstrToolbarImpl.DISABLED,"")+" "+mstrToolbarImpl.DISABLED;}}if(ctrl.getAttribute("title")){ctrl.setAttribute("dtitle",ctrl.getAttribute("title"));ctrl.setAttribute("title","");}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.deselectAllCtrls=function(){try{for(var id in this.controls){var ctrl=this.controls[id];switch(this.getCmdType(ctrl)){case mstrToolbarImpl.CMD_TYPE_CHECK:case mstrToolbarImpl.CMD_TYPE_RADIO:if(!ctrl.className.match(mstrToolbarImpl.DISABLED)){ctrl.className=mstrToolbarImpl.ICON;}break;case mstrToolbarImpl.CMD_TYPE_PULLDOWN:if(microstrategy.EXECUTION_SCOPE!=microstrategy.REPORT_EXECUTION){this.disablePulldownCtrl(ctrl);}break;}}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.enable=function(ctrl,value,at,cmdId){try{switch(this.getCmdType(ctrl)){case mstrToolbarImpl.CMD_TYPE_CHECK:ctrl.className=(value)?mstrToolbarImpl.ENABLED:mstrToolbarImpl.ICON;return ;case mstrToolbarImpl.CMD_TYPE_SIMPLE:case mstrToolbarImpl.CMD_TYPE_RADIO:ctrl.className=(value==parseInt(ctrl.getAttribute(microstrategy.HTMLATTR_CMD_VALUE)))?mstrToolbarImpl.ENABLED:mstrToolbarImpl.ICON;break;case mstrToolbarImpl.CMD_TYPE_PULLDOWN:if(at.commands.queryEnabled(cmdId)){if(value&&value.currentOptionValue){this.enablePulldownCtrl(ctrl,value.currentOptionValue);this.populatePulldownCtrl(ctrl,value);}else{this.enablePulldownCtrl(ctrl,value);}}else{this.disablePulldownCtrl(ctrl);}break;case mstrToolbarImpl.CMD_TYPE_COMBO:var enabled=at.commands.queryEnabled(cmdId);ctrl.className=enabled?mstrToolbarImpl.COMBODOWN_ENABLED:mstrToolbarImpl.COMBODOWN_DISABLED;if("true"==ctrl.childNodes[0].getAttribute("fillColorContent")){ctrl.childNodes[0].childNodes[0].className=enabled?mstrToolbarImpl.ICON:mstrToolbarImpl.DISABLED;}else{ctrl.childNodes[0].className=enabled?mstrToolbarImpl.ICON:mstrToolbarImpl.DISABLED;}break;}if(ctrl.getAttribute("dtitle")){ctrl.setAttribute("title",ctrl.getAttribute("dtitle"));ctrl.setAttribute("dtitle","");}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.disableToolbar=function(){try{for(var id in this.controls){var ctrl=this.controls[id];this.disableCtrl(ctrl);}}catch(err){microstrategy.errors.log(err);}};mstrToolbarImpl.prototype.adjustVisualization=function(pickerCombo,at,toolbar){try{if(pickerCombo){if(at){var picker=document.getElementById(pickerCombo.getAttribute(microstrategy.HTMLATTR_CMD_PICKER));if(picker){if(at.visualizationList&&at.visualizationList.length>1&&at.isVisualization){while(picker.hasChildNodes()){picker.removeChild(picker.firstChild);}for(var i=0;i<at.visualizationList.length;i++){var name=at.visualizationList[i].name;var value=at.visualizationList[i].desc;var vm=at.visualizationList[i].vm;if(at.filterVisPulldown&&vm!=at.visualizationMode){continue;}var visSpan=document.createElement("span");visSpan.setAttribute("id",name+"|"+vm);visSpan.setAttribute("name",name);visSpan.setAttribute("value",name);visSpan.innerHTML=value;if(name==at.selectedVisualization){toolbar.updatePulldownDisplayValue(pickerCombo,value);pickerCombo.setAttribute("value",at.selectedVisualization);}picker.appendChild(visSpan);}displayObj(pickerCombo);}else{removeObj(pickerCombo);return ;}}}else{removeObj(pickerCombo);return ;}}}catch(err){microstrategy.errors.log(err);}};function mstrToolbarImpl(id){this.inherits=mstrEditorImpl;this.inherits(id);delete this.inherits;return this;}mstrPulldownOptions.prototype=new Object();mstrPulldownOptions.prototype.length=0;mstrPulldownOptions.prototype.currentOptionValue="";mstrPulldownOptions.prototype.options=null;mstrPulldownOptions.prototype.add=function(value,text,isCurrent,dsstype){this.options[this.length++]={value:value,text:text,oty:dsstype};if(isCurrent){this.currentOptionValue=text;}};mstrPulldownOptions.prototype.get=function(index){if(index in this.options){return this.options[index];}return{value:"null",text:"Index "+index+" not found."};};mstrPulldownOptions.prototype.setSelectedOption=function(value){for(var i=0;i<this.length;i++){var o=this.get(i);if(o.value==value){this.currentOptionValue=o.text;break;}}};function mstrPulldownOptions(){this.options=new Object();return this;}