function mstrSearch(id){this.inherits=mstrBoneImpl;this.inherits(id);delete this.inherits;this.primaryBone=true;return this;}mstrSearch.prototype=new mstrBoneImpl();mstrSearch.prototype.id=null;mstrSearch.prototype.minKeyLength=1;mstrSearch.prototype.maxResultsSize=5;mstrSearch.prototype.maxSuggestSize=5;mstrSearch.prototype.ifSize=5;mstrSearch.prototype.tipText="Type to search";mstrSearch.prototype.showSuggestAsPopup=false;mstrSearch.prototype.showAsPopup=false;mstrSearch.prototype.enableSuggestion=true;mstrSearch.prototype.hasSearchPattern=false;mstrSearch.prototype.contentContainer=null;mstrSearch.prototype.taskId="searchMetadata";mstrSearch.prototype.blockBegin=1;mstrSearch.prototype.blockCount=10;mstrSearch.prototype.folderBrowserStyle=0;mstrSearch.prototype.rootFolderType=39;mstrSearch.prototype.rootFolderID="8D67909211D3E4981000E787EC6DE8A4";mstrSearch.prototype.nameWildcards="";mstrSearch.prototype.recursive=1;mstrSearch.prototype.objectType=[3,8,14081];mstrSearch.prototype.styleName="FolderStyleQuickSearchResults";mstrSearch.prototype.styleName4Json="MojoFolderStyle";mstrSearch.prototype.styleName4suggestion="WidgetFolderStyle";mstrSearch.prototype.fields="name";mstrSearch.prototype.dereferenceshortcut="1";mstrSearch.prototype.dateType=1;mstrSearch.prototype.created=0;mstrSearch.prototype.dateSubType=1;mstrSearch.prototype.intervalUnit=1;mstrSearch.prototype.intervalValue=1;mstrSearch.prototype.startDate="";mstrSearch.prototype.endDate="";mstrSearch.prototype.ownerType=1;mstrSearch.prototype.description="";mstrSearch.prototype.maxObjects=100;mstrSearch.prototype.searchDomain=2;mstrSearch.prototype.supportOMD=false;mstrSearch.prototype.qse=true;mstrSearch.prototype.target=null;mstrSearch.prototype.ok=null;mstrSearch.prototype.searchDelay=300;mstrSearch.prototype.showSuggestionLoadingIcon=false;mstrSearch.prototype.useCurtainOverResults=true;mstrSearch.selected_CssClass=" selected";mstrSearch.selected_regex=new RegExp(mstrSearch.selected_CssClass,"g");mstrSearch.ITEM_IDX="acidx";mstrSearch.SEARCH_TYPES=[16,1,2,4,8];mstrSearch.QUICK_SEARCH_TYPES=[16,1,2,4,8];mstrSearch.OLD_SEARCH_TYPES=[1,2,4,8];mstrSearch.DEFAULT_OBJECT_TYPE=[3,8,14081];mstrSearch.OBJECT_TYPE_SUGGESTION=-1;mstrSearch.prototype.onload=function(ps){this.tipText=microstrategy.descriptors.getDescriptor(9168);this.endDate=mstr.utils.LocaleParser.formatDateInfo({day:new Date().getDate(),month:parseInt(new Date().getMonth())+1,year:new Date().getFullYear()},mstr.Settings.Locale.DATEOUTPUTFORMAT);this.updateQuickSearchEnabled();this.initBone();if(this.searchPattern!=undefined&&this.searchPattern.length==0){this.positionSearchBox(false);}this.updatePropertiesForProject();this.prepareObjectTypes();var ds={elResultPlaceholder:microstrategy.findChildWithAtt(this.elem,"div","n","SearchResultsPlaceholder"),elIncFetchPlaceholder:microstrategy.findChildWithAtt(this.elem,"div","n","IncFetchPlaceholder"),elSuggestPlaceholder:microstrategy.findChildWithAtt(this.elem,"div","n","SearchSuggestionPlaceholder"),elSearchOptions:microstrategy.findChildWithAtt(this.elem,"div","n","search_options")||microstrategy.findChildWithAtt(document.body,"div","n","search_options"),elLocation:microstrategy.findChildWithAtt(this.elem,"div","n","location")||microstrategy.findChildWithAtt(microstrategy.findChildWithAtt(document.body,"div","n","search_options"),"div","n","location"),target:microstrategy.findChildWithAtt(this.elem,"input","n","searchPattern2"),elSuggestInput:microstrategy.findChildWithAtt(this.elem,"input","n","suggestedPattern"),elSearchTip:microstrategy.findChildWithAtt(this.elem,"div","n","searchTip"),elClear:microstrategy.findChildWithAtt(this.elem,"div","n","sbClear"),elSpinner:microstrategy.findChildWithAtt(this.elem,"div","n","sbSpinner"),elSearch:microstrategy.findChildWithAtt(this.elem,"div","n","sbSearch"),rootFolderType:(parseInt(this.rootFolderType)>=0?this.rootFolderType:39),objectType:this.objectType,nameWildcards:this.nameWildcards||(this.pqse?16:1)};for(var n in ps){ds[n]=ps[n];}this.setup(ds);this.updateUIState();this.updateQuickSearchEnabled();this.showSearchInfoIcon();this.isLoaded=true;};mstrSearch.prototype.getGUID=function(){return mstrApp.httpSessionId+"-"+microstrategy.projectId;};mstrSearch.prototype.prepareObjectTypes=function(){try{var desc=[];this.allowedObjectTypes=this.allowedObjectTypesData.concat([]);mstr.$A.forEach(this.allowedObjectTypes,function(item,i,arr){arr[i]=parseInt(item.t);desc[arr[i]]=item.d;});if(this.allowedObjectTypes.length==0){this.objectType=[];return ;}var aot=this.allowedObjectTypes,ot=this.objectType;mstr.$A.forEach(ot.concat([]),function(item,i,arr){mstr.$A.removeItems(ot,mstr.$A.find(aot,parseInt(item))==-1?[item]:null);});if(ot.length==0&&!(this.isMiniSearchBox||this.isDesktopSearchBox)){ot=this.allowedObjectTypes;}this.miniSearchBoxTooltip="";for(var i=0,len=ot.length;i<len;i++){this.miniSearchBoxTooltip+=desc[ot[i]]+(i<len-1?", ":"");}this.objectType=ot;}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.updateUIState=function(){try{var tgt=this.target,elSearch=this.elSearch,fnDisable=function(){tgt.disabled="disabled";tgt.title=elSearch.title="Disabled";};if(this.allowedObjectTypes.length==0){fnDisable();if(this.elSearchOptions){elSearch.onclick=null;this.elSearchOptions.style.display="none";}}else{if((this.isMiniSearchBox||this.isDesktopSearchBox)){if(this.objectType.length==0){fnDisable();}else{tgt.title=elSearch.title=microstrategy.descriptors.getDescriptor(11231).replace("#",this.miniSearchBoxTooltip);}}}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.updatePropertiesForProject=function(){try{var qsGUID=this.getGUID();if(typeof (this)=="object"){if(this.qsGUID!=undefined&&this.qsGUID.length>0&&this.qsGUID!=qsGUID){microstrategy.updateBrowserSetting("qsGUID",qsGUID,true);microstrategy.updateBrowserSetting("rootFolderID","",true);microstrategy.updateBrowserSetting("rootFolderName","",true);microstrategy.updateBrowserSetting("rootFolderType",39,true);this.qsGUID=qsGUID;this.rootFolderID="";this.rootFolderName="";this.rootFolderType=39;}}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.setup=function(ps){try{this.maxObjects=parseInt(microstrategy.maxSearchResults||this.blockCount);for(var p in ps){this[p]=ps[p];}this.searchPattern=decode(this.searchPattern);var tgt=this.target;if(tgt){var me=this;tgt.setAttribute("autocomplete","off");var pc=this.renderPopupContainer();var appendSuggestTo=this.elSuggestPlaceholder||tgt.parentNode;appendSuggestTo.appendChild(pc);if(this.showSuggestAsPopup){tgt.onclick=function(e){me.hidePopup(e);};}tgt.onkeyup=function(e){e=e||window.event;var v=this.value;var kc=mstr.$E.keyCode(e,window);if(kc==32&&/^\s/.test(v)){this.value=v.replace(/^\s+/,"");mstr.$E.cancel(e,window);return false;}me.hasSearchPattern=this.value&&(this.value.length>0);if(!me.doAutoComplete){if(me.hasSearchPattern){me.showClearIcon();}me.searchPattern=this.value;if(e.keyCode!=13){return ;}}me.evt={};for(var n in e){me.evt[n]=e[n];}var checkMatch=function(arr,v){if(v.indexOf("?")>-1||v.indexOf("*")>-1){return false;}var matched=false;try{if(typeof (arr)=="string"){matched=(new RegExp("^"+v,"")).test(arr);}else{for(var i in arr){matched=(new RegExp("^"+v,"i")).test(arr[i].n);if(!matched){break;}}}}catch(e){}return matched;};if(e&&e.keycode&&mstr.$A.find([8,13,27,37,38,39,40],e.keyCode)===-1&&checkMatch(me.elSuggestInput.value,this.value)&&checkMatch(me.sItems,this.value)){return ;}me.processInput(me.evt);me.syncInputWithSuggest();};tgt.onpaste=function(e){window.setTimeout(function(){tgt.onkeyup(e);},0);};if(mstr.utils.ISIE4){tgt.onkeydown=function(e){e=window.event;if(e.keyCode==27){e.cancelBubble=true;return false;}};}tgt.onfocus=function(e){me.elSearchTip.style.display="none";if(!me.hasSearchPattern){this.value="";this.className=this.className.replace(/ tip/g,"");}};tgt.onblur=function(e){if(!me.hasSearchPattern){this.value="";me.elSearchTip.className+=" tip";me.elSearchTip.style.display="block";me.elSearchTip.innerHTML=me.tipText;}};me.elSearchTip.onclick=function(){this.style.display="none";me.target.focus();};this.sbClear=this.elClear;this.sbSpinner=this.elSpinner;this.sbSettings=this.elSettings;this.sbSearch=this.elSearch;this.sbSearch.onclick=function(){if(me.showAsPopup){me.goToSearchPage(me.target.className.indexOf(" tip")>-1?"":me.target.value);}else{me.forceSearch();}};this.sbSearch.onkeypress=function(e){var kc=(e||window.event).keyCode;if(kc==13){this.click();}};this.sbClear.onclick=function(){me.clear();};if(this.elSettings){this.elSettings.onclick=function(){me.toggleOptions(this);};}if(this.elSearchOptions){this.elDescription=microstrategy.findChildWithAtt(this.elSearchOptions,"textarea","id","description"),this.elSearchOptions.onclick=function(e){e=e||window.event;var tgt=e.target||e.srcElement;tgt=microstrategy.findAncestorWithAtt(tgt,"ty","stb");if(tgt&&tgt.getAttribute("ty")=="stb"){var elSubsection=tgt.parentNode;var elSC=microstrategy.findChildWithAtt(elSubsection,"div","ty","sc");if(elSC){var show=elSC.style.display=="none";show=mstr.utils.CSS.getStyleValue(elSC,"display")=="none";var h=elSC.offsetHeight;elSubsection.className=elSubsection.className.replace(/ expanded/,"")+(show?" expanded":"");if(show){elSC.style.display="block";elSC.style.height=0;start=0;end=h;}else{start=h;end=0;}me.fx(elSC,"height",start,end,10,100,"px",(show?function(){elSC.style.height="auto";microstrategy.eventManager.notifyOrphanBones("oncontentexpand",elSC);}:function(){elSC.style.display="none";}));}}};}if(this.isMiniSearchBox||this.isDesktopSearchBox){this.sbSearch.title=tgt.title=microstrategy.descriptors.getDescriptor(9246);}else{if(this.elSearchOptions){var elTypes=microstrategy.findChildWithAtt(this.elSearchOptions,"div","n","types"),elTypes_web=microstrategy.findChildWithAtt(this.elSearchOptions,"div","n","types_web"),elTypes_server=microstrategy.findChildWithAtt(this.elSearchOptions,"div","n","types_us");var isConfigSearch=this.searchDomain&&this.searchDomain==3;if(isConfigSearch){if(elTypes_web){elTypes.removeChild(elTypes_web);}var elLocation=microstrategy.findChildWithAtt(this.elSearchOptions,"div","n","location");if(elLocation){elLocation.parentNode.removeChild(elLocation);}var elDeRef=microstrategy.findChildWithAtt(this.elSearchOptions,"div","n","deRef");if(elDeRef){elDeRef.parentNode.removeChild(elDeRef);}}else{if(elTypes_server){elTypes.removeChild(elTypes_server);elTypes=elTypes_web;var elLocation=microstrategy.findChildWithAtt(this.elLocation,"div","n","rootFolderType_0");if(elLocation&&this.rootFolderType=="0"&&this.rootFolderName!=undefined){elLocation.getElementsByTagName("span")[0].innerHTML=this.rootFolderName;elLocation.style.display="block";}microstrategy.findChildWithAtt(this.elSearchOptions,"input","id","rootFolderType_"+this.rootFolderType).checked="checked";microstrategy.findChildWithAtt(this.elSearchOptions,"input","id","dereferenceshortcut").checked=this.dereferenceshortcut=="1";}}this.elTypesCheckboxes=microstrategy.findChildrenWithAtt(isConfigSearch?elTypes_server:elTypes_web,"input","type","checkbox");if(this.objectType.length>0){var types=this.objectType;var ats=this.allowedObjectTypesData,ph=document.createElement("span"),elTypeMarkup='<div><input id="objectType_#type#" name="objectType" value="#type#" type="checkbox"><label class="mstrIcon-lv mstrIcon-lv-#css#" for="objectType_#type#">#desc#</label></div>';for(var ai=0,al=ats.length;ai<al;ai++){var at=ats[ai],t=at.t,d=at.d;ph.innerHTML=elTypeMarkup.replace(/#type#/g,t).replace(/#css#/,this.t2css({t:t,st:t})).replace(/#desc#/,d);var checkbox=ph.firstChild.firstChild;if(mstr.$A.find(types,t)){checkbox.checked="checked";}this.elTypesCheckboxes.push(checkbox);elTypes.appendChild(ph.firstChild);}}microstrategy.findChildWithAtt(this.elSearchOptions,"input","id","dateSubType_"+this.dateSubType).checked="checked";microstrategy.findChildWithAtt(this.elSearchOptions,"select","id","created").selectedIndex=parseInt(this.created)-1;microstrategy.findChildWithAtt(this.elSearchOptions,"select","id","intervalUnit").selectedIndex=parseInt(this.intervalUnit)-1;microstrategy.findChildWithAtt(this.elSearchOptions,"input","id","intervalValue").value=this.intervalValue;microstrategy.findChildWithAtt(this.elSearchOptions,"input","id","startDate").value=this.startDate;microstrategy.findChildWithAtt(this.elSearchOptions,"input","id","endDate").value=this.endDate;microstrategy.findChildWithAtt(this.elSearchOptions,"input","id","ownerType_"+this.ownerType).checked="checked";microstrategy.findChildWithAtt(this.elSearchOptions,"textarea","id","description").value=this.description;var elWildcards=microstrategy.findChildWithAtt(this.elSearchOptions,"select","name","nameWildcards");this.elNameWildcards=this.elNameWildcards||elWildcards.cloneNode(true);if(elWildcards){if(!this.pqse){elWildcards.options[0]=null;}else{this.elNameWildcards.options[1]=null;elWildcards.parentNode.replaceChild(this.elNameWildcards.cloneNode(true),elWildcards);}elWildcards.selectedIndex=mstr.$A.find(this.pqse?mstrSearch.SEARCH_TYPES:mstrSearch.OLD_SEARCH_TYPES,parseInt(this.nameWildcards));}if(this.elSearchOptions){var elOptions=this.elSearchOptions;var inputs=elOptions.getElementsByTagName("input"),textAreas=elOptions.getElementsByTagName("textarea"),selects=elOptions.getElementsByTagName("select");for(var i=0,len=inputs.length;i<len;i++){if(inputs[i].type=="text"){inputs[i].onkeyup=function(){microstrategy.bone(me.id).updateOptions(this);};}else{inputs[i].onclick=function(){microstrategy.bone(me.id).updateOptions(this);};}}for(var i=0,len=selects.length;i<len;i++){selects[i].onchange=function(){microstrategy.bone(me.id).updateOptions(this);};}for(var i=0,len=textAreas.length;i<len;i++){textAreas[i].onkeyup=function(){LimitTextAreaMaxLength(this,100);me.blockBegin=1;microstrategy.bone(me.id).updateOptions(this);};}}}}this.restoreFromCookie();if(!this.elResultPlaceholder){this.elResultPlaceholder=document.getElementById("mstrWeb_footer");}var fnSetFocus=function(node){try{node.focus();}catch(ex){}};if(this.searchPattern&&this.searchPattern!=""){tgt.value=this.searchPattern;this.hasSearchPattern=tgt.value&&(tgt.value.length>0);this.showClearIcon();window.setTimeout(function(){fnSetFocus(tgt);me.forceSearch();},200);}else{this.updateTipText();if(!this.isMiniSearchBox){window.setTimeout(function(){fnSetFocus(tgt);},200);}else{this.updateTipText();}this.elSuggestInput.value="";}}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.restoreFromCookie=function(){try{if(this.elSearchOptions){var elOptions=this.elSearchOptions;var inputs=elOptions.getElementsByTagName("input"),textAreas=elOptions.getElementsByTagName("textarea"),selects=elOptions.getElementsByTagName("select");for(var i=0,len=inputs.length;i<len;i++){var input=inputs[i],n=input.name,v=input.value;if(input.type=="text"){input.value=this[n];}else{input.checked=new RegExp("(^|,)"+v+"($|,)").test(this[n]);}}for(var i=0,len=selects.length;i<len;i++){var el=selects[i],v=this[el.name];el.value=v;if(el.id=="created"){this["dateType"]=v=="0"?1:2;}this.restoreDateSubsection(el);}for(var i=0,len=textAreas.length;i<len;i++){textAreas[i].value=this[textAreas[i].name];}}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.restoreDateSubsection=function(el){try{if(el.id=="created"){var v=el.value;var target=document.getElementById("createdOptions"),start=v=="0"?68:target.offsetHeight,end=v=="0"?0:target.scrollHeight||68;this.fx(target,"height",start,end,10,100,"px");this.prepareCalendar();}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.addAdminInfo=function(msg){try{var info=microstrategy.adminInfo;return msg.replace("#",(info&&info.length>0?" ("+info+")":""));}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.showSearchInfoIcon=function requestResults(visible){if(this.isMiniSearchBox&&!this.isDesktopSearchBox||this.qse){return ;}var me=this;visible=visible==false?false:true;var elInfoIcon=me.elInfoIcon;if(elInfoIcon){elInfoIcon.style.display=visible?"block":"none";return ;}elInfoIcon=document.createElement("div");elInfoIcon.className="mstrSearchModeInfoIcon";me.elInfoIcon=elInfoIcon;me.elSuggestPlaceholder.parentNode.appendChild(me.elInfoIcon);var msg=microstrategy.descriptors.getDescriptor(9264);elSearchInfo=document.createElement("div");elSearchInfo.className="mstrSearchModeInfo"+(mstr.utils.ISIE7||mstr.utils.ISIE8?" ie78":"");elSearchInfo.innerHTML='<div class="mstrSearchModeInfoText">'+this.addAdminInfo(msg)+'</div><div class="mstrSearchModeInfoTipIcon"></div>';me.elInfoIcon.appendChild(elSearchInfo);me.elSearchInfo=elSearchInfo;};mstrSearch.prototype.onwinresize=function(){try{if(!this.isMiniSearchBox&&!this.isDesktopSearchBox){this.availableHeight=this.getAvailableHeight();var start=this.elResultPlaceholder.offsetHeight;var end=this.availableHeight;this.fx(this.elResultPlaceholder,"height",start,end,10,100,"px");if(!this.atTop&&!microstrategy.resizeAtBodyLoading){this.positionSearchBox(false);}microstrategy.resizeAtBodyLoading=false;}}catch(err){microstrategy.errors.log(err);return false;}};mstrSearch.prototype.getAvailableHeight=function(total){try{var bm=mstr.utils.BoxModel,bH=bm.getBrowserWindowHeight(document),top=parseInt(bm.position(total?document.getElementById("mstrWeb_content"):this.elResultPlaceholder).top,10),h=25,adjust=15;if(total){return bH-top;}var resultsTable=microstrategy.findChildWithAtt(this.elem,"div","name","folderAllModes");return Math.min((bH-top-h-adjust),Math.max(resultsTable&&resultsTable.scrollHeight,100));}catch(err){microstrategy.errors.log(err);return false;}};mstrSearch.prototype.positionSearchBox=function(atTop){try{var me=this;if(me.moving){return ;}if(me.isMiniSearchBox||me.isDesktopSearchBox){return ;}if(!atTop){me.searchBoxTop=me.getAvailableHeight(true)*0.4;me.elem.style.marginTop=me.searchBoxTop+"px";me.centered=true;}else{if(!me.atTop){var start=me.searchBoxTop||0,end=0;me.moving=true;me.fx(me.elem,"marginTop",start,end,10,100,"px",function(){me.atTop=true;});}}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.updateQuickSearchEnabled=function(){this.qse=microstrategy.useQuickSearch();this.pqse=this.qse;this.qse=this.qse&&(mstr.$A.find(mstrSearch.QUICK_SEARCH_TYPES,parseInt(this.nameWildcards))>-1);this.doAutoComplete=this.qse&&microstrategy.enableSearchAutoComplete;this.searchDelay=Math.max(0,microstrategy.searchAutoCompleteDelay);};mstrSearch.prototype.syncInputWithSuggest=function(){return ;this.elSuggestInput.selectionEnd=this.target.selectionEnd;this.elSuggestInput.visibility=(this.target.value.length>this.target.size)?"hidden":"visible";if(mstr.utils.ISWK){this.target.blur();this.target.focus();}};mstrSearch.prototype.getRootFolderName=function(){return{0:this.rootFolderName,7:microstrategy.descriptors.getDescriptor(2),20:microstrategy.descriptors.getDescriptor(3),39:microstrategy.descriptors.getDescriptor(9163)}[this.rootFolderType]||microstrategy.descriptors.getDescriptor(9163);return this.rootFolderName;};mstrSearch.prototype.updateTipText=function(){this.tipText=this.rootFolderType!=null?microstrategy.descriptors.getDescriptor(4325)+": "+this.getRootFolderName():this.tipText;this.target.onblur();};mstrSearch.prototype.hasUserInput=function hasUserInput(){var v=this.hasSearchPattern;v=v||(this.elDescription&&!mstr.utils.String.isEmpty(this.elDescription.value))||this.ownerType==2||this.dateType!=1&&(this.dateSubType==1&&!mstr.utils.String.isEmpty(this.intervalValue)||this.dateSubType==2&&!mstr.utils.String.isEmpty(this.startDate));return v;};mstrSearch.prototype.forceSearch=function forceSearch(){if(!this.hasUserInput()){return ;}this.elSuggestInput.value="";this.hidePopup();this.last_searchPattern=null;this.currentPage=1;this.blockBegin=1;this.requestResults();};mstrSearch.prototype.requestSuggestion=function requestSuggestion(key){this.positionSearchBox(true);var params={taskId:"getSearchSuggestions",keyword:key};this.xhr.request("post",mstrApp.taskURL||mstrConfig.taskURL,this.callbacks.suggest(this),params);};mstrSearch.prototype.delayedRequestSuggestion=function requestSuggestion(key){if(this.tmrRS){window.clearTimeout(this.tmrRS);}if(this.tmrRR){window.clearTimeout(this.tmrRR);}var me=this;this.tmrRS=window.setTimeout(function(){me.requestSuggestion(key);},this.searchDelay);};mstrSearch.prototype.requestResults=function requestResults(){if(!this.hasUserInput()){return ;}if(!this.searchPattern){this.searchPattern="";}var me=this;this.positionSearchBox(true);if(this.showInfoIconOnce){this.showInfoIconOnce=false;}else{this.showSearchInfoIcon(false);}var fnCheckObjectType=function(types){if(!me.isMiniSearchBox){return types.toString();}var newTypes=[],dot=mstrSearch.DEFAULT_OBJECT_TYPE;for(var i in dot){if(mstr.$A.find(types,dot[i])>-1){newTypes.push(dot[i]);}}return newTypes.toString();};var fnGetTargetObjectTypes=function(){var types="";if(me.isMiniSearchBox){return types;}if(me.dereferenceshortcut=="1"){return types;}if(!me.elTypesCheckboxes){return types;}var elShortcutCheckbox=microstrategy.findChildWithAtt(me.elSearchOptions,"input","id","objectType_18");if(!elShortcutCheckbox||!elShortcutCheckbox.checked){return types;}var allTypes=[];for(var i=0;i<me.elTypesCheckboxes.length;i++){allTypes.push(me.elTypesCheckboxes[i].value);}return allTypes.toString();};var params={taskEnv:"juil_xhr",taskId:"searchMetadata",searchId:this.blockBegin>this.blockCount?this.searchId:"",quickSearch:this.qse,fields:this.fields,styleName:(this.showAsPopup?this.styleName4Json:this.styleName),searchPattern:this.last_searchPattern||this.searchPattern,objectType:fnCheckObjectType(this.objectType),targetObjectType:fnGetTargetObjectTypes(),rootFolderType:this.rootFolderType,rootFolderID:(this.rootFolderType=="0"?this.rootFolderID:""),dereferenceshortcut:this.dereferenceshortcut,searchDomain:this.searchDomain,servletName:mstrApp&&mstrApp.name,supportOMD:this.supportOMD,maxObjects:this.maxObjects,blockCount:this.blockCount,blockBegin:this.blockBegin,nameWildcards:this.nameWildcards,recursive:this.recursive,sortKey:this.qse?-1:6,dateType:this.dateType,created:this.created,dateSubType:this.dateSubType,intervalUnit:this.intervalUnit,intervalValue:this.intervalValue,startDate:this.startDate,endDate:this.endDate,ownerType:this.ownerType,description:this.description};if(this.showAsPopup){params.includeObjectDesc=this.showAsPopup;params.includeAncestorInfo=this.showAsPopup;}this.xhr.request("post",mstrApp.taskURL||mstrConfig.taskURL,this.showAsPopup?this.callbacks.searchPop(this):this.callbacks.search(this),params);this.showSpinnerIcon();};mstrSearch.prototype.delayedRequestResults=function requestResults(){if(this.tmrRR){window.clearTimeout(this.tmrRR);}var me=this;this.tmrRR=window.setTimeout(function(){me.requestResults();},this.searchDelay);};mstrSearch.prototype.handleSearchErrorAndModeSwitching=function(xhr){var me=this;if(me.qse){var code=xhr.getResponseHeader("X-MSTR-TaskErrorCode"),msg=xhr.getResponseHeader("X-MSTR-TaskFailureMsg")||"";if(!code||code==-2147209051){return ;}SESVC_E_SEARCH_ENGINE_NOT_STARTED=-2147212073;SESVC_E_PROJECT_SEARCH_DISABLED=-2147212154;if(code==SESVC_E_SEARCH_ENGINE_NOT_STARTED||code==SESVC_E_PROJECT_SEARCH_DISABLED){microstrategy.isQuickSearchEnabled=false;me.updateQuickSearchEnabled();me.nameWildcards={16:1,2:2,4:4,8:8}[me.nameWildcards];me.onload();this.showInfoIconOnce=true;}else{var elError=this.elError||document.createElement("div");elError.innerHTML='<div class="mstrSearchError"><div style="padding:20px; color:##880000;">'+me.addAdminInfo(msg)+"</div>";"</div>";if(!this.elError){this.elError=elError;}if(this.isMiniSearchBox||this.isDesktopSearchBox){this.popupContainer.innerHTML=this.elError.firstChild.innerHTML;}else{this.elResultPlaceholder.innerHTML=this.elError.innerHTML;this.elIncFetchPlaceholder.innerHTML="";}}}else{var flag=eval("("+xhr.responseText+")").qsr;if(microstrategy.enableQuickSearch&&flag){microstrategy.isQuickSearchEnabled=true;me.updateQuickSearchEnabled();me.nameWildcards={1:16,2:2,4:4,8:8}[me.nameWildcards];me.onload();}}};mstrSearch.prototype.callbacks={suggest:function(me){return{success:function(res){for(var i in me){this[i]=me[i];}if(!me.hasSearchPattern){me.clear();me.hidePopup();return ;}if(!res){this.xhr.xhr.abort();me.requestSuggestion();return ;}me.sItems=res.items||[];var len=me.sItems.length;for(var i=0;i<len;i++){me.sItems[i].tp=mstrSearch.OBJECT_TYPE_SUGGESTION;}if(len){me.selectedSuggestionIndex=null;me.renderSuggestionPopup(me.sItems);}else{me.hidePopup();}var suggest=res.items&&res.items[0]&&res.items[0].n.toLowerCase();if(suggest){me.elSuggestInput.value=suggest.replace(new RegExp("^"+me.searchPattern,"i"),me.target.value);me.syncInputWithSuggest();}else{suggest=me.searchPattern;}me.suggest=suggest;if(me.last_searchPattern!=suggest){me.last_searchPattern=suggest;window.setTimeout(function(){me.requestResults();},0);}},failure:function(){},complete:function(xhr){me.hideSpinnerIcon();me.handleSearchErrorAndModeSwitching(xhr);}};},search:function(me){return{success:function(res){try{for(var i in me){this[i]=me[i];}if(!me.hasUserInput()){me.clear();me.hidePopup();return ;}if(!res){this.xhr.xhr.abort();me.requestResults();return ;}var html=res.html;if(res.ts==0){html='<div class="mstrSearchNotice"><div class="mstrSearchNoticeText">'+microstrategy.descriptors.getDescriptor(9202).replace("###"," <b>"+mstr.utils.String.escape4HTMLText(this.getRootFolderName())+"</b>").replace("##","<b>"+mstr.utils.String.escape4HTMLText(me.searchPattern)+"</b> ")+"</div></div>";}me.searchId=res.searchId||"";me.totalSize=me.getTotalSize(res.ts);me.blockBegin=res.bb;me.rsData=[html,me.totalSize,res.bb];me.elResultPlaceholder.innerHTML=html;me.updatePageNumber();me.updateIncFetch(me.rsData);var scripts=me.elResultPlaceholder.getElementsByTagName("SCRIPT");for(var i=0,len=scripts.length;i<len;i++){var inlineJS=scripts[i][mstr.utils.ISWK?"innerHTML":(mstr.utils.ISFF?"textContent":"text")];eval(inlineJS.split("<!--").join("").split("-->").join(""));}microstrategy.registerNewBones();if(microstrategy.bones[this.folderBoneId]){microstrategy.bone(this.folderBoneId).onreload();}this.onwinresize();}catch(err){microstrategy.errors.log(err);}},failure:function(xhr){},complete:function(xhr){me.hideSpinnerIcon();me.handleSearchErrorAndModeSwitching(xhr);}};},searchPop:function(me){return{success:function(res){for(var i in me){this[i]=me[i];}if(!me.hasSearchPattern){me.clear();me.hidePopup();return ;}if(!res){this.xhr.xhr.abort();me.requestResults();return ;}me.rItems=res.items||[{t:0,dssid:"",n:microstrategy.descriptors.getDescriptor(9135)}];me.renderResultsPopup(me.rItems);},failure:function(){alert(xhr.status+" : "+xhr.statusText);},complete:function(xhr){me.hideSpinnerIcon();me.handleSearchErrorAndModeSwitching(xhr);}};}};mstrSearch.prototype.cancel=function(){this.xhr.cancel();};mstrSearch.prototype.processInput=function(e){try{e=(e||window.event);var kc=e.keyCode,input=this.target.value;this.searchPattern=input;this.blockBegin=1;if(!this.doAutoComplete&&kc!=13){return ;}if(kc==13||input.length<this.minKeyLength){if(kc==13&&this.selectedIndex>-1&&this.rItems){if(this.executeObject(this.rItems[this.selectedIndex])){return ;}}if(!this.hasSearchPattern){this.clear();}this.hidePopup();this.forceSearch();return ;}else{var key=input;switch(kc){case 38:case 40:if(this.updateSelectedIndex(e)){this.delayedRequestResults();}else{if(this.tmrRR){window.clearTimeout(this.tmrRR);}}break;case 13:case 27:this.hidePopup(e);this.cancel();break;case 37:break;case 39:if(this.elSuggestInput.value&&this.target.value!=this.elSuggestInput.value){this.target.value=this.elSuggestInput.value;}break;default:this.showClearIcon();if(!this.enableSuggestion){return ;}this.showLoadingIcon(true);this.showSpinnerIcon(true);this.elSuggestInput.value="";this.delayedRequestSuggestion(key);this.showLoadingIcon(true);}}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.switchSearchStyle=function(style){switch(style){case"list":this.styleName="FolderStyleQuickSearchResults";break;case"icon":this.styleName="FolderStyleQuickSearchResultsIcon";break;}if(this.hasUserInput()){this.requestResults();}};mstrSearch.prototype.showCurtainOverResults=function(){var elCurtain=this.elCurtain;if(!elCurtain){elCurtain=this.elCurtain=(document.createElement("div"));elCurtain.className="mstrSearchResultsCurtain"+(mstr.utils.ISIE7||mstr.utils.ISIE8?" ie78":"");}var style=elCurtain.style,ph=this.elResultPlaceholder;ph.appendChild(elCurtain);if(mstr.utils.ISIE7){style.height=ph.offsetHeight+"px";style.width=ph.offsetWidth+"px";}style.display="block";};mstrSearch.prototype.hideCurtainOverResults=function(){if(this.elCurtain){this.elCurtain.style.display="none";}};mstrSearch.prototype.showSpinnerIcon=function(show){this.sbSpinner.className=this.sbSpinner.className.replace(/ show/gi,"")+" show";if(this.useCurtainOverResults){this.showCurtainOverResults();}};mstrSearch.prototype.hideSpinnerIcon=function(show){this.sbSpinner.className=this.sbSpinner.className.replace(/ show/gi,"");this.hideCurtainOverResults();};mstrSearch.prototype.showClearIcon=function(show){this.sbClear.className=this.sbClear.className.replace(/ show/gi,"")+" show";};mstrSearch.prototype.hideClearIcon=function(show){this.sbClear.className=this.sbClear.className.replace(/ show/gi,"");};mstrSearch.prototype.clear=function(show){this.hideClearIcon();this.hideSpinnerIcon();this.searchPattern="";this.last_searchPattern="";this.hasSearchPatten=false;this.target.value="";this.elSuggestInput.value="";this.elResultPlaceholder.innerHTML="";if(this.fetch){this.fetch.parentNode&&this.fetch.parentNode.removeChild(this.fetch);}this.hidePopup();};mstrSearch.prototype.showLoadingIcon=function(show){if(this.loadingIcon&&this.showSuggestionLoadingIcon){this.loadingIcon.style.display=show?"block":"none";}};mstrSearch.prototype.goToSearchPage=function(str){str="&srchStr="+(str?encodeURIComponent(mstr.utils.String.escape4HTMLText(str)):"");str+="&folderId="+this.rootFolderID;str+="&folderType="+this.rootFolderType;str+="&folderName="+this.rootFolderName;str+="&nameWildcards="+this.nameWildcards;if(typeof (mstrUpdateManager)!="undefined"){microstrategy.updateBrowserSetting("rootFolderName",this.rootFolderName,true);microstrategy.updateBrowserSetting("rootFolderType",this.rootFolderType,true);microstrategy.updateBrowserSetting("rootFolderID",this.rootFolderID,true);microstrategy.updateBrowserSetting("qsGUID",this.getGUID(),true);}var form=createDynamicForm(microstrategy.servletName+"?evt=3040"+str+"&src="+microstrategy.servletName+".3040");submitForm(form);delete form;};mstrSearch.prototype.renderPopupContainer=function(){try{var me=this;var pc=document.createElement("div");pc.setAttribute("scriptclass","mstrSearch");pc.setAttribute("n","mstrSearchPopupContainer");pc.id=this.id+"_mstrSuggestPopupContainer";pc.className="mstrSuggestPopupContainer"+(mstr.utils.ISIE7||mstr.utils.ISIE8?" ie":"");pc.onmouseover=function(){var item=me.selectedItem,isResultItem=item&&parseInt(item.getAttribute("t"))>mstrSearch.OBJECT_TYPE_SUGGESTION;if(isResultItem){me.selectedIndex=-1;me.selectedItem=null;}};var icon=document.createElement("div");icon.className="mstrSuggestPopupLoading";pc.appendChild(icon);this.loadingIcon=icon;this.popupContainer=pc;var d=microstrategy.findAncestorWithTag(this.target,"DIV");if(d){d.style.position="relative";d.style.zIndex=1;}this.target.parentNode.appendChild(pc);return pc;}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.buildPopup=function(config){try{var el=document.createElement("div");el.id=config.id;el.className="mstrSuggestPopup "+config.cssClass;if(this.showAsPopup&&config.label!=null){el.innerHTML='<label class="label">'+config.label+"</label>";}var items=config.items||[];for(var i=0,len=items.length;i<len;i++){el.appendChild(this.renderPopupItem(items[i],i));}return el;}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.renderSuggestionPopup=function(items){try{this.selectedIndex=-1;this.hidePopup();this.suggestList=this.buildPopup({items:items,label:microstrategy.descriptors.getDescriptor(8953),id:"mstrSuggestPopup_"+this.id,cssClass:"suggest"});this.popupContainer.appendChild(this.suggestList);this.positionPopup();this.showLoadingIcon(false);}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.renderResultsPopup=function(items){try{if(this.selectedSuggestionIndex!=undefined){this.selectedIndex=items.length+this.selectedSuggestionIndex;}var id="mstrSearchResultsPopup_"+this.id,el=this.buildPopup({items:items,label:microstrategy.descriptors.getDescriptor(6595),id:id});var old=document.getElementById(id),pc=this.popupContainer;if(old){pc.replaceChild(el,old);}else{pc.insertBefore(el,pc.lastChild);}this.resultList=el;}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.renderPopupItem=function(item,i){try{var me=this;var elItem=document.createElement("div");elItem.setAttribute(mstrSearch.ITEM_IDX,i);elItem.setAttribute("t",item.tp||item.t);elItem.setAttribute("ty","pi");elItem.className="mstrSuggestPopupItem";elItem.onmouseover=function(e){var isResultItem=parseInt(this.getAttribute("t"))>mstrSearch.OBJECT_TYPE_SUGGESTION;if(me.selectedItem){me.selectedItem.className=me.selectedItem.className.replace(mstrSearch.selected_regex,"");}me.selectedIndex=parseInt(this.getAttribute(mstrSearch.ITEM_IDX));this.className+=mstrSearch.selected_CssClass;};elItem.onmouseout=function(e){this.className=this.className.replace(mstrSearch.selected_regex,"");me.selectedItem=this;};elItem.onmousedown=function(e){me.onClickPopupItem(e);};var elIcon=this.renderPopupItemIcon(item.icon||this.t2css(item));var elName=document.createElement("span");elName.className="mstrSuggestPopupItemName";var pattern=(this.last_searchPattern||this.searchPattern),words=pattern.split(" "),hiRegExp=function(str){return new RegExp("("+str.replace(/[*]/g,"\\*").replace(/[?]/g,"\\?")+")","gi"),"<b>$1</b>";};elName.innerHTML=mstr.utils.String.escape4HTMLText(item.n);if(mstr.$A.find([2],parseInt(this.nameWildcards))>-1){try{elName.innerHTML=elName.innerHTML.replace(hiRegExp(pattern));}catch(e){}}else{for(var i=0,len=words.length;i<len;i++){try{elName.innerHTML=elName.innerHTML.replace(hiRegExp(words[i]));}catch(e){}}}var tooltip="",ancItems=item.anc&&item.anc.items,ancLength=ancItems&&ancItems.length;if(ancLength>0){for(var i=0;i<ancLength-1;i++){tooltip+=ancItems[i].n+" > ";}tooltip+=ancItems[ancLength-1].n;}tooltip+=(tooltip.length==0?"":" > ")+elName.innerHTML;var desc=item.desc,ml=120;if(desc){tooltip+="\r\n\r\n"+desc.substring(0,ml)+(desc.length>ml?"...":"");}elItem.title=tooltip;elItem.appendChild(elIcon);elItem.appendChild(elName);return elItem;}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.t2css=function(item){var css="";css={4:"m",256:"fi",257:"cg",768:"g",769:"gp",774:"gpgs",776:"cb",779:"cb",8704:"u",8705:"ug",14080:"d",14081:"rw avm"}[item.st];if(!css){css={1:"fi",2:"t",3:"g",4:"m",8:"f",10:"pr",18:"sc",44:"sr",55:"rw",0:"null"}[item.t];}if(item.dvm&&item.t==55){css+=" "+{2048:"avm",8192:"avm"}[item.dvm];}if(css){css+=(item.isc?"_sc":"");}return css;};mstrSearch.prototype.getTargetPopupItem=function(e){var tgt=null;e=e||window.event;if(e){tgt=e.target||e.srcElement;if(tgt&&tgt.getAttribute){if(tgt.getAttribute(mstrSearch.ITEM_IDX)==null){tgt=findTarget(tgt,"t");}}}return tgt;};mstrSearch.prototype.onClickPopupItem=function(e){e=e||window.event;if(mstr.$E.button(e,window)!=1){cancelEvent(e);stopEventBubbling(e);return false;}var tgt=this.getTargetPopupItem(e),t=tgt&&tgt.getAttribute("t"),idx=tgt&&tgt.getAttribute("acidx");if(t==mstrSearch.OBJECT_TYPE_SUGGESTION){this.updateSearchInput(e);}else{if(t>0){this.commands=new mstrSearchCommands(this);this.commands.execute(this.rItems[idx]);}}};mstrSearch.prototype.executeObject=function(object){if(object){iframe.showWaitPage();this.commands=this.commands||new mstrSearchCommands(this);this.commands.execute(object);}else{return false;}};mstrSearch.prototype.renderPopupItemIcon=function(css){try{if(css){var elIcon=document.createElement("span"),cs=css.split("_");elIcon.className="mstrIcon-lv mstrIcon-lv-"+cs[0];if(cs.length==2){var elIcon2=document.createElement("span");elIcon2.className=cs[1];elIcon.appendChild(elIcon2);}return elIcon;}else{return this.renderSuggestionPopupItemIcon();}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.renderSuggestionPopupItemIcon=function(){var elIcon=document.createElement("span");elIcon.className="mstrIcon-lv mstrIcon-lv-search";return elIcon;};mstrSearch.prototype.positionPopup=function(tgt,pc){try{var tgt=tgt||this.target,pc=pc||this.popupContainer;if(this.showAsPopup){pc.style.width=(mstr.utils.BoxModel.getBrowserWindowWidth(document)-mstr.utils.BoxModel.position(tgt).left)+"px";}else{var p=microstrategy.findAncestorWithAtt(tgt,mstr.utils.ISIE7?"className":"class","SearchBox-Wrapper")||tgt;pc.style.width=(p.offsetWidth)+"px";}if(this.showSuggestAsPopup){if(pc&&!this.isDesktopSearchBox){document.body.appendChild(pc);pc.style.top=(mstr.utils.BoxModel.position(tgt).top+mstr.utils.BoxModel.position(tgt).height-(mstr.utils.ISIE7?3:0))+"px";pc.style.left=(mstr.utils.BoxModel.position(tgt).left-(mstr.utils.ISIE7?5:2))+"px";pc.style.position="absolute";}}else{pc.style.position="static";}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.hidePopup=function(e){try{e=e||window.event;var r=this.resultList,p=this.suggestList;if(r&&r.parentNode){if((e&&(e.type=="mousedown"||e.type=="click"||e.keyCode==27)||this.last_searchPattern!=this.suggest)&&r&&r.id){r.parentNode.removeChild(r);delete this.resultList;}}if(p&&p.parentNode){p.parentNode.removeChild(p);delete this.suggestList;}this.showLoadingIcon(false);this.last_searchPattern="";}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.updateSearchInput=function(e){try{e=e||window.event;var tgt=e.target||e.srcElement;if(tgt&&tgt.getAttribute){if(tgt.getAttribute(mstrSearch.ITEM_IDX)==null){tgt=microstrategy.findAncestorWithAtt(tgt,mstrSearch.ITEM_IDX,this.selectedIndex);}if(tgt&&tgt.getAttribute&&tgt.getAttribute(mstrSearch.ITEM_IDX)!=null){this.target.value=tgt.textContent||tgt.innerText;if(this.ok){this.ok.click();}}}this.elSuggestInput.value=this.target.value;this.searchPattern=this.target.value;this.last_searchPattern=this.elSuggestInput.value;this.requestResults();}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.updateSelectedIndex=function(e){try{var pop=this.popupContainer;if(!pop||!this.resultList&&!this.suggestList){return ;}e=e||window.event;var kc=(e||window.event).keyCode;if(kc==38||kc==40||kc==13){var tgt=null,idx=this.selectedIndex,nodes=microstrategy.findChildrenWithAtt(pop,"div","ty","pi");var removeHilite=function(idx){if(idx>-1){tgt=nodes[idx];if(tgt){tgt.className=tgt.className.replace(mstrSearch.selected_regex,"");}}};removeHilite(idx);switch(kc){case 40:this.selectedIndex=(idx>=nodes.length-1)?nodes.length-1:idx+1;break;case 38:this.selectedIndex=(idx<=0)?-1:idx-1;break;case 13:this.hidePopup();this.selectedIndex=-1;return ;}tgt=nodes[this.selectedIndex];if(!tgt){return false;}tgt.className+=mstrSearch.selected_CssClass;var applySuggestion=false;if(tgt.getAttribute("t")=="-1"){this.target.value=tgt.textContent||tgt.innerText;this.elSuggestInput.value=this.target.value;if(this.last_searchPattern!=this.elSuggestInput.value){applySuggestion=true;this.last_searchPattern=this.elSuggestInput.value;}this.selectedSuggestionIndex=this.selectedIndex-(this.rItems&&this.rItems.length||0);}else{this.selectedItem=tgt;applySuggestion=false;}return applySuggestion;}}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.ondocumentclick=function(e){try{if(mstr.$E.button(e||window.event,window)!=1&&!this.isMiniSearchBox){return false;}var me=this;window.setTimeout(function(){if(me.suggestList||me.resultList){me.hidePopup(e);}me.onwinresize();},300);}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.prepareCalendar=function prepareCalendar(){if(asDescriptors.length==0){var desc=microstrategy.descriptors;self.asDescriptors=["",desc.getDescriptor(1956),desc.getDescriptor(1957),desc.getDescriptor(1958),desc.getDescriptor(1959),desc.getDescriptor(1960),desc.getDescriptor(1961),desc.getDescriptor(1962),desc.getDescriptor(1963),desc.getDescriptor(1964),desc.getDescriptor(1965),desc.getDescriptor(1966),desc.getDescriptor(1967),desc.getDescriptor(1968),desc.getDescriptor(1969),desc.getDescriptor(1970),desc.getDescriptor(1971),desc.getDescriptor(1972),desc.getDescriptor(1973),desc.getDescriptor(1974),];self.Month_Names=[desc.getDescriptor(3852),desc.getDescriptor(3853),desc.getDescriptor(3854),desc.getDescriptor(3855),desc.getDescriptor(3856),desc.getDescriptor(3857),desc.getDescriptor(3858),desc.getDescriptor(3859),desc.getDescriptor(3860),desc.getDescriptor(3861),desc.getDescriptor(3862),desc.getDescriptor(3863)];}};mstrSearch.prototype.toggleOptions=function toggleOptions(el){var elOptions=this.elSearchOptions;var v=el.getAttribute("v")||0;v=Math.abs(v-1);el.setAttribute("v",v);if(v){elOptions.style.display="block";elOptions.style.height=0;start=0;end=580;}else{start=580;end=0;}this.fx(elOptions,"height",start,end,10,100,"px",(v?function(){elOptions.style.height="auto";}:function(){elOptions.style.display="none";}));if(v==0&&this.qse){this.requestResults();}};mstrSearch.prototype.updateOptions=function updateOptions(el){var n=el.name,v=el.value,ac=this;switch(el.tagName.toLowerCase()){case"select":case"textarea":ac[n]=v;if(el.id=="created"){ac.dateType=v=="0"?1:2;}this.restoreDateSubsection(el);break;case"input":switch(el.type){case"text":if(!this.isValid(el)){return false;}case"radio":ac[n]=v;if(n=="rootFolderType"){ac.updateTipText();}break;case"checkbox":if(n=="dereferenceshortcut"){ac[n]=el.checked?"1":"0";break;}var fnCollectObjectTypes=function(chkboxes,collectAll){var ots=[];for(var i=0,len=chkboxes.length;i<len;i++){if(chkboxes[i].checked||collectAll){ots.push(chkboxes[i].value);}}return ots;};var ots=fnCollectObjectTypes(this.elTypesCheckboxes,false);if(ots.length==0){ots=fnCollectObjectTypes(this.elTypesCheckboxes,true);}ac[n]=ots.sort().toString();break;}break;}this.updateQuickSearchEnabled();if(!this.qse){this.hidePopup();}else{if(this.doAutoComplete){this.delayedRequestResults();}}microstrategy.updateCookieSetting(n,ac[n],true);microstrategy.updateBrowserSetting(n,ac[n],true);if(mstr.utils.ISIE7&&!this.qse){var img=document.createElement("img");document.body.appendChild(img);window.setTimeout(function(){img.parentNode.removeChild(img);},0);}};mstrSearch.prototype.isValid=function(el){try{var v=el.value||"",dt=el.getAttribute("dt")||1,LP=mstr.utils.LocaleParser,method=LP._getMethodLookup()[dt],isValid=method&&LP[method](v);el.style.color="";el.title="";if(!isValid){el.style.color="#f00";el.title=microstrategy.descriptors.getDescriptor(5717);}return isValid;}catch(err){microstrategy.errors.log(err);}};mstrSearch.prototype.fx=function fx(target,prop,start,end,interval,duration,suffix,onEnd){start=parseInt(start,10);end=parseInt(end,10);interval=interval||50;duration=duration||500;suffix=suffix||"";var steps=Math.max(Math.ceil(duration/interval),1),ts=target.style,count=0,exec=function(){++count;ts[prop]=start+count*(end-start)/steps+suffix;if(count>=steps){if(onEnd){onEnd();}window.clearInterval(timer);}};var timer=window.setInterval(function(){exec();},interval);};mstrSearch.prototype.getTotalSize=function(totalSize){return Math.min(microstrategy.maxSearchResults,totalSize||this.totalSize);};mstrSearch.prototype.updatePageNumber=function(){this.pageNumber=Math.ceil(this.getTotalSize()/this.blockCount);this.currentPage=Math.max(1,Math.ceil(this.blockBegin/this.blockCount));};mstrSearch.prototype.updateIncFetch=function(data){if(!data||this.pageNumber<=1){if(!this.fetch){return ;}this.fetch.style.display="none";return ;}if(!this.fetch){this.fetch=this.buildIncFetch();this.elIncFetchPlaceholder.appendChild(this.fetch);}if(this.fetch){this.totalSize=data[1];this.blockBegin=data[2];var t=this.totalSize,b=this.blockBegin,c=this.blockCount;var pn=this.pageNumber,cp=this.currentPage;var cpCss=function(p){return(p==cp)?" on":"";};var buildPageButtonsHTML=function(me){var np=me.pageNumber,cp=me.currentPage,ifSize=me.ifSize,s=Math.floor(ifSize/2);var start=Math.max(Math.min(cp-s,np-ifSize+1),1),end=Math.min(start+ifSize-1,np);var html="";for(var i=start;i<=end;i++){var onclick=i==me.currentPage?(pn>ifSize?"microstrategy.bone('"+me.id+"').toggleIncFetchPopup(true)":""):"microstrategy.bone('"+me.id+"').fetchPage("+i+")";var dropdownArrow="",title="",css="";if(pn>ifSize&&i==me.currentPage){dropdownArrow="<div></div>";title=microstrategy.descriptors.getDescriptor(5879);css=" dd";}html+='<div class="IncFetchButton pg'+cpCss(i)+css+'" onmousedown="'+onclick+'" title="'+title+'">'+i+dropdownArrow+"</div>";}return html;};this.pageBar.innerHTML=buildPageButtonsHTML(this);this.fetchInfo.innerHTML=(pn>this.ifSize?" "+microstrategy.descriptors.getDescriptor(5972).replace("##","").replace("###",this.pageNumber):"");this.fetchInfo.style.display=(t>0)?"block":"none";this.fetchInput.setAttribute("size",String(this.totalSize).length);this.fetchInput.setAttribute("maxlength",String(this.totalSize).length);var d=" disabled";this.fetchFirst.className=this.fetchFirst.className.replace(d,"")+(b>=c?"":d);this.fetchPrevious.className=this.fetchPrevious.className.replace(d,"")+(b>=c?"":d);this.fetchNext.className=this.fetchNext.className.replace(d,"")+(b+c<=t?"":d);this.fetchLast.className=this.fetchLast.className.replace(d,"")+(b+c<=t?"":d);this.fetch.style.display=this.pageNumber>1?"block":"";if(!this.fetch.offsetParent){this.elIncFetchPlaceholder.appendChild(this.fetch);}}};mstrSearch.prototype.buildIncFetch=function(){var me=this;var node=document.createElement("span");node.innerHTML='<div class="mstrIncFetch" ty="if"><div class="mstrIncFetchPopupWrapper"><div class="mstrIncFetchPopup" ty="d" id="mstrIncFetchPopup"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><span>'+microstrategy.descriptors.getDescriptor(5878)+'</span></td><td><input type="text" id="mstrIncFetchInput" value="" maxlength="3" class="mstrIncFetchInput" ty="in" ></td><td><input type="button" src="../images/1ptrans.gif" class="mstrIncFetchApply" title="'+microstrategy.descriptors.getDescriptor(2398)+'" ty="ap"><input type="button" src="../images/1ptrans.gif" class="mstrIncFetchCancel" title="'+microstrategy.descriptors.getDescriptor(2399)+'"></td><td></td></tr></tbody></table></div></div><div class="IncFetchButton"><div class="btnArrow f" title="'+microstrategy.descriptors.getDescriptor(162)+'"></div></div><div class="IncFetchButton"><div class="btnArrow p" title="'+microstrategy.descriptors.getDescriptor(5961)+'"></div></div><div id="pageBar"></div><div class="pageInfo" onmousedown="microstrategy.bone(\''+this.id+'\').toggleIncFetchPopup(true)" title="'+microstrategy.descriptors.getDescriptor(5879)+'" ty="pg"></div><div class="IncFetchButton"><div class="btnArrow n" title="'+microstrategy.descriptors.getDescriptor(3012)+'"></div></div><div class="IncFetchButton"><div class="btnArrow l" title="'+microstrategy.descriptors.getDescriptor(163)+'"></div></div></div>';this.fetch=node.firstChild;delete node;this.fetchPopupWraper=this.fetch.firstChild;this.fetchPopup=this.fetch.firstChild.firstChild;this.fetchInfo=microstrategy.findChildrenWithAtt(this.fetch,"div",microstrategy.HTMLATTR_OBJTYPE,"pg")[0];this.pageBar=this.fetchInfo.previousSibling;this.fetchLast=this.fetch.lastChild;this.fetchLast.onmousedown=function(e){if(this.className.indexOf("disabled")>-1){return false;}return me.fetchBlock(e,2);};this.fetchNext=this.fetchLast.previousSibling;this.fetchNext.onmousedown=function(e){if(this.className.indexOf("disabled")>-1){return false;}return me.fetchBlock(e,1);};this.fetchPrevious=this.fetchNext.previousSibling.previousSibling.previousSibling;this.fetchPrevious.onmousedown=function(e){if(this.className.indexOf("disabled")>-1){return false;}return me.fetchBlock(e,-1);};this.fetchFirst=this.fetchPrevious.previousSibling;this.fetchFirst.onmousedown=function(e){if(this.className.indexOf("disabled")>-1){return false;}return me.fetchBlock(e,-2);};this.fetchInput=microstrategy.findChildrenWithAtt(this.fetch,"input",microstrategy.HTMLATTR_OBJTYPE,"in")[0];this.fetchInput.onkeyup=function(e){e=e||window.event;if(e.keyCode==13){me.fetchApply.onclick(e);stopEventBubbling(e);cancelEvent(e);}else{if(e.keyCode==27){me.toggleIncFetchPopup(false);}}var v=me.fetchInput.value.replace(/\s/g,"");if(isNaN(v)||/[^\d]/.test(v)||v>me.pageNumber){me.fetchInput.style.color="#f00";me.fetchApply.disabled=true;}else{me.fetchInput.style.color="#000";me.fetchApply.disabled=false;}return false;};this.fetchApply=microstrategy.findChildrenWithAtt(this.fetch,"input",microstrategy.HTMLATTR_OBJTYPE,"ap")[0];this.fetchApply.onclick=function(e){me.fetchBlock(e,0);me.toggleIncFetchPopup(false);return false;};this.fetchCancel=this.fetchApply.nextSibling;this.fetchCancel.onclick=function(e){me.toggleIncFetchPopup(false);return false;};return this.fetch;};mstrSearch.prototype.fetchPage=function(idx){this.fetchInput.value=idx;this.fetchBlock(null,0);};mstrSearch.prototype.fetchBlock=function(e,dir){switch(dir){case 0:var pn=parseInt(this.fetchInput.value);if(isNaN(pn)||/[^\d]/.test(pn)||pn>this.pageNumber){return false;}this.blockBegin=(pn-1)*this.blockCount+1;break;case 1:case -1:this.blockBegin+=dir*this.blockCount;break;case 2:this.blockBegin=(this.pageNumber-1)*this.blockCount+1;break;case -2:this.blockBegin=1;}this.fetchNewBlock=true;this.requestResults();this.toggleIncFetchPopup(false);return false;};mstrSearch.prototype.toggleIncFetchPopup=function(show){var el=this.fetchPopup,ph=45,start=0,end=0;if(show&&!this.fetchPopupVisible){el.style.height=0;this.fetchInput.value="";this.fetchInput.focus();this.fetchPopupVisible=true;end=ph;}else{if(this.fetchPopupVisible){start=ph;this.fetchPopupVisible=false;}}if(this.fetch.offsetTop+this.elem.offsetHeight>mstr.utils.BoxModel.getBrowserWindowHeight(document)-ph){el.style.bottom=0;el.style.top="auto";}else{el.style.top="25px";el.style.bottom="auto";}this.fx(el,"height",start,end,10,100,"px");};mstrSearch.prototype.xhr={encodeParams:function encodeParams(params){var x=-1;var url=[];if(params){for(var p in params){url[++x]=p+"="+encodeURIComponent(params[p]);}}return url.join("&");},appendUrlParams:function appendUrlParams(method,baseUrl,params){if(method!=="GET"||!params){return baseUrl;}return baseUrl+"?"+this.encodeParams(params);},sendXhr:function sendXhr(xhr,method,baseUrl,params,isTask){method=method.toUpperCase();var app=mstrApp;if(typeof (microstrategy)!="undefined"&&microstrategy&&microstrategy.validateRandNum!=null&&microstrategy.validateRandNum.length>0){params.validateRandNum=microstrategy.validateRandNum;}if(!params.validateRandNum&&mstrApp&&mstrApp.validateRandNum&&mstrApp.validateRandNum.length>0){params.validateRandNum=mstrApp.validateRandNum;}if(isTask){params.taskContentType=params.taskContentType||"json";params.taskEnv=params.taskEnv||"xhr";params.xts=new Date().getTime();baseUrl=baseUrl||mstrApp.taskURL||mstrConfig.taskURL;baseUrl=microstrategy.addJSessionID(baseUrl);}var ptp=app.persistTaskParams;xhr.open(method,this.appendUrlParams(method,baseUrl,params),true);if(method!=="POST"){params=null;}else{params=this.encodeParams(params);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");}xhr.send(params);},createXhr:function createXhr(){var methods=[function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");}];for(var i=0,cnt=methods.length;i<cnt;i++){var xhr;try{xhr=methods[i]();}catch(e){continue;}createXhr=methods[i];return xhr;}throw new Error("mstrSearch.xhr: Could not create an XHR object.");},evalResponse:function evalResponse(rt){var _rtn=null;try{_rtn=eval("("+rt+")");}catch(ex){_rtn=rt;}return _rtn;},err_c:{MSI_SERVER_NAME_NOT_INITIALIZED:2147760371,MSI_INVALID_SESSION_ID:2147760372,E_MSI_USERMGR_USER_NOTFOUND:2147758245,E_MSI_CONNECT_FAILED:2147759877},isSessionExpiredError:function(res){var c=res&&res.getResponseHeader("X-MSTR-TaskErrorCode");c=(c<0)?(4294967296+parseInt(c,10)):c;switch(c){case this.err_c.MSI_SERVER_NAME_NOT_INITIALIZED:case this.err_c.MSI_INVALID_SESSION_ID:case this.err_c.E_MSI_USERMGR_USER_NOTFOUND:case this.err_c.E_MSI_CONNECT_FAILED:return true;}return false;},isTask:true,queue:[],requestInProgress:false,retryDelay:1,cancel:function(){if(this.requestInProgress){var xhr=this.xhr;if(xhr){delete xhr.onreadystatechange;if(xhr.readystate!==4){xhr.abort();}this.xhr=null;}this.requestInProgress=false;}},request:function request(method,baseUrl,callback,params,override,webSvrUrl){if(this.requestInProgress&&!override){this.queue.push({method:method,baseUrl:baseUrl,callback:callback,params:params});}else{if(this.requestInProgress){this.cancel();}this.requestInProgress=true;var xhr=this.createXhr(),me=this;xhr.onreadystatechange=function(){if(xhr.readyState!==4){return ;}try{if(xhr.status===200){me.response=me.evalResponse(xhr.responseText);if(callback.success){callback.success(me.response);}}else{if(mstrApp&&mstrApp.onSessionExpired&&me.isSessionExpiredError(xhr)){mstrApp.onSessionExpired();}else{if(callback.failure){callback.failure(xhr);}}}}catch(ex){}finally{if(callback.complete){callback.complete(xhr);}me.advanceQueue();}};this.xhr=xhr;this.sendXhr(xhr,method,baseUrl,params,this.isTask);}},advanceQueue:function advanceQueue(){if(this.queue.length===0){this.requestInProgress=false;return ;}var req=this.queue.shift();this.request(req.method,req.baseUrl,req.callback,req.params,true);}};