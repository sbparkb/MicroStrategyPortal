mstrDocSelectionsImpl.prototype=new mstrSelectionsImpl();mstrDocSelectionsImpl.prototype.resize=null;mstrDocSelectionsImpl.prototype.range=new Rect(null,null,null,null);mstrDocSelectionsImpl.prototype.handles={};mstrDocSelectionsImpl.prototype.hilites={};mstrDocSelectionsImpl.prototype.sections={};mstrDocSelectionsImpl.prototype.dragRectangles=null;mstrDocSelectionsImpl.prototype.objCache={copyBuffer:null,activeHilite:null,resizeStyle:null,hiLite:null,lineHiLite:null};mstrDocSelectionsImpl.prototype.marquee=null;mstrDocSelectionsImpl.prototype.marqueeConstrained=false;mstrDocSelectionsImpl.prototype.marqueeSingleClick=true;mstrDocSelectionsImpl.prototype.marqueeOrientation=mstrDocSelectionsImpl.MARQUEE_ORIENTATION_V;mstrDocSelectionsImpl.prototype.styleObj=null;mstrDocSelectionsImpl.prototype.path="";mstrDocSelectionsImpl.prototype.verifiedPath="";mstrDocSelectionsImpl.prototype.selectionOpacity=40;mstrDocSelectionsImpl.prototype.topBorderOffset=0;mstrDocSelectionsImpl.prototype.leftBorderOffset=0;mstrDocSelectionsImpl.prototype.savedZIndex=0;mstrDocSelectionsImpl.prototype.docViewer=null;mstrDocSelectionsImpl.prototype.isVisible=true;mstrDocSelectionsImpl.prototype.isSingleSelectionType=true;mstrDocSelectionsImpl.prototype.panelUnitFormat=0;mstrDocSelectionsImpl.prototype.panelValueFormat=0;mstrDocSelectionsImpl.prototype.controlUnitFormat=0;mstrDocSelectionsImpl.prototype.controlValueFormat=0;mstrDocSelectionsImpl.prototype.allGridUnitFormat=microstrategy.GRID_UNIT_CONTAINER;mstrDocSelectionsImpl.prototype.allGridValueFormat=5;mstrDocSelectionsImpl.prototype.gridUnitFormat=microstrategy.GRID_OTHER;mstrDocSelectionsImpl.prototype.gridValueFormat=5;mstrDocSelectionsImpl.prototype.gridUnitFormatX=microstrategy.GRID_UNIT_CONTAINER;mstrDocSelectionsImpl.prototype.gridValueFormatX=1;mstrDocSelectionsImpl.prototype.addingCtrl=null;mstrDocSelectionsImpl.MARQUEE_ORIENTATION_V=1;mstrDocSelectionsImpl.MARQUEE_ORIENTATION_H=2;mstrDocSelectionsImpl.NOBORDERS=0;mstrDocSelectionsImpl.TOPBORDER=1;mstrDocSelectionsImpl.BOTTOMBORDER=2;mstrDocSelectionsImpl.LEFTBORDER=4;mstrDocSelectionsImpl.RIGHTBORDER=8;mstrDocSelectionsImpl.ALLBORDERS=16;mstrDocSelectionsImpl.DEFAULT_LINE_COLOR="#000000";mstrDocSelectionsImpl.DEFAULT_LINE_STYLE="solid";mstrDocSelectionsImpl.DEFAULT_LINE_WIDTH="1pt";mstrDocSelectionsImpl.TCF={font:"ff",BoldItalic:["fb","fi"],fsize:"fs",TextUnderline:"ful",TextStrikeout:"fso",color:"fc",FillColor:"bgc",ShapeSettingStyle:"bs",LineSettingColor:"bc",LineSettingWeight:"bw"};mstrDocSelectionsImpl.prototype.onload=function(e){try{var pb=this.parentBone;this.docViewer=pb.parentBone;this.verifiedPath=microstrategy.getEventHandlerString(this.path);this.elem.onmousedown=new Function("e",this.verifiedPath+" { return "+this.path+".onmousedown(e); }");this.elem.onclick=new Function("e",this.verifiedPath+" { return "+this.path+".onclick(e); }");var reload=(this.firstItem()!=null);if(reload){this.onreload(e);}this.resize=new mstrResizeDocObjs();this.resize.onload(this,this.path+".resize");this.styleObj=pb.styleObj;this.initCopyBuffer();var fnB=function(b){var n=parseFloat(pb.elem.style["border"+b+"Width"]);if(isNaN(n)){return 0;}return Math.round(n*microstrategy.DPI_CONVERSION/72);};this.topBorderOffset=fnB("Top");this.leftBorderOffset=fnB("Left");var div=document.createElement("div");div.className="mstrMarquee";div.style.position="absolute";div.style.display="none";var w=document.createElement("span");w.className="mstrMarqueeWhite";div.appendChild(w);var b=document.createElement("span");b.className="mstrMarqueeBlack";div.appendChild(b);document.body.appendChild(div);this.marquee=div;this.dragRectangles=microstrategy.objectFind(pb.elem,"div",microstrategy.OBJTYPE_DSEL_MOVE_RECS);return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.onreload=function(e){try{this.clear(true);return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isFeatureAvailable=function(f){try{return this.docViewer.isFeatureAvailable(f);}catch(err){microstrategy.errors.log(err);}return true;};mstrDocSelectionsImpl.prototype.isScrollOrHyperlink=function(e,target){try{if(!target||target.onscroll!=null){return true;}var fnHref=function(tgt){return tgt.tagName.toLowerCase()=="a"&&((tgt.href!=null&&tgt.href!="")||(tgt.getAttribute("href")!=null&&tgt.getAttribute("href")!=""));};return(e.button!=2&&(fnHref(target)||fnHref(target.parentNode)));}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isTableControl=function(target){try{var bone=microstrategy.findBone(target);return bone&&bone.isTable;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.onmousedown=function(e){try{microstrategy.hidePopups(null,e);if(window.mstrButton){mstrButton.syncEditHighlight(e);}e=e||window.event;var tgt=getEventTarget(e);try{if(!tgt||!tgt.tagName){return true;}}catch(err){e.cancelBubble=true;return true;}if(this.isScrollOrHyperlink(e,tgt)){return true;}if(tgt.getAttribute(microstrategy.HTMLATTR_ID)&&tgt.getAttribute(microstrategy.HTMLATTR_ID).indexOf("MstrFlash")==0||tgt.attributes.getNamedItem("type")&&tgt.attributes.getNamedItem("type").value.indexOf("flash")>-1){return true;}if(microstrategy.subObjectType(tgt)=="shw"&&tgt.nextSibling){tgt=tgt.nextSibling;}mstrSelectionsImpl.prototype.onmousedown.call(this,e);this.mousedownScrollLeft=this.docViewer.elem.scrollLeft;this.mousedownScrollTop=this.docViewer.elem.scrollTop;this.lastMouseX=this.mousedownX;this.lastMouseY=this.mousedownY;var ancObj=microstrategy.findAncestor(tgt);if(ancObj&&ancObj.tagName.toLowerCase()=="img"){ancObj=microstrategy.findAncestor(ancObj.parentNode);}var fromTB=(microstrategy.objectType(ancObj)==microstrategy.OBJTYPE_FLOATING_TOOLBAR);var tgtBone,tgtUnit;if(ancObj){var ast=microstrategy.subObjectType(ancObj);if(fromTB){tgtUnit=microstrategy.bone(tgt.getAttribute("targetBoneId")).activeRWUnit;}else{if(ast==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL||ast==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){tgtBone=microstrategy.findRWObjectBone(tgt);if(tgtBone){tgtUnit=tgtBone.activeRWUnit;}}else{if(ast==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){tgtBone=microstrategy.findRWObjectBone(ancObj,"mstrGridRW")||microstrategy.findRWObjectBone(ancObj,"mstrReportGraphImpl");if(tgtBone){if((microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE)&&!tgtBone.boneSelected&&tgtBone.sibBoneSelected&&tgtBone.sibBoneSelected()){return true;}tgtUnit=tgtBone.activeRWUnit;}}}}}var evtM=microstrategy.eventManager;var src=evtM.getSource(e,tgtUnit);var ctxMenu=microstrategy.getContextMenuManager("RWM").getMenu("rw_context_menu");var ctxTypes=this.path+".getTypes()";var currCtrl=this.parentBone.currentControl;var isTable=src.bone&&src.bone.isTable;switch(src.type){case microstrategy.OBJTYPE_DOC_SELECTION:if(currCtrl!="cursor"){return true;}if(microstrategy.subObjectType(tgt)==microstrategy.SUBOBJTYPE_SEL_HANDLE&&currCtrl=="cursor"){if(this.getSelectedGrid()==null||(this.getPortalGridWithProperty(microstrategy.WINDOW_STATE_MAXIMIXED)==null&&this.getPortalGridWithProperty(microstrategy.WINDOW_STATE_MINIMIZED)==null)){this.objCache.activeHilite=tgt.parentNode;var cursor=tgt.className+"-resize";var p=cursor.slice(0,cursor.indexOf("-"));if(typeof (mstr)!="undefined"){this.activeHandle=p;this.parentBone.attachWinListener(this,"mousemove","onresizestart");this.parentBone.attachWinListener(this,"mouseup","onmouseup");}else{document.onmousemove=new Function("e",this.verifiedPath+" { return "+this.path+".resize.onresizestart(e, '"+p+"'); }");document.onmouseup=new Function("e",this.verifiedPath+" { return "+this.path+".onmouseup(e); }");}}break;}ctxMenu.registerTrigger(src.elem,ctxTypes);src=evtM.getSource(e,tgt.src);case microstrategy.OBJTYPE_DOC_OBJECT:if(currCtrl=="cursor"){if(src.button!=1){this.addToSelection(e.ctrlKey,src.elem);if(!fromTB&&isTable){return true;}if(bIsW3C&&microstrategy.subObjectType(src.elem)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){this.elem.style.zIndex=1;}ctxMenu.registerTrigger(document.getElementById("hilite"+src.id),ctxTypes);ctxMenu.registerTrigger(src.elem,ctxTypes);if(fromTB){ctxMenu.registerTrigger(ancObj,ctxTypes);}return false;}var link=this.getHyperLink(src);if(link!=null&&link.length>0){return false;}var isAddTarget=fromTB||(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE)||(src.subType!=microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL)||(src.subType==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL&&(ancObj==tgt||tgt.getAttribute("scriptclass")));if(isAddTarget){this.addToSelection(e.ctrlKey,src.elem);if(isTable&&!fromTB){return true;}if(!this.isLocked(src.elem)&&this.isActive()&&this.docViewer.isEditableViewModeEplus()){this.clickedSrc=src.elem;if(fromTB||src.subType!=microstrategy.SUBOBJTYPE_DOC_TEMPLATE||!(src.bone&&src.bone.isGraph)){if(typeof (mstr)!="undefined"){this.parentBone.attachWinListener(this,"mousemove","ondragstart");this.parentBone.attachWinListener(this,"mouseup","onmouseup",false);}else{document.onmousemove=new Function("e",this.verifiedPath+" { return "+this.path+".ondragstart(e); }");if(document.onmouseup==null){document.onmouseup=new Function("e",this.verifiedPath+" { return "+this.path+".onmouseup(e); }");}}}}}if(src.subType==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL||mstr.utils.ISIE9&&src.subType==microstrategy.SUBOBJTYPE_DOC_TEXT||(isTable&&fromTB)){return true;}else{e.cancelBubble=true;mstr.controllers.EventManager.notifyWindowListeners({name:"closeMenus"});return false;}}case microstrategy.OBJTYPE_DOC_SUBSECTION:this.activeSubsection=(src.type!=microstrategy.OBJTYPE_DOC_SUBSECTION)?microstrategy.findAncestor(src.elem.parentNode):evtM.getSource(e).elem;if(src.button!=1){ctxMenu.registerTrigger(this.activeSubsection,ctxTypes);}this.marqueeConstrained=this.marqueeSingleClick=false;if(mstr.behaviors.featureResolver.featAvailable(microstrategy.FEATURE_RW_EDITABLE_VIEW_MODE_EPLUS)){if(typeof (mstr)!="undefined"){this.parentBone.attachWinListener(this,"mousemove","onlassostart");this.parentBone.attachWinListener(this,"mouseup","onlassoabort");}else{document.onmousemove=new Function("e",this.verifiedPath+" { return "+this.path+".onlassostart(e); }");document.onmouseup=new Function("e",this.verifiedPath+" { return "+this.path+".onlassoabort(e); }");}}return false;break;case microstrategy.OBJTYPE_RULER:if(currCtrl=="cursor"){this.activeSubsection=null;this.marqueeConstrained=this.marqueeSingleClick=true;this.marqueeOrientation=(src.subType==microstrategy.SUBOBJTYPE_VRULER)?mstrDocSelectionsImpl.MARQUEE_ORIENTATION_V:mstrDocSelectionsImpl.MARQUEE_ORIENTATION_H;this.onlassostart(e);return false;}break;default:if(mstrGridStatic.isMouseOverScrollBar(tgt,this.mousedownX,this.mousedownY)){return true;}}return(!bIsW3C);}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.onmouseup=function(e,path){try{if(typeof (mstr)!="undefined"){this.parentBone.detachWinListener((path)?path:this,"mousemove");this.parentBone.detachWinListener((path)?path:this,"mouseup");}else{document.onmousemove=null;document.onmouseup=null;}this.hideGuidelines();}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.getSnapThreshold=function(e){try{return this.getNotUseSnap(e)?5:microstrategy.SNAP_SIZE;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.getMouseDirection=function(){try{var deltax=lMouseX-this.lastMouseX,deltay=lMouseY-this.lastMouseY;this.mouseDir={x:deltax>0?1:(deltax<0?-1:1),y:deltay>0?1:(deltay<0?-1:1)};this.lastMouseX=lMouseX;this.lastMouseY=lMouseY;return this.mouseDir;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.getSubSecBone=function(elItem){try{var subBone=null;if(elItem){if(elItem.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){subBone=microstrategy.findBone(elItem.parentNode);}else{subBone=microstrategy.findBone(elItem);}}else{var selectedSubSection=this.parentBone.parentBone.commands.queryState("selectedSection");if(selectedSubSection){subBone=microstrategy.findBone(selectedSubSection);}}return subBone;}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.syncPositionMap=function(){try{var items=this.items;for(var id in items){var item=items[id];var subBone=this.getSubSecBone(item);subBone&&subBone.syncPositionMap(item);}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.hideGuidelines=function(){try{var items=this.items;for(var id in items){var item=items[id];var subBone=this.getSubSecBone(item);subBone&&subBone.hideGuidelines();}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.onresizestart=function(e){this.parentBone.detachWinListener(this,"mousemove");this.resetObjectFormatLevel();this.docViewer.isDragging=true;return this.resize.onresizestart(e,this.activeHandle);};mstrDocSelectionsImpl.prototype.onclick=function(e){try{e=e||window.event;var tgt=getEventTarget(e);var tagName=tgt&&tgt.tagName.toLowerCase();if(tagName==="select"||tagName==="textarea"||tagName==="input"){return true;}if(this.isScrollOrHyperlink(e,tgt)){return true;}var currCtrl=this.parentBone.currentControl;var src=microstrategy.eventManager.getSource(e);switch(src.type){case microstrategy.OBJTYPE_DOC_SELECTION:if(currCtrl!="cursor"){return true;}src=microstrategy.eventManager.getSource(e,tgt.src);case microstrategy.OBJTYPE_DOC_OBJECT:if(currCtrl=="cursor"){if(src.button>1){return true;}var link=this.getHyperLink(src);if(link!=null&&link.length>0){try{if(!e.shiftKey&&this.styleObj.getAttValue(src.elem,microstrategy.HTMLATTR_NEW_WINDOW)==microstrategy.FALSE){window.location=link;}else{window.open(link);}}catch(err){if(link.length<=2082){microstrategy.errors.log(err);}else{showMessage({contents:microstrategy.descriptors.getDescriptor("4420"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});}}}return(src.subType==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL);}default:if(typeof (mstrGridStatic)!="undefined"&&mstrGridStatic.isMouseOverScrollBar(tgt,this.mousedownX,this.mousedownY)){return true;}}return(!bIsW3C);}catch(err){microstrategy.errors.log(err);return true;}};mstrDocSelectionsImpl.prototype.onnotifydrag=function(items,bone,types){this.savedZIndex=this.elem.style.zIndex;this.elem.style.zIndex=1;};mstrDocSelectionsImpl.prototype.onnotifydragend=function(bone){this.elem.style.zIndex=this.savedZIndex;};mstrDocSelectionsImpl.prototype.isLocked=function(elem){try{return this.styleObj.getAttValue(elem,microstrategy.HTMLATTR_LOCKED)==microstrategy.TRUE;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.onpanelchange=function(){try{if(!this.isActive()){return ;}if(!isInDocument(this.firstItem())){this.clear();return ;}var o=this.firstItem();if(!o||!o.parentNode){return ;}var p=microstrategy.findAncestor(o.parentNode);if(!p||!p.parentNode){return ;}var ps=microstrategy.findAncestor(p.parentNode);if(!ps||microstrategy.subObjectType(ps)!=microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){return ;}var b=microstrategy.findBone(p.parentNode).isPanelCurrent(p.getAttribute("id"));if(this.isVisible!=b){this.isVisible=b;this.elem.style.display=(b)?"block":"none";if(this.docViewer.observer){this.docViewer.delay("observer.notifyAll('onselectionchange')");}}microstrategy.eventManager.notifyOrphanBones("onbone"+((b)?"":"de")+"selected",this.getSelectedIds());}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.getHyperLink=function(src){try{if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE){return"";}var isLink=(this.styleObj.getAttValue(src.elem,microstrategy.HTMLATTR_IS_LINK)==microstrategy.TRUE);if(isLink){var link=this.styleObj.getAttValue(src.elem,microstrategy.HTMLATTR_LINK_HREFVALUE);if((link==null||link.length==0)&&microstrategy.subObjectType(src.elem)==microstrategy.SUBOBJTYPE_DOC_TEXT){var frm=decode(this.styleObj.getAttValue(src.elem,microstrategy.HTMLATTR_DSS_FORMULA));var r=frm&&frm.match(/href="([^"]+)"/i);link=r&&r[1];}return link;}}catch(err){microstrategy.errors.log(err);}return"";};mstrDocSelectionsImpl.prototype.addToSelection=function(isCtrlKey,src){try{if(microstrategy.subObjectType(src)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var gb=microstrategy.findBone(src);if(gb){gb.gridUnitFormat=microstrategy.GRID_UNIT_CONTAINER;this.gridUnitFormatX=microstrategy.GRID_UNIT_CONTAINER;if(gb.isGridInCellSelectionMode&&gb.isGridInCellSelectionMode()){gb.selections.clearAll(true);}}}if(this.isSelected(src)){if(isCtrlKey){if(typeof (mstr)!="undefined"){this.parentBone.attachWinListener(this,"mouseup","ondeselect");}else{document.onmouseup=new Function("e",this.verifiedPath+" { return "+this.path+".ondeselect(e); }");}return ;}else{this.hiliteSelected(src);}}else{if(!isCtrlKey||(this.isActive()&&this.firstObjType()==microstrategy.OBJTYPE_DOC_SUBSECTION)){this.clear(true);this.add(src);}else{if(this.isActive()){var x=this.processAddToSelections(src);if(x){this.add(x);}}else{this.add(src);}this.onpanelchange();}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.getPeerSubsection=function(pb,id){try{var b=microstrategy.findBone(pb.elem.parentNode);if(b==null||(b.type!=microstrategy.OBJTYPE_PANEL_STACK&&b.type!=microstrategy.OBJTYPE_DOC_SUBSECTION)){return null;}else{if(b.id==id){return pb;}else{return this.getPeerSubsection(b,id);}}}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.performDrill=function(link,newWindow){try{for(var item in this.items){if(newWindow){window.open(link);}else{window.location=link;}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.initEventObject=function(e,mouse){try{e=e||window.event;if(e.e){e=e.e;}if(mouse){getMouse(e);}return e;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.ondragstart=function(e){try{e=this.initEventObject(e,true);for(var item in this.items){var elem=this.items[item];var ssb=microstrategy.findBone(elem);if(ssb&&ssb.isFilterPanel){ssb.secIdBeforeDrag=elem.parentNode.parentNode.parentNode.id;}}if(this.getPortalGridWithProperty(microstrategy.WINDOW_STATE_MAXIMIXED)!=null){return ;}if(lMouseX==this.mousedownX&&lMouseY==this.mousedownY){return ;}this.docViewer.isDragging=true;this.buildDragRectangles();var pb=this.parentBone;if(typeof (mstr)!="undefined"){pb.attachWinListener(this,"mousemove","ondrag");pb.attachWinListener(this,"mouseup","ondragend");}else{document.onmousemove=new Function("e",this.verifiedPath+" { return "+this.path+".ondrag(e); }");document.onmouseup=new Function("e",this.verifiedPath+" { return "+this.path+".ondragend(e); }");}microstrategy.eventManager.onnotifydrag(this.items,pb,this.getDssTypes());pb.parentBone.turnOnRulerShade(this.range);this.bubbleMouseMoves=false;if(bIsIE6){var tgt=getEventTarget(e);if(tgt&&tgt.tagName&&(tgt.tagName.toLowerCase()=="img")){this.bubbleMouseMoves=true;this.mouseoverMask=null;}}this.ondrag(e);}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.getNotUseSnap=function(e){return(e&&e.ctrlKey)?!microstrategy.SNAP_OFF:microstrategy.SNAP_OFF;};mstrDocSelectionsImpl.prototype.ondrag=function(e){try{if(bIsIE4&&getButtonId(e)==0){this.ondragend(e);}e=this.initEventObject(e,true);var mask=getEventTarget(e);if(this.bubbleMouseMoves){var mm=this.mouseoverMask;if(mm&&(mm!=mask)&&mm.onmouseout){mm.onmouseout(e);}if(mask&&mask.onmouseover){mask.onmouseover(e);this.mouseoverMask=mask;}}var src=microstrategy.eventManager.source;var pb=this.parentBone;var dr=this.dragRectangles;var marquee=dr.firstChild;var r=this.range;var notUseSnap=this.getNotUseSnap(e);var fnResetRect=function(y){dr.style.left=0;dr.style.top=0;pb.parentBone.dragRulerShade(r.left+pb.left,y,r);};if(!mask.getAttribute||lMouseX<pb.left||lMouseX>pb.left+getObjWidth(pb.dockMask)){fnResetRect((this.isSameSubSection())?r.top+pb.top:-10000);return false;}var secId=mask.getAttribute&&mask.getAttribute(microstrategy.HTMLATTR_MASKEDOBJECT);if(secId){var sec=microstrategy.findBone(document.getElementById(secId));r.offsetSection=sec;if(bIsIE6&&sec.isDetails){var ty=","+this.getTypes().toString()+",";if(ty.contains(microstrategy.OBJTYPE_DOC_OBJECT+"."+microstrategy.SUBOBJTYPE_DOC_TEMPLATE,",")||ty.contains(microstrategy.OBJTYPE_DOC_OBJECT+"."+microstrategy.SUBOBJTYPE_DOC_PANEL_STACK,",")){pb.elem.style.cursor="not-allowed";}}}var id=mask.id||secId;var elemTop=getObjSumTop(r.offsetSection.elem);var l=lMouseX-src.mousedownX;var t=r.top+pb.top-elemTop;this.getMouseDirection();var subBone=r.offsetSection;var fnSnap2Guideline=function(dr,drPos,xy){var dir=this.mouseDir[xy],style=dr.style,cssProp=xy=="x"?"left":"top";if(subBone.canShowGuideline()){var snapOffset=subBone["guidelineOffset"+xy.toUpperCase()],snapThreshold=this.getSnapThreshold();if(Math.abs(snapOffset)<snapThreshold&&(snapOffset!=0&&(snapOffset>0&&dir<0||snapOffset<0&&dir>0))){snapOffset*=dir*(snapOffset>0&&dir<0?1:-1);snapOffset+=(notUseSnap?(dir*(snapOffset>0&&dir<0?1:-1)):0);drPos=drPos+snapOffset;style[cssProp]=drPos+"px";return ;}}var c_drPos=parseInt(style[cssProp])||0;if(dir<0&&drPos<c_drPos||dir>0&&drPos>c_drPos){style[cssProp]=drPos+"px";}};if(l!=0&&(this.isSameSubSection()||!this.hasHorizSections())){var hOffset=0;if(pb.containsHorizontalSections&&mask&&mask.getAttribute(microstrategy.HTMLATTR_POINTS_TO)){var pt=mask.getAttribute(microstrategy.HTMLATTR_POINTS_TO).split("|");var mb=pb.getSubMaskBone(pt[0],pt[1],0);if(mb&&mb.maskedBone!=null){hOffset=getObjSumLeft(mb.maskedBone.elem)-pb.left;}}if(l<-r.left+this.leftBorderOffset){l=-r.left+this.leftBorderOffset;}else{l=microstrategy.snapCoordinate(l+(r.left+this.leftBorderOffset-hOffset),0,!notUseSnap);}l=Math.max(l,0);var newDrLeft=l-(r.left+this.leftBorderOffset-hOffset);fnSnap2Guideline.call(this,dr,newDrLeft,"x");}else{l=r.left+pb.left-getObjSumLeft(r.offsetSection.elem);}if((lMouseY-src.mousedownY)!=0&&(this.isSameSubSection()||this.hasHorizSections(true))){t=(lMouseY-src.mousedownY);if(lMouseY<pb.top||lMouseY>pb.top+getObjHeight(pb.dockMask)){fnResetRect(r.top+pb.top);return false;}if(t<-r.top){t=-r.top;}else{t=microstrategy.snapCoordinate((r.top+t-(elemTop-pb.top)),0,!notUseSnap);}t=Math.max(t,0);var newDrTop=t-(r.top-(elemTop-pb.top));fnSnap2Guideline.call(this,dr,newDrTop,"y");}pb.parentBone.dragRulerShade(l+pb.left,t+elemTop,r);subBone.showGuidelines(subBone.getLocalPosition(dr.firstChild));}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.ondragend=function(e){try{e=this.initEventObject(e,true);this.onmouseup(e);var pb=this.parentBone;pb.elem.style.cursor="default";var src=getEventTarget(e);var bone=microstrategy.boneForMask(microstrategy.findAncestor(src));if(bone){var bt=bone.elem.getAttribute(microstrategy.HTMLATTR_OBJTYPE);if(bt==microstrategy.OBJTYPE_OBJBROWSER){pb.promptDeleteItems(this.items,true);}else{if(bt==microstrategy.OBJTYPE_DOC_SUBSECTION){if(bone.isFilterPanel){this.moveItemsToFP(src);}else{this.moveItems(src);}}}}else{if(bIsW3C&&!bIsIE4){var mask=pb.getMaskFromPoint(lMouseX,lMouseY);if(mask!=null){this.moveItems(mask.firstChild);}else{if(microstrategy.isObjectBrowserOpen()){bone=microstrategy.getObjectBrowser();if(bone!=null){if(microstrategy.doRectsIntersect(new Rect(lMouseY,lMouseX+1,lMouseY+1,lMouseX),microstrategy.getRect(bone.elem))){pb.promptDeleteItems(this.items,true);}}}}}}var dr=this.dragRectangles;dr.style.zIndex=-1;mstr.$D.clearChilds(dr);dr.style.left=0;dr.style.top=0;this.onmoveend();microstrategy.eventManager.notifyOrphanBones("onnotifydragend",pb);for(var item in this.items){var elem=this.items[item];var ssb=microstrategy.findBone(elem);if(ssb&&ssb.isFilterPanel){var secIdAfterDrag=elem.parentNode.parentNode.parentNode.id;if(secIdAfterDrag!=ssb.secIdBeforeDrag){var docMaskCollection=pb.docMaskCollection;var childNodes=ssb.panels;for(var node in childNodes){var subId=childNodes[node].id;if(docMaskCollection[ssb.secIdBeforeDrag]&&docMaskCollection[ssb.secIdBeforeDrag][subId]){if(!docMaskCollection[secIdAfterDrag]){docMaskCollection[secIdAfterDrag]={};}docMaskCollection[secIdAfterDrag][subId]=docMaskCollection[ssb.secIdBeforeDrag][subId];delete docMaskCollection[ssb.secIdBeforeDrag][subId];}}}}}this.docViewer.isDragging=false;this.syncPositionMap(this.items);}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.hiliteLine=function(hi,src,bs){try{hi.style.border="0";hi.style["border"+((this.styleObj.getAttValue(src,microstrategy.HTMLATTR_ORIENTATION)==microstrategy.ORIENTATION_VERTICAL)?"Left":"Top")]=bs;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.toggleHiliteBorders=function(isDashed){try{var b=0;var offset=-2;if(isDashed){b=1;offset=2;}b+="px dashed #000000";for(var id in this.hilites){var hl=this.hilites[id].getDefault();if(microstrategy.subObjectType(hl.src)==microstrategy.SUBOBJTYPE_DOC_LINE){this.hiliteLine(hl,hl.src,b);}else{hl.style.border=b;hl.style.width=Math.max(1,parseInt(hl.style.width)-offset)+"px";hl.style.height=Math.max(1,parseInt(hl.style.height)-offset)+"px";hl.style.visibility=isDashed?"visible":"";this.hilites[id].syncHandles(isDashed);}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.buildDragRectangles=function(){try{var fn=function(x){return parseInt(hl.getAttribute("o"+x)||0,10);};var cls="mstrMarquee";for(var id in this.hilites){var hl=this.hilites[id].getDefault();if(hl){var src=hl.src;if(this.isLocked(src)){continue;}var o=document.createElement("div");o.className=cls;o.style.left=hl.style.left;o.style.top=hl.style.top;var w=document.createElement("span");w.className=cls+"White";o.appendChild(w);var b=document.createElement("span");b.className=cls+"Black";o.appendChild(b);this.resizeMarquee(o,fn("Height"),fn("Width"));this.dragRectangles.appendChild(o);}}this.dragRectangles.style.zIndex=50;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.onmoveend=function(){if(this.docViewer.rulerShadeOn){this.docViewer.turnOffRulerShade();}};mstrDocSelectionsImpl.prototype.onlassoabort=function(e){try{e=this.initEventObject(e,true);this.onmouseup(e);if(this.parentBone.currentControl!="cursor"){var me=this,pb=this.parentBone,addC=function(){if(pb.currentControl!="cursor"){me.addCtrl(new Rect(lMouseY-2,null,null,lMouseX-2),(e.ctrlKey)?!microstrategy.SNAP_OFF:microstrategy.SNAP_OFF);}};if((!window.mstrmojo||!mstrmojo.platform.TableControl)&&pb.currentControl==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK&&pb.currentControlSubtype=="TC"){microstrategy.mojoLoader.loadWidget({bundle:"mojo-tc.js",callback:function(){addC();}});}else{addC();}}else{var pe=microstrategy.findAncestor(this.activeSubsection.parentNode);var ty=pe.getAttribute(microstrategy.HTMLATTR_OBJTYPE);if(ty==microstrategy.OBJTYPE_DOC_SUBSECTION_CONTAINER){this.addSubSection(this.activeSubsection);}else{if(ty==microstrategy.OBJTYPE_DOC_OBJECT){var tb=microstrategy.getRegisteredAncestor(pe);if(tb.activeRWUnit){pe=tb.activeRWUnit;}this.addToSelection(e.ctrlKey,pe);}}}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.constrainMarquee=function(rect){try{var el=this.docViewer.elem;if(this.marqueeOrientation==mstrDocSelectionsImpl.MARQUEE_ORIENTATION_V){rect.left=getObjSumLeftScrolled(el);rect.right=rect.top+getObjWidth(el);}else{rect.top=getObjSumTopScrolled(el);rect.bottom=rect.top+getObjHeight(el);}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.onlassostart=function(e){try{e=this.initEventObject(e,true);var x=this.mousedownX;var y=this.mousedownY;if(!this.marqueeConstrained&&Math.abs(lMouseX-x)<=3&Math.abs(lMouseY-y)<=3){return false;}var h=1,w=1;if(this.marqueeConstrained){var range=new Rect(y,x+w,y+h,x);this.constrainMarquee(range);x=range.left;y=range.top;w=range.right-x;h=range.bottom-y;this.docViewer.turnOnRulerShade(range);}this.resizeMarquee(this.marquee,h,w);this.marquee.style.left=x+"px";this.marquee.style.top=y+"px";this.marquee.style.visibility="hidden";this.marquee.style.display="block";if(typeof (mstr)!="undefined"){this.parentBone.attachWinListener(this,"mousemove","onlasso");this.parentBone.attachWinListener(this,"mouseup","onlassoend");}else{document.onmousemove=new Function("e",'return microstrategy.bone("'+this.docViewer.id+'").doc.selections.onlasso(e);');document.onmouseup=new Function("e",'return microstrategy.bone("'+this.docViewer.id+'").doc.selections.onlassoend(e);');}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.onlassomarquee=function(e){try{var mq=this.marquee;mq.style.visibility="visible";var x=lMouseX;var y=lMouseY;var left=this.mousedownX;var top=this.mousedownY;var oX=left;var oY=top;var h=y-top;var w=x-left;if(w<0){left=x;w=Math.abs(w);}if(h<0){top=y;h=Math.abs(h);}var ctrl=this.parentBone.currentControl;if(this.marqueeConstrained){var range=new Rect(top,left+w,top+h,left);this.constrainMarquee(range);left=range.left;top=range.top;w=range.right-left;h=range.bottom-top;this.docViewer.dragRulerShade(range.left,range.top,range);this.marqueeSingleClick=false;}else{if(ctrl==microstrategy.SUBOBJTYPE_DOC_LINE){mq.style.border="";if(w>=h){top=oY;h=1;}else{left=oX;w=1;}}}var that=this;var fnLm=function(n){return window["getObjSum"+n](that.activeSubsection)-that.docViewer.elem["scroll"+n];};if(ctrl!="cursor"){var limitTop=fnLm("Top");if(top<limitTop){h=Math.max(h-limitTop+top,1);top=limitTop;}var limitLeft=fnLm("Left");if(left<limitLeft){w=Math.max(w-limitLeft+left,1);left=limitLeft;}}mq.style.left=left+"px";mq.style.top=top+"px";this.resizeMarquee(mq,h,w);}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.onlasso=function(e){try{e=this.initEventObject(e,true);this.onlassomarquee(e);if(typeof (mstr)!="undefined"){this.parentBone.attachWinListener(this,"mouseup","onlassoend");}else{document.onmouseup=new Function("e","return microstrategy.bone('"+this.docViewer.id+"').doc.selections.onlassoend(e);");}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.onlassoend=function(e){try{e=this.initEventObject(e,true);this.onmouseup(e);if(mstr.utils.ISIE8&&this.marquee.style.height=="1px"&&this.marquee.style.width=="1px"){this.onlassomarquee(e);}if(this.marqueeConstrained){this.docViewer.turnOffRulerShade();}var rect=this.getOuterRect(this.marquee),pb=this.parentBone;if(pb.currentControl!="cursor"){var me=this,addC=function(){me.addCtrl(rect,me.getNotUseSnap(e));me.marquee.style.display="none";};if((!window.mstrmojo||!mstrmojo.platform.TableControl)&&pb.currentControl==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK&&pb.currentControlSubtype=="TC"){microstrategy.mojoLoader.loadWidget({bundle:"mojo-tc.js",callback:addC});}else{addC();}}else{if(!e.ctrlKey){this.clear();}var objs=[];var fnCompare=microstrategy[(this.marqueeSingleClick||microstrategy.MARQUEE_STYLE==microstrategy.MARQUEE_STYLE_PARTIAL)?"doRectsIntersect":"isRectInRect"];var activeBone=microstrategy.findBone(this.activeSubsection);var isActivePanel=(activeBone&&activeBone.subsectionType==mstrSubSection.TYPE_PANEL);var itemBone=(this.isActive()&&microstrategy.findBone(this.firstItem().parentNode));if(itemBone&&itemBone.subsectionType==mstrSubSection.TYPE_PANEL){itemBone.marqueeSelect(objs,rect,fnCompare);}else{if(isActivePanel&&(!this.isActive()||this.firstItem().getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_SUBSECTION)){activeBone.marqueeSelect(objs,rect,fnCompare);}else{var secs=this.parentBone.sections;for(var s in secs){for(var sub in secs[s].subsections){var ss=secs[s].subsections[sub];if(ss.subsectionType==mstrSubSection.TYPE_FIXED){ss.marqueeSelect(objs,rect,fnCompare);}}}}}if(objs.length>0){for(var i=0;i<objs.length;i++){this[(e.ctrlKey&&this.isSelected(objs[i]))?"remove":"add"](objs[i]);}}else{if(!this.marqueeConstrained&&!this.isActive()&&!isActivePanel){this.addSubSection(this.activeSubsection);}}this.marquee.style.display="none";}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.addCtrl=function(rect,notUseSnap){var switchToGraph=(this.parentBone.currentControl==microstrategy.GRAPH_CTL);var pb=this.parentBone;var um=microstrategy.updateManager;var ac;var isThemeApplied=microstrategy.hasAppliedTheme(this.activeSubsection),curCtrl=this.parentBone.currentControl,isField=(curCtrl==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER||curCtrl==microstrategy.SUBOBJTYPE_DOC_TEXT||curCtrl==microstrategy.SUBOBJTYPE_DOC_IMAGE||curCtrl==microstrategy.SUBOBJTYPE_DOC_LINE||curCtrl==microstrategy.SUBOBJTYPE_DOC_SHAPE||microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND);if(!isThemeApplied&&isField){var fgKey=this.activeSubsection&&this.activeSubsection.getAttribute("fgKey");if(fgKey&&pb.formattingAttributes[fgKey]&&pb.formattingAttributes[fgKey]["thmid"]){isThemeApplied=true;}}this.flush=switchToGraph||(curCtrl==microstrategy.SUBOBJTYPE_DOC_TEMPLATE&&microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE)||isThemeApplied||(curCtrl==microstrategy.SUBOBJTYPE_DOC_IMAGE);var bone=microstrategy.findBone(this.activeSubsection);if(bone&&bone.isFilterPanel){ac=pb.addCtrl(null,this.activeSubsection,[],null,null,null,true);}else{ac=pb.addCtrl(rect,this.activeSubsection,[],null,null,null,notUseSnap);}if(ac){ac=this.finishAdd(this.activeSubsection.lastChild,ac);if(ac.length>0){um.add(ac);}if(switchToGraph||isThemeApplied||curCtrl==microstrategy.SUBOBJTYPE_DOC_IMAGE){um.add([um.createActionObject(pb.elem,mstrUpdateManager.APPLY_CHANGES,pb.parentBone.beanPath,[],[],[])]);}if(this.flush){um.flushAndSubmitChanges();this.flush=false;}}};mstrDocSelectionsImpl.prototype.getActiveSectionIndex=function(selection){try{var sec=microstrategy.findAncestorWithAtt(selection,"scriptclass","mstrFixedPanel");var sn=sec&&sec.getAttribute("sn");if(sn){return sn;}}catch(err){microstrategy.errors.log(err);}return null;};mstrDocSelectionsImpl.prototype.resizeMarquee=function(mq,h,w){try{mq.style.height=h+"px";mq.style.width=w+"px";var fn=function(d,x){mq.childNodes[i].style[d]=(Math.max(x-3,1))+"px";};for(var i=0;i<2;i++){fn("height",h);fn("width",w);}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.sizeToGrid=function(){try{var ac=[];var um=microstrategy.updateManager;var flush=false;var pb=this.parentBone;var fn=function(x,y){return microstrategy.snapCoordinate(x,y,true);};for(var id in this.items){var item=this.items[id];if(this.isLocked(item)){continue;}var rect=new RectObj(item);var t=getObjSumTop(item.parentNode)-pb.top;rect.setBase(pb.left+this.leftBorderOffset,pb.top);rect.left=fn(rect.left,0);rect.top=fn(rect.top,t);rect.right=fn(rect.right,0);rect.bottom=fn(rect.bottom,t);rect.height=rect.bottom-rect.top;rect.width=rect.right-rect.left;if(this.resize.resizeItem(item,rect,ac,microstrategy.WIDTH_AND_HEIGHT_UPDATE)){flush=true;}}this.resizeSubSection(false,ac);this.resetRange(false,ac);if(ac&&ac.length>0){um.add(ac);if(flush){um.flushAndSubmitChanges();}}this.syncUp();return true;}catch(err){microstrategy.errors.log(err);return true;}};mstrDocSelectionsImpl.prototype.getEmptyCopyBuffer=function(){return{items:{},parentIds:{},offsets:{},length:0};};mstrDocSelectionsImpl.prototype.initCopyBuffer=function(){try{var cb=document.getElementById("clipboard");if(cb){var buf=this.getEmptyCopyBuffer();eval("buf.offsets = "+cb.getAttribute("offset"));for(var sec in buf.offsets){buf.offsets[sec]=parseInt(buf.offsets[sec])*microstrategy.SNAP_SIZE;}eval("buf.parentIds = "+cb.getAttribute("pk"));for(var i=0,cnt=cb.childNodes.length;i<cnt;i++){var c=cb.childNodes[i];buf.items[c.getAttribute("id")]=c.cloneNode(true);buf.length++;}this.objCache.copyBuffer=buf;}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.copyToClipboard=function(items){try{var r="";if(this.isActive()&&this.firstObjType()==microstrategy.OBJTYPE_DOC_OBJECT){var buf=this.getEmptyCopyBuffer();var delim="";for(var id in items){r+=delim+id;var node=items[id].cloneNode(true);if(node.getAttribute("trx")==="1"){var cssClass=node.getAttribute("class");node.setAttribute("class",cssClass.replace(/txttrx /,""));mstr.$A.forEach(["trx","trxsid","trxctlkey","trxn","trxdfm"],function(att){node.removeAttribute(att);});}buf.items[id]=node;buf.parentIds[id]=items[id].parentNode.getAttribute("id");buf.length++;delim=CLIPBOARD_ITEM_SEPARATOR;}this.objCache.copyBuffer=buf;var ob=this.docViewer.observer;if(ob){ob.notifyAll("onaddtoclipboard");}}return r;}catch(err){microstrategy.errors.log(err);}return"";};mstrDocSelectionsImpl.prototype.duplicate=function(){try{if(this.atLeastOneTableSelected()){showMessage({contents:microstrategy.descriptors.getDescriptor("11179"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return false;}if(!this.duplicatePanelStacks()){var c=(this.copy()==false);if(c){return this.paste();}}return false;}catch(err){microstrategy.errors.log(err);return true;}};mstrDocSelectionsImpl.prototype.duplicatePanelStacks=function(){try{var ty=this.getTypes();var m=ty.join(",").match(new RegExp("("+microstrategy.OBJTYPE_DOC_OBJECT+"."+microstrategy.SUBOBJTYPE_DOC_PANEL_STACK+")","g"));if(!m){return false;}if(m.length!=ty.length){showMessage({contents:microstrategy.descriptors.getDescriptor("7763"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});}else{var keys=this.getSelectedIds().split("|").join(CLIPBOARD_ITEM_SEPARATOR);var um=microstrategy.updateManager;um.add([um.createActionObject(null,mstrUpdateManager.DUPLICATE_PANEL_STACK,this.docViewer.beanPath,["2048012","2048171"],[keys,microstrategy.getFormatObject().encodeValue("top",microstrategy.SNAP_SIZE)])]);um.flushAndSubmitChanges();if(microstrategy.getViewerBone().autoWire){for(id in this.sections){var sec=document.getElementById(id);var bone=microstrategy.findBone(sec);this.docViewer.dirtySections.push({bone:bone,isTarget:true});}}}}catch(err){microstrategy.errors.log(err);}return true;};mstrDocSelectionsImpl.prototype.copy=function(){try{var keys=this.copyToClipboard(this.items);if(keys.length>0){var um=microstrategy.updateManager;microstrategy.updateManager.add([um.createActionObject(null,mstrUpdateManager.COPY_TO_CLIPBOARD,this.docViewer.beanPath,["2048012"],[keys],[],null)]);return false;}}catch(err){microstrategy.errors.log(err);}return true;};mstrDocSelectionsImpl.prototype.cut=function(){try{var c=(this.copy()==false);if(c){this.parentBone.deleteItems(this.items,true);}return false;}catch(err){microstrategy.errors.log(err);}return true;};mstrDocSelectionsImpl.prototype.paste=function(){try{var buffer=this.objCache.copyBuffer;if(!buffer){return true;}var so=this.styleObj;var id;var newSection=null;var sameSection=true;var diffOrgSection=false;var isSec=false;switch(this.firstObjType()){case microstrategy.OBJTYPE_DOC_SUBSECTION:newSection=this.firstItem();isSec=true;break;case microstrategy.OBJTYPE_DOC_OBJECT:if(this.isSameSubSection()){isSec=true;if(this.isOnlyOnePanelStackSelected()){newSection=microstrategy.findBone(this.getSelectedPanelStack()).getCurrentPanel().elem;}else{for(id in this.sections){newSection=document.getElementById(id);break;}}}break;default:return false;}if(isSec){var oldSection=prevSection=null;for(id in buffer.items){oldSection=document.getElementById(buffer.parentIds[id]);if(prevSection&&oldSection&&(prevSection.getAttribute("id")!=oldSection.getAttribute("id"))){diffOrgSection=true;break;}prevSection=oldSection;}sameSection=(diffOrgSection||(oldSection!=null&&oldSection.getAttribute("id")==newSection.getAttribute("id")));}var fnTypes=function(items){var t=[];for(id in items){t.push(microstrategy.subObjectType(items[id]));}return t;};var types=fnTypes(buffer.items).join(",");var fnMatch=function(s){return !!types.match("("+microstrategy["SUBOBJTYPE_DOC_"+s]+")");};var tmpPaste=fnMatch("TEMPLATE");var ctrlPaste=fnMatch("SELECTOR_CONTROL");var psPaste=fnMatch("PANEL_STACK");if(!sameSection&&newSection.getAttribute(microstrategy.HTMLATTR_DETAILS_SECTION)=="-1"){if(tmpPaste||ctrlPaste||psPaste){var psContents="*Sorry, but this paste operation is being canceled because you cannot paste a panel stack into the details section.*";showMessage({contents:psPaste?psContents:microstrategy.descriptors.getDescriptor((tmpPaste)?"2945":"4992"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return false;}}var sb=microstrategy.findBone(newSection);if(sb&&sb.isFilterPanel&&!ctrlPaste){showMessage({contents:"*This paste operation is being cancelled because you cannot paste a node other than selector to the Filter Panel.*",elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return ;}this.clear();var keys="";var ca={elements:[],parents:[]};var updatedSecIds={};var updatedSecElem={};var bWire={control:false,target:false};for(var item in buffer.items){var cItem=buffer.items[item];var node=cItem.cloneNode(true);var st=microstrategy.subObjectType(node);var subSec=((sameSection&&newSection)||!isSec)?document.getElementById(buffer.parentIds[item]):newSection;if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE&&st==microstrategy.SUBOBJTYPE_DOC_TEXT){var frm=so.getAttValue(cItem,microstrategy.HTMLATTR_DSS_FORMULA);if(frm!=null){this.parentBone.updateSingleTextField(node,frm);}}var subSecId=subSec.getAttribute("id");if(!sameSection){subSec=newSection;if(buffer.offsets[subSecId]==null){buffer.offsets[subSecId]=0;}}else{subSec=document.getElementById(buffer.parentIds[item]);if(buffer.offsets[subSecId]==null){buffer.offsets[subSecId]=microstrategy.SNAP_SIZE;}}moveObjTo(node,parseInt(so.getValue(node,"left"))+buffer.offsets[subSecId],parseInt(so.getValue(node,"top"))+buffer.offsets[subSecId]);node=this.parentBone.addItemsToSubsection(subSec,node,true,cItem,microstrategy.findBone(microstrategy.findBone(newSection)));updatedSecIds[subSecId]=true;if(!updatedSecElem[subSecId]){updatedSecElem[subSecId]={};}updatedSecElem[subSecId].elem=subSec;if(st==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){bWire.control=true;updatedSecElem[subSecId].isTarget=false;}else{if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE||st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){bWire.target=true;updatedSecElem[subSecId].isTarget=true;}}so.cloneAttValues(cItem,node);if(so.getAttValue(node,microstrategy.HTMLATTR_DROP_SHADOW_EFFECT)!="0"&&st!=microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){so.applyShadow(node,"dropShadowEffect","1");}id=node.getAttribute("id");var targetAtts=this.parentBone.formattingAttributes[id];targetAtts[microstrategy.HTMLATTR_NAME]=this.parentBone.getDefaultNameOfObject(node);var fnGrid=function(n){return microstrategy.findBone(microstrategy.subObjectFind(n,"div",microstrategy.SUBOBJTYPE_GRID_TABLE));};if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var tgtBone=fnGrid(node);var srcBone=fnGrid(cItem);if(tgtBone&&srcBone){tgtBone.copyBoneProperties(srcBone);}}this.add(node);ca.parents.push(subSec);ca.elements.push(node);keys+=CLIPBOARD_ITEM_SEPARATOR+id;}if(keys.length>0){var um=microstrategy.updateManager;var sID=subSec.getAttribute("id");var xy=mstrFormatObject.encodeValue("top",buffer.offsets[sID]);var ac=[um.createActionObject(null,mstrUpdateManager.PASTE_FROM_CLIPBOARD,this.parentBone.parentBone.beanPath,["2048066","2048007","2048010","2048011","2048018","2048241"],[keys.substr(1),sID,xy,xy,mstrUpdateManager.UPDATE_LATER,"true"],[],ca)];this.resizeSubSection(false,ac);um.add(ac);if(newSection){for(var item in this.items){var node=this.items[item];var st=microstrategy.subObjectType(node);if(st==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){this.enforceTitleBar(newSection,node);}}}if((bWire.control||bWire.target)&&microstrategy.getViewerBone().autoWire){for(id in updatedSecElem){subSecBone=microstrategy.findBone(updatedSecElem[id].elem);this.docViewer.dirtySections.push({bone:subSecBone,isTarget:updatedSecElem[subSecId].isTarget});}}var imgPaste=fnMatch("IMAGE");if(imgPaste){um.add([um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,this.parentBone.parentBone.beanPath,[],[],[])]);}if(tmpPaste||ctrlPaste||psPaste||imgPaste){um.flushAndSubmitChanges();}}for(var i in updatedSecIds){buffer.offsets[i]=parseInt(buffer.offsets[i])+microstrategy.SNAP_SIZE;}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.isSameSubSection=function(){try{var i=0;for(var sec in this.sections){i++;if(i>1){break;}}return(i<2);}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.hasHorizSections=function(exclusive){try{if(this.parentBone.containsHorizontalSections){for(var id in this.sections){var b=microstrategy.findBone(document.getElementById(id));var bH=!!(b&&b.isHorizontal);if(exclusive&&!bH){return false;}if(!exclusive&&bH){return true;}}}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.addIdToSection=function(secId,objId){try{var o=this.sections[secId]||{};o[objId]=true;this.sections[secId]=o;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.syncUp=function(objs){try{var o;if(objs){o={};o[objs.id||"_k"]=objs;}objs=o||this.items;for(var id in objs){var h=this.hilites[objs[id].getAttribute("id")];h&&h.syncHilites(this);}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.canNudge=function(){if(this.isSameSubSection()){return true;}for(var id in this.sections){var b=microstrategy.findBone(document.getElementById(id));if(b.subsectionType!=mstrSubSection.TYPE_FIXED){return false;}}return true;};mstrDocSelectionsImpl.prototype.nudge=function(keyCode,isNotConstrained){try{if(!this.isActive()||this.firstObjType()!=microstrategy.OBJTYPE_DOC_OBJECT){return true;}if(!this.canNudge()){return false;}var ppb=this.parentBone.parentBone;ppb.turnOnRulerShade(this.range);var isVert=(keyCode%2==0);if(!this.isSameSubSection()&&(isVert||this.hasHorizSections())){return false;}if(this.getPortalGridWithProperty(microstrategy.WINDOW_STATE_MAXIMIXED)!=null){return false;}var so=this.styleObj;var um=microstrategy.updateManager;var ac=[];var ca={acrossSections:false};var prop=(isVert)?"top":"left";var offset=(isNotConstrained)?1:microstrategy.SNAP_SIZE;var direction=microstrategy.SNAP_DIRET_POS;if(keyCode<39){offset=-offset;direction=microstrategy.SNAP_DIRET_NEG;}var rangeEl=this.range.offsetSection.elem;var secTop=getObjSumTop(rangeEl);var yRange=secTop+this.range.top-(secTop-this.parentBone.top);var xRange=getObjSumLeft(rangeEl)+this.range.left-this.leftBorderOffset;ppb.dragRulerShade(xRange,yRange,this.range);var that=this;var fnME=function(){window.setTimeout(that.path+".onmoveend()",0);};var fnBD=function(v,d,x){return(v&&(that.range[d]<=(x-that.parentBone[d])));};if(offset<0&&(fnBD(isVert,"top",secTop)||fnBD(!isVert,"left",getObjSumLeft(this.firstItem().parentNode)))){fnME();return false;}var x=(isVert)?yRange:xRange;if(!isNotConstrained){if(!microstrategy.isSnapped(x,rangeEl,isVert)){offset=0;}}var orgX=x;x=this.parentBone.getNewPosition(x+offset,rangeEl,isVert,!isNotConstrained,direction);var hsa=0;var subBone=microstrategy.findBone(this.firstItem().parentNode);if(subBone&&subBone.isHorizontal&&!isVert){hsa=getObjSumLeft(this.firstItem().parentNode)-getObjSumLeft(this.range.offsetLeftSection.elem);}var deltaX=x-orgX-hsa;var fnEnc=function(d,x){if(x==null){x=parseInt(so.getValue(that.items[item],d),10);}return mstrFormatObject.encodeValue(d,x);};for(var item in this.items){if(this.isLocked(this.items[item])){continue;}var id=this.items[item].getAttribute("id");var base=[mstrUpdateManager.UPDATE_LATER,id,this.items[item].parentNode.getAttribute("id")];x=window["getObjSum"+((isVert)?"Top":"Left")](this.items[item])+deltaX;if(!this.getNotUseSnap()&&!isNotConstrained&&subBone.canShowGuideline()){var guidelineSnapOffset=isVert?subBone.guidelineOffsetY:subBone.guidelineOffsetX;if(Math.abs(guidelineSnapOffset)<microstrategy.SNAP_SIZE&&(guidelineSnapOffset!=0&&(guidelineSnapOffset>0&&direction<0||guidelineSnapOffset<0&&direction>0))){x=x-(guidelineSnapOffset!=0?direction*(microstrategy.SNAP_SIZE-Math.abs(guidelineSnapOffset)):0);}}x=(!isVert&&x<0)?0:x;if(so.getValue(this.items[item],prop)!=x+"px"){ac.push(um.createActionObject(this.items[item],mstrUpdateManager.MOVE_OBJECT,ppb.beanPath,["2048018","2048012","2048007","2048010","2048011"],base.concat([fnEnc("top",(isVert)?x:null),fnEnc("left",(isVert)?null:x)]),base.concat([fnEnc("top",null),fnEnc("left",null)]),ca));var objs=document.getElementsByName(id);for(var i=0,cnt=objs.length;i<cnt;i++){objs[i].style[prop]=x+"px";}}}this.resizeSubSection(false,ac);this.resetRange(false,ac);if(ac.length>0){um.add(ac);}this.syncUp();fnME();microstrategy.eventManager.notifyOrphanBones("onboneaftermove",this.getSelectedIds());if(subBone&&subBone.guidelineEnabled){this.syncPositionMap(this.items);subBone.showGuidelines(subBone.getLocalPosition(this.firstItem()));window.setTimeout(function(){subBone.hideGuidelines();},500);}return false;}catch(err){microstrategy.errors.log(err);}return true;};mstrDocSelectionsImpl.prototype.reselect=function(objIds){try{var ids=objIds.split(",");for(var i=0;i<ids.length;i++){var obj=document.getElementById(ids[i]);if(obj){var ty=obj.getAttribute(microstrategy.HTMLATTR_OBJTYPE);if(ty==microstrategy.OBJTYPE_DOC_OBJECT){var st=microstrategy.subObjectType(obj);if(st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var gb=microstrategy.findBone(obj);if(gb&&gb.selections&&gb.selections.hasHilitedCells()){continue;}}this.add(obj);}else{if(ty==microstrategy.OBJTYPE_DOC_SUBSECTION){this.addSubSection(obj);}}}}microstrategy.eventManager.notifyOrphanBones("onboneselected",this.getSelectedIds());}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.add=function(o,noHilite,noNotify){try{if(!o){return false;}var pb=this.parentBone;pb.syncPosition();var id=o.getAttribute("id");var obj=document.getElementById(id);if(!obj){return false;}var st=microstrategy.subObjectType(o);var gb;if(o.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT&&st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){gb=microstrategy.findBone(o);if(!gb){return false;}}var changed=false;if(typeof (this.items[id])=="undefined"){this.items[id]=o;this.hilites[id]=new mstrDocHilite(this);this.addIdToSection(obj.parentNode.getAttribute("id"),id);this.notifySelectedBone(o,true);changed=true;this.length++;}if(this.length>1&&this.isSingleSelectionType){this.isSingleSelectionType=(microstrategy.subObjectType(this.firstItem())==o.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE));}this.updateRange(o);if(!this.objCache.hiLite||!this.objCache.lineHiLite){var img=document.createElement("img");img.setAttribute(microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_SEL_HANDLE);var div=document.createElement("div");div.className="mstrDocHilites";var cursors=["nw","n","ne","w","e","sw","s","se"];for(var i=0;i<8;i++){var t=img.cloneNode(true);t.className=cursors[i];div.appendChild(t);}this.objCache.hiLite=div;var lineDiv=document.createElement("div");lineDiv.className="mstrDocHilites";img.className="w";lineDiv.appendChild(img.cloneNode(false));img.className="e";lineDiv.appendChild(img.cloneNode(false));this.objCache.lineHiLite=lineDiv;}this.setPanelStackSelectionHandleEvents(o);this.setGridSelectionHandleEvents(o);if(gb){if(gb.isGridInCellSelectionMode&&gb.isGridInCellSelectionMode()){gb.selections.clearAll(true);}this.verifyFormatLevels("color");}else{if(st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){this.setObjectFormatLevel("Panels",this.resolvePanelsFormat(0,0));}else{if(st==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){this.setObjectFormatLevel("Control",this.resolveControlFormat(0,0));}else{microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;}}}if(typeof (noHilite)=="undefined"||noHilite==false){this.addHilites(o);}if(typeof (noNotify)=="undefined"||noNotify==false){if(changed&&pb.parentBone.observer){pb.parentBone.delay("observer.notifyAll('onselectionchange')");}pb.onselectionchange(id);}var subBone=microstrategy.findBone(obj.parentNode);if(subBone){subBone.updatePositionMap(obj);subBone.hideGuidelines();}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.addHilites=function(o){try{var id=o.getAttribute("id");var obj=document.getElementById(id);var local=this.objCache[(microstrategy.subObjectType(o)==microstrategy.SUBOBJTYPE_DOC_LINE)?"lineHiLite":"hiLite"];local.setAttribute("id","hilite"+id);var clone=local.cloneNode(true);if(this.isLocked(o)){clone.className="mstrDocHilites mstrLockedHilites";}clone.src=o;clone.ondblclick=new Function("e","microstrategy.bone('"+this.parentBone.parentBone.id+"').doc.editObj(e, this.src);");var hId=this.hilites[id].items.push(clone)-1;this.hilites[id].base=hId;if(this.docViewer.isEditableViewModeEplus()){this.elem.appendChild(this.hilites[id].items[hId]);this.elem.style.zIndex=this.parentBone.commands.exec("maxZIndex")+1;this.syncUp(obj);this.hiliteElements(o);}this.elem.style.display="block";var pb=microstrategy.findBone(obj.parentNode);if(pb&&pb.subsectionType==mstrSubSection.TYPE_PANEL){this.elem.style.display=pb.elem.style.display;}this.isVisible=true;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.notifySelectedBone=function(tgt,sel){try{var fn=function(cls){return microstrategy.findRWObjectBone(tgt,cls);};var b;var anc=microstrategy.findAncestor(tgt);if(anc&&microstrategy.subObjectType(anc)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){b=fn("mstrGridRW")||fn("mstrReportGraphImpl");}else{if(anc&&microstrategy.subObjectType(anc)==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){b=fn("mstrRWControlImpl");}else{b=fn();}}if(b){if(sel){b.onboneselected(null,this.getActiveSectionIndex(tgt));}else{b.onbonedeselected();}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.addSubSection=function(obj){try{var ss=microstrategy.findBone(obj);if(!ss){return ;}this.clear();var id=obj.getAttribute("id");var obj=document.getElementById(id);if(typeof (this.items[id])=="undefined"){this.items[id]=obj;this.addIdToSection(obj.parentNode.getAttribute("id"),id);this.length++;}var pb=this.parentBone;if(pb.parentBone.observer){pb.parentBone.delay("observer.notifyAll('onselectionchange')");}pb.onselectionchange(id);}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.remove=function(obj,delayRangeReset){try{var id=obj.getAttribute("id");obj=document.getElementById(id);this.removePanelStackSelectionHandleEvents(obj);this.removeGridSelectionHandleEvents(obj);if(typeof (this.hilites[id])!="undefined"){for(var i=0,cnt=this.hilites[id].items.length;i<cnt;i++){if(this.elem.hasChildNodes()){this.elem.removeChild(this.hilites[id].items[i]);}}delete this.hilites[id];delete this.items[id];var secId=obj.parentNode.getAttribute("id");var sec=this.sections[secId];delete sec[id];if(mstr.$H.isEmpty(sec)){delete this.sections[secId];}this.length--;var pb=this.parentBone;if(pb.parentBone.observer){pb.parentBone.delay("observer.notifyAll('onselectionchange')");}pb.onselectionchange(id);}this.notifySelectedBone(obj,false);this.restoreElements(id);try{if(this.isActive()&&this.firstItem().focus){this.firstItem().focus();}else{if(document.body.focus){document.body.focus();}}}catch(ex){}if(!delayRangeReset){this.resetRange();}if(this.length<2){this.isSingleSelectionType=true;}var subBone=microstrategy.findBone(obj.parentNode);if(subBone){subBone.updatePositionMap(obj,true);}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.clear=function(hidden){try{hidden=hidden||false;this.elem.style.zIndex=-1;var fnTest=function(s){if(st==microstrategy["SUBOBJTYPE_DOC_"+s]){return microstrategy.findBone(item);}return null;};for(var id in this.items){var item=this.items[id];var st=microstrategy.subObjectType(item);var b=fnTest("PANEL_STACK");if(b){this.removePanelStackSelectionHandleEvents(item);}else{b=fnTest("TEMPLATE");if(b){this.removeGridSelectionHandleEvents(item);var zz=b.selections&&b.selections.clearAll(true);}}}if(this.elem.hasChildNodes()){for(var id in this.hilites){for(var i=0,cnt=this.hilites[id].items.length;i<cnt;i++){var h=this.hilites[id].items[i];if(h.parentNode!=null){this.elem.removeChild(h);}}this.restoreElements(id);}}var changed=(this.length>0);if(changed){microstrategy.eventManager.notifyOrphanBones("onbonedeselected",this.getSelectedIds());}this.isSingleSelectionType=true;this.hilites={};this.sections={};this.items={};this.range=new Rect(null,null,null,null);this.range.offsetSection=null;this.range.offsetLeftSection=null;this.isVisible=true;this.length=0;var pb=this.parentBone;if(changed&&!hidden&&pb.parentBone.observer){pb.parentBone.delay("observer.notifyAll('onselectionchange')");}pb.onselectionchange(id);}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.firstObjType=function(){try{if(this.isActive()){return this.firstItem().getAttribute(microstrategy.HTMLATTR_OBJTYPE);}}catch(err){microstrategy.errors.log(err);}return null;};mstrDocSelectionsImpl.prototype.processFormatProperty=function(pv,ac,ap){try{if(!pv){return ;}var p=pv[0];var v=pv[1];if(!p){return ;}var pb=this.parentBone;var fnP=function(t){return(parseInt(st[0],10)&t);};var sv=v.toString();var st=sv.split(",");if(p=="textDecoration"&&(st.length>1||fnP(4)||fnP(8))){pb.formatUnderlineStrikeout(this.items,p,sv,ac);}else{pb.formatItems(this.items,p,v,false,ac,ap);}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.processPropertyChanges=function(formatValue){try{var threeDBorderChanges=null;var borderChanges=null;var gridBorderChanges=null;var selectorChanges=null;var roundedCornerChanges=null;var gridOriginChanges=null;var gridFormatChanges=[];var gridNumberFormatChanges=null;var subHeightChanges=null;var subWidthChanges=null;var visibilityChanges=null;var widgetChanges=null;var themeChanges=null;var tableMemo=null;var sg=(this.isOnlyOneGridSelected())?this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_TEMPLATE):null;var sps=(this.isOnlyOnePanelStackSelected())?this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_PANEL_STACK):null;var tc=(sps&&sps.isTable)?sps:null;var ssc=(this.isSelectorControlSelected())?this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL):null;var oldFormatType=microstrategy.formatType;var id,bone,item,prop,g;var f=mstrFormatObject;var pb=this.parentBone;var so=this.styleObj;var ac=[];var um=pb.parentBone.updateManager;var forceSubmit=false;var gridPosition=null;var gridFactor=null;var graphUpdateNeeded=false;var items=this.items;var fnBl=function(b){return(b)?microstrategy.TRUE:microstrategy.FALSE;};var fnSA=function(p,v,a){pb.formatAttribute(items,p,v,false,a,ac);};var fnDV=function(v,p){v=microstrategy.number.toUSUnits(v);if(p){v=f.decodeValue(p,v);}return v;};for(var i=0;i<formatValue.length;i++){var cmdId=formatValue[i].cmdId;var elem=formatValue[i].obj;var value=formatValue[i].value;var formatType=formatValue[i].formatType;var performFormatChange=formatValue[i].performFormatChange;tableMemo=formatValue[i].memo;var gridMemo=formatValue[i].memo;var passToGrid=(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE&&sg!=null&&"category" in gridMemo&&gridMemo.unit>microstrategy.GRID_UNIT_CONTAINER);if((sg||sps||ssc)&&gridMemo&&"unit" in gridMemo){var cat=(sg)?"Grid":(ssc?"Control":"Panels");var m=this.resolveGridFormat(gridMemo.unit,gridMemo.format);this.setObjectFormatLevel(cat,m);this.resolveFormatType(cat,m);}else{if(ssc&&cmdId=="IsPortal"){var cat=(sg)?"Grid":(ssc?"Control":"Panels");var m=this.resolveControlFormat(0,4);this.setObjectFormatLevel(cat,m);this.resolveFormatType(cat,m);}else{microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;}}var singleFormat;if(forceSubmit==false&&formatValue[i].submitUpdateManager&&formatValue[i].submitUpdateManager==true){forceSubmit=true;}var tcCmdId=mstrDocSelectionsImpl.TCF[cmdId];if(tc&&tableMemo&&parseInt(tableMemo.unit)>1&&tcCmdId){microstrategy.formatType=1;switch(cmdId){case"font":case"TextStrikeout":case"TextUnderline":case"fsize":case"color":case"FillColor":case"LineSettingColor":case"LineSettingWeight":tc.setFormat({u:tableMemo.unit,f:tableMemo.format,p:tcCmdId,v:value});break;case"ShapeSettingStyle":tc.setFormat({u:tableMemo.unit,f:tableMemo.format,p:tcCmdId,v:f.decodeValue("lineStyle",value)});break;case"BoldItalic":tc.setFormat({u:tableMemo.unit,f:tableMemo.format,p:"fb",v:(parseInt(value)&1)==1});tc.setFormat({u:tableMemo.unit,f:tableMemo.format,p:"fi",v:(parseInt(value)&2)==2});break;}}else{switch(cmdId){case"Name":fnSA("name",value,microstrategy.HTMLATTR_NAME);pb.parentBone.delay("observer.notifyAll('onselectionchange')");break;case"ToolTip":pb.formatTitle(items,"title",value,ac);break;case"Visible":case"VisibleHTML":visibilityChanges=visibilityChanges||{};visibilityChanges[cmdId]=value;break;case"IsLink":pb.formatIsLink(items,value,ac);break;case"Link":var linkValue=(pb.secMode||trim(value).toLowerCase().indexOf("javascript")!=0)?value:"";fnSA("link",linkValue,microstrategy.HTMLATTR_LINK_HREFVALUE);fnSA("link",value,microstrategy.HTMLATTR_LINK_HREF);break;case"EditFieldTargetInfoWin":fnSA("InformationWindowTarget",value,"ifw");var tgt=microstrategy.bone(value);if(tgt){pb.formatAttribute([tgt.elem],"UseAsInformationWindow",microstrategy.TRUE,false,microstrategy.HTMLATTR_USE_AS_INFORMATION_WINDOW,ac);}break;case"InformationWindowPlacement":fnSA("InformationWindowPlacement",value,"iwpl");break;case"NewWin":fnSA("newWin",fnBl(value),microstrategy.HTMLATTR_NEW_WINDOW);break;case"HTMLType":pb.formatHTMLType(items,value,ac);break;case"IFrameSource":fnSA("url",value,microstrategy.HTMLATTR_HTML_SOURCE);pb.formatIframeSource(items,value);break;case"ShowWidgetTitleBar":fnSA("ShowWidgetTitleBar",fnBl(value),microstrategy.HTMLATTR_WIDGET_SHOW_WINDOW_TITLE);break;case"UseAsInformationWindow":fnSA("UseAsInformationWindow",fnBl(value),microstrategy.HTMLATTR_USE_AS_INFORMATION_WINDOW);break;case"InfoWindowMode":fnSA("InfoWindowMode",value,microstrategy.HTMLATTR_INFO_WIN_MODE);break;case"InfoWindowPosition":fnSA("InfoWindowPosition",value,microstrategy.HTMLATTR_INFO_WIN_POSITION);break;case"TabCloseToDismissInfoWindow":fnSA("TabCloseToDismissInfoWindow",fnBl(value),microstrategy.HTMLATTR_TAB_CLOSE_TO_DISMISS_INFOWIN);break;case"TextCopyMode":case"GridCellCopyMode":fnSA("CopyMode",value,microstrategy.HTMLATTR_IOS_COPY_MODE);break;case"ResetToFirstPanelWhenTargeted":fnSA("ResetToFirstPanelWhenTargeted",fnBl(value),microstrategy.HTMLATTR_RESET_TO_FIRST_PANEL_WHEN_TARGETED);break;case"EnableHorizontalSwipeToChange":fnSA("EnableHorizontalSwipeToChange",fnBl(value),microstrategy.HTMLATTR_HORIZONTAL_SWIPE_CHANGE);break;case"SwipePanelStyle":fnSA("StyleForSwitchingPanel",value,microstrategy.HTMLATTR_STYLE_FOR_SWIPE_PANEL);break;case"fpAutoSubmit":fnSA("CtlAutoSubmit",fnBl(value),microstrategy.HTMLATTR_CTL_AUTO_SUBMIT);break;case"EditSelectorSearchOnServ":fnSA("SearchOnServer",fnBl(value),microstrategy.HTMLATTR_CTL_SEARCH_ON_SERVER);break;case"EditSelectorNoSelectionBehavior":fnSA("NoSelectionBehavior",value,microstrategy.HTMLATTR_CTL_NO_SELECTION_BEHAVIOR);break;case"MinSel":fnSA("MinSelectionCount",(value===""?-1:value),microstrategy.HTMLATTR_CTL_MIN_SELECTION_COUNT);break;case"MaxSel":fnSA("MaxSelectionCount",(value===""?-1:value),microstrategy.HTMLATTR_CTL_MAX_SELECTION_COUNT);break;case"ShowElementCount":fnSA("showElementCount",fnBl(value),microstrategy.HTMLATTR_CTL_SHOW_ELEMENT_COUNT);break;case"SelectionColor":this.processFormatProperty(this.setSingleFormat("selectionStyle",value),ac);this.processFormatProperty(this.setSingleFormat("selectionColor",value),ac);break;case"IsPortal":fnSA("showTitleBar",fnBl(value),microstrategy.HTMLATTR_SHOW_WINDOW_TITLE);for(item in items){id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs&&pb.checkAppliesTo(items[item],"showTitleBar")){if(value){var ft=microstrategy.formatType;if(microstrategy.subObjectType(items[item])==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){microstrategy.formatType=1;}var fnSZ=function(s){pb.formatSizeMode({0:items[item]},s+"Mode","0",ac,false);};fnSZ("height");fnSZ("width");microstrategy.formatType=ft;}}if(microstrategy.subObjectType(items[item])==microstrategy.SUBOBJTYPE_DOC_TEMPLATE&&value){var b=microstrategy.findBone(items[item]);if(b&&b.commands&&!b.commands.queryState("fittowindow")){b.handleFitToWindow(ac);if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){b.commands.exec("setColWidthsMode",1);}else{forceSubmit=true;}}}}break;case"PortalTitle":fnSA("windowTitle",value,microstrategy.HTMLATTR_WINDOW_TITLE);break;case"TitleBarDisplay":fnSA("titleBarDisplay",value,microstrategy.HTMLATTR_TITLE_BAR_DISPLAY);break;case"PortalState":var ps="restore";if(value==microstrategy.WINDOW_STATE_MAXIMIXED){ps="maximize";}else{if(value==microstrategy.WINDOW_STATE_MINIMIZED){ps="minimize";}}pb[ps+"Portal"](items,"windowState",value,false,ac);break;case"ExportOptions":fnSA("exportOptions",value,microstrategy.HTMLATTR_EXPORT_OPTION);break;case"Locked":fnSA("locked",fnBl(value),microstrategy.HTMLATTR_LOCKED);for(id in items){var st=microstrategy.subObjectType(items[id]);if(st==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK||st==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){bone=microstrategy.findBone(items[id]);bone.isLocked=value;bone.resetToolbar();}}break;case"Left":case"Top":var cl=cmdId.toLowerCase();pb.formatItems(items,cl,fnDV(value,cl),false,ac);if(cmdId=="Left"){pb.updateLayoutWidth(ac);}microstrategy.eventManager.notifyOrphanBones("onboneaftermove",this.getSelectedIds());break;case"Wmode11":case"Wmode12":case"Wmode13":case"Wmode":case"Hmode11":case"Hmode12":case"Hmode13":case"Hmode":var sm=(cmdId.charAt(0)=="W")?"width":"height";pb.formatSizeMode(items,sm+"Mode",value,ac,performFormatChange);if(sm=="width"&&bIsFirefox){forceSubmit=true;}var gridBone=microstrategy.findBone(this.getSelectedGrid());if(gridBone&&gridBone.isGrid){gridBone.onresize();if(sm==="height"){var container=gridBone.getParentSubsection(),containerHeight=container.elem.offsetHeight,gridHeight=gridBone.gridSpan.offsetHeight,cg=parseInt(microstrategy.styleObj.getAttValue(container.elem,microstrategy.HTMLATTR_CAN_GROW));if(gridHeight>containerHeight&&cg){container.simpleResize(gridHeight);}}}break;case"Height":case"Width":var dl=cmdId.toLowerCase();pb.formatSize(items,dl,fnDV(value,dl),ac,performFormatChange);graphUpdateNeeded=true;if(cmdId=="Width"&&bIsFirefox){forceSubmit=true;}var gridBone=microstrategy.findBone(this.getSelectedGrid());if(gridBone&&gridBone.isGrid){gridBone.onresize();if(cmdId==="Height"){var container=gridBone.getParentSubsection(),containerHeight=container.elem.offsetHeight,gridHeight=gridBone.gridSpan.offsetHeight,cg=parseInt(microstrategy.styleObj.getAttValue(container.elem,microstrategy.HTMLATTR_CAN_GROW));if(gridHeight>containerHeight&&cg){container.simpleResize(gridHeight);}}}break;case"SubHeight":case"MaxHeight":case"Shrink":case"Grow":subHeightChanges=subHeightChanges||{};subHeightChanges[cmdId]=value;break;case"SubWidth":case"MaxWidth":case"ShrinkHorizontal":case"GrowHorizontal":subWidthChanges=subWidthChanges||{};subWidthChanges[cmdId]=value;break;case"HideIfEmpty":fnSA("hideIfEmpty",fnBl(value),microstrategy.HTMLATTR_HIDE_IF_EMPTY);break;case"LockAspectRatio":pb.formatLockAspectRatio(items,value,ac);break;case"Lmode":pb.formatLineLength(items,"lengthMode",value,ac,performFormatChange);break;case"Length":pb.formatLineLength(items,"length",fnDV(value,"width"),ac,performFormatChange);break;case"FitExcelRowHeight":fnSA("fitExcelRowHeight",fnBl(value),microstrategy.HTMLATTR_FIT_EXCEL_ROW_HEIGHT);break;case"Keep":fnSA("keepSectionTogether",fnBl(value),microstrategy.HTMLATTR_KEEP_SECTION_TOGETHER);break;case"Repeat":fnSA("repeatSection",fnBl(value),microstrategy.HTMLATTR_REPEAT_SECTION);break;case"showInRptCp":fnSA("showOnlyInRepeatingCopies",fnBl(value),microstrategy.HTMLATTR_SHOW_IN_RPT_COPY);break;case"RepeatHoriz":fnSA("repeatHorizontally",fnBl(value),microstrategy.HTMLATTR_REPEAT_HORIZONTALLY);break;case"NewPage":fnSA("forceNewPage",value,microstrategy.HTMLATTR_FORCE_NEW_PAGE);break;case"DataSource":gridOriginChanges=gridOriginChanges||{};gridOriginChanges[cmdId]=value;break;case"Shortcut":gridOriginChanges=gridOriginChanges||{};gridOriginChanges[cmdId]=value;forceSubmit=true;break;case"XTabView":pb.formatTemplateSize(items,value,ac);forceSubmit=true;graphUpdateNeeded=true;break;case"QuickSwitch":fnSA("quickSwitch",fnBl(value),microstrategy.HTMLATTR_QUICK_SWITCH);if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){forceSubmit=true;}break;case"Overflow":fnSA("gridOverFlow",value,microstrategy.HTMLATTR_GRID_OVERFLOW);if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){forceSubmit=true;}break;case"TextOverflow":fnSA("TextOverflow",value,microstrategy.HTMLATTR_TEXT_OVERFLOW);break;case"ExportOverflow":fnSA("gridExportOverFlow",value,microstrategy.HTMLATTR_GRID_EXPORT_OVERFLOW);break;case"XTabPos":fnSA("gridPosition",value,microstrategy.HTMLATTR_GRID_POS);gridPosition=value;graphUpdateNeeded=true;forceSubmit=true;break;case"XTabPer":fnSA("gridArea",value,microstrategy.HTMLATTR_GRID_AREA_PCT);gridFactor=value;graphUpdateNeeded=true;forceSubmit=true;break;case"ItemWidthMode":this.setCommonBoneProperty(items,"itemWidthMode","ItemWidthMode",fnBl(!value),microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL,ac);forceSubmit|=microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE;break;case"DisplaySelectorDocked":this.setCommonBoneProperty(items,"DisplaySelectorDocked","DisplaySelectorDocked",fnBl(value),microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL,ac);break;case"exportSelectorTriState":this.setCommonBoneProperty(items,"aow","ExportAsShownOnWeb",value,microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL,ac);break;case"TitleHeight":if(!!value){microstrategy.formatType=this.docViewer.doc.selections.isSelectorControlSelected()?mstrRWControlImpl.FMT_TYPE_TITLE:2;pb.formatSize(items,"height",fnDV(value,"height"),ac,performFormatChange);microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;}break;case"Source":if(this.addingCtrl!=microstrategy.SUBOBJTYPE_DOC_IMAGE){var imgValue=pb.img?pb.img.url:value;forceSubmit=pb.formatImageSource(items,imgValue,ac,1);pb.autoSizeImages(0,imgValue,items,ac,true);}break;case"imgFile":if(this.addingCtrl!=microstrategy.SUBOBJTYPE_DOC_IMAGE){pb.img=value;}break;case"autoSizeImg":pb.autoSizeImages(0,value,items,ac);break;case"LineOrientation":pb.changeLineOrientation(items,value,ac);break;case"RHS":case"RHM":case"RHL":case"CHS":case"CHM":case"CHL":case"Outline":case"Banding":case"AttForms":case"ShowThreshold":case"TitleOverlap":case"DrillOptions":case"HideNullsOrZeros":case"HideNullZeroValues":if(cmdId=="HideNullsOrZeros"){value=(value)?0:-1;}else{if(cmdId!="DrillOptions"&&cmdId!="AttForms"&&cmdId!="HideNullZeroValues"){value=(value)?-1:0;}}g=this.getSelectedGrid();bone=microstrategy.findBone(g);bone.elem.setAttribute("avk",g.getAttribute("id"));bone.processGridPropertyChanges(cmdId,value,ac);forceSubmit=true;break;case"assoNodesDrill":var manipCat={assoNodesDrill:1}[cmdId];var item=this.firstItem();bone=microstrategy.findBone(item);bone.processGridPropertyChanges(cmdId,value,ac);ac.push(um.createActionObject(null,mstrUpdateManager.SET_ASSO_NODES,pb.parentBone.beanPath,["2048012","2048248","2048247"],[item.getAttribute("id"),value,manipCat]));forceSubmit=(forceSubmit||microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE);break;case"GraphExportOverflow":case"GraphExportOverflowSpacing":bone=microstrategy.findBone(this.getSelectedGrid());bone.processGridPropertyChanges(cmdId,value,ac);break;case"ControlGroupByList":g=this.getSelectedGrid();if(g){bone=microstrategy.findBone(g);bone.processGridPropertyChanges(cmdId,value,ac);}else{var elem=this.getSelectedPanelStack()||this.getSelectedSelectorControl();if(elem){bone=microstrategy.findBone(elem);if(bone){bone.setControlGroupByList(value,ac);}}}forceSubmit=true;break;case"EditSelectorSelectionType":case"EditSelectorMetricConditionType":case"EditSelectorType":case"EditSelectorSource":case"EditSelectorSourceMetrics":case"EditSelectorSourceAttributes":case"EditSelectorShowAll":case"EditSelectorAllAlias":case"EditSelectorShowTotal":case"EditSelectorTotalPosition":case"EditSelectorMouseOverAction":case"EditSelectorMultiSelect":case"EditSelectorStyle":case"EditSelectorStyleSingleSelect":case"EditSelectorStyleMetricQual":case"EditSelectorStyleAction":case"EditSelectorTargets":case"EditSelectorTargetsMetrics":case"EditSelectorTargetsAttributes":case"EditSelectorTargetsSingleSelect":case"EditSelectorTargetsDataset":case"EditSelectorCandidateAttributes":case"EditSelectorOrientation":case"EditSelectorAutoSync":case"DataFilterMode":case"selectorCurrentStateUC":case"selectorCurrentState":case"UnsetCount":case"ActionSelectorStyle":case"actionSelectorType":case"postSubmitOption":case"runReportDocName":case"runReportDocId":case"runObjectType":case"DisplayText":case"OfflineSubmission":case"TXNSubmitInOrder":case"DisplayConfirmation":case"SubmitMessage":case"ShowSubmitMessage":case"InvalidateCache":case"ForceLiveExecution":case"AutoAnswerPrompt":case"EditFormDelimiter":case"EditDisplayForm":case"selectedAttrForms":case"sortAttrForm":case"sortType":case"isDSAsTarget":if(tc&&cmdId==="DisplayConfirmation"){tc.exec({id:"setSelectorDisplayConfirmation",v:{key:tc.model.def.smk,value:value}});break;}selectorChanges=selectorChanges||{};selectorChanges[cmdId]=value;var relObj={EditSelectorSelectionType:"include",EditSelectorMouseOverAction:"mouseOverAction",EditSelectorAutoSync:"autoSync",EditSelectorShowAll:"showAll",EditSelectorShowTotal:"showTotal",EditSelectorAllAlias:"allAlias",isDSAsTarget:"isDSAsTarget"};var n=relObj[cmdId];var commands=this.docViewer.doc.commands;var isDDIC=commands.queryState("isDDIC");if(n){for(var sel in items){var b=mstrStaticDoc.getBone(items[sel]);if(b){b[n]=value;}else{if(isDDIC){commands.setDDICBoneProperty([items[sel]],n,value);}}}}break;case"UpdateFilterTarget":fnSA("ActionForDirectTargetSelectors",value,"adts");break;case"setWidget":var w;var fqcn="";var rsl="";var isApp=false;if(value&&value.toLowerCase()!="none"){var widCol=pb.parentBone.widgets;for(var wid in widCol){if((widCol[wid]["rslPath"]&&widCol[wid]["rslPath"]==value)||(widCol[wid]["fqcn"]&&widCol[wid]["fqcn"]==value)){w=widCol[wid];fqcn=w.fqcn;rsl=w.rslPath;isApp=w.isApp;break;}}}fnSA("ClassName",fqcn,microstrategy.HTMLATTR_WIDGET_CLASS);fnSA("RSLPath",rsl,microstrategy.HTMLATTR_WIDGET_RSL_PATH);fnSA("IsApp",isApp,microstrategy.HTMLATTR_WIDGET_IS_APP);break;case"SecondaryDataProviders":fnSA("SecondaryDataProviders",value.split(CLIPBOARD_ITEM_SEPARATOR).join(","),microstrategy.HTMLATTR_SEC_DATA_PROVIDERS);forceSubmit=true;break;case"NonFlashRender":fnSA("NonFlashRender",value,microstrategy.HTMLATTR_NON_FLASH_RENDER);break;case"setWidgetDhtmlRenderForViewModeChange":if(this.isWidgetToVisLinked(sg)){fnSA("DhtmlRenderer",value,microstrategy.HTMLATTR_DHTML_RENDER);}break;case"setTransition":fnSA("Transition",value,microstrategy.HTMLATTR_TRANSITION);break;case"setTransDuration":fnSA("Duration",value,microstrategy.HTMLATTR_TRANS_DURATION);break;case"PSPreLoadAllPanels":fnSA("PSPreLoadAllPanels",value,"plp");break;case"ClipOnExport":fnSA("IgnoreInExport",value?microstrategy.FALSE:microstrategy.TRUE,"cone");break;case"allowPanelsToSplitAcrossPages":fnSA("SplitPanelAcrossPages",value?microstrategy.TRUE:microstrategy.FALSE,"spcp");break;case"panelOverflowSpacing":fnSA("RepeatPanelSpacing",value,"povfs");break;case"expandPanels":fnSA("ExpandAllPanels",value,"ep");fnSA("SplitPanelAcrossPages",value!=0?microstrategy.FALSE:microstrategy.TRUE,"spcp");break;case"gridIfEnabled":fnSA("gridIfEnabled",fnBl(value),"gif");if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){forceSubmit=true;}break;case"gridIfMaxRows":fnSA("gridIfMaxRows",value,"gmr");if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){forceSubmit=true;}break;case"gridIfRowMode":fnSA("gridIfRowMode",value,"gifmd");if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){forceSubmit=true;}break;case"setWidgetRslPath":for(var item in items){ac.push(um.createEditPropsAction(items[item],items[item].getAttribute("id"),pb.parentBone.beanPath,["RSLPath"],[value]));}break;case"FillColor":singleFormat=this.setSingleFormat(cmdId,value);if(tc&&tableMemo&&parseInt(tableMemo.unit)>1){tc.setFormat({p:singleFormat[0],v:singleFormat[1],u:tableMemo.unit,f:tableMemo.format});}else{if(passToGrid&&gridMemo.unit>microstrategy.GRID_UNIT_CONTAINER){gridFormatChanges.push({n:singleFormat[0],m:gridMemo,v:value});}else{var styleFormat=this.setSingleFormat("FillStyle",value);this.processFormatProperty(singleFormat,ac);this.processFormatProperty(styleFormat,ac);threeDBorderChanges=threeDBorderChanges||{};threeDBorderChanges[cmdId]=value;}}break;case"ShapeSettingStyle":case"LineSettingStyle":pb.formatLineSetting(items,"lineStyle",f.decodeValue("lineStyle",value),false,ac);break;case"LineSettingColor":pb.formatLineSetting(items,"lineColor",value,false,ac);break;case"LineSettingWeight":pb.formatLineSetting(items,"lineWeight",f.decodeValue("lineWeight",value),false,ac);break;case"propBorderStyle":case"propButtonBorderStyle":case"AllStyle":case"AllColor":case"LeftStyle":case"LeftColor":case"TopStyle":case"TopColor":case"RightStyle":case"RightColor":case"BottomStyle":case"BottomColor":if(passToGrid&&gridMemo.unit>microstrategy.GRID_UNIT_CONTAINER){cat=gridMemo.unit+"|"+gridMemo.format;gridBorderChanges=gridBorderChanges||{};gridBorderChanges[cat]=gridBorderChanges[cat]||{};gridBorderChanges[cat][cmdId]=value;}else{cat="default|"+microstrategy.formatType;}borderChanges=borderChanges||{};borderChanges[cat]=borderChanges[cat]||{};if(cmdId=="propButtonBorderStyle"){cmdId="propBorderStyle";}borderChanges[cat][cmdId]=value;break;case"font":case"fsize":case"color":singleFormat=this.setSingleFormat(cmdId,value);if(passToGrid){gridFormatChanges.push({n:singleFormat[0],m:gridMemo,v:value});}else{if(sps){microstrategy.formatType=2;}this.processFormatProperty(singleFormat,ac);}break;case"BoldItalic":if(passToGrid){gridFormatChanges.push({n:"fontWeight",m:gridMemo,v:((value==1||value==3)?-1:0)});gridFormatChanges.push({n:"fontStyle",m:gridMemo,v:((value==2||value==3)?-1:0)});}else{if(sps){microstrategy.formatType=2;}this.processFormatProperty(this.setSingleFormat("Bold",(value==1||value==3)),ac);this.processFormatProperty(this.setSingleFormat("Italic",(value==2||value==3)),ac);if(sps){sps.setFormatValue(mstrPanelStack.FMT_TYPE_TITLE,"fontWeight",(value==1||value==3)?"bold":"normal");sps.setFormatValue(mstrPanelStack.FMT_TYPE_TITLE,"fontStyle",(value==2||value==3)?"italic":"normal");}}break;case"TextUnderline":if(passToGrid){gridFormatChanges.push({n:"textDecoration",m:gridMemo,v:value});}else{if(sps){microstrategy.formatType=2;}this.processFormatProperty(this.setSingleFormat("Underline",value),ac);}break;case"TextStrikeout":if(passToGrid){gridFormatChanges.push({n:"textDecoration2",m:gridMemo,v:value});}else{if(sps){microstrategy.formatType=2;}this.processFormatProperty(this.setSingleFormat("StrikeOut",value),ac);}break;case"Category":case"DecimalPlaces":case"CurrencySymbol":case"CurrencyPosition":case"NegativeNumbers":case"ThousandSeparator":case"Format":if(passToGrid){if(cmdId=="ThousandSeparator"){value=value?microstrategy.TRUE:microstrategy.FALSE;}gridNumberFormatChanges=gridNumberFormatChanges||{};gridNumberFormatChanges[cmdId]=value;gridFormatChanges.push({n:cmdId,m:gridMemo,v:value});}else{this.processFormatProperty(this.setSingleFormat(cmdId,value),ac);if(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE){forceSubmit=true;}}break;case"GridHorizontal":case"Vertical2":case"Vertical":case"SelectorVertical":case"TextWrap":case"TextDirection":case"TextDirectionGrid":if(cmdId=="TextDirectionGrid"){cmdId="TextDirection";}if(cmdId=="SelectorVertical"){cmdId="Vertical";}var isBrowserSupported=bIsFirefox||bIsChrome||bIsIE4||bIsW3CIE;if(cmdId=="TextDirection"&&!isBrowserSupported&&value!="0"){showMessage({contents:microstrategy.descriptors.getDescriptor("5158"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});}if(passToGrid){gridFormatChanges.push({n:cmdId,m:gridMemo,v:value});}else{this.processFormatProperty(this.setSingleFormat(cmdId,value),ac);}break;case"Horizontal":this.processFormatProperty(this.setSingleFormat(cmdId,value),ac);break;case"LeftPadding":case"TopPadding":case"RightPadding":case"BottomPadding":if(passToGrid){gridFormatChanges.push({n:"padding"+cmdId.replace("Padding",""),m:gridMemo,v:microstrategy.number.toLocalUnits(mstrNumber.UNIT_PT,fnDV(value))});}else{this.processFormatProperty(this.setSingleFormat(cmdId,microstrategy.number.toLocalUnits(mstrNumber.UNIT_PT,fnDV(value),true)),ac);}break;case"HasDropShadow":case"DropShadow":this.processFormatProperty(this.setSingleFormat(cmdId,value),ac);break;case"HasRoundedCorners":case"TopCornersOnly":case"Radius":roundedCornerChanges=roundedCornerChanges||{};roundedCornerChanges[cmdId]=value;break;case"enabled3d":case"b3dstyle":case"b3dweight":threeDBorderChanges=threeDBorderChanges||{};threeDBorderChanges[cmdId]=value;break;case"Transparency":fnSA("Transparency",value,microstrategy.HTMLATTR_PS_TRANSPARENCY);break;case"Blur":fnSA("Blur",fnBl(value),microstrategy.HTMLATTR_PS_BLUR);break;case"FlashDisplay":case"DHTMLDisplay":case"iPhoneDisplay":case"AndroidDisplay":case"AndroidTabletDisplay":case"iPadDisplay":case"widgetId":case"WidgetProps":case"SecondaryDataProvidersValue":widgetChanges=widgetChanges||{};widgetChanges[cmdId]=value;break;case"docked":var currSecDef=this.parentBone.commands.getCurrentSectionDef();var v=value?microstrategy.TRUE:microstrategy.FALSE;if(currSecDef.dc!=(v==microstrategy.TRUE)){currSecDef.dc=(v==microstrategy.TRUE);}var elem=microstrategy.findAncestorWithAtt(this.parentBone.selections.firstItem(),microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_SECTION);pb.formatAttribute([elem],"docked",v,false,null,ac);break;case"DisplayStyle":fnSA("DisplayStyle",value,microstrategy.HTMLATTR_DISPLAY_STYLE);break;case"NormalURL":fnSA("NormalURL",value,microstrategy.HTMLATTR_NORMAL_URL);break;case"HighlightURL":fnSA("HighlightURL",value,microstrategy.HTMLATTR_HIGHLIGHT_URL);break;case"BackgroundHighlightColor":fnSA("BackgroundHighlightColor",mstrFormatObject.encodeValue("BackgroundHighlightColor",value),microstrategy.HTMLATTR_BACKGROUND_HIGHLIGHT_COLOR);break;case"FontHighlightColor":fnSA("FontHighlightColor",mstrFormatObject.encodeValue("FontHighlightColor",value),microstrategy.HTMLATTR_FONT_HIGHLIGHT_COLOR);break;case"FillEffect":fnSA("FillEffect",value,microstrategy.HTMLATTR_FILL_EFFECT);break;case"SetBadgeToValueOnField":fnSA("SetBadgeToValueOnField",fnBl(value),microstrategy.HTMLATTR_SET_BADGE_TO_VALUE_ON_FIELD);break;case"TableSubmitText":tc&&tc.exec({id:"setSelectorDisplayText",v:{key:tc.model.def.smk,txt:value}});break;case"TableCancelText":tc&&tc.exec({id:"setSelectorDisplayText",v:{key:tc.model.def.dck,txt:value}});break;case"TableCancelConfirmation":tc&&tc.exec({id:"setSelectorDisplayConfirmation",v:{key:tc.model.def.dck,value:value}});break;case"joinTypes":var bone=microstrategy.findBone(this.getSelectedGrid()),ep=bone.editorProperties=bone.editorProperties||{},propStr,nodeKey,unitID,unitType;ep.outerJoinType=ep.outerJoinType||{};for(var key in value){if(key==="allAttrs"){propStr="VLDB Select!Outer Join To Lookup Table!"+(value[key]==="dft"?" !dft":value[key]);ac.push(um.createActionObject(this.elem,mstrUpdateManager.SET_PROPERTY_VALUES,bone.beanPath,["4146"],[propStr],[]));ep.outerJoinType=value[key];}else{propStr="VLDB Select!Metric Join Type!"+(value[key]==="dft"?" !dft":value[key]);nodeKey=bone.RWUnitId;unitID=key;unitType=4;ac.push(um.createActionObject(this.elem,mstrUpdateManager.SET_TEMPLATE_UNIT_PROPS,this.docViewer.beanPath,["4146","2048012","2048001","2048009"],[propStr,nodeKey,unitID,unitType],[]));ep.tmsProps=ep.tmsProps||{};ep.tmsProps[key]={outerJoinType:value[key]};}}forceSubmit=true;if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE){ac.push(um.createActionObject(pb.elem,mstrUpdateManager.APPLY_CHANGES,this.docViewer.beanPath,[],[],[]));}break;case"DisplayInPartialScreen":fnSA("DisplayInPartialScreen",fnBl(value),"dips");break;case"InitialSlidingInWidth":fnSA("InitialSlidingInWidth",fnDV(value,cmdId),"isiw");break;case"InitialSlidingInHeight":fnSA("InitialSlidingInHeight",fnDV(value,cmdId),"isih");break;case"ShowAsCollapsiblePanel":fnSA("ShowAsCollapsiblePanel",fnBl(value),"sacp");break;case"InfoWindowPositionEnabled":case"showTranslucent":case"InitialSlidingInHeightEnabled":case"InitialSlidingInWidthEnabled":break;case"showCustomThemePicker":case"showAppliedThemeAsType":case"appliedThemeTypes":case"appliedThemeAsTypes":case"appliedThemePath":case"appliedThemeType":case"appliedThemeID":case"appliedThemeAsLink":themeChanges=themeChanges||{};themeChanges[cmdId]=value;break;default:if(typeof (console)!="undefined"){console.log(cmdId+" property not handled in processPropertyChanges.");}}}}if(graphUpdateNeeded&&this.processGraphPropertyChanges(items,gridPosition,gridFactor,ac)){forceSubmit=true;}var gridFormatCacheId="";this.processVisibilityChanges(visibilityChanges,ac);this.processSubDimensionPropertyChanges(subHeightChanges,"Height",ac);this.processSubDimensionPropertyChanges(subWidthChanges,"Width",ac);this.processBorderPropertyChanges(borderChanges,ac);this.process3DBorderPropertyChanges(threeDBorderChanges,ac);forceSubmit|=ac.forceSubmit;if(this.processGridOriginPropertyChanges(gridOriginChanges,ac)){forceSubmit=true;}if(tc&&selectorChanges){var cs=tc.submitBtn;this.processSelectorSubsequentChanges(selectorChanges,cs,ac);selectorChanges=null;}else{if(this.processSelectorPropertyChanges(selectorChanges,ac)){forceSubmit=true;}}if(this.processThemePropertyChanges(themeChanges,ac)){forceSubmit=true;}this.processRoundedCornerChanges(roundedCornerChanges,ac);gridFormatCacheId=this.processGridNumberFormatChanges(gridNumberFormatChanges,gridMemo,ac);if(gridBorderChanges){gridFormatChanges.push({n:"borders",v:gridBorderChanges});}if(gridFormatChanges.length>0){if(passToGrid&&sg.processGridFormattingProperties(gridFormatChanges,ac)){forceSubmit=true;}}microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;this.processWidgetPropertyChanges(widgetChanges,sg,ac,items);microstrategy.formatType=oldFormatType;if(ac.length>0){um.add(ac);if(forceSubmit==true){um.flushAndSubmitChanges();}}if(gridFormatCacheId){delete microstrategy.gridFormatCache[gridFormatCacheId];}this.addingCtrl=null;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.isWidgetToVisLinked=function(g){try{if(g){for(var item in this.items){var rsl=this.styleObj.getAttValue(this.items[item],microstrategy.HTMLATTR_WIDGET_RSL_PATH);var vis=this.parentBone.getLinkedVisualization(rsl);return(vis&&vis==g.selectedVisualization);}}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.processWidgetPropertyChanges=function(deltas,sg,ac,items){try{if(!deltas){return ;}var pb=this.parentBone;var so=this.styleObj;var fnSA=function(p,v,a){pb.formatAttribute(items,p,v,false,a,ac);};var fnVS=function(enabled,newVis,viewMode){var newVisList=[];if(newVis){newVisList.push(newVis);}if(sg.visualizationList&&sg.visualizationList.length>0){for(var i=0,cnt=sg.visualizationList.length;i<cnt;i++){if(sg.visualizationList[i].name!=newVis){newVisList.push(newVis);}}}sg.setVisualizationSettings(enabled,newVis,newVisList.join(","),viewMode,ac);};var copyWgtProps=function(){if(typeof (deltas.WidgetProps)=="undefined"){if(vwr.wgtProps){deltas.WidgetProps=vwr.wgtProps;}}};var wId=deltas.widgetId;var vwr=this.docViewer;var prevWId=vwr.commands.queryState("widgetId");if(typeof (wId)=="undefined"){wId=prevWId;}var lst=vwr.gridWidgets.lst,w=lst[wId];if(typeof (deltas.FlashDisplay)!="undefined"){var cn="";var rsl="";var ia=false;var en="0";if(deltas.FlashDisplay){cn=w.wgt.cn;rsl=w.wgt.rsl;ia=w.wgt.ia;en="-1";sg.curWgtId=wId;sg.isWidget=true;}else{sg.isWidget=false;}fnSA("ClassName",cn,microstrategy.HTMLATTR_WIDGET_CLASS);fnSA("RSLPath",rsl,microstrategy.HTMLATTR_WIDGET_RSL_PATH);fnSA("IsApp",ia,microstrategy.HTMLATTR_WIDGET_IS_APP);fnSA("Enable",en);}if(typeof (deltas.DHTMLDisplay)!="undefined"){if(deltas.DHTMLDisplay){fnVS("1",w.vis.s,w.vis.vm);sg.curWgtId=wId;}else{fnVS("0","","0");}}if(typeof (deltas.iPhoneDisplay)!="undefined"){var iphVis="";if(deltas.iPhoneDisplay){iphVis=w.iphVis.s;sg.iPhoneVis=iphVis;sg.curWgtId=wId;}if(vwr.iPhoneVis){vwr.doc.saveDocProperty("IPhoneVisualization","");copyWgtProps();}fnSA("IPhoneVisualization",iphVis,microstrategy.HTMLATTR_IPHONE_VIS);}if(typeof (deltas.iPadDisplay)!="undefined"){var ipadVis="";sg.iPadVis="";if(deltas.iPadDisplay){ipadVis=w.ipadVis.s;sg.iPadVis=ipadVis;sg.curWgtId=wId;}fnSA("IPadVisualization",ipadVis,microstrategy.HTMLATTR_IPAD_VIS);}if(typeof (deltas.AndroidDisplay)!="undefined"){var aVis="";if(deltas.AndroidDisplay){aVis=w.aVis.s;sg.aVis=aVis;sg.curWgtId=wId;}if(vwr.aVis){vwr.doc.saveDocProperty("APhoneVisualization","");copyWgtProps();}fnSA("APhoneVisualization",aVis,microstrategy.HTMLATTR_ANDROID_VIS);}if(typeof (deltas.AndroidTabletDisplay)!="undefined"){var atVis="";if(deltas.AndroidTabletDisplay){atVis=w.atVis.s;sg.curWgtId=wId;sg.atVis=atVis;}fnSA("ATabletVisualization",atVis,microstrategy.HTMLATTR_ANDROID_TABLET_VIS);}if(sg&&sg.buildWidgetPreview){sg.buildWidgetPreview(wId);}if(wId==""){sg.curWgtId="";sg.iPadVis="";vwr.iPhoneVis="";vwr.curWgtId="";vwr.aVis="";vwr.doc.saveDocProperty("WidgetProps","");vwr.wgtProps="";fnSA("WidgetProps","",microstrategy.HTMLATTR_WIDGET_PROPS);sg.wgtProps="";}else{if(!sg.curWgtId&&(sg.iPadVis||sg.isWidget)){sg.curWgtId=wId;}if(typeof (deltas.WidgetProps)!="undefined"){var wp=deltas.WidgetProps;fnSA("WidgetProps",wp,microstrategy.HTMLATTR_WIDGET_PROPS);sg.wgtProps=wp;if(vwr.wgtProps){vwr.doc.saveDocProperty("WidgetProps","");}}}if(!sg.curWgtId){fnSA("SecondaryDataProviders","",microstrategy.HTMLATTR_SEC_DATA_PROVIDERS);}if(typeof (deltas.SecondaryDataProvidersValue)!="undefined"){fnSA("SecondaryDataProviders",deltas.SecondaryDataProvidersValue.split(CLIPBOARD_ITEM_SEPARATOR).join(","),microstrategy.HTMLATTR_SEC_DATA_PROVIDERS);forceSubmit=true;}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.cancelPropertyEdit=function(cnt){if(this.addingCtrl==microstrategy.SUBOBJTYPE_DOC_IMAGE){this.parentBone.commands.exec("deleteStubImg");}this.addingCtrl=null;};mstrDocSelectionsImpl.prototype.resolveDeltaPropertyValue=function(deltas,cmdId){return(cmdId in deltas)?deltas[cmdId]:this.checkFormat(cmdId);};mstrDocSelectionsImpl.prototype.convertBooleanToString=function(b){return(b)?microstrategy.TRUE:microstrategy.FALSE;};mstrDocSelectionsImpl.prototype.processVisibilityChanges=function(deltas,ac){try{if(!deltas){return ;}var pb=this.parentBone;var that=this;var fn=function(p,v,a){pb.formatAttribute(that.items,p,that.convertBooleanToString(v),false,a,ac);};var vs="Visible";var vsH="VisibleHTML";var isVis=pb.commands.queryState(vs);if(vs in deltas){isVis=deltas[vs];fn("visibility",isVis,microstrategy.HTMLATTR_VISIBLE);}if(pb.commands.queryState("showVisibleInHTMLViewMode")){var isVisInHTML=(vsH in deltas)?deltas[vsH]:pb.commands.queryState(vsH);if(vsH in deltas||(!isVis&&isVisInHTML)){if(!isVis){isVisInHTML=false;}fn("showInHTMLViewMode",isVisInHTML,microstrategy.HTMLATTR_VISIBLE_HTML_VIEW_MODE);}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.processSubDimensionPropertyChanges=function(deltas,d,ac){try{if(!deltas){return ;}if(d=="Height"&&("Grow" in deltas||"Shrink" in deltas)){var fi=microstrategy.findBone(this.firstItem());if(fi&&fi.isHorizontal){var c=microstrategy.findAncestorWithAtt(fi.elem,microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_HORIZONTAL_CONTAINER);if(c){var fnCG=function(p,q){c.setAttribute(q,deltas[p]?microstrategy.TRUE:microstrategy.FALSE);};if("Grow" in deltas){fnCG("Grow",microstrategy.HTMLATTR_CAN_GROW);}if("Shrink" in deltas){fnCG("Shrink",microstrategy.HTMLATTR_CAN_SHRINK);}}}}var that=this;var fn=function(n,a){var v=that.resolveDeltaPropertyValue(deltas,a);if(n){return microstrategy.number.toUSUnits(v);}else{return that.convertBooleanToString(v);}};var p=d.toLowerCase();var ap="";if(p=="width"){ap="Horizontal";}else{for(var i in deltas){p+="|"+i;}}this.parentBone.formatSubHeightWidth(this.items,p,[fn(true,"Sub"+d),fn(true,"Max"+d),fn(false,"Grow"+ap),fn(false,"Shrink"+ap),this.convertBooleanToString(this.checkFormat("HideIfEmpty"))],ac);}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.processGridOriginPropertyChanges=function(deltas,ac){try{if(!deltas){return false;}var _rtn=false;var ds=null;var g=this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_TEMPLATE);if("DataSource" in deltas){ds=deltas.DataSource;this.parentBone.setGridDataSource(this.items,ds,ac);_rtn=true;}else{ds=g.commands.queryState("DataSource");}if("Shortcut" in deltas){this.parentBone.setGridOrigin(this.items,deltas.Shortcut,ds,ac);g.commands.exec("Shortcut",deltas.Shortcut);if(!_rtn){_rtn=(microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE);}}return _rtn;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.processGridNumberFormatChanges=function(deltas,gridMemo,ac){try{if(!deltas||deltas.length==7){return false;}var gfc=[];var sg=this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_TEMPLATE);var np=["Category","DecimalPlaces","CurrencySymbol","CurrencyPosition","NegativeNumbers","ThousandSeparator","Format"];var df=(deltas.Category=="-2");for(var i=0,cnt=np.length;i<cnt;i++){var cmdId=np[i];if(!deltas[cmdId]){gfc.push({n:cmdId,m:gridMemo,v:((df)?"-2":this.parentBone.commands.queryState(cmdId))});}}var acTmp=[],rfac,ids,args;sg.processGridFormattingProperties(gfc,acTmp);rfac=acTmp[0];ids=rfac.argID;args=rfac.newArgs;for(var i in acTmp){_j:for(var j in acTmp[i].argID){for(var k in ids){if(acTmp[i].argID[j]==ids[k]){continue _j;}}ids.push(acTmp[i].argID[j]);args.push(acTmp[i].newArgs[j]);}}ac.push(rfac);if(sg.RWUnitId in microstrategy.gridFormatCache&&df){return sg.RWUnitId;}}catch(err){microstrategy.errors.log(err);}return false;};mstrDocSelectionsImpl.prototype.processBorderPropertyChanges=function(borderChanges,ac){try{if(!borderChanges){return ;}for(var deft in borderChanges){var bv;if(deft.indexOf("default")>=0){bv=borderChanges[deft];}else{continue;}microstrategy.formatType=deft.split("|")[1];var bp;var sides=["borderTop","borderRight","borderLeft","borderBottom"];var that=this;var fnRB=function(bc,b){var r={width:"0pt",style:"solid",color:(bc[b+"Color"]||that.checkFormat(b+"Color"))||"#000000"};var s=mstrFormatObject.decodeValue("borderTopStyle",bc[b+"Style"]||that.checkFormat(b+"Style")).split(" ");if(s.length>1){r.width=s[0];r.style=s[1];}return r;};var fnFIB=function(s,st,wd,cl){that.parentBone.formatItemBorders(that.items,s,st,wd,cl,false,ac);};var bVal=parseInt((("propBorderStyle" in bv)?bv.propBorderStyle:this.checkBorderStyle()),10);switch(parseInt(bVal)){case 0:fnFIB(sides,"solid","0pt","#000000");break;case 1:bp=fnRB(bv,"All");fnFIB(sides,bp.style,bp.width,bp.color);break;case 2:for(var i=0;i<4;i++){bp=fnRB(bv,sides[i].replace("border",""));fnFIB([sides[i]],bp.style,bp.width,bp.color);}break;}delete bv;microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.process3DBorderPropertyChanges=function(deltas,ac){try{if(!deltas){return ;}var style="0";var weight="";if(this.resolveDeltaPropertyValue(deltas,"enabled3d")){style=this.resolveDeltaPropertyValue(deltas,microstrategy.HTMLATTR_BORDER_3D_STYLE);weight=this.resolveDeltaPropertyValue(deltas,microstrategy.HTMLATTR_BORDER_3D_WEIGHT);}this.parentBone.format3DItems(this.items,style,weight,ac);}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.processThemePropertyChanges=function(deltas,ac){if(!deltas){return false;}var um=microstrategy.updateManager,fAttrs=this.parentBone.formattingAttributes,beanPath=this.parentBone.parentBone.beanPath,queryState=microstrategy.getViewerBone().commands.queryState,fnApplyTheme=function(items,thmID,applyAsLink){var nodeKey=null,nodeKeys=[];for(nodeKey in items){nodeKeys.push(nodeKey);fAttrs[nodeKey]=fAttrs[nodeKey]||{};fAttrs[nodeKey]["thmid"]=thmID;fAttrs[nodeKey]["thmlnk"]=!!applyAsLink;}ac.push(um.createActionObject(null,mstrUpdateManager.APPLY_THEME,beanPath,["2048292","2048076","2048293"],[thmID,nodeKeys.join(mstrUpdateManager.ITEM_SEPARATOR),applyAsLink]));},fnRemoveTheme=function(items){var nodeKey=null,nodeKeys=[];for(nodeKey in items){nodeKeys.push(nodeKey);fAttrs[nodeKey]=fAttrs[nodeKey]||{};fAttrs[nodeKey]["thmid"]=null;fAttrs[nodeKey]["thmlnk"]=false;}ac.push(um.createActionObject(null,mstrUpdateManager.REMOVE_THEME,beanPath,["2048076"],[nodeKeys.join(mstrUpdateManager.ITEM_SEPARATOR)]));};var thmid=deltas.appliedThemeID||microstrategy.getViewerBone().commands.queryState("appliedThemeID"),thmlnk=("appliedThemeAsLink" in deltas)?deltas.appliedThemeAsLink:microstrategy.getViewerBone().commands.queryState("appliedThemeAsLink");if("appliedThemeType" in deltas){switch(deltas.appliedThemeType){case microstrategy.APPLIED_THEME_NONE:fnRemoveTheme(this.items);break;case microstrategy.APPLIED_THEME_DEFAULT:fnApplyTheme(this.items,thmid,thmlnk);break;case microstrategy.APPLIED_THEME_CUSTOM:if(thmid&&!microstrategy.isDefaultTheme(thmid)){fnApplyTheme(this.items,thmid,thmlnk);}else{showMessage({contents:"*You should choose one Theme before applying it.*",elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return false;}break;}return true;}if("appliedThemeID" in deltas||"appliedThemeAsLink" in deltas){fnApplyTheme(this.items,thmid,thmlnk);return true;}return false;};mstrDocSelectionsImpl.prototype.processSelectorPropertyChanges=function(deltas,ac){try{if(!deltas){return false;}var um=microstrategy.updateManager,cs=this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL),bp=this.parentBone.parentBone.beanPath,forceSubmit=false,key=cs&&cs.ctlKey,fnAO=function(evt,arg,val){ac.push(um.createActionObject(null,mstrUpdateManager["CTRL_"+evt],bp,["2048130"].concat(arg),[key].concat(val),[]));},eventMap={MouseOverAction:{e:"SET_MOUSE_OVER_ACTION",a:"136"},ShowAll:{e:"SHOW_ALL_SETTING",a:"125"},AllAlias:{e:"SET_ALL_ALIAS",a:"134",c:1},ShowTotal:{e:"SET_SHOW_TOTAL",a:"169"},TotalPosition:{e:"SET_TOTAL_POSITION",a:"170",c:1},MultiSelect:{e:"MULTISELECT_SETTING",a:"120"},AutoSync:{e:"SET_AUTO_SYNC",a:"139"}},st=null;if(microstrategy.getViewerBone().commands.queryState("isDDIC")){var commands=microstrategy.getViewerBone().doc.commands,tgtFld="EditSelectorTargets",aid=["2048129","2048116"],aval=["",deltas[tgtFld]],nodeKey=null;key=commands.getDDICBoneProperty(this.items,"ctlKey",null);nk=commands.getDDICBoneProperty(this.items,"key",null);if(tgtFld in deltas){if("DataFilterMode" in deltas){var dfm=deltas.DataFilterMode;if(dfm&&dfm!="-1"){for(nodeKey in this.items){this.parentBone.formattingAttributes[nodeKey]=this.parentBone.formattingAttributes[nodeKey]||{},this.parentBone.formattingAttributes[nodeKey]["dfm"]=dfm;}aid.push("2048187");aval.push(dfm);}}commands.setDDICBoneProperty(this.items,"targetKeys",deltas[tgtFld]);fnAO("SET_TARGETS",aid,aval);}if("DataFilterMode" in deltas){if(!(tgtFld in deltas)){var val=deltas.DataFilterMode;for(nodeKey in this.items){this.parentBone.formattingAttributes[nodeKey]=this.parentBone.formattingAttributes[nodeKey]||{},this.parentBone.formattingAttributes[nodeKey]["dfm"]=val;}if(val!=-1){ac.push(um.createActionObject(null,mstrUpdateManager.RW_SET_CONTROL_DATA_FILTER_MODE,bp,["2048130","2048187"],[key,val],[]));}}}if("selectorCurrentStateUC" in deltas||"selectorCurrentState" in deltas){var args=["2048130"],values=[key];ac.push(um.createActionObject(null,mstrUpdateManager.REPORT_WRITER_EVENT_UNSET_SELECTOR_CONTROL,bp,args,values,[]));}if("selectorCurrentState" in deltas||"UnsetCount" in deltas){var args=["2048130"],values=[key];args[args.length]="2048204";if("UnsetCount" in deltas){values[values.length]=deltas.UnsetCount;this.parentBone.formattingAttributes[nk]["usc"]=deltas.UnsetCount;}else{values[values.length]=this.parentBone.formattingAttributes[nk]["usc"];}args[args.length]="2048203";if("selectorCurrentState" in deltas){values[values.length]=deltas.selectorCurrentState;this.parentBone.formattingAttributes[nk]["ust"]=deltas.selectorCurrentState;}else{values[values.length]=this.parentBone.formattingAttributes[nk]["ust"];}ac.push(um.createActionObject(null,mstrUpdateManager.REPORT_WRITER_EVENT_CHANGE_UNSET_SELECTOR_PROPERTIES,bp,args,values,[]));}for(var evt in eventMap){var p="EditSelector"+evt;if(p in deltas){var e=eventMap[evt];var v=deltas[p];if(!e.c){v=(v)?1:0;}fnAO(e.e,["2048"+e.a],[v]);}}return forceSubmit;}if("EditSelectorType" in deltas){st=deltas.EditSelectorType;cs.setType(st,ac);cs.clearSource();cs.clearReplaceAtt();}else{st=cs.ctlType;}if("isDSAsTarget" in deltas){var isDsTarget=deltas.isDSAsTarget;if(isDsTarget){cs.setTargetType(mstrRWControlImpl.CTL_TARGET_TYPE_DATASET);}else{cs.setTargetType(mstrRWControlImpl.CTL_TARGET_TYPE_DOCUMENT);}}var srcProp="EditSelectorSource"+(cs.ctlStyle==7||cs.ctlStyle==8?"Metrics":"");if(st==mstrRWControlImpl.CTL_TYPE_ELEMENT_LIST){if(srcProp in deltas){var sv=deltas[srcProp].split("|");cs.setSource(sv[0],sv[1],sv[2],ac);}}if("EditSelectorSourceAttributes" in deltas&&st==mstrRWControlImpl.CTL_TYPE_ATTR_LIST){var sv=deltas.EditSelectorSourceAttributes.split("|");cs.setReplaceAtt(sv[0],sv[1],sv[2],ac);}if("EditFormDelimiter" in deltas){delimiter=deltas.EditFormDelimiter;cs.setDelimiter(delimiter,ac);}if("EditDisplayForm" in deltas){displayFormType=deltas.EditDisplayForm;cs.setDisplayFormType(displayFormType,ac);ac.push(um.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[]));}if("selectedAttrForms" in deltas){attrForms=deltas.selectedAttrForms;cs.setAttrForms(attrForms,ac);}if("sortAttrForm" in deltas){var sortAttrForm=deltas.sortAttrForm;if(sortAttrForm!="1"){sort={form:sortAttrForm};if("sortType" in deltas){sort.type=deltas.sortType;}cs.setSortAttrForm(sort,ac);}}var suffix=(st==mstrRWControlImpl.CTL_TYPE_PANEL_STACK||st==mstrRWControlImpl.CTL_TYPE_ATTR_LIST)?"SingleSelect":"",metricQual="EditSelectorStyleMetricQual" in deltas,actionSel="EditSelectorStyleAction" in deltas;if(actionSel||metricQual||"EditSelectorStyle" in deltas||"EditSelectorStyleSingleSelect" in deltas){var ctlStyle=actionSel?deltas.EditSelectorStyleAction:metricQual?deltas.EditSelectorStyleMetricQual:deltas["EditSelectorStyle"+suffix];if(!isNaN(ctlStyle)){switch(ctlStyle){case mstrRWControlImpl.CTL_STYLE_POOL_DOWN:deltas.EditSelectorMultiSelect=false;case mstrRWControlImpl.CTL_STYLE_LIST_BOX:deltas.EditSelectorOrientation=mstrRWControlImpl.ORIENTATION_VERTICAL;break;case mstrRWControlImpl.CTL_STYLE_RADIO_BUTTON:deltas.EditSelectorMultiSelect=false;break;case mstrRWControlImpl.CTL_STYLE_CHECKBOX:case mstrRWControlImpl.CTL_STYLE_SEARCH_BOX:deltas.EditSelectorMultiSelect=true;break;}var ms=("EditSelectorMultiSelect" in deltas)?deltas.EditSelectorMultiSelect:cs.multiSelect;cs.setStyle(ctlStyle,deltas.EditSelectorOrientation||cs.ctlOrientation,ms);ac.push(um.createActionObject(null,mstrUpdateManager.CTRL_SET_STYLE,bp,["2048130","2048119"],[key,ctlStyle],[]));}}if("EditSelectorOrientation" in deltas){ac.push(um.createEditPropsAction(null,key,bp,["ctlOrientation"],[deltas.EditSelectorOrientation],null,true));if(!("EditSelectorStyle" in deltas)){cs.setStyle(cs.ctlStyle,deltas.EditSelectorOrientation,("EditSelectorMultiSelect" in deltas)?deltas.EditSelectorMultiSelect:cs.multiSelect);}}if("EditSelectorMetricConditionType" in deltas){ac.push(um.createEditPropsAction(null,key,bp,["mct"],[deltas.EditSelectorMetricConditionType],null,true));var args=!!cs.unitKeyContext?["2048137"]:["2048130"],values=!!cs.unitKeyContext?[cs.unitKeyContext]:[key];ac.push(um.createActionObject(null,mstrUpdateManager.REPORT_WRITER_EVENT_UNSET_SELECTOR_CONTROL,bp,args,values,[]));}if("EditSelectorMultiSelect" in deltas){if(!("EditSelectorStyle" in deltas&&"EditSelectorOrientation" in deltas)){cs.setStyle(cs.ctlStyle,cs.ctlOrientation,deltas.EditSelectorMultiSelect);}}if("DataFilterMode" in deltas){var tgtFld="EditSelectorTargets"+suffix;if(!(tgtFld in deltas)){var val=deltas.DataFilterMode;this.parentBone.formattingAttributes[key]["dfm"]=val;if(val!=-1){ac.push(um.createActionObject(null,mstrUpdateManager.RW_SET_CONTROL_DATA_FILTER_MODE,bp,["2048130","2048187"],[key,val],[]));forceSubmit=true;}}}var that=this;var wireTarget=function(){var type;var dfm=-1;var addDFM=false;if("EditSelectorType" in deltas){type=deltas.EditSelectorType;s=(type=="2")?"Metrics":suffix;}else{type=microstrategy.getViewerBone().commands.queryState("EditSelectorType");s=(type=="2")?"Metrics":suffix;}if(type=="1"&&cs.ctlTargetType==mstrRWControlImpl.CTL_TARGET_TYPE_DATASET){s="Dataset";}var tgtFld="EditSelectorTargets"+s,aid=["2048129","2048116"],aval=["",deltas[tgtFld]];if(cs.ctlTargetType!==null&&cs.ctlTargetType!==undefined){aid.push("2048260");aval.push(cs.ctlTargetType);}if(tgtFld in deltas){if("DataFilterMode" in deltas){var dfm=deltas.DataFilterMode;if(dfm&&dfm!="-1"){that.parentBone.formattingAttributes[key]["dfm"]=dfm;aid.push("2048187");aval.push(dfm);}}if(type==mstrRWControlImpl.CTL_TYPE_TRANSACTION_ACTION&&(deltas.TXNSubmitInOrder||cs.sio)){while(aid.length<7){aid.push("");aval.push("");}aid.push("2048280");aval.push("1");}cs.targetKeys=deltas[tgtFld].split(CLIPBOARD_ITEM_SEPARATOR);fnAO("SET_TARGETS",aid,aval);return true;}else{if(type=="1"&&"isDSAsTarget" in deltas){aval=["","",0];cs.targetKeys=[];fnAO("SET_TARGETS",aid,aval);}else{if(deltas.EditSelectorType=="2"){var sel=microstrategy.getViewerBone().commands.queryState("EditSelectorTargetsMetrics"),v=[];for(var i in sel){v.push(sel[i].dssid);}fnAO("SET_TARGETS",aid,["",v.join(CLIPBOARD_ITEM_SEPARATOR)]);}else{if(type==mstrRWControlImpl.CTL_TYPE_ATTR_LIST){if("EditSelectorTargetsAttributes" in deltas){cs.targetKeys=deltas.EditSelectorTargetsAttributes.split(CLIPBOARD_ITEM_SEPARATOR);aval=["",deltas.EditSelectorTargetsAttributes];fnAO("SET_TARGETS",aid,aval);}if("EditSelectorCandidateAttributes" in deltas){var atts=deltas.EditSelectorCandidateAttributes.split(CLIPBOARD_ITEM_SEPARATOR);var ids=[],types=[],cAtts=[];atts.forEach(function(att){var values=att.split("|");ids.push(values[0]);types.push(values[1]);cAtts.push({dssid:att,n:values[2],sty:values[1]});});cs.candidateAtts=cAtts;aid=["","","","","","2048278","2048279"];aval=["","","","","",ids.join(CLIPBOARD_ITEM_SEPARATOR),types.join(CLIPBOARD_ITEM_SEPARATOR)];fnAO("SET_TARGETS",aid,aval);}return true;}else{return false;}}}}};if(cs.ctlType==mstrRWControlImpl.CTL_TYPE_PANEL_STACK&&cs.groupByTargetKeys){cs.groupByTargetKeys=null;}if(!microstrategy.getViewerBone().autoWire){wireTarget();}else{if(!wireTarget()){var subsection=microstrategy.findBone(this.parentBone.commands.queryState("selectedSection"));var keys;if(cs.ctlType==mstrRWControlImpl.CTL_TYPE_PANEL_STACK){var ps=subsection.findObjects(microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);cs.targetKeys=ps.length>0?ps[0].getAttribute("id"):"";keys=cs.targetKeys;}else{var subSection=microstrategy.findBone(this.parentBone.commands.queryState("selectedSection"));var targets=subSection.findObjects(microstrategy.SUBOBJTYPE_DOC_TEMPLATE);targets=targets.concat(subSection.findObjects(microstrategy.SUBOBJTYPE_DOC_PANEL_STACK));var kArr=[];var map={};for(var i=0,len=targets.length;i<len;i++){var tb=microstrategy.findBone(targets[i])||targets[i];var objId=(tb.objId||tb.id);if(map[objId]!=true){kArr.push(objId);map[objId]=true;}}cs.targetKeys=kArr;keys=kArr.join(CLIPBOARD_ITEM_SEPARATOR);}fnAO("SET_TARGETS",["2048129","2048116"],["",keys]);}}if("selectorCurrentStateUC" in deltas||"selectorCurrentState" in deltas||(srcProp in deltas&&("EditSelectorStyle" in deltas||microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE))){var args=!!cs.unitKeyContext?["2048137"]:["2048130"],values=!!cs.unitKeyContext?[cs.unitKeyContext]:[key];if("selectorCurrentStateUC" in deltas){this.parentBone.formattingAttributes[key]["isUs"]=deltas.selectorCurrentStateUC;}ac.push(um.createActionObject(null,mstrUpdateManager.REPORT_WRITER_EVENT_UNSET_SELECTOR_CONTROL,bp,args,values,[]));}if("selectorCurrentState" in deltas||"UnsetCount" in deltas){var args=!!cs.unitKeyContext?["2048137"]:["2048130"],values=!!cs.unitKeyContext?[cs.unitKeyContext]:[key];args[args.length]="2048204";if("UnsetCount" in deltas){values[values.length]=deltas.UnsetCount;this.parentBone.formattingAttributes[key]["usc"]=deltas.UnsetCount;}else{values[values.length]=this.parentBone.formattingAttributes[key]["usc"];}args[args.length]="2048203";if("selectorCurrentState" in deltas){values[values.length]=deltas.selectorCurrentState;this.parentBone.formattingAttributes[key]["ust"]=deltas.selectorCurrentState;}else{values[values.length]=this.parentBone.formattingAttributes[key]["ust"];}ac.push(um.createActionObject(null,mstrUpdateManager.REPORT_WRITER_EVENT_CHANGE_UNSET_SELECTOR_PROPERTIES,bp,args,values,[]));}if("actionSelectorType" in deltas){var args=!!cs.unitKeyContext?["2048137"]:["2048130"],values=!!cs.unitKeyContext?[cs.unitKeyContext]:[key];cs.ast=deltas.actionSelectorType;cs.updateDisplayText();args.push("2048226");values.push(deltas.actionSelectorType);ac.push(um.createActionObject(null,mstrUpdateManager.SET_CTL_ACTIONS,bp,args,values,[]));}if(cs.ast=="8"&&("postSubmitOption" in deltas||"runReportDocId" in deltas||"ShowSubmitMessage" in deltas||"SubmitMessage" in deltas||"ForceLiveExecution" in deltas||"InvalidateCache" in deltas||"AutoAnswerPrompt" in deltas)){this.processSelectorSubsequentChanges(deltas,cs,ac);}if(cs.ast=="8"||cs.ast=="4"){if("DisplayConfirmation" in deltas){cs.dpCfm=deltas.DisplayConfirmation;ac.push(um.createEditPropsAction(null,key,bp,["DisplayConfirmation"],[deltas.DisplayConfirmation],null,false));}if("OfflineSubmission" in deltas){cs.os=deltas.OfflineSubmission;ac.push(um.createEditPropsAction(null,key,bp,["OfflineSubmission"],[deltas.OfflineSubmission],null,false));}if("TXNSubmitInOrder" in deltas){cs.sio=deltas.TXNSubmitInOrder;ac.push(um.createEditPropsAction(null,key,bp,["TXNSubmitInOrder"],[deltas.TXNSubmitInOrder],null,false));}}if("DisplayText" in deltas){var args=!!cs.unitKeyContext?["2048137"]:["2048130"],values=!!cs.unitKeyContext?[cs.unitKeyContext]:[key];cs.dpTxt=deltas.DisplayText;cs.updateDisplayText();args.push("2048234");values.push(cs.dpTxt);ac.push(um.createActionObject(null,mstrUpdateManager.SET_CTL_DISPLAY_TEXT,bp,args,values,[]));}if("EditSelectorSelectionType" in deltas){var v=deltas.EditSelectorSelectionType;ac.push(um.createActionObject(null,mstrUpdateManager.CTRL_SET_INCLUDE,bp,["2048130","2048224","2048001","2048009"],[key,v,cs.ctlSrcId,cs.ctlSrcType],[]));if(v==="0"){deltas.EditSelectorShowAll=false;}}for(var evt in eventMap){var p="EditSelector"+evt;if(p in deltas){var e=eventMap[evt];var v=deltas[p];if(!e.c){v=(v)?1:0;}fnAO(e.e,["2048"+e.a],[v]);}}}catch(err){microstrategy.errors.log(err);}return(forceSubmit||microstrategy.DISPLAY_MODE==microstrategy.VIEW_MODE);};mstrDocSelectionsImpl.prototype.processSelectorSubsequentChanges=function(deltas,cs,ac){var um=microstrategy.updateManager,bp=this.parentBone.parentBone.beanPath,key=cs.ctlKey,args=!!cs.unitKeyContext?["2048137"]:["2048130"],values=!!cs.unitKeyContext?[cs.unitKeyContext]:[key],ssActs={shSubMsg:"ShowSubmitMessage",fcLvExec:"ForceLiveExecution",invCache:"InvalidateCache",aapm:"AutoAnswerPrompt"},SHOW_SUBMIT_MSG=1,FORCE_EXEC=268435456,INVALIDATE_CACHE=536870912,AUTO_ANSWER_PROMPT=1073741824;for(var n in ssActs){if(!(n in cs)){cs[n]=false;}if(ssActs[n] in deltas){cs[n]=deltas[ssActs[n]];}}cs.pso=deltas.postSubmitOption||cs.pso||"0";if(cs.shSubMsg){cs.subMsg=deltas.SubmitMessage||cs.subMsg||"";args.push("2048231");values.push(cs.subMsg);}if(cs.pso=="16"){cs.execId=deltas.runReportDocId||cs.execId||"";cs.execObjTp=deltas.runObjectType||cs.execObjTp||"";cs.execName=deltas.runReportDocName||cs.execName||"";if(cs.execId){args.push("2048229","2048230","2048233");values.push(cs.execId,cs.execObjTp,cs.execName);}else{cs.pso="8";}}var ssFlag=cs.pso;if(cs.shSubMsg){ssFlag|=SHOW_SUBMIT_MSG;}if(cs.fcLvExec){if(cs.pso=="16"&&cs.execId){ssFlag|=FORCE_EXEC;}else{cs.fcLvExec=false;}}if(cs.aapm){if(cs.pso=="16"&&cs.execId){ssFlag|=AUTO_ANSWER_PROMPT;}else{cs.aapm=false;}}if(cs.invCache){ssFlag|=INVALIDATE_CACHE;}args.push("2048228");values.push(ssFlag);ac.push(um.createActionObject(null,mstrUpdateManager.SET_CTL_SUBSEQUENT_ACTIONS,bp,args,values,[]));};mstrDocSelectionsImpl.prototype.processRoundedCornerChanges=function(deltas,ac){try{if(!deltas){return ;}if("HasRoundedCorners" in deltas){this.processFormatProperty(this.setSingleFormat("HasRoundedCorners",deltas.HasRoundedCorners),ac);}var that=this;var fnBL=function(b,p){return(b)?deltas[p]:that.parentBone.commands.queryState(p);};var cr=("Radius" in deltas);var cc=("TopCornersOnly" in deltas);var rad=fnBL(cr,"Radius");var fnSF=function(p){that.processFormatProperty(that.setSingleFormat(p+"CornerRadius",rad),ac);};if(cr){fnSF("topLeft");fnSF("topRight");}if(cr||cc){rad=(fnBL(cc,"TopCornersOnly"))?0:rad;fnSF("bottomLeft");fnSF("bottomRight");}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.getSelectedControlBone=function(subType){try{var controlObj=this.getSelectedControl(subType);if(controlObj){return mstrStaticDoc.getBone(controlObj);}}catch(err){microstrategy.errors.log(err);}return null;};mstrDocSelectionsImpl.prototype.processGraphPropertyChanges=function(items,gridPosition,gridFactor,actionCollection){try{for(var item in items){var id=items[item].getAttribute("id");var objs=document.getElementsByName(id);if(objs[0].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var grid=microstrategy.findBone(objs[0]);if(grid&&grid.isGraph){gridPosition=(gridPosition==null)?grid.commands.queryState("gridPosition"):gridPosition;gridFactor=(gridFactor==null)?grid.commands.queryState("gridFactor"):gridFactor;grid.adjustGraphSize(gridPosition,gridFactor,actionCollection);if(this.parentBone.commands.refreshOnWindowChange(items[item],microstrategy.findBone(items[item]))){return true;}}}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.setFormat=function(formatId,formatValue,allPanels){try{var updateManager=this.parentBone.parentBone.updateManager;var submitUpdateManager=false;var actionCollection=[];var propValue=null;switch(formatId){case"formatBulk":for(var i=0;i<formatValue.length;i++){var oneFormat=formatValue[i].split("|");var newFormatId=oneFormat[0];var newFormatValue=oneFormat[1];switch(newFormatId){case"borderTop":case"borderRight":case"borderLeft":case"borderBottom":var aux=newFormatValue.split(",");var color=(aux.length>0)?aux[0]:"";var width=(aux.length>1)?aux[1]:"";var style=(aux.length>2)?aux[2]:"";actionCollection=this.parentBone.formatItemBorders(this.items,new Array(newFormatId),style,width,color,false,actionCollection);break;case"LineSettingColor":case"LineSettingWeight":case"LineSettingStyle":var prop="lineColor";if(newFormatId=="LineSettingWeight"){prop="lineWeight";}else{if(newFormatId=="LineSettingStyle"){prop="lineStyle";}}this.parentBone.formatLineSetting(this.items,prop,newFormatValue,false,actionCollection);break;case"FillColor":this.processFormatProperty(this.setSingleFormat(newFormatId,newFormatValue),actionCollection,allPanels);if(newFormatValue.indexOf(",")<0){this.processFormatProperty(this.setSingleFormat("FillStyle",newFormatValue),actionCollection,allPanels);}this.parentBone.format3DItems(this.items,null,null,actionCollection);break;case"border3D":var aux=newFormatValue.split(",");var weight=(aux.length>0)?aux[1]:"";var style=(aux.length>1)?aux[0]:"";this.parentBone.format3DItems(this.items,style,weight,actionCollection);if(actionCollection.forceSubmit){submitUpdateManager=true;}break;default:this.processFormatProperty(this.setSingleFormat(newFormatId,newFormatValue),actionCollection);}}microstrategy.eventManager.notifyOrphanBones("onformatchange");break;case"PropertyChanges":this.processPropertyChanges(formatValue);break;case"FillColor":case"bgcolor":this.processFormatProperty(this.setSingleFormat("FillColor",formatValue),actionCollection,allPanels);if(formatValue.indexOf(",")<0){this.processFormatProperty(this.setSingleFormat("FillStyle",formatValue),actionCollection,allPanels);}this.parentBone.format3DItems(this.items,null,null,actionCollection);break;case"bgcolorgradient":this.processFormatProperty(this.setSingleFormat("Gradient",formatValue),actionCollection,allPanels);this.parentBone.format3DItems(this.items,null,null,actionCollection);break;default:this.processFormatProperty(this.setSingleFormat(formatId,formatValue),actionCollection);}if(actionCollection&&actionCollection.length>0){updateManager.add(actionCollection);}if(submitUpdateManager==true&&actionCollection.length>0){updateManager.flushAndSubmitChanges();}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.setCommonBoneProperty=function(items,boneProp,prop,value,sty,actionCollection){try{var format=mstrFormatObject;var updateManager=this.parentBone.parentBone.updateManager;for(var id in items){if(items[id].getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT&&items[id].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==sty){var bone=mstrStaticDoc.getBone(items[id]);if(bone){bone[boneProp]=value;var propData=bone.ctlKey+mstrUpdateManager.UNIT_SEPARATOR+format[prop][mstrFormatObject.PROP_SET]+mstrUpdateManager.UNIT_SEPARATOR+prop+mstrUpdateManager.UNIT_SEPARATOR+value;actionCollection.push(updateManager.createActionObject(null,mstrUpdateManager.EDIT_PROPS,this.parentBone.parentBone.beanPath,["2048018","2048035"],[mstrUpdateManager.UPDATE_NOW,propData],[]));}}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.setSingleFormat=function(formatId,formatValue){try{var toReturn=[];toReturn=microstrategy.setSingleFormat(formatId,formatValue);return toReturn;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.setNumberFormat=function(formatId,formatValue){try{var um=microstrategy.updateManager;var evtId=mstrUpdateManager.FIELD_NUMBER_FORMAT;var bp=this.parentBone.parentBone.beanPath;var args=[2048012,2048183];var value=formatValue;if(formatId=="number"){args[1]=args[1]+parseInt(formatValue,10);value=1;}var items=this.parentBone.selections.items;for(var id in items){um.add([um.createActionObject(items[id],evtId,bp,args,[id,value],[],null)]);}if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){um.flushAndSubmitChanges();}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.setBorderFormat=function(formatId,formatValue){try{var ac=[];var width="";var style="";var color="";this.parentBone.format3DItems(this.items,"0",null,ac);if(formatId=="lnstyle"){var parts=microstrategy.getFormatObject().decodeValue("borderTopStyle",formatValue).split(" ");width=parts[0];style=parts[1];}else{color=formatValue;}for(var id in this.items){var o=this.items[id];var arr={id:this.items[id]};var itemStyle=style;var itemWidth=width;var itemColor=color;var subType=microstrategy.subObjectType(o);if(subType==microstrategy.SUBOBJTYPE_DOC_LINE||subType==microstrategy.SUBOBJTYPE_DOC_SHAPE){if(subType==microstrategy.SUBOBJTYPE_DOC_LINE){var parsedWidth=Math.ceil(parseFloat(width))+"pt";if(formatId=="lnstyle"&&(!parsedWidth||parseInt(parsedWidth,10)==0)){continue;}else{itemWidth=parsedWidth;}}else{if(this.styleObj.getValue(o,"lineStyle").indexOf("none")>-1||this.styleObj.getValue(o,"lineWeight").indexOf("0pt")>-1){itemStyle=itemStyle||mstrDocSelectionsImpl.DEFAULT_LINE_STYLE;itemWidth=itemWidth||mstrDocSelectionsImpl.DEFAULT_LINE_WIDTH;itemColor=itemColor||mstrDocSelectionsImpl.DEFAULT_LINE_COLOR;}}if(itemStyle){this.parentBone.formatLineSetting(arr,"lineStyle",itemStyle,true,ac);}if(itemWidth){this.parentBone.formatLineSetting(arr,"lineWeight",itemWidth,true,ac);}if(itemColor){this.parentBone.formatLineSetting(arr,"lineColor",itemColor,true,ac);}}else{var selections=this.checkborders(o);if(selections==mstrDocSelectionsImpl.NOBORDERS){selections=mstrDocSelectionsImpl.ALLBORDERS;itemStyle=itemStyle||mstrDocSelectionsImpl.DEFAULT_LINE_STYLE;itemWidth=itemWidth||mstrDocSelectionsImpl.DEFAULT_LINE_WIDTH;itemColor=itemColor||mstrDocSelectionsImpl.DEFAULT_LINE_COLOR;}var props=[];var borders=["Top","Bottom","Left","Right"];for(var i=0;i<4;i++){var b=borders[i];if(selections==mstrDocSelectionsImpl.ALLBORDERS||(mstrDocSelectionsImpl[b.toUpperCase()+"BORDER"]&selections)>0){props.push("border"+b);}}this.parentBone.formatItemBorders(arr,props,itemStyle,itemWidth,itemColor,true,ac);}}if(this.parentBone.parentBone.observer){this.parentBone.parentBone.observer.notifyAll("onBorderStyleChange");}if(ac.length>0){microstrategy.updateManager.add(ac);}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.enableBorders=function(formatValues){try{var ac=[];this.parentBone.format3DItems(this.items,"0",null,ac);var borderMap={};borderMap[mstrDocSelectionsImpl.TOPBORDER]="Top";borderMap[mstrDocSelectionsImpl.BOTTOMBORDER]="Bottom";borderMap[mstrDocSelectionsImpl.LEFTBORDER]="Left";borderMap[mstrDocSelectionsImpl.RIGHTBORDER]="Right";for(var i=0,cnt=formatValues.length;i<cnt;i++){var delta=formatValues[i];var width=(delta.cl)?mstrDocSelectionsImpl.DEFAULT_LINE_WIDTH:"0pt";var style=mstrDocSelectionsImpl.DEFAULT_LINE_STYLE;var color=mstrDocSelectionsImpl.DEFAULT_LINE_COLOR;var props=[];var v=parseInt(delta.v[0],10);if(v==mstrDocSelectionsImpl.NOBORDERS||v==mstrDocSelectionsImpl.ALLBORDERS){props=["borderTop","borderRight","borderBottom","borderLeft"];if(v==mstrDocSelectionsImpl.NOBORDERS){width="0pt";}}else{for(var j=0,len=delta.v.length;j<len;j++){props.push("border"+borderMap[delta.v[j]]);}}this.parentBone.formatItemBorders(this.items,props,style,width,color,true,ac);}this.parentBone.parentBone.updateManager.add(ac);}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.checkFormat=function(formatId,allPanels){try{var format=microstrategy.getFormatObject();var prop=null;var local=null;var item,i;var id,value,firstValue;var firstItem=this.firstItem();var isOnlyPanels=(this.isSingleSelectionType&&firstItem&&(firstItem.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK));var tc=this.isOnlyOneTableSelected()&&this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);if(microstrategy.findBone(this.firstItem())!=null){isOnlyPanels&=!microstrategy.findBone(this.firstItem()).isTable;}var isOneGrid=this.isOnlyOneGridSelected();var isSelectorControl=this.isSelectorControlSelected();var tblFmtId=mstrDocSelectionsImpl.TCF[formatId];if(tc&&parseInt(this.panelUnitFormat)>1&&tblFmtId){switch(formatId){case"font":case"fsize":case"TextUnderline":case"TextStrikeout":case"color":case"FillColor":case"LineSettingColor":case"LineSettingWeight":return tc.getFormat({u:this.panelUnitFormat,f:this.panelValueFormat,p:tblFmtId});case"ShapeSettingStyle":return format.encodeValue("lineStyle",tc.getFormat({u:this.panelUnitFormat,f:this.panelValueFormat,p:tblFmtId}));case"BoldItalic":var fb=tc.getFormat({u:this.panelUnitFormat,f:this.panelValueFormat,p:"fb"}),fi=tc.getFormat({u:this.panelUnitFormat,f:this.panelValueFormat,p:"fi"});return(fb?1:0)+(fi?2:0);}}switch(formatId){case"Wmode11":case"Wmode12":case"Wmode13":case"Wmode":return(this.isActive())?this.parentBone.commands.getCommonAttValue(this.items,microstrategy.HTMLATTR_WIDTH_MODE,"widthMode"):"";case"Hmode11":case"Hmode12":case"Hmode13":case"Hmode":return(this.isActive())?this.parentBone.commands.getCommonAttValue(this.items,microstrategy.HTMLATTR_HEIGHT_MODE,"heightMode"):"";case"Lmode":return this.evaluateLineProperties(this.items,"lengthMode");case"Width":case"SubWidth":local=this.parentBone.commands.getCommonAttValue(this.items,microstrategy.HTMLATTR_WIDTH,"width");return(this.isActive()&&local!=null&&local.length!=0)?microstrategy.number.toUserUnits(local):"";case"Height":case"SubHeight":local=this.parentBone.commands.getCommonAttValue(this.items,microstrategy.HTMLATTR_HEIGHT,"height");return(this.isActive()&&local!=null&&local.length!=0)?microstrategy.number.toUserUnits(local):"";case"Length":return this.evaluateLineProperties(this.items,"length");case"AutoResize":return(this.isActive())?this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_AUTO_RESIZE_IN_DESIGNMODE):"";case"Shrink":var val=this.getFormatFromHContainer(microstrategy.HTMLATTR_CAN_SHRINK);if(val!=undefined){return val==-1;}return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_CAN_SHRINK)==-1);case"ShrinkHorizontal":return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_CAN_SHRINK_HORIZONTAL)==-1);case"Grow":var val=this.getFormatFromHContainer(microstrategy.HTMLATTR_CAN_GROW);if(val!=undefined){return val==-1;}return this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_CAN_GROW)==-1;case"SelectionColor":return(this.isActive())?((this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_SELECTOR_SELECTION_STYLE)=="1")?this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_SELECTOR_SELECTION_COLOR):"automatic"):"automatic";case"GrowHorizontal":return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_CAN_GROW_HORIZONTAL)==-1);case"HideIfEmpty":return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_HIDE_IF_EMPTY)==-1);case"MaxHeight":return(this.isActive())?microstrategy.number.toUserUnits(this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_MAX_HEIGHT)):"";case"MaxWidth":return(this.isActive())?microstrategy.number.toUserUnits(this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_MAX_WIDTH)):"";case"FitExcelRowHeight":return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_FIT_EXCEL_ROW_HEIGHT)==-1);case"Keep":return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_KEEP_SECTION_TOGETHER)==-1);case"Repeat":return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_REPEAT_SECTION)==-1);case"showInRptCp":return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_SHOW_IN_RPT_COPY)==-1);case"RepeatHoriz":return(this.isActive()&&this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_REPEAT_HORIZONTALLY)==-1);case"NewPage":return(this.isActive())?this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_FORCE_NEW_PAGE):"";case"Locked":local=this.parentBone.commands.getCommonAttValue(this.items,microstrategy.HTMLATTR_LOCKED,"locked");return(this.isActive()&&local!=null&&local.length!=0&&local==-1);case"InitialSlidingInWidth":local=(this.isActive())?this.getCommonFormatValue(this.items,"InitialSlidingInWidth",microstrategy.FORMAT_TYPE_MAIN):0;if(local==null||local.length==0){return"";}return(local==0)?"0":microstrategy.number.toUserUnits(format.encodeValue("InitialSlidingInWidth",local));case"InitialSlidingInHeight":local=(this.isActive())?this.getCommonFormatValue(this.items,"InitialSlidingInHeight",microstrategy.FORMAT_TYPE_MAIN):0;if(local==null||local.length==0){return"";}return(local==0)?"0":microstrategy.number.toUserUnits(format.encodeValue("InitialSlidingInHeight",local));case"Left":local=(this.isActive())?this.getCommonFormatValue(this.items,"left",microstrategy.FORMAT_TYPE_MAIN):0;if(local==null||local.length==0){return"";}return(local==0)?"0":microstrategy.number.toUserUnits(format.encodeValue("left",parseInt(local)));case"Top":local=(this.isActive())?this.getCommonFormatValue(this.items,"top",microstrategy.FORMAT_TYPE_MAIN):0;if(local==null||local.length==0){return"";}return(local==0)?"0":microstrategy.number.toUserUnits(format.encodeValue("top",parseInt(local)));case"LineSpacing":value=this.getCommonFormatValue(this.items,"lineHeight");if(value!=null){value=format.encodeValue("lineHeight",value);}return value;case"Horizontal":case"align":case"TextAlign":if(this.isOnlyOneGridSelected()){return this.getCommonFormatValue(this.items,"textAlign","GRID");}else{local=format.encodeValue("textAlign",this.getCommonFormatValue(this.items,"textAlign"));return(isNaN(local))?0:local;}case"Vertical2":if(this.isOnlyOneGridSelected()){return this.getCommonFormatValue(this.items,"verticalAlign","GRID");}else{return format.encodeValue("verticalAlign2",this.getCommonFormatValue(this.items,"verticalAlign"));}break;case"Vertical":if(!this.isGridSelected()){local=format.encodeValue("verticalAlign",this.getCommonFormatValue(this.items,"verticalAlign"));return local;}break;case"lnsize":return this.getCommonFormatValue(this.items,borderWidth);case"LineSettingColor":case"ShapeSettingStyle":case"LineSettingStyle":case"LineSettingWeight":case"lncolor":case"lnstyle":value="";var styleprop=microstrategy.HTMLATTR_LINE_COLOR;prop="lineColor";if(formatId=="LineSettingWeight"){styleprop=microstrategy.HTMLATTR_LINE_WEIGHT;prop="lineWeight";}else{if(formatId=="LineSettingStyle"||formatId=="ShapeSettingStyle"){styleprop=microstrategy.HTMLATTR_LINE_STYLE;prop="lineStyle";}else{if(formatId=="lncolor"){styleprop=microstrategy.HTMLATTR_BORDER_TOP_COLOR;prop="borderTopColor";}else{if(formatId=="lnstyle"){styleprop=microstrategy.HTMLATTR_BORDER_TOP_STYLE;prop="borderTopStyle";}}}}if(this.isActive()){firstItem=true;for(id in this.items){if(microstrategy.subObjectType(this.items[id])==microstrategy.SUBOBJTYPE_DOC_LINE||microstrategy.subObjectType(this.items[id])==microstrategy.SUBOBJTYPE_DOC_SHAPE){if(formatId=="lncolor"){styleprop=microstrategy.HTMLATTR_LINE_COLOR;prop="lineColor";}else{if(formatId=="lnstyle"){styleprop=microstrategy.HTMLATTR_LINE_STYLE;prop="lineStyle";}}}var tS,tW,tsDecoded,encoded;if(this.parentBone.checkAppliesTo(this.items[id],prop)){if(firstItem){value=this.styleObj.getAttValue(this.items[id],styleprop);if(formatId=="lnstyle"){if(microstrategy.subObjectType(this.items[id])==microstrategy.SUBOBJTYPE_DOC_LINE||microstrategy.subObjectType(this.items[id])==microstrategy.SUBOBJTYPE_DOC_SHAPE){tS=value;tW=this.styleObj.getAttValue(this.items[id],"lw");tsDecoded=format.decodeValue("lineStyle",tS);encoded=format.encodeValue("borderTopStyle",tW+"pt "+tsDecoded);value=encoded;}}firstItem=false;if(this.hasNoBorder(this.items[id])){return 0;}}local="";local=this.styleObj.getAttValue(this.items[id],styleprop);if(formatId=="lnstyle"){if(microstrategy.subObjectType(this.items[id])==microstrategy.SUBOBJTYPE_DOC_LINE||microstrategy.subObjectType(this.items[id])==microstrategy.SUBOBJTYPE_DOC_SHAPE){tS=local;tW=this.styleObj.getAttValue(this.items[id],"lw");tsDecoded=format.decodeValue("lineStyle",tS);encoded=format.encodeValue("borderTopStyle",tW+"pt "+tsDecoded);local=encoded;}}if(local!=value){return null;}}}}return(formatId.toLowerCase().indexOf("color")>0)?format.decodeValue("borderRightColor",value):value;break;case"enabled3d":if(this.isActive()){for(id in this.items){value=this.styleObj.getAttValue(this.items[id],"b3dstyle");if(value!="1"&&value!="2"){return 0;}}return 1;}return 0;case"b3dstyle":case"b3dweight":if(this.isActive()){firstValue=this.styleObj.getAttValue(this.firstItem(),formatId);value=null;for(id in this.items){value=this.styleObj.getAttValue(this.items[id],formatId);if(value!=firstValue){return null;}}if(formatId=="b3dstyle"&&parseInt(value)==0){value=1;}return value;}return false;case"DisplayStyle":return this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_DISPLAY_STYLE);case"NormalURL":return this.parentBone.commands.getCommonAttValue(this.items,microstrategy.HTMLATTR_NORMAL_URL);case"HighlightURL":return this.parentBone.commands.getCommonAttValue(this.items,microstrategy.HTMLATTR_HIGHLIGHT_URL);case"BackgroundHighlightColor":var higlightColor=this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_BACKGROUND_HIGHLIGHT_COLOR);return mstrFormatObject.decodeValue("color",higlightColor!=null?higlightColor:"-1");case"FontHighlightColor":var fontHiglightColor=this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_FONT_HIGHLIGHT_COLOR);return mstrFormatObject.decodeValue("color",fontHiglightColor!=null?fontHiglightColor:"-1");case"FillEffect":return this.parentBone.commands.getCommonAttValue(this.items,microstrategy.HTMLATTR_FILL_EFFECT);}var gridFormatType=null;var resolvedFormatType=null;if(this.isOnlyOnePanelStackSelected()){resolvedFormatType=this.panelValueFormat+1;}else{if(this.isSelectorControlSelected()){resolvedFormatType=this.controlValueFormat+1;}else{if(isOneGrid){if(this.resolveGridFormat().unit>microstrategy.GRID_UNIT_CONTAINER){resolvedFormatType="GRID";}else{if(this.gridValueFormatX==2){resolvedFormatType=2;}}gridFormatType=resolvedFormatType;}}}var v;switch(formatId){case"BoldItalic":var b=this.getCommonFormatValue(this.items,"fontWeight",resolvedFormatType),i=this.getCommonFormatValue(this.items,"fontStyle",resolvedFormatType);if(b==i&&i=="default"){return -2;}var style=0;if(b=="bold"){style+=1;}if(i=="italic"){style+=2;}return style;case"TextUnderline":v=this.getCommonFormatValue(this.items,"textDecoration",resolvedFormatType);return(v&&v.indexOf("underline")>-1);case"TextStrikeout":v=this.getCommonFormatValue(this.items,"textDecoration2",resolvedFormatType);return(v&&v.indexOf("line-through")>-1);case"Bold":return(this.getCommonFormatValue(this.items,"fontWeight",resolvedFormatType)=="bold");case"Italic":return(this.getCommonFormatValue(this.items,"fontStyle",resolvedFormatType)=="italic");case"Underline":v=this.getCommonFormatValue(this.items,"textDecoration",resolvedFormatType);return(v&&v.indexOf("underline")>-1);case"fstyle":var fstyle=this.checkFormat("BoldItalic");if(this.checkFormat("TextUnderline")){fstyle+=4;}if(this.checkFormat("TextStrikeout")){fstyle+=8;}return fstyle;case"FontSize":case"fsize":return format.encodeValue("fontSize",this.getCommonFormatValue(this.items,"fontSize",resolvedFormatType));case"FontColor":case"color":return this.getCommonFormatValue(this.items,"color",resolvedFormatType);case"FontFamily":case"font":return this.getCommonFormatValue(this.items,"fontFamily",resolvedFormatType);case"FillColor":var gradientColor=this.checkFormat("gradientcolor");if(gradientColor){return gradientColor;}case"bgcolor":prop="backgroundColor";if(isOnlyPanels||tc){if(tc){if(this.panelValueFormat==0){var b=microstrategy.findBone(this.firstItem());value=this.styleObj.getValue(b.getCurrentPanel().elem,prop);for(id in this.items){b=microstrategy.findBone(this.items[id]);local=this.styleObj.getValue(b.getCurrentPanel().elem,prop);if(local!=value){return null;}}return value;}return null;}else{if(this.panelValueFormat==0){var b=microstrategy.findBone(this.firstItem());value=this.styleObj.getValue(b.getCurrentPanel().elem,prop);for(id in this.items){b=microstrategy.findBone(this.items[id]);local=this.styleObj.getValue(b.getCurrentPanel().elem,prop);if(local!=value){return null;}}}else{value=this.styleObj.getValue(this.firstItem(),prop,mstrPanelStack.FMT_TYPE_TITLE);for(id in this.items){local=this.styleObj.getValue(this.items[id],prop,mstrPanelStack.FMT_TYPE_TITLE);if(local!=value){return null;}}}return value;}}else{if(isSelectorControl&&this.isSingleSelectionType){if(this.controlValueFormat==0){var b=microstrategy.findBone(this.firstItem().lastChild);value=this.styleObj.getValue(b.elem.parentNode,prop);}else{value=this.styleObj.getValue(this.firstItem(),prop,mstrRWControlImpl.FMT_TYPE_TITLE);}return value;}else{return this.getCommonFormatValue(this.items,prop,resolvedFormatType||microstrategy.formatType);}}case"gradientcolor":item=this.firstItem();if(item){value=this.parentBone.getGradientColor(((item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL&&microstrategy.formatType==mstrRWControlImpl.FMT_TYPE_TITLE)?item.lastChild:item),resolvedFormatType||microstrategy.formatType,allPanels);if(item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){return value;}for(id in this.items){if(this.items[id]!=item){local=this.parentBone.getGradientColor(this.items[id],resolvedFormatType||microstrategy.formatType,allPanels);if(local!=value){return null;}}}}return value;case"propBorderStyle":case"propButtonBorderStyle":if(this.isOnlyOnePanelStackSelected()&&this.panelValueFormat==1){return 0;}else{if(isOneGrid&&this.isGridContainerSelected()&&this.gridValueFormatX==2){return 0;}else{if(gridFormatType){return this.styleObj.getValue(this.firstItem(),formatId,gridFormatType);}else{return this.checkBorderStyle();}}}case"AllColor":var curValue=this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_BORDER_LEFT_COLOR,gridFormatType);return(curValue&&(typeof (curValue)!="string"||curValue.indexOf("#")==-1))?format.decodeValue("borderLeftColor",curValue):curValue;case"AllStyle":var lftBorder=this.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_BORDER_LEFT_STYLE,gridFormatType);return(lftBorder==0)?1:lftBorder;case"TopColor":case"LeftColor":case"RightColor":case"BottomColor":case"TopStyle":case"LeftStyle":case"RightStyle":case"BottomStyle":if(!this.isActive()){return null;}var isStyle=(formatId.indexOf("Style")>-1);var p=(isStyle)?"Style":"Color";prop=microstrategy["HTMLATTR_BORDER_"+formatId.replace(p,"").toUpperCase()+"_"+p.toUpperCase()];v=this.styleObj.getAttValue(this.firstItem(),prop,gridFormatType);for(id in this.items){if(this.styleObj.getAttValue(this.items[id],prop,gridFormatType)!=v){return null;}}if(isNaN(v)&&(v==""||v==null)){return null;}if(!isStyle&&v!=null&&(typeof (v)!="string"||v.indexOf("#")==-1)){v=format.decodeValue("borderLeftColor",v);}return v;case"borders":case"Borders":if(gridFormatType){return this.styleObj.getValue(this.firstItem(),formatId,gridFormatType);}else{firstValue=this.checkborders(this.firstItem());value=0;for(id in this.items){value=this.checkborders(this.items[id]);if(value!=firstValue){return[0];}}return microstrategy.resolveBorderFlags(value,(formatId=="borders"));}case"GridHorizontal":case"Vertical":var cmd=(formatId=="Vertical")?"verticalAlign":"textAlign2";local=this.getCommonFormatValue(this.items,cmd,gridFormatType);return(isNaN(local))?0:local;case"SelectorVertical":local=format.encodeValue("verticalAlign",this.getCommonFormatValue(this.items,"verticalAlign",gridFormatType));return(isNaN(local))?0:local;case"TextWrap":return(this.getCommonFormatValue(this.items,"whiteSpace",gridFormatType)!="nowrap");case"TextDirection":case"TextDirectionGrid":return this.getCommonFormatValue(this.items,"TextDirection",gridFormatType);case"LeftPadding":case"TopPadding":case"RightPadding":case"BottomPadding":prop="paddingLeft";if(formatId=="TopPadding"){prop="paddingTop";}if(formatId=="RightPadding"){prop="paddingRight";}if(formatId=="BottomPadding"){prop="paddingBottom";}value=this.getCommonFormatValue(this.items,prop,gridFormatType);if(value!=null){value=microstrategy.number.toUserUnits(parseFloat(value)/72);}return value;}}catch(err){microstrategy.errors.log(err);}return"";};mstrDocSelectionsImpl.prototype.getFormatFromHContainer=function(format){if(!this.isActive()){return false;}var fib=microstrategy.findBone(this.firstItem());if(fib&&fib.isHorizontal){var container=microstrategy.findAncestorWithAtt(this.firstItem(),microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_DOC_HORIZONTAL_CONTAINER);if(container){return this.styleObj.getAttValue(container,format);}}};mstrDocSelectionsImpl.prototype.getGridFormatInfo=function(isColorTab){if(!this.useGridFormat(isColorTab)){return null;}var u=(isColorTab)?this.allGridUnitFormat:this.gridUnitFormatX;var v=(isColorTab)?this.allGridValueFormat:this.gridValueFormatX;return{unit:u,format:v};};mstrDocSelectionsImpl.prototype.useGridFormat=function(isColorTab){return(this.isOnlyOneGridSelected()&&!(isColorTab&&(this.isGridContainerSelected())));};mstrDocSelectionsImpl.prototype.getGridFormat=function(cmdId,isColorTab){var o=this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_TEMPLATE);return o.getFormatValue(this.getGridFormatInfo(isColorTab),cmdId);};mstrDocSelectionsImpl.prototype.resolveGridFormat=function(u,v){try{if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE&&u==null&&v==null){var b=this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_TEMPLATE);if(b){return b.commands.queryState("GridSelections");}}else{var o={value:v||this.gridValueFormatX};o.unit=(u==null)?this.gridUnitFormatX:u;return o;}}catch(err){microstrategy.errors.log(err);}return{};};mstrDocSelectionsImpl.prototype.resolvePanelsFormat=function(u,v){try{var o={};o.unit=(u==null)?this.panelUnitFormat:u;o.value=(v==null)?this.panelValueFormat:v;return o;}catch(err){microstrategy.errors.log(err);}return{};};mstrDocSelectionsImpl.prototype.resolveControlFormat=function(u,v){try{var o={};o.unit=(u==null)?this.controlUnitFormat:u;o.value=(v==null)?this.controlValueFormat:v;return o;}catch(err){microstrategy.errors.log(err);}return{};};mstrDocSelectionsImpl.prototype.isGridContainerSelected=function(){if(this.isOnlyOneGridSelected()){var b=microstrategy.findBone(this.getSelectedGrid()),b=b&&b.commands.queryState("isGraphSelected");if(b){return false;}}return(this.gridUnitFormatX==microstrategy.GRID_UNIT_CONTAINER);};mstrDocSelectionsImpl.prototype.resolveFormatType=function(cmdId,format){if(cmdId.indexOf("Panels")>-1){microstrategy.formatType=parseInt(format.value,10)+1;}else{if(cmdId.indexOf("Control")>-1){microstrategy.formatType=parseInt(format.value,10)+1;}else{if(parseInt(format.unit,10)==microstrategy.GRID_UNIT_CONTAINER){microstrategy.formatType=parseInt(format.value,10);}else{microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;}}}};mstrDocSelectionsImpl.prototype.verifyFormatLevels=function(tabName){try{if(!tabName){return ;}var isGrid=this.isOnlyOneGridSelected();var isPanelStack=this.isOnlyOnePanelStackSelected();var isTableControl=this.isOnlyOneTableSelected();var isSelectorControl=this.isSelectorControlSelected();if(!isGrid&&!isPanelStack&&!isSelectorControl){return ;}var newLevel=null;var type="";if(isGrid){type="Grid";if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE&&!this.isGridContainerSelected()){var min=(this.parentBone.commands.queryState("IsPortal"))?2:1;newLevel=this.resolveGridFormat(microstrategy.GRID_UNIT_CONTAINER,Math.min(this.gridValueFormatX,min));}else{switch(tabName){case"color":if(this.isGridContainerSelected()){if(!this.parentBone.commands.queryState("IsPortal")&&this.gridValueFormatX!=1){newLevel=this.resolveGridFormat(null,1);}}break;case"font":if(this.isGridContainerSelected()){if(!this.parentBone.commands.queryState("IsPortal")){newLevel=this.resolveGridFormat(microstrategy.GRID_OTHER,2);}else{if(this.gridValueFormatX!=2){newLevel=this.resolveGridFormat(null,2);}}}else{if(this.gridUnitFormatX==microstrategy.GRID_BORDERS){newLevel=this.resolveGridFormat(microstrategy.GRID_UNIT_CONTAINER,2);}}break;default:if(this.gridUnitFormatX<microstrategy.GRID_OTHER){newLevel=this.resolveGridFormat(microstrategy.GRID_OTHER,2);}break;}}}else{if(isPanelStack){type="Panels";if(tabName=="color"){if((this.panelUnitFormat==1||!this.parentBone.commands.queryState("IsPortal"))&&this.panelValueFormat==1){newLevel=this.resolvePanelsFormat(null,0);}if(isTableControl){newLevel=this.resolvePanelsFormat(0,0);}}else{if(tabName=="font"){if(this.parentBone.commands.queryState("IsPortal")){newLevel=this.resolvePanelsFormat(null,1);}}else{if(tabName="effect"){newLevel=this.resolvePanelsFormat(null,0);}}}}else{if(isSelectorControl){}}}if(newLevel){this.setObjectFormatLevel(type,newLevel);}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.resetObjectFormatLevel=function(){try{if(this.isOnlyOneGridSelected()){this.setObjectFormatLevel("Grid",this.resolveGridFormat(microstrategy.GRID_UNIT_CONTAINER,1));}else{if(this.isOnlyOnePanelStackSelected()){this.setObjectFormatLevel("Panels",this.resolvePanelsFormat(0,0));}else{if(this.isSelectorControlSelected()){this.setObjectFormatLevel("Control",this.resolveControlFormat(0,0));}}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.setObjectFormatLevel=function(cmdId,format){try{this.resolveFormatType(cmdId,format);if(cmdId.indexOf("Panels")>-1){this.panelUnitFormat=parseInt(format.unit,10);this.panelValueFormat=parseInt(format.value,10);this.parentBone.parentBone.commands.exec("proxyForGridObservers","ongridselectionschange");}else{if(cmdId.indexOf("Control")>-1){this.controlUnitFormat=parseInt(format.unit,10);this.controlValueFormat=parseInt(format.value,10);this.parentBone.parentBone.commands.exec("proxyForGridObservers","ongridselectionschange");}else{this.gridUnitFormatX=parseInt(format.unit,10);this.gridValueFormatX=parseInt(format.value,10);var o=this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_TEMPLATE);if(o&&o.commands&&o.isGrid){o.commands.exec("setGridUnitSelections",format);}if(format.unit<microstrategy.GRID_OTHER){this.parentBone.parentBone.commands.exec("proxyForGridObservers","ongridselectionschange");}}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.fetchObjectFormatLevelFromGrid=function(){try{if(microstrategy.DISPLAY_MODE==microstrategy.DESIGN_MODE){return ;}var o=this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_TEMPLATE);if(o&&o.commands){var sel=o.commands.queryState("GridSelections");if(!sel){return ;}this.gridUnitFormatX=sel.unit;this.gridValueFormatX=sel.value;}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.getCachedObjectFormatLevels=function(){try{if(!this.isOnlyOneGridSelected()&&!this.isOnlyOnePanelStackSelected()){return null;}return{id:this.firstItem().getAttribute("id"),unit:this.gridUnitFormatX,value:this.gridValueFormatX};}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.evaluateLineProperties=function(items,prop){try{var __result="";var dirty=false;var vLineItems={};var hLineItems={};var vLineValue;var hLineValue;var hLineItemPresent=false;var vLineItemPresent=false;for(var id in items){if(prop&&!microstrategy.isEnabledForItem(items[id],prop)){continue;}var orientation=this.parentBone.styleObj.getAttValue(items[id],microstrategy.HTMLATTR_ORIENTATION);if(orientation=="0"){hLineItems[items[id].id]=items[id];hLineItemPresent=true;}if(orientation=="1"){vLineItems[items[id].id]=items[id];vLineItemPresent=true;}}if(prop=="lengthMode"){if(vLineItemPresent&&hLineItemPresent){vLineValue=this.parentBone.commands.getCommonAttValue(vLineItems,microstrategy.HTMLATTR_HEIGHT_MODE,"heightMode",true);hLineValue=this.parentBone.commands.getCommonAttValue(hLineItems,microstrategy.HTMLATTR_WIDTH_MODE,"widthMode",true);return(vLineValue==hLineValue&&vLineItemPresent&&hLineItemPresent)?vLineValue:"";}else{if(vLineItemPresent){return this.parentBone.commands.getCommonAttValue(vLineItems,microstrategy.HTMLATTR_HEIGHT_MODE,"heightMode",true);}else{return this.parentBone.commands.getCommonAttValue(hLineItems,microstrategy.HTMLATTR_WIDTH_MODE,"widthMode",true);}}}else{if(prop=="length"){if(vLineItemPresent&&hLineItemPresent){vLineValue=this.parentBone.commands.getCommonAttValue(vLineItems,microstrategy.HTMLATTR_HEIGHT,"height",true);hLineValue=this.parentBone.commands.getCommonAttValue(hLineItems,microstrategy.HTMLATTR_WIDTH,"width",true);return(vLineValue!=null&&vLineValue.length!=0&&vLineValue==hLineValue)?microstrategy.number.toUserUnits(vLineValue):"";}else{if(vLineItemPresent){vLineValue=this.parentBone.commands.getCommonAttValue(vLineItems,microstrategy.HTMLATTR_HEIGHT,"height",true);return(vLineValue!=null&&vLineValue.length!=0)?microstrategy.number.toUserUnits(vLineValue):"";}else{hLineValue=this.parentBone.commands.getCommonAttValue(hLineItems,microstrategy.HTMLATTR_WIDTH,"width",true);return(hLineValue!=null&&hLineValue.length!=0)?microstrategy.number.toUserUnits(hLineValue):"";}}}}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.getCommonFormatValue=function(items,prop){try{var __result="";var dirty=false;for(var id in items){if(prop&&!microstrategy.isEnabledForItem(items[id],prop)){continue;}var local=this.styleObj.getValue(items[id],prop);if(!dirty){__result=local;dirty=true;}if(local!=__result){return null;}}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.getCommonFormatValue=function(items,prop,formatType){try{var __result="";var dirty=false;for(var id in items){if(prop&&!microstrategy.isEnabledForItem(items[id],prop)){continue;}var local=this.styleObj.getValue(items[id],prop,formatType);var propsObject={left:{p:microstrategy.HTMLATTR_WIDTH_MODE.toString(),o:microstrategy.ORIENTATION_HORIZONTAL.toString(),v:microstrategy.HTMLATTR_OLD_LEFT.toString()},top:{p:microstrategy.HTMLATTR_HEIGHT_MODE.toString(),o:microstrategy.ORIENTATION_VERTICAL.toString(),v:microstrategy.HTMLATTR_OLD_TOP.toString()}};if(prop=="left"||prop=="top"){if(this.styleObj.getAttValue(items[id],propsObject[prop].p)=="1"){var subType=items[id].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);if((subType==microstrategy.SUBOBJTYPE_DOC_LINE&&this.styleObj.getAttValue(items[id],microstrategy.HTMLATTR_ORIENTATION)==propsObject[prop].o)||subType==microstrategy.SUBOBJTYPE_DOC_SHAPE){local=this.styleObj.getAttValue(items[id],propsObject[prop].v);}}}if(!dirty){__result=local;dirty=true;}if(local!=__result){return null;}}return __result;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.hasNoBorder=function(obj){try{var bv=this.styleObj.getAttValue(obj,microstrategy.HTMLATTR_BORDER);return(bv!=null&&bv==microstrategy.NO_BORDER);}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.checkborders=function(obj){try{var v=mstrDocSelectionsImpl.NOBORDERS;if(this.hasNoBorder(obj)){return v;}var borders=["Top","Bottom","Left","Right"];for(var i=0;i<4;i++){var d="border"+borders[i];var width=parseInt(this.styleObj.getValue(obj,d+"Width"),10);var style=this.styleObj.getValue(obj,d+"Style");if(width>0&&(style&&style!="none")){v+=mstrDocSelectionsImpl[borders[i].toUpperCase()+"BORDER"];}}if(v==mstrDocSelectionsImpl.ALLBORDERS-1){v+=mstrDocSelectionsImpl.ALLBORDERS;}return v;}catch(err){microstrategy.errors.log(err);return mstrDocSelectionsImpl.NOBORDERS;}};mstrDocSelectionsImpl.prototype.checkBorderStyle=function(){try{if(!this.isActive()){return 0;}var borderWidth=this.parentBone.checkBorderProperties(this.firstItem(),this.styleObj,"border","Width","Color");var borderStyle=this.parentBone.checkBorderProperties(this.firstItem(),this.styleObj,"border","Style","Color");for(var id in this.items){if(this.parentBone.checkBorderProperties(this.items[id],this.styleObj,"border","Width","Color")!=borderWidth){return 2;}if(this.parentBone.checkBorderProperties(this.items[id],this.styleObj,"border","Style","Color")!=borderStyle){return 2;}}return(borderStyle==2||borderWidth==2)?2:borderWidth;}catch(err){microstrategy.errors.log(err);return 0;}};mstrDocSelectionsImpl.prototype.alignObjs=function(alignId){try{if(alignId!="AlignToGrid"&&!this.isMulti()){return false;}var offset,start,end,i,id,secId,t,l;var isVertical=(alignId.indexOf("Top")!=-1||alignId.indexOf("Middle")!=-1||alignId.indexOf("Bottom")!=-1||alignId.indexOf("Vert")!=-1);if(isVertical){offset=getObjSumTop(this.firstItem().parentNode)-this.parentBone.top;var top=this.range.top-offset;var bottom=this.range.bottom-offset;var middle=top+(bottom-top)/2;}else{offset=getObjSumLeft(this.firstItem().parentNode)-this.parentBone.left;var left=this.range.left-this.leftBorderOffset-offset;var right=this.range.right-this.leftBorderOffset-offset;var center=left+(right-left)/2;}var format=mstrFormatObject;var updateManager=this.parentBone.parentBone.updateManager;var actionCollection=[];var cachedArray={};cachedArray.acrossSections=false;if(alignId.indexOf("Dist")>-1){var elements=mstr.utils.Arrays.fromHashValues(this.items);var p=(isVertical)?"top":"left";start=(isVertical)?top:left;end=(isVertical)?bottom:right;elements.sort(function(a,b){return parseInt(microstrategy.styleObj.getValue(a,p))-parseInt(microstrategy.styleObj.getValue(b,p));});var total=end-start;var sizes=new Array(this.length);var fn=(isVertical)?getObjHeight:getObjWidth;for(i=0;i<this.length;i++){sizes[i]=fn(elements[i]);total-=sizes[i];}var overlap=(total<1);if(overlap){total=(end-sizes[this.length-1]/2)-(start+sizes[0]/2);}var unit=total/(this.length-1);var pos=start;var prop=(isVertical)?"top":"left";for(i=0;i<this.length;i++){id=elements[i].getAttribute("id");secId=elements[i].parentNode.getAttribute("id");t=format.encodeValue("top",this.styleObj.getValue(elements[i],"top"));l=format.encodeValue("left",this.styleObj.getValue(elements[i],"left"));if(isVertical){actionCollection.push(updateManager.createActionObject(elements[i],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,format.encodeValue("top",pos),l],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));}else{actionCollection.push(updateManager.createActionObject(elements[i],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,t,format.encodeValue("left",pos)],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));}elements[i].style[prop]=pos+"px";if(overlap){pos=(i==this.length-2)?end-sizes[i+1]:start+sizes[0]/2+(i+1)*unit-sizes[i+1]/2;if(pos<start){pos=start;}else{if(pos+sizes[i+1]>end){pos=end-sizes[i+1];}}}else{pos+=sizes[i]+unit;}}}else{var deltaY;var deltaX;if(alignId=="AlignToGrid"){deltaY=microstrategy.snapCoordinate(this.range.top-(getObjSumTop(this.range.offsetSection.elem)-this.parentBone.top),0,true)+getObjSumTop(this.range.offsetSection.elem)-(this.range.top+this.parentBone.top);deltaX=microstrategy.snapCoordinate(this.range.left+this.leftBorderOffset,0,true)-this.range.left+this.leftBorderOffset;}for(var item in this.items){id=this.items[item].getAttribute("id");secId=this.items[item].parentNode.getAttribute("id");t=format.encodeValue("top",parseInt(this.styleObj.getValue(this.items[item],"top")));l=format.encodeValue("left",parseInt(this.styleObj.getValue(this.items[item],"left")));var objsRaw=document.getElementsByName(id);var objs=[];for(i=0;i<objsRaw.length;i++){if(this.isLocked(objsRaw[i])){continue;}objs.push(objsRaw[i]);}switch(alignId){case"AlignLeft":actionCollection.push(updateManager.createActionObject(this.items[item],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,t,format.encodeValue("left",left)],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));for(i=0;i<objs.length;i++){objs[i].style.left=left+"px";}break;case"AlignCenter":actionCollection.push(updateManager.createActionObject(this.items[item],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,t,format.encodeValue("left",(center-getObjWidth(this.items[item])/2))],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));for(i=0;i<objs.length;i++){objs[i].style.left=(center-getObjWidth(objs[i])/2)+"px";}break;case"AlignRight":actionCollection.push(updateManager.createActionObject(this.items[item],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,t,format.encodeValue("left",(right-getObjWidth(this.items[item])))],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));for(i=0;i<objs.length;i++){objs[i].style.left=(right-getObjWidth(objs[i]))+"px";}break;case"AlignTop":actionCollection.push(updateManager.createActionObject(this.items[item],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,format.encodeValue("top",top),l],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));for(i=0;i<objs.length;i++){objs[i].style.top=top+"px";}break;case"AlignMiddle":actionCollection.push(updateManager.createActionObject(this.items[item],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,format.encodeValue("top",(middle-getObjHeight(this.items[item])/2)),l],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));for(i=0;i<objs.length;i++){objs[i].style.top=(middle-getObjHeight(objs[i])/2)+"px";}break;case"AlignBottom":actionCollection.push(updateManager.createActionObject(this.items[item],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,format.encodeValue("top",(bottom-getObjHeight(this.items[item]))),l],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));for(i=0;i<objs.length;i++){objs[i].style.top=(bottom-getObjHeight(objs[i]))+"px";}break;case"AlignToGrid":var itemLeft=parseInt(this.styleObj.getValue(this.items[item],"left"));var itemTop=parseInt(this.styleObj.getValue(this.items[item],"top"));actionCollection.push(updateManager.createActionObject(this.items[item],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,secId,format.encodeValue("top",itemTop+deltaY),format.encodeValue("left",itemLeft+deltaX)],[mstrUpdateManager.UPDATE_LATER,id,secId,t,l],cachedArray));for(i=0;i<objs.length;i++){objs[i].style.top=itemTop+deltaY+"px";objs[i].style.left=itemLeft+deltaX+"px";}with(this.range){top+=deltaY;bottom+=deltaY;left+=deltaX;right+=deltaX;}break;}}actionCollection=this.resizeSubSection(false,actionCollection);actionCollection=this.resetRange(false,actionCollection);}if(actionCollection.length>0){updateManager.add(actionCollection);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.resizeObjs=function(resizeId){try{if(resizeId=="Grid"){return this.sizeToGrid();}var ac=[];var isHeight=(resizeId=="Tallest"||resizeId=="Shortest");var isSmaller=(resizeId=="Shortest"||resizeId=="Narrowest");var prop=(isHeight)?"Height":"Width";var propModeAtt=(isHeight)?microstrategy.HTMLATTR_HEIGHT_MODE:microstrategy.HTMLATTR_WIDTH_MODE;var size=-1;var unlockedItems=[];for(var item in this.items){if(!this.isLocked(this.items[item])){unlockedItems.push(this.items[item]);}var cur=this.items[item];if(parseInt(this.styleObj.getAttValue(cur,propModeAtt))!=microstrategy.FIX_MODE){this.parentBone.formatSizeMode([cur],prop.toLowerCase()+"Mode",microstrategy.FIX_MODE,ac,true);}if(microstrategy.subObjectType(cur)==microstrategy.SUBOBJTYPE_DOC_LINE){if(this.styleObj.getAttValue(cur,microstrategy.HTMLATTR_ORIENTATION)==microstrategy.ORIENTATION_HORIZONTAL){if(isHeight){continue;}}else{if(!isHeight){continue;}}}var newSize=this.styleObj["getInner"+prop](cur);newSize+=Math.round(microstrategy.getPaddingAndBorderPixels(this.items[item],prop));if(size==-1){size=newSize;}size=Math[(isSmaller)?"min":"max"](newSize,size);}this.parentBone.formatSize(unlockedItems,prop.toLowerCase(),size+"px",ac);this.resizeSubSection(false,ac);this.resetRange(false,ac);if(ac&&ac.length>0){this.parentBone.parentBone.updateManager.add(ac);}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.resizeSubSection=function(update,actionCollection){try{for(var id in this.items){var elem=this.items[id].parentNode;var bone=microstrategy.findBone(elem);if(bone&&bone.elem.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_SUBSECTION){var h=parseInt(this.styleObj.getValue(this.items[id],"top"))+getObjHeight(this.items[id]);var dropShadowEffect=this.styleObj.getValue(this.items[id],"dropShadowEffect");if(dropShadowEffect=="1"){var dropShadowVal=parseInt(this.styleObj.getValue(this.items[id],"dropShadowDepth"));var dropShadowH=parseInt(microstrategy.number.toLocalUnits(mstrNumber.UNIT_PX,microstrategy.number.convertToUSUnits(mstrNumber.UNIT_PT,dropShadowVal,true),true));h=h-dropShadowH;}if(h>getObjHeight(elem)){actionCollection=bone.changeSubHeight(h,update,actionCollection);if(bone.isHorizontal){this.parentBone.synchHeightOfHorizontalSections(bone);}}if(bone.isHorizontal){var w=parseInt(this.styleObj.getValue(this.items[id],"left"))+getObjWidth(this.items[id]);if(w>getObjWidth(elem)){actionCollection=bone.changeSubWidth(w,update,actionCollection);}}}}this.syncUp();this.parentBone.updateLayoutWidth(actionCollection);}catch(err){microstrategy.errors.log(err);}finally{return actionCollection;}};mstrDocSelectionsImpl.prototype.resizeUnitsInFP=function(){for(var id in this.items){var elem=this.items[id];var pel=elem.parentNode;var pb=microstrategy.findBone(pel);if(pb.isFilterPanel){var ac=[];this.parentBone.formatItems(microstrategy.createAssociativeArray(elem),"width",this.parentBone.removePaddingAndBorder(elem,getObjWidth(pel)-2*mstrFilterPanelMaskImpl.ITEM_SPA,"width")+"px",false,ac);var ft=microstrategy.formatType;microstrategy.formatType=microstrategy.FORMAT_TYPE_CONTROL_TITLE;this.parentBone.formatAttribute([elem],"showTitleBar",microstrategy.TRUE,false,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE,ac,true);microstrategy.formatType=ft;if(ac.length>0){this.parentBone.parentBone.updateManager.add(ac);}}}};mstrDocSelectionsImpl.prototype.enforceTitleBar=function(sb,cb){try{sb=sb.elem?sb:microstrategy.findBone(sb);if(sb.isFilterPanel){if(this.parentBone.styleObj.getAttValue(cb,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE)!=microstrategy.TRUE){var formatValue={obj:null,cmdId:"IsPortal",value:true,memo:{},performFormatChange:true,submitUpdateManager:false};this.processPropertyChanges([formatValue]);}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.resetRange=function(update,actionCollection){try{this.range=new Rect(null,null,null,null);this.range.offsetSection=null;this.range.offsetLeftSection=null;for(member in this.items){this.updateRange(this.items[member]);}return actionCollection;}catch(err){microstrategy.errors.log(err);}finally{return actionCollection;}};mstrDocSelectionsImpl.prototype.getUpdatedZIndex=function(max){var zi={};var so=this.styleObj;if(so){for(var i in this.items){var item=this.items[i];var count=0;for(var j in this.items){if(so.getValue(item,"zIndex")>so.getValue(this.items[j],"zIndex")){count++;}}zi[item.getAttribute("id")]=max+count;}}return zi;};mstrDocSelectionsImpl.prototype.moveItems=function(mask){try{this.resetObjectFormatLevel();if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.start("mstrDocSelectionsImpl.moveItems",mstrLogImpl.MOVE_ITEMS);}var newSection,oldSection,maskBone,baseTop=0,baseLeft=0,forceUpdate=false,updateManager=this.parentBone.parentBone.updateManager,format=mstrFormatObject,ac=[],deltaX=getObjLeft(this.dragRectangles),deltaY=getObjTop(this.dragRectangles),coords=mask.getAttribute(microstrategy.HTMLATTR_POINTS_TO).split("|"),maskBone=this.parentBone.getSubMaskBone(coords[0],coords[1],0);if(maskBone.elem.getAttribute("isCollapsed")=="true"){return false;}var subsectionID=mask.getAttribute(microstrategy.HTMLATTR_MASKEDOBJECT);if((deltaY!=0||deltaX!=0)&&(!this.isMulti()||this.isSameSubSection())){oldSection=this.firstItem().parentNode;if(oldSection.getAttribute("id")!=subsectionID){newSection=document.getElementById(subsectionID);}}var firstMaskTopOffset=(maskBone!=null&&parseInt(this.styleObj.getAttValue(maskBone.elem,microstrategy.HTMLATTR_HEIGHT))<parseInt(maskBone.elem.style.height))?this.parentBone.mouseoffsetTop:0,baseTop=lMouseY-getObjSumTop(mask)+this.parentBone.parentBone.elem.scrollTop-firstMaskTopOffset,baseLeft=lMouseX-getObjSumLeft(mask)+this.parentBone.parentBone.elem.scrollLeft,isPanel=String(mask.getAttribute("isPanel")).toLowerCase()=="true";if(!isPanel){baseTop-=maskBone.topOffset;baseLeft-=this.parentBone.mouseoffsetLeft;}else{if(microstrategy.getViewerBone().dividerOn){baseTop-=maskBone.topOffset;}}if(baseTop<0){baseTop=0;}if(baseLeft<0){baseLeft=0;}if(newSection){var newSecBone=microstrategy.findBone(newSection);if(newSecBone.isDetails&&this.isGridSelected()){showMessage({contents:microstrategy.descriptors.getDescriptor("3622"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return ;}if(newSecBone.isDetails&&this.isPanelStackSelected()){showMessage({contents:microstrategy.descriptors.getDescriptor("4814"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return ;}if(newSecBone.isDetails&&this.isSelectorControlSelected()){showMessage({contents:microstrategy.descriptors.getDescriptor("4993"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return ;}if(newSecBone.isFilterPanel&&!this.isSelectorControlSelected()){showMessage({contents:"*This move operation is being cancelled because you cannot move a node other than selector to the Filter Panel.*",elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return ;}else{if(newSecBone.parentBone.isCollapsed){return ;}}if(isPanel&&this.atLeastOneTableSelected()){showMessage({contents:microstrategy.descriptors.getDescriptor("11959"),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return ;}var newItems=[];var oldSecBone=microstrategy.findBone(oldSection);oldSecBone.setNeedToUpdateMaxContentHeight(true);var orgRangeLeft=this.range.left;var orgRangeTop=this.range.top;var bWire={control:false,target:false};var bAW=microstrategy.getViewerBone().autoWire;var exceptionObjs={oldSection:{},newSection:{}};var zi=this.getUpdatedZIndex(newSecBone.maxZindex);newSecBone.maxZindex+=this.length;for(var id in this.items){if(this.isLocked(this.items[id])){continue;}var isTarget=false;var isControl=false;var type=this.items[id].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);if(type==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){isControl=bWire.control=true;}else{if(type==microstrategy.SUBOBJTYPE_DOC_TEMPLATE||type==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){isTarget=bWire.target=true;}}if(oldSecBone.isFilterPanel){var sec=microstrategy.findAncestorWithAtt(oldSection,microstrategy.HTMLATTR_OBJTYPE,"dsec");var maskBone=this.parentBone.getSubMaskBone(sec.id,oldSection.id,0);this.adjustItemsInFP(oldSection,maskBone,ac,null,id,true);}else{ac=oldSecBone.reduceObjZIndex(this.items[id],ac);}ac=this.parentBone.formatItems(microstrategy.createAssociativeArray(this.items[id]),"zIndex",zi[id],false,ac);var l=microstrategy.snapCoordinate(baseLeft+(getObjSumLeft(this.items[id])-this.parentBone.left-orgRangeLeft),0,!microstrategy.SNAP_OFF);var t=microstrategy.snapCoordinate(baseTop+(getObjSumTop(this.items[id])-this.parentBone.top-orgRangeTop),0,!microstrategy.SNAP_OFF);var ca={acrossSections:true,orginalSection:oldSection,newSection:newSection};ac.push(updateManager.createActionObject(this.items[id],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011","2048241"],[mstrUpdateManager.UPDATE_LATER,id,subsectionID,format.encodeValue("top",t),format.encodeValue("left",l),"true"],[mstrUpdateManager.UPDATE_LATER,id,subsectionID,format.encodeValue("top",this.styleObj.getValue(this.items[id],"top")),format.encodeValue("left",this.styleObj.getValue(this.items[id],"left"))],ca));if(!forceUpdate){forceUpdate=(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE&&(bAW?(bWire.control||bWire.target):type==microstrategy.SUBOBJTYPE_DOC_TEMPLATE));}if(!forceUpdate){var item=this.items[id];this.remove(item);var objs=document.getElementsByName(id);for(var i=objs.length-1;i>=0;i--){objs[i].parentNode.removeChild(objs[i]);}if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE&&type==microstrategy.SUBOBJTYPE_DOC_TEXT){if(this.styleObj.getAttValue(item,microstrategy.HTMLATTR_DSS_FORMULA)!=null){this.parentBone.updateSingleTextField(item,this.styleObj.getAttValue(item,microstrategy.HTMLATTR_DSS_FORMULA).replace(/\n/g,"<br />"));}}moveObjTo(item,l,t);newItems[newItems.length]=this.parentBone.addItemsToSubsection(newSection,item,false,null,oldSecBone);this.add(document.getElementById(item.getAttribute("id")));}else{if(forceUpdate&&bAW){if(isTarget){if(!exceptionObjs.newSection.includeTargets){exceptionObjs.newSection.includeTargets=[];}exceptionObjs.newSection.includeTargets.push(id);if(!exceptionObjs.oldSection.excludeTargets){exceptionObjs.oldSection.excludeTargets=[];}exceptionObjs.oldSection.excludeTargets.push(id);}else{if(isControl){if(!exceptionObjs.newSection.includeControls){exceptionObjs.newSection.includeControls=[];}exceptionObjs.newSection.includeControls.push(id);if(!exceptionObjs.oldSection.excludeControls){exceptionObjs.oldSection.excludeControls=[];}exceptionObjs.oldSection.excludeControls.push(id);}}}}}if((bWire.control||bWire.target)&&bAW){newSecBone.wireTargets(ac,this.parentBone.parentBone.beanPath,bWire.target,exceptionObjs.newSection);oldSecBone.wireTargets(ac,this.parentBone.parentBone.beanPath,bWire.target,exceptionObjs.oldSection);}if(!forceUpdate){ac=this.resizeSubSection(false,ac);ac=this.resetRange(false,ac);}microstrategy.eventManager.notifyOrphanBones("onboneaftermove",this.getSelectedIds(),this.getActiveSectionIndex(this.firstItem()));}else{for(var id in this.items){if(this.isLocked(this.items[id])){continue;}var t=parseInt(this.styleObj.getValue(this.items[id],"top"));if(t+deltaY<0){deltaY=0-t;}}for(var id in this.items){if(this.isLocked(this.items[id])){continue;}var subsectionID=this.items[id].parentNode.getAttribute("id");var l=parseInt(this.styleObj.getValue(this.items[id],"left"));var t=parseInt(this.styleObj.getValue(this.items[id],"top"));var textDirection=this.items[id].direction||this.styleObj.getValue(this.items[id],"TextDirection")||"0";var ca={acrossSections:false};ac.push(updateManager.createActionObject(this.items[id],mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,id,subsectionID,format.encodeValue("top",t+deltaY),format.encodeValue("left",l+deltaX)],[mstrUpdateManager.UPDATE_LATER,id,subsectionID,format.encodeValue("top",t),format.encodeValue("left",l)],ca));var objHilites=document.getElementsByName(id);for(var i=0;i<objHilites.length;i++){if(textDirection==="0"){moveObjTo(objHilites[i],Math.max(l+deltaX,0),t+deltaY);}else{this.styleObj.changeVerticalTextPosition(objHilites[i],{x:t+deltaY,y:Math.max(l+deltaX,0)});}}}with(this.range){top+=deltaY;bottom+=deltaY;left+=deltaX;right+=deltaX;}ac=this.resizeSubSection(false,ac);microstrategy.eventManager.notifyOrphanBones("onboneaftermove",this.getSelectedIds());}if(ac.length>0){updateManager.add(ac);if(forceUpdate){updateManager.flushAndSubmitChanges();}}this.onmoveend();return true;}catch(err){microstrategy.errors.log(err);return false;}finally{if(typeof microstrategy.log!="undefined"&&microstrategy.log.shouldLog(mstrLogImpl.ACTION_LEVEL|mstrLogImpl.METHOD_LEVEL)){microstrategy.log.stop("mstrDocSelectionsImpl.moveItems",mstrLogImpl.MOVE_ITEMS);}}};mstrDocSelectionsImpl.prototype.moveItemsToFP=function(area){try{this.resetObjectFormatLevel();if(this.isMulti()){return false;}if(area.tagName!="AREA"){return false;}var map=area.parentNode,newSection,oldSection,maskBone,baseTop=0,baseLeft=0,forceUpdate=false,updateManager=this.parentBone.parentBone.updateManager,format=mstrFormatObject,ac=[],deltaX=getObjLeft(this.dragRectangles),deltaY=getObjTop(this.dragRectangles),pt=map.getAttribute(microstrategy.HTMLATTR_POINTS_TO).split("|"),maskBone=this.parentBone.getSubMaskBone(pt[0],pt[1],0),fpId=map.getAttribute(microstrategy.HTMLATTR_MASKEDOBJECT),ctrlId=area.getAttribute("ctrlId");var sc=null;var scBone=null;if(ctrlId){sc=document.getElementById(ctrlId);scBone=microstrategy.bone(ctrlId+"_Ctl");}if((deltaY!=0||deltaX!=0)&&(!this.isMulti()||this.isSameSubSection())){oldSection=this.firstItem().parentNode;if(oldSection.getAttribute("id")!=fpId){newSection=document.getElementById(fpId);}}if(newSection){var newSecBone=microstrategy.findBone(newSection);if(newSecBone.isFilterPanel){var ctl=this.getSelectedSelectorControl(),ctlBone=ctl&&microstrategy.findBone(ctl);if(ctl==null){showMessage({contents:"*This move operation is being cancelled because you cannot move a node other than selector to the Filter Panel.*",elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return ;}else{if(ctlBone&&ctlBone.ctlType==mstrRWControlImpl.CTL_TYPE_PANEL_STACK){showMessage({contents:"*This move operation is being cancelled because you cannot move a panel selector to the Filter Panel.*",elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return ;}}}if(newSecBone.parentBone.isCollapsed){return ;}var newItems=[];var oldSecBone=microstrategy.findBone(oldSection);oldSecBone.setNeedToUpdateMaxContentHeight(true);var item=this.firstItem();if(oldSecBone.isFilterPanel){var sec=microstrategy.findAncestorWithAtt(oldSection,microstrategy.HTMLATTR_OBJTYPE,"dsec");var maskBone=this.parentBone.getSubMaskBone(sec.id,oldSection.id,0);this.adjustItemsInFP(oldSection,maskBone,ac,null,item.id,true);}else{ac=oldSecBone.reduceObjZIndex(item,ac);}maskBone.maxZIndex++;var zi=area.getAttribute("soz")?area.getAttribute("soz"):maskBone.maxZIndex;ac=this.parentBone.formatItems(microstrategy.createAssociativeArray(item),"zIndex",zi,false,ac);var pos=area.getAttribute("coords").split(","),left=parseInt(pos[0]),top=parseInt(pos[1]);var ca={acrossSections:true,orginalSection:oldSection,newSection:newSection};ac.push(updateManager.createActionObject(item,mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,item.id,fpId,format.encodeValue("top",top),format.encodeValue("left",left)],[mstrUpdateManager.UPDATE_LATER,item.id,fpId,format.encodeValue("top",this.styleObj.getValue(item,"top")),format.encodeValue("left",this.styleObj.getValue(item,"left"))],ca));this.remove(item);var objs=document.getElementsByName(item.id);for(var i=objs.length-1;i>=0;i--){objs[i].parentNode.removeChild(objs[i]);}moveObjTo(item,left,top);var newItem=this.parentBone.addItemsToSubsection(newSection,item,false,null,oldSecBone);ac=this.parentBone.formatItems(microstrategy.createAssociativeArray(item),"width",this.parentBone.removePaddingAndBorder(item,getObjWidth(newSection)-2*mstrFilterPanelMaskImpl.ITEM_SPA,"width")+"px",false,ac);this.add(document.getElementById(newItem.getAttribute("id")));this.enforceTitleBar(newSection,newItem);this.adjustItemsInFP(newSection,maskBone,ac,null,ctrlId);}else{this.adjustItemsInFP(oldSection,maskBone,ac,this.firstItem().id,ctrlId);}if(ac.length>0){updateManager.add(ac);if(forceUpdate){updateManager.flushAndSubmitChanges();}}this.onmoveend();return true;}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.adjustItemsInFP=function(fpSection,maskBone,ac,dragId,dropId,del){try{var updateManager=this.parentBone.parentBone.updateManager,format=mstrFormatObject;if(maskBone.adjustZIndex(dragId,dropId,del)){var moveItems=maskBone.getMoveItems();if(moveItems.length<=0){return ;}var startArea=maskBone.getStartArea(moveItems[0].zIndex);var th=startArea?parseInt(startArea.getAttribute("coords").split(",")[1]):mstrFilterPanelMaskImpl.ITEM_SPA;for(var i=0;i<moveItems.length;i++){var info=moveItems[i];ac=this.parentBone.formatItems(microstrategy.createAssociativeArray(info.item),"zIndex",info.zIndex,false,ac);var l=startArea?parseInt(startArea.getAttribute("coords").split(",")[0]):mstrFilterPanelMaskImpl.ITEM_SPA,t=th;moveObjTo(info.item,l,t);var ca={acrossSections:false};ac.push(updateManager.createActionObject(info.item,mstrUpdateManager.MOVE_OBJECT,this.parentBone.parentBone.beanPath,["2048018","2048012","2048007","2048010","2048011"],[mstrUpdateManager.UPDATE_LATER,info.item.id,fpSection.id,format.encodeValue("top",t),format.encodeValue("left",l)],[mstrUpdateManager.UPDATE_LATER,info.item.id,fpSection.id,format.encodeValue("top",this.styleObj.getValue(info.item,"top")),format.encodeValue("left",this.styleObj.getValue(info.item,"left"))],ca));th+=getObjHeight(info.item)+mstrFilterPanelMaskImpl.ITEM_SPA;}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.updateRange=function(obj){try{var l=getObjSumLeft(obj)-this.parentBone.left;var t=getObjSumTop(obj)-this.parentBone.top;var w=getObjWidth(obj);var h=getObjHeight(obj);if((this.range.left==null)||(l<this.range.left)){this.range.left=l;this.range.offsetLeftSection=microstrategy.findBone(obj.parentNode);}if((this.range.top==null)||(t<this.range.top)){this.range.top=t;this.range.offsetSection=microstrategy.findBone(obj.parentNode);}if((this.range.right==null)||(l+w>this.range.right)){this.range.right=l+w;}if((this.range.bottom==null)||(t+h>this.range.bottom)){this.range.bottom=t+h;}}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.sendTo=function(positionId){try{if(!this.isActive()||this.firstObjType()!=microstrategy.OBJTYPE_DOC_OBJECT){return true;}var actionCollection=[];var elements=mstr.utils.Arrays.fromHashValues(this.items);elements.sort(function(a,b){return parseInt(a.style.zIndex)-parseInt(b.style.zIndex);});switch(positionId){case"back":for(j=elements.length-1;j>=0;j--){var subSecNode=elements[j].parentNode;var subSec=microstrategy.findBone(subSecNode);if(subSec){var value=this.styleObj.getValue(elements[j],"zIndex");for(i=0;i<subSecNode.childNodes.length;i++){var child=subSecNode.childNodes[i];if(child.nodeType==1&&child.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){var zIndex=this.styleObj.getValue(child,"zIndex");if(zIndex<value){zIndex++;actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(child),"zIndex",zIndex,false,actionCollection);}}}value=subSec.minZindex;actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(elements[j]),"zIndex",value,false,actionCollection);}}break;case"front":for(j=0;j<elements.length;j++){var subSecNode=elements[j].parentNode;var subSec=microstrategy.findBone(subSecNode);if(subSec){var value=this.styleObj.getValue(elements[j],"zIndex");for(i=0;i<subSecNode.childNodes.length;i++){var child=subSecNode.childNodes[i];if(child.nodeType==1&&child.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){var zIndex=this.styleObj.getValue(child,"zIndex");if(zIndex>value){zIndex--;actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(child),"zIndex",zIndex,false,actionCollection);}}}value=subSec.maxZindex-1;actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(elements[j]),"zIndex",value,false,actionCollection);}}break;case"oneBack":var swap=false;for(j=0;j<elements.length;j++){var subSecNode=elements[j].parentNode;var subSec=microstrategy.findBone(subSecNode);if(subSec){var value=this.styleObj.getValue(elements[j],"zIndex");if(value!=subSec.minZindex){var closestUnit=null;var depthDiff=null;for(i=0;i<subSecNode.childNodes.length;i++){var child=subSecNode.childNodes[i];if(child.nodeType==1&&child.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){var zIndex=this.styleObj.getValue(child,"zIndex");var id=child.getAttribute("id");if(zIndex<value&&this.items[id]==null){if(closestUnit==null){closestUnit=i;depthDiff=value-zIndex;}else{if(value-zIndex<depthDiff){closestUnit=i;depthDiff=value-zIndex;}}}}}if(closestUnit!=null){var child=subSecNode.childNodes[closestUnit];var zIndex=this.styleObj.getValue(child,"zIndex");actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(child),"zIndex",value,false,actionCollection);actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(elements[j]),"zIndex",zIndex,false,actionCollection);}}}}break;case"oneFront":for(j=elements.length-1;j>=0;j--){var subSecNode=elements[j].parentNode;var subSec=microstrategy.findBone(subSecNode);if(subSec){value=this.styleObj.getValue(elements[j],"zIndex");if(value!=subSec.maxZindex-1){var closestUnit=null;var depthDiff=null;for(i=0;i<subSecNode.childNodes.length;i++){var child=subSecNode.childNodes[i];if(child.nodeType==1&&child.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){var zIndex=this.styleObj.getValue(child,"zIndex");var id=child.getAttribute("id");if(zIndex>value&&this.items[id]==null){if(closestUnit==null){closestUnit=i;depthDiff=zIndex-value;}else{if(zIndex-value<depthDiff){closestUnit=i;depthDiff=zIndex-value;}}}}}if(closestUnit!=null){var child=subSecNode.childNodes[closestUnit];var zIndex=this.styleObj.getValue(child,"zIndex");actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(child),"zIndex",value,false,actionCollection);actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(elements[j]),"zIndex",value,false,actionCollection);actionCollection=this.parentBone.formatItems(microstrategy.createAssociativeArray(elements[j]),"zIndex",zIndex,false,actionCollection);}}}}break;}var updateManager=this.parentBone.parentBone.updateManager;if(actionCollection.length>0){updateManager.add(actionCollection);}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.enablePropertiesEditor=function(){try{var crossTabFound=false;for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){crossTabFound=true;break;}}if((this.length>1&&crossTabFound==true)||this.length==0){return false;}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.getSelectedGrid=function(){return this.getSelectedControl(microstrategy.SUBOBJTYPE_DOC_TEMPLATE);};mstrDocSelectionsImpl.prototype.getSelectedControl=function(subObjType){try{for(var id in this.items){var item=this.items[id];if(item.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT&&item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==subObjType){return item;break;}}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.getSelectedPanelStack=function(){return this.getSelectedControl(microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);};mstrDocSelectionsImpl.prototype.getSelectedSelectorControl=function(){return this.getSelectedControl(microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL);};mstrDocSelectionsImpl.prototype.getPortalGridWithProperty=function(prop){try{for(var id in this.items){var item=this.items[id];if(item.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT&&item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE&&microstrategy.styleObj.getAttValue(item,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE)==microstrategy.TRUE&&microstrategy.styleObj.getAttValue(item,microstrategy.HTMLATTR_WINDOW_STATE)==prop){return item;break;}}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOneCtrlDftObjSelected=function(){try{return(!this.isMulti()&&this.parentBone.parentBone.objProps.isCtrlDftObj(this.firstItem()));}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.atLeastOneCtrlDftObjSelected=function(){try{for(var item in this.items){if(this.parentBone.parentBone.objProps.isCtrlDftObj(this.items[item])){return true;}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.atLeastOneRectangleSelected=function(){try{for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_SHAPE&&this.items[item].getAttribute(microstrategy.HTMLATTR_STYLE)!=microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){return true;}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.atLeastOneRoundedRectangleSelected=function(){try{for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_SHAPE&&this.items[item].getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){return true;}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.atLeastOneSubtypeSelected=function(aSubtypes){try{var sSubtypes=aSubtypes.toString();for(var item in this.items){if(microstrategy.isValueInFilter(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE),sSubtypes)){return true;}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.atLeastOneControlSelected=function(){try{for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL){return true;}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isGridSelected=function(){try{return(this.getSelectedGrid()!=null);}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isPanelStackSelected=function(){try{return(this.getSelectedPanelStack()!=null);}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isSelectorControlSelected=function(){try{return(this.getSelectedSelectorControl()!=null);}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.areAllSameSubtypeSelected=function(subObjType){try{for(var id in this.items){var item=this.items[id];if(!(item.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT&&item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==subObjType)){return false;}}return true;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isGridOrGraphSelected=function(){try{var grid=this.getSelectedGrid();if(grid){var gridBone=microstrategy.findBone(grid);if(gridBone!=null){if(gridBone.isGraph&&gridBone.isGrid){return microstrategy.DISPLAY_MODE_GRID_AND_GRAPH;}if(gridBone.isGraph){return microstrategy.DISPLAY_MODE_GRAPH;}if(gridBone.isGrid){return microstrategy.DISPLAY_MODE_GRID;}}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOneSelectorCtrlSelected=function(){try{return(!this.isMulti()&&this.isSelectorControlSelected());}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOneGridSelected=function(){try{return(!this.isMulti()&&this.isGridSelected());}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOneGraphSelected=function(){try{var isGraph=this.isGridOrGraphSelected();return(!this.isMulti()&&(isGraph==microstrategy.DISPLAY_MODE_GRID_AND_GRAPH||isGraph==microstrategy.DISPLAY_MODE_GRAPH));}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOneGGridSelected=function(){try{var isGrid=this.isGridOrGraphSelected();return(!this.isMulti()&&(isGrid==microstrategy.DISPLAY_MODE_GRID_AND_GRAPH||isGrid==microstrategy.DISPLAY_MODE_GRID));}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyRoundedRectanglesSelected=function(){try{var __result=true;for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_SHAPE||this.items[item].getAttribute(microstrategy.HTMLATTR_STYLE)!=microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){__result=false;break;}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlySquareRectanglesSelected=function(){try{var __result=true;for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_SHAPE||this.items[item].getAttribute(microstrategy.HTMLATTR_STYLE)==microstrategy.SUBOBJTYPE_DOC_SHAPE_ROUND){__result=false;break;}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyRectanglesSelected=function(){try{var __result=true;for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_SHAPE){__result=false;break;}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyImagesSelected=function(){try{var __result=true;for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_IMAGE){__result=false;break;}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyLinesSelected=function(){try{var __result=true;for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_LINE){__result=false;break;}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOnePanelStackSelected=function(){try{return(this.isPanelStackSelected()&&!this.isMulti());}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.atLeastOneTableSelected=function(){try{for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){var b=microstrategy.bones[this.items[item].id];if(b&&b.isTable){return true;}}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOneTableSelected=function(){try{var ret=false;if(this.isOnlyOnePanelStackSelected()){var bone=this.getSelectedControlBone(microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);ret=bone&&bone.isTable;}return ret;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.areAllSelectedPanelStacks=function(){try{var __result=true;for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){__result=false;break;}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOneButtonSelected=function(){try{return(this.length==1&&this.getSelectedButtons())?true:false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.getSelectedButtons=function(){try{var buttons=[];for(var id in this.items){var item=this.items[id];if(item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEXT){if(microstrategy.styleObj.getAttValue(item,microstrategy.HTMLATTR_DISPLAY_STYLE)>0){buttons.push(item);}}}if(buttons.length){return buttons;}return null;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isOnlyOneNavBarSelected=function(){try{return(this.isOnlyOnePanelStackSelected()&&microstrategy.styleObj.getAttValue(this.firstItem(),microstrategy.HTMLATTR_USE_AS_NAVIGATION_BAR)==microstrategy.TRUE);}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isItemInsideNavBar=function(){try{var s=microstrategy.findAncestorWithAtt(this.firstItem(),microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_DOC_PANEL_STACK);if(s&&s!=this.firstItem()&&s.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){var b=microstrategy.findBone(s);return b&&b.isNavigationBar;}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isEmptyTemplateSelected=function(){try{for(var id in this.items){var item=this.items[id];if(item.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT&&item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){var objs=document.getElementsByName(id);var bone=microstrategy.bone("grid_"+id+"_"+0);if(!bone){bone=microstrategy.bone("grid_"+id);}if(bone&&bone.isTemplateEmpty()){return true;}}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.nubmerOfLinesSelected=function(orientation){try{var count=0;for(var item in this.items){if(this.items[item].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_LINE&&this.styleObj.getAttValue(this.items[item],microstrategy.HTMLATTR_ORIENTATION)==orientation){count++;}}return count;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.isItemOfTypeSelected=function(type){try{var __result=false;for(var item in this.items){if(microstrategy.styleObj.getAttValue(this.items[item],microstrategy.HTMLATTR_SUBOBJTYPE)==type){__result=true;break;}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.isImageReady=function(){try{var __result=false;for(var id in this.items){var item=this.items[id];if(item.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT&&item.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_IMAGE){var oImage=item.getElementsByTagName("IMG")[0];__result|=oImage.readyState=="complete"||oImage.complete==true;}}return __result;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.getSelectedGridProperty=function(prop){try{var grid=this.getSelectedGrid();var bone=microstrategy.findBone(grid);return(bone)?bone[prop]:false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.getSelectedGridFeature=function(feature){try{var grid=this.getSelectedGrid();var bone=microstrategy.findBone(grid);return(bone)?bone.isFeatureAvailable(feature):false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.hiliteSelected=function(o){try{var id=o.getAttribute("id");this.items[id]=o;var hId=this.hilites[id].base;var hilite=this.hilites[id].items[hId];if(!hilite){var objs=document.getElementsByName(id);for(var i=0;i<objs.length;i++){var gridBone=microstrategy.findBone(objs[i]);if(gridBone&&gridBone.isGridInCellSelectionMode()){gridBone.selections.clearAll();}}this.addHilites(o);}else{if(hilite.src!=o){setFilter(hilite.src,"Alpha",{opacity:this.selectionOpacity});setFilter(o,"Alpha",{opacity:100});hilite.src=o;this.syncUp(o);this.resetRange();}}this.setPanelStackSelectionHandleEvents(o);this.setGridSelectionHandleEvents(o);}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.hiliteElements=function(o){try{if(!bIsW3C||bIsIE8){return ;}var objs=document.getElementsByName(o.getAttribute("id"));for(var i=0;i<objs.length;i++){setFilter(objs[i],"Alpha",{opacity:this.selectionOpacity});}setFilter(o,"Alpha",{opacity:100});}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.setGridSelectionHandleEvents=function(o){try{if(o.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE&&microstrategy.styleObj.getAttValue(o,microstrategy.HTMLATTR_SHOW_WINDOW_TITLE)!=microstrategy.TRUE){var gridBone=microstrategy.findBone(o);if(gridBone!=null){if(gridBone.onmouseover&&gridBone.onmouseout){this.elem.onmouseover=new Function("e","return microstrategy.bone('"+gridBone.id+"').onmouseover(e);");this.elem.onmouseout=new Function("e","return microstrategy.bone('"+gridBone.id+"').onmouseout(e);");}}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.removeGridSelectionHandleEvents=function(o){try{if(o.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_TEMPLATE){return ;}var gridBone=microstrategy.findBone(o);if(gridBone!=null){if(gridBone.onmouseover&&gridBone.onmouseout){this.elem.onmouseover=null;this.elem.onmouseout=null;}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.restoreElements=function(id){try{var objs=document.getElementsByName(id);for(var i=0;i<objs.length;i++){setFilter(objs[i],"Alpha",{opacity:100});}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.processAddToSelections=function(src){try{if(this.firstItem()){var baseBone=microstrategy.findBone(this.firstItem().parentNode);var srcBone=microstrategy.findBone(src.parentNode);if(baseBone.subsectionType==srcBone.subsectionType){switch(srcBone.subsectionType){case mstrSubSection.TYPE_FIXED:return src;case mstrSubSection.TYPE_PANEL:if(srcBone.id==baseBone.id){return src;}else{var b=this.getPeerSubsection(srcBone,baseBone.id);if(b){return b.elem;}else{return null;}}break;}}else{switch(srcBone.subsectionType){case mstrSubSection.TYPE_FIXED:return null;case mstrSubSection.TYPE_PANEL:var b=this.getPeerSubsection(srcBone,baseBone.id);if(b){return b.elem;}else{return null;}}}}else{return src;}}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.selectAll=function(e){try{this.clear(true);var objs=microstrategy.objectListFind(this.parentBone.elem,"span",microstrategy.OBJTYPE_DOC_OBJECT);var objID="";for(var i=0;i<objs.length;i++){var id=objs[i].getAttribute("id")+"|";if(objID.indexOf(id)==-1){objID+=id;var toAdd=this.processAddToSelections(objs[i]);if(toAdd){this.add(toAdd);}}}return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.getOffsetSubsection=function(){try{return this.range.offsetSection;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.getSelectedSubsection=function(){try{if(!this.isActive()){return null;}var selection=this.firstItem();if(selection.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_SUBSECTION){return microstrategy.findBone(selection);}if(this.isSameSubSection()){return this.getOffsetSubsection();}return null;}catch(err){microstrategy.errors.log(err);return null;}};mstrDocSelectionsImpl.prototype.finishAdd=function(obj,ac){try{return this.finishAddAllObjs(microstrategy.createAssociativeArray(obj),ac);}catch(err){microstrategy.errors.log(err);return false;}};mstrDocSelectionsImpl.prototype.finishAddAllObjs=function(objs,ac,isDynamicText){try{this.clear();var enableEdit=(typeof (isDynamicText)!="undefined"&&isDynamicText==false)?false:true;var obj=null;for(var id in objs){obj=objs[id];this.add(obj);}ac=this.resizeSubSection(false,ac);ac=this.resetRange(false,ac);this.parentBone.commands.exec("ctrlJustAdded");if(this.parentBone.parentBone.observer){this.parentBone.parentBone.observer.notifyAll("onaddcontrol");}if(obj&&enableEdit){if(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEXT){this.parentBone.editText(null,obj);}else{if(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){var bone=microstrategy.findRWObjectBone(obj,"mstrHTMLContainerImpl");bone.editContents(null);}}}}catch(err){microstrategy.errors.log(err);}return ac;};mstrDocSelectionsImpl.prototype.setPanelStackSelectionHandleEvents=function(o){try{if(o.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){var panelStackBone=microstrategy.findBone(o);if(panelStackBone!=null){if(panelStackBone.onmouseover&&panelStackBone.onmouseout){this.elem.onmouseover=new Function("e","return microstrategy.bone('"+panelStackBone.id+"').onmouseover(e);");this.elem.onmouseout=new Function("e","return microstrategy.bone('"+panelStackBone.id+"').onmouseout(e);");}}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.removePanelStackSelectionHandleEvents=function(o){try{if(o.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)!=microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){return ;}var panelStackBone=microstrategy.findBone(o);if(panelStackBone!=null){if(panelStackBone.onmouseover&&panelStackBone.onmouseout){this.elem.onmouseover=null;this.elem.onmouseout=null;}}}catch(err){microstrategy.errors.log(err);}};mstrDocSelectionsImpl.prototype.getTransactionUnitKey=function(){try{if(this.isActive()&&!this.isMulti()){var item=this.firstItem();if(this.isItemOfTypeSelected(microstrategy.SUBOBJTYPE_DOC_TEMPLATE)){var g=microstrategy.findBone(item),cmds=g&&g.commands;if(cmds&&!cmds.queryState("isLinkedTemplate")&&(cmds.queryEnabled("attForms")||cmds.queryEnabled("hasmetrics"))){return{k:item.id};}}else{if(this.isItemOfTypeSelected(microstrategy.SUBOBJTYPE_DOC_TEXT)){if(microstrategy.findAncestorWithAtt(item,microstrategy.HTMLATTR_SUBOBJTYPE,microstrategy.SUBOBJTYPE_DOC_PANEL_STACK)!=null){return{k:(item.parentNode.getAttribute("fgkey")||""),sk:item.parentNode.id};}}}}return null;}catch(err){microstrategy.errors.log(err);}};function mstrDocSelectionsImpl(){return this;}mstrDocHilite.prototype={};mstrDocHilite.prototype.parentBone=null;mstrDocHilite.prototype.base=0;mstrDocHilite.prototype.items=null;mstrDocHilite.prototype.vflipped=false;mstrDocHilite.prototype.hflipped=false;mstrDocHilite.OFFSET=2;mstrDocHilite.HANDLE_SIZE=7;mstrDocHilite.prototype.getDefault=function(){return(this.items.length>0)?this.items[this.base]:null;};mstrDocHilite.prototype.setDefault=function(obj){try{for(var i=0;i<this.items.length;i++){if(this.items[i]==obj){this.base=i;break;}}}catch(err){microstrategy.errors.log(err);}return ;};mstrDocHilite.prototype.syncHilites=function(selections){try{var oldFormatType=microstrategy.formatType;microstrategy.formatType=microstrategy.FORMAT_TYPE_MAIN;var format=mstrFormatObject;for(var i=0;i<this.items.length;i++){var obj=this.items[i].src;var left=getObjSumLeft(obj)-selections.parentBone.left;if(bIsIE7&&!bIsIE8&&!bIsIE10){if(obj.offsetWidth>0){var rect=obj.getBoundingClientRect();var objZoomLevel=Math.round((rect.right-rect.left)/obj.offsetWidth*100);left=left/objZoomLevel*100;}}var top;if(!bIsDXIE){var rwb_viewer=microstrategy.getViewerBone().elem;top=obj.getBoundingClientRect().top-2+getDocumentScrollTop()+(rwb_viewer&&rwb_viewer.scrollTop)||0;}else{top=getObjSumTop(obj);}top=top-selections.parentBone.top;var height=0;var width=0;if(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_LINE){var bt=microstrategy.styleObj.getValue(obj,"borderTopWidth");var bl=microstrategy.styleObj.getValue(obj,"borderLeftWidth");if(bt&&parseFloat(bt)>0){height=parseInt(format.getPxFromPt(parseFloat(bt)));width=parseInt(this.styleObj.getValue(obj,"width"));}if(bl&&parseFloat(bl)>0){height=parseInt(this.styleObj.getValue(obj,"height"));width=parseInt(format.getPxFromPt(parseFloat(bl)));}}else{var innerHeight,innerWidth;innerHeight=this.styleObj.getInnerHeight(obj);innerWidth=this.styleObj.getInnerWidth(obj);height=Math.floor(innerHeight+microstrategy.getPaddingAndBorderPixels(obj,"height"));width=Math.floor(innerWidth+microstrategy.getPaddingAndBorderPixels(obj,"width"));}this.items[i].style.left=left+"px";this.items[i].style.top=top+"px";if(height>0){this.items[i].style.height=height+"px";}if(width>0){this.items[i].style.width=width+"px";}}this.syncHandles();microstrategy.formatType=oldFormatType;}catch(err){microstrategy.errors.log(err);}return ;};mstrDocHilite.prototype.syncHandles=function(isResizing){try{var def=this.getDefault();if(def==null){return ;}var h=parseInt(def.style.height);var w=parseInt(def.style.width);if(isNaN(h)||isNaN(w)){return ;}var handleOffset=(def.style.borderTopWidth.length>0&&def.style.borderTopWidth!="none"&&def.style.borderTopWidth!="0pt")?1:0;var midHandlePoint=-Math.floor(mstrDocHilite.HANDLE_SIZE/2);def.setAttribute("oHeight",def.style.height);def.setAttribute("oWidth",def.style.width);if(def.src.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_LINE){var startHandlePoint=mstrDocHilite.OFFSET-mstrDocHilite.HANDLE_SIZE;var s=def.childNodes[0].className;var isVert=(this.styleObj.getAttValue(def.src,microstrategy.HTMLATTR_ORIENTATION)==microstrategy.ORIENTATION_VERTICAL);if(isVert){if(s=="w"||s=="e"){def.childNodes[0].className="n";def.childNodes[1].className="s";}handleOffset=(def.style.borderLeftWidth.length>0&&def.style.borderLeftWidth!="none"&&def.style.borderLeftWidth!="0pt")?1:0;moveObjTo(def.childNodes[0],midHandlePoint-handleOffset,startHandlePoint);moveObjTo(def.childNodes[1],midHandlePoint-handleOffset,h+midHandlePoint);}else{if(s=="n"||s=="s"){def.childNodes[0].className="w";def.childNodes[1].className="e";}moveObjTo(def.childNodes[0],startHandlePoint,midHandlePoint-handleOffset);moveObjTo(def.childNodes[1],w+midHandlePoint,midHandlePoint-handleOffset);}}else{def.childNodes[0].style.top=def.childNodes[1].style.top=def.childNodes[2].style.top=-5-handleOffset+"px";def.childNodes[0].style.left=def.childNodes[3].style.left=def.childNodes[5].style.left=-5-handleOffset+"px";def.childNodes[3].style.top=def.childNodes[4].style.top=(Math.floor(h/2)+midHandlePoint)+"px";def.childNodes[5].style.top=def.childNodes[6].style.top=def.childNodes[7].style.top=(h-2+handleOffset)+"px";def.childNodes[1].style.left=def.childNodes[6].style.left=(Math.floor(w/2)+midHandlePoint)+"px";def.childNodes[2].style.left=def.childNodes[4].style.left=def.childNodes[7].style.left=(w-2+handleOffset)+"px";}}catch(err){microstrategy.errors.log(err);}return ;};function mstrDocHilite(bone){this.items=[];this.parentBone=bone;this.styleObj=bone.styleObj;return this;}mstrResizeDocObjs.prototype={};mstrResizeDocObjs.prototype.onload=function(obj,path){try{this.parentBone=obj;this.path=path;this.verifiedPath=microstrategy.getEventHandlerString(this.path);this.doc=this.parentBone.parentBone;this.oc=this.parentBone.objCache;this.um=this.doc.parentBone.updateManager;}catch(err){microstrategy.errors.log(err);}return false;};mstrResizeDocObjs.prototype.onresizestart=function(e,style){try{if(!e){e=window.event;}if(e.e){e=e.e;}this.items=this.parentBone.items;this.doc.syncPosition();this.oc.resizeStyle=style;this.parentBone.hilites[this.oc.activeHilite.getAttribute("id").substr(6)].setDefault(this.oc.activeHilite);this.parentBone.toggleHiliteBorders(true);if(typeof (mstr)!="undefined"){this.parentBone.parentBone.attachWinListener(this,"mousemove","onresize");this.parentBone.parentBone.attachWinListener(this,"mouseup","onresizeend");}else{document.onmousemove=new Function("e",this.verifiedPath+" { return "+this.path+".onresize(e); }");document.onmouseup=new Function("e",this.verifiedPath+" { return "+this.path+".onresizeend(e); }");}for(var id in this.items){if(this.items[id].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){microstrategy.bone(this.items[id].firstChild.id).toggleCurtain(true);}}this.onresize(e);}catch(err){microstrategy.errors.log(err);}return false;};mstrResizeDocObjs.prototype.checkMovedDistance=function(e){var th=parseInt(microstrategy.SNAP_SIZE/2),selections=this.parentBone,moved=this.getMovedDistance(e),movedDistance=Math.abs(moved.x)%th,movedDistanceY=Math.abs(moved.y)%th,halfTh=parseInt(th/2);movedDistance=movedDistance>halfTh?th-movedDistance:movedDistance;movedDistanceY=movedDistanceY>halfTh?th-movedDistanceY:movedDistanceY;return movedDistance>=halfTh||movedDistanceY>=halfTh;};mstrResizeDocObjs.prototype.getMovedDistance=function(e){var pb=this.parentBone,docViewerElem=pb.docViewer.elem;var slDiff=(mstr.utils.ISFF2||mstr.utils.ISIE8)?(docViewerElem.scrollLeft-pb.mousedownScrollLeft):0,stDiff=docViewerElem.scrollTop-pb.mousedownScrollTop;return{x:slDiff+lMouseX-pb.mousedownX,y:stDiff+lMouseY-pb.mousedownY};};mstrResizeDocObjs.prototype.onresize=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}var pb=this.parentBone;getMouse(e);pb.getMouseDirection();var notUseSnap=(e.ctrlKey)?!microstrategy.SNAP_OFF:microstrategy.SNAP_OFF;if(!notUseSnap&&!this.checkMovedDistance(e)){return false;}var dx=dy=dr=db=1;var id=this.oc.activeHilite.getAttribute("id").substr(6);var style=this.oc.resizeStyle;var rect=new RectObj(pb.hilites[id].getDefault().src);var moved=this.getMovedDistance(e);if(style.indexOf("w")>-1){dx=(rect.width-moved.x)/rect.width;}if(style.indexOf("e")>-1){dr=(rect.width+moved.x)/rect.width;}if(style.indexOf("n")>-1){dy=(rect.height-moved.y)/rect.height;}if(style.indexOf("s")>-1){db=(rect.height+moved.y)/rect.height;}var newrects=this.getNewRects(style,dx,dy,dr,db,true,true,notUseSnap);if(!newrects){return false;}var i=0;var subBone=microstrategy.findBone(this.items[id].parentNode);this.dxoff=this.dyoff=this.droff=this.dboff=0;if(!notUseSnap&&subBone.canShowGuideline()){if(style.indexOf("w")>-1){this.dxoff=subBone.guidelineOffsetX||0;}if(style.indexOf("e")>-1){this.droff=subBone.guidelineOffsetX||0;}if(style.indexOf("n")>-1){this.dyoff=subBone.guidelineOffsetY||0;}if(style.indexOf("s")>-1){this.dboff=subBone.guidelineOffsetY||0;}}for(var id in this.items){if(this.parentBone.isLocked(this.items[id])){continue;}var hilite=this.parentBone.hilites[id].getDefault();var r=newrects&&newrects[i++];if((this.dxoff||this.droff||this.dyoff||this.dboff)){this.previousRect=r;r=this.adjustForGuidelineSnapOffset(r,style);var style=hilite.style;style.width=Math.max(Math.ceil(r.width-microstrategy.getPaddingAndBorderPixels(hilite,"width")),0)+"px";style.height=Math.max(Math.ceil(r.height-microstrategy.getPaddingAndBorderPixels(hilite,"height")),0)+"px";if(subBone.isHorizontal){style.left=r.left+getObjSumLeft(this.items[id].parentNode)-this.doc.left+"px";}else{style.left=r.left+"px";}style.top=r.top+"px";this.parentBone.hilites[id].syncHandles(true);subBone.showGuidelines(subBone.getLocalPosition(hilite));}else{if(!(this.previousRect&&(r.left==this.previousRect.left&&r.top==this.previousRect.top&&r.width==this.previousRect.width&&r.height==this.previousRect.height))){this.previousRect=null;var mdir=this.parentBone.parentBone.selections.mouseDir,xdir=mdir.x,ydir=mdir.y;var w=Math.max(parseInt(r.width-microstrategy.getPaddingAndBorderPixels(hilite,"width")),0),h=Math.max(parseInt(r.height-microstrategy.getPaddingAndBorderPixels(hilite,"height")),0),t=r.top,l=subBone.isHorizontal?r.left+getObjSumLeft(this.items[id].parentNode)-this.doc.left:r.left,style=hilite.style;if(xdir<0&&l<parseInt(style.left)||xdir>0&&l>parseInt(style.left)){style.left=l+"px";}if(ydir<0&&t<parseInt(style.top)||ydir>0&&t>parseInt(style.top)){style.top=t+"px";}if(xdir<0&&w<parseInt(style.width)||xdir>0&&w>parseInt(style.width)){style.width=w+"px";}if(ydir<0&&h<parseInt(style.height)||ydir>0&&h>parseInt(style.height)){style.height=h+"px";}this.parentBone.hilites[id].syncHandles(true);subBone.showGuidelines(subBone.getLocalPosition(hilite));}}}}catch(err){microstrategy.errors.log(err);}return false;};mstrResizeDocObjs.prototype.onresizeend=function(e){try{if(!e){e=window.event;}if(e.e){e=e.e;}this.parentBone.onmouseup(e,this.path);for(var id in this.items){if(this.items[id].getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_HTML_CONTAINER){microstrategy.bone(this.items[id].firstChild.id).toggleCurtain(false);}}var id=this.oc.activeHilite.getAttribute("id").substr(6);if(!this.parentBone.hilites[id]){return ;}var rect=new RectObj(this.parentBone.hilites[id].getDefault().src);this.parentBone.toggleHiliteBorders(false);var style=this.oc.resizeStyle;var dx=dy=dr=db=0;var moved=this.getMovedDistance(e);if(style.indexOf("w")>-1){dx=-moved.x;}if(style.indexOf("e")>-1){dr=moved.x;}if(style.indexOf("n")>-1){dy=-moved.y;}if(style.indexOf("s")>-1){db=moved.y;}var notUseSnap=(e.ctrlKey)?!microstrategy.SNAP_OFF:microstrategy.SNAP_OFF;this.resizeItems(style,dx,dy,dr,db,true,notUseSnap);this.oc.activeHilite=null;for(var id in this.parentBone.hilites){this.parentBone.hilites[id].vflipped=this.parentBone.hilites[id].hflipped=false;}microstrategy.eventManager.notifyOrphanBones("onboneafterresize",this.parentBone.getSelectedIds());this.doc.parentBone.isDragging=false;this.parentBone.parentBone.selections.syncPositionMap(this.items);}catch(err){microstrategy.errors.log(err);}return false;};mstrResizeDocObjs.prototype.getNewRects=function(style,dx,dy,dr,db,canFlip,useHilite,notUseSnap){try{this.items=this.parentBone.items;var newrects=[];var maxX=100000;var maxY=100000;var maxR=-100000;var maxB=-100000;for(var id in this.items){var obj=this.items[id];var parent=obj.parentNode;var rect=new RectObj(obj);var parentRect=new RectObj(parent);maxX=Math.min(((rect.right-getObjSumLeft(parent))/rect.width),maxX);maxY=Math.min(((rect.bottom-getObjSumTop(parent))/rect.height),maxY);maxR=Math.max(((rect.left-parentRect.right)/rect.width),maxR);maxB=Math.max(((rect.top-parentRect.bottom)/rect.height),maxB);}var insidePanel=obj.parentNode.getAttribute("sty")==microstrategy.SUBOBJTYPE_DOC_PANEL;if(insidePanel){dx=Math.max(1+maxR,Math.min(maxX,dx));dr=Math.min(-maxR,Math.max(1-maxX,dr));dy=Math.max(1+maxB,Math.min(maxY,dy));db=Math.min(-maxB,Math.max(1-maxY,db));}else{dx=Math.min(maxX,dx);dr=Math.max(1-maxX,dr);dy=Math.min(maxY,dy);db=Math.max(1-maxY,db);}for(var id in this.items){var hilite=this.parentBone.hilites[id];var obj=this.items[id];var offsetSection=obj.parentNode;var rect=new RectObj(obj);var originalH=rect.height;var originalW=rect.width;rect.add(Math.round(-rect.width*dx+rect.width),Math.round(-rect.height*dy+rect.height),Math.round(rect.width*dr-rect.width),Math.round(rect.height*db-rect.height));var subBone=microstrategy.findBone(this.items[id].parentNode);if(subBone.isHorizontal){rect.setBase(((bIsW3C)?this.parentBone.leftBorderOffset:0)+getObjSumLeft(parent),this.doc.top);}else{rect.setBase(this.doc.left+((bIsW3C)?this.parentBone.leftBorderOffset:0),this.doc.top);}var snapX=snapY=snapR=snapB=0;if(dx&&dx!=1){snapX=microstrategy.snapCoordinate(rect.left,0,!notUseSnap,(dx<1)?microstrategy.SNAP_DIRET_POS:microstrategy.SNAP_DIRET_NEG)-rect.left;}if((dy&&dy!=1)&&!notUseSnap){snapY=microstrategy.snapCoordinate(rect.top,(getObjSumTop(offsetSection)-this.doc.top),!notUseSnap,(dy<1)?microstrategy.SNAP_DIRET_POS:microstrategy.SNAP_DIRET_NEG)-rect.top;}if(dr&&dr!=1){snapR=microstrategy.snapCoordinate(rect.right,0,!notUseSnap,(dr>1)?microstrategy.SNAP_DIRET_POS:microstrategy.SNAP_DIRET_NEG)-rect.right;}if((db&&db!=1)&&!notUseSnap){snapB=microstrategy.snapCoordinate(rect.bottom,getObjSumTop(offsetSection)-this.doc.top,!notUseSnap,(db>1)?microstrategy.SNAP_DIRET_POS:microstrategy.SNAP_DIRET_NEG)-rect.bottom;}if(!notUseSnap&&insidePanel){if((db!=1)&&(rect.height+snapB)>(originalH*-maxB)){snapB=1;}if((dy!=1)&&(rect.height-snapY)<(originalH*(1+maxB))){snapY=1;}if((dx!=1)&&((rect.width-snapX)>(originalW*maxX)||(rect.width-snapX)<(originalW*(1+maxR)))){snapX=1;}if((dr!=1)&&((rect.width+snapR)>(originalW*-maxR)||(rect.width+snapR)<(originalW*(1-maxX)))){snapR=1;}}rect.add(snapX,snapY,snapR,snapB);if(this.parentBone.styleObj.getAttValue(this.items[id],microstrategy.HTMLATTR_LOCK_ASPECT_RATIO)==microstrategy.TRUE&&style.length==2){var origRect=new RectObj(obj);dx=dr=rect.width/origRect.width;dy=db=rect.height/origRect.height;if(style.indexOf("n")>-1){if(style.indexOf("w")>-1){dx=dy=Math.abs(dx)>Math.abs(dy)?dx:dy;if(maxY<dy){dx=dy=maxY;}if(maxX<dx){dy=dx=maxX;}dr=db=1;}else{dr=dy=Math.abs(dr)>Math.abs(dy)?dr:dy;if(maxY<dy){dr=dy=maxY;}dx=db=1;}}else{if(style.indexOf("w")>-1){dx=db=Math.abs(dx)>Math.abs(db)?dx:db;if(maxX<dx){db=dx=maxX;}dy=dr=1;}else{dr=db=Math.abs(dr)>Math.abs(db)?dr:db;dx=dy=1;}}rect=new RectObj(obj);rect.add(Math.round(-rect.width*dx+rect.width),Math.round(-rect.height*dy+rect.height),Math.round(rect.width*dr-rect.width),Math.round(rect.height*db-rect.height));if(subBone.isHorizontal){rect.setBase(this.parentBone.leftBorderOffset+getObjSumLeft(parent),this.doc.top);}else{rect.setBase(this.doc.left+this.parentBone.leftBorderOffset,this.doc.top);}}if(rect.checkHFlip()){if(!canFlip){return null;}if(useHilite){hilite.hflipped=!hilite.hflipped;}}if(rect.checkVFlip()){if(!canFlip){return null;}if(useHilite){hilite.vflipped=!hilite.vflipped;}}newrects.push(rect);}return newrects;}catch(err){microstrategy.errors.log(err);}};mstrResizeDocObjs.prototype.adjustForGuidelineSnapOffset=function(rect){try{var dxoff=parseInt(this.dxoff)||0,droff=parseInt(this.droff)||0,dyoff=parseInt(this.dyoff)||0,dboff=parseInt(this.dboff)||0;var SZ=microstrategy.SNAP_SIZE;if(Math.abs(dxoff)<SZ&&Math.abs(droff)<SZ&&Math.abs(dyoff)<SZ&&Math.abs(dboff)<SZ){var DR={left:0,top:0,width:0,height:0};var style=this.oc.resizeStyle,mdir=this.parentBone.parentBone.selections.mouseDir,xdir=mdir.x,ydir=mdir.y;if(style.indexOf("w")>-1&&(xdir<0&&dxoff>0||xdir>0&&dxoff<0)){rect.left+=xdir*(Math.abs(dxoff));rect.width-=xdir*(Math.abs(dxoff));DR.left=xdir*(Math.abs(dxoff));DR.width=-xdir*(Math.abs(dxoff));}if(style.indexOf("e")>-1&&(xdir<0&&droff>0||xdir>0&&droff<0)){rect.width+=xdir*(Math.abs(droff));DR.width=xdir*(Math.abs(droff));}if(style.indexOf("n")>-1&&(ydir<0&&dyoff>0||ydir>0&&dyoff<0)){rect.top+=ydir*(Math.abs(dyoff));rect.height-=ydir*(Math.abs(dyoff));DR.top=ydir*(Math.abs(dyoff));DR.height=-ydir*(Math.abs(dyoff));}if(style.indexOf("s")>-1&&(ydir<0&&dboff>0||ydir>0&&dboff<0)){rect.height+=ydir*(Math.abs(dboff));DR.height=ydir*(Math.abs(dyoff));}this.deltaRect=DR;}return rect;}catch(err){microstrategy.errors.log(err);}};mstrResizeDocObjs.prototype.resizeItems=function(style,dx,dy,dr,db,canFlip,notUseSnap){if(!this.parentBone.isActive()){return true;}try{if(canFlip){var baseObj=this.parentBone.hilites[this.oc.activeHilite.getAttribute("id").substr(6)].getDefault().src;}else{var baseObj=this.parentBone.firstItem();for(var id in this.items){var obj=this.items[id];if(style.indexOf("e")>-1&&getObjWidth(obj)<getObjWidth(baseObj)){baseObj=obj;}if(style.indexOf("s")>-1&&getObjHeight(obj)<getObjHeight(baseObj)){baseObj=obj;}}}var rect=new RectObj(baseObj);var x=1;var r=1;var y=1;var b=1;var dUpdate=0;if(style.indexOf("w")>-1){x=(rect.width+dx)/rect.width;dUpdate+=microstrategy.WIDTH_UPDATE;}if(style.indexOf("e")>-1){r=(rect.width+dr)/rect.width;dUpdate+=microstrategy.WIDTH_UPDATE;}if(style.indexOf("n")>-1){y=(rect.height+dy)/rect.height;dUpdate+=microstrategy.HEIGHT_UPDATE;}if(style.indexOf("s")>-1){b=(rect.height+db)/rect.height;dUpdate+=microstrategy.HEIGHT_UPDATE;}var newrects=this.getNewRects(style,x,y,r,b,canFlip,false,notUseSnap);if(!newrects){this.parentBone.syncUp();return true;}this.items=this.parentBone.items;var ac=[];var count=0;var flushChangesAfterResize=false;for(var id in this.items){if(this.parentBone.isLocked(this.items[id])){continue;}if(this.resizeItem(this.items[id],newrects[count++],ac,dUpdate)){flushChangesAfterResize=true;}}ac=this.parentBone.resizeSubSection(false,ac);ac=this.parentBone.resetRange(false,ac);if(ac&&ac.length>0){this.um.add(ac);if(flushChangesAfterResize){this.um.flushAndSubmitChanges();}}this.parentBone.syncUp();microstrategy.eventManager.notifyOrphanBones("onboneafterresize",this.parentBone.getSelectedIds());}catch(err){microstrategy.errors.log(err);}return false;};mstrResizeDocObjs.prototype.resizeItem=function(obj,rect,ac,dUpdate){try{var flushChangesAfterResize=false;if(!this.parentBone.isActive()){return flushChangesAfterResize;}var deltaRect=this.deltaRect;if(deltaRect){rect.left+=deltaRect.left;rect.top+=deltaRect.top;rect.width+=deltaRect.width;rect.height+=deltaRect.height;}var styleObj=microstrategy.styleObj;var subBone=microstrategy.findBone(obj.parentNode);var fitWidthBone=null;var hsa=0;if(subBone.isHorizontal){hsa=getObjSumLeft(obj.parentNode)-this.doc.left;}if(bIsW3C){var borderLeftWidth=styleObj.getValue(this.doc.elem,"borderLeftWidth");if(borderLeftWidth!=null&&borderLeftWidth.indexOf("pt")>0){var formatObj=microstrategy.getFormatObject();borderLeftWidth=Math.round(formatObj.getPxFromPt(parseFloat(borderLeftWidth)));}else{borderLeftWidth=0;}ac=this.doc.formatItems(microstrategy.createAssociativeArray(obj),"left",(rect.left-getObjSumLeft(obj.parentNode)+this.doc.left+borderLeftWidth+hsa)+"px",false,ac);}else{ac=this.doc.formatItems(microstrategy.createAssociativeArray(obj),"left",(rect.left-getObjSumLeft(obj.parentNode)+this.doc.left+hsa)+"px",false,ac);}ac=this.doc.formatItems(microstrategy.createAssociativeArray(obj),"top",(rect.top-getObjSumTop(obj.parentNode)+this.doc.top)+"px",false,ac);switch(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)){case microstrategy.SUBOBJTYPE_DOC_LINE:if(this.parentBone.styleObj.getAttValue(obj,microstrategy.HTMLATTR_ORIENTATION)==microstrategy.ORIENTATION_VERTICAL){this.doc.formatSize(microstrategy.createAssociativeArray(obj),"height",rect.height+"px",ac);this.doc.formatSizeMode(microstrategy.createAssociativeArray(obj),"heightMode","0",ac,false);}else{this.doc.formatSize(microstrategy.createAssociativeArray(obj),"width",rect.width+"px",ac);this.doc.formatSizeMode(microstrategy.createAssociativeArray(obj),"widthMode","0",ac,false);}break;case microstrategy.SUBOBJTYPE_DOC_TEMPLATE:case microstrategy.SUBOBJTYPE_DOC_TEXT:var gridBone=null,textDirection=microstrategy.styleObj.getValue(obj,"TextDirection")||"0";if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){var olHM=this.parentBone.checkFormat("Hmode");var olWM=this.parentBone.checkFormat("Wmode");this.doc.formatSizeMode(microstrategy.createAssociativeArray(obj),"heightMode","0",ac,false);this.doc.formatSizeMode(microstrategy.createAssociativeArray(obj),"widthMode","0",ac,false);if(obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){gridBone=microstrategy.findBone(obj);if(gridBone&&((gridBone.commands.queryState("gridMode")!=microstrategy.DISPLAY_MODE_GRID&&gridBone.isTemplateEmpty()==false)||(this.parentBone.parentBone.commands.queryState("Overflow")=="1"&&olHM=="2"&&olWM=="2"))){flushChangesAfterResize=true;}}}this.doc.formatSize(microstrategy.createAssociativeArray(obj),"height",rect.height+"px",ac,true);this.doc.formatSize(microstrategy.createAssociativeArray(obj),"width",rect.width+"px",ac,true);if(gridBone&&gridBone.commands.queryState("gridMode")==microstrategy.DISPLAY_MODE_GRID&&gridBone.isTemplateEmpty()==false&&gridBone.commands.queryState("fittowindow")&&!gridBone.lockSet){fitWidthBone=gridBone;}break;case microstrategy.SUBOBJTYPE_DOC_SHAPE:case microstrategy.SUBOBJTYPE_DOC_SELECTOR_CONTROL:if(dUpdate==microstrategy.HEIGHT_UPDATE||dUpdate==microstrategy.WIDTH_AND_HEIGHT_UPDATE){if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){this.doc.formatSizeMode(microstrategy.createAssociativeArray(obj),"heightMode","0",ac,false);}this.doc.formatSize(microstrategy.createAssociativeArray(obj),"height",rect.height+"px",ac,true);}if(dUpdate==microstrategy.WIDTH_UPDATE||dUpdate==microstrategy.WIDTH_AND_HEIGHT_UPDATE){if(microstrategy.DISPLAY_MODE!=microstrategy.DESIGN_MODE){this.doc.formatSizeMode(microstrategy.createAssociativeArray(obj),"widthMode","0",ac,false);}this.doc.formatSize(microstrategy.createAssociativeArray(obj),"width",rect.width+"px",ac,true);}break;default:this.doc.formatSize(microstrategy.createAssociativeArray(obj),"height",rect.height+"px",ac,true);this.doc.formatSize(microstrategy.createAssociativeArray(obj),"width",rect.width+"px",ac,true);break;}var w=getObjWidth(obj);var h=getObjHeight(obj);var subtype=obj.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE);if(subtype==microstrategy.SUBOBJTYPE_DOC_IMAGE){var picture=microstrategy.subObjectFind(obj,["IMG"]);this.setPictureDimension(obj,picture,h,w);}else{if(subtype==microstrategy.SUBOBJTYPE_DOC_TEMPLATE){mstrStaticDoc.getBone(obj).resizeGridAndGraph(h,w);}else{if(subtype==microstrategy.SUBOBJTYPE_DOC_PANEL_STACK){var bone=microstrategy.bone(obj.getAttribute("id"));if(bone){bone.resize(this.doc.removePaddingAndBorder(obj,rect.height,"height"),this.doc.removePaddingAndBorder(obj,rect.width,"width"));}}}}if(fitWidthBone){fitWidthBone.commands.exec("setColWidthsMode",mstrGridReport.COL_WIDTH_FIT_TO_DISPLAY);if(fitWidthBone.colWidths){fitWidthBone.colWidths.syncCols();}}return flushChangesAfterResize;}catch(err){microstrategy.errors.log(err);return false;}};mstrResizeDocObjs.prototype.setPictureDimension=function(container,picture,h,w){try{if(picture){picture.style.height="100%";picture.style.width="100%";}}catch(err){microstrategy.errors.log(err);}};function mstrResizeDocObjs(){return this;}function Rect(top,right,bottom,left){this.top=top;this.right=right;this.bottom=bottom;this.left=left;return this;}RectObj.prototype={};RectObj.prototype.toString=function(){try{var s="";for(var prop in this){if(typeof (this[prop])!="function"){s+=prop+": "+this[prop]+"\n";}}return s;}catch(err){microstrategy.errors.log(err);return"";}};RectObj.prototype.add=function(dx,dy,dr,db){try{if(dx){this.left+=dx;}if(dy){this.top+=dy;}if(dr){this.right+=dr;}if(db){this.bottom+=db;}this.height=this.bottom-this.top;this.width=this.right-this.left;}catch(err){microstrategy.errors.log(err);}};RectObj.prototype.setBase=function(x,y){try{this.left-=x;this.top-=y;this.right-=x;this.bottom-=y;}catch(err){microstrategy.errors.log(err);}};RectObj.prototype.checkHFlip=function(){try{if(this.bottom<=this.top){var i=this.top;this.top=this.bottom;this.bottom=i;this.height=this.bottom-this.top;return true;}return false;}catch(err){microstrategy.errors.log(err);}};RectObj.prototype.checkVFlip=function(){try{if(this.right<=this.left){var i=this.left;this.left=this.right;this.right=i;this.width=this.right-this.left;return true;}return false;}catch(err){microstrategy.errors.log(err);}};function RectObj(obj){var textDirection=microstrategy.styleObj.getValue(obj,"TextDirection")||"0";try{var vExtra=hExtra=0;if(obj.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){var lw="width",lh="height",vExtra=Math.round(microstrategy.getPaddingAndBorderPixels(obj,lh)),hExtra=Math.round(microstrategy.getPaddingAndBorderPixels(obj,lw));var h=microstrategy.styleObj.getValue(obj,lh);var w=microstrategy.styleObj.getValue(obj,lw);if(h=="auto"||h=="100%"){this.height=textDirection==="0"?getObjHeight(obj):getObjWidth(obj);}else{this.height=Math.max(parseInt(h)+vExtra,0);}if(w=="auto"||w=="100%"){this.width=textDirection==="0"?getObjWidth(obj):getObjHeight(obj);}else{this.width=Math.max(parseInt(w)+hExtra,0);}}else{var pts=0;if(obj.style.borderTopWidth.length>0){pts+=parseFloat(obj.style.borderTopWidth);}if(obj.style.borderBottomWidth.length>0){pts+=parseFloat(obj.style.borderBottomWidth);}vExtra=Math.round(microstrategy.getFormatObject().getPxFromPt(pts));pts=0;if(obj.style.borderLeftWidth.length>0){pts+=parseFloat(obj.style.borderLeftWidth);}if(obj.style.borderRightWidth.length>0){pts+=parseFloat(obj.style.borderRightWidth);}hExtra=Math.round(microstrategy.getFormatObject().getPxFromPt(pts));this.height=Math.max(parseInt(obj.style.height)+vExtra);this.width=Math.max(parseInt(obj.style.width)+hExtra);}this.left=getObjSumLeft(obj);this.top=getObjSumTop(obj);if(!bIsDXIE&&textDirection==="90"){this.top=this.top-this.height;}this.right=this.left+this.width;this.bottom=this.top+this.height;return this;}catch(err){microstrategy.errors.log(err);return null;}}