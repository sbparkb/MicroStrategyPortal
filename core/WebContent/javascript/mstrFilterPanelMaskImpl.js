mstrFilterPanelMaskImpl.prototype=new mstrSubSectionMaskImpl();mstrFilterPanelMaskImpl.prototype.selectorInfo={};mstrFilterPanelMaskImpl.prototype.maxZIndex=0;mstrFilterPanelMaskImpl.ITEM_SPA=2;mstrFilterPanelMaskImpl.prototype.onload=function(maskedBone){try{this.maskedBone=maskedBone;this.verifiedPath=microstrategy.getEventHandlerString(this.path);this.initElem();}catch(err){microstrategy.errors.log(err);return false;}};mstrFilterPanelMaskImpl.prototype.initElem=function(){try{var isPanel=(this.maskedBone.subsectionType==mstrSubSection.TYPE_PANEL);var div=document.createElement("div");div.setAttribute("id",this.maskedBone.id+"_mask");div.setAttribute("name",this.maskedBone.id+"_mask");div.style.position=(isPanel)?"absolute":"relative";div.style.overflow="hidden";var img=document.createElement("img");img.src=microstrategy.FOLDER_IMAGES+"1ptrans.gif";img.style.width="100%";img.style.height="100%";if(this.maskedBone){div.style.height=this.getSectionHeight(this.maskedBone.elem)+"px";if(this.maskedBone.isHorizontal){if(this.getSectionWidth(this.maskedBone.elem)!=0){div.style.width=this.getSectionWidth(this.maskedBone.elem)+"px";}}}div.appendChild(img);this.img=img;this.elem=div;this.createImageMap();if(parseInt(this.elem.style.height)>0){this.elem.setAttribute("isCollapsed","false");}else{this.img.onmouseover=null;this.img.onmouseout=null;this.elem.setAttribute("isCollapsed","true");this.elem.style.cursor="not-allowed";}}catch(err){microstrategy.errors.log(err);return false;}};mstrFilterPanelMaskImpl.prototype.updateImageMap=function(){try{this.elem.removeChild(this.imgMap);this.maxZIndex=0;this.createImageMap();}catch(err){microstrategy.errors.log(err);}};mstrFilterPanelMaskImpl.prototype.createImageMap=function(){try{var imgMap=document.createElement("map");var mapId=this.maskedBone.id+"_fpMap";imgMap.setAttribute("id",mapId);imgMap.setAttribute("name",mapId);this.img.setAttribute("usemap","#"+mapId);imgMap.setAttribute(microstrategy.HTMLATTR_OBJTYPE,microstrategy.OBJTYPE_MASK);imgMap.setAttribute(microstrategy.HTMLATTR_MASKEDOBJECT,this.maskedBone.id);imgMap.setAttribute(microstrategy.HTMLATTR_POINTS_TO,this.secId+"|"+this.subId+"|"+this.subIndex);this.elem.appendChild(imgMap);this.imgMap=imgMap;if(this.maskedBone.elem){var area,fp=this.maskedBone.elem,th=mstrFilterPanelMaskImpl.ITEM_SPA;this.selectorInfo={};for(var i=0;i<fp.childNodes.length;i++){var c=fp.childNodes[i];if(c.getAttribute(microstrategy.HTMLATTR_OBJTYPE)==microstrategy.OBJTYPE_DOC_OBJECT){area=document.createElement("area");area.setAttribute("shape","rect");area.setAttribute("coords",this.getChildCoords(c));area.setAttribute("ctrlId",c.getAttribute("id"));imgMap.appendChild(area);th+=mstr.utils.BoxModel.getElementOuterHeight(c)+mstrFilterPanelMaskImpl.ITEM_SPA;var soz=parseInt(microstrategy.styleObj.getValue(c,"zIndex"));this.selectorInfo[c.getAttribute("id")]={zIndex:soz,item:c};if(soz>this.maxZIndex){this.maxZIndex=soz;}area.setAttribute("soz",soz);area.onmouseover=new Function("e",this.verifiedPath+" { return "+this.path+".displayMask(e, true); }");area.onmouseout=new Function("e",this.verifiedPath+" { return "+this.path+".displayMask(e, false); }");}}if(mstr.utils.BoxModel.getElementOuterHeight(this.maskedBone.elem)>th){area=document.createElement("area");area.setAttribute("shape","rect");area.setAttribute("coords",this.getChildCoords(this.maskedBone.elem,th));imgMap.appendChild(area);area.onmouseover=new Function("e",this.verifiedPath+" { return "+this.path+".displayMask(e, true); }");area.onmouseout=new Function("e",this.verifiedPath+" { return "+this.path+".displayMask(e, false); }");}}}catch(err){microstrategy.errors.log(err);}};mstrFilterPanelMaskImpl.prototype.getChildCoords=function(c,th){try{var hm=microstrategy.styleObj.getAttValue(c,microstrategy.HTMLATTR_HEIGHT_MODE);if(!hm||hm!=microstrategy.HUNDRED_PERCENT_MODE){var isPanel=(c.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_DOC_PANEL);t=isPanel?th:parseInt(microstrategy.styleObj.getValue(c,"top")),l=isPanel?mstrFilterPanelMaskImpl.ITEM_SPA:parseInt(microstrategy.styleObj.getValue(c,"left")),b=t+mstr.utils.BoxModel.getElementOuterHeight(c),r=l+mstr.utils.BoxModel.getElementOuterWidth(c);}return l+", "+t+", "+r+", "+b;}catch(err){microstrategy.errors.log(err);return false;}};mstrFilterPanelMaskImpl.prototype.displayMask=function(e,show){try{var submaskDiv=document.getElementById("maskDiv");if(!submaskDiv){submaskDiv=document.createElement("div");submaskDiv.setAttribute("id","maskDiv");submaskDiv.style.position="absolute";var docMask=document.getElementById("docMask");docMask.insertBefore(submaskDiv,docMask.firstChild);}if(!show){submaskDiv.style.display="none";return false;}if(!e){e=window.event;}var srcArea=getEventTarget(e);if(!srcArea&&srcArea.tagName!="AREA"){return false;}with(submaskDiv.style){border="solid #ffff00";borderTopWidth="3px";borderLeftWidth=borderRightWidth=borderBottomWidth="0px";display="block";visibility="visible";var coords=srcArea.getAttribute("coords").split(",");height=(parseInt(coords[3])-parseInt(coords[1]))+"px";width=(parseInt(coords[2])-parseInt(coords[0]))+"px";left=getObjSumLeft(this.maskedBone.elem)-parseInt(this.maskedBone.doc.left)+parseInt(coords[0])+"px";top=getObjSumTop(this.maskedBone.elem)-parseInt(this.maskedBone.doc.top)+parseInt(coords[1])+"px";}}catch(err){microstrategy.errors.log(err);}return false;};mstrFilterPanelMaskImpl.prototype.adjustZIndex=function(dragId,dropId,bDel){try{var dragNI=dragId?this.selectorInfo[dragId]:null,dropNI=dropId?this.selectorInfo[dropId]:null,startZ,endZ;if(!dragId){if(!dropId){return false;}else{startZ=bDel?parseInt(dropNI.zIndex)+1:parseInt(dropNI.zIndex);endZ=bDel?parseInt(this.maxZIndex)+1:parseInt(this.maxZIndex);for(var id in this.selectorInfo){var c=this.selectorInfo[id];if(c.zIndex>=startZ&&c.zIndex<endZ){if(bDel){c.zIndex--;}else{c.zIndex++;}}}}}else{if(!dropId||dragNI.zIndex<dropNI.zIndex){startZ=parseInt(dragNI.zIndex);endZ=parseInt(dropNI?dropNI.zIndex-1:this.maxZIndex);if(dragNI.zIndex==endZ){return false;}dragNI.zIndex=endZ;for(var id in this.selectorInfo){var c=this.selectorInfo[id];if(id==dragId){continue;}if(c.zIndex>startZ&&c.zIndex<=endZ){c.zIndex--;}}}else{if(dragNI.zIndex>dropNI.zIndex){startZ=dropNI.zIndex;endZ=dragNI.zIndex;dragNI.zIndex=startZ;for(var id in this.selectorInfo){var c=this.selectorInfo[id];if(id==dragId){continue;}if(c.zIndex>=startZ&&c.zIndex<endZ){c.zIndex++;}}}else{if(dragNI.zIndex==dropNI.zIndex){return false;}}}}}catch(err){microstrategy.errors.log(err);return false;}return true;};mstrFilterPanelMaskImpl.prototype.getMoveItems=function(){try{var arr=[];for(var id in this.selectorInfo){var c=this.selectorInfo[id];if(c.zIndex!=microstrategy.styleObj.getValue(c.item,"zIndex")){arr.push(c);}}arr.sort(function(l,r){return l.zIndex-r.zIndex;});return arr;}catch(err){microstrategy.errors.log(err);}};mstrFilterPanelMaskImpl.prototype.getStartArea=function(zIndex){try{var area=microstrategy.findChildWithAtt(this.imgMap,"AREA","soz",zIndex+"");if(area){return area;}else{return this.imgMap.lastChild;}}catch(err){microstrategy.errors.log(err);}};function mstrFilterPanelMaskImpl(secId,subId,subIndex){this.inherits=mstrSubSectionMaskImpl;this.inherits(secId,subId,subIndex);this.inherits=null;return this;}