mstrReportGraphCMImplScript=true;mstrReportGraphCMImpl.prototype=new mstrReportGraphImpl();mstrReportGraphCMImpl.prototype.oGraphArea=null;mstrReportGraphCMImpl.prototype.mapID=null;mstrReportGraphCMImpl.prototype.keepThreshold=null;mstrReportGraphCMImpl.prototype.retainParent=null;mstrReportGraphCMImpl.prototype.yes=1;mstrReportGraphCMImpl.prototype.no=2;mstrReportGraphCMImpl.prototype.reportDefinition=3;mstrReportGraphCMImpl.prototype.imageId=null;mstrReportGraphCMImpl.prototype.image=null;mstrReportGraphCMImpl.prototype.target=null;mstrReportGraphCMImpl.prototype.openDrillInSameWindow=true;mstrReportGraphCMImpl.prototype.autoArrange=true;mstrReportGraphCMImpl.prototype.PROPERTY_AUTO_ARRANGE="10053";mstrReportGraphCMImpl.prototype.objId=null;mstrReportGraphCMImpl.prototype.seriesId=null;mstrReportGraphCMImpl.prototype.currentColor=null;mstrReportGraphCMImpl.prototype.activeControlID=null;mstrReportGraphCMImpl.prototype.ACTION_FILL_COLOR=0;mstrReportGraphCMImpl.prototype.ACTION_LINE_COLOR=1;mstrReportGraphCMImpl.prototype.ACTION_FONT_COLOR=2;mstrReportGraphCMImpl.prototype.currentActionContext=-1;mstrReportGraphCMImpl.prototype.onload=function(){mstrReportGraphImpl.prototype.onload.call(this);this.image=document.getElementById(this.imageId);this.target=this.getGridBone();};mstrReportGraphCMImpl.prototype.onunload=function(){};mstrReportGraphCMImpl.prototype.checkToolbarCondition=function(){try{return false;}catch(err){microstrategy.errors.log(err);return false;}};mstrReportGraphCMImpl.prototype.onboneselected=function(selectedBoneIds){try{}catch(err){microstrategy.errors.log(err);return false;}};mstrReportGraphCMImpl.prototype.onboneafterresize=function(selectedBoneIds){try{}catch(err){microstrategy.errors.log(err);return false;}};mstrReportGraphCMImpl.prototype.submitControlAction=function(axesMap,ctrlKeys,usePartialDisplay){try{var updateManager=microstrategy.updateManager;var actionCollection=new Array();if(this.retainParent==this.reportDefinition){this.retainParent="";}if(this.keepThreshold==this.reportDefinition){this.keepThreshold="";}if(this.getTemplateKey()){actionCollection.push(updateManager.createActionObject(this.currentArea,mstrUpdateManager.CTRL_APPLY_GRAPH_SELECTION,this.docViewer.beanPath,["2048007","2048124","2048122","2048123","2048126","2048137","2048138","2048225"],[this.getTemplateKey(),this.getSliceID(),this.x,this.y,axesMap,this.getGridGraphKeyContext(),usePartialDisplay,ctrlKeys]));updateManager.add(actionCollection);updateManager.flushAndSubmitChanges();}}catch(err){microstrategy.errors.log(err);return false;}};mstrReportGraphCMImpl.prototype.submitGraphDrill=function(drillPathKey,viewMode,isWithin,compareMouseCoords){try{var e=window.event;if(e){getMouse(e);if(compareMouseCoords&&(this.mouseDownX!=lMouseX||this.mouseDownY!=lMouseY)){return false;}}var updateManager=microstrategy.updateManager;var actionCollection=new Array();if(this.retainParent==this.reportDefinition){this.retainParent="";}if(this.keepThreshold==this.reportDefinition){this.keepThreshold="";}if(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION&&isWithin=="0"){var rwBone=microstrategy.bone(this.viewerId);if(rwBone){var messageID=rwBone.messageID;this.drillIframeEnabled=false;var paramX=this.x,paramY=this.y;if(this.currentArea&&this.currentArea.coords){var coords=this.currentArea.coords.split(","),validCoord=true;for(var index in coords){coords[index]=parseInt(coords[index]);if(isNaN(coords[index])){validCoord=false;}}if(coords.length===4&&validCoord){if(paramX<coords[0]||paramX>coords[2]){paramX=Math.floor((coords[0]+coords[2])/2);}if(paramY<coords[1]||paramY>coords[3]){paramY=Math.floor((coords[1]+coords[3])/2);}}}actionCollection.push(updateManager.createActionObject(this.currentArea,mstrUpdateManager.GRAPH_DRILL_OUTSIDE,microstrategy.servletName,["3141","3142","3144","3010","3147","3148","3111","3110","3151","3152","3146"],[drillPathKey,this.retainParent,this.keepThreshold,messageID,paramX,paramY,this.graphHeight,this.graphWidth,this.getGroupByElements(),this.getSliceID(),viewMode]));}}else{var x=this.x-parseInt(getDocumentScrollLeft()),y=this.y-parseInt(getDocumentScrollTop());actionCollection.push(updateManager.createActionObject(this.currentArea,mstrUpdateManager.DRILL_GRAPH,this.beanPath,mstrUpdateManager.actions[mstrUpdateManager.DRILL_GRAPH].paramID,[x,y,this.graphHeight,this.graphWidth,this.keepThreshold,drillPathKey,this.retainParent,viewMode,this.getSliceID()]));}updateManager.add(actionCollection);updateManager.newWindow=!this.openDrillInSameWindow&&(isWithin!="1");updateManager.useIframe=this.drillIframeEnabled;updateManager.flushAndSubmitChanges();updateManager.acknowledgeRequest();}catch(err){microstrategy.errors.log(err);return false;}};mstrReportGraphCMImpl.prototype.getGridBone=function(){try{var gridBone=null;var gridElem=findTarget(this.elem,"scriptClass","mstrReportGraphImpl");if(gridElem){gridBone=microstrategy.findBone(gridElem);}else{var graphBone=microstrategy.findBone(this.elem);if(graphBone){var gridId=graphBone.id.substring(0,graphBone.id.length-3);gridBone=microstrategy.bone(gridId);}}return gridBone;}catch(err){microstrategy.errors.log(err);return null;}};mstrReportGraphCMImpl.prototype.getSliceID=function(){var id=this.target&&this.target.sliceID;if(id||(id==0)){return id;}return"";};mstrReportGraphCMImpl.prototype.getTemplateKey=function(){return(this.target&&this.target.objId)||null;};mstrReportGraphCMImpl.prototype.getGridGraphKeyContext=function(){return(this.target&&this.target.gridGraphUnitKeyContext)||null;};mstrReportGraphCMImpl.prototype.getCurrentColor=function(){if(this.currentColor=="#null"){this.currentColor="#FFFFFF";}return this.currentColor;};mstrReportGraphCMImpl.prototype.getActiveControlId=function(){return this.activeControlID;};mstrReportGraphCMImpl.prototype.onmousedown=function(e){e=e||window.event;if(document.activeElement&&document.activeElement.blur&&mstr.utils.ISCHROME){document.activeElement.blur();}getMouse(e);this.mouseDownX=lMouseX;this.mouseDownY=lMouseY;var domNodePosition=mstrmojo.dom.position(this.activeRWUnit||this.image);this.x=Math.round(lMouseX-domNodePosition.x);this.y=Math.round(lMouseY-domNodePosition.y);var utils=mstr.utils,evt=getEventTarget(e);this.currentArea=evt;if(e.button>1){this.oGraphArea=evt;if(utils.ISWK){this.onContextMenu(e);}else{document.oncontextmenu=new Function("e","return microstrategy.bone('"+this.id+"').onContextMenu(e);");}if(mstr.utils.ISIE7){onGraphExit(e);}}else{if(this.currentArea.getAttribute("linked")){stopEventBubbling(e);}}};mstrReportGraphCMImpl.prototype.onContextMenu=function(e){document.oncontextmenu=function(e){return !bIsOverContext&&rightClick(e);};mstrReportGraphImpl.prototype.onContextMenu.call(this,e);var oTarget=findTarget(this.oGraphArea,"CX");if(oTarget){displayContextMenu(oTarget,e);this.adjustFillColorPicker(oTarget);return false;}else{return true;}};mstrReportGraphCMImpl.prototype.adjustFillColorPicker=function(graphArea){try{if(!graphArea){return ;}var seriesId=parseInt(graphArea.getAttribute("seriesId"));if(seriesId>=0){var re=this.target.roundedEffect;var bShow=(re=="false"||re==0);this.showFillColorPkrOptions(bShow);}else{this.showFillColorPkrOptions(true);}}catch(err){microstrategy.errors.log(err);}};mstrReportGraphCMImpl.prototype.showFillColorPkrOptions=function(bShow){var colorPickers=document.getElementsByName("cmFillColorPicker");for(var i=0;i<colorPickers.length;i++){var noColorOpt=microstrategy.findChildWithAtt(colorPickers[i],"SPAN","name","colorPicker0");if(noColorOpt){if(bShow){noColorOpt.style.display="";}else{noColorOpt.style.display="none";}}}};mstrReportGraphCMImpl.prototype.submitFillColor=function(e,objId,seriesId,currentFillColor,gradientCmd){this.currentActionContext=this.ACTION_FILL_COLOR;this.objId=objId;this.seriesId=seriesId;var color=this.getColor(e,currentFillColor,gradientCmd);if(color==null||color=="pkrMore"||color=="pkrGradients"){return ;}this.submitEvent(color,objId,seriesId);};mstrReportGraphCMImpl.prototype.submitLineColor=function(e,objId,seriesId,currentColor){this.currentActionContext=this.ACTION_LINE_COLOR;this.objId=objId;this.seriesId=seriesId;var color=this.getColor(e,currentColor);if(color==null||color=="pkrMore"||color=="pkrGradients"){return ;}this.submitEvent(color,objId,seriesId);};mstrReportGraphCMImpl.prototype.submitFontColor=function(e,objId,seriesId,currentColor){this.currentActionContext=this.ACTION_FONT_COLOR;this.objId=objId;this.seriesId=seriesId;var color=this.getColor(e,currentColor);if(color==null||color=="pkrMore"||color=="pkrGradients"){return ;}this.submitEvent(color,objId,seriesId);};mstrReportGraphCMImpl.prototype.isSupported=function(fieldName,objId,seriesId){objId=(objId==256||objId==350||objId==341||objId==520)?286:objId;this.target.CMTargetId=objId+"_"+seriesId;return this.target.commands.queryEnabled(fieldName);};mstrReportGraphCMImpl.prototype.getColor=function(e,currentColor,gradientCmd){var colorObj=getEventTarget(e);var color=null;if(colorObj&&colorObj.getAttribute(microstrategy.HTMLATTR_OBJTYPE)!="pkr"){color=colorObj.id;if(color.indexOf("#")>-1){color=color.substring(color.indexOf("#")+1);}else{if(color=="pkrMore"){this.currentColor="#"+currentColor;this.activeControlID=this.currentActionContext+"_"+this.objId+"_"+this.seriesId;var bp=(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION?this.docViewer.beanPath:this.beanPath);microstrategy.openDataBasedBlockEditor("AdvancedColorPickerRMC","AdvancedColorPickerRMCBlock",bp,{targetPath:"#"+this.id});}else{if(color=="pkrGradients"){this.commands.exec("edtColorGradient",gradientCmd);}else{if(color=="pkr"){color="";}}}}}return color;};mstrReportGraphCMImpl.prototype.exec=function(cmdId,cmdValue){var color=null;switch(cmdId){case"advColorPicker":var cmdArr=cmdValue.split("|");color=cmdArr[1];var data=cmdArr[0].split("_");this.currentActionContext=parseInt(data[0]);this.objId=parseInt(data[1]);this.seriesId=parseInt(data[2]);this.currentColor=null;this.activeControlID=null;if(color.indexOf("#")>-1){color=color.substring(color.indexOf("#")+1);this.submitEvent(color);}break;case"edtColorGradient":var info=cmdValue.split("|");this.submitEvent(info[1]);break;}};mstrReportGraphCMImpl.prototype.submitEvent=function(color){switch(this.currentActionContext){case this.ACTION_FILL_COLOR:this.target.commands.exec("CMfillColor",{v:color,objId:this.objId,seriesId:this.seriesId});break;case this.ACTION_LINE_COLOR:return this.target.commands.exec("CMlineColor",{v:color,objId:this.objId,seriesId:this.seriesId});break;case this.ACTION_FONT_COLOR:return this.target.commands.exec("CMfontColor",{v:color,objId:this.objId,seriesId:this.seriesId});break;default:return false;}};mstrReportGraphCMImpl.prototype.submitGraphFormat=function(objectId,seriesId,currentTabId){try{if(microstrategy.EXECUTION_SCOPE==microstrategy.RWD_EXECUTION){return this.docViewer.commands.exec("openGraphFormatter");}else{return this.target.commands.exec("openGraphFormatter");}}catch(err){microstrategy.errors.log(err);return false;}};mstrReportGraphCMImpl.prototype.submitAutoArrange=function(){var actionCollection=new Array();var updateManager=microstrategy.updateManager;actionCollection.push(updateManager.createActionObject(this.currentArea,mstrUpdateManager.EDIT_GRAPH_PROPS,this.beanPath,mstrUpdateManager.actions[mstrUpdateManager.EDIT_GRAPH_PROPS].paramID,["","","","","","","","","",true,"9999",this.PROPERTY_AUTO_ARRANGE,"-1","true"]));try{updateManager.add(actionCollection);updateManager.flushAndSubmitChanges();updateManager.acknowledgeRequest();}catch(err){microstrategy.errors.log(err);return false;}};function mstrReportGraphCMImpl(id){this.inherits=mstrReportGraphImpl;this.inherits(id);delete this.inherits;return this;}