var STR_BYTE_LEN=mstrmojo.desc(9660,"Byte length:"),STR_BIT_LEN=mstrmojo.desc(11456,"Bit length:"),STR_PREC=mstrmojo.desc(9659,"Precision:"),STR_SCL=mstrmojo.desc(9662,"Scale:"),STR_TM_SCL=mstrmojo.desc(9661,"Time scale:");var byteLength={txt:STR_BYTE_LEN,field:"ps"},bitLength={txt:STR_BIT_LEN,field:"ps"},precision={txt:STR_PREC,field:"ps"},scale={txt:STR_SCL,field:"sc"},timeScale={txt:STR_TM_SCL,field:"ps"};mstrmojo.architect.EnumColumnDataTypes={"-1":{id:-1,n:mstrmojo.desc(4444,"unknown"),options:[]},0:{id:0,n:"Reserved",options:[]},1:{id:1,n:"Integer",options:[byteLength]},2:{id:2,n:"Unsigned",options:[byteLength]},3:{id:3,n:"Numeric",options:[precision,scale]},4:{id:4,n:"Decimal",options:[precision,scale]},5:{id:5,n:"Real",options:[]},6:{id:6,n:"Double",options:[]},7:{id:7,n:"Float",options:[bitLength]},8:{id:8,n:"Char",options:[byteLength]},9:{id:9,n:"VarChar",options:[byteLength]},10:{id:10,n:"LongVarChar",options:[byteLength]},11:{id:11,n:"Binary",options:[byteLength]},12:{id:12,n:"VarBin",options:[byteLength]},13:{id:13,n:"LongVarBin",options:[byteLength]},14:{id:14,n:"Date",options:[]},15:{id:15,n:"Time",options:[timeScale]},16:{id:16,n:"TimeStamp",options:[timeScale]},17:{id:17,n:"NChar",options:[byteLength]},18:{id:18,n:"NVarChar",options:[byteLength]},30:{id:30,n:"Big Decimal",options:[precision,scale]},34:{id:34,n:"Big Integer",options:[byteLength]}};(function(){var I="FULLCONNECTION",J="MSTR_CUSTOM";function K(O,M){var Q=mstrmojo.string;O=Q.trim(O);var P=/\(\d+\)$/,N=P.exec(O);if(N){M.v=parseInt(O.substring(N.index+1,O.length-1),10);return Q.trim(O.substring(0,N.index));}return O;}mstrmojo.warehouse.dbroles.DBRoleHelper=mstrmojo.provide("mstrmojo.warehouse.dbroles.DBRoleHelper",{isNumeric:function A(M){return !isNaN(parseFloat(M))&&isFinite(M);},getUniqueName:function E(S){S=K(S,{});var V=mstrApp.rootController.getDBRoles(),O=mstrApp.rootController.isCloud(),Q=mstrApp.rootController.getAllDBRoleNames(),U,R=0,T={},P=0,M=S,N=function(W){M=S;if(O){U=K(W.des,T);}else{U=K(W.n,T);}P=Math.max(P,T.v)||0;if(U.toString().toUpperCase()===M.toString().toUpperCase()){R=P+1;}};do{if(!O){mstrmojo.hash.forEach(Q,N);if(R===0){mstrmojo.array.forEach(V,N);}}else{mstrmojo.array.forEach(V,N);}if(R>0){M=S+" ("+R+")";}}while(mstrApp.rootController.findinArray(V,"n",M)>=0);return M;},cleanDSNConnection:function D(M){M=mstrmojo.string.trim(M).replace(/\\/g,"\\\\");M=this.cleanDSNConnectionPlaceHolders(M);M=M.replace(/\\/g,"^^^789^^^");M=M.replace(/:/g,"!!!789!!!");M=M.replace(/,/g,"%%%789%%%");M=M.replace("\\","###789###");M=M.replace(/{/g,"+++789+++");M=M.replace(/}/g,"@@@789@@@");M=M.replace("FULLCONNECTION=","");return M;},cleanDSNConnectionPlaceHolders:function D(M){M=M.replace(/!#AT#!/g,"@");M=M.replace(/!#QUESTION#!/g,"?");M=M.replace(/!#AND#!/g,"&");M=M.replace("!#DRIVERSUFFIX#!","");return M;},cleanLoadedDSNConnection:function B(N,M){var O;N=mstrmojo.string.trim(N);if(M===19){O=N.split(";");mstrmojo.array.forEach(O,function(Q,P){if(Q.search(/^\s*DBQ=/)===-1){O[P]=Q.replace(/\\\\/g,"\\");}});N=O.join(";");}else{N=N.replace(/\\\\/g,"\\");}N=N.replace(/@/g,"!#AT#!");N=N.replace(/\?/g,"!#QUESTION#!");N=N.replace(/&/g,"!#AND#!");return N;},driverAvailable:function H(M){if((M.str.indexOf(I)===0)&&(M.driver===""||M.driver==="XQUERY")){return true;}return(mstrmojo.array.find(this.drivers,"nU",M.driver.toUpperCase())>=0);},driverExists:function F(O){var R=this,P=false,Q="",N=0,M=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.array.forEach(O,function(T,S){if(M.driverAvailable.call(R,T)){P=true;Q=T.driver;N=S;}return !P;});return{exists:P,driver:Q,idx:N};},cleanDriver:function G(N){var P="DRIVER=",M=N.toUpperCase().indexOf(P),O="";if(M>=0){M+=P.length;O=N.substring(M,M+N.substring(M).indexOf(";"));O=O.replace(/([\{\}])+/g,"");}return O;},isCustomConnection:function L(M){return(M.indexOf(J)>=0);},showHelp:function C(N){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(N);}else{var M=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");window.open(M+(N||""),"_blank");return false;}}});}());mstrmojo.warehouse.EnumDatabaseType={SAP:1200,MSAS:1500,EssBase:1600,TM1:2900,SAPHana:4000,BDE:5400,SearchEngineSOLR:5500,SearchEngineSPLUNK:5600};mstrmojo.architect.EnumDataChangeEvents={TABLES_SELECTED:"tablesSelected",TABLES_ADDED:"tablesAdded",TABLES_LOADED:"tablesLoaded",TABLE_LOADED:"tableLoaded",TABLES_CHANGED:"tablesChanged",LAYER_CHANGE:"layerChanged",BEFORE_LAYER_CHANGE:"beforeLayerChanged",LAYER_TABLE_CHANGED:"layerTableChanged",DBROLE_CHANGED:"dbRoleChanged",RENAME:"rename",REMOVE:"remove",RELATIONSHIP_CHANGED:"relationshipChanged",RELATIONSHIP_REMOVED:"relationshipRemoved",USER_HIERARCHY_LOADED:"userHierarchiesLoaded",USER_HIERARCHY_CHANGED:"userHierarchyChanged",TRANSFORMATIONS_CHANGED:"transformationsChanged",TRANSFORMATION_UPDATED:"transformationUpdated",TRANSFORMATION_SELECTED:"transformationSelected",LOGICALVIEWS_CHANGED:"logicalViewsChanged",LOGICALVIEW_SQLEXECUTED:"logicalViewsSQLExecuted",ATTRIBUTES_CHANGED:"attributesChanged",VIEW_ITEM_RENAMED:"viewItemRenamed"};mstrmojo.warehouse.EnumNamespaceMode={ALL:"0",CURRENT:"1"};mstrmojo.mstr.EnumDSSXMLObjectTypes={Generic:-2,Unknown:-1,Reserved:0,Filter:1,Template:2,ReportDefinition:3,Metric:4,Style:6,AggMetric:7,Folder:8,SubscriptionDevice:9,Prompt:10,Function:11,Attribute:12,Fact:13,Dimension:14,Table:15,DatamartReport:16,FactGroup:17,Shortcut:18,Resolution:19,Monitor:20,AttributeForm:21,Schema:22,Format:23,Catalog:24,CatalogDefn:25,Column:26,PropertySet:28,DBRole:29,DBLogin:30,DBConnection:31,Project:32,ServerDef:33,User:34,Configuration:36,Request:37,Script:38,Search:39,SearchFolder:40,Datamart:41,FunctionPackageDefinition:42,Role:43,SecurityRole:44,Locale:45,Consolidation:47,ConsolidationElement:48,ScheduleEvent:49,ScheduleObject:50,ScheduleTrigger:51,Link:52,DbTable:53,TableSource:54,DocumentDefinition:55,DrillMap:56,DBMS:57,MDSecurityFilter:58,PromptAnswer:59,PromptAnswers:60,ObjectTag:65,ReservedLastOne:66};mstrmojo.mstr.EnumDataType={DataTypeUnknown:-1,DataTypeReserved:0,DataTypeInteger:1,DataTypeUnsigned:2,DataTypeNumeric:3,DataTypeDecimal:4,DataTypeReal:5,DataTypeDouble:6,DataTypeFloat:7,DataTypeChar:8,DataTypeVarChar:9,DataTypeLongVarChar:10,DataTypeBinary:11,DataTypeVarBin:12,DataTypeLongVarBin:13,DataTypeDate:14,DataTypeTime:15,DataTypeTimeStamp:16,DataTypeShort:21,DataTypeLong:22,DataTypeMBChar:23,DataTypeBool:24,DataTypePattern:25,DataTypeBigDecimal:30,DataTypeCellFormatData:31,DataTypeInt64:34};mstrmojo.warehouse.EnumDataChangeEvents={DBROLES_REQUESTED:"dbRolesRequested",DBROLES_LOADED:"dbRolesLoaded",DBROLES_ADD:"dbRoleAdd",DBROLES_RENAME:"dbRoleRename",DBROLES_DELETE:"dbRoleDelete",DBROLE_SELECTION:"dbroleSelection",NAMESPACES_CHANGED:"namespacesChanged",NAMESPACES_REQUESTED:"namespacesRequested",DBTABLES_CHANGED:"dbTablesChange",DBTABLES_REQUESTED:"dbTablesRequested",DBTABLE_UPDATED:"dbTableUpdated",DBROLE_CHANGED:"dbRoleChanged",DBTABLES_USED:"dbTablesUsed",DBTABLES_ENABLED:"dbTablesEnabled"};(function(){mstrmojo.cookies={};var C="%26",E="%3D",B=mstrmojo.cookies,D=function(){var F=document.cookie;if(!F||!(typeof F==="string")||F.indexOf("bSet")<0){return false;}return true;},A=function(){var F=document.cookie;F=F.split(";");for(s in F){if(F[s].indexOf("bSet")>=0){return F[s];}}return null;};mstrmojo.cookies.updateCookieSetting=function(H,N,J){try{if(!D()&&!J){return ;}var K=document.cookie,M=H+E+N+C;if(K.indexOf(H)>=0){var F=H+E,G=F+(B.getCookieSetting(H)||0),I=F+N;if(I!=G){document.cookie=K.replace(G,I);}}else{if(K.indexOf("bSet")>=0){document.cookie=K.replace("bSet=","bSet="+M);}else{if(J){document.cookie="bSet="+M+";"+K;}}}}catch(L){mstrmojo.alert(L);return ;}};mstrmojo.cookies.getCookieSetting=function(F){try{return B.getCookieList()[F];}catch(G){mstrmojo.alert(G);return ;}};mstrmojo.cookies.getCookieList=function(){try{if(!D()){return[];}var G=A(),F={},H=null;G=G.replace("bSet=","").split(C);for(H in G){H=G[H].split(E);F[H[0]]=H[1];}return F;}catch(I){mstrmojo.alert(I);return ;}};mstrmojo.cookies.enabledCookieOnBrowser=function(){var F=document.cookie;if(!F||!(typeof F==="string")){return false;}return true;};})();mstrmojo.LoadedExternalJSURLs={};function LoadScriptsExternalJSCallback(){mstrmojo.LoadedExternalJSURLs[mstrmojo._LoadsScript.esScripts.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(mstrmojo._LoadsScript.esScripts,mstrmojo._LoadsScript.callback,mstrmojo._LoadsScript.esScritsContext);mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=false;}mstrmojo._LoadsScript=mstrmojo.provide("mstrmojo._LoadsScript",{_meta_usesSuper:false,requiresMethod:function requiresMethod(B){if(!B){return false;}if(typeof this[B]==="function"){return true;}var A=this[B]||(this.methods&&(this.methods[B]||this.methods["*"]));if(typeof A==="string"){this.requiresCls(A);return typeof this[B]==="function";}return false;},requiresCls:function req(mixins,callback){if(mixins){if(typeof mixins==="string"){mixins=[mixins];}mstrmojo.requiresCls.apply(mstrmojo,mixins);var p=this.constructor.prototype,pm=p.mixins;if(!pm){p.mixins={};pm=p.mixins;}var mx=mstrmojo.mixin,i,len;for(i=0,len=mixins.length;i<len;i++){var fqcn=mixins[i];if(!pm[fqcn]){var m=eval(mixins[i]);mx(m,p);pm[fqcn]=true;if(m.__onmixin__){m.__onmixin__.apply(this,[]);}}}if(callback){callback.apply(this,[]);}}},requiresContrib:function reqCb(C,B){var A=this[C];if(A){var E,D=false;if(typeof A==="string"){E=mstrmojo.registry.ref(A);this[C]=E;D=true;}else{E=A;}if(E&&(D||B)){E.parent=this;if(E.startup){E.startup();}}return E;}return null;},requiresExternalScripts:function requiresExternalScripts(F,G,C){if(F&&F instanceof Array){if(F.length===0){if(G){G.call(C);}return false;}if(F[0]&&F[0].forceReload===false&&mstrmojo.LoadedExternalJSURLs[F[0].url]){F.splice(0,1);return this.requiresExternalScripts(F,G,C);}var A=document.createElement("script"),D=!!document.all,B=F[0].url;if(B.substr(0,7)==="file://"){B=B.substr(7);}else{if(mstrApp.isSingleTier&&B.substr(0,4)!=="http"){B="http:"+B;}}A.type="text/javascript";A.src=B;if(!F[0].callbackParamName){if(D){A.onreadystatechange=function(){if(A.readyState==="loaded"||A.readyState==="complete"){A.onreadystatechange=null;if(F.length>1){mstrmojo.LoadedExternalJSURLs[F.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(F,G);}else{if(F.length===1){mstrmojo.LoadedExternalJSURLs[F[0].url]=true;if(G){G.call(C);}}}}};}else{A.onload=function(){A.onload=null;if(F.length>1){mstrmojo.LoadedExternalJSURLs[F.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(F,G);}else{if(F.length===1){mstrmojo.LoadedExternalJSURLs[F[0].url]=true;if(G){G.call(C);}}}};}}else{if(F[0].callbackParamName.length!==0){if(mstrmojo._LoadsScript.ExternalJSCallbackIsBusy&&mstrmojo._LoadsScript.ExternalJSCallbackIsBusy===true){var E=this;window.setTimeout(function(){E.requiresExternalScripts(F,G,C);},500);return ;}mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=true;A.src+="&"+F[0].callbackParamName+"=LoadScriptsExternalJSCallback";mstrmojo._LoadsScript.esScripts=F;mstrmojo._LoadsScript.callback=G;mstrmojo._LoadsScript.esScritsContext=C;}}document.getElementsByTagName("head")[0].appendChild(A);}}});(function(){mstrmojo.boxmodel=mstrmojo.provide("mstrmojo.boxmodel",{rangeIntersect:function E(J,H,I,G){if(J<I){return I<=H;}if(J>I){return J<=G;}return true;},px2Inches:function C(H,G){G=parseInt(G,10);return mstrmojo.NumberFormat.getInstance(mstrConfig.decimalSep,mstrConfig.thousandsSep).format(parseFloat((G/H.zf/H.dpi).toFixed(4)));},offset:function F(I,H){var L=I,G=0,K=0;while(I){G+=I.offsetLeft;K+=I.offsetTop;I=I.offsetParent;if(I===H){break;}}var J;for(J=L&&L.parentNode;J&&J!==H;J=J.parentNode){if(J.scrollTop){K-=J.scrollTop;}if(J.scrollLeft){G-=J.scrollLeft;}}return{left:G,top:K};},convert2px:function D(K,I){if(!/px$/.test(I)){var H=document.createElement("img"),G=H.style,J;G.zIndex=-1;G.left=I;K.appendChild(H);J=G.pixelLeft;K.removeChild(H);return J+"px";}return I;},getEdgeQuadrantByPoint:function B(I,H){var G=H.x-I.x,M=H.y-I.y,J=I.w,L=I.h,K=[["Left","Bottom"],["Top","Right"]];if(M>L/J*G){K=K[0];}else{K=K[1];}return(M<-L/J*G+L)?K[0]:K[1];},isPtInPolygon:function A(I,K){var G=I.x,J=I.y,H=false;K.forEach(function(N,L){var M=K[L-1]||K[K.length-1];if((N.y>=J)!==(M.y>=J)){if((G<(M.x-N.x)*(J-N.y)/(M.y-N.y)+N.x)){H=!H;}}});return H;}});}());(function(){var A=/^mstrmojo./;mstrmojo.DynamicClassFactory={newComponent:function(C,B,F){var H=C.prototype.scriptClass.replace(A,"");for(var E=0,D=B&&B.length||0;E<D;E++){if(!B[E]._mixinName){throw new Error('Mixins must have a "_mixinName" property to be used with DynamicClassFactory');}H+="_"+B[E]._mixinName.replace(A,"");}var G=mstrmojo[H];if(!G){G=mstrmojo.declare(C,B,F);mstrmojo[H]=G;}return G;}};}());(function(){var C="xviPopopNode";function A(G){var H={};H[C]=G;return H;}mstrmojo.ui.menus._IsMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._IsMenuPopup",{init:function E(G){this._super(G);var J=this.popupConfig;if(!J){throw new Error("Cannot instantiate popup without supplying the popupConfig property.");}this.addDisposable(J);var H=mstrmojo.all[J.hostId],I=J.hostElement;if(J.isHostedWithin&&H&&I){H.addSlots(A(I));this.slot=C;}},closeAllMenus:function F(){var G=this.opener;if(G&&G.closePopup){G.closePopup();}if(G&&G.closeAllMenus){G.closeAllMenus();}},open:function B(H,G){if(this._super){this._super(H,G);}},close:function D(G){if(this.slot===C){this.opener.removeSlots(A(null));}if(this._super){this._super(G);}this.destroy();var H=mstrmojo.all[this.popupConfig.hostId];if(H){H.closePopup();}}});}());(function(){mstrmojo.vi._MonitorsAppState=mstrmojo.provide("mstrmojo.vi._MonitorsAppState",{onAppStateChange:function(B){if(this._super){this._super(B);}},init:function A(B){this._super(B);if(mstrApp.attachEventListener){mstrApp.attachEventListener("appStateChange",this.id,"onAppStateChange");}}});}());mstrmojo.architect.EnumDragActions={ADD_TABLE:"addTable",ADD_COLUMN:"addColumn",TABLE_VIEW_ATTR:"tableViewItemAttr",TABLE_VIEW_METRIC:"tableViewItemMetric",PROJECT_TABLE:"projectTable",PROJECT_TABLE_COLUMN:"projectTableColumn",LINKER_ATTR:"linkerAttr",COMPOUND_FORM:"compoundForm"};(function(){function AG(Am,An){return An||(Am||window).event;}mstrmojo.PositionType=null;var Aj=!!document.all,AE=document.documentMode,p=navigator.userAgent,i=false,g=false,e=false,d=false,R=false,r=false;if(Aj){if(window.mstrConfig&&mstrConfig.isEdgeModeEnabled){i=!!p.match(/MSIE 6/);g=((!!p.match(/MSIE 7/)&&!AE)||AE===7);e=(AE===8);d=(AE===9);R=(AE===10);r=(!AE||AE<=9);}else{i=!!p.match(/MSIE 6/);g=!!p.match(/MSIE 7/);e=!!p.match(/MSIE 8/);d=!!p.match(/MSIE 9/);R=!!p.match(/MSIE 10/);r=!R;}}var c=!Aj&&!!p.match(/Firefox/),k=0,q=!!p.match(/Android/),Aa=!!p.match(/iPad/),AK=!!p.match(/iPhone/),AS=!!document.createTouch||q,o=!!p.match(/PlayBook/),O=!!p.match(/Windows Phone/),Ak=!Aj&&!!p.match(/Trident.*rv/),b=c?"-moz-":(Aj||Ak)?"":"-webkit-",AF=c?"Moz":(R||Ak)?"":Aj?"ms":"webkit",AP=((R||Ak)?"t":"T"),AJ=AF+AP+"ransition";function Ae(){return AF+AP+"ransform";}function AC(){return AJ+"Property";}function S(){return AJ+"Duration";}function N(){return(R||c)?"transitionend":"webkitTransitionEnd";}function f(){return AF+"BoxShadow";}var Ah=Ae(),AX=AC(),x=S(),A=N(),m=f();function AO(){if(!k&&c){var Am=p.match(/.*Firefox\/([\d|\.]*).*/);if(Am){k=parseFloat(Am[1]);}}return k;}function AU(){var An=0,Ar=0,Ao=window,Ap=document,Am=Ap.body,Aq=Ap.documentElement;if(typeof Ao.pageYOffset==="number"){Ar=Ao.pageYOffset;An=Ao.pageXOffset;}else{if(Am&&(Am.scrollLeft||Am.scrollTop)){Ar=Am.scrollTop;An=Am.scrollLeft;}else{if(Aq&&(Aq.scrollLeft||Aq.scrollTop)){Ar=Aq.scrollTop;An=Aq.scrollLeft;}}}return{x:An,y:Ar};}function AD(Am){Am=Am||0;Am=String(Am);return((Am.indexOf("%",0))!==-1)?Am:(Am+"px");}function AM(Ao,As,Ar,Aq,Ap){if(!mstrmojo.dom.isWinPhone){Aq=(Aq||false||this.isHWAccelerated);}else{Aq=false;}var An=Ap+(Aq?"3d":"")+"(",Am=Aq?(","+Ar+")"):")";return An+Ao+","+As+Am;}var AY=2,V=3;function t(As,Ar,Av){var Au=As.style,Ao=Au.display,Aq=this.windowDim(),Ap=AU();Au.display="block";var At=Aq.w-As.clientWidth,Aw=Math.max(Aq.h-As.clientHeight,0),Am={4:0,5:At,3:At/2},An={1:0,3:Aw/2,2:Aw};Au.left=Am[Ar]+Ap.x+"px";Au.top=An[Av]+Ap.y+"px";Au.display=Ao;}function l(Ap,Ao,Aq,Am){if(Ap.addEventListener){return Ap.addEventListener(Ao,Aq,!!Am);}Aq._id=Aq._id||l.guid++;Ap.events=Ap.events||{};var An=Ap.events[Ao];if(!An){An=Ap.events[Ao]={};if(Ap["on"+Ao]){An[0]=Ap["on"+Ao];}}An[Aq._id]=Aq;function Ar(Au){Au=Au||window.event;var At=this.events[Au.type],As;for(As in At){At[As].call(this,Au);}}Ap["on"+Ao]=Ar;}l.guid=1;function h(Ao,An,Ap,Am){if(!Ao){return ;}if(Ao.removeEventListener){Ao.removeEventListener(An,Ap,!!Am);}else{if(Ao.events&&Ao.events[An]){delete Ao.events[An][Ap._id];}}}mstrmojo.Enum_Keys={BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46};mstrmojo.dom=mstrmojo.provide("mstrmojo.dom",{userAgent:p,isIE:Aj,isIE6:i,isIE7:g,isIE8:e,isIE9:d,isIE10:R,isIEW3C:Ak,isNSIE:r,isDXIE:r,isFF:c,isWK:!!p.match(/AppleWebKit/),isSafari:!!p.match(/Safari/)&&!p.match(/Chrome/),isChrome:!!p.match(/AppleWebKit/)&&p.match(/Chrome/),isHWAccelerated:!q,isAndroid:q,isIPad:Aa,isPlayBook:o,isWinPhone:O,isMobile:Aa||AK||O||q,supportsTouches:AS,TOUCHSTART:AS?"touchstart":"mousedown",TOUCHMOVE:AS?"touchmove":"mousemove",TOUCHEND:AS?"touchend":"mouseup",TOUCHCANCEL:AS?"touchcancel":"",RESIZE:AS?"orientationchange":"resize",CSS3_PREFIX:b,CSS3_BOXSHADOW:m,CSS3_TRANSFORM:Ah,CSS3_TRANSITION:AJ,CSS3_TRANSITION_PROPERTY:AX,CSS3_TRANSITION_DURATION:x,CSS3_TRANSITION_END:A,cssFeatures:{GRADIENTS:"gd",ROUND_CORNERS:"rc",TEXT_ROTATION:"tr",DROP_SHADOW:"sh"},htmlFeatures:{FILE_READER:"fr"},MOUSE_BUTTON:{LEFT:1,RIGHT:2},supports:function B(Am){var An=this.isFF&&AO();switch(Am){case this.cssFeatures.GRADIENTS:return(this.isIE||this.isIEW3C||this.isWK||An>=3.6||this.isWinPhone);case this.cssFeatures.ROUND_CORNERS:return(this.isWK||this.isFF||this.isWinPhone||this.isIE10);case this.cssFeatures.TEXT_ROTATION:case this.cssFeatures.DROP_SHADOW:return(this.isIE||this.isWK||An>=3.5||this.isWinPhone||this.isIE10||this.isIEW3C);case this.htmlFeatures.FILE_READER:return !!(window.FileReader);}return false;},getOSInfo:function AL(){var Ar="Unknown",An=navigator.appVersion,Aq=navigator.userAgent,Ap=Ar;var Am=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];var Ao;for(Ao=0;Ao<Am.length;Ao++){var At=Am[Ao];if(At.r.test(Aq)){Ap=At.s;break;}}var As=Ar;if(/Windows/.test(Ap)){As=/Windows (.*)/.exec(Ap)[1];Ap="Windows";}switch(Ap){case"Mac OS X":As=/Mac OS X (10[\.\_\d]+)/.exec(Aq)[1];break;case"Android":As=/Android ([\.\_\d]+)/.exec(Aq)[1];break;case"iOS":As=/OS (\d+)_(\d+)_?(\d+)?/.exec(An);As=As[1]+"."+As[2]+"."+(As[3]|0);break;}return{name:Ap,version:As};},transEndEvtNames:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},replace:function n(Ao,Am){if(Ao&&Am){var An=Ao.parentNode;if(An){An.replaceChild(Am,Ao);}}return Am;},attachEvent:function X(Ao,An,Ap,Am){if(Ao.addEventListener){return Ao.addEventListener(An,Ap,!!Am);}return Ao.attachEvent("on"+An,Ap);},detachEvent:function AW(Ao,An,Ap,Am){if(!Ao){return ;}if(Ao.removeEventListener){Ao.removeEventListener(An,Ap,!!Am);}else{Ao.detachEvent("on"+An,Ap);}},attachMarkupEvent:function v(Ap,Ao,Am){var An=function(Aq){mstrmojo.all[Ap].captureDomEvent(Am,window,Aq);};this.attachEvent(Ao,Am,An);return An;},attachOneTimeEvent:function W(Ap,An,Aq,Am){var Ao=function(Ar){Aq(Ar);if(Am){h(this,An,Ao);}else{mstrmojo.dom.detachEvent(this,An,Ao);}};if(Am){l(Ap,An,Ao);}else{this.attachEvent(Ap,An,Ao);}Ap=null;return Ao;},attachMouseMoveEvents:function D(Ap,Am){var Ao=this,An=function(Aq){if(Am){Am(Aq);}Ao.detachEvent(document,"mousemove",Ap);Ao.detachEvent(document,"mouseup",An);};Ao.attachEvent(document,"mousemove",Ap);Ao.attachEvent(document,"mouseup",An);},captureDomEvent:function AI(Ar,Ap,An,Aq,Ao){var Am=mstrmojo.all[Ar];if(Am){Am.captureDomEvent(Ap,An,Aq,Ao);}},translate:function L(Ao,An,Ar,Aq,Am,Ap){Am=(Am&&" "+Am)||"";Ao.style[((mstrmojo.dom.isWinPhone||mstrmojo.dom.isIE9||mstrmojo.dom.isIE10)?"ms":"webkit")+"Transform"]=this.createTranslateString(An,Ar,Aq,Ap)+Am;},createTranslateString:function P(Am,Ap,Ao,An){Am=AD(Am);Ap=AD(Ap);Ao=AD(Ao);return AM(Am,Ap,Ao,An,"translate");},createScaleString:function u(Am,Ap,Ao,An){Am=Am||0;Ap=Ap||0;Ao=Ao||0;return AM(Am,Ap,Ao,An,"scale");},_bufferSize:200,_bufferConnects:{},attachBufferedEvent:function C(Ao,Am,Ap,Ar){var An=Ao.id+"-"+Am,Aq=this._bufferConnects[An];if(!Aq){Aq=this._bufferConnects[An]={elId:Ao.id,eventName:Am,timer:null,bufferSize:Ar,listeners:[],callback:function(As){mstrmojo.dom._callback(As,mstrmojo.global,An);return true;}};this.attachEvent(Ao,Am,Aq.callback);}Aq.listeners.push(Ap);},_callback:function Ad(Aq,Am,Ao){var Ap=this._bufferConnects[Ao],Ar=Ap&&Ap.timer;if(Ap&&!Ar){var An=(Ap.bufferSize===null)?this._bufferSize:Ap.bufferSize;if(Ap.bufferSize){Ap.timer=Am.setTimeout(function(){mstrmojo.dom.updateBuffers(Ao);},An);}else{mstrmojo.dom.updateBuffers(Ao);}}},updateBuffers:function H(Ap){var Aq=this._bufferConnects[Ap],An=Aq&&Aq.listeners,Am=(An&&An.length)||0,Ao;for(Ao=0;Ao<Am;Ao++){An[Ao]();}if(Aq&&Aq.timer){delete Aq.timer;}},detachBufferedEvent:function AA(An,Ar,As){if(!An){return ;}var Au=An.id+"-"+Ar,Ao=this._bufferConnects[Au],Aq=Ao&&Ao.listeners,At=(Aq&&Aq.length)||0,Ap;if(At){for(Ap=At-1;Ap>-1;Ap--){if(Aq[Ap]===As){Aq.splice(Ap,1);}}if(!Aq.length){this.detachEvent(An,Ar,Ao.callback);delete this._bufferConnects[Au];if(Ao.timer){var Am=mstrmojo.global;Am.clearTimeout(Ao.timer);}}}},eventTarget:function y(Am,An){An=AG(Am,An);return An.target||An.srcElement;},isMac:function w(){return this.getOSInfo().name.toLowerCase().indexOf("mac")>=0;},isMetaKey:function J(Am,Ap){var Ao=this.getOSInfo().name.toLowerCase().indexOf("mac")>=0,An=AG(Am,Ap)||{};return(An.ctrlKey&&!Ao)||(An.metaKey&&Ao);},ctrlKey:function Ag(Am,An){return(AG(Am,An)||{}).ctrlKey;},shiftKey:function z(Am,An){return(AG(Am,An)||{}).shiftKey;},metaKey:function Z(Am,An){return(AG(Am,An)||{}).metaKey;},getButton:function AQ(Am,An){return((Number(AG(Am,An).button))===2)?2:1;},isPrimaryMouseBtn:function Ab(An,Am){return this.getButton(Am||window,An)===1;},getMousePosition:function j(Ap,Ao){Ao=Ao||window;var An,As;if(mstrmojo.dom.isIE){Ap=Ap||Ao.event;var Aq=document,Am=Aq.body,Ar=Aq.documentElement;An=Ap.clientX+Am.scrollLeft+(Ar.scrollLeft||0);As=Ap.clientY+Am.scrollTop+(Ar.scrollTop||0);}else{An=Ap.pageX;As=Ap.pageY;}return{x:An,y:As};},position:function AR(An,Ao){var Ar={x:0,y:0,w:0,h:0};if(An&&An.getBoundingClientRect){try{Ar=An.getBoundingClientRect();}catch(Aq){Ar={left:0,top:0,right:0,bottom:0,height:0,width:0};}Ar={x:Ar.left,y:Ar.top,w:Ar.right-Ar.left,h:Ar.bottom-Ar.top};if(this.isIE6||this.isIE7){var Am=An.ownerDocument;if(Am){var At=Am.documentElement,As=At.getBoundingClientRect();Ar.x-=As.left;Ar.y-=As.top;}}}if(Ao){var Ap=AU();Ar.x+=Ap.x;Ar.y+=Ap.y;}return Ar;},delta:function F(Ao,Am){Am=Am||document.body;var An=this.position(Ao),Ap=this.position(Am);return{x:Math.round(An.x-Ap.x),y:Math.round(An.y-Ap.y)};},windowDim:function Q(){var Am=0,Ao=0,Ap=window,Aq=document,Ar=Aq.documentElement,An=Aq.body;if(typeof (Ap.innerWidth)=="number"&&typeof (Ap.innerHeight)=="number"){Am=Ap.innerWidth;Ao=Ap.innerHeight;}else{if(Ar&&(Ar.clientWidth||Ar.clientHeight)){Am=Ar.clientWidth;Ao=Ar.clientHeight;}else{if(An&&(An.clientWidth||An.clientHeight)){Am=An.clientWidth;Ao=An.clientHeight;}}}return{w:Am,h:Ao};},center:function AH(Am){t.call(this,Am,V,V);},bottomCenter:function E(Am){t.call(this,Am,V,AY);},clearBrowserHighlights:function K(Am){Am=Am||self;if(!Am.getSelection){var As=Am.document,Ar=As&&As.selection,Ap=Ar&&Ar.empty;if(Ap){try{Ar.empty();}catch(Ao){}}}else{var An=Am.getSelection,Aq=An&&Am.getSelection();if(Aq&&!Aq.isCollapsed){if(Aq.empty){Aq.empty();}else{if(Aq.removeAllRanges){Aq.removeAllRanges();}}}}},findAncestorByAttr:function AN(Aq,Ao,An,Am){var Ar=An?Aq:Aq&&Aq.parentNode;while(Ar&&(Ar!==Am)){var Ap=Ar.getAttribute&&Ar.getAttribute(Ao);if(Ap!=null){return{node:Ar,value:Ap};}Ar=Ar.parentNode;}return null;},findAncestorByName:function Af(Ao,Ar,An,Am){Ar=Ar&&Ar.toLowerCase();var Ap=An?Ao:Ao&&Ao.parentNode;while(Ap&&(Ap!==Am)){var Aq=Ap.nodeName;if(Aq&&(Aq.toLowerCase()===Ar)){return Ap;}Ap=Ap.parentNode;}return null;},contains:function I(Ap,Aq,An,Am){var Ao=Aq;if(!An){Ao=Ao.parentNode;}while(Ao){if(Ao===Ap){return true;}if(Ao===Am){break;}Ao=Ao.parentNode;}return false;},toggleSelection:function Al(An,Am){An.setAttribute("unselectable",Am?"off":"on");mstrmojo.css.toggleClass(An,"unselectable",!Am);An.onselectstart=function(){return Am;};if(!Am){this.clearBrowserHighlights();}},preventDefault:function U(Am,An){An=An||Am.event;if(An.preventDefault){An.preventDefault();}else{An.returnValue=false;}},stopPropogation:function M(Am,An){An=An||Am.event;if(An.stopPropagation){An.stopPropagation();}else{An.cancelBubble=true;}},firstTouch:function AT(Am,An){return An&&An.touches&&An.touches.length?An.touches[0]:(An||Am.event);},firstChangedTouch:function AZ(Am,An){return An&&An.changedTouches&&An.changedTouches.length?An.changedTouches[0]:(An||Am.event);},isLandscape:function T(){return !this.supportsTouches||(Math.abs(window.orientation)===90);},findWidget:function AV(Am){while(Am){var An=Am.mstrmojoId;if(An!==null&&An!==undefined){return mstrmojo.all[An];}Am=Am.parentNode;}return null;},setCaret:function G(Am,Ao){if(Am.setSelectionRange){Am.focus();Am.setSelectionRange(Ao,Ao);}else{if(Am.createTextRange){var An=Am.createTextRange();An.move("character",Ao);An.select();}}},setInputSelection:function Y(Am){if(Am.select){Am.focus();Am.select();}else{if(Am.createTextRange){Am.createTextRange().select();}}},setElementSelection:function a(Ao){if(window.getSelection){var Am=document.createRange(),An=window.getSelection();Am.selectNodeContents(Ao);An.removeAllRanges();An.addRange(Am);}else{if(document.body.createTextRange){var Ap=document.body.createTextRange();Ap.moveToElementText(Ao);Ap.select();}}},getHorizontalScroll:function Ai(){return AU().x;},getVerticalScroll:function AB(){return AU().y;},removeNode:function Ac(Ao){var An=document.getElementById(Ao),Am=An&&An.parentNode;if(Am){return Am.removeChild(An);}}});}());mstrmojo.architect.EnumBaseFormTypes={DateTime:1,Number:2,Text:3,URL:5,Email:6,HTMLTag:7,Date:8,Time:9,Symbol:10,BigDecimal:11,PhoneNumber:12};mstrmojo.mstr.EnumFunction={FunctionCustom:-1,FunctionReserved:0,FunctionPlus:1,FunctionMinus:2,FunctionTimes:3,FunctionDivide:4,FunctionUnaryMinus:5,FunctionEquals:6,FunctionNotEqual:7,FunctionGreater:8,FunctionLess:9,FunctionGreaterEqual:10,FunctionLessEqual:11,FunctionSum:12,FunctionCount:13,FunctionAvg:14,FunctionMin:15,FunctionMax:16,FunctionBetween:17,FunctionLike:18,FunctionAnd:19,FunctionOr:20,FunctionNot:21,FunctionIn:22,FunctionRank:23,FunctionAbs:24,FunctionRunningSum:25,FunctionRunningAvg:26,FunctionMovingSum:28,FunctionMovingAvg:27,FunctionProduct:29,FunctionMedian:30,FunctionMode:31,FunctionStdev:32,FunctionVar:33,FunctionGeomean:34,FunctionEqualEnhanced:35,FunctionNotEqualEnhanced:36,FunctionGreaterEqualEnhanced:37,FunctionLessEqualEnhanced:38,FunctionBetweenEnhanced:39,FunctionBanding:40,FunctionBandingC:41,FunctionBandingP:42,FunctionNotLike:43,FunctionNotBetween:44,FunctionIntersect:45,FunctionIntersectIn:46,FunctionNullToZero:47,FunctionZeroToNull:48,FunctionApplySimple:49,FunctionApplyAggregation:50,FunctionApplyLogic:51,FunctionApplyComparison:52,FunctionApplyRelative:53,FunctionIsNull:54,FunctionIsNotNull:55,FunctionUcase:56,FunctionNotIn:57,FunctionNTile:58,FunctionPercentile:59,FunctionMovingMax:60,FunctionMovingMin:61,FunctionMovingDifference:62,FunctionMovingStdev:63,FunctionExpWghMovingAvg:64,FunctionMovingCount:65,FunctionRunningMax:66,FunctionRunningMin:67,FunctionRunningStdev:68,FunctionRunningCount:69,FunctionExpWghRunningAvg:70,FunctionNotBetweenEnhanced:71,FunctionConcat:72,FunctionFirstInRange:73,FunctionLastInRange:74,FunctionValueSegment:75,FunctionContains:76,FunctionBeginsWith:77,FunctionEndsWith:78,FunctionNotContains:79,FunctionNotBeginsWith:80,FunctionNotEndsWith:81,FunctionCase:82,FunctionCaseV:83,FunctionStdevP:84,FunctionRunningStdevP:85,FunctionMovingStdevP:86,FunctionNTileS:87,FunctionNTileVS:88,FunctionVarP:89,FunctionCurrentDate:90,FunctionDayOfMonth:91,FunctionDayOfWeek:92,FunctionDayOfYear:93,FunctionWeek:94,FunctionMonth:95,FunctionQuarter:96,FunctionYear:97,FunctionCurrentDateTime:98,FunctionCurrentTime:99,FunctionHour:100,FunctionMinute:101,FunctionSecond:102,FunctionMilliSecond:103,FunctionConcatNoBlank:104,FunctionLength:105,FunctionLower:106,FunctionLTrim:107,FunctionPosition:108,FunctionRTrim:109,FunctionSubStr:110,FunctionInitCap:111,FunctionTrim:112,FunctionRightStr:113,FunctionLeftStr:114,FunctionGreatest:115,FunctionLeast:116,FunctionFirst:117,FunctionLast:118,FunctionAdd:134,FunctionAverage:135,FunctionMultiply:136,FunctionBandingM:137,FunctionOLAPSum:138,FunctionOLAPAvg:139,FunctionOLAPCount:140,FunctionOLAPMax:141,FunctionOLAPMin:142,FunctionLag:143,FunctionLead:144,FunctionPercentRank:166,FunctionTuple:1000};(function(){function Q(U,R,S){if(U.nodeType===3&&R){return U;}else{var T=(R&&U.nodeType===1&&U.lastChild)?U.lastChild:F(U,S);return T?D(T,S):null;}}function F(S,R){return(S===R)?null:(S.previousSibling||F(S.parentNode,R));}function D(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.lastChild){return D(S.lastChild);}else{return D(F(S,R));}}}function I(R){return R.textContent||R.nodeValue||R.innerText;}function M(U,R,S){if(U.nodeType===3&&R){return U;}else{var T=(R&&U.nodeType===1&&U.firstChild)?U.firstChild:B(U,S);return T?E(T,S):null;}}function B(S,R){return(S===R)?null:(S.nextSibling||B(S.parentNode,R));}function E(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.firstChild){return E(S.firstChild);}else{return E(B(S,R));}}}mstrmojo.range=mstrmojo.provide("mstrmojo.range",{EDGE:{EDGE_BEGIN:1,EDGE_END:2,EDGE_MIDDLE:-1},getEdgeInfo:function P(T,U){var R=0,S;if(T.nodeType===1){if(window.getSelection){S=document.createRange();S.selectNode(T);R=S.toString().length;}else{S=document.body.createTextRange();S.moveToElementText(T);R=S.text.length;}}else{R=I(T).length;}return U===R?this.EDGE.EDGE_END:(U===0?this.EDGE.EDGE_BEGIN:this.EDGE.EDGE_MIDDLE);},collapseOnNode:function K(U,S){if(!U.offsetParent){return ;}var T=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(U);R.collapse(S);T.removeAllRanges();T.addRange(R);}else{R.moveToElementText(U);R.collapse(S);R.select();}},collapseOnTextNode:function L(U,V){var T=this.getSelection(),S=this.getRange();if(window.getSelection){var R=M(U,true);S.setStart(R,V);S.collapse(true);T.removeAllRanges();T.addRange(S);}else{S.moveToElementText(U);S.collapse(true);S.move("character",V);S.select();}},collapseOnTextNodeIE:function C(S,T){var U=M(S,true),R;while(U!==null){R=I(U).length;if(R>=T){this.collapseOnTextNode(U,T);break;}else{T-=R;U=M(U,false);}}},getRangeInfo:function J(X,e){var Z=null,j,c=this.getRange(),b;if(X&&X===c.startContainer){var g=c.startContainer.firstChild,U=g&&g.firstChild,d=U&&U.firstChild;if(d){c.setStart(d,c.startOffset);c.setEnd(d,c.endOffset);}}if(window.getSelection){var W=function(l,n,m){var k=l.cloneRange();k.collapse(m);k.setStartBefore(n);return k.toString().length;},S=c.startContainer,f=c.startOffset;if(S.nodeType===1){f=W(c,S,true);}Z={collapsed:c.collapsed,startContainer:S,startOffset:e?e.startOffset:f};if(!c.collapsed){var V=c.endContainer,R=c.endOffset;if(V.nodeType===1){R=W(c,V,false);}Z.endContainer=V;Z.endOffset=R;}Z.range=c;}else{var i,a,Y=function(n,o){var m=n.duplicate(),k=document.body.createTextRange(),l;m.collapse(o);l=m.parentElement();k.moveToElementText(l);k.setEndPoint("EndToStart",m);return{container:l,offset:k.text.length};},h=Y(c,true),T;Z={collapsed:(c.compareEndPoints("StartToEnd",c)===0),startContainer:h.container,startOffset:h.offset};if(!Z.collapsed){T=Y(c,false);Z.endContainer=T.container;Z.endOffset=T.offset;}}return Z;},collapse:function O(S){if(window.getSelection){var T=this.getSelection();if(S){T.collapseToStart();}else{T.collapseToEnd();}}else{var R=this.getRange();R.collapse(S);R.select();}},selectSingleNode:function H(T){var S=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(T);S.removeAllRanges();S.addRange(R);}else{R.moveToElementText(T);R.select();}},selectMultipleNodes:function N(W,S,X,U){var V=this.getSelection(),T=this.getRange();if(window.getSelection){T.setStart(W,S);T.setEnd(X,U);V.removeAllRanges();V.addRange(T);}else{W=(W.nodeType===3)?W.parentNode:W;T.moveToElementText(W);T.move("character",S);X=(X.nodeType===3)?X.parentNode:X;var R=document.body.createTextRange();R.moveToElementText(X);R.move("character",U);T.setEndPoint("EndToStart",R);T.select();}},getSelection:function G(){if(window.getSelection){return window.getSelection();}else{return document.selection;}},getRange:function A(){if(window.getSelection){selection=window.getSelection();if(selection.rangeCount>0){return selection.getRangeAt(0);}else{return document.createRange();}}else{return document.selection.createRange();}}});}());mstrmojo.EnumAuthenticationModes={DEFAULT:0,STANDARD:1,NTCREDENTIAL:2,PASSTHRU:4,ANONYMOUS:8,LDAP:16,DATABASE:32,PLUGIN:64,INTEGRATED:128,USHER:256};mstrmojo.vi.models.EnumDragSources={DATASETS:1,VIZ_EDITOR:2,FILTERS:3,ALL_OBJECT_LIST:4,VIZ:5};(function(){mstrmojo.warehouse._CanToggleAvatarClass=mstrmojo.provide("mstrmojo.warehouse._CanToggleAvatarClass",{_mixinName:"mstrmojo.warehouse._CanToggleAvatarClass",getAvatarIconClass:function C(D){return"enabled";},ondragenter:function A(D){var E=D.src.widget;if(E&&E.toggleAvatarClass&&this.allowDrop(D)){E.toggleAvatarClass(this.getAvatarIconClass(D),true);}if(this._super){this._super(D);}},ondragleave:function B(D){var E=D.src.widget;if(E&&E.toggleAvatarClass&&this.allowDrop(D)){E.toggleAvatarClass(this.getAvatarIconClass(D),false);}if(this._super){this._super(D);}}});}());mstrmojo.warehouse.EnumObjectTypes={FILTER:1,METRIC:4,ATTRIBUTE:12,FACT:13,DIMENSION:14,TABLE:15,TABLE_LOGICAL_VIEW:151,TABLE_PARTITION:152,FORM:21,COLUMN:26,DBROLE:29,PROJECT:32,TRANSFORMATION:43,DBTABLE:53,LAYER:70,RELATIONSHIP:99,COMPOUND_FORM:1001,RELATIONSHIP_ATTRIBUTE:1002};(function(){mstrmojo.DI.DIConstants=mstrmojo.provide("mstrmojo.DI.DIConstants",{invalidObjectNameChars:'\\"[]',invalidObjectNameCharsRegex:/[\\"\[\]]/,sourceItemLinkType:{dbList:0,oauthPara:1},setDefaultOAuthParamCMD:"MSTR_DEFAULT_OAUTH_PARAMS",actions:{none:0,importSource:1,editImport:2,transform:3,changeSheet:4,publish:5,changeMappings:6,refine:7,quickPreview:8,savePublish:9,getFlatPreview:10,refreshData:11},requestFlag:{mapping:1,preview:2,sourceInfo:4,refineSourceInfo:8,sheets:16,crb:32,transformations:64,transformedPreview:128,relationship:256,stateInfo:512,anyState:268435456,fullData:1024,refineInnerData:2048},formMappingFlag:{formMappingFlagReserved:0,formMappingFlagRemoveGeoRole:1,formMappingFlagRemoveTimeRole:2,formMappingFlagRemoveDeriveFlags:4},browseFlag:{reportBindingTable:1,dataPreview:4,publish:16,cubeConfig:68,reportLevelProperty:256},importBehaviorFlag:{reserved:0,newColumnsSilent:1,dataTypeSilent:2},saveAsFlags:{saveAsOverWrite:32,saveAsManaged:524288,saveAsDDA:33554432,saveAsInMemory:67108864,saveAsWithPrompts:4096,saveAsWithAnswers:4},connectLiveSupport:{connectLiveSupportUnknown:0,connectLiveSupportDDAOrInMemory:1,connectLiveSupportInMemoryOnly:2,connectLiveSupportDDAOnly:3},xdaType:{excel:272,text:288,refine:384,salesforce:337,querybuilder:352,ffsql:304,mdx:2,googleAnalytics:390,googleBigQuery:341,googleBigQueryFFSQL:342,googleBigQuerySingleTable:345,qbSingleTable:368,twitter:343,facebook:344,dataImport:256,projectsImport:400,dataImportFileExcel:16|256,dataImportFileText:32|256,dataImportCustomSQL:48|256,dataImportTable:64|256,dataImportOAuth:80|256,dataImportBISource:144|256,dataImportOAuthSalesforce:1|336,dataImportOAuthGDocs:2|336,dataImportOAuthGDrive:2|336,dataImportOAuthDropbox:3|336,dataImportOAuthGAnalytics:4|336,dataImportOAuthGBigQuery:5|336,dataImportOAuthGBigQueryFFSQL:6|336,dataImportOAuthGBigQuerySingleTable:9|336},sourceInfoDesc:{json:"DB_FILE_TYPE_JSON"},sourceType:{file:1,salesforce:2,dropbox:3,googleDrive:4,googleAnalytics:5,googleBigQuery:6,querybuilder:7,mstrFile:8,mdx:9,hadoop:10,twitter:11,facebook:12,bisource:13,remoteProject:14},sourceSubtype:{localFile:1,url:2,salesforce:3,dropbox:4,googleDrive:5,googleAnalytics:6,googleBigQuery:7,querybuilder:8,samplefile:9,clipboard:10,googleBigQueryFFSQL:11,searchOnSource:12,mdx:13,hadoop:14,twitter:15,facebook:16,bisource:17,remoteProject:18,googleBigQuerySingleTable:19,hanaSingleTable:20,publicData:21},backendSourceSubtype:{localFile:65537,url:65539,samplefile:65540,clipboard:65538,hadoopFileBrowser:65541,customSQL:131073,customSQLWizard:131074,singleTable:131075,bISources:131076,searchAsASource:131078,salesforce:196609,dropbox:196610,facebook:196611,twitter:196612,googleDrive:196613,googleAnalytics:196614,googleBigQuery:196615,googleBigQueryFFSQLModel:196616,googleBigQuerySingleTable:196617,OLAPSources:327681,publicData:65542},sourceItemType:{file:0,url:1,database:2,hadoop:3,olap:4,publicData:5,salesforce:6,googleAnalytics:7,googleBigQuery:8,googleDrive:9,dropbox:10,searchAsASource:11,clipboard:12,bISources:13,facebook:14,twitter:15,samplefile:16,unknow:-1},columnState:{reserved:0,unchanged:1,newColumn:2,missing:4,changed:8},operationMode:{create:0,edit:1,refresh:2,subscribe:3,enterCredentials:4,oauth:5},statusCode:{obtainSource:-2147071874,xformsError:-2147071872,mappingError:-2147071871,edit:1,republish:2,schedule:3,enterCredentials:4},pageType:{intro:0,file:1,database:2,emmaPreview:3,redirect:4,analytics:5,dataSelection:6,suggestNewSource:7,sourceIntro:8,sourceObjects:10,sampleFiles:11,dataset:12,externalPage:13,preview:14,clipboard:15,refine:16,parse:17,mstrFile:18,allProjectSource:19,hadoop:20,twitter:21,facebook:22,sourceObjectsDnD:23,schedule:24,publicData:25,republish:26,sourceAdmin:27},backendError:{overwriteObject:-2147212339,noPermission:-2147214579,invalidObjectName:-2147213715,unexpectedDataType:-2147212539,noExternalSession:-2147071844,noPrivilege:-2147212082,salesforceUnsavedReport:-2147212081,salesforceObsoleteReport:-2147212080,maxSizeExceeded:-2147212076,maxSizeExceededURL:-2147212121,salesforceUnresolvedFilter:-2147212074,incrementalRefresh:-2147212287,invalidUrl:-2147212062,fileVersionError:-2147212064,emptySheet:-2147212144,refreshTokenUnavailable:-2147202875,cubeQuotaExceeded:-2147071825,notEnoughSpace:-2147071811,importedURLInvalid:-2147212122,unsupportedFileFormat:-2147212063,objectNameTooLong:-2147217407,noExternalSourceInfo:-2147215346,memoryConsumptionExceeded:-2147215346,cubeQuotaReached:-2147071870,switchingFileType:-2147212140,memoryGovernSizeExceeded:-2147181051,stringTooLong:-2147213718,missingColumn:-2147071871,dataDiscoveryError:-2147211998,refineApplyError:-2147202299,serverOutOfMemory:-2147212055,columnCountMatchError:-2147467259,incompatibleDataTypeError:-2147211983,reportTimeout:-2147212335,requestTimeout:-2147206497,databaseCredentialsNotAvailable:-2147212037},transformation:{xtab:1,delimiter:2},application:{platform:"Platform",cloudPersonal:"Personal",cloudProfessional:"Professional"},refreshOptions:{replace:1,append:2,update:4},cubeRefreshType:{dummy:-1,reserved:0,add:1,remove:2,update:3,upsert:4,addNewTable:5,deleteTable:6,replaceTable:7,preserve:8},tableStatsExecutionAction:{reserved:0,forceExecution:1,ignore:4,requireFreshData:268435456},sourcesInfoFlags:{none:0,getReports:1,getUserName:2,getTokensInfo:4,revokeSession:8,getGAnalyticsAccount:64},queryBuilderType:{individualTable:1,multipleTables:2,queryScript:3},relationshipEditType:{create:1,changeERType:2,remove:3,flip:8001},ERType:{reserved:0,ERType11:1,ERType1M:2,ERTypeM1:3,ERTypeMM:4,ERTypeParallel:5,ERTypePerpendicular:6},RSType:{reserved:0,auto:1,geo:2,defined:3},tableStates:{newly:1,old:2},behaviorChangeFlag:{multiSheet:4,remapping:8,refreshData:16},menuItems:{SEPARATOR:-1,NONE:0,TABLE_RENAME:1,DO_NOT_IMPORT:2,FLIP_ORDER:3,DELETE:4,RELATIONSHIP_TYPE:5,ONE_TO_ONE:6,ONE_TO_MANY:7,MANY_TO_ONE:8,MANY_TO_MANY:9,REMOVE:10,REFRESH_DATA:11,REFINE:12,CANCEL_REFINE:13,UNLINK:14,CHANGE_DATA_TYPE:15,MARK_GEO_ROLES:16,CREATE_TIME_ATTRIBUTES:17,TO_METRIC:18,TO_ATTRIBUTE:19,MAP_TO_PROJECT_ATTRIBUTE:20,UNMAP:21,MODIFY_ATTRIBUTE_GROUP:22,CREATE_ATTRIBUTE_GROUP:23,HIDE_ALL_ATTRIBUTE_FORMS:24,DEFINE_RELATIONSHIPS:25,LINK:26,ITEM_RENAME:27,CREATE_MULTIFORM_ATTRIBUTE:28,EDIT_MULTIFORM_ATTRIBUTE:29,ADDTO_MULTIFORM_ATTRIBUTE:30,SHOW_ALL_ATTRIBUTE_FORMS:31,SHOW_ALL_COLUMNS:32,PARTITION:33,REFINE_RENAME:34,REFINE_DELETE:35,REFINE_DELETE_ALL:36,REFINE_RESET:37,REFINE_RESET_ALL:38,PARSE:39,IMPORT:40,UNLINK_ALL:41},dataTypeMenuItems:{DATE_TIME:"1",NUMBER:"2",TEXT:"3",URL:"5",EMAIL:"6",HTML_TAG:"7",DATE:"8",TIME:"9",SYMBOL:"10",BIG_DECIMAL:"11",PHONE_NUMBER:"12"},columnDataTypes:{reserved:0,integer:1,unsigned:2,numeric:3,decimal:4,real:5,dtdouble:6,dtfloat:7,dtchar:8,varChar:9,longVarChar:10,binary:11,varBin:12,longVarBin:13,date:14,dttime:15,timeStamp:16,nChar:17,nVarChar:18,nlong:22,bigDecimal:30,cellFormatData:31,utf8Char:33,int64:34},formsOptions:{CREATE_MULTIFORM_ATTRIBUTE:1,EDIT_MULTIFORM_ATTRIBUTE:2,ADDTO_MULTIFORM_ATTRIBUTE:3},timeRoles:{NONE:0,DATE:1,DATE_TIME:2,TIME:3,SECOND:4,MINUTE:5,HOUR:6,DAY:7,WEEK:8,MONTH:9,QUARTER:10,YEAR:11},contextMenuType:{ITEM_MENU:0,TABLE_MENU:1,PREVIEW_ITEM_MENU:2,LINK_MENU:3},dialogType:{fixRefreshErrorDialog:1,allObjectsViewDialog:2,missingColumnsDialog:3,diPageDialog:4,refreshHistoryDialog:5,alternateSourceValidateDialog:6,ddaConfirmDialog:7,publishStatusDialog:8,saveAsDialog:9,cubesList:10,refinePage:11,multiFormEditor:12,sheetsSelectionDialog:13,partitionGroupDialog:14,parseDataDialog:15,errorDialog:16,warningDialog:17,relationDefineDialog:18,qbImportOptionDialog:19,previewRenameDialog:20,mapProjectsAttributeDialog:21,setOAuthParaDialog:22,objectPicker:23,refineClusteringPage:24,refineExtractDialog:25,refineImportDialog:26,twitterAdvOptDialog:27,credentialsDialog:28,mapProjectsAttributeDialog2:29,setWhiteListDialog:30},dataEvents:{DATA_PREVIEW_EVENT:"dataReturned",NO_DATA_RETURNED_EVENT:"noDataReturned"},cubeSchedStatus:{unexecuted:1,successful:2,unscheduled:3,failed:4},privilegeType:{accessDatabase:1,accessFile:2,accessCloud:3},dbType:{MS_ACCESS:100,ORACLE:200,SQL_SERVER:300,INFORMIX:400,SYBASE:500,REDBRICK:600,DB2:700,TANDEM:800,TERADATA:900,UNKNOWN:1000,GENERIC:1100,SAP:1200,NETEZZA:1300,EXCEL:1400,MSFT_AS:1500,ESSBASE:1600,MYSQL:1700,POSTGRESQL:1800,HPNEOVIEW:1900,METAMATRIX:2000,DATALLEGRO:2100,COMPOSITE:2200,ASTER:2300,VERTICA:2400,OPENACCESS:2500,SYBASE_SQL_ANY:2600,SYBASE_IQ:2700,PARACCEL:2800,TM1:2900,XQUERY:3000,HIVE:3100,SAND:3200,SALESFORCE:3300,HIVETHRIFT:3400,VECTORWISE:3500,ENTERPRISEDB:3600,KOGNITIOWX2:3700,EXASOLUTION:3800,INFORMATICA:3900,SAPHANA:4000,IMPALA:4100,AMAZON_REDSHIFT:4200,DENODO:4300,GOOGLE_DRIVE:4400,DROPBOX:4500,GOOGLE_ANALYTICS:4600,GOOGLE_BIGQUERY:4700,CONNECTION_CLOUD:4800,GOOGLE_BIG_QUERY_FFSQL_MODEL:4900,PARSTREAM:5100,MONGODB:5200,MARKLOGIC:5300,BIG_DATA_ENGINE:5400,SEARCH_ENGINE_SOLR:5500,SPLUNK:5600,TWITTER:5700,FACEBOOK:5800,PIG:6400},getCubeQuotaAndInfosOptions:{GetCubeQuotaAndInfosReserved:0,GetCubeQuotaAndInfosDefault:1,GetCubeQuotaAndInfosQuotaOnly:2,GetCubeQuotaAndInfosAll:3,GetCubeQuotaAndInfosVI:4},homepageViewMode:{GRID_VIEW:0,LIST_VIEW:1},datasetServeMode:{inMemory:1,dda:2,unknow:3},cubePollStatus:{msgID:0,result:1,prompt:2,error:3,xmlResult:21},ibmDb2Versions:[17,18,21,22,23,24,25,37,45,46,47,48,63,66,74,89,92,101,103,105,123,134,157,172,202,232],hadoopDbTypes:[3100,1100,700,4100,7300,6800,6400]});}());mstrmojo.architect.menu.EnumMenuActions={NONE:0,DELETE:1,RENAME:2,AUTOMAP:3,UPSTRUCT:4,ADD_ATTRIBUTE:5,ADD_FACT:6,CREATE_ALIAS:7,SET_AS_PRIMARY:8,IS_PRIMARY:9,SAMPLE_DATA:10,CONVERT_ATTR_TO_FACT:11,CONVERT_ATTR_TO_FORM:12,CONVERT_FACT_TO_ATTR:13,REMOVE_FROM_TABLE:14,SET_AS_LOOKUP:15,SET_AS_FORM:16,NEW_FACT:17,NEW_ATTR:18,UPDATE_FORMAT:19,EDIT:20,MAPPING:21,AGGREGATION:22,DATA_TYPE:23,UPDATE_AGGR:24,DATA_SOURCES:25,REMOVE_TABLE:26,REMOVE_ATTR_FROM_RELATIONSHIP:27,ONE_TO_ONE:28,ONE_TO_MANY:29,MANY_TO_MANY:30,DELETE_RELATIONSHIP:31,RELATIONSHIP_TABLE:32,RELATIONSHIP_TABLE_ENTRY:33,SHOW_UNUSED_COLUMNS:34,ADD_TO_LAYER:35,REMOVE_FROM_LAYER:36,COLUMN_DEF:37,LINKS:38,CONVERT_COLUMN_TO_FORM:39,ADD_TO_PROJECT:40,LOGICAL_TABLE_SIZE:41,SET_AS_MULTILINGUAL:42,FORM_CATEGORY:43,UPDATE_CATEGORY:44,UNGROUP_FORMS:45,GROUP_FORM:46,UNGROUP_FORM:47,UPDATE_GROUP:48,DUPLICATE:49,TX_ONE_TO_ONE:50,TX_MANY_TO_MANY:51,TX_APPLY_TO_ALL:52,TX_APPLY_TO_HIGHEST:53,SET_ENTRY_POINT:54,REMOVE_ENTRY_POINT:55,REL_ATTR_ELEMENT_DISPLAY:56,ATTRIBUTE_FILTERS:57,BROWSE_ATTRIBUTES:58,REL_ATTR_ELEMENT_LIMIT:59,REL_ATTR_ELEMENT_LOCK:60,REL_ATTR_ELEMENT_UNLOCK:61,ADD_JOIN_CHILDREN:62,USE_AS_DRILL:63,USE_AS_BROWSE:64,CATALOG_SQL:65};(function(){mstrmojo._HasPopup=mstrmojo.provide("mstrmojo._HasPopup",{_mixinName:"mstrmojo._HasPopup",_lastOpened:null,openPopup:function A(G,E){var C=!!G&&(typeof G==="string")&&!G.match(/\./)&&!!this[G],D=mstrmojo.registry.ref(C?this[G]:G);if(D&&D.open){if(C){this[G]=D;}if(D.disposable!==false){this.addDisposable(D);}var J=D.slot&&this[D.slot];if(J){if(D.parent!==this){if(this.addChildren){this.addChildren([D]);}else{var I=false,F=D.domNode||D.placeholder;if(F&&typeof F==="string"){F=document.getElementById(F);}if(!F){I=true;F=document.createElement("span");D.placeholder=F;}if(I||(F.parentNode!==J)){J.appendChild(F);}}}}try{D.open(this,E);}catch(H){console.log("Error opening popup: "+H);}this._lastOpened=D;}},closePopup:function B(){var C=this._lastOpened;if(C&&C.visible&&C.close){C.close();delete this._lastOpened;}}});}());mstrmojo.architect.ui.EnumViewTypes={LAYER:0,SYS_HIERARCHY:1,USER_HIERARCHY:2,TRANSFORMATION:3,LOGICAL_VIEWS:4};mstrmojo.chart.model.enums.EnumDSSObjectType={DssTypeUnknown:-1,DssTypeReserved:0,DssTypeGeneric:5,DssTypeFormatBAD:46,DssTypeFilter:1,DssTypeTemplate:2,DssTypeReportDefinition:3,DssTypeMetric:4,DssTypeStyle:6,DssTypeAggMetric:7,DssTypeFolder:8,DssTypeDevice:9,DssTypePrompt:10,DssTypeFunction:11,DssTypeAttribute:12,DssTypeFact:13,DssTypeDimension:14,DssTypeTable:15,DssTypeDatamartReport:16,DssTypeFactGroup:17,DssTypeShortcut:18,DssTypeResolution:19,DssTypeMonitor:20,DssTypeAttributeForm:21,DssTypeSchema:22,DssTypeFormat:23,DssTypeCatalog:24,DssTypeCatalogDefn:25,DssTypeColumn:26,DssTypePropertyGroup:27,DssTypePropertySet:28,DssTypeDBRole:29,DssTypeDBLogin:30,DssTypeDBConnection:31,DssTypeProject:32,DssTypeServerDef:33,DssTypeUser:34,DssTypeTransmitter:35,DssTypeConfiguration:36,DssTypeRequest:37,DssTypeScript:38,DssTypeSearch:39,DssTypeSearchFolder:40,DssTypeDatamart:41,DssTypeFunctionPackageDefinition:42,DssTypeRole:43,DssTypeSecurityRole:44,DssTypeLocale:45,DssTypeConsolidation:47,DssTypeConsolidationElement:48,DssTypeScheduleEvent:49,DssTypeScheduleObject:50,DssTypeScheduleTrigger:51,DssTypeLink:52,DssTypeDbTable:53,DssTypeTableSource:54,DssTypeDocumentDefinition:55,DssTypeDrillMap:56,DssTypeDBMS:57,DssTypeMDSecurityFilter:58,DssTypePromptAnswer:59,DssTypePromptAnswers:60,DssTypeGraphStyle:61,DssTypeChangeJournalSearch:62,DssTypeNCSObjects:255,DssTypeReservedLastOne:63};(function(){mstrmojo.requiresCls("mstrmojo.vi.models.EnumDragSources");function D(H){this.cleanUpAfterTarget(H);var G=H.tgtData;if(G){delete H.tgtData;}var I=this.getContextDragData(H);if(I&&I.setAvatarClass){I.setAvatarClass("");}}mstrmojo.vi.ui._IsDropTarget=mstrmojo.provide("mstrmojo.vi.ui._IsDropTarget",{_mixinName:"mstrmojo.vi.ui._IsDropTarget",dropZone:true,getDropAvatarIcon:function B(G){return"add";},getContextDragData:function F(G){return G.getCtxtDragData();},cleanUpAfterTarget:mstrmojo.emptyFn,ondragenter:function A(G){var H=this.getContextDragData(G);if(H&&H.setAvatarClass){H.setAvatarClass(this.getDropAvatarIcon(G));}if(this._super){this._super(G);}},ondragleave:function E(G){D.call(this,G);if(this._super){this._super(G);}},ondrop:function C(G){D.call(this,G);if(this._super){this._super(G);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx={enabled:true};var E=mstrmojo.dom;mstrmojo.fx._Effect=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.fx._Effect",duration:500,interval:50,delay:null,target:null,getTarget:null,widget:null,slot:null,preStart:null,postStart:null,onCancel:null,onEnd:null,revertOnCancel:true,isPlaying:false,started:false,init:function R(W){mstrmojo.hash.copy(W,this);},play:function C(){this.isPlaying=true;this.started=false;if(this.delay){var W=this;this.delayTimer=window.setTimeout(function(){W._start();W=null;},this.delay);}else{this._start();}},pause:function H(){if(this.delayTimer){window.clearTimeout(this.delayTimer);delete this.delayTimer;}if(this.timer){window.clearInterval(this.timer);delete this.timer;}this.isPlaying=false;},cancel:function U(){this.pause();if(this.started){if(this.revertOnCancel){this.counter=0;this.exec();}if(this.onCancel){this.onCancel();}this.started=false;}},_start:function F(){this.started=true;this._doTarget();this.steps=Math.max(Math.ceil(this.duration/this.interval),1);var W=this.ease;if(typeof W==="string"){this.ease=mstrmojo.registry.ref(W);}if(this._doPreStart()===false){this.started=false;this.isPlaying=false;return ;}this.counter=0;this.exec();this.counter++;this._doPostStart();if(this.counter>=this.steps){this._end();}else{var X=this;if(this.timer){window.clearInterval(this.timer);}this.timer=window.setInterval(function Y(){if(X){X.exec();X.counter++;if(X.counter>=X.steps){X._end();X=null;}}},this.interval);}},exec:null,_end:function D(){this.pause();this.started=false;if(this.onEnd){this.onEnd();}},_doTarget:function T(){if(this.getTarget){this.target=this.getTarget();}else{if(this.widget){this.target=this.widget[this.slot||"domNode"];}else{if(this.target){var X=this.target;if(X&&this.slot&&X.scriptClass){var Y=X[this.slot];if(Y){this.widget=X;this.target=Y;}}}}}if(!this.target){var W=this;while(W=W.parent){if(!W||W.domNode){break;}}if(W){this.widget=W;this.target=W[this.slot||"domNode"];}}},_doPreStart:function N(){if(this.preStart){return this.preStart();}},_doPostStart:function S(){if(this.postStart){this.postStart();}}});function M(Z,a){var X=Z.children,W=(X&&X.length)||0,Y;for(Y=0;Y<W;Y++){X[Y][a]();}}mstrmojo.fx.Parallel=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Parallel",init:function R(Z){this._super(Z);var Y=this.children;mstrmojo.registry.refArray(Y);var W=(Y&&Y.length)||0,X;for(X=0;X<W;X++){Y[X].parent=this;}},_start:function F(){this.started=true;if(this.preStart){this.preStart();}M(this,"play");if(this.postStart){this.postStart();}},pause:function H(){M(this,"pause");},cancel:function U(){M(this,"cancel");}});mstrmojo.fx.AnimateProp=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.AnimateProp",props:null,_start:function O(){var Y=this.props,Z;for(Z in Y){var X=Y[Z],W=X.ease;if(typeof W==="string"){X.ease=mstrmojo.registry.ref(W,{dontInst:true});}}this._super();},exec:function P(){var Z=this.props,a;for(a in Z){var X=Z[a],W=(X.ease||mstrmojo.ease.sin)(this.counter,X.start,X.stop-X.start,this.steps-1);if(X.fn){W=X.fn(W);}if(X.suffix){W+=X.suffix;}var Y=X.isStyle===false?this.target:this.target.style;Y[a]=W;}}});mstrmojo.fx.Typewriter=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Typewriter",charGroupSize:1,srcProp:"text",_doPreStart:function(){this._super();this._dynStop=false;if(this.stop==null){var a=this.srcProp,Y;if(a){var W=this.widget||this.parent;Y=W&&W[a];if((Y!=null)&&(typeof (Y)!=="string")){Y=String(Y);}}this.stop=Y;this._dynStop=true;}if(this.stop==null){this.stop="";}var Z=this.target,b=null,X=1;if(Z){Z.innerHTML="";b=document.createTextNode("");Z.appendChild(b);X=Math.max(Math.floor(this.stop.length/this.steps),1);}this.targetTextNode=b;this.charGroupSize=X;},exec:function(){var X=this.targetTextNode;if(!X){return ;}var W;if(this.counter>=this.steps-1){W=this.stop;}else{if(this.counter===0){W="";}else{W=this.stop.substring(0,this.charGroupSize*this.counter)+"_";}}X.nodeValue=W;},_end:function D(){this._super();if(this._dynStop){this.stop=null;delete this._dynStop;}},cancel:function U(){if(this._dynStop){this.stop=null;delete this._dynStop;}}});mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx.Fade=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Fade",start:null,stop:null,ease:null,suffix:null,exec:function P(W){if(W==null){W=(this.ease||mstrmojo.ease.sin)(this.counter,this.start,this.stop-this.start,this.steps-1);}if(E.isIE&&!E.isWinPhone){this.target.style.filter="alpha(opacity="+parseInt(W*100,10)+")";}else{this.target.style.opacity=W;}}});mstrmojo.fx.FadeOut=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeOut",start:1,stop:0,revertOnCancel:true,cssDisplay:"block",_end:function D(){if(this.cssDisplay){this.target.style.display="none";this.exec(this.start);}this._super();},cancel:function U(){if(this.started&&this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();}});mstrmojo.fx.FadeIn=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeIn",start:0,stop:1,revertOnCancel:true,cssDisplay:"block",_doPostStart:function V(){if(this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();},cancel:function(){if(this.started&&this.revertOnCancel&&this.cssDisplay){this.target.style.display="none";}this._super();}});function I(Y,X,Z){var W=Math.pow(10,Z||2);if(X){return parseInt(W*Y/X,10)/W;}return parseInt(W*Y,10)/W;}mstrmojo.ease={linear:function L(X,W,Z,Y){if(X===Y){return W+Z;}if(X===0){return W;}return W+Z*I(X,Y);},sin:function A(X,W,Z,Y){return W+Z*Math.sin((Math.PI/2)*X/Y);},cos:function B(X,W,Z,Y){return W+Z*Math.cos((Math.PI/2)*(1-X/Y));},sincos:function K(X,W,Z,Y){if(X>Y/2){return W+Z*Math.cos((Math.PI/2)*(1-X/Y));}return W+Z*Math.sin((Math.PI/2)*X/Y);},cossin:function Q(X,W,Z,Y){if(X>Y/2){return W+Z*Math.sin((Math.PI/2)*X/Y);}return W+Z*Math.cos((Math.PI/2)*(1-X/Y));},bounce:function G(X,W,Z,Y){if((X/=Y)<(1/2.75)){return Z*(7.5625*X*X)+W;}if(X<(2/2.75)){return Z*(7.5625*(X-=(1.5/2.75))*X+0.75)+W;}if(X<(2.5/2.75)){return Z*(7.5625*(X-=(2.25/2.75))*X+0.9375)+W;}return Z*(7.5625*(X-=(2.625/2.75))*X+0.984375)+W;},shake:function J(X,W,Z,Y){if(X<Y/2){return W+Z*I(Math.sin(2*Math.PI*X/8),null,2)*2*X/Y;}return W+Z*I(Math.sin(2*Math.PI*X/8),null,2)*2*(1-X/Y);}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var B=mstrmojo.dom,E=100;function I(K,J){return function(L){mstrmojo.all[K][(J?"move":"show")+"Tooltip"](L,self);};}function A(){var K=this.tooltipNode||this.domNode,M=this.id,J,L="_ontooltip"+(this.isDynamicTooltip?"move":"over");if(!this._ontooltipout){this._ontooltipout=function(N){mstrmojo.all[M].hideTooltip(N,self);};}if(!this[L]){this[L]=I(M,this.isDynamicTooltip);}K=[].concat(K);for(J=0;J<K.length;J++){K[J].removeAttribute("title");B.attachEvent(K[J],(this.isDynamicTooltip?"mousemove":"mouseover"),this[L]);B.attachEvent(K[J],"mouseout",this._ontooltipout);}}mstrmojo._HasTooltip=mstrmojo.provide("mstrmojo._HasTooltip",{tooltip:"",richTooltip:null,useRichTooltip:false,isDynamicTooltip:false,tooltipNode:null,tooltipOpenDelay:700,hasOpenTooltip:false,postBuildRendering:function(){var J=this._super();if(this.useRichTooltip){A.call(this);}return J;},onuseRichTooltipChange:function H(){if(this.hasRendered){var K=this.tooltipNode||this.domNode,J;if(this.useRichTooltip){A.call(this);}else{if(this._ontooltipout){if(K&&K.constructor!==Array){K=[K];}for(J=0;J<K.length;J++){B.detachEvent(K[J],this.isDynamicTooltip?"mousemove":"mouseover",this["_ontooltip"+(this.isDynamicTooltip?"move":"over")]);B.detachEvent(K[J],"mouseout",this._ontooltipout);}}this.hideTooltip();}}},showTooltip:function G(M,L){var K=this;if(!K.hasOpenTooltip&&(!mstrApp.isInteractive||mstrApp.isInteractive&&mstrApp.isInteractive())){mstrmojo.requiresCls("mstrmojo.tooltip");if(this.updateTooltipConfig){this.updateTooltipConfig(M);}window.clearTimeout(this._tooltipTimeOut);if(mstrmojo.dom.isIE){var N={};for(var J in M){N[J]=M[J];}M=N;}var O=this.richTooltip?this.richTooltip.areaId:undefined;this._tooltipTimeOut=window.setTimeout(function(){if(K._closeTooltipTimeout){window.clearTimeout(K._closeTooltipTimeout);delete K._closeTooltipTimeout;}mstrmojo.tooltip.open(K,M,L);K.tooltip.onmouseover=function(){if(K.richTooltip&&K.richTooltip.enableHover){window.clearTimeout(K._closeTooltipTimeout);window.clearTimeout(K._deactivationTimeout);if(K.tooltip){K.tooltip.onmouseout=function(P){if(!B.contains(this.domNode,P.e.toElement||P.e.relatedTarget)){K.hideTooltip();}};}}};K.hasOpenTooltip=true;K._hasActiveArea=true;K._tooltipAreaId=O;window.clearTimeout(K._deactivationTimeout);delete K._deactivationTimeout;},(this._hasActiveArea&&O&&O===this._tooltipAreaId)?0:this.tooltipOpenDelay);}},moveTooltip:function C(J,L){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;mstrmojo.tooltip.close();}var N=this,K=J,M=L;this._tooltipTimeOut=setTimeout(function(){mstrmojo.tooltip.open(N,K,M);},this.tooltipOpenDelay);},hideTooltip:function F(){var J=this;window.clearTimeout(this._tooltipTimeOut);if(this._closeTooltipTimeout){window.clearTimeout(this._closeTooltipTimeout);}if(this._hasActiveArea&&!this._deactivationTimeout){this._deactivationTimeout=window.setTimeout(function(){delete J._deactivationTimeout;delete J._hasActiveArea;delete J._tooltipAreaId;},100);}mstrmojo.requiresCls("mstrmojo.tooltip");if(J.richTooltip&&J.richTooltip.enableHover){this._closeTooltipTimeout=window.setTimeout(function(){mstrmojo.tooltip.close();delete J._closeTooltipTimeout;},E);}else{mstrmojo.tooltip.close();}this.hasOpenTooltip=false;},unrender:function D(M){var N=this.tooltipNode||this.domNode,L;if(N&&N.constructor!==Array){N=[N];}if(N){var O=this._ontooltipover,K=this._ontooltipout,J=this._ontooltipmove;for(L=0;L<N.length;L++){if(O){B.detachEvent(N[L],"mouseover",O);}if(K){B.detachEvent(N[L],"mouseout",K);}if(J){B.detachEvent(N[L],"mousemove",J);}}}this._super(M);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var D=mstrmojo.dom,L=mstrmojo.hash;var O=100;var F=D.supportsTouches?0.5:1;var G=1;var R=100;var P={onvscrollVisibleChange:function(){var U=this.vscrollNode,V=U&&U.style;if(!V){return ;}if(this.vscrollVisible){var T=this.maxPos,W=this.clientSize;V.height=Math.round(W.y*W.y/T.y)+"px";V.left=(W.x-5)+"px";V.display="block";V.opacity=0.5;}else{V.opacity=0;}},onhscrollVisibleChange:function(){var V=this.hscrollNode,U=V&&V.style;if(!U){return ;}if(this.hscrollVisible){var T=this.maxPos,W=this.clientSize;U.width=Math.round(W.x*W.x/T.x)+"px";U.top=(W.y-5)+"px";U.display="block";U.opacity=0.5;}else{U.opacity=0;}}};var M=L.copy({onposChange:function(){var V=this.clientSize,U=this.maxPos,T=0,W=0;if(this.scrollsVert){W=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style[D.CSS3_TRANSFORM]="translateY("+Math.round((V.y-(V.y*V.y/U.y))*this.pos.y/U.y)+"px)";}}if(this.scrollsHoriz){T=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style[D.CSS3_TRANSFORM]="translateX("+Math.round((V.x-(V.y*V.x/U.x))*this.pos.x/U.x)+"px)";}}this.scrollChild.style[D.CSS3_TRANSFORM]="translate3d(-"+parseInt(T,10)+"px, -"+parseInt(W,10)+"px, 0px)";},ondeceleratingChange:function(){this.scrollChild.style[D.CSS3_TRANSITION]=this.decelerating?(D.CSS3_PREFIX+"transform 0.2s linear"):"";}},L.copy(P));var H=L.copy({onposChange:function(){var V=this.clientSize,U=this.maxPos,T=0,X=0,W=this.scrollboxNode;if(this.scrollsVert){X=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style.top=Math.round((V.y-(V.y*V.y/U.y))*this.pos.y/U.y)+"px";}W.scrollTop=parseInt(X,10);}if(this.scrollsHoriz){T=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style.left=Math.round((V.x-(V.y*V.x/U.x))*this.pos.x/U.x)+"px";}W.scrollLeft=parseInt(T,10);}}},L.copy(P));mstrmojo._TouchScrolling=mstrmojo.provide("mstrmojo._TouchScrolling",{FRICTION:0.65,BOUNCEFRICTION:0.5,usesTouches:false,bounces:true,scrollsHoriz:true,scrollsVert:true,pos:null,preBuildRendering:function N(){this.usesTouches=(mstrmojo.dom.supportsTouches&&this.usesTouches&&(this.scrollsHoriz||this.scrollsVert));if(this.usesTouches){this.pos={x:0,y:0};}if(this._super){this._super();}},postBuildRendering:function C(){if(this._super){this._super();}if(this.usesTouches){var W=this.scrollboxNode,V=this.itemsContainerNode||W.firstChild;if(W&&W!==V){this.scrollChild=V;var T=W.style;T.position="relative";T.overflow="hidden";var U=V.style;U.position="absolute";U.left=0;U.top=0;this.markupMethods=L.copy(D.isSafari?M:H,L.copy(this.markupMethods));this.attachTouchEvents();}}},unrender:function(T){if(this.usesTouches){this.detachTouchEvents();}this._super(T);},attachTouchEvents:function(){var U=this.touchNode||this.scrollboxNode;if(U){if(!this._tsCallback){var T=this;this._tsCallback=function(V){T.touchesBegin(self,V);};this._tmCallback=function(V){T.touchesMoved(self,V);};this._teCallback=function(V){T.touchesEnd(self,V);};}D.attachEvent(U,D.TOUCHSTART,this._tsCallback);this._tsNode=U;}},detachTouchEvents:function(){var T=this._tsNode;if(T){D.detachEvent(T,D.TOUCHSTART,this._tsCallback);delete this._tsNode;}},touchesBegin:function J(T,V){var U=V.target&&V.target.tagName;if(U&&(U==="SELECT"||U==="INPUT")){return ;}D.preventDefault(T,V);this.stopDeceleration();this.startTime=new Date();this.startTimePos={x:this.pos.x,y:this.pos.y};this.startTouchPos=D.getMousePosition(D.firstTouch(T,V),T);this.dragging=false;D.attachEvent(window,D.TOUCHMOVE,this._tmCallback);D.attachEvent(window,D.TOUCHEND,this._teCallback);},touchesMoved:function E(b,d){var Z=D.getMousePosition(D.firstTouch(b,d),b);D.preventDefault(b,d);if(!this.dragging){var T=5,h=Math.abs;if((this.scrollsHoriz&&h(Z.x-this.pos.x)>T)||(this.scrollsVert&&h(Z.y-this.pos.y)>T)){this.dragging=true;this.dragStartTime=new Date();this.startTouchPos=Z;var V=this.scrollboxNode,Y={x:V.clientWidth,y:V.clientHeight},f={x:V.scrollWidth,y:V.scrollHeight};this.clientSize=Y;this.scrollSize=f;this.maxPos={x:Math.max(f.x-Y.x,0),y:Math.max(f.y-Y.y,0)};this.showScroll();}}if(this.dragging){D.stopPropogation(b,d);var c=this.startTimePos,X=this.startTouchPos,a=this.maxPos;var W={x:this.scrollsHoriz?Math.max(Math.min(c.x-(Z.x-X.x),a.x),0):0,y:this.scrollsVert?Math.max(Math.min(c.y-(Z.y-X.y),a.y),0):0};this.set("pos",W);this.nextLastDragPos=this.lastDragPos;this.lastDragPos=Z;var U=new Date(),g=this.lastDragTime;this.nextLastDragTime=g;this.lastDragTime=U;if((U-g)>R){this.startTime=this.lastDragTime;this.dragStartTime=this.startTime;this.startTimePos={x:W.x,y:W.y};this.startTouchPos=Z;}}},touchesEnd:function I(T,U){D.preventDefault(T,U);D.detachEvent(window,D.TOUCHMOVE,this._tmCallback);D.detachEvent(window,D.TOUCHEND,this._teCallback);if(this.dragging){this.dragging=false;D.stopPropogation(T,U);if((new Date())-this.lastDragTime<=R){this.startDeceleration(T,U);}else{this.hideScroll();}}},startDeceleration:function B(Y,Z){var W=D.getMousePosition(D.firstChangedTouch(Y,Z),Y),c=((mstrmojo.dom.supportsTouches===null)?this.lastDragPos:this.nextLastDragPos)||W,b={x:W.x-c.x,y:W.y-c.y},T=((mstrmojo.dom.supportsTouches===null)?this.lastDragTime:this.nextLastDragTime),d=T?(new Date())-T:0,V={x:d?Number(b.x*O*F/d).toFixed(2):0,y:d?Number(b.y*O*F/d).toFixed(2):0};var a=this,U=function(e){return(a.scrollsHoriz&&Math.abs(e.x)>=G)||(a.scrollsVert&&Math.abs(e.y)>=G);};if(U(V)){this.velocity=V;this.friction={x:this.FRICTION,y:this.FRICTION};this.set("decelerating",true);var X=function(){a.decelerate();if(!U(a.velocity)){a.stopDeceleration();a=null;}};X();if(this.decelerating){this.decelerationTimer=window.setInterval(X,O);}}else{this.hideScroll();}},stopDeceleration:function A(){this.set("decelerating",false);delete this.velocity;if(this.decelerationTimer){window.clearTimeout(this.decelerationTimer);delete this.decelerationTimer;}this.hideScroll();},decelerate:function S(){var W=this.pos,V=this.velocity,U=this.friction,Z=this.maxPos,X={x:W.x-V.x,y:W.y-V.y},b=this.bounces,T=this.BOUNCEFRICTION;var a=X.x;if(a<0||a>Z.x){X.x=(a<0)?0:Z.x;V.x*=b?-T:0;U.x=T;}var Y=X.y;if(Y<0||Y>Z.y){X.y=(Y<0)?0:Z.y;V.y*=b?-T:0;U.y=T;}this.set("pos",X);this.velocity={x:U.x*V.x,y:U.y*V.y};},hideScroll:function K(){this.set("vscrollVisible",false);this.set("hscrollVisible",false);},showScroll:function Q(){var T=this.maxPos;if(this.scrollsVert&&T.y&&this.vscrollNode){this.set("vscrollVisible",true);}if(this.scrollsHoriz&&T.x&&this.hscrollNode){this.set("hscrollVisible",true);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;function D(J,I){var G=[];if(J){var F;for(F in J){var H=Number(F);if(H>=I){G.push(H);}}}G.sort(mstrmojo.array.numSorter);return G;}mstrmojo.ListSelector=mstrmojo.provide("mstrmojo.ListSelector",{premousedown:function E(L,F,N){if(C.isPrimaryMouseBtn(N.e)){var I=N.hWin,J=N.e,G=C.eventTarget(I,J),M=L.listMapper.findIndex(L,F,G);if(M>-1){var H=L.multiSelect,K=C.ctrlKey(I,J),O=C.shiftKey(I,J);if(K||O){C.clearBrowserHighlights(I);}if(H&&(K||(L.selectionPolicy==="toggle"))){L.toggleSelect(M);}else{if(H&&O){L.rangeSelect(M);}else{L.singleSelect(M);}}}}},premouseup:function B(H,K,G){var F=G.hWin,J=G.e,L=C.ctrlKey(F,J),I=C.shiftKey(F,J);if(L||I){C.clearBrowserHighlights(F);}},onadd:function A(I,H){var M=H&&H.value&&H.value.length;if(M){var G=H.index,K=I.selectedIndices,L=D(K,G),J;for(J=L.length-1;J>-1;J--){var F=L[J];K[F+M]=true;delete K[F];}if(I.selectedIndex>=G){I.selectedIndex+=M;}}},onremove:function A(Q,S){var O=S&&S.value&&S.value.length;if(O){var R=S.index,I=R+O-1,M=Q.selectedIndices,L=Q.selectedIndex,G=[],T=[],P=false;if(M){var H;for(H in M){var K=Number(H);if(K>I){G.push(K);}else{if(K>=R){T.push(K);P=true;}}}}G.sort(mstrmojo.array.numSorter);var J,N;for(J=0,N=G.length;J<N;J++){var F=G[J];M[F-O]=true;delete M[F];}if(L>I){Q.selectedIndex-=O;}if(P){Q.removeSelect(T);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var E=mstrmojo.dom;var P=mstrmojo.dom;var O="mousedown";function S(U){var T=U[U.hotSlot||"domNode"];if(T){if(!U._closeCallback){var W=U.id,V=function(X){return function(Z){var Y=mstrmojo.all[W];if(Y&&!Y.ignoreHover){Y["auto"+X](Z,self);}};};U._uncloseCallback=V("Unclose");U._closeCallback=V("Close");}E.attachEvent(T,"mouseover",U._uncloseCallback);E.attachEvent(T,"mouseout",U._closeCallback);}}function B(U){if(U._closeCallback){var T=U[U.hotSlot||"domNode"];if(T){E.detachEvent(T,"mouseover",U._uncloseCallback);E.detachEvent(T,"mouseout",U._closeCallback);}}}function F(V,U){var T=V;while(T){if(T.open||T.openPopup){if(T.set){T.set("ignoreHover",U);}else{T.ignoreHover=U;}}T=T.opener||T.parent;if(T&&T.shouldPropagateLockHover&&!T.shouldPropagateLockHover()){break;}}}function D(){var T=this._lockHoverCallback;if(T){E.detachEvent(document.body,O,T,true);delete this._lockHoverCallback;}}mstrmojo._CanAutoClose=mstrmojo.provide("mstrmojo._CanAutoClose",{autoCloses:false,autoCloseDelay:100,locksHover:false,hotSlot:null,closeOnClick:false,curtainNode:null,postBuildRendering:function Q(){this._super();if(this.autoCloses){S(this);}this.oncloseOnClickChange();},onautoClosesChange:function L(){var T=(this.autoCloses)?S:B;T(this);},oncloseOnClickChange:function H(){if(!this.curtainNode){return ;}var V=this,U="click",T=(mstrApp&&mstrApp.isTouchApp&&mstrApp.isTouchApp());if(T){U="touchstart";}E.attachEvent(V.curtainNode,U,function(){V.close();if(T){mstrmojo.touchManager.notify([]);}});},autoUnclose:function G(){var T=this._autoCloseTimer;if(T){self.clearTimeout(T);delete this._autoCloseTimer;}},autoClose:function J(){if(this.ignoreHover){return ;}if(this._autoCloseTimer){self.clearTimeout(this._autoCloseTimer);}if(this.opener){if(this.autoCloseDelay){var T=this.opener.id;this._autoCloseTimer=self.setTimeout(function(){mstrmojo.all[T].closePopup();},this.autoCloseDelay);}else{this.opener.closePopup();}}},destroy:function R(T){D.call(this);this._super(T);},lockHover:function N(){F(this,true);if(!this._lockHoverCallback){var U=this.id,T=this._lockHoverCallback=function(V){mstrmojo.all[U]._unlockHoverCheck(V,self);};if((E.isIE7||E.isIE8)&&window.event&&(window.event.type===O)&&this.opener){this.opener._ignoreMousedown=true;}E.attachEvent(document.body,O,T,true);}},unlockHover:function M(){F(this,false);D.call(this);},_unlockHoverCheck:function C(X,T){var U=this.opener;if(U&&U._ignoreMousedown){delete U._ignoreMousedown;return ;}var W=E.eventTarget(T,X);if(!P.contains(this.domNode,W,true,document.body)){var V=P.findWidget(W);while(V){if(V===this){return ;}V=V.parent||V.opener;}if(U&&U.onPopupAutoClosed){U.onPopupAutoClosed(X,T);}this.close();}},open:function I(U,T){if(this.autoCloses){this.autoUnclose();}this._super(U,T);if(this.locksHover){this.lockHover();}},close:function K(T){if(this.locksHover){this.unlockHover();}this._super(T);},shouldPropagateLockHover:function A(){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;mstrmojo._FillsBrowser=mstrmojo.provide("mstrmojo._FillsBrowser",{_mixinName:"mstrmojo._FillsBrowser",getBrowserDimensions:function E(G){if(G){return{w:G.innerWidth,h:G.innerHeight};}var F=C.windowDim(),H=(C.isFF||C.isWK)?0:2;return{w:Math.max(F.w,0)+"px",h:Math.max(F.h-H,0)+"px"};},preBuildRendering:function A(){var H=this._super(),G=this.getBrowserDimensions();if(!this.browserResized||this.browserResized(G)!==true){this.height=G.h;this.width=G.w;}if(!this._listenerProc){window._monitor=this;var I=this.id,F=this._listenerProc=function(K){var J=K||window.event;mstrmojo.all[I].monitorWindow(J);};C.attachEvent(window,"resize",F);}return H;},destroy:function B(F){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);}this._super(F);},monitorWindow:function D(F){var I=F.currentTarget,H=this.getBrowserDimensions(),G={w:(I?I.innerWidth+"px":H.w),h:(I?I.innerHeight+"px":H.h)};if((G.h===this.height&&G.w===this.width)||parseInt(G.h,10)<=20||parseInt(G.w,10)<=20){return ;}if(!this.browserResized||this.browserResized(G,true)!==true){if(G.h!==this.height){this.set("height",G.h);}if(G.w!==this.width){this.set("width",G.w);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");function G(J){return(J&&J.id);}mstrmojo._HasScrollbox=mstrmojo.provide("mstrmojo._HasScrollbox",{_mixinName:"mstrmojo._HasScrollbox",scrollListeners:null,scrollListenerCount:0,scrollInterval:50,scrollboxNode:undefined,scrollTo:function F(L,K){var J=this.scrollboxNode;J.scrollLeft=L.x;J.scrollTop=L.y;if(K){this.notifyScrollListeners(L);}},connectScrollbox:function E(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(!L){L={};this.scrollListeners=L;}if(!L[J]){L[J]=K;this.scrollListenerCount++;if(this.scrollListenerCount===1){this._attachScrollDom();}}},disconnectScrollbox:function D(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(L&&L.hasOwnProperty(J)){delete this.scrollListeners[J];this.scrollListenerCount--;if(!this.scrollListenerCount){this._detachScrollDom();}}},notifyScrollListeners:function C(K){var N=K||this.getScrollPos(),M=N.y,L=N.x;this.scrollboxTop=M;this.scrollboxLeft=L;this.scrollboxRight=L+this.scrollboxWidth;this.scrollboxBottom=M+this.scrollboxHeight;var J=this.scrollListeners,O;for(O in J){J[O].onscroll(this);}},getScrollPos:function H(){var J=this.scrollboxNode;return{x:J.scrollLeft,y:J.scrollTop};},_attachScrollDom:function A(){var M=this.scrollboxNode;if(M){var L=this.usesTouches;if(!L){if(!this.scrollCallback){var K=this.id;this.scrollCallback=function(){mstrmojo.all[K].notifyScrollListeners();};}mstrmojo.dom.attachBufferedEvent(M,"scroll",this.scrollCallback,this.scrollInterval);}if(this.scrollboxTop===null){this.scrollboxTop=L?0:M.scrollTop;}if(this.scrollboxLeft===null){this.scrollboxLeft=L?0:M.scrollLeft;}var J=function(P){var O=P.toLowerCase();var N=M.style[O];return(!isNaN(N)&&N.charAt(N.length-1)!=="%")?parseInt(N,10):M["client"+P];};if(this.scrollboxHeight===null){this.scrollboxHeight=J("Height");}if(this.scrollboxWidth===null){this.scrollboxWidth=J("Width");}this.scrollboxBottom=this.scrollboxTop+this.scrollboxHeight;this.scrollboxRight=this.scrollboxLeft+this.scrollboxWidth;this._attachedScrollbox=M;}},_detachScrollDom:function I(){var J=this._attachedScrollbox;if(J&&this.scrollCallback){mstrmojo.dom.detachBufferedEvent(J,"scroll",this.scrollCallback,this.scrollInterval);}delete this._attachedScrollbox;},scrollboxTop:null,scrollboxLeft:null,scrollboxHeight:null,scrollboxBottom:null,buildRendering:function B(){this._detachScrollDom();this._super();if(this.scrollListenerCount){this._attachScrollDom();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var A=false,P=mstrmojo.dom,T=16;mstrmojo._HasContextMenu=mstrmojo.provide("mstrmojo._HasContextMenu",{cm:null,cmPos:null,itemField:"n",itemIdField:"did",itemChildrenField:"items",dynamicUpdate:false,queryChecked:function(U){return false;},queryEnabled:function(U){return true;},queryVisible:function(U){return true;},executeCommand:function O(U){},item2textCss:function E(U){return U.cssClass||U.cmdId||("cmd"+U[this.itemIdField]);},showContextMenu:function J(){if(!A){mstrmojo.requiresCls("mstrmojo.ContextMenu");A=true;}var a=this._subMenu,Y=this.getMenuPosition();if(!a){var c=(this.menuZIndex||this.zIndex||10)+1,W={left:Y.x+"px",top:Y.y+"px",zIndex:c,visible:false,dynamicUpdate:this.dynamicUpdate,itemField:this.itemField,itemIdField:this.itemIdField,itemChildrenField:this.itemChildrenField,_cmSource:this.getContextMenuSource(),items:this.getContextMenuItems(),cssClass:this.getContextMenuCssClass(),placeholder:document.body.appendChild(document.createElement("div")),parent:this};a=new mstrmojo.ContextMenu(W);a.render();this._subMenu=a;}else{a.set("left",Y.x+"px");a.set("top",Y.y+"px");}if(this.dynamicUpdate){var V=a.ctxtBuilder.itemWidgets,X=V&&V.length,U,Z,b=this.getContextMenuSource();for(U=0;U<X;U++){Z=V[U];if(b.queryVisible){Z.set("visible",b.queryVisible(Z.data));}if(b.queryChecked){Z.set("checked",b.queryChecked(Z.data));}if(b.queryEnabled){Z.set("enabled",b.queryEnabled(Z.data));}}}a.set("visible",true);this.callOnContextMenuOpen();this.adjustMenuPosition();this.attachMousedownEvent();},hideContextMenu:function I(){var U=this._subMenu;if(U&&U.visible){this._subMenu.set("visible",false);this.callOnContextMenuClose();}},adjustMenuPosition:function N(){var U=this._subMenu,X=this._subMenu.domNode,W=X.offsetHeight,V=X.offsetWidth,a=P.windowDim(),Z=P.position(X,false),Y=P.position(X,true);if((Z.x+V+T)>a.w){U.set("left",(a.w-V-T+(Y.x-Z.x))+"px");}if((Z.y+W+T)>a.h){U.set("top",(a.h-W-T+(Y.y-Z.y))+"px");}},attachMousedownEvent:function L(){var U=this;if(!this._close_handler){this._close_handler=function(V){U.closeMenuHandler(V);};}P.attachEvent(document.body,"mousedown",this._close_handler);},closeMenuHandler:function Q(U){if(!this.isOnMySubmenu(P.eventTarget(self,U))){this.closeMenuTree();}},isOnMySubmenu:function M(Y){var V=this._subMenu;if(!V){return false;}if(P.contains(V.domNode,Y,true,document.body)){return true;}var Z=V.ctxtBuilder.itemWidgets,U=Z&&Z.length,X,W;for(X=0;X<U;X++){W=Z[X];if(W.isOnMySubmenu(Y)){return true;}}return false;},callOnContextMenuOpen:function D(){if(this.onContextMenuOpen){this.onContextMenuOpen();}},callOnContextMenuClose:function C(){if(this.onContextMenuClose){this.onContextMenuClose();}},getContextMenuItems:function S(){return this.cm;},getContextMenuCssClass:function B(){return this.cmCssClass||"";},getContextMenuSource:function H(){return this;},getMenuPosition:function F(){if(this.cmPos){return this.cmPos;}var U=P.position(this.domNode,true);return{x:Math.round(U.x),y:Math.round(U.y+U.h)};},isSeparatorItem:function G(U){return U[this.itemIdField]===-1||U[this.itemField]==="-";},hasSubmenu:function K(U){return !!U[this.itemChildrenField];},closeMenuTree:function R(W){var V=this.activeMenuItem,U=this._cmSource||this;if(!V){if(W){this.activeMenuItem=W;}else{U.hideContextMenu();}return ;}if(V===W){return ;}if(W){this.activeMenuItem=W;if(W.parent.parent===V){return ;}if(W.parent===V.parent){V.hideContextMenu();return ;}}else{W=U;this.activeMenuItem=null;}V.hideContextMenu();while(V!==U){V=V.parent.parent;if(V!==W||U===W){V.hideContextMenu();if(U===W){P.detachEvent(document.body,"mousedown",this._close_handler);}}if(V.parent===W.parent){break;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;mstrmojo.ui._IsIncFetchList=mstrmojo.provide("mstrmojo.ui._IsIncFetchList",{_mixinName:"mstrmojo.ui._IsIncFetchList",ifDataHelper:null,supportsIncFetch:false,isFetching:false,initScroll:function A(){var G=this.ifDataHelper,F=this,E=this.scrollNode||this.domNode;this.supportsIncFetch=G&&G.hasNext();if(G&&this.supportsIncFetch){this._scroll=function D(){if(E.offsetHeight+E.scrollTop>=E.scrollHeight){F.raiseEvent({name:"incFetch",id:F.id});}};C.attachEvent(E,"scroll",this._scroll);this.attachEventListener("incFetch",this.id,function(H){if(!this.supportsIncFetch||this.isFetching){return ;}if(this.preNext){this.preNext();}this.set("isFetching",true);G.next({complete:function(I){if(F.postNext){F.postNext();}F.set("isFetching",false);},success:function(I){F.addItems(I.items);},failure:function(I){F.supportsIncFetch=false;mstrmojo.alert("Error in fetching next: "+I);}});});}},addItems:function B(D){if(this._super){this._super(D);}if(!this.ifDataHelper.hasNext()){this.supportsIncFetch=false;var E=this.scrollNode||this.domNode;C.detachEvent(E,"scroll",this._scroll);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var E=mstrmojo.dom,M=mstrmojo.hash,B,I=mstrmojo.global.document,K="mousedown",P="mousemove",R="mouseup";function G(Y){if(E.isPrimaryMouseBtn(Y)){B.startDragCheck(self,Y);}}var V,Q,A="mstrmojo-dnd-avatar",U;function F(Z,Y){if(Y!==undefined&&Y!==null){Q.innerHTML=Y;}U.left=Z.x+"px";U.top=Z.y+"px";}function L(Z,Y){if(!V){V=I.createElement("div");U=V.style;V.className=A;V.innerHTML='<div class="'+A+'-inner"></div>';Q=V.firstChild;I.body.appendChild(V);}F(Z,Y);U.display="block";}function S(){if(U){U.display="none";}}function H(Y){var Z=++B.ctxt.moveCount;if(Z>=B.minMoves){B.stopDragCheck();if((Y.buttons===1||Y.buttons===undefined||E.isIE9)&&(Y.which===1||Y.button===0||E.isIE8)){B.startDrag(self,Y);}}}function O(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDragCheck();delete B.ctxt;}}function D(Y){B.onDragMove(self,Y);}function C(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDrag(window,Y);}}function N(b){var Z=mstrmojo.hash.copy(b,{}),a=Z.hWin=Z.hWin||window,Y=Z.e=Z.e||a.event;Z.node=E.eventTarget(a,Y);Z.pos=E.getMousePosition(Y,a);return Z;}function J(Z){var Y=E.findWidget(Z);while(Y){if(Y.draggable){return Y;}Y=Y.parent;}return null;}function T(Y){var a=Y.src,Z=J(a.node);if(!Z){return null;}if(Z.getDragAction){Y.action=Z.getDragAction(Y);}a.widget=Z;a.data=Z.getDragData&&Z.getDragData(Y);if(Z.isDragValid){if(!Z.isDragValid(Y)){if(!Z.shouldDragBubble||Z.shouldDragBubble(Y)!==true){Y.src.node=Z.domNode.parentNode;return T(Y);}return null;}}if(Z.ondragstart){Z.ondragstart(Y);}return Z;}function X(a,Z){var Y=E.findWidget(a),b=Z.tgt&&Z.tgt.widget;while(Y){if(Y.dropZone){if(Y===b){return Y;}if(Y.allowDrop&&Y.allowDrop(Z)){return Y;}}Y=Y.parent;}return null;}function W(){if(this.set){this.set("allowingDrop",false);}}mstrmojo.dnd=mstrmojo.dnd||mstrmojo.provide("mstrmojo.dnd",{minMoves:3,enable:function(){if(!mstrmojo.dndEnabled){E.attachEvent(I,K,G);mstrmojo.dndEnabled=true;}},disable:function(){mstrmojo.dndEnabled=false;E.detachEvent(I,K,G);},startDragCheck:function(Y,Z){delete this.ctxt;var a=N({hWin:Y,e:Z});this.ctxt={src:a,moveCount:0,last:M.copy(a.pos),getDirection:function(b){return !!this.dir[b];},getCtxtDragData:function(){var b=this.src;return(b&&b.data)||{};},getCtxtDropData:function(){var b=this.tgt;return(b&&b.data)||{};}};if(this.minMoves){E.attachEvent(I,P,H);E.attachEvent(I,R,O);}else{this.startDrag(Y,Z);}},stopDragCheck:function(){E.detachEvent(I,P,H);E.detachEvent(I,R,O);},startDrag:function(Y,b){var Z=this.ctxt;Z.id=mstrmojo.now();var a=T(Z);if(!a){return ;}E.clearBrowserHighlights(Y);E.preventDefault(self,b);E.attachEvent(I,P,D);E.attachEvent(I,R,C);var d=window.mstrApp;if(d&&d.setInteractive){this._changeAppStatus=d.setInteractive(false);}if(!a.ownAvatar){var c=Z.src;L(c.pos,c.data&&c.data.html);}},stopDrag:function(Y,f){E.detachEvent(I,P,D);E.detachEvent(I,R,C);var b=this.ctxt,a=b.tgt||{},Z=N({hWin:Y,e:f,data:a.data}),d=X(Z.node,b);Z.widget=d;b.tgt=Z;if(d){if(d.ondrop){d.ondrop(b);}else{W.call(d);}}var c=b.src.widget;if(c&&c.ondragend){c.ondragend(b);}if(c&&!c.ownAvatar){S();}if(this._changeAppStatus){window.mstrApp.setInteractive(true);delete this._changeAppStatus;}},onDragMove:function(c,f){if(E.isSafari){E.clearBrowserHighlights();}var Y=this.ctxt,b=Y.tgt||{},Z=b.widget,d=N({hWin:c,e:f,data:b.data}),i=d.widget=X(d.node,Y),h=Y.last,a=d.pos;Y.dir={x:a.x>h.x,y:a.y>h.y};Y.last=M.copy(d.pos);Y.tgt=d;if(Z!==i){if(Z){if(Z.ondragleave){Z.ondragleave(Y);}else{W.call(Z);}}if(i){Y.tgt.data=(i.getDropData&&i.getDropData(Y))||{};if(i.ondragenter){i.ondragenter(Y);}else{if(i.set){i.set("allowingDrop",true);}}}}if(i){if(i.ondragover){i.ondragover(Y);}}var g=Y.src.widget;if(g&&g.ondragmove){g.ondragmove(Y);}if(g&&!g.ownAvatar){F(d.pos);}}});B=mstrmojo.dnd;B.enable();}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var K=mstrmojo.array,D=mstrmojo.hash;function E(V,T){var W=[],Q=V.selectedIndices,P=V.allIdx;var R,S,U=V.items;if(V.multiSelect&&(P>-1)&&(K.indexOf(T,V.allIdx)>-1)){for(R=0,S=U.length;R<S;R++){if(!Q[R]){W.push(R);Q[R]=true;V.selectedIndex=R;V.selectedItem=U[R];}}}else{for(R=0,S=T.length;R<S;R++){var X=T[R];if(!Q[X]){Q[X]=true;W.push(X);V.selectedIndex=X;V.selectedItem=U[X];}}}return W;}function J(R){var Q=[],S=R.selectedIndices,P;for(P in S){delete S[P];Q.push(parseInt(P,10));}R.selectedIndex=-1;R.selectedItem=null;return Q;}function H(V,U){var S=[],Q=V.selectedIndices,X=K.indexOf,P=V.allIdx;if(V.multiSelect&&(P>-1)&&(X(U,P)>-1)){return J(V);}if(U.length>0&&Q[P]){if(X(U,P)<0){U.push(P);}}var T=U.length,R;for(R=0;R<T;R++){var W=U[R];if(Q[W]){delete Q[W];S.push(W);if(V.selectedIndex===W){V.selectedIndex=-1;V.selectedItem=null;}}}return S;}function A(S,R){var P=S.selectedIndices;if(!P){P={};S.selectedIndices=P;}if(!R){R={};}var U=S.selectedIndex,T=[],V,Q;for(Q in P){if(!R[Q]){V=parseInt(Q,10);delete P[Q];T.push(V);if(U===V){S.selectedIndex=-1;S.selectedItem=null;}}}var X=[],W=S.items;for(Q in R){if(!P[Q]){V=parseInt(Q,10);P[Q]=true;X.push(V);S.selectedIndex=V;S.selectedItem=W&&W[V];}}return{add:X,rmv:T};}function G(Q,P,R){if(Q.raiseEvent&&((P&&P.length)||(R&&R.length))){Q.raiseEvent({name:"change",added:P,removed:R});}}mstrmojo._ListBase2Selections=mstrmojo.provide("mstrmojo._ListBase2Selections",{multiSelect:false,selectedIndices:null,selectedIndex:-1,selectedItem:null,selectedIndices_bindEvents:"change",selectedIndex_bindEvents:"change",selectedItem_bindEvents:"change",allowUnlistedValues:true,insertUnlistedValuesAt:-1,allIdx:-1,singleSelect:function F(P,Q){if(!this.selectedIndices[P]||(this.selectionPolicy==="reselect")||(P!==this.allIdx&&this.selectedIndices[this.allIdx])){var R=J(this),S=E(this,[P]);if(Q!==true){G(this,S,R);}}},toggleSelect:function O(P,Q){var S,R;if(this.selectedIndices[P]){R=H(this,[P]);}else{S=E(this,[P]);}if(Q!==true){G(this,S,R);}},rangeSelect:function N(P,Q){this.singleSelect(P,Q);},clearSelect:function I(P){var Q=J(this);if(P!==true){G(this,null,Q);}},select:function L(R,P){var Q=A(this,K.hash(R));if((P!==true)&&(Q.add.length||Q.rmv.length)){G(this,Q.add,Q.rmv);}},addSelect:function B(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=E(this,R);if(P!==true){G(this,Q,null);}return Q;},removeSelect:function M(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=H(this,R);if(P!==true){G(this,null,Q);}return Q;},_set_selectedIndices:function(S,Q,P){if(this.selectedIndices===Q){return false;}var R=A(this,Q);if(R.add.length||R.rmv.length){if(P!==true){G(this,R.add,R.rmv);}}return false;},_set_selectedIndex:function(S,Q,P){var R={};if(Q>-1){R[Q]=true;}return this._set_selectedIndices(null,R,P);},_set_selectedItem:function(W,T,S){var R=T&&(typeof T==="object"),V=this.itemIdField,Q=-1,U=this.items;if(R&&V!=null){Q=K.find(U,V,T[V]);}else{if(T!=null){Q=K.indexOf(U,T);}}if((Q===-1)&&(T!=null)&&this.allowUnlistedValues){var P=this.insertUnlistedValuesAt;if(P==null||P<0){P=(U&&U.length)||0;}Q=P;this.add([T],Q);}return this._set_selectedIndex(null,Q,S);},initSelections:function C(T,Q,P,S,R){if(!this.selectedIndices){this.selectedIndices={};this.selectedIndex=-1;}if(T){this._set_selectedIndices(null,T,R);}else{if(Q){this.select(Q,R);}else{if(S){this._set_selectedItem(null,S,R);}else{if(P!==null&&P!==undefined){this._set_selectedIndex(null,P,R);}}}}},sortSelectedIndices:function(){return D.keyarray(this.selectedIndices,true).sort(K.numSorter);},removeSelectedItems:function(){var R=this.sortSelectedIndices(),P=R.length,S=R[P-1],Q=this.remove(R);S=Math.min(S+1-P,this.items.length-1);if(S>=0){this.singleSelect(S);}return Q;},getSelectedItems:function(){return K.get(this.items,this.sortSelectedIndices())||[];},setSelectedItems:function(Q,d){if(!Q||!Q.length){return ;}var S=this.items||[],t=this.itemIdField!=null?K.findMulti(S,this.itemIdField,Q):K.indexOfMulti(S,Q),V=Q.length,T=V-t.count,q=this.allowUnlistedValues,b=this.insertUnlistedValuesAt,X=(q&&(b>-1))?T:0;if(b<0){b=S.length;}var R=[],U=[],f=t.map;if(T&&q){var p=0,e;for(e=0;e<V;e++){if(f[e]==null){R.push(Q[e]);U.push(b+p++);}}this.add(R,b);}var W=[],h;for(h in f){var o=f[h];if(o>=b){o+=X;}W.push(o);}var r=W.concat(U),Y=this.addSelect(r,!d);if(!d){var Z=K.hash(Y),g=this.selectedIndices,a=[],l;for(l in g){if(!Z[l]){a.push(parseInt(l,10));}}var P=this.removeSelect(a,true);G(this,Y,P);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var I=mstrmojo.array,M=mstrmojo.hash;function J(U){if(U!==null){return(U.constructor!==Array)?[U]:U;}return null;}function F(e,c,Y){if(!c){return null;}var f=[],V=e.selectedIndices,U=e.allIdx,a=e.noneIdx;if(e.multiSelect&&(a>-1)&&(I.indexOf(c,a)>-1)){return f;}var X,Z,d=e.items,b=e.itemIdField,W=e.selectedItems,h;if(e.multiSelect&&(U>-1)&&(I.indexOf(c,e.allIdx)>-1)){for(X=0,Z=d.length;X<Z;X++){if(!V[X]){f.push(X);V[X]=true;e.selectedIndex=X;e.selectedItem=d[X];}}}else{for(X=0,Z=c.length;X<Z;X++){var g=c[X];if(!V[g]){V[g]=true;if(Y){f.push({idx:g,positions:Y});}else{f.push(g);}e.selectedIndex=g;h=e.selectedItem=d[g];if(W){W[h[b]]=h;}}}}return f;}function D(X,U){var W=[],Y=X.selectedIndices,Z=X.selectedItems,V;for(V in Y){delete Y[V];if(U){W.push({idx:parseInt(V,10),positions:U});}else{W.push(parseInt(V,10));}}X.selectedIndex=-1;X.selectedItem=null;if(Z){X.selectedItems={};}return W;}function T(e,d,Y){if(!d){return null;}var a=[],V=e.selectedIndices,g=I.indexOf,U=e.allIdx,b=e.noneIdx,c=e.itemIdField,W=e.selectedItems;if(e.multiSelect&&(((U>-1)&&(g(d,U)>-1))||((b>-1)&&(g(d,b)>-1)))){return D(e);}if(d.length>0&&V[U]){if(g(d,U)<0){d.push(U);}}var Z=d.length,X;for(X=0;X<Z;X++){var f=d[X];if(V[f]){delete V[f];if(Y){a.push({idx:f,positions:Y});}else{a.push(f);}if(W){delete W[e.items[f][c]];}if(e.selectedIndex===f){e.selectedIndex=-1;e.selectedItem=null;}}}return a;}function C(X,Y,V,U){if(U){return ;}if(this.raiseEvent){if((X&&X.length)||(Y&&Y.length)){try{this.raiseEvent({name:"selectionChange",added:X,removed:Y});}catch(W){T(this,X);F(this,Y);throw W;}}}}function B(V){var W=this.itemIdField,U=this.items;if(typeof V==="object"&&W){return I.find(U,W,V[W]);}return I.indexOf(U,V);}mstrmojo._ListSelections={multiSelect:false,allIdx:-1,noneIdx:-1,itemIdField:"",items:null,selectedIndices:null,selectedIndex:-1,selectedIndices_bindEvents:"selectionChange",selectedIndex_bindEvents:"selectionChange",selectedItem:null,selectedItem_bindEvts:"selectionChange",allowUnlistedValues:true,selectedItems:null,supportsIncFetch:false,init:function(U){this._super(U);if(this.supportsIncFetch&&this.itemIdField){this.selectedItems={};}if(!this.items){this.items=[];}if(!this.selectedIndices){this.selectedIndices={};if(this.selectedIndex>-1){this._set_selectedIndex("selectedIndex",this.selectedIndex,true);}else{if(this.selectedItem){this._set_selectedItem("selectedItem",this.selectedItem,true);}}}},addItems:function K(d){d=J(d);if(!d){return ;}var a=this.items,U=this.items.length,W=this.selectedItems,Y=[],V;a=this.items=a.concat(d);V=a.length;if(W){var Z=this.itemIdField,X,c;for(X=U;X<a.length;X++){c=a[X];if(W[c[Z]]){Y.push(X);}}}if(Y&&Y.length){F(this,Y);}if(V>U){var b=this.itemsContainerNode;if(b){b.innerHTML+=this._buildItemsMarkup(U,V-1).join("");}}},addSelectedItems:function S(U){this.selectItems(U,false);},setSelectedItems:function L(U){this.selectItems(U,true);},selectItems:function R(c,e){c=J(c);if(!c){return ;}if(e&&this.selectedItems){this.selectedItems={};}var W=this.selectedItems,a=this.itemIdField,U=[],Y=this.items.length,Z=[],V=this.allowUnlistedValues,d,b,X;for(X=0;X<c.length;X++){d=c[X];b=B.call(this,d);if(b<0){if(W===null){if(V){U.push(d);b=Y++;Z.push(b);}}else{W[d[a]]=d;}}else{Z.push(b);}}if(U.length>0){this.addItems(U);}if(Z.length>0){if(e){this.select(Z);}else{this.addSelect(Z);}}},unselectItems:function A(V){V=J(V);if(!V){return ;}var a=this.selectedItems,W=[],Z=this.itemIdField,Y,U,X;if(a===null){return ;}for(X=0;X<V.length;X++){Y=V[X];if(a){delete a[Y[Z]];}U=B.call(this,Y);if(U<0){W.push(U);}}if(W.length>0){this.removeSelect(W);}},getSelectedItems:function G(){if(this.selectedItems){return M.valarray(this.selectedItems);}return I.get(this.items,M.keyarray(this.selectedIndices,true));},singleSelect:function(V,W,U){if(V!==-1){this.select([V],W,U);}},singleSelectByField:function O(V,W,U){this.singleSelect(I.find(this.items,W,V),U);},toggleSelect:function Q(U){var W,V;if(this.selectedIndices[U]){V=T(this,[U]);}else{W=F(this,[U]);}C.call(this,W,V,[U]);},select:function(W,V,U){W=J(W);if(!W){return ;}var Y=D(this,U),a=F(this,W,U),X;if(this.selectionPolicy!=="reselect"){for(X=Y.length-1;X>=0;X--){var Z=I.indexOf(a,Y[X]);if(Z>-1){Y.splice(X,1);a.splice(Z,1);}}}C.call(this,a,Y,W,V);},rangeSelect:function H(V,U){var a=this.selectedIndex,Y=a,Z=this.allIdx,W=[],X;if(V===Z||this.selectedIndices[Z]){W.push(Z);}else{if(Y===-1&&this.selectedIndices){for(X in this.selectedIndices){Y=parseInt(X,10);break;}}Y=Y===-1?0:Y;if(Y>V){Y=V;V=a;}for(X=Y;X<=V;X++){W.push(X);}}this.select(W,U);this.selectedIndex=a;},clearSelect:function(U){C.call(this,null,D(this),[],U);if(!U){this.raiseEvent({name:"clearSelection"});}},addSelect:function(X,U,V){X=J(X);if(!X){return ;}var W=F(this,X,V),Z=null,Y=this.noneIdx;if(this.multiSelect&&(Y>-1&&I.indexOf(X,Y)>-1)){Z=T(this,X);}C.call(this,W,Z,X,U);},removeSelect:function(W,U,V){W=J(W);if(!W){return ;}C.call(this,null,T(this,W,V),W,U);},_set_selectedIndices:function P(W,c,U){if(this.selectedItems){this.selectedItems={};}var V=this.selectedIndices;if(V===c){return false;}if(!V){V={};this.selectedIndices=V;}if(!c){c={};}var a=this.selectedIndex,Z=[],b;for(b in V){if(!c[b]){b=parseInt(b,10);delete V[b];Z.push(b);if(a===b){this.selectedIndex=-1;this.selectedItem=null;}}}var f=[],d=this.items,Y=this.itemIdField,e;for(b in c){if(!V[b]){b=parseInt(b,10);V[b]=true;f.push(b);this.selectedIndex=b;e=this.selectedItem=d[b];if(this.selectedItems){this.selectedItems[e[Y]]=e;}}}if(U!==true){var X=[];for(b in c){if(V[b]){b=parseInt(b,10);X.push(b);}}C.call(this,f,Z,X);}return(f.length||Z.length);},_set_selectedIndex:function N(X,V,U){var W={};if(V>-1){W[V]=true;}return this._set_selectedIndices("selectedIndices",W,U);},_set_selectedItem:function E(X,W,V){var U=B.call(this,W);if((U<0)&&(W!==null&&W!==undefined)&&this.allowUnlistedValues&&this.items){this.set("items",this.items.concat(W));U=this.items.length-1;}return this._set_selectedIndex("selectedIndex",U,V);},_addSelections:function(U){return F(this,U);},_removeAll:function(){return D(this);}};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var B=mstrmojo.array;function A(C){if(C.parent){if(C.parent.shouldEllipsizeChildren===undefined){mstrmojo.mixin(mstrmojo._HasEllipsis,C.parent);}C.parent.set("shouldEllipsizeChildren",true);}}mstrmojo._HasEllipsis=mstrmojo.provide("mstrmojo._HasEllipsis",{shouldEllipsize:false,shouldEllipsizeChildren:false,doEllipsize:function(){if(this.shouldEllipsizeChildren){B.forEach(this.children,function(D,C){if(D.hasRendered&&D.doEllipsize){D.doEllipsize();}});}},onshouldEllipsizeChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsize,this.shouldEllipsizeChildren);},onshouldEllipsizeChildrenChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsizeChildren,this.shouldEllipsize);},_onEllipsizeFlagChange:function(D,C){if(D&&!C){A(this);this.markupMethods=mstrmojo.mixin({onvisibleChange:function(){if(this._super){this._super();}if(this.visible&&this.hasRendered){this.doEllipsize();}}},mstrmojo.hash.copy(this.markupMethods));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var N=/\{\@(en@)?([^\}]+)\}/gm,J=/\</gm,R=/\>/gm,E=/\S/,Q=["$","^","=","!",":","/",".","*","+","?","|","(",")","[","]","{","}","\\"],F=new RegExp("(\\"+Q.join("|\\")+")","g"),S={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;",u0009:"&#x09;","\n":"&#x0A;","\r":"&#x0D;",'"':"&quot;"},C={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;"," ":"&nbsp;","\n":"<br/>","\r":"&nbsp;&nbsp;&nbsp;&nbsp;","'":"&#039;",'"':"&quot;"},M={"&amp;":"&","&lt;":"<","&gt;":">","&nbsp;":" ","<br/>":"\n","&nbsp;&nbsp;&nbsp;&nbsp;":"\r","&#039;":"'","&quot;":'"'},D={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#039;",'"':"&quot;","\u20ac":"&#8364;"},K={"&amp;":"&","&lt;":"<","&gt;":">","&#039;":"'","&quot;":'"',"&#8364;":"\u20ac"};var L=function(V){if(V===null){return"null";}var W=typeof V;if(W!=="object"){return W;}if(V.length===undefined){return"object";}return"array";};var T={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};mstrmojo.string=mstrmojo.provide("mstrmojo.string",{multiReplace:function G(W,Z,Y){var V;Y=Y||[];if(!W){return"";}var X=[];for(V in Z){if(mstrmojo.array.indexOf(Y,V)===-1){X.push(V.k||V);}}return W.replace(new RegExp(X.join("|"),"g"),function(a){var b=Z[a];return b.v||b;});},trim:function P(V){return(V&&V.replace)?V.replace(/^\s+/,"").replace(/\s+$/,""):V;},startsWith:function U(W,V){return W.length>=V.length&&W.substring(0,V.length)==V;},ellipsize:function A(X,W){var V=this.trim(X.substr(0,(W||1)-1));if(V!==X){V+="&hellip;";}return V;},isEmpty:function I(V){return(V===null)||(V===undefined)||!(E.test(V));},regEscape:function O(V){return V.replace(F,"\\$1");},encodeXMLAttribute:function(V){return mstrmojo.string.multiReplace(V,S);},encodeHtmlString:function(W,V,X){if(!W||!W.replace){return W;}if(X){return mstrmojo.string.multiReplace(W,D);}return mstrmojo.string.multiReplace(W,C,V?[" "]:[]);},decodeHtmlString:function(W,V){return V?mstrmojo.string.multiReplace(W,K):mstrmojo.string.multiReplace(W,M);},htmlAngles:function(V){if(!mstrmojo.string.isEmpty(V)){V=String(V);return V.replace(J,"&lt;").replace(R,"&gt;");}return V;},apply:function H(V,X){if(!V){return"";}var W=this;return V.replace(N,function Y(b,c,d){var Z;try{Z=mstrmojo.hash.walk(d,X);}catch(a){}Z=(Z===null||Z===undefined)?"":Z;return(!!c)?W.encodeHtmlString(Z,true):Z;});},json2xml:function(V,k,l){if(!(k instanceof Array)){k=[k];}var W=l&&l.isSerializable,j=(l.convertBoolean!==false),o=l&&l.skipFunctions,h,b;var d=[],Z=[],c,Y,a;for(h=0,b=k.length;h<b;h++){var g=k[h];for(c in g){if(o&&typeof g[c]==="function"){continue;}if(W){var m=W(c,k,h);if(m!==true){if(m===false){continue;}else{if(m.att){d.push(m.att);}if(m.child){Z.push(m.child);}continue;}}}Y=g[c];a=L(Y);switch(a){case"array":var e,f;Z.push("<"+c+">");for(e=0,f=Y.length;e<f;e++){var X=l.getArrItemName(c,Y,e)||e;Z.push(this.json2xml(X,Y[e],l));}Z.push("</"+c+">");break;case"object":Z.push(this.json2xml(c,Y,l));break;case"string":d.push(c+'="'+mstrmojo.string.encodeXMLAttribute(Y)+'"');break;case"boolean":d.push(c+'="'+(j?(Y?"-1":"0"):Y)+'"');break;case"null":if(!l.skipNull){d.push(c+'="'+l.nullValue+'"');}break;default:d.push(c+'="'+Y+'"');break;}}}return"<"+V+" "+d.join(" ")+">"+Z.join("")+"</"+V+">";},escape4HTMLText:function B(c){if(!c||!c.replace){return c;}var Z=/"/gm;var X="&quot;";var d=/&/gm;var b="&amp;";var a=/</gm;var V="&lt;";var Y=/>/gm;var W="&gt;";return c.replace(d,b).replace(Z,X).replace(a,V).replace(Y,W);},parseUri:function(Z,W){W=W||T;var V=W.parser[((W.strictMode)?"strict":"loose")].exec(Z),Y={},X=14;while(X--){Y[W.key[X]]=V[X]||"";}Y[W.q.name]={};Y[W.key[12]].replace(W.q.parser,function(b,a,c){if(a){Y[W.q.name][a]=c;}});return Y;},removeSpecialChars:function(V){return V.replace(/[^a-zA-Z0-9]/g,"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.array");var G=mstrmojo.array,E=mstrmojo.desc(2412,"Default"),H=mstrmojo.desc(3433,"Font"),B=mstrmojo.desc(3434,"Number"),C=mstrmojo.desc(3435,"Alignment"),A=mstrmojo.desc(2886,"Borders"),F=mstrmojo.desc(3905,"Background");var L=[{n:E,v:"pru"}];G.forEach(["Arial","Arial Black","Arial Narrow","Arial Unicode MS","Batang","Book Antiqua","Bookman Old Style","Comic Sans MS","Courier New","Garamond","Haettenschweiler","Helvetica","Impact","Lucida Console","Lucida Sans Unicode","Map Symbols","Marlett","Monotype Corsiva","Monotype Sorts","MS Gothic","MS Outlook","Microsoft Sans Serif","MT Extra","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings"],function(M){L.push({n:M,v:M});});function K(N,M,O){return(M&&M>=N)?K(N,M-O,O).concat(M):[];}var J=K(2,12,1);J=J.concat(K(14,24,2));J=J.concat(K(36,48,12));J=J.concat(K(72,72,1));var D=[{n:E,v:"pru"}];G.forEach(J,function(M){D.push({n:String(M),v:String(M)});});mstrmojo._FormatDefinition={Formats:[{n:H},{n:B},{n:C},{n:mstrmojo.desc(3436,"Color and Lines")}],FormatTarget:[{n:mstrmojo.desc(7942,"Element Header"),v:1,p:"header_format"},{n:mstrmojo.desc(7943,"Element Value"),v:2,p:"grid_format"},{n:mstrmojo.desc(7944,"Individual Items Header"),v:3,p:"child_header_format"},{n:mstrmojo.desc(7945,"Individual Items Value"),v:4,p:"child_grid_format"}],MetricFormatTarget:[{n:mstrmojo.desc(9710,"Metric Headers"),v:1,p:"header_format"},{n:mstrmojo.desc(9711,"Metric Values"),v:2,p:"grid_format"}],MetricValueFormats:[{n:B},{n:C},{n:H},{n:A},{n:F}],MetricHeaderFormats:[{n:B},{n:C},{n:H},{n:A},{n:F},{n:mstrmojo.desc(12139,"Chart")}],NumberFormatCategory:{Automatic:-3,Default:-2,General:9,Fixed:0,Currency:1,Date:2,Time:3,Percentage:4,Fraction:5,Scientific:6,Custom:7},DefaultFormat:{FormattingAlignment:{Horizontal:"1",Vertical:"1",TextWrap:"0",TextDirection:"0"},FormattingBorder:{HInsideStyle:"1",VInsideStyle:"1",TopStyle:"1",LeftStyle:"1",BottomStyle:"1",RightStyle:"1",HInsideColor:"0",VInsideColor:"0",TopColor:"0",LeftColor:"0",BottomColor:"0",RightColor:"0",Border3DStyle:"0",Border3DWeight:"0",Border3DBottomColor:"0",Border3DLeftColor:"0",Border3DRightColor:"0",Border3DTopColor:"0"},FormattingFont:{Name:"Arial",Bold:"0",Italic:"0",Size:"10",Strikeout:"0",Underline:"0",Color:"0",Script:"0"},FormattingNumber:{Category:"9",DecimalPlaces:"0",ThousandSeparator:"-1",CurrencySymbol:"$",CurrencyPosition:"0",Format:"General",NegativeNumbers:"3"},FormattingPadding:{LeftPadding:"1",RightPadding:"1",TopPadding:"1",BottomPadding:"1",LineSpacing:"0"},FormattingPatterns:{FillColor:"16777215",PatternColor:"8650752",PatternStyle:"1",FillStyle:"0",ApplyToGraphThreshold:"0",GradientColor:"16777215",GradientAngle:"0",GradientXOffset:"0",GradientYOffset:"0",SelectorSelectionColor:"16167264",SelectorSelectionFillStyle:"0",SeriesFillColor:"pru",SeriesPatternColor:"8650752",SeriesPatternStyle:"1",SeriesFillStyle:"0",SeriesApplyToGraphThreshold:"0",SeriesGradientColor:"16777215",SeriesGradientAngle:"0",SeriesGradientXOffset:"0",SeriesGradientYOffset:"0",SeriesSelectorSelectionColor:"16167264",SeriesSelectorSelectionFillStyle:"0"}},Families:L,Sizes:D,SizesInVI:D.slice(7,19),Styles:[{n:E,v:"pru"},{n:mstrmojo.desc(3440,"Regular"),v:"0,0"},{n:mstrmojo.desc(2718,"Bold"),v:"-1,0",v2:"-1,"},{n:mstrmojo.desc(2719,"Italic"),v:"0,-1",v2:",-1"},{n:mstrmojo.desc(3441,"Bold Italic"),v:"-1,-1"}],Effects:[{n:"Underline",v:0},{n:"Strike",v:1}],Category:[{n:E,v:-2},{n:mstrmojo.desc(2378,"General"),v:9},{n:mstrmojo.desc(2050,"Fixed"),v:0},{n:mstrmojo.desc(2051,"Currency"),v:1},{n:mstrmojo.desc(2052,"Date"),v:2},{n:mstrmojo.desc(2170,"Time"),v:3},{n:mstrmojo.desc(2053,"Percentage"),v:4},{n:mstrmojo.desc(2054,"Fraction"),v:5},{n:mstrmojo.desc(2055,"Scientific"),v:6},{n:mstrmojo.desc(2056,"Custom"),v:7}],MaxNegativeDidigts:30,FixedNegative:[{n:"-1,234.12",v:1,f:"#,##0.00"},{n:"-1,234.12",r:true,v:5,f:"#,##0.00;[RED]-#,##0.00"},{n:"1,234.12",r:true,v:2,f:"#,##0.00;[RED]#,##0.00"},{n:"(1,234.12)",v:3,f:"#,##0.00;(#,##0.00)"},{n:"(1,234.12)",r:true,v:4,f:"#,##0.00;[RED](#,##0.00)"}],CurrencyNegative:[{n:"-$1,234.12",v:1,f:'"$"#,##0.00'},{n:"-$1,234.12",r:true,v:5,f:'"$"#,##0.00;[RED]-"$"#,##0.00'},{n:"$1,234.12",r:true,v:2,f:'"$"#,##0.00;[RED]"$"#,##0.00'},{n:"($1,234.12)",v:3,f:'"$"#,##0.00;("$"#,##0.00)'},{n:"($1,234.12)",r:true,v:4,f:'"$"#,##0.00;[RED]("$"#,##0.00)'}],CurrencyPosition:[{n:mstrmojo.desc(2194,"Left"),v:0},{n:mstrmojo.desc(2195,"Right"),v:1},{n:mstrmojo.desc(2183,"Left with space"),v:2},{n:mstrmojo.desc(2182,"Right with space"),v:3}],Date:[{n:mstrmojo.desc(2231,"4/7"),v:"m/d"},{n:mstrmojo.desc(2232,"04/07"),v:"mm/dd"},{n:mstrmojo.desc(2233,"4/7/98"),v:"m/d/yy"},{n:mstrmojo.desc(2234,"04/07/98"),v:"mm/dd/yy"},{n:mstrmojo.desc(2235,"04/07/1998"),v:"mm/dd/yyyy"},{n:mstrmojo.desc(2236,"7-Apr"),v:"d-mmm"},{n:mstrmojo.desc(2237,"7-Apr-98"),v:"d-mmm-yy"},{n:mstrmojo.desc(2238,"Apr-98"),v:"mmm-yy"},{n:mstrmojo.desc(2239,"Apr '98"),v:"mmm 'yy"},{n:mstrmojo.desc(2240,"April 1998"),v:"mmmm yyyy"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2243,"April 7, 1998"),v:"mmmm d, yyyy"}],Time:[{n:mstrmojo.desc(2244,"15:41"),v:"h:mm"},{n:mstrmojo.desc(2245,"3:41 PM"),v:"h:mm AM/PM"},{n:mstrmojo.desc(2246,"15:41:46"),v:"h:mm:ss"},{n:mstrmojo.desc(2247,"3:41:46 PM"),v:"h:mm:ss AM/PM"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2250,"04/07/98 15:41"),v:"mm/dd/yy h:mm"},{n:mstrmojo.desc(2248,"04/07/98 3:41 PM"),v:"mm/dd/yy h:mm AM/PM"}],PercentNegative:[{n:"-12.12%",v:1,f:"0.00%"},{n:"-12.12%",r:true,v:5,f:"0.00%;[RED]-0.00%"},{n:"12.12%",r:true,v:2,f:"0.00%;[RED]0.00%"},{n:"(12.12%)",v:3,f:"0.00%;(0.00%)"},{n:"(12.12%)",r:true,v:4,f:"0.00%;[RED](0.00%)"}],Fraction:[{n:"12 1/3",v:"# ?/?"},{n:"37/3",v:"?/?"},{n:"12 26/81",v:"# ??/??"},{n:"998/81",v:"??/??"}],TextDirection:[{n:E,v:"pru"},{n:mstrmojo.desc(4601,"Horizontal"),v:0},{n:mstrmojo.desc(5156,"-90 Degree"),v:-90}],Horizontal:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2378,"General"),v:1},{n:mstrmojo.desc(2194,"Left"),v:2},{n:mstrmojo.desc(2193,"Center"),v:3},{n:mstrmojo.desc(2195,"Right"),v:4},{n:mstrmojo.desc(2068,"Justify"),v:6}],Vertical:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2256,"Top"),v:1},{n:mstrmojo.desc(2067,"Center"),v:2},{n:mstrmojo.desc(2257,"Bottom"),v:3}],TextWrap:[{v:0},{v:-1}],BorderStyles:[{n:E,v:"pru"},{n:mstrmojo.desc(2258,"None"),v:0},{n:mstrmojo.desc(2259,"Dashed"),v:3},{n:mstrmojo.desc(2260,"Dotted"),v:4},{n:mstrmojo.desc(2261,"Hair"),v:7},{n:mstrmojo.desc(2262,"Thin"),v:1},{n:mstrmojo.desc(2264,"Thick"),v:5},{n:mstrmojo.desc(2265,"Double"),v:6}],extractModel:function(O,Q,N){var S=N||this.DefaultFormat,R;for(R in O){var M=O[R];if(!M.attachEventListener){if(!mstrmojo.hash.isEmpty(M)){Q[R]=M;}}else{var P;for(P in M){if(S[R]&&S[R][P]){if(!Q[R]){Q[R]={};}Q[R][P]=M[P];}}}}},getAvailableFonts:function I(){var M={success:function(O){if(O.name==="fontPicker"){var N=[{n:E,v:"pru"}];mstrmojo.array.forEach(O.shortcuts,function(P){N.push({n:P.attributes[1].value,v:P.attributes[1].value});});mstrmojo._FormatDefinition.Families=N;}}};mstrmojo.xhr.request("POST",mstrConfig.taskURL,M,{taskId:"getSystemPickerJson",name:"fontPicker"},false,null,true);},getStandardFormat:function(N,M){var P=mstrmojo.hash.clone(M||this.DefaultFormat),O;N=N||{};for(O in P){N[O]=N[O]||{};}for(O in N){if(!N[O].attachEventListener){N[O]=mstrmojo.hash.make(N[O],mstrmojo.Obj);}}return N;},saveFormatModel:function(Q,W,N,X){var V=X||this.DefaultFormat,S,M;for(S=0;S<N.length;S++){var R=N[S],P=W[R]||null,U=Q[R];if(U===undefined){delete W[R];continue;}for(M in V){var T=V[M],O;if((!P&&!U)||(P&&!P[M]&&!U[M])){continue;}for(O in T){if(U[M]===undefined||U[M]===""||U[M][O]==="pru"||U[M][O]===undefined){if(P&&P[M]&&(P[M][O]!==undefined&&P[M][O]!==null&&P[M][O]!=="pru")){P[M][O]="pru";}}else{P=P||{};P[M]=P[M]||{};P[M][O]=U[M][O];}}}if(P){W[R]=P;}}}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var B=mstrmojo.hash;mstrmojo.Base=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Base",init:function A(C){B.copy(C,this);if(this.postApplyProperties){this.postApplyProperties();}}});}());mstrmojo.DPIManager={classes:[],registerClass:function registerClass(B,C,D,A){this.classes.push({c:B,d:C,s:D,v:A});},setDPI:function(){var A=mstrMobileApp.getDeviceDPI();mstrmojo.array.forEach(this.classes,function(B){B.c.prototype.layoutConfig[B.d][B.s]=B.v[A]+"px";});this.classes=[];}};(function(){document.msCSSOMElementFloatMetrics=true;mstrmojo.requiresCls("mstrmojo.hash");var S=mstrmojo.hash,H="containerNode",G="auto",Q="px";var I={v:G,c:undefined,sv:G};function E(c,f,e){var g=this._layoutWidgets[f],j=c.slot||H,h=g.f,i=g.p,d=(h&&h[j]!==undefined),b=(i&&i[j]!==undefined);if(j&&((!e&&d)||b)){return d?h[j]:(g.x*parseInt(i[j],10)/100)+Q;}return c[(f==="h")?"height":"width"];}function K(g,d,b){if(g.ignoreLayout){return ;}var c=(d===G)||d==="NaNpx",f=(b===G)||b==="NaNpx";var e=g.getLayoutOffsets&&g.getLayoutOffsets();if(e){if(!c){d=(parseInt(d,10)-e.h)+Q;}if(!f){b=(parseInt(b,10)-e.w)+Q;}}if(g.setDimensions){g.setDimensions(d,b);}else{if(g.set){if(!c){g.set("height",d);}if(!f){g.set("width",b);}}}}function Z(e){var c=this.children,g,k;for(g=0,k=(c&&c.length)||0;g<k;g++){var d=c[g],l=d.slot||H;if(l){var j=E.call(this,d,"h",e),m=E.call(this,d,"w",e);this.setSlotDimensions(l,j,m);K(d,j,m);var b=E.call(this,d,"h",e),f=E.call(this,d,"w",e);if(b!==j||f!==m){K(d,b,f);}this.setSlotDimensions(l,b,f);}}this.afterLayout();}function B(){var c=this.children,b=this._layoutWidgets;S.forEach(this.slotNames,function(g,i){if(!g||this.skipsSlotLayout(i)){return ;}var f=(b.h&&b.h.getSlotSizeInfo(i,c))||I,d=(b.w&&b.w.getSlotSizeInfo(i,c))||I,e=f.c||d.c;mstrmojo.array.forEach(e,function(h){K(h,f.v,d.v);});this.setSlotDimensions(i,f.sv,d.sv);},this);this.afterLayout();}function D(c){var b=this.layoutConfig.xt?B:Z;b.call(this,c);}function T(i,e,g){var h=i.slot||H,f=e&&e.a;if(!f||f[h]===undefined){return ;}var b=this[h]["offset"+g],c=f[h];if(b===c){return ;}e.x-=(b-c);f[h]=b;}function J(b){this.beforeLayout();var c=this._layoutWidgets,d=b.src;T.call(this,d,c.h,"Height");T.call(this,d,c.w,"Width");D.call(this,true);}function O(d,g){if(!d){return null;}var b=this.children,q=g.toLowerCase(),h=parseInt(this[q],10),k=h,m={},o={},f={},c={},n={},j,l,e,r,p;for(p in d){if(!d.hasOwnProperty(p)){continue;}r=d[p];if(r.match(/px$/)){h-=parseInt(r,10);m[p]=r;}else{if(r.match(/%$/)){o[p]=r;}else{if(r.match(/all/)){n[p]=k;}else{f[p]=r;}}}}if(!S.isEmpty(f)&&!S.isEmpty(o)){for(j=0,l=(b&&b.length)||0;j<l;j++){e=b[j];p=e.slot||H;if(p&&f[p]&&!e.ignoreLayout){if(e.hasRendered){c[p]=this[p]["offset"+g];h-=c[p];}else{c[p]=0;e.attachEventListener((e instanceof mstrmojo.Container)?"childrenRendered":"renderComplete",this.id,J);}}}}return{f:S.isEmpty(m)?undefined:m,p:S.isEmpty(o)?undefined:o,a:S.isEmpty(c)?undefined:c,n:S.isEmpty(n)?undefined:n,x:h,getSlotSizeInfo:function(z,u){if(!d[z]){return I;}var t=mstrmojo.array.filter(u,function(AB){var AA=AB.slot;return AA===z||(z===H&&!AA);}),x,y;var i=m[z];if(i){y=i;}var w=o[z];if(w){y=(this.x*parseInt(w,10)/100)+Q;}if(f[z]){y=c[z];if(y){y+=Q;}else{y=G;}x=G;}var v=n[z];if(v){y=x=v+Q;}y=y||"0px";return{v:y,c:t,sv:x||y};}};}function R(c){var b=this.domNode;if(!b||!this.layoutConfig){return ;}b.style[c]=this[c];this.doLayout();}mstrmojo._HasLayout=mstrmojo.provide("mstrmojo._HasLayout",{_mixinName:"mstrmojo._HasLayout",height:"auto",width:"auto",ignoreLayout:false,beforeLayout:mstrmojo.emptyFn,afterLayout:mstrmojo.emptyFn,layoutConfig:null,init:function V(b){this._super(b);this.layoutConfig=S.clone(this.layoutConfig);},preBuildRendering:function C(){var d=this.cssText||"";var b=this.height;if(b&&b!==G){d+="height:"+this.height+";";}var c=this.width;if(c&&c!==G){d+="width:"+this.width+";";}this.cssText=d;return(this._super)?this._super():true;},postBuildRendering:function W(){this.doLayout();return this._super();},modifyLayoutConfig:function Y(d,c){var b=this.layoutConfig=this.layoutConfig||{};b.h=S.copy(d,b.h);b.w=S.copy(c,b.w);this.doLayout();},getLayoutOffsets:mstrmojo.emptyFn,set:function P(d,b){var c=this._super(d,b);if(d==="visible"&&this._pendingLayoutOnVisible){delete this._pendingLayoutOnVisible;this.doLayout();}return c;},doLayout:function A(){var b=this.layoutConfig;if(!b||(this.height===G&&this.width===G)){return ;}if(b.xt){if(!this.visible){this._pendingLayoutOnVisible=true;return ;}}this.beforeLayout();this._layoutWidgets={h:O.call(this,b.h,"Height"),w:O.call(this,b.w,"Width")};D.call(this,false);this.widgetResized();},browserResized:function F(b){this.setDimensions(b.h,b.w);return true;},onwidthChange:function N(){R.call(this,"width");},onheightChange:function M(){R.call(this,"height");},skipsSlotLayout:function(b){return false;},adjustParentDimensions:function L(){var c=this.parent,b=c&&c._layoutWidgets;if(b){T.call(c,this,b.h,"Height");T.call(c,this,b.w,"Width");}},setDimensions:function U(e,c){var d=(e===G)||e==="NaNpx",f=(c===G)||c==="NaNpx";if((!d&&parseInt(this.height,10)!==parseInt(e,10))||(!f&&parseInt(this.width,10)!==parseInt(c,10))){if(!d){this.height=e;}if(!f){this.width=c;}var b=this.domNode,g=b&&b.style;if(g){if(!d){g.height=e;}if(!f){g.width=c;}this.doLayout();}return true;}return false;},setSlotDimensions:function X(e,d,c){var b=this[e]&&this[e].style;if(!b){return ;}if(d!==G&&d!==undefined&&d!=="NaNpx"&&b.height!==d&&parseInt(d)>=0){b.height=d;}if(c!==G&&c!==undefined&&c!=="NaNpx"&&b.width!==c&&parseInt(c)>=0){b.width=c;}}});mstrmojo._HasLayout.getSlotSize=function a(e,f){var c=e&&e.prototype.layoutConfig;if(c){var d=c.h,b=c.w;return{h:(d&&d[f])||undefined,w:(b&&b[f])||undefined};}return null;};}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var O=/this\.([\w\.\[\]\'\"\-]+)/m,D=/this\./m,M=/mstrmojo\.all\[[\'\"]([\w]+)[\'\"]\]\.([\w\.\[\]\'\"\-]+)/m,R=/mstrmojo\.all\[/m,L=/mstrmojo\.all\.([\w]+)\.([\w\.\[\]\'\"\-]+)/m,B=/mstrmojo\.all\./m,C=/\[(\d+)\]/g,E=/\[\'([\w\-]+)\'\]/g,P=/\[\"([\w\-]+)\"\]/g,H=/([\[\]].*)/;mstrmojo.Binding=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Binding",parent:null,source:null,destination:null,enabled:false,setter:"set",executing:0,init:function N(S){mstrmojo.hash.copy(S,this);mstrmojo.registry.add(this);},destroy:function F(){mstrmojo.publisher.clearSubscriptions(this.id);mstrmojo.registry.remove(this);},exec:function K(){this.executing++;var W=this._sourceFn;if(!W){var V=this.source;if(V!=null){if(typeof (V)=="string"){if(!(V.match("return "))&&!(V.match(/\;\s*\S/))){V="return "+V;}W=new Function(V);}else{if(typeof (V)=="function"){W=V;}}this._sourceFn=W;}}var S,X=this.parent;if(W){try{S=W.apply(X,[]);}catch(U){}}var T=this.setter,Y=this.destination;if(T==null){X[Y]=S;}else{if(typeof (T)=="string"){X[T](Y,S);}else{if(typeof (T)=="function"){T.apply(X,[Y,S]);}}}this.executing--;},enable:function A(){if(!this.enabled){this.exec();var T=this._chains;if(!T){this._parseChains();T=this._chains;}for(var S in T){this._attachChain(T[S]);}this.enabled=true;}},disable:function J(){if(this.enabled){var T=this._chains;if(T){for(var S in T){this._detachChain(T[S]);}}this.enabled=false;}},_chains:null,_parseChains:function(){this._chains={};var U=this._chains;var T=this.source;if(T&&(typeof (T)=="function")){T=T.toString&&T.toString();}if(!T){return ;}function S(b,e,V,X){var W=b,Z;while(Z=W.match(e)){var c=Z[0],a=c.length,d=true;c=c.replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"");for(var Y in U){if(Y.substr(0,a)===c){d=false;break;}else{if(c.indexOf(Y)===0){delete U[Y];}}}if(d){U[c]={host:(V==null)?null:Z[V],parts:Z[X].replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"").split(".")};}W=W.substr(Z.index+a);}}if(D.test(T)){S(T,O,null,1);}if(R.test(T)){S(T,M,1,2);}if(B.test(T)){S(T,L,1,2);}},_attachChain:function Q(S,U){if(!S.evt2idx){S.evt2idx={};}if(!S.idx2evt){S.idx2evt=[];}var d=S.evt2idx,g=S.idx2evt,Z=S.parts;var e=(U>=0)?U:0,b=this.id,W=mstrmojo.all,c=(U>0)?W[g[e-1].context][Z[e-1]]:(S.host?W[S.host]:this.parent),T=Z[e];var V=mstrmojo.array;while(c&&T){if(c.attachEventListener){var f=c[T+"_bindEvents"]||(T+"Change");if(typeof (f)=="string"){f=[f];}var Y=[];for(var a=0,X=f.length;a<X;a++){Y[a]=c.attachEventListener(f[a],b,"_callback");}for(var a=0;a<f.length;a++){d[c.id+"_"+f[a]]=e;}g[e]={context:c.id,evts:f,subs:Y};}c=c[T];T=S.parts[++e];}},_detachChain:function G(S,T){var U=mstrmojo.all,h=S.idx2evt,d=S.evt2idx,a=this.id;var Y=(T>-1)?T:0,b=h.length;if(Y<b){for(;Y<b;Y++){var Z=h[Y];if(!Z){break;}var W=Z.context,c=U[W],g=Z.evts;if(c&&c.detachEventListener){var k=Z.subs;for(var f=0,V=k.length;f<V;f++){c.detachEventListener(k[f]);}}h[Y]=null;for(var X=0,e=g.length;X<e;X++){delete d[W+"_"+g[X]];}}}},_callback:function I(T){this.exec();if(!T||!T.name||!T.src){return ;}var U=T.src.id+"_"+T.name,W=this._chains;for(var X in W){var V=W[X],S=V.evt2idx[U];if(S!=null){this._detachChain(V,S+1);this._attachChain(V,S+1);}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash");var A=mstrmojo.hash;mstrmojo.requiresDescs(2213,3326,3327,3329,4531,13283,13284,13285,13286);mstrmojo.ME.Enum={METRIC_ACTIONS:{ADD:"add",EDIT:"edit",EIDT_NEW:"editNew"},EDITOR_IDS:{ADVANCED:"mstrME",FORMULA:"mstrME",WIZARD:"mstrFE",SIMPLE:"mstrSME",SELECOTR:"mstrFSE"},EDITOR_TYPES:{ADVANCED:"ADVANCED",FUNCTION:"FUNCTION",SIMPLE:"SIMPLE",SELECTOR:"SELECTOR"},METRIC_EDIT_TYPES:{ADVANCED:65536,SIMPLE:131072,FUNCTION:196608},METRIC_TYPES:{65536:"ADVANCED",131072:"SIMPLE",196608:"FUNCTION"},NEW_METRIC_DEFINITION:{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}},getNewDefinition:function(){return{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}};},FBFlag:{Automatic:0,Manual:3},AFB:{Automatic:-1,False:0,True:1},SFB:{Automatic:-1,False:1,True:2},UI_OBJECT_TYPE:{Dimty:-1,Sub_Expression:-2,Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},UI_DATA_TYPE:{Sortby:-1,Breakby:-2,Level:-4,Condition:-5,Transformation:-6},SHORTCUT_FUNCTIONS:{Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},DYNAMIC_DIMTY:{CODES:{auto:{n:mstrmojo.desc(4531,"Automatic"),did:"@auto",t:-1},page:{n:mstrmojo.desc(3329,"Grand Total"),did:"@p",t:-1},byCol:{n:mstrmojo.desc(3326,"By Columns"),did:"@cols",t:-1},byRow:{n:mstrmojo.desc(3327,"By Rows"),did:"@rows",t:-1},byCell:{n:mstrmojo.desc(13283,"By Cell"),did:"@cell",t:-1},byShape:{n:mstrmojo.desc(13284,"By Shape"),did:"@shape",t:-1},downCross:{n:mstrmojo.desc(13285,"Down, Then Across"),did:"@cr",t:-1},crossDown:{n:mstrmojo.desc(13286,"Across, Then Down"),did:"@rc",t:-1}},getItems:function D(G){var F=this.CODES,E=[];switch(G){case"breakby":E=[F.auto,A.copy({n:mstrmojo.desc(2057,"None")},A.copy(F.page)),A.copy({n:mstrmojo.desc(122,"Columns")},A.copy(F.byCol)),A.copy({n:mstrmojo.desc(2968,"Rows")},A.copy(F.byRow)),A.copy({n:mstrmojo.desc(13399,"Cell")},A.copy(F.byCell)),A.copy({n:mstrmojo.desc(2923,"Shape")},A.copy(F.byShape))];break;case"level":E=[F.auto,F.page,F.byCol,F.byRow,F.byCell,F.byShape];break;case"sortby":E=[F.auto,F.downCross,F.crossDown];}return E;},getAutomaticDimtyObject:function C(){return A.copy(this.CODES.auto);},getDimtyObject:function B(E,H){var F=null;var G=false;if(H){A.forEach(mstrmojo.ME.Enum.DYNAMIC_DIMTY.CODES,function(I){if(I.did===E){F=A.copy(I);G=true;return false;}});}if(!G){F={n:E,t:-1,dimty:true};}return F;}},NonExposableParams:["IsNewOLAP","OLAPPattern","OLAPHasWindow"]};mstrmojo.ME.Enum.DEFAULT_MPS={mps:{afb:mstrmojo.ME.Enum.AFB.False,sfb:mstrmojo.ME.Enum.SFB.False,fbf:mstrmojo.ME.Enum.FBFlag.Automatic}};}());(function(){mstrmojo.requiresCls("mstrmojo.registry");mstrmojo._PagingList=mstrmojo.provide("mstrmojo._PagingList",{usePaging:false,page:0,totalPages:1,_set_page:function(B,A){if(this.page!==A&&this.usePaging){if(A>=0&&A<this.totalPages){this.page=A;}return true;}return false;},_inScroll:false,_inPaging:false,onscroll:function(){if(this.usePaging&&!this._inPaging){this._inScroll=true;this.set("page",this.listMapper.whichPage(this));this._inScroll=false;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash");var A=false,D="mstrmojo.Binding",I="bindings",H=mstrmojo.registry;function B(K){var L;for(L in K){var J=K[L];if(J&&J.disable){J.destroy();}}}function C(K,M){if(!A){mstrmojo.requiresCls(D);A=true;}var N;for(N in K){var J=K[N];if(J===null||J===undefined){continue;}var L=typeof J;if(L==="string"||L==="function"){J={destination:N,source:J,scriptClass:D};}J.parent=M;J=H.ref(J,{skipLoadChecks:true});K[N]=J;J.enable();}}mstrmojo._HasBindings=mstrmojo.provide("mstrmojo._HasBindings",{_meta_usesSuper:false,initBindings:function E(){this.hasInitBindings=true;var K=mstrmojo.hash.copy(this[I]);if(K){delete this[I];this._set_bindings(I,K);if(this.postCreateBindings){this.postCreateBindings();}}var M=this.children,J=(M&&M.length)||0;if(J){var L;for(L=0;L<J;L++){var N=M[L];if(N&&N.initBindings){N.initBindings();}}}},destroyBindings:function G(){var J=this.bindings;if(J){B(J);delete this.bindings;}},_set_bindings:function F(L,J){var K=this[I];if(J!==K){if(K){B(K);}this[I]=J;if(J){C(J,this);}return true;}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.array","mstrmojo.publisher");var D=mstrmojo.registry,K=mstrmojo.array,I=mstrmojo.publisher;function G(Q,R){if(R){R.parent=Q;var P=D.ref(R);if(R!==P){delete R.parent;}return P;}return null;}function L(Q,R){var P=R.alias;if(P!==null&&P!==""){Q[P]=R;}}function N(Q,R){var P=R.alias;if(R.parent===Q){delete R.parent;}if((P!==null&&P!=="")&&(Q[P]===R)){delete Q[P];}}function A(T,Q){var P=Q&&Q.length,S,R;if(P){S=[];for(R=0;R<P;R++){var U=G(T,Q[R]);if(!U){continue;}S.push(U);L(T,U);}}return S;}mstrmojo._HasChildren=mstrmojo.provide("mstrmojo._HasChildren",{_meta_usesSuper:false,children:null,postCreateChildren:mstrmojo.emptyFn,onaddChild:null,onremoveChild:null,initChildren:function F(){var P="children",Q=this[P];if(!Q){return ;}this[P]=null;this._set_children(P,Q,true);this.postCreateChildren();},_set_children:function E(S,Q,P){var R=this.children;if(Q!==R){if(R){this.removeChildren(null,P);}this.addChildren(Q,0,P);}return false;},destroyChildren:function C(S){var R=this.children,P=(R&&R.length)||0,Q;if(P){for(Q=P-1;Q>-1;Q--){var T=R[Q];if(T&&T.destroy){T.destroy(S);if(!S){N(this,T);}}}if(!S){R.length=0;}}},invalidateChildren:function B(){mstrmojo.array.forEach(this.children,function(P){P.invalidate();});},invalidate:function H(){this.invalidateChildren();},addChildren:function O(U,Q,R){if(!U){return U;}var T=U.constructor===Array,P=A(this,T?U:[U]);if(P&&P.length){var S=this.children||[];if(Q===null||Q===undefined){Q=S.length;}this.children=K.insert(S,Q,P);if(!R&&(this.onaddChild||I.hasSubs(this.id,"addChild"))){this.raiseEvent({name:"addChild",value:P,index:Q});}}return T?P:(P&&P[0]);},removeChildren:function J(V,R){var T=this.children,U=V?[V]:(this.children||[]).concat(),Q=U.length,P=-1,S;if(Q){for(S=Q-1;S>-1;S--){N(this,U[S]);}if(V){P=K.removeItem(T,V);}else{if(T){T.length=0;P=0;}}if(!R&&(this.onremoveChild||I.hasSubs(this.id,"removeChild"))){this.raiseEvent({name:"removeChild",value:U,index:P});}}return P;},removeAndDestroyChild:function M(R,P,Q){if(R){if(R.parent!==this){throw"Unable to remove an object that is not in the children collection.";}this.removeChildren(R,P);R.destroy(Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.locales");var c=mstrmojo.array,P=mstrmojo.meta.TP,G=mstrmojo.meta.STP,O=mstrmojo.hash,F={ANDOR:14,MQ:10,MC:12,AQ:2,AL:6,AC:9,AE:5,F:13,R:21,B:20,XML:1,RLS:15},B={};var W;for(W in F){B[F[W]]=true;}var a={};a[F.AQ]="a";a[F.AL]="a";a[F.AC]="a";a[F.AE]="a";a[F.MQ]="m";a[F.MC]="m";a[F.F]="f";a[F.R]="r";a[F.XML]="p";var K={};K[F.MQ]=["not","m","fn","fnt","cs","dmy","idcsi"];K[F.MC]=["not","m","fn","fnt","m2","m3","p","dmy","idcsi"];K[F.AE]=["not","a","fn","es","a2","fm2","p"];K[F.AQ]=["not","a","fm","fn","cs"];K[F.AL]=["not","a","fm","fn","cs"];K[F.AC]=["not","a","fm","a2","fm2","a3","fm3","fn","cs"];K[F.R]=["not","r"];K[F.F]=["not","f"];K[F.XML]=["not","n","p"];var M={};M[F.MQ]="METRIC_FNS";M[F.MC]="METRIC_FNS";M[F.AQ]="FORM_FNS";M[F.AL]="FORM_FNS";M[F.AC]="FORM_FNS";M[F.AE]="ELEM_FNS";var N={FILTER:1,REPORT:3,METRIC:4,FOLDER:8,PROMPT:10,FUNCTION:11,ATTR:12,FACT:13,DIM:14,FORM:21,ROLE:43,CONS:47},b={FILTER:256,CUSTOMGROUP:257,PROMPT:2560,PROMPT_BOOLEAN:2561,PROMPT_LONG:2562,PROMPT_STRING:2563,PROMPT_DOUBLE:2564,PROMPT_DATE:2565,PROMPT_OBJECTS:2566,PROMPT_ELEMENTS:2567,PROMPT_EXPRESSION:2568,PROMPT_EXPRESSION_DRAFT:2569,PROMPT_DIMTY:2570,PROMPT_BIGDECIMAL:2571,REPORT_GRID:768,REPORT_GRAPH:769,REPORT_ENGINE:770,REPORT_TEXT:771,REPORT_DATAMART:772,REPORT_BASE:773,REPORT_GRIDGRAPH:774,REPORT_NONINTERACTIVE:775,REPORT_CUBE:776,REPORT_EMMACUBE:779,CONS:12032,NDE:12033},T={a:N.ATTR,a2:N.ATTR,m:N.METRIC,m2:N.METRIC,r:N.REPORT,f:N.FILTER,p:N.PROMPT},U={f:b.FILTER};var V={};V[F.MQ]=N.METRIC;V[F.MC]=N.METRIC;V[F.AQ]=N.ATTR;V[F.AL]=N.ATTR;V[F.AC]=N.ATTR;V[F.AE]=N.ATTR;V[F.F]=N.FILTER;V[F.R]=N.REPORT;var J=function(d){var H=d.length,g={},e;for(e=0;e<H;e++){var h=d[e];g[h.did]=h.n;}return g;},E=function(e){var H=e.length,f;for(f=0;f<H;f++){var d=e[f];if("tp" in d){d.t=d.tp;}}return e;},X=function(e,g){var H=e.length,f;for(f=0;f<H;f++){var d=e[f];if("tp" in d){if(g){d.t=g;}else{delete d.t;}}}return e;},Z=function(d,f){if(!f){f=[];}f.length=0;var e,H;for(e=0,H=d.length;e<H;e++){f[e]=d[e];}return f;},L={0:[{did:"1,76"},{did:"1,79"},{did:"1,77"},{did:"1,80"},{did:"1,78"},{did:"1,81"},{did:"1,18"},{did:"1,43"}],1:[{did:"2,1"},{did:"2,2"},{did:"3,1"},{did:"3,2"}]};var R={0:[{did:"1,22"},{did:"1,57"}]};mstrmojo.expr=mstrmojo.provide("mstrmojo.expr",{ET:F,ETs:B,ET2TGT:a,ET2COND:K,ET2TP:V,FN:{EQUAL:6,NOT_EQUAL:7,GREATER:8,LESS:9,GREATER_EQUAL:10,LESS_EQUAL:11,IN_LIST:22,NOT_IN_LIST:57,BETWEEN:17,NOT_BETWEEN:44,IS_NULL:54,IS_NOT_NULL:55,AND:19,OR:20,NOT:21,SEARCH:158},FN_MRP:{BETWEEN:3,EXCLUDE_TOP:4,EXCLUDE_BOTTOM:5,BETWEEN_DESCENDING:13},FNT:{DEF:1,RANK:2,PER:3},FN_SEP:",",TP:N,STP:b,DMY_TP:{ATTR:-1,DIM:-2},DTP:{UNKNOWN:-1,INTEGER:1,UNSIGNED:2,NUMERIC:3,DECIMAL:4,REAL:5,DOUBLE:6,FLOAT:7,CHAR:8,VARCHAR:9,LONGVARCHAR:10,BINARY:11,VARBIN:12,LONGVARBIN:13,DATE:14,TIME:15,TIMESTAMP:16,SHORT:21,LONG:22,MBCHAR:23,BOOLEAN:24,PATTERN:25,BIGDECIMAL:30},BFTP:{RESERVED:0,HIDDEN:-1,DATETIME:1,NUMBER:2,TEXT:3,PICTURE:4,URL:5,EMAIL:6,TAG:7,DATE:8,TIME:9,SYMBOL:10,BIGDECIMAL:11,PHONENUMBER:12},METRIC_DTP:3,FN_DTP:{NUM:0,CHAR:1,DATE:2},DTP2PROMPT_STP:{"-1":b.PROMPT,1:b.PROMPT_LONG,2:b.PROMPT_LONG,3:b.PROMPT_LONG,4:b.PROMPT_DOUBLE,5:b.PROMPT_DOUBLE,6:b.PROMPT_DOUBLE,7:b.PROMPT_DOUBLE,8:b.PROMPT_STRING,9:b.PROMPT_STRING,10:b.PROMPT_STRING,14:b.PROMPT_DATE,15:b.PROMPT_DATE,16:b.PROMPT_DATE,21:b.PROMPT_LONG,22:b.PROMPT_LONG,23:b.PROMPT_STRING,24:b.PROMPT_BOOLEAN,30:b.PROMPT_BIGDECIMAL},DTP2FN_DTP:{"-1":0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1,9:1,10:1,11:0,12:0,13:0,14:0,15:0,16:0,21:0,22:0,23:1,24:0,25:1,30:0,34:0},fnCstCount:function A(e,d){var g=this.FN,h=this.FN_MRP,H=this.FNT;if(d===H.DEF||d===undefined){switch(e){case g.BETWEEN:case g.NOT_BETWEEN:return 2;case g.IS_NULL:case g.IS_NOT_NULL:return 0;}}else{if(d===H.PER||d===H.RANK){switch(e){case h.BETWEEN:case h.BETWEEN_DESCENDING:return 2;}}}return 1;},fn_List:function S(d,H){var e=this.FN;return d==e.IN_LIST||d==e.NOT_IN_LIST;},fn_AC_MC:function Y(d,H){var e=this.FN;return(d==e.EQUAL)||(d==e.NOT_EQUAL)||(d==e.GREATER)||(d==e.LESS)||(d==e.GREATER_EQUAL)||(d==e.LESS_EQUAL);},fnName:function Q(h,g,d,f){var H=this[M[h]];if(H&&H.constructor===Object){H=H[this.DTP2FN_DTP[f]]||H["*"];}if(h===F.MQ){H=H.concat(mstrmojo.locales.expression.MetricRP);}var e=c.find(H,"did",(d||1)+this.FN_SEP+g);if(e>-1){return H[e].n;}return"";},findTargets:function I(n,f,p){if(!p){p={};}if(n){var m;for(m in T){var y=n[m];if(y){if(!y[P]){y[P]=T[m];}if(!y[G]&&U[m]){y[G]=U[m];}p[y[f]]=y;}}if(n.dmy){var j=this.TP.ATTR,q=this.DMY_TP.ATTR,e=n.dmy.uts,x,d;for(x=0,d=(e&&e.length)||0;x<d;x++){var l=e[x];if(l&&l.utp===q){var g=l.utgt;if(!g.t){g.t=j;}p[g[f]]=g;}}}var H=n.nds,o,v;for(o=0,v=(H&&H.length)||0;o<v;o++){this.findTargets(H[o],f,p);}var r=n.cs,w=r&&r.length;if(w){for(o=0;o<w;o++){this.findTargets(r[o],f,p);}}}return p;},onLocaleUpdated:function(){var d=mstrmojo.locales.expression,H=mstrmojo.expr;H.BRANCH_FNS=O.copy(J(d.BranchQual),H.BRANCH_FNS);H.ELEM_FNS=Z(X(d.Element,"fn"),H.ELEM_FNS);H.METRIC_FNS={"*":X(c.filter(d.Metric.concat(d.MetricRP),function(e){return e.did&&(c.find(R["0"],"did",e.did)<0);}))};H.FORM_FNS={0:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["0"],"did",e.did)<0);})),1:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["1"],"did",e.did)<0);})),2:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["0"],"did",e.did)<0)&&(c.find(L["1"],"did",e.did)<0);}))};H.DIMTYLEVELS=Z(X(d.DimtyLevels),H.DIMTYLEVELS);},getSortedObjectsByTypeGroup:function D(f){var H=0,d=1,e=2;function g(h){switch(h.t){case N.METRIC:return d;case N.ATTR:case N.DIM:case N.CONS:return H;case N.FILTER:return h.st===b.CUSTOMGROUP?H:e;default:return e;}}return f.slice(0).sort(function(l,k){var m=g(l)-g(k);if(m){return m;}var j=l.n.toUpperCase(),i=k.n.toUpperCase(),h=j.localeCompare(i);if(h){return h;}return l.n.localeCompare(k.n);});},mapBaseFormTypeToDataType:function C(e){e=parseInt(e);if(e===NaN){return -1;}var d=this.BFTP,H=this.DTP;switch(e){case d.DATETIME:return H.TIMESTAMP;case d.DATE:return H.DATE;case d.TIME:return H.TIME;case d.NUMBER:return H.REAL;case d.TEXT:return H.CHAR;case d.BIGDECIMAL:return H.BIGDECIMAL;default:return H.CHAR;}}});mstrmojo.expr.onLocaleUpdated();}());(function(){mstrmojo.requiresCls("mstrmojo.locales");var X=function(){return mstrmojo.locales.datetime;},L=mstrmojo.string;mstrmojo.date=mstrmojo.provide("mstrmojo.date",{monthNumbers:{Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12},REGEXPS:{DATES:{},TIMES:{}},CACHE:{PARSEDATE:{CONTAINS:{},EQUALS:{}},PARSETIME:{CONTAINS:{},EQUALS:{}}},now:Date.now||function D(){return new Date().getTime();},isDate:function Y(b,f,a){var d=this.parseDate(b,a);var e=!!(d&&this.doesDateExist(d.month,d.day,d.year));if(f){if(e){var c=this.formatDateInfo(d,X().DATEOUTPUTFORMAT);if(a){return{match:d.match,formatted:c};}return c;}return null;}return !!e;},formatDateInfo:function R(d,f){if(!f){return"";}var a=d.day,e=d.month,c=d.year;var b=f.replace(/dd/g,this.formatInteger(a,2)).replace(/d/g,Number(a)).replace(/yyyy/g,Number(c)).replace(/yy/g,this.formatInteger(Number(c)%100,2)).replace(/MMM/g,"~~~~").replace(/MM/g,"@@").replace(/M/g,"^").replace(/MMMM/g,X().MONTHNAME_FULL[Number(e)-1]).replace(/\~\~\~\~/g,X().MONTHNAME_SHORT[Number(e)-1]).replace(/\@\@/g,this.formatInteger(e,2)).replace(/\^/g,Number(d.month));return b;},parseDate:function Z(l,f,j){if(l==null){return false;}if(typeof l!=="string"){l=String(l);}l=L.trim(l);var a=this.CACHE.PARSEDATE[f?"CONTAINS":"EQUALS"],c=a[l];if(c||(c===null)){return c;}var b=null;var h;if(j){h=[j];}else{h=[].concat(X().DATEINPUTFORMATS);h.unshift(X().DATEOUTPUTFORMAT);}var d,e;for(d=0,e=h.length;d<e;d++){var g=this._buildRegExp4DateFormat(h[d]),k=g&&l.match(f?g.reContains:g.reEquals);if(k){b={match:k[0],year:g.yearIndex&&this.fourDigitYear(k[g.yearIndex]),day:g.dayIndex&&parseInt(Number(k[g.dayIndex]),10),month:g.monthIndex&&this.numericMonth(k[g.monthIndex])};break;}}a[l]=b;return b;},isTime:function I(b,e,a){var f=this.parseTime(b,a);var d=!!(f&&this.doesTimeExist(f.hour,f.min,f.sec));if(e){if(d){var c=this.formatTimeInfo(f,X().TIMEOUTPUTFORMAT);if(a){return{match:f.match,formatted:c};}return c;}return null;}return !!d;},parseTime:function J(m,f,k){if(m==null){return false;}if(typeof m!=="string"){m=String(m);}m=L.trim(m);var a=this.CACHE.PARSETIME[f?"CONTAINS":"EQUALS"],c=a[m];if(c||(c===null)){return c;}var b=null;var j;if(k){j=[k];}else{j=[].concat(X().TIMEINPUTFORMATS);j.unshift(X().TIMEOUTPUTFORMAT);}var d,e;for(d=0,e=j.length;d<e;d++){var h=this._buildRegExp4TimeFormat(j[d]),l=h&&m.match(f?h.reContains:h.reEquals);if(l){var g=h.ampmIndex&&l[h.ampmIndex];b={match:l[0],hour:h.hourIndex&&this.capitalHour(l[h.hourIndex],g),min:h.minIndex&&parseInt(Number(l[h.minIndex]),10),sec:h.secIndex&&parseInt(Number(l[h.secIndex]),10)};break;}}a[m]=b;return b;},formatTimeInfo:function S(d,b){if(!b){return"";}var c=!(Number(d.hour)%12)?12:(Number(d.hour)%12),a=b.replace(/HH/g,this.formatInteger(d.hour,2)).replace(/H/g,Number(d.hour)).replace(/hh/g,this.formatInteger(c,2)).replace(/h/g,c).replace(/mm/g,this.formatInteger(Number(d.min)||0,2)).replace(/m/g,Number(d.min)||0).replace(/ss/g,this.formatInteger(Number(d.sec)||0,2)).replace(/s/g,Number(d.sec)||0).replace(/a/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME).replace(/tt/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME).replace(/AM\/PM/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME);return a;},doesTimeExist:function G(f,b,e){var d=parseInt(f,10);if(d>=0&&d<=23){var a=parseInt(b,10);if(a>=0&&a<=59){if(!e){return true;}var c=parseInt(e,10);if(c>=0&&c<=59){return true;}}}return false;},capitalHour:function C(a,b){a=parseInt(Number(a),10);if(b&&(b.match(X().AM_NAME)||b.match(/AM/i))){return a%12;}if(b&&(b.match(X().PM_NAME)||b.match(/PM/i))){return 12+(a%12);}return a;},getTimeStamp:function O(){var b=new Date();var a=[b.getMonth()+1,b.getDate(),b.getFullYear()];var e=[b.getHours(),b.getMinutes(),b.getSeconds()];var d=(e[0]<12)?"AM":"PM";e[0]=(e[0]<12)?e[0]:e[0]-12;e[0]=e[0]||12;for(var c=1;c<3;c++){if(e[c]<10){e[c]="0"+e[c];}}return a.join("-")+" "+e.join(":")+" "+d;},isDateAndOrTime:function V(a,b){return this.isDateTime(a,b)||this.isDate(a,b)||this.isTime(a,b);},isDateTime:function B(j,a){var e=this.parseDateAndOrTime(j),h=e&&e.date,d=e&&e.time,g=!!h&&!!d&&this.doesDateExist(h.month,h.day,h.year)&&this.doesTimeExist(d.hour,d.min,d.sec);if(a){if(g){var b=this.formatDateInfo(h,X().DATEOUTPUTFORMAT),c=this.formatTimeInfo(d,X().TIMEOUTPUTFORMAT),i=j.indexOf(h.match),f=j.indexOf(d.match);return(f<i)?c+" "+b:b+" "+c;}return null;}return !!g;},parseDateAndOrTime:function Q(b,a,f){var c=this.parseDate(b,true,a);var d=L.trim((c&&c.match)?b.replace(c.match,""):b),e=this.parseTime(d,false,f);if(!c&&!e){return null;}return{date:c,time:e};},inDateTimeRange:function P(c,e,h){var b=this.parseDateAndOrTime(c),f=b&&b.date,i=b&&b.time;if(!f&&!i){return 0;}if(e!=null){var d=this.parseDateAndOrTime(e);if(f&&d&&d.date){var j=this.compareDate(f,d.date);if(j<0){return -1;}if(j==0){if(i&&d.time&&(this.compareTime(i,d.time)<0)){return -1;}}}}if(h!=null){var a=this.parseDateAndOrTime(h);if(f&&a&&a.date){var g=this.compareDate(f,a.date);if(g>0){return 1;}if(g==0){if(i&&a.time&&(this.compareTime(i,a.time)>0)){return 1;}}}}return 0;},compareDate:function A(c,a){if(c===a){return 0;}var d=typeof c==="string"?this.parseDate(c):c,b=typeof a==="string"?this.parseDate(a):a;if(!d){return -1;}if(!b){return 1;}return(d.year-b.year)||(d.month-b.month)||(d.day-b.day)||0;},compareTime:function K(b,a){if(b===a){return 0;}var d=typeof b==="string"?this.parseTime(b):b,c=typeof a==="string"?this.parseTime(a):a;if(!d){return -1;}if(!c){return 1;}return(d.hour-c.hour)||(d.min-c.min)||(d.sec-c.sec)||0;},compareDateTime:function U(b,a){return this.compareDate(b,a)||this.compareTime(b,a);},compareDateAndOrTime:function E(h,f){if(h===f){return 0;}var b=typeof h==="string"?this.parseDateAndOrTime(h):h,a=typeof f==="string"?this.parseDateAndOrTime(f):f;if(!b){return -1;}if(!a){return 1;}var g=b.date,e=a.date,d=b.time,c=a.time;return this.compareDate(g,e)||this.compareTime(d,c);},_buildRegExp4DateFormat:function N(c){if(!c){return null;}var e=this.REGEXPS.DATES[c];if(!e){if(!this.REGEXPS.MONTHNAME_FULL){this.REGEXPS.MONTHNAME_FULL=X().MONTHNAME_FULL.join("|");this.REGEXPS.MONTHNAME_SHORT=X().MONTHNAME_SHORT.join("|");}e=this.REGEXPS.DATES[c]={};e.formatStr=c;var b=e.reStr=c.replace(/([^M|d|y|\s])/g,"\\$1").replace(/dd/g,"~~~~").replace(/d/g,"(\\d{1,2})").replace(/\~\~\~\~/g,"(\\d\\d)").replace(/yyyy/g,"(\\d\\d\\d\\d)").replace(/yy/g,"(\\d\\d)").replace(/MMMM/g,"@@@@").replace(/MMM/g,"@@@").replace(/MM/g,"(\\d\\d)").replace(/M/g,"(\\d{1,2})").replace("@@@@","("+this.REGEXPS.MONTHNAME_FULL+")").replace("@@@","("+this.REGEXPS.MONTHNAME_SHORT+")");e.reEquals=new RegExp("^"+b+"$");e.reContains=new RegExp("^"+b+"\\b");var f=[{key:"monthIndex",index:c.indexOf("M")},{key:"dayIndex",index:c.indexOf("d")},{key:"yearIndex",index:c.indexOf("y")}];f.sort(function(h,g){return h.index-g.index;});var a=1,d;for(d=0;d<3;d++){e[f[d].key]=f[d].index>-1?a++:null;}}return e;},_buildRegExp4TimeFormat:function F(d){if(!d){return null;}var f=this.REGEXPS.TIMES[d];if(!f){if(!this.REGEXPSTR_AMPM){this.REGEXPSTR_AMPM=[X().AM_NAME,X().PM_NAME,String(X().AM_NAME).toLowerCase(),String(X().PM_NAME).toLowerCase()].join("|");}f=this.REGEXPS.TIMES[d]={};f.formatStr=d;var c=d.replace(/\'\'/g,'"');var g=c.match(/\'(.+?)\'/g);c.replace(/\'(.+?)\'/g,"*");c=c.replace(/([^H|h|m|s|z|Z|a|t|\s|A|P|M|\/])/g,"\\$1").replace(/HH|hh/g,"(\\d\\d)").replace(/H|h/g,"(\\d{1,2})").replace(/mm/g,"(\\d\\d)").replace(/m/g,"(\\d{1,2})").replace(/ss/g,"(\\d\\d)").replace(/s/g,"(\\d{1,2})").replace(/a/g,"("+this.REGEXPSTR_AMPM+")").replace(/AM\/PM/,"("+this.REGEXPSTR_AMPM+")").replace(/tt/g,"("+this.REGEXPSTR_AMPM+")").replace(/z|Z/g,"(.+?)");var e,a;for(e=1,a=(g&&g.length)||0;e<a;e++){c=c.replace(/\*/,g[e]);}c=c.replace(/\"/g,"'");f.reEquals=new RegExp("^"+c+"$");f.reContains=new RegExp(c);var h=[{key:"hourIndex",index:d.search(/h|H/)},{key:"minIndex",index:d.indexOf("m")},{key:"secIndex",index:d.indexOf("s")},{key:"ampmIndex",index:d.search(/tt|a|AM\/PM/)},{key:"zoneIndex",index:d.search(/z|Z/)}];h.sort(function(j,i){return j.index-i.index;});var b=1;for(e=0;e<5;e++){f[h[e].key]=h[e].index>-1?b++:null;}}return f;},doesDateExist:function M(d,a,b){var c=new Date(b,d-1,a);return b==c.getFullYear()&&d==c.getMonth()+1&&a==c.getDate();},fourDigitYear:function T(b){b=parseInt(Number(b),10);if(!isNaN(b)){var a=(X().TWODIGITYEARSTART%100)||0;if(b>=0&&b<=a){b=2000+b;}else{if(b>a&&b<100){b=1900+b;}}}return b;},numericMonth:function W(e){var d=parseInt(Number(e),10),c=mstrmojo.array;if(!isNaN(d)){return d;}var a=(e&&e.length)||0,b=-1;if(a){if(a<=3){b=c.indexOf(X().MONTHNAME_SHORT,e);}if(b===-1){b=c.indexOf(X().MONTHNAME_FULL,e);}}return b+1;},formatInteger:function H(c,b){var f=String(c),e=Math.max(b-f.length,0);if(e>0){var a=[f],d;for(d=1;d<=e;d++){a.push("0");}f=a.reverse().join("");}return f;},getFirstDateOfMonth:function(b,a){return new Date(b,a-1,1);},getDateObject:function(g,a,f,c,e,b){g=g||0;a=a||1;f=f||1;c=c||0;e=e||0;b=b||0;return new Date(g,a-1,f,c,e,b);},getDateFromDateInfo:function(a){return this.getDateObject(a.date&&a.date.year,a.date&&a.date.month,a.date&&a.date.day,a.time&&a.time.hour,a.time&&a.time.min,a.time&&a.time.sec);},getDateJson:function(a){return{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),hour:a.getHours(),min:a.getMinutes(),sec:a.getSeconds()};},isLeapYear:function(a){return !(a%400)||(!(a%4)&&!!(a%100));},getDaysOfMonth:function(c,a){var b=[31,28,31,30,31,30,31,31,30,31,30,31];if(a==2&&this.isLeapYear(c)){return 29;}return b[a-1];},getPreMonth:function(b,a){if(a===1){return{y:b-1,m:12};}return{y:b,m:a-1};},getNextMonth:function(b,a){if(a===12){return{y:b+1,m:1};}return{y:b,m:a+1};}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.string","mstrmojo.array");var N=mstrmojo.locales,I=mstrmojo.string,Q=window.mstrConfig,F=mstrmojo.array,K=function(){return mstrmojo.locales.number.THOUSANDSEPARATOR;},R=function(){return mstrmojo.locales.number.DECIMALSEPARATOR;},C=Q.units,T={CM:1,IN:2,MM:3,PT:4,PC:5,PX:6},A={1:"cm",2:"in",3:"mm",4:"pt",5:"pc",6:"px"},E={DEFAULT:-2,FIXED:0,CURR:1,PERCENT:4,FRACTION:5,SCIENTIFIC:6,GENERAL:9};var G=96;String.prototype.reverse=function(){var W="",V;for(V=this.length;V>0;--V){W+=this.charAt(V-1);}return W;};function M(V,X){V=V||"";X=X||V.match(/\".+?\"/g)||[];for(var W=0;W<X.length;W++){V=V.replace(X[W],X[W].substring(1,X[W].length-1).replace(/\$/g,"$$$$"));}return V;}function U(a){var V=86400000,Z=new Date(1900,0,1,0,0,0,0),W=Math.floor(a)-1,Y=a-W-1;if(a>=59){W--;}var X=new Date(Z.getTime()+(W*V));X.setTime(X.getTime()+Y*V+500);return X;}function H(Z,g,i){var a={"d+":Z.getDate(),"h+|H":Z.getHours(),"s+":Z.getSeconds()},V=N.datetime,b;if(/(y+)/.test(g)){var Y=Z.getFullYear().toString(),f=RegExp.$1,X=f.length===2,W=Y.length;g=g.replace(f,Y.substr(X?W-2:0,X?2:W));}if(/(^\[h\])/.test(g)&&i){g=g.replace(RegExp.$1,""+(Math.floor(i*24)));}if(/(\"?:\"?mm)/.test(g)){var c=Z.getMinutes();g=g.replace(RegExp.$1,":"+(RegExp.$1.length===1?c:("00"+c).substr(c.toString().length)));}if(/(AM\/PM)/.test(g)){var h=a["h+"],d=h>11;a["h+"]=h-(d?12:0);g=g.replace(RegExp.$1,d?"PM":"AM");}for(b in a){if(new RegExp("("+b+")").test(g)){g=g.replace(RegExp.$1,RegExp.$1.length===1?a[b]:("00"+a[b]).substr((a[b].toString()).length));}}if(/(mmmm)/.test(g)){g=g.replace(RegExp.$1,V.MONTHNAME_FULL[Z.getMonth()]);}else{if(/(mmm)/.test(g)){g=g.replace(RegExp.$1,V.MONTHNAME_SHORT[Z.getMonth()].substr(0,3));}else{if(/((m|M)+)/.test(g)){var e=(Z.getMonth()+1).toString();g=g.replace(RegExp.$1,RegExp.$1.length===1?e:("00"+e).substr(e.length));}}}return M(g);}function O(W,Z){var X=0,V=Z.length,Y=0;for(;X<V;X++){if(Z[X]==="0"){Y++;}else{if(Z[X]==="#"){if(Y<W){Y++;}}else{continue;}}}return Y;}mstrmojo.num=mstrmojo.provide("mstrmojo.num",{isInt:function D(V){var Y=K(),X=new RegExp("^(-)?[0-9]{1,3}(\\"+Y+"[0-9]{3})*$"),W=new RegExp("^(-)?[0-9]+$");return(String(V).indexOf(Y)&&X.test(V))||W.test(V);},isNumeric:function P(Y,Z){var X=R(),a=K(),W=new RegExp("^(-)?[0-9]{1,3}(\\"+a+"[0-9]{3})*(\\"+X+"[0-9]+)?$"),V=new RegExp("^(-)?[0-9]*(\\"+X+")?[0-9]+$");return(String(Y).indexOf(a)&&W.test(Y))||V.test(Y);},parseInteger:function L(V,W){if(!this.isInt(V)){return Number.NaN;}return parseInt(this.toString(V,true),W);},parseNumeric:function B(V){if(!this.isNumeric(V)){return Number.NaN;}return parseFloat(this.toString(V,true));},inNumericRange:function S(W,X,V){W=this.parseNumeric(W);V=(V!=null)?this.parseNumeric(String(V)):Number.NaN;X=(X!=null)?this.parseNumeric(String(X)):Number.NaN;if(V!=Number.NaN&&(W>V||isNaN(W))){return 1;}if(X!=Number.NaN&&(W<X||isNaN(W))){return -1;}return 0;},convertToUSUnits:function(Y,X,W){var V=Y;X=X||C;switch(parseInt(X,10)){case T.CM:V=parseFloat(this.toString(Y))/2.54+"";break;case T.MM:V=parseFloat(this.toString(Y))/25.4+"";break;case T.PT:V=parseFloat(this.toString(Y))/72+"";break;case T.PC:V=parseFloat(this.toString(Y))/6+"";break;case T.PX:V=parseFloat(this.toString(Y))/G+"";break;}return W?V:this.toLocaleString(V);},convertToLocalUnits:function(Y,X,W){var V;X=X||C;switch(parseInt(X,10)){case T.CM:V=(parseFloat(this.toString(Y))*2.54).toFixed(4)+"";break;case T.MM:V=(parseFloat(this.toString(Y))*25.4).toFixed(4)+"";break;case T.PT:V=(parseFloat(this.toString(Y))*72).toFixed(4)+"";break;case T.PC:V=(parseFloat(this.toString(Y))*6).toFixed(4)+"";break;case T.PX:V=(parseFloat(this.toString(Y))*G)+"";break;default:V=parseFloat(this.toString(Y)).toFixed(4)+"";}return W?V:this.toLocaleString(V);},convertUnits:function(W,X,V){return this.convertToLocalUnits(this.convertToUSUnits(V,W,true),X,true);},toLocaleString:function(V){return(V+"").replace(".",R());},toString:function(X,V){if(V===true){var W=this.getThousandSepRegex();if(W){X=String(X).replace(W,"");}}return String(X).replace(R(),".");},getThousandSepRegex:function(){if(this.thousandSeparatorRegex==null){this.thousandSeparatorRegex=new RegExp(K().replace(/(\W){1}/g,"\\$1"),"g");}return this.thousandSeparatorRegex;},addSeparators:function(X,W){var V=W;if(W=="."||W=="*"||W=="\\"){V="\\"+W;}return X.reverse().replace(/(\d{3})/g,"$1"+W).reverse().replace(new RegExp("^(-)?"+V),"$1");},format:function(Z,Y,c,V){var b="",a=(Y>0)?".":"",W=[];c=(c)?c:"";for(var X=0;X<Y;X++){W.push("0");}W=W.join("");switch(Z){case E.GENERAL:b="0.00";break;case E.PERCENT:b="0"+a+W+"%";break;case E.SCIENTIFIC:b="0"+a+W+"E+00";break;default:b='"'+c+'"#,##0'+a+W;}return this.formatByMask(b,V);},getDecimalLength:function J(X){var V=X.indexOf("."),Y=0;if(V!==-1){var W=X.substr(V+1,X.length).match(/\d+/);if(W&&W.length>0){Y=W[0].length;}}return Y;},formatByMask:function(AC,AS){var z,r;if(isNaN(AS)){z=new Date(AS);if(isNaN(z)){return AS;}r=true;}if(AC==="General"){return String(parseFloat(AS).toFixed(2));}var q=String(AC).split(";"),l="",Y=q[0],h="\u00A4",AL=/"[^"]*"/g,k=(AC&&AC.replace(AL,h).replace(/\[.*\]/g,h))||"",AR=["m","y","d","h","s"],AH=false;F.forEach(AR,function(i){AH=AH||k.indexOf(i,0)!==-1;});if(AH){if(window.SSF){l=window.SSF.format(AC,AS);}if(l!==""){return l;}else{return H(r?z:U(AS),AC,AS);}}var AG=Y.indexOf("E+"),e=Y.indexOf("%"),w=Y.match(/\".+?\"/g),x=Y.indexOf("?/?")>-1,AA=(AG!=-1)?E.SCIENTIFIC:((e!=-1)?E.PERCENT:((w)?E.CURR:x?E.FRACTION:E.FIXED)),p="",AN="",n=false,W=new String(AS),d=this.parseNumeric(AS)||parseFloat(AS);if(w){if(Y.match(/\[\$.+?\]/g)){for(var f=0;f<w.length;f++){Y=Y.replace(w[f],w[f].substring(1,w[f].length-1));if(w[f].match(/\[\$.+?\]/g)){w[f]=w[f].replace(/\[\$.+?\]/g,w[f][w[f].indexOf("[$")+2]);}}Y=Y.replace(/\[\$.+?\]/g,'"#"'.replace("#",Y[Y.indexOf("[$")+2]));}p=M(Y,w);p=p.replace(Y.replace(/\".+?\"/g,""),h);}if(d<0){W=W.substring(1,W.length);d=-d,n=true;if(q.length>1){var b=q[1].replace(/\[.*\]/,"");AN=M(b.replace(q[0],h));}}var c=function(j,i){return(i)?i.replace(h,j):"-"+j;};if(AA==E.FRACTION){var AK,AJ,AQ,o=10,y,u=0,AE,AM,Z,X=false,AB;if(AC.indexOf("# ")>-1){X=true;}for(AK=5;AK>0;AK--){AB="/";for(AJ=0;AJ<AK;AJ++){AB+="?";}if(AC.indexOf(AB)>-1){for(AJ=1;AJ<AK;AJ++){o*=10;}break;}}if(X){u=Math.floor(Number(d));d-=u;}AM=o/2;AQ=-1;AE=d*o;for(AK=o-1;AK>=2;AK--){Z=(AE*AK)/o;Z=Z-Math.floor(Z);Z=Z*o;if(Math.abs(Z-o)<Z){Z=Math.abs(Z-o);}Z=Z/AK;if(Z<AM){AM=Z;AQ=AK;}else{if((Z==AM)&&(Z==0)){AM=Z;AQ=AK;}}}y=Math.round(AQ*AE/o);for(AK=AQ;AK>=2;AK--){if((y%AK==0)&&(AQ%AK==0)){y=y/AK;AQ=AQ/AK;break;}}if(AQ==o){AQ=1;y=0;}if(y==0){AQ=1;}if(y==AQ){if(X){l=""+(u+1);}else{l="1";}}else{if(X&&u>0){if(y==0){l=u;}else{l=u+" "+y+"/"+AQ;}}else{if(y==0){l="0";}else{l=y+"/"+AQ;}}}if(n){l=c(l,AN);}}else{if(AA==E.SCIENTIFIC){if(d!=0){var AT=Math.floor(Math.log(d)/Math.LN10),AI=d/Math.pow(10,AT),AU=Y.substring(0,AG),g=AU.indexOf("."),AD=Y.length-Y.indexOf("E+")-(""+Math.abs(AT)).length-2,AK,V=AT<0;AT=Math.abs(AT);for(AK=0;AK<AD;AK++){AT="0"+AT;}l+=Number(AI).toFixed((g!=-1)?AU.length-g-1:0);l=((n)?c(l,AN):l)+"E"+(V?"-":"+")+AT;}else{l="0";}}else{if(AA==E.PERCENT){Y=Y.substring(0,Y.length-1);W=String(d*100);}var g=Y.indexOf("."),a=0,AP,t=g>=0?Y.substring(0,g):Y;if(t.match(/[#0\?],$/)){d/=1000;W=String(d);}AP=this.getDecimalLength(W);if(g!=-1){a=O(AP,Y.substr(g+1,Y.length));}l=String(parseFloat(W).toFixed(Math.min(a,20)));var AO=l.split(".");var AF=Y.replace(/"[^"]*"/g,"").match(/[#\d]+[^\.\d#]+[#\d]+/);if(AF!==null){AO[0]=this.addSeparators(AO[0],K());}l=AO.join(R());if(AA==E.CURR){l=p.replace(h,l);if(l===p&&window.SSF){l=window.SSF.format(AC,AS);}}if(AA==E.PERCENT){l+="%";}if(n){l=c(l,AN);}}}return l;},validateFormat:function(V){var W=true,X=String(V).split(";");if(X[1]&&X[1].indexOf(X[0])<0){W=false;}return W;},generateUniqueID:function(V){var X="0123456789ABCDEF".split(""),Y=[];for(var W=0;W<V;W++){Y[W]=X[0|Math.random()*16];}return Y.join("");},countOfDecimals:function(W,X){var V=String(W);return V.length-(V.indexOf(X!==undefined?X:R())+1);}});mstrmojo.num.UNIT=T;mstrmojo.num.UNIT_SYMBOL=A;})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.string");var T=mstrmojo.dom,K=mstrmojo.string,X=mstrmojo.array;mstrmojo.css=mstrmojo.provide("mstrmojo.css",{DISPLAY_TABLE:T.isNSIE?"block":"table",DISPLAY_CELL:T.isNSIE?"block":"table-cell",MINHEIGHT:T.isIE6?"height":"minHeight",addClass:function L(e,d){if(e){if(d.constructor!==Array){d=[d];}var Z=e.className||"",g=" "+Z+" ",a=false,Y=d.length,b;for(b=0;b<Y;b++){var f=d[b];if(!g.match(new RegExp("\\s"+f+"\\s"))){Z+=" "+f;a=true;}}if(a){e.className=K.trim(Z);}}return e;},removeClass:function N(c,b){if(!c){return ;}if(b.constructor!==Array){b=[b];}var Z=" "+(c.className||"")+" ",Y=b.length,a;for(a=0;a<Y;a++){Z=Z.replace(new RegExp("\\s"+b[a]+"\\s","g")," ");}c.className=K.trim(Z);},addWidgetCssClass:function M(d,b){var Z=d.cssClass,c=(Z&&Z.split(" "))||[],a;b=[].concat(b);for(a=0;a<b.length;a++){var Y=b[a];if(X.indexOf(c,Y)===-1){c.push(Y);}}d.cssClass=c.join(" ");},removeWidgetCssClass:function F(e,c){var Z=e.cssClass,d=(Z&&Z.split(" "))||[],b;c=[].concat(c);for(b=0;b<c.length;b++){var Y=c[b];var a=X.indexOf(d,Y);if(a!==-1){d.splice(a,1);}}e.cssClass=d.join(" ");},toggleClass:function S(a,Z,Y){if(Y){this.addClass(a,Z);}else{this.removeClass(a,Z);}},applyShadow:function G(c,d,b,a,Y){var Z=c.style;if(T.isDXIE){Z.filter+="progid:DXImageTransform.Microsoft.dropshadow(OffX="+d+"px, OffY="+b+"px, Color='"+Y+"')";}else{if(T.isFF||T.isWK||T.isIE10){Z[T.CSS3_BOXSHADOW]=d+"px "+b+"px "+a+"px "+Y;}}},removeShadow:function B(Z){var Y=Z.style;if(T.isFF||T.isWK||T.isIE10){Y[T.CSS3_BOXSHADOW]="";}},setOpacity:function U(Z,b){if(T.isDXIE&&!T.isIE9){var c=Z.currentStyle.filter;var Y=null;if(c.length>0){Y=Z.filters["DXImageTransform.Microsoft.Alpha"];}if(Y){Y.opacity=b;Y.enabled=(b!==100);}else{if(b<100){var a="progid:DXImageTransform.Microsoft.Alpha(Opacity="+b+")";Z.style.filter=(c||"")+" "+a;}}}else{Z.style.opacity=b/100-(T.isIE9?0.00001:0);}},buildGradient:function O(Z,b,Y){if(T.supports(T.cssFeatures.GRADIENTS)){var a={};if(T.isDXIE){a.n="filter";a.v="progid:DXImageTransform.Microsoft.Gradient(GradientType="+Z+",StartColorStr='"+b+"',EndColorStr='"+Y+"')";}else{if(T.isFF){a.n="background-image";a.v="-moz-linear-gradient("+((Z===0)?"top":"left")+","+b+","+Y+")";}else{if(T.isWK){a.n="background";a.v="-webkit-gradient(linear,"+((Z===0)?"left top, left bottom":"left top, right top")+",from("+b+"),to("+Y+"))";}else{if(T.isIE10||T.isIEW3C){a.n="background";a.v="linear-gradient("+((Z===0)?"to bottom":"to right")+","+b+","+Y+")";}}}}return a;}return null;},buildRoundCorners:function Q(d,c){if(T.supports(T.cssFeatures.ROUND_CORNERS)){var Z=d+"px";var f=Z+(c?" "+Z+" 0 0":"")+";";if(T.isFF||T.isWinPhone||T.isIE10){return"border-radius:"+f;}if(T.isWK){if(!c){return"-webkit-border-radius:"+Z+";";}var e=["left","right"],b=[],Y=-1,a;for(a=0;a<2;a++){b[++Y]="-webkit-border-top-"+e[a]+"-radius:"+Z;b[++Y]="-webkit-border-bottom-"+e[a]+"-radius:0";}return b.join(";");}}return"";},getBorderWidthsOrPaddings:function D(Z,e){var f={t:0,r:0,b:0,l:0,h:0,w:0};if(!Z){return f;}var c=Z.split(" "),Y=c.length,d;for(d=0;d<Y;d++){c[d]=Math.round(e*parseFloat(c[d])/72);}if(Y<4){if(Y===1){c[1]=c[2]=c[3]=c[0];}else{c[3]=c[1];if(Y===2){c[2]=c[0];}}}f.t=c[0];f.r=c[1];f.b=c[2];f.l=c[3];f.h=f.t+f.b;f.w=f.l+f.r;return f;},getBorderWidths:function H(Z,Y){return this.getBorderWidthsOrPaddings(Z,Y);},getPaddings:function C(Z,Y){return this.getBorderWidthsOrPaddings(Z,Y);},parkAfterFade:function A(Y){var Z=Y.target.style;if(Z.opacity===0){Z.left="-10000px";window.setTimeout(function(){Z.opacity=0.99;},0);return true;}return false;},getStyleValue:function I(Y,c){var a=(c==="float"),b;if(Y.currentStyle){c=a?"styleFloat":c;b=Y.currentStyle[c];}else{if(document.defaultView&&document.defaultView.getComputedStyle){c=a?"cssFloat":c;var Z=document.defaultView.getComputedStyle(Y,null);b=Z?Z[c]:null;}}return b;},getComputedStyle:function R(Y,a){var Z=(window.getComputedStyle)?function(b,c){return window.getComputedStyle(b,c||null);}:function(b){return b.currentStyle||{};};mstrmojo.css.getComputedStyle=Z;return Z(Y,a);},getCssTextFromObj:function E(a){var Z="",Y;for(Y in a){Z+=Y+":"+a[Y]+";";}return Z;},onTransitionEnd:function W(a,Y){var Z="transition",b=window.Modernizr;if(b.testProp(Z)){T.attachOneTimeEvent(a,T.transEndEvtNames[b.prefixed(Z)],Y);}else{window.setTimeout(Y,0);}},flashClass:function P(Z,Y,b){this.toggleClass(Z,Y,true);var a=this;window.setTimeout(function(){a.toggleClass(Z,Y,false);},b);},convertCssToCamelCase:function J(Y){return Y.replace(/\-([a-z])/gi,function(Z,a){return a.toUpperCase();});},printCSSInfo:function V(c){var g=document.styleSheets,l=g.length,d,e;for(e=0;e<l;e++){var f=g[e],h=f.cssRules,a=h?h.length:0,k=0;for(d=0;d<a;d++){var Y=h[d].selectorText;if(Y){try{k+=Y.split(",").length;}catch(b){}}}var Z=f.href;if(!c||(Z&&X.indexOf(Z,c)>-1)){console.log("Stylesheet: "+Z||"Inline CSS Block");console.log("Total rules: "+a);console.log("Total selectors: "+k);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.string");var D=mstrmojo.string,F=1;mstrmojo.ListBuilder=mstrmojo.provide("mstrmojo.ListBuilder",{newContext:function E(G){var I=G.itemMarkupFunction;if(!I){var H=G.itemMarkup||(G.itemField&&'<div class="mstrmojo-text">{@'+G.itemField+"}</div>");I=H?function(K,J,L){return D.apply(H,K);}:null;}return{itemStatus:[],itemFunc:I};},build:function A(I,H,J,G){H.itemStatus[G]=F;return H.itemFunc(J,G,I);},onadd:function B(I,G,H){if(G){mstrmojo.array.insert(G.itemStatus,H.index,new Array(H.value.length));}},onremove:function C(I,G,H){if(G){G.itemStatus.splice(H.index,H.value.length);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.hash");var M=mstrmojo.string,L=mstrmojo.hash,E=mstrmojo.dom;var R=mstrmojo.usesFrames?null:document.createElement("span");var J=/mstrAttach:([\w,]+)/g;var Q;function U(a){if(Q===undefined){Q=(mstrApp!==undefined&&mstrApp.isTouchApp&&mstrApp.isTouchApp())||false;}return a.replace(J,function Z(g,j){var c=j.split(","),d=[],b=c.length,f;for(f=0;f<b;f++){var h=c[f];if(h){if(Q){if(h.indexOf("mouse")>-1){continue;}else{if(h==="click"){h="touchend";}}}d.push("on"+h+"=\"mstrmojo.dom.captureDomEvent('{@id}','"+h+"', self, event)\"");}}return d.join(" ");});}var N="preBuildRendering",C="buildRendering",B="postBuildRendering";function X(b){var a=b.markupString;if(a.match(/mstrAttach:/)){a=U(a);if(b.markupString===b.constructor.prototype.markupString){b.constructor.prototype.markupString=a;}}var Z=M.apply(a,b);if(Z){if(mstrmojo.usesFrames){var c=(b.domNode&&b.domNode.ownerDocument)||window.document;if(!R||R.ownerDocument!==c){R=c.createElement("span");}}R.innerHTML=Z;var e=R.removeChild(R.firstChild);e.mstrmojoId=b.id;return e;}return null;}function A(b){var a=b.markupSlots,Z,c;if(a){Z={};for(c in a){Z[c]=a[c].call(b);}}return Z;}mstrmojo._HasMarkup=mstrmojo.provide("mstrmojo._HasMarkup",{markupString:null,markupMethods:null,markupSlots:null,onRender:mstrmojo.emptyFn,onUnRender:mstrmojo.emptyFn,render:function Y(){if((this[N]&&this[N]()===false)||(this[C]()===false)||(this[B]&&this[B]()===false)){return false;}this.hasRendered=!!this.domNode;this.onRender();var Z="renderComplete";if(mstrmojo.publisher.hasSubs(this.id,Z)){this.raiseEvent({name:Z});}return true;},buildDom:function T(){return X(this);},postBuildDom:null,preBuildRendering:mstrmojo.emptyFn,buildRendering:function F(){var Z=this.domNode,a=this.buildDom();this.domNode=a;if(this.postBuildDom){this.postBuildDom();}if(this.slotNames){this.removeSlots(this.slotNames);}this.addSlots(A(this));this.paint();if(a){var d=Z;if(!d){d=this.placeholder;if(d){if(typeof d==="string"){d=document.getElementById(d);}delete this.placeholder;}}if(d){E.replace(d,a);}}var b="onchildRenderingChange",c=this.parent;if(c&&c[b]){c[b](this);}return true;},postBuildRendering:mstrmojo.emptyFn,unrender:function S(b){if(this.hasRendered){if(!b){try{var Z=this.domNode;if(Z.parentNode){Z.parentNode.removeChild(Z);}if(mstrmojo.dom.isIE&&Z.outerHTML!=="undefined"){Z.outerHTML="";}}catch(a){}}this.domNode=null;this.removeSlots(this.slotNames);this.hasRendered=false;this.onUnRender();}},paint:function K(){var a=this.markupMethods;if(!a){return ;}var d=this,e=function(i){var h=a[i];if(h){try{h.apply(d,[true]);}catch(g){throw new Error(["Error in markup method.","Script class: "+d.scriptClass,"Widget id: "+d.id,"Method name: "+i,"Err: "+g.message].join("\n\n"));}}};var c=a.sequence,Z,b,f;if(c){Z=c.length||0;for(b=0;b<Z;b++){e(c[b]);}}else{for(f in a){e(f);}}},redraw:function P(){return false;},refresh:function D(Z){if(this.hasRendered){if(this.redraw()!==true){var a=this.domNode;this.unrender(true);this.placeholder=a;if(Z){Z();}this.render();}}},set:function I(c,Z){this._super(c,Z);if(this.domNode){var a=this.markupMethods,b=a&&a["on"+c+"Change"];if(b){b.apply(this);}}return this;},slotNames:null,addSlots:function G(a){var Z=this.slotNames,b;if(!Z){Z={};this.slotNames=Z;}for(b in a){this[b]=a[b];Z[b]=true;}},removeSlots:function H(Z){if(Z){var a=this.slotNames,b;for(b in Z){delete this[b];if(a){delete a[b];}}}},captureDomEvent:function W(b,Z,c,a){if(this.enabled!==false){this.raiseEvent(mstrmojo._HasMarkup.newDomEvent(b,Z,c||Z.event,a));}},playEffect:function V(a){var Z=this[a];if(Z&&Z.constructor===Object){Z=mstrmojo.insert(mstrmojo.hash.clone(Z));Z.widget=this;this[a]=Z;}if(Z){Z.play();}}});mstrmojo._HasMarkup.addMarkupMethods=function O(a,Z){a.prototype.markupMethods=L.copy(Z,L.copy(a.prototype.markupMethods));};mstrmojo._HasMarkup.MSTRDomEventType=null;mstrmojo._HasMarkup.newDomEvent=function(c,Z,b,a){return{name:c,hWin:Z,e:b,config:a,ctrlKey:E.ctrlKey(Z,b),shiftKey:E.shiftKey(Z,b),metaKey:E.isMetaKey(Z,b),cancel:function(){E.stopPropogation(Z,b);},preventDefault:function(){E.preventDefault(Z,b);},getTarget:function(){return E.eventTarget(Z,b);}};};}());(function(){mstrmojo.requiresCls("mstrmojo.publisher");var C=mstrmojo.publisher;mstrmojo._Provider=mstrmojo.provide("mstrmojo._Provider",{_meta_usesSuper:false,audibles:{"*":true},set:function F(N,H){var G=false,K=this["_set_"+N],I=this[N];if(K){G=K.apply(this,arguments);}else{this[N]=H;G=(I!==H);}if(G){var L=N+"Change",M=this.audibles||{},J=(M[N]===true)||((M[N]!==false)&&(M["*"]!==false));if(J&&(this["pre"+L]||this["on"+L]||this["post"+L]||C.hasSubs(this.id,L))){this.raiseEvent({name:L,prop:N,value:H,valueWas:I});}}return this;},raiseEvent:function B(H){var M=H&&H.name;if(!M){return null;}H.src=this;this.preHandleEvent(H);var K=["pre","on","post"],L=false,I,G;for(I=0,G=K.length;I<G;I++){var J=K[I]+M;if(this[J]){if(this[J](H)===false){L=true;break;}}}if(!L){this.postHandleEvent(H);C.publish(this.id,M,H);}return H;},preHandleEvent:mstrmojo.emptyFn,postHandleEvent:mstrmojo.emptyFn,attachEventListener:function A(G,H,I){return C.subscribe(this.id,G,I,H);},detachEventListener:function E(G){C.unsubscribe(G);},destroy:function D(){C.clearSubscriptions(this.id);if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.dnd");var E=mstrmojo.dom;function B(I){return E.contains(this.getMovingHandle(),I.src.node,true,document.body);}mstrmojo._IsMovable=mstrmojo.provide("mstrmojo._IsMovable",{draggable:true,ownAvatar:true,getMovingHandle:function G(){return this.domNode;},getMovingTarget:function H(){return this.domNode;},isDragValid:function A(I){return B.call(this,I)||(this._super&&this._super(I))||false;},ondragstart:function C(J){if(B.call(this,J)){var K=this.getMovingHandle(),I=this.getMovingTarget().style;this._leftPos=parseInt(I.left,10);this._topPos=parseInt(I.top,10);this._hWidth=K.clientWidth;this._hHeight=K.clientHeight;}if(this._super){this._super();}},ondragmove:function F(L){if(B.call(this,L)){var M=L.tgt.pos,J=L.src.pos,K=this.getMovingTarget().style,I=E.windowDim();K.left=this.left=Math.min(Math.max(this._leftPos+M.x-J.x,-this._hWidth+40),I.w-40)+"px";K.top=this.top=Math.min(Math.max(this._topPos+M.y-J.y,-this._hHeight+20),I.h-20)+"px";}if(this._super){this._super();}},ondragend:function D(I){if(B.call(this,I)){delete this._leftPos;delete this._topPos;delete this._hWidth;delete this._hHeight;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.ListSelector");var C=mstrmojo.dom,B=C.isIE;mstrmojo.TreeNodeSelector=mstrmojo.provide("mstrmojo.TreeNodeSelector",mstrmojo.mixin({premousedown:function A(E,I,D){var G=(E&&E.tree)||E,H=D&&D.e;if(!H){return false;}var F=G.lastMouseDown;if(F){if((F.e===H)||(B&&((new Date())-F.dt<50))){return false;}}this._super(E,I,D);if(G){if(G.onnodemousedown){G.onnodemousedown(D);}G.lastMouseDown={e:H,dt:new Date()};}return true;}},mstrmojo.hash.copy(mstrmojo.ListSelector)));}());(function(){var D={};var B="XHRServerTransport";mstrmojo.XHRServerTransport={serverRequest:function A(I,G,F){var E=mstrmojo.all[I],H=D[G]=new mstrmojo.SimpleXHR();$MAPF(true,B,"transportRequest");if(F.params&&!F.params.sessionState&&mstrConfig&&mstrConfig.isAddSessionState&&mstrApp&&mstrApp.sessionState){F.params.sessionState=mstrApp.sessionState;}H.request(F.config.method||"POST",F.taskURL||mstrConfig.taskURL,{success:function(J){if(J.mstrerr){J.code=J.mstrerr.code;J.message=J.mstrerr.message;}E.response(G,true,J);},failure:function(J){E.response(G,false,{code:J.getResponseHeader("X-MSTR-TaskErrorCode"),message:J.getResponseHeader("X-MSTR-TaskFailureMsg")});},complete:function(){delete D[G];},textResponse:F.callback.textResponse},F.params);},cancelRequest:function C(F){var G=D[F],E=false;if(G){E=G.cancel();delete D[F];}$MAPF(false,B,"transportRequest");return E;}};}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.registry","mstrmojo._Provider","mstrmojo.array");var B=mstrmojo.registry,F=mstrmojo.array;mstrmojo.Obj=mstrmojo.declare(mstrmojo.Base,[mstrmojo._Provider],{scriptClass:"mstrmojo.Obj",id:"",init:function I(J){this.disposables=[];this._super(J);B.add(this);if(this.postCreate){this.postCreate();}},addDisposable:function G(M){var K=this.disposables,L,J;if(M.constructor===Array){for(L=0,J=M.length;L<J;L++){K.push(M[L]);}}else{K.push(M);}return M;},destroyDisposables:function D(J){F.forEach(this.disposables,function(K){if(K.destroy){K.destroy(J);}else{if(K.clear){K.clear();}}});this.disposables=[];},throwAbstractMethodError:function A(J){throw new Error(this.scriptClass+" must implement "+J+".");},destroy:function H(J){if(this.destroyed){return ;}this._super(J);this.destroyDisposables(J);B.remove(this);delete this.parent;this.destroyed=true;}});var C=mstrmojo.Obj;C.free=function E(J){if(J instanceof C){J.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.registry","mstrmojo.publisher","mstrmojo._Provider");var G=mstrmojo.hash,A=mstrmojo.array,B=mstrmojo.registry,D=mstrmojo.publisher;mstrmojo.Arr=mstrmojo.declare(null,[mstrmojo._Provider],{scriptClass:"mstrmojo.Arr",postApplyProperties:null,postCreate:null,length_bindEvents:["add","remove"],init:function H(K){var J;if(K&&K.data){J=K.data;delete K.data;}else{if(K){J=K;K=null;}}if(!J||J.constructor!==Array){J=[];}G.copy(mstrmojo.Arr.prototype,J);if(K){G.copy(K,J);}if(J.postApplyProperties){J.postApplyProperties();}B.add(J);if(J.postCreate){J.postCreate();}return J;},destroy:function E(){D.clearSubscriptions(this.id);B.remove(this);},add:function I(L,J,K){var M=L&&L.length;if(M){if(J==null){J=this.length;}A.insert(this,J,L);if(!K&&(this.onadd||D.hasSubs(this.id,"add"))){this.raiseEvent({name:"add",value:L,index:J});}}},remove:function F(J,L,K){if(L==null){L=1;}if((J!=null)&&L){var M=this.splice(J,L);if(!K&&(this.onremove||D.hasSubs(this.id,"remove"))){this.raiseEvent({name:"remove",value:M,index:J});}}}});mstrmojo.Arr.makeObservable=function C(J,K){if(!J){return ;}if(!K){K={};}K.data=J;return this.prototype.init(K);};})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.registry","mstrmojo.ListBuilder");var H=mstrmojo.hash,E=mstrmojo.registry,G=1;mstrmojo.WidgetListBuilder=mstrmojo.provide("mstrmojo.WidgetListBuilder",mstrmojo.mixin({newContext:function F(J){var K=J.itemFunction;if(!K){var I=J.itemConfig;K=I?function(M,L,N){var O=H.clone(I);O.data=M;O.parent=N;return E.ref(O);}:null;}return{itemStatus:[],itemWidgets:[],itemFunc:K};},build:function A(K,J,N,I){var L=J.itemFunc(N,I,K);if(L){J.itemStatus[I]=G;J.itemWidgets[I]=L;if(L.set){var M=K.selectedIndices;if(M&&M[I]){L.set("selected",true);}}}return L;},onadd:function C(K,I,J){if(I){mstrmojo.array.insert(I.itemWidgets,J.index,new Array(J.value.length));}this._super(K,I,J);},onremove:function D(L,J,K){if(J){var O=J.itemWidgets.splice(K.index,K.value.length),N,I;for(N=0,I=O.length;N<I;N++){var M=O[N];if(M&&M.destroy){delete M.parent;M.destroy();}}}this._super(L,J,K);},onchange:function B(S,J,P,T){if(T){var N=P.itemWidgets,L,O,I,R;for(O=0,I=T.removed,R=I&&I.length;O<R;O++){L=N[I[O]];if(L&&L.set){L.set("selected",false);}}var M,Q,K;for(M=0,Q=T.added,K=Q&&Q.length;M<K;M++){L=N[Q[M]];if(L&&L.set){L.set("selected",true);}}}}},H.copy(mstrmojo.ListBuilder)));}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var G=mstrmojo.dom,J=mstrmojo.css,H="selected";function B(S,T,U,R,W){var V=W.listHooks[S];if(V&&V.call(W,T,U,R)){return ;}J.toggleClass(T,H,S==="select");}function I(U,T,S){var V=this[U],R=V?V.split(T):[];this[U]=mstrmojo.array.distinct(R.concat(S.split(T))).join(T);}mstrmojo._IsList=mstrmojo.provide("mstrmojo._IsList",{_mixinName:"mstrmojo._IsList",listHooks:{},useListModKeys:false,init:function Q(R){this._super(R);this._shiftStartIndex=-1;},getItemMarkup:function O(S,R){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@en@n}</{@tag}>';},getItemDisplayName:function E(R){return R.n||"";},getItemProps:function K(V,R){var S=!!this.selectedIndices[R],W={tag:"div",sel:S,cls:"",n:this.getItemDisplayName(V),style:"",idx:R,addCls:function T(Y){I.call(this,"cls"," ",Y);},addStyle:function U(Y){I.call(this,"style",";",Y);},title:V.title||""};if(S){W.addCls(H);}var X=V.cls;if(X){W.addCls(X);}return W;},itemRenderer:{render:function A(S,R,T){S._renderIdx=R;return mstrmojo.string.apply(T.getItemMarkup(S,R),T.getItemProps(S,R));},select:function L(S,T,R,U){B("select",S,T,R,U);},unselect:function D(S,T,R,U){B("unselect",S,T,R,U);}},onclick:function P(R){try{var T=this.getItemFromTarget(R.getTarget());if(T){R.cancel();this.doItemSelect(T,R||{});}}catch(S){mstrApp.onerror(S);}},doItemSelect:function F(j,b){var R=b.hWin,h=b.e,c=j._renderIdx,W=j._positionIdx,S=G.isMetaKey(R,h),Z=G.shiftKey(R,h),Y=this.multiSelect,U=this.useListModKeys,d=this._shiftStartIndex,X=this.selectedIndices;if(Y&&U&&Z&&d>-1){var g=[],T=[],V=Math.min(d,c),k=Math.max(d,c),f;for(f=0;f<this.items.length;f++){if(V<=f&&f<=k){if(!X[f]){g.push(f);}}else{if(X[f]){T.push(f);}}}this.addSelect(g);this.removeSelect(T);}else{if(Y&&(!U||S)){var a=(X[c])?"remove":"add";this[a+"Select"](c,false,W);}else{this.singleSelect(c,false,W);}this._shiftStartIndex=c;}},onclearSelection:function N(){this._shiftStartIndex=-1;},getItemNodeFromTarget:function C(S){var R=G.findAncestorByAttr(S,"idx",true,this.domNode);return(R&&R.node)||null;},getItemFromTarget:function M(T){var S=this.getItemNodeFromTarget(T),R=S&&parseInt(S.getAttribute("idx"),10);if(R!==null&&!isNaN(R)&&this.items){return this.items[R];}return undefined;}});mstrmojo._IsList.SELECTED_CLS=H;}());(function(){mstrmojo.requiresCls("mstrmojo.css");var F=mstrmojo.css,E="px",J="hasOwnAvatar",I={x:0,y:0};function B(L){var K=this.createAvatar(L.src.node,L);if(K){F.addClass(K,[this.avatarCssClass,J]);this.avatar=L.avatar=document.body.appendChild(K);}}function C(){var K=this.avatar;if(K){K.parentNode.removeChild(K);delete this.avatar;F.removeClass(K,[this.avatarCssClass,J]);}}mstrmojo._HasOwnAvatar=mstrmojo.provide("mstrmojo._HasOwnAvatar",{_mixinName:"mstrmojo._HasOwnAvatar",draggable:true,ownAvatar:true,avatarCssClass:"",restrictedToAxis:undefined,isDragValid:function H(K){if(this._super){return this._super(K);}return false;},ondragstart:function D(K){B.call(this,K);this.positionAvatar(K.src.pos,K);if(this._super){this._super(K);}},ondragmove:function A(K){this.positionAvatar(K.tgt.pos,K);if(this._super){this._super(K);}},ondragend:function A(K){C.call(this);if(this._super){this._super(K);}},createAvatar:mstrmojo.emptyFn,positionAvatar:function G(O,L){var N=this.avatar.style,M=this.restrictedToAxis,K=(L&&L.dragOffsets)||I;if(M!=="y"){N.left=O.x+K.x+E;}if(M!=="x"){N.top=O.y+K.y+E;}}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.hash","mstrmojo.css");var F=mstrmojo.hash,C=mstrmojo.css;var D="open";function E(G){return G?G.popupConfig.hostElement:null;}mstrmojo.ui.menus._HasMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._HasMenuPopup",F.copy(mstrmojo._HasPopup));mstrmojo.ui.menus._HasMenuPopup.openPopup=function A(I,G){var H=this._lastOpened;if(H){this.closePopup();}mstrmojo._HasPopup.openPopup.call(this,I,G);C.addClass(E(I),D);};mstrmojo.ui.menus._HasMenuPopup.closePopup=function B(){C.removeClass(E(this._lastOpened),D);mstrmojo._HasPopup.closePopup.call(this);};}());(function(){mstrmojo.requiresCls("mstrmojo.css");var A=mstrmojo.css;mstrmojo.ui._HasUITheme=mstrmojo.provide("mstrmojo.ui._HasUITheme",{_mixinName:"mstrmojo.ui._HasUITheme",themeClassName:"",postBuildRendering:function B(){var D=this.themeClassName;if(D){this.onthemeClassNameChange({value:D});}return this._super();},onthemeClassNameChange:function C(D){var F=this.domNode;if(F){var G=D.value,E=D.valueWas;if(G){A.addClass(F,D.value);}if(E){A.removeClass(F,D.valueWas);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css");var B=mstrmojo.css;mstrmojo._HasLassoSelector=mstrmojo.provide("mstrmojo._HasLassoSelector",{_mixinName:"mstrmojo._HasLassoSelector",draggable:true,ownAvatar:true,lassoDiv:undefined,ondragstart:function A(G){var F=this.lassoDiv=document.createElement("div");B.addClass(F,"lassoDiv");this.containerNode.appendChild(F);this.resizeLasso(G);if(this._super){this._super(G);}},ondragmove:function E(F){this.resizeLasso(F);if(this._super){this._super(F);}},ondragend:function D(G){var F=this.lassoDiv;if(F){F.parentNode.removeChild(F);delete this.lassoDiv;}if(this._super){this._super(G);}},resizeLasso:function C(N){var M=this.lassoDiv,I=mstrmojo.dom.position(this.containerNode),K=M.style,O=N.tgt,G=N.src.pos.x,F=N.src.pos.y,J=(O&&O.pos.y)||F,L=(O&&O.pos.x)||G,H={x:(Math.min(G,L)-I.x),y:(Math.min(F,J)-I.y),h:(O?Math.abs(J-F):0),w:(O?Math.abs(L-G):0)};K.left=H.x+"px";K.top=H.y+"px";K.height=H.h+"px";K.width=H.w+"px";this.onSelectedBoundingBox(H);},onSelectedBoundingBox:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.string","mstrmojo.css");var K=mstrmojo.css,N=mstrmojo.string,H=mstrmojo.dom,L=13,C=27;function I(S){if(this._editComplete){return ;}var W,Q=false,V=this.text,T=false;if(S===C){W=V;T=true;Q=true;}if(!S||(!this.allowNewLine&&S===L)){var R=this[this.editableSlot],U=R.innerText||R.textContent||"";if(!this.allowNewLine){W=U.replace(/\n/g,"");}else{W=U;}Q=true;if(!this.allowEmptyText&&W.length===0){W=V;T=true;}}if(Q){this._editComplete=true;W=W.replace(/\u00A0/g,"\u0020");this.text=W;this.set("isEditing",false);this.onTextEditComplete(W!==V,V);delete this._editComplete;}if(T){this.refresh();}}function E(Q){var R={dblclick:"editOnDoubleClick",click:"editOnClick"};if(this[R[Q.name]]&&Q.getTarget()===this[this.editableSlot]){this.set("isEditing",true);}}function F(S,R,Q){if(typeof R["on"+Q]!=="function"){H.attachMarkupEvent(S,R,Q);}}mstrmojo._HasEditableText=mstrmojo.provide("mstrmojo._HasEditableText",{_mixinName:"mstrmojo._HasEditableText",editableSlot:"domNode",editButtonSlot:null,isEditing:false,editOnClick:true,allowEmptyText:false,allowNewLine:false,editOnDoubleClick:false,onTextEditComplete:mstrmojo.emptyFn,postBuildRendering:function A(){this._super();var S=this.editableSlot,Q=this[S],T=this[this.editButtonSlot||S];K.addClass(Q,"hasEditableText");this.text=this.text||Q.innerText||Q.textContent||"";Q.innerHTML=N.encodeHtmlString(this.text,true).replace(/ (?= )/g,"&nbsp;");var R=this.id;if(this.editOnClick){F(R,T,"click");}F(R,T,"dblclick");F(R,Q,"blur");F(R,Q,"keyup");F(R,Q,"keydown");},onclick:function P(Q){E.call(this,Q);if(this._super){this._super(Q);}},ondblclick:function G(Q){E.call(this,Q);},onblur:function M(){I.call(this);},onkeyup:function B(R){var Q=window.event||R.e;I.call(this,Q.keyCode);},onkeydown:function J(R){var Q=window.event||R.e;if(Q.keyCode===L){I.call(this,Q.keyCode);R.cancel();}},_set_text:function D(S,Q){var R=this.text;this.text=Q;if(this.hasRendered){this[this.editableSlot].innerHTML=N.encodeHtmlString(Q||"",true);}return(R!==Q);},onisEditingChange:function O(){if(this.hasRendered){var Q=this[this.editableSlot],R=!!this.isEditing;Q.contentEditable=R;Q.spellcheck=false;K.toggleClass(Q,"editable",R);if(R){Q.focus();H.setElementSelection(Q);}else{Q.blur();Q.scrollLeft=0;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom");var E=mstrmojo.css,C=mstrmojo.dom,B="dzMask",I="mask",J="idx";function G(K){E.toggleClass(this.domNode,I,false);E.toggleClass(K,B,false);}mstrmojo.architect.ui._HasTreeDropZone=mstrmojo.provide("mstrmojo.architect.ui._HasTreeDropZone",{_mixinName:"mstrmojo.architect.ui._HasTreeDropZone",ondragenter:function F(K){E.toggleClass(this.domNode,I,true);if(this._super){this._super(K);}},ondragover:function A(L){var P=L.src,O=L.tgt.node,K=L.dzNode;if(P&&P.data&&O!==K){E.toggleClass(K,B,false);var M=C.findAncestorByAttr(O,J,true,this.domNode);if(M){var N=M.node;L.dzNode=N;E.toggleClass(N,B,true);}}if(this._super){this._super(L);}},ondragleave:function H(K){G.call(this,K.dzNode);if(this._super){this._super(K);}},ondrop:function D(K){G.call(this,K.dzNode);if(this._super){this._super(K);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.fx");var Y=mstrmojo.css,H=mstrmojo.dom,O=mstrmojo.array,K={v:{styleDim:"height",styleDir:"top",dimension:"h",position:"y",scroll:"scrollTop",scrollDimension:"scrollHeight",cls:"vertical",hostCls:"hasVertical",scrollNodeCls:"hasVertical"},h:{styleDim:"width",styleDir:"left",dimension:"w",position:"x",scroll:"scrollLeft",scrollDimension:"scrollWidth",cls:"horizontal",hostCls:"hasHorizontal",scrollNodeCls:"hasHorizontal"}},W="scrollingMode",R="scrolling",b=3;var L=H.getOSInfo().name.toLowerCase().indexOf("mac")>=0;function J(){return(this.scrollbarHostNode||(this.scrollNode&&this.scrollNode.parentNode));}function P(d,c){var i=H.eventTarget(c,d),g=this.scrollNode,f=H.position(g),h=this.scrollTrackNodes,e=this.scrollBarNodes,j=function j(r){var p=i===h[r];if(p){var t=K[r],k=e[r],u=H.position(k),m=H.getMousePosition(d,c)[t.position],n=m-u[t.position],l=n>0?1:-1,q=g[t.scrollDimension],v=Math.abs(n-(u.h/2))*(q/f[t.dimension]),o={};o[t.scroll]={isStyle:false,start:g[t.scroll],stop:g[t.scroll]+(l*Math.min(q/3,500,v)),ease:mstrmojo.ease.linear};(new mstrmojo.fx.AnimateProp({props:o,duration:200,interval:10,target:g})).play();}};j.call(this,"h");j.call(this,"v");}function B(d,c){var g=this.scrollNode,f=d.type==="mousewheel",e=f?-1:1;mstrmojo.array.forEach(["h","v"],function(n){var l=K[n],i=f?"wheelDelta":"delta",k=d[i+{h:"X",v:"Y"}[n]]*e,j=Math.abs(k),h=k/j,m=j===3&&H.isFF&&!L;g[l.scroll]+=m?h*40:k;});H.stopPropogation(c,d);H.preventDefault(c,d);}function a(h){var g=K[h],f=this.scrollNode,e=H.position(f),d=e[g.dimension],i=f[g.scrollDimension],c=Math.ceil(d)/i;return A(c,d,i);}function A(d,c,e){return(!isNaN(d)&&d<1)&&(Math.abs(c-e)>b);}function C(y){var q="px",k=K[y],e=this.scrollNode,l=J.call(this),z=H.position(e),m=z[k.dimension],t=e[k.scrollDimension],d=Math.ceil(m)/t,x=this.scrollBarNodes,i=x[y],o=this.scrollTrackNodes,p=o[y],v=A(d,m,t),f=k.cls;if(!i){p=o[y]=document.createElement("div");var g=this,n=function(AB){P.call(g,AB);},j=function(AB){B.call(g,AB);},u=function(AD,AB,AC){H.attachEvent(AD,AB,AC);g.installedEventListeners.push({e:AD,evt:AB,fn:AC});};u(p,"click",n);p.className="mstrmojo-scrolltrack "+f;i=x[y]=document.createElement("div");i.className="mstrmojo-scrollbar "+f;p.appendChild(i);l.appendChild(p);var w=mstrApp.isSingleTier?"mousewheel":"wheel";u(p,w,j);u(i,w,j);}var AA=i.style,h=(e[k.scroll]/e[k.scrollDimension]),c=H.delta(e,J.call(this))[k.position],r=p.style;if(v){r[k.styleDir]=c+q;AA[k.styleDim]=(d*m)+q;AA[k.styleDir]=(m*h)+q;}Y.toggleClass(l,k.hostCls,v);Y.toggleClass(e,k.scrollNodeCls,v);return v;}function G(){return !(mstrApp.isSingleTier&&L);}mstrmojo.ui._HasScroller=mstrmojo.provide("mstrmojo.ui._HasScroller",{_mixinName:"mstrmojo.ui._HasScroller",hasCustomScrollbar:null,draggable:true,ownAvatar:true,scrollNode:undefined,scrollbarHostNode:undefined,scrollBarNodes:undefined,setupScrollNodes:mstrmojo.emptyFn,installedEventListeners:null,init:function T(c){this._super(c);if(this.hasCustomScrollbar===null){this.hasCustomScrollbar=G();}this.installedEventListeners=[];},onRender:function I(){if(this._super){this._super();}this.updateScrollbars();this.addScrollNodeProperties();},addScrollNodeProperties:function F(){var d=this.scrollNode;if(d){var c=H.attachMarkupEvent(this.id,d,"scroll");this.installedEventListeners.push({e:d,evt:"scroll",fn:c});}if(!this.hasCustomScrollbar){Y.addClass(d,"mstrmojo-sb-show-default");return ;}if(d){Y.addClass(J.call(this),"mstrmojo-scrollbar-host");Y.addClass(d,"mstrmojo-scrollNode");}},updateScrollbars:function Z(){if(!this.hasRendered){return ;}this.setupScrollNodes();if(!this.hasCustomScrollbar){if(this.scrollNode){this.scrollNode.style.overflowX=a.call(this,"h")?"scroll":"hidden";}return ;}if(this.scrollNode){this.scrollBarNodes=this.scrollBarNodes||{};this.scrollTrackNodes=this.scrollTrackNodes||{};var c=this.scrollNode.style;c.overflowY=C.call(this,"v")?"scroll":"hidden";c.overflowX=C.call(this,"h")?"scroll":"hidden";}},onscroll:function V(){var j=this.scrollNode;if(j&&this.hasCustomScrollbar){var g=function g(k){var l=parseInt(k);return l===null||isNaN(l)?0:l;},h=H.position(j),i=h.h-g(Y.getStyleValue(j,"padding-bottom")),d=h.w-g(Y.getStyleValue(j,"padding-right")),f=this.scrollBarNodes,e=f.v,c=f.h;if(j.scrollHeight-i>0){e.style.top=((i-H.position(e).h)*(j.scrollTop/(j.scrollHeight-i)))+"px";}if(j.scrollWidth-d>0){c.style.left=((d-H.position(c).w)*(j.scrollLeft/(j.scrollWidth-d)))+"px";}}if(this._super){this._super();}if(this.onScrollEnd){this.onScrollEnd();}},getDragData:function E(d){var g=this.scrollNode,f=H.position(g),e=d.src.node,c=this.scrollBarNodes;if(this.isDraggingScrollBar(d)){return{isScrollBar:true,direction:e===c.v?"v":"h",scrollTop:g.scrollTop,scrollLeft:g.scrollLeft,conversionRatio:{y:g.scrollHeight/f.h,x:g.scrollWidth/f.w}};}return(this._super&&this._super(d));},isDragValid:function D(c){return this.isDraggingScrollBar(c)||(this._super&&this._super(c))||false;},isDraggingScrollBar:function S(d){var e=d.src.node,c=this.scrollBarNodes;return !!c&&(e===c.v||e===c.h);},ondragstart:function X(c){if(this.isDraggingScrollBar(c)){Y.addClass(c.src.node,R);Y.addClass(J.call(this),W);}if(this._super){this._super(c);}},shouldDragBubble:function Q(c){var d=c.src.node,e=this.scrollTrackNodes;return !!e&&(d===e.v||d===e.h);},ondragmove:function N(d){if(this.isDraggingScrollBar(d)){var l=d.tgt,c=d.src,m=l.pos,e=c.pos,i=c.node,h=this.scrollNode,k=this.scrollBarNodes,j=c.data,g={y:(m.y-e.y),x:(m.x-e.x)},f=j.conversionRatio;if(i===k.v){h.scrollTop=j.scrollTop+(g.y*f.y);}else{h.scrollLeft=j.scrollLeft+(g.x*f.x);}}if(this._super){this._super(d);}},ondragend:function N(c){if(this.isDraggingScrollBar(c)){Y.toggleClass(c.src.node,R,false);Y.toggleClass(J.call(this),W,false);}if(this._super){this._super(c);}},widgetResized:function M(){if(this._super){this._super();}this.updateScrollbars();},unrender:function U(c){O.forEach(this.installedEventListeners,function(d){H.detachEvent(d.e,d.evt,d.fn);});delete this.scrollNode;delete this.scrollbarHostNode;delete this.scrollBarNodes;delete this.scrollTrackNodes;this._super(c);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.css");var A=1,K="mstrmojo-itemwrap",J="&nbsp;",I=mstrmojo.array;function B(V){if(!V.pageSize||V.pageSize<=0){var W=V.scrollboxNode;V.pageSize=W&&W.clientHeight||0;}return V.pageSize;}function T(V,W){if(V.usePaging){V.totalPages=1;var Y=V.itemsContainerNode,X=B(V);if(V.usePaging&&Y&&X){V.totalPages=Math.ceil((Y.clientHeight-parseInt(Y.style&&Y.style.paddingBottom||0,10))/X);}if(Y){V.itemsContainerNode.style.paddingBottom=X+"px";}}}mstrmojo.ListMapper=mstrmojo.provide("mstrmojo.ListMapper",{markupPrefix:"",markupSuffix:"",itemWrapperPrefix:function(V){return'<div class="'+this.getWrapperCss(V)+'">';},itemWrapperSuffix:"</div>",itemWrapperPrefill:"&nbsp",wrapperNodes:function C(V){return V.childNodes;},wrapperParentNode:function D(V){return V;},createWrapperNode:function G(V){var W=V.ownerDocument,X=W.createElement("div");return X;},findScrollRange:function N(k,Z,j,n,W,c,o,m){if(!Z){return{start:0,end:0};}var e=this.wrapperNodes(k),g=parseInt(Z/2,10),Y=parseInt(Math.log(Z)/Math.log(2),10),X=0,V=Z-1,f=j+n,d=e[0].offsetTop,b;for(var l=1;l<=Y;l++){b=e[g].offsetTop-d+m;if(b<j){X=g;}else{if(b>f){V=g;}}var a=Math.round(Z/Math.pow(2,l+1));g+=(b>j)?-a:a;g=Math.min(Math.max(0,g),Z-1);}return{start:X,end:V};},findWrapper:function L(X,V){var W=this.wrapperNodes(X);return W&&W[V];},findIndex:function F(V,Y,X){var W=this._nd2iw(V,Y,X);return W?this._iw2idx(V,Y,W):-1;},itemOffsetTop:function U(W,a,V,Y){if(!Y){var X=this.wrapperNodes(a);Y=X&&X[V];if(!Y){return 0;}}var Z=a.firstChild;if(!Z||(Z===Y)){return 0;}else{return Y.offsetTop-Z.offsetTop;}},whereDrop:function S(c,V,X,b,W){var Y=this._nd2iw(c,V,X),d,a,e;if(Y){a=this._iw2idx(c,V,Y);d=a;e=this.itemOffsetTop(c,V,null,Y);var Z=Y.offsetHeight;if(b.y>W.top+e+Z/2){d++;e+=Z;}}else{return c.dropCuePos;}return{left:0,top:e,idx:d,idxActual:a};},getWrapperCss:function(V){return K;},postBuildRendering:function(Z,Y,X,W,V){T(W,this);},buildItemWrappers:function P(e,b,h,d,a,i){var l=this.itemWrapperPrefix(h),g=this.itemWrapperSuffix,Z=l+this.itemWrapperPrefill+g,Y=[this.markupPrefix],W=1,V=h.selectedIndices||{},n=function m(k,j){for(var o=k;o<j;o++){Y[W++]=l;var p=b.build(h,d,e[o],o);if(V[o]){p=p.replace(/class\=\"([^\"]*)\"/,'class="$1 selected"');}Y[W++]=p;Y[W++]=g;}};var c=(e&&e.length)||0;a=a&&b?Math.min(a,c):0;if(a){n(0,a);}i=i&&b?Math.min(i,c-a):0;var f=c-i;for(var X=a;X<f;X++){Y[W++]=Z;}if(i){n(f,c);}Y.push(this.markupSuffix);return Y;},fillItemWrappers:function H(X,g,d,m,f,W,b,l){var e=(g&&g.length)||0,j=this.wrapperNodes(X),n=f.itemStatus,V=mstrmojo.css,Z=m.selectedIndices||{};for(var c=W,h=Math.min(b+1,e),a=0;c<h;c++){if(n[c]!==A){j[c].innerHTML=d.build(m,f,g[c],c);if(Z[c]){var Y=j[c].firstChild;if(Y){V.addClass(Y,["selected"]);}}a++;if(a===l){break;}}}return a;},onadd:function O(e,V,Z,f){if(V&&f){var a=f.value.length,b=this.wrapperNodes(V),d=b[f.index],Y=this.getWrapperCss(e);for(var X=0;X<a;X++){var W=this.createWrapperNode(V);W.className=Y;W.innerHTML=J;if(d){this.wrapperParentNode(V).insertBefore(W,d);}else{this.wrapperParentNode(V).appendChild(W);}}T(e,this);}},onremove:function Q(Y,b,V,X){if(b&&X){var a=this.wrapperNodes(b);if(a){var d=X.value.length;for(var Z=X.index+d-1,W=X.index;Z>=W;Z--){this.wrapperParentNode(b).removeChild(a[Z]);}}T(Y,this);}},onchange:function R(g,X,c,k){if(X&&k){var d=this.wrapperNodes(X);if(d){var W=mstrmojo.css,l=c.itemStatus,h;for(var b=0,V=k.removed,f=V&&V.length;b<f;b++){h=V[b];if(l[h]){W.removeClass(d[h].firstChild,["selected"]);}}for(var Z=0,e=k.added,Y=e&&e.length;Z<Y;Z++){h=e[Z];if(l[h]){W.addClass(d[h].firstChild,["selected"]);}}}}},_nd2iw:function E(W,Z,Y){Z=this.wrapperParentNode(Z);if(Z&&Y&&Z!==Y){var V=W.domNode,X=Y.parentNode;while(X){if(X===Z){return Y;}if(X===V){break;}Y=X;X=Y.parentNode;}}return null;},_iw2idx:function M(X,b,a){var W=X.items&&X.items.length,Y=this.wrapperNodes(b),V=I.findBin(Y,a,"offsetTop",W);for(var Z=V;Z<W;Z++){if(Y[Z].offsetHeight){return Z;}}return -1;},toPage:function(V,X){var W=V.scrollboxNode;if(V.usePaging&&W){W.scrollTop=X*B(V);}else{mstrmojo.alert("paging is not setup, can not perform paging.");}},whichPage:function(V){var W=V.scrollboxNode,X=B(V);return Math.round((W&&X&&W.scrollTop/X)||0);},toItem:function(Z,a){var X=Z&&Z.itemsContainerNode,e=Z.scrollboxNode,V=this.itemOffsetTop(Z,X,a),b=this.wrapperNodes(X)[a].clientHeight,W=e.clientHeight,d=e.scrollTop,Y=d;if(V<d){Y=V;}else{if(d+W-b<V){Y=Math.min(V,V-W+b);}}e.scrollTop=Y;}});})();(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.num","mstrmojo.string");mstrmojo.validation={STATUSCODE:{UNKNOWN:-1,VALID:0,INVALID:1,INVALID_EMPTY:2,INVALID_CHAR:3,INVALID_OUTOFRANGE:4,INVALID_REGEX:5,INVALID_VALIDATOR:6,INVALID_BAD_NUMERICFORMAT:7,INVALID_BAD_DATESTRING:8},TRIGGER:{NONE:0,ONBLUR:1,ONKEYUP:2,VALUESET:4,ALL:7},REGEXP:{US_ZIP:/^\d{5}([\- ]?\d{4})?$/,EMAIL_ADDRESS:/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+[\.])+([a-zA-Z0-9]{2,4})+$/,SOCIAL_SECURITY_NUMBER:/^((?!000)(?!666)\d{3})(\s|\-)?((?!00)\d{2})\2((?!0000)\d{4})$/,PHONE_NUMBER:/^(?!-)[ \d\-\(\)\.\+]+$/,FILE_NAME:new RegExp('^[^:*?"<>|/\\\\()]+$'),FOLDER_PATH_WIN:new RegExp('^([a-zA-Z]:|\\\\\\\\[^:*?"<>|/\\\\]+|[^:*?"<>|/\\\\]*)(\\\\[^:*?"<>|/\\\\]+)*(\\\\){0,1}$'),FOLDER_PATH_UNIX:new RegExp('^(/){0,1}([^:*?"<>|/\\\\]+/)*([^:*?"<>|/\\\\]+){0,1}$'),PRINTER_PATH_SINGLE:new RegExp('^[^$%:*?"<>|/\\\\]*$'),PRINTER_PATH_MULTIPLE:new RegExp('^((/|\\\\\\\\)[^$%:*?"<>|/\\\\]+)((/|\\\\)[^$%:*?"<>|/\\\\]+)*(/|\\\\){0,1}$')}};var H=mstrmojo.validation,B=H.TRIGGER,b=H.STATUSCODE,A={"-1":-1,1:1,2:1,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:4,12:4,13:4,14:6,15:6,16:6,17:3,18:3,21:2,22:2,23:3,24:4,25:3,30:5,34:5};H.VALIDATOR={DEMO:function N(e){var d=parseInt(e,10),f=mstrmojo.validation.STATUSCODE;if(d===0||d===1||d>10){return{code:f.VALID};}return{code:f.INVALID,msg:"This field must be either 0, 1 or greater than 10"};},VALIDATE_PHONENO:function I(d){var e=String(d).replace(/[^\d]/g,"");if(e.length<10){return{code:b.INVALID,msg:mstrmojo.desc(9203,"A telephone number must contain at least 10 digits.")};}if(!H.REGEXP.PHONE_NUMBER.test(d)){return{code:b.INVALID,msg:mstrmojo.desc(9204,"The telephone number contains invalid characters.")};}return{code:b.VALID};},VALIDATE_ZIPCODE:function G(d){var f="",e=this.dtp;if(!H.REGEXP.US_ZIP.test(d)){if(H.isNumeric(e)||H.isInt(e)){f=mstrmojo.desc(9208,"A zip code must be 5 digits or 5+4 digits.");}else{if(H.isString(e)){f=mstrmojo.desc(9206,"The zip code is invalid");}}return{code:b.INVALID,msg:f};}return{code:b.VALID};},VALIDATE_EMAIL:function T(d){var e=d.indexOf("@");if(e===-1){return{code:b.INVALID,msg:mstrmojo.desc(9197,"The email address is missing an at sign (@).")};}if(d.substring(e).indexOf(".")===-1){return{code:b.INVALID,msg:mstrmojo.desc(9198,"The email address is missing a period on the domain.")};}return H.REGEXP.EMAIL_ADDRESS.test(d)?{code:b.VALID}:{code:b.INVALID,msg:mstrmojo.desc(9207,"The email address is invalid.")};},VALIDATE_SSN:function Q(d){var f=this.dtp,e;if(H.isNumeric(f)||H.isInt(f)){e=String(d).replace(/[^\d]/g,"");if(e.length!==9){return{code:b.INVALID,msg:mstrmojo.desc(9209,"A Social Security Number must be 9 digits.")};}}if(!H.REGEXP.SOCIAL_SECURITY_NUMBER.test(d)){return{code:b.INVALID,msg:mstrmojo.desc(9210,"The Social Security Number is invalid.")};}return{code:b.VALID};}};H.isInt=function D(d){return A[d]===1;};H.isNumeric=function Y(d){return A[d]===2||A[d]===5;};H.isString=function J(d){return A[d]===3;};var C=window.mstrConfig,L=C.listSep,S=mstrmojo.expr,M=S.DTP,Z=mstrmojo.num,U=mstrmojo.string,F=mstrmojo.date;function P(k,l){var h=k.dtp,j=k.constraints,n=j.allowedFormatChars||"",g=(A[h]===1),d=(A[h]===2),e=(A[h]===6),m=mstrmojo.locales.number.THOUSANDSEPARATOR,f=mstrmojo.locales.number.DECIMALSEPARATOR,i;if(g){if(!k._intRegExp){n+="0-9-"+(k.isList?L:"")+m;k._intRegExp=new RegExp("[^"+n+"]");}i=k._intRegExp;}if(d){if(!k._numericRegExp){n+="0-9-"+(k.isList?L:"")+f+m;k._numericRegExp=new RegExp("[^"+n+"]");}i=k._numericRegExp;}return !!i&&i.test(l);}function c(k,m){var h=k.dtp,j=k.constraints,g=(A[h]===1),d=(A[h]===2),e=(A[h]===6),f=j.min,l=j.max,i;if(f===undefined&&l===undefined){return false;}if(g||d){return Z.inNumericRange(m,f,l)!==0;}if(e){return F.inDateTimeRange(m,f,l)!==0;}return false;}function K(e,d){return !Z.isNumeric(d);}function R(g,e){var f=(g.dtp===M.DATE),d=(g.dtp===M.TIME);return(f?!F.isDate(e):(d?!F.isTime(e):!F.isDateAndOrTime(e)));}mstrmojo._CanValidate=mstrmojo.provide("mstrmojo._CanValidate",{constraints:null,required:false,dtp:M.INTEGER,isList:false,autoFormat:false,validationStatus:null,init:function W(d){this._super(d);if(!this.constraints){this.constraints={};}var e=this.constraints;if(!e.hasOwnProperty("trigger")){e.trigger=B.NONE;}},_set_value:function(i,f){var g=this.value,e=(g!==f);if(e){this.value=f;var h=this.constraints.trigger,d=(h&B.VALUESET)>0;if(d){this.validate(f);}}return e;},validate:function O(){var f=(this.value!==null&&this.value!==undefined)?this.value:"",j=this.isList?f.split(L):[f],h,e,k,d=j.length,g;for(g=0;g<d;g++){h=this.doValidation(j[g]);e=(h.code>b.VALID);if(e){if(d>1){h.msg=mstrmojo.locales.validation.invalidValueInListError.replace("#",j[g]||" ");}break;}}k=e?"onInvalid":"onValid";if(!e&&this.autoFormat){this.format();}this.set("validationStatus",h);if(this[k]){this[k](h);}},format:function X(){var j=this.dtp,f=(A[j]===6);if(!f){return ;}var l=mstrConfig.listSep,o=this.value||"",e=this.isList?o.split(l):[o],n=j===14,m=[],d,g=mstrmojo.locales.datetime,k=e.length,h;for(h=0;h<k;h++){o=e[h];d=F.parseDateAndOrTime(o);if(d){if(n&&d.date){m.push(F.formatDateInfo(d.date,g.DATEOUTPUTFORMAT));}else{m.push((d.date?F.formatDateInfo(d.date,g.DATEOUTPUTFORMAT):"")+" "+(d.time?F.formatTimeInfo(d.time,g.TIMEOUTPUTFORMAT):""));}}}this.set("value",m.join(l));},isValid:function V(){var d=this.validationStatus;if(!d){this.validate();}return this.validationStatus.code===b.VALID;},clearValidation:function a(){this.set("validationStatus",{code:b.VALID});if(this.onClearValidation){this.onClearValidation();}},doValidation:function E(p){var m=this.constraints,n=m.regExp,f=m.validator,d={id:this.id,code:b.VALID,msg:""},l=this.dtp,k=(A[l]===1),e=(A[l]===2||A[l]===5),g=(A[l]===3),h=(A[l]===6),j=U.isEmpty(p),o=String(p).length,i="",t=mstrmojo.locales.validation;if(this.required&&j){d.code=b.INVALID_EMPTY;d.msg=t.requiredFieldError;return d;}p=U.trim(p);if(!j&&P(this,p)){if(k){i=t.integerDataType;}if(e){i=t.numericDataType;}if(h){i=t.dateDataType;}d.code=b.INVALID_CHAR;d.msg=t.invalidCharError.replace("#",i);return d;}if(!j&&h&&R(this,p)){d.code=b.INVALID_BAD_DATESTRING;d.msg=t.invalidDateStringError;return d;}if(!j&&(e||k)&&K(this,p)){d.code=b.INVALID_BAD_NUMERICFORMAT;d.msg=t.invalidNumericFormatError;return d;}if(!j&&(k||e||h)&&c(this,p)){d.code=b.INVALID_OUTOFRANGE;if(m.min!==null&&m.max!==null){i=t.outofRangeError.replace("# ","").replace("##",m.min).replace("###",m.max);}else{if(m.min!==null){i=t.noLessMinError.replace("##",m.min).replace("# ","");}else{if(m.max!==null){i=t.noGreaterMaxError.replace("###",m.max).replace("# ","");}}}d.msg=i;return d;}if(g&&m.minLen!==null&&m.maxLen!==null){if(o<m.minLen||o>m.maxLen){d.code=b.INVALID;d.msg=mstrmojo.desc(9211).replace(/#/,m.minLen).replace(/##/,m.maxLen);return d;}}if(n&&!n.test(p)){d.code=b.INVALID_REGEX;d.msg=mstrmojo.desc(9205);return d;}var q=f&&f.apply(this,[p]);if(q){d.code=q.code;d.msg=q.msg;return d;}return d;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var D=1,B="mstrmojo-itemwrap";mstrmojo.ListMapperHoriz=mstrmojo.provide("mstrmojo.ListMapperHoriz",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table" cellspacing="0" cellpadding="0"><tbody><tr>',markupSuffix:"</tr></tbody></table>",itemWrapperPrefix:function(H){return'<td class="'+this.getWrapperCss(H)+'">';},getWrapperCss:function(H){return"mstrmojo-itemwrap-td";},itemWrapperPrefill:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",itemWrapperSuffix:"</td>",wrapperNodes:function G(H){return this.wrapperParentNode(H).cells;},wrapperParentNode:function F(H){return H.firstChild.rows[0];},createWrapperNode:function E(H){var I=H.ownerDocument,J=I.createElement("td");return J;},findScrollRange:function C(U,L,S,X,I,P,Y,W){var Q=this.wrapperNodes(U),R=parseInt(L/2,10),K=parseInt(Math.log(L)/Math.log(2),10),J=0,H=L-1,T=I+P,M=Q[0].offsetLeft,O;for(var V=1;V<=K;V++){O=Q[R].offsetLeft-M+Y;if(O<=I){J=R;}else{if(O>=T){H=R;}}var N=Math.round(L/Math.pow(2,V+1));R+=(O>I)?-N:N;R=Math.min(Math.max(0,R),L-1);}return{start:J,end:H};},findIndex:function A(I,M,K){if(M&&K){var H=I.domNode,L=this.wrapperParentNode(M),J=K.parentNode;while(J){if(J===L){return mstrmojo.array.findBin(this.wrapperNodes(M),K,"offsetLeft",I.items&&I.items.length);}else{if(J===H){break;}}K=J;J=K.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.WidgetListBuilder");mstrmojo.WidgetTreeBuilder=mstrmojo.provide("mstrmojo.WidgetTreeBuilder",mstrmojo.mixin({newContext:function A(B){var D=this._super(B);if(!B.itemFunction&&D.itemFunc){var C=D.itemFunc;D.itemFunc=function(G,F,H){var E=C(G,F,H);if(E){E.tree=H.tree||H;}return E;};}return D;}},mstrmojo.hash.copy(mstrmojo.WidgetListBuilder)));})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array");var B=mstrmojo.array;mstrmojo.ObjectBrowserDataProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ObjectBrowserDataProvider",path:mstrConfig.taskURL,serverRequest:function(C,D){if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(C,D,{silent:true});}else{mstrmojo.xhr.request("POST",this.path,D,C,undefined,this.XServer,this.baseParams);}},fetchFolderContents:function(C,D,G){var E=C.blockCount,F={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockCount:E,includeAncestorInfo:"true",includeObjectDesc:C.includeObjectDesc};if(C.folderLinksContextId){F.folderLinksContextId=C.folderLinksContextId;}if(C.sId){F.sessionState=C.sId;}if(D.fid){F.rootFolderID=D.fid;}else{if(D.fty){F.rootFolderType=D.fty;}}if(C.browsableTypes){F.objectType=C.browsableTypes;}if(D.blockBegin){F.blockBegin=D.blockBegin;}if(D.searchPattern){if(C.enableQuickSearch){F.quickSearch=C.enableQuickSearch;}F.searchPattern=D.searchPattern;if(D.recursive){F.recursive=D.recursive;}}this.serverRequest(F,G);},newFolder:function(F,G,E,C){var D={taskId:"createFolder",taskContentType:"json",folderID:F,name:G,description:E};this.serverRequest(D,C);},loadObjects:function A(G,H,C,F){var D=[],E=[];B.forEach(G,function(I){D.push(I.did);E.push(I.t);});if(G.length>0&&F){this.serverRequest({taskId:"getObjectInfo",objectIDs:D.join(","),objectTypes:E.join(","),includeDetails:true},H,C);}else{H.success();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var D=4,C=5,B=6;function E(H,I){var J=I.callback;H.model.submitRequest({success:function(){H.factId=I.factId;H.factName=I.factName;H.expression=I.expression;H.columnId=I.columnId;H.tableId=I.tableId;if(J&&J.success){J.success(H);}}},{manipulationtype:D,objectid:I.factId,columnid:I.columnId,expression:I.expression,tableids:I.tableId,showWait:true},"schemaManipulation");}mstrmojo.architect.obj.FactInfo=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.FactInfo",init:function F(I){this._super(I);var H=this,J=I.callback;if(I.isNew){E(H,I);}else{if(J&&J.success){J.success(H);}}},factId:undefined,factName:undefined,expression:undefined,columnId:undefined,tableId:undefined,remove:function A(I){var H=this;H.model.submitRequest({success:function(){if(I&&I.success){I.success(H.factId);}}},{manipulationtype:C,objectid:H.factId,tableids:H.tableId,showWait:true},"schemaManipulation");},update:function G(J,I,K){var H=this;H.model.submitRequest({success:function(){H.expression=J;H.columnId=I;if(K&&K.success){K.success(H.factId);}}},{manipulationtype:B,objectid:H.factId,expression:J,columnid:I,tableids:this.tableId,showWait:false},"schemaManipulation");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.architect.obj.BaseForm=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.BaseForm",init:function A(B){this._super(B);},baseFormId:undefined,expression:undefined,columnId:undefined});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.EnumColumnDataTypes","mstrmojo.warehouse.EnumObjectTypes");var F=mstrmojo.string,C=mstrmojo.warehouse.EnumObjectTypes.COLUMN,A=mstrmojo.desc(11428,"[unknown]");function E(H){var G=mstrmojo.architect.EnumColumnDataTypes;return("["+G[H].n+"]"||A);}mstrmojo.architect.obj.Column=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Column",init:function D(G){this._super(G);var I,H;if(G){if(G.dbInfo){I=G.dbInfo;this.cln=F.decodeHtmlString(I.cln).replace(/&apos;/g,"'");this.cmid=I.cmid;this.sta=parseInt(I.sta,10);this.dt={tp:I.dt.tp,ps:I.dt.prec,sc:I.dt.scl};this.n=this.cln+": "+this.getDataTypeName();}else{if(G.tableInfo){I=G.tableInfo;H=I.def;this.cln=F.decodeHtmlString(H.cln).replace(/&apos;/g,"'");this.cmid=I.did;this.dt={tp:H.dt.tp,ps:H.dt.ps,sc:H.dt.sc};this.n=this.cln;}else{if(G.colDef){H=G.colDef;this.cln=F.decodeHtmlString(H.cln).replace(/&apos;/g,"'");this.cmid="";this.dt={tp:H.dt.tp,ps:H.dt.ps,sc:H.dt.sc};this.n=this.cln;}}}}},cln:undefined,n:undefined,tp:C,t:C,cmid:undefined,def:undefined,dt:undefined,getDataTypeName:function B(){return E(this.dt.tp);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var I=mstrmojo.array,E=mstrmojo.hash,N=mstrmojo.func.wrapMethods;function M(T){var R=[],O=mstrApp.getRootController().model.dbObjectsDisplayOptions,P=mstrApp.getRootController().model.dbObjectsConnectionType,S=this,Q=this.dbmsTypeFilter;I.forEach(T,function(U){if((U.disp&O)===O&&(Q.length===0||I.indexOf(Q,U.dbType)>-1)){if((U.connType&4)===4){R.push(U);}else{if((U.connType&P)===P){R.push(U);}}}});if(!S.dbVersion2dbId){S.dbVersion2dbId={};I.forEach(R,function(U){I.forEach(U.dbVersions,function(V){S.dbVersion2dbId[V.v]=U.id;});});}this.dsnMapDBs=T;this.supportedDBs=R;}function C(){var O=this;E.forEach(O.dbTypes,function(P){if(P.catSQL===1){O.catalogDbTypes.push(P);}});}function B(O){O=O.sort(function(Q,P){return Q.n.toLowerCase().localeCompare(P.n.toLowerCase());});O.unshift({n:mstrmojo.desc(8526,"select a dsn"),nU:mstrmojo.desc(8526,"select a dsn").toUpperCase(),des:0});return O;}function F(O){O=O.sort(function(Q,P){return Q.n.toLowerCase().localeCompare(P.n.toLowerCase());});return O;}function A(R){if(!(R.DBInfo&&R.DBInfo.Preferences)){return R;}var P,Q=JSON.stringify(R),S,O=R.DBInfo.Preferences.driverNameSuffix;if(mstrApp.isSingleTier){if(navigator.platform.indexOf("Win")===-1){P=I.find(O,"n","DesktopMac");}else{P=I.find(O,"n","DesktopWin");}}else{P=I.find(O,"n","Platform");}S=O[P];return JSON.parse(Q.replace(/!#DRIVERSUFFIX#!/g,S.value));}function L(P){var O=this;if(O.loaded){P.success();}else{if(this.dbmsTypeFilter.length>0){this.dbmsTypeFilter.push(1100);}mstrApp.getRootController().model.submitRequest(N({success:function(R){R=A(R);var Q=(R.DBMS.dbmss.dbms?[].concat(R.DBMS.dbmss.dbms):[]);O.dbms=Q;O.dbms.sort(function(T,S){var V=T.db_ver;var U=S.db_ver;if(V<U){return 1;}if(V>U){return -1;}return 0;});O.dsndbms=Q.sort(function(T,S){return T.n.toLowerCase().localeCompare(S.n.toLowerCase());});M.call(O,R.DBInfo.DBS);O.dbVersions=R.DBInfo.dbVersions;O.dbTypes=R.DBInfo.dbTypes;C.call(O);O.dbIDs=R.DBInfo.dbIDs;O.drivers=F(R.Drivers.Drivers);O.preferences=R.DBInfo.Preferences;O.dsns=B(R.DSNs.Dsns);O.loaded=true;}},P),{taskId:"arch.getDBObjects",skipSchemaIDCheck:true,showWait:true,typeFilter:this.dbmsTypeFilter,versionFilter:this.dbmsVersionFilter,typeExcludeFilter:O.dbmsTypeExcludeFilter.join(","),versionExcludeFilter:O.dbmsVersionExcludeFilter.join(","),flags:15});}}function D(O,Q){var P=this;mstrApp.getRootController().model.submitRequest(N({success:function(R){R=A(R);if(R.DBInfo){M.call(P,R.DBInfo.DBS);P.dbVersions=R.DBInfo.dbVersions;P.dbTypes=R.DBInfo.dbTypes;C.call(P);P.dbIDs=R.DBInfo.dbIDs;P.preferences=R.DBInfo.Preferences;}if(R.Drivers){P.drivers=F(R.Drivers.Drivers);}if(R.DSNs){P.dsns=B(R.DSNs.Dsns);}}},Q),{taskId:"arch.getDBObjects",skipSchemaIDCheck:true,showWait:true,flags:O});}mstrmojo.warehouse.obj.DBObjects=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.obj.DBObjects",dbms:[],dsndbms:[],supportedDBs:[],dsnMapDBs:[],drivers:[],dsns:[],dbVersions:undefined,dbTypes:undefined,catalogDbTypes:[],dbIDs:undefined,preferences:undefined,dbmsTypeFilter:[],dbmsVersionFilter:[],dbmsTypeExcludeFilter:[],dbmsVersionExcludeFilter:[],DBInfo:undefined,DBS:undefined,DSNs:undefined,Dsns:undefined,Preferences:undefined,Drivers:undefined,DBMS:undefined,dbmss:undefined,disp:undefined,dbVersion2dbId:undefined,load:function K(P,O,Q){this.dbmsTypeFilter=P;this.dbmsVersionFilter=O;L.call(this,Q);},populateDBProperties:function J(O){if(this.supportedDBs.length>0){O.success();}else{D.call(this,8,O);}},reloadDrivers:function G(O){D.call(this,2,O);},reloadDSNs:function H(O){D.call(this,4,O);},loaded:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._LoadsScript","mstrmojo.Binding","mstrmojo._HasBindings","mstrmojo._HasMarkup","mstrmojo._HasTooltip","mstrmojo.css");mstrmojo.Widget=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._LoadsScript,mstrmojo._HasBindings,mstrmojo._HasMarkup,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.Widget",domNode:null,hasRendered:false,visible:true,enabled:true,tooltip:"",cssClass:"",cssText:"",cssDisplay:"block",slot:"",alias:"",parent:null,init:function A(C){this._super(C);var D=this.parent;if(!D||D.hasInitBindings){this.initBindings();}},destroy:function B(C){if(this.hasRendered){this.unrender(C);}if(this.bindings){this.destroyBindings();}this._super();},invalidate:mstrmojo.emptyFn,widgetResized:mstrmojo.emptyFn});mstrmojo.Widget.cssTextMarkupMethod=function(){this.domNode.style.cssText=this.cssText||"";};mstrmojo.Widget.visibleMarkupMethod=function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";};mstrmojo.Widget.topMarkupMethod=function(){var C=this.top;if(C){this.domNode.style.top=C;}};mstrmojo.Widget.leftMarkupMethod=function(){var C=this.left;if(C){this.domNode.style.left=C;}};mstrmojo.Widget.heightMarkupMethod=function(){var C=this.height;if(C){this.domNode.style.height=C;}this.widgetResized();};mstrmojo.Widget.widthMarkupMethod=function(){var C=this.width;if(C){this.domNode.style.width=C;}this.widgetResized();};mstrmojo.Widget.enabledMarkupMethod=function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumObjectTypes");var J=1,I=2,D=3,A=mstrmojo,E=A.hash,K=mstrmojo.warehouse.EnumObjectTypes,B=K.FACT;function G(N,M,O){N.model.submitRequest({success:function(){N.name=M;if(O&&O.success){O.success();}}},{objectid:N.id,objecttype:B,manipulationtype:D,objectname:M},"schemaManipulation");}function H(M,O){var N=O.callback;M.model.submitRequest({success:function(P){var Q=P.mi["in"].oi[1]||P.mi["in"].oi;M.id=Q.did;M.name=Q.n;M.tables={};if(N&&N.success){N.success(M);}}},{manipulationtype:J,objecttype:B,objectname:O.name,showWait:false},"schemaManipulation");}mstrmojo.architect.obj.Fact=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.Fact",init:function L(N){this._super(N);var M=this,O=N.callback;if(N.isNew){H(M,N);}else{this.tables={};if(O&&O.success){O.success(this);}}},id:undefined,name:undefined,isNew:undefined,tables:undefined,sum:true,count:false,max:false,min:false,variance:false,average:false,rename:function C(M,N){if(mstrApp.getRootController().validateName(B,M,this.name)){G(this,M,N);}},remove:function F(O){var M=this,N=M.id;M.model.submitRequest({success:function(){E.forEach(M.tables,function(P){P.removeFactInfo(false,N,null);});if(O&&O.success){O.success(M.id);}}},{manipulationtype:I,objecttype:B,objectid:M.id},"schemaManipulation");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");var U=mstrmojo.hash,G="-2147213500";function A(b,a){var Z=this.schemaInstanceID,X=a.showWait;if(!b.failure){b.failure=function Y(c){switch(c.getResponseHeader("X-MSTR-TaskErrorCode")){case G:mstrmojo.alert("The operation was unable to be completed because another user is mofifying the same object<br /><br />"+mstrApp.getRootController().cleanError(c.getResponseHeader("X-MSTR-TaskFailureMsg")));break;default:mstrmojo.alert(mstrApp.getRootController().cleanError(c.getResponseHeader("X-MSTR-TaskFailureMsg")));}};}if(!a.skipSchemaIDCheck&&!Z){throw new Error("Schema ID doesn't exist. Cannot process task.");}if(Z){a=U.copy(a,{schemaid:Z});}delete a.skipSchemaIDCheck;delete a.showWait;mstrApp.serverRequest(b,a,X);}mstrmojo.architect.ArchitectDataService=mstrmojo.declare(mstrmojo.Obj,null,{submitRequest:function R(Y,X){A.call(this,Y,X);},pingServer:function D(){A.call(this,{},{taskId:"keepSessionAlive",skipSchemaIDCheck:true});},getProjects:function J(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.getProjects"}));},getSystemFunctions:function W(Y,X){A.call(this,Y,U.copy(X,{taskId:"getSystemFunctions"}));},search:function K(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.search",showWait:true}));},nameSearchTable:function I(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.nameSearchTable",showWait:false}));},getHierarchyInfo:function S(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.getHierarchyInfo",showWait:true}));},getLinkInfo:function E(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.getLinkInfo",showWait:true}));},parse:function P(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.Parse",showWait:true}));},addProjectDBRole:function C(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.addProjectDBRole",showWait:true}));},createProject:function T(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.createProject",showWait:true}));},deleteProject:function Q(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.deleteProject",showWait:true}));},renameProject:function M(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.renameProject",showWait:true}));},schemaAction:function V(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.schemaInstanceAction"}));},catalogAction:function O(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.catalogAction",showWait:true}));},schemaManipulation:function H(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.schemaManipulation",showWait:true}));},refreshEngineSchema:function L(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.refreshEngineSchema",showWait:true}));},loadLogicalTables:function B(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.loadLogicalTables",showWait:true}));},getObjects:function F(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.getObjectInBulk",showWait:true}));},renameObject:function N(Y,X){A.call(this,Y,U.copy(X,{taskId:"arch.renameObject",showWait:true}));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var U=mstrmojo.array,O=mstrmojo.hash,V=mstrmojo.func.wrapMethods,B=mstrmojo.warehouse.EnumObjectTypes,K=parseInt(B.TRANSFORMATION,10),M=parseInt(B.COLUMN,10),L=mstrmojo.desc(12246,"New transformation"),S=1,J=2,N=3,F=1005,A=1006;function Q(Z,Y){var X=this;X.isDirty=true;X.model.submitRequest({success:function(b){var a=b.mi["in"].oi;X.id=a.did;X.name=Z;if(Y&&Y.success){Y.success(X);}}},{manipulationtype:S,objecttype:K,objectname:Z},"schemaManipulation");}mstrmojo.architect.obj.Transformation=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Transformation",init:function P(X){this.model=X.mdl;this.elements={};if(X.isNew){if(X.defaultName){Q.call(this,mstrApp.rootController.findNextName(L,O.valarray(this.model.transformations),"name"),X.callback);}else{if(mstrApp.getRootController().validateName(K,X.newTransformationName,this.name)){Q.call(this,X.newTransformationName,X.callback);}}this.isLoaded=true;}else{this.id=X.id;this.name=X.n;this.onetoOneMappingType=X.onetoOneMappingType;this.transformationAllAttributes=X.transformationAllAttributes;this.isLoaded=false;}},tri:undefined,tris:undefined,ban:undefined,name:"",id:"",tp:K,transformationAllAttributes:true,onetoOneMappingType:true,elements:{},isDirty:false,isLoaded:false,setMappingType:function C(X){var Y=this;Y.onetoOneMappingType=X;Y.isDirty=true;},setAttributeScope:function D(X){var Y=this;Y.transformationAllAttributes=X;Y.isDirty=true;},commit:function I(h){var e=this,Z=mstrApp.rootController,d=[],c=[],X=[],g=[],f=Z.getObjectCount(e.elements),b=0,a=e.onetoOneMappingType?1:4,Y=e.transformationAllAttributes?0:1;if(e.isDirty){O.forEach(e.elements,function(j){Z.validateExpr({expr:j.expression,tid:j.tableID,vo:1},{success:function k(l){if(l&&l.mi.oi.tknstrm.mi){Z.trimTokenEnds(l.mi.oi.tknstrm.mi.tkn);U.forEach([].concat(l.mi.oi.tknstrm.mi["in"].oi),function(m){if(m.tp===M){if(j.isValid===true){d.push(j.attributeID);c.push(j.expression);X.push(j.tableID);g.push(m.did);}}});}},complete:function i(){if(++b===f){e.model.submitRequest({success:function(){e.isDirty=false;if(h&&h.success){h.success();}}},{manipulationtype:F,tableids:X.join(";"),attributeids:d.join(";"),expressions:c.join(";"),columnIDs:g.join(";"),objectid:e.id,mpt:a,roleProcess:Y},"schemaManipulation");}}});});}else{if(h&&h.success){h.success();}}},addElement:function H(X,a,b,g,c,e){var d=this,h=false,Y={success:function f(){h=true;mstrApp.rootController.populateTableContents(b,{success:mstrmojo.emptyFn()});},complete:function f(){d.elements[X]={attributeID:X,expression:a,tableID:b,attributeName:c,tableName:e,isValid:h};if(g&&g.success()){g.success();}}};if(b){var Z=d.model.validateTransformationExpr({expr:a,tid:b,vo:null},Y);if(Z===false){Y.complete();}}else{Y.complete();}d.isDirty=true;},removeElement:function R(X,Z){var Y=this;delete Y.elements[X];Y.isDirty=true;if(Z&&Z.success){Z.success(Y);}},rename:function E(Y){var X=this;X.isDirty=true;if(mstrApp.getRootController().validateName(K,Y,this.name)){X.model.submitRequest({success:function(){X.name=Y;}},{manipulationtype:N,objecttype:K,objectid:this.id,objectname:Y},"schemaManipulation");return true;}return false;},remove:function W(Y){var X=this;X.isDirty=true;X.model.submitRequest({transformation:this,callback:Y,success:function(){if(this.callback&&this.callback.success){this.callback.success(this.transformation.id);}}},{manipulationtype:J,objecttype:K,objectid:this.id},"schemaManipulation");},load:function G(a){var Y=this,X={success:function Z(c){Y.isLoaded=true;var b=c&&c.mi.tris.tri;if(b){b=b.length?b:[b];O.forEach(b,function(d){Y.elements[d.atid]={attributeID:d.atid,expression:d.exp,tableID:d.tbid,attributeName:d.ban,tableName:d.tbn,isValid:true};});}}};if(Y.isLoaded){if(a&&a.success){a.success();}}else{Y.model.submitRequest(V(X,a),{manipulationtype:A,objectid:Y.id},"schemaManipulation");}},getTransformationData:function T(){var b=this,a,Z={n:b.name,did:b.id,tp:K,onetoOneMappingType:b.onetoOneMappingType,transformationAllAttributes:b.transformationAllAttributes,isVisible:function X(e,d){return b.model.handleVisibleAction(e,d);},isChecked:function c(e,d){return b.model.handleCheckAction(e,d);},isEnabled:function Y(e,d){return b.model.handleEnabledAction(e,d);},elements:[]};if(b.isLoaded){O.forEach(b.elements,function(d){a=b.model.getTable(d.tableID);Z.elements.push({attributeName:d.attributeName,attributeID:d.attributeID,expression:d.expression,tableName:d.tableName,tableID:d.tableID,isValid:d.isValid});});}return Z;},isValid:function(){var Y=this.elements,X=!!(mstrApp.rootController.getObjectCount(Y));O.forEach(Y,function(Z){X=X&&Z.isValid;return X;});return X;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.architect.ui.factories.ViewFactory=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.ui.factories.ViewFactory",views:undefined,viewConfig:{editorLeft:true,editorTop:true,editorBottom:true,editorRight:true,leftVisible:true,topVisible:true,bottomVisible:true,rightVisible:true,showDB:false},newLeftNavigationPanel:mstrmojo.emptyFn,newTopEditorPanel:mstrmojo.emptyFn,newBottomEditorPanel:mstrmojo.emptyFn,newRightItemsPanel:mstrmojo.emptyFn,closeObject:mstrmojo.emptyFn,updateViewObjectName:function A(C,B){if(this.views.editorTop){this.views.editorTop.updateViewObjectName(C,B);}},toggleViewList:mstrmojo.emptyFn,viewListVisible:true,beforeLeave:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.Obj");var K=mstrmojo.hash;var P=0;var F=[];var J={};var L=false;function I(T){var U=T.callback;if(U.submission){U.submission(T.id,this.userInteractionRequired(T),T);}this.submitRequest(T);}function G(){if(F.length&&!L){I.call(this,F.shift());}}mstrmojo.ServerProxy=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ServerProxy",transport:null,cnt:0,request:function E(d,a,U,V){if(U){this.cancelRequests();}var X=this.id,Y=this.transport,T=mstrmojo.now()+a.taskId+P++,W=d.canceled||mstrmojo.emptyFn;d.canceled=function(e){W();d.complete(true);return Y.cancelRequest(e);};d=mstrmojo.func.wrapMethods(d,{complete:function(e){mstrmojo.all[X].deleteRequest(e);}});var Z=!K.isEmpty(this._requests),b=this.createRequest(T,d,a,V),c=(L||Z)&&!V.doNotHold;if(c){F.push(b);}else{I.call(this,b);}return T;},hasRequests:function O(){return !K.isEmpty(this._requests)||L;},createRequest:function Q(V,X,W,T){var U=this._requests;if(!U){U=this._requests={};}U[V]={id:V,callback:X,params:W,config:T};return U[V];},submitRequest:function M(T){this.transport.serverRequest(this.id,T.id,T);},cancelRequests:function S(){var T=false;K.forEach(this._requests,function(U){if(U.gotResponse===undefined){T|=U.callback.canceled(U.id);}});this._requests={};F=[];return T;},cancelRequest:function B(X){var U=false,W=this._requests[X],V,T=F.length;for(V=0;V<T;V++){if(F[V]===W){break;}}if(V<T){F.splice(V,1);delete this._requests[X];U|=W.callback.canceled(W.id);}return U;},response:function A(X,T,V){$MAPF(false,"AndroidServerTransport","transportRequest");var W=this.getRequest(X);if(W){W.gotResponse=true;var Y=W.callback,U=(T&&!V.mstrerr)?"success":"failure";try{if(Y[U]){Y[U](V,W);}}finally{Y.complete(X);}}G.call(this);},deleteRequest:function N(U){var T=this._requests;delete T[U];},getRequest:function H(U){var T=this._requests;return T&&T[U];},userInteractionRequired:function C(T){return false;},addLoadingGraph:function D(T){J[T]=true;L=true;},removeLoadingGraph:function R(T){delete J[T];if(K.isEmpty(J)){L=false;G.call(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumObjectTypes");var B=mstrmojo,C=B.hash,F=B.array,G=mstrmojo.warehouse.EnumObjectTypes;function D(K,L){var M=[];F.forEach(K,function(N){if(N.tp===L){M.push(N);}});return M.sort(function(O,N){return(O.n<N.n)?-1:(O.n>N.n)?1:0;});}mstrmojo.warehouse.obj.TableData=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.TableData",init:function I(N){var M=N.model,L=function(Q,P){return M.handleVisibleAction(Q,P);},K=function(Q,P){return M.handleCheckAction(Q,P);},O=function(Q,P){return M.handleEnabledAction(Q,P);};this.did=N.id;this.n=N.n;this.items=[];this.isVisible=L;this.isChecked=K;this.isEnabled=O;this.tp=N.tp;this.model=M;this.multi=N.multi;this.isLeaf=N.isLeaf;this.bold=N.bold;this.dbrole=N.dbrole;this.ns=N.ns||"";this.isError=N.isError;this.ttp=N.ttp||"";this.sta=N.sta||0;this.isLocked=N.isLocked;this.size=N.size;this.dbtn=N.dbtn||N.n;this.isView=N.isView;this.icntp=N.icntp;},model:undefined,multi:false,did:undefined,n:undefined,items:undefined,isVisible:undefined,isEnabled:undefined,isChecked:undefined,isLocked:false,size:0,isLeaf:false,bold:false,dbrole:undefined,tp:undefined,x:undefined,y:undefined,w:undefined,h:undefined,isError:false,ttp:"",sta:0,dbtn:undefined,ns:"",italics:false,addItem:function H(L,K,Q,R,T,N,P,O){var M=this,S={pdid:M.did,did:L,n:K,tp:Q,bfIdx:R,isVisible:M.isVisible,isChecked:M.isChecked,items:[],ttp:T,isLeaf:N,bold:P,unused:O};M.items.push(S);return S;},addSubItem:function J(Q,L,K,P,R,S,U,N,O){var M=this,T={pdid:M.did,did:L,sid:Q,n:K,tp:P,bfIdx:R,fcatId:S,isVisible:M.isVisible,isChecked:M.isChecked,ttp:U,isLeaf:N,bold:O};C.forEach(M.items,function(V){if(V.did===Q){V.items.push(T);return false;}return true;});return T;},addSubItemItem:function A(P,R,L,K,Q,S,T,V,N,O){var M=this,U={pdid:M.did,did:L,sid:P,n:K,tp:Q,bfIdx:S,fcatId:T,isVisible:M.isVisible,isChecked:M.isChecked,ttp:V,isLeaf:N,bold:O};C.forEach(M.items,function(W){if(W.did===P){C.forEach(W.items,function(X){if(X.did===R){X.items=X.items||[];X.items.push(U);return false;}return true;});return false;}return true;});return U;},sortElements:function E(){var M=this,K=M.items,L=[];M.items=L.concat(D(K,G.ATTRIBUTE),D(K,G.FACT),D(K,G.COLUMN));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumObjectTypes");var B=mstrmojo,E=B.hash,H=12,A=20,C=14,J=mstrmojo.warehouse.EnumObjectTypes,D=J.FORM;function I(M,L){var P=L.callback,O=[],N=L.categoryId;M.model.submitRequest({success:function(Q){O=Q.mi["in"].oi;E.forEach(O,function(R){if(R.tp===D){N=R.did;}});M.baseFormId=L.baseFormId;M.id=L.id||N;M.categoryId=N;M.attributeId=L.attributeId;M.columnId=L.columnId;M.expression=L.expression;M.sortType=L.sortType;M.browseSortType=L.browseSortType;M.isMultiLingual=L.isMultiLingual;M.baseFormType=L.baseFormType;M.useName=L.useName;M.useDescription=L.useDescription;M.isBrowseForm=L.isBrowseForm;M.isTemplateForm=L.isTemplateForm;M.tableId=L.tableId;if(P&&P.success){P.success(M);}}},{manipulationtype:H,objectid:L.attributeId,formcatid:L.categoryId,tableids:L.tableId,columnid:L.columnId,expression:L.expression,sorttype:L.sortType,browsesorttype:L.browseSortType,ismultilingual:(L.isMultiLingual)?1:0,baseformtype:L.baseFormType,usename:L.useName,usedesc:L.useDescription,isbrowseform:(L.isBrowseForm)?1:0,istemplateform:(L.isTemplateForm)?1:0,catn:L.catn,showWait:true},"schemaManipulation");}mstrmojo.architect.obj.Form=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Form",init:function K(L){this._super(L);var N=L.callback,M=this;if(L.isNew){I(M,L);}else{if(N&&N.success){N.success(this);}}},baseFormId:undefined,id:undefined,attributeId:undefined,categoryId:undefined,newCatId:undefined,expression:undefined,columnId:undefined,sortType:undefined,browseSortType:undefined,isMultiLingual:false,baseFormType:3,useName:undefined,useDesc:undefined,isBrowseForm:true,isTemplateForm:true,tableId:undefined,remove:function G(N){var L=this;L.model.submitRequest({success:function M(O){if(N&&N.success){N.success(L.id);}}},{manipulationtype:A,objectid:L.attributeId,formcatid:L.categoryId,showWait:true},"schemaManipulation");},update:function F(N){var L=this;L.model.submitRequest({success:function M(){if(N&&N.success){N.success(L);}}},{manipulationtype:C,objectid:L.attributeId,formcatid:L.categoryId,newformcatid:L.newCatId||"",tableids:L.tableId,columnid:L.columnId,expression:L.expression,sorttype:L.sortType,browsesorttype:L.browseSortType,ismultilingual:(L.isMultiLingual)?1:0,baseformtype:L.baseFormType,usename:L.useName,usedesc:L.useDescription,isbrowseform:(L.isBrowseForm)?1:0,istemplateform:(L.isTemplateForm)?1:0,showWait:true},"schemaManipulation");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var C=16,E=22,D=24;mstrmojo.architect.obj.Relationship=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Relationship",init:function G(H){this._super(H);if(H.isNew){this.model.submitRequest(this.callback,{manipulationtype:C,objectid:this.parentAttributeId,objectid2:this.childAttributeId,ert:(this.dimensionid===""?"1":"0"),tableids:this.relationTableId,dimensionid:this.dimensionid},"schemaManipulation");}else{var I=this.callback;if(I&&I.success){I.success(this);}}},relationTableId:undefined,relationTableName:undefined,parentAttributeId:undefined,parentAttributeName:undefined,childAttributeId:undefined,childAttributeName:undefined,relationType:undefined,dimensionid:"",children:[],remove:function A(H){this.model.submitRequest(H,{manipulationtype:E,objectid:this.parentAttributeId,objectid2:this.childAttributeId,dimensionid:this.dimensionid},"schemaManipulation");},addJointChildren:function B(K,M,J,L,I,O){var N=this,H={success:function(){N.relationType=L;N.relationTableId=I;if(O&&O.success){O.success(N);}}};this.model.submitRequest(H,{manipulationtype:D,objectid:K,objectid2:M,objectid3:J,ert:L,gdid:I},"schemaManipulation");},updateRelation:function F(J,L,K,I,N){var M=this,H={success:function(){M.relationType=K;M.relationTableId=I;if(N&&N.success){N.success(this);}}};this.model.submitRequest(H,{manipulationtype:D,objectid:J,objectid2:L,ert:K,gdid:I},"schemaManipulation");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B={TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};mstrmojo.ui.PopupConfig=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ui.PopupConfig",ENUM_CORNERS:B,isHostedWithin:true,position:null,hostProxyCssClass:"",hostId:"",hostElement:null,anchorElement:null,popupHandlers:null,alignment:null,alignWithAnchor:false,useTooltip:false,init:function E(F){this.clear();this._super(F);},setAlignment:function C(F,G){this.alignment={host:F,popup:G};},addPopupHandlers:function D(F,H,G){this.popupHandlers[F]={open:H,close:G};},clear:function A(){this.popupHandlers={};var F=this.ENUM_CORNERS;this.alignment={host:F.BOTTOM_LEFT,popup:F.TOP_LEFT};}});mstrmojo.ui.PopupConfig.ENUM_CORNERS=B;}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom");function Z(a,c){if(!mstrmojo.DocInfoWindow){return ;}var b=a;while(b){if(b instanceof mstrmojo.DocInfoWindow){b[c?"registerScrollLock":"releaseScrollLock"](this);break;}b=b.parent;}}var L=mstrmojo.array,C=mstrmojo.dom,P=mstrmojo.hash,W=mstrmojo.css,F="px";var B=false;function K(a,c){if(!mstrmojo.DocInfoWindow){return ;}var b=a;while(b){if(b instanceof mstrmojo.DocInfoWindow){b[c?"registerLock":"releaseLock"](this);this.lockIW=c?b:null;break;}b=b.parent;}}var A=mstrmojo.ui.PopupConfig.ENUM_CORNERS,T=A.TOP_LEFT,R=A.TOP_RIGHT,H=A.BOTTOM_RIGHT,G=A.BOTTOM_LEFT;function I(a){return(a===G||a===T);}function X(a){return(a===R||a===H);}function N(a){return(a===H||a===G);}function Q(a){return(a===R||a===T);}function U(h,c,n,t){var w=n.x,v=n.y,r=n.w||0,j=n.h||0,b=t.w,o=t.h,q=h.alignment,f=q.popup,e=q.host,u=X(e),x=N(e),p=false,l=false,d=false,m=false;if(I(f)){var g=w+b+(u?r:0);p=c.w<g;}if(Q(f)){var k=v+o+(x?j:0);l=c.h<k;}if(X(f)){var i=w-b+(u?r:0);d=i<0;}if(N(f)){var a=v-o+(x?j:0);m=a<0;}return{top:m,bottom:l,left:d,right:p};}function E(b){var a=this.popupConfig;if(a){P.forEach(a.popupHandlers,function(d,e){var c=d[b?"open":"close"];if(c){c.call(mstrmojo.all[e]||c,!!b);}});}}function J(b){var a=this.popupConfig;if(a&&!a.isHostedWithin){var c=this.hostProxy;if(c){c.style.display=b?"":"none";}}}function Y(a){return a!==undefined&&a!==null&&!isNaN(a);}mstrmojo._IsPopup={visible:false,lockIWForScroll:false,disposable:true,opener:null,onOpen:mstrmojo.emptyFn,onClose:mstrmojo.emptyFn,popupConfig:null,hostProxy:undefined,open:function M(c,a){E.call(this,true);if(this.updatePopupConfig){this.updatePopupConfig(a,c);}else{P.forEach(a,function(f,e){this.set(e,f);},this);}var b="popup-mid-render";this.set("opener",c);if(!this.hasRendered){var d=this.visible;this.visible=false;this.render();W.addClass(this.domNode,b);this.set("visible",d);}if(this.nudge){this.domNode.style.top="-10000px";}J.call(this,true);this.set("visible",true);if(this.lockIWForScroll){Z.call(this,this.opener,true);}if(a&&a.lockIW){K.call(this,a.lockIW,true);}if(this.nudge){this.nudge();}this.adjustCornersForPopupOverflow();this.onOpen();W.removeClass(this.domNode,b);},adjustCornersForPopupOverflow:function V(){var k=this.popupConfig;if(!k){return false;}var AH=(k.includeScroll!==undefined)?k.includeScroll:true;var n=k.position||C.position(k.anchorElement||k.hostElement,AH);if(!k.isHostedWithin){var x=this.hostProxy,q=this.hostProxy=document.createElement("div");document.body.appendChild(q);q.appendChild(this.domNode);if(x){x.parentNode.removeChild(x);}var e=q.style,r={x:"left",y:"top",w:"width"};q.className=k.hostProxyCssClass;e.position="absolute";e.background="none";e.height="0";L.forEach(["x","y","w"],function(AK){var AJ=n[AK];if(Y(AJ)){e[r[AK]]=AJ+F;}});}var AE=k.ENUM_CORNERS,v=AE.BOTTOM_LEFT,i=AE.BOTTOM_RIGHT,h=AE.TOP_RIGHT,AA=AE.TOP_LEFT;var AB=U(k,C.position(document.body),n,C.position(this.domNode)),w=AB.right,o=AB.bottom,d=AB.left,u=AB.top,z=k.alignment,p=z.popup,AI=z.host,g=p,c=AI;if(w||d){if(I(c)){c=Q(c)?h:i;}else{if(X(c)){c=Q(c)?AA:v;}}if(w&&I(g)){g=Q(g)?h:i;}else{if(d&&X(g)){g=Q(g)?AA:v;}}}if(o||u){if(I(c)){c=Q(c)?v:AA;}else{if(X(c)){c=Q(c)?i:h;}}if(o&&Q(g)){g=I(g)?v:i;}else{if(u&&N(g)){g=I(g)?AA:h;}}}if(u||w||o||d){if(B){console.log("Overflow directions: "+JSON.stringify(AB));}this._orgalgn={host:AI,popup:p};k.setAlignment(c,g);}if(!k.isHostedWithin){if(Y(n.y)&&Y(n.h)){this.hostProxy.style.top=(n.y+(N(g)?(k.alignWithAnchor===true?n.h:0):(k.alignWithAnchor===true?0:n.h)))+F;}}var y=N(c),AD=X(c),AC=N(g),m=X(g),j="auto",b="100%",a="0";var t=j,AF=j,l=j,f=j;if(AC){l=y?a:b;}else{t=y?b:a;}if(m){AF=AD?a:b;}else{f=AD?b:a;}var AG=this.domNode.style;AG.top=t;AG.right=AF;AG.bottom=l;AG.left=f;return true;},close:function O(b){if(this.onClose){this.onClose(b);}J.call(this,false);if(this.lockIWForScroll){Z.call(this,this.opener,false);}this.set("visible",false);this.set("opener",null);if(this.lockIW){K.call(this,this.lockIW,false);}E.call(this,false);var a=this._orgalgn;if(a){this.popupConfig.setAlignment(a.host,a.popup);}},buildRendering:function D(){var a=this._super();if(a){if(!this.parent&&!this.domNode.parentElement){document.body.appendChild(this.domNode);}}return a;},unrender:function S(a){if(this.popupConfig&&!this.popupConfig.isHostedWithin&&this.hostProxy){document.body.removeChild(this.hostProxy);delete this.hostProxy;}this._super(a);}};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumObjectTypes");var Q=mstrmojo.array,N=mstrmojo.hash,L=mstrmojo,U=L.func.wrapMethods,A=mstrmojo.warehouse.EnumObjectTypes,K=44,G=21,M=1022,I=mstrmojo.desc(11435,"there are no tables that can relate these 2 attributes");mstrmojo.architect.obj.SystemDimension=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.SystemDimension",relationsLoaded:false,init:function O(V){this.model=V.mdl;},reset:function S(){this.relations=[];this.relationsLoaded=false;},attributePositions:undefined,jointChildren:[],load:function F(b){var Y=this;if(this.relationsLoaded){b.success(this.relations);return ;}var V=this.model,a,X,W;Y.relations=[];Y.attributePositions={};V.submitRequest({success:function Z(c){N.forEach(c.relations,function(f){X=f.relationTableId||"";a=new mstrmojo.architect.obj.Relationship({isNew:false,isSysDimension:true,parentAttributeId:f.parentAttributeId,parentAttributeName:f.parentAttributeName,childAttributeId:f.childAttributeId,childAttributeName:f.childAttributeName,relationType:f.relationType,relationTableId:X,relationTableName:X===""?"":V.getTable(X).name,isJointChildren:(f.joinChildren>2),jointIndex:f.childrenIndex,model:V});N.copy({isVisible:function d(i,h){return V.handleVisibleAction(i,h);},isChecked:function g(i,h){return V.handleCheckAction(i,h);},isEnabled:function e(i,h){return V.handleEnabledAction(i,h);},tp:A.RELATIONSHIP},a);Y.relations.push(a);});Y.relationsLoaded=true;Q.forEach(c.attributeProperties,function(d){W=d.did;Y.attributePositions[W]={x:d.l,y:d.t};});b.success(Y);}},{},"getHierarchyInfo");},relations:[],getRelatedRelations:function D(Y){var X=this,V=[],W=X.relations;Q.forEach(W,function(Z){if(Z.isJointChildren&&Z.parentAttributeId===Y){V.push(Z);}return true;});return V;},getRelation:function C(V,X){var W=null;Q.forEach(this.relations,function(Y){if(Y.parentAttributeId===V&&Y.childAttributeId===X){W=Y;return false;}return true;});return W;},addRelation:function J(W,X,c){var Y=this,V=this.model,b,a=U({success:function(){Y.relations.push(b);}},c);mstrApp.getRootController().searchTables.call(this,W,X,{success:function Z(d){if(d.ts.length>0){var e=d.ts[0].did;b=new mstrmojo.architect.obj.Relationship({isNew:true,isSysDimension:true,parentAttributeId:W,childAttributeId:X,relationType:1,relationTableId:e,model:V,callback:a,relationTables:d.ts,isJointChildren:false});}else{mstrmojo.alert(I);}}});},addJointRelation:function B(W,V,a){var X=this,Z=this.getRelation(W.parentAttributeId,W.childAttributeId),Y=U({success:function(){X.relations.push(Z);}},a);if(Z){Z.addJointChildren(W.parentAttributeId,W.childAttributeId,V,W.relationshipType,W.relationTableId,Y);}},removeRelation:function D(W,V,d){var Z=this,Y,b=Z.relations,X=this.getRelation(W,V),a=U({success:function(){var f=0,e=Z.relations;Q.forEach(e,function(g){if(g.parentAttributeId===X.parentAttributeId&&g.childAttributeId===X.childAttributeId){e.splice(f,1);return false;}f++;return true;});}},d),c=U({success:function(){var e=0;Q.forEach(b,function(f){if(f.parentAttributeId===X.parentAttributeId&&f.childAttributeId===X.childAttributeId){b.splice(e,1);return false;}e++;return true;});e=0;Q.forEach(b,function(f){if(f.parentAttributeId===X.parentAttributeId&&f.childAttributeId===Y){b.splice(e,1);return false;}e++;return true;});}},d);if(X){if(X.isJointChildren){Q.forEach(b,function(e){if(e.isJointChildren&&e.parentAttributeId===X.parentAttributeId&&e.childAttributeId!==X.childAttributeId){Y=e.childAttributeId;return false;}return true;});this.model.submitRequest(c,{manipulationtype:M,objectid:X.parentAttributeId,objectid2:X.childAttributeId,objectid3:Y,dimensionid:this.dimensionid},"schemaManipulation");}else{X.remove(a);}}},updateRelation:function R(a,V,X,b,e){var c=this.getRelation(a,V),Z=this,W=[],Y;if(c){if(c.isJointChildren){Y=Z.getRelatedRelations(a);Q.forEach(Y,function(f){W.push(f.childAttributeId);return true;});Z.model.submitRequest(U({success:function d(){Q.forEach(Y,function(f){f.relationType=b;f.relationTableId=X;return true;});}},e),{manipulationtype:G,objectid:a,ert:b,gdid:X,attributeids:W.join(";")},"schemaManipulation");}else{c.updateRelation(a,V,b,X,e);}}},getTablesForRelationship:function E(W,V){var X=this.getRelation(W,V);return X.relationTables;},loadTablesForRelationship:function T(a,Z){var X=this,W=a.parentAttributeId,V=a.childAttributeId;mstrApp.getRootController().searchTables.call(this,W,V,U({success:function Y(b){X.getRelation(W,V).relationTables=b.ts;}},Z));},getRelations:function H(X){var V=this;this.load({success:function W(){X.success(V.relations);}});},updateAttributePositions:function P(V,Y){var W=this;this.model.submitRequest(U({success:function X(){W.attributePositions=V;}},Y),{manipulationtype:K,objectid:"",info:JSON.stringify(V)},"schemaManipulation");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumObjectTypes");var Q=mstrmojo,a=Q.array,S=mstrmojo.hash,K=Q.func.wrapMethods,n=mstrmojo.warehouse.EnumObjectTypes,g=n.RELATIONSHIP,F=n.DIMENSION,l=mstrmojo.desc(12245,"New user hierarchy"),V=1,Y=2,H=3,Z=37,f=38,d=39,E=40,m=44,j=49,i=50,O=52,M=1003,A=2,L=4;function B(o,t,u){var q=this,p="";a.forEach(o,function(v){p+=v.atid+";";return true;});q.model.submitRequest(K({success:function r(){}},u),{manipulationtype:t,dimensionid:q.did,info:p},"schemaManipulation");}mstrmojo.architect.obj.UserHierarchy=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.UserHierarchy",model:undefined,did:"",n:"",loaded:false,relations:[],entryPoints:[],attributes:[],attributeProperties:[],tp:F,useForDrill:true,init:function k(o){var p=this;this._super(o);if(o.isNew){if(p.n===""){p.n=mstrApp.rootController.findNextName(l,S.valarray(this.model.userHierarchies),"n");}if(mstrApp.getRootController().validateName(F,p.n,"")){p.model.submitRequest(K({success:function(r){var q=r.mi["in"].oi;if(q instanceof Array&&q.length){q=q[0];}p.did=q.did;p.n=q.n;p.attributes=[];r.userHierarchy=q;}},p.callback),{manipulationtype:V,objecttype:F,objectname:p.n},"schemaManipulation");}}},attributePositions:undefined,rename:function R(o,q){var p=this;if(mstrApp.getRootController().validateName(F,o,this.n)){p.model.submitRequest(K({success:function(){p.n=o;}},q),{manipulationtype:H,objecttype:F,objectid:this.did,objectname:o},"schemaManipulation");}else{q.failure();}},remove:function T(p){var o=this;o.model.submitRequest(K({success:function(q){q.did=o.did;}},p),{manipulationtype:Y,objecttype:F,objectid:o.did},"schemaManipulation");},load:function h(u){var r=this,p=this.model;r.loaded=false;r.relations=[];r.entryPoints=[];r.attributePositions={};r.attributeProperties=[];r.attributes=[];var q={success:function t(v){r.entryPoints=v.entryPoints;v.relations=r.relations;v.attributePositions=r.attributePositions;v.attributeProperties=r.attributeProperties;r.loaded=true;}};var o={success:function t(v){var x,w;a.forEach(v.attributes,function(y){r.attributes[y.atid]=y;});S.forEach(v.relations,function(AA){x=new mstrmojo.architect.obj.Relationship({isNew:false,isSysDimension:false,parentAttributeId:AA.parentAttributeId,parentAttributeName:AA.parentAttributeName,childAttributeId:AA.childAttributeId,childAttributeName:AA.childAttributeName,relationType:0,dimensionid:r.did,model:p});S.copy({isVisible:function y(AD,AC){return p.handleVisibleAction(AD,AC);},isChecked:function AB(AD,AC){return p.handleCheckAction(AD,AC);},isEnabled:function z(AD,AC){return p.handleEnabledAction(AD,AC);},tp:n.RELATIONSHIP},x);r.relations.push(x);});a.forEach(v.attributeProperties,function(y){w=y.did;r.attributeProperties[w]={lockLimit:y.ll,lockType:y.lt,filters:y.filters};if(y.l!=="-1px"){r.attributePositions[w]={x:y.l,y:y.t};}});r.model.submitRequest(K(q,u),{manipulationtype:M,dimensionid:r.did},"schemaManipulation");}};p.submitRequest(o,{dimensionid:r.did},"getHierarchyInfo");},setAttributeLockProperty:function X(t,q,p,v){var u=this,r=u.attributeProperties[t],o={success:function(){r.lockLimit=p;r.lockType=q;if(v&&v.success){v.success();}}};u.model.submitRequest(o,{manipulationtype:j,dimensionid:u.did,objectid:t,ll:p,lt:q},"schemaManipulation");},addAttribute:function c(o,t,w){var u=this,q=[],v={atid:o,n:t},r={success:function x(){u.attributes[o]=v;u.attributeProperties[o]={lockLimit:0,lockType:1,filters:[]};u.entryPoints.push({atid:o});if(w&&w.success){w.success();}}},p=u.attributes[o];if(!p){q.push(v);B.call(u,q,d,r);}else{if(w&&w.success){w.success();}}},removeAttributes:function P(p,t){var q=this,o={success:function r(){q.loaded=false;if(t&&t.success){a.forEach(p,function(u){delete q.attributePositions[u.atid];delete q.attributes[u.atid];delete q.attributeProperties[u.atid];return true;});t.success();}}};B.call(this,p,E,o);},addEntryPoints:function W(o,r){var q=this;B.call(this,o,Z,K({success:function p(){q.entryPoints.push(o[0]);}},r));},getAttributeFilters:function N(o){return this.attributeProperties[o].filters;},setAttributeFilters:function I(p,q,u){var t=this,r="",o={success:function(){var v=[];a.forEach(q,function(w){v.push({did:w.did});return true;});t.attributeProperties[p].filters=v;if(u&&u.success){u.success();}}};a.forEach(q,function(v){r+=v.did+";";return true;});t.model.submitRequest(o,{manipulationtype:i,dimensionid:t.did,objectid:p,info:r},"schemaManipulation");},removeEntryPoints:function U(p,t){var o=this.entryPoints,q;B.call(this,p,f,K({success:function r(){q=a.find(o,"atid",p[0].atid);if(q>-1){a.removeIndices(o,q,1);}}},t));},addRelation:function e(q,o,y){var r=this.model,w=this,u,v=K({success:function(){w.relations.push(u);}},y);u=new mstrmojo.architect.obj.Relationship({isNew:true,parentAttributeId:q,childAttributeId:o,relationType:0,relationTableId:"",dimensionid:w.did,model:w.model,callback:v,isVisible:function t(AA,z){return r.handleVisibleAction(AA,z);},isChecked:function p(AA,z){return r.handleCheckAction(AA,z);},isEnabled:function x(AA,z){return r.handleEnabledAction(AA,z);},tp:g});},removeRelation:function b(p,q,u){var r=this,t=null,o=K({success:function(){var w=0,v=r.relations;a.forEach(v,function(x){if(x.parentAttributeId===t.parentAttributeId&&x.childAttributeId===t.childAttributeId){v.splice(w,1);return false;}w++;return true;});}},u);a.forEach(this.relations,function(v){if(v.parentAttributeId===p&&v.childAttributeId===q){t=v;return false;}return true;});if(t){t.remove(o);}},getRelation:function J(o,q){var p=null;a.forEach(this.relations,function(r){if(r.parentAttributeId===o&&r.childAttributeId===q){p=r;return false;}return true;});return p;},getRelations:function G(q){var o=this;o.load({success:function p(){q.success(o.relations);}});},updateAttributePositions:function C(o,w){var t=this,r=Object.keys(o),v={},p,q=0;S.forEach(o,function(x){if(x){p=t.attributes[r[q]];if(p){v[p.atid]=x;}}q++;return true;});if(Object.keys(v).length===0){return ;}this.model.submitRequest(K({success:function u(){t.attributePositions=v;}},w),{manipulationtype:m,objectid:t.did,info:JSON.stringify(v)},"schemaManipulation");},updateHiearchySubtype:function D(o,r){var p=this;this.model.submitRequest(K({success:function q(){p.useForDrill=o;}},r),{manipulationtype:O,objectid:p.did,subtype:(o===true)?A:L},"schemaManipulation");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.obj.Relationship");var c=mstrmojo.array,Y=mstrmojo.hash,T=mstrmojo,M=T.func.wrapMethods,P=mstrmojo.architect.EnumDataChangeEvents,l=P.RELATIONSHIP_CHANGED,o=mstrmojo.warehouse.EnumObjectTypes,d=o.LAYER,i=o.RELATIONSHIP,j=mstrmojo.desc(11431,"New Layer"),m=mstrmojo.desc(11435,"there are no tables that can relate these 2 attributes"),a=1,b=2,J=3,A=21,C=25,X=1026,V=1022,g=1007;function S(AB){var y=this,x=y.model,v=[],w,u,t,AC,r,AA,z;c.forEach(AB.layerRel,function(AD){w=Object.keys(AD)[0];u=AD[w];c.forEach(u,function(AH){AA=false;z=false;Y.forEach(y.tables,function(AI){Y.forEach(AI.attributeInfos,function(AJ){if(w===AJ.attributeId){AA=true;}if(AH.atid===AJ.attributeId){z=true;}return !(AA&&z);});return !(AA&&z);});if(AA&&z){t=x.getTable(AH.tbid);AC=x.getAttribute(w);r=x.getAttribute(AH.atid);v.push(new mstrmojo.architect.obj.Relationship({isNew:false,parentAttributeId:w,childAttributeId:AH.atid,relationType:AH.ert,relationTableId:AH.tbid,model:y.model,relationTableName:t.name,parentAttributeName:AC.name,childAttributeName:r.name,isJointChildren:(AH.joinChildren>1),isVisible:function AE(AJ,AI){return x.handleVisibleAction(AJ,AI);},isChecked:function AG(AJ,AI){return x.handleCheckAction(AJ,AI);},isEnabled:function AF(AJ,AI){return x.handleEnabledAction(AJ,AI);},tp:i}));}});});return v;}function O(u,v){var t=0,r=u.relations;c.forEach(r,function(w){if(w.parentAttributeId===v.parentAttributeId&&w.childAttributeId===v.childAttributeId){r.splice(t,1);return false;}t++;return true;});}function K(x,w,z){var t=x.model,v=null,y,r,u;c.forEach(x.relations,function(AA){if(AA.parentAttributeId===w&&AA.childAttributeId===z){v=AA;}});y=t.getTable(v.relationTableId);if(y){v.relationTableName=y.name;}r=t.getAttribute(v.parentAttributeId);if(r){v.parentAttributeName=r.name;}u=t.getAttribute(v.childAttributeId);if(u){v.childAttributeName=u.name;}return v;}function R(t){var r=this;r.model.submitRequest(t,{manipulationtype:C,objectid:r.id,info:JSON.stringify({tables:r.tablePositions||{},attributes:r.attributePositions||{}})},"schemaManipulation");}function k(r,u){var t=this;t.model.submitRequest({success:function(w){var v=w.mi["in"].oi,x=v.did;t.id=x;t.name=v.n;if(u&&u.success){u.success(x);}}},{manipulationtype:a,objecttype:d,objectname:r},"schemaManipulation");}mstrmojo.architect.obj.Layer=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Layer",init:function n(r){this.tables={};this.tablePositions={};this.attributePositions={};this.relations=[];this.model=r.mdl;if(r.isNew){if(r.defaultName){k.call(this,mstrApp.rootController.findNextName(j,Y.valarray(this.model.layers),"name"),r.callback);}else{if(mstrApp.getRootController().validateName(d,r.newLayerName,this.name)){k.call(this,r.newLayerName,r.callback);}}}else{this.id=r.id;this.name=r.n;}},tp:d,definitionLoaded:false,loadDefinition:function D(u){var r=this;if(this.definitionLoaded){u.success();return ;}this.loadLayer(M({success:function t(){r.definitionLoaded=true;}},u));},loadLayer:function Q(x){var v=this,u=v.name,t=v.model,r={success:function w(y){c.forEach(y.layers,function(AC){var AB={},AA={},z={},AE,AD,AF=t.layers[AC.did];if(AF){c.forEach(AC.tables,function(AG){AE=AG.did;AB[AE]=t.getTable(AE);AA[AE]={x:AG.l,y:AG.t,h:AG.h,w:AG.w};});c.forEach(AC.attributes,function(AG){AD=AG.did;z[AD]={x:AG.l,y:AG.t};});AF.tables=Y.copy(AB);AF.tablePositions=Y.copy(AA);AF.attributePositions=Y.copy(z);}});}};if(u){t.submitRequest(M(r,x),{objecttypes:d,xmlflags:1,namepattern:u,flags:1+2+256+512,specialparse:"getLayers"},"search");}else{mstrmojo.alert("missing layerName!");}},name:"",id:"",loadCount:0,tables:undefined,relations:[],relationsLoaded:false,layerRel:undefined,ratt:undefined,joinChildren:undefined,relationshipType:undefined,childrenIndex:undefined,rename:function W(t){var r=this;if(mstrApp.getRootController().validateName(d,t,this.name)){this.model.submitRequest({success:function(){r.name=t;}},{manipulationtype:J,objecttype:d,objectid:this.id,objectname:t},"schemaManipulation");return true;}return false;},remove:function Z(r){this.model.submitRequest({layer:this,callback:r,success:function(){if(this.callback&&this.callback.success){this.callback.success(this.layer.id);}}},{manipulationtype:b,objecttype:d,objectid:this.id},"schemaManipulation");},tableCount:function F(){return Object.keys(this.tables).length;},tablePositions:undefined,attributePositions:undefined,updateTablePositions:function q(u,t){var r=u.did;this.tables[r]=this.model.tables[r];this.tablePositions[r]=Y.copy(t,{x:"0px",y:"0px",w:"150px",h:"60px"});},updateAttributePositions:function B(r,u){var t=Object.keys(r)[1];if(t){if(r[t]&&r[t].y){this.attributePositions=r;R.call(this,u);}}},removeTable:function U(w){var t=[],u,v=w.did;c.forEach(this.relations,function(y,x){if(v===y.relationTableId){t.push(x);}});for(u=t.length-1;u>=0;u--){var r=t[u];c.removeIndices(this.relations,r,1);}delete this.tables[v];delete this.tablePositions[v];R.call(this,{success:mstrmojo.emptyFn});},addTable:function f(t){var r=this;this.tables[t.id]=t;r.model.submitRequest({success:function u(v){r.relations=(r.relations||[]).concat(S.call(r,v));r.model.raiseEvent({name:l,value:r.id,relations:r.relations,layers:r.model.getAllLayers()});}},{manipulationtype:g,tableids:[t.id]},"schemaManipulation");},loadRelations:function H(u){var t=this,r=t.model;if(t.relationsLoaded){if(u){if(u.success){u.success(t.relations);}if(u.complete){u.complete({id:t.id});}}return ;}r.submitRequest({success:function(v){t.relations=S.call(t,v);t.relationsLoaded=true;},complete:function(){if(u){if(u.success){u.success(t.relations);}if(u.complete){u.complete({id:t.id});}}}},{manipulationtype:X,objectid:t.id},"schemaManipulation");},getRelations:function I(r){this.loadRelations(r);},loading:function p(){return(this.loadCount<this.tableCount());},tableLoaded:function N(){if(this.loading){this.loadCount++;}if(this.loadCount>=this.tableCount()){this.model.raiseEvent({name:"layerLoaded"});}},addRelation:function h(u,r,AA,t){var w=this,v=this.model,x,y=M({success:function(AB){x.relationTableId=AB.mi.ei.ratt.at.gdid;w.relations.push(x);}},AA);mstrApp.getRootController().searchTables.call(this,u,r,{success:function z(AG){if(AG.ts.length>0){var AJ,AF=c.find(AG.ts,"did",t),AC=v.getTable(t),AH=v.getAttribute(u),AB=v.getAttribute(r);if(AF>=0){AJ=t;}else{AJ=AG.ts[0].did;}x=new mstrmojo.architect.obj.Relationship({isNew:true,parentAttributeId:u,childAttributeId:r,relationType:2,relationTableId:AJ,model:v,callback:y,relationTableName:AC.name,parentAttributeName:AH.name,childAttributeName:AB.name,isJointChildren:false,isVisible:function AE(AL,AK){return v.handleVisibleAction(AL,AK);},isChecked:function AD(AL,AK){return v.handleCheckAction(AL,AK);},isEnabled:function AI(AL,AK){return v.handleEnabledAction(AL,AK);},tp:i});}else{mstrmojo.alert(m);}}});},addJointRelation:function E(v,r,z){var w=this,t=this.model,u,y=this.getRelation(v.parentAttributeId,v.childAttributeId),x=M({success:function(){u=new mstrmojo.architect.obj.Relationship({isNew:false,isSysDimension:true,parentAttributeId:v.parentAttributeId,parentAttributeName:v.parentAttributeName,childAttributeId:r,childAttributeName:"",relationType:v.relationType,relationTableId:v.relationTableId,relationTableName:v.relationTableName,isJointChildren:true,jointIndex:v.childrenIndex+1,model:t,isVisible:function AA(AE,AD){return t.handleVisibleAction(AE,AD);},isChecked:function AC(AE,AD){return t.handleCheckAction(AE,AD);},isEnabled:function AB(AE,AD){return t.handleEnabledAction(AE,AD);},tp:i});y.isJointChildren=true;w.relations.push(u);}},z);if(y){y.addJointChildren(v.parentAttributeId,v.childAttributeId,r,v.relationType,v.relationTableId,x);}},removeRelation:function e(t,r,AA){var u=this,z=u.relations,x="",v=K(u,t,r),w=M({success:function(){var AB=0;c.forEach(z,function(AC){if(AC.parentAttributeId===v.parentAttributeId&&AC.childAttributeId===v.childAttributeId){z.splice(AB,1);return false;}AB++;return true;});AB=0;c.forEach(z,function(AC){if(AC.parentAttributeId===v.parentAttributeId&&AC.childAttributeId===x){z.splice(AB,1);return false;}AB++;return true;});}},AA),y=M({success:function(){O(u,v);}},AA);if(v){if(v.isJointChildren){c.forEach(z,function(AB){if(AB.isJointChildren&&AB.parentAttributeId===v.parentAttributeId&&AB.childAttributeId!==v.childAttributeId){x=AB.childAttributeId;return false;}return true;});this.model.submitRequest(w,{manipulationtype:V,objectid:v.parentAttributeId,objectid2:v.childAttributeId,objectid3:x},"schemaManipulation");}else{v.remove(y);}}},getRelatedRelations:function e(v){var u=this,r=[],t=u.relations;c.forEach(t,function(w){if(w.isJointChildren&&w.parentAttributeId===v){r.push(w);}return true;});return r;},updateRelation:function G(x,r,u,y,AB){var z=this.getRelation(x,r),w=this,t=[],v;if(z){if(z.isJointChildren){v=w.getRelatedRelations(x);c.forEach(v,function(AC){t.push(AC.childAttributeId);return true;});w.model.submitRequest(M({success:function AA(){c.forEach(v,function(AC){AC.relationType=y;AC.relationTableId=u;return true;});}},AB),{manipulationtype:A,objectid:x,ert:y,gdid:u,attributeids:t.join(";")},"schemaManipulation");}else{z.updateRelation(x,r,y,u,AB);}}},getRelation:function L(r,t){return K(this,r,t);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Obj","mstrmojo.architect.obj.Form","mstrmojo.warehouse.EnumObjectTypes");var N=1,K=2,F=3,C=mstrmojo,H=C.hash,L=C.array,O=mstrmojo.warehouse.EnumObjectTypes,Q=O.ATTRIBUTE;function G(S){var R=0;H.forEach(S.forms,function(){R++;});return R;}function E(S,R,T){S.model.submitRequest({success:function(){S.name=R;if(T&&T.success){T.success();}}},{objectid:S.id,objecttype:Q,manipulationtype:F,objectname:R},"schemaManipulation");}function J(S,R,T){S.model.submitRequest({success:function(U){var V=U.mi["in"].oi;S.id=V.did;S.name=V.n;S.arity=1;S.forms={};S.tables={};S.relationshps={};S.automapping=false;if(T&&T.success){T.success(S);}}},{objecttype:Q,manipulationtype:N,objectname:R,showWait:true},"schemaManipulation");}mstrmojo.architect.obj.Attribute=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Attribute",init:function P(R){var S=this;this._super(R);if(R.isNew){J(S,R.name,R.callback);}else{S.forms={};S.tables={};S.relationshps={};S.automapping=false;}},id:undefined,name:undefined,arity:1,formGroups:[],rename:function D(R,S){if(mstrApp.getRootController().validateName(Q,R,this.name)){E(this,R,S);}},remove:function I(V){var U=this,T=U.id,S=G(U),R=0;U.model.submitRequest({success:function(){H.forEach(U.tables,function(W){for(R=0;R!==S;R++){W.removeAttributeInfo(false,R.toString(),T,null);}});if(V&&V.success){V.success(U.id);}}},{manipulationtype:K,objecttype:Q,objectid:U.id},"schemaManipulation");},addForm:function B(j,h,e,X,b,R,d,W,T,i,V,U,Z,a,S,f,Y){var c=this,g={callbackFn:Y,success:function(k){if(this.callbackFn&&this.callbackFn.success){this.callbackFn.success(k);}}};c.forms[e]=new mstrmojo.architect.obj.Form({baseFormId:e,isNew:j,attributeId:c.id,categoryId:X,tableId:b,columnId:R,expression:d,sortType:W,browseSortType:T,isMultiLingual:i,baseFormType:V,useName:U,useDescription:Z,isBrowseForm:a,isTemplateForm:S,model:c.model,catn:f,callback:g});},removeForm:function A(X,T){var V=this,U=V.forms[X],W,S=G(V),R=0;U.remove({callbackFn:T,success:function(Y){delete V.forms[X];H.forEach(V.tables,function(Z){Z.removeAttributeInfo(false,X,V.id,null);});if(X<S){H.forEach(V.forms,function(Z){if(Z.baseFormId>X){R=Z.baseFormId-1;V.forms[R]=Z;delete V.forms[Z.baseFormId];Z.baseFormId=R;}});H.forEach(V.tables,function(Z){W=Z.attributeInfos[V.id];H.forEach(W.baseForms,function(a){if(a.baseFormId>X){R=a.baseFormId-1;W.baseForms[R]=a;delete W.baseForms[a.baseFormId];a.baseFormId=R;}});});}if(this.callbackFn&&this.callbackFn.success){this.callbackFn.success(Y);}}});},isCompound:function M(U){var T=this,S=T.forms[U],R=false;L.forEach(T.formGroups,function(V){R=(L.find(V.fms,"did",S.categoryId)>-1);return !R;});return R;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.dbroles.DBRoleHelper");mstrmojo.requiresDescs(4572,11138,3651);var H=mstrmojo.array,G=mstrmojo.warehouse.dbroles.DBRoleHelper,C="PWDHIDDEN123!@#",A=mstrmojo.desc(4572,"Primary"),D=mstrmojo.warehouse.EnumObjectTypes.DBROLE;mstrmojo.warehouse.obj.DBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.obj.DBRole",init:function K(O){var M=this,L=(O&&O.mdDBRole);if(L){M.mdDBRole=L;M.n=L.n.toString();M.did=L.did;M.des=(!(L.des&&mstrApp.rootController.isCloud())?L.n:L.des||"").toString();M.data=new mstrmojo.warehouse.obj.TableData({id:L.did,n:L.n,tp:L.stp,model:O.mdl});}else{M.mdDBRole={n:G.getUniqueName(mstrmojo.desc(11138,"new data source #").replace("#","")),did:"",tp:29,stp:7424,writable:"1",vldbProperties:{}};M.n=M.mdDBRole.n;M.did=M.mdDBRole.did;M.data=new mstrmojo.warehouse.obj.TableData({id:M.mdDBRole.did,n:M.mdDBRole.n,tp:M.mdDBRole.stp,model:O.mdl});var N=mstrApp.rootController.getDBObjects().preferences;if(N&&N.vldbProperties){H.forEach(N.vldbProperties,function(P){M.mdDBRole.vldbProperties[P.propset]={};});}M.populated=true;}M.data.isPrimary=M.isPrimary();},dbmsCatalogCacheMode:undefined,mdDBRole:{},n:"",did:"",tp:D,supportsNameSpaces:false,avoidColumnCaching:false,displayName:function J(){return this.n+(this.isPrimary()?" ("+A+")":"");},isPrimary:function I(){return(this.did===mstrApp.getRootController().getProjectPrimaryDBRoleID());},data:undefined,populated:false,populate:function F(M){var L=this;if(this.populated){M(L);}else{mstrApp.getRootController().populateDBRole(this.mdDBRole.did,{success:function(O){L.populated=true;L.mdDBRole=O.dbrs[0];if(typeof L.mdDBRole.vldbProperties==="string"){L.mdDBRole.vldbProperties=JSON.parse(L.mdDBRole.vldbProperties);}L.n=L.mdDBRole.n.toString();L.did=L.mdDBRole.did;var N=parseInt(L.mdDBRole.dbmsCatalogCacheMode,10);L.supportsNameSpaces=((N&1)===1);L.avoidColumnCaching=((N&2)===2||(N&4)===4);M(L);}});}},rename:function B(L){var M=mstrApp.rootController;this.mdDBRole.n=L;if(M.isCloud()){this.des=L;this.n=this.des+"___"+new Date().getTime();}else{this.n=L;}if(this.did!==""){this.mdDBRole.connstr=G.cleanDSNConnection(this.mdDBRole.connstr);M.saveDBRole(this,false,{success:function(){}});}},duplicate:function E(){var M=mstrApp.rootController,O=new mstrmojo.warehouse.obj.DBRole({mdDBRole:this.mdDBRole,mdl:this.data.model}),N=mstrApp.isSingleTier?"copy of ##":mstrmojo.desc(3651,"copy of ##"),L=G.getUniqueName(N.replace("##",M.isCloud()?this.des:this.n));O.did="";O.mdDBRole.did="";O.rename(L);O.mdDBRole.connstr=G.cleanDSNConnection(O.mdDBRole.connstr);O.mdDBRole.originalID=this.did;if(O.mdDBRole.password===C){delete O.mdDBRole.password;}M.saveDBRole(O,true,{success:function(){}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport");var BasicAggMap={"8107C31BDD9911D3B98100C04F2233EA":"Sum","548C68A0F60811D3ACC300C04F0423DE":"StdevP","8107C31FDD9911D3B98100C04F2233EA":"Max","8107C331DD9911D3B98100C04F2233EA":"GeoMean",B2C0FA4220C711D6AD1400C04F0423DE:"First","8107C32CDD9911D3B98100C04F2233EA":"Product",B2C0FA4020C711D6AD1400C04F0423DE:"Greatest","8107C330DD9911D3B98100C04F2233EA":"Var","8107C32FDD9911D3B98100C04F2233EA":"Stdev","8107C32DDD9911D3B98100C04F2233EA":"Median",B2C0FA4320C711D6AD1400C04F0423DE:"Last","8107C31CDD9911D3B98100C04F2233EA":"Count","8107C31DDD9911D3B98100C04F2233EA":"Avg","8107C31EDD9911D3B98100C04F2233EA":"Min","8107C32EDD9911D3B98100C04F2233EA":"Mode",D64F1B10F6C011D3ACC300C04F0423DE:"VarP",B2C0FA4120C711D6AD1400C04F0423DE:"Least"},RankMap={"8107C326DD9911D3B98100C04F2233EA":"Rank"},OLAPAggMap={D221F90EB35540E3A1204ED6CC9A8267:"Avg",D221F90FB35540E3A1204ED6CC9A8267:"Count",D221F910B35540E3A1204ED6CC9A8267:"Max",D221F911B35540E3A1204ED6CC9A8267:"Min",D221F90DB35540E3A1204ED6CC9A8267:"Sum"},MovingAggMap={"8107C32ADD9911D3B98100C04F2233EA":"Avg","8107C350DD9911D3B98100C04F2233EA":"Count","8107C34BDD9911D3B98100C04F2233EA":"Max","8107C34CDD9911D3B98100C04F2233EA":"Min","8107C32BDD9911D3B98100C04F2233EA":"Sum"},RunningAggMap={"8107C329DD9911D3B98100C04F2233EA":"Avg","8107C354DD9911D3B98100C04F2233EA":"Count","8107C351DD9911D3B98100C04F2233EA":"Max","8107C352DD9911D3B98100C04F2233EA":"Min","8107C328DD9911D3B98100C04F2233EA":"Sum"},BandingMap={"8107C337DD9911D3B98100C04F2233EA":"Banding","8107C338DD9911D3B98100C04F2233EA":"BandingC","8107C339DD9911D3B98100C04F2233EA":"BandingP"};function _sortFunctions(fcts){var fs=function(a,b){return mstrmojo.array.stringSorter(a.n,b.n);},i,len;fcts=fcts.sort(fs);for(i=0,len=fcts.length;i<len;i++){fcts[i].fns=fcts[i].fns.sort(fs);}return fcts;}function getFuncCatIndex(fcts,funcDid){var len=fcts.length,ci;for(ci=0;ci<len;ci++){var fns=fcts[ci].fns;if(mstrmojo.array.find(fns,"did",funcDid)>-1){return ci;}}return -1;}function buildTaskParams(params){var qse=mstrApp&&mstrApp.useQuickSearch&&mstrApp.useQuickSearch();params=mstrmojo.hash.copy(params,{taskId:"searchMetadata",recursive:true,styleName:"MojoFolderStyle",includeObjectDesc:true,includeAncestorInfo:false});if(qse){params.quickSearch=qse;params.nameWildcards=16;params.sortKey=-1;}return params;}function serverRequest(callback,taskParams){if(mstrApp.serverRequest){mstrApp.serverRequest(taskParams,callback);}else{window.$MAPF=function(){return false;};this.getServerProxy().request(callback,taskParams,false,{});}}mstrmojo.ME.MetricDataService=mstrmojo.provide("mstrmojo.ME.MetricDataService",{rootFolderTypes:{ALL:39,FILTERS:4,METRICS:5,FACTS:29,SCHEMA:24,ATTRIBUTES:26,TRANSFORMATIONS:38},blockCount:10,suggestCount:10,suggestDelay:200,noCache:true,functions:null,metricComponents:null,functionsDetails:null,getServerProxy:function getServerProxy(){if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}return this.serverProxy;},getMetricDefintion:function getMetricDefintion(params,callbacks){var taskParams={taskId:"getMetricDefinition",metricId:params.id,outputFlags:65599};if(params.msgID){taskParams.msgID=params.msgID;}serverRequest.call(this,callbacks,taskParams);},validateMetric:function validateMetric(params,callbacks){var taskParams={taskId:"validateMetric",metricId:params.metricId,tokenStreamXML:params.tokenStreamXML,metricXML:params.metricXML,outputFlags:327695};if(mstrmojo.string.isEmpty(params.metricId)){taskParams.isNew=true;}if(params.msgID){taskParams.msgID=params.msgID;}if(params.formID){taskParams.frmid=params.formID;}if(params.isIDForm){taskParams.isIDForm=params.isIDForm;}if(params.objectType){taskParams.objectType=params.objectType;}serverRequest.call(this,callbacks,taskParams);},getMetricComponents:function getMetricComponents(params,callbacks){var me=this,mc=this.metricComponents;if(!this.noCache&&mc&&mc.items.length==mc.sz){callbacks.success(mc);return ;}callbacks.success=mstrmojo.func.composite([callbacks.success,function(res){if(me.metricComponents&&me.metricComponents.items){me.metricComponents.items.push(res.items);}else{me.metricComponents=res;}}]);var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||24,objectType:params.objectType||"12,13,43"});serverRequest.call(this,callbacks,taskParams);},getAttributes:function getAttributes(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||26,objectType:12});serverRequest.call(this,callbacks,taskParams);},getFacts:function getFacts(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||29,objectType:13});serverRequest.call(this,callbacks,taskParams);},getMetrics:function getMetrics(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||5,objectType:4});if(params.isVerify){taskParams.nameWildcards=2;}serverRequest.call(this,callbacks,taskParams);},getFunctions:function getFunctions(callbacks){var me=this,wss=window.sessionStorage,fcts=this.functions||(wss&&wss.getItem("functions")),localeId=wss&&wss.getItem("mstrLocaleId"),cLocaleId=mstrApp&&mstrApp.localeId;if(fcts&&localeId==cLocaleId){fcts=_sortFunctions(eval("("+fcts+")").fncs);callbacks.success(fcts);}else{var cb={failure:callbacks.failure,textResponse:true},taskParams={taskId:"getSystemFunctions",includeFunctionDetails:true,functionFlags:2|2147483648,includeFunctionHelpTopic:true};cb.success=function(res){if(typeof res==="string"||!mstrApp.isSingleTier){if(wss){wss.setItem("functions",res);wss.setItem("mstrLocaleId",cLocaleId);}me.functions=res;fcts=_sortFunctions(eval("("+res+")").fncs);}else{fcts=_sortFunctions(res.fncs);me.functions=JSON.stringify(res);}callbacks.success(fcts);};serverRequest.call(this,cb,taskParams);}},getAggFunctions:function getAggFunctions(){if(this._aggFunctions){return this._aggFunctions;}var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.array.filter(fcts[this.getBasicCategoryIndex(fcts)].fns,function(item){var did=item.did,retVal;if(did!=="B2C0FA4020C711D6AD1400C04F0423DE"&&did!=="B2C0FA4120C711D6AD1400C04F0423DE"){retVal=BasicAggMap[did];}return retVal;});return fcts;},getOLAPAggFunctions:function getOLAPAggFunctions(type){var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.array.filter(fcts[this.getOLAPCategoryIndex(fcts)].fns,function(item){switch(type){case"moving":return MovingAggMap[item.did];case"running":return RunningAggMap[item.did];case"olap":default:return OLAPAggMap[item.did];}return false;});return fcts;},getFunctionCatList:function getFunctionCatList(){if(this._functionCatList){return this._functionCatList;}var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.hash.make(fcts,mstrmojo.Arr);this._functionCatList=fcts;return fcts;},getCategoryIndex:function getCategoryIndex(funcDid,fcts){return getFuncCatIndex(fcts||this.getFunctionCatList(),funcDid);},getBasicCategoryIndex:function getBasicCategoryIndex(fcts){var Agg_Func_Greatest="B2C0FA4020C711D6AD1400C04F0423DE";return getFuncCatIndex(fcts||this.getFunctionCatList(),Agg_Func_Greatest);},getDataMiningCatIndex:function getDataMiningCatIndex(fcts){var DataMining_Func_MiningModel="F17CD4F3FF134D91B80DDAB9CA73C919";return getFuncCatIndex(fcts||this.getFunctionCatList(),DataMining_Func_MiningModel);},getDateTimeCategoryIndex:function getDateTimeCategoryIndex(fcts){var DateTime_Func_Date="C50F2A4F75AE49D6B20E00224967B500";return getFuncCatIndex(fcts||this.getFunctionCatList(),DateTime_Func_Date);},getStringCategoryIndex:function getStringCategoryIndex(fcts){var String_Func_Concat="6F7DF5FF449111D5BEA300B0D01A55EF";return getFuncCatIndex(fcts||this.getFunctionCatList(),String_Func_Concat);},getOLAPCategoryIndex:function getBasicCategoryIndex(fcts){var OLAP_Func_Avg="D221F90EB35540E3A1204ED6CC9A8267";return getFuncCatIndex(fcts||this.getFunctionCatList(),OLAP_Func_Avg);},getInternalCategoryIndex:function getInternalCategoryIndex(fcts){var INTER_Func_Band="8107C337DD9911D3B98100C04F2233EA";return getFuncCatIndex(fcts||this.getFunctionCatList(),INTER_Func_Band);},getFunctionDetails:function getFunctionDetails(params,callbacks){var taskParams={taskId:"getSystemFunctions",functionId:params.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};serverRequest.call(this,callbacks,taskParams);},getTransformations:function getTransformations(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||38,objectType:43});serverRequest.call(this,callbacks,taskParams);},getFilters:function getFilters(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||4,objectType:1});serverRequest.call(this,callbacks,taskParams);},getAttributeForms:function getAttributeForms(params,callbacks){var taskParams={taskId:"getAttributeForms",attributeID:params.attributeID,displayedForms:params.displayedForms,styleName:"WidgetElementListStyle"};serverRequest.call(this,callbacks,taskParams);},getSubtotalFunctions:function getSubTotalFunctions(params,callbacks){var taskParams=buildTaskParams({objectType:"1025,1026",searchPattern:""});serverRequest.call(this,callbacks,taskParams);},isBasicAggMap:function isBasicAggMap(did){var retVal=!!BasicAggMap[did];if(did==="B2C0FA4020C711D6AD1400C04F0423DE"||did==="B2C0FA4120C711D6AD1400C04F0423DE"){retVal=false;}return retVal;},isOLAPAgg:function isOLAPAgg(did){return !!OLAPAggMap[did];},isMovingAgg:function isMovingAgg(did){return !!MovingAggMap[did];},isRunningAgg:function isRunningAgg(did){return !!RunningAggMap[did];},isBanding:function isBanding(did){return !!BandingMap[did];},isOLAP:function isOLAP(did){var fcts=this.getFunctionCatList(),olapFns=fcts[this.getOLAPCategoryIndex(fcts)].fns;return mstrmojo.array.find(olapFns,"did",did)>-1;},isRank:function isRank(did){return !!RankMap[did];},isScalar:function isScalar(fctOi){return(fctOi||{}).sqt===3;},getFunctionHelpTopic:function getFunctionHelpTopic(h){return'<a href="'+((mstrApp.helpUrl||"../help/")+"FunctionsRef/index.html?context=functionsref&topic="+(h||""))+'" target="_new">'+mstrmojo.desc(5811,"Details ...")+"</a>";},sortFunctions:function sortFunctions(functions){var allfuncs={},fs=function(a,b){return mstrmojo.array.stringSorter(a.n,b.n);};mstrmojo.array.forEach(functions,function(funcs){mstrmojo.array.forEach(funcs&&funcs.fns,function(func){if(func&&func.did){allfuncs[func.did]=func;}});});return mstrmojo.hash.valarray(allfuncs).sort(fs);}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasScrollbox","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.string","mstrmojo.Widget");var R=mstrmojo,S=R.array,A=R.css,I=R.dom,P=R.hash,i=R.string,V="selected",H="open",W="leaf",c="loading",f=":",b="li",m="ul",k="idx",l="level";function F(x,p,v,t){var u=this.renderIndex*this.renderBlockSize,o=v.split(":"),w=parseInt(o[0],10)+u,q=!!this.selectedIndices[w],n=!!this.expandedIndices[w],r=(x.isLeaf||(!this.dataHelper&&!(x.items&&x.items.length)));o[0]=w;return i.apply('<{@tag} class="{@cls}" level="{@level}" idx="{@idx}">{@itemMkp}{@childMkp}</{@tag}>',{tag:b,cls:(q?V:"")+(n?" "+H:"")+(r?" "+W:""),level:p,idx:o.join(":"),itemMkp:this.itemRenderer.render(x,p,v,this),childMkp:t||""});}function a(w,o,r){var z=[],q=0,x=this.itemRenderer,v=x&&x.render,n=w&&w.length,u,t,y,p;z[q++]="<"+m+">";if(v&&typeof v==="function"&&n){for(p=0;p<w.length;p++){y=w[p];u=r.concat([p]);t=u.join(f);z[q++]=F.call(this,y,o,t,a.call(this,y.items,o+1,u));}}z[q]="</"+m+">";return z.join("");}function L(o,p){var n=p[0];if(p&&p.length===1){return o[n];}return L(o[n].items,p.slice(1));}function K(o,p,q,u,n,t){var r=t.treeHooks[o];if(r&&r.call(t,p,q,u,n)){return ;}A.toggleClass(p,V,o==="select");}function T(o,r,AA,n,y,v){var x=v.treeHooks[o],t=AA.items,w=(!t||t.length===0),q=o==="expand",u=v.dataHelper;if(x&&x.call(v,r,AA,n,y)){return ;}if(q&&!u&&w){A.addClass(r,W);return ;}if(q&&u){if(w){if(AA.tp==="search"){A.toggleClass(r,H,q);return ;}A.toggleClass(r,c,true);u.fetch(AA,{success:function z(AC){var AB=AA.items=AC.items;if(AB&&AB.length>0){r.innerHTML+=a.call(v,AB,(parseInt(n,10)+1),AA._renderIdx.split(f));}else{A.addClass(r,W);}},complete:function p(){A.toggleClass(r,c,false);}});}}A.toggleClass(r,H,q);}mstrmojo.ui.SimpleTree=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.ui.SimpleTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree {@cssClass}" mstrAttach:click>{@itemsHTML}</div>',markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},markupSlots:{scrollboxNode:function M(){return this.domNode;}},items:undefined,dataHelper:undefined,treeHooks:{},init:function h(n){this._super(n);this.expandedIndices={};this.selectedIndices={};},buildRendering:function Z(){var n=this.items,o;if(this.renderOnScroll&&this.items){this.renderIndex=0;n=this.items.slice(this.renderIndex,this.renderBlockSize);}o=n&&n.length;this.itemsHTML=o?a.call(this,n,0,[]):"";this._super();delete this.itemsHTML;},renderOnScroll:false,_cb_scroll:undefined,renderBlockSize:50,renderIndex:0,onscroll:function d(){if(this.renderOnScroll){var r=this.domNode,q=parseInt(r.style.height,10),o=(this.renderIndex+1)*this.renderBlockSize;if(o>=this.items.length){return ;}if(Math.ceil(q+r.scrollTop)>=r.scrollHeight){this.renderIndex++;var p=this.items.slice(o,o+this.renderBlockSize);this.domNode.innerHTML+=a.call(this,p,0,[]);}}},postBuildRendering:function N(){if(!this._cb_scroll){var o=this.id;this._cb_scroll=function n(){var p=mstrmojo.all[o];p.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);if(this._super){this._super();}},getItemMarkup:function(){return'<{@tag} class="{@cls}" style="{@style}">{@n}</{@tag}>';},getItemProps:function U(o,p,n){return{tag:"div",cls:"item ",n:o.n||"",style:"",idx:n};},itemRenderer:{render:function(o,q,n,p){o._renderIdx=n;o._renderLvl=q;return i.apply(p.getItemMarkup(o,q,n),p.getItemProps(o,q,n));},select:function e(o,p,r,n,q){K("select",o,p,r,n,q);},unselect:function G(o,p,r,n,q){K("unselect",o,p,r,n,q);},expand:function B(o,p,r,n,q){T("expand",o,p,r,n,q);},collapse:function O(o,p,r,n,q){T("collapse",o,p,r,n,q);}},_set_items:function Q(o,q){var p=this.items;this.items=q;if(p!==q){var n=this.hasRendered;if(n){this.unrender(false);}if(n){this.render();}return true;}return false;},getTreeItem:function C(n){if(n!==null){return L(this.items,n.split(f));}},getLeafNode:function D(o){var n=this.domNode.children[0].children;if((o>=0)&&(o<n.length)){return n[o];}},addChild:function J(q,o){var t=this,n=t.getTreeItem(q).items,p=q.split(f);p.push(n.length);if(this.hasRendered){var r=this.domNode.getElementsByTagName(b);S.forEach(r,function(v){if(v.getAttribute(k)===q){var u=o[0];var w=document.createElement("div");w.innerHTML=F.call(t,u,parseInt(v.getAttribute(l),10)+1,p.join(f),a.call(t,u.items,parseInt(v.getAttribute(l),10)+2,p));v.lastChild.appendChild(w.firstChild);n.push(u);return false;}return true;});}},updateChild:function g(o,n){var q=this;P.copy(n,q.getTreeItem(o));if(this.hasRendered){var p=this.domNode.getElementsByTagName(b);S.forEach(p,function(r){if(r.getAttribute(k)===o){var t=parseInt(r.getAttribute(l),10);r.innerHTML=q.itemRenderer.render(n,t,o,q)+a.call(q,n.items,t+1,o.split(f));return false;}return true;});}},toggleChildSelection:function j(o,n){var p=this.domNode.getElementsByTagName(b);S.forEach(p,function(q){if(q.getAttribute(k)===o){A.toggleClass(q,V,n);this.selectedIndices[o]=n;return false;}return true;},this);},removeChild:function E(p){var o=p.split(f),r=o.length,q=o[r-1],n=this;if(r>1){o=o.splice(0,r-1);n=this.getTreeItem(o.join(f));n.items.splice(q,1);this.updateChild(n._renderIdx,n);}else{this.items.splice(q,1);this.refresh();}},getItemWithPropName:function Y(p,t,v){var o=S.find(p,t,v);var q,r=[];if(o!==-1){r.push(p[o]);}for(q=0;q<p.length;q++){var n=p[q].items;if(n&&n.length){var u=this.getItemWithPropName(n,t,v);if(u&&u.length){r=r.concat(u);}}}return r;},onclick:function X(u){try{var q=u.target||I.eventTarget(u.hWin,u.e),o=q.tagName.toLowerCase(),x=I.findAncestorByAttr(q,k,true,this.domNode),n=x&&x.node.getAttribute(l),t=x&&x.value;if(o===m){return ;}if(t!==null&&!isNaN(parseInt(n,10))){var p={sel:{indicesName:"selected",enabledFn:"select",disabledFn:"unselect"},ex:{indicesName:"expanded",enabledFn:"expand",disabledFn:"collapse"}}[(o!==b)?"sel":"ex"];var v=this[p.indicesName+"Indices"],w=v[t];if(w){delete v[t];}else{v[t]=true;}this.itemRenderer[w?p.disabledFn:p.enabledFn](x.node,this.getTreeItem(t),n,t,this);}}catch(r){mstrApp.onerror(r);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.Widget");var R=["(",")","{","}","-","+","*","/","<",">","|","~",","],G={" ":true,"@":true},Q=null;function J(V){if(!Q){Q={};var U,T;for(U=0,T=R.length;U<T;U++){Q[R[U]]=true;}}return Q.hasOwnProperty(V);}function S(V){if(!V){return false;}var T=V.length,U,W;for(U=0;U<T;U++){W=V.charAt(U);if(J(W)||G[W]){return true;}}return false;}function A(T){return S(T)?"["+T+"]":T;}var M={8:true,9:true,10:true};var C=function(U,T){return M[U]&&!/^\".*\"$/.test(T)?'"'+T+'"':T;};var D=function(U,T,V){var W=typeof V==="undefined"?true:M[V];return U.tp===261&&T.length>=2&&W?(/^\s+$/.test(T.substr(1,T.length-2))?T:T.substr(1,T.length-2)):T;};mstrmojo.ME.MetricToken=mstrmojo.declare(mstrmojo.Widget,null,{data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}"></span>',active:false,markupMethods:{ondataChange:function(){var U=this.data,T=mstrmojo.string.encodeHtmlString(String(U.v));if(U.v===","){this.domNode.innerHTML=T+"&nbsp;";}else{if(U.tp===259&&U.v==="Desc"){this.domNode.innerHTML="&nbsp;"+T;}else{this.domNode.innerHTML=T;}}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());mstrmojo.css.toggleClass(this.domNode,["nfn"],!this.isFunction());mstrmojo.css.toggleClass(this.domNode,["invalid"],U.sta===-1);},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);}},isMstrO:function P(){return !!this.data.oi||!!this.data.rfd;},isFunction:function B(){return this.isMstrO()&&(this.data.oi&&this.data.oi.t==11);},brackets:A,length:function E(){return this.data.v.toString().length;},isDelimiter:function O(){return this.data.isDelimiter||(this.length()===1&&J(this.data.v));},split2Tokens:function H(W){var V=this.data,U=V&&V.v.toString(),X=U.substring(0,W),T=U.substring(W);return[{v:X,isNew:true},{v:T,isNew:true}];},mergeTo:function I(U){var W=this.data,V=W&&W.v.toString(),T=U.data.v.toString();return{v:V+T,isNew:true};},brackets:A,setItemInfo:function N(T){var U=this.data;U.v=this.brackets(T.n);U.oi=T;U.sta=1;U.isNew=true;this.set("data",U);this.paint();},spliceContent:function K(Z,X,U){var Y=this.data,W=Y&&Y.v.toString(),a=W.substring(0,Z);X=(X===null||X===undefined)?(W.length-Z):X;var T=W.substring(Z+X),V=a+(U||"")+T;Y.v=V;Y.isNew=true;Y.sta=1;Y.ift=(this.isAttributeToken()||Y.at)&&(Y.v.indexOf("@")>=0);if(Y.ift){Y.at=Y.oi||Y.at;}else{delete Y.at;}delete Y.oi;delete Y.exv;delete Y.extp;delete Y.tp;this.set("data",Y);this.paint();},isAttributeToken:function F(){return this.data&&this.data.oi&&this.data.oi.t===12;},setFormInfo:function L(U){var V=this.data,T=V.oi||V.at;V.v=this.brackets(T.n)+"@"+this.brackets(U.n);V.exv=U.did;V.extp=8;V.sta=1;V.isNew=true;V.oi=V.at;delete V.at;this.set("data",V);this.paint();}});mstrmojo.ME.MetricToken.isDelimiter=J;mstrmojo.ME.MetricToken.brackets=A;mstrmojo.ME.MetricToken.quotes=C;mstrmojo.ME.MetricToken.unquotes=D;mstrmojo.ME.MetricToken.QUOTABLE_DATATYPES=M;mstrmojo.ME.MetricToken.argDelimiter={".":",",",":";"}[mstrConfig&&mstrConfig.decimalSep]||",";})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash");function A(H,E,G,F){var D=mstrmojo.hash.copy(F,{props:{left:{isStyle:true,start:H,stop:E,suffix:"px",ease:mstrmojo.ease.linear}},duration:G});(new mstrmojo.fx.AnimateProp(D)).play();}function B(K,N,G,L){var I=K.domNode,M=I.offsetWidth,D=K.scrollableIncFetch;var E=K.hasAnimation&&(!(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent))||Number(RegExp.$1)>3.5),J=L?1:-1,F=parseInt(M,10)*J,H=E?500:0;A(0,-F,H,{target:G,duration:H,preStart:function(){this.target.style.overflowY="hidden";},onEnd:function(){this.target.style.display="none";}});A(F,0,H,{target:N,preStart:function(){this.target.style.display="block";this.target.style.overflowY=(D?"visible":"auto");}});if(K.waiting){A(0,-F,H,{widget:K,slot:"loaderNode",onEnd:function(){this.widget.waiting=false;}});}}var C=function(D){var E=D.currentPage;if(E===D.p1Node){E=D.p2Node;}else{E=D.p1Node;}D.currentPage=E;};mstrmojo.Booklet=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Booklet",pageClass:"mstrmojo-BookletPage",markupString:'<div id="{@id}" class="mstrmojo-Booklet {@cssClass}" style="{@cssText}"><div id="{@id}_p1" class="mstrmojo-BookletPage" ></div><div id="{@id}_p2" class="mstrmojo-BookletPage" style="left:-100%;"></div><div id="{@id}_ldr" class="mstrmojo-BookletLoader" ></div></div>',markupSlots:{containerNode:function(){return this.domNode;},p1Node:function(){return this.domNode.firstChild;},p2Node:function(){return this.domNode.childNodes[1];},loaderNode:function(){return this.domNode.childNodes[2];}},markupMethods:{onnextChange:function(){var G=this.next;if(!G){return ;}var D=this.currentPage,F=this.p1Node,E=this.currentPage=(D==F)?this.p2Node:F;if(!(G instanceof mstrmojo.Obj)){G=this.next=mstrmojo.insert(G);}if(!G.hasRendered){G.placeholder=E.appendChild(document.createElement("span"));G.render();}else{if(E.firstChild){E.replaceChild(G.domNode,E.firstChild);}else{E.appendChild(G.domNode);}}this.set("waiting",false);if(E&&D){B(this,E,D,this.turnDirFwd);}else{if(this.scrollableIncFetch){E.style.overflowY="visible";}}},onwaitingChange:function(D){this.loaderNode.style.left=(this.waiting)?0:"-100%";},onheightChange:function(D){if(this.height){this.domNode.style.height=this.height;}},onwidthChange:function(D){if(this.width){this.domNode.style.width=this.width;}}},enabled:true,waiting:false,next:null,currentPage:null,turnDirFwd:true,hasAnimation:true,scrollableIncFetch:false,FORWARD:true,REVERSE:false,turnFwd:function(D){this.turn(D,this.FORWARD);},turnBack:function(D){this.turn(D,this.REVERSE);},turn:function(D,E){this.set("turnDirFwd",E);this.set("next",D);}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.registry","mstrmojo._HasContextMenu","mstrmojo.Widget");var F=mstrmojo.dom,K=mstrmojo.css,N=16;mstrmojo.ContextMenuItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasContextMenu],{scriptClass:"mstrmojo.ContextMenuItem",SUBMENU_SHIFT:3,visible:true,checked:false,enabled:true,buildDom:function(){var U=document.createElement("tr"),V=this.data,Y=this._cmSource,R,S;U.id=this.id;U.className="mstrmojo-ContextMenuItem "+(Y.isSeparatorItem(V)?"separator":Y.item2textCss(V));var W=this,X=function(){W.handleMouseOver();},T=function(){W.handleMouseOut();},Q=function(){W.handleClick();};F.attachEvent(U,"mouseover",X);F.attachEvent(U,"mouseout",T);F.attachEvent(U,"click",Q);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-left";S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-text";if(Y.isSeparatorItem(V)){S=document.createElement("img");S.src="../images/1ptrans.gif";}else{S=document.createElement("div");S.className="mstrmojo-CMI-content";R.innerHTML=V.itemWidget?"&nbsp":V[this.itemField];}R.appendChild(S);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-right "+(this.hasSubmenu?"sm":"");S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);return U;},buildRendering:function L(){this._super();var Q=this.data.itemWidget;if(Q){Q.placeholder=this.domNode.cells[1].children[0];Q.data=this.data;Q=mstrmojo.insert(Q);Q.render();Q.parent=this;this.itemWidget=Q;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"":"none";},oncheckedChange:function(){K.toggleClass(this.domNode,["checked"],this.checked);},onenabledChange:function(){K.toggleClass(this.domNode,["disabled"],!this.enabled);}},getMenuPosition:function I(){var Q=F.position(this.domNode,true);return{x:Math.round(Q.x+Q.w-this.SUBMENU_SHIFT),y:Math.round(Q.y)};},getContextMenuItems:function B(){return this.data[this.itemChildrenField];},getContextMenuCssClass:function D(){return this.data.cmCssClass||"";},callOnContextMenuOpen:function M(){var Q=this.data;if(Q.onContextMenuOpen){Q.onContextMenuOpen.apply(this,[]);}},callOnContextMenuClose:function A(){var Q=this.data;if(Q.onContextMenuClose){Q.onContextMenuClose.apply(this,[]);}},attachMousedownEvent:function J(){},getContextMenuSource:function P(){return this._cmSource;},adjustMenuPosition:function G(){var Q=this._subMenu,T=this._subMenu.domNode,S=T.offsetHeight,R=T.offsetWidth,W=F.windowDim(),V=F.position(T,false),U=F.position(T,true);if((V.x+R+N)>W.w){Q.set("left",(F.position(this.domNode,true).x-R)+"px");}if((V.y+S+N)>W.h){Q.set("top",(W.h-S-N+(U.y-V.y))+"px");}},handleMouseOver:function O(){var Q=this,R=function(){if(Q.hasSubmenu){Q.showContextMenu();}Q._cmSource.closeMenuTree(Q);Q._mouseOverTimer=null;};if(this._cmSource.activeMenuItem!==this){this._mouseOverTimer=window.setTimeout(R,80);}},handleMouseOut:function H(){if(this._mouseOverTimer){window.clearTimeout(this._mouseOverTimer);this._mouseOverTimer=null;}},closeMenuTree:function C(){this._cmSource.closeMenuTree();},handleClick:function E(){if(this.hasSubmenu){return ;}var Q=this._cmSource,R=this.data;if(!this.itemWidget){if(!Q.isSeparatorItem(R)&&Q.queryEnabled(R)){if(Q.executeCommand){Q.executeCommand(this.data);}Q.closeMenuTree();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.boxmodel","mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Widget","mstrmojo.Arr","mstrmojo._HasLayout","mstrmojo._ListBase2Selections","mstrmojo.ListSelector","mstrmojo._TouchScrolling","mstrmojo._PagingList");var a=mstrmojo.hash,f=mstrmojo.array,e=mstrmojo.boxmodel,c=mstrmojo.dom;function A(i,k,h){var j=i.listSelector;if(j){j[k](i,i.itemsContainerNode,h);}}function L(i,h){var j=i.lastPagePos;if(!j||j.dragId!==h){j=e.offset(i.itemsContainerNode);j.dragId=h;i.lastPagePos=j;var k=i.scrollboxNode;i.lastScrollPos={left:k.scrollLeft,top:k.scrollTop,width:k.clientWidth,height:k.clientHeight};}}function O(k,n,i){var j=n&&n.node;if(j===k.dropCueNode||j===k.dropCueNode.firstChild){return k.dropCuePos;}var l=k.listMapper;var h=l&&l.whereDrop(k,k.itemsContainerNode,j,n.pos,{left:k.lastPagePos.left-k.lastScrollPos.left,top:k.lastPagePos.top-k.lastScrollPos.top,width:k.lastScrollPos.width,height:k.lastScrollPos.height});var m=k.dropCuePos;return((i!==false)&&m&&h&&(m.idx===h.idx)&&(m.left===h.left)&&(m.top===h.top))?m:h;}var g="attachEventListener";function D(i,h){if(i.makeObservable){h=h||[];if(!h[g]){mstrmojo.hash.make(h,i.itemsScriptClass||mstrmojo.Arr);}}return h;}function H(i,h){if(h&&h[g]){i._sub_its=h;i._sub_add=h[g]("add",i.id,"preadd");i._sub_rmv=h[g]("remove",i.id,"preremove");}}function G(h){if(h._sub_its){var i=mstrmojo.publisher;i.unsubscribe(h._sub_add);i.unsubscribe(h._sub_rmv);delete h._sub_add;delete h._sub_rmv;delete h._sub_its;}}mstrmojo.ListBase2=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListBase2Selections,mstrmojo._TouchScrolling,mstrmojo._PagingList,mstrmojo._HasLayout],{scriptClass:"mstrmojo.ListBase2",items:null,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode;},itemsContainerNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},ondropCuePosChange:function(){var i=this.dropCueNode,h=i&&i.style;if(!h){return ;}var k=this.dropCuePos,j=!!k;if(j){h.left=k.left+"px";h.top=k.top+"px";}h.display=j?"block":"none";},onpageChange:function(){if(this.usePaging&&!this._inScroll){this._inPaging=true;this.listMapper.toPage(this,this.page);this._inPaging=false;}},onwidthChange:function(){if(!isNaN(parseInt(this.width))){this.domNode.style.width=this.width;}},onheightChange:function(){if(!isNaN(parseInt(this.height))){this.domNode.style.height=this.height;}}},autoHide:false,renderOnScroll:false,firstRenderBlockSize:50,renderBlockSize:50,listMapper:null,listBuilder:null,listSelector:mstrmojo.ListSelector,animate:false,itemsEffect:null,containerResizable:true,init:function Z(m){this._super(m);this.items=this.initItems(this.items);var l=this.selectedIndices,j=this.selectedIndicesList,k=this.selectedIndex,n=this.selectedItem;this.selectedIndices={};this.selectedIndex=-1;delete this.selectedIndicesList;delete this.selectedItem;if(l||j||(k>-1)||n){this.initSelections(l,j,k,n);}if(this.postInitItems){this.postInitItems();}},initItems:function I(h){return D(this,h);},preBuildRendering:function W(){var l=this.listBuilder,o=l.newContext(this);this.ctxtBuilder=o;var i=this.markupSlots,k=!!(this.renderOnScroll&&this.renderBlockSize&&i&&i.scrollboxNode),j=this.items,h=(j&&j.length)||0,m=k?this.firstRenderBlockSize:h,n=k?this.firstRenderBlockSize:0;this._eros=k;this.paused=false;this.itemsHtml=this.listMapper.buildItemWrappers(j,l,this,o,m,n).join("");this.itemsContainerCssText="visibility: hidden";if(this._super){this._super();}},postBuildRendering:function E(){delete this.itemsHtml;var m=this.listMapper;if(m&&m.postBuildRendering){m.postBuildRendering(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder);}H(this,this.items);if(this._eros||this.usePaging){if(!this._cb_scroll){var p=this.id;this._cb_scroll=function(){var i=mstrmojo.all[p];i.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);this.onscroll();}if(this.animate){for(var k=0,j=["itemsEffect","scrollEffect"],h=j.length;k<h;k++){var o=j[k],l=this[o];if(l&&l.constructor===Object){l=mstrmojo.insert(mstrmojo.hash.clone(l));l.widget=this;this[o]=l;}}if(this.itemsEffect){this.itemsEffect.play();}}this.itemsContainerNode.style.visibility="inherit";if(this.containerResizable&&this.itemsContainerNode.scrollWidth<this.domNode.scrollWidth){this.itemsContainerNode.style.width=this.domNode.scrollWidth+"px";}if(this._super){this._super();}},unrender:function X(l){G(this);if(this._eros){mstrmojo.dom.detachEvent(this.scrollboxNode,"scroll",this._cb_scroll);delete this._cb_scroll;}for(var j=0,k=["itemsEffect","scrollEffect"],h=k.length;j<h;j++){var m=this[k[j]];if(m&&m.isPlaying){m.cancel();}}this._super(l);},pauseScrollRendering:function P(j,h,i){if(j!==false){j=true;}if(this.paused===!!j){return ;}this.paused=!!j;if(j){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}}else{this.fill(h,i);}},onscroll:function K(){if(this.paused){return ;}if(this._eros){if(!this._fillTmr){var h=this;this._fillTmr=self.setTimeout(function(){h.fill();h=null;},50);}}if(this._super){this._super();}},fill:function b(h,l){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}var m=(this.items&&this.items.length)||0;if(!m){if(l){l();}}else{var j=this.scrollboxNode,n=this.itemsContainerNode,k=mstrmojo.boxmodel.offset(n,j),p=this.listMapper,o=p.findScrollRange(n,m,(this.usesTouches&&this.pos&&parseInt(this.pos.y,10))||j.scrollTop,j.clientHeight,(this.usesTouches&&this.pos&&parseInt(this.pos.x,10))||j.scrollLeft,j.clientWidth,k.left,k.top);if(this.fillAt(o.start,o.end)){if(h){h();}var i=this.id;this._fillTmr=window.setTimeout(function(){mstrmojo.all[i].fill(h,l);},100);}else{if(l){l();}}}},fillAt:function M(j,i){var h=this.listMapper;if(h){return h.fillItemWrappers(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder,j,i,this.renderBlockSize);}else{return false;}},add:function R(i,h){if(!i||!i.length){return -1;}var j=this.items;if(h==null){h=a.min(this.selectedIndices,false,true);if(h!==null&&h!==undefined){h++;}}if(h==null||h===-1){h=(j&&j.length)||0;}if(j&&j.add){j.add(i,h);}else{this.set("items",j?f.insert(j.concat(),h,i):i);}return h;},preadd:function B(k){if(this.hasRendered){var n=this.listMapper;if(n){n.onadd(this,this.itemsContainerNode,this.ctxtBuilder,k);}var m=this.listBuilder;if(m){m.onadd(this,this.ctxtBuilder,k);}var j=this.listSelector;if(j){j.onadd(this,k);}if(this._eros){this.onscroll();}else{var l=k.index,h=k.value.length;this.fillAt(l,l+h-1);}}if(this.onadd){this.onadd(k);}if(this._super){this._super(k);}},remove:function U(h){if(h==null){return -1;}if(h.constructor!==Array){return this._remove(h);}var k=this.items;if(k){var j;if(k.remove){for(j=h.length-1;j>-1;j--){k.remove(h[j],1);}}else{k=k.concat();for(j=h.length-1;j>-1;j--){k.splice(h[j],1);}this.set("items",k);}return h[0];}return -1;},_remove:function U(j){var i=this.items;if(!i||(j==null)){return -1;}var h;if(!isNaN(j)){h=j;}else{h=this.itemIndex(j);}if(h>-1){if(i.remove){i.remove(h,1);}else{i=i.concat();i.splice(h,1);this.set("items",i);}}return h;},duplicate:function Y(m,i,j){var k=this.items,h=-1;if(!k||(m==null)){return -1;}if(!isNaN(m)){if(i===null||i===undefined){i=m+1;}m=k[m];}else{if(i===null||i===undefined){i=this.itemIndex(m)+1;}}if(m){var l;l=a.copy(j,a.clone(m));h=this.add([l],i);}return h;},preremove:function N(i){if(this.hasRendered){var k=this.listMapper;if(k){k.onremove(this,this.itemsContainerNode,this.ctxtBuilder,i);}var j=this.listBuilder;if(j){j.onremove(this,this.ctxtBuilder,i);}var h=this.listSelector;if(h){h.onremove(this,i);}if(this._eros){this.onscroll();}}if(this.onremove){this.onremove(i);}if(this._super){this._super(i);}},move:function S(l,r){function p(t,i){t=parseInt(t,10);return i===1||(r>=t&&r<t+i);}var q=(this.items&&this.items.length)||0;if(r===-1||r==null||isNaN(r)){r=q;}else{r=Math.min(r,q);}var k,h,n,m;if(l.constructor===Array){h=l;n=l;m=(h&&h.length)||0;if(p(l[0],l.length)){return false;}k=f.get(this.items,l);}else{if(typeof (l)==="object"){k=[l];m=1;h=this.itemIndex(k[0]);n=[h];if(p(h,1)){return false;}}else{h=l;n=[l];m=1;if(p(h,1)){return false;}k=[this.items[h]];}}var o=0;for(var j=0;j<m;j++){if(n[j]<=r){r--;o++;}}if(o==n.length){r++;}if(k[0]!=null){this.remove(h);this.add(k,r);}return true;},itemIndex:function F(h){if(h==null){return -1;}var i=this.itemIdField;return i?f.find(this.items,i,h[i]):f.indexOf(this.items,h);},prechange:function T(k){if(this.hasRendered){var j=[this.listBuilder,this.listMapper];for(var l=0,h=j.length;l<h;l++){var m=j[l];if(m&&m.onchange){m.onchange(this,this.itemsContainerNode,this.ctxtBuilder,k);}}}},makeObservable:false,_set_items:function J(m,h){var l=this.items;h=this.initItems(h);this.items=h;if(l!==h){var k=this,j=function(){if(k.autoHide){k.set("visible",!!(h&&h.length));}k=null;},i=this.hasRendered;if(i){this.refresh(j);}else{j();}}return l!==h;},premousedown:function d(h){A(this,"premousedown",h);},premouseup:function Q(h){A(this,"premouseup",h);},scrollTo:function V(i){var h,j=this.listMapper;if(j&&j.toItem){if(!isNaN(i)){h=i;}else{h=this.itemIndex(i);}if(h>=0){j.toItem(this,h);}}},draggable:false,getDragData:function(l){L(this,l.id);var j=O(this,l.src),i=j&&j.idxActual;if((i>-1)&&this.selectedIndices[i]){var k=this.sortSelectedIndices(),h=f.get(this.items,k)||[];switch(h.length){case 1:return a.copy({html:h[0][this.itemDisplayField],index:k[0]},a.copy(h[0]));case 0:return null;default:return a.copy({html:h.length+" selections",indices:k},h);}}},dropZone:false,ondragenter:function(h){L(this,h.id);this.set("dropCuePos",O(this,h.tgt));},ondragover:function(h){this.set("dropCuePos",O(this,h.tgt));},ondragleave:function(h){this.set("dropCuePos",null);},isDragValid:function C(h){return h&&h.src&&h.src.data;},ondragstart:function(h){if(!(h&&h.src&&h.src.data)){return false;}},allowCopy:false,ondragend:function(k){var i=k&&k.tgt,h=i&&i.widget;if(h===this){}else{if(this.tree&&h&&h.tree===this.tree){if(!this.allowCopy||!c.ctrlKey(i.hWin,i.e)){var j=k.src&&k.src.data;if(j&&(j.indices||(j.index!==null))){this.remove(j.indices||j.index);}}}}},ondrop:function(q){var u=q&&q.src,p=u&&u.data;if(p){var k=O(this,q.tgt,false),r=k&&k.idx,l=(p&&p.constructor===Array),j=this.sortSelectedIndices();var n=this.items;r=Math.min(r,n&&n.length)||0;var t=true;if(u.widget===this){t=this.move(j,r);f.forEach(j,function(i){if(i<=r){r--;}});}else{this.add(l?p:[p],r);}if(t){var o=l?p.length:1,h={};for(var m=0;m<o;m++){h[r+m]=true;}this.set("selectedIndices",h);}}this.set("dropCuePos",null);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");var E=mstrmojo.Widget;mstrmojo.ui._IsPulldown=mstrmojo.provide("mstrmojo.ui._IsPulldown",{scriptClass:"mstrmojo.ui._IsPulldown",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-text {@cssTextClass}" title="{@title}" style="{@labelCssText}">{@value}</div><div class="container"></div></div>',markupSlots:{selectedNode:function D(){return this.domNode.firstChild;},containerNode:function A(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:E.visibleMarkupMethod,onheightChange:E.heightMarkupMethod,onwidthChange:E.widthMarkupMethod,onvalueChange:function F(){this.selectedNode.innerHTML=this.value||"";},onenabledChange:mstrmojo.Widget.enabledMarkupMethod},getPopupList:mstrmojo.emptyFn,anchorSlot:"selectedNode",postBuildRendering:function B(){this._super();this.getPopupList().set("items",this.items);var G=this.selectedIndex,H=this.selectedIndices;if(G!==undefined){this.set("selectedIndex",G);}if(H!==undefined){this.set("selectedIndices",mstrmojo.hash.copy(H||{}));}},onitemsChange:function C(){var G=this.getPopupList();if(G){G.set("items",this.items);}},onPopupWidgetOpened:function(){var G=this.getPopupList();if(G&&(!G.items||G.items.length===0)){G.close();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher","mstrmojo.Widget","mstrmojo.array","mstrmojo._HasChildren");var G=mstrmojo.array;function E(P){if(!this.shouldPropagateEnabled){return ;}var O=this._disabledChildren;G.forEach(P,function(Q){if(Q.enabled){O.push(Q.id);Q.set("enabled",false);}});}function J(){G.forEach(this._disabledChildren,function(O){var P=mstrmojo.all[O];if(P&&P.parent===this){P.set("enabled",true);}},this);this._disabledChildren=[];}mstrmojo.Container=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasChildren],{scriptClass:"mstrmojo.Container",defaultChildSlot:"containerNode",containerNode:null,preserveChildDomOrder:true,shouldPropagateEnabled:false,init:function M(P){this._super(P);this._disabledChildren=[];this.attachEventListener("addChild",this.id,function(Q){if(this.shouldPropagateEnabled&&!this.enabled){E.call(this,Q.value);}});if(this.children){this.initChildren();}var O=this.parent;if(!O||O.hasInitBindings){this.initBindings();}},destroy:function H(O){if(this.children){this.destroyChildren(true);}if(this.bindings){this.destroyBindings();}this._super(O);},unrender:function I(Q){var R=this.children,O=(R&&R.length)||0,P;for(P=O-1;P>-1;P--){R[P].unrender(true);}this._super(Q);},postBuildRendering:function A(){if(this._super()!==false){this.renderChildren();return true;}return false;},renderChildren:function L(){var Q=this.children,O=(Q&&Q.length)||0,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}}},childRenderCheck:function D(P){if(P&&!P.hasRendered){var O=P.slot||this.defaultChildSlot;return !!this[O];}return false;},addChildren:function N(R,P,Q){var O=this._super(R,P,Q);if(O){this.childRenderOnAddCheck(O);}return O;},removeChildren:function F(V,R){var U=V?[V]:(this.children||[]),O=U.length,S;for(S=O-1;S>-1;S--){var Q=U[S],P=Q&&Q.domNode;if(P){var T=this[(Q.slot||this.defaultChildSlot)];if(P.parentNode===T){T.removeChild(P);}}}return this._super(V,R);},childRenderOnAddCheck:function B(Q){if(this.hasRendered&&Q){var O=Q.length,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}else{if(R&&R.hasRendered){this.onchildRenderingChange(R);}}}}},onchildRenderingChange:function K(O){var W=O&&O.domNode;if(!W){return ;}var P=this.defaultChildSlot,V=O.slot||P,Y=this[V],Q=this.children;if(!Y){if(W.parentNode){W.parentNode.removeChild(W);}}else{if(W.parentNode===Y){return ;}if(!this.preserveChildDomOrder){Y.appendChild(W);}else{var R,U;for(U=Q.length-1;U>=0;U--){var X=Q[U];if(X===O){break;}if(V===(X.slot||P)){var Z=X.domNode;if(Z&&Z.parentNode===Y){R=Z;}}}if(R){Y.insertBefore(W,R);}else{Y.appendChild(W);}}}if(mstrmojo.publisher.hasSubs(this.id,"childrenRendered")){var S=Q.length,T;for(T=0;T<S;T++){if(!Q[T].domNode){return ;}}this.raiseEvent({name:"childrenRendered"});}},propagateChildProps:function C(S){var R=this[S],Q=this.children||[],O=Q.length,P;for(P=0;P<O;P++){Q[P].set(S,R);}}});mstrmojo.Container.enabledMarkupMethod=function(){mstrmojo.Widget.enabledMarkupMethod.apply(this,arguments);if(this.shouldPropagateEnabled){if(this.enabled){J.call(this);}else{E.call(this,this.children);}}};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var C=mstrmojo.dom,B=mstrmojo.hash,E=mstrmojo.css;mstrmojo.Button=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Button",iconClass:"",innerIconClass:"",title:"",text:"&nbsp;",enabled:true,selected:false,markupString:'<div id="{@id}" class="mstrmojo-Button {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:touchstart,click,mousedown,mouseup><div class="mstrmojo-Button-text {@innerIconClass}"></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){E.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){E.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;},onwidthChange:mstrmojo.Widget.widthMarkupMethod},oniconClassChange:function D(J){var K=this.domNode;if(this.hasRendered&&K){K.className=K.className.replace(J.valueWas,"")+" "+J.value;}},onclick:mstrmojo.emptyFn,ontouchend:function I(J){this.onclick(J);}});mstrmojo.Button.newIconButton=function H(L,O,M,J,N){var K={scriptClass:"mstrmojo.Button",title:L,cssClass:O,text:"",onclick:M};if(J){K.bindings=J;}B.copy(N,K);return K;};function F(M,N,J,P){var L=[];if(J){L.push(J);}var O=P&&P.cssClass;if(O){L.push(O);delete P.cssClass;}var K={scriptClass:"mstrmojo.Button",cssClass:L.join(" "),text:M};if(N){K.onclick=N;}return B.copy(P,K);}mstrmojo.Button.newInteractiveButton=function G(M,N,P,O){var L={glowClass:"glow"};if(P&&(C.isFF||C.isWK)){B.copy({onmousedown:function J(){E.applyShadow(this.domNode,0,0,10,P);},onmouseup:function K(){E.removeShadow(this.domNode);}},L);}return F(M,N,"mstrmojo-InteractiveButton",B.copy(O,L));};mstrmojo.Button.newWebButton=function A(K,J,M,L){return F(K,J,"mstrmojo-WebButton"+(M?" hot":""),L);};mstrmojo.Button.newActionButton=function(K,L,M){var J=mstrmojo.Button.newWebButton(K,L,false,M);J.cssClass=J.cssClass+" action-button";return J;};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string");var B=mstrmojo.string;mstrmojo.Label=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Label",allowHTML:false,text:"",title:"",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click></div>',markupMethods:{ontitleChange:function(){this.domNode.title=this.title;},ontextChange:function(){var C=this.text;C=B.isEmpty(C)?"":C.toString();this.domNode.innerHTML=this.allowHTML?C:B.encodeHtmlString(C,true);},oncssTextChange:mstrmojo.Widget.cssTextMarkupMethod,onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod},autoHide:false,_set_text:function A(E,C){if(this.autoHide){this.set("visible",(C!==null)&&(C!=="")&&(C!==undefined));}var D=this.text;this.text=C;return(D!==C);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.ui._HasScroller","mstrmojo.css");var C=mstrmojo.css,E=mstrmojo.desc(14058,"Show Details"),A=mstrmojo.desc(14059,"Hide Details"),F=mstrmojo.desc(14060,"We are sorry for the inconvenience. Please {contact} your administrator for help.").replace("{",'<span class="dyn-link">').replace("}","</span>");mstrmojo.ui.editors.ErrorDialogContent=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",markupString:'<div class="mstrmojo-error-content" mstrAttach:click><div class="scroll-container"><div>{@shortDesc}</div><div>'+F+'</div><div class="toggle-details-link" >'+E+'</div><div class="error-details">{@en@longDesc}</div></div></div>',markupSlots:{scrollNode:function(){return this.domNode.firstChild;},contactNode:function(){return this.domNode.firstChild.children[1].getElementsByClassName("dyn-link")[0];},toggleDetailsNode:function(){return this.domNode.firstChild.children[2];}},markupMethods:{onshowDetailsChange:function(){var H=this.showDetails;this.toggleDetailsNode.innerHTML=H?A:E;C.toggleClass(this.domNode,"show-details",H);this.updateScrollbars();}},shortDesc:undefined,longDesc:undefined,showDetails:false,init:function G(H){this._super(H);this.shortDesc=this.shortDesc||mstrmojo.desc(14061,"An error has occurred");},onclick:function B(H){var J=H.getTarget(),I,K=this.longDesc;if(J===this.contactNode){I="mailto:?subject="+encodeURI("Issue: "+this.shortDesc)+(K?("&body="+encodeURI("Detail:\r\n"+K)):"");mstrApp.openPage(I,"_self");}else{if(J===this.toggleDetailsNode){this.set("showDetails",!this.showDetails);}}},setupScrollNodes:function D(){this.scrollNode=this.scrollNode;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.css");var G=mstrmojo.css,E={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"},C="sbClear",K="sbSearch";mstrmojo.SearchWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchWidget",quickSearch:false,placeholderText:"",markupString:'<table id={@id} cellspacing="0" cellpadding="0" class="mstrmojo-SearchWidget mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" style="width:{@width};" placeholder="{@placeholderText}" mstrAttach:keyup,blur/></div></td><td><div class="mstrmojo-SearchBox-clear" id="{@id}'+C+'" mstrAttach:click></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}'+K+'" mstrAttach:click ></div></div></td></tr></table>',markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},clearNode:function(){return this.domNode.rows[0].cells[1].firstChild;},searchNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},markupMethods:{onquickSearchChange:function(){G.toggleClass(this.domNode,"quick-search",this.quickSearch);},onwidthChange:function(){if(this.inputNode&&this.inputNode.style&&this.inputNode.style.width){this.inputNode.style.width=this.width;}}},clearNode:null,searchNode:null,onsearch:mstrmojo.emptyFn,onclear:mstrmojo.emptyFn,prekeyup:function J(M){var L=M.hWin,Q=M.e||L.event;var O=this.getSearchPattern(),N=(O.length===0),P=this.quickSearch;G.toggleClass(this.clearNode,"show",!N&&!P);G.toggleClass(this.searchNode,"clear",!N&&P);if(P){this[N?"clearSearch":"onsearch"](O);}var R=E[Q.keyCode];if(this["on"+R]){this["on"+R](M);}},onEnter:function B(L){this.onsearch(this.getSearchPattern());},onEsc:function A(L){this.clearSearch();},getSearchPattern:function H(){return mstrmojo.string.trim(this.inputNode.value);},preclick:function F(L){var N=L.getTarget(),M=N&&N.id;switch(M.replace(this.id,"")){case K:if(this.quickSearch){this.clearSearch();}else{this.onsearch(this.getSearchPattern());}break;case C:this.clearSearch();break;}},clearSearch:function I(){var L=this.getSearchPattern();this.reset();this.onclear(L);},reset:function D(){this.inputNode.value="";G.removeClass(this.clearNode,"show");G.removeClass(this.searchNode,"clear");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.WaitIcon=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.WaitIcon",cssFloat:"left",visible:false,markupString:'<div id="{@id}" class="mstrmojo-WaitIcon {@cssClass}" style="float:{@cssFloat};{@cssText};"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash","mstrmojo.css","mstrmojo.string");function A(C,B){return mstrmojo.hash.copy(B,{label:"",tabIndex:"",cssDisplay:"inline",name:null,markupString:'<span id="{@id}" class="'+C+' {@cssClass}" style="{@cssText}" title="{@tooltip}"><input id="{@id}_input"  type="{@type}" name="{@name}" value="{@value}" tabIndex="{@tabIndex}" mstrAttach:click tstid="{@tstid}"/><label for="{@id}_input">{@label}</label></span>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},labelNode:function(){return this.domNode.childNodes[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";},onenabledChange:function(){this.inputNode.disabled=!this.enabled;mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,"disabled");},onlabelChange:function(){this.labelNode.innerHTML=mstrmojo.string.encodeHtmlString(this.label);},oncheckedChange:function(){this.inputNode.checked=this.checked;}},checked:false,preclick:function(){this.set("checked",this.inputNode.checked);},isChecked:function(){return this.inputNode.checked;}});}mstrmojo.CheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox",{scriptClass:"mstrmojo.CheckBox",type:"checkbox"}));mstrmojo.ImageCheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox mstrmojo-ImageCheckBox",{scriptClass:"mstrmojo.CheckBox",type:"image",cssDisplay:"block",preclick:function(){this.set("checked",!this.checked);},postCreate:function(){this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.oncheckedChange=function(){mstrmojo.css.toggleClass(this.inputNode,["checked"],this.checked);};},postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";if(this._super){return this._super();}return true;}}));mstrmojo.RadioButton=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-RadioButton",{scriptClass:"mstrmojo.RadioButton",type:"radio",postBuildRendering:function(){if(mstrmojo.dom.isIE){this.inputNode.checked=this.checked;}}}));}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");var C=mstrmojo.css,G=mstrmojo.array;function F(H,J){var I={searchMetadata:{taskId:"searchMetadata",styleName:this.searchStyleName,rootFolderID:this.rootID,searchPattern:this.searchPattern+"*",nameWildcards:(this.qse?16:1),quickSearch:this.qse,sortKey:(this.qse?-1:6),blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:1,folderBrowserStyle:0,includeAncestorInfo:"true",includeObjectDesc:this.includeObjectDesc,searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseFolder:{taskId:"searchMetadata",rootFolderID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,recursive:this.hierarchical?0:(this.searchXML?"":1),folderBrowserStyle:this.hierarchical?1:0,includeAncestorInfo:String(!!this.hierarchical),searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseElements:{taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,filterXML:this.filterXML||"",searchPattern:this.searchPattern||"",matchCase:!!this.matchCase,dataSourcesXML:this.dataSourcesXML||"",includeFormNames:!!this.collectForms,includeFormValues:!!this.bIncludeFormValues,displayedForms:this.displayedForms||1,dimensionID:this.dimensionId||""}}[H]||{};if(typeof J==="object"){mstrmojo.hash.copy(J,I);}return I;}var B="##searchPattern";mstrmojo.SearchBox2=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchBox2",taskId:"searchMetadata",rootID:null,searchStyleName:"MojoFolderStyle",objectTypes:"3,14,256,257,1024,1027,2048,3072,10",token:{searchMetadata:/\//,browseElements:/(^-)|(,)|( OR )|( AND)|([<>]=?)|(&)|( )|(["\[\]\/])/},blockCount:50,blockBegin:1,minSearchLength:2,matchCase:false,enableMatchCase:true,supportIncFetch:true,quickSearch:false,searchAfterSearchPatternRestored:false,includeObjectDesc:true,forceResetCache:false,onUpdateSearchParams:mstrmojo.emptyFn,markupString:'<table id={@id} cellspacing=0 cellpadding=0 class="mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" mstrAttach:keyup,blur /></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}sbSearch" mstrAttach:click ></div></div></td><td><div class="mstrmojo-SearchBox-options" style="{@cssTextShowMC}"><input id="{@id}sbMatchCase" type="checkbox" mstrAttach:click /><label for="{@id}sbMatchCase">'+mstrmojo.desc(4326,"Case Sensitive")+"</label></div></td></tr></table>",markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},searchNode:function(){return this.domNode.rows[0].cells[1].firstChild.firstChild;},optionNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},preBuildRendering:function(){this.cssTextShowMC=this.enableMatchCase?"":"display: none";},postBuildRendering:function(){if(this._super){this._super();}this.matchCase=this.optionNode.checked;},onkeyup:function E(H){var J=this;var I=J.searchTimer;if(I){window.clearTimeout(I);}J.searchTimer=window.setTimeout(function(){J.onkeyupDelayed(H);delete J._searchTimer;},parseInt(H.e.keyCode||H.e.charCode,10)===13?0:J.searchDelay);},onkeyupDelayed:function A(I){var H=I.hWin,K=I.e||H.event;var J=mstrmojo.string.trim(this.inputNode.value);if(this.searchNode){C.toggleClass(this.searchNode,["clear"],J.length>0);}this.showTaskError=false;this.click2Search=false;if(J.length==0||this.autoSubmit||this.onEnter&&K.keyCode===13){this._onsearch();}},onEnter:function(){this._onsearch();},onclick:function(I){var H=I.hWin,K=I.e||H.event,M=K.target||K.srcElement,L=M&&M.id;switch(L.replace(this.id,"")){case"sbDown":if(this.enableMatchCase){var J=this.optionNode.parentNode.style;J.display=J.display=="block"?"none":"block";}break;case"sbSearch":if(this.inputNode.value.length>0){this.clearSearch();}break;case"sbMatchCase":this.set("matchCase",this.optionNode.checked);break;case"sbSpinner":break;}},clearSearch:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);var I=this.searchCache,H=this.rootID;if(I&&I[H]){I[H][B]="";}this._onsearch(true);},onmatchCaseChange:function(){this.matchCaseChanged=true;this._onsearch();},onrootIDChange:function(){this.rootChanged=true;this._setupCache(this.forceResetCache);var I=this.searchCache[this.rootID];if(I){var H=I[B]||"";this.inputNode.value=H;if(H.length>0){if(H.length>=this.minSearchLength&&this.searchAfterSearchPatternRestored){this._onsearch();}}}},getRootID:function(){},contentWidget:null,_notifyContentWidget:function(I){var H=this.contentWidget||this;H.set("items",I[0]);if(this.supportIncFetch){var J=I[1],L=I[2],K=this.blockCount;H.set("ifs",{np:Math.floor(J/K)+((J%K>0)?1:0),cp:Math.floor(L/K)+((L%K>0)?1:0)});}},_onsearch:function(H){this.getRootID();this._setupCache();var K=mstrmojo.string.trim(this.inputNode.value);if(K.length===0){H=true;}var L=this.token[this.taskId];if(L.test(K)){}if(this.searchPattern==K&&!this.rootChanged&&!this.matchCaseChanged&&!this.click2Search){return ;}var M=this.rootID,J=this.searchCache[M];if((K.length<this.minSearchLength&&!this.click2Search)&&!H){if(this.searchPattern&&this.searchPattern.length>=this.minSearchLength){this._notifyContentWidget(J[M]);this.searchPattern=K;}}else{this.searchPattern=K;J[B]=this.searchPattern;var I=this.filterCache(K,J,H);if((this.click2Search||I===null)&&!H){this.blockBegin=1;this.fetch();return ;}else{this._notifyContentWidget(I);}}J[B]=K;},_setupCache:function(J){var K=this.searchCache,I=this.rootID;if(K&&(J||!K[I])){K[I]=K[I]||{};var H=this.contentWidget&&this.contentWidget.items||this.rootCacheItems||[];K[I][I]=[H,this.totalSize||0,this.blockBegin||1].concat();}},taskCallId:0,path:mstrConfig.taskURL,method:"POST",serverRequest:function D(H,I){mstrmojo.xhr.request("POST",this.path,I,H,undefined,this.XServer,this.baseParams);},fetch:function(){this.rootChanged=false;this.matchCaseChanged=false;if(this.spinnerNode){this.spinnerNode.style.display="block";}if(this.preFetch){this.preFetch();}var H=this,I=F.apply(this,[this.taskId]);I.searchPattern=this.searchPattern;this.onUpdateSearchParams(I);var J={success:function(K){var L=K.items||K.es||[];L=[L,K.totalSize||K.sz||0,K.blockBegin||K.bb];mstrmojo.all[H.id].searchCache[H.rootID][(I.searchPattern.length==0?H.rootID:H.buildIndex(I.searchPattern))]=L;H._notifyContentWidget(L);},failure:function(K){if(H.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+K.getResponseHeader("X-MSTR-TaskFailureMsg"));}},complete:function(){if(H.spinnerNode){H.spinnerNode.style.display="none";}if(H.postFetch){H.postFetch();}}};this.serverRequest(I,J);},fetchPage:function(H){this.blockBegin=H*this.blockCount+1;this.fetch();},filterCache:function(J,M,I){var H=M&&M[I?this.rootID:this.buildIndex(J)];if(H){return H;}var K=this.token[this.taskId];if(K.test(J)||this.totalSize>this.blockCount){return null;}var O=J.replace(/.$/,"");H=M&&M[this.buildIndex(O)];while(H===undefined&&(O=O.replace(/.$/,"")).length>0){H=M&&M[this.buildIndex(O)];}if(H!==undefined){if(H[1]>this.blockCount){return null;}var L=H[0],N=[];G.forEach(L,function(P){if(P.n.search(new RegExp(J,this.matchCase?"":"i"))>-1){N.push(P);}});this.totalSize=N.length;return(M[this.buildIndex(J)]=[N,N.length,this.blockBegin].concat());}return null;},buildIndex:function(H){if(H.replace(/^\s|\s$/g,"").length===0){return"";}return !this.matchCase?H.toUpperCase():H+"::0";},init:function(H){if(this._super){this._super(H);}this.qse=mstrApp.useQuickSearch&&mstrApp.useQuickSearch()||0;this.autoSubmit=this.quickSearch&&(mstrApp.searchAutoComplete&&mstrApp.searchAutoComplete()||false);this.searchDelay=mstrApp.searchAutoCompleteDelay&&mstrApp.searchAutoCompleteDelay()||0;this.xhr=new mstrmojo.SimpleXHR();this.searchCache=this.searchCache||{};},clear:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Widget","mstrmojo._ListSelections");var E=mstrmojo.dom;mstrmojo.ListBase=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.ListBase",selectionPolicy:null,itemRenderer:null,icnCssText:"",icnCss:"",markupString:'<div id="{@id}" tstid="{@tstid}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div>',markupSlots:{itemsContainerNode:function G(){return this.domNode.firstChild;},scrollboxNode:function A(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},autoHide:false,itemsContainerNode:null,_markupPrefix:null,_markupSuffix:null,_itemPrefix:null,_itemSuffix:null,init:function J(K){this._super(K);if(this.autoHide){this.visible=!!(this.items&&this.items.length);}},buildRendering:function D(){this.itemsHtml="";var K=(this.renderOnScroll?this.items&&((this.renderIndex+1)*this.renderBlockSize):this.items&&this.items.length);if(K){this.itemsHtml=this._buildItemsMarkup(0,K-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");}this._super();delete this.itemsHtml;this.addSlots({itemsNode:this.itemsContainerNode.firstChild});},_buildItemsMarkup:function B(K,N,U,L,V,M){var W=[],Q=0;W[Q++]=U||"";var P=this.itemRenderer,T=P&&P.render;if(T&&typeof T==="function"){var R=this.items,S=Math.min(N+1,((R&&R.length)||0)),O;for(O=K;O<S;O++){W[Q++]=V||"";W[Q++]=T(R[O],O,this);W[Q++]=M||"";}}W[Q+1]=L||"";return W;},onselectionChange:function H(V){if(!V){return ;}var S=this.itemRenderer;if(!S){return ;}var O=S.unselect,R=this.items||[],W=V.removed,N,M,L,P,X;if(O&&W){for(P=0,X=W.length;P<X;P++){N=W[P];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){O(L,R[N],M,this);}}}var K=S.select,U=V.added,Q,T;if(K&&U){for(Q=0,T=U.length;Q<T;Q++){N=U[Q];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){K(L,R[N],M,this);}}}if(this.onchange){this.onchange({added:V.added,removed:V.removed});}},_set_items:function C(N,K){this.renderIndex=0;if(this.autoHide){this.set("visible",!!(K&&K.length));}var M=this.items;this.items=K;if(M!==K){var L=this.hasRendered;if(L){this.unrender(false);}this.clearSelect();if(L){this.render();}return true;}return false;},onItemContextMenu:mstrmojo.emptyFn,oncontextmenu:function F(K){E.preventDefault(window,K.e);var M=K.getTarget(),L=this.getItemFromTarget&&this.getItemFromTarget(M);if(L){if(this.onItemContextMenu(L,K)){K.cancel();}}},_getItemNode:function I(K){var L=this.itemsContainerNode;return(L&&L.childNodes[K])||null;},renderOnScroll:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.obj.BaseForm");var I=7,B=8,D=13;function C(L,N,K,M){L.baseForms[N]=new mstrmojo.architect.obj.BaseForm({expression:M,columnId:K,baseFormId:N});}function A(K){var M=K.callback,L=this;this.model.submitRequest({success:function(){L.attributeId=K.attributeId;L.attributeName=K.attributeName;L.tableId=K.tableId;L.baseForms={};C(L,K.baseFormId,K.columnId,K.expression);if(M&&M.success){M.success(L);}}},{manipulationtype:I,objectid:K.attributeId,baseformid:K.baseFormId,columnid:K.columnId,expression:K.expression,tableids:K.tableId,showWait:true},"schemaManipulation");}mstrmojo.architect.obj.AttrInfo=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.AttrInfo",init:function J(K){var N=this,O=K.callback,L,M;this._super(K);if(K.isNew){A.call(N,K);}else{this.baseForms={};L=K.baseFormId;M=new mstrmojo.architect.obj.BaseForm({expression:K.expression,columnId:K.columnId,baseFormId:L});this.baseForms[L]=M;if(O&&O.success){O.success(N);}}},attributeId:undefined,attributeName:undefined,tableId:undefined,baseForms:undefined,count:function G(){return(Object.keys(this.baseForms).length);},addBaseForm:function H(K,P,L,N,O){var M=this;if(K){M.model.submitRequest({success:function(){C(M,P,L,N);if(O&&O.success){O.success(M.attributeId);}}},{manipulationtype:I,objectid:M.attributeId,baseformid:P,columnid:L,expression:N,tableids:M.tableId},"schemaManipulation");}else{C(M,P,L,N);if(O&&O.success){O.success(M.attributeId);}}},remove:function F(M,L){var K=this;K.model.submitRequest({success:function(){if(M==="-1"){K.baseForms=[];}else{delete K.baseForms[M];}if(L&&L.success){L.success(M);}}},{manipulationtype:B,objectid:K.attributeId,baseformid:M,tableids:K.tableId,showWait:true},"schemaManipulation");},update:function E(O,M,K,N){var L=this;L.model.submitRequest({success:function(){var P=L.baseForms[O];P.expression=M;P.columnId=K;if(N&&N.success){N.success(L.attributeId);}}},{manipulationtype:D,objectid:L.attributeId,expression:M,columnid:K,baseformid:O,tableids:L.tableId,showWait:false},"schemaManipulation");}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var C=1;mstrmojo._hasWidgetListMapper={buildItemWrappers:function A(H,G,F,E,J,I){E.first=J;E.last=I;return this._super(H,G,F,E,0,0);},postBuildRendering:function B(K,I,H,G,F){var J=F.first;if(J){this.fillItemWrappers(K,I,H,G,F,0,J);}if(F.last){var E=I&&I.length||0,L=Math.max(Math.max(0,E-F.last),J);this.fillItemWrappers(K,I,H,G,F,L,E);}if(this._super){this._super(K,I,H,G,F);}},fillItemWrappers:function D(F,N,K,R,M,E,I,Q){var L=(N&&N.length)||0,P=this.wrapperNodes(F),S=M.itemStatus;for(var J=E,O=Math.min(I+1,L),H=0;J<O;J++){if(S[J]!==C){var G=K.build(R,M,N[J],J);if(G){G.placeholder=P[J].firstChild;G.render();}H++;if(H===Q){break;}}}return H;},onchange:null};mstrmojo.WidgetListMapper=mstrmojo.provide("mstrmojo.WidgetListMapper",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.WidgetListMapper.RENDERED=C;mstrmojo.requiresCls("mstrmojo.ListMapperHoriz");mstrmojo.WidgetListMapperHoriz=mstrmojo.provide("mstrmojo.WidgetListMapperHoriz",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperHoriz)));})();(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");mstrmojo.ListMapperTable=mstrmojo.provide("mstrmojo.ListMapperTable",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table">',markupSuffix:"</table>",itemWrapperPrefix:function(E){return'<tbody class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"<tr><td>&nbsp;</td></tr>",itemWrapperSuffix:"</tbody>",wrapperNodes:function D(E){return this.wrapperParentNode(E).tBodies;},wrapperParentNode:function C(E){return E.getElementsByTagName("table")[0];},createWrapperNode:function B(E){var F=E.ownerDocument,G=F.createElement("tbody");return G;},findIndex:function A(G,J,I){if(J&&I){var F=G.domNode,E=this.wrapperParentNode(J),H=I.parentNode;while(H){if(H===E){return mstrmojo.array.findBin(this.wrapperNodes(J),I,"offsetTop",G.items&&G.items.length);}else{if(H===F){break;}}I=H;H=I.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.requiresCls("mstrmojo.WidgetListMapper");mstrmojo.WidgetListMapperTable=mstrmojo.provide("mstrmojo.WidgetListMapperTable",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperTable)));})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.obj.Attribute","mstrmojo.architect.obj.AttrInfo","mstrmojo.architect.obj.Column","mstrmojo.architect.obj.Fact","mstrmojo.architect.obj.FactInfo","mstrmojo.architect.obj.Form","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.warehouse.obj.TableData");var m=1,o=2,L=3,S=10,b=11,G=19,K=1020,F=28,U=29,AQ=30,AL=36,AI=mstrmojo.warehouse.EnumObjectTypes,AP=AI.ATTRIBUTE,H=AI.FACT,AK=parseInt(AI.TABLE,10),u=AI.TABLE_LOGICAL_VIEW,J=AI.TABLE_PARTITION,AN=AI.COLUMN,w=AI.FORM,AH=AI.COMPOUND_FORM,AC=mstrmojo.desc(12247,"New logical view"),T=0,B=1,R=2,r=1,AD=2,P=3,g=mstrmojo.desc(11438,"This table is already part of the project, please add a different table"),AM=mstrmojo.desc(11439,"This table already exists in the project. Do you want to create multiple source table?"),e=mstrmojo.desc(11440,"(lookup)"),Y=mstrmojo.architect.EnumDataChangeEvents,d=mstrmojo,O=d.func.wrapMethods,h=d.hash,q=d.array;function W(AR){if(AR.isView){return u;}if(AR.isPartition){return J;}return AK;}function x(AS,AR){return AS.secondaryDBRoles[AR];}function AG(){var AR=this.primaryDBRole;return(AR==="00000000000000000000000000000000")?this.model.projPrimaryDBRoleID:AR;}function D(AS){var AR=new mstrmojo.architect.obj.Column({tableInfo:AS});mstrApp.rootController.getColumns()[AR.cmid]=AR;return AR;}function y(AR){var AS=[];q.forEach(AR,function(AT){AS.push(D(AT));});return AS;}function AB(AS,AR,AT){AS.model.submitRequest({success:function(){AS.name=AR;if(AT&&AT.success){AT.success();}}},{objectid:AS.id,objecttype:AK,manipulationtype:L,objectname:AR},"schemaManipulation");}function c(AS,AW,AV){var AU=this,AR=AU.model,AT=AU.model.SelDBRoleID;AR.submitRequest({success:function(AZ){var Aa=AZ.mi["in"].oi,AX={26:[],15:[]},AY,Ab;Aa=Aa.length?Aa:[Aa];q.forEach(Aa,function(Ac){if(AX[Ac.tp]){AX[Ac.tp].push(Ac);}});if(AZ.mi.rto){AY=AZ.mi.rto.oi;AY=AY.length?AY:[AY];q.forEach(AY,function(Ac){if(AX[Ac.tp]){AX[Ac.tp].push(Ac);}});}Ab=AX[AK][0];AU.id=Ab.did;AU.name=Ab.n;AU.primaryDBRole=AT;AU.columns=y(AX[AN]);AU.attributeInfos={};AU.factInfos={};AU.secondaryDBRoles=[];AU.relations=[];AU.nameSpace=AW.ns;AU.dbtid=Ab.def.dbt.did;AU.dbtn=Ab.n;this.isPopulated=false;AR.addTableStatus(AU.id,r,"","",null);if(AV&&AV.success){AV.success(AU);}},failure:function(AX){if(AX.getResponseHeader("X-MSTR-TaskErrorCode")==="-2147080975"){AR.addTableStatus(AS,P,AX.getResponseHeader("X-MSTR-TaskFailureMsg"),"",null);AR.checkTableStatus();}else{var AY=AU.model.getTableByName(AS);if(AY){if((AY.primaryDBRole===AT)||(x(AY,AT))||((AY.primaryDBRole==="00000000000000000000000000000000")&&AT===AU.model.projPrimaryDBRoleID)){AR.addTableStatus(AS,P,g,"",null);AR.checkTableStatus();}else{AR.addTableStatus(AY.id,AD,AM,AT,AV);AR.checkTableStatus();}}else{AR.addTableStatus(AS,P,AX.getResponseHeader("X-MSTR-TaskFailureMsg"),"",null);AR.checkTableStatus();}}}},{manipulationtype:m,objecttype:AK,objectname:AS,dbrid:AT,objectdef:JSON.stringify(AW.columns),ns:AW.ns,sta:AW.sta,showWait:true},"schemaManipulation");}function AE(AT){var AS=this,AR=this.name;if((this.isNew)&&(this.name==="")){AR=mstrApp.rootController.findNextName(AC,h.valarray(this.model.logicalViews),"name");}AS.model.submitRequest({success:function(AV){var AW=AV.mi["in"].oi,AU={15:[]};AW=AW.length?AW:[AW];q.forEach(AW,function(AY){if(AU[AY.tp]){AU[AY.tp].push(AY);}});var AX=AU[AK][0];AS.id=AX.did;AS.name=AX.n;AS.primaryDBRole=AS.model.projPrimaryDBRoleID;AS.columns=[];AS.attributeInfos={};AS.factInfos={};AS.secondaryDBRoles=[];AS.relations=[];AS.nameSpace="";AS.dbtid="";AS.dbtn="";this.isPopulated=false;AS.model.addTableStatus(AS.id,r,"","",null);if(AT&&AT.success){AT.success(AS);}}},{manipulationtype:m,objecttype:AK,objectname:AR,objectdef:JSON.stringify([]),info:"Select",showWait:true},"schemaManipulation");}mstrmojo.architect.obj.Table=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Table",init:function AF(AR){this._super(AR);this.isView=(AR.type===3);this.isPartition=(AR.subtype===3842);var AS=AR.callback;if(AR.isNew){if(!this.isView){c.call(this,AR.name,AR.tblDef,AS);}else{AE.call(this,AS);}}else{this.reset();if(AS&&AS.success){AS.success(this);}}},reset:function z(){this.secondaryDBRoles=[];this.columns=[];this.relations=[];this.attributeInfos={};this.factInfos={};this.isPopulated=false;this.isNew=false;},id:undefined,name:undefined,dbtid:undefined,dbtn:"",primaryDBRole:undefined,columns:undefined,secondaryDBRoles:undefined,isPopulated:false,columnDisplay:B,nameSpace:undefined,isError:false,errorMsg:"",sta:0,size:10,sizeLocked:false,isView:false,isPartition:false,SQLStatement:"",type:"",ID:undefined,catID:undefined,formName:undefined,rto:undefined,tablecols:undefined,AttInfos:undefined,Attributes:undefined,Facts:undefined,bfi:undefined,tar:undefined,updateStructure:function E(AY,AX){var AV=this,AT=AV.model,AU;AV.sta=AY.sta;AT.submitRequest({success:function AW(AZ){AV.isError=false;q.forEach(AZ.cols,function(Ab){AU=new mstrmojo.architect.obj.Column({tableInfo:Ab});AT.columns[AU.cmid]=AU;});var Aa=[];q.forEach(AZ.tablecols,function(Ab){Aa.push(AT.columns[Ab.cmid]);});if(Aa.length>0){AV.columns=Aa;AX.success();}},failure:function AS(AZ){AV.isError=true;AV.errorMsg=AZ.getResponseHeader("X-MSTR-TaskFailureMsg");},complete:function AR(){AV.model.raiseEvent({name:Y.TABLES_CHANGED,item:AV.getTableData()});AT.raiseEvent({name:Y.LAYER_TABLE_CHANGED,item:AV.getTableData(true)});}},{manipulationtype:AQ,objectname:AV.name,objectid:AV.dbtid,dbrid:AV.primaryDBRole,objectdef:JSON.stringify(AY),showWait:true},"schemaManipulation");},rename:function f(AR,AS){if(mstrApp.getRootController().validateName(AK,AR,this.name)){AB(this,AR,AS);}else{if(AS.failure){AS.failure();}}},setLogicalSize:function N(AS,AR,AU){var AT=this;AT.size=AS;AT.sizeLocked=AR;AT.model.submitRequest({success:function(){if(AU&&AU.success){AU.success();}}},{manipulationtype:AL,tableids:AT.id,sz:AS},"schemaManipulation");},remove:function i(AW){var AV=this,AU=this.id,AS=AV.model,AT,AR;AV.model.submitRequest({success:function(){h.forEach(AV.attributeInfos,function(AX){AT=AS.getAttribute(AX.attributeId);delete AT.tables[AU];});h.forEach(AV.factInfos,function(AX){AR=AS.getAttribute(AX.factId);delete AR.tables[AU];});if(AW&&AW.success){AW.success(AV.id);}}},{manipulationtype:o,objecttype:AK,objectid:AV.id},"schemaManipulation");},autoRecognize:function A(AT){var AS=this,AR=AS.model;AS.model.submitRequest({failure:function(AU){if(AU.getResponseHeader("X-MSTR-TaskErrorCode")!==null){mstrmojo.alert(AU.getResponseHeader("X-MSTR-TaskFailureMsg"));}else{AS.isPopulated=true;if(AT&&AT.success){AT.success(AS);}}},success:function(AZ){var AW=AZ.Attributes,Ac=AZ.Facts,AV=AZ.AttInfos,AY=AZ.FactInfos,Aa,AX,AU,Ab;h.forEach(AW,function(Ad){Aa=Ad.did;AU=AR.attributes[Aa];if(!AU){AU=new mstrmojo.architect.obj.Attribute({isNew:false,id:Aa,name:Ad.n,arity:1,model:AR});AR.attributes[Aa]=AU;AU.isNew=true;}AU.tables[AS.id]=AS;h.forEach(Ad.Forms,function(Ae){var Am=AU.forms[Ae.bfi],Aj=Ae.tar,Ah=Ae.lk,Ag=AR.columns[Aj].cln,An=AR.createExpression(Aj),Af=AR.getCategoryAtIndex(parseInt(Ae.bfi,10)),Ak=Af?Af.id:Aj,Ai=Af?Af.useName:Ag,Ao=Af?Af.useDescription:Ag,Al=Af?Af.objectName:Ag;if(!Am){AU.addForm(false,Ak+Aa,Ae.bfi,Ak,Ah,Aj,An,"3","3",true,3,Ai,Ao,true,true,Al);}else{if(Ah){Am.tableId=Ah;Am.columnId=Aj;Am.expression=An;}}});});h.forEach(AV,function(Ae){var Ad=Ae.did;h.forEach(Ae.Forms,function(Ag){if(Ag.tar){var Af=Ag.tar,Ah=AR.createExpression(Af);AS.addAttributeInfo(false,Ag.bfi,Ad,Ah,Af,null);}});});h.forEach(Ac,function(Ad){AX=Ad.did;Ab=AR.facts[AX];if(!Ab){Ab=new mstrmojo.architect.obj.Fact({isNew:false,id:AX,name:Ad.n,model:AR});AR.facts[AX]=Ab;Ab.isNew=true;}Ab.tables[AS.id]=AS;});h.forEach(AY,function(Ae){var Ad=Ae.did,Af=Ae.exp;if(Ad!==""){AS.addFactInfo(false,Ad,AR.createExpression(Af),Af,null);}});AS.isPopulated=true;if(AT&&AT.success){AT.success(AS);}}},{manipulationtype:S,tableids:AS.id,info:JSON.stringify(AS.columns)},"schemaManipulation");},automapColumn:function M(Af,Ac){var Ae=this,AW=Ae.model,Ad,AZ,Ab,AY,Aa,Ag,AU,AS=Ae.id,AV=AW.basicForms.ID.id,AR=AW.getCategoryAtIndex(0),AT={26:[],15:[],12:[],13:[]},AX={success:function(Ah){Ad=Ah.mi["in"].oi;q.forEach(Ad,function(Ai){if(AT[Ai.tp]){AT[Ai.tp].push(Ai);}});AY=AT[AP][0];Aa=AT[H][0];AZ=AW.createExpression(Af);if(Aa){Ab=Aa.did;Ag=AW.facts[Ab];if(!Ag){Ag=new mstrmojo.architect.obj.Fact({isNew:false,id:Ab,name:Aa.n,model:AW});AW.facts[Ab]=Ag;Ag.isNew=true;}Ag.tables[AS]=Ae;Ae.addFactInfo(false,Ab,AZ,Af,null);}else{if(AY){Ab=AY.did;AU=AW.getAttribute(Ab);if(!AU){AU=new mstrmojo.architect.obj.Attribute({isNew:false,id:Ab,name:AY.n,arity:1,model:AW});AW.attributes[Ab]=AU;AU.isNew=true;}AU.tables[AS]=Ae;AU.addForm(false,AV+Ab,0,AV,AS,Af,AZ,"3","3",true,3,AR.objectName,AR.useDescription,true,true,AR.useDescription);Ae.addAttributeInfo(false,"0",Ab,AZ,Af,null);}}if(Ac&&Ac.success){Ac.success();}}};Ae.model.submitRequest(AX,{columnid:Af,manipulationtype:F,tableids:Ae.id,showWait:false},"schemaManipulation");},getTableData:function I(AZ){var Ah=this,AY=Ah.model,AX=Ah.name,AW=new mstrmojo.warehouse.obj.TableData({id:Ah.id,n:AX,tp:AK,model:AY,multi:(Ah.secondaryDBRoles.length>0),bold:AY.tableIsInLayer(Ah.id),dbrole:Ah.primaryDBRole,isError:Ah.isError,ttp:Ah.isError?mstrApp.getRootController().cleanError(Ah.errorMsg):"",sta:Ah.sta,ns:Ah.nameSpace,dbtn:Ah.dbtn,isLocked:Ah.sizeLocked,size:Ah.size,isView:Ah.isView,icntp:W(Ah)}),Ac,Ae,Af,Ak,AT,AS,Ag,Ad=[],Aa,AV=T,AR=[],Aj,Ab,AU,Ai={};AZ=AZ||false;if(AZ){AV=Ah.columnDisplay;}h.forEach(Ah.attributeInfos,function(Al){Af=Al.attributeId;Ac=AY.getAttribute(Af);Ai={};Aj=AW.addItem(Af,Ac.name,AP,"0","",false,false,false);q.forEach(Ac.formGroups,function(Am){AU=Am.catID;Ab=AW.addSubItem(Af,Af+AU,Am.formName,AH,"0",AU,"",false,false);q.forEach(Am.fms,function(An){Ai[An.did]=An.did;h.forEach(Al.baseForms,function(Ao){Ae=Ao.baseFormId;AT=Ac.forms[Ae];if(An.did===AT.categoryId){Aa=Ao.expression;Ag=(AT.tableId===Ah.id)?AT.useName+" "+e+" ":AT.useName;Ad.push(Ao.expression);AW.addSubItemItem(Af,Ab.did,Ab.did+Ae,Ag,w,Ae,AT.categoryId,Aa+": "+AY.columns[Ao.columnId].getDataTypeName(),true,false);return false;}return true;});});});h.forEach(Al.baseForms,function(Am){Ae=Am.baseFormId;AT=Ac.forms[Ae];if(!(Ai[AT.categoryId])){Aa=Am.expression;Ag=(AT.tableId===Ah.id)?AT.useName+" "+e+" ":AT.useName;Ad.push(Am.expression);Ab=AW.addSubItem(Af,Af+Ae,Ag,w,Ae,AT.categoryId,Aa+": "+AY.columns[Am.columnId].getDataTypeName(),true,false);}});});h.forEach(Ah.factInfos,function(Al){Ak=Al.factId;AS=AY.getFact(Ak);AW.addItem(Ak,AS.name,H,"",Al.expression+": "+AY.columns[Al.columnId].getDataTypeName(),true,false,false);Ad.push(Al.expression);});h.forEach(Ad,function(Al){AR=AR.concat(Ah.model.getAllColumnsForExpression(Al));});if(AV!==B){h.forEach(Ah.columns,function(Al){if(Al){if(q.find(AR,"cmid",Al.cmid)<0){AW.addItem(Al.cmid,Al.cln,Al.tp,"",Al.getDataTypeName(),true,false,true);}else{if(AV===T){AW.addItem(Al.cmid,Al.cln,Al.tp,"",Al.getDataTypeName(),true,false,false);}}}});}AW.sortElements();return AW;},addFactInfo:function p(AV,AU,AW,AR,AX){var AY=this,AZ=AY.model.facts[AU],AT=AY.id,AS={callbackFn:AX,success:function(Aa){AY.factInfos[Aa.factId]=Aa;AY.isPopulated=true;AZ.tables[AT]=AY;if(this.callbackFn&&this.callbackFn.success){this.callbackFn.success();}}};mstrmojo.insert(new mstrmojo.architect.obj.FactInfo({isNew:AV,factId:AU,factName:AZ.name,expression:AW,columnId:AR,tableId:AT,callback:AS,model:AY.model}));},removeFactInfo:function k(AY,AX,AR){var AV=this,AS=AV.model.facts[AX],AU=AV.id,AT=AV.factInfos[AX],AW={callbackFn:AR,success:function(){delete AV.factInfos[AX];delete AS.tables[AU];if(AR&&AR.success){AR.success();}}};if(AY){AT.remove(AW);}else{AW.success();}},updateFactInfo:function C(AV,AW,AU,AR){var AT=this,AS=AT.factInfos[AV];AS.update(AW,AU,AR);},setAsLookup:function v(AT,AV,AU){var AS=this,AR=AS.model.getAttribute(AT);AS.model.submitRequest({success:function(){AR.forms[AV].tableId=AS.id;if(AU&&AU.success){AU.success();}}},{manipulationtype:b,objectid:AT,baseformid:AV,tableids:AS.id,showWait:false},"schemaManipulation");},addAttributeInfo:function Z(AW,AV,AZ,AX,AR,AY){var Ab=this,Aa,AS=Ab.model.attributes[AZ],AT=Ab.id,AU={callbackFn:AY,success:function(Ac){AS.tables[AT]=Ab;Ab.isPopulated=true;Ab.attributeInfos[Ac.attributeId]=Ac;if(AW){mstrApp.getRootController().invalidateRelations(true);}if(this.callbackFn&&this.callbackFn.success){this.callbackFn.success();}}};if(Ab.attributeInfos[AZ]){Aa=Ab.attributeInfos[AZ];Aa.addBaseForm(AW,AV,AR,AX,AY);}else{mstrmojo.insert(new mstrmojo.architect.obj.AttrInfo({isNew:AW,baseFormId:AV,attributeId:AZ,attributeName:AS.name,expression:AX,columnId:AR,tableId:AT,model:Ab.model,callback:AU}));}},removeAttributeInfo:function n(AR,AV,AX,AW){var AZ=this,AY,AS=AZ.model.attributes[AX],AT=AZ.id,AU={callbackFn:AW,success:function(){if(Object.keys(AY.baseForms).length===0){delete AZ.attributeInfos[AY.attributeId];}mstrApp.getRootController().invalidateRelations(true);if(AW&&AW.success){AW.success();}}};if(AZ.attributeInfos[AX]){AY=AZ.attributeInfos[AX];if(AR){AY.remove(AV,AU);}else{delete AY.baseForms[AV];AU.success();}}if(AV==="0"||AV==="-1"){delete AS.tables[AT];}},updateAttributeInfo:function Q(AT,AX,AW,AU,AR){var AS=this,AV=AS.attributeInfos[AT];AV.update(AX,AW,AU,AR);},addColumns:function AA(AR){this.columns=y(AR);},addColumn:function t(AS){var AR=new mstrmojo.architect.obj.Column({tableInfo:AS});mstrApp.getRootController().getColumns()[AR.cmid]=AR;this.columns.push(AR);},addColumnDef:function AO(AR){var AS=new mstrmojo.architect.obj.Column({colDef:AR});mstrApp.getRootController().getColumns()[AS.cmid]=AS;this.columns.push(AS);},addSecondaryDBRole:function AJ(AR,AU){var AT=this,AS=AT.id;AT.model.submitRequest({success:function(){AT.secondaryDBRoles[AR]=AR;if(AU&&AU.success){AU.success(AT);}}},{manipulationtype:K,tableids:AS,dbrid:AR},"schemaManipulation");},editDBRoles:function X(AV,AR,AW){var AU=this,AS=AU.model,AT=AU.id;AS.submitRequest({success:function(){var AX=AS.dbRoleTables;if(AU.primaryDBRole!=="00000000000000000000000000000000"){delete AX[AU.primaryDBRole][AU.id];}q.forEach(AU.secondaryDBRoles,function(AY){if(AX[AY]){if(AX[AY][AU.id]){delete AX[AY][AU.id];}}});if(AU.primaryDBRole!=="00000000000000000000000000000000"){AU.primaryDBRole=AV;AX[AV][AU.id]=AU;}AU.secondaryDBRoles=AR;q.forEach(AR,function(AY){if(!AX[AY]){AX[AY]={};}AX[AY][AU.id]=AU;});if(AW&&AW.success){AW.success(AU);}}},{manipulationtype:G,tableids:AT,dbrid:AV,dbrids:AR},"schemaManipulation");},clone:function a(AS,AR){return new mstrmojo.architect.obj.Table({model:this.model,isNew:false,id:AS,name:AR,primaryDBRole:this.primaryDBRole,dbtn:this.dbtn,dbtid:this.dbtid,nameSpace:this.nameSpace,type:this.type,SQLStatement:this.SQLStatement});},getSampleData:function l(AV){if(this.isView){this.getSQLData(true,AV);}else{var AR=this.nameSpace,AT=AR+".",AU=this.dbtn,AS=this.id;if(AU.indexOf(AT)===0){AU=AU.substring(AT.length);}if(AS.indexOf(AT)===0){AS=AS.substring(AT.length);}mstrApp.rootController.getDataService().catalogAction(AV,{dbrid:AG.call(this),dbts:JSON.stringify([{tbn:AU,tbid:AS,ns:AR}]),flags:16+32,rowlimit:25});}},getSQLData:function j(AT,AV){var AS=this;if(AS.isView){if(AS.SQLStatement.replace(/[ \n\r\t]/g,"")!==""){mstrApp.rootController.getDataService().catalogAction(O({success:function AU(AW){if(AT){q.forEach(AW.cols,function(AX){AX.data.unshift({v:AX.def.cln});});AW.dbt={sz:-1};}},failure:function AR(AW){mstrmojo.alert(mstrApp.getRootController().cleanError(AW.getResponseHeader("X-MSTR-TaskFailureMsg")));}},AV),{dbrid:AG.call(AS),info:AS.SQLStatement,flags:10001});}else{AV.success({cols:[]});}}},updateViewDefinition:function V(AT){var AR=this;if(AR.isView){AR.model.submitRequest(O({success:function AS(AU){q.forEach(AR.columns,function(AW){if(AW.cmid===""){var AV=q.find(AU.cols,"cln",AW.cln);if(AV>=0){AW.cmid=AU.cols[AV].cmid;}mstrApp.getRootController().getColumns()[AW.cmid]=AW;}});}},AT),{objectid:AR.id,objectdef:JSON.stringify({columns:AR.columns}),info:this.SQLStatement,manipulationtype:U},"schemaManipulation");}},EnumColumnDisplay:{AllColumns:T,None:B,Unused:R}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");mstrmojo.ui.List=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.List",postselectionChange:function C(D){var G=D.added||[],F=G.length,I=D.removed||[],E=I.length;if(E){this.selectionRemoved({added:G,removed:I,isReselect:false});}if(F){var H=function(J){return[].concat(J).sort().join(",");};this.selectionAdded({added:G,removed:I,isReselect:H(G)===H(I)});}},selectionAdded:function A(D){},selectionRemoved:function B(D){}});mstrmojo.ui.List.SelectionChangeEvtType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo._HasOwnAvatar","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.architect.EnumDragActions","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.array","mstrmojo.css","mstrmojo.Button");var E=mstrmojo.array,I=mstrmojo.css,D=mstrmojo.dom,C=mstrmojo.architect.EnumDragActions,O=mstrmojo.architect.EnumDataChangeEvents;function F(Q){var R=this.items,P=E.find(R,"attributeId",Q.did);if(P>-1){var S=R[P];S.n=Q.value;this._getItemNode(P).outerHTML=this.itemRenderer.render(S,P,this);}}mstrmojo.architect.ui.ElementList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo._HasOwnAvatar,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.ElementList",cssClass:"mstrmojo-ar-rpc-elementlist",draggable:true,dropZone:false,itemIcnCss:"",getItemMarkup:function L(){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-icn {@itemIcnCss}"></span><span>{@n}</span></div>';},getItemProps:function J(R,P){var Q=this._super(R,P);if(Q!==undefined){Q.itemIcnCss=(R.tp!==undefined)?("t"+R.tp):"";}return Q;},init:function N(P){this._super(P);this.attributes={};var Q={},R=Q[this.id]={};R[O.RENAME]=F;mstrApp.getRootController().attachDataChangeListeners(Q);},isDragValid:function K(){return true;},createAvatar:function A(P){var R=document.createElement("div");var Q=D.findAncestorByAttr(P,"idx",true,this.domNode);if(Q&&Q.node){R.appendChild(Q.node.cloneNode(true));R.appendChild(document.createElement("div"));}R.className=this.domNode.className;return R;},getDragData:function M(P){var Q=D.findAncestorByAttr(P.src.node,"idx",true,this.domNode);P.createRelations=true;return Q&&this.items[Q.value];},getDragAction:function H(){return C.LINKER_ATTR;},toggleAvatarClass:function B(P,Q){I.toggleClass(this.avatar,P,Q);},setElementsList:function G(Q){var P=this;P.set("items",[]);P.set("items",Q);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo._HasOwnAvatar","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.architect.EnumDragActions","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.array","mstrmojo.css","mstrmojo.Button");var F=mstrmojo.array,H=mstrmojo.css,E=mstrmojo.dom,D=mstrmojo.architect.EnumDragActions,M=mstrmojo.architect.EnumDataChangeEvents;function B(N){var P=N.columns;var O=[];F.forEach(P,function(Q){O.push({n:Q.cln,cmid:Q.cmid});});this.set("items",O);}mstrmojo.architect.ui.TableColumnsList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo._HasOwnAvatar,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.TableColumnsList",draggable:true,dropZone:false,getItemMarkup:function J(){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-icn"></span><span>{@n}</span></div>';},init:function L(N){this._super(N);var O={},P=O[this.id]={};P[M.TABLE_LOADED]=B;mstrApp.getRootController().attachDataChangeListeners(O);},isDragValid:function I(){return true;},createAvatar:function A(N){var P=document.createElement("div");var O=E.findAncestorByAttr(N,"idx",true,this.domNode);if(O&&O.node){P.appendChild(O.node.cloneNode(true));P.appendChild(document.createElement("div"));}P.className=this.domNode.className;return P;},getDragData:function K(N){var O=E.findAncestorByAttr(N.src.node,"idx",true,this.domNode);N.createRelations=false;return{item:this.items[O.value]};},getDragAction:function G(){return D.PROJECT_TABLE_COLUMN;},toggleAvatarClass:function C(N,O){H.toggleClass(this.avatar,N,O);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo._HasOwnAvatar","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.architect.EnumDragActions","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.Button");var G=mstrmojo.array,I=mstrmojo.css,F=mstrmojo.dom,D=mstrmojo.hash,E=mstrmojo.architect.EnumDragActions,O=mstrmojo.architect.EnumDataChangeEvents;function K(Q){var R=this.items,P=G.find(R,"attributeId",Q.did);if(!this.hasRendered){return ;}if(P>-1){var S=R[P];S.n=Q.value;this._getItemNode(P).outerHTML=this.itemRenderer.render(S,P,this);}}function B(P){var S=P.relations,R={},Q=[];G.forEach(S,function T(U){var W=U.parentAttributeId,V=U.childAttributeId;R[W]={attributeId:W,n:U.parentAttributeName};if(V!==""){R[V]={attributeId:V,n:U.childAttributeName};}});D.forEach(D.copy(R),function T(U){Q.push(U);});Q=Q.sort(function(V,U){return V.n.toLowerCase().localeCompare(U.n.toLowerCase());});this.set("items",Q);}mstrmojo.architect.ui.AttributesList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo._HasOwnAvatar,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.AttributesList",cssClass:"mstrmojo-ar-rpc-attrlist",draggable:true,dropZone:false,getItemMarkup:function L(Q,P){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-icn"></span><span>{@n}</span></div>';},init:function N(P){this._super(P);this.attributes={};var Q={},R=Q[this.id]={};R[O.RENAME]=K;R[O.ATTRIBUTES_CHANGED]=B;mstrApp.getRootController().attachDataChangeListeners(Q);},createAvatar:function A(P){var R=document.createElement("div");var Q=F.findAncestorByAttr(P,"idx",true,this.domNode);if(Q&&Q.node){R.appendChild(Q.node.cloneNode(true));R.appendChild(document.createElement("div"));}R.className=this.domNode.className;return R;},isDragValid:function J(){return true;},getDragData:function M(P){var Q=F.findAncestorByAttr(P.src.node,"idx",true,this.domNode);P.createRelations=true;return Q&&this.items[Q.value];},getDragAction:function H(){return E.LINKER_ATTR;},toggleAvatarClass:function C(P,Q){I.toggleClass(this.avatar,P,Q);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");var D=mstrmojo.dom,F=mstrmojo.array,E=mstrmojo.hash;var A;mstrmojo.SuggestionList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.SuggestionList",itemField:"n",getItemMarkup:function(H,G){if(!A){var I=this.itemField;A=this._super(H).replace(">{@en@n}<",' title="{@en@'+I+'}">{@en@'+I+"}<");}return A;},getItemProps:function C(I,G){var H=this._super(I,G),J=this.itemField;H[J]=I[J];return H;},onclick:function B(G){if(this.disableClick){return false;}var L=this,I=this.parent,K=I.opener,H=D.isMetaKey(G.hWin,G.e);if(H&&!this.multiSelect){this.multiSelect=K.parent.defn.multi;if(this.multiSelect){D.attachOneTimeEvent(document.documentElement,"keyup",function(){var N=L.selectedIndices;if(K){K.suggestionShown=false;if(N&&!E.isEmpty(N)){var M=[];E.forEach(L.selectedIndices,function(P,O){M.push(L.items[O]);});K.handleSuggestionItemSelect(M);}I.close();}L.multiSelect=false;});}}this._super(G);if(!this.multiSelect){K.suggestionShown=false;var J=this.selectedItem;if(J){K.handleSuggestionItemSelect(J);}I.close();}},bindings:{itemField:"this.parent.opener.itemField",items:"this.parent.opener.suggestionItems",disableClick:"this.parent.opener.disableClick"}});}());(function(){mstrmojo.requiresCls("mstrmojo.RadioButton");var C=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton=mstrmojo.declare(mstrmojo.RadioButton,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton",cssClass:"mstrmojo-wh-DBRoleRadioButton",enableChildren:function A(){var G=this.parent,F=this;C.forEach(G.children,function(H){if(H.parentRBAlias&&(H.parentRBAlias===F.alias)){H.set("enabled",F.checked);}});},enabled:true,getValue:function B(){return this.checked;},setValue:function E(F){this.checked=F;this.onclick();},isValid:function D(){return{val:true,msg:""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo._HasEditableText","mstrmojo.css");var B=mstrmojo.css;mstrmojo.EditableLabel=mstrmojo.declare(mstrmojo.Label,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.EditableLabel",autoApplyDelay:-1,markupString:'<div id="{@id}" class="mstrmojo-EditableLabel {@cssClass}" title="{@title}" contenteditable="{@isEditing}" style="{@cssText}" mstrAttach:click,mousedown,blur,keydown,keyup></div>',onkeyup:function C(D){this._super(D);if(this._autoApplyTimer){window.clearTimeout(this._autoApplyTimer);}if(this.autoApplyDelay!==-1){var E=this;this._autoApplyTimer=window.setTimeout(function(){E.set("isEditing",false);},this.autoApplyDelay);}},selectable:true});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.EditableLabel,{onselectableChange:function A(){var E=this[this.editableSlot],D=!!this.selectable;E.selectable=D;E.setAttribute("unselectable",!D?"on":"off");B.toggleClass(E,"unselectable",!D);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button");mstrmojo.HTMLButton=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.HTMLButton",markupString:'<input id="{@id}" type="button" class="mstrmojo-text mstrmojo-HTMLButton mstrButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:click />',markupSlots:{inputNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline":"none";},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onselectedChange:function(){mstrmojo.css[this.selected?"addClass":"removeClass"](this.domNode,["selected"]);},ontextChange:function(){this.inputNode.value=this.text!=null?this.text:"";},oniconClassChange:function(){this.domNode.className="mstrmojo-text mstrmojo-HTMLButton mstrButton "+this.cssClass+" "+this.iconClass+(this.enabled?"":" disabled");}}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Container");var D="slot";mstrmojo.HBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.HBox",cellCssClass:"",cellSpacing:0,cellPadding:0,markupString:'<table id="{@id}" class="mstrmojo-HBox {@cssClass}" style="{@cssText}" cellspacing="{@cellSpacing}" cellpadding="{@cellPadding}">{@colHTML}<tr>{@tableHtml}</tr></table>',colHTML:"",markupSlots:{containerNode:function(){return this.domNode.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildRendering:function B(){this.tableHtml="";var N=[],F=this.children,K=(F&&F.length)||0,I;if(K){var G=0,J=this.cellCssClass?' class="mstrmojo-HBox-cell '+this.cellCssClass+'" ':"",M="<td "+J+"></td>";for(I=0;I<K;I++){N[G++]=M;F[I].slot=D+I;}this.tableHtml=N.join("");}this._super();if(K){var L={},H=this.containerNode.cells;for(I=0;I<K;I++){L["slot"+I]=H[I];}this.addSlots(L);}},addChildren:function E(K,F,G){if(!K){return K;}if(F===undefined||isNaN(F)||F<0){var J=this.children;F=(J&&J.length)||0;}var I=0,H;if(K.constructor===Array){for(I=0,H=K.length;I<H;I++){K[I].slot=D+(F+I);}}else{K.slot=D+F;}return this._super(K,F,G);},childRenderCheck:function C(G){if(G&&!G.hasRendered){var F=G.slot||this.defaultChildSlot;return !!this[F]||F.match(/^slot[\d]+$/);}return false;},onchildRenderingChange:function A(I){var F=(I&&I.src)||I,L=F&&F.domNode;if(L){var Q=F.slot;if(!this[Q]){var J=Q&&Q.match(/^slot([\d]+)$/);if(J){var O=parseInt(J[1],10),N=this.containerNode,P=N.cells,M=(P&&P.length)||0,K={};for(var H=M;H<=O;H++){var G=N.insertCell(H);K["slot"+H]=G;if(this.cellCssClass){G.className=this.cellCssClass;}}this.addSlots(K);}}}this._super(I);}});})();(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var D=function(){var F=this.opener;if(F.direction.toLowerCase()==="up"){this.domNode.style.top=-F.domNode.offsetHeight+"px";}};mstrmojo.DropDownButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DropDownButton",height:"19px",text:"",direction:"down",enabled:true,title:"",markupString:'<div id="{@id}" class="mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}" mstrAttach:mousedown><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode">{@text}</div></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:{boxNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onheightChange:function(){this.boxNode.style.height=this.height||"";},ontextChange:function(){this.iconNode.innerHTML=this.text;},ontitleChange:function(){this.boxNode.title=this.title;},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function B(){if(this._super){this._super();}var F=this.popupRef;if(F){if(F.nudge){F.nudge=mstrmojo.func.composite([F.nudge,D]);}else{if(this.direction.toLowerCase()!=="down"){F.nudge=D;}}}},popupRef:null,popupOpenConfig:null,destroy:function C(F){var G=this.popupRef;if(G&&G.hasRendered){G.destroy(false);}if(this._super){this._super(F);}},togglePopup:function E(){var F=this._lastOpened;if(F&&F.visible){this.closePopup();}else{this.openPopup("popupRef",this.popupOpenConfig);}},premousedown:function A(F){this.togglePopup();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.hash");var K=mstrmojo.hash,Q=mstrmojo.css,S="hidden",P=mstrmojo.Widget,R="mstrmojo-wh-pn-",A="titleIconsNode";mstrmojo.warehouse.ui.BasePanel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.warehouse.ui.BasePanel",markupString:'<div id="{@id}" class="mstrmojo-wh-Panel {@cssClass}" mstrAttach:click><div class="'+R+'header"><div class="'+R+'title tp{@icntp}"><span>{@title}</span></div><div class="'+R+'ttl-icons"></div></div><div><div class="'+R+'instructions-text">{@instructionsText}</div></div></div>',markupSlots:{headerNode:function F(){return this.domNode.firstChild;},titleNode:function J(){return this.domNode.firstChild.firstChild;},titleTextNode:function L(){return this.domNode.firstChild.firstChild.firstChild;},titleIconsNode:function C(){return this.domNode.firstChild.children[1];},instructionsNode:function E(){return this.domNode.lastChild.children[0];},containerNode:function M(){return this.domNode;}},markupMethods:{onvisibleChange:P.visibleMarkupMethod,onheightChange:P.heightMarkupMethod,onwidthChange:P.widthMarkupMethod},onRender:function G(){this._super();if(this.instructionsHeight){this.oninstructionsHeightChange({value:this.instructionsHeight});}this.oninstructionsVisibleChange({value:this.instructionsVisible});},title:"",titleTooltip:"",icntp:"",postBuildRendering:function N(){this._super();if(this.editableSlot){this.setEditableTitle("");}},ontitleChange:function O(){this.titleTextNode.innerHTML=this.title;},addNewTitleButton:function B(T){this.addChildren(K.copy(T,{scriptClass:"mstrmojo.Widget",markupString:'<span id="{@id}" class="{@cssClass}" mstrAttach:click>{@text}</span>',onvisibleChange:function U(){this.domNode.style.display=this.visible?"":"none";},useRichTooltip:true,showTooltip:function V(W,X){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.domNode,top:32,content:this.title||""};this.constructor.prototype.showTooltip.call(this,W,X);},slot:A}));},setEditableTitle:function I(T){Q.toggleClass(this.titleNode,S,(T===""));Q.toggleClass(this.titleIconsNode,S,(T===""));this.set("text",T);this.set("title",T);},instructionsText:"",instructionsHeight:undefined,oninstructionsHeightChange:function H(T){var V=this.instructionsNode,U=T.value;if(V){V.style.height=U;V.style.lineHeight=U;}else{this.instructionsHeight=undefined;}},instructionsVisible:false,oninstructionsVisibleChange:function D(T){if(T.value){this.instructionsNode.style.display="block";}else{this.instructionsNode.style.display="none";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Container","mstrmojo._IsPopup","mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.ui._HasScroller");var L=mstrmojo.boxmodel,I=mstrmojo.dom,M=mstrmojo.css,O="mstrmojo-Tooltip",A="mstrmojo-scrollNode",E=20;function C(S,T,R){var U="connectScrollbox";if(R){U="dis"+U;}var Q=S&&S.parent;while(Q){if(Q[U]){Q[U](T);}Q=Q.parent;}}function G(){if(!this._paintHandle){var R=this.id,Q=function(V){var Z=mstrmojo.all[R];if(!Z){return ;}delete Z._paintHandle;var T=[O],a=Z.cssClass;if(a){T.push(a);}var S=mstrApp.getThemeClassName&&mstrApp.getThemeClassName(),X=Z.opener;if(X&&X.getTooltipThemeClass){S=X.getTooltipThemeClass();}T.push(S);Z.domNode.className=T.join(" ");var Y=Z.content,U=Z.contentNode,W=Z.arrowNode;U.className=(O+"-content "+A+" "+Z.contentNodeCssClass);U.style.cssText=Z.contentNodeCssText;U.innerHTML=Y;W.style.cssText="";Z.domNode.style.visibility=!!Y?"visible":"hidden";Z.updatePosition();if(!V&&Z.optimizePos){Z.optimizePos();}Z.updateScrollbars();};if(!this._hasPaint){Q(true);this._hasPaint=true;}else{this._paintHandle=window.setTimeout(Q,0);}}}function B(h,c,a,Y){var T=c&&(c.richTooltip||c.tooltip),f=a?I.getMousePosition(a,Y||self):null,Q=T&&(typeof T==="string");var U="",g="",d="",Z=T,X=null,W=mstrmojo.tooltip.POS_TOPLEFT,S=null,b=null;var V=false,R=false;if(T&&!Q){g=T.cssClass||g;U=T.contentNodeCssClass||U;d=T.contentNodeCssText||d;Z=T.content||"";X=T.refNode||X;W=T.posType||W;S=T.left||0;b=T.top||0;V=T.keepArrowXPos||V;R=T.keepArrowYPos||R;}h.set("contentNodeCssClass",U);h.set("cssClass",g);h.set("contentNodeCssText",d);h.set("content",Z);h.set("refNode",X);h.set("posType",W);h.set("left",Q?((f&&f.x)||h.left):S);h.set("top",(Q||!T)?((f&&(f.y+E))||h.top):b);h.set("keepArrowXPos",V);h.set("keepArrowYPos",R);}mstrmojo.Tooltip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Tooltip",content:null,top:null,left:null,refNode:null,keepArrowXPos:false,keepArrowYPos:false,posType:"TL",markupString:'<div id="{@id}" class="'+O+' {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout><div class="'+O+'-shadow {@shadowNodeCssClass}"></div><div class="'+O+'-contentWrapper"><div class="'+O+"-content "+A+' {@contentNodeCssClass}" style="{@contentNodeCssText}"></div></div><div class="'+O+'-arrow"></div></div>',markupSlots:{containerNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[1].firstChild;},shadowNode:function(){return this.domNode.firstChild;},arrowNode:function(){return this.domNode.children[2];}},setupScrollNodes:function D(){this.scrollNode=this.contentNode;this.scrollbarHostNode=this.containerNode;},_previousVisible:false,markupMethods:{onvisibleChange:function(){var R=this.domNode.style,Q=!!this.visible;if(this._previousVisible!==Q){R.visibility="hidden";}R.display=Q?"block":"none";this._previousVisible=Q;if(Q){this.updatePosition();if(this.content){G.call(this);}}},onleftChange:G,ontopChange:G,onrefNodeChange:G,onposTypeChange:G,oncontentNodeCssClassChange:G,oncontentNodeCssTextChange:G,oncontentChange:G,oncssClassChange:G},preBuildRendering:function N(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},updatePosition:function H(V){if(!this.visible&&!V){return ;}var U=this.refNode,T=U?L.offset(U,document.body):{left:I.getHorizontalScroll(),top:I.getVerticalScroll()},k=this.domNode.style,e=this.containerNode,g=e.offsetWidth,Y=e.offsetHeight,R=this.posType,b=R.indexOf("R")>-1,W=R.indexOf("B")>-1,a=this.top!==null?parseInt(this.top,10)+T.top-(W?Y:0):null,S=this.left!==null?parseInt(this.left,10)+T.left-(b?g:((R.indexOf("C")>-1)?Math.floor(g/2):0)):null,i=false,Z=false,c,X,h=I.windowDim(),f=I.getHorizontalScroll()+h.w,Q=I.getVerticalScroll()+h.h,d=this.arrowNode,j=null;if(S!==null){c=Math.min(Math.max(S,0),f-g);k.left=c+"px";i=S!==c;}if(a!==null){X=Math.min(Math.max(a,0),Q-Y);k.top=X+"px";Z=a!==X;}if(i||Z){if((this.keepArrowXPos&&i)||(this.keepArrowYPos&&Z)){j=M.getComputedStyle(d);}if(this.keepArrowXPos&&i){d.style.left=(parseInt(j.left,10)+S-c)+"px";}if(this.keepArrowYPos&&Z){d.style.top=(parseInt(j.top,10)+a-X)+"px";}}M.toggleClass(this.domNode,"offset",i||Z);},_on_tooltip_change:function(Q){B(this,Q&&Q.src);},_set_opener:function(T,S){var R=this.opener,Q=S!==R;if(Q){if(S){C(S,this);}if(R){C(S,this,true);}if(R&&R.detachEventListener){R.detachEventListener(this._richSubs);R.detachEventListener(this._ttpSubs);}if(S&&S.attachEventListener){this._richSubs=S.attachEventListener("richTooltipChange",this.id,"_on_tooltip_change");this._ttpSubs=S.attachEventListener("tooltipChange",this.id,"_on_tooltip_change");}this.opener=S;}return Q;},updatePopupConfig:function(Q,R){B(this,R,Q&&Q.e,Q&&Q.win);},onscroll:function K(){if(this.visible&&this.nudge){this.nudge();}this._super();},onmouseover:mstrmojo.emptyFn,onmouseout:mstrmojo.emptyFn});var J=null;mstrmojo.tooltip={POS_TOPLEFT:"TL",POS_BOTTOMLEFT:"BL",POS_TOPRIGHT:"TR",POS_BOTTOMRIGHT:"BR",POS_BOTTOMCENTER:"BC",POS_TOPCENTER:"TC",open:function F(R,T,S,Q){if(!J||!mstrmojo.all[J.id]){J=new mstrmojo.Tooltip();}Q=Q||{};Q.e=T;Q.win=S;J.open(R,Q);R.tooltip=J;},close:function P(){if(J){if(J.opener){J.opener.tooltip=null;}J.close();}}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.css","mstrmojo.dom");var Y=mstrmojo.css,F=mstrmojo.dom;var Z={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};function A(){var c=this.value,b=this.inputNode,d=b.value,a=(c!==null&&c!==undefined)?String(c):"";if(a!==d&&(!this.keepEmpty||d!==this.emptyText)){b.value=a;}if(b.mstrmojoEmpty){Y.removeClass(b,[this.emptyClass]);b.mstrmojoEmpty=null;}}function X(){var a=this.inputNode;a.value=this.emptyText||"";Y.addClass(a,[this.emptyClass]);a.mstrmojoEmpty=true;}function N(){var a=this.inputNode;if(a){this.readingDom=true;this.set("value",a.value);this.readingDom=false;}}function U(a){var b=this;if(a===-1){N.call(this);}else{if(this._lastTimeoutId){window.clearTimeout(this._lastTimeoutId);}this._lastTimeoutId=window.setTimeout(function(){delete b._lastTimeoutId;N.call(b);},a||100);}}mstrmojo.TextBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.TextBox",value:"",type:"text",hint:"",readOnly:false,size:"",maxLength:"",cssDisplay:"inline",tabIndex:"",emptyText:"",keepEmpty:false,emptyClass:"mstrmojo-empty",valueChangeDelay:-1,textValid:true,autoComplete:true,autoCorrect:true,autoCapitalize:true,markupString:'<input id="{@id}" class="mstrmojo-TextBox {@cssClass}"  style="{@cssText}" title="{@tooltip}" type="{@type}" value="" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}"min="{@min}" max="{@max}" placeholder="{@hint}" mstrAttach:focus,keyup,blur,paste,cut,input,click,keydown  tstid="{@tstid}"/>',markupSlots:{inputNode:function D(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,oncssClassChange:function S(){this.inputNode.className="mstrmojo-TextBox "+(this.cssClass||"");},onhintChange:function O(){this.inputNode.setAttribute("placeholder",this.hint);},onenabledChange:function E(){var a=this.inputNode;a.disabled=!this.enabled;Y.toggleClass(a,"disabled",!this.enabled);},onvalueChange:function P(){var a=this.value,b=(a===undefined)||(a===null)||(a==="");if(b){if(!this.hasFocus){X.call(this);}else{this.inputNode.value="";}}else{A.call(this);}if(F.isIE9){this.inputNode.type=b?"text":this.type;}},ontooltipChange:function R(){this.domNode.title=this.tooltip;},onreadOnlyChange:function H(){this.inputNode.readOnly=this.readOnly;},ontextValidChange:function B(){Y.toggleClass(this.inputNode,["err"],!this.textValid);}},postBuildRendering:function V(){this._super();var a=this.inputNode;a.setAttribute("autocomplete",this.autoComplete?"on":"off");a.setAttribute("autocorrect",this.autoCorrect?"on":"off");a.setAttribute("autocapitalize",this.autoCapitalize?"on":"off");},focus:function Q(){if(this.inputNode&&this.inputNode.offsetParent){try{this.inputNode.focus();}catch(a){}}},prefocus:function M(){this.hasFocus=true;A.call(this);},blur:function T(){this.inputNode.blur();},preblur:function W(){window.setTimeout(function(){},200);this.hasFocus=false;N.call(this);var a=this.value;if(((a===null||a==="")&&this.emptyText)||(this.keepEmpty&&a===this.emptyText)){X.call(this);}},prekeyup:function I(b){var a=b.hWin,c=b.e||a.event;U.call(this,this.valueChangeDelay);var d=Z[c.keyCode];if(this["on"+d]){this["on"+d](b);}},preinput:function J(){U.call(this,this.valueChangeDelay);},prepaste:function K(){U.call(this);},precut:function G(){U.call(this);},setInvalidState:function C(a){this.set("textValid",true);if(a){this.domNode.setAttribute("title",a);}},cleanUp:function L(){this.inputNode.value="";this.set("textValid",false);this.domNode.setAttribute("title",this.tooltip);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.dom","mstrmojo.hash");var V=mstrmojo.hash,X=mstrmojo.dom,F="h",S="w",G="100%",L="none",U={HORIZONTAL:0,VERTICAL:1},D=U.HORIZONTAL,B="horizontal",H="vertical",J={firstSplitNode:"300px",resizeHandleNode:"5px",secondSplitNode:G};function Q(){var b=this.config,Z=this.orientation,d=(Z===D)?S:F,Y=(Z===D)?F:S,a="Node",e=this.layoutConfig||{};e.xt=true;e[d]=e[d]||V.copy(J);e[Y]=e[Y]||{firstSplitNode:G,resizeHandleNode:G,secondSplitNode:G};var c=e[d];V.forEach(b,function(g,f){c[f+a]=g.v;});return e;}function I(i){var b=this._wPos,Z=(this.orientation===D)?"x":"y",l=i[Z]-b[Z],d=this.config,k=d.firstSplit,n=d.secondSplit,j=parseInt(k.min,10),a=parseInt(n.min,10),f=(k.v.indexOf("px")>-1),c=parseInt((this.orientation===D)?this.width:this.height,10);if(!f){if(l===c){l=c*(parseInt(k.v,10)/100);}}var g=c-a,Y=Math.floor(Math.min(Math.max(l,j),g));if(this.applyPercentage){var m=Math.round((Y/c)*100),h=(c-parseInt(d.resizeHandle.v,10)-Y),e=Math.round((h/c)*100);if((m+e)<100){e+=(100-(m+e));}k.v=m+"%";n.v=e+"%";}else{k.v=Y+"px";n.v="100%";}this.layoutConfig=Q.call(this,d);this.doLayout();}mstrmojo.ui.Splitter=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.ui.Splitter",markupString:'<div id="{@id}" class="mstrmojo-Splitter {@orientationCss} {@cssClass}"><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-SplitterHandle"></div><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-clearingDiv"></div></div>',markupSlots:{firstSplitNode:function C(){return this.domNode.firstChild;},resizeHandleNode:function A(){return this.domNode.children[1];},secondSplitNode:function K(){return this.domNode.children[2];}},orientation:D,orientationCss:"",applyPercentage:false,onRender:function O(){if(this.applyPercentage){var Z=(this.orientation===D)?"x":"y",Y={};this._wPos={};Y[Z]=parseInt((this.orientation===D)?this.width:this.height,10);this._wPos[Z]=0;I.call(this,Y);}},config:{firstSplit:{v:"50%",min:"100px",max:undefined},secondSplit:{v:"50%",min:"100px",max:undefined},resizeHandle:{v:"5px"}},init:function W(Y){this._super(Y);var Z=(this.orientation===D);this.orientationCss=Z?B:H;this.restrictedToAxis=Z?"x":"y";this.config=V.clone(this.config);this.layoutConfig=Q.call(this);},toggleFirstItemVisibility:function N(Y){if(Y){this.layoutConfig=Q.call(this);}else{this.layoutConfig[(this.orientation===D)?S:F]={firstSplitNode:"0px",resizeHandleNode:"0px",secondSplitNode:G};}this.doLayout();},toggleSecondItemVisibility:function P(Y){if(Y){this.layoutConfig=Q.call(this);}else{this.layoutConfig[(this.orientation===D)?S:F]={firstSplitNode:G,resizeHandleNode:"0px",secondSplitNode:"0px"};}this.doLayout();},draggable:true,dropZone:false,avatarCssClass:"mstrmojo-Splitter-av",delayResizing:false,createAvatar:function T(){var c=document.createElement("div"),b=(this.orientation===D),Z=this._wPos=X.position(this.domNode),a="2px",Y=c.style;Y.top=(b?Z.y:0)+"px";Y.left=(b?0:Z.x)+"px";Y.height=b?this.height:a;Y.width=b?a:this.width;Y.display=this.delayResizing?"block":L;return c;},isDragValid:function E(Y){return Y.src.node===this.resizeHandleNode||this._super(Y);},ondragmove:function R(Y){if(!this.delayResizing){I.call(this,Y.tgt.pos);}if(this._super){this._super(Y);}},ondragend:function M(Y){if(this.delayResizing){I.call(this,Y.tgt.pos);}delete this._wPos;if(this._super){this._super(Y);}}});mstrmojo.ui.Splitter.ENUM_OR=U;}());(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.Widget;mstrmojo.Box=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:A.visibleMarkupMethod,onheightChange:A.heightMarkupMethod,onwidthChange:A.widthMarkupMethod}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.css");var F="",B="row-",E=mstrmojo.css.DISPLAY_TABLE;mstrmojo.Table=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Table",cellCssClass:"",rows:-1,cols:-1,_trows:-1,cellPadding:0,cellSpacing:0,layout:null,markupString:'<table id="{@id}" class="mstrmojo-Table {@cssClass}" style="{@cssText}" cellpadding="{@cellPadding}" cellspacing="{@cellSpacing}">{@tableHtml}</table>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?E:"none";}},preBuildRendering:function G(){var I=[],P=this.cellCssClass;if(this.layout){var Q=this._trows=this.layout.length;for(var K=0;K<Q;K++){var H=this.layout[K],R=H.cells,O=R.length,L=[];for(var J=0;J<O;J++){var N=R[J],M="";M+=((N.cssClass||P)?' class="'+(N.cssClass||P)+'"':"");M+=(N.cssText?' style="'+N.cssText+'"':"");M+=(N.rowSpan?' rowspan="'+N.rowSpan+'"':"");M+=(N.colSpan?' colspan="'+N.colSpan+'"':"");L[J]="<td"+M+"></td>";}var S="";S+=(H.cssClass?' class="'+H.cssClass+'"':"");S+=(H.cssText?' style="'+H.cssText+'"':"");I[K]="<tr"+S+">"+L.join("")+"</tr>";}}else{this._trows=this.rows;var M=(P?' class="'+P+'"':""),L=[];for(var K=0;K<this.rows;K++){for(var J=0;J<this.cols;J++){L[J]="<td"+M+"></td>";}I[K]="<tr>"+L.join("")+"</tr>";}}this.tableHtml=I.join("");if(this._super){this._super();}},postBuildRendering:function C(){if(this._trows){var M={},I=this.containerNode.rows,N=I.length;for(var L=0;L<N;L++){var K=I[L].cells,H=K.length;M[B+L]=I[L];for(var J=0;J<H;J++){M[F+L+","+J]=K[J];}}this.addSlots(M);}this._super();},childRenderCheck:function D(I){if(I&&!I.hasRendered){var H=I.slot||this.defaultChildSlot;return !!this[H]||H.match(/^([\d]+),([\d]+)$/);}return false;},on_child_change_rendering:function A(L){var H=(L&&L.src)||L,O=H&&H.domNode;if(O){var U=H.slot;if(!this[U]){var M=U&&U.match(/^([\d]+),([\d]+)$/);if(M){var R=parseInt(M[1],10),V=parseInt(M[2],10),Q=this.containerNode,T=this[(B+R)],N=[];if(!T){var J=Q.rows,S=J&&J.length||0;for(var K=S;K<=R;K++){N[B+K]=Q.insertRow();}T=N[B+R];}var P=T.cells&&T.cells.length||0;for(var K=P;K<=V;K++){var I=T.insertCell(K);N[F+R+","+K]=I;if(this.cellCssClass){I.className=this.cellCssClass;}}this.addSlots(N);}}}this._super(L);}});})();(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var B=mstrmojo.func,C=mstrmojo.dom,F="mstrmojo-popup-widget-hosted";mstrmojo.ui.PopupButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ui.PopupButton",onPopupWidgetClosed:mstrmojo.emptyFn,onPopupWidgetOpened:mstrmojo.emptyFn,anchorSlot:"domNode",isHostedWithin:true,hostedCSSClass:"",destroy:function H(L){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);}this._super(L);},getPopupWidget:mstrmojo.emptyFn,postCreateChildren:function D(){var L=this.getPopupWidget();if(!L||L._pbCfg){return ;}var M=function M(O,N){return function(){O.apply(N,arguments);};};L.onOpen=B.composite([M(this.onPopupWidgetOpened,this),L.onOpen||mstrmojo.emptyFn]);L.onClose=B.composite([M(this.onPopupWidgetClosed,this),L.onClose||mstrmojo.emptyFn]);L._pbCfg=true;},onclick:function K(L){var N=L.getTarget();if(N===this[this.anchorSlot]||N.parentNode===this[this.anchorSlot]){var M=this.getPopupWidget();if(!M.visible){this.openPopup(M);}else{this.closePopup();}}},onPopupAutoClosed:function I(M,L){if(C.contains(this[this.anchorSlot],C.eventTarget(L,M),true)){return false;}},getPopupHostNode:function J(){return this.containerNode;},getPopupConfig:function G(){var M=[F],L=this.hostedCSSClass;if(L){M.push(L);}return new mstrmojo.ui.PopupConfig({hostId:this.id,hostElement:this.getPopupHostNode(),anchorElement:this[this.anchorSlot],isHostedWithin:this.isHostedWithin,hostProxyCssClass:M.join(" ")});},unrender:function E(L){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);delete this._listenerProc;}this._super(L);},postBuildRendering:function A(){var P=this.getPopupWidget();if(P){var R=this.getPopupConfig();if(!R.isHostedWithin){var N=this.parent||this.opener,M=R.hostProxyCssClass.split(" ");M.push(this.domNode.className);while(N){var Q=N.themeClassName;if(Q){M.push(Q);break;}N=N.parent||N.opener;}R.hostProxyCssClass=M.join(" ");}P.popupConfig=P.addDisposable(R);}var L=P.id,O=this._listenerProc=function(){var S=mstrmojo.all[L];if(S&&S.visible&&S.adjustCornersForPopupOverflow){S.adjustCornersForPopupOverflow();}};if(this.isHostedWithin===false){C.attachEvent(window,"resize",O);}return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsPopup","mstrmojo._CanAutoClose");function A(B){return function(){this.domNode.style[B]=this[B]||"";};}mstrmojo.Popup=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.Popup",shadowNodeCssClass:"mstrmojo-popup-shadow",titleNodeCssClass:"mstrmojo-popup-title",contentNodeCssClass:"mstrmojo-popup-content",cssDisplay:"block",markupString:'<div id="{@id}" class="mstrmojo-Popup {@cssClass}" style="{@cssText}"><div class="mstrmojo-Popup-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Popup-title {@titleNodeCssClass}">{@title}</div><div class="mstrmojo-Popup-content {@contentNodeCssClass}"></div></div>',markupSlots:{containerNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onleftChange:A("left"),ontopChange:A("top"),onzIndexChange:A("zIndex")}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo._IsPopup","mstrmojo._CanAutoClose");var C=mstrmojo.dom;mstrmojo.ui.PopupWidget=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.PopupWidget",markupString:'<div id="{@id}" class="mstrmojo-ui-PopupWidget {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="pw-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},autoCloses:true,locksHover:true,closeOnClick:true,visible:true,onclick:function B(D){C.stopPropogation(null,D.e);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapperHoriz","mstrmojo.ListBuilder");mstrmojo.ListHoriz=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.ListHoriz",renderOnScroll:true,listMapper:mstrmojo.ListMapperHoriz,listBuilder:mstrmojo.ListBuilder,itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2");function B(E){var I=E.ctxtBuilder;if(I){var H=I.itemWidgets,G;for(G=H.length-1;G>-1;G--){var F=H[G];if(F){F.destroy(true);}}}}mstrmojo.WidgetListBase=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.WidgetListBase",unrender:function C(G){var I=this.ctxtBuilder;if(I){var H=I.itemWidgets,F;for(F=H.length-1;F>-1;F--){var E=H[F];if(E&&E.hasRendered){E.unrender(true);}}}this._super(G);},refresh:function A(E){B(this);if(this._super){this._super(E);}},destroy:function D(E){B(this);this._super(E);}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapper","mstrmojo.ListBuilder","mstrmojo.ListSelector");mstrmojo.List=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.List",renderOnScroll:true,listMapper:mstrmojo.ListMapper,listBuilder:mstrmojo.ListBuilder,listSelector:mstrmojo.ListSelector,itemIdField:"dssid",itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.SimpleTree","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.architect.ui._HasTreeDropZone","mstrmojo.string","mstrmojo.dom");var D=mstrmojo.dom,B=mstrmojo.string,L=mstrmojo.architect.EnumDataChangeEvents,K=mstrmojo.architect.EnumDragActions,A=K.PROJECT_TABLE_COLUMN,N=K.TABLE_VIEW_ATTR,J=K.TABLE_VIEW_METRIC,F=K.COMPOUND_FORM,P="item-mn",G="idx";mstrmojo.architect.ui.TableRows=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo.warehouse._CanToggleAvatarClass,mstrmojo.architect.ui._HasTreeDropZone],{scriptClass:"mstrmojo.architect.ui.TableRows",getItemMarkup:function C(S){return'<div class="item {@cls}" title="{@ttp}"><span class="item-ic"></span><span class="item-n">{@n}</span><span class='+P+"></span></div>";},getItemProps:function O(T,S){return{sel:!!this.selectedIndices[S],cls:("tp"+T.tp)+(T.unused?" uc":""),n:B.encodeHtmlString(T.n),idx:S,ttp:B.encodeXMLAttribute(T.ttp)};},getRowItem:function Q(S){return this.getTreeItem(S);},isItemAvailable:function I(S){return this.getItemWithPropName(this.items,"did",S).length>0;},handleEvent:function H(S){var T=this.getItemWithPropName(this.items,"did",S.did)[0];switch(S.name){case L.REMOVE:this.removeChild(T._renderIdx);return true;case L.RENAME:T.n=S.value;this.updateChild(T._renderIdx,T);return true;}return false;},onclick:function R(T){try{var W=T.target||D.eventTarget(T.hWin,T.e),V=D.findAncestorByAttr(W,G,true,this.domNode),S=V&&V.value;if(W.className===P&&S!==null){this.raiseEvent({name:"tableViewMenuSelect",data:this.getTreeItem(S),menuNode:W});}else{this._super(T);}}catch(U){throw U;}},dropZone:true,allowDrop:function E(S){return[A,N,F,J].indexOf(S.action)!==-1;},ondrop:function M(T){var S=mstrApp.getRootController(),W=T.src;if(W&&W.data){var V=W.data;var U=D.findAncestorByAttr(T.tgt.node,G,true,this.domNode);if(U){S.addTableInfo(V,this.getRowItem(U.value));}}this._super(T);}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.Obj","mstrmojo.date","mstrmojo.hash","mstrmojo.array","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.obj.DBObjects","mstrmojo.warehouse.obj.DBRole");mstrmojo.requiresDescs(12934,5160,11426,11427,11429,11430,11436,11437,11432,11434,12935,12936,11442,12942,10068,12943,12944,12945,12946);var R=mstrmojo,M=R.func.wrapMethods,o=R.date,U=R.hash,e=R.array,O=R.string,F=R.architect.menu.EnumMenuActions,P=mstrmojo.warehouse.EnumDataChangeEvents,V=P.DBTABLES_CHANGED,T=P.DBTABLES_REQUESTED,q=3000,AB=mstrmojo.warehouse.EnumDatabaseType.SAPHana,a=mstrmojo.warehouse.EnumNamespaceMode.ALL,f=mstrmojo.warehouse.EnumNamespaceMode.CURRENT,v=R.warehouse.EnumObjectTypes,AF=v.ATTRIBUTE,G=v.FACT,w=v.TABLE,AC=v.COLUMN,k=v.FORM,g=v.LAYER,I=v.DIMENSION,p=v.PROJECT,n=v.TRANSFORMATION,i=v.DBROLE;var AD={DssCatalogDefault:0,DssCatalogGetTables:1,DssCatalogGetColumns:2,DssCatalogGetTablePrimaryKeys:4,DssCatalogGetTableForeignKeys:8,DssCatalogGetTableKeys:12,DssCatalogGetTableSize:16,DssCatalogGetTableContent:32,DssCatalogGetColumnCardinality:64,DssCatalogGetColumnContent:128,DssCatalogGetFullCatalog:255,DssCatalogSelectedOnly:256,DssCatalogApplyConnectionMapping:512,DssCatalogAllNamespaces:1024,DssCatalogGetFresh:4096,DssCatalogIgnoreNamespace:8192,DssCatalogIgnoreCase:16384,DssCatalogIgnoreInvalidNames:32768,DssCatalogReuseMatching:65536,DssCatalogReuseCompatible:131072,DssCatalogReuseAny:262144,DssCatalogAugmentExisting:524288,DssCatalogSortDescending:1048576,DssCatalogSortTableNameFirst:2097152,DssCatalogGetNamespaces:16777216,DssCatalogCompareWithMetadata:134217728};var j={DssCatalogStateDefault:0,DssCatalogStateSelected:1,DssCatalogStateFresh:2,DssCatalogStateMissing:4,DssCatalogStateUnexpected:8,DssCatalogStateCompatibleSmaller:16,DssCatalogStateCompatibleLarger:32,DssCatalogStateCompatible:64,DssCatalogStateIncompatible:128,DssCatalogStateCompatibilityMask:240,DssCatalogStateFreshTables:256,DssCatalogStateMissingTables:512,DssCatalogStateFreshColumns:1024,DssCatalogStateMissingColumns:2048,DssCatalogStatePartitionMappingTable:65536,DssCatalogStateDummyPartitionMappingTable:131072,DssCatalogStateDummyPartitionSliceTable:262144};function d(AG){return O.decodeHtmlString(AG).replace(/&apos;/g,"'");}function J(){var AG=new Date();return" - "+[("00"+AG.getHours()).slice(-2),("00"+AG.getMinutes()).slice(-2),("00"+AG.getSeconds()).slice(-2)].join(":");}function L(AG){var AH=" ",AL="-",AM=":",AK=AG.split(AH),AI=AK[0].split(AL),AJ=AK[1].split(AM);return new Date(Date.UTC(AI[0],parseInt(AI[1],10)-1,AI[2],AJ[0],AJ[1],AJ[2]));}function m(AI,AH,AG){mstrApp.getRootController().getDataService()[AG||"submitRequest"](AI,AH);}function t(AI,AH,AG){AH.showWait=AG;mstrApp.getRootController().getDataService().submitRequest(AI,AH);}function Q(AG){var AI={},AH=[];e.forEach(AG,function(AJ){AI[AJ.propset]=AJ.propset;AH.push(AJ.propset+","+AJ.prop);});return U.valarray(AI).join(",,")+";"+AH.join(",,");}function l(AH){var AG=AH.ab;if(AG===0){AG=this.dbObjects.dbVersion2dbId[AH.db_ver];}return AG;}function B(AI,AH,AG){var AJ=true;e.forEach(AG,function(AK){if(AK===AI){AJ=false;return false;}});if(!AJ){return false;}if(!AH||!AH.length){return true;}AJ=false;e.forEach(AH,function(AK){if(AK===AI){AJ=true;return false;}});return AJ;}mstrmojo.warehouse.WHModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.WHModel",schemaInstanceID:"",dbtbls:{},dbtables:[],cachedStamp:{},dbrs:[],dbObjects:undefined,namespaces:[],catalogStamp:"",SelDBRoleID:null,SelNameSpaceID:null,catalogRefresh:false,privileges:{},dbRolesTypeFilter:[],dbRolesVersionFilter:[],dbmsTypeFilter:[],dbmsVersionFilter:[],dbRolesTypeExcludeFilter:[],dbRolesVersionExcludeFilter:[],dbmsTypeExcludeFilter:[],dbmsVersionExcludeFilter:[],dbObjectsDisplayOptions:1,dbObjectsConnectionType:1,showAddDriver:false,usingCookieNamespace:false,currentDBRole:undefined,allDBRoleNames:undefined,cas:undefined,tis:undefined,xrc:undefined,vldbProperties:undefined,propset:undefined,ns:undefined,did:undefined,clis:undefined,cln:undefined,dbRoleEditorCfg:{},databaseType:undefined,isDataImport:undefined,postCreate:function X(){var AG=this;this.dbObjects=new mstrmojo.warehouse.obj.DBObjects();if(mstrApp.isSingleTier){if(navigator.platform.indexOf("Win")===-1){this.dbObjectsConnectionType=2;this.showAddDriver=true;}return ;}t({success:function(AH){AG.privileges=AH.privileges;}},{taskId:"arch.checkPrivileges",skipSchemaIDCheck:true},true);},loadDBTypeFilters:function C(AI){var AG=this;AG.dbObjects.populateDBProperties(M({success:function AH(){var AK=[],AJ=AG.dbObjectsDisplayOptions;U.forEach(AG.dbObjects.dbTypes,function(AL){if((AL.disp&AJ)===AJ){AK.push(AL.v);}});AG.dbmsTypeFilter=AK;AG.dbRolesTypeFilter=AK.slice(0);}},AI));},loadDBRoles:function D(AN,AH){var AI=this,AM;AI.raiseEvent({name:P.DBROLES_REQUESTED});var AL={taskId:"arch.search",objecttypes:i,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:AI.dbRolesTypeFilter.join(","),versionFilter:AI.dbRolesVersionFilter.join(","),typeExcludeFilter:AI.dbRolesTypeExcludeFilter.join(","),versionExcludeFilter:AI.dbRolesVersionExcludeFilter.join(",")};var AG=M({success:function AK(AS,AT){var AO=[],AR=AI.currentDBRole,AQ=0,AU=(AI.dbIds&&AI.dbIds.length===1),AP;e.forEach(AS.dbRoles,function(AV,AW){if(AT){if(!B(AV.db_type,AI.dbRolesTypeFilter,AI.dbRolesTypeExcludeFilter)||!B(AV.db_ver,AI.dbRolesVersionFilter,AI.dbRolesVersionExcludeFilter)){return ;}}if(AU){AP=l.call(AI,AV);if(AV.ab===0&&(AP===9||AP===125)&&(AI.dbIds[0]===9||AI.dbIds[0]===125)){AO.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AV,mdl:AI}));}else{if(AI.dbIds[0]===AP||AV.db_ver===-1){AO.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AV,mdl:AI}));}else{if(AI.dbObjectsDisplayOptions===1&&AV.ab===0&&AP===undefined){AO.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AV,mdl:AI}));}else{if(AI.dbObjectsDisplayOptions===16&&AV.ab===0){AO.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AV,mdl:AI}));}}}}}else{AO.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AV,mdl:AI}));}if(AR&&AV.did===AR.did){AQ=AW;}});AI.currentDBRole=undefined;AI.set("dbrs",AO);AI.raiseEvent({name:P.DBROLES_LOADED,items:AO,offset:AQ});AI.allDBRoleNames={};e.forEach(AS.allNames||[],function(AV){AI.allDBRoleNames[AV.did]=AV;});}},AN);if(AI.isDataImport!==undefined){AL.isDataImport=AI.isDataImport;}if(!mstrApp.isSingleTier&&mstrApp.placeholder==="QBApp"&&!AH&&AI.isDataImport){AM=mstrApp.type;var AJ=mstrmojo.qb.EnumQBAppType;if((AM===AJ.QueryBuilder||AM===AJ.FFSQL||AM===AJ.EmmaSingleTable)&&AI.dbObjectsDisplayOptions!==16&&AI.dbObjectsDisplayOptions!==4){if(mstrApp.dbRoles){AG.success(mstrApp.dbRoles,true);}else{mstrApp.serverRequestParallel(AL,AG,true);}return ;}}if(!mstrApp.isSingleTier&&AH&&mstrApp.dbRoles){mstrApp.dbRoles=undefined;if(mstrApp.container&&mstrApp.container.launchingApp){mstrApp.container.launchingApp.dbRoles=undefined;}}m(AG,AL,"search");},loadDBObjects:function S(AG){this.dbObjects.load(this.dbmsTypeFilter,this.dbmsVersionFilter,AG);},_set_SelDBRoleID:function c(AJ,AI){var AH=this,AG=this.getDBRole(AI);AH.SelDBRoleID=AI;AH.SelNameSpaceID=undefined;if(AG&&AG.mdDBRole){AH.getNameSpaces({sourceInfo:"tablesPanel"});}else{if(!AI){AH.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:""});AH.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:[],namespaceMode:f,dbRoleID:AI,error:true});}}AH.raiseEvent({name:P.DBROLE_SELECTION,value:AH.SelDBRoleID});},onSelNameSpaceIDChange:function A(AG){this.SelNameSpaceID=AG.value;this.getSelectedDBRoleTables({blockBegin:0,blockCount:1000,filterText:""},{failure:function AH(AJ){if(AJ){R.alert(AJ.getResponseHeader("X-MSTR-TaskFailureMsg"));}}});var AI=window.localStorage;if(AI){AI.setItem(this.SelDBRoleID,this.SelNameSpaceID);}},getDBRole:function h(AH){var AI="00000000000000000000000000000000";var AG=e.find(this.dbrs,"did",(AH===AI)?this.projPrimaryDBRoleID:AH);if(AG>=0){return this.dbrs[AG];}return null;},getNameSpaces:function y(AL){var AM=this,AG=AL.dbRoleID||AM.SelDBRoleID,AK=AD.DssCatalogGetNamespaces|AD.DssCatalogApplyConnectionMapping,AN=this.getDBRole(AG),AJ=false,AH=false,AI=AN&&AN.mdDBRole&&AN.mdDBRole.db_type,AO;switch(AI){case 4000:AJ=true;break;case 3000:AH=true;break;default:break;}if(AL.getFresh){AK=(AK|AD.DssCatalogGetFresh);}AM.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:AL.sourceInfo||""});AO={success:function(AP){AM.namespaces=AP.ns;AM.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:AJ?[]:AM.namespaces,namespaceMode:a,dbRoleID:AG,namespace:AM.SelNameSpaceID,sourceInfo:AL.sourceInfo||""});},failure:function(AP){AM.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:[],namespaceMode:f,dbRoleID:AG,sourceInfo:AL.sourceInfo||"",error:true});if(AP){R.alert(AP.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(AH){AO.success({ns:[]});return ;}if(!AJ){AM.raiseEvent({name:P.NAMESPACES_REQUESTED,sourceInfo:AL.sourceInfo||""});}t(AO,{taskId:"arch.catalogAction",dbrid:AG,flags:AK},false);},getSelectedDBRoleTables:function r(AW,AJ){var AI=this,AH=AW.getFresh||false,AY=AW.dbRoleID||AI.SelDBRoleID||AI.projPrimaryDBRoleID,AN=AI.cachedStamp,AG=AI.dbtbls,AR=AW.filterText.toString(),AX=AI.getDBRole(AY);if(AH){AI.catalogRefresh=true;}if(!AX||AX.mdDBRole.db_type===q){AI.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:AW.sourceInfo||""});return ;}var AO=(AG[AY]=AG[AY]||{}),AS=(AN[AY]=AN[AY]||{}),AP=O.decodeHtmlString(AW.nameSpace||AI.SelNameSpaceID||""),AL=false,AQ=[],AT=[],AV,AM=AO[AP],AU=(AX.mdDBRole.db_type===AB);if(!AI.catalogRefresh&&AO&&(AM!==undefined)){U.forEach(AM,function(Aa,AZ){AL=true;AV=new mstrmojo.warehouse.obj.TableData({id:AZ,n:AZ,tp:w,model:AI,ns:Aa.ns,did:AZ,sta:parseInt(Aa.sta,10),items:[],dbtn:Aa.tbn});if(AU){AV.extt=Aa.extt;AV.hanai=Aa.hanai;}if(AR!==""&&AZ.toUpperCase().indexOf(AR.toUpperCase())>-1){AQ.push(AV);}AT.push(AV);});if(AL){AI.set("catalogStamp",AS[AP]);AI.raiseEvent({name:V,items:(AR!=="")?AQ:AT,selectedItems:AI.getDBRoleTablesInUse(AY)||[],sourceInfo:AW.sourceInfo||""});if(AJ&&AJ.success){AJ.success({items:(AR!=="")?AQ:AT});}return ;}}AM=(AO[AP]={});AS[AP]=null;var AK=AD.DssCatalogGetTables|AD.DssCatalogApplyConnectionMapping;AK=AI.catalogRefresh?(AK|AD.DssCatalogGetFresh):AK;AI.raiseEvent({name:T,sourceInfo:AW.sourceInfo||""});t(M({success:function(Ac){var AZ=Ac.xrc.cas[0],Af=AZ.timestamp,Aa=AZ.tis,Ab,Ad;if(Af){var Ae=o.getDateJson(L(Af.replace(/&apos;/,"")));Af=[o.formatDateInfo(Ae,"yyyy-MM-dd")," ",o.formatTimeInfo(Ae,"hh:mm a")].join("");}AS[AP]=Af;AI.set("catalogStamp",Af);AI.catalogRefresh=false;e.forEach(Aa,function(Ag){Ab=Ag.tbn=d(Ag.tbn);Ad=Ag.ns=d(Ag.ns);if(!AM[Ab]){AM[Ab]=Ag;AO[Ad]=AO[Ad]||{};AO[Ad][Ab]=Ag;}});U.forEach(AM,function(Ah,Ag){AV=new mstrmojo.warehouse.obj.TableData({id:Ag,n:Ag,tp:w,model:AI,ns:Ah.ns,did:Ag,sta:parseInt(Ah.sta,10),items:[],dbtn:Ah.tbn});if(AU){AV.extt=Ah.extt;AV.hanai=Ah.hanai;}AT.push(AV);});AI.raiseEvent({name:V,items:AT,selectedItems:AI.getDBRoleTablesInUse(AY)||[],sourceInfo:AW.sourceInfo||""});},failure:function(){AI.raiseEvent({name:V,items:AT,selectedItems:AI.getDBRoleTablesInUse(AY)||[],sourceInfo:AW.sourceInfo||""});}},AJ),{taskId:"arch.catalogAction",dbrid:AY,flags:AK,ns:AP},false);},getDBRoleTablesAndColumns:function AE(AH,AI){var AG=this;if(!AH.dbRoleID){return ;}t(M({success:function(AM){var AJ=AM.xrc.cas[0],AK=AJ.tis,AP=[],AO={},AL,AN;e.forEach(AK,function(AQ){AN=d(AQ.ns);AL=d(AQ.tbn);AP.push({n:(AN?AN+"."+AL:AL),tp:w});e.forEach(AQ.clis,function(AR){AO[AR.cln]={n:AR.cln,tp:AC};});});AM.tables=AP;AM.columns=U.valarray(AO);}},AI),{taskId:"arch.catalogAction",dbrid:AH.dbRoleID,flags:AD.DssCatalogGetTables+AD.DssCatalogGetColumns,ns:O.decodeHtmlString(AG.SelNameSpaceID||"")},true);},getDBRoleTablesInUse:mstrmojo.emptyFn,getColumnsForDBTable:function b(AK,AO){var AN=this,AG=AK.data.dbrole||AN.SelDBRoleID,AM=AK.data,AL=AK.getFresh||false,AS=AM.n,AJ=AM.ns,AP=AM.tableId,AI,AH=AD.DssCatalogGetColumns+AD.DssCatalogApplyConnectionMapping+AD.DssCatalogIgnoreCase+(AK.compareWithMD?AD.DssCatalogCompareWithMetadata:0),AR;if(AG){if(!AL){if(AJ){AR=AN.dbtbls[AG][AJ][AS];AI=AR.columns;}else{AR=AN.dbtbls[AG][AS];if(AR){AI=AR.columns;}}if(AI){AO.success({src:AK,items:AI,selDBRole:AG,hanaInfo:AR.hanaInfo});if(AO&&AO.complete){AO.complete();}return ;}}AH=AL?(AH|AD.DssCatalogGetFresh):AH;t(M({success:function AQ(AU){var AV=AU.xrc.cas[0].tis[0],AT=[],AW=AV.hanai;AI=AV.clis;e.forEach(AI,function(AX){AT.push(new mstrmojo.architect.obj.Column({dbInfo:AX}));});AR=AN.dbtbls[AG][AJ][AS];if(AT.length>0){AR.columns=AT;}AR.hanaInfo=mstrmojo.hash.clone(AW);AU.items=AT;AU.hanaInfo=AR.hanaInfo;}},AO),{taskId:"arch.catalogAction",dbrid:AG,schemaid:AN.schemaInstanceID,ns:AJ,dbts:JSON.stringify([{tbn:AM.dbtn,ns:AJ,tbid:AP}]),flags:AH},true);}},saveDBRole:function H(AH,AG,AK){var AI=this;t(M({success:function AJ(AM){if(!AG){var AL=AI.getDBRole(AM.dbr.did);AL.populated=false;AL.populate(function AN(){AI.raiseEvent({name:AG?P.DBROLES_ADD:P.DBROLES_RENAME,item:AL});});}else{AI.currentDBRole=AM.dbr;AI.loadDBRoles(undefined,true);}}},AK),{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",dbroleinfo:JSON.stringify(AH),showWait:true},true);},deleteDBRole:function K(AH,AJ){var AG=this;t(M(AJ,{success:function AI(){var AK=e.find(AG.dbrs,"did",AH);if(AK>-1){AG.dbrs.splice(AK,1);}delete AG.allDBRoleNames[AH];if(AG.SelDBRoleID===AH){AG.set("SelDBRoleID",AG.projPrimaryDBRoleID);}AG.raiseEvent({name:P.DBROLES_DELETE,item:{did:AH}});}}),{taskId:"arch.deleteObject",schemaid:AG.schemaInstanceID,objectid:AH,objecttype:29,showWait:true},true);},populateDBRole:function Z(AG,AH){t(AH,{isDataImport:false,reverseOrder:true,verbose:true,taskId:"getDBInstances",vldbProperties:Q(this.dbObjects.preferences.vldbProperties),objectID:AG,skipSchemaIDCheck:true,showWait:false},false);},handleEnabledAction:function E(){return true;},handleVisibleAction:function u(AI,AH){if(!AH){return true;}switch(AH.action){case F.SET_AS_PRIMARY:return mstrApp.isArchitect&&!AI.isPrimary;case F.IS_PRIMARY:return mstrApp.isArchitect&&AI.isPrimary;case F.UPSTRUCT:return true;case F.CATALOG_SQL:var AG=this.getDBRole(AI.did);return(mstrApp.getRootController().canDisplayCatalogSQL(this.dbObjects.dbTypes,AG.mdDBRole.db_type));}return true;},handleCheckAction:function AA(AH,AG){switch(AG.action){case F.IS_PRIMARY:return AH.isPrimary;}return false;},findNameInHash:function W(AJ,AG){var AI=false,AH="";U.forEach(AJ,function(AK){AH=AK.name||AK.n;if(AH.toString().toUpperCase()===AG){AI=true;return false;}return true;});return AI;},validateName:function Y(AO,AN,AG,AK){var AI=this,AQ=10000,AJ={},AR,AH,AM=R.desc(12934,"Object names need to be less than 250 characters"),AL=R.desc(5160,'An object name cannot contain the following characters " \\ [ ]');switch(AO){case AF:case k:AJ=AI.getAttributes();AR=R.desc(11426,"The attribute name cannot be empty.");AH=R.desc(11427,"The name is currently in use by another attribute.");break;case G:AJ=AI.getFacts();AR=R.desc(11429,"The fact name cannot be empty.");AH=R.desc(11430,"The name is currently in use by another fact.");break;case w:AJ=AI.tables;AR=R.desc(11436,"The table name cannot be empty.");AH=R.desc(11437,"The name is currently in use by another table.");break;case g:AJ=AI.layers;AR=R.desc(11432,"The layer name cannot be empty.");AH=R.desc(11434,"The name is currently in use by another layer.");break;case I:AJ=AI.userHierarchies;AR=R.desc(12935,"The hierarchy name cannot be empty.");AH=R.desc(12936,"The name is currently in use by another hierarchy.");break;case p:AJ=AK;AR=R.desc(11442,"The project name cannot be empty.");AH=R.desc(12942,"The project name already exists.");break;case i:AJ=AI.allDBRoleNames;e.forEach(AI.dbrs,function(AS){AJ[AS.did]=AS;});AR=R.desc(10068,"The Database Connection name can't be empty");AH=R.desc(12943,"The database connection name already exists.");break;case n:AJ=AI.transformations;AR=R.desc(12944,"The transformation name cannot be empty.");AH=R.desc(12945,"The transformation name already exists.");break;default:R.alert(R.desc(12946,"object type cannot be validated, it's not defined yet"),undefined,undefined,AQ);return false;}if(AN===""){R.alert(AR,undefined,undefined,AQ);return false;}if(AG){if(AG.toString().toUpperCase()===AN.toString().toUpperCase()){return true;}}if(AN.length>250){R.alert(AM,undefined,undefined,AQ);return false;}var AP=/[\[\]\\"]/;if(AP.test(AN)){R.alert(AL,undefined,undefined,AQ);return false;}if(this.findNameInHash(AJ,AN.toUpperCase())){R.alert(AH,undefined,undefined,AQ);return false;}return true;},findinArray:function z(AH,AM,AI){var AK=AI.toUpperCase(),AG=(AH&&AH.length)||0,AJ,AL;for(AJ=0;AJ<AG;AJ++){AL=AH[AJ];if(AL&&AL[AM].toUpperCase()===AK){return AJ;}}return -1;},findNextName:function x(AH,AJ,AL){AH+=(J());var AI=1,AG=AH,AK=AG.toUpperCase();do{if(this.findinArray(AJ,AL,AK)>=0){AG=AH+" "+AI++;AK=AG.toUpperCase();}else{return AG;}}while(AI<100);return"Temp Object";}});var N=mstrmojo.warehouse.WHModel;N.DssCatalogFlags=AD;N.DSSCatalogStateFlags=j;}());(function(){mstrmojo.requiresCls("mstrmojo.ListSelector","mstrmojo.List","mstrmojo.string");mstrmojo.OBList=mstrmojo.declare(mstrmojo.List,null,{scriptClass:"mstrmojo.OBList",cssClass:"mstrmojo-OBList",itemClass:"mstrmojo-OBListItem",iconClass:"mstrmojo-OBListItemIcon",textClass:"mstrmojo-OBListItemText",iconCssPrefx:"mstrmojo-OBIcon_",itemMarkupFunction:function(C,A,B){return'<div class="'+B.itemClass+(C[B.itemType]?" t_"+C[B.itemType]:"")+(C[B.itemSubType]?" st_"+C[B.itemSubType]:"")+(C[this.itemISC]?" isc":"")+(C[B.itemViewMedia]?" vm_"+C[B.itemViewMedia]:"")+'"><table cellspacing="0" cellpadding="0"><tbody><tr><td>'+B.getIcon(C)+'</td><td><div class="'+B.textClass+'" title="'+B.getTooltip(C)+'">'+mstrmojo.string.htmlAngles(C.n)+"</div></td></tr></tbody></table></div>";},getIcon:function(F){var E=F[this.itemType],D=F[this.itemSubType],B=" t"+E,C=(parseInt(E,10)===1||parseInt(E,10)===3||parseInt(D,10)===14082)?" st"+D:"",G=F[this.itemISC]?'class="mstrmojo-ListIcon isc"':"",A=(F[this.itemViewMedia]===2048||F[this.itemViewMedia]===8192)?" hvi":"";return'<span class="mstrmojo-ListIcon '+B+C+A+'"><span '+G+"></span></span>";},getTooltip:function(C){var D="",F=C.anc&&C.anc.items,A=F&&F.length,B;if(A>0){for(B=0;B<A-1;B++){D+=F[B].n+" > ";}D+=F[A-1].n;}var E=C.desc,G=128;if(E){D+="\r\n\r\n"+E.substring(0,G)+(E.length>G?"...":"");}return D;},listSelector:mstrmojo.ListSelector,selectionPolicy:"reselect",itemType:"t",itemSubType:"st",itemISC:"isc",itemViewMedia:"dvm",useDblSelect:false});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.Popup","mstrmojo.List","mstrmojo.DropDownButton");var B=mstrmojo.dom;mstrmojo.Pulldown=mstrmojo.declare(mstrmojo.DropDownButton,null,{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-Pulldown",items:null,itemIdField:"dssid",itemField:"n",itemCSS:"css",itemTitleField:null,defaultSelection:0,defaultText:null,title:"",value:null,popupToBody:false,popupCssClass:"",popupZIndex:null,fixWidth:false,fixHeight:false,_set_items:function(H,F){var G=this.items;this.items=F||[];return G!==this.items;},markupMethods:mstrmojo.hash.copy({onvalueChange:function(){var G=this.value,F=this.selectedIndex,I=this.items||[],J,H;if(F===undefined||(G!==null&&(F===-1||(F!==-1&&I[F]&&I[F][this.itemIdField]!==G)))){F=mstrmojo.array.find(I,this.itemIdField,G);F=(F>-1)?F:this.defaultSelection;this.selectedIndex=F;}else{if(G===null){this.selectedIndex=this.defaultSelection;}}this.selectedItem=J=I[this.selectedIndex];if(J){H=J[this.itemField];}else{H=this.defaultText||"";}this.set("text",H);}},mstrmojo.hash.copy(mstrmojo.DropDownButton.prototype.markupMethods)),prevalueChange:function D(){var G=this.value,F=-1;if(G!==null){F=mstrmojo.array.find(this.items,this.itemIdField,G);}if(F>-1){this.selectedItem=this.items[F];this.selectedIndex=F;}},togglePopup:function E(){if(this.popupToBody){var I=B.position(this.popupNode,true),H=this.popupRef,F={left:Math.round(I.x)+"px",top:Math.round(I.y)+"px"};if(!H.hasRendered){delete H.slot;F.placeholder=document.body.appendChild(document.createElement("div"));}this.popupOpenConfig=this.popupOpenConfig||{};mstrmojo.hash.copy(F,this.popupOpenConfig);}else{this.popupRef.slot="popupNode";}if(this._super){this._super();}var G=this.popupRef.domNode;if(G){if(this.fixWidth){G.style.width=(this.domNode.offsetWidth-2)+"px";}else{G.style.minWidth=(this.domNode.offsetWidth-2)+"px";}}},premousedown:function A(F){if(B.getButton(F.hWin,F.e)===B.MOUSE_BUTTON.LEFT){this.togglePopup();}},unrender:function C(F){var G=this.popupRef;if(this.popupToBody&&G.hasRendered){G.unrender(false);}if(this._super){this._super(F);}},itemName:function(H,F,G){return mstrmojo.string.encodeHtmlString(H[G.itemField]);},popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",cssClass:"mstrmojo-Pulldown-Popup",autoCloses:false,modal:false,autoClose:true,locksHover:true,onOpen:function(){var H=this.opener,G=H&&H.popupZIndex,I=(H&&H.popupCssClass)||"",F=this.domNode;if(G){F.style.zIndex=G;}if(I){mstrmojo.css.addClass(F,[I]);}if(H&&H.fixWidth){mstrmojo.css.addClass(F,["fix-width"]);}if(H&&H.fixHeight){mstrmojo.css.addClass(F,["fix-height"]);}},children:[{scriptClass:"mstrmojo.List",alias:"list",itemMarkupFunction:function(I,F,G){var H=I[G.itemCSS]||G.parent.opener.item2textCss&&G.parent.opener.item2textCss(I)||"",J=G.parent.opener.itemName;return'<div class="mstrmojo-Pulldown-listItem"><div class="mstrmojo-text '+H+'" title="'+I[G.itemTitleField||G.itemField]+'">'+(J(I,F,G)||"&nbsp;")+"</div></div>";},renderOnScroll:false,bindings:{itemIdField:"this.parent.opener.itemIdField",itemField:"this.parent.opener.itemField",itemCSS:"this.parent.opener.itemCSS",itemTitleField:"this.parent.opener.itemTitleField",items:"this.parent.opener.items",selectionPolicy:"this.parent.opener.selectionPolicy",selectedIndex:"this.parent.opener.selectedIndex"},onmousedown:function(){this.parent.close();},onchange:function(){var H=this.parent,I=H.visible,F=H.opener,G=this.selectedItem;if(!F||!G||!I){return ;}F.set("value",G[this.itemIdField]);}}]}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetListBase","mstrmojo.WidgetListMapper","mstrmojo.WidgetListBuilder");mstrmojo.WidgetList=mstrmojo.declare(mstrmojo.WidgetListBase,null,{scriptClass:"mstrmojo.WidgetList",renderOnScroll:true,listMapper:mstrmojo.WidgetListMapper,listBuilder:mstrmojo.WidgetListBuilder,itemConfig:null,itemFunction:null,initBindings:function(){this._super();var E=this.ctxtBuilder,D=E&&E.itemWidgets;if(D){for(var C=0,A=D.length;C<A;C++){var B=D[C];if(B&&B.initBindings){B.initBindings();}}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListHoriz","mstrmojo.fx");mstrmojo.FishEye=mstrmojo.declare(mstrmojo.ListHoriz,null,{scriptClass:"mstrmojo.FishEye",width:16,size:10,step:16,speed:2,cssClass:"mstrmojo-FishEye",cssClassItem:"mstrmojo-dot",itemMarkupFunction:function(B,A,C){return'<div class="mstrmojo-fisheye-item '+C.cssClassItem+'" title="'+B.n+'" idx="'+A+'" did="'+B.did+'">&nbsp;</div>';},onchange:function(){this.scroll2();this.parent.set("selectedIndex",this.selectedIndex);},as:new mstrmojo.fx.AnimateProp(),onitemsChange:function(){if(this._super){this._super();}this.last=this.items.length-1;this.first=Math.max(0,this.last-this.size);if(this.items.length>this.size){this.scroll("left",this.width);}},scroll2:function(){var A=this.selectedIndex-this.last;if(this.selectedIndex==this.first&&this.first>0){this.scroll("right",this.width);}else{if(this.selectedIndex==this.last&&this.last<this.items.length-1){this.scroll("left",this.width);}else{if(this.selectedIndex>this.last){A=this.selectedIndex-this.last;this.scroll("left",this.width*A,A);this.last=Math.min(this.items.length-1,this.last+A);}else{if(this.selectedIndex<this.first){A=this.first-this.selectedIndex;this.scroll("right",this.width*A,A);this.first=Math.max(0,this.first-A);}}}}},scroll:function(C,F,E){var B=this.itemsContainerNode,I=B&&B.style;var D=this.as,H=parseInt(mstrmojo.css.getStyleValue(B,{left:"right",right:"left"}[C]),10),H=isNaN(H)?0:H,A=parseInt(I.left,10)||0,G=A+(C=="left"?-1:1)*(F||(Math.min(this.step,(-1)*H)));D.target=B;D.props={left:{start:A,stop:G,duration:100,interval:10,suffix:"px"}};D.play();E=E===undefined?1:E;this.first+=(C=="left"?1:-1)*E;this.last=this.first+this.size-1;this.parent.set("scrollable",this.last<this.items.length-1);this.parent.set("rightScrollable",this.first>0);return G;},srcId:null,postBuildRendering:function(){if(this._super){this._super();}this.hasRendered=!!this.domNode;var E=this.itemsContainerNode,A=E&&E.firstChild,B=A&&A.rows&&A.rows[0],D=B&&B.cells&&B.cells[0];this.first=0;this.last=this.size-1;var C=this.srcId;if(C&&mstrmojo.all[C]&&mstrmojo.all[C].attachEventListener){mstrmojo.all[C].attachEventListener("change",this.id,function(F){if(this.items[this.items.length-1]!=F.src.selectedItem){this.items.add([mstrmojo.hash.copy(F.src.selectedItem)]);this.set("selectedIndex",this.items.length-1);}if(this.items.length>this.size){this.set("rightScrollable",this.items.length>this.size);this.scroll("left",this.width*(this.selectedIndex-this.last),(this.selectedIndex-this.last));}});}this.itemsContainerNode.style.left=Math.min(0,(this.size-this.items.length+1))*this.width+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupWidget","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.css");mstrmojo.ui.menus.MenuPopup=mstrmojo.declare(mstrmojo.ui.PopupWidget,[mstrmojo.ui.menus._IsMenuPopup],{scriptClass:"mstrmojo.ui.menus.MenuPopup",popupConfig:null,init:function B(D){this._super(D);var C=this.popupConfig;if(!C.contents){throw new Error("Cannot open popup without contents.");}this.cssClass=C.cssClass||"";this.addChildren(C.contents);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-MenuPopup");},shouldPropagateLockHover:function A(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Box","mstrmojo.ui._HasScroller","mstrmojo.ME.Enum");mstrmojo.requiresDescs();var M=mstrmojo.dom,B=mstrmojo.string,D=mstrmojo.Widget;var H=/\r?\n?----\r?\n?/;function F(N){var O=B.decodeHtmlString((N||{}).desc||"",true).split(H);return{desc:O[0],example:O.length===2?O[1]:""};}mstrmojo.ME.FunctionInfo=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionInfo",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="mstrmojo-FunctionInfo-container"><div class="mstrmojo-FunctionInfo-syntax"></div><div class="mstrmojo-FunctionInfo-desc"></div><div class="mstrmojo-FunctionInfo-eg"><span class="icon" t="icon"></span><span class="text"></span></div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},syntaxNode:function(){return this.domNode.firstChild.firstChild;},descNode:function(){return this.domNode.firstChild.childNodes[1];},egNode:function(){return this.domNode.firstChild.lastChild;},egTextNode:function(){return this.domNode.firstChild.lastChild.lastChild;}},markupMethods:{onvisibleChange:D.visibleMarkupMethod,onfoiChange:function(){this.syntaxNode.innerHTML=B.htmlAngles(this.syntax)||"";this.descNode.innerHTML=this.desc;this.egTextNode.innerHTML=this.example;this.egNode.style.display=this.example?"block":"none";this.updateScrollbars();}},foi:{},syntax:"",desc:"",example:"",init:function L(N){this._super(N);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-FunctionInfo");},setupScrollNodes:function C(){if(!mstrmojo.dom.ISIE8){this.scrollNode=this.containerNode;}},onfoiChange:function A(){this.set("syntax",this.getFunctionSyntax());this.set("desc",this.getDesc()+" "+this.getHelpTopic());this.set("example",this.getExample());},getFunctionSyntax:function K(R){var T=R||this.foi;if(!T){return"";}if(T.did<0){return T.n;}var Q=T.pars,S=T.pros,O=[],P,N;O.push(T.n);S=mstrmojo.hash.clone(S)||[];if(T.ios){S.push({n:"SortBy"});}if(T.sqt===5){S.push({n:"BreakBy"});}if(this.showFullSyntax){if(S.length>0){O.push("<");for(P=0,N=S.length;P<N;P++){if(mstrmojo.array.indexOf(mstrmojo.ME.Enum.NonExposableParams,S[P].n)===-1){O.push(S[P].n);O.push(", ");}}O.pop();O.push(">");}}O.push("(");for(P=0,N=Q.length;P<N;P++){O.push(Q[P].n);if(P!==(N-1)){O.push(", ");}}O.push(")");return O.join("");},getDesc:function E(){return F(this.foi).desc;},getExample:function J(){return F(this.foi).example;},getHelpTopic:function G(N){var O=N||this.foi;if(!O||O.did===mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(O.h);},useRichTooltip:true,showTooltip:function I(N,Q){var P=M.eventTarget(Q,N),O=this.foi;if(P&&P.getAttribute("t")==="icon"){this.richTooltip=this.getTooltip(O,P);if(this.richTooltip){this._super(N,Q);}}},getTooltip:function(Q,R){var O=M.position(R),P=R.egTip||"";var N={areaId:Q._renderIdx+"text",cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:P,top:O.y-75,left:O.x+O.w-30,enableHover:false};return N;}});mstrmojo.ME.FunctionInfo.getDescAndExample=F;}());(function(){mstrmojo.requiresCls("mstrmojo.Box");var B=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox",cssClass:"mstrmojo-wh-DBRoleSettingGroupBox",groupbox:undefined,isRequired:false,isGroupSetting:true,enabled:true,onenabledChange:function E(){var F=this.enabled;B.forEach(this.children,function(G){G.set("enabled",F);});},getValue:function A(){return"";},setValue:function D(F){},isValid:function C(){return{val:true,msg:""};},children:[{scriptClass:"mstrmojo.Box",alias:"groupbox",children:[]}]});}());(function(){mstrmojo.requiresCls("mstrmojo._HasLayout","mstrmojo.Box","mstrmojo.css","mstrmojo.HBox","mstrmojo.string","mstrmojo.TextBox");var H=mstrmojo.css,E=mstrmojo.dom,C=mstrmojo.desc(505,"Update"),D="clear";mstrmojo.warehouse.ui.SearchBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.ui.SearchBox",cssClass:"mstrmojo-wh-SearchBox",tableBox:undefined,inputBox:undefined,clearBtn:undefined,refreshBtn:undefined,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-wh-SearchBox-contents",alias:"tableBox",children:[{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-sb-input",alias:"inputBox",oldText:"",onkeydown:function G(){this.oldText=this.value;},onkeyup:function B(){var P=this,N=this.value,M=this.parent.clearBtn,Q=this._searchTimeoutId,O=this._hasText=N.length>0;if(this.oldText!==N){H.toggleClass(M.domNode,[D],O);window.clearTimeout(Q);this._searchTimeoutId=window.setTimeout(function(){P.parent.parent.triggerSearch();},this.searchDelay);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-sb-btn",alias:"clearBtn",onclick:function L(){var M=this.parent;if(M.inputBox._hasText){M.parent.clearSearch();}else{M.parent.triggerSearch();}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-sb-refresh",alias:"refreshBtn",visible:false,onclick:function L(){if(this.parent.parent._onRefresh){this.parent.parent._onRefresh();}},title:C,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var M=E.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",top:Math.max(M.y+40,0),left:Math.max(M.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});}}]}],title:"",tooltipOpenDelay:0,useRichTooltip:true,_preSearch:undefined,_onRefresh:undefined,searchDelay:-1,init:function K(N){this._super(N);var M=this.searchDelay;if(M===-1||isNaN(M)){this.searchDelay=parseInt(mstrApp.getSearchAutoCompleteDelay(),10);}},postBuildRendering:function A(){this._super();this.tableBox.inputBox.domNode.maxLength=248;this.tableBox.inputBox.value="";},clearSearch:function I(M){if(!this.hasRendered){return ;}this.tableBox.inputBox.set("value","");H.removeClass(this.tableBox.clearBtn.domNode,[D]);delete this.tableBox.inputBox._hasText;if(!M){this.triggerSearch();}},triggerSearch:function F(){var M=true;if(this._preSearch){M=this._preSearch();}if(M){this.raiseEvent({name:"searchTriggered",searchValue:mstrmojo.string.trim(this.tableBox.inputBox.value)});}},showTooltip:function J(R,Q){var P=this,N=E.findAncestorByAttr(E.eventTarget(Q,R),"tooltip",true,this.domNode),O=N&&N.value;if(!P.hasOpenTooltip&&O){var M=E.position(N.node);P.richTooltip={cssClass:"vi-regular vi-tooltip-A",content:O,top:Math.max(M.y+40,0),left:Math.max(M.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT};this._super(R,Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextBox");mstrmojo.requiresDescs(7564);var F,I=mstrmojo.string,J=mstrmojo.desc(7564,"Select...");mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector",postBuildRendering:function A(){if(this._super){this._super();}this.infobox.captionlbl.set("text",this.caption);},caption:"",text:"",infobox:undefined,captionlbl:undefined,ontextChange:function B(){this.infobox.txt.set("value",this.text);},isRequired:false,enabled:true,field:undefined,selectorOption:0,parentRBAlias:"",focus:function M(){this.infobox.txt.focus();},getValue:function D(){return this.text;},setValue:function C(N){this.set("text",N);this.set("value",N);},onenabledChange:function G(){this.infobox.captionlbl.set("enabled",this.enabled);this.infobox.txt.set("enabled",this.enabled);},isValid:function L(){var N=I.trim(this.getValue()),O={val:true,msg:""};if(!this.enabled){return O;}if(!this.isRequired&&N===""){return O;}if(this.isRequired&&N===""){O.val=false;O.msg=mstrmojo.desc(12937,"Value for '##' cannot be empty").replace("##",this.caption);return O;}return O;},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-InfoBox",alias:"infobox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Label",alias:"captionlbl"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Info",alias:"txt",onEnter:function E(){var N=this.parent.parent;if(N.onEnter){N.onEnter(N.parent.parent);}},onvalueChange:function H(N){this.parent.parent.setValue(N.value);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Select",alias:"fileSelector",text:J,bindings:{visible:function(){var O=this.parent.parent.selectorOption,N=!!(mstrApp.isSingleTier),P=(navigator.platform.indexOf("Win")!==-1),Q=!P;if(((O&1)===1)&&!N){return true;}if(((O&2)===2)&&N&&P){return true;}if(((O&4)===4)&&N&&Q){return true;}return false;}},onclick:function K(){F=this.parent;mstrApp.rootController.launchOneTierAccessFileBrowser("mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector.oneTierFileSelector");}}]}]});mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector.oneTierFileSelector=function(N){F.txt.set("value",N);};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.TextBox");var G=mstrmojo.desc(2970,"Lock"),H=mstrmojo.desc(527,"Value");mstrmojo.architect.ui.editors.LogicalSizeEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.editors.LogicalSizeEditor",inputText:undefined,unLockInactive:false,markupString:'<div class="mstrmojo-ar-lse"><span class="mstrmojo-ar-lse-lock" mstrAttach:keypress></span><span class="mstrmojo-ar-lse-size"></span></div>',markupSlots:{containerNode:function B(){return this.domNode;},lockNode:function F(){return this.domNode.firstChild;},inputNode:function I(){return this.domNode.lastChild;}},init:function L(M){this._super(M);if(this.isLocked||(this.unLockInactive&&this.logicalSize)){this.checkBox.set("checked",true);}else{this.checkBox.set("checked",false);}this.inputText.set("value",this.logicalSize);this.updateInputNode(this.checkBox.checked);},updateInputNode:function K(M){var N=this;if(N.unLockInactive){if(!M){N.inputText.set("value",0);}N.inputText.set("cssClass",(M?"active":"inactive"));N.inputText.set("readOnly",!M);}},getEditorData:function C(){var M=this.checkBox.checked;if(this.unLockInactive){if(M&&(this.inputText.value===0||this.inputText.value==="0")){this.isLocked=true;}else{this.isLocked=false;}}else{this.isLocked=M;}return{locked:this.isLocked,size:this.inputText.value};},onkeypress:function E(N){var M=N.hWin,P=N.e||M.event,O=P.keyCode;if(O===13){P.preventDefault();}},children:[{scriptClass:"mstrmojo.ImageCheckBox",cssClass:"mstrmojo-ar-lse",alias:"checkBox",slot:"lockNode",checked:false,oncheckedChange:function D(){this._super();this.parent.updateInputNode(this.checked);},label:G},{scriptClass:"mstrmojo.architect.ui.TextBoxWithLabel",label:H,alias:"inputText",slot:"inputNode",type:"number",size:"5",min:"0",isInt:true,onclick:function(){this.inputNode.select();},onkeyup:function A(N){var M=N.hWin,P=N.e||M.event,O=P.keyCode;if(O===110||O===190){this.set("value",this.value.slice(0,-1));}},onkeypress:function E(N){var M=N.hWin,P=N.e||M.event,O=P.keyCode;if(O===13&&this.isInt){this.parent.submitData();}},onvalueChange:function J(){var M=this.parent,N=M.parent;this.isInt=/^\d+$/.test(this.value);if(M.unLockInactive){if(N.buttonBox){N.buttonBox.okButton.set("enabled",this.isInt);}}else{if(N){N.popupConfig.set("okEnabled",this.isInt);}}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.css","mstrmojo.Button");var C=mstrmojo.css,A="on";mstrmojo.architect.ui.ToolbarButton=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.architect.ui.ToolbarButton",onactiveChange:function D(){C.toggleClass(this.domNode,A,this.active);},onclick:function B(){this.set("active",!this.active);var F=this.cmd;if(F){if(typeof F==="string"){mstrApp.getRootController()[F](this.active);}else{if(typeof F==="function"){F.call(this);}}}if(!this.persistSelection){var E=this;window.setTimeout(function(){E.set("active",false);},100);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.func","mstrmojo.array","mstrmojo.Button","mstrmojo.HBox","mstrmojo.dom","mstrmojo.Box");var D=mstrmojo.dom;mstrmojo.Dialog=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Dialog",title:"",buttons:null,alignment:"center",btnAlignment:"right",zIndex:10,modal:true,markupString:'<div id="{@id}" class="mstrmojo-Dialog {@cssClass}" style="z-index: 1100;" tabindex="0" mstrAttach:click><div class="win mstrmojo-Editor" style="{@cssText}"><div class="mstrmojo-Editor-titlebar"><div class="mstrmojo-Editor-title">{@title}</div></div><div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div><div class="mstrmojo-Editor-tip"></div></div>',markupSlots:{editorNode:function(){return this.domNode.firstChild;},curtainNode:function(){return this.domNode.childNodes[1];},titleNode:function(){return this.domNode.firstChild.firstChild;},containerNode:function(){return this.domNode.firstChild.childNodes[1];},buttonNode:function(){return this.domNode.firstChild.lastChild;},tipNode:function(){return this.domNode.lastChild;}},editorNode:null,btnHbox:null,markupMethods:{onzIndexChange:function(){this.editorNode.style.zIndex=this.zIndex;this.curtainNode.style.zIndex=this.zIndex-1;},onwidthChange:function(){this.editorNode.style.width=this.width||"auto";},onvisibleChange:function(L){if(L){return ;}var J=this.visible,K=J?"block":"none";this.editorNode.style.display=K;if(this.modal){this.curtainNode.style.display=K;}},onleftChange:function(){this.editorNode.style.left=this.left||"";},ontopChange:function(){this.editorNode.style.top=this.top||"";},ontitleChange:function(){this.titleNode.firstChild.innerHTML=this.title||"";}},preBuildRendering:function F(){var J;var K=this.buttons;if(K&&!this.btnHbox){for(J in K){K[J].cssClass=(K[J].cssClass||"")+(this.noButtonCls?"":" mstrmojo-Editor-button");}this.addChildren([{scriptClass:"mstrmojo.HBox",cssText:"float:"+this.btnAlignment,slot:"buttonNode",alias:"btnHbox",children:K},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-clearMe",slot:"buttonNode"}]);}if(this.modal){this.cssClass+=" modal";}return this._super();},buildRendering:function B(){var J=this.placeholder;if(this._super()){if(!this.parent&&!J){document.body.appendChild(this.domNode);}return true;}return false;},getResizeHandler:function E(){var J=this.id;return function(){var K=mstrmojo.all[J];K.resizeDialog();K.positionDialog();};},postBuildRendering:function A(){this._super();if(this.modal&&this.visible){this.curtainNode.style.display="block";}if(!this._resizeHandler){var K=this._resizeHandler=this.getResizeHandler();D.attachEvent(window,"resize",K);}this.resizeDialog();this.positionDialog();try{this.domNode.focus();}catch(J){}return true;},resizeDialog:function G(){if(this.modal){this.resizeCurtain();}},resizeCurtain:function C(){var K=this,O=K.curtainNode,J=document.body,M=document.documentElement,N=O.style,L=K.curtainPosition;N.width=Math.max(J.clientWidth,M.scrollWidth)+"px";if(L&&L.h){N.height=L.h+"px";}else{N.height=Math.max(J.clientHeight,M.scrollHeight)+"px";}if(L&&L.y){N.top=L.y+"px";}K.raiseEvent({name:"resizeCurtain"});},positionDialog:function H(){var K=this.editorNode,M=this.left,L=this.top;if(!M||!L){D.center(K);var J=K.style;if(this.alignment==="top"){J.top="10px";}if(M){J.left=M;}if(L){J.top=L;}}},destroy:function(K){var J=this._resizeHandler;if(J){D.detachEvent(window,"resize",J);}this._super(K);}});mstrmojo.toast=function I(O,M,Q,J){var P="mojoToast9",N,L=M||3000;if(J&&J.id){P=J.id+"-"+P;}try{mstrmojo.all[P].destroy();}catch(K){}mstrmojo.insert({id:P,scriptClass:"mstrmojo.Label",cssClass:(J&&J.cssClass)?J.cssClass:"toastCss",text:O}).render();N=mstrmojo.all[P].domNode;if(J&&J.dom){J.dom.appendChild(N);}else{document.body.appendChild(N);D.bottomCenter(N);}window.setTimeout(function(){if(Q){Q();}try{mstrmojo.all[P].destroy();}catch(R){}},L);};mstrmojo.mask={show:function(){var J=mstrmojo.mask.win=mstrmojo.insert({scriptClass:"mstrmojo.Box",cssClass:"fullscreen-mask"});J.render();document.body.appendChild(J.domNode);},hide:function(){mstrmojo.mask.win.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Container","mstrmojo.dom","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.warehouse._CanToggleAvatarClass");var U=mstrmojo.array,V=mstrmojo.css,H=mstrmojo.dom,J="px",P=mstrmojo.architect.EnumDataChangeEvents,O=mstrmojo.architect.EnumDragActions,W="mstrmojo-ar-trns-",G=mstrmojo.desc(12213,"Add an attribute by dragging it here"),B=mstrmojo.desc(518,"attribute"),D=mstrmojo.desc(7755,"table"),S=mstrmojo.desc(4449,"Expression");function C(Y){var X,Z=[B,D,S],a=this.gridbox.grid;a.columns=[];U.forEach(Z,function(h,c){var d="datarow label ",b="datarow ";switch(c){case 0:d+="tp12";b+="hidden";break;case 1:d+="tp15";b+="hidden";break;case 2:d+="exp";b+="delete";break;}X={headerWidget:{scriptClass:"mstrmojo.Label",cssClass:W+"dataRow-header",text:h},colWidth:20,dataWidget:{scriptClass:"mstrmojo.Box",cssClass:W+"datarow",dataField:c,dropZone:true,ondragenter:function g(i){this.parent.dataGrid.ondragenter(i);},ondragleave:function l(i){this.parent.dataGrid.ondragleave(i);},ondragover:mstrmojo.emptyFn(),allowDrop:function e(i){return this.parent.dataGrid.allowDrop(i);},ondrop:function f(i){this.parent.dataGrid.ondrop(i);},children:[{scriptClass:"mstrmojo.Label",cssClass:W+d,postCreate:function j(){var i=this.parent.data;this.set("text",i[this.parent.dataField].n);if(i[0].isDropZone){this.set("cssClass",W+"datarow label dropArea");V.toggleClass(this.parent.dataGrid.parent.domNode,"even",(this.parent.idx%2===0));}},onclick:function k(){var m=this.parent.data,i=this.parent.dataGrid.parent.parent;if(!m[0].isDropZone){mstrApp.rootController.selectTransformationElement(i.transformationId,m[0],m[1],m[2].n,0);}}},{scriptClass:"mstrmojo.Label",cssClass:W+b,postCreate:function j(){var i=this.parent.data;if(i[0].isDropZone){this.set("cssClass",W+"datarow delete hidden");}},onclick:function k(){var m=this.parent.data,i=this.parent.dataGrid.parent.parent;mstrApp.getRootController().removeTransformationElement(i.transformationId,m[0].id);m=this.parent.dataGrid.items[0];mstrApp.rootController.selectTransformationElement(i.transformationId,m[0],m[1],m[2].n,0);}}]}};a.columns.push(X);});a.items=Y;a.selectedIndex=-1;}function I(){return[{isDropZone:true},{n:G},{}];}function K(g){var c=g.items,a=mstrApp.rootController,Y,f=g.attributeID,b=0,Z=c.elements,i=this.gridbox.grid,d=[],e,h,X;this.transformationId=g.value.id;U.forEach(Z,function(k,j){h=a.getTable(k.tableID);X=a.getAttribute(k.attributeID);Y=[{n:(X&&X.name)||k.attributeName,id:k.attributeID},{n:(h&&h.name)||k.tableName,id:k.tableID},{n:k.expression}];a.populateTableContents(k.tableID,{});if(f===k.attributeID){b=j;}d.push(Y);});d.push(I());C.call(this,d);i.selectedIndex=Math.max(b,0);e=i.items[i.selectedIndex];mstrApp.rootController.selectTransformationElement(this.transformationId,e[0],e[1],e[2].n,0);}function Q(X){var Y=this.gridbox.grid;Y.items.pop();Y.items.push([{n:X.n,id:X.attributeId},{n:"",id:""},{n:""}]);Y.items.push(I());C.call(this,Y.items);Y.render();}mstrmojo.architect.ui.TransformationContainer=mstrmojo.declare(mstrmojo.Box,[mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.TransformationContainer",init:function R(Z){this._super(Z);var X=mstrApp.getRootController(),a={},Y=a[this.id]={};Y[P.TRANSFORMATION_UPDATED]=K;X.attachDataChangeListeners(a);},transformationId:undefined,onheightChange:function L(X){var Y=this.gridbox.grid,Z=parseInt(X.value,10)-2,b=((Y&&Y.headerContainerNode)?(Z-H.position(Y.headerContainerNode).h):0)+J,a=Z+J;this.gridbox.set("height",a);Y.set("height",a);if(Y.hasRendered){Y.scrollboxNode.style.height=b;Y.itemsContainerNode.style.height=b;Y.domNode.style.height=a;}},onwidthChange:function M(X){this.gridbox.set("width",X.value);},refresh:function E(){this._super();this.onheightChange({value:this.height});},children:[{scriptClass:"mstrmojo.Box",alias:"gridbox",cssClass:W+"gridbox",children:[{scriptClass:"mstrmojo.DataGrid",alias:"grid",cssClass:W+"dataGrid",columns:[],dropZone:true,minColWidth:180,ondragenter:function N(X){if(X.action!==O.LINKER_ATTR){return ;}mstrmojo.css.toggleClass(this.parent.domNode,"dropFeedback",true);mstrmojo.css.toggleClass(X.src.widget.avatar,"dropFeedback",true);},ondragleave:function A(X){if(X.action!==O.LINKER_ATTR){return ;}mstrmojo.css.toggleClass(this.parent.domNode,"dropFeedback",false);mstrmojo.css.toggleClass(X.src.widget.avatar,"dropFeedback",false);},ondragover:mstrmojo.emptyFn(),allowDrop:function F(X){if(X.action!==O.LINKER_ATTR){return false;}this.dropCueNode.style.display="none";return true;},ondrop:function T(a){if(a.action!==O.LINKER_ATTR){return ;}var b=a.src.data.attributeId,X=this.parent.parent,Z=X.transformationId,Y=a.src.data.n;Q.call(X,a.src.data);X.gridbox.grid.set("selectedIndex",(X.gridbox.grid.items.length-2));this.dropCueNode.style.display="none";mstrApp.getRootController().addTransformationElement(Z,b,"","",Y,"",0);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.warehouse.dbroles.DBRoleHelper");mstrmojo.requiresDescs(12937,12938);var G=mstrmojo.warehouse.dbroles.DBRoleHelper,F=mstrmojo.dom,K=mstrmojo.string;mstrmojo.warehouse.dbroles.DBRoleSetting=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",cssClass:"mstrmojo-wh-DBRoleSetting",postBuildRendering:function A(){if(this._super){this._super();}this.infobox.captionlbl.set("text",this.caption);var N=F.position(this.infobox.captionlbl.domNode).w,O=F.position(this.infobox.txt.domNode).w,P=F.position(this.infobox.domNode).w;if((N+O)>P){this.infobox.txt.domNode.style.width=(P-N-10)+"px";}},caption:"",text:"",infobox:undefined,captionlbl:undefined,ontextChange:function B(){this.infobox.txt.set("value",this.text);},isNumeric:false,isPassword:false,hiddenPwd:"",isRequired:false,enabled:true,field:undefined,parentRBAlias:"",focus:function M(){this.infobox.txt.focus();},getValue:function D(){return this.text;},setValue:function C(N){this.set("text",N);this.set("value",N);},onenabledChange:function H(){this.infobox.captionlbl.set("enabled",this.enabled);this.infobox.txt.set("enabled",this.enabled);},isValid:function L(){var N=K.trim(this.getValue()),O={val:true,msg:""};if(!this.enabled){return O;}if(!this.isRequired&&N===""){return O;}if(this.isRequired&&N===""){O.val=false;O.msg=mstrmojo.desc(12937,"Value for '##' cannot be empty").replace("##",this.caption);return O;}if(this.isNumeric&&!G.isNumeric(N)){O.val=false;O.msg=mstrmojo.desc(12938,"Only numeric values are allowed for '##'").replace("##",this.caption);return O;}return O;},children:[{scriptClass:"mstrmojo.Box",alias:"infobox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",alias:"captionlbl",text:"this.parent.caption"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-DBRoleSetting-Info",alias:"txt",preBuildRendering:function J(){var N=this.parent.parent;if(N.isPassword){this.set("type","password");this.set("autoComplete",(mstrApp.autocomplete==="1"));}},onEnter:function E(){var N=this.parent.parent;if(N.onEnter){N.onEnter(N.parent.parent);}},onvalueChange:function I(N){this.parent.parent.setValue(N.value);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.Splitter","mstrmojo.architect.ui._HasSplitterStoredLayout","mstrmojo.DynamicClassFactory");var E=mstrmojo.hash;mstrmojo.architect.ui.panels.ContentsPanel=mstrmojo.declare(mstrmojo.ui.Splitter,[mstrmojo.architect.ui._HasSplitterStoredLayout],{editorSplitter:undefined,alias:"ContentsPanel",cssClass:"contentsPanelSplitter",applyPercentage:true,getDefaultConf:function D(){return E.clone({firstSplit:{v:"100%",min:"500px"},secondSplit:{v:"200px",min:"150px"},resizeHandle:{v:"3px"}});},init:function C(H){var I=window.localStorage,F=(I&&I.getItem("initialSettings"))||null,G=JSON.parse(F);if(G&&G.splittersLayouts&&G.splittersLayouts.contentSplitter){this.config=G.splittersLayouts.contentSplitter;this.children[0].init();}else{this.config=this.getDefaultConf();}this._super(H);},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"editorSplitter",orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,alias:"editorSplitter",slot:"firstSplitNode",showBottomPanel:function B(F){this.toggleSecondItemVisibility(!F);},getDefaultConf:function D(){return E.clone({firstSplit:{v:"100%",min:"150px"},secondSplit:{v:"250px",min:"100px"},resizeHandle:{v:"3px"}});},init:function C(){var H=window.localStorage,F=(H&&H.getItem("initialSettings"))||null,G=JSON.parse(F);if(G&&G.splittersLayouts&&G.splittersLayouts.editorSplitter){this.config=G.splittersLayouts.editorSplitter;}else{this.config=this.getDefaultConf();}},getSplitterLayout:function A(I){var H=this.children,F=(H&&H.length)||0,G;for(G=0;G<F;G++){var J=H[G];if(J.getSplitterLayout){J.getSplitterLayout(I);}}I[this.alias]=this.config;return I;}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.TextBox");var A=mstrmojo.css,C=mstrmojo.dom;mstrmojo.TextArea=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextArea",markupString:'<textarea id="{@id}" class="mstrmojo-TextArea {@cssClass}"  style="{@cssText}" title="{@tooltip}" placeholder="{@placeholderText}" rows="{@rows}" cols="{@cols}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keydown,keyup,blur></textarea>',maxLength:256,onkeydown:function B(K){var I=this.inputNode,J=this.value,E=this.maxLength,F=(J&&J.length)||0,M=K.e,L=M.keyCode;this.isDeleteKeys=L===8||L===46;this.isArrowKeys=L===37||L===38||L===39||L===40;if(E!==undefined&&E<=F){var G=I.selectionEnd,H=(G!==undefined)?(G-I.selectionStart)>0:document.selection.createRange().text.length>0;if(!this.isDeleteKeys&&!this.isArrowKeys&&!H){if(C.isIE7||C.isIE8||C.isIE9){I.blur();window.setTimeout(function(){I.focus();},1);}C.preventDefault(window,M);return false;}}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.TextArea,{oncssClassChange:function D(){A.addClass(this.domNode,this.cssClass||"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.hash","mstrmojo.string");mstrmojo.requiresDescs(11038,11935,11936,11937,11856,11938,13138,13230,13260,14633,14636);var C=mstrmojo.hash.copy,P=mstrmojo.css,J=mstrmojo.dom,N=mstrmojo.array,E=mstrmojo.string,Q=function Q(V,T){if(!V){return ;}var S=T&&T.length||0,U;for(U=S;U>0;U--){V=V.replace(new Array(U+2).join("#"),T[U-1]);}return V;},L=function L(T){if(!T){return ;}var Z=this,V=J.position(T.refNode||Z.refNode),Y=J.position(Z.domNode),X=T.position||R.RIGHT,U=0,a=0,S=9+(T.margin!==undefined?T.margin:0),W=" ";switch(X){case R.TOP:a=-Y.h-S;W+="t";break;case R.BOTTOM:a=V.h+S;W+="b";break;case R.LEFT:U=-Y.w-S;W+="l";break;case R.RIGHT:U=V.w+S;W+="r";break;}mstrmojo.hash.forEach(C(T,{left:U,top:a,contentNodeCssClass:W,visible:false}),function(b,c){this[c]=b;},this);this.set("visible",T.invalid);},A=function A(S){var W=this,U,V=S.errorCode,X=S.errorMsg,T=S.args,Y=mstrmojo.vi.ui.rw.selectors.EnumWarningMessages;if(S.invalid){U={content:V!==null?(W.generateContentHTML(Q(Y[V],T))||Y["*"]):X};}return U;};mstrmojo.vi.ui.rw.selectors.EnumWarningMessages=C(mstrmojo.locales.validation,{"*":mstrmojo.desc(11038,"Invalid"),invalidValueVIWarning:mstrmojo.desc(11935,"Invalid characters"),emptyValueVIWarning:mstrmojo.desc(11936,"Please enter a number"),notIntegerVIWarning:mstrmojo.desc(11937,"Please enter an integer"),outOfRangeVIWarning:mstrmojo.desc(11856,"Please enter value between ## and ###."),noMultiSelectionVIWaring:mstrmojo.desc(11938,"This selector does not support multiple selections."),continuousSelectionVIWaring:mstrmojo.desc(13138,"This selector does not support non-continuous selections."),bigDecimalMetricSliderVIWaring:mstrmojo.desc(13230,"Cannot qualify on big decimal value. Please change qualification type to Rank"),unableDisplaySelectionVIWarning:mstrmojo.desc(13260,"Filter cannot display actual selections."),imageSizeExceedLimitVIWarning:mstrmojo.desc(14633,"Cannot embed an image larger than ##MB. Your image is still ###MB after compression. Enter a URL to the image instead."),imageFileTypeNotSupportedVIWarning:mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."),imageOverSizeNoCompessionVIWarning:mstrmojo.desc(14665,"Cannot embed an image larger than ##MB. Enter a URL to the image instead.")});mstrmojo.vi.ui.rw.selectors.EnumWarningPosition={TOP:1,BOTTOM:2,LEFT:3,RIGHT:4};var R=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition;mstrmojo.vi.ui.rw.selectors._HasWarningMessage=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._HasWarningMessage",{_mixinName:"mstrmojo.vi.ui.rw.selectors._HasWarningMessage",warningSlotName:"warning",showWarning:function G(U){var Y=this,a=Y.warningSlotName,c=Y[a],S=U&&U.lasting||6000,X=U.refNode||this.domNode,T=U.highlight!==false,b=U.closeOnClick===false?false:true,Z;if(!c){c=new mstrmojo.Tooltip({refNode:X,highlight:T,closeOnClick:b,updatePopupConfig:null,cssClass:"vi-warning vi-tooltip-V"});Y.addDisposable(c);Y[a]=c;Z=Y.closeOnClick=Y.getCloseOnClickListener();J.attachEvent(document.body,"click",Z);}var W=U.position||R.TOP,V="vi-warning vi-tooltip-";switch(W){case R.TOP:c.cssClass=V+"V";break;case R.BOTTOM:c.cssClass=V+"A";break;case R.LEFT:c.cssClass=V+"D";break;case R.RIGHT:c.cssClass=V+"C";break;}c.open(Y,A.call(Y,U));this.adjustPosition(U);if(T){P.toggleClass(c.refNode,"mstrmojo-Warning",true);}window.clearTimeout(Y._warningTimeOut);Y._warningTimeOut=window.setTimeout(function(){Y.hideWarning();},S);},hideWarning:function H(){var T=this,S=T[T.warningSlotName];if(S&&S.visible&&S.close){if(S.highlight){P.toggleClass(S.refNode,"mstrmojo-Warning",false);}S.close();window.clearTimeout(T._warningTimeOut);delete T._warningTimeOut;}},getCloseOnClickListener:function I(){var S=this;return function(){var T=S[S.warningSlotName];if(T.closeOnClick){S.hideWarning();}};},adjustPosition:function M(S){var T=this;L.call(T[T.warningSlotName],S);},generateContentHTML:function D(S){return E.encodeHtmlString(S,true);},bindWarningHandler:function F(){N.forEach(arguments,function S(U){if(!U||!U.attachEventListener){return ;}var V=U._validationEventListener,T;if(V){U.detachEventListener(V);delete U._validationEventListener;}T=this.getValidationEvtListener();if(T){U._validationEventListener=U.attachEventListener("validationChange",this.id,T);}},this);},getValidationEvtListener:function B(){var T=this;return function S(U){var V=U.value;T[(V&&V.invalid?"show":"hide")+"Warning"](V);};},unrender:function K(S){var T=this[this.warningSlotName];if(T){T.unrender();}this._super(S);},destroy:function O(S){J.detachEvent(document.body,"click",this.closeOnClick);return this._super(S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.tooltip");var E=mstrmojo.dom,D=mstrmojo.string,F=mstrmojo.hash,H=mstrmojo.array,C=mstrmojo.tooltip;mstrmojo.ui._HasListTooltip=mstrmojo.provide("mstrmojo.ui._HasListTooltip",{_mixinName:"mstrmojo.ui._HasListTooltip",tooltipOrientation:"horizontal",tooltipOffset:8,tooltipMarkup:'<div class="content" style="{@style}">{@c}</div>',tooltipCss:{},tooltipContrast:false,getTooltipText:function A(I){return I&&(I.ttp||I.n);},showTooltip:function G(W,M){var O=this;if(!O.hasOpenTooltip&&!(O._lastOpened&&O._lastOpened.visible)){var b=E.eventTarget(M,W),X=O.getItemFromTarget(b),R=O.getItemNodeFromTarget(b),d=O.getTooltipText(X),N=O.tooltipCss;if(!d){return ;}var c=E.position(R),V,P,L,T="",U=O.tooltipOffset;if(this.tooltipOrientation==="vertical"){V=c.x+c.w/2;L=C.POS_TOPCENTER;P=c.y+c.h+U;O.tooltipCss=F.copy({cssClass:"vi-regular vi-tooltip-A A-center"},N);}else{var K=E.windowDim(),S=40,Y=c.x+c.w+U,J=c.x-U,a=J-S,I=K.w-(Y+S),Z="vi-regular vi-tooltip-",Q;P=c.y;if(I>=a){V=Y;Q=I;L=C.POS_TOPLEFT;N.cssClass=Z+"C  "+N.rightCssClass;}else{V=J;Q=a;L=C.POS_TOPRIGHT;N.cssClass=Z+"D  "+N.leftCssClass;}T="max-width: "+Q+"px;";}if(O.tooltipContrast){N.cssClass=N.cssClass+" contrast";}if(N&&N.getItemCssClass){N.cssClass=H.filter([N.cssClass,N.getItemCssClass(X)],function(e){return !!e;}).join(" ");}O.richTooltip=F.copy(O.tooltipCss,{content:D.apply(O.tooltipMarkup,{c:d,style:T}),top:P,left:V,posType:L});O.richTooltip.keepArrowXPos=!!O.keepArrowXPos;O.richTooltip.keepArrowYPos=!!O.keepArrowYPos;this._super(W,M);}},onclick:function B(I){var J=this;window.setTimeout(function(){if(J.hasOpenTooltip){J.hideTooltip();}window.clearTimeout(J._tooltipTimeOut);},0);this._super(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.ui.BasePanel");mstrmojo.architect.ui.panels.ListPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.architect.ui.panels.ListPanel",contentWidget:undefined,getContentWidget:mstrmojo.emptyFn,init:function C(E){var D=this.getContentWidget();D.alias="contentWidget";this.children=[D];this._super(E);},onheightChange:function B(F){var G=this.contentWidget,E=G.domNode,D=(parseInt(F.value,10)||parseInt(G.parent.parent.domNode.style.height,10))-36;G.height=D+"px";if(E){E.style.height=D+"px";}},postBuildRendering:function A(){if(this._super){this._super();}this.onheightChange({value:this.height});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.DropDownButton","mstrmojo.Label","mstrmojo.WaitIcon");mstrmojo.IncFetch=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.IncFetch",markupString:'<div id="{@id}" class="mstrmojo-IncFetch {@cssClass}" style="{@cssText}"><div class="mstrmojo-IncFetch-content"></div><div class="mstrmojo-clearMe"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},preBuildRendering:function A(){var J=[],F=this.ds,M=this.cp,P=this.np,C=this.ps,E=this.id,G=2;var L=function(){mstrmojo.all[E].set("cp",this.text);};var H={f:1,p:Math.max(M-1,1),n:Math.min(M+1,P),l:P};for(var O in H){J.push(new mstrmojo.Button({iconClass:"arrow "+O,title:F[O],enabled:(H[O]!==M),text:H[O],onclick:L}));}var D=Math.max(Math.min(M-2,P-4),1),I=Math.min(D+4,P);for(var K=D;K<=I;K++){var N;if(K===M){if(I-D===4&&P!==5){N=new mstrmojo.DropDownButton({height:"13px",title:F.a?F.a:"",text:K,direction:"up",popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",contentNodeCssClass:"goto",autoCloses:false,locksHover:true,children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.Label",cssText:"float:left;",text:F.gt},{scriptClass:"mstrmojo.TextBox",cssText:"float:left;",size:3,maxLength:String(P).length,onEnter:function(){var R=this.inputNode.value,T=this.parent.parent;if(R===""){T.close();return ;}var Q=parseInt(R,10),S=!(isNaN(Q)||Q<1||Q>P);if(S){mstrmojo.all[E].set("cp",Q);T.close();}else{this.setInvalidState(F.v.replace("###",P).replace("##",1).replace(" #",""));}}},{scriptClass:"mstrmojo.Button",cssText:"float:left",iconClass:"apply",title:F.ap?F.ap:"",onclick:function(){this.parent.children[1].onEnter();}}]}],onOpen:function(){mstrmojo.css.addClass(this.parent.domNode,["open"]);var Q=this.children[0].children[1].inputNode;window.setTimeout(function(){Q.focus();},0);},onClose:function(){mstrmojo.css.removeClass(this.parent.domNode,["open"]);this.children[0].children[1].cleanUp();}}});}else{N=new mstrmojo.Button({iconClass:"pg on",text:K});}}else{N=new mstrmojo.Button({iconClass:"pg",text:K,onclick:L});}J.splice(G++,0,N);}J.splice(G++,0,new mstrmojo.Label({text:F.pgs.replace("###",P).replace("##",""),cssText:"float:left;margin:1px 1px 1px 3px;"}));this._iWait=new mstrmojo.WaitIcon({cssText:"margin-top:-2px;"});J.push(this._iWait);this.addChildren(J);return this._super?this._super():true;},_set_cp:function B(D,C){if(parseInt(C,10)!==this.cp){this.raiseEvent({name:"fetch",v:C,iWait:this._iWait});}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HBox","mstrmojo.CheckBox");mstrmojo.requiresDescs(1143);var E=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",cssClass:"mstrmojo-wh-DBRoleCheckBox",postBuildRendering:function A(){if(this._super){this._super();}this.checkbox.set("label",this.label);this.helpBtn.set("visible",!!(this.helpLink));},children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",oncheckedChange:function C(){if(this._super){this._super();}this.parent.checked=this.checked;this.parent.oncheckedChange();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-wh-DBRoleCheckBox-help",alias:"helpBtn",visible:false,title:mstrmojo.desc(1143,"help"),onclick:function I(){E.showHelp(this.parent.helpLink);}}],checkbox:undefined,helpBtn:undefined,onlabelChange:function G(){this.checkbox.set("label",this.label);},helpLink:undefined,enabled:true,onenabledChange:function F(){this.checkbox.set("enabled",this.enabled);},isNumeric:false,getValue:function D(){if(this.isNumeric){return(this.checkbox.checked?"1":"0");}return(this.checkbox.checked?"true":"false");},setValue:function B(J){this.checkbox.set("checked",((J==="true")||(J===true)||(J==="1")));},isValid:function H(){return{val:true,msg:""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.SuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var C=function(S,U,T){var R=S.parent.opener,J=R&&R.showDesc,Q=R&&R.showPath,I=U[S.itemField];var P=mstrmojo.string.escape4HTMLText,V="";if(Q){var M=U.anc&&U.anc.items,O=M&&M.length;if(O>0){for(var L=0;L<O-1;L++){V+=M[L].n+" > ";}V+=P(M[O-1].n);}else{if(U.path){V+=U.path;}}}if(!T){V+=(V.length===0?"":" > ")+P(I);}if(J){var N=U[S.itemDescField],K=120;if(N){V+="\r\n\r\n<br>"+P(N.substring(0,K)+(N.length>K?"...":""));}}return V;};var A=function(I,J,K){I.path=null;if(!J||!K||K.path){if(K&&K.path){I.set("path",K.path);}return ;}window.clearTimeout(this.pathTmr);this.pathTmr=window.setTimeout(function(){var L=J.path||J.getAttribute("path");if(L){I.set("path",K.path);return ;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(M){var N=H(M.toString())||"";K.path=N;I.set("path",N);}},{taskId:"getObjectDetails",objectID:K.did,objectType:K.t},undefined);},200);};var H=function(K){var N;if(window.DOMParser){N=(new DOMParser()).parseFromString(K,"text/xml");}else{N=new ActiveXObject("Microsoft.XMLDOM");N.async="false";N.loadXML(K);}var P=N.getElementsByTagName("path")[0],L=P.childNodes,O="";if(L){for(var J=0,I=L.length;J<I;J++){var M=L[J].childNodes&&L[J].childNodes[0];if(M){O+=mstrmojo.string.escape4HTMLText(M.nodeValue)+(J<I-1?"> ":"");}}}return O;};mstrmojo.LegacySuggestionList=mstrmojo.declare(mstrmojo.SuggestionList,null,{scriptClass:"mstrmojo.LegacySuggestionList",useRichTooltip:false,itemDescField:"desc",getItemMarkup:function(K,I){var J=this.parent.opener,L=this.useRichTooltip?"":this.buildTooltip(K);return'<div class="mstrmojo-suggest-text '+((J&&J.item2textCss(K))||"")+'" idx="'+I+'" title="'+L+'">'+J.getHighlightedText(J.getSearchPattern(),mstrmojo.string.escape4HTMLText(K[this.itemField]))+"</div>";},getItemProps:function E(){return{};},onmouseover:function(J){var M=this.parent.opener;if(M&&M.showPath){var K=mstrmojo.dom.eventTarget(J.hWin,J.e),I=K.getAttribute("idx"),L=I!=null?this.items[I]:null;if(L&&L.t>-1){this.targetEl=K;this.targetItem=L;this.requestPath(K,L);}}},requestPath:function D(I,K){var J=this.parent.opener;if(K.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function&&J.showFunctionSyntaxAsPath){this.buildFunctionSyntax(K);}else{A(this,I,K);}},buildFunctionSyntax:function G(J){var K=J.path;if(!K&&J.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){var I=function I(P){if(P.did<0){return P.n;}var O=P.pars,M=[],N,L;M.push(P.n);if(O){M.push("(");for(N=0,L=O.length;N<L;N++){M.push(O[N].n);if(N!==(L-1)){M.push(", ");}}M.push(")");}return M.join("");};J.path=I(J);}this.set("path",{path:J.path,excludeSelf:true});},buildTooltip:function B(I,J){return C(this,I,J);},onpathChange:function F(){var I=this.targetEl;I.path=1;var J=this.buildTooltip(this.targetItem,this.path.excludeSelf);if(this.useRichTooltip){this.useRichTooltip=true;this.hasOpenTooltip=false;if(!I.ttp){I.ttp=J;this.showTooltip();}}else{I.title=J;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller");mstrmojo.ui.ScrollableList=mstrmojo.declare(mstrmojo.ui.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableList",markupString:'<div id="{@id}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function C(){return this.domNode.firstChild.firstChild;},scrollboxNode:function D(){return this.domNode.firstChild;},scrollNode:function E(){return this.domNode.firstChild;}},postBuildRendering:function B(){if(this.renderOnScroll){if(!this.onScrollEnd){var G=this.id;this.onScrollEnd=function F(){var H=mstrmojo.all[G];H.doScroll();H.updateScrollbars();};}}if(this._super){this._super();}},renderBlockSize:150,renderIndex:0,onScrollEnd:undefined,doScroll:function A(){if(this.renderOnScroll){var G,H=this.scrollNode,F=(this.renderIndex+1)*this.renderBlockSize;if(F>=this.items.length){return ;}if(mstrmojo.dom.position(H).h===H.scrollHeight){G=this.domNode;}else{G=H;}if((mstrmojo.dom.position(G).h+G.scrollTop)>=G.scrollHeight){this.renderIndex++;var I=this._buildItemsMarkup(this.renderIndex*this.renderBlockSize,((this.renderIndex+1)*this.renderBlockSize)-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");G.innerHTML+=I;this.itemsContainerNode.innerHTML+=I;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.ui._HasListTooltip");mstrmojo.ui.PopupList=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo._IsPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.PopupList",autoCloses:true,locksHover:true,closeOnClick:true,parentDomNode:undefined,markupString:'<div id="{@id}" class="mstrmojo-PopupList {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu><div class="mstrmojo-popupList-scrollBar"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function D(){return this.domNode.firstChild.firstChild;},scrollboxNode:function F(){return this.domNode.firstChild;}},setupScrollNodes:function E(){this.scrollNode=this.scrollboxNode;},onOpen:function B(){this._super();this.updateScrollbars();},postBuildRendering:function C(){var H=this._super();if(!this.parent){var G=this.parentDomNode=this.parentDomNode||document.body;G.appendChild(this.domNode);}return H;},closePopup:function A(){this.set("visible",false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.LegacySuggestionList","mstrmojo.ui._HasScroller");var C=mstrmojo.dom;mstrmojo.ui.ScrollableSuggestionList=mstrmojo.declare(mstrmojo.LegacySuggestionList,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",markupString:'<div id="{@id}" class="mstrmojo-ListBase mstrmojo-scrollable-suggestlist {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function B(){return this.domNode.firstChild.firstChild;},scrollboxNode:function E(){return this.domNode.firstChild;},scrollNode:function H(){return this.domNode.firstChild;}},onclick:function A(I){var J=this.getItemFromTarget(I.getTarget());if(J){this._super(I);}},onitemsChange:function D(){var I=this;window.setTimeout(function(){I.hideTooltip();I.updateScrollbars();},0);},updateScrollbars:function F(){this._super();var K=this,M=K.scrollNode,I=M.clientWidth,L=K.itemsContainerNode,J=L.clientWidth;L.style.width="auto";window.setTimeout(function(){if(I>J){L.style.width=J+(I-J)+"px";}},10);},useRichTooltip:true,getItemTooltip:function(L,M){var J=C.position(M),K=M.ttp;var I={areaId:L._renderIdx+"text",cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:K,top:J.y,left:J.x+J.w+6,enableHover:false};return I;},showTooltip:function G(I,L){var K=this.targetEl,J=this.targetItem;if(K&&K.ttp){this.richTooltip=this.getItemTooltip(J,K);if(this.richTooltip){this._super(I,L);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.ui.menus._HasMenuPopup","mstrmojo._CanAutoClose","mstrmojo._IsPopup","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.ui.PopupConfig","mstrmojo.ui._HasScroller","mstrmojo.ui._HasUITheme","mstrmojo.dom","mstrmojo.css","mstrmojo.ui._HasListTooltip");var D=mstrmojo.dom,P=mstrmojo.css,I=mstrmojo.ui.PopupConfig.directionCfg;var Q={};var K=false;function F(V,W){if(V.pop){if(W&&V.ax){window.clearTimeout(this._popupAxTimeout);V.actionFn();this.closeAllMenus();}else{var T=V.fn.call(mstrmojo.all[V.scope],V.ctxt);var U=T.ENUM_CORNERS;T.setAlignment(U.TOP_RIGHT,U.TOP_LEFT);T.hostId=this.id;T.hostElement=this._getItemNode(V._renderIdx);this.openPopup(T.newInstance());}}else{if(V.dsbld!==true){if(V.fn(V,this)!==false){this.closeAllMenus();}}}}function G(T){var U=parseInt(T);return U===null||isNaN(U)?0:U;}mstrmojo.ui.menus.Menu=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup,mstrmojo._IsPopup,mstrmojo.ui.menus._IsMenuPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip,mstrmojo.ui._HasScroller,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.ui.menus.Menu",selectionPolicy:"reselect",locksHover:true,closeOnClick:true,themeClassName:"mojo-theme-dark",icnCss:"mstrmojo-ui-Menu-item-container",popupConfig:null,tooltipCss:{leftCssClass:"menuTooltip",rightCssClass:"menuTooltip"},setupScrollNodes:function(){if(this.popupConfig&&this.popupConfig.supportsScroll){this.scrollNode=this.itemsContainerNode;this.scrollbarHostNode=this.domNode;}},updateScrollbars:function(){this._super();if(this.popupConfig&&this.popupConfig.supportsScroll&&this.hasCustomScrollbar){var V=this.scrollNode;if(!V){return ;}var T=(getComputedStyle&&getComputedStyle(V,null))||V.currentStyle,U=V.offsetWidth-G(T.borderLeftWidth)-G(T.borderRightWidth)-V.clientWidth;V.style.marginRight=-U+"px";V.style.paddingRight=0;}},onscroll:function(){this.closePopup();this._super();},init:function L(V){this._super(V);var T=this.popupConfig;this.items=T.getMenuItems();var U=["mstrmojo-ui-Menu","unselectable"],W=T.menuCssClass;if(W){U.push(W);}P.addWidgetCssClass(this,U);if(T&&T.supportsScroll&&T.maxHeight>0){this.icnCssText=(this.icnCssText||"")+";max-height:"+T.maxHeight+"px";}this.useRichTooltip=!!T.useTooltip;this.tstid=T.tstid;},markupMethods:{onvisibleChange:function J(){var T=this.visible;if(!K||T){P.toggleClass(this.domNode,"visible",T);}}},getItemMarkup:function C(X,T){if(X.getItemMarkup){return X.getItemMarkup.apply(this,[X,T]);}var V=!!X.pop,W=V?"submenu":"item",U=Q[W];if(!U){U=this._super(X,T).replace("{@en@n}",'<div class="micn"></div>{@en@n}');if(V){U=U.replace("{@en@n}",'{@en@n}<div class="arw"></div>');}Q[W]=U;}if(X.tstid){U=U.replace("{@tag}","{@tag} "+mstrmojo.tstid(X)+" ");}return U;},getItemProps:function R(V,T){var U=this._super(V,T);U.tag="a";U.addCls("mstrmojo-ui-Menu-item");U.addCls(V.cls);return U;},adjustCornersForPopupOverflow:function O(){var V=this._super(),Z=this.domNode,Y,X,T,U,W;if(V){Y=D.position(Z);T=Y.y;X=Z.style;U=this.popupConfig;W=U.position||D.position(U.hostElement);if(T<0||(T+Y.h>D.position(document.body).h)){X.top=(-W.y+5)+"px";X.bottom="auto";}}return V;},onmouseover:function E(T){var Y=T.getTarget(),X=this.getItemFromTarget(Y),W=this,V=W._lastOpened,a=V&&this.getItemFromTarget(V.popupConfig.hostElement)._renderIdx,Z=this.getItemNodeFromTarget(Y),U=(a!==undefined&&D.contains(this._getItemNode(a),Y,true,this.domNode));if(X){this._lastHoverIx=X._renderIdx;window.clearTimeout(this._popupTimeOut);window.clearTimeout(this._popupAxTimeout);if(this._lastHoverIx!==a&&!U){this._popupTimeOut=window.setTimeout(function(){if(W._lastOpened&&W._lastOpened.visible){W.closePopup();}if(W.visible&&X.pop){if(X.ax){W._popupAxTimeout=window.setTimeout(function(){P.removeClass(Z,"hlt-ax");F.call(W,X);},0);}else{F.call(W,X);}}},400);if(X.pop&&X.ax){P.addClass(Z,"hlt-ax");}}}},onclick:function S(T){this._evtTarget=T.getTarget();this._super(T);T.cancel();},postselectionChange:function H(T){var U=T.added;if(U){var V=this.items[U[0]];F.call(this,V,!(V.ax&&this._evtTarget.className==="arw"));delete this._evtTarget;}},oncontextmenu:function M(T){D.preventDefault(window,T.e);return false;},postBuildRendering:function N(T){this._super(T);if(this.popupConfig.supportsScroll){var U=this;window.setTimeout(function(){U.updateScrollbars();},10);}},showTooltip:function B(X,W){var V=D.eventTarget(W,X),U=this.getItemNodeFromTarget(V),T=this.getItemFromTarget(V);if(U&&((T&&T.ttp)||(U.scrollWidth>U.clientWidth))){this._super(X,W);}},onClose:function A(T){if(this._super){this._super(T);}this.closePopup();}});}());(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo._CanValidate","mstrmojo.css","mstrmojo.validation","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");var H=mstrmojo.css,E=mstrmojo.validation,G=E.TRIGGER,J=E.STATUSCODE;function F(L){if((this.constraints.trigger&L)>0){this.validate();}}mstrmojo.ValidationTextBox=mstrmojo.declare(mstrmojo.TextBox,[mstrmojo._CanValidate,mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.ValidationTextBox",validationDelay:500,getInvalidMsg:function K(L){return(L&&L.msg?L.msg:"");},postBuildRendering:function A(){this._super();this._original_tooltip=this.inputNode.title;},prekeyup:function I(L){this._super(L);var P=(this.constraints.trigger&G.ONKEYUP)>0;if(P){var M=this.validationDelay;if(M){this.clearValDelayTimer();var O=this._validateHandler;if(!O){var N=this;this._validateHandler=O=function(){N.validate();if(N._valDelayTimer){window.clearTimeout(N._valDelayTimer);delete N._valDelayTimer;}};}this._valDelayTimer=window.setTimeout(O,M);}else{this.validate();}}},preinput:function D(L){this._super(L);F.call(this,G.ONKEYUP);},preblur:function B(L){this._super(L);F.call(this,G.ONBLUR);},clearValidation:function C(){this._super();var L=this.inputNode;H.removeClass(L,this.constraints.invalidCssClass||"mstrmojo-TextBox-ErrValidation");L.title=this._original_tooltip;},clearValDelayTimer:function(){var L=this._valDelayTimer;if(L){window.clearTimeout(L);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ValidationTextBox,{onvalidationStatusChange:function(){var P=this.validationStatus;if(!P){return ;}var N=this.inputNode,L=(P.code>J.VALID),M=this.constraints.invalidCssClass;H.toggleClass(N,M||"mstrmojo-TextBox-ErrValidation",L);var O=L?this.getInvalidMsg(P):this._original_tooltip;if(!this.useRichTooltip&&O!==undefined&&O!==null){N.setAttribute("title",O);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.fx","mstrmojo.Dialog","mstrmojo.Label","mstrmojo._IsPopup","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ui._HasUITheme","mstrmojo.Button","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.tooltip","mstrmojo.ui.editors.ErrorDialogContent");var h=mstrmojo.func.composite,M=mstrmojo.dom,Z=mstrmojo.Button.newWebButton,C=mstrmojo.css,Y=mstrmojo.all,N=mstrmojo.hash,W=mstrmojo.array;function V(n){if(!this.modal){return ;}var o=window.mstrApp;if(o&&o.modalEditorChange){o.modalEditorChange(this.id,n);}}mstrmojo.Editor=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsPopup,mstrmojo._HasPopup,mstrmojo._IsMovable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.Editor",title:"",help:"",autoClose:false,showTitle:true,openEffect:null,themeClassName:"mojo-theme-light",useRichTooltip:true,closeEffect:null,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mouseup,mousedown,click,contextmenu>{@titlebarHTML}<div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',titleMarkupString:'<div class="mstrmojo-Editor-title-container"><div class="mstrmojo-Editor-title"></div><div class="edt-title-btn mstrmojo-Editor-help" tooltip="'+mstrmojo.desc(1143,"help")+'"></div><div class="edt-title-btn mstrmojo-Editor-close" tooltip="'+mstrmojo.desc(2102,"Close")+'"></div></div><div class="mstrmojo-Editor-titleSpacer"></div>',markupSlots:{editorNode:function X(){return this.domNode.firstChild;},titlebarNode:function j(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},titleNode:function R(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},helpNode:function k(){return this.showTitle?this.domNode.firstChild.firstChild.children[1]:null;},closeNode:function E(){return this.showTitle?this.domNode.firstChild.firstChild.lastChild:null;},containerNode:function S(){return this.domNode.firstChild.childNodes[2];},buttonNode:function I(){return this.domNode.firstChild.childNodes[3];},curtainNode:function l(){return this.domNode.lastChild;}},markupMethods:{ontitleChange:function(){if(this.showTitle){this.titleNode.innerHTML=this.title;}},onzIndexChange:function(){var n=this.zIndex;this.editorNode.style.zIndex=n;this.curtainNode.style.zIndex=n-1;},onvisibleChange:function(q){if(q){return ;}var p=this.visible,o="closeEffect",n="none";if(p){o="openEffect";n="block";}if(this[o]){this.playEffect(o);}else{this.editorNode.style.display=n;if(this.modal){this.curtainNode.style.display=n;}}},onhelpChange:function d(){if(this.showTitle){var o=this.help,n=this.helpNode;if(!o){n.style.display="none";}else{n.style.display="block";}}},onleftChange:function F(){this.editorNode.style.left=this.left||"";},ontopChange:function H(){this.editorNode.style.top=this.top||"";}},open:function Q(o,n){this._super(o,n);V.call(this,true);},close:function f(n){this._super(n);V.call(this,false);},unrender:function B(n){this._super(n);V.call(this,false);},destroy:function g(n){this._super(n);V.call(this,false);},preBuildRendering:function A(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));this._curtain_to_body=true;V.call(this,true);}this.titlebarHTML=(this.showTitle)?this.titleMarkupString:"<div></div><div></div>";return this._super();},getMovingHandle:function i(){return this.titlebarNode;},getMovingTarget:function U(){return this.editorNode;},onPreClose:function G(){this.hideTooltip();return true;},premousedown:function P(n){var o=n.getTarget();if(o===this.closeNode||o===this.helpNode){C.toggleClass(o,"active",true);}},premouseup:function O(n){var o=n.getTarget();if(o===this.closeNode||o===this.helpNode){C.toggleClass(o,"active",false);}if(n.getTarget()===this.closeNode&&this.onPreClose()){this.close();}},onclick:function c(o){if(o.getTarget()===this.helpNode){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(this.help);}else{var n=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");window.open(n+(this.help||""),"_blank");return false;}}},_set_visible:function b(u,q){var p=(this[u]!==q);if(p){this[u]=q;var t=this._close_handler;if(q){if(this._curtain_to_body){this.resizeDialog();this.positionDialog();}if(this.autoClose){var r=this;t=this._close_handler=t||function(n){var v=M.eventTarget(self,n);if(v&&v.parentNode&&!M.contains(r.editorNode,v,true,document.body)){r.close();}};M.attachEvent(document.body,"mousedown",t);}}else{var o=this._curtain_handler;if(o){M.detachEvent(window,"resize",o);}if(t){M.detachEvent(document.body,"mousedown",t);}}}return p;},showTooltip:function m(u,r){var q=this,o=M.findAncestorByAttr(M.eventTarget(r,u),"tooltip",true,this.domNode),p=o&&o.value;if(!q.hasOpenTooltip&&p){var n=M.position(o.node);q.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:p,top:Math.max(n.y+40,0),left:Math.max(n.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER};this._super(u,r);}}});mstrmojo.Editor.openEffect_fadeIn={scriptClass:"mstrmojo.fx.AnimateProp",slot:"curtainNode",props:{backgroundColor:{start:255,stop:0,fn:function(n){n=Math.round(n);return["rgb(",n,",",n,",",n,")"].join("");}}},preStart:function(){var o=this.target,n=this.widget;n.editorNode.style.display="block";if(!n.modal){return false;}o.style.display="block";C.setOpacity(o,60);return true;}};mstrmojo.Editor.closeEffect_fadeOut={scriptClass:"mstrmojo.fx.FadeOut",slot:"curtainNode",start:0.6,stop:0,preStart:function(){var n=this.widget;n.editorNode.style.display="none";return !!n.modal;}};function D(n){return function(){Y[n].destroy();};}function J(o,w,x,y){var n=w.id||"mojoAlertx9",t,v=w.buttons;W.forEach(v,function(AA){var z=AA.onclick;AA.onclick=function(AB){var AC=Y[n];if(z&&z.call(AA,AB)===false){return ;}AC.destroy();AC=null;};});try{Y[n].destroy();}catch(u){}var p=w.cssClass,q=[];if(p){q.push(p);delete w.cssClass;}if(y){q.push(y);}q.push("mstrmojo-alert");t={scriptClass:"mstrmojo.Editor",id:n,width:"475px",zIndex:1000,title:x||mstrmojo.desc(11812,"Notification"),cssClass:q.join(" "),children:[{scriptClass:"mstrmojo.Label",cssClass:"alert-content",text:o,allowHTML:w.allowHTML}],visible:true};var r=new mstrmojo.Editor(N.copy(w,t));r.render();return r;}if(window.mstrConfig&&!window.mstrConfig.simpleDialog){mstrmojo.notify=function L(o,v,p){p=p||{};var w=p.forceClose,u=p.callback||mstrmojo.emptyFn,t=N.copy(v||{},{buttons:w?[mstrmojo.Button.newActionButton((p.buttonText||mstrmojo.desc(8607,"Dismiss")),u)]:null,showTitle:false,modal:false,top:"42px"}),q=p.duration||6000;var r=J(o,t,"",w?"ed-notify":"ed-toast"),n=r.id;if(!w){window.setTimeout(h([u,D(n)]),q);}else{window.setTimeout(function(){if(Y[n]){Y[n].editorNode.style.opacity=0.75;}},6000);}return r;};mstrmojo.confirm=function e(t,o,r){o=o||{};var n=o.confirmBtn||{},q=o.cancelBtn||{},p=[Z(n.t||mstrmojo.desc(219,"Yes"),n.fn,true),Z(q.t||mstrmojo.desc(218,"No"),q.fn)];return J(t,N.copy(r||{},{buttons:p,onPreClose:function(){if(q&&q.fn){q.fn();}return true;}}));};mstrmojo.warn=function K(p,n,o){o=o||{};o.cssClass=(o.cssClass||"")+" mstrmojo-warning";mstrmojo.confirm(p,n,o);};mstrmojo.alert=function a(t,p,r,u,n,q){var o={title:r,zIndex:u,cssClass:n,buttons:[Z(mstrmojo.desc(1442,"OK"),p,true)],onPreClose:function(){if(p){p();}return true;}};N.forEach(o,function(w,v){if(!w){delete o[v];}});return J(t,N.copy(q,o));};mstrmojo.error=function T(r,n,q){var o=r||{};var p=mstrmojo.desc(96,"Error");if(q){p=(q.title)?q.title:mstrmojo.desc(96,"Error");}J("",N.copy(q||{},{buttons:[Z(mstrmojo.desc(1442,"OK"),n,true)],children:[{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",shortDesc:o.shortDesc,longDesc:o.longDesc}]}),p);};}mstrmojo.Editor.ButtonConfigType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.SearchBox");mstrmojo.architect.ui.panels.UnitsPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.architect.ui.panels.UnitsPanel",contentWidget:undefined,searchBox:undefined,onPanelSearch:mstrmojo.emptyFn,getContentWidget:mstrmojo.emptyFn,init:function D(F){var E=this.getContentWidget();E.alias="contentWidget";this.children=[{scriptClass:"mstrmojo.warehouse.ui.SearchBox",alias:"searchBox"},E];this._super(F);this.searchBox.attachEventListener("searchTriggered",this.id,"onPanelSearch");},onheightChange:function C(G){var H=this.contentWidget,F=H.domNode,E=parseInt(G.value,10)-60;H.height=E+"px";if(F){F.style.height=E+"px";}},onwidthChange:function A(E){if(this.domNode){this.searchBox.set("width",E.value);}},postBuildRendering:function B(){if(this._super){this._super();}this.onheightChange({value:this.height});this.onwidthChange({value:this.width});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.MenuPopup");mstrmojo.ui.menus.PopupConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.PopupConfig",cssClass:"",contents:null,clear:function A(){this._super();this.contents=null;},close:function C(){([].concat(this.contents)[0]).parent.closeAllMenus();},newInstance:function B(){return new mstrmojo.ui.menus.MenuPopup({popupConfig:this});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.MenuPopup","mstrmojo.Button","mstrmojo.dom");mstrmojo.requiresDescs(1442,2140);var E=mstrmojo.dom,G=mstrmojo.array;function B(I,K){var H=2140,M="Cancel",L="this.parent.popupConfig."+(I?"ok":"cancel"),J=K&&K[(I?"ok":"cancel")+"BtnText"];if(I){H=1442;M="Ok";}return mstrmojo.Button.newWebButton(J||mstrmojo.desc(H,M),function(O){var P=this.parent,N=P.popupConfig;P.closeAllMenus();N["fn"+M](N.data,P);E.stopPropogation(O.hWin,O.e);},I,{slot:"btnNode",bindings:{enabled:L+"Enabled",visible:L+"Visible"},cssDisplay:"inline-block"});}mstrmojo.ui.menus.MenuEditor=mstrmojo.declare(mstrmojo.ui.menus.MenuPopup,null,{scriptClass:"mstrmojo.ui.menus.MenuEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-MenuEditor {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="me-content"></div><div class="me-buttons"></div><div class="me-bottom"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;},btnNode:function D(){return this.domNode.children[1];},bottomNode:function D(){return this.domNode.children[2];}},popupConfig:null,init:function F(J){this._super(J);var I=this.popupConfig,H=I.bottomNode;this.data=I.data||{};if(I.onOpen){this.onOpen=I.onOpen;}this.addChildren([B(true,I),B(false)]);if(H){H.slot="bottomNode";this.addChildren(H);}},onOpen:function C(){G.forEach(this.children,function(H){if(H.scriptClass==="mstrmojo.ui.ScrollableContainer"&&H.onOpen){H.onOpen();}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Arr","mstrmojo.Button","mstrmojo.HBox","mstrmojo.FishEye");var A=function(B){return mstrmojo.hash.copy(B,{scriptClass:"mstrmojo.Button",text:"",enabled:false,dir:"left",cssClass:"mstrmojo-icon left",onclick:function(){var D=this.parent.fishEyeList,C=D&&D.scroll(this.dir,D.step);}});};mstrmojo.FishEyeContainer=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.FishEyeContainer",cssClass:"mstrmojo-FishEyeContainer",selectedIndex:-1,setItems:function(B){this.fishEyeList.set("items",B);},setSelectedIndex:function(B){this.fishEyeList.set("selectedIndex",B);},scrollable:false,rightScrollbale:false,children:[A({bindings:{enabled:"!!this.parent.scrollable"}}),({scriptClass:"mstrmojo.FishEye",alias:"fishEyeList",items:mstrmojo.Arr.makeObservable([]),srcId:"obList"}),A({alias:"feScrollRight",cssClass:"mstrmojo-icon right",dir:"right",bindings:{enabled:"!!this.parent.rightScrollable"}})]});mstrmojo.css=mstrmojo.hash.copy({getStyleValue:function(D,E){var B=null;if(D.currentStyle){E=(E==="float"?"styleFloat":E);B=D.currentStyle[E];}if(document.defaultView&&document.defaultView.getComputedStyle){E=(E==="float"?"cssFloat":E);var C=document.defaultView.getComputedStyle(D,null);B=C?C[E]:null;}return B;},setStyleValue:function(D,F,E){var B=function(G){return !!(G&&(typeof G==="object")&&(typeof G.length==="number"));};if(B(F)&&B(E)){var C;for(C in F){D.style[F[C]]=E[C];}}else{D.style[F]=E;}}},mstrmojo.css);}());(function(){mstrmojo.requiresCls("mstrmojo.dnd","mstrmojo.ui._HasScroller");function Z(f){var h=document.createElement("div"),g=h.style,e=f.domNode;h.className="mstrmojo-DataGrid-avatar";g.height=e.clientHeight+"px";e.appendChild(h);f.avatar=h;return h;}function Q(e){var f=mstrmojo.dom.position(e.domNode,true);return f.x;}function O(e){return'<div class="mstrmojo-DataGrid-resizeHandle" unselectable="on" onselectstart="return false" rh="'+e+'"></div>';}function b(g){var f=g.getAttribute("rh"),e=f&&parseInt(f,10);return e;}function Y(f,i,e){var h=e.src,j=h&&h.data,g=j&&j.resizingIdx;if(!(g&&g>0)){return i&&i.apply(f,[e]);}}mstrmojo.RESIZE_NEXT_COLUMN_MODE={getRange:function G(h,g){var e=h.colSizeArray;var f=[-e[g-1]+h.minColWidth,(g==e.length-1)?e[g]-h.resizeHandleWidth-h.minColWidth:e[g]-h.minColWidth];return f;},updateSize:function F(h,g,f){var e=h.colSizeArray;e[g-1]=e[g-1]+f;e[g]=e[g]-f;},updateColumnWidth:function T(h,f,i,g){var e=h.colSizeArray;f[g-1].style.width=e[g-1]+"px";i[g-1].style.width=e[g-1]+"px";f[g].style.width=e[g]+"px";i[g].style.width=e[g]+"px";}};mstrmojo.RESIZE_ALL_COLUMN_MODE={getRange:function G(k,j){var l=k.minColWidth+k.resizeHandleWidth,e=k.colSizeArray,g=0;for(var h=j;h<e.length;++h){g+=e[h]-l;}var f=[-e[j-1]+l,g];return f;},updateSize:function F(h,m,f){var l=h.minColWidth+h.resizeHandleWidth,j=h.colSizeArray;j[m-1]=j[m-1]+f;var e=[];for(var g=0;g<j.length-m;++g){e[g]=m+g;}e.sort(function(i,o){return j[i]-j[o];});for(var g=0;g<e.length;++g){var n=f/(e.length-g);var k=j[e[g]];f-=(k>=n+l)?n:k-l;j[e[g]]=(k>=n+l)?k-n:l;}},updateColumnWidth:function T(j,f,k,h){var e=j.colSizeArray;for(var g=h-1;g<e.length;++g){f[g].style.width=e[g]+"px";k[g].style.width=e[g]+"px";}}};mstrmojo._CanResizeColumn=mstrmojo.provide("mstrmojo._CanResizeColumn",{draggable:true,dropZone:false,avatar:null,colSizeArray:null,resizableColumns:true,resizeHandleWidth:10,minColWidth:5,resizeColumnBehavior:mstrmojo.RESIZE_NEXT_COLUMN_MODE,createColSizeArray:function c(){var f,k,h,g,j,e;k=this.headerContainerNode;h=k&&k.getElementsByTagName("table")[0];g=h.rows[0].cells;f=[];for(j=0,e=g.length;j<e;j++){f.push(g[j].offsetWidth);}return f;},postBuildRendering:function V(){if(this._super){this._super();}if(this.avatar){this.domNode.appendChild(this.avatar);}this.colSizeArray=null;},getDragData:function E(e){var g=e.src,h=g.node,f=b(h);if(f&&f>0){return{resizingIdx:f,startingX:g.pos.x,baseX:Q(this)};}if(this._super){return this.dropZone&&this._super(e);}return null;},allowDrop:function K(e){var g=e.src,h=g&&g.data,f=h&&h.resizingIdx;if(f&&f>0){return true;}return this.dropZone;},ondragenter:function R(e){Y(this,this._super,e);},ondragover:function S(e){Y(this,this._super,e);},ondragleave:function B(e){Y(this,this._super,e);},ondrop:function W(e){Y(this,this._super,e);},isDragValid:function C(e){var g=e.src,h=g&&g.data,f=h&&h.resizingIdx;if(f&&f>0){return true;}if(this._super){return this._super(e);}return false;},ondragstart:function X(e){var h=e.src,i=h&&h.data,g=i&&i.resizingIdx;if(g&&g>0){var f=this.avatar||Z(this);this.ownAvatar=true;f.style.left=(i.startingX-i.baseX)+"px";f.style.display="block";document.body.style.cursor="col-resize";if(!this.colSizeArray){this.colSizeArray=this.createColSizeArray();this._firstTimeResize=true;}i.resizingRange=this.resizeColumnBehavior.getRange(this,g);return ;}if(this._super){this._super(e);}},ondragmove:function P(f){var m=f.src,g=m&&m.data,k=g&&g.resizingIdx;if(k&&k>0){var l=f.tgt,h=this.avatar,j=g.resizingRange,i=l.pos.x-g.startingX,e=Math.min(j[1],Math.max(i,j[0]));g.deltaX=e;if(h){h.style.left=(g.startingX-g.baseX+e)+"px";}}else{if(this._super){this._super(f);}}},ondragend:function L(j){var q=j.src,k=q&&q.data,o=k&&k.resizingIdx;if(o&&o>0){var e=this.titleColGroup,p=e&&e.childNodes,m=this.dataColGroup,n=m&&m.childNodes,h=p.length,l=this.colSizeArray,f=k.deltaX;this.resizeColumnBehavior.updateSize(this,o,f);if(this._firstTimeResize){var g;for(g=0;g<h;g++){p[g].style.width=l[g]+"px";n[g].style.width=l[g]+"px";}this._firstTimeResize=false;}else{this.resizeColumnBehavior.updateColumnWidth(this,p,n,o);}this.avatar.style.display="none";document.body.style.cursor="";this.ownAvatar=false;}else{if(this._super){this._super(j);}}}});mstrmojo.requiresCls("mstrmojo._CanResizeColumn","mstrmojo.ListMapperTable","mstrmojo.WidgetList");function J(g){var k=document.createElement("colgroup"),e=g.length,f,j;for(j=0;j<e;j++){var h=document.createElement("col");f=g[j];if(f.colWidth){h.style.width=f.colWidth+"px";}h.className=f.colCss||("col"+j);k.appendChild(h);}return k;}function I(f){var g=f._headerWidgets_,e=g&&g.length;if(e>0){var h;for(h=0;h<e;h++){g[h].destroy(true);}}}function A(i,e,h,k,f){var g=[],j=i.headerWidget;h=h?(" "+h):"";k=k||this._headerWidgets;f=f?(" "+f):' w="1"';g.push("<td"+h+">");if(e>0&&this.resizableColumns){g.push(O(e));}g.push('<div class="mstrmojo-DataGrid-headerText');g.push(i.headerCss?" "+i.headerCss:"");if(j){k.push(mstrmojo.hash.copy(j));g.push('"'+f+">");}else{g.push('">');}g.push(i.headerText||"&nbsp");g.push("</div>");g.push("</td>");return g.join("");}function a(e,m){var g,k,l,f,n,j,h=[];e=e||"_headerWidgets";m=m||"1";g=this[e];k=g.length;if(k>0){l=this.headerContainerNode.getElementsByTagName("div");f=mstrmojo.array.filter(l,function(i){return i.getAttribute("w")==m;});for(j=0;j<k;j++){g[j].placeholder=f[j].firstChild;g[j].dataGrid=this;n=mstrmojo.registry.ref(g[j]);n.render();h.push(n);}}this[e+"_"]=h;}mstrmojo.DataGrid=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._CanResizeColumn,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DataGrid",banding:true,resizableColumns:true,columns:null,items:null,listMapper:mstrmojo.WidgetListMapperTable,lockHeader:false,contentWidth:"",renderHook:{},markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild.firstChild;},dropCueNode:function(){return this.domNode.lastChild.lastChild;},headerContainerNode:function(){return this.domNode.firstChild;}},markupMethods:{oncontentWidthChange:function(){var f=this.contentWidth,g=this.headerContainerNode,e=this.itemsContainerNode;if(f&&g&&e){g.style.width=f;e.style.width=f;}},onlockHeaderChange:function(){mstrmojo.css.toggleClass(this.domNode,"lockHeader",this.lockHeader);},onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";}},setupScrollNodes:function M(){this.scrollNode=this.scrollboxNode;},itemFunction:function(g,e,f){var h=new mstrmojo.DataRow({columns:f.columns,data:g,idx:e,dataGrid:f,parent:f});return h;},preBuildRendering:function D(){var k=this.renderHook;if(k&&k.pre){k.pre.apply(this,[A]);}else{var f=this.columns,e=f.length,g=['<table class="mstrmojo-DataGrid-headerTable" cellspacing="0" cellpadding="0"><tr>'],j;this._headerWidgets=[];var h;for(h=0;h<e;h++){j=A.apply(this,[f[h],h]);g.push(j);}g.push("</tr></table>");this.headerHtml=g.join("");}if(this._super){this._super();}},postBuildRendering:function V(){if(this._super){this._super();}var g=this.renderHook;if(g&&g.post){g.post.apply(this,[J,a]);}else{a.apply(this);this.titleColGroup=J(this.columns);}var e=this.titleColGroup,l=e.cloneNode(true),i=this.headerContainerNode,k=i&&i.getElementsByTagName("table")[0],m=this.itemsContainerNode,j=this.scrollboxNode,h=this.domNode,f=m&&m.getElementsByTagName("table")[0];this.dataColGroup=l;if(k&&f){k.insertBefore(e,k.firstChild);f.insertBefore(l,f.firstChild);}if(this.lockHeader){j.style.height=h.offsetHeight-i.offsetHeight+"px";mstrmojo.dom.attachEvent(j,"scroll",function(n){i.style.left=-j.scrollLeft+"px";});}},refresh:function H(e){I(this);if(this._super){this._super(e);}},destroy:function d(e){I(this);this._super(e);},unrender:function U(j){var g=this._headerWidgets_,f=g&&g.length,e;if(f>0){var h;for(h=0;h<f;h++){e=g[h];if(e&&e.hasRendered){e.unrender(true);}}}this._super(j);}});mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Container");mstrmojo.DataRow=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DataRow",cssClass:"mstrmojo-DataRow",columns:null,markupMethods:{onselectedChange:function(){mstrmojo.css.toggleClass(this.domNode,"selected",this.selected);}},buildDom:function(){this.children=[];var k=document.createElement("tr"),o=this.data,r=this.idx,f=this.dataGrid,l=this.cssClass,u=this.columns,e=this.children,g,p=-1,t,q;k.setAttribute("id",this.id);if(f.banding){l+=(r%2==1)?" odd":" even";}k.className=l+(mstrmojo.string.isEmpty(o[f.itemDisplayField||"n"])?" empty-row":"")+(" "+o[f.itemCSSField||"itemCss"]||"");var j,n;for(j=0,n=u.length;j<n;j++){t=u[j];q=(t.dataWidgetBuilder&&t.dataWidgetBuilder(o))||t.dataWidget;g=document.createElement("td");if(t.applyStyle2Cell&&t.colCss){g.setAttribute("class",t.colCss);}k.appendChild(g);if(q){g.setAttribute("w","1");p++;e.push(mstrmojo.hash.copy(q,{slot:"slot"+p,data:o,idx:r,dataGrid:f}));}else{if(t.dataFunction){g.innerHTML=t.dataFunction(o,r,f);}else{var h=mstrmojo.string.htmlAngles(o[t.dataField||"n"])||"&nbsp",m=t.tooltip?' title="'+h+'"':"";g.innerHTML='<div class="mstrmojo-DataRow-text" '+m+">"+h+"</div>";}}}this.initChildren();k.mstrmojoId=this.id;return k;},buildRendering:function N(){this._super();var j=this.domNode.childNodes,e=j.length,h={},g=0,k,f;for(f=0;f<e;f++){k=j[f];if(k.getAttribute("w")=="1"){h["slot"+g]=k;g++;}}this.addSlots(h);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.ContextMenuItem","mstrmojo.WidgetList","mstrmojo.ListMapperTable");var H=false,B=20;function G(J,K){var L=J.itemsContainerNode;L.scrollTop=Math.min(Math.max(L.scrollTop+K,0),L.scrollHeight-L.offsetHeight);}function I(K,J){if(!K._scrollInter){var L=B*(J?-1:1);K._scrollInter=window.setInterval(function(){G(K,L);},50);}}function E(J){if(J._scrollInter){window.clearInterval(J._scrollInter);J._scrollInter=null;}}mstrmojo.ContextMenu=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.ContextMenu",zIndex:100,visible:true,makeObservable:true,markupString:'<div id={@id} class="mstrmojo-ContextMenu {@cssClass}" style="z-index: {@zIndex};{@cssText}"><div class="mstrmojo-CM-scrollup" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], true)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], true)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], true)" ></div><div class="mstrmojo-CM-itemsContainer">{@itemsHtml}</div><div class="mstrmojo-CM-scrolldown" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], false)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], false)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], false)" ></div></div>',markupSlots:{scrollupNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1];},scrolldownNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){var K=this.domNode,P=this.itemsContainerNode,N=this.scrollupNode,M=this.scrolldownNode;K.style.display=this.visible?"block":"none";if(this.visible){N.style.display="none";M.style.display="none";P.style.overflow="auto";P.style.height="auto";var J=mstrmojo.dom.windowDim().h,O=K.offsetHeight,L=K.offsetWidth;if(J<O){N.style.display="block";N.style.minWidth=L+"px";M.style.display="block";M.style.minWidth=L+"px";P.style.overflow="hidden";P.style.height=(J-42)+"px";}}},onleftChange:function(){this.domNode.style.left=(this.left!=null)?this.left:"";},ontopChange:function(){this.domNode.style.top=(this.top!=null)?this.top:"";}},listMapper:mstrmojo.WidgetListMapperTable,itemFunction:function C(N,J,L){if(!H){mstrmojo.requiresCls("mstrmojo.ContextMenuItem");H=true;}var K={data:N,parent:L,hasSubmenu:L._cmSource.hasSubmenu(N),dynamicUpdate:L.dynamicUpdate,_cmSource:L._cmSource,zIndex:L.zIndex,itemIdField:L.itemIdField,itemField:L.itemField,itemChildrenField:L.itemChildrenField,itemFunction:L.itemFunction},M=new mstrmojo.ContextMenuItem(K);return M;},onmousedownarrow:function A(L,K,J){I(this,J);},onclickarrow:function F(L,K,J){G(this,B*(J?-1:1));},onmouseuparrow:function D(L,K,J){E(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.dom","mstrmojo.TreeNodeSelector");var B=mstrmojo.dom,A={0:"closed",1:"opened",2:"leaf"};mstrmojo.TreeNode=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.TreeNode",markupString:'<li id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseover><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><ul class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</ul></li>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);},onstateChange:function(){this.stateNode.className="mstrmojo-TreeNode-state "+(A[this.state]||"closed");this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},onselectedChange:function(){var D=this.selected?"addClass":"removeClass";mstrmojo.css[D](this.domNode.firstChild,["selected"]);},ondropCuePosChange:mstrmojo.WidgetList.prototype.markupMethods.ondropCuePosChange},renderOnScroll:false,listSelector:mstrmojo.TreeNodeSelector,premousedown:function C(D){var E=this._super(D),F=B.eventTarget(D.hWin,D.e);if(F===this.stateNode){if(this.state!==2){this.set("state",this.state===1?0:1);}}return E;},preclick:function(D){mstrmojo.dom.stopPropogation(D.hWin,D.e);},prechange:function(D){var E=this._super(D);if(E!==false){var F=this.tree;if(F&&F.onnodechange){F.onnodechange(D);}}return E;}});}());(function(){var F=mstrmojo.string;function H(Q,R,K){var L,O,J,M=[],N,S;try{N=new RegExp(mstrmojo.string.regEscape(Q),"i");}catch(P){return M;}for(L=0,O=R.length;L<O;L++){J=R[L][K];N.lastIndex=0;if(N.test(J)){M.push(R[L]);}}return M;}function C(){if(this.searchEnabled){this.iconNode.style.display="none";this.inputBar.style.display="";if(this.autofocus){this.inputNode.focus();this.inputNode.select();}}else{this.hideInputNode();if(this.autofocus){if(mstrmojo.dom.isIE7||mstrmojo.dom.isIE8){var J=this;window.setTimeout(function(){try{J.iconNode.focus();}catch(K){}},100);}else{this.iconNode.focus();}}}}var G={8:"BackSpace",9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};mstrmojo.SearchableDropDownList=mstrmojo.declare(mstrmojo.Pulldown,null,{scriptClass:"mstrmojo.SearchableDropDownList",markupString:'<div id="{@id}" class="mstrmojo-SearchableDropDownList mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}"><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" tabindex="0" mstrAttach:mousedown,keyup>{@text}</div><table class="mstrmojo-InputNodeBar"><colgroup><col class="inputCol"/><col class="iconCol"/></colgroup><tr><td><input class="mstrmojo-SearchableDropDownList-inputNode" value="{@text}" placeholder="{@placeholderText}" mstrAttach:keyup,blur,click/></td><td><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" mstrAttach:mousedown></div></td></tr></table></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupSlots,{inputBar:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.firstChild.lastChild.rows[0].cells[0].firstChild;}}),markupMethods:mstrmojo.hash.copy({ontextChange:function(){this.iconNode.innerHTML=F.decodeHtmlString(this.text);this.inputNode.value=this.text;},onheightChange:function(){var J=parseInt(this.height,10);if(J>=0){this.domNode.style.height=J+"px";this.inputBar.style.height=J+"px";}}},mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupMethods)),popupToBody:true,searchEnabled:false,selectedIndex:-1,placeholderText:"",allItems:null,autofocus:true,focus:function(){C.call(this);},hideInputNode:function B(){this.inputBar.style.display="none";this.iconNode.style.display="block";},postBuildRendering:function A(){if(!this.allItems){this.allItems=this.items;}this._super();C.call(this);},clickInput2pop:false,onclick:function I(J){if(this.clickInput2pop){this.togglePopup();}},prekeyup:function E(R){var K=this.getSearchPattern(),P=[],M,Q=this.inputNode,O=R.e,J,L,N=this.items.length;if(G[O.keyCode]==="Enter"){if(this.items.length>0){this.set("selectedIndex",this.selectedIndex===-1?0:this.selectedIndex);}this.onEnter&&this.onEnter();this.closePopup();return ;}else{if(G[O.keyCode]==="Esc"){this.onEsc&&this.onEsc();if(this.popupRef.visible){this.popupRef.close();}return ;}else{if(G[O.keyCode]==="ArrowDown"){if(!this.popupRef.visible){this.togglePopup();}this.set("selectedIndex",(this.selectedIndex+1)%N);}else{if(G[O.keyCode]==="ArrowUp"){if(this.popupRef.visible&&N>0){this.set("selectedIndex",(this.selectedIndex+N-1)%N);}}else{if(this.searchEnabled){if(K&&K.length>0&&K.indexOf(this.lastSearchPattern)>-1){P=H(K,this.items,this.itemField);}else{P=H(K,this.allItems,this.itemField);}this.set("selectedIndex",-1);this.set("items",P);N=P.length;if(N===0){this.closePopup();}else{if(!this.popupRef.visible){this.togglePopup();}}if(K&&K.length>0){this.set("selectedIndex",mstrmojo.array.find(P,this.itemField,Q.value));}}}}}}this.lastSearchPattern=K;},getSearchPattern:function D(){return F.trim(this.inputNode.value);}});}());(function(){mstrmojo.requiresCls("mstrmojo.OBList","mstrmojo.ui._IsIncFetchList","mstrmojo.ui._HasScroller");var F=mstrmojo.array,A=mstrmojo.chart.model.enums.EnumDSSObjectType;function D(G){return{browseConfig:null,parent:G,next:function(J){var I=this.browseConfig;if(!I){return ;}I.blockBegin+=I.blockCount;var H={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockBegin:I.blockBegin,blockCount:I.blockCount,includeAncestorInfo:true};if(I.folderLinksContextId){H.folderLinksContextId=I.folderLinksContextId;}if(I.includeObjectDesc){H.includeObjectDesc=I.includeObjectDesc;}if(I.rootFolderID){H.rootFolderID=I.rootFolderID;}else{if(I.rootFolderType){H.rootFolderType=I.rootFolderType;}}if(I.browsableTypes){H.objectType=I.browsableTypes;}if(I.searchPattern){H.searchPattern=I.searchPattern;if(I.recursive){H.recursive=I.recursive;}}this.parent.set("waiting",true);if(I.dataProvider){I.dataProvider.serverRequest(H,J);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,J,H);}},hasNext:function(){var H=this.browseConfig;return(H.blockBegin+H.blockCount-1)<H.totalSize;}};}mstrmojo.mstr.ui.IncFetchOBList=mstrmojo.declare(mstrmojo.OBList,[mstrmojo.ui._IsIncFetchList,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.mstr.ui.IncFetchOBList",cssClass:"mstrmojo-OBList mstrmojo-IF-OBList",makeObservable:true,renderOnScroll:false,waiting:false,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keypress,mousedown,mouseup,dblclick><div class="scroll-box" style="{@scrollBoxCssText}"><div class="mstrmojo-ListBase2-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onwaitingChange:function(){this.onwaitingChange();}},init:function E(G){if(this._super){this._super(G);}this.ifDataHelper=D(this);if(G.browseConfig){this.ifDataHelper.browseConfig=G.browseConfig;}},onwaitingChange:mstrmojo.emptyFn,addItems:function B(G){var H=this.browseConfig.browsableViewMedias;if(G&&H){var I={};F.forEach(H.split(","),function(J){I[parseInt(J,10)]=true;});G=F.filter(G,function(J){return(J.t!==A.DssTypeDocumentDefinition)||I[J.dvm];});}this.add(G,-1);this.set("waiting",false);if(this._super){this._super(G);}if(this.scrollNode){this.updateScrollbars();}},setupScrollNodes:function C(){this.scrollNode=this.scrollboxNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.WidgetTreeBuilder","mstrmojo.TreeNodeSelector");var E=false;mstrmojo.WidgetTree=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.WidgetTree",listBuilder:mstrmojo.WidgetTreeBuilder,listSelector:mstrmojo.TreeNodeSelector,renderOnScroll:true,itemIdField:"dssid",itemDisplayField:"n",itemIconField:"tp",itemChildrenField:"items",itemFunction:function D(L,I,J){if(!E){mstrmojo.requiresCls("mstrmojo.TreeNode");E=true;}var H=J.tree||J,K=new mstrmojo.TreeNode({data:L,state:0,parent:J,tree:H,multiSelect:J.multiSelect,text:L[J.itemDisplayField],textCssClass:H.item2textCss(L),items:L[J.itemChildrenField],itemIdField:J.itemIdField,itemDisplayField:J.itemDisplayField,itemIconField:J.itemIconField,itemChildrenField:J.itemChildrenField,itemFunction:J.itemFunction,listSelector:J.listSelector});return K;},item2textCss:function B(H){return H[this.itemIconField];},selectionParentNode:null,init:function F(H){this._super(H);this.selectionParentNode=this;this.tree=this;},clearTreeSelect:function A(){(this.selectionParentNode||this).clearSelect();},prechange:function G(H){var I=this._super(H);this.onnodechange(H);return I;},onnodechange:function C(I){if(!I){return ;}var J=mstrmojo.hash,M=this.selectionParentNode,L=I.src;if(L===M){if(J.isEmpty(L.selectedIndices)){L=this;this.selectionParentNode=this;}this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:I.removed});}else{if(I.added&&I.added.length){var K=[];if(!J.isEmpty(M.selectedIndices)){K=mstrmojo.hash.keyarray(M.selectedIndices,true);M.clearSelect();}this.selectionParentNode=L;this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:K});}else{}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.HTMLButton","mstrmojo._HasContextMenu","mstrmojo.ContextMenu");mstrmojo.MenuButton=mstrmojo.declare(mstrmojo.Button,[mstrmojo._HasContextMenu],{preclick:function A(B){this.showContextMenu();},openPopupMenu:function(){this.showContextMenu();}});})();(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Box","mstrmojo.DataGrid");var F=mstrmojo.array,A=mstrmojo.desc(12257,"Sample data for table ##  -- (Displaying ** of !! rows)"),D=mstrmojo.desc(12258,"Sample data for table ##  -- (Displaying ** rows)");function E(H){if(H>=1000000000){return(H/1000000000).toFixed(1)+"G";}if(H>=1000000){return(H/1000000).toFixed(1)+"M";}if(H>=1000){return(H/1000).toFixed(1)+"K";}return H;}mstrmojo.architect.ui.editors.TablePreview=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser],{scriptClass:"mstrmojo.architect.ui.editors.TablePreview",cssClass:"mstrmojo-Architect-TablePreview",id:"TablePreview",help:null,zIndex:100,dbtn:"",cols:[],dbTableInfo:undefined,onOpen:function C(){var K=this;var J=K.gridbox.dataview,H,I=[];J.columns=[];F.forEach(K.cols,function(M,L){J.columns[L]={dataField:L+1,headerText:M.data[0].v};F.forEach(M.data,function(N,O){if(!I[O]){I[O]=[];}I[O][L+1]=N.v;});});I.shift();J.items=I;J.render();if(this.dbTableInfo.sz>=0){K.set("title",A.replace("##",this.dbtn).replace("**",I.length.toString()).replace("!!",E(this.dbTableInfo.sz)));}else{K.set("title",D.replace("##",this.dbtn).replace("**",I.length.toString()));}H=(J.columns.length*120)+"px";J.domNode.style.width=H;K.titleNode.style.width=K.editorNode.clientWidth-50+"px";K.titleNode.title=K.title;K.titleNode.innerHTML=K.title;},onClose:function B(){this.gridbox.dataview.unrender();},dataview:undefined,ondragmove:function G(N){var Q=this.getBrowserDimensions(),R=N.tgt.pos,P=N.src.pos,K=R.x-P.x,J=R.y-P.y,I=this._leftPos+K,O=this._topPos+J,M=this.getMovingTarget().style,H,L;if(Q){H=parseInt(Q.w,10)-this.editorNode.clientWidth;L=parseInt(Q.h,10)-this.editorNode.clientHeight;I=Math.min(I,H);O=Math.min(O,L);}if(I<0){I=0;}if(O<0){O=0;}M.left=this.left=I+"px";M.top=this.top=O+"px";},children:[{scriptClass:"mstrmojo.Box",alias:"gridbox",cssClass:"mstrmojo-Architect-TablePreviewGridBox",children:[{scriptClass:"mstrmojo.DataGrid",alias:"dataview",cssClass:"mstrmojo-Architect-TablePreviewGrid",itemDisplayField:20,minColWidth:50,columns:[]}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.Editor","mstrmojo.HTMLButton");var C=mstrmojo.array;mstrmojo.architect.ui.editors.LinksEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.LinksEditor",cssClass:"mstrmojo-Architect-LinksEditor",id:"LinksEditor",help:null,zIndex:100,init:function D(E){this._super(E);},onOpen:function A(){var H=this;H.set("title",this.obj.n);var G=H.dataview,E=[],F;G.columns=[];G.columns[0]={dataField:1,headerText:"Source"};G.columns[1]={dataField:2,headerText:"Expression"};C.forEach(H.data.expressions,function(I){C.forEach(I.sources,function(J){F=mstrApp.getRootController().getTable(J.did);var K=["",F.name,I.exp];E.push(K);});});G.set("items",E);G.render();},dataview:undefined,children:[{scriptClass:"mstrmojo.DataGrid",alias:"dataview",cssClass:"mstrmojo-Architect-LinksEditorGrid",itemDisplayField:20,minColWidth:50,columns:[]},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(2177,"Close"),onclick:function B(){var E=this.parent;if(E.onCancel){E.onCancel();}E.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.PopupConfig","mstrmojo.ui.menus.MenuEditor");mstrmojo.ui.menus.EditorConfig=mstrmojo.declare(mstrmojo.ui.menus.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.EditorConfig",data:null,fnOk:null,fnCancel:null,okEnabled:true,cancelEnabled:true,okVisible:true,cancelVisible:true,init:function D(E){this._super(E);if(this.data&&!mstrmojo.all[this.data.id]){mstrmojo.hash.make(this.data,mstrmojo.Obj);}this.initBindings();},clear:function A(){this._super();this.data=null;this.fnOk=this.fnCancel=mstrmojo.emptyFn;},newInstance:function C(){return new mstrmojo.ui.menus.MenuEditor({popupConfig:this});},destroy:function B(){if(this.data){this.data.destroy();}this.destroyBindings();this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.architect.ui.panels.UnitsPanel","mstrmojo.architect.ui.ElementList");var G=mstrmojo.array,D=mstrmojo.hash,E=mstrmojo.dom,J="Filters";mstrmojo.architect.ui.panels.ElementsPanel=mstrmojo.declare(mstrmojo.architect.ui.panels.UnitsPanel,null,{scriptClass:"mstrmojo.architect.ui.panels.ElementsPanel",title:J,cssClass:"elementsPanel",init:function I(K){this._super(K);var L=this.children[0];L.set("cssClass","mstrmojo-ar-elementsPanel-searchBox");},onPanelSearch:function F(L){var K=[],O=L.searchValue,N=this.contentWidget,P=N._oldItems=N._oldItems||N.items,M=O.toUpperCase();if(M.length>0){G.forEach(P,function(Q){if(Q.n.toUpperCase().indexOf(M)>-1){K.push(D.clone(Q));}});}else{K=P;}N.set("items",K);},getContentWidget:function B(){return{scriptClass:"mstrmojo.architect.ui.ElementList",cssText:"overflow-y: auto; max-height:223px;",onclick:function L(O){try{if(O.hWin){E.stopPropogation(O.hWin,O.e);}var R=O.target||E.eventTarget(O.hWin,O.e),Q=E.findAncestorByAttr(R,"idx",true,this.domNode),N=Q&&parseInt(Q.value,10);if(N!==null&&!isNaN(N)){if(!(E.ctrlKey(O.hWin,O.e)||E.isMetaKey(O.hWin,O.e))){this.singleSelect(N);}else{var M=(this.selectedIndices[N])?"remove":"add";this[M+"Select"](N);}}}catch(P){mstrApp.onerror(P);}},ondblclick:function K(M){var N=this.parent;this.onclick(M);if(N.alias==="AvailablePanel"){N.parent.buttonBox.Add.onclick();}else{N.parent.buttonBox.Remove.onclick();}}};},setElementsList:function H(L){var K=this.contentWidget;K.setElementsList(L);},selectedElementIndex:function A(){var K=this.contentWidget;return K.selectedIndex;},selectedElementItem:function C(){var K=this.contentWidget;return K.getSelectedItems();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.architect.ui.panels.UnitsPanel","mstrmojo.architect.ui.AttributesList");var B=mstrmojo.array,E=mstrmojo.hash,C=mstrmojo.desc(3581,"Attributes");mstrmojo.architect.ui.panels.AttributesPanel=mstrmojo.declare(mstrmojo.architect.ui.panels.UnitsPanel,null,{scriptClass:"mstrmojo.architect.ui.panels.AttributesPanel",title:C,cssClass:"attrPanel",onPanelSearch:function A(G){var F=[],J=G.searchValue,I=this.contentWidget,K=I._oldItems=I._oldItems||I.items,H=J.toUpperCase();if(H.length>0){B.forEach(K,function(L){if(L.n.toUpperCase().indexOf(H)>-1){F.push(E.clone(L));}});}else{F=K;}F=F.sort(function(M,L){return M.n.toLowerCase().localeCompare(L.n.toLowerCase());});I.set("items",F);},getContentWidget:function D(){return{scriptClass:"mstrmojo.architect.ui.AttributesList"};}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo._HasPopup","mstrmojo.ListBase","mstrmojo.Popup","mstrmojo.Editor","mstrmojo.SuggestionList");function D(Y){var X=this.list,V=X.selectedIndex,U=X.items.length,W=Y?U-1:0;if(V===W){X.clearSelect();return ;}if(V===null||V<0){V=Y?0:U-1;}else{V+=Y?1:-1;}X.singleSelect(V);}mstrmojo._HasSuggestion=mstrmojo.provide("mstrmojo._HasSuggestion",mstrmojo.hash.copy(mstrmojo._HasPopup,{blockBegin:1,blockCount:-1,suggestCount:15,autoSelect:true,itemField:"n",candidates:null,suggestionShown:false,suggestionItems:null,_last_hit:null,_request_pattern:null,browseItemVisible:false,folderLinksContextId:25,browsableTypes:"1,8",REQUEST_THRESHOLD:20,noCache:false,disableClick:false,getCandidatesThroughTaskCall:mstrmojo.emptyFn,onSuggestionItemSelect:function J(U){this.hideSuggestion();},getSearchPattern:function T(){return"";},getSuggestionPos:function N(){return{left:"100px",top:"100px"};},getSuggestionTarget:function G(){return this;},showSuggestion:function B(V){var U=this.getSuggestion(V);if(!this.noCache&&U!==-1){this.updateSuggestion(U);}},hideSuggestion:function C(){this.suggestionShown=false;if(this.suggestionPopup.visible){this.suggestionPopup.close();}},getSelected:function M(){return(this.suggestionShown)?this._lastOpened.getSelected():null;},nextHighlight:function E(){if(this.suggestionShown){this._lastOpened.nextHighlight();}},preHighlight:function H(){if(this.suggestionShown){this._lastOpened.preHighlight();}},getSuggestion:function S(h){var d=this.candidates,a=d&&d.items,X=d&&d.isComplete,g=this._last_hit;if(!this.noCache&&(d||g)){var f=this.filterCandidates(a,h,this.REQUEST_THRESHOLD),b=f.length,e=this.suggestCount,U=false;if(!X&&b<e){var V=g&&g.pattern;if(g&&V&&(h.indexOf(V)>-1)){U=true;var k=this.filterCandidates(g.items,h,this.REQUEST_THRESHOLD),Y=k&&k.length,W=mstrmojo.array,j=this.itemField,Z;for(Z=0;Z<Y;Z++){if(W.find(f,j,k[Z][j])===-1){f.push(k[Z]);}}b=f.length;}}if(!X&&((h.length>2&&b<this.REQUEST_THRESHOLD)||(b<e))){this.requestCandidates(h);return -1;}return(b<e)?f:f.slice(0,e);}this.requestCandidates(h);return -1;},requestCandidates:function A(U){this._request_pattern=U;var X=this,V=this.getSuggestionTarget(),W={success:function(e){if(!e){return ;}var d=X.getSuggestionTarget();if(!d||(V!==d)){return ;}var j=d.getSearchPattern(),a=e.items;X._last_hit={items:a,pattern:U};X.sz=e.sz;if(!X.noCache&&a){var f=(X.candidates&&X.candidates.items)||[],g=[].concat(a),b=a.length,Z;for(Z=0;Z<b;Z++){var Y=g[Z];if(mstrmojo.array.indexOf(f,Y)>-1){mstrmojo.array.removeItem(a,Y);}}if(X.candidates){X.candidates.items=f.concat(a);}}if(j&&j.indexOf(U)>-1){var h=X.filterCandidates(a,j);X.updateSuggestion(h);}},failure:function(Y){if(Y.getResponseHeader){mstrmojo.alert(Y.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};this.getCandidatesThroughTaskCall({pattern:U,blockBegin:this.blockBegin,blockCount:this.blockCount,isSuggest:true},W);},filterCandidates:function Q(X,W,U){U=U||this.suggestCount;W=mstrmojo.string.regEscape(W);var Y=this.itemField,V=mstrmojo.array.filter(X,function(Z){return(new RegExp("\\s"+W+"|^"+W,"i")).test(Z[Y]);},{max:U});return V;},getHighlightedText:function P(W,Z){if(!this.highlightPattern||mstrmojo.string.isEmpty(W)){return Z;}try{if(!this.nameWildcards||mstr.$A.find([2,32],parseInt(this.nameWildcards,10))>-1){Z=Z.replace(new RegExp("(^|\\s)("+W+")","gi"),"$1<b>$2</b>");}else{var Y=W.split(" "),V,U;for(V=0,U=Y.length;V<U;V++){if(Y[V]!==""){Z=Z.replace(new RegExp("("+Y[V]+")","gi"),"<b>$1</b>");}}}}catch(X){}return Z;},updateSuggestion:function O(X){var V=X&&X.length,U=this.browseItemVisible;if(V||U){if(U){X=X||[];X.push({n:"Browse...",t:-99,cssClass:(V?"br":"bro")});}this.set("suggestionItems",X);if(this.suggestionShown){var W=this._lastOpened;if(W&&W.nudge){W.nudge();}if(this.autoSelect&&W){W.list.singleSelect(0);}}else{this.openPopup("suggestionPopup",this.getSuggestionPos());this.suggestionShown=true;}}else{this.hideSuggestion();}},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",onClose:function(){var U=this.opener;if(U&&U.onBrowserClose){U.onBrowserClose();}},onOpen:function(){var U=this.opener;if(U&&U.onBrowserOpen){U.onBrowserOpen();}},children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},onBrowserClose:function L(){this.browserShown=false;},handleSuggestionItemSelect:function K(U,V){if(this.browseItemVisible&&U.t===-99){this.hideSuggestion();mstrmojo.requiresCls("mstrmojo.ObjectBrowser");var W=this.zIndex;this.openPopup("ob",{zIndex:(W&&(W+10))||110});this.ob.browser.browse(mstrmojo.hash.copy(V,{folderLinksContextId:this.folderLinksContextId,onSelectCB:[this,"onSuggestionItemSelect"],browsableTypes:this.browsableTypes}));this.browserShown=true;}else{this.onSuggestionItemSelect(U);}},highlightPattern:true,suggestionPopupCssClss:"",suggestionPopup:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-ObjectInputBox-suggest",autoClose:true,locksHover:true,nextHighlight:function(){D.call(this,true);},preHighlight:function(){D.call(this,false);},getSelected:function M(){var U=this.list;return U.items[U.selectedIndex];},onOpen:function I(){var U=this.opener;if(U){mstrmojo.css.addClass(this.domNode,U.suggestionPopupCssClss||"");if(U.autoSelect){this.list.singleSelect(0);}if(U.nudge){U.nudge(this);}}},onClose:function F(){this.list.clearSelect();var U=this.opener;if(U){U.suggestionShown=false;mstrmojo.css.removeClass(this.domNode,U.suggestionPopupCssClss||"");}}},suggestionListClass:"mstrmojo.SuggestionList",postApplyProperties:function R(){this.suggestionPopup.children=[{scriptClass:this.suggestionListClass,alias:"list",cssClass:"mstrmojo-suggest-list"}];}}));}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.warehouse.EnumObjectTypes");var K=mstrmojo.warehouse.EnumObjectTypes,H=mstrmojo.desc(12218,"Rename Object"),C=mstrmojo.desc(11457,"Please enter name:"),G=mstrmojo.desc(11440,"(lookup)"),D=mstrmojo.desc(518,"Attribute"),I=mstrmojo.desc(1821,"db conn"),J=mstrmojo.desc(11458,"Fact"),B=mstrmojo.desc(7755,"Table");function E(){var M=mstrmojo.string.trim(this.txtbox.value);if(!this.isNew){if(M===this.originalName){if(this.onCancel){this.onCancel();}this.close();return ;}}if(mstrApp.getRootController().validateName(this.tp||this.data.tp,M,((this.isNew?undefined:this.originalName)))){this.onOK(M);this.close();}}mstrmojo.architect.ui.editors.NameEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.NameEditor",cssClass:"mstrmojo-ar-ne",isNew:false,originalName:"",tp:undefined,txtbox:undefined,error:undefined,onOpen:function F(){var O=this.data,N=O.n||O.name,M=this.txtbox,P=M.domNode;N=(N.indexOf(G,0)>0)?N.substr(0,N.indexOf(G)):N;this.originalName=N;M.set("value",N);P.focus();P.select();switch(O.tp){case K.ATTRIBUTE:this.set("title",D+" - "+O.n);break;case K.FACT:this.set("title",J+" - "+O.n);break;case K.TABLE:this.set("title",B+" - "+O.n);this.warningBox.set("visible",true);break;case K.DBROLE:this.set("title",I);break;default:this.set("title",H);break;}},children:[{scriptClass:"mstrmojo.Label",text:C},{scriptClass:"mstrmojo.TextBox",alias:"txtbox",onkeyup:function A(M){switch(M.e.keyCode){case 13:E.call(this.parent);break;case 27:this.parent.close();break;default:break;}}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Warning-Box",alias:"warningBox",visible:false,children:[{scriptClass:"mstrmojo.Box",cssClass:"icon"},{scriptClass:"mstrmojo.Label",text:"This operation requries a schema update and can take a while",cssClass:"message"}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button rightfloat mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function L(){E.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function L(){var M=this.parent.parent;if(M.onCancel){M.onCancel();}M.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Editor","mstrmojo.Box","mstrmojo.CheckBox","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(4531,8262,12437,12438,12439);var D=mstrmojo.hash;var E={Automatic:0,Manual:3};var I={Automatic:-1,False:0,True:1};var H={Automatic:-1,False:1,True:2};var F={mps:{afb:I.False,sfb:H.False,fbf:E.Automatic}};var B=["mps"],K=function(P,N){var O=this.parent.parent,L=O.cloneModel,M=L.mps||{};if(M[P]!==N){M[P]=N;O.set("dirty",true);}};mstrmojo.ME.DerivedMetricOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ME.DerivedMetricOptions",cssClass:"mstrmojo-DerivedMetricOptions",dirty:false,init:function J(L){this._super(L);mstrmojo.css.addWidgetCssClass(this,"dme");},updateModel:function C(){var M=this.model,L=this.cloneModel,N=L.mps;if(N.fbf===E.Automatic){N.afb=I.Automatic;N.sfb=H.Automatic;}N.dirty=true;M.mps=L.mps;},onOpen:function A(){var N=this.cloneModel||{};D.make(N,mstrmojo.Obj);var M=mstrmojo.hash.copy(this.model,mstrmojo.hash.copy(F)),O,L;for(O=0,L=B.length;O<L;O++){N.set(B[O],D.clone(M[B[O]]));}this.cloneModel=null;this.set("cloneModel",N);},onClose:function G(){this.set("dirty",false);delete this.cloneModel;},children:[{scriptClass:"mstrmojo.HBox",alias:"fbFlagBox",cssClass:"mstrmojo-DerivedMetricOptions-aggBox",children:[{scriptClass:"mstrmojo.Label",cssText:"white-space: nowrap; margin-right: 8px; vertical-align: top;",text:mstrmojo.desc(12437,"Aggregation And Subtotal Behavior:")},{scriptClass:"mstrmojo.Pulldown",alias:"fbFlag",cssText:"min-width: 100px;",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"v",items:[{n:mstrmojo.desc(4531,"Automatic"),v:E.Automatic},{n:mstrmojo.desc(8262,"Manual"),v:E.Manual}],bindings:{value:function(){return this.parent.parent.cloneModel.mps.fbf||E.Automatic;}},onvalueChange:function(L){if(L.value!==undefined&&L.valueWas!==undefined){K.call(this,"fbf",L.value);}}}]},{scriptClass:"mstrmojo.Box",cssText:"height: 30px",cssClass:"mstrmojo-DerivedMetricOptions-afbBox",children:[{scriptClass:"mstrmojo.CheckBox",alias:"afb",cssDisplay:"inline-block",label:mstrmojo.desc(12438,"Aggregate From Base"),bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.afb===I.True;}},onclick:function(L){var M=this.parent.parent.fbFlagBox.fbFlag.value;K.call(this,"afb",M===E.Automatic?I.Automatic:(this.checked?I.True:I.False));}},{scriptClass:"mstrmojo.CheckBox",alias:"sfb",cssDisplay:"inline-block",label:mstrmojo.desc(12439,"Subtotals From Base"),oncheckedChange:function(L){var M=this.parent.afb;if(L.value){M.checked=I.True;M.onclick();if(M.inputNode){M.inputNode.checked=true;M.inputNode.disabled=true;}}else{if(M.inputNode){M.inputNode.disabled=false;}}},bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.sfb===H.True;}},onclick:function(){var L=this.parent.parent.fbFlagBox.fbFlag.value;K.call(this,"sfb",L===E.Automatic?H.Automatic:(this.checked?H.True:H.False));}}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:mstrmojo.desc(2397,"OK"),bindings:{enabled:function(){return this.parent.parent.dirty;}},onclick:function(){var L=this.parent.parent;L.updateModel();if(L.onOK){L.onOK();}L.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){var L=this.parent.parent;L.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Box","mstrmojo.Label","mstrmojo.expr","mstrmojo.ValidationTextBox","mstrmojo.Dialog","mstrmojo.cookies");mstrmojo.requiresDescs(17,18,221,9772,11773,14028,14136,14137,14138,14139,14140,14149,14522,14523,14524,14525,14526,14527);var CSS=mstrmojo.css,DOM=mstrmojo.dom,HASH=mstrmojo.hash;var _VAL=mstrmojo.validation,_SC=_VAL.STATUSCODE,_TR=_VAL.TRIGGER,_VALIDATOR=_VAL.VALIDATOR,DTP=mstrmojo.expr.DTP;var usherProps={intervalCtr:0,qrLoaded:false,maxPollingAttempts:80,timeDelay:3000};var DEFAULT_BADGE={mini_badge:"#ddd",mini_badge_icon:"https://uvs-v2.usher.com/assets/images/img_badge_placeholder.png",t_color:"#797979",appName:"",name:""};var userInfo={firstName:"",badgeId:""};var notificationTimer={duration:undefined,elem:undefined,callback:undefined,timerInterval:null,init:function(duration,elem,callback){this.duration=duration;this.elem=elem;this.callback=callback;},startTimer:function(){this.stopTimer();var start=Date.now(),diff,minutes,seconds;var me=this;function timer(){diff=me.duration-(((Date.now()-start)/1000)|0);minutes=(diff/60)|0;seconds=(diff%60)|0;minutes=minutes<10?"0"+minutes:minutes;seconds=seconds<10?"0"+seconds:seconds;me.elem.set("text",minutes+":"+seconds);if(diff<=0){start=Date.now()+1000;me.callback();me.stopTimer();}}timer();this.timerInterval=setInterval(timer,1000);},stopTimer:function(){if(this.timerInterval){clearInterval(this.timerInterval);}}};function addExtraParams(params){params.sn=this.serverName||mstrConfig.serverName;params.sp=this.serverPort||mstrConfig.serverPort;params.connectionId=this.connectionId||"";return params;}function disableQRCode(){this.set("expired",true);this.usherProps.qrLoaded=false;}function checkForUsherScan(){try{var widgetUsherProps=this.usherProps;var me=this;if(widgetUsherProps.qrLoaded){if(widgetUsherProps.intervalCtr>widgetUsherProps.maxPollingAttempts){disableQRCode.call(me);}else{clearTimeout(this.pullTimeout);this.pullTimeout=setTimeout(function(){widgetUsherProps.intervalCtr+=1;if(!me.stopPolling){usherPollForScan.call(me);}},widgetUsherProps.timeDelay);}}}catch(e){}}function serverRequest(params,callbacks,config){if(mstrApp.serverRequest){mstrApp.serverRequest(params,callbacks,config);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,callbacks,params);}}function usherPollForScan(){var me=this,widgetUsherProps=this.usherProps,params={taskId:"usherLoginWeb",pollOnly:"true",server:this.serverName||mstrConfig.serverName,port:this.serverPort||mstrConfig.serverPort,project:this.projectName||mstrConfig.projectName,connectionId:this.connectionId},callbacks={success:function(res){try{if(res.status=="invalid"){checkForUsherScan.call(me);}else{if(res.status=="success"){function doUsherLogin(res){me.onUsherLogin(res);widgetUsherProps.qrLoaded=false;}if(me.rememberMe===true){var callbacks={success:function(res){doUsherLogin(res);},failure:function(res){me.onUsherError(res);}};var params={taskId:"usherRememberMe"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(params,callbacks,{doNotHold:true});}else{doUsherLogin(res);}}}}catch(e){mstrmojo.alert("usherPollForScan:\n "+e.messsage);}},failure:function(res){disableQRCode.call(me);me.onUsherError(res);}};serverRequest(params,callbacks,{doNotHold:true});}function updateUserDetails(msg){this.userDetails.set("text",msg||"");}function toggleLoginNotification(show){var me=this;me.loginButton.set("visible",show);me.loginNotificationBox.set("visible",!show);}function submitLogin(){var widgetUsherProps=this.usherProps;var notificationTimer=this.notificationTimer;var me=this,callbacks={success:function(res){try{if(res.status==1){function callback(){toggleLoginNotification.call(me,true);}function submitForPolling(){if(me.pullTimeout){clearTimeout(me.pullTimeout);}me.usherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;checkForUsherScan.call(me);}var fiveMinutes=60*5;notificationTimer.init(fiveMinutes,me.loginNotificationBox.timer,callback);notificationTimer.startTimer();toggleLoginNotification.call(me,false);submitForPolling();}else{me.onUsherError(res);}}catch(e){mstrmojo.alert("Error:\n"+e.message);}},failure:function(res){me.onUsherError(res);}},params={taskId:"usherNotifyMe"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function forgetMe(){var me=this,callbacks={success:function(res){try{me.set("notificationMode",false);me.reloadQR();}catch(e){mstrmojo.alert("Error:\n"+e.messsage);}},failure:function(res){me.onUsherError(res);}},params={taskId:"usherRememberMe",rememberMe:false};if(me.userInfo.badgeId!==""){params.badgeId=me.userInfo.badgeId;}params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function getQRCode(ignoreNotificationMode){if(this.notificationMode==true&&!ignoreNotificationMode){return ;}var widgetUsherProps=this.usherProps;this.showQRLoading(true);var me=this,callbacks={success:function(res){try{if(res.img){me.set("notificationMode",false);me.updateQRCode(res.img);me.set("badge",res.badgeInfo&&res.badgeInfo[0]);widgetUsherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;this.stopPolling=false;checkForUsherScan.call(me);}else{var data=JSON.parse(res.data);var pn=data.pnEnabled||data.isPNEnabled;me.set("isPnEnabled",pn);if(data.code||data.proximityBasedLogin){me.set("notificationMode",false);if(data.proximityBasedLogin&&!ignoreNotificationMode){me.updateQRCodeProximity();me.set("proximityMode",true);}else{me.updateQRCode(data.code);me.set("proximityMode",false);}me.set("badge",res.badgeInfo&&res.badgeInfo[0]);widgetUsherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;this.stopPolling=false;mstrmojo.cookies.updateCookieSetting("usher_sso_device",res.device_id);checkForUsherScan.call(me);}else{me.set("proximityMode",false);me.set("notificationMode",true);me.refresh.set("visible",false);if(me.userInfoNode){me.userInfoNode.src="data:image/png;base64,"+data.photoData;}me.userInfo.firstName=data.firstName;me.userInfo.badgeId=data.badgeId;toggleLoginNotification.call(me,true);me.set("badge",res.badgeInfo&&res.badgeInfo[0]);}}}catch(e){mstrmojo.alert("getQRCode:\n "+e.messsage);}},failure:function(res){me.handleQRCodeError(res);disableQRCode.call(me);me.onUsherError(res);},complete:function(){me.showQRLoading(false);}},params={taskId:"usherQRWeb"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function registerHandler(){var me=this,regBtn=this.registerButton,dotsNode=this.parent.badgeNode.childNodes[1];if(regBtn.enabled){regBtn.set("enabled",false);CSS.addClass(dotsNode,["anim"]);var regMsg={},callbacks={success:function(res){var successful=res&&res.name==me.user.value;regMsg={msg:successful?mstrmojo.desc(14139,"You've successfully registered. Please check your email to continue.")+" "+mstrmojo.desc(14177,"Or perform an Usher badge recovery."):res.getResponseHeader("X-MSTR-TaskFailureMsg"),successful:successful};},failure:function(res){regMsg={msg:res.getResponseHeader("X-MSTR-TaskFailureMsg"),successful:false};},complete:function(){regBtn.set("enabled",true);CSS.removeClass(dotsNode,["anim"]);me.set("regMsg",regMsg);}},params={taskId:"usherRegUsr",server:this.serverName||mstrConfig.serverName,project:mstrConfig.projectName,port:this.serverPort||mstrConfig.serverPort,email:this.email.value,userid:this.user.value,password:this.pwd.value};serverRequest(params,callbacks);}}function getTextBoxJson(props){return mstrmojo.hash.copy(props,{scriptClass:"mstrmojo.ValidationTextBox",cssDisplay:"block",postCreate:function(){if(DOM.isIE9||DOM.isIE8||DOM.isIE7){this.emptyText=this.hint;}},onEnter:function(){registerHandler.call(this.parent);}});}mstrmojo.UsherLogin=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.UsherLogin",markupString:'<div id="{@id}" class="mstrmojo-UsherLogin-Container {@cssClass}" style="{@cssText}" ><div class="mstrmojo-UsherLogin-badge"><div class="icn"><img src="../images/1ptrans.gif"/></div><div class="dots"><div class="dot1"></div><div class="dot2"></div><div class="dot3"></div></div><div class="app"><img src="../style/mstr/images/badge-app.png"/></div></div><div class="mstrmojo-UsherLogin-badgeLabel"><div class="app-name"></div><div class="badge-name"></div></div><div class="mstrmojo-UsherLogin"><div class="mstrmojo-UsherLogin-QR mode"><img class="QR" src="../images/1ptrans.gif" alt="" /></div><div class="mstrmojo-UsherLogin-register mode"></div></div><div class="mstrmojo-UsherLogin-userInfo mode"><img class="userInfo" src="../images/1ptrans.gif" alt="" /></div><div class="mstrmojo-UsherLogin-notification"></div><div class="mstrmojo-UsherLogin-remember-setting"><div class = "mstrmojo-UsherLogin-remember"></div><div class = "mstrmojo-UsherLogin-forget"></div></div><div class="mstrmojo-UsherLogin-link"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},badgeNode:function(){return this.domNode.firstChild;},badgeIconNode:function(){return this.domNode.firstChild.firstChild.firstChild;},badgeLabelNode:function(){return this.domNode.childNodes[1];},usherNode:function(){return this.domNode.childNodes[2];},qrNode:function(){return this.domNode.childNodes[2].firstChild;},qrCodeNode:function(){return this.domNode.childNodes[2].firstChild.firstChild;},refreshNode:function(){return this.domNode.childNodes[2].firstChild.lastChild;},registerNode:function(){return this.domNode.childNodes[2].lastChild;},userNode:function(){return this.domNode.childNodes[3];},userInfoNode:function(){return this.domNode.childNodes[3].firstChild;},notificationNode:function(){return this.domNode.childNodes[4];},rememberSettingsNode:function(){return this.domNode.childNodes[5];},rememberNode:function(){return this.domNode.childNodes[5].firstChild;},forgetNode:function(){return this.domNode.childNodes[5].lastChild;},linksNode:function(){return this.domNode.lastChild;}},markupMethods:{onqrCodeChange:function(){if(this.qrCodeNode){this.qrCodeNode.src=this.qrCode;}},onbadgeChange:function(){var badge=this.badge||DEFAULT_BADGE,badgeFormat=badge.badgeFormat,fmt=badgeFormat&&(window.JSON?JSON.parse(badgeFormat):eval("("+badgeFormat+")"))||{isnull:true},labelNode=this.badgeLabelNode,iconNode=this.badgeIconNode,domNode=this.domNode;if(this.showBadgeBackgroundImage){domNode.style.backgroundColor=fmt.mini_badge;if(fmt.bg_4){domNode.style.backgroundImage="url("+fmt.bg_4+")";}}iconNode.src=fmt.mini_badge_icon||DEFAULT_BADGE.mini_badge_icon;if(!fmt.isnull&&!fmt.mini_badge_icon){CSS.addClass(iconNode.parentNode,"default");}labelNode.firstChild.innerHTML=badge.appName||DEFAULT_BADGE.appName;labelNode.lastChild.innerHTML=badge.name||DEFAULT_BADGE.name;labelNode.lastChild.title=badge.name||DEFAULT_BADGE.name;labelNode.style.color=fmt.t_color||DEFAULT_BADGE.t_color;this.linksNode.style.color=fmt.t_color||DEFAULT_BADGE.t_color;},onexpiredChange:function(){CSS.toggleClass(this.usherNode,"expired",this.expired);},onloadingChange:function(){CSS.toggleClass(this.usherNode,"loading",this.loading);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(this.visible&&this.canRequestQR()&&!this._lastVisible){getQRCode.call(this);}this.stopPolling=!this.visible;this._lastVisible=this.visible;},onnotificationModeChange:function(evt){CSS.toggleClass(this.containerNode,"notificationMode",this.notificationMode);},onproximityModeChange:function(evt){CSS.toggleClass(this.containerNode,"proximityMode",this.proximityMode);},onisPnEnabledChange:function(){this.hideRememberMe(!this.isPnEnabled);}},qrCode:"../images/1ptrans.gif",badge:DEFAULT_BADGE,expired:false,onUsherLogin:mstrmojo.emptyFn,onUsherError:mstrmojo.emptyFn,showBadgeBackgroundImage:true,usherProps:null,serverName:null,serverPort:null,rememberMe:false,userInfo:null,notificationTimer:null,loadQR:false,notificationMode:false,isPnEnabled:false,init:function init(props){if(this._super){this._super(props);}CSS.addWidgetCssClass(this,"");this.usherProps=this.usherProps?HASH.copy(this.usherProps,HASH.clone(usherProps)):HASH.clone(usherProps);this.userInfo=this.userInfo?HASH.copy(this.userInfo,HASH.clone(userInfo)):HASH.clone(userInfo);this.notificationTimer=this.notificationTimer?HASH.copy(this.notificationTimer,HASH.clone(notificationTimer)):HASH.clone(notificationTimer);},destroy:function destroy(ignoreDOM){this.stopPolling=true;clearTimeout(this.pullTimeout);this._super(ignoreDOM);},canRequestQR:function(){return this.usherProps&&(this.loadQR||(this.serverName||mstrConfig.serverName));},showUserInfo:function(res){this.refresh.set("visible",false);this.refresh.set("visible",false);},updateQRCode:function(res){this.set("qrCode","data:image/png;base64,"+res);this.set("expired",false);this.refresh.set("visible",false);},updateQRCodeProximity:function(){this.set("qrCode","../images/WaitUsherRadar.gif");this.set("expired",false);this.refresh.set("visible",false);},handleQRCodeError:function(){this.set("qrCode","../style/mstr/images/msgError.gif");this.set("expired",true);this.refresh.set("visible",true);},showQRLoading:function showQRLoading(show){this.set("loading",show);if(show){this.refresh.set("visible",false);}},postBuildRendering:function(){this._super();this.registerForm.set("tabIndex",-1);},toggleRegister:function(force){this.registerVisible=(force!==undefined)?force:!this.registerVisible;CSS.toggleClass(this.usherNode,"show-register",this.registerVisible);this.registerLink.set("text",this.registerLink.texts[this.registerVisible?1:0]);if(this.isPnEnabled===true){this.hideRememberMe(this.registerVisible&&this.isPnEnabled);}},hideRememberMe:function(force){CSS.toggleClass(this.rememberSettingsNode,"hide-rememeber",force);},reloadQR:function(){if(this.canRequestQR()){if(this.pullTimeout){clearTimeout(this.pullTimeout);}this.usherProps.intervalCtr=0;this.usherProps.qrLoaded=false;if(this.visible){getQRCode.call(this);}}},children:[{scriptClass:"mstrmojo.Label",slot:"qrNode",alias:"refresh",cssClass:"refresh",text:mstrmojo.desc(14028,"Refresh QR Code"),visible:false,onclick:function(){getQRCode.call(this.parent);}},{scriptClass:"mstrmojo.Box",slot:"registerNode",alias:"registerForm",regMsg:null,children:[getTextBoxJson({alias:"user",cssClass:"login-username",cssDisplay:"block",hint:mstrmojo.desc(17,"User name")}),getTextBoxJson({alias:"pwd",cssClass:"login-pwd",hint:mstrmojo.desc(18,"Password"),type:"password"}),getTextBoxJson({alias:"email",cssClass:"login-email",dtp:DTP.VARCHAR,constraints:{validator:_VALIDATOR.VALIDATE_EMAIL,trigger:mstrmojo.validation.TRIGGER.ONKEYUP},bindings:{visible:"this.parent.parent.usherRegistrationOption > 2"},hint:mstrmojo.desc(9772,"Email")}),getTextBoxJson({alias:"confirmEmail",cssClass:"login-email",bindings:{visible:function(){return this.parent.parent.usherRegistrationOption>2;}},hint:mstrmojo.desc(14149,"Confirm Email"),onpaste:function(evt){DOM.preventDefault(evt.hWin,evt.e||evt.hWin.event);}}),{scriptClass:"mstrmojo.Box",alias:"regMsg",cssClass:"register-msg",bindings:{regMsg:function(){return this.parent.regMsg;},visible:function(){return this.parent.regMsg;}},onregMsgChange:function(){if(this.domNode){this.domNode.style.color=this.regMsg&&this.regMsg.successful?"#42C31E":"#f00";}},children:[{scriptClass:"mstrmojo.Label",alias:"msg",cssClass:"register-msg-txt",bindings:{text:function(){return this.parent.regMsg.msg;}}},{scriptClass:"mstrmojo.Label",alias:"icn",cssClass:"register-msg-icn",onclick:function(){this.parent.parent.parent.toggleRegister();this.parent.parent.set("regMsg",null);}}]},{scriptClass:"mstrmojo.Button",alias:"registerButton",cssClass:"register mstrmojo-WebButton hot",cssDisplay:"inline-block",text:mstrmojo.desc(11773,"Register"),bindings:{enabled:function(){var username=this.parent.user.value,email=this.parent.email.value,confirmEmail=this.parent.confirmEmail.value;var registerStatus=username.length>0;if(registerStatus){if(this.parent.parent.usherRegistrationOption>1){var emailStatus=email.length>=3&&confirmEmail.length>=3&&email.toUpperCase()===confirmEmail.toUpperCase()&&this.parent.email.validationStatus.code===_SC.VALID;if(emailStatus){if(this.parent.parent.usherRegistrationOption==7){var restrictedDomains=this.parent.parent.usherRegistrationDomain.toUpperCase();var emailDomain=email.substr(email.indexOf("@")+1).toUpperCase();return restrictedDomains.indexOf(emailDomain)>=0;}}return emailStatus;}}return registerStatus;}},onclick:function(){registerHandler.call(this.parent);}},{scriptClass:"mstrmojo.Button",alias:"registerCancelButton",cssClass:"register-cancel",cssDisplay:"inline-block",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var p=this.parent;p.parent.toggleRegister();p.set("regMsg",null);p.user.set("value","");p.pwd.set("value","");p.email.set("value","");p.confirmEmail.set("value","");p.user.domNode.focus();}}]},{scriptClass:"mstrmojo.CheckBox",slot:"rememberNode",alias:"remember-me",label:mstrmojo.desc(14522,"Remember me"),onclick:function onclick(){this.parent.set("rememberMe",this.checked);}},{scriptClass:"mstrmojo.Label",slot:"forgetNode",allowHTML:true,text:mstrmojo.desc(14527,"Forget me/Switch user"),onclick:function(){forgetMe.call(this.parent);}},{scriptClass:"mstrmojo.Label",slot:"linksNode",allowHTML:true,text:'<a id="proximityProblems" href="#">Login via Phone</a>',onclick:function(evt){getQRCode.call(this.parent,true);return false;},bindings:{visible:"this.parent.proximityMode"},},{scriptClass:"mstrmojo.Label",slot:"linksNode",allowHTML:true,text:mstrmojo.desc(14136,"Use your ###Usher## app to scan the QR Code.").replace("###",'<a href="https://itunes.apple.com/us/app/usher-identity/id776079205" target="_blank">').replace("##","</a>"),},{scriptClass:"mstrmojo.Label",slot:"linksNode",alias:"registerLink",cssClass:"register-label",allowHTML:true,bindings:{visible:"this.parent.usherRegistrationOption > 0"},text:"",texts:[mstrmojo.desc(14137,"Don't have an Usher Badge? Click ###here## to register."),mstrmojo.desc(14140,"Display your ###QR Code##.")],postCreate:function(){this.set("text",this.texts[0]);},ontextChange:function(){this.text=this.text.replace("###",'<a href="#" onclick="mstrmojo.all.'+this.parent.id+'.toggleRegister(); return false;">').replace("##","</a>");}},{scriptClass:"mstrmojo.Label",alias:"userDetails",cssClass:"user-details",slot:"userNode"},{scriptClass:"mstrmojo.Button",alias:"loginButton",cssClass:"mstrmojo-WebButton login-button .mstrButton",cssDisplay:"inline-block",text:mstrmojo.desc(14525,"Login with Usher"),slot:"notificationNode",visible:false,onclick:function(){submitLogin.call(this.parent);},onvisibleChange:function(){var node=this.parent,msg=mstrmojo.desc(14523,"Hi ")+" "+node.userInfo.firstName;this.visible?msg+="!":msg+=mstrmojo.desc(14524,", please approve on your device.");updateUserDetails.call(node,msg);}},{scriptClass:"mstrmojo.Box",alias:"loginNotificationBox",cssClass:"login-notification",slot:"notificationNode",visible:false,children:[{scriptClass:"mstrmojo.Label",alias:"timer",cssClass:"notification-timer"},{scriptClass:"mstrmojo.Label",alias:"notificationFailure",cssClass:"notification-failure",text:mstrmojo.desc(14526,"Did not get notification"),onclick:function(){toggleLoginNotification.call(this.parent.parent,true);}}]},]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.Menu","mstrmojo.hash","mstrmojo.array");mstrmojo.ui.menus.MenuItemType=null;var U="separator";mstrmojo.ui.menus.MenuConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.MenuConfig",menus:null,menuCssClass:"",supportsScroll:false,maxHeight:0,hasMenuItems:function Q(){return !!this.menus.length;},getMenuItems:function E(V){return mstrmojo.array.filter(this.menus.slice().reverse(),function(Z,Y,X){var W=X[Y+1];return V||Z.cls!==U||(Y&&W&&W.cls!==U);}).reverse();},getMenuItem:function C(Y){var X=this.menus,V;if(X!==null){for(V=0;V<X.length;V++){var W=X[V];if(W.cls===Y){return W;}}}return null;},absorbMenuItems:function S(V){this.menus=this.menus.concat(V.menus);},addMenuItem:function I(c,Y,a,W,Z){var b,X,V;if(!c||typeof c==="string"){b=c;}else{b=c.n;X=c.ttp;}V={n:b,ttp:X,cls:Y,fn:a,ctxt:W};if(isNaN(Z)||Z>=this.menus.length){this.menus.push(V);}else{this.menus.splice(Z,0,V);}return V;},addCustomMenuItem:function T(a,X,Z,W,V){var Y=this.addMenuItem(a,X,Z,V);Y.getItemMarkup=W;return Y;},addDisabledMenuItem:function O(W,V){this.addNonInteractiveMenuItem(W,V,true);},addNonInteractiveMenuItem:function M(Z,W,V){var X=["non-int"];if(W){X.push(W);}if(V){X.push("disabled");}var Y=this.addMenuItem(Z,X.join(" "),mstrmojo.emptyFn);Y.dsbld=true;},addSeparator:function D(){this.addMenuItem("",U,function(){return false;});},addPopupMenuItem:function R(c,X,b,Y,W,Z){var a=["pop "];if(Y){a.push(Y);}var V=this.addMenuItem(c,a.join(" "),b,W,Z);V.pop=true;V.scope=X;return V;},addActionPopupMenuItem:function L(c,W,a,b,X,V,Z){var Y=this.addPopupMenuItem(c,W,b,(X||"")+" ax",V,Z);Y.actionFn=a;Y.ax=true;},addSubMenuItem:function K(Z,X,W,Y,V){this.addPopupMenuItem(Z,W,Y,X,V);},addEditorMenuItem:function P(Z,W,Y,V,X){this.addPopupMenuItem(Z,W,Y,"",V,X);},getToggleItemStates:function F(d,f,V,b,X,a){var Y,Z,W,c;if(typeof d==="string"){Y=Z=d;W=c="";}else{Y=d.on||"";Z=d.off||"";W=d.ttpOn||"";c=d.ttpOff||"";}var e=[{n:Y,ttp:W,cls:f+" on",fn:b,ctxt:a},{n:Z,ttp:c,cls:f,fn:V,ctxt:a}];if(!X){e.reverse();}return e;},addToggleMenuItem:function J(c,Y,a,X,W,b,V){var Z=this.getToggleItemStates(c,Y,a,X,b,V);return this.addDualStateItem(W,Z[0],Z[1]);},addDualStateItem:function G(W,V,X){return this.addMenuItem({n:V.n,ttp:V.ttp},V.cls,this.getDualStateHandler(W,V,X),V.ctxt);},getDualStateHandler:function H(W,V,X){return function(Z,a){var Y=[V,X];if(Z.cls===V.cls){Y.reverse();}Y[1].fn.call(mstrmojo.all[W],Z,a);Z.n=Y[0].n;Z.ttp=Y[0].ttp;Z.cls=Y[0].cls;};},addRadioMenuGroup:function B(X,c,Y,W,V,b,a){var Z=[];Y.forEach(function(g,d){if(g.separator){this.addSeparator();return ;}var i=g.text,h=(W||"")+" "+(g.cls||"")+(b?"":" radio")+(g.value===X?" on":""),f=function(){if(c.call(this.ctxt,g.value,X,g)===false){return false;}X=g.value;Z.forEach(function(j){j.cls=j.cls.replace(/ on$/,"")+(j.radioValue===X?" on":"");});return true;},e=a?this.addCustomMenuItem(i,h,f,a(g,d),V):this.addMenuItem(i,h,f,V);e.radioValue=g.value;Z.push(e);},this);},clear:function N(){this._super();this.menus=[];},newInstance:function A(V){return new mstrmojo.ui.menus.Menu(mstrmojo.hash.copy({popupConfig:this},V));}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.SimpleTree","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.warehouse.EnumObjectTypes");var Y=mstrmojo.array,a=mstrmojo.css,G=mstrmojo.dom,W=mstrmojo.hash,c="item-mn",K="item-n",A="userSel",T="mltSel",B=mstrmojo.warehouse.EnumObjectTypes,N=B.TABLE,D="li",L="ul",V="idx",H=":";function U(e){if(this.hasRendered){var f=this.domNode.getElementsByTagName(D);Y.forEach(f,e,this);}}function I(){var e=[];W.forEach(this.userSelections,function(f,g){e.push(this.getTreeItem(g));},this);return(e.length>1)?e:null;}mstrmojo.warehouse.ui.TablesTree=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._HasOwnAvatar,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.warehouse.ui.TablesTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree {@cssClass}" mstrAttach:click,dblclick>{@itemsHTML}</div>',userSelections:undefined,draggable:true,dropZone:true,getMenuHelper:mstrmojo.emptyFn,showTablesNum:true,init:function X(e){this._super(e);this.cssClass+=" mstrmojo-wh-TablesTree";this.userSelections=[];},getItemMarkup:function F(){return'<div class="{@cls}" title="{@ttp}"><span class='+K+' unselectable="on">{@n}</span><span class='+c+"></span></div>";},treeHooks:{select:function S(g,w,f){var e=G.findAncestorByAttr(g,"idx",true,this.domNode),x=e.value,AA=this.userSelections,q=this.rangeSelect,z,v,k=Number.MAX_VALUE,j=Number.MIN_VALUE,l,u,h,n,o,t,r,p=this.shiftStartIndex,y=parseInt(f,10),i=AA[x]===true;if(w.tp===N){if(i){delete AA[x];}else{AA[x]=true;}z=W.keyarray(AA);v=z.length;a.toggleClass(this.domNode,T,v>1);a.toggleClass(g,A,!i);if(q&&v&&p){n=p.split(H);h=x.split(H);if(n&&h&&(n.length===h.length)&&n.length===(y+1)){for(r=0;r<n.length;r++){if(n[r]!==h[r]){break;}}if(r===y){l=parseInt(h[y],10);u=parseInt(n[y],10);if(!isNaN(l)&&!isNaN(u)){k=(l<u)?l:u;j=(l>u)?l:u;}for(var m=k;m<=j;m++){h[f]=m.toString();o=h.join(H);t=this.getTreeItem(o);if(t&&t.tp===N){AA[o]=true;delete this.selectedIndices[o];}}U.call(this,function(AC){var AB=AC.getAttribute(V);if(AA[AB]===true){a.toggleClass(AC,A,true);}});}}}}delete this.selectedIndices[x];return true;},unselect:function M(f,g,h,e){this.itemRenderer.select(f,g,h,e,this);this.selectedIndices[g._renderIdx]=true;return true;}},tablesTreeHooks:{},showMenu:function Q(f){var g=this.getMenuHelper(),h=1;mstrApp.getRootController().setTableMenuContext(h);g.target=this;g.data=f.data;var e=g.getMenuConfig();e.hostId=this.id;e.hostElement=f.menuNode;e.isHostedWithin=false;e.hostProxyCssClass="item-mn-proxy";this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:e}));},onclick:function d(f){var j=f.target||G.eventTarget(f.hWin,f.e),i=G.findAncestorByAttr(j,"idx",true,this.domNode),k=i&&i.node.getAttribute("level"),h=G.shiftKey(f.hWin,f.e),g=i&&i.value,e=j.className===c&&g!==null&&!isNaN(k);if(!(G.ctrlKey(f.hWin,f.e)||G.metaKey(f.hWin,f.e)||h)){if(!e||!this.userSelections[g]){this.clearUserSelections(W.copy(this.userSelections));}else{this.userSelections[g]=false;}}if(h){this.rangeSelect=true;}else{this.shiftStartIndex=g;}this._super(f);if(e){this.showMenu({data:I.call(this)||this.getTreeItem(g),menuNode:j});}this.rangeSelect=false;},ondblclick:function J(m){var j=this,i=m.target||G.eventTarget(m.hWin,m.e),f=i.nodeName.toLowerCase(),p=G.findAncestorByAttr(i,"idx",true,this.domNode),e=p&&p.node.getAttribute("level"),l=p&&p.value,n=this.selectedIndices,k,o=n[l],g,h=j.tablesTreeHooks;j.onclick(m);if((f!==L)&&(f!==D)&&l!==null&&!isNaN(parseInt(e,10))){g=this.getTreeItem(l);if(h.isTable===undefined||h.isTable(g)){if(o){k=h.removeItem;}else{k=h.addItem;}if(k){k.call(j,p.node,g,e,l,n,this);}}}},createAvatar:function O(e){var g=document.createElement("div"),f=G.findAncestorByAttr(e,V,true,this.domNode);if(f&&f.node){g.appendChild(f.node.cloneNode(true));g.appendChild(document.createElement("div"));}g.className=this.domNode.className;return g;},toggleAvatarClass:function P(e,f){a.toggleClass(this.avatar,e,f);},getDragData:function E(f){var e=this.getNodeAttributes(f.src.node).index,h=this.getTreeItem(e),g=this.userSelections;if(h.tp===N){if(g[e]===true){return I.call(this)||[h];}this.clearUserSelections(W.copy(g));return[h];}return h;},isDragValid:function C(){return true;},ondragstart:function Z(e){this._super(e);var f=e.src.data;if(this.showTablesNum&&f&&f.length>1){this.avatar.getElementsByClassName(K)[0].innerHTML=f.length;}},getNodeAttributes:function b(f){var e=G.findAncestorByAttr(f,V,true,this.domNode),g=e&&e.node.getAttribute("level");return{index:e&&e.value,level:parseInt(g,10)};},clearUserSelections:function R(e){U.call(this,function(g){var f=g.getAttribute(V);if(e[f]===true){a.toggleClass(g,A,false);delete this.userSelections[f];}});a.toggleClass(this.domNode,T,false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupList","mstrmojo.array");var F=mstrmojo.array,E=mstrmojo.desc(11402,"Auto Map"),C=[{n:E,v:"autoMap"}];mstrmojo.architect.ui.SettingsList=mstrmojo.declare(mstrmojo.ui.PopupList,null,{scriptClass:"mstrmojo.architect.ui.SettingsList",cssClass:"mstrmojo-ar-SettingsList",multiSelect:true,init:function G(K){this._super(K);var H=this.items=C,J=mstrApp.getRootController().getSettings(),I=this.selectedIndices={};F.forEach(H,function(M,L){I[L]=!!J[M.v];});},onOpen:function B(){var H=this.items=C,J=mstrApp.getRootController().getSettings(),I=this.selectedIndices={};F.forEach(H,function(M,K){var L=J[M.v];if(L===true){I[K]=L;}});this.set("selectedIndices",I);},listHooks:{select:function A(H,I){mstrApp.getRootController().setSettingValue(I.v,true);this.set("visible",false);},unselect:function D(H,I){mstrApp.getRootController().setSettingValue(I.v,false);this.set("visible",false);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo.ui._IsPulldown","mstrmojo.ui.PopupList","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var I=mstrmojo.css,G=mstrmojo.array,F=mstrmojo.dom;mstrmojo.ui.Pulldown=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo.ui._IsPulldown],{scriptClass:"mstrmojo.ui.Pulldown",onitemSelected:mstrmojo.emptyFn,allowHTML:true,init:function N(O){this._super(O);I.addWidgetCssClass(this.list,"ctrl-popup-list");},initChildren:function E(){this.children=this.getPopupListConfig();this._super();},getSelectedItem:function H(){var O=this.items;return O&&O[this.selectedIndex];},selectItemByField:function J(P,O){this.set("selectedIndex",G.find(this.items||[],P,O));},getPopupWidget:function D(){return this.list;},getPopupList:function K(){return this.list;},_set_items:function B(R,O){var Q=this.items;this.items=O;delete this.selectedIndex;if(Q!==O){var P=this.hasRendered;if(P){this.refresh();}return true;}return false;},onclick:function M(O){this._super(O);var Q=this,P=Q.getPopupWidget();Q.mw=Q.mw||function(R){if(!F.contains(P.domNode,F.eventTarget(self,R),true,document.body)){P.close();F.detachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Q.mw);}};F.attachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Q.mw);},_set_selectedIndex:function A(T,R){if((R!==0&&!R)||R<0){return false;}var P=this.selectedIndex=R,O=this.getPopupList(),Q=O.items,S=this.selectedNode;O.set("selectedIndex",P);if(S&&Q&&Q[P]){S.innerHTML=this.allowHTML?Q[P].n:mstrmojo.string.encodeHtmlString(Q[P].n);S.title=Q[P].title||"";}this.onitemSelected(Q[P],P);return true;},getPopupListConfig:function C(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,listHooks:{select:function O(R,S,Q){this.parent.set("selectedIndex",Q);this.close();}},getItemProps:function P(S,Q){var R=mstrmojo._IsList.getItemProps.call(this,S,Q);R.style=this.parent.itemCssText||"";return R;}};},children:[]});mstrmojo.ui.Pulldown.newPulldown=function L(P,T,O,S,R){S=S||{};S.items=P;var Q;if(R===true){Q=mstrmojo.hash.copy({scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:O||0},S);}else{Q=new mstrmojo.ui.Pulldown(S);if(O!==undefined){Q.set("selectedIndex",O);}}Q.postselectedIndexChange=function(U){var X=U.value,W=U.valueWas;if(X!==W){var V=this.items;T.call(this,V[X],V[W]);}};return Q;};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.TextBox","mstrmojo.ui.Pulldown");var J=mstrmojo.array,G=mstrmojo.dom,O=mstrmojo.Widget;function M(Q){this.set("options",Q.options);}mstrmojo.architect.ui.editors.ColumnDefinitionEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.editors.ColumnDefinitionEditor",clnName:mstrmojo.desc(11455,"Column name:"),dtName:mstrmojo.desc(9658,"Data type:"),precisionName:"",scaleName:"",dtpPulldown:undefined,precisionText:undefined,scaleText:undefined,clnText:undefined,markupString:'<div class="mstrmojo-ar-cde" mstrAttach:click><div class="mstrmojo-ar-cde-cln"><div>{@clnName}</div></div><div class="mstrmojo-ar-cde-dtp"><div>{@dtName}</div></div><div class="mstrmojo-ar-cde-byt"><div>{@precisionName}</div></div><div class="mstrmojo-ar-cde-scale"><div>{@scaleName}</div></div></div>',markupSlots:{containerNode:function E(){return this.domNode;},columnContainer:function L(){return this.domNode.firstChild;},dataTypeContainer:function P(){return this.domNode.children[1];},precisionContainer:function B(){return this.domNode.children[2];},scaleContainer:function D(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:O.visibleMarkupMethod,onheightChange:O.heightMarkupMethod,onwidthChange:O.widthMarkupMethod,onprecisionNameChange:function K(){this.precisionContainer.firstChild.innerHTML=this.precisionName;},onscaleNameChange:function I(){this.scaleContainer.firstChild.innerHTML=this.scaleName;}},postBuildRendering:function A(){this._super();var Q=this.dtpPulldown;this.clnText.set("value",this.colName);Q.set("items",this.items);Q.set("selectedIndex",J.find(Q.items,"id",this.type));this.precisionText.set("value",this.precision);this.scaleText.set("value",this.scale);},onoptionsChange:function H(){var Q=["precision","scale"],R=this.options;J.forEach(Q,function S(V,T){var U=R[T];this.set(V+"Name",(U&&U.txt)||"");this[V+"Text"].set("value",((U&&U.id)===this.type?this[V]:0));this[V+"Text"].set("visible",!!U);},this);},onclick:function N(Q){try{if(Q.hWin){G.stopPropogation(Q.hWin,Q.e);}}catch(R){mstrApp.onerror(R);}},getEditorData:function F(){return{colName:this.clnText.value,type:this.dtpPulldown.selectedItem.id,precision:this.precisionText.value,scale:this.scaleText.value};},children:[{scriptClass:"mstrmojo.ui.Pulldown",alias:"dtpPulldown",slot:"dataTypeContainer",onitemSelected:function C(Q){this.selectedItem=Q;M.call(this.parent,Q);}},{scriptClass:"mstrmojo.TextBox",alias:"clnText",slot:"columnContainer"},{scriptClass:"mstrmojo.TextBox",alias:"precisionText",slot:"precisionContainer",type:"number"},{scriptClass:"mstrmojo.TextBox",alias:"scaleText",slot:"scaleContainer",type:"number"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui.Pulldown");var F=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingPulldown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",cssClass:"mstrmojo-wh-DBRolePulldown",postBuildRendering:function A(){if(this._super){this._super();}this.captionlbl.set("text",this.caption);this.list.set("itemIdField",this.itemIdField);this.list.set("itemField",this.itemField);this.onenabledChange();if(typeof this.allowHTML==="boolean"){this.list.set("allowHTML",this.allowHTML);}},caption:"",contains:function C(M){var L=mstrmojo.array.find(this.items,this.itemIdField,M);return(L>0);},itemIdField:"",itemField:"n",items:null,onitemsChange:function K(){this.list.set("items",this.items);},selectedID:null,onselectedIDChange:function E(){var L=Math.max(F.find(this.items,this.itemIdField,this.selectedID),0);if(this.items&&this.items[L]){this.list.set("selectedIndex",L);}if(this.selectedID){this.selectedItem=this.items[L];}},selectedItem:undefined,enabled:true,onenabledChange:function G(){this.captionlbl.set("enabled",this.enabled);this.list.set("enabled",this.enabled);},getValue:function D(){var L=this.selectedItem||this.items[0];if(L){return L.v;}return"";},setValue:function B(L){this.set("selectedID",L);},isValid:function J(){return{val:true,msg:""};},onChange:mstrmojo.emptyFn,captionlbl:undefined,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",alias:"captionlbl"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"list",onitemSelected:function H(O,M){var N=this.parent,L=(N.selectedItem?N.selectedItem.id:"");if(O[this.itemIdField]!==L){N.set("selectedItem",O);if(N.onChange){N.onChange(O,M);}}},onitemsChange:function I(){var L=this.parent;L.selectedID=null;}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.array","mstrmojo.Editor","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.Button","mstrmojo.Label","mstrmojo.DynamicClassFactory","mstrmojo.ui.Pulldown");var E=mstrmojo.array,D=mstrmojo.DynamicClassFactory.newComponent;mstrmojo.architect.ui.SimpleList=D(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.architect.ui.SimpleList"});function C(){var F=this.secondaryList,G=this.primaryDBRole;this.close();this.onSubmit({did:this.dataSources.did,primaryId:G.id,primaryName:G.n,secondary:F.getSelectedItems()});}mstrmojo.architect.ui.editors.DataSourceEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.DataSourceEditor",cssClass:"mstrmojo-ar-DataSourceEditor",title:mstrmojo.desc(4381,"Data Sources"),help:null,primaryPulldown:undefined,secondaryList:undefined,onSubmit:mstrmojo.emptyFn,onOpen:function A(){var F=this.dataSources.dbRoles;this.primaryPulldown.set("items",F);this.primaryPulldown.set("selectedIndex",E.find(F,"id",this.dataSources.primaryId));},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11387,"Primary Data Source")+":"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"primaryPulldown",onitemSelected:function B(L,I){var H=this.items.concat(),K=this.parent,G=K.secondaryList;H.splice(I,1);G.clearSelect(true);G.set("visible",H.length!==0);G.set("items",H);var J={};E.forEach(H,function F(N,M){J[M]=true;});G.set("selectedIndices",J);K.primaryDBRole=L;}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11389,"Secondary Data Source(s):")},{scriptClass:"mstrmojo.architect.ui.SimpleList",cssClass:"mstrmojo-ar-SecondaryDBRoles",multiSelect:true,selectionPolicty:"reselect",alias:"secondaryList"},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(1442,"OK"),slot:"buttonNode",onclick:function(){C.call(this.parent);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown");var H=mstrmojo.array,C=mstrmojo.hash,B=19,J=13,D=27;mstrmojo.ui.SearchablePulldown=mstrmojo.declare(mstrmojo.ui.Pulldown,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.ui.SearchablePulldown",editableSlot:"selectedNode",allowCustomText:false,isSearching:false,editOnClick:false,init:function K(P){this._super(P);var M=this.getPopupList();M.renderOnScroll=this.renderOnScroll||M.renderOnScroll;M.renderBlockSize=this.renderBlockSize||M.renderBlockSize;mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-SearchablePulldown");var O=M.constructor.prototype,N=M.getItemProps?M.getItemProps:O.getItemProps,Q=M.getItemMarkup?M.getItemMarkup:O.getItemMarkup;M.getItemProps=function(V,R){var S=this._spft||"",W=V.n,T=W.toUpperCase().indexOf(S);if(T===-1){S="";}var U=N.call(this,V,R);U.before=W.slice(0,T);U.input=W.substring(T,T+S.length);U.after=W.slice(T+S.length,W.length);return U;};M.getItemMarkup=function(S,R){return Q.call(this,S,R).replace("{@en@n}","{@en@before}<span class='sp-highlight'>{@en@input}</span>{@en@after}");};},onclick:function L(M){var P=this.selectedNode,Q=M.getTarget(),R=M.e.offsetX>=(P.offsetWidth-B),O=this.getPopupWidget(),N=O.visible;if(Q===P&&(!N||(N&&R))){this.set("isEditing",!N);this._super(M);}},onPopupWidgetClosed:function F(){this.set("isEditing",false);var P=this.getPopupList(),Q=P._oldItems,N=this.text;delete P._oldItems;if(Q){var M=H.find(Q,"n",N);if(M===-1&&!this.allowCustomText){var O=P.items[0]||Q[0];M=H.find(Q,"n",O.n);}P.set("items",Q);this.set("selectedIndex",M);}},_set_selectedIndex:function E(O,M){if(this.allowCustomText&&M===-1){this.selectedIndex=-1;this.onitemSelected(null,M);}else{this.isSearching=false;this._super(O,M);if(this.hasRendered){var N=this.selectedNode;this.text=N.innerText?N.innerText:N.textContent;}}return true;},onkeydown:function G(N){this._super(N);var M=window.event||N.e;if(M.keyCode===J){this.getPopupList().close();}},onkeyup:function A(O){this._super(O);var M=window.event||O.e,P=M.keyCode,N=this.getPopupList();if(P===D||P===J){N.close();}else{this.processSearch();}},processSearch:function I(){this.isSearching=true;this.hideTooltip();var M=[],O=this.getPopupList(),P=this.selectedNode.innerHTML,Q=O._oldItems||O.items,N=P.toUpperCase();N=N.replace(/<BR>/,"");if(N.length>0){H.forEach(Q,function(R){if(R.n.toUpperCase().indexOf(N)>-1){M.push(C.clone(R));}},this);}else{M=Q;}O._spft=N;if(this.customizeSearchResult){this.customizeSearchResult(M);}O.set("items",M);O.adjustCornersForPopupOverflow();delete O._spft;O._oldItems=Q;O.set("visible",M.length!==0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.warehouse.obj.DBRole","mstrmojo.warehouse.EnumDataChangeEvents");var E=mstrmojo.array,F=mstrmojo.warehouse.EnumDataChangeEvents,B=mstrmojo.desc(12240,"Please select a data source");mstrmojo.architect.ui.editors.DBRolePicker=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.DBRolePicker",cssClass:"mstrmojo-wh-DBRolePicker",id:"DBRolePicker",title:mstrmojo.desc(11387,"Primary Data Source"),callback:undefined,newDBRole:undefined,dbrList:undefined,postCreate:function D(){var G=this;this.model.attachEventListener(F.DBROLES_LOADED.toString(),this.id,function(){if(!G.visible){return ;}var I=mstrApp.getRootController().getDBRoles().sort(function J(L,K){return E.stringSorter(L.n,K.n);}),H=E.find(I,"n",G.newDBRole.mdDBRole.n);G.dbrList.set("items",I);G.dbrList.set("selectedIndex",H);});},onOpen:function A(){var H=mstrApp.getRootController().getDBRoles().sort(function G(J,I){return E.stringSorter(J.n,I.n);});this.dbrList.set("items",H);if(H.length>0){this.dbrList.set("selectedIndex",0);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRolePickerLabel",text:mstrmojo.desc(11388,"Please select a Primary Data Source for this project")},{scriptClass:"mstrmojo.Label",alias:"newDBRolebtn",cssClass:"mstrmojo-wh-addDB",title:mstrmojo.desc(11131,"New data source"),onclick:function C(){var G=this;mstrApp.getRootController().editDBRole(undefined,{success:function H(I){G.parent.newDBRole=I;}});}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"dbrList",cssClass:"mstrmojo-wh-DBRolePickerList"},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button rightfloat",text:mstrmojo.desc(1442,"OK"),onclick:function(){var H=this.parent.parent,G=H.dbrList.items[H.dbrList.selectedIndex];if(!G){mstrmojo.alert(B);}else{H.close();if(H.callback&&H.callback.success){H.callback.success(H.dbrList.items[H.dbrList.selectedIndex].did);}}}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var G=this.parent.parent;G.close();mstrApp.getRootController().navigateProject();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.ToolbarButton","mstrmojo.architect.ui.SettingsList","mstrmojo.architect.ui.EnumViewTypes","mstrmojo.Box","mstrmojo.dom");var H=mstrmojo.dom,g=mstrmojo.architect.ui.EnumViewTypes,X="selected",b="mstrmojo-ar-tb-icon",G="on",W="databaseview",V="ptableview",F="sysdim",D="userdim",f="layer",P="trsfm",E="logvw",e="update",d="save",a="autoMap",I=" ",R=mstrmojo.desc(11142,"Layers"),T=mstrmojo.desc(788,"System Hierarchy"),Y=mstrmojo.desc(12216,"User hierarchies"),N=mstrmojo.desc(12215,"Transformations"),M=mstrmojo.desc(12217,"Logical views"),A=mstrmojo.desc(11402,"Auto Map"),C=mstrmojo.desc(11383,"Save Progress"),J=mstrmojo.desc(12248,"Update schema"),S=mstrmojo.desc(4381,"data sources"),L=mstrmojo.desc(12249,"Project explorer");mstrmojo.architect.ui.Toolbar=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.Toolbar",postBuildRendering:function Z(){this._super();this.onwidthChange();},onwidthChange:function Q(){var h=this.views.domNode;if(h){var k=parseInt(this.width,10),j=H.position(h).w,i=140,l=((k-j)/2);h.style.left=(l<i?i:l)+"px";}},tbList:undefined,toggleLeft:undefined,databaseView:undefined,update:function K(j){this.toggleLeft.set("active",j.isLeftVisible);this.databaseView.set("active",j.showDB);mstrApp.rootController.toggleDatabaseView(j.showDB);var h=j.currentView,i=this.views.tbList;i.selectedIndices={};i.selectedIndices[h]=true;i.refresh();},children:[{scriptClass:"mstrmojo.architect.ui.ToolbarButton",cmd:"saveProject",iconClass:[b,d].join(I),title:C},{scriptClass:"mstrmojo.architect.ui.ToolbarButton",cmd:"saveAndUpdate",iconClass:[b,e].join(I),title:J},{scriptClass:"mstrmojo.architect.ui.ToolbarButton",alias:"databaseView",cmd:"toggleDatabaseView",active:false,iconClass:[b,W].join(I),title:S,persistSelection:true},{scriptClass:"mstrmojo.architect.ui.ToolbarButton",alias:"toggleLeft",cmd:"toggleProjectTableView",active:true,iconClass:[b,V,G].join(I),title:L,persistSelection:true},{scriptClass:"mstrmojo.Box",alias:"views",cssClass:"views-tb",children:[{scriptClass:"mstrmojo.architect.ui.SimpleList",cssClass:"views-tb-list",alias:"tbList",selectedIndex:0,getItemMarkup:function(){return'<div class="item {@cls}" title="{@n}" idx="{@idx}"></div>';},getItemProps:function c(j,h){var i=!!this.selectedIndices[h];return{tag:"div",sel:i,cls:[b,j.cls||""].concat(i?X:"").join(I),n:j.n,style:"",idx:h};},preselectionChange:function B(i){var h=mstrApp.rootController.preSwitchView();if(!h.canProceed){this.select([i.removed[0]],true);mstrmojo.alert(h.msg);return false;}},postselectionChange:function O(h){mstrApp.rootController.switchView(this.items[h.added[0]].viewTp,true);},items:[{n:R,viewTp:g.LAYER,cls:f},{n:T,viewTp:g.SYS_HIERARCHY,cls:F},{n:Y,viewTp:g.USER_HIERARCHY,cls:D},{n:N,viewTp:g.TRANSFORMATION,cls:P},{n:M,viewTp:g.LOGICAL_VIEWS,cls:E}]}]},{scriptClass:"mstrmojo.architect.ui.ToolbarButton",persistSelection:"persistSelection",cmd:function U(){var i=this,j=this.settingsList=this.settingsList||new mstrmojo.architect.ui.SettingsList({parentDomNode:this.domNode,onClose:function h(){i.settingsList.set("visible",false);i.set("active",false);}});if(!j.hasRendered){j.render();}if(this.active){j.open(this);}else{j.close();}},closePopup:mstrmojo.emptyFn,iconClass:[b,a].join(I),title:A}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.EditableLabel","mstrmojo.ui.menus.MenuConfig","mstrmojo.css");var b=mstrmojo.css,N=1,L=2,F=4,c=8,K=16;function E(e){return function(){b.toggleClass(this.menuBtnNode,"active",e);};}function H(f){var j=new mstrmojo.ui.menus.MenuConfig(),i=this.getMenuActions(),e=this.index,k=this.id,g=this.total;if((i&K)>0){this.addNewTabMenuItem(j);}if((i&F)>0){j.addMenuItem(mstrmojo.desc(3397,"Duplicate"),"dup",function(){mstrmojo.all[k].tabDuplicated();});}if((i&L)>0){if(e){j.addMenuItem(mstrmojo.desc(5362,"Move Left"),"lft",function(){mstrmojo.all[k].tabMoved(true);});}if(e<g-1){j.addMenuItem(mstrmojo.desc(5363,"Move Right"),"rgt",function(){mstrmojo.all[k].tabMoved(false);});}}j.addSeparator();if((i&N)>0){j.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){mstrmojo.all[k].lbl.set("isEditing",true);});}if((i&c)>0){if(g>1){j.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){mstrmojo.all[k].tabDeleted();});}}var h=this.getCustomMenu();if(h&&h.hasMenuItems()){j.addSeparator();j.absorbMenuItems(h);}j.addPopupHandlers(this.id,E(true),E(false));this.showTabMenu(this.updateMenuCfg(j),f);}mstrmojo.vi.ui.tabs.Tab=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.Tab",markupString:'<div id="{@id}" class="mstrmojo-VITab unselectable {@cssClass}" style="{@cssText}" unselectable="on" mstrAttach:click><div><div class="mstrmojo-VITab-tab"></div><div class="mstrmojo-VITab-menu"></div></div></div>',markupSlots:{containerNode:function W(){return this.domNode.firstChild.firstChild;},menuBtnNode:function a(){return this.domNode.firstChild.lastChild;}},markupMethods:{ontitleChange:function Z(){this.lbl.set("text",this.title);},onisSelectedChange:function V(){mstrmojo.css.toggleClass(this.domNode,"selected",this.isSelected);},onzIndexChange:function D(){this.domNode.style.zIndex=this.zIndex;}},zIndex:1,menuBtnNode:null,lbl:null,title:"",index:-1,total:-1,isSelected:false,children:[{scriptClass:"mstrmojo.EditableLabel",alias:"lbl",editOnClick:false,onTextEditComplete:function Q(f,e){if(f){this.parent.titleEdited(this.text,e);}}}],postBuildRendering:function X(){if(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()){this.draggable=false;}this._super();},onclick:function d(e){var f=e.getTarget();if(f===this.menuBtnNode){H.call(this,f);}else{if(!this.isSelected){this.tabSelected();}}},getMenuActions:function I(){return 0;},getCustomMenu:function B(){return null;},isDragValid:function A(){return this.parent.children.length>1&&!this.lbl.isEditing;},createAvatar:function S(){var e=document.createElement("div");e.appendChild(this.domNode.cloneNode(true));e.style.margin="-5px 0 0 10px";return e;},allowDrop:function G(e){var f=e.src.widget;return f&&f.parent===this.parent;},ondrop:function Y(e){var f=e.src.data;this.parent.moveTab(f.idx,this.index,f.fromIdx);this._super(e);},ondragenter:function P(f){this._super(f);var g=f.src.data,e=this.index;this.parent.moveTab(g.idx,e);g.idx=e;},ondragover:function T(g){var e=g.tgt.node,f=g.tgtData,h=f&&f.node;if(!f||h!==e){g.tgtData={node:e};if(h){h.style.borderColor="";}}e.style.borderColor="#0fe88f";},getDragData:function C(){var g=this.id,e=this.index;return{setAvatarClass:function f(h){var k=mstrmojo.all[g],i=k.avatar;if(i){var j=[k.avatarCssClass,"hasOwnAvatar",h];i.className=j.join(" ");}},fromIdx:e,idx:e};},getDropAvatarIcon:function R(){return"pivot";},cleanUpAfterTarget:function J(f){var e=f.tgtData&&f.tgtData.node;if(e){e.style.borderColor="";}this._super(f);},onAppStateChange:function U(e){var f=this.lbl,g=e.value===mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;f.set("isEditing",false);f.set("editOnDoubleClick",!g);this.draggable=!g;},addNewTabMenuItem:function O(e){this.throwAbstractMethodError("addNewTabMenuItem");},tabSelected:mstrmojo.emptyFn,titleEdited:mstrmojo.emptyFn,tabMoved:mstrmojo.emptyFn,tabDeleted:mstrmojo.emptyFn,tabDuplicated:mstrmojo.emptyFn,showTabMenu:mstrmojo.emptyFn,updateMenuCfg:function M(e){return e;}});mstrmojo.vi.ui.tabs.Tab.ACTIONS={NEW_TAB:K,RENAME:N,MOVE:L,DUPLICATE:F,DELETE:c};}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.HBox","mstrmojo.EnumAuthenticationModes","mstrmojo.UsherLogin","mstrmojo.string","mstrmojo.cookies");mstrmojo.requiresDescs(17,18,221,11804,11863);var E=mstrmojo.EnumAuthenticationModes,D={};D[E.LDAP]=mstrmojo.desc(1947,"LDAP Authentication");D[E.DATABASE]=mstrmojo.desc(1948,"Database Authentication");var K={LIVE_OR_HL:0,PERSISTED:1};function B(){return(JSON.parse(decodeURIComponent(mstrmojo.cookies.getCookieSetting("lastMsgID")||"{}")))[mstrConfig.lastMsgKey];}function C(){var P=this,Q=P.stdLoginInfo,N=Q.user.value,M=Q.tsvCode.value,R=Q.pwd.value,S={taskId:"login",server:mstrConfig.serverName,project:mstrmojo.string.decodeHtmlString(mstrConfig.projectName),port:mstrConfig.serverPort,authMode:mstrConfig.authMode,setAsActiveSession:true};var O=B();if(O){S.msgID=O;}if((this.authMode&(E.STANDARD|E.LDAP|E.DATABASE))>0){S.userid=N;S.password=R;S.tsvCode=M;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(V){if(V&&V.sessionState){mstrApp.updateSessionState(V.sessionState);if(mstrApp.sessionManager){mstrApp.sessionManager.restart();}var X=V;var U=V.resCode;if(U==K.LIVE_OR_HL&&(mstrApp.isVI||mstrApp.scriptClass==="mstrmojo.OIVMApp"||mstrApp.analysisID)){mstrmojo.xhr.request("post",mstrConfig.taskURL,{success:function(){var Y=P.config.callback,Z=Y.success;if(Z){Z(X);}},failure:function(){mstrmojo.form.send({evt:3010,src:mstrApp.name+".3010"},null,"POST");}},{taskId:"docXMLResults",sessionState:V.sessionState,msgID:V.msgID,resultFlags:33554432});}else{var T=P.config.callback,W=T.success;if(W){W(X);}}}P.destroy();},failure:function(T){mstrmojo.alert(T.getResponseHeader("X-MSTR-TaskFailureMsg"),null,null,P.zIndex);}},S);}function L(){if(mstrApp.sessionManager){mstrApp.sessionManager.gotoLogoutPage();}}mstrmojo.LoginEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.LoginEditor",cssClass:"mstrmojo-LoginEditor",title:mstrmojo.desc(11804,"Log in to"),btnAlignment:"right",help:"login_box",config:{callback:{},taskParams:{}},authMode:E.STANDARD,usherEnabled:false,init:function J(M){this._super(M);this.title+=" "+mstrApp.projectName;this.set("authMode",parseInt(mstrConfig.authMode,10));if(this.isUsherLogin()){mstrmojo.css.addWidgetCssClass(this,"usher");}},isUsherLogin:function(){return this.authMode===E.USHER;},onvisibleChange:function I(){if(this.visible&&(mstrmojo.dom.isFF||mstrmojo.dom.isWK)){var M=this.stdLoginInfo.user;window.setTimeout(function(){M.focus();},50);}},onClose:function F(){L();},destroy:function H(){mstrmojo.dom.detachEvent(document.body,"mousedown",this.stopPropagation,true);this._super();},postBuildRendering:function A(){if(this.authMode===mstrmojo.EnumAuthenticationModes.NTCREDENTIAL){C.call(this);return ;}else{var M=this._super();this.stopPropagation=function(N){N.stopPropagation();};mstrmojo.dom.attachEvent(document.body,"mousedown",this.stopPropagation,true);return M;}},preBuildRendering:function G(){if(this.isUsherLogin()){var N=this,M=mstrmojo.insert({scriptClass:"mstrmojo.UsherLogin",alias:"usherLogin",onUsherLogin:function(){mstrConfig.authMode=E.USHER;C.call(N);}});this.addChildren([M],1);}return this._super();},children:[{scriptClass:"mstrmojo.Label",cssText:"margin-bottom: 20px; line-height: 1.5em;",text:mstrmojo.desc(11863,"Your user session has timed out due to inactivity, and you have been automatically logged out. Please log in again.")},{scriptClass:"mstrmojo.Box",alias:"stdLoginInfo",cssClass:"std-login-container",bindings:{visible:function(){return this.parent.authMode!==E.USHER;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"user",cssClass:"login-username",cssDisplay:"block",hint:mstrmojo.desc(17,"User name"),postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(17,"User name");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.TextBox",alias:"pwd",cssClass:"login-pwd",cssDisplay:"block",hint:mstrmojo.desc(18,"Password"),type:"password",postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(18,"Password");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.TextBox",alias:"tsvCode",cssClass:"login-tsvCode",cssDisplay:"block",hint:mstrmojo.desc(13825,"Usher code"),bindings:{visible:function(){return mstrConfig.features["is-two-step-verification-required"];}},postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(13825,"Usher code");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-LoginEditor-authMode",bindings:{visible:function(){return this.parent.parent.authMode===E.LDAP||this.parent.parent.authMode===E.DATABASE;},text:function(){return D[this.parent.parent.authMode]||"";}}}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",alias:"btns",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:mstrmojo.desc(26,"Login"),bindings:{enabled:"this.parent.parent.stdLoginInfo.user.value.length > 0",visible:function(){return this.parent.parent.authMode!==E.USHER;}},onclick:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){L();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME.DerivedMetricOptions");mstrmojo.requiresDescs(2140);var B=mstrmojo.array;mstrmojo.ME._DerivedMetricEditorHelper=mstrmojo.provide("mstrmojo.ME._DerivedMetricEditorHelper",{isDME:true,noCache:false,closeLabel:mstrmojo.desc(2140,"Cancel"),saveAsEnabled:false,tbBrowsable:false,init:function C(D){this._super(D);},onApplyMetricCallback:mstrmojo.emptyFn,optionPopupRef:{scriptClass:"mstrmojo.ME.DerivedMetricOptions",title:mstrmojo.desc(13035,"Metric Options"),help:"Metric_Options_dialog_box.htm",width:300},replaceAttributeWithForms:function A(E){var D=[];B.forEach(E,function(F){if(F.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Attribute&&F.fs){B.forEach(F.fs,function(G){if(G.obf||F.da){D.push({n:F.n+"@"+G.fnm,did:F.did+"@"+G.fid,fmdid:G.fid,fnm:G.fnm,t:G.t,frm:G,oi:F,path:F.path});}});}else{D.push(F);}});return D;}});}());(function(){mstrmojo.requiresCls("mstrmojo._IsList","mstrmojo.array","mstrmojo.css","mstrmojo.ListBase");var F=mstrmojo.array,D=mstrmojo.dom,H=mstrmojo.string,A=mstrmojo.desc(629,"Delete"),B=mstrmojo.desc(1388,"Rename"),C;mstrmojo.architect.ui.UnitList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.architect.ui.UnitList",markupString:'<div id="{@id}" class="mstrmojo-ListBase mstrmojo-ar-UnitList {@cssClass}" style="{@cssText}" mstrAttach:click><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div>',selectionPolicy:"reselect",multiSelect:false,getItemProps:function G(M,K){var L=["item",(M.tp?("tp"+(M.icntp||M.tp)):""),(M.multi?"mso":"")];return{tag:"div",cls:L.join(" "),n:H.encodeHtmlString(M.n||M.name||""),idx:K,ttp:H.encodeXMLAttribute(M.ttp||M.n)};},getItemMarkup:function I(){return'<div class="item {@cls} tp{@tp}" idx="{@idx}" style="{@style}"><div class="mstrmojo-ar-ulist-txt" title="{@ttp}">{@n}</div><span ren="{@idx}" class="mstrmojo-ar-ulist-icn-ren" title="'+B+'"></span><span del="{@idx}" class="mstrmojo-ar-ulist-icn-del" title="'+A+'"></span></div>';},onclick:function J(S){var R=this,Q=S.target||D.eventTarget(S.hWin,S.e),M=D.findAncestorByAttr(Q,"del",true,this.domNode),N=M&&parseInt(M.value,10),K=this.items[N],T=D.findAncestorByAttr(Q,"ren",true,this.domNode),O=T&&parseInt(T.value,10),P=this.items[O];if(N!==null&&!isNaN(N)){this.onItemDeleted(K,N);}else{if(O!==null&&!isNaN(O)){C=C||new mstrmojo.architect.ui.editors.NameEditor({isNew:false});C.onOK=function L(U){R.onItemRenamed(P,U);};C.data=P;C.tp=P.tp;C.open();}else{this._super(S);}}},onItemDeleted:mstrmojo.emptyFn,onItemRenamed:mstrmojo.emptyFn,_set_selected:function E(K,L){this.selected=L;if(L!==null){this.singleSelect(F.find(this.items,"did",L));return true;}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.range","mstrmojo.Widget","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo._HasSuggestion","mstrmojo.ME.MetricToken","mstrmojo.ME.MetricDataService","mstrmojo.ui.ScrollableSuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var M=mstrmojo.dom,O=mstrmojo.css,x=mstrmojo.Enum_Keys,D=mstrmojo.range,c=D.EDGE,p=mstrmojo.ME.MetricToken.isDelimiter,L=mstrmojo.expr,h=mstrmojo.array,H=mstrmojo.hash;function AE(E){return E.ctrlKey||M.isMetaKey(window,E);}mstrmojo.ME.SpanListMapper=mstrmojo.provide("mstrmojo.SpanListMapper",mstrmojo.mixin({itemWrapperPrefix:function(E){return'<span class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"&nbsp;",itemWrapperSuffix:"</span>",createWrapperNode:function N(E){var AF=E.ownerDocument,AG=AF.createElement("span");return AG;},_iw2idx:function P(AF,AI,AH){var AG=this.wrapperNodes(AI),E=mstrmojo.array.indexOf(AG,AH);return E===-1?AG.length:E;},itemOffsetLeft:function a(AF,AJ,E,AH){if(!AH){var AG=this.wrapperNodes(AJ);AH=AG&&AG[E];if(!AH){return 0;}}var AI=AJ.firstChild;if(!AI||(AI===AH)){return 0;}return AH.offsetLeft-AI.offsetLeft;},whereDrop:function AD(AN,E,AH,AM,AF){var AJ=this._nd2iw(AN,E,AH),AO,AL,AI,AK,AG;if(AJ){AL=this._iw2idx(AN,E,AJ);AO=AL;AI=this.itemOffsetLeft(AN,E,null,AJ);AK=AJ.offsetTop;AG=AJ.offsetWidth;if(AM.x>AF.left+AI+AG/2){AO++;AI+=AG;}}else{return AN.dropCuePos;}return{left:AI,top:AK,idx:AO,idxActual:AL};}},mstrmojo.hash.copy(mstrmojo.WidgetListMapper)));mstrmojo.ME.TokenInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._HasSuggestion],{scriptClass:"mstrmojo.ME.TokenInputBox",containerResizable:false,dropZone:true,suggestionPopupCssClss:"mstrmojo-ME-TokenInputBox-suggest",allowDrop:function C(E){var AF=E.src.data;return !!AF;},ondrop:function(E){E.src.data={v:mstrmojo.ME.MetricToken.brackets(E.src.data.item.n),oi:H.copyProps(["did","n","t"],E.src.data.item),isNew:true};if(this.prepareDropItem){this.prepareDropItem(E);}this.insertTokens([E.src.data]);this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");},ondragenter:function F(E){this.dragdata=E.src.data;this._super(E);this.set("dropCuePos",{left:0,top:0});mstrmojo.css.addClass(this.domNode,"unselectable");},ondragleave:function Q(){this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");},ondropCuePosChange:function S(AF){var AG=AF.value,E=this.dragdata;if(E&&E.setAvatarClass){if(AG){E.setAvatarClass("add");}else{E.setInvalidAvatarClass();}}},makeObservable:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,markupString:'<div id={@id} class="mstrmojo-TokenInputBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-TokenInputBox-edit" contenteditable="true" tabindex="1" spellcheck="false"ondragstart = "return false;" oncontextmenu = "document.oncontextmenu =  mstrmojo.all.{@id}.fnContextMenu;" onkeydown = "return mstrmojo.all.{@id}.handlekeydown(event);" onkeypress = "return mstrmojo.all.{@id}.handlekeypress(event);" onkeyup = "return mstrmojo.all.{@id}.handlekeyup(event);" onmouseup = "return mstrmojo.all.{@id}.handlemouseup(event);" onpaste = "return mstrmojo.all.{@id}.handlepasteDirect(event);" >{@itemsHtml}</div><textarea class = "mstrmojo-TokenInputBox-clipboard" onkeyup = "return mstrmojo.all.{@id}.handlepaste(event);"></textarea><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild;},clipboardNode:function(){return this.domNode.childNodes[1];},scrollboxNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",items:null,itemFunction:function G(AG,E,AF){return new mstrmojo.ME.MetricToken({data:AG,parent:AF});},listMapper:mstrmojo.ME.SpanListMapper,_set_items:function R(AF,E){if(this._super){this._super(AF,E);}if(!this.tokensCacheInitilized){this.pretokensModify();this.tokensCacheInitilized=true;}},tokensCache:[],tokensCachePointer:0,isDelimiter:p,postBuildRendering:function X(){if(this._super){this._super();}this._eros=false;if(M.isFF){document.body.spellCheck=false;}},fnContextMenu:function I(E){if(E){E.cancelBubble=true;E.returnValue=false;}return false;},handlekeydown:function V(AK){AK=AK||window.event;var AI=AK.keyCode||AK.charCode,AG=false,AL=D.getRangeInfo();if((AE(AK)||AI===x.LEFT_ARROW||AI===x.RIGHT_ARROW)&&this.doubleByte){this.doubleByte=false;var AJ=this.prev_rInfo,AF=AL,AM=AF.startContainer.data.slice(AJ.startOffset,AL.startOffset);this.widgetHandleImeInput(AJ,AM);return ;}switch(AI){case x.DELETE:if(!this.doubleByte){try{this.widgetHandleDelete(AL);this.startTokenSuggestion();this.raiseChangeEvent({type:"delete"});}catch(AH){}AG=true;}break;case x.BACKSPACE:if(!this.doubleByte){try{this.widgetHandleBackspace(AL);this.raiseChangeEvent({type:"backspace"});this.startTokenSuggestion();this.editNode.focus();}catch(E){}AG=true;}break;case x.ENTER:if(this.breakOnEnterKeyDown&&this.breakOnEnterKeyDown()){break;}case x.TAB:this._startDebug=true;if(this.suggestionShown){this.handleSuggestionItemSelect(this.getSelected());}else{this.startTokenSuggestion();}AG=true;break;case x.ESCAPE:this.endTokenSuggestion();AG=true;break;case 86:if(AE(AK)){this._saveRangeInfo=D.getRangeInfo();if(!this._saveRangeInfo.collapsed){this.widgetHandleDelete(this._saveRangeInfo);this._saveRangeInfo=D.getRangeInfo();}this.clipboardNode.focus();AG=false;}break;case 89:if(AE(AK)){this.widgetHandleUndoRedo("redo");AG=true;}break;case 90:if(AE(AK)){this.widgetHandleUndoRedo("undo");AG=true;}break;case 229:if(!this.doubleByte){this.doubleByte=true;this.prev_rInfo=AL;this.prev_items=this.items;}break;default:}if(AG){M.stopPropogation(window,AK);M.preventDefault(window,AK);return false;}return true;},getCharacter:function z(AF){var E=(M.isIE&&!M.isIE9)?AF.keyCode:AF.charCode;return(E>0)?String.fromCharCode(E):null;},handlekeypress:function A(AH){AH=AH||window.event;var AI=this.getCharacter(AH),AF=false;if(AI&&!((AI==="c"||AI==="a")&&AE(AH))){try{this.widgetHandleInput(D.getRangeInfo(),AI);this.raiseChangeEvent({type:"input",character:AI});if(!this.isDelimiter(AI)){if(this.useKeyDelay){var AG=this;window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){AG.startTokenSuggestion();},mstrmojo.ME.MetricDataService.suggestDelay);}else{this.startTokenSuggestion();}}else{this.endTokenSuggestion(true);}}catch(E){}AF=true;}if(AF){M.stopPropogation(window,AH);M.preventDefault(window,AH);return false;}return true;},handlekeyup:function Y(AG){var E=AG.keyCode||AG.charCode,AF;if(E===x.LEFT_ARROW||E===x.RIGHT_ARROW){AF=this.findObjectToken();if(AF&&AF===this._saveActiveToken){this.startTokenSuggestion(AF);}else{this.endTokenSuggestion();}}else{if(E===x.UP_ARROW){this.preHighlight();}else{if(E===x.DOWN_ARROW){this.nextHighlight();}}}this._saveRangeInfo=D.getRangeInfo();},handlemouseup:function g(AK){if(this.dropCuePos){return false;}var AG=this.findObjectToken();if(AG&&AG===this._saveActiveToken){this.startTokenSuggestion(AG);}else{this.endTokenSuggestion();}var AI=D.getRangeInfo();if(this.doubleByte){this.doubleByte=false;var AJ=this.prev_rInfo,AH=this._saveRangeInfo,AF=AH.startContainer.data.slice(AJ.startOffset,AH.startOffset+1);if(AF!==""){var E=this.widgetHandleImeInput(AJ,AF);this.prev_items=this.items;AG=M.findWidget(AI.startContainer);if(AG){this._delaySetTextCaretPos(AG.domNode,AI.startOffset);}else{this._delaySetTextCaretPos(E.domNode,AI.startOffset-1);}}this.prev_rInfo=AI;}this._saveRangeInfo=AI;},handlepasteDirect:function u(E){this.clipboardNode.value=E.clipboardData.getData("Text");this.handlepaste(E);M.stopPropogation(window,E);M.preventDefault(window,E);return false;},handlepaste:function e(AJ){var AF=this.clipboardNode.value;this.clipboardNode.value="";var AI=[],E=AF&&AF.length,AH,AG="",AK;if(E>0){for(AH=0;AH<E;AH++){AK=AF.charAt(AH);if(this.isDelimiter(AK)){if(!mstrmojo.string.isEmpty(AG)){AI.push({v:AG,isNew:true});AG="";}AI.push({v:AK,isDelimiter:true,isNew:true});}else{AG=AG+AK;}}if(!mstrmojo.string.isEmpty(AG)){AI.push({v:AG,isNew:true});AG="";}this.insertTokens(AI);}},raiseChangeEvent:function(E){E.name="tokensModify";this.raiseEvent(E);},getTokensAsString:function AC(){var AF=[],AH=this.items,AG,E;for(AG=0,E=AH.length;AG<E;AG++){AF[AG]=AH[AG].v;}return AF.join("| ");},replaceErrorToken:function i(AH){var AG=this.items||[],AI=mstrmojo.array.find(AG,"sta",-1),AF,AJ=function(AP,AN,AQ){var AM=(AP&&AP.items)||[],AL=h.find(AM,"did",AN),AK,AO;if(AL>-1){AK=AM[AL].fs;AO=h.filterOne(AK,function(AR){return AR.fnm&&AR.fnm.toUpperCase()===AQ.toUpperCase();});}return AO;},E=function(AP,AN,AO){var AK={v:AN.n,oi:AN,isNew:true},AM=AP.v&&AP.v.split("@"),AL;if(AM&&AM.length>1){AL=AJ(AO,AN.did,AM[1]);if(AL){AK.exv=AL.fmdid||AL.fid;AK.extp=8;AK.v=mstrmojo.ME.MetricToken.brackets(AN.n)+"@"+AL.fnm;}}return AK;};if(AI>-1){AF=E(AG[AI],AH,this.candidates);this.remove(AI);this.add([AF],AI);}},widgetHandleDelete:function Z(AI){if(AI.collapsed){var AH,AG,E,AJ=AI.startOffset,AF=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AI.startContainer,false,document.body)){D.collapseOnNode(this.editNode,false);return ;}AH=D.getEdgeInfo(AI.startContainer,AI.startOffset);AG=M.findWidget(AI.startContainer);E=this.itemIndex(AG.data);if(AH===c.EDGE_END){E++;AG=AF[E];AJ=0;}if(!AG){D.collapseOnNode(this.editNode,false);return ;}if(AG.length()===1){this.remove(E);AG=AF[E];if(AG){D.collapseOnNode(AG.domNode,true);}else{D.collapseOnNode(this.editNode,false);}this.checkMergeTwoTokens(E-1,E);}else{AG.spliceContent(AJ,1);D.collapseOnTextNode(AG.domNode,AJ);}}else{this.widgetDeleteTokens(AI);}},widgetHandleBackspace:function o(AI){if(AI.collapsed){var AH,AG,E,AJ=AI.startOffset,AF=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AI.startContainer,false,document.body)){if(AI.startOffset>0&&M.isFF){AG=AF[this.items.length-1];D.collapseOnNode(AG.domNode,false);AI=D.getRangeInfo();AH=D.getEdgeInfo(AI.startContainer,AI.startOffset);}else{D.collapseOnNode(this.editNode,true);return ;}}AH=D.getEdgeInfo(AI.startContainer,AI.startOffset);AG=M.findWidget(AI.startContainer);E=this.itemIndex(AG.data);if(AH===c.EDGE_BEGIN){E--;AG=AF[E];AJ=AG.length();}if(!AG){D.collapseOnNode(this.editNode,true);return ;}if(AG.length()===1){this.remove(E);AG=AF[E-1];if(AG){D.collapseOnNode(AG.domNode,false);this.checkMergeTwoTokens(E-1,E);AG=AF[E-1];}else{D.collapseOnNode(this.editNode,true);}}else{AG.spliceContent(AJ-1,1);D.collapseOnTextNode(AG.domNode,AJ-1);}}else{this.widgetDeleteTokens(AI);}},widgetHandleInput:function q(AJ,AK){if(!AJ.collapsed){this.widgetDeleteTokens(AJ);AJ=D.getRangeInfo();}var AG,AL,AM,AN,E,AF,AH=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AJ.startContainer,false,document.body)){this.add([{v:AK,isDelimiter:this.isDelimiter(AK),isNew:true}],0);AL=AH[0];D.collapseOnTextNode(AL.domNode,1);return ;}AG=D.getEdgeInfo(AJ.startContainer,AJ.startOffset);AL=M.findWidget(AJ.startContainer);AM=this.itemIndex(AL.data);if(this.isDelimiter(AK)){AN={v:AK,isDelimiter:true,isNew:true};if(AG===c.EDGE_MIDDLE){var AI=AL.split2Tokens(AJ.startOffset);this.remove(AM);this.add([AI[0],AN,AI[1]],AM);AM=AM+1;}else{AM=(AG===c.EDGE_BEGIN)?AM:AM+1;this.add([AN],AM);}AL=AH[AM];D.collapseOnNode(AL.domNode,false);}else{AF=AJ.startOffset;if(AL.isDelimiter()){E=AH[(AG===c.EDGE_BEGIN)?AM-1:AM+1];if(E&&!E.isDelimiter()){AL=E;AF=(AG===c.EDGE_BEGIN)?AL.length():0;}}if(!AL.isDelimiter()){AL.spliceContent(AF,0,AK);D.collapseOnTextNode(AL.domNode,AF+1);}else{this.add([{v:AK,isNew:true}],(AG===c.EDGE_BEGIN)?AM:AM+1);AL=AH[(AG===c.EDGE_BEGIN)?AM:AM+1];D.collapseOnNode(AL.domNode,false);}}},widgetHandleImeInput:function q(AI,AJ){if(!AI.collapsed){this.widgetDeleteTokens(AI);AI=D.getRangeInfo();}var AG,AK,AL,AM,E,AF,AH=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AI.startContainer,false,document.body)){this.clearTokens();this.add([{v:AJ,isDelimiter:this.isDelimiter(AJ),isNew:true}],0);AH=this.ctxtBuilder.itemWidgets;AK=AH[0];D.collapseOnTextNode(AK.domNode,1);this._delaySetCaretPos(AK.domNode,false);return ;}AG=D.getEdgeInfo(AI.startContainer,AI.startOffset);AK=M.findWidget(AI.startContainer);AL=this.itemIndex(AK.data);AF=AI.startOffset;if(AK.isDelimiter()){this.clearTokens();this.set("items",this.prev_items);AH=this.ctxtBuilder.itemWidgets;E=AH[(AG===c.EDGE_BEGIN)?AL-1:AL+1];if(E&&!E.isDelimiter()){AK=E;AF=(AG===c.EDGE_BEGIN)?AK.length():0;}}if(!AK.isDelimiter()){AK.spliceContent(AF,0,AJ);this._delaySetTextCaretPos(AK.domNode,AF+AJ.length);}else{this.add([{v:AJ,isNew:true}],(AG===c.EDGE_BEGIN)?AL:AL+1);AK=AH[(AG===c.EDGE_BEGIN)?AL:AL+1];this._delaySetCaretPos(AK.domNode,false);}this.startTokenSuggestion();return AK;},findObjectToken:function B(){var AI=D.getRangeInfo(),AG=M.findWidget(AI.startContainer);if(!M.contains(this.editNode,AI.startContainer,false,document.body)){return null;}if(!AG||AG===this||!AG.isDelimiter){return null;}if(AG&&!AG.isDelimiter()){return AG;}var AH=D.getEdgeInfo(AI.startContainer,AI.startOffset),AF=this.ctxtBuilder.itemWidgets,E=this.itemIndex(AG.data);AG=AF[(AH===c.EDGE_BEGIN)?E-1:E+1];if(AG&&!AG.isDelimiter()){return AG;}return null;},checkMergeTwoTokens:function m(AI,AG){var AH=this.ctxtBuilder.itemWidgets,AF=AH[AI],E=AH[AG];if((AF&&!AF.isDelimiter())&&(E&&!E.isDelimiter())){this.remove([AI,AG]);this.add([AF.mergeTo(E)],AI);D.collapseOnTextNode(AH[AI].domNode,AF.length());}},insertTokens:function t(AL){var E=0,AF=this.editNode;var AK=this._saveRangeInfo||D.getRangeInfo();if(!AK||!M.contains(AF,AK.startContainer,false,document.body)){this.add(AL);E=this.items.length-1;this._delaySetTextCaretPos(AF,(AF.innerText||AF.textContent).length);}else{var AJ=D.getEdgeInfo(AK.startContainer,AK.startOffset),AG=M.findWidget(AK.startContainer);E=this.itemIndex(AG.data);if(AJ===c.EDGE_MIDDLE){var AI=AG.split2Tokens(AK.startOffset);this.remove(E);AL.unshift(AI[0]);AL.push(AI[1]);this.add(AL,E);}else{E=(AJ===c.EDGE_BEGIN?E:E+1);this.add(AL,E);}E=E+AL.length-1;AG=this.ctxtBuilder.itemWidgets[E];this._delaySetCaretPos(AG.domNode,false);}this.raiseChangeEvent({type:"insert"});var AH=this;window.setTimeout(function(){AH._saveRangeInfo=D.getRangeInfo();},50);return E;},insertParenthesisTokens:function w(AF){var E=this;window.setTimeout(function(){var AG=E.insertTokens([{v:"(",isDelimiter:true,isNew:true},{v:")",isDelimiter:true,isNew:true}]);E._delaySetTextCaretPos(E.itemsContainerNode.childNodes[AG]);},AF||50);},clearTokens:function l(E){this.set("items",E||[]);this._saveRangeInfo=null;this._delaySetCaretPos(this.editNode,false);},focus:function r(){var AF=this.ctxtBuilder.itemWidgets,E=AF.length;this._delaySetCaretPos(E>0?AF[E-1].domNode:this.editNode,false);},startTokenSuggestion:function y(E){this.endTokenSuggestion();if(!E){E=this.findObjectToken();}if(E&&!E.isDelimiter()){E.set("active",true);this._saveActiveToken=E;this.showSuggestion(this.getSearchPattern());}if(!E||this.getSearchPattern().length===0){this.hideSuggestion();}},browseItemVisible:true,folderLinksContextId:25,browsableTypes:[L.TP.FOLDER,L.TP.FACT,L.TP.ATTR,L.TP.FUNCTION,L.TP.FILTER,L.STP.PROMPT_OBJECTS,L.TP.ATTR,L.TP.DIM,L.TP.METRIC,L.TP.ROLE].join(","),getSearchPattern:function U(){var AF=this._saveActiveToken,AH=AF&&AF.data.v,E=AH&&AH.length;if(E>2){if(AH.charAt(0)==="["){AH=AH.substring(1);}if(AH.charAt(AH.length-1)==="]"){AH=AH.substring(0,AH.length-1);}}if(AF&&AF.data.ift){var AG=AF.data.v,AI=AG&&AG.indexOf("@");if(AI>=0){AH=AG.substring(AI);}}return AH||"";},getSuggestionPos:function b(){var E=this._saveActiveToken,AF=null,AH,AG;if(E){AH=E.data&&E.data.ift;AG=mstrmojo.dom.position(E.domNode,true);AF={left:Math.round(AG.x+(AH?AG.w:0))+"px",top:Math.round(AG.y+AG.h)+"px",zIndex:100};}return AF;},item2textCss:function J(AF){var E=(this._super&&this._super(AF))||{4:"m",11:"fx",12:"a",13:"fc",43:"tr",21:"afm","-99":"br"}[AF.t]||"";E+=AF.da?" da":"";E+=(AF.dm||AF.um)?" dm":"";E+=AF.de?" de":"";E+=AF.fs&&AF.fs.length&&AF.fs.some(function(AG){return AG.fgr>0;})?" g":"";return E;},onBrowserOpen:function n(){this.editNode.blur();},onSuggestionItemSelect:function v(AF){var E=this._saveActiveToken;this.endTokenSuggestion();if(E){if(E.data.ift&&AF.t===21){E.setFormInfo(AF);}else{E.setItemInfo(AF);if(AF.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){this.insertParenthesisTokens();}}this._delaySetCaretPos(E.domNode,false);}this.closePopup();},_delaySetCaretPos:function AA(E,AG){var AF=this.editNode,AH=this,AI=function(){AF.focus();AF.focus();D.collapseOnNode(E,AG);AH._saveRangeInfo=D.getRangeInfo();};window.setTimeout(AI,0);},_delaySetTextCaretPos:function AA(E,AI){var AF=this.editNode,AG=this,AH=function(){AF.focus();AF.focus();D.collapseOnTextNode(E,AI);AG._saveRangeInfo=D.getRangeInfo();};window.setTimeout(AH,0);},getCandidatesThroughTaskCall:function W(AF,E){AF.objectType="11,12,13,43,4";AF.rootFolderType=39;AF.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AF,E);},filterCandidates:function k(AI,AH,E){var AF=this._saveActiveToken,AJ=AF&&(AF.data.oi||AF.data.at),AG;if(AJ&&AF.data.ift){E=E||this.suggestCount;AH=mstrmojo.string.regEscape(AH);AG=h.filter(AI,function(AK){return AK.t===21&&AK.attid===AJ.did&&(new RegExp("^"+AH,"i")).test("@"+AK.n);},{max:E});}else{AG=h.filter(AI,function(AK){return AK.t!==21;});AG=this._super(AG,AH,E);}return AG;},endTokenSuggestion:function AB(AF){var E=this._saveActiveToken;if(E){if(AF){this.hideSuggestion();}E.set("active",false);this._saveActiveToken=null;}},widgetDeleteTokens:function f(AN){var AF=AN.startOffset,E=AN.endOffset,AQ=M.findWidget(AN.startContainer),AO=M.findWidget(AN.endContainer),AJ=this.itemIndex(AQ.data),AH=this.itemIndex(AO.data),AK=[],AL=D.getEdgeInfo(AN.startContainer,AF),AP=D.getEdgeInfo(AN.endContainer,E),AM=(AL===c.EDGE_BEGIN?AJ:AJ+1),AG=(AP===c.EDGE_END?AH:AH-1),AI;if(AQ===AO){if((AL===c.EDGE_BEGIN)&&(AP===c.EDGE_END)){this.remove(AJ);AO=this.ctxtBuilder.itemWidgets[AJ===0?AJ:AJ-1];if(AO){D.collapseOnNode(AO.domNode,AJ===0);}else{D.collapseOnNode(this.editNode,true);}}else{AQ.spliceContent(AF,E-AF);D.collapseOnTextNode(AO.domNode,AF);}}else{for(AI=AM;AI<=AG;AI++){AK.push(AI);}this.remove(AK);if(AL===c.EDGE_MIDDLE){AQ.spliceContent(AF);}if(AP===c.EDGE_MIDDLE){AO.spliceContent(0,E);}if(AL===c.EDGE_BEGIN){AQ=this.ctxtBuilder.itemWidgets[AJ===0?AJ:AJ-1];}if(AQ){D.collapseOnNode(AQ.domNode,AJ===0);}else{D.collapseOnNode(this.editNode,false);}AJ=(AL===c.EDGE_BEGIN)?AJ-1:AJ;this.checkMergeTwoTokens(AJ,AJ+1);}this.editNode.focus();},oncandidatesChange:function j(){var AF=this.candidates,E=(AF&&AF.items)||[];if(!this.noCache&&AF&&AF.isComplete){this.suggestCount=this.REQUEST_THRESHOLD=E.length;}else{this.suggestCount=mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=20;}},nudge:function(E){var AF=this.getSuggestionPos();if(AF){E.set("left",AF.left);E.set("top",AF.top);}},pretokensModify:function K(){this.tokensCache=this.tokensCache.slice(0,this.tokensCachePointer);var E=this.findObjectToken();this.tokensCache.push({items:H.clone(this.items),rInfo:D.getRangeInfo(),idx:E!==null?this.itemIndex(E.data):-1});this.tokensCachePointer=this.tokensCache.length;},widgetHandleUndoRedo:function d(AG){var AH,E,AF=function(AJ){if(!AJ){return ;}AJ=AJ||{};this.set("items",H.clone(AJ.items));var AM=this.ctxtBuilder.itemWidgets,AI=AM[AJ.idx],AL=AI&&AI.domNode||this.editNode,AK=AJ.rInfo;this._delaySetTextCaretPos(AL,AK&&AK.startOffset||0);};switch(AG){case"undo":AH=--this.tokensCachePointer;if(AH>-1){E=this.tokensCache[AH-1];AF.call(this,E);}else{this.tokensCachePointer=1;}break;case"redo":AH=this.tokensCachePointer++;if(AH>-1&&AH<this.tokensCache.length){E=this.tokensCache[AH];AF.call(this,E);}else{this.tokensCachePointer=Math.min(Math.max(this.tokensCachePointer,1),this.tokensCache.length);}break;}},resetTokensCache:function T(){this.tokensCache=[];this.tokensCachePointer=-1;this.tokensCacheInitilized=false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo._HasSuggestion");var F=-1,E=0,D=1;mstrmojo._ValidateSuggestions=mstrmojo.provide("mstrmojo._ValidateSuggestions",mstrmojo.hash.copy(mstrmojo._HasSuggestion,{_mixinName:"mstrmojo._ValidateSuggestions",itemValidationField:"did",verifyObject:function C(J,H){var M=this.candidates,L;if(M){var I=M.items,G=mstrmojo.array.find(I,this.itemValidationField,H.data[this.itemValidationField]);G=G>-1?G:mstrmojo.array.find(I,this.itemField,J);if(G>-1){H.updateData(I[G]);L=E;}else{if(M.isComplete){L=D;}}}if(L!==undefined){return L;}var K=this._vqueue=this._vqueue||[];K.push({pattern:J,id:H.data[this.itemIdField]});if(!this._vInProgress){this.verifyNextCandidate();}return F;},verifyNextCandidate:function B(){var G=this._vqueue;if(!G||G.length===0){this._vInProgress=false;return ;}this.verifyCandidate(G.shift());},verifyCandidate:function A(H){var G=this;this._vInProgress=true;this.getCandidatesThroughTaskCall({pattern:H.pattern,blockBegin:1,blockCount:G.noCache?-1:this.suggestCount,isVerify:true},{success:function(N){var K=G.ctxtBuilder.itemWidgets,J=K&&K.length,O,M;for(M=0;M<J;M++){if(K[M].data[G.itemIdField]===H.id){O=K[M];break;}}if(!O){return ;}var L=N.items;if(L&&L.length===1){O.updateData(L[0]);}else{if(L&&L.length>1){var I=mstrmojo.array.find(L,"did",O.data.did);if(I>-1){O.updateData(L[I]);}else{O.set("state",D);}}else{O.set("state",D);}}},failure:function(I){mstrmojo.alert(I.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){G.verifyNextCandidate();}});}}));mstrmojo._ValidateSuggestions.ENUM_STATES={UNDETERMINED:F,VALID:E,INVALID:D};}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.array","mstrmojo.architect.ui.panels.ElementsPanel");var E=mstrmojo.css,B=mstrmojo.desc(2218,"Add >"),D=mstrmojo.desc(12244,"< Remove");mstrmojo.architect.ui.ElementSelector=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.ElementSelector",title:{},left:"",top:"",minWidth:80,maxWidth:25000,maxHeight:30000,minHeight:20,model:null,prevPos:{},container:null,selectedIndex:[],draggable:true,noCheckBox:true,modal:true,zIndex:7,availableList:[],selectedList:[],availableTitle:"Available",selectedTitle:"Selected",callback:null,titleMarkupString:'<div style="position:absolute;width:100%;"><table cellspacing="0" cellpadding="0" class="mstrmojo-Editor-titlebar"><tr><td class="mstrmojo-Editor-titleCell"><div class="mstrmojo-Editor-title mstrmojo-architect-elementSelector-title"><span></span><span></span></div></td><td><a href="#" target="_new" class="mstrmojo-Editor-help"><img class="mstrmojo-Editor-help" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1143,"help")+'"></img></a></td><td><div class="mstrmojo-Editor-close mstrmojo-architect-elementSelector-close" title="'+mstrmojo.desc(2102,"Close")+'"></div></td></tr></table></div><div class="mstrmojo-Editor-titleSpacer"></div>',init:function F(I){this._super(I);this.markupSlots.titleTextNode=function G(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[0].firstChild.childNodes[1]:null;};this.markupSlots.titleIconNode=function H(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[0].firstChild.childNodes[0]:null;};this.markupMethods.ontitleChange=function(){if(this.showTitle&&this.title){if(this.titleTextNode){this.titleTextNode.innerHTML=this.title.text;E.addClass(this.titleIconNode,this.title.icon);}}};},setLists:function C(){var H=this,G=H.children[0].children[0],I=H.children[0].children[2];G.setElementsList(H.availableList);I.setElementsList(H.selectedList);},onOpen:function A(){var H=this,G=H.children[0].children[0],I=H.children[0].children[2];G.set("title",H.availableTitle);I.set("title",H.selectedTitle);H.setLists();},moveItem:function(L,R,P,I){var H=L.children[0],J=R.children[0],M=this,G,Q,K,N,O;N=L.selectedElementItem();if(N.length>0){Q=[];for(O=0;O<N.length;O++){K=N[O];G=(isNaN(K._renderIdx)?0:K._renderIdx);if(K.did!==P[G].did){G=0;while((K.did!==P[G].did)&&G<P.length){G++;}}if(G<P.length){Q.push(G);}}Q.sort();for(O=Q.length-1;O>=0;O--){G=Q[O];I.push(P[G]);P.splice(G,1);}M.setLists();}H.triggerSearch();J.triggerSearch();},children:[{scriptClass:"mstrmojo.HBox",cssText:"top:0px; height:300px; width:400px;",children:[{scriptClass:"mstrmojo.architect.ui.panels.ElementsPanel",alias:"AvailablePanel",title:"Available",cssText:"width:150px;",width:"200px"},{scriptClass:"mstrmojo.Box",cssText:"top:0px; height:160px; width:100px;",alias:"buttonBox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",alias:"Add",cssText:"width:20px;height:30px;margin-left:10px;margin-top:10px;",text:B,onclick:function(){var H=this.parent.parent.children[0],I=this.parent.parent.children[2],G=this.parent.parent.parent;G.moveItem(H,I,G.availableList,G.selectedList);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",cssText:"width:20px;height:30px;margin-left:10px;margin-top:10px;",text:D,alias:"Remove",onclick:function(){var H=this.parent.parent.children[0],I=this.parent.parent.children[2],G=this.parent.parent.parent;G.moveItem(I,H,G.selectedList,G.availableList);}}]},{scriptClass:"mstrmojo.architect.ui.panels.ElementsPanel",title:"Selected",alias:"SelectedPanel",cssText:"height:160px; width:150px;",width:"200px"}]},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-architect-selector-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var G=this.parent.parent;if(G.callback&&G.callback.success){G.callback.success(G.availableList,G.selectedList);}G.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button rightfloat",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var G=this.parent.parent;G.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.hash","mstrmojo.func","mstrmojo.css","mstrmojo.HBox","mstrmojo.Box","mstrmojo.DropDownButton","mstrmojo.Popup","mstrmojo.WidgetTree","mstrmojo.ObjectBrowserDataProvider","mstrmojo.OBList","mstrmojo.FishEyeContainer","mstrmojo.SearchBox2","mstrmojo.Booklet","mstrmojo.IncFetch","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.mstr.ui.IncFetchOBList");var O=mstrmojo.hash,W=mstrmojo.func,L=mstrmojo.meta.TP,F="5CECE58CC1D549F890EB61C4DB2156A3",T="E0CCB9CF22104A489CBE78D974AFD19E",Q=mstrmojo.chart.model.enums.EnumDSSObjectType,K=mstrmojo.array,D=mstrmojo.dom,X=function(f,g,a){var d=f.scrollableIncFetch,c=d?"mstrmojo.mstr.ui.IncFetchOBList":"mstrmojo.OBList",e={scriptClass:c,items:g.items,multiSelect:a};if(d){e.browseConfig={blockBegin:g.bb,blockCount:g.bc,totalSize:g.sz,folderLinksContextId:f.folderLinksContextId,rootFolderID:g.did,browsableTypes:f.browsableTypes,browsableViewMedias:f.browsableViewMedias,dataProvider:f.dataProvider};e.onwaitingChange=function(){if(f.booklet){f.booklet.set("waiting",this.waiting);}};}var b=mstrmojo.insert(e);b.render();return b;},A=function(c,d,a){var b=mstrmojo.ObjectBrowser.widgetHandler||X;return b(c,d,a);},N={success:function(c){var d=this.ob,b=c.items,e=d.pageCache[d.currentPage],a=e._w;e.items=b;a.set("items",b);this.ob=null;this.item=null;window.clearTimeout(d._btm);d.booklet.set("waiting",false);if(d.scrollableIncFetch&&a.scrollNode){a.initScroll();a.updateScrollbars();}},failure:function(a){window.alert(a.getResponseHeader("X-MSTR-TaskFailureMsg"));this.ob.booklet.set("waiting",false);}},S=function(f,e,c){var d=c?-1:1,b=f.pageCache.length,g;for(g=f.currentPage+d;g<b&&g>=0;g+=d){var a=f.pageCache[g];if(a._k===e.k){return{steps:g-f.currentPage,cache:a};}}return null;},C=function(e,d,c,f){var g=e.currentPage+1,b=e.pageCache.length,a;for(a=g;a<b;a++){e.pageCache[a]._w.destroy();delete e.pageCache[a].items;}e.pageCache=e.pageCache.slice(0,g);f._w=c;f._k=d.k;e.pageCache[g]=f;e.cacheChange();},H=function(b){var a=mstrmojo.hash.walk("anc.items.0.items",b);this.set("canGoUp",!(!b.pf||!a));},I=function(e,d,f,c,b){delete e._btm;var a;if(!c){a=A(e,f,e.multiSelect);a.attachEventListener("change",e.id,"navigate");if(e.useDblSelect||e.useBothSglDblSelect){a.attachEventListener("dblclick",e.id,"dblselect");}}else{a=f._w;}e.obList=a;e.booklet.turn(a,b>0);window.setTimeout(function(){e.onBrowsing=false;},300);if(!c){C(e,d,a,f);}e.set("currentFolder",f);e.set("currentPage",e.currentPage+b);e.updateUpButton(f);if(e.scrollableIncFetch&&a.scrollNode){a.initScroll();a.updateScrollbars();}},P=function(c,b,a){var d=S(c,b,false);d=d||S(c,b,true);if(!d){window.clearTimeout(c._btm);c._btm=window.setTimeout(function(){c.booklet.set("waiting",true);},300);a.ob=c;a.item=b;c.getDataProvider().fetchFolderContents(c,b,a);}else{I(c,b,d.cache,true,d.steps);}},B=function(b,c,d,a){P(b,{fid:b.pageCache[b.currentPage].did,blockBegin:c,searchPattern:d,recursive:a},N);},J={success:function(b){var c=this.ob;if(c){window.clearTimeout(c._btm);if(!b.items){b.items=[{did:"empty",n:"("+mstrmojo.desc(2210)+")",t:"e"}];}var a=function e(f){var j=f.length,g;for(g=0;g<j;g++){var h=f[g];if(h.did===F||h.did===T){h.n=(h.did===F)?mstrmojo.desc(8112):mstrmojo.desc(9277);}if(h.items){a(h.items);}}};if(b.did===F||b.did===T){b.n=(b.did===F)?mstrmojo.desc(8112):mstrmojo.desc(9277);if(b.anc&&b.anc.items){a(b.anc.items);}}if(b&&b.items&&c.browsableViewMedias){var d={};K.forEach(c.browsableViewMedias.split(","),function(f){d[parseInt(f,10)]=true;});b.items=K.filter(b.items,function(f){return(f.t!==Q.DssTypeDocumentDefinition)||d[f.dvm];});}if(b&&b.items&&mstrApp&&mstrApp.isSingleTier){b.items=K.filter(b.items,function(f){return(f.st!==772);});}if(b.did&&this.item.k!==b.did){this.item.k=b.did;}I(c,this.item,b,false,1);this.ob=null;this.item=null;}},failure:function(a){this.ob.booklet.set("waiting",false);if(this.ob.onError){this.ob.onError(a);}else{if(a.getResponseHeader){mstrmojo.alert(a.getResponseHeader("X-MSTR-TaskFailureMsg"));}else{mstrmojo.alert(a.message);}}},complete:function(){if(this.ob){this.ob.onBrowsing=false;}}},Z=function(c){var b=c.pageCache.length,a;for(a=0;a<b;a++){c.pageCache[a]._w.destroy();}c.pageCache=[];c.currentPage=-1;c.cacheChange();},M=function(d,c,e){var a=d.onBrowseFolder;if(a){a[0][a[1]](c);}if(c&&parseInt(c.acg,10)===33){return ;}var b={};if(c){b.k=c.did;b.fid=c.did;}else{if(d.rootFolderID){b.k=d.rootFolderID;b.fid=d.rootFolderID;}else{if(d.rootFolderType){b.k=d.rootFolderType;b.fty=d.rootFolderType;}else{if(d.folderLinksContextId){b.k=d.folderLinksContextId;}}}}P(d,b,W.wrapMethods(e,O.copy(J)));},V=function(f,a,c){if(!c){return a;}var d=f.showCompletePath,h=a[0],e,b;while(h){var g;for(g=c.length-1;g>=0;g--){if(h.did===c[g].did){c.splice(g,1);h._isSc=true;}}b=h;h._open=true;h=h.items;h=h&&h[0];if(!h){b.lastLeaf=true;}}if(!d){h=a[0];while(h){if(h._isSc){a[0]=h;break;}h=h.items;h=h&&h[0];}}return a.concat(c);},U=function(b,a,c){b._naviInfo=V(b,a,c);};mstrmojo.ObjectBrowser=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.ObjectBrowser",rootFolderType:null,rootFolderID:null,sId:null,closeOnSelect:true,browsableTypes:null,browsableViewMedias:null,includeObjectDesc:false,closeable:true,fishEyeVisible:false,searchVisible:true,upButtonVisible:false,currentFolder:null,pageCache:[],currentPage:-1,blockCount:50,canGoUp:true,folderLinksContextId:null,minSearchLength:2,showCompletePath:true,multiSelect:false,onCloseCB:null,onSelectCB:null,onBrowseFolder:null,scrollableIncFetch:false,useBothSglDblSelect:false,displaySaveLabel:false,useOldSearch:false,getDataProvider:function(){if(!this.dataProvider){this.dataProvider=mstrmojo.insert({scriptClass:"mstrmojo.ObjectBrowserDataProvider"});}return this.dataProvider;},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{scriptClass:"mstrmojo.HBox",alias:"titleBar",cssClass:"mstrmojo-OB-titleTable",children:[{alias:"saveLabel",scriptClass:"mstrmojo.Label",cssClass:"msrmojo-save-label",text:mstrmojo.desc(3178,"Save in:"),bindings:{visible:"this.parent.parent.displaySaveLabel"}},{alias:"title",scriptClass:"mstrmojo.DropDownButton",cssClass:"mstrmojo-FormatEditor-DropDownButton",cssText:"margin:0px;",popupRef:{scriptClass:"mstrmojo.Popup",contentNodeCssClass:"mstrmojo-OBNavigatorPopup",cssText:"position:relative;",slot:"popupNode",locksHover:true,onOpen:function(){var a=this.opener.parent.parent,d=this.tree,c=a._naviInfo,b=this.parent.parent.parent.extraDDItems;if(d.items!==c){d._pup=this;this.ob=a;if(b){K.forEach(b,function(e){e.isExtra=true;});c=c.concat(b);}d.set("items",c);}},children:[{alias:"tree",scriptClass:"mstrmojo.WidgetTree",itemIdField:"did",itemFunction:function(e,a,b){var d=mstrmojo.WidgetTree.prototype.itemFunction(e,a,b);if(e.isExtra){if(e.cssClass){d.cssClass=e.cssClass;}d.onmousedown=e.onmousedown||mstrmojo.emptyFn;return d;}if(e._open){d.state=1;}d._ll=!!e.lastLeaf;d._pup=b._pup;d.onmousedown=function(f){var g=mstrmojo.dom.eventTarget(f.hWin,f.e),h=this._pup;if(g===this.domNode||g===this.textNode){if(!this._ll){M(h.ob,this.data);}h.close();}};d.markupMethods=O.copy(d.markupMethods);d.markupMethods.onstateChange=function(){var f=this.data.items?this.state:0;this.stateNode.className="mstrmojo-TreeNode-state "+({0:"closed",1:"opened",2:"leaf"}[f]||"closed");this.itemsContainerNode.style.display=(f===1)?"block":"none";};d.useRichTooltip=true;var c=d.postBuildRendering;d.postBuildRendering=function(){if(c){c.call(d);}if(d.textNode.parentNode.clientWidth){d.textNode.style.width=(d.textNode.parentNode.clientWidth-20)+"px";}};d.premouseover=function(h){if(this.useRichTooltip){var g=this.textNode;if(g.clientWidth<g.scrollWidth){var f=D.position(g);this.richTooltip={areaId:this.id,cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.data[this.itemDisplayField],top:f.y-2,left:f.x+f.w+6};}else{this.richTooltip=null;}mstrmojo.dom.stopPropogation(h.hWin,h.e);}return true;};return d;}}]}},{alias:"upButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-OBListItemIcon up",title:mstrmojo.desc(1152,"Up One Level"),onclick:function(){this.parent.parent.goUp();},bindings:{enabled:"this.parent.parent.canGoUp",visible:"this.parent.parent.upButtonVisible"}},{alias:"closebtn",scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-OBCloseButton",title:mstrmojo.desc(2102,"Close"),bindings:{visible:"this.parent.parent.closeable"},onclick:function(){this.parent.parent.close();}}]},{alias:"fishEye",scriptClass:"mstrmojo.FishEyeContainer",cssText:"width:100%",bindings:{visible:"this.parent.fishEyeVisible"}},{alias:"searchUpBar",scriptClass:"mstrmojo.HBox",cssClass:"searchBox",children:[{alias:"obSearchBox",scriptClass:"mstrmojo.SearchBox2",cssClass:"mstrmojo-charcoalbox mstrmojo-dxsprite",cssText:"margin: 3px 0; ",contentWidget:mstrmojo.all.obList,taskId:"searchMetadata",searchIncFetch:true,enableMatchCase:false,forceResetCache:true,bindings:{minSearchLength:"this.parent.parent.minSearchLength",quickSearch:"this.parent.parent.quickSearch"},serverRequest:function(a,b){this.parent.parent.getDataProvider().serverRequest(a,b);},preFetch:function(){this.objectTypes=this.parent.parent.browsableTypes||this.objectTypes;this.parent.parent.booklet.set("waiting",true);},postFetch:function(){this.parent.parent.booklet.set("waiting",false);},onUpdateSearchParams:function G(c){var b=this.parent.parent,a=b.sId;if(a){c.sessionState=a;}if(b.useOldSearch){c.quickSearch=0;c.nameWildcards=1;c.sortKey=6;}}}],bindings:{visible:"this.parent.searchVisible"}},{scriptClass:"mstrmojo.Booklet",cssClass:"mstrmojo-OB-booklet",alias:"booklet",hasAnimation:false,bindings:{scrollableIncFetch:"this.parent.scrollableIncFetch"}},{alias:"obIncFetch",scriptClass:"mstrmojo.IncFetch",height:"17px",cssText:"height:0px;overflow:hidden;",visible:false,np:0,cp:0,ds:{f:mstrmojo.desc(4046,"First"),p:mstrmojo.desc(1058,"Previous"),n:mstrmojo.desc(1059,"Next"),l:mstrmojo.desc(4049,"Last"),pgs:mstrmojo.desc(5972,"## of ### pages"),gt:mstrmojo.desc(5878,"Go to:"),v:mstrmojo.desc(6079,"This field should be # between ## and ###.")},onvisibleChange:function(b){var d=parseInt(this.height,10),a=this.np>1,c={target:this.domNode,props:{height:{start:(a?0:d),stop:(a?d:0),suffix:"px"}},onEnd:function(){if(a){this.target.style.overflow="visible";}}},e=new mstrmojo.fx.AnimateProp(c);this.domNode.style.overflow="hidden";mstrmojo.css.toggleClass(this.parent.domNode,"show-inc-fetch",this.visible);e.play();},onifsChange:function(a){var b=this.np;mstrmojo.hash.copy(a.value,this);if(this.np>1){this.children=null;this.refresh();}if((b<=1&&this.np>1)||(b>1&&this.np<=1)||(b===0&&this.np>0)){this.set("visible",this.np>1);}this.cssText="";}}],destroy:function Y(){Z(this);if(this._super){this._super();}},postBuildRendering:function(){if(this._super){this._super();}if(this.fishEye&&this.fishEyeVisible){this.fishEye.attachEventListener("selectedIndexChange",this.id,"onFishEyeChange");}var c=this.searchUpBar;if(c&&c.obSearchBox&&this.searchVisible){this.obSearchBox=this.searchUpBar.obSearchBox;this.obSearchBox.attachEventListener("itemsChange",this.id,"onSearchItemsChange");var a=this.obSearchBox.contentWidget||this.obSearchBox;if(!this.scrollableIncFetch){a.attachEventListener("ifsChange",this.id,function(d){if(!this.scrollableIncFetch){this.obIncFetch.set("ifs",d.value);}});}}if(!this.scrollableIncFetch&&this.obIncFetch){var b=this.obIncFetch;b.attachEventListener("fetch",this.id,function(d){b.cp=d.v;b.children=null;b.refresh();B(this,(d.v-1)*this.blockCount+1,this.searchVisible?this.obSearchBox.inputNode.value:"",1);});}mstrmojo.css.addClass(this.domNode,"mstrmojo-ObjectBrowser");},onSearchItemsChange:function(b){var c=b.value,a=this.pageCache[this.currentPage]._w;if(!c||c.length===0){c=[{did:"empty",n:"("+mstrmojo.desc(2210,"")+")",t:"e"}];}else{if(this.browsableViewMedias){var d={};K.forEach(this.browsableViewMedias.split(","),function(e){d[parseInt(e,10)]=true;});c=K.filter(c,function(e){return(e.t!==Q.DssTypeDocumentDefinition)||d[e.dvm];});}}a.set("items",c);},navigate:function(h){var a=h.src,i=a.selectedItem,c=this.multiSelect,f=c&&a.getSelectedItems(),g=this,b=h.added&&h.added.length,e=h.removed&&h.removed.length,d=c?f.length===1&&(!e||b):!!i;if(d&&i.did==="empty"){return ;}if(d&&parseInt(i[L],10)===8){if(!this.onBrowsing){this.onBrowsing=true;M(this,i);}}else{if((i&&(!this.useDblSelect||this.useBothSglDblSelect))||f){this.select(c?f:i);}}},browseFolder:function(a,b){M(this,{did:a,n:b});},onFishEyeChange:function(a){this.goToPage(a.value);},goToPage:function(a){if(a<this.pageCache.length&&a!==this.currentPage){var c=a>this.currentPage,b=this.pageCache[a];this.set("currentPage",a);this.booklet.turn(b._w,c);this.set("currentFolder",b);H.call(this,b);}},oncurrentPageChange:function(a){if(this.fishEye){this.fishEye.setSelectedIndex(a.value);}var b=this.pageCache[this.currentPage];this.titleBar.title.set("text",mstrmojo.string.encodeHtmlString(b.n));if(this.searchVisible&&this.obSearchBox){this.obSearchBox.set("rootCacheItems",b.items||[]);this.obSearchBox.set("totalSize",b.sz);this.obSearchBox.set("rootID",b.did);this.obSearchBox.clearSearch();}if(!this.scrollableIncFetch&&this.obIncFetch){this.obIncFetch.set("ifs",{np:Math.floor(b.sz/b.bc)+((b.sz%b.bc>0)?1:0),cp:Math.floor(b.bb/b.bc)+((b.bb%b.bc>0)?1:0)});}},cacheChange:function(){if(this.fishEye&&this.fishEyeVisible){this.fishEye.setItems(this.pageCache);}},browse:function(b,a){O.copy(b,this);if(this.searchVisible&&this.obSearchBox){this.obSearchBox.clear();}Z(this);M(this,undefined,a);},close:function(){var b=this.ctx||this,a=b.onCloseCB;if(a){a[0][a[1]]();}b.set("visible",false);},select:function(b){var a=this.onSelectCB;if(a){a[0][a[1]](b);}if(this.closeOnSelect){this.close();}},dblselect:function R(b){var c=b&&b.src.selectedItem;if(!c||(c&&c.did==="empty")||c[L]===8){return ;}if(this.useBothSglDblSelect){var a=this.onDblSelectCB;if(a){a[0][a[1]](c);}if(this.closeOnSelect){this.close();}}else{this.select(c);}},goUp:function(){if(this.canGoUp){M(this,{did:this.currentFolder.pf});}},updateUpButton:function E(a){H.call(this,a);},oncurrentFolderChange:function(a){var b=a.value;U(this,b.anc.items,b.sc);},refreshContent:function(a){B(this,a);},onError:null,onheightChange:function(){var a=["titleBar","fishEye","searchUpBar","obIncFetch"],c=0,b;for(b in a){c+=parseInt(this[a[b]].domNode.offsetHeight,10);}this.booklet.set("height",parseInt(this.height,10)-c+"px");}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo._ValidateSuggestions","mstrmojo.WidgetList","mstrmojo.Editor","mstrmojo.LegacySuggestionList");mstrmojo.Enum_OIB_States=mstrmojo.hash.copy(mstrmojo._ValidateSuggestions.ENUM_STATES,{EDITING:2,ADDING:3,EMPTY:4});mstrmojo.Enum_OIB_States_CSS=(function(){var AB=mstrmojo.Enum_OIB_States,AA={},AC;for(AC in AB){if(AB.hasOwnProperty(AC)){AA[String(AB[AC])]=AC;}}return AA;}());var Q=mstrmojo.dom,S=mstrmojo.hash,Z=mstrmojo.Enum_OIB_States,I=0,b="_did_",w=mstrmojo.Enum_Keys,y=80,U=200;function P(){return I++;}function g(AA){return(AA&&AA.state===Z.ADDING);}function o(AA){var AB={n:AA||"",state:Z.EMPTY};AB[b]=-2;return AB;}function O(AA){return(AA&&AA.state===Z.EMPTY);}function t(AB){var AC=AB.items,AA=AC&&AC.length;if(!AA){return true;}return(AA===1&&g(AC[0]))||(AA===2&&O(AC[0])&&g(AC[1]));}function k(){var AB=this.ctxtBuilder.itemWidgets,AA=AB[AB.length-1];if(AA&&AA.isAdding){var AC=this;Q.attachEvent(AA.domNode,"click",function(){AC.editingIdx=null;});return AA;}return null;}function L(){var AA=this.editingIdx;if(AA!==null){return this.ctxtBuilder.itemWidgets[AA];}return k.call(this);}function D(){this.isActive=false;var AB=this.emptyText||"",AC=this.items;if(t(this)&&!O(AC[0])&&(AB.length>0)){this.add([o(AB)],0);var AD=this.ctxtBuilder.itemWidgets[0];AD.set("shouldEllipsize",true);AD.doEllipsize();}var AA=L.call(this);if(AA){if(g(AA)&&this.showEmptyItem){AA.domNode.style.display="none";}this.scrollTo(this.items[0]);AA.blur();}Q.detachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.detachEvent(AA.inputNode,"keydown",this._tabKeyHander);}}function N(){if(!this.enabled){return ;}this.isActive=true;if(O(this.items[0])){this.remove(0);}var AA=L.call(this);if(AA){if(g(AA)&&!this.isFull){AA.domNode.style.display="block";}this.scrollTo(AA.data);AA.focus();}Q.attachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.attachEvent(AA.inputNode,"keydown",this._tabKeyHander);}}mstrmojo.ObjectInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._ValidateSuggestions],{scriptClass:"mstrmojo.ObjectInputBox",cssClass:"mstrmojo-ObjectInputBox",emptyText:"",showEmptyItem:true,items:null,itemField:"n",dynamicVerify:true,suggestCount:10,candidates:null,makeObservable:true,renderOnScroll:false,editingIdx:null,isActive:false,maxObjectCount:null,isFull:false,suggestionListClass:"mstrmojo.LegacySuggestionList",acptSugItemOnly:false,useKeyDelay:false,showSuggestionOnEdit:true,tabNavigable:false,getSearchPattern:function(){var AA=L.call(this);if(AA){return AA.getSearchPattern();}return"";},getSuggestionTarget:function l(){return this.suggestTarget;},onsuggestTargetChanged:function n(AA){this._request_pattern=null;},getSuggestionPos:function c(){return this._pop_cfg;},onSuggestionItemSelect:function u(AA){if(this.suggestTarget){this.suggestTarget.setItem(AA[this.itemField],AA,false);}this.hideSuggestion();this.closePopup();},hideEditButton:function(AA){return !!this.noEditButton;},_set_items:function j(AF,AC){AC=mstrmojo.hash.clone(AC)||[];var AE=this.maxObjectCount;this.set("isFull",(AE&&AC.length>=AE));if(AC.length===0){var AB=this.emptyText||"";if(AB.length>0){AC.push(o(AB));}}var AD={n:"",state:Z.ADDING};AD[b]=-1;AC.push(AD);var AA=AC[AC.length-1];if(AA&&g(AA)&&this.maxObjectCount&&(this.getSelectedObjects().length>=this.maxObjectCount)){this.set("isFull",true);}this.itemIdField=b;return this._super(AF,AC);},add:function E(AB,AA){var AC=k.call(this);if(!this.maxObjectCount||this.getSelectedObjects().length<this.maxObjectCount){this._super(AB,AA);}if(!t(this)&&O(this.items[0])){this.remove(0);}if(AC){AC.adjustInputWidth();if(this.maxObjectCount&&(this.getSelectedObjects().length===this.maxObjectCount)){this.set("isFull",true);AC.domNode.style.display="none";}else{AC.domNode.style.display=this.showEmptyItem?"none":"";}}},remove:function a(AA){this._super(AA);var AB=k.call(this);if(AB){if(this.maxObjectCount&&(this.getSelectedObjects().length<this.maxObjectCount)){this.set("isFull",false);}AB.adjustInputWidth();}},preBuildRendering:function(){if(this.items==null||this.items.length==0){this.set("items",[]);}if(this._super){this._super();}},postBuildRendering:function Y(){this._super();var AB=this,AA=k.call(AB);if(AA&&(this.showEmptyItem||this.isFull)){AA.domNode.style.display="none";}this._clickHandler=function(){N.call(AB);};this._mousedownHandler=function(AC){if(!AB.isActive||AB.browserShown){return ;}var AD=Q.eventTarget(self,AC);if(AD&&AD.parentNode&&!Q.contains(L.call(AB).domNode,AD,false,document.body)&&!Q.contains(AB.suggestionPopup.domNode,AD,false,document.body)){D.call(AB);}};if(this.tabNavigable){this._tabKeyHander=function(AC){var AD=parseInt(AC.keyCode||AC.charCode,10);if(AD===w.TAB){if(!AB.isActive||AB.browserShown){return ;}D.call(AB);}};}Q.attachEvent(this.domNode,"click",this._clickHandler);},nextId:P,item2textCss:function M(AA){return AA.cssClass||"";},itemFunction:function G(AC,AA,AB){AC[AB.itemIdField]=P();var AD=new mstrmojo.ObjectItem({parent:AB,itemField:AB.itemField,cssClass:AB.item2textCss(AC),data:AC,showSuggestionOnEdit:this.showSuggestionOnEdit,enabled:AB.enabled});AB.attachEventListener4ItemWidget(AD,AB);return AD;},attachEventListener4ItemWidget:function h(AE,AC){var AB=["ItemEditBegin","ItemEditEnd","ItemDeletePrev","ItemDelete","ItemAdd","SuggestionOn","SuggestionOff","ItemEditing"],AA=AB.length,AD;for(AD=0;AD<AA;AD++){AE.attachEventListener(AB[AD],AC.id,"_itemChangeHandler");}return AE;},getSelectedObjects:function i(){if(t(this)){return[];}var AA=this.items,AB=AA.length-1;if((AB>-1)&&g(AA[AB])){return AA.slice(0,AB);}return AA.concat();},isValid:function C(){var AB=this.ctxtBuilder.itemWidgets,AA=AB&&AB.length,AC;for(AC=0;AC<AA;AC++){if(!AB[AC].isValid()){return false;}}return true;},isEmpty:function V(){return t(this);},_itemChangeHandler:function(AD){var AF=AD.name,AG=AD.d,AB,AA=this.items.length,AC;switch(AF){case"ItemEditBegin":if(this.editingIdx!==null){AC=L.call(this);if(AC){AC.blur();}}AB=this.itemIndex(AG);this.editingIdx=AB;N.call(this);break;case"ItemEditEnd":this.editingIdx=null;if(AD.deactivate){D.call(this);}else{N.call(this);}AC=k.call(this);if(AC){AC.adjustInputWidth();}break;case"ItemDelete":if(this.editingIdx!==null){AC=L.call(this);if(AC){AC.blur();}this.editingIdx=null;}AB=this.itemIndex(AG);this.remove(AB);if(!AD.deactivate){this.editingIdx=null;N.call(this);}else{if(!this.isActive){D.call(this);}else{N.call(this);}}break;case"ItemDeletePrev":if(AA>1){this.remove(AA-2);}break;case"ItemAdd":var AE=S.copy(AD.d);this.add([AE],AA-1);if(AD.deactivate){D.call(this);}else{N.call(this);}break;case"SuggestionOn":this.set("suggestTarget",AD.target);this._pop_cfg={target:AD.target,left:AD.l,top:AD.t,zIndex:this.zIndex?this.zIndex:100};this.showSuggestion(AD.pattern);break;case"SuggestionOff":this.set("suggestTarget",null);this.hideSuggestion();break;}if(this.onitemchange&&(AF==="ItemEditEnd"||AF==="ItemAdd"||AF==="ItemDelete"||AF==="ItemDeletePrev"||AF==="ItemEditing")){this.onitemchange();}},unrender:function B(AB){var AA=this.suggestionPopup;if(AA.hasRendered){AA.unrender(false);}if(this._super){this._super(AB);}},destroy:function r(AB){var AA=this.suggestionPopup;if(AA&&AA.hasRendered){AA.destroy(false);}if(this._super){this._super(AB);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ObjectInputBox,{onenabledChange:mstrmojo.Widget.enabledMarkupMethod});mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasEllipsis");var p="mstrmojo-ObjectItem-text";mstrmojo.ObjectItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasEllipsis],{scriptClass:"mstrmojo.ObjectItem",markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode"><span title=" {@title}" class="'+p+' {@cssClass}"></span><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])"/></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" mstrAttach:keyup,keydown/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},editButtonNode:function(){return this.domNode.firstChild.childNodes[1];},delButonNode:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},markupMethods:{oncssClassChange:function(){this.textNode.className=p+" "+this.cssClass;},onstateChange:function(){var AD=this.state,AC=mstrmojo.Enum_OIB_States_CSS[AD],AB=this.domNode;if(AD===Z.EMPTY){AB.innerHTML=this.enabled?'<div class="mstrmojo-ObjectItem-emptyText">'+this.text+"</div>":"";}else{if(AD===Z.EDITING){var AA=Math.round(this.displayNode.clientWidth);this.editNode.style.width=AA-4+"px";this.inputNode.style.width=AA-9+"px";}}AB.className="mstrmojo-ObjectItem "+AC;this.updateButtonsVisibility(this.data);},ontextChange:function(){this.inputNode.value=this.text;this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);}},updateButtonsVisibility:function z(){if(this.parent.hideEditButton(this.data)){this.editButtonNode.style.display="none";}},state:Z.VALID,onstateChange:function e(AA){this.data.state=this.state;},ontextChange:function H(AA){this.data[this.itemField]=this.text;},updateData:function F(AA){S.copy(AA,this.data);this.set("state",Z.VALID);this.set("text",this.data[this.itemField]);this.set("cssClass",this.parent.item2textCss(this.data));},init:function v(AB){this._super(AB);var AD=this.data,AA=AD.state,AC=this.parent;AA=this.initState();this.cssClass=AC.item2textCss(AD);this.text=AD[this.itemField];this.state=AA;this.isAdding=g(AD);this.useRichTooltip=true;this.title=this.text;},initState:function K(){var AB=this.parent,AC=this.data,AA=AC.state;if(AC&&AC.did){AC.state=Z.VALID;return AC.state;}if(typeof AA==="undefined"){AA=AB.dynamicVerify?AB.verifyObject(AC[this.itemField],this):Z.UNDETERMINED;AC.state=AA;}return AA;},isValid:function C(){var AA=parseInt(this.state,10);return(AA!==Z.INVALID&&AA!==Z.UNDETERMINED);},adjustInputWidth:function A(){if(this.isAdding){var AD=this.inputNode.style;AD.width=y+"px";var AC=this.domNode.parentNode,AA=AC.parentNode.offsetWidth,AB=Math.max(AA-AC.offsetLeft-20,y);if(!isNaN(AB)){AD.width=AB+"px";}}},blur:function T(){this.hideSuggestion();if(!this.isActive){return ;}this.isActive=false;var AC=this.inputNode,AA=AC.value,AB=this.parent;window.setTimeout(function(){try{AC.blur();}catch(AD){}},0);if(!AA){return ;}if(AB.acptSugItemOnly&&this._tWas_){this.set("text",AA);this.set("text","");this._tWas_=null;return ;}this.setItem(AA,null,true);},focus:function q(){var AB=this.inputNode,AA=this.isActive;window.setTimeout(function(){try{AB.focus();if(AB.createTextRange&&!AA){var AD=AB.createTextRange(),AC=AB.value.length;AD.move("character",AC);AD.select();}else{if(AB.setSelectionRange&&!AA){var AC=AB.value.length;AB.setSelectionRange(AC,AC);}}}catch(AE){}},0);this.isActive=true;},prekeydown:function J(AA){var AC=this.inputNode.value,AB=parseInt(AA.e.keyCode||AA.e.charCode,10),AE=this.parent;if(!AC){return ;}if(AB===w.TAB||AB===w.ENTER){if(AB===w.ENTER){Q.preventDefault(AA.hWin,AA.e);}var AD=AE.getSelected();if(AD&&AD.did){AE.handleSuggestionItemSelect(AD);}else{this.hideSuggestion();if(!AE.acptSugItemOnly){this.setItem(AC,null,false);}else{this.set("text",AC);this.set("text","");}}}else{if(AB===w.DOWN_ARROW){if(!AE.noCache&&!AE.suggestionShown){this.showSuggestion(AC);AE.preHighlight();}AE.nextHighlight();}else{if(AB===w.UP_ARROW){AE.preHighlight();}}}},prekeyup:function x(AA){var AC=this.inputNode.value,AB=parseInt(AA.e.keyCode||AA.e.charCode,10),AF=this.isAdding,AE=this.parent;if(!AC){if(AF){if(AB===w.BACKSPACE&&!this._tWas_){this.raiseEvent({name:"ItemDeletePrev"});Q.preventDefault(AA.hWin,AA.e);}this._tWas_=null;}else{this.raiseEvent({name:"ItemDelete",d:this.data});}this.hideSuggestion();return ;}if(AB===w.ESCAPE||AB===w.TAB){this.hideSuggestion();if(AE.acptSugItemOnly){this.set("text",AC);this.set("text","");this._tWas_=null;return ;}}else{if(this._tWas_!==AC){this.textChanged=true;this.raiseEvent({name:"ItemEditing",d:this.data});if(AE.useKeyDelay){window.clearTimeout(this._timerID);var AD=this;this._timerID=window.setTimeout(function(){var AG=AD.inputNode.value;if(AG){AD.showSuggestion(AG);}AD._timerID=null;},U);}else{this.showSuggestion(AC);}}}this._tWas_=AC;},setItem:function(AA,AC,AB){var AD=this.isAdding;AB=AB||false;this.set("text",AA);if(AD){this.setItem_Adding(AA,AC,AB);}else{this.setItem_Editing(AA,AC,AB);}this._tWas_=null;},setItem_Adding:function(AA,AC,AB){this.set("text","");if(!AC){AC={};AC[this.itemField]=AA;}else{AC.state=Z.VALID;}this.raiseEvent({name:"ItemAdd",d:AC,deactivate:AB});},setItem_Editing:function(AA,AC,AB){var AD=this.parent;this.set("text",AA);if(AC){this.updateData(AC);}else{if(this.textChanged){var AE={};AE[b]=this.data[b];delete this.data.did;this.data=AE;this.textChanged=false;}this.set("state",AD.verifyObject(AA,this));this.set("cssClass",AD.item2textCss(this.data));}this.isActive=false;this.raiseEvent({name:"ItemEditEnd",d:AC,deactivate:AB});},getSearchPattern:function W(){return this.inputNode.value;},showSuggestion:function m(AA){var AB=mstrmojo.dom.position(this.domNode,true);this.raiseEvent({name:"SuggestionOn",l:Math.round(AB.x)+"px",t:Math.round(AB.y+AB.h)+"px",pattern:AA,target:this});},hideSuggestion:function f(){this.raiseEvent({name:"SuggestionOff"});},del:function R(AA){AA=AA||self.event;Q.stopPropogation(self,AA);this.raiseEvent({name:"ItemDelete",d:this.data,deactivate:true});if(this.useRichTooltip&&this.hideTooltip){this.hideTooltip();}},edit:function X(){this.set("state",Z.EDITING);this.raiseEvent({name:"ItemEditBegin",d:this.data});if(this.showSuggestionOnEdit){this.showSuggestion(this.text);}},doEllipsize:function d(){if(!this.shouldEllipsize){return ;}var AB=this.maxItemWidth,AA;if(AB){this.domNode.style.maxWidth=AB;switch(parseInt(this.state,10)){case Z.VALID:case Z.UNDETERMINED:case Z.INVALID:AA=this.textNode;break;case Z.EMPTY:AA=this.domNode.firstChild;break;}if(AA){this.set("richTooltip",{content:this.text,contentNodeCssClass:"sp-tooltip",posType:mstrmojo.tooltip.POS_TOPLEFT,left:0,top:30,refNode:this.domNode});mstrmojo.css.addClass(AA,"truncated");}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ME.TokenInputBox");mstrmojo.requiresDescs(13542,13543);var B=mstrmojo.array;var L={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3,AMBIGUITY:4},G={0:"valid",1:"unknown",2:"validating",3:"error",4:"ambiguity"},H={0:mstrmojo.desc(9565,"Valid Metric Formula."),1:mstrmojo.desc(9106,"Require Validation?"),2:mstrmojo.desc(9566,"Validation in Progress..."),3:mstrmojo.desc(9567,"Validation Failed with Syntax Error!"),4:mstrmojo.desc(9568,"Validation Failed with Object Ambiguity!")};function D(O){if(!O){return L.VALID;}return{"-2147214845":L.ERROR,"-2147214846":L.AMBIGUITY}[O]||L.ERROR;}mstrmojo.ME.MetricEditBox=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.MetricEditBox",vStatus:L.VALID,iStatus:"",showStatus:true,browseItemVisible:true,absorbAmbiguity:true,isObjectVisible:function(O){return true;},markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-MEBox-edit"></div><div class="mstrmojo-MEBox-status {@statusCssClass}"><div class="mstrmojo-MEBox-vStatus"></div><div class="mstrmojo-MEBox-iStatus"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},iStatusNode:function(){return this.domNode.lastChild.lastChild;},vStatusNode:function(){return this.domNode.lastChild.firstChild;}},markupMethods:{onvStatusChange:function(){var P=this.vStatus,O=this.vStatusNode;O.className="mstrmojo-MEBox-vStatus "+G[P];O.innerHTML=(this.getStatusDesc&&this.getStatusDesc(P))||H[P]||"";},oniStatusChange:function(){this.iStatusNode.innerHTML=this.iStatus;this.iStatusNode.title=this.iStatus;}},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",renderOnScroll:false,renderBlockSize:0,bindings:{browseItemVisible:"this.parent.browseItemVisible",candidates:"this.parent.candidates"}}],init:function N(O){if(this._super){this._super(O);}this.statusCssClass=this.showStatus?"":"hidden";},getSearchPattern:function M(){return this.inputBox.getSearchPattern();},getHighlightedText:function I(P,O){return this.inputBox.getHighlightedText(P,O);},item2textCss:function F(O){return{4:"m",7:"am",11:"fx",12:"a",13:"fc",43:"tr",47:"cs"}[O.t]||"";},handleSuggestionItemSelect:function E(O){var P=this.abiguityDialog;if(O){P.onItemSelect(O);}P.close();},showDesc:true,showPath:true,abiguityDialog:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-ME-ambiguityDialog",onOpen:function(){this.set("title",mstrmojo.desc(13542,"Object Ambiguity - ##").replace("##",this.ambiguousName));this.list.clearSelect();this.list.set("items",this.items);this.list.singleSelect(0);this.label.set("text",mstrmojo.desc(13543,"More than one object with the name '##' were found.").replace("##",this.ambiguousName));},children:[{scriptClass:"mstrmojo.Label",alias:"label",text:""},{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",alias:"list",cssClass:"mstrmojo-ME-ambiguityList",bindings:{items:"this.parent.opener.suggestionItems"},onclick:function(O){mstrmojo._IsList.onclick.call(this,O);}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:mstrmojo.desc(547,"Select"),onclick:function(){var O=this.parent.parent;O.opener.handleSuggestionItemSelect(O.list.selectedItem);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]},defaultOnTokensModify:function(){this.set("vStatus",L.UNKNOWN);this.set("iStatus","");},postBuildRendering:function A(){this._super();this.inputBox.attachEventListener("tokensModify",this.id,"defaultOnTokensModify");this.inputBox.attachEventListener("tokensModify",this.id,"ontokensModify");},updateInputBoxItems:function K(O){this.inputBox.set("items",O.items);},replaceErrorToken:function C(O){this.inputBox.replaceErrorToken(O);},handleValidation:function J(O){if(!O){this.set("vStatus",L.ERROR);return ;}O.vs=D(O.rjec);this.set("vStatus",O.vs);this.set("iStatus",O.rjed||"");this.updateInputBoxItems(O);this.inputBox.focus();if(O.vs===L.AMBIGUITY){var W=this,T=O.items,S=B.find(T,"sta",-1),P=T[S].v,U=function(X){W.replaceErrorToken(X);W.set("iStatus","");W.set("vStatus",L.UNKNOWN);if(W.continueValidataion){W.continueValidataion();}};var Q=B.filter(O.srfd.items,this.isObjectVisible);var V=this.parent.candidates,R=V&&V.items;if(R){B.forEach(Q,function(Y){var X=B.find(R,"did",Y.did);if(X===-1){if(this.absorbAmbiguity){R.push(Y);}}else{Y.path=R[X].path;}});}if(Q.length===1){U(Q[0]);return ;}this.openPopup("abiguityDialog",{zIndex:100,items:Q,ambiguousName:P,onItemSelect:U});}else{if(this.postHandleValidation){this.postHandleValidation();}}}});mstrmojo.ME.MetricEditBox.VALIDATION_STATUS=L;}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.UnitList","mstrmojo.architect.ui.panels.ListPanel");var C="mstrmojo-ar-",A="tbbtn";mstrmojo.architect.ui.panels.BaseListPanel=mstrmojo.declare(mstrmojo.architect.ui.panels.ListPanel,null,{scriptClass:"mstrmojo.architect.ui.panels.BaseListPanel",cssClass:"baseListPanel",title:"",addTitle:"",init:function B(D){var E=this;this._super(D);this.addNewTitleButton({title:this.addTitle,cssClass:C+A+" addObject",onclick:function(){E.onItemAdd();}});},onItemAdd:mstrmojo.emptyFn,getContentWidget:mstrmojo.emptyFn()});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Dialog","mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.form","mstrmojo.LoginEditor");mstrmojo.requiresDescs(2699,7773,11812,11865,13380,13381,13382);var D=mstrmojo.desc(13382,"Your user session will time out due to inactivity in # ##."),S=60,M=false,G=null,A=null,H=null;function N(){return mstrApp.sessionState||microstrategy.sessionState;}function K(V,U){if(mstrApp.is508){for(var T in U){V.setAttribute(T,U[T]);}}}mstrmojo.SessionManager=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SessionManager",cssClass:"mstrmojo-SessionManager",width:"370px",title:mstrmojo.desc(11812,"Notification"),msgInterval:1,checkSessionInterval:20,zIndex:10000,maxSessionIdleTime:600,timeBeforeSessionTimeoutWarning:60,remainingTime:60,sessionTimedout:false,buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(13381,"Stay logged in"),function(){var T=this.parent.parent;if(A){T.keepSessionAlive();}T.hideMessage();},true,{onRender:function(){K(this.domNode,{tabindex:0,role:"button","aria-label":mstrmojo.desc(13381,"Stay logged in")});}}),mstrmojo.Button.newWebButton(mstrmojo.desc(13380,"Log out"),function(){this.parent.parent.hideMessage();mstrmojo.form.send({evt:3019,src:mstrApp.name+".3019"});},null,{onRender:function(){K(this.domNode,{tabindex:0,role:"button","aria-label":mstrmojo.desc(13380,"Log out")});}})],children:[{scriptClass:"mstrmojo.Label",alias:"message",cssClass:"mstrmojo-SessionManager-msg",text:"",allowHTML:true,ontextChange:function(){if(mstrApp.is508){this.refresh();var T=this.domNode;K(T,{tabindex:-1,role:"alert"});window.setTimeout(function(){T.focus();},0);}}}],postBuildRendering:function(){this._super();if(mstrApp.is508){this.msgInterval=10;K(this.editorNode,{role:"alertdialog",tabindex:-1});}},updateMsg:function B(U){var T;if(U>60){T=D.replace("##",mstrmojo.desc(2699,"minutes")).replace("#","<b>"+Math.ceil(U/S)+"</b>");}else{if(U>-1){T=D.replace("##",mstrmojo.desc(7773,"seconds")).replace("#","<b>"+U+"</b>");}else{T=mstrmojo.desc(11865,"Your session is expired.");}}this.message.text="";this.message.set("text",T);this.remainingTime=U;},showMessage:function F(T){this.updateMsg(T);this.set("visible",true);M=true;},hideMessage:function I(){if(A){window.clearInterval(A);A=null;window.clearInterval(H);H=null;}this.set("visible",false);M=false;},popupTimeoutWarning:function L(X){if(M){return ;}var V=this,W=(typeof X==="number")?X:V.timeBeforeSessionTimeoutWarning,T=W,U=mstrmojo.now();if(mstrApp.enableWarningSessionTimeout){if(!this.hasRendered){this.render();}this.showMessage(T);}window.clearInterval(A);A=window.setInterval(function(){if(T<1){window.clearInterval(A);A=null;window.setTimeout(function(){if(mstrApp.enableWarningSessionTimeout){V.gotoLogoutPage();}else{V.sessionTimedout=true;V.closeSession();}},200);}var Y=Math.round((mstrmojo.now()-U)/1000);T=W-Y;V.updateMsg(T);},this.msgInterval*1000);window.clearInterval(H);H=window.setInterval(function(){V.isSessionAlive();},this.checkSessionInterval*1000);},warningTimeoutTimer:function Q(T){var U=this;window.clearTimeout(G);G=window.setTimeout(function(){G=null;U.isSessionAlive();},(T-this.timeBeforeSessionTimeoutWarning)*1000);},isSessionAlive:function E(){var T=this,V={success:function(W){var X=parseInt(W,10);if(X!==-1){if(X>T.remainingTime){T.hideMessage();}if(X>T.timeBeforeSessionTimeoutWarning){T.warningTimeoutTimer(X);}else{T.popupTimeoutWarning(X);}}else{window.clearInterval(H);T.popupTimeoutWarning(0);}},failure:function(){mstrmojo.alert("Problems encountered during checking for whether session is alive. Connection is down or session already time out.");}},U={taskId:"isSessionAlive",notRestartSessionManager:true};mstrmojo.xhr.request("POST",mstrConfig.taskURL,V,U);},keepSessionAlive:function R(){var T=this,V={success:function(W){if(W){T.warningTimeoutTimer(T.maxSessionIdleTime);}else{T.sessionTimedout=true;mstrmojo.alert("Your session is expired.");}},failure:function(){mstrmojo.alert("Problems encountered during activating session. Connection is down or session already time out.");}},U={taskId:"keepSessionAlive"};mstrmojo.xhr.request("POST",mstrConfig.taskURL,V,U);},closeSession:function J(){var T=this;mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(){T.sessionTimedout=true;}},{taskId:"closeSessions",sessionStates:N(),notRestartSessionManager:true});},restart:function(){this.sessionTimedout=false;this.hideMessage();if(this.maxSessionIdleTime>this.timeBeforeSessionTimeoutWarning){this.warningTimeoutTimer(this.maxSessionIdleTime);}},start:function C(){var V=mstrConfig.lastMsgKey;if(this.maxSessionIdleTime>this.timeBeforeSessionTimeoutWarning){this.warningTimeoutTimer(this.maxSessionIdleTime);}var U=function(){window.localStorage.setItem("msg_recovery_notify"+V,1);};if(window.addEventListener){window.addEventListener("beforeunload",U);}else{window.attachEvent("onbeforeunload",U);}var T=window.sessionStorage;if(T){T.setItem("msg_browser_not_closed"+V,1);T.setItem("msg_user_login",0);}},openLoginEditor:function P(V){var U="LoginEditor",T=mstrmojo.all[U];if(!T){T=mstrmojo.insert({id:U,scriptClass:"mstrmojo.LoginEditor",config:{callback:{}},zIndex:10000});}T.config.callback=V;T.open();},gotoLogoutPage:function O(){mstrmojo.form.send({evt:3008,src:mstrApp.name+".3008",autoLoggedout:true,Server:mstrConfig.serverName,Port:mstrConfig.serverPort,Project:mstrConfig.projectName,loginReq:true},null,"POST");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.tabs.Tab","mstrmojo.dom","mstrmojo.css");var G=mstrmojo.dom,R=mstrmojo.array,d=mstrmojo.css,c="animate",W="31px";function X(){var i=window.Modernizr,h="transition";if(i.testProp(h)){return G.transEndEvtNames[i.prefixed(h)];}return null;}function D(h){return function(){this.menuNode.style.display=h?"block":"none";};}function I(h){return Math.min(h.offsetWidth-h.firstChild.offsetWidth,0);}function S(h){return h.isAlignRight?"right":"left";}function e(h,i){return parseInt(h.style[S(i)],10)||0;}function O(){var i=this.tabContainerNode,j=false,h=false;if(I(i)<0){var l=G.position(i),k=G.position(i.firstChild);j=(k.x<l.x);h=(k.x+k.w>l.x+l.w+0.1);}this.downBtnNode.style.display=j?"block":"none";this.upBtnNode.style.display=h?"block":"none";}function T(h,i){h=(h||[]);if(!h.filter){return R.filter(h,i);}return h.filter(i);}function Q(h,i){h=(h||[]);if(!h.map){return R.map(h,i);}return h.map(i);}function J(x,j){if(this.isStatic){return ;}var v=this.tabContainerNode,u=T(this.children,function(y){return y.isSelected;})[0],q=u&&u.domNode;if(!v||!q){return ;}var k=G.position(v),o=v.firstChild,w=I(v),l=e(o,this),i=Math.max(l,w);if(x){if(w<0){var n=G.position(q),p=n.x-k.x,t=n.x+n.w-(k.x+k.w),r=this.isAlignRight,h=function(y){i=r?i+y:i-y;};if(p<0){h(p);}else{if(t>0){h(t);}}}}if(i!==l){var m=X();if(j&&m){d.addClass(o,c);G.attachOneTimeEvent(o,m,function(){d.removeClass(o,c);});}o.style[S(this)]=Math.max(w,Math.min(i,0))+"px";}O.call(this);}function K(h){return h.hasOwnProperty("index");}function H(){var h=this.children,i=0;(h||[]).every(function(k,j){if(!K(k)){return false;}i++;k.index=j;return true;});(h||[]).every(function(j){if(!K(j)){return false;}j.total=i;return true;});}function B(l,i){var p=l.ENUM_CORNERS,m=[p.TOP_RIGHT,p.BOTTOM_RIGHT],n=this.parent;if(n.position!=="bottom"){m.reverse();}l.setAlignment(m[0],m[1]);var k=G.position(n.domNode),h=G.position(i),j=n.menuNode;var o=j.style;o.top=(h.y-k.y)+"px";o.left=(h.x-k.x)+"px";l.addPopupHandlers(n.id,D(true),D(false));l.hostId=n.id;l.hostElement=j;l.isHostedWithin=false;n.openPopup(l.newInstance());}function Y(h){h.raiseEvent({name:"TabsChange"});}mstrmojo.vi.ui.tabs.TabStrip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",markupString:'<div id="{@id}" class="mstrmojo-VITabStrip {@cssClass}" style="{@cssText}" ><div class="mstrmojo-VITabStrip-tabs"><div style="display:table"><div style="display:table-row"></div></div></div><div class="mstrmojo-VITabStrip-addBtn" mstrAttach:click><div></div></div><div class="mstrmojo-VITabStrip-downBtn" mstrAttach:click,mousedown><div></div></div><div class="mstrmojo-VITabStrip-upBtn" mstrAttach:click,mousedown><div></div></div><div class="mstrmojo-VITabStrip-menuHost"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{tabContainerNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.firstChild.firstChild.firstChild;},addBtnNode:function(){return this.domNode.childNodes[1];},addBtnImgNode:function(){return this.domNode.childNodes[1].firstChild;},downBtnNode:function(){return this.domNode.childNodes[2];},upBtnNode:function(){return this.domNode.childNodes[3];},menuNode:function(){return this.domNode.childNodes[4];},maskNode:function(){return this.domNode.lastChild;}},isStatic:false,isAlignRight:true,tabContainerNode:null,downBtnNode:null,upBtnNode:null,menuNode:null,position:"bottom",layoutConfig:{w:{tabContainerNode:"100%",addBtnNode:W},xt:true},onAppStateChange:function V(i){var h=mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;if(i.value===h||i.valueWas===h){this.layoutConfig.w.addBtnNode=mstrApp.appState===h?"0px":W;this.doLayout();}},setStatic:function U(h,i){this.isStatic=h;if(!h){J.call(this,true,i);}},setTabs:function C(j,h){this.removeChildren();var k=this,i=j.length;this.addChildren(Q(j,function(n,l){var m=n.k;return k.getTabCfg(j,n,{scriptClass:"mstrmojo.vi.ui.tabs.Tab",index:l,total:i,draggable:!!i,dropZone:!!i,k:m,isSelected:m===h,showTabMenu:B,tabMoved:function(p){var o=this.index;this.parent.moveTab(o,o+(p?-1:1),o);}});}));J.call(this,true);Y(this);},getTabs:function N(){return T(this.children,K);},getTabCfg:function F(i,j,h){return h;},deleteTab:function P(h){var n=this.id,m=this.children[h],l=X(),k=function(){var o=mstrmojo.all[n];o.removeChildren(m);m.destroy();H.call(o);O.call(o);Y(o);};if(l){var j=m.domNode.firstChild,i=j.style;i.width=j.offsetWidth+"px";window.setTimeout(function(){d.addClass(j,c);G.attachOneTimeEvent(j,l,k);i.width=0;},0);}else{k();}},buildRendering:function E(){this._super();d.toggleClass(this.domNode,"alignLeft",!this.isAlignRight);},postBuildRendering:function Z(){var h=this._super();J.call(this,true);return h;},doLayout:function A(){this._super();J.call(this);},setSelectedTab:function b(h){(this.children||[]).forEach(function(i){i.set("isSelected",i.k===h);});Y(this);},getSelectedTab:function M(){var k=null,j=this.children||[],h;for(h=0;h<j.length;h++){if(j[h].isSelected){k=j[h];break;}}return k;},onclick:function g(h){if(h.getTarget()===this.addBtnImgNode){this.addTab();}},addTab:mstrmojo.emptyFn,onmousedown:function f(t){var o=t.getTarget().parentNode,u=(o===this.downBtnNode);if(u||o===this.upBtnNode){var r=this.tabContainerNode,n=r.firstChild,i=I(r),k=e(n,this),m=this.isAlignRight?(u?-10:10):(u?10:-10),j=this.id,p=this,l;if(mstrApp.setInteractive){mstrApp.setInteractive(false);}d.addClass(o,"active");var q=function(){window.clearInterval(l);d.removeClass(o,"active");O.call(mstrmojo.all[j]);if(mstrApp.setInteractive){mstrApp.setInteractive(true);}};G.attachOneTimeEvent(document.body,"mouseup",q);l=window.setInterval(function(){k=Math.min(Math.max(i,k+m),0);n.style[S(p)]=k+"px";if(k===i||k===0){q();}},33);}},moveTab:function L(h,p,n,m){var i=this.children,q=i.splice(h,1)[0];i.splice(p,0,q);H.call(this);var j=this.containerNode,k=j.childNodes,o=j.removeChild(k[h]),l=k[p];if(l){j.insertBefore(o,l);}else{j.appendChild(o);}if(q.isSelected){J.call(this,true,true);}if(!m&&n!==undefined&&n!==p){this.commitTabMove(n,p);Y(this);}},commitTabMove:function a(h,i){throw new Error(this.scriptClass+" must implement commitTabMove.");}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Box","mstrmojo.ui.SearchablePulldown");mstrmojo.requiresDescs(14185,14186,14187);var K=mstrmojo.array,J=mstrmojo.dom,M=mstrmojo.desc(14185,"Search for a namespace"),F=mstrmojo.desc(14186,"Loading namespaces..."),I=mstrmojo.desc(14187,"Update namespaces"),Q=mstrmojo.warehouse.EnumDataChangeEvents;var D=31;mstrmojo.warehouse.ui.NameSpacePullDown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.NameSpacePullDown",cssClass:"mstrmojo-wh-NameSpacePullDown",visible:false,pulldown:undefined,btnRefreshNS:undefined,selectedIndex:undefined,children:[{scriptClass:"mstrmojo.ui.SearchablePulldown",alias:"pulldown",isHostedWithin:false,hostedCSSClass:"mstrmojo-wh-Panel.AvailableTables",visible:false,nameSpacesLoaded:undefined,renderOnScroll:true,updateText:function E(R){this.selectedNode.textContent=R;},onPopupWidgetOpened:function H(){this.getPopupWidget().set("width",mstrmojo.dom.position(this.domNode).w+"px");},onitemSelected:function B(R){if(this.parent.mode===1){if(this.getPopupList()._oldItems!==undefined){return ;}this.parent.selectedIndex=this.selectedIndex;if(this.parent.onItemSelectedCallback){this.parent.onItemSelectedCallback(R);}}else{this.updateText(F);this.parent.selectedIndex=undefined;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-btnRefreshNS",alias:"btnRefreshNS",visible:false,onclick:function P(){mstrApp.rootController.getNameSpaces({sourceInfo:this.parent.sourceInfo,getFresh:true});},title:I,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var R=J.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",top:Math.max(R.y+40,0),left:Math.max(R.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});},onvisibleChange:function N(R){var S=this.parent.domNode.clientWidth||parseInt(this.parent.width,10);if(typeof S==="number"&&S>0){this.parent.pulldown.set("width",S-(this.visible?D:0)+"px");}}}],onwidthChange:function G(R){var S=parseInt(R.value,10);if(S>0){this.pulldown.set("width",S-(this.btnRefreshNS.visible?D:0)+"px");}},onvisibleChange:function N(R){var S=this.domNode.clientWidth||parseInt(this.width,10);if(this.visible&&typeof S==="number"&&S>0){this.pulldown.set("width",S-D+"px");}},postBuildRendering:function A(){if(this._super){this._super();}if(J.isIE8||J.isIE9){mstrmojo.css.addClass(this.domNode,"ie9");}},init:function O(S){this._super(S);var V=this,T={},R=T[this.id]={};R[Q.NAMESPACES_CHANGED]=function U(W){V.loadNameSpaces(W);};R[Q.NAMESPACES_REQUESTED]=function U(W){V.preLoadNameSpaces(W);};mstrApp.getRootController().attachDataChangeListeners(T);},mode:0,preLoadNameSpaces:function C(R){if(!((this.sourceInfo===R.sourceInfo)||(R.sourceInfo==="")||(R.sourceInfo===undefined))){return ;}var S=[];this.mode=0;S[0]={n:""};S[1]={n:F};this.pulldown.set("items",S);this.pulldown.set("selectedIndex",0);this.pulldown.set("visible",true);this.set("visible",true);this.pulldown.updateText(M);},loadNameSpaces:function L(V){if(!((this.sourceInfo===V.sourceInfo)||(V.sourceInfo==="")||(V.sourceInfo===undefined))){return ;}var S=V.namespaces||[],X=true,Y=V.dbRoleID,T,W,Z=-1;if(S.length===0){S.push({n:""});X=false;}S=S.sort(function(d,c){return d.n.toLowerCase().localeCompare(c.n.toLowerCase());});var U=this.pulldown.selectedNode.innerHTML,R=this.pulldown.getPopupList().visible;if(R){this.pulldown.getPopupList().close();}this.mode=1;this.pulldown.set("items",S);this.pulldown.set("visible",X);this.set("visible",X);this.btnRefreshNS.set("visible",X);if(!X&&!V.error){this.pulldown.set("selectedIndex",0);}this.dbRoleID=Y;if(this.nameSpacesLoaded){this.nameSpacesLoaded();}if(X){if(R){this.pulldown.getPopupList().open();}if(mstrApp.getRootController().isUsingCookieNamespace()){T=window.localStorage;W=(T&&T.getItem(Y));Z=K.find(S,"n",W);}if(Z>=0){this.pulldown.set("selectedIndex",Z);}else{this.pulldown.updateText(U);}if(U!==M){this.pulldown.processSearch();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.architect.ui.editors.DataSourceEditor","mstrmojo.warehouse.EnumObjectTypes");var J=mstrmojo.array,C=mstrmojo.architect.menu.EnumMenuActions,L=mstrmojo.warehouse.EnumObjectTypes,E=mstrmojo.desc(11398,"Functionality not yet implemented."),G=mstrmojo.desc(6722,"Are you sure you want to delete '##'?"),I="Are you sure you want to delete these ## objects?";var K=false;function F(P,N){var O=this.data,M=(O&&O.length)?O[0]:O;return(M&&M[P])?M[P](O,N):true;}mstrmojo.architect.menu.ArchitectMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.menu.ArchitectMenu",dynamicUpdate:true,queryEnabled:function H(M){return F.call(this,"isEnabled",M)||K;},queryVisible:function D(M){return F.call(this,"isVisible",M)||K;},queryChecked:function B(M){return F.call(this,"isChecked",M)||K;},executeCommand:function(V){var U=mstrmojo.architect.menu.ArchitectMenu.EnumRelationType,Q=this.data,R=mstrApp.getRootController(),P=Q.parentAttributeId,M=Q.childAttributeId,N=Q.relationTableId;switch(V.action){case C.NONE:break;case C.DELETE:var O;if(Q.length){O=I.replace("##",Q.length);}else{O=G.replace("##",Q.n);}mstrmojo.confirm(O,{confirmBtn:{fn:function(){R.deleteObject(Q);}}});break;case C.RENAME:R.renameObject(Q);break;case C.AUTOMAP:R.autoMapTable([].concat(Q));break;case C.SAMPLE_DATA:R.showSampleData(Q);break;case C.CONVERT_ATTR_TO_FACT:R.convertAttributeToFact(Q);break;case C.CONVERT_ATTR_TO_FORM:R.convertAttributeToForm(Q,V);break;case C.LOGICAL_TABLE_SIZE:R.setTableLogicalSize(Q);break;case C.CONVERT_COLUMN_TO_FORM:R.convertColumnToForm(Q,V);break;case C.SET_AS_MULTILINGUAL:R.setAsMultiLingual(Q);break;case C.CONVERT_FACT_TO_ATTR:R.convertFactToAttribute(Q);break;case C.REMOVE_FROM_TABLE:R.removeFromTable(Q);break;case C.SET_AS_LOOKUP:R.setAsLookup(Q);break;case C.NEW_FACT:V.tp=L.FACT;V.isNew=true;R.openExpressionEditor(Q,V);break;case C.NEW_ATTR:V.tp=L.ATTRIBUTE;V.isNew=true;R.openExpressionEditor(Q,V);break;case C.UPDATE_FORMAT:R.updateFormFormat(Q,V);break;case C.EDIT:V.tp=Q.tp;V.isNew=false;R.openExpressionEditor(Q,V);break;case C.MAPPING:R.updateMappingMethod(Q,V);break;case C.UPDATE_AGGR:R.updateAggregation(Q,V);break;case C.REMOVE_TABLE:R.removeFromCurrentLayer(Q);break;case C.ADD_ATTRIBUTE:R.createAttribute(Q);break;case C.ADD_FACT:R.createFact(Q);break;case C.DATA_SOURCES:var T=mstrmojo.all[this._dseid]||new mstrmojo.architect.ui.editors.DataSourceEditor({onSubmit:function S(W){R.setTableDBRoles(W);}});this._dseid=T.id;T.open(undefined,{dataSources:R.getTableDBRoles(Q)});break;case C.REMOVE_ATTR_FROM_RELATIONSHIP:R.removeAttributeFromRelation(Q);break;case C.DELETE_RELATIONSHIP:R.removeRelation(P,M);return ;case C.ONE_TO_ONE:R.updateRelation(P,M,U.ONE_TO_ONE,N);break;case C.ONE_TO_MANY:R.updateRelation(P,M,U.ONE_TO_MANY,N);break;case C.MANY_TO_MANY:R.updateRelation(P,M,U.MANY_TO_MANY,N);break;case C.RELATIONSHIP_TABLE_ENTRY:R.updateRelation(P,M,Q.relationType,V.did);break;case C.SHOW_UNUSED_COLUMNS:R.changeLayerTableColumnView([].concat(Q),V);break;case C.ADD_TO_LAYER:R.addOrRemoveTables([].concat(Q),true);break;case C.REMOVE_FROM_LAYER:R.addOrRemoveTables([].concat(Q),false);break;case C.UPSTRUCT:R.handleUpdateStructures([].concat(Q));break;case C.CREATE_ALIAS:R.createTableAlias([].concat(Q));break;case C.LINKS:R.showLinks(Q);break;case C.UPDATE_CATEGORY:R.updateFormCategory(Q,V);break;case C.UNGROUP_FORMS:R.unGroupForms(Q,V);break;case C.UPDATE_GROUP:R.groupForms([Q],V);break;case C.UNGROUP_FORM:R.unGroupForms(Q,V);break;case C.TX_ONE_TO_ONE:R.setTransformationCardinality(Q.did,true);break;case C.TX_MANY_TO_MANY:R.setTransformationCardinality(Q.did,false);break;case C.TX_APPLY_TO_ALL:R.setTransformationAllAttributes(Q.did,true);break;case C.TX_APPLY_TO_HIGHEST:R.setTransformationAllAttributes(Q.did,false);break;case C.SET_ENTRY_POINT:R.addEntryPoint(Q.attributeId);break;case C.REMOVE_ENTRY_POINT:R.removeEntryPoint(Q.attributeId);break;case C.ATTRIBUTE_FILTERS:R.editFilters(Q.attributeId,undefined,undefined);break;case C.ADD_JOIN_CHILDREN:R.addJointChildren(Q,V.did);break;case C.USE_AS_DRILL:R.updateHiearchySubtype(true);break;case C.USE_AS_BROWSE:R.updateHiearchySubtype(false);break;default:mstrmojo.alert(E);break;}},getMenuConfig:function A(N){var Q=new mstrmojo.ui.menus.MenuConfig(),R=this.id,O=false,M,P=N||this.cm;J.forEach(P,function(T){M=T.action===C.NONE;if(this.queryVisible(T)){var S=["xt "+(T.icn||"")],U=function U(){this.executeCommand(T);};if((this.queryEnabled(T)===false)||M){if((M&&!O)||!M){S.push(M?"sep":"");Q.addDisabledMenuItem(T.n,S.join(" "));}if(M){O=true;}}else{if(T.items){Q.addSubMenuItem(T.n,"",R,T.buildSubMenuConfig||this.getMenuConfig,T.items);O=false;}else{if(T.hasEdt){Q.addEditorMenuItem(T.n,R,T.buildSubMenuConfig);O=false;}else{Q.addToggleMenuItem(T.n||"",S.join(" "),U,U,R,this.queryChecked(T));O=false;}}}}},this);return Q;}});mstrmojo.architect.menu.ArchitectMenu.EnumRelationType={ONE_TO_ONE:1,ONE_TO_MANY:2,MANY_TO_MANY:4,PARENT_CHILD:0};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.architect.EnumBaseFormTypes","mstrmojo.architect.EnumColumnDataTypes","mstrmojo.architect.ui.editors.ColumnDefinitionEditor","mstrmojo.architect.ui.editors.DataSourceEditor","mstrmojo.architect.ui.editors.LogicalSizeEditor","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus.MenuConfig");var b=mstrmojo.array,R=mstrmojo.hash,Y=mstrmojo.architect.menu.EnumMenuActions,g=Y.UPDATE_FORMAT,l=Y.UPDATE_AGGR,S=Y.UPDATE_CATEGORY,P=Y.UPDATE_GROUP,G=Y.NONE,o=mstrmojo.desc(11416,"Add to Layer"),r=mstrmojo.desc(11401,"Remove from Layer"),h=mstrmojo.desc(11403,"Show Unused Columns"),w=mstrmojo.desc(11402,"Auto Map"),E=mstrmojo.desc(11404,"New Attribute"),X=mstrmojo.desc(11405,"New Fact"),k=mstrmojo.desc(1088,"Edit"),u=mstrmojo.desc(629,"Delete"),i=mstrmojo.desc(1388,"Rename"),v=mstrmojo.desc(12224,"Logical size"),N=mstrmojo.desc(11406,"Remove from Table"),Z=mstrmojo.desc(11407,"Set as LookUp"),V=mstrmojo.desc(11408,"Set as Form"),f=mstrmojo.desc(11409,"Add Quick Metrics"),L=mstrmojo.desc(11410,"Form Type"),e=mstrmojo.desc(11411,"Sample Data"),q=mstrmojo.desc(11412,"To Attribute"),T=mstrmojo.desc(11413,"To Fact"),J=mstrmojo.desc(11414,"Add as Attribute"),D=mstrmojo.desc(11415,"Add as Fact"),t=mstrmojo.desc(5752,"Links"),C=mstrmojo.desc(7940,"category"),n=mstrmojo.desc(11417,"Update Structure"),H=mstrmojo.desc(11418,"Create Alias"),p=mstrmojo.desc(12220,"Set as Multilingual"),O=mstrmojo.desc(4381,"Data Sources"),W=mstrmojo.desc(12221,"Ungroup forms"),j=mstrmojo.desc(12222,"Remove from group"),B=mstrmojo.desc(12223,"Add to group"),d=1,F=2;mstrmojo.architect.menu._HasTableMenu=mstrmojo.provide("mstrmojo.architect.menu._HasTableMenu",{_mixinName:"mstrmojo.architect.menu._HasTableMenu",cm:[{action:Y.ADD_TO_LAYER,n:o,icn:"atl",context:d},{action:Y.REMOVE_FROM_LAYER,n:r},{action:Y.AUTOMAP,n:w,icn:"amp"},{action:Y.SHOW_UNUSED_COLUMNS,n:h,view:2,context:F},{action:Y.NEW_ATTR,n:E},{action:Y.NEW_FACT,n:X},{action:G},{action:Y.EDIT,n:k,icn:"edt"},{action:Y.DELETE,n:u,icn:"del"},{action:Y.RENAME,n:i,fn:"renameObject",icn:"rnm"},{action:Y.LOGICAL_TABLE_SIZE,n:v,hasEdt:true,buildSubMenuConfig:function I(){return this.buildLogicalSizeEditor(this.data);},icn:"lock"},{action:Y.UPSTRUCT,n:n},{action:Y.ADD_ATTRIBUTE,n:J},{action:Y.ADD_FACT,n:D},{action:Y.REMOVE_FROM_TABLE,n:N},{action:G},{action:Y.SET_AS_LOOKUP,n:Z},{action:Y.SET_AS_MULTILINGUAL,n:p},{action:Y.CONVERT_ATTR_TO_FORM,n:V,items:[],buildSubMenuConfig:function I(){return this.buildSetAsFormSubMenu(mstrApp.getRootController().getSameTableAttributes(this.data));}},{action:Y.CONVERT_COLUMN_TO_FORM,n:V,items:[],buildSubMenuConfig:function I(){return this.buildSetColumnAsFormSubMenu(mstrApp.getRootController().getSameTableAttributes(this.data));}},{action:Y.AGGREGATION,n:f,hasEdt:true,buildSubMenuConfig:function I(){return this.buildQuickMetricsMenuEditor();}},{action:Y.COLUMN_DEF,n:k,hasEdt:true,buildSubMenuConfig:function I(){return this.buildColumnDefEditor(mstrApp.getRootController().getColumns()[this.data.did],this.data.pdid);}},{action:Y.DATA_TYPE,n:L,items:[],buildSubMenuConfig:function I(){return this.buildFormTypeSubMenu();}},{action:Y.CREATE_ALIAS,n:H},{action:G},{action:Y.SAMPLE_DATA,n:e,icn:"smpl"},{action:G},{action:Y.FORM_CATEGORY,n:C,items:[],buildSubMenuConfig:function I(){return this.buildFormCatSubMenu(mstrApp.rootController.model.basicForms);}},{action:Y.DATA_SOURCES,n:O},{action:Y.CONVERT_FACT_TO_ATTR,n:q},{action:Y.CONVERT_ATTR_TO_FACT,n:T},{action:Y.LINKS,n:t},{action:G},{action:Y.UNGROUP_FORMS,n:W},{action:Y.UNGROUP_FORM,n:j},{action:Y.GROUP_FORM,n:B,items:[],buildSubMenuConfig:function I(){return this.buildFormGroupsSubMenu(mstrApp.getRootController().getAttribute(this.data.sid),this.data,mstrApp.rootController.getFormCategories());}}],buildQuickMetricsMenuEditor:function m(){var AA=this,y=[],x={};b.forEach(["Sum","Count","Max","Min","Variance","Average"],function(AD,AB){var AC={n:AD,did:AD,action:l};y.push(AC);if(AA.queryChecked(AC)){x[AB]=true;}});return new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.architect.ui.SimpleList({cssClass:"mstrmojo-ar-qmlist",multiSelect:true,selectionPolicty:"reselect",items:y,selectedIndices:x}),fnOk:function z(){var AB={action:l,aggr:{sum:false,count:false,max:false,min:false,variance:false,average:false}},AC={Sum:"sum",Count:"count",Max:"max",Min:"min",Variance:"variance",Average:"average"};b.forEach(this.contents.getSelectedItems(),function AD(AE){AB.aggr[AC[AE.n]]=true;});AA.executeCommand(AB);},data:{}});},buildColumnDefEditor:function a(AA,y){var x=[];R.forEach(mstrmojo.architect.EnumColumnDataTypes,function(AB){x.push(AB);});x.sort(function(AC,AB){return AC.n.toUpperCase().localeCompare(AB.n.toUpperCase());});return new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.architect.ui.editors.ColumnDefinitionEditor({colName:AA.cln,type:AA.dt.tp,precision:AA.dt.ps,scale:AA.dt.sc,items:x}),fnOk:function z(){var AB=this.contents.getEditorData();if(AB.colName!==""){mstrApp.getRootController().updateColumn({cln:AB.colName,cmid:AA.cmid,dt:{tp:AB.type,ps:AB.precision,sc:AB.scale},tableId:y},AA,{});}},data:{}});},buildLogicalSizeEditor:function Q(y){var AA=this;return new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.architect.ui.editors.LogicalSizeEditor({isLocked:y.isLocked,logicalSize:y.size,submitData:function x(){this.parent.btnNode.children[1].onclick();}}),fnOk:function z(){var AB=this.contents.getEditorData();y.isLocked=AB.locked;y.size=AB.size;AA.executeCommand({did:y.id,n:y.name,action:Y.LOGICAL_TABLE_SIZE});},cssClass:"popUpMenuEditor",data:y});},buildSetAsFormSubMenu:function c(x){var z=this,AB=[],y;for(y=0;y<x.length;y++){var AA=x[y];if(AA.id!==z.data.did){AB.push({did:AA.id,n:AA.name,action:Y.CONVERT_ATTR_TO_FORM});}}return this.getMenuConfig(AB);},buildSetColumnAsFormSubMenu:function A(x){var z=this,AB=[],y;for(y=0;y<x.length;y++){var AA=x[y];if(AA.id!==z.data.did){AB.push({did:AA.id,n:AA.name,action:Y.CONVERT_COLUMN_TO_FORM});}}return this.getMenuConfig(AB);},buildFormCatSubMenu:function M(x){var y=[];R.forEach(x,function(z){y.push({did:z.id,n:z.useName,action:S});});return this.getMenuConfig(y);},buildFormGroupsSubMenu:function U(AA,z,y){var AB=[],x;b.forEach(AA.formGroups,function(AC){AB.push({catid:AC.catID,n:AC.formName,un:AC.formName,ud:AC.formName,action:P});});R.forEach(AA.forms,function(AC){if(AC.categoryId!==z.fcatId){x=y[AC.categoryId];if(x){AB.push({fcatId:x.id,n:AC.useName,un:x.useName,ud:x.useDescription,action:P});}}});return this.getMenuConfig(AB);},buildFormTypeSubMenu:function K(){var x=mstrmojo.architect.EnumBaseFormTypes;return this.getMenuConfig([{n:mstrmojo.desc(1013,"text"),action:g,baseFormType:x.Text},{n:mstrmojo.desc(3434,"number"),action:g,baseFormType:x.Number},{n:mstrmojo.desc(2052,"date"),action:g,baseFormType:x.Date},{n:mstrmojo.desc(2170,"time"),action:g,baseFormType:x.Time},{n:mstrmojo.desc(9919,"datetime"),action:g,baseFormType:x.DateTime},{n:mstrmojo.desc(9922,"url"),action:g,baseFormType:x.URL},{n:mstrmojo.desc(4699,"email"),action:g,baseFormType:x.Email},{n:mstrmojo.desc(9921,"html tag"),action:g,baseFormType:x.HTMLTag},{n:mstrmojo.desc(4530,"symbol"),action:g,baseFormType:x.Symbol},{n:mstrmojo.desc(9920,"big decimal"),action:g,baseFormType:x.BigDecimal},{n:mstrmojo.desc(8984,"phone number"),action:g,baseFormType:x.PhoneNumber}]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox","mstrmojo.warehouse.dbroles.DBRoleSettingPulldown");mstrmojo.requiresDescs(14036,14037,14038,14467);var K=mstrmojo.array,D=mstrmojo.hash,G=mstrmojo.warehouse.dbroles.DBRoleHelper,P="MSTR_CUSTOM=true;",I=mstrmojo.desc(14036,"Show connection string"),J=mstrmojo.desc(14037,"Hide connection string"),C=mstrmojo.desc(14038,"Edit connection string");mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor",cssClass:"mstrmojo-wh-DBRoleSettingConnectionStringEditor",enabled:true,getValue:function F(){if(this.visibleContents&&this.enabledContents){var Q=this.contents.connectionArea.value;return G.cleanDSNConnection(Q+(Q.slice(-1)===";"?"":";")+P);}return"";},setValue:function B(Q){var R=this.contents;this.toggleContents();R.editString.setValue(true);R.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(Q).replace(P,""));},isValid:function O(){return{val:true,msg:""};},connectionArea:undefined,driverList:undefined,showLabel:undefined,editString:undefined,info:{},drivers:[],enableFn:mstrmojo.emptyFn,generateConnectionStringFn:mstrmojo.emptyFn,dbID:{},dbms:{},load:function L(){var Y=this.contents,Z=this.dbID,U=this.dbms,S=Z.dbVersions[K.find(Z.dbVersions,"v",U.db_ver)],R=S.connections[0],T=G.driverExists.call(this,[R]),V={},W=[];K.forEach(this.dbIDVersions,function(a){K.forEach(a.dbVersions,function(b){K.forEach(b.connections.concat(b.altconnections),function(c){V[c.driver]=c;});});});var Q;D.forEach(this.drivers,function(a){Q=mstrmojo.hash.clone(a);if(V[a.n]){Q.n=Q.n+" (Certified)";Q.title=Q.n;Q.str=V[a.n].str;}W.push(Q);});Y.driverList.set("items",W);if(T.exists){var X=K.find(this.drivers,"n",T.driver);if(X<0){X=0;}Y.driverList.set("selectedID",W[X].n);}this.updateString();},visibleContents:false,enabledContents:false,toggleContents:function A(){this.visibleContents=!this.visibleContents;this.contents.set("visible",this.visibleContents);this.showLabel.set("text",(this.visibleContents?J:I));if(!this.visibleContents){this.contents.editString.setValue(false);this.enableFn(true);}else{this.load();}},updateString:function N(){if(this.visibleContents){this.contents.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(this.generateConnectionStringFn()));}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-ShowConnection",alias:"showLabel",text:I,onclick:function M(){this.parent.toggleContents();}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionStringContents",alias:"contents",visible:false,children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",label:C,alias:"editString",oncheckedChange:function E(){var Q=this.parent;Q.parent.enableFn(!this.checked);Q.connectionArea.set("enabled",this.checked);Q.driverList.set("enabled",this.checked);Q.parent.enabledContents=this.checked;}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",cssClass:"mstrmojo-wh-DBRolePulldown mstrmojo-wh-DBRoleConnection-driverList",caption:mstrmojo.desc(14467,"Driver"),alias:"driverList",itemIdField:"n",itemField:"n",enabled:false,bindings:{visible:function(){var Q=this.parent.parent;return(Q.dbID.connType&4)!==4;}},onChange:function H(Q){var R=this.parent.parent,T=this.parent.parent.contents,S;if(R.enabledContents){S=Q.str||"";}T.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(R.generateConnectionStringFn(S).replace(P,"")));}},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionString",value:"",alias:"connectionArea",enabled:false}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.dbroles.DBRoleSetting","mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox","mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor","mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector","mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox","mstrmojo.warehouse.dbroles.DBRoleSettingPulldown","mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton");mstrmojo.requiresDescs(15,260,512,689,1034,2523,3332,3989,7790,7952,8517,8518,8519,8521,8522,8523,8524,8526,8528,8529,8530,8532,8533,8534,8536,8538,8539,8540,8546,8547,8548,8549,8550,8560,10055,10058,10059,10061,10064,10065,11392,11394,12308,12309,12310,12312,12313,12542,12752,12758,12997,13100,13101,13103,13104,13105,13106,13107,13108,13109,13110,13111,13112,13113,13114,13115,13116,13117,13118,13119,13121,13122,13123,13124,13125,13126,13234,13373,13531,13532,13533,13540,13541,13904,13905,13906,13907,13908,13909,13910,13944,13945,13946,13947,13948,13949,13950,13951,13952,13962,13979,13980,13981,13982,13990,14002,14005,14620,14621,14641,14685,14686,14687);var g=mstrmojo.array,a=mstrmojo.hash,N=mstrmojo.string,f="hideUnavailableDrivers",M="FULLCONNECTION",i,E=mstrmojo.warehouse.dbroles.DBRoleHelper,p=mstrmojo.desc(8538,"Database:"),T=mstrmojo.desc(2523,"Version:"),I=mstrmojo.desc(13540,"Show databases whose certified drivers were not found"),d=mstrmojo.desc(13990,"Show databases which are not certified for the DSNs driver"),P=mstrmojo.desc(13234,"Add driver"),h=mstrmojo.desc(11392,"Missing parameters"),l=" ("+mstrmojo.desc(13541,"Certified driver not found")+")",G=mstrmojo.desc(11394,"The ODBC driver used by this database connection is currently not installed, until that happens this connection may not work"),D=mstrmojo.desc(14002,"The JDBC driver used by this database connection is currently not installed, until that happens this connection may not work"),j=mstrmojo.desc(8526,"select a dsn");function t(AA,AL,AO){var AM,AC="";if(this.isDSNLess){var z={},AN,AD=this.contents.children,AR=1;if(AO===undefined){var AQ=this.dbIDSelectList.selectedItem,AE=AQ.dbVersions[g.find(AQ.dbVersions,"v",this.dbmsList.selectedItem.db_ver)],AI=AE.connections[this.selectedSection],AF=E.driverExists.call(this,[AI]);if(AF.exists){AN=AI.str;}else{if(AE.altconnections.length>0){AN=AE.altconnections[this.selectedSection].str;}else{AN=AI.str;AC=G;if(AN.indexOf("JDBC;")>=0){AC=D;}}}}else{AN=AO;}g.forEach(AD,function(AT){var AS=AT.getValue();if(AT.field){if(typeof AS==="string"){z[AT.field]=N.trim(AS);}else{z[AT.field]=AS;}}if((!!AS)&&AT.driverMode){AR=AT.driverMode;}});this.driverMode=AR;AM=AN.replace(/@([\w\d]+)/gm,function AH(AS,AT){return(z.hasOwnProperty(AT)&&z[AT]!==null)?z[AT]:"";});if(AL){var AB="=;",AJ,AK,AG,AP=/[\s\x28\x29\x3B]/g;do{AJ=AM.indexOf(AB);if(AJ>-1){AK=AM.substring(0,AJ);while(AP.test(AK)){AJ=AP.lastIndex;}AG=AK.substring(AJ);AM=AM.replace(AG+AB,"");}}while(AM.indexOf(AB)>0);}}else{AM="DSN="+this.dsnBox.dsnList.selectedItem.n+";";}if(AA){AM=E.cleanDSNConnection(AM);}return{str:AM,err:AC};}function k(AC,AP){var AD=mstrApp.rootController,AJ="XQUERY",AE="@",AA,AM,AN="",AG="",AK=[],AU="",AB={},AO=/[,:]/g,AF=0,AQ=/[\x28\x29\x3B\x7D]|(!#)/g,AV,AL="",AH=/[\x29\x3B\x7D\/!]/g,AI=E.cleanDriver(AP),AR,z={},AT=0,AS=0;g.forEach(AC,function(AX){AA=AX.str;AK=[];AB={};AR=E.cleanDriver(AA);AF++;if(AA.indexOf(M)===0){if(AX.driver===AJ){AG=AA.replace(M+"="+AJ+";"+AE,"");var AY=AP.indexOf(";;");if(AY>=0){AP=AP.substring(0,AY+1);}AB[AG]=AP.replace(AJ+";","");z=AB;AS=AD.getObjectCount(AB);return false;}AA=AA.replace(M+"=",";");}if(AI.toUpperCase()!==AR.toUpperCase()){return true;}do{AM=AA.indexOf(AE);AN=AA.substring(0,AM);AQ.lastIndex=0;while(AQ.test(AN)){AM=AQ.lastIndex;}AG=N.trim(AN.substring(AM));AA=AA.replace(AN,"").replace(AE,"");AH.test(AA);AV=AH.lastIndex-1;AL=AA[AV];AH.lastIndex=1;AU=AA.substring(0,AV).replace("@","");AK.push({key:AU,token:AG,endoftokenChar:AL});}while(AA.indexOf(AE,AV)>0);var AW;g.forEach(AK,function(Ad,AZ){AW=Ad.token;AZ=AP.toUpperCase().indexOf(AW.toUpperCase());if(AZ>-1){AZ+=AW.length;AQ.lastIndex=0;var Ac=AP.substring(AZ);var Ab=AQ.exec(Ac);if(Ab){var Af=Ac.substring(0,Ab.index);if(Ac[Ab.index]!==Ad.endoftokenChar&&Af.length){if(Af[Af.length-1]===Ad.endoftokenChar){Af=Af.substring(0,Af.length-1);}}AO.test(Af);var Aa=Af.substring(AO.lastIndex-1,AO.lastIndex)||",",Ag=Ad.key.split(Aa),Ae=Af.split(Aa);if(Ag.length===Ae.length){g.forEach(Ag,function(Ah,Ai){AB[Ah]=Ae[Ai];});}else{AB[Ad.key]=Af;}}}});if(AD.getObjectCount(AB)>AS){z=AB;AS=AD.getObjectCount(AB);AT=AF;}return true;});z["RB"+AT]=true;return z;}function S(AC){var AB={},z=AC.split(";"),AA=[];g.forEach(z,function(AD){AA=AD.split("=");if(AA[0]!==""){AB[AA[0]]=AA[1];}});return AB;}function C(z,AE){var AD,AC,AA=[],AB={};g.forEach(a.keyarray(AE),function(AF){AD=AE[AF];if(AF){AB[AF]=AF+"="+AD;}else{g.forEach(a.keyarray(AB),function(AG){AA.push(AG);});g.forEach(AA,function(AG){AC=false;g.forEach(z.parent.children,function(AH){if(AH.propfield===AG){AC=true;return !AC;}});if(!AC){delete AB[AG];}});AB[AF]=AD;}});return a.valarray(AB).join(";");}function r(AC,AF,AA){var AE,AB;if(AC.field){AE=AF[AC.field];}else{if(AC.propset){AB=AA[AC.propset][AC.prop];if(AC.propformat==="json"){AE=JSON.parse(AB||"{}")[AC.propfield];}else{if((AC.propformat==="text")){if(AC.propfield){AE=(S(AB||"")[AC.propfield]);}else{var z=S(AB||"");g.forEach(AC.parent.children,function(AG){if(AG.propfield){delete z[AG.propfield];}});var AD=[];g.forEach(a.keyarray(z),function(AG){AD.push(AG+"="+z[AG]);});AE=AD.join(";");}}else{AE=AB;}}}else{g.forEach(AC.children,function(AG){r(AG,AF,AA);});}}if(AE){AC.setValue(AE);}}function Z(AE,AA){var AF,AD,AB,z={},AC={};if(AE.propset){AF=AE.getValue();if(typeof AF==="string"){AD=N.trim(AF).replace(/\\/g,"\\\\");}else{AD=AF;}AB=AA[AE.propset][AE.prop];if(AE.propformat==="json"){AC=JSON.parse(AB||"{}");AC[AE.propfield]=AD;AA[AE.propset][AE.prop]=JSON.stringify(AC).replace(/\\"/g,'"');}else{if((AE.propformat==="text")){z=S(AB||"");z[AE.propfield]=AD;AA[AE.propset][AE.prop]=C(AE,z);}else{AA[AE.propset][AE.prop]=AD;}}}else{g.forEach(AE.children,function(AG){Z(AG,AA);});}}function R(AF){if(this.info.connstr){var AE=this.contents;var AB=this.info.connstr.split(";")[0],AA=(AB.split("=")[0]).toUpperCase();switch(AA){case"DSN":AE=this.dsnBox;AB=AB.substring(AA.length+1,AB.length);AE.dsnList.set("selectedID",AB.toUpperCase());break;default:AB=E.cleanLoadedDSNConnection(this.info.connstr,AF.dbID);var AG=this.supportedDBs[g.find(this.supportedDBs,"id",AF.dbID)],z=AG.dbVersions[g.find(AG.dbVersions,"v",AF.dbver)],AH=z.connections.concat(z.altconnections);var AC=k(AH,AB);var AD=this.info.vldbProperties;g.forEach(AE.children,function(AI){r(AI,AC,AD);});if(E.isCustomConnection(AB)||mstrApp.rootController.getObjectCount(AC)<=z.DBPS.length){AE.stringEditor.setValue(AB);}}}}function w(){var AD;if(this.info.connstr){var AK=E.cleanDriver(this.info.connstr),AH=E.isCustomConnection(this.info.connstr),z=(AK.split("=")[0]).toUpperCase(),AG=this.dbObjects.dbms,AB=AG[g.find(AG,"did",this.info.dbms)],AI,AE=function AA(AM,AL){g.forEach(AM,function(AN){if(AB.db_ver===AN.v){AI=AN.connections.concat(AN.altconnections);if(AK!==""&&!AH){if(g.find(AI,"driver",AK)>=0){AD={dbver:AN.v,dbID:AL};}}else{AD={dbver:AN.v,dbID:AL};}}if(AD){return false;}return true;});};switch(z){case"DSN":AD={dbver:AB.db_ver,dbID:this.dbIDs.Undefined};break;default:var AC=parseInt(this.info.ab,10)||0;if(AC>=0){var AF=g.find(this.supportedDBs,"id",AC),AJ;if(AF>=0){AJ=this.supportedDBs[AF];AE(AJ.dbVersions,AJ.id);}}if(!AD){g.forEach(this.supportedDBs,function(AL){AE(AL.dbVersions,AL.id);if(AD){return false;}return true;});}if(!AD){AH=true;g.forEach(this.supportedDBs,function(AL){AE(AL.dbVersions,AL.id);if(AD){return false;}return true;});}break;}}if(!AD){AD={dbID:-1};}return AD;}function Q(AC,AB,AA,z){var AF=this,AE=[],AG,AD;AD=new mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox({alias:AC.alias+"groupBox"});AF.contents.addChildren([AD]);g.forEach(AB,function(AH){if(AH.group===AA){AG=a.clone(AH);delete AG.group;AE.push(AG);}});z.call(AF,AE,AD.alias,AD);if(AC.oncheckedChange){AC.checked=true;AC.set("checked",false);}}function y(AE,AA,z){var AC=this,AB=[];g.forEach(AE,function(AF){if(!!(AF.group)){AB.push(AF);}});var AD;g.forEach(AE,function(AM,AN){AD=false;if(mstrApp.isSingleTier){if((AM.scope&2)===2){AD=true;}}else{if((AM.scope&1)===1){AD=true;}}if(!AD){return ;}var AP,AO=mstrmojo.desc(AM.IDS,AM.n),AI="dbp"+AN,AL=(AM.isgroup===1);if(AO&&AO[AO.length-1]!==":"){AO+=":";}if(AM.group){return true;}switch(AM.tp){case"text":AP=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AO,alias:AI,isRequired:AM.req,onEnter:AC.onEnterFn,onvalueChange:function AG(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"number":AP=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AO,alias:AI,isNumeric:true,isRequired:AM.req,onEnter:AC.onEnterFn,onvalueChange:function AG(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"list":var AK="v",AF=AM.options;if(AF[0].n){AK="n";g.forEach(AF,function(AQ){AQ.n=mstrmojo.desc(AQ.IDS,AQ.n);});}else{g.forEach(AF,function(AQ){AQ.n=AQ.v;});}AP=new mstrmojo.warehouse.dbroles.DBRoleSettingPulldown({caption:AO,alias:AI,itemIdField:"v",itemField:AK,onChange:function AJ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});AP.render();AP.set("items",AF);AP.set("selectedID",AF[0].v);break;case"boolean":AP=new mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox({label:AO,alias:AI,isGroup:AL,isNumeric:(AM.stp&&(AM.stp==="numeric")),driverMode:1,helpLink:AM.help,driverModeChecked:AM.driverMode||1,display:AM.display,oncheckedChange:function AH(){if(this.parent.stringEditor){this.parent.stringEditor.updateString();}this.driverMode=(this.checked?this.driverModeChecked:1);if(!this.isGroup){return ;}var AQ=(this.checked&&(this.display==="onChecked"))||(!this.checked&&(this.display==="onUnChecked"));this.parent[this.alias+"groupBox"].set("visible",AQ);}});break;case"file":AP=new mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector({caption:AO,alias:AI,isRequired:AM.req,selectorOption:AM.selectorOption,onEnter:AC.onEnterFn,onvalueChange:function AG(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;}AP.field=AM.field;AP.parentRBAlias=AA;AP.propset=AM.propset;AP.prop=AM.prop;AP.propformat=AM.propformat;AP.propfield=AM.propfield;if(AM.defaultValue){AP.setValue(AM.defaultValue);}z.addChildren([AP]);if(AL){Q.call(AC,AP,AB,AM.groupid,y);}});}function V(AB,AA,z){return new mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton({label:mstrmojo.desc(AB.IDS,AB.n),index:AA,alias:"RB"+AA,count:z,field:"RB"+(AA+1),onclick:function AC(){var AE;if(this.checked){for(AE=0;AE<this.count;AE++){this.parent["RB"+AE].set("checked",false);this.parent["RB"+AE].enableChildren();}this.set("checked",true);this.enableChildren();}},oncheckedChange:function AD(){if(this.checked){this.parent.parent.selectedSection=this.index;}}});}function q(){if(!this.isDSNLess){return ;}var AD=this.contents,AG,AB,AE=this;if(!AD){return ;}if(AD.children){AD.removeChildren(null,true);}if(!this.dbmsList.selectedItem){return ;}AG=this.dbIDSelectList.selectedItem||this.dbIDSelectList.items[0];var z=AG.dbVersions[g.find(AG.dbVersions,"v",this.dbmsList.selectedItem.db_ver)];if(!z){return ;}if(!E.driverExists.call(this,z.connections).exists&&(z.altDBPS.length>0)){AB=z.altDBPS;}else{AB=z.DBPS;}if(AB&&AB.length>1){var AC=AB.length;g.forEach(AB,function(AJ,AI){if(AJ.defaultSection){AE.selectedSection=AI;}var AK=V(AJ,AI,AC);AD.addChildren([AK]);y.call(AE,AJ.DBP,AK.alias,AE.contents);});AD["RB"+AE.selectedSection].checked=true;AD["RB"+AE.selectedSection].onclick();}else{y.call(AE,AB[0].DBP,"",AE.contents);}var AH=new mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor({alias:"stringEditor",drivers:AE.drivers,dbIDVersions:this.dbIDSelectList.items,info:AE.info,dbID:AE.dbIDSelectList.selectedItem,dbms:AE.dbmsList.selectedItem,enableFn:function AF(AJ){var AK=this.parent.parent,AI=AK.contents["RB"+AK.selectedSection];g.forEach(AD.children,function(AL){if(!AL.isGroupSetting&&!AL.isGroup){AL.set("enabled",AJ);}});if(AJ&&AI){AI.setValue(true);}},generateConnectionStringFn:function AA(AI){return t.call(AE,false,false,AI).str.replace(M+"=","");}});AD.addChildren([AH]);}function v(AA){var z=this.dbObjects.dbms;return z[g.find(z,"db_ver",AA)];}function H(){var AI=this,AE=false,AH=this.dbObjects.supportedDBs,AJ=this.dbIdFilter||[],AK=this.dbIdExcludeFilter||[],AD=[],AC,AG=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")===-1)),AF=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")!==-1)),AA=(mstrApp.isSingleTier&&window.FormWrapper.isWin32&&window.FormWrapper.isWin32()),AB=function AB(AM){if(AG){var AN=a.clone(AM);AN.n=N.trim(AM.n.replace("(JDBC)",""));return AN;}if(AF){var AL=a.clone(AM);AL.n=N.trim(AM.n.replace("(32 bit)",""));return AL;}return AM;},z=[6800,5300,5600,6600,7000];g.forEach(AH,function(AL){AE=false;if(mstrApp.isSingleTier&&AG&&AL.dbType===100){return true;}if(mstrApp.isSingleTier){if(g.indexOf(z,AL.dbType)!==-1){return true;}}g.forEach(AL.dbVersions,function(AM){if(AM.dsnless){if(!AI.showUnavailable){g.forEach(AM.connections.concat(AM.altconnections),function(AN){if(E.driverAvailable.call(AI,AN)){AE=true;}return !AE;});}else{AE=true;}return !AE;}return !AE;});if(AE){AC=false;g.forEach(AK,function(AM){if(AM===AL.id){AC=true;return false;}});if(!AC){if(AJ.length>0){g.forEach(AJ,function(AM){if(AM===AL.id){AD.push(AB(AL));}});}else{AD.push(AB(AL));}}}});this.dbIDSelectList.set("items",AD);if(AD.length===0&&!AI.showUnavailable){AI.showUnavailable=true;this.driverBox.hideUnavailable.setValue(true);}}function u(AC,AB){var AH=this.dbObjects.dbms,AJ=this.dbmsList;if(AC.length===0){var z,AD=this.dbObjects.dsndbms,AE={};if(this.cfgDbmsTypeExcludeFilter&&this.cfgDbmsTypeExcludeFilter.length>0){g.forEach(this.cfgDbmsTypeExcludeFilter,function(AK){AE[AK]=true;});AD=g.filter(this.dbObjects.dsndbms,function(AK){return !AE[AK.db_type];});}z=a.cloneArray(AD);g.forEach(AB,function(AL){if(AL.v>-1){var AK=g.find(z,"db_ver",AL.v);if(AK>=0){z[AK].n+=" (Certified for DSN)";}}});AJ.set("items",z);}else{var AF={},AI=this;g.forEach(AH,function(AK){AK.enabled=true;if(!(AC.length===1&&AC[0].v===-1)){if((AK.db_type===AI.dbTypes.Generic.v)||(AK.db_ver===-1)){if(!AI.alwaysShowGeneric){return true;}}}g.forEach(AC,function(AO){if(AK.db_ver===AO.v){if((AO.dsnless&&AI.isDSNLess)||(!AI.isDSNLess)){var AM=AO.connections.concat(AO.altconnections);if(!AI.showUnavailable){g.forEach(AM,function(AP){if(E.driverAvailable.call(AI,AP)){AF[AK.did]=AK;}return true;});}else{var AL=false;g.forEach(AM,function(AP){if(E.driverAvailable.call(AI,AP)){AL=true;}return !AL;});if(AL){AK.title=(AK.n.length>50)?AK.n:"";AF[AK.did]=AK;}else{var AN=mstrmojo.hash.clone(AK);AN.n=AN.n+l;AK.enabled=false;AN.title=(AN.n.length>50)?AN.n:"";AF[AN.did]=AN;}}}}});});if(mstrApp.rootController.getObjectCount(AF)===0){var AA=v.call(this,-1);if(AA){AF[AA.did]=AA;}}AJ.set("items",mstrmojo.hash.valarray(AF));}var AG=AJ.items;if(AG.length>0){if(this.info&&this.info.dbms){AJ.set("selectedID",this.info.dbms);}else{if(AJ.selectedItem&&(g.find(AG,"did",AJ.selectedItem.did)>-1)){AJ.set("selectedID",AJ.selectedItem.did);}else{AJ.set("selectedID",AG[0].did);}}AJ.onChange();}else{AJ.set("selectedID","");}}function Y(){var AH=this,AI={n:j,nU:j.toUpperCase(),des:0};var AG={},AE=AH.dbObjects.dsns,AA=[];AG[AI.nU]=AI;if(AH.dbIdFilter.length===1){g.forEach(AH.supportedDBs,function(AJ){g.forEach(AJ.dbVersions,function(AK){g.forEach(AK.connections.concat(AK.altconnections),function(AL){g.forEach(AE,function(AM){if(AL.driver===AM.des){AG[AM.nU]=AM;}return true;});});});});AA=a.cloneArray(a.valarray(AG));}else{AA=a.cloneArray(AH.dbObjects.dsns);}var z={};if(AH.dsnDbTypeExcludeFilter&&AH.dsnDbTypeExcludeFilter.length>0){g.forEach(AH.dsnDbTypeExcludeFilter,function(AJ){g.forEach(AH.dsnMapDBs,function(AK){if(AK.dbType===AJ){g.forEach(AK.dbVersions,function(AL){g.forEach(AL.connections.concat(AL.altconnections),function(AM){g.forEach(AA,function(AN){if(AM.driver===AN.des){z[AN.nU]=AN;}return true;});});});}});});var AC,AF,AB=a.valarray(z),AD=AB.length;for(AC=0;AC<AD;AC++){AF=g.find(AA,"nU",AB[AC].nU);if(AF>=0){AA.splice(AF,1);}}}this.dsnBox.dsnList.set("items",AA);this.onisDSNLessChange();}mstrmojo.warehouse.dbroles.DBRoleDSNConnection=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleDSNConnection",cssClass:"mstrmojo-wh-DBRoleDSNConnection",postCreate:function c(){var z=mstrApp.rootController.getDBObjects();this.dbObjects=z;this.dbTypes=z.dbTypes;this.dbIDs=z.dbIDs;this.dbVersions=z.dbVersions;this.supportedDBs=z.supportedDBs;this.dsnMapDBs=z.dsnMapDBs;this.drivers=z.drivers;this.preferences=z.preferences;},onEnterFn:mstrmojo.emptyFn,info:undefined,oninfoChange:function K(){var AB=this.info.connstr;if(AB&&(AB.substring(0,1)===";")){this.info.connstr=this.info.connstr.replace(";","");}H.call(this);var z=w.call(this);var AA=window.localStorage,AC=(AA&&AA.getItem(f));this.driverBox.hideUnavailable.setValue((AC?(AC==="1"):false));if((mstrApp.rootController.getObjectCount(this.info)>0)&&(this.info.did!=="")&&(g.find(this.dbIDSelectList.items,"id",z.dbID)<0)){this.driverBox.hideUnavailable.setValue(true);}if(this.isDSNLess){this.dbIDSelectList.set("selectedID",z.dbID);this.dbmsList.set("selectedID",this.info.dbms);}else{if(this.info.n){Y.call(this);}}R.call(this,z);this.driverBox.hideUnavailable.set("visible",!this.hideDriverCheck);},selectedSection:0,isDSNLess:undefined,dbIdFilter:[],dbIdExcludeFilter:[],dsnDbTypeExcludeFilter:[],driverMode:1,singleType:false,onisDSNLessChange:function L(){var AF=this.dbIDSelectList,AC=this.dsnBox,AE=AC.dsnList,z=this.info&&this.info.connstr,AB,AD,AA;if(this.isDSNLess){AF.set("selectedItem",null);AF.set("selectedID",this.supportedDBs[0].id);this.driverBox.hideUnavailable.set("label",I);}else{if(!(AE.items&&AE.items.length>0)){Y.call(this);}if(z){AB=z.split(";")[0];AD=(AB.split("=")[0]).toUpperCase();if(AD==="DSN"){AB=AB.substring(AD.length+1,AB.length);AA=AB.toUpperCase();}}if(AA===undefined){AA=AE.items[0].nU;}AE.set("selectedID",AA);AE.onChange();this.driverBox.hideUnavailable.set("label",d);}AF.set("visible",this.isDSNLess&&!this.singleType);this.contents.set("visible",this.isDSNLess);AC.set("visible",!this.isDSNLess);},dsnBox:undefined,dsnList:undefined,dbIDSelectList:undefined,dbmsList:undefined,contents:undefined,hideUnavailable:undefined,hideDriverCheck:false,onhideDriverCheckChange:function e(){this.driverBox.hideUnavailable.set("visible",!this.hideDriverCheck);},driverBox:undefined,addDriver:undefined,showAddDriver:false,showConnectionString:false,Hive:undefined,db_ver:undefined,DBP:undefined,DBPS:undefined,altDBPS:undefined,IDS:undefined,connections:undefined,altconnections:undefined,dsnless:undefined,Undefined:undefined,isgroup:undefined,groupid:undefined,showUnavailable:false,alwaysShowGeneric:false,children:[{scriptClass:"mstrmojo.Table",rows:1,cols:2,alias:"dsnBox",postCreate:function c(){this.cssClass="mstrmojo-wh-DSNConnection-Box "+((mstrApp.isSingleTier&&navigator.platform.indexOf("Win")!==-1)?"one-tier-win":"");},layout:[{cells:[{cssClass:"mstrmojo-wh-DSNConnection-Box-list"},{cssClass:"mstrmojo-wh-DSNConnection-Box-btn"}]}],children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",slot:"0,0",caption:"dsn:",alias:"dsnList",itemIdField:"nU",allowHTML:false,onChange:function X(){var AB=this.parent.parent,AA=AB.dsnBox.dsnList.selectedItem,z=[];if(AA){g.forEach(AB.supportedDBs,function(AC){g.forEach(AC.dbVersions,function(AD){g.forEach(AD.connections.concat(AD.altconnections),function(AE){if(AE.driver===AA.des){z.push(AD);return false;}return true;});});});}if(AB.showUnavailable){u.call(AB,[],z);}else{u.call(AB,z);}}},{scriptClass:"mstrmojo.Button",slot:"0,1",onclick:function o(){var z=this.parent.parent.parent.parent.buttonsbox.buttonCancel;if(z){z.onclick();}mstrApp.getRootController().getDataService().submitRequest({},{taskId:"openODBCAdmin"});}}]},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dbIDSelectList",itemIdField:"id",caption:p,bindings:{visible:function(){return !this.parent.singleType;}},onChange:function X(z){var AA=this.parent,AB;if(z){AB=z.id;u.call(AA,AA.supportedDBs[g.find(AA.supportedDBs,"id",AB)].dbVersions);this.set("selectedID",AB);if((z.connType&4)!==4){AA.driverBox.addDriver.set("visible",AA.showAddDriver);}AA.updateLoginFn(z.stdLogin!==0);}}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dbmsList",itemIdField:"did",caption:T,bindings:{visible:function(){return !this.parent.singleType;}},onChange:function X(){var z=this.parent;if(z.isDSNLess&&z.dbIDSelectList.selectedItem){q.call(z);}this.selectedID=this.selectedItem.did;if(z.onDBMSSelectFn){z.onDBMSSelectFn(this.selectedItem);}}},{scriptClass:"mstrmojo.Box",alias:"driverBox",children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",alias:"hideUnavailable",label:I,oncheckedChange:function W(){var AC=window.localStorage;if(AC){AC.setItem(f,this.checked?"1":"0");}var AB=this.parent.parent,z,AA;if(AB.dbIDSelectList.items){z=AB.dbIDSelectList.selectedID;}if(AB.dbmsList.items){AA=AB.dbmsList.selectedID;}AB.showUnavailable=(this.checked);if(AB.isDSNLess){H.call(AB);if(AB.dbIDSelectList.hasRendered){if(!!(AB.dbIDSelectList.items.length)&&((!z)||(g.find(AB.dbIDSelectList.items,"id",z)<0))){z=AB.dbIDSelectList.items[0].id;AB.dbIDSelectList.selectedID=-1;AB.dbIDSelectList.set("selectedID",z);}else{AB.dbIDSelectList.onChange(AB.dbIDSelectList.selectedItem);}}}else{if(this.parent.parent.hasRendered){this.parent.parent.dsnBox.dsnList.onChange();}}if(AB.dbmsList.hasRendered){if(((!AA)||(g.find(AB.dbmsList.items,"did",AA)<0))&&(AB.dbmsList.items&&AB.dbmsList.items[0])){AA=AB.dbmsList.items[0].id;AB.dbmsList.selectedID=-1;AB.dbmsList.set("selectedID",AA);}}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-AddDriver",visible:false,alias:"addDriver",text:P,onclick:function o(){i=this.parent.parent;mstrApp.rootController.launchOneTierFileBrowser("mstrmojo.warehouse.dbroles.DBRoleDSNConnection.oneTierFileUploader");}}]},{scriptClass:"mstrmojo.Box",alias:"contents",cssClass:"mstrmojo-wh-DBRoleConnection-Box"}],dbObjects:{},dbVersions:[],dbTypes:[],preferences:{},dbIDs:{},supportedDBs:[],dsnMapDBs:[],drivers:[],getConnectionStr:function O(){if(this.isDSNLess){var z=this.contents.stringEditor;if(z.visibleContents&&z.enabledContents){return{str:z.getValue(),err:""};}}return t.call(this,true,true,undefined);},getVLDBProperties:function B(z){if(this.isDSNLess&&z){g.forEach(this.contents.children,function(AA){if(!(AA.field)){Z(AA,z);}});}},isValidInput:function F(){var z=this.contents.children,AA={val:false,msg:h};if(this.isDSNLess){g.forEach(z,function(AB){if(AB.isGroupSetting&&AB.visible){g.forEach(AB.children,function(AC){if(AC.alias!=="groupbox"){AA=AC.isValid();return(AA.val);}return true;});}else{AA=AB.isValid();}return(AA.val);});return AA;}return this.dsnBox.dsnList.isValid();},getDbmsID:function J(){return this.dbmsList.selectedItem.did;},getDBId:function A(){if(this.dbIDSelectList.selectedItem&&this.isDSNLess){return this.dbIDSelectList.selectedItem.id;}return 0;},getDBType:function x(){return this.dbmsList.selectedItem.db_type;},getCharEncodingForUnix:function b(){var AB=this.dbmsList.selectedItem,AA=AB.db_ver,z=g.find(this.dbVersions,"v",AA);if(z>=0){return this.dbVersions[z].unixEncoding;}return 1;},getDriverMode:function U(){return this.driverMode;},getOdbcv:function n(){if(this.getDBType()===this.dbTypes.Hive.v){return"20";}return"";},clear:function m(){this.set("info",{});}});mstrmojo.warehouse.dbroles.DBRoleDSNConnection.oneTierFileUploader=function(z){mstrApp.rootController.oneTierFileUploader({success:function AA(){i.dbObjects.reloadDrivers({success:function AB(){i.drivers=i.dbObjects.drivers;i.oninfoChange.call(i);}});}},{fp:z});};}());(function(){mstrmojo.requiresCls("mstrmojo.architect.menu._HasTableMenu","mstrmojo.architect.menu.ArchitectMenu");mstrmojo.architect.menu.DBTableMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,[mstrmojo.architect.menu._HasTableMenu],{scriptClass:"mstrmojo.architect.menu.DBTableMenu"});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.menu._HasTableMenu","mstrmojo.architect.menu.ArchitectMenu");mstrmojo.architect.menu.ProjectTableMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,[mstrmojo.architect.menu._HasTableMenu],{scriptClass:"mstrmojo.architect.menu.ProjectTableMenu"});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Box","mstrmojo.css","mstrmojo.DataGrid","mstrmojo._CanAutoClose","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.architect.menu._HasTableMenu","mstrmojo.architect.obj.Column","mstrmojo.warehouse.ui.BasePanel");var H=mstrmojo.array,M=mstrmojo.architect.EnumDataChangeEvents,D="px",K=mstrmojo.desc(12256,"View data and configure columns");function I(){var Q=this,P=Q.gridbox.dataview,O=["","","","",""];P.columns=[];P.columns.push({dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-sqlInput-gridCell",postCreate:function N(){this.set("text","");}},headerWidget:{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-sqlInput-gridHeaderText"}]}});P.items=O;P.render();P.domNode.style.width="200px";Q.gridbox.domNode.style.minWidth="100px";}function C(Q,N){var O=this,P=O.gridbox.dataview;P.columns=[];H.forEach(Q,function(T,S){P.columns.push({dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-sqlInput-gridCell",colIndex:S,postCreate:function U(){this.set("text",this.data[this.colIndex]);}},headerWidget:{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-sqlInput-gridHeaderText",text:T.cln},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-sqlInput-gridHeaderDelete",col:T,colIndex:S,onclick:function R(){var W=mstrApp.getRootController(),V=W.getTable(O.viewId),X=V.columns;X.splice(this.colIndex,1);V.updateViewDefinition();C.call(O,V.columns,this.parent.dataGrid.items);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-sqlInput-gridHeaderMenu",col:T,colIndex:S,onclick:function R(){var X=this,V=O.buildColumnDefEditor(this.col,O.viewId);var W=V.ENUM_CORNERS;V.setAlignment(W.TOP_RIGHT,W.TOP_LEFT);V.hostId=O.id;V.hostElement=this.domNode;V.hostProxyCssClass="item-mn-proxy-pnlicns";V.column=X.col;V.fnOk=function Z(){var d=this.contents.getEditorData(),a=mstrApp.rootController.getTable(O.viewId),c=a.columns[X.colIndex],b=X.col.cmid;c.cln=d.colName;c.dt.tp=d.type;c.dt.ps=d.precision;c.dt.sc=d.scale;if(b!==""){mstrApp.getRootController().updateColumn({cln:c.cln,cmid:b,dt:c.dt,tableId:a.id},c,{success:function e(){C.call(O,a.columns,X.parent.dataGrid.items);}});}};var Y=V.newInstance();Y.cssClass="mstrmojo-sqlInput-ColumnEditor";O.openPopup(Y);}}]}});});O.columns=Q;if(N){P.items=N;}P.render();P.domNode.style.width=(Q.length*200)+"px";}function J(N){var P=this,O=mstrApp.getRootController();P.viewId=N.value;if(!P.viewId){return ;}O.populateTableContents(P.viewId,{success:function Q(){var R=O.getTable(P.viewId);R.getSQLData(false,{success:function T(U){O.raiseExecuteSQLEvent(U.cols);},failure:function S(){O.raiseExecuteSQLEvent([]);}});}});}function E(V){var N=this,R=V.data,O,W=N.gridbox.dataview,S=[],P=mstrApp.rootController,T=P.getTable(N.viewId),Q=T.columns,U;if(R.length===0){I.call(this);return ;}W.columns=[];H.forEach(Q,function(Y,X){O=((R[X]&&R[X].data)||[]);H.forEach(O,function(Z,a){if(!S[a]){S[a]=[];}S[a][X]=Z.v;});});U=Q.length;if(R.length>U){H.forEach(R,function(Y,X){if(X<U){return true;}T.addColumnDef(Y.def);H.forEach(Y.data,function(Z,a){if(!S[a]){S[a]=[];}S[a][X]=Z.v;});});}C.call(N,Q,S);}function G(){var Q=document.createElement("div");Q.style.visibility="hidden";Q.style.width="100px";document.body.appendChild(Q);var O=Q.offsetWidth;Q.style.overflow="scroll";var N=document.createElement("div");N.style.width="100%";Q.appendChild(N);var P=N.offsetWidth;Q.parentNode.removeChild(Q);return O-P;}mstrmojo.architect.ui.panels.LogicalViewSQLDataPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo.architect.menu._HasTableMenu,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.architect.ui.panels.LogicalViewSQLDataPanel",cssClass:"sqlDataPanel",title:K,init:function L(O){this._super(O);var Q=this,N=mstrApp.getRootController(),P={},R=P[Q.id]={};Q.attributes={};R[M.LOGICALVIEW_SQLEXECUTED]=E;R[M.LOGICALVIEWS_CHANGED]=J;N.attachDataChangeListeners(P);},postBuildRendering:function A(){if(this._super){this._super();}I.call(this);},viewId:"",columns:[],onheightChange:function B(P){var Q=parseInt(P.value,10),O=this.headerHeight=this.headerHeight||(this.hasRendered?this.headerNode.clientHeight:36),N=(Math.max(Q-O,0))+D;this.height=Q+D;this.gridbox.set("height",N);},onwidthChange:function F(P){var O=parseInt(P.value,10),N=(Math.max(O,0)-1)+D;this.width=O+D;this.gridWidth=(O-G()-3)+D;this.gridbox.set("width",N);},children:[{scriptClass:"mstrmojo.Box",alias:"gridbox",cssClass:"mstrmojo-ar-sqlInput-sqlDataGridBox",children:[{scriptClass:"mstrmojo.DataGrid",alias:"dataview",cssClass:"mstrmojo-Architect-TablePreviewGrid",itemDisplayField:20,minColWidth:80,columns:[]}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.menu.ArchitectMenu","mstrmojo._HasContextMenu");var C=mstrmojo.architect.menu.EnumMenuActions,F=C.USE_AS_DRILL,E=C.USE_AS_BROWSE,B=mstrmojo.desc(13293,"Use as drill"),A=mstrmojo.desc(13294,"Use as browse");mstrmojo.architect.menu.UserHiearchySettingMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.UserHiearchySettingMenu",cssClass:"mstrmojo-architect-TransformationSettingMenu",id:"UserHiearchySettingMenu",isSeparatorItem:function D(G){return G[this.itemIdField]===-1;},cm:[{n:B,did:F,action:F},{n:A,did:E,action:E}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu");mstrmojo.requiresDescs(11411,11424,11417);var D=mstrmojo.architect.menu.EnumMenuActions,E=mstrmojo.desc(11411,"Sample Data"),A=mstrmojo.desc(11424,"Add to Project"),C=mstrmojo.desc(11417,"Update Structure");mstrmojo.warehouse.menu.AvailableTablesMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.AvailableTablesMenu",cm:[{action:D.ADD_TO_PROJECT,n:A},{action:D.UPSTRUCT,n:C},{action:D.NONE},{action:D.SAMPLE_DATA,n:E,icn:"smpl"}],executeCommand:function B(G){var H=this.data,F=mstrApp.getRootController();switch(G.action){case D.UPSTRUCT:F.getColumnsForDBTables({tables:[].concat(H),getFresh:true},{});break;case D.ADD_TO_PROJECT:F.addTables([].concat(H));break;case D.SAMPLE_DATA:F.showSampleData(H);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.menu.ArchitectMenu","mstrmojo._HasContextMenu");mstrmojo.architect.menu.ExpressionEditorMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,[mstrmojo._HasContextMenu],{scriptClass:"mstrmojo.architect.menu.ExpressionEditorMenu",isSeparatorItem:function C(D){return D[this.itemIdField]===-1;},cm:[{n:mstrmojo.desc(9925,"Functions"),did:-3,items:[{did:"1",n:"1"}],onContextMenuOpen:function B(){var D=this.parent.parent.target.functions,E=function E(F){mstrmojo.array.forEach(F,function(G){G.items=G.fns;E(G.items);});};E(D);if(this._subMenu){this._subMenu.set("items",D);}}},{n:mstrmojo.desc(11400,"Search Function..."),did:-999}],executeCommand:function A(D){var E=this.target;if(D.did===-999){E.showFunctionSelector();}else{E.showWizard(D);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.EnumMenuActions");var C=mstrmojo.desc(11399,"Remove from relation"),A=mstrmojo.architect.menu.EnumMenuActions;mstrmojo.architect.menu.AttributeMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.AttributeMenu",cm:[{action:A.ATTRIBUTE_FILTERS,n:"Define Attribute Filters"},{action:A.REMOVE_ATTR_FROM_RELATIONSHIP,n:C,icn:"del"},{action:A.SET_ENTRY_POINT,n:"Set as Entry Point"},{action:A.REMOVE_ENTRY_POINT,n:"Remove Entry Point"},{action:A.REL_ATTR_ELEMENT_DISPLAY,n:"Element Display",items:[],buildSubMenuConfig:function B(){return this.getMenuConfig([{n:"Limit",action:A.REL_ATTR_ELEMENT_LIMIT},{n:"Unlocked",action:A.REL_ATTR_ELEMENT_UNLOCK},{n:"Locked",action:A.REL_ATTR_ELEMENT_LOCK}]);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.EnumMenuActions");mstrmojo.requiresDescs(1088,629,1388,3397,12259,11425,4572);var G=mstrmojo.architect.menu.EnumMenuActions,C=G.NONE,E=G.EDIT,J=G.DELETE,N=G.RENAME,O=G.DUPLICATE,Q=G.CATALOG_SQL,D=G.SET_AS_PRIMARY,P=G.IS_PRIMARY,I=mstrmojo.desc(1088,"Edit"),B=mstrmojo.desc(629,"Delete"),H=mstrmojo.desc(1388,"Rename"),M=mstrmojo.desc(3397,"Duplicate"),L=mstrmojo.desc(12259,"Catalog SQL"),A=mstrmojo.desc(11425,"Set as Primary"),F=mstrmojo.desc(4572,"Primary");mstrmojo.warehouse.menu.DBConnectionsMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.DBConnectionsMenu",cm:[{action:E,n:I,icn:"edt"},{action:J,n:B,icn:"del"},{action:N,n:H,icn:"rnm"},{action:O,n:M},{action:D,n:A},{action:C},{action:P,n:F},{action:C},{action:Q,n:L,icn:"catsql"}],executeCommand:function K(S){var T=this.data,R=mstrApp.getRootController();switch(S.action){case E:R.editDBRole(T);break;case N:R.renameDBRole(T);break;case J:R.deleteDBRole(T);break;case O:R.duplicateDBRole(T);break;case D:R.setProjectPrimaryDBRole(T);break;case Q:R.displayCatalogSQL(T.did);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.EnumMenuActions","mstrmojo._HasContextMenu");var H=mstrmojo.array,C=mstrmojo.architect.menu.EnumMenuActions,A=C.NONE,G=mstrmojo.desc(11419,"Remove relation"),B=mstrmojo.desc(11420,"One to One"),E=mstrmojo.desc(11421,"One to Many"),D=mstrmojo.desc(11422,"Many to Many"),J=mstrmojo.desc(11423,"Relationship Table"),I=mstrmojo.desc(12219,"Add joint children");mstrmojo.architect.menu.RelationMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.RelationMenu",cm:[{action:C.DELETE_RELATIONSHIP,n:G,icn:"del"},{action:A},{action:C.ONE_TO_ONE,n:B},{action:C.ONE_TO_MANY,n:E},{action:C.MANY_TO_MANY,n:D},{action:A},{action:C.RELATIONSHIP_TABLE,n:J,items:[],buildSubMenuConfig:function F(){var M=this.data,L=mstrApp.getRootController().getTablesForRelationship(M.parentAttributeId,M.childAttributeId),K=[];H.forEach(L,function(N){K.push({did:N.did,n:N.n,action:C.RELATIONSHIP_TABLE_ENTRY,checked:(M.relationTableId===N.did)});});return this.getMenuConfig(K);}},{action:C.ADD_JOIN_CHILDREN,n:I,items:[],buildSubMenuConfig:function F(){var M=this,N=this.data,L=mstrApp.getRootController().getJointChildrenCandidates(N),K=[];H.forEach(L,function(O){K.push({did:O.did,n:O.n,action:C.ADD_JOIN_CHILDREN,isChecked:false});});return M.getMenuConfig(K);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.menu.ArchitectMenu","mstrmojo._HasContextMenu");var E=mstrmojo.architect.menu.EnumMenuActions,A=E.NONE,I=E.TX_ONE_TO_ONE,B=E.TX_MANY_TO_MANY,F=E.TX_APPLY_TO_ALL,M=E.TX_APPLY_TO_HIGHEST,K=mstrmojo.desc(12252,"Mappings"),C=mstrmojo.desc(11420,"One to One"),D=mstrmojo.desc(11422,"Many to Many"),H=mstrmojo.desc(12253,"Multiple attributes"),L=mstrmojo.desc(12254,"Apply transformation to all applicable attributes"),J=mstrmojo.desc(12255,"Only apply transformation to highest common child when it is applicable to multiple attributes");mstrmojo.architect.menu.TransformationSettingMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.TransformationSettingMenu",cssClass:"mstrmojo-architect-TransformationSettingMenu",id:"TransformationSettingMenu",isSeparatorItem:function G(N){return N[this.itemIdField]===-1;},cm:[{n:K,did:A,action:A},{n:C,did:I,action:I},{n:D,did:B,action:B},{n:H,did:A,action:A},{n:L,did:F,action:F},{n:J,did:M,action:M}]});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui.tabs.Tab","mstrmojo.ME.MetricEditBox","mstrmojo.array","mstrmojo.hash");var Z=mstrmojo.array,M=mstrmojo.hash,K=mstrmojo.ME.MetricToken.brackets,L=mstrmojo.dom,B=mstrmojo.css,Q=mstrmojo.vi.ui.tabs.Tab.ACTIONS,g=Q.DELETE+Q.RENAME,i=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,D=mstrmojo.string,k="This@ID",T="45C11FA478E745FEA08D781CEA190FE5";function G(o){return{n:o,k:o,ftk:[],vs:1,is:""};}function O(u,v,o,r){var q=u.forms[v]||{},t=u.forms[o],p=u.inputBox;if(v!==o){q.vs=u.vStatus;q.is=u.iStatus;q.ftk=p.items;u.set("vStatus",i.UNKNOWN);}u.set("vStatus",t.vs);u.set("iStatus",t.is);u.updateInputBoxItems({items:t.ftk});if(u.curFormIdx!==o){u.curFormIdx=o;u.tabstrip.setSelectedTab(t.k);}u.raiseEvent({name:"tabSwitch",tks:t.ftk,vs:t.vs,is:t.is,oidx:v,nidx:o,toNewTab:r});}function N(p){var o=p.forms[p.curFormIdx];if(o){o.ftk=p.inputBox.items;o.vs=p.vStatus;o.is=p.iStatus;}}var e=0;function W(o){e=Math.max(o.length-1,e);}function V(){e=0;}function l(o){var p="DESC"+(e?" "+e:"");e++;if(Z.find(o,"n",p)>=0){return l(o);}return p;}function I(r){var q={v:K(r.n),oi:r,isNew:true},p,o;if(r.t===12){p=Z.filter(r.fs,function(t){return t.obf||r.da;}).length;if(p===1){o=r.fs[0];q=M.copy({v:K(r.n)+"@"+K(o.fnm),ift:true,exv:o.fid,extp:8},q);}else{q=M.copy({v:K(r.n)+"@",ift:true},q);}}return q;}function E(p,o){p.set("enabled",!o);var q="mstrmojo-InlineWaitIcon";if(p.iconClass){p.set("iconClass",p.iconClass.replace(new RegExp(q),"")+" "+(o?q:""));}else{mstrmojo.css.toggleClass(p.domNode,q,o);}}var U=function(x){var r=x.items,t=r.length,u=r[r.length-1],q,p,w=[],o="",v;if(r[0]&&r[0].tp!==33){w.push({v:"!",tp:33,lv:4,sta:2});}for(q=0;q<t;q++){p=r[q];if(p.isNew&&!p.oi){o+=p.v;}else{if(!D.isEmpty(o)){w.push({v:o,tp:2,lv:1});o="";}if(p.v&&p.v.indexOf(k)>=0){p.v=p.v.replace("["+k+"]",k);p.exv=T;p.extp=8;delete p.oi;}w.push(p);}}if(!D.isEmpty(o)){w.push({v:o,tp:2,lv:1});o="";}if(u&&u.tp!==-1){w.push({v:"",tp:-1,lv:4,sta:2});}return{items:w};},a=function(q){var o=q.items||[],p=o[o.length-1];if(p&&p.tp===-1){o.pop();}if(o[0]&&(o[0].tp===33||o[0].tp===37)){o.splice(0,1);}Z.forEach(o,function(r){if(r.v&&r.v.indexOf(k)>=0){M.copy({extp:8,exv:T,oi:{n:"This",did:"This",t:12}},r);}});},Y=function(o){if(!o){return i.VALID;}return{"-2147214845":i.ERROR,"-2147214846":i.AMBIGUITY}[o]||i.ERROR;},R=function(q){q=U(q);var p={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true,vtp:true},o={getArrItemName:function(){return"tkn";},isSerializable:function(r){return(p[r])?true:false;}};return D.json2xml("tknstrm",q,o);},F=function(q,u,t,p){var r=R(u),v=function(w){if(w&&w.tks){var x=w.tks;a(x);x.vs=Y(x.rjec);x.tokenXML=r;if(p){p(x);}}},o=function(w){mstrmojo.alert(w.message||w.getResponseHeader&&w.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:r,localSymbolFolderXML:"",metricXML:"",metricId:q||"",isNew:true,objectType:12,isIDForm:t,msgID:mstrApp.getMsgID()},{success:v,failure:o});};mstrmojo.ME.DerivedAttributeFormTab=mstrmojo.declare(mstrmojo.vi.ui.tabs.Tab,null,{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",valid:true,editable:true,postBuildRendering:function S(){if(this._super){this._super();}var o=this,p=o.lbl;p.editOnDoubleClick=this.editable;p.onTextEditComplete=function(r,q){if(o.validate(p.text)){o.titleEdited(p.text,q);}};},onclick:function d(o){var p=mstrmojo.dom.eventTarget(o.hWin,o.e);if(p===this.menuBtnNode){this.tabDeleted();}else{if(!this.isSelected){this.tabSelected();}}},validate:function(o){var p=!/[\[\]\"\\]/g.test(o);if(!p){this.lbl.set("isEditing",true);}this.set("valid",p);return p;},showErrTooltip:function n(t,q){var o=mstrmojo.dom.position(this.domNode),p=this,r=p.errTooltip;if(!r){p.errTooltip=r=new mstrmojo.Tooltip({contentNodeCssClass:"me-tooltip-content up me-err",updatePopupConfig:null});this.addDisposable(r);}r.set("top",o.y+o.h+2);r.set("left",o.x+o.w/2-q);r.set("content",'<div class="content"><span>'+t+"</span></div>");r.open();window.setTimeout(function(){r.close();},2500);},onvalidChange:function(){if(this.valid){this.hideTooltip();}else{this.showErrTooltip(mstrmojo.desc(11569,"Input contains invalid character"),95);}}});function f(r,t,u){var q=Z.find(t,"k",u.k);return{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",title:u.n,draggable:false,editable:q!==0,cssClass:"mstrmojo-AEB-Tab "+(q===0?"mstrmojo-AEB-IDTab":""),getMenuActions:function(){return g;},tabSelected:function(){O(r,r.curFormIdx,q);},titleEdited:function p(w,v){if(w!==v){if(Z.find(r.forms,"n",w)>=0){this.showErrTooltip(mstrmojo.desc(7209,"Name already exists"),69);}var x=r.forms[q];x.n=w;}},tabDeleted:function o(){var v=r.forms.length,y=(r.curFormIdx===v-1)?0:r.curFormIdx,w=r.forms.slice(0),x=w[q];if(x&&x.did){r.delForms.push({n:x.n,did:x.did});}w.splice(q,1);r.curFormIdx=y;r.set("forms",w);O(r,-1,y);r.set("dirty",true);}};}mstrmojo.ME.AttributeEditBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,null,{scriptClass:"mstrmojo.ME.AttributeEditBox",markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-AEB-TabStrip"></div><div class="mstrmojo-MEBox-edit mstrmojo-AEB-edit"></div><div class="mstrmojo-MEBox-status {@statusCssClass}"><div class="mstrmojo-MEBox-vStatus"></div><div class="mstrmojo-MEBox-iStatus"></div></div></div>',markupSlots:{tabstripNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},statusNode:function(){return this.domNode.lastChild;},iStatusNode:function(){return this.domNode.lastChild.lastChild;},vStatusNode:function(){return this.domNode.lastChild.firstChild;}},forms:null,delForms:[],curFormIdx:0,attrid:null,absorbAmbiguity:false,init:function j(q){var r=this;r.children=[{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",alias:"tabstrip",position:"top",slot:"tabstripNode",isAlignRight:false,getTabCfg:function p(v,w,u){return M.copy(f(r,v,w),u);},addTab:function t(){var w=r.forms,u=w.length,x=l(w),v=w.slice(0);v.push(G(x));r.set("forms",v);O(r,r.curFormIdx,u,true);r.set("dirty",true);},clear:function o(){Z.forEach(this.children,function(u){u.hideTooltip();});}},{scriptClass:"mstrmojo.Button",alias:"clearBtn",slot:"tabstripNode",text:mstrmojo.desc(1763,"Clear All"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-clearAll",onclick:function(){r.inputBox.clearTokens([]);}},{scriptClass:"mstrmojo.Button",alias:"validateBtn",slot:"tabstripNode",text:mstrmojo.desc(11897,"Validate"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-validate",onclick:function(){r.validateCurrentForm();}}].concat(this.children);this._super(q);},item2textCss:function J(o){return this._super(o)||{21:"afm"}[o.t]||"";},onformsChange:function X(){var o=this.forms,p=o[this.curFormIdx].k;Z.forEach(o,function(q){a({items:q.ftk});});this.tabstrip.setTabs(o,p);W(o);},selectFormTab:function A(o){O(this,this.curFormIdx,o);},postBuildRendering:function S(){if(this._super){this._super();}this.clear();var o=this;this.inputBox.ondrop=function(x){if(!x.src.data||!x.src.data.item){return ;}var w=o.inputBox,t=w.ctxtBuilder.itemWidgets,u=M.copyProps(["did","n","t","fs"],x.src.data.item),r=I(u),v,p,q;x.src.data=r;mstrmojo.ListBase2.prototype.ondrop.call(this,x);if(o.ontokensModify){o.ontokensModify();}v=this.selectedIndices;if(u.t===12&&r.ift&&!r.exv){for(p in v){q=t[p];if(q){w.startTokenSuggestion(q);}}}w.clearSelect(true);B.removeClass(w.domNode,"unselectable");};},clear:function c(){this.curFormIdx=0;this.delForms=[];this.attrid=null;V();this.set("forms",[G("ID")]);this.inputBox.set("items",[]);this.inputBox.resetTokensCache();this.set("vStatus",i.UNKNOWN);this.set("iStatus","");this.tabstrip.clear();},validateCurrentForm:function C(p){var q=this,r=this.validateBtn,o=function(t){E(r,false);q.set("vStatus",t.vs);q.set("iStatus",t.rjed||"");q.updateInputBoxItems({items:t.items});q.statusNode.style.display="block";q.handleValidation(t);if(p){p(t.items,t.vs===i.VALID);}};q.set("vStatus",i.VALIDATING);E(r,true);F(this.attrid,{items:this.inputBox.items},q.curFormIdx===0,o);},validateAllForms:function m(q){var r=this,p=r.forms,o=0,t=function(w){var v=(o===0);if(w){var u=p[o-1];u.ftk=w.items;u.vs=w.vs;u.is=w.rjed||"";u.tokenXML=R({items:w.items});if(w.vs!==i.VALID){r.selectFormTab(o-1);r.handleValidation(w);if(q){q(null,false);}return ;}}if(o===p.length){if(q){q(p,true);}return ;}F(r.attrid,{items:p[o++].ftk},v,t);};N(r);t();},continueValidataion:function P(){this.validateCurrentForm();},getStatusDesc:function b(o){return{0:mstrmojo.desc(11655,"Valid Formula.")}[o];},onvStatusChange:function h(){this.statusNode.style.display=this.vStatus>=i.VALIDATING?"block":"none";},onObjectInsert:function H(r){var t=this.inputBox,q=I(r),o=t.insertTokens([q]),p;if(r.t===12&&q.ift&&!q.exv){p=t.ctxtBuilder.itemWidgets[o];if(p){t.startTokenSuggestion(p);}}}});mstrmojo.ME.AttributeEditBox.preprocessTokenStream=a;mstrmojo.ME.AttributeEditBox.postprocessTokenStream=U;mstrmojo.ME.AttributeEditBox.mapErrorCode=Y;mstrmojo.ME.AttributeEditBox.getTokenStreamXML=R;mstrmojo.ME.AttributeEditBox.validateSyntax=F;mstrmojo.ME.AttributeEditBox.prepareInsertToken=I;}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.dom","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.LoginEditor","mstrmojo.SessionManager");function O(b,Z){var a=(Z?"add":"remove")+"LoadingGraph";this.serverProxy[a](b);}var K=true,N="waitBox";mstrmojo._IsWebApp=mstrmojo.provide("mstrmojo._IsWebApp",{_mixinName:"mstrmojo._IsWebApp",serverProxy:null,init:function T(Z){this._super(Z);if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}},start:mstrmojo.emptyFn,styleName:"RWDocumentMojoStyle",modelFactory:null,enableWaitBox:false,onMobileDevice:function D(){return false;},isTouchApp:function G(){return false;},getContentDimensions:function X(Z){return null;},getConfiguration:mstrmojo.emptyFn,setInteractive:function J(Z){if(K!==Z){K=Z;mstrmojo.dom.toggleSelection(window.document.body,Z);return true;}return false;},isInteractive:function W(){return K;},addLoadingGraph:function E(Z){O.call(this,Z,true);},removeLoadingGraph:function U(Z){O.call(this,Z);},serverRequest:function R(f,g,a){try{g=g||{};a=a||{};var c=a.src||(arguments.callee&&arguments.callee.caller.name),Z=!this.enableWaitBox||a.silent,e=a.hideFailureErr,d=this;f.styleName=f.styleName||this.styleName;g=mstrmojo.func.wrapMethods(g,{submission:function(h){if(!Z){mstrmojo.all[N].requestId=h;}},failure:function(h){if(!Z){h.method=c;if(!(mstrApp.isSingleTier&&h.code===403)&&!e){mstrmojo.err(typeof h.mstrerr==="object"?h.mstrerr:h);}}},complete:function(){if(!Z){if(mstrmojo.all[N]){delete mstrmojo.all[N].requestId;}d.hideWait();}}});if(!Z){this.showWait(a&&a.waitBoxCfg);}window.setTimeout(function(){d.serverProxy.request(g,f,!!a.override,a);},0);}catch(b){mstrmojo.err(b);}},hasRequests:function Q(){return this.serverProxy.hasRequests();},getWaitBoxPosition:function(){return null;},isWaiting:function B(){var Z=mstrmojo.all[N];return !!(Z&&Z.visible);},showWait:function F(a){var c=this,d=mstrmojo.all[N]||mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:N,cssClass:"mstrWaitBox",draggable:false,showTitle:false,zIndex:99999,counter:0,displayMsg:null,position:null,ondisplayMsgChange:function b(){this.msgfield.set("text",this.displayMsg);},oncounterChange:function Z(){var f=this.counter,i=this.visible;if(f===0&&i){this.close();}else{if(f>0&&!i){this.open();mstrmojo.dom.center(this.editorNode);var e=this.position||c.getWaitBoxPosition();if(e){var h=e.top,g=e.left;if(h!==undefined){this.set("top",h+"px");}if(g!==undefined){this.set("left",g+"px");}}}}},children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrIcon-wait",alias:"icon"},{scriptClass:"mstrmojo.Label",cssClass:"mstrWaitMsg",alias:"msgfield"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrWaitCancel",alias:"cancelBtn",text:mstrmojo.desc(2140,"Cancel")}]});d.cancelBtn.set("visible",!!(a&&a.showCancel));d.cancelBtn.onclick=function(){c.serverProxy.cancelRequests();};if(a&&a.position){d.position=a.position;}else{d.position=null;}d.set("displayMsg",(a&&a.message)||mstrmojo.desc(11960,"Loading Data..."));if(!this._waitUserLogin){d.set("counter",d.counter+1);}else{this._waitCounter=this._waitCounter+1;}return d;},hideWait:function L(Z){var a=mstrmojo.all[N];if(a){a.set("counter",Z?0:Math.max(0,a.counter-1));}},startSessionManager:function S(a){var b=mstrApp,Z=b.enableAutomaticSessionRecovery&&b.maxSessionIdleTime;b.sessionManager=b.addDisposable(new mstrmojo.SessionManager(mstrmojo.hash.copy(a,Z?{timeBeforeSessionTimeoutWarning:mstrApp.timeBeforeSessionTimeoutWarning,maxSessionIdleTime:b.maxSessionIdleTime}:{})));if(Z){b.sessionManager.start();}},isSessionExpiredError:function Y(e){var d=2147760371,b=2147760372,a=2147758245,Z=2147759877;e=(e<0)?(4294967296+parseInt(e,10)):e;switch(e){case d:case b:case a:case Z:return true;}return false;},onSessionExpired:function V(b){if(mstrApp.authMode==mstrmojo.EnumAuthenticationModes.INTEGRATED){var e={evt:5005,src:mstrApp.name+"."+mstrApp.pageName+".5005"},a=(mstrApp.docModel&&mstrApp.docModel.bs)||(mstrApp.rootCtrl&&mstrApp.rootCtrl.docCtrl&&mstrApp.rootCtrl.docCtrl.model&&mstrApp.rootCtrl.docCtrl.model.bs)||(mstrApp.docModelData&&mstrApp.docModelData.bs);if(a){e.rwb=a;}mstrmojo.form.send(e);return ;}if(mstrApp.sessionManager){var d=mstrmojo.all[N],Z=d&&d.counter>0,c=this;this._waitCounter=-1;if(Z){this._waitCounter=d.counter-1;c.hideWait(true);}this._waitUserLogin=true;mstrApp.sessionManager.openLoginEditor({success:function(f){c._waitUserLogin=false;if(f&&f.sessionState){if(b){if(b.params.sessionState){b.params.sessionState=f.sessionState;}if(Z){d.counter=c._waitCounter;c.showWait();}mstrmojo.xhr.request(b.method,b.baseUrl,b.callback,b.params);}}},cancelRequests:function(){mstrApp.serverProxy.cancelRequests();}});}},updateSessionState:function M(Z){this.sessionState=Z;},onNavigateOut:mstrmojo.emptyFn,showHelpTopic:function A(a){var Z=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");if(a&&typeof a==="string"){Z+=a;}if(mstrApp.isSingleTier){window.FormWrapper.openPage(Z);}else{mstrApp.openPage(Z);}return false;},getSearchAutoCompleteDelay:function P(){return parseInt(mstrConfig&&mstrConfig.searchAutoCompleteDelay,10)||200;},getThemeClassName:function C(){return"mojo-theme-light";},openPage:function I(Z,a){window.open(Z,a);},modalEditorChange:function H(a,Z){}});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.ui.UnitList","mstrmojo.architect.ui.panels.BaseListPanel");var D=mstrmojo.array,K=mstrmojo.architect.EnumDataChangeEvents,E=mstrmojo.desc(12216,"User hierarchies"),L=mstrmojo.desc(12241,"Add user hierarchy"),F=mstrmojo.desc(12237,"Hide user hierarchies"),G="user hierarchy",C="Are you sure you want to delete $$ '##'?";function I(M){this.contentWidget.set("items",M.hierarchies||[]);}function H(N){var O=D.find(this.contentWidget.items,"did",N.itemID),M=this.contentWidget;if(O>=0){M.items[O].n=N.itemName;M.refresh();}}mstrmojo.architect.ui.panels.UserHierarchyListPanel=mstrmojo.declare(mstrmojo.architect.ui.panels.BaseListPanel,null,{scriptClass:"mstrmojo.architect.ui.panels.UserHierarchyListPanel",title:E,addTitle:L,hierarchyId:"",init:function J(N){N.showListBtnTitle=F;this._super(N);this.attributes={};var O={},P=O[this.id]={};P[K.USER_HIERARCHY_LOADED]=I;P[K.USER_HIERARCHY_CHANGED]=function M(Q){this.hierarchyId=Q.value;};P[K.VIEW_ITEM_RENAMED]=H;mstrApp.getRootController().attachDataChangeListeners(O);},getContentWidget:function A(){var M=mstrApp.getRootController(),P=this;return{scriptClass:"mstrmojo.architect.ui.UnitList",onItemDeleted:function N(R){mstrmojo.confirm(C.replace("##",R.n).replace("$$",G),{confirmBtn:{fn:function(){if(M.model.currentHierarchyID===R.did){M.closeViewObject();}M.deleteObject(R);}}});},singleSelect:function O(R){var S=this.items[R].did;if(P.hierarchyId!==S){M.switchUserHierarchy(S);}},onItemRenamed:function Q(S,R){var U=S.did;M.renameUserHierarchy(U,R,{success:function T(){M.updateViewListItem(U,R);}});}};},onItemAdd:function B(){mstrApp.getRootController().addUserHierarchy();}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.ui.UnitList","mstrmojo.architect.ui.panels.BaseListPanel");var I=mstrmojo.array,G=mstrmojo.hash,M=mstrmojo.architect.EnumDataChangeEvents,K=mstrmojo.desc(12230,"Hide logical views"),E=mstrmojo.desc(12251,"Add logical view"),A=mstrmojo.desc(12217,"Logical views"),F="logical view",H="Are you sure you want to delete $$ '##'?";function J(O){var N=[];G.forEach(O.views,function(P){N.push(P.getTableData());});this.contentWidget.set("items",N);this.viewId=O.value||"";}function B(O){var P=I.find(this.contentWidget.items,"did",O.itemID),N=this.contentWidget;if(P>=0){N.items[P].n=O.itemName;N.refresh();}}mstrmojo.architect.ui.panels.LogicalViewListPanel=mstrmojo.declare(mstrmojo.architect.ui.panels.BaseListPanel,null,{scriptClass:"mstrmojo.architect.ui.panels.LogicalViewListPanel",title:A,addTitle:E,viewId:"",init:function L(N){N.showListBtnTitle=K;this._super(N);var O={},P=O[this.id]={};P[M.LOGICALVIEWS_CHANGED]=J;P[M.VIEW_ITEM_RENAMED]=B;mstrApp.getRootController().attachDataChangeListeners(O);},getContentWidget:function C(){var Q=this,N=mstrApp.rootController;return{scriptClass:"mstrmojo.architect.ui.UnitList",singleSelect:function P(S){var T=this.items[S].did;if(Q.viewId!==T){N.switchLogicalView(T);}},onItemDeleted:function O(S){mstrmojo.confirm(H.replace("##",S.n).replace("$$",F),{confirmBtn:{fn:function(){if(N.model.currentLogicalViewID===S.did){N.closeViewObject();}N.deleteObject(S);}}});},onItemRenamed:function R(T,S){var V=T.did;N.renameLogicalView(V,S,{success:function U(){N.updateViewListItem(V,S);}});}};},onItemAdd:function D(){mstrApp.getRootController().addLogicalView(true,"");}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.ui.UnitList","mstrmojo.architect.ui.panels.BaseListPanel");var H=mstrmojo.array,J=mstrmojo.desc(12214,"Add transformation"),M=mstrmojo.architect.EnumDataChangeEvents,A=mstrmojo.desc(12211,"Transformation '%1' is in an invalid state, it needs to be fixed before proceeding"),F=mstrmojo.desc(12209,"Hide transformations"),C=mstrmojo.desc(12215,"Transformations"),E="transformation",G="Are you sure you want to delete $$ '##'?";function K(O){var P=H.find(this.contentWidget.items,"id",O.itemID),N=this.contentWidget;if(P>=0){N.items[P].name=O.itemName;N.refresh();}}function I(N){this.contentWidget.set("items",N.items||[]);}mstrmojo.architect.ui.panels.TransformationListPanel=mstrmojo.declare(mstrmojo.architect.ui.panels.BaseListPanel,null,{scriptClass:"mstrmojo.architect.ui.panels.TransformationListPanel",title:C,addTitle:J,init:function L(N){N.showListBtnTitle=F;this._super(N);var O={},P=O[this.id]={};mstrApp.getRootController().attachDataChangeListeners(O);P[M.TRANSFORMATIONS_CHANGED]=I;P[M.VIEW_ITEM_RENAMED]=K;mstrApp.getRootController().attachDataChangeListeners(O);},getContentWidget:function B(){var N=mstrApp.rootController;return{scriptClass:"mstrmojo.architect.ui.UnitList",singleSelect:function P(R){var U=this.items[R].id,T=N.model.currentTransformationId;if(T!==U){var S=N.preSwitchCheck(N.getTransformation(T),A,"name");if(S.canProceed){N.commitTransformation(T,{success:mstrmojo.emptyFn()});N.editTransformation(U);}else{mstrmojo.alert(S.msg);}}},onItemDeleted:function O(R){R.did=R.id;mstrmojo.confirm(G.replace("##",R.name).replace("$$",E),{confirmBtn:{fn:function(){if(N.model.currentTransformationId===R.did){N.closeViewObject();}N.deleteObject(R);}}});},onItemRenamed:function Q(T,R){T.did=T.id;var S=mstrApp.rootController,V=T.did,U=S.renameTransformation(V,R);if(U){S.updateViewListItem(V,R);}}};},onItemAdd:function D(){var O=mstrApp.rootController,P=O.model.currentTransformationId,N=O.preSwitchCheck(O.getTransformation(P),A,"name");if(N.canProceed){O.commitTransformation(P,{success:mstrmojo.emptyFn()});O.addTransformation(true,"");}else{mstrmojo.alert(N.msg);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.ui.UnitList","mstrmojo.architect.ui.panels.BaseListPanel");var E=mstrmojo.array,H=mstrmojo.desc(11386,"Add Layer"),K=mstrmojo.architect.EnumDataChangeEvents,F=mstrmojo.desc(12225,"Hide layers"),B=mstrmojo.desc(12250,"Are you sure you want to delete layer '##'?"),D=mstrmojo.desc(11142,"Layers");function J(L){this.contentWidget.set("items",L.layers);this.layerId=L.value;}function G(M){var N=E.find(this.contentWidget.items,"did",M.itemID),L=this.contentWidget;if(N>=0){L.items[N].n=M.itemName;L.refresh();}}mstrmojo.architect.ui.panels.LayerListPanel=mstrmojo.declare(mstrmojo.architect.ui.panels.BaseListPanel,null,{scriptClass:"mstrmojo.architect.ui.panels.LayerListPanel",title:D,addTitle:H,init:function I(L){L.showListBtnTitle=F;this._super(L);var M={},N=M[this.id]={};N[K.LAYER_CHANGE]=J;N[K.VIEW_ITEM_RENAMED]=G;mstrApp.getRootController().attachDataChangeListeners(M);},getContentWidget:function A(){var O=this,L=mstrApp.getRootController();return{scriptClass:"mstrmojo.architect.ui.UnitList",singleSelect:function N(Q){var R=this.items[Q].did;if(O.layerId!==R){L.switchLayer(R);}},onItemDeleted:function M(Q){mstrmojo.confirm(B.replace("##",Q.n),{confirmBtn:{fn:function(){if(L.model.currentlayerID===Q.did){L.closeViewObject();}L.deleteLayer(Q.did);}}});},onItemRenamed:function P(R,Q){var T=R.did,S=L.renameLayer(T,Q);if(S===true){L.updateViewListItem(T,Q);}}};},layerId:"",onItemAdd:function C(){mstrApp.getRootController().addLayer(null,true,"");}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.string","mstrmojo.form","mstrmojo._FormatDefinition","mstrmojo.ME.MetricDataService","mstrmojo.ME.MetricEditBox","mstrmojo.mstr.EnumDataType","mstrmojo.ME.Enum");mstrmojo.requiresDescs(218,219,221,531,628,1442,1918,2102,2116,2154,2213,2919,5298,5424,5728,5891,7558,7984,7987,11566,13249);var F=mstrmojo.string,m=mstrmojo.mstr.EnumDataType,A=mstrmojo.ME.MetricDataService;function R(r){var o=r.items,S=o.length,q="",p;for(p=0;p<S;p++){q+=o[p].v;}return q;}var J=mstrmojo.dom,E=mstrmojo.string,P=mstrmojo._FormatDefinition,j=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,C=mstrmojo.ME.Enum.METRIC_EDIT_TYPES;var U=function(S){if(!S){return j.VALID;}return{"-2147214845":j.ERROR,"-2147214846":j.AMBIGUITY}[S]||j.ERROR;},T=function(v){var r=v.items,o=r.length,u=r[r.length-1],q,t,p=[],S="";if(r[0]&&r[0].tp!==38){p.push({v:"&",tp:38,lv:4,sta:2});}for(q=0,o=r.length;q<o;q++){t=r[q];if(t.isNew&&!t.oi){S+=t.v;}else{if(!E.isEmpty(S)){p.push({v:S,tp:2,lv:1});S="";}p.push(t);}}if(!E.isEmpty(S)){p.push({v:S,tp:2,lv:1});S="";}if(u&&u.tp!==-1){p.push({v:"",tp:-1,lv:4,sta:2});}return{items:p};},N=function(p){var q=T(p.tks);var o={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true},S={getArrItemName:function(u,r,t){return"tkn";},isSerializable:function(u,t,r){return(o[u])?true:false;}};return E.json2xml("tknstrm",q,S);},i=function(q){var o=q.items,S=o.length,p=o[o.length-1];if(p&&p.tp===-1){o.pop();}if(o[0]&&o[0].tp===38){o.splice(0,1);}},k=function(S){return"";},g=function(S,p){var o=[];S.oi.tks.items=o;p.clearTokens(o);},K=function(t,r){var q=[];q.push("<mt>");if(t.fmt&&!r){var S={getArrItemName:function(x,u,w){return x.substr(0,x.length-1);},isSerializable:function(AB,z,y){if(mstrmojo.array.indexOf(["header_format","grid_format"],AB)>-1){var AC=z[y][AB];if(!AC){return{};}var w="<"+AB+">",AA;for(AA in AC){w+="<prs n='"+AA+"'>";var v=AC[AA],u;for(u in v){var x=v[u];w+="<pr n='"+u+"' v='"+(x==="pru"?"":x)+"'";w+=x==="pru"?' pru="1"':"";w+="/>";}w+="</prs>";}w+="</"+AB+">";return{child:w};}return true;},skipNull:true};q.push(E.json2xml("fmt",t.fmt,S));}if(t.prss&&!r){var p={getArrItemName:function(x,u,w){return x.substr(0,x.length-1);},isSerializable:function(AB,y,w){if(mstrmojo.array.indexOf(["AnalyticalEngineProperties","DatamartProperties","VLDBSelect","VLDBFunction","VLDBReport"],AB)>-1){var x=y[w][AB];if(!x){return{};}var v=[],z=[],AA;v.push("<prs n='"+AB+"' ");for(AA in x){var u=x[AA];if(u!=null){if(typeof u==="object"){z.push(E.json2xml("pr",u,{skipNull:true,convertBoolean:true,isSerializable:function(AE,AD,AC){return true;}}));}else{v.push(AA+"='"+u+"' ");}}}v.push(">");v.push(z.join(""));v.push("</prs>");return{child:v.join("")};}return true;},skipNull:true};q.push(E.json2xml("prss",t.prss,p));}if(t.mps){q.push(E.json2xml("mps",t.mps,{skipNull:true,convertBoolean:true,isSerializable:function(w,v,u){return true;}}));}if(t.datp&&!r){q.push(E.json2xml("datp",t.datp,{skipNull:true,convertBoolean:true,isSerializable:function(w,v,u){return true;}}));}if(t.sbs&&!r){var o={getArrItemName:function(x,u,w){return(x==="avs")?"sb":x.substr(0,x.length-1);},isSerializable:function(w,v,u){return true;},skipNull:true};q.push(E.json2xml("sbs",t.sbs,o));}q.push("</mt>");return q.join("");},G=function(o,S){o.set("enabled",!S);var p="mstrmojo-InlineWaitIcon";if(o.iconClass){o.set("iconClass",o.iconClass.replace(new RegExp(p),"")+" "+(S?p:""));}else{mstrmojo.css.toggleClass(o.domNode,p,S);}},H=function(o,S){var p={taskId:"saveMetricDefinition",tokenStreamXML:N(o),localSymbolFolderXML:k(o),metricXML:K(o),metricId:o.did||"",outputFlags:327695,description:o.desc||"",name:o.n||"",saveAs:S};if(E.isEmpty(o.metricId)){p.isNew=true;}return p;},M=function(p){var o=function(q){var t=this.parent;var r=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##","Object").replace("'###'","");if(t){t.ob.refreshContent();t.onObjectSaved({name:t.name,did:q.did,desc:t.desc});r=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",t.typeDesc||"Object").replace("###",t.name);}mstrmojo.alert(r,p.onSaved,mstrmojo.desc(7984,"Object Saved"));if(t){t.close();}p.dirty=false;},S={success:o,failure:mstrmojo.SaveAsEditor.SAVEAS_CALLBACK.failure};return S;},L=function(v,r){var p=this;G(p,true);var w=mstrmojo.ME._MetricEditorHelper.oi=v.oi,q=N(w),t=k(w),u=K(w,true),x=function(y){if(y&&y.tks){var z=y.tks;i(z);w.tks=z;v.checkEditorFallback(v.ide.candidates.items,w);z.vs=U(z.rjec);v.set("vStatus",z.vs);v.set("iStatus",z.rjed||"");if(v.handleValidation){v.handleValidation(z);}if(r&&(z.vs===j.VALID)){switch(r){case"save":case"saveAs":if(v.isDME){v.handleDerivedMetricAction(r,w);}else{v.handleMetricAction(r,w);}break;case"switch":if(v.cbSwtichEditor){v.cbSwtichEditor(v);}break;}}else{if(r&&z.vs===j.ERROR){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));}}}},o=function(y){mstrmojo.alert(y.message||y.getResponseHeader("X-MSTR-TaskFailureMsg"));},S=function(y){G(p,false);};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:q,localSymbolFolderXML:t,metricXML:u,metricId:w.did,isNew:E.isEmpty(w.did),msgID:v.ide.isDME?mstrApp.getMsgID():null},{success:x,failure:o,complete:S});},D=function(o,q){var r=q,S=r.oi.fmt,p=P.MetricFormatTarget;G(o,true);window.setTimeout(function(){if(!S){S=r.oi.fmt={};var t;for(t=0;t<p.length;t++){S[p[t].p]={};}}var u=J.position(o.domNode,true);r.openPopup("formatPopupRef",{zIndex:r.zIndex+10,model:S,left:Math.max(0,(u.x-(r.formatPopupRef.width||565)))+"px",top:u.y+"px"});G(o,false);},50);},e=function(p,q){var r=q,S=r.oi,o=function(){var t=J.position(p.domNode,true);r.openPopup(mstrmojo.all.mstrMEOptionsDialog||"optionPopupRef",{zIndex:r.zIndex+10,model:S,funcs:r.funcs,left:Math.max(0,(t.x-(r.optionPopupRef.width||565)))+"px",top:t.y+"px"});};if(!r.isDME&&!r.funcs){G(p,true);mstrmojo.ME.MetricDataService.getSubtotalFunctions(null,{success:function(t){if(t.items){r.funcs=t.items;o();G(p,false);}},failure:function(t){mstrmojo.alert(t.message||t.getResponseHeader("X-MSTR-TaskFailureMsg"));G(p,false);}});}else{o();}};mstrmojo.ME._MetricEditorHelper=mstrmojo.provide("mstrmojo.ME._MetricEditorHelper",{noCache:true,useKeyDelay:true,tbBrowsable:true,functionNameRef:{scriptClass:"mstrmojo.Label",alias:"fnLabel",cssClass:"mstrmojo-ME-fct-name",bindings:{visible:function(){return !this.parent.insertMode;},text:function(){return mstrmojo.desc(5424,"Function:")+" "+this.parent.fctName;}}},nameEditBoxRef:{scriptClass:"mstrmojo.Box",alias:"nameEditBox",cssClass:"mstrmojo-ME-nameEditBox",cssDisplay:"inline-block",visible:false,bindings:{visible:function(){return !this.parent.insertMode&&this.parent.visible;}},onvisibleChange:function(S){if(S.value==false){return ;}var o=this;if(!o.tmr){o.tmr=window.setInterval(function(){if(o.domNode){window.clearInterval(o.tmr);delete o.tmr;o.nameInput.inputNode.select();}},50);}},children:[{alias:"nameInput",scriptClass:"mstrmojo.TextBoxWithLabel",inputNodeCssClass:"mstrmojo-ME-nameInput",value:mstrmojo.desc(2213,"New metric"),size:20,useRichTooltip:true,showErrTooltip:function n(){var o=J.position(this.domNode),S=E.isEmpty(this.value)?mstrmojo.desc(9122,"Name cannot be empty"):mstrmojo.desc(11569,"Input contains invalid character");this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+S+"</span></div>",top:o.y-5,left:o.x+o.w+10};this.hasOpenTooltip=false;this.showTooltip();},bindings:{value:function(){var S=this.parent.visible;return this.parent.parent.oi.alias||this.parent.parent.oi.n;},label:function(){var o=this.parent.parent.ide||{},S=o.nameLabel||mstrmojo.desc(11566,"Metric Name:");return this.parent.parent.oi.alias?mstrmojo.desc(13249,"Display Name:"):S;}},onvalueChange:function(p){var S=this.parent.parent.ide.action.alias,u=function(w){return !E.isEmpty(w)&&(S?true:!/[\[\]\"\\]/g.test(w));},t=u(this.value);if(t){this.hideTooltip();}else{this.showErrTooltip();}mstrmojo.css.toggleClass(this.parent.domNode,"err",!t);var q=this.parent.parent;q.set("cValid",t);var r=q.oi;if(r){var o={n:r.n,alias:r.alias};r.n=this.value;r.alias=this.value;if(r.n!==o.n&&r.alias!==o.alias){q.dirty=true;}}}}]},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:"Metric",browsableTypes:"4,8",onObjectSaved:function(r){var q=this.opener,S=q&&q.oi;if(q&&S){S.did=r.did;S.n=r.name;S.desc=r.desc;q.set("title",mstrmojo.desc(2154,"Metric:")+" "+r.name);}}},optionPopupRef:{id:"mstrMEOptionsDialog",scriptClass:"mstrmojo.ME.OptionDialog",title:mstrmojo.desc(9572,"Advanced Metric Options"),help:"Advanced_Metric_Options_dialog_box.htm",height:340},formatPopupRef:{scriptClass:"mstrmojo.ME.MetricFormatEditor",contentNodeCssClass:"mstrmojo-balloon",alias:"formatEditor",title:mstrmojo.desc(2116,"Format"),left:"100px",top:"100px",useAnimate:false,height:360,width:565,help:"Format_Metric_dialog_box.htm",locksHover:true},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px;",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},switchRef:{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"switchToMetricEdtior",cssClass:"mstrmojo-ME-switch mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(9563,"Switch to Formula Editor"),closeAfterSwitch:true,bindings:{visible:function(){return !this.parent.insertMode;}},getEditor:function(){return this.parent;},getFormulaEditorId:function(){var S=this.getEditor();return(S.ide&&S.ide.formulaEditorId)||"mstrME";},onclick:function(){var p=this.getEditor(),o=this.getFormulaEditorId();p.oi.tks.items=p.getMetricDefAsTokens();var S={vStatus:mstrmojo.ME.MetricEditBox.VALIDATION_STATUS.UNKNOWN,oi:p.oi,did:p.oi.did};if(p.dirty){S.dirty=p.dirty;}p.switch2Editor(o,S);if(p.ide){p.ide.set("showLeftPanel",true);p.set("simple",false);}}},formatAndOptionsBarRef:{scriptClass:"mstrmojo.HBox",alias:"formatbar",cssClass:"mstrmojo-ME-formatbar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link format",alias:"formatButton",text:mstrmojo.desc(1918,"Format"),bindings:{visible:function(){return this.parent.parent.tbFormatable&&!this.parent.parent.insertMode;}},onclick:function(){D(this,this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link property",alias:"optButton",text:mstrmojo.desc(13035,"Metric Options"),bindings:{visible:function(){var S=this.parent.parent;return !S.insertMode&&!S.ide.disableAFB;}},onclick:function(){e(this,this.parent.parent);}}]},saveLabel:mstrmojo.desc(5891,"Save"),saveAsLabel:mstrmojo.desc(628,"Save As"),closeLabel:mstrmojo.desc(221,"Cancel"),saveAsEnabled:true,cValid:true,buttonBarRef:{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:"",bindings:{enabled:function(){return this.parent.parent.cValid;},text:function(){return this.parent.parent.insertMode?mstrmojo.desc(531,"Add"):this.parent.parent.saveLabel;}},onclick:function(){var o=this.parent.parent;if(!o.insertMode&&o.isDirty&&!o.isDirty()){o.close();o.onCancel();return ;}if(!o.cValid){return ;}if(o.insertMode){o.insertOnFinish(o.getMetricDefAsTokens());o.close();}else{if(o.getMetricDefAsTokens){o.oi.tks.items=o.getMetricDefAsTokens();}var S=this;if(o.validateAndSave){G(S,true);o.validateAndSave(o.oi,function(){G(S,false);});}else{if(o.ide&&o.ide.validateAndSave){G(S,true);o.ide.validateAndSave(o.oi,function(){G(S,false);});}else{o.tbValidate=this;L.call(this,o,"save");}}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",alias:"btnSaveAs",text:mstrmojo.desc(628,"Save As"),bindings:{visible:function(){return !this.parent.parent.insertMode&&!this.parent.parent.isDME;},text:function(){return this.parent.parent.saveAsLabel;}},onclick:function(){var S=this.parent.parent;if(S.getMetricDefAsTokens){S.oi.tks.items=S.getMetricDefAsTokens();}S.tbValidate=this;L.call(this,this.parent.parent,"saveAs");}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.parent.closeLabel;}},onclick:function(){var S=this.parent.parent;if(S.onPreClose()){S.close();if(!S.insertMode){S.onCancel();}}}}]},validateSyntax:function B(S){L.call(S,this);},validateSyntaxAndSwitch:function Y(S){L.call(S,this,"switch");},preprocessTokenStram:function Q(S){i(S);},isDirty:function f(){if(this.insertMode){return false;}return this.dirty||this.oi.dirty||(this.oi.fmt||{}).dirty||(this.oi.mps||{}).dirty;},onmetricModify:function d(){this.dirty=true;},save:function O(){this.buttonBar.btnSaveAs.onclick();},prompt2saveRef:{scriptClass:"mstrmojo.Editor",cssText:"width:350px;",title:mstrmojo.desc(5728,"Confirm save"),children:[{scriptClass:"mstrmojo.Label",cssText:"margin:5px 5px 20px;",allowHTML:true,bindings:{text:function(){return mstrmojo.desc(9573,"Do you want to save changes made to #?").replace("#","<b>"+this.parent.opener.oi.n+"</b>");}}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"left",cssText:"width:10px;"},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(219,"Yes"),onclick:function(){var S=this.parent.parent;S.opener.save();S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(218,"No"),onclick:function(){var S=this.parent.parent;S.opener.close();if(S.opener.onCancel){S.opener.onCancel();}S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var S=this.parent.parent;S.close();}}]}]},prompt2save:function(){if(this.getMetricDefAsTokens){this.oi.tks.items=this.getMetricDefAsTokens();}this.openPopup("prompt2saveRef",{zIndex:this.zIndex+1});},handleMetricAction:function b(p,o){var S=this;var q=H(o,false);if((p==="save")&&o.did){mstrmojo.xhr.request("POST",mstrConfig.taskURL,M(S),q);}else{if(((p==="save")&&E.isEmpty(o.did))||p==="saveAs"){q.saveAs=true;S.openPopup("saveasRef",{zIndex:S.zIndex+10,folderLinksContextId:17,name:o.n||o.name||(S.name&&S.name.value)||mstrmojo.desc(2213,"New Metric"),saveParams:q,saveAsCallback:function(){var r=M(S);if(r.success){var t=r.success;r.success=function(u){t.call(this,u);if(S.ide.noRefresh!==true){var v=mstrApp;mstrmojo.form.send({evt:5005,src:v.name+"."+v.pageName+".5005"});}};}return r;}});}}},handleDerivedMetricAction:function c(r,q){q=q||this.oi;if(r==="save"){var S={tokenStreamXML:N(q),alias:q.n};var o=q.mps||{};if(o.dirty){if(o.fbf===0){o.afb=o.sfb=-1;}S.afb=o.afb;S.sfb=o.sfb;}var t=mstrmojo.all.mstrMetricIDE,p=t.disableAFB;if(p){S.afb=0;S.sfb=1;}t.onApplyMetricCallback(S);t.close();}},onPreClose:function(){var S=this;if(S.isDirty&&S.isDirty()&&!this.isDME){S.prompt2save();return false;}return true;},onClose:function W(){this.dirty=false;if(this.onPostClose){this.onPostClose();}},init:function l(p){if(this._super){this._super(p);}var q=mstrApp,S=q&&q.useQuickSearch&&q.useQuickSearch(),o=S?((q&&q.searchAutoCompleteDelay&&q.searchAutoCompleteDelay())||0):0;this.suggestDelay=o||200;this.noCache=this.noCache&&S&&!this.isDME;this.ob.children[0].quickSearch=S;mstrmojo.ME.MetricDataService.suggestDelay=this.suggestDelay;mstrmojo.ME.MetricDataService.noCache=this.noCache;},_setupCandidatesCache:function h(S){if(this.candidates&&S){S.candidates=null;S.set("candidates",this.candidates);}},item2textCss:function I(S){return"mstrmojo-ME-icon t"+S.t+(S.st?" st"+S.st:(S.um||S.da?"d":""));},getSpecialFunctionEditorId:function a(S,q){var p=S&&S.did,o;if(p){if(mstrmojo.ME.MetricDataService.isBasicAggMap(p)){o="mstrSME";}else{if(mstrmojo.ME.MetricDataService.isRank(p)){o="mstrRFE";}else{if(A.isOLAPAgg(p)){o="mstrOFE";}else{o="mstrFE";}}}if(o){o+=q?"_1":"";}}return o;},isDimty:function(o,S){return(/^@[a-z]{1,}(\s*[+-]\s*\d{1,})?$/i).test(F.trim(o));},validateByDataType:function Z(o,S){var p=false;switch(o){case m.DataTypeInteger:p=/^(-)?\d+$/.test(S);break;case m.DataTypeNumeric:case m.DataTypeReal:case m.DataTypeDouble:p=mstrmojo.num.isNumeric(S);break;case m.DataTypeChar:case m.DataTypeVarChar:p=true;break;case m.DataTypeDate:case m.DataTypeTimeStamp:p=true;break;default:p=true;}return p;},getRootFunction:function X(p){var o,S=p&&p.tks&&p.tks.met;if(S!==C.ADVANCED){var q=p.tks.items[0];o=q&&q.oi;}return o;},checkEditorFallback:function V(S,q){var o=this.getRootFunction(q),p=mstrmojo.array.find(S,"did",o&&o.did)===-1;if(p&&q&&q.tks&&q.tks.items&&q.tks.items.length>0){q.tks.met=C.ADVANCED;}return p;}});mstrmojo.ME._MetricEditorHelper.getTokenStreamXML=N;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.ME.MetricEditBox");var O=mstrmojo.array,P=mstrmojo.dom,B={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3},I={0:"valid",1:"unknown",2:"validating",3:"error"},M={0:mstrmojo.desc(9105,"Valid Expression Formula."),1:mstrmojo.desc(9106,"Require Validation?"),2:mstrmojo.desc(9107,"Validation in Progress..."),3:mstrmojo.desc(9108,"Validation Failed with Syntax Error")},R=["(",")","{","}","-","+","*","/","<",">","=","|","~",","," ","\t","\n",";"],Q=null;function C(S){return !S?B.VALID:B.ERROR;}function J(T){var S;if(!Q){Q={};for(S=0;S<R.length;S++){Q[R[S]]=true;}}return Q[T];}function G(S){return"["+S+"]";}mstrmojo.architect.ExpressionEditBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,[mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ExpressionEditBox",markupMethods:{onvStatusChange:function A(){var T=this.vStatus,S=this.vStatusNode;S.className="mstrmojo-MEBox-vStatus "+I[T];S.innerHTML=M[T];},oniStatusChange:function N(){this.iStatusNode.innerHTML=this.iStatus;}},handleValidation:function F(T,V){if(!T){this.set("vStatus",B.ERROR);return ;}T.vs=C(T.reject_error_code);this.set("vStatus",T.vs);this.set("iStatus",T.reject_error_description||"");var U=T.tknstrm.mi["in"].oi,W=[],S;if(!U){return ;}O.forEach([].concat(U),function(X){if(X.tp===26){S=X.did;return false;}return true;});this.parent.oi.cmid=S||"68AC1409417D6232E6DADFB198A8A245";O.forEach(T.tknstrm.mi.tkn,function(X){var Y={};Y.sta=X.sta;if(X.orf){Y.v=X.orf.c?G(X.v):" "+X.v+" ";Y.oi=X.orf;}else{Y.v=X.v.toString();}W.push(Y);});this.inputBox.set("items",W);if(!V){this.inputBox.focus();}},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",cssText:"height:100px;",browseItemVisible:false,renderBlockSize:1000,item2textCss:function H(S){return{11:" mstrmojo-ArchitectListIconSuggest t11 ",26:" mstrmojo-ArchitectListIconSuggest t26 "}[S.tp||S.t]||"";},ondropCuePosChange:function L(){this.dropCueNode.style.visibility="hidden";},breakOnEnterKeyDown:function K(){return !this.suggestionShown;},getCharacter:function D(T){var S=(P.isIE&&!P.isIE9)?T.keyCode:T.charCode;return(S>0)?((S===13)?"\n":String.fromCharCode(S)):null;},itemFunction:function E(T){return new mstrmojo.ME.MetricToken({data:T,brackets:G,isDelimiter:function S(){var U=this.data,V=U.v.length;if(U){return U.isDelimiter||(V===1&&J(U.v));}return false;}});},isDelimiter:J}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.ME.MetricEditBox","mstrmojo.warehouse._CanToggleAvatarClass");var T=mstrmojo.array,I=mstrmojo.string,W=mstrmojo.css,U=mstrmojo.dom,Q="visible",Y=["(",")","{","}","-","+","*","/","<",">","=","|","~",","," ","\t","\n",";"],X=null,A=mstrmojo.warehouse.EnumObjectTypes,L=A.TABLE,O=A.COLUMN;function M(a){var Z;if(!X){X={};for(Z=0;Z<Y.length;Z++){X[Y[Z]]=true;}}return X[a];}mstrmojo.architect.ui.SQLInputBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,[mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.SQLInputBox",cssClass:"mstrmojo-ar-sqlInput-inputbox",dropZone:true,allowDrop:function B(a){var b=[].concat(a.src.data)[0],Z=mstrApp.rootController.model;if(!b){return false;}if(!((b.tp===O)||(b.tp===L))){return false;}return(Z.SelDBRoleID===Z.projPrimaryDBRoleID);},ondrop:function S(b){var d=this,c=[].concat(b.src.data)[0],a=this.inputBox.items,f=function f(g){a=[{v:"select"}];a.push({v:String.fromCharCode(10)});T.forEach(g,function(h){a.push({v:h.cln});a.push({v:", "});});a.pop();a.push({v:String.fromCharCode(10)});a.push({v:"from"});a.push({v:String.fromCharCode(10)});a.push({v:c.n});d.inputBox.set("items",a);d.parent.execSQL.onclick({cancel:mstrmojo.emptyFn});d.inputBox.focus();};if(!c){return ;}this.inputBox.set("items",[]);switch(c.tp){case O:a.push({v:c.cln});this.inputBox.set("items",a);break;case L:var Z=(b.src.widget.alias==="dbTableTree");if(Z){mstrApp.rootController.getColumnsForDBTable({data:c},{success:function e(g){f(g.items);}});}else{mstrApp.rootController.model.getAttributesFactsInTable(c.did,{success:function e(){f(mstrApp.rootController.model.getTable(c.did).columns);}});}break;}},postBuildRendering:function R(){if(this._super){this._super();}this.onheightChange({value:this.height});this.onwidthChange({value:this.width});this.reset();},onheightChange:function G(a){var b=this.inputBox,Z=a.value;if(b.hasRendered&&Z!==undefined){b.height=Z;b.domNode.style.height=Z;b.editNode.style.height=Z;}},onwidthChange:function J(Z){var b=this.inputBox,a=Z.value;if(b.hasRendered&&a!==undefined){b.width=a;b.editNode.style.width=a;}},tables:[],columns:[],sqlFunctions:[{n:"Select"},{n:"Update"},{n:"Insert"},{n:"Delete"},{n:"Create"},{n:"Drop"},{n:"Alter"},{n:"Set"},{n:"Exec"},{n:"From"},{n:"Where"},{n:"Having"},{n:"In"},{n:"Group"},{n:"By"},{n:"Order"},{n:"Into"},{n:"On"},{n:"Values"},{n:"Table"},{n:"Case"},{n:"Then"},{n:"Else"},{n:"Join"},{n:"As"}],getSQLStatement:function E(){var Z=[];T.forEach(this.inputBox.items,function(a){Z.push(a.v);});return I.trim(Z.join("").replace(/<\s/g,"<").replace(/>\s/g,">"));},setSQLStatement:function H(f){var c=[],b,d="\n",Z=", ",e=f.split(d),a;T.forEach(e,function(g){b=I.trim(g);if(b.indexOf(Z)>0){a=b.split(Z);T.forEach(a,function(h){c.push({v:I.trim(h)});c.push({v:Z});});c.pop();}else{c.push({v:b});}c.push({v:d});});this.inputBox.set("items",c);},onvisibleChange:function N(){W.toggleClass(this.domNode,Q,this.visible);W.toggleClass(this.inputBox.domNode,Q,this.visible);},reset:function V(){var Z={items:this.sqlFunctions.concat(this.tables).concat(this.columns),isComplete:true};this.inputBox.set("candidates",Z);this.inputBox.set("items",[]);},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",cssClass:"mstrmojo-ar-sqlInput-tokenbox",alias:"inputBox",slot:"editNode",browseItemVisible:false,renderBlockSize:1000,lastPagePos:{left:0,top:0,width:0,height:0},lastScrollPos:{left:0,top:0,width:0,height:0},breakOnEnterKeyDown:function P(){return !this.suggestionShown;},getCharacter:function C(a){var Z=(U.isIE&&!U.isIE9)?a.keyCode:a.charCode;return(Z>0)?((Z===13)?"\n":String.fromCharCode(Z)):null;},ondrop:function(Z){this.parent.ondrop(Z);},ondragenter:function K(Z){this.parent.ondragenter(Z);},allowDrop:function B(Z){return this.parent.allowDrop(Z);},item2textCss:function F(Z){return{15:" mstrmojo-ArchitectListIconSuggest t15 ",26:" mstrmojo-ArchitectListIconSuggest t26 "}[Z.tp||Z.t]||"";},itemFunction:function D(a){return new mstrmojo.ME.MetricToken({data:a,brackets:function(b){return b;},isDelimiter:function Z(){var b=this.data,c=b.v.length;if(b){return b.isDelimiter||(c===1&&M(b.v));}return false;}});},isDelimiter:M}]});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.ObjectInputBox","mstrmojo.DataGrid","mstrmojo.Editor");mstrmojo.requiresDescs(221,629,945,1442,1825,3095,4114,4115,4563,5298,8246,9125,12173,12916,12918,12947);var F=mstrmojo.hash,D=mstrmojo.expr,A=mstrmojo.ME.MetricToken.brackets,G=function(M){var J=null;if(M.isParam){J={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",alias:"paramInput",slot:"0,0",itemValidationField:"_did_",item2textCss:function E(N){return" mstrmojo-qb-SuggestIcon t"+N.t;},hideEditButton:function(){return false;},browseItemVisible:false,dynamicVerify:false,emptyText:mstrmojo.desc(9125,"Type here to input columns..."),postCreate:function(O){var N=this.parent.dataGrid,P=N&&N.parent;this.candidates=P.getCandidates(function(Q){return Q.t===26;});if(!O){N.candidatesListener.push(this);}this.autoSelect=false;this.openPopup("suggestionPopup");this.suggestionPopup.close();this.autoSelect=true;}}],onParamAdded:function(P){var O=this.dataGrid.parent,N=this.paramInput;O.closePopup();P.state=0;N.add([P],N.items.length-1);},getTokens:function(){var Q=this.paramInput.getSelectedObjects(),N=Q.length,P,R=[],O;if(N>0){for(P=0;P<N;P++){if(Q[P].state===mstrmojo.Enum_OIB_States.VALID){O={v:A(Q[P].n)};O.oi=Q[P];}else{O={v:Q[P].n};}R.push(O);R.push({v:",",isDelimiter:true});}R.pop();}return R;}};var K=J.children[0];if(!M.isRepeated){K.cssClass="mstrmojo-ObjectInputBox singleObject noVerify";K.maxObjectCount=1;}else{K.cssClass="mstrmojo-ObjectInputBox noVerify";}}else{switch(M&&M.dtp){case 11:J={scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-functionArgs-pulldown mstrmojo-Pulldown",items:[{n:mstrmojo.desc(4115,"False"),did:"0"},{n:mstrmojo.desc(4114,"True"),did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(N){this.value=this.data.dfv||0;},getTokens:function(){var N=this.data;if(this.value!==N.dfv){return[{v:N.n},{v:"=",isDelimiter:true},{v:String(this.value)==="-1"?"True":"False"}];}return[];}};break;case -2:J={scriptClass:"mstrmojo.Table",cssClass:"breakBy",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",slot:"0,0",alias:"breakByInput",item2textCss:function E(N){return(this._super&&this._super(N))||{12:"a","-99":"br"}[N.t]||"";},emptyText:mstrmojo.desc(12916,"Type here to input breakby attributes..."),noEditButton:true,browseItemVisible:true,folderLinksContextId:16,browsableTypes:[D.TP.FOLDER,D.TP.ATTR].join(","),getCandidatesThroughTaskCall:function L(O,N){mstrmojo.ME.MetricDataService.getAttributes(O,N);},postCreate:function(O){var N=this.parent.dataGrid,P=N&&N.parent;this.candidates=P.getCandidates(function(Q){return Q.t===12;});if(!O){N.candidatesListener.push(this);}}},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var O=this.parent.parent.dataGrid.parent;O.openPopup("ob",{zIndex:O.zIndex+10});var N=O.ob.browser;N.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onBreakByAdded"],browsableTypes:[D.TP.ATTR,D.TP.FOLDER].join(",")});}}]}],onBreakByAdded:function(P){var O=this.dataGrid.parent,N=this.breakByInput;O.closePopup();N.add([P],N.items.length-1);},getTokens:function(){var P=this.breakByInput.getSelectedObjects(),N=P.length,O,Q=[];if(N>0){Q.push({v:"BreakBy"});Q.push({v:"=",isDelimiter:true});Q.push({v:"{",isDelimiter:true});for(O=0;O<N;O++){Q.push({v:A(P[O].n),oi:P[O]});if(O!==(N-1)){Q.push({v:",",isDelimiter:true});}}Q.push({v:"}",isDelimiter:true});}return Q;}};break;case -1:J={scriptClass:"mstrmojo.Table",cssClass:"sortBy",layout:[{cells:[{cssText:"width: 330px"},{}]}],getTokens:function(){var Q=this.sortByGrid.items,N=Q.length,P,T=[];if(N>0){T.push({v:"SortBy"});T.push({v:"=",isDelimiter:true});T.push({v:"(",isDelimiter:true});for(P=0;P<N;P++){var R=Q[P],S=R.selFrm||(R.dssforms&&R.dssforms[0]),O={v:A(R.n),oi:R};if(S&&parseInt(R.t,10)===12){F.copy({v:A(R.n)+"@"+A(S.n),exv:S.dssid,extp:S.dtp},O);}T.push(O);if(P!==(N-1)){T.push({v:",",isDelimiter:true});}}T.push({v:")",isDelimiter:true});}return T;},children:[{scriptClass:"mstrmojo.DataGrid",slot:"0,0",cssClass:"mstrmojo-functionArgs-sort",alias:"sortByGrid",renderOnScroll:false,resizableColumns:true,makeObservable:true,itemDisplayField:"n",columns:[{headerText:mstrmojo.desc(945,"Name"),dataField:"n",colCss:"nmCol"},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(3095,"Order"),dataField:"order",colCss:"ordCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.asc=this.value;}}},{dataWidget:{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(N){this.dataGrid.remove(this.data);}},headerText:"&nbsp",colCss:"actionsCol"}]},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var O=this.parent.parent.dataGrid.parent;O.openPopup("ob",{zIndex:O.zIndex+10});var N=O.ob.browser;N.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onSortByAdded"],browsableTypes:[D.TP.ATTR,D.TP.METRIC,D.TP.FOLDER].join(",")});}}]}],onSortByAdded:function(Q){var O=this.dataGrid.parent,P=this.sortByGrid;O.closePopup();if(Q){switch(Q.t){case 12:var R=function(S){if(S){var T=S.container;if(T&&T.dssforms){Q.dssforms=T.dssforms;P.add([Q]);}}},N=function(S){mstrmojo.alert(S.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:Q.did,displayedForms:0},{success:R,failure:N});break;case 4:Q.dssforms=[{n:"Value"}];default:P.add([Q]);}}}};break;default:J={scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(N){var O=this.data;this.value=(O.dfv||O.dfv===0)?O.dfv:"";},getTokens:function(){var N=this.data;if(this.value!==N.dfv){return[{v:N.n},{v:"=",isDelimiter:true},{v:this.value}];}return[];}};break;}}J.alias="inputWidget";return J;},I=function(K,E,J){return'<div class="mstrmojo-DataRow-text"title="'+(K.desc||"")+'">'+K.n+(K.isParam?"*":"")+":</div>";};mstrmojo.qb.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FunctionWizard",init:function H(E){this._super(E);this.help=this.help||(mstrApp&&mstrApp.helpTopics&&mstrApp.helpTopics.fnWiz);},cssClass:"mstrmojo-FunctionWidzard",title:mstrmojo.desc(4563,"Function Arguments"),help:"",fctOi:null,fctArgs:null,fctSyntax:"",bindings:{candidates:"this.opener.candidates"},getCandidates:function B(K){var J=this.candidates,E;if(J){E=mstrmojo.array.filter(J.items,K);return{items:E,isComplete:J.isComplete};}return null;},_set_candidates:function(N,J){this.candidates=J;if(this.hasRendered&&this.visible){var L=this.argsGrid,M=L.candidatesListener,E=M.length,K;for(K=0;K<E;K++){M.postCreate(true);}}return true;},onOpen:function(){var J=this,L,K=function(P){if(P){J.set("fctOi",P);var R=[],O,M,Q,N=[];N.push(P.n);N.push("(");M=(P.pars&&P.pars.length)||0;for(O=0;O<M;O++){Q=F.copy(P.pars[O]);Q.isParam=true;R.push(Q);N.push(P.pars[O].n);if(O!==(M-1)){N.push(", ");}}N.push(")");if(P.rpc>0){Q.isRepeated=true;}M=(P.pros&&P.pros.length)||0;if(P.did==="6F7DF5FF449111D5BEA300B0D01A55EF"){M=0;}for(O=0;O<M;O++){if(P.pros[O].n!=="UseLookupForAttributes"){R.push(F.copy(P.pros[O]));}}if(P.sqt===5){R.push({n:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:mstrmojo.desc(12918,"Break By is a parameter representing the break by levels for this function.")});}J.set("fctArgs",R);J.set("fctSyntax",N.join(""));}mstrmojo.css.removeClass(J.argsGrid.domNode,["loading"]);},E=function(M){mstrmojo.alert(M.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));mstrmojo.css.removeClass(this.argsGrid.domNode,["loading"]);};this.argsGrid.set("items",[]);mstrmojo.css.addClass(this.argsGrid.domNode,["loading"]);this.set("fctSyntax","");this.set("title",mstrmojo.desc(12947,"Function arguments for:")+this.fctOi.n);L={functionId:this.fctOi.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};mstrApp.getRootController().getDataService().getFunctionDetails({success:K,failure:E},L);},getTokens:function C(){var L=this.argsGrid.ctxtBuilder.itemWidgets,O=L.length,N,S,P=[],K=[],T=[],Q,M,J,E,R=this.fctOi;for(N=0;N<O;N++){S=L[N].inputWidget;if(S.data.isParam){K.push(S.getTokens());}else{P.push(S.getTokens());}}T.push({v:R.n,oi:R});O=P.length;if(O>0){E=false;T.push({v:"<",isDelimiter:true});for(N=0;N<O;N++){Q=P[N];J=Q.length;if(J===0){continue;}E=true;for(M=0;M<J;M++){T.push(Q[M]);}T.push({v:",",isDelimiter:true});}T.pop();if(E){T.push({v:">",isDelimiter:true});}}O=K.length;T.push({v:"(",isDelimiter:true});E=false;for(N=0;N<O;N++){Q=K[N];J=Q.length;if(J===0){continue;}E=true;for(M=0;M<J;M++){T.push(Q[M]);}T.push({v:",",isDelimiter:true});}if(E){T.pop();}T.push({v:")",isDelimiter:true});return T;},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},children:[{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:"functionArgs",banding:false,columns:[{headerText:"Property Name",dataFunction:I,colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:G,colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-syntaxLabel",text:"",bindings:{text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-descLabel",text:"",bindings:{text:function(){return this.parent.fctOi.desc;}}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-FW-buttonBox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;if(E.insertOnFinish){E.insertOnFinish(E.getTokens());}E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo._HasEditableText","mstrmojo.array","mstrmojo.Box","mstrmojo.css","mstrmojo.dom","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.warehouse.ui.BasePanel","mstrmojo.architect.ui.SQLInputBox");var V="mstrmojo-ar-",T="tbbtn",E=mstrmojo.dom,G="px",A=mstrmojo.warehouse.EnumObjectTypes,O=mstrmojo.architect.EnumDataChangeEvents,N=mstrmojo.desc(12229,"Show logical views"),D=mstrmojo.desc(12230,"Hide logical views"),R=mstrmojo.desc(12231,"Close logical view"),C=mstrmojo.desc(12232,"Clear SQL statement"),I=mstrmojo.desc(12233,"Execute SQL statement"),P=mstrmojo.desc(12228,"Please select a logical view or create a new one");function B(W){this.parent.showBottomPanel(!W);this.sqlText.set("visible",!W);this.sqlText.set("visible",W);this.set("instructionsVisible",!W);}function H(Y){this.allViewItems=Y.views;var W=Y.value,X=this.allViewItems[W];this.viewId=W;this.sqlText.reset();if(W){this.setEditableTitle(this.allViewItems[W].name);this.sqlText.setSQLStatement(X.SQLStatement);}else{this.setEditableTitle("");}B.call(this,!!W);this.onwidthChange({value:this.width});}mstrmojo.architect.ui.panels.LogicalViewSQLPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.architect.ui.panels.LogicalViewSQLPanel",viewId:"",allViewItems:{},cssClass:"ContentsInfoPanel",editableSlot:"titleNode",allowEmptyText:true,instructionsText:P,icntp:A.TABLE_LOGICAL_VIEW,showList:undefined,sqlText:undefined,execSQL:undefined,viewListVisible:true,init:function Q(Y){var b=this;this._super(Y);var X=mstrApp.getRootController(),Z={},a=Z[this.id]={},W=this;this.addNewTitleButton({title:I,alias:"execSQL",cssClass:V+T+" execSQL",onclick:function(d){var f=X.getTable(W.viewId);f.SQLStatement=W.sqlText.getSQLStatement();f.getSQLData(false,{success:function g(h){X.raiseExecuteSQLEvent(h.cols);f.updateViewDefinition({});},failure:function e(){X.raiseExecuteSQLEvent([]);}});d.cancel();}});this.addNewTitleButton({title:C,cssClass:V+T+" clearSQL",onclick:function(){W.sqlText.setSQLStatement("");W.execSQL.onclick({cancel:mstrmojo.emptyFn});}});this.addNewTitleButton({title:R,cssClass:V+T+" closeObject",onclick:function(){mstrApp.getRootController().closeViewObject();}});this.addNewTitleButton({title:N,alias:"showList",cssClass:V+T+" showList",onclick:function(){b.viewListVisible=!b.viewListVisible;mstrApp.getRootController().toggleViewList();}});a[O.LOGICALVIEWS_CHANGED]=H;X.attachDataChangeListeners(Z);X.getPrimaryDBRoleTablesAndColumns({success:function c(d){W.sqlText.tables=d.tables;W.sqlText.columns=d.columns;}});},postBuildRendering:function U(){this._super();B.call(this,!!this.viewId);},closeObject:function K(){mstrApp.getRootController().switchLogicalView("");this.setEditableTitle("");this.viewId="";B.call(this,false);},updateViewObjectName:function S(X,W){if((!!(this.viewId))&&(X===this.viewId)){this.setEditableTitle(W);}},onTextEditComplete:function M(Z,c){var d=mstrApp.rootController,W=this;if(Z){var Y=this.viewId,X=this.text,b={success:function e(){d.updateViewListItem(Y,X);},failure:function a(){W.setEditableTitle(c);}};d.renameLogicalView(Y,X,b);}},onRender:function F(){this._super();this.onheightChange({value:this.height});this.onwidthChange({value:this.width});},onheightChange:function J(X){var Y=parseInt(X.value,10),W=this.headerHeight=this.headerHeight||(this.hasRendered?this.headerNode.clientHeight:36),Z=(Math.max(parseInt(Y,10)-W,0))+G;this.height=Y+G;this.sqlText.set("height",Z);this.set("instructionsHeight",this.height);},onwidthChange:function L(Y){var Z=this,X=parseInt(Y.value,10),W=Math.max(X,0),a=W-(this.titleIconsNode?E.position(this.titleIconsNode).w:0)-25;if(this.showList.domNode){this.showList.set("title",(Z.viewListVisible)?D:N);}this.width=X+G;this.sqlText.set("width",W+G);if(this.titleNode){this.titleNode.style.width=a+G;}},children:[{scriptClass:"mstrmojo.architect.ui.SQLInputBox",alias:"sqlText",visible:false}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Button","mstrmojo.Editor","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper");mstrmojo.requiresDescs(12852);var J=mstrmojo.expr,A=mstrmojo.array,G=mstrmojo.hash,M=mstrmojo.ME._MetricEditorHelper,B=mstrmojo.ME.Enum.DYNAMIC_DIMTY,L=mstrmojo.ME.Enum.UI_DATA_TYPE,I=mstrmojo.ME.Enum.UI_OBJECT_TYPE,F=mstrmojo.ME.MetricToken.brackets;var K;function Q(){var E=mstrmojo.all[K];if(E&&E.onmetricModify){E.onmetricModify();}}function C(){var E=mstrmojo.all[K];if(E&&E.updateScrollbars){E.updateScrollbars();}}mstrmojo.ME.SortByInputList=mstrmojo.declare(mstrmojo.WidgetList,null,{makeObservable:true,isNewDef:true,isDME:false,init:function R(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-sortby");},preBuildRendering:function(){var E=this.items||[];if(this.isNewDef&&this.isDME){E.push(B.getAutomaticDimtyObject());}E.push({n:""});this.items=E;if(this._super){this._super();}},getTokens:function(){var W=this.items,E=W.length-1,V,a=[];if(E>0){a.push({v:"SortBy"});a.push({v:"=",isDelimiter:true});a.push({v:"(",isDelimiter:true});for(V=0;V<E;V++){var Y=W[V],Z=Y.selFrm,U,X=false;if(M.isDimty(Y.n)){U={v:Y.n};X=true;}else{if(/^@/.test(Y.did)){U={v:Y.did};X=true;}else{U={v:F(Y.n),oi:Y};}}if(Z&&(Y.t===J.TP.ATTR||(Y.t===J.TP.CONS&&Y.st===J.STP.NDE))){G.copy({v:F(Y.n)+"@"+F(Z.n),exv:Z.dssid,extp:8},U);}a.push(U);if(!X){if(!!Y.asc){a.push({v:"Desc",tp:259});}}if(V!==(E-1)){a.push({v:",",isDelimiter:true});}}a.push({v:")",isDelimiter:true});}return a;},itemFunction:function(X,E,U){return new mstrmojo.Box({cssClass:"mstrmojo-ME-sortby-item",alias:"sortByItem",parent:U,children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"sortByInput",cssClass:"mstrmojo-ME-ObjectInputBox-sortby",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),isDME:U.isDME,dtp:L.Sortby,maxObjectCount:1,folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(","),getCandidatesThroughTaskCall:function Z(c,b){c.objectType=J.TP.ATTR+","+J.TP.METRIC;c.rootFolderType=39;c.blockCount=c.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(c,b);},obCfg:{folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(",")},bindings:{candidates:"this.parent.parent.candidates"},postCreate:function(b){if(!b){this.set("items",X.did||X.dimty?[X]:null);}},onitemchange:function(){var d=this.getSelectedObjects()[0];if(!d||!d.did&&!d.n){return ;}X.selFrm=null;mstrmojo.hash.copy(d,X);var c=this.parent.formsPulldown;if(c){c.updateForms(d);}var b=this.parent.ascPulldown;if(b){b.set("visible",X.t===4||X.st===J.STP.NDE);}Q();},onadd:function V(){if(this.getSelectedObjects().length===0){return ;}if(this.parent===U.ctxtBuilder.itemWidgets[U.items.length-1]){U.add([{n:""}]);this.parent.del.set("visible",true);}},hidePulldownButton:function(){return !U.isDME;},hideDelButton:function(){return true;},hideItemWidgetBrowseButton:function(){return U.isDME;},getItemsToFilterOut:function(){return U.items;}},{scriptClass:"mstrmojo.Pulldown",alias:"formsPulldown",cssClass:"mstrmojo-ME-sortby-forms mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",defaultSelection:-1,bindings:{visible:function(){return this.items&&this.items.length>0;}},popupToBody:true,popupZIndex:100,postCreate:function(){this.retrieveDssForms(X);},retrieveDssForms:function W(d){var c=this,b=function(){var k=function(l){d.dssforms=l;c.set("items",d.dssforms);c.selectedIndex=-1;c.selectedItem=null;c.value=null;c.set("value",d.selFrm);};var i=c.parent.sortByInput.candidates,e=i&&i.items;if(d.did&&e){var h=A.find(e,"did",d.did);if(h>-1){var g=mstrmojo.hash.clone(e[h].fs);if(g){A.forEach(g,function(l){l[c.itemIdField]=l.fid;l[c.itemField]=l.fnm;});k(g);return ;}}}var j=function(l){if(l){var m=l.container;if(m&&m.dssforms){d.dssforms=m.dssforms;k(d.dssforms);}}},f=function(l){mstrmojo.alert(l.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:d.did,displayedForms:0},{success:j,failure:f});};switch(d.t){case J.TP.ATTR:b();break;case J.TP.CONS:if(d.st===J.STP.NDE){c.set("visible",false);}break;case J.TP.METRIC:c.set("visible",false);break;case I.Dimty:c.set("visible",false);break;}},updateForms:function Y(b){this.retrieveDssForms(b);},onvalueChange:function a(){if(this.selectedItem){X.selFrm=this.selectedItem;}if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Pulldown",alias:"ascPulldown",cssClass:"mstrmojo-ME-sortby-asc mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,visible:false,bindings:{value:function(){return this.parent.parent.items[E].asc;},visible:function(){var b=this.parent.sortByInput.getSelectedObjects()[0];return this.parent.formsPulldown.visible&&this.parent.formsPulldown.value||b.t===J.TP.METRIC||b.st===J.STP.NDE;}},onvalueChange:function(b){X.asc=this.value;if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Button",alias:"del",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),bindings:{visible:function(){var b=U.itemIndex(X);return this.parent.parent.items[b].did;}},onclick:function(){U.remove(U.items[U.itemIndex(X)]);Q();}}]});},onadd:function H(){C();},onremove:function S(){C();}});mstrmojo.ME._HasSortBy=mstrmojo.provide("mstrmojo.ME._HasSortBy",{_mixinName:"mstrmojo.ME._HasSortBy",ios:false,oniosChange:function P(E){this.sortByContainer.set("visible",E.value);},onOpen:function(){if(this._super){this._super();}K=this.id;var U=this.oi.tks,V=!U.met;var E=this.sortByContainer&&this.sortByContainer.sortByWidgetList;if(E){E.set("isNewDef",V);E.set("isDME",this.isDME);E.set("candidates",this.getCandidates4Sortby());E.set("items",this.getSortByDefFromTokens().items||[]);}},getCandidates4Sortby:function T(){var U=this.candidates,E;if(U&&!this.noCache){E=A.filter(U.items,function(V){return V.t===J.TP.ATTR||V.t===J.TP.METRIC||V.st===J.STP.NDE;});if(this.isDME){E=B.getItems("sortby").concat(E);}}return{items:E||[],isComplete:U&&U.isComplete};},getSortByWidget:function D(E){var W=this,V=[{scriptClass:"mstrmojo.ME.SortByInputList",alias:"sortByWidgetList",cssClass:"sortBy mstrmojo-ME-sortby",cssDisplay:"table-cell"}],U={scriptClass:"mstrmojo.Label",alias:"sortByLabel",cssClass:"mstrmojo-ME-SortBy-label",cssDisplay:"table-cell",text:mstrmojo.desc(12852,"Sort By")};if(E){V.unshift(U);}return{scriptClass:"mstrmojo.Box",alias:"sortByContainer",cssClass:"mstrmojo-ME-SortBy-Container",cssDisplay:"table-row",visible:W.ios,postCreate:function(){W.sortByContainer=this;this.editor=W;},getTokens:function(){return this.sortByWidgetList.getTokens();},children:V};},getSortByDefFromTokens:function N(){var a=this.oi.tks.items,W=a.length,b,Y,U,V,X={};for(V=0;V<W;V++){b=a[V];Y=b.tp;U=b.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(b.v)&&(b.v!=="("&&b.v!==")")||b.v==="&gt;"||b.v==="&lt;"){continue;}switch(U){case 131072:if(Y===302){b=a[++V];while(b){if(b.tp!==282){if(b.oi){b.oi.selFrm=b.exv;var Z=a[V+1];if(Z.v==="Desc"&&Z.tp===259){b.oi.asc=1;V++;}X.items=X.items||[];X.items.push(b.oi);}else{if(b.tp===64){X.items=X.items||[];var E=b.v+a[++V].v;b=a[V+1];if(b.tp===43||b.tp===45){E+=a[++V].v;E+=a[++V].v;}X.items.push(B.getDimtyObject(E,this.isDME));}}}if((b=a[++V])["v"]===")"){break;}}}}}return X;},getSortByDefAsTokens:function O(){return this.sortByContainer.getTokens();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper","mstrmojo.ui.ScrollableSuggestionList");var H=mstrmojo.expr,O=mstrmojo.Enum_OIB_States,J=mstrmojo.ME._MetricEditorHelper,R=mstrmojo.dom;mstrmojo.ME.ObjectInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{cssClass:"",autoSelect:false,suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",suggestionPopupCssClss:"mstrmojo-ME-ObjectInputBox-suggest",blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,useKeyDelay:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,emptyText:"Search for an object",showEmptyItem:false,noEditButton:true,browseItemVisible:true,click2edit:true,showSuggestionOnEdit:false,tabNavigable:true,obCfg:{},dynamicVerify:true,init:function P(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-ObjectInputBox");if(this.isDME){this.browseItemVisible=!this.isDME;this.suggestCount=this.isDME?1000:mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=1000;this.dynamicVerify=false;}},item2textCss:function D(W){if(this.isDME){return mstrmojo.ME._MetricEditorHelper.item2textCss(W);}var E=this._super(W)||{1:"f",4:"m",12:"a",13:"fc",43:"tr","-1":"rl","-99":"br"}[W.t]||"";return E?" icn "+E:"";},itemFunction:function B(X,E,W,Y){X[W.itemIdField]=W.nextId();var Z=Y||mstrmojo.ME.ObjectItem,a=new Z({parent:W,itemField:W.itemField,cssClass:W.item2textCss(X),data:X,bindings:{isFull:"this.parent.isFull"},onisFullChange:function(){if(this.hasRendered){this.updateButtonsVisibility();}}});W.attachEventListener4ItemWidget(a,W);return a;},getActiveItem:function M(){var E=this.editingIdx,X,W;if(E>-1){X=this.ctxtBuilder.itemWidgets[E];W=X&&X.data;}return W;},showObjectBrowser:function(E){this.set("suggestTarget",E);this.handleSuggestionItemSelect({t:-99},this.obCfg);},hideItemWidgetBrowseButton:function S(){return false;},hidePulldownButton:function G(){return true;},hideDelButton:function A(){return false;},dtp:0,verifyObject:function C(W,E){if(!this.dynamicVerify){return O.VALID;}var Y=E.data;var X=parseInt(this.dtp,10);switch(X){case -1:case -2:case -4:case -5:case -6:if(Y.t===-1||J.isDimty(W,X===-1)){return O.VALID;}if(this.dynamicVerify){return this._super(W,E);}return Y.did?O.VALID:O.INVALID;case 1:case 2:case 3:case 4:case 5:case 6:case 7:if(Y.t<0){return O.VALID;}if(/^\d{1,}$/.test(mstrmojo.string.trim(W))||Y.did){return O.VALID;}if(this.dynamicVerify){return this._super(W,E);}return O.INVALID;default:return O.VALID;}},getItemsToFilterOut:function N(){return this.items;},updateSuggestion:function Q(E){var X=this.getActiveItem();var W=this.getItemsToFilterOut();E=mstrmojo.array.filter(E,function(a){var Z=a.did,Y=false,c;var b=function(d){mstrmojo.array.forEach(W,function(e){if(e!==X&&e.did===d){Y=true;return false;}});};b(Z);if(!Y){c=a;}return c;});if(this._super){this._super(E);}},nudge:function I(W){W.domNode.style.minWidth=this.suggestTarget.domNode.offsetWidth+(this.isDME?13:0)+"px";var X=R.position(W.domNode),Y=R.position(this.suggestTarget.domNode),E=R.windowDim();if(X.y+X.h>E.h){W.domNode.style.top=(Y.y-X.h-5)+"px";}}});mstrmojo.ME.ObjectItem=mstrmojo.declare(mstrmojo.ObjectItem,[mstrmojo._HasPopup],{markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode" tabindex="0" mstrAttach:click,focus><span class="mstrmojo-ObjectItem-text {@cssClass}"></span></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" placeholder="{@placeholderText}" mstrAttach:keyup,keydown/></div><div class="mstrmojo-ObjectItem-icons"><div class="mstrmojo-ObjectItem-down" onclick="mstrmojo.all[\'{@id}\'].showSuggestion(\'\')"></div><img class="mstrmojo-ObjectItem-browse" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1825,"Browse")+'" onclick="mstrmojo.all[\'{@id}\'].browse()"/><div class="mstrmojo-ObjectItem-opts" title="'+mstrmojo.desc(9598,"Level options")+'" onclick="mstrmojo.all[\'{@id}\'].options(arguments[0])" style="display:none;"></div><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])" style="display:none;"/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},pulldownButtonNode:function(){return this.domNode.lastChild.childNodes[0];},browseButtonNode:function(){return this.domNode.lastChild.childNodes[1];},optionButtonNode:function(){return this.domNode.lastChild.childNodes[2];},editButtonNode:function(){return this.domNode.lastChild.childNodes[3];},delButtonNode:function(){return this.domNode.lastChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},init:function P(E){this._super(E);this.placeholderText=this.parent.emptyText;},initState:function T(){var W=this.parent,X=this.data,E=X.state;if(W.dynamicVerify){return this._super();}if(typeof E==="undefined"){E=W.verifyObject(X[this.itemField],this);X.state=E;}return E;},updateButtonsVisibility:function F(){if(this._super){this._super();}if(this.parent.hidePulldownButton()){this.pulldownButtonNode.style.display="none";}if(this.parent.hideItemWidgetBrowseButton()){this.browseButtonNode.style.display="none";}this.optionButtonNode.style.display=this.data.state!==O.ADDING&&this.optionButtonVisible?"":"none";this.delButtonNode.style.display=this.data.state!==O.ADDING&&!this.parent.hideDelButton()&&!this.isFull?"":"none";},browse:function L(){this.set("state",this.data.state===O.ADDING?O.ADDING:O.EDITING);this.parent.showObjectBrowser(this);},click2edit:function K(){if(this.parent.click2edit){this.edit();}},onclick:function V(){this.click2edit();},onfocus:function U(){this.click2edit();}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasEditableText","mstrmojo.array","mstrmojo.Box","mstrmojo.css","mstrmojo.dom","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.menu.TransformationSettingMenu","mstrmojo.architect.ui.TransformationContainer","mstrmojo.warehouse.ui.BasePanel");var a="mstrmojo-ar-",X="tbbtn",G=mstrmojo.dom,H="px",Q=mstrmojo.architect.EnumDataChangeEvents,B=mstrmojo.warehouse.EnumObjectTypes,b=mstrmojo.architect.ui.EnumViewTypes,Y=mstrmojo.architect.menu.EnumMenuActions,R=Y.TX_ONE_TO_ONE,Z=Y.TX_MANY_TO_MANY,A=Y.TX_APPLY_TO_ALL,F=Y.TX_APPLY_TO_HIGHEST,O=b.TRANSFORMATION,T=mstrmojo.desc(12208,"Show transformations"),L=mstrmojo.desc(12209,"Hide transformations"),I=mstrmojo.desc(7831,"Settings"),U=mstrmojo.desc(12210,"Close transformation"),E=mstrmojo.desc(12211,"Transformation '%1' is in an invalid state, it needs to be fixed before proceeding"),P=mstrmojo.desc(12212,"Please select a transformation or create a new one");function D(c){this.parent.showBottomPanel(!c);this.transformationContainer.set("visible",c);this.set("instructionsVisible",!c);}function C(e){var f=this.transformationContainer,h=e.value.id,g=e.value,c=(!!g),d=c?g.name:"";this.transformationId=h;this.setEditableTitle(d);D.call(this,c);if(h){f.refresh();}this.onwidthChange({value:this.width});}mstrmojo.architect.ui.panels.TransformationPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,[mstrmojo._HasEditableText,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.architect.ui.panels.TransformationPanel",cssClass:"ContentsInfoPanel",editableSlot:"titleNode",allowEmptyText:true,instructionsText:P,icntp:B.TRANSFORMATION,showList:undefined,transformationContainer:undefined,viewListVisible:true,settings:undefined,init:function S(g){this._super(g);var j=this,d=mstrApp.getRootController(),h={},i=h[this.id]={};this.addNewTitleButton({alias:"settings",cssClass:a+X+" settings",title:I,onclick:function(){var n=j.settingsMenu=j.settingsMenu||new mstrmojo.architect.menu.TransformationSettingMenu();n.data={did:j.transformationId,isVisible:function k(){return true;},isChecked:function o(r,q){var p=d.getTransformation(r.did);switch(q.did){case R:return(p.onetoOneMappingType);case Z:return(!p.onetoOneMappingType);case A:return(p.transformationAllAttributes);case F:return(!p.transformationAllAttributes);}return false;},isEnabled:function m(){return true;}};var l=n.getMenuConfig();l.hostId=j.id;l.hostElement=this.domNode;l.isHostedWithin=false;j.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:l}));}});this.addNewTitleButton({title:U,cssClass:a+X+" closeObject",onclick:function(){var l=mstrApp.rootController,m=l.model.currentTransformationId,k=l.preSwitchCheck(l.getTransformation(m),E,"name");if(k.canProceed){l.commitTransformation(m,{success:mstrmojo.emptyFn()});l.closeViewObject();}else{mstrmojo.alert(k.msg);}}});this.addNewTitleButton({title:T,alias:"showList",cssClass:a+X+" showList",onclick:function(){j.viewListVisible=!j.viewListVisible;mstrApp.getRootController().toggleViewList();}});i[Q.TRANSFORMATION_UPDATED]=C;d.attachDataChangeListeners(h);var f=function f(l){var k=d.preSwitchCheck(d.getTransformation(j.transformationId),E,"name");if(k.canProceed){if(j.transformationId){d.commitTransformation(j.transformationId,l);}else{if(l&&l.success){l.success();}}}return k;};d.registerPreSwitchViewCallback(function e(k){if(k!==O){return{canProceed:true,msg:""};}return f();});d.registerPreSwitchViewCallback(f);d.registerPreSaveCallback(f);d.registerSaveCallback(function c(){d.commitTransformation(j.transformationId,{success:mstrmojo.emptyFn()});});},postBuildRendering:function W(){this._super();D.call(this,!!this.transformationId);},closeObject:function K(){mstrApp.rootController.editTransformation("");this.setEditableTitle("");this.transformationId="";D.call(this,false);},updateViewObjectName:function V(d,c){if((!!(this.transformationId))&&(d===this.transformationId)){this.setEditableTitle(c);}},onTextEditComplete:function N(f,h){var d=mstrApp.rootController;if(f){var e=this.transformationId,c=this.text,g=d.renameTransformation(e,c);if(!g){this.setEditableTitle(h);}else{d.updateViewListItem(e,c);}}},onheightChange:function J(d){var e=parseInt(d.value,10),c=this.headerHeight=this.headerHeight||(this.hasRendered?this.headerNode.clientHeight:36),f=(Math.max(parseInt(e,10)-c,0))+H;this.height=e+H;this.transformationContainer.set("height",f);this.set("instructionsHeight",this.height);},onwidthChange:function M(e){var f=this,d=parseInt(e.value,10),c=Math.max(d,0),g=c-(this.titleIconsNode?G.position(this.titleIconsNode).w:0)-25;if(this.showList.domNode){this.showList.set("title",(f.viewListVisible)?L:T);}this.width=d+H;this.transformationContainer.set("width",c+H);if(this.titleNode){this.titleNode.style.width=g+H;}},children:[{scriptClass:"mstrmojo.architect.ui.TransformationContainer",alias:"transformationContainer",visible:false}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.Menu","mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.RelationMenu");var V=mstrmojo.dom,R=mstrmojo.hash,X=mstrmojo.array,U,D=mstrmojo.architect.menu.RelationMenu,Z=mstrmojo.architect.menu.ArchitectMenu.EnumRelationType,J,Q="http://www.w3.org/2000/svg",Y="lnk";function C(){var c=document.createElement("v:rect"),b=c.style;c.setAttribute("id","vmlFrame");c.setAttribute("stroke","true");c.setAttribute("strokecolor","red");b.width=this.width;b.height=this.height;b.zindex="-1";document.getElementById("vmlCanvas").appendChild(c);}function A(){var e=parseInt(this.width,10),c=parseInt(this.height,10),d=document.createElement("v:group"),b=d.style;d.setAttribute("id","vmlCanvas");d.setAttribute("coordorigin","0, 0");d.setAttribute("coordsize",e+", "+c);b.width=this.width;b.height=this.height;this.domNode.appendChild(d);C.call(this);}function a(){var b=this.hltLinkId;if(b){if(document.getElementById(Y+b)){document.getElementById(Y+b).setAttribute("class","");delete this.hltLinkId;}}}function K(){if(J){delete this.svgNode;this.domNode.innerHTML="";}else{var b=document.getElementById("vmlCanvas");if(b.hasChildNodes()){while(b.childNodes.length>=1){b.removeChild(b.firstChild);}C.call(this);}}a.call(this);}function O(b){if(J){this.hltLinkId=b;if(document.getElementById(Y+b)){document.getElementById(Y+b).setAttribute("class","hlt");}}}function F(n,e,l,c,k,b,j,i){var m;if(J){var g=this.svgNode,f=g.ownerDocument,h="lnk"+n,d=g.getElementById(h);if(!d){d=f.createElementNS(Q,"g");}m=f.createElementNS(Q,"polygon");m.setAttribute("points",e+","+l+" "+c+","+k+" "+b+","+j);if(i){m.setAttribute("style","stroke:rgb(0,0,255)");}else{m.setAttribute("style","stroke:rgb(255, 255, 255)");}d.appendChild(m);g.appendChild(d);}else{m=document.createElement("v:line");m.setAttribute("points",e+","+l+" "+c+","+k+" "+b+","+j);if(i){m.setAttribute("fillcolor","blue");}else{m.setAttribute("fillcolor","black");}}}function M(k,d,j,b,i,h){var l;if(J){var f=this.svgNode,e=f.ownerDocument,g="lnk"+k,c=f.getElementById(g);if(!c){c=e.createElementNS(Q,"g");c.setAttribute("id",g);}l=e.createElementNS(Q,"line");l.setAttribute("x1",String(d));l.setAttribute("y1",String(j));l.setAttribute("x2",String(b));l.setAttribute("y2",String(i));if(h){l.setAttribute("style","stroke:rgb(0,0,255)");}c.appendChild(l);f.appendChild(c);}else{l=document.createElement("v:line");l.setAttribute("from",[d," ",j].join(""));l.setAttribute("to",[b," ",i].join(""));if(h){l.setAttribute("fillcolor","blue");}}}function B(g,f,j){var h=function h(b){return b*b;},i=function i(c,b){return h(c.x-b.x)+h(c.y-b.y);},e;var d=((j.x-g.x)*(f.x-g.x)+(j.y-g.y)*(f.y-g.y))/i(g,f);if(d<0){e=g;}if(d>1){e=f;}return Math.sqrt(i(j,e||{x:g.x+d*(f.x-g.x),y:g.y+d*(f.y-g.y)}));}function P(c,b){return B(c.src,c.tgt,b)<=13;}function L(b,d){var c=null;R.forEach(this.linksInfo,function(e,f){if(P(e.coords,{x:b,y:d})){c=f;return false;}return true;},this);return c;}mstrmojo.architect.ui.RelationLinker=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.architect.ui.RelationLinker",markupString:'<div id="{@id}" class="mstrmojo-RelationLinker" mstrAttach:click></div>',markupMethods:{onvisibleChange:function N(){this.domNode.style.display=(this.visible)?"block":"none";},onheightChange:function H(){var b=this._max;this.domNode.style.height=Math.max(parseInt(this.height,10),(b&&b.y)||0)+"px";},onwidthChange:function I(){var b=this._max;this.domNode.style.width=Math.max(parseInt(this.width,10),(b&&b.x)||0)+"px";}},init:function T(b){this._super(b);this.linksInfo={};},postBuildRendering:function W(){this._super();if(!J){J=!!document.createElementNS&&!!document.createElementNS(Q,"svg").createSVGRect;}if(!J){A.call(this);}},handleClick:function G(c){var f=V.position(this.domNode),b=c.clientX,e=c.clientY,d=L.call(this,b-f.x,e-f.y);if(d){O.call(this,d);U.showPopupMenu(this,{data:this.linksInfo[d].relationObj,pos:{x:b+2,y:e+2}});}else{this.closePopup();a.call(this);}},_max:{x:0,y:0},drawLinks:function E(z){if(isNaN(this._max.x)||isNaN(this._max.y)){this._max={x:0,y:0};}var n=z&&z.MAX_DIMS,g=this._max,AG=parseInt(this.height,10),t=parseInt(this.width,10);if(n){g.x=Math.max(n.x,g.x);g.y=Math.max(n.y,g.y);this.set("height",Math.max(g.y,isNaN(AG)?0:AG)+"px");this.set("width",Math.max(g.x,isNaN(t)?0:t)+"px");}K.call(this);var m=this.relations=(z&&z.relations)||this.relations,AF,AK=m&&m.length,b=8,AM=4;if(J){var x=this.svgNode=document.createElementNS(Q,"svg");x.style.width=this.width;x.style.height=this.height;}for(AF=0;AF<AK;AF++){var j=this.parent.elemBox.children,e=X.find(j,"attributeId",m[AF].parentAttributeId),r=X.find(j,"attributeId",m[AF].childAttributeId);if(e===-1||r===-1){continue;}var AE=j[e],AJ=j[r],o=AE.containerNode,AL=AJ.containerNode,AI=V.delta(o,this.domNode),d=V.delta(AL,this.domNode),AB=AI.x+0.5*o.clientWidth,AA=AI.y+o.clientHeight,v=d.x+0.5*AL.clientWidth,u=d.y,k=(AA-AI.h)>u,y=k?-b:b,AH=k?-AM:AM,AD=m[AF].isJointChildren||false;AA-=k?AI.h:0;u+=k?d.h:0;var c=m[AF];this.linksInfo[AF]={relationObj:c,coords:{src:{x:AB,y:AA},tgt:{x:v,y:u}},marker:[{x:AB,y:AA},{x:AB,y:AA+b},{x:v,y:u},{x:v,y:u-b}]};M.call(this,AF,AB,AA,AB,AA+y,false);M.call(this,AF,AB,AA+y,v,u-y,AD);M.call(this,AF,v,u-y,v,u,false);var f=c.relationType,AC=f===Z.ONE_TO_ONE||f===Z.ONE_TO_MANY,p=f===Z.MANY_TO_MANY,q=f===Z.ONE_TO_ONE,l=f===Z.PARENT_CHILD;if(AC){M.call(this,AF,AB-y,AA+y,AB+y,AA+y,AD);}else{if(p){M.call(this,AF,AB,AA+y,AB-y,AA,AD);M.call(this,AF,AB,AA+y,AB+y,AA,AD);}}if(q){M.call(this,AF,v-y,u-y,v+y,u-y,AD);}else{if(l){F.call(this,AF,v-AH,u-y,v+AH,u-y,v,u,AD);}else{M.call(this,AF,v-y,u,v,u-y,AD);M.call(this,AF,v+y,u,v,u-y,AD);}}}if(J){this.domNode.appendChild(this.svgNode);}}});U=mstrmojo.architect.ui.RelationLinker;U.showPopupMenu=function S(b,f){var g=U.linkMenu=U.linkMenu||new D({zIndex:45});g.set("cmPos",f.pos);g.target=b;g.data=f.data;var d=g.getMenuConfig();var i=document.createElement("div");document.body.appendChild(i);var c=i.style;c.position="absolute";c.top=f.pos.y+"px";c.left=f.pos.x+"px";c.height="1px";c.width="1px";d.hostId=b.id;d.hostElement=i;d.isHostedWithin=false;d.addPopupHandlers(b.id,mstrmojo.emptyFn,function e(){a.call(b);document.body.removeChild(i);});mstrApp.getRootController().prePopulateRelationMenu(f.data,{success:function h(){b.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:d}));}});};}());(function(){mstrmojo.requiresCls("mstrmojo._IsList","mstrmojo.ListBase","mstrmojo.array","mstrmojo.string","mstrmojo.dom","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.Menu","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.menu.DBConnectionsMenu");mstrmojo.requiresDescs(2901);var H=mstrmojo.array,G=mstrmojo.dom,M=mstrmojo.string,C="item-mn",Q=mstrmojo.warehouse.EnumDataChangeEvents,N=mstrmojo.desc(2901,"Loading..."),J=57;function B(S){var U=S.item,R=this.items,T=H.find(R,"did",U.did);R[T]=U;this._getItemNode(T).outerHTML=this.itemRenderer.render(U,T,this);}function D(T){var U=T.item,S=this.items.concat(),R=H.find(S,"did",U.did);if(R>-1){S.splice(R,1);}this.set("items",S);}mstrmojo.warehouse.ui.DBConnectionsList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.architect.ui.DBConnectionsList",cssClass:"mstrmojo-wh-dbConnectionslist",selectionPolicy:"reselect",useRichTooltip:true,showTooltip:function L(S,V){var U=S.target||G.eventTarget(S.hWin,S.e),T=this.getItemFromTarget(U);if(U.className&&(U.className.indexOf("item-n")>-1)){U=U.parentNode;}if(T&&T.n&&(U.scrollWidth>U.clientWidth)){var R=G.position(U);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:M.encodeHtmlString(T.n+"",true),top:R.y+R.h+5,left:R.x};this._super(S,V);}},postBuildRendering:function A(){if(G.isChrome){G.attachEvent(this.domNode,"mousedown",function(R){if(R.which===2){G.stopPropogation(window,R);G.preventDefault(window,R);}});}if(this._super){this._super();}},init:function P(V){this._super(V);var X=this,W={},T=W[this.id]={};T[Q.DBROLES_REQUESTED]=function R(){var Y={n:N,tp:"0",isPrimary:function(){return false;}};X.set("items",[Y]);};T[Q.DBROLES_LOADED]=function U(Y){var Z=Y.offset||0;X.set("items",Y.items);if(Z>0){X.adjustScrollPosition(Z);}};T[Q.DBROLES_ADD]=function S(Y){X.addItems([Y.item]);};T[Q.DBROLE_CHANGED]=B;T[Q.DBROLES_RENAME]=B;T[Q.DBROLES_DELETE]=D;mstrApp.getRootController().attachDataChangeListeners(W);},getItemMarkup:function K(S){var R=(S.mdDBRole&&S.mdDBRole.shared==="1"?" shared":"");return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-ic'+R+'"></span><span class="item-n" >{@n}</span><span class='+C+"></span></div>";},getItemProps:function I(U,R){var V=!!this.selectedIndices[R],T=M.encodeHtmlString(U.n),S=mstrApp.rootController.hasPrivilege(J)?"":" hide-menu";return{sel:V,cls:"tp"+U.tp+(U.isPrimary()?" primary":"")+(V?" selected":"")+S,n:T,idx:R};},onclick:function O(Y){try{var U=Y.target||G.eventTarget(Y.hWin,Y.e),Z=G.findAncestorByAttr(U,"idx",true,this.domNode),X=Z&&parseInt(Z.value,10),R=this.items[X];if(U.className===C&&X!==null&&!isNaN(X)){var W=mstrmojo.warehouse.ui.DBConnectionsList,S=W.dbCtxMenu=W.dbCtxMenu||new mstrmojo.warehouse.menu.DBConnectionsMenu();S.data=R.data;var T=S.getMenuConfig();T.hostId=this.id;T.hostElement=U;T.isHostedWithin=false;T.hostProxyCssClass="item-mn-proxy";T.position=G.position(T.hostElement,true);this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:T}));}else{if(X!==null){this._super(Y);}}}catch(V){throw V;}},onchange:function E(){if(this.selectedItem){mstrApp.getRootController().setSelectedDBRoleID(this.selectedItem);}},adjustScrollPosition:function F(U){var R=this.domNode.clientHeight,T=this.domNode.scrollHeight,S=this.items.length;if(S>0&&T>R){this.domNode.scrollTop=U*(T/S);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.css","mstrmojo._HasOwnAvatar","mstrmojo.architect.menu.AttributeMenu","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.architect.ui.editors.LogicalSizeEditor","mstrmojo.Editor");var U=mstrmojo.dom,b=mstrmojo.css,Z=mstrmojo.Widget,J="px",Q=1,V=2,c,O=mstrmojo.architect.EnumDragActions;function C(e,f){b.toggleClass(this.parentdropZone,["on"],!!e);b.toggleClass(this.childdropZone,["on"],!!f);}mstrmojo.architect.ui.AttributeLabel=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasOwnAvatar,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.AttributeLabel",name:"",addAsParent:mstrmojo.desc(11453,"add as parent"),addAsChild:mstrmojo.desc(11454,"add as child"),markupString:'<div id="{@id}" class="mstrmojo-ar-AttributeLabel {@cssClass}" title="{@name}" style="position:absolute;left:{@left};top:{@top}" mstrAttach:click,mouseout><div class="mstrmojo-ar-al-parentdz">{@addAsParent}</div><div class="mstrmojo-ar-al-content"><span class="close-icon"></span><span class="space-icon"></span><span class="al-icon"></span><span class="al-name">{@name}</span><span class="space-icon"></span><span class="entry-icon"></span><span class="filter-icon"></span><span class="lock-icon"></span></div><div class="mstrmojo-ar-al-childdz">{@addAsChild}</div></div>',markupMethods:{onleftChange:Z.leftMarkupMethod,ontopChange:Z.topMarkupMethod,onnameChange:function F(){var g=this,f=mstrApp.getRootController(),e=f.isTargetSystemDimensionView();g.nameNode.innerHTML=this.name||"";g.domNode.title=this.name||"";b.toggleClass(this.containerNode,"sysDim",e);b.toggleClass(this.closeNode,"sysDim",e);}},markupSlots:{parentdropZone:function H(){return this.domNode.firstChild;},containerNode:function R(){return this.domNode.children[1];},childdropZone:function W(){return this.domNode.children[2];},nameNode:function a(){return this.domNode.children[1].children[3];},menuNode:function A(){return this.domNode.children[1].lastChild;},closeNode:function A(){return this.domNode.children[1].children[0];},entryNode:function A(){return this.domNode.children[1].children[5];},filterNode:function A(){return this.domNode.children[1].children[6];},lockNode:function A(){return this.domNode.children[1].children[7];}},parentdropZone:undefined,childdropZone:undefined,containerNode:undefined,draggable:true,dropZone:true,entryPoint:false,filtered:false,locked:false,size:0,systemDimension:true,postBuildRendering:function X(){this._super();this.updateIcons();},onclick:function d(f){var k=this,e=this.linker.parent,g=mstrApp.getRootController(),j=f.getTarget();switch(j){case k.closeNode:e.storeAttributePositions();g.removeFromHierarchy(k.attributeId);break;case k.entryNode:if(k.entryPoint){k.entryPoint=false;g.removeEntryPoint(k.attributeId);}else{k.entryPoint=true;g.addEntryPoint(k.attributeId);}break;case k.filterNode:var l={success:function h(m){k.filtered=(m.length>0);b.toggleClass(k.filterNode,"noFilter",!k.filtered);}};g.editFilters(this.attributeId,this.name,l);break;case k.lockNode:var i={success:function h(m){var n;k.size=m.size;k.locked=m.locked;if(k.size>0){n=3;}else{if(k.locked){n=2;}else{n=1;}}g.setHierarchyAttributeLockProperty(k.attributeId,n,k.size,{success:function o(){b.removeClass(k.lockNode,"limit");b.removeClass(k.lockNode,"unlocked");if(k.size>0){b.addClass(k.lockNode,"limit");}else{k.size=0;if(!k.locked){b.addClass(k.lockNode,"unlocked");}else{b.addClass(k.lockNode,"limit");}}}});}};k.buildLogicalSizeEditor({locked:k.locked,size:k.size,popupNode:k.lockNode,callBack:i});break;}mstrmojo.dom.stopPropogation(f.hWin,f.e);k.updateIcons();},updateIcons:function T(){var e=this;b.removeClass(e.lockNode,"limit");b.removeClass(e.lockNode,"unlocked");if(e.size>0){b.addClass(e.lockNode,"limit");}else{e.size=0;if(!e.locked){b.addClass(e.lockNode,"unlocked");}else{b.addClass(e.lockNode,"limit");}}b.toggleClass(this.entryNode,"noEntry",!this.entryPoint);b.toggleClass(this.filterNode,"noFilter",!this.filtered);},allowDrop:function I(f){var g=f.src.data,e=f.action;return(g&&(g.scriptClass===this.scriptClass||(f.createRelations&&(e===O.TABLE_VIEW_ATTR||e===O.LINKER_ATTR))));},getDragData:function G(){return this;},createAvatar:function M(){var e=this.containerNode.cloneNode(true);e.style.position="absolute";return e;},getDragAction:function L(){return O.LINKER_ATTR;},isDragValid:function D(){return true;},ondragover:function E(f){var o=this.parentdropZone,l=this.childdropZone,n=false,h=false,e=f.src,m=e&&e.data;if(m&&m!==this&&(m.did!==this.attributeId)){var k=this.domNode,g=U.position(k),j=f.tgt.pos.y-g.y,i=12;n=(j<o.clientHeight+i&&j>=0);h=(j>=k.clientHeight-l.clientHeight-i);if(n){m.type=V;m.caid=this.attributeId;}else{if(h){m.type=Q;m.paid=this.attributeId;}}}C.call(this,n,h);},ondragend:function K(f){var l=f.tgt,o=this.parent,i=f.src&&f.src.data,e=o.domNode;var m=U.position(e),k=U.position(this.parentdropZone),h=this.domNode,j=this.linker,g=i.isDragWithin?parseInt(f.src.pos.x,10):(l.pos.x-m.x),n=i.isDragWithin?parseInt(f.src.pos.y,10):(l.pos.y-m.y-k.h);g=((g<0)?0:g)+J;n=((n<0)?0:n)+J;this.set("left",g);this.set("top",n);o.updateAttributePositions(this.attributeId,{x:g,y:n});j.drawLinks({MAX_DIMS:{x:parseInt(this.left,10)+h.clientWidth,y:parseInt(this.top,10)+h.clientHeight}});i.isDragWithin=false;if(this._super){this._super(f);}},ondrop:function Y(h){var n=this,o=this.linker.parent,j=h.src&&h.src.data,k=j.type,i=o.elemBox,l,f,g,e,m=j.attributeId||j.did;if(j&&(j!==this)&&(this.attributeId!==m)){f=h.tgt.widget.left;g=parseInt(h.tgt.widget.top,10)+((k===Q)?90:(-90));if(g<0){g+=180;}e=g+"px";i.recentDrop=h.src;i.recentDrop.pos.x=f;i.recentDrop.pos.y=e;C.call(this);l=o.getAttributePositions();l[m]={x:f,y:e};j.isDragWithin=true;o.storeAttributePositions();this.raiseEvent({name:"attrRearranged",context:h});}else{C.call(n);}},ondragleave:function B(){C.call(this);},buildLogicalSizeEditor:function S(h){var g=new mstrmojo.Editor({nudge:function e(){var j=mstrmojo.dom.position(h.popupNode,true),i=this.editorNode.style;i.left=j.x+j.w+"px";i.top=j.y+j.h+"px";i.zIndex=1000;},cssClass:"mstrmojo-ar-al-logicalSizeEditor",children:[{scriptClass:"mstrmojo.architect.ui.editors.LogicalSizeEditor",isLocked:h.locked,logicalSize:h.size,unLockInactive:true,alias:"logicalSizeEditor",submitData:function f(){var i=this,j=i.data;if(j&&j.callBack&&j.callBack.success){j.callBack.success(i.getEditorData());}i.parent.close();},data:h},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-MenuEditor-buttons",slot:"buttonNode",cssText:"margin:0px 0px 2px 2px",alias:"buttonBox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Button",cssText:"line-height: 16px; padding:5px 10px;font-weight: bold;",text:mstrmojo.desc(1442,"OK"),alias:"okButton",onclick:function(){g.children[0].submitData();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Button",cssText:"line-height: 16px; padding:5px 10px;font-weight: bold;",text:mstrmojo.desc(221,"Cancel"),alias:"celButton",onclick:function(){g.close();}}]}],showTitle:false,modal:true});g.open();},toggleAvatarClass:function N(e,f){b.toggleClass(this.avatar,e,f);}});c=mstrmojo.architect.ui.AttributeLabel;c.showPopupMenu=function P(h,f){var g=c.menuHelper=c.menuHelper||new mstrmojo.architect.menu.AttributeMenu();g.target=h;g.data=f.data;var e=g.getMenuConfig();e.hostId=h.id;e.hostElement=f.menuNode;h.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:e}));};c.ENUM_DROP_ZONE={CHILD:Q,PARENT:V};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.ui.TablesTree","mstrmojo.warehouse.menu.AvailableTablesMenu");mstrmojo.requiresDescs(2901);var R=mstrmojo.array,N=mstrmojo.hash,A=mstrmojo.string,S=mstrmojo.css,J="loading",C=mstrmojo.dom,L=mstrmojo.warehouse.EnumDataChangeEvents,K=mstrmojo.architect.EnumDragActions,F=mstrmojo.warehouse.EnumObjectTypes,M=mstrmojo.desc(2901,"Loading..."),Q;mstrmojo.warehouse.ui.AvailableTablesTree=mstrmojo.declare(mstrmojo.warehouse.ui.TablesTree,null,{scriptClass:"mstrmojo.architect.ui.AvailableTablesTree",cssClass:"mstrmojo-wh-AvailableTablesTree",tablesTreeHooks:{addItem:function(W,X){var V=mstrApp.getRootController();V.addTables([].concat(X));},isTable:function U(V){return V&&V.tp===F.TABLE;}},createAvatarFunc:undefined,positionAvatarFunc:undefined,useRichTooltip:true,showTooltip:function B(W,Y){var X=W.target||C.eventTarget(W.hWin,W.e);if(X.className&&(X.className.indexOf("item-n")>-1)){X=X.parentNode;}if(X.className.indexOf("item tp")>-1&&(X.scrollWidth>X.clientWidth)){var V=C.position(X);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:X.textContent,top:V.y+V.h+5,left:V.x};this._super(W,Y);}},init:function P(b){this._super(b);var c={},Y=mstrApp.getRootController(),W=c[this.id]={};W[L.DBTABLES_CHANGED]=function Z(e){if(!((this.sourceInfo===e.sourceInfo)||(e.sourceInfo==="")||(e.sourceInfo===undefined))){return ;}this.cleanUp();var h=e.selectedItems||[],g=this.selectedIndices={},f=e.items;R.forEach(h,function(i){g[R.find(f,"n",i)]=true;});this.expandedIndices=e.expandedIndices||{};this.set("items",f);if(this.domNode){this.domNode.onmousedown=function(i){C.preventDefault(window,i);};}};W[L.DBTABLES_REQUESTED]=function a(f){if(!((this.sourceInfo===f.sourceInfo)||(f.sourceInfo===""))){return ;}this.cleanUp();var g=[];g.push({n:M,tp:"0",isVisible:function e(){return true;}});this.set("items",g);S.toggleClass(this.getLeafNode(0),J,true);};W[L.DBTABLE_UPDATED]=function d(e){R.forEach(this.getItemWithPropName(this.items,"did",e.item.did),function(f){this.updateChild(f._renderIdx,e.item);},this);};W[L.DBTABLES_USED]=function X(e){var g=e.items||[],f=this.items;N.forEach(this.selectedIndices,function(h,i){this.toggleChildSelection(String(i),false);},this);R.forEach(g,function(h){this.toggleChildSelection(String(R.find(f,"n",h)),true);},this);};Y.attachDataChangeListeners(c);this.dataHelper={fetch:function V(e,f){if(e.tp===F.TABLE){Y.getColumnsForDBTable({data:e},f);}else{f.success({items:[]});}}};},createAvatar:function I(V){if(this.createAvatarFunc){return this.createAvatarFunc.call(this,V);}else{return this._super(V);}},positionAvatar:function E(W,V){if(this.positionAvatarFunc){this.positionAvatarFunc.call(this,W,V);}else{this._super(W,V);}},cleanUp:function H(){this.expandedIndices={};this.selectedIndices={};this.userSelections={};},onitemsChange:function O(V){if(this._super){this._super(V);}delete this._oldItems;},getItemProps:function T(X,Y,W){var V=A.encodeHtmlString((X.n&&(X.n+""))||"");return{tag:"div",cls:"item "+(X.tp?("tp"+X.tp):""),n:V,idx:W};},getMenuHelper:function D(){Q.menuHelper=Q.menuHelper||new mstrmojo.warehouse.menu.AvailableTablesMenu();return Q.menuHelper;},getDragAction:function G(W){var X=this.getNodeAttributes(W.src.node),V=X&&this.getTreeItem(X.index);switch(V&&V.tp){case F.TABLE:return K.ADD_TABLE;}}});Q=mstrmojo.warehouse.ui.AvailableTablesTree;}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.ui.TablesTree","mstrmojo.architect.menu.ProjectTableMenu","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.architect.ui._HasTreeDropZone","mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo.func");var R=mstrmojo.array,B=mstrmojo.css,c=mstrmojo.string,D="bld",Q,L=mstrmojo.architect.EnumDataChangeEvents,H=L.TABLES_CHANGED,F=L.RENAME,G=L.REMOVE,V=mstrmojo.architect.EnumDragActions,Y=V.ADD_TABLE,a=V.TABLE_VIEW_ATTR,N=V.TABLE_VIEW_METRIC,P=V.PROJECT_TABLE_COLUMN,O=V.COMPOUND_FORM,e=mstrmojo.warehouse.EnumObjectTypes,f=e.TABLE,U=mstrmojo.architect.ui.EnumViewTypes,I=mstrmojo.func.wrapMethods,W="did",h="tp",Z="li",j="idx";function g(k){this.userSelections={};this.expandedIndices={};this.selectedIndices={};this.expandedIndices["0"]=true;this.set("items",k);}function M(k){if(this.hasRendered){var l=this.domNode.getElementsByTagName(Z);R.forEach(l,k,this);}}function K(){this.parent.clearSearch(true);}function A(k){var m=k.name,o=k.did||k.item.did,n,l;R.forEach(this.getItemWithPropName(this.items,W,o),function(u){var t=u._renderIdx;if(m===G){var w={};w[t]=true;this.clearUserSelections(w);this.removeChild(t);if(u.tp===f){var q=t.split(":")[0],p=this.getTreeItem(q);if(p.items.length===0){this.removeChild(q);}}}else{var r=k.item,v=m===H;if(m===F){u.n=k.value;}else{if(v){l=r;u.multi=r.multi;}}this.updateChild(n||t,l||u);}},this);this.refresh();}function E(k){var l=this.items;if(!l||!l.length){return ;}var m={};R.forEach(k.tableItems,function(n){R.forEach(this.getItemWithPropName(l,W,n.did),function(o){m[o._renderIdx]=true;});},this);this.clearUserSelections(m);M.call(this,function(o){var n=o.getAttribute(j);if(m[n]===true){B.toggleClass(o.firstChild,D,!!k.toAdd);}});}function i(){var l=this.items,k=this.searchMode?l.concat(l[0].items):l;R.forEach(k,function(m){R.forEach(m.items,function(n){if(n.bold){delete n.bold;this.updateChild(n._renderIdx,n);}},this);},this);}mstrmojo.architect.ui.ProjectTablesTree=mstrmojo.declare(mstrmojo.warehouse.ui.TablesTree,[mstrmojo.architect.ui._HasTreeDropZone],{scriptClass:"mstrmojo.architect.ui.ProjectTablesTree",cssClass:"mstrmojo-ar-ProjectsTablesTree",tablesTreeHooks:{addItem:function(m,n){var l=mstrApp.getRootController(),k=l.model;if(k.currentView===U.LAYER){l.addOrRemoveTables([].concat(n),true);}}},init:function b(m){this._super(m);this.items=this.items||[];var p=this,o={},q=o[this.id]={},k=mstrApp.getRootController();q[L.TABLES_LOADED]=function n(r){g.call(p,r.items);};q[L.TABLES_ADDED]=K;q[H]=q[F]=q[G]=A;q[L.TABLES_SELECTED]=E;q[L.LAYER_CHANGE]=i;k.attachDataChangeListeners(o);this.dataHelper={fetch:function l(r,u){if(r.isSearch){k.loadSearchObjectContents(r,u);}else{k.loadTableContents(r,I({success:function t(v){v.items=p.getItemWithPropName(v.items.items,W,r.did)[0].items;}},u));}}};if(this.itemRenderer){this.itemRenderer.render=function(u,w,r,v){var t=u._renderIdx;if(p.userSelections&&p.userSelections[t]!==undefined){p.userSelections[r]=p.userSelections[t];delete p.userSelections[t];}u._renderIdx=r;u._renderLvl=w;return c.apply(v.getItemMarkup(u,w,r),v.getItemProps(u,w,r));};}},getItemProps:function T(m,o,k){var n=m.icntp||m.tp,l=["item",(n?("tp"+n):""),(m.multi?"mso":""),(m.bold?D:""),(m.isError?"err":""),(m.unused?"uc":"")];return{tag:"div",cls:l.join(" "),n:c.encodeHtmlString(m.n||""),idx:k,ttp:c.encodeXMLAttribute(m.ttp||"")};},showMenu:function X(l){var u=this,p=this.getMenuHelper(),v=1,k=l.data[W],m=l.data[h],o=mstrApp.getRootController(),n,t,r,w={success:function(x){r=x.items;if(r){t=r.items;if(t&&t.length===1){n=t[0];l.data.size=n.size;l.data.isLocked=n.isLocked;}}}};o.setTableMenuContext(v);if(m===e.TABLE){o.populateTableContents(k,w);}p.target=u;p.data=l.data;var q=p.getMenuConfig();q.hostId=u.id;q.hostElement=l.menuNode;q.isHostedWithin=false;q.hostProxyCssClass="item-mn-proxy";u.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:q}));},getMenuHelper:function d(){Q.menuHelper=Q.menuHelper||new mstrmojo.architect.menu.ProjectTableMenu();return Q.menuHelper;},getDragAction:function J(m){var o=this.getNodeAttributes(m.src.node),l=o&&this.getTreeItem(o.index),k=l&&l.tp,n=this.searchMode;switch(k){case f:return V.PROJECT_TABLE;case e.ATTRIBUTE:return !n&&a;case e.COLUMN:return !n&&P;case e.FACT:return !n&&N;case e.FORM:return !n&&O;}},allowDrop:function C(k){return[Y,a,N,P,O].indexOf(k.action)!==-1;},ondrop:function S(o){var l=o.action,p=o.src.data,n=mstrApp.getRootController(),k,r,m,q=this.getNodeAttributes(o.tgt.node);if(p){if(l===Y){n.addTables(p);}else{if(l===O){m=this.getTreeItem(q.index);k=p.tp===21?p.sid:p.did;r=m.tp===21?m.sid:m.did;if(r===k){if(p.bfIdx!==m.bfIdx){n.groupForms([p],m);}}}else{if([P,a,N].indexOf(o.action)!==-1){n.addTableInfo(p,this.getTreeItem(q.index));}}}}if(this._super){this._super(o);}}});Q=mstrmojo.architect.ui.ProjectTablesTree;}());(function(){mstrmojo.requiresCls("mstrmojo._HasOwnAvatar","mstrmojo._IsMovable","mstrmojo.array","mstrmojo.Container","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.EnumDragActions","mstrmojo.architect.menu.DBTableMenu","mstrmojo.architect.ui.TableRows","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.Menu","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.warehouse.EnumObjectTypes");var D=mstrmojo.css,L=mstrmojo.dom,U=mstrmojo.hash,f=Math.max,h="px",J="No attributes or facts currently mapped.",l="dragging",a=220,R=150,K,O=mstrmojo.architect.EnumDataChangeEvents,e=mstrmojo.architect.EnumDragActions,E=mstrmojo.warehouse.EnumObjectTypes,Z=10;function S(){if(this.domNode){var p=this.domNode.style,q=this.tableData;p.left=this.left||q.x;p.top=this.top||q.y;}}function I(p){var q=p.style.zIndex;if(parseInt(q,10)<(Z-1)){p.style.zIndex=Z++;}}function i(p,r){var t=this.rows,q=this.domNode;if(p===undefined||r===undefined){this.minHeight=this.height=Math.min(q.clientHeight,a);this.width=f(q.clientWidth,R);}else{this.height=f(p,this.minHeight);this.width=f(r,R);}t.set("height",(this.height-this._ttlHeight)+h);t.set("width",this.width+h);}mstrmojo.architect.ui.TableView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsMovable,mstrmojo._HasOwnAvatar,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.TableView",markupString:'<div id="{@id}" class="mstrmojo-ar-TableView" mstrAttach:click><div class="mstrmojo-ar-tv-header item"><span class="mstrmojo-ar-tv-ttl">{@title}</span><span class="item-mn"></span></div><div class="mstrmojo-ar-tv-rsz"></div></div>',markupSlots:{headerNode:function k(){return this.domNode.firstChild;},titleNode:function W(){return this.domNode.firstChild.firstChild;},containerNode:function X(){return this.domNode;},menuNode:function o(){return this.domNode.firstChild.lastChild;},resizeHandle:function j(){return this.domNode.children[1];}},init:function m(p){this._super(p);this.rows.attachEventListener("tableViewMenuSelect",this.id,function q(r){K.showPopupMenu(this,r);});},rows:undefined,preBuildRendering:function A(){this._super();this.title=this.tableData.n;var p=this.tableData.items;if(!p||p.length===0){p=this.tableData.items=[{n:J,tp:"none"}];}this.rows.items=p;},postBuildRendering:function Q(){this._super();S.call(this);this._ttlHeight=this.headerNode.clientHeight;i.call(this);this.domNode.style.zIndex=Z++;},registerSelection:mstrmojo.emptyFn,getMenuTableData:mstrmojo.emptyFn,setTableSelected:function N(p){this.selected=p;D.toggleClass(this.domNode,"selected",!!p);I(this.domNode);},getTableID:function C(){return this.tableData.did;},onclick:function c(p){var q=p.getTarget();if(q===this.menuNode){K.showPopupMenu(this,{menuNode:this.menuNode,data:this.getMenuTableData()});}else{this.registerSelection(p);this.setTableSelected(true);}},ontableDataChange:function G(){var p=this.rows;p.height=p.width=undefined;this.refresh();},isItemAvailable:function T(p){return((this.getTableID()===p)||this.rows.isItemAvailable(p));},handleEvent:function P(p){var t=(p.item&&p.item.did)||p.did,q=this.tableData.items,r;if(this.getTableID()===t){switch(p.name){case O.RENAME:this.titleNode.innerHTML=this.title=p.value;return true;case O.LAYER_TABLE_CHANGED:this.set("tableData",p.item);return true;}}else{r=this.rows.handleEvent(p);if(!q||q.length===0){q=this.tableData.items=[{n:J,tp:"none"}];this.rows.items=q;this.ontableDataChange();}return r;}return false;},getMovingHandle:function n(){return this.headerNode;},draggable:true,createAvatar:function Y(p){var r=document.createElement("div");if(p!==this.resizeHandle){var q=L.findAncestorByAttr(p,"idx",true,this.domNode);if(q&&q.node){r.appendChild(q.node.cloneNode(true));r.appendChild(document.createElement("div"));}else{if(p===this.headerNode||p===this.titleNode){return this.domNode.cloneNode(true);}}r.className=this.domNode.className+" "+this.rows.domNode.className;}return r;},toggleAvatarClass:function g(p,q){D.toggleClass(this.avatar,p,q);},isDragValid:function V(p){return p.src.node===this.resizeHandle||this._super(p)||false;},ondragstart:function d(p){this._super(p);this.shouldBeginDrag=L.contains(this.getMovingHandle(),p.src.node,true,document.body);this.closePopup();D.toggleClass(this.domNode,[l],true);if(p.src.node===this.resizeHandle){this._rszCfg={h:this.height,w:this.width};}},ondragmove:function H(r){var p=r.src.pos,t=r.tgt.pos,q;if(this._rszCfg){q=this._rszCfg;i.call(this,q.h+t.y-p.y,q.w+t.x-p.x);}else{this.positionAvatar(t);}},ondragend:function F(r){var p=r.src.pos,u=r.tgt.pos,q=this.getMovingTarget().style;if(this.shouldBeginDrag){q.left=this.left=Math.max(0,this._leftPos+u.x-p.x)+"px";q.top=this.top=Math.max(0,this._topPos+u.y-p.y)+"px";}this._super(r);var t=this.domNode;D.toggleClass(t,[l],false);I(t);delete this._rszCfg;},getDragAction:function M(p){var q=L.findAncestorByAttr(p.src.node,"idx",true,this.domNode);if(q){switch(this.rows.getRowItem(q.value).tp){case E.ATTRIBUTE:return e.TABLE_VIEW_ATTR;case E.COLUMN:return e.PROJECT_TABLE_COLUMN;case E.FACT:return e.TABLE_VIEW_METRIC;case E.FORM:return e.COMPOUND_FORM;}}},getDragData:function b(q){var r=L.findAncestorByAttr(q.src.node,"idx",true,this.domNode);if(r){var p=this.rows.getRowItem(r.value);q.createRelations=true;return U.copy(p,{attributeId:p.did,tableId:this.tableData.did});}},children:[{scriptClass:"mstrmojo.architect.ui.TableRows",alias:"rows"}]});K=mstrmojo.architect.ui.TableView;K.showPopupMenu=function B(p,r){var t=K.menuHelper=K.menuHelper||new mstrmojo.architect.menu.DBTableMenu(),u=2;mstrApp.getRootController().setTableMenuContext(u);t.target=p;t.data=r.data;var q=t.getMenuConfig();q.hostId=p.id;q.hostElement=r.menuNode;q.isHostedWithin=false;q.hostProxyCssClass="item-mn-proxy";p.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:q}));};}());(function(){mstrmojo.requiresCls("mstrmojo.HTMLButton","mstrmojo.CheckBox","mstrmojo.Editor","mstrmojo.HBox","mstrmojo.Label","mstrmojo.RadioButton","mstrmojo.warehouse.dbroles.DBRoleDSNConnection","mstrmojo.warehouse.dbroles.DBRoleSetting","mstrmojo.warehouse.obj.DBRole");mstrmojo.requiresDescs(10070,12933,12949,11139,8513,1162,11134,10071,1442,221);var G=mstrmojo.array,M=mstrmojo.string,K=mstrmojo.warehouse.EnumObjectTypes,B="PWDHIDDEN123!@#",L=57;function J(){var P=this,N=this.dbrole.mdDBRole,Q=M.trim(P.container.txtname.text),R;if(Q!==N.n){if(!mstrApp.getRootController().validateName(K.DBROLE,Q,N.n)){return false;}}if(P.container.txtlogin.visible){R=P.container.txtlogin.isValid();if(!R.val){mstrmojo.alert(R.msg);return false;}}if(P.container.txtpwd.visible){R=P.container.txtpwd.isValid();if(!R.val){mstrmojo.alert(R.msg);return false;}}if(P.container.dsnSelector.WHDSNLIST.selectedIndex===1){var O=P.container.dsninfo.dsnBox.dsnList.selectedItem;if(!O||O.des==="0"){mstrmojo.alert(mstrmojo.desc(10070,"Please select a DSN first"));return false;}}else{R=P.container.dsninfo.isValidInput();if(!R.val){mstrmojo.alert(R.msg);return false;}}return true;}function F(){var Q=this,V=this.container.dsninfo,R=this.dbrole.mdDBRole,O=this.config,N=R.connstr,P=this.container,S=false,T=function T(){V.clear();if(!N){var Y=window.localStorage,W=parseInt((Y&&Y.getItem("dbRoleDSNOption"))||0,10);if(W===0||S){P.dsnSelector.WHDSNLIST.set("selectedIndex",0);}else{P.dsnSelector.WHDSNLIST.set("selectedIndex",1);}}else{var X=(N.split("=")[0]).toUpperCase();if(X==="DSN"){P.dsnSelector.WHDSNLIST.set("selectedIndex",1);}else{P.dsnSelector.WHDSNLIST.set("selectedIndex",0);}}V.set("info",R);if(!R.shared){R.shared="0";}if(mstrApp.isSingleTier){P.sharedConnection.domNode.style.display="none";}else{P.sharedConnection.checked=(R.shared==="1");P.sharedConnection.refresh();}R.des=(mstrApp.rootController.isCloud()?R.n:"");R.ln=R.ln||"";P.txtlogin.set("text",R.ln);if(R.did===""){R.password=R.password||"";}else{R.password=R.password||B;}P.txtpwd.set("text",R.password);P.txtname.set("text",R.n||R.des);};if(O||mstrApp.isSingleTier){mstrApp.rootController.getDBObjects().reloadDSNs({success:function U(){T.call(Q);}});if(O.hideDSNOption||(mstrApp.isSingleTier&&navigator.userAgent.indexOf("Macintosh")>-1)){P.dsnSelector.domNode.style.display="none";S=true;}if(O.hideDriverCheck){P.dsninfo.set("hideDriverCheck",O.hideDriverCheck);}if(O.requiresLogin!==undefined){P.txtlogin.isRequired=O.requiresLogin;P.txtpwd.isRequired=O.requiresLogin;}if(O.dbIdFilter){P.dsninfo.dbIdFilter=O.dbIdFilter.sort(G.numSorter);}if(O.dbIdExcludeFilter){P.dsninfo.dbIdExcludeFilter=O.dbIdExcludeFilter.sort(G.numSorter);}if(O.dsnDbTypeExcludeFilter){P.dsninfo.dsnDbTypeExcludeFilter=O.dsnDbTypeExcludeFilter.sort(G.numSorter);}if(O.showAddDriver){P.dsninfo.set("showAddDriver",O.showAddDriver);}if(O.singleType){P.dsninfo.set("singleType",true);}if(O.cfgDbmsTypeExcludeFilter){P.dsninfo.set("cfgDbmsTypeExcludeFilter",O.cfgDbmsTypeExcludeFilter);}P.sharedConnection.set("visible",!(O.hideShareConnection||false));}else{T.call(Q);}}function H(T){var R=this;var U=this.container,P=U.dsninfo,N=this.dbrole.mdDBRole;if(mstrApp.rootController.isCloud()){N.des=M.trim(U.txtname.text);N.n=N.des+"___"+new Date().getTime();}else{N.n=M.trim(U.txtname.text);}N.des=N.des.replace(",","%%%");N.n=N.n.replace(",","%%%");N.dbr_type="2";N.owned="1";N.writable="1";if(U.sharedConnection.isChecked()){N.shared="1";}else{N.shared="0";}if(U.txtlogin.visible){N.ln=M.trim(U.txtlogin.text);}else{N.ln="";}if((U.txtpwd.text!==B)&&(U.txtpwd.visible)){N.password=U.txtpwd.text;}else{delete N.password;}var Q=P.getConnectionStr();N.connstr=Q.str;N.db_type=P.getDBType();N.cefu=P.getCharEncodingForUnix();N.driverMode=P.getDriverMode();N.odbcv=P.getOdbcv();N.dbms=P.getDbmsID();N.ab=P.getDBId();P.getVLDBProperties(N.vldbProperties);mstrApp.rootController.saveDBRole(this.dbrole,(N.did===""),{errorMsg:Q.err,success:function S(){if(R.callback&&R.callback.success){R.callback.success(R.dbrole);}if(T&&T.keepOpen){T.success();}else{R.close();}},complete:function O(){if(this.errorMsg!==""){mstrmojo.alert(this.errorMsg);}}});}function A(P,Q){var O=(P.dbrole?P:P.parent),N=O.dbrole.mdDBRole;if(N.writable==="1"&&mstrApp.rootController.hasPrivilege(L)){if(J.call(O)){H.call(O,Q);}}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}mstrmojo.warehouse.dbroles.DBRoleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleEditor",cssClass:"mstrmojo-wh-DBRoleEditor",title:mstrmojo.desc(12949,"Data Source"),zIndex:100,dbrole:undefined,useDSN:true,callback:mstrmojo.emptyFn(),onOpen:function C(){F.call(this);},onClose:function I(){if(this.callback&&this.callback.close){this.callback.close();}},container:undefined,dsnSelector:undefined,WHDSNLIST:undefined,dsninfo:undefined,txtlogin:undefined,txtpwd:undefined,sharedConnection:undefined,hideDSNOption:undefined,hideDriverCheck:undefined,requiresLogin:undefined,children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DBRoleEditor-container",alias:"container",children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DSNSelector",alias:"dsnSelector",children:[{scriptClass:"mstrmojo.ui.CheckList",cssClass:"mstrmojo-wh-DSNSelector-radio",multiSelect:false,orientation:"h",alias:"WHDSNLIST",items:[{did:"0",n:mstrmojo.desc(11132,"DSN less data sources")},{did:"1",n:mstrmojo.desc(11133,"DSN data sources")}],onchange:function(){if(this.selectedIndex===0){this.parent.parent.dsninfo.set("isDSNLess",true);}else{this.parent.parent.dsninfo.set("isDSNLess",false);}var N=window.localStorage;if(N){N.setItem("dbRoleDSNOption",this.selectedIndex);}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleEditor-info",text:mstrmojo.desc(11139,"Connection Information"),visible:false},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleDSNConnection",alias:"dsninfo",onEnterFn:function E(N){A(N.parent.parent);},updateLoginFn:function D(N){this.parent.txtlogin.set("visible",N);this.parent.txtpwd.set("visible",N);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtlogin",isRequired:true,caption:mstrmojo.desc(8513,"login:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtpwd",isPassword:true,hiddenPwd:B,isRequired:true,caption:mstrmojo.desc(1162,"password:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtname",caption:mstrmojo.desc(11134,"ds name:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.CheckBox",cssClass:"mstrmojo-wh-DBRoleEditor-infoCheckbox",alias:"sharedConnection",label:mstrmojo.desc(10071,"Share this connection with everybody")}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonsbox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button rightfloat mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){A(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"buttonCancel",onclick:function(){var N=this.parent.parent;if(N.onCancel){N.onCancel();}N.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.architect.ui.TableView","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.EnumDragActions","mstrmojo._HasLassoSelector","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.hash","mstrmojo.array");var C=mstrmojo.dom,M=mstrmojo.hash,H=mstrmojo.array,N=mstrmojo.boxmodel,K=mstrmojo.architect.EnumDataChangeEvents,J=mstrmojo.architect.EnumDragActions,L=J.PROJECT_TABLE,E=J.ADD_TABLE,Q=K.REMOVE,G=25,D="px";function W(Y){var a=Y.item,Z=Y.did||a.did,c=Y.name;H.forEach(this.children,function b(d){if(d.isItemAvailable(Z)){var e=d.handleEvent(Y);if(!e){switch(c){case Q:this.removeTable(d.tableData);return false;}}}return true;},this);}function F(Z,a){var Y=this.selTableIds;if(Y.length>0&&!a){H.forEach(Y,function(b){mstrmojo.all[b].setTableSelected(false);});this.selTableIds=[];}this.selTableIds.push(Z);}mstrmojo.architect.ui.TableContainer=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLassoSelector,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.TableContainer",markupString:'<div id="{@id}" class="mstrmojo-ar-TableContainer {@cssClass}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-ar-tc-container"></div></div>',markupSlots:{containerNode:function P(){return this.domNode.lastChild;}},init:function O(b){this._super(b);var Y=mstrApp.getRootController(),c={},a=c[this.id]={};a[K.TABLES_SELECTED]=function d(e){H.forEach(e.tableItems,function(f){this[((e.toAdd?"add":"remove")+"Table")](f);},this);};a[K.LAYER_TABLE_CHANGED]=a[K.RENAME]=a[Q]=W;a[K.BEFORE_LAYER_CHANGE]=this.updateTablePositionCache;Y.attachDataChangeListeners(c);this.selTableIds=[];var Z=this;Y.registerSaveCallback(function(){if(Z.hasRendered){Z.updateTablePositionCache();}});},onclick:function X(Y){var Z=Y.getTarget();if(Z===this.containerNode||Z===this.domNode){H.forEach(this.children,function(a){a.setTableSelected(false);},this);this.selTableIds=[];}},addTable:function R(e){var b=this,a=this.children,d=e.did;H.forEach(a,function(f){if(f.isItemAvailable(d)){this.removeTable(e);}},this);if((e.x===undefined)||(e.y===undefined)){var Y=G*(a?a.length:0)+D;e=M.copy({x:Y,y:Y},e);}b.addChildren([new mstrmojo.architect.ui.TableView({tableData:e,left:e.x,top:e.y,registerSelection:function Z(f){F.call(b,this.id,(C.ctrlKey(f.hWin,f.e)||C.isMetaKey(f.hWin,f.e)));},getMenuTableData:function c(){var f=mstrmojo.all,g=b.selTableIds,h=[];if(g.length>1){H.forEach(g,function(i){h.push(f[i].tableData);});}else{h=this.tableData;}return h;}})]);},removeTable:function U(a){var Y=this,Z=a.did;H.forEach(this.children,function(c,b){if(c.getTableID()===Z){Y.removeChildren(Y.children[b]);mstrApp.getRootController().removeFromCurrentLayer(c.tableData);return false;}return true;});},updateTablePositionCache:function T(){if(this.domNode){var a=this.children,Y=C.position(this.domNode),Z=[];H.forEach(a,function(b){var c=C.position(b.domNode);Z.push(M.copy({x:((c.x-Y.x)+D),y:((c.y-Y.y)+D),h:c.h+D,w:c.w+D},b.tableData));});mstrApp.getRootController().setLayerTablePositions(Z);}},refresh:function A(Y){if(Y){this.updateTablePositionCache();}this.removeChildren();H.forEach(mstrApp.getRootController().getTablePositions(),function(Z){this.addTable(Z);},this);},dropZone:true,allowDrop:function B(Y){return[L,E].indexOf(Y.action)!==-1;},ondrop:function S(Z){var f=Z.action,b=Z.src,d=b.data;if(b&&d){if(f===L||f===E){var c=C.position(this.domNode),Y=Z.tgt.pos,g=Y.x-c.x,e=Y.y-c.y;H.forEach(d,function a(j,h){var i=G*h;j.x=g+i;j.y=e+i;});mstrApp.getRootController().addOrRemoveTables(d,true);}}},ondragstart:function V(Z){var b=this.children,Y=this.containerNode,a=this.childPositions=[];H.forEach(b,function(e){var d=e.domNode,c=C.position(d),f=C.delta(d,Y);a.push({id:e.id,x:f.x,y:f.y,h:c.h,w:c.w});});this._super(Z);},onSelectedBoundingBox:function I(Y){var a=function a(b){return N.rangeIntersect(b.y,b.y+b.h,Y.y,Y.y+Y.h)&&N.rangeIntersect(b.x,b.x+b.w,Y.x,Y.x+Y.w);},Z=this.selTableIds=[];H.forEach(this.childPositions,function(d){var e=d.id,c=a(d),b=Z.indexOf(e);mstrmojo.all[e].setTableSelected(c);if(c){Z.push(e);}else{if(b!==-1){Z.splice(b,1);}}},this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.panels.UnitsPanel","mstrmojo.architect.ui.ProjectTablesTree","mstrmojo.css");var D=mstrmojo.array,F=mstrmojo.css,I=mstrmojo.architect.EnumDataChangeEvents,B="%% Items",J=mstrmojo.desc(11136,"project tables"),E=mstrmojo.desc(11384,"Update All");mstrmojo.architect.ui.ProjectTablesPanel=mstrmojo.declare(mstrmojo.architect.ui.panels.UnitsPanel,null,{scriptClass:"mstrmojo.architect.ui.ProjectTablesPanel",title:J,init:function H(M){this._super(M);var R=this.searchBox;this.addNewTitleButton({alias:"updateBtn",title:E,cssClass:"mstrmojo-wh-refresh",onclick:function L(){R.clearSearch();mstrApp.getRootController().handleUpdateStructures();}});var Q=this,O={},P=O[this.id]={},K=mstrApp.getRootController();P[I.TABLES_LOADED]=function N(S){var T=0;D.forEach(S.items,function(U){T+=U.items.length;});Q.set("titleTooltip",B.replace("%%",T.toString()));};K.attachDataChangeListeners(O);},onPanelSearch:function C(K){mstrApp.rootController.findDependentsByNameSearch(K.searchValue);var L=this.contentWidget.searchMode=this.searchBox._hasText;F.toggleClass(this.domNode,"searchMode",L);},clearSearch:function G(){this.searchBox.clearSearch();},getContentWidget:function A(){return{scriptClass:"mstrmojo.architect.ui.ProjectTablesTree"};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.DataGrid","mstrmojo.dom","mstrmojo.Editor","mstrmojo.RadioButton","mstrmojo.architect.ui.SQLInputBox","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.NameSpacePullDown");var i=mstrmojo.array,c=mstrmojo.hash,D=mstrmojo.css,U=mstrmojo.dom,h="1",k="2",m="0",g="2",t="4",f=mstrmojo.warehouse.EnumNamespaceMode.ALL,l=mstrmojo.warehouse.EnumNamespaceMode.CURRENT,T="mstrmojo-ar-catSQL",r=mstrmojo.desc(12261,"Catalog Options"),b=mstrmojo.desc(12262,"Catalog mode"),P=mstrmojo.desc(12263,"Data source SQL"),W=mstrmojo.desc(12264,"ODBC calls"),V=mstrmojo.desc(8368,"Caching"),H=mstrmojo.desc(12265,"Table names only"),L=mstrmojo.desc(12266,"Table and column names"),p=mstrmojo.desc(2057,"None"),j=mstrmojo.desc(12267,"Cannot guarantee caching when using non-default SQL"),E=mstrmojo.desc(2177,"Close"),M=mstrmojo.desc(12268,"Namespaces"),F=mstrmojo.desc(3524,"All"),A=mstrmojo.desc(12269,"Current only"),J=mstrmojo.desc(12270,"SQL statement to retrieve table and column names for this data source"),Z=mstrmojo.desc(12271,"SQL statement to retrieve tables available in the data source"),X=mstrmojo.desc(12272,"SQL statement to retrieve columns for the selected tables"),I=mstrmojo.desc(3389,"Preview"),O=mstrmojo.desc(134,"Apply"),G=mstrmojo.desc(12273,"Use default value"),C={full:J,table:Z,column:X};var q;var Y;function S(u){return u.replace(/[ \n\r\t]/g,"");}function e(AB,w,y){var x=new mstrmojo.Box({alias:"sqlBox",cssClass:T+"-sqlBox",defaultSQL:"",useDefaultSQL:function AA(){return(S(this.defaultSQL)===S(this.currentSQL));},currentSQL:"",resize:function v(){var AG=this.sqlText.domNode,AE=U.position(AG).h,AD=AG.offsetTop,AC=U.position(AG).w,AF=this.curtain;AF.domNode.style.height=AE+"px";AF.domNode.style.width=AC+"px";AF.domNode.style.top=AD+"px";},children:[{scriptClass:"mstrmojo.HBox",alias:"sqlHead",cssClass:"sqlSection-box",children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sqlLabel",text:C[y]},{scriptClass:"mstrmojo.CheckBox",cssClass:T+"-check",alias:"sqlCheck",index:y,label:G,oncheckedChange:function z(){var AD=this.parent.parent,AC=AD.parent.parent.parent,AE;AD.curtain.set("visible",this.checked);if(this.checked){AD.sqlText.setSQLStatement(AD.defaultSQL);}else{if(!AC.loadingPanel){switch(AC.options.cacheMode.value){case m:AE=L;break;case g:if(this.index==="column"){return ;}AE=H;break;case t:return ;}mstrmojo.alert(j,undefined,V+": "+AE);}}}}]},{scriptClass:"mstrmojo.architect.ui.SQLInputBox",cssClass:"mstrmojo-ar-sqlInput-inputbox visible "+T,alias:"sqlText"},{scriptClass:"mstrmojo.Label",cssClass:T+"-curtain",alias:"curtain"}]});this.contents.rightPanel.addChildren([x]);var u=x.sqlText;D.toggleClass(u.domNode,"full",(this.options.cacheMode.value===m));x.resize();x.defaultSQL=AB[i.find(AB,"tp",y)].sql;x.currentSQL=w[i.find(w,"tp",y)].sql;u.setSQLStatement(x.currentSQL);x.sqlHead.sqlCheck.checked=!x.useDefaultSQL();x.sqlHead.sqlCheck.set("checked",x.useDefaultSQL());return x;}function R(AB,w,z,v){var y=this,x,u,AA;u=AB[i.find(AB,"tp",z)];x=w[i.find(w,"tp",z)];AA=y.contents.rightPanel.children[v].sqlText.getSQLStatement();if(AA===u.sql){AA="";}x.sql=AA;return x;}function N(y,x,w,u){var v,AB;if((x.value===f)){v=c.cloneArray(y.SQLStatements.currentSQLs.allNS);AB=c.cloneArray(y.SQLStatements.defaultSQLs.allNS);if(w.value===t){if(y.supportsNameSpaces){v=c.cloneArray(y.SQLStatements.currentSQLs.currentNS);AB=c.cloneArray(y.SQLStatements.defaultSQLs.currentNS);}}else{if(w.value===g){if(y.supportsNameSpaces){var AA=y.SQLStatements.currentSQLs.currentNS,z=y.SQLStatements.defaultSQLs.currentNS;v[i.find(v,"tp","column")]=AA[i.find(AA,"tp","column")];AB[i.find(AB,"tp","column")]=z[i.find(z,"tp","column")];}}}}else{v=c.cloneArray(y.SQLStatements.currentSQLs.currentNS);AB=c.cloneArray(y.SQLStatements.defaultSQLs.currentNS);}if(u){return v;}return AB;}function B(){var x=this,v=new mstrmojo.Box({alias:"sqlPreviewBox",cssClass:T+"-sqlBox",children:[{scriptClass:"mstrmojo.Box",cssClass:T+"-preview",alias:"sqlPreviewContents",children:[{scriptClass:"mstrmojo.Table",alias:"sqlPreviewTable",rows:1,cols:3,children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sqlPreviewLabel",slot:"0,0",text:I},{scriptClass:"mstrmojo.warehouse.ui.NameSpacePullDown",alias:"nameSpaces",sourceInfo:"CatSQL",slot:"0,1",onItemSelectedCallback:function y(z){x.selectedNS=z.n;}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+T+"-button",slot:"0,2",text:O,onclick:function u(){var AC=x.options,z=AC.catalogMode,AD=AC.nsMode,AB=AC.cacheMode,AA,AF,AE=[];AE.push(z);AE.push(AD);AE.push(AB);if(AC.catalogMode.value===h){AA=N(x,AD,AB,true);AF=N(x,AD,AB,false);switch(AB.value){case m:AE.push(R.call(x,AF,AA,"full",0));break;case g:AE.push(R.call(x,AF,AA,"table",0));AE.push(R.call(x,AF,AA,"column",1));break;case t:AE.push(R.call(x,AF,AA,"table",0));AE.push(R.call(x,AF,AA,"column",1));break;}}x.onUpdateInfo({options:AE});if((x.supportsNameSpaces&&x.selectedNS)||(!x.supportsNameSpaces)){mstrApp.rootController.availableTableSearch("",{dbRoleID:x.dbRole.did,nameSpace:x.selectedNS||"",getFresh:true,sourceInfo:"CatSQL"});}}}]}]},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",alias:"dbTableTree",cssClass:"mstrmojo-wh-AvailableTablesTree "+T+"-dbTablesTree",sourceInfo:"CatSQL",editor:x,postCreate:function w(){if(this.editor.options.catalogMode.value===k){this.cssClass+="-none";}}}]});this.contents.rightPanel.addChildren([v]);}function Q(){var u,v=this.parent.count,w=this.parent.prefix;if(this.checked){for(u=0;u<v;u++){this.parent[w+u].set("checked",false);}this.set("checked",true);}}function K(){var y=this,v=y.options,x=y.contents.rightPanel,u,z,w;if(y.loading){return ;}this.loadingPanel=true;x.removeChildren();if(v.catalogMode.value===h){u=N(y,v.nsMode,v.cacheMode,true);z=N(y,v.nsMode,v.cacheMode,false);Y=[];switch(v.cacheMode.value){case m:w=e.call(y,z,u,"full");Y.push(w);break;case g:Y.push(e.call(y,z,u,"table"));Y.push(e.call(y,z,u,"column"));break;case t:Y.push(e.call(y,z,u,"table"));Y.push(e.call(y,z,u,"column"));break;}}B.call(y);y.contents.rightPanel.sqlPreviewBox.sqlPreviewContents.sqlPreviewTable.nameSpaces.domNode.style.visibility=(y.supportsNameSpaces?"":"hidden");if(y.supportsNameSpaces){mstrApp.rootController.getNameSpaces({dbRoleID:y.dbRole.did,sourceInfo:"CatSQL"});}this.loadingPanel=false;}mstrmojo.warehouse.ui.editors.CatalogSQLEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.warehouse.ui.editors.CatalogSQLEditor",cssClass:T,title:r,options:{},SQLStatements:[],onUpdateInfo:undefined,supportsNameSpaces:false,dbRole:undefined,sql:"",curtain:undefined,useDefaultSQL:undefined,contents:undefined,rightPanel:undefined,sqlPreviewBox:undefined,sqlPreviewContents:undefined,sqlPreviewTable:undefined,leftPanel:undefined,currentSQLs:undefined,defaultSQLs:undefined,catalogModeRBBox:undefined,catalogModeRB0:undefined,catalogModeRB1:undefined,cacheMode:undefined,nsMode:undefined,catalogMode:undefined,sqlCheck:undefined,allNS:undefined,currentNS:undefined,cacheModeRBBox:undefined,nsModeRBBox:undefined,nsModeRB1:undefined,browserResized:function o(u){var v=parseInt(u.w,10);q=u;if(isNaN(v)||v<0||!this.domNode){return ;}if(v<800){v=760;}else{if(v>1063){v=1010;}else{v=Math.ceil(v*0.95);}}this.domNode.children[0].style.width=v+"px";this.contents.rightPanel.domNode.style.width=(v-219)+"px";i.forEach(Y,function(w){w.resize();});},onOpen:function d(){var w=this.contents.leftPanel,v,x,y;this.loading=true;var u=(i.find(mstrApp.rootController.getDBObjects().catalogDbTypes,"v",this.dbRole.mdDBRole.db_type)>=0);w.catalogModeRBBox.catalogModeRB0.set("enabled",u);if((this.options.catalogMode.value===h)&&u){v=0;}else{v=1;}w.catalogModeRBBox["catalogModeRB"+v].set("checked",true);w.catalogModeRBBox["catalogModeRB"+v].onclick();w.nsModeRBBox.nsModeRB1.set("enabled",this.supportsNameSpaces);if(this.supportsNameSpaces){if(this.options.nsMode.value===m){v=0;}else{v=1;}}else{v=0;}w.nsModeRBBox["nsModeRB"+v].set("checked",true);w.nsModeRBBox["nsModeRB"+v].onclick();if(this.options.cacheMode.value===m){v=0;}else{if(this.options.cacheMode.value===g){v=1;}else{if(this.options.cacheMode.value===t){v=2;}}}w.cacheModeRBBox["cacheModeRB"+v].set("checked",true);w.cacheModeRBBox["cacheModeRB"+v].onclick();this.selectedNS=undefined;this.loading=false;K.call(this);x=this.domNode.children[0];y=parseInt(x.style.top,10);if(y<0){x.style.top="0px";}if(q){this.browserResized(q);U.center(x);}},children:[{scriptClass:"mstrmojo.HBox",alias:"contents",cssClass:"catsql-hbox",children:[{scriptClass:"mstrmojo.Box",cssClass:T+"-leftPanel",alias:"leftPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:b},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:2,prefix:"catalogModeRB",alias:"catalogModeRBBox",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:P,index:0,alias:"catalogModeRB0",onclick:function n(){Q.call(this);},oncheckedChange:function a(){}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:W,index:1,alias:"catalogModeRB1",onclick:function n(){Q.call(this);},oncheckedChange:function a(){var u=this.parent.parent.parent.parent;u.options.catalogMode.value=(this.checked?k:h);K.call(u);}}]},{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:M},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:2,alias:"nsModeRBBox",prefix:"nsModeRB",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:F,index:0,alias:"nsModeRB0",onclick:function n(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var u=this.parent.parent.parent.parent;u.options.nsMode.value=f;K.call(u);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:A,index:1,alias:"nsModeRB1",onclick:function n(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var u=this.parent.parent.parent.parent;u.options.nsMode.value=l;K.call(u);}}]},{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:V},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:3,alias:"cacheModeRBBox",prefix:"cacheModeRB",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:L,index:0,alias:"cacheModeRB0",onclick:function n(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var u=this.parent.parent.parent.parent;u.options.cacheMode.value=m;K.call(u);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:H,index:1,alias:"cacheModeRB1",onclick:function n(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var u=this.parent.parent.parent.parent;u.options.cacheMode.value=g;K.call(u);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:p,index:2,alias:"cacheModeRB2",onclick:function n(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var u=this.parent.parent.parent.parent;u.options.cacheMode.value=t;K.call(u);}}]}]},{scriptClass:"mstrmojo.Box",cssClass:T+"-rightPanel",alias:"rightPanel",children:[]}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+T+"-closeBtn",text:E,onclick:function n(){var u=this.parent.parent;i.forEach(u.contents.rightPanel.sqlPreviewBox.dbTableTree.items,function(v){delete v.items;});u.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.SearchablePulldown","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.NameSpacePullDown","mstrmojo.warehouse.ui.SearchBox");mstrmojo.requiresDescs(12260,9142,12259);var I=mstrmojo.array,J=mstrmojo.css,E="mstrmojo-wh-",G=mstrmojo.dom,A=mstrmojo.desc(12260,"%% Tables, Last cache update: $$"),K=mstrmojo.desc(9142,"Available Tables"),F=mstrmojo.desc(12259,"Catalog SQL"),P=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.ui.AvailableTablesPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",cssClass:"AvailableTables",title:K,dbTableTree:undefined,searchBox:undefined,nameSpaces:undefined,catalogSQLBtn:undefined,refreshBtn:undefined,catSQL:undefined,useRichTooltip:true,showTooltip:function L(Q,S){var R=Q.target||G.eventTarget(Q.hWin,Q.e);if(R===this.titleNode||R===this.titleTextNode){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.titleNode,top:32,content:this.titleTooltip};this._super(Q,S);}},init:function M(T){this._super(T);var W=this.searchBox,S=this.dbTableTree;W.attachEventListener("searchTriggered",this.id,function(X){S.userSelections={};mstrApp.getRootController().availableTableSearch(X.searchValue);});this.addNewTitleButton({alias:"catalogSQLBtn",title:F,cssClass:E+"catalogSQL hidden",onclick:function Q(){mstrApp.getRootController().displayCatalogSQL();}});var V=this,U={},R=U[this.id]={};R[P.DBTABLES_CHANGED]=function(X){V.set("titleTooltip",A.replace("%%",X.items.length.toString()).replace("$$",X.src.catalogStamp||""));};R[P.DBROLE_SELECTION]=function(Y){var Z=this,X=Y.src.dbrs[I.find(Y.src.dbrs,"did",Y.value)];W.tableBox.refreshBtn.set("visible",false);if(X){X.populate(function a(b){W.clearSearch(true);J.toggleClass(Z.catalogSQLBtn.domNode,"hidden",!(mstrApp.getRootController().canDisplayCatalogSQL(Y.src.dbObjects.dbTypes,b.mdDBRole.db_type)));W.tableBox.refreshBtn.set("visible",W._preSearch?W._preSearch():false);});}else{if(!Y.value){W.clearSearch(true);J.toggleClass(Z.catalogSQLBtn.domNode,"hidden",true);}}};mstrApp.getRootController().attachDataChangeListeners(U);},onheightChange:function B(Q){if(!this.nameSpaces.heightOffset){this.nameSpaces.heightOffset=21;}if(!this.heightOffset){this.heightOffset=85;}this.dbTableTree.set("height",parseInt(Q.value,10)-this.heightOffset-(this.nameSpaces.visible?this.nameSpaces.heightOffset:0)+"px");},onwidthChange:function D(Q){if(!this.searchBox.widthOffset){this.searchBox.widthOffset=0;}var R=parseInt(Q.value,10);this.searchBox.set("width",R-6-this.searchBox.widthOffset+"px");this.nameSpaces.set("width",R-12+"px");},children:[{alias:"nameSpaces",scriptClass:"mstrmojo.warehouse.ui.NameSpacePullDown",sourceInfo:"tablesPanel",nameSpacesLoaded:function C(){this.parent.searchBox.clearSearch(true);this.parent.onheightChange({value:this.parent.height});},onItemSelectedCallback:function O(Q){var R=this.parent.searchBox;R.clearSearch(true);mstrApp.getRootController().setNameSpaceID(Q.n);R.tableBox.refreshBtn.set("visible",R._preSearch?R._preSearch():false);}},{scriptClass:"mstrmojo.warehouse.ui.SearchBox",alias:"searchBox",_preSearch:function N(){if(this.parent.nameSpaces.visible){return(this.parent.nameSpaces.selectedIndex!==undefined);}return true;},_onRefresh:function H(){this.clearSearch(true);mstrApp.getRootController().handleDBTableRefresh();}},{alias:"dbTableTree",scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",sourceInfo:"tablesPanel",renderOnScroll:true}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.architect.ui.AttributeLabel","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.architect.EnumDataChangeEvents");var b=mstrmojo.array,G=mstrmojo.dom,V=mstrmojo.hash,U=100,H=mstrmojo.architect.ui.AttributeLabel,a=H.ENUM_DROP_ZONE.PARENT,Y=H.ENUM_DROP_ZONE.CHILD,R=mstrmojo.architect.EnumDragActions,T=mstrmojo.architect.EnumDataChangeEvents,L=mstrmojo.warehouse.EnumObjectTypes,S=L.ATTRIBUTE,I="px";function C(d,j,k,l){if(j===k){return true;}var e=d[j],h,f;if(l===1){var g=e.cids;for(h=0,f=g.length;h<f;h++){if(C(d,g[h],k,l)){return true;}}}if(l===2){var m=e.pids;for(h=0,f=m.length;h<f;h++){if(C(d,m[h],k,l)){return true;}}}return false;}function A(h,l){var d=this.attributes,m=h.pids,g=h.cids,f=[],k=[],j,e;if(l!==1){for(j=0,e=m.length;j<e;j++){if(C(d,m[j],h.caid,2)){f.push(m[j]);}}}if(l!==2){for(j=0,e=g.length;j<e;j++){if(C(d,g[j],h.paid,1)){k.push(m[j]);}}}return{pids:f,cids:k};}function D(f,e,k){var j=f.attributeId,d=this.attributes,m=this.children,g=this.parent.linker,h,i=f.properties;if(!i){i={lockLimit:0,lockType:1,filters:[]};}if(d[j]){h=m[b.find(m,"attributeId",j)];h.set("top",k+I);h.set("left",e+I);var l=h.domNode;g.drawLinks({MAX_DIMS:{x:e+l.clientWidth,y:k+l.clientHeight}});}else{h=new mstrmojo.architect.ui.AttributeLabel({left:e+I,top:k+I,linker:g,tableId:f.tableId,name:f.n||f.name,attributeId:j,isChecked:f.isChecked,isVisible:f.isVisible,isEnabled:f.isEnabled,entryPoint:f.entryPoint,locked:(i.lockType!==1),size:i.lockLimit,filtered:(i.filters.length>0)});h.attachEventListener("attrRearranged",this.id,function(n){this.handleDragDrop(n.context);});h.updateIcons();this.addChildren([h]);d[j]=f;}}function J(f,i,d,l,g){l=(l===undefined)?f.y:l;var e=i[l]=i[l]||[],h=f.attributeId,k=f.x,j=f.y;if(e[d]&&e[d]!==h){if(g){e.splice(d,0,h);}else{while(e[d]!==undefined){d++;}}}if(k!==undefined&&j!==undefined){i[j][k]=undefined;}i[l][d]=h;f.x=d;f.y=l;}function B(f,h,g){var e=this.children;if(e){var d=e[b.find(e,"attributeId",f)];if(d){d.set("top",h);d.set("left",g);}}}function Q(d,g){var h,f;h=d.rootIds;f=d.attributes;var j,e,i,k;j=function j(p,r){var q=f[p];var l=q.revChildren;if(q.visited===undefined){q.visited=1;}else{return ;}q.revSubtreeCnt=1;b.forEach(l,function(t){j(t,r+1);q.revSubtreeCnt+=f[t].revSubtreeCnt;});f[p].offsetHeadArr=[0];f[p].offsetTailArr=[0];l.sort(function(u,t){return f[t].revSubtreeCnt-f[u].revSubtreeCnt;});var o,m,n;for(o=1,m=l.length-1;o<m;o+=2,m-=2){n=l[o];l[o]=l[m];l[m]=n;}b.forEach(l,function(u){var v=0;var t;for(t=0;t<f[u].offsetHeadArr.length;t++){if(v+f[u].offsetHeadArr[t]<=f[p].offsetTailArr[t+1]){v+=f[p].offsetTailArr[t+1]+1-(v+f[u].offsetHeadArr[t]);}}f[u].offsetToFather=v;for(t=0;t<f[u].offsetHeadArr.length;t++){if(f[p].offsetHeadArr[t+1]===undefined){f[p].offsetHeadArr[t+1]=v+f[u].offsetHeadArr[t];}else{f[p].offsetHeadArr[t+1]=Math.min(f[p].offsetHeadArr[t+1],v+f[u].offsetHeadArr[t]);}if(f[p].offsetTailArr[t+1]===undefined){f[p].offsetTailArr[t+1]=v+f[u].offsetTailArr[t];}else{f[p].offsetTailArr[t+1]=Math.max(f[p].offsetTailArr[t+1],v+f[u].offsetTailArr[t]);}}});};e=function e(q,m){var r=f[q],l=r.children,o=l.length,n=o===0;if(r.revVisited===undefined){r.revVisited=1;}else{return ;}if(n){f[m].revChildren.push(q);}var p=function(t){if(typeof Array.prototype.indexOf==="function"){p=Array.prototype.indexOf;}else{p=function(w){var v=-1,u=-1;for(v=0;v<this.length;v++){if(this[v]===w){u=v;break;}}return u;};}return p.call(this,t);};r.revChildren=[];b.forEach(l,function(u){e(u,m);var t=p.call(f[u].revChildren,q);if(t===-1){f[u].revChildren.push(q);}});};k=function k(m,q,o,p){var n=f[m],l=n.revChildren;if(p===0){J(n,g,q,o);}b.forEach(l,function(r){k(r,q+f[r].offsetToFather,o-1,0);});};i=function i(){var l=0;f[l]={children:[],revChildren:[]};b.forEach(h,function(n){e(n,l);});j(l,0);var m=f[l].offsetHeadArr.length;k(l,0,m,1);delete f[l];};i();}function F(p){var h=p.attributes,j=this.positions=p.positions||{},d=p.rootIds,t=[],g=[],i=130,m=0,l=0,o=[],f=function f(AF,z){var AA=h[AF],AD=AA.children,AB=AD.length,w=AB===0,AE=h[AD[0]],x;b.forEach(AD,function(AH){f(AH,z+1);});var y=g[z]=g[z]||0,AG=t[z]=t[z]||0,v,u;if(w){x=AG;v=x;}else{if(AB===1){x=AE.x-1;}else{var AC=0;b.forEach(AD,function(AH){AC+=h[AH].x;});x=Math.floor(AC/AB);}}y=g[z]=Math.max(y,AG-x);if(!w){v=x+y;}u=z;J(AA,o,v,u);t[z]+=1;},n=function n(w){var x=h[w],u=x.children,v=u.length;if(v>0){b.forEach(u,function(z){var y=h[z];J(y,o,x.x);});}b.forEach(u,function(y){n(y);});},e=function e(x){var y=h[x],u=y.children,w=y.parent.length;if(w>0){var v=0;b.forEach(y.parent,function(z){v+=h[z].x;});J(y,o,Math.floor(v/w));}b.forEach(u,function(z){e(z);});};var r=1;if(r){Q(p,o);}else{b.forEach(d,function(u){f(u,0);});b.forEach(d,function(u){n(u);});b.forEach(d,function(u){e(u);});}var q=[];b.forEach(o[0],function(w,u){if(!w){var x=true,v;for(v=0;v<o.length;v++){x=x&&!o[v][u];}if(x){q.push(u);}}});b.forEach(q.reverse(),function(u){var v;for(v=0;v<o.length;v++){o[v].splice(u,1);}});b.forEach(o,function k(u,w){b.forEach(u,function v(z,y){if(z){var AB=(U*w)+I,AA=(i*y)+I;B.call(this,z,AB,AA);j[z]={x:AA,y:AB};}m=Math.max(y+1,m);},this);l=Math.max(w+1,l);},this);return{x:m*i,y:l*U};}function P(m){var f=this.positions=m.positions||{},l=this.recentDrop,d=this.children||[],k=(V.keyarray(f).length>0),i={},e=(l?d[b.find(d,"attributeId",l.data.attributeId)]:undefined),g=((d[0]&&d[0].domNode)?G.position(d[0].domNode).h:0),j=((d[0]&&d[0].domNode)?G.position(d[0].domNode).w:0);if(k){V.forEach(f,function(h,n){if(h&&h.x&&h.y){B.call(this,n,h.y,h.x);i.x=Math.max(i.x||0,parseInt(h.x,10)+j);i.y=Math.max(i.y||0,parseInt(h.y,10)+g);}},this);if(e&&e.top==="0px"&&e.left==="0px"){B.call(this,l.data.attributeId,l.pos.y,l.pos.x);i.x=Math.max(i.x||0,parseInt(l.pos.x,10)+j);i.y=Math.max(i.y||0,parseInt(l.pos.y,10)+g);}}else{i=F.call(this,m);}m.MAX_DIMS=i;}function E(e){if(e.tp===S){var d=b.find(this.children,"attributeId",e.did);if(d>-1){return this.children[d];}}return undefined;}function O(d){var e=E.call(this,d);if(e){e.set("name",d.value);}}function K(d){var e=E.call(this,d);if(e){this.removeChildren(e,true);e.destroy();this.parent.linker.drawLinks();}}mstrmojo.architect.ui.AttributesContainer=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.AttributesContainer",markupString:'<div id="{@id}" class="mstrmojo-ar-rp-AttributesContainer {@cssClass}" style="{@cssText}"> </div>',positions:undefined,init:function W(d){this._super(d);this.attributes={};var e={},f=e[this.id]={};f[T.RENAME]=O;f[T.REMOVE]=K;mstrApp.getRootController().attachDataChangeListeners(e);},refreshLabels:function M(n){var k=this,h=this.children,l=this.attributes||{},g=n.attributes,f=n.isChecked,i=n.isVisible,m=n.isEnabled,d=n.entryPoints||[],j=n.attributeProperties||[];V.forEach(g,function e(p,o){if(l[o]===undefined){D.call(k,{attributeId:o,tableId:p.tableId,n:p.n,isChecked:f,isVisible:i,isEnabled:m,entryPoint:(b.find(d,"atid",o)!==-1)?true:false,properties:j[o]},0,0);}});b.forEach(n.affectedAttributes,function(p){if(g[p]===undefined){var o=b.find(h,"attributeId",p);if(o!==-1){k.removeChildren(h[o]);delete l[p];}}});P.call(this,n);},handleDragDrop:function c(d){var o=this,j=mstrApp.getRootController(),g=d.src;if(g&&g.data){var k=d.action,i=g.data,l=i.caid,p=i.paid,n=i.n,m=i.attributeId,r=i.isDragWithin,h=G.position(this.domNode),e=d.tgt.e,f={success:function q(){if(!r&&b.find(this.children,"id",i.id)!==-1){return ;}if(l||p){var t=i.type||3,v=o.attributes[m],u=function u(){var y=t===Y,z=t===a;if(r){if(y||z){j.addRelation(y?p:m,y?m:l,i.tableId);}}};if(!v||!v.pids){u();}else{i.pids=v.pids;i.cids=v.cids;var x=A.call(o,i,t),w=x.pids;if(w.length===0){u();}else{j.removeRelation(w,x.cids);}}}else{if(m&&(k===R.TABLE_VIEW_ATTR||k===R.LINKER_ATTR)){i.entryPoint=true;D.call(o,i,e.clientX-h.x,e.clientY-h.y);o.updateAttributePositions(m,{x:e.clientX-h.x+"px",y:e.clientY-h.y+"px"});j.updateRelationPositions(o.getAttributePositions(),j.getCurrentHierarchyID());}}}};j.addAttributeToHierarchy(m,n,f);}},updateAttributePositions:function X(d,e){this.positions[d]=e;},getAttributePositions:function Z(){return this.positions;},cleanUp:function N(){this.attributes={};this.removeChildren();}});}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.DBConnectionsList");mstrmojo.requiresDescs(4381,11131,12933);var B=57;mstrmojo.warehouse.DBRoleSelector=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.DBRoleSelector",cssClass:"DBConnections",title:mstrmojo.desc(4381,"data sources"),newDBBtn:undefined,dbConnections:undefined,init:function C(D){this._super(D);this.addNewTitleButton({alias:"newDBBtn",cssClass:"mstrmojo-wh-addDB",title:mstrmojo.desc(11131,"New data source"),onclick:function E(){if(mstrApp.rootController.hasPrivilege(B)){mstrApp.getRootController().editDBRole();}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}});},onheightChange:function A(D){if(!this.heightOffset){this.heightOffset=30;}this.dbConnections.set("height",parseInt(D.value,10)-this.heightOffset+"px");},children:[{scriptClass:"mstrmojo.warehouse.ui.DBConnectionsList",alias:"dbConnections"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.TransformInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-transform",items:[],noEditButton:true,folderLinksContextId:26,browsableTypes:[B.TP.FOLDER,B.TP.ROLE].join(","),getCandidatesThroughTaskCall:function A(E,D){mstrmojo.ME.MetricDataService.getTransformations(E,D);},hideItemWidgetBrowseButton:function C(){return this.isDME;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ME.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME.Enum");mstrmojo.requiresDescs(1107,12178);var J=mstrmojo.expr,D=mstrmojo.ME.Enum.DYNAMIC_DIMTY;mstrmojo.ME.LevelInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-level",oncandidatesChange:function F(E){this.candidates.items=D.getItems("level").concat(this.candidates.items);},hidePulldownButton:function(){return !this.isDME;},hideItemWidgetBrowseButton:function(){return this.isDME;},folderLinksContextId:16,browsableTypes:[J.TP.FOLDER,J.TP.ATTR,J.TP.DIM].join(","),getCandidatesThroughTaskCall:function K(L,E){L.rootFolderType=39;L.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(L,E);},itemFunction:function B(M,E,L){M.filtering=M.filtering||1;M.grouping=M.grouping||1;var N=this._super(M,E,L,mstrmojo.ME.LevelObjectItem);N.optionButtonVisible=true;return N;},updateSuggestion:function C(E){E=[{n:this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level"),did:-1,t:-1,state:0}].concat(E);if(this._super){this._super(E);}},add:function H(L,E){var N=true,M=this.items;mstrmojo.array.forEach(L,function(O){mstrmojo.array.forEach(M,function(P){if(P.did&&P.did===O.did){N=false;return false;}});});if(N){this._super(L,E);}}});mstrmojo.ME.LevelObjectItem=mstrmojo.declare(mstrmojo.ME.ObjectItem,[mstrmojo._HasPopup],{optsRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9598,"Level Options"),cssText:"width: 450px;",onOpen:function A(){var E=this.opener.data;this.filterOption.set("value",E.filtering);this.groupOption.set("value",E.grouping);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9599,"Relationship with Report Filter:")},{scriptClass:"mstrmojo.Pulldown",alias:"filterOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9600,"Standard - Metric calculates only for elements found in the filter"),did:1},{n:mstrmojo.desc(9601,"Absolute - Raises the calculation to the selected level, if possible"),did:2},{n:mstrmojo.desc(9602,"Ignore - Omit filtering criteria based on selected level and its related attributes"),did:3},{n:mstrmojo.desc(9603,"None - Unspecified - the selected level and group components define the filter"),did:4}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9604,"Metric Aggregations:")},{scriptClass:"mstrmojo.Pulldown",alias:"groupOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9605,"Standard - Metric calculates at the selected level, if possible"),did:1},{n:mstrmojo.desc(9606,"None - Exclude the selected level and children from the GROUP BY clause in the SQL"),did:2},{n:mstrmojo.desc(9607,"Beginning lookup - Use the first value of the lookup table"),did:3},{n:mstrmojo.desc(9608,"Ending lookup - Use the last value of the lookup table"),did:4},{n:mstrmojo.desc(9609,"Beginning fact - Use the first value of the fact table"),did:5},{n:mstrmojo.desc(9610,"Ending fact - Use the last value of the fact table"),did:6}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,L=E.opener;if(L.saveOnClose){L.saveOnClose(E.filterOption.value,E.groupOption.value);}E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},saveOnClose:function G(E,M){var L=this.data;L.filtering=E;L.grouping=M;if(this.parent.onSaveOnClose){this.parent.onSaveOnClose();}},options:function I(){this.openPopup("optsRef",{title:'"'+this.data[this.itemField]+'" '+mstrmojo.desc(9598,"Level Options"),zIndex:40});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.ConditionInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-condition",folderLinksContextId:10,browsableTypes:[B.TP.FOLDER,B.TP.FILTER,B.STP.PROMPT_OBJECTS].join(","),noEditButton:true,maxObjectCount:1,getCandidatesThroughTaskCall:function A(D,C){D.rootFolderType=39;D.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getFilters(D,C);},hideItemWidgetBrowseButton:function(){return this.isDME;}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Table","mstrmojo.CheckBox","mstrmojo.ME.LevelInputBox","mstrmojo.ME.ConditionInputBox","mstrmojo.ME.TransformInputBox","mstrmojo.ME.MetricDataService","mstrmojo.Button","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.mstr.EnumFunction");mstrmojo.requiresDescs(1107,1281,2148,2397,2399,3324,3377,4788,6223,9577,9579,9581,9582,9583,9584,11564,11565,12178,12179,12853);var Q=mstrmojo.expr,G=mstrmojo.array,B=mstrmojo.mstr.EnumFunction,R=mstrmojo.ME._MetricEditorHelper,A=mstrmojo.ME.MetricToken.brackets;var N,M;var C=function(){var E=this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level");return mstrmojo.hash.copy({n:E,did:-1,t:-1,state:0});};var X={level:-4,condition:-5,transformation:-6,simple:-7},O=function(E){return !(E===-4||E===-5||E===-6);},L=function(Y,E){return O(Y)||parseInt(Y,10)===X[E];},U=function(E){return E===-4||E===-5||E===-6||E===-7;};var W={n:"",did:"-1",desc:""},D={1:"+",2:"*",3:"%",4:""},F={1:"",2:"!",3:"<",4:">",5:"<|",6:">|"},H=function(a,Z){var c,E,b;switch(Z){case"level":c=[Q.TP.ATTR,Q.TP.DIM];E="onLevelAdded";b=16;break;case"transform":c=[Q.TP.ROLE];E="onTransformAdded";b=26;break;case"condition":c=[Q.TP.FILTER,Q.STP.PROMPT_OBJECTS];E="onConditionAdded";b=10;break;case"expression":c=[Q.TP.FACT,Q.TP.ATTR,Q.TP.FUNCTION,Q.TP.METRIC];E="onExpressionAdded";b=25;break;default:}c[c.length]=Q.TP.FOLDER;a.openPopup("ob",{zIndex:a.zIndex+10});var Y=a.ob.browser;Y.browse({folderLinksContextId:b,onSelectCB:[a,E],browsableTypes:c.join(","),includeObjectDesc:true});};mstrmojo.ME._HasLevel=mstrmojo.provide("mstrmojo.ME._HasLevel",{_mixinName:"mstrmojo.ME._HasLevel",isAggFunction:false,init:function V(E){if(this._super){this._super(E);}N=this.id;M=this;},onOpen:function K(){if(this._super){this._super();}if(!this.isAggFunction){return ;}M=this;var Y=this.getLCTDefFromTokens();this.updateToggleBarStatus(Y);var E=this.metricLCT.levelInput;E.set("candidates",this.getCandidates4LCT([Q.TP.ATTR,Q.STP.NDE]));E.set("items",Y.level);var Z=this.metricLCT.conditionInput;if(!this.noCache&&!Z.candidates&&!this.isDME){mstrmojo.ME.MetricDataService.getFilters({pattern:"*",blockBegin:1,blockCount:-1},{success:function(b){if(b){Z.set("candidates",{items:b.items,isComplete:(b.bc===-1||(b.bb+b.bc>b.sz))});}},failure:function(b){mstrmojo.alert(b.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{Z.candidates=this.getCandidates4LCT([Q.TP.FILTER,Q.STP.PROMPT_OBJECTS]);this.metricLCT.lblCondition.set("visible",Y.filter.length>0);}Z.set("items",Y.filter);var a=this.metricLCT.transformInput;if(!this.noCache&&!a.candidates&&!this.isDME){mstrmojo.ME.MetricDataService.getTransformations({pattern:"*",blockBegin:1,blockCount:-1},{success:function(b){if(b){a.set("candidates",{items:b.items,isComplete:(b.bc===-1||(b.bb+b.bc>b.sz))});}},failure:function(b){mstrmojo.alert(b.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{a.candidates=this.getCandidates4LCT(Q.TP.ROLE);this.metricLCT.lblTransform.set("visible",Y.tranformation.length>0);}a.set("items",Y.tranformation);},getLCTDefAsTokens:function P(){if(!this.isAggFunction){return[];}var h=this.metricLCT.levelInput.getSelectedObjects(),b=this.metricLCT.conditionInput.getSelectedObjects(),Z=this.metricLCT.transformInput.getSelectedObjects(),e=[],Y,a,c,E=function(j,i){return j.filtering===1?"("+i+")":i;};e.push({v:"{",isDelimiter:true});var f=null;for(a=0,c=h.length;a<c;a++){f=h[a];e.push({v:F[f.grouping],isDelimiter:true});if(R.isDimty(f.n)){e.push({v:E(f,f.n)});}else{if(/^@/.test(f.did)){e.push({v:E(f,f.did)});}else{if(f.did===-1){e.push({v:"~",isDelimiter:true});}else{e.push({v:A(f.n),oi:f});}}}e.push({v:D[f.filtering],isDelimiter:true});if(a<(c-1)){e.push({v:", ",isDelimiter:true});}}if(!this.levelFilterRest){e.push({v:";",isDelimiter:true});e.push({v:"-",isDelimiter:true});}if(!this.levelCanContinue){e.push({v:";",isDelimiter:true});e.push({v:"/",isDelimiter:true});}e.push({v:"}",isDelimiter:true});if(b.length>0){e.push({v:"<",isDelimiter:true});Y={v:A(b[0].n)};if(b[0].did){Y.oi=b[0];}e.push(Y);e.push({v:";",isDelimiter:true});e.push({v:"@",isDelimiter:true});e.push({v:this.conditionEmbedMethod});e.push({v:";",isDelimiter:true});e.push({v:this.conditionIgnoreFilterElem?"-":"+",isDelimiter:true});e.push({v:">",isDelimiter:true});}var g=G.indexOf(Z,W);c=g<0?Z.length:g;if(c>0){e.push({v:"|",isDelimiter:true});var d=null;for(a=0;a<c;a++){d=Z[a];Y={v:A(d.n)};if(d.did){Y.oi=d;}e.push(Y);if(a<(c-1)){e.push({v:", ",isDelimiter:true});}}e.push({v:"|",isDelimiter:true});}for(a=0,c=e.length;a<c;a++){e[a].isNew=true;}return e;},getLCTDefFromTokens:function S(){var Y=[],a=false,f=[],d=[],h=this.oi.tks.items,g=h.length,e;if(this.insertMode||g===0){Y.push(C.call(this));}else{for(e=0;e<g;e++){var b=h[e],j=b.tp,Z=b.sctt;switch(Z){case 262144:a=true;switch(j){case 64:case 126:case 264:case 265:case 310:var c=e,k;if(j===64){var E=b.v+h[++e].v;b=h[e+1];if(b.tp===43||b.tp===45){E+=h[++e].v;E+=h[++e].v;}else{if(b.tp===41){e++;}}k=mstrmojo.ME.Enum.DYNAMIC_DIMTY.getDimtyObject(E,this.isDME);}else{k=j===126?C.call(this):b.oi;}k.grouping=1;k.filtering=4;switch(h[c-1].tp){case 33:k.grouping=2;break;case 60:k.grouping=3;break;case 62:k.grouping=4;break;case 297:k.grouping=5;break;case 298:k.grouping=6;break;}switch(h[e+1].tp){case 37:k.filtering=3;break;case 42:k.filtering=2;break;case 43:k.filtering=1;break;}Y.push(k);break;case 45:this.levelFilterRest=false;break;case 47:this.levelCanContinue=false;break;}break;case 327680:switch(j){case 270:case 273:f.push(b.oi);break;case 262:this.conditionEmbedMethod=b.v;break;case 43:this.conditionIgnoreFilterElem=false;break;case 45:this.conditionIgnoreFilterElem=true;break;}break;case 393216:switch(j){case 271:d.push(b.oi);break;}break;}}if(Y.length===0&&!a){Y.push(C.call(this));}}return{level:Y,filter:f,tranformation:d};},levelCanContinue:true,levelFilterRest:true,conditionEmbedMethod:2,conditionIgnoreFilterElem:true,_set_candidates:function(b,Y){this.candidates=Y;if(this.hasRendered){var E=this.metricLCT.levelInput,Z=this.metricLCT.conditionInput,a=this.metricLCT.transformInput;E.candidates=this.getCandidates4LCT([Q.TP.ATTR,Q.STP.NDE]);Z.candidates=this.getCandidates4LCT([Q.TP.FILTER]);a.candidates=this.getCandidates4LCT([Q.TP.ROLE]);}return true;},getCandidates4LCT:function J(a,E){var Z=this.candidates,Y;if(Z){a=G.ensureArray(a);Y=G.filter(Z.items,function(b){return G.indexOf(a,b.t)>-1||G.indexOf(a,b.st)>-1;});if(G.indexOf(a,12)>-1&&E){if(this.replaceAttributeWithForms){Y=this.replaceAttributeWithForms(Y);}}return{items:Y,isComplete:Z.isComplete};}return null;},updateToggleBarStatus:function I(E){var Y=false;if(E.level){Y=E.level.length>1||E.level.length==1&&E.level[0].did!==-1;}if(E.filter){Y=Y||E.filter.length>0;}if(E.transformation){Y=Y||E.transformation.length>0;}if(U(this.did)){Y=true;}this.metricLCT.toggle.set("selected",Y);},levelAdvRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9577,"Level Advanced Options"),help:"Level_Advanced_Options_dialog_box.htm",cssClass:"mstrmojo-ME-level-options",onOpen:function(){var E=this.opener;this.contentTable.ccCheckBox.set("checked",E.levelCanContinue);this.contentTable.frCheckBox.set("checked",E.levelFilterRest);},children:[{scriptClass:"mstrmojo.Table",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.CheckBox",alias:"ccCheckBox",slot:"0,0",label:mstrmojo.desc(9583,"Allow other users to add extra units to this definition")},{scriptClass:"mstrmojo.CheckBox",alias:"frCheckBox",slot:"1,0",label:mstrmojo.desc(9584,"Include filter attributes which are not in report or level in metric calculation")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveLevelOptions(E.contentTable.ccCheckBox.checked,E.contentTable.frCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},conditionAdvRef:{scriptClass:"mstrmojo.Editor",title:"Condition Advanced Options",help:"Condition_Advanced_Options_dialog_box.htm",cssText:"width: 286px;",onOpen:function(){var E=this.opener;this.contentTable.emPulldown.set("value",E.conditionEmbedMethod);this.contentTable.irfeCheckBox.set("checked",E.conditionIgnoreFilterElem);},children:[{scriptClass:"mstrmojo.Table",cssText:"margin-top:5px;",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.Label",slot:"0,0",text:mstrmojo.desc(9585,"Interaction between metric filter and report filter: ")},{scriptClass:"mstrmojo.Pulldown",alias:"emPulldown",itemField:"n",itemIdField:"did",slot:"1,0",value:2,items:[{n:mstrmojo.desc(9586,"Merge into new"),did:1},{n:mstrmojo.desc(9587,"Merge report filter into metric"),did:2},{n:mstrmojo.desc(9588,"Merge metric condition into report"),did:3}]},{scriptClass:"mstrmojo.CheckBox",alias:"irfeCheckBox",slot:"2,0",label:mstrmojo.desc(9589,"Ignore related report filter elements")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveConditionOptions(E.contentTable.emPulldown.value,E.contentTable.irfeCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},getLCTComponent:function T(){return{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-ME-LCT",alias:"metricLCT",layout:[{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{cssText:"width:252px;padding-right:6px;"}]}],bindings:{visible:function(){return this.parent.isAggFunction;}},labelWidth:"auto",children:[{scriptClass:"mstrmojo.Button",cssClass:"toggle",alias:"toggle",text:mstrmojo.desc(6223,"Show All"),selected:false,bindings:{visible:function(){return !this.parent.parent.isDME;}},onclick:function(E){var Y=!this.selected;this.set("selected",Y);},slot:"0,0"},{scriptClass:"mstrmojo.Label",alias:"lblLevel",text:mstrmojo.desc(4788,"Level"),bindings:{visible:function(){return this.parent.parent.isDME||!this.parent.parent.isDME&&this.parent.toggle.selected;},width:"this.parent.labelWidth"},onwidthChange:function(){if(this.hasRendered){this.domNode.style.width=this.width;}},slot:"1,0"},{scriptClass:"mstrmojo.ME.LevelInputBox",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),alias:"levelInput",dtp:-4,xacptSugItemOnly:true,bindings:{noCache:function(){return this.parent.parent.noCache;},isDME:function(){return this.parent.parent.isDME;},visible:function(){return this.parent.lblLevel.visible;}},reportLevelAdded:true,onadd:function(E){var Y=this.getSelectedObjects();this.set("reportLevelAdded",G.find(Y,"did",-1)>-1);},onremove:function(E){var Y=this.getSelectedObjects();this.set("reportLevelAdded",G.find(Y,"did",-1)>-1);},onitemchange:function(){this.parent.parent.onmetricModify();if(M.updateScrollbars){M.updateScrollbars();}},onSaveOnClose:function(){this.parent.parent.onmetricModify();},slot:"1,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold",text:mstrmojo.desc(9577,"Level Advanced Options"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},onclick:function(){var E=this.parent.parent;E.openPopup("levelAdvRef",{saveLevelOptions:function(Z,Y){E.levelCanContinue=Z;E.levelFilterRest=Y;},zIndex:E.zIndex+10});},slot:"1,1"},{scriptClass:"mstrmojo.Label",alias:"lblCondition",text:mstrmojo.desc(9579,"Condition"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"2,0"},{scriptClass:"mstrmojo.ME.ConditionInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-condition singleObject",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(1281,"Filter").toLowerCase()),alias:"conditionInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblCondition.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();},slot:"2,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold condition",text:mstrmojo.desc(9581,"Condition Advanced Options"),bindings:{visible:function(){return this.parent.lblCondition.visible&&!this.parent.parent.isDME;}},onclick:function(){var E=this.parent.parent;E.openPopup("conditionAdvRef",{saveConditionOptions:function(Z,Y){E.conditionEmbedMethod=Z;E.conditionIgnoreFilterElem=Y;},zIndex:E.zIndex+10});},slot:"2,1"},{scriptClass:"mstrmojo.Label",alias:"lblTransform",text:mstrmojo.desc(3324,"Transformation"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"3,0"},{scriptClass:"mstrmojo.ME.TransformInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-transform",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),alias:"transformInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblTransform.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();if(M.updateScrollbars){M.updateScrollbars();}},slot:"3,1"}]};}});mstrmojo.ME._HasLevel.EnumEditorComponents=X;}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.DBRoleSelector","mstrmojo.ui.Splitter","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.ui.AvailableTablesPanel");var A=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.WHPanel=mstrmojo.declare(mstrmojo.ui.Splitter,null,{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"WHPanel",orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,config:{firstSplit:{v:"300px",min:"100px"},secondSplit:{v:"100%",min:"100px"},resizeHandle:{v:"2px"}},getLayoutOffsets:function C(){return{h:0,w:0};},init:function B(E){this._super(E);var F={},D=F[this.id]={};D[A.DBROLE_SELECTION]=this.onDBRoleSelection;mstrApp.getRootController().attachDataChangeListeners(F);},onDBRoleSelection:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.warehouse.DBRoleSelector",slot:"firstSplitNode",alias:"topPanel"},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",slot:"secondSplitNode",alias:"bottomPanel"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.architect.ui.RelationLinker","mstrmojo.architect.ui.AttributesContainer","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo._HasLayout","mstrmojo.array","mstrmojo.hash");var H=mstrmojo.array,C=mstrmojo.hash,E=mstrmojo.architect.EnumDragActions;mstrmojo.architect.ui.RelationPanelContent=mstrmojo.declare(mstrmojo.Box,[mstrmojo.warehouse._CanToggleAvatarClass,mstrmojo._HasLayout],{scriptClass:"mstrmojo.architect.ui.RelationPanelContent",markupString:'<div id="{@id}" class="mstrmojo-ar-rp-content {@cssClass}" mstrAttach:click><div class="mstrmojo-ar-rpc-rel"></div></div>',markupSlots:{relationsNode:function D(){return this.domNode.firstChild;}},elemBox:undefined,init:function J(L){this._super(L);this.attributes={};},onclick:function K(L){this.linker.handleClick(L.e);},dropZone:true,allowDrop:function F(M){var L=M.action;return(M.createRelations&&(L===E.TABLE_VIEW_ATTR||L===E.LINKER_ATTR));},ondrop:function I(L){this.elemBox.handleDragDrop(L);},getAttributePositions:function B(){return this.elemBox.getAttributePositions();},storeAttributePositions:function A(){var N=mstrApp.getRootController(),L=this.getAttributePositions(),P,M=this.linker.relations||[],O=M?M[0]:undefined;if(L){if(O){P=O.dimensionid;}N.updateRelationPositions(L,P);}},onRelationshipChange:function G(W){if(!this.hasRendered){return ;}var R=this,T=W.relations,P=mstrApp.getRootController(),O={},N,Q,U,S=W.storePositions,V=function V(b,c,Y){var Z=b.id,a=O[Z]=O[Z]||{n:b.n,attributeId:Z,tableId:b.tableId,parent:[],children:[]};if(c!==""){a[Y?"parent":"children"].push(c);}},M=this.elemBox,L=[];if(T&&T[0]){N=T[0].isChecked;Q=T[0].isVisible;U=T[0].isEnabled;}if(W.clear){M.cleanUp();this.storeAttributePositions();}this.positions=W.positions;H.forEach(T,function X(Y){var a=Y.parentAttributeId,Z=Y.childAttributeId;V({id:a,n:Y.parentAttributeName||P.getHierarchyAttributeName(Y.dimensionid,a),tableId:Y.relationTableId},Z,false);if(Z!==""){V({id:Z,n:Y.childAttributeName||P.getHierarchyAttributeName(Y.dimensionid,Z),tableId:Y.relationTableId},a,true);}});C.forEach(C.copy(O),function X(Z,Y){if(Z.parent.length===0){L.push(Y);}});M.refreshLabels(C.copy({attributes:O,rootIds:L,isChecked:N,isVisible:Q,isEnabled:U,entryPoints:W.entryPoints,attributeProperties:W.attributeProperties},W));this.linker.drawLinks(W);if(S){R.storeAttributePositions();}},children:[{scriptClass:"mstrmojo.architect.ui.RelationLinker",alias:"linker",slot:"relationsNode"},{scriptClass:"mstrmojo.architect.ui.AttributesContainer",alias:"elemBox",slot:"relationsNode"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.form","mstrmojo.hash","mstrmojo.Obj","mstrmojo.architect.ui.editors.NameEditor","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.obj.DBRole","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.warehouse.ui.editors.CatalogSQLEditor","mstrmojo.DI.DIConstants");var O=mstrmojo.hash,L=mstrmojo.func.wrapMethods,M=mstrmojo.warehouse.EnumDataChangeEvents,Q=M.DBTABLES_CHANGED,r=mstrmojo.warehouse.EnumObjectTypes,d=r.DBROLE,j=mstrmojo.DI.DIConstants,P,C,Z=57;function k(AD,AC){var AB;if(AD){AB=this.model.getDBRole(AD.did);if(AB){return AB;}}if(AC){AB=new mstrmojo.warehouse.obj.DBRole({mdl:this.model});if(AD&&AD.did){AB.did=AD.did;}return AB;}return null;}function S(){var AB="creating_a_database_connection.htm";if(mstrApp.type===j.xdaType.mdx){AB="Creating_a_data_source_connection_to_an_OLAP_source.htm";}else{if(mstrApp.subtype===j.sourceSubtype.searchOnSource){AB="Creating_a_data_source_connection_to_search.htm";}}return AB;}mstrmojo.warehouse.WHController=mstrmojo.declare(mstrmojo.Obj,null,{start:mstrmojo.emptyFn,getDataService:mstrmojo.emptyFn,loadDBRoles:function D(AB){this.model.loadDBRoles(AB);},isCloud:function R(){return false;},isUsingCookieNamespace:function A(){return this.model.usingCookieNamespace;},getDBRoles:function E(){return this.model.dbrs;},getAllDBRoleNames:function Y(){return this.model.allDBRoleNames;},loadDBObjects:function N(AB){this.model.loadDBObjects(AB);},getDBObjects:function T(){return this.model.dbObjects;},setNameSpaceID:function b(AB){this.model.set("SelNameSpaceID",AB);},getNameSpaceID:function q(){return this.model.SelNameSpaceID;},getNameSpaces:function w(AB){this.model.SelNameSpaceID=undefined;this.model.getNameSpaces(AB);},getColumnsForDBTables:function F(AE,AF){var AB=this.model,AC=AE.tables,AD=AE.getFresh;O.forEach(AC,function(AH){AB.getColumnsForDBTable({data:AH,getFresh:AD},L({success:function AI(AJ){AH.items=O.clone(AJ.items);},complete:function AG(){AB.raiseEvent({name:M.DBTABLE_UPDATED,item:AH});}},AF));});},getColumnsForDBTable:function W(AB,AC){if(P&&P.visible){AB.data.dbrole=P.dbRole.did;}this.model.getColumnsForDBTable(AB,AC);},setSelectedDBRoleID:function J(AB){this.model.set("SelDBRoleID",AB.did);},handleDBTableRefresh:function a(AC){var AB=this.model;AB.catalogRefresh=true;this.availableTableSearch("",O.copy(AC,{sourceInfo:"tablesPanel"}));},sqls:undefined,getCurrentZIndex:function X(){if(mstrApp.sessionManager){return mstrApp.sessionManager.zIndex;}return undefined;},displayCatalogSQL:function t(AD){var AC=this,AB=this.model,AE=AD||AB.SelDBRoleID;P=P||new mstrmojo.warehouse.ui.editors.CatalogSQLEditor({help:"defining_tables_are_retrieved_and_cached_for_a_data_source.htm"});AC.getDataService().catalogAction({success:function AF(AH){P.options=AH.options;P.SQLStatements=AH.sqls;AB.getDBRole(AE).populate(function AG(AJ){P.dbRole=AJ;P.supportsNameSpaces=AJ.supportsNameSpaces;P.onUpdateInfo=function AL(AM){AC.getDataService().catalogAction({success:function AN(){if(AB.SelDBRoleID===AE&&AB.SelNameSpaceID){AC.availableTableSearch("",{sourceInfo:"tablesPanel"});}}},{dbrid:AE,info:JSON.stringify(AM.options),flags:10003});};var AK=AC.getCurrentZIndex(),AI={};if(AK){AI.zIndex=AK+1;}P.open(null,AI);});}},{dbrid:AE,flags:10002});},attachDataChangeListeners:function g(AC){var AB=this.model;O.forEach(AC,function(AD,AE){O.forEach(AD,function(AG,AF){AB.attachEventListener(AF,AE,AG);});});},editDBRole:function c(AB,AD){var AC=this;k.call(this,AB,true).populate(function(AE){AC.loadDBObjects({success:function AF(){C=C||new mstrmojo.warehouse.dbroles.DBRoleEditor({help:S()});C.config=AC.model.dbRoleEditorCfg;C.config.showAddDriver=AC.model.showAddDriver;C.callback=AD||mstrmojo.emptyFn;C.dbrole=AE;C.container.dsninfo.clear();C.open();}});});},renameDBRole:function AA(AB){k.call(this,AB,false).populate(function(AC){if(!AC){return ;}var AE=new mstrmojo.architect.ui.editors.NameEditor({data:AC,tp:d,zIndex:9999,isNew:false,help:S(),onOK:function AD(AF){AC.rename(AF);}});AE.open();});},duplicateDBRole:function n(AB){var AC=this;k.call(AC,AB,false).populate(function(AD){if(!AD){return ;}AD.duplicate();});},deleteDBRole:function K(AB){var AC=this;k.call(AC,AB,false).populate(function(AE){var AD=mstrmojo.Button.newInteractiveButton;if(!AE){return ;}mstrmojo.confirm(mstrmojo.desc(10073,"Are you sure you want to delete the Database Connection")+" "+AE.n+"?",null,{buttons:[AD(mstrmojo.desc(219,"Yes"),function AF(){AC.model.deleteDBRole(AE.mdDBRole.did,{success:function AG(){}});},null,{iconClass:"mstrmojo-Editor-button-Yes"}),AD(mstrmojo.desc(218,"no"),null,null,{iconClass:"mstrmojo-Editor-button-No"})],title:mstrmojo.desc(3169,"delete"),zIndex:9999});});},setProjectPrimaryDBRole:function e(AC,AD){var AB=this.model;AB.SelDBRoleID=AC.did;AB.setProjectPrimaryDBRole(true,AD);},getProjectPrimaryDBRoleID:function I(){return this.model.projPrimaryDBRoleID;},saveDBRole:function G(AC,AB,AF){var AD=this;AD.model.saveDBRole(AC.mdDBRole,AB,L(AF,{success:function AE(AH){var AI=AH.dbr.did,AJ=AH.dbr.n,AG=k.call(AD,{did:AI},true);AG.populated=false;AG.n=AJ;}}));},populateDBRole:function V(AB,AC){this.model.populateDBRole(AB,AC);},navigateProject:function h(AB){if(AB){mstrmojo.form.send({evt:3010,Server:AB.sname,Project:AB.pname,Port:AB.port,loginReq:true},mstrApp.name,"POST",null,null,false);}else{mstrmojo.form.send({evt:3010},mstrApp.name,"POST",null,null,false);}},navigateArchitect:function z(AB){mstrmojo.form.send({evt:3176,Server:AB.sname,Project:AB.pname,Port:AB.port,loginReq:true},mstrApp.name,"POST",null,null,false);},availableTableSearch:function v(AB,AC){this.model.getSelectedDBRoleTables(L({blockBegin:0,blockCount:1000,filterText:AB},AC||{}));},getPrimaryDBRoleTablesAndColumns:function y(AB){this.model.getDBRoleTablesAndColumns({dbRoleID:this.model.projPrimaryDBRoleID},AB);},hasPrivilege:function f(AB){return mstrApp.isSingleTier||this.model.privileges[AB]||false;},validateName:function U(AD,AB,AC,AE){return this.model.validateName(AD,AB,AC,AE);},findNextName:function u(AB,AC,AD){return this.model.findNextName(AB,AC,AD);},findinArray:function x(AB,AD,AC){return this.model.findinArray(AB,AD,AC);},getObjectCount:function B(AD){if(Object.keys){return Object.keys(AD).length;}var AB,AC=[];for(AB in AD){if(AD.hasOwnProperty(AB)){AC.push(AB);}}return AC.length;},destroy:function p(AB){if(C){C.destroy(AB);C=null;}this._super(AB);},cleanError:function m(AB){AB=AB.replace("com.microstrategy.webapi.MSTRWebAPIException:","");AB=AB.replace("Internal Error:","");return mstrmojo.string.trim(AB);},launchOneTierFileBrowser:function i(AB){window.FormWrapper.openFileDialog(AB);},launchOneTierAccessFileBrowser:function i(AB){window.FormWrapper.openAccessDialog(AB);},oneTierFileUploader:function l(AC,AB){mstrApp.serverRequest(O.copy(AB,{taskId:"addDriver"}),AC,true);},clearDBTables:function H(){this.model.raiseEvent({name:Q,items:[],selectedItems:[]});},canDisplayCatalogSQL:function o(AF,AE){var AB=mstrmojo.hash.valarray(AF),AD=mstrmojo.array.find(AB,"v",AE),AC=AB[AD];if(mstrApp.isSingleTier){return false;}if((AC.disp&2)===2||(AC.disp&4)===4){return false;}if(!this.hasPrivilege(Z)){return false;}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.ProjectTablesPanel","mstrmojo.architect.ui.factories.ViewFactory","mstrmojo.architect.ui.panels.LogicalViewListPanel","mstrmojo.architect.ui.panels.LogicalViewSQLDataPanel","mstrmojo.architect.ui.panels.LogicalViewSQLPanel");mstrmojo.architect.ui.factories.LogicalViewViewFactory=mstrmojo.declare(mstrmojo.architect.ui.factories.ViewFactory,null,{scriptClass:"mstrmojo.architect.ui.factories.LogicalViewViewFactory",viewConfig:{editorLeft:true,editorTop:true,editorBottom:true,editorRight:true,leftVisible:false,topVisible:true,bottomVisible:true,rightVisible:true,showDB:true},newLeftNavigationPanel:function A(F){return new mstrmojo.architect.ui.ProjectTablesPanel(F);},newTopEditorPanel:function C(F){return new mstrmojo.architect.ui.panels.LogicalViewSQLPanel(F);},newBottomEditorPanel:function B(F){return new mstrmojo.architect.ui.panels.LogicalViewSQLDataPanel(F);},newRightItemsPanel:function E(F){return new mstrmojo.architect.ui.panels.LogicalViewListPanel(F);},closeObject:function D(){if(this.views.editorTop){this.views.editorTop.closeObject();}}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasEditableText","mstrmojo.array","mstrmojo.Box","mstrmojo.css","mstrmojo.dom","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.warehouse.ui.BasePanel","mstrmojo.architect.ui.TableContainer");var U=mstrmojo.array,V="mstrmojo-ar-",S="tbbtn",E=mstrmojo.dom,F="px",A=mstrmojo.warehouse.EnumObjectTypes,M=mstrmojo.architect.EnumDataChangeEvents,D=mstrmojo.desc(11385,"Show layers"),G=mstrmojo.desc(12225,"Hide layers"),P=mstrmojo.desc(12226,"Close layer"),N=mstrmojo.desc(12227,"Please select a layer or create a new one");function C(W){this.parent.showBottomPanel(!W);this.tableContainer.set("visible",W);this.set("instructionsVisible",!W);}function L(Z,b){var Y=U.find(Z,"did",b),a=Z[Y],W=Y>=0,X=W?a.n:"";this.layerId=b;this.setEditableTitle(X);C.call(this,W);}function B(W){var Y=W.layers,X=this.tableContainer,Z=W.value;X.removeChildren();this.items=Y;L.call(this,Y,Z);if(Z){X.refresh();}this.onwidthChange({value:this.width});}mstrmojo.architect.ui.panels.LayerPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.architect.ui.panels.LayerPanel",cssClass:"ContentsInfoPanel",editableSlot:"titleNode",instructionsText:N,allowEmptyText:true,icntp:A.LAYER,showList:undefined,tableContainer:undefined,viewListVisible:true,init:function O(X){var a=this;this._super(X);var W=mstrApp.getRootController(),Y={},Z=Y[this.id]={};this.addNewTitleButton({title:P,cssClass:V+S+" closeObject",onclick:function(){mstrApp.getRootController().closeViewObject();}});this.addNewTitleButton({title:D,alias:"showList",cssClass:V+S+" showList",onclick:function(){a.viewListVisible=!a.viewListVisible;mstrApp.getRootController().toggleViewList();}});Z[M.LAYER_CHANGE]=B;W.attachDataChangeListeners(Y);},postBuildRendering:function T(){this._super();C.call(this,!!this.layerId);},closeObject:function I(){mstrApp.getRootController().switchLayer("");this.setEditableTitle("");this.layerId="";C.call(this,false);},beforeLeave:function R(){this.tableContainer.updateTablePositionCache();mstrApp.getRootController().model.forceReloadLayer=true;},updateViewObjectName:function Q(X,W){if((!!(this.layerId))&&(X===this.layerId)){this.setEditableTitle(W);}},onTextEditComplete:function K(Z,b){var Y=mstrApp.rootController;if(Z){var W=this.layerId,X=this.text,a=Y.renameLayer(W,X);if(a!==true){this.setEditableTitle(b);}else{Y.updateViewListItem(W,X);}}},onheightChange:function H(X){var Y=parseInt(X.value,10),W=this.headerHeight=this.headerHeight||(this.hasRendered?this.headerNode.clientHeight:36),Z=(Math.max(parseInt(Y,10)-W,0))+F;this.height=Y+F;this.tableContainer.set("height",Z);this.set("instructionsHeight",this.height);},onwidthChange:function J(Y){var Z=this,X=parseInt(Y.value,10),W=Math.max(X,0),a=W-(this.titleIconsNode?E.position(this.titleIconsNode).w:0)-25;if(this.showList.domNode){this.showList.set("title",(Z.viewListVisible)?G:D);}this.width=X+F;this.tableContainer.set("width",W+F);if(this.titleNode){this.titleNode.style.width=a+F;}},children:[{scriptClass:"mstrmojo.architect.ui.TableContainer",alias:"tableContainer",visible:false}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Button","mstrmojo.func","mstrmojo.hash","mstrmojo.architect.ArchitectDataService","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.architect.ui.EnumViewTypes","mstrmojo.architect.ui.editors.DBRolePicker","mstrmojo.architect.ui.editors.LinksEditor","mstrmojo.architect.ui.editors.TablePreview","mstrmojo.warehouse.WHController","mstrmojo.architect.ui.ElementSelector");var AR=mstrmojo.warehouse.EnumObjectTypes,AK=AR.ATTRIBUTE,z=AR.COLUMN,l=AR.FACT,A1=AR.METRIC,V=mstrmojo.architect.ui.EnumViewTypes,Ax=V.LAYER,O=mstrmojo.architect.EnumDataChangeEvents,BA=mstrmojo,BK=BA.array,BE=BA.hash,AC=BA.func,BX=AC.wrapMethods,C=[],AY=[],AL=[],Az=BA.desc(11459,"Project saved."),N=BA.desc(11460,"Project saved and Schema updated.");function D(Bg,Bd,Bf){var Bh="mojoArchitectAlert";try{if(mstrmojo.all[Bh]){mstrmojo.all[Bh].destroy();}}catch(Be){}mstrmojo.insert({scriptClass:"mstrmojo.Dialog",id:Bh,title:Bf||mstrmojo.desc(3610,"MicroStrategy Web"),width:"475px",height:"200px",buttons:[mstrmojo.Button.newInteractiveButton(mstrmojo.desc(1442,"ok"),function(){mstrmojo.all.mojoArchitectAlert.destroy();if(Bd){Bd();}},"#666666")],children:[{scriptClass:"mstrmojo.Label",cssClass:"labelAlert",text:Bg}]}).render();}function BJ(Bf){var Bj=this,Bg=Bf?"AndUpdate":"SchemaInstance",Be=true,Bk=AY.length,Bd=0,Bi={},Bo,Bl="",Bh=Bf?N:Az;var Bm={success:function Bn(){Bd++;if(Be&&((Bk===0)||(Bk>0&&(Bd===Bk)))){BK.forEach(C,function(Bq){Bq();});Bj.model["save"+Bg]({success:function Bp(Bq){if(Bq.mi){Bo=Bq.mi["in"].oi;if(Bo){Bo=Bo.length?Bo:[Bo];if(Bo){BE.forEach(Bo,function(Br){if(Br.tp===A1){Bl=Bl+Br.n+"<br />";}});if(Bl!==""){Bh=Bh+"<br /><br /> <b> The following metrics were created: </b><br /><br />"+Bl;}}}}D(Bh,Bf?function(){location.reload();}:null,"MicroStrategy Architect");}});}else{if(Bi.msg){mstrmojo.alert(Bi.msg);}}}};if(Bk>0){BK.forEach(AY,function(Bp){Bi=Bp(Bm);Be=Be&&Bi.canProceed;return Be;});}else{Bm.success();}if(!Be){mstrmojo.alert(Bi.msg);}}function AA(Be,Bd){this.model.raiseEvent({name:O.TABLES_SELECTED,tableItems:Be,toAdd:Bd});}function AX(Bf){var Bd=this.model,Be=Bd.getTable(Bf);Bd.raiseTableChangeEvent(Be);}function A8(Bg,Bi){var Be=this.model,Bd=this,Bf=Bg.did;if(Be.autoMap){Be.autoRecognizeTable(Bf,{success:function Bh(){if(Bi&&Bi.success){Bi.success(Bg);}}});}else{Bd.loadTableContents(Bg,{success:function Bh(){if(Bi&&Bi.success){Bi.success(Bg);}}});}}function Av(){var Bd=this.model;return Bd.getLayer(Bd.currentlayerID);}function AI(Bd){var Be=Av.call(this).tablePositions[Bd.did];if(Be){Bd.x=Be.x;Bd.y=Be.y;Bd.w=Be.w;Bd.h=Be.h;}}mstrmojo.architect.RootController=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{start:function h(){var Bi=this.rootView,Be=this.model,Bk=window.localStorage,Bh=this,Bf=(Bk&&Bk.getItem("initialSettings"))||null,Bg=JSON.parse(Bf);var Bj=Bh.dataService=new mstrmojo.architect.ArchitectDataService();Be.attachEventListener("schemaInstanceIDChange",Bj.id,function(){Bj.schemaInstanceID=Be.schemaInstanceID;});Bi.render();if(Bg&&Bg.showDatabaseView&&Bg.showProjectTableView){Bh.showDatabaseView=(Bg.showDatabaseView==="1");Bh.showProjectTableView=(Bg.showProjectTableView==="1");var Bd=Bg.cv||V.LAYER;Be.currentView=Bd;Be.currentLogicalViewID=Bg.logicalview||"";Be.currentTransformationId=Bg.transformation||"";Be.currentlayerID=Bg.layer||"";Be.forceReloadLayer=true;Be.currentHierarchyID=Bg.userhierarchy||"";}Be.createSchemaInstance();window.setInterval(function(){Bj.pingServer();},150000);},model:undefined,rootView:undefined,showDatabaseView:false,showProjectTableView:false,projectPrimaryDBroleSet:false,dbRolesLoaded:false,onCloseArchitect:function Ae(){var Bd={},Bf=mstrApp.rootController,Be=Bf.model,Bg=window.localStorage;if(Bf.rootView&&Bf.rootView.children[1]&&Bf.rootView.children[1].getSplitterLayout){Bf.rootView.children[1].getSplitterLayout(Bd);if(Bg){Bg.setItem("initialSettings",JSON.stringify({cv:Be.currentView,splittersLayouts:Bd,showDatabaseView:Bf.showDatabaseView?"1":"0",showProjectTableView:Bf.showProjectTableView?"1":"0",logicalview:Be.currentLogicalViewID,transformation:Be.currentTransformationId,layer:Be.currentlayerID,userhierarchy:Be.currentHierarchyID}));}}Bf.model.onCloseArchitect();},getDataService:function BD(){if(!this.dataService){this.dataService=new mstrmojo.architect.ArchitectDataService();}return this.dataService;},toggleDatabaseView:function b(Bd){if(!this.rootView){return ;}var Be=this.model;this.showDatabaseView=Bd;if(Bd&&!Be.SelDBRoleID){Be.set("SelDBRoleID",Be.projPrimaryDBRoleID);this.projectPrimaryDBroleSet=true;}this.rootView.toggleDatabaseView(Bd);if(Bd&&!this.loaded){this.loaded=true;this.loadDBRoles();this.dbRolesLoaded=true;}},toggleProjectTableView:function Ar(Bd){this.rootView.toggleProjectTableView(Bd);this.showProjectTableView=Bd;if(Bd){this.model.getProjectTables();}},preSwitchView:function r(){var Bd=true,Be={canProceed:true},Bf=this.model.currentView||Ax;BK.forEach(AL,function Bg(Bh){Be=Bh(Bf);Bd=Bd&&Be.canProceed;return Bd;});return Be;},switchView:function A6(Bi,Bf){var Be=this,Bh=this.model,Bd=this.preSwitchView(),Bg=Bh.currentView||Ax,Bk=(Bf?Bi:Bg);if(Bd.canProceed){Bh.targetView=Bk;this.rootView.switchView(Bk);Bh.currentView=Bk;switch(Bi){case V.SYS_HIERARCHY:Bh.getRelations({success:function Bj(Bl){Bh.raiseEvent({name:O.RELATIONSHIP_CHANGED,relations:Bl.relations,positions:Bl.attributePositions,viewType:Bi});Bh.raiseEvent({name:O.ATTRIBUTES_CHANGED,relations:Bl.relations});}});break;case V.TRANSFORMATION:Bh.getRelations({success:function Bj(Bl){Bh.raiseEvent({name:O.RELATIONSHIP_CHANGED,relations:Bl.relations,positions:Bl.attributePositions,viewType:Bi});Bh.loadTransformations({success:function Bm(){Be.editTransformation(Bh.currentTransformationId);}});}});break;case V.USER_HIERARCHY:Be.switchUserHierarchy(Bh.currentHierarchyID);break;case V.LOGICAL_VIEWS:this.switchLogicalView(Bh.currentLogicalViewID);break;case V.LAYER:this.model.getProjectTables();this.model.loadLayers({success:function Bj(){Be.switchLayer(Bh.currentlayerID);}});break;}}else{mstrmojo.alert(Bd.msg);}},saveProject:function Ao(){this.model.isDirty=false;BJ.call(this,false);},saveAndUpdate:function H(){this.model.isDirty=false;BJ.call(this,true);},registerSaveCallback:function BP(Bd){C.push(Bd);},registerPreSaveCallback:function BP(Bd){AY.push(Bd);},registerPreSwitchViewCallback:function AS(Bd){AL.push(Bd);},getSettings:function AE(){return{autoMap:this.model.autoMap};},setSettingValue:function U(Be,Bf){var Bd=this.model;Bd.isDirty=true;Bd.set(Be,Bf);},getProjects:function BQ(Bd,Be){this.model.getProjects(Bd,Be);},addTables:function o(Be){var Bd=this.model;Bd.isDirty=true;Bd.addTables(Be);},createAttribute:function BY(Bf){var Be=this.model,Bd=this;Be.isDirty=true;Be.createAttribute(Bf);Bd.addToCurrentLayer(Be.getTable(Bf.pdid).getTableData(true));},autoMapTable:function AW(Bf){var Be=this.model,Bd=this;Be.isDirty=true;BK.forEach(Bf,function(Bh){Be.autoRecognizeTable(Bh.did,{success:function Bg(Bi){Bd.addToCurrentLayer(Be.getTable(Bi.id).getTableData(true));}});});},addOrRemoveTables:function Al(Bd,Bm){var Bg=this.model,Bf=this,Be,Bk=[],Bi=[],Bl={success:function Bj(Bo){A8.call(Bf,Bo,{success:function Bn(Bp){Bp.x=Bk[Bp.n];Bp.y=Bi[Bp.n];Bf.addToCurrentLayer(Bp);}});}};Bg.isDirty=true;if(Av.call(this)){var Bh=[];BK.forEach(Bd,function(Bn){if(Bn.x){Bk[Bn.n]=Bn.x+"px";}if(Bn.y){Bi[Bn.n]=Bn.y+"px";}if(Bm){if(Bf.model.getTable(Bn.did)){Bl.success(Bn);}else{if(!Bn.dbrole){Bg.addTables([Bn],Bl);}else{Bl.success(Bn);}}}else{Be=Bf.model.getTable(Bn.did).getTableData();Be.bold=false;Bh.push(Be);}});if(!Bm){AA.call(this,Bh);}}},createFact:function BI(Bf){var Be=this.model,Bd=this;Be.isDirty=true;Be.createFact(Bf);Bd.addToCurrentLayer(Be.getTable(Bf.pdid).getTableData(true));},getTablePositions:function d(){var Bd=[],Bf=this,Be=this.model,Bg=Av.call(this),Bh;if(!Bg){return[];}BE.forEach(Bg.tables,function(Bi){Bh=Bi.getTableData(true);AI.call(Bf,Bh);Bd.push(Bh);Be.getAttributesFactsInTable(Bi.id,{success:function Bj(Bk){if(Bk&&Bk.items&&Bk.items.items&&Bk.items.items.length){Bh=Bk.items.items[0];AI.call(Bf,Bh);Be.raiseTableChangeEvent(Bi);}}});});return Bd;},setLayerTablePositions:function AF(Bd){var Be=Av.call(this);BE.forEach(Bd,function(Bf){Be.updateTablePositions(Bf,{x:Bf.x,y:Bf.y,w:Bf.w,h:Bf.h});});if(Be&&Bd.length){this.model.updateLayer(Be,mstrmojo.emptyFn);}},getCurrentHierarchyID:function AD(){return this.model.currentHierarchyID;},isSystemDimensionView:function BL(){var Bd=this.model;return(Bd.currentView===V.SYS_HIERARCHY||Bd.currentView===V.LAYER);},isTargetSystemDimensionView:function Ad(){var Bd=this.model;return(Bd.targetView===V.SYS_HIERARCHY||Bd.targetView===V.LAYER);},addAttributeToHierarchy:function Aa(Bf,Be,Bg){var Bd=this.model;Bd.isDirty=true;if(Bd.currentView===V.USER_HIERARCHY){Bd.addAttributeToHierarchy(Bf,Be,Bg);}else{if(Bg&&Bg.success){Bg.success();}}},addEntryPoint:function q(Be){var Bd=this.model;Bd.isDirty=true;if(Bd.currentView===V.USER_HIERARCHY){Bd.addEntryPoint(Be);}},editFilters:function AJ(Bf,Bm,Bo){var Bk=this.model,Bh,Bl=[],Be,Bj,Bd,Bi={success:function Bn(Bp,Bq){Bk.setHierarchyAttributeFilters(Bf,Bq,{success:function Br(){if(Bo&&Bo.success){Bo.success(Bq);}}});}},Bg=new mstrmojo.architect.ui.ElementSelector({title:{text:Bm,icon:"attribute"},availableTitle:"Available Filters",selectedTitle:"Selected Filters"});Bk.isDirty=true;Bk.searchFilters({success:function Bn(Bp){Bh=Bp.oi||[];Be=Bk.getHierarchyAttributeFilters(Bf)||[];BE.forEach(Be,function(Bq){Bd=BK.find(Bh,"did",Bq.did);Bj=Bh[Bd];Bl.push(Bj);Bh.splice(Bd,1);});Bg.availableList=Bh;Bg.selectedList=Bl||[];Bg.availableTitle=mstrmojo.desc(12242,"Available filters");Bg.selectedTitle=mstrmojo.desc(12243,"Selected filters");Bg.callback=Bi;Bg.open();}});},removeEntryPoint:function S(Be){var Bd=this.model;Bd.isDirty=true;if(Bd.currentView===V.USER_HIERARCHY){Bd.removeEntryPoint(Be);}},setHierarchyAttributeLockProperty:function Aq(Bg,Be,Bd,Bh){var Bf=this.model;Bf.isDirty=true;Bf.setHierarchyAttributeLockProperty(Bg,Be,Bd,Bh);},updateHiearchySubtype:function BO(Be,Bf){var Bd=this.model;Bd.isDirty=true;Bd.updateHiearchySubtype(Be,Bf);},setTransformationCardinality:function Ba(Be,Bf){var Bd=this.model;Bd.isDirty=true;Bd.setTransformationCardinality(Be,Bf);},setTransformationAllAttributes:function AU(Be,Bf){var Bd=this.model;Bd.isDirty=true;Bd.setTransformationAllAttributes(Be,Bf);},editTransformation:function AP(Be){var Bd=this.model;if(Be){Bd.isDirty=true;}Bd.editTransformation(Be);},updateRelationPositions:function As(Bd,Bf){var Be=this.model;Be.updateRelationPositions(Bd,Bf);},addTransformation:function R(Be,Bf){var Bd=this.model;Bd.isDirty=true;Bd.addTransformation(Be,Bf);},renameTransformation:function BF(Be,Bd){this.model.isDirty=true;return this.getTransformation(Be).rename(Bd);},addTransformationElement:function Ag(Bk,Bh,Bj,Bg,Bf,Bd,Bi){var Be=this.model;Be.isDirty=true;Be.addTransformationElement(Bk,Bh,Bj,Bg,Bf,Bd,Bi);},selectTransformationElement:function A9(Bi,Bf,Be,Bh,Bg){var Bd=this.model;Bd.raiseEvent({name:O.TRANSFORMATION_SELECTED,value:{id:Bi,attribute:Bf,table:Be,expression:Bh},source:Bg});},removeTransformationElement:function AO(Bf,Be){var Bd=this.model;Bd.isDirty=true;Bd.removeTransformationElement(Bf,Be);},commitTransformation:function A2(Bd,Bf){var Be=this.getTransformation(Bd);if(Be){Be.commit(Bf);}},addLogicalView:function Y(Be,Bf){var Bd=this.model;Bd.isDirty=true;Bd.addLogicalView(Be,Bf);},renameLogicalView:function Au(Bd,Be,Bg){var Bf=this.model;Bf.isDirty=true;return Bf.logicalViews[Bd].rename(Be,Bg);},addToCurrentLayer:function u(Bk){var Bf=this,Be=this.model,Bh=Av.call(this),Bj=Bk.id||Bk.did,Bg,Bi=Be.getTable(Bj);Be.isDirty=true;if(!Bh){return ;}var Bd=!Bh.tables[Bj];if(Bd){Bh.addTable(Bi);}if(Bk.x){Bh.updateTablePositions(Bk,{x:Bk.x,y:Bk.y,w:Bk.w,h:Bk.h});}if(Bd){Bg=Bi.getTableData(true);Bg.x=Bk.x;Bg.y=Bk.y;AA.call(Bf,[Bg],true);AX.call(Bf,Bj);}else{AX.call(Bf,Bj);}},removeFromCurrentLayer:function Ak(Bd){this.model.isDirty=true;Av.call(this).removeTable(Bd);},renameLayer:function E(Bd,Bf){var Be=this.model;Be.isDirty=true;return Be.getLayer(Bd).rename(Bf);},addLayer:function AQ(Bg,Bf,Be){var Bd=this.model;Bd.raiseEvent({name:O.BEFORE_LAYER_CHANGE});Bd.isDirty=true;Bd.addLayer(Bg,Bf,Be);},deleteLayer:function T(Bd){var Be=this.model;Be.isDirty=true;Be.deleteLayer(Bd);},switchLayer:function A7(Bd){var Be=this.model;Be.raiseEvent({name:O.BEFORE_LAYER_CHANGE});Be.switchLayer(Bd);},setTableDBRoles:function A(Be){var Bd=this.model;Bd.isDirty=true;Bd.setTableDBRoles(Be);},getTableDBRoles:function BW(Bd){return this.model.getTableDBRoles(Bd);},loadTableContents:function M(Be,Bg){var Bd=Av.call(this);this.model.getAttributesFactsInTable(Be.did,BX({success:function Bf(){if(Bd){Bd.tableLoaded();}}},Bg));},populateTableContents:function BT(Bd,Be){this.model.getAttributesFactsInTable(Bd,Be);},getTable:function BB(Bd){return this.model.getTable(Bd);},getColumns:function Q(){return this.model.columns;},getAttribute:function k(Bd){return this.model.getAttribute(Bd);},getFormCategories:function F(){return this.model.formCategories;},addJointChildren:function f(Bf,Bd){var Be=this.model;Be.isDirty=true;Be.addJointChildren(Bf,Bd);},getJointChildrenCandidates:function BU(Bd){return this.model.getJointChildrenCandidates(Bd);},getTransformation:function a(Bd){return this.model.transformations[Bd];},getHierarchy:function AZ(Bd){return this.model.userHierarchies[Bd];},addUserHierarchy:function A0(Be){var Bd=this.model;Bd.isDirty=true;Bd.addUserHierarchy("",Be);},renameUserHierarchy:function BN(Be,Bd,Bg){var Bf=this.model;Bf.isDirty=true;Bf.userHierarchies[Be].rename(Bd,Bg);},dimensions:undefined,switchUserHierarchy:function x(Bd){this.model.loadUserHierarchies(Bd);},switchLogicalView:function Z(Bd){var Be=this.model;if(!Be.logicalViews[Bd]){Bd="";}Be.currentLogicalViewID=Bd;Be.raiseEvent({name:O.LOGICALVIEWS_CHANGED,views:Be.logicalViews,value:Bd});},getUserHierarchy:function w(Bd){return this.model.userHierarchies[Bd];},autoArray:function AV(){var Bd=this.model;Bd.autoArrange();},getHierarchyAttributeName:function AB(Bd,Bg){var Bh=this,Bf,Be=this.model.userHierarchies[Bd];if(Be){Bf=Be.attributes[Bg];if(Bf){return Bf.n;}}else{Bf=Bh.model.getAttribute(Bg);if(Bf){return Bf.name;}}return"";},updateRelation:function t(Bf,Bh,Bg,Be){var Bd=this.model;Bd.isDirty=true;Bd.updateRelation(Bf,Bh,Bg,Be);},addRelation:function BZ(Bf,Bg,Be){var Bd=this.model;Bd.isDirty=true;Bd.addRelation(Bf,Bg,Be);},removeRelation:function n(Be,Bf){var Bd=this.model;Bd.isDirty=true;Bd.removeRelation(Be,Bf);},removeFromHierarchy:function g(Be){var Bd=this.model;Bd.isDirty=true;Bd.removeFromHierarchy(Be);},getRelation:function AN(Bd,Be){return this.model.getRelation(Bd,Be);},invalidateRelations:function BM(Bd){this.model.invalidateRelations(Bd);},removeAttributeFromRelation:function e(Be){var Bd=this.model;Bd.isDirty=true;return Bd.removeAttributeFromRelation(Be);},addTableInfo:function BG(Bj,Bf){if(!Bj||!Bf){return ;}var Bh=this.model,Bk=(Bj.pdid===Bf.pdid),Be=(Bf.tp===z)?Bj:undefined;Bh.isDirty=true;if(Bj.did===Bf.did){return ;}if(Be){Bj=Bf;Bf=Be;}var Bd=Bj.tp,Bi=Bf.tp,Bg=Bh.getTable(Bj.pdid);if((Bd===l||Bi===l)&&Bk){return ;}if(Bd===AK&&Bi===AK){if(Bk&&(Bh.getFormCount(Bj.did)===1)){Bh.convertAttributeToForm(Bj.did,Bf.did,Bj.pdid);}}else{if(((Bd===z)&&!Bk)||((Bi===AK)&&Bk)){if(((Bi===AK)&&(!Bg.attributeInfos[Bf.did]))||Bk||((Bi===l)&&(!Bg.factInfos[Bf.did]))){Bh.addTableInfo(Bj,Bf);}}}},showSampleData:function Aw(Bi){var Bf=this.model,Bg=Bf.getTable(Bi.did),Bh=mstrmojo.all.TablePreview||new mstrmojo.architect.ui.editors.TablePreview(),Be=false;Bh.dbtn=Bi.dbtn;if(!Bg){Bg=new mstrmojo.architect.obj.Table({isNew:false,primaryDBRole:Bf.SelDBRoleID,nameSpace:Bi.ns,dbtn:Bi.dbtn,id:Bi.did});Be=true;}Bg.getSampleData({success:function Bj(Bk){Bh.cols=Bk.cols;Bh.dbTableInfo=Bk.dbt;Bh.open();},complete:function Bd(){if(Be){delete mstrmojo.all[Bi.did];}}});},showLinks:function W(Bd){this.model.getLinks(Bd,{success:function Be(Bf){var Bg=mstrmojo.all.LinksEditor;if(!Bg){Bg=new mstrmojo.architect.ui.editors.LinksEditor({obj:Bd,data:Bf});}else{Bg.obj=Bd;Bg.data=Bf;}Bg.open();}});},renameObject:function AT(Bf){var Be=this.model,Bg=new mstrmojo.architect.ui.editors.NameEditor({data:Bf,onOK:function Bd(Bh){Be.renameObject(Bf.did,Bf.tp,Bh,Bf.bfIdx,Bf.sid);}});Bg.open();},removeFromTable:function A3(Be){var Bd=this.model;Bd.isDirty=true;Bd.removeInfoFromTable(Be);},convertAttributeToFact:function L(Be){var Bd=this.model;Bd.isDirty=true;Bd.convertAttributeToFact(Be.bfIdx,Be.did,null,Be.pdid);},convertFactToAttribute:function j(Be){var Bd=this.model;Bd.isDirty=true;Bd.convertFactToAttribute(Be.did,null,"3",true,true,Be.n,Be.pdid);},convertAttributeToForm:function p(Bf,Be){var Bd=this.model;Bd.isDirty=true;Bd.convertAttributeToForm(Bf.did,Be.did,Bf.pdid);},convertColumnToForm:function Ab(Bf,Be){var Bd=this.model;Bd.isDirty=true;Bd.convertColumnToForm(Bf.did,Be.did,Bf.pdid);},setAsLookup:function BR(Be){var Bd=this.model;Bd.isDirty=true;Bd.setAsLookup(Be.pdid,Be.sid,Be.bfIdx);},updateAggregation:function Ay(Bf,Be){var Bd=this.model;Bd.isDirty=true;Bd.updateAggregation(Bf,Be);},updateMappingMethod:function AH(Bf,Be){var Bd=this.model;Bd.isDirty=true;Bd.updateMappingMethod(Bf,Be);},updateFormFormat:function BC(Bf,Be){var Bd=this.model;Bd.isDirty=true;Bd.updateFormFormat(Bf,Be);},updateFormCategory:function Ai(Bf,Be){var Bd=this.model;Bd.isDirty=true;Bd.updateFormCategory(Bf,Be);},unGroupForms:function Ap(Bf,Be){var Bd=this.model;Bd.isDirty=true;Bd.unGroupForms(Bf,Be);},groupForms:function X(Be,Bf){var Bd=this.model;Bd.isDirty=true;Bd.groupForms(Be,Bf);},openExpressionEditor:function Aj(Bh,Be){var Bd=this.model,Bg=Be.isNew?Bh.did:Bh.pdid,Bf=Bd.getTable(Bg);if(Bf&&(Bf.isPopulated||Bf.isNew)){Bd.openExpressionEditor(Bh,Be);}else{Bd.getAttributesFactsInTable(Bg,{success:function Bi(){Bd.openExpressionEditor(Bh,Be);}});}},loadFunctions:function Ah(Bd){this.model.loadFunctions(Bd);},getFunctions:function K(){return this.model.functions;},getTransformationTables:function y(Be,Bg){var Bd=this.model;Bd.searchAttributeTables(Be,BX({success:function Bf(Bi){var Bh=[];BK.forEach([].concat(Bi.oi),function(Bj){Bh.push({did:Bj.did,n:Bj.n});});Bi.tables=Bh;}},Bg));},deleteObject:function c(Be){var Bd=this;Bd.model.isDirty=true;Be=[].concat(Be);BK.forEach(Be,function(Bf){Bd.model.deleteObject(Bf);});},validateExpr:function Ac(Bd,Be){this.model.validateExpr(Bd,Be);},handleUpdateStructures:function Bc(Be){var Bd=this.model;Bd.isDirty=true;if(Be){BK.forEach(Be,function(Bf){Bd.updateTableStructure(Bf.did);});}else{BE.forEach(Bd.tables,function(Bf){if(!Bf.isView){Bd.updateTableStructure(Bf.id);}});}},changeLayerTableColumnView:function Af(Be,Bd){BK.forEach(Be,function(Bf){this.model.changeLayerTableColumnView(Bf,Bd);},this);},showDBRolePicker:function An(Bf){var Bd=this;this.loadDBRoles({success:function Be(){var Bg=mstrmojo.all.DBRolePicker;if(!Bg){Bg=new mstrmojo.architect.ui.editors.DBRolePicker({callback:Bf,model:Bd.model});}Bg.open();}});},trimTokenEnds:function BV(Bd){this.model.trimTokenEnds(Bd);},tokenizeExpression:function B(Be,Bd,Bf){this.model.tokenizeExpression(Be,Bd,Bf);},getTablesForRelationship:function G(Be,Bd){return this.model.getTablesForRelationship(Be,Bd);},prePopulateRelationMenu:function At(Bd,Be){this.model.prePopulateRelationMenu(Bd,Be);},findDependentsByNameSearch:function BS(Bd){this.model.findDependentsByNameSearch(Bd);},loadSearchObjectContents:function i(Bd,Be){this.model.loadSearchObjectContents(Bd,Be);},createTableAlias:function Am(Bd){this.model.isDirty=true;BK.forEach(Bd,function(Be){this.model.createTableAlias(Be);},this);},getSameTableAttributes:function A5(Bg){var Be=this.model,Bf=Be.getTable(Bg.pdid),Bd=[];if(Bg.items.length>1){return Bd;}BE.forEach(Bf.attributeInfos,function(Bh){if(Bh.attributeId!==Bg.did){Bd.push(Be.getAttribute(Bh.attributeId));}});return Bd;},updateColumn:function J(Be,Bf,Bg){var Bd=this.model;Bd.isDirty=true;Bd.updateColumn(Be,Bf,Bg);},setAsMultiLingual:function AG(Be){var Bd=this.model;Bd.isDirty=true;Bd.setAsMultiLingual(Be.pdid,Be.sid,Be.bfIdx);},setTableLogicalSize:function v(Be){var Bd=this.model;Bd.isDirty=true;Bd.setTableLogicalSize(Be);},setTableMenuContext:function Bb(Bd){this.model.setTableMenuContext(Bd);},raiseExecuteSQLEvent:function I(Bd){this.model.raiseEvent({name:O.LOGICALVIEW_SQLEXECUTED,data:Bd});},searchTables:function A4(Be,Bd,Bf){this.model.submitRequest(Bf,{objecttypes:15,uses:Be+",12;"+Bd+",12;",flags:1+2+256+512,xmlflags:1,specialparse:"relationTables"},"search");},closeViewObject:function P(){this.rootView.closeViewObject();},toggleViewList:function m(){this.rootView.toggleViewList();},updateViewListItem:function BH(Be,Bd){this.rootView.updateViewObjectName(Be,Bd);this.model.raiseEvent({name:O.VIEW_ITEM_RENAMED,itemID:Be,itemName:Bd});},preSwitchCheck:function AM(Bf,Bg,Be){var Bd=true,Bh="";if(Bf){Bd=Bd&&Bf.isValid();Bh=Bg.replace("%1",Bf[Be]);}return{canProceed:Bd,msg:Bh};}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.RelationPanelContent","mstrmojo.warehouse.ui.BasePanel","mstrmojo.architect.EnumDataChangeEvents");var B="px",I=mstrmojo.architect.EnumDataChangeEvents,E=I.LAYER_CHANGE;mstrmojo.architect.ui.RelationPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.architect.ui.RelationPanel",cssClass:"RelationPanel",title:mstrmojo.desc(11395,"Parent-Child Relationship"),init:function H(M){this._super(M);var J=this,K=mstrApp.getRootController();var N={},O=N[this.id]={},L=this.getRelationshipChangedEvents();L.forEach(function(P){O[P]=function(Q){if(J.shouldClearExistingRelations(Q)){Q.clear=true;}J.content.onRelationshipChange(Q);};});mstrApp.getRootController().attachDataChangeListeners(N);K.registerSaveCallback(function(){K.updateRelationPositions(J.content.getAttributePositions());});},postBuildRendering:function A(){this._super();this.onheightChange({value:this.height});},getRelationshipChangedEvents:function G(){return[I.RELATIONSHIP_CHANGED,E];},shouldClearExistingRelations:function F(J){return(J&&(J.name===E));},onheightChange:function C(K){var L=parseInt(K.value,10),J=this.headerHeight=this.headerHeight||(this.hasRendered?this.headerNode.clientHeight:36),M=(Math.max(parseInt(L,10)-J,0))+B;this.height=L+B;this.content.set("height",M);this.set("instructionsHeight",this.height);},onwidthChange:function D(L){var K=parseInt(L.value,10),J=Math.max(K,0)+B;this.width=K+B;this.content.set("width",J);},children:[{scriptClass:"mstrmojo.architect.ui.RelationPanelContent",alias:"content"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.DataGrid","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.ObjectInputBox","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME._HasLevel","mstrmojo.ME._HasSortBy","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(629,2148,3377,9582,12173,12179,12852);var J=mstrmojo.hash,k=mstrmojo.array,M=mstrmojo.expr,h=mstrmojo.ME._MetricEditorHelper,A=mstrmojo.ME.MetricDataService,c=mstrmojo.mstr.EnumDSSXMLObjectTypes,n=mstrmojo.ME.Enum.DYNAMIC_DIMTY,O=mstrmojo.ME.Enum.UI_OBJECT_TYPE;var U,X;var e=function(E){if(E.onmetricModify){E.onmetricModify();}},b=function(){if(X.updateScrollbars){X.updateScrollbars();}};var Y=mstrmojo.ME.MetricToken.brackets,L=mstrmojo.ME.MetricToken.quotes,Z=mstrmojo.ME.MetricToken.unquotes;var d=function(){var E={"9C374236DD9F11D3B98100C04F2233EA":"Forecast","9C374233DD9F11D3B98100C04F2233EA":"Growth","9C374233DD9F11D3B98100C04F2233EA":"Trend","677E93B2786B11D4B82F00C04F356781":"Case",C41C34F0786B11D4B82F00C04F356781:"CaseV",B2C0FA4420C711D6AD1400C04F0423DE:"IF","8107C324DD9911D3B98100C04F2233EA":"Not"};return E.hasOwnProperty(this.fctOi.did);};var g=function(r){var q=r.split(",")[0],p=q.replace(/\d$/,""),E=q.replace(p,"");return{prefix:p,startAt:parseInt(E,10)};};var G=function(x){var v=function(){if(x.isRepeated){var w=this.parent.dataGrid.ctxtBuilder.itemWidgets[this.parent.idx].labelWidget;if(w){w.set("count",this.getSelectedObjects().length);}}};var p=X.getParamObjectTypes();var E={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"paramInput",slot:"0,0",cssClass:"mstrmojo-ME-param",dtp:x.dtp,isDME:X.isDME,hideEditButton:function(w){return true;},hideDelButton:function(w){return this.isFull;},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},browsableTypes:p.concat([M.TP.FOLDER]).join(","),folderLinksContextId:17,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),getCandidatesThroughTaskCall:function u(y,w){y.objectType=p.join(",");y.rootFolderType=39;y.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(y,w);},postCreate:function(AB){var AA=this.parent.dataGrid,AD=AA&&AA.parent;this.noCache=AD.noCache;if(!this.noCache){this.candidates=AD.getCandidates(function(AE){return mstrmojo.array.indexOf(p,AE.t)>-1;});var w=this.candidates.items||[];if(X.isDME){w=X.replaceAttributeWithForms(k.filter(w,function(AE){return k.indexOf(p,AE.t)>-1&&AE.st!==M.STP.NDE;}));}for(var z=0,y=(x.items||[]).length;z<y;z++){var AC=x.items[z];if(AC&&AC.t===mstrmojo.ME.Enum.UI_OBJECT_TYPE.Sub_Expression){w.push(AC);}}this.candidates.items=w;if(!AB){AA.candidatesListener.push(this.id);}}if(!AB){this.set("items",x.items);}},onitemchange:function(){e(this.parent.dataGrid.parent);},onadd:function q(){v.call(this);},onremove:function t(){v.call(this);},obCfg:{folderLinksContextId:17,browsableTypes:p.concat([M.TP.FOLDER]).join(",")}}],getTokens:function(){var AA=this.paramInput.getSelectedObjects(),AB,w=AA.length,z,AC=[],y;if(w>0){for(z=0;z<w;z++){AB=AA[z];if(AB.state===mstrmojo.Enum_OIB_States.VALID&&AB.did){if(AB.t===O.Sub_Expression){AC=AC.concat(AB.tks);}else{y={v:Y(AB.n)};if(AB.t===21){y.oi=AB.oi;y.exv=AB.fmdid||AB.exv;y.extp=8;y.v=AB.fnm?Y(AB.oi.n)+"@"+Y(AB.fnm):y.v;}else{y.oi=AB;}AC.push(y);}}else{y={v:L(x.dtp,AB.n)};AC.push(y);}AC.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}AC.pop();}return AC;}};var r=E.children&&E.children[0];if(!x.isRepeated){r.cssClass="mstrmojo-ME-ObjectInputBox-param singleObject noVerify";r.maxObjectCount=1;}else{r.cssClass="mstrmojo-ME-ObjectInputBox-param noVerify";}return E;};var C=function(q){var p=mstrmojo.all[U];var E=null;if(q.isParam){E=p.getParamWidget(q);}else{switch(q&&q.dtp){case 11:E={scriptClass:"mstrmojo.Pulldown",cssClass:"bool mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"False",did:"0"},{n:"True",did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(r){var t=this.data;this.value=!!t.v?(t.v==="False"?0:-1):(t.dfv||0);},getTokens:function(){var r=this.data;if(this.value!==r.dfv){return[{v:r.n},{v:"=",isDelimiter:true},{v:this.value=="-1"?"True":"False"}];}return[];},onvalueChange:function(){e(this.parent.dataGrid.parent);}};break;case -2:E=p.getBreakByWidget(q);break;case -1:E=p.getSortByWidget(q);break;default:E=p.getTextWidget(q);break;}}E.alias="inputWidget";return E;};var W=function(r,E,p){var q={scriptClass:"mstrmojo.ui.List",alias:"labelWidget",cssClass:"mstrmojo-FunctionWidzard-labels",count:r.items&&r.items.length||0,buildItems:function(){var t=[],v=this.count,x=(r.isParam?"*":"")+":",w=r.np;if(w){for(var u=0;u<=v;u++){t.push({n:w.n+(w.startAt+u)+x,title:r.desc||""});}}else{t.push({n:(r.dn||r.n)+x,title:r.desc||""});}this.set("items",t);},postCreate:function(){this.buildItems();},oncountChange:function(){this.buildItems();}};return q;};var P=function(t){var p=mstrmojo.all[U];return{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"breakByInput",cssClass:"mstrmojo-ME-breakby",isDME:p.isDME,dtp:t.dtp,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),folderLinksContextId:16,browsableTypes:[M.TP.FOLDER,M.TP.ATTR].join(","),getCandidatesThroughTaskCall:function r(v,u){v.rootFolderType=39;v.blockCount=v.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(v,u);},obCfg:{folderLinksContextId:16,browsableTypes:[M.TP.ATTR,M.TP.FOLDER].join(",")},postCreate:function(w){var u=this.parent.dataGrid,x=u&&u.parent;this.noCache=x.noCache;if(!this.noCache){this.candidates=x.getCandidates(function(AA){return AA.t===c.Attribute||AA.t===c.Consolidation;});if(this.isDME){this.candidates.items=n.getItems("breakby").concat(this.candidates.items);}if(!w){u.candidatesListener.push(this.id);}}if(!w){var v=t.items||[],y=p.oi.tks,z=!y.met||y.items&&(y.items.length===0);if(z&&this.isDME){v.push(n.getAutomaticDimtyObject());}this.set("items",v);}},onitemchange:function(){e(this.parent.dataGrid.parent);},onadd:function E(){b();},onremove:function q(){b();},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},getTokens:function(){var x=this.getSelectedObjects(),u=x.length,w,z=[];if(u>0){z.push({v:"BreakBy"});z.push({v:"=",isDelimiter:true});z.push({v:"{",isDelimiter:true});for(w=0;w<u;w++){var y=x[w],v;if(h.isDimty(y.n)){v={v:y.n};}else{if(/^@/.test(y.did)){v={v:y.did};}else{v={v:Y(y.n),oi:y};}}z.push(v);if(w!==(u-1)){z.push({v:",",isDelimiter:true});}}z.push({v:"}",isDelimiter:true});}return z;}};};var F=function(r,t){var p=r.length,E;for(E=0;E<p;E++){var q=mstrmojo.array.find(r[E].fns,"n",t);if(q>-1){return J.clone(r[E].fns[q]);}}return null;};var S=function(q,r){var p,E=r.length,t=q&&q.length;if(t>0){for(p=0;p<t-1;p++){q[p].items=[r[p]];q[p].dynamicVerify=true;}q[t-1].items=[];for(p=t-1;p<E;p++){q[t-1].items.push(r[p]);q[t-1].dynamicVerify=true;}}return q;};var N=function(p,q,u){var t={items:[]},r={301:"}",302:")"}[u],E=q[++p];while(E){if(E.oi){if(u==302){E.oi.selFrm=E.exv;E.oi.asc=E.asc;}t.items.push(E.oi);}if((E=q[++p]).v===r){break;}}return t;};mstrmojo.ME.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ME._MetricEditorHelper,mstrmojo.ME._HasLevel,mstrmojo.ME._HasSortBy],{scriptClass:"mstrmojo.ME.FunctionWizard",cssClass:"mstrmojo-Editor-me mstrmojo-FunctionWidzard",title:mstrmojo.desc(9582,"Function Editor: "),help:"Function_Arguments_dialog_box.htm",fctOi:null,fctArgs:null,fctArgsDataGridCssClass:"functionArgs",fctSyntax:"",fctDesc:"",hiddenPs:[],bindings:{candidates:"this.opener.candidates"},getParamObjectTypes:function f(){var E=[M.TP.METRIC,M.TP.FACT];if(this.isAgg(this.fctOi)){E.push(M.TP.ATTR);}return E;},getCandidates:function R(q){var p=this.candidates,E;if(p){E=mstrmojo.array.filter(p.items,q);return{items:E,isComplete:p.isComplete};}return{};},_set_candidates:function(u,p){this.candidates=p;if(this.hasRendered&&this.visible){var r=this.argsGrid,t=r.candidatesListener,E=t.length,q;for(q=0;q<E;q++){if(mstrmojo.all[t[q]]){mstrmojo.all[t[q]].postCreate(true);}}}if(this._super){this._super(u,p);}return true;},postProcessParamsFromToken:function(t){if(this.refOi&&this.candidates){var u=this.refOi.did;this.refOi=mstrmojo.array.filterOne(this.candidates.items,function(p){return p.did===u;});}var x=[],v,r,q=t.pars,E=(q&&q.length)||0;for(r=0;r<E;r++){v=J.copy(q[r]);v.isParam=true;if(r===0&&this.refOi){v.items=[this.refOi];this.refOi=null;}x.push(v);}if(t.rpc>0&&!d.call(this)){v.isRepeated=true;var w=g(v.n);v.np={n:w.prefix,startAt:w.startAt||1};}return x;},postProcessProsFromToken:function(r){var t=[],q,E=(r.pros&&r.pros.length)||0,p=function(u){if(k.indexOf(mstrmojo.ME.Enum.NonExposableParams,u.n)>-1){u.itemCss="hidden";}return u;};for(q=0;q<E;q++){t.push(p(J.copy(r.pros[q])));}return t;},buildSyntax:function(q){var p=[],r,E;p.push(q.n);p.push("(");E=(q.pars&&q.pars.length)||0;for(r=0;r<E;r++){p.push(q.pars[r].n);if(r!==(E-1)){p.push(", ");}}p.push(")");return p;},onOpen:function(){U=this.id;this._setupCandidatesCache();var q=this.getArgsFromTokens();var t=this,r=q||this.fctOi;var E=this.buildSyntax(r),u=this.postProcessParamsFromToken(r);u=u.concat(this.postProcessProsFromToken(r));if(r.sqt===5){u.push({n:"BreakBy",dn:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:"Break By is a parameter representing the break by levels for this function.",items:r.bb&&r.bb.items});}if(r.ios){u.push({n:"SortBy",dn:mstrmojo.desc(12852,"Sort By"),dtp:-1,desc:"Sort By is a parameter representing the sort by levels for this function.",items:r.sb&&r.sb.items});}u=u.concat(this.hiddenPs||[]);t.set("fctArgs",u);t.set("fctSyntax",E.join(""));t.set("fctDesc",mstrmojo.ME.FunctionInfo.getDescAndExample(this.fctOi).desc+"  "+mstrmojo.ME.MetricDataService.getFunctionHelpTopic(r.h));t.set("title",this.insertMode?r.n:mstrmojo.desc(9582,"Function Editor: ")+" "+this.oi.n);t.set("fctName",r.n);this.raiseEvent({name:"fctDidChange",did:this.fctOi.did});this.set("isAggFunction",this.isAgg());this.set("ios",r.ios);if(this._super){this._super();}if(this.isAggFunction){var p=this.argsGrid.ctxtBuilder.itemWidgets;if(p&&p.length>0){this.metricLCT.set("labelWidth",p[0].labelWidget&&p[0].labelWidget.domNode.clientWidth+"px");}}},getArgsFromTokens:function Q(){if(!this.oi||this.oi.tks.items.length===0){return null;}var r={},u=this.oi.tks.items,AI=u.length,AD=[],p=[],AC=0,E=[],AH;for(AH=0;AH<AI;AH++){var w=u[AH],q=w.tp,AK=w.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(w.v)&&(w.v!=="("&&w.v!==")")||w.v==="&gt;"||w.v==="&lt;"){continue;}switch(AK){case 65536:r.n=w.oi?w.oi.n:w.v;var x=this.fctOi=F(this.functions,r.n);AD=x.pars||[];p=x.pros||[];r.rpc=x.rpc;r.sqt=x.sqt;r.ios=x.ios;break;case 196608:var AG=[],AB=[],z,AF,AE;w=u[++AH];while(w&&(w.sctt===196608||w.sctt===196609)){if(w.sctt===196608){AB.push(w);}else{AG.push(AB);AB=[];}w=u[++AH];}AG.push(AB);AG[AG.length-1].pop();for(AE=0;AE<AG.length;AE++){AB=AG[AE];var t={n:""};z=AB.length;if(z===1){w=AB[0];if(w.extp){t={n:w.v,did:w.oi.did+"@"+w.exv,exv:w.exv,extp:w.extp,oi:w.oi,t:21,tk:w};}else{var AA=Math.min(AD.length-1,E.length),AJ=Z(w,w.v,AD[AA].dtp);t=w.oi||{n:AJ,v:AJ};}}else{for(AF=0;AF<z;AF++){t.n+=AB[AF].v;}t.v=t.n;t.did=t.n;t.t=O.Sub_Expression;t.tks=AB;}E.push(t);}break;case 131072:if(q==301){var y={};w=u[++AH];while(w){if(w.tp!=282){if(w.oi){y.items=y.items||[];y.items.push(w.oi);}else{if(w.tp===64){y.items=y.items||[];var v=w.v+u[++AH].v;w=u[AH+1];if(w.tp===43||w.tp===45){v+=u[++AH].v;v+=u[++AH].v;}y.items.push(n.getDimtyObject(v,this.isDME));}}}if((w=u[++AH])["v"]==="}"){break;}}r.bb=y;}else{if(q==302){r.sb={};}else{if(q==259){mstrmojo.array.forEach(p,function(AN){if(AN.n===u[AH].v){AH=AH+2;var AM=u[AH],AL=[];do{AL.push(u[AH++].v);if(u[AH].sctt===131072&&u[AH].tp===62||u[AH].sctt===131073){break;}}while(true);AL=AL.join("");AL=Z(AM,AL,AN.dtp);AN.v=AL;return false;}});}}}break;}}r.pars=S(AD,E);r.pros=p;return r;},getTokens:function H(){var r=this.argsGrid.ctxtBuilder.itemWidgets,v=r.length,u,AA,x=[],q=[],AB=[],y,t,p,E,z=this.fctOi;for(u=0;u<v;u++){AA=r[u].inputWidget;if(AA.data.isParam){q.push(AA.getTokens());}else{x.push(AA.getTokens());}}AB.push({v:z.n,oi:z});v=x.length;if(v>0){E=false;AB.push({v:"<",isDelimiter:true});for(u=0;u<v;u++){y=x[u];p=y.length;if(p===0){continue;}E=true;for(t=0;t<p;t++){AB.push(y[t]);}AB.push({v:",",isDelimiter:true});}AB.pop();if(E){AB.push({v:">",isDelimiter:true});}}v=q.length;AB.push({v:"(",isDelimiter:true});E=false;for(u=0;u<v;u++){y=q[u];p=y.length;if(p===0){continue;}E=true;for(t=0;t<p;t++){AB.push(y[t]);}AB.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}if(E){AB.pop();}AB.push({v:")",isDelimiter:true});for(u=0,v=AB.length;u<v;u++){AB[u].isNew=true;}return AB;},getMetricDefAsTokens:function o(){var E=this.getTokens();if(this.getLCTDefAsTokens){E=E.concat(this.getLCTDefAsTokens());}return E;},handleValidation:function m(t){if(t&&!t.rjec){return ;}var q=t&&t.rjec==="-2147214846";if(q){var p=t.items,u=mstrmojo.array.find(p,"sta",-1),E=p[u].v;mstrmojo.alert('More than one object with the name "#" found. Browse to select the object or retype to select it from the search autocomplete list.'.replace("#",E));}else{mstrmojo.alert(t&&t.rjed);}},getPROPBuilder:function a(){return W;},getDTPBuilder:function i(){return C;},getParamWidget:function B(E){return G(E);},getBreakByWidget:function T(E){return P(E);},getSortByWidget:function j(E){return this._super();},getTextWidget:function V(E){return{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(p){var q=this.data;this.value=q.v||((q.dfv||q.dfv===0)?q.dfv:"");},getTokens:function(){var p=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==p.dfv){return[{v:p.n},{v:"=",isDelimiter:true},{v:L(p.dtp,this.value)}];}return[];},onvalueChange:function(){e(this.parent.dataGrid.parent);}};},getDataGridRef:function D(){return{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:this.fctArgsDataGridCssClass,makeObservable:true,banding:false,columns:[{headerText:"Property Name",dataWidgetBuilder:this.getPROPBuilder(),colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:this.getDTPBuilder(),colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"},onadd:function(){b();}};},init:function l(E){this.children=this.getChildren();this._super(E);U=this.id;X=this;},isAgg:function K(E){return(E||this.fctOi||{}).sqt===1;},getChildren:function I(){return[mstrmojo.ME._MetricEditorHelper.formatAndOptionsBarRef,mstrmojo.ME._MetricEditorHelper.nameEditBoxRef,mstrmojo.ME._MetricEditorHelper.functionNameRef,this.getDataGridRef(),this.getLCTComponent(),{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionSyntax",bindings:{visible:"this.parent.insertMode",text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionDesc",allowHTML:true,bindings:{visible:"this.parent.insertMode || this.parent.simplex",text:function(){return this.parent.fctDesc;}}},mstrmojo.ME._MetricEditorHelper.switchRef,mstrmojo.ME._MetricEditorHelper.buttonBarRef];}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.ui._HasScroller","mstrmojo.SearchableDropDownList","mstrmojo.ME.FunctionWizard","mstrmojo.ME._DerivedMetricEditorHelper");mstrmojo.requiresDescs(3377,11569,12179);var A,C;mstrmojo.ME.DerivedFunctionWizard=mstrmojo.declare(mstrmojo.ME.FunctionWizard,[mstrmojo.ME._DerivedMetricEditorHelper,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.DerivedFunctionWizard",init:function F(G){mstrmojo.css.addWidgetCssClass(this,"dme");this._super(G);A=this.id;C=this;},setupScrollNodes:function E(){this.scrollNode=this.containerNode;},onOpen:function B(){this._super();if(this.updateScrollbars){this.updateScrollbars();}},getParamObjectTypes:function D(){var G=this.opener||{};return G.getValidFuncParamTypes?G.getValidFuncParamTypes(this.fctOi):this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasEditableText","mstrmojo.dom","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.ui.EnumViewTypes","mstrmojo.architect.ui.RelationPanel","mstrmojo.architect.menu.UserHiearchySettingMenu");var C=mstrmojo.dom,Q=mstrmojo.hash,D="px",a="mstrmojo-ar-",Y="tbbtn",A=mstrmojo.warehouse.EnumObjectTypes,Z=mstrmojo.architect.menu.EnumMenuActions,U=mstrmojo.desc(12235,"Close user hierarchy"),O=mstrmojo.desc(12234,"Please select a user hierarchy or create a new one"),b=mstrmojo.desc(12236,"Show user hierarchies"),G=mstrmojo.desc(12237,"Hide user hierarchies"),S=mstrmojo.desc(12238,"Auto arrange"),I=mstrmojo.desc(12239,"The user hierarchy '%1' has no entry points. The user hierarchy needs to have an entry point before proceeding"),c=mstrmojo.architect.ui.EnumViewTypes,N=mstrmojo.architect.EnumDataChangeEvents,H=mstrmojo.desc(7831,"Settings"),E=Z.USE_AS_DRILL,L=Z.USE_AS_BROWSE;function B(d){this.content.set("visible",d);this.set("instructionsVisible",!d);}function F(f){var e=f.viewType||0,d=false,g="";if(e!==c.USER_HIERARCHY){return ;}this.hierarchyId=f.hierarchyId;if(f.hierarchyId){g=mstrApp.rootController.getUserHierarchy(f.hierarchyId).n||"";d=true;this.openTransactions[this.hierarchyId]={id:this.hierarchyId,n:g};}this.setEditableTitle(g);B.call(this,d);this.onwidthChange({value:this.width});}mstrmojo.architect.ui.panels.UserHierarchyPanel=mstrmojo.declare(mstrmojo.architect.ui.RelationPanel,[mstrmojo._HasEditableText,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.architect.ui.panels.UserHierarchyPanel",cssClass:"ContentsInfoPanel",editableSlot:"titleNode",allowEmptyText:true,instructionsText:O,icntp:A.DIMENSION,viewListVisible:true,showList:undefined,init:function R(f){var j=this;this._super(f);var e=mstrApp.getRootController(),d=this,g={},i=g[this.id]={};this.addNewTitleButton({alias:"settings",cssClass:a+Y+" settings",title:H,onclick:function(){var n=j.settingsMenu=j.settingsMenu||new mstrmojo.architect.menu.UserHiearchySettingMenu();n.data={did:j.hierarchyId,isVisible:function k(){return true;},isChecked:function o(r,q){var p=e.getHierarchy(e.getCurrentHierarchyID());switch(q.did){case E:return(p.useForDrill);case L:return(!p.useForDrill);}return false;},isEnabled:function m(){return true;}};var l=n.getMenuConfig();l.hostId=j.id;l.hostElement=this.domNode;l.isHostedWithin=false;j.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:l}));}});this.addNewTitleButton({title:S,alias:"autoArrange",cssClass:a+Y+" autoarrange",onclick:function(){e.autoArray();}});this.addNewTitleButton({title:U,cssClass:a+Y+" closeObject",onclick:function(){e.closeViewObject();}});this.addNewTitleButton({title:b,alias:"showList",cssClass:a+Y+" showList",onclick:function(){j.viewListVisible=!j.viewListVisible;e.toggleViewList();}});i[N.RELATIONSHIP_CHANGED]=F;mstrApp.getRootController().attachDataChangeListeners(g);e.registerPreSaveCallback(function h(n){var k=true,l,m="";Q.forEach(d.openTransactions,function(o){l=e.getHierarchy(o.id);if(l){m=I.replace("%1",l.n);k=k&&(l.entryPoints.length>0);}return k;});if(k){n.success();}return{canProceed:k,msg:m};});},openTransactions:{},postBuildRendering:function X(){this._super();B.call(this,!!this.hierarchyId);},getRelationshipChangedEvents:function P(){return[mstrmojo.architect.EnumDataChangeEvents.RELATIONSHIP_CHANGED];},shouldClearExistingRelations:function T(){return true;},hierarchyId:"",onTextEditComplete:function M(g,j){var k=mstrApp.rootController,d=this;if(g){var f=this.hierarchyId,e=this.text,i={success:function l(){k.updateViewListItem(f,e);},failure:function h(){d.setEditableTitle(j);}};k.renameUserHierarchy(f,e,i);}},closeObject:function J(){mstrApp.rootController.switchUserHierarchy("");this.setEditableTitle("");this.hierarchyId="";B.call(this,false);},beforeLeave:function W(){},updateViewObjectName:function V(e,d){if((!!(this.hierarchyId))&&(e===this.hierarchyId)){this.setEditableTitle(d);}},onwidthChange:function K(f){var g=this,e=parseInt(f.value,10),d=Math.max(e,0),h=d-(this.titleIconsNode?C.position(this.titleIconsNode).w:0)-25;if(this.showList.domNode){this.showList.set("title",(g.viewListVisible)?G:b);}this.width=e+D;if(this.titleNode){this.titleNode.style.width=h+D;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.ProjectTablesPanel","mstrmojo.architect.ui.RelationPanel","mstrmojo.architect.ui.factories.ViewFactory","mstrmojo.architect.ui.panels.LayerListPanel","mstrmojo.architect.ui.panels.LayerPanel");mstrmojo.architect.ui.factories.LayerViewFactory=mstrmojo.declare(mstrmojo.architect.ui.factories.ViewFactory,null,{scriptClass:"mstrmojo.architect.ui.factories.LayerViewFactory",newLeftNavigationPanel:function A(G){return new mstrmojo.architect.ui.ProjectTablesPanel(G);},newTopEditorPanel:function D(G){return new mstrmojo.architect.ui.panels.LayerPanel(G);},newBottomEditorPanel:function C(G){return new mstrmojo.architect.ui.RelationPanel(G);},newRightItemsPanel:function F(G){return new mstrmojo.architect.ui.panels.LayerListPanel(G);},closeObject:function E(){if(this.views.editorTop){this.views.editorTop.closeObject();}},beforeLeave:function B(){if(this.views.editorTop){this.views.editorTop.beforeLeave();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.RelationPanelContent","mstrmojo.architect.ui.RelationPanel");var E="mstrmojo-ar-",A="tbbtn",C=mstrmojo.desc(12238,"Auto arrange");mstrmojo.architect.ui.panels.SystemDimensionPanel=mstrmojo.declare(mstrmojo.architect.ui.RelationPanel,null,{scriptClass:"mstrmojo.architect.ui.panels.SystemDimensionPanel",cssClass:"SystemDimensionPanel",title:mstrmojo.desc(788,"System Hierarchy"),init:function D(F){var G=this;this._super(F);G.addNewTitleButton({title:C,alias:"autoArrange",cssClass:E+A+" autoarrange",onclick:function(){var H=mstrApp.getRootController();H.autoArray();}});},unrender:function B(F){mstrApp.getRootController().updateRelationPositions(this.content.getAttributePositions());this._super(F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.factories.ViewFactory","mstrmojo.architect.ui.panels.AttributesPanel","mstrmojo.architect.ui.panels.SystemDimensionPanel");mstrmojo.architect.ui.factories.SystemDimensionViewFactory=mstrmojo.declare(mstrmojo.architect.ui.factories.ViewFactory,null,{scriptClass:"mstrmojo.architect.ui.factories.SystemDimensionViewFactory",viewConfig:{editorLeft:true,editorTop:false,editorBottom:true,editorRight:false,leftVisible:true,topVisible:false,bottomVisible:true,rightVisible:false},newLeftNavigationPanel:function A(C){return new mstrmojo.architect.ui.panels.AttributesPanel(C);},newBottomEditorPanel:function B(C){return new mstrmojo.architect.ui.panels.SystemDimensionPanel(C);}});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.factories.ViewFactory","mstrmojo.architect.ui.panels.AttributesPanel","mstrmojo.architect.ui.panels.UserHierarchyPanel","mstrmojo.architect.ui.panels.UserHierarchyListPanel");mstrmojo.architect.ui.factories.UserHierarchyViewFactory=mstrmojo.declare(mstrmojo.architect.ui.factories.ViewFactory,null,{scriptClass:"mstrmojo.architect.ui.factories.UserHierarchyViewFactory",viewConfig:{editorLeft:true,editorTop:false,editorBottom:true,editorRight:true,leftVisible:true,topVisible:false,bottomVisible:true,rightVisible:true},newLeftNavigationPanel:function A(G){return new mstrmojo.architect.ui.panels.AttributesPanel(G);},newBottomEditorPanel:function C(G){return new mstrmojo.architect.ui.panels.UserHierarchyPanel(G);},newRightItemsPanel:function F(G){return new mstrmojo.architect.ui.panels.UserHierarchyListPanel(G);},closeObject:function D(){if(this.views.editorBottom){this.views.editorBottom.closeObject();}},updateViewObjectName:function E(H,G){if(this.views.editorBottom){this.views.editorBottom.updateViewObjectName(H,G);}},beforeLeave:function B(){if(this.views.editorTop){this.views.editorBottom.beforeLeave();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME.MetricDataService","mstrmojo.ME.AttributeEditBox","mstrmojo.expr","mstrmojo.array","mstrmojo.hash");var G;var e=mstrmojo.ME.MetricDataService,U=mstrmojo.hash,N=mstrmojo.array,W=mstrmojo.ME.AttributeEditBox.getTokenStreamXML,a=mstrmojo.expr.DTP,Q={SHOW_BAND_NAMES:-4,BANDON_UNITS:-6},B={START_END:'BandNames<ResidueName="All Others">(this@ID, "#s - #e")',BAND_NUM:'BandNames<ResidueName="All Others">(this@ID, "Band #b")',BAND_NUM_START_END:'BandNames<ResidueName="All Others">(this@ID, "Band #b: #s - #e")',NO:"No"},R=[{n:mstrmojo.desc(14145,"Start - End"),v:B.START_END},{n:mstrmojo.desc(14146,"Band #"),v:B.BAND_NUM},{n:mstrmojo.desc(14147,"Band #: Start - End"),v:B.BAND_NUM_START_END},{n:mstrmojo.desc(218,"No"),v:B.NO}],K={"8107C337DD9911D3B98100C04F2233EA":"BAND_SIZE","8107C338DD9911D3B98100C04F2233EA":"BAND_COUNT","8107C339DD9911D3B98100C04F2233EA":"BAND_POINTS"},D=function(){return[];};function Y(f){return f.replace(/\s/g,"").toLowerCase();}function O(f){var g=[{v:"BandNames",tp:279,lv:1,oi:{did:"ACA96B1F9F99412B867045747DD88575",n:"BandNames",st:2816,t:11}},{v:"<",tp:60,lv:1},{v:"ResidueName",tp:259,lv:1},{v:"=",tp:282,lv:1},{v:'"All Others"',tp:261,lv:1},{v:">",tp:62,lv:1},{v:"(",tp:40,lv:1},{lv:1,tp:275,v:"this@ID"},{v:",",tp:44,lv:1}];switch(f){case B.BAND_NUM:g.push({v:'"Band #b"',tp:261,lv:1});break;case B.BAND_NUM_START_END:g.push({v:'"Band #b: #s - #e"',tp:261,lv:1});break;case B.START_END:g.push({v:'"#s - #e"',tp:261,lv:1});break;}g.push({v:")",tp:41,lv:1});return g;}function d(f){var g="";N.forEach(f.slice(1,-1),function(h){g+=h.v;});return g;}function J(f){if(f.t===4){return"BandOn";}return f.n;}function E(f){if(f.t===4){return Q.BANDON_UNITS;}return f.dtp;}var C=function(f,g){return{did:"",n:"New Attribute",forms:[{n:"ID",tks:{items:[]}}]};};function T(g,f){return g.dtp===8&&g.n==="Delimiter"?'"'+f+'"':f;}function P(i){var h=i.split(",")[0],g=h.replace(/\d$/,""),f=h.replace(g,"");return{prefix:g,startAt:parseInt(f,10)};}function L(f,g){return{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:f,popupToBody:true,itemIdField:"v",postCreate:function(){var h=this.data;this.value=h.v||h.dfv;},getTokens:g||D,onvalueChange:function(){G.set("dirty",true);}};}function I(g,i){var f=function(j){return j.inputWidget&&j.inputWidget.widgetName===i;},h=mstrmojo.array.filterOne(g.argsGrid.ctxtBuilder.itemWidgets,f);return h&&h.inputWidget;}var H=function(g){var f=null;switch(g&&g.dtp){case Q.SHOW_BAND_NAMES:f=L(R);f.widgetName="bandNames";f.getDescTokens=function(){var h=this.selectedItem&&this.selectedItem.v;return h===B.NO?null:O(h);};break;case Q.BANDON_UNITS:f=G.getParamWidget(g);f.widgetName="bandOn";break;case a.DOUBLE:case a.INTEGER:case a.VARCHAR:f=G.getTextWidget(g);break;default:f=G.getParamWidget(g);f.onitemsChange=mstrmojo.emptyFn;break;}if(f){f.alias="inputWidget";}return f;};var M=function(m,n,j,o){var k=m.did,h=m.n,f=m.dsid,g=m.forms,l={items:n},i=function(p){if(p.vs!==0){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));return ;}var r,q={n:"ID",formula:p.tokenXML};if(k){q.did=g[0].did;r={act:"updateDA",name:h,dsid:f,attrId:k,isTokenStream:true,update:[q]};if(j){if(j.did&&!j.del){r.update.push(j);}else{if(j.did&&j.del){r.del=[{did:j.did}];}else{r.add=[j];}}}}else{r={act:"addDAToDataset",dsid:f,name:h,evFlags:1,isTokenStream:true,forms:[q].concat(j?[j]:[])};}o(r);};mstrmojo.ME.AttributeEditBox.validateSyntax(k,l,true,i);};var Z=function(k){var j=k.forms,g=j&&j.length,i=g&&j[0],h=g&&j[1],m=N.some(i&&i.ftk,function(n){return n.oi&&K[n.oi.did];});if(!m){return false;}if(g===1){return true;}if(h&&h.ftk&&g===2){var f=false,l=Y(d(h.ftk));U.forEach(B,function(n){if(Y(n)===l){f=true;return false;}});return f;}return false;};mstrmojo.ME.BandingDAEditor=mstrmojo.declare(mstrmojo.ME.DerivedFunctionWizard,null,{scriptClass:"mstrmojo.ME.BandingDAEditor",ide:null,insertMode:false,init:function V(f){this._super(f);G=this;},getDTPBuilder:function X(){return H;},getParamObjectTypes:function S(){return[mstrmojo.expr.TP.METRIC];},getTextWidget:function b(g){var h=P(g.n).prefix;return{scriptClass:"mstrmojo.ValidationTextBox",emptyText:(g.dtp===a.DOUBLE||g.dtp===a.INTEGER)?mstrmojo.desc(14143,"Type a number"):"",postCreate:function(){this.value=(g.items&&g.items[0].v)||g.dfv;},oninput:function i(j){G.set("dirty",true);this.createNextInputParamWidget();},constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP,min:1},dtp:g.dtp,getTokens:function(){var j=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==j.dfv){return[{v:T(j,this.value)}];}return[];},createNextInputParamWidget:function f(){var n=this.data,m=this.dataGrid,o=G._lastRpIdx;if(!(n.isRepeated&&n.rpIdx===o)){return ;}var k=o+1,l=h+k,j=mstrmojo.hash.copy({desc:l,n:l,items:null,dn:l,rpIdx:k},mstrmojo.hash.copy(n));m.items.add([j],mstrmojo.array.indexOf(m.items,n)+1);G._lastRpIdx=j.rpIdx;if(G.updateScrollbars){G.updateScrollbars();}}};},onOpen:function F(){G=this;this.oi.tks=this.oi.forms[0].tks||{items:this.oi.forms[0].ftk};this._super();if(this.updateScrollbars){this.updateScrollbars();}},insertOnFinish:function(){var j=mstrmojo.all.mstrDAE.attrEditBox,f=j.inputBox,i=I(this,"bandNames"),g=this.getTokens(),h=i.getDescTokens();f.insertTokens(g);if(h){j.tabstrip.addTab();f.insertTokens(h);}},validateAndSave:function A(l,k){var j=this,i=j.ide.action,f=l.forms,g=I(this,"bandNames"),n=g.getDescTokens(),h=U.copy(n?{n:"DESC",formula:W({items:n})}:null,f[1]?{did:f[1].did}:null),m=function(p){k();j.ide.close();var o=l.did?i.onupdate:i.oncreate;if(o){o(p);}};if(n===null&&h){h.del=true;}M.call(j,j.oi,this.getTokens(),h,m);},postProcessParamsFromToken:function(j){var l=[],k,h,g=j.pars,f=(g&&g.length)||0;for(h=0;h<f;h++){k=U.copy(g[h]);k.dtp=E(k);k.n=J(k);k.isParam=true;l.push(k);}k=l[l.length-1];if(j.rpc>0){l=l.concat(this.postProcessRepeatParam(k));}return l;},postProcessRepeatParam:function c(n){var m=P(n.n),l=m.prefix,h=m.startAt||1,f=[],k,g;n.isRepeated=true;n.rpIdx=this._lastRpIdx=h;n.n=l+(h++);var j=n.items||[];if(j.length>0){n.items=[j[0]];for(g=1;g<=j.length;g++){k=U.copy(n);k.rpIdx=h;k.n=l+(h++);k.items=(g===j.length?null:[j[g]]);f.push(k);}this._lastRpIdx=k.rpIdx;}return f;},postProcessProsFromToken:function(f){var h=[],g={dfv:B.START_END,n:"ShowBandNames",desc:mstrmojo.desc(14144,"Show band names"),dtp:Q.SHOW_BAND_NAMES};if(this.oi.forms.length>1){var i=Y(d(this.oi.forms[1].ftk));U.forEach(B,function(j){if(Y(j)===i){g.v=j;return false;}});}else{if(this.oi.did!==""){g.v=B.NO;}}h.push(g);return h;}});mstrmojo.ME.BandingDAEditor.getNewDefinition=C;mstrmojo.ME.BandingDAEditor.showAsBandingEditor=Z;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Editor","mstrmojo.tooltip","mstrmojo.SearchWidget","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.BandingDAEditor","mstrmojo.ME.Enum","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(13141);var R=mstrmojo.hash,W=mstrmojo.dom,M=mstrmojo.css,Y=mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS;var D={n:mstrmojo.desc(9590,"Search Result"),did:-1,fns:[]},E={n:mstrmojo.desc(4561,"All Functions"),did:-2,fns:[]},Q={n:mstrmojo.desc(9591,"Metric Templates"),did:-3,fns:[{n:mstrmojo.desc(3273,"Level"),did:Y.Level,desc:mstrmojo.desc(9592,"Create a level metric."),h:"standard_functions_Level"},{n:mstrmojo.desc(9579,"Condition"),did:Y.Condition,desc:mstrmojo.desc(9593,"Create a conditional metric."),h:"standard_functions_condition"},{n:mstrmojo.desc(3324,"Transformation"),did:Y.Transformation,desc:mstrmojo.desc(9594,"Create a transformation metric."),h:"standard_functions_transformation"},{n:mstrmojo.desc(11656,"Row Count"),desc:mstrmojo.desc(11657,"Row Count calculates the total number of rows in the dataset."),did:Y.Row_Count,tks:{items:[{v:"Count",tp:280,oi:{n:"Count",did:"8107C31CDD9911D3B98100C04F2233EA",t:11,st:2816}},{v:"<",tp:60},{v:"Null",tp:259},{v:"=",tp:282},{v:"True",tp:299},{v:",",tp:44},{v:"UseLookupForAttributes",tp:259},{v:"=",tp:282},{v:"False",tp:300},{v:">",tp:62},{v:"(",tp:40},{v:'"*"',tp:261},{v:")",tp:41},{v:"{",tp:123},{v:"~",tp:126},{v:"}",tp:125}]}}]},G={n:mstrmojo.desc(4565,"Select a category:"),did:-4,fns:[]},F=function(Z,a){var b=Z.functionList;Z.openWizard(b.items[b.selectedIndex],a);},H=function(){return mstrmojo.hash.copy(mstrmojo.ME.ENUM.NEW_METRIC_DEFINITION);};var X=function(a){var Z="mstrmojo-ME-fct-tip",b=this.tooltip&&this.tooltip.domNode;if(b){M.toggleClass(b,Z,a);}};mstrmojo.ME.FunctionSelector=mstrmojo.declare(mstrmojo.Editor,[],{scriptClass:"mstrmojo.ME.FunctionSelector",title:mstrmojo.desc(9595,"Select a function or template"),help:"Select_a_Function_dialog_box.htm",isDME:false,functions:null,includeFakeFuncs:true,functionItems:null,selectedCategory:1,selectedIndex:-1,init:function T(Z){this._super(Z);M.addWidgetCssClass(this,"mstrmojo-FunctionSelector");},getFunctionSyntax:function L(g,b){var d=this.functionItems;if(!d){return"";}var e=d[g].fns[b];if(e.did<0){return e.n;}var Z=e.pars,j=e.pros,h=[],a,c;h.push(e.n);j=mstrmojo.hash.clone(j)||[];if(e.ios){j.push({n:"SortBy"});}if(e.sqt===5){j.push({n:"BreakBy"});}if(this.showFullSyntax){if(j.length>0){h.push("<");for(a=0,c=j.length;a<c;a++){h.push(j[a].n);h.push(", ");}h.pop();h.push(">");}}h.push("(");for(a=0,c=Z.length;a<c;a++){h.push(Z[a].n);if(a!==(c-1)){h.push(", ");}}h.push(")");return h.join("");},getFunctionDesc:function P(c,Z){var b=this.functionItems;if(!b){return"";}var a=b[c].fns[Z];return mstrmojo.ME.FunctionInfo.getDescAndExample(a).desc;},getFunctionHelpTopic:function O(c,Z){var b=this.functionItems;if(!b){return"";}var a=b[c].fns[Z];if(a.did===Y.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(a.h);},getMetricDefAsTokens:function S(){return this.getTokens();},getTokens:function K(){var a=this.functionList,Z=a.items[a.selectedIndex],b=[];if(Z){if(Z.did<-1){switch(Z.did){case -7:b=Z.tks.items;break;case -4:case -5:case -6:break;}}else{b.push({v:Z.n,oi:Z,isNew:true});}}return b;},onfunctionsChange:function V(){if(!this.functions){return ;}this.selectedCategory=0;this.set("selectedCategory",1);this.set("selectedIndex",-1);var b=mstrmojo.hash.clone(this.functions),Z=b.length;if(!b.add){b=R.make(b,mstrmojo.Arr);}if(Z>=1&&this.includeFakeFuncs){var a=b[mstrmojo.ME.MetricDataService.getBasicCategoryIndex(b)];a.fns.push(Q.fns[0]);if(!this.isDME){a.fns.push(Q.fns[1]);a.fns.push(Q.fns[2]);}else{a.fns.push(Q.fns[3]);}}this.set("functionItems",b);},onPreClose:function N(){this.cleanup();return true;},cleanup:function I(){this.searchWidget.clearSearch();this.set("selectedIndex",-1);},handleCloseAction:function C(){this.close();},clearSearchResult:function U(a){var b=this.fcHBox.fcPulldown,c=this.functionItems,Z=c.length-1;if(Z>-1&&c[Z]===D){if(this.selectedCategory===Z){if(a!==false){this.set("selectedCategory",1);this.set("selectedIndex",-1);}}c.remove(Z);b.refresh();}},clearSearchPattern:function A(){var Z=this.searchWidget;if(Z&&Z.hasRendered){Z.reset();this.clearSearchResult(false);}},openWizard:function J(c,b){var a=this,Z;if(mstrmojo.ME.MetricDataService.isBasicAggMap(c.did)||c.did<-1){Z={zIndex:a.zIndex+10,did:c.did,oi:H};Z.insertMode=false;Z.id="mstrSME";}else{Z={functions:mstrmojo.ME.MetricDataService.getFunctionCatList(),fctOi:c,zIndex:a.zIndex+10,oi:H};Z.id="mstrFE";}Z.insertMode=this.insertMode;if(Z.insertMode){Z.insertOnFinish=this.insertOnFinish;}a.switch2Editor(Z.id,Z);},handleSelectedFunction:function(Z){F(this);},onshowFullSyntaxChange:function B(){this.functionList.onchange();},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FunctionSelector-label",text:mstrmojo.desc(9925,"Functions")},{scriptClass:"mstrmojo.SearchWidget",alias:"searchWidget",cssClass:"mstrmojo-FunctionSelector-search",width:"65px",quickSearch:true,placeholderText:"",onsearch:function(g){var Z=this.parent,f=Z.fcHBox.fcPulldown,d=Z.functionItems,h=Z.functionList.itemDisplayField,e=[],a=function(j){var i=mstrmojo.hash.copy(j),l=i.n,k;try{k=new RegExp(g,"ig");}catch(m){k=new RegExp(mstrmojo.string.regEscape(g),"ig");}if(k.test(l)){i[h]=l.replace(k,function(n){return"<em>"+mstrmojo.string.encodeHtmlString(n)+"</em>";});e.push(i);}},b,c;for(b=0,c=d.length;b<c;b++){if(d[b]===D||d[b].did===E.did){continue;}if(g){mstrmojo.array.forEach(d[b].fns,a);}}D.fns=e;if(d[d.length-1]!==D){d.add([D]);}f.refresh();Z.selectedCategory=0;Z.set("selectedCategory",d.length-1);Z.set("selectedIndex",-1);},onclear:function(Z){if(Z){this.parent.clearSearchResult();}}},{scriptClass:"mstrmojo.HBox",alias:"fcHBox",cssClass:"mstrmojo-FunctionSelector-fctBox",children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",alias:"fcPulldown",itemIdField:"did",itemField:"n",items:[],bindings:{items:function(){var a=this.parent.parent.functionItems,b=[];if(!a){return a;}b=mstrmojo.ME.MetricDataService.sortFunctions(a);if(a[0].did!==E.did){var Z=E;Z.fns=b;a.unshift(Z);}return a;},selectedIndex:"this.parent.parent.selectedCategory",value:function(){var Z=this.parent.parent.selectedCategory;return this.items[Z][this.itemIdField];}},onvalueChange:function(Z){var a=this.parent.parent;a.set("selectedCategory",this.selectedIndex);a.set("selectedIndex",-1);if(Z.valueWas===D.did&&this.selectedItem.did!==D.did){this.parent.parent.clearSearchPattern();}}}]},{scriptClass:"mstrmojo.ME.FunctionList",alias:"functionList",itemIdField:"dssid",itemField:"n",itemDisplayField:"dn",items:[{n:"",cls:"wait"}],cssClass:"mstrmojo-FE-functionList mstrmojo-suggest-list",renderOnScroll:false,itemMarkupFunction:function(b,Z,a){return'<div class="mstrmojo-suggest-text '+(b.cls||"fn")+'" idx="'+Z+'"'+(b.did<0?'did="'+b.did+'"':"")+" onmouseover=\"mstrmojo.all['"+a.id+"'].onmouseover(this, event)\" onmouseout=\"mstrmojo.all['"+a.id+"'].onmouseout(this, event)\">"+((a.itemDisplayField&&b[a.itemDisplayField])||b[a.itemField])+'<div class="mstrmojo-Button mstrmojo-Editor-button mstrmojo-WebButton hot tbFunction" t="edt"><div class="mstrmojo-Button-text" t="edt">'+mstrmojo.desc(1088,"Edit")+"</div></div></div>";},bindings:{items:function(){var Z=this.parent.functionItems,a=this.parent.selectedCategory;return(Z&&Z[a].fns)||this.items;},selectedIndex:"this.parent.selectedIndex"},buffer:"",onkeypress:function(j){var i=this,g=j.e,c=g.keyCode||g.charCode,l=mstrmojo.Enum_Keys,Z=function(n){var m=(W.isIE&&!W.isIE9)?n.keyCode:n.charCode;return(m>0)?String.fromCharCode(m):"";},h=this.items,f=h.length,a=this.selectedIndex,b=function(e){i.scrollTo(e);};switch(c){case l.UP_ARROW:this.set("selectedIndex",(a+f-1)%f);break;case l.DOWN_ARROW:this.set("selectedIndex",(a+1)%f);break;default:var d=(this.buffer+=Z(g));if(f>0&&d.length>0){mstrmojo.array.forEach(h,function(n,k,e){var m=new RegExp("^"+d,"i");if(m.test(n[i.itemField])){if(k>-1){this.selectedIndex=-1;this.set("selectedIndex",k);}return false;}},this);}}if(this.selectedIndex>-1){b(this.selectedIndex);}window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){i.buffer="";},300);mstrmojo.dom.stopPropogation(j.hWin,g);return false;},onkeyup:function(Z){this.onkeypress(Z);},onchange:function(Z){var b=this.parent;if(this.selectedIndex!==b.selectedIndex){b.set("selectedIndex",this.selectedIndex);}var d=b.selectedCategory,a=b.selectedIndex,c=d>-1&&a>-1;b.set("funcSyntax",c?b.getFunctionSyntax(d,a):"");b.set("funcDesc",c?b.getFunctionDesc(d,a)+"  "+b.getFunctionHelpTopic(d,a):"");if(this.changeByMouse){if(b.selectedCategory>-1&&b.selectedIndex>-1){b.handleSelectedFunction(false);}this.changeByMouse=false;}},onmouseup:function(Z){var b=Z.getTarget(),a=b.getAttribute("t");if(a==="edt"){mstrmojo.dom.stopPropogation(Z.hWin,Z.e);mstrmojo.dom.preventDefault(Z.hWin,Z.e);this.openFunctionEditor();return false;}},openFunctionEditor:function(){var b=this.parent.parent.parent,c=b.getTokenInputBox(),Z={zIndex:b.zIndex+1,insertMode:true,oi:mstrmojo.ME.ENUM.getNewDefinition(),insertOnFinish:function(d){c.insertTokens(d);}},a=this.parent.functionList.selectedItem;if(b.isBanding&&b.isBanding(a.did)){Z={zIndex:b.zIndex+1,insertMode:true,fctOi:a,id:"mstrBDAE_1",oi:mstrmojo.ME.BandingDAEditor.getNewDefinition(),ide:b};}else{if(mstrmojo.ME.MetricDataService.isBasicAggMap(a.did)||a.did<-1){Z.candidates=c.candidates;Z.did=a.did;Z.id="mstrSME_1";Z.useGUIDefault=true;}else{Z.fctOi=a;Z.id="mstrFE_1";Z.paramItemsPath=b.feParamItemsPath;}}Z.modal=true;b.getModalEditor(Z).open(b);},ondblclick:function(Z){var b=this.getItemNodeFromTarget(Z.getTarget());if(b){var a=this.parent;if(a.selectedCategory>-1&&a.selectedIndex>-1){a.handleSelectedFunction(true);}}},useRichTooltip:false,onmouseover:function(b,i){var k=this,a=this.parent,j=a.selectedCategory,d=b.getAttribute("idx"),c=W.eventTarget(window,i),Z=c.getAttribute("t")==="edt";if((!isNaN(d)&&d>-1)||Z){window.clearTimeout(k.hideTmr);var h='<dl class="fct-info"><dt class="fct-syntax">'+a.getFunctionSyntax(j,d)+'</dt><dd class="fct-desc">'+(a.getFunctionDesc(j,d)+"  "+a.getFunctionHelpTopic(j,d))+"</dd></dl>";var l=mstrmojo.dom.position(b,true),m=function(){var o=(k.tooltip&&k.tooltip.domNode.offsetWidth+15)||200,e=l.x,r=l.y-b.offsetHeight/2,q=e<o?"left":"right",p=e<o?mstrmojo.tooltip.POS_TOPLEFT:mstrmojo.tooltip.POS_TOPRIGHT;e=e<o?l.x+l.w+8:e-10;return{arrow_css:q,contentNodeCssClass:"me-tooltip-content "+q,posType:p,left:e,top:r};},g=m(),f="hidden";k.richTooltip=Z?k.getEditBtnTooltip(c,d):{cssClass:f,contentNodeCssClass:"me-tooltip-content "+g.arrow_css,posType:g.posType,left:g.left,top:g.top,content:h,areaId:d};k.useRichTooltip=true;k.hasOpenTooltip=false;k.showTooltip();window.clearInterval(k.posTmr);var n=0;if(!k.posTmr){k.posTmr=window.setInterval(function(){if(k.tooltip){var p=k.tooltip.domNode,o=p.childNodes[1].firstChild,e=g.posType;g=m();if(g.posType!==e){p.style.left=g.left+"px";M.addClass(o,[g.arrow_css]);}window.setTimeout(function(){M.removeClass(p,f);},10);window.clearInterval(k.posTmr);delete k.posTmr;}else{if(n++>10){window.clearInterval(k.posTmr);}}},200);}X.call(this,!Z);}},getEditBtnTooltip:function(Z,a){return{posType:mstrmojo.tooltip.POS_TOPRIGHT,contentNodeCssClass:"me-tooltip-content regular up tbFunction",top:28,left:67,refNode:Z,content:mstrmojo.desc(13141,"Edit function parameters"),areaId:a};},onmouseout:function(){var Z=this;this.hideTmr=window.setTimeout(function(){X.call(Z);Z.hideTooltip();Z.useRichTooltip=false;},500);}},R.copy({slot:"buttonNode",cssText:"text-align: center; float:left;",text:mstrmojo.desc(9563,"Switch to Formula Editor"),title:mstrmojo.desc(9597,"Build a metric formula using metrics, facts, attributes and functions."),closeAfterSwitch:false,getEditor:function(){return this.parent;},postclick:function(){this.getEditor().buttonNode.style.visibility="hidden";},bindings:{visible:function(){return !this.parent.insertMode;}}},R.copy(mstrmojo.ME._MetricEditorHelper.switchRef)),{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.handleCloseAction();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo.ui._HasScroller");var D=mstrmojo.dom;mstrmojo.ME.FunctionList=mstrmojo.declare(mstrmojo.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionList",setupScrollNodes:function C(){this.scrollNode=this.itemsContainerNode;this.scrollNode.style.height=this.scrollboxNode.offsetHeight+"px";this.scrollboxNode=this.itemsContainerNode;},getItemNodeFromTarget:function B(G){var F=mstrmojo.dom.findAncestorByAttr(G,"idx",true,this.domNode);return(F&&F.node)||null;},premousedown:function A(G){this.changeByMouse=false;if(D.isPrimaryMouseBtn(G.e)){var H=this.getItemNodeFromTarget(G.getTarget()),F=H&&parseInt(H.getAttribute("idx"));if(F!==null&&!isNaN(F)&&F!==this.selectedIndex){this.domNode.tabIndex=0;this.domNode.focus();this.changeByMouse=true;}this._super(G);}},premouseup:function E(F){if(D.getButton(F.hWin,F.e)===D.MOUSE_BUTTON.LEFT){this._super(F);return true;}mstrmojo.dom.stopPropogation(F.hWin,F.e);mstrmojo.dom.preventDefault(F.hWin,F.e);return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.HBox","mstrmojo.Label","mstrmojo.MenuButton","mstrmojo.ME.FunctionSelector","mstrmojo.qb.FunctionWizard","mstrmojo.ui.Pulldown","mstrmojo.architect.EnumColumnDataTypes","mstrmojo.architect.ExpressionEditBox","mstrmojo.architect.menu.ExpressionEditorMenu","mstrmojo.architect.ui.TableColumnsList");var D="px",S=mstrmojo.array,L=mstrmojo.hash,B=mstrmojo.dom,U="mstrmojo-ar-trns-",J=mstrmojo.architect.EnumDataChangeEvents,A=mstrmojo.warehouse.EnumDataChangeEvents,I=mstrmojo.desc(1761,"Tables"),T=mstrmojo.desc(134,"Apply"),N=mstrmojo.desc(12207,"Available columns");function Q(e){var b=this,X=e.items,Y=[],c=[],W;if(X.length===0){return ;}S.forEach(X,function(f){W={tp:f.tp,n:f.cln,dt:f.dt};c.push(W);Y.push(W);});b.info.tableGroup.tableColumnsList.set("items",c);var a=b.info.expressionGroup.exprEditBox,d=a.inputBox;b.columnsCache[b.tables[b.selectedTableIndex].did]=X;b.onheightChange({value:b.height});S.forEach(b.functions,function(f){S.forEach(f.fns,function(g){Y.push(g);});});var Z={items:Y,isComplete:true};d.set("candidates",Z);a.set("iStatus","");a.set("vStatus",0);}function F(f){var a=this,b=a.info.tableGroup.tableslist,d=a.info.tableGroup.tableColumnsList,Z=mstrApp.rootController,h=f.value.table,e=a.info.expressionGroup.exprEditBox.inputBox,W=f.source||0,X=f.value.attribute.id,c=f.value.attribute.n,Y;if(W!==0){return ;}this.transformationInfo=f.value;this.parent.set("title","");if(X){Z.getTransformationTables(X,{success:function g(i){Y=Z.getAttribute(X);a.parent.set("title",(Y&&Y.name)||c);a.tables=i.tables;var j=Math.max(S.find(a.tables,"did",h.id),0);a.selectedTableIndex=-1;b.set("items",a.tables);b.list.set("items",a.tables);b.set("selectedIndex",j);}});}else{b.set("items",[]);b.render();d.set("items",[]);d.render();}e.clearTokens();Z.tokenizeExpression((f.value.expression||""),h.id,{success:function g(i){if(i){mstrApp.getRootController().trimTokenEnds(i.tkn);e.set("items",i.tkn);}a.onheightChange({value:a.height});}});}mstrmojo.architect.ui.editors.TransformationEditor=mstrmojo.declare(mstrmojo.Box,[mstrmojo._IsPopup,mstrmojo._HasPopup],{scriptClass:"mstrmojo.architect.ui.editors.TransformationEditor",cssClass:U+"Editor",init:function O(Z){this._super(Z);var Y=this,W=mstrApp.getRootController(),a={},X=a[this.id]={};X[J.TRANSFORMATION_SELECTED]=F;X[A.DBTABLES_CHANGED]=function b(){var d=Y.info.tableGroup.tableslist,f,e=d.selectedIndex;if((e!==undefined)&&(e>=0)){f=W.getTable(Y.tables[e].did);W.populateTableContents(f.id,{success:function g(){Q.call(Y,{items:L.valarray(f.columns)});}});}};W.attachDataChangeListeners(a);W.loadFunctions({success:function c(){Y.functions=W.getFunctions();}});this.info.expressionGroup.exprEditBox.inputBox.customFunctionMode=false;},transformationInfo:undefined,functions:[],title:"",functionSelector:{scriptClass:"mstrmojo.ME.FunctionSelector"},wizard:{scriptClass:"mstrmojo.qb.FunctionWizard"},exprEditBox:undefined,bottombox:undefined,applyButton:undefined,tableslist:undefined,tableColumnsList:undefined,expressionGroup:undefined,tableGroup:undefined,insertBtn:undefined,expGroupLabel:undefined,model:undefined,selectedTableIndex:undefined,tables:[],columnsCache:{},onheightChange:function G(W){var b=this.info,Y=parseInt(W.value,10),c=Y-(this.applyButton.domNode?B.position(this.applyButton.domNode).h:0)-5,X=c-15,a=X-75,Z=X-24;this.height=Y+D;if(!this.hasRendered){return ;}this.domNode.style.height=this.height;b.domNode.style.height=c+D;b.tableGroup.domNode.style.height=X+D;b.expressionGroup.domNode.style.height=X+D;b.tableGroup.tableColumnsList.domNode.style.height=a+D;b.expressionGroup.exprEditBox.domNode.style.height=Z+D;b.expressionGroup.exprEditBox.inputBox.domNode.style.height=(Z-26)+D;},onwidthChange:function H(X){var a=this.info,W=parseInt(X.value,10);this.width=W+D;if(!this.hasRendered){return ;}var Y=(B.position(a.expressionGroup.toolbar.insertBtn.domNode).w),Z=(W-B.position(a.tableGroup.domNode).w-40);a.expressionGroup.domNode.style.width=Z+D;a.expressionGroup.toolbar.expGroupLabel.domNode.style.width=(Z-(2*Y)-10)+D;},showFunctionSelector:function R(){var X=this;X.openPopup("functionSelector",{functions:X.functions,zIndex:this.zIndex+10,openWizard:function W(Y){X.showWizard(Y);}});},showWizard:function K(Y){var W=this.info.expressionGroup.exprEditBox.inputBox,Z=this;Z.openPopup("wizard",{fctOi:Y,zIndex:Z.zIndex+10,insertOnFinish:function X(a){W.insertTokens(a);}});},onRender:function C(){this._super();this.onheightChange({value:this.height});this.onwidthChange({value:this.width});var W=this.info.tableGroup.tableslist.selectedIndex;if((W!==undefined)&&(W>=0)){this.info.tableGroup.tableslist.selectedNode.innerHTML=this.info.tableGroup.tableslist.items[W].n;}},children:[{scriptClass:"mstrmojo.HBox",cssClass:U+"content",alias:"info",children:[{scriptClass:"mstrmojo.Box",cssClass:U+"tableGroup",alias:"tableGroup",children:[{scriptClass:"mstrmojo.Label",cssClass:U+"tableGroupLabel",text:I+":"},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:U+"tableGroupPullDown",alias:"tableslist",postBuildRendering:function P(){this.list.getItemMarkup=function(){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@n}">{@n}</{@tag}>';};},onitemsChange:function M(W){if(W.value.length===0){this.selectedIndex=-1;Q.call(this.parent,{items:[]});}},onitemSelected:function E(a){var Y=this.parent.parent.parent,b=this.selectedNode;if(this.selectedIndex===Y.selectedTableIndex){return ;}Y.selectedTableIndex=this.selectedIndex;var X=a.did,W=mstrApp.rootController;if(Y.columnsCache[X]){Q.call(Y,{items:Y.columnsCache[X]});}else{W.populateTableContents(a.did,{success:function Z(){W.model.raiseEvent({name:J.TABLE_LOADED,columns:W.getTable(a.did).columns});}});}if(b.offsetWidth<b.scrollWidth){this.selectedNode.title=a.n;}}},{scriptClass:"mstrmojo.Label",cssClass:U+"tableGroupLabel",text:N+":"},{scriptClass:"mstrmojo.architect.ui.TableColumnsList",cssClass:U+"colList",alias:"tableColumnsList"}]},{scriptClass:"mstrmojo.Box",cssClass:U+"expressionGroup",alias:"expressionGroup",children:[{scriptClass:"mstrmojo.HBox",alias:"toolbar",children:[{scriptClass:"mstrmojo.Label",cssClass:U+"expGroupLabel",alias:"expGroupLabel",text:mstrmojo.desc(4449,"Expression")+":"},{scriptClass:"mstrmojo.MenuButton",cssClass:U+"actionButtons",iconClass:"tbInsert",alias:"insertBtn",title:mstrmojo.desc(2919,"Insert"),onclick:function V(){var X=this.parent.parent.parent.parent;var W=X.linkMenu;if(!W){W=X.linkMenu=new mstrmojo.architect.menu.ExpressionEditorMenu({zIndex:60});}W.target=X;W.domNode=this.domNode;W.showContextMenu();}},{scriptClass:"mstrmojo.Button",cssClass:U+"actionButtons",title:mstrmojo.desc(2827,"Clear"),iconClass:"tbClear",onclick:function(){var W=this.parent.parent.parent.parent;W.info.expressionGroup.exprEditBox.inputBox.clearTokens([]);W.onheightChange({value:W.height});}}]},{scriptClass:"mstrmojo.architect.ExpressionEditBox",cssClass:U+"exprEditBox",alias:"exprEditBox",dropZone:true}]}]},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button "+U+"applybutton",alias:"applyButton",text:T,enabled:true,onclick:function(){var Y=this.parent,X=mstrApp.getRootController(),c=Y.transformationInfo,W=Y.info.tableGroup.tableslist.selectedIndex,b,a=[],Z;if(W>=0){b={id:Y.info.tableGroup.tableslist.items[W].did,n:Y.info.tableGroup.tableslist.items[W].n};S.forEach(Y.info.expressionGroup.exprEditBox.inputBox.items,function(e){a.push(e.v);});Z=a.join(" ").replace(/<\s/g,"<").replace(/>\s/g,">");X.validateExpr({expr:Z,tid:b.id,vo:1},{success:function d(){Y.info.expressionGroup.exprEditBox.set("vStatus",0);Y.info.expressionGroup.exprEditBox.markupMethods.onvStatusChange.call(Y.info.expressionGroup.exprEditBox);Y.onheightChange({value:Y.height});X.addTransformationElement(c.id,c.attribute.id,Z,b.id,c.attribute.n,b.n,1);}});}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.HBox","mstrmojo.Label","mstrmojo.MenuButton","mstrmojo.architect.ExpressionEditBox","mstrmojo.architect.EnumColumnDataTypes","mstrmojo.architect.menu.ExpressionEditorMenu","mstrmojo.ME.FunctionSelector","mstrmojo.qb.FunctionWizard","mstrmojo.ui.Pulldown");var G,E=mstrmojo.array,D=mstrmojo.hash;function A(N){var M=[];E.forEach(N,function(O){M.push(O.v);});return M.join(" ").replace(/<\s/g,"<").replace(/>\s/g,">");}function H(O){var M=this;M.validationFunc({expr:A(M.exprEditBox.inputBox.items),tid:M.oi.tbl.did,vo:1},{success:function N(P){if(P&&P.mi.oi.tknstrm.mi){mstrApp.getRootController().trimTokenEnds(P.mi.oi.tknstrm.mi.tkn);M.exprEditBox.handleValidation(P.mi.oi);if(!P.mi.reject_error_code&&O&&O.success){O.success();}else{if(O&&O.failure){O.failure(P);}}}}});}function L(M){var O=this,N=this.bottombox.optionsBox;O.dtChanged=true;N.removeChildren(null,true);E.forEach(M.options,function(Q,P){N.addChildren([new mstrmojo.Label({cssClass:"mstrmojo-architect-ExpressionEditBox-option",text:Q.txt})]);N.addChildren([new mstrmojo.TextBox({cssClass:"mstrmojo-architect-ExpressionEditBox-optiontxt",alias:"opt"+P,type:"number",min:0,value:0,onvalueChange:function(){O.dtChanged=true;},postCreate:function(){if(O.expressionColumn){this.set("value",O.expressionColumn.dt[Q.field]);}}})]);});}mstrmojo.architect.ExpressionEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ExpressionEditor",cssClass:"mstrmojo-architect-ExpressionEditor",zIndex:50,id:"ExpressionEditor",suggestedItems:[],functions:[],tokens:[],title:"",functionSelector:{scriptClass:"mstrmojo.ME.FunctionSelector"},wizard:{scriptClass:"mstrmojo.qb.FunctionWizard"},exprEditBox:undefined,bottombox:undefined,datatypelist:undefined,optionsBox:undefined,opt0:undefined,opt1:undefined,originalDTIndex:undefined,expressionColumn:undefined,columnInTable:false,dtChanged:false,model:undefined,onOpen:function C(){var T=this,O=this.oi,S=this.exprEditBox,M=S.inputBox,P;M.customFunctionMode=false;O.isSave=false;T.suggestedItems=[];T.expressionColumn=undefined;T.columnInTable=false;if(O.objectForExpression){P=O.objectForExpression.columnId;}E.forEach(O.tbl.clns,function(U){T.suggestedItems.push(U);if(P===U.cmid){T.expressionColumn=U;T.columnInTable=true;}});if(!T.expressionColumn&&T.model.columns[P]){T.expressionColumn=T.model.columns[P];}E.forEach(this.functions,function(U){E.forEach(U.fns,function(V){T.suggestedItems.push(V);});});var R={items:T.suggestedItems,isComplete:true};M.set("candidates",R);T.set("candidates",R);S.set("iStatus","");S.set("vStatus",0);if(O&&O.tokens){mstrApp.getRootController().trimTokenEnds(O.tokens);M.set("items",O.tokens);}var N=[],Q=T.bottombox.datatypelist;if(T.oi.isNew){N.push({id:0,n:" Auto Detect"});}D.forEach(mstrmojo.architect.EnumColumnDataTypes,function(U){N.push(U);});N.sort(function(V,U){return V.n.toUpperCase().localeCompare(U.n.toUpperCase());});Q.set("items",N);if(!this.expressionColumn&&P){this.expressionColumn=mstrApp.getRootController().getColumns()[P];}if(T.expressionColumn){T.originalDTIndex=E.find(T.bottombox.datatypelist.items,"id",T.expressionColumn.dt.tp);Q.set("selectedIndex",T.originalDTIndex);}else{Q.set("selectedIndex",0);}T.dtChanged=false;},showFunctionSelector:function I(){var N=this;N.openPopup("functionSelector",{functions:this.functions,zIndex:this.zIndex+10,openWizard:function M(O){N.showWizard(O);}});},showWizard:function F(O){var M=this.exprEditBox.inputBox,P=this;P.openPopup("wizard",{fctOi:O,zIndex:P.zIndex+10,insertOnFinish:function N(Q){M.insertTokens(Q);}});},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-toolBox toolbar",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Editor-toolBox expLabel",text:mstrmojo.desc(4449,"Expression")+":"},{scriptClass:"mstrmojo.MenuButton",iconClass:"tbInsert",title:mstrmojo.desc(2919,"Insert"),onclick:function K(){G.showPopupMenu(this.parent.parent,this.domNode);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(9110,"Syntax Validation"),iconClass:"tbValidate",onclick:function(){H.call(this.parent.parent,null);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(2827,"Clear"),iconClass:"tbClear",onclick:function(){var M=this.parent.parent;M.oi.tokens=[];M.exprEditBox.inputBox.clearTokens([]);}}]},{scriptClass:"mstrmojo.architect.ExpressionEditBox",alias:"exprEditBox"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-architect-ExpressionEditBox-bottombox",alias:"bottombox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-architect-ExpressionEditBox-dt",text:mstrmojo.desc(9918,"data type")+":"},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-architect-ExpressionEditBox-dtlist",alias:"datatypelist",onitemSelected:function B(M){L.call(this.parent.parent,M);}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-architect-ExpressionEditBox-optionsbox",alias:"optionsBox"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-architect-ExpressionEditBox-buttonbox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(5891,"Save"),onclick:function K(){var O=this.parent.parent.parent,N=O.oi;N.isSave=(O.exprEditBox.inputBox.itemsContainerNode.textContent!=="");if(N.isSave){H.call(O,{success:function P(){O.callBackFunction({expression:A(O.exprEditBox.inputBox.items),selItem:O.bottombox.datatypelist.items[O.bottombox.datatypelist.selectedIndex],precision:parseInt((O.bottombox.optionsBox.opt0&&O.bottombox.optionsBox.opt0.value)||"0",10),scale:parseInt((O.bottombox.optionsBox.opt1&&O.bottombox.optionsBox.opt1.value)||"0",10),dtChanged:O.dtChanged,expressionColumn:O.expressionColumn,needsNewCol:(O.columnInTable||!O.expressionColumn)&&!(!O.dtChanged||(O.bottombox.datatypelist.selectedIndex===0)),tblId:O.oi.tbl.did});O.close();},failure:function M(){N.isSave=false;}});}}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var M=this.parent.parent.parent;M.close();}}]}]}]});G=mstrmojo.architect.ExpressionEditor;G.showPopupMenu=function J(O,N){var M=G.linkMenu;if(!M){M=G.linkMenu=new mstrmojo.architect.menu.ExpressionEditorMenu({zIndex:60});}M.target=O;M.domNode=N;M.showContextMenu();};}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.WHModel","mstrmojo.hash","mstrmojo.array","mstrmojo.func","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.ExpressionEditor","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.architect.obj.Layer","mstrmojo.architect.obj.UserHierarchy","mstrmojo.architect.obj.Relationship","mstrmojo.architect.obj.SystemDimension","mstrmojo.architect.obj.Table","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.obj.DBRole");var Cs=mstrmojo,Cw=Cs.hash,C3=Cs.array,BK=Cs.func.wrapMethods,BN=mstrmojo.architect.menu.EnumMenuActions,Bx=1,F=2,A3=3,E=4,AF=5,DM=6,BI=7,c=8,Ab=10,Cv=11,Ap=12,Bf=13,A8=14,Al=15,t=16,f=17,Cq=22,Aj=23,AJ=25,BF=27,K=1030,BC=31,V=32,q=41,AK=42,Bu=43,Cz=1031,v=mstrmojo.warehouse.EnumObjectTypes,p=v.METRIC,BJ=v.ATTRIBUTE,D=v.FACT,C4=v.TABLE,AH=v.COLUMN,B7=v.FORM,CL=v.COMPOUND_FORM,DL=v.RELATIONSHIP,DH=v.TRANSFORMATION,DR=v.LAYER,B6=v.DIMENSION,DS=v.RELATIONSHIP_ATTRIBUTE,Be=1,P=2,A4=3,H=2,By=Cs.architect.ui.EnumViewTypes,B2=By.LAYER,BA=By.SYS_HIERARCHY,AY=By.USER_HIERARCHY,C2=By.TRANSFORMATION,BT=1,Bl=2,Bm=BT+Bl,BE="None",A=Cs.desc(13290,"You have unsaved changes"),AR=Cs.desc(11916,"Alias"),CB=Cs.desc(13291,"Only Attributes with a single form can be converted to facts"),N=Cs.desc(13292,"Already have the attributes on this table!"),A5=mstrmojo.warehouse.EnumDataChangeEvents,Bs=A5.DBTABLES_USED,CR=mstrmojo.architect.EnumDataChangeEvents,DA=CR.TABLES_ADDED,CJ=CR.TABLES_LOADED,Cn=CR.TABLES_CHANGED,Au=CR.LAYER_CHANGE,U=CR.LAYER_TABLE_CHANGED,Cy=CR.DBROLE_CHANGED,BY=CR.RENAME,BD=CR.REMOVE,e=CR.RELATIONSHIP_CHANGED,Bq=CR.LOGICALVIEWS_CHANGED,Az=CR.TRANSFORMATIONS_CHANGED,Av=CR.TRANSFORMATION_UPDATED,X=CR.ATTRIBUTES_CHANGED,Ao=CR.USER_HIERARCHY_LOADED,Bh=CR.USER_HIERARCHY_CHANGED,j="3585",b="3585,3587";function BX(){var DT=this;if(!DT.sysDimension){DT.sysDimension=new mstrmojo.architect.obj.SystemDimension({mdl:DT});}else{DT.sysDimension.reset();}return DT.sysDimension;}function C(){switch(this.currentView){case B2:return this.layers[this.currentlayerID];case BA:return this.sysDimension;case AY:return this.userHierarchies[this.currentHierarchyID];}return null;}function CT(DT){return{Sum:"12",Count:"13",Avg:"14",Min:"15",Max:"16",Variance:"33"}[DT];}function CW(DU,DV,DT){return"<schm smt='1'><oi tp='4'  n='"+DU+"'><def><fun fnt='"+CT(DV)+"'/><fc did='"+DT.id+"'/></def></oi></schm>";}function CX(){var DU=this,DV="",DT={count:{name:"Count of ",fn:"Count"},average:{name:"Avg of ",fn:"Avg"},variance:{name:"Variance of ",fn:"Variance"},min:{name:"Min of ",fn:"Min"},max:{name:"Max of ",fn:"Max"},sum:{name:"Sum of ",fn:"Sum"}};Cw.forEach(DU.facts,function(DW){if(DW.isNew){DW.isNew=false;Cw.forEach(DT,function(DX,DY){if(DW[DY]){DV=(DV||"")+CW(DX.name+DW.name,DX.fn,DW);}});}});return DV;}function J(DW,DV){var DT=false,DU=false;if(DV.did==="None"){DT=true;Cw.forEach(this.basicForms,function(DX){DU=(DX.id===DW);return !DU;});}return(DT&&!DU)?true:DV.did===DW;}function Ag(DV){var DT=((this.currentlayerID!=="")&&(this.currentView===B2)),DU=false;return(DV===BN.NONE||DV===BN.DELETE||DV===BN.RENAME||DV===BN.SAMPLE_DATA||((DV===BN.NEW_FACT)&&DT)||((DV===BN.NEW_ATTR)&&DT)||((DV===BN.AUTOMAP)&&DT)||DV===BN.REMOVE_TABLE||DV===BN.SHOW_UNUSED_COLUMNS||DV===BN.ADD_TO_LAYER||DV===BN.REMOVE_FROM_LAYER||DV===BN.DATA_SOURCES||DV===BN.UPSTRUCT||DV===BN.CREATE_ALIAS||DV===BN.LOGICAL_TABLE_SIZE||((DV===BN.ADD_TO_PROJECT)&&!DU));}function m(DU){var DT=((this.currentlayerID!=="")&&(this.currentView===B2));return(DU===BN.NONE||((DU===BN.ADD_ATTRIBUTE)&&DT)||((DU===BN.ADD_FACT)&&DT));}function CH(DV,DU){var DT=this;return((DV===BN.DELETE_RELATIONSHIP&&DT.hasRelation(DU)));}function o(DT){return(DT==="00000000000000000000000000000000")?this.projPrimaryDBRoleID:DT;}function Ck(DZ,DT){var DY=DT.action,Da=this,DU=this.tableMenuContext,Dc=((DT.context||Bm)&DU)===DU,Dd=!DZ.length,DW=Dd?DZ.did:"",Dh=Dd?Da.getTable(DW):null,Db=((this.currentlayerID!=="")&&(this.currentView===B2)),De=false,Dg=Dd?Da.tableIsInLayer(DW):true,DV=true,DX=true,Df=true;if(!Dc){return false;}if(!Dd){Cw.forEach(DZ,function(Di){De=De||Da.tableIsInLayer(Di.did);Dg=Dg&&Da.tableIsInLayer(Di.did);Dh=Da.getTable(Di.did);if(Dh){DX=DX&&(Dh.columnDisplay===Dh.EnumColumnDisplay.None);DV=DV&&(Dh.columnDisplay===Dh.EnumColumnDisplay.Unused);Df=Df&&(!Dh.isView);}});}else{Df=(!DZ.isView);}return(DY===BN.NONE||DY===BN.DELETE||(DY===BN.RENAME&&Dd)||(DY===BN.UPSTRUCT&&Df)||DY===BN.ADD_TO_PROJECT||(DY===BN.CREATE_ALIAS)||(DY===BN.SAMPLE_DATA&&Dd)||(DY===BN.NEW_FACT&&Dd)||(DY===BN.NEW_ATTR&&Dd)||DY===BN.AUTOMAP||(DY===BN.REMOVE_TABLE&&Dd)||((DY===BN.DATA_SOURCES)&&Dd&&(Dh.secondaryDBRoles.length>0))||((DY===BN.SHOW_UNUSED_COLUMNS)&&(Dd||DX||DV))||((DY===BN.ADD_TO_LAYER)&&Db&&!De&&!Dg)||DY===BN.LOGICAL_TABLE_SIZE||((DY===BN.REMOVE_FROM_LAYER)&&Db&&Dg));}function CO(DU){var DV=DU.action,DT=this,DW=true;if(DV===BN.ONE_TO_ONE||DV===BN.ONE_TO_MANY||DV===BN.MANY_TO_MANY||DV===BN.RELATIONSHIP_TABLE||DV===BN.ADD_JOIN_CHILDREN){DW=(DT.currentView===BA||DT.currentView===B2);}return DW;}function B0(DX,DV){var DU=this,DY=(DU.currentView===AY),DT=DY?DU.userHierarchies[DU.currentHierarchyID].entryPoints:undefined,DW=!!(DY&&(C3.find(DT,"atid",DX.attributeId)!==-1));switch(DV.action){case BN.REL_ATTR_ELEMENT_DISPLAY:case BN.ATTRIBUTE_FILTERS:case BN.BROWSE_ATTRIBUTES:case BN.REL_ATTR_ELEMENT_LIMIT:case BN.REL_ATTR_ELEMENT_UNLOCK:case BN.REL_ATTR_ELEMENT_LOCK:return DY;case BN.SET_ENTRY_POINT:return(DY&&!DW);case BN.REMOVE_ENTRY_POINT:return(DY&&DW);default:return true;}}function BZ(DU,DT){return(DU===BN.NONE||DU===BN.DELETE||DU===BN.RENAME||DU===BN.CONVERT_FACT_TO_ATTR||DU===BN.UPDATE_AGGR||DU===BN.EDIT||(DU===BN.REMOVE_FROM_TABLE&&Object.keys(DT.tables).length>1)||(DU===BN.AGGREGATION&&DT.isNew)||DU===BN.LINKS);}function Ce(DU,DT){return(DU===BN.NONE||DU===BN.DELETE||DU===BN.RENAME||DU===BN.CONVERT_ATTR_TO_FACT||((DU===BN.CONVERT_ATTR_TO_FORM)&&(Object.keys(DT.forms).length===1))||DU===BN.SET_AS_FORM||DU===BN.UPDATE_FORMAT||(DU===BN.REMOVE_FROM_TABLE&&Object.keys(DT.tables).length>1));}function w(DU,DT){return(DU===BN.NONE||DU===BN.ADD_ATTRIBUTE||DU===BN.ADD_FACT||DU===BN.COLUMN_DEF||((DU===BN.CONVERT_COLUMN_TO_FORM)&&(mstrApp.getRootController().getSameTableAttributes(DT).length>0)));}function AO(DY,DX,DV){var DU=false,DT=this,DW=Object.keys(DX.forms).length;if(DY===BN.UNGROUP_FORM||DY===BN.GROUP_FORM||(DY===BN.UPDATE_GROUP)||(DY===BN.FORM_CATEGORY)||(DY===BN.UPDATE_CATEGORY)){DU=DX.isCompound(DV);}return(DY===BN.EDIT||DY===BN.NONE||DY===BN.RENAME||DY===BN.REMOVE_FROM_TABLE||DY===BN.DATA_TYPE||DY===BN.SET_AS_LOOKUP||DY===BN.UPDATE_FORMAT||(DY===BN.SET_AS_MULTILINGUAL&&((parseInt(DV,10)>0))&&DT.multiLingualEnabled)||(DY===BN.DELETE&&((parseInt(DV,10)>0)||(DW>1)))||DY===BN.LINKS||(DY===BN.FORM_CATEGORY&&!DU)||(DY===BN.UPDATE_CATEGORY&&!DU)||(DY===BN.UNGROUP_FORM&&DU)||(DY===BN.GROUP_FORM&&!DU&&DW>1)||(DY===BN.UPDATE_GROUP&&!DU));}function Bg(DT){return(DT===BN.NONE||DT===BN.UNGROUP_FORMS||(DT===BN.FORM_CATEGORY)||(DT===BN.UPDATE_CATEGORY));}function DQ(DT){var DU=DT.action;switch(DU){case BN.REL_ATTR_ELEMENT_LIMIT:return false;case BN.REL_ATTR_ELEMENT_UNLOCK:return false;case BN.REL_ATTR_ELEMENT_LOCK:return false;default:return false;}}function Bt(DV,DU){var DT=this.getFact(DV.did);switch(DU.n){case"Sum":return DT.sum;case"Count":return DT.count;case"Max":return DT.max;case"Min":return DT.min;case"Variance":return DT.variance;case"Average":return DT.average;}return false;}function Aw(DU,DT){var DV=this.getRelation(DU.parentAttributeId,DU.childAttributeId);switch(DT.action){case BN.ONE_TO_ONE:return DV.relationType===1;case BN.ONE_TO_MANY:return DV.relationType===2;case BN.MANY_TO_MANY:return DV.relationType===4;case BN.RELATIONSHIP_TABLE_ENTRY:return DT.checked;case BN.ADD_JOIN_CHILDREN:return false;}return false;}function CU(DX,DW){var DT=!DX.length,DV,DY=true,DU=this;switch(DW){case BN.SHOW_UNUSED_COLUMNS:if(!DT){C3.forEach(DX,function(DZ){DV=DU.getTable(DZ.did);DY=DY&&(DV.columnDisplay===DV.EnumColumnDisplay.Unused);});}else{DV=this.getTable(DX.did);DY=(DV.columnDisplay===DV.EnumColumnDisplay.Unused);}return DY;}return false;}function Ai(DW,DT){var DV=(DW.tp===BJ)?this.getAttribute(DW.did):this.getAttribute(DW.sid),DU=DV.forms[DW.bfIdx];if(DT.baseFormType){return DU.baseFormType===DT.baseFormType;}switch(DT.action){case BN.SET_AS_LOOKUP:return DU.tableId===DW.pdid;case BN.SET_AS_MULTILINGUAL:return DU.isMultiLingual;case BN.UPDATE_CATEGORY:return J.call(this,DU.categoryId,DT);}return false;}function Cu(DV,DT){var DU=this.transformations[DV.did];switch(DT.action){case BN.TX_ONE_TO_ONE:return DU.onetoOneMappingType===true;case BN.TX_MANY_TO_MANY:return DU.onetoOneMappingType===false;case BN.TX_APPLY_TO_ALL:return DU.transformationAllAttributes===true;case BN.TX_APPLY_TO_HIGHEST:return DU.transformationAllAttributes===false;}return false;}function C5(DU,DT){switch(DT.action){case BN.UPDATE_CATEGORY:return J.call(this,DU.fcatId,DT);}return false;}function BB(DV,DU,DT){mstrApp.getRootController().getDataService()[DT||"submitRequest"](DV,DU);}mstrmojo.architect.ArchitectModel=mstrmojo.declare(mstrmojo.warehouse.WHModel,null,{scriptClass:"mstrmojo.architect.ArchitectModel",attributes:{},facts:{},formCategories:{},basicForms:{},layers:{},transformations:{},tables:{},logicalViews:{},userHierarchies:{},dbRoleTables:{},columns:{},prjdbrs:[],PrjTblDbr:null,projPrimaryDBRoleID:"",currentlayerID:"",currentHierarchyID:"",currentTransformationId:"",currentLogicalViewID:"",forceReloadLayer:false,autoMap:false,askAutoMap:true,initialized:false,functions:undefined,sysDimension:undefined,currentView:B2,targetView:B2,statusStack:[],statusCount:0,statusIndex:0,tryQS:1,tableMenuContext:0,isDirty:false,schemaInstanceHasChanged:function AS(DT){var DX=window.localStorage,DW=(DX&&DX.getItem("isDebug")),DV=(!(DW&&(DW==="1"))),DU=mstrApp.rootController.model;if(DV&&DU.isDirty){DT.returnValue=A;}},onCloseArchitect:function DN(){BB({success:mstrmojo.emptyFn()},{schemaaction:3,showWait:true},"schemaAction");},tableIsInLayer:function AX(DU){var DT=this;return((DT.currentlayerID!=="")&&DT.getLayer(DT.currentlayerID)&&(!!DT.getLayer(DT.currentlayerID).tables[DU]));},getFormCount:function An(DT){var DU=this,DW=0,DV=DU.getAttribute(DT);Cw.forEach(DV.forms,function(){DW++;});return DW;},setTableMenuContext:function Cp(DT){this.tableMenuContext=DT;},getNewValidName:function B(DV,DT){var DU=this,DW,DX;switch(DV){case BJ:DW=DU.getAttributes();break;case D:DW=DU.getFacts();break;case C4:DW=DU.getTables();break;}DX=Cw.valarray(DW);return DU.findNextName(DT,DX,"name");},findColumnName:function Ay(DT){return(DT.substring(0,DT.indexOf(":"))!=="")?DT.substring(0,DT.indexOf(":")):DT;},populateFormCategories:function DO(){var DT=this,DU,DX,DW;BB({success:function DV(DZ){var DY=DZ.oi;Cw.forEach(DY,function(Da){if(Da.did!=="A9BFF03B4D72CC4F457ACBB4B185E91D"){DX=Da.n;DW=Da.did;DU=new mstrmojo.architect.obj.Form({isNew:false,id:DW,category:DX,useName:DX,useDescription:DX,isBrowseForm:true,isTemplateForm:true,tableId:""});if(Da.stp===5377){DT.basicForms[DU.useName]=DU;}DT.formCategories[DU.id]=DU;}});DT.basicForms[BE]=new mstrmojo.architect.obj.Form({isNew:false,id:BE,category:BE,useName:BE,useDescription:BE,isBrowseForm:true,isTemplateForm:true,tableId:""});}},{objecttypes:B7},"search");},getCategoryAtIndex:function Cf(DT){var DW=this,DU=DW.formCategories,DV=0,DX=null,DY=(DT<2)?[DW.basicForms.ID.id,DW.basicForms.DESC.id][DT]:"";if(DY===""){if(Object.keys(DU).length>DT){Cw.forEach(DU,function(DZ){DV++;if(DV===DT){DX=DZ;return false;}return true;});DY=DX.id;}}DX=DW.formCategories[DY];return DX;},categoryIdUsedByAttribute:function BO(DW,DX){var DT=this,DV=DT.getAttribute(DW),DU;Cw.forEach(DV.forms,function(DY){if(DY.categoryId===DX){DU=DY;return false;}return true;});return(DU!==undefined);},categoryNameUsedByAttribute:function AU(DW,DX){var DT=this,DV=DT.getAttribute(DW),DU;Cw.forEach(DV.forms,function(DY){if(DY.catn===DX){DU=DY;return false;}return true;});return(DU!==undefined);},getReadableExpression:function As(DU){var DT=DU.replace("[","");DT=DT.replace("]","");return DT;},addNextAvailableForm:function AG(Dc,DW,DT,Db,Dd){var DZ=this,DV=DZ.getAttribute(Dc),Da=DZ.getFormCount(Dc),DY=DZ.basicForms,DU=null,DX="";Cw.forEach(DY,function(De){if(De.useName!==BE){if(!DZ.categoryIdUsedByAttribute(Dc,De.id)){DU=De;DX=De.id;return false;}}return true;});if(DU){DV.addForm(true,DX+Dc,Da,DX,DW,DT,Db,"3","3",true,3,DU.useName,DU.useDescription,true,true,DU.catn,Dd);}else{DZ.addNoneForm(Dc,DW,DT,Db,Dd);}},addNoneForm:function DB(Dd,DW,DT,Dc,De){var DY=this,DV=DY.getAttribute(Dd),Db=DY.getFormCount(Dd),Da,DZ=DY.getReadableExpression(Dc),DU,DX="";Da=Db;while(DY.categoryNameUsedByAttribute(Dd,DV.name+Da)===true){Da++;}DU={category:DV.name+Da,id:Dd+Da,isBrowseForm:true,isNew:false,isTemplateForm:true,tableId:"",useDescription:DZ,useName:DZ,catn:DV.name+Da};DV.addForm(true,DX+Dd,Db,DX,DW,DT,Dc,"3","3",true,3,DU.useName,DU.useDescription,true,true,DU.catn,De);},addAttributeForm:function Ci(Dj,Dl,Db,Dc,DT,Dh,Df,Da,DV,Dk,DY,Dd,DU,DW,De,Di,DZ){var DX=this,Dg=DX.getAttribute(Dj);Dg.addForm(Dl,Db+Dj,Dc,Db,Df,DT,Dh,Da,DV,Dk,DY,DW,De,Dd,DU,Di,DZ);},updateAttributeForm:function DK(DV,DX,DW){var DT=this,DU=DT.getAttribute(DV);DU.forms[DX].update(DW);},updateFormFormat:function Ch(DY,DU){var DT=this,DX=DY.sid,DZ=DY.bfIdx,DW=DT.getAttribute(DX),DV=DW.forms[DY.bfIdx];if((DU.baseFormType)&&(DV.baseFormType!==DU.baseFormType)){DV.baseFormType=DU.baseFormType;DT.updateAttributeForm(DX,DZ,null);}},updateFormCategory:function k(DY,DT){var DZ=this,Da=DY.sid,DW=this.getAttribute(Da),DV=DW.forms[DY.bfIdx],DX={success:function Db(){DV.categoryId=DT.did;},complete:function DU(){DV.newCatId=undefined;}};DV.newCatId=DT.did;if(DT.did===BE){DV.newCatId="";DV.useName=DV.expression;DV.useDescription=DV.expression;}if(DY.items){DZ.submitRequest(DX,{manipulationtype:A8,objectid:Da,formcatid:DY.fcatId,tableids:DV.tableId,newformcatid:DV.newCatId||"",showWait:true},"schemaManipulation");}else{this.updateAttributeForm(Da,DY.bfIdx,DX);}},unGroupForms:function Cx(DX,DT){var DZ=this,DU=(DT.action===BN.UNGROUP_FORMS),Da=DX.sid,DY=DZ.getAttribute(Da),DW=(DU?DX.fcatId:DX.did.substring(32,64)),Db=(DU?"":DX.fcatId),DV=(DU?AK:Bu),De=DZ.getTable(DX.pdid),Dd="";this.submitRequest({success:function Dc(){var Di=C3.find(DY.formGroups,"catID",DW),Dg=DY.formGroups[Di],Df;if(DU||Dg.fms.length<3){C3.removeIndices(DY.formGroups,Di,1);}else{Df=C3.find(Dg.fms,"did",Db);C3.removeIndices(Dg.fms,Df,1);}Cw.forEach(DY.tables,function(Dj){De=DZ.getTable(Dj.id);Dd+=Dj.id+",";De.reset();});DZ.getAttributesFactsInTable(Dd,{success:function Dh(){Cw.forEach(DY.tables,function(Dj){De=DZ.getTable(Dj.id);DZ.raiseTableChangeEvent(De);});}});}},{manipulationtype:DV,objectid:Da,objectid2:DW,objectid3:Db},"schemaManipulation");},groupForms:function r(DT,DX){var DY=this,DZ=DT[0].sid,DV=this.attributes[DZ],Dc=DY.getTable(DT[0].pdid),DU=this.formCategories[DX.fcatId],DW="",Db="";C3.forEach(DT,function(Dd){DW+=Dd.fcatId+";";});DW+=DU.id+";";this.submitRequest({success:function Da(){Cw.forEach(DV.tables,function(De){Dc=DY.getTable(De.id);Db+=De.id+",";Dc.reset();});DY.getAttributesFactsInTable(Db,{success:function Dd(){Cw.forEach(DV.tables,function(De){Dc=DY.getTable(De.id);DY.raiseTableChangeEvent(Dc);});}});}},{manipulationtype:q,objectid:DZ,usename:DU.useName,usedesc:DU.useDescription,info:DW},"schemaManipulation");},handleVisibleAction:function Cg(DU,DT){if(!DT){return false;}var DV=!DU.length?DU.tp:DU[0].tp;switch(DV){case C4:return Ck.call(this,DU,DT);case D:return BZ(DT.action,this.getFact(DU.did));case BJ:return Ce(DT.action,this.getAttribute(DU.did));case AH:return w(DT.action,DU);case B7:return AO.call(this,DT.action,this.getAttribute(DU.sid),DU.bfIdx);case DL:return CO.call(this,DT);case CL:return Bg(DT.action);case DS:return B0.call(this,DU,DT);default:return this._super(DU,DT);}},handleEnabledAction:function CF(DU,DT){if(!DT){return false;}var DV=!DU.length?DU.tp:DU[0].tp;switch(DV){case C4:return Ag.call(this,DT.action,DU);case AH:return m.call(this,DT.action);case B7:return true;case DL:return true;case D:return true;case BJ:return CH.call(this,DT.action,DU);case DS:return true;default:return this._super(DU,DT);}},handleCheckAction:function B8(DU,DT){if(!DT){return false;}var DV=!DU.length?DU.tp:DU[0].tp;switch(DV){case C4:return CU.call(this,DU,DT.action);case D:return Bt.call(this,DU,DT);case BJ:return Ai.call(this,DU,DT);case AH:return false;case B7:return Ai.call(this,DU,DT);case CL:return C5.call(this,DU,DT);case DL:return Aw.call(this,DU,DT);case DH:return Cu.call(this,DU,DT);case DS:return DQ.call(this,DT);default:return this._super(DU,DT);}},submitRequest:function Bc(DV,DU,DT){BB(DV,DU,DT);},getColumnByName:function G(DT){var DU=this,DV=null;Cw.forEach(DU.columns,function(DW){if(DW.cln.toUpperCase()===DT.toUpperCase()){DV=DW;return false;}return true;});return DV;},getColumnForExpression:function Bj(DU){DU=DU.replace(/^\s\s*/,"").replace(/\s\s*$/,"");var DT=DU.indexOf("[");if(DT===-1){return this.getColumnByName(DU);}return this.getColumnByName(DU.substring(DT+1,DU.indexOf("]")));},getAllColumnsForExpression:function CM(DY){DY=DY.replace(/^\s\s*/,"").replace(/\s\s*$/,"");var DX=this,DW=/[\[\]]/g,DV=DY.indexOf("["),DU=0,DT=[];if(DV>-1){do{DW.test(DY);DV=DW.lastIndex;DW.test(DY);DU=DW.lastIndex;DT.push(DX.getColumnByName(DY.substring(DV,DU-1)));DV=DY.indexOf("[",DU);}while(DV>-1);}else{DT.push(DX.getColumnByName(DY));}return DT;},createExpression:function Ak(DV){var DT=this,DU=DT.columns[DV],DW=[];if(DU){DW.push("[");DW.push(DU.cln);DW.push("]");return DW.join("");}return"";},setProjectPrimaryDBRole:function CN(DX,DW){var DT=this,DV=DT.SelDBRoleID;if(!DT.projPrimaryDBRoleID||DX){DT.submitRequest(BK({success:function DU(){DT.projPrimaryDBRoleID=DV;C3.forEach(DT.dbrs,function(DY){if(DY.data.isPrimary){DY.data.isPrimary=false;DT.raiseEvent({name:CR.DBROLE_CHANGED,item:DY});}if(DY.did===DV){DY.data.isPrimary=true;DT.raiseEvent({name:CR.DBROLE_CHANGED,item:DY});}return true;});}},DW),{dbroleID:DV,flgs:3,isPrimary:true},"addProjectDBRole");}else{DW.success();}},addDBRoleToProject:function Ba(DT,DW){var DU=this;if(!DU.initialized){DU.projPrimaryDBRoleID=DT.did;DU.setInitialValues();}if(C3.find(this.prjdbrs,"did",DT.did)>=0){if(DW&&DW.success){DW.success();}return ;}DU.submitRequest({success:function DV(){DU.prjdbrs.push(DT);if(DW&&DW.success){DW.success();}}},{dbroleID:DT.did,isPrimary:false},"addProjectDBRole");},setTableLogicalSize:function Cj(DW){var DU=this,DV=this.getTable(DW.did),DT={success:function DX(){DU.raiseTableChangeEvent(DV);}};DV.setLogicalSize(DW.size,DW.isLocked,DT);},setTableDBRoles:function BL(DY){var DU=this,DW=this.getTable(DY.did),DV=(DY.primaryId!==DW.primaryDBRole),DT=[],DX={success:function DZ(){DU.raiseTableChangeEvent(DW);DU.raiseEvent({name:Bs,items:DU.getDBRoleTablesInUse(DU.SelDBRoleID)});if(DV){DU.raiseEvent({name:BD,value:null,did:DW.id,tp:C4});DU.raiseEvent({name:DA,items:DU.createViewableTable(DW.primaryDBRole,[DW.getTableData()])});}}};C3.forEach(DY.secondary,function(Da){if(Da.id!==DY.primaryId){DT.push(Da.id);}});DW.editDBRoles(DY.primaryId,DT,DX);},getTableDBRoles:function BQ(DU){var DW=this,DY=this.dbrs,DT=DU.did,Db=this.getTable(DT),DV=[],Da=Db.primaryDBRole,DX=function DX(Dd){Dd=o.call(DW,Dd);var Dc=C3.find(DY,"did",Dd);return Dc===-1?"Incorrect DBRole Id":DY[Dc].n;},DZ=DX(Db.primaryDBRole);Cw.forEach(Db.secondaryDBRoles,function(Dc){DV.push({id:Dc,n:DX(Dc)});});DV.push({id:Da,n:DZ});return{did:DT,primaryId:Da,primaryName:DZ,dbRoles:DV};},addTableStatus:function DI(DW,DT,DY,DV,DZ){var DU=this,DX=DU.statusStack;DX.push({tableId:DW,status:DT,errorCode:DY,selDBRoleId:DV,callback:DZ});},checkItemStatus:function AC(){var DT=this,DU=DT.statusStack.pop();if(DU){switch(DU.status){case Be:DT.checkItemStatus();break;case A4:mstrmojo.alert(mstrApp.getRootController().cleanError(DU.errorCode),DT.checkItemStatus(),DU.tableId);break;case P:var DV=DT.getTable(DU.tableId);Cs.confirm(DU.errorCode,{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){DV.secondaryDBRoles.push(DU.selDBRoleId);DV.editDBRoles(DV.primaryDBRole,DV.secondaryDBRoles,DU.callback);DT.checkItemStatus();}},cancelBtn:{t:mstrmojo.desc(2140,"Cancel"),fn:function(){DT.checkItemStatus();}}},{title:DV.name});break;}}},checkTableStatus:function BV(){var DT=this;if(DT.statusStack.length===DT.statusCount){DT.checkItemStatus();}},addTableToModel:function Cl(Db,DW,DY,Da){var DV=this,DT=DV.dbRoleTables,DX=DV.getDBRole(DY),DU={success:function DZ(){if(DW){DV.tables[Db.id]=Db;if(Db.isView){DV.logicalViews[Db.id]=Db;}}if(!DT[DX.did]){DT[DX.did]={};}DV.PrjTblDbr=DX.did;DV.dbRoleTables[DX.did][Db.id]=Db;if(Da&&Da.success){Da.success();}}};DV.addDBRoleToProject(DX,DU);},createTable:function C6(DY,DV,DT,Dc){var DX=this,Da=DT.type||1,DZ=DX.SelDBRoleID||DX.projPrimaryDBRoleID,DW,DU={success:function Db(){DX.checkTableStatus();Dc.success(DW);}};mstrmojo.insert(new mstrmojo.architect.obj.Table({model:DX,isNew:DY,type:Da,tblDef:DT,name:DV,callback:{success:function Db(Dd){DW=Dd;DX.addTableToModel(Dd,(Dd.secondaryDBRoles.length===0),DZ,DU);}}}));},createTableAlias:function DC(DT){var DV=this,DU=DT.n+" "+AR;DU=DV.getNewValidName(C4,DU);DV.submitRequest({success:function DW(DX){var Da={26:[],15:[]},DZ=[].concat(DX.mi["in"].oi);C3.forEach(DZ,function(Db){if(Da[Db.tp]){Da[Db.tp].push(Db);}});var DY=DV.getTable(DT.did).clone(Da[C4][0].did,Da[C4][0].n);DV.addTableToModel(DY,true,DT.dbrole);DY.addColumns(Da[AH]);DV.raiseEvent({name:DA,items:DV.createViewableTable(DY.primaryDBRole,[DY.getTableData()])});}},{manipulationtype:BF,objectid:DT.did,objectname:DU,showWait:false},"schemaManipulation");},createViewableTable:function B5(DV,DW){var DX=this,DU=function(Dc,Db){return DX.handleVisibleAction(Dc,Db);},DT=function(Dc,Db){return DX.handleCheckAction(Dc,Db);},Da=function(Dc,Db){return DX.handleEnabledAction(Dc,Db);},DZ,DY;DZ=this.getDBRole(DV);DY={n:DZ.displayName(),st:DZ.mdDBRole.stp,t:DZ.mdDBRole.tp,did:DV,items:DW,isVisible:DU,isChecked:DT,isEnabled:Da};return DY;},addTables:function BH(DV,DW){var DT=this,DU={success:function(DX){if(DX.secondaryDBRoles.length>0){DT.raiseTableChangeEvent(DX);}else{DT.raiseEvent({name:DA,items:DT.createViewableTable(DX.primaryDBRole,[DX.getTableData()])});}DT.raiseEvent({name:Bs,items:DT.getDBRoleTablesInUse(DT.SelDBRoleID)});if(DW&&DW.success){DW.success(DX.getTableData());}}};DT.statusCount=DV.length;DT.statusStack=[];Cw.forEach(DV,function(DX){DT.getColumnsForDBTable({data:DX},{success:function DY(DZ){DX.columns=DZ.items;DT.createTable(true,DX.dbtn,DX,DU);}});});},updateLayer:function Co(DT,DU){this.submitRequest(DU,{manipulationtype:AJ,objectid:DT.id,info:JSON.stringify({tables:DT.tablePositions||{},attributes:DT.attributePositions||{}})},"schemaManipulation");},updateTableStructure:function CC(DV){var DT=this,DU=DT.getTable(DV),DX={success:function DY(){DT.raiseTableChangeEvent(DU);}},DW={success:function DY(){DT.getColumnsForDBTable({data:{n:DU.name,dbtn:DU.dbtn,ns:DU.nameSpace,dbrole:DU.primaryDBRole,tableId:DU.dbtid},getFresh:true,compareWithMD:true},{success:function DZ(Dc){var Dd=[],Da=Dc.xrc.cas[0],Db=Da.tis[0];C3.forEach(Db.clis,function(De){Dd.push(new mstrmojo.architect.obj.Column({dbInfo:De}));});DU.updateStructure({n:DU.name,did:DU.name,columns:Dd,sta:parseInt(Db.sta,10)},DX);}});}};if(DU.isPopulated){DW.success();}else{DT.getAttributesFactsInTable(DV,DW);}},getProjectTables:function CZ(){var DT=this,DU={success:function(){var DV=0,DW=[];Cw.forEach(DT.prjdbrs,function(DY){var DX=[];Cw.forEach(DT.dbRoleTables[DY.did],function(DZ){if(DT.getDBRole(DZ.primaryDBRole).did===o(DY.did)){DX.push(DZ.getTableData());}});if(DX.length>0){DW[DV]=DT.createViewableTable(DY.did,DX);DV++;}});DT.raiseEvent({name:CJ,items:DW});}};if(mstrApp.rootController.getObjectCount(DT.tables)===0){DT.loadProjectTables(DU);}else{DU.success();}},getProjectLocales:function AQ(DV){var DT=this;DT.submitRequest(BK({success:function DU(DW){if(DW){DT.multiLingualEnabled=DW.multiLingualEnabled;}}},DV),{manipulationtype:Cz},"schemaManipulation");},getDBRoleTablesInUse:function T(DU){var DT=[];Cw.forEach(this.dbRoleTables[DU],function DV(DW){DT.push(DW.name);});return DT;},loadProjectTables:function AE(DV){var DU=this,DT=BK({success:function(DW){Cw.forEach(DW.dbroles,function(DY){var DZ=DY.did,DX=DY.tables;DU.addDBRoleToProject(DU.getDBRole(DZ));Cw.forEach(DX,function(Db){var Da=new mstrmojo.architect.obj.Table({model:DU,isNew:false,id:Db.did,name:Db.n,primaryDBRole:DZ,nameSpace:Db.ns,dbtid:Db.dbtid,dbtn:Db.dbtn,type:Db.xt,SQLStatement:Db.sql,subtype:Db.stp});DU.addTableToModel(Da,true,DZ);Cw.forEach(Db.secdbroles,function(Dc){Da.secondaryDBRoles.push(Dc.did);DU.addTableToModel(Da,false,Dc.did);});});});}},DV);BB(DT,{showWait:true},"loadLogicalTables");},addSecondaryDBRole:function DJ(DX,DU){var DV=this,DW=DV.getTable(DX),DT={success:function(){DV.raiseEvent({name:Cy,tid:DW.id,dbr:DU});}};DW.addSecondaryDBRole(DU,DT);},setAsLookup:function CQ(DV,DZ,DX){var DY=this,Da=DY.getTable(DV),DU=DY.getAttribute(DZ),DT=DU.forms[DX],DW={success:function Db(){DY.raiseEvent({name:BY,value:DT.useName,did:DZ+DX,tp:B7,bfIdx:0});DY.raiseTableChangeEvent(Da);}};Da.setAsLookup(DZ,DX,DW);},setAsMultiLingual:function Cr(DV,DZ,DX){var DY=this,Da=DY.getTable(DV),DU=DY.getAttribute(DZ),DT=DU.forms[DX],DW={success:function Db(){DY.raiseEvent({name:BY,value:DT.useName,did:DZ+DX,tp:B7,bfIdx:0});DY.raiseTableChangeEvent(Da);}};DT.isMultiLingual=(!DT.isMultiLingual);DT.update(DW);},getTableByName:function B4(DU){var DT=this,DV=null;Cw.forEach(DT.tables,function(DW){if(DW.name===DU){DV=DW;return false;}return true;});return DV;},getTables:function A1(){return this.tables;},getTable:function S(DT){return this.tables[DT];},autoRecognizeTable:function BM(DW,DX){var DU=this,DV=DU.getTable(DW),DT={success:function(){DV.autoRecognize(DX);}};if((DV&&DV.isPopulated)||(DV&&DV.isNew)){DV.autoRecognize(DX);}else{DU.getAttributesFactsInTable(DW,DT);}},getAttributesFactsInTable:function BU(Da,DZ){var DW=this,DY,DV=[],DU=[],DX=(Da.length>32)?Da.substring(0,Da.indexOf(",")):Da;if(DX){DY=DW.getTable(DX);if((DY&&DY.isPopulated)||(DY&&DY.isNew)){if(DZ&&DZ.success){DV.push(DY.getTableData());DU=DW.createViewableTable(DY.primaryDBRole,DV);DZ.success({items:DU,tableData:DY.getTableData()});if(DZ.complete){DZ.complete();}}}else{var DT={complete:function(){if(DZ&&DZ.complete){DZ.complete();}},success:function(Db){C3.forEach(Db.tables,function(Df){DY=DW.getTable(Df.tbid);var De=Df.table.cols,Dg=Df.table.atts,Dd=Df.table.facts,Dc;DY.nameSpace=Df.table.ns;DY.size=Df.table.sz;DY.isPopulated=true;C3.forEach(De,function(Dh){DY.addColumn(Dh);});C3.forEach(Dg,function(Dh){var Di=Dh.did;if(!DW.attributes[Di]){DW.attributes[Di]=new mstrmojo.architect.obj.Attribute({isNew:false,id:Di,name:Dh.n,arity:Dh.art,model:DW});}Dc=DW.attributes[Di];Dc.formGroups=Dh.formGroups;C3.forEach(Dh.fms,function(Dj){Dc.addForm(false,Dj.catID+Di,Dj.bfi,Dj.catID,Dj.tbid,Dj.col.did,Dj.exp,"3","3",(Dj.isml!==0),Dj.bft,Dj.formName,Dj.formName,true,true,"",null);DY.addAttributeInfo(false,Dj.bfi,Di,Dj.exp,Dj.col.did);C3.forEach(Dj.aliasColumns,function(Dk){var Dl=new mstrmojo.architect.obj.Column({tableInfo:Dk});DW.columns[Dl.cmid]=Dl;});});});C3.forEach(Dd,function(Di){var Dh=Di.did;if(!DW.facts[Dh]){DW.facts[Dh]=new mstrmojo.architect.obj.Fact({isNew:false,id:Dh,name:Di.n,model:DW});}DY.addFactInfo(false,Dh,Di.exp.exp,Di.col.did);C3.forEach(Di.aliasColumns,function(Dj){var Dk=new mstrmojo.architect.obj.Column({tableInfo:Dj});DW.columns[Dk.cmid]=Dk;});});DV.push(DY.getTableData());DU=DW.createViewableTable(DY.primaryDBRole,DV);});if(DZ&&DZ.success){DZ.success({items:DU});}}};BB(DT,{manipulationtype:1001,tableids:Da},"schemaManipulation");}}},addAttributeInfo:function DD(DW,DU,DX,DY,Db,DT,DZ){var DV=this,Da=DV.getTable(DT);Da.addAttributeInfo(DW,DU,DX,DV.createExpression(Db),Db,DZ);},removeAttributeInfo:function Bv(DX,DW,DZ,DV){var DT=this,DU=DT.getTable(DW);DU.removeAttributeInfo(DX,DZ,DV,{success:function DY(){DT.raiseTableChangeEvent(DU);}});},updateAttributeInfo:function Bn(Da,DT,DY,DV,DX,DZ){var DU=this,DW=DU.getTable(DX);DW.updateAttributeInfo(DT,Da,DY,DV,DZ);},getAttributes:function z(){return this.attributes;},getAttribute:function A2(DT){return this.attributes[DT];},createAttributeInTable:function Ad(DW,Db,DT,DU,De){var DY=this,Df=DY.getTable(DW),DV,Da,DX={success:function Dd(){if(De&&De.success){De.success(Da.attributeId);}}},DZ={success:function Dd(Dg){Da=Dg;Df.addAttributeInfo(false,"0",DV.id,Db,DT,DX);}},Dc={success:function Dd(){DY.attributes[DV.id]=DV;DV.addForm(true,"",0,DY.basicForms.ID.id,DW,DT,Db,"3","3",true,3,DY.basicForms.ID.useName,DY.basicForms.ID.useName,true,true,"",DZ);}};DV=new mstrmojo.architect.obj.Attribute({isNew:true,name:DU,model:DY,callback:Dc});},createAttribute:function CV(DY){var DU=this,DW=DY.pdid,DT=DU.findColumnName(DY.n),DX=DY.did,Da=DU.createExpression(DX),DV={success:function DZ(){DU.raiseTableChangeEvent(DU.getTable(DW));}};DT=DU.getNewValidName(BJ,DT);DU.createAttributeInTable(DW,Da,DX,DT,DV);},updateAttributeMapping:function AL(DW,DU){var DT=this,DV=DT.getAttribute(DW.did);DV.automapping=(DU.did==="AutoMap");},removeAttributeForm:function BS(DT,DU,DV){this.getAttribute(DT).removeForm(DU,DV);},addFactInfo:function DG(DT,DZ,DY,DV,DX,Da){var DU=this,DW=DU.getTable(DX);DW.addFactInfo(DT,DZ,DU.createExpression(DV),DV,Da);},removeFactInfo:function AB(DX,DW,DV){var DT=this,DU=DT.getTable(DV);DU.removeFactInfo(DX,DW,{success:function DY(){DT.raiseTableChangeEvent(DU);}});},updateFactInfo:function DF(DY,DX,DU,DW,DZ){var DT=this,DV=DT.getTable(DW);DV.updateFactInfo(DY,DX,DU,DZ);},getFacts:function Cb(){return this.facts;},getFact:function BR(DT){return this.facts[DT];},createFactInTable:function a(DV,DY,DT,DU,Db){var DX=this,Dc=DX.getTable(DV),Dd,DZ={success:function Da(){if(Db&&Db.success){Db.success(Dd.id);}}},DW={success:function Da(){DX.facts[Dd.id]=Dd;Dc.addFactInfo(true,Dd.id,DY,DT,DZ);}};Dd=new mstrmojo.architect.obj.Fact({isNew:true,name:DU,model:DX,callback:DW});},createFact:function M(DX){var DU=this,DT=DU.findColumnName(DX.n),DW=DX.did,DV=DX.pdid,Da=DU.createExpression(DW),DZ={success:function DY(){DU.raiseTableChangeEvent(DU.getTable(DV));}};DT=DU.getNewValidName(D,DT);DU.createFactInTable(DV,Da,DW,DT,DZ);},updateFactMapping:function CP(DW,DV){var DU=this,DT=DU.getFact(DW.did);DT.automapping=(DV.did==="AutoMap");},addTableInfo:function W(DY,De){var DZ=this,DT=DY.did,DU=DY.pdid,DW=De.did,Da,Db,Dd=DZ.getTable(DU),DX={success:function Dc(){DZ.raiseTableChangeEvent(DZ.getTable(DU));}},DV={success:function Dc(){DZ.addAttributeInfo(true,Db,DW,DZ.createExpression(DT),DT,DU,DX);}};if(De.tp===D){DZ.addFactInfo(true,DW,DZ.createExpression(DT),DT,DU,DX);}else{Da=DZ.getFormCount(DW);Db=Dd.attributeInfos[DW]?Object.keys(Dd.attributeInfos[DW].baseForms).length:0;if(Da>Db){DV.success();}else{DZ.addNextAvailableForm(DW,DU,DT,DZ.createExpression(DT),DV);}}},updateMappingMethod:function Af(DV,DU){var DT=this.model;if(DV.tp===BJ){DT.updateAttributeMapping(DV,DU);}else{DT.updateFactMapping(DV,DU);}},removeInfoFromTable:function CK(DX){var DU=this,DW,DV,DY=0,DT;if(DX.tp===BJ||DX.tp===B7){DW=(DX.tp===BJ)?DU.attributes[DX.did]:DU.attributes[DX.sid];if(Object.keys(DW.tables).length>1){DV=DW.tables;DT=(DX.tp===BJ)?"-1":DX.bfIdx;Cw.forEach(DV,function(DZ){Cw.forEach(DZ.attributeInfos,function(Da){Cw.forEach(Da.baseForms,function(Db){if(Db.baseFormId===DT){DY++;}});});});if(DY>1){DU.removeAttributeInfo(true,DX.pdid,DT,DW.id);}else{DU.deleteObject(DX);}}else{if(DX.tp===B7&&DX.bfIdx==="0"){DX.did=DX.sid;DX.tp=v.ATTRIBUTE;DU.deleteObject(DX);}else{DU.deleteObject(DX);}}}else{DU.removeFactInfo(true,DX.did,DX.pdid);}},convertAttributeToFact:function Bo(DX,Db,DZ,DV,Df){var DY=this,Dc="",Dh,Dg=DY.getTable(DV),DU=DY.attributes[Db],Dd=Dg.attributeInfos[Db],Da=(Dd.baseForms[DX])?Dd.baseForms[DX].expression:DU.forms[DX].expression,DT=(Dd.baseForms[DX])?Dd.baseForms[DX].columnId:DU.forms[DX].columnId;if(Object.keys(DU.forms).length>1){mstrmojo.alert(CB);return ;}if(DZ){Dc=DZ;}var DW=BK({success:function De(Dl){if(!Dh){Dh=Dl.mi["in"].oi[0];var Dk=Dh.did,Dn=C.call(this),Do=DY.attributes,Dj,Dm,Di;if(!DY.facts[Dk]){DY.facts[Dk]=new mstrmojo.architect.obj.Fact({isNew:false,id:Dk,name:Dh.n,model:DY});}Dh=DY.facts[Dk];Dh.isNew=true;Dg.addFactInfo(false,Dk,Da,DT);Dm=Do[Db];Cw.forEach(Dm.tables,function(Dp){Dp.removeAttributeInfo(false,"0",Db,null);});if(Do[Db]){delete Do[Db];}if(Dn){Dj=Dn.relations;Cw.forEach(Dj,function(Dp){if(((Dp.childAttributeId===Db)||(Dp.parentAttributeId===Db))&&Dp.childAttributeId!==""){Dj.splice(Di,1);return false;}Di++;return true;});}DY.raiseTableChangeEvent(Dg);}}},Df);BB(DW,{manipulationtype:K,objectid:Db,objectid2:Dc,baseformid:DX,columnid:DT,tableids:DV,objectname:DU.name,expression:Da},"schemaManipulation");},convertAttributeToForm:function Ae(DU,DW,DX){var Db=this,Dd=Db.getAttribute(DW),Dh=Db.getTable(DX),De=Dh.attributeInfos[DU],Dg=Object.keys(Dd.forms).length,DT=De.baseForms["0"].columnId,Dc=De.baseForms["0"].expression,Da=false,DV={success:function Df(){Db.raiseTableChangeEvent(Dh);}},DZ={success:function Df(){Dh.removeAttributeInfo(true,"0",DU,DV);}},DY={success:function Df(){Dh.addAttributeInfo(Da,Dg,DW,Dc,DT,DZ);}};if(De.count()<Dg){Dg=De.count();Da=true;DY.success();}else{Db.addNextAvailableForm(DW,DX,DT,Dc,DY);}},convertColumnToForm:function CY(Db,DT,DU){var DY=this,Da=DY.getAttribute(DT),Df=DY.getTable(DU),De=Object.keys(Da.forms).length,DZ=DY.createExpression(Db),Dc=Df.attributeInfos[DT],DW=Dc.count(),DX={success:function Dd(){DY.raiseTableChangeEvent(Df);}},DV={success:function Dd(){Df.addAttributeInfo(false,De,DT,DZ,Db,DX);}};if(DW<De){Dc.addBaseForm(true,DW,Db,DZ,DX);}else{DY.addNextAvailableForm(DT,DU,Db,DZ,DV);}},convertFactToAttribute:function g(Dk,Dg,DZ,Db,DV,DW,Dc,DY){var DX=this,Dj="",DU=DX.getFact(Dk),De=DX.basicForms.ID.id,Dh=DX.getTable(Dc),Di=Dh.factInfos[Dk],Dd=Di.expression,DT=Di.columnId;if(Dg){Dj=Dg;}var Df=BK({success:function Da(Dn){var Dm=Dh.attributeInfos[Dg],Dl=Dn.mi[0]["in"].oi[0],Dp=Dl.did,Do;if(!DX.attributes[Dp]){Do=new mstrmojo.architect.obj.Attribute({isNew:false,id:Dp,name:Dl.n,model:DX});DX.attributes[Dp]=Do;Do.addForm(false,"",0,DX.basicForms.ID.id,Dc,DT,Dd,"3","3",true,3,Dl.n,Dl.n,true,true,"",null);}if(!Dm){Dh.addAttributeInfo(false,0,Dp,Dd,DT);Dh.removeFactInfo(false,Dk,Dc);delete DX.facts[Dk];}else{mstrmojo.alert(N);}DX.raiseTableChangeEvent(Dh);}},DY);BB(Df,{manipulationtype:BC,objectid:Dk,objectid2:Dj,columnid:DT,tableids:Dc,formcatid:De,expression:Dd,objectname:DU.name,isbrowseform:1,istemplateform:1,baseformtype:DZ,usename:DW},"schemaManipulation");},raiseTableChangeEvent:function Bi(DT){this.raiseEvent({name:Cn,item:DT.getTableData()});this.raiseEvent({name:U,item:DT.getTableData(true)});},saveProject:function A6(DT){this.isDirty=false;BB(DT,{schemaaction:"5",showWait:true},"schemaAction");},saveAndUpdate:function Bk(DU){this.isDirty=false;this.saveSchemaInstance({success:function DT(){BB(DU,{showWait:true},"refreshEngineSchema");}});},saveSchemaInstance:function L(DW){var DT=this,DU=CX.call(DT);if(DU){DT.createMetric(null,"Multiple Metrics",null,DU,{success:function DV(){DT.saveProject(DW);}});}else{DT.saveProject(DW);}},setInitialValues:function CD(DT){this.tables={};this.getProjectTables();this.loadDBTypeFilters(DT);this.initialized=true;},createSchemaInstance:function I(DV){var DT=this;BB(BK({success:function DU(DW){DT.set("schemaInstanceID",DW.siid);DT.populateFormCategories();DT.getProjectLocales();C3.forEach(DW.dbrs,function(DZ){var DY=new mstrmojo.warehouse.obj.DBRole({mdDBRole:DZ,mdl:DT});DT.dbrs.push(DY);DT.prjdbrs.push(DY);});if(DT.dbrs.length&&DT.dbrs.length>0){DT.projPrimaryDBRoleID=DT.dbrs[0].did;DT.setInitialValues({success:function DX(){mstrApp.rootController.switchView(DT.currentView,true);}});}else{DT.loadDBTypeFilters({success:function DX(){mstrApp.getRootController().showDBRolePicker({success:function DY(DZ){DT.SelDBRoleID=DZ;DT.setProjectPrimaryDBRole(true,{success:function Da(){DT.setInitialValues({success:function Db(){mstrApp.rootController.switchView(DT.currentView,true);}});DT.SelDBRoleID="";DT.set("SelDBRoleID",DZ);}});}});}});}}},DV),{schemaaction:"1",skipSchemaIDCheck:true,showWait:true},"schemaAction");},createMetric:function Z(DU,DV,DT,DW,DY){BB(BK({success:function DX(){}},DY),{manipulationtype:Bx,objecttype:p,objectname:DU,objectdef:DW,showWait:true},"schemaManipulation");},createColumnAlias:function CI(DU,DW,DX,DT,DV,DY){if(DX===B7){DX=BJ;}BB(DY,{manipulationtype:Aj,objectid:DU,objecttype:DX,baseformid:DW,objectname:DT,objectdef:JSON.stringify(DV),showWait:false},"schemaManipulation");},updateColumn:function C9(DU,DY,DZ){var DW=this,DT=DU.cmid,DV=DU.cln;BB(BK({success:function DX(){if(DU.n!==DV){var Da=function Da(Dd){var De=Dd.expression,Dc=DW.getAllColumnsForExpression(De);C3.forEach(Dc,function(Df){if(Df&&(Df.cmid===DT)){Dd.expression=Dd.expression.replace(Df.cln,DV);}});};Cw.forEach(DW.tables,function(Dc){Cw.forEach(Dc.attributeInfos,function(Dd){Da(Dd);Da(Dd.baseForms[Dd.baseFormId]);});Cw.forEach(Dc.factInfos,function(Dd){Da(Dd);});});Cw.forEach(DW.transformations,function(Dc){Cw.forEach(Dc.elements,function(Dd){Da(Dd);});});}DY.cln=DU.cln;DY.dt.tp=DU.dt.tp;DY.dt.ps=DU.dt.ps;DY.dt.sc=DU.dt.sc;DY.tableId=DU.tableId;var Db=DW.getTable(DU.tableId);DW.raiseTableChangeEvent(Db);}},DZ),{manipulationtype:Al,objectdef:JSON.stringify(DU),showWait:false},"schemaManipulation");},updateAggregation:function CG(DW,DV){var DU=this,DT=DU.getFact(DW.did);Cw.copy(DV.aggr,DT);},switchLayer:function C7(DT){if(DT!==""){var DU=this,DW=this.layers[DT];if(DW){DW.loadDefinition({success:function DV(){var DX=DW&&DW.tables;if(DX&&Object.keys(DX).length>0){DU.getAttributesFactsInTable(Object.keys(DX).toString(),{success:function DY(){DW.loadRelations({mdl:DU,complete:function DZ(Db){var Da=this.mdl.askAutoMap;this.mdl.askAutoMap=false;this.mdl.set("currentlayerID",Db.id);this.mdl.askAutoMap=Da;}});}});}else{DU.set("currentlayerID",DT);}}});}else{this.set("currentlayerID","");}}else{this.set("currentlayerID","");}},loadLayers:function Ar(DW){var DU=this,DT={success:function DV(DX){C3.forEach(DX.layers,function(DY){var DZ=DU.layers[DY.did];if(!DZ){DU.layers[DY.did]=new mstrmojo.architect.obj.Layer({mdl:DU,id:DY.did,n:DY.n});}});}};if(Object.keys(DU.layers).length===0){BB(BK(DT,DW),{objecttypes:DR,xmlflags:1,namepattern:"",flags:512,specialparse:"getLayers"},"search");}else{if(DW&&DW.success){DW.success();}}},_set_currentlayerID:function Aq(DY,DT){var DW=this,DV=this.currentlayerID,DU=DW.getAllLayers();if((DV!==DT)||(this.forceReloadLayer)){this.forceReloadLayer=false;this.currentlayerID=DT;this.getRelations({success:function DX(DZ){DW.raiseEvent({name:Au,value:DT,relations:DZ.relations,positions:DZ.attributePositions,layers:DU});}});}},getAllLayers:function DE(){var DU=this.layers,DT=[];Cw.forEach(DU,function(DW){var DV=[];Cw.forEach(DW.tables,function(DX){DV.push(DX.getTableData());});DT.push({n:DW.name,did:DW.id,items:DV,tp:DW.tp});});return DT;},getLayer:function u(DT){return this.layers[DT];},updateRelation:function AZ(DW,DZ,DX,DV){var DU=this,DY=C.call(this),DT={success:function Da(Db){DU.invalidateRelations();DU.getRelations({success:function Dc(Dd){DU.raiseEvent({name:e,item:Db,relations:Dd.relations,positions:Dd.attributePositions,storePositions:false});DU.getSystemDimensionAttributes({success:function De(Df){DU.raiseEvent({name:X,relations:Df});}});}});}};DY.updateRelation(DW,DZ,DV,DX,DT);},addRelation:function Aa(DV,DX,DU){var DT=this,DW=C.call(this),DY={success:function DY(DZ){DT.invalidateRelations();DT.getRelations({success:function Da(Db){DT.raiseEvent({name:e,item:DZ,relations:DW.relations,positions:DW.attributePositions,entryPoints:Db.entryPoints,attributeProperties:Db.attributeProperties,storePositions:false});if(DT.currentView!==AY){DT.getSystemDimensionAttributes({success:function Dc(Dd){DT.raiseEvent({name:X,relations:Dd});}});}}});}};DW.addRelation(DV,DX,DY,DU);},autoArrange:function A7(){var DT=this,DU=C.call(this);DT.getRelations({success:function DV(DW){DT.raiseEvent({name:e,relations:DU.relations,entryPoints:DW.entryPoints,attributeProperties:DW.attributeProperties,storePositions:true});DT.getSystemDimensionAttributes({success:function DX(DY){DT.raiseEvent({name:X,relations:DY});}});}});},removeRelation:function Bb(DW,DY){var DV=this,DT={},DX=C.call(this),DU={success:function DZ(){DV.invalidateRelations();DV.getRelations({success:function Da(Db){DV.raiseEvent({name:e,item:{parentAttributeId:DW,childAttributeId:DY},entryPoints:Db.entryPoints,attributeProperties:Db.attributeProperties,relations:Db.relations,positions:DT,storePositions:false});if(DV.currentView!==AY){DV.getSystemDimensionAttributes({success:function Dc(Dd){DV.raiseEvent({name:X,relations:Dd});}});}}});}};DX.removeRelation(DW,DY,DU);DT=DX.attributePositions;},removeFromHierarchy:function y(DW){var DU=this,DT={},DX=C.call(this),DV={success:function DY(){DU.invalidateRelations();DU.getRelations({success:function DZ(Da){DU.raiseEvent({name:e,item:{parentAttributeId:DW,childAttributeId:DW},relations:Da.relations,positions:DT,attributeProperties:Da.attributeProperties,entryPoints:Da.entryPoints,storePositions:false});if(DU.currentView!==AY){DU.getSystemDimensionAttributes({success:function Db(Dc){DU.raiseEvent({name:X,relations:Dc});}});}}});}};DX.removeAttributes([{atid:DW}],DV);DT=DX.attributePositions;},getRelation:function Y(DT,DV){var DU=C.call(this);return(DT&&DV)?DU.getRelation(DT,DV):DU.relations;},getRelations:function AT(DX){var DT=this,DV=BX.call(DT);switch(this.currentView){case B2:if(this.currentlayerID===""){DX.success([]);return ;}var DU=this.layers[this.currentlayerID];DU.getRelations({success:function DW(DY){DX.success({relations:DY,attributePositions:DU.attributePositions});}});return ;case BA:DV.load(DX);return ;case AY:if(this.currentHierarchyID===""){DX.success([]);return ;}this.userHierarchies[this.currentHierarchyID].load(DX);return ;case C2:DV.load(DX);return ;default:DX.success([]);return ;}},getSystemDimensionAttributes:function C0(DV){var DT=this,DU=BX.call(DT);DU.getRelations(DV);},hasRelation:function Ax(DY){var DV,DU=[],DX=C.call(this),DT=0,DW=DY.attributeId;DV=DX.relations;DU.push(DW);Cw.forEach(DV,function(DZ){if(((DZ.childAttributeId===DW)||(DZ.parentAttributeId===DW))&&((DZ.childAttributeId!=="")||(DZ.parentAttributeId!==""))){DT++;}});return(DT!==0);},invalidateRelations:function Bw(DU){var DT="";switch(this.currentView){case B2:BX.call(this).relationsLoaded=false;DT=this.currentlayerID;break;case BA:break;}Cw.forEach(this.layers,function(DV){if((DT==="")||DU||(DT!==DV.id)){DV.relationsLoaded=false;}});},removeAttributeFromRelation:function R(DX){var DZ=this,DV=[],Dd=[],Da,DY,DT=C.call(this),DU=0,Db=DX.did||DX.attributeId,DW;Da=DT.relations;DY=DT.attributePositions;delete DY[DX.attributeId];DV.push(Db);Cw.forEach(Da,function(Df){if(((Df.childAttributeId===Db)||(Df.parentAttributeId===Db))&&Df.childAttributeId!==""){DU++;DT.removeRelation(Df.parentAttributeId,Df.childAttributeId,{success:function Dg(){DV.push(Df.parentAttributeId);DV.push(Df.childAttributeId);},complete:function De(){if(--DU===0){DV.sort();Dd.push(DV[0]);for(DW=1;DW<DV.length;DW++){if(DV[DW-1]!==DV[DW]){Dd.push(DV[DW]);}}DZ.invalidateRelations();DZ.getRelations({success:function Dh(Di){DZ.raiseEvent({name:e,affectedAttributes:Dd,relations:Di.relations,positions:Di.attributePositions,storePositions:false});DZ.getSystemDimensionAttributes({success:function Dj(Dk){DZ.raiseEvent({name:X,relations:Dk});}});}});}}});}});if(DU===0){DZ.getRelations({success:function Dc(De){DZ.raiseEvent({name:e,affectedAttributes:DV,relations:De.relations,positions:De.attributePositions,storePositions:false});DZ.getSystemDimensionAttributes({success:function Df(){DZ.getSystemDimensionAttributes({success:function Dg(Dh){DZ.raiseEvent({name:X,relations:Dh});}});}});}});}},updateRelationPositions:function x(DU,DV){var DW=this,DT;if(!(DU&&mstrApp.rootController.getObjectCount(DU))){return ;}if(DW.currentView===AY&&DV){DW.userHierarchies[DV].updateAttributePositions(DU,{success:mstrmojo.emptyFn});}else{DT=C.call(this);if(DT){DT.updateAttributePositions(DU,{success:mstrmojo.emptyFn});}}},automapColumn:function Cd(DW,DV,DX){var DT=this,DU=DT.getTable(DV);DU.automapColumn(DW,DX);},findDependentsByNameSearch:function A9(DT){DT=mstrmojo.string.trim(DT);if(DT===""){this.getProjectTables();return ;}var DU=this;BB({success:function DV(DZ){DU.tryQS=DZ.tryQS;var DX=[];Cw.forEach(DZ.es,function(Db){DX.push({did:Db.did,n:Db.n,tp:Db.tp,isVisible:function Da(Df,De){if(this.tp===C4){return DU.handleVisibleAction(Df,De);}return false;},isChecked:function Dd(Df,De){if(this.tp===C4){return DU.handleCheckAction(Df,De);}return false;},isEnabled:function Dc(Df,De){if(this.tp===C4){return DU.handleEnabledAction(Df,De);}return false;},items:[],isSearch:true,ttp:""});});var DY=[{n:mstrmojo.desc(73,"search result"),tp:"search",did:"SEARCH",isVisible:function DW(){return false;},items:DX}];DU.raiseEvent({name:CJ,items:DY});}},{namepattern:DT,tryQS:DU.tryQS},"nameSearchTable");},loadSearchObjectContents:function l(DT,DW){var DU=this;if(DT.tp===C4){DU.getAttributesFactsInTable(DT.did,BK({success:function DV(DX){if(DX&&DX.items&&DX.items.items&&DX.items.items[0]){DX.items=DX.items.items[0].items;}}},DW));}else{BB(BK({success:function DV(DX){var DY=[];C3.forEach([].concat(DX.oi),function(Da){var DZ=DU.getTable(Da.did);DY.push(DZ.getTableData());});DX.items=DY;}},DW),{dependent:JSON.stringify({did:DT.did,n:DT.n,tp:DT.tp}),tryQS:DU.tryQS},"nameSearchTable");}},createObject:function Am(DY,DU,DX,Da){var DT=this,DW,DZ={success:function DV(){var Db=(DY===BJ)?DT.attributes:DT.facts;Db[DW.id]=DW;Da.success(DW);}};DW=(DY===BJ)?new mstrmojo.architect.obj.Attribute({isNew:true,name:DU,callback:DZ}):new mstrmojo.architect.obj.Fact({isNew:true,name:DU,callback:DZ});},renameObject:function d(DT,Da,DY,Dc,DU){var DW=this,DX={success:function Dg(){DW.raiseEvent({name:BY,value:DY,did:DT,tp:Da,bfIdx:Dc});if(Da===B7){var Dh=DW.attributes[DU],Di=Dh.forms[Dc];DW.raiseTableChangeEvent(DW.getTable(Di.tableId));}else{if(Da===BJ){DW.invalidateRelations(true);}else{if(Da===C4){mstrApp.getRootController().saveAndUpdate();}}}}};switch(Da){case BJ:var DV=DW.attributes[DT];DV.rename(DY,DX);break;case D:var Df=DW.facts[DT];Df.rename(DY,DX);break;case C4:var De=DW.getTable(DT);De.rename(DY,DX);break;case DH:var Db=DW.transformations[DT];Db.rename(DY,DX);break;case B7:var DZ=DW.attributes[DU],Dd=DZ.forms[Dc];Dd.useDescription=DY;Dd.useName=DY;Dd.update(DX);break;}},deleteObject:function CE(DZ){var Da=this,Dc=DZ.tp,DT=DZ.did,Db,DV=false,De,Df=(Dc!==C4)?Da.getTable(DZ.pdid):null,DW={success:function Dh(){var Dk=C.call(this),Dj,Di=0;switch(Dc){case BJ:Db=Da.attributes;if(Db[DT]){delete Db[DT];}De=Dc;if(Dk){Dj=Dk.relations;Cw.forEach(Dj,function(Dl){if(((Dl.childAttributeId===DT)||(Dl.parentAttributeId===DT))&&Dl.childAttributeId!==""){Dj.splice(Di,1);return false;}Di++;return true;});}break;case D:Db=Da.facts;if(Db[DT]){delete Db[DT];}De=Dc;break;case DH:Db=Da.transformations;if(Db[DT]){delete Db[DT];}De=Dc;Da.raiseEvent({name:Az,items:Da.getTransformations()});break;case B6:Db=Da.userHierarchies;if(Db[DT]){delete Db[DT];}De=Dc;Da.updateHierarchiesList();break;case C4:Db=Da.tables;DV=Db[DT].isView;if(Db[DT]){delete Db[DT];}delete Da.dbRoleTables[o.call(Da,DZ.dbrole)][DT];if(DV){delete Da.logicalViews[DT];Da.raiseEvent({name:Bq,views:Da.logicalViews,value:""});}De=Dc;Da.raiseEvent({name:Bs,items:Da.getDBRoleTablesInUse(Da.SelDBRoleID)});break;case B7:De=B7;break;}Da.raiseEvent({name:BD,value:null,did:DT,tp:De});if((Dc!==C4)&&Df&&(Df.columnDisplay===H)){Da.raiseEvent({name:U,item:Df.getTableData(true)});}}};switch(Dc){case BJ:var DU=Da.attributes[DT];DU.remove(DW);break;case D:var Dg=Da.facts[DT];Dg.remove(DW);break;case C4:var DY=Da.getTable(DT);DY.remove(DW);break;case B7:Da.removeAttributeForm(DZ.sid,DZ.bfIdx,DW);break;case DH:var Dd=Da.transformations[DT];Dd.remove(DW);break;case B6:var DX=Da.userHierarchies[DT];DX.remove(DW);break;}},addLogicalView:function Ct(DU,DW){var DT=this;var DX={success:function DV(DY){mstrApp.rootController.switchLogicalView(DY.id);DT.raiseEvent({name:DA,items:DT.createViewableTable(DY.primaryDBRole,[DY.getTableData()])});}};this.createTable(DU,DW,{type:3},DX);},setTransformationCardinality:function Bp(DT,DV){var DU=this.transformations[DT];DU.setMappingType(DV);},setTransformationAllAttributes:function Ca(DT,DV){var DU=this.transformations[DT];DU.setAttributeScope(DV);},getTransformations:function AW(){var DT=this;DT.getSystemDimensionAttributes({success:function DU(DV){DT.raiseEvent({name:X,relations:DV});}});return Cw.valarray(this.transformations);},editTransformation:function B3(DU){var DT=this,DV=DT.transformations[DU];DT.currentTransformationId=DU;if(DU===""||(!DV)){return ;}DV.load({success:function DW(){DT.raiseEvent({name:Av,items:DV.getTransformationData(),value:DV,source:0});}});DT.getSystemDimensionAttributes({success:function DW(DX){DT.raiseEvent({name:X,relations:DX});}});},loadTransformations:function AN(DT){var DU=this,DW={success:function DV(DY){var DX=[].concat(DY.oi||[]),DZ;C3.forEach(DX,function(Da){DZ=new mstrmojo.architect.obj.Transformation({isNew:false,id:Da.did,n:Da.n,onetoOneMappingType:(Da.def.ert===1),transformationAllAttributes:true,mdl:DU});DU.transformations[DZ.id]=DZ;});DU.raiseEvent({name:Az,items:DU.getTransformations()});}};if(Object.keys(DU.transformations).length===0){DU.submitRequest(BK(DW,DT),{objecttypes:DH,flags:1+2+256+512,xmlflags:1},"search");}else{DU.raiseEvent({name:Az,items:DU.getTransformations()});if(DT&&DT.success){DT.success();}}},addTransformation:function AM(DU,DW){var DT=this;mstrmojo.insert(new mstrmojo.architect.obj.Transformation({defaultName:DU,newTransformationName:DW,isNew:true,mdl:DT,callback:{success:function DV(DX){DT.transformations[DX.id]=DX;DT.currentTransformationId=DX.id;DT.raiseEvent({name:Az,items:DT.getTransformations()});DT.raiseEvent({name:Av,items:DX.getTransformationData(),value:DX,source:0});DT.getSystemDimensionAttributes({success:function DY(DZ){DT.raiseEvent({name:X,relations:DZ});}});}}}));},addTransformationElement:function Ac(DV,DU,DX,DY,DZ,Db,DT){var DW=this,Da=DW.transformations[DV];Da.addElement(DU,DX,DY,{success:function Dc(){DW.raiseEvent({name:Av,items:Da.getTransformationData(),value:Da,source:DT,attributeID:DU});}},DZ,Db);},removeTransformationElement:function Ah(DX,DU){var DT=this,DV=DT.transformations[DX];DV.removeElement(DU,{success:function DW(DY){DT.raiseEvent({name:Av,items:DY.getTransformationData(),value:DY,attributeID:DU});}});},addLayer:function AI(DY,DU,DX){var DT=this,DV=new mstrmojo.architect.obj.Layer({defaultName:DU,newLayerName:DX,isNew:true,mdl:DT,callback:BK(DY,{success:function DW(DZ){DT.layers[DZ]=DV;DT.switchLayer(DZ);}})});},deleteLayer:function AV(DT){var DV=this,DU=this.getLayer(DT);DU.remove({model:DV,success:function DW(DX){var DY=this.model.layers;if(DY[DX]){delete DY[DX];}DV.forceReloadLayer=true;if(DV.currentlayerID===DT){DV.switchLayer(Object.keys(DY)[0]||"");}else{DV.switchLayer(DV.currentlayerID);}}});},addAttributeToHierarchy:function AP(DV,DU,DW){var DT=this;DT.userHierarchies[DT.currentHierarchyID].addAttribute(DV,DU,DW);},addEntryPoint:function C1(DU){var DT=this;DT.userHierarchies[DT.currentHierarchyID].addEntryPoints([{atid:DU}]);},removeEntryPoint:function C1(DU){var DT=this;DT.userHierarchies[DT.currentHierarchyID].removeEntryPoints([{atid:DU}]);},loadUserHierarchies:function BG(DV){var DX=this,DW=DX.userHierarchies,DU=function DU(){DX.currentHierarchyID=DV;if(DV&&DW[DV]){DW[DV].load({success:function DZ(Da){DX.raiseEvent({name:e,hierarchyId:DV,relations:Da.relations,positions:Da.attributePositions,entryPoints:Da.entryPoints,attributeProperties:Da.attributeProperties,viewType:By.USER_HIERARCHY,storePositions:false});DX.getSystemDimensionAttributes({success:function Db(Dc){DX.raiseEvent({name:X,relations:Dc});}});}});}else{DX.raiseEvent({name:e,hierarchyId:"",relations:[],positions:[],entryPoints:[],viewType:By.USER_HIERARCHY,storePositions:false});}DX.raiseEvent({name:Bh,value:DV});},DT={success:function DY(DZ){C3.forEach(DZ.dimensions,function(Da){DW[Da.did]=new mstrmojo.architect.obj.UserHierarchy({model:DX,did:Da.did,n:Da.n,useForDrill:(Da.stp===j)});});DU();}};if(mstrApp.rootController.getObjectCount(DW)===0){BB(BK(DT,{success:function DY(){DX.raiseEvent({name:Ao,hierarchies:Cw.valarray(DX.userHierarchies)});if(DV){DU();}}}),{objecttypes:b,xmlflags:1,flags:512,specialparse:"getDimensions"},"search");}else{DU();}},updateHierarchiesList:function Bd(){var DU=this,DT=[];Cw.forEach(DU.userHierarchies,function(DV){DT.push({model:DU,did:DV.did,n:DV.n,tp:B6});});DU.raiseEvent({name:Ao,hierarchies:DT});},addUserHierarchy:function AA(DT,DY){var DV=this,DU,DX=new mstrmojo.architect.obj.UserHierarchy({model:DV,isNew:true,name:DT,callback:BK(DY,{success:function DW(DZ){DU=DZ.userHierarchy.did;DV.currentHierarchyID=DU;DV.userHierarchies[DU]=DX;DX.load({success:function Da(Db){DV.raiseEvent({name:e,hierarchyId:DU,relations:Db.relations,viewType:By.USER_HIERARCHY,storePositions:false});DV.getSystemDimensionAttributes({success:function Dc(Dd){DV.raiseEvent({name:X,relations:Dd});}});DV.raiseEvent({name:Bh,value:DU});DV.updateHierarchiesList();}});}})});},setHierarchyAttributeLockProperty:function Cc(DV,DU,DT,DW){this.userHierarchies[this.currentHierarchyID].setAttributeLockProperty(DV,DU,DT,DW);},updateHiearchySubtype:function Bz(DT,DU){this.userHierarchies[this.currentHierarchyID].updateHiearchySubtype(DT,DU);},getHierarchyAttributeFilters:function B1(DT){return this.userHierarchies[this.currentHierarchyID].getAttributeFilters(DT);},setHierarchyAttributeFilters:function BW(DT,DU,DV){this.userHierarchies[this.currentHierarchyID].setAttributeFilters(DT,DU,DV);},addJointChildren:function n(DW,DT){var DU=this,DV=C.call(this),DX={success:function DX(DY){DU.invalidateRelations();DU.getRelations({success:function DZ(){DU.raiseEvent({name:e,item:DY,relations:DV.relations,positions:DV.attributePositions,storePositions:false});DU.getSystemDimensionAttributes({success:function Da(Db){DU.raiseEvent({name:X,relations:Db});}});}});}};DV.addJointRelation(DW,DT,DX);},getJointChildrenCandidates:function AD(DX){var DU=this,DZ=[],DT={},DY=C.call(this),DW=DU.getTable(DX.relationTableId),Da=[],DV=DW.getTableData();DT[DX.parentAttributeId]=DX.parentAttributeId;DT[DX.childAttributeId]=DX.childAttributeId;if(DX.isJointChildren){Da=DY.getRelatedRelations(DX.parentAttributeId);C3.forEach(Da,function(Db){DT[Db.childAttributeId]=Db.childAttributeId;return true;});}Cw.forEach(DV.items,function(Db){if(Db.tp===12&&DT[Db.did]===undefined){DZ.push(Db);}});return DZ;},getProjects:function CS(DT,DU){BB(DU,DT,"getProjects");},tokenizeExpression:function C8(DW,DV,DX){var DT=this;if(DW===""){if(DX&&DX.success){DX.success();}}else{DT.validateExpr({expr:DW,tid:DV,vo:null},{success:function DU(DY){if(DY&&DY.mi.oi.tknstrm.mi){var DZ=DY.mi.oi.tknstrm.mi;DT.trimTokenEnds(DZ.tkn);if(DX&&DX.success){DX.success(DZ);}}}});}},trimTokenEnds:function At(DU){var DT=DU[DU.length-1];if(DT&&DT.tp===-1){DU.pop();}if(DU[0]&&(DU[0].tp===64||(DU[0].tp===33&&DU[0].v==="!"))){DU.splice(0,1);}},validateExpr:function Q(DT,DU){if(DT.expr===""){return ;}BB(DU,{exp:DT.expr,tbls:DT.tid,vo:(DT.vo===1)?1:0},"parse");},validateTransformationExpr:function h(DT,DU){if(DT.expr===""){return false;}BB(DU,{exp:DT.expr,tbls:DT.tid,vo:(DT.vo===1)?1:0},"parse");return true;},getObjectInBulk:function A0(DT,DU){BB(DU,{objects:DT.join(";")},"getObjects");},changeLayerTableColumnView:function O(DV,DT){var DU=this.getTable(DV.did);switch(DU.columnDisplay){case DU.EnumColumnDisplay.None:DU.columnDisplay=DT.view;break;default:DU.columnDisplay=DU.EnumColumnDisplay.None;break;}this.raiseTableChangeEvent(DU);},loadFunctions:function CA(DY){var DV=this,DU=false;if(DV.functions){DY.success();return ;}var DX=(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(DX){try{DV.functions=JSON.parse(DX).fncs;}catch(DT){DU=true;}if(!DU){DY.success();return ;}}BB({success:function DW(DZ){var Da=function Da(Dc,Db){return C3.stringSorter(Dc.n,Db.n);};DZ.fncs=DZ.fncs.sort(Da);C3.forEach(DZ.fncs,function(Db){Db.fns=Db.fns.sort(Da);});DV.functions=DZ.fncs;if(window.sessionStorage){window.sessionStorage.setItem("functions",JSON.stringify(DZ));}DY.success();}},{includeFunctionDetails:false,functionFlags:2+4,showWait:true},"getSystemFunctions");},getTablesForRelationship:function Cm(DU,DT){var DV=[],DX=C.call(this),DW;switch(this.currentView){case B2:Cw.forEach(DX.tables,function(DY){DW=DY.attributeInfos;if(DW[DU]&&DW[DT]){DV.push({n:DY.name,did:DY.id});}});break;default:DV=DX.getTablesForRelationship(DU,DT);break;}return DV;},prePopulateRelationMenu:function BP(DT,DW){var DU=this;if((DT.relationTableId===undefined)||(DT.relationTableId==="")){DW.success();}else{DU.getAttributesFactsInTable(DT.relationTableId,{success:function DV(){if(!DT.isSysDimension){DW.success();}else{DU.sysDimension.loadTablesForRelationship(DT,DW);}}});}},searchAttributeTables:function B9(DT,DU){this.submitRequest(DU,{objecttypes:15,uses:DT+",12;",flags:1+2+256+512,xmlflags:1},"search");},openExpressionEditor:function i(DX,DT){var DZ=this,DY=DT.isNew,DV=DY?DX.did:DX.pdid,Db=DZ.getTable(DV),DW,DU={tbl:{clns:Db.columns,did:DV},data:DX,isNew:DY},Dc={success:function Da(){DZ.raiseTableChangeEvent(Db);}};if(!DY){DW=(DT.tp===D)?Db.factInfos[DX.did]:Db.attributeInfos[DX.sid].baseForms[DX.bfIdx];DU.objectForExpression=DW;}DZ.tokenizeExpression((DW&&DW.expression)||"",DV,{success:function Da(Dd){DZ.loadFunctions({success:function De(){var Dh=mstrmojo.all.ExpressionEditor,Dg;if(!Dh){Dh=new mstrmojo.architect.ExpressionEditor();Dh.functions=DZ.functions;Dh.validationFunc=DZ.validateExpr;}Dh.callBackFunction=function Df(Do){var Dn=Do.expression,Dk=Do.expressionColumn||DZ.getColumnForExpression(Dn)||DZ.columns[Object.keys(DZ.columns)[0]],Dj={success:function Dm(Dp){if(Do.needsNewCol){var Dq=Dp,Dr=DU.data.bfIdx||0;DZ.createColumnAlias(Dq,Dr,DT.tp,DU.data.n+" "+AR,{tp:Do.selItem.id,ps:Do.precision,sc:Do.scale},{success:function Ds(Dt){var Du=new mstrmojo.architect.obj.Column({tableInfo:Dt.col});DZ.columns[Du.cmid]=Du;if(DT.tp===D){DZ.updateFactInfo(Dq,Do.expression,Du.cmid,DV,Dc);}else{DZ.updateAttributeInfo(Dr,Dq,Do.expression,Du.cmid,DV,Dc);}}});}else{Dc.success();}}};if(DY){if(Dk){Dg=Dk.cmid;DX.n=Dk.cln;}var Dl=new mstrmojo.architect.ui.editors.NameEditor({data:DX,tp:DT.tp,isNew:true,onOK:function Di(Dp){if(DT.tp===D){DZ.createFactInTable(DV,Dn,Dg,Dp,Dj);}else{DZ.createAttributeInTable(DV,Dn,Dg,Dp,Dj);}}});Dl.open();}else{if(!Do.dtChanged){if(DT.tp===D){DZ.updateFactInfo(DX.did,Dn,Dk.cmid,DV,Dj);}else{DZ.updateAttributeInfo(DX.bfIdx,DX.sid,Dn,Dk.cmid,DV,Dj);}}else{Dk.dt.tp=Do.selItem.id;Dk.dt.ps=Do.precision;Dk.dt.sc=Do.scale;Dk.tableId=Do.tblId;mstrApp.getRootController().updateColumn(Dk,Dk,{success:function Dm(){if(DT.tp===D){DZ.updateFactInfo(DX.did,Dn,Dk.cmid,DV,Dj);}else{DZ.updateAttributeInfo(DX.bfIdx,DX.sid,Dn,Dk.cmid,DV,Dj);}}});}}};Dh.set("title",DY?((DT.tp===BJ)?"New Attribute":"New Fact"):DX.n);Dh.model=DZ;if(Dd){DU.tokens=Dd.tkn;}else{DU.tokens=[];}Dh.set("oi",DU);Dh.open();}});}});},getLinks:function DP(DV,DX){var DT=DV.did,DW=DV.tp,DU=0;if(DW===B7){DW=BJ;DT=DV.sid;DU=DV.bfIdx;}this.submitRequest(DX,{objectId:DT,objectType:DW,exp:DV.n,bfidx:DU},"getLinkInfo");},searchFilters:function Br(DT){this.submitRequest(DT,{objecttypes:1,flags:1+2+256+512,xmlflags:1},"search");}});mstrmojo.architect.ArchitectModel.EnumSchemaManipulation={CreateObject:Bx,DeleteObject:F,RenameObject:A3,AddFactInfo:E,RemoveFactInfo:AF,UpdateFactInfo:DM,AddAttributeInfo:BI,RemoveAttributeInfo:c,UpdateAttributeInfo:Bf,AutoRecognizeTable:Ab,SetAsLookup:Cv,AddAttributeForm:Ap,UpdateAttributeForm:A8,CreateAttributeRelation:t,RemoveAttributeRelation:Cq,GetAttributeRelation:f,ConvertAttributeToFact:K,ConvertFactToAttribute:BC,InsertAttributeRelation:V};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Box","mstrmojo.css","mstrmojo.architect.ui.editors.TransformationEditor","mstrmojo.warehouse.ui.BasePanel");var D=mstrmojo.warehouse.EnumObjectTypes,C="px";mstrmojo.architect.ui.panels.TransformationEditorPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.architect.ui.panels.TransformationEditorPanel",cssClass:"TransformationEditorPanel",title:"",transformationId:"",icntp:D.ATTRIBUTE,onheightChange:function B(G){var H=parseInt(G.value,10),F=this.headerHeight=this.headerHeight||(this.hasRendered?this.headerNode.clientHeight:36),E=(Math.max(H-F,0))+C;this.height=H+C;this.editor.set("height",E);},onwidthChange:function A(G){var F=parseInt(G.value,10),E=(Math.max(F,0)-1)+C;this.width=F+C;this.editor.set("width",E);},children:[{scriptClass:"mstrmojo.architect.ui.editors.TransformationEditor",alias:"editor"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.architect.ui.factories.ViewFactory","mstrmojo.architect.ui.panels.AttributesPanel","mstrmojo.architect.ui.panels.TransformationEditorPanel","mstrmojo.architect.ui.panels.TransformationListPanel","mstrmojo.architect.ui.panels.TransformationPanel");mstrmojo.architect.ui.factories.TransformationViewFactory=mstrmojo.declare(mstrmojo.architect.ui.factories.ViewFactory,null,{scriptClass:"mstrmojo.architect.ui.factories.TransformationViewFactory",newLeftNavigationPanel:function A(F){return new mstrmojo.architect.ui.panels.AttributesPanel(F);},newTopEditorPanel:function C(F){return new mstrmojo.architect.ui.panels.TransformationPanel(F);},newBottomEditorPanel:function B(F){return new mstrmojo.architect.ui.panels.TransformationEditorPanel(F);},newRightItemsPanel:function E(F){return new mstrmojo.architect.ui.panels.TransformationListPanel(F);},closeObject:function D(){if(this.views.editorTop){this.views.editorTop.closeObject();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.ui.Splitter","mstrmojo.architect.ui.EnumViewTypes","mstrmojo.architect.ui.panels.ContentsPanel","mstrmojo.architect.ui.factories.LayerViewFactory","mstrmojo.architect.ui.factories.LogicalViewViewFactory","mstrmojo.architect.ui.factories.SystemDimensionViewFactory","mstrmojo.architect.ui.factories.UserHierarchyViewFactory","mstrmojo.architect.ui.factories.TransformationViewFactory","mstrmojo.architect.ui._HasSplitterStoredLayout");var J=mstrmojo.array,F=mstrmojo.hash,I="firstSplitNode",L="secondSplitNode",E=mstrmojo.architect.ui.EnumViewTypes,D=[{type:E.LAYER,scriptClass:"mstrmojo.architect.ui.factories.LayerViewFactory"},{type:E.SYS_HIERARCHY,scriptClass:"mstrmojo.architect.ui.factories.SystemDimensionViewFactory"},{type:E.TRANSFORMATION,scriptClass:"mstrmojo.architect.ui.factories.TransformationViewFactory"},{type:E.LOGICAL_VIEWS,scriptClass:"mstrmojo.architect.ui.factories.LogicalViewViewFactory"},{type:E.USER_HIERARCHY,scriptClass:"mstrmojo.architect.ui.factories.UserHierarchyViewFactory"}];function H(b){var S=this.contentSplitter,Q=this.contentSplitter.editorSplitter,P=this.viewFactories;if(b!==undefined){var d=P[J.find(P,"type",b)],U=d.views||{},O=d.viewConfig;if(d.beforeLeave){d.beforeLeave();}Object.keys(U).forEach(function(f){U[f].unrender();});if(O.editorLeft){this.removeChildren(this.leftPanel,true);}if(O.editorTop||O.editorBottom){Q.removeChildren(undefined,true);}if(O.editorRight){S.removeChildren(S.rightPanel,true);}}var V=P[J.find(P,"type",this.currentViewType)],e=V.viewConfig,R=V.views=V.views||{},N=e.editorLeft,T=e.editorTop,Z=e.editorBottom,c=e.editorRight,Y=e.leftVisible||mstrApp.rootController.showProjectTableView,X=e.topVisible,W=e.bottomVisible,a=e.rightVisible;e.showDB=e.showDB||mstrApp.rootController.showDatabaseView;if(N){R.editorLeft=R.editorLeft||V.newLeftNavigationPanel({alias:"leftPanel",slot:I});this.addChildren(R.editorLeft);}if(T){R.editorTop=R.editorTop||V.newTopEditorPanel({slot:I});Q.addChildren(R.editorTop);}if(Z){R.editorBottom=R.editorBottom||V.newBottomEditorPanel({slot:L});Q.addChildren(R.editorBottom);}if(c){R.editorRight=R.editorRight||V.newRightItemsPanel({alias:"rightPanel",slot:L});S.addChildren(R.editorRight);}this.toggleFirstItemVisibility(Y);Q.toggleSecondItemVisibility(W);Q.toggleFirstItemVisibility(X);S.toggleSecondItemVisibility(a);this.parent.parent.toolbarWidget.update({isLeftVisible:Y,showDB:e.showDB,currentView:this.currentViewType});if(Z&&Q.resizeHandleNode){Q.resizeHandleNode.style.display=(X?"block":"none");}if(this.hasRendered){F.forEach(R,function(f){f.render();});this.doLayout();}}mstrmojo.architect.ui.MainSplitter=mstrmojo.declare(mstrmojo.ui.Splitter,[mstrmojo.architect.ui._HasSplitterStoredLayout],{scriptClass:"mstrmojo.architect.ui.MainSplitter",alias:"mainSplitter",contentSplitter:undefined,leftPanel:undefined,rightPanel:undefined,lastLeftPanel:undefined,viewFactories:undefined,currentViewType:E.LAYER,getLayoutOffsets:function K(){return{h:2,w:2};},init:function M(Q){var R=window.localStorage,N=(R&&R.getItem("initialSettings"))||null,P=JSON.parse(N);if(P){this.currentViewType=P.cv||E.LAYER;if(P.splittersLayouts&&P.splittersLayouts.mainSplitter){this.config=P.splittersLayouts.mainSplitter;}}this._super(Q);var O=this.viewFactories=[];D.forEach(function(U,S){var T=O[S]=mstrmojo.insert(U);this.addDisposable(T);},this);H.call(this);},switchView:function A(O){var N=this.currentViewType;this.currentViewType=O;H.call(this,N);},closeViewObject:function G(){var N=this.viewFactories[J.find(this.viewFactories,"type",this.currentViewType)],O=N.viewConfig;if(O.editorRight){N.viewListVisible=true;N.closeObject();this.contentSplitter.toggleSecondItemVisibility(N.viewListVisible);}},updateViewObjectName:function B(O,N){this.viewFactories[J.find(this.viewFactories,"type",this.currentViewType)].updateViewObjectName(O,N);},toggleViewList:function C(){var N=this.viewFactories[J.find(this.viewFactories,"type",this.currentViewType)],O=N.viewConfig;if(O.editorRight){N.viewListVisible=!N.viewListVisible;this.contentSplitter.toggleSecondItemVisibility(N.viewListVisible);}},children:[{scriptClass:"mstrmojo.architect.ui.panels.ContentsPanel",alias:"contentSplitter",slot:L}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.Splitter","mstrmojo.warehouse.WHPanel","mstrmojo.architect.ui.MainSplitter","mstrmojo.architect.ui._HasSplitterStoredLayout","mstrmojo.hash");var D=mstrmojo.hash,F="firstSplitNode",J="secondSplitNode";function I(L){var M=(L&&L.fv)||{},N=(L&&L.sv)||{};return D.clone({firstSplit:{v:M.v||"230px",min:M.min||"150px"},secondSplit:{v:N.v||"100%",min:N.min||"150px"},resizeHandle:{v:"2px"}});}mstrmojo.architect.ui.ArchitectPageLayout=mstrmojo.declare(mstrmojo.ui.Splitter,[mstrmojo.architect.ui._HasSplitterStoredLayout],{init:function K(N){var O=window.localStorage,L=(O&&O.getItem("initialSettings"))||null,M=JSON.parse(L);this.config=I({sv:{min:"300px"}});if(M&&M.splittersLayouts&&M.splittersLayouts.layoutWidget){this.config=M.splittersLayouts.layoutWidget;}else{this.children[1].config=I({});}this._super(N);},mainSplitter:null,contentSplitter:null,toggleDatabaseView:function H(L){this.toggleFirstItemVisibility(L);},toggleProjectTableView:function G(L){this.mainSplitter.toggleFirstItemVisibility(L);},switchView:function A(L){this.mainSplitter.switchView(L);},closeViewObject:function E(){this.mainSplitter.closeViewObject();},updateViewObjectName:function B(M,L){this.mainSplitter.updateViewObjectName(M,L);},toggleViewList:function C(){this.mainSplitter.toggleViewList();},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",slot:F},{scriptClass:"mstrmojo.architect.ui.MainSplitter",cssClass:"paddedPanel",alias:"mainSplitter",slot:J}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.architect.ui.Toolbar","mstrmojo.architect.ui.ArchitectPageLayout");mstrmojo.architect.ui.ArchitectPage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.architect.ui.ArchitectPage",markupString:'<div id="{@id}" class="mstrmojo-architect {@cssClass}" style="{@cssText}"><div class="mstrmojo-architect-toolbar"></div><div class="mstrmojo-architect-layout"></div></div>',markupSlots:{toolbar:function K(){return this.domNode.firstChild;},layout:function G(){return this.domNode.children[1];}},layoutConfig:{h:{toolbar:"36px",layout:"100%"},w:{toolbar:"all",layout:"100%"},xt:true},layoutWidget:undefined,toggleDatabaseView:function I(L){this.layoutWidget.toggleDatabaseView(L);},toggleProjectTableView:function H(L){this.layoutWidget.toggleProjectTableView(L);},closeViewObject:function F(){this.layoutWidget.closeViewObject();},updateViewObjectName:function C(M,L){this.layoutWidget.updateViewObjectName(M,L);},toggleViewList:function D(){this.layoutWidget.toggleViewList();},switchView:function B(L){this.layoutWidget.switchView(L);},render:function A(){if(this.error){this.renderPageLoadError();}else{this._super();}},browserResized:function J(N){var O=parseInt(N.w,10)-1+"px",M=parseInt(N.h,10)-45+"px",P=this.height,L=this.width;if(P&&M!==P){this.set("height",M);}else{this.height=M;}if(L&&O!==L){this.set("width",O);}else{this.width=O;}return true;},renderPageLoadError:function E(){var N=this.error,M=N.message,O=N.title,L=N.btns;mstrApp.onerror(N);if(!L||!L.length){mstrmojo.alert(M,null,O);}else{mstrmojo.confirm(M,null,{buttons:L,title:O});}},children:[{scriptClass:"mstrmojo.architect.ui.Toolbar",slot:"toolbar",alias:"toolbarWidget"},{scriptClass:"mstrmojo.architect.ui.ArchitectPageLayout",alias:"layoutWidget",slot:"layout"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.form","mstrmojo.Editor","mstrmojo.architect.ui.ArchitectPage","mstrmojo.architect.ArchitectModel","mstrmojo._IsWebApp","mstrmojo.architect.RootController");window.mstrApp=mstrApp;window.mstrConfig=mstrConfig;mstrmojo.architect.ArchitectApp=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsWebApp],{scriptClass:"mstrmojo.architect.ArchitectApp",enableWaitBox:true,start:function E(){var F=this.rootController=new mstrmojo.architect.RootController();F.model=new mstrmojo.architect.ArchitectModel();F.rootView=new mstrmojo.architect.ui.ArchitectPage({placeholder:this.placeholder});F.start();mstrmojo.dom.attachEvent(window,"beforeunload",F.model.schemaInstanceHasChanged);mstrmojo.dom.attachEvent(window,"unload",F.onCloseArchitect);},getRootController:function D(){return this.rootController;},serverRequest:function B(J,I,G){if(G){this.showWait();}if(this.sessionState){I.sessionState=this.sessionState;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,mstrmojo.func.wrapMethods(J,{success:mstrmojo.emptyFn,complete:function F(){mstrApp.hideWait();},failure:function H(K){if(K.getResponseHeader("X-MSTR-TaskErrorCode")==="-2147080975"){mstrmojo.alert(K.getResponseHeader("X-MSTR-TaskFailureMsg"));}}}),I);},getSearchAutoCompleteDelay:mstrmojo.emptyFn,onerror:function A(F){mstrmojo.alert(F.message);},onSessionExpired:function C(){var F=mstrApp;mstrmojo.form.send({evt:5005,src:F.name+"."+F.pageName+".5005"});},isSingleTier:false,isArchitect:true});}());