mstrmojo.warehouse.EnumNamespaceMode={ALL:"0",CURRENT:"1"};(function(){var I="FULLCONNECTION",J="MSTR_CUSTOM";function K(O,M){var Q=mstrmojo.string;O=Q.trim(O);var P=/\(\d+\)$/,N=P.exec(O);if(N){M.v=parseInt(O.substring(N.index+1,O.length-1),10);return Q.trim(O.substring(0,N.index));}return O;}mstrmojo.warehouse.dbroles.DBRoleHelper=mstrmojo.provide("mstrmojo.warehouse.dbroles.DBRoleHelper",{isNumeric:function A(M){return !isNaN(parseFloat(M))&&isFinite(M);},getUniqueName:function E(S){S=K(S,{});var V=mstrApp.rootController.getDBRoles(),O=mstrApp.rootController.isCloud(),Q=mstrApp.rootController.getAllDBRoleNames(),U,R=0,T={},P=0,M=S,N=function(W){M=S;if(O){U=K(W.des,T);}else{U=K(W.n,T);}P=Math.max(P,T.v)||0;if(U.toString().toUpperCase()===M.toString().toUpperCase()){R=P+1;}};do{if(!O){mstrmojo.hash.forEach(Q,N);if(R===0){mstrmojo.array.forEach(V,N);}}else{mstrmojo.array.forEach(V,N);}if(R>0){M=S+" ("+R+")";}}while(mstrApp.rootController.findinArray(V,"n",M)>=0);return M;},cleanDSNConnection:function D(M){M=mstrmojo.string.trim(M).replace(/\\/g,"\\\\");M=this.cleanDSNConnectionPlaceHolders(M);M=M.replace(/\\/g,"^^^789^^^");M=M.replace(/:/g,"!!!789!!!");M=M.replace(/,/g,"%%%789%%%");M=M.replace("\\","###789###");M=M.replace(/{/g,"+++789+++");M=M.replace(/}/g,"@@@789@@@");M=M.replace("FULLCONNECTION=","");return M;},cleanDSNConnectionPlaceHolders:function D(M){M=M.replace(/!#AT#!/g,"@");M=M.replace(/!#QUESTION#!/g,"?");M=M.replace(/!#AND#!/g,"&");M=M.replace("!#DRIVERSUFFIX#!","");return M;},cleanLoadedDSNConnection:function B(N,M){var O;N=mstrmojo.string.trim(N);if(M===19){O=N.split(";");mstrmojo.array.forEach(O,function(Q,P){if(Q.search(/^\s*DBQ=/)===-1){O[P]=Q.replace(/\\\\/g,"\\");}});N=O.join(";");}else{N=N.replace(/\\\\/g,"\\");}N=N.replace(/@/g,"!#AT#!");N=N.replace(/\?/g,"!#QUESTION#!");N=N.replace(/&/g,"!#AND#!");return N;},driverAvailable:function H(M){if((M.str.indexOf(I)===0)&&(M.driver===""||M.driver==="XQUERY")){return true;}return(mstrmojo.array.find(this.drivers,"nU",M.driver.toUpperCase())>=0);},driverExists:function F(O){var R=this,P=false,Q="",N=0,M=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.array.forEach(O,function(T,S){if(M.driverAvailable.call(R,T)){P=true;Q=T.driver;N=S;}return !P;});return{exists:P,driver:Q,idx:N};},cleanDriver:function G(N){var P="DRIVER=",M=N.toUpperCase().indexOf(P),O="";if(M>=0){M+=P.length;O=N.substring(M,M+N.substring(M).indexOf(";"));O=O.replace(/([\{\}])+/g,"");}return O;},isCustomConnection:function L(M){return(M.indexOf(J)>=0);},showHelp:function C(N){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(N);}else{var M=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");window.open(M+(N||""),"_blank");return false;}}});}());mstrmojo.qb.EnumDragActions={ADD_TABLE:"addTable",JOIN_COLUMN:"joinColumn"};(function(){mstrmojo._CanRenderChildrenOnShow=mstrmojo.provide("mstrmojo._CanRenderChildrenOnShow",{_subs_renderOnShow:null,childRenderCheck:function B(D){if(this.renderMode!=="onshow"){return this._super(D);}if(D.visible){return this._super(D);}var C=this._subs_renderOnShow;if(!C){C={};this._subs_renderOnShow=C;}if(!C[D.id]){C[D.id]=D.attachEventListener("visibleChange",this.id,"_on_child_visibleChange");}return false;},_on_child_visibleChange:function A(C){if(this.hasRendered){var E=C&&C.src;if(E&&this.childRenderCheck(E)){var D=this._subs_renderOnShow;if(D){E.detachEventListener(D[E.id]);delete D[E.id];}E.render();}}}});}());mstrmojo.architect.menu.EnumMenuActions={NONE:0,DELETE:1,RENAME:2,AUTOMAP:3,UPSTRUCT:4,ADD_ATTRIBUTE:5,ADD_FACT:6,CREATE_ALIAS:7,SET_AS_PRIMARY:8,IS_PRIMARY:9,SAMPLE_DATA:10,CONVERT_ATTR_TO_FACT:11,CONVERT_ATTR_TO_FORM:12,CONVERT_FACT_TO_ATTR:13,REMOVE_FROM_TABLE:14,SET_AS_LOOKUP:15,SET_AS_FORM:16,NEW_FACT:17,NEW_ATTR:18,UPDATE_FORMAT:19,EDIT:20,MAPPING:21,AGGREGATION:22,DATA_TYPE:23,UPDATE_AGGR:24,DATA_SOURCES:25,REMOVE_TABLE:26,REMOVE_ATTR_FROM_RELATIONSHIP:27,ONE_TO_ONE:28,ONE_TO_MANY:29,MANY_TO_MANY:30,DELETE_RELATIONSHIP:31,RELATIONSHIP_TABLE:32,RELATIONSHIP_TABLE_ENTRY:33,SHOW_UNUSED_COLUMNS:34,ADD_TO_LAYER:35,REMOVE_FROM_LAYER:36,COLUMN_DEF:37,LINKS:38,CONVERT_COLUMN_TO_FORM:39,ADD_TO_PROJECT:40,LOGICAL_TABLE_SIZE:41,SET_AS_MULTILINGUAL:42,FORM_CATEGORY:43,UPDATE_CATEGORY:44,UNGROUP_FORMS:45,GROUP_FORM:46,UNGROUP_FORM:47,UPDATE_GROUP:48,DUPLICATE:49,TX_ONE_TO_ONE:50,TX_MANY_TO_MANY:51,TX_APPLY_TO_ALL:52,TX_APPLY_TO_HIGHEST:53,SET_ENTRY_POINT:54,REMOVE_ENTRY_POINT:55,REL_ATTR_ELEMENT_DISPLAY:56,ATTRIBUTE_FILTERS:57,BROWSE_ATTRIBUTES:58,REL_ATTR_ELEMENT_LIMIT:59,REL_ATTR_ELEMENT_LOCK:60,REL_ATTR_ELEMENT_UNLOCK:61,ADD_JOIN_CHILDREN:62,USE_AS_DRILL:63,USE_AS_BROWSE:64,CATALOG_SQL:65};mstrmojo.warehouse.EnumObjectTypes={FILTER:1,METRIC:4,ATTRIBUTE:12,FACT:13,DIMENSION:14,TABLE:15,TABLE_LOGICAL_VIEW:151,TABLE_PARTITION:152,FORM:21,COLUMN:26,DBROLE:29,PROJECT:32,TRANSFORMATION:43,DBTABLE:53,LAYER:70,RELATIONSHIP:99,COMPOUND_FORM:1001,RELATIONSHIP_ATTRIBUTE:1002};(function(){mstrmojo.boxmodel=mstrmojo.provide("mstrmojo.boxmodel",{rangeIntersect:function E(J,H,I,G){if(J<I){return I<=H;}if(J>I){return J<=G;}return true;},px2Inches:function C(H,G){G=parseInt(G,10);return mstrmojo.NumberFormat.getInstance(mstrConfig.decimalSep,mstrConfig.thousandsSep).format(parseFloat((G/H.zf/H.dpi).toFixed(4)));},offset:function F(I,H){var L=I,G=0,K=0;while(I){G+=I.offsetLeft;K+=I.offsetTop;I=I.offsetParent;if(I===H){break;}}var J;for(J=L&&L.parentNode;J&&J!==H;J=J.parentNode){if(J.scrollTop){K-=J.scrollTop;}if(J.scrollLeft){G-=J.scrollLeft;}}return{left:G,top:K};},convert2px:function D(K,I){if(!/px$/.test(I)){var H=document.createElement("img"),G=H.style,J;G.zIndex=-1;G.left=I;K.appendChild(H);J=G.pixelLeft;K.removeChild(H);return J+"px";}return I;},getEdgeQuadrantByPoint:function B(I,H){var G=H.x-I.x,M=H.y-I.y,J=I.w,L=I.h,K=[["Left","Bottom"],["Top","Right"]];if(M>L/J*G){K=K[0];}else{K=K[1];}return(M<-L/J*G+L)?K[0]:K[1];},isPtInPolygon:function A(I,K){var G=I.x,J=I.y,H=false;K.forEach(function(N,L){var M=K[L-1]||K[K.length-1];if((N.y>=J)!==(M.y>=J)){if((G<(M.x-N.x)*(J-N.y)/(M.y-N.y)+N.x)){H=!H;}}});return H;}});}());(function(){mstrmojo.vi._MonitorsAppState=mstrmojo.provide("mstrmojo.vi._MonitorsAppState",{onAppStateChange:function(B){if(this._super){this._super(B);}},init:function A(B){this._super(B);if(mstrApp.attachEventListener){mstrApp.attachEventListener("appStateChange",this.id,"onAppStateChange");}}});}());(function(){function AK(Aq,Ar){return Ar||(Aq||window).event;}mstrmojo.PositionType=null;var An=!!document.all,AI=document.documentMode,q=navigator.userAgent,j=false,g=false,e=false,d=false,R=false,u=false;if(An){if(window.mstrConfig&&mstrConfig.isEdgeModeEnabled){j=!!q.match(/MSIE 6/);g=((!!q.match(/MSIE 7/)&&!AI)||AI===7);e=(AI===8);d=(AI===9);R=(AI===10);u=(!AI||AI<=9);}else{j=!!q.match(/MSIE 6/);g=!!q.match(/MSIE 7/);e=!!q.match(/MSIE 8/);d=!!q.match(/MSIE 9/);R=!!q.match(/MSIE 10/);u=!R;}}var c=!An&&!!q.match(/Firefox/),l=0,t=!!q.match(/Android/),Ae=!!q.match(/iPad/),AO=!!q.match(/iPhone/),AW=!!document.createTouch||t,p=!!q.match(/PlayBook/),O=!!q.match(/Windows Phone/),Ao=!An&&!!q.match(/Trident.*rv/),b=c?"-moz-":(An||Ao)?"":"-webkit-",AJ=c?"Moz":(R||Ao)?"":An?"ms":"webkit",AT=((R||Ao)?"t":"T"),AN=AJ+AT+"ransition";function Ai(){return AJ+AT+"ransform";}function AG(){return AN+"Property";}function S(){return AN+"Duration";}function N(){return(R||c)?"transitionend":"webkitTransitionEnd";}function f(){return AJ+"BoxShadow";}var Al=Ai(),Ab=AG(),AB=S(),A=N(),n=f();function AS(){if(!l&&c){var Aq=q.match(/.*Firefox\/([\d|\.]*).*/);if(Aq){l=parseFloat(Aq[1]);}}return l;}function AY(){var Ar=0,Av=0,As=window,At=document,Aq=At.body,Au=At.documentElement;if(typeof As.pageYOffset==="number"){Av=As.pageYOffset;Ar=As.pageXOffset;}else{if(Aq&&(Aq.scrollLeft||Aq.scrollTop)){Av=Aq.scrollTop;Ar=Aq.scrollLeft;}else{if(Au&&(Au.scrollLeft||Au.scrollTop)){Av=Au.scrollTop;Ar=Au.scrollLeft;}}}return{x:Ar,y:Av};}function AH(Aq){Aq=Aq||0;Aq=String(Aq);return((Aq.indexOf("%",0))!==-1)?Aq:(Aq+"px");}function AQ(As,Aw,Av,Au,At){if(!mstrmojo.dom.isWinPhone){Au=(Au||false||this.isHWAccelerated);}else{Au=false;}var Ar=At+(Au?"3d":"")+"(",Aq=Au?(","+Av+")"):")";return Ar+As+","+Aw+Aq;}var Ac=2,V=3;function w(Aw,Av,Az){var Ay=Aw.style,As=Ay.display,Au=this.windowDim(),At=AY();Ay.display="block";var Ax=Au.w-Aw.clientWidth,A0=Math.max(Au.h-Aw.clientHeight,0),Aq={4:0,5:Ax,3:Ax/2},Ar={1:0,3:A0/2,2:A0};Ay.left=Aq[Av]+At.x+"px";Ay.top=Ar[Az]+At.y+"px";Ay.display=As;}function m(At,As,Au,Aq){if(At.addEventListener){return At.addEventListener(As,Au,!!Aq);}Au._id=Au._id||m.guid++;At.events=At.events||{};var Ar=At.events[As];if(!Ar){Ar=At.events[As]={};if(At["on"+As]){Ar[0]=At["on"+As];}}Ar[Au._id]=Au;function Av(Ay){Ay=Ay||window.event;var Ax=this.events[Ay.type],Aw;for(Aw in Ax){Ax[Aw].call(this,Ay);}}At["on"+As]=Av;}m.guid=1;function h(As,Ar,At,Aq){if(!As){return ;}if(As.removeEventListener){As.removeEventListener(Ar,At,!!Aq);}else{if(As.events&&As.events[Ar]){delete As.events[Ar][At._id];}}}mstrmojo.Enum_Keys={BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46};mstrmojo.dom=mstrmojo.provide("mstrmojo.dom",{userAgent:q,isIE:An,isIE6:j,isIE7:g,isIE8:e,isIE9:d,isIE10:R,isIEW3C:Ao,isNSIE:u,isDXIE:u,isFF:c,isWK:!!q.match(/AppleWebKit/),isSafari:!!q.match(/Safari/)&&!q.match(/Chrome/),isChrome:!!q.match(/AppleWebKit/)&&q.match(/Chrome/),isHWAccelerated:!t,isAndroid:t,isIPad:Ae,isPlayBook:p,isWinPhone:O,isMobile:Ae||AO||O||t,supportsTouches:AW,TOUCHSTART:AW?"touchstart":"mousedown",TOUCHMOVE:AW?"touchmove":"mousemove",TOUCHEND:AW?"touchend":"mouseup",TOUCHCANCEL:AW?"touchcancel":"",RESIZE:AW?"orientationchange":"resize",CSS3_PREFIX:b,CSS3_BOXSHADOW:n,CSS3_TRANSFORM:Al,CSS3_TRANSITION:AN,CSS3_TRANSITION_PROPERTY:Ab,CSS3_TRANSITION_DURATION:AB,CSS3_TRANSITION_END:A,cssFeatures:{GRADIENTS:"gd",ROUND_CORNERS:"rc",TEXT_ROTATION:"tr",DROP_SHADOW:"sh"},htmlFeatures:{FILE_READER:"fr"},MOUSE_BUTTON:{LEFT:1,RIGHT:2},supports:function B(Aq){var Ar=this.isFF&&AS();switch(Aq){case this.cssFeatures.GRADIENTS:return(this.isIE||this.isIEW3C||this.isWK||Ar>=3.6||this.isWinPhone);case this.cssFeatures.ROUND_CORNERS:return(this.isWK||this.isFF||this.isWinPhone||this.isIE10);case this.cssFeatures.TEXT_ROTATION:case this.cssFeatures.DROP_SHADOW:return(this.isIE||this.isWK||Ar>=3.5||this.isWinPhone||this.isIE10||this.isIEW3C);case this.htmlFeatures.FILE_READER:return !!(window.FileReader);}return false;},getOSInfo:function AP(){var Av="Unknown",Ar=navigator.appVersion,Au=navigator.userAgent,At=Av;var Aq=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];var As;for(As=0;As<Aq.length;As++){var Ax=Aq[As];if(Ax.r.test(Au)){At=Ax.s;break;}}var Aw=Av;if(/Windows/.test(At)){Aw=/Windows (.*)/.exec(At)[1];At="Windows";}switch(At){case"Mac OS X":Aw=/Mac OS X (10[\.\_\d]+)/.exec(Au)[1];break;case"Android":Aw=/Android ([\.\_\d]+)/.exec(Au)[1];break;case"iOS":Aw=/OS (\d+)_(\d+)_?(\d+)?/.exec(Ar);Aw=Aw[1]+"."+Aw[2]+"."+(Aw[3]|0);break;}return{name:At,version:Aw};},transEndEvtNames:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},replace:function o(As,Aq){if(As&&Aq){var Ar=As.parentNode;if(Ar){Ar.replaceChild(Aq,As);}}return Aq;},attachEvent:function X(As,Ar,At,Aq){if(As.addEventListener){return As.addEventListener(Ar,At,!!Aq);}return As.attachEvent("on"+Ar,At);},detachEvent:function Aa(As,Ar,At,Aq){if(!As){return ;}if(As.removeEventListener){As.removeEventListener(Ar,At,!!Aq);}else{As.detachEvent("on"+Ar,At);}},attachMarkupEvent:function z(At,As,Aq){var Ar=function(Au){mstrmojo.all[At].captureDomEvent(Aq,window,Au);};this.attachEvent(As,Aq,Ar);return Ar;},attachOneTimeEvent:function W(At,Ar,Au,Aq){var As=function(Av){Au(Av);if(Aq){h(this,Ar,As);}else{mstrmojo.dom.detachEvent(this,Ar,As);}};if(Aq){m(At,Ar,As);}else{this.attachEvent(At,Ar,As);}At=null;return As;},attachMouseMoveEvents:function D(At,Aq){var As=this,Ar=function(Au){if(Aq){Aq(Au);}As.detachEvent(document,"mousemove",At);As.detachEvent(document,"mouseup",Ar);};As.attachEvent(document,"mousemove",At);As.attachEvent(document,"mouseup",Ar);},captureDomEvent:function AM(Av,At,Ar,Au,As){var Aq=mstrmojo.all[Av];if(Aq){Aq.captureDomEvent(At,Ar,Au,As);}},translate:function L(As,Ar,Av,Au,Aq,At){Aq=(Aq&&" "+Aq)||"";As.style[((mstrmojo.dom.isWinPhone||mstrmojo.dom.isIE9||mstrmojo.dom.isIE10)?"ms":"webkit")+"Transform"]=this.createTranslateString(Ar,Av,Au,At)+Aq;},createTranslateString:function P(Aq,At,As,Ar){Aq=AH(Aq);At=AH(At);As=AH(As);return AQ(Aq,At,As,Ar,"translate");},createScaleString:function x(Aq,At,As,Ar){Aq=Aq||0;At=At||0;As=As||0;return AQ(Aq,At,As,Ar,"scale");},_bufferSize:200,_bufferConnects:{},attachBufferedEvent:function C(As,Aq,At,Av){var Ar=As.id+"-"+Aq,Au=this._bufferConnects[Ar];if(!Au){Au=this._bufferConnects[Ar]={elId:As.id,eventName:Aq,timer:null,bufferSize:Av,listeners:[],callback:function(Aw){mstrmojo.dom._callback(Aw,mstrmojo.global,Ar);return true;}};this.attachEvent(As,Aq,Au.callback);}Au.listeners.push(At);},_callback:function Ah(Au,Aq,As){var At=this._bufferConnects[As],Av=At&&At.timer;if(At&&!Av){var Ar=(At.bufferSize===null)?this._bufferSize:At.bufferSize;if(At.bufferSize){At.timer=Aq.setTimeout(function(){mstrmojo.dom.updateBuffers(As);},Ar);}else{mstrmojo.dom.updateBuffers(As);}}},updateBuffers:function H(At){var Au=this._bufferConnects[At],Ar=Au&&Au.listeners,Aq=(Ar&&Ar.length)||0,As;for(As=0;As<Aq;As++){Ar[As]();}if(Au&&Au.timer){delete Au.timer;}},detachBufferedEvent:function AE(Ar,Av,Aw){if(!Ar){return ;}var Ay=Ar.id+"-"+Av,As=this._bufferConnects[Ay],Au=As&&As.listeners,Ax=(Au&&Au.length)||0,At;if(Ax){for(At=Ax-1;At>-1;At--){if(Au[At]===Aw){Au.splice(At,1);}}if(!Au.length){this.detachEvent(Ar,Av,As.callback);delete this._bufferConnects[Ay];if(As.timer){var Aq=mstrmojo.global;Aq.clearTimeout(As.timer);}}}},eventTarget:function AC(Aq,Ar){Ar=AK(Aq,Ar);return Ar.target||Ar.srcElement;},isMac:function AA(){return this.getOSInfo().name.toLowerCase().indexOf("mac")>=0;},isMetaKey:function J(Aq,At){var As=this.getOSInfo().name.toLowerCase().indexOf("mac")>=0,Ar=AK(Aq,At)||{};return(Ar.ctrlKey&&!As)||(Ar.metaKey&&As);},ctrlKey:function Ak(Aq,Ar){return(AK(Aq,Ar)||{}).ctrlKey;},shiftKey:function AD(Aq,Ar){return(AK(Aq,Ar)||{}).shiftKey;},metaKey:function Z(Aq,Ar){return(AK(Aq,Ar)||{}).metaKey;},getButton:function AU(Aq,Ar){return((Number(AK(Aq,Ar).button))===2)?2:1;},isPrimaryMouseBtn:function Af(Ar,Aq){return this.getButton(Aq||window,Ar)===1;},getMousePosition:function k(At,As){As=As||window;var Ar,Aw;if(mstrmojo.dom.isIE){At=At||As.event;var Au=document,Aq=Au.body,Av=Au.documentElement;Ar=At.clientX+Aq.scrollLeft+(Av.scrollLeft||0);Aw=At.clientY+Aq.scrollTop+(Av.scrollTop||0);}else{Ar=At.pageX;Aw=At.pageY;}return{x:Ar,y:Aw};},position:function AV(Ar,As){var Av={x:0,y:0,w:0,h:0};if(Ar&&Ar.getBoundingClientRect){try{Av=Ar.getBoundingClientRect();}catch(Au){Av={left:0,top:0,right:0,bottom:0,height:0,width:0};}Av={x:Av.left,y:Av.top,w:Av.right-Av.left,h:Av.bottom-Av.top};if(this.isIE6||this.isIE7){var Aq=Ar.ownerDocument;if(Aq){var Ax=Aq.documentElement,Aw=Ax.getBoundingClientRect();Av.x-=Aw.left;Av.y-=Aw.top;}}}if(As){var At=AY();Av.x+=At.x;Av.y+=At.y;}return Av;},delta:function F(As,Aq){Aq=Aq||document.body;var Ar=this.position(As),At=this.position(Aq);return{x:Math.round(Ar.x-At.x),y:Math.round(Ar.y-At.y)};},windowDim:function Q(){var Aq=0,As=0,At=window,Au=document,Av=Au.documentElement,Ar=Au.body;if(typeof (At.innerWidth)=="number"&&typeof (At.innerHeight)=="number"){Aq=At.innerWidth;As=At.innerHeight;}else{if(Av&&(Av.clientWidth||Av.clientHeight)){Aq=Av.clientWidth;As=Av.clientHeight;}else{if(Ar&&(Ar.clientWidth||Ar.clientHeight)){Aq=Ar.clientWidth;As=Ar.clientHeight;}}}return{w:Aq,h:As};},center:function AL(Aq){w.call(this,Aq,V,V);},bottomCenter:function E(Aq){w.call(this,Aq,V,Ac);},clearBrowserHighlights:function K(Aq){Aq=Aq||self;if(!Aq.getSelection){var Aw=Aq.document,Av=Aw&&Aw.selection,At=Av&&Av.empty;if(At){try{Av.empty();}catch(As){}}}else{var Ar=Aq.getSelection,Au=Ar&&Aq.getSelection();if(Au&&!Au.isCollapsed){if(Au.empty){Au.empty();}else{if(Au.removeAllRanges){Au.removeAllRanges();}}}}},findAncestorByAttr:function AR(Au,As,Ar,Aq){var Av=Ar?Au:Au&&Au.parentNode;while(Av&&(Av!==Aq)){var At=Av.getAttribute&&Av.getAttribute(As);if(At!=null){return{node:Av,value:At};}Av=Av.parentNode;}return null;},findAncestorByName:function Aj(As,Av,Ar,Aq){Av=Av&&Av.toLowerCase();var At=Ar?As:As&&As.parentNode;while(At&&(At!==Aq)){var Au=At.nodeName;if(Au&&(Au.toLowerCase()===Av)){return At;}At=At.parentNode;}return null;},contains:function I(At,Au,Ar,Aq){var As=Au;if(!Ar){As=As.parentNode;}while(As){if(As===At){return true;}if(As===Aq){break;}As=As.parentNode;}return false;},toggleSelection:function Ap(Ar,Aq){Ar.setAttribute("unselectable",Aq?"off":"on");mstrmojo.css.toggleClass(Ar,"unselectable",!Aq);Ar.onselectstart=function(){return Aq;};if(!Aq){this.clearBrowserHighlights();}},preventDefault:function U(Aq,Ar){Ar=Ar||Aq.event;if(Ar.preventDefault){Ar.preventDefault();}else{Ar.returnValue=false;}},stopPropogation:function M(Aq,Ar){Ar=Ar||Aq.event;if(Ar.stopPropagation){Ar.stopPropagation();}else{Ar.cancelBubble=true;}},firstTouch:function AX(Aq,Ar){return Ar&&Ar.touches&&Ar.touches.length?Ar.touches[0]:(Ar||Aq.event);},firstChangedTouch:function Ad(Aq,Ar){return Ar&&Ar.changedTouches&&Ar.changedTouches.length?Ar.changedTouches[0]:(Ar||Aq.event);},isLandscape:function T(){return !this.supportsTouches||(Math.abs(window.orientation)===90);},findWidget:function AZ(Aq){while(Aq){var Ar=Aq.mstrmojoId;if(Ar!==null&&Ar!==undefined){return mstrmojo.all[Ar];}Aq=Aq.parentNode;}return null;},setCaret:function G(Aq,As){if(Aq.setSelectionRange){Aq.focus();Aq.setSelectionRange(As,As);}else{if(Aq.createTextRange){var Ar=Aq.createTextRange();Ar.move("character",As);Ar.select();}}},setInputSelection:function Y(Aq){if(Aq.select){Aq.focus();Aq.select();}else{if(Aq.createTextRange){Aq.createTextRange().select();}}},setElementSelection:function a(As){if(window.getSelection){var Aq=document.createRange(),Ar=window.getSelection();Aq.selectNodeContents(As);Ar.removeAllRanges();Ar.addRange(Aq);}else{if(document.body.createTextRange){var At=document.body.createTextRange();At.moveToElementText(As);At.select();}}},getHorizontalScroll:function Am(){return AY().x;},getVerticalScroll:function AF(){return AY().y;},removeNode:function Ag(As){var Ar=document.getElementById(As),Aq=Ar&&Ar.parentNode;if(Aq){return Aq.removeChild(Ar);}}});}());mstrmojo.mstr.EnumDataType={DataTypeUnknown:-1,DataTypeReserved:0,DataTypeInteger:1,DataTypeUnsigned:2,DataTypeNumeric:3,DataTypeDecimal:4,DataTypeReal:5,DataTypeDouble:6,DataTypeFloat:7,DataTypeChar:8,DataTypeVarChar:9,DataTypeLongVarChar:10,DataTypeBinary:11,DataTypeVarBin:12,DataTypeLongVarBin:13,DataTypeDate:14,DataTypeTime:15,DataTypeTimeStamp:16,DataTypeShort:21,DataTypeLong:22,DataTypeMBChar:23,DataTypeBool:24,DataTypePattern:25,DataTypeBigDecimal:30,DataTypeCellFormatData:31,DataTypeInt64:34};mstrmojo.vi.viz.EnumWidgetTypes={GRID:0,GRAPH_MATRIX:1,HEATMAP:2,NETWORK:3,IMAGELAYOUT:4,ESRIMAP:5,GOOGLEMAP:6,CUSTOM:7};mstrmojo.warehouse.EnumDataChangeEvents={DBROLES_REQUESTED:"dbRolesRequested",DBROLES_LOADED:"dbRolesLoaded",DBROLES_ADD:"dbRoleAdd",DBROLES_RENAME:"dbRoleRename",DBROLES_DELETE:"dbRoleDelete",DBROLE_SELECTION:"dbroleSelection",NAMESPACES_CHANGED:"namespacesChanged",NAMESPACES_REQUESTED:"namespacesRequested",DBTABLES_CHANGED:"dbTablesChange",DBTABLES_REQUESTED:"dbTablesRequested",DBTABLE_UPDATED:"dbTableUpdated",DBROLE_CHANGED:"dbRoleChanged",DBTABLES_USED:"dbTablesUsed",DBTABLES_ENABLED:"dbTablesEnabled"};(function(){function Q(U,R,S){if(U.nodeType===3&&R){return U;}else{var T=(R&&U.nodeType===1&&U.lastChild)?U.lastChild:F(U,S);return T?D(T,S):null;}}function F(S,R){return(S===R)?null:(S.previousSibling||F(S.parentNode,R));}function D(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.lastChild){return D(S.lastChild);}else{return D(F(S,R));}}}function I(R){return R.textContent||R.nodeValue||R.innerText;}function M(U,R,S){if(U.nodeType===3&&R){return U;}else{var T=(R&&U.nodeType===1&&U.firstChild)?U.firstChild:B(U,S);return T?E(T,S):null;}}function B(S,R){return(S===R)?null:(S.nextSibling||B(S.parentNode,R));}function E(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.firstChild){return E(S.firstChild);}else{return E(B(S,R));}}}mstrmojo.range=mstrmojo.provide("mstrmojo.range",{EDGE:{EDGE_BEGIN:1,EDGE_END:2,EDGE_MIDDLE:-1},getEdgeInfo:function P(T,U){var R=0,S;if(T.nodeType===1){if(window.getSelection){S=document.createRange();S.selectNode(T);R=S.toString().length;}else{S=document.body.createTextRange();S.moveToElementText(T);R=S.text.length;}}else{R=I(T).length;}return U===R?this.EDGE.EDGE_END:(U===0?this.EDGE.EDGE_BEGIN:this.EDGE.EDGE_MIDDLE);},collapseOnNode:function K(U,S){if(!U.offsetParent){return ;}var T=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(U);R.collapse(S);T.removeAllRanges();T.addRange(R);}else{R.moveToElementText(U);R.collapse(S);R.select();}},collapseOnTextNode:function L(U,V){var T=this.getSelection(),S=this.getRange();if(window.getSelection){var R=M(U,true);S.setStart(R,V);S.collapse(true);T.removeAllRanges();T.addRange(S);}else{S.moveToElementText(U);S.collapse(true);S.move("character",V);S.select();}},collapseOnTextNodeIE:function C(S,T){var U=M(S,true),R;while(U!==null){R=I(U).length;if(R>=T){this.collapseOnTextNode(U,T);break;}else{T-=R;U=M(U,false);}}},getRangeInfo:function J(X,e){var Z=null,k,c=this.getRange(),b;if(X&&X===c.startContainer){var g=c.startContainer.firstChild,U=g&&g.firstChild,d=U&&U.firstChild;if(d){c.setStart(d,c.startOffset);c.setEnd(d,c.endOffset);}}if(window.getSelection){var W=function(m,o,n){var l=m.cloneRange();l.collapse(n);l.setStartBefore(o);return l.toString().length;},S=c.startContainer,f=c.startOffset;if(S.nodeType===1){f=W(c,S,true);}Z={collapsed:c.collapsed,startContainer:S,startOffset:e?e.startOffset:f};if(!c.collapsed){var V=c.endContainer,R=c.endOffset;if(V.nodeType===1){R=W(c,V,false);}Z.endContainer=V;Z.endOffset=R;}Z.range=c;}else{var j,a,Y=function(o,p){var n=o.duplicate(),l=document.body.createTextRange(),m;n.collapse(p);m=n.parentElement();l.moveToElementText(m);l.setEndPoint("EndToStart",n);return{container:m,offset:l.text.length};},h=Y(c,true),T;Z={collapsed:(c.compareEndPoints("StartToEnd",c)===0),startContainer:h.container,startOffset:h.offset};if(!Z.collapsed){T=Y(c,false);Z.endContainer=T.container;Z.endOffset=T.offset;}}return Z;},collapse:function O(S){if(window.getSelection){var T=this.getSelection();if(S){T.collapseToStart();}else{T.collapseToEnd();}}else{var R=this.getRange();R.collapse(S);R.select();}},selectSingleNode:function H(T){var S=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(T);S.removeAllRanges();S.addRange(R);}else{R.moveToElementText(T);R.select();}},selectMultipleNodes:function N(W,S,X,U){var V=this.getSelection(),T=this.getRange();if(window.getSelection){T.setStart(W,S);T.setEnd(X,U);V.removeAllRanges();V.addRange(T);}else{W=(W.nodeType===3)?W.parentNode:W;T.moveToElementText(W);T.move("character",S);X=(X.nodeType===3)?X.parentNode:X;var R=document.body.createTextRange();R.moveToElementText(X);R.move("character",U);T.setEndPoint("EndToStart",R);T.select();}},getSelection:function G(){if(window.getSelection){return window.getSelection();}else{return document.selection;}},getRange:function A(){if(window.getSelection){selection=window.getSelection();if(selection.rangeCount>0){return selection.getRangeAt(0);}else{return document.createRange();}}else{return document.selection.createRange();}}});}());(function(){var C="xviPopopNode";function A(G){var H={};H[C]=G;return H;}mstrmojo.ui.menus._IsMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._IsMenuPopup",{init:function E(G){this._super(G);var J=this.popupConfig;if(!J){throw new Error("Cannot instantiate popup without supplying the popupConfig property.");}this.addDisposable(J);var H=mstrmojo.all[J.hostId],I=J.hostElement;if(J.isHostedWithin&&H&&I){H.addSlots(A(I));this.slot=C;}},closeAllMenus:function F(){var G=this.opener;if(G&&G.closePopup){G.closePopup();}if(G&&G.closeAllMenus){G.closeAllMenus();}},open:function B(H,G){if(this._super){this._super(H,G);}},close:function D(G){if(this.slot===C){this.opener.removeSlots(A(null));}if(this._super){this._super(G);}this.destroy();var H=mstrmojo.all[this.popupConfig.hostId];if(H){H.closePopup();}}});}());mstrmojo.qb.EnumQBAppType={EmmaSingleTable:368,QueryBuilder:352,FFSQL:304,BigQuery:341,BigQueryFFSQL:342,BigQuerySingleTable:345,BISource:400,MDX:2};mstrmojo.EnumAuthenticationModes={DEFAULT:0,STANDARD:1,NTCREDENTIAL:2,PASSTHRU:4,ANONYMOUS:8,LDAP:16,DATABASE:32,PLUGIN:64,INTEGRATED:128,USHER:256};(function(){var J=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.bigquery._BigQueryController=mstrmojo.provide("mstrmojo.qb.bigquery._BigQueryController",{loadDBRoles:function H(K){this.model.loadDBRoles(K);},getNameSpaces:function D(K){this.model.selectedDataset=undefined;this.model.getDatasets(K);},setSelectedDBRoleID:function G(K){this.model.set("selectedProject",K.id);},setNameSpaceID:function E(K){this.model.set("selectedDataset",K);},handleLogout:function F(){mstrApp.container.unloadQB();mstrApp.getRootController().afterBigQueryProcess(false);},handleDBTableRefresh:function B(){var K=this.model,L=K.selectedProject;if(!L||!K.selectedDataset){return ;}K.catalogRefresh=true;K.getDatasetTables({blockBegin:0,blockCount:1000,filterText:""});},availableTableSearch:function C(K){this.model.getDatasetTables({blockBegin:0,blockCount:1000,filterText:K});},getProjectPrimaryDBRoleID:function I(){return this.model.selectedProject;},onHelpButtonClick:function A(){mstrApp.showHelpTopic("Importing_data_from_Google_BigQuery.htm");}});}());(function(){mstrmojo._HasPopup=mstrmojo.provide("mstrmojo._HasPopup",{_mixinName:"mstrmojo._HasPopup",_lastOpened:null,openPopup:function A(G,E){var C=!!G&&(typeof G==="string")&&!G.match(/\./)&&!!this[G],D=mstrmojo.registry.ref(C?this[G]:G);if(D&&D.open){if(C){this[G]=D;}if(D.disposable!==false){this.addDisposable(D);}var J=D.slot&&this[D.slot];if(J){if(D.parent!==this){if(this.addChildren){this.addChildren([D]);}else{var I=false,F=D.domNode||D.placeholder;if(F&&typeof F==="string"){F=document.getElementById(F);}if(!F){I=true;F=document.createElement("span");D.placeholder=F;}if(I||(F.parentNode!==J)){J.appendChild(F);}}}}try{D.open(this,E);}catch(H){console.log("Error opening popup: "+H);}this._lastOpened=D;}},closePopup:function B(){var C=this._lastOpened;if(C&&C.visible&&C.close){C.close();delete this._lastOpened;}}});}());var STR_BYTE_LEN=mstrmojo.desc(9660,"Byte length:"),STR_BIT_LEN=mstrmojo.desc(11456,"Bit length:"),STR_PREC=mstrmojo.desc(9659,"Precision:"),STR_SCL=mstrmojo.desc(9662,"Scale:"),STR_TM_SCL=mstrmojo.desc(9661,"Time scale:");var byteLength={txt:STR_BYTE_LEN,field:"ps"},bitLength={txt:STR_BIT_LEN,field:"ps"},precision={txt:STR_PREC,field:"ps"},scale={txt:STR_SCL,field:"sc"},timeScale={txt:STR_TM_SCL,field:"ps"};mstrmojo.architect.EnumColumnDataTypes={"-1":{id:-1,n:mstrmojo.desc(4444,"unknown"),options:[]},0:{id:0,n:"Reserved",options:[]},1:{id:1,n:"Integer",options:[byteLength]},2:{id:2,n:"Unsigned",options:[byteLength]},3:{id:3,n:"Numeric",options:[precision,scale]},4:{id:4,n:"Decimal",options:[precision,scale]},5:{id:5,n:"Real",options:[]},6:{id:6,n:"Double",options:[]},7:{id:7,n:"Float",options:[bitLength]},8:{id:8,n:"Char",options:[byteLength]},9:{id:9,n:"VarChar",options:[byteLength]},10:{id:10,n:"LongVarChar",options:[byteLength]},11:{id:11,n:"Binary",options:[byteLength]},12:{id:12,n:"VarBin",options:[byteLength]},13:{id:13,n:"LongVarBin",options:[byteLength]},14:{id:14,n:"Date",options:[]},15:{id:15,n:"Time",options:[timeScale]},16:{id:16,n:"TimeStamp",options:[timeScale]},17:{id:17,n:"NChar",options:[byteLength]},18:{id:18,n:"NVarChar",options:[byteLength]},30:{id:30,n:"Big Decimal",options:[precision,scale]},34:{id:34,n:"Big Integer",options:[byteLength]}};(function(){mstrmojo.cookies={};var C="%26",E="%3D",B=mstrmojo.cookies,D=function(){var F=document.cookie;if(!F||!(typeof F==="string")||F.indexOf("bSet")<0){return false;}return true;},A=function(){var F=document.cookie;F=F.split(";");for(s in F){if(F[s].indexOf("bSet")>=0){return F[s];}}return null;};mstrmojo.cookies.updateCookieSetting=function(H,N,J){try{if(!D()&&!J){return ;}var K=document.cookie,M=H+E+N+C;if(K.indexOf(H)>=0){var F=H+E,G=F+(B.getCookieSetting(H)||0),I=F+N;if(I!=G){document.cookie=K.replace(G,I);}}else{if(K.indexOf("bSet")>=0){document.cookie=K.replace("bSet=","bSet="+M);}else{if(J){document.cookie="bSet="+M+";"+K;}}}}catch(L){mstrmojo.alert(L);return ;}};mstrmojo.cookies.getCookieSetting=function(F){try{return B.getCookieList()[F];}catch(G){mstrmojo.alert(G);return ;}};mstrmojo.cookies.getCookieList=function(){try{if(!D()){return[];}var G=A(),F={},H=null;G=G.replace("bSet=","").split(C);for(H in G){H=G[H].split(E);F[H[0]]=H[1];}return F;}catch(I){mstrmojo.alert(I);return ;}};mstrmojo.cookies.enabledCookieOnBrowser=function(){var F=document.cookie;if(!F||!(typeof F==="string")){return false;}return true;};})();mstrmojo.qb.EnumMenuActions={NONE:0,DELETE_JOIN:1,SET_INNER_JOIN:2,SET_LEFT_OUTER_JOIN:3,SET_RIGHT_OUTER_JOIN:4,SET_OUTER_JOIN:5,MORE_JOIN_OPTION:6,SET_EXPRESSION:7,SET_AGGREGATION_FUNCTION:8,SET_FILTER:9};mstrmojo.qb.EnumDataChangeEvents={TABLES_SELECTED:"tablesSelected",TABLES_ADDED:"tablesAdded",TABLES_LOADED:"tablesLoaded",TABLE_CHANGED:"tableChanged",DBROLE_CHANGED:"dbRoleChanged",RENAME:"rename",REMOVE:"remove",JOIN_CHANGED:"joinChanged"};mstrmojo.LoadedExternalJSURLs={};function LoadScriptsExternalJSCallback(){mstrmojo.LoadedExternalJSURLs[mstrmojo._LoadsScript.esScripts.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(mstrmojo._LoadsScript.esScripts,mstrmojo._LoadsScript.callback,mstrmojo._LoadsScript.esScritsContext);mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=false;}mstrmojo._LoadsScript=mstrmojo.provide("mstrmojo._LoadsScript",{_meta_usesSuper:false,requiresMethod:function requiresMethod(B){if(!B){return false;}if(typeof this[B]==="function"){return true;}var A=this[B]||(this.methods&&(this.methods[B]||this.methods["*"]));if(typeof A==="string"){this.requiresCls(A);return typeof this[B]==="function";}return false;},requiresCls:function req(mixins,callback){if(mixins){if(typeof mixins==="string"){mixins=[mixins];}mstrmojo.requiresCls.apply(mstrmojo,mixins);var p=this.constructor.prototype,pm=p.mixins;if(!pm){p.mixins={};pm=p.mixins;}var mx=mstrmojo.mixin,i,len;for(i=0,len=mixins.length;i<len;i++){var fqcn=mixins[i];if(!pm[fqcn]){var m=eval(mixins[i]);mx(m,p);pm[fqcn]=true;if(m.__onmixin__){m.__onmixin__.apply(this,[]);}}}if(callback){callback.apply(this,[]);}}},requiresContrib:function reqCb(C,B){var A=this[C];if(A){var E,D=false;if(typeof A==="string"){E=mstrmojo.registry.ref(A);this[C]=E;D=true;}else{E=A;}if(E&&(D||B)){E.parent=this;if(E.startup){E.startup();}}return E;}return null;},requiresExternalScripts:function requiresExternalScripts(F,G,C){if(F&&F instanceof Array){if(F.length===0){if(G){G.call(C);}return false;}if(F[0]&&F[0].forceReload===false&&mstrmojo.LoadedExternalJSURLs[F[0].url]){F.splice(0,1);return this.requiresExternalScripts(F,G,C);}var A=document.createElement("script"),D=!!document.all,B=F[0].url;if(B.substr(0,7)==="file://"){B=B.substr(7);}else{if(mstrApp.isSingleTier&&B.substr(0,4)!=="http"){B="http:"+B;}}A.type="text/javascript";A.src=B;if(!F[0].callbackParamName){if(D){A.onreadystatechange=function(){if(A.readyState==="loaded"||A.readyState==="complete"){A.onreadystatechange=null;if(F.length>1){mstrmojo.LoadedExternalJSURLs[F.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(F,G);}else{if(F.length===1){mstrmojo.LoadedExternalJSURLs[F[0].url]=true;if(G){G.call(C);}}}}};}else{A.onload=function(){A.onload=null;if(F.length>1){mstrmojo.LoadedExternalJSURLs[F.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(F,G);}else{if(F.length===1){mstrmojo.LoadedExternalJSURLs[F[0].url]=true;if(G){G.call(C);}}}};}}else{if(F[0].callbackParamName.length!==0){if(mstrmojo._LoadsScript.ExternalJSCallbackIsBusy&&mstrmojo._LoadsScript.ExternalJSCallbackIsBusy===true){var E=this;window.setTimeout(function(){E.requiresExternalScripts(F,G,C);},500);return ;}mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=true;A.src+="&"+F[0].callbackParamName+"=LoadScriptsExternalJSCallback";mstrmojo._LoadsScript.esScripts=F;mstrmojo._LoadsScript.callback=G;mstrmojo._LoadsScript.esScritsContext=C;}}document.getElementsByTagName("head")[0].appendChild(A);}}});(function(){mstrmojo.DI.ProgressPolyfill=mstrmojo.provide("mstrmojo.DI.ProgressPolyfill",{createProgressPolyfill:function(){if("position" in document.createElement("progress")){return ;}var C,B=true;if(Object.defineProperty){C=function(L,J,I){I.enumerable=true;I.configurable=true;try{Object.defineProperty(L,J,I);}catch(K){if(K.number===-2146823252){I.enumerable=false;Object.defineProperty(L,J,I);}}};}else{if("__defineSetter__" in document.body){C=function(K,J,I){K.__defineGetter__(J,I.get);if(I.set){K.__defineSetter__(J,I.set);}};}else{C=function(K,J,I){K[J]=I.get.call(K);};B=false;}}try{[].slice.apply(document.images);var A=function(I){return[].slice.apply(I);};}catch(G){var A=function(L){var J=[],I=L.length;for(var K=0;K<I;K++){J[K]=L[K];}return J;};}var F=(function(){var I=document.createElement("div");I.foo="bar";return I.getAttribute("foo")==="bar";})();var D=window.ProgressPolyfill={DOMInterface:{max:{get:function(){return parseFloat(this.getAttribute("aria-valuemax"))||1;},set:function(I){this.setAttribute("aria-valuemax",I);if(!F){this.setAttribute("max",I);}D.redraw(this);}},value:{get:function(){return parseFloat(this.getAttribute("aria-valuenow"))||0;},set:function(I){this.setAttribute("aria-valuenow",I);if(!F){this.setAttribute("value",I);}D.redraw(this);}},position:{get:function(){return this.hasAttribute("aria-valuenow")?this.value/this.max:-1;}},labels:{get:function(){var I=this.parentNode;while(I&&!/^label$/i.test(I.nodeName)){I=I.parentNode;}var K=I?[I]:[];if(this.id&&document.querySelectorAll){var J=A(document.querySelectorAll('label[for="'+this.id+'"]'));if(J.length){K=K.concat(J);}}return K;}}},redraw:function H(I){if(!D.isInited(I)){D.init(I);}else{if(!F){I.setAttribute("aria-valuemax",parseFloat(I.getAttribute("max"))||1);if(I.hasAttribute("value")){I.setAttribute("aria-valuenow",parseFloat(I.getAttribute("value"))||0);}else{I.removeAttribute("aria-valuenow");}}}if(I.position!==-1){I.style.paddingRight=I.offsetWidth*(1-I.position)+"px";}},isInited:function(I){return I.getAttribute("role")==="progressbar";},init:function(I){if(D.isInited(I)){return ;}I.setAttribute("role","progressbar");I.setAttribute("aria-valuemin","0");I.setAttribute("aria-valuemax",parseFloat(I.getAttribute("max"))||1);if(I.hasAttribute("value")){I.setAttribute("aria-valuenow",parseFloat(I.getAttribute("value"))||0);}for(var J in D.DOMInterface){C(I,J,{get:D.DOMInterface[J].get,set:D.DOMInterface[J].set});}D.redraw(I);},progresses:document.getElementsByTagName("progress")};for(var E=D.progresses.length-1;E>=0;E--){D.init(D.progresses[E]);}if(document.addEventListener){document.addEventListener("DOMAttrModified",function(I){var K=I.target,J=I.attrName;if(/^progress$/i.test(K.nodeName)&&(J==="max"||J==="value")){D.redraw(K);}},false);document.addEventListener("DOMNodeInserted",function(I){var J=I.target;if(/^progress$/i.test(J.nodeName)){D.init(J);}},false);}}});})();mstrmojo.vi.viz.EnumVizStyles={GRAPH_MATRIX:"GraphMatrixVisualizationStyle",NETWORK:"NetworkVisualizationStyle",HEAT_MAP:"VIHeatMapVisualizationStyle",GOOGLE_MAP:"GoogleMapVisualizationStyle",ESRI_MAP:"ESRIMapVisualizationStyle",IMAGE_LAYOUT:"ImageLayoutVisualizationStyle"};mstrmojo.chart.model.enums.EnumDSSObjectType={DssTypeUnknown:-1,DssTypeReserved:0,DssTypeGeneric:5,DssTypeFormatBAD:46,DssTypeFilter:1,DssTypeTemplate:2,DssTypeReportDefinition:3,DssTypeMetric:4,DssTypeStyle:6,DssTypeAggMetric:7,DssTypeFolder:8,DssTypeDevice:9,DssTypePrompt:10,DssTypeFunction:11,DssTypeAttribute:12,DssTypeFact:13,DssTypeDimension:14,DssTypeTable:15,DssTypeDatamartReport:16,DssTypeFactGroup:17,DssTypeShortcut:18,DssTypeResolution:19,DssTypeMonitor:20,DssTypeAttributeForm:21,DssTypeSchema:22,DssTypeFormat:23,DssTypeCatalog:24,DssTypeCatalogDefn:25,DssTypeColumn:26,DssTypePropertyGroup:27,DssTypePropertySet:28,DssTypeDBRole:29,DssTypeDBLogin:30,DssTypeDBConnection:31,DssTypeProject:32,DssTypeServerDef:33,DssTypeUser:34,DssTypeTransmitter:35,DssTypeConfiguration:36,DssTypeRequest:37,DssTypeScript:38,DssTypeSearch:39,DssTypeSearchFolder:40,DssTypeDatamart:41,DssTypeFunctionPackageDefinition:42,DssTypeRole:43,DssTypeSecurityRole:44,DssTypeLocale:45,DssTypeConsolidation:47,DssTypeConsolidationElement:48,DssTypeScheduleEvent:49,DssTypeScheduleObject:50,DssTypeScheduleTrigger:51,DssTypeLink:52,DssTypeDbTable:53,DssTypeTableSource:54,DssTypeDocumentDefinition:55,DssTypeDrillMap:56,DssTypeDBMS:57,DssTypeMDSecurityFilter:58,DssTypePromptAnswer:59,DssTypePromptAnswers:60,DssTypeGraphStyle:61,DssTypeChangeJournalSearch:62,DssTypeNCSObjects:255,DssTypeReservedLastOne:63};mstrmojo.mstr.EnumFunction={FunctionCustom:-1,FunctionReserved:0,FunctionPlus:1,FunctionMinus:2,FunctionTimes:3,FunctionDivide:4,FunctionUnaryMinus:5,FunctionEquals:6,FunctionNotEqual:7,FunctionGreater:8,FunctionLess:9,FunctionGreaterEqual:10,FunctionLessEqual:11,FunctionSum:12,FunctionCount:13,FunctionAvg:14,FunctionMin:15,FunctionMax:16,FunctionBetween:17,FunctionLike:18,FunctionAnd:19,FunctionOr:20,FunctionNot:21,FunctionIn:22,FunctionRank:23,FunctionAbs:24,FunctionRunningSum:25,FunctionRunningAvg:26,FunctionMovingSum:28,FunctionMovingAvg:27,FunctionProduct:29,FunctionMedian:30,FunctionMode:31,FunctionStdev:32,FunctionVar:33,FunctionGeomean:34,FunctionEqualEnhanced:35,FunctionNotEqualEnhanced:36,FunctionGreaterEqualEnhanced:37,FunctionLessEqualEnhanced:38,FunctionBetweenEnhanced:39,FunctionBanding:40,FunctionBandingC:41,FunctionBandingP:42,FunctionNotLike:43,FunctionNotBetween:44,FunctionIntersect:45,FunctionIntersectIn:46,FunctionNullToZero:47,FunctionZeroToNull:48,FunctionApplySimple:49,FunctionApplyAggregation:50,FunctionApplyLogic:51,FunctionApplyComparison:52,FunctionApplyRelative:53,FunctionIsNull:54,FunctionIsNotNull:55,FunctionUcase:56,FunctionNotIn:57,FunctionNTile:58,FunctionPercentile:59,FunctionMovingMax:60,FunctionMovingMin:61,FunctionMovingDifference:62,FunctionMovingStdev:63,FunctionExpWghMovingAvg:64,FunctionMovingCount:65,FunctionRunningMax:66,FunctionRunningMin:67,FunctionRunningStdev:68,FunctionRunningCount:69,FunctionExpWghRunningAvg:70,FunctionNotBetweenEnhanced:71,FunctionConcat:72,FunctionFirstInRange:73,FunctionLastInRange:74,FunctionValueSegment:75,FunctionContains:76,FunctionBeginsWith:77,FunctionEndsWith:78,FunctionNotContains:79,FunctionNotBeginsWith:80,FunctionNotEndsWith:81,FunctionCase:82,FunctionCaseV:83,FunctionStdevP:84,FunctionRunningStdevP:85,FunctionMovingStdevP:86,FunctionNTileS:87,FunctionNTileVS:88,FunctionVarP:89,FunctionCurrentDate:90,FunctionDayOfMonth:91,FunctionDayOfWeek:92,FunctionDayOfYear:93,FunctionWeek:94,FunctionMonth:95,FunctionQuarter:96,FunctionYear:97,FunctionCurrentDateTime:98,FunctionCurrentTime:99,FunctionHour:100,FunctionMinute:101,FunctionSecond:102,FunctionMilliSecond:103,FunctionConcatNoBlank:104,FunctionLength:105,FunctionLower:106,FunctionLTrim:107,FunctionPosition:108,FunctionRTrim:109,FunctionSubStr:110,FunctionInitCap:111,FunctionTrim:112,FunctionRightStr:113,FunctionLeftStr:114,FunctionGreatest:115,FunctionLeast:116,FunctionFirst:117,FunctionLast:118,FunctionAdd:134,FunctionAverage:135,FunctionMultiply:136,FunctionBandingM:137,FunctionOLAPSum:138,FunctionOLAPAvg:139,FunctionOLAPCount:140,FunctionOLAPMax:141,FunctionOLAPMin:142,FunctionLag:143,FunctionLead:144,FunctionPercentRank:166,FunctionTuple:1000};(function(){mstrmojo.DI.OneTierServerTransport={serverRequest:function A(E,D,C){window.FormWrapper.serverRequest(D,JSON.stringify(C.params),E,"response");},cancelRequest:function B(C){return false;}};}());mstrmojo.vi.viz.EnumVisualizationTemplates={UNKNOWN_GRAPHMATRIX_TYPE:-1,GRID:0,HEATMAP:1,GOOGLEMAP:2,PIE:3,RING:4,GRAPHMATRIXVERTICALBARSTACKED:6,GRAPHMATRIXVERTICALBARCLUSTERED:7,GRAPHMATRIXVERTICALBARPERCENT:8,GRAPHMATRIXHORIZONTALBARSTACKED:9,GRAPHMATRIXHORIZONTALBARCLUSTERED:10,GRAPHMATRIXHORIZONTALBARPERCENT:11,GRAPHMATRIXVERTICALLINESTACKED:12,GRAPHMATRIXVERTICALLINECLUSTERED:13,GRAPHMATRIXVERTICALLINEPERCENT:14,GRAPHMATRIXHORIZONTALLINESTACKED:15,GRAPHMATRIXHORIZONTALLINECLUSTERED:16,GRAPHMATRIXHORIZONTALLINEPERCENT:17,GRAPHMATRIXSCATTERCIRCLEMM:18,GRAPHMATRIXSCATTERGRIDCIRCLEAA:19,GRAPHMATRIXBUBBLECIRCLEMM:21,GRAPHMATRIXBUBBLEGRIDCIRCLEAA:22,GRAPHMATRIXSCATTERSQUAREAM:23,GRAPHMATRIXSCATTERSQUAREMM:24,GRAPHMATRIXSCATTERGRIDSQUAREAA:25,GRAPHMATRIXBUBBLESQUAREAM:26,GRAPHMATRIXBUBBLESQUAREMM:27,GRAPHMATRIXBUBBLEGRIDSQUAREAA:28,GRAPHHORIZONTALBARCLUSTERED:29,GRAPHMATRIXVERTICALAREASTACKED:30,GRAPHMATRIXVERTICALAREAPERCENT:31,GRAPHMATRIXVERTICALAREACLUSTERED:32,GRAPHMATRIXHORIZONTALAREASTACKED:40,GRAPHMATRIXHORIZONTALAREAPERCENT:41,GRAPHMATRIXHORIZONTALAREACLUSTERED:42,GRAPHHORIZONTALBARDUALAXISCLUSTERED:33,GRAPHHORIZONTALBARDUALAXISABSOLUTE:34,GRAPHHORIZONTALLINEABSOLUTE:35,GRAPHHORIZONTALLINEDUALAXISABSOLUTE:36,GRAPHHORIZONTALAREAABSOLUTE:37,GRAPHHORIZONTALAREADUALAXISABSOLUTE:38,GRAPHVERTICALBARCLUSTERED:39,GRAPHVERTICALBARDUALAXISCLUSTERED:43,GRAPHVERTICALBARDUALAXISABSOLUTE:44,GRAPHVERTICALBARDUALAXISSTACKED:45,GRAPHVERTICALLINEABSOLUTE:46,GRAPHVERTICALLINESTACKED:47,GRAPHVERTICALLINEPERCENT:48,GRAPHVERTICALLINEDUALAXISABSOLUTE:49,GRAPHVERTICALLINEDUALAXISSTACKED:50,GRAPHVERTICALAREAABSOLUTE:51,GRAPHVERTICALAREAPERCENT:52,GRAPHVERTICALAREASTACKED:53,GRAPHVERTICALAREADUALAXISABSOLUTE:54,GRAPHVERTICALAREADUALAXISSTACKED:55,GRAPHCOMBINATIONBARAREA:56,GRAPHCOMBINATIONBARAREADUALAXIS:57,NETWORK:58,IMAGELAYOUT:59,GOOGLEMAPDENSITY:60,GRAPHMATRIXPIE:61,GRAPHMATRIXRING:62,GRAPHHORIZONTALBARABSOLUTE:63,GRAPHHORIZONTALBARPERCENT:64,GRAPHHORIZONTALBARSTACKED:65,GRAPHVERTICALBARABSOLUTE:66,GRAPHVERTICALBARPERCENT:67,GRAPHVERTICALBARSTACKED:68,ESRIMAP:69,GRAPHMATRIXVERTICALBARAUTOMATIC:70,GRAPHMATRIXHORIZONTALBARAUTOMATIC:71,GRAPHMATRIXVERTICALLINEAUTOMATIC:72,GRAPHMATRIXHORIZONTALLINEAUTOMATIC:73,GRAPHMATRIXVERTICALAREAAUTOMATIC:74,GRAPHMATRIXHORIZONTALAREAAUTOMATIC:75};(function(){mstrmojo.DI.DIConstants=mstrmojo.provide("mstrmojo.DI.DIConstants",{invalidObjectNameChars:'\\"[]',invalidObjectNameCharsRegex:/[\\"\[\]]/,sourceItemLinkType:{dbList:0,oauthPara:1},setDefaultOAuthParamCMD:"MSTR_DEFAULT_OAUTH_PARAMS",actions:{none:0,importSource:1,editImport:2,transform:3,changeSheet:4,publish:5,changeMappings:6,refine:7,quickPreview:8,savePublish:9,getFlatPreview:10,refreshData:11},requestFlag:{mapping:1,preview:2,sourceInfo:4,refineSourceInfo:8,sheets:16,crb:32,transformations:64,transformedPreview:128,relationship:256,stateInfo:512,anyState:268435456,fullData:1024,refineInnerData:2048},formMappingFlag:{formMappingFlagReserved:0,formMappingFlagRemoveGeoRole:1,formMappingFlagRemoveTimeRole:2,formMappingFlagRemoveDeriveFlags:4},browseFlag:{reportBindingTable:1,dataPreview:4,publish:16,cubeConfig:68,reportLevelProperty:256},importBehaviorFlag:{reserved:0,newColumnsSilent:1,dataTypeSilent:2},saveAsFlags:{saveAsOverWrite:32,saveAsManaged:524288,saveAsDDA:33554432,saveAsInMemory:67108864,saveAsWithPrompts:4096,saveAsWithAnswers:4},connectLiveSupport:{connectLiveSupportUnknown:0,connectLiveSupportDDAOrInMemory:1,connectLiveSupportInMemoryOnly:2,connectLiveSupportDDAOnly:3},xdaType:{excel:272,text:288,refine:384,salesforce:337,querybuilder:352,ffsql:304,mdx:2,googleAnalytics:390,googleBigQuery:341,googleBigQueryFFSQL:342,googleBigQuerySingleTable:345,qbSingleTable:368,twitter:343,facebook:344,dataImport:256,projectsImport:400,dataImportFileExcel:16|256,dataImportFileText:32|256,dataImportCustomSQL:48|256,dataImportTable:64|256,dataImportOAuth:80|256,dataImportBISource:144|256,dataImportOAuthSalesforce:1|336,dataImportOAuthGDocs:2|336,dataImportOAuthGDrive:2|336,dataImportOAuthDropbox:3|336,dataImportOAuthGAnalytics:4|336,dataImportOAuthGBigQuery:5|336,dataImportOAuthGBigQueryFFSQL:6|336,dataImportOAuthGBigQuerySingleTable:9|336},sourceInfoDesc:{json:"DB_FILE_TYPE_JSON"},sourceType:{file:1,salesforce:2,dropbox:3,googleDrive:4,googleAnalytics:5,googleBigQuery:6,querybuilder:7,mstrFile:8,mdx:9,hadoop:10,twitter:11,facebook:12,bisource:13,remoteProject:14},sourceSubtype:{localFile:1,url:2,salesforce:3,dropbox:4,googleDrive:5,googleAnalytics:6,googleBigQuery:7,querybuilder:8,samplefile:9,clipboard:10,googleBigQueryFFSQL:11,searchOnSource:12,mdx:13,hadoop:14,twitter:15,facebook:16,bisource:17,remoteProject:18,googleBigQuerySingleTable:19,hanaSingleTable:20,publicData:21},backendSourceSubtype:{localFile:65537,url:65539,samplefile:65540,clipboard:65538,hadoopFileBrowser:65541,customSQL:131073,customSQLWizard:131074,singleTable:131075,bISources:131076,searchAsASource:131078,salesforce:196609,dropbox:196610,facebook:196611,twitter:196612,googleDrive:196613,googleAnalytics:196614,googleBigQuery:196615,googleBigQueryFFSQLModel:196616,googleBigQuerySingleTable:196617,OLAPSources:327681,publicData:65542},sourceItemType:{file:0,url:1,database:2,hadoop:3,olap:4,publicData:5,salesforce:6,googleAnalytics:7,googleBigQuery:8,googleDrive:9,dropbox:10,searchAsASource:11,clipboard:12,bISources:13,facebook:14,twitter:15,samplefile:16,unknow:-1},columnState:{reserved:0,unchanged:1,newColumn:2,missing:4,changed:8},operationMode:{create:0,edit:1,refresh:2,subscribe:3,enterCredentials:4,oauth:5},statusCode:{obtainSource:-2147071874,xformsError:-2147071872,mappingError:-2147071871,edit:1,republish:2,schedule:3,enterCredentials:4},pageType:{intro:0,file:1,database:2,emmaPreview:3,redirect:4,analytics:5,dataSelection:6,suggestNewSource:7,sourceIntro:8,sourceObjects:10,sampleFiles:11,dataset:12,externalPage:13,preview:14,clipboard:15,refine:16,parse:17,mstrFile:18,allProjectSource:19,hadoop:20,twitter:21,facebook:22,sourceObjectsDnD:23,schedule:24,publicData:25,republish:26,sourceAdmin:27},backendError:{overwriteObject:-2147212339,noPermission:-2147214579,invalidObjectName:-2147213715,unexpectedDataType:-2147212539,noExternalSession:-2147071844,noPrivilege:-2147212082,salesforceUnsavedReport:-2147212081,salesforceObsoleteReport:-2147212080,maxSizeExceeded:-2147212076,maxSizeExceededURL:-2147212121,salesforceUnresolvedFilter:-2147212074,incrementalRefresh:-2147212287,invalidUrl:-2147212062,fileVersionError:-2147212064,emptySheet:-2147212144,refreshTokenUnavailable:-2147202875,cubeQuotaExceeded:-2147071825,notEnoughSpace:-2147071811,importedURLInvalid:-2147212122,unsupportedFileFormat:-2147212063,objectNameTooLong:-2147217407,noExternalSourceInfo:-2147215346,memoryConsumptionExceeded:-2147215346,cubeQuotaReached:-2147071870,switchingFileType:-2147212140,memoryGovernSizeExceeded:-2147181051,stringTooLong:-2147213718,missingColumn:-2147071871,dataDiscoveryError:-2147211998,refineApplyError:-2147202299,serverOutOfMemory:-2147212055,columnCountMatchError:-2147467259,incompatibleDataTypeError:-2147211983,reportTimeout:-2147212335,requestTimeout:-2147206497,databaseCredentialsNotAvailable:-2147212037},transformation:{xtab:1,delimiter:2},application:{platform:"Platform",cloudPersonal:"Personal",cloudProfessional:"Professional"},refreshOptions:{replace:1,append:2,update:4},cubeRefreshType:{dummy:-1,reserved:0,add:1,remove:2,update:3,upsert:4,addNewTable:5,deleteTable:6,replaceTable:7,preserve:8},tableStatsExecutionAction:{reserved:0,forceExecution:1,ignore:4,requireFreshData:268435456},sourcesInfoFlags:{none:0,getReports:1,getUserName:2,getTokensInfo:4,revokeSession:8,getGAnalyticsAccount:64},queryBuilderType:{individualTable:1,multipleTables:2,queryScript:3},relationshipEditType:{create:1,changeERType:2,remove:3,flip:8001},ERType:{reserved:0,ERType11:1,ERType1M:2,ERTypeM1:3,ERTypeMM:4,ERTypeParallel:5,ERTypePerpendicular:6},RSType:{reserved:0,auto:1,geo:2,defined:3},tableStates:{newly:1,old:2},behaviorChangeFlag:{multiSheet:4,remapping:8,refreshData:16},menuItems:{SEPARATOR:-1,NONE:0,TABLE_RENAME:1,DO_NOT_IMPORT:2,FLIP_ORDER:3,DELETE:4,RELATIONSHIP_TYPE:5,ONE_TO_ONE:6,ONE_TO_MANY:7,MANY_TO_ONE:8,MANY_TO_MANY:9,REMOVE:10,REFRESH_DATA:11,REFINE:12,CANCEL_REFINE:13,UNLINK:14,CHANGE_DATA_TYPE:15,MARK_GEO_ROLES:16,CREATE_TIME_ATTRIBUTES:17,TO_METRIC:18,TO_ATTRIBUTE:19,MAP_TO_PROJECT_ATTRIBUTE:20,UNMAP:21,MODIFY_ATTRIBUTE_GROUP:22,CREATE_ATTRIBUTE_GROUP:23,HIDE_ALL_ATTRIBUTE_FORMS:24,DEFINE_RELATIONSHIPS:25,LINK:26,ITEM_RENAME:27,CREATE_MULTIFORM_ATTRIBUTE:28,EDIT_MULTIFORM_ATTRIBUTE:29,ADDTO_MULTIFORM_ATTRIBUTE:30,SHOW_ALL_ATTRIBUTE_FORMS:31,SHOW_ALL_COLUMNS:32,PARTITION:33,REFINE_RENAME:34,REFINE_DELETE:35,REFINE_DELETE_ALL:36,REFINE_RESET:37,REFINE_RESET_ALL:38,PARSE:39,IMPORT:40,UNLINK_ALL:41},dataTypeMenuItems:{DATE_TIME:"1",NUMBER:"2",TEXT:"3",URL:"5",EMAIL:"6",HTML_TAG:"7",DATE:"8",TIME:"9",SYMBOL:"10",BIG_DECIMAL:"11",PHONE_NUMBER:"12"},columnDataTypes:{reserved:0,integer:1,unsigned:2,numeric:3,decimal:4,real:5,dtdouble:6,dtfloat:7,dtchar:8,varChar:9,longVarChar:10,binary:11,varBin:12,longVarBin:13,date:14,dttime:15,timeStamp:16,nChar:17,nVarChar:18,nlong:22,bigDecimal:30,cellFormatData:31,utf8Char:33,int64:34},formsOptions:{CREATE_MULTIFORM_ATTRIBUTE:1,EDIT_MULTIFORM_ATTRIBUTE:2,ADDTO_MULTIFORM_ATTRIBUTE:3},timeRoles:{NONE:0,DATE:1,DATE_TIME:2,TIME:3,SECOND:4,MINUTE:5,HOUR:6,DAY:7,WEEK:8,MONTH:9,QUARTER:10,YEAR:11},contextMenuType:{ITEM_MENU:0,TABLE_MENU:1,PREVIEW_ITEM_MENU:2,LINK_MENU:3},dialogType:{fixRefreshErrorDialog:1,allObjectsViewDialog:2,missingColumnsDialog:3,diPageDialog:4,refreshHistoryDialog:5,alternateSourceValidateDialog:6,ddaConfirmDialog:7,publishStatusDialog:8,saveAsDialog:9,cubesList:10,refinePage:11,multiFormEditor:12,sheetsSelectionDialog:13,partitionGroupDialog:14,parseDataDialog:15,errorDialog:16,warningDialog:17,relationDefineDialog:18,qbImportOptionDialog:19,previewRenameDialog:20,mapProjectsAttributeDialog:21,setOAuthParaDialog:22,objectPicker:23,refineClusteringPage:24,refineExtractDialog:25,refineImportDialog:26,twitterAdvOptDialog:27,credentialsDialog:28,mapProjectsAttributeDialog2:29,setWhiteListDialog:30},dataEvents:{DATA_PREVIEW_EVENT:"dataReturned",NO_DATA_RETURNED_EVENT:"noDataReturned"},cubeSchedStatus:{unexecuted:1,successful:2,unscheduled:3,failed:4},privilegeType:{accessDatabase:1,accessFile:2,accessCloud:3},dbType:{MS_ACCESS:100,ORACLE:200,SQL_SERVER:300,INFORMIX:400,SYBASE:500,REDBRICK:600,DB2:700,TANDEM:800,TERADATA:900,UNKNOWN:1000,GENERIC:1100,SAP:1200,NETEZZA:1300,EXCEL:1400,MSFT_AS:1500,ESSBASE:1600,MYSQL:1700,POSTGRESQL:1800,HPNEOVIEW:1900,METAMATRIX:2000,DATALLEGRO:2100,COMPOSITE:2200,ASTER:2300,VERTICA:2400,OPENACCESS:2500,SYBASE_SQL_ANY:2600,SYBASE_IQ:2700,PARACCEL:2800,TM1:2900,XQUERY:3000,HIVE:3100,SAND:3200,SALESFORCE:3300,HIVETHRIFT:3400,VECTORWISE:3500,ENTERPRISEDB:3600,KOGNITIOWX2:3700,EXASOLUTION:3800,INFORMATICA:3900,SAPHANA:4000,IMPALA:4100,AMAZON_REDSHIFT:4200,DENODO:4300,GOOGLE_DRIVE:4400,DROPBOX:4500,GOOGLE_ANALYTICS:4600,GOOGLE_BIGQUERY:4700,CONNECTION_CLOUD:4800,GOOGLE_BIG_QUERY_FFSQL_MODEL:4900,PARSTREAM:5100,MONGODB:5200,MARKLOGIC:5300,BIG_DATA_ENGINE:5400,SEARCH_ENGINE_SOLR:5500,SPLUNK:5600,TWITTER:5700,FACEBOOK:5800,PIG:6400},getCubeQuotaAndInfosOptions:{GetCubeQuotaAndInfosReserved:0,GetCubeQuotaAndInfosDefault:1,GetCubeQuotaAndInfosQuotaOnly:2,GetCubeQuotaAndInfosAll:3,GetCubeQuotaAndInfosVI:4},homepageViewMode:{GRID_VIEW:0,LIST_VIEW:1},datasetServeMode:{inMemory:1,dda:2,unknow:3},cubePollStatus:{msgID:0,result:1,prompt:2,error:3,xmlResult:21},ibmDb2Versions:[17,18,21,22,23,24,25,37,45,46,47,48,63,66,74,89,92,101,103,105,123,134,157,172,202,232],hadoopDbTypes:[3100,1100,700,4100,7300,6800,6400]});}());(function(){mstrmojo.warehouse._CanToggleAvatarClass=mstrmojo.provide("mstrmojo.warehouse._CanToggleAvatarClass",{_mixinName:"mstrmojo.warehouse._CanToggleAvatarClass",getAvatarIconClass:function C(D){return"enabled";},ondragenter:function A(D){var E=D.src.widget;if(E&&E.toggleAvatarClass&&this.allowDrop(D)){E.toggleAvatarClass(this.getAvatarIconClass(D),true);}if(this._super){this._super(D);}},ondragleave:function B(D){var E=D.src.widget;if(E&&E.toggleAvatarClass&&this.allowDrop(D)){E.toggleAvatarClass(this.getAvatarIconClass(D),false);}if(this._super){this._super(D);}}});}());(function(){mstrmojo.Refine.RefineConstants=mstrmojo.provide("mstrmojo.Refine.RefineConstants",{transformationType:{Whitespace:0,TransformCell:1,Delete:2,Split:3,Extract:4,FindAndReplace:5,Facet:6,Other:7,RemoveText:8},transformationSubType:{TrimLeadingTrailingWhitespace:0,CollapseConsecutiveWhitespace:1,Titlecase:10,Uppercase:11,Lowercase:12,UnescapeHTML:13,ChangeDataType:14,FillDown:15,BlankDown:16,PadBefore:17,PadAfter:18,DeleteColumn:20,DeleteRow:21,RemoveDuplicateCells:22,RemoveDuplicateRows:23,DeleteRowsInTheView:24,DeleteRowsNotInTheView:25,SplitByFixedLength:30,SplitOnSeparator:31,SplitBeforeSeparator:32,SplitAfterSeparator:33,SplitCellIntoRows:34,ExtractByFixedLength:40,ExtractBeforeSeparator:41,ExtractAfterSeparator:42,FindAndReplaceCharactersInCell:50,FindAndReplaceCell:51,TextFacet:60,NumericFacet:61,TimelineFacet:62,SearchFacet:63,ClusterAndEdit:70,Duplicate:71,Rename:72,ConcatenateColumns:73,TransposeColumnsToRows:74,RemoveTheText:80,RemoveTheTextBefore:81,RemoveTheTextAfter:82},menuItems:{SEPARATOR:-1,REFINE_RENAME:0,REFINE_DELETE:1,REFINE_DELETE_ALL:2,REFINE_RESET:3,REFINE_RESET_ALL:4,REFINE_SORT_NAME:5,REFINE_SORT_COUNT:6,REFINE_CLUSTER:7,REFINE_NUMERIC_FACET:8,REFINE_TEXT_FACET:9,REFINE_DUPLICATE:10,REFINE_FILL_DOWN:11,REFINE_TITLE_CASE:12,REFINE_UPPERCASE:13,REFINE_LOWERCASE:14,REFINE_DELETE_ROWS_IN_THE_VIEW:15,REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:16}});}());mstrmojo.warehouse.EnumDatabaseType={SAP:1200,MSAS:1500,EssBase:1600,TM1:2900,SAPHana:4000,BDE:5400,SearchEngineSOLR:5500,SearchEngineSPLUNK:5600};mstrmojo.EnumRWUnitType={LAYOUT:0,HEADER:2,FOOTER:3,SUBSECTION:4,DETAILS:5,PAGEHEADER:6,PAGEFOOTER:7,PANELSTACK:8,PANEL:9,GRID:521,GRAPH:522,GRIDGRAPH:527,RECTANGLE:101,IMAGE:102,LINE:105,TEXTFIELD:106,HTMLCONTAINER:107,SELECTOR:111,ROUNDEDRECTANGLE:112,VISUALIZATION:114,MOJOVISUALIZATION:115};(function(){var A=/^mstrmojo./;mstrmojo.DynamicClassFactory={newComponent:function(C,B,F){var H=C.prototype.scriptClass.replace(A,"");for(var E=0,D=B&&B.length||0;E<D;E++){if(!B[E]._mixinName){throw new Error('Mixins must have a "_mixinName" property to be used with DynamicClassFactory');}H+="_"+B[E]._mixinName.replace(A,"");}var G=mstrmojo[H];if(!G){G=mstrmojo.declare(C,B,F);mstrmojo[H]=G;}return G;}};}());mstrmojo.vi.models.EnumDragSources={DATASETS:1,VIZ_EDITOR:2,FILTERS:3,ALL_OBJECT_LIST:4,VIZ:5};mstrmojo.mstr.EnumDSSXMLObjectTypes={Generic:-2,Unknown:-1,Reserved:0,Filter:1,Template:2,ReportDefinition:3,Metric:4,Style:6,AggMetric:7,Folder:8,SubscriptionDevice:9,Prompt:10,Function:11,Attribute:12,Fact:13,Dimension:14,Table:15,DatamartReport:16,FactGroup:17,Shortcut:18,Resolution:19,Monitor:20,AttributeForm:21,Schema:22,Format:23,Catalog:24,CatalogDefn:25,Column:26,PropertySet:28,DBRole:29,DBLogin:30,DBConnection:31,Project:32,ServerDef:33,User:34,Configuration:36,Request:37,Script:38,Search:39,SearchFolder:40,Datamart:41,FunctionPackageDefinition:42,Role:43,SecurityRole:44,Locale:45,Consolidation:47,ConsolidationElement:48,ScheduleEvent:49,ScheduleObject:50,ScheduleTrigger:51,Link:52,DbTable:53,TableSource:54,DocumentDefinition:55,DrillMap:56,DBMS:57,MDSecurityFilter:58,PromptAnswer:59,PromptAnswers:60,ObjectTag:65,ReservedLastOne:66};mstrmojo.architect.EnumDragActions={ADD_TABLE:"addTable",ADD_COLUMN:"addColumn",TABLE_VIEW_ATTR:"tableViewItemAttr",TABLE_VIEW_METRIC:"tableViewItemMetric",PROJECT_TABLE:"projectTable",PROJECT_TABLE_COLUMN:"projectTableColumn",LINKER_ATTR:"linkerAttr",COMPOUND_FORM:"compoundForm"};mstrmojo.mstr.EnumNodeDimty={NodeDimtyReserved:0,NodeDimtyNone:1,NodeDimtyContinuation:2,NodeDimtyExclusiveContinuation:3,NodeDimtyOutputLevel:4,NodeDimtyBreakBy:5,NodeDimtyEmbedded:6,NodeDimtyUnspecified:7};(function(){mstrmojo.requiresCls("mstrmojo.vi.models.EnumDragSources");function D(H){this.cleanUpAfterTarget(H);var G=H.tgtData;if(G){delete H.tgtData;}var I=this.getContextDragData(H);if(I&&I.setAvatarClass){I.setAvatarClass("");}}mstrmojo.vi.ui._IsDropTarget=mstrmojo.provide("mstrmojo.vi.ui._IsDropTarget",{_mixinName:"mstrmojo.vi.ui._IsDropTarget",dropZone:true,getDropAvatarIcon:function B(G){return"add";},getContextDragData:function F(G){return G.getCtxtDragData();},cleanUpAfterTarget:mstrmojo.emptyFn,ondragenter:function A(G){var H=this.getContextDragData(G);if(H&&H.setAvatarClass){H.setAvatarClass(this.getDropAvatarIcon(G));}if(this._super){this._super(G);}},ondragleave:function E(G){D.call(this,G);if(this._super){this._super(G);}},ondrop:function C(G){D.call(this,G);if(this._super){this._super(G);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants");var C=mstrmojo.DI.DIConstants;mstrmojo.DI.model._ConnectLive=mstrmojo.provide("mstrmojo.DI.model._ConnectLive",{isDirectDataAccess:false,origIsDirectDataAccess:false,connectLiveSupport:C.connectLiveSupport.connectLiveSupportUnknown,isSupportedDDASource:function B(D){var E;switch(D){case C.sourceSubtype.querybuilder:case C.sourceSubtype.googleBigQuery:case C.sourceSubtype.googleBigQueryFFSQL:case C.sourceSubtype.googleBigQuerySingleTable:case C.sourceSubtype.searchOnSource:case C.sourceSubtype.hadoop:case C.sourceSubtype.mdx:case C.sourceSubtype.remoteProject:case C.sourceSubtype.hanaSingleTable:E=true;break;default:E=false;break;}return E;},isDDAOnlySource:function B(D){var E;switch(D){case C.sourceSubtype.searchOnSource:case C.sourceSubtype.mdx:case C.sourceSubtype.remoteProject:case C.sourceSubtype.hanaSingleTable:E=true;break;default:E=false;break;}return E;},canAddToDDACube:function A(D,I){var H,E=-1,J=-1,G;if(!this.isDirectDataAccess){return true;}H=this.isSupportedDDASource(D);var F=this.getAllTableID();if(F.length>0){G=this.importSources[F[0]];E=G.subtype;J=G.databaseType;if(D!==E){H=false;}if(I&&I!==J){H=false;}}return H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.func");mstrmojo.ACL.UserDataService=mstrmojo.provide("mstrmojo.ACL.UserDataService",{topgroups:null,userCandidates:null,getMembers:function(G,E){var F={taskId:"getUserEntityInfo",blockBegin:G.blockBegin,blockCount:G.blockCount,userEntityID:G.data.did,userEntityName:G.data.n||"",incremental:true,outputElements:G.outputElements||3};mstrmojo.xhr.request("POST",mstrConfig.taskURL,E,F);},getTopLevelGroups:function D(G,F){var E=this;if(this.topgroups){F.success({items:this.topgroups});return ;}F.success=mstrmojo.func.composite([F.success,function(H){E.topgroups=H.items;}]);this.getUsers({topGroupsOnly:true},F);},searchUserCandidates:function C(F,I,G,E){var H={blockBegin:1,blockCount:G,searchPattern:F,nameWildcards:I?1:2};this.getUsers(H,E);},getUserCandidates:function B(H,G){if(this.userCandidates){G.success(this.userCandidates);return ;}var E=G.success,F=this;G.success=function(J){F.userCandidates={items:J.items,isComplete:(parseInt(J.bc,10)===-1||(J.bb+J.bc>J.sz))};E(F.userCandidates);};var I={blockBegin:1,blockCount:H,nameWildcards:1};this.getUsers(I,G);},getUsers:function A(G,E){var F={taskId:"getUserServices"};mstrmojo.hash.copy(G,F);mstrmojo.xhr.request("POST",mstrConfig.taskURL,E,F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var I=mstrmojo.array,B=mstrmojo.hash,D="u;",C="-1";mstrmojo.elementHelper=mstrmojo.provide("mstrmojo.elementHelper",{buildElemsTerseID:function F(P,O,R){var N,M;for(M in P){N=P[M];if(N.v){var Q=N.v.split(";");if(Q&&Q.length>1){Q[1]=O;if(R&&Q.length>2){Q.pop();}N.v=Q.join(";");}}}return P;},buildElemsCountStr:function K(P,N){P=(!P||!P.length)?[]:P;N=(!N||!N.length)?[]:N;var O=P.length,M=N.length;if(I.find(N,"v",D)>-1){M-=1;}if(I.find(N,"v",C)>-1){M-=1;}if(I.find(P,"v",D)>-1||I.indexOf(P,D)>-1){O=M;}return this.buildElemsCountStrByNum(O,M);},buildElemsCountStrByNum:function K(N,M){if(N===M){if(M===0){return"";}return M.toString();}else{if(M===0){return N+" "+mstrmojo.desc(514);}else{if(N>M){return"("+M+")";}}}return mstrmojo.desc(4891,"").replace("##",String(N)).replace("###",String(M));},browseElements:function G(O,P,N){var M={doNotHold:!(N&&mstrApp.serverProxy),silent:true};mstrApp.serverRequest(mstrmojo.hash.copy(N,P),O,M);},getIdPresentation:function J(P){if(!!P){var O=P.charAt(0),M,N,Q;if((O>="g"&&O<="w")||(O>="V"&&O<="Z")){N=false;for(Q=1;Q<P.length;++Q){if(N){N=false;}else{switch(P.charAt(Q)){case";":return"terseLong";case"\\":N=true;break;}}}return"terse";}if(O>="B"&&O<="Q"){if(P.length>2){M=P.charAt(1);if(M>="A"&&M<="Q"){if(P.charAt(2)===":"){return"oldLong";}}}}if(P.length>=33&&P.charAt(32)===":"){return"old";}}return null;},isNullElem:function H(M){if(!M){return true;}var P=this.getIdPresentation(M),N=false,O;switch(P){case"terse":case"terseLong":O=M.substring(1,M.length).split(";");N=O[0].indexOf(this.TERSE_NULL)>-1;break;case"old":case"oldLong":N=M.indexOf(this.OLD_NULL)>-1;break;}return N;},isNonGroupNull:function(O){var M=O.eid||(O._e&&O._e.id),N=M&&M.split(":")[0];return N&&N===this.NON_GROUP_NULL;},getAttributeId:function L(O){var N,M;if(O){M=O.split(";");N=M[1];}return N;},getElementValue:function A(N){var O,M;if(N){M=N.split(";");if(M.length>2){O=M[0]+" "+M[2];}else{O=M[0];}}return O;},isAttributeIdsLinked:function E(N,M,O){var Q=false,P=B.keyarray(O);I.forEach(P,function(R){if(R===N){I.forEach(O[R],function(S){if(S===M){Q=true;return false;}});}if(Q){return false;}});return Q;},ELEM_ALL_ID:"u;",ELEM_DUMMY_ID:"-1",ELEM_SEPARATOR:"\u001E",OLD_NULL:"~!@@~~!@@~",TERSE_NULL:"\\N",NON_GROUP_NULL:"n00000000000000000000000000000000"});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var C=mstrmojo.array;function A(E){var D=(E&&E.gts&&E.gts.col)||[],G=(E&&E.gts&&E.gts.row)||[];var F=C.filter(D.concat(G),function(H){return H.otp===-1;})[0];return{tpltProp:E.prop,mxProp:C.map((F&&F.es)||[],function(H){var I={};I[H.oid]=mstrmojo.hash.copy(H.prop,{n:H.n,t:H.otp});return I;})};}mstrmojo._IsDocumentTemplate=mstrmojo.provide("mstrmojo._IsDocumentTemplate",{_mixinName:"mstrmojo._IsDocumentTemplate",gridInfo:null,tmsProps:null,update:function B(D){if(D&&D.data){this.gridInfo=D.data.gsi;this.tmsProps=A(D.data);}if(this._super){return this._super(D);}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var B=mstrmojo.array;function A(C){if(C.parent){if(C.parent.shouldEllipsizeChildren===undefined){mstrmojo.mixin(mstrmojo._HasEllipsis,C.parent);}C.parent.set("shouldEllipsizeChildren",true);}}mstrmojo._HasEllipsis=mstrmojo.provide("mstrmojo._HasEllipsis",{shouldEllipsize:false,shouldEllipsizeChildren:false,doEllipsize:function(){if(this.shouldEllipsizeChildren){B.forEach(this.children,function(D,C){if(D.hasRendered&&D.doEllipsize){D.doEllipsize();}});}},onshouldEllipsizeChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsize,this.shouldEllipsizeChildren);},onshouldEllipsizeChildrenChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsizeChildren,this.shouldEllipsize);},_onEllipsizeFlagChange:function(D,C){if(D&&!C){A(this);this.markupMethods=mstrmojo.mixin({onvisibleChange:function(){if(this._super){this._super();}if(this.visible&&this.hasRendered){this.doEllipsize();}}},mstrmojo.hash.copy(this.markupMethods));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var A=mstrmojo.array;mstrmojo.fe._IsRelationTreeNode=mstrmojo.provide("mstrmojo.fe._IsRelationTreeNode",{createSetHtml:'<span class="mstrmojo-textset mstrmojo-create-set-text" mstrAttach:click >'+mstrmojo.desc(12034,"Create a Set")+"</span>",syncRootOperator:function(){var F=this.parent,H=function(){var J=this.parent,I=[];if(J){I=J.ctxtBuilder.itemWidgets;}return I;},E,D,B,C,G;if(F){E=H.call(this);B=E.length;D=A.find(E,"noRelationOperator",true)!==-1;for(C=0;C<B;C++){G=E[C];G&&G.set("noRelationOperator",D);}this.set("noRelationOperator",D);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var H="#000000",E=Math.round;function N(X){return("0"+parseInt(X,10).toString(16)).slice(-2);}mstrmojo.color=mstrmojo.provide("mstrmojo.color",{rgbStr2rgb:function V(X){return X.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i).slice(1);},rgbStr2hex:function F(X){if(X.indexOf("rgb")>=0){var Y=this.rgbStr2rgb(X);return"#"+this.rgb2hex(Y[0],Y[1],Y[2]);}return X;},rgb2hex:function B(Z,Y,X){return N(Z)+N(Y)+N(X);},rgb2hsv:function U(X,e,j){var a=Math.min(X,e,j),k=Math.max(X,e,j),c=0,n,m;m=k/255;n=(k!==0)?(parseFloat(k)-parseFloat(a))/parseFloat(k):0;if(n===0){c=0;}else{var f=k-a,Y=(k-X)/f,Z=(k-e)/f,l=(k-j)/f;if(X===k){c=l-Z;}else{if(e===k){c=2+Y-l;}else{c=4+Z-Y;}}c=c/6;if(c<0){c=c+1;}}return[E(c*360),E(n*100),E(m*100)];},rgb2hsl:function D(X,c,d){X/=255;c/=255;d/=255;var e=Math.max(X,c,d),Z=Math.min(X,c,d),Y=(e+Z)/2,a,j;if(e===Z){a=j=0;}else{var f=e-Z;j=Y>0.5?f/(2-e-Z):f/(e+Z);switch(e){case X:a=(c-d)/f+(c<d?6:0);break;case c:a=(d-X)/f+2;break;case d:a=(X-c)/f+4;break;}a/=6;}return[a,j,Y];},hsl2rgb:function C(d,j,c){var a=function a(h,g,b){if(b<0){b+=1;}if(b>1){b-=1;}if(b<1/6){return h+(g-h)*6*b;}if(b<1/2){return g;}if(b<2/3){return h+(g-h)*(2/3-b)*6;}return h;},X,e,f;if(j===0){X=e=f=c;}else{var Y=c<0.5?c*(1+j):c+j-c*j,Z=2*c-Y;X=a(Z,Y,d+1/3);e=a(Z,Y,d);f=a(Z,Y,d-1/3);}return[E(X*255),E(e*255),E(f*255)];},hsl2hex:function I(Z,Y,X){return"#"+mstrmojo.array.map(this.hsl2rgb(Z,Y,X),function(a){return N(a);}).join("");},hex2rgb:function P(a){var X=this.fixFullHexValue("#"+a.replace("#","")),Y=[],Z;X=X.replace("#","");for(Z=0;Z<3;Z++){Y.push(parseInt(X.substr(Z*2,2),16));}return Y;},hex2bgr:function K(X){return this.hex2rgb(X).reverse();},hex2hsv:function S(Y){var X=this.hex2rgb(Y);return this.rgb2hsv(X[0],X[1],X[2]);},hex2hsl:function W(X){return this.rgb2hsl.apply(this,this.hex2rgb(X));},hsv2rgb:function G(f,o,m){f=f/360;o=o/100;m=m/100;var X,j,l;if(o===0){X=m*255;j=m*255;l=m*255;}else{var a=f*6;if(a===6){a=0;}var e=Math.floor(a);var Z=m*(1-o);var Y=m*(1-o*(a-e));var n=m*(1-o*(1-(a-e)));var k,c,d;switch(e){case 0:k=m;c=n;d=Z;break;case 1:k=Y;c=m;d=Z;break;case 2:k=Z;c=m;d=n;break;case 3:k=Z;c=Y;d=m;break;case 4:k=n;c=Z;d=m;break;default:k=m;c=Z;d=Y;break;}X=k*255;j=c*255;l=d*255;}return[E(X),E(j),E(l)];},hsv2hex:function L(a,Z,X){var Y=this.hsv2rgb(a,Z,X);return this.rgb2hex(Y[0],Y[1],Y[2]);},getContrastingColor:function M(a,Y,X){var Z=this.hex2rgb(a);return(((Z[0]*299)+(Z[1]*587)+(Z[2]*114))/1000<125)?Y:X;},getHighlightColor:function R(f,d){var X,e,h,j,k=this.hex2rgb(!d?"#FFCE7F":"#EFE6D8"),c=parseInt(f[0],10),Z=parseInt(f[1],10),m=parseInt(f[2],10),a=parseInt(k[0],10),Y=parseInt(k[1],10),l=parseInt(k[2],10);X=(c*a)/255;e=(Z*Y)/255;h=(m*l)/255;j=c*0.3+Z*0.59+m*0.11;if(j<85){X=X+(63*(85-j)/85);X=X>255?255:X;e=e+(63*(85-j)/85);e=e>255?255:e;h=h+(63*(85-j)/85);h=h>255?255:h;}return"#"+this.rgb2hex(E(X),E(e),E(h));},get3DBorderColor:function Q(Z,d){var Y=parseInt(Z[0],10)*0.3+parseInt(Z[1],10)*0.59+parseInt(Z[2],10)*0.11;var c=parseInt(Z[0],10);var a=parseInt(Z[1],10);var X=parseInt(Z[2],10);switch(d){case"light":if(Y>150){c=c*0.9;a=a*0.9;X=X*0.9;}else{c=c*0.6+102;a=a*0.6+102;X=X*0.6+102;}break;case"dark":if(Y>10){c=c*0.4;a=a*0.4;X=X*0.4;}else{c=c*0.8+30;a=a*0.8+30;X=X*0.8+30;}break;}return"#"+this.rgb2hex(E(c),E(a),E(X));},encodeColor:function J(X,Y){if(Y!==undefined&&(X===null||X.length===0||X==="undefined")){X=Y;}if(X==="transparent"){return -1;}if(parseInt(X,10)===-2){return -2;}if(X.substring(0,1)==="#"){X=X.substring(1);}return parseInt(X.substring(4)+X.substring(2,4)+X.substring(0,2),16);},decodeColor:function A(X){X=parseInt(X,10);if(X===0){return H;}var Y=16777216+(X&255)*65536+(X&65280)+(X&16711680)/65536;return"#"+Y.toString(16).substring(1).toUpperCase();},fixFullHexValue:function T(X){if(X&&X.length===4){return X.replace(/([0-9a-f])/ig,"$1$1");}return X;},findMidColorHex:function O(a,Z){var b=this.hex2rgb(a),X=this.hex2rgb(Z),Y=[];b.forEach(function(c,d){Y.push(parseInt((c+X[d])/2,10));});return("#"+this.rgb2hex(Y[0],Y[1],Y[2]));}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var N=/\{\@(en@)?([^\}]+)\}/gm,J=/\</gm,R=/\>/gm,E=/\S/,Q=["$","^","=","!",":","/",".","*","+","?","|","(",")","[","]","{","}","\\"],F=new RegExp("(\\"+Q.join("|\\")+")","g"),S={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;",u0009:"&#x09;","\n":"&#x0A;","\r":"&#x0D;",'"':"&quot;"},C={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;"," ":"&nbsp;","\n":"<br/>","\r":"&nbsp;&nbsp;&nbsp;&nbsp;","'":"&#039;",'"':"&quot;"},M={"&amp;":"&","&lt;":"<","&gt;":">","&nbsp;":" ","<br/>":"\n","&nbsp;&nbsp;&nbsp;&nbsp;":"\r","&#039;":"'","&quot;":'"'},D={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#039;",'"':"&quot;","\u20ac":"&#8364;"},K={"&amp;":"&","&lt;":"<","&gt;":">","&#039;":"'","&quot;":'"',"&#8364;":"\u20ac"};var L=function(V){if(V===null){return"null";}var W=typeof V;if(W!=="object"){return W;}if(V.length===undefined){return"object";}return"array";};var T={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};mstrmojo.string=mstrmojo.provide("mstrmojo.string",{multiReplace:function G(W,Z,Y){var V;Y=Y||[];if(!W){return"";}var X=[];for(V in Z){if(mstrmojo.array.indexOf(Y,V)===-1){X.push(V.k||V);}}return W.replace(new RegExp(X.join("|"),"g"),function(a){var b=Z[a];return b.v||b;});},trim:function P(V){return(V&&V.replace)?V.replace(/^\s+/,"").replace(/\s+$/,""):V;},startsWith:function U(W,V){return W.length>=V.length&&W.substring(0,V.length)==V;},ellipsize:function A(X,W){var V=this.trim(X.substr(0,(W||1)-1));if(V!==X){V+="&hellip;";}return V;},isEmpty:function I(V){return(V===null)||(V===undefined)||!(E.test(V));},regEscape:function O(V){return V.replace(F,"\\$1");},encodeXMLAttribute:function(V){return mstrmojo.string.multiReplace(V,S);},encodeHtmlString:function(W,V,X){if(!W||!W.replace){return W;}if(X){return mstrmojo.string.multiReplace(W,D);}return mstrmojo.string.multiReplace(W,C,V?[" "]:[]);},decodeHtmlString:function(W,V){return V?mstrmojo.string.multiReplace(W,K):mstrmojo.string.multiReplace(W,M);},htmlAngles:function(V){if(!mstrmojo.string.isEmpty(V)){V=String(V);return V.replace(J,"&lt;").replace(R,"&gt;");}return V;},apply:function H(V,X){if(!V){return"";}var W=this;return V.replace(N,function Y(b,c,d){var Z;try{Z=mstrmojo.hash.walk(d,X);}catch(a){}Z=(Z===null||Z===undefined)?"":Z;return(!!c)?W.encodeHtmlString(Z,true):Z;});},json2xml:function(V,k,l){if(!(k instanceof Array)){k=[k];}var W=l&&l.isSerializable,j=(l.convertBoolean!==false),o=l&&l.skipFunctions,h,b;var d=[],Z=[],c,Y,a;for(h=0,b=k.length;h<b;h++){var g=k[h];for(c in g){if(o&&typeof g[c]==="function"){continue;}if(W){var m=W(c,k,h);if(m!==true){if(m===false){continue;}else{if(m.att){d.push(m.att);}if(m.child){Z.push(m.child);}continue;}}}Y=g[c];a=L(Y);switch(a){case"array":var e,f;Z.push("<"+c+">");for(e=0,f=Y.length;e<f;e++){var X=l.getArrItemName(c,Y,e)||e;Z.push(this.json2xml(X,Y[e],l));}Z.push("</"+c+">");break;case"object":Z.push(this.json2xml(c,Y,l));break;case"string":d.push(c+'="'+mstrmojo.string.encodeXMLAttribute(Y)+'"');break;case"boolean":d.push(c+'="'+(j?(Y?"-1":"0"):Y)+'"');break;case"null":if(!l.skipNull){d.push(c+'="'+l.nullValue+'"');}break;default:d.push(c+'="'+Y+'"');break;}}}return"<"+V+" "+d.join(" ")+">"+Z.join("")+"</"+V+">";},escape4HTMLText:function B(c){if(!c||!c.replace){return c;}var Z=/"/gm;var X="&quot;";var d=/&/gm;var b="&amp;";var a=/</gm;var V="&lt;";var Y=/>/gm;var W="&gt;";return c.replace(d,b).replace(Z,X).replace(a,V).replace(Y,W);},parseUri:function(Z,W){W=W||T;var V=W.parser[((W.strictMode)?"strict":"loose")].exec(Z),Y={},X=14;while(X--){Y[W.key[X]]=V[X]||"";}Y[W.q.name]={};Y[W.key[12]].replace(W.q.parser,function(b,a,c){if(a){Y[W.q.name][a]=c;}});return Y;},removeSpecialChars:function(V){return V.replace(/[^a-zA-Z0-9]/g,"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.array");var G=mstrmojo.array,E=mstrmojo.desc(2412,"Default"),H=mstrmojo.desc(3433,"Font"),B=mstrmojo.desc(3434,"Number"),C=mstrmojo.desc(3435,"Alignment"),A=mstrmojo.desc(2886,"Borders"),F=mstrmojo.desc(3905,"Background");var L=[{n:E,v:"pru"}];G.forEach(["Arial","Arial Black","Arial Narrow","Arial Unicode MS","Batang","Book Antiqua","Bookman Old Style","Comic Sans MS","Courier New","Garamond","Haettenschweiler","Helvetica","Impact","Lucida Console","Lucida Sans Unicode","Map Symbols","Marlett","Monotype Corsiva","Monotype Sorts","MS Gothic","MS Outlook","Microsoft Sans Serif","MT Extra","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings"],function(M){L.push({n:M,v:M});});function K(N,M,O){return(M&&M>=N)?K(N,M-O,O).concat(M):[];}var J=K(2,12,1);J=J.concat(K(14,24,2));J=J.concat(K(36,48,12));J=J.concat(K(72,72,1));var D=[{n:E,v:"pru"}];G.forEach(J,function(M){D.push({n:String(M),v:String(M)});});mstrmojo._FormatDefinition={Formats:[{n:H},{n:B},{n:C},{n:mstrmojo.desc(3436,"Color and Lines")}],FormatTarget:[{n:mstrmojo.desc(7942,"Element Header"),v:1,p:"header_format"},{n:mstrmojo.desc(7943,"Element Value"),v:2,p:"grid_format"},{n:mstrmojo.desc(7944,"Individual Items Header"),v:3,p:"child_header_format"},{n:mstrmojo.desc(7945,"Individual Items Value"),v:4,p:"child_grid_format"}],MetricFormatTarget:[{n:mstrmojo.desc(9710,"Metric Headers"),v:1,p:"header_format"},{n:mstrmojo.desc(9711,"Metric Values"),v:2,p:"grid_format"}],MetricValueFormats:[{n:B},{n:C},{n:H},{n:A},{n:F}],MetricHeaderFormats:[{n:B},{n:C},{n:H},{n:A},{n:F},{n:mstrmojo.desc(12139,"Chart")}],NumberFormatCategory:{Automatic:-3,Default:-2,General:9,Fixed:0,Currency:1,Date:2,Time:3,Percentage:4,Fraction:5,Scientific:6,Custom:7},DefaultFormat:{FormattingAlignment:{Horizontal:"1",Vertical:"1",TextWrap:"0",TextDirection:"0"},FormattingBorder:{HInsideStyle:"1",VInsideStyle:"1",TopStyle:"1",LeftStyle:"1",BottomStyle:"1",RightStyle:"1",HInsideColor:"0",VInsideColor:"0",TopColor:"0",LeftColor:"0",BottomColor:"0",RightColor:"0",Border3DStyle:"0",Border3DWeight:"0",Border3DBottomColor:"0",Border3DLeftColor:"0",Border3DRightColor:"0",Border3DTopColor:"0"},FormattingFont:{Name:"Arial",Bold:"0",Italic:"0",Size:"10",Strikeout:"0",Underline:"0",Color:"0",Script:"0"},FormattingNumber:{Category:"9",DecimalPlaces:"0",ThousandSeparator:"-1",CurrencySymbol:"$",CurrencyPosition:"0",Format:"General",NegativeNumbers:"3"},FormattingPadding:{LeftPadding:"1",RightPadding:"1",TopPadding:"1",BottomPadding:"1",LineSpacing:"0"},FormattingPatterns:{FillColor:"16777215",PatternColor:"8650752",PatternStyle:"1",FillStyle:"0",ApplyToGraphThreshold:"0",GradientColor:"16777215",GradientAngle:"0",GradientXOffset:"0",GradientYOffset:"0",SelectorSelectionColor:"16167264",SelectorSelectionFillStyle:"0",SeriesFillColor:"pru",SeriesPatternColor:"8650752",SeriesPatternStyle:"1",SeriesFillStyle:"0",SeriesApplyToGraphThreshold:"0",SeriesGradientColor:"16777215",SeriesGradientAngle:"0",SeriesGradientXOffset:"0",SeriesGradientYOffset:"0",SeriesSelectorSelectionColor:"16167264",SeriesSelectorSelectionFillStyle:"0"}},Families:L,Sizes:D,SizesInVI:D.slice(7,19),Styles:[{n:E,v:"pru"},{n:mstrmojo.desc(3440,"Regular"),v:"0,0"},{n:mstrmojo.desc(2718,"Bold"),v:"-1,0",v2:"-1,"},{n:mstrmojo.desc(2719,"Italic"),v:"0,-1",v2:",-1"},{n:mstrmojo.desc(3441,"Bold Italic"),v:"-1,-1"}],Effects:[{n:"Underline",v:0},{n:"Strike",v:1}],Category:[{n:E,v:-2},{n:mstrmojo.desc(2378,"General"),v:9},{n:mstrmojo.desc(2050,"Fixed"),v:0},{n:mstrmojo.desc(2051,"Currency"),v:1},{n:mstrmojo.desc(2052,"Date"),v:2},{n:mstrmojo.desc(2170,"Time"),v:3},{n:mstrmojo.desc(2053,"Percentage"),v:4},{n:mstrmojo.desc(2054,"Fraction"),v:5},{n:mstrmojo.desc(2055,"Scientific"),v:6},{n:mstrmojo.desc(2056,"Custom"),v:7}],MaxNegativeDidigts:30,FixedNegative:[{n:"-1,234.12",v:1,f:"#,##0.00"},{n:"-1,234.12",r:true,v:5,f:"#,##0.00;[RED]-#,##0.00"},{n:"1,234.12",r:true,v:2,f:"#,##0.00;[RED]#,##0.00"},{n:"(1,234.12)",v:3,f:"#,##0.00;(#,##0.00)"},{n:"(1,234.12)",r:true,v:4,f:"#,##0.00;[RED](#,##0.00)"}],CurrencyNegative:[{n:"-$1,234.12",v:1,f:'"$"#,##0.00'},{n:"-$1,234.12",r:true,v:5,f:'"$"#,##0.00;[RED]-"$"#,##0.00'},{n:"$1,234.12",r:true,v:2,f:'"$"#,##0.00;[RED]"$"#,##0.00'},{n:"($1,234.12)",v:3,f:'"$"#,##0.00;("$"#,##0.00)'},{n:"($1,234.12)",r:true,v:4,f:'"$"#,##0.00;[RED]("$"#,##0.00)'}],CurrencyPosition:[{n:mstrmojo.desc(2194,"Left"),v:0},{n:mstrmojo.desc(2195,"Right"),v:1},{n:mstrmojo.desc(2183,"Left with space"),v:2},{n:mstrmojo.desc(2182,"Right with space"),v:3}],Date:[{n:mstrmojo.desc(2231,"4/7"),v:"m/d"},{n:mstrmojo.desc(2232,"04/07"),v:"mm/dd"},{n:mstrmojo.desc(2233,"4/7/98"),v:"m/d/yy"},{n:mstrmojo.desc(2234,"04/07/98"),v:"mm/dd/yy"},{n:mstrmojo.desc(2235,"04/07/1998"),v:"mm/dd/yyyy"},{n:mstrmojo.desc(2236,"7-Apr"),v:"d-mmm"},{n:mstrmojo.desc(2237,"7-Apr-98"),v:"d-mmm-yy"},{n:mstrmojo.desc(2238,"Apr-98"),v:"mmm-yy"},{n:mstrmojo.desc(2239,"Apr '98"),v:"mmm 'yy"},{n:mstrmojo.desc(2240,"April 1998"),v:"mmmm yyyy"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2243,"April 7, 1998"),v:"mmmm d, yyyy"}],Time:[{n:mstrmojo.desc(2244,"15:41"),v:"h:mm"},{n:mstrmojo.desc(2245,"3:41 PM"),v:"h:mm AM/PM"},{n:mstrmojo.desc(2246,"15:41:46"),v:"h:mm:ss"},{n:mstrmojo.desc(2247,"3:41:46 PM"),v:"h:mm:ss AM/PM"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2250,"04/07/98 15:41"),v:"mm/dd/yy h:mm"},{n:mstrmojo.desc(2248,"04/07/98 3:41 PM"),v:"mm/dd/yy h:mm AM/PM"}],PercentNegative:[{n:"-12.12%",v:1,f:"0.00%"},{n:"-12.12%",r:true,v:5,f:"0.00%;[RED]-0.00%"},{n:"12.12%",r:true,v:2,f:"0.00%;[RED]0.00%"},{n:"(12.12%)",v:3,f:"0.00%;(0.00%)"},{n:"(12.12%)",r:true,v:4,f:"0.00%;[RED](0.00%)"}],Fraction:[{n:"12 1/3",v:"# ?/?"},{n:"37/3",v:"?/?"},{n:"12 26/81",v:"# ??/??"},{n:"998/81",v:"??/??"}],TextDirection:[{n:E,v:"pru"},{n:mstrmojo.desc(4601,"Horizontal"),v:0},{n:mstrmojo.desc(5156,"-90 Degree"),v:-90}],Horizontal:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2378,"General"),v:1},{n:mstrmojo.desc(2194,"Left"),v:2},{n:mstrmojo.desc(2193,"Center"),v:3},{n:mstrmojo.desc(2195,"Right"),v:4},{n:mstrmojo.desc(2068,"Justify"),v:6}],Vertical:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2256,"Top"),v:1},{n:mstrmojo.desc(2067,"Center"),v:2},{n:mstrmojo.desc(2257,"Bottom"),v:3}],TextWrap:[{v:0},{v:-1}],BorderStyles:[{n:E,v:"pru"},{n:mstrmojo.desc(2258,"None"),v:0},{n:mstrmojo.desc(2259,"Dashed"),v:3},{n:mstrmojo.desc(2260,"Dotted"),v:4},{n:mstrmojo.desc(2261,"Hair"),v:7},{n:mstrmojo.desc(2262,"Thin"),v:1},{n:mstrmojo.desc(2264,"Thick"),v:5},{n:mstrmojo.desc(2265,"Double"),v:6}],extractModel:function(O,Q,N){var S=N||this.DefaultFormat,R;for(R in O){var M=O[R];if(!M.attachEventListener){if(!mstrmojo.hash.isEmpty(M)){Q[R]=M;}}else{var P;for(P in M){if(S[R]&&S[R][P]){if(!Q[R]){Q[R]={};}Q[R][P]=M[P];}}}}},getAvailableFonts:function I(){var M={success:function(O){if(O.name==="fontPicker"){var N=[{n:E,v:"pru"}];mstrmojo.array.forEach(O.shortcuts,function(P){N.push({n:P.attributes[1].value,v:P.attributes[1].value});});mstrmojo._FormatDefinition.Families=N;}}};mstrmojo.xhr.request("POST",mstrConfig.taskURL,M,{taskId:"getSystemPickerJson",name:"fontPicker"},false,null,true);},getStandardFormat:function(N,M){var P=mstrmojo.hash.clone(M||this.DefaultFormat),O;N=N||{};for(O in P){N[O]=N[O]||{};}for(O in N){if(!N[O].attachEventListener){N[O]=mstrmojo.hash.make(N[O],mstrmojo.Obj);}}return N;},saveFormatModel:function(Q,W,N,X){var V=X||this.DefaultFormat,S,M;for(S=0;S<N.length;S++){var R=N[S],P=W[R]||null,U=Q[R];if(U===undefined){delete W[R];continue;}for(M in V){var T=V[M],O;if((!P&&!U)||(P&&!P[M]&&!U[M])){continue;}for(O in T){if(U[M]===undefined||U[M]===""||U[M][O]==="pru"||U[M][O]===undefined){if(P&&P[M]&&(P[M][O]!==undefined&&P[M][O]!==null&&P[M][O]!=="pru")){P[M][O]="pru";}}else{P=P||{};P[M]=P[M]||{};P[M][O]=U[M][O];}}}if(P){W[R]=P;}}}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var I=mstrmojo.array,M=mstrmojo.hash;function J(U){if(U!==null){return(U.constructor!==Array)?[U]:U;}return null;}function F(e,c,Y){if(!c){return null;}var f=[],V=e.selectedIndices,U=e.allIdx,a=e.noneIdx;if(e.multiSelect&&(a>-1)&&(I.indexOf(c,a)>-1)){return f;}var X,Z,d=e.items,b=e.itemIdField,W=e.selectedItems,h;if(e.multiSelect&&(U>-1)&&(I.indexOf(c,e.allIdx)>-1)){for(X=0,Z=d.length;X<Z;X++){if(!V[X]){f.push(X);V[X]=true;e.selectedIndex=X;e.selectedItem=d[X];}}}else{for(X=0,Z=c.length;X<Z;X++){var g=c[X];if(!V[g]){V[g]=true;if(Y){f.push({idx:g,positions:Y});}else{f.push(g);}e.selectedIndex=g;h=e.selectedItem=d[g];if(W){W[h[b]]=h;}}}}return f;}function D(X,U){var W=[],Y=X.selectedIndices,Z=X.selectedItems,V;for(V in Y){delete Y[V];if(U){W.push({idx:parseInt(V,10),positions:U});}else{W.push(parseInt(V,10));}}X.selectedIndex=-1;X.selectedItem=null;if(Z){X.selectedItems={};}return W;}function T(e,d,Y){if(!d){return null;}var a=[],V=e.selectedIndices,g=I.indexOf,U=e.allIdx,b=e.noneIdx,c=e.itemIdField,W=e.selectedItems;if(e.multiSelect&&(((U>-1)&&(g(d,U)>-1))||((b>-1)&&(g(d,b)>-1)))){return D(e);}if(d.length>0&&V[U]){if(g(d,U)<0){d.push(U);}}var Z=d.length,X;for(X=0;X<Z;X++){var f=d[X];if(V[f]){delete V[f];if(Y){a.push({idx:f,positions:Y});}else{a.push(f);}if(W){delete W[e.items[f][c]];}if(e.selectedIndex===f){e.selectedIndex=-1;e.selectedItem=null;}}}return a;}function C(X,Y,V,U){if(U){return ;}if(this.raiseEvent){if((X&&X.length)||(Y&&Y.length)){try{this.raiseEvent({name:"selectionChange",added:X,removed:Y});}catch(W){T(this,X);F(this,Y);throw W;}}}}function B(V){var W=this.itemIdField,U=this.items;if(typeof V==="object"&&W){return I.find(U,W,V[W]);}return I.indexOf(U,V);}mstrmojo._ListSelections={multiSelect:false,allIdx:-1,noneIdx:-1,itemIdField:"",items:null,selectedIndices:null,selectedIndex:-1,selectedIndices_bindEvents:"selectionChange",selectedIndex_bindEvents:"selectionChange",selectedItem:null,selectedItem_bindEvts:"selectionChange",allowUnlistedValues:true,selectedItems:null,supportsIncFetch:false,init:function(U){this._super(U);if(this.supportsIncFetch&&this.itemIdField){this.selectedItems={};}if(!this.items){this.items=[];}if(!this.selectedIndices){this.selectedIndices={};if(this.selectedIndex>-1){this._set_selectedIndex("selectedIndex",this.selectedIndex,true);}else{if(this.selectedItem){this._set_selectedItem("selectedItem",this.selectedItem,true);}}}},addItems:function K(d){d=J(d);if(!d){return ;}var a=this.items,U=this.items.length,W=this.selectedItems,Y=[],V;a=this.items=a.concat(d);V=a.length;if(W){var Z=this.itemIdField,X,c;for(X=U;X<a.length;X++){c=a[X];if(W[c[Z]]){Y.push(X);}}}if(Y&&Y.length){F(this,Y);}if(V>U){var b=this.itemsContainerNode;if(b){b.innerHTML+=this._buildItemsMarkup(U,V-1).join("");}}},addSelectedItems:function S(U){this.selectItems(U,false);},setSelectedItems:function L(U){this.selectItems(U,true);},selectItems:function R(c,e){c=J(c);if(!c){return ;}if(e&&this.selectedItems){this.selectedItems={};}var W=this.selectedItems,a=this.itemIdField,U=[],Y=this.items.length,Z=[],V=this.allowUnlistedValues,d,b,X;for(X=0;X<c.length;X++){d=c[X];b=B.call(this,d);if(b<0){if(W===null){if(V){U.push(d);b=Y++;Z.push(b);}}else{W[d[a]]=d;}}else{Z.push(b);}}if(U.length>0){this.addItems(U);}if(Z.length>0){if(e){this.select(Z);}else{this.addSelect(Z);}}},unselectItems:function A(V){V=J(V);if(!V){return ;}var a=this.selectedItems,W=[],Z=this.itemIdField,Y,U,X;if(a===null){return ;}for(X=0;X<V.length;X++){Y=V[X];if(a){delete a[Y[Z]];}U=B.call(this,Y);if(U<0){W.push(U);}}if(W.length>0){this.removeSelect(W);}},getSelectedItems:function G(){if(this.selectedItems){return M.valarray(this.selectedItems);}return I.get(this.items,M.keyarray(this.selectedIndices,true));},singleSelect:function(V,W,U){if(V!==-1){this.select([V],W,U);}},singleSelectByField:function O(V,W,U){this.singleSelect(I.find(this.items,W,V),U);},toggleSelect:function Q(U){var W,V;if(this.selectedIndices[U]){V=T(this,[U]);}else{W=F(this,[U]);}C.call(this,W,V,[U]);},select:function(W,V,U){W=J(W);if(!W){return ;}var Y=D(this,U),a=F(this,W,U),X;if(this.selectionPolicy!=="reselect"){for(X=Y.length-1;X>=0;X--){var Z=I.indexOf(a,Y[X]);if(Z>-1){Y.splice(X,1);a.splice(Z,1);}}}C.call(this,a,Y,W,V);},rangeSelect:function H(V,U){var a=this.selectedIndex,Y=a,Z=this.allIdx,W=[],X;if(V===Z||this.selectedIndices[Z]){W.push(Z);}else{if(Y===-1&&this.selectedIndices){for(X in this.selectedIndices){Y=parseInt(X,10);break;}}Y=Y===-1?0:Y;if(Y>V){Y=V;V=a;}for(X=Y;X<=V;X++){W.push(X);}}this.select(W,U);this.selectedIndex=a;},clearSelect:function(U){C.call(this,null,D(this),[],U);if(!U){this.raiseEvent({name:"clearSelection"});}},addSelect:function(X,U,V){X=J(X);if(!X){return ;}var W=F(this,X,V),Z=null,Y=this.noneIdx;if(this.multiSelect&&(Y>-1&&I.indexOf(X,Y)>-1)){Z=T(this,X);}C.call(this,W,Z,X,U);},removeSelect:function(W,U,V){W=J(W);if(!W){return ;}C.call(this,null,T(this,W,V),W,U);},_set_selectedIndices:function P(W,c,U){if(this.selectedItems){this.selectedItems={};}var V=this.selectedIndices;if(V===c){return false;}if(!V){V={};this.selectedIndices=V;}if(!c){c={};}var a=this.selectedIndex,Z=[],b;for(b in V){if(!c[b]){b=parseInt(b,10);delete V[b];Z.push(b);if(a===b){this.selectedIndex=-1;this.selectedItem=null;}}}var f=[],d=this.items,Y=this.itemIdField,e;for(b in c){if(!V[b]){b=parseInt(b,10);V[b]=true;f.push(b);this.selectedIndex=b;e=this.selectedItem=d[b];if(this.selectedItems){this.selectedItems[e[Y]]=e;}}}if(U!==true){var X=[];for(b in c){if(V[b]){b=parseInt(b,10);X.push(b);}}C.call(this,f,Z,X);}return(f.length||Z.length);},_set_selectedIndex:function N(X,V,U){var W={};if(V>-1){W[V]=true;}return this._set_selectedIndices("selectedIndices",W,U);},_set_selectedItem:function E(X,W,V){var U=B.call(this,W);if((U<0)&&(W!==null&&W!==undefined)&&this.allowUnlistedValues&&this.items){this.set("items",this.items.concat(W));U=this.items.length-1;}return this._set_selectedIndex("selectedIndex",U,V);},_addSelections:function(U){return F(this,U);},_removeAll:function(){return D(this);}};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var E="*",A=".",C="-",J="_",H="<";var M=new RegExp("[\\"+E+"\\"+A+"\\"+C+"\\"+J+"\\"+H+"]","g"),G=E+"$&";mstrmojo.Serializer={scriptClass:"mstrmojo.Serializer",serializeValueGroup:function F(B){mstrmojo.array.forEach(B,function(D,K){B[K]=mstrmojo.Serializer.serializeValues(D);});return C+this.serializeValues(B)+J;},serializeValues:function I(D){var B=[];mstrmojo.array.forEach(D,function(K){if(typeof K==="Boolean"){K=K?"1":"0";}B.push(String(K).replace(M,G));});return B.join(A);}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var K=mstrmojo.array,D=mstrmojo.hash;function E(V,T){var W=[],Q=V.selectedIndices,P=V.allIdx;var R,S,U=V.items;if(V.multiSelect&&(P>-1)&&(K.indexOf(T,V.allIdx)>-1)){for(R=0,S=U.length;R<S;R++){if(!Q[R]){W.push(R);Q[R]=true;V.selectedIndex=R;V.selectedItem=U[R];}}}else{for(R=0,S=T.length;R<S;R++){var X=T[R];if(!Q[X]){Q[X]=true;W.push(X);V.selectedIndex=X;V.selectedItem=U[X];}}}return W;}function J(R){var Q=[],S=R.selectedIndices,P;for(P in S){delete S[P];Q.push(parseInt(P,10));}R.selectedIndex=-1;R.selectedItem=null;return Q;}function H(V,U){var S=[],Q=V.selectedIndices,X=K.indexOf,P=V.allIdx;if(V.multiSelect&&(P>-1)&&(X(U,P)>-1)){return J(V);}if(U.length>0&&Q[P]){if(X(U,P)<0){U.push(P);}}var T=U.length,R;for(R=0;R<T;R++){var W=U[R];if(Q[W]){delete Q[W];S.push(W);if(V.selectedIndex===W){V.selectedIndex=-1;V.selectedItem=null;}}}return S;}function A(S,R){var P=S.selectedIndices;if(!P){P={};S.selectedIndices=P;}if(!R){R={};}var U=S.selectedIndex,T=[],V,Q;for(Q in P){if(!R[Q]){V=parseInt(Q,10);delete P[Q];T.push(V);if(U===V){S.selectedIndex=-1;S.selectedItem=null;}}}var X=[],W=S.items;for(Q in R){if(!P[Q]){V=parseInt(Q,10);P[Q]=true;X.push(V);S.selectedIndex=V;S.selectedItem=W&&W[V];}}return{add:X,rmv:T};}function G(Q,P,R){if(Q.raiseEvent&&((P&&P.length)||(R&&R.length))){Q.raiseEvent({name:"change",added:P,removed:R});}}mstrmojo._ListBase2Selections=mstrmojo.provide("mstrmojo._ListBase2Selections",{multiSelect:false,selectedIndices:null,selectedIndex:-1,selectedItem:null,selectedIndices_bindEvents:"change",selectedIndex_bindEvents:"change",selectedItem_bindEvents:"change",allowUnlistedValues:true,insertUnlistedValuesAt:-1,allIdx:-1,singleSelect:function F(P,Q){if(!this.selectedIndices[P]||(this.selectionPolicy==="reselect")||(P!==this.allIdx&&this.selectedIndices[this.allIdx])){var R=J(this),S=E(this,[P]);if(Q!==true){G(this,S,R);}}},toggleSelect:function O(P,Q){var S,R;if(this.selectedIndices[P]){R=H(this,[P]);}else{S=E(this,[P]);}if(Q!==true){G(this,S,R);}},rangeSelect:function N(P,Q){this.singleSelect(P,Q);},clearSelect:function I(P){var Q=J(this);if(P!==true){G(this,null,Q);}},select:function L(R,P){var Q=A(this,K.hash(R));if((P!==true)&&(Q.add.length||Q.rmv.length)){G(this,Q.add,Q.rmv);}},addSelect:function B(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=E(this,R);if(P!==true){G(this,Q,null);}return Q;},removeSelect:function M(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=H(this,R);if(P!==true){G(this,null,Q);}return Q;},_set_selectedIndices:function(S,Q,P){if(this.selectedIndices===Q){return false;}var R=A(this,Q);if(R.add.length||R.rmv.length){if(P!==true){G(this,R.add,R.rmv);}}return false;},_set_selectedIndex:function(S,Q,P){var R={};if(Q>-1){R[Q]=true;}return this._set_selectedIndices(null,R,P);},_set_selectedItem:function(W,T,S){var R=T&&(typeof T==="object"),V=this.itemIdField,Q=-1,U=this.items;if(R&&V!=null){Q=K.find(U,V,T[V]);}else{if(T!=null){Q=K.indexOf(U,T);}}if((Q===-1)&&(T!=null)&&this.allowUnlistedValues){var P=this.insertUnlistedValuesAt;if(P==null||P<0){P=(U&&U.length)||0;}Q=P;this.add([T],Q);}return this._set_selectedIndex(null,Q,S);},initSelections:function C(T,Q,P,S,R){if(!this.selectedIndices){this.selectedIndices={};this.selectedIndex=-1;}if(T){this._set_selectedIndices(null,T,R);}else{if(Q){this.select(Q,R);}else{if(S){this._set_selectedItem(null,S,R);}else{if(P!==null&&P!==undefined){this._set_selectedIndex(null,P,R);}}}}},sortSelectedIndices:function(){return D.keyarray(this.selectedIndices,true).sort(K.numSorter);},removeSelectedItems:function(){var R=this.sortSelectedIndices(),P=R.length,S=R[P-1],Q=this.remove(R);S=Math.min(S+1-P,this.items.length-1);if(S>=0){this.singleSelect(S);}return Q;},getSelectedItems:function(){return K.get(this.items,this.sortSelectedIndices())||[];},setSelectedItems:function(Q,d){if(!Q||!Q.length){return ;}var S=this.items||[],u=this.itemIdField!=null?K.findMulti(S,this.itemIdField,Q):K.indexOfMulti(S,Q),V=Q.length,T=V-u.count,q=this.allowUnlistedValues,b=this.insertUnlistedValuesAt,X=(q&&(b>-1))?T:0;if(b<0){b=S.length;}var R=[],U=[],f=u.map;if(T&&q){var p=0,e;for(e=0;e<V;e++){if(f[e]==null){R.push(Q[e]);U.push(b+p++);}}this.add(R,b);}var W=[],h;for(h in f){var o=f[h];if(o>=b){o+=X;}W.push(o);}var t=W.concat(U),Y=this.addSelect(t,!d);if(!d){var Z=K.hash(Y),g=this.selectedIndices,a=[],l;for(l in g){if(!Z[l]){a.push(parseInt(l,10));}}var P=this.removeSelect(a,true);G(this,Y,P);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var G=mstrmojo.array;function B(){var H=this.buildConfig=this.buildConfig||{};H.pk=this.k;H.fgk=this.defn&&this.defn.fgk;return H;}mstrmojo._HasBuilder={builder:null,postBuildRendering:function D(){if(!this.builtChildren){this.buildChildren();}return this._super();},getChildren:function F(){return this.model.getChildren(this.node,false);},buildChildren:function E(H){if(!this.builder||!this.model){return false;}var J=this.children;if(J&&J.length){this.set("children",[]);}var I=this.builder.build(this.getChildren(),this.model,B.call(this));if(!H){this.addChildren(I);}this.builtChildren=true;return H?I:true;},rebuildChildren:function C(K){var H=this.children.slice(0),I=this.model,J=[];K=K||H.slice(0);K.forEach(function(P){var N=G.indexOf(H,P),O=P.k;if(N===-1){throw new Error("Invalid child requested rebuild in mstrmojo._HasBuilder::rebuildChild.");}this.removeChildren(P);P.destroy();J.push(O);},this);var L=I.getChildrenByKey(this.node,false,J);var M=this.builder.build(L,I,B.call(this));this.addChildren(M);return M;},rebuildChild:function A(H){return this.rebuildChildren([H])[0];}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var D=mstrmojo.dom,L=mstrmojo.hash;var O=100;var F=D.supportsTouches?0.5:1;var G=1;var R=100;var P={onvscrollVisibleChange:function(){var U=this.vscrollNode,V=U&&U.style;if(!V){return ;}if(this.vscrollVisible){var T=this.maxPos,W=this.clientSize;V.height=Math.round(W.y*W.y/T.y)+"px";V.left=(W.x-5)+"px";V.display="block";V.opacity=0.5;}else{V.opacity=0;}},onhscrollVisibleChange:function(){var V=this.hscrollNode,U=V&&V.style;if(!U){return ;}if(this.hscrollVisible){var T=this.maxPos,W=this.clientSize;U.width=Math.round(W.x*W.x/T.x)+"px";U.top=(W.y-5)+"px";U.display="block";U.opacity=0.5;}else{U.opacity=0;}}};var M=L.copy({onposChange:function(){var V=this.clientSize,U=this.maxPos,T=0,W=0;if(this.scrollsVert){W=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style[D.CSS3_TRANSFORM]="translateY("+Math.round((V.y-(V.y*V.y/U.y))*this.pos.y/U.y)+"px)";}}if(this.scrollsHoriz){T=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style[D.CSS3_TRANSFORM]="translateX("+Math.round((V.x-(V.y*V.x/U.x))*this.pos.x/U.x)+"px)";}}this.scrollChild.style[D.CSS3_TRANSFORM]="translate3d(-"+parseInt(T,10)+"px, -"+parseInt(W,10)+"px, 0px)";},ondeceleratingChange:function(){this.scrollChild.style[D.CSS3_TRANSITION]=this.decelerating?(D.CSS3_PREFIX+"transform 0.2s linear"):"";}},L.copy(P));var H=L.copy({onposChange:function(){var V=this.clientSize,U=this.maxPos,T=0,X=0,W=this.scrollboxNode;if(this.scrollsVert){X=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style.top=Math.round((V.y-(V.y*V.y/U.y))*this.pos.y/U.y)+"px";}W.scrollTop=parseInt(X,10);}if(this.scrollsHoriz){T=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style.left=Math.round((V.x-(V.y*V.x/U.x))*this.pos.x/U.x)+"px";}W.scrollLeft=parseInt(T,10);}}},L.copy(P));mstrmojo._TouchScrolling=mstrmojo.provide("mstrmojo._TouchScrolling",{FRICTION:0.65,BOUNCEFRICTION:0.5,usesTouches:false,bounces:true,scrollsHoriz:true,scrollsVert:true,pos:null,preBuildRendering:function N(){this.usesTouches=(mstrmojo.dom.supportsTouches&&this.usesTouches&&(this.scrollsHoriz||this.scrollsVert));if(this.usesTouches){this.pos={x:0,y:0};}if(this._super){this._super();}},postBuildRendering:function C(){if(this._super){this._super();}if(this.usesTouches){var W=this.scrollboxNode,V=this.itemsContainerNode||W.firstChild;if(W&&W!==V){this.scrollChild=V;var T=W.style;T.position="relative";T.overflow="hidden";var U=V.style;U.position="absolute";U.left=0;U.top=0;this.markupMethods=L.copy(D.isSafari?M:H,L.copy(this.markupMethods));this.attachTouchEvents();}}},unrender:function(T){if(this.usesTouches){this.detachTouchEvents();}this._super(T);},attachTouchEvents:function(){var U=this.touchNode||this.scrollboxNode;if(U){if(!this._tsCallback){var T=this;this._tsCallback=function(V){T.touchesBegin(self,V);};this._tmCallback=function(V){T.touchesMoved(self,V);};this._teCallback=function(V){T.touchesEnd(self,V);};}D.attachEvent(U,D.TOUCHSTART,this._tsCallback);this._tsNode=U;}},detachTouchEvents:function(){var T=this._tsNode;if(T){D.detachEvent(T,D.TOUCHSTART,this._tsCallback);delete this._tsNode;}},touchesBegin:function J(T,V){var U=V.target&&V.target.tagName;if(U&&(U==="SELECT"||U==="INPUT")){return ;}D.preventDefault(T,V);this.stopDeceleration();this.startTime=new Date();this.startTimePos={x:this.pos.x,y:this.pos.y};this.startTouchPos=D.getMousePosition(D.firstTouch(T,V),T);this.dragging=false;D.attachEvent(window,D.TOUCHMOVE,this._tmCallback);D.attachEvent(window,D.TOUCHEND,this._teCallback);},touchesMoved:function E(b,d){var Z=D.getMousePosition(D.firstTouch(b,d),b);D.preventDefault(b,d);if(!this.dragging){var T=5,h=Math.abs;if((this.scrollsHoriz&&h(Z.x-this.pos.x)>T)||(this.scrollsVert&&h(Z.y-this.pos.y)>T)){this.dragging=true;this.dragStartTime=new Date();this.startTouchPos=Z;var V=this.scrollboxNode,Y={x:V.clientWidth,y:V.clientHeight},f={x:V.scrollWidth,y:V.scrollHeight};this.clientSize=Y;this.scrollSize=f;this.maxPos={x:Math.max(f.x-Y.x,0),y:Math.max(f.y-Y.y,0)};this.showScroll();}}if(this.dragging){D.stopPropogation(b,d);var c=this.startTimePos,X=this.startTouchPos,a=this.maxPos;var W={x:this.scrollsHoriz?Math.max(Math.min(c.x-(Z.x-X.x),a.x),0):0,y:this.scrollsVert?Math.max(Math.min(c.y-(Z.y-X.y),a.y),0):0};this.set("pos",W);this.nextLastDragPos=this.lastDragPos;this.lastDragPos=Z;var U=new Date(),g=this.lastDragTime;this.nextLastDragTime=g;this.lastDragTime=U;if((U-g)>R){this.startTime=this.lastDragTime;this.dragStartTime=this.startTime;this.startTimePos={x:W.x,y:W.y};this.startTouchPos=Z;}}},touchesEnd:function I(T,U){D.preventDefault(T,U);D.detachEvent(window,D.TOUCHMOVE,this._tmCallback);D.detachEvent(window,D.TOUCHEND,this._teCallback);if(this.dragging){this.dragging=false;D.stopPropogation(T,U);if((new Date())-this.lastDragTime<=R){this.startDeceleration(T,U);}else{this.hideScroll();}}},startDeceleration:function B(Y,Z){var W=D.getMousePosition(D.firstChangedTouch(Y,Z),Y),c=((mstrmojo.dom.supportsTouches===null)?this.lastDragPos:this.nextLastDragPos)||W,b={x:W.x-c.x,y:W.y-c.y},T=((mstrmojo.dom.supportsTouches===null)?this.lastDragTime:this.nextLastDragTime),d=T?(new Date())-T:0,V={x:d?Number(b.x*O*F/d).toFixed(2):0,y:d?Number(b.y*O*F/d).toFixed(2):0};var a=this,U=function(e){return(a.scrollsHoriz&&Math.abs(e.x)>=G)||(a.scrollsVert&&Math.abs(e.y)>=G);};if(U(V)){this.velocity=V;this.friction={x:this.FRICTION,y:this.FRICTION};this.set("decelerating",true);var X=function(){a.decelerate();if(!U(a.velocity)){a.stopDeceleration();a=null;}};X();if(this.decelerating){this.decelerationTimer=window.setInterval(X,O);}}else{this.hideScroll();}},stopDeceleration:function A(){this.set("decelerating",false);delete this.velocity;if(this.decelerationTimer){window.clearTimeout(this.decelerationTimer);delete this.decelerationTimer;}this.hideScroll();},decelerate:function S(){var W=this.pos,V=this.velocity,U=this.friction,Z=this.maxPos,X={x:W.x-V.x,y:W.y-V.y},b=this.bounces,T=this.BOUNCEFRICTION;var a=X.x;if(a<0||a>Z.x){X.x=(a<0)?0:Z.x;V.x*=b?-T:0;U.x=T;}var Y=X.y;if(Y<0||Y>Z.y){X.y=(Y<0)?0:Z.y;V.y*=b?-T:0;U.y=T;}this.set("pos",X);this.velocity={x:U.x*V.x,y:U.y*V.y};},hideScroll:function K(){this.set("vscrollVisible",false);this.set("hscrollVisible",false);},showScroll:function Q(){var T=this.maxPos;if(this.scrollsVert&&T.y&&this.vscrollNode){this.set("vscrollVisible",true);}if(this.scrollsHoriz&&T.x&&this.hscrollNode){this.set("hscrollVisible",true);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var O=/this\.([\w\.\[\]\'\"\-]+)/m,D=/this\./m,M=/mstrmojo\.all\[[\'\"]([\w]+)[\'\"]\]\.([\w\.\[\]\'\"\-]+)/m,R=/mstrmojo\.all\[/m,L=/mstrmojo\.all\.([\w]+)\.([\w\.\[\]\'\"\-]+)/m,B=/mstrmojo\.all\./m,C=/\[(\d+)\]/g,E=/\[\'([\w\-]+)\'\]/g,P=/\[\"([\w\-]+)\"\]/g,H=/([\[\]].*)/;mstrmojo.Binding=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Binding",parent:null,source:null,destination:null,enabled:false,setter:"set",executing:0,init:function N(S){mstrmojo.hash.copy(S,this);mstrmojo.registry.add(this);},destroy:function F(){mstrmojo.publisher.clearSubscriptions(this.id);mstrmojo.registry.remove(this);},exec:function K(){this.executing++;var W=this._sourceFn;if(!W){var V=this.source;if(V!=null){if(typeof (V)=="string"){if(!(V.match("return "))&&!(V.match(/\;\s*\S/))){V="return "+V;}W=new Function(V);}else{if(typeof (V)=="function"){W=V;}}this._sourceFn=W;}}var S,X=this.parent;if(W){try{S=W.apply(X,[]);}catch(U){}}var T=this.setter,Y=this.destination;if(T==null){X[Y]=S;}else{if(typeof (T)=="string"){X[T](Y,S);}else{if(typeof (T)=="function"){T.apply(X,[Y,S]);}}}this.executing--;},enable:function A(){if(!this.enabled){this.exec();var T=this._chains;if(!T){this._parseChains();T=this._chains;}for(var S in T){this._attachChain(T[S]);}this.enabled=true;}},disable:function J(){if(this.enabled){var T=this._chains;if(T){for(var S in T){this._detachChain(T[S]);}}this.enabled=false;}},_chains:null,_parseChains:function(){this._chains={};var U=this._chains;var T=this.source;if(T&&(typeof (T)=="function")){T=T.toString&&T.toString();}if(!T){return ;}function S(b,e,V,X){var W=b,Z;while(Z=W.match(e)){var c=Z[0],a=c.length,d=true;c=c.replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"");for(var Y in U){if(Y.substr(0,a)===c){d=false;break;}else{if(c.indexOf(Y)===0){delete U[Y];}}}if(d){U[c]={host:(V==null)?null:Z[V],parts:Z[X].replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"").split(".")};}W=W.substr(Z.index+a);}}if(D.test(T)){S(T,O,null,1);}if(R.test(T)){S(T,M,1,2);}if(B.test(T)){S(T,L,1,2);}},_attachChain:function Q(S,U){if(!S.evt2idx){S.evt2idx={};}if(!S.idx2evt){S.idx2evt=[];}var d=S.evt2idx,g=S.idx2evt,Z=S.parts;var e=(U>=0)?U:0,b=this.id,W=mstrmojo.all,c=(U>0)?W[g[e-1].context][Z[e-1]]:(S.host?W[S.host]:this.parent),T=Z[e];var V=mstrmojo.array;while(c&&T){if(c.attachEventListener){var f=c[T+"_bindEvents"]||(T+"Change");if(typeof (f)=="string"){f=[f];}var Y=[];for(var a=0,X=f.length;a<X;a++){Y[a]=c.attachEventListener(f[a],b,"_callback");}for(var a=0;a<f.length;a++){d[c.id+"_"+f[a]]=e;}g[e]={context:c.id,evts:f,subs:Y};}c=c[T];T=S.parts[++e];}},_detachChain:function G(S,T){var U=mstrmojo.all,h=S.idx2evt,d=S.evt2idx,a=this.id;var Y=(T>-1)?T:0,b=h.length;if(Y<b){for(;Y<b;Y++){var Z=h[Y];if(!Z){break;}var W=Z.context,c=U[W],g=Z.evts;if(c&&c.detachEventListener){var k=Z.subs;for(var f=0,V=k.length;f<V;f++){c.detachEventListener(k[f]);}}h[Y]=null;for(var X=0,e=g.length;X<e;X++){delete d[W+"_"+g[X]];}}}},_callback:function I(T){this.exec();if(!T||!T.name||!T.src){return ;}var U=T.src.id+"_"+T.name,W=this._chains;for(var X in W){var V=W[X],S=V.evt2idx[U];if(S!=null){this._detachChain(V,S+1);this._attachChain(V,S+1);}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash");var A=mstrmojo.hash;mstrmojo.requiresDescs(2213,3326,3327,3329,4531,13283,13284,13285,13286);mstrmojo.ME.Enum={METRIC_ACTIONS:{ADD:"add",EDIT:"edit",EIDT_NEW:"editNew"},EDITOR_IDS:{ADVANCED:"mstrME",FORMULA:"mstrME",WIZARD:"mstrFE",SIMPLE:"mstrSME",SELECOTR:"mstrFSE"},EDITOR_TYPES:{ADVANCED:"ADVANCED",FUNCTION:"FUNCTION",SIMPLE:"SIMPLE",SELECTOR:"SELECTOR"},METRIC_EDIT_TYPES:{ADVANCED:65536,SIMPLE:131072,FUNCTION:196608},METRIC_TYPES:{65536:"ADVANCED",131072:"SIMPLE",196608:"FUNCTION"},NEW_METRIC_DEFINITION:{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}},getNewDefinition:function(){return{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}};},FBFlag:{Automatic:0,Manual:3},AFB:{Automatic:-1,False:0,True:1},SFB:{Automatic:-1,False:1,True:2},UI_OBJECT_TYPE:{Dimty:-1,Sub_Expression:-2,Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},UI_DATA_TYPE:{Sortby:-1,Breakby:-2,Level:-4,Condition:-5,Transformation:-6},SHORTCUT_FUNCTIONS:{Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},DYNAMIC_DIMTY:{CODES:{auto:{n:mstrmojo.desc(4531,"Automatic"),did:"@auto",t:-1},page:{n:mstrmojo.desc(3329,"Grand Total"),did:"@p",t:-1},byCol:{n:mstrmojo.desc(3326,"By Columns"),did:"@cols",t:-1},byRow:{n:mstrmojo.desc(3327,"By Rows"),did:"@rows",t:-1},byCell:{n:mstrmojo.desc(13283,"By Cell"),did:"@cell",t:-1},byShape:{n:mstrmojo.desc(13284,"By Shape"),did:"@shape",t:-1},downCross:{n:mstrmojo.desc(13285,"Down, Then Across"),did:"@cr",t:-1},crossDown:{n:mstrmojo.desc(13286,"Across, Then Down"),did:"@rc",t:-1}},getItems:function D(G){var F=this.CODES,E=[];switch(G){case"breakby":E=[F.auto,A.copy({n:mstrmojo.desc(2057,"None")},A.copy(F.page)),A.copy({n:mstrmojo.desc(122,"Columns")},A.copy(F.byCol)),A.copy({n:mstrmojo.desc(2968,"Rows")},A.copy(F.byRow)),A.copy({n:mstrmojo.desc(13399,"Cell")},A.copy(F.byCell)),A.copy({n:mstrmojo.desc(2923,"Shape")},A.copy(F.byShape))];break;case"level":E=[F.auto,F.page,F.byCol,F.byRow,F.byCell,F.byShape];break;case"sortby":E=[F.auto,F.downCross,F.crossDown];}return E;},getAutomaticDimtyObject:function C(){return A.copy(this.CODES.auto);},getDimtyObject:function B(E,H){var F=null;var G=false;if(H){A.forEach(mstrmojo.ME.Enum.DYNAMIC_DIMTY.CODES,function(I){if(I.did===E){F=A.copy(I);G=true;return false;}});}if(!G){F={n:E,t:-1,dimty:true};}return F;}},NonExposableParams:["IsNewOLAP","OLAPPattern","OLAPHasWindow"]};mstrmojo.ME.Enum.DEFAULT_MPS={mps:{afb:mstrmojo.ME.Enum.AFB.False,sfb:mstrmojo.ME.Enum.SFB.False,fbf:mstrmojo.ME.Enum.FBFlag.Automatic}};}());mstrmojo.DPIManager={classes:[],registerClass:function registerClass(B,C,D,A){this.classes.push({c:B,d:C,s:D,v:A});},setDPI:function(){var A=mstrMobileApp.getDeviceDPI();mstrmojo.array.forEach(this.classes,function(B){B.c.prototype.layoutConfig[B.d][B.s]=B.v[A]+"px";});this.classes=[];}};(function(){document.msCSSOMElementFloatMetrics=true;mstrmojo.requiresCls("mstrmojo.hash");var S=mstrmojo.hash,H="containerNode",G="auto",Q="px";var I={v:G,c:undefined,sv:G};function E(c,f,e){var g=this._layoutWidgets[f],k=c.slot||H,h=g.f,j=g.p,d=(h&&h[k]!==undefined),b=(j&&j[k]!==undefined);if(k&&((!e&&d)||b)){return d?h[k]:(g.x*parseInt(j[k],10)/100)+Q;}return c[(f==="h")?"height":"width"];}function K(g,d,b){if(g.ignoreLayout){return ;}var c=(d===G)||d==="NaNpx",f=(b===G)||b==="NaNpx";var e=g.getLayoutOffsets&&g.getLayoutOffsets();if(e){if(!c){d=(parseInt(d,10)-e.h)+Q;}if(!f){b=(parseInt(b,10)-e.w)+Q;}}if(g.setDimensions){g.setDimensions(d,b);}else{if(g.set){if(!c){g.set("height",d);}if(!f){g.set("width",b);}}}}function Z(e){var c=this.children,g,k;for(g=0,k=(c&&c.length)||0;g<k;g++){var d=c[g],l=d.slot||H;if(l){var j=E.call(this,d,"h",e),m=E.call(this,d,"w",e);this.setSlotDimensions(l,j,m);K(d,j,m);var b=E.call(this,d,"h",e),f=E.call(this,d,"w",e);if(b!==j||f!==m){K(d,b,f);}this.setSlotDimensions(l,b,f);}}this.afterLayout();}function B(){var c=this.children,b=this._layoutWidgets;S.forEach(this.slotNames,function(g,j){if(!g||this.skipsSlotLayout(j)){return ;}var f=(b.h&&b.h.getSlotSizeInfo(j,c))||I,d=(b.w&&b.w.getSlotSizeInfo(j,c))||I,e=f.c||d.c;mstrmojo.array.forEach(e,function(h){K(h,f.v,d.v);});this.setSlotDimensions(j,f.sv,d.sv);},this);this.afterLayout();}function D(c){var b=this.layoutConfig.xt?B:Z;b.call(this,c);}function T(j,e,g){var h=j.slot||H,f=e&&e.a;if(!f||f[h]===undefined){return ;}var b=this[h]["offset"+g],c=f[h];if(b===c){return ;}e.x-=(b-c);f[h]=b;}function J(b){this.beforeLayout();var c=this._layoutWidgets,d=b.src;T.call(this,d,c.h,"Height");T.call(this,d,c.w,"Width");D.call(this,true);}function O(d,g){if(!d){return null;}var b=this.children,q=g.toLowerCase(),h=parseInt(this[q],10),k=h,m={},o={},f={},c={},n={},j,l,e,t,p;for(p in d){if(!d.hasOwnProperty(p)){continue;}t=d[p];if(t.match(/px$/)){h-=parseInt(t,10);m[p]=t;}else{if(t.match(/%$/)){o[p]=t;}else{if(t.match(/all/)){n[p]=k;}else{f[p]=t;}}}}if(!S.isEmpty(f)&&!S.isEmpty(o)){for(j=0,l=(b&&b.length)||0;j<l;j++){e=b[j];p=e.slot||H;if(p&&f[p]&&!e.ignoreLayout){if(e.hasRendered){c[p]=this[p]["offset"+g];h-=c[p];}else{c[p]=0;e.attachEventListener((e instanceof mstrmojo.Container)?"childrenRendered":"renderComplete",this.id,J);}}}}return{f:S.isEmpty(m)?undefined:m,p:S.isEmpty(o)?undefined:o,a:S.isEmpty(c)?undefined:c,n:S.isEmpty(n)?undefined:n,x:h,getSlotSizeInfo:function(AD,x){if(!d[AD]){return I;}var w=mstrmojo.array.filter(x,function(AF){var AE=AF.slot;return AE===AD||(AD===H&&!AE);}),AB,AC;var u=m[AD];if(u){AC=u;}var AA=o[AD];if(AA){AC=(this.x*parseInt(AA,10)/100)+Q;}if(f[AD]){AC=c[AD];if(AC){AC+=Q;}else{AC=G;}AB=G;}var z=n[AD];if(z){AC=AB=z+Q;}AC=AC||"0px";return{v:AC,c:w,sv:AB||AC};}};}function R(c){var b=this.domNode;if(!b||!this.layoutConfig){return ;}b.style[c]=this[c];this.doLayout();}mstrmojo._HasLayout=mstrmojo.provide("mstrmojo._HasLayout",{_mixinName:"mstrmojo._HasLayout",height:"auto",width:"auto",ignoreLayout:false,beforeLayout:mstrmojo.emptyFn,afterLayout:mstrmojo.emptyFn,layoutConfig:null,init:function V(b){this._super(b);this.layoutConfig=S.clone(this.layoutConfig);},preBuildRendering:function C(){var d=this.cssText||"";var b=this.height;if(b&&b!==G){d+="height:"+this.height+";";}var c=this.width;if(c&&c!==G){d+="width:"+this.width+";";}this.cssText=d;return(this._super)?this._super():true;},postBuildRendering:function W(){this.doLayout();return this._super();},modifyLayoutConfig:function Y(d,c){var b=this.layoutConfig=this.layoutConfig||{};b.h=S.copy(d,b.h);b.w=S.copy(c,b.w);this.doLayout();},getLayoutOffsets:mstrmojo.emptyFn,set:function P(d,b){var c=this._super(d,b);if(d==="visible"&&this._pendingLayoutOnVisible){delete this._pendingLayoutOnVisible;this.doLayout();}return c;},doLayout:function A(){var b=this.layoutConfig;if(!b||(this.height===G&&this.width===G)){return ;}if(b.xt){if(!this.visible){this._pendingLayoutOnVisible=true;return ;}}this.beforeLayout();this._layoutWidgets={h:O.call(this,b.h,"Height"),w:O.call(this,b.w,"Width")};D.call(this,false);this.widgetResized();},browserResized:function F(b){this.setDimensions(b.h,b.w);return true;},onwidthChange:function N(){R.call(this,"width");},onheightChange:function M(){R.call(this,"height");},skipsSlotLayout:function(b){return false;},adjustParentDimensions:function L(){var c=this.parent,b=c&&c._layoutWidgets;if(b){T.call(c,this,b.h,"Height");T.call(c,this,b.w,"Width");}},setDimensions:function U(e,c){var d=(e===G)||e==="NaNpx",f=(c===G)||c==="NaNpx";if((!d&&parseInt(this.height,10)!==parseInt(e,10))||(!f&&parseInt(this.width,10)!==parseInt(c,10))){if(!d){this.height=e;}if(!f){this.width=c;}var b=this.domNode,g=b&&b.style;if(g){if(!d){g.height=e;}if(!f){g.width=c;}this.doLayout();}return true;}return false;},setSlotDimensions:function X(e,d,c){var b=this[e]&&this[e].style;if(!b){return ;}if(d!==G&&d!==undefined&&d!=="NaNpx"&&b.height!==d&&parseInt(d)>=0){b.height=d;}if(c!==G&&c!==undefined&&c!=="NaNpx"&&b.width!==c&&parseInt(c)>=0){b.width=c;}}});mstrmojo._HasLayout.getSlotSize=function a(e,f){var c=e&&e.prototype.layoutConfig;if(c){var d=c.h,b=c.w;return{h:(d&&d[f])||undefined,w:(b&&b[f])||undefined};}return null;};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var E=mstrmojo.dom,M=mstrmojo.hash,B,I=mstrmojo.global.document,K="mousedown",P="mousemove",R="mouseup";function G(Y){if(E.isPrimaryMouseBtn(Y)){B.startDragCheck(self,Y);}}var V,Q,A="mstrmojo-dnd-avatar",U;function F(Z,Y){if(Y!==undefined&&Y!==null){Q.innerHTML=Y;}U.left=Z.x+"px";U.top=Z.y+"px";}function L(Z,Y){if(!V){V=I.createElement("div");U=V.style;V.className=A;V.innerHTML='<div class="'+A+'-inner"></div>';Q=V.firstChild;I.body.appendChild(V);}F(Z,Y);U.display="block";}function S(){if(U){U.display="none";}}function H(Y){var Z=++B.ctxt.moveCount;if(Z>=B.minMoves){B.stopDragCheck();if((Y.buttons===1||Y.buttons===undefined||E.isIE9)&&(Y.which===1||Y.button===0||E.isIE8)){B.startDrag(self,Y);}}}function O(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDragCheck();delete B.ctxt;}}function D(Y){B.onDragMove(self,Y);}function C(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDrag(window,Y);}}function N(b){var Z=mstrmojo.hash.copy(b,{}),a=Z.hWin=Z.hWin||window,Y=Z.e=Z.e||a.event;Z.node=E.eventTarget(a,Y);Z.pos=E.getMousePosition(Y,a);return Z;}function J(Z){var Y=E.findWidget(Z);while(Y){if(Y.draggable){return Y;}Y=Y.parent;}return null;}function T(Y){var a=Y.src,Z=J(a.node);if(!Z){return null;}if(Z.getDragAction){Y.action=Z.getDragAction(Y);}a.widget=Z;a.data=Z.getDragData&&Z.getDragData(Y);if(Z.isDragValid){if(!Z.isDragValid(Y)){if(!Z.shouldDragBubble||Z.shouldDragBubble(Y)!==true){Y.src.node=Z.domNode.parentNode;return T(Y);}return null;}}if(Z.ondragstart){Z.ondragstart(Y);}return Z;}function X(a,Z){var Y=E.findWidget(a),b=Z.tgt&&Z.tgt.widget;while(Y){if(Y.dropZone){if(Y===b){return Y;}if(Y.allowDrop&&Y.allowDrop(Z)){return Y;}}Y=Y.parent;}return null;}function W(){if(this.set){this.set("allowingDrop",false);}}mstrmojo.dnd=mstrmojo.dnd||mstrmojo.provide("mstrmojo.dnd",{minMoves:3,enable:function(){if(!mstrmojo.dndEnabled){E.attachEvent(I,K,G);mstrmojo.dndEnabled=true;}},disable:function(){mstrmojo.dndEnabled=false;E.detachEvent(I,K,G);},startDragCheck:function(Y,Z){delete this.ctxt;var a=N({hWin:Y,e:Z});this.ctxt={src:a,moveCount:0,last:M.copy(a.pos),getDirection:function(b){return !!this.dir[b];},getCtxtDragData:function(){var b=this.src;return(b&&b.data)||{};},getCtxtDropData:function(){var b=this.tgt;return(b&&b.data)||{};}};if(this.minMoves){E.attachEvent(I,P,H);E.attachEvent(I,R,O);}else{this.startDrag(Y,Z);}},stopDragCheck:function(){E.detachEvent(I,P,H);E.detachEvent(I,R,O);},startDrag:function(Y,b){var Z=this.ctxt;Z.id=mstrmojo.now();var a=T(Z);if(!a){return ;}E.clearBrowserHighlights(Y);E.preventDefault(self,b);E.attachEvent(I,P,D);E.attachEvent(I,R,C);var d=window.mstrApp;if(d&&d.setInteractive){this._changeAppStatus=d.setInteractive(false);}if(!a.ownAvatar){var c=Z.src;L(c.pos,c.data&&c.data.html);}},stopDrag:function(Y,f){E.detachEvent(I,P,D);E.detachEvent(I,R,C);var b=this.ctxt,a=b.tgt||{},Z=N({hWin:Y,e:f,data:a.data}),d=X(Z.node,b);Z.widget=d;b.tgt=Z;if(d){if(d.ondrop){d.ondrop(b);}else{W.call(d);}}var c=b.src.widget;if(c&&c.ondragend){c.ondragend(b);}if(c&&!c.ownAvatar){S();}if(this._changeAppStatus){window.mstrApp.setInteractive(true);delete this._changeAppStatus;}},onDragMove:function(c,f){if(E.isSafari){E.clearBrowserHighlights();}var Y=this.ctxt,b=Y.tgt||{},Z=b.widget,d=N({hWin:c,e:f,data:b.data}),j=d.widget=X(d.node,Y),h=Y.last,a=d.pos;Y.dir={x:a.x>h.x,y:a.y>h.y};Y.last=M.copy(d.pos);Y.tgt=d;if(Z!==j){if(Z){if(Z.ondragleave){Z.ondragleave(Y);}else{W.call(Z);}}if(j){Y.tgt.data=(j.getDropData&&j.getDropData(Y))||{};if(j.ondragenter){j.ondragenter(Y);}else{if(j.set){j.set("allowingDrop",true);}}}}if(j){if(j.ondragover){j.ondragover(Y);}}var g=Y.src.widget;if(g&&g.ondragmove){g.ondragmove(Y);}if(g&&!g.ownAvatar){F(d.pos);}}});B=mstrmojo.dnd;B.enable();}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var B=mstrmojo.hash;mstrmojo.Base=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Base",init:function A(C){B.copy(C,this);if(this.postApplyProperties){this.postApplyProperties();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;mstrmojo.ui._IsIncFetchList=mstrmojo.provide("mstrmojo.ui._IsIncFetchList",{_mixinName:"mstrmojo.ui._IsIncFetchList",ifDataHelper:null,supportsIncFetch:false,isFetching:false,initScroll:function A(){var G=this.ifDataHelper,F=this,E=this.scrollNode||this.domNode;this.supportsIncFetch=G&&G.hasNext();if(G&&this.supportsIncFetch){this._scroll=function D(){if(E.offsetHeight+E.scrollTop>=E.scrollHeight){F.raiseEvent({name:"incFetch",id:F.id});}};C.attachEvent(E,"scroll",this._scroll);this.attachEventListener("incFetch",this.id,function(H){if(!this.supportsIncFetch||this.isFetching){return ;}if(this.preNext){this.preNext();}this.set("isFetching",true);G.next({complete:function(I){if(F.postNext){F.postNext();}F.set("isFetching",false);},success:function(I){F.addItems(I.items);},failure:function(I){F.supportsIncFetch=false;mstrmojo.alert("Error in fetching next: "+I);}});});}},addItems:function B(D){if(this._super){this._super(D);}if(!this.ifDataHelper.hasNext()){this.supportsIncFetch=false;var E=this.scrollNode||this.domNode;C.detachEvent(E,"scroll",this._scroll);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");function G(J){return(J&&J.id);}mstrmojo._HasScrollbox=mstrmojo.provide("mstrmojo._HasScrollbox",{_mixinName:"mstrmojo._HasScrollbox",scrollListeners:null,scrollListenerCount:0,scrollInterval:50,scrollboxNode:undefined,scrollTo:function F(L,K){var J=this.scrollboxNode;J.scrollLeft=L.x;J.scrollTop=L.y;if(K){this.notifyScrollListeners(L);}},connectScrollbox:function E(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(!L){L={};this.scrollListeners=L;}if(!L[J]){L[J]=K;this.scrollListenerCount++;if(this.scrollListenerCount===1){this._attachScrollDom();}}},disconnectScrollbox:function D(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(L&&L.hasOwnProperty(J)){delete this.scrollListeners[J];this.scrollListenerCount--;if(!this.scrollListenerCount){this._detachScrollDom();}}},notifyScrollListeners:function C(K){var N=K||this.getScrollPos(),M=N.y,L=N.x;this.scrollboxTop=M;this.scrollboxLeft=L;this.scrollboxRight=L+this.scrollboxWidth;this.scrollboxBottom=M+this.scrollboxHeight;var J=this.scrollListeners,O;for(O in J){J[O].onscroll(this);}},getScrollPos:function H(){var J=this.scrollboxNode;return{x:J.scrollLeft,y:J.scrollTop};},_attachScrollDom:function A(){var M=this.scrollboxNode;if(M){var L=this.usesTouches;if(!L){if(!this.scrollCallback){var K=this.id;this.scrollCallback=function(){mstrmojo.all[K].notifyScrollListeners();};}mstrmojo.dom.attachBufferedEvent(M,"scroll",this.scrollCallback,this.scrollInterval);}if(this.scrollboxTop===null){this.scrollboxTop=L?0:M.scrollTop;}if(this.scrollboxLeft===null){this.scrollboxLeft=L?0:M.scrollLeft;}var J=function(P){var O=P.toLowerCase();var N=M.style[O];return(!isNaN(N)&&N.charAt(N.length-1)!=="%")?parseInt(N,10):M["client"+P];};if(this.scrollboxHeight===null){this.scrollboxHeight=J("Height");}if(this.scrollboxWidth===null){this.scrollboxWidth=J("Width");}this.scrollboxBottom=this.scrollboxTop+this.scrollboxHeight;this.scrollboxRight=this.scrollboxLeft+this.scrollboxWidth;this._attachedScrollbox=M;}},_detachScrollDom:function I(){var J=this._attachedScrollbox;if(J&&this.scrollCallback){mstrmojo.dom.detachBufferedEvent(J,"scroll",this.scrollCallback,this.scrollInterval);}delete this._attachedScrollbox;},scrollboxTop:null,scrollboxLeft:null,scrollboxHeight:null,scrollboxBottom:null,buildRendering:function B(){this._detachScrollDom();this._super();if(this.scrollListenerCount){this._attachScrollDom();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx={enabled:true};var E=mstrmojo.dom;mstrmojo.fx._Effect=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.fx._Effect",duration:500,interval:50,delay:null,target:null,getTarget:null,widget:null,slot:null,preStart:null,postStart:null,onCancel:null,onEnd:null,revertOnCancel:true,isPlaying:false,started:false,init:function R(W){mstrmojo.hash.copy(W,this);},play:function C(){this.isPlaying=true;this.started=false;if(this.delay){var W=this;this.delayTimer=window.setTimeout(function(){W._start();W=null;},this.delay);}else{this._start();}},pause:function H(){if(this.delayTimer){window.clearTimeout(this.delayTimer);delete this.delayTimer;}if(this.timer){window.clearInterval(this.timer);delete this.timer;}this.isPlaying=false;},cancel:function U(){this.pause();if(this.started){if(this.revertOnCancel){this.counter=0;this.exec();}if(this.onCancel){this.onCancel();}this.started=false;}},_start:function F(){this.started=true;this._doTarget();this.steps=Math.max(Math.ceil(this.duration/this.interval),1);var W=this.ease;if(typeof W==="string"){this.ease=mstrmojo.registry.ref(W);}if(this._doPreStart()===false){this.started=false;this.isPlaying=false;return ;}this.counter=0;this.exec();this.counter++;this._doPostStart();if(this.counter>=this.steps){this._end();}else{var X=this;if(this.timer){window.clearInterval(this.timer);}this.timer=window.setInterval(function Y(){if(X){X.exec();X.counter++;if(X.counter>=X.steps){X._end();X=null;}}},this.interval);}},exec:null,_end:function D(){this.pause();this.started=false;if(this.onEnd){this.onEnd();}},_doTarget:function T(){if(this.getTarget){this.target=this.getTarget();}else{if(this.widget){this.target=this.widget[this.slot||"domNode"];}else{if(this.target){var X=this.target;if(X&&this.slot&&X.scriptClass){var Y=X[this.slot];if(Y){this.widget=X;this.target=Y;}}}}}if(!this.target){var W=this;while(W=W.parent){if(!W||W.domNode){break;}}if(W){this.widget=W;this.target=W[this.slot||"domNode"];}}},_doPreStart:function N(){if(this.preStart){return this.preStart();}},_doPostStart:function S(){if(this.postStart){this.postStart();}}});function M(Z,a){var X=Z.children,W=(X&&X.length)||0,Y;for(Y=0;Y<W;Y++){X[Y][a]();}}mstrmojo.fx.Parallel=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Parallel",init:function R(Z){this._super(Z);var Y=this.children;mstrmojo.registry.refArray(Y);var W=(Y&&Y.length)||0,X;for(X=0;X<W;X++){Y[X].parent=this;}},_start:function F(){this.started=true;if(this.preStart){this.preStart();}M(this,"play");if(this.postStart){this.postStart();}},pause:function H(){M(this,"pause");},cancel:function U(){M(this,"cancel");}});mstrmojo.fx.AnimateProp=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.AnimateProp",props:null,_start:function O(){var Y=this.props,Z;for(Z in Y){var X=Y[Z],W=X.ease;if(typeof W==="string"){X.ease=mstrmojo.registry.ref(W,{dontInst:true});}}this._super();},exec:function P(){var Z=this.props,a;for(a in Z){var X=Z[a],W=(X.ease||mstrmojo.ease.sin)(this.counter,X.start,X.stop-X.start,this.steps-1);if(X.fn){W=X.fn(W);}if(X.suffix){W+=X.suffix;}var Y=X.isStyle===false?this.target:this.target.style;Y[a]=W;}}});mstrmojo.fx.Typewriter=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Typewriter",charGroupSize:1,srcProp:"text",_doPreStart:function(){this._super();this._dynStop=false;if(this.stop==null){var a=this.srcProp,Y;if(a){var W=this.widget||this.parent;Y=W&&W[a];if((Y!=null)&&(typeof (Y)!=="string")){Y=String(Y);}}this.stop=Y;this._dynStop=true;}if(this.stop==null){this.stop="";}var Z=this.target,b=null,X=1;if(Z){Z.innerHTML="";b=document.createTextNode("");Z.appendChild(b);X=Math.max(Math.floor(this.stop.length/this.steps),1);}this.targetTextNode=b;this.charGroupSize=X;},exec:function(){var X=this.targetTextNode;if(!X){return ;}var W;if(this.counter>=this.steps-1){W=this.stop;}else{if(this.counter===0){W="";}else{W=this.stop.substring(0,this.charGroupSize*this.counter)+"_";}}X.nodeValue=W;},_end:function D(){this._super();if(this._dynStop){this.stop=null;delete this._dynStop;}},cancel:function U(){if(this._dynStop){this.stop=null;delete this._dynStop;}}});mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx.Fade=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Fade",start:null,stop:null,ease:null,suffix:null,exec:function P(W){if(W==null){W=(this.ease||mstrmojo.ease.sin)(this.counter,this.start,this.stop-this.start,this.steps-1);}if(E.isIE&&!E.isWinPhone){this.target.style.filter="alpha(opacity="+parseInt(W*100,10)+")";}else{this.target.style.opacity=W;}}});mstrmojo.fx.FadeOut=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeOut",start:1,stop:0,revertOnCancel:true,cssDisplay:"block",_end:function D(){if(this.cssDisplay){this.target.style.display="none";this.exec(this.start);}this._super();},cancel:function U(){if(this.started&&this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();}});mstrmojo.fx.FadeIn=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeIn",start:0,stop:1,revertOnCancel:true,cssDisplay:"block",_doPostStart:function V(){if(this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();},cancel:function(){if(this.started&&this.revertOnCancel&&this.cssDisplay){this.target.style.display="none";}this._super();}});function I(Y,X,Z){var W=Math.pow(10,Z||2);if(X){return parseInt(W*Y/X,10)/W;}return parseInt(W*Y,10)/W;}mstrmojo.ease={linear:function L(X,W,Z,Y){if(X===Y){return W+Z;}if(X===0){return W;}return W+Z*I(X,Y);},sin:function A(X,W,Z,Y){return W+Z*Math.sin((Math.PI/2)*X/Y);},cos:function B(X,W,Z,Y){return W+Z*Math.cos((Math.PI/2)*(1-X/Y));},sincos:function K(X,W,Z,Y){if(X>Y/2){return W+Z*Math.cos((Math.PI/2)*(1-X/Y));}return W+Z*Math.sin((Math.PI/2)*X/Y);},cossin:function Q(X,W,Z,Y){if(X>Y/2){return W+Z*Math.sin((Math.PI/2)*X/Y);}return W+Z*Math.cos((Math.PI/2)*(1-X/Y));},bounce:function G(X,W,Z,Y){if((X/=Y)<(1/2.75)){return Z*(7.5625*X*X)+W;}if(X<(2/2.75)){return Z*(7.5625*(X-=(1.5/2.75))*X+0.75)+W;}if(X<(2.5/2.75)){return Z*(7.5625*(X-=(2.25/2.75))*X+0.9375)+W;}return Z*(7.5625*(X-=(2.625/2.75))*X+0.984375)+W;},shake:function J(X,W,Z,Y){if(X<Y/2){return W+Z*I(Math.sin(2*Math.PI*X/8),null,2)*2*X/Y;}return W+Z*I(Math.sin(2*Math.PI*X/8),null,2)*2*(1-X/Y);}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var A=false,P=mstrmojo.dom,T=16;mstrmojo._HasContextMenu=mstrmojo.provide("mstrmojo._HasContextMenu",{cm:null,cmPos:null,itemField:"n",itemIdField:"did",itemChildrenField:"items",dynamicUpdate:false,queryChecked:function(U){return false;},queryEnabled:function(U){return true;},queryVisible:function(U){return true;},executeCommand:function O(U){},item2textCss:function E(U){return U.cssClass||U.cmdId||("cmd"+U[this.itemIdField]);},showContextMenu:function J(){if(!A){mstrmojo.requiresCls("mstrmojo.ContextMenu");A=true;}var a=this._subMenu,Y=this.getMenuPosition();if(!a){var c=(this.menuZIndex||this.zIndex||10)+1,W={left:Y.x+"px",top:Y.y+"px",zIndex:c,visible:false,dynamicUpdate:this.dynamicUpdate,itemField:this.itemField,itemIdField:this.itemIdField,itemChildrenField:this.itemChildrenField,_cmSource:this.getContextMenuSource(),items:this.getContextMenuItems(),cssClass:this.getContextMenuCssClass(),placeholder:document.body.appendChild(document.createElement("div")),parent:this};a=new mstrmojo.ContextMenu(W);a.render();this._subMenu=a;}else{a.set("left",Y.x+"px");a.set("top",Y.y+"px");}if(this.dynamicUpdate){var V=a.ctxtBuilder.itemWidgets,X=V&&V.length,U,Z,b=this.getContextMenuSource();for(U=0;U<X;U++){Z=V[U];if(b.queryVisible){Z.set("visible",b.queryVisible(Z.data));}if(b.queryChecked){Z.set("checked",b.queryChecked(Z.data));}if(b.queryEnabled){Z.set("enabled",b.queryEnabled(Z.data));}}}a.set("visible",true);this.callOnContextMenuOpen();this.adjustMenuPosition();this.attachMousedownEvent();},hideContextMenu:function I(){var U=this._subMenu;if(U&&U.visible){this._subMenu.set("visible",false);this.callOnContextMenuClose();}},adjustMenuPosition:function N(){var U=this._subMenu,X=this._subMenu.domNode,W=X.offsetHeight,V=X.offsetWidth,a=P.windowDim(),Z=P.position(X,false),Y=P.position(X,true);if((Z.x+V+T)>a.w){U.set("left",(a.w-V-T+(Y.x-Z.x))+"px");}if((Z.y+W+T)>a.h){U.set("top",(a.h-W-T+(Y.y-Z.y))+"px");}},attachMousedownEvent:function L(){var U=this;if(!this._close_handler){this._close_handler=function(V){U.closeMenuHandler(V);};}P.attachEvent(document.body,"mousedown",this._close_handler);},closeMenuHandler:function Q(U){if(!this.isOnMySubmenu(P.eventTarget(self,U))){this.closeMenuTree();}},isOnMySubmenu:function M(Y){var V=this._subMenu;if(!V){return false;}if(P.contains(V.domNode,Y,true,document.body)){return true;}var Z=V.ctxtBuilder.itemWidgets,U=Z&&Z.length,X,W;for(X=0;X<U;X++){W=Z[X];if(W.isOnMySubmenu(Y)){return true;}}return false;},callOnContextMenuOpen:function D(){if(this.onContextMenuOpen){this.onContextMenuOpen();}},callOnContextMenuClose:function C(){if(this.onContextMenuClose){this.onContextMenuClose();}},getContextMenuItems:function S(){return this.cm;},getContextMenuCssClass:function B(){return this.cmCssClass||"";},getContextMenuSource:function H(){return this;},getMenuPosition:function F(){if(this.cmPos){return this.cmPos;}var U=P.position(this.domNode,true);return{x:Math.round(U.x),y:Math.round(U.y+U.h)};},isSeparatorItem:function G(U){return U[this.itemIdField]===-1||U[this.itemField]==="-";},hasSubmenu:function K(U){return !!U[this.itemChildrenField];},closeMenuTree:function R(W){var V=this.activeMenuItem,U=this._cmSource||this;if(!V){if(W){this.activeMenuItem=W;}else{U.hideContextMenu();}return ;}if(V===W){return ;}if(W){this.activeMenuItem=W;if(W.parent.parent===V){return ;}if(W.parent===V.parent){V.hideContextMenu();return ;}}else{W=U;this.activeMenuItem=null;}V.hideContextMenu();while(V!==U){V=V.parent.parent;if(V!==W||U===W){V.hideContextMenu();if(U===W){P.detachEvent(document.body,"mousedown",this._close_handler);}}if(V.parent===W.parent){break;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var E=mstrmojo.dom;var P=mstrmojo.dom;var O="mousedown";function S(U){var T=U[U.hotSlot||"domNode"];if(T){if(!U._closeCallback){var W=U.id,V=function(X){return function(Z){var Y=mstrmojo.all[W];if(Y&&!Y.ignoreHover){Y["auto"+X](Z,self);}};};U._uncloseCallback=V("Unclose");U._closeCallback=V("Close");}E.attachEvent(T,"mouseover",U._uncloseCallback);E.attachEvent(T,"mouseout",U._closeCallback);}}function B(U){if(U._closeCallback){var T=U[U.hotSlot||"domNode"];if(T){E.detachEvent(T,"mouseover",U._uncloseCallback);E.detachEvent(T,"mouseout",U._closeCallback);}}}function F(V,U){var T=V;while(T){if(T.open||T.openPopup){if(T.set){T.set("ignoreHover",U);}else{T.ignoreHover=U;}}T=T.opener||T.parent;if(T&&T.shouldPropagateLockHover&&!T.shouldPropagateLockHover()){break;}}}function D(){var T=this._lockHoverCallback;if(T){E.detachEvent(document.body,O,T,true);delete this._lockHoverCallback;}}mstrmojo._CanAutoClose=mstrmojo.provide("mstrmojo._CanAutoClose",{autoCloses:false,autoCloseDelay:100,locksHover:false,hotSlot:null,closeOnClick:false,curtainNode:null,postBuildRendering:function Q(){this._super();if(this.autoCloses){S(this);}this.oncloseOnClickChange();},onautoClosesChange:function L(){var T=(this.autoCloses)?S:B;T(this);},oncloseOnClickChange:function H(){if(!this.curtainNode){return ;}var V=this,U="click",T=(mstrApp&&mstrApp.isTouchApp&&mstrApp.isTouchApp());if(T){U="touchstart";}E.attachEvent(V.curtainNode,U,function(){V.close();if(T){mstrmojo.touchManager.notify([]);}});},autoUnclose:function G(){var T=this._autoCloseTimer;if(T){self.clearTimeout(T);delete this._autoCloseTimer;}},autoClose:function J(){if(this.ignoreHover){return ;}if(this._autoCloseTimer){self.clearTimeout(this._autoCloseTimer);}if(this.opener){if(this.autoCloseDelay){var T=this.opener.id;this._autoCloseTimer=self.setTimeout(function(){mstrmojo.all[T].closePopup();},this.autoCloseDelay);}else{this.opener.closePopup();}}},destroy:function R(T){D.call(this);this._super(T);},lockHover:function N(){F(this,true);if(!this._lockHoverCallback){var U=this.id,T=this._lockHoverCallback=function(V){mstrmojo.all[U]._unlockHoverCheck(V,self);};if((E.isIE7||E.isIE8)&&window.event&&(window.event.type===O)&&this.opener){this.opener._ignoreMousedown=true;}E.attachEvent(document.body,O,T,true);}},unlockHover:function M(){F(this,false);D.call(this);},_unlockHoverCheck:function C(X,T){var U=this.opener;if(U&&U._ignoreMousedown){delete U._ignoreMousedown;return ;}var W=E.eventTarget(T,X);if(!P.contains(this.domNode,W,true,document.body)){var V=P.findWidget(W);while(V){if(V===this){return ;}V=V.parent||V.opener;}if(U&&U.onPopupAutoClosed){U.onPopupAutoClosed(X,T);}this.close();}},open:function I(U,T){if(this.autoCloses){this.autoUnclose();}this._super(U,T);if(this.locksHover){this.lockHover();}},close:function K(T){if(this.locksHover){this.unlockHover();}this._super(T);},shouldPropagateLockHover:function A(){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;mstrmojo._FillsBrowser=mstrmojo.provide("mstrmojo._FillsBrowser",{_mixinName:"mstrmojo._FillsBrowser",getBrowserDimensions:function E(G){if(G){return{w:G.innerWidth,h:G.innerHeight};}var F=C.windowDim(),H=(C.isFF||C.isWK)?0:2;return{w:Math.max(F.w,0)+"px",h:Math.max(F.h-H,0)+"px"};},preBuildRendering:function A(){var H=this._super(),G=this.getBrowserDimensions();if(!this.browserResized||this.browserResized(G)!==true){this.height=G.h;this.width=G.w;}if(!this._listenerProc){window._monitor=this;var I=this.id,F=this._listenerProc=function(K){var J=K||window.event;mstrmojo.all[I].monitorWindow(J);};C.attachEvent(window,"resize",F);}return H;},destroy:function B(F){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);}this._super(F);},monitorWindow:function D(F){var I=F.currentTarget,H=this.getBrowserDimensions(),G={w:(I?I.innerWidth+"px":H.w),h:(I?I.innerHeight+"px":H.h)};if((G.h===this.height&&G.w===this.width)||parseInt(G.h,10)<=20||parseInt(G.w,10)<=20){return ;}if(!this.browserResized||this.browserResized(G,true)!==true){if(G.h!==this.height){this.set("height",G.h);}if(G.w!==this.width){this.set("width",G.w);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var B=mstrmojo.dom,E=100;function I(K,J){return function(L){mstrmojo.all[K][(J?"move":"show")+"Tooltip"](L,self);};}function A(){var K=this.tooltipNode||this.domNode,M=this.id,J,L="_ontooltip"+(this.isDynamicTooltip?"move":"over");if(!this._ontooltipout){this._ontooltipout=function(N){mstrmojo.all[M].hideTooltip(N,self);};}if(!this[L]){this[L]=I(M,this.isDynamicTooltip);}K=[].concat(K);for(J=0;J<K.length;J++){K[J].removeAttribute("title");B.attachEvent(K[J],(this.isDynamicTooltip?"mousemove":"mouseover"),this[L]);B.attachEvent(K[J],"mouseout",this._ontooltipout);}}mstrmojo._HasTooltip=mstrmojo.provide("mstrmojo._HasTooltip",{tooltip:"",richTooltip:null,useRichTooltip:false,isDynamicTooltip:false,tooltipNode:null,tooltipOpenDelay:700,hasOpenTooltip:false,postBuildRendering:function(){var J=this._super();if(this.useRichTooltip){A.call(this);}return J;},onuseRichTooltipChange:function H(){if(this.hasRendered){var K=this.tooltipNode||this.domNode,J;if(this.useRichTooltip){A.call(this);}else{if(this._ontooltipout){if(K&&K.constructor!==Array){K=[K];}for(J=0;J<K.length;J++){B.detachEvent(K[J],this.isDynamicTooltip?"mousemove":"mouseover",this["_ontooltip"+(this.isDynamicTooltip?"move":"over")]);B.detachEvent(K[J],"mouseout",this._ontooltipout);}}this.hideTooltip();}}},showTooltip:function G(M,L){var K=this;if(!K.hasOpenTooltip&&(!mstrApp.isInteractive||mstrApp.isInteractive&&mstrApp.isInteractive())){mstrmojo.requiresCls("mstrmojo.tooltip");if(this.updateTooltipConfig){this.updateTooltipConfig(M);}window.clearTimeout(this._tooltipTimeOut);if(mstrmojo.dom.isIE){var N={};for(var J in M){N[J]=M[J];}M=N;}var O=this.richTooltip?this.richTooltip.areaId:undefined;this._tooltipTimeOut=window.setTimeout(function(){if(K._closeTooltipTimeout){window.clearTimeout(K._closeTooltipTimeout);delete K._closeTooltipTimeout;}mstrmojo.tooltip.open(K,M,L);K.tooltip.onmouseover=function(){if(K.richTooltip&&K.richTooltip.enableHover){window.clearTimeout(K._closeTooltipTimeout);window.clearTimeout(K._deactivationTimeout);if(K.tooltip){K.tooltip.onmouseout=function(P){if(!B.contains(this.domNode,P.e.toElement||P.e.relatedTarget)){K.hideTooltip();}};}}};K.hasOpenTooltip=true;K._hasActiveArea=true;K._tooltipAreaId=O;window.clearTimeout(K._deactivationTimeout);delete K._deactivationTimeout;},(this._hasActiveArea&&O&&O===this._tooltipAreaId)?0:this.tooltipOpenDelay);}},moveTooltip:function C(J,L){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;mstrmojo.tooltip.close();}var N=this,K=J,M=L;this._tooltipTimeOut=setTimeout(function(){mstrmojo.tooltip.open(N,K,M);},this.tooltipOpenDelay);},hideTooltip:function F(){var J=this;window.clearTimeout(this._tooltipTimeOut);if(this._closeTooltipTimeout){window.clearTimeout(this._closeTooltipTimeout);}if(this._hasActiveArea&&!this._deactivationTimeout){this._deactivationTimeout=window.setTimeout(function(){delete J._deactivationTimeout;delete J._hasActiveArea;delete J._tooltipAreaId;},100);}mstrmojo.requiresCls("mstrmojo.tooltip");if(J.richTooltip&&J.richTooltip.enableHover){this._closeTooltipTimeout=window.setTimeout(function(){mstrmojo.tooltip.close();delete J._closeTooltipTimeout;},E);}else{mstrmojo.tooltip.close();}this.hasOpenTooltip=false;},unrender:function D(M){var N=this.tooltipNode||this.domNode,L;if(N&&N.constructor!==Array){N=[N];}if(N){var O=this._ontooltipover,K=this._ontooltipout,J=this._ontooltipmove;for(L=0;L<N.length;L++){if(O){B.detachEvent(N[L],"mouseover",O);}if(K){B.detachEvent(N[L],"mouseout",K);}if(J){B.detachEvent(N[L],"mousemove",J);}}}this._super(M);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;function D(J,I){var G=[];if(J){var F;for(F in J){var H=Number(F);if(H>=I){G.push(H);}}}G.sort(mstrmojo.array.numSorter);return G;}mstrmojo.ListSelector=mstrmojo.provide("mstrmojo.ListSelector",{premousedown:function E(L,F,N){if(C.isPrimaryMouseBtn(N.e)){var I=N.hWin,J=N.e,G=C.eventTarget(I,J),M=L.listMapper.findIndex(L,F,G);if(M>-1){var H=L.multiSelect,K=C.ctrlKey(I,J),O=C.shiftKey(I,J);if(K||O){C.clearBrowserHighlights(I);}if(H&&(K||(L.selectionPolicy==="toggle"))){L.toggleSelect(M);}else{if(H&&O){L.rangeSelect(M);}else{L.singleSelect(M);}}}}},premouseup:function B(H,K,G){var F=G.hWin,J=G.e,L=C.ctrlKey(F,J),I=C.shiftKey(F,J);if(L||I){C.clearBrowserHighlights(F);}},onadd:function A(I,H){var M=H&&H.value&&H.value.length;if(M){var G=H.index,K=I.selectedIndices,L=D(K,G),J;for(J=L.length-1;J>-1;J--){var F=L[J];K[F+M]=true;delete K[F];}if(I.selectedIndex>=G){I.selectedIndex+=M;}}},onremove:function A(Q,S){var O=S&&S.value&&S.value.length;if(O){var R=S.index,I=R+O-1,M=Q.selectedIndices,L=Q.selectedIndex,G=[],T=[],P=false;if(M){var H;for(H in M){var K=Number(H);if(K>I){G.push(K);}else{if(K>=R){T.push(K);P=true;}}}}G.sort(mstrmojo.array.numSorter);var J,N;for(J=0,N=G.length;J<N;J++){var F=G[J];M[F-O]=true;delete M[F];}if(L>I){Q.selectedIndex-=O;}if(P){Q.removeSelect(T);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.ListSelector");var C=mstrmojo.dom,B=C.isIE;mstrmojo.TreeNodeSelector=mstrmojo.provide("mstrmojo.TreeNodeSelector",mstrmojo.mixin({premousedown:function A(E,I,D){var G=(E&&E.tree)||E,H=D&&D.e;if(!H){return false;}var F=G.lastMouseDown;if(F){if((F.e===H)||(B&&((new Date())-F.dt<50))){return false;}}this._super(E,I,D);if(G){if(G.onnodemousedown){G.onnodemousedown(D);}G.lastMouseDown={e:H,dt:new Date()};}return true;}},mstrmojo.hash.copy(mstrmojo.ListSelector)));}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.ListSelector");var A=mstrmojo.dom;mstrmojo.TreeBrowserSelector=mstrmojo.provide("mstrmojo.TreeBrowserSelector",mstrmojo.hash.copy({premousedown:function B(F,I,E){if(A.isPrimaryMouseBtn(E.e)){var D=E.hWin,H=E.e,G=A.eventTarget(D,H),C=F.listMapper.findIndex(F,I,G);if(C>-1){F.toggleSelect(C);}}}},mstrmojo.hash.copy(mstrmojo.ListSelector)));})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.locales");var c=mstrmojo.array,P=mstrmojo.meta.TP,G=mstrmojo.meta.STP,O=mstrmojo.hash,F={ANDOR:14,MQ:10,MC:12,AQ:2,AL:6,AC:9,AE:5,F:13,R:21,B:20,XML:1,RLS:15},B={};var W;for(W in F){B[F[W]]=true;}var a={};a[F.AQ]="a";a[F.AL]="a";a[F.AC]="a";a[F.AE]="a";a[F.MQ]="m";a[F.MC]="m";a[F.F]="f";a[F.R]="r";a[F.XML]="p";var K={};K[F.MQ]=["not","m","fn","fnt","cs","dmy","idcsi"];K[F.MC]=["not","m","fn","fnt","m2","m3","p","dmy","idcsi"];K[F.AE]=["not","a","fn","es","a2","fm2","p"];K[F.AQ]=["not","a","fm","fn","cs"];K[F.AL]=["not","a","fm","fn","cs"];K[F.AC]=["not","a","fm","a2","fm2","a3","fm3","fn","cs"];K[F.R]=["not","r"];K[F.F]=["not","f"];K[F.XML]=["not","n","p"];var M={};M[F.MQ]="METRIC_FNS";M[F.MC]="METRIC_FNS";M[F.AQ]="FORM_FNS";M[F.AL]="FORM_FNS";M[F.AC]="FORM_FNS";M[F.AE]="ELEM_FNS";var N={FILTER:1,REPORT:3,METRIC:4,FOLDER:8,PROMPT:10,FUNCTION:11,ATTR:12,FACT:13,DIM:14,FORM:21,ROLE:43,CONS:47},b={FILTER:256,CUSTOMGROUP:257,PROMPT:2560,PROMPT_BOOLEAN:2561,PROMPT_LONG:2562,PROMPT_STRING:2563,PROMPT_DOUBLE:2564,PROMPT_DATE:2565,PROMPT_OBJECTS:2566,PROMPT_ELEMENTS:2567,PROMPT_EXPRESSION:2568,PROMPT_EXPRESSION_DRAFT:2569,PROMPT_DIMTY:2570,PROMPT_BIGDECIMAL:2571,REPORT_GRID:768,REPORT_GRAPH:769,REPORT_ENGINE:770,REPORT_TEXT:771,REPORT_DATAMART:772,REPORT_BASE:773,REPORT_GRIDGRAPH:774,REPORT_NONINTERACTIVE:775,REPORT_CUBE:776,REPORT_EMMACUBE:779,CONS:12032,NDE:12033},T={a:N.ATTR,a2:N.ATTR,m:N.METRIC,m2:N.METRIC,r:N.REPORT,f:N.FILTER,p:N.PROMPT},U={f:b.FILTER};var V={};V[F.MQ]=N.METRIC;V[F.MC]=N.METRIC;V[F.AQ]=N.ATTR;V[F.AL]=N.ATTR;V[F.AC]=N.ATTR;V[F.AE]=N.ATTR;V[F.F]=N.FILTER;V[F.R]=N.REPORT;var J=function(d){var H=d.length,g={},e;for(e=0;e<H;e++){var h=d[e];g[h.did]=h.n;}return g;},E=function(e){var H=e.length,f;for(f=0;f<H;f++){var d=e[f];if("tp" in d){d.t=d.tp;}}return e;},X=function(e,g){var H=e.length,f;for(f=0;f<H;f++){var d=e[f];if("tp" in d){if(g){d.t=g;}else{delete d.t;}}}return e;},Z=function(d,f){if(!f){f=[];}f.length=0;var e,H;for(e=0,H=d.length;e<H;e++){f[e]=d[e];}return f;},L={0:[{did:"1,76"},{did:"1,79"},{did:"1,77"},{did:"1,80"},{did:"1,78"},{did:"1,81"},{did:"1,18"},{did:"1,43"}],1:[{did:"2,1"},{did:"2,2"},{did:"3,1"},{did:"3,2"}]};var R={0:[{did:"1,22"},{did:"1,57"}]};mstrmojo.expr=mstrmojo.provide("mstrmojo.expr",{ET:F,ETs:B,ET2TGT:a,ET2COND:K,ET2TP:V,FN:{EQUAL:6,NOT_EQUAL:7,GREATER:8,LESS:9,GREATER_EQUAL:10,LESS_EQUAL:11,IN_LIST:22,NOT_IN_LIST:57,BETWEEN:17,NOT_BETWEEN:44,IS_NULL:54,IS_NOT_NULL:55,AND:19,OR:20,NOT:21,SEARCH:158},FN_MRP:{BETWEEN:3,EXCLUDE_TOP:4,EXCLUDE_BOTTOM:5,BETWEEN_DESCENDING:13},FNT:{DEF:1,RANK:2,PER:3},FN_SEP:",",TP:N,STP:b,DMY_TP:{ATTR:-1,DIM:-2},DTP:{UNKNOWN:-1,INTEGER:1,UNSIGNED:2,NUMERIC:3,DECIMAL:4,REAL:5,DOUBLE:6,FLOAT:7,CHAR:8,VARCHAR:9,LONGVARCHAR:10,BINARY:11,VARBIN:12,LONGVARBIN:13,DATE:14,TIME:15,TIMESTAMP:16,SHORT:21,LONG:22,MBCHAR:23,BOOLEAN:24,PATTERN:25,BIGDECIMAL:30},BFTP:{RESERVED:0,HIDDEN:-1,DATETIME:1,NUMBER:2,TEXT:3,PICTURE:4,URL:5,EMAIL:6,TAG:7,DATE:8,TIME:9,SYMBOL:10,BIGDECIMAL:11,PHONENUMBER:12},METRIC_DTP:3,FN_DTP:{NUM:0,CHAR:1,DATE:2},DTP2PROMPT_STP:{"-1":b.PROMPT,1:b.PROMPT_LONG,2:b.PROMPT_LONG,3:b.PROMPT_LONG,4:b.PROMPT_DOUBLE,5:b.PROMPT_DOUBLE,6:b.PROMPT_DOUBLE,7:b.PROMPT_DOUBLE,8:b.PROMPT_STRING,9:b.PROMPT_STRING,10:b.PROMPT_STRING,14:b.PROMPT_DATE,15:b.PROMPT_DATE,16:b.PROMPT_DATE,21:b.PROMPT_LONG,22:b.PROMPT_LONG,23:b.PROMPT_STRING,24:b.PROMPT_BOOLEAN,30:b.PROMPT_BIGDECIMAL},DTP2FN_DTP:{"-1":0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1,9:1,10:1,11:0,12:0,13:0,14:0,15:0,16:0,21:0,22:0,23:1,24:0,25:1,30:0,34:0},fnCstCount:function A(e,d){var g=this.FN,h=this.FN_MRP,H=this.FNT;if(d===H.DEF||d===undefined){switch(e){case g.BETWEEN:case g.NOT_BETWEEN:return 2;case g.IS_NULL:case g.IS_NOT_NULL:return 0;}}else{if(d===H.PER||d===H.RANK){switch(e){case h.BETWEEN:case h.BETWEEN_DESCENDING:return 2;}}}return 1;},fn_List:function S(d,H){var e=this.FN;return d==e.IN_LIST||d==e.NOT_IN_LIST;},fn_AC_MC:function Y(d,H){var e=this.FN;return(d==e.EQUAL)||(d==e.NOT_EQUAL)||(d==e.GREATER)||(d==e.LESS)||(d==e.GREATER_EQUAL)||(d==e.LESS_EQUAL);},fnName:function Q(h,g,d,f){var H=this[M[h]];if(H&&H.constructor===Object){H=H[this.DTP2FN_DTP[f]]||H["*"];}if(h===F.MQ){H=H.concat(mstrmojo.locales.expression.MetricRP);}var e=c.find(H,"did",(d||1)+this.FN_SEP+g);if(e>-1){return H[e].n;}return"";},findTargets:function I(n,f,p){if(!p){p={};}if(n){var m;for(m in T){var AB=n[m];if(AB){if(!AB[P]){AB[P]=T[m];}if(!AB[G]&&U[m]){AB[G]=U[m];}p[AB[f]]=AB;}}if(n.dmy){var j=this.TP.ATTR,q=this.DMY_TP.ATTR,e=n.dmy.uts,AA,d;for(AA=0,d=(e&&e.length)||0;AA<d;AA++){var l=e[AA];if(l&&l.utp===q){var g=l.utgt;if(!g.t){g.t=j;}p[g[f]]=g;}}}var H=n.nds,o,x;for(o=0,x=(H&&H.length)||0;o<x;o++){this.findTargets(H[o],f,p);}var w=n.cs,z=w&&w.length;if(z){for(o=0;o<z;o++){this.findTargets(w[o],f,p);}}}return p;},onLocaleUpdated:function(){var d=mstrmojo.locales.expression,H=mstrmojo.expr;H.BRANCH_FNS=O.copy(J(d.BranchQual),H.BRANCH_FNS);H.ELEM_FNS=Z(X(d.Element,"fn"),H.ELEM_FNS);H.METRIC_FNS={"*":X(c.filter(d.Metric.concat(d.MetricRP),function(e){return e.did&&(c.find(R["0"],"did",e.did)<0);}))};H.FORM_FNS={0:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["0"],"did",e.did)<0);})),1:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["1"],"did",e.did)<0);})),2:X(c.filter(d.Attribute,function(e){return e.did&&(c.find(L["0"],"did",e.did)<0)&&(c.find(L["1"],"did",e.did)<0);}))};H.DIMTYLEVELS=Z(X(d.DimtyLevels),H.DIMTYLEVELS);},getSortedObjectsByTypeGroup:function D(f){var H=0,d=1,e=2;function g(h){switch(h.t){case N.METRIC:return d;case N.ATTR:case N.DIM:case N.CONS:return H;case N.FILTER:return h.st===b.CUSTOMGROUP?H:e;default:return e;}}return f.slice(0).sort(function(m,l){var n=g(m)-g(l);if(n){return n;}var k=m.n.toUpperCase(),j=l.n.toUpperCase(),h=k.localeCompare(j);if(h){return h;}return m.n.localeCompare(l.n);});},mapBaseFormTypeToDataType:function C(e){e=parseInt(e);if(e===NaN){return -1;}var d=this.BFTP,H=this.DTP;switch(e){case d.DATETIME:return H.TIMESTAMP;case d.DATE:return H.DATE;case d.TIME:return H.TIME;case d.NUMBER:return H.REAL;case d.TEXT:return H.CHAR;case d.BIGDECIMAL:return H.BIGDECIMAL;default:return H.CHAR;}}});mstrmojo.expr.onLocaleUpdated();}());(function(){mstrmojo.requiresCls("mstrmojo.locales");var X=function(){return mstrmojo.locales.datetime;},L=mstrmojo.string;mstrmojo.date=mstrmojo.provide("mstrmojo.date",{monthNumbers:{Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12},REGEXPS:{DATES:{},TIMES:{}},CACHE:{PARSEDATE:{CONTAINS:{},EQUALS:{}},PARSETIME:{CONTAINS:{},EQUALS:{}}},now:Date.now||function D(){return new Date().getTime();},isDate:function Y(b,f,a){var d=this.parseDate(b,a);var e=!!(d&&this.doesDateExist(d.month,d.day,d.year));if(f){if(e){var c=this.formatDateInfo(d,X().DATEOUTPUTFORMAT);if(a){return{match:d.match,formatted:c};}return c;}return null;}return !!e;},formatDateInfo:function R(d,f){if(!f){return"";}var a=d.day,e=d.month,c=d.year;var b=f.replace(/dd/g,this.formatInteger(a,2)).replace(/d/g,Number(a)).replace(/yyyy/g,Number(c)).replace(/yy/g,this.formatInteger(Number(c)%100,2)).replace(/MMM/g,"~~~~").replace(/MM/g,"@@").replace(/M/g,"^").replace(/MMMM/g,X().MONTHNAME_FULL[Number(e)-1]).replace(/\~\~\~\~/g,X().MONTHNAME_SHORT[Number(e)-1]).replace(/\@\@/g,this.formatInteger(e,2)).replace(/\^/g,Number(d.month));return b;},parseDate:function Z(l,f,j){if(l==null){return false;}if(typeof l!=="string"){l=String(l);}l=L.trim(l);var a=this.CACHE.PARSEDATE[f?"CONTAINS":"EQUALS"],c=a[l];if(c||(c===null)){return c;}var b=null;var h;if(j){h=[j];}else{h=[].concat(X().DATEINPUTFORMATS);h.unshift(X().DATEOUTPUTFORMAT);}var d,e;for(d=0,e=h.length;d<e;d++){var g=this._buildRegExp4DateFormat(h[d]),k=g&&l.match(f?g.reContains:g.reEquals);if(k){b={match:k[0],year:g.yearIndex&&this.fourDigitYear(k[g.yearIndex]),day:g.dayIndex&&parseInt(Number(k[g.dayIndex]),10),month:g.monthIndex&&this.numericMonth(k[g.monthIndex])};break;}}a[l]=b;return b;},isTime:function I(b,e,a){var f=this.parseTime(b,a);var d=!!(f&&this.doesTimeExist(f.hour,f.min,f.sec));if(e){if(d){var c=this.formatTimeInfo(f,X().TIMEOUTPUTFORMAT);if(a){return{match:f.match,formatted:c};}return c;}return null;}return !!d;},parseTime:function J(m,f,k){if(m==null){return false;}if(typeof m!=="string"){m=String(m);}m=L.trim(m);var a=this.CACHE.PARSETIME[f?"CONTAINS":"EQUALS"],c=a[m];if(c||(c===null)){return c;}var b=null;var j;if(k){j=[k];}else{j=[].concat(X().TIMEINPUTFORMATS);j.unshift(X().TIMEOUTPUTFORMAT);}var d,e;for(d=0,e=j.length;d<e;d++){var h=this._buildRegExp4TimeFormat(j[d]),l=h&&m.match(f?h.reContains:h.reEquals);if(l){var g=h.ampmIndex&&l[h.ampmIndex];b={match:l[0],hour:h.hourIndex&&this.capitalHour(l[h.hourIndex],g),min:h.minIndex&&parseInt(Number(l[h.minIndex]),10),sec:h.secIndex&&parseInt(Number(l[h.secIndex]),10)};break;}}a[m]=b;return b;},formatTimeInfo:function S(d,b){if(!b){return"";}var c=!(Number(d.hour)%12)?12:(Number(d.hour)%12),a=b.replace(/HH/g,this.formatInteger(d.hour,2)).replace(/H/g,Number(d.hour)).replace(/hh/g,this.formatInteger(c,2)).replace(/h/g,c).replace(/mm/g,this.formatInteger(Number(d.min)||0,2)).replace(/m/g,Number(d.min)||0).replace(/ss/g,this.formatInteger(Number(d.sec)||0,2)).replace(/s/g,Number(d.sec)||0).replace(/a/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME).replace(/tt/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME).replace(/AM\/PM/g,(Number(d.hour)<12)?X().AM_NAME:X().PM_NAME);return a;},doesTimeExist:function G(f,b,e){var d=parseInt(f,10);if(d>=0&&d<=23){var a=parseInt(b,10);if(a>=0&&a<=59){if(!e){return true;}var c=parseInt(e,10);if(c>=0&&c<=59){return true;}}}return false;},capitalHour:function C(a,b){a=parseInt(Number(a),10);if(b&&(b.match(X().AM_NAME)||b.match(/AM/i))){return a%12;}if(b&&(b.match(X().PM_NAME)||b.match(/PM/i))){return 12+(a%12);}return a;},getTimeStamp:function O(){var b=new Date();var a=[b.getMonth()+1,b.getDate(),b.getFullYear()];var e=[b.getHours(),b.getMinutes(),b.getSeconds()];var d=(e[0]<12)?"AM":"PM";e[0]=(e[0]<12)?e[0]:e[0]-12;e[0]=e[0]||12;for(var c=1;c<3;c++){if(e[c]<10){e[c]="0"+e[c];}}return a.join("-")+" "+e.join(":")+" "+d;},isDateAndOrTime:function V(a,b){return this.isDateTime(a,b)||this.isDate(a,b)||this.isTime(a,b);},isDateTime:function B(k,a){var e=this.parseDateAndOrTime(k),h=e&&e.date,d=e&&e.time,g=!!h&&!!d&&this.doesDateExist(h.month,h.day,h.year)&&this.doesTimeExist(d.hour,d.min,d.sec);if(a){if(g){var b=this.formatDateInfo(h,X().DATEOUTPUTFORMAT),c=this.formatTimeInfo(d,X().TIMEOUTPUTFORMAT),j=k.indexOf(h.match),f=k.indexOf(d.match);return(f<j)?c+" "+b:b+" "+c;}return null;}return !!g;},parseDateAndOrTime:function Q(b,a,f){var c=this.parseDate(b,true,a);var d=L.trim((c&&c.match)?b.replace(c.match,""):b),e=this.parseTime(d,false,f);if(!c&&!e){return null;}return{date:c,time:e};},inDateTimeRange:function P(c,e,h){var b=this.parseDateAndOrTime(c),f=b&&b.date,j=b&&b.time;if(!f&&!j){return 0;}if(e!=null){var d=this.parseDateAndOrTime(e);if(f&&d&&d.date){var k=this.compareDate(f,d.date);if(k<0){return -1;}if(k==0){if(j&&d.time&&(this.compareTime(j,d.time)<0)){return -1;}}}}if(h!=null){var a=this.parseDateAndOrTime(h);if(f&&a&&a.date){var g=this.compareDate(f,a.date);if(g>0){return 1;}if(g==0){if(j&&a.time&&(this.compareTime(j,a.time)>0)){return 1;}}}}return 0;},compareDate:function A(c,a){if(c===a){return 0;}var d=typeof c==="string"?this.parseDate(c):c,b=typeof a==="string"?this.parseDate(a):a;if(!d){return -1;}if(!b){return 1;}return(d.year-b.year)||(d.month-b.month)||(d.day-b.day)||0;},compareTime:function K(b,a){if(b===a){return 0;}var d=typeof b==="string"?this.parseTime(b):b,c=typeof a==="string"?this.parseTime(a):a;if(!d){return -1;}if(!c){return 1;}return(d.hour-c.hour)||(d.min-c.min)||(d.sec-c.sec)||0;},compareDateTime:function U(b,a){return this.compareDate(b,a)||this.compareTime(b,a);},compareDateAndOrTime:function E(h,f){if(h===f){return 0;}var b=typeof h==="string"?this.parseDateAndOrTime(h):h,a=typeof f==="string"?this.parseDateAndOrTime(f):f;if(!b){return -1;}if(!a){return 1;}var g=b.date,e=a.date,d=b.time,c=a.time;return this.compareDate(g,e)||this.compareTime(d,c);},_buildRegExp4DateFormat:function N(c){if(!c){return null;}var e=this.REGEXPS.DATES[c];if(!e){if(!this.REGEXPS.MONTHNAME_FULL){this.REGEXPS.MONTHNAME_FULL=X().MONTHNAME_FULL.join("|");this.REGEXPS.MONTHNAME_SHORT=X().MONTHNAME_SHORT.join("|");}e=this.REGEXPS.DATES[c]={};e.formatStr=c;var b=e.reStr=c.replace(/([^M|d|y|\s])/g,"\\$1").replace(/dd/g,"~~~~").replace(/d/g,"(\\d{1,2})").replace(/\~\~\~\~/g,"(\\d\\d)").replace(/yyyy/g,"(\\d\\d\\d\\d)").replace(/yy/g,"(\\d\\d)").replace(/MMMM/g,"@@@@").replace(/MMM/g,"@@@").replace(/MM/g,"(\\d\\d)").replace(/M/g,"(\\d{1,2})").replace("@@@@","("+this.REGEXPS.MONTHNAME_FULL+")").replace("@@@","("+this.REGEXPS.MONTHNAME_SHORT+")");e.reEquals=new RegExp("^"+b+"$");e.reContains=new RegExp("^"+b+"\\b");var f=[{key:"monthIndex",index:c.indexOf("M")},{key:"dayIndex",index:c.indexOf("d")},{key:"yearIndex",index:c.indexOf("y")}];f.sort(function(h,g){return h.index-g.index;});var a=1,d;for(d=0;d<3;d++){e[f[d].key]=f[d].index>-1?a++:null;}}return e;},_buildRegExp4TimeFormat:function F(d){if(!d){return null;}var f=this.REGEXPS.TIMES[d];if(!f){if(!this.REGEXPSTR_AMPM){this.REGEXPSTR_AMPM=[X().AM_NAME,X().PM_NAME,String(X().AM_NAME).toLowerCase(),String(X().PM_NAME).toLowerCase()].join("|");}f=this.REGEXPS.TIMES[d]={};f.formatStr=d;var c=d.replace(/\'\'/g,'"');var g=c.match(/\'(.+?)\'/g);c.replace(/\'(.+?)\'/g,"*");c=c.replace(/([^H|h|m|s|z|Z|a|t|\s|A|P|M|\/])/g,"\\$1").replace(/HH|hh/g,"(\\d\\d)").replace(/H|h/g,"(\\d{1,2})").replace(/mm/g,"(\\d\\d)").replace(/m/g,"(\\d{1,2})").replace(/ss/g,"(\\d\\d)").replace(/s/g,"(\\d{1,2})").replace(/a/g,"("+this.REGEXPSTR_AMPM+")").replace(/AM\/PM/,"("+this.REGEXPSTR_AMPM+")").replace(/tt/g,"("+this.REGEXPSTR_AMPM+")").replace(/z|Z/g,"(.+?)");var e,a;for(e=1,a=(g&&g.length)||0;e<a;e++){c=c.replace(/\*/,g[e]);}c=c.replace(/\"/g,"'");f.reEquals=new RegExp("^"+c+"$");f.reContains=new RegExp(c);var h=[{key:"hourIndex",index:d.search(/h|H/)},{key:"minIndex",index:d.indexOf("m")},{key:"secIndex",index:d.indexOf("s")},{key:"ampmIndex",index:d.search(/tt|a|AM\/PM/)},{key:"zoneIndex",index:d.search(/z|Z/)}];h.sort(function(k,j){return k.index-j.index;});var b=1;for(e=0;e<5;e++){f[h[e].key]=h[e].index>-1?b++:null;}}return f;},doesDateExist:function M(d,a,b){var c=new Date(b,d-1,a);return b==c.getFullYear()&&d==c.getMonth()+1&&a==c.getDate();},fourDigitYear:function T(b){b=parseInt(Number(b),10);if(!isNaN(b)){var a=(X().TWODIGITYEARSTART%100)||0;if(b>=0&&b<=a){b=2000+b;}else{if(b>a&&b<100){b=1900+b;}}}return b;},numericMonth:function W(e){var d=parseInt(Number(e),10),c=mstrmojo.array;if(!isNaN(d)){return d;}var a=(e&&e.length)||0,b=-1;if(a){if(a<=3){b=c.indexOf(X().MONTHNAME_SHORT,e);}if(b===-1){b=c.indexOf(X().MONTHNAME_FULL,e);}}return b+1;},formatInteger:function H(c,b){var f=String(c),e=Math.max(b-f.length,0);if(e>0){var a=[f],d;for(d=1;d<=e;d++){a.push("0");}f=a.reverse().join("");}return f;},getFirstDateOfMonth:function(b,a){return new Date(b,a-1,1);},getDateObject:function(g,a,f,c,e,b){g=g||0;a=a||1;f=f||1;c=c||0;e=e||0;b=b||0;return new Date(g,a-1,f,c,e,b);},getDateFromDateInfo:function(a){return this.getDateObject(a.date&&a.date.year,a.date&&a.date.month,a.date&&a.date.day,a.time&&a.time.hour,a.time&&a.time.min,a.time&&a.time.sec);},getDateJson:function(a){return{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),hour:a.getHours(),min:a.getMinutes(),sec:a.getSeconds()};},isLeapYear:function(a){return !(a%400)||(!(a%4)&&!!(a%100));},getDaysOfMonth:function(c,a){var b=[31,28,31,30,31,30,31,31,30,31,30,31];if(a==2&&this.isLeapYear(c)){return 29;}return b[a-1];},getPreMonth:function(b,a){if(a===1){return{y:b-1,m:12};}return{y:b,m:a-1};},getNextMonth:function(b,a){if(a===12){return{y:b+1,m:1};}return{y:b,m:a+1};}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.string","mstrmojo.array");var N=mstrmojo.locales,I=mstrmojo.string,Q=window.mstrConfig,F=mstrmojo.array,K=function(){return mstrmojo.locales.number.THOUSANDSEPARATOR;},R=function(){return mstrmojo.locales.number.DECIMALSEPARATOR;},C=Q.units,T={CM:1,IN:2,MM:3,PT:4,PC:5,PX:6},A={1:"cm",2:"in",3:"mm",4:"pt",5:"pc",6:"px"},E={DEFAULT:-2,FIXED:0,CURR:1,PERCENT:4,FRACTION:5,SCIENTIFIC:6,GENERAL:9};var G=96;String.prototype.reverse=function(){var W="",V;for(V=this.length;V>0;--V){W+=this.charAt(V-1);}return W;};function M(V,X){V=V||"";X=X||V.match(/\".+?\"/g)||[];for(var W=0;W<X.length;W++){V=V.replace(X[W],X[W].substring(1,X[W].length-1).replace(/\$/g,"$$$$"));}return V;}function U(a){var V=86400000,Z=new Date(1900,0,1,0,0,0,0),W=Math.floor(a)-1,Y=a-W-1;if(a>=59){W--;}var X=new Date(Z.getTime()+(W*V));X.setTime(X.getTime()+Y*V+500);return X;}function H(Z,g,j){var a={"d+":Z.getDate(),"h+|H":Z.getHours(),"s+":Z.getSeconds()},V=N.datetime,b;if(/(y+)/.test(g)){var Y=Z.getFullYear().toString(),f=RegExp.$1,X=f.length===2,W=Y.length;g=g.replace(f,Y.substr(X?W-2:0,X?2:W));}if(/(^\[h\])/.test(g)&&j){g=g.replace(RegExp.$1,""+(Math.floor(j*24)));}if(/(\"?:\"?mm)/.test(g)){var c=Z.getMinutes();g=g.replace(RegExp.$1,":"+(RegExp.$1.length===1?c:("00"+c).substr(c.toString().length)));}if(/(AM\/PM)/.test(g)){var h=a["h+"],d=h>11;a["h+"]=h-(d?12:0);g=g.replace(RegExp.$1,d?"PM":"AM");}for(b in a){if(new RegExp("("+b+")").test(g)){g=g.replace(RegExp.$1,RegExp.$1.length===1?a[b]:("00"+a[b]).substr((a[b].toString()).length));}}if(/(mmmm)/.test(g)){g=g.replace(RegExp.$1,V.MONTHNAME_FULL[Z.getMonth()]);}else{if(/(mmm)/.test(g)){g=g.replace(RegExp.$1,V.MONTHNAME_SHORT[Z.getMonth()].substr(0,3));}else{if(/((m|M)+)/.test(g)){var e=(Z.getMonth()+1).toString();g=g.replace(RegExp.$1,RegExp.$1.length===1?e:("00"+e).substr(e.length));}}}return M(g);}function O(W,Z){var X=0,V=Z.length,Y=0;for(;X<V;X++){if(Z[X]==="0"){Y++;}else{if(Z[X]==="#"){if(Y<W){Y++;}}else{continue;}}}return Y;}mstrmojo.num=mstrmojo.provide("mstrmojo.num",{isInt:function D(V){var Y=K(),X=new RegExp("^(-)?[0-9]{1,3}(\\"+Y+"[0-9]{3})*$"),W=new RegExp("^(-)?[0-9]+$");return(String(V).indexOf(Y)&&X.test(V))||W.test(V);},isNumeric:function P(Y,Z){var X=R(),a=K(),W=new RegExp("^(-)?[0-9]{1,3}(\\"+a+"[0-9]{3})*(\\"+X+"[0-9]+)?$"),V=new RegExp("^(-)?[0-9]*(\\"+X+")?[0-9]+$");return(String(Y).indexOf(a)&&W.test(Y))||V.test(Y);},parseInteger:function L(V,W){if(!this.isInt(V)){return Number.NaN;}return parseInt(this.toString(V,true),W);},parseNumeric:function B(V){if(!this.isNumeric(V)){return Number.NaN;}return parseFloat(this.toString(V,true));},inNumericRange:function S(W,X,V){W=this.parseNumeric(W);V=(V!=null)?this.parseNumeric(String(V)):Number.NaN;X=(X!=null)?this.parseNumeric(String(X)):Number.NaN;if(V!=Number.NaN&&(W>V||isNaN(W))){return 1;}if(X!=Number.NaN&&(W<X||isNaN(W))){return -1;}return 0;},convertToUSUnits:function(Y,X,W){var V=Y;X=X||C;switch(parseInt(X,10)){case T.CM:V=parseFloat(this.toString(Y))/2.54+"";break;case T.MM:V=parseFloat(this.toString(Y))/25.4+"";break;case T.PT:V=parseFloat(this.toString(Y))/72+"";break;case T.PC:V=parseFloat(this.toString(Y))/6+"";break;case T.PX:V=parseFloat(this.toString(Y))/G+"";break;}return W?V:this.toLocaleString(V);},convertToLocalUnits:function(Y,X,W){var V;X=X||C;switch(parseInt(X,10)){case T.CM:V=(parseFloat(this.toString(Y))*2.54).toFixed(4)+"";break;case T.MM:V=(parseFloat(this.toString(Y))*25.4).toFixed(4)+"";break;case T.PT:V=(parseFloat(this.toString(Y))*72).toFixed(4)+"";break;case T.PC:V=(parseFloat(this.toString(Y))*6).toFixed(4)+"";break;case T.PX:V=(parseFloat(this.toString(Y))*G)+"";break;default:V=parseFloat(this.toString(Y)).toFixed(4)+"";}return W?V:this.toLocaleString(V);},convertUnits:function(W,X,V){return this.convertToLocalUnits(this.convertToUSUnits(V,W,true),X,true);},toLocaleString:function(V){return(V+"").replace(".",R());},toString:function(X,V){if(V===true){var W=this.getThousandSepRegex();if(W){X=String(X).replace(W,"");}}return String(X).replace(R(),".");},getThousandSepRegex:function(){if(this.thousandSeparatorRegex==null){this.thousandSeparatorRegex=new RegExp(K().replace(/(\W){1}/g,"\\$1"),"g");}return this.thousandSeparatorRegex;},addSeparators:function(X,W){var V=W;if(W=="."||W=="*"||W=="\\"){V="\\"+W;}return X.reverse().replace(/(\d{3})/g,"$1"+W).reverse().replace(new RegExp("^(-)?"+V),"$1");},format:function(Z,Y,c,V){var b="",a=(Y>0)?".":"",W=[];c=(c)?c:"";for(var X=0;X<Y;X++){W.push("0");}W=W.join("");switch(Z){case E.GENERAL:b="0.00";break;case E.PERCENT:b="0"+a+W+"%";break;case E.SCIENTIFIC:b="0"+a+W+"E+00";break;default:b='"'+c+'"#,##0'+a+W;}return this.formatByMask(b,V);},getDecimalLength:function J(X){var V=X.indexOf("."),Y=0;if(V!==-1){var W=X.substr(V+1,X.length).match(/\d+/);if(W&&W.length>0){Y=W[0].length;}}return Y;},formatByMask:function(AE,AU){var AB,t;if(isNaN(AU)){AB=new Date(AU);if(isNaN(AB)){return AU;}t=true;}if(AE==="General"){return String(parseFloat(AU).toFixed(2));}var q=String(AE).split(";"),l="",Y=q[0],h="\u00A4",AN=/"[^"]*"/g,k=(AE&&AE.replace(AN,h).replace(/\[.*\]/g,h))||"",AT=["m","y","d","h","s"],AJ=false;F.forEach(AT,function(j){AJ=AJ||k.indexOf(j,0)!==-1;});if(AJ){if(window.SSF){l=window.SSF.format(AE,AU);}if(l!==""){return l;}else{return H(t?AB:U(AU),AE,AU);}}var AI=Y.indexOf("E+"),e=Y.indexOf("%"),x=Y.match(/\".+?\"/g),z=Y.indexOf("?/?")>-1,AC=(AI!=-1)?E.SCIENTIFIC:((e!=-1)?E.PERCENT:((x)?E.CURR:z?E.FRACTION:E.FIXED)),p="",AP="",n=false,W=new String(AU),d=this.parseNumeric(AU)||parseFloat(AU);if(x){if(Y.match(/\[\$.+?\]/g)){for(var f=0;f<x.length;f++){Y=Y.replace(x[f],x[f].substring(1,x[f].length-1));if(x[f].match(/\[\$.+?\]/g)){x[f]=x[f].replace(/\[\$.+?\]/g,x[f][x[f].indexOf("[$")+2]);}}Y=Y.replace(/\[\$.+?\]/g,'"#"'.replace("#",Y[Y.indexOf("[$")+2]));}p=M(Y,x);p=p.replace(Y.replace(/\".+?\"/g,""),h);}if(d<0){W=W.substring(1,W.length);d=-d,n=true;if(q.length>1){var b=q[1].replace(/\[.*\]/,"");AP=M(b.replace(q[0],h));}}var c=function(m,j){return(j)?j.replace(h,m):"-"+m;};if(AC==E.FRACTION){var AM,AL,AS,o=10,AA,w=0,AG,AO,Z,X=false,AD;if(AE.indexOf("# ")>-1){X=true;}for(AM=5;AM>0;AM--){AD="/";for(AL=0;AL<AM;AL++){AD+="?";}if(AE.indexOf(AD)>-1){for(AL=1;AL<AM;AL++){o*=10;}break;}}if(X){w=Math.floor(Number(d));d-=w;}AO=o/2;AS=-1;AG=d*o;for(AM=o-1;AM>=2;AM--){Z=(AG*AM)/o;Z=Z-Math.floor(Z);Z=Z*o;if(Math.abs(Z-o)<Z){Z=Math.abs(Z-o);}Z=Z/AM;if(Z<AO){AO=Z;AS=AM;}else{if((Z==AO)&&(Z==0)){AO=Z;AS=AM;}}}AA=Math.round(AS*AG/o);for(AM=AS;AM>=2;AM--){if((AA%AM==0)&&(AS%AM==0)){AA=AA/AM;AS=AS/AM;break;}}if(AS==o){AS=1;AA=0;}if(AA==0){AS=1;}if(AA==AS){if(X){l=""+(w+1);}else{l="1";}}else{if(X&&w>0){if(AA==0){l=w;}else{l=w+" "+AA+"/"+AS;}}else{if(AA==0){l="0";}else{l=AA+"/"+AS;}}}if(n){l=c(l,AP);}}else{if(AC==E.SCIENTIFIC){if(d!=0){var AV=Math.floor(Math.log(d)/Math.LN10),AK=d/Math.pow(10,AV),AW=Y.substring(0,AI),g=AW.indexOf("."),AF=Y.length-Y.indexOf("E+")-(""+Math.abs(AV)).length-2,AM,V=AV<0;AV=Math.abs(AV);for(AM=0;AM<AF;AM++){AV="0"+AV;}l+=Number(AK).toFixed((g!=-1)?AW.length-g-1:0);l=((n)?c(l,AP):l)+"E"+(V?"-":"+")+AV;}else{l="0";}}else{if(AC==E.PERCENT){Y=Y.substring(0,Y.length-1);W=String(d*100);}var g=Y.indexOf("."),a=0,AR,u=g>=0?Y.substring(0,g):Y;if(u.match(/[#0\?],$/)){d/=1000;W=String(d);}AR=this.getDecimalLength(W);if(g!=-1){a=O(AR,Y.substr(g+1,Y.length));}l=String(parseFloat(W).toFixed(Math.min(a,20)));var AQ=l.split(".");var AH=Y.replace(/"[^"]*"/g,"").match(/[#\d]+[^\.\d#]+[#\d]+/);if(AH!==null){AQ[0]=this.addSeparators(AQ[0],K());}l=AQ.join(R());if(AC==E.CURR){l=p.replace(h,l);if(l===p&&window.SSF){l=window.SSF.format(AE,AU);}}if(AC==E.PERCENT){l+="%";}if(n){l=c(l,AP);}}}return l;},validateFormat:function(V){var W=true,X=String(V).split(";");if(X[1]&&X[1].indexOf(X[0])<0){W=false;}return W;},generateUniqueID:function(V){var X="0123456789ABCDEF".split(""),Y=[];for(var W=0;W<V;W++){Y[W]=X[0|Math.random()*16];}return Y.join("");},countOfDecimals:function(W,X){var V=String(W);return V.length-(V.indexOf(X!==undefined?X:R())+1);}});mstrmojo.num.UNIT=T;mstrmojo.num.UNIT_SYMBOL=A;})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.dnd");var E=mstrmojo.dom;function B(I){return E.contains(this.getMovingHandle(),I.src.node,true,document.body);}mstrmojo._IsMovable=mstrmojo.provide("mstrmojo._IsMovable",{draggable:true,ownAvatar:true,getMovingHandle:function G(){return this.domNode;},getMovingTarget:function H(){return this.domNode;},isDragValid:function A(I){return B.call(this,I)||(this._super&&this._super(I))||false;},ondragstart:function C(J){if(B.call(this,J)){var K=this.getMovingHandle(),I=this.getMovingTarget().style;this._leftPos=parseInt(I.left,10);this._topPos=parseInt(I.top,10);this._hWidth=K.clientWidth;this._hHeight=K.clientHeight;}if(this._super){this._super();}},ondragmove:function F(L){if(B.call(this,L)){var M=L.tgt.pos,J=L.src.pos,K=this.getMovingTarget().style,I=E.windowDim();K.left=this.left=Math.min(Math.max(this._leftPos+M.x-J.x,-this._hWidth+40),I.w-40)+"px";K.top=this.top=Math.min(Math.max(this._topPos+M.y-J.y,-this._hHeight+20),I.h-20)+"px";}if(this._super){this._super();}},ondragend:function D(I){if(B.call(this,I)){delete this._leftPos;delete this._topPos;delete this._hWidth;delete this._hHeight;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash");var A=false,D="mstrmojo.Binding",I="bindings",H=mstrmojo.registry;function B(K){var L;for(L in K){var J=K[L];if(J&&J.disable){J.destroy();}}}function C(K,M){if(!A){mstrmojo.requiresCls(D);A=true;}var N;for(N in K){var J=K[N];if(J===null||J===undefined){continue;}var L=typeof J;if(L==="string"||L==="function"){J={destination:N,source:J,scriptClass:D};}J.parent=M;J=H.ref(J,{skipLoadChecks:true});K[N]=J;J.enable();}}mstrmojo._HasBindings=mstrmojo.provide("mstrmojo._HasBindings",{_meta_usesSuper:false,initBindings:function E(){this.hasInitBindings=true;var K=mstrmojo.hash.copy(this[I]);if(K){delete this[I];this._set_bindings(I,K);if(this.postCreateBindings){this.postCreateBindings();}}var M=this.children,J=(M&&M.length)||0;if(J){var L;for(L=0;L<J;L++){var N=M[L];if(N&&N.initBindings){N.initBindings();}}}},destroyBindings:function G(){var J=this.bindings;if(J){B(J);delete this.bindings;}},_set_bindings:function F(L,J){var K=this[I];if(J!==K){if(K){B(K);}this[I]=J;if(J){C(J,this);}return true;}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.array","mstrmojo.publisher");var D=mstrmojo.registry,K=mstrmojo.array,I=mstrmojo.publisher;function G(Q,R){if(R){R.parent=Q;var P=D.ref(R);if(R!==P){delete R.parent;}return P;}return null;}function L(Q,R){var P=R.alias;if(P!==null&&P!==""){Q[P]=R;}}function N(Q,R){var P=R.alias;if(R.parent===Q){delete R.parent;}if((P!==null&&P!=="")&&(Q[P]===R)){delete Q[P];}}function A(T,Q){var P=Q&&Q.length,S,R;if(P){S=[];for(R=0;R<P;R++){var U=G(T,Q[R]);if(!U){continue;}S.push(U);L(T,U);}}return S;}mstrmojo._HasChildren=mstrmojo.provide("mstrmojo._HasChildren",{_meta_usesSuper:false,children:null,postCreateChildren:mstrmojo.emptyFn,onaddChild:null,onremoveChild:null,initChildren:function F(){var P="children",Q=this[P];if(!Q){return ;}this[P]=null;this._set_children(P,Q,true);this.postCreateChildren();},_set_children:function E(S,Q,P){var R=this.children;if(Q!==R){if(R){this.removeChildren(null,P);}this.addChildren(Q,0,P);}return false;},destroyChildren:function C(S){var R=this.children,P=(R&&R.length)||0,Q;if(P){for(Q=P-1;Q>-1;Q--){var T=R[Q];if(T&&T.destroy){T.destroy(S);if(!S){N(this,T);}}}if(!S){R.length=0;}}},invalidateChildren:function B(){mstrmojo.array.forEach(this.children,function(P){P.invalidate();});},invalidate:function H(){this.invalidateChildren();},addChildren:function O(U,Q,R){if(!U){return U;}var T=U.constructor===Array,P=A(this,T?U:[U]);if(P&&P.length){var S=this.children||[];if(Q===null||Q===undefined){Q=S.length;}this.children=K.insert(S,Q,P);if(!R&&(this.onaddChild||I.hasSubs(this.id,"addChild"))){this.raiseEvent({name:"addChild",value:P,index:Q});}}return T?P:(P&&P[0]);},removeChildren:function J(V,R){var T=this.children,U=V?[V]:(this.children||[]).concat(),Q=U.length,P=-1,S;if(Q){for(S=Q-1;S>-1;S--){N(this,U[S]);}if(V){P=K.removeItem(T,V);}else{if(T){T.length=0;P=0;}}if(!R&&(this.onremoveChild||I.hasSubs(this.id,"removeChild"))){this.raiseEvent({name:"removeChild",value:U,index:P});}}return P;},removeAndDestroyChild:function M(R,P,Q){if(R){if(R.parent!==this){throw"Unable to remove an object that is not in the children collection.";}this.removeChildren(R,P);R.destroy(Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry");mstrmojo._PagingList=mstrmojo.provide("mstrmojo._PagingList",{usePaging:false,page:0,totalPages:1,_set_page:function(B,A){if(this.page!==A&&this.usePaging){if(A>=0&&A<this.totalPages){this.page=A;}return true;}return false;},_inScroll:false,_inPaging:false,onscroll:function(){if(this.usePaging&&!this._inPaging){this._inScroll=true;this.set("page",this.listMapper.whichPage(this));this._inScroll=false;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.hash");var M=mstrmojo.string,L=mstrmojo.hash,E=mstrmojo.dom;var R=mstrmojo.usesFrames?null:document.createElement("span");var J=/mstrAttach:([\w,]+)/g;var Q;function U(a){if(Q===undefined){Q=(mstrApp!==undefined&&mstrApp.isTouchApp&&mstrApp.isTouchApp())||false;}return a.replace(J,function Z(g,j){var c=j.split(","),d=[],b=c.length,f;for(f=0;f<b;f++){var h=c[f];if(h){if(Q){if(h.indexOf("mouse")>-1){continue;}else{if(h==="click"){h="touchend";}}}d.push("on"+h+"=\"mstrmojo.dom.captureDomEvent('{@id}','"+h+"', self, event)\"");}}return d.join(" ");});}var N="preBuildRendering",C="buildRendering",B="postBuildRendering";function X(b){var a=b.markupString;if(a.match(/mstrAttach:/)){a=U(a);if(b.markupString===b.constructor.prototype.markupString){b.constructor.prototype.markupString=a;}}var Z=M.apply(a,b);if(Z){if(mstrmojo.usesFrames){var c=(b.domNode&&b.domNode.ownerDocument)||window.document;if(!R||R.ownerDocument!==c){R=c.createElement("span");}}R.innerHTML=Z;var e=R.removeChild(R.firstChild);e.mstrmojoId=b.id;return e;}return null;}function A(b){var a=b.markupSlots,Z,c;if(a){Z={};for(c in a){Z[c]=a[c].call(b);}}return Z;}mstrmojo._HasMarkup=mstrmojo.provide("mstrmojo._HasMarkup",{markupString:null,markupMethods:null,markupSlots:null,onRender:mstrmojo.emptyFn,onUnRender:mstrmojo.emptyFn,render:function Y(){if((this[N]&&this[N]()===false)||(this[C]()===false)||(this[B]&&this[B]()===false)){return false;}this.hasRendered=!!this.domNode;this.onRender();var Z="renderComplete";if(mstrmojo.publisher.hasSubs(this.id,Z)){this.raiseEvent({name:Z});}return true;},buildDom:function T(){return X(this);},postBuildDom:null,preBuildRendering:mstrmojo.emptyFn,buildRendering:function F(){var Z=this.domNode,a=this.buildDom();this.domNode=a;if(this.postBuildDom){this.postBuildDom();}if(this.slotNames){this.removeSlots(this.slotNames);}this.addSlots(A(this));this.paint();if(a){var d=Z;if(!d){d=this.placeholder;if(d){if(typeof d==="string"){d=document.getElementById(d);}delete this.placeholder;}}if(d){E.replace(d,a);}}var b="onchildRenderingChange",c=this.parent;if(c&&c[b]){c[b](this);}return true;},postBuildRendering:mstrmojo.emptyFn,unrender:function S(b){if(this.hasRendered){if(!b){try{var Z=this.domNode;if(Z.parentNode){Z.parentNode.removeChild(Z);}if(mstrmojo.dom.isIE&&Z.outerHTML!=="undefined"){Z.outerHTML="";}}catch(a){}}this.domNode=null;this.removeSlots(this.slotNames);this.hasRendered=false;this.onUnRender();}},paint:function K(){var a=this.markupMethods;if(!a){return ;}var d=this,e=function(j){var h=a[j];if(h){try{h.apply(d,[true]);}catch(g){throw new Error(["Error in markup method.","Script class: "+d.scriptClass,"Widget id: "+d.id,"Method name: "+j,"Err: "+g.message].join("\n\n"));}}};var c=a.sequence,Z,b,f;if(c){Z=c.length||0;for(b=0;b<Z;b++){e(c[b]);}}else{for(f in a){e(f);}}},redraw:function P(){return false;},refresh:function D(Z){if(this.hasRendered){if(this.redraw()!==true){var a=this.domNode;this.unrender(true);this.placeholder=a;if(Z){Z();}this.render();}}},set:function I(c,Z){this._super(c,Z);if(this.domNode){var a=this.markupMethods,b=a&&a["on"+c+"Change"];if(b){b.apply(this);}}return this;},slotNames:null,addSlots:function G(a){var Z=this.slotNames,b;if(!Z){Z={};this.slotNames=Z;}for(b in a){this[b]=a[b];Z[b]=true;}},removeSlots:function H(Z){if(Z){var a=this.slotNames,b;for(b in Z){delete this[b];if(a){delete a[b];}}}},captureDomEvent:function W(b,Z,c,a){if(this.enabled!==false){this.raiseEvent(mstrmojo._HasMarkup.newDomEvent(b,Z,c||Z.event,a));}},playEffect:function V(a){var Z=this[a];if(Z&&Z.constructor===Object){Z=mstrmojo.insert(mstrmojo.hash.clone(Z));Z.widget=this;this[a]=Z;}if(Z){Z.play();}}});mstrmojo._HasMarkup.addMarkupMethods=function O(a,Z){a.prototype.markupMethods=L.copy(Z,L.copy(a.prototype.markupMethods));};mstrmojo._HasMarkup.MSTRDomEventType=null;mstrmojo._HasMarkup.newDomEvent=function(c,Z,b,a){return{name:c,hWin:Z,e:b,config:a,ctrlKey:E.ctrlKey(Z,b),shiftKey:E.shiftKey(Z,b),metaKey:E.isMetaKey(Z,b),cancel:function(){E.stopPropogation(Z,b);},preventDefault:function(){E.preventDefault(Z,b);},getTarget:function(){return E.eventTarget(Z,b);}};};}());(function(){mstrmojo.requiresCls("mstrmojo.string");var D=mstrmojo.string,F=1;mstrmojo.ListBuilder=mstrmojo.provide("mstrmojo.ListBuilder",{newContext:function E(G){var I=G.itemMarkupFunction;if(!I){var H=G.itemMarkup||(G.itemField&&'<div class="mstrmojo-text">{@'+G.itemField+"}</div>");I=H?function(K,J,L){return D.apply(H,K);}:null;}return{itemStatus:[],itemFunc:I};},build:function A(I,H,J,G){H.itemStatus[G]=F;return H.itemFunc(J,G,I);},onadd:function B(I,G,H){if(G){mstrmojo.array.insert(G.itemStatus,H.index,new Array(H.value.length));}},onremove:function C(I,G,H){if(G){G.itemStatus.splice(H.index,H.value.length);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.string");var T=mstrmojo.dom,K=mstrmojo.string,X=mstrmojo.array;mstrmojo.css=mstrmojo.provide("mstrmojo.css",{DISPLAY_TABLE:T.isNSIE?"block":"table",DISPLAY_CELL:T.isNSIE?"block":"table-cell",MINHEIGHT:T.isIE6?"height":"minHeight",addClass:function L(e,d){if(e){if(d.constructor!==Array){d=[d];}var Z=e.className||"",g=" "+Z+" ",a=false,Y=d.length,b;for(b=0;b<Y;b++){var f=d[b];if(!g.match(new RegExp("\\s"+f+"\\s"))){Z+=" "+f;a=true;}}if(a){e.className=K.trim(Z);}}return e;},removeClass:function N(c,b){if(!c){return ;}if(b.constructor!==Array){b=[b];}var Z=" "+(c.className||"")+" ",Y=b.length,a;for(a=0;a<Y;a++){Z=Z.replace(new RegExp("\\s"+b[a]+"\\s","g")," ");}c.className=K.trim(Z);},addWidgetCssClass:function M(d,b){var Z=d.cssClass,c=(Z&&Z.split(" "))||[],a;b=[].concat(b);for(a=0;a<b.length;a++){var Y=b[a];if(X.indexOf(c,Y)===-1){c.push(Y);}}d.cssClass=c.join(" ");},removeWidgetCssClass:function F(e,c){var Z=e.cssClass,d=(Z&&Z.split(" "))||[],b;c=[].concat(c);for(b=0;b<c.length;b++){var Y=c[b];var a=X.indexOf(d,Y);if(a!==-1){d.splice(a,1);}}e.cssClass=d.join(" ");},toggleClass:function S(a,Z,Y){if(Y){this.addClass(a,Z);}else{this.removeClass(a,Z);}},applyShadow:function G(c,d,b,a,Y){var Z=c.style;if(T.isDXIE){Z.filter+="progid:DXImageTransform.Microsoft.dropshadow(OffX="+d+"px, OffY="+b+"px, Color='"+Y+"')";}else{if(T.isFF||T.isWK||T.isIE10){Z[T.CSS3_BOXSHADOW]=d+"px "+b+"px "+a+"px "+Y;}}},removeShadow:function B(Z){var Y=Z.style;if(T.isFF||T.isWK||T.isIE10){Y[T.CSS3_BOXSHADOW]="";}},setOpacity:function U(Z,b){if(T.isDXIE&&!T.isIE9){var c=Z.currentStyle.filter;var Y=null;if(c.length>0){Y=Z.filters["DXImageTransform.Microsoft.Alpha"];}if(Y){Y.opacity=b;Y.enabled=(b!==100);}else{if(b<100){var a="progid:DXImageTransform.Microsoft.Alpha(Opacity="+b+")";Z.style.filter=(c||"")+" "+a;}}}else{Z.style.opacity=b/100-(T.isIE9?0.00001:0);}},buildGradient:function O(Z,b,Y){if(T.supports(T.cssFeatures.GRADIENTS)){var a={};if(T.isDXIE){a.n="filter";a.v="progid:DXImageTransform.Microsoft.Gradient(GradientType="+Z+",StartColorStr='"+b+"',EndColorStr='"+Y+"')";}else{if(T.isFF){a.n="background-image";a.v="-moz-linear-gradient("+((Z===0)?"top":"left")+","+b+","+Y+")";}else{if(T.isWK){a.n="background";a.v="-webkit-gradient(linear,"+((Z===0)?"left top, left bottom":"left top, right top")+",from("+b+"),to("+Y+"))";}else{if(T.isIE10||T.isIEW3C){a.n="background";a.v="linear-gradient("+((Z===0)?"to bottom":"to right")+","+b+","+Y+")";}}}}return a;}return null;},buildRoundCorners:function Q(d,c){if(T.supports(T.cssFeatures.ROUND_CORNERS)){var Z=d+"px";var f=Z+(c?" "+Z+" 0 0":"")+";";if(T.isFF||T.isWinPhone||T.isIE10){return"border-radius:"+f;}if(T.isWK){if(!c){return"-webkit-border-radius:"+Z+";";}var e=["left","right"],b=[],Y=-1,a;for(a=0;a<2;a++){b[++Y]="-webkit-border-top-"+e[a]+"-radius:"+Z;b[++Y]="-webkit-border-bottom-"+e[a]+"-radius:0";}return b.join(";");}}return"";},getBorderWidthsOrPaddings:function D(Z,e){var f={t:0,r:0,b:0,l:0,h:0,w:0};if(!Z){return f;}var c=Z.split(" "),Y=c.length,d;for(d=0;d<Y;d++){c[d]=Math.round(e*parseFloat(c[d])/72);}if(Y<4){if(Y===1){c[1]=c[2]=c[3]=c[0];}else{c[3]=c[1];if(Y===2){c[2]=c[0];}}}f.t=c[0];f.r=c[1];f.b=c[2];f.l=c[3];f.h=f.t+f.b;f.w=f.l+f.r;return f;},getBorderWidths:function H(Z,Y){return this.getBorderWidthsOrPaddings(Z,Y);},getPaddings:function C(Z,Y){return this.getBorderWidthsOrPaddings(Z,Y);},parkAfterFade:function A(Y){var Z=Y.target.style;if(Z.opacity===0){Z.left="-10000px";window.setTimeout(function(){Z.opacity=0.99;},0);return true;}return false;},getStyleValue:function I(Y,c){var a=(c==="float"),b;if(Y.currentStyle){c=a?"styleFloat":c;b=Y.currentStyle[c];}else{if(document.defaultView&&document.defaultView.getComputedStyle){c=a?"cssFloat":c;var Z=document.defaultView.getComputedStyle(Y,null);b=Z?Z[c]:null;}}return b;},getComputedStyle:function R(Y,a){var Z=(window.getComputedStyle)?function(b,c){return window.getComputedStyle(b,c||null);}:function(b){return b.currentStyle||{};};mstrmojo.css.getComputedStyle=Z;return Z(Y,a);},getCssTextFromObj:function E(a){var Z="",Y;for(Y in a){Z+=Y+":"+a[Y]+";";}return Z;},onTransitionEnd:function W(a,Y){var Z="transition",b=window.Modernizr;if(b.testProp(Z)){T.attachOneTimeEvent(a,T.transEndEvtNames[b.prefixed(Z)],Y);}else{window.setTimeout(Y,0);}},flashClass:function P(Z,Y,b){this.toggleClass(Z,Y,true);var a=this;window.setTimeout(function(){a.toggleClass(Z,Y,false);},b);},convertCssToCamelCase:function J(Y){return Y.replace(/\-([a-z])/gi,function(Z,a){return a.toUpperCase();});},printCSSInfo:function V(c){var g=document.styleSheets,l=g.length,d,e;for(e=0;e<l;e++){var f=g[e],h=f.cssRules,a=h?h.length:0,k=0;for(d=0;d<a;d++){var Y=h[d].selectorText;if(Y){try{k+=Y.split(",").length;}catch(b){}}}var Z=f.href;if(!c||(Z&&X.indexOf(Z,c)>-1)){console.log("Stylesheet: "+Z||"Inline CSS Block");console.log("Total rules: "+a);console.log("Total selectors: "+k);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher");var C=mstrmojo.publisher;mstrmojo._Provider=mstrmojo.provide("mstrmojo._Provider",{_meta_usesSuper:false,audibles:{"*":true},set:function F(N,H){var G=false,K=this["_set_"+N],I=this[N];if(K){G=K.apply(this,arguments);}else{this[N]=H;G=(I!==H);}if(G){var L=N+"Change",M=this.audibles||{},J=(M[N]===true)||((M[N]!==false)&&(M["*"]!==false));if(J&&(this["pre"+L]||this["on"+L]||this["post"+L]||C.hasSubs(this.id,L))){this.raiseEvent({name:L,prop:N,value:H,valueWas:I});}}return this;},raiseEvent:function B(H){var M=H&&H.name;if(!M){return null;}H.src=this;this.preHandleEvent(H);var K=["pre","on","post"],L=false,I,G;for(I=0,G=K.length;I<G;I++){var J=K[I]+M;if(this[J]){if(this[J](H)===false){L=true;break;}}}if(!L){this.postHandleEvent(H);C.publish(this.id,M,H);}return H;},preHandleEvent:mstrmojo.emptyFn,postHandleEvent:mstrmojo.emptyFn,attachEventListener:function A(G,H,I){return C.subscribe(this.id,G,I,H);},detachEventListener:function E(G){C.unsubscribe(G);},destroy:function D(){C.clearSubscriptions(this.id);if(this._super){this._super();}}});}());(function(){var D={};var B="XHRServerTransport";mstrmojo.XHRServerTransport={serverRequest:function A(I,G,F){var E=mstrmojo.all[I],H=D[G]=new mstrmojo.SimpleXHR();$MAPF(true,B,"transportRequest");if(F.params&&!F.params.sessionState&&mstrConfig&&mstrConfig.isAddSessionState&&mstrApp&&mstrApp.sessionState){F.params.sessionState=mstrApp.sessionState;}H.request(F.config.method||"POST",F.taskURL||mstrConfig.taskURL,{success:function(J){if(J.mstrerr){J.code=J.mstrerr.code;J.message=J.mstrerr.message;}E.response(G,true,J);},failure:function(J){E.response(G,false,{code:J.getResponseHeader("X-MSTR-TaskErrorCode"),message:J.getResponseHeader("X-MSTR-TaskFailureMsg")});},complete:function(){delete D[G];},textResponse:F.callback.textResponse},F.params);},cancelRequest:function C(F){var G=D[F],E=false;if(G){E=G.cancel();delete D[F];}$MAPF(false,B,"transportRequest");return E;}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.QueuedXHR");var F=mstrmojo.hash;function J(K,L){return function(){if(K[L]){K[L]();}};}var B=[];function H(L){var K;switch(L.cacheLevel){case mstrmojo.AjaxCall.CACHELEVEL_LOCAL:if(L._cache==null){L._cache=[];}K=L._cache;break;default:if(B==null){B=[];}K=B;break;}return K;}function E(N){var M=H(N);var P={cache:M,idx:-1},O=N.params;if("xts" in O){delete O.xts;}for(var L=0,K=M.length;L<K;L++){var Q=M[L];if(Q&&F.equals(Q.url,N.url)&&F.equals(Q.params,O)){P.idx=L;break;}}return P;}function C(L){var K=H(L),M=F.copy(L.params);delete M.xts;K.push({url:L.url,params:M,res:F.copy(L.response)});}function D(K){var L=E(K);if(L&&L.idx>=0){K.response=L.cache[L.idx].res;return true;}return false;}mstrmojo.AjaxCall=mstrmojo.declare(mstrmojo.QueuedXHR,null,{scriptClass:"mstrmojo.AjaxCall",method:"POST",url:"",params:null,onsuccess:null,onerr:null,oncomplete:null,oncancel:null,readCache:false,writeCache:false,cacheLevel:"",_cache:null,useQueue:false,init:function I(K){this._super(K);F.copy(K,this);},send:function A(){var K=this;if(this.readCache&&D(this)){this.onsuccess();return ;}this.request(this.method,this.url,{success:function(){if(K.writeCache){C(K);}if(K&&K.onsuccess){K.onsuccess();}},failure:J(K,"onerr"),complete:J(K,"oncomplete")},this.params,!this.useQueue);},cancel:function G(){this._super();if(this.oncancel){this.oncancel();}}});mstrmojo.AjaxCall.CACHELEVEL_GLOBAL="global";mstrmojo.AjaxCall.CACHELEVEL_LOCAL="local";})();(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.registry","mstrmojo._Provider","mstrmojo.array");var B=mstrmojo.registry,F=mstrmojo.array;mstrmojo.Obj=mstrmojo.declare(mstrmojo.Base,[mstrmojo._Provider],{scriptClass:"mstrmojo.Obj",id:"",init:function I(J){this.disposables=[];this._super(J);B.add(this);if(this.postCreate){this.postCreate();}},addDisposable:function G(M){var K=this.disposables,L,J;if(M.constructor===Array){for(L=0,J=M.length;L<J;L++){K.push(M[L]);}}else{K.push(M);}return M;},destroyDisposables:function D(J){F.forEach(this.disposables,function(K){if(K.destroy){K.destroy(J);}else{if(K.clear){K.clear();}}});this.disposables=[];},throwAbstractMethodError:function A(J){throw new Error(this.scriptClass+" must implement "+J+".");},destroy:function H(J){if(this.destroyed){return ;}this._super(J);this.destroyDisposables(J);B.remove(this);delete this.parent;this.destroyed=true;}});var C=mstrmojo.Obj;C.free=function E(J){if(J instanceof C){J.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.registry","mstrmojo.publisher","mstrmojo._Provider");var G=mstrmojo.hash,A=mstrmojo.array,B=mstrmojo.registry,D=mstrmojo.publisher;mstrmojo.Arr=mstrmojo.declare(null,[mstrmojo._Provider],{scriptClass:"mstrmojo.Arr",postApplyProperties:null,postCreate:null,length_bindEvents:["add","remove"],init:function H(K){var J;if(K&&K.data){J=K.data;delete K.data;}else{if(K){J=K;K=null;}}if(!J||J.constructor!==Array){J=[];}G.copy(mstrmojo.Arr.prototype,J);if(K){G.copy(K,J);}if(J.postApplyProperties){J.postApplyProperties();}B.add(J);if(J.postCreate){J.postCreate();}return J;},destroy:function E(){D.clearSubscriptions(this.id);B.remove(this);},add:function I(L,J,K){var M=L&&L.length;if(M){if(J==null){J=this.length;}A.insert(this,J,L);if(!K&&(this.onadd||D.hasSubs(this.id,"add"))){this.raiseEvent({name:"add",value:L,index:J});}}},remove:function F(J,L,K){if(L==null){L=1;}if((J!=null)&&L){var M=this.splice(J,L);if(!K&&(this.onremove||D.hasSubs(this.id,"remove"))){this.raiseEvent({name:"remove",value:M,index:J});}}}});mstrmojo.Arr.makeObservable=function C(J,K){if(!J){return ;}if(!K){K={};}K.data=J;return this.prototype.init(K);};})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.css");var A=1,K="mstrmojo-itemwrap",J="&nbsp;",I=mstrmojo.array;function B(V){if(!V.pageSize||V.pageSize<=0){var W=V.scrollboxNode;V.pageSize=W&&W.clientHeight||0;}return V.pageSize;}function T(V,W){if(V.usePaging){V.totalPages=1;var Y=V.itemsContainerNode,X=B(V);if(V.usePaging&&Y&&X){V.totalPages=Math.ceil((Y.clientHeight-parseInt(Y.style&&Y.style.paddingBottom||0,10))/X);}if(Y){V.itemsContainerNode.style.paddingBottom=X+"px";}}}mstrmojo.ListMapper=mstrmojo.provide("mstrmojo.ListMapper",{markupPrefix:"",markupSuffix:"",itemWrapperPrefix:function(V){return'<div class="'+this.getWrapperCss(V)+'">';},itemWrapperSuffix:"</div>",itemWrapperPrefill:"&nbsp",wrapperNodes:function C(V){return V.childNodes;},wrapperParentNode:function D(V){return V;},createWrapperNode:function G(V){var W=V.ownerDocument,X=W.createElement("div");return X;},findScrollRange:function N(k,Z,j,n,W,c,o,m){if(!Z){return{start:0,end:0};}var e=this.wrapperNodes(k),g=parseInt(Z/2,10),Y=parseInt(Math.log(Z)/Math.log(2),10),X=0,V=Z-1,f=j+n,d=e[0].offsetTop,b;for(var l=1;l<=Y;l++){b=e[g].offsetTop-d+m;if(b<j){X=g;}else{if(b>f){V=g;}}var a=Math.round(Z/Math.pow(2,l+1));g+=(b>j)?-a:a;g=Math.min(Math.max(0,g),Z-1);}return{start:X,end:V};},findWrapper:function L(X,V){var W=this.wrapperNodes(X);return W&&W[V];},findIndex:function F(V,Y,X){var W=this._nd2iw(V,Y,X);return W?this._iw2idx(V,Y,W):-1;},itemOffsetTop:function U(W,a,V,Y){if(!Y){var X=this.wrapperNodes(a);Y=X&&X[V];if(!Y){return 0;}}var Z=a.firstChild;if(!Z||(Z===Y)){return 0;}else{return Y.offsetTop-Z.offsetTop;}},whereDrop:function S(c,V,X,b,W){var Y=this._nd2iw(c,V,X),d,a,e;if(Y){a=this._iw2idx(c,V,Y);d=a;e=this.itemOffsetTop(c,V,null,Y);var Z=Y.offsetHeight;if(b.y>W.top+e+Z/2){d++;e+=Z;}}else{return c.dropCuePos;}return{left:0,top:e,idx:d,idxActual:a};},getWrapperCss:function(V){return K;},postBuildRendering:function(Z,Y,X,W,V){T(W,this);},buildItemWrappers:function P(e,b,h,d,a,l){var m=this.itemWrapperPrefix(h),g=this.itemWrapperSuffix,Z=m+this.itemWrapperPrefill+g,Y=[this.markupPrefix],W=1,V=h.selectedIndices||{},o=function n(k,j){for(var p=k;p<j;p++){Y[W++]=m;var q=b.build(h,d,e[p],p);if(V[p]){q=q.replace(/class\=\"([^\"]*)\"/,'class="$1 selected"');}Y[W++]=q;Y[W++]=g;}};var c=(e&&e.length)||0;a=a&&b?Math.min(a,c):0;if(a){o(0,a);}l=l&&b?Math.min(l,c-a):0;var f=c-l;for(var X=a;X<f;X++){Y[W++]=Z;}if(l){o(f,c);}Y.push(this.markupSuffix);return Y;},fillItemWrappers:function H(X,g,d,m,f,W,b,l){var e=(g&&g.length)||0,j=this.wrapperNodes(X),n=f.itemStatus,V=mstrmojo.css,Z=m.selectedIndices||{};for(var c=W,h=Math.min(b+1,e),a=0;c<h;c++){if(n[c]!==A){j[c].innerHTML=d.build(m,f,g[c],c);if(Z[c]){var Y=j[c].firstChild;if(Y){V.addClass(Y,["selected"]);}}a++;if(a===l){break;}}}return a;},onadd:function O(e,V,Z,f){if(V&&f){var a=f.value.length,b=this.wrapperNodes(V),d=b[f.index],Y=this.getWrapperCss(e);for(var X=0;X<a;X++){var W=this.createWrapperNode(V);W.className=Y;W.innerHTML=J;if(d){this.wrapperParentNode(V).insertBefore(W,d);}else{this.wrapperParentNode(V).appendChild(W);}}T(e,this);}},onremove:function Q(Y,b,V,X){if(b&&X){var a=this.wrapperNodes(b);if(a){var d=X.value.length;for(var Z=X.index+d-1,W=X.index;Z>=W;Z--){this.wrapperParentNode(b).removeChild(a[Z]);}}T(Y,this);}},onchange:function R(g,X,c,k){if(X&&k){var d=this.wrapperNodes(X);if(d){var W=mstrmojo.css,l=c.itemStatus,h;for(var b=0,V=k.removed,f=V&&V.length;b<f;b++){h=V[b];if(l[h]){W.removeClass(d[h].firstChild,["selected"]);}}for(var Z=0,e=k.added,Y=e&&e.length;Z<Y;Z++){h=e[Z];if(l[h]){W.addClass(d[h].firstChild,["selected"]);}}}}},_nd2iw:function E(W,Z,Y){Z=this.wrapperParentNode(Z);if(Z&&Y&&Z!==Y){var V=W.domNode,X=Y.parentNode;while(X){if(X===Z){return Y;}if(X===V){break;}Y=X;X=Y.parentNode;}}return null;},_iw2idx:function M(X,b,a){var W=X.items&&X.items.length,Y=this.wrapperNodes(b),V=I.findBin(Y,a,"offsetTop",W);for(var Z=V;Z<W;Z++){if(Y[Z].offsetHeight){return Z;}}return -1;},toPage:function(V,X){var W=V.scrollboxNode;if(V.usePaging&&W){W.scrollTop=X*B(V);}else{mstrmojo.alert("paging is not setup, can not perform paging.");}},whichPage:function(V){var W=V.scrollboxNode,X=B(V);return Math.round((W&&X&&W.scrollTop/X)||0);},toItem:function(Z,a){var X=Z&&Z.itemsContainerNode,e=Z.scrollboxNode,V=this.itemOffsetTop(Z,X,a),b=this.wrapperNodes(X)[a].clientHeight,W=e.clientHeight,d=e.scrollTop,Y=d;if(V<d){Y=V;}else{if(d+W-b<V){Y=Math.min(V,V-W+b);}}e.scrollTop=Y;}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.fx.AnimateProp");var S=mstrmojo.css;var Q=10;function C(W,Z,Y){W.pauseScrollRendering(true);var X=W.scrollboxNode,V=W.animate?W.scrollEffect:null;if(V&&V.play){if(V.isPlaying){V.cancel();}V.props={scrollTop:{start:X.scrollTop,stop:Z,isStyle:false}};V.onEnd=function(){W.pauseScrollRendering(false,null,Y);};V.play();}else{X.scrollTop=Z;W.pauseScrollRendering(false,null,Y);}}function K(c,e,V){var W=4;if(!V){V=0;}var f=Math.round(c.renderBlockSize/2);c.fillAt(Math.max(0,e-f),e+f);var b=c.itemsContainerNode,a=b.childNodes[e],Z=c.listMapper.itemOffsetTop(c,b,null,a),d=parseInt(c.scrollboxNode.clientHeight/2,10)-a.offsetHeight/2,X=Math.max(0,c.spacerMargin+Z-d);if(Math.abs(c.scrollboxNode.scrollTop-X)>2){C(c,X,c.renderOnScroll?function(){if(V<=W){K(c,e,V++);}}:null);}else{var Y=c.animate?c.scrollEffect:null;if(Y&&Y.isPlaying&&Y.cancel){Y.cancel();c.pauseScrollRendering(false);}}}function J(X){var Y=X.itemsContainerNode,V=Y.lastChild,W=V?V.offsetTop+V.offsetHeight-Y.firstChild.offsetTop:0;return W;}function U(W){var V=J(W),X=Math.max(0,parseInt((W.scrollboxNode.clientHeight-V)/2,10));C(W,Math.max(0,W.spacerMargin-X));}function H(X){var V=X.selectedIndex,W=V>-1;X.set("hasSelection",W);if(!X.domNode){return ;}if(W){K(X,V);}else{U(X);}}function E(W){var Y=W.scrollboxNode,V=J(W),X=V>Y.clientHeight/2;S.toggleClass(W.upArrowNode,["enabled"],X);S.toggleClass(W.downArrowNode,["enabled"],X);}function N(V,W){var X=V.scrollboxNode;X.scrollTop=Math.min(Math.max(X.scrollTop+W,0),X.scrollHeight-X.offsetHeight);}function B(W,V){if(!W._scrollInter){var X=Q*(V?-1:1);W._scrollInter=window.setInterval(function(){N(W,X);},50);}}function R(V){if(V._scrollInter){window.clearInterval(V._scrollInter);V._scrollInter=null;}}mstrmojo._IsDial=mstrmojo.provide("mstrmojo._IsDial",{markupString:'<div id="{@id}" class="mstrmojo-Dial {@cssClass}" style="position:relative;"><div class="mstrmojo-Dial-uparrow"  onmouseover="mstrmojo.all.{@id}.onmouseoverarrow(self, arguments[0], true)" onmouseout="mstrmojo.all.{@id}.onmouseoutarrow(self, arguments[0], true)" onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], true)" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], true)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], true)"></div><div class="mstrmojo-Dial-scrollbox {@cssClass}" style="position:relative;{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-Dial-spacer" style="{@spacerCssText}"><div class="mstrmojo-Dial-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div></div></div><div class="mstrmojo-Dial-dnarrow" onmouseover="mstrmojo.all.{@id}.onmouseoverarrow(self, arguments[0], false)" onmouseout="mstrmojo.all.{@id}.onmouseoutarrow(self, arguments[0], false)" onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], false)" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], false)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], false)"></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.childNodes[1];},spacerNode:function(){return this.domNode.childNodes[1].firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1].firstChild.firstChild;},upArrowNode:function(){return this.domNode.childNodes[0];},downArrowNode:function(){return this.domNode.childNodes[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onhasSelectionChange:function(){S.toggleClass(this.domNode,["hasSelection"],!!this.hasSelection);}},animate:true,itemsEffect:{scriptClass:"mstrmojo.fx.AnimateProp",duration:500,interval:25,slot:"itemsContainerNode",preStart:function(){var W=this.widget[this.slot],V=(W&&W.offsetWidth)||0;this.props=V?{left:{start:-V,stop:0,suffix:"px",isStyle:true}}:{};},revertOnCancel:false},scrollEffect:{scriptClass:"mstrmojo.fx.AnimateProp",duration:250,interval:25,slot:"scrollboxNode",revertOnCancel:false},multiSelect:false,holdJumpOnly:true,audibles:{"*":true,hasSelection:false},initSpacer:function I(){var V=(this.cssText||"").match(/height:\s*(\d*)px/);if(V){this.spacerMargin=parseInt(Number(V[1])/2,10);var W=this.spacerMargin+"px";this.spacerCssText="padding-top: "+W+"; padding-bottom: "+W+";";}else{this.spacerMargin=0;delete this.spacerCssText;}},center:function T(){H(this);},preBuildRendering:function(){this.initSpacer();return this._super();},postBuildRendering:function D(){this._super();this.center();E(this);},refreshScroll:function G(){this.center();E(this);},prechange:function O(V){this._super(V);if(this.hasRendered){if(!this.multiSelect||(V&&V.added&&V.added.length)){this.center();}}},onclickarrow:function A(X,W,V){N(this,Q*(V?-1:1));},onmouseoverarrow:function L(X,W,V){if(!this.holdJumpOnly){B(this,V);}},onmouseoutarrow:function M(X,W,V){R(this);},onmousedownarrow:function F(X,W,V){if(this.holdJumpOnly){B(this,V);}},onmouseuparrow:function P(X,W,V){R(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom");var E=mstrmojo.css,C=mstrmojo.dom,B="dzMask",I="mask",J="idx";function G(K){E.toggleClass(this.domNode,I,false);E.toggleClass(K,B,false);}mstrmojo.architect.ui._HasTreeDropZone=mstrmojo.provide("mstrmojo.architect.ui._HasTreeDropZone",{_mixinName:"mstrmojo.architect.ui._HasTreeDropZone",ondragenter:function F(K){E.toggleClass(this.domNode,I,true);if(this._super){this._super(K);}},ondragover:function A(L){var P=L.src,O=L.tgt.node,K=L.dzNode;if(P&&P.data&&O!==K){E.toggleClass(K,B,false);var M=C.findAncestorByAttr(O,J,true,this.domNode);if(M){var N=M.node;L.dzNode=N;E.toggleClass(N,B,true);}}if(this._super){this._super(L);}},ondragleave:function H(K){G.call(this,K.dzNode);if(this._super){this._super(K);}},ondrop:function D(K){G.call(this,K.dzNode);if(this._super){this._super(K);}}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.hash","mstrmojo.css");var F=mstrmojo.hash,C=mstrmojo.css;var D="open";function E(G){return G?G.popupConfig.hostElement:null;}mstrmojo.ui.menus._HasMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._HasMenuPopup",F.copy(mstrmojo._HasPopup));mstrmojo.ui.menus._HasMenuPopup.openPopup=function A(I,G){var H=this._lastOpened;if(H){this.closePopup();}mstrmojo._HasPopup.openPopup.call(this,I,G);C.addClass(E(I),D);};mstrmojo.ui.menus._HasMenuPopup.closePopup=function B(){C.removeClass(E(this._lastOpened),D);mstrmojo._HasPopup.closePopup.call(this);};}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.fx");var Y=mstrmojo.css,H=mstrmojo.dom,O=mstrmojo.array,K={v:{styleDim:"height",styleDir:"top",dimension:"h",position:"y",scroll:"scrollTop",scrollDimension:"scrollHeight",cls:"vertical",hostCls:"hasVertical",scrollNodeCls:"hasVertical"},h:{styleDim:"width",styleDir:"left",dimension:"w",position:"x",scroll:"scrollLeft",scrollDimension:"scrollWidth",cls:"horizontal",hostCls:"hasHorizontal",scrollNodeCls:"hasHorizontal"}},W="scrollingMode",R="scrolling",b=3;var L=H.getOSInfo().name.toLowerCase().indexOf("mac")>=0;function J(){return(this.scrollbarHostNode||(this.scrollNode&&this.scrollNode.parentNode));}function P(d,c){var j=H.eventTarget(c,d),g=this.scrollNode,f=H.position(g),h=this.scrollTrackNodes,e=this.scrollBarNodes,k=function k(u){var q=j===h[u];if(q){var w=K[u],l=e[u],x=H.position(l),n=H.getMousePosition(d,c)[w.position],o=n-x[w.position],m=o>0?1:-1,t=g[w.scrollDimension],z=Math.abs(o-(x.h/2))*(t/f[w.dimension]),p={};p[w.scroll]={isStyle:false,start:g[w.scroll],stop:g[w.scroll]+(m*Math.min(t/3,500,z)),ease:mstrmojo.ease.linear};(new mstrmojo.fx.AnimateProp({props:p,duration:200,interval:10,target:g})).play();}};k.call(this,"h");k.call(this,"v");}function B(d,c){var g=this.scrollNode,f=d.type==="mousewheel",e=f?-1:1;mstrmojo.array.forEach(["h","v"],function(o){var m=K[o],j=f?"wheelDelta":"delta",l=d[j+{h:"X",v:"Y"}[o]]*e,k=Math.abs(l),h=l/k,n=k===3&&H.isFF&&!L;g[m.scroll]+=n?h*40:l;});H.stopPropogation(c,d);H.preventDefault(c,d);}function a(h){var g=K[h],f=this.scrollNode,e=H.position(f),d=e[g.dimension],j=f[g.scrollDimension],c=Math.ceil(d)/j;return A(c,d,j);}function A(d,c,e){return(!isNaN(d)&&d<1)&&(Math.abs(c-e)>b);}function C(AC){var t="px",l=K[AC],e=this.scrollNode,m=J.call(this),AD=H.position(e),n=AD[l.dimension],w=e[l.scrollDimension],d=Math.ceil(n)/w,AB=this.scrollBarNodes,j=AB[AC],p=this.scrollTrackNodes,q=p[AC],z=A(d,n,w),f=l.cls;if(!j){q=p[AC]=document.createElement("div");var g=this,o=function(AF){P.call(g,AF);},k=function(AF){B.call(g,AF);},x=function(AH,AF,AG){H.attachEvent(AH,AF,AG);g.installedEventListeners.push({e:AH,evt:AF,fn:AG});};x(q,"click",o);q.className="mstrmojo-scrolltrack "+f;j=AB[AC]=document.createElement("div");j.className="mstrmojo-scrollbar "+f;q.appendChild(j);m.appendChild(q);var AA=mstrApp.isSingleTier?"mousewheel":"wheel";x(q,AA,k);x(j,AA,k);}var AE=j.style,h=(e[l.scroll]/e[l.scrollDimension]),c=H.delta(e,J.call(this))[l.position],u=q.style;if(z){u[l.styleDir]=c+t;AE[l.styleDim]=(d*n)+t;AE[l.styleDir]=(n*h)+t;}Y.toggleClass(m,l.hostCls,z);Y.toggleClass(e,l.scrollNodeCls,z);return z;}function G(){return !(mstrApp.isSingleTier&&L);}mstrmojo.ui._HasScroller=mstrmojo.provide("mstrmojo.ui._HasScroller",{_mixinName:"mstrmojo.ui._HasScroller",hasCustomScrollbar:null,draggable:true,ownAvatar:true,scrollNode:undefined,scrollbarHostNode:undefined,scrollBarNodes:undefined,setupScrollNodes:mstrmojo.emptyFn,installedEventListeners:null,init:function T(c){this._super(c);if(this.hasCustomScrollbar===null){this.hasCustomScrollbar=G();}this.installedEventListeners=[];},onRender:function I(){if(this._super){this._super();}this.updateScrollbars();this.addScrollNodeProperties();},addScrollNodeProperties:function F(){var d=this.scrollNode;if(d){var c=H.attachMarkupEvent(this.id,d,"scroll");this.installedEventListeners.push({e:d,evt:"scroll",fn:c});}if(!this.hasCustomScrollbar){Y.addClass(d,"mstrmojo-sb-show-default");return ;}if(d){Y.addClass(J.call(this),"mstrmojo-scrollbar-host");Y.addClass(d,"mstrmojo-scrollNode");}},updateScrollbars:function Z(){if(!this.hasRendered){return ;}this.setupScrollNodes();if(!this.hasCustomScrollbar){if(this.scrollNode){this.scrollNode.style.overflowX=a.call(this,"h")?"scroll":"hidden";}return ;}if(this.scrollNode){this.scrollBarNodes=this.scrollBarNodes||{};this.scrollTrackNodes=this.scrollTrackNodes||{};var c=this.scrollNode.style;c.overflowY=C.call(this,"v")?"scroll":"hidden";c.overflowX=C.call(this,"h")?"scroll":"hidden";}},onscroll:function V(){var k=this.scrollNode;if(k&&this.hasCustomScrollbar){var g=function g(l){var m=parseInt(l);return m===null||isNaN(m)?0:m;},h=H.position(k),j=h.h-g(Y.getStyleValue(k,"padding-bottom")),d=h.w-g(Y.getStyleValue(k,"padding-right")),f=this.scrollBarNodes,e=f.v,c=f.h;if(k.scrollHeight-j>0){e.style.top=((j-H.position(e).h)*(k.scrollTop/(k.scrollHeight-j)))+"px";}if(k.scrollWidth-d>0){c.style.left=((d-H.position(c).w)*(k.scrollLeft/(k.scrollWidth-d)))+"px";}}if(this._super){this._super();}if(this.onScrollEnd){this.onScrollEnd();}},getDragData:function E(d){var g=this.scrollNode,f=H.position(g),e=d.src.node,c=this.scrollBarNodes;if(this.isDraggingScrollBar(d)){return{isScrollBar:true,direction:e===c.v?"v":"h",scrollTop:g.scrollTop,scrollLeft:g.scrollLeft,conversionRatio:{y:g.scrollHeight/f.h,x:g.scrollWidth/f.w}};}return(this._super&&this._super(d));},isDragValid:function D(c){return this.isDraggingScrollBar(c)||(this._super&&this._super(c))||false;},isDraggingScrollBar:function S(d){var e=d.src.node,c=this.scrollBarNodes;return !!c&&(e===c.v||e===c.h);},ondragstart:function X(c){if(this.isDraggingScrollBar(c)){Y.addClass(c.src.node,R);Y.addClass(J.call(this),W);}if(this._super){this._super(c);}},shouldDragBubble:function Q(c){var d=c.src.node,e=this.scrollTrackNodes;return !!e&&(d===e.v||d===e.h);},ondragmove:function N(d){if(this.isDraggingScrollBar(d)){var m=d.tgt,c=d.src,n=m.pos,e=c.pos,j=c.node,h=this.scrollNode,l=this.scrollBarNodes,k=c.data,g={y:(n.y-e.y),x:(n.x-e.x)},f=k.conversionRatio;if(j===l.v){h.scrollTop=k.scrollTop+(g.y*f.y);}else{h.scrollLeft=k.scrollLeft+(g.x*f.x);}}if(this._super){this._super(d);}},ondragend:function N(c){if(this.isDraggingScrollBar(c)){Y.toggleClass(c.src.node,R,false);Y.toggleClass(J.call(this),W,false);}if(this._super){this._super(c);}},widgetResized:function M(){if(this._super){this._super();}this.updateScrollbars();},unrender:function U(c){O.forEach(this.installedEventListeners,function(d){H.detachEvent(d.e,d.evt,d.fn);});delete this.scrollNode;delete this.scrollbarHostNode;delete this.scrollBarNodes;delete this.scrollTrackNodes;this._super(c);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.expr","mstrmojo.css");var G=mstrmojo.array,F=mstrmojo.expr,H=mstrmojo.css;mstrmojo._IsExprNode=mstrmojo.provide("mstrmojo._IsExprNode",{ind:function B(){var L=this.parent;if(L&&L.indent){var K=this.childIndex();K=(K>-1&&(K>0))?[K,K-1]:null;if(K){L.indent(K);}}},out:function D(){var L=this.parent;if(L&&L.outdent){var K=this.childIndex();K=(K>-1&&(K>0))?[K,K-1]:null;if(K){L.outdent(K);}}},andOrTxt:function A(){var M=this.parent,K=M&&M.data,L="",N=this.data;if(K&&(K.et===F.ET.ANDOR)&&K.fn){L=K.fn+(N&&N.not?"_"+F.FN.NOT:"");L=F.BRANCH_FNS[L];}return'<span class="mstrmojo-text mstrmojo-andor">'+L+"</span>";},getPrefixAndOrToolsMarkup:function(){return('<span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()" mstrAttach:mouseover,mouseout>'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()" mstrAttach:mouseover,mouseout>'+mstrmojo.desc(5896,"Ungroup Conditions")+"</span>");},premousedown:function J(K){var L=mstrmojo.dom.eventTarget(K.hWin,K.e);if(this.prefixHoverNode&&mstrmojo.dom.contains(this.prefixHoverNode,L,false)){mstrmojo.dom.stopPropogation(K.hWin,K.e);return ;}if(this._super){this._super(K);}},isSelectableArea:function E(K){return true;},childIndex:function I(){var M=this.parent,K=M&&M.data,L=K&&K.nds,N=this.data;if(L&&N){return G.indexOf(L,N);}return -1;},toggleGroupBorder:function C(K){H.toggleClass(this.parent.itemsContainerNode.childNodes[this.childIndex()-1].firstChild,"upgroup",K);H.toggleClass(this.domNode,"downgroup",K);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css");var F=mstrmojo.css,E="px",J="hasOwnAvatar",I={x:0,y:0};function B(L){var K=this.createAvatar(L.src.node,L);if(K){F.addClass(K,[this.avatarCssClass,J]);this.avatar=L.avatar=document.body.appendChild(K);}}function C(){var K=this.avatar;if(K){K.parentNode.removeChild(K);delete this.avatar;F.removeClass(K,[this.avatarCssClass,J]);}}mstrmojo._HasOwnAvatar=mstrmojo.provide("mstrmojo._HasOwnAvatar",{_mixinName:"mstrmojo._HasOwnAvatar",draggable:true,ownAvatar:true,avatarCssClass:"",restrictedToAxis:undefined,isDragValid:function H(K){if(this._super){return this._super(K);}return false;},ondragstart:function D(K){B.call(this,K);this.positionAvatar(K.src.pos,K);if(this._super){this._super(K);}},ondragmove:function A(K){this.positionAvatar(K.tgt.pos,K);if(this._super){this._super(K);}},ondragend:function A(K){C.call(this);if(this._super){this._super(K);}},createAvatar:mstrmojo.emptyFn,positionAvatar:function G(O,L){var N=this.avatar.style,M=this.restrictedToAxis,K=(L&&L.dragOffsets)||I;if(M!=="y"){N.left=O.x+K.x+E;}if(M!=="x"){N.top=O.y+K.y+E;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var J={T:["top","left"],D:["height","width"],B:["border","border-color","border-style","border-width"],F:["font","color","text-decoration"],P:["padding"],BG:["background-color","fx"],RW:[]};J.RW=["z-index"].concat(J.T.concat(J.D));var D=mstrmojo.dom,O=mstrmojo.css;function N(T,V,S){var U=T[V]||[];U.push(S);T[V]=U;}function L(W,V){var U=((W&&W.fmts)||null);if(V){var Y=W.thresholds,T=Y&&Y[V];if(T){var X={},Z;for(Z in U){X[Z]=T[Z]||U[Z];}for(Z in T){var S=T[Z];X[Z]=(typeof S==="string")?(S+" !important"):S;}U=X;}}return U;}mstrmojo._Formattable=mstrmojo.provide("mstrmojo._Formattable",{_mixinName:"mstrmojo._Formattable",formatHandlers:null,thresholdId:null,getCacheKey:function E(){return"css_cache"+(this.thresholdId||"");},update:function G(T){var S=true;this.invisible=!!(T&&T.data&&T.data.invisible);if(this._super){S=this._super(T);}return S;},buildCSSFormatString:function H(U,d){var h=this.formatHandlers[U],k=h.src?d[h.src]:d;if(!k){return null;}var b=h.props||h;if(!b){return null;}var X=[],g=-1;var V=b.length-1;for(V;V>=0;V--){var j=b[V];var c=J[j]||[j];var a=c.length-1;for(a;a>=0;a--){j=c[a];var T=k[j];if(T!==undefined){if(j==="fx"){var Y=T,S={};var e=Y.gd;if(e){this.formatGradient(e,S);}var W=parseInt(Y.rt,10);if(W){if(W===1||W===3){this.formatTextRotation(Y.rt,S);}}if(Y.ds){this.formatDropShadow(Y,S);}var Z;for(Z in S){X[++g]=Z+":"+S[Z].join(" ");}}else{X[++g]=j+":"+T;}}}}if(this.invisible){X.push("visibility:hidden");}return X.join(";")+";";},applyCSSFormatToNode:function I(U,S){var V=this[U],T=V&&V.style;if(T){this.buildCSSFormatString(U,S).split(";").forEach(function(W){var X=W.split(":");T[O.convertCssToCamelCase(X[0])]=X[1];});}},clearSlotBackgroundCSS:function F(T){var U=this[T],S=U&&U.style;if(S){S.background="transparent none 0 0 no-repeat";S.filter="none";}},preBuildRendering:function B(){this._super();var V=this.formatHandlers,S=this.getFormats();if(V&&S){var W=this.defn=this.defn||{},X=this.getCacheKey(),U=W[X];if(!U){U=W[X]={};for(var T in V){var Z=T+"CssText";this[Z]=U[Z]=this.buildCSSFormatString(T,S)||"";}}else{var Y;for(Y in U){this[Y]=U[Y];}}}return true;},formatGradient:function P(S,U){var T=O.buildGradient(S.t,S.sc,S.ec);if(T){N(U,T.n,T.v);}},formatDropShadow:function K(W,U){if(D.supports(D.cssFeatures.DROP_SHADOW)){var V=W.ds;if(D.isDXIE){N(U,"filter","progid:DXImageTransform.Microsoft.DropShadow(Color='#66000000',Positive='true',OffX="+V+",OffY="+V+")");}else{var S=[V,V],T=parseInt(W.rt,10);if(T===1||T===3){S[((T===1)?1:0)]=-V;}N(U,(D.isWK?"-webkit-":"")+"box-shadow",S.join("px ")+"px 3px 0px #888");}}},formatTextRotation:function C(T,S){if(D.supports(D.cssFeatures.TEXT_ROTATION)){if(D.isDXIE){N(S,"filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+T+")");}else{var U=(T===1)?90:-90;N(S,D.CSS3_PREFIX+"transform-origin","top left");N(S,D.CSS3_PREFIX+"transform","rotate("+U+"deg)");}}},getFormats:function R(){if(!this.fmts){this.fmts=L.call(this,this.defn,this.thresholdId);}return this.fmts;},clearFormats:function A(){this.fmts=undefined;},createEmptyFormats:function(){return(this.fmts=this.fmts||{});},clearCache:function Q(){delete this.defn[this.getCacheKey()];},unrender:function M(S){if(this.thresholdId){this.fmts=null;}this._super(S);}});mstrmojo._Formattable.getBorderWidths=function(W){var V=W.getFormats(),S=(V.border)?V.border.match(/(\d*|\d*\.\d*)pt/)[0]:V["border-width"],U=W.model,T=U.docModel;return O.getBorderWidths(S,(T&&T.dpi)||U.dpi);};}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var G=mstrmojo.dom,J=mstrmojo.css,H="selected";function B(S,T,U,R,W){var V=W.listHooks[S];if(V&&V.call(W,T,U,R)){return ;}J.toggleClass(T,H,S==="select");}function I(U,T,S){var V=this[U],R=V?V.split(T):[];this[U]=mstrmojo.array.distinct(R.concat(S.split(T))).join(T);}mstrmojo._IsList=mstrmojo.provide("mstrmojo._IsList",{_mixinName:"mstrmojo._IsList",listHooks:{},useListModKeys:false,init:function Q(R){this._super(R);this._shiftStartIndex=-1;},getItemMarkup:function O(S,R){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@en@n}</{@tag}>';},getItemDisplayName:function E(R){return R.n||"";},getItemProps:function K(V,R){var S=!!this.selectedIndices[R],W={tag:"div",sel:S,cls:"",n:this.getItemDisplayName(V),style:"",idx:R,addCls:function T(Y){I.call(this,"cls"," ",Y);},addStyle:function U(Y){I.call(this,"style",";",Y);},title:V.title||""};if(S){W.addCls(H);}var X=V.cls;if(X){W.addCls(X);}return W;},itemRenderer:{render:function A(S,R,T){S._renderIdx=R;return mstrmojo.string.apply(T.getItemMarkup(S,R),T.getItemProps(S,R));},select:function L(S,T,R,U){B("select",S,T,R,U);},unselect:function D(S,T,R,U){B("unselect",S,T,R,U);}},onclick:function P(R){try{var T=this.getItemFromTarget(R.getTarget());if(T){R.cancel();this.doItemSelect(T,R||{});}}catch(S){mstrApp.onerror(S);}},doItemSelect:function F(j,b){var R=b.hWin,h=b.e,c=j._renderIdx,W=j._positionIdx,S=G.isMetaKey(R,h),Z=G.shiftKey(R,h),Y=this.multiSelect,U=this.useListModKeys,d=this._shiftStartIndex,X=this.selectedIndices;if(Y&&U&&Z&&d>-1){var g=[],T=[],V=Math.min(d,c),k=Math.max(d,c),f;for(f=0;f<this.items.length;f++){if(V<=f&&f<=k){if(!X[f]){g.push(f);}}else{if(X[f]){T.push(f);}}}this.addSelect(g);this.removeSelect(T);}else{if(Y&&(!U||S)){var a=(X[c])?"remove":"add";this[a+"Select"](c,false,W);}else{this.singleSelect(c,false,W);}this._shiftStartIndex=c;}},onclearSelection:function N(){this._shiftStartIndex=-1;},getItemNodeFromTarget:function C(S){var R=G.findAncestorByAttr(S,"idx",true,this.domNode);return(R&&R.node)||null;},getItemFromTarget:function M(T){var S=this.getItemNodeFromTarget(T),R=S&&parseInt(S.getAttribute("idx"),10);if(R!==null&&!isNaN(R)&&this.items){return this.items[R];}return undefined;}});mstrmojo._IsList.SELECTED_CLS=H;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.string","mstrmojo.css");var K=mstrmojo.css,N=mstrmojo.string,H=mstrmojo.dom,L=13,C=27;function I(S){if(this._editComplete){return ;}var W,Q=false,V=this.text,T=false;if(S===C){W=V;T=true;Q=true;}if(!S||(!this.allowNewLine&&S===L)){var R=this[this.editableSlot],U=R.innerText||R.textContent||"";if(!this.allowNewLine){W=U.replace(/\n/g,"");}else{W=U;}Q=true;if(!this.allowEmptyText&&W.length===0){W=V;T=true;}}if(Q){this._editComplete=true;W=W.replace(/\u00A0/g,"\u0020");this.text=W;this.set("isEditing",false);this.onTextEditComplete(W!==V,V);delete this._editComplete;}if(T){this.refresh();}}function E(Q){var R={dblclick:"editOnDoubleClick",click:"editOnClick"};if(this[R[Q.name]]&&Q.getTarget()===this[this.editableSlot]){this.set("isEditing",true);}}function F(S,R,Q){if(typeof R["on"+Q]!=="function"){H.attachMarkupEvent(S,R,Q);}}mstrmojo._HasEditableText=mstrmojo.provide("mstrmojo._HasEditableText",{_mixinName:"mstrmojo._HasEditableText",editableSlot:"domNode",editButtonSlot:null,isEditing:false,editOnClick:true,allowEmptyText:false,allowNewLine:false,editOnDoubleClick:false,onTextEditComplete:mstrmojo.emptyFn,postBuildRendering:function A(){this._super();var S=this.editableSlot,Q=this[S],T=this[this.editButtonSlot||S];K.addClass(Q,"hasEditableText");this.text=this.text||Q.innerText||Q.textContent||"";Q.innerHTML=N.encodeHtmlString(this.text,true).replace(/ (?= )/g,"&nbsp;");var R=this.id;if(this.editOnClick){F(R,T,"click");}F(R,T,"dblclick");F(R,Q,"blur");F(R,Q,"keyup");F(R,Q,"keydown");},onclick:function P(Q){E.call(this,Q);if(this._super){this._super(Q);}},ondblclick:function G(Q){E.call(this,Q);},onblur:function M(){I.call(this);},onkeyup:function B(R){var Q=window.event||R.e;I.call(this,Q.keyCode);},onkeydown:function J(R){var Q=window.event||R.e;if(Q.keyCode===L){I.call(this,Q.keyCode);R.cancel();}},_set_text:function D(S,Q){var R=this.text;this.text=Q;if(this.hasRendered){this[this.editableSlot].innerHTML=N.encodeHtmlString(Q||"",true);}return(R!==Q);},onisEditingChange:function O(){if(this.hasRendered){var Q=this[this.editableSlot],R=!!this.isEditing;Q.contentEditable=R;Q.spellcheck=false;K.toggleClass(Q,"editable",R);if(R){Q.focus();H.setElementSelection(Q);}else{Q.blur();Q.scrollLeft=0;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css");var A=mstrmojo.css;mstrmojo.ui._HasUITheme=mstrmojo.provide("mstrmojo.ui._HasUITheme",{_mixinName:"mstrmojo.ui._HasUITheme",themeClassName:"",postBuildRendering:function B(){var D=this.themeClassName;if(D){this.onthemeClassNameChange({value:D});}return this._super();},onthemeClassNameChange:function C(D){var F=this.domNode;if(F){var G=D.value,E=D.valueWas;if(G){A.addClass(F,D.value);}if(E){A.removeClass(F,D.valueWas);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.registry","mstrmojo.ListBuilder");var H=mstrmojo.hash,E=mstrmojo.registry,G=1;mstrmojo.WidgetListBuilder=mstrmojo.provide("mstrmojo.WidgetListBuilder",mstrmojo.mixin({newContext:function F(J){var K=J.itemFunction;if(!K){var I=J.itemConfig;K=I?function(M,L,N){var O=H.clone(I);O.data=M;O.parent=N;return E.ref(O);}:null;}return{itemStatus:[],itemWidgets:[],itemFunc:K};},build:function A(K,J,N,I){var L=J.itemFunc(N,I,K);if(L){J.itemStatus[I]=G;J.itemWidgets[I]=L;if(L.set){var M=K.selectedIndices;if(M&&M[I]){L.set("selected",true);}}}return L;},onadd:function C(K,I,J){if(I){mstrmojo.array.insert(I.itemWidgets,J.index,new Array(J.value.length));}this._super(K,I,J);},onremove:function D(L,J,K){if(J){var O=J.itemWidgets.splice(K.index,K.value.length),N,I;for(N=0,I=O.length;N<I;N++){var M=O[N];if(M&&M.destroy){delete M.parent;M.destroy();}}}this._super(L,J,K);},onchange:function B(S,J,P,T){if(T){var N=P.itemWidgets,L,O,I,R;for(O=0,I=T.removed,R=I&&I.length;O<R;O++){L=N[I[O]];if(L&&L.set){L.set("selected",false);}}var M,Q,K;for(M=0,Q=T.added,K=Q&&Q.length;M<K;M++){L=N[Q[M]];if(L&&L.set){L.set("selected",true);}}}}},H.copy(mstrmojo.ListBuilder)));}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.num","mstrmojo.string");mstrmojo.validation={STATUSCODE:{UNKNOWN:-1,VALID:0,INVALID:1,INVALID_EMPTY:2,INVALID_CHAR:3,INVALID_OUTOFRANGE:4,INVALID_REGEX:5,INVALID_VALIDATOR:6,INVALID_BAD_NUMERICFORMAT:7,INVALID_BAD_DATESTRING:8},TRIGGER:{NONE:0,ONBLUR:1,ONKEYUP:2,VALUESET:4,ALL:7},REGEXP:{US_ZIP:/^\d{5}([\- ]?\d{4})?$/,EMAIL_ADDRESS:/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+[\.])+([a-zA-Z0-9]{2,4})+$/,SOCIAL_SECURITY_NUMBER:/^((?!000)(?!666)\d{3})(\s|\-)?((?!00)\d{2})\2((?!0000)\d{4})$/,PHONE_NUMBER:/^(?!-)[ \d\-\(\)\.\+]+$/,FILE_NAME:new RegExp('^[^:*?"<>|/\\\\()]+$'),FOLDER_PATH_WIN:new RegExp('^([a-zA-Z]:|\\\\\\\\[^:*?"<>|/\\\\]+|[^:*?"<>|/\\\\]*)(\\\\[^:*?"<>|/\\\\]+)*(\\\\){0,1}$'),FOLDER_PATH_UNIX:new RegExp('^(/){0,1}([^:*?"<>|/\\\\]+/)*([^:*?"<>|/\\\\]+){0,1}$'),PRINTER_PATH_SINGLE:new RegExp('^[^$%:*?"<>|/\\\\]*$'),PRINTER_PATH_MULTIPLE:new RegExp('^((/|\\\\\\\\)[^$%:*?"<>|/\\\\]+)((/|\\\\)[^$%:*?"<>|/\\\\]+)*(/|\\\\){0,1}$')}};var H=mstrmojo.validation,B=H.TRIGGER,b=H.STATUSCODE,A={"-1":-1,1:1,2:1,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:4,12:4,13:4,14:6,15:6,16:6,17:3,18:3,21:2,22:2,23:3,24:4,25:3,30:5,34:5};H.VALIDATOR={DEMO:function N(e){var d=parseInt(e,10),f=mstrmojo.validation.STATUSCODE;if(d===0||d===1||d>10){return{code:f.VALID};}return{code:f.INVALID,msg:"This field must be either 0, 1 or greater than 10"};},VALIDATE_PHONENO:function I(d){var e=String(d).replace(/[^\d]/g,"");if(e.length<10){return{code:b.INVALID,msg:mstrmojo.desc(9203,"A telephone number must contain at least 10 digits.")};}if(!H.REGEXP.PHONE_NUMBER.test(d)){return{code:b.INVALID,msg:mstrmojo.desc(9204,"The telephone number contains invalid characters.")};}return{code:b.VALID};},VALIDATE_ZIPCODE:function G(d){var f="",e=this.dtp;if(!H.REGEXP.US_ZIP.test(d)){if(H.isNumeric(e)||H.isInt(e)){f=mstrmojo.desc(9208,"A zip code must be 5 digits or 5+4 digits.");}else{if(H.isString(e)){f=mstrmojo.desc(9206,"The zip code is invalid");}}return{code:b.INVALID,msg:f};}return{code:b.VALID};},VALIDATE_EMAIL:function T(d){var e=d.indexOf("@");if(e===-1){return{code:b.INVALID,msg:mstrmojo.desc(9197,"The email address is missing an at sign (@).")};}if(d.substring(e).indexOf(".")===-1){return{code:b.INVALID,msg:mstrmojo.desc(9198,"The email address is missing a period on the domain.")};}return H.REGEXP.EMAIL_ADDRESS.test(d)?{code:b.VALID}:{code:b.INVALID,msg:mstrmojo.desc(9207,"The email address is invalid.")};},VALIDATE_SSN:function Q(d){var f=this.dtp,e;if(H.isNumeric(f)||H.isInt(f)){e=String(d).replace(/[^\d]/g,"");if(e.length!==9){return{code:b.INVALID,msg:mstrmojo.desc(9209,"A Social Security Number must be 9 digits.")};}}if(!H.REGEXP.SOCIAL_SECURITY_NUMBER.test(d)){return{code:b.INVALID,msg:mstrmojo.desc(9210,"The Social Security Number is invalid.")};}return{code:b.VALID};}};H.isInt=function D(d){return A[d]===1;};H.isNumeric=function Y(d){return A[d]===2||A[d]===5;};H.isString=function J(d){return A[d]===3;};var C=window.mstrConfig,L=C.listSep,S=mstrmojo.expr,M=S.DTP,Z=mstrmojo.num,U=mstrmojo.string,F=mstrmojo.date;function P(l,m){var h=l.dtp,k=l.constraints,o=k.allowedFormatChars||"",g=(A[h]===1),d=(A[h]===2),e=(A[h]===6),n=mstrmojo.locales.number.THOUSANDSEPARATOR,f=mstrmojo.locales.number.DECIMALSEPARATOR,j;if(g){if(!l._intRegExp){o+="0-9-"+(l.isList?L:"")+n;l._intRegExp=new RegExp("[^"+o+"]");}j=l._intRegExp;}if(d){if(!l._numericRegExp){o+="0-9-"+(l.isList?L:"")+f+n;l._numericRegExp=new RegExp("[^"+o+"]");}j=l._numericRegExp;}return !!j&&j.test(m);}function c(l,n){var h=l.dtp,k=l.constraints,g=(A[h]===1),d=(A[h]===2),e=(A[h]===6),f=k.min,m=k.max,j;if(f===undefined&&m===undefined){return false;}if(g||d){return Z.inNumericRange(n,f,m)!==0;}if(e){return F.inDateTimeRange(n,f,m)!==0;}return false;}function K(e,d){return !Z.isNumeric(d);}function R(g,e){var f=(g.dtp===M.DATE),d=(g.dtp===M.TIME);return(f?!F.isDate(e):(d?!F.isTime(e):!F.isDateAndOrTime(e)));}mstrmojo._CanValidate=mstrmojo.provide("mstrmojo._CanValidate",{constraints:null,required:false,dtp:M.INTEGER,isList:false,autoFormat:false,validationStatus:null,init:function W(d){this._super(d);if(!this.constraints){this.constraints={};}var e=this.constraints;if(!e.hasOwnProperty("trigger")){e.trigger=B.NONE;}},_set_value:function(j,f){var g=this.value,e=(g!==f);if(e){this.value=f;var h=this.constraints.trigger,d=(h&B.VALUESET)>0;if(d){this.validate(f);}}return e;},validate:function O(){var f=(this.value!==null&&this.value!==undefined)?this.value:"",j=this.isList?f.split(L):[f],h,e,k,d=j.length,g;for(g=0;g<d;g++){h=this.doValidation(j[g]);e=(h.code>b.VALID);if(e){if(d>1){h.msg=mstrmojo.locales.validation.invalidValueInListError.replace("#",j[g]||" ");}break;}}k=e?"onInvalid":"onValid";if(!e&&this.autoFormat){this.format();}this.set("validationStatus",h);if(this[k]){this[k](h);}},format:function X(){var j=this.dtp,f=(A[j]===6);if(!f){return ;}var l=mstrConfig.listSep,o=this.value||"",e=this.isList?o.split(l):[o],n=j===14,m=[],d,g=mstrmojo.locales.datetime,k=e.length,h;for(h=0;h<k;h++){o=e[h];d=F.parseDateAndOrTime(o);if(d){if(n&&d.date){m.push(F.formatDateInfo(d.date,g.DATEOUTPUTFORMAT));}else{m.push((d.date?F.formatDateInfo(d.date,g.DATEOUTPUTFORMAT):"")+" "+(d.time?F.formatTimeInfo(d.time,g.TIMEOUTPUTFORMAT):""));}}}this.set("value",m.join(l));},isValid:function V(){var d=this.validationStatus;if(!d){this.validate();}return this.validationStatus.code===b.VALID;},clearValidation:function a(){this.set("validationStatus",{code:b.VALID});if(this.onClearValidation){this.onClearValidation();}},doValidation:function E(q){var n=this.constraints,o=n.regExp,f=n.validator,d={id:this.id,code:b.VALID,msg:""},m=this.dtp,l=(A[m]===1),e=(A[m]===2||A[m]===5),g=(A[m]===3),h=(A[m]===6),k=U.isEmpty(q),p=String(q).length,j="",u=mstrmojo.locales.validation;if(this.required&&k){d.code=b.INVALID_EMPTY;d.msg=u.requiredFieldError;return d;}q=U.trim(q);if(!k&&P(this,q)){if(l){j=u.integerDataType;}if(e){j=u.numericDataType;}if(h){j=u.dateDataType;}d.code=b.INVALID_CHAR;d.msg=u.invalidCharError.replace("#",j);return d;}if(!k&&h&&R(this,q)){d.code=b.INVALID_BAD_DATESTRING;d.msg=u.invalidDateStringError;return d;}if(!k&&(e||l)&&K(this,q)){d.code=b.INVALID_BAD_NUMERICFORMAT;d.msg=u.invalidNumericFormatError;return d;}if(!k&&(l||e||h)&&c(this,q)){d.code=b.INVALID_OUTOFRANGE;if(n.min!==null&&n.max!==null){j=u.outofRangeError.replace("# ","").replace("##",n.min).replace("###",n.max);}else{if(n.min!==null){j=u.noLessMinError.replace("##",n.min).replace("# ","");}else{if(n.max!==null){j=u.noGreaterMaxError.replace("###",n.max).replace("# ","");}}}d.msg=j;return d;}if(g&&n.minLen!==null&&n.maxLen!==null){if(p<n.minLen||p>n.maxLen){d.code=b.INVALID;d.msg=mstrmojo.desc(9211).replace(/#/,n.minLen).replace(/##/,n.maxLen);return d;}}if(o&&!o.test(q)){d.code=b.INVALID_REGEX;d.msg=mstrmojo.desc(9205);return d;}var t=f&&f.apply(this,[q]);if(t){d.code=t.code;d.msg=t.msg;return d;}return d;}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.expr");var C=mstrmojo.string,B=mstrmojo.expr,A=B.ET;mstrmojo.fe.FilterUtils=mstrmojo.provide("mstrmojo.fe.FilterUtils",{getExprXml:function(J){var E="<exp>",D="</exp>",H={a:true,a2:true,a3:true,agg:true,cc:true,ce:true,cgp:true,cs:true,conid:true,desc:true,did:true,attId:true,dmt:true,dmy:true,dtp:true,es:true,et:true,expr:true,f:true,flat:true,flt:true,fm:true,fm2:true,fm3:true,fn:true,fnt:true,fres:true,gb:true,isp:true,items:true,m:true,m2:true,m3:true,n:true,nds:true,not:true,pf:true,p:true,r:true,rps:true,st:true,t:true,utgt:true,utp:true,uts:true,v:true,xml:true,relation:true,applySubExpr:true,useSchema:true,guide:true,rsTp:true,joTp:true,paTp:true,erTp:true,exp:true,joAttrs:true,ph:true,idx:true,idc:true,idcsi:true,ucfg:true},G={getArrItemName:function(K){return K.substr(0,K.length-1);},isSerializable:function(U,S,R){if(U==="xml"){var M=S[R].xml;return{att:'hasXML = "-1"',child:M};}else{if(mstrmojo.array.indexOf(["header_format","grid_format","child_header_format","child_grid_format"],U)>-1){var V=S[R][U];if(!V){return{};}var O="<"+U+">";for(var T in V){O+="<prs n='"+T+"'>";var N=V[T];for(var K in N){var Q=N[K];O+="<pr n='"+K+"' v='"+(Q==="pru"?"":Q)+"'";O+=Q==="pru"?' pru="1"':"";O+="/>";}O+="</prs>";}O+="</"+U+">";return{child:O};}else{if(U==="cs"){var L=S[R],P=S[R][U];if(L&&L.fnt&&L.fnt==B.FNT.PER&&P){if(P[0]){P[0].v+="%";}if(P[1]){P[1].v+="%";}}return true;}}}return(H[U])?true:false;},skipNull:true},F=J;if(!F||F.et!=A.ANDOR){F={et:A.ANDOR,fn:B.FN.AND,nds:F?[F]:[]};}var I=C.json2xml("nd",[{},F],G);return E+I+D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.WidgetListBuilder");mstrmojo.WidgetTreeBuilder=mstrmojo.provide("mstrmojo.WidgetTreeBuilder",mstrmojo.mixin({newContext:function A(B){var D=this._super(B);if(!B.itemFunction&&D.itemFunc){var C=D.itemFunc;D.itemFunc=function(G,F,H){var E=C(G,F,H);if(E){E.tree=H.tree||H;}return E;};}return D;}},mstrmojo.hash.copy(mstrmojo.WidgetListBuilder)));})();(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var D=1,B="mstrmojo-itemwrap";mstrmojo.ListMapperHoriz=mstrmojo.provide("mstrmojo.ListMapperHoriz",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table" cellspacing="0" cellpadding="0"><tbody><tr>',markupSuffix:"</tr></tbody></table>",itemWrapperPrefix:function(H){return'<td class="'+this.getWrapperCss(H)+'">';},getWrapperCss:function(H){return"mstrmojo-itemwrap-td";},itemWrapperPrefill:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",itemWrapperSuffix:"</td>",wrapperNodes:function G(H){return this.wrapperParentNode(H).cells;},wrapperParentNode:function F(H){return H.firstChild.rows[0];},createWrapperNode:function E(H){var I=H.ownerDocument,J=I.createElement("td");return J;},findScrollRange:function C(U,L,S,X,I,P,Y,W){var Q=this.wrapperNodes(U),R=parseInt(L/2,10),K=parseInt(Math.log(L)/Math.log(2),10),J=0,H=L-1,T=I+P,M=Q[0].offsetLeft,O;for(var V=1;V<=K;V++){O=Q[R].offsetLeft-M+Y;if(O<=I){J=R;}else{if(O>=T){H=R;}}var N=Math.round(L/Math.pow(2,V+1));R+=(O>I)?-N:N;R=Math.min(Math.max(0,R),L-1);}return{start:J,end:H};},findIndex:function A(I,M,K){if(M&&K){var H=I.domNode,L=this.wrapperParentNode(M),J=K.parentNode;while(J){if(J===L){return mstrmojo.array.findBin(this.wrapperNodes(M),K,"offsetLeft",I.items&&I.items.length);}else{if(J===H){break;}}K=J;J=K.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));})();(function(){mstrmojo.requiresCls("mstrmojo.Obj");var I=mstrmojo.array,E=mstrmojo.hash,N=mstrmojo.func.wrapMethods;function M(T){var R=[],O=mstrApp.getRootController().model.dbObjectsDisplayOptions,P=mstrApp.getRootController().model.dbObjectsConnectionType,S=this,Q=this.dbmsTypeFilter;I.forEach(T,function(U){if((U.disp&O)===O&&(Q.length===0||I.indexOf(Q,U.dbType)>-1)){if((U.connType&4)===4){R.push(U);}else{if((U.connType&P)===P){R.push(U);}}}});if(!S.dbVersion2dbId){S.dbVersion2dbId={};I.forEach(R,function(U){I.forEach(U.dbVersions,function(V){S.dbVersion2dbId[V.v]=U.id;});});}this.dsnMapDBs=T;this.supportedDBs=R;}function C(){var O=this;E.forEach(O.dbTypes,function(P){if(P.catSQL===1){O.catalogDbTypes.push(P);}});}function B(O){O=O.sort(function(Q,P){return Q.n.toLowerCase().localeCompare(P.n.toLowerCase());});O.unshift({n:mstrmojo.desc(8526,"select a dsn"),nU:mstrmojo.desc(8526,"select a dsn").toUpperCase(),des:0});return O;}function F(O){O=O.sort(function(Q,P){return Q.n.toLowerCase().localeCompare(P.n.toLowerCase());});return O;}function A(R){if(!(R.DBInfo&&R.DBInfo.Preferences)){return R;}var P,Q=JSON.stringify(R),S,O=R.DBInfo.Preferences.driverNameSuffix;if(mstrApp.isSingleTier){if(navigator.platform.indexOf("Win")===-1){P=I.find(O,"n","DesktopMac");}else{P=I.find(O,"n","DesktopWin");}}else{P=I.find(O,"n","Platform");}S=O[P];return JSON.parse(Q.replace(/!#DRIVERSUFFIX#!/g,S.value));}function L(P){var O=this;if(O.loaded){P.success();}else{if(this.dbmsTypeFilter.length>0){this.dbmsTypeFilter.push(1100);}mstrApp.getRootController().model.submitRequest(N({success:function(R){R=A(R);var Q=(R.DBMS.dbmss.dbms?[].concat(R.DBMS.dbmss.dbms):[]);O.dbms=Q;O.dbms.sort(function(T,S){var V=T.db_ver;var U=S.db_ver;if(V<U){return 1;}if(V>U){return -1;}return 0;});O.dsndbms=Q.sort(function(T,S){return T.n.toLowerCase().localeCompare(S.n.toLowerCase());});M.call(O,R.DBInfo.DBS);O.dbVersions=R.DBInfo.dbVersions;O.dbTypes=R.DBInfo.dbTypes;C.call(O);O.dbIDs=R.DBInfo.dbIDs;O.drivers=F(R.Drivers.Drivers);O.preferences=R.DBInfo.Preferences;O.dsns=B(R.DSNs.Dsns);O.loaded=true;}},P),{taskId:"arch.getDBObjects",skipSchemaIDCheck:true,showWait:true,typeFilter:this.dbmsTypeFilter,versionFilter:this.dbmsVersionFilter,typeExcludeFilter:O.dbmsTypeExcludeFilter.join(","),versionExcludeFilter:O.dbmsVersionExcludeFilter.join(","),flags:15});}}function D(O,Q){var P=this;mstrApp.getRootController().model.submitRequest(N({success:function(R){R=A(R);if(R.DBInfo){M.call(P,R.DBInfo.DBS);P.dbVersions=R.DBInfo.dbVersions;P.dbTypes=R.DBInfo.dbTypes;C.call(P);P.dbIDs=R.DBInfo.dbIDs;P.preferences=R.DBInfo.Preferences;}if(R.Drivers){P.drivers=F(R.Drivers.Drivers);}if(R.DSNs){P.dsns=B(R.DSNs.Dsns);}}},Q),{taskId:"arch.getDBObjects",skipSchemaIDCheck:true,showWait:true,flags:O});}mstrmojo.warehouse.obj.DBObjects=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.obj.DBObjects",dbms:[],dsndbms:[],supportedDBs:[],dsnMapDBs:[],drivers:[],dsns:[],dbVersions:undefined,dbTypes:undefined,catalogDbTypes:[],dbIDs:undefined,preferences:undefined,dbmsTypeFilter:[],dbmsVersionFilter:[],dbmsTypeExcludeFilter:[],dbmsVersionExcludeFilter:[],DBInfo:undefined,DBS:undefined,DSNs:undefined,Dsns:undefined,Preferences:undefined,Drivers:undefined,DBMS:undefined,dbmss:undefined,disp:undefined,dbVersion2dbId:undefined,load:function K(P,O,Q){this.dbmsTypeFilter=P;this.dbmsVersionFilter=O;L.call(this,Q);},populateDBProperties:function J(O){if(this.supportedDBs.length>0){O.success();}else{D.call(this,8,O);}},reloadDrivers:function G(O){D.call(this,2,O);},reloadDSNs:function H(O){D.call(this,4,O);},loaded:false});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Obj","mstrmojo.string","mstrmojo.hash","mstrmojo.expr","mstrmojo.mstr.EnumNodeDimty");var D=mstrmojo.array,P=mstrmojo.expr,J=P.ET,I=P.TP,K=mstrmojo.mstr.EnumNodeDimty,N=P.ET2TGT,M=P.ET2COND,B=mstrmojo.meta.TP;function O(S,A){var R=(A&&A.did)?A.did.split(P.FN_SEP):null,E=R&&parseInt(R[0],10),Q=R&&parseInt(R[1],10),T=S.et;S.fnt=E;S.fn=Q;if(T!=J.AE&&P.fn_List(Q,E)){S.et=J.AL;S.a2=null;S.cs=null;}else{if(T==J.AL&&!P.fn_List(Q,E)){S.et=J.AQ;S.cs=null;}else{if(T==J.MC&&!P.fn_AC_MC(Q,E)){S.et=J.MQ;S.m2=null;}else{if(T==J.AC&&!P.fn_AC_MC(Q,E)){S.et=J.AQ;S.a2=null;}}}}switch(Q){case P.FN.IS_NULL:case P.FN.IS_NOT_NULL:S.a2=null;S.a3=null;S.fm2=null;S.fm3=null;S.m2=null;S.m3=null;S.cs=null;break;case P.FN.BETWEEN:case P.FN.NOT_BETWEEN:break;default:S.a3=null;S.fm3=null;S.m3=null;while(S.cs&&S.cs.length>1){S.cs.pop();}}}function F(W,X,Y){var E=true,A=2+X;switch(Y.t){case I.PROMPT:var U=W.cs,V;if(!U){U=[];W.cs=U;}U[X]={};V=U[X];V.p=Y;W["a"+A]=null;W["m"+A]=null;switch(W.et){case J.AC:W.et=J.AQ;break;case J.MC:W.et=J.MQ;break;}break;case I.METRIC:W["a"+A]=null;W.cs=null;W.et=J.MC;W["m"+A]=Y;break;case I.ATTR:W["m"+A]=null;W.cs=null;W.et=J.AC;W["a"+A]=Y;W["fm"+A]=null;break;default:W["a"+A]=null;W["m"+A]=null;var U=W.cs;if(!U){U=[];W.cs=U;}if("did" in Y){W["a"+A]=null;W["fm"+A]=null;W["m"+A]=null;if(U[X]&&U[X].p){U[X].p=null;}}else{if(Y&&Y.v!=null){U[X]=Y;}else{if(U[X]){U=U.splice(X,1);}}E=false;}if(!Y.skipET){switch(W.et){case J.MC:W.et=J.MQ;break;case J.AC:W.et=J.AQ;break;case J.AL:if(!("did" in Y)&&Y.v){var Q,S=Y.dtp,U=[];Q=Y.v.split(mstrConfig.listSep);for(var R=0,T=Q.length;R<T;R++){U.push({v:mstrmojo.string.trim(Q[R]),dtp:S});}W.cs=U;}break;}}}return E;}var H={};H[J.AQ]={target:1,fm:1,fn:1,cs:1};H[J.AL]={target:1,fm:1,fn:1,cs:1};H[J.AE]={target:1,fn:1,es:1};H[J.AC]={target:1,a2:1,a3:1,fm:1,fm2:1,fm3:1,fn:1};H[J.MQ]={target:1,fn:1,cs:1,dmy:1};H[J.MC]={target:1,fn:1,m2:1,m3:1,dmy:1};H[J.F]={target:1};H[J.R]=H[J.F];H[J.XML]={target:1};var G=function(A){return A!==null&&A!==undefined;};var L=function(W){if(!W||!G(W.et)){return false;}var V=true,A=H[W.et],T=W.cs,S;V=V&&(!A.target||W[N[W.et]]);V=V&&(!A.fm||W.fm);V=V&&(!A.fn||G(W.fn));var R=P.fnCstCount(W.fn,W.fnt);if(V&&A.cs){for(S=0;S<R;S++){V=V&&T&&G(T[S]);}}if(V){var U=[N[W.et],"fm"];for(var E=0;E<2;E++){for(S=0;S<R;S++){var X=U[E]+(2+S);V=V&&(!A[X]||W[X]);}}}V=V&&(!A.es||W.es&&(W.es.length>0));var Q=W.dimtyTypes;V=V&&(!A.dmy||Q[K.NodeDimtyUnspecified]||Q[K.NodeDimtyNone]||(Q[K.NodeDimtyOutputLevel]&&W.dmy&&W.dmy.uts&&(W.dmy.uts.length>0)));return V;};mstrmojo.ConditionModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ConditionModel",completed:false,init:function(A){if(this._super){this._super(A);}this._updateCompleted();},edit:function(l,Y){var S=this[l],k=true;this.etWas=this.et;switch(l){case"not":Y=!!(Y&&Y.did===P.FN.NOT);S=!!this.not;if(Y===S){return ;}this.not=!!Y||null;break;case"target":var AC=this.et;if(Y){switch(Y[B]){case I.ATTR:case I.CONS:S=this.a;if(AC!==J.AQ&&AC!==J.AE){this.et=J.AQ;this.m=null;this.m2=null;this.m3=null;this.r=null;this.f=null;}if(AC!==J.AE){this.fn=null;this.fnt=null;}this.fm=null;this.fm2=null;this.fm3=null;this.cs=null;break;case I.METRIC:S=this.m;if((AC!==J.MQ)&&(AC!==J.MC)){this.et=J.MQ;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.r=null;this.f=null;this.cs=null;this.dmt=K.NodeDimtyUnspecified;}this.m2=null;break;case I.REPORT:S=this.r;if(AC!==J.R){this.et=J.R;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.f=null;}break;case I.FILTER:S=this.f;if(AC!==J.F){this.et=J.F;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.r=null;}break;case I.PROMPT:S=this.prms&&this.prms[0];if(AC!==J.XML){this.et=J.XML;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.r=null;this.f=null;}break;}}this.es=null;this[N[this.et]]=Y;break;case"fm":if(Y&&Y[B]==="fn"){this.et=J.AE;this.fm=null;O(this,Y);}else{this.fm=Y;if(Y&&(this.et==J.AE)){this.et=J.AQ;}this.fnt=null;this.fn=null;this.cs=null;this.a2=null;this.fm2=null;}break;case"fm2":case"fm3":this[l]=Y;break;case"fn":O(this,Y);break;case"es":var AF=this.es;if(Y&&Y.removed&&AF){D.removeItems(AF,Y.itemIdField,Y.removed);}if(Y&&Y.added){if(!AF){AF=Y.added.concat();this.es=AF;}else{D.insert(AF,AF.length,Y.added);}}break;case"c0":k=F(this,0,Y);break;case"c1":k=F(this,1,Y);break;case"dmy":var z=this.dmy;if(!z){z={cc:true,fres:true,uts:[]};this.dmy=z;}var t=z&&z.uts;if(!t){t=[];z.uts=t;this.dmt=K.NodeDimtyOutputLevel;}var Q={};Q[P.TP.ATTR]=true;Q[P.TP.DIM]=true;if(Y&&Y.removed){var f=[],A=false,W=[],R=false;for(var j=0,T=Y.removed,E=T.length;j<E;j++){var V=T[j],AB=V[B] in Q;if(AB){R=true;}else{A=true;}var h=AB?W:f;h.push(V);}if(A){D.removeItems(t,"did",f);}if(R){var AE={};for(var d=0,Z=t&&t.length;d<Z;d++){var X=t[d];if(X&&X.utgt){AE[X.utgt.did]=d;}}var U=[];for(var AA=0,x=W.length;AA<x;AA++){var g=AE[W[AA].did];if(g>-1){U.push(g);}}U.sort(D.numSorter);for(var q=U.length-1;q>-1;q--){t.splice(U[q],1);}}}if(Y&&Y.added){var AG=[],m=P.DMY_TP.DIM,p=P.DMY_TP.ATTR;for(var AD=0,w=Y.added,e=w.length;AD<e;AD++){var o=w[AD];AG.push((o[B] in Q)?{utgt:o,utp:o[B]===I.DIM?m:p,agg:1,flt:2,gb:true,rps:0,n:o.n}:o);}D.insert(t,t.length,AG);}break;}this._updateCompleted();if(k){this.raiseEvent({name:"edit",prop:l,value:Y,valueWas:S});}},get:function C(){var A=M[this.et]||[];A.push("et");return mstrmojo.hash.copyProps(A,this);},_updateCompleted:function(){this.set("completed",L(this));}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");mstrmojo.requiresDescs(889);var C=mstrmojo.hash;var H=mstrmojo.desc(889,"Please wait...");function E(R,Q){var O=Q.showWait,P=Q.suppressError,N=Q.waitMsg;delete Q.showWait;delete Q.suppressError;delete Q.waitMsg;mstrApp.serverRequest(Q,R,O,P,N);}mstrmojo.qb.mdx.DataService=mstrmojo.provide("mstrmojo.qb.mdx.DataService",{submitRequest:function B(O,N){E.call(this,O,N);},pollingStatus:function M(S,N,Q){var P=this;if(mstrApp.isSingleTier){if(S.success){S.success(N);}return ;}E.call(P,{success:function R(T){if(T.status==="1"){if(S.success){S.success(N);}}else{P.pollingStatus(S,N,Q);}},failure:function O(T){if(S.failure){S.failure(T);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:Q});},addCubes:function D(Q,P){var N=this;E.call(this,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"qBuilder.AddMDXCubes",showWait:true,waitMsg:H}));},updateCubes:function K(Q,P){var N=this;E.call(this,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"qBuilder.UpdateMDXCubes",showWait:true,waitMsg:H}));},setDBRole:function F(Q,P){var N=this;E.call(this,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"qBuilder.SetDBRole",showWait:true,waitMsg:H}));},search:function L(O,N){E.call(this,O,C.copy(N,{taskId:"arch.search",showWait:true}));},searchFolderContents:function J(O,N){E.call(this,O,C.copy(N,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:H});},createEmmaTable:function A(Q,P){var N=this;E.call(N,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"DICreateEMMASourceTable",showWait:true,waitMsg:H}));},createEmmaInstance:function G(Q,P){var N=this;E.call(N,{success:function O(R){mstrApp.msgid=R.msgid;N.pollingStatus(Q,R,H);}},C.copy(P,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:H}));},getObjectFolder:function I(O,N){E.call(this,O,C.copy(N,{taskId:"DIGetObjectFolder",showWait:true,waitMsg:H}));}});}());(function(){var D=mstrmojo.DI.DIConstants;mstrmojo.DI.OAuthSource=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.OAuthSource",type:-1,clientID:"",state:"",accessToken:"",refreshToken:"",revokeUrl:"",locale:"",reports:null,userDisplayName:null,userEmail:null,reset:function(){this.accessToken="";this.refreshToken="";this.reports=null;this.userDisplayName=null;this.instanceUrl=null;this.sourceAccountID=null;this.said=null;this.locale="";this.idUrl=null;this.signature=null;this.userEmail=null;},populate:function G(I){if(I.id){this.idUrl=I.id;}if(I.instance_url){this.instanceUrl=I.instance_url;}if(I.signature){this.signature=I.signature;}if(I.refresh_token){this.refreshToken=I.refresh_token;}if(I.access_token){this.accessToken=I.access_token;}if(I.display_name){this.userDisplayName=I.display_name;}if(I.name){this.userDisplayName=I.name;}if(I.id){this.sourceAccountID=I.id;}if(I.uid){this.sourceAccountID=I.uid;}if(I.locale){this.locale=I.locale;}},populateReports:function C(I,L){this.reports=I;var J;if(I.mi.sinf){var K=I.mi.sinf.stkn;if(K){for(J=0;J<K.length;J++){if(K[J].n=="SESSION_ID"){this.accessToken=K[J].v;}if(K[J].n=="SERVER_URL"){this.instanceUrl=K[J].v;}if(K[J].n=="REFRESH_TOKEN"){this.refreshToken=K[J].v;}if(K[J].n==="INSTANCE_URL"){this.instanceUrl=K[J].v;}}}this.set("userDisplayName",I.mi.sinf.un);this.set("userEmail",I.mi.sinf.ea||"");this.said=I.mi.sinf.said;this.sourceAccountID=I.mi.sinf.said;if(I.mi.sinf.said.indexOf("#said:")===0){this.said=I.mi.sinf.said.substr(6);this.sourceAccountID=I.mi.sinf.said.substr(6);}this.locale=I.mi.sinf.lcldn||"";if(I.mi.sinf.picurl){this.picurl=I.mi.sinf.picurl;}}this.raiseEvent({name:"oAuthReportsFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id,isRefresh:L});},getSourceParams:function E(){var I={accessToken:this.accessToken,clientID:this.clientID,clientSecret:this.clientSecret||"",instanceURL:(this.instanceUrl===null||this.instanceUrl==="")?"test":this.instanceUrl,userDisplayName:this.userDisplayName,locale:this.locale===""?"en_US":this.locale};if(this.refreshToken){I.refreshToken=this.refreshToken;}I.dbRoleID=this.dbRoleID;if(this.sourceAccountID){I.sourceAccountID=this.sourceAccountID;}return I;},getSourceInfoParam:function F(I){var J={dbRoleID:this.dbRoleID,locale:this.locale===""?"en_US":this.locale};if(this.userDisplayName){J.userDisplayName=this.userDisplayName;}if(I&&this.sourceAccountID){J.sourceAccountID=this.sourceAccountID;}return J;},parseOAuthSourceFolder:function A(O){var P=[],S;var K=this.isArray(O.mi.ftree.fd)?O.mi.ftree.fd:this.makeArray(O.mi.ftree.fd);var N=this.isArray(O.mi.ftree.fl)?O.mi.ftree.fl:this.makeArray(O.mi.ftree.fl);var I,T,L,J,U,R,M,Q;for(L=0;L<K.length;L++){I=K[L];U={isFolder:true};U.n=I.n.toString();U.desc=I.des;U.address=I.address;U.type=0;M=this.isArray(I.fl)?I.fl:this.makeArray(I.fl);S=[];for(J=0;J<M.length;J++){Q=M[J];R={isFolder:false};R.address=Q.address;R.desc=Q.des;R.type=Q.minetype;R.n=Q.n.toString();R.folderPath=U.n;S.push(R);}if(S.length>0){U.cItem=S;}P.push(U);}for(L=0;L<N.length;L++){T=N[L];U={isFolder:false};U.n=T.n.toString();U.address=T.address;U.type=T.mimetype;U.desc=T.des;if(typeof T.FileSize==="number"){U.size=T.FileSize;}P.push(U);}return P;},isArray:function B(I){return(Object.prototype.toString.call(I)==="[object Array]");},makeArray:function H(){var J=[];var I;for(I=0;I<arguments.length;I++){if(arguments[I]!==undefined){J.push(arguments[I]);}}return J;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.EnumColumnDataTypes","mstrmojo.warehouse.EnumObjectTypes");var F=mstrmojo.string,C=mstrmojo.warehouse.EnumObjectTypes.COLUMN,A=mstrmojo.desc(11428,"[unknown]");function E(H){var G=mstrmojo.architect.EnumColumnDataTypes;return("["+G[H].n+"]"||A);}mstrmojo.architect.obj.Column=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Column",init:function D(G){this._super(G);var I,H;if(G){if(G.dbInfo){I=G.dbInfo;this.cln=F.decodeHtmlString(I.cln).replace(/&apos;/g,"'");this.cmid=I.cmid;this.sta=parseInt(I.sta,10);this.dt={tp:I.dt.tp,ps:I.dt.prec,sc:I.dt.scl};this.n=this.cln+": "+this.getDataTypeName();}else{if(G.tableInfo){I=G.tableInfo;H=I.def;this.cln=F.decodeHtmlString(H.cln).replace(/&apos;/g,"'");this.cmid=I.did;this.dt={tp:H.dt.tp,ps:H.dt.ps,sc:H.dt.sc};this.n=this.cln;}else{if(G.colDef){H=G.colDef;this.cln=F.decodeHtmlString(H.cln).replace(/&apos;/g,"'");this.cmid="";this.dt={tp:H.dt.tp,ps:H.dt.ps,sc:H.dt.sc};this.n=this.cln;}}}}},cln:undefined,n:undefined,tp:C,t:C,cmid:undefined,def:undefined,dt:undefined,getDataTypeName:function B(){return E(this.dt.tp);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B={TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};mstrmojo.ui.PopupConfig=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ui.PopupConfig",ENUM_CORNERS:B,isHostedWithin:true,position:null,hostProxyCssClass:"",hostId:"",hostElement:null,anchorElement:null,popupHandlers:null,alignment:null,alignWithAnchor:false,useTooltip:false,init:function E(F){this.clear();this._super(F);},setAlignment:function C(F,G){this.alignment={host:F,popup:G};},addPopupHandlers:function D(F,H,G){this.popupHandlers[F]={open:H,close:G};},clear:function A(){this.popupHandlers={};var F=this.ENUM_CORNERS;this.alignment={host:F.BOTTOM_LEFT,popup:F.TOP_LEFT};}});mstrmojo.ui.PopupConfig.ENUM_CORNERS=B;}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._LoadsScript","mstrmojo.Binding","mstrmojo._HasBindings","mstrmojo._HasMarkup","mstrmojo._HasTooltip","mstrmojo.css");mstrmojo.Widget=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._LoadsScript,mstrmojo._HasBindings,mstrmojo._HasMarkup,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.Widget",domNode:null,hasRendered:false,visible:true,enabled:true,tooltip:"",cssClass:"",cssText:"",cssDisplay:"block",slot:"",alias:"",parent:null,init:function A(C){this._super(C);var D=this.parent;if(!D||D.hasInitBindings){this.initBindings();}},destroy:function B(C){if(this.hasRendered){this.unrender(C);}if(this.bindings){this.destroyBindings();}this._super();},invalidate:mstrmojo.emptyFn,widgetResized:mstrmojo.emptyFn});mstrmojo.Widget.cssTextMarkupMethod=function(){this.domNode.style.cssText=this.cssText||"";};mstrmojo.Widget.visibleMarkupMethod=function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";};mstrmojo.Widget.topMarkupMethod=function(){var C=this.top;if(C){this.domNode.style.top=C;}};mstrmojo.Widget.leftMarkupMethod=function(){var C=this.left;if(C){this.domNode.style.left=C;}};mstrmojo.Widget.heightMarkupMethod=function(){var C=this.height;if(C){this.domNode.style.height=C;}this.widgetResized();};mstrmojo.Widget.widthMarkupMethod=function(){var C=this.width;if(C){this.domNode.style.width=C;}this.widgetResized();};mstrmojo.Widget.enabledMarkupMethod=function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.hash");mstrmojo.requiresDescs(198,5720,10399,10492,11960,12676,12677,12678,12955,12957,12958,12960,12961,12962,12963,12964,12965,12966,12967,12968,13096,13097,14193);var Aa=mstrmojo.hash;var Z=mstrmojo.DI.DIConstants.sourcesInfoFlags;var Ad=mstrmojo.desc(12676,"Fetching files...");var AR=mstrmojo.desc(12677,"Fetching Cube Information...");var AU=mstrmojo.desc(5720,"Waiting...");var M=mstrmojo.desc(10492,"Saving...");var p=mstrmojo.desc(14193,"Searching Data...");function AP(Au,At,As){mstrApp.serverRequest(At,Au,As);}mstrmojo.DI.DIDataService=mstrmojo.declare(mstrmojo.Obj,null,{messageID:"",emmaIRRMessageID:"",deleteObject:function Q(At,As){AP.call(this,At,Aa.copy(As,{taskId:"deleteObject"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(10399,"Deleting")});},renameObject:function Q(At,As){AP.call(this,At,Aa.copy(As,{taskId:"renameObject"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(13973,"Renaming")});},getCubeQuota:function L(Au,At,As){AP.call(this,Au,Aa.copy(At,{taskId:"qBuilder.GetQuota"}),As||{showProgress:false,showProgressText:false,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});},getUserDICubeInfo:function W(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getUserDICubeInfo"}),{showProgress:false,showProgressText:false});},getDBMSObjects:function U(At,As){AP.call(this,At,Aa.copy(As,{taskId:"arch.getDBObjects"}),{doNotHold:true,showProgress:false});},getExternalSourcesInfo:function Ae(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getDIExternalInfo"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});},getDIProjectSettings:function k(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getDIProjectSettings"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12957,"Fetching Data Import Settings...")});},getOAuthSourceReports:function Aj(Au,At){var As=Z.getReports|Z.getTokensInfo|Z.getUserName;AP.call(this,Au,Aa.copy(At,{taskId:"qBuilder.FetchSourceObjects",flags:As|(At.flags||As)}),{showProgress:true,showProgressText:true,progressText:Ad});},getHadoopFolderSize:function AL(Au,At){var As=Z.getReports|Z.getTokensInfo|Z.getUserName;AP.call(this,Au,Aa.copy(At,{taskId:"qBuilder.FetchSourceObjects",flags:As|(At.flags||As)}),{showProgress:false,showProgressText:false});},browseURLPath:function AA(Av,Au){var At=1,As;if(Au.flags){As=Au.flags|At;}else{As=At;}AP.call(this,Av,Aa.copy(Au,{taskId:"qBuilder.FetchSourceObjects",flags:As}),{showProgress:true,showProgressText:true,progressText:Ad});},getShapeKeys:function Al(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getMapShapes",showWait:false}),{doNotHold:true,showProgress:false});},getWebServiceURL:function K(At,As){AP.call(this,At,Aa.copy(As,{taskId:"GetWebServiceURL"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12678,"Fetching Web Service URL for authorization...")});},getWebServiceCatalog:function X(At,As){AP.call(this,At,Aa.copy(As,{taskId:"GetWebServiceCatalog"}),{showProgress:true,showProgressText:true,progressText:Ad});},signOutOAuthSource:function g(At,As){AP.call(this,At,Aa.copy(As,{taskId:"qBuilder.FetchSourceObjects",flags:Z.revokeSession}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12960,"Signing out...")});},importOAuthReport:function B(At,As){AP.call(this,At,Aa.copy(As,{taskId:"qBuilder.ImportSourceObject",flags:7}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12961,"Uploading data...")});},importURL:function AH(At,As){AP.call(this,At,Aa.copy(As,{taskId:"importFile",taskContentType:"json",taskEnv:"xhr",messageid:this.messageID}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12962,"Fetching data from the given URL...")});},importFile:function z(As,Au,At){As.submit(Aa.copy(At,{taskId:"importFile",taskContentType:"json",taskEnv:"xhr",fileType:"application/octet-stream"}),Au,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12963,"Uploading File...")});},oneTierImportFile:function S(At,As){AP.call(this,At,Aa.copy(As,{taskId:"importFile"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12963,"Uploading File...")});},launchOneTierBrowser:function Ab(As){window.FormWrapper.openFileDialog(As);},launchOneTierUploader:function R(At,As){AP.call(this,At,Aa.copy(As,{taskId:"onetier.import"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(11960,"Loading Data...")});},createOneTierDoc:function AX(At,As){AP.call(this,At,Aa.copy(As,{taskId:"onetier.createVI"}),{showProgress:true,showProgressText:true,progressText:AU});},handleMissingColumns:function AZ(At,As){AP.call(this,At,Aa.copy(As,{taskId:"recoverDataDiscoveryErrors",msgid:this.messageID}),{showProgress:true,showProgressText:false,progressText:""});},getImportedData:function Y(Av,Au,As){var At;if(!Au.browsetype){Au.browsetype=mstrmojo.DI.DIConstants.browseFlag.dataPreview|mstrmojo.DI.DIConstants.browseFlag.reportBindingTable|mstrmojo.DI.DIConstants.browseFlag.reportLevelProperty;}if(Au.previewflag){Au.previewflag|=mstrmojo.DI.DIConstants.requestFlag.stateInfo;}if(!Au.bindingflag){At=2;}else{At=Au.bindingflag;}AP.call(this,Av,Aa.copy(Au,{taskId:"qBuilder.GetReportXDADefinition",msgid:this.messageID,bindingflag:At}),As||{showProgress:true,showProgressText:true,progressText:AR});},editImportedData:function e(At,As){AP.call(this,At,Aa.copy(As,{taskId:"editCube",msgID:this.messageID}),{showProgress:true,showProgressText:true,progressText:(As.trans?mstrmojo.desc(12964,"Transforming data..."):AR)});},loadProject:function Ar(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getProjects"}),At,{showProgress:true,showProgressText:true,progressText:(mstrmojo.desc(12965,"Fetching Projects Information..."))});},loginProject:function Ar(At,As){AP.call(this,At,Aa.copy(As,{taskId:"login"}),At,{showProgress:true,showProgressText:true,progressText:(mstrmojo.desc(12966,"Login Projects..."))});},changeMappings:function Am(At,As){AP.call(this,At,Aa.copy(As,{taskId:"qBuilder.RemapObject",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:M});},saveAndPublish:function f(At,As){AP.call(this,At,Aa.copy(As,{taskId:"saveAndPublishCube",msgID:this.messageID}),{showProgress:true,showProgressText:true,progressText:M});},saveAndPublishEMMA:function c(Ay,Ax,Av,Au){var Aw=Aa.copy(Ax,{taskId:"saveAndPublishCube",msgID:this.messageID});var At=this;var As={success:function(Az){if(Az.msgId){At.messageID=Az.msgId;}mstrApp.getRootController().model.getHistoryList().set("canSendToHistoryList",true);}};if(Av){Av.saveParams=Aw;Av.saveAsCallback=function(){return mstrmojo.func.wrapMethods(As,Ay,{});};if(!Av.visible){Av.open();}}else{AP.call(this,mstrmojo.func.wrapMethods(As,Ay,{}),Aw,Au||{showProgress:false});}},pollStatus:function Af(At,As){AP.call(this,At,Aa.copy(As,{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",msgID:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},pollEmmaStatus:function E(At,As){AP.call(this,At,Aa.copy(As,{taskId:"pollEmmaStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",msgID:this.messageID}),{showProgress:false});},fetchFolderContents:function AQ(At,As){AP.call(this,At,Aa.copy(As,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12967,"Fetching folder contents...")});},searchFolderContents:function AM(At,As){AP.call(this,At,Aa.copy(As,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:AU});},fetchRemoteFolderContents:function h(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getFolderContentFromRemote",msgid:this.messageID,type:8,flags:268453447}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12967,"Fetching folder contents...")});},fetchRemoteFolderID:function V(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getFolderIDFromRemote",folderName:7,msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(13096,"Fetching remote folder id...")});},getProjectsFromRemote:function AK(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getProjectsFromRemote",msgid:this.messageID,sessionState:mstrApp.sessionState}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(13097,"Fetching remote projects...")});},createEMMAReportInstance:function C(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DICreateEMMAReportInstance"}),{showProgress:true,showProgressText:true,progressText:AU});},createEMMASourceTable:function Ah(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DICreateEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},editEMMASourceTable:function AV(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIEditEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:false});},removeEMMASourceTable:function b(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIRemoveEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:false});},persistCubeConfigInfo:function AT(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIPersistCubeConfigInfo",msgid:this.messageID}),{showProgress:true,showProgressText:false});},startRefineStage:function AG(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIStartRefineStage",msgid:this.messageID}),{showProgress:true,showProgressText:false});},cancelRefineStage:function q(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DICancelRefineStage",msgid:this.messageID}),{showProgress:true,showProgressText:false});},cancelAggFilter:function G(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIStartOrCancelAggFilterChange",msgid:this.messageID,cancel:1}),{showProgress:true,showProgressText:false});},autoMappingSourceTable:function t(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIAutoMappingEMMASourceTable",msgid:this.messageID}),{showProgress:true});},sendToHistoryList:function AB(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DISendToInbox",msgid:this.messageID}),{showProgress:true});},setDataImportInfo:function Aq(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DISetDataImportInfo",msgid:this.messageID}),{showProgress:true});},changeMappingSourceTable:function N(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIChangeMappingEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},updateMappingSourceTable:function l(At,As){AP.call(this,At,Aa.copy(As,{taskId:"setCubeAttributeFormMapping",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},detectRelationshipSourceTable:function AS(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIDetectRelationshipEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},editRelationshipSourceTable:function d(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIEditRelationshipEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},saveEMMASchedule:function AC(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DISaveEMMASchedule",msgid:this.emmaIRRMessageID||""}),{showProgress:true,showProgressText:true,progressText:AU});},getObjectSubscriptions:function Ap(At,As){if(!As){As={};}if(As.deliveryType===undefined){As.deliveryType=16;}AP.call(this,At,Aa.copy(As,{taskId:"GetObjectSubscriptions",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},getAvailableTriggers:function D(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getSchedules",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},getSubscriptionInfo:function Ag(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIGetSubscriptionInfo",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},removeSubscription:function O(At,As){AP.call(this,At,Aa.copy(As,{taskId:"cancelSubscriptionsTask",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},getScheduleStatus:function Ai(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIGetScheduleStatus"}),{showProgress:true,showProgressText:true,progressText:AU});},searchMetadata:function AW(At,As){AP.call(this,At,Aa.copy(As,{taskId:"searchMetadata"}),{showProgress:false});},getAttributeForms:function AD(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getAttributeForms"}),{showProgress:false});},getAttributeGroupInfo:function Ac(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getCubeAttributeGroupInfo",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AR});},duplicateReportInstance:function P(Au,At,As){AP.call(this,Au,Aa.copy(At,{taskId:"duplicateReportInstance"}),As||{showProgress:true,showProgressText:true,progressText:AR});},changePartition:function u(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIChangePartition",msgid:this.messageID}),{showProgress:false});},createEmmaIRRReportInstance:function J(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DICreateEmmaIRRReportInstance"}),{showProgress:true});},publishNonEmmaCube:function AY(At,As){AP.call(this,At,Aa.copy(As,{taskId:"reportExecute",styleName:" "}),{showProgress:true,showProgressText:true,progressText:AU});},createEmmaIRRSourceTables:function w(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DICreateEmmaIRRSourceTables",msgid:this.emmaIRRMessageID}),{showProgress:true});},editEmmaIRRSourceTable:function AJ(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIEditEmmaIRRSourceTable",msgid:this.emmaIRRMessageID}),{showProgress:true});},deleteEmmaIRRSourceTable:function AI(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIDeleteEmmaIRRSourceTable",msgid:this.emmaIRRMessageID}),{showProgress:false});},getEmmaIRRAttributes:function j(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIGetEmmaIRRAttributes",msgid:this.messageID}),{showProgress:true});},setEmmaIRRFilter:function A(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DISetEmmaIRRFilter",msgid:this.emmaIRRMessageID}),{showProgress:true});},validateEmmaIRRAlternateSource:function H(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIValidateEmmaIRRAlternateSource",msgid:this.emmaIRRMessageID}),{showProgress:true});},getSecurityFilter:function AO(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIGetCubeSecurityFilter"}),{showProgress:true,showProgressText:true,progressText:AR});},loadDBRoles:function AN(At,As){AP.call(this,At,Aa.copy(As,{isDataImport:false,reverseOrder:true,verbose:true,taskId:"getDBInstances"}),{showProgress:true,showProgressText:true,progressText:AU});},archSearch:function(At,As){AP.call(this,At,Aa.copy(As,{taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,sessionState:""}),{showProgress:true,showProgressText:true,progressText:AU});},saveDBRole:function I(At,As){AP.call(this,At,Aa.copy(As,{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",showWait:true}),{showProgress:true,showProgressText:true,progressText:AU});},populateDBRoles:function x(At,As){AP.call(this,At,Aa.copy(As,{isDataImport:false,reverseOrder:true,verbose:true,taskId:"getDBInstances",skipSchemaIDCheck:true}),{showProgress:true,showProgressText:true,progressText:AU});},getObjectFolder:function Ao(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIGetObjectFolder"}),{showProgress:true,showProgressText:true,progressText:AU});},deleteDBRole:function x(At,As){AP.call(this,At,Aa.copy(As,{skipSchemaIDCheck:true,taskId:"arch.deleteObject",objecttype:29}),{showProgress:true,showProgressText:true,progressText:AU});},openMailClient:function o(As){if(mstrApp.isSingleTier){window.FormWrapper.mailService(As);}else{mstrApp.openPage(As);}},validateSource:function Ak(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DIValidateEmmaSourceTask",msgid:this.messageID}),{showProgress:true});},scrapeWiki:function AE(At,As){AP.call(this,At,Aa.copy(As,{taskId:"wikiScrapper"}),{showProgress:!(As.shouldSuggest),showProgressText:true,progressText:p});},toggleDatasetServeMode:function m(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIToggleDatasetServeMode",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},setPreference:function F(At,As){AP.call(this,At,Aa.copy(As,{skipSchemaIDCheck:true,taskId:"setPreference"}),{showProgress:true,showProgressText:true,progressText:AU});},updatePreferences:function n(Av,As,At){var Au={taskId:"updatePreference"};if(As){Au[As]=At;}AP.call(this,Av,Au,{showProgress:true,showProgressText:true,progressText:AU});},getPreferences:function AF(At,As){AP.call(this,At,Aa.copy(As,{taskId:"getPreferences"}),{showProgress:true,showProgressText:true,progressText:AU});},getProjectAttributeInfo:function An(At,As){AP.call(this,At,Aa.copy(As,{skipSchemaIDCheck:true,taskId:"GetProjectAttributeInfo"}),{showProgress:true,showProgressText:true,progressText:AU});},clearRelationship:function a(Av,Au){var At=this;var As={success:function(Aw){if(Aw&&Aw.msgid){At.set("messageID",Aw.msgid);}}};AP.call(this,mstrmojo.func.wrapMethods(As,Av,{}),Aa.copy(Au,{taskId:"DIClearRelationshipEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:AU});},DISetURLWhiteListTask:function T(At,As){AP.call(this,At,Aa.copy(As,{taskId:"DISetURLWhiteListTask"}),{showProgress:true,showProgressText:true,progressText:AU});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");mstrmojo.requiresDescs(889,7405,11163,12369);var V=mstrmojo.hash,M=mstrmojo.desc;var w=M(889,"Please wait...");function K(AH,AG,AF){var AD=AG.showWait,AE=AG.suppressError,AC=AG.waitMsg;delete AG.showWait;delete AG.suppressError;delete AG.waitMsg;mstrApp.serverRequest(AG,AH,AD,AE,AC,undefined,undefined,AF);}mstrmojo.qb.DataService=mstrmojo.provide("mstrmojo.qb.DataService",{submitRequest:function u(AD,AC){K.call(this,AD,AC);},pollingStatus:function Z(AJ,AD,AG,AH){var AF=this;if(mstrApp.isSingleTier){if(AJ.success){AJ.success(AD);}return ;}K.call(AF,{success:function AI(AK){if(AK.status==="1"){if(AJ.success){AJ.success(AD);}}else{AF.pollingStatus(AJ,AD,AG);}},failure:function AE(AK){if(AJ.failure){AJ.failure(AK);}},canceled:function AC(AK){if(AJ.canceled){AJ.canceled(AK,AD);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:AG},AH);},prepareDataPollStatus:function J(AH,AK,AJ,AG){var AE=this,AF="pollStatus";if(mstrApp.isSingleTier){AF="DIPollStatus";}K.call(AE,{success:function AI(AL){if(AL.status==="1"||AL.status===1){if(AH.success){AH.success(AK);}}else{AE.prepareDataPollStatus(AH,AK,AJ,AG);}},failure:function AC(AL){if(AH.failure){AH.failure(AL);}},canceled:function AD(AL){if(AH.canceled){AH.canceled(AL,AK);}}},{taskId:AF,resultSetType:3,pollingFrequency:500,threadId:AK.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:AJ},AG);},search:function z(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"arch.search",showWait:true}));},searchFolderContents:function A(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:w});},createReportInstance:function W(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.CreateQBReportInstance",showWait:true,suppressError:true}));},createEmmaInstance:function B(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:w}));},createEmmaTable:function p(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"DICreateEMMASourceTable",showWait:true,waitMsg:w}));},changeMapping:function q(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.RemapObject",showWait:true,waitMsg:w}));},buildRelations:function Y(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"DIDetectRelationshipEMMASourceTable",showWait:true,waitMsg:w}));},setDBRole:function l(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.SetDBRole",showWait:false}));},getShapeKeys:function AB(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"getMapShapes",showWait:false}));},addTable:function e(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.AddTable",showWait:true,waitMsg:w}));},removeTable:function T(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.RemoveTable",showWait:true,waitMsg:w}));},editTable:function G(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.EditTable",showWait:true}));},addColumn:function f(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.AddSelectedColumn",showWait:true}));},addSelectedColumns:function O(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.AddMultiSelectedColumns",showWait:true}));},editColumn:function P(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.EditSelectedColumn",showWait:true}));},removeColumn:function H(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.RemoveSelectedColumn",showWait:true}));},addJoin:function a(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.AddJoin",showWait:true}));},removeJoin:function t(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.RemoveSelectedJoin",showWait:true}));},editJoin:function j(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.EditJoin",showWait:true}));},autoJoin:function U(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.GenerateJoins",showWait:true}));},editCondition:function D(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"qBuilder.EditCondition",showWait:true}));},remapObject:function N(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.RemapObject",showWait:true}));},updateTableStructure:function F(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.UpdateWHTable",showWait:true}));},parse:function Q(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.Parse",showWait:true}));},getReportDefinition:function n(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.GetReportXDADefinition",showWait:true}));},saveReport:function C(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.SaveReportXDADefinition",showWait:true,suppressError:true,waitMsg:mstrmojo.desc(7405,"Saving changes...")}));},getSystemFunctions:function o(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"getSystemFunctions",showWait:false,suppressError:true}));},convertToQB:function I(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.ConvertToQueryBuilder",showWait:true}));},convertToFFSQL:function g(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.ConvertToFreeFormSQL",showWait:true}));},editFFSQL:function k(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.EditFreeFormSQL",showWait:true}));},catalogAction:function AA(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"arch.catalogAction",showWait:true}));},getDocumentAttributes:function h(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"getDocumentAttributes",showWait:true}));},autoClosePrompt:function L(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.AutoClosePrompt",showWait:true}));},publishCube:function S(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.PublishCube",showWait:true,suppressError:true,waitMsg:mstrmojo.desc(11163,"Publishing...")}));},getAttributeForms:function m(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"getAttributeForms"}));},searchMetadata:function E(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"searchMetadata"}));},getFunctionDetails:function x(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"getSystemFunctions"}));},signOutOAuthSource:function c(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.FetchSourceObjects",flags:8,showWait:true,waitMsg:M(12369,"Signing out...")}));},removeEmmaTable:function X(AF,AE){var AC=this;K.call(AC,{success:function AD(AG){mstrApp.msgid=AG.msgid;AC.pollingStatus(AF,AG,w);}},V.copy(AE,{taskId:"DIRemoveEMMASourceTable",showWait:true,waitMsg:w}));},removeOrDuplicateRI:function b(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"qBuilder.RemoveOrDuplicateRI",showWait:true}));},prepareData:function d(AK,AE,AF,AH,AD){var AC=AD||M(13196,"Prepare data ## of ### tables...").replace("##",AF).replace("###",AH);var AG=this,AI={showCancel:true};K.call(AG,{success:function AJ(AL){AG.prepareDataPollStatus(AK,AL,AC,AI);},canceled:function(AL){if(AK.canceled){AK.canceled(AL);}}},V.copy(AE,{taskId:"DIDataPreparation",showWait:true,waitMsg:AC}),AI);},killJob:function R(AD,AC){K.call(this,AD,V.copy(AC,{taskId:"DIKillJob",showWait:true,suppressError:true,waitMsg:w}));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.dom");var H=mstrmojo.array,F=mstrmojo.hash;var G={pages:[],refCnt:[]};var C={};var D=0;function B(){return D++;}function E(K){if(!K){return ;}var J=G.pages;var I=H.indexOf(J,K);if(I!==-1){G.refCnt[I]=G.refCnt[I]+1;}else{G.pages.push(K);G.refCnt.push(1);}}function A(M){if(!M){return ;}var J=G.pages;var I=H.indexOf(J,M);var L,K;if(I!==-1){G.refCnt[I]=G.refCnt[I]-1;if(G.refCnt[I]===0){L=G.pages[I];G.pages.splice(I,1);G.refCnt.splice(I,1);for(K in C){if(L===C[K].page){C[K].page=null;}}L.destroy();}}}mstrmojo.DI.DIPagePoolSlot=mstrmojo.declare(mstrmojo.Obj,null,{key:null,get:function(){return C[this.key].page||null;},set:function(J){var I=this.key;C[I].page=J;J.pageSlotKey=I;},getConfig:function(){return C[this.key].config||null;},setConfig:function(J){var I=this.key;C[I].config=J;},postCreate:function(){if(this._super){this._super();}var I=this.key;if(I&&!C[I]){C[I]={slot:this,page:null};}},destroy:function(J){var I=this.key;if(I){delete C[I];}if(this._super){this._super(J);}}});mstrmojo.DI.DINavigationController=mstrmojo.declare(mstrmojo.Obj,null,{routes:{},postCreate:function(){this.routes={};this.pagePool=C;this.pageInstanceRef=G;},destroy:function(I){F.forEach(C,function(J){if(J.page&&!J.page.destroyed){J.page.destroy();}});this.routes={};C={};G={pages:[],refCnt:[]};if(this._super){this._super(I);}},addRoute:function(I){if(this.routes[I]){return false;}this.routes[I]=[];return true;},deleteRoute:function(K){var I=this.routes[K];var J,L;if(I){for(J=I.length-1;J>-1;J--){L=I[J].slot.get();I[J].slot.destroy();A(L);}}delete this.routes[K];},getPreviousPageSlot:function(K,N){var I=this.getRoute(K);var J,M=null;var L=-1;if(I){for(J=0;J<I.length;J++){if(I[J].type===N){L=J;break;}}}if(L>0){M=I[L-1].slot;}return M;},getNextPageSlot:function(K,N){var I=this.getRoute(K);var J,M=null;var L=-1;if(I){for(J=0;J<I.length;J++){if(I[J].type===N){L=J;break;}}}if(L+1<I.length){M=I[L+1].slot;}return M;},getRoute:function(I){return this.routes[I];},pushPage:function(K,J,M,L,N){var I;var P;var O;if(!this.getRoute(K)){this.addRoute(K);}I=this.getRoute(K);if(!L){P=B().toString();O=this.getPageSlot(P);}else{O=L;}if(M){O.set(M);E(O.get());}if(N){O.setConfig(N);}I.push({type:J,slot:O});return O;},getCurrentPageSlot:function(M,J){var I=this.getRoute(M);var K=null;var L;if(I){for(L=0;L<I.length;L++){if(I[L].type===J){K=I[L].slot;}}}return K;},getPageSlot:function(J){var K=null;var I=B().toString();J=J||I;K=C[J]&&C[J].slot;if(!K){K=new mstrmojo.DI.DIPagePoolSlot({key:J});}return K;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array");var B=mstrmojo.array;mstrmojo.ObjectBrowserDataProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ObjectBrowserDataProvider",path:mstrConfig.taskURL,serverRequest:function(C,D){if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(C,D,{silent:true});}else{mstrmojo.xhr.request("POST",this.path,D,C,undefined,this.XServer,this.baseParams);}},fetchFolderContents:function(C,D,G){var E=C.blockCount,F={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockCount:E,includeAncestorInfo:"true",includeObjectDesc:C.includeObjectDesc};if(C.folderLinksContextId){F.folderLinksContextId=C.folderLinksContextId;}if(C.sId){F.sessionState=C.sId;}if(D.fid){F.rootFolderID=D.fid;}else{if(D.fty){F.rootFolderType=D.fty;}}if(C.browsableTypes){F.objectType=C.browsableTypes;}if(D.blockBegin){F.blockBegin=D.blockBegin;}if(D.searchPattern){if(C.enableQuickSearch){F.quickSearch=C.enableQuickSearch;}F.searchPattern=D.searchPattern;if(D.recursive){F.recursive=D.recursive;}}this.serverRequest(F,G);},newFolder:function(F,G,E,C){var D={taskId:"createFolder",taskContentType:"json",folderID:F,name:G,description:E};this.serverRequest(D,C);},loadObjects:function A(G,H,C,F){var D=[],E=[];B.forEach(G,function(I){D.push(I.did);E.push(I.t);});if(G.length>0&&F){this.serverRequest({taskId:"getObjectInfo",objectIDs:D.join(","),objectTypes:E.join(","),includeDetails:true},H,C);}else{H.success();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._LoadsScript","mstrmojo._HasChildren","mstrmojo.Binding","mstrmojo._HasBindings");mstrmojo.Model=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._LoadsScript,mstrmojo._HasChildren,mstrmojo._HasBindings],{scriptClass:"mstrmojo.Model",init:function A(C){this._super(C);if(this.children){this.initChildren();}if(!this.parent){this.initBindings();}},destroy:function B(C){if(this.children){this.destroyChildren(true);}if(this.bindings){this.destroyBindings();}this._super(C);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.DI.model.HistoryList=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.model.HistoryList",hasSentToHistoryList:false,canSendToHistoryList:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.StepperContentProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.StepperContentProvider",item:null,renderer:null,min:null,max:null,interval:1,minField:"min",maxField:"max",valField:"value",intField:"interval",canLoop:false,next:mstrmojo.emptyFn,prev:mstrmojo.emptyFn,hasPrev:mstrmojo.emptyFn,hasNext:mstrmojo.emptyFn,renderItemAt:mstrmojo.emptyFn,setVal:mstrmojo.emptyFn,getVal:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.Obj","mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.architect.EnumColumnDataTypes");var S=mstrmojo.func.wrapMethods,J=mstrmojo.hash,O=mstrmojo.array,G=mstrmojo.string,T=26,L=15,Q=mstrmojo.desc(11428,"[unknown]"),B=mstrmojo.architect.EnumColumnDataTypes,I=mstrmojo.warehouse.EnumDataChangeEvents,H=I.DBTABLES_CHANGED;function E(W){var V,X=W.tp;V=(X===undefined?W:B[X].n);return("["+(V||Q)+"]");}function F(V){return G.decodeHtmlString(V).replace(/&apos;/g,"'");}mstrmojo.qb.bigquery._hasBigQueryModel=mstrmojo.provide("mstrmojo.qb.bigquery._hasBigQueryModel",{projects:[],datasets:[],warehouseTables:{},selectedProject:undefined,selectedDataset:undefined,getColDataType:function M(W){var V=W.dt.tp;return V===undefined?W.dt:V;},loadDBRoles:function A(W){var V=this;mstrApp.getRootController().getDataService().submitRequest(S({success:function(Z){var Y=Z.mi.gbqht.gbqp,a=[],X;if(!Y){Y=[];}if(!(Y instanceof Array)){Y=[Y];}O.forEach(Y,function(c){X=c.n||c.id;a.push(J.copy({did:String(c.id),n:X,des:X,tp:29,isPrimary:function b(){return this.data.isPrimary;},data:{isPrimary:false}},c));});V.set("projects",a);V.raiseEvent({name:I.DBROLES_LOADED,items:a});}},W),{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,flags:64});},_set_selectedProject:function R(X,V){var W=this;this.selectedProject=V;this.selectedDataset=undefined;this.SelDBRoleID=undefined;this.set("SelDBRoleID",mstrApp.dbroleID);O.forEach(W.projects,function(Y){if(Y.data.isPrimary){Y.data.isPrimary=false;W.raiseEvent({name:I.DBROLE_CHANGED,item:Y});}if(Y.did==V){Y.data.isPrimary=true;W.raiseEvent({name:I.DBROLE_CHANGED,item:Y});}});this.getDatasets();},getAccountInfo:function U(W,V,X){mstrApp.getRootController().getDataService().submitRequest({success:function(Y){X&&X(Y);}},{taskId:"qBuilder.FetchSourceObjects",sourceAccountID:W,dbRoleID:V,flags:2,showWait:true});},getProject:function N(W){var V=null;O.forEach(this.projects,function(X){if(W===X.id){V=X;return false;}});return V;},getDatasets:function C(){var W=this,V=W.selectedProject;W.raiseEvent({name:H,items:[],selectedItems:[]});W.raiseEvent({name:I.NAMESPACES_REQUESTED});mstrApp.getRootController().getDataService().submitRequest({success:function(Y){var Z=Y.mi.gbqht.gbqp.gbqd,X=[];if(!Z){Z=[];}if(!(Z instanceof Array)){X.push({n:Z.id||""});}else{O.forEach(Z,function(a){X.push({n:a.id});});}W.datasets=X;W.raiseEvent({name:I.NAMESPACES_CHANGED,namespaces:X,usecCache:X.length,dbRoleID:V});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:V,flags:64,showWait:true});},onselectedDatasetChange:function K(V){this.selectedDataset=V.value;this.getDatasetTables({blockBegin:0,blockCount:1000,filterText:""});},getDatasetTables:function D(Z,c){var a=this,f=a.selectedProject,d=a.selectedDataset,Y=Z.filterText,e,W=false,b=[],V=[],X;X=a.warehouseTables[f]=a.warehouseTables[f]||{};if(!a.catalogRefresh&&d&&(X[d]!==undefined)){J.forEach(X[d],function(j,h){W=true;e={id:j.id,n:h,did:h,dbtn:h,st:8405,tag:j,ns:j.ns,tp:L,isVisible:function g(){},items:[]};if(Y!==""&&h.toUpperCase().indexOf(Y.toUpperCase())>-1){b.push(e);}V.push(e);});if(W){a.raiseEvent({name:H,items:(Y!=="")?b:V,selectedItems:[]});return ;}}a.raiseEvent({name:I.DBTABLES_REQUESTED,sourceInfo:Z.sourceInfo||""});mstrApp.getRootController().getDataService().submitRequest({success:function(k){var m=k.mi.gbqht.gbqp.gbqd,j=m&&m.gbqt,h=[],g,l;a.catalogRefresh=false;a.selectedDataset=d=m.id;l=X[d]={};if(!j){j=[];}if(!(j instanceof Array)){j=[j];}O.forEach(j,function(n){g=n.id;e={n:g,id:g,ns:f+":"+d,did:g,dbtn:g,st:8405,tag:n,tp:L,isVisible:function(p,o){return a.handleVisibleAction(p,o);},isChecked:function(p,o){return a.handleCheckAction(p,o);},isEnabled:function(p,o){return a.handleEnabledAction(p,o);},items:[]};l[g]=e;h.push(e);});a.raiseEvent({name:H,items:h,selectedItems:[]});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:f,dsid:d,flags:64,showWait:true});},getColumnsForDBTable:function P(W,a){var Z=this,f=Z.selectedProject,X=W.getFresh,Y=W.data,e=Y.datasetID||Z.selectedDataset,b=Y.did,c=Y.n,V;if(!X){V=Z.warehouseTables[f]&&Z.warehouseTables[f][e][b].columns;if(V){a.success({src:W,items:V,selDBRole:e});Z.raiseEvent({name:"dbTablesPopulated",items:{id:b,n:c,items:V}});if(a&&a.complete){a.complete();}return ;}}mstrApp.getRootController().getDataService().submitRequest(S({success:function d(j){var h=j.mi.gbqcs.gbqc,g=[],k;O.forEach(h,function(m){k=F(m.id);g.push({n:k+": "+E(m.dt),cln:m.id,dt:m.dt,id:m.id,did:k,st:26,tp:T,isVisible:function l(){}});});if((g.length>0)&&!X){Z.warehouseTables[f][e][b].columns=g;}j.items=g;}},a),{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:f,dsid:e,tbid:b,flags:1,showWait:false});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var C=mstrmojo.DI.DIConstants,G=mstrmojo.array;mstrmojo.DI.DIDatabaseHelper=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIDatabaseHelper.getImportOptionByDBType=function F(H){switch(H){case C.dbType.SAP:case C.dbType.MSFT_AS:case C.dbType.ESSBASE:case C.dbType.TM1:case C.dbType.PIG:return false;default:return true;}};mstrmojo.DI.DIDatabaseHelper.getSourceTypeByDBType=function E(H){switch(H){case C.dbType.SAP:case C.dbType.MSFT_AS:case C.dbType.ESSBASE:case C.dbType.TM1:return C.xdaType.mdx;case C.dbType.PIG:return C.xdaType.ffsql;default:return -1;}};mstrmojo.DI.DIDatabaseHelper.filterDBById=function D(J,H,I){return G.filter(J,function(M){var L=G.indexOf(H,M.id),K;if(L>-1){K=I;}else{K=!I;}return K;});};mstrmojo.DI.DIDatabaseHelper.filterDBByDispOption=function D(J,H,I){return G.filter(J,function(L){var K=false;if((L.disp&H)===H){G.forEach(I,function(M){if(L.id===M){K=true;return false;}});return !K;}});};mstrmojo.DI.DIDatabaseHelper.getDBIds=function A(I){var H=[];G.forEach(I,function(J){H=H.concat(J.id);});return H;};mstrmojo.DI.DIDatabaseHelper.getUniqueDBTypes=function B(J){var I=[],H;G.forEach(J,function(K){H=G.indexOf(I,K.dbType);if(H<0){I.push(K.dbType);}});return I;};mstrmojo.DI.DIDatabaseHelper.filterDBByAdminConfig=function(I,H){return G.filter(I,function(L){var J=G.indexOf(H,L.id),K=true;if(J>=0){K=false;}return K;});};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(14723,14735);mstrmojo.Refine.RefineHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.Refine.RefineHelpers.completely=function(N,R){R=R||{};R.fontSize=R.fontSize||"16px";R.fontFamily=R.fontFamily||"sans-serif";R.promptInnerHTML=R.promptInnerHTML||"";R.color=R.color||"#000";R.hintColor=R.hintColor||"#aaa";R.backgroundColor=R.backgroundColor||"#fff";R.dropdownBackgroundColor=R.dropdownBackgroundColor||"#f3f3f4";R.dropDownBorderColor=R.dropDownBorderColor||"#aaa";R.dropDownZIndex=R.dropDownZIndex||"100";R.dropDownOnHoverBackgroundColor=R.dropDownOnHoverBackgroundColor||"#dadada";var C=document.createElement("input");C.type="text";C.spellcheck=false;C.style.fontSize=R.fontSize;C.style.fontFamily=R.fontFamily;C.style.color=R.color;C.style.backgroundColor=R.backgroundColor;C.style.width="100%";C.style.outline="0";C.style.border="0";C.style.margin="0";C.style.padding="0";var P=C.cloneNode();P.disabled="";P.style.position="absolute";P.style.top="0";P.style.left="0";P.style.borderColor="transparent";P.style.boxShadow="none";P.style.color=R.hintColor;P.style.visibility="hidden";C.style.backgroundColor="transparent";C.style.verticalAlign="top";C.style.position="relative";var F=document.createElement("div");F.style.position="relative";F.style.outline="0";F.style.border="0";F.style.margin="0";F.style.padding="0";var O=document.createElement("div");O.style.position="absolute";O.style.outline="0";O.style.margin="0";O.style.padding="0";O.style.border="0";O.style.fontSize=R.fontSize;O.style.fontFamily=R.fontFamily;O.style.color=R.color;O.style.backgroundColor=R.backgroundColor;O.style.top="0";O.style.left="0";O.style.overflow="hidden";O.innerHTML=R.promptInnerHTML;O.style.background="transparent";if(document.body===undefined){throw"document.body is undefined. The library was wired up incorrectly.";}document.body.appendChild(O);var K=O.getBoundingClientRect().right;F.appendChild(O);O.style.visibility="visible";O.style.left="-"+K+"px";F.style.marginLeft=K+"px";F.appendChild(P);F.appendChild(C);var D=document.createElement("div");D.style.position="absolute";D.style.visibility="hidden";D.style.padding="5px 0px";D.style.backgroundColor=R.dropdownBackgroundColor;D.style.borderWidth="1px";D.style.borderColor=R.dropDownBorderColor;D.style.borderStyle="solid";var A=document.createElement("div");A.style.position="relative";A.style.outline="0";A.style.margin="0";A.style.padding="0";A.style.textAlign="left";A.style.fontSize=R.fontSize;A.style.fontFamily=R.fontFamily;A.style.zIndex=R.dropDownZIndex;A.style.cursor="default";A.style.overflowX="hidden";A.style.whiteSpace="pre";A.style.overflowY="scroll";A.style.width=R.width+"px";var J=function(U,a){var b=[];var V=0;var Y=-1;var W=function(){this.style.backgroundColor="#e6e6e6";};var X=function(){if(b.indexOf(this)===Y){this.style.backgroundColor=R.dropDownOnHoverBackgroundColor;}else{this.style.backgroundColor=R.dropdownBackgroundColor;}};var Z=function(){T.hide();T.onmouseselection(this.__hint);};var T={hide:function(){a.style.visibility="hidden";},refresh:function(f,h){a.style.visibility="hidden";V=-1;U.innerHTML="";var d=(window.innerHeight||document.documentElement.clientHeight);var j=a.parentNode.getBoundingClientRect();var c=j.top-6;var e=d-j.bottom-6;b=[];var g;for(g=0;g<h.length;g++){if(h[g].toLowerCase().indexOf(f.toLowerCase())!==0){continue;}var k=document.createElement("div");k.style.color=R.color;k.style.padding="0px 0px 0px 9px";k.style.height="22px";k.style.lineHeight="22px";k.style.overflow="hidden";k.style.textOverflow="ellipsis";k.style.whiteSpace="nowrap";k.onmouseover=W;k.onmouseout=X;k.onmousedown=Z;k.title=k.__hint=h[g];k.innerHTML=mstrmojo.string.encodeHtmlString(h[g].substr(0,f.length),false,true)+mstrmojo.string.encodeHtmlString(h[g].substring(f.length),false,true);b.push(k);}for(g=0;g<b.length;g++){U.appendChild(b[g]);}if(b.length===0){return ;}if(b.length===1&&f===b[0].__hint){return ;}if(b.length<1){return ;}var l=22*9;if(e<l){a.style.top="";a.style.bottom=R.bottom+"px";}else{a.style.top=R.top+"px";a.style.bottom="";}U.style.maxHeight=l+"px";a.style.visibility="visible";},highlight:function(d){if(b.length===0){return ;}if(Y!==-1&&b[Y]){b[Y].style.backgroundColor=R.dropdownBackgroundColor;}b[d].style.backgroundColor=R.dropDownOnHoverBackgroundColor;Y=d;var e=b[d];var c=e.parentNode;if(e.offsetTop+e.clientHeight>c.scrollTop+c.clientHeight){c.scrollTop=e.offsetTop+e.clientHeight-c.clientHeight;}else{if(e.offsetTop<c.scrollTop){c.scrollTop=e.offsetTop;}}},move:function(c){if(a.style.visibility==="hidden"){return"";}if(V+c===-2||V+c===-1){V=b.length-1;}else{if(V+c===b.length){V=0;}else{V+=c;}}T.highlight(V);return b[V].__hint;},onmouseselection:function(){}};return T;};var M=J(A,D);M.onmouseselection=function(T){C.value=P.value=G+T;H.onChange(C.value);B=C.value;setTimeout(function(){C.focus();P.scrollLeft=C.scrollLeft;},0);};D.appendChild(A);F.appendChild(D);N.appendChild(F);var I;var G;function L(T){if(I===undefined){I=document.createElement("span");I.style.visibility="hidden";I.style.position="fixed";I.style.outline="0";I.style.margin="0";I.style.padding="0";I.style.border="0";I.style.left="0";I.style.whiteSpace="pre";I.style.fontSize=R.fontSize;I.style.fontFamily=R.fontFamily;I.style.fontWeight="normal";document.body.appendChild(I);}I.innerHTML=String(T).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return I.getBoundingClientRect().right;}var H={onArrowDown:function(){},onArrowUp:function(){},onEnter:function(T){T.preventDefault();T.stopPropagation();},onTab:function(){},onChange:function(){H.repaint();},startFrom:0,options:[],wrapper:F,input:C,hint:P,dropDown:A,prompt:O,setText:function(T){P.value=T;C.value=T;},getText:function(){return C.value;},hideDropDown:function(){M.hide();},repaint:function(){var Z=C.value;var Y=H.startFrom;var U=H.options;var T=U.length;var X=Z.substring(Y);G=Z.substring(0,Y);P.value="";for(var W=0;W<T;W++){var V=U[W];if(V.toLowerCase().indexOf(X.toLowerCase())===0){break;}}A.parentNode.style.left=L(G)-R.left+"px";M.refresh(X,H.options);B=Z;}};var B;var Q=function(T,W){B=T.value;var U=function(){var X=T.value;if(B!==X){B=X;W(X);}P.scrollLeft=C.scrollLeft;};var V=function(){P.value="";};if(T.addEventListener){T.addEventListener("input",U,false);T.addEventListener("keyup",U,false);T.addEventListener("change",U,false);T.addEventListener("blur",V,false);}else{T.attachEvent("oninput",U);T.attachEvent("onkeyup",U);T.attachEvent("onchange",U);T.attachEvent("onblur",V);}};Q(C,function(T){H.onChange(T);});var S=function(W){W=W||window.event;var V=W.keyCode;var X,T;if(W.keyCode===17){return ;}if(V===33){return ;}if(V===34){return ;}if(V===27){M.hide();P.value=C.value;C.focus();return ;}if(V===39||V===35||V===9){if(V===9){W.preventDefault();W.stopPropagation();if(P.value.length===0){H.onTab();}}if(P.value.length>0){var U=(A.style.visibility==="hidden");if(!U){M.hide();}if(C.value!==P.value){C.value=P.value;}X=B!==C.value;B=C.value;if(X){H.onChange(C.value);}}return ;}if(V===13){if(P.value.length===0){return ;}else{var U=(A.style.visibility==="hidden");if(!U){M.hide();}if(U){P.value=C.value;C.focus();H.onEnter(W);return ;}C.value=P.value;X=B!==C.value;B=C.value;if(X){H.onChange(C.value);}W.preventDefault();W.stopPropagation();}return ;}if(V===40){T=M.move(+1);if(T===""){H.onArrowDown();}P.value=G+T;return ;}if(V===38){T=M.move(-1);if(T===""){H.onArrowUp();}P.value=G+T;W.preventDefault();W.stopPropagation();return ;}if(C.value===""&&(V===8)||(V===46)){return ;}P.value="";};var E=function(){this.parentNode.childNodes[1].scrollTop=this.scrollTop;};if(C.addEventListener){C.addEventListener("keydown",S,false);C.addEventListener("scroll",E,false);}else{C.attachEvent("onkeydown",S);C.attachEvent("scroll",E);}return H;};mstrmojo.Refine.RefineHelpers.confirmFilldownOrBlankdown=function(F,C){var D=mstrmojo.desc(14723,'The column is going to be "fill down" or "blank down" using the data order of the random sample in the preview page. When the dataset is eventually published, the entire table in the correct order will be utilized by the wrangler to populate the correct "fill down" or "blank down" values in the final in-memory dataset'),B=mstrmojo.desc(14735,"Warning: Final table data may differ from current preview due to Fill Down / Blank Down operation."),A=mstrmojo.desc(12537,"Data Import");var E=mstrApp.getRootController();if(F){E.displayError(B,false,D,F,A);}};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.locales","mstrmojo.date");mstrmojo.requiresDescs(2052,2170,2265,3434,3544,4530,4699,8002,8984,9614,9919,9920,9921,9922,12491,12492,12493,12494,12495,12509,12771,13031,13131,13132);var J=mstrmojo.DI.DIConstants,E=mstrmojo.dom,F=mstrmojo.array;mstrmojo.DI.DIHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIHelpers.isIE7=function B(){return mstrmojo.dom.isIE7;};mstrmojo.DI.DIHelpers.isIE=function(){return E.isIE||!!E.userAgent.match(/Trident\/7\.0/);};mstrmojo.DI.DIHelpers.getURLCaption=function(){var K="";if(mstrApp.diParams&&mstrApp.diParams.EnableURLImport){if(mstrApp.diParams.EnableFileImport){if(mstrApp.isSingleTier){if(window.FormWrapper!==window.client){K+="File://";}}else{K+="File://";}}if(mstrApp.diParams.EnableHttpImport){if(K!==""){K+=", ";}K+="Http://, Https://";}if(mstrApp.diParams.EnableFTPImport){if(K!==""){K+=", ";}K+="Ftp://";}}return K;};mstrmojo.DI.DIHelpers.getUrlTooltip=function A(){var K="";if(!mstrApp.diParams){return K;}if(!mstrApp.diParams.EnableURLImport){K=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{K=mstrmojo.desc(12492,"Use one of the following URL formats to upload your file:")+" ";K+=mstrmojo.DI.DIHelpers.getURLCaption();if(mstrApp.enableFileImport){K+="\r\r";K+=mstrmojo.desc(12493,"'File://' format allows you to upload files in your local machine. For example: File://ComputerName/path/FileName.");}if(mstrApp.enableHttpImport||mstrApp.enableHttpsImport){K+="\r\r";if(mstrApp.enableFileImport){K+=mstrmojo.desc(12494,"Some other examples are:");}else{K+=mstrmojo.desc(12495,"Some examples are:");}}if(mstrApp.enableHttpImport){K+="\r";K+="http://host/path/FileName";K+="\r";K+="https://user:password@host/path/FileName";}if(mstrApp.enableFtpImport){K+="\r";K+="ftp://user:password@host/path/FileName";K+="\r";K+="ftp://user:password@host:port/path/FileName";}}return K;};mstrmojo.DI.DIHelpers.createMSTRObjects=function(M,O){var K,N,L;if(M.constructor===Array){K=M;for(L=0;L<K.length;L++){K[L]=mstrmojo.DI.DIHelpers.createMSTRObjects(M[L],O);}}else{if(typeof M==="object"){K=new mstrmojo.Obj(M);for(N in M){if(!O||O.indexOf(N)===-1){if(M.hasOwnProperty(N)){K.set(N,mstrmojo.DI.DIHelpers.createMSTRObjects(M[N],O));}}}}else{K=M;}}return K;};mstrmojo.DI.DIHelpers.getURLParameters=function(K){var L;var O;var N=[];if(K){if(K.indexOf("?")>0){K=K.substr(K.indexOf("?")+1);}O=K.split("&");for(L=0;L<O.length;L++){var M=O[L].split("=");if(M.length===2){N[M[0]]=M[1];}}}return N;};mstrmojo.DI.DIHelpers.getBackendSourceType=function(K){var L=J.backendSourceSubtype.localFile;switch(K){case J.sourceSubtype.dropbox:L=J.backendSourceSubtype.dropbox;break;case J.sourceSubtype.bisource:L=J.backendSourceSubtype.bISources;break;case J.sourceSubtype.clipboard:L=J.backendSourceSubtype.clipboard;break;case J.sourceSubtype.facebook:L=J.backendSourceSubtype.facebook;break;case J.sourceSubtype.googleAnalytics:L=J.backendSourceSubtype.googleAnalytics;break;case J.sourceSubtype.googleBigQuery:L=J.backendSourceSubtype.googleBigQuery;break;case J.sourceSubtype.googleBigQueryFFSQL:L=J.backendSourceSubtype.googleBigQueryFFSQLModel;break;case J.sourceSubtype.googleBigQuerySingleTable:L=J.backendSourceSubtype.googleBigQuerySingleTable;break;case J.sourceSubtype.googleDrive:L=J.backendSourceSubtype.googleDrive;break;case J.sourceSubtype.hadoop:L=J.backendSourceSubtype.hadoopFileBrowser;break;case J.sourceSubtype.localFile:L=J.backendSourceSubtype.localFile;break;case J.sourceSubtype.mdx:L=J.backendSourceSubtype.OLAPSources;break;case J.sourceSubtype.salesforce:L=J.backendSourceSubtype.salesforce;break;case J.sourceSubtype.samplefile:L=J.backendSourceSubtype.samplefile;break;case J.sourceSubtype.searchOnSource:L=J.backendSourceSubtype.searchAsASource;break;case J.sourceSubtype.twitter:L=J.backendSourceSubtype.twitter;break;case J.sourceSubtype.url:L=J.backendSourceSubtype.url;break;case J.sourceSubtype.publicData:L=J.backendSourceSubtype.publicData;break;}return L;};mstrmojo.DI.DIHelpers.getStateParameters=function(L){var K;var O;var M=[];if(L.indexOf(":")>=0){O=L.split(":");}else{O=L.split("%3A");}for(K=0;K<O.length;K++){var N=O[K];if(N.substr(2,1)==="_"){M[N.substr(0,2)]=N.substr(3);}}return M;};mstrmojo.DI.DIHelpers.getExtensionType=function(M){var L=M.toLowerCase(),K;if(L===".xls"||L===".xlsx"||L===".xlsm"){K=J.xdaType.excel;}else{if(L===".txt"||L===".csv"||L===".tsv"||L===".prn"){K=J.xdaType.text;}else{K=0;}}return K;};mstrmojo.DI.DIHelpers.setTablesrc=function(K,M,L){if(M){if(!K.tablesSrc[M]){K.tablesSrc[M]=[];}K.tablesSrc[M].push(L);}};function C(K){var M={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2},P={1:J.columnDataTypes.integer,2:J.columnDataTypes.integer,6:J.columnDataTypes.dtdouble,7:J.columnDataTypes.dtfloat,21:J.columnDataTypes.integer,22:J.columnDataTypes.nlong,30:J.columnDataTypes.bigDecimal,34:J.columnDataTypes.int64},L=M[K],O=P[K],N="";switch(L.toString()){case J.dataTypeMenuItems.NUMBER:switch(O){case J.columnDataTypes.integer:N=mstrmojo.desc(9614,"Integer");break;case J.columnDataTypes.nlong:N=mstrmojo.desc(13131,"Long");break;case J.columnDataTypes.int64:N=mstrmojo.desc(13132,"Big Integer");break;case J.columnDataTypes.dtfloat:N=mstrmojo.desc(8002,"Float");break;case J.columnDataTypes.dtdouble:N=mstrmojo.desc(2265,"Double");break;case J.columnDataTypes.bigDecimal:N=mstrmojo.desc(9920,"Big Decimal");break;default:N=mstrmojo.desc(3434,"Number");break;}break;case J.dataTypeMenuItems.DATE:N=mstrmojo.desc(2052,"Date");break;case J.dataTypeMenuItems.DATE_TIME:N=mstrmojo.desc(9919,"DateTime");break;case J.dataTypeMenuItems.TIME:N=mstrmojo.desc(2170,"Time");break;case J.dataTypeMenuItems.TEXT:N=mstrmojo.desc(3544,"Text");break;case J.dataTypeMenuItems.HTML_TAG:N=mstrmojo.desc(9921,"HTML Tag");break;case J.dataTypeMenuItems.PHONE_NUMBER:N=mstrmojo.desc(8984,"Phone Number");break;case J.dataTypeMenuItems.SYMBOL:N=mstrmojo.desc(4530,"Symbol");break;case J.dataTypeMenuItems.URL:N=mstrmojo.desc(9922,"URL");break;case J.dataTypeMenuItems.EMAIL:N=mstrmojo.desc(4699,"Email");break;}return N;}mstrmojo.DI.DIHelpers.getDataTypeString=C;mstrmojo.DI.DIHelpers.parseAlternateSourceValidationResults=function H(S){var Q=[],O,P,R,T,K,M,N,L;F.forEach(S,function(U){O=P=R=T="";M=(U.vt===3)?1:0;switch(U.vt){case 0:case 1:case 2:case 3:O=U.n;P=C(U.ddt);K=U.src;R=K.n;T=C(K.ddt);break;case 4:O=U.n;P=C(U.ddt);break;case 8:K=U.src;R=K.n;T=C(K.ddt);break;}N=P?O+"("+P+")":O;L=T?R+"("+T+")":R;Q.push([N,M,L]);});return Q;};mstrmojo.DI.DIHelpers.getURLFileName=function(L){var K=L.lastIndexOf("/");return K>=0&&K+1!==L.length?L.substr(K+1):L;};mstrmojo.DI.DIHelpers.isOperationMode=function(K){return K!==undefined&&K!==null;};mstrmojo.DI.DIHelpers.isCtrlKey=function(K,M){var L=M||(K||window).event;return L.ctrlKey||L.metaKey;};mstrmojo.DI.DIHelpers.isRefreshable=function(L){var K,M=0;for(K in L.importSources){var N=L.importSources[K];if(N.type===J.sourceType.file&&(N.subtype===J.sourceSubtype.url||N.subtype===J.sourceSubtype.publicData)){if(!N.sourceInfo||N.sourceInfo.url.indexOf("http://mirror.microstrategy.com/datahub/samples")!==0){M++;}}}if(L.getAllTableID().length===M&&!mstrApp.diParams.EnableHttpImport&&!mstrApp.diParams.EnableFTPImport&&!mstrApp.diParams.EnableFileImport&&!mstrApp.diParams.EnableURLImport){return false;}return true;};mstrmojo.DI.DIHelpers.strStartsWith=function(L,K){return L.indexOf(K)===0;};mstrmojo.DI.DIHelpers.adjustDataIdx=function(N,M){var K=[],L;if(!N||N.length===0){return ;}F.forEach(N,function(O){L=O.subColumns;if(L&&L.length>1){K=K.concat(L);}else{K.push(O);}});K.sort(function(P,O){return P[M]-O[M];});};mstrmojo.DI.DIHelpers.setDataIdx=function(M,L,K){if(!L||L.length===0){return ;}if(L[0].hasOwnProperty("clix")){F.forEach(M,function(O){var N=O.ix;O[K]=F.find(L,"clix",N);if(O.isMultiForm){F.forEach(O.subColumns,function(P){P[K]=F.find(L,"clix",P.ix);});}});}if(L[0].hasOwnProperty("did")){F.forEach(M,function(P){var O=P.did;var N=F.find(L,"did",O);if(N!==-1){P[K]=N;}if(P.isMultiForm){F.forEach(P.subColumns,function(Q){N=F.find(L,"did",Q.did);if(N!==-1){Q[K]=N;}});}});}};mstrmojo.DI.DIHelpers.encodeData=function(K){var L="";if(K!==undefined){if(typeof K==="number"){L=K;}else{L=mstrmojo.string.encodeHtmlString(K,false,true);}}return L;};var I={0:"Bytes",1:"KB",2:"MB",3:"GB",4:"TB",5:"PB"};function D(K){return I[K]||"unknown";}mstrmojo.DI.DIHelpers.getRoundSize=function G(L){var K;for(K=0;(L/1024)>1;K++){L=L/1024;}L=L.toPrecision(3);return L+D(K);};mstrmojo.DI.DIHelpers.findNewElements=function(M,N){var L=[],K;if(M&&M.length){F.forEach(N,function(O){K=F.indexOf(M,O);if(K===-1){L.push(O);}});}else{if(N&&N.length){L=[].concat(N);}}return L;};mstrmojo.DI.DIHelpers.generateCubeName=function(L){var K,M,N=30;K=L.join(" ");if(K.length>N){K=K.slice(0,N)+"...";}M=L.length;if(M>1){K+=" ("+M+" tables)";}return K;};mstrmojo.DI.DIHelpers.parseValidateSourceResults=function(L){var K={isValidate:true,hasError:false,tbids:[],tableValidate:[],missingColumnTbids:[],mismatchedDatatypeTbids:[],missingTableTbids:[],errorTableTbids:[],missingColumns:{},mismatchedDatatypeColumns:{},missingTablesColumns:{},errorTableErrCode:{}},M=L&&L.vts;F.forEach(M,function(T){var N=T.tbid,U=T.vt,R=T.cols||[],O=true,S=false,Q,V=[],P=[];if(U===1){O=true;}else{switch(U){case J.backendError.switchingFileType:case J.backendError.noExternalSession:case J.backendError.databaseCredentialsNotAvailable:S=true;break;}F.forEach(R,function(W){var X=W.vt;switch(X){case 1:P.push(W);break;case 4:V.push(W);break;}});}if(S){K.errorTableTbids.push(N);K.errorTableErrCode[N]=U;K.isValidate=false;K.hasError=true;}Q=V.length>0&&V.length===R.length;if(V.length>0||P.length>0){O=false;}else{O=true;}if(O===false){K.isValidate=false;}K.tbids.push(N);K.tableValidate.push(O);if(V.length>0){if(Q){K.missingTableTbids.push(N);K.missingTablesColumns[N]=V;}else{K.missingColumnTbids.push(N);K.missingColumns[N]=V;}}if(P.length>0){K.mismatchedDatatypeTbids.push(N);K.mismatchedDatatypeColumns[N]=P;}});return K;};mstrmojo.DI.DIHelpers.truncate=function(M,O,K){if(M&&M.length>O){var Q=3,L=O-Q,P=Math.ceil(L/2),N=Math.floor(L/2);if(K){return M.substr(0,L)+"...";}else{return M.substr(0,P)+"..."+M.substr(M.length-N);}}else{return M;}};mstrmojo.DI.DIHelpers.getAbsoluteFileName=function(K){var L,M=K.lastIndexOf("\\");if(M===-1){M=K.lastIndexOf("/");}L=K.substring(M+1,K.length);return L;};mstrmojo.DI.DIHelpers.reevaluatePopupPosition=function(K){if(K){var L=K.style,O=L.display,N=L.left,M=L.top;L.display="block";if(parseInt(N.substring(0,N.length-2))<0){L.left="0px";}if(parseInt(M.substring(0,M.length-2))<0){L.top="0px";}L.display=O;}};mstrmojo.DI.DIHelpers.expandNode=function(L){var K=L.visible;L.set("visible",!K);return !K;};mstrmojo.DI.DIHelpers.normalizeTimestamp=function(M){var L=M.replace(/-/g,"/");var K=L.indexOf(".");if(K>0){L=L.substring(0,K);}return L;};mstrmojo.DI.DIHelpers.getBackendErrorStr=function(L,K){var M="";switch(L){case J.backendError.switchingFileType:M=mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube.");break;case J.backendError.noExternalSession:case J.backendError.databaseCredentialsNotAvailable:M=mstrmojo.desc(14392,"We do not have the credentials needed to get the data for this table. Please provide the credentials to proceed publishing this table.");break;}return M;};mstrmojo.DI.DIHelpers.getCommonElements=function(N,P,O){var L=[],M,K;for(M=0;N&&M<N.length;M++){for(K=0;P&&K<P.length;K++){if(O(N[M],P[K])){L.push(N[M]);break;}}}return L;};mstrmojo.DI.DIHelpers.formatDateAndTime=function(S,N){var R=mstrmojo.date;var L=mstrmojo.locales;var M,T,Q,P,K,O;M=R.parseDateAndOrTime(S);T=M.date;Q=M.time;if(N){O=new Date(Date.UTC(T.year,T.month-1,T.day,Q.hour,Q.min,Q.sec));M=R.getDateJson(O);T=M;Q=M;}P=R.formatDateInfo(T,L.datetime.DATEDISPLAYFORMAT);K=R.formatTimeInfo(Q,L.datetime.TIMEDISPLAYFORMAT);return P+" "+K;};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(12746,12747);var B="PWDHIDDEN123!@#",A=mstrmojo.warehouse.EnumDatabaseType;mstrmojo.DI.DIHadoopDBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIHadoopDBRole",init:function D(F){var E=this.mdDBRole;E.n=mstrmojo.desc(12746,"Hadoop Connection");E.des=mstrmojo.desc(12747,"Hadoop Connection Description");E.dbr_type="2";E.stp=7424;E.owned="1";E.writable="1";E.ln="UserName";E.password=B;E.tp=44;E.db_type=A.BDE;E.db_version=218;E.dbms="85649E2005E343A19269C39CC3DE9E42";E.odbcv="";E.cefu="1";},mdDBRole:{},n:"",did:"",tp:44,data:undefined,populated:false,populate:function C(F){var E=this;if(this.populated){F(E);}else{mstrApp.getRootController().getDataService().populateDBRoles({success:function(G){E.populated=true;E.mdDBRole=G.dbrs[0];E.n=E.mdDBRole.n.toString();E.did=E.mdDBRole.did;F(E);}},{objectID:this.mdDBRole.did});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");mstrmojo.requiresDescs(889,13196);var O=mstrmojo.hash,F=mstrmojo.desc;var G=F(889,"Please wait...");function A(c,b,a){var W=b.showWait,X=b.suppressError,V=b.waitMsg,Y=b.msgid,Z=b.alertCfg;delete b.showWait;delete b.suppressError;delete b.waitMsg;delete b.msgid;delete b.alertCfg;mstrApp.serverRequest(b,c,W,X,V,Y,Z,a);}mstrmojo.qb.es.DataService=mstrmojo.provide("mstrmojo.qb.es.DataService",{emmaIRRMessageID:null,submitRequest:function N(W,V){A.call(this,W,V);},setDBRole:function R(W,V){A.call(this,W,O.copy(V,{taskId:"qBuilder.SetDBRole",showWait:true}));},signOutOAuthSource:function S(W,V){A.call(this,W,O.copy(V,{taskId:"qBuilder.FetchSourceObjects",flags:8,showWait:true,waitMsg:F(12369,"Signing out...")}));},pollingStatus:function D(c,W,Z,a){var Y=this;if(mstrApp.isSingleTier){if(c.success){c.success(W);}return ;}A.call(Y,{success:function b(d){if(d.status==="1"){if(c.success){c.success(W);}}else{Y.pollingStatus(c,W,Z);}},failure:function X(d){if(c.failure){c.failure(d);}},canceled:function V(d){if(c.canceled){c.canceled(d,W);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:Z},a);},prepareDataPollStatus:function Q(a,d,c,Z){var X=this,Y="pollStatus";if(mstrApp.isSingleTier){Y="DIPollStatus";}A.call(X,{success:function b(e){if(e.status==="1"||e.status===1){if(a.success){a.success(d);}}else{X.prepareDataPollStatus(a,d,c,Z);}},failure:function V(e){if(a.failure){a.failure(e);}},canceled:function W(e){if(a.canceled){a.canceled(e,d);}}},{taskId:Y,resultSetType:3,pollingFrequency:500,threadId:d.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:c},Z);},createEmmaTables:function P(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"qBuilder.CreateEmmaTables",showWait:true,waitMsg:G}));},createEmmaInstance:function U(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:G}));},removeEMMATable:function B(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"DIRemoveEMMASourceTable",showWait:true,waitMsg:G}));},changePartition:function M(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"DIChangePartition",showWait:true,waitMsg:G}));},editEmmaIRRSourceTable:function I(Z,Y){var W=this,V;V={success:function X(a){W.emmaIRRMessageID=a.msgid;}};A.call(W,mstrmojo.func.wrapMethods(V,Z),O.copy(Y,{taskId:"DIEditEmmaIRRSourceTable",msgid:W.emmaIRRMessageID,showWait:true}));},search:function J(W,V){A.call(this,W,O.copy(V,{taskId:"arch.search",showWait:true}));},searchFolderContents:function T(W,V){A.call(this,W,O.copy(V,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:G});},validateEmmaIRRAlternateSource:function C(W,V){A.call(this,W,O.copy(V,{taskId:"DIValidateEmmaIRRAlternateSource",msgid:this.emmaIRRMessageID,showWait:true}));},prepareData:function H(d,X,Y,a,W){var V=W||F(13196,"Prepare data ## of ### tables...").replace("##",Y).replace("###",a);var Z=this,b={showCancel:true};A.call(Z,{success:function c(e){Z.prepareDataPollStatus(d,e,V,b);},canceled:function(e){if(d.canceled){d.canceled(e);}}},O.copy(X,{taskId:"DIDataPreparation",showWait:true,waitMsg:V}),b);},catalogAction:function L(W,V){A.call(this,W,O.copy(V,{taskId:"arch.catalogAction",showWait:true}));},autoMap:function K(Y,X){var V=this;A.call(V,{success:function W(Z){mstrApp.msgid=Z.msgid;V.pollingStatus(Y,Z,G);}},O.copy(X,{taskId:"qBuilder.AutoMapTables",showWait:true,waitMsg:G}));},killJob:function E(W,V){A.call(this,W,O.copy(V,{taskId:"DIKillJob",showWait:true,suppressError:true,waitMsg:G}));}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.Obj");var K=mstrmojo.hash;var P=0;var F=[];var J={};var L=false;function I(T){var U=T.callback;if(U.submission){U.submission(T.id,this.userInteractionRequired(T),T);}this.submitRequest(T);}function G(){if(F.length&&!L){I.call(this,F.shift());}}mstrmojo.ServerProxy=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ServerProxy",transport:null,cnt:0,request:function E(d,a,U,V){if(U){this.cancelRequests();}var X=this.id,Y=this.transport,T=mstrmojo.now()+a.taskId+P++,W=d.canceled||mstrmojo.emptyFn;d.canceled=function(e){W();d.complete(true);return Y.cancelRequest(e);};d=mstrmojo.func.wrapMethods(d,{complete:function(e){mstrmojo.all[X].deleteRequest(e);}});var Z=!K.isEmpty(this._requests),b=this.createRequest(T,d,a,V),c=(L||Z)&&!V.doNotHold;if(c){F.push(b);}else{I.call(this,b);}return T;},hasRequests:function O(){return !K.isEmpty(this._requests)||L;},createRequest:function Q(V,X,W,T){var U=this._requests;if(!U){U=this._requests={};}U[V]={id:V,callback:X,params:W,config:T};return U[V];},submitRequest:function M(T){this.transport.serverRequest(this.id,T.id,T);},cancelRequests:function S(){var T=false;K.forEach(this._requests,function(U){if(U.gotResponse===undefined){T|=U.callback.canceled(U.id);}});this._requests={};F=[];return T;},cancelRequest:function B(X){var U=false,W=this._requests[X],V,T=F.length;for(V=0;V<T;V++){if(F[V]===W){break;}}if(V<T){F.splice(V,1);delete this._requests[X];U|=W.callback.canceled(W.id);}return U;},response:function A(X,T,V){$MAPF(false,"AndroidServerTransport","transportRequest");var W=this.getRequest(X);if(W){W.gotResponse=true;var Y=W.callback,U=(T&&!V.mstrerr)?"success":"failure";try{if(Y[U]){Y[U](V,W);}}finally{Y.complete(X);}}G.call(this);},deleteRequest:function N(U){var T=this._requests;delete T[U];},getRequest:function H(U){var T=this._requests;return T&&T[U];},userInteractionRequired:function C(T){return false;},addLoadingGraph:function D(T){J[T]=true;L=true;},removeLoadingGraph:function R(T){delete J[T];if(K.isEmpty(J)){L=false;G.call(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B="PWDHIDDEN123!@#",A=mstrmojo.warehouse.EnumDatabaseType;mstrmojo.DI.DIRemoteProjectDBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIRemoteProjectDBRole",init:function D(F){var E=this.mdDBRole;E.n="Project Source Name";E.des="Remote project source name";E.dbr_type="5";E.stp=7424;E.owned="1";E.writable="1";E.tp=5;E.db_type=5;E.db_version=218;E.dbms="00000000000000000000000000000000";E.odbcv="";E.cefu="1";},mdDBRole:{},n:"",did:"",tp:5,data:undefined,populated:false,populate:function C(F){var E=this;if(this.populated){F(E);}else{mstrApp.getRootController().getDataService().populateDBRoles({success:function(G){E.populated=true;E.mdDBRole=G.dbrs[0];E.n=E.mdDBRole.n.toString();E.did=E.mdDBRole.did;F(E);}},{objectID:this.mdDBRole.did});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.DI.model.Schedule=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.model.Schedule",subsID:null,subsName:null,trgName:null,trgID:null,curTrg:null,availableTriggers:[],isSendNow:false,isScheduleAdvanced:false,oldIsScheduleAdvanced:false,showAdvanceState:false,populateTriggers:function A(B){var C=B&&B.objList;C=C&&[].concat(C);this.set("availableTriggers",C||[]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12379,12380);var E=mstrmojo.DI.DIConstants;mstrmojo.DI.controller.DIDirectAccessController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDirectAccessController",shouldAskUser:true,confirmDDA:true,canSupportDDA:function C(I){var M=mstrApp.getRootController().model,K=true,N=-1,P=-1,J=-1,L,R=E.sourceSubtype,Q,O=M.getAllTableID().length;if(M.connectLiveSupport===E.connectLiveSupport.connectLiveSupportInMemoryOnly&&O>0){K=false;}else{mstrmojo.hash.forEach(M.importSources,function(S){Q=S.subtype;if(Q===R.googleBigQueryFFSQL||Q===R.googleBigQuerySingleTable){Q=R.googleBigQuery;}if(M.isSupportedDDASource(Q)){if(N===-1){N=Q;}else{if(N!==Q){K=false;return false;}}switch(N){case R.hanaSingleTable:case R.querybuilder:case R.searchOnSource:case R.mdx:if(P===-1){P=S.dbrid;}else{if(P!==S.dbrid){K=false;return false;}}break;case R.googleBigQuery:L=S.sourceInfo;if(J===-1){J=L.said;}else{if(J!==L.said){K=false;return false;}}break;default:break;}}else{K=false;return false;}});if(I){I.dbrid=(P===-1?undefined:P);}if(M.connectLiveSupport!==E.connectLiveSupport.connectLiveSupportInMemoryOnly||O===0){K=true;}}return K;},shouldSupportDDA:function D(){var I=mstrApp.getRootController().model;var J=false;if(I.connectLiveSupport!==E.connectLiveSupport.connectLiveSupportUnknown){if(I.connectLiveSupport===E.connectLiveSupport.connectLiveSupportDDAOnly){J=true;}}else{mstrmojo.hash.forEach(I.importSources,function(K){if(I.isDDAOnlySource(K.subtype)||(K.xdaType===E.xdaType.qbSingleTable&&K.databaseType===4000)){J=true;}});}return J;},onToggleDDA:function A(J){var I=mstrApp.getRootController();if(J===true){I.model.set("isDirectDataAccess",true);if(!this.canSupportDDA()){I.displayError(mstrmojo.desc(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),false);I.model.set("isDirectDataAccess",false);}}else{I.model.set("isDirectDataAccess",false);if(this.shouldSupportDDA()){I.displayError(mstrmojo.desc(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this."),false);I.model.set("isDirectDataAccess",true);}}},askUserAboutDDA:function G(I){if(I){this.shouldAskUser=false;}return this.shouldAskUser;},checkIfDDA:function H(K){var I=mstrApp.getRootController();var J=I.model,L;if(J.isDirectDataAccess){return true;}if(J.operationMode===E.operationMode.edit){if(K){for(L=0;L<K.cn;L++){if(K.cube[L].cube_id===J.cubeID&&K.cube[L].sz===undefined&&this.canSupportDDA()){return true;}}}}return false;},getDDACheckboxID:function F(){var I=mstrApp.getRootController().rootView.footer.ddaCheckbox;return I?I.id:"";},setDirectDataAccess:function B(I){mstrApp.getRootController().model.set("isDirectDataAccess",I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.Refine.FileSaver=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.Refine.FileSaver.saveAs=mstrmojo.Refine.FileSaver.saveAs||(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator))||(function(M){if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return ;}var N=M.document,J=function(){return M.URL||M.webkitURL||M;},P=N.createElementNS("http://www.w3.org/1999/xhtml","a"),C=!M.externalHost&&"download" in P,Q=function(S){var R=N.createEvent("MouseEvents");R.initMouseEvent("click",true,false,M,0,0,0,0,0,false,false,false,false,0,null);S.dispatchEvent(R);},G=M.webkitRequestFileSystem,O=M.requestFileSystem||G||M.mozRequestFileSystem,D=function(R){(M.setImmediate||M.setTimeout)(function(){throw R;},0);},L="application/octet-stream",I=0,H=[],F=function(){var S=H.length;while(S--){var R=H[S];if(typeof R==="string"){J().revokeObjectURL(R);}else{R.remove();}}H.length=0;},K=function(S,R,V){R=[].concat(R);var U=R.length;while(U--){var W=S["on"+R[U]];if(typeof W==="function"){try{W.call(S,V||S);}catch(T){D(T);}}}},B=function(S,T){var U=this,a=S.type,d=false,W,V,R=function(){var e=J().createObjectURL(S);H.push(e);return e;},Z=function(){K(U,"writestart progress write writeend".split(" "));},c=function(){if(d||!W){W=R(S);}if(V){V.location.href=W;}else{window.open(W,"_blank");}U.readyState=U.DONE;Z();},Y=function(e){return function(){if(U.readyState!==U.DONE){return e.apply(this,arguments);}};},X={create:true,exclusive:false},b;U.readyState=U.INIT;if(!T){T="download";}if(C){W=R(S);P.href=W;P.download=T;Q(P);U.readyState=U.DONE;Z();return ;}if(M.chrome&&a&&a!==L){b=S.slice||S.webkitSlice;S=b.call(S,0,S.size,L);d=true;}if(G&&T!=="download"){T+=".download";}if(a===L||G){V=M;}if(!O){c();return ;}I+=S.size;O(M.TEMPORARY,I,Y(function(e){e.root.getDirectory("saved",X,Y(function(f){var g=function(){f.getFile(T,X,Y(function(h){h.createWriter(Y(function(j){j.onwriteend=function(k){V.location.href=h.toURL();H.push(h);U.readyState=U.DONE;K(U,"writeend",k);};j.onerror=function(){var k=j.error;if(k.code!==k.ABORT_ERR){c();}};"writestart progress write abort".split(" ").forEach(function(k){j["on"+k]=U["on"+k];});j.write(S);U.abort=function(){j.abort();U.readyState=U.DONE;};U.readyState=U.WRITING;}),c);}),c);};f.getFile(T,{create:false},Y(function(h){h.remove();g();}),Y(function(h){if(h.code===h.NOT_FOUND_ERR){g();}else{c();}}));}),c);}),c);},A=B.prototype,E=function(R,S){return new B(R,S);};A.abort=function(){var R=this;R.readyState=R.DONE;K(R,"abort");};A.readyState=A.INIT=0;A.WRITING=1;A.DONE=2;A.error=A.onwritestart=A.onprogress=A.onwrite=A.onabort=A.onerror=A.onwriteend=null;M.addEventListener("unload",F,false);E.unload=function(){F();M.removeEventListener("unload",F,false);};return E;}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content));if(typeof module!=="undefined"&&module!==null){module.exports=saveAs;}else{if((typeof define!=="undefined"&&define!==null)&&(define.amd!=null)){define([],function(){return saveAs;});}}String.prototype.endsWithAny=function(){var A=Array.prototype.slice.call(arguments),C=this.toLowerCase().toString();for(var B=0;B<A.length;B++){if(C.indexOf(A[B],C.length-A[B].length)!==-1){return true;}}return false;};mstrmojo.Refine.FileSaver.saveTextAs=mstrmojo.Refine.FileSaver.saveTextAs||(function(B,G,F){G=G||"download.txt";F=F||"utf-8";B=(B||"").replace(/\r?\n/g,"\r\n");if(mstrmojo.Refine.FileSaver.saveAs&&Blob){var A=new Blob([B],{type:"text/plain;charset="+F});mstrmojo.Refine.FileSaver.saveAs(A,G);return true;}else{var C=window.frames.saveTxtWindow;if(!C){C=document.createElement("iframe");C.id="saveTxtWindow";C.style.display="none";document.body.insertBefore(C,null);C=window.frames.saveTxtWindow;if(!C){C=window.open("","_temp","width=100,height=100");if(!C){window.alert("Sorry, download file could not be created.");return false;}}}var D=C.document;D.open("text/plain","replace");D.charset=F;if(G.endsWithAny(".htm",".html")){D.close();D.body.innerHTML="\r\n"+B+"\r\n";}else{if(!G.endsWithAny(".txt")){G+=".txt";}D.write(B);D.close();}var E=D.execCommand("SaveAs",null,G);C.close();return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.Refine.DateTimeUtil=mstrmojo.declare(mstrmojo.Obj,null,null);Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var B=Date,A=B.prototype,D=B.CultureInfo,G=function(I,H){if(!H){H=2;}return("000"+I).slice(H*-1);};A.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};A.setTimeToNow=function(){var H=new Date();this.setHours(H.getHours());this.setMinutes(H.getMinutes());this.setSeconds(H.getSeconds());this.setMilliseconds(H.getMilliseconds());return this;};B.today=function(){return new Date().clearTime();};B.compare=function(I,H){if(isNaN(I)||isNaN(H)){throw new Error(I+" - "+H);}else{if(I instanceof Date&&H instanceof Date){return(I<H)?-1:(I>H)?1:0;}else{throw new TypeError(I+" - "+H);}}};B.equals=function(I,H){return(I.compareTo(H)===0);};B.getDayNumberFromName=function(I){var M=D.dayNames,H=D.abbreviatedDayNames,L=D.shortestDayNames,K=I.toLowerCase();for(var J=0;J<M.length;J++){if(M[J].toLowerCase()==K||H[J].toLowerCase()==K||L[J].toLowerCase()==K){return J;}}return -1;};B.getMonthNumberFromName=function(I){var L=D.monthNames,H=D.abbreviatedMonthNames,K=I.toLowerCase();for(var J=0;J<L.length;J++){if(L[J].toLowerCase()==K||H[J].toLowerCase()==K){return J;}}return -1;};B.isLeapYear=function(H){return((H%4===0&&H%100!==0)||H%400===0);};B.getDaysInMonth=function(H,I){return[31,(B.isLeapYear(H)?29:28),31,30,31,30,31,31,30,31,30,31][I];};B.getTimezoneAbbreviation=function(K){var J=D.timezones,I;for(var H=0;H<J.length;H++){if(J[H].offset===K){return J[H].name;}}return null;};B.getTimezoneOffset=function(H){var K=D.timezones,J;for(var I=0;I<K.length;I++){if(K[I].name===H.toUpperCase()){return K[I].offset;}}return null;};A.clone=function(){return new Date(this.getTime());};A.compareTo=function(H){return Date.compare(this,H);};A.equals=function(H){return Date.equals(this,H||new Date());};A.between=function(I,H){return this.getTime()>=I.getTime()&&this.getTime()<=H.getTime();};A.isAfter=function(H){return this.compareTo(H||new Date())===1;};A.isBefore=function(H){return(this.compareTo(H||new Date())===-1);};A.isToday=function(){return this.isSameDay(new Date());};A.isSameDay=function(H){return this.clone().clearTime().equals(H.clone().clearTime());};A.addMilliseconds=function(H){this.setMilliseconds(this.getMilliseconds()+H);return this;};A.addSeconds=function(H){return this.addMilliseconds(H*1000);};A.addMinutes=function(H){return this.addMilliseconds(H*60000);};A.addHours=function(H){return this.addMilliseconds(H*3600000);};A.addDays=function(H){this.setDate(this.getDate()+H);return this;};A.addWeeks=function(H){return this.addDays(H*7);};A.addMonths=function(H){var I=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+H);this.setDate(Math.min(I,B.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};A.addYears=function(H){return this.addMonths(H*12);};A.add=function(I){if(typeof I=="number"){this._orient=I;return this;}var H=I;if(H.milliseconds){this.addMilliseconds(H.milliseconds);}if(H.seconds){this.addSeconds(H.seconds);}if(H.minutes){this.addMinutes(H.minutes);}if(H.hours){this.addHours(H.hours);}if(H.weeks){this.addWeeks(H.weeks);}if(H.months){this.addMonths(H.months);}if(H.years){this.addYears(H.years);}if(H.days){this.addDays(H.days);}return this;};var E,F,C;A.getWeek=function(){var O,N,M,L,K,J,I,H,Q,P;E=(!E)?this.getFullYear():E;F=(!F)?this.getMonth()+1:F;C=(!C)?this.getDate():C;if(F<=2){O=E-1;N=(O/4|0)-(O/100|0)+(O/400|0);M=((O-1)/4|0)-((O-1)/100|0)+((O-1)/400|0);Q=N-M;K=0;J=C-1+(31*(F-1));}else{O=E;N=(O/4|0)-(O/100|0)+(O/400|0);M=((O-1)/4|0)-((O-1)/100|0)+((O-1)/400|0);Q=N-M;K=Q+1;J=C+((153*(F-3)+2)/5)+58+Q;}I=(O+N)%7;L=(J+I-K)%7;H=(J+3-L)|0;if(H<0){P=53-((I-Q)/5|0);}else{if(H>364+Q){P=1;}else{P=(H/7|0)+1;}}E=F=C=null;return P;};A.getISOWeek=function(){E=this.getUTCFullYear();F=this.getUTCMonth()+1;C=this.getUTCDate();return G(this.getWeek());};A.setWeek=function(H){return this.moveToDayOfWeek(1).addWeeks(H-this.getWeek());};B._validate=function(K,J,H,I){if(typeof K=="undefined"){return false;}else{if(typeof K!="number"){throw new TypeError(K+" is not a Number.");}else{if(K<J||K>H){throw new RangeError(K+" is not a valid value for "+I+".");}}}return true;};B.validateMillisecond=function(H){return B._validate(H,0,999,"millisecond");};B.validateSecond=function(H){return B._validate(H,0,59,"second");};B.validateMinute=function(H){return B._validate(H,0,59,"minute");};B.validateHour=function(H){return B._validate(H,0,23,"hour");};B.validateDay=function(I,H,J){return B._validate(I,1,B.getDaysInMonth(H,J),"day");};B.validateMonth=function(H){return B._validate(H,0,11,"month");};B.validateYear=function(H){return B._validate(H,0,9999,"year");};A.set=function(H){if(B.validateMillisecond(H.millisecond)){this.addMilliseconds(H.millisecond-this.getMilliseconds());}if(B.validateSecond(H.second)){this.addSeconds(H.second-this.getSeconds());}if(B.validateMinute(H.minute)){this.addMinutes(H.minute-this.getMinutes());}if(B.validateHour(H.hour)){this.addHours(H.hour-this.getHours());}if(B.validateMonth(H.month)){this.addMonths(H.month-this.getMonth());}if(B.validateYear(H.year)){this.addYears(H.year-this.getFullYear());}if(B.validateDay(H.day,this.getFullYear(),this.getMonth())){this.addDays(H.day-this.getDate());}if(H.timezone){this.setTimezone(H.timezone);}if(H.timezoneOffset){this.setTimezoneOffset(H.timezoneOffset);}if(H.week&&B._validate(H.week,0,53,"week")){this.setWeek(H.week);}return this;};A.moveToFirstDayOfMonth=function(){return this.set({day:1});};A.moveToLastDayOfMonth=function(){return this.set({day:B.getDaysInMonth(this.getFullYear(),this.getMonth())});};A.moveToNthOccurrence=function(I,J){var H=0;if(J>0){H=J-1;}else{if(J===-1){this.moveToLastDayOfMonth();if(this.getDay()!==I){this.moveToDayOfWeek(I,-1);}return this;}}return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(I,+1).addWeeks(H);};A.moveToDayOfWeek=function(H,I){var J=(H-this.getDay()+7*(I||+1))%7;return this.addDays((J===0)?J+=7*(I||+1):J);};A.moveToMonth=function(J,H){var I=(J-this.getMonth()+12*(H||+1))%12;return this.addMonths((I===0)?I+=12*(H||+1):I);};A.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};A.getTimezone=function(){return B.getTimezoneAbbreviation(this.getUTCOffset());};A.setTimezoneOffset=function(J){var H=this.getTimezoneOffset(),I=Number(J)*-6/10;return this.addMinutes(I-H);};A.setTimezone=function(H){return this.setTimezoneOffset(B.getTimezoneOffset(H));};A.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};A.isDaylightSavingTime=function(){return(this.hasDaylightSavingTime()&&new Date().getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset());};A.getUTCOffset=function(){var I=this.getTimezoneOffset()*-10/6,H;if(I<0){H=(I-10000).toString();return H.charAt(0)+H.substr(2);}else{H=(I+10000).toString();return"+"+H.substr(1);}};A.getElapsed=function(H){return(H||new Date())-this;};if(!A.toISOString){A.toISOString=function(){function H(I){return I<10?"0"+I:I;}return'"'+this.getUTCFullYear()+"-"+H(this.getUTCMonth()+1)+"-"+H(this.getUTCDate())+"T"+H(this.getUTCHours())+":"+H(this.getUTCMinutes())+":"+H(this.getUTCSeconds())+'Z"';};}A._toString=A.toString;A.toString=function(J){var H=this;if(J&&J.length==1){var K=D.formatPatterns;H.t=H.toString;switch(J){case"d":return H.t(K.shortDate);case"D":return H.t(K.longDate);case"F":return H.t(K.fullDateTime);case"m":return H.t(K.monthDay);case"r":return H.t(K.rfc1123);case"s":return H.t(K.sortableDateTime);case"t":return H.t(K.shortTime);case"T":return H.t(K.longTime);case"u":return H.t(K.universalSortableDateTime);case"y":return H.t(K.yearMonth);}}var I=function(L){switch(L*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return J?J.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(L){if(L.charAt(0)==="\\"){return L.replace("\\","");}H.h=H.getHours;switch(L){case"hh":return G(H.h()<13?(H.h()===0?12:H.h()):(H.h()-12));case"h":return H.h()<13?(H.h()===0?12:H.h()):(H.h()-12);case"HH":return G(H.h());case"H":return H.h();case"mm":return G(H.getMinutes());case"m":return H.getMinutes();case"ss":return G(H.getSeconds());case"s":return H.getSeconds();case"yyyy":return G(H.getFullYear(),4);case"yy":return G(H.getFullYear());case"dddd":return D.dayNames[H.getDay()];case"ddd":return D.abbreviatedDayNames[H.getDay()];case"dd":return G(H.getDate());case"d":return H.getDate();case"MMMM":return D.monthNames[H.getMonth()];case"MMM":return D.abbreviatedMonthNames[H.getMonth()];case"MM":return G((H.getMonth()+1));case"M":return H.getMonth()+1;case"t":return H.h()<12?D.amDesignator.substring(0,1):D.pmDesignator.substring(0,1);case"tt":return H.h()<12?D.amDesignator:D.pmDesignator;case"S":return I(H.getDate());default:return L;}}):this._toString();};}());(function(){var Q=Date,G=Q.prototype,R=Q.CultureInfo,K=Number.prototype;G._orient=+1;G._nth=null;G._is=false;G._same=false;G._isSecond=false;K._dateElement="day";G.next=function(){this._orient=+1;return this;};Q.next=function(){return Q.today().next();};G.last=G.prev=G.previous=function(){this._orient=-1;return this;};Q.last=Q.prev=Q.previous=function(){return Q.today().last();};G.is=function(){this._is=true;return this;};G.same=function(){this._same=true;this._isSecond=false;return this;};G.today=function(){return this.same().day();};G.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}return false;};G.at=function(V){return(typeof V==="string")?Q.parse(this.toString("d")+" "+V):this.set(V);};K.fromNow=K.after=function(V){var W={};W[this._dateElement]=this;return((!V)?new Date():V.clone()).add(W);};K.ago=K.before=function(V){var W={};W[this._dateElement]=this*-1;return((!V)?new Date():V.clone()).add(W);};var E=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),H=("january february march april may june july august september october november december").split(/\s/),J=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),L=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),B=("final first second third fourth fifth").split(/\s/),T;G.toObject=function(){var W={};for(var V=0;V<J.length;V++){W[J[V].toLowerCase()]=this["get"+L[V]]();}return W;};Q.fromObject=function(V){V.week=null;return Date.today().set(V);};var S=function(V){return function(){if(this._is){this._is=false;return this.getDay()==V;}if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}this._isSecond=false;var X=this._nth;this._nth=null;var W=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(V,X);if(this>W){throw new RangeError(Q.getDayName(V)+" does not occur "+X+" times in the month of "+Q.getMonthName(W.getMonth())+" "+W.getFullYear()+".");}return this;}return this.moveToDayOfWeek(V,this._orient);};};var F=function(V){return function(){var X=Q.today(),W=V-X.getDay();if(V===0&&R.firstDayOfWeek===1&&X.getDay()!==0){W=W+7;}return X.addDays(W);};};for(var P=0;P<E.length;P++){Q[E[P].toUpperCase()]=Q[E[P].toUpperCase().substring(0,3)]=P;Q[E[P]]=Q[E[P].substring(0,3)]=F(P);G[E[P]]=G[E[P].substring(0,3)]=S(P);}var U=function(V){return function(){if(this._is){this._is=false;return this.getMonth()===V;}return this.moveToMonth(V,this._orient);};};var I=function(V){return function(){return Q.today().set({month:V,day:1});};};for(var O=0;O<H.length;O++){Q[H[O].toUpperCase()]=Q[H[O].toUpperCase().substring(0,3)]=O;Q[H[O]]=Q[H[O].substring(0,3)]=I(O);G[H[O]]=G[H[O].substring(0,3)]=U(O);}var C=function(V){return function(){if(this._isSecond){this._isSecond=false;return this;}if(this._same){this._same=this._is=false;var a=this.toObject(),Z=(arguments[0]||new Date()).toObject(),Y="",X=V.toLowerCase();for(var W=(J.length-1);W>-1;W--){Y=J[W].toLowerCase();if(a[Y]!=Z[Y]){return false;}if(X==Y){break;}}return true;}if(V.substring(V.length-1)!="s"){V+="s";}return this["add"+V](this._orient);};};var D=function(V){return function(){this._dateElement=V;return this;};};for(var N=0;N<J.length;N++){T=J[N].toLowerCase();G[T]=G[T+"s"]=C(J[N]);K[T]=K[T+"s"]=D(T);}G._ss=C("Second");var A=function(V){return function(W){if(this._same){return this._ss(arguments[0]);}if(W||W===0){return this.moveToNthOccurrence(W,V);}this._nth=V;if(V===2&&(W===undefined||W===null)){this._isSecond=true;return this.addSeconds(this._orient);}return this;};};for(var M=0;M<B.length;M++){G[B[M]]=(M===0)?A(-1):A(M);}}());(function(){Date.Parsing={Exception:function(I){this.message="Parse error at '"+I.substring(0,10)+" ...'";}};var A=Date.Parsing;var C=A.Operators={rtoken:function(I){return function(J){var K=J.match(I);if(K){return([K[0],J.substring(K[0].length)]);}else{throw new A.Exception(J);}};},token:function(I){return function(J){return C.rtoken(new RegExp("^s*"+J+"s*"))(J);};},stoken:function(I){return C.rtoken(new RegExp("^"+I));},until:function(I){return function(J){var K=[],M=null;while(J.length){try{M=I.call(this,J);}catch(L){K.push(M[0]);J=M[1];continue;}break;}return[K,J];};},many:function(I){return function(J){var M=[],K=null;while(J.length){try{K=I.call(this,J);}catch(L){return[M,J];}M.push(K[0]);J=K[1];}return[M,J];};},optional:function(I){return function(J){var K=null;try{K=I.call(this,J);}catch(L){return[null,J];}return[K[0],K[1]];};},not:function(I){return function(J){try{I.call(this,J);}catch(K){return[null,J];}throw new A.Exception(J);};},ignore:function(I){return I?function(J){var K=null;K=I.call(this,J);return[null,K[1]];}:null;},product:function(){var J=arguments[0],K=Array.prototype.slice.call(arguments,1),L=[];for(var I=0;I<J.length;I++){L.push(C.each(J[I],K));}return L;},cache:function(K){var I={},J=null;return function(L){try{J=I[L]=(I[L]||K.call(this,L));}catch(M){J=I[L]=M;}if(J instanceof A.Exception){throw J;}else{return J;}};},any:function(){var I=arguments;return function(K){var L=null;for(var J=0;J<I.length;J++){if(I[J]==null){continue;}try{L=(I[J].call(this,K));}catch(M){L=null;}if(L){return L;}}throw new A.Exception(K);};},each:function(){var I=arguments;return function(K){var N=[],L=null;for(var J=0;J<I.length;J++){if(I[J]==null){continue;}try{L=(I[J].call(this,K));}catch(M){throw new A.Exception(K);}N.push(L[0]);K=L[1];}return[N,K];};},all:function(){var J=arguments,I=I;return I.each(I.optional(J));},sequence:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;if(I.length==1){return I[0];}return function(O){var P=null,Q=null;var S=[];for(var N=0;N<I.length;N++){try{P=I[N].call(this,O);}catch(R){break;}S.push(P[0]);try{Q=J.call(this,P[1]);}catch(M){Q=null;break;}O=Q[1];}if(!P){throw new A.Exception(O);}if(Q){throw new A.Exception(Q[1]);}if(K){try{P=K.call(this,P[1]);}catch(L){throw new A.Exception(P[1]);}}return[S,(P?P[1]:O)];};},between:function(J,K,I){I=I||J;var L=C.each(C.ignore(J),K,C.ignore(I));return function(M){var N=L.call(this,M);return[[N[0][0],r[0][2]],N[1]];};},list:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;return(I instanceof Array?C.each(C.product(I.slice(0,-1),C.ignore(J)),I.slice(-1),C.ignore(K)):C.each(C.many(C.each(I,C.ignore(J))),px,C.ignore(K)));},set:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;return function(X){var L=null,N=null,M=null,O=null,P=[[],X],W=false;for(var R=0;R<I.length;R++){M=null;N=null;L=null;W=(I.length==1);try{L=I[R].call(this,X);}catch(U){continue;}O=[[L[0]],L[1]];if(L[1].length>0&&!W){try{M=J.call(this,L[1]);}catch(V){W=true;}}else{W=true;}if(!W&&M[1].length===0){W=true;}if(!W){var S=[];for(var Q=0;Q<I.length;Q++){if(R!=Q){S.push(I[Q]);}}N=C.set(S,J).call(this,M[1]);if(N[0].length>0){O[0]=O[0].concat(N[0]);O[1]=N[1];}}if(O[1].length<P[1].length){P=O;}if(P[1].length===0){break;}}if(P[0].length===0){return P;}if(K){try{M=K.call(this,P[1]);}catch(T){throw new A.Exception(P[1]);}P[1]=M[1];}return P;};},forward:function(I,J){return function(K){return I[J].call(this,K);};},replace:function(J,I){return function(K){var L=J.call(this,K);return[I,L[1]];};},process:function(J,I){return function(K){var L=J.call(this,K);return[I.call(this,L[0]),L[1]];};},min:function(I,J){return function(K){var L=J.call(this,K);if(L[0].length<I){throw new A.Exception(K);}return L;};}};var H=function(I){return function(){var J=null,M=[];if(arguments.length>1){J=Array.prototype.slice.call(arguments);}else{if(arguments[0] instanceof Array){J=arguments[0];}}if(J){for(var L=0,K=J.shift();L<K.length;L++){J.unshift(K[L]);M.push(I.apply(null,J));J.shift();return M;}}else{return I.apply(null,arguments);}};};var G="optional not ignore cache".split(/\s/);for(var D=0;D<G.length;D++){C[G[D]]=H(C[G[D]]);}var F=function(I){return function(){if(arguments[0] instanceof Array){return I.apply(null,arguments[0]);}else{return I.apply(null,arguments);}};};var E="each any all".split(/\s/);for(var B=0;B<E.length;B++){C[E[B]]=F(C[E[B]]);}}());(function(){var E=Date,K=E.prototype,F=E.CultureInfo;var G=function(M){var N=[];for(var L=0;L<M.length;L++){if(M[L] instanceof Array){N=N.concat(G(M[L]));}else{if(M[L]){N.push(M[L]);}}}return N;};E.Grammar={};E.Translator={hour:function(L){return function(){this.hour=Number(L);};},minute:function(L){return function(){this.minute=Number(L);};},second:function(L){return function(){this.second=Number(L);};},meridian:function(L){return function(){this.meridian=L.slice(0,1).toLowerCase();};},timezone:function(L){return function(){var M=L.replace(/[^\d\+\-]/g,"");if(M.length){this.timezoneOffset=Number(M);}else{this.timezone=L.toLowerCase();}};},day:function(L){var M=L[0];return function(){this.day=Number(M.match(/\d+/)[0]);};},month:function(L){return function(){this.month=(L.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(L)/4:Number(L)-1;};},year:function(L){return function(){var M=Number(L);this.year=((L.length>2)?M:(M+(((M+2000)<F.twoDigitYearMax)?2000:1900)));};},rday:function(L){return function(){switch(L){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(L){L=(L instanceof Array)?L:[L];for(var N=0;N<L.length;N++){if(L[N]){L[N].call(this);}}var M=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=M.getDate();}if(!this.year){this.year=M.getFullYear();}if(!this.month&&this.month!==0){this.month=M.getMonth();}if(!this.day){this.day=1;}if(!this.hour){this.hour=0;}if(!this.minute){this.minute=0;}if(!this.second){this.second=0;}if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else{if(this.meridian=="a"&&this.hour==12){this.hour=0;}}}if(this.day>E.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}var O=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){O.set({timezone:this.timezone});}else{if(this.timezoneOffset){O.set({timezoneOffset:this.timezoneOffset});}}return O;},finish:function(L){L=(L instanceof Array)?G(L):[L];if(L.length===0){return null;}for(var Q=0;Q<L.length;Q++){if(typeof L[Q]=="function"){L[Q].call(this);}}var N=E.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else{if(this.now){N=new Date();}}var R=!!(this.days&&this.days!==null||this.orient||this.operator);var S,P,O;O=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){N.setTimeToNow();}if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;R=true;}}if(!R&&this.weekday&&!this.day&&!this.days){var M=Date[this.weekday]();this.day=M.getDate();if(!this.month){this.month=M.getMonth();}this.year=M.getFullYear();}if(R&&this.weekday&&this.unit!="month"){this.unit="day";S=(E.getDayNumberFromName(this.weekday)-N.getDay());P=7;this.days=S?((S+(O*P))%P):(O*P);}if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}if(this.month&&!this.day&&this.value){N.set({day:this.value*1});if(!R){this.day=this.value*1;}}if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;R=true;}if(R&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";S=(this.month-N.getMonth());P=12;this.months=S?((S+(O*P))%P):(O*P);this.month=null;}if(!this.unit){this.unit="day";}if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*O;}else{if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}this[this.unit+"s"]=this.value*O;}}if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else{if(this.meridian=="a"&&this.hour==12){this.hour=0;}}}if(this.weekday&&!this.day&&!this.days){var M=Date[this.weekday]();this.day=M.getDate();if(M.getMonth()!==N.getMonth()){this.month=M.getMonth();}}if((this.month||this.month===0)&&!this.day){this.day=1;}if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}if(R&&this.timezone&&this.day&&this.days){this.day=this.days;}return(R)?N.add(this):N.set(this);}};var H=E.Parsing.Operators,D=E.Grammar,J=E.Translator,B;D.datePartDelimiter=H.rtoken(/^([\s\-\.\,\/\x27]+)/);D.timePartDelimiter=H.stoken(":");D.whiteSpace=H.rtoken(/^\s*/);D.generalDelimiter=H.rtoken(/^(([\s\,]|at|@|on)+)/);var A={};D.ctoken=function(P){var O=A[P];if(!O){var Q=F.regexPatterns;var N=P.split(/\s+/),M=[];for(var L=0;L<N.length;L++){M.push(H.replace(H.rtoken(Q[N[L]]),N[L]));}O=A[P]=H.any.apply(null,M);}return O;};D.ctoken2=function(L){return H.rtoken(F.regexPatterns[L]);};D.h=H.cache(H.process(H.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),J.hour));D.hh=H.cache(H.process(H.rtoken(/^(0[0-9]|1[0-2])/),J.hour));D.H=H.cache(H.process(H.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),J.hour));D.HH=H.cache(H.process(H.rtoken(/^([0-1][0-9]|2[0-3])/),J.hour));D.m=H.cache(H.process(H.rtoken(/^([0-5][0-9]|[0-9])/),J.minute));D.mm=H.cache(H.process(H.rtoken(/^[0-5][0-9]/),J.minute));D.s=H.cache(H.process(H.rtoken(/^([0-5][0-9]|[0-9])/),J.second));D.ss=H.cache(H.process(H.rtoken(/^[0-5][0-9]/),J.second));D.hms=H.cache(H.sequence([D.H,D.m,D.s],D.timePartDelimiter));D.t=H.cache(H.process(D.ctoken2("shortMeridian"),J.meridian));D.tt=H.cache(H.process(D.ctoken2("longMeridian"),J.meridian));D.z=H.cache(H.process(H.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),J.timezone));D.zz=H.cache(H.process(H.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),J.timezone));D.zzz=H.cache(H.process(D.ctoken2("timezone"),J.timezone));D.timeSuffix=H.each(H.ignore(D.whiteSpace),H.set([D.tt,D.zzz]));D.time=H.each(H.optional(H.ignore(H.stoken("T"))),D.hms,D.timeSuffix);D.d=H.cache(H.process(H.each(H.rtoken(/^([0-2]\d|3[0-1]|\d)/),H.optional(D.ctoken2("ordinalSuffix"))),J.day));D.dd=H.cache(H.process(H.each(H.rtoken(/^([0-2]\d|3[0-1])/),H.optional(D.ctoken2("ordinalSuffix"))),J.day));D.ddd=D.dddd=H.cache(H.process(D.ctoken("sun mon tue wed thu fri sat"),function(L){return function(){this.weekday=L;};}));D.M=H.cache(H.process(H.rtoken(/^(1[0-2]|0\d|\d)/),J.month));D.MM=H.cache(H.process(H.rtoken(/^(1[0-2]|0\d)/),J.month));D.MMM=D.MMMM=H.cache(H.process(D.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),J.month));D.y=H.cache(H.process(H.rtoken(/^(\d\d?)/),J.year));D.yy=H.cache(H.process(H.rtoken(/^(\d\d)/),J.year));D.yyy=H.cache(H.process(H.rtoken(/^(\d\d?\d?\d?)/),J.year));D.yyyy=H.cache(H.process(H.rtoken(/^(\d\d\d\d)/),J.year));B=function(){return H.each(H.any.apply(null,arguments),H.not(D.ctoken2("timeContext")));};D.day=B(D.d,D.dd);D.month=B(D.M,D.MMM);D.year=B(D.yyyy,D.yy);D.orientation=H.process(D.ctoken("past future"),function(L){return function(){this.orient=L;};});D.operator=H.process(D.ctoken("add subtract"),function(L){return function(){this.operator=L;};});D.rday=H.process(D.ctoken("yesterday tomorrow today now"),J.rday);D.unit=H.process(D.ctoken("second minute hour day week month year"),function(L){return function(){this.unit=L;};});D.value=H.process(H.rtoken(/^\d\d?(st|nd|rd|th)?/),function(L){return function(){this.value=L.replace(/\D/g,"");};});D.expression=H.set([D.rday,D.operator,D.value,D.unit,D.orientation,D.ddd,D.MMM]);B=function(){return H.set(arguments,D.datePartDelimiter);};D.mdy=B(D.ddd,D.month,D.day,D.year);D.ymd=B(D.ddd,D.year,D.month,D.day);D.dmy=B(D.ddd,D.day,D.month,D.year);D.date=function(L){return((D[F.dateElementOrder]||D.mdy).call(this,L));};D.format=H.process(H.many(H.any(H.process(H.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(L){if(D[L]){return D[L];}else{throw E.Parsing.Exception(L);}}),H.process(H.rtoken(/^[^dMyhHmstz]+/),function(L){return H.ignore(H.stoken(L));}))),function(L){return H.process(H.each.apply(null,L),J.finishExact);});var I={};var C=function(L){return I[L]=(I[L]||D.format(L)[0]);};D.formats=function(M){if(M instanceof Array){var N=[];for(var L=0;L<M.length;L++){N.push(C(M[L]));}return H.any.apply(null,N);}else{return C(M);}};D._formats=D.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);D._start=H.process(H.set([D.date,D.time,D.expression],D.generalDelimiter,D.whiteSpace),J.finish);D.start=function(L){try{var M=D._formats.call({},L);if(M[1].length===0){return M;}}catch(N){}return D._start.call({},L);};E._parse=E.parse;E.parse=function(L){var M=null;if(!L){return null;}if(L instanceof Date){return L;}try{M=E.Grammar.start.call({},L.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(N){return null;}return((M[1].length===0)?M[0]:null);};E.getParseFunction=function(M){var L=E.Grammar.formats(M);return function(N){var O=null;try{O=L.call({},N);}catch(P){return null;}return((O[1].length===0)?O[0]:null);};};E.parseExact=function(L,M){return E.getParseFunction(M)(L);};}());}());(function(){mstrmojo.requiresDescs(12575,12316,12317,12319,12331,14244,14245,14246,14247,14248,14249,14250,14251,14252,14253,14254,14255,14256,14257,14258,14259,14260,14261,14262,14263,14264,14265,14266,14267,12339,12341,12342,13957,13958,12344,12345,14268,14269,14270,14271,14272,14273,14274,14275,14276,14277,14278,14279,14280,14288,14289);mstrmojo.requiresCls("mstrmojo.hash");var F=mstrmojo.hash;mstrmojo.Refine.RefineModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineModel",data:{},start:0,limit:50,columns:{},history:{},operations:{entries:[]},engine:JSON.stringify({facets:[],mode:"row-based"}),hasUploadData:false,sampleStatus:null,transformations:{Delete:{Colomn:{op:"core/column-removal",description:mstrmojo.desc(12575,"Delete Column")+" [[column name]]",columnName:"[column name]"},RowsContains:{op:"core/row-removal",description:mstrmojo.desc(14244,"Delete Row(s) Where Cell Contains ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsBegins:{op:"core/row-removal",description:mstrmojo.desc(14245,"Delete Row(s) Where Cell Begins With ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsEnds:{op:"core/row-removal",description:mstrmojo.desc(14263,"Delete Row(s) Where Cell Ends With ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsBlank:{op:"core/row-removal",description:mstrmojo.desc(14246,"Remove Row(s) Where Cell Is Empty")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{expression:"value",invert:false,selectError:false,omitError:false,name:"[column name]",selectBlank:true,columnName:"[column name]",omitBlank:false,type:"list",selection:[]}],mode:"row-based"}},RowsEquals:{op:"core/row-removal",description:mstrmojo.desc(14288,"Delete Row(s) Where Cell Equals To ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{invert:false,expression:"value",selectError:false,omitError:false,selectBlank:false,name:"[column name]",omitBlank:false,columnName:"[column name]",type:"list",selection:[{v:{v:"[value]",l:"[value]"}}]}],mode:"row-based"}},RowsNotEquals:{op:"core/row-removal",description:mstrmojo.desc(14289,"Delete Row(s) Where Cell Not Equals To ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{invert:true,expression:"value",selectError:false,omitError:false,selectBlank:false,name:"[column name]",omitBlank:false,columnName:"[column name]",type:"list",selection:[{v:{v:"[value]",l:"[value]"}}]}],mode:"row-based"}},RemoveDuplicateCells:{op:"core/row-deduplicate",description:mstrmojo.desc(12316,"Remove Duplicate Cells")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",columnName:"[column name]",engineConfig:{facets:[],mode:"row-based"},mode:"column-based"},RemoveDuplicateRows:{op:"core/row-deduplicate",description:mstrmojo.desc(12317,"Remove Duplicate Rows")+" (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},mode:"row-based"},DeleteRowsInTheView:{op:"core/row-removal",description:mstrmojo.desc(null,"Deleted rows meeting the requirement")+": [Requirement] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"}},DeleteRowsNotInTheView:{op:"core/row-removal",description:mstrmojo.desc(null,"Deleted rows not meeting the requirement")+": [Requirement] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},invert:true}},Extract:{on:{op:"core/column-addition",description:mstrmojo.desc(14247,"Extract On ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[1])",onError:"set-to-blank"},fromTo:{op:"core/column-addition",description:mstrmojo.desc(12319,"Extract By Fixed Length")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:substring(value, [from], [to])",onError:"set-to-blank"},beforeFirst:{op:"core/column-addition",description:mstrmojo.desc(14248,"Extract Before First ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[0])",onError:"set-to-blank"},afterFirst:{op:"core/column-addition",description:mstrmojo.desc(14249,"Extract After First ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[2])",onError:"set-to-blank"},beforeLast:{op:"core/column-addition",description:mstrmojo.desc(14264,"Extract Before Last ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(rpartition(value, [separator])[0])",onError:"set-to-blank"},afterLast:{op:"core/column-addition",description:mstrmojo.desc(14265,"Extract After Last ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(rpartition(value, [separator])[2])",onError:"set-to-blank"}},FindAndReplace:{CharInCell:{op:"core/text-transform",description:mstrmojo.desc(14250,"Find And Replace Characters In Cell From #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:replace (value, [from], [to])",onError:"keep-original",repeat:false,repeatCount:10},CellContains:{op:"core/text-transform",description:mstrmojo.desc(14251,"Find And Replace Cell Where Cell Contains #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(contains(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CellBeginsWith:{op:"core/text-transform",description:mstrmojo.desc(14252,"Find And Replace Cell Where Cell Begins With #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(startsWith(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CellEndsWith:{op:"core/text-transform",description:mstrmojo.desc(14253,"Find And Replace Cell Where Cell Ends With #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(endsWith(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CutOn:{op:"core/text-transform",description:mstrmojo.desc(14514,"Remove Characters")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:replace (value, [separator], '')",onError:"keep-original",repeat:false,repeatCount:10},CutBefore:{op:"core/text-transform",description:mstrmojo.desc(14515,"Remove Characters Before")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:trim(if(isBlank(partition(value, [separator])[1]), value, partition(value, [separator])[1] + partition(value, [separator])[2]))",onError:"keep-original",repeat:false,repeatCount:10},CutAfter:{op:"core/text-transform",description:mstrmojo.desc(14516,"Remove Characters After")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:trim(partition(value, [separator])[0] + partition(value, [separator])[1])",onError:"keep-original",repeat:false,repeatCount:10}},split:{bySeparator:{op:"core/column-split",description:mstrmojo.desc(14260,"Split On ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:0,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:0},byFieldLengths:{op:"core/column-split",description:mstrmojo.desc(12331,"Split By Fixed Length")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},fieldForward:true,keepRest:true,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"lengths",fieldLengths:[]},beforeFirst:{op:"core/column-split",description:mstrmojo.desc(14257,"Split Before First ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:1,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},afterFirst:{op:"core/column-split",description:mstrmojo.desc(14258,"Split After First ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:3,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},afterLast:{op:"core/column-split",description:mstrmojo.desc(14259,"Split After Last ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:4,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},cellIntoRow:{op:"core/multivalued-cell-split",description:mstrmojo.desc(13884,"Split Cell Into Rows On Separator")+" [column name]",columnName:"[column name]",keyColumnName:"[key column name]",separator:",",mode:"plain"}},TransformCell:{titlecase:{op:"core/text-transform",description:mstrmojo.desc(14268,"To Title Case")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[[column name]]",expression:"value.toTitlecase()",onError:"keep-original",repeat:false,repeatCount:10},uppercase:{op:"core/text-transform",description:mstrmojo.desc(14269,"To Uppercase")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toUppercase()",onError:"keep-original",repeat:false,repeatCount:10},lowercase:{op:"core/text-transform",description:mstrmojo.desc(14270,"To Lowercase")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toLowercase()",onError:"keep-original",repeat:false,repeatCount:10},unescape:{op:"core/text-transform",description:mstrmojo.desc(12339,"Unescape HTML")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.unescape('html')",onError:"keep-original",repeat:false,repeatCount:10},number:{op:"core/text-transform",description:mstrmojo.desc(14271,"To Number")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toNumber()",onError:"set-to-blank",repeat:false,repeatCount:10},text:{op:"core/text-transform",description:mstrmojo.desc(14272,"To Text")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"toString(value)",onError:"set-to-blank",repeat:false,repeatCount:10},date:{op:"core/text-transform",description:mstrmojo.desc(14273,"To Date")+" [format] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:toDate(value, [format])",onError:"set-to-blank",repeat:false,repeatCount:10},fillDown:{op:"core/fill-down",description:mstrmojo.desc(12341,"Fill Down")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]"},blankDown:{op:"core/blank-down",description:mstrmojo.desc(12342,"Blank Down")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]"},padBefore:{op:"core/text-transform",description:mstrmojo.desc(13957,"Pad Before")+" [string] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"record-based"},columnName:"[column name]",expression:'grel:[string] + if(isNull(value), "", value)',onError:"keep-original",repeat:false,repeatCount:10},padAfter:{op:"core/text-transform",description:mstrmojo.desc(13958,"Pad After")+" [string] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"record-based"},columnName:"[column name]",expression:'grel:if(isNull(value), "", value) + [string]',onError:"keep-original",repeat:false,repeatCount:10}},Whitespace:{trim:{op:"core/text-transform",description:mstrmojo.desc(12344,"Trim Leading And Trailing Whitespace")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.trim()",onError:"keep-original",repeat:false,repeatCount:10},collapse:{op:"core/text-transform",description:mstrmojo.desc(12345,"Collapse Consecutive Whitespace")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.replace(/\\s+/,' ')",onError:"keep-original",repeat:false,repeatCount:10}},Other:{duplicate:{op:"core/column-addition",description:mstrmojo.desc(14274,"Duplicate Column")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:value",onError:"set-to-blank"},Rename:{op:"core/column-rename",description:mstrmojo.desc(14275,"Rename Column [####] To {@@@@}"),oldColumnName:"[column name]",newColumnName:"[column name]"},ConcatenateColumns:{op:"core/column-addition",description:mstrmojo.desc(14276,"Concatenate Column [####] And Column [@@@@] To Column {@@@@}")+" (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:"[index]",baseColumnName:"[column name 1]",expression:'grel:if(isNull(cells["[column name 1]"]),"",cells["[column name 1]"].value) + "" + if(isNull(cells["[column name 2]"]), "", cells["[column name 2]"].value)',onError:"set-to-blank"},TransposeColumnsIntoRows:{op:"core/transpose-columns-into-rows",description:mstrmojo.desc(14278,"Transpose cells in #### column(s) starting with [@@@@] into rows in two new columns named [@@@@] and [@@@@]"),startColumnName:"[start column]",columnCount:7,ignoreBlankCells:true,fillDown:true,keyColumnName:"[new column 1]",valueColumnName:"[new column 2]"}},URL:{newColumnName:"[column name]",columnInsertIndex:"[index]",baseColumnName:"[column name]",urlExpression:"[ex]",onError:"set-to-blank",delay:5000},EditCell:{applyToAll:{op:"core/mass-edit",description:mstrmojo.desc(14279,"Edit Cell")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value",edits:[{fromBlank:false,fromError:false,from:["[from]"],to:"[to]",type:"text"}]},singleEdit:{op:"core/single-edit",description:mstrmojo.desc(14280,"Edit cell in row #### at cell #### value is: ####"),engineConfig:{facets:[],mode:"row-based"},row:0,col:0,to:"[to]"}}},suggestions:{partialCell:{split:[{description:mstrmojo.desc(12331,"Split By Fixed Length"),suggestion_type:1,suggestion_subtype:0,operations:[{}]},{description:mstrmojo.desc(14266,"Split Before ####"),suggestion_type:1,suggestion_subtype:3,operations:[{}]},{description:mstrmojo.desc(14267,"Split After ####"),suggestion_type:1,suggestion_subtype:2,operations:[{}]},{description:mstrmojo.desc(14260,"Split On ####"),suggestion_type:1,suggestion_subtype:1,operations:[{}]}],extract:[{description:mstrmojo.desc(14261,"Extract Before ####"),suggestion_type:1,suggestion_subtype:6,operations:[{}]},{description:mstrmojo.desc(14262,"Extract After ####"),suggestion_type:1,suggestion_subtype:5,operations:[{}]},{description:mstrmojo.desc(14247,"Extract On ####"),suggestion_type:1,suggestion_subtype:4,operations:[{}]}],cut:[{description:mstrmojo.desc(14515,"Remove Characters Before")+" ####",suggestion_type:1,suggestion_subtype:9,operations:[{}]},{description:mstrmojo.desc(14516,"Remove Characters After")+" ####",suggestion_type:1,suggestion_subtype:8,operations:[{}]},{description:mstrmojo.desc(14514,"Remove Characters")+" ####",suggestion_type:1,suggestion_subtype:7,operations:[{}]}],deleteRows:[{description:mstrmojo.desc(14244,"Delete Row(s) Where Cell Contains ####"),operations:[{}]},{description:mstrmojo.desc(null,"Delete Row Included In Selectors"),suggestion_type:2,operations:[{}]},{description:mstrmojo.desc(null,"Delete Row Not-included In Selectors"),suggestion_type:2,operations:[{}]}]},cell:[{}],row:[{}],column:[{description:mstrmojo.desc(12575,"Delete Column"),operations:[{}]},{description:mstrmojo.desc(12341,"Fill Down"),operations:[{}]},{description:mstrmojo.desc(12342,"Blank Down"),operations:[{}]},{description:mstrmojo.desc(14268,"To Title Case"),operations:[{}]},{description:mstrmojo.desc(14269,"To Uppercase"),operations:[{}]},{description:mstrmojo.desc(14270,"To Lowercase"),operations:[{}]},{description:mstrmojo.desc(14246,"Remove Row(s) Where Cell Is Empty")+" [[column name]]",operations:[{}]},{description:mstrmojo.desc(12345,"Collapse Consecutive Whitespace"),operations:[{}]},{description:mstrmojo.desc(14277,"Transpose Columns to Row from [####] to [@@@@]"),operations:[{}]}]},populateData:function G(H){this.set("data",H);},populateColumns:function A(H){this.set("columns",H);},populateHistory:function E(H){this.set("history",H);},populateOperations:function D(H){this.set("operations",H);},getCurrentOperations:function(){var J=F.clone(this.operations),I,H,L,K;for(K=0;K<J.entries.length;K++){L=J.entries[K];L.selected=true;}H=J&&J.entries;if(H&&H.length>0){I=H.length;L=H[I-1];if(!("op" in L.operation)||("estimatedRow" in L.operation)){H.pop();}}return J;},populateSampleStatus:function B(H){this.set("sampleStatus",H);},hasAddSample:function C(){var H=!!this.sampleStatus;if(H){if(this.sampleStatus.total<=1000||this.sampleStatus.current<=0){H=false;}}return H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumObjectTypes");var B=mstrmojo,C=B.hash,F=B.array,G=mstrmojo.warehouse.EnumObjectTypes;function D(K,L){var M=[];F.forEach(K,function(N){if(N.tp===L){M.push(N);}});return M.sort(function(O,N){return(O.n<N.n)?-1:(O.n>N.n)?1:0;});}mstrmojo.warehouse.obj.TableData=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.TableData",init:function I(N){var M=N.model,L=function(Q,P){return M.handleVisibleAction(Q,P);},K=function(Q,P){return M.handleCheckAction(Q,P);},O=function(Q,P){return M.handleEnabledAction(Q,P);};this.did=N.id;this.n=N.n;this.items=[];this.isVisible=L;this.isChecked=K;this.isEnabled=O;this.tp=N.tp;this.model=M;this.multi=N.multi;this.isLeaf=N.isLeaf;this.bold=N.bold;this.dbrole=N.dbrole;this.ns=N.ns||"";this.isError=N.isError;this.ttp=N.ttp||"";this.sta=N.sta||0;this.isLocked=N.isLocked;this.size=N.size;this.dbtn=N.dbtn||N.n;this.isView=N.isView;this.icntp=N.icntp;},model:undefined,multi:false,did:undefined,n:undefined,items:undefined,isVisible:undefined,isEnabled:undefined,isChecked:undefined,isLocked:false,size:0,isLeaf:false,bold:false,dbrole:undefined,tp:undefined,x:undefined,y:undefined,w:undefined,h:undefined,isError:false,ttp:"",sta:0,dbtn:undefined,ns:"",italics:false,addItem:function H(L,K,Q,R,T,N,P,O){var M=this,S={pdid:M.did,did:L,n:K,tp:Q,bfIdx:R,isVisible:M.isVisible,isChecked:M.isChecked,items:[],ttp:T,isLeaf:N,bold:P,unused:O};M.items.push(S);return S;},addSubItem:function J(Q,L,K,P,R,S,U,N,O){var M=this,T={pdid:M.did,did:L,sid:Q,n:K,tp:P,bfIdx:R,fcatId:S,isVisible:M.isVisible,isChecked:M.isChecked,ttp:U,isLeaf:N,bold:O};C.forEach(M.items,function(V){if(V.did===Q){V.items.push(T);return false;}return true;});return T;},addSubItemItem:function A(P,R,L,K,Q,S,T,V,N,O){var M=this,U={pdid:M.did,did:L,sid:P,n:K,tp:Q,bfIdx:S,fcatId:T,isVisible:M.isVisible,isChecked:M.isChecked,ttp:V,isLeaf:N,bold:O};C.forEach(M.items,function(W){if(W.did===P){C.forEach(W.items,function(X){if(X.did===R){X.items=X.items||[];X.items.push(U);return false;}return true;});return false;}return true;});return U;},sortElements:function E(){var M=this,K=M.items,L=[];M.items=L.concat(D(K,G.ATTRIBUTE),D(K,G.FACT),D(K,G.COLUMN));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.dbroles.DBRoleHelper");mstrmojo.requiresDescs(4572,11138,3651);var H=mstrmojo.array,G=mstrmojo.warehouse.dbroles.DBRoleHelper,C="PWDHIDDEN123!@#",A=mstrmojo.desc(4572,"Primary"),D=mstrmojo.warehouse.EnumObjectTypes.DBROLE;mstrmojo.warehouse.obj.DBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.obj.DBRole",init:function K(O){var M=this,L=(O&&O.mdDBRole);if(L){M.mdDBRole=L;M.n=L.n.toString();M.did=L.did;M.des=(!(L.des&&mstrApp.rootController.isCloud())?L.n:L.des||"").toString();M.data=new mstrmojo.warehouse.obj.TableData({id:L.did,n:L.n,tp:L.stp,model:O.mdl});}else{M.mdDBRole={n:G.getUniqueName(mstrmojo.desc(11138,"new data source #").replace("#","")),did:"",tp:29,stp:7424,writable:"1",vldbProperties:{}};M.n=M.mdDBRole.n;M.did=M.mdDBRole.did;M.data=new mstrmojo.warehouse.obj.TableData({id:M.mdDBRole.did,n:M.mdDBRole.n,tp:M.mdDBRole.stp,model:O.mdl});var N=mstrApp.rootController.getDBObjects().preferences;if(N&&N.vldbProperties){H.forEach(N.vldbProperties,function(P){M.mdDBRole.vldbProperties[P.propset]={};});}M.populated=true;}M.data.isPrimary=M.isPrimary();},dbmsCatalogCacheMode:undefined,mdDBRole:{},n:"",did:"",tp:D,supportsNameSpaces:false,avoidColumnCaching:false,displayName:function J(){return this.n+(this.isPrimary()?" ("+A+")":"");},isPrimary:function I(){return(this.did===mstrApp.getRootController().getProjectPrimaryDBRoleID());},data:undefined,populated:false,populate:function F(M){var L=this;if(this.populated){M(L);}else{mstrApp.getRootController().populateDBRole(this.mdDBRole.did,{success:function(O){L.populated=true;L.mdDBRole=O.dbrs[0];if(typeof L.mdDBRole.vldbProperties==="string"){L.mdDBRole.vldbProperties=JSON.parse(L.mdDBRole.vldbProperties);}L.n=L.mdDBRole.n.toString();L.did=L.mdDBRole.did;var N=parseInt(L.mdDBRole.dbmsCatalogCacheMode,10);L.supportsNameSpaces=((N&1)===1);L.avoidColumnCaching=((N&2)===2||(N&4)===4);M(L);}});}},rename:function B(L){var M=mstrApp.rootController;this.mdDBRole.n=L;if(M.isCloud()){this.des=L;this.n=this.des+"___"+new Date().getTime();}else{this.n=L;}if(this.did!==""){this.mdDBRole.connstr=G.cleanDSNConnection(this.mdDBRole.connstr);M.saveDBRole(this,false,{success:function(){}});}},duplicate:function E(){var M=mstrApp.rootController,O=new mstrmojo.warehouse.obj.DBRole({mdDBRole:this.mdDBRole,mdl:this.data.model}),N=mstrApp.isSingleTier?"copy of ##":mstrmojo.desc(3651,"copy of ##"),L=G.getUniqueName(N.replace("##",M.isCloud()?this.des:this.n));O.did="";O.mdDBRole.did="";O.rename(L);O.mdDBRole.connstr=G.cleanDSNConnection(O.mdDBRole.connstr);O.mdDBRole.originalID=this.did;if(O.mdDBRole.password===C){delete O.mdDBRole.password;}M.saveDBRole(O,true,{success:function(){}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport");var BasicAggMap={"8107C31BDD9911D3B98100C04F2233EA":"Sum","548C68A0F60811D3ACC300C04F0423DE":"StdevP","8107C31FDD9911D3B98100C04F2233EA":"Max","8107C331DD9911D3B98100C04F2233EA":"GeoMean",B2C0FA4220C711D6AD1400C04F0423DE:"First","8107C32CDD9911D3B98100C04F2233EA":"Product",B2C0FA4020C711D6AD1400C04F0423DE:"Greatest","8107C330DD9911D3B98100C04F2233EA":"Var","8107C32FDD9911D3B98100C04F2233EA":"Stdev","8107C32DDD9911D3B98100C04F2233EA":"Median",B2C0FA4320C711D6AD1400C04F0423DE:"Last","8107C31CDD9911D3B98100C04F2233EA":"Count","8107C31DDD9911D3B98100C04F2233EA":"Avg","8107C31EDD9911D3B98100C04F2233EA":"Min","8107C32EDD9911D3B98100C04F2233EA":"Mode",D64F1B10F6C011D3ACC300C04F0423DE:"VarP",B2C0FA4120C711D6AD1400C04F0423DE:"Least"},RankMap={"8107C326DD9911D3B98100C04F2233EA":"Rank"},OLAPAggMap={D221F90EB35540E3A1204ED6CC9A8267:"Avg",D221F90FB35540E3A1204ED6CC9A8267:"Count",D221F910B35540E3A1204ED6CC9A8267:"Max",D221F911B35540E3A1204ED6CC9A8267:"Min",D221F90DB35540E3A1204ED6CC9A8267:"Sum"},MovingAggMap={"8107C32ADD9911D3B98100C04F2233EA":"Avg","8107C350DD9911D3B98100C04F2233EA":"Count","8107C34BDD9911D3B98100C04F2233EA":"Max","8107C34CDD9911D3B98100C04F2233EA":"Min","8107C32BDD9911D3B98100C04F2233EA":"Sum"},RunningAggMap={"8107C329DD9911D3B98100C04F2233EA":"Avg","8107C354DD9911D3B98100C04F2233EA":"Count","8107C351DD9911D3B98100C04F2233EA":"Max","8107C352DD9911D3B98100C04F2233EA":"Min","8107C328DD9911D3B98100C04F2233EA":"Sum"},BandingMap={"8107C337DD9911D3B98100C04F2233EA":"Banding","8107C338DD9911D3B98100C04F2233EA":"BandingC","8107C339DD9911D3B98100C04F2233EA":"BandingP"};function _sortFunctions(fcts){var fs=function(a,b){return mstrmojo.array.stringSorter(a.n,b.n);},i,len;fcts=fcts.sort(fs);for(i=0,len=fcts.length;i<len;i++){fcts[i].fns=fcts[i].fns.sort(fs);}return fcts;}function getFuncCatIndex(fcts,funcDid){var len=fcts.length,ci;for(ci=0;ci<len;ci++){var fns=fcts[ci].fns;if(mstrmojo.array.find(fns,"did",funcDid)>-1){return ci;}}return -1;}function buildTaskParams(params){var qse=mstrApp&&mstrApp.useQuickSearch&&mstrApp.useQuickSearch();params=mstrmojo.hash.copy(params,{taskId:"searchMetadata",recursive:true,styleName:"MojoFolderStyle",includeObjectDesc:true,includeAncestorInfo:false});if(qse){params.quickSearch=qse;params.nameWildcards=16;params.sortKey=-1;}return params;}function serverRequest(callback,taskParams){if(mstrApp.serverRequest){mstrApp.serverRequest(taskParams,callback);}else{window.$MAPF=function(){return false;};this.getServerProxy().request(callback,taskParams,false,{});}}mstrmojo.ME.MetricDataService=mstrmojo.provide("mstrmojo.ME.MetricDataService",{rootFolderTypes:{ALL:39,FILTERS:4,METRICS:5,FACTS:29,SCHEMA:24,ATTRIBUTES:26,TRANSFORMATIONS:38},blockCount:10,suggestCount:10,suggestDelay:200,noCache:true,functions:null,metricComponents:null,functionsDetails:null,getServerProxy:function getServerProxy(){if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}return this.serverProxy;},getMetricDefintion:function getMetricDefintion(params,callbacks){var taskParams={taskId:"getMetricDefinition",metricId:params.id,outputFlags:65599};if(params.msgID){taskParams.msgID=params.msgID;}serverRequest.call(this,callbacks,taskParams);},validateMetric:function validateMetric(params,callbacks){var taskParams={taskId:"validateMetric",metricId:params.metricId,tokenStreamXML:params.tokenStreamXML,metricXML:params.metricXML,outputFlags:327695};if(mstrmojo.string.isEmpty(params.metricId)){taskParams.isNew=true;}if(params.msgID){taskParams.msgID=params.msgID;}if(params.formID){taskParams.frmid=params.formID;}if(params.isIDForm){taskParams.isIDForm=params.isIDForm;}if(params.objectType){taskParams.objectType=params.objectType;}serverRequest.call(this,callbacks,taskParams);},getMetricComponents:function getMetricComponents(params,callbacks){var me=this,mc=this.metricComponents;if(!this.noCache&&mc&&mc.items.length==mc.sz){callbacks.success(mc);return ;}callbacks.success=mstrmojo.func.composite([callbacks.success,function(res){if(me.metricComponents&&me.metricComponents.items){me.metricComponents.items.push(res.items);}else{me.metricComponents=res;}}]);var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||24,objectType:params.objectType||"12,13,43"});serverRequest.call(this,callbacks,taskParams);},getAttributes:function getAttributes(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||26,objectType:12});serverRequest.call(this,callbacks,taskParams);},getFacts:function getFacts(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||29,objectType:13});serverRequest.call(this,callbacks,taskParams);},getMetrics:function getMetrics(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||5,objectType:4});if(params.isVerify){taskParams.nameWildcards=2;}serverRequest.call(this,callbacks,taskParams);},getFunctions:function getFunctions(callbacks){var me=this,wss=window.sessionStorage,fcts=this.functions||(wss&&wss.getItem("functions")),localeId=wss&&wss.getItem("mstrLocaleId"),cLocaleId=mstrApp&&mstrApp.localeId;if(fcts&&localeId==cLocaleId){fcts=_sortFunctions(eval("("+fcts+")").fncs);callbacks.success(fcts);}else{var cb={failure:callbacks.failure,textResponse:true},taskParams={taskId:"getSystemFunctions",includeFunctionDetails:true,functionFlags:2|2147483648,includeFunctionHelpTopic:true};cb.success=function(res){if(typeof res==="string"||!mstrApp.isSingleTier){if(wss){wss.setItem("functions",res);wss.setItem("mstrLocaleId",cLocaleId);}me.functions=res;fcts=_sortFunctions(eval("("+res+")").fncs);}else{fcts=_sortFunctions(res.fncs);me.functions=JSON.stringify(res);}callbacks.success(fcts);};serverRequest.call(this,cb,taskParams);}},getAggFunctions:function getAggFunctions(){if(this._aggFunctions){return this._aggFunctions;}var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.array.filter(fcts[this.getBasicCategoryIndex(fcts)].fns,function(item){var did=item.did,retVal;if(did!=="B2C0FA4020C711D6AD1400C04F0423DE"&&did!=="B2C0FA4120C711D6AD1400C04F0423DE"){retVal=BasicAggMap[did];}return retVal;});return fcts;},getOLAPAggFunctions:function getOLAPAggFunctions(type){var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.array.filter(fcts[this.getOLAPCategoryIndex(fcts)].fns,function(item){switch(type){case"moving":return MovingAggMap[item.did];case"running":return RunningAggMap[item.did];case"olap":default:return OLAPAggMap[item.did];}return false;});return fcts;},getFunctionCatList:function getFunctionCatList(){if(this._functionCatList){return this._functionCatList;}var fcts=this.functions||(window.sessionStorage&&window.sessionStorage.getItem("functions"));if(!fcts){mstrmojo.alert("We shall not reach this point!");}fcts=_sortFunctions(eval("("+fcts+")").fncs);fcts=mstrmojo.hash.make(fcts,mstrmojo.Arr);this._functionCatList=fcts;return fcts;},getCategoryIndex:function getCategoryIndex(funcDid,fcts){return getFuncCatIndex(fcts||this.getFunctionCatList(),funcDid);},getBasicCategoryIndex:function getBasicCategoryIndex(fcts){var Agg_Func_Greatest="B2C0FA4020C711D6AD1400C04F0423DE";return getFuncCatIndex(fcts||this.getFunctionCatList(),Agg_Func_Greatest);},getDataMiningCatIndex:function getDataMiningCatIndex(fcts){var DataMining_Func_MiningModel="F17CD4F3FF134D91B80DDAB9CA73C919";return getFuncCatIndex(fcts||this.getFunctionCatList(),DataMining_Func_MiningModel);},getDateTimeCategoryIndex:function getDateTimeCategoryIndex(fcts){var DateTime_Func_Date="C50F2A4F75AE49D6B20E00224967B500";return getFuncCatIndex(fcts||this.getFunctionCatList(),DateTime_Func_Date);},getStringCategoryIndex:function getStringCategoryIndex(fcts){var String_Func_Concat="6F7DF5FF449111D5BEA300B0D01A55EF";return getFuncCatIndex(fcts||this.getFunctionCatList(),String_Func_Concat);},getOLAPCategoryIndex:function getBasicCategoryIndex(fcts){var OLAP_Func_Avg="D221F90EB35540E3A1204ED6CC9A8267";return getFuncCatIndex(fcts||this.getFunctionCatList(),OLAP_Func_Avg);},getInternalCategoryIndex:function getInternalCategoryIndex(fcts){var INTER_Func_Band="8107C337DD9911D3B98100C04F2233EA";return getFuncCatIndex(fcts||this.getFunctionCatList(),INTER_Func_Band);},getFunctionDetails:function getFunctionDetails(params,callbacks){var taskParams={taskId:"getSystemFunctions",functionId:params.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};serverRequest.call(this,callbacks,taskParams);},getTransformations:function getTransformations(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||38,objectType:43});serverRequest.call(this,callbacks,taskParams);},getFilters:function getFilters(params,callbacks){var taskParams=buildTaskParams({blockBegin:params.blockBegin,blockCount:params.blockCount,searchPattern:params.pattern,rootFolderType:params.rootFolderType||4,objectType:1});serverRequest.call(this,callbacks,taskParams);},getAttributeForms:function getAttributeForms(params,callbacks){var taskParams={taskId:"getAttributeForms",attributeID:params.attributeID,displayedForms:params.displayedForms,styleName:"WidgetElementListStyle"};serverRequest.call(this,callbacks,taskParams);},getSubtotalFunctions:function getSubTotalFunctions(params,callbacks){var taskParams=buildTaskParams({objectType:"1025,1026",searchPattern:""});serverRequest.call(this,callbacks,taskParams);},isBasicAggMap:function isBasicAggMap(did){var retVal=!!BasicAggMap[did];if(did==="B2C0FA4020C711D6AD1400C04F0423DE"||did==="B2C0FA4120C711D6AD1400C04F0423DE"){retVal=false;}return retVal;},isOLAPAgg:function isOLAPAgg(did){return !!OLAPAggMap[did];},isMovingAgg:function isMovingAgg(did){return !!MovingAggMap[did];},isRunningAgg:function isRunningAgg(did){return !!RunningAggMap[did];},isBanding:function isBanding(did){return !!BandingMap[did];},isOLAP:function isOLAP(did){var fcts=this.getFunctionCatList(),olapFns=fcts[this.getOLAPCategoryIndex(fcts)].fns;return mstrmojo.array.find(olapFns,"did",did)>-1;},isRank:function isRank(did){return !!RankMap[did];},isScalar:function isScalar(fctOi){return(fctOi||{}).sqt===3;},getFunctionHelpTopic:function getFunctionHelpTopic(h){return'<a href="'+((mstrApp.helpUrl||"../help/")+"FunctionsRef/index.html?context=functionsref&topic="+(h||""))+'" target="_new">'+mstrmojo.desc(5811,"Details ...")+"</a>";},sortFunctions:function sortFunctions(functions){var allfuncs={},fs=function(a,b){return mstrmojo.array.stringSorter(a.n,b.n);};mstrmojo.array.forEach(functions,function(funcs){mstrmojo.array.forEach(funcs&&funcs.fns,function(func){if(func&&func.did){allfuncs[func.did]=func;}});});return mstrmojo.hash.valarray(allfuncs).sort(fs);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(12604,12605,12607,12608,12893,12894,12895,12896,13302,13994);var V=mstrmojo.DI.DIConstants,Q=mstrmojo.DI.DIHelpers,C=mstrmojo.dom,O=mstrmojo.hash;function P(Y){var X="oAuthSourcelogout";var W=document.getElementById(X);if(!W){W=document.createElement("IFRAME");W.id=X;document.body.appendChild(W);W.style.display="none";}W.src=Y;}function U(){var a={};var Y=window.screenX||window.screenLeft||0,X=window.screenY||window.screenTop||0,Z=800,W=600,b;if(document.body&&document.body.offsetWidth){Z=document.body.offsetWidth;W=document.body.offsetHeight;}if(document.compatMode==="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){Z=document.documentElement.offsetWidth;W=document.documentElement.offsetHeight;}if(window.innerWidth&&window.innerHeight){Z=window.innerWidth;W=window.innerHeight;}if(window.outerWidth){Z=window.outerWidth;}if(window.outerHeight){W=window.outerHeight;}a.height=W*0.5;a.width=Z*0.8;if(a.height<600||isNaN(a.height)){a.height=600;}if(a.width<800||isNaN(a.width)){a.width=800;}a.left=Y+(Z-a.width)/2;a.top=X+(W-a.height)/8;b="width="+a.width+",height="+a.height;b+=",toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0";b+=",left="+a.left+",top="+a.top;return b;}function B(W){var X,Y;Y=U();if(!W){W="";}X=window.open(W,"Authorization",Y);return{wnd:X};}function M(Y,W){var X;if(Y&&!Y.closed){Y.location=W;Y.focus();}else{X=B(W);Y=X.wnd;if(Y){Y.focus();}}return Y;}function D(X){var Z=window.opener,W;if(Z){W=window.location.origin;if(!W){W=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");}try{if(Q.isIE()&&Z.postMessagePassthrough){Z.postMessagePassthrough(X,W);try{window.open("","_self","");window.close();}catch(a){window.close();}}else{W=window.location.origin;Z.postMessage(X,W);}}catch(Y){console.log("postMessage error: "+Y);}}}mstrmojo.DI.controller.DIOAuthController=mstrmojo.declare(mstrmojo.Obj,null,{popupWnd:null,responseHandler:null,beforeOAuth:function(){var W;if(!this.popupWnd||this.popupWnd.closed){W=B();this.popupWnd=W.wnd;}return !!this.popupWnd;},afterOAuth:function(){var W=this;window.setTimeout(function(){if(W.popupWnd&&!W.popupWnd.closed){W.popupWnd.close();}W.popupWnd=null;},0);},getExternalSourcesInfo:function H(){var W=mstrApp.getRootController(),Z=W.getModel(),Y=window.location.href.toLowerCase(),X=Q.getURLParameters(Y);if(window.opener&&(Y.indexOf("code=")>=0||Y.indexOf("oauth_token")>=0||Y.indexOf("accesstoken")>=0||Y.indexOf("denied=")>=0||Y.indexOf("access_denied")>=0||(X.state&&X.state.toUpperCase()==="OC"))){Z.set("operationMode",V.operationMode.oauth);D(window.location.href);}else{Z.populateExternalSources();W.restoreForLaunchingApp();}},oAuthSignOut:function L(b){var Y=mstrApp.getRootController(),f=Y.model.externalSources[b],X={},d,c,a,W,Z=parseInt(b,10);var e={success:function(){var g;f.reset();if(Z===V.sourceType.facebook){g=U();window.open("https://www.facebook.com","",g);return ;}c=Y.navigationController.getPageSlot();if(a){c.setConfig(a);}Y.getOAuthSourceReports(b,false,c);}};if(!f){Y.displayError(mstrmojo.desc(12608,"Could not log out. Please do so by manually going to the website"),false);}if(Q.isIE7()&&Z===V.sourceType.salesforce){window.location.href="https://embedexpress-dev-ed.my.salesforce.com/secur/logout.jsp";}else{switch(Z){case V.sourceType.dropbox:P("https://www.dropbox.com/logout");break;case V.sourceType.googleDrive:P("https://www.google.com/accounts/logout");break;case V.sourceType.googleAnalytics:P("https://www.google.com/accounts/logout");break;case V.sourceType.salesforce:W="https://embedexpress-dev-ed.my.salesforce.com/secur/logout.jsp";if(f.instanceUrl){W=f.instanceUrl+"/secur/logout.jsp";}P(W);break;case V.sourceType.twitter:P("https://twitter.com/logout");break;}if(Y.rootView.currentPage){d=Y.navigationController.getPageSlot(Y.rootView.currentPage.pageSlotKey);a=d.getConfig();}if(Y.rootView.currentPage&&Y.rootView.currentPage.tableID){Y.showPage(V.pageType.emmaPreview);}else{Y.showPage(V.pageType.dataSelection);}}X.dbRoleID=f.dbRoleID;if(f.sourceAccountID){X.sourceAccountID=f.sourceAccountID;}Y.dataService.signOutOAuthSource(e,X);},oneTierOAuth:function A(X,W,Y){this.sourceType=X;this.slot=Y;this.getWebServiceURL(X,W,Y);},getWebServiceURL:function J(b,W,c){var f=V.sourceType;var Z=mstrApp.getRootController();var a=this;var g=mstrApp.getRootController().model.externalSources[b];var d=function Y(h){var k,j,l=mstrmojo.desc(13302,"This app is blocked by admin in Salesforce.");if(mstrApp.originUrl.indexOf(h.origin)>=0){a.afterOAuth();C.detachEvent(window,"message",a.responseHandler);a.responseHandler=null;if(b===V.sourceType.salesforce){k=h&&h.data;j=Q.getURLParameters(k);if(j.error&&j.error==="OAUTH_APP_BLOCKED"){mstrApp.getRootController().displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,l);return ;}}a.getWebServiceCatalog(b,h.data,c);}};var e={success:function(l){var p;if(l.url){p=l.url;}else{p=l;}if(!p||p.length===0){C.detachEvent(window,"message",a.responseHandler);a.responseHandler=null;Z.displayError(mstrmojo.desc(12893,"Oops Unable to get the authorization URL for the given webservice. Please contact your administrator"));return ;}if(W&&(b===f.googleDrive||b===f.googleAnalytics||b===f.googleBigQuery)){if(p.indexOf("approval_prompt=force")<0){p+="&approval_prompt=force";}}if(mstrApp.isCloud){var n=window.location,q=n.protocol,k=n.hostname,h=n.port,o=n.pathname.split("/");var j=o&&o.length!==0&&o[1],m="ptc_"+q+"shrd_"+k+":port_"+h+":app_"+j;p+=("&state="+m);}if(mstrmojo.getCSRFToken()){p+=("&state=validateRandNum"+mstrmojo.getCSRFToken());}a.popupWnd=M(a.popupWnd,p);if(!a.popupWnd){C.detachEvent(window,"message",a.responseHandler);a.responseHandler=null;Z.displayError(mstrmojo.desc(12894,"Your browser has blocked the popup for this site. Please enable the popup for this site in order to continue and sign in."),false);return ;}},failure:function(h){C.detachEvent(window,"message",a.responseHandler);this.responseHandler=null;a.afterOAuth();Z.displayError(mstrmojo.desc(12893,"Oops Unable to get the authorization URL for the given webservice. Please contact your administrator"),false,h.message);Z.showPage(V.pageType.dataSelection);}};if(Q.isIE()){window.postMessagePassthrough=function(j,h){d({origin:h,data:j});};}if(a.responseHandler){C.detachEvent(window,"message",a.responseHandler);}C.attachEvent(window,"message",d);this.responseHandler=d;var X={dbRoleID:g.dbRoleID,scope:g.scope,flags:4};Z.dataService.getWebServiceURL(e,X);},oneTierOAuthHandler:function S(W){this.afterOAuth();if(W.search("access_denied")<0&&W.search("denied")<0){this.getWebServiceCatalog(this.sourceType,W,this.slot);}},getWebServiceCatalogCallback:function T(e,f){var b=mstrApp.getRootController();var g=this;var h=b.model.externalSources[e],W=e,a=b.model,d,Z,Y,X,c;return{success:function(j){if(!h.sourceAccountID&&j.mi.sinf.said){h.sourceAccountID=j.mi.sinf.said;}if(a.operationMode===V.operationMode.subscribe){b.readyForSubscription();}else{if(a.operationMode===V.operationMode.enterCredentials){b.model.updateDocumentCredentials(g.tableIDs,true);}else{var k=a.externalSources;switch(W){case V.sourceType.twitter:h.populateReports(j);b.showPage(V.pageType.twitter,k[W],f);break;case V.sourceType.facebook:h.populateReports(j);b.showPage(V.pageType.facebook,k[W],f);break;case V.sourceType.dropbox:case V.sourceType.googleDrive:case V.sourceType.salesforce:case V.sourceType.googleAnalytics:b.showPage(V.pageType.sourceObjectsDnD,k[W],f);h.populateReports(j);break;case V.sourceType.googleBigQuery:Z=f&&f.getConfig&&f.getConfig();d=Z&&Z.properties&&Z.properties.tableID;Y=d&&a.getImportSource(d);X=(Y&&Y.xdaType)||mstrApp.bigQueryXdatype;h.populateReports(j);window.setTimeout(function(){mstrApp.getRootController().showPage(V.pageType.database,{sourceType:V.sourceType.googleBigQuery,type:X},f);c=b.rootView.parent;if(c&&c.editorNode){C.center(c.editorNode);}},1);break;}}}},failure:function(j){var k=parseInt(j.code||j.getResponseHeader("X-MSTR-TaskErrorCode"),10);b.closePageDialog();if(a.operationMode===V.operationMode.enterCredentials){b.model.updateDocumentCredentials(this.tableIDs,false);}if(k===V.backendError.refreshTokenUnavailable){b.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,j.message);}else{if(k===V.backendError.noExternalSession){b.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,j.message);}else{if(k===V.backendError.noExternalSourceInfo&&W===V.sourceType.googleAnalytics){b.displayError(mstrmojo.desc(12895,"Could not find a Google Analytics account for your account. Please sign in with a different account."),false);b.oAuthSignOut(W);}else{b.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,j.message);if(a.operationMode!==V.operationMode.enterCredentials){b.showPage(V.pageType.dataSelection);}}}}}};},getWebServiceCatalog:function F(Y,Z,b){var W=mstrApp.getRootController();var X=W.model.externalSources[Y],a={dbRoleID:X.dbRoleID,code:Z};a.flags=V.sourcesInfoFlags.getReports|V.sourcesInfoFlags.getUserName;if(Y===V.sourceType.googleAnalytics){a.flags=a.flags|V.sourcesInfoFlags.getGAnalyticsAccount;}if(Y===V.sourceType.googleBigQuery){a.flags=V.sourcesInfoFlags.getGAnalyticsAccount|V.sourcesInfoFlags.getUserName;}if(Y===V.sourceType.salesforce){a.flags|=V.sourcesInfoFlags.getTokensInfo;}if(this.tableIDs){a.tableIDs=this.tableIDs;}W.dataService.getWebServiceCatalog(this.getWebServiceCatalogCallback(Y,b),a);},getAnalyticsWebProperties:function K(Z){var W=mstrApp.getRootController();var X=W.model.externalSources[V.sourceType.googleAnalytics];var Y=X.getSourceParams();Y.gaAccountID=Z;Y.gaWebPropertyID="";Y.flags=V.sourcesInfoFlags.getGAnalyticsAccount;if(X.checkWebProperties(Z,true)){W.getAnalyticsProfiles(Z,X.getAccountById(Z).webProperties[0].id);return ;}var a={success:function(b){X.onGetAnalyticsWebProperties[Z]=false;X.populateWebProperties(b,Z);W.getAnalyticsProfiles(Z,X.getAccountById(Z).webProperties[0].id);},failure:function(){W.displayError(mstrmojo.desc(12604,"Unable to fetch Analytics web properties."),false);}};if(!X.onGetAnalyticsWebProperties[Z]){X.onGetAnalyticsWebProperties[Z]=true;W.dataService.getOAuthSourceReports(a,Y);}},getAnalyticsProfiles:function R(a,Y){var W=mstrApp.getRootController();var X=W.model.externalSources[V.sourceType.googleAnalytics];var Z=X.getSourceParams();Z.gaAccountID=a;Z.gaWebPropertyID=Y;Z.flags=V.sourcesInfoFlags.getGAnalyticsAccount;if(X.checkProfiles(a,Y,true)){return ;}var b={success:function(c){X.onGetAnalyticsProfiles[a+":"+Y]=false;X.populateProfiles(c,a,Y);},failure:function(){W.displayError(mstrmojo.desc(12605,"Unable to fetch Analytics profiles."),false);}};if(!X.onGetAnalyticsProfiles[a+":"+Y]){X.onGetAnalyticsProfiles[a+":"+Y]=true;W.dataService.getOAuthSourceReports(b,Z);}},getOAuthSourceReports:function E(k,h,l,j,a){var e=mstrApp.getRootController();var n=e.model.externalSources[k],c={},X=k,d=e.model,g,b,W,Z,Y,f;if(!n){return ;}if(h){c=n.getSourceParams();if(k===V.sourceType.googleAnalytics){c.gaAccountID="";c.gaWebPropertyID="";c.flags=V.sourcesInfoFlags.getGAnalyticsAccount|V.sourcesInfoFlags.getReports|V.sourcesInfoFlags.getTokensInfo|V.sourcesInfoFlags.getUserName;}}else{c.dbRoleID=n.dbRoleID;if(n.sourceAccountID){c.sourceAccountID=n.sourceAccountID;}}if(k===V.sourceType.googleAnalytics){c.flags=V.sourcesInfoFlags.getGAnalyticsAccount|V.sourcesInfoFlags.getReports|V.sourcesInfoFlags.getTokensInfo|V.sourcesInfoFlags.getUserName;}if(k===V.sourceType.googleBigQuery){c.flags=V.sourcesInfoFlags.getGAnalyticsAccount|V.sourcesInfoFlags.getTokensInfo|V.sourcesInfoFlags.getUserName;}if(k===V.sourceType.facebook){if(j){c.fbPageSearchQuery=j;}}b=l&&l.getConfig&&l.getConfig();W=b&&b.footerConfig;var m=a||{success:function(o){if(!n.sourceAccountID&&o.mi.sinf.said){n.sourceAccountID=o.mi.sinf.said;}if(d.operationMode===V.operationMode.subscribe){e.readyForSubscription();}else{var p=d.externalSources;switch(X){case V.sourceType.twitter:n.populateReports(o);e.showPage(V.pageType.twitter,p[X],l,W);break;case V.sourceType.facebook:n.populateReports(o);e.showPage(V.pageType.facebook,p[X],l,W);break;case V.sourceType.dropbox:case V.sourceType.googleDrive:case V.sourceType.salesforce:case V.sourceType.googleAnalytics:e.showPage(V.pageType.sourceObjectsDnD,p[X],l,W);n.populateReports(o);break;case V.sourceType.googleBigQuery:g=b&&b.properties&&b.properties.tableID;Z=g&&d.getImportSource(g);Y=(Z&&Z.xdaType)||mstrApp.bigQueryXdatype;n.populateReports(o);window.setTimeout(function(){e.showPage(V.pageType.database,{sourceType:V.sourceType.googleBigQuery,type:Y},l,W);f=e.rootView.parent;if(f&&f.editorNode){C.center(f.editorNode);}},1);break;}}},failure:function(o){var p=parseInt(o.code||(o.getResponseHeader&&o.res.getResponseHeader("X-MSTR-TaskErrorCode")),10);if(p===V.backendError.refreshTokenUnavailable){e.gotoOAuthLogin(X,true,l);}else{if(p===V.backendError.noExternalSession&&(!h)){e.gotoOAuthLogin(X,false,l);}else{if(p===V.backendError.noExternalSourceInfo&&X===V.sourceType.googleAnalytics){e.displayError(mstrmojo.desc(12896,"Could not find a Google Analytics account for ####. Please sign in with a different account.").replace("####",n.userDisplayName),false);e.oAuthSignOut(X);}else{e.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,o&&o.message);e.showPage(V.pageType.dataSelection);}}}}};e.dataService.getOAuthSourceReports(m,c);},getOAuthSourceFolderContents:function I(Y,Z,b){var W=mstrApp.getRootController();var X=W.model.externalSources[Y];var a=X.getSourceParams();W.dataService.getOAuthSourceReports(b,O.copy(Z,a));},oAuthSourceBrowserFunction:function(Y,Z,a,X){var W=mstrApp.getRootController();var b={success:function(k){var j=W.parseOAuthSourceFolder(Y,k);Z.data.browser.set("fileList",j);if(a){var l=Z.items,f;var c=l,h=l;var g=a.indexOf("/",1);if(g!==-1){var d=a.substring(1,g);for(f=0;f<c.length;f++){if(c[f].isFolder===true&&c[f].n===d){Z.data.browser.autoSelectNode(c[f].node,a.substring(g),X);c[f].fetched=true;c[f].node.set("state",1);}}}else{var e=a.substring(1);for(f=0;f<h.length;f++){if(h[f].isFolder!==true&&h[f].n===e){if(X){if(X===h[f].address){h[f].node.data.browser.autoSelectNode(h[f].node);}}else{h[f].node.data.browser.autoSelectNode(h[f].node);}}}}}},failure:function(c){if(Z&&Z.data){Z.set("state",0);Z.data.set("fetched",false);}W.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,c&&c.message);}};this.getOAuthSourceFolderContents(Y,{folderName:Z.data.address},b);},oAuthSourceFetchFunction:function N(X,Y){var W=mstrApp.getRootController();var Z={success:function(b){var a=mstrApp.getRootController().getModel().externalSources[X];a.populateReports(b);},failure:function(a){W.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,a&&a.message);}};this.getOAuthSourceFolderContents(X,Y,Z);},parseOAuthSourceFolder:function G(Y,X){var W=mstrApp.getRootController().getModel().externalSources[Y];return W.parseOAuthSourceFolder(X);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.string");mstrmojo.requiresDescs(10,489,1279,1910,3687,7755,10171,10174,12448,12450,12539,12541,13978,14217,14218,14219,14220,14221,14222,14223,14224,14225,14226,14227,14228,14229);var X=mstrmojo.DI.DIConstants,J=mstrmojo.array,N=mstrmojo.hash,Q=mstrmojo.DI.DIHelpers,A=4000;var L={NT:1,RT:2,PT:3};var M={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2};var W={1:X.columnDataTypes.integer,2:X.columnDataTypes.integer,3:X.columnDataTypes.dtdouble,6:X.columnDataTypes.dtdouble,7:X.columnDataTypes.dtfloat,21:X.columnDataTypes.integer,22:X.columnDataTypes.nlong,30:X.columnDataTypes.bigDecimal,34:X.columnDataTypes.int64};function T(a,b){var Z=false;if(b==="amps"||b==="mtmps"){Z=(a&X.columnState.missing)!==X.columnState.missing;return Z;}if(b==="cmps"){Z=false;return Z;}return Z;}function I(p,l,e,k,d,n,q){var Z=X.columnState.newColumn,g=p.aimp,h=l.def?l.def.dicl.ups:l.sqc.ups,a=T(h,e),c,m,o=null,b,x,f,w,j,t;if(l.sqc){f=l.cln;x=l.sqc;m=x.als;j=M[x.dt.tp];t=W[x.dt.tp];w=x.ix+1;}else{f=l.def.cln;m=l.n;j=q?q.bft:M[l.def.dt.tp];x=l.def.dicl;w=x.clix;t=W[l.def.dt.tp];}var u=h===Z;c={did:l.did||l.sqc.id,n:mstrmojo.string.decodeHtmlString(f),originalAlias:mstrmojo.string.decodeHtmlString(m),alias:mstrmojo.string.decodeHtmlString(m),isNew:u,columnState:h,selected:a,dtp:j,ctp:t,ix:w,tp:a?x.idot:0,idot:x.idot,toDel:(h===X.columnState.missing),der:x.der,hasMapped:true,isDI:true,type:e};switch(e){case"amps":m=g.atnm;o=g.atid;b=g.ipa;if(b){c.ipa=b;}if(m&&!n){c.alias=m;}c.isMultiForm=n;break;case"mtmps":o=p.mtid;m=p.mtn;if(m){c.alias=m;}break;case"cmps":break;}if(o){c.id=o;}if(k){c.tableId=k;}if(d){c.tableName=d;}if(q){c.afid=g.atid+q.fmid;c.fmn=q.fmn;c.fmid=q.fmid;c.oid=g.atid;c.shapeKey=q.sha;c.timerole=q.tim;}return c;}function D(k,c,l,d,e){var b,o,h,a,Z=d.datap.tbid||e,n=d.datap.tbn,f,m,j,g;J.forEach(k,function(p){m=p.aimp;j=p.afmps;switch(l){case"amps":h=j.length;f=h>1;J.forEach(j,function(q,t){g=0;o=q.sqc?q:q.col.oi;a=I(p,o,l,Z,n,f,q);a.georole=q.geo;if(a.georole){g=1;}a.timerole=q.tim;a.ipa=m.ipa;if(h===1){c.push(a);}else{if(t===0){b={id:m.atid,tableId:Z,n:m.atnm,alias:m.atnm,isMultiForm:true,ix:a.ix,oid:m.atid,selected:false,tp:12,subColumns:[],type:l,ipa:m.ipa};c.push(b);a.isIdForm=true;}if(g){b.georole=g;}a.isAttributeForm=true;b.subColumns.push(a);if(a.selected){b.selected=true;}}});break;case"mtmps":case"cmps":o=p.sqc?p:(p.col?p.col.oi:p.oi);b=I(p,o,l,Z,null,null,null);c.push(b);break;}});}function S(b,d){var Z=[];var a,c,f,e;if(!b||!d||d.length<=0){return Z;}for(a=0;a<d.length;a++){c=d[a];f={id:c.atid,n:c.n};e={parent:b,child:f,ert:c.ert};if(c.hasOwnProperty("status")){e.status=c.status;}if(c.hasOwnProperty("relationship_type")){e.type=c.relationship_type;}Z.push(e);Z=Z.concat(S(f,c.children));}return Z;}function Y(c,Z){return c.ix-Z.ix;}function H(a){var Z,b=[];a.sort(Y);J.forEach(a,function(c){Z=c.subColumns;if(Z&&Z.length>1){Z.sort(Y);J.forEach(Z,function(d){b.push(d);});c.dataIdx=-1;}else{b.push(c);}});b.sort(Y);J.forEach(b,function(d,c){d.dataIdx=c;});}mstrmojo.DI.ImportSource=mstrmojo.declare(mstrmojo.Obj,null,{formCategory:null,type:-1,subtype:-1,key:"",currentIndex:-1,previews:{},mappings:{},originalMappings:{},sourceInfo:null,sheets:null,transformations:{},currentTransformations:null,currentPreview:null,currentMapping:null,transformedMapping:null,origTransformMapping:null,transformedPreview:null,tableID:null,relationships:{},relationship:null,state:0,lastRefreshedTime:null,nrows:0,binaryExists:false,executeAction:0,refreshType:0,cannotFetchPreview:false,tablePosition:null,hasRefreshedData:false,tableState:null,forceRepublish:false,schemaChanged:false,postCreate:function(){this.relationships={};this.previews={};this.mappings={};this.originalMappings={};this.transformations={};var Z=mstrApp.getRootController().model;if(Z.operationMode===X.operationMode.create){this.executeAction=1;}},reset:function(){this.currentIndex=-1;this.previews={};this.mappings={};this.originalMappings={};this.sourceInfo=null;this.transformations={};this.sheets=null;this.currentPreview=null;this.currentTransformations=null;this.currentMapping=null;},canAutoMappingAndDetectRelation:function(){var a=mstrApp.getRootController().model.operationMode;var Z=this.hasRefreshedData;if(this.xdaType===X.xdaType.qbSingleTable&&this.databaseType===A){return false;}return Z||a===X.operationMode.create;},canLaunchWrangler:function(){var Z=this.canAutoMappingAndDetectRelation();if(mstrApp.isSingleTier&&this.projectID){Z=true;}return Z;},initialize:function(b,Z,a,c){this.type=b;this.subtype=Z;this.key=a;this.tableID=c;},populate:function(c,d,b){var Z=d;if(this.sourceInfo.sheetIndex>=0){this.currentIndex=this.sourceInfo.sheetIndex;}else{this.currentIndex=-1;}if((Z&X.requestFlag.transformations)===X.requestFlag.transformations){if(!c.datap.trnsfs){Z=Z&(~X.requestFlag.transformations);}else{this.populateTransformations(c.datap.trnsfs,this.currentIndex,c.datap.data.chrn);this.currentTransformations=this.transformations[this.currentIndex];}}if((Z&X.requestFlag.mapping)===X.requestFlag.mapping){if(!c.datap.maps){Z=Z&(~X.requestFlag.mapping);}else{var a=this.populateMappings(c,b);if(a.length>0){if((d&X.requestFlag.transformedPreview)===X.requestFlag.transformedPreview||((this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab)===true)){this.transformedMapping=a;this.origTransformMapping=mstrmojo.hash.clone(a);}else{this.mappings[this.currentIndex]=a;this.currentMapping=a;this.originalMappings[this.currentIndex]=mstrmojo.hash.clone(a);}this.formCategory=c.forms;}}}if((Z&X.requestFlag.preview)===X.requestFlag.preview){if(!c.datap.data||!c.datap.data.dcs||c.datap.data.dcs.length===0){Z=Z&(~X.requestFlag.preview);this.cannotFetchPreview=true;}else{this.previews[this.currentIndex]=this.populatePreview(c.datap.data.dcs,this.previews[this.currentIndex]);this.currentPreview=this.previews[this.currentIndex];if(c.datap.data.timestamp!==undefined){this.set("lastRefreshedTime",c.datap.data.timestamp);}if(c.datap.data.nrows){this.nrows=c.datap.data.nrows;}}}if((Z&X.requestFlag.transformedPreview)===X.requestFlag.transformedPreview){if(!c.datap.data||!c.datap.data.dcs||c.datap.data.dcs.length===0){Z=Z&(~X.requestFlag.transformedPreview);this.cannotFetchPreview=true;}else{this.transformedPreview=this.populatePreview(c.datap.data.dcs,this.transformedPreview);if(c.datap.data.timestamp!==undefined){this.set("lastRefreshedTime",c.datap.data.timestamp);}if(c.datap.data.nrows){this.nrows=c.datap.data.nrows;}}}if((Z&X.requestFlag.relationship)===X.requestFlag.relationship){if(!c.datap.relationship){Z=Z&(~X.requestFlag.relationship);}else{this.relationships[this.currentIndex]=this.populateRelationships(c.datap.relationship);this.relationship=this.relationships[this.currentIndex];}}return Z;},invalidPreview:function(){this.currentPreview=null;this.transformedPreview=null;this.cannotFetchPreview=false;this.previews=[];},getCurrentMappings:function(Z){var a;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){a=this.transformedMapping;}else{a=this.currentMapping;}if(typeof Z==="function"){a=mstrmojo.array.filter(a,Z);}return a;},getMappingChanges:function(){var Z=this.currentMapping;var f=this.originalMappings[this.currentIndex];var d,b,e=[],h,c,g,a;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){Z=this.transformedMapping||this.currentMapping;f=this.origTransformMapping||this.originalMappings[this.currentIndex];}if(!Z||!f){return e;}for(d=0;d<Z.length;d++){g=Z[d];a=f[d];if(g.isMultiForm){h=this.findChanges(g,a);if(h){b=J.find(g.subColumns,"isIdForm",true);if(b>0){h.did=g.subColumns[b].did;}else{h.did=g.subColumns[0].did;}e.push(h);}g=g.subColumns;a=a.subColumns;for(b=0;b<g.length;b++){c=this.findChanges(g[b],a[b]);if(c){if(h&&c.did===h.did){N.copy(c,h);}else{e.push(c);}}}}else{c=this.findChanges(g,a);if(c){e.push(c);}}}return e;},findChanges:function K(c,Z){var b,d;b={did:c.did,n:c.n};b.n=mstrmojo.string.encodeXMLAttribute(c.n);d=false;if(c.selected!==Z.selected){b.cmf=(c.selected?1:0);b.ot=c.tp;d=true;}if(!c.ipa){if(Z.ipa){d=true;b.alias=mstrmojo.string.encodeXMLAttribute(c.alias);b.oid="";b.frmid="";}else{if(c.oid!==Z.oid){d=true;b.oid=c.oid;b.alias=c.alias;}if(c.tp===12){var a=false;if(Z.tp!==12){if(c.fmid!==""){a=true;}}else{if(c.fmid!==Z.fmid){a=true;}}if(a){d=true;b.frmid=c.fmid;}}if(c.alias!==Z.alias){b.alias=mstrmojo.string.encodeXMLAttribute(c.alias);d=true;}}}else{if(Z.tp===4){d=true;}else{if(!Z.selected){d=true;}else{if(Z.fmid!==c.fmid||Z.oid!==c.oid){d=true;}}}if(d===true){b.oid=c.oid;b.frmid=c.fmid;}}if(c.alias!==Z.alias){b.alias=mstrmojo.string.encodeXMLAttribute(c.alias);if(c.ipa===0){if(c.linkObjID!==null||c.linkObjID!==undefined){b.oid=c.linkObjID;}if(c.formID!==null||c.formID!==undefined){b.frmid=c.formID;}if(c.lv){b.lv=c.lv;}else{b.lv=0;}}d=true;}if(c.tp!==Z.tp){b.ot=c.tp;d=true;}if(c.dtp!==Z.dtp||c.ctp!==Z.ctp){b.bft=c.dtp;if(c.ctp!==Z.ctp){b.dt=c.ctp;}d=true;}if(!c.ipa){if(c.tp===12){if(Z.tp===12){if(Z.georole!==c.georole){d=true;b.georole=c.georole;}else{if(Z.timerole!==c.timerole){d=true;b.timerole=c.timerole;}}}else{d=true;b.georole=c.georole;}}if(c.tp===12){if(Z.tp===12){if(Z.der!==c.der||Z.dtp!==c.dtp){d=true;b.drvflg=c.der;}}else{d=true;b.drvflg=c.der;}}if(c.tp===12){if(Z.tp===12){if(Z.shapeKey!==c.shapeKey){d=true;b.shapekey=c.shapeKey;}}else{d=true;b.shapekey=c.shapeKey;}}}if(d){return mstrmojo.hash.copy(b);}return"";},isOriginColumnImported:function E(){var b=this.currentMapping;var a,Z;if(b){for(Z=0;Z<b.length;Z++){a=b[Z];if((a.columnState&X.columnState.unchanged)===X.columnState.unchanged){return true;}}}return false;},getMissingColumns:function B(){var e=this.currentMapping;var Z=[];var c,d,b,a;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){e=this.transformedMapping;}if(e){for(b=0;b<e.length;b++){c=e[b];if(c.isMultiForm){for(a=0;c.subColumns&&a<c.subColumns.length;a++){d=c.subColumns[a];if((d.columnState&X.columnState.missing)===X.columnState.missing&&(d.type==="amps"||d.type==="mtmps")){Z.push(c);}}}else{if((c.columnState&X.columnState.missing)===X.columnState.missing&&(c.type==="amps"||c.type==="mtmps")){Z.push(c);}}}}return Z;},areAllColumnsMissing:function F(){var e=this.getCurrentMappings(function(f){return !f.isNew;});var a=this.getMissingColumns(),Z=false,d=0,c,b;for(b=0;b<e.length;b++){c=e[b];if(c.isMultiForm){d+=c.subColumns.length;}else{d++;}}if(d===a.length){Z=true;}return Z;},populatePreview:function(c,g){if(!c.length){return null;}var f=c.length;var h=c[0].dvs.length;var e=[];var Z=[];var a=[];var d,b;for(d=0;d<f;d++){Z.push(c[d].dcns.cln);a.push(c[d].dcns);}for(b=0;b<h;b++){e[b]=[];for(d=0;d<f;d++){e[b].push(c[d].dvs[b]);}}for(b=h;b<49;b++){e[b]=[];for(d=0;d<f;d++){e[b].push("");}}if(!g){g=new mstrmojo.Obj();this.addDisposable(g);}g.set("chs",Z);g.set("dcns",a);g.set("data",e);g.set("numOfRows",h+1);g.set("ignoredRows",0);return g;},populateMappings:function(b,a){if(this.type===X.sourceType.googleBigQuery){if(this.xdaType===X.xdaType.googleBigQuery){return this.populateQBMappings(b,a);}}if(this.type===X.sourceType.querybuilder&&this.xdaType===X.xdaType.querybuilder){return this.populateQBMappings(b,a);}var Z=[];var c=b.datap.maps;D(c.amps,Z,"amps",b,a);D(c.mtmps,Z,"mtmps",b,a);D(c.cmps,Z,"cmps",b,a);H(Z);return Z;},populateQBMappings:function R(q,h){var a=[],j=q.datap.maps,l=j.amps,o=j.mtmps,m,n,e,Z,p,t,g,b,c,k,d;var f=q.datap.tbid||h;J.forEach(l,function(u){e=u.aimp;Z=u.afmps;p=Z.length;J.forEach(Z,function(w,x){d=0;t=w.sqc;g={id:e.atid,ipa:e.ipa,oid:e.atid,fmn:w.fmn,fmid:w.fmid,did:t.id,afid:e.atid+w.fmid,n:w.cln,alias:w.cln,isNew:(t.ups===X.columnState.newColumn),columnState:t.ups,selected:(t.se===1),dtp:w.bft,ctp:W[t.dt.tp],ix:t.ix+1,tp:12,toDel:(t.ups&4)?true:false,georole:t.geo,der:t.der,hasMapped:true,isDI:true,type:"amps",tableId:f};if(g.georole){d=1;}if(p===1){k=e.atnm;if(k){g.alias=k;g.isMultiForm=false;}a.push(g);}else{if(x===0){b={id:e.atid,tableId:f,did:e.atid,n:e.atnm,alias:e.atnm,ix:t.ix+1,tp:12,selected:false,isMultiForm:(p>1),oid:e.atid,subColumns:[],type:"amps",ipa:e.ipa};a.push(b);g.isIdForm=true;}if(d){b.georole=d;}g.isAttributeForm=true;b.subColumns.push(g);if(g.selected){b.selected=true;}}});});for(m=0,n=o.length;m<n;m++){c=o[m];t=c.sqc;a.push({id:c.mtid,tableId:f,did:t.id,alias:c.mtn,n:c.cln,selected:(t.se===1),hasMapped:true,isDI:true,dtp:M[t.dt.tp],ctp:W[t.dt.tp],ix:t.ix+1,tp:4,georole:t.geo,der:t.der,toDel:(t.ups&4)?true:false,type:"mtmps"});}mstrmojo.hash.forEach(j.cmps,function(u){t=u.sqc;a.push({did:t.id,alias:t.exp.exp,n:t.exp.exp,selected:false,hasMapped:false,isDI:true,dtp:M[t.dt.tp],ctp:W[t.dt.tp],ix:t.ix+1,tp:0,type:"cmps"});});H(a);return a;},populateSheets:function(d,e){var b;var a=[];var Z=-1;var c;if(this.currentIndex&&this.currentIndex!==-1){e=this.currentIndex;}if(d){for(b=0;b<d.length;b++){if(d[b]!=="*"){if(Z===-1){Z=b;}if(e){c=(b===e);}else{c=(b===Z);}a.push({index:b,name:d[b],selected:c,isAutoMapped:false});}}if(a.length>0&&J.find(a,"selected",true)<0){a[0].selected=true;}this.set("sheetsInfo",a);}},populateTransformations:function(c,Z,g){var e=this.transformations[Z],b;if(!e){e=new mstrmojo.Obj();this.addDisposable(e);}var d;function f(){var h='<trnsfs count="1" >';if(this.isCrosstab){h+='<trnsf trnsftype="'+X.transformation.xtab+'">';if(this.mhb.startColumn===-1&&this.mhb.startRow===-1){h+='<mhdrs srow="-1" scol="-1" erow="-1" ecol="-1" />';}else{h+='<mhdrs srow="'+(this.mhb.startRow+g)+'" scol="'+this.mhb.startColumn+'" erow="'+(this.mhb.endRow+g)+'" ecol="'+this.mhb.endColumn+'" />';}h+='<dtrng srow="'+(this.db.startRow+g)+'" scol="'+this.db.startColumn+'" erow="'+(this.db.endRow+g)+'" ecol="'+this.db.endColumn+'" />';h+="</trnsf>";}else{h+='<trnsf trnsftype="'+X.transformation.xtab+'" fg="1" />';}h+="</trnsfs>";return h;}for(b=0;b<c.length;b++){var a=c[b];if(a.tp===X.transformation.xtab){d=new mstrmojo.Obj({isCrosstab:(a.fg!==1),mhb:new mstrmojo.Obj({startRow:(a.clrngs[0].srow===-1)?-1:(a.clrngs[0].srow-g),startColumn:a.clrngs[0].scol,endRow:(a.clrngs[0].erow===-1)?-1:(a.clrngs[0].erow-g),endColumn:a.clrngs[0].ecol}),db:new mstrmojo.Obj({startRow:(a.clrngs[1].srow===-1)?-1:(a.clrngs[1].srow-g),startColumn:a.clrngs[1].scol,endRow:(a.clrngs[1].erow===-1)?-1:(a.clrngs[1].erow-g),endColumn:a.clrngs[1].ecol}),getXML:f});}}e.set("xtab",d);if(d){e.addDisposable(d);if(d.mhb){d.addDisposable(d.mhb);}if(d.db){d.addDisposable(d.db);}}this.transformations[Z]=e;},populateRelationships:function P(e){var g=[];var a,Z,c,b,d;var f=[];if(e){for(a=0;a<e.length;a++){c=e[a];b={id:c.atid||c.paid,n:c.n};g=g.concat(S(b,c.children));}}for(a=0;a<g.length;a++){c=g[a];d=false;for(Z=0;Z<f.length;Z++){if(f[Z].parent.id===c.parent.id&&f[Z].child.id===c.child.id){d=true;break;}}if(!d){f.push(c);}}return f;},getSourceObjectType:function O(){var a=mstrmojo.desc(489,"File"),Z=X.xdaType;switch(this.type){case X.sourceType.file:a=mstrmojo.desc(489,"File");break;case X.sourceType.googleDrive:a=mstrmojo.desc(489,"File");break;case X.sourceType.dropbox:a=mstrmojo.desc(489,"File");break;case X.sourceType.salesforce:a=mstrmojo.desc(1279,"Report");break;case X.sourceType.googleAnalytics:a=mstrmojo.desc(1279,"Report");break;case X.sourceType.googleBigQuery:a=mstrmojo.desc(14217,"Query");break;case X.sourceType.querybuilder:if(this.xdaType===Z.qbSingleTable){a=mstrmojo.desc(7755,"Table");}if(this.xdaType===Z.querybuilder){a=mstrmojo.desc(14218,"Builder");}if(this.xdaType===Z.ffsql){a=mstrmojo.desc(1910,"Data");}break;case X.sourceType.bisource:a=mstrmojo.desc(1910,"Data");break;case X.sourceType.facebook:a=mstrmojo.desc(3687,"Page");break;case X.sourceType.twitter:a=mstrmojo.desc(10,"Search");break;}return a;},getDataSource:function C(){var a="",b=X.xdaType,Z=X.sourceType;switch(this.type){case Z.file:a=mstrmojo.desc(489,"File");switch(this.subtype){case X.sourceSubtype.localFile:if(this.xdaType===b.excel){a=mstrmojo.desc(14219,"Excel Data");}if(this.xdaType===b.text){a=mstrmojo.desc(14220,"Text Data");}break;case X.sourceSubtype.url:if(this.xdaType===b.excel){a=mstrmojo.desc(14221,"URL Excel Data");}if(this.xdaType===b.text){a=mstrmojo.desc(14222,"URL Text Data");}break;case X.sourceSubtype.samplefile:a=mstrmojo.desc(12539,"Sample File");break;case X.sourceSubtype.publicData:a=mstrmojo.desc(13978,"Public Data");break;case X.sourceSubtype.clipboard:a=mstrmojo.desc(12541,"Custom Data");break;}break;case Z.googleDrive:a=mstrmojo.desc(14223,"Google Drive File");break;case Z.dropbox:a=mstrmojo.desc(14224,"Dropbox File");break;case Z.salesforce:a=mstrmojo.desc(14225,"Salesforce Report");break;case Z.googleAnalytics:a=mstrmojo.desc(12448,"Google Analytics");break;case Z.googleBigQuery:a=mstrmojo.desc(12450,"Google Big Query");break;case Z.querybuilder:if(this.xdaType===b.qbSingleTable){a=mstrmojo.desc(14226,"Individual Table");}if(this.xdaType===b.querybuilder){a=mstrmojo.desc(14227,"Query Builder");}if(this.xdaType===b.ffsql){a=mstrmojo.desc(14228,"Freeform SQL Data");}break;case Z.bisource:a=mstrmojo.desc(14229,"BI Data");break;case Z.facebook:a=mstrmojo.desc(10171,"Facebook");break;case Z.twitter:a=mstrmojo.desc(10174,"Twitter");break;}return a;},canSubscribe:function(){var Z=false;var a=X.xdaType;switch(this.xdaType){case a.excel:case a.text:if(this.sourceInfo&&this.sourceInfo.url!==""){Z=true;}break;case a.qbSingleTable:case a.querybuilder:case a.ffsql:Z=true;break;case a.dataImportOAuthDropbox:case a.dataImportOAuthSalesforce:case a.dataImportOAuthGDrive:case a.dataImportOAuthGAnalytics:case a.dataImportOAuthGBigQuery:case a.dataImportOAuthGBigQueryFFSQL:case a.dataImportOAuthGBigQuerySingleTable:case a.twitter:case a.facebook:Z=true;break;}return Z;},canSetAlternateSource:function G(){var Z=false,a=X.xdaType;switch(this.xdaType){case a.excel:case a.text:if(this.sourceInfo&&this.sourceInfo.url!==""){Z=true;}break;case a.qbSingleTable:Z=true;break;}if(this.type===X.sourceType.hadoop){Z=false;}return Z;},canRefine:function V(){var a=mstrApp.getRootController().getModel(),d=X.xdaType,Z=X.sourceType,e=this.xdaType,c=this.type,b;b=(!a.isDirectDataAccess&&(e===d.ffsql||e===d.qbSingleTable||e===d.querybuilder))||c===Z.file||c===Z.googleDrive||c===Z.dropbox||c===Z.salesforce||c===Z.twitter||c===Z.facebook||c===Z.googleAnalytics||(!a.isDirectDataAccess&&c===Z.hadoop);return b;},findMappingItem:function U(a){var c=null,d;var Z;var b=false;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){d=this.transformedMapping;}else{d=this.currentMapping;}for(Z=0;d&&Z<d.length;Z++){c=d[Z];if(a.id){if(c.id&&c.id===a.id){b=true;break;}}else{if(a.oid){if(c.oid&&c.oid===a.oid){b=true;break;}}else{if(c.did===a.did){b=true;break;}else{if(a.type==="cmps"&&c.type==="cmps"&&a.alias===c.alias){b=true;break;}}}}}return b?c:null;},updateTablePosition:function(Z){this.tablePosition=mstrmojo.hash.copy(Z,this.tablePosition);},populatePosition:function(a){var b={},Z=false;if(!this.tablePosition){J.forEach(a,function(c){switch(c.pri){case 135856129:b.y=c.pdv;break;case 135856130:b.x=c.pdv;break;case 134742017:b.w=c.pdv;break;case 134742018:b.h=c.pdv;break;}});if(b.hasOwnProperty("x")||b.hasOwnProperty("y")||b.hasOwnProperty("w")||b.hasOwnProperty("h")){this.tablePosition=b;Z=true;}}return Z;},isExtensionValid:function(d){var b=true,c,Z,a;if(this.sourceInfo&&this.sourceInfo.dbTableName!==undefined&&d!==undefined){c=this.sourceInfo.dbTableName.toString();Z=Q.getExtensionType(c.substr(c.lastIndexOf(".")));c=d.toString();a=Q.getExtensionType(c.substr(c.lastIndexOf(".")));}return b;},isRefined:function(){return !!this.sourceInfo.isRefined;},isParsed:function(){var a=this.sourceInfo,Z=this.currentTransformations;if(Z&&Z.xtab&&Z.xtab.isCrosstab){return true;}if(a&&a.hasNewHeaders){return true;}if(a&&a.skipRows>0){return true;}return false;}});mstrmojo.DI.ImportSource.ENUM_STATE=L;}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(221,1442,10492,12584,12585,12586,12588,12589,12590,12647,13031,13061,13062,13063,13064,13065,13066,13067,13068,13069,13070,13071,13520,13774,14204,14302,14663);var h=mstrmojo.DI.DIConstants,B,N=mstrmojo.array,a=mstrmojo.func,P=mstrmojo.hash,R=mstrmojo.string,Q=mstrmojo.DI.DIHelpers,G=10,M=60*1000;function W(){var j=mstrApp.getRootController();var l={success:function(){mstrApp.redirectToPage(mstrmojo.DI.DIExitOptions.getRedirectParams(mstrmojo.DI.DIExitOptions.pageRedirect.historyList,null,j.model.isDirectDataAccess));},failure:function(){j.displayError(mstrmojo.desc(13774,"Your history list is full. Please delete a few messages and try again."),false);j.model.getHistoryList().set("hasSentToHistoryList",false);}};var k={};if(j.model.operationMode===h.operationMode.create){k.name=j.model.cubeName;}if(!j.model.getHistoryList().hasSentToHistoryList){j.model.getHistoryList().set("hasSentToHistoryList",true);j.dataService.sendToHistoryList(l,k);}}function b(){var l=this,k=l.getModel(),o=true,n=k.getAllTableID(),m,j={model:this.model,zIndex:999};if(k.operationMode===h.operationMode.edit&&k.isCubePublished&&k.rawDataExistsInAE){N.forEach(n,function(p){m=k.getImportSource(p);if(m){o=o&&(m.executeAction===h.tableStatsExecutionAction.reserved&&!m.forceRepublish&&!m.hasRefreshedData);}});if(o){j.simpleProgressMode=true;j.showTitle=false;}}return this.showDialog(h.dialogType.publishStatusDialog,j);}function J(){var j=this;var k=j.model;var l={isDirectDataAccess:k.isDirectDataAccess},m={success:function(n){if(n.objectId){k.cubeID=n.objectId;}j.wrapUpDataImport();},failure:function(n){mstrApp.hideProgress();j.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,n&&n.message);}};k.cubeName=L.call(j,true);l.name=k.cubeName;this.dataService.createOneTierDoc(m,l);}function H(){var j=mstrApp.getRootController();var l={op:h.getCubeQuotaAndInfosOptions.GetCubeQuotaAndInfosQuotaOnly};var k=mstrmojo.desc(13410,"Unable to import your data since your remaining in-memory space of #### MB of the allocated @@@@ MB was deemed insufficient to store the result of the operation. Please try freeing some of the used in-memory space.");var m={success:function(p){var o=Math.round(p.cubes.cquota),q=Math.round(p.cubes.cusage);var t=o-q;var n=k.replace("####",t.toString()).replace("@@@@",o.toString());j.displayError(n,false);},failure:function(){k=mstrmojo.desc(13031,"We could not import your data because there is not enough space left. Please consider removing some rows/columns and try again or contact your administrator.");j.displayError(k,false);}};j.dataService.getCubeQuota(m,l);}function f(AH){var p;if(this.model.operationMode!==h.operationMode.refresh){this.dialogController.close(h.dialogType.publishStatusDialog);p=this.getModel().getAllTableID();if(p.length>0&&!mstrApp.isSingleTier){this.dataService.editEMMASourceTable(null,{did:this.getModel().getAllTableID()[0]});}}var o=AH.code&&parseInt(AH.code,10),l=this.getModel(),w,n=false,t=AH.message,AD;if(t){AD=R.encodeHtmlString(t,true,true);}if(o===undefined||o===null){o=AH.cubeStatus&&parseInt(AH.cubeStatus,10);}if((o===undefined||o===null)&&AH.getResponseHeader){o=parseInt(AH.getResponseHeader("X-MSTR-TaskErrorCode"),10);t=AH.getResponseHeader("X-MSTR-TaskFailureMsg");AD=R.encodeHtmlString(t,true,true);}if(AH.cubeStatus<0&&AH.tables&&AH.tables.length>0){t="<ul>";N.forEach(AH.tables,function(x){if(x.emsg){var AJ=x.tableid;w=AJ&&l.getImportSource(AJ);if(w){t+="<li>"+w.sourceInfo.name+"<br>"+x.emsg+"</li>";}}});t+="</ul>";AD=t;}if(this.model.operationMode===h.operationMode.refresh){n=true;}N.forEach(l.getAllTableID(),function(x){w=l.getImportSource(x);if(w){delete w.status;}});switch(o){case h.backendError.unexpectedDataType:var AI=t.indexOf("#");var AA=t.indexOf("#",AI+1);var AG=t.substring(AI,AA);AI=AG.indexOf("[");AA=AG.indexOf("]",AI+1);AG=AG.substring(AI+1,AA);var AB=[];AB=AG.split(",");var z=[];var m=AB.length;var AC,q;for(AC=0;AC<m;AC++){q=AB[AC].split("=");z.push(q[1]);}var AE=mstrmojo.desc(13063,"Error converting the data type of the cell in row ## and column @@ with the value **.").replace("##",z[0]).replace("@@",(z[1]+1)).replace("**",z[2]);this.displayError(AE);break;case h.backendError.cubeQuotaExceeded:case h.backendError.notEnoughSpace:H.call();break;case h.backendError.noExternalSession:this.displayError(mstrmojo.desc(12585,"The external session has expired."),false);break;case h.backendError.overwriteObject:this.displayError(mstrmojo.desc(12586,"You are trying to overwrite an object which is not allowed"),false);break;case h.backendError.noPermission:this.displayError(mstrmojo.desc(12647,"You do not have the permission to modify this object"),false);break;case h.backendError.invalidObjectName:this.displayError(mstrmojo.desc(12588,"The name of the cube being saved in invalid. Please give a valid name."),false);break;case h.backendError.incrementalRefresh:this.displayError(mstrmojo.desc(12589,"Incremental refresh of cube failed because the set of attributes is not the same as before."),false);break;case h.backendError.objectNameTooLong:this.displayError(mstrmojo.desc(12590,"Name of at least one column header exceeds the limit of 250 characters. Please shorten the column name and try again."),false);break;case h.backendError.memoryGovernSizeExceeded:var AF="";if(t.indexOf("Max memory size limit: ")>-1){var k=t.indexOf("Max memory size limit: ")+23;var j=t.indexOf(".",k);AF="("+t.substring(k,j)+") ";}this.displayError(mstrmojo.desc(13064,"Memory consumption limit during data fetching ## is exceeded.").replace("##",AF));break;case h.backendError.reportTimeout:this.displayError(mstrmojo.desc(13520,"The job execution time limit set in MicroStrategy Intelligence Server has been exceeded."));break;default:if(n){var u=this;this.displayError(mstrmojo.desc(13065,"Unable to publish the cube."),false,AD,function(){u.getDialogController().close(h.dialogType.publishStatusDialog);});}else{this.displayError(mstrmojo.desc(13065,"Unable to publish the cube."),false,AD);}return ;}}function L(l){var k=this.model,j=[];if(k.cubeName&&!l){return k.cubeName;}N.forEach(k.getAllTableID(),function(m){j.push(k.getImportSource(m).sourceInfo.name||"");});return Q.generateCubeName(j);}function D(m,k){if(!m){return k;}var l,o=true,n=0,j;for(l=0;l<m.length;l++){if(k===m[l].n){o=false;break;}}if(o){return k;}k=k+"_"+n;n++;l++;while(l<m.length&&k===m[l].n){j=k.lastIndexOf("_");k=k.substring(0,j)+"_"+n;n++;l++;}return k;}function V(){var k=mstrApp.getRootController();var l=k.model;var j="<ts>";mstrmojo.hash.forEach(l.importSources,function(m){if(l.operationMode===h.operationMode.edit){if(m.executeAction===h.tableStatsExecutionAction.reserved){j+='<tb did="'+m.tableID+'" ac="4"/>';}else{j+='<tb did="'+m.tableID+'" ac="'+m.executeAction+'"/>';}}else{if(m.refreshType===h.cubeRefreshType.preserve){j+='<tb did="'+m.tableID+'" ac="4"/>';}else{if(m.republishError){j+='<tb did="'+m.tableID+'" ac="4"/>';}else{j+='<tb did="'+m.tableID+'" ac="1"/>';}}}});j+="</ts>";return j;}function C(){var n=h.requestFlag.mapping|h.requestFlag.sourceInfo;var k=this;var j=k.model;var l={previewflag:n,poll:false};var o={success:function(m){j.populateEMMA(m,n);var p=j.getAllMissingColumns();if(p&&p.length>0){k.showDialog(h.dialogType.missingColumnsDialog,{mappings:p});}else{k.publishController.refreshCubeWithoutSave();}},failure:function(){mstrApp.hideProgress();}};this.dataService.getImportedData(o,l);}function O(){var j=this;var l=this.model;var m=l.operationMode;var o={extParams:"<result_flags_3>2048</result_flags_3>",isAsync:true,shouldRemoveFromHL:(!l.isManagedCube&&!l.analysisID)};var n=0;var k=b.call(j);var p={success:function(z){var w,AA=[],x=true,t=false,u=false,AB=false,AC,q;if(z.tables){for(w=0;w<z.tables.length;w++){AC=z.tables[w];if(l.importSources[AC.tableid]){q=l.importSources[AC.tableid].sourceInfo.name;if(AC.status!=="3"&&AC.status!=="4"&&AC.status!=="6"){x=false;}if(AC.status==="4"||AC.status==="6"){AB=true;if(parseInt(AC.errc,10)===h.backendError.missingColumn){u=true;}l.importSources[AC.tableid].republishError={errorMsg:AC.emsg,errorCode:AC.errc};}AA.push({n:q,complete:(AC.status==="3"),errorMsg:AC.emsg||"",errorCode:AC.errc||""});}}if(z.cubeStatus===h.backendError.dataDiscoveryError){if(x===false){t=true;}x=true;}else{if(z.cubeStatus===h.backendError.columnCountMatchError){x=true;}else{if(z.cubeStatus!==1){x=false;}}}if(z.cubeStatus<0){x=true;AB=true;}if(k&&k.model){mstrmojo.array.forEach(z.tables,function(AE){var AD=k.model.importSources[AE.tableid];if(AD){AD.status=AE.status;AD.errmsg=AE.emsg||"";}});k.model.raiseEvent({name:"PublishStatusUpdate",completed:x,error:AB});}}else{if(z.cubeStatus<0){x=true;AB=true;}if(k&&k.model&&z.cubeStatus===1){mstrmojo.hash.forEach(k.model.importSources,function(AD){if(AD.status!==3||AD.status!==4||AD.status!==6){AD.status=3;AD.errmsg="";}});k.model.raiseEvent({name:"PublishStatusUpdate",completed:x,error:AB});}}if(x){if((m===h.operationMode.create||m===h.operationMode.edit)&&z.cubeStatus>=0){j.wrapUpDataImport();}else{if(u){C.call(j);}else{if(z.cubeStatus===h.backendError.dataDiscoveryError&&t){z.code=z.cubeStatus;f.call(j,z);}else{if(z.cubeStatus<0){z.code=z.cubeStatus;f.call(j,z);}else{if(l.analysisID){j.dataService.duplicateReportInstance({failure:function(){mstrApp.hideProgress();j.displayError(mstrmojo.desc(13066,"Error in refreshing the dataset."),false);}},{messageID:l.analysisID,datasetID:l.cubeID,duplicateRIMsgID:j.dataService.messageID});}else{if(mstrApp.isSingleTier){j.dataService.duplicateReportInstance({failure:function(){mstrApp.hideProgress();j.displayError(mstrmojo.desc(13066,"Error in refreshing the dataset."),false);}},{messageID:"",datasetID:l.cubeID,duplicateRIMsgID:j.dataService.messageID},{showProgress:false});}}}}}}}else{window.setTimeout(function(){j.dataService.pollEmmaStatus(p,o);},500);}},failure:function(q){if(parseInt(q.code,10)===h.backendError.requestTimeout&&n<G){window.setTimeout(function(){j.dataService.pollEmmaStatus(p,o);},M);n++;}else{f.call(j,q);}}};this.dataService.pollEmmaStatus(p,o);}function Z(t){var l=this.model,q=this.dataService,p=l.getAllTableID(),o=[],k,n=0,j={complete:function(){n++;if(n>=o.length){if(t&&t.success){t.success();}if(t&&t.complete){t.complete();}}}};N.forEach(p,function(m){k=l.getImportSource(m).tablePosition;if(k){if(k.hasOwnProperty("x")||k.hasOwnProperty("y")||k.hasOwnProperty("w")||k.hasOwnProperty("h")){o.push(m);}}});if(o.length===0){j.complete();}N.forEach(o,function(w){var u=l.getImportSource(w).tablePosition,m={did:w};if(u.hasOwnProperty("x")){m.fl=u.x;}if(u.hasOwnProperty("y")){m.ft=u.y;}if(u.hasOwnProperty("w")){m.fw=u.w;}if(u.hasOwnProperty("h")){m.fh=u.h;}q.editEMMASourceTable(j,m);});}function I(p){var j=this.model,o={},n=j.getAllTableID(),k=null,l;if(j.isManagedCube||mstrApp.isSingleTier){j.cubeName=L.call(this,true);}if(j.isDirectDataAccess&&(j.isManagedCube||mstrApp.isSingleTier)){this.wrapUpDataImport();return ;}o.displayMode=12;o.saveAsFlags=0;o.extParams=V.call();o.saveAsFlags=h.saveAsFlags.saveAsOverWrite;if(j.isDirectDataAccess){o.shouldRefresh=false;o.saveAsFlags=o.saveAsFlags|h.saveAsFlags.saveAsDDA;k={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(10492,"Saving...")};}else{o.saveAsFlags=o.saveAsFlags|h.saveAsFlags.saveAsInMemory;}if(j.isManagedCube){o.shouldSave=false;}else{o.saveAsFlags|=h.saveAsFlags.saveAsWithAnswers|h.saveAsFlags.saveAsWithPrompts;}o.folderID=j.folderID;o.objName=j.cubeName;if(j.cubeDesc!==null&&j.cubeDesc!==undefined){o.objDesc=j.cubeDesc;}this.dataService.saveAndPublishEMMA(p,o,null,k);N.forEach(n,function(m){l=j.getImportSource(m);if(l){l.status="0";}});j.raiseEvent({name:"PublishStatusUpdate"});}function Y(t,u){var q=this,n=q.getModel(),p=n.getAllTableID(),l=n.operationMode,j=[],k=0;var o={success:function(){k++;if(k>=j.length){u.success();}},failure:function(m){q.displayError(mstrmojo.desc(13069,"Set refresh policy error."),false,m.message);t.model.raiseEvent({name:"PublishStatusUpdate",hasError:true});}};N.forEach(p,function(x){var w=n.getImportSource(x),m;if(!w){return ;}if(l===h.operationMode.edit){if(w.executeAction===h.tableStatsExecutionAction.reserved){m={did:x,exef:h.tableStatsExecutionAction.ignore};}else{m={did:x,exef:w.executeAction};}}else{if(w.refreshType===h.cubeRefreshType.preserve){m={did:x,exef:h.tableStatsExecutionAction.ignore};}else{if(w.republishError){m={did:x,exef:h.tableStatsExecutionAction.ignore};}else{m={did:x,exef:h.tableStatsExecutionAction.forceExecution};}}}j.push(m);});if(j.length>0){N.forEach(j,function(m){q.dataService.editEMMASourceTable(o,m);});}else{u.success();}}function U(p){var k=this,l=k.getModel(),m=l.operationMode,o={},n=[];var j={success:function(t){var q=Q.parseValidateSourceResults(t),u=q.isValidate;var w=t&&t.vts;N.forEach(w,function(x){if(x.dbRole){var z=l.getImportSource(x.tbid);z.dbRole=x.dbRole;}});if(u){if(p.success){p.success(q);}}else{if(p.failure){p.failure(q);}}if(p.complete){p.complete();}},failure:function(q){k.displayError(mstrmojo.desc(14302,"We encountered some errors while republishing the cube."),false,q.message);k.cancelRepublishError({errorTableTbids:n});}};N.forEach(l.getAllTableID(),function(q){var t=l.getImportSource(q);if(m===h.operationMode.refresh){if(t.refreshType!==h.cubeRefreshType.preserve){n.push(q);}}if(m===h.operationMode.edit){if(t.forceRepublish&&!t.hasRefreshedData){n.push(q);}}});if(n.length>0){o.tbid=n.join();k.dataService.validateSource(j,o);}else{if(p.success){p.success();}if(p.complete){p.complete();}}}function S(AC){var u=this,t=this.model,o=t.operationMode,p=t.cubeID,x=this.showDialog(h.dialogType.publishStatusDialog,{model:this.model,zIndex:999});var q=[],j=false,k=true,n=false;var w={success:function(AD){Y.call(u,x,{success:function(){if(o===h.operationMode.refresh&&AD&&AD.isValidate&&q.length===0&&t.isDirectDataAccess===t.origIsDirectDataAccess){u.getPublishController().refreshCubeWithoutSave();}else{I.call(u,AC);}}});},failure:function(AD){u.showDialog(h.dialogType.missingColumnsDialog,{results:AD});}};if(o===h.operationMode.edit){j=true;k=true;}mstrmojo.hash.forEach(t.importSources,function(AD){if(o===h.operationMode.refresh){AD.published=false;if(!AD.checked){if(AD.refreshType!==h.cubeRefreshType.preserve){AD.refreshType=h.cubeRefreshType.preserve;}k=false;}else{if(AD.checked){AD.published=true;if(AD.refreshType===h.cubeRefreshType.preserve){if(AD.origRefreshType!==h.cubeRefreshType.preserve){AD.refreshType=AD.origRefreshType;}else{AD.refreshType=h.cubeRefreshType.replaceTable;}}j=true;if(AD.xdaType===h.xdaType.excel||AD.xdaType===h.xdaType.text){if(AD.sourceInfo.url===""&&!AD.hasSelectFile){k=false;AD.refreshType=h.cubeRefreshType.preserve;n=true;}}}}if(AD.refreshType!==AD.origRefreshType){q.push({did:AD.tableID,tp:AD.refreshType});}}if(o===h.operationMode.edit){if(!u.model.isCubePublished||!u.model.rawDataExistsInAE){if(AD.xdaType===h.xdaType.excel||AD.xdaType===h.xdaType.text){if(AD.sourceInfo.url===""&&!AD.hasSelectFile&&!AD.hasRefreshedData){n=true;}}if(AD.tableState!==h.tableStates.newly){q.push({did:AD.tableID,tp:h.cubeRefreshType.replaceTable});AD.executeAction=h.tableStatsExecutionAction.forceExecution;}}else{if(AD.forceRepublish){if(AD.schemaChanged){AD.refreshType=h.cubeRefreshType.replaceTable;}if(AD.refreshType!==AD.origRefreshType){q.push({did:AD.tableID,tp:AD.refreshType});}if(!AD.hasRefreshedData){if(AD.xdaType===h.xdaType.excel||AD.xdaType===h.xdaType.text){if(AD.sourceInfo.url===""&&!AD.hasSelectFile){k=false;AD.refreshType=h.cubeRefreshType.preserve;n=true;}}}}else{if(AD.tableState!==h.tableStates.newly){if(AD.hasRefreshedData){if(AD.refreshType!==AD.origRefreshType){q.push({did:AD.tableID,tp:AD.refreshType});AD.executeAction=h.tableStatsExecutionAction.forceExecution;}}if(AD.executeAction===h.tableStatsExecutionAction.forceExecution&&!AD.hasRefreshedData){AD.refreshType=h.cubeRefreshType.replaceTable;if(AD.refreshType!==AD.origRefreshType){q.push({did:AD.tableID,tp:h.cubeRefreshType.replaceTable});}if(AD.xdaType===h.xdaType.excel||AD.xdaType===h.xdaType.text){if(AD.sourceInfo.url===""&&!AD.hasSelectFile){k=false;AD.refreshType=h.cubeRefreshType.preserve;n=true;}}}}}}}});if(j===false){u.displayError(mstrmojo.desc(13067,"Please select at least one table to publish."),false);x.model.raiseEvent({name:"PublishStatusUpdate",reset:true});return ;}if(n){u.displayError(mstrmojo.desc(13068,"You have not uploaded the files for some of the tables. We could not find the data for them. Please upload them before you proceed."),false);x.model.raiseEvent({name:"PublishStatusUpdate",reset:true});return ;}if(o===h.operationMode.refresh){if(!u.model.isCubePublished||!u.model.rawDataExistsInAE){if(!k){u.displayError(mstrmojo.desc(13068,"You have not uploaded the files for some of the tables. We could not find the data for them. Please upload them before you proceed."),false);x.model.raiseEvent({name:"PublishStatusUpdate",reset:true});return ;}}}x.model.raiseEvent({name:"PublishStatusUpdate",completed:false});var m=[];mstrmojo.hash.forEach(t.importSources,function(AD){if(AD.checked&&AD.hasSelectFile&&o===h.operationMode.refresh){m.push(AD.tableID);}if(AD.hasSelectFile&&o===h.operationMode.edit){m.push(AD.tableID);}});function z(){var AD=-1,AE,AF;u=mstrApp.getRootController();var AG={success:function(){AD++;if(AD>=m.length){mstrApp.hideProgress();x.toggleEnable(false);if(o===h.operationMode.refresh||o===h.operationMode.edit){U.call(u,w);}else{w.success();}}else{AE=u.model.importSources[m[AD]];AF={type:AE.subtype,tableID:AE.tableID,newRI:false,msgid:mstrApp.getRootController().dataService.messageID};if(AE.subtype===h.sourceSubtype.clipboard){AF.datasource=AE.fileUploader.ws.getData();if(!AF.datasource){AF.datasource=AE.fileUploader._data;}AF.dict=h.backendSourceSubtype.clipboard;}else{AF.datasource=AE.files[0];AF.dict=h.backendSourceSubtype.localFile;}AF.operationMode=u.model.operationMode;u.dataService.oneTierImportFile(AG,AF);}},failure:function(AH){u.displayError(mstrmojo.desc(14663,"Unable to upload the files selected.")+AH.message);x.model.raiseEvent({name:"PublishStatusUpdate",hasError:true});u.cancelRepublishError({errorTableTbids:[m[AD]]});},complete:function(){mstrApp.hideProgress();}};if(m.length>0){mstrApp.showProgress();}AG.success();}function AB(){var AG=0,AN,AI,AD,AK,AL,AO,AJ,AE,AF,AH,AM;var AP={success:function(){AG++;if(AG>=m.length){mstrApp.hideProgress();x.toggleEnable(false);if(o===h.operationMode.refresh||o===h.operationMode.edit){U.call(u,w);}else{w.success();}}else{AN=m[AG];AI=x.getFileUploader(AN);AJ={msgID:u.dataService.messageID,tableID:AN};if(p){AJ.reportid=p;}u.dataService.importFile(AI,AP,AJ);}},failure:function(AQ){var AS=AD&&AD.dbTableName;var AR=u.getImportController().handleImportError(AQ,AS);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,AR);u.getImportController().handleImportError(AQ);x.model.raiseEvent({name:"PublishStatusUpdate",hasError:true});u.cancelRepublishError({errorTableTbids:[m[AG]]});},complete:function(){mstrApp.hideProgress();}};if(m.length>0){AL=true;AM=[];AH=["<ul>"];for(AK=0;AK<m.length;AK++){AN=m[AK];AI=x.getFileUploader(AN);AD=t.getImportSource(AN);AE=AI.getFileName?AI.getFileName():AD.name;if(AI.getFileSize){if(AI.getFileSize()>(mstrApp.diParams.UploadSizeLimit*1024*1024)){AO=AI.value.substring(AI.value.lastIndexOf(".")+1);AM.push(AD.tableID);AF=mstrmojo.desc(12738,"The maximum file size for #### files is @@@@ MB. ").replace("####",AO).replace("@@@@",mstrApp.diParams.UploadSizeLimit);AH.push("<li>");AH.push(AE+"<br>"+AF);AH.push("</li>");}else{if(AI.getFileSize()<=0){AM.push(AD.tableID);AF=mstrmojo.desc(12510,"The import process cannot proceed with an empty file.");AH.push("<li>");AH.push(AE+"<br>"+AF);AH.push("</li>");}}}}AH.push("</ul>");if(AM.length>0){u.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,AH.join(""));u.cancelRepublishError({errorTableTbids:AM});return ;}mstrApp.showProgress();AN=m[0];AI=x.getFileUploader(AN);AJ={msgID:u.dataService.messageID,tableID:AN};if(p){AJ.reportid=p;}u.dataService.importFile(AI,AP,AJ);}else{AP.success();}}var l=0;var AA={success:function(){l++;if(l>=q.length){if(mstrApp.isSingleTier){z();}else{AB();}}},failure:function(AD){u.displayError(mstrmojo.desc(13069,"Set refresh policy error."),false,AD.message);x.model.raiseEvent({name:"PublishStatusUpdate",hasError:true});}};if(q.length>0){mstrmojo.array.forEach(q,function(AD){u.dataService.editEMMASourceTable(AA,AD);});}else{AA.success();}}function e(p,k){var j=this.model;var o={};o.displayMode=12;o.extParams=V.call();if(j.isDirectDataAccess){o.shouldRefresh=false;o.saveAsFlags=h.saveAsFlags.saveAsDDA|h.saveAsFlags.saveAsOverWrite;}else{o.saveAsFlags=h.saveAsFlags.saveAsInMemory|h.saveAsFlags.saveAsOverWrite;}if(!k){B=this.showDialog(h.dialogType.saveAsDialog,{saveAsCallback:function(){return p;},name:j.cubeName,desc:"",saveParams:{},retainPrevFolder:true,rootFolderID:mstrApp.cubeSaveFolderId});this.dataService.saveAndPublishEMMA(p,o,B);}else{o=P.copy({taskId:"saveAndPublishCube",msgID:this.dataService.messageID},o);o=P.copy(k,o);delete o.objPath;this.dataService.saveAndPublishEMMA(p,o,null,{showProgress:j.isDirectDataAccess});var n,l=j.importSources;for(n in l){l[n].status="0";}j.cubeName=k.objName||"";j.raiseEvent({name:"PublishStatusUpdate"});if(!j.isDirectDataAccess){this.showDialog(h.dialogType.publishStatusDialog,{model:j,zIndex:999});}}}function X(n){var k=this;var j=this.model;var l=L.call(k);var o={folderID:j.folderID,searchPattern:l};var p={success:function(m){j.cubeName=D(m.items,l);if(j.isManagedCube===false){e.call(k,n);}else{S.call(k,n);}},failure:function(){k.displayError(mstrmojo.desc(13070,"Unable to fetch the content of cube folder."),false);}};this.dataService.fetchFolderContents(p,o);}function E(t){var o=this,l=this.model,u=l.getAllTableID(),p=[],j,q;var n={success:function(){mstrmojo.array.forEach(p,function(m){o.model.resetImportSource(m);o.navigationController.deleteRoute(m);});}};mstrmojo.array.forEach(u,function(m){j=l.getImportSource(m);if(j){q=j.getCurrentMappings(function(w){return w.selected;});if(!q||q.length<=0){p.push(m);}}});if(p.length){var k=mstrmojo.desc(14204,"Do you want to continue with empty tables? Continue will remove these empty tables:")+"<br><ul>";N.forEach(p,function(m){k+="<li>"+mstrmojo.string.encodeHtmlString(l.getImportSource(m).sourceInfo.name)+"</li>";});k+="</ul>";mstrmojo.confirm(k,{confirmBtn:{fn:function(){o.dataService.removeEMMASourceTable(mstrmojo.func.wrapMethods(n,t),{did:p.join()});return true;}},cancelBtn:{fn:function(){return true;}}},{zIndex:o.getDialogController().getNextZIndex()});}else{if(t.success){t.success();}if(t.complete){t.complete();}}}var d={success:function(m){var j=mstrApp.getRootController(),l=j.getModel(),k=mstrApp.saveCubeParams;if(m.objectId){l.cubeID=m.objectId;}if(k){l.path=k.objPath;delete mstrApp.saveCubeParams;}else{if(B){l.path=B.getObjectPath();}}if(l.isDirectDataAccess){j.wrapUpDataImport();}else{O.call(j);}},failure:function(j){f.call(mstrApp.getRootController(),j);}};function T(t){var n=this,m=n.getModel(),j=m.operationMode,o,p,u=false,l={shouldRefresh:false,displayMode:12,saveAsFlags:h.saveAsFlags.saveAsOverWrite},k={success:function(x){m.set("isManagedCube",u);n.rootView.showFooter({managedCheckbox:{enabled:false}});if(x&&x.objectId){m.cubeID=x.objectId;}if(p){m.path=p.getObjectPath();m.folderID=p.folderID;m.cubeName=p.name||"";m.cubeDesc=p.desc||"";}}};function w(){if(m.isManagedCube){return ;}if(m.isDirectDataAccess){l.saveAsFlags|=h.saveAsFlags.saveAsDDA;}else{l.saveAsFlags|=h.saveAsFlags.saveAsInMemory;}n.dataService.saveAndPublishEMMA(a.wrapMethods(k,t,{}),l,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(10492,"Saving...")});}function q(){n.dataService.clearRelationship({success:function(){w();},failure:function(){w();}});}if(m.cubeID&&m.cubeName&&!(m.isManagedCube&&!m.cubePersisted)&&!(!m.folderID&&j===h.operationMode.create)){if(!m.folderID&&m.cubeID){n.dataService.getObjectFolder({success:function(x){if(x&&x.items&&x.items.length===1){m.folderID=x.items[0].fid;if(!m.isManagedCube&&!m.path){n.dataService.fetchFolderContents({success:function(AA){var AB="",z="";if(AA&&AA.sc&&AA.sc.length>1){AB=AA.sc[0].did;z=AA.sc[1].did;}n.dataService.getObjectFolder({success:function(AC){if(AC&&AC.items&&AC.items.length===1){m.path=AC.items[0].path;l.folderID=m.folderID;l.objName=m.cubeName;if(m.cubeDesc!==null&&m.cubeDesc!==undefined){l.objDesc=m.cubeDesc;}q();}},failure:function(AC){n.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AC.message);}},{dids:m.cubeID,types:3,sharedFolderId:AB,myReportsId:z});},failure:function(z){n.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,z.message);}},{includeAncestorInfo:true,includeObjectDesc:false,folderLinksContextId:1,objectType:8});}else{l.folderID=m.folderID;l.objName=m.cubeName;if(m.cubeDesc!==null&&m.cubeDesc!==undefined){l.objDesc=m.cubeDesc;}q();}}},failure:function(x){n.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,x.message);}},{dids:m.cubeID,types:3});}else{if(!m.isManagedCube&&!m.path&&m.cubeID&&m.folderID){n.dataService.fetchFolderContents({success:function(z){var AA="",x="";if(z&&z.sc&&z.sc.length>1){AA=z.sc[0].did;x=z.sc[1].did;}n.dataService.getObjectFolder({success:function(AB){if(AB&&AB.items&&AB.items.length===1){m.path=AB.items[0].path;l.folderID=m.folderID;l.objName=m.cubeName;if(m.cubeDesc!==null&&m.cubeDesc!==undefined){l.objDesc=m.cubeDesc;}q();}},failure:function(AB){n.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AB.message);}},{dids:m.cubeID,types:3,sharedFolderId:AA,myReportsId:x});},failure:function(x){n.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,x.message);}},{includeAncestorInfo:true,includeObjectDesc:false,folderLinksContextId:1,objectType:8});}else{l.folderID=m.folderID;l.objName=m.cubeName;if(m.cubeDesc!==null&&m.cubeDesc!==undefined){l.objDesc=m.cubeDesc;}q();}}}else{o={saveAsCallback:function(){return t;},saveCube:function(){l.folderID=this.folderID;l.objDesc=this.desc||"";l.objName=this.name||"";q();this.close();},name:L.call(n),desc:"",saveParams:l,retainPrevFolder:true,rootFolderID:mstrApp.cubeSaveFolderId};p=n.showDialog(h.dialogType.saveAsDialog,o);}}mstrmojo.DI.controller.DIPublishController=mstrmojo.declare(mstrmojo.Obj,null,{hasPublishStarted:false,handleMissingColumns:function g(o){var n=mstrApp.getRootController();var p=this;var m=n.model;var l={skipTables:o};var u=[],q=[],j=0;mstrmojo.hash.forEach(m.importSources,function(w){if(w.getMissingColumns().length>0){if(!w.areAllColumnsMissing()){u.push(w.tableID);}else{q.push(w.tableID);}}});l.tableIds=u;var t={success:function(){p.refreshCubeWithoutSave();},failure:function(w){f.call(n,w);}};var k={success:function(){j++;if(j>=q.length){if(u.length>0){n.dataService.handleMissingColumns(t,l);}else{p.refreshCubeWithoutSave();}}}};if(q.length>0){N.forEach(q,function(w){m.getImportSource(w).refreshType=h.cubeRefreshType.preserve;n.dataService.editEMMASourceTable(k,{did:w,tp:h.cubeRefreshType.preserve});});}else{if(u.length>0){n.dataService.handleMissingColumns(t,l);}else{p.refreshCubeWithoutSave();}}},saveAndPublish:function c(){var k=mstrApp.getRootController(),m=k.model,o=m.isDirectDataAccess,j=m.origIsDirectDataAccess,n,p=k.getDDAController();this.hasPublishStarted=true;if(m.operationMode===h.operationMode.refresh){m.set("origIsDirectDataAccess",m.isDirectDataAccess);}if(p.shouldSupportDDA()){p.confirmDDA=false;m.set("isDirectDataAccess",true);}else{if(m.operationMode===h.operationMode.refresh){m.set("isDirectDataAccess",false);}}if(p.confirmDDA&&m.operationMode!==h.operationMode.refresh){n=p.canSupportDDA();if(!j&&n){var l={selectedIndex:o?0:1};k.showDialog(h.dialogType.ddaConfirmDialog,l);return ;}if(o&&!n){m.set("isDirectDataAccess",false);}}this.saveAndPublishNoConfirm();},saveAndPublishNoConfirm:function A(){var l=mstrApp.getRootController(),n=l.model,p=h.requestFlag.sourceInfo|h.requestFlag.mapping,m=h.browseFlag.dataPreview|h.browseFlag.publish,o;var k=function k(){if(n.operationMode===h.operationMode.edit){if(n.isDirectDataAccess){I.call(l,d);}else{l.dataService.getImportedData({success:function(q){n.populateEMMA(q,p,null,true);o=b.call(l);if(o.simpleProgressMode){Y.call(l,o,{success:function(){I.call(l,d);}});}else{if(o.checkCanRefresh()&&!o.checkCanChange()){o.okButton.onclick();}}},failure:function(q){l.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,q.message);}},{previewflag:p,browsetype:m});}}else{S.call(l,d);}};function j(){if(mstrApp.isSingleTier){if(n.operationMode===h.operationMode.create){J.call(l);}else{k();}return ;}if(n.folderID&&n.operationMode===h.operationMode.create&&!n.cubeID){X.call(l,d);}else{if(n.operationMode===h.operationMode.create){if(n.isManagedCube){n.cubeName=L.call(l,true);if(!n.isDirectDataAccess){b.call(l);}I.call(l,d);l.enableFinishButton(false);}else{if(mstrApp.saveCubeParams){e.call(l,d,mstrApp.saveCubeParams);}else{if(n.cubeID&&n.cubeName&&n.folderID){I.call(l,d);}else{n.cubeName=L.call(l);e.call(l,d);}}}}else{if((!n.isManagedCube||(n.isManagedCube&&n.cubePersisted))&&!n.folderID&&n.cubeID){l.dataService.getObjectFolder({success:function(q){if(q&&q.items&&q.items.length===1){n.folderID=q.items[0].fid;if(!n.isManagedCube&&!n.path){l.dataService.fetchFolderContents({success:function(u){var w="",t="";if(u&&u.sc&&u.sc.length>1){w=u.sc[0].did;t=u.sc[1].did;}l.dataService.getObjectFolder({success:function(x){if(x&&x.items&&x.items.length===1){n.path=x.items[0].path;k();}},failure:function(x){l.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,x.message);}},{dids:n.cubeID,types:3,sharedFolderId:w,myReportsId:t});},failure:function(t){l.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,t.message);}},{includeAncestorInfo:true,includeObjectDesc:false,folderLinksContextId:1,objectType:8});}else{k();}}},failure:function(q){l.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,q.message);}},{dids:n.cubeID,types:3});}else{if(!n.isManagedCube&&!n.path&&n.cubeID&&n.folderID){l.dataService.fetchFolderContents({success:function(t){var u="",q="";if(t&&t.sc&&t.sc.length>1){u=t.sc[0].did;q=t.sc[1].did;}l.dataService.getObjectFolder({success:function(w){if(w&&w.items&&w.items.length===1){n.path=w.items[0].path;k();}},failure:function(w){l.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,w.message);}},{dids:n.cubeID,types:3,sharedFolderId:u,myReportsId:q});},failure:function(q){l.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,q.message);}},{includeAncestorInfo:true,includeObjectDesc:false,folderLinksContextId:1,objectType:8});}else{k();}}}}}E.call(l,{success:function(){Z.call(l,{success:function(){var q={success:function(){if(n.operationMode!==h.operationMode.refresh){l.dataService.clearRelationship({success:function(){j();},failure:function(){j();}});}else{j();}},failure:function(t){l.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,t.message);}};l.dataService.toggleDatasetServeMode(q,{serveMode:n.isDirectDataAccess?h.datasetServeMode.dda:h.datasetServeMode.inMemory});}});}});},save:function(){var j=mstrApp.getRootController();var k={success:function(){j.showSaveVisual();}};var l={success:function(){var m=h.requestFlag.mapping|h.requestFlag.sourceInfo|h.requestFlag.relationship;j.model.set("isCubeSaved",true);j.getImportedDataEMMA(h.actions.none,m,undefined,undefined,undefined,undefined,k);},failure:function(m){j.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,m&&m.message);}};E.call(j,{success:function(){Z.call(j,{success:function(){T.call(j,l);}});}});},startSaveAndPublish:function(){this.hasPublishStarted=true;S.call(mstrApp.getRootController(),d);},refreshCubeWithoutSave:function F(){var k=mstrApp.getRootController();var j=k.model;var l={objName:j.cubeName,shouldSave:false,extParams:V.call()};var n={success:function(){O.call(k);},failure:function(m){f.call(k,m);}};k.dataService.saveAndPublishEMMA(n,l);},handleRepublishError:function(m){var j=mstrApp.getRootController(),l=j.getModel(),o=[],n=m.missingTableTbids,k=m.missingColumnTbids;var p={success:function(){I.call(j,d);},failure:function(q){j.displayError(mstrmojo.desc(13069,"Set refresh policy error."),false,q.message);}};N.forEach(k,function(t){var q=l.getImportSource(t);q.origRefreshType=q.refreshType;q.set("refreshType",h.cubeRefreshType.replaceTable);if(q.refreshType!==q.origRefreshType){o.push({did:q.tableID,tp:q.refreshType});}});N.forEach(n,function(t){var q=l.getImportSource(t);q.origRefreshType=q.refreshType;q.set("checked",false);q.set("refreshType",h.cubeRefreshType.preserve);if(q.refreshType!==q.origRefreshType){o.push({did:q.tableID,tp:q.refreshType});}});if(o.length>0){N.forEach(o,function(q){j.dataService.editEMMASourceTable(p,q);});}else{p.success();}},cancelRepublishError:function(o){var j=mstrApp.getRootController(),m=j.getModel(),p=o.missingTableTbids,l=o.missingColumnTbids,n=o.mismatchedDatatypeTbids,k=o.errorTableTbids;this.hasPublishStarted=false;m.getHistoryList().detachEventListener("canSendToHistoryListChange",this.id,"sendToHistoryList");m.getHistoryList().set("canSendToHistoryList",false);N.forEach(l,function(t){var q=m.getImportSource(t);q.set("hasSelectFile",false);});N.forEach(n,function(t){var q=m.getImportSource(t);q.set("hasSelectFile",false);});N.forEach(p,function(t){var q=m.getImportSource(t);q.set("hasSelectFile",false);});N.forEach(k,function(t){var q=m.getImportSource(t);q.set("hasSelectFile",false);});m.raiseEvent({name:"PublishStatusUpdate",reset:true,errors:o.errorTableErrCode});},sendToHistoryList:function K(){var j=mstrApp.getRootController();var k=j.model;if(k.getHistoryList().canSendToHistoryList){W.call();}else{if(this.hasPublishStarted===false){k.getHistoryList().attachEventListener("canSendToHistoryListChange",this.id,"sendToHistoryList");if(k.operationMode===h.operationMode.refresh){this.saveAndPublish();}if(k.operationMode===h.operationMode.edit){this.startSaveAndPublish();}}else{k.getHistoryList().attachEventListener("canSendToHistoryListChange",this.id,"sendToHistoryList");}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.StepperContentProvider","mstrmojo.num");var A=mstrmojo.num;function B(G,F){var H=F?G.max:G.min,D=F?G.min:G.max,E=G.getVal(F?1:-1);return(H===null||(F?(E<=H):(E>=H))||(D!==null&&G.canLoop));}function C(H,G){var F=H.min,D=H.max,E=H.getVal(G?1:-1);if((G&&D!==null&&E>D)||(!G&&F!==null&&(E<F))){if(H.canLoop){E=((E-F)%(D-F+1))+F;E=(E>=F)?E:E+(D-F+1);}else{return ;}}H.item[H.valField]=H.curVal=E;H.onTraverse();}mstrmojo.NumStepperContentProvider=mstrmojo.declare(mstrmojo.StepperContentProvider,null,{scriptClass:"mstrmojo.NumStepperContentProvider",curVal:null,init:function(E){this._super(E);var F=this.item,D=function(I){var H=I&&F[I];return(H===null||H===undefined);},G=function(I,K,H){var J=H&&D.call(this,K)?null:F[K];if(J!==null&&J!==undefined){this[I]=J;}};G.call(this,"min",this.minField,true);G.call(this,"max",this.maxField,true);G.call(this,"interval",this.intField);this._initCurrent();},_initCurrent:function(){var E=this.item,F=this.curVal=E[this.valField];if(F===null||F===undefined){var D=this.min;this.curVal=D!==null?D:0;}},next:function(){C(this,true);},prev:function(){C(this,false);},hasPrev:function(){return B(this,false);},hasNext:function(){return B(this,true);},renderItemAt:function(F){var E=this.getVal(F),D=this.renderer;return D?D.render(E,this):E;},getVal:function(D){return this.curVal+(this.interval*(D||0));},setVal:function(F){var G=this.min,D=this.max,E=this.getVal();if(typeof F!=="number"||isNaN(F)||F===E||A.inNumericRange(F,G,D)!==0){return ;}this.item[this.valField]=this.curVal=F;this.onTraverse();},onTraverse:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string");var B=mstrmojo.string;mstrmojo.Label=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Label",allowHTML:false,text:"",title:"",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click></div>',markupMethods:{ontitleChange:function(){this.domNode.title=this.title;},ontextChange:function(){var C=this.text;C=B.isEmpty(C)?"":C.toString();this.domNode.innerHTML=this.allowHTML?C:B.encodeHtmlString(C,true);},oncssTextChange:mstrmojo.Widget.cssTextMarkupMethod,onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod},autoHide:false,_set_text:function A(E,C){if(this.autoHide){this.set("visible",(C!==null)&&(C!=="")&&(C!==undefined));}var D=this.text;this.text=C;return(D!==C);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash");function A(H,E,G,F){var D=mstrmojo.hash.copy(F,{props:{left:{isStyle:true,start:H,stop:E,suffix:"px",ease:mstrmojo.ease.linear}},duration:G});(new mstrmojo.fx.AnimateProp(D)).play();}function B(K,N,G,L){var I=K.domNode,M=I.offsetWidth,D=K.scrollableIncFetch;var E=K.hasAnimation&&(!(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent))||Number(RegExp.$1)>3.5),J=L?1:-1,F=parseInt(M,10)*J,H=E?500:0;A(0,-F,H,{target:G,duration:H,preStart:function(){this.target.style.overflowY="hidden";},onEnd:function(){this.target.style.display="none";}});A(F,0,H,{target:N,preStart:function(){this.target.style.display="block";this.target.style.overflowY=(D?"visible":"auto");}});if(K.waiting){A(0,-F,H,{widget:K,slot:"loaderNode",onEnd:function(){this.widget.waiting=false;}});}}var C=function(D){var E=D.currentPage;if(E===D.p1Node){E=D.p2Node;}else{E=D.p1Node;}D.currentPage=E;};mstrmojo.Booklet=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Booklet",pageClass:"mstrmojo-BookletPage",markupString:'<div id="{@id}" class="mstrmojo-Booklet {@cssClass}" style="{@cssText}"><div id="{@id}_p1" class="mstrmojo-BookletPage" ></div><div id="{@id}_p2" class="mstrmojo-BookletPage" style="left:-100%;"></div><div id="{@id}_ldr" class="mstrmojo-BookletLoader" ></div></div>',markupSlots:{containerNode:function(){return this.domNode;},p1Node:function(){return this.domNode.firstChild;},p2Node:function(){return this.domNode.childNodes[1];},loaderNode:function(){return this.domNode.childNodes[2];}},markupMethods:{onnextChange:function(){var G=this.next;if(!G){return ;}var D=this.currentPage,F=this.p1Node,E=this.currentPage=(D==F)?this.p2Node:F;if(!(G instanceof mstrmojo.Obj)){G=this.next=mstrmojo.insert(G);}if(!G.hasRendered){G.placeholder=E.appendChild(document.createElement("span"));G.render();}else{if(E.firstChild){E.replaceChild(G.domNode,E.firstChild);}else{E.appendChild(G.domNode);}}this.set("waiting",false);if(E&&D){B(this,E,D,this.turnDirFwd);}else{if(this.scrollableIncFetch){E.style.overflowY="visible";}}},onwaitingChange:function(D){this.loaderNode.style.left=(this.waiting)?0:"-100%";},onheightChange:function(D){if(this.height){this.domNode.style.height=this.height;}},onwidthChange:function(D){if(this.width){this.domNode.style.width=this.width;}}},enabled:true,waiting:false,next:null,currentPage:null,turnDirFwd:true,hasAnimation:true,scrollableIncFetch:false,FORWARD:true,REVERSE:false,turnFwd:function(D){this.turn(D,this.FORWARD);},turnBack:function(D){this.turn(D,this.REVERSE);},turn:function(D,E){this.set("turnDirFwd",E);this.set("next",D);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.css");var G=mstrmojo.css,E={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"},C="sbClear",K="sbSearch";mstrmojo.SearchWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchWidget",quickSearch:false,placeholderText:"",markupString:'<table id={@id} cellspacing="0" cellpadding="0" class="mstrmojo-SearchWidget mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" style="width:{@width};" placeholder="{@placeholderText}" mstrAttach:keyup,blur/></div></td><td><div class="mstrmojo-SearchBox-clear" id="{@id}'+C+'" mstrAttach:click></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}'+K+'" mstrAttach:click ></div></div></td></tr></table>',markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},clearNode:function(){return this.domNode.rows[0].cells[1].firstChild;},searchNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},markupMethods:{onquickSearchChange:function(){G.toggleClass(this.domNode,"quick-search",this.quickSearch);},onwidthChange:function(){if(this.inputNode&&this.inputNode.style&&this.inputNode.style.width){this.inputNode.style.width=this.width;}}},clearNode:null,searchNode:null,onsearch:mstrmojo.emptyFn,onclear:mstrmojo.emptyFn,prekeyup:function J(M){var L=M.hWin,Q=M.e||L.event;var O=this.getSearchPattern(),N=(O.length===0),P=this.quickSearch;G.toggleClass(this.clearNode,"show",!N&&!P);G.toggleClass(this.searchNode,"clear",!N&&P);if(P){this[N?"clearSearch":"onsearch"](O);}var R=E[Q.keyCode];if(this["on"+R]){this["on"+R](M);}},onEnter:function B(L){this.onsearch(this.getSearchPattern());},onEsc:function A(L){this.clearSearch();},getSearchPattern:function H(){return mstrmojo.string.trim(this.inputNode.value);},preclick:function F(L){var N=L.getTarget(),M=N&&N.id;switch(M.replace(this.id,"")){case K:if(this.quickSearch){this.clearSearch();}else{this.onsearch(this.getSearchPattern());}break;case C:this.clearSearch();break;}},clearSearch:function I(){var L=this.getSearchPattern();this.reset();this.onclear(L);},reset:function D(){this.inputNode.value="";G.removeClass(this.clearNode,"show");G.removeClass(this.searchNode,"clear");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.ui._HasScroller","mstrmojo.css");var C=mstrmojo.css,E=mstrmojo.desc(14058,"Show Details"),A=mstrmojo.desc(14059,"Hide Details"),F=mstrmojo.desc(14060,"We are sorry for the inconvenience. Please {contact} your administrator for help.").replace("{",'<span class="dyn-link">').replace("}","</span>");mstrmojo.ui.editors.ErrorDialogContent=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",markupString:'<div class="mstrmojo-error-content" mstrAttach:click><div class="scroll-container"><div>{@shortDesc}</div><div>'+F+'</div><div class="toggle-details-link" >'+E+'</div><div class="error-details">{@en@longDesc}</div></div></div>',markupSlots:{scrollNode:function(){return this.domNode.firstChild;},contactNode:function(){return this.domNode.firstChild.children[1].getElementsByClassName("dyn-link")[0];},toggleDetailsNode:function(){return this.domNode.firstChild.children[2];}},markupMethods:{onshowDetailsChange:function(){var H=this.showDetails;this.toggleDetailsNode.innerHTML=H?A:E;C.toggleClass(this.domNode,"show-details",H);this.updateScrollbars();}},shortDesc:undefined,longDesc:undefined,showDetails:false,init:function G(H){this._super(H);this.shortDesc=this.shortDesc||mstrmojo.desc(14061,"An error has occurred");},onclick:function B(H){var J=H.getTarget(),I,K=this.longDesc;if(J===this.contactNode){I="mailto:?subject="+encodeURI("Issue: "+this.shortDesc)+(K?("&body="+encodeURI("Detail:\r\n"+K)):"");mstrApp.openPage(I,"_self");}else{if(J===this.toggleDetailsNode){this.set("showDetails",!this.showDetails);}}},setupScrollNodes:function D(){this.scrollNode=this.scrollNode;}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Widget","mstrmojo._ListSelections");var E=mstrmojo.dom;mstrmojo.ListBase=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.ListBase",selectionPolicy:null,itemRenderer:null,icnCssText:"",icnCss:"",markupString:'<div id="{@id}" tstid="{@tstid}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div>',markupSlots:{itemsContainerNode:function G(){return this.domNode.firstChild;},scrollboxNode:function A(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},autoHide:false,itemsContainerNode:null,_markupPrefix:null,_markupSuffix:null,_itemPrefix:null,_itemSuffix:null,init:function J(K){this._super(K);if(this.autoHide){this.visible=!!(this.items&&this.items.length);}},buildRendering:function D(){this.itemsHtml="";var K=(this.renderOnScroll?this.items&&((this.renderIndex+1)*this.renderBlockSize):this.items&&this.items.length);if(K){this.itemsHtml=this._buildItemsMarkup(0,K-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");}this._super();delete this.itemsHtml;this.addSlots({itemsNode:this.itemsContainerNode.firstChild});},_buildItemsMarkup:function B(K,N,U,L,V,M){var W=[],Q=0;W[Q++]=U||"";var P=this.itemRenderer,T=P&&P.render;if(T&&typeof T==="function"){var R=this.items,S=Math.min(N+1,((R&&R.length)||0)),O;for(O=K;O<S;O++){W[Q++]=V||"";W[Q++]=T(R[O],O,this);W[Q++]=M||"";}}W[Q+1]=L||"";return W;},onselectionChange:function H(V){if(!V){return ;}var S=this.itemRenderer;if(!S){return ;}var O=S.unselect,R=this.items||[],W=V.removed,N,M,L,P,X;if(O&&W){for(P=0,X=W.length;P<X;P++){N=W[P];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){O(L,R[N],M,this);}}}var K=S.select,U=V.added,Q,T;if(K&&U){for(Q=0,T=U.length;Q<T;Q++){N=U[Q];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){K(L,R[N],M,this);}}}if(this.onchange){this.onchange({added:V.added,removed:V.removed});}},_set_items:function C(N,K){this.renderIndex=0;if(this.autoHide){this.set("visible",!!(K&&K.length));}var M=this.items;this.items=K;if(M!==K){var L=this.hasRendered;if(L){this.unrender(false);}this.clearSelect();if(L){this.render();}return true;}return false;},onItemContextMenu:mstrmojo.emptyFn,oncontextmenu:function F(K){E.preventDefault(window,K.e);var M=K.getTarget(),L=this.getItemFromTarget&&this.getItemFromTarget(M);if(L){if(this.onItemContextMenu(L,K)){K.cancel();}}},_getItemNode:function I(K){var L=this.itemsContainerNode;return(L&&L.childNodes[K])||null;},renderOnScroll:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasLayout","mstrmojo.css","mstrmojo.string");var G=mstrmojo.css,D="clear";function E(){this.searchTriggered(this.inputNode.value);}mstrmojo.ui.SearchBox=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.SearchBox",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><input class="mstrmojo-ui-sb-input" type="text" mstrAttach:keyup,blur/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',markupSlots:{inputNode:function H(){return this.domNode.firstChild;},searchNode:function B(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{h:{inputNode:"20px",searchNode:"20px"},w:{inputNode:"100%",searchNode:"22px"},xt:true},getLayoutOffsets:function(){return{w:2,h:0};},searchNode:undefined,inputNode:undefined,searchDelay:-1,init:function K(N){this._super(N);var M=this.searchDelay;if(M===-1||isNaN(M)){this.searchDelay=parseInt(mstrApp.getSearchAutoCompleteDelay(),10);}},onclick:function L(M){var N=M.getTarget();if(N===this.searchNode){if(this._hasText){this.clearSearch();}else{E.call(this);}}},onkeyup:function A(O){var N=O.hWin,R=O.e||N.event;if(R.keyCode===27){this.clearSearch();return ;}var Q=this,M=this.text,S=this.text=this.inputNode.value,P=this._hasText=S.length>0;if(M!==S){G.toggleClass(this.searchNode,[D],P);window.clearTimeout(this._searchTimeoutId);this._searchTimeoutId=window.setTimeout(function(){E.call(Q);},this.searchDelay);}},unrender:function F(){this.text="";this._super();},clearSearch:function I(M){this.text=this.inputNode.value="";G.removeClass(this.searchNode,[D]);delete this._hasText;if(!M){E.call(this);}this.postClearSearch();},isClear:function C(){return !this.text||this.text.length===0;},postClearSearch:mstrmojo.emptyFn,searchTriggered:function J(M){}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.css","mstrmojo.string");function C(H,D,E){var K=[];var G=H.optionRenderer,I=G&&G.render;if(I&&typeof I==="function"){var L=H.options,J=Math.min(E,((L&&L.length)||0)),F;for(F=D;F<J;F++){K.push(I(L[F],F,H));}}return K.join("");}mstrmojo.DropDownList=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.DropDownList",title:"",selectCssClass:"",tooltip:"",cssDisplay:"inline",value:"",unset:false,options:null,optionValueField:"v",optionNameField:"n",idx:-1,renderedOptions:"",markupString:'<span id="{@id}"  class="mstrmojo-DropDownList {@cssClass}">{@title}<select id="{@id}_select" class="mstrmojo-DropDownList-select {@selectCssClass}"  style="{@cssText}" title="{@tooltip}"onchange="mstrmojo.all[\'{@id}\'].set(\'selected\', this.options[this.selectedIndex].value);">{@renderedOptions}</select><div class = "strikeoutContainer"></div></span>',markupSlots:{selectNode:function(){return this.domNode.getElementsByTagName("select")[0];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onidxChange:function(){var D=this.domNode.getElementsByTagName("select");if(D&&D.length){D[0].selectedIndex=this.idx;}},onvalueChange:function(){var I=this.selectNode,G=I.options,F=this.value,E,H;for(H=0;H<G.length;H++){var D=G[H].value.toString()===F;if(D){E=H;if(F!==""){mstrmojo.css.toggleClass(G[H],"selected",D);}break;}}if(I.length>0&&E>0&&this.unset){if(this.options[0].v==="-1"){I.remove(0);E--;}this.unset=false;}this.set("idx",E);},onwidthChange:function(){var D=this.width;if(D>=0){this.selectNode.style.width=D+"px";}}},_set_selected:function(G,D){var E=this.selectNode,F=this[G]!==D;this[G]=D;if(E){this.set("value",D);}return F;},preBuildRendering:function A(){var F=this;if(F.unset){F.idx=0;}var E=F.options,D=(E&&E.length)||0;if(D){F.renderedOptions=C(F,0,D);}return this._super();},optionRenderer:{render:function(E,D,F){return mstrmojo.string.apply(F.getOptionMarkup(E),F.getOptionProps(E,D));}},getOptionMarkup:function(D){return'<option value="{@en@v}" class="{@cls}" style="{@style}" {@sel}>{@en@n}</option>';},getOptionProps:function B(F,D){var G=this,H=F[G.optionValueField],E=D===parseInt(G.idx,10);G.selected=G.value=E?H.toString():G.value;return{cls:E?"selected":"",v:H===undefined?"":H,n:F[G.optionNameField]||"",style:"",sel:E?"selected":""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.Widget");var R=["(",")","{","}","-","+","*","/","<",">","|","~",","],G={" ":true,"@":true},Q=null;function J(V){if(!Q){Q={};var U,T;for(U=0,T=R.length;U<T;U++){Q[R[U]]=true;}}return Q.hasOwnProperty(V);}function S(V){if(!V){return false;}var T=V.length,U,W;for(U=0;U<T;U++){W=V.charAt(U);if(J(W)||G[W]){return true;}}return false;}function A(T){return S(T)?"["+T+"]":T;}var M={8:true,9:true,10:true};var C=function(U,T){return M[U]&&!/^\".*\"$/.test(T)?'"'+T+'"':T;};var D=function(U,T,V){var W=typeof V==="undefined"?true:M[V];return U.tp===261&&T.length>=2&&W?(/^\s+$/.test(T.substr(1,T.length-2))?T:T.substr(1,T.length-2)):T;};mstrmojo.ME.MetricToken=mstrmojo.declare(mstrmojo.Widget,null,{data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}"></span>',active:false,markupMethods:{ondataChange:function(){var U=this.data,T=mstrmojo.string.encodeHtmlString(String(U.v));if(U.v===","){this.domNode.innerHTML=T+"&nbsp;";}else{if(U.tp===259&&U.v==="Desc"){this.domNode.innerHTML="&nbsp;"+T;}else{this.domNode.innerHTML=T;}}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());mstrmojo.css.toggleClass(this.domNode,["nfn"],!this.isFunction());mstrmojo.css.toggleClass(this.domNode,["invalid"],U.sta===-1);},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);}},isMstrO:function P(){return !!this.data.oi||!!this.data.rfd;},isFunction:function B(){return this.isMstrO()&&(this.data.oi&&this.data.oi.t==11);},brackets:A,length:function E(){return this.data.v.toString().length;},isDelimiter:function O(){return this.data.isDelimiter||(this.length()===1&&J(this.data.v));},split2Tokens:function H(W){var V=this.data,U=V&&V.v.toString(),X=U.substring(0,W),T=U.substring(W);return[{v:X,isNew:true},{v:T,isNew:true}];},mergeTo:function I(U){var W=this.data,V=W&&W.v.toString(),T=U.data.v.toString();return{v:V+T,isNew:true};},brackets:A,setItemInfo:function N(T){var U=this.data;U.v=this.brackets(T.n);U.oi=T;U.sta=1;U.isNew=true;this.set("data",U);this.paint();},spliceContent:function K(Z,X,U){var Y=this.data,W=Y&&Y.v.toString(),a=W.substring(0,Z);X=(X===null||X===undefined)?(W.length-Z):X;var T=W.substring(Z+X),V=a+(U||"")+T;Y.v=V;Y.isNew=true;Y.sta=1;Y.ift=(this.isAttributeToken()||Y.at)&&(Y.v.indexOf("@")>=0);if(Y.ift){Y.at=Y.oi||Y.at;}else{delete Y.at;}delete Y.oi;delete Y.exv;delete Y.extp;delete Y.tp;this.set("data",Y);this.paint();},isAttributeToken:function F(){return this.data&&this.data.oi&&this.data.oi.t===12;},setFormInfo:function L(U){var V=this.data,T=V.oi||V.at;V.v=this.brackets(T.n)+"@"+this.brackets(U.n);V.exv=U.did;V.extp=8;V.sta=1;V.isNew=true;V.oi=V.at;delete V.at;this.set("data",V);this.paint();}});mstrmojo.ME.MetricToken.isDelimiter=J;mstrmojo.ME.MetricToken.brackets=A;mstrmojo.ME.MetricToken.quotes=C;mstrmojo.ME.MetricToken.unquotes=D;mstrmojo.ME.MetricToken.QUOTABLE_DATATYPES=M;mstrmojo.ME.MetricToken.argDelimiter={".":",",",":";"}[mstrConfig&&mstrConfig.decimalSep]||",";})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash","mstrmojo.css","mstrmojo.string");function A(C,B){return mstrmojo.hash.copy(B,{label:"",tabIndex:"",cssDisplay:"inline",name:null,markupString:'<span id="{@id}" class="'+C+' {@cssClass}" style="{@cssText}" title="{@tooltip}"><input id="{@id}_input"  type="{@type}" name="{@name}" value="{@value}" tabIndex="{@tabIndex}" mstrAttach:click tstid="{@tstid}"/><label for="{@id}_input">{@label}</label></span>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},labelNode:function(){return this.domNode.childNodes[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";},onenabledChange:function(){this.inputNode.disabled=!this.enabled;mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,"disabled");},onlabelChange:function(){this.labelNode.innerHTML=mstrmojo.string.encodeHtmlString(this.label);},oncheckedChange:function(){this.inputNode.checked=this.checked;}},checked:false,preclick:function(){this.set("checked",this.inputNode.checked);},isChecked:function(){return this.inputNode.checked;}});}mstrmojo.CheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox",{scriptClass:"mstrmojo.CheckBox",type:"checkbox"}));mstrmojo.ImageCheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox mstrmojo-ImageCheckBox",{scriptClass:"mstrmojo.CheckBox",type:"image",cssDisplay:"block",preclick:function(){this.set("checked",!this.checked);},postCreate:function(){this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.oncheckedChange=function(){mstrmojo.css.toggleClass(this.inputNode,["checked"],this.checked);};},postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";if(this._super){return this._super();}return true;}}));mstrmojo.RadioButton=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-RadioButton",{scriptClass:"mstrmojo.RadioButton",type:"radio",postBuildRendering:function(){if(mstrmojo.dom.isIE){this.inputNode.checked=this.checked;}}}));}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.WaitIcon=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.WaitIcon",cssFloat:"left",visible:false,markupString:'<div id="{@id}" class="mstrmojo-WaitIcon {@cssClass}" style="float:{@cssFloat};{@cssText};"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.css");var C=mstrmojo.Widget;mstrmojo.ui.Checkbox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ui.Checkbox",markupString:'<div id="{@id}" class="mstrmojo-ui-Checkbox {@cssClass}" mstrAttach:click></div>',markupMethods:{onvisibleChange:C.visibleMarkupMethod,oncheckedChange:function B(){mstrmojo.css.toggleClass(this.domNode,"checked",this.checked);},onenabledChange:C.enabledMarkupMethod},checked:false,onclick:function A(){this.set("checked",!this.checked);}});}());(function(){mstrmojo.requiresCls("mstrmojo.boxmodel","mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Widget","mstrmojo.Arr","mstrmojo._HasLayout","mstrmojo._ListBase2Selections","mstrmojo.ListSelector","mstrmojo._TouchScrolling","mstrmojo._PagingList");var a=mstrmojo.hash,f=mstrmojo.array,e=mstrmojo.boxmodel,c=mstrmojo.dom;function A(j,l,h){var k=j.listSelector;if(k){k[l](j,j.itemsContainerNode,h);}}function L(j,h){var k=j.lastPagePos;if(!k||k.dragId!==h){k=e.offset(j.itemsContainerNode);k.dragId=h;j.lastPagePos=k;var l=j.scrollboxNode;j.lastScrollPos={left:l.scrollLeft,top:l.scrollTop,width:l.clientWidth,height:l.clientHeight};}}function O(l,o,j){var k=o&&o.node;if(k===l.dropCueNode||k===l.dropCueNode.firstChild){return l.dropCuePos;}var m=l.listMapper;var h=m&&m.whereDrop(l,l.itemsContainerNode,k,o.pos,{left:l.lastPagePos.left-l.lastScrollPos.left,top:l.lastPagePos.top-l.lastScrollPos.top,width:l.lastScrollPos.width,height:l.lastScrollPos.height});var n=l.dropCuePos;return((j!==false)&&n&&h&&(n.idx===h.idx)&&(n.left===h.left)&&(n.top===h.top))?n:h;}var g="attachEventListener";function D(j,h){if(j.makeObservable){h=h||[];if(!h[g]){mstrmojo.hash.make(h,j.itemsScriptClass||mstrmojo.Arr);}}return h;}function H(j,h){if(h&&h[g]){j._sub_its=h;j._sub_add=h[g]("add",j.id,"preadd");j._sub_rmv=h[g]("remove",j.id,"preremove");}}function G(h){if(h._sub_its){var j=mstrmojo.publisher;j.unsubscribe(h._sub_add);j.unsubscribe(h._sub_rmv);delete h._sub_add;delete h._sub_rmv;delete h._sub_its;}}mstrmojo.ListBase2=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListBase2Selections,mstrmojo._TouchScrolling,mstrmojo._PagingList,mstrmojo._HasLayout],{scriptClass:"mstrmojo.ListBase2",items:null,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode;},itemsContainerNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},ondropCuePosChange:function(){var j=this.dropCueNode,h=j&&j.style;if(!h){return ;}var l=this.dropCuePos,k=!!l;if(k){h.left=l.left+"px";h.top=l.top+"px";}h.display=k?"block":"none";},onpageChange:function(){if(this.usePaging&&!this._inScroll){this._inPaging=true;this.listMapper.toPage(this,this.page);this._inPaging=false;}},onwidthChange:function(){if(!isNaN(parseInt(this.width))){this.domNode.style.width=this.width;}},onheightChange:function(){if(!isNaN(parseInt(this.height))){this.domNode.style.height=this.height;}}},autoHide:false,renderOnScroll:false,firstRenderBlockSize:50,renderBlockSize:50,listMapper:null,listBuilder:null,listSelector:mstrmojo.ListSelector,animate:false,itemsEffect:null,containerResizable:true,init:function Z(m){this._super(m);this.items=this.initItems(this.items);var l=this.selectedIndices,j=this.selectedIndicesList,k=this.selectedIndex,n=this.selectedItem;this.selectedIndices={};this.selectedIndex=-1;delete this.selectedIndicesList;delete this.selectedItem;if(l||j||(k>-1)||n){this.initSelections(l,j,k,n);}if(this.postInitItems){this.postInitItems();}},initItems:function I(h){return D(this,h);},preBuildRendering:function W(){var m=this.listBuilder,p=m.newContext(this);this.ctxtBuilder=p;var j=this.markupSlots,l=!!(this.renderOnScroll&&this.renderBlockSize&&j&&j.scrollboxNode),k=this.items,h=(k&&k.length)||0,n=l?this.firstRenderBlockSize:h,o=l?this.firstRenderBlockSize:0;this._eros=l;this.paused=false;this.itemsHtml=this.listMapper.buildItemWrappers(k,m,this,p,n,o).join("");this.itemsContainerCssText="visibility: hidden";if(this._super){this._super();}},postBuildRendering:function E(){delete this.itemsHtml;var m=this.listMapper;if(m&&m.postBuildRendering){m.postBuildRendering(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder);}H(this,this.items);if(this._eros||this.usePaging){if(!this._cb_scroll){var p=this.id;this._cb_scroll=function(){var n=mstrmojo.all[p];n.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);this.onscroll();}if(this.animate){for(var k=0,j=["itemsEffect","scrollEffect"],h=j.length;k<h;k++){var o=j[k],l=this[o];if(l&&l.constructor===Object){l=mstrmojo.insert(mstrmojo.hash.clone(l));l.widget=this;this[o]=l;}}if(this.itemsEffect){this.itemsEffect.play();}}this.itemsContainerNode.style.visibility="inherit";if(this.containerResizable&&this.itemsContainerNode.scrollWidth<this.domNode.scrollWidth){this.itemsContainerNode.style.width=this.domNode.scrollWidth+"px";}if(this._super){this._super();}},unrender:function X(l){G(this);if(this._eros){mstrmojo.dom.detachEvent(this.scrollboxNode,"scroll",this._cb_scroll);delete this._cb_scroll;}for(var j=0,k=["itemsEffect","scrollEffect"],h=k.length;j<h;j++){var m=this[k[j]];if(m&&m.isPlaying){m.cancel();}}this._super(l);},pauseScrollRendering:function P(k,h,j){if(k!==false){k=true;}if(this.paused===!!k){return ;}this.paused=!!k;if(k){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}}else{this.fill(h,j);}},onscroll:function K(){if(this.paused){return ;}if(this._eros){if(!this._fillTmr){var h=this;this._fillTmr=self.setTimeout(function(){h.fill();h=null;},50);}}if(this._super){this._super();}},fill:function b(h,m){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}var n=(this.items&&this.items.length)||0;if(!n){if(m){m();}}else{var k=this.scrollboxNode,o=this.itemsContainerNode,l=mstrmojo.boxmodel.offset(o,k),q=this.listMapper,p=q.findScrollRange(o,n,(this.usesTouches&&this.pos&&parseInt(this.pos.y,10))||k.scrollTop,k.clientHeight,(this.usesTouches&&this.pos&&parseInt(this.pos.x,10))||k.scrollLeft,k.clientWidth,l.left,l.top);if(this.fillAt(p.start,p.end)){if(h){h();}var j=this.id;this._fillTmr=window.setTimeout(function(){mstrmojo.all[j].fill(h,m);},100);}else{if(m){m();}}}},fillAt:function M(k,j){var h=this.listMapper;if(h){return h.fillItemWrappers(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder,k,j,this.renderBlockSize);}else{return false;}},add:function R(j,h){if(!j||!j.length){return -1;}var k=this.items;if(h==null){h=a.min(this.selectedIndices,false,true);if(h!==null&&h!==undefined){h++;}}if(h==null||h===-1){h=(k&&k.length)||0;}if(k&&k.add){k.add(j,h);}else{this.set("items",k?f.insert(k.concat(),h,j):j);}return h;},preadd:function B(k){if(this.hasRendered){var n=this.listMapper;if(n){n.onadd(this,this.itemsContainerNode,this.ctxtBuilder,k);}var m=this.listBuilder;if(m){m.onadd(this,this.ctxtBuilder,k);}var j=this.listSelector;if(j){j.onadd(this,k);}if(this._eros){this.onscroll();}else{var l=k.index,h=k.value.length;this.fillAt(l,l+h-1);}}if(this.onadd){this.onadd(k);}if(this._super){this._super(k);}},remove:function U(h){if(h==null){return -1;}if(h.constructor!==Array){return this._remove(h);}var k=this.items;if(k){var j;if(k.remove){for(j=h.length-1;j>-1;j--){k.remove(h[j],1);}}else{k=k.concat();for(j=h.length-1;j>-1;j--){k.splice(h[j],1);}this.set("items",k);}return h[0];}return -1;},_remove:function U(k){var j=this.items;if(!j||(k==null)){return -1;}var h;if(!isNaN(k)){h=k;}else{h=this.itemIndex(k);}if(h>-1){if(j.remove){j.remove(h,1);}else{j=j.concat();j.splice(h,1);this.set("items",j);}}return h;},duplicate:function Y(n,j,k){var l=this.items,h=-1;if(!l||(n==null)){return -1;}if(!isNaN(n)){if(j===null||j===undefined){j=n+1;}n=l[n];}else{if(j===null||j===undefined){j=this.itemIndex(n)+1;}}if(n){var m;m=a.copy(k,a.clone(n));h=this.add([m],j);}return h;},preremove:function N(j){if(this.hasRendered){var l=this.listMapper;if(l){l.onremove(this,this.itemsContainerNode,this.ctxtBuilder,j);}var k=this.listBuilder;if(k){k.onremove(this,this.ctxtBuilder,j);}var h=this.listSelector;if(h){h.onremove(this,j);}if(this._eros){this.onscroll();}}if(this.onremove){this.onremove(j);}if(this._super){this._super(j);}},move:function S(l,t){function p(w,u){w=parseInt(w,10);return u===1||(t>=w&&t<w+u);}var q=(this.items&&this.items.length)||0;if(t===-1||t==null||isNaN(t)){t=q;}else{t=Math.min(t,q);}var k,h,n,m;if(l.constructor===Array){h=l;n=l;m=(h&&h.length)||0;if(p(l[0],l.length)){return false;}k=f.get(this.items,l);}else{if(typeof (l)==="object"){k=[l];m=1;h=this.itemIndex(k[0]);n=[h];if(p(h,1)){return false;}}else{h=l;n=[l];m=1;if(p(h,1)){return false;}k=[this.items[h]];}}var o=0;for(var j=0;j<m;j++){if(n[j]<=t){t--;o++;}}if(o==n.length){t++;}if(k[0]!=null){this.remove(h);this.add(k,t);}return true;},itemIndex:function F(h){if(h==null){return -1;}var j=this.itemIdField;return j?f.find(this.items,j,h[j]):f.indexOf(this.items,h);},prechange:function T(k){if(this.hasRendered){var j=[this.listBuilder,this.listMapper];for(var l=0,h=j.length;l<h;l++){var m=j[l];if(m&&m.onchange){m.onchange(this,this.itemsContainerNode,this.ctxtBuilder,k);}}}},makeObservable:false,_set_items:function J(o,h){var m=this.items;h=this.initItems(h);this.items=h;if(m!==h){var l=this,k=function(){if(l.autoHide){l.set("visible",!!(h&&h.length));}l=null;},j=this.hasRendered;if(j){this.refresh(k);}else{k();}}return m!==h;},premousedown:function d(h){A(this,"premousedown",h);},premouseup:function Q(h){A(this,"premouseup",h);},scrollTo:function V(j){var h,k=this.listMapper;if(k&&k.toItem){if(!isNaN(j)){h=j;}else{h=this.itemIndex(j);}if(h>=0){k.toItem(this,h);}}},draggable:false,getDragData:function(m){L(this,m.id);var k=O(this,m.src),j=k&&k.idxActual;if((j>-1)&&this.selectedIndices[j]){var l=this.sortSelectedIndices(),h=f.get(this.items,l)||[];switch(h.length){case 1:return a.copy({html:h[0][this.itemDisplayField],index:l[0]},a.copy(h[0]));case 0:return null;default:return a.copy({html:h.length+" selections",indices:l},h);}}},dropZone:false,ondragenter:function(h){L(this,h.id);this.set("dropCuePos",O(this,h.tgt));},ondragover:function(h){this.set("dropCuePos",O(this,h.tgt));},ondragleave:function(h){this.set("dropCuePos",null);},isDragValid:function C(h){return h&&h.src&&h.src.data;},ondragstart:function(h){if(!(h&&h.src&&h.src.data)){return false;}},allowCopy:false,ondragend:function(l){var j=l&&l.tgt,h=j&&j.widget;if(h===this){}else{if(this.tree&&h&&h.tree===this.tree){if(!this.allowCopy||!c.ctrlKey(j.hWin,j.e)){var k=l.src&&l.src.data;if(k&&(k.indices||(k.index!==null))){this.remove(k.indices||k.index);}}}}},ondrop:function(q){var w=q&&q.src,p=w&&w.data;if(p){var k=O(this,q.tgt,false),t=k&&k.idx,l=(p&&p.constructor===Array),j=this.sortSelectedIndices();var n=this.items;t=Math.min(t,n&&n.length)||0;var u=true;if(w.widget===this){u=this.move(j,t);f.forEach(j,function(x){if(x<=t){t--;}});}else{this.add(l?p:[p],t);}if(u){var o=l?p.length:1,h={};for(var m=0;m<o;m++){h[t+m]=true;}this.set("selectedIndices",h);}}this.set("dropCuePos",null);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.Refine.SliderWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.SliderWidget",sliderNode:null,options:null,range:{min:0,max:1,step:1,from:0,to:0},drag:null,postCreate:function(){var A=this;this._mouseMoveHandler=function(B){return A._onMouseMove(B);};this._mouseUpHandler=function(B){return A._onMouseUp(B);};this.initializeUI();this.updateRange();},initializeUI:function(){var A=this;this.leftTintedRect=document.createElement("div");this.leftTintedRect.className="slider-widget-tint left";this.sliderNode.appendChild(this.leftTintedRect);this.rightTintedRect=document.createElement("div");this.rightTintedRect.className="slider-widget-tint right";this.sliderNode.appendChild(this.rightTintedRect);this.highlightRect=document.createElement("div");this.highlightRect.className="slider-widget-highlight slider-widget-draggable";this.highlightRect.setAttribute("part","highlight");this.sliderNode.appendChild(this.highlightRect);this.highlightRect.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);this.leftBracket=document.createElement("div");this.leftBracket.className="slider-widget-bracket slider-widget-draggable left";this.leftBracket.setAttribute("part","left");this.sliderNode.appendChild(this.leftBracket);this.leftBracket.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);this.rightBracket=document.createElement("div");this.rightBracket.className="slider-widget-bracket slider-widget-draggable right";this.rightBracket.setAttribute("part","right");this.sliderNode.appendChild(this.rightBracket);this.rightBracket.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);},_onMouseDown:function(A,C){if(this.drag){return ;}document.addEventListener("mousemove",this._mouseMoveHandler,false);document.addEventListener("mouseup",this._mouseUpHandler,false);var B=document.createElement("div");B.className="slider-widget-overlay";document.body.appendChild(B);this.drag={sureDrag:false,overlay:B};if("highlight"===C){this.drag.elmt=this.highlightRect;this.drag.value=this.range.from;this.drag.overlay.style.cursor="move";}else{if("left"===C){this.drag.elmt=this.leftBracket;this.drag.overlay.style.cursor="e-resize";}else{if("right"===C){this.drag.elmt=this.rightBracket;this.drag.overlay.style.cursor="w-resize";}}}this.drag.what=C;this.drag.from=this.range.from;this.drag.to=this.range.to;this.drag.down={x:A.pageX,y:A.pageY};},_onMouseUp:function(){if(!(this.drag)){return ;}document.removeEventListener("mousemove",this._mouseMoveHandler,false);document.removeEventListener("mouseup",this._mouseUpHandler,false);if(this.drag.sureDrag){this.updateRange();this.trigger("stop");}document.body.removeChild(this.drag.overlay);this.drag=null;},_onMouseMove:function(H){if(!(this.drag)){return true;}var C=this.drag;var D=this.range;var F=H.pageX-C.down.x;if(Math.abs(F)>=2){C.sureDrag=true;}var E=this.sliderNode.clientWidth;var A=E/(D.max-D.min);var I=F/A;var G=function(){D.from=C.from+Math.floor(I/D.step)*D.step;D.from=Math.max(Math.min(D.from,D.max),D.min);};var B=function(){D.to=C.to+Math.floor(I/D.step)*D.step;D.to=Math.max(Math.min(D.to,D.max),D.min);};if(C.what==="left"){G();D.to=Math.min(Math.max(D.to,D.from+D.step),D.max);}else{if(C.what==="right"){B();D.from=Math.max(Math.min(D.from,D.to-D.step),D.min);}else{G();B();}}this.updateRange();this.trigger("slide");H.preventDefault();return false;},trigger:function(A){this.parent.raiseEvent({name:A,from:this.range.from,to:this.range.to});},updateRange:function(){var A=this.range;var F=this.sliderNode.clientWidth;var E=F/(A.max-A.min);var B=function(G){return(G-A.min)*E;};var C=Math.floor(B(A.from));var D=Math.floor(B(A.to));if(A.from===A.min&&A.to===A.max){this.leftTintedRect.style.display="none";this.rightTintedRect.style.display="none";}else{this.leftTintedRect.style.display="block";this.leftTintedRect.style.width=C+"px";this.rightTintedRect.style.display="block";this.rightTintedRect.style.width=(F-D)+"px";}this.highlightRect.style.width=(D-C)+"px";this.highlightRect.style.left=C+"px";this.leftBracket.style.left=C+"px";this.rightBracket.style.left=D+"px";},update:function(B,A,C,E,D){if(C<=0){C=1;}A=Math.max(A,B+C);E=E!==null?Math.max(B,E):B;D=D!==null?Math.min(A,D):A;this.range={min:B,max:A,step:C,from:E,to:D};this.updateRange();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var C=mstrmojo.dom,B=mstrmojo.hash,E=mstrmojo.css;mstrmojo.Button=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Button",iconClass:"",innerIconClass:"",title:"",text:"&nbsp;",enabled:true,selected:false,markupString:'<div id="{@id}" class="mstrmojo-Button {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:touchstart,click,mousedown,mouseup><div class="mstrmojo-Button-text {@innerIconClass}"></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){E.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){E.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;},onwidthChange:mstrmojo.Widget.widthMarkupMethod},oniconClassChange:function D(J){var K=this.domNode;if(this.hasRendered&&K){K.className=K.className.replace(J.valueWas,"")+" "+J.value;}},onclick:mstrmojo.emptyFn,ontouchend:function I(J){this.onclick(J);}});mstrmojo.Button.newIconButton=function H(L,O,M,J,N){var K={scriptClass:"mstrmojo.Button",title:L,cssClass:O,text:"",onclick:M};if(J){K.bindings=J;}B.copy(N,K);return K;};function F(M,N,J,P){var L=[];if(J){L.push(J);}var O=P&&P.cssClass;if(O){L.push(O);delete P.cssClass;}var K={scriptClass:"mstrmojo.Button",cssClass:L.join(" "),text:M};if(N){K.onclick=N;}return B.copy(P,K);}mstrmojo.Button.newInteractiveButton=function G(M,N,P,O){var L={glowClass:"glow"};if(P&&(C.isFF||C.isWK)){B.copy({onmousedown:function J(){E.applyShadow(this.domNode,0,0,10,P);},onmouseup:function K(){E.removeShadow(this.domNode);}},L);}return F(M,N,"mstrmojo-InteractiveButton",B.copy(O,L));};mstrmojo.Button.newWebButton=function A(K,J,M,L){return F(K,J,"mstrmojo-WebButton"+(M?" hot":""),L);};mstrmojo.Button.newActionButton=function(K,L,M){var J=mstrmojo.Button.newWebButton(K,L,false,M);J.cssClass=J.cssClass+" action-button";return J;};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom");var B="mstrmojo-Image";mstrmojo.Image=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Image",markupString:'<div id="{@id}" class="'+B+' {@cssClass}" style="{@cssText}" mstrAttach:click><image src="{@src}" mstrAttach:load /></div>',markupSlots:{imgNode:function(){return this.domNode.firstChild;}},markupMethods:{onsrcChange:function(){var C=this.imgNode;if(C){C.src=this.src||"../javascript/mojo/css/images/1ptrans.gif";}},oncssClassChange:function(){var C=this.domNode;if(C){C.className=this.cssClass||B;}},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},src:"",getImageSize:function A(){var C=this.imgNode;return{w:C.clientWidth,h:C.clientHeight};}});mstrmojo.Image.baseCssClass=B;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.Widget");var J=["(",")","{","}","-","+","*","/","<",">","=","|","~",","," ","\t","\n",";","'",'"'],F=null;function D(O){if(!F){F={};var N,M;for(N=0,M=J.length;N<M;N++){F[J[N]]=true;}}return F[O];}mstrmojo.qb.FFsqlToken=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.qb.FFsqlToken",data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}"></span>',active:false,dropZone:true,allowDrop:function H(M){return this.dropZone;},ondrop:function(M){mstrmojo.all.FFsql.ondrop(M);},markupMethods:{ondataChange:function(){var M=this.data;if(M.v===","){this.domNode.innerHTML=mstrmojo.string.encodeHtmlString(String(M.v));}else{if(M.v=="\n"){this.domNode.innerHTML="<br>";}else{this.domNode.innerHTML=mstrmojo.string.encodeHtmlString(String(M.v));}}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());mstrmojo.css.toggleClass(this.domNode,["sql"],this.isSql());mstrmojo.css.toggleClass(this.domNode,["invalid"],M.sta===-1);},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);if(!this.active){var N=mstrmojo.all.FFsql;if(!this.isMstrO()&&!this.isDelimiter()){var M=N.candidates.items,P=this.data,O=P.v.toLowerCase();mstrmojo.array.forEach(M,function(Q){if(O===Q.n.toLowerCase()){P.oi=Q;return false;}});}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());mstrmojo.css.toggleClass(this.domNode,["sql"],this.isSql());}}},isMstrO:function I(){var M=this.data;return(!!M.oi&&M.oi.sta!==2)||!!M.rfd;},isSql:function L(){return this.data.oi&&this.data.oi.sta===100;},length:function B(){return this.data.v.length;},isDelimiter:function A(){return this.data.isDelimiter||(this.length()===1&&D(this.data.v));},split2Tokens:function E(Q,N){var P=this.data,O=P&&P.v,R=O.substring(0,Q),M=O.substring(Q);return[{v:R,isNew:true,did:P.did},{v:M,isNew:true,did:N}];},mergeTo:function C(N){var P=this.data,O=P&&P.v,M=N.data.v;return{v:O+M,isNew:true};},setItemInfo:function G(M){var N=this.data;N.v=M.n;N.oi=M;N.sta=1;N.isNew=true;this.set("data",N);this.paint();},spliceContent:function K(S,Q,N){var R=this.data,P=R&&R.v,T=P.substring(0,S);Q=(Q===null||Q===undefined)?(P.length-S):Q;var M=P.substring(S+Q),O=T+(N||"")+M;R.v=O;R.isNew=true;R.sta=1;delete R.oi;this.set("data",R);this.paint();}});mstrmojo.qb.FFsqlToken.isDelimiter=D;})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");var C=mstrmojo.css,G=mstrmojo.array;function F(H,J){var I={searchMetadata:{taskId:"searchMetadata",styleName:this.searchStyleName,rootFolderID:this.rootID,searchPattern:this.searchPattern+"*",nameWildcards:(this.qse?16:1),quickSearch:this.qse,sortKey:(this.qse?-1:6),blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:1,folderBrowserStyle:0,includeAncestorInfo:"true",includeObjectDesc:this.includeObjectDesc,searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseFolder:{taskId:"searchMetadata",rootFolderID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,recursive:this.hierarchical?0:(this.searchXML?"":1),folderBrowserStyle:this.hierarchical?1:0,includeAncestorInfo:String(!!this.hierarchical),searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseElements:{taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,filterXML:this.filterXML||"",searchPattern:this.searchPattern||"",matchCase:!!this.matchCase,dataSourcesXML:this.dataSourcesXML||"",includeFormNames:!!this.collectForms,includeFormValues:!!this.bIncludeFormValues,displayedForms:this.displayedForms||1,dimensionID:this.dimensionId||""}}[H]||{};if(typeof J==="object"){mstrmojo.hash.copy(J,I);}return I;}var B="##searchPattern";mstrmojo.SearchBox2=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchBox2",taskId:"searchMetadata",rootID:null,searchStyleName:"MojoFolderStyle",objectTypes:"3,14,256,257,1024,1027,2048,3072,10",token:{searchMetadata:/\//,browseElements:/(^-)|(,)|( OR )|( AND)|([<>]=?)|(&)|( )|(["\[\]\/])/},blockCount:50,blockBegin:1,minSearchLength:2,matchCase:false,enableMatchCase:true,supportIncFetch:true,quickSearch:false,searchAfterSearchPatternRestored:false,includeObjectDesc:true,forceResetCache:false,onUpdateSearchParams:mstrmojo.emptyFn,markupString:'<table id={@id} cellspacing=0 cellpadding=0 class="mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" mstrAttach:keyup,blur /></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}sbSearch" mstrAttach:click ></div></div></td><td><div class="mstrmojo-SearchBox-options" style="{@cssTextShowMC}"><input id="{@id}sbMatchCase" type="checkbox" mstrAttach:click /><label for="{@id}sbMatchCase">'+mstrmojo.desc(4326,"Case Sensitive")+"</label></div></td></tr></table>",markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},searchNode:function(){return this.domNode.rows[0].cells[1].firstChild.firstChild;},optionNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},preBuildRendering:function(){this.cssTextShowMC=this.enableMatchCase?"":"display: none";},postBuildRendering:function(){if(this._super){this._super();}this.matchCase=this.optionNode.checked;},onkeyup:function E(H){var J=this;var I=J.searchTimer;if(I){window.clearTimeout(I);}J.searchTimer=window.setTimeout(function(){J.onkeyupDelayed(H);delete J._searchTimer;},parseInt(H.e.keyCode||H.e.charCode,10)===13?0:J.searchDelay);},onkeyupDelayed:function A(I){var H=I.hWin,K=I.e||H.event;var J=mstrmojo.string.trim(this.inputNode.value);if(this.searchNode){C.toggleClass(this.searchNode,["clear"],J.length>0);}this.showTaskError=false;this.click2Search=false;if(J.length==0||this.autoSubmit||this.onEnter&&K.keyCode===13){this._onsearch();}},onEnter:function(){this._onsearch();},onclick:function(I){var H=I.hWin,K=I.e||H.event,M=K.target||K.srcElement,L=M&&M.id;switch(L.replace(this.id,"")){case"sbDown":if(this.enableMatchCase){var J=this.optionNode.parentNode.style;J.display=J.display=="block"?"none":"block";}break;case"sbSearch":if(this.inputNode.value.length>0){this.clearSearch();}break;case"sbMatchCase":this.set("matchCase",this.optionNode.checked);break;case"sbSpinner":break;}},clearSearch:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);var I=this.searchCache,H=this.rootID;if(I&&I[H]){I[H][B]="";}this._onsearch(true);},onmatchCaseChange:function(){this.matchCaseChanged=true;this._onsearch();},onrootIDChange:function(){this.rootChanged=true;this._setupCache(this.forceResetCache);var I=this.searchCache[this.rootID];if(I){var H=I[B]||"";this.inputNode.value=H;if(H.length>0){if(H.length>=this.minSearchLength&&this.searchAfterSearchPatternRestored){this._onsearch();}}}},getRootID:function(){},contentWidget:null,_notifyContentWidget:function(I){var H=this.contentWidget||this;H.set("items",I[0]);if(this.supportIncFetch){var J=I[1],L=I[2],K=this.blockCount;H.set("ifs",{np:Math.floor(J/K)+((J%K>0)?1:0),cp:Math.floor(L/K)+((L%K>0)?1:0)});}},_onsearch:function(H){this.getRootID();this._setupCache();var K=mstrmojo.string.trim(this.inputNode.value);if(K.length===0){H=true;}var L=this.token[this.taskId];if(L.test(K)){}if(this.searchPattern==K&&!this.rootChanged&&!this.matchCaseChanged&&!this.click2Search){return ;}var M=this.rootID,J=this.searchCache[M];if((K.length<this.minSearchLength&&!this.click2Search)&&!H){if(this.searchPattern&&this.searchPattern.length>=this.minSearchLength){this._notifyContentWidget(J[M]);this.searchPattern=K;}}else{this.searchPattern=K;J[B]=this.searchPattern;var I=this.filterCache(K,J,H);if((this.click2Search||I===null)&&!H){this.blockBegin=1;this.fetch();return ;}else{this._notifyContentWidget(I);}}J[B]=K;},_setupCache:function(J){var K=this.searchCache,I=this.rootID;if(K&&(J||!K[I])){K[I]=K[I]||{};var H=this.contentWidget&&this.contentWidget.items||this.rootCacheItems||[];K[I][I]=[H,this.totalSize||0,this.blockBegin||1].concat();}},taskCallId:0,path:mstrConfig.taskURL,method:"POST",serverRequest:function D(H,I){mstrmojo.xhr.request("POST",this.path,I,H,undefined,this.XServer,this.baseParams);},fetch:function(){this.rootChanged=false;this.matchCaseChanged=false;if(this.spinnerNode){this.spinnerNode.style.display="block";}if(this.preFetch){this.preFetch();}var H=this,I=F.apply(this,[this.taskId]);I.searchPattern=this.searchPattern;this.onUpdateSearchParams(I);var J={success:function(K){var L=K.items||K.es||[];L=[L,K.totalSize||K.sz||0,K.blockBegin||K.bb];mstrmojo.all[H.id].searchCache[H.rootID][(I.searchPattern.length==0?H.rootID:H.buildIndex(I.searchPattern))]=L;H._notifyContentWidget(L);},failure:function(K){if(H.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+K.getResponseHeader("X-MSTR-TaskFailureMsg"));}},complete:function(){if(H.spinnerNode){H.spinnerNode.style.display="none";}if(H.postFetch){H.postFetch();}}};this.serverRequest(I,J);},fetchPage:function(H){this.blockBegin=H*this.blockCount+1;this.fetch();},filterCache:function(J,M,I){var H=M&&M[I?this.rootID:this.buildIndex(J)];if(H){return H;}var K=this.token[this.taskId];if(K.test(J)||this.totalSize>this.blockCount){return null;}var O=J.replace(/.$/,"");H=M&&M[this.buildIndex(O)];while(H===undefined&&(O=O.replace(/.$/,"")).length>0){H=M&&M[this.buildIndex(O)];}if(H!==undefined){if(H[1]>this.blockCount){return null;}var L=H[0],N=[];G.forEach(L,function(P){if(P.n.search(new RegExp(J,this.matchCase?"":"i"))>-1){N.push(P);}});this.totalSize=N.length;return(M[this.buildIndex(J)]=[N,N.length,this.blockBegin].concat());}return null;},buildIndex:function(H){if(H.replace(/^\s|\s$/g,"").length===0){return"";}return !this.matchCase?H.toUpperCase():H+"::0";},init:function(H){if(this._super){this._super(H);}this.qse=mstrApp.useQuickSearch&&mstrApp.useQuickSearch()||0;this.autoSubmit=this.quickSearch&&(mstrApp.searchAutoComplete&&mstrApp.searchAutoComplete()||false);this.searchDelay=mstrApp.searchAutoCompleteDelay&&mstrApp.searchAutoCompleteDelay()||0;this.xhr=new mstrmojo.SimpleXHR();this.searchCache=this.searchCache||{};},clear:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.array","mstrmojo.hash");mstrmojo.requiresDescs(8126);var X=mstrmojo.dom,S=mstrmojo.hash,Z=mstrmojo.array,W,O=mstrmojo.qb.EnumJoinTypes,Q=mstrmojo.qb.EnumDataChangeEvents,a,V=1500,H=900;function C(){var c=document.createElement("v:rect"),b=c.style;c.setAttribute("id","vmlFrame");c.setAttribute("stroke","true");c.setAttribute("strokecolor","red");b.width=this.width;b.height=this.height;b.zindex="-1";document.getElementById("vmlCanvas").appendChild(c);}function B(){var e=parseInt(this.width,10),c=parseInt(this.height,10),d=document.createElement("v:group"),b=d.style;d.setAttribute("id","vmlCanvas");d.setAttribute("coordorigin","0, 0");d.setAttribute("coordsize",e+", "+c);b.width=this.width;b.height=this.height;this.domNode.appendChild(d);C.call(this);}function A(){this.highlight.clearRect(0,0,V,H);this.hl_link=null;this.highlight.beginPath();}function K(){if(a){var c=this.context;c.clearRect(0,0,V,H);c.beginPath();}else{var b=document.getElementById("vmlCanvas");if(b&&b.hasChildNodes()){while(b.childNodes.length>=1){b.removeChild(b.firstChild);}C.call(this);}}A.call(this);}function P(e){if(a){if(this.hl_link&&this.hl_link!==e){A.call(this);}var c=this.linksInfo[e].marker,d=this.highlight,b=Math.PI*2;this.hl_link=e;d.strokeStyle="blue";Z.forEach(c,function(f){d.beginPath();d.arc(f.x,f.y,3,0,b,true);d.closePath();d.stroke();});}}function M(d,g,c,f){if(a){var e=this.context=this.context||this.canvas.getContext("2d");e.moveTo(d,g);e.lineTo(c,f);}else{var b=document.createElement("v:line");b.setAttribute("from",[d," ",g].join(""));b.setAttribute("to",[c," ",f].join(""));document.getElementById("vmlCanvas").appendChild(b);}}function F(d,m,l){var h=d.length,b,p,o,n,e,k,c,j,g,f=false;if(h/2<3){return false;}o=d[h-2];n=d[h-1];for(g=0;g<h;g=g+2){b=d[g];p=d[g+1];if(b>o){e=o;c=b;k=n;j=p;}else{e=b;c=o;k=p;j=n;}if((b<m)===(m<=o)&&((l-k)*(c-e)<(j-k)*(m-e))){f=!f;}o=b;n=p;}return f;}function L(b,d){var c=null;S.forEach(this.linksInfo,function(f,e){if(F(f.coords,b,d)){c=e;return false;}return true;},this);return c;}mstrmojo.qb.DBTableLinker=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.qb.DBTableLinker",markupString:'<div id="{@id}" class="mstrmojo-DBTableLinker" mstrAttach:click><canvas height="'+H+'" width="'+V+'"></canvas><canvas height="'+H+'" width="'+V+'"></canvas></div>',markupMethods:{onvisibleChange:function N(){this.domNode.style.display=(this.visible)?"block":"none";},onheightChange:function I(){this.domNode.style.height=this.height||"";},onwidthChange:function J(){this.domNode.style.width=this.width||"";}},markupSlots:{canvas:function D(){return this.domNode.firstChild;},highlightCanvas:function R(){return this.domNode.childNodes[1];}},init:function U(b){this._super(b);this.linksInfo={};var c={},d=c[this.id]={};},postBuildRendering:function Y(){this._super();var b=this.canvas;if(a===undefined){a=b&&b.getContext&&b.getContext("2d");}if(a){this.context=b.getContext("2d");this.highlight=this.highlightCanvas.getContext("2d");}else{if(X.isIE8){B.call(this);}else{this.renderErrorMessage(mstrmojo.desc(8126));}}},handleClick:function G(c){var h=X.position(this.domNode),b=c.clientX,g=c.clientY,e=L.call(this,b-h.x,g-h.y);if(e){P.call(this,e);var d=this.linksInfo[e];W.showPopupMenu(this,{data:S.copy({columnIndex:d.columnIndex,isChecked:function f(k,j){return(k.type===j.type);}},d.joinObj),pos:{x:b+2,y:g+2}});}else{A.call(this);}},drawLinks:function E(o){K.call(this);var x=this.joins=o?o.joins:this.joins,j=X.position(this.domNode),b=8;var AB=this,u,c,f,AD,z,d,q,p,m,l,t,n,e,AC,g,h=0,k=this.parent.tableContainer.children,w=function w(AF,AG){var AE=null;Z.forEach(AF,function(AH){if(AH.tableData.id===AG){AE=AH;return false;}});return AE;},AA=AB.linksInfo={};Z.forEach(x,function(AE){u=w(k,AE.sourceTable);c=w(k,AE.targetTable);e=AE.type;if(u&&c){Z.forEach(AE.links,function(AG,AF){f=u.rows.getRowNode("did",AG.source.did);AD=c.rows.getRowNode("did",AG.target.did);z=X.position(f);d=X.position(AD);q=z.x+f.clientWidth-j.x;p=z.y+0.5*f.clientHeight-j.y;m=d.x-j.x;l=d.y+0.5*AD.clientHeight-j.y;t=q<m;n=t?b:-b;q-=t?0:z.w;m+=t?0:d.w;AA[h++]={joinObj:AE,columnIndex:AF,coords:[q+b,p+b,q+b,p-b,m-b,l-b,m-b,l+b],marker:[{x:q,y:p},{x:q+b,y:p},{x:m-b,y:l},{x:m,y:l}]};M.call(AB,q,p,q+n,p);M.call(AB,q+n,p,m-n,l);M.call(AB,m-n,l,m,l);AC=e===O.OUTER||e===O.RIGHT;g=e===O.OUTER||e===O.LEFT;n=n/2;if(AC){M.call(AB,q,p,q+n,p+n);M.call(AB,q,p,q+n,p-n);}if(g){M.call(AB,m-n,l-n,m,l);M.call(AB,m-n,l+n,m,l);}});}});if(a){this.context.stroke();}}});W=mstrmojo.qb.DBTableLinker;W.showPopupMenu=function T(b,c){var d=W.linkMenu;if(!d){d=W.linkMenu=mstrmojo.insert({scriptClass:"mstrmojo.qb.JoinMenu",zIndex:45});}d.set("cmPos",c.pos);d.target=b;d.data=c.data;d.domNode=b.domNode;d.showContextMenu();};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.ProgressBar=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ProgressBar",markupString:'<div id="{@id}" class="mstrmojo-ProgressBar {@cssClass}" style="{@cssText}"><div class="bar"><div class="indicator" style="width: 0"></div></div><div class="text">{@progressText}</div></div>',markupSlots:{barNode:function(){return this.domNode.firstChild;},textNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onprogressTextChange:function(){this.textNode.innerHTML=this.progressText||"";}},progressText:"",updateProgress:function A(C,B){if(this.hasRendered){this.barNode.firstChild.style.width=Math.min(100,Math.max(0,parseInt(C,10)))+"%";if(B!==undefined){this.set("progressText",B);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.registry","mstrmojo._HasContextMenu","mstrmojo.Widget");var F=mstrmojo.dom,K=mstrmojo.css,N=16;mstrmojo.ContextMenuItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasContextMenu],{scriptClass:"mstrmojo.ContextMenuItem",SUBMENU_SHIFT:3,visible:true,checked:false,enabled:true,buildDom:function(){var U=document.createElement("tr"),V=this.data,Y=this._cmSource,R,S;U.id=this.id;U.className="mstrmojo-ContextMenuItem "+(Y.isSeparatorItem(V)?"separator":Y.item2textCss(V));var W=this,X=function(){W.handleMouseOver();},T=function(){W.handleMouseOut();},Q=function(){W.handleClick();};F.attachEvent(U,"mouseover",X);F.attachEvent(U,"mouseout",T);F.attachEvent(U,"click",Q);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-left";S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-text";if(Y.isSeparatorItem(V)){S=document.createElement("img");S.src="../images/1ptrans.gif";}else{S=document.createElement("div");S.className="mstrmojo-CMI-content";R.innerHTML=V.itemWidget?"&nbsp":V[this.itemField];}R.appendChild(S);R=document.createElement("td");U.appendChild(R);R.className="mstrmojo-CMI-right "+(this.hasSubmenu?"sm":"");S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);return U;},buildRendering:function L(){this._super();var Q=this.data.itemWidget;if(Q){Q.placeholder=this.domNode.cells[1].children[0];Q.data=this.data;Q=mstrmojo.insert(Q);Q.render();Q.parent=this;this.itemWidget=Q;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"":"none";},oncheckedChange:function(){K.toggleClass(this.domNode,["checked"],this.checked);},onenabledChange:function(){K.toggleClass(this.domNode,["disabled"],!this.enabled);}},getMenuPosition:function I(){var Q=F.position(this.domNode,true);return{x:Math.round(Q.x+Q.w-this.SUBMENU_SHIFT),y:Math.round(Q.y)};},getContextMenuItems:function B(){return this.data[this.itemChildrenField];},getContextMenuCssClass:function D(){return this.data.cmCssClass||"";},callOnContextMenuOpen:function M(){var Q=this.data;if(Q.onContextMenuOpen){Q.onContextMenuOpen.apply(this,[]);}},callOnContextMenuClose:function A(){var Q=this.data;if(Q.onContextMenuClose){Q.onContextMenuClose.apply(this,[]);}},attachMousedownEvent:function J(){},getContextMenuSource:function P(){return this._cmSource;},adjustMenuPosition:function G(){var Q=this._subMenu,T=this._subMenu.domNode,S=T.offsetHeight,R=T.offsetWidth,W=F.windowDim(),V=F.position(T,false),U=F.position(T,true);if((V.x+R+N)>W.w){Q.set("left",(F.position(this.domNode,true).x-R)+"px");}if((V.y+S+N)>W.h){Q.set("top",(W.h-S-N+(U.y-V.y))+"px");}},handleMouseOver:function O(){var Q=this,R=function(){if(Q.hasSubmenu){Q.showContextMenu();}Q._cmSource.closeMenuTree(Q);Q._mouseOverTimer=null;};if(this._cmSource.activeMenuItem!==this){this._mouseOverTimer=window.setTimeout(R,80);}},handleMouseOut:function H(){if(this._mouseOverTimer){window.clearTimeout(this._mouseOverTimer);this._mouseOverTimer=null;}},closeMenuTree:function C(){this._cmSource.closeMenuTree();},handleClick:function E(){if(this.hasSubmenu){return ;}var Q=this._cmSource,R=this.data;if(!this.itemWidget){if(!Q.isSeparatorItem(R)&&Q.queryEnabled(R)){if(Q.executeCommand){Q.executeCommand(this.data);}Q.closeMenuTree();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._IsExprNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo._HasEditableText","mstrmojo.css","mstrmojo.string","mstrmojo.dom");var C=mstrmojo.css,A=mstrmojo.dom,F=mstrmojo.string,E=function(H){this._super&&this._super(H);A.stopPropogation(H.hWin,H.e);},G=mstrmojo.fe._IsRelationTreeNode.createSetHtml;mstrmojo.fe.DynamicNode=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._IsExprNode,mstrmojo.fe._IsRelationTreeNode,mstrmojo._HasEditableText],{scriptClass:"mstrmojo.fe.DynamicNode",markupString:'<div id="{@id}" class="mstrmojo-dynamic {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-dynamic-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-dynamic-prefix-text"  mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">'+G+'<span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-onhoverparent mstrmojo-dynamicNode" title="'+mstrmojo.desc(13229,"Add this condition to the target list of a selector.")+'"><span class="mstrmojo-dynamicNode-info"><span class="mstrmojo-textset"></span></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" ></img></span><span class="mstrmojo-textset mstrmojo-rename-text" mstrAttach:click >'+mstrmojo.desc(1388,"Rename")+"</span>"+G+"</div></div>",markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},dynamicNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.lastChild.firstChild.lastChild;},createSetOptNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},createSetNode:function(){return this.domNode.lastChild.lastChild;},renameNode:function(){return this.domNode.lastChild.childNodes[2];}},markupMethods:{onprefixedAndOrEditableChange:function(){C.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){C.toggleClass(this.dynamicNode,["selected"],this.selected);},onisEditingChange:function(){C.toggleClass(this.domNode,["renaming"],this.isEditing);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=this.data.ph.n;},onglowChange:function(){var H=this;C.toggleClass(H.dynamicNode,["glow"],this.glow);if(this.glow){setTimeout(function(){C.toggleClass(H.dynamicNode,["glow"],false);H.glow=false;},1000);}},onnoRelationOperatorChange:function(){C.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);},onnoRelationChange:function(){C.toggleClass(this.dynamicNode,["noRelation"],this.noRelation);}},editableSlot:"textNode",editButtonSlot:"renameNode",init:function(H){var J=H.data;if(J){var I=H.tree.nameFactory;if(J.ph.n){I.setName(J.ph.n,this);}else{J.ph.n=I.getNewName(this,mstrmojo.desc(12033,"Dynamic Condition")+" ");}}this._super(H);},_set_data:function(K,H){var I=this.data,J=(I!==H);if(J){this.data=H;this.text=H.ph.n;}return J;},preclick:function D(H){var J=null,I=A.eventTarget(H.hWin,H.e);if(A.contains(this.prefixNode,I,true)){J="andor";}else{if(A.contains(this.createSetOptNode,I,true)&&!this.noRelationOperator&&!this.noRelation){J="createSetOpt";}else{if(A.contains(this.createSetNode,I,true)&&!this.noRelation){J="createSet";}else{if(A.contains(this.renameNode,I,true)){this.set("isEditing",true);}}}}H.part=J;},isEmpty:function(){var I=this.data,H=I&&I.ph;return !(H&&H.n);},del:function B(){var I=this.parent,H=this.tree.nameFactory;if(I&&I.remove&&this.data){I.remove(this.data);H.removeName(this.data.ph.n);}},onkeyup:E,onkeydown:E,onTextEditComplete:function(){var J=this.tree,K=J.nameFactory,H=F.trim(this.text||""),I=this.data.ph.n;if(H&&H!==I){if(K.isNameExist(H)){K.names[H].set("glow",true);this.set("isEditing",true);}else{K.changeName(I,H,this);this.data.ph.n=H;}}},isSelectableArea:function(H){return mstrmojo.dom.contains(this.dynamicNode,H,true);},avatarCssCls:"mstrmojo-FE mstrmojo-dynamicNode",getAvatarNode:function(){return this.dynamicNode.cloneNode(true);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");var E=mstrmojo.Widget;mstrmojo.ui._IsPulldown=mstrmojo.provide("mstrmojo.ui._IsPulldown",{scriptClass:"mstrmojo.ui._IsPulldown",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-text {@cssTextClass}" title="{@title}" style="{@labelCssText}">{@value}</div><div class="container"></div></div>',markupSlots:{selectedNode:function D(){return this.domNode.firstChild;},containerNode:function A(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:E.visibleMarkupMethod,onheightChange:E.heightMarkupMethod,onwidthChange:E.widthMarkupMethod,onvalueChange:function F(){this.selectedNode.innerHTML=this.value||"";},onenabledChange:mstrmojo.Widget.enabledMarkupMethod},getPopupList:mstrmojo.emptyFn,anchorSlot:"selectedNode",postBuildRendering:function B(){this._super();this.getPopupList().set("items",this.items);var G=this.selectedIndex,H=this.selectedIndices;if(G!==undefined){this.set("selectedIndex",G);}if(H!==undefined){this.set("selectedIndices",mstrmojo.hash.copy(H||{}));}},onitemsChange:function C(){var G=this.getPopupList();if(G){G.set("items",this.items);}},onPopupWidgetOpened:function(){var G=this.getPopupList();if(G&&(!G.items||G.items.length===0)){G.close();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher","mstrmojo.Widget","mstrmojo.array","mstrmojo._HasChildren");var G=mstrmojo.array;function E(P){if(!this.shouldPropagateEnabled){return ;}var O=this._disabledChildren;G.forEach(P,function(Q){if(Q.enabled){O.push(Q.id);Q.set("enabled",false);}});}function J(){G.forEach(this._disabledChildren,function(O){var P=mstrmojo.all[O];if(P&&P.parent===this){P.set("enabled",true);}},this);this._disabledChildren=[];}mstrmojo.Container=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasChildren],{scriptClass:"mstrmojo.Container",defaultChildSlot:"containerNode",containerNode:null,preserveChildDomOrder:true,shouldPropagateEnabled:false,init:function M(P){this._super(P);this._disabledChildren=[];this.attachEventListener("addChild",this.id,function(Q){if(this.shouldPropagateEnabled&&!this.enabled){E.call(this,Q.value);}});if(this.children){this.initChildren();}var O=this.parent;if(!O||O.hasInitBindings){this.initBindings();}},destroy:function H(O){if(this.children){this.destroyChildren(true);}if(this.bindings){this.destroyBindings();}this._super(O);},unrender:function I(Q){var R=this.children,O=(R&&R.length)||0,P;for(P=O-1;P>-1;P--){R[P].unrender(true);}this._super(Q);},postBuildRendering:function A(){if(this._super()!==false){this.renderChildren();return true;}return false;},renderChildren:function L(){var Q=this.children,O=(Q&&Q.length)||0,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}}},childRenderCheck:function D(P){if(P&&!P.hasRendered){var O=P.slot||this.defaultChildSlot;return !!this[O];}return false;},addChildren:function N(R,P,Q){var O=this._super(R,P,Q);if(O){this.childRenderOnAddCheck(O);}return O;},removeChildren:function F(V,R){var U=V?[V]:(this.children||[]),O=U.length,S;for(S=O-1;S>-1;S--){var Q=U[S],P=Q&&Q.domNode;if(P){var T=this[(Q.slot||this.defaultChildSlot)];if(P.parentNode===T){T.removeChild(P);}}}return this._super(V,R);},childRenderOnAddCheck:function B(Q){if(this.hasRendered&&Q){var O=Q.length,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}else{if(R&&R.hasRendered){this.onchildRenderingChange(R);}}}}},onchildRenderingChange:function K(O){var W=O&&O.domNode;if(!W){return ;}var P=this.defaultChildSlot,V=O.slot||P,Y=this[V],Q=this.children;if(!Y){if(W.parentNode){W.parentNode.removeChild(W);}}else{if(W.parentNode===Y){return ;}if(!this.preserveChildDomOrder){Y.appendChild(W);}else{var R,U;for(U=Q.length-1;U>=0;U--){var X=Q[U];if(X===O){break;}if(V===(X.slot||P)){var Z=X.domNode;if(Z&&Z.parentNode===Y){R=Z;}}}if(R){Y.insertBefore(W,R);}else{Y.appendChild(W);}}}if(mstrmojo.publisher.hasSubs(this.id,"childrenRendered")){var S=Q.length,T;for(T=0;T<S;T++){if(!Q[T].domNode){return ;}}this.raiseEvent({name:"childrenRendered"});}},propagateChildProps:function C(S){var R=this[S],Q=this.children||[],O=Q.length,P;for(P=0;P<O;P++){Q[P].set(S,R);}}});mstrmojo.Container.enabledMarkupMethod=function(){mstrmojo.Widget.enabledMarkupMethod.apply(this,arguments);if(this.shouldPropagateEnabled){if(this.enabled){J.call(this);}else{E.call(this,this.children);}}};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");var N=mstrmojo.dom;var I,T,B;var x={singleColumnSelect:1,multipleColumnSelect:2,singleRowSelect:3,multipleRowSelect:4};var w={directPaste:0,refreshPaste:1};function K(AG){var AH="";if(AG.innerText!==undefined){AH=AG.innerText;}else{if(AG.textContent!==undefined){AH=AG.textContent;}else{AH=AG.innerHTML;}}return AH;}function H(AI,AG,AH){if(!(AI.cellHash.hasOwnProperty(AG))){AI.cellHash[AG]=AH;}}function X(AI,AG){if(AG===undefined){return ;}if(AG===null){return ;}mstrmojo.css.removeClass(AG,["selected"]);mstrmojo.css.removeClass(AG,["super-selected"]);var AJ=AI.table.rows[0].cells[AG.cellIndex];mstrmojo.css.removeClass(AJ,["selectedHeader"]);mstrmojo.css.removeClass(AJ,["super-selectedHeader"]);if(AI.showRowHeaders){var AH=AI.table.rows[AG.parentNode.rowIndex].cells[0];mstrmojo.css.removeClass(AH,["selectedHeader"]);}}function n(AJ){var AH=AJ.selections;if(AH===undefined){return ;}while(AH.length>0){var AI=AH.pop();while(AI.length>0){var AG=AI.pop();X(AJ,AG);}}}function AD(AJ,AI){var AH;var AK=AJ.actionsMenu;var AG=AK.childNodes;for(AH=3;AH<AG.length;AH++){mstrmojo.css.addClass(AG[AH],["inactive"]);mstrmojo.css.removeClass(AG[AH],["active"]);}switch(AI){case 1:mstrmojo.css.removeClass(AG[3],["inactive"]);mstrmojo.css.removeClass(AG[4],["inactive"]);mstrmojo.css.addClass(AG[3],["active"]);mstrmojo.css.addClass(AG[4],["active"]);break;case 2:mstrmojo.css.removeClass(AG[4],["inactive"]);mstrmojo.css.addClass(AG[4],["active"]);break;case 3:mstrmojo.css.removeClass(AG[5],["inactive"]);mstrmojo.css.removeClass(AG[6],["inactive"]);mstrmojo.css.addClass(AG[5],["active"]);mstrmojo.css.addClass(AG[6],["active"]);break;case 4:mstrmojo.css.removeClass(AG[6],["inactive"]);mstrmojo.css.addClass(AG[6],["active"]);break;default:break;}}function t(AK,AG){var AI,AH;var AJ=AK.selections;if(AJ===undefined){return ;}for(AI=0;AI<AJ.length;AI++){for(AH=0;AH<AJ[AI].length;AH++){if(AJ[AI][AH]===AG){X(AK,AJ[AI][AH]);AJ[AI].splice(AH,1);return ;}}}}function j(AI,AU,AJ,AR,AK){if(AU===undefined){return ;}var AO,AS,AV,AT,AM,AH=AJ||false,AL=AR||false,AQ,AG;if(!AH&&!AL){n(AI);}AQ=AU.cellIndex;AG=AU.parentNode.rowIndex;var AP=false;if(AJ&&AU.className.indexOf("selected")!==-1){AP=true;}if(AI.showRowHeaders){if(AQ===0&&AG===0){n(AI);AD(AI,0);return ;}}if(AG===0){AD(AI,x.singleColumnSelect);if(AJ){AD(AI,x.multipleColumnSelect);}if(AK===undefined||(AK!==undefined&&(AK!=="dblclick"&&AK!=="contextmenu"))){for(AO=0;AO<AI.rowCount;AO++){AT=AI.table.rows[AO].cells[AQ];if(AP){t(AI,AT);}else{mstrmojo.css.addClass(AT,["selected"]);var AN=AI.table.rows[0].cells[AT.cellIndex];mstrmojo.css.addClass(AN,["super-selectedHeader"]);if(AI.showRowHeaders){if(AO!==0){AV=AI.table.rows[AO].cells[0];mstrmojo.css.addClass(AV,["selectedHeader"]);}}AS=[];AS.push(AT);AI.selections.push(AS);}}}else{n(AI);mstrmojo.css.addClass(AU,["selected"]);AM=AI.table.rows[0].cells[AU.cellIndex];mstrmojo.css.addClass(AM,["selectedHeader"]);if(AI.showRowHeaders){AV=AI.table.rows[AU.parentNode.rowIndex].cells[0];mstrmojo.css.addClass(AV,["selectedHeader"]);}AS=[];AS.push(AU);AI.selections.push(AS);}}else{if(AI.showRowHeaders&&AQ===0){AD(AI,x.singleRowSelect);AS=[];for(AO=1;AO<AI.columnCount;AO++){AT=AI.table.rows[AG].cells[AO];if(AP){t(AI,AT);}else{mstrmojo.css.addClass(AT,["selected"]);AM=AI.table.rows[0].cells[AT.cellIndex];mstrmojo.css.addClass(AM,["selectedHeader"]);AS.push(AT);}}AI.selections.push(AS);if(!AP){AV=AI.table.rows[AG].cells[0];mstrmojo.css.addClass(AV,["selectedHeader"]);}if(AI.selections.length>1){AD(AI,x.multipleRowSelect);}}else{AD(AI,0);if(AP){t(AI,AU);}else{mstrmojo.css.addClass(AU,["super-selected"]);AM=AI.table.rows[0].cells[AU.cellIndex];mstrmojo.css.addClass(AM,["selectedHeader"]);if(AI.showRowHeaders){AV=AI.table.rows[AU.parentNode.rowIndex].cells[0];mstrmojo.css.addClass(AV,["selectedHeader"]);}AS=[];AS.push(AU);AI.selections.push(AS);}}}if(AP){AI.selectedSource=null;}}B=function(AI){var AG,AH=[];for(AG in AI){if(AI.hasOwnProperty(AG)){AH.push(AG);}}return AH;};function h(AG){var AH=B(AG.cellHash).length>0;AG.raiseEvent({name:"WorksheetContentChanged",data:AH});return AH;}function F(AH,AG){if((AH.cellHash.hasOwnProperty(AG))){delete AH.cellHash[AG];}}function b(AG){var AH=AG.cellIndex;var AI=AG.parentNode.rowIndex;return AH+"."+AI;}function e(AJ){var AH,AG;var AI=AJ.selections;if(AI){for(AH=0;AH<AI.length;AH++){for(AG=0;AG<AI[AH].length;AG++){AI[AH][AG].firstChild.innerHTML="";F(AJ,b(AI[AH][AG]));}}}AJ.isDirty=h(AJ);}function l(AG){AG.rowCount=AG.numOfRows;AG.columnCount=AG.numOfcols;AG.selections=[];var AL,AK;var AJ=[],AO=AG.tableRowCellCssClass,AI=AO+" header";var AN=AG.tableRowHeaderCssClass;var AH=(AI?' class="'+AI+'"':"");var AP=(AO?' class="'+AO+'"':""),AM=[];for(AL=0;AL<AG.rowCount;AL++){for(AK=0;AK<AG.columnCount;AK++){if(AG.showRowHeaders){if(AK===0){if(AL===0){AM[AK]='<td class="'+AN+'"><div class="'+AG.editableDivCssClass+'" contentEditable = "false" style="outline: 0;"></div></td>';}else{AM[AK]='<td class="'+AN+'"><div class="'+AG.editableDivCssClass+'" contentEditable = "false" style="outline: 0;">'+AL+"</div></td>";}}else{if(AL===0){AM[AK]="<td"+AH+'><div class="'+AG.editableDivCssClass+'" contentEditable = "false" style="outline: 0;"></div></td>';}else{AM[AK]="<td"+AP+'><div class="'+AG.editableDivCssClass+'" contentEditable = "false" style="outline: 0;"></div></td>';}}}else{if(AL===0){AM[AK]="<td"+AH+'><div class="'+AG.editableDivCssClass+'" contentEditable = "false" style="outline: 0;"></div></td>';}else{AM[AK]="<td"+AP+'><div class="'+AG.editableDivCssClass+'" contentEditable = "false" style="outline: 0;"></div></td>';}}}AJ[AL]="<tr>"+AM.join("")+"</tr>";}return AJ.join("");}function m(AG){AG.source.table.parentNode.removeChild(T);}function p(AG){AG.cellHash={};AG.isDirty=h(AG);}function AC(AK){var AH,AL=false,AJ="";if(mstrmojo.dom.isWK===true){AJ="webkitAnimationEnd";AL=true;}else{if(mstrmojo.dom.isFF===true){AJ="animationend";AL=true;}else{if(mstrmojo.dom.isIE8===false&&mstrmojo.dom.isIE9===false){AJ="MSAnimationEnd";AL=true;}else{if(mstrmojo.dom.isIE8===true||mstrmojo.dom.isIE9===true){AL=false;}}}}if(AL===true){T=document.createElement("div");AH=AK.table.cloneNode(true);mstrmojo.css.addClass(AH,["animated bounceOut"]);AK.table.parentNode.setAttribute("cssText","style=z-index: 0;position:absolute;");T.appendChild(AH);T.setAttribute("cssText","style=z-index: 2;position:absolute;top:70px;");T.style.top="70px";T.style.position="absolute";if(AJ!==""){T.addEventListener(AJ,function(AM){AM.source=AK;m(AM);},false);}AK.table.parentNode.appendChild(T);}if(mstrmojo.dom.isIE8===true||mstrmojo.dom.isIE9===true){var AI=document.getElementsByName("tempTableSpan")[0];AI.innerHTML="<table>"+l(AK)+"</table>";var AG=document.getElementsByName("tableBody")[0];AG.parentNode.replaceChild(AI.firstChild.firstChild,AG);}else{AK.table.innerHTML=l(AK);}if(AK.selectedSource&&AK.selectedSource.firstChild&&AK.selectedSource.firstChild.contentEditable==="true"){AK.selectedSource.firstChild.contentEditable=false;}AK.selectedSource=null;n(AK);p(AK);AK.tableContainer.focus();AK.parent.refresh();}function k(AJ){var AI,AH;var AK="";if(AJ){for(AI=0;AI<AJ.length;AI++){for(AH=0;AH<AJ[AI].length;AH++){var AG=AJ[AI][AH].firstChild;var AL=(AG.innerText||AG.textContent).replace("\n","");if(AH===AJ[AI].length-1){AK+=AL;}else{AK+=AL+"\t";}}if(AI!==AJ.length-1){AK+="\n";}AK=AK.replace("\t\n","\n");}}return AK;}function S(AG){var AL,AI,AQ,AH;var AK=AG.table;if(AK===null||AK===undefined){return null;}var AM=AK.getElementsByTagName("tr");var AJ="";var AP=0;if(AG.showRowHeaders){AP=1;}for(AL=0;AL<AM.length;AL++){var AN=AM[AL].cells;for(AI=AP;AI<AN.length;AI++){AH=AN[AI].firstChild;AQ=K(AH).replace("\n","");AQ=AQ.replace(/&amp;/g,"&");AQ=AQ.replace(/"/g,'""');AQ=AQ.replace(/\xA0/g," ");if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){AQ='"'+AQ+'"';}else{AQ="&quot;"+AQ+"&quot;";}AJ+=AQ;if(AI!==AN.length-1){AJ+=",";}}if(AL!==AM.length-1){AJ=AJ+"\n";}}var AT=AJ.split("\n");for(AL=AT.length-1;AL>=0;AL--){var AS=AT[AL];var AO=true;var AR=AS.split(",");for(AI=0;AI<AR.length;AI++){if(AR[AI]!=='""'){AO=false;break;}}if(!AO){break;}}AT=AT.slice(0,AL+1);AJ=AT.join("\n");return AJ;}function g(AG,AH){var AI;if(AG.keyCode===17||AG.keyCode===91){return ;}if(AG.keyCode===8){if(!AH.selectedSource){return ;}if(!AH.selectedSource.firstChild){return ;}if(AH.selectedSource.firstChild.innerHTML===""){F(AH,b(AH.selectedSource));}AH.isDirty=h(AH);}if(AG.keyCode===46){if(!AH.selectedSource){return ;}if(!AH.selectedSource.firstChild){return ;}if(AH.selectedSource.firstChild.contentEditable!=="false"){AI=K(AH.selectedSource.firstChild);if(AI.replace("\n","")===""){F(AH,b(AH.selectedSource));}AH.isDirty=h(AH);}return true;}if(AH.selectedSource.firstChild.innerHTML===""){F(AH,b(AH.selectedSource));}else{H(AH,b(AH.selectedSource),AH.selectedSource);}AH.isDirty=h(AH);}function AE(AH){var AG=k(AH.selections);var AI=document.getElementById(AH.id+"_pseudoText");AI.value=AG;AI.focus();AI.select();}function C(AI,AG){var AH;if(AI.table.rows[0].cells[AG]===null){return ;}for(AH=0;AH<AI.rowCount;AH++){var AJ=AI.table.rows[AH];AJ.deleteCell(AG);}AI.columnCount--;}function AF(AG,AM,AL,AJ){var AK,AO,AN=AL||0;if(AN===0){AO=AM+1||AG.columnCount;}else{AO=AM||AG.columnCount;}for(AK=0;AK<AG.rowCount;AK++){var AP=AG.table.rows[AK];var AH=AP.insertCell(AO);AH.className=AG.tableRowCellCssClass;AH.contentEditable=false;var AI=document.createElement("DIV");AI.contentEditable=false;AI.className=AG.editableDivCssClass;AI.style.outline="0";if(AJ){AI.innerHTML=AJ[AK];}if(AK===0){mstrmojo.css.addClass(AH,["header"]);}AH.appendChild(AI);}AG.columnCount++;AG.updateScrollbars();}function L(AJ,AK){var AI,AH;for(AI=0;AI<AK.length;AI++){for(AH=0;AH<AK[AI].length;AH++){var AG=AK[AI][AH].cellIndex;if(AG===-1){continue;}C(AJ,AG);AF(AJ);}}}function f(AH,AG){AH.table.deleteRow(AG);AH.rowCount--;}function M(AG,AK,AM){var AJ,AN,AL=AM||0;if(AL===0){AN=AK+1||AG.rowCount;}else{AN=AK||AG.rowCount;}var AO=AG.table.insertRow(AN);for(AJ=0;AJ<AG.columnCount;AJ++){var AH=AO.insertCell(AJ);var AI=document.createElement("DIV");AI.contentEditable=false;AI.className=AG.editableDivCssClass;AI.style.outline="0";if(AJ===0){if(AG.showRowHeaders){AH.className=AG.tableRowHeaderCssClass;AI.innerHTML=AN++;}else{AH.className=AG.tableRowCellCssClass;}}else{AH.className=AG.tableRowCellCssClass;}AH.appendChild(AI);}AG.rowCount++;AG.updateScrollbars();}function Y(AH,AI){var AG;for(AG=0;AG<AI.length;AG++){f(AH,AI[AG][0].parentNode.rowIndex);M(AH);}}var U=(function(){var AH,AG,AI=[];return{getSourceContent:function(AL,AK){AI=[];for(AH=0;AH<AL.rowCount;AH++){var AJ=AL.table.rows[AH].cells[AK];AI.push(AJ.firstChild.innerHTML);}return AI;},createDragDiv:function(AJ,AP,AK){if(!AJ.dragDiv){var AM=this.getSourceContent(AJ,AP);AJ.dragDiv=document.createElement("div");AJ.dragDiv.className="testDragDiv";AJ.dragDiv.style.left=AK.clientX+10+"px";AJ.dragDiv.style.top=AK.clientY+"px";var AT=document.createElement("table");var AN=[],AS=I.tableRowCellCssClass+" selected",AL=AS+" header selectedHeader";var AR=(AL?' contentEditable = "false" class="'+AL+'"':"");var AQ=(AS?' contentEditable = "false" class="'+AS+'"':""),AO=[];for(AH=0;AH<10;AH++){for(AG=0;AG<1;AG++){if(AH===0){AO[AG]="<td"+AR+'><div class="'+AJ.editableDivCssClass+'" contentEditable = "false" style="outline: 0;">'+AM[AH]+"</div></td>";}else{AO[AG]="<td"+AQ+'><div class="'+AJ.editableDivCssClass+'" contentEditable = "false" style="outline: 0;">'+AM[AH]+"</div></td>";}}AN[AH]="<tr>"+AO.join("")+"</tr>";}AT.innerHTML=AN.join("");AJ.dragDiv.appendChild(AT);AJ.table.parentNode.parentNode.parentNode.appendChild(AJ.dragDiv);}else{AJ.dragDiv.style.left=AK.clientX+10+"px";AJ.dragDiv.style.top=AK.clientY+"px";}},removeDragDiv:function(AJ){if(AJ.dragDiv){AJ.table.parentNode.parentNode.parentNode.removeChild(AJ.dragDiv);AJ.dragDiv=null;}},swapColumns:function(AL,AK){var AJ=event.target.cellIndex;C(AL,AK);AF(AL,AJ-1,0,AI);}};}());function d(AJ,AH,AI){var AG;if(AH===-1){if(AI===AJ.rowCount){AG=AJ.table.rows[AJ.rowCount-1].cells[0];}else{AG=AJ.table.rows[AI].cells[0];}}else{if(AH===AJ.columnCount){AG=AJ.table.rows[0].cells[AJ.columnCount-1];}else{AG=AJ.table.rows[0].cells[AH];}}return AG;}function AB(AI){var AH={};while(B(AI.cellHash).length>0){var AJ=B(AI.cellHash).pop();var AG=AI.cellHash[AJ];delete AI.cellHash[AJ];var AK=b(AG);if(!(AH.hasOwnProperty(AK))){AH[AK]=AG;}}AI.cellHash={};AI.cellHash=AH;AI.isDirty=h(AI);}function u(AI){var AH;var AG=document.getElementsByClassName(AI.tableRowHeaderCssClass);for(AH=1;AH<AG.length;AH++){AG[AH].innerHTML=AG[AH].parentNode.rowIndex;}}function E(AO,AG){var AI,AH,AK;if(AO.e.target.className.indexOf("inactive")!==-1){return ;}if(AO.e.target.className.indexOf("add_col")!==-1){AF(AG);return ;}if(AO.e.target.className.indexOf("add_row")!==-1){M(AG);AB(AG);return ;}if(AO.e.target.className.indexOf("clear_grid")!==-1){AC(AG);return ;}if(AO.e.target.className.indexOf("insert_col")!==-1){AF(AG,AG.selectedSource.cellIndex,1);AB(AG);return ;}if(AO.e.target.className.indexOf("delete_col")!==-1){AK=[];for(AI=0;AI<AG.selections.length;AI++){var AJ=[];for(AH=0;AH<AG.selections[AI].length;AH++){AJ[AH]=AG.selections[AI][AH];}AK[AI]=AJ;}var AL=AG.selectedSource.cellIndex;e(AG);n(AG);L(AG,AK);AB(AG);AG.selectedSource=d(AG,AL,-1);j(AG,AG.selectedSource);if(AG.showRowHeaders!==undefined&&AG.showRowHeaders===true){if(AG.columnCount===1){AD(AG,0);}}else{if(AG.columnCount===0){AD(AG,0);}}return ;}if(AO.e.target.className.indexOf("insert_row")!==-1){if(AG.showRowHeaders!==undefined&&AG.showRowHeaders===true){M(AG,AG.selectedSource.parentNode.rowIndex,1);u(AG);AB(AG);}return ;}if(AO.e.target.className.indexOf("delete_row")!==-1){if(AG.showRowHeaders!==undefined&&AG.showRowHeaders===true){AK=[];for(AI=0;AI<AG.selections.length;AI++){var AN=AG.selections[AI];var AM=[];for(AH=0;AH<AN.length;AH++){AM[AH]=AN[AH];}AK[AI]=AM;}var AP=AG.selectedSource.parentNode.rowIndex;e(AG);n(AG);Y(AG,AK);u(AG);AB(AG);AG.selectedSource=d(AG,-1,AP);j(AG,AG.selectedSource);if(AG.rowCount===0){AD(AG,0);}}return ;}}function A(AG,AH){if(AH.showRowHeaders!==undefined&&AH.showRowHeaders===true){if(AH.selectedSource.cellIndex===0){AH.selectedSource.firstChild.contentEditable=false;AG.e.stopImmediatePropagation();AG.e.preventDefault();return ;}}E(AG,AH);AH.selectedSource.firstChild.contentEditable=true;AH.selectedSource.firstChild.focus();j(AH,AH.selectedSource,false,false,AG.e.type);return false;}function c(AG,AI){var AJ=AG.e.target;if(AJ.tagName==="DIV"){AJ=AJ.parentNode;}AI.selectedSource=AJ;if(AI.showRowHeaders&&AJ.cellIndex===0){return ;}AI.selectedSource.firstChild.contentEditable=true;if(AI.selectedSource.firstChild.innerHTML!==""){AI.selectedSource.setAttribute("data-editable","true");var AH=window.getSelection();AH.collapse(AI.selectedSource.firstChild,1);}AI.selectedSource.firstChild.focus();j(AI,AI.selectedSource,AG.e.ctrlKey,false,AG.e.type);}function AA(AL){var AJ,AI,AH;e(AL);var AM=0;if(AL.showRowHeaders){AM=1;}for(AJ=0;AJ<AL.rowCount;AJ++){AH=[];for(AI=AM;AI<AL.columnCount;AI++){if(AL.showRowHeaders){if(AI===0){continue;}}var AG=AL.table.rows[AJ].cells[AI];mstrmojo.css.addClass(AG,["selected"]);var AN=AL.table.rows[0].cells[AG.cellIndex];mstrmojo.css.addClass(AN,["selectedHeader"]);if(AL.showRowHeaders){if(AJ!==0){var AK=AL.table.rows[AG.parentNode.rowIndex].cells[0];mstrmojo.css.addClass(AK,["selectedHeader"]);}}AH.push(AG);}AL.selections.push(AH);}}function G(AU,AW){if(!AU.selections||(AU.selections&&AU.selections.length===0)){return ;}var AR=AU.selections[0][0],AS,AL;if(AW.cellIndex>AR.cellIndex){if(AW.parentNode.rowIndex<AR.parentNode.rowIndex){AS=AU.selections.length;AL=1;}else{AS=1;AL=1;}}else{if(AW.parentNode.rowIndex>AR.parentNode.rowIndex){AS=1;AL=AU.selections[0].length;}else{AS=AU.selections.length;AL=AU.selections[AS-1].length;}}var AO=AU.selections[AS-1][AL-1];var AI=AO.cellIndex;var AV=AO.parentNode.rowIndex;var AZ=AW.cellIndex;var AT=AW.parentNode.rowIndex;if(AW.parentNode.rowIndex===0&&AO.parentNode.rowIndex===0){AT=AU.rowCount-1;AD(AU,x.multipleColumnSelect);}if(AU.showRowHeaders){if(AW.cellIndex===0&&AW.parentNode.rowIndex===0){n(AU);AD(AU,0);return ;}}n(AU);var AQ=Math.min(AV,AT);var AN=Math.max(AV,AT);var AP=Math.min(AI,AZ);var AK=Math.max(AI,AZ);var AY,AX=0,Aa;for(AY=AQ;AY<=AN;AY++){var AM=[];for(AX=AP;AX<=AK;AX++){if(AU.showRowHeaders){if(AX===0){continue;}}var AJ=AU.table.rows[AY].cells[AX];mstrmojo.css.addClass(AJ,["selected"]);var AG=AU.table.rows[0].cells[AJ.cellIndex];mstrmojo.css.addClass(AG,["selectedHeader"]);if(AU.showRowHeaders){if(AY!==0){var AH=AU.table.rows[AJ.parentNode.rowIndex].cells[0];mstrmojo.css.addClass(AH,["selectedHeader"]);}}if(AY===AQ&&AX===AP){Aa=AJ;}AM.push(AJ);}AU.selections.push(AM);}mstrmojo.css.addClass(Aa,["super-selected"]);}function J(AH,AG){if(!AG.selectedSource){return false;}if(AH.keyCode===17||(AH.metaKey===true&&AH.keyCode===91)){AE(AG);return false;}if(AH.keyCode===27){AG.selectedSource.firstChild.contentEditable=false;AG.tableContainer.focus();AG.selectedSource.firstChild.innerHTML=AG.preText;if(K(AG.selectedSource.firstChild).replace("\n","")===""){e(AG);}return true;}if(AH.keyCode===67&&(AH.ctrlKey||AH.metaKey)){AG.selectedSource.firstChild.contentEditable=true;AG.selectedSource.firstChild.focus();AE(AG);return true;}if(AH.keyCode===88&&(AH.ctrlKey||AH.metaKey)){AG.selectedSource.firstChild.contentEditable=true;AG.selectedSource.firstChild.focus();AE(AG);e(AG);return true;}if(AH.keyCode===65&&(AH.ctrlKey||AH.metaKey)){e(AG);AA(AG);AD(AG,0);return true;}if(AH.keyCode===16){return false;}var AI=AG.selectedSource.cellIndex;var AL=AG.selectedSource.parentNode.rowIndex;if(AG.showRowHeaders!==undefined&&AG.showRowHeaders===true){if(AI===0){if(AH.keyCode===86&&(AH.ctrlKey||AH.metaKey)){AG.selectedSource.firstChild.contentEditable=true;AG.selectedSource.firstChild.focus();return false;}}}if(AH.keyCode===46){if(AG.selectedSource.firstChild.contentEditable==="false"){e(AG);}return true;}var AN=false;if(AH.keyCode===9){if(AH.shiftKey){if((AI-1)>0){AI--;}}else{if(AI<=AG.columnCount-1){AI++;}}AN=true;}var AO=AH.keyCode;switch(AO){case 37:AI--;AN=true;break;case 39:AI++;AN=true;break;case 38:AL--;AN=true;break;case 40:AL++;AN=true;break;}if(AN){if(AG.selectedSource.getAttribute("data-editable")==="true"){return false;}if(AG.selectedSource.firstChild.contentEditable==="true"){AG.selectedSource.firstChild.contentEditable=false;AG.tableContainer.focus();}if(AL<0||AL>AG.rowCount-1||AI<0||AI>AG.columnCount-1){return false;}AG.selectedSource=AG.table.rows[AL].cells[AI];if(!AH.shiftKey&&!AH.ctrlKey){j(AG,AG.selectedSource,AH.ctrlKey,AH.shiftKey);}else{if(AH.shiftKey&&AH.keyCode===9){j(AG,AG.selectedSource,false,false);}else{G(AG,AG.selectedSource);}}var AJ=N.delta(AG.selectedSource,AG.table.parentNode.parentNode);var AK=!!(AJ.y>=0&&AJ.y<580);var AM=!!(AJ.x>=0&&AJ.x<950);if(AM&&AK){AH.preventDefault();AH.stopImmediatePropagation();}}else{if(AG.showRowHeaders!==undefined&&AG.showRowHeaders===true){if(AI===0){return false;}}if(AH.keyCode===13){AG.selectedSource.setAttribute("data-editable","false");AG.selectedSource.firstChild.contentEditable=false;AG.tableContainer.focus();if(AL===AG.rowCount-1){M(AG);}AG.selectedSource=AG.table.rows[AL+1].cells[AI];AG.preText=AG.selectedSource.firstChild.innerHTML;j(AG,AG.selectedSource);}else{if(!AH.ctrlKey&&!AH.metaKey){if(AG.selectedSource.firstChild.contentEditable==="false"){AG.selectedSource.firstChild.contentEditable=true;AG.selectedSource.firstChild.focus();AG.preText=AG.selectedSource.firstChild.innerHTML;AG.selectedSource.firstChild.innerHTML="";}}}}return true;}function Q(AH,AG){var AI="";if(AH.e.target.className.indexOf("add_col")!==-1){AI="DIClipboard-add_col_click";mstrmojo.css.toggleClass(AH.e.target,"DIClipboard-add_col",!AG);}if(AH.e.target.className.indexOf("add_row")!==-1){AI="DIClipboard-add_row_click";mstrmojo.css.toggleClass(AH.e.target,"DIClipboard-add_row",!AG);}if(AH.e.target.className.indexOf("clear_grid")!==-1){AI="DIClipboard-clear_grid_click";mstrmojo.css.toggleClass(AH.e.target,"DIClipboard-clear_grid",!AG);}if(AH.e.target.className.indexOf("insert_col")!==-1){AI="DIClipboard-insert_col_click";mstrmojo.css.toggleClass(AH.e.target,"DIClipboard-insert_col",!AG);}if(AH.e.target.className.indexOf("insert_row")!==-1){AI="DIClipboard-insert_row_click";mstrmojo.css.toggleClass(AH.e.target,"DIClipboard-insert_row",!AG);}if(AH.e.target.className.indexOf("delete_col")!==-1){AI="DIClipboard-delete_col_click";mstrmojo.css.toggleClass(AH.e.target,"DIClipboard-delete_col",!AG);}mstrmojo.css.toggleClass(AH.e.target,AI,AG);}function z(AG,AH){if(AG.e.target.getAttribute("type")==="menuItem"){Q(AG,false);}return false;}function D(AG,AH){if(AG.e.target.getAttribute("type")==="menuItem"){Q(AG,true);return ;}if(AG.e.target.id===AH.actionsMenu.id){return ;}if(AH.selectedSource&&AH.selectedSource.firstChild&&AH.selectedSource.firstChild.contentEditable==="true"){if(AG.e.target.parentNode===AH.selectedSource){return ;}AH.selectedSource.firstChild.contentEditable=false;}AH.tableContainer.focus();var AI=AG.e.target;if(AI.tagName==="DIV"){AI=AI.parentNode;}AH.selectedSource=AI;AH.preText=AI.firstChild.innerHTML;if(AG.e.shiftKey){G(AH,AI);}else{j(AH,AI,AG.e.ctrlKey);}if(AG.e.which!==3){AH.clickPosition={x:AG.e.clientX,y:AG.e.clientY};AH.domNode.addEventListener("mousemove",AH.mouseSelections,false);AH.domNode.addEventListener("mouseup",AH.removeSelections,false);}}function a(AG,AK,AJ){var AL=AG.target;if(AL.tagName==="DIV"){AL=AL.parentNode;}if(AK.dragColumns){if(AL.parentNode.rowIndex===0){if(AG.clientX<AK.clickPosition.x-10||AG.clientX>AK.clickPosition.x+10||AG.clientY<AK.clickPosition.y-10||AG.clientY>AK.clickPosition.y+10){if(AJ.dropTarget){AJ.dropTarget.setAttribute("style","border-right:1px solid;");}U.createDragDiv(AK,AK.selectedSource.cellIndex,AG);AK.table.setAttribute("style","cursor:move;");AJ.dropTarget=AL;AJ.dropTarget.setAttribute("style","border-right:3px solid;");}}else{U.removeDragDiv(AK,AG);if(AJ.dropTarget!=="undefined"){AJ.dropTarget.setAttribute("style","border-right:1px solid;");AJ.dropTarget=null;}G(AK,AL);}}if(AK.resizeColumns){if(AL.parentNode.rowIndex===0){AK.table.setAttribute("style","cursor:w-resize;");var AH=parseInt(AL.clientWidth,10);var AN=AG.clientX-AK.clickPosition.x;if(AN!==0){var AI=AH+AN;var AM=AI+50;AL.setAttribute("style","max-width:"+AM+"px;");AL.setAttribute("style","width:"+AI+"px;");}}else{G(AK,AL);AK.table.setAttribute("style","cursor:auto;");}}else{G(AK,AL);}}function W(AG,AI,AH){AH.removeEventListener("mousemove",AI.mouseSelections);AH.removeEventListener("mouseup",AI.removeSelections);if(AI.dragColumns){if(AI.selectedSource.parentNode.rowIndex===0){if(AG.clientX<AI.clickPosition.x-10||AG.clientX>AI.clickPosition.x+10||AG.clientY<AI.clickPosition.y-10||AG.clientY>AI.clickPosition.y+10){if(AH.dropTarget){AH.dropTarget.setAttribute("style","border-right:1px solid;");AH.dropTarget=null;}U.removeDragDiv(AI,AG);U.swapColumns(AI,AI.selectedSource.cellIndex,AG);}}}AI.table.setAttribute("style","cursor:auto;");}function Z(AP,AG,AO){var AN,AM,AQ,AT;if(mstrmojo.string.trim(AP)===""){return ;}AG.table.setAttribute("style","cursor:wait;");if(AP.length>50000){mstrApp.getRootController().displayError(mstrmojo.desc(12578,"Please paste less data, maximum limit is 50000 characters!"));AG.table.setAttribute("style","cursor:auto;");AG.isDirty=h(AG);return ;}if(AP.indexOf(String.fromCharCode(10))!==-1){AQ=AP.split(String.fromCharCode(10));}else{AQ=AP.split(String.fromCharCode(13));}if(AQ.length>0){if(AQ[AQ.length-1]===""||AQ[AQ.length-1]===String.fromCharCode(10)){AQ.splice(AQ.length-1,1);}}var AL=false;var AK=AO||w.directPaste;if(AQ.length===1&&AK!==w.refreshPaste){AL=true;}for(AN=0;AN<AQ.length;AN++){AQ[AN]=AQ[AN].split(String.fromCharCode(9));if(AQ[AN].length>1){AL=false;}}if(AL){for(AN=0;AN<AG.selections.length;AN++){for(AM=0;AM<AG.selections[AN].length;AM++){AT=AG.selections[AN][AM].firstChild;if(AT.innerText!==undefined){AT.innerText=AP;}else{AT.textContent=AP;}H(AG,b(AG.selections[AN][AM]),AG.selections[AN][AM]);}}}else{var AH=AG.selections[0][0].cellIndex;var AS=AG.selections[0][0].parentNode.rowIndex;var AJ=AS+AQ.length-AG.rowCount;var AR=AQ[0].length;for(AN=0;AN<AQ.length;AN++){AR=Math.max(AQ[AN].length,AR);}var AI=AH+AR-AG.columnCount;for(AN=0;AN<AJ;AN++){M(AG);}for(AN=0;AN<AI;AN++){AF(AG);}for(AN=0;AN<AQ.length;AN++){for(AM=0;AM<AQ[AN].length;AM++){AT=AG.table.rows[AS+AN].cells[AH+AM];if(AT.firstChild.innerText!==undefined){AT.firstChild.innerText=AQ[AN][AM];}else{AT.firstChild.textContent=AQ[AN][AM];}H(AG,b(AT),AT);AT.contentEditable=false;}}}AG.isDirty=h(AG);AG.table.setAttribute("style","cursor:auto;");}function P(AG,AH){if(navigator.userAgent.indexOf("Trident")!==-1||mstrmojo.dom.isIE){Z(window.clipboardData.getData("Text"),AH);AG.e.preventDefault();}else{AH.selectedSource.firstChild.contentEditable=false;Z(AG.e.clipboardData.getData("Text"),AH);}AH.tableContainer.focus();AH.updateScrollbars();}function O(AH){var AG="";AG='<div type = "menuItem" class="active DIClipboard-add_col" mstr_title = "'+mstrmojo.desc(7555,"Add Column")+'"></div>';AG+='<div type = "menuItem" class="active DIClipboard-add_row" mstr_title = "'+mstrmojo.desc(12572,"Add Row")+'"></div>';if(AH.clearSheet){AG+='<div type = "menuItem" class="active DIClipboard-clear_grid" mstr_title = "'+mstrmojo.desc(12573,"Clear Sheet")+'"></div>';}AG+='<div type = "menuItem" class="inactive DIClipboard-insert_col" mstr_title = "'+mstrmojo.desc(12574,"Insert Column")+'"></div>';AG+='<div type = "menuItem" class="inactive DIClipboard-delete_col" mstr_title= "'+mstrmojo.desc(12575,"Delete Column")+'"></div>';if(AH.showRowHeaders!==undefined&&AH.showRowHeaders===true){AG+='<div type = "menuItem" class="inactive DIClipboard-insert_row" mstr_title= "'+mstrmojo.desc(12576,"Insert Row")+'"></div>';AG+='<div type = "menuItem" class="inactive DIClipboard-delete_row" mstr_title= "'+mstrmojo.desc(12577,"Delete Row")+'"></div>';}return AG;}function V(AG,AH){AH.richTooltip.refNode=AG.target;AH.richTooltip.content=AG.target.getAttribute("mstr_title");AH.showTooltip(AG.e,self);}mstrmojo.Worksheet=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Worksheet",cssClass:"mstrmojo-di-worksheet-main-container",tableCssClass:"mstrmojo-di-worksheet-main-table",tableRowCellCssClass:"mstrmojo-di-worksheet-table-row-cell",tableRowHeaderCssClass:"mstrmojo-di-worksheet-table-rowHeader-cell",buttonCssClass:"mstrmojo-di-worksheet-buttonCssClass",numOfRows:10,numOfcols:5,showRowHeaders:false,selectedSource:null,selections:null,preText:"",isDirty:false,cellHash:{},dropTarget:null,dragColumns:false,clearSheet:false,resizeColumns:false,editableDivCssClass:"mstrmojo-di-worksheet-nonHighlightDiv",tableHtml:undefined,listHtml:undefined,markupString:'<div id="{@id}" class="{@cssClass}" mstrAttach:keydown,keyup><div id="{@id}" class = "mstrmojo-di-worksheet-navigationMenu" mstrAttach:click,mousedown,mouseup>{@listHtml}</div><div id="{@id}" class = "mstrmojo-di-worksheet-table-container" tabindex="0"><div class = "mstrmojo-di-worksheet-table-scroller"><table id="{@id}" class="{@tableCssClass}"><tbody id ="tableBody" mstrAttach:dblclick,contextmenu,mousedown,paste>{@tableHtml}</tbody></table></div></div><span id="tempTableSpan" style="visibility:hidden"></span><textarea id = "{@id}_pseudoText" class="mstrmojo-di-worksheet-copyTextBox" mstrAttach:paste></textarea></div>',markupSlots:{containerNode:function(){return this.domNode;},actionsMenu:function(){return this.domNode.firstChild;},tableContainer:function(){return this.domNode.childNodes[1];},table:function(){return this.domNode.childNodes[1].firstChild.lastChild;},tableScrollerNode:function(){return this.domNode.childNodes[1].firstChild;}},setupScrollNodes:function o(){this.scrollNode=this.tableScrollerNode;},setInitialSelection:function R(AH){var AG=this;j(this,AH);AH.firstChild.contentEditable=false;window.setTimeout(function(){AG.tableContainer.focus();},0);},preBuildRendering:function(){I=this;this.tableHtml=l(this);this.listHtml=O(this);if(this._super){this._super();}},postBuildRendering:function(){var AG=0;if(this._super){AG=this._super();}this.selectedSource=this.table.rows[0].cells[1];this.setInitialSelection(this.selectedSource);p(this);h(this);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,top:32});if(!this._ontooltipover){var AH=this.id;this._ontooltipover=function(AJ){var AI=mstrmojo.all[AH];V(AJ,AI);};this._ontooltipout=function(AJ){var AI=mstrmojo.all[AH];AI.hideTooltip(AJ,self);};}mstrmojo.dom.attachEvent(this.actionsMenu,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.actionsMenu,"mouseout",this._ontooltipout);return AG;},oncontextmenu:function(AG){A(AG,this);},onclick:function(AG){E(AG,this);},onmousedown:function(AG){D(AG,this);},onmouseup:function(AG){z(AG,this);},mouseSelections:function(AG){a(AG,I,this);},removeSelections:function(AG){W(AG,I,this);},ondblclick:function(AG){c(AG,this);},onpaste:function(AG){P(AG,this);},onkeydown:function(AG){J(AG.e,this);},onkeyup:function(AG){g(AG.e,this);},formatData:function q(AN){if((AN.datap&&AN.datap.data&&AN.datap.data.dcs)===undefined){return null;}var AL=AN.datap.data.dcs,AK=AL.length,AH=0,AJ,AI,AG="";for(AJ=0;AJ<AK;AJ++){AH=Math.max(AL[AJ].dvs.length,AH);}for(AI=0;AI<AK;AI++){AG+=AL[AI].dcns.cln;if(AI!==AK-1){AG+="\t";}}AG+="\n";for(AJ=0;AJ<AH;AJ++){for(AI=0;AI<AK;AI++){var AM=AL[AI].dvs[AJ];if(AM!==null){AG+=AM;}else{AG+="";}if(AI!==AK-1){AG+="\t";}}AG+="\n";}return AG;},getData:function(){return S(this);},setData:function(AH){var AG=this.formatData(AH);if(AG!==null){Z(AG,this,w.refreshPaste);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.Refine.HistogramWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.HistogramWidget",options:null,binMatrix:null,range:null,markupString:"<canvas></canvas>",update:function(D,A,E,F){if(D===undefined||A===undefined||F.length===0||F[0].length===0){this.range=null;this.binMatrix=null;this.parent.histogramNode.style.display="none";}else{this.range={min:D,max:A,step:E};this.binMatrix=F;this.peak=0;var C,B;for(C=0;C<F.length;C++){var G=F[C];for(B=0;B<G.length;B++){this.peak=Math.max(this.peak,G[B]);}}}if(this.binMatrix!==null){this.parent.histogramNode.style.display="block";this.resize();this._render();}},resize:function(){var A=this.options.height||(this.parent.hasOtherChoices()?54:73);this.domNode.height=A;this.domNode.width=this.parent.histogramNode.clientWidth;this.parent.histogramNode.style.height=A+"px";},_render:function(){var D=this;var F=this.options;var E=this.domNode;var B=E.getContext("2d");B.fillStyle="white";B.fillRect(0,0,E.width,E.height);B.save();B.translate(0,E.height);B.scale(1,-1);var G=E.width/this.binMatrix[0].length;B.save();B.strokeStyle=F.emptyBinColor||"#faa";B.lineWidth=1;B.moveTo(0,0);B.lineTo(E.width,0);B.stroke();B.restore();var A=function(I){var K=Math.floor(15*(D.binMatrix.length-I)/D.binMatrix.length);var J=K.toString(16);return"#"+J+J+J;};var C=function(M,J,P){B.save();B.lineWidth=0;B.fillStyle=J;B.strokeStyle=P;var O;for(O=0;O<M.length;O++){var N=M[O];if(N>0){var L=O*G;var K=Math.ceil(G);var I=Math.max(2,Math.ceil(N*E.height/D.peak));B.fillRect(L,0,K,I);B.strokeRect(L,0,K,I);}}B.restore();};var H;for(H=0;H<this.binMatrix.length;H++){C(this.binMatrix[H],F.hasOwnProperty("binBorderColors")&&H<F.binColors.length?F.binColors[H]:A(H),F.hasOwnProperty("binBorderColors")&&H<F.binBorderColors.length?F.binBorderColors[H]:A(H));}B.restore();}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.css","mstrmojo.string","mstrmojo._IsExprNode","mstrmojo._HasPopup","mstrmojo.Widget");var O=mstrmojo.dom,B=mstrmojo.css,E=mstrmojo.string.htmlAngles,M=mstrmojo.expr,N=M.ET,K=M.FN,A=M.BRANCH_FNS[K.NOT],D={};D[K.BETWEEN]=1;D[K.NOT_BETWEEN]=1;var C={"*":function(Q,P){return Q?('<span class="mstrmojo-unknown">'+(E(Q.n||Q.xml)||"...")+"</span>"):null;}};function H(Q,P,S,R){return S&&((R?'<span class="mstrmojo-ListIcon t'+R+'"></span>':"")+'<span class="mstrmojo-text mstrmojo-embedobj">'+E(S)+"</span>");}C[N.R]=function(Q,P){return H(Q,P,Q.r&&Q.r.n,Q.r&&Q.r.t);};C[N.F]=function(Q,P){return H(Q,P,Q.f&&Q.f.n,Q.f&&Q.f.t);};C[N.XML]=function(Q,P){return H(Q,P,Q.n||Q.p&&Q.p.n||Q.xml,Q.p&&Q.p.t);};C[N.AE]=function(V,S){var R=[];if(V&&V.a&&V.a.n){R.push('<span class="mstrmojo-text mstrmojo-attr">'+E(V.a.n)+"</span>");if(V.fn!==M.FN.IN_LIST){R.push('<span class="mstrmojo-text mstrmojo-fn">'+E(M.fnName(V.et,V.fn,V.fnt))+"</span>");}var U=V.es,P=U&&U.length||0;if(P){R.push('<span class="mstrmojo-elems">');var Q=R.length;for(var T=0;T<P;T++){R[Q++]='<span class="mstrmojo-text mstrmojo-elem">';R[Q++]=E(U[T].n);if(T<P-1){R[Q++]=", ";}R[Q++]="</span>";}R[Q++]="</span>";}else{R.push('<span class="mstrmojo-text mstrmojo-emptyelems">(Empty)</span>');}}return R.join("");};C[N.AQ]=function(W,X){var T=[];if(W&&W.a&&W.a.n){T.push('<span class="mstrmojo-text mstrmojo-attr">'+E(W.a.n)+"</span>");if(W.fm&&W.fm.n){T.push('<span class="mstrmojo-text mstrmojo-form">'+E(W.fm.n)+"</span>");if(W.fn!=null){T.push('<span class="mstrmojo-text mstrmojo-fn">'+E(M.fnName(W.et,W.fn,W.fnt,W.fm.dtp))+"</span>");var P=M.fnCstCount(W.fn,W.fnt);if(W.et===N.AC){if(P>=1){if(W.a2&&W.a2.n){T.push('<span class="mstrmojo-text mstrmojo-attr2">'+E(W.a2.n)+"</span>");if(W.fm2&&W.fm2.n){T.push('<span class="mstrmojo-text mstrmojo-form2">'+E(W.fm2.n)+"</span>");}}if(P>1){T.push('<span class="mstrmojo-text mstrmojo-btwn">'+X.betweenText+"</span>");if(W.a3&&W.a3.n){T.push('<span class="mstrmojo-text mstrmojo-attr3">'+E(W.a3.n)+"</span>");if(W.fm3&&W.fm3.n){T.push('<span class="mstrmojo-text mstrmojo-form3">'+E(W.fm3.n)+"</span>");}}}}}else{if(W.et===N.AL){var U=W.cs,Y=[];for(var R=0,V=U.length;R<V;R++){Y.push(U[R].v);}T.push('<span class="mstrmojo-text mstrmojo-c1">'+Y.join(mstrConfig.listSep)+"</span>");}else{if(P>=1){var U=W.cs,S=U&&U[0];T.push('<span class="mstrmojo-text mstrmojo-c1">'+E(S&&S.p&&S.p.n||S&&S.v)+"</span>");if(P>1){var Q=U&&U[1];T.push('<span class="mstrmojo-text mstrmojo-btwn">'+X.betweenText+"</span>");T.push('<span class="mstrmojo-text mstrmojo-c1">'+E(Q&&Q.p&&Q.p.n||Q&&Q.v)+"</span>");}}}}}}}return T.join("");};C[N.AC]=C[N.AQ];C[N.AL]=C[N.AQ];C[N.MQ]=function(f,g){var e=[],Z=f&&f.m,k=Z&&Z.n;if(k){var Q=f.fnt,U=M.FNT.PER,c=M.FNT.RANK;k=Q===U?mstrmojo.desc(2787,"Percentage of ##").replace("##",k):Q===c?mstrmojo.desc(2788,"Rank of ##").replace("##",k):k;e.push('<span class="mstrmojo-text mstrmojo-metric">'+E(k)+"</span>");if(f.fn!=null){e.push('<span class="mstrmojo-text mstrmojo-fn">'+E(M.fnName(f.et,f.fn,Q,M.DTP.REAL))+"</span>");var X=M.fnCstCount(f.fn,Q);if(f.et==M.ET.MC){if(X>=1){var j=(f.m2&&f.m2.n)||"?";e.push('<span class="mstrmojo-text mstrmojo-m2">'+E(j)+"</span>");if(X>1){e.push('<span class="mstrmojo-text mstrmojo-btwn">'+g.betweenText+"</span>");var S=(f.m3&&f.m3.n)||"?";e.push('<span class="mstrmojo-text mstrmojo-m3">'+E(S)+"</span>");}}}else{if(X>=1){var R=f.cs,a=R&&R[0];var P=function(h){var d=h.v;if(f.fnt==U){if(d.replace){h.v=d.replace(/%$/,"");}d=h.v+"%";}return d;};e.push('<span class="mstrmojo-text mstrmojo-c1">'+E(a&&a.p&&a.p.n||a&&a.v&&P(a))+"</span>");if(X>1){var Y=R&&R[1];e.push('<span class="mstrmojo-text mstrmojo-btwn">'+g.betweenText+"</span>");e.push('<span class="mstrmojo-text mstrmojo-c2">'+E(Y&&Y.p&&Y.p.n||Y&&Y.v&&P(Y))+"</span>");}}}var b=f.dmy&&f.dmy.uts,W=b&&b.length;if(W){e.push('<span class="mstrmojo-text mstrmojo-at">'+g.atText+"</span>");e.push('<span class="mstrmojo-dmy">');for(var V=0;V<W;V++){var T=b[V];e.push('<span class="mstrmojo-text mstrmojo-dmyunit">');e.push(E(T.utgt?T.utgt.n:T.n));if(V<W-1){e.push(",");}e.push("</span>");}e.push("</span>");}}}return e.join("");};C[N.MC]=C[N.MQ];function G(P){var Q=P.data;if(Q.not){return'<span class="mstrmojo-text mstrmojo-not">'+A+"</span>";}return"";}function F(P){var R=P.data,Q=C[R&&R.et]||C["*"];return G(P)+((Q&&Q(R,P))||('<span class="mstrmojo-text">'+P.emptyText+"</span>"));}mstrmojo.ConditionNode=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._IsExprNode,mstrmojo._HasPopup],{scriptClass:"mstrmojo.ConditionNode",data:null,editable:false,prefixedAndOrEditable:false,markupString:'<div id="{@id}" class="mstrmojo-cond mstrmojo-ConditionNode {@cssClass}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-cond-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-onhoverparent mstrmojo-cond-contents {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-text {@cssClass}" mstrAttach:click></span><span class="mstrmojo-cond-text-postfix {@cssClass}"></span><span class="mstrmojo-rel mstrmojo-cond-popupNode {@cssClass}"></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" tooltip="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" /></span></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},condNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.childNodes[1].firstChild;},textPostfixNode:function(){return this.domNode.childNodes[1].childNodes[1];},popupNode:function(){return this.domNode.childNodes[1].childNodes[2];}},markupMethods:{onprefixedAndOrEditableChange:function(){B.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},oneditableChange:function(){B.toggleClass(this.textNode,["editable"],this.editable);},onselectedChange:function(){B.toggleClass(this.condNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=F(this);this.textPostfixNode.innerHTML=this.getConditionTextPostfix();}},betweenText:mstrmojo.desc(308,"and"),atText:mstrmojo.desc(5923,"at"),emptyText:mstrmojo.desc(7930,"Empty condition"),init:function L(P){this._super(P);this.markupString=this.markupString.replace("{@_prefixAndOrToolsMarkup}",this.getPrefixAndOrToolsMarkup());},getConditionTextPostfix:function(){return"";},del:function J(){var P=this.parent;if(P&&P.remove&&this.data){P.remove(this.data);}},isEmpty:function(){var Q=this.data,P=Q&&Q.et,R=P&&mstrmojo.expr.ET2TGT[P];return !(R&&Q[R]);},isSelectableArea:function(P){return O.contains(this.condNode,P,true);},preclick:function I(P){var R=null,Q=O.eventTarget(P.hWin,P.e);if(O.contains(this.prefixNode,Q,true)){R="andor";}else{if(O.contains(this.textNode,Q,true)){R="condition";}else{if(O.contains(this.textPostfixNode,Q,true)){O.stopPropogation(P.hWin,P.e);return false;}}}P.part=R;}});mstrmojo.ConditionNode.getFunctionNode=F;})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Widget");var B=mstrmojo.dom;mstrmojo.InlineEditBox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.InlineEditBox",text:null,editMode:false,allowEdit:true,okSave:false,emptyHint:"Enter your text here.",markupString:'<div id="{@id}" class="mstrmojo-InlineEditBox {@cssClass}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-InlineEditBox-text"></div><div class="mstrmojo-InlineEditBox-edit"><input type="text" class="mstrmojo-InlineEditBox-input" mstrAttach:keyup/><img class="mstrmojo-InlineEditBox-ok" src="../images/1ptrans.gif" title="Save"/><img class="mstrmojo-InlineEditBox-cancel" src="../images/1ptrans.gif" title="Cancel"/></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.lastChild;},inputNode:function(){return this.domNode.lastChild.firstChild;},okNode:function(){return this.domNode.lastChild.childNodes[1];},cancelNode:function(){return this.domNode.lastChild.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text||this.emptyHint||"");},oneditModeChange:function(){var H=this.editMode,E=this.domNode,D=this.textNode,G=this.editNode;mstrmojo.css.toggleClass(E,["edit"],H);if(H){D.style.display="none";G.style.display="block";D=this.inputNode;var F=D.style;D.value=this.text||"";F.width=(E.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";F.height=E.clientHeight+"px";D.focus();if(D.createTextRange){var I=D.createTextRange(),C=D.value.length;I.move("character",C);I.select();}}else{D.style.display="block";G.style.display="none";}},onokSaveChange:function(){var C=this.okSave?"inline":"none";this.okNode.style.display=C;this.cancelNode.style.display=C;},onallowEditChange:function(){mstrmojo.css.toggleClass(this.domNode,["disable"],!this.allowEdit);}},onvisibleChange:function A(){if(this.domNode){this.domNode.style.display=(this.visible?"block":"none");}},preclick:function(C){var E=C.e,D=B.eventTarget(C.hWin,E);if(D===this.okNode){this.save();}else{if(D===this.cancelNode){this.cancel();}else{if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}}}},prekeyup:function(C){var E=C.e,D=E.keyCode||E.charCode;if(D===mstrmojo.Enum_Keys.ENTER){this.save();}else{if(D===mstrmojo.Enum_Keys.ESCAPE){this.cancel();}}},_attachEvents:function(){var C=this;if(this.editMode){if(!this._save_handler){this._save_handler=function(){var D=B.eventTarget(self,arguments[0]);if(!B.contains(C.domNode,D,true,document.body)){C.save();}};}B.attachEvent(document.body,"mousedown",this._save_handler);}else{if(this._save_handler){B.detachEvent(document.body,"mousedown",this._save_handler);}}},postBuildRendering:function(){if(this._super){this._super();}this._em_sub=this.attachEventListener("editModeChange",this.id,"_attachEvents");},destroy:function(){this.detachEventListener(this._em_sub);if(this._super){this._super();}},save:function(){this.set("text",this.inputNode.value);this.set("editMode",false);if(this.onSave){this.onSave();}},cancel:function(){this.set("editMode",false);if(this.onCancel){this.onCancel();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.FileUploadBox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.FileUploadBox",value:"",params:null,action:"taskProc",uploadTaskId:"uploadFile",browseLabel:"Browse...",fileFieldName:"myfile",multiple:"",status:"init",jsonp:"parent.mstrmojo.all.{@id}.uploadCallback(@R@)",enabled:true,markupString:'<div id={@id} class="mstrmojo-FileUploadBox {@cssClass}" style="{@cssText}"><form class="mstrmojo-FileUploadBox-form" target="{@id}_iframe" enctype="multipart/form-data" method="post" action="{@action}"><input class="mstrmojo-FileUploadBox-input" readonly="readonly" type="text" size="30"/><div class="mstrmojo-FileUploadBox-buttonDiv"><div class="mstrmojo-FileUploadBox-button">{@browseLabel}</div><input class="mstrmojo-FileUploadBox-file" type="file" {@multiple} size="30" style="font-size:4em;" name="{@fileFieldName}" onchange="mstrmojo.all.{@id}.synValue();"/></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>',markupSlots:{formNode:function(){return this.domNode.firstChild;},inputNode:function(){return this.domNode.firstChild.firstChild;},buttonNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},fileNode:function(){return this.domNode.firstChild.childNodes[1].lastChild;},paramsNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onenabledChange:function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);this.fileNode.style.display=this.enabled?"block":"none";},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onstatusChange:function(){if(this.status==="init"){this.inputNode.value="";this.fileNode.value="";this.paramsNode.innerHTML="";}},onvalueChange:function(){this.inputNode.value=this.value;}},uploadCallback:function(B){var A=(B.status==200);this.set("status",A?"successful":"failed");if(A&&this.onSuccess){this.onSuccess(B);}if(!A&&this.onFailed){this.onFailed(B);}},synValue:function(){var B=this.fileNode.value,A=B.split(/[\/\\]/);B=A[A.length-1];this.set("value",B);},submit:function(E,C){var B=true;if(this.onsubmit){B=this.onsubmit();}if(B){E=E||{};E.fileFieldName=this.fileFieldName;E.taskEnv="jsonp2";E.taskId=this.uploadTaskId;E.jsonp=this.jsonp.replace("{@id}",this.id);var A=[],D;for(D in E){A.push('<input type="hidden" name="'+D+'" value="'+mstrmojo.string.encodeHtmlString(E[D])+'"/>');}if(this.params){E=this.params;for(D in E){A.push('<input type="hidden" name="'+D+'" value="'+mstrmojo.string.encodeHtmlString(E[D])+'"/>');}}this.paramsNode.innerHTML=A.join("");if(C){this.onSuccess=C.success;this.onFailed=C.failure;}this.formNode.submit();this.set("status","loading");}},reset:function(){this.set("status","init");}});})();(function(){mstrmojo.requiresCls("mstrmojo._HasScrollbox","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.string","mstrmojo.Widget");var R=mstrmojo,S=R.array,A=R.css,I=R.dom,P=R.hash,j=R.string,V="selected",H="open",W="leaf",c="loading",f=":",b="li",n="ul",l="idx",m="level";function F(AB,q,z,w){var x=this.renderIndex*this.renderBlockSize,p=z.split(":"),AA=parseInt(p[0],10)+x,t=!!this.selectedIndices[AA],o=!!this.expandedIndices[AA],u=(AB.isLeaf||(!this.dataHelper&&!(AB.items&&AB.items.length)));p[0]=AA;return j.apply('<{@tag} class="{@cls}" level="{@level}" idx="{@idx}">{@itemMkp}{@childMkp}</{@tag}>',{tag:b,cls:(t?V:"")+(o?" "+H:"")+(u?" "+W:""),level:q,idx:p.join(":"),itemMkp:this.itemRenderer.render(AB,q,z,this),childMkp:w||""});}function a(AA,p,u){var AD=[],t=0,AB=this.itemRenderer,z=AB&&AB.render,o=AA&&AA.length,x,w,AC,q;AD[t++]="<"+n+">";if(z&&typeof z==="function"&&o){for(q=0;q<AA.length;q++){AC=AA[q];x=u.concat([q]);w=x.join(f);AD[t++]=F.call(this,AC,p,w,a.call(this,AC.items,p+1,x));}}AD[t]="</"+n+">";return AD.join("");}function L(p,q){var o=q[0];if(q&&q.length===1){return p[o];}return L(p[o].items,q.slice(1));}function K(p,q,t,x,o,w){var u=w.treeHooks[p];if(u&&u.call(w,q,t,x,o)){return ;}A.toggleClass(q,V,p==="select");}function T(p,u,AE,o,AC,z){var AB=z.treeHooks[p],w=AE.items,AA=(!w||w.length===0),t=p==="expand",x=z.dataHelper;if(AB&&AB.call(z,u,AE,o,AC)){return ;}if(t&&!x&&AA){A.addClass(u,W);return ;}if(t&&x){if(AA){if(AE.tp==="search"){A.toggleClass(u,H,t);return ;}A.toggleClass(u,c,true);x.fetch(AE,{success:function AD(AG){var AF=AE.items=AG.items;if(AF&&AF.length>0){u.innerHTML+=a.call(z,AF,(parseInt(o,10)+1),AE._renderIdx.split(f));}else{A.addClass(u,W);}},complete:function q(){A.toggleClass(u,c,false);}});}}A.toggleClass(u,H,t);}mstrmojo.ui.SimpleTree=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.ui.SimpleTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree {@cssClass}" mstrAttach:click>{@itemsHTML}</div>',markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},markupSlots:{scrollboxNode:function M(){return this.domNode;}},items:undefined,dataHelper:undefined,treeHooks:{},init:function h(o){this._super(o);this.expandedIndices={};this.selectedIndices={};},buildRendering:function Z(){var o=this.items,p;if(this.renderOnScroll&&this.items){this.renderIndex=0;o=this.items.slice(this.renderIndex,this.renderBlockSize);}p=o&&o.length;this.itemsHTML=p?a.call(this,o,0,[]):"";this._super();delete this.itemsHTML;},renderOnScroll:false,_cb_scroll:undefined,renderBlockSize:50,renderIndex:0,onscroll:function d(){if(this.renderOnScroll){var t=this.domNode,q=parseInt(t.style.height,10),o=(this.renderIndex+1)*this.renderBlockSize;if(o>=this.items.length){return ;}if(Math.ceil(q+t.scrollTop)>=t.scrollHeight){this.renderIndex++;var p=this.items.slice(o,o+this.renderBlockSize);this.domNode.innerHTML+=a.call(this,p,0,[]);}}},postBuildRendering:function N(){if(!this._cb_scroll){var p=this.id;this._cb_scroll=function o(){var q=mstrmojo.all[p];q.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);if(this._super){this._super();}},getItemMarkup:function(){return'<{@tag} class="{@cls}" style="{@style}">{@n}</{@tag}>';},getItemProps:function U(p,q,o){return{tag:"div",cls:"item ",n:p.n||"",style:"",idx:o};},itemRenderer:{render:function(p,t,o,q){p._renderIdx=o;p._renderLvl=t;return j.apply(q.getItemMarkup(p,t,o),q.getItemProps(p,t,o));},select:function e(p,q,u,o,t){K("select",p,q,u,o,t);},unselect:function G(p,q,u,o,t){K("unselect",p,q,u,o,t);},expand:function B(p,q,u,o,t){T("expand",p,q,u,o,t);},collapse:function O(p,q,u,o,t){T("collapse",p,q,u,o,t);}},_set_items:function Q(p,t){var q=this.items;this.items=t;if(q!==t){var o=this.hasRendered;if(o){this.unrender(false);}if(o){this.render();}return true;}return false;},getTreeItem:function C(o){if(o!==null){return L(this.items,o.split(f));}},getLeafNode:function D(p){var o=this.domNode.children[0].children;if((p>=0)&&(p<o.length)){return o[p];}},addChild:function J(t,p){var w=this,o=w.getTreeItem(t).items,q=t.split(f);q.push(o.length);if(this.hasRendered){var u=this.domNode.getElementsByTagName(b);S.forEach(u,function(z){if(z.getAttribute(l)===t){var x=p[0];var AA=document.createElement("div");AA.innerHTML=F.call(w,x,parseInt(z.getAttribute(m),10)+1,q.join(f),a.call(w,x.items,parseInt(z.getAttribute(m),10)+2,q));z.lastChild.appendChild(AA.firstChild);o.push(x);return false;}return true;});}},updateChild:function g(p,o){var t=this;P.copy(o,t.getTreeItem(p));if(this.hasRendered){var q=this.domNode.getElementsByTagName(b);S.forEach(q,function(u){if(u.getAttribute(l)===p){var w=parseInt(u.getAttribute(m),10);u.innerHTML=t.itemRenderer.render(o,w,p,t)+a.call(t,o.items,w+1,p.split(f));return false;}return true;});}},toggleChildSelection:function k(p,o){var q=this.domNode.getElementsByTagName(b);S.forEach(q,function(t){if(t.getAttribute(l)===p){A.toggleClass(t,V,o);this.selectedIndices[p]=o;return false;}return true;},this);},removeChild:function E(q){var p=q.split(f),u=p.length,t=p[u-1],o=this;if(u>1){p=p.splice(0,u-1);o=this.getTreeItem(p.join(f));o.items.splice(t,1);this.updateChild(o._renderIdx,o);}else{this.items.splice(t,1);this.refresh();}},getItemWithPropName:function Y(q,w,z){var p=S.find(q,w,z);var t,u=[];if(p!==-1){u.push(q[p]);}for(t=0;t<q.length;t++){var o=q[t].items;if(o&&o.length){var x=this.getItemWithPropName(o,w,z);if(x&&x.length){u=u.concat(x);}}}return u;},onclick:function X(x){try{var t=x.target||I.eventTarget(x.hWin,x.e),p=t.tagName.toLowerCase(),AB=I.findAncestorByAttr(t,l,true,this.domNode),o=AB&&AB.node.getAttribute(m),w=AB&&AB.value;if(p===n){return ;}if(w!==null&&!isNaN(parseInt(o,10))){var q={sel:{indicesName:"selected",enabledFn:"select",disabledFn:"unselect"},ex:{indicesName:"expanded",enabledFn:"expand",disabledFn:"collapse"}}[(p!==b)?"sel":"ex"];var z=this[q.indicesName+"Indices"],AA=z[w];if(AA){delete z[w];}else{z[w]=true;}this.itemRenderer[AA?q.disabledFn:q.enabledFn](AB.node,this.getTreeItem(w),o,w,this);}}catch(u){mstrApp.onerror(u);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.requiresDescs(1825);var A=mstrmojo.dom;mstrmojo.Refine.RefineFileButton=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.RefineFileButton",browseLabel:mstrmojo.desc(1825,"Browse")+"...",markupString:'<span class="refine-file-button" mstrAttach:click>{@browseLabel}<input type="file" mstrAttach:change/></span>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}},markupSlots:{inputNode:function(){return this.domNode.lastChild;}},onclick:function(B){if(mstrApp.isSingleTier){var E=window.FormWrapper.loadDWHistoryList();this.parent.textArea.set("value",E);this.parent.textArea.oninput();}else{var D=B.e,C=A.eventTarget(B.hWin,D);if(C!==this.inputNode){this.inputNode.click();}}},onchange:function(){var D=this.inputNode.files[0];var C=this;var B=new FileReader();B.onload=function(E){var F=E.target.result;C.parent.textArea.set("value",F);C.parent.textArea.oninput();};B.readAsText(D,"UTF-8");this.inputNode.value="";}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom");function Z(a,c){if(!mstrmojo.DocInfoWindow){return ;}var b=a;while(b){if(b instanceof mstrmojo.DocInfoWindow){b[c?"registerScrollLock":"releaseScrollLock"](this);break;}b=b.parent;}}var L=mstrmojo.array,C=mstrmojo.dom,P=mstrmojo.hash,W=mstrmojo.css,F="px";var B=false;function K(a,c){if(!mstrmojo.DocInfoWindow){return ;}var b=a;while(b){if(b instanceof mstrmojo.DocInfoWindow){b[c?"registerLock":"releaseLock"](this);this.lockIW=c?b:null;break;}b=b.parent;}}var A=mstrmojo.ui.PopupConfig.ENUM_CORNERS,T=A.TOP_LEFT,R=A.TOP_RIGHT,H=A.BOTTOM_RIGHT,G=A.BOTTOM_LEFT;function I(a){return(a===G||a===T);}function X(a){return(a===R||a===H);}function N(a){return(a===H||a===G);}function Q(a){return(a===R||a===T);}function U(h,c,o,w){var AA=o.x,z=o.y,u=o.w||0,k=o.h||0,b=w.w,p=w.h,t=h.alignment,f=t.popup,e=t.host,x=X(e),AB=N(e),q=false,m=false,d=false,n=false;if(I(f)){var g=AA+b+(x?u:0);q=c.w<g;}if(Q(f)){var l=z+p+(AB?k:0);m=c.h<l;}if(X(f)){var j=AA-b+(x?u:0);d=j<0;}if(N(f)){var a=z-p+(AB?k:0);n=a<0;}return{top:n,bottom:m,left:d,right:q};}function E(b){var a=this.popupConfig;if(a){P.forEach(a.popupHandlers,function(d,e){var c=d[b?"open":"close"];if(c){c.call(mstrmojo.all[e]||c,!!b);}});}}function J(b){var a=this.popupConfig;if(a&&!a.isHostedWithin){var c=this.hostProxy;if(c){c.style.display=b?"":"none";}}}function Y(a){return a!==undefined&&a!==null&&!isNaN(a);}mstrmojo._IsPopup={visible:false,lockIWForScroll:false,disposable:true,opener:null,onOpen:mstrmojo.emptyFn,onClose:mstrmojo.emptyFn,popupConfig:null,hostProxy:undefined,open:function M(c,a){E.call(this,true);if(this.updatePopupConfig){this.updatePopupConfig(a,c);}else{P.forEach(a,function(f,e){this.set(e,f);},this);}var b="popup-mid-render";this.set("opener",c);if(!this.hasRendered){var d=this.visible;this.visible=false;this.render();W.addClass(this.domNode,b);this.set("visible",d);}if(this.nudge){this.domNode.style.top="-10000px";}J.call(this,true);this.set("visible",true);if(this.lockIWForScroll){Z.call(this,this.opener,true);}if(a&&a.lockIW){K.call(this,a.lockIW,true);}if(this.nudge){this.nudge();}this.adjustCornersForPopupOverflow();this.onOpen();W.removeClass(this.domNode,b);},adjustCornersForPopupOverflow:function V(){var l=this.popupConfig;if(!l){return false;}var AL=(l.includeScroll!==undefined)?l.includeScroll:true;var o=l.position||C.position(l.anchorElement||l.hostElement,AL);if(!l.isHostedWithin){var AB=this.hostProxy,t=this.hostProxy=document.createElement("div");document.body.appendChild(t);t.appendChild(this.domNode);if(AB){AB.parentNode.removeChild(AB);}var e=t.style,u={x:"left",y:"top",w:"width"};t.className=l.hostProxyCssClass;e.position="absolute";e.background="none";e.height="0";L.forEach(["x","y","w"],function(AO){var AN=o[AO];if(Y(AN)){e[u[AO]]=AN+F;}});}var AI=l.ENUM_CORNERS,z=AI.BOTTOM_LEFT,j=AI.BOTTOM_RIGHT,h=AI.TOP_RIGHT,AE=AI.TOP_LEFT;var AF=U(l,C.position(document.body),o,C.position(this.domNode)),AA=AF.right,p=AF.bottom,d=AF.left,x=AF.top,AD=l.alignment,q=AD.popup,AM=AD.host,g=q,c=AM;if(AA||d){if(I(c)){c=Q(c)?h:j;}else{if(X(c)){c=Q(c)?AE:z;}}if(AA&&I(g)){g=Q(g)?h:j;}else{if(d&&X(g)){g=Q(g)?AE:z;}}}if(p||x){if(I(c)){c=Q(c)?z:AE;}else{if(X(c)){c=Q(c)?j:h;}}if(p&&Q(g)){g=I(g)?z:j;}else{if(x&&N(g)){g=I(g)?AE:h;}}}if(x||AA||p||d){if(B){console.log("Overflow directions: "+JSON.stringify(AF));}this._orgalgn={host:AM,popup:q};l.setAlignment(c,g);}if(!l.isHostedWithin){if(Y(o.y)&&Y(o.h)){this.hostProxy.style.top=(o.y+(N(g)?(l.alignWithAnchor===true?o.h:0):(l.alignWithAnchor===true?0:o.h)))+F;}}var AC=N(c),AH=X(c),AG=N(g),n=X(g),k="auto",b="100%",a="0";var w=k,AJ=k,m=k,f=k;if(AG){m=AC?a:b;}else{w=AC?b:a;}if(n){AJ=AH?a:b;}else{f=AH?b:a;}var AK=this.domNode.style;AK.top=w;AK.right=AJ;AK.bottom=m;AK.left=f;return true;},close:function O(b){if(this.onClose){this.onClose(b);}J.call(this,false);if(this.lockIWForScroll){Z.call(this,this.opener,false);}this.set("visible",false);this.set("opener",null);if(this.lockIW){K.call(this,this.lockIW,false);}E.call(this,false);var a=this._orgalgn;if(a){this.popupConfig.setAlignment(a.host,a.popup);}},buildRendering:function D(){var a=this._super();if(a){if(!this.parent&&!this.domNode.parentElement){document.body.appendChild(this.domNode);}}return a;},unrender:function S(a){if(this.popupConfig&&!this.popupConfig.isHostedWithin&&this.hostProxy){document.body.removeChild(this.hostProxy);delete this.hostProxy;}this._super(a);}};}());(function(){mstrmojo.requiresCls("mstrmojo.DI.OAuthSource","mstrmojo.DI.DIConstants");mstrmojo.DI.OAuthAnalytics=mstrmojo.declare(mstrmojo.DI.OAuthSource,null,{scriptClass:"mstrmojo.DI.OAuthAnalytics",accounts:[],onGetAnalyticsWebProperties:{},onGetAnalyticsProfiles:{},reset:function(){this.accounts=[];this.onGetAnalyticsProfiles={};this.onGetAnalyticsProfiles={};this._super();},populateReports:function B(H){if(H.mi.ght){this.accounts=this.isArray(H.mi.ght.gacc)?H.mi.ght.gacc:this.makeArray(H.mi.ght.gacc);}if(this._super){this._super(H);}if(this.accounts&&this.accounts[0]){this.populateWebProperties(H,this.accounts[0].id);this.populateProfiles(H,this.accounts[0].id,this.accounts[0].webProperties[0].id);}},populateWebProperties:function G(I,M){var K=this.isArray(I.mi.ght.gacc)?I.mi.ght.gacc:this.makeArray(I.mi.ght.gacc);var H=mstrmojo.array.find(K,"id",M);var N=null;if(H===-1){return ;}N=K[H];for(var J=0;J<this.accounts.length;J++){var L=this.accounts[J];if(L.id===M){L.webProperties=this.isArray(N.gprp)?N.gprp:this.makeArray(N.gprp);break;}}this.raiseEvent({name:"analyticsWebPropertiesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});},checkWebProperties:function C(J,I){var H=this.getAccountById(J);if(!H){return false;}if(H.webProperties){if(I){this.raiseEvent({name:"analyticsWebPropertiesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});}return true;}else{return false;}},populateProfiles:function E(S,H,J){var R,N,O,I,P;R=this.isArray(S.mi.ght.gacc)?S.mi.ght.gacc:this.makeArray(S.mi.ght.gacc);P=mstrmojo.array.find(R,"id",H);if(P===-1){return ;}O=R[P];N=this.isArray(O.gprp)?O.gprp:this.makeArray(O.gprp);P=mstrmojo.array.find(N,"id",J);if(P===-1){return ;}I=N[P];for(var L=0;L<this.accounts.length;L++){var M=this.accounts[L];if(M.id===H){for(var K=0;K<M.webProperties.length;K++){var Q=M.webProperties[K];if(Q.id===J){Q.profiles=this.isArray(I.gprf)?I.gprf:this.makeArray(I.gprf);break;}}break;}}this.raiseEvent({name:"analyticsProfilesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});},checkProfiles:function F(M,L,K){var J,I,H;J=this.getAccountById(M);if(!this.checkWebProperties(M,false)){return false;}H=mstrmojo.array.find(J.webProperties,"id",L);if(H===-1){return false;}I=J.webProperties[H];if(I.profiles){if(K){this.raiseEvent({name:"analyticsProfilesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});}return true;}else{return false;}},getAccountById:function D(J){var H=0;var I=null;for(H=0;H<this.accounts.length;H++){if(this.accounts[H].id===J){I=this.accounts[H];break;}}return I;},parseOAuthSourceFolder:function A(L){var I=[];var N=this.isArray(L.mi.ftree.fd)?L.mi.ftree.fd:this.makeArray(L.mi.ftree.fd);var H=this.isArray(L.mi.ftree.fl)?L.mi.ftree.fl:this.makeArray(L.mi.ftree.fl);var K,O,J,M;for(J=0;J<N.length;J++){K=N[J];M={isFolder:true};M.n=K.n;M.desc=K.des;M.address=K.address;M.type=0;I.push(M);}for(J=0;J<H.length;J++){O=H[J];M={isFolder:false};M.edit=true;M.n=O.n;M.desc=O.des;M.address=O.address;M.type=O.mimetype;I.push(M);}return I;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var C=1;mstrmojo._hasWidgetListMapper={buildItemWrappers:function A(H,G,F,E,J,I){E.first=J;E.last=I;return this._super(H,G,F,E,0,0);},postBuildRendering:function B(K,I,H,G,F){var J=F.first;if(J){this.fillItemWrappers(K,I,H,G,F,0,J);}if(F.last){var E=I&&I.length||0,L=Math.max(Math.max(0,E-F.last),J);this.fillItemWrappers(K,I,H,G,F,L,E);}if(this._super){this._super(K,I,H,G,F);}},fillItemWrappers:function D(F,N,K,R,M,E,I,Q){var L=(N&&N.length)||0,P=this.wrapperNodes(F),S=M.itemStatus;for(var J=E,O=Math.min(I+1,L),H=0;J<O;J++){if(S[J]!==C){var G=K.build(R,M,N[J],J);if(G){G.placeholder=P[J].firstChild;G.render();}H++;if(H===Q){break;}}}return H;},onchange:null};mstrmojo.WidgetListMapper=mstrmojo.provide("mstrmojo.WidgetListMapper",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.WidgetListMapper.RENDERED=C;mstrmojo.requiresCls("mstrmojo.ListMapperHoriz");mstrmojo.WidgetListMapperHoriz=mstrmojo.provide("mstrmojo.WidgetListMapperHoriz",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperHoriz)));})();(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");mstrmojo.ListMapperTable=mstrmojo.provide("mstrmojo.ListMapperTable",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table">',markupSuffix:"</table>",itemWrapperPrefix:function(E){return'<tbody class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"<tr><td>&nbsp;</td></tr>",itemWrapperSuffix:"</tbody>",wrapperNodes:function D(E){return this.wrapperParentNode(E).tBodies;},wrapperParentNode:function C(E){return E.getElementsByTagName("table")[0];},createWrapperNode:function B(E){var F=E.ownerDocument,G=F.createElement("tbody");return G;},findIndex:function A(G,J,I){if(J&&I){var F=G.domNode,E=this.wrapperParentNode(J),H=I.parentNode;while(H){if(H===E){return mstrmojo.array.findBin(this.wrapperNodes(J),I,"offsetTop",G.items&&G.items.length);}else{if(H===F){break;}}I=H;H=I.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.requiresCls("mstrmojo.WidgetListMapper");mstrmojo.WidgetListMapperTable=mstrmojo.provide("mstrmojo.WidgetListMapperTable",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperTable)));})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo._IsPopup","mstrmojo._CanAutoClose");var C=mstrmojo.dom;mstrmojo.ui.PopupWidget=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.PopupWidget",markupString:'<div id="{@id}" class="mstrmojo-ui-PopupWidget {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="pw-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},autoCloses:true,locksHover:true,closeOnClick:true,visible:true,onclick:function B(D){C.stopPropogation(null,D.e);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Container","mstrmojo._IsPopup","mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.ui._HasScroller");var L=mstrmojo.boxmodel,I=mstrmojo.dom,M=mstrmojo.css,O="mstrmojo-Tooltip",A="mstrmojo-scrollNode",E=20;function C(S,T,R){var U="connectScrollbox";if(R){U="dis"+U;}var Q=S&&S.parent;while(Q){if(Q[U]){Q[U](T);}Q=Q.parent;}}function G(){if(!this._paintHandle){var R=this.id,Q=function(V){var Z=mstrmojo.all[R];if(!Z){return ;}delete Z._paintHandle;var T=[O],a=Z.cssClass;if(a){T.push(a);}var S=mstrApp.getThemeClassName&&mstrApp.getThemeClassName(),X=Z.opener;if(X&&X.getTooltipThemeClass){S=X.getTooltipThemeClass();}T.push(S);Z.domNode.className=T.join(" ");var Y=Z.content,U=Z.contentNode,W=Z.arrowNode;U.className=(O+"-content "+A+" "+Z.contentNodeCssClass);U.style.cssText=Z.contentNodeCssText;U.innerHTML=Y;W.style.cssText="";Z.domNode.style.visibility=!!Y?"visible":"hidden";Z.updatePosition();if(!V&&Z.optimizePos){Z.optimizePos();}Z.updateScrollbars();};if(!this._hasPaint){Q(true);this._hasPaint=true;}else{this._paintHandle=window.setTimeout(Q,0);}}}function B(h,c,a,Y){var T=c&&(c.richTooltip||c.tooltip),f=a?I.getMousePosition(a,Y||self):null,Q=T&&(typeof T==="string");var U="",g="",d="",Z=T,X=null,W=mstrmojo.tooltip.POS_TOPLEFT,S=null,b=null;var V=false,R=false;if(T&&!Q){g=T.cssClass||g;U=T.contentNodeCssClass||U;d=T.contentNodeCssText||d;Z=T.content||"";X=T.refNode||X;W=T.posType||W;S=T.left||0;b=T.top||0;V=T.keepArrowXPos||V;R=T.keepArrowYPos||R;}h.set("contentNodeCssClass",U);h.set("cssClass",g);h.set("contentNodeCssText",d);h.set("content",Z);h.set("refNode",X);h.set("posType",W);h.set("left",Q?((f&&f.x)||h.left):S);h.set("top",(Q||!T)?((f&&(f.y+E))||h.top):b);h.set("keepArrowXPos",V);h.set("keepArrowYPos",R);}mstrmojo.Tooltip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Tooltip",content:null,top:null,left:null,refNode:null,keepArrowXPos:false,keepArrowYPos:false,posType:"TL",markupString:'<div id="{@id}" class="'+O+' {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout><div class="'+O+'-shadow {@shadowNodeCssClass}"></div><div class="'+O+'-contentWrapper"><div class="'+O+"-content "+A+' {@contentNodeCssClass}" style="{@contentNodeCssText}"></div></div><div class="'+O+'-arrow"></div></div>',markupSlots:{containerNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[1].firstChild;},shadowNode:function(){return this.domNode.firstChild;},arrowNode:function(){return this.domNode.children[2];}},setupScrollNodes:function D(){this.scrollNode=this.contentNode;this.scrollbarHostNode=this.containerNode;},_previousVisible:false,markupMethods:{onvisibleChange:function(){var R=this.domNode.style,Q=!!this.visible;if(this._previousVisible!==Q){R.visibility="hidden";}R.display=Q?"block":"none";this._previousVisible=Q;if(Q){this.updatePosition();if(this.content){G.call(this);}}},onleftChange:G,ontopChange:G,onrefNodeChange:G,onposTypeChange:G,oncontentNodeCssClassChange:G,oncontentNodeCssTextChange:G,oncontentChange:G,oncssClassChange:G},preBuildRendering:function N(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},updatePosition:function H(V){if(!this.visible&&!V){return ;}var U=this.refNode,T=U?L.offset(U,document.body):{left:I.getHorizontalScroll(),top:I.getVerticalScroll()},l=this.domNode.style,e=this.containerNode,g=e.offsetWidth,Y=e.offsetHeight,R=this.posType,b=R.indexOf("R")>-1,W=R.indexOf("B")>-1,a=this.top!==null?parseInt(this.top,10)+T.top-(W?Y:0):null,S=this.left!==null?parseInt(this.left,10)+T.left-(b?g:((R.indexOf("C")>-1)?Math.floor(g/2):0)):null,j=false,Z=false,c,X,h=I.windowDim(),f=I.getHorizontalScroll()+h.w,Q=I.getVerticalScroll()+h.h,d=this.arrowNode,k=null;if(S!==null){c=Math.min(Math.max(S,0),f-g);l.left=c+"px";j=S!==c;}if(a!==null){X=Math.min(Math.max(a,0),Q-Y);l.top=X+"px";Z=a!==X;}if(j||Z){if((this.keepArrowXPos&&j)||(this.keepArrowYPos&&Z)){k=M.getComputedStyle(d);}if(this.keepArrowXPos&&j){d.style.left=(parseInt(k.left,10)+S-c)+"px";}if(this.keepArrowYPos&&Z){d.style.top=(parseInt(k.top,10)+a-X)+"px";}}M.toggleClass(this.domNode,"offset",j||Z);},_on_tooltip_change:function(Q){B(this,Q&&Q.src);},_set_opener:function(T,S){var R=this.opener,Q=S!==R;if(Q){if(S){C(S,this);}if(R){C(S,this,true);}if(R&&R.detachEventListener){R.detachEventListener(this._richSubs);R.detachEventListener(this._ttpSubs);}if(S&&S.attachEventListener){this._richSubs=S.attachEventListener("richTooltipChange",this.id,"_on_tooltip_change");this._ttpSubs=S.attachEventListener("tooltipChange",this.id,"_on_tooltip_change");}this.opener=S;}return Q;},updatePopupConfig:function(Q,R){B(this,R,Q&&Q.e,Q&&Q.win);},onscroll:function K(){if(this.visible&&this.nudge){this.nudge();}this._super();},onmouseover:mstrmojo.emptyFn,onmouseout:mstrmojo.emptyFn});var J=null;mstrmojo.tooltip={POS_TOPLEFT:"TL",POS_BOTTOMLEFT:"BL",POS_TOPRIGHT:"TR",POS_BOTTOMRIGHT:"BR",POS_BOTTOMCENTER:"BC",POS_TOPCENTER:"TC",open:function F(R,T,S,Q){if(!J||!mstrmojo.all[J.id]){J=new mstrmojo.Tooltip();}Q=Q||{};Q.e=T;Q.win=S;J.open(R,Q);R.tooltip=J;},close:function P(){if(J){if(J.opener){J.opener.tooltip=null;}J.close();}}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsPopup","mstrmojo._CanAutoClose");function A(B){return function(){this.domNode.style[B]=this[B]||"";};}mstrmojo.Popup=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.Popup",shadowNodeCssClass:"mstrmojo-popup-shadow",titleNodeCssClass:"mstrmojo-popup-title",contentNodeCssClass:"mstrmojo-popup-content",cssDisplay:"block",markupString:'<div id="{@id}" class="mstrmojo-Popup {@cssClass}" style="{@cssText}"><div class="mstrmojo-Popup-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Popup-title {@titleNodeCssClass}">{@title}</div><div class="mstrmojo-Popup-content {@contentNodeCssClass}"></div></div>',markupSlots:{containerNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onleftChange:A("left"),ontopChange:A("top"),onzIndexChange:A("zIndex")}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineFileButton");mstrmojo.requiresDescs(14180,14181,14182,14183,221,2164);mstrmojo.Refine.RefineImportDialog=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.Refine.RefineImportDialog",markupString:'<div id="{@id}" class="refine-import-dialog"><div class="refine-import-dialog-header">'+mstrmojo.desc(14180,"Import History Script")+'</div><div class="refine-import-dialog-body"><div class="refine-import-dialog-instruction"></div><div class="refine-import-dialog-input"></div></div><div class="refine-import-dialog-footer"><div class="refine-import-dialog-cancel"></div><div class="refine-import-dialog-apply"></div><div class="refine-import-dialog-file"></div></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.firstChild;},instructionNode:function(){return this.domNode.children[1].children[0];},inputNode:function(){return this.domNode.children[1].children[1];},cancelNode:function(){return this.domNode.children[2].children[0];},applyNode:function(){return this.domNode.children[2].children[1];},fileNode:function(){return this.domNode.children[2].children[2];}},markupMethods:{onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;}},getMovingHandle:function C(){return this.headerNode;},getMovingTarget:function E(){return this.editorNode;},preBuildRendering:function A(){this.placeholder=document.body.appendChild(document.createElement("div"));return this._super();},children:[{scriptClass:"mstrmojo.Label",slot:"instructionNode",bindings:{text:function(){if(!!window.FileReader){return mstrmojo.desc(14181,"Browse or Paste the Wrangling Script");}else{return mstrmojo.desc(14182,"Paste the Wrangling Script");}}}},{scriptClass:"mstrmojo.TextArea",markupString:'<textarea id="{@id}" class="mstrmojo-TextArea {@cssClass}"  style="{@cssText}" title="{@tooltip}" placeholder="{@placeholderText}" rows="{@rows}" cols="{@cols}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,input,keydown,keyup,blur></textarea>',slot:"inputNode",alias:"textArea",maxLength:undefined,onkeyup:function B(){if(this.value){this.parent.apply.set("enabled",true);}else{this.parent.apply.set("enabled",false);}},oninput:function D(){if(this.value){this.parent.apply.set("enabled",true);}else{this.parent.apply.set("enabled",false);}}},{scriptClass:"mstrmojo.Refine.RefineFileButton",slot:"fileNode",bindings:{visible:function(){return !!window.FileReader;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",slot:"cancelNode",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"apply",slot:"applyNode",enabled:false,text:mstrmojo.desc(2164,"Apply"),onclick:function(){String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"");};String.prototype.startsWith=function(I){return this.length>=I.length&&this.substring(0,I.length)==I;};String.prototype.endsWith=function(I){return this.length>=I.length&&this.substring(this.length-I.length)==I;};String.prototype.contains=function(I){return this.indexOf(I)>=0;};var G=function(I){I=I.trim();if(!I.startsWith("[")){I="["+I;}if(!I.endsWith("]")){I=I+"]";}return I.replace(/\}\s*\,\s*\]/g,"} ]").replace(/\}\s*\{/g,"}, {");};var F;try{F=this.parent.textArea.value;F=G(F);F=JSON.parse(F);}catch(H){mstrmojo.alert(mstrmojo.desc(14183,"The JSON you pasted is invalid."));return ;}this.parent.controller.applyOperations({operations:JSON.stringify(F),engine:JSON.stringify({facets:[],mode:"row-based"})});this.parent.destroy();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.SimpleTree","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.architect.ui._HasTreeDropZone","mstrmojo.string","mstrmojo.dom","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(11611,11805,13243);var I=mstrmojo.dom,t=mstrmojo.string,B=mstrmojo.css,T=mstrmojo.hash,X=mstrmojo.array,C=mstrmojo.warehouse.EnumObjectTypes,g=mstrmojo.DI.DIConstants,M="selected",l=mstrmojo.DI.DIHelpers,h="li",z="idx",P=12,x="tableViewItemAttr",V="tableViewItemMetric",H="tableViewItemForm";function p(AC,AB){var AA=mstrmojo.dom.position(AC).y;var AD=mstrmojo.dom.position(AC).h;var AE=mstrmojo.dom.position(AB);if(AA+AD>=AE.y+AE.h){AC.parentElement.scrollTop=AC.parentElement.scrollTop+AA-AE.y-AE.h+AD;}else{if(AA<AE.y){AC.parentElement.scrollTop=AC.parentElement.scrollTop-(AE.y-AA);}}}mstrmojo.DI.DIMappingTableRows=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._HasOwnAvatar,mstrmojo._HasPopup,mstrmojo.warehouse._CanToggleAvatarClass,mstrmojo.architect.ui._HasTreeDropZone],{scriptClass:"mstrmojo.DI.DIMappingTableRows",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree mstrmojo-di-mappingRows {@cssClass}" mstrAttach:click,dblclick,contextmenu,scroll>{@itemsHTML}</div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},scrollboxNode:function N(){return this.domNode;}},tableData:undefined,tp:undefined,useRichTooltip:true,convertEnabled:true,init:function o(AA){this._super(AA);this.userSelections={};},getItemMarkup:function G(){return'<div class="item {@cls}"><span class="di-item-ic"></span><span class="di-item-n {@ipa}">{@n}</span><div class="{@link}"></div>';},preBuildRendering:function A(){if(this._super){this._super();}if(l.isIE()){var AA=document.getElementsByTagName("div");mstrmojo.array.forEach(AA,function(AB){AB.onselectstart=function(){return false;};});}},postBuildRendering:function O(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:"",keepArrowXPos:true});if(!this._ontooltipover){var AA=this.id;this._ontooltipover=function(AB){var AE=mstrmojo.all[AA];var AG=AB.target||AB.srcElement;I.stopPropogation(self,AB);var AD=I.findAncestorByAttr(AG,z,true,AE.domNode);if(!!AD){var AC=AD.node.firstChild.childNodes[1];var AH=mstrmojo.dom.position(AC);if(AH.w<AC.scrollWidth){var AF=AE.getTreeItem(AD.value);AE.richTooltip.refNode=AG;AE.richTooltip.content=t.encodeHtmlString((AF.ipa?(mstrmojo.desc(13243,"Project Attribute")+": "):"")+AF.ttp+((AF.isMultiForm&&AF.fmn)?"@"+AF.fmn:""));AE.showTooltip(AB,self);}}};this._ontooltipout=function(AB){var AC=mstrmojo.all[AA];AC.hideTooltip(AB,self);};}return this._super();},getItemProps:function b(AB,AA){return{sel:!!this.selectedIndices[AA],cls:(function(){var AG=AB.isLinked;var AE=false;if(AG){var AF=mstrApp.getRootController().model.findMappingItem(AB);var AD;for(AD=0;AD<AF.length;AD++){if(AF[AD].georole){AE=true;break;}}}var AC="tp"+AB.tp;if((!AB.isAttributeForm&&AB.georole&&AB.georole>0)||AE){AC+=" geo";}else{if(AB.timerole&&AB.timerole>0){AC+=" time";}}return AC+(AB.unused?" uc":"");}()),link:AB.isLinked?"linked":"",n:t.encodeHtmlString(AB.isAttributeForm?(AB.alias+"@"+AB.fmn):AB.alias),idx:AA,ipa:AB.ipa?"ipa":""};},getRowItem:function n(AA){return this.getTreeItem(AA);},getRowNode:function u(AC,AB){var AA=mstrmojo.array.find(this.items,AC,AB);if(AA>-1){return this.domNode.children[0].children[AA];}},isItemAvailable:function S(AA){return this.getItemWithPropName(this.items,"did",AA).length>0;},handleEvent:function K(AA){var AB=this.getItemWithPropName(this.items,"did",AA.did)[0];switch(AA.name){case"Remove":this.removeChild(AB._renderIdx);return true;case"Rename":AB.n=AA.value;this.updateChild(AB._renderIdx,AB);return true;}return false;},onclick:function e(AH){try{var AD=AH.target||I.eventTarget(AH.hWin,AH.e),AI=I.findAncestorByAttr(AD,z,true,this.domNode),AA;if(AI){AI.tableId=AH.src.tableData.id;AI.tableRow=this;AI.tableRow.parent=this.parent;this.parent.parent.clickedNode=AI;}if(!l.isCtrlKey(AH.hWin,AH.e)&&!I.shiftKey(AH.hWin,AH.e)){this.parent.parent.raiseEvent({name:"allTableSelectionClear"});}else{this.parent.parent.raiseEvent({name:"allTableSelectionClear",source:AH.src.tableData});}this._super(AH);this.raiseEvent({name:"tableSelectionClear",source:this});this.parent.parent.parent.linker.clearLinks();var AG=this.getUserSelectedData();if(AG&&AG.length>0){this.parent.parent.parent.parent.raiseEvent({name:"scrollPreviewToCurItem",tableId:this.tableData.id,columnIndex:AG[0].dataIdx,data:AG[0]});}if(I.shiftKey(AH.hWin,AH.e)){var AF=Math.min(parseInt(AG[0]._renderIdx,10),parseInt(AG[1]._renderIdx,10));var AB=Math.max(parseInt(AG[0]._renderIdx,10),parseInt(AG[1]._renderIdx,10));if(AG.length>2){AD=AH.target||I.eventTarget(AH.hWin,AH.e);AI=I.findAncestorByAttr(AD,"idx",true,this.domNode);if(AF>AI.value){AB=AF;AF=AI.value;}else{AF=AB;AB=AI.value;}}var AC;for(AC=AF;AC<AB;AC++){this.userSelections[AC]=true;AA=this.domNode.children[0].childNodes[AC];B.addClass(AA,"selected");if(AC!==AF&&AC!==AB){AG.push(this.items[AC]);}}}if(AG.length!==0){X.forEach(AG,function(AJ){if(AJ.isLinked){this.raiseEvent({name:"selectLinkedItems",source:this,oid:AJ.oid,alias:AJ.alias});}},this);}}catch(AE){throw AE;}},ondblclick:function R(AA){var AD=AA.getTarget();if(AD.nodeName!=="SPAN"){AD=AD.childNodes[1];}else{var AC=mstrmojo.string.trim(AD.nextSibling.className);if(AC==="di-item-n"){AD=AD.nextSibling;}}var AE={data:this.getUserSelectedData(),target:AA.src.parent,position:I.position(AD,true)};this.clearSelections(T.copy(this.userSelections));var AB=AE.data[0];if(!AB||AB.isAttributeForm){return ;}mstrApp.getRootController().openRenameTextBox(g.contextMenuType.ITEM_MENU,AD,AE);},treeHooks:{select:function m(AC,AD){var AE=this.userSelections,AB=AD._renderIdx,AA=AE[AB]===true;if(AA){delete AE[AB];}else{AE[AB]=true;}B.toggleClass(AC,M,!AA);delete this.selectedIndices[AB];return true;}},createAvatar:function W(AB){var AE=document.createElement("div"),AC=I.findAncestorByAttr(AB,z,true,this.domNode);if(AC&&AC.node){var AA=this.userSelections;if(AA[AC.value]){var AD=this.domNode.getElementsByTagName(h);X.forEach(AD,function(AF){if(AA[AF.getAttribute(z)]===true){AE.appendChild(AF.cloneNode(true));}},this);}else{AE.appendChild(AC.node.cloneNode(true));}AE.appendChild(document.createElement("div"));}AE.className=this.domNode.className;return AE;},ondragenter:function E(AA){if(this._super){this._super(AA);}var AB=AA.src.widget;if(AB&&AB.updateAvatarHTML){AB.updateAvatarHTML(AA);}},isDragValid:function U(){return true;},ondragstart:function f(AA){this._super(AA);if(AA.src.data&&AA.src.data.length){this.selectItem("did",AA.src.data[0].did);}},ondragmove:function F(AA){if(this._super){this._super(AA);}var AD=AA.src.widget;var AC=AA.tgt.widget;var AB=AA.tgt.node.parentElement;if(AD&&AC&&AD.tp===P&&AC.tp===P&&AB!==AC.domNode){this.parent.parent.parent.linker.clearLinks();this.parent.parent.parent.linker.drawLink(AB,AC.parent,AA.src.node,AD.parent);}else{this.parent.parent.parent.linker.clearLinks();}},updateAvatarHTML:function q(AA){var AB="";if(!this.convertEnabled){return ;}if(AA.action===V&&this.tp===C.METRIC){AB=mstrmojo.desc(11611,"Convert to Attribute");}else{if(AA.action===x){if(this.tp===C.ATTRIBUTE){AB=mstrmojo.desc(11805,"Convert to Metric");}}}this.avatar.lastChild.innerHTML=AB;},getAvatarIconClass:function Q(AA){var AB=AA.src&&AA.src.data;AB=AB&&AB[0];return AB.tableId===this.tableData.id?"enabled":"";},toggleAvatarClass:function j(AA,AB){B.toggleClass(this.avatar,AA,AB);},getDragAction:function J(AA){var AB=I.findAncestorByAttr(AA.src.node,z,true,this.domNode);if(AB){switch(this.getRowItem(AB.value).tp){case C.ATTRIBUTE:return x;case C.METRIC:return V;case C.FORM:return H;}}},getDragData:function d(AC){var AA=this.getNodeAttributes(AC.src.node).index,AB=this.getTreeItem(AA),AD=this.userSelections;if(AB&&AB.tp!==21){T.copy(AB,{columnId:AB.did,tableName:this.tableData.n,tableId:this.tableData.id});if(AD[AA]===true){return this.getUserSelectedData();}this.clearSelections(T.copy(AD));return[AB];}return AB;},getUserSelectedData:function Y(){var AB=[],AA;T.forEach(this.userSelections,function(AC,AD){AA=this.getTreeItem(AD);AB.push(T.copy(AA,{columnId:AA.did,tableName:this.tableData.n,tableId:this.tableData.id}));},this);return AB;},getNodeAttributes:function w(AB){var AA=I.findAncestorByAttr(AB,z,true,this.domNode),AC=AA&&AA.node.getAttribute("level");return{index:AA&&AA.value,level:parseInt(AC,10)};},clearSelections:function Z(AD){var AC=this.domNode.getElementsByTagName(h),AB;X.forEach(AC,function AA(AE){AB=AE.getAttribute(z);if(AD[AB]===true){B.toggleClass(AE,M,false);delete this.userSelections[AB];}},this);},selectItem:function L(AE,AB){var AA=this.items;var AC=mstrmojo.array.find(AA,AE,AB);var AD;if(AC!==-1){AD=this.domNode.children[0].childNodes[AC];if(!this.userSelections[AC]){this.userSelections[AC]=true;B.addClass(AD,"selected");}p(AD,this.domNode);}return AD;},onscroll:function k(){var AA=this.getUserSelectedData();if(AA.length!==0&&AA[0].isLinked){this.raiseEvent({name:"drawLinks",source:this,oid:AA[0].oid});}},draggable:true,dropZone:true,allowDrop:function D(AB){var AC=AB.src&&AB.src.data;var AA=AC&&AC.length;AC=AC&&AC[0];if(AC&&AC.tableId===this.tableData.id){return this.convertEnabled&&AC.tp!==this.tp&&X.indexOf([x,V],AB.action)!==-1;}return AB.action===x&&AC.tp===this.tp&&AA===1;},ondrop:function a(AC){var AB=mstrApp.getRootController(),AG=AC.src;if(AG&&AG.data){var AF=AG.data,AD=I.findAncestorByAttr(AC.tgt.node,z,true,this.domNode),AA;if(this.tableData.id===AF[0].tableId){if(AC.action===x&&this.tp===C.METRIC){AB.toMetric(AF);}if(AC.action===V&&this.tp===C.ATTRIBUTE){AB.toAttribute(AF);}}else{if(AD&&AF.length===1&&this.tp===AF[0].tp){this.domNode.scrollTop=50;AA=this.getTreeItem(AD.value);var AE=AC.tgt;AE.data=[AA];this.raiseEvent({name:"tableSelectionClear"});this.selectItem("did",AA.did);AB.linkAttributes(AE,AG);this.parent.parent.parent.linker.clearLinks();}}}if(this._super){this._super(AC);}},oncontextmenu:function c(AB){var AE=AB.src;var AD=AB.getTarget()||I.eventTarget(AB.hWin,AB.e);var AC=I.findAncestorByAttr(AD,"idx",true,this.domNode),AA=AC&&AC.value;if(!AE.userSelections[AA]&&!l.isCtrlKey(AB.hWin,AB.e)){this.raiseEvent({name:"tableSelectionClear"});this.onclick(AB);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.InlineEditBox");var B=mstrmojo.dom,A=mstrmojo.css;mstrmojo.DI.DIInlineEditBox=mstrmojo.declare(mstrmojo.InlineEditBox,null,{scriptClass:"mstrmojo.DI.DIInlineEditBox",cssClass:"mstrmojo-di-rename-box",init:function C(D){this._super(D);this.markupMethods.oneditModeChange=function(){var J=this.editMode,G=this.domNode,F=this.textNode,I=this.editNode;A.toggleClass(G,["edit"],J);if(J){F.style.display="none";I.style.display="block";F=this.inputNode;var H=F.style;F.value=mstrmojo.string.decodeHtmlString(this.text||"");H.width=(G.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";H.height=G.clientHeight+"px";F.select();F.focus();if(F.createTextRange){var K=F.createTextRange(),E=F.value.length;K.move("character",E);K.select();}}else{F.style.display="block";I.style.display="none";}};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.InlineEditBox","mstrmojo.Button");var B=": ";mstrmojo.qb.thirdParty.InlineEditBox=mstrmojo.declare(mstrmojo.InlineEditBox,null,{postCreate:function A(){if(this._super){this._super();}this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.oneditModeChange=function(){var I=this.editMode,F=this.domNode,E=this.textNode,H=this.editNode;mstrmojo.css.toggleClass(F,["edit"],I);if(I){E.style.display="none";H.style.display="block";E=this.inputNode;var G=E.style;E.value=this.parent.url||"";G.width=(F.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";G.height=F.clientHeight+"px";E.focus();if(E.createTextRange){var J=E.createTextRange(),D=E.value.length;J.move("character",D);J.select();}}else{E.style.display="block";H.style.display="none";}};},save:function(){this.set("text",this.parent.dbRoleName+B+this.inputNode.value);this.set("editMode",false);if(this.onSave){this.onSave();}},rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){this.parent.set("url",this.inputNode.value);},bindings:{text:function(){return this.parent.dbRoleName+B+this.parent.url;}}});mstrmojo.qb.thirdParty.UrlSourceItem=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.thirdParty.UrlSourceItem",markupString:"<div class='qb-bi-source-url-list' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},iconNode:function(){return this.domNode.children[0];},contentNode:function(){return this.domNode.children[1];},deleteNode:function(){return this.domNode.children[2];}},allowEdit:true,url:"",dbRoleID:"",dbRoleName:"",children:[{slot:"iconNode",alias:"icon",cssClass:"mstrmojo-di-url-icon",scriptClass:"mstrmojo.Label"},{slot:"contentNode",alias:"text",cssClass:"urlItem-text-div",scriptClass:"mstrmojo.qb.thirdParty.InlineEditBox"},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-url-delete-button",innerIconClass:"close-button",onclick:function(){this.parent.deleteURL();}}],deleteURL:function C(){this.parent.deleteURL(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ConditionNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo.dom","mstrmojo.css");var A=mstrmojo.dom,B=mstrmojo.css,D=mstrmojo.fe._IsRelationTreeNode.createSetHtml;mstrmojo.fe.ConditionNode=mstrmojo.declare(mstrmojo.ConditionNode,[mstrmojo.fe._IsRelationTreeNode],{scriptClass:"mstrmojo.fe.ConditionNode",emptyText:mstrmojo.desc(5893,"New Condition"),markupString:'<div id="{@id}" class="mstrmojo-cond mstrmojo-ConditionNode {@cssClass}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-cond-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-onhoverparent mstrmojo-cond-contents {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-text {@cssClass}" mstrAttach:click></span><span class="mstrmojo-cond-text-postfix {@cssClass}"></span><span class="mstrmojo-rel mstrmojo-cond-popupNode {@cssClass}"></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" tooltip="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" /></span><span class="mstrmojo-add-cond" mstrAttach:click>'+mstrmojo.desc(1994,"Add Condition")+"</span>"+D+"</div></div>",getPrefixAndOrToolsMarkup:function(){return(D+this._super());},markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},condNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.childNodes[1].firstChild;},textPostfixNode:function(){return this.domNode.childNodes[1].childNodes[1];},popupNode:function(){return this.domNode.childNodes[1].childNodes[2];},createSetNode:function(){return this.domNode.childNodes[1].lastChild;},createSetOptNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},addConditionNode:function(){return this.domNode.childNodes[1].childNodes[4];}},markupMethods:mstrmojo.hash.copy({onnoRelationOperatorChange:function(){B.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);},onnoRelationChange:function(){B.toggleClass(this.condNode,["noRelation"],this.noRelation);},onnoCreateSetChange:function(){B.toggleClass(this.condNode,["noRelation"],this.noCreateSet);}},mstrmojo.hash.copy(mstrmojo.ConditionNode.prototype.markupMethods)),init:function(E){if(this._super){this._super(E);}var F=this.data&&this.data.et;if(F){this.set("noCreateSet",F===10||F===12);}},preclick:function C(E){var H=null,G=A.eventTarget(E.hWin,E.e),F=this._super(E);if(A.contains(this.createSetOptNode,G,true)&&!this.noRelationOperator&&!this.noRelation){H="createSetOpt";}else{if(A.contains(this.createSetNode,G,true)&&!this.noRelation){H="createSet";}else{if(A.contains(this.addConditionNode,G,true)){H="addCondition";}}}E.part=H||E.part;return F;},onmouseover:function(){this.toggleGroupBorder(true);},onmouseout:function(){this.toggleGroupBorder(false);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Worksheet","mstrmojo.CheckBox","mstrmojo.Image","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(13974);var H=mstrmojo.DI.DIConstants,B=mstrmojo.DI.DIHelpers,E=mstrmojo.DI.DIHelpers.isOperationMode,F=mstrmojo.css;mstrmojo.DI.DIClipboard=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIClipboard",cssClass:"mstrmojo-di-clipboard",jsonp:"parent.mstrmojo.all.{@id}.uploadCallback(@R@)",_data:null,markupString:'<div id="{@id}" class="{@cssClass}" ><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="taskProc"><div id="{@id}" ></div><div id="{@id}" ></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"table":"none";}},markupSlots:{formNode:function(){return this.domNode.children[0];},worksheet:function(){return this.domNode.children[0].children[0];},paramsNode:function(){return this.domNode.children[0].children[1];}},children:[{scriptClass:"mstrmojo.Worksheet",alias:"ws",slot:"worksheet",numOfRows:19,numOfcols:11,showRowHeaders:true,dragColumns:false,clearSheet:true,resizeColumns:false,postCreate:function(){this.attachEventListener("WorksheetContentChanged",this.id,"checkState");},checkState:function(J){mstrApp.getRootController().sourceSelected(J.data);}}],postBuildRendering:function A(){var L=mstrmojo.desc(13974,"Copy-pasting data from Internet Explorer might not align properly. We recommend using Chrome, Firefox."),K=mstrApp.getRootController().model;if(this._super){this._super();}window.setTimeout(function J(){if(B.isIE()){mstrApp.getRootController().displayWarning(L,null,mstrmojo.emptyFn,{showCancel:false});}},0);K.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},adjustSize:function I(K){var L=Math.ceil(parseInt(K.size.w,10)),J=this.ws;J.tableContainer.style.width=(L-35)+"px";J.updateScrollbars();},onBackButtonClick:function G(){var J=mstrApp.getRootController();J.showPage(H.pageType.dataSelection);this.destroy();},onHelpButtonClick:function C(){return"importing_data_from_the_clipboard.htm";},onNextButtonClick:function D(){var J=mstrApp.getRootController();if(this.tableID){J.refreshDataClipboard(this.tableID,this,H.actions.refreshData);}else{J.importClipboard(this,!J.model.hasEMMAReportInstance(),H.actions.importSource,this.id);}},onFinishButtonClick:function(){var J=mstrApp.getRootController();if(this.tableID){J.refreshDataClipboard(this.tableID,this);}else{J.importClipboard(this,!J.model.hasEMMAReportInstance(),H.actions.savePublish,this.id);}},collectData:function(){this._data=this.ws.getData();},destroy:function(J){this.collectData();this._super(J);},submit:function(P,M,K){var Q=[],N;N=this._data!==null?this._data:this.ws.getData();Q.push(N);if(mstrApp.isSingleTier){mstrApp.showProgress(K);mstrApp.getRootController().oneTierImportFile(M,mstrmojo.hash.copy(P,{datasource:N,dict:H.backendSourceSubtype.clipboard}));return ;}if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){var J=new Blob(Q);mstrApp.showProgress(K);P.fileFieldName="myFile";mstrmojo.xhr.upload("POST",mstrConfig.taskURL,M,P,J,K);}else{P.jsonp=this.jsonp.replace("{@id}",this.id);P.taskEnv="jsonp2";var L=[],O;for(O in P){L.push('<input type="hidden" name="'+O+'" value="'+mstrmojo.string.encodeHtmlString(P[O].toString())+'"/>');}L.push('<input type="hidden" name="data" value="'+N+'"/>');this.paramsNode.innerHTML=L.join("");if(M){this.onSuccess=M.success;this.onFailed=M.failure;}this.formNode.submit();}},uploadCallback:function(K){var J=(K.status===200);if(J&&this.onSuccess){this.onSuccess(K);}if(!J&&this.onFailed){this.onFailed(K);}},getFilesCnt:function(){return 1;},getFileName:function(J){return"";},getFileTableID:function(J){return null;},getOperationMode:function(){var J=this.model.operationMode;if(E(this.operationMode)){J=this.operationMode;}return J;},updatePageConfig:function(J){var K=this;if(J&&J.properties){mstrmojo.hash.forEach(J.properties,function(M,L){K.set(L,M);});}if(this.content){this.ws.setData(this.content);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Container","mstrmojo._CanRenderChildrenOnShow");var A=mstrmojo.array;mstrmojo.StackContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._CanRenderChildrenOnShow],{scriptClass:"mstrmojo.StackContainer",isStack:true,markupString:'<div id="{@id}" class="mstrmojo-StackContainer {@cssClass}" style="{@cssText}"></div>',markupMethods:{onwidthChange:function(){if(!isNaN(parseInt(this.width))){this.domNode.style.width=this.width;}},onheightChange:function(){if(!isNaN(parseInt(this.height))){this.domNode.style.height=this.height;}},onborderChange:function(){this.domNode.style.border=this.border||"";},onbackgroundChange:function(){this.domNode.style.background=this.background||"";}},markupSlots:{containerNode:function(){return this.domNode;}},_set_selected:function D(H,F){var G=this.selected;if(G===F){return false;}if(G){G.set("visible",false);}this.selected=F;if(F){F.set("visible",true);}return true;},addChildren:function B(J,G,H){var K=this.selected,L;for(var I=0,F=(J&&J.length)||0;I<F;I++){L=J[I];if(L&&L.set){L.set("visible",L===K);}}return this._super(J,G,H);},removeChildren:function C(H,F){var G=this._super(H,F);if(!H||(H===this.selected)){this.set("selected",null);}return G;},destroy:function E(F){this._super(F);this.selected=null;},renderMode:"onshow"});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label");mstrmojo.requiresDescs(1064,1825,13252,12813,12814,13142,13143,2121,14135,12741,14142,14622,14623);var T=mstrmojo.DI.DIConstants,F=mstrmojo.dom,J=mstrmojo.array,S=mstrmojo.css,O=mstrmojo.func,A=4*1024*1024,R=4*1024*1024*1024;var I={scriptClass:"mstrmojo.Container",slot:"tableNode",cssClass:"",markupString:"<div class='mstrmojo-FileDragDropBox-file {@cssClass}' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},deleteNode:function(){return this.domNode.children[0];},imageNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[2];}},name:"",isFailed:false,children:[{scriptClass:"mstrmojo.Label",alias:"fileName",slot:"contentNode",cssClass:"mstrmojo-FileDragDropBox-file-name"},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-file-delete-button",innerIconClass:"close-button"},{slot:"imageNode",alias:"fileImg",cssClass:"mstrmojo-FileDragDropBox-file-img",scriptClass:"mstrmojo.Label"}],preBuildRendering:function(){if(this._super){this._super();}this.fileName.text=this.name;},onclick:function(Z){var a=this;var X=Z.e.srcElement||Z.e.target,W=this.parent;if(X.className!=="mstrmojo-Button-text close-button"){return ;}var Y=function(){var d=-1,e;var f=W.files;if(!a.isFailed){for(e=0;e<f.length;e++){if(!mstrApp.isSingleTier){if(f[e].name===a.name){d=e;break;}}else{if(f[e]===a.file){d=e;break;}}}if(d>=0){f.splice(d,1);}if(!mstrApp.isSingleTier){W.fileNode.value="";}W.set("files",f);}else{if(--W.failedFilesCount<0){W.failedFilesCount=0;}if(!mstrApp.isSingleTier){W.fileNode.value="";}}W.removeChildren(a);};var b=this.tableID;if(b){var V={success:function(d){if(d&&d.msgid){mstrApp.getRootController().dataService.set("messageID",d.msgid);}mstrApp.getRootController().model.resetImportSource(b);Y();},failure:function(){mstrApp.getRootController().displayError(mstrmojo.desc(13142,"Delete file error."));}};var c={did:this.tableID,progressText:mstrmojo.desc(13143,"Deleting file...")};mstrApp.getRootController().removeEMMASourceTable(V,c);}else{Y();}}};var M={scriptClass:"mstrmojo.Container",slot:"tableNode",cssClass:"",markupString:"<div class='mstrmojo-url-list {@cssClass}' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},deleteNode:function(){return this.domNode.children[0];},imageNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[2];}},allowEdit:true,url:"",children:[{slot:"contentNode",alias:"text",cssClass:"urlItem-text-div",scriptClass:"mstrmojo.InlineEditBox",rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){this.parent.set("url",this.inputNode.value);this.parent.parent.raiseEvent({name:"urlChanged",src:this,url:this.url});},bindings:{text:"this.parent.url"}},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-url-delete-button",innerIconClass:"close-button"},{slot:"imageNode",alias:"fileImg",cssClass:"mstrmojo-FileDragDropBox-file-img",scriptClass:"mstrmojo.Label"}],onclick:function(Y){var b=this;var W=Y.e.srcElement||Y.e.target;if(W.className!=="mstrmojo-Button-text close-button"){return ;}var Z;var X=function(){var d=b.parent.urls;for(Z=0;Z<d.length;Z++){if(d[Z]===b.url){if(b.parent.urlTableID){delete b.parent.urlTableID[d[Z]];}d.splice(Z,1);break;}}b.parent.set("urls",d.concat());b.parent.removeChildren(b);};var a=this.tableID;if(this.tableID){var V={success:function(d){if(d&&d.msgid){mstrApp.getRootController().dataService.set("messageID",d.msgid);}mstrApp.getRootController().model.resetImportSource(a);X();},failure:function(){mstrApp.getRootController().displayError(mstrmojo.desc(13142,"Delete file error."));}};var c={did:this.tableID,progressText:mstrmojo.desc(13143,"Deleting file...")};mstrApp.getRootController().removeEMMASourceTable(V,c);}else{X();}}};function G(X){var V=mstrApp.getRootController(),W=X.size;if(W===0){V.displayError(mstrmojo.desc(13252,"The import process cannot proceed with an empty file"));return false;}if(W>R&&!mstrApp.isSingleTier){V.displayError(mstrmojo.desc(14622,"Files larger than 4GB are only supported through File from URL connector"),false,mstrmojo.desc(14623,'The "File from Disk" connector only allows users to upload files that are upto 4GB in size. For files that are larger, please place the file on a webserver or a network location and use the "File from URL" connector to access the file.'));return false;}if(W%4096===0&&!X.type){V.displayError(mstrmojo.desc(14135,"The import process cannot proceed with a folder"));return false;}return true;}function E(W){var a=this.files,Y=0,b;var X=this.parent.operationMode;var Z=mstrApp.getRootController().model;var c=this.parent.currentSource||Z.currentSource;var d=c&&c.sourceInfo.partition;if(X!==T.operationMode.create&&!Z.isAddingNewTable){this.removeChildren();a=[];this.failedFilesCount=0;}for(Y=0;Y<W.length;Y++){if(G(W[Y])){a.push(W[Y]);var V=mstrmojo.DI.DIHelpers.truncate(W[Y].name,60,true);I.name=V;b=this.addChildren(mstrmojo.insert(I));b.render();}}this.set("files",a);this.textNode.style.display="none";}mstrmojo.DI.FileDragDropBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.FileDragDropBox",action:mstrConfig.taskURL,markupString:'<div ><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="{@action}"><div class="mstrmojo-di-fileHolder {@cssClass}" mstrAttach:dragover,dragleave,drop,click><div class="mstrmojo-FileDragDropBox-text {@textcssClass}">{@text}</div><div class="mstrmojo-FileDragDropBox-content"></div><div class="mstrmojo-FileDragDropBox-count"></div></div><div class="mstrmojo-di-dragLabel">{@descriptor}<div class="or">'+mstrmojo.desc(1064,"or")+'</div></div><div class="mstrmojo-FileDragDropBox-buttonDiv"><div class="mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton hot file-button"><div class="mstrmojo-Button-text">{@browseLabel}</div></div><div><input class="mstrmojo-FileUploadBox-file" title="{@browseLabel}" type="file" accept=".xls,.xlsx,.csv,.txt,.tsv,.prn,.json" {@multiple} size="30" style="font-size:4em;" name="{@fileFieldName}" onchange="mstrmojo.all.{@id}.synFile();"/></div></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>',markupSlots:{formNode:function(){return this.domNode.firstChild;},dnDNode:function(){return this.domNode.firstChild.children[0];},textNode:function(){return this.domNode.firstChild.children[0].children[0];},tableNode:function(){return this.domNode.firstChild.children[0].children[1];},countNode:function(){return this.domNode.firstChild.children[0].children[2];},dragLabelNode:function(){return this.domNode.firstChild.children[1];},buttonNode:function(){return this.domNode.firstChild.children[2];},inputNode:function(){return this.domNode.firstChild.children[2].lastChild;},fileNode:function(){return this.domNode.firstChild.children[2].lastChild.firstChild;},paramsNode:function(){return this.domNode.firstChild.children[3];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.buttonNode.style.display=this.fileUpload?"block":"none";this.textNode.style.display=this.fileUpload?"block":"none";this.dragLabelNode.style.display=this.fileUpload?"block":"none";}},visible:true,files:[],failedFilesCount:0,urls:[],allFileNode:[],fileFieldName:"myFile",descriptor:mstrmojo.desc(13866,"Drag files here"),text:mstrmojo.desc(12691,"Data can be in crosstab or tabular format"),browseLabel:mstrmojo.desc(13865,"Choose files"),multiple:"",droppable:true,fileUpload:true,jsonp:"parent.mstrmojo.all.{@id}.uploadCallback(@R@)",adjustSize:function C(V){var W=parseInt(V.w,10);if(isNaN(W)){return ;}this.dnDNode.style.width=W-60+"px";this.dragLabelNode.style.width=W+"px";this.buttonNode.style.left=W/2-(this.buttonNode.clientWidth/2+10)+"px";},postCreate:function(){if(this._super){this._super();}this.files=[];this.urls=[];if(mstrApp.isSingleTier){this.set("text","");this.set("droppable",false);}if(F.isIE){if(F.isIE8||F.isIE9){this.set("droppable",false);this.cssClass=this.cssClass+" solid";}}},postBuildRendering:function P(){if(this._super){this._super();}F.detachEvent(this.fileNode,"mouseover",this.onmouseover);F.detachEvent(this.fileNode,"mouseout",this.onmouseout);F.attachEvent(this.fileNode,"mouseover",this.onmouseover);F.attachEvent(this.fileNode,"mouseout",this.onmouseout);F.detachEvent(this.fileNode,"mousedown",this.onmousedown);F.detachEvent(this.fileNode,"mouseup",this.onmouseup);F.attachEvent(this.fileNode,"mousedown",this.onmousedown);F.attachEvent(this.fileNode,"mouseup",this.onmouseup);},onmouseover:function H(V){var X=F.eventTarget(window,V),Y=F.findWidget(X),W=Y.buttonNode.firstChild;S.addClass(W,"hover");S.removeClass(W,"active");},onmouseout:function D(V){var X=F.eventTarget(window,V),Y=F.findWidget(X),W=Y.buttonNode.firstChild;S.removeClass(W,"hover");},onmousedown:function U(V){var X=F.eventTarget(window,V),Y=F.findWidget(X),W=Y.buttonNode.firstChild;S.addClass(W,"active");S.removeClass(W,"hover");},onmouseup:function K(V){var X=F.eventTarget(window,V),Y=F.findWidget(X),W=Y.buttonNode.firstChild;S.removeClass(W,"active");},ondragover:function L(V){if(!this.droppable){return ;}V.e.stopPropagation();V.e.preventDefault();mstrmojo.css.addClass(this.dnDNode,"dragging");mstrmojo.css.addClass(this.dragLabelNode,"dragging");},ondragleave:function B(){if(!this.droppable){return ;}this.className="";mstrmojo.css.removeClass(this.dnDNode,"dragging");mstrmojo.css.removeClass(this.dragLabelNode,"dragging");},ondrop:function Q(d){if(!this.droppable){return ;}var Z=d.e;Z.preventDefault();var V=Z.dataTransfer.files;mstrmojo.css.removeClass(this.dnDNode,"dragging");mstrmojo.css.removeClass(this.dragLabelNode,"dragging");if(V){var Y=mstrApp.getRootController().model,W=Y.operationMode;var a=this.parent.currentSource||Y.currentSource;var b=a&&a.sourceInfo.partition;if(V.length>1&&W!==T.operationMode.create&&(!b||!b.isPartition&&!Y.isAddingNewTable)){var c=this.parent.parent.headerNode;var X=mstrmojo.dom.position(c);mstrmojo.notify(mstrmojo.desc(12741,"You can upload only one file when refresh a table."),{top:X.y+X.h+"px"});}else{E.call(this,V);}}},synFile:function(){var Y=[],a;F.detachEvent(this.fileNode,"mouseover",this.onmouseover);F.detachEvent(this.fileNode,"mouseout",this.onmouseout);F.detachEvent(this.fileNode,"mousedown",this.onmousedown);F.detachEvent(this.fileNode,"mouseup",this.onmouseup);var V=this.buttonNode.removeChild(this.inputNode);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){Y=this.fileNode.files;}else{try{var Z=new ActiveXObject("Scripting.FileSystemObject");a=Z.getFile(this.fileNode.value);var W={size:a.size,name:a.name,fileNode:V};Y.push(W);}catch(X){mstrApp.getRootController().displayError(mstrmojo.desc(14142,"Please enable ActiveX and put our website to the trust list to upload the file.Please try using Chrome, Firefox if you are still having problem with Internet Explorer."));}}if(Y&&Y.length>0){E.call(this,Y);}this.inputNode=document.createElement("div");this.inputNode.innerHTML='<input class="mstrmojo-FileUploadBox-file" type="file" accept=".xls,.xlsx,.csv,.txt,.tsv,.prn,.json"'+this.multiple+' size="30" style="font-size:4em;" name='+this.fileFieldName+' onchange="mstrmojo.all.'+this.id+'.synFile();"/>';this.fileNode=this.inputNode.firstChild;this.buttonNode.appendChild(this.inputNode);F.attachEvent(this.fileNode,"mouseover",this.onmouseover);F.attachEvent(this.fileNode,"mouseout",this.onmouseout);F.attachEvent(this.fileNode,"mousedown",this.onmousedown);F.attachEvent(this.fileNode,"mouseup",this.onmouseup);},_set_urls:function(W,V){this.urls=V||[];this.toggleBorderSolid(this.files.length||this.urls.length);return true;},_set_files:function(W,V){this.files=V||[];this.toggleBorderSolid(this.files.length||this.urls.length);return true;},addURL:function(W){var X=this.urls||[];M.url=W;var V=this.addChildren(mstrmojo.insert(M));V.render();X.push(W);this.set("urls",X);},addFile:function N(V,W){var X=this.files||[];I.name=V;I.file=W;var Y=this.addChildren(mstrmojo.insert(I));Y.render();X.push(W);this.set("files",X);this.textNode.style.display="none";},submit:function(W,f,a){if(mstrApp.isSingleTier){mstrApp.showProgress(a);mstrApp.getRootController().oneTierImportFile(f,mstrmojo.hash.copy(W,{datasource:this.files[W.__index],dict:T.backendSourceSubtype.localFile}));return ;}if(a.showProgress){mstrApp.showProgress(a);}function g(j){var k=[];k.push(j.target.result);var h=new Blob(k);mstrmojo.xhr.upload("POST",mstrConfig.taskURL,f,W,h,a);}function X(){var h={code:0,message:mstrmojo.desc(12814,"Cannot read file content")};if(f.failure){f.failure(h);}if(f.complete){f.complete();}}var Y=true;if(this.onsubmit){Y=this.onsubmit();}if(Y){W=W||{};W.fileFieldName=this.fileFieldName;W.jsonp=this.jsonp.replace("{@id}",this.id);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){if(this.params){W=this.params;}if(W.__index!==undefined){(function(m){var k=m.name,o;var h=new FileReader();h.onerror=X;function n(q){W.fileName=k;W.index++;var t=[];t.push(q.target.result);var p=new Blob(t);if(W.index===W.numberOfChunks){mstrmojo.xhr.upload("POST",mstrConfig.taskURL,f,W,p,a);}else{mstrmojo.xhr.upload("POST",mstrConfig.taskURL,null,W,p,a);}if(o+A<m.size){o=o+A;h=new FileReader();t=m.slice(o,Math.min(m.size,o+A));h.onload=n;h.readAsArrayBuffer(t);}}if(m.size>A){var l=Math.ceil(m.size/A);o=0;W.index=0;W.numberOfChunks=l;W.chunkSize=A;W.fileSize=m.size;W.fileType="application/octet-stream";mstrmojo.xhr.upload("POST",mstrConfig.taskURL,null,W,null,a);var j=m.slice(o,o+A);h.onload=n;h.readAsArrayBuffer(j);}else{W.fileName=k;h.onload=g;h.readAsArrayBuffer(m);}})(this.files[W.__index]);}else{var c;for(c=0;c<this.files.length;c++){var b=this.files[c];var V=b.name;var e=new FileReader();W.fileName=V;e.onload=g;e.readAsArrayBuffer(b);}}}else{W.taskEnv="jsonp2";var d=[],Z;for(Z in W){d.push('<input type="hidden" name="'+Z+'" value="'+mstrmojo.string.encodeHtmlString(W[Z].toString())+'"/>');}if(this.params){W=this.params;for(Z in W){d.push('<input type="hidden" name="'+Z+'" value="'+mstrmojo.string.encodeHtmlString(W[Z])+'"/>');}}this.buttonNode.removeChild(this.inputNode);this.buttonNode.appendChild(this.files[W.__index].fileNode);this.inputNode=this.buttonNode.lastChild;this.paramsNode.innerHTML=d.join("");if(f){this.onSuccess=f.complete?O.composite([f.success,f.complete]):f.success;this.onFailed=f.complete?O.composite([f.failure,f.complete]):f.failure;}this.formNode.submit();}this.set("status","loading");}},uploadCallback:function(W){var V=(W.status===200);if(V&&this.onSuccess){this.onSuccess(W);}if(!V&&this.onFailed){this.onFailed(W);}},preBuildRendering:function(){if(this._super){this._super();}this.attachEventListener("urlChanged",this.id,"updateURLs");},getFilesCnt:function(){var V=0;if(this.files){V=this.files.length;}return V;},getFileName:function(V){var W="";if(V<this.files.length){if(mstrApp.isSingleTier){W=this.files[V];}else{W=this.files[V].name;}}return W;},getFileTableID:function(V){if(this.urls&&V<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[V]];}if(this.files&&V<this.files.length){return this.files[V].tableID;}return null;},updatePageConfig:function(Y){var a,W,X;var h=[];var d=Y.properties.tableID;var b=Y.properties.model.importSources[d],c,f=[],Z,g,e=this;if(Y.name&&Y.properties&&Y.properties.sourceSubtype===T.sourceSubtype.localFile){h=[];for(a=0;this.children&&a<this.children.length;a++){W=this.children[a];if(W.domNode&&W.domNode.parentNode===this.tableNode){h.push(W);}}X=h.length;for(a=0;a<X;a++){this.removeChildren(h[a]);}this.set("files",[]);Y=mstrmojo.hash.copy(Y,mstrmojo.hash.copy(I));if(this.parent.getOperationMode()!==T.operationMode.create){Y.cssClass="fake";}if(!mstrApp.isSingleTier){this.set("files",[{name:Y.properties.currentSource.fileName,tableID:Y.properties.tableID}]);}else{Y.file=Y.name;this.set("files",[Y.name]);}this.addChildren([mstrmojo.insert(Y)]);mstrmojo.css.toggleClass(this.dnDNode,"refresh",this.parent.getOperationMode()===T.operationMode.edit);mstrmojo.css.toggleClass(this.buttonNode,"refresh",this.parent.getOperationMode()===T.operationMode.edit);this.textNode.style.display="none";}if(Y.properties&&Y.properties.sourceSubtype===T.sourceSubtype.url){h=[];var V;if(b){V=b.sourceInfo.url;}for(a=0;this.children&&a<this.children.length;a++){W=this.children[a];if(W.domNode&&W.domNode.parentNode===this.tableNode){h.push(W);}}X=h.length;for(a=0;a<X;a++){this.removeChildren(h[a]);}this.set("urls",[]);c=b&&b.sourceInfo.partition;if(c&&c.isPartition){J.forEach(c.tables,function(j){f.push(j.name);});}else{if(V){f.push(V);}}if(f.length>0){this.set("visible",true);g=(this.parent.getOperationMode()!==T.operationMode.create)?"fake":"";J.forEach(f,function(j){Z=mstrmojo.hash.copy(Y,mstrmojo.hash.copy(M));Z.url=j;Z.cssClass=g;e.addChildren([mstrmojo.insert(Z)]);});this.urlTableID={};}}},setFilesObject:function(Y){var X,a,W;var Z=[],V=mstrmojo.hash.copy(I,{});for(X=0;this.children&&X<this.children.length;X++){a=this.children[X];if(a.domNode&&a.domNode.parentNode===this.tableNode){Z.push(a);}}W=Z.length;for(X=0;X<W;X++){this.removeChildren(Z[X]);}this.set("files",[]);for(X=0;Y&&X<Y.length;X++){V.name=Y[X];V.isFailed=true;this.addChildren([mstrmojo.insert(V)]);}this.failedFilesCount=Y?Y.length:0;},setURLsObject:function(X){var W,Z,V;var Y=[];for(W=0;this.children&&W<this.children.length;W++){Z=this.children[W];if(Z.domNode&&Z.domNode.parentNode===this.tableNode){Y.push(Z);}}V=Y.length;for(W=0;W<V;W++){this.removeChildren(Y[W]);}for(W=0;W<X.length;W++){M.url=X[W];this.addChildren([mstrmojo.insert(M)]);}this.set("urls",X);},onclick:function(W){var V=W.e.srcElement||W.e.target;var Y,X=0,Z;if(V.className!=="mstrmojo-Button-text close-button"){return ;}for(Y=0;this.children&&Y<this.children.length;Y++){Z=this.children[Y];if(Z.domNode&&Z.domNode.parentNode===this.tableNode){X++;}}if(X===0&&this.fileUpload){this.textNode.style.display="block";}},getURLCnt:function(){if(this.urls){return this.urls.length;}else{return 0;}},updateItemsCount:function(V){if(V>1){this.countNode.style.display="block";}else{this.countNode.style.display="none";}this.countNode.textContent=mstrmojo.desc(2121,"Total")+": "+V;},onurlsChange:function(){this.updateItemsCount(this.getURLCnt());},onfilesChange:function(){this.updateItemsCount(this.getFilesCnt());},updateURLs:function(V){var Y=V.src.children;var X=[],W;for(W=0;W<Y.length;W++){X.push(Y[W].url);}this.set("urls",X);},toggleBorderSolid:function(V){if(this.dnDNode){S.toggleClass(this.dnDNode,"solid",V);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(1825,2121,12609,14216,14662);var L=mstrmojo.DI.DIConstants;var A={scriptClass:"mstrmojo.Container",slot:"tableNode",markupString:"<div class='mstrmojo-url-list-dnd' title='{@title}' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},imageNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[2];},deleteNode:function(){return this.domNode.children[0];}},markupMethods:{onisFolderChange:function(){if(this.isFolder){mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-folder");}else{mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-file");}}},name:"",isFolder:"",children:[{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"item-delete",innerIconClass:"close-button",onclick:function(){}},{slot:"contentNode",alias:"text",cssClass:"item-content",scriptClass:"mstrmojo.Label",bindings:{text:"this.parent.text"}},{slot:"imageNode",alias:"image",cssClass:"item-image",scriptClass:"mstrmojo.Label"}],preBuildRendering:function(){if(this._super){this._super();}this.fileName.text=this.name;},onclick:function(P){var Q=this;var N=P.e.srcElement||P.e.target;if(N.className!=="mstrmojo-Button item-delete"){return ;}var O=function(){var T=-1,U;var V=Q.parent.files;var W=[];for(U=0;U<V.length;U++){if(V[U].name===Q.name){T=U;break;}}if(T>=0){V.splice(T,1);}Q.parent.set("files",V);Q.parent.removeChildren(Q);};var R=this.tableID;if(R){var M={success:function(T){if(T&&T.msgid){mstrApp.getRootController().dataService.set("messageID",T.msgid);}mstrApp.getRootController().model.resetImportSource(R);O();},failure:function(T){mstrApp.getRootController().displayError(mstrmojo.desc(14662,"Delete file error."));}};var S={did:this.tableID,progressText:"Delting file..."};mstrApp.getRootController().removeEMMASourceTable(M,S);}else{O();}}};var I={scriptClass:"mstrmojo.Container",slot:"tableNode",markupString:"<div class='mstrmojo-url-list-dnd' title='{@title}' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},imageNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[2];},deleteNode:function(){return this.domNode.children[0];}},markupMethods:{onisFolderChange:function(){if(this.isFolder){mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-folder");}else{mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-file");}}},allowEdit:true,url:"",text:"",isFolder:"",children:[{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"item-delete",innerIconClass:"close-button",onclick:function(){}},{slot:"contentNode",alias:"text",cssClass:"item-content",scriptClass:"mstrmojo.Label",bindings:{text:"this.parent.text"}},{slot:"imageNode",alias:"image",cssClass:"item-image",scriptClass:"mstrmojo.Label"}],onclick:function(P){var S=this;var N=P.e.srcElement||P.e.target;if(N.className!=="mstrmojo-Button item-delete"){return ;}var Q;var O=function(){var U=S.parent.urls;for(Q=0;Q<U.length;Q++){if(U[Q]===S.url){if(S.parent.urlTableID){delete S.parent.urlTableID[U[Q]];}U.splice(Q,1);break;}}if(U.length===0){S.parent.textNode.style.display="block";S.parent.imageNode.style.display="block";}S.parent.set("urls",U);S.parent.removeChildren(S);S.hideTooltip(P,self);};var R=this.tableID;if(this.tableID){var M={success:function(U){if(U&&U.msgid){mstrApp.getRootController().dataService.set("messageID",U.msgid);}mstrApp.getRootController().model.resetImportSource(R);O();},failure:function(U){mstrApp.getRootController().displayError(mstrmojo.desc(14662,"Delete file error."));}};var T={did:this.tableID,progressText:"Deleting file..."};mstrApp.getRootController().removeEMMASourceTable(M,T);}else{O();}}};function E(O){var N=true;var M;if(O.size%4096===0){if(O.slice(0).size===0){mstrApp.getRootController().displayError(mstrmojo.desc(12609,"Error in importing the file. Please check the file being imported"));N=false;return N;}}return N;}mstrmojo.DI.FileDragDropBoxDnD=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.FileDragDropBoxDnD",markupString:'<div class="{@cssClass}"><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="taskProc"><div class="mstrmojo-di-fileHolder drag-drop-box-dnd" mstrAttach:dragover,dragleave,drop,click,mouseenter,mouseleave><div class="mstrmojo-FileDragDropBox-count"></div><div class="di-dropbox-image"></div><div class="mstrmojo-FileDragDropBox-text">{@text}</div><div class="mstrmojo-FileDragDropBox-content"></div></div><div class="mstrmojo-FileDragDropBox-buttonDiv"><div class="mstrmojo-di-button primary-button">{@browseLabel}</div><input class="mstrmojo-FileUploadBox-file" type="file" {@multiple} size="30" style="font-size:4em;" name="{@fileFieldName}" onchange="mstrmojo.all.{@id}.synFile();"/></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>',markupSlots:{formNode:function(){return this.domNode.firstChild;},dnDNode:function(){return this.domNode.firstChild.children[0];},countNode:function(){return this.domNode.firstChild.children[0].children[0];},imageNode:function(){return this.domNode.firstChild.children[0].children[1];},textNode:function(){return this.domNode.firstChild.children[0].children[2];},tableNode:function(){return this.domNode.firstChild.children[0].children[3];},buttonNode:function(){return this.domNode.firstChild.children[1];},fileNode:function(){return this.domNode.firstChild.children[1].lastChild;},paramsNode:function(){return this.domNode.firstChild.children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.buttonNode.style.display=this.fileUpload?"block":"none";this.textNode.style.display="block";}},visible:true,files:[],urls:[],fileFieldName:"myFile",text:mstrmojo.desc(14216,"Drop files here"),browseLabel:mstrmojo.desc(1825,"Browse"),multiple:"",droppable:true,fileUpload:true,dropZone:true,allowDrop:function F(M){return true;},jsonp:"parent.mstrmojo.all.{@id}.uploadCallback(@R@)",postCreate:function(){if(this._super){this._super();}this.files=[];this.urls=[];},onmouseenter:function J(){mstrmojo.css.addClass(this.dnDNode,"hover");},onmouseleave:function B(){mstrmojo.css.removeClass(this.dnDNode,"hover");},ondragenter:function H(){mstrmojo.css.addClass(this.dnDNode,"dragging");mstrmojo.css.addClass(this.dnDNode,"hover");},ondragover:function D(){if(!this.droppable){return ;}},ondragleave:function K(){if(!this.droppable){return ;}this.className="";mstrmojo.css.removeClass(this.dnDNode,"dragging");mstrmojo.css.removeClass(this.dnDNode,"hover");},ondrop:function G(M){if(!this.droppable){return ;}var O=M.src.data,N;for(N=0;N<O.length;N++){this.addURL(O[N].data.address,O[N].text);}mstrmojo.css.removeClass(this.dnDNode,"dragging");},_set_urls:function(N,M){this.urls=M||[];return true;},addURL:function(O,R,N,M){if(mstrmojo.string.isEmpty(O)){return ;}if(mstrmojo.string.isEmpty(R)){return ;}var Q=this.urls||[];I.url=O;I.text=R;I.useRichTooltip=true;I.fullPath=M||"";var P=this.addChildren(mstrmojo.insert(I));P._ontooltipover=function(S){P.richTooltip={cssClass:"vi-regular vi-tooltip-A",refNode:P.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:22,content:P.fullPath};P.showTooltip(S,self);};P.render();P.set("isFolder",N);Q.push(O);this.set("urls",Q);this.textNode.style.display="none";this.imageNode.style.display="none";},removeURL:function(M){var O=null,N,P=this.urls;for(N=0;N<this.children.length;N++){if(this.children[N].url===M){O=this.children[N];break;}}if(O){P.splice(N,1);this.removeChildren(O);this.set("urls",P);}},addFile:function C(M,N){A.name=M;A.title=M;A.file=N;var O=this.addChildren(mstrmojo.insert(A));O.render();this.textNode.style.display="none";this.imageNode.style.display="none";},submit:function(M,T,Q){function U(W){var X=[];X.push(W.target.result);var V=new Blob(X);mstrApp.showProgress(Q);mstrmojo.xhr.upload("POST",mstrConfig.taskURL,T,M,V,Q);}function N(W){var V={code:0,message:"Cannot read file content"};if(T.failure){T.failure(V);}if(T.complete){T.complete();}}var O=true;if(this.onsubmit){O=this.onsubmit();}if(O){M=M||{};M.fileFieldName=this.fileFieldName;M.jsonp=this.jsonp.replace("{@id}",this.id);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){if(this.params){M=this.params;}if(M.__index!==undefined){(function(X){var W=X.name;var V=new FileReader();V.onload=function(a){var Z=W;M.fileName=W;var b=[];b.push(a.target.result);var Y=new Blob(b);mstrApp.showProgress();mstrmojo.xhr.upload("POST",mstrConfig.taskURL,T,M,Y,Q);};V.onerror=N;V.readAsArrayBuffer(X);})(this.files[M.__index]);}else{var R;for(R=0;R<this.files.length;R++){(function(X){var W=X.name;var V=new FileReader();V.onload=function(a){var Z=W;M.fileName=W;var b=[];b.push(a.target.result);var Y=new Blob(b);mstrApp.showProgress();mstrmojo.xhr.upload("POST",mstrConfig.taskURL,T,M,Y,Q);};V.readAsArrayBuffer(X);})(this.files[R]);}}}else{M.taskEnv="jsonp2";var S=[],P;for(P in M){S.push('<input type="hidden" name="'+P+'" value="'+mstrmojo.string.encodeHtmlString(M[P].toString())+'"/>');}if(this.params){M=this.params;for(P in M){S.push('<input type="hidden" name="'+P+'" value="'+mstrmojo.string.encodeHtmlString(M[P])+'"/>');}}this.paramsNode.innerHTML=S.join("");if(T){this.onSuccess=T.success;this.onFailed=T.failure;}this.formNode.submit();}this.set("status","loading");}},uploadCallback:function(N){var M=(N.status==200);if(M&&this.onSuccess){this.onSuccess(N);}if(!M&&this.onFailed){this.onFailed(N);}},preBuildRendering:function(){if(this._super){this._super();}},getFilesCnt:function(){if(this.files){return this.files.length;}else{return 0;}},getFileName:function(M){if(M<this.files.length){filename=this.files[M].name;return filename;}return"";},getFileTableID:function(M){if(this.urls&&M<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[M]];}if(this.files&&M<this.files.length){return this.files[M].tableID;}return null;},updatePageConfig:function(P){var Q,N,O;var S,U;var V=[];var T=P.properties.tableID;var R=P.properties.model.importSources[T];if(P.name!==undefined&&P.tableID&&P.properties&&P.properties.sourceSubtype===L.sourceSubtype.localFile){V=[];for(Q=0;this.children&&Q<this.children.length;Q++){N=this.children[Q];if(N.domNode&&N.domNode.parentNode===this.tableNode){V.push(N);}}O=V.length;for(Q=0;Q<O;Q++){this.removeChildren(V[Q]);}this.set("files",[]);P=mstrmojo.hash.copy(P,mstrmojo.hash.copy(A));S=this.addChildren([mstrmojo.insert(P)]);this.set("files",[{name:P.name,tableID:P.tableID}]);this.textNode.style.display="none";this.imageNode.style.display="none";}if(P.name!==undefined&&P.tableID&&P.properties&&P.properties.sourceSubtype===L.sourceSubtype.url){V=[];if(R){var M=R.sourceInfo.url;}for(Q=0;this.children&&Q<this.children.length;Q++){N=this.children[Q];if(N.domNode&&N.domNode.parentNode===this.tableNode){V.push(N);}}O=V.length;for(Q=0;Q<O;Q++){this.removeChildren(V[Q]);}this.set("urls",[]);this.set("visible",true);P.url=M;P=mstrmojo.hash.copy(P,mstrmojo.hash.copy(I));U=this.addChildren([mstrmojo.insert(P)]);this.set("urls",[M]);this.urlTableID={};this.urlTableID[M]=T;}},setFilesObject:function(O){var N,Q,M;var P=[];for(N=0;this.children&&N<this.children.length;N++){Q=this.children[N];if(Q.domNode&&Q.domNode.parentNode===this.tableNode){P.push(Q);}}M=P.length;for(N=0;N<M;N++){this.removeChildren(P[N]);}this.set("files",[]);for(N=0;O&&N<O.length;N++){A.name=O[N];this.addChildren([mstrmojo.insert(A)]);}},setURLsObject:function(O){var N,R,M;var P=[];for(N=0;this.children&&N<this.children.length;N++){R=this.children[N];if(R.domNode&&R.domNode.parentNode===this.tableNode){P.push(R);}}M=P.length;for(N=0;N<M;N++){this.removeChildren(P[N]);}this.set("urls",[]);if(O.length>0){this.set("visible",true);this.textNode.style.display="none";this.imageNode.style.display="none";}else{this.set("visible",false);}for(N=0;N<O.length;N++){I.url=O[N];var Q=O[N].substring(O[N].lastIndexOf("/")+1,O[N].lastIndexOf("?")===-1?O[N].length:O[N].lastIndexOf("?"));if(!mstrmojo.string.isEmpty(Q)){I.text=Q;}this.addChildren([mstrmojo.insert(I)]);}},synFile:function(){var O=[],N,Q,M=this.files;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){O=this.fileNode.files;}else{var P=new ActiveXObject("Scripting.FileSystemObject");O.push(P.getFile(this.fileNode.value));}for(N=0;N<O.length;N++){M.push(O[N]);A.name=O[N].name;Q=this.addChildren(mstrmojo.insert(A));Q.render();}this.set("files",M);this.textNode.style.display="none";this.imageNode.style.display="none";},onclick:function(N){var M=N.e.srcElement||N.e.target;var P=0,O=0,Q;if(M.className!=="mstrmojo-Button-text close-button"){return ;}for(P=0;this.children&&P<this.children.length;P++){Q=this.children[P];if(Q.domNode&&Q.domNode.parentNode===this.tableNode){O++;}}if(O===0){this.textNode.style.display="block";this.imageNode.style.display="block";}},getURLCnt:function(){if(this.urls){return this.urls.length;}else{return 0;}},updateItemsCount:function(M){if(M>1){this.countNode.style.display="block";}else{this.countNode.style.display="none";}this.countNode.textContent=mstrmojo.desc(2121,"Total")+": "+M;},onurlsChange:function(){this.updateItemsCount(this.getURLCnt());}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.Widget;mstrmojo.Box=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:A.visibleMarkupMethod,onheightChange:A.heightMarkupMethod,onwidthChange:A.widthMarkupMethod}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.hash");var K=mstrmojo.hash,Q=mstrmojo.css,S="hidden",P=mstrmojo.Widget,R="mstrmojo-wh-pn-",A="titleIconsNode";mstrmojo.warehouse.ui.BasePanel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.warehouse.ui.BasePanel",markupString:'<div id="{@id}" class="mstrmojo-wh-Panel {@cssClass}" mstrAttach:click><div class="'+R+'header"><div class="'+R+'title tp{@icntp}"><span>{@title}</span></div><div class="'+R+'ttl-icons"></div></div><div><div class="'+R+'instructions-text">{@instructionsText}</div></div></div>',markupSlots:{headerNode:function F(){return this.domNode.firstChild;},titleNode:function J(){return this.domNode.firstChild.firstChild;},titleTextNode:function L(){return this.domNode.firstChild.firstChild.firstChild;},titleIconsNode:function C(){return this.domNode.firstChild.children[1];},instructionsNode:function E(){return this.domNode.lastChild.children[0];},containerNode:function M(){return this.domNode;}},markupMethods:{onvisibleChange:P.visibleMarkupMethod,onheightChange:P.heightMarkupMethod,onwidthChange:P.widthMarkupMethod},onRender:function G(){this._super();if(this.instructionsHeight){this.oninstructionsHeightChange({value:this.instructionsHeight});}this.oninstructionsVisibleChange({value:this.instructionsVisible});},title:"",titleTooltip:"",icntp:"",postBuildRendering:function N(){this._super();if(this.editableSlot){this.setEditableTitle("");}},ontitleChange:function O(){this.titleTextNode.innerHTML=this.title;},addNewTitleButton:function B(T){this.addChildren(K.copy(T,{scriptClass:"mstrmojo.Widget",markupString:'<span id="{@id}" class="{@cssClass}" mstrAttach:click>{@text}</span>',onvisibleChange:function U(){this.domNode.style.display=this.visible?"":"none";},useRichTooltip:true,showTooltip:function V(W,X){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.domNode,top:32,content:this.title||""};this.constructor.prototype.showTooltip.call(this,W,X);},slot:A}));},setEditableTitle:function I(T){Q.toggleClass(this.titleNode,S,(T===""));Q.toggleClass(this.titleIconsNode,S,(T===""));this.set("text",T);this.set("title",T);},instructionsText:"",instructionsHeight:undefined,oninstructionsHeightChange:function H(T){var V=this.instructionsNode,U=T.value;if(V){V.style.height=U;V.style.lineHeight=U;}else{this.instructionsHeight=undefined;}},instructionsVisible:false,oninstructionsVisibleChange:function D(T){if(T.value){this.instructionsNode.style.display="block";}else{this.instructionsNode.style.display="none";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css");var A=mstrmojo.css;var I=mstrmojo.dom;function B(K){var M=document.createElement("div"),L=M.style,J=K.domNode;M.className="mstrmojo-qb-SplitPanel-avatar";L.height=J.clientHeight+"px";J.appendChild(M);K.avatar=M;return M;}mstrmojo.qb.SplitPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.SplitPanel",draggable:true,dropZone:false,marginSpan:10,minSpan:200,leftItemVisible:true,rightItemVisible:true,lp:25,markupString:'<div id="{@id}" class="mstrmojo-SplitPanel {@cssClass}" style="{@cssText}" ><table cellpadding=0 cellspacing=0><tr><td><div></div></td><td style="padding-left:{@marginSpan}px;"><div class="mstrmojo-qb-SplitPanel-resizeHandle" style="height:{@height};width:{@marginSpan}px;margin-left:-{@marginSpan}px;" ></div><div></div></td></tr></table></div>',markupSlots:{leftItem:function(){return this.domNode.firstChild.firstChild.firstChild.firstChild.firstChild;},rightItem:function(){return this.domNode.firstChild.firstChild.firstChild.children[1].children[1];}},getDragData:function H(J){var K=J.src,M=K.node;if(M.className&&M.className.indexOf("mstrmojo-qb-SplitPanel-resizeHandle")>=0){var L=I.position(this.domNode);return{node:M,x:L.x,y:L.y,w:L.w,h:L.h};}else{if(this._super){return this.dropZone&&this._super(J);}}return null;},allowDrop:function E(J){var K=J.src,L=K&&K.data;if(L&&L.node){return true;}else{return this.dropZone;}},ondragmove:function F(J){var L=J.src,N=L&&L.data;if(N&&N.node){var K=J.tgt,M=this.avatar;if(M){M.style.left=Math.min(Math.max(N.x+this.minSpan,K.pos.x),N.x+N.w-this.minSpan)+"px";}}},isDragValid:function G(J){var K=J.src,L=K&&K.data;return !!(L&&L.node);},ondragstart:function C(J){var K=J.src,M=K&&K.data;var L=this.avatar||B(this);this.ownAvatar=true;L.style.left=K.pos.x+"px";L.style.top=M.y+"px";L.style.display="block";L.style.zIndex="9999";L.style.height=M.h+"px";},ondragend:function D(J){var L=J.src,O=L&&L.data;if(O&&O.node){var N=this.avatar;if(N){N.style.display="none";var K=parseInt(N.style.left)-O.x-this.marginSpan/2,M=this.domNode.clientWidth;this.lp=K*100/M;this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};this.doLayout();}this.ownAvatar=false;}},children:[{scripClass:"mstrmojo.Box",slot:"leftItem"},{scripClass:"mstrmojo.Box",slot:"rightItem"}],layoutConfig:{w:{leftItem:"20%",rightItem:"80%"},h:{leftItem:"100%",rightItem:"100%"}},afterLayout:function(){if(this.domNode){var J=this.domNode.firstChild.firstChild.firstChild.children[1].children[0].style;if(this.leftItemVisible&&this.rightItemVisible){J.display="block";this.children[0].set("visible",true);this.children[1].set("visible",true);J.height=this.height;var L=parseInt(this.children[0].width);this.children[0].set("width",L+"px");this.rightItem.style.width=parseInt(this.width)-L-this.marginSpan+"px";this.children[1].set("width",this.rightItem.style.width);}else{J.display="none";if(this.leftItemVisible){this.children[0].set("width",this.width);this.children[1].set("visible",false);}else{this.children[1].set("width",this.width);this.children[0].set("visible",false);var K=this.rightItem.parentNode;K.style["padding-left"]="0px";}}}},_set_leftItemVisible:function(L,J){if(this.leftItemVisible!=J){this.leftItemVisible=J;if(J){this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};if(this.rightItem){var K=this.rightItem.parentNode;K.style["padding-left"]=this.marginSpan+"px";}}else{this.layoutConfig.w={leftItem:"0%",rightItem:"100%"};if(this.rightItem){var K=this.rightItem.parentNode;K.style["padding-left"]="0px";}}this.doLayout();}},_set_rightItemVisible:function(K,J){if(this.rightItemVisible!=J){this.rightItemVisible=J;if(J){this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};}else{this.layoutConfig.w={leftItem:"100%",rightItem:"0%"};}this.doLayout();}},postBuildRendering:function(){if(this._super){this._super();}this.height=this.domNode.clientHeight+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.css");var B=mstrmojo.css;mstrmojo.Panel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Panel",state:1,showTitlebar:false,markupString:'<div id="{@id}" class="mstrmojo-Panel {@cssClass}" style="position: relative;{@cssText}"><div class="mstrmojo-Panel-titlebar {@cssClass}"><img class="mstrmojo-Panel-state" src="../images/1ptrans.gif" align="absmiddle" onclick="var w = mstrmojo.all[\'{@id}\']; w.set(\'state\', w.state === 0 ? 1 : 0)" /><span class="mstrmojo-Panel-text" style="{@ttlTxtCssText}"></span><input type="button" class="mstrmojo-Panel-del" value="{@delText}" onclick="mstrmojo.all[\'{@id}\'].del()"/><div class="mstrmojo-clearMe"></div></div><div class="mstrmojo-Panel-container"></div></div>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},titlebarNode:function(){return this.domNode.firstChild;},titleNode:function(){return this.domNode.firstChild.childNodes[1];},containerNode:function(){return this.domNode.lastChild;}},markupMethods:{ontitleChange:function(){var C=this.titleNode;if(C){var D=this.title;C.innerHTML=(D!==null)?D:"";}},onstateChange:function(){var C=(this.state===0);for(var D in {stateNode:1,titleNode:1,containerNode:1}){if(this[D]){B.toggleClass(this[D],["closed"],C);}}},onshowTitlebarChange:function(){B.toggleClass(this.titlebarNode,["closed"],(this.showTitlebar===false));}},del:function A(){var C=this.parent;if(C&&C.remove){C.remove(this.item);}if(this.customDel){this.customDel();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.date");mstrmojo.requiresDescs(1823,9374,9375,12680,12681,12682,12683,12684,12685,12686,12688);var D=mstrmojo.date,B=mstrmojo.locales,E="M/d/yyyy";mstrmojo.DI.DIFacebookAdvancedEditor=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIFacebookAdvancedEditor",cssClass:"mstrmojo-DI-facebook-advancedOptionsContent",advancedProperties:{},markupString:'<div id="{@id}" class="{@cssClass}" ></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{contentNode:function(){return this.domNode;}},postBuildRendering:function A(){var K,J;if(this._super){this._super();}if(this.advancedProperties.hasOwnProperty("r")){this.rangeDropdown.dates.set("select",this.advancedProperties.r);}if(this.advancedProperties.hasOwnProperty("i")){this.rangeDropdown.dates.set("idx",this.advancedProperties.i);}if(this.advancedProperties.hasOwnProperty("n")){this.rangeDropdown.rangeBox.nValue.set("value",this.advancedProperties.n);}if(this.advancedProperties.hasOwnProperty("fD")){K=D.parseDate(this.advancedProperties.fD,false,E);if(!K){K=D.parseDate(this.advancedProperties.fD);}J=K?D.formatDateInfo(K,B.datetime.DATEOUTPUTFORMAT):this.advancedProperties.fD;this.fromBox.fromDate.set("value",J);}else{this.fromBox.fromDate.set("value",B.datetime.DATEOUTPUTFORMAT||"MM/DD/YYYY");}if(this.advancedProperties.hasOwnProperty("tD")){K=D.parseDate(this.advancedProperties.tD,false,E);if(!K){K=D.parseDate(this.advancedProperties.fD);}J=K?D.formatDateInfo(K,B.datetime.DATEOUTPUTFORMAT):this.advancedProperties.tD;this.toBox.toDate.set("value",J);}else{this.toBox.toDate.set("value",B.datetime.DATEOUTPUTFORMAT||"MM/DD/YYYY");}},children:[{slot:"contentNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-dateLabel",text:mstrmojo.desc(12681,"Optional Time Parameters")},{scriptClass:"mstrmojo.HBox",slot:"contentNode",cssClass:"mstrmojo-DI-facebook-advancedOptions",alias:"rangeDropdown",children:[{scriptClass:"mstrmojo.DropDownList",title:"",alias:"dates",cssText:"height:23px; width:130px; margin-top: 5px;",select:true,idx:2,options:[{n:mstrmojo.desc(12682,"Last N Minutes"),v:0,range:"minutes"},{n:mstrmojo.desc(12683,"Last N Hours"),v:1,range:"hours"},{n:mstrmojo.desc(12684,"Last N Days"),v:2,range:"days"},{n:mstrmojo.desc(12685,"Last N Weeks"),v:3,range:"weeks"},{n:mstrmojo.desc(12686,"Last N Months"),v:4,range:"months"},{n:mstrmojo.desc(1823,"Custom"),v:5,range:"custom"}],updateSelection:function G(J){switch(J){case 5:this.parent.parent.fromBox.fromDate.set("disabled",false);this.parent.parent.toBox.toDate.set("disabled",false);this.parent.rangeBox.set("disabled",true);this.select=false;break;default:this.parent.parent.fromBox.fromDate.set("disabled",true);this.parent.parent.toBox.toDate.set("disabled",true);this.parent.rangeBox.set("disabled",false);this.select=true;break;}},postBuildRendering:function(){if(this._super){this._super();}this.updateSelection(this.idx);},onidxChange:function(){if(this.hasRendered===false){return ;}this.updateSelection(this.idx);}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-DI-facebook-advancedOptionsInner",alias:"rangeBox",disabled:false,ondisabledChange:function I(J){mstrmojo.css.toggleClass(this.domNode,"disabled",J.value);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12688,"where N = ")},{scriptClass:"mstrmojo.TextBox",alias:"nValue",cssText:"width:20px;",value:1}]}]},{scriptClass:"mstrmojo.HBox",slot:"contentNode",cssClass:"mstrmojo-DI-facebook-advancedOptions",alias:"fromBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-dateLabel",text:mstrmojo.desc(9374,"Start Date")},{scriptClass:"mstrmojo.DI.DIDateTextBox2",cssClass:"DIDateTextBox2",alias:"fromDate",value:"MM/DD/YYYY",disabled:true,bindings:{toDate:function(){return this.parent.toDate.value;}},ondisabledChange:function I(J){this.parent.handleDisableChange(J.value);},postBuildRendering:function(){if(this._super){this._super();}this.parent.handleDisableChange(this.disabled);}}],handleDisableChange:function F(J){if(J===true){mstrmojo.css.addClass(this.domNode,"DIDateTextBox2 disabled");}else{mstrmojo.css.removeClass(this.domNode,"DIDateTextBox2 disabled");}}},{scriptClass:"mstrmojo.HBox",slot:"contentNode",cssClass:"mstrmojo-DI-facebook-advancedOptions",alias:"toBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-dateLabel",text:mstrmojo.desc(9375,"End Date")},{scriptClass:"mstrmojo.DI.DIDateTextBox2",cssClass:"DIDateTextBox2",alias:"toDate",value:"MM/DD/YYYY",disabled:true,bindings:{fromDate:function(){return this.parent.fromDate.value;}},ondisabledChange:function I(J){this.parent.handleDisableChange(J.value);},postBuildRendering:function(){if(this._super){this._super();}this.parent.handleDisableChange(this.disabled);}}],handleDisableChange:function F(J){if(J===true){mstrmojo.css.addClass(this.domNode,"DIDateTextBox2 disabled");}else{mstrmojo.css.removeClass(this.domNode,"DIDateTextBox2 disabled");}}}],setAdvancedProperties:function C(K,J,L,P,O,M){this.advancedProperties={r:K,i:J,n:L,fD:P,tD:O,d:M,dateRange:function(R,Q){return{since:R,until:Q};},getProperties:function N(){if(this.r===true){return this.dateRange(this.d,this.tD);}return this.dateRange(this.fD,this.tD);}};return true;},onOk:function H(){var L=this.rangeDropdown.dates.select,M=this.rangeDropdown.rangeBox.nValue.value,P,O,K,N,J=5;if(L===true){J=this.rangeDropdown.dates.idx;N="-"+M+" "+this.rangeDropdown.dates.options[J].range;}else{P=this.fromBox.fromDate.value;O=this.toBox.toDate.value;K=D.parseDate(P);if(K){P=D.formatDateInfo(K,E);}K=D.parseDate(O);if(K){O=D.formatDateInfo(K,E);}}return this.setAdvancedProperties(L,J,M,P,O,N);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.dom;var F=mstrmojo.DI.DIHelpers;function E(G){var H=this.columnIndex;var I=this.rowIndex;this.preview.downColumn=H;this.preview.downRow=I;this.preview.controller.isClickedInDatePreview=true;this.preview.controller.model.raiseEvent({name:"columnSelected",columnIndex:this.columnIndex,columnName:this.columnName,isCtrlKey:F.isCtrlKey(G.hWin,G.e)});}function C(N){var I=N.e.srcElement;var H=this.columnIndex;var Q=this.rowIndex;if(this.preview.downColumn===H&&this.preview.downRow===Q){var M=null,J,K,L;var P=String(this.text).length;var O=String(this.text);if(window.getSelection){M=window.getSelection();J=M.getRangeAt(0);K=J.startOffset;L=J.endOffset;if(!J.collapsed&&J.startContainer===J.endContainer){this.preview.controller.generateSuggestions(H,this.preview.columns[H].name,O,P,K,L,this.preview.columns,this);}else{this.preview.controller.resetRecords();}}else{M=document.selection;J=M.createRange();var G=J.duplicate();G.moveToElementText(I);G.setEndPoint("EndToEnd",J);K=G.text.length-J.text.length;L=K+J.text.length;this.preview.controller.generateSuggestions(H,this.preview.columns[H].name,O,P,K,L,this.preview.columns,this);}}}function B(){var K=this.parent.parent.controller;K.resetRecords();K.model.raiseEvent({name:"columnUnSelected"});var H=this.columnIndex;var P=this.column[H].cellIndex;var Q=this.rowIndex;var G=A.position(this.domNode);var L=A.position(this.preview.dataNode);var O=(G.x+G.w)-(L.x+L.w);if(O>0){this.preview.tableNode.scrollLeft=this.preview.tableNode.scrollLeft+O;G=A.position(this.domNode);L=A.position(this.preview.dataNode);}else{if(G.x-L.x<0){this.preview.tableNode.scrollLeft=this.preview.tableNode.scrollLeft-(L.x-G.x);G=A.position(this.domNode);L=A.position(this.preview.dataNode);}}var J=(G.x+G.w+72)<=(L.x+L.w);var I=(J?(G.x):(G.x-72-3))-1-1-3;var N=G.y-1-1-3;var M=this.preview;mstrmojo.insert({scriptClass:"mstrmojo.PopupEditBox",top:N+document.body.scrollTop+"px",left:I+document.body.scrollLeft+"px",width:G.w+72+2+3+"px",text:String(this.text).replace(/\n/g," "),value:String(this.text),preview:M,columnName:this.columnName,row:Q,cell:P,type:this.cssClass,floatLeft:J}).render();}function D(){if(this.preview.columnIndex>=0){if(this.preview.lastColumnIndex>=0&&this.preview.columnIndex>=this.preview.lastColumnIndex){this.preview.controller.generateColumnSuggestions(this.preview.columnIndex,this.preview.lastColumnName,this.preview.columnIndex-this.preview.lastColumnIndex+1);}else{this.preview.controller.generateColumnSuggestions(this.preview.columnIndex);}}if(this.preview.controller.isClickedInTransformation){this.preview.controller.resetRecords();this.preview.controller.isClickedInTransformation=false;}if(window.getSelection){window.getSelection().removeAllRanges();}else{document.selection.empty();}}mstrmojo.Refine.RefineDataCell=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineDataCell",markupString:'<div tabindex="-1" id="{@id}" class="refine-cell-node {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,blur,dblclick><div class="refine-cell-text-container"><div class="refine-cell-pseudo-text"></div><div class="refine-cell-text"></div></div></div>',markupSlots:{pseudoNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).replace(/\n/g," ")||"",null,true);this.textNode.title=this.text;this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).replace(/\n/g," ")||"",null,true);}},resetText:function(){if(this.pseudoNode){this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text)||"",null,true);}},highlightSelectedText:function(G,H){this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).substring(0,G),null,true)+'<span class="refine-selected-text">'+mstrmojo.string.encodeHtmlString(String(this.text).substring(G,H),null,true)+"</span>"+mstrmojo.string.encodeHtmlString(String(this.text).substring(H),null,true);},columnIndex:null,preview:null,onmousedown:E,onmouseup:C,ondblclick:B,onblur:D});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.css");var F="",B="row-",E=mstrmojo.css.DISPLAY_TABLE;mstrmojo.Table=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Table",cellCssClass:"",rows:-1,cols:-1,_trows:-1,cellPadding:0,cellSpacing:0,layout:null,markupString:'<table id="{@id}" class="mstrmojo-Table {@cssClass}" style="{@cssText}" cellpadding="{@cellPadding}" cellspacing="{@cellSpacing}">{@tableHtml}</table>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?E:"none";}},preBuildRendering:function G(){var I=[],P=this.cellCssClass;if(this.layout){var Q=this._trows=this.layout.length;for(var K=0;K<Q;K++){var H=this.layout[K],R=H.cells,O=R.length,L=[];for(var J=0;J<O;J++){var N=R[J],M="";M+=((N.cssClass||P)?' class="'+(N.cssClass||P)+'"':"");M+=(N.cssText?' style="'+N.cssText+'"':"");M+=(N.rowSpan?' rowspan="'+N.rowSpan+'"':"");M+=(N.colSpan?' colspan="'+N.colSpan+'"':"");L[J]="<td"+M+"></td>";}var S="";S+=(H.cssClass?' class="'+H.cssClass+'"':"");S+=(H.cssText?' style="'+H.cssText+'"':"");I[K]="<tr"+S+">"+L.join("")+"</tr>";}}else{this._trows=this.rows;var M=(P?' class="'+P+'"':""),L=[];for(var K=0;K<this.rows;K++){for(var J=0;J<this.cols;J++){L[J]="<td"+M+"></td>";}I[K]="<tr>"+L.join("")+"</tr>";}}this.tableHtml=I.join("");if(this._super){this._super();}},postBuildRendering:function C(){if(this._trows){var M={},I=this.containerNode.rows,N=I.length;for(var L=0;L<N;L++){var K=I[L].cells,H=K.length;M[B+L]=I[L];for(var J=0;J<H;J++){M[F+L+","+J]=K[J];}}this.addSlots(M);}this._super();},childRenderCheck:function D(I){if(I&&!I.hasRendered){var H=I.slot||this.defaultChildSlot;return !!this[H]||H.match(/^([\d]+),([\d]+)$/);}return false;},on_child_change_rendering:function A(L){var H=(L&&L.src)||L,O=H&&H.domNode;if(O){var U=H.slot;if(!this[U]){var M=U&&U.match(/^([\d]+),([\d]+)$/);if(M){var R=parseInt(M[1],10),V=parseInt(M[2],10),Q=this.containerNode,T=this[(B+R)],N=[];if(!T){var J=Q.rows,S=J&&J.length||0;for(var K=S;K<=R;K++){N[B+K]=Q.insertRow();}T=N[B+R];}var P=T.cells&&T.cells.length||0;for(var K=P;K<=V;K++){var I=T.insertCell(K);N[F+R+","+K]=I;if(this.cellCssClass){I.className=this.cellCssClass;}}this.addSlots(N);}}}this._super(L);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.css","mstrmojo.dom");var Y=mstrmojo.css,F=mstrmojo.dom;var Z={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};function A(){var c=this.value,b=this.inputNode,d=b.value,a=(c!==null&&c!==undefined)?String(c):"";if(a!==d&&(!this.keepEmpty||d!==this.emptyText)){b.value=a;}if(b.mstrmojoEmpty){Y.removeClass(b,[this.emptyClass]);b.mstrmojoEmpty=null;}}function X(){var a=this.inputNode;a.value=this.emptyText||"";Y.addClass(a,[this.emptyClass]);a.mstrmojoEmpty=true;}function N(){var a=this.inputNode;if(a){this.readingDom=true;this.set("value",a.value);this.readingDom=false;}}function U(a){var b=this;if(a===-1){N.call(this);}else{if(this._lastTimeoutId){window.clearTimeout(this._lastTimeoutId);}this._lastTimeoutId=window.setTimeout(function(){delete b._lastTimeoutId;N.call(b);},a||100);}}mstrmojo.TextBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.TextBox",value:"",type:"text",hint:"",readOnly:false,size:"",maxLength:"",cssDisplay:"inline",tabIndex:"",emptyText:"",keepEmpty:false,emptyClass:"mstrmojo-empty",valueChangeDelay:-1,textValid:true,autoComplete:true,autoCorrect:true,autoCapitalize:true,markupString:'<input id="{@id}" class="mstrmojo-TextBox {@cssClass}"  style="{@cssText}" title="{@tooltip}" type="{@type}" value="" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}"min="{@min}" max="{@max}" placeholder="{@hint}" mstrAttach:focus,keyup,blur,paste,cut,input,click,keydown  tstid="{@tstid}"/>',markupSlots:{inputNode:function D(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,oncssClassChange:function S(){this.inputNode.className="mstrmojo-TextBox "+(this.cssClass||"");},onhintChange:function O(){this.inputNode.setAttribute("placeholder",this.hint);},onenabledChange:function E(){var a=this.inputNode;a.disabled=!this.enabled;Y.toggleClass(a,"disabled",!this.enabled);},onvalueChange:function P(){var a=this.value,b=(a===undefined)||(a===null)||(a==="");if(b){if(!this.hasFocus){X.call(this);}else{this.inputNode.value="";}}else{A.call(this);}if(F.isIE9){this.inputNode.type=b?"text":this.type;}},ontooltipChange:function R(){this.domNode.title=this.tooltip;},onreadOnlyChange:function H(){this.inputNode.readOnly=this.readOnly;},ontextValidChange:function B(){Y.toggleClass(this.inputNode,["err"],!this.textValid);}},postBuildRendering:function V(){this._super();var a=this.inputNode;a.setAttribute("autocomplete",this.autoComplete?"on":"off");a.setAttribute("autocorrect",this.autoCorrect?"on":"off");a.setAttribute("autocapitalize",this.autoCapitalize?"on":"off");},focus:function Q(){if(this.inputNode&&this.inputNode.offsetParent){try{this.inputNode.focus();}catch(a){}}},prefocus:function M(){this.hasFocus=true;A.call(this);},blur:function T(){this.inputNode.blur();},preblur:function W(){window.setTimeout(function(){},200);this.hasFocus=false;N.call(this);var a=this.value;if(((a===null||a==="")&&this.emptyText)||(this.keepEmpty&&a===this.emptyText)){X.call(this);}},prekeyup:function I(b){var a=b.hWin,c=b.e||a.event;U.call(this,this.valueChangeDelay);var d=Z[c.keyCode];if(this["on"+d]){this["on"+d](b);}},preinput:function J(){U.call(this,this.valueChangeDelay);},prepaste:function K(){U.call(this);},precut:function G(){U.call(this);},setInvalidState:function C(a){this.set("textValid",true);if(a){this.domNode.setAttribute("title",a);}},cleanUp:function L(){this.inputNode.value="";this.set("textValid",false);this.domNode.setAttribute("title",this.tooltip);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.Refine.DateTimeUtil","mstrmojo.Refine.RefineHelpers","mstrmojo.string");mstrmojo.requiresDescs(221,12366,2164,13188,14517);var A=mstrmojo.dom;var E=mstrmojo.Refine.DateTimeUtil;function C(F){return !isNaN(parseFloat(F))&&isFinite(F);}mstrmojo.PopupEditBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.PopupEditBox",text:"",value:"",top:0,left:0,markupString:'<div id="{@id}" class="refine-cell-editor {@cssClass}" style="top: {@top}; left: {@left};" mstrAttach:click,keydown><div class="refine-menu-overlay"></div><div class="refine-menu-container" style="width: {@width};"><div class="refine-cell-editor-text"></div><div class="refine-cell-editor-actions"><div class="refine-cell-editor-action"></div><div class="refine-cell-editor-action"></div><div class="refine-cell-editor-action"></div></div></div></div>',markupSlots:{overlayNode:function(){return this.domNode.firstChild;},autoNode:function(){return this.domNode.lastChild.childNodes[0];},buttonNode:function(){return this.domNode.lastChild.lastChild;},applyToAllNode:function(){return this.domNode.lastChild.lastChild.childNodes[2];},applyNode:function(){return this.domNode.lastChild.lastChild.childNodes[1];},cancelNode:function(){return this.domNode.lastChild.lastChild.childNodes[0];}},children:[{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-apply-to-all",title:mstrmojo.desc(12366,"Apply To All")+" (Enter)",slot:"applyToAllNode",onclick:function(){this.parent.applyToAll();this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var F=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(F.y+30,0),left:Math.max(F.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}},{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-apply",title:mstrmojo.desc(2164,"Apply")+" (Ctrl + Enter)",slot:"applyNode",alias:"applyButton",bindings:{visible:function(){return(!this.parent.fromFacet)&&(!mstrApp.getRootController().refineApp.isBDE);}},onclick:function(){this.parent.apply();this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var F=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(F.y+30,0),left:Math.max(F.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}},{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-cancel",title:mstrmojo.desc(221,"Cancel"),alias:"cancel",slot:"cancelNode",onclick:function(){this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var F=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(F.y+30,0),left:Math.max(F.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}}],applyToAll:function(){var J=this.autoNode.childNodes[0].childNodes[2].value;if(String(this.text)!==J){var L=this.preview.controller;var K=L.model;var H=this.columnName;var F=[],I,N;var G="yyyy-MM-ddTHH:mm:ssZ";var M=this.type;I=JSON.parse(JSON.stringify(K.transformations.EditCell.applyToAll));I.description=I.description.replace("[column name]",H);I.columnName=H;I.edits[0].to=J;if(this.type==="number"){if(!C(J)){mstrmojo.alert(mstrmojo.desc(13188,"Not a valid Number. Convert data type of column to Text"));return ;}N=parseFloat(J);I.edits[0].to=N;}else{if(this.type==="date"||this.type==="time"||this.type==="datetime"){N=Date.parse(J);if(!N){mstrmojo.alert(mstrmojo.desc(14517,"Not a valid Date"));return ;}I.edits[0].to=J;M="date";}}if(this.text===""||(this.text==="(blank)"&&this.blankChoice)){I.edits[0].fromBlank=true;I.edits[0].from[0]="";}else{I.edits[0].from[0]=this.value||this.text;}I.edits[0].type=M;if(!this.fromFacet){I.engineConfig=JSON.parse(K.engine);}F.push(I);this.preview.controller.applyOperations({operations:JSON.stringify(F),engine:JSON.stringify({facets:[],mode:"row-based"})});}},apply:function(){var L=this.autoNode.childNodes[0].childNodes[2].value;if(this.text.toString()!==L){var G=this.preview.controller;var J=G.model;var I=[],H,K;var F="yyyy-MM-ddTHH:mm:ssZ";H=JSON.parse(JSON.stringify(J.transformations.EditCell.singleEdit));H.description=H.description.replace("####",this.row);H.description=H.description.replace("####",this.cell);H.row=this.row;H.col=this.cell;K=L;if(this.type==="number"){if(!C(L)){mstrmojo.alert(mstrmojo.desc(13188,"Not a valid Number. Convert data type of column to Text"));return ;}K=parseFloat(L);}else{if(this.type==="date"||this.type==="time"||this.type==="datetime"){K=Date.parse(L);if(!K){mstrmojo.alert(mstrmojo.desc(14517,"Not a valid Date."));return ;}K=L;}}H.to=K;H.description=H.description.replace("####",K);I.push(H);this.preview.controller.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});}},onclick:function(F){var H=F.e,G=A.eventTarget(F.hWin,H);if(G===this.overlayNode){this.destroy();}},prekeydown:function(G){var J=G.e,H=J.keyCode||J.charCode,F=this.preview.controller,I=F.model;if(J.ctrlKey&&H===mstrmojo.Enum_Keys.ENTER){if(!this.fromFacet&&!I.hasAddSample()){this.apply();this.destroy();}}else{if(H===mstrmojo.Enum_Keys.ENTER){this.applyToAll();this.destroy();}else{if(H===mstrmojo.Enum_Keys.ESCAPE){this.destroy();}}}},preBuildRendering:function B(){var F=this.preview.controller,G=F.model;this.placeholder=document.body.appendChild(document.createElement("div"));if(G.hasAddSample()){this.applyButton.set("visible",false);}return this._super();},postBuildRendering:function D(){this._super();this.autoNode.style.width=(parseInt(this.width)-(this.fromFacet?43:88))+"px";if(this.floatLeft){this.autoNode.style["float"]="left";this.autoNode.style.marginRight="3px";this.buttonNode.style["float"]="left";}else{this.autoNode.style["float"]="right";this.autoNode.style.marginLeft="3px";this.buttonNode.style["float"]="right";}var H=this;var L=mstrmojo.Refine.RefineHelpers.completely(this.autoNode,{bottom:(this.fromFacet?14:16),top:(this.fromFacet?15:17),left:(this.fromFacet?0:10),fontSize:"8pt",fontFamily:"monospace",width:(parseInt(this.width)-(this.fromFacet?43:77))});setTimeout(function(){L.input.focus();L.setText(H.text);L.input.select();L.repaint();},0);var G={facets:[{type:"list",name:this.columnName,columnName:this.columnName,expression:"value",omitBlank:false,omitError:false,selection:[],selectBlank:false,selectError:false,invert:false}],mode:"row-based"};var F=[];var K={success:function(N){var O=N.facets[0].choices,M;if(O){for(M=0;M<O.length;M++){F.push(O[M].v.l);}}F.sort(function(Q,P){return Q.localeCompare(P);});L.options=F;setTimeout(function(){L.repaint();},0);}};var J={engine:JSON.stringify(G)};var I={project:this.preview.controller.model.projectID};this.preview.controller.dataService.computeFacetsQuiet(K,I,J);return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.dom","mstrmojo.hash");var V=mstrmojo.hash,X=mstrmojo.dom,F="h",S="w",G="100%",L="none",U={HORIZONTAL:0,VERTICAL:1},D=U.HORIZONTAL,B="horizontal",H="vertical",J={firstSplitNode:"300px",resizeHandleNode:"5px",secondSplitNode:G};function Q(){var b=this.config,Z=this.orientation,d=(Z===D)?S:F,Y=(Z===D)?F:S,a="Node",e=this.layoutConfig||{};e.xt=true;e[d]=e[d]||V.copy(J);e[Y]=e[Y]||{firstSplitNode:G,resizeHandleNode:G,secondSplitNode:G};var c=e[d];V.forEach(b,function(g,f){c[f+a]=g.v;});return e;}function I(j){var b=this._wPos,Z=(this.orientation===D)?"x":"y",m=j[Z]-b[Z],d=this.config,l=d.firstSplit,o=d.secondSplit,k=parseInt(l.min,10),a=parseInt(o.min,10),f=(l.v.indexOf("px")>-1),c=parseInt((this.orientation===D)?this.width:this.height,10);if(!f){if(m===c){m=c*(parseInt(l.v,10)/100);}}var g=c-a,Y=Math.floor(Math.min(Math.max(m,k),g));if(this.applyPercentage){var n=Math.round((Y/c)*100),h=(c-parseInt(d.resizeHandle.v,10)-Y),e=Math.round((h/c)*100);if((n+e)<100){e+=(100-(n+e));}l.v=n+"%";o.v=e+"%";}else{l.v=Y+"px";o.v="100%";}this.layoutConfig=Q.call(this,d);this.doLayout();}mstrmojo.ui.Splitter=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.ui.Splitter",markupString:'<div id="{@id}" class="mstrmojo-Splitter {@orientationCss} {@cssClass}"><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-SplitterHandle"></div><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-clearingDiv"></div></div>',markupSlots:{firstSplitNode:function C(){return this.domNode.firstChild;},resizeHandleNode:function A(){return this.domNode.children[1];},secondSplitNode:function K(){return this.domNode.children[2];}},orientation:D,orientationCss:"",applyPercentage:false,onRender:function O(){if(this.applyPercentage){var Z=(this.orientation===D)?"x":"y",Y={};this._wPos={};Y[Z]=parseInt((this.orientation===D)?this.width:this.height,10);this._wPos[Z]=0;I.call(this,Y);}},config:{firstSplit:{v:"50%",min:"100px",max:undefined},secondSplit:{v:"50%",min:"100px",max:undefined},resizeHandle:{v:"5px"}},init:function W(Y){this._super(Y);var Z=(this.orientation===D);this.orientationCss=Z?B:H;this.restrictedToAxis=Z?"x":"y";this.config=V.clone(this.config);this.layoutConfig=Q.call(this);},toggleFirstItemVisibility:function N(Y){if(Y){this.layoutConfig=Q.call(this);}else{this.layoutConfig[(this.orientation===D)?S:F]={firstSplitNode:"0px",resizeHandleNode:"0px",secondSplitNode:G};}this.doLayout();},toggleSecondItemVisibility:function P(Y){if(Y){this.layoutConfig=Q.call(this);}else{this.layoutConfig[(this.orientation===D)?S:F]={firstSplitNode:G,resizeHandleNode:"0px",secondSplitNode:"0px"};}this.doLayout();},draggable:true,dropZone:false,avatarCssClass:"mstrmojo-Splitter-av",delayResizing:false,createAvatar:function T(){var c=document.createElement("div"),b=(this.orientation===D),Z=this._wPos=X.position(this.domNode),a="2px",Y=c.style;Y.top=(b?Z.y:0)+"px";Y.left=(b?0:Z.x)+"px";Y.height=b?this.height:a;Y.width=b?a:this.width;Y.display=this.delayResizing?"block":L;return c;},isDragValid:function E(Y){return Y.src.node===this.resizeHandleNode||this._super(Y);},ondragmove:function R(Y){if(!this.delayResizing){I.call(this,Y.tgt.pos);}if(this._super){this._super(Y);}},ondragend:function M(Y){if(this.delayResizing){I.call(this,Y.tgt.pos);}delete this._wPos;if(this._super){this._super(Y);}}});mstrmojo.ui.Splitter.ENUM_OR=U;}());(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.css;mstrmojo.Refine.RefineTagBox=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Refine.RefineTagBox",markupString:'<div id="{@id}" class="refine-tag-box-container {@cssClass}" style="{@cssText}"><div class="refine-tag-box"></div></div>',markupSlots:{boxNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function C(){var G={scriptClass:"mstrmojo.Refine.RefineTagBoxNew",slot:"boxNode"};this.inputBox=this.addChildren(G);return this._super();},setupScrollNodes:function D(){this.scrollNode=this.boxNode;},onaddChild:function B(){if(this.children.length>1){this.inputBox.input.emptyText="";A.toggleClass(this.inputBox.input.domNode,"short",true);}},onremoveChild:function(G){var I=G.value;for(var H=0;H<I.length;H++){I[H].destroy();}this.updateScrollbars();if(this.children.length===1){this.inputBox.input.emptyText=mstrmojo.desc(14518,"Press Enter Key to input multiple keywords");A.toggleClass(this.inputBox.input.domNode,"short",false);}},removeTags:function E(){for(var G=this.children.length-2;G>=0;G--){this.removeChildren(this.children[G]);}}});mstrmojo.Refine.RefineTagBoxNew=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineTagBoxNew",markupString:'<div id="{@id}" class="refine-tag-box-new {@cssClass}" style="{@cssText}" mstrAttach:keydown></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}},children:[{scriptClass:"mstrmojo.TextBox",alias:"input",slot:"domNode",cssClass:"refine-tag-box-new-input",tooltip:mstrmojo.desc(14518,"Press Enter Key to input multiple keywords"),emptyText:mstrmojo.desc(14518,"Press Enter Key to input multiple keywords")}],onkeydown:function F(K){var G=13;var I=8;var H={scriptClass:"mstrmojo.Refine.RefineTagBoxLabel",slot:"boxNode"};if(K.e.keyCode===G){if(this.input.value){H.text=this.input.value;this.input.set("value","");this.parent.addChildren([H],this.parent.children.length-1);this.parent.updateScrollbars();}}else{if(K.e.keyCode===I&&this.input.value===""){var J=this.parent.children.length;if(J>1){var L=this.parent.children[J-2];this.parent.removeChildren(L);}}}}});mstrmojo.Refine.RefineTagBoxLabel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineTagBoxLabel",markupString:'<div id="{@id}" class="refine-tag-box-label {@cssClass}" style="{@cssText}"><span class="refine-tag-box-label-text">{@text}</span><a class="refine-tag-box-close"><span class="refine-tag-box-icon" mstrAttach:click></span></div>',text:"",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}},markupSlots:{textNode:function(){return this.domNode.children[0];}},onclick:function(){this.parent.removeChildren(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom");var M=mstrmojo.Widget,G=mstrmojo.dom,N=mstrmojo.global.document,C=50,B=500;mstrmojo.Stepper=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Stepper",orientation:"vertical",provider:null,title:"",markupString:'<div id="{@id}" class="mstrmojo-Stepper {@orientation} {@cssClass}" mstrAttach:click,mousedown,selectstart><div class="title">{@title}</div><div class="next">+</div><div class="text">{@itemHtml}</div><div class="prev">-</div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},nextNode:function(){return this.domNode.children[1];},textNode:function(){return this.domNode.children[2];},prevNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:M.visibleMarkupMethod,onheightChange:M.heightMarkupMethod,onwidthChange:M.widthMarkupMethod,onenabledChange:function I(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);}},preBuildRendering:function J(){this.itemHtml=this.provider.renderItemAt();this._super();},processEvent:function A(O){if(G.contains(this.textNode,O)||O===this.titleNode){return ;}var Q=this.provider,P=((O===this.nextNode)?"Next":"Prev");if(Q["has"+P]()){Q[P.toLowerCase()]();this.updateDisplayText();}},updateDisplayText:function E(){this.textNode.innerHTML=this.provider.renderItemAt();},startStepperInterval:function F(O,P){var Q=this;this._holdTimer=setInterval(function(){Q[P](O);},C);},stopStepperInterval:function H(){if(this._holdTimer){clearInterval(this._holdTimer);delete this._holdTimer;}},onclick:function L(O){this.processEvent(O.e.target);},onmousedown:function D(O){if(!this._holdTimer&&!this._startHoldTimer){var P=this;this._startHoldTimer=setTimeout(function(){delete P._startHoldTimer;P.startStepperInterval(O,"onclick");},B);G.attachOneTimeEvent(N,"mouseup",function(){if(P._startHoldTimer){clearTimeout(P._startHoldTimer);delete P._startHoldTimer;}P.stopStepperInterval();},true);}},onselectstart:function K(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Container");var D="slot";mstrmojo.HBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.HBox",cellCssClass:"",cellSpacing:0,cellPadding:0,markupString:'<table id="{@id}" class="mstrmojo-HBox {@cssClass}" style="{@cssText}" cellspacing="{@cellSpacing}" cellpadding="{@cellPadding}">{@colHTML}<tr>{@tableHtml}</tr></table>',colHTML:"",markupSlots:{containerNode:function(){return this.domNode.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildRendering:function B(){this.tableHtml="";var N=[],F=this.children,K=(F&&F.length)||0,I;if(K){var G=0,J=this.cellCssClass?' class="mstrmojo-HBox-cell '+this.cellCssClass+'" ':"",M="<td "+J+"></td>";for(I=0;I<K;I++){N[G++]=M;F[I].slot=D+I;}this.tableHtml=N.join("");}this._super();if(K){var L={},H=this.containerNode.cells;for(I=0;I<K;I++){L["slot"+I]=H[I];}this.addSlots(L);}},addChildren:function E(K,F,G){if(!K){return K;}if(F===undefined||isNaN(F)||F<0){var J=this.children;F=(J&&J.length)||0;}var I=0,H;if(K.constructor===Array){for(I=0,H=K.length;I<H;I++){K[I].slot=D+(F+I);}}else{K.slot=D+F;}return this._super(K,F,G);},childRenderCheck:function C(G){if(G&&!G.hasRendered){var F=G.slot||this.defaultChildSlot;return !!this[F]||F.match(/^slot[\d]+$/);}return false;},onchildRenderingChange:function A(I){var F=(I&&I.src)||I,L=F&&F.domNode;if(L){var Q=F.slot;if(!this[Q]){var J=Q&&Q.match(/^slot([\d]+)$/);if(J){var O=parseInt(J[1],10),N=this.containerNode,P=N.cells,M=(P&&P.length)||0,K={};for(var H=M;H<=O;H++){var G=N.insertCell(H);K["slot"+H]=G;if(this.cellCssClass){G.className=this.cellCssClass;}}this.addSlots(K);}}}this._super(I);}});})();(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var D=function(){var F=this.opener;if(F.direction.toLowerCase()==="up"){this.domNode.style.top=-F.domNode.offsetHeight+"px";}};mstrmojo.DropDownButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DropDownButton",height:"19px",text:"",direction:"down",enabled:true,title:"",markupString:'<div id="{@id}" class="mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}" mstrAttach:mousedown><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode">{@text}</div></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:{boxNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onheightChange:function(){this.boxNode.style.height=this.height||"";},ontextChange:function(){this.iconNode.innerHTML=this.text;},ontitleChange:function(){this.boxNode.title=this.title;},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function B(){if(this._super){this._super();}var F=this.popupRef;if(F){if(F.nudge){F.nudge=mstrmojo.func.composite([F.nudge,D]);}else{if(this.direction.toLowerCase()!=="down"){F.nudge=D;}}}},popupRef:null,popupOpenConfig:null,destroy:function C(F){var G=this.popupRef;if(G&&G.hasRendered){G.destroy(false);}if(this._super){this._super(F);}},togglePopup:function E(){var F=this._lastOpened;if(F&&F.visible){this.closePopup();}else{this.openPopup("popupRef",this.popupOpenConfig);}},premousedown:function A(F){this.togglePopup();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.Checkbox","mstrmojo.dom");mstrmojo.requiresDescs(13189,2968,1095,11841,221,3474,14230,14231,14232,14233,14234,14235,11656,14236,14237,14238,14239,14240,14241,14242,14243);var A=mstrmojo.dom;mstrmojo.Refine.RefineClusteringDialog=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.Refine.RefineClusteringDialog",method:"binning",algorithm:"fingerprint",facets:[],columnName:"",markupString:'<div id="{@id}" class="refine-clustering-dialog mojo-theme-light"><div class="refine-clustering-dialog-header"></div><div class="refine-clustering-dialog-body"><div class="refine-clustering-dialog-info"><div class="refine-clustering-dialog-algorithm"></div><div class="refine-clustering-dialog-count"></div></div><div class="refine-clustering-dialog-table"></div></div><div class="refine-clustering-dialog-footer"><div class="refine-clustering-dialog-cancel"></div><div class="refine-clustering-dialog-merge"></div><div class="refine-clustering-dialog-mergeandredo"></div><div class="refine-clustering-dialog-selectall"></div><div class="refine-clustering-dialog-unselectall"></div></div><div class="refine-clustering-dialog-overlay"></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.firstChild;},algorithmNode:function(){return this.domNode.children[1].children[0].children[0];},countNode:function(){return this.domNode.children[1].children[0].children[1];},tableNode:function(){return this.domNode.children[1].children[1];},cancelNode:function(){return this.domNode.children[2].children[0];},mergeNode:function(){return this.domNode.children[2].children[1];},mergeandredoNode:function(){return this.domNode.children[2].children[2];},selectAllNode:function(){return this.domNode.children[2].children[3];},unselectAllNode:function(){return this.domNode.children[2].children[4];}},markupMethods:{onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;}},getMovingHandle:function D(){return this.headerNode;},getMovingTarget:function E(){return this.editorNode;},preBuildRendering:function B(){this.placeholder=document.body.appendChild(document.createElement("div"));return this._super();},postBuildRendering:function C(){this.cluster();return this._super();},cluster:function(){var F={engine:this.controller.model.engine,clusterer:JSON.stringify({type:this.method,"function":this.algorithm,column:this.columnName,params:{}})};this.controller.computeClusters(F);this.clustering.set("visible",true);this.noCluster.set("visible",false);this.clusterTable.set("visible",false);},handleClustersFetched:function(F){this.updateData(F.clusters);this.countNode.innerHTML=mstrmojo.desc(14234,"#### cluster(s) found").replace("####",this.clusters.length);},updateData:function(I){var N=[];var J,H;for(J=0;J<I.length;J++){var L=I[J];var O={edit:false,choices:L,value:L[0].v,size:L.length};var K=0;var P=0;var M=0;for(H=0;H<O.choices.length;H++){var G=O.choices[H];M+=G.c;var F=G.v.length;K+=F;P+=F*F;}O.rowCount=M;O.avg=K/O.choices.length;O.variance=Math.sqrt(P/O.choices.length-O.avg*O.avg);N.push(O);}this.clusters=N;this.updateAll();},updateAll:function(){this.renderTable(this.clusters);},renderTable:function(F){this.clustering.set("visible",false);if(F.length>0){this.clusterTable.populateData(F);this.clusterTable.set("visible",true);}else{this.noCluster.set("visible",true);}},apply:function(L){var K=this.clusters;var H=[],J,I;for(J=0;J<K.length;J++){var F=K[J];if(F.edit){var G=[];for(I=0;I<F.choices.length;I++){G.push(F.choices[I].v);}H.push({from:G,to:F.value});}}if(H.length>0){this.controller.MergeCluster({columnName:this.columnName,expression:"value",description:mstrmojo.desc(14279,"Edit Cell")+" ["+this.columnName+"] (#### "+mstrmojo.desc(2968,"Rows")+")",edits:JSON.stringify(H)},L);}else{mstrmojo.alert(mstrmojo.desc(13189,"You must check some checkboxes for your merges to be applied."));}},children:[{scriptClass:"mstrmojo.Box",slot:"headerNode",alias:"header",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-refine-title",alias:"title",bindings:{text:function(){return mstrmojo.desc(14230,'Cluster & Edit column "####"').replace("####",this.parent.parent.columnName);}}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-close",onclick:function(){this.parent.parent.cancel.onclick();}}]},{scriptClass:"mstrmojo.HBox",slot:"algorithmNode",alias:"algorithmBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14231,"Algorithm")+": "},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"algorithm",items:[{n:mstrmojo.desc(14232,"Fingerprint"),algo:"fingerprint"},{n:mstrmojo.desc(14233,"Phonetic"),algo:"metaphone3"}],selectedIndex:0,onitemSelected:function(F){if(this.parent.parent.algorithm!==F.algo){this.parent.parent.algorithm=F.algo;this.parent.parent.cluster();}}}]},{scriptClass:"mstrmojo.Table",slot:"tableNode",cellCssClass:"refine-clustering-cell",alias:"clusterTable",populateData:function(P){this.removeChildren();this.unrender();this.rows=P.length+1;this.cols=5;var J=0,I;var K=[mstrmojo.desc(1095,"Merge")+"?",mstrmojo.desc(14235,"Cluster Size"),mstrmojo.desc(11656,"Row Count"),mstrmojo.desc(14236,"Values in Cluster"),mstrmojo.desc(14237,"New Cell Value")];var G={scriptClass:"mstrmojo.Label",cssClass:"refine-label"};for(I=0;I<this.cols;I++){G.slot=J+","+I;G.text=K[I];this.addChildren(G);}var O={scriptClass:"mstrmojo.ui.Checkbox",oncheckedChange:function(){this.cluster.edit=this.checked;}};var Q={scriptClass:"mstrmojo.TextBox",onvalueChange:function(){this.cluster.value=this.value;}};var F={scriptClass:"mstrmojo.Container",markupString:"<ul></ul>",markupSlots:{containerNode:function(){return this.domNode;}}};var L={scriptClass:"mstrmojo.Container",markupString:'<li><a title="'+mstrmojo.desc(14238,"Use this value")+'" mstrAttach:click>{@Text}</a><span class="refine-clustering-cell-rows">({@Count} '+mstrmojo.desc(2968,"Rows")+")</span></li>",markupSlots:{textNode:function(){return this.domNode.children[0];}},onclick:function(){var T=this.parent.row*5;var S=this.parent.row*5+4;this.parent.parent.children[T].set("checked",true);this.parent.parent.children[S].set("value",this.textNode.innerHTML);}};for(J=1;J<this.rows;J++){var R=P[J-1];O.slot=J+",0";O.cluster=R;this.addChildren(O);G.slot=J+",1";G.text=R.choices.length;this.addChildren(G);G.slot=J+",2";G.text=R.rowCount;this.addChildren(G);F.slot=J+",3";F.row=J;var M=new mstrmojo.Container(F);var N;for(N=0;N<R.choices.length;N++){var H=R.choices[N];L.slot="containerNode";L.Text=H.v;L.Count=H.c;M.addChildren(L);}this.addChildren(M);Q.slot=J+",4";Q.value=R.value;Q.cluster=R;this.addChildren(Q);}this.render();this.updateCellClass();},updateCellClass:function(){var G;var H=this.domNode.firstChild.children;var I=H[0];var F=I.children;for(G=0;G<5;G++){F[G].className="refine-clustering-header";}}},{scriptClass:"mstrmojo.Widget",alias:"noCluster",slot:"tableNode",markupString:'<div style="padding: 10px;"><div style="font-size: 130%; color: #333;">'+mstrmojo.desc(14239,"No clusters were found with the selected method")+'</div><div style="padding-top: 1em; font-size: 110%; color: #888;">'+mstrmojo.desc(14240,"Try selecting another method above or changing its parameters")+"</div></div>",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}}},{scriptClass:"mstrmojo.Widget",slot:"tableNode",alias:"clustering",markupString:'<div style="padding: 10px; font-size: 130%; color: #888;">'+mstrmojo.desc(11841,"Clustering")+'... <img src="../javascript/mojo/css/images/Refine/small-spinner.gif"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",slot:"cancelNode",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"merge",slot:"mergeNode",text:mstrmojo.desc(14241,"Merge and Close"),onclick:function(){var F=this.parent;var G=function(){F.destroy();};this.parent.apply(G);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"mergeandredo",slot:"mergeandredoNode",text:mstrmojo.desc(14242,"Merge and Recluster"),onclick:function(){var F=this.parent;var G=function(){F.cluster();};this.parent.apply(G);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"selectAll",slot:"selectAllNode",text:mstrmojo.desc(3474,"Select All"),onclick:function(){var H=this.parent.clusterTable;var G=H.children.length;var F;for(F=5;F<G;F+=5){H.children[F].set("checked",true);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"unselectAll",slot:"unselectAllNode",text:mstrmojo.desc(14243,"Unselect All"),onclick:function(){var H=this.parent.clusterTable;var G=H.children.length;var F;for(F=5;F<G;F+=5){H.children[F].set("checked",false);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var B=mstrmojo.func,C=mstrmojo.dom,F="mstrmojo-popup-widget-hosted";mstrmojo.ui.PopupButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ui.PopupButton",onPopupWidgetClosed:mstrmojo.emptyFn,onPopupWidgetOpened:mstrmojo.emptyFn,anchorSlot:"domNode",isHostedWithin:true,hostedCSSClass:"",destroy:function H(L){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);}this._super(L);},getPopupWidget:mstrmojo.emptyFn,postCreateChildren:function D(){var L=this.getPopupWidget();if(!L||L._pbCfg){return ;}var M=function M(O,N){return function(){O.apply(N,arguments);};};L.onOpen=B.composite([M(this.onPopupWidgetOpened,this),L.onOpen||mstrmojo.emptyFn]);L.onClose=B.composite([M(this.onPopupWidgetClosed,this),L.onClose||mstrmojo.emptyFn]);L._pbCfg=true;},onclick:function K(L){var N=L.getTarget();if(N===this[this.anchorSlot]||N.parentNode===this[this.anchorSlot]){var M=this.getPopupWidget();if(!M.visible){this.openPopup(M);}else{this.closePopup();}}},onPopupAutoClosed:function I(M,L){if(C.contains(this[this.anchorSlot],C.eventTarget(L,M),true)){return false;}},getPopupHostNode:function J(){return this.containerNode;},getPopupConfig:function G(){var M=[F],L=this.hostedCSSClass;if(L){M.push(L);}return new mstrmojo.ui.PopupConfig({hostId:this.id,hostElement:this.getPopupHostNode(),anchorElement:this[this.anchorSlot],isHostedWithin:this.isHostedWithin,hostProxyCssClass:M.join(" ")});},unrender:function E(L){if(this._listenerProc){C.detachEvent(window,"resize",this._listenerProc);delete this._listenerProc;}this._super(L);},postBuildRendering:function A(){var P=this.getPopupWidget();if(P){var R=this.getPopupConfig();if(!R.isHostedWithin){var N=this.parent||this.opener,M=R.hostProxyCssClass.split(" ");M.push(this.domNode.className);while(N){var Q=N.themeClassName;if(Q){M.push(Q);break;}N=N.parent||N.opener;}R.hostProxyCssClass=M.join(" ");}P.popupConfig=P.addDisposable(R);}var L=P.id,O=this._listenerProc=function(){var S=mstrmojo.all[L];if(S&&S.visible&&S.adjustCornersForPopupOverflow){S.adjustCornersForPopupOverflow();}};if(this.isHostedWithin===false){C.attachEvent(window,"resize",O);}return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.Refine.FileSaver");mstrmojo.requiresDescs(14184,2177,2400,3474,14243);var D=mstrmojo.dom;mstrmojo.Refine.RefineExtractDialog=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.Refine.RefineExtractDialog",markupString:'<div id="{@id}" class="refine-extract-dialog"><div class="refine-extract-dialog-header">'+mstrmojo.desc(14184,"Extract History Script")+'</div><div class="refine-extract-dialog-body"><div class="refine-extract-dialog-left"><div class="refine-extract-dialog-entries"></div></div><div class="refine-extract-dialog-input"></div></div><div class="refine-extract-dialog-footer"><div class="refine-extract-dialog-close"></div><div class="refine-extract-dialog-save"></div><div class="refine-clustering-dialog-selectall"></div><div class="refine-clustering-dialog-unselectall"></div></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.firstChild;},entriesNode:function(){return this.domNode.children[1].children[0].children[0];},inputNode:function(){return this.domNode.children[1].children[1];},closeNode:function(){return this.domNode.children[2].children[0];},saveNode:function(){return this.domNode.children[2].children[1];},selectAllNode:function(){return this.domNode.children[2].children[2];},unselectAllNode:function(){return this.domNode.children[2].children[3];}},markupMethods:{onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;}},getMovingHandle:function E(){return this.headerNode;},getMovingTarget:function F(){return this.editorNode;},preBuildRendering:function B(){this.placeholder=document.body.appendChild(document.createElement("div"));return this._super();},postBuildRendering:function C(){this.operations=this.controller.model.getCurrentOperations();this.entriesTable.populateData(this.operations);this.updateJson(this.operations);return this._super();},updateJson:function A(I){var G=[];for(var H=0;H<I.entries.length;H++){var J=I.entries[H];if("operation" in J&&J.selected){G.push(J.operation);}}this.textArea.set("value",JSON.stringify(G,null,2));},children:[{scriptClass:"mstrmojo.Table",slot:"entriesNode",alias:"entriesTable",populateData:function(H){if(!H.entries.length){return ;}this.removeChildren();this.unrender();this.rows=H.entries.length;this.cols=2;var I;var G={scriptClass:"mstrmojo.CheckBox",oncheckedChange:function(){this.entry.selected=this.checked;this.parent.parent.updateJson(H);}};var K={scriptClass:"mstrmojo.Label"};for(I=0;I<this.rows;I++){var J=H.entries[I];G.slot=I+",0";G.entry=J;G.checked=J.selected;this.addChildren(G);K.slot=I+",1";K.text=J.description;this.addChildren(K);}this.render();this.updateCellClass();},updateCellClass:function(){var H=this.domNode.firstChild.children;var I=H[0];var G=I.children;G[0].className="refine-extract-checkbox";G[1].className="refine-extract-text";}},{scriptClass:"mstrmojo.TextArea",slot:"inputNode",alias:"textArea",maxLength:undefined},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"close",slot:"closeNode",text:mstrmojo.desc(2177,"Close"),onclick:function(){this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"save",slot:"saveNode",text:mstrmojo.desc(2400,"Save"),bindings:{visible:function(){return mstrApp.isSingleTier||!mstrmojo.dom.isSafari;}},onclick:function(){if(mstrApp.isSingleTier){window.FormWrapper.saveDWHistoryList(this.parent.textArea.value);}else{mstrmojo.Refine.FileSaver.saveTextAs(this.parent.textArea.value,"Data Wrangling Script.txt");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"selectAll",slot:"selectAllNode",visible:false,text:mstrmojo.desc(3474,"Select All"),onclick:function(){var G=this.parent.operations;for(var H=0;H<G.entries.length;H++){var I=G.entries[H];I.selected=true;}this.parent.entriesTable.populateData(G);this.parent.updateJson(G);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"unselectAll",slot:"unselectAllNode",visible:false,text:mstrmojo.desc(14243,"Unselect All"),onclick:function(){var G=this.parent.operations;for(var H=0;H<G.entries.length;H++){var I=G.entries[H];I.selected=false;}this.parent.entriesTable.populateData(G);this.parent.updateJson(G);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresDescs(10,2391,8338,8513,12882,13006,13819,14308,14309,14504,14505);var O=mstrmojo.DI.DIConstants,F=mstrmojo.desc,I=mstrmojo.css,H=mstrmojo.dom,L=5000;mstrmojo.DI.DISearchBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DISearchBox",cssClass:"mstrmojo-DI-SearchBox",searchLabel:F(10,"Search"),headerLabelVisible:false,footerLabelVisible:true,headerLabelText:F(13006,"Search for Data"),placeHolderText:F(13006,"Search for Data"),previewTableId:"",showOperators:true,showAdvancedOptions:false,showFetchOptions:false,noDataErrorString:F(12882,"No data was returned, please try another search string."),hideSignout:false,hint:"",iconCssClass:"",signOutTooltipText:"",tipLabel:mstrmojo.desc(14504,"Tip: use")+" ",operatorLabel:mstrmojo.desc(14505,"operators"),markupString:'<div class = "{@cssClass}" mstrAttach:click,keyup><div class = "signOut cf"></div><div class = "block center"><label class = "headerLabel" style="visible:{@headerLabelVisible};">{@headerLabelText}</label><div class="input"><input class="inputSearch" type="text" value = "" placeholder="{@placeHolderText}"/><div id={@id} class="mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton"><div class="mstrmojo-Button-text ">{@searchLabel}</div></div></div><div class="footerDiv"><label class ="helpOperatorsLabel" style="visible:{@footerLabelVisible}">{@tipLabel}<a class = "helpOperatorsLabelLink"><span id="operators">{@operatorLabel} </span></a></label><label class ="helpOperatorsLabel" style="visible:{@footerLabelVisible};"><a class = "helpOperatorsLabelLink"><span id="advanced">'+F(2391,"Advanced search")+'</span></a></label></div><div  class="mstrmojo-di-source-fetch"><input type="text" value="100"/>'+F(14308,"## rows of latest tweets.").replace("##","")+'<span class="comment">('+F(14309,"Please do not type more than ##").replace("##",L)+')</span></div><div id={@id} class ="helpOperators" mstrAttach:click ></div><div id={@id} class ="noDataReturned">{@noDataErrorString}</div></div></div>',markupSlots:{signoutNode:function(){return this.domNode.children[0];},blockNode:function(){return this.domNode.children[1];},headerLabelNode:function(){return this.domNode.children[1].childNodes[0];},searchFieldNode:function(){return this.domNode.children[1].childNodes[1].firstChild;},searchButton:function(){return this.domNode.children[1].childNodes[1].lastChild;},footerNode:function(){return this.domNode.children[1].childNodes[2];},fetchNode:function(){return this.domNode.children[1].childNodes[3];},operatorsHelpNode:function(){return this.domNode.children[1].childNodes[4];},noDataReturnedNode:function(){return this.domNode.childNodes[1].lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.footerNode.firstChild.style.display=this.showOperators?"inline-block":"none";this.footerNode.children[1].style.display=this.showAdvancedOptions?"inline-block":"none";this.fetchNode.style.display=this.showFetchOptions?"block":"none";this.headerLabelNode.style.display=this.headerLabelVisible?"block":"none";}},handleNoDataReturned:function P(){this.noDataReturnedNode.style.visibility="visible";},init:function M(R){var S,Q;this._super(R);S={};Q=S[this.id]={};Q[O.dataEvents.NO_DATA_RETURNED_EVENT]=this.handleNoDataReturned;mstrApp.getRootController().attachDataChangeListeners(S);},formatUserEmail:function N(Q){if(Q!==""){Q="("+Q+")";}return Q;},getUserEmail:function J(){var Q=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].userEmail;return this.formatUserEmail(Q);},getUserName:function C(){var Q=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].userDisplayName;return F(8513,"User:")+Q+" ";},getProfilePic:function D(){var Q=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].picurl;return Q||"";},populate:function G(){this.emailAddress.set("text",this.getUserEmail());this.username.set("text",this.getUserName());this.noDataReturnedNode.style.visibility="hidden";},children:[{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-signout",alias:"signoutLink",text:F(8338,"sign out"),onclick:function(){mstrApp.getRootController().oAuthSignOut(this.parent.parent.sourceObjectsInfo.type);},postBuildRendering:function B(){var R=this,S=this.parent.signOutTooltipText;var Q;if(this._super){Q=this._super();}if(S){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:50,content:S});if(!this._ontooltipover){this._ontooltipover=function(T){R.showTooltip(T,self);};this._ontooltipout=function(T){R.hideTooltip(T,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);}return Q;}},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"signoutLinkSeparator",text:" | "},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"emailAddress",bindings:{text:function(){return this.parent.getUserEmail();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"username",bindings:{text:function(){return this.parent.getUserName();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Image",cssClass:"profileIcon",bindings:{visible:function(){return !!this.parent.getProfilePic();},src:function(){return this.parent.getProfilePic();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Image",cssClass:"sourceIcon",bindings:{src:function(){var Q="../javascript/mojo/css/images/DI/facebook-logo-small.png";if(this.parent.parent.iconCssClass==="twitterIcon"){Q="../javascript/mojo/css/images/DI/twitter-logo-small.png";}return Q;}}}],handleHelpOperatorsItemClick:function E(Q,S){var R=Q.currentTarget.value;S.searchFieldNode.value=R;S.searchFieldNode.select();},operatorsHelp:{toggleVisibility:function(Q){if(Q.style.visibility==="visible"){Q.style.visibility="hidden";}else{Q.style.visibility="visible";}}},onclick:function(Q){var R=Q.e.target||Q.e.srcElement;if(H.contains(this.searchButton,R,true)){this.parent.onSearchClick(this.getSearchQuery());}if(R.id==="advanced"){this.parent.onadvancedSearchClick();}else{if(R.id==="operators"){mstrApp.getRootController().showDialog(O.dialogType.twitterAdvOptDialog);}}},onkeyup:function(Q){this.parent.handleSearchChange(Q);},postBuildRendering:function(){var R=this,Q=this.fetchNode.children[0];if(this._super){this._super();}this.parent.refreshSearch();if(this.signoutLink){this.signoutLink.domNode.style.display=this.hideSignout?"none":"block";this.signoutLinkSeparator.domNode.style.display=this.hideSignout?"none":"block";}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:Q,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:F(13819,"Invalid input")});if(!this.validateFetchNum){this.validateFetchNum=function(T){var S=R.getFetchValue();if(!S.valid){I.addClass(Q,"warning");R.showTooltip(T,window);window.clearTimeout(R._warningTimeOut);R._warningTimeOut=window.setTimeout(function(){R.hideTooltip(T,window);},6000);}else{window.clearTimeout(R._warningTimeOut);R.hideTooltip(T,window);I.removeClass(Q,"warning");}};}H.attachEvent(Q,"blur",this.validateFetchNum);},getFetchValue:function(){var R=parseInt(this.fetchNode.children[0].value,10),Q={valid:true,value:R};if(isNaN(R)||R>L||R<=0){Q.valid=false;Q.value=100;}return Q;},getSearchQuery:function A(){return this.searchFieldNode.value;},updateLayout:function K(){I.addClass(this.blockNode,"top");I.addClass(this.signoutNode,"top");I.removeClass(this.blockNode,"center");}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Container");mstrmojo.VBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.VBox",markupString:'<table id="{@id}" class="mstrmojo-VBox {@cssClass}" style="{@cssText}" cellspacing="0" cellpadding="0"><tr><td></td></tr></table>',markupSlots:{containerNode:function(){return this.domNode.rows[0].cells[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Button");mstrmojo.HTMLButton=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.HTMLButton",markupString:'<input id="{@id}" type="button" class="mstrmojo-text mstrmojo-HTMLButton mstrButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:click />',markupSlots:{inputNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline":"none";},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onselectedChange:function(){mstrmojo.css[this.selected?"addClass":"removeClass"](this.domNode,["selected"]);},ontextChange:function(){this.inputNode.value=this.text!=null?this.text:"";},oniconClassChange:function(){this.domNode.className="mstrmojo-text mstrmojo-HTMLButton mstrButton "+this.cssClass+" "+this.iconClass+(this.enabled?"":" disabled");}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapperHoriz","mstrmojo.ListBuilder");mstrmojo.ListHoriz=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.ListHoriz",renderOnScroll:true,listMapper:mstrmojo.ListMapperHoriz,listBuilder:mstrmojo.ListBuilder,itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2");function B(E){var I=E.ctxtBuilder;if(I){var H=I.itemWidgets,G;for(G=H.length-1;G>-1;G--){var F=H[G];if(F){F.destroy(true);}}}}mstrmojo.WidgetListBase=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.WidgetListBase",unrender:function C(G){var I=this.ctxtBuilder;if(I){var H=I.itemWidgets,F;for(F=H.length-1;F>-1;F--){var E=H[F];if(E&&E.hasRendered){E.unrender(true);}}}this._super(G);},refresh:function A(E){B(this);if(this._super){this._super(E);}},destroy:function D(E){B(this);this._super(E);}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapper","mstrmojo.ListBuilder","mstrmojo.ListSelector");mstrmojo.List=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.List",renderOnScroll:true,listMapper:mstrmojo.ListMapper,listBuilder:mstrmojo.ListBuilder,listSelector:mstrmojo.ListSelector,itemIdField:"dssid",itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.RadioButton");var C=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton=mstrmojo.declare(mstrmojo.RadioButton,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton",cssClass:"mstrmojo-wh-DBRoleRadioButton",enableChildren:function A(){var G=this.parent,F=this;C.forEach(G.children,function(H){if(H.parentRBAlias&&(H.parentRBAlias===F.alias)){H.set("enabled",F.checked);}});},enabled:true,getValue:function B(){return this.checked;},setValue:function E(F){this.checked=F;this.onclick();},isValid:function D(){return{val:true,msg:""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.string");mstrmojo.DivItemRenderer={render:function(E,C,F){var D=mstrmojo.string.encodeHtmlString((F.getItemName?F.getItemName(E,C):(F.itemDisplayField&&E[F.itemDisplayField])));return'<div mstridx="'+C+'" class="'+F.itemCssClass+(F.selectedIndices[C]?" "+F.itemSelectedCssClass:"")+(E.cssClass?" "+E.cssClass:"")+'" style="'+F.itemCssText+'">'+D+"</div>";},select:function(D,E,C,F){D.className+=" selected";},unselect:function(D,E,C,F){D.className=D.className.replace(/selected/g,"");},rowHeight:21};mstrmojo._RendersItemDivs={tableCssClass:"mstrmojo-ListBox-table",tableCssText:"",rowCssClass:"",rowCssText:"",cellCssClass:"mstrmojo-ListBox-cell",cellCssText:"",itemCssClass:"mstrmojo-ListBox-item",itemSelectedCssClass:"selected",itemDisplayField:"n",itemRenderer:mstrmojo.DivItemRenderer,rangeSelected:false,_findMatch:function(C,D){return mstrmojo.dom.findAncestorByAttr(mstrmojo.dom.eventTarget(C,D),"mstridx",true,this.itemsNode);},premousedown:function A(C){if(mstrmojo.dom.shiftKey(C.hWin,C.e)){mstrmojo.dom.preventDefault(C.hWin,C.e);}},preclick:function B(L){var H=L.hWin,I=L.e,G=this._findMatch(H,I);if(G){var E=G.node,K=parseInt(G.value,10),J=mstrmojo.dom,C=J.ctrlKey(H,I),D=J.shiftKey(H,I);if(C||D){J.clearBrowserHighlights(H);}if(this.multiSelect&&(this.selectionPolicy==="toggle"||C)){var F=this.rangeSelected||this.selectedIndex===-1;this.toggleSelect(K);if(F&&K<this.items.length&&this.selectedIndices[K+1]){K++;}this.selectedIndex=K;this.rangeSelected=false;}else{if(this.multiSelect&&D){this.rangeSelected=true;this.rangeSelect(K);}else{this.singleSelect(K);this.rangeSelected=false;}}}}};mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._RendersItemDivs");mstrmojo.ListBoxBase=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._RendersItemDivs],{scriptClass:"mstrmojo.ListBoxBase",cssClass:"mstrmojo-ListBox",itemCssClass:"mstrmojo-ListBox-item",_markupPrefix:function(){var C=this.itemRenderer;return(C&&C.markupPrefix)||('<table class="'+this.tableCssClass+'" style="'+this.tableCssText+'" cellspacing="0" cellpadding="0"><tbody>');},_markupSuffix:function(){var C=this.itemRenderer;return(C&&C.markupSuffix)||"</tbody></table>";},_itemPrefix:function(){var C=this.itemRenderer;return(C&&C.itemPrefix)||('<tr class="'+this.rowCssClass+'" style="'+this.rowCssText+'"><td class="'+this.cellCssClass+'" style="'+this.cellCssText+'">');},_itemSuffix:function(){var C=this.itemRenderer;return(C&&C.itemSuffix)||"</td></tr>";},_getItemNode:function(C){var E=this.itemsNode,D=E&&E.rows,F=D&&D[C];return F&&F.cells[0].firstChild;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");var D=mstrmojo.dom,F=mstrmojo.array,E=mstrmojo.hash;var A;mstrmojo.SuggestionList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.SuggestionList",itemField:"n",getItemMarkup:function(H,G){if(!A){var I=this.itemField;A=this._super(H).replace(">{@en@n}<",' title="{@en@'+I+'}">{@en@'+I+"}<");}return A;},getItemProps:function C(I,G){var H=this._super(I,G),J=this.itemField;H[J]=I[J];return H;},onclick:function B(G){if(this.disableClick){return false;}var L=this,I=this.parent,K=I.opener,H=D.isMetaKey(G.hWin,G.e);if(H&&!this.multiSelect){this.multiSelect=K.parent.defn.multi;if(this.multiSelect){D.attachOneTimeEvent(document.documentElement,"keyup",function(){var N=L.selectedIndices;if(K){K.suggestionShown=false;if(N&&!E.isEmpty(N)){var M=[];E.forEach(L.selectedIndices,function(P,O){M.push(L.items[O]);});K.handleSuggestionItemSelect(M);}I.close();}L.multiSelect=false;});}}this._super(G);if(!this.multiSelect){K.suggestionShown=false;var J=this.selectedItem;if(J){K.handleSuggestionItemSelect(J);}I.close();}},bindings:{itemField:"this.parent.opener.itemField",items:"this.parent.opener.suggestionItems",disableClick:"this.parent.opener.disableClick"}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo._IsList","mstrmojo.ListBase");var D=mstrmojo.dom,G=mstrmojo.array,C=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.es.TableList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.es.TableList",cssClass:"mstrmojo-qb-emma-tablelist",itemMaxWidth:"",onitemMaxWidthChange:function F(I){var H=this.itemsContainerNode,J=H&&H.children,K=I.value;G.forEach(J,function(L){L.children[1].style.maxWidth=K;});},init:function E(K){this._super(K);var M=this,L={},J=L[this.id]={};J.refreshTables=function I(N){M.set("items",N.items);};J[C.DBROLES_DELETE]=function H(N){mstrApp.getRootController().removeDBRoleTables(N.item.did);};mstrApp.getRootController().attachDataChangeListeners(L);},getItemMarkup:function(I,H){return'<div class="item cf {@cls}" idx="{@idx}" style="{@style}"><div class="item-ic"></div><div class="item-n" title="{@title}" style="max-width: {@maxWidth}">{@n}</div><div class="item-del"></div></div>';},getItemProps:function B(I,H){return{cls:"tp"+I.tp,n:I.n,idx:H,title:[I.n," [",I.dbrn,"]"].join(""),maxWidth:this.itemMaxWidth};},onclick:function A(I){try{var L=I.target||D.eventTarget(I.hWin,I.e),K=D.findAncestorByAttr(L,"idx",true,this.domNode),H=K&&parseInt(K.value,10);if(H!==null&&!isNaN(H)){if(L.className==="item-del"){mstrApp.getRootController().removeTable(H);}}}catch(J){mstrApp.onerror(J);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.dom","mstrmojo.qb.EnumDragActions");var E=mstrmojo.dom,A=mstrmojo.qb.EnumDragActions.JOIN_COLUMN,G="item-add",B="item-mn";mstrmojo.qb.DBTableRows=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.DBTableRows",getItemMarkup:function(L,K){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-ic"></span><span class="item-n">{@n}</span><span class='+G+"></span><span class="+B+"></span></div>";},getItemProps:function H(L,K){return{sel:!!this.selectedIndices[K],cls:"st"+(L.state||"")+(K%2?" odd":" even"),n:L.n,idx:K};},getRowNode:function D(M,L){var K=mstrmojo.array.find(this.items,M,L);if(K>-1){return this.itemsContainerNode.children[K];}},getRowItem:function I(K){return this.items[K];},onclick:function J(L){try{var P=L.target||E.eventTarget(L.hWin,L.e),O=E.findAncestorByAttr(P,"idx",true,this.domNode),K=O&&parseInt(O.value,10),N=P.className;if((N===B||N===G)&&K!==null&&!isNaN(K)){var Q=this.itemsContainerNode.children[K];if(N===B){this.raiseEvent({name:"tableViewMenuSelect",data:this.items[K],menuNode:Q.children[2]});}else{mstrApp.getRootController().addSelectedColumns([this.items[K]]);}}}catch(M){throw M;}},dropZone:true,allowDrop:function C(K){return(K.action===A);},ondrop:function F(L){var K=mstrApp.getRootController(),O=L.src;if(O&&O.data){var N=O.data;if(L.action===A){var M=E.findAncestorByAttr(L.tgt.node,"idx",true,this.domNode);if(M){K.addJoinInfo(N,mstrmojo.hash.copy(this.getRowItem(M.value),{tableName:this.parent.tableData.did,tableId:this.parent.tableData.id}));}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.css");var B=mstrmojo.css;var A;var D;mstrmojo.ui.ButtonBar=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.ButtonBar",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onenabledChange:function G(){B.toggleClass(this.domNode,"disabled",!this.enabled);}},cssDisplay:"table",icnCssText:"display:table-row;",items:null,showIcon:true,init:function F(I){this._super(I);var H=["mstrmojo-ui-ButtonBar"];if(!this.showIcon){H.push("btn-text");}B.addWidgetCssClass(this,H);},getItemMarkup:function E(H){if(!D){D=this._super(H);}if(!A){A=D.replace(">{@en@n}<",'title="{@en@n}"><div>&nbsp;</div><');}return this.showIcon?A:D;},getItemProps:function C(J,H){var I=this._super(J,H);var K=J.css;if(K){I.addCls(K);}I.n=J.n||"";return I;}});mstrmojo.ui.ButtonBar.ItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");mstrmojo.ui.List=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.List",postselectionChange:function C(D){var G=D.added||[],F=G.length,I=D.removed||[],E=I.length;if(E){this.selectionRemoved({added:G,removed:I,isReselect:false});}if(F){var H=function(J){return[].concat(J).sort().join(",");};this.selectionAdded({added:G,removed:I,isReselect:H(G)===H(I)});}},selectionAdded:function A(D){},selectionRemoved:function B(D){}});mstrmojo.ui.List.SelectionChangeEvtType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo._IsList","mstrmojo.ListBase");mstrmojo.requiresDescs(505,629);var C=mstrmojo.dom;mstrmojo.qb.mdx.CubeList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.mdx.CubeList",cssClass:"mstrmojo-qb-emma-tablelist",init:function D(G){this._super(G);var I=this,H={},F=H[this.id]={};F.refreshTables=function E(J){I.set("items",J.items);};mstrApp.getRootController().attachDataChangeListeners(H);},getItemMarkup:function(F,E){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><div class="item-ic"></div><div class="item-n" title="{@n}"> {@n} </div><div class="item-refresh {@isNew}" title="'+mstrmojo.desc(505,"Update")+'"></div><div class="item-del {@isNew}" title="'+mstrmojo.desc(629,"Delete")+'"></div></div>';},getItemProps:function B(F,E){return{cls:"tp"+F.tp,n:F.n,isNew:F.isNew?"new":"exist",idx:E};},onclick:function A(F){try{var I=F.target||C.eventTarget(F.hWin,F.e),H=C.findAncestorByAttr(I,"idx",true,this.domNode),E=H&&parseInt(H.value,10);if(E!==null&&!isNaN(E)){if(I.className.indexOf("item-del")>-1){mstrApp.getRootController().removeCube(E);}else{if(I.className.indexOf("item-refresh")>-1){mstrApp.getRootController().updateCube(E);}}}}catch(G){mstrApp.onerror(G);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.css","mstrmojo.hash");mstrmojo.TristateCheckBox=mstrmojo.declare(mstrmojo.Label,null,{scriptClass:"mstrmojo.TristateCheckBox",grayed:true,checked:true,cssClass:"tristate",onclick:function(){if(this.grayed){this.set("grayed",!this.grayed);}else{this.set("checked",!this.checked);}},markupMethods:mstrmojo.hash.copy({oncheckedChange:function(){mstrmojo.css.toggleClass(this.domNode,"checked",this.checked);},ongrayedChange:function(){mstrmojo.css.toggleClass(this.domNode,"grayed",this.grayed);},onenabledChange:function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);}},mstrmojo.hash.copy(mstrmojo.Label.prototype.markupMethods))});})();(function(){mstrmojo.requiresCls("mstrmojo.Label");mstrmojo.DI.DILabel=mstrmojo.declare(mstrmojo.Label,null,{scriptClass:"mstrmojo.DI.DILabel",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click,mouseover,mouseout></div>'});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo._HasEditableText","mstrmojo.css");var B=mstrmojo.css;mstrmojo.EditableLabel=mstrmojo.declare(mstrmojo.Label,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.EditableLabel",autoApplyDelay:-1,markupString:'<div id="{@id}" class="mstrmojo-EditableLabel {@cssClass}" title="{@title}" contenteditable="{@isEditing}" style="{@cssText}" mstrAttach:click,mousedown,blur,keydown,keyup></div>',onkeyup:function C(D){this._super(D);if(this._autoApplyTimer){window.clearTimeout(this._autoApplyTimer);}if(this.autoApplyDelay!==-1){var E=this;this._autoApplyTimer=window.setTimeout(function(){E.set("isEditing",false);},this.autoApplyDelay);}},selectable:true});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.EditableLabel,{onselectableChange:function A(){var E=this[this.editableSlot],D=!!this.selectable;E.selectable=D;E.setAttribute("unselectable",!D?"on":"off");B.toggleClass(E,"unselectable",!D);}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.Obj","mstrmojo.date","mstrmojo.hash","mstrmojo.array","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.obj.DBObjects","mstrmojo.warehouse.obj.DBRole");mstrmojo.requiresDescs(12934,5160,11426,11427,11429,11430,11436,11437,11432,11434,12935,12936,11442,12942,10068,12943,12944,12945,12946);var R=mstrmojo,M=R.func.wrapMethods,p=R.date,U=R.hash,e=R.array,O=R.string,F=R.architect.menu.EnumMenuActions,P=mstrmojo.warehouse.EnumDataChangeEvents,V=P.DBTABLES_CHANGED,T=P.DBTABLES_REQUESTED,t=3000,AF=mstrmojo.warehouse.EnumDatabaseType.SAPHana,a=mstrmojo.warehouse.EnumNamespaceMode.ALL,f=mstrmojo.warehouse.EnumNamespaceMode.CURRENT,z=R.warehouse.EnumObjectTypes,AJ=z.ATTRIBUTE,G=z.FACT,AA=z.TABLE,AG=z.COLUMN,l=z.FORM,g=z.LAYER,I=z.DIMENSION,q=z.PROJECT,o=z.TRANSFORMATION,j=z.DBROLE;var AH={DssCatalogDefault:0,DssCatalogGetTables:1,DssCatalogGetColumns:2,DssCatalogGetTablePrimaryKeys:4,DssCatalogGetTableForeignKeys:8,DssCatalogGetTableKeys:12,DssCatalogGetTableSize:16,DssCatalogGetTableContent:32,DssCatalogGetColumnCardinality:64,DssCatalogGetColumnContent:128,DssCatalogGetFullCatalog:255,DssCatalogSelectedOnly:256,DssCatalogApplyConnectionMapping:512,DssCatalogAllNamespaces:1024,DssCatalogGetFresh:4096,DssCatalogIgnoreNamespace:8192,DssCatalogIgnoreCase:16384,DssCatalogIgnoreInvalidNames:32768,DssCatalogReuseMatching:65536,DssCatalogReuseCompatible:131072,DssCatalogReuseAny:262144,DssCatalogAugmentExisting:524288,DssCatalogSortDescending:1048576,DssCatalogSortTableNameFirst:2097152,DssCatalogGetNamespaces:16777216,DssCatalogCompareWithMetadata:134217728};var k={DssCatalogStateDefault:0,DssCatalogStateSelected:1,DssCatalogStateFresh:2,DssCatalogStateMissing:4,DssCatalogStateUnexpected:8,DssCatalogStateCompatibleSmaller:16,DssCatalogStateCompatibleLarger:32,DssCatalogStateCompatible:64,DssCatalogStateIncompatible:128,DssCatalogStateCompatibilityMask:240,DssCatalogStateFreshTables:256,DssCatalogStateMissingTables:512,DssCatalogStateFreshColumns:1024,DssCatalogStateMissingColumns:2048,DssCatalogStatePartitionMappingTable:65536,DssCatalogStateDummyPartitionMappingTable:131072,DssCatalogStateDummyPartitionSliceTable:262144};function d(AK){return O.decodeHtmlString(AK).replace(/&apos;/g,"'");}function J(){var AK=new Date();return" - "+[("00"+AK.getHours()).slice(-2),("00"+AK.getMinutes()).slice(-2),("00"+AK.getSeconds()).slice(-2)].join(":");}function L(AK){var AL=" ",AP="-",AQ=":",AO=AK.split(AL),AM=AO[0].split(AP),AN=AO[1].split(AQ);return new Date(Date.UTC(AM[0],parseInt(AM[1],10)-1,AM[2],AN[0],AN[1],AN[2]));}function n(AM,AL,AK){mstrApp.getRootController().getDataService()[AK||"submitRequest"](AM,AL);}function w(AM,AL,AK){AL.showWait=AK;mstrApp.getRootController().getDataService().submitRequest(AM,AL);}function Q(AK){var AM={},AL=[];e.forEach(AK,function(AN){AM[AN.propset]=AN.propset;AL.push(AN.propset+","+AN.prop);});return U.valarray(AM).join(",,")+";"+AL.join(",,");}function m(AL){var AK=AL.ab;if(AK===0){AK=this.dbObjects.dbVersion2dbId[AL.db_ver];}return AK;}function B(AM,AL,AK){var AN=true;e.forEach(AK,function(AO){if(AO===AM){AN=false;return false;}});if(!AN){return false;}if(!AL||!AL.length){return true;}AN=false;e.forEach(AL,function(AO){if(AO===AM){AN=true;return false;}});return AN;}mstrmojo.warehouse.WHModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.WHModel",schemaInstanceID:"",dbtbls:{},dbtables:[],cachedStamp:{},dbrs:[],dbObjects:undefined,namespaces:[],catalogStamp:"",SelDBRoleID:null,SelNameSpaceID:null,catalogRefresh:false,privileges:{},dbRolesTypeFilter:[],dbRolesVersionFilter:[],dbmsTypeFilter:[],dbmsVersionFilter:[],dbRolesTypeExcludeFilter:[],dbRolesVersionExcludeFilter:[],dbmsTypeExcludeFilter:[],dbmsVersionExcludeFilter:[],dbObjectsDisplayOptions:1,dbObjectsConnectionType:1,showAddDriver:false,usingCookieNamespace:false,currentDBRole:undefined,allDBRoleNames:undefined,cas:undefined,tis:undefined,xrc:undefined,vldbProperties:undefined,propset:undefined,ns:undefined,did:undefined,clis:undefined,cln:undefined,dbRoleEditorCfg:{},databaseType:undefined,isDataImport:undefined,postCreate:function X(){var AK=this;this.dbObjects=new mstrmojo.warehouse.obj.DBObjects();if(mstrApp.isSingleTier){if(navigator.platform.indexOf("Win")===-1){this.dbObjectsConnectionType=2;this.showAddDriver=true;}return ;}w({success:function(AL){AK.privileges=AL.privileges;}},{taskId:"arch.checkPrivileges",skipSchemaIDCheck:true},true);},loadDBTypeFilters:function C(AM){var AK=this;AK.dbObjects.populateDBProperties(M({success:function AL(){var AO=[],AN=AK.dbObjectsDisplayOptions;U.forEach(AK.dbObjects.dbTypes,function(AP){if((AP.disp&AN)===AN){AO.push(AP.v);}});AK.dbmsTypeFilter=AO;AK.dbRolesTypeFilter=AO.slice(0);}},AM));},loadDBRoles:function D(AR,AL){var AM=this,AQ;AM.raiseEvent({name:P.DBROLES_REQUESTED});var AP={taskId:"arch.search",objecttypes:j,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:AM.dbRolesTypeFilter.join(","),versionFilter:AM.dbRolesVersionFilter.join(","),typeExcludeFilter:AM.dbRolesTypeExcludeFilter.join(","),versionExcludeFilter:AM.dbRolesVersionExcludeFilter.join(",")};var AK=M({success:function AO(AW,AX){var AS=[],AV=AM.currentDBRole,AU=0,AY=(AM.dbIds&&AM.dbIds.length===1),AT;e.forEach(AW.dbRoles,function(AZ,Aa){if(AX){if(!B(AZ.db_type,AM.dbRolesTypeFilter,AM.dbRolesTypeExcludeFilter)||!B(AZ.db_ver,AM.dbRolesVersionFilter,AM.dbRolesVersionExcludeFilter)){return ;}}if(AY){AT=m.call(AM,AZ);if(AZ.ab===0&&(AT===9||AT===125)&&(AM.dbIds[0]===9||AM.dbIds[0]===125)){AS.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AZ,mdl:AM}));}else{if(AM.dbIds[0]===AT||AZ.db_ver===-1){AS.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AZ,mdl:AM}));}else{if(AM.dbObjectsDisplayOptions===1&&AZ.ab===0&&AT===undefined){AS.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AZ,mdl:AM}));}else{if(AM.dbObjectsDisplayOptions===16&&AZ.ab===0){AS.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AZ,mdl:AM}));}}}}}else{AS.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AZ,mdl:AM}));}if(AV&&AZ.did===AV.did){AU=Aa;}});AM.currentDBRole=undefined;AM.set("dbrs",AS);AM.raiseEvent({name:P.DBROLES_LOADED,items:AS,offset:AU});AM.allDBRoleNames={};e.forEach(AW.allNames||[],function(AZ){AM.allDBRoleNames[AZ.did]=AZ;});}},AR);if(AM.isDataImport!==undefined){AP.isDataImport=AM.isDataImport;}if(!mstrApp.isSingleTier&&mstrApp.placeholder==="QBApp"&&!AL&&AM.isDataImport){AQ=mstrApp.type;var AN=mstrmojo.qb.EnumQBAppType;if((AQ===AN.QueryBuilder||AQ===AN.FFSQL||AQ===AN.EmmaSingleTable)&&AM.dbObjectsDisplayOptions!==16&&AM.dbObjectsDisplayOptions!==4){if(mstrApp.dbRoles){AK.success(mstrApp.dbRoles,true);}else{mstrApp.serverRequestParallel(AP,AK,true);}return ;}}if(!mstrApp.isSingleTier&&AL&&mstrApp.dbRoles){mstrApp.dbRoles=undefined;if(mstrApp.container&&mstrApp.container.launchingApp){mstrApp.container.launchingApp.dbRoles=undefined;}}n(AK,AP,"search");},loadDBObjects:function S(AK){this.dbObjects.load(this.dbmsTypeFilter,this.dbmsVersionFilter,AK);},_set_SelDBRoleID:function c(AN,AM){var AL=this,AK=this.getDBRole(AM);AL.SelDBRoleID=AM;AL.SelNameSpaceID=undefined;if(AK&&AK.mdDBRole){AL.getNameSpaces({sourceInfo:"tablesPanel"});}else{if(!AM){AL.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:""});AL.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:[],namespaceMode:f,dbRoleID:AM,error:true});}}AL.raiseEvent({name:P.DBROLE_SELECTION,value:AL.SelDBRoleID});},onSelNameSpaceIDChange:function A(AK){this.SelNameSpaceID=AK.value;this.getSelectedDBRoleTables({blockBegin:0,blockCount:1000,filterText:""},{failure:function AL(AN){if(AN){R.alert(AN.getResponseHeader("X-MSTR-TaskFailureMsg"));}}});var AM=window.localStorage;if(AM){AM.setItem(this.SelDBRoleID,this.SelNameSpaceID);}},getDBRole:function h(AL){var AM="00000000000000000000000000000000";var AK=e.find(this.dbrs,"did",(AL===AM)?this.projPrimaryDBRoleID:AL);if(AK>=0){return this.dbrs[AK];}return null;},getNameSpaces:function AC(AP){var AQ=this,AK=AP.dbRoleID||AQ.SelDBRoleID,AO=AH.DssCatalogGetNamespaces|AH.DssCatalogApplyConnectionMapping,AR=this.getDBRole(AK),AN=false,AL=false,AM=AR&&AR.mdDBRole&&AR.mdDBRole.db_type,AS;switch(AM){case 4000:AN=true;break;case 3000:AL=true;break;default:break;}if(AP.getFresh){AO=(AO|AH.DssCatalogGetFresh);}AQ.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:AP.sourceInfo||""});AS={success:function(AT){AQ.namespaces=AT.ns;AQ.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:AN?[]:AQ.namespaces,namespaceMode:a,dbRoleID:AK,namespace:AQ.SelNameSpaceID,sourceInfo:AP.sourceInfo||""});},failure:function(AT){AQ.raiseEvent({name:P.NAMESPACES_CHANGED,namespaces:[],namespaceMode:f,dbRoleID:AK,sourceInfo:AP.sourceInfo||"",error:true});if(AT){R.alert(AT.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(AL){AS.success({ns:[]});return ;}if(!AN){AQ.raiseEvent({name:P.NAMESPACES_REQUESTED,sourceInfo:AP.sourceInfo||""});}w(AS,{taskId:"arch.catalogAction",dbrid:AK,flags:AO},false);},getSelectedDBRoleTables:function u(Aa,AN){var AM=this,AL=Aa.getFresh||false,Ac=Aa.dbRoleID||AM.SelDBRoleID||AM.projPrimaryDBRoleID,AR=AM.cachedStamp,AK=AM.dbtbls,AV=Aa.filterText.toString(),Ab=AM.getDBRole(Ac);if(AL){AM.catalogRefresh=true;}if(!Ab||Ab.mdDBRole.db_type===t){AM.raiseEvent({name:V,items:[],selectedItems:[],sourceInfo:Aa.sourceInfo||""});return ;}var AS=(AK[Ac]=AK[Ac]||{}),AW=(AR[Ac]=AR[Ac]||{}),AT=O.decodeHtmlString(Aa.nameSpace||AM.SelNameSpaceID||""),AP=false,AU=[],AX=[],AZ,AQ=AS[AT],AY=(Ab.mdDBRole.db_type===AF);if(!AM.catalogRefresh&&AS&&(AQ!==undefined)){U.forEach(AQ,function(Ae,Ad){AP=true;AZ=new mstrmojo.warehouse.obj.TableData({id:Ad,n:Ad,tp:AA,model:AM,ns:Ae.ns,did:Ad,sta:parseInt(Ae.sta,10),items:[],dbtn:Ae.tbn});if(AY){AZ.extt=Ae.extt;AZ.hanai=Ae.hanai;}if(AV!==""&&Ad.toUpperCase().indexOf(AV.toUpperCase())>-1){AU.push(AZ);}AX.push(AZ);});if(AP){AM.set("catalogStamp",AW[AT]);AM.raiseEvent({name:V,items:(AV!=="")?AU:AX,selectedItems:AM.getDBRoleTablesInUse(Ac)||[],sourceInfo:Aa.sourceInfo||""});if(AN&&AN.success){AN.success({items:(AV!=="")?AU:AX});}return ;}}AQ=(AS[AT]={});AW[AT]=null;var AO=AH.DssCatalogGetTables|AH.DssCatalogApplyConnectionMapping;AO=AM.catalogRefresh?(AO|AH.DssCatalogGetFresh):AO;AM.raiseEvent({name:T,sourceInfo:Aa.sourceInfo||""});w(M({success:function(Ag){var Ad=Ag.xrc.cas[0],Aj=Ad.timestamp,Ae=Ad.tis,Af,Ah;if(Aj){var Ai=p.getDateJson(L(Aj.replace(/&apos;/,"")));Aj=[p.formatDateInfo(Ai,"yyyy-MM-dd")," ",p.formatTimeInfo(Ai,"hh:mm a")].join("");}AW[AT]=Aj;AM.set("catalogStamp",Aj);AM.catalogRefresh=false;e.forEach(Ae,function(Ak){Af=Ak.tbn=d(Ak.tbn);Ah=Ak.ns=d(Ak.ns);if(!AQ[Af]){AQ[Af]=Ak;AS[Ah]=AS[Ah]||{};AS[Ah][Af]=Ak;}});U.forEach(AQ,function(Al,Ak){AZ=new mstrmojo.warehouse.obj.TableData({id:Ak,n:Ak,tp:AA,model:AM,ns:Al.ns,did:Ak,sta:parseInt(Al.sta,10),items:[],dbtn:Al.tbn});if(AY){AZ.extt=Al.extt;AZ.hanai=Al.hanai;}AX.push(AZ);});AM.raiseEvent({name:V,items:AX,selectedItems:AM.getDBRoleTablesInUse(Ac)||[],sourceInfo:Aa.sourceInfo||""});},failure:function(){AM.raiseEvent({name:V,items:AX,selectedItems:AM.getDBRoleTablesInUse(Ac)||[],sourceInfo:Aa.sourceInfo||""});}},AN),{taskId:"arch.catalogAction",dbrid:Ac,flags:AO,ns:AT},false);},getDBRoleTablesAndColumns:function AI(AL,AM){var AK=this;if(!AL.dbRoleID){return ;}w(M({success:function(AQ){var AN=AQ.xrc.cas[0],AO=AN.tis,AT=[],AS={},AP,AR;e.forEach(AO,function(AU){AR=d(AU.ns);AP=d(AU.tbn);AT.push({n:(AR?AR+"."+AP:AP),tp:AA});e.forEach(AU.clis,function(AV){AS[AV.cln]={n:AV.cln,tp:AG};});});AQ.tables=AT;AQ.columns=U.valarray(AS);}},AM),{taskId:"arch.catalogAction",dbrid:AL.dbRoleID,flags:AH.DssCatalogGetTables+AH.DssCatalogGetColumns,ns:O.decodeHtmlString(AK.SelNameSpaceID||"")},true);},getDBRoleTablesInUse:mstrmojo.emptyFn,getColumnsForDBTable:function b(AO,AS){var AR=this,AK=AO.data.dbrole||AR.SelDBRoleID,AQ=AO.data,AP=AO.getFresh||false,AW=AQ.n,AN=AQ.ns,AT=AQ.tableId,AM,AL=AH.DssCatalogGetColumns+AH.DssCatalogApplyConnectionMapping+AH.DssCatalogIgnoreCase+(AO.compareWithMD?AH.DssCatalogCompareWithMetadata:0),AV;if(AK){if(!AP){if(AN){AV=AR.dbtbls[AK][AN][AW];AM=AV.columns;}else{AV=AR.dbtbls[AK][AW];if(AV){AM=AV.columns;}}if(AM){AS.success({src:AO,items:AM,selDBRole:AK,hanaInfo:AV.hanaInfo});if(AS&&AS.complete){AS.complete();}return ;}}AL=AP?(AL|AH.DssCatalogGetFresh):AL;w(M({success:function AU(AY){var AZ=AY.xrc.cas[0].tis[0],AX=[],Aa=AZ.hanai;AM=AZ.clis;e.forEach(AM,function(Ab){AX.push(new mstrmojo.architect.obj.Column({dbInfo:Ab}));});AV=AR.dbtbls[AK][AN][AW];if(AX.length>0){AV.columns=AX;}AV.hanaInfo=mstrmojo.hash.clone(Aa);AY.items=AX;AY.hanaInfo=AV.hanaInfo;}},AS),{taskId:"arch.catalogAction",dbrid:AK,schemaid:AR.schemaInstanceID,ns:AN,dbts:JSON.stringify([{tbn:AQ.dbtn,ns:AN,tbid:AT}]),flags:AL},true);}},saveDBRole:function H(AL,AK,AO){var AM=this;w(M({success:function AN(AQ){if(!AK){var AP=AM.getDBRole(AQ.dbr.did);AP.populated=false;AP.populate(function AR(){AM.raiseEvent({name:AK?P.DBROLES_ADD:P.DBROLES_RENAME,item:AP});});}else{AM.currentDBRole=AQ.dbr;AM.loadDBRoles(undefined,true);}}},AO),{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",dbroleinfo:JSON.stringify(AL),showWait:true},true);},deleteDBRole:function K(AL,AN){var AK=this;w(M(AN,{success:function AM(){var AO=e.find(AK.dbrs,"did",AL);if(AO>-1){AK.dbrs.splice(AO,1);}delete AK.allDBRoleNames[AL];if(AK.SelDBRoleID===AL){AK.set("SelDBRoleID",AK.projPrimaryDBRoleID);}AK.raiseEvent({name:P.DBROLES_DELETE,item:{did:AL}});}}),{taskId:"arch.deleteObject",schemaid:AK.schemaInstanceID,objectid:AL,objecttype:29,showWait:true},true);},populateDBRole:function Z(AK,AL){w(AL,{isDataImport:false,reverseOrder:true,verbose:true,taskId:"getDBInstances",vldbProperties:Q(this.dbObjects.preferences.vldbProperties),objectID:AK,skipSchemaIDCheck:true,showWait:false},false);},handleEnabledAction:function E(){return true;},handleVisibleAction:function x(AM,AL){if(!AL){return true;}switch(AL.action){case F.SET_AS_PRIMARY:return mstrApp.isArchitect&&!AM.isPrimary;case F.IS_PRIMARY:return mstrApp.isArchitect&&AM.isPrimary;case F.UPSTRUCT:return true;case F.CATALOG_SQL:var AK=this.getDBRole(AM.did);return(mstrApp.getRootController().canDisplayCatalogSQL(this.dbObjects.dbTypes,AK.mdDBRole.db_type));}return true;},handleCheckAction:function AE(AL,AK){switch(AK.action){case F.IS_PRIMARY:return AL.isPrimary;}return false;},findNameInHash:function W(AN,AK){var AM=false,AL="";U.forEach(AN,function(AO){AL=AO.name||AO.n;if(AL.toString().toUpperCase()===AK){AM=true;return false;}return true;});return AM;},validateName:function Y(AS,AR,AK,AO){var AM=this,AU=10000,AN={},AV,AL,AQ=R.desc(12934,"Object names need to be less than 250 characters"),AP=R.desc(5160,'An object name cannot contain the following characters " \\ [ ]');switch(AS){case AJ:case l:AN=AM.getAttributes();AV=R.desc(11426,"The attribute name cannot be empty.");AL=R.desc(11427,"The name is currently in use by another attribute.");break;case G:AN=AM.getFacts();AV=R.desc(11429,"The fact name cannot be empty.");AL=R.desc(11430,"The name is currently in use by another fact.");break;case AA:AN=AM.tables;AV=R.desc(11436,"The table name cannot be empty.");AL=R.desc(11437,"The name is currently in use by another table.");break;case g:AN=AM.layers;AV=R.desc(11432,"The layer name cannot be empty.");AL=R.desc(11434,"The name is currently in use by another layer.");break;case I:AN=AM.userHierarchies;AV=R.desc(12935,"The hierarchy name cannot be empty.");AL=R.desc(12936,"The name is currently in use by another hierarchy.");break;case q:AN=AO;AV=R.desc(11442,"The project name cannot be empty.");AL=R.desc(12942,"The project name already exists.");break;case j:AN=AM.allDBRoleNames;e.forEach(AM.dbrs,function(AW){AN[AW.did]=AW;});AV=R.desc(10068,"The Database Connection name can't be empty");AL=R.desc(12943,"The database connection name already exists.");break;case o:AN=AM.transformations;AV=R.desc(12944,"The transformation name cannot be empty.");AL=R.desc(12945,"The transformation name already exists.");break;default:R.alert(R.desc(12946,"object type cannot be validated, it's not defined yet"),undefined,undefined,AU);return false;}if(AR===""){R.alert(AV,undefined,undefined,AU);return false;}if(AK){if(AK.toString().toUpperCase()===AR.toString().toUpperCase()){return true;}}if(AR.length>250){R.alert(AQ,undefined,undefined,AU);return false;}var AT=/[\[\]\\"]/;if(AT.test(AR)){R.alert(AP,undefined,undefined,AU);return false;}if(this.findNameInHash(AN,AR.toUpperCase())){R.alert(AL,undefined,undefined,AU);return false;}return true;},findinArray:function AD(AL,AQ,AM){var AO=AM.toUpperCase(),AK=(AL&&AL.length)||0,AN,AP;for(AN=0;AN<AK;AN++){AP=AL[AN];if(AP&&AP[AQ].toUpperCase()===AO){return AN;}}return -1;},findNextName:function AB(AL,AN,AP){AL+=(J());var AM=1,AK=AL,AO=AK.toUpperCase();do{if(this.findinArray(AN,AP,AO)>=0){AK=AL+" "+AM++;AO=AK.toUpperCase();}else{return AK;}}while(AM<100);return"Temp Object";}});var N=mstrmojo.warehouse.WHModel;N.DssCatalogFlags=AH;N.DSSCatalogStateFlags=k;}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12370);var M=mstrmojo.hash,S=mstrmojo.array,H=mstrmojo.string,I=mstrmojo.warehouse.EnumDatabaseType,J=mstrmojo.warehouse.EnumDataChangeEvents.DBTABLES_CHANGED,R=mstrmojo.warehouse.EnumDataChangeEvents.DBTABLES_REQUESTED,T=mstrmojo.architect.menu.EnumMenuActions,F=7425,B=7426,V=mstrmojo.DI.DIConstants;mstrmojo.qb.mdx.Model=mstrmojo.declare(mstrmojo.warehouse.WHModel,null,{scriptClass:"mstrmojo.qb.mdx.Model",cubes:[],dbRoleEditorCfg:{hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[36,37,38,39],help:"Creating_a_data_source_connection_to_an_OLAP_source.htm"},dbObjectsDisplayOptions:2,dbRolesTypeFilter:[I.SAP,I.MSAS,I.EssBase,I.TM1],recursive:0,addCubes:function K(Z){var X=[],Y=this;if(!this.canAddCube(false)){return ;}mstrmojo.array.forEach(Z,function(b){X.push({n:b.n&&b.n.toString(),tp:b.cubetp.toString(),des:b.des&&b.des.toString(),ctn:b.ctn,tn:b.tn&&b.tn.toString(),isNew:true,dbrid:Y.SelDBRoleID});});Y.cubes=Y.cubes.concat(X);mstrApp.getRootController().getDataService().pollingStatus({success:function a(){Y.raiseEvent({name:"refreshTables",items:Y.cubes.slice(0)});}},null,mstrmojo.desc(12370,"Please wait..."));},canAddCube:function O(X){if(this.cubes.length>0){if(!X){this.raiseEvent({name:"maxCubeError"});}return false;}return true;},commitChanges:function C(b){var Y=this,X=function(c){var d=Y.recursive.toString();S.forEach(Y.cubes,function(e){e.rec=d;});mstrApp.getRootController().getDataService().addCubes(c,{cubes:JSON.stringify(Y.cubes),tbid:Y.tableID,dbrid:Y.cubes[0].dbrid,showWait:true});},Z=function(c){if(Y.isManagedCube){if(c&&c.success){c.success();}}else{var d={success:function(e){if(e&&e.items&&e.items.length===1){Y.folderID=e.items[0].fid;}Y.submitRequest(c,{taskId:"saveAndPublishCube",displayMode:12,shouldRefresh:false,saveAsFlags:V.saveAsFlags.saveAsDDA|V.saveAsFlags.saveAsOverWrite,folderID:Y.folderID||"",objName:Y.cubeName||"",objDesc:Y.cubeDesc||"",showWait:true});}};if(!Y.folderID&&Y.cubeID){mstrApp.getRootController().getDataService().getObjectFolder(d,{dids:Y.cubeID,types:3});}else{d.success();}}};if(this.original){if(Y.cubes[0].isNew){X({success:function a(){Z(b);}});}else{Z(b);}}else{X({success:function a(){Z(b);}});}},removeCube:function N(X){mstrmojo.array.removeIndices(this.cubes,X,1);this.raiseEvent({name:"refreshTables",items:this.cubes.slice(0)});},updateCube:function W(){var X=this;mstrApp.getRootController().getDataService().updateCubes({success:function Y(){X.raiseEvent({name:"refreshTables",items:X.cubes.slice(0)});}},{tbid:X.tableID,showWait:true});},initialize:function A(){var Y=this,X=Y.isNew=!mstrApp.tableID,Z=2,a=327681,c=mstrApp.getRootController().getDataService(),d=function d(){c.createEmmaTable({success:function e(f){Y.tableID=f.tbid;Y.isFREnabled=f.frFlag;mstrApp.msgid=f.msgid;}},{xt:Z,dict:a});};Y.tableID=mstrApp.tableID;Y.folderID=mstrApp.folderID;Y.cubeName=mstrApp.cubeName;Y.cubeDesc=mstrApp.cubeDesc;Y.cubeID=mstrApp.reportID;mstrApp.msgid=mstrApp.msgID;Y.cubes=[];Y.dbtbls={};Y.original=undefined;Y.SelDBRoleID=undefined;Y.recursive=0;if(X){if(mstrApp.msgid){d();}else{c.createEmmaInstance({success:function b(e){mstrApp.msgid=e.msgid;d();}});}}else{Y.loadTable(Y.tableID);}},loadTable:function G(X){var Y=this;Y.tableID=X;Y.submitRequest({success:function Z(c){var d=c.datap.srce,a=d.dbrid,e=d.tbal&&d.tbal.toString(),b=d.recurisve||0;Y.original=d;Y.cubes.push({n:e,tp:d.dbtp&&d.dbtp.toString(),des:d.des&&d.des.toString(),ctn:d.ctn,tn:e});Y.raiseEvent({name:"refreshTables",items:Y.cubes.slice(0)});Y.set("SelDBRoleID",a);Y.set("recursive",b);}},{taskId:"qBuilder.GetReportXDADefinition",showWait:true,tableID:X,browsetype:4,previewflag:8});},_set_SelDBRoleID:function P(c,Z){var X=this,b=(X.SelDBRoleID!==Z),Y=mstrmojo.warehouse.EnumDataChangeEvents;if(this._super){this._super(c,Z);}X.SelDBRoleID=Z;if(b&&Z){mstrApp.getRootController().getDataService().setDBRole({success:function a(d){mstrApp.msgid=d.msgid;}},{dbrid:Z,tbid:X.tableID});}S.forEach(X.dbrs,function(d){if(d.data.isPrimary){d.data.isPrimary=false;X.raiseEvent({name:Y.DBROLE_CHANGED,item:d});}if(d.did===Z){d.data.isPrimary=true;X.raiseEvent({name:Y.DBROLE_CHANGED,item:d});var e=mstrApp.diFooterID,f=e?mstrmojo.all[e]:undefined;if(f){f.mdxRA.update((!X.isNew||X.isFREnabled)&&!X.hasNonRADataset&&(d.mdDBRole.db_type===I.EssBase||d.mdDBRole.db_type===I.MSAS));}}});return b;},getNameSpaces:function D(){var X=this.SelDBRoleID;this.raiseEvent({name:mstrmojo.warehouse.EnumDataChangeEvents.NAMESPACES_CHANGED,namespaces:undefined,namespaceMode:mstrmojo.warehouse.EnumNamespaceMode.ALL,dbRoleID:X,namespace:undefined});},getSelectedDBRoleTables:function E(o){var Y=this,q=Y.SelDBRoleID,X=Y.dbtbls,m=o.blockCount,h=o.filterText,p=Y.getDBRole(q),a=false,d,c=[],g=[],l=[],t,n,j,Z,k=X[q],b,f={};if(!p){return ;}if(!Y.catalogRefresh&&k!==undefined){h=h&&h.toUpperCase();M.forEach(k,function(u,w){a=true;b=H.decodeHtmlString(u.n);Z=[];j=u.cuis;j=[].concat((j&&j.cui)||[]);d=false;t=[];if(h!==""){S.forEach(j,function(x){if(x.n.toUpperCase().indexOf(h)>-1){t.push(x);d=true;}});}else{t=j;d=true;}if(d){n=new mstrmojo.warehouse.obj.TableData({id:w,n:b,tn:w,tp:15,model:Y,ns:""});n.items=t.slice(0);g.push(n);}});if(a){if(h!==""){S.forEach(g,function(w,u){f[u]=true;});}Y.raiseEvent({name:J,items:g,expandedIndices:f,selectedItems:Y.getDBRoleTablesInUse(q)||[]});return ;}}k=X[q]={};Y.raiseEvent({name:R,sourceInfo:o.sourceInfo||""});this.submitRequest({success:function(w){var x=w.mi.cas,z,u;Y.catalogRefresh=false;x=[].concat((x&&x.ca)||[]);S.forEach(x,function(AB,AA){z=H.decodeHtmlString(AB.n&&AB.n.toString());u=H.decodeHtmlString(AB.tn&&AB.tn.toString())||z;if(!k[u]){k[u]=AB;Z=[];j=AB.cuis;j=[].concat((j&&j.cui)||[]);S.forEach(j,function AC(AD){AD.cubetp=AD.tp;AD.tp=26;AD.ctn=z;AD.tn=u;AD.n=AD.n&&AD.n.toString();AD.des=AD.des&&AD.des.toString();Z.push(AD);});n=new mstrmojo.warehouse.obj.TableData({id:u,n:z,tp:15,model:Y,ns:"",did:z,items:Z});k[u].cubes=Z;l.push(n);if(AA<m){c.push(n);}}});Y.raiseEvent({name:J,items:l,selectedItems:Y.getDBRoleTablesInUse(q)||[]});},failure:function e(){Y.raiseEvent({name:J,items:l,selectedItems:Y.getDBRoleTablesInUse(q)||[]});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:q,mdx:1,showWait:false});},getColumnsForDBTable:function U(e,Z){var Y=this,d=e.data.dbrole||Y.SelDBRoleID,b=e.data,a=b.n,c=b.did,X=Y.dbtbls[d][c].cubes;Z.success({src:e,items:X,selDBRole:d});Y.raiseEvent({name:"dbTablesPopulated",items:{id:a,n:a,items:X}});if(Z&&Z.complete){Z.complete();}},handleVisibleAction:function Q(Y,X){var Z;if(!X){return true;}if(X.action===T.EDIT){Z=Y.tp===F||Y.tp===B;}else{Z=this._super(Y,X);}return Z;},submitRequest:function L(Z,Y,X){mstrApp.getRootController().getDataService()[X||"submitRequest"](Z,Y);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(14098,12406,13534,13535,12383,14666);var D=mstrmojo.DI.DIConstants,P=mstrmojo.warehouse.EnumDatabaseType,T=mstrmojo.warehouse.EnumDataChangeEvents,F=mstrmojo.qb.EnumQBAppType,M=mstrmojo.array,Y={SET_SINGLE_PARTITION_EMMA:4},H=P.SAPHana,I={SPECIAL_SOURCE:1,ALTERNATE_SOURCE:2,REFRESH_DATA:3},C={1:mstrmojo.desc(12406,"Multiple tables cannot be added to the selection list as this data source has a special restriction which allows only a single table to be present in the data cube."),2:mstrmojo.desc(13534,"Multiple tables cannot be added to the selection list when setting Alternate Source."),3:mstrmojo.desc(13535,"Multiple tables cannot be added to the selection list when refreshing data for a table which is not a partition table.")},O=10,X=0,S=0;function Q(f){var h={isPartition:false},j,e=[],g;if(!f){return h;}h.type=f.tp;h.isPartition=h.type!==0;j=f.ptabs||[];M.forEach(j,function(k){g={};if(k.n){g.name=k.n;}if(k.hasOwnProperty("shnb")){g.sheetIndex=k.shnb;}e.push(g);});h.tables=e;return h;}function U(e){var f=[],g;M.forEach(e,function(h){g={n:h.dbtn||h.n,ns:h.ns,dbr:h.dbr,dbrn:h.dbrn,tid:h.tid||"",gbqpid:h.gbqpid||""};if(h.extt){g.extt=h.extt;}if(h.clis){g.clis=h.clis;}if(h.hanai){g.afis=h.hanai.afis;g.hieris=h.hanai.hieris;g.varis=h.hanai.varis;}f.push(g);});return f;}function N(n,m,j){var k=mstrApp.getRootController().getDataService(),h,g,o=n.length,e={success:function l(){var p={};X+=O;if(X>=o){h=JSON.stringify(U(n));p.tables=h;if(j!==undefined){p.flag=j;}k.autoMap(m,p);}else{g=[];M.forEach(n.slice(X,X+O),function(q){g.push(q.tid);});k.prepareData(e,{tables:g.join(",")},Math.min(X+O,o),o);}},failure:function f(){X+=O;},canceled:function(t,q){var p={success:function(){m.canceled();},failure:function(){m.canceled();}};if(q&&(q.tid||q.jid)){k.killJob(p,{threadId:q.tid,jobid:q.jid});}else{p.success();}}};g=[];M.forEach(n.slice(X,X+O),function(p){g.push(p.tid);});k.prepareData(e,{tables:g.join(",")},Math.min(X+O,o),o);}function A(){this.raiseEvent({name:"refreshTables",items:this.tables.slice(0),tablesEnabled:this.getAvailableTablesEnabled()});}mstrmojo.qb.es.Model=mstrmojo.declare(mstrmojo.warehouse.WHModel,null,{scriptClass:"mstrmojo.qb.es.Model",tables:[],addTableErrorMsg:undefined,dbRolesVersionExcludeFilter:[223],isDataImport:true,init:function W(e){if(this._super){this._super(e);}if(e===undefined||e.tables===undefined){this.tables=[];}if(e===undefined){return ;}if(this.isForAlternateSource){this.maxTableCount=1;this.addTableErrorMsg=C[I.ALTERNATE_SOURCE];}if(e.dbTypes!==undefined){this.specifyDBTypes=true;var f=e.dbTypes;if(e.hasNonSapHana||mstrApp.isSingleTier){M.removeItem(f,H);}this.dbRolesTypeFilter=f;this.dbmsTypeFilter=f.slice(0);}if(e.dbIds){this.dbRoleEditorCfg={dbIdFilter:e.dbIds};}if(e.dbVersions){this.dbRolesVersionFilter=e.dbVersions;this.dbmsVersionFilter=e.dbVersions;}this.dbRolesVersionExcludeFilter=(e.dbRolesVersionExcludeFilter!==undefined)?[223].concat(e.dbRolesVersionExcludeFilter):[223];if(mstrApp.isSingleTier){this.dbRolesVersionExcludeFilter=[203,220,228,252].concat(this.dbRolesVersionExcludeFilter);this.dbRoleEditorCfg=this.dbRoleEditorCfg||{};this.dbRoleEditorCfg.dsnDbTypeExcludeFilter=[4000];}if(e.dbObjects!==undefined){this.dbObjects=e.dbObjects;}if(e.isSapHanaSingleTable){this.isDDA=true;this.origIsDDA=true;this.dbObjectsDisplayOptions=1;this.specifyDBTypes=true;this.dbRolesTypeFilter=[P.SAPHana];this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);}if(e.isHadoopQB){this.dbObjectsDisplayOptions=16;this.specifyDBTypes=true;this.dbRolesTypeFilter=D.hadoopDbTypes.slice(0);this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);this.dbRolesVersionExcludeFilter=D.ibmDb2Versions.concat(this.dbRolesVersionExcludeFilter);}if(e.subtype!==undefined){switch(e.subtype){case D.sourceSubtype.searchOnSource:this.maxTableCount=1;this.addTableErrorMsg=C[I.SPECIAL_SOURCE];this.isDDA=true;this.origIsDDA=true;this.dbRoleEditorCfg={hideDSNOption:true,hideDriverCheck:true,requiresLogin:false,dbIdFilter:[40]};this.helpTopic="importing_data_using_a_search_as_a_source.htm";this.dbObjectsDisplayOptions=4;this.specifyDBTypes=true;this.dbRolesTypeFilter=[P.SearchEngineSOLR,P.SearchEngineSPLUNK];break;}}this.dbRoleEditorCfg.dbIdExcludeFilter=[41,15];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=[3000];},helpTopic:"importing_data_from_relational_tables.htm",dbRoleEditorCfg:{dbIdExcludeFilter:[41]},canAddTableInDDA:function V(j){var h=this.tables,f=this.SelDBRoleID,g,e;if(this.isDDA){g=this.dbridForDDA;if(g&&f!==g){e={name:"directDataAccessTableError"};}else{if(!g&&h.length>0&&f!==h[0].dbr){e={name:"directDataAccessTableError"};}}}if(e){if(!j){this.raiseEvent(e);}return false;}return true;},canAddTable:function d(f,j){var k=this.tables,n=j?j.length:0,g=this.maxTableCount,m=[],h,p={OLAP:4+262144000,JOIN:5+262144000,CALC:7+262144000};if(!this.canAddTableInDDA(f)){return false;}if(g&&k.length+n>g){if(!f){this.raiseEvent({name:"maxTableError"});}return false;}var l=this.SelDBRoleID,e=this.getDBRole(l),o=false;if(e&&e.mdDBRole&&e.mdDBRole.db_type===H){mstrmojo.array.forEach(j,function(q){h=parseInt(q.extt,10);if(h!==p.OLAP&&h!==p.JOIN&&h!==p.CALC){m.push(q);}});mstrmojo.array.removeItems(j,"did",m);if(m.length>0){this.raiseEvent({name:"SapHanaIncompatibleTypeError",data:m});}if(n!==0&&j.length===0){return false;}mstrmojo.array.forEach(k,function(q){if(l!==q.dbr){o=true;return false;}});}else{mstrmojo.array.forEach(k,function(q){if(q.hanai){o=true;return false;}});}if(o){this.raiseEvent({name:"SaPHanaError"});return false;}return true;},addTable:function a(g){var f=this.tables,e=this.SelDBRoleID,j=this.getDBRole(e),l=j.n,k,h=this;if(!this.canAddTable(false,g)){return ;}if(j.mdDBRole&&j.mdDBRole.db_type===H){mstrmojo.array.forEach(g,function(m){f.push({n:m.n,ns:m.ns,dbr:e,dbrn:l,dbtn:m.dbtn,extt:m.extt,hanai:m.hanai,clis:m.clis});});A.call(h);}else{mstrmojo.array.forEach(g,function(m){f.push({n:m.n,ns:m.ns,dbr:e,dbrn:l,dbtn:m.dbtn,gbqpid:h.selectedProject});});if(!this.isDDA){k=mstrApp.getRootController().getDDAController();k.tryEnableDDACheckbox(false);}if(mstrApp.msgid&&mstrApp.sessionManager){mstrApp.sessionManager.keepSessionAlive();}A.call(h);}},removeTable:function c(e){var k=mstrApp.getRootController().getDataService(),f=this.tables,h,g=this,j;j=f[e].tid;f.splice(e,1);if(f.length===0&&this.canAddTable(true)){this.raiseEvent({name:T.DBTABLES_ENABLED,value:true});}if(!this.isDDA){h=mstrApp.getRootController().getDDAController();h.tryEnableDDACheckbox(true);}if(j&&!g.original){k.removeEMMATable({success:function(){A.call(g);}},{did:j});}else{if(mstrApp.msgid&&mstrApp.sessionManager){mstrApp.sessionManager.keepSessionAlive();}A.call(g);}},removeDBRoleTables:function G(h){var e=this.tables,f=[],g;if(!h){return ;}M.forEach(e,function(j){if(j.dbr!==h){f.push(j);}});if(f.length===e.length){return ;}e=this.tables=f;A.call(this);if(e.length===0&&this.canAddTable(true)){this.raiseEvent({name:T.DBTABLES_ENABLED,value:true});}if(!this.isDDA){g=mstrApp.getRootController().getDDAController();g.tryEnableDDACheckbox(true);}},getAvailableTablesEnabled:function b(){return this.canAddTableInDDA(true);},commitChangesEditPartition:function J(m){var k=this,l=mstrApp.getRootController().getDataService(),f,h=[],n=k.tables,j,g,e=true;if(n.length===0){return ;}j=n[0].dbr;g=n[0].ns;M.forEach(n,function(o){e=o.dbr&&o.dbr===j&&((!o.ns&&!g)||(o.ns===g));if(!e){return false;}h.push(o.n);return true;});if(!e){mstrmojo.alert(mstrmojo.desc(12383,"Error: All the tables should share the same database and namespace when refreshing a partition table"),null,null);return ;}f={mode:Y.SET_SINGLE_PARTITION_EMMA,partitionId:k.tableID,addTables:JSON.stringify(h)};l.changePartition(m,f);},commitChanges:function B(l){var k=!!(this.tableID&&this.partition&&this.partition.isPartition),f=l,g=false,e=this,j=mstrmojo.desc(14666,"Do you want to group these tables into a single partition table?");if(!k&&this.tableID&&this.tables.length>1){k=true;g=true;}if(!k){e._commitChanges(l);return ;}l={success:function h(){e._commitChanges(f,true);}};if(g){mstrmojo.confirm(j,{confirmBtn:{fn:function(){e.commitChangesEditPartition(l);}}});}else{e.commitChangesEditPartition(l);}},_commitChanges:function Z(o,m){var j=o;var n=mstrApp.getRootController().getDataService(),l=this,f=false,g,k,h=false,e=function e(w){if(l.tables.length===0){if(w&&w.success){w.success({msgid:mstrApp.msgid});}return ;}M.forEach(l.tables,function(x){if(x.extt){h=true;return false;}});if(h){l.isDDA=true;}var t=function t(){g=JSON.stringify(U(m?[l.tables[0]]:l.tables));if(mstrApp.msgid){k=h?64:0;k=k|(l.original?16:0);n.createEmmaTables(w,{tables:g,skip:f,flag:k,said:mstrApp.said||"",xt:mstrApp.type,sap:h});}else{n.createEmmaInstance({success:function x(z){mstrApp.msgid=z.msgid;n.createEmmaTables(w,{tables:g,skip:f});}});}};if(!m&&l.tables.length>0&&!h&&mstrApp.type!==F.BigQuerySingleTable){f=true;X=0;w={success:function u(x){M.forEach(l.tables,function(AA,z){AA.tid=x.tables[z].id;});N(l.tables,mstrmojo.func.wrapMethods(j,{canceled:function(){}}),k);}};}else{if(h){S=0;var q={success:function u(z){var x=[],AA=l.tables[S];M.forEach(z.items,function(AB){x.push(AB.dbInfo);});AA.clis=x;AA.hanai=z.hanaInfo;S++;if(S>=l.tables.length){t();}else{l.getColumnsForDBTable({data:l.tables[S]},mstrmojo.hash.copy(q,{}));}},failure:function p(){S++;}};l.getColumnsForDBTable({data:l.tables[S]},mstrmojo.hash.copy(q,{}));return ;}}t();};if(l.original){l.tables[0].tid=l.tableID;}e(o);},loadTable:function L(f){var g=this,e=mstrApp.getRootController();g.tableID=f;g.submitRequest({success:function h(u){var AA=u.datap.srce,j=AA.dbrid,t,x=g.tables,l,n=AA.ns||"",k=AA.gbqp||"",q=(AA.dbtp===H),m,p,z=(mstrApp.type===F.BigQuerySingleTable);g.original=AA;g.usingCookieNamespace=true;if(!z){p=g.getDBRole(j);l=(p&&p.n)||"";}else{l=AA.gbqp;}t=g.partition=Q(AA.pti);if(t.isPartition){M.forEach(t.tables,function(AB){x.push({n:AB.name,ns:n,dbr:j,dbrn:l});});}else{x.push({n:AA.tbn,ns:n,dbr:j,dbrn:l,gbqpid:k});}A.call(g);if(z){e.selectDBRole(k);if(g.getProject(k)===null){m=mstrmojo.desc(14098,"There is no project ## in ###").replace("##",k).replace("###",mstrApp.userEmail);mstrmojo.alert(m);}}else{e.selectDBRole(j);if(q){var o=x[0];g.getSelectedDBRoleTables({dbRoleID:j,filterText:""},{success:function w(AB){var AD=AB.items||AB.xrc.cas[0].tis;M.forEach(AD,function(AE){if((AE.tbn||AE.dbtn)===AA.tbn&&AE.ns===AA.ns){o.extt=AE.extt;o.hanai=AE.hanai;return false;}});g.getColumnsForDBTable({getFresh:true,data:{n:AA.tbn,dbtn:AA.tbn,ns:n}},{success:function AC(AF){var AE=[];M.forEach(AF.items,function(AG){AE.push(AG.dbInfo);});o.clis=AE;}});}});}}}},{taskId:"qBuilder.GetReportXDADefinition",showWait:true,tableID:f,browsetype:4,previewflag:this.isRefined?4:8});},_set_SelDBRoleID:function(h,f){var e=this,g=(e.SelDBRoleID!==f);this._super&&this._super(h,f);e.SelDBRoleID=f;if(g&&f){e.setDBRole&&e.setDBRole(f);}mstrmojo.array.forEach(e.dbrs,function(j){if(j.data.isPrimary){j.data.isPrimary=false;e.raiseEvent({name:T.DBROLE_CHANGED,item:j});}if(j.did===f){j.data.isPrimary=true;e.raiseEvent({name:T.DBROLE_CHANGED,item:j});}});if(g){e.raiseEvent({name:T.DBTABLES_ENABLED,value:e.getAvailableTablesEnabled()});A.call(e);}return g;},submitRequest:function R(g,f,e){mstrApp.getRootController().getDataService()[e||"submitRequest"](g,f);},onisDDAChange:function E(e){var f=this;mstrApp.getRootController().getDDAController().checkDDACheckbox(e.value);f.raiseEvent({name:T.DBTABLES_ENABLED,value:f.getAvailableTablesEnabled()});A.call(f);},getHelpTopic:function K(){return this.helpTopic;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.mdx.CubeList");mstrmojo.requiresDescs(12931,14545);var B="addCube";mstrmojo.qb.mdx.CubeDropbox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.mdx.CubeDropbox",markupString:'<div id="{@id}" class="mstrmojo-qb-MDXCubeDropbox {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-emma-container" style="margin-left: 12px"><div class="mstrmojo-qb-emma-EmptyHint">{@emptyHint}</div><div class="mstrmojo-qb-emma-content"></div></div></div>',markupSlots:{hintNode:function G(){return this.domNode.firstChild.firstChild;},containerNode:function C(){return this.domNode.firstChild.lastChild;},panelNode:function N(){return this.domNode.firstChild;},outerContainerNode:function A(){return this.domNode;}},emptyHint:mstrmojo.desc(13246,"Drag and Drop table(s) from any database connections"),children:[{scriptClass:"mstrmojo.qb.mdx.CubeList"},{scriptClass:"mstrmojo.CheckBox",slot:"outerContainerNode",label:mstrmojo.desc(14545,"Import as Recursive Attribute"),alias:"recursive",oncheckedChange:function D(){mstrApp.getRootController().setRecursive(this.checked?1:0);},postCreate:function J(){if(this._super){this._super();}var Q=this,P={},O=P[this.id]={};O.recursiveChange=function(R){Q.set("checked",R.value?true:false);};mstrApp.getRootController().attachDataChangeListeners(P);this.enabled=!mstrApp.tableID;}}],init:function M(P){this._super(P);var Q={},O=Q[this.id]={};O.refreshTables=this.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(Q);},onTableRefresh:function L(O){var P=O.items.length>0;mstrmojo.css.toggleClass(this.hintNode,["off"],P);mstrmojo.css.toggleClass(this.panelNode,["active"],P);},dropZone:true,allowDrop:function F(O){return B===O.action;},ondrop:function I(O){var P=O.action,R=O.src,Q;if(R&&R.data){Q=R.data;if(P===B){mstrApp.getRootController().addCubes([Q]);}}mstrmojo.css.removeClass(this.panelNode,"dragging");},getAvatarIconClass:function E(){return"enabled";},ondragenter:function H(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),true);}mstrmojo.css.addClass(this.panelNode,"dragging");},ondragleave:function K(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),false);}mstrmojo.css.removeClass(this.panelNode,"dragging");}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller");mstrmojo.ui.ScrollableList=mstrmojo.declare(mstrmojo.ui.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableList",markupString:'<div id="{@id}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function C(){return this.domNode.firstChild.firstChild;},scrollboxNode:function D(){return this.domNode.firstChild;},scrollNode:function E(){return this.domNode.firstChild;}},postBuildRendering:function B(){if(this.renderOnScroll){if(!this.onScrollEnd){var G=this.id;this.onScrollEnd=function F(){var H=mstrmojo.all[G];H.doScroll();H.updateScrollbars();};}}if(this._super){this._super();}},renderBlockSize:150,renderIndex:0,onScrollEnd:undefined,doScroll:function A(){if(this.renderOnScroll){var G,H=this.scrollNode,F=(this.renderIndex+1)*this.renderBlockSize;if(F>=this.items.length){return ;}if(mstrmojo.dom.position(H).h===H.scrollHeight){G=this.domNode;}else{G=H;}if((mstrmojo.dom.position(G).h+G.scrollTop)>=G.scrollHeight){this.renderIndex++;var I=this._buildItemsMarkup(this.renderIndex*this.renderBlockSize,((this.renderIndex+1)*this.renderBlockSize)-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");G.innerHTML+=I;this.itemsContainerNode.innerHTML+=I;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller","mstrmojo.css");var F=mstrmojo.css;var C;mstrmojo.ui.CheckList=mstrmojo.declare(mstrmojo.ui.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.CheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{scrollboxNode:function A(){return this.domNode.firstChild;},itemsContainerNode:function I(){return this.domNode.firstChild.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onorientationChange:function L(){F.toggleClass(this.domNode,"horizontal",this.orientation!=="v");},onmultiSelectChange:function J(){F.toggleClass(this.domNode,"radio",!this.multiSelect);},onenabledChange:function H(){F.toggleClass(this.domNode,"disabled",!this.enabled);}},multiSelect:true,orientation:"v",minimumSelectCnt:0,icnCss:"icn",items:null,getItemMarkup:function K(M){if(!C){C=this._super(M).replace(">{@en@n}<",'title="{@tt}"><span>{@en@n}</span><');}return C;},getItemProps:function G(O,M){var N=this._super(O,M);var P=O.css;if(P){N.addCls(P);}N.tt=O.tt||"";N.n=O.n||" ";return N;},setupScrollNodes:function D(){this.scrollNode=this.scrollboxNode;},preselectionChange:function B(N){var O=this.minimumSelectCnt,M=this.getSelectedItems().length,P=N.removed;if(P&&O){if(M<O){this.select(P,true);return false;}}F.toggleClass(this.itemsContainerNode,"disableSelected",M<=O);return true;},buildRendering:function E(){this._super();F.toggleClass(this.itemsContainerNode,"disableSelected",this.getSelectedItems().length<=this.minimumSelectCnt);}});mstrmojo.ui.CheckList.ItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.qb.DBTableRows","mstrmojo._IsMovable","mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");mstrmojo.requiresDescs(12912,12913,12914,12915);var D=mstrmojo.css,J=mstrmojo.dom,S=mstrmojo.hash,d=Math.max,H=Math.min,e="px",I=mstrmojo.desc(12915,"No columns."),j="dragging",Y=320,P=150,Z,M=mstrmojo.qb.EnumDataChangeEvents,X=10;function Q(){if(this.domNode){var n=this.domNode.style,o=this.tableData;n.left=this.left||o.x;n.top=this.top||o.y;}}function f(n,p){var q=this.rows,o=this.domNode;if(n===undefined||p===undefined){this.maxHeight=d(o.clientHeight,this._ttlHeight);this.height=H(this.maxHeight,Y);this.width=d(o.clientWidth,P);}else{this.height=d(H(n,this.maxHeight),this._ttlHeight);this.width=d(p,P);}q.set("height",d(this.height-this._ttlHeight-this._rowHeight,0)+e);q.set("width",this.width+e);}mstrmojo.qb.DBTableView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsMovable,mstrmojo._HasOwnAvatar,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.DBTableView",markupString:'<div id="{@id}" class="mstrmojo-qb-TableView {@cssClass}"><div class="mstrmojo-qb-tv-header item"><span class="mstrmojo-qb-tv-ttl" mstrAttach:dblclick,click>{@title}</span><span class="item-mn" mstrAttach:click></span></div><div class="mstrmojo-qb-tv-rsz"></div></div>',markupSlots:{headerNode:function h(){return this.domNode.firstChild;},titleNode:function U(){return this.domNode.firstChild.firstChild;},containerNode:function V(){return this.domNode;},menuNode:function m(){return this.domNode.firstChild.lastChild;},resizeHandle:function g(){return this.domNode.children[1];}},init:function k(n){this._super(n);},rows:undefined,preBuildRendering:function A(){this._super();this.title=this.tableData.n;var n=this.tableData.items;if(!n||n.length===0){n=this.tableData.items=[{n:I,tp:"none"}];}this.rows.items=n;},postBuildRendering:function O(){this._super();Q.call(this);this._ttlHeight=this.headerNode.clientHeight;this._rowHeight=this.dummyrow.domNode.clientHeight;f.call(this);this.domNode.style.zIndex=X++;},getTableID:function C(){return this.tableData.id;},onclick:function b(n){if(n.getTarget()===n.src.titleNode){if(mstrApp.getRootController().selectSourceTable){mstrApp.getRootController().selectSourceTable(this.tableData.id);}return ;}mstrApp.getRootController().removeTable(this.tableData);},ondblclick:function L(){var o=this.title,n=this.headerNode.clientWidth-15;this.openPopup("inlineTextRef",{left:"2px",top:(J.isIE?0:1)+"px",txtConfig:{cssClass:"mstrmojo-qb-tablealias-edit",width:n+"px",value:mstrmojo.string.decodeHtmlString(o)||"",onEnter:function(){this.parent.close({enter:true});}}});this.isEditing=true;},ontableDataChange:function F(){var n=this.rows;n.height=n.width=undefined;this.refresh();},isItemAvailable:function R(n){return(this.getTableID()===n);},handleEvent:function N(n){var o=(n.item&&n.item.id)||n.id;if(this.getTableID()===o){switch(n.name){case M.RENAME:this.titleNode.innerHTML=this.title=n.value;return true;case M.TABLE_CHANGED:this.set("tableData",n.item);return true;}}else{return this.rows.handleEvent(n);}return false;},getMovingHandle:function l(){return(this.isEditing?null:this.headerNode);},draggable:true,createAvatar:function W(n){var p=document.createElement("div");if(n!==this.resizeHandle){var o=J.findAncestorByAttr(n,"idx",true,this.domNode);if(o&&o.node){p.appendChild(o.node.cloneNode(true));}p.className=this.domNode.className+" "+this.rows.domNode.className;}return p;},isDragValid:function T(n){return n.src.node===this.resizeHandle||this._super(n);},ondragstart:function c(n){this._super(n);D.toggleClass(this.domNode,[j],true);this._rszCfg={h:this.height,w:this.width};},ondragmove:function G(p){if(this._rszCfg){var n=p.src.pos,q=p.tgt.pos,o=this._rszCfg;f.call(this,o.h+q.y-n.y,o.w+q.x-n.x);}else{this._super(p);}this.linker.drawLinks();},ondragend:function E(n){this._super(n);var o=this.domNode,p=o.style.zIndex;D.toggleClass(o,[j],false);if(parseInt(p,10)<(X-1)){o.style.zIndex=X++;}delete this._rszCfg;},getDragAction:function K(n){var o=J.findAncestorByAttr(n.src.node,"idx",true,this.domNode);if(o){return mstrmojo.qb.EnumDragActions.JOIN_COLUMN;}},getDragData:function a(o){var p=J.findAncestorByAttr(o.src.node,"idx",true,this.domNode);if(p){var n=this.rows.getRowItem(p.value);return S.copy(n,{columnId:n.did,tableName:this.tableData.did,tableId:this.tableData.id});}},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,slot:"headerNode",children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onEsc:function(){this.parent.close({cancel:true});}}],onOpen:function(){var n=this.txt;S.forEach(this.txtConfig,function(o,p){n.set(p,o);});n.domNode.style.width=n.width;n.focus();},onClose:function(){this.parent.isEditing=false;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div class="item st"><span class="item-ic"></span><span class="item-n">*</span><span class="item-add" mstrAttach:click></span></div>',onclick:function b(){try{var o=this.parent;mstrApp.getRootController().addSelectedColumns(o.tableData.items);}catch(n){throw n;}},alias:"dummyrow"},{scriptClass:"mstrmojo.qb.DBTableRows",alias:"rows"}]});Z=mstrmojo.qb.DBTableView;Z.showPopupMenu=function B(n,o){var p=Z.tableCtxMenu;p.target=n;p.data=o.data;p.domNode=o.menuNode;p.showContextMenu();};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.es.TableList","mstrmojo.Label");mstrmojo.requiresDescs(12930,2121);var I="addTable";mstrmojo.qb.es.TableDropbox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.es.TableDropbox",markupString:'<div id="{@id}" class="mstrmojo-qb-EmmaTableDropbox {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-emma-container" style="margin-left: 12px"><div class="mstrmojo-qb-emma-EmptyHint">{@emptyHint}</div><div class="mstrmojo-qb-emma-TableCount"></div><div class="mstrmojo-qb-emma-content"></div></div></div>',markupSlots:{hintNode:function F(){return this.domNode.firstChild.firstChild;},countNode:function E(){return this.domNode.firstChild.children[1];},containerNode:function B(){return this.domNode.firstChild.lastChild;},panelNode:function N(){return this.domNode.firstChild;}},emptyHint:mstrmojo.desc(13246,"Drag and Drop table(s) from any database connections"),children:[{scriptClass:"mstrmojo.Label",alias:"tableCount",slot:"countNode",visible:false,postCreate:function J(){if(this._super){this._super();}var Q={},P=Q[this.id]={},O=mstrmojo.desc(2121,"Total");P.refreshTables=function(R){var S=R.items.length;this.set("visible",S>1);if(S>1){this.set("text",O+": "+S);}};mstrApp.getRootController().attachDataChangeListeners(Q);}},{scriptClass:"mstrmojo.qb.es.TableList",alias:"tableList"}],init:function L(P){this._super(P);var Q={},O=Q[this.id]={};O.refreshTables=this.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(Q);},onTableRefresh:function M(O){var P=O.items.length>0;mstrmojo.css.toggleClass(this.hintNode,["off"],P);mstrmojo.css.toggleClass(this.panelNode,["active"],P);},dropZone:true,allowDrop:function D(O){return I===O.action;},ondrop:function H(O){var P=O.action,R=O.src;if(R&&R.data){var Q=R.data;if(P===I){mstrApp.getRootController().addTable(Q);}}mstrmojo.css.removeClass(this.panelNode,"dragging");},getAvatarIconClass:function C(){return"enabled";},ondragenter:function G(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),true);}mstrmojo.css.addClass(this.panelNode,"dragging");},ondragleave:function K(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),false);}mstrmojo.css.removeClass(this.panelNode,"dragging");},onwidthChange:function A(O){var P=parseInt(O.value,10);if(isNaN(P)){return ;}P=P-140;P=(P<=0)?"20px":P+"px";this.tableList.set("itemMaxWidth",P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.SuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var C=function(S,U,T){var R=S.parent.opener,J=R&&R.showDesc,Q=R&&R.showPath,I=U[S.itemField];var P=mstrmojo.string.escape4HTMLText,V="";if(Q){var M=U.anc&&U.anc.items,O=M&&M.length;if(O>0){for(var L=0;L<O-1;L++){V+=M[L].n+" > ";}V+=P(M[O-1].n);}else{if(U.path){V+=U.path;}}}if(!T){V+=(V.length===0?"":" > ")+P(I);}if(J){var N=U[S.itemDescField],K=120;if(N){V+="\r\n\r\n<br>"+P(N.substring(0,K)+(N.length>K?"...":""));}}return V;};var A=function(I,J,K){I.path=null;if(!J||!K||K.path){if(K&&K.path){I.set("path",K.path);}return ;}window.clearTimeout(this.pathTmr);this.pathTmr=window.setTimeout(function(){var L=J.path||J.getAttribute("path");if(L){I.set("path",K.path);return ;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(M){var N=H(M.toString())||"";K.path=N;I.set("path",N);}},{taskId:"getObjectDetails",objectID:K.did,objectType:K.t},undefined);},200);};var H=function(K){var N;if(window.DOMParser){N=(new DOMParser()).parseFromString(K,"text/xml");}else{N=new ActiveXObject("Microsoft.XMLDOM");N.async="false";N.loadXML(K);}var P=N.getElementsByTagName("path")[0],L=P.childNodes,O="";if(L){for(var J=0,I=L.length;J<I;J++){var M=L[J].childNodes&&L[J].childNodes[0];if(M){O+=mstrmojo.string.escape4HTMLText(M.nodeValue)+(J<I-1?"> ":"");}}}return O;};mstrmojo.LegacySuggestionList=mstrmojo.declare(mstrmojo.SuggestionList,null,{scriptClass:"mstrmojo.LegacySuggestionList",useRichTooltip:false,itemDescField:"desc",getItemMarkup:function(K,I){var J=this.parent.opener,L=this.useRichTooltip?"":this.buildTooltip(K);return'<div class="mstrmojo-suggest-text '+((J&&J.item2textCss(K))||"")+'" idx="'+I+'" title="'+L+'">'+J.getHighlightedText(J.getSearchPattern(),mstrmojo.string.escape4HTMLText(K[this.itemField]))+"</div>";},getItemProps:function E(){return{};},onmouseover:function(J){var M=this.parent.opener;if(M&&M.showPath){var K=mstrmojo.dom.eventTarget(J.hWin,J.e),I=K.getAttribute("idx"),L=I!=null?this.items[I]:null;if(L&&L.t>-1){this.targetEl=K;this.targetItem=L;this.requestPath(K,L);}}},requestPath:function D(I,K){var J=this.parent.opener;if(K.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function&&J.showFunctionSyntaxAsPath){this.buildFunctionSyntax(K);}else{A(this,I,K);}},buildFunctionSyntax:function G(J){var K=J.path;if(!K&&J.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){var I=function I(P){if(P.did<0){return P.n;}var O=P.pars,M=[],N,L;M.push(P.n);if(O){M.push("(");for(N=0,L=O.length;N<L;N++){M.push(O[N].n);if(N!==(L-1)){M.push(", ");}}M.push(")");}return M.join("");};J.path=I(J);}this.set("path",{path:J.path,excludeSelf:true});},buildTooltip:function B(I,J){return C(this,I,J);},onpathChange:function F(){var I=this.targetEl;I.path=1;var J=this.buildTooltip(this.targetItem,this.path.excludeSelf);if(this.useRichTooltip){this.useRichTooltip=true;this.hasOpenTooltip=false;if(!I.ttp){I.ttp=J;this.showTooltip();}}else{I.title=J;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._ListSelections");mstrmojo.ListBoxHoriz=mstrmojo.declare(mstrmojo.ListBoxBase,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.ListBoxHoriz",cssClass:"mstrmojo-ListBoxHoriz",tableCssClass:"mstrmojo-ListBox-table",tableCssText:"",rowCssClass:"",rowCssText:"",cellCssClass:"",cellCssText:"",cellSpacing:0,cellPadding:0,_markupPrefix:function(){var A=this.itemRenderer;return(A&&A.markupPrefix)||('<table class="'+this.tableCssClass+'" style="'+this.tableCssText+'" cellspacing="'+this.cellSpacing+'" cellpadding="'+this.cellPadding+'"><tbody><tr class="'+this.rowCssClass+'" style="'+this.rowCssText+'">');},_markupSuffix:function(){var A=this.itemRenderer;return(A&&A.markupSuffix)||"</tr></tbody></table>";},_itemPrefix:function(){var A=this.itemRenderer;return(A&&A.itemPrefix)||('<td class="'+this.cellCssClass+'" style="'+this.cellCssText+'">');},_itemSuffix:function(){var A=this.itemRenderer;return(A&&A.itemSuffix)||"</td>";},_getItemNode:function(A){if(A<0){return null;}var B=this.itemsNode,C=B&&B.rows[0];return C&&C.cells[A].firstChild;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBoxBase","mstrmojo._HasScrollbox");mstrmojo.ListBox=mstrmojo.declare(mstrmojo.ListBoxBase,[mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.ListBox",renderAllItems:false,renderPause:10,numPagesRendered:0,pageStatus:null,_rc:null,_totalPages:null,_rh:null,_rhMin:8,_rowsPerPage:null,_defaultRowsPerPage:100,_minRowsPerPage:100,_pageHeight:null,buildRendering:function K(){if(this.renderAllItems===true){this._super();return true;}this._initPageSettings();var L=this.items;this.items=this._rc?this.items.slice(0,Math.min(this._rowsPerPage,this._rc)):[];this._super();this.items=L;this.postRenderPage(0,true);if(this._rc>this._rowsPerPage){this.itemsContainerNode.style[mstrmojo.css.MINHEIGHT]=(this._rh*this._rc)+"px";if(!this.connectedScrollbox){this.connectScrollbox(this);this.connectedScrollbox=true;}}else{this.postRenderingCleanup();}},_initPageSettings:function E(){var L=this.items;this._rc=(L&&L.length)||0;var N=this.itemRenderer;this._rh=(N&&N.rowHeight)||this._rhMin||3;var M=this._defaultRowsPerPage;if(!isNaN(this.scrollboxHeight)){M=Math.ceil(this.scrollboxHeight/this._rh);M=Math.max(M,this._minRowsPerPage);}this._rowsPerPage=M;this._totalPages=Math.ceil(this._rc/this._rowsPerPage);this._pageHeight=this._rh*this._rowsPerPage;this._pageStatus=new Array(this._totalPages);this._numPagesRendered=0;},onscroll:function J(){if(!this._renderingRows){this._startPageRenderThread();}},_startPageRenderThread:function F(){this.renderingRows=true;var M=this,L=this._renderTimer=self.setInterval(function(){if(!M){self.clearInterval(L);return ;}var N=M.getPagesToRender();if(N.length>0){M.renderPages(N);}else{M.renderingRows=false;self.clearInterval(M._renderTimer);delete M._renderTimer;if(M.isRenderingComplete()){M.postRenderingCleanup();}M=null;}},this.renderPause);},getPagesToRender:function I(){var P=[],Z=this._pageHeight,b=null,W=this._pageStatus,Y=this;function R(c){var d=W[c];if(d&&d.filled){if(!d.height){if(!b){b=Y.itemsNode.tBodies;}d.height=b[c].offsetHeight;}return d.height;}else{return Z;}}var a=0,S=null,O=null,M=this.scrollboxTop;for(var V=0,X=this._totalPages;V<X;V++){a+=R(V);if(a>=M){S=V;break;}}if(S==null){S=O=X-1;}else{var L=this.scrollboxBottom;for(var T=S+1;T<X;T++){if(a>=L){O=T-1;break;}a+=R(T);}}if(O==null){O=X-1;}for(var N=this._numPagesRendered;N<S;++N){P.push({idx:N,fill:false});}for(var Q=S;Q<=O;++Q){var U=W[Q];if(!U||!U.filled){P.push({idx:Q,fill:true});}}return P;},renderPages:function D(M){for(var N=0,L=M.length;N<L;++N){this.renderPage(M[N].idx,M[N].fill);}},renderPage:function B(R,M){var V=this._pageStatus,P=(this._numPagesRendered>=R+1);if(P){if(!M||(V[R]&&V[R].filled)){return ;}}var U=this._rowsPerPage,L=R*U,N=Math.min(L+U,this._rc)-1;var T=this.tempTableCont;if(!T){T=this.tempTableCont=this.domNode.ownerDocument.createElement("div");}var Q=M?this._buildItemsMarkup(L,N,'<table><tbody idx="'+R+'">',"</tbody></table>",this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join(""):'<table><tbody idx="'+R+'"><tr><td style="height:'+this._pageHeight+'px">&nbsp;</td></tr></tbody></table>';T.innerHTML=Q;var O=T.firstChild.tBodies[0],S=this.itemsNode;if(!P){S.appendChild(O);}else{S.replaceChild(O,S.tBodies[R]);}this.postRenderPage(R,M);},postRenderPage:function G(M,O){if(M+1>this._numPagesRendered){this._numPagesRendered=M+1;}var L=this._pageStatus,N=L[M];if(!N){N=L[M]={};}if(O){N.filled=true;}if(M>0&&M==this._totalPages-1){this.itemsContainerNode.style[mstrmojo.css.MINHEIGHT]="";}},isRenderingComplete:function C(){if(this._numPagesRendered==this._totalPages){for(var L=this._pageStatus,M=this._totalPages-1;M>-1;M--){if(!L[M]||!L[M].filled){return false;}}return true;}return false;},postRenderingCleanup:function A(){if(this.connectedScrollbox){this.disconnectScrollbox(this);this.connectedScrollbox=false;}},unrender:function(L){this.postRenderingCleanup();this._super(L);},refresh:function H(){if(!this.hasRendered){return ;}var N=this.domNode,L=N&&N.parentNode;if(!this.parent&&L){var M=N.ownerDocument.createElement("span");L.insertBefore(M,N);}this.unrender();if(!this.parent&&L){this.domNode=M;}this.render();if(this.defn&&this.defn.set){this.defn.set("readyState",mstrmojo.EnumReadystate.IDLE);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.List");mstrmojo.requiresDescs(2057,7674,7675,7676,7677,7696,7697,9923,9924,12375,12919,12948);var Q=mstrmojo.dom,R=mstrmojo.css,E=mstrmojo.desc;var M={NONE:0,CITY:1,STATE:2,COUNTRY:3,LOCATION:4,LATITUDE:5,LONGTITUDE:6,OTHER:7,ZIPCODE:8,COUNTY:9};var B=268435456,G=536870912,C=1073741824;var A=268435456,D=805306368,F=805306368,O=1879048192;var I=[{n:mstrmojo.desc(2057,"None"),did:M.NONE,geo:true},{n:mstrmojo.desc(7674,"Country"),did:M.COUNTRY,geo:true},{n:mstrmojo.desc(7676,"State"),did:M.STATE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B}]},{n:mstrmojo.desc(12919,"County"),did:M.COUNTY,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G}]},{n:mstrmojo.desc(7675,"City"),did:M.CITY,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G}]},{n:mstrmojo.desc(7677,"Zip Code"),did:M.ZIPCODE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G},{n:mstrmojo.desc(7675,"City"),did:C}]},{n:mstrmojo.desc(7696,"Latitude"),did:M.LATITUDE,geo:true},{n:mstrmojo.desc(7697,"Longtitude"),did:M.LONGTITUDE,geo:true},{n:mstrmojo.desc(12948,"City, State"),did:M.LOCATION,geo:true},{n:mstrmojo.desc(9923,"Others..."),did:M.OTHER,geo:true}];mstrmojo.qb.GeoRole=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.GeoRole",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};width:155px;height:{@height};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-qb-mapping-title">{@title}</div><div class="mstrmojo-qb-mapping-georole"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},titleNode:function(){return this.domNode.firstChild.childNodes[0];}},top:"0px",left:"0px",height:"320px",title:E(12375,"Please select a geography role for this attribute and any additional attributes that you want to create."),georole:0,shapeKeys:[],der:0,init:function N(S){this._super(S);this.raiseEvent({name:"shapeKeysChange"});},onshapeKeysChange:function J(){var S=this.shapeKeys;if(mstrApp.isCloud){I.splice(-1);}this.geolist.set("items",S?I.concat(this.shapeKeys):I);},_close:function(){var S=this.parent;if(S&&S._cmSource){S._cmSource.closeMenuTree();}},onOK:function(){var T,S;this.data.geo=true;if(this.geolist.selectedItem.geo){T=this.geolist.selectedItem.did;this.data.georole=T;S={2:A,1:D,9:F,8:O}[T]||0;this.data.der=this.der=this.der&S;}else{this.data.georole=7;this.data.shapeKey=this.geolist.selectedItem.did;}mstrApp.getRootController().setGeoRoles(this.data);this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.List",slot:"contentNode",alias:"geolist",cssClass:"mstrmojo-qb-geolist",itemIdField:"did",cssClassItem:"",onclick:function(b){var Z=Q.eventTarget(b.hWin,b.e).parentNode,W,X,a,S,V,T,c,Y;function U(d,e){return d.children[0].children[1].children[0].children[e];}if(Z.className.indexOf("mstrmojo-qb-georole-attribute")>-1){a=parseInt(Z.getAttribute("did"),10);S=[];Y=this.domNode.children[0].children;V=5;T={};T[B]={minIndex:2,childIndex:1};T[G]={minIndex:3,childIndex:2};T[C]={minIndex:5,childIndex:3};c=T[a];if(c){for(W=V;W>=c.minIndex;W--){S.push(U(Y[W],c.childIndex));}}X=(this.parent.der&a)?R.removeClass:R.addClass;for(W=0;W<S.length;W++){X(S[W],"selected");}this.parent.der=this.parent.der^a;}},adjustMenu:function L(){var S=this.parent.parent;if(S){S=S.parent.parent;if(S&&S.adjustMenuPosition){S.adjustMenuPosition();}}},expandShapeKeyNode:function K(){R.addClass(this.domNode,"showShapeKey");this.adjustMenu();},onmouseup:function H(S){switch(this.selectedItem.did){case M.OTHER:this.expandShapeKeyNode();this.set("selectedItem",{did:this.parent.shapeKey});break;}},onchange:function P(S){var T=S.added;if(T){switch(this.selectedItem.did){case M.COUNTY:case M.CITY:case M.STATE:case M.ZIPCODE:this.adjustMenu();break;case M.OTHER:var U=S.removed;if(U&&U.length){this.set("selectedIndex",U[0]);this.expandShapeKeyNode();}break;}}},itemMarkupFunction:function(a,V,U){var X=[],Z=U.parent,T,W,Y,S;if(a.items){Y=a.items;S="onclick=\"mstrmojo.dom.captureDomEvent('"+U.id+"','click', self, event)\"";X.push('<div class="mstrmojo-qb-georole-attribute-box"><span>');X.push(mstrmojo.desc(9924,"Create attributes for:"));X.push("</span>");for(T=0,W=Y.length;T<W;T++){X.push('<div class="mstrmojo-qb-georole-attribute '+((Z.der&Y[T].did)?"selected":"")+'" did="'+Y[T].did+'"'+S+'><img class="mstrmojo-qb-georole-checkbox" src="../images/1ptrans.gif"><span style="padding-left:5px;">');X.push(Y[T].n);X.push("</span></div>");}X.push("</div>");}return'<div class="mstrmojo-qb-georole '+((a.did==M.OTHER)?"other":"")+(a.geo?"":"shapeKey ")+U.cssClassItem+'" idx="'+V+'" did="'+a.did+'"><div class="mstrmojo-qb-georole-itemtext"><img class="mstrmojo-qb-georole-img" src="../images/1ptrans.gif"><span class="mstrmojo-qb-georole-text">'+a.n+'</span></div><div class="mstrmojo-qb-georole-itemcontent">'+X.join("")+"</div></div>";},onRender:function(){this.set("selectedItem",{did:this.parent.georole});}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.Popup","mstrmojo.List","mstrmojo.DropDownButton");var B=mstrmojo.dom;mstrmojo.Pulldown=mstrmojo.declare(mstrmojo.DropDownButton,null,{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-Pulldown",items:null,itemIdField:"dssid",itemField:"n",itemCSS:"css",itemTitleField:null,defaultSelection:0,defaultText:null,title:"",value:null,popupToBody:false,popupCssClass:"",popupZIndex:null,fixWidth:false,fixHeight:false,_set_items:function(H,F){var G=this.items;this.items=F||[];return G!==this.items;},markupMethods:mstrmojo.hash.copy({onvalueChange:function(){var G=this.value,F=this.selectedIndex,I=this.items||[],J,H;if(F===undefined||(G!==null&&(F===-1||(F!==-1&&I[F]&&I[F][this.itemIdField]!==G)))){F=mstrmojo.array.find(I,this.itemIdField,G);F=(F>-1)?F:this.defaultSelection;this.selectedIndex=F;}else{if(G===null){this.selectedIndex=this.defaultSelection;}}this.selectedItem=J=I[this.selectedIndex];if(J){H=J[this.itemField];}else{H=this.defaultText||"";}this.set("text",H);}},mstrmojo.hash.copy(mstrmojo.DropDownButton.prototype.markupMethods)),prevalueChange:function D(){var G=this.value,F=-1;if(G!==null){F=mstrmojo.array.find(this.items,this.itemIdField,G);}if(F>-1){this.selectedItem=this.items[F];this.selectedIndex=F;}},togglePopup:function E(){if(this.popupToBody){var I=B.position(this.popupNode,true),H=this.popupRef,F={left:Math.round(I.x)+"px",top:Math.round(I.y)+"px"};if(!H.hasRendered){delete H.slot;F.placeholder=document.body.appendChild(document.createElement("div"));}this.popupOpenConfig=this.popupOpenConfig||{};mstrmojo.hash.copy(F,this.popupOpenConfig);}else{this.popupRef.slot="popupNode";}if(this._super){this._super();}var G=this.popupRef.domNode;if(G){if(this.fixWidth){G.style.width=(this.domNode.offsetWidth-2)+"px";}else{G.style.minWidth=(this.domNode.offsetWidth-2)+"px";}}},premousedown:function A(F){if(B.getButton(F.hWin,F.e)===B.MOUSE_BUTTON.LEFT){this.togglePopup();}},unrender:function C(F){var G=this.popupRef;if(this.popupToBody&&G.hasRendered){G.unrender(false);}if(this._super){this._super(F);}},itemName:function(H,F,G){return mstrmojo.string.encodeHtmlString(H[G.itemField]);},popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",cssClass:"mstrmojo-Pulldown-Popup",autoCloses:false,modal:false,autoClose:true,locksHover:true,onOpen:function(){var H=this.opener,G=H&&H.popupZIndex,I=(H&&H.popupCssClass)||"",F=this.domNode;if(G){F.style.zIndex=G;}if(I){mstrmojo.css.addClass(F,[I]);}if(H&&H.fixWidth){mstrmojo.css.addClass(F,["fix-width"]);}if(H&&H.fixHeight){mstrmojo.css.addClass(F,["fix-height"]);}},children:[{scriptClass:"mstrmojo.List",alias:"list",itemMarkupFunction:function(I,F,G){var H=I[G.itemCSS]||G.parent.opener.item2textCss&&G.parent.opener.item2textCss(I)||"",J=G.parent.opener.itemName;return'<div class="mstrmojo-Pulldown-listItem"><div class="mstrmojo-text '+H+'" title="'+I[G.itemTitleField||G.itemField]+'">'+(J(I,F,G)||"&nbsp;")+"</div></div>";},renderOnScroll:false,bindings:{itemIdField:"this.parent.opener.itemIdField",itemField:"this.parent.opener.itemField",itemCSS:"this.parent.opener.itemCSS",itemTitleField:"this.parent.opener.itemTitleField",items:"this.parent.opener.items",selectionPolicy:"this.parent.opener.selectionPolicy",selectedIndex:"this.parent.opener.selectedIndex"},onmousedown:function(){this.parent.close();},onchange:function(){var H=this.parent,I=H.visible,F=H.opener,G=this.selectedItem;if(!F||!G||!I){return ;}F.set("value",G[this.itemIdField]);}}]}});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo._IsDial");mstrmojo.Dial=mstrmojo.declare(mstrmojo.List,[mstrmojo._IsDial],{scriptClass:"mstrmojo.Dial",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onhasSelectionChange:function(){mstrmojo.css.toggleClass(this.domNode,["hasSelection"],!!this.hasSelection);},hideIfEmpty:function(){this.onadd();}},hideIfEmpty:false,onadd:function(A){if(this._super){this._super(A);}if(this.hideIfEmpty){if(this.domNode){this.domNode.style.display=(!this.items||this.items.length==0)?"none":"block";}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.List","mstrmojo.DI.DIConstants","mstrmojo.dom","mstrmojo.Button","mstrmojo.List","mstrmojo.Table","mstrmojo.DI.DIDatabaseHelper","mstrmojo.warehouse.EnumDatabaseType");mstrmojo.requiresDescs(13191,13227,13961,14030,14712);var D=mstrmojo.hash,J=mstrmojo.DI.DIConstants,H=mstrmojo.array,G=mstrmojo.dom,E=mstrmojo.DI.DIDatabaseHelper,K=mstrmojo.warehouse.EnumDatabaseType;function L(N,M){if(N===J.dbType.PIG){M.showImportOption=false;M.sourceInfo.type=J.xdaType.ffsql;}}function B(M){if(mstrApp.isSingleTier){if((M===1400)&&!(window.FormWrapper.isWin32&&window.FormWrapper.isWin32())){return true;}}return false;}mstrmojo.DI.DISourceItem=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DI.DISourceItem",pageType:null,icon:null,title:"",n:"",desc:"",enabled:true,containHadoopFile:false,showImportOption:false,dbTypes:null,tooltipOpenDelay:0,useRichTooltip:true,markupString:'<div id="{@id}" class="mstrmojo-di-source-item {@icon}" mstrAttach:click,mouseover,mouseout><div class="mstrmojo-di-source-name"><span class="mstrmojo-di-source-name-span">{@n}</span></div><div class="mstrmojo-di-source-below"><div class="mstrmojo-di-Icons medium-{@icon}"></div><div class="mstrmojo-di-source-link"></div><div class="mstrmojo-di-source-desc">{@desc}</div><div class="mstrmojo-di-source-pulldown mstrmojo-di-source-link-paddingtop"></div><div class="mstrmojo-di-source-link mstrmojo-di-source-link-paddingtop"></div></div></div>',markupSlots:{nameNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.children[1].children[0];},firstLinkNode:function(){return this.domNode.children[1].children[1];},descNode:function(){return this.domNode.children[1].children[2];},pulldownNode:function(){return this.domNode.children[1].children[3];},lastLinkNode:function(){return this.domNode.children[1].lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},init:function I(N){this._super(N);var M=mstrApp.getRootController().model;if(this.dbObjectsDisplayOptions){if(M.supportDBObjects&&M.supportDBObjects.supportDBType){this.filterDB();}else{M.attachEventListener("dbTypeFetched",this.id,"filterDB");}}},filterDB:function F(M){var N,P,O;if(!mstrApp.getRootController){return ;}if(!M||!M.src){N=mstrApp.getRootController().model;}else{N=M.src;}P=N.supportDBObjects&&N.supportDBObjects.supportDBType;P=E.filterDBByDispOption(P,this.dbObjectsDisplayOptions,this.dbIdExcludeFilter);P=E.filterDBByAdminConfig(P,this.dbRolesAdminConfig);this.dbTypes=P;this.dbIds=E.getDBIds(P);if(this.isWaitingDBTypes){mstrApp.hideProgress();this.onclick(this.clickEvent,this.clickEventTarget);}if(!mstrApp.isSingleTier&&this.sid===J.sourceItemType.database&&!mstrApp.dbRoles){O=E.getUniqueDBTypes(P);mstrApp.getRootController().getDBRoles(O,this.dbRolesAdminConfig);}},handleSourceSelect:function C(R,N){var W=this,S,V=[],X=[],O,U=mstrApp.getRootController(),T=U.model,Q,M=!!N&&N.dbType===3000,P;if(!mstrApp.isSingleTier&&this.sid===J.sourceItemType.database&&mstrApp.dbRoles){if(!D.equals(mstrApp.dbRolesAdminConfig,this.dbRolesAdminConfig||[])){mstrApp.dbRoles=undefined;}}if(R.dbIds){V=(N&&N.dbType)?[N.dbType]:E.getUniqueDBTypes(R.dbTypes);Q=W.parent.parent.isFilterDDA;H.forEach(V,function(Y){if(!Q||T.canAddToDDACube(R.sourceInfo.subtype,Y)){X.push(Y);}});mstrApp.dbIds=(N&&N.id)?[].concat(N.id):R.dbIds;mstrApp.dbTypes=X;mstrApp.supportDBObjects=mstrApp.getRootController().model.supportDBObjects;mstrApp.dbObjectsDisplayOptions=this.dbObjectsDisplayOptions;mstrApp.dbRolesVersionExcludeFilter=this.excludeDBVFilter||[];}if(R.showImportOption){S={onOK:function(Y){var a=mstrmojo.hash.clone(W.sourceInfo);var Z=mstrmojo.hash.copy(Y.sourceInfo,a);W.openSelectedSource(Y.pageType,Z);}};if(R.sourceInfo.type===J.sourceType.googleBigQuery){O={isODBC:true,srcInfo:R.sourceInfo};}else{if(R.sourceInfo.type===J.xdaType.querybuilder){if(R.isSAPHanaDDA){O={isSAPHanaDDA:true};}else{O=(N&&N.dbType===K.SAPHana)?{isSAPHana:true}:{isODBC:true};O.hasNonSAPHana=R.hasNonSAPHana;if(M){P={sourceType:J.sourceType.querybuilder,type:J.xdaType.ffsql};U.showPage(J.pageType.database,P);return ;}}}else{if(R.enableHadoopOption){O=D.copy(S,{isContainHadoop:true});}else{O=D.copy(S,{isContainHadoop:false});}}}mstrApp.getRootController().showDialog(J.dialogType.qbImportOptionDialog,O);}else{W.openSelectedSource();}},openSelectedSource:function(N,Q){var M=mstrApp.getRootController(),R;if(this.enabled){if(mstrApp.isSingleTier&&this.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var O=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),P='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";O=O.replace("#",P)+".";M.displayError(O,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}R=mstrApp.getRootController().navigationController.getPageSlot();R.setConfig({properties:{operationMode:J.operationMode.create}});M.showPage(N===undefined?this.pageType:N,Q===undefined?this.sourceInfo:Q,R);}},onclick:function(N,O){var M=N.getTarget();if(!M){M=O;}var P=G.findWidget(M);if(!P){return ;}var Q=this.dbList;if(N.e&&N.e.button===1){N.cancel();return ;}if(Q){if(this.waitDbTypes&&!this.dbTypes){this.isWaitingDBTypes=true;this.clickEvent=N;this.clickEventTarget=N.e&&(N.e.target||N.e.srcElement);mstrApp.showProgress();return ;}if(P===Q||P===Q.list){return ;}}this.handleSourceSelect(P);},postBuildRendering:function A(){if(this._super){this._super();}if(!this.enabled){mstrmojo.css.addClass(this.domNode,"disabled");}else{mstrmojo.css.addClass(this.domNode,"enabled");}},updateTooltipConfig:function(){var M=G.position(this.nameNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-V",top:Math.max(M.y,0),left:Math.max(M.x+M.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});},postCreate:function(){if(this.showDBList){var R=this;var O;var T={scriptClass:"mstrmojo.ui.Pulldown",slot:"pulldownNode",alias:"dbList",isHostedWithin:true,value:mstrmojo.desc(14030,"All Datasets"),onitemSelected:function S(V){var X=mstrApp.dbIds=[],W=mstrApp.dbTypes=[],U=mstrApp.dbVersions=[];H.forEach(V.dbVersions,function(Y){U.push(Y.v);});X=X.concat(V.id);W.push(V.dbType);mstrApp.supportDBObjects=mstrApp.getRootController().model.supportDBObjects;mstrApp.dbVersions=[];L(V.dbType,R);R.enableHadoopOption=false;R.handleSourceSelect(R,V);},onPopupWidgetOpened:function(){if(this.items){return ;}var U=mstrApp.getRootController().model;if(!U.supportDBObjects.supportDBType){U.attachEventListener("dbTypeFetched",this.id,"setDBList");mstrApp.showProgress();}else{this.setDBList();}},setDBList:function(){var X=mstrApp.getRootController().model,a=[],Z,W,Y=this.parent.parent.parent.isFilterDDA;if(this.parent.dbTypes){D.forEach(X.importSources,function(b){W=true;if(b.subtype===J.sourceSubtype.hanaSingleTable){Z=true;return false;}});if(Z){H.forEach(this.parent.dbTypes,function(b){if(b.dbType===K.SAPHana){a.push(b);}});}else{O=this.parent;H.forEach(O.dbTypes,function(b){if(!B(b.dbType)&&(!Y||X.canAddToDDACube(O.sourceInfo.subtype,b.dbType))){a.push(b);}});}}else{O=this.parent;H.forEach(X.supportDBObjects.supportDBType,function(b){if(!B(b.dbType)&&(!Y||X.canAddToDDACube(O.sourceInfo.subtype,b.dbType))){a.push(b);}});}this.set("items",a);this.refresh();mstrApp.hideProgress();var U=this.children[0],V="mousewheel";if(U.domNode){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){V="DOMMouseScroll";}G.attachEvent(U.domNode.children[0],V,function(c){var b=window.event||c;var d=b.detail?b.detail*(-120):b.wheelDelta;if((d<0&&(this.scrollTop+this.clientHeight)===this.scrollHeight)||(d>0&&this.scrollTop===0)){G.preventDefault(window,c);}});}}};this.addChildren(T);}if(this.containHadoopFile&&!mstrApp.isSingleTier){var Q={scriptClass:"mstrmojo.Button",slot:"firstLinkNode",alias:"hadoopFiles",text:mstrmojo.desc(13191,"Browse Hadoop Files"),onclick:function N(V){G.stopPropogation(V.hWin,V.e);var U=mstrApp.getRootController();U.showPage(J.pageType.hadoop,1);}};this.addChildren(Q);}if(this.showOAuthLink&&(mstrApp.diParams.SetOAuthParams||mstrApp.isSingleTier)){var P={scriptClass:"mstrmojo.Button",slot:"lastLinkNode",alias:"setOAuth",text:mstrmojo.desc(13227,"Set OAuth Parameters"),onclick:function N(X){X.cancel();var U=mstrApp.getRootController().model;var W=U.externalSources[this.parent.sourceInfo.type];var V=this.parent;mstrApp.getRootController().openOAuthParaDialog(X,{sourceName:W.name,did:W.dbRoleID,isOneTier:!!mstrApp.isSingleTier,sourceItem:V});}};this.addChildren(P);}if(this.showWhiteListLink&&!mstrApp.isSingleTier&&mstrApp.diParams.configureProjectBasic){var M={scriptClass:"mstrmojo.Button",slot:"lastLinkNode",alias:"setWhiteList",text:mstrmojo.desc(14712,"Set Allowed URLs"),onclick:function N(V){V.cancel();var U=this.parent;mstrApp.getRootController().openWhiteListDialog(V,{isOneTier:!!mstrApp.isSingleTier,sourceItem:U});}};this.addChildren(M);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.Refine.RefineImportDialog","mstrmojo.Refine.RefineExtractDialog","mstrmojo.List");mstrmojo.requiresDescs(12350,12351,3482,3473,8118,246);var A=mstrmojo.css;var D=mstrmojo.DI.DIConstants;mstrmojo.Refine.RefineHistoryList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineHistoryList",markupString:'<div id="{@id}" class="refine-history-list-box"><div class="refine-history-header"></div><div class="refine-history-box"><div class="refine-history-inner-box"></div></div></div>',markupSlots:{headerNode:function(){return this.domNode.children[0];},historyNode:function(){return this.domNode.children[1];},sequenceNode:function(){return this.domNode.children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onundoIDChange:function(){if(this.undoID===-1){this.undo.set("enabled",false);}else{this.undo.set("enabled",true);}},onredoIDChange:function(){if(this.redoID===-1){this.redo.set("enabled",false);}else{this.redo.set("enabled",true);}}},undoID:-1,redoID:-1,setDimensions:function C(J,H){var F=parseInt(J,10);var I=parseInt(H,10);if(isNaN(F)||isNaN(I)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var K=44;var G=I-Math.max(Math.floor(I*0.65),618)-1;this.layoutConfig.h.headerNode=(K-16)+"px";this.layoutConfig.w.headerNode=(G-9)+"px";this.layoutConfig.h.sequenceNode=(F-K-14-3)+"px";this.layoutConfig.w.sequenceNode=(G-14)+"px";if(this._super){this._super(F+"px",G+"px");}},children:[{scriptClass:"mstrmojo.Label",cssClass:"refine-history-label",cssDisplay:"inline-block",text:mstrmojo.desc(12350,"History Script"),slot:"headerNode"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12351,"Reset to Initial Data"),cssClass:"refine-history-reset",slot:"headerNode",alias:"reset",enable:false,onclick:function(){var F,G;if(this.enable){F=this.parent.controller;if(F.refinePanel&&F.refinePanel.bottomPanal&&F.refinePanel.bottomPanal.splitter){G=F.refinePanel.bottomPanal.splitter.facetPanel;G.resetAllFacets();}F.applyOperations({lastDoneID:0},true);}},onenableChange:function(){A.toggleClass(this.domNode,"enable",this.enable);}},{slot:"headerNode",alias:"undo",cssClass:"refine-history-undo",scriptClass:"mstrmojo.Button",title:mstrmojo.desc(3482,"Undo"),onclick:function(){this.parent.controller.applyOperations({lastDoneID:this.parent.undoID},true);},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}}},{slot:"headerNode",alias:"redo",cssClass:"refine-history-redo",scriptClass:"mstrmojo.Button",title:mstrmojo.desc(3473,"Redo"),onclick:function(){this.parent.controller.applyOperations({lastDoneID:this.parent.redoID},true);},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(8118,"Import"),slot:"headerNode",cssClass:"refine-history-import",alias:"import",onclick:function(){var F=mstrApp.getRootController();F.showDialog(D.dialogType.refineImportDialog,{controller:this.parent.controller});},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(246,"Export"),slot:"headerNode",cssClass:"refine-history-export",alias:"export",onclick:function(){var F=mstrApp.getRootController();F.showDialog(D.dialogType.refineExtractDialog,{controller:this.parent.controller});},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}}},{scriptClass:"mstrmojo.List",cssClass:"refine-history-list",slot:"sequenceNode",itemMarkup:'<div class="list-item {@cssClass}" title="{@description}">{@description}</div>',alias:"sequence",populateChange:false,populate:function E(H){if(H.past&&H.future){var G,F,I;for(G=0;G<H.past.length;G++){I=H.past[G];I.description=G+") "+mstrmojo.string.encodeHtmlString(I.description,null,true);I.cssClass="past";}for(F=0;F<H.future.length;F++){I=H.future[F];I.description=(G+F)+") "+mstrmojo.string.encodeHtmlString(I.description,null,true);I.cssClass="future";}this.set("items",H.past.concat(H.future));if(this.selectedIndex!==H.past.length-1){this.populateChange=true;}this.set("selectedIndex",H.past.length-1);this.render();if(H.past.length===0){this.parent.set("undoID",-1);}else{if(H.past.length===1){this.parent.set("undoID",0);}else{this.parent.set("undoID",H.past[this.selectedIndex-1].id);}}if(H.future.length===0){this.parent.set("redoID",-1);}else{this.parent.set("redoID",H.future[0].id);}}},onchange:function(F){if(this.populateChange===true){this.populateChange=false;}else{this.parent.controller.applyOperations({lastDoneID:F.src.selectedItem.id},true);}},multiSelect:false}],populate:function E(F){this.sequence.populate(F);if(F&&F.past&&F.past.length>0){this.reset.set("enable",true);}else{this.reset.set("enable",false);}},handleListChanged:function B(F){this.populate(F.value);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListSelector","mstrmojo.List","mstrmojo.string");mstrmojo.OBList=mstrmojo.declare(mstrmojo.List,null,{scriptClass:"mstrmojo.OBList",cssClass:"mstrmojo-OBList",itemClass:"mstrmojo-OBListItem",iconClass:"mstrmojo-OBListItemIcon",textClass:"mstrmojo-OBListItemText",iconCssPrefx:"mstrmojo-OBIcon_",itemMarkupFunction:function(C,A,B){return'<div class="'+B.itemClass+(C[B.itemType]?" t_"+C[B.itemType]:"")+(C[B.itemSubType]?" st_"+C[B.itemSubType]:"")+(C[this.itemISC]?" isc":"")+(C[B.itemViewMedia]?" vm_"+C[B.itemViewMedia]:"")+'"><table cellspacing="0" cellpadding="0"><tbody><tr><td>'+B.getIcon(C)+'</td><td><div class="'+B.textClass+'" title="'+B.getTooltip(C)+'">'+mstrmojo.string.htmlAngles(C.n)+"</div></td></tr></tbody></table></div>";},getIcon:function(F){var E=F[this.itemType],D=F[this.itemSubType],B=" t"+E,C=(parseInt(E,10)===1||parseInt(E,10)===3||parseInt(D,10)===14082)?" st"+D:"",G=F[this.itemISC]?'class="mstrmojo-ListIcon isc"':"",A=(F[this.itemViewMedia]===2048||F[this.itemViewMedia]===8192)?" hvi":"";return'<span class="mstrmojo-ListIcon '+B+C+A+'"><span '+G+"></span></span>";},getTooltip:function(C){var D="",F=C.anc&&C.anc.items,A=F&&F.length,B;if(A>0){for(B=0;B<A-1;B++){D+=F[B].n+" > ";}D+=F[A-1].n;}var E=C.desc,G=128;if(E){D+="\r\n\r\n"+E.substring(0,G)+(E.length>G?"...":"");}return D;},listSelector:mstrmojo.ListSelector,selectionPolicy:"reselect",itemType:"t",itemSubType:"st",itemISC:"isc",itemViewMedia:"dvm",useDblSelect:false});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetListBase","mstrmojo.WidgetListMapper","mstrmojo.WidgetListBuilder");mstrmojo.WidgetList=mstrmojo.declare(mstrmojo.WidgetListBase,null,{scriptClass:"mstrmojo.WidgetList",renderOnScroll:true,listMapper:mstrmojo.WidgetListMapper,listBuilder:mstrmojo.WidgetListBuilder,itemConfig:null,itemFunction:null,initBindings:function(){this._super();var E=this.ctxtBuilder,D=E&&E.itemWidgets;if(D){for(var C=0,A=D.length;C<A;C++){var B=D[C];if(B&&B.initBindings){B.initBindings();}}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListHoriz","mstrmojo.fx");mstrmojo.FishEye=mstrmojo.declare(mstrmojo.ListHoriz,null,{scriptClass:"mstrmojo.FishEye",width:16,size:10,step:16,speed:2,cssClass:"mstrmojo-FishEye",cssClassItem:"mstrmojo-dot",itemMarkupFunction:function(B,A,C){return'<div class="mstrmojo-fisheye-item '+C.cssClassItem+'" title="'+B.n+'" idx="'+A+'" did="'+B.did+'">&nbsp;</div>';},onchange:function(){this.scroll2();this.parent.set("selectedIndex",this.selectedIndex);},as:new mstrmojo.fx.AnimateProp(),onitemsChange:function(){if(this._super){this._super();}this.last=this.items.length-1;this.first=Math.max(0,this.last-this.size);if(this.items.length>this.size){this.scroll("left",this.width);}},scroll2:function(){var A=this.selectedIndex-this.last;if(this.selectedIndex==this.first&&this.first>0){this.scroll("right",this.width);}else{if(this.selectedIndex==this.last&&this.last<this.items.length-1){this.scroll("left",this.width);}else{if(this.selectedIndex>this.last){A=this.selectedIndex-this.last;this.scroll("left",this.width*A,A);this.last=Math.min(this.items.length-1,this.last+A);}else{if(this.selectedIndex<this.first){A=this.first-this.selectedIndex;this.scroll("right",this.width*A,A);this.first=Math.max(0,this.first-A);}}}}},scroll:function(C,F,E){var B=this.itemsContainerNode,I=B&&B.style;var D=this.as,H=parseInt(mstrmojo.css.getStyleValue(B,{left:"right",right:"left"}[C]),10),H=isNaN(H)?0:H,A=parseInt(I.left,10)||0,G=A+(C=="left"?-1:1)*(F||(Math.min(this.step,(-1)*H)));D.target=B;D.props={left:{start:A,stop:G,duration:100,interval:10,suffix:"px"}};D.play();E=E===undefined?1:E;this.first+=(C=="left"?1:-1)*E;this.last=this.first+this.size-1;this.parent.set("scrollable",this.last<this.items.length-1);this.parent.set("rightScrollable",this.first>0);return G;},srcId:null,postBuildRendering:function(){if(this._super){this._super();}this.hasRendered=!!this.domNode;var E=this.itemsContainerNode,A=E&&E.firstChild,B=A&&A.rows&&A.rows[0],D=B&&B.cells&&B.cells[0];this.first=0;this.last=this.size-1;var C=this.srcId;if(C&&mstrmojo.all[C]&&mstrmojo.all[C].attachEventListener){mstrmojo.all[C].attachEventListener("change",this.id,function(F){if(this.items[this.items.length-1]!=F.src.selectedItem){this.items.add([mstrmojo.hash.copy(F.src.selectedItem)]);this.set("selectedIndex",this.items.length-1);}if(this.items.length>this.size){this.set("rightScrollable",this.items.length>this.size);this.scroll("left",this.width*(this.selectedIndex-this.last),(this.selectedIndex-this.last));}});}this.itemsContainerNode.style.left=Math.min(0,(this.size-this.items.length+1))*this.width+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.DropDownButton","mstrmojo.Label","mstrmojo.WaitIcon");mstrmojo.IncFetch=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.IncFetch",markupString:'<div id="{@id}" class="mstrmojo-IncFetch {@cssClass}" style="{@cssText}"><div class="mstrmojo-IncFetch-content"></div><div class="mstrmojo-clearMe"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},preBuildRendering:function A(){var J=[],F=this.ds,M=this.cp,P=this.np,C=this.ps,E=this.id,G=2;var L=function(){mstrmojo.all[E].set("cp",this.text);};var H={f:1,p:Math.max(M-1,1),n:Math.min(M+1,P),l:P};for(var O in H){J.push(new mstrmojo.Button({iconClass:"arrow "+O,title:F[O],enabled:(H[O]!==M),text:H[O],onclick:L}));}var D=Math.max(Math.min(M-2,P-4),1),I=Math.min(D+4,P);for(var K=D;K<=I;K++){var N;if(K===M){if(I-D===4&&P!==5){N=new mstrmojo.DropDownButton({height:"13px",title:F.a?F.a:"",text:K,direction:"up",popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",contentNodeCssClass:"goto",autoCloses:false,locksHover:true,children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.Label",cssText:"float:left;",text:F.gt},{scriptClass:"mstrmojo.TextBox",cssText:"float:left;",size:3,maxLength:String(P).length,onEnter:function(){var R=this.inputNode.value,T=this.parent.parent;if(R===""){T.close();return ;}var Q=parseInt(R,10),S=!(isNaN(Q)||Q<1||Q>P);if(S){mstrmojo.all[E].set("cp",Q);T.close();}else{this.setInvalidState(F.v.replace("###",P).replace("##",1).replace(" #",""));}}},{scriptClass:"mstrmojo.Button",cssText:"float:left",iconClass:"apply",title:F.ap?F.ap:"",onclick:function(){this.parent.children[1].onEnter();}}]}],onOpen:function(){mstrmojo.css.addClass(this.parent.domNode,["open"]);var Q=this.children[0].children[1].inputNode;window.setTimeout(function(){Q.focus();},0);},onClose:function(){mstrmojo.css.removeClass(this.parent.domNode,["open"]);this.children[0].children[1].cleanUp();}}});}else{N=new mstrmojo.Button({iconClass:"pg on",text:K});}}else{N=new mstrmojo.Button({iconClass:"pg",text:K,onclick:L});}J.splice(G++,0,N);}J.splice(G++,0,new mstrmojo.Label({text:F.pgs.replace("###",P).replace("##",""),cssText:"float:left;margin:1px 1px 1px 3px;"}));this._iWait=new mstrmojo.WaitIcon({cssText:"margin-top:-2px;"});J.push(this._iWait);this.addChildren(J);return this._super?this._super():true;},_set_cp:function B(D,C){if(parseInt(C,10)!==this.cp){this.raiseEvent({name:"fetch",v:C,iWait:this._iWait});}}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo._HasBuilder");mstrmojo.ToolBar=mstrmojo.declare(mstrmojo.HBox,[mstrmojo._HasBuilder],{scriptClass:"mstrmojo.ToolBar",cellCssClass:"mstrmojo-ToolBar-cell",markupString:'<table id="{@id}" class="mstrmojo-ToolBar {@cssClass}" style="{@cssText}" cellspacing="0" cellpadding="0"><tr><td class="mstrmojo-ToolBar-outercell"><table class="mstrmojo-ToolBar-innertable" cellspacing="0" cellpadding="0"><tr>{@tableHtml}</tr></table></td></tr></table>',markupSlots:{containerNode:function(){return this.domNode.rows[0].cells[0].firstChild.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildChildren:function A(){var B=this.buildConfig;if(!B){this.buildConfig={};B=this.buildConfig;}B.target=this.target;return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Label","mstrmojo.dom");mstrmojo.requiresDescs(162,5961,3012,163);function A(){var D=mstrApp.getRootController().refineApp.rootController,C=D.model,B=parseInt(this.parent.currentPage.value,10);if(!B){return ;}C.set("start",(B-1)*C.limit);}mstrmojo.Refine.RefinePagination=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefinePagination",markupString:'<div class="mstrmojo-Refine-RefinePagination refine-viewpanel-paging" mstrAttach:click><div class="refine-viewpanel-paging-currentRows"></div><div class="refine-viewpanel-paging-of"></div><div class="refine-viewpanel-paging-totalRows"></div><div class="refine-viewpanel-paging-pages"></div></div>',markupSlots:{currentRows:function(){return this.domNode.children[0];},ofNode:function(){return this.domNode.children[1];},totalRows:function(){return this.domNode.children[2];},pageNode:function(){return this.domNode.children[3];}},totalPages:null,children:[{scriptClass:"mstrmojo.Label",alias:"currentRows",slot:"currentRows",text:"",},{scriptClass:"mstrmojo.Label",slot:"ofNode",text:"of",},{scriptClass:"mstrmojo.Label",alias:"totalRows",slot:"totalRows",text:"",},{scriptClass:"mstrmojo.HBox",alias:"right",slot:"pageNode",cssClass:"",children:[{scriptClass:"mstrmojo.Button",alias:"firstNode",text:"",cssClass:"pagination-firstNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(162,"First page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;B.set("start",0);}},{scriptClass:"mstrmojo.Button",alias:"previousNode",text:"",cssClass:"pagination-previousNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(5961,"Previous page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;if(B.start===0){return ;}B.set("start",B.start-B.limit);}},{scriptClass:"mstrmojo.Label",text:"Page",cssClass:"pagination-Page"},{scriptClass:"mstrmojo.TextBox",alias:"currentPage",cssClass:"pagination-currentPage",width:"40px",onvalueChange:function(B){var C=B.value.toString();if(!C){return ;}C=C.replace(/[^0-9,]/g,"");C=parseInt(C)>parseInt(this.parent.parent.totalPages)?this.parent.parent.totalPages:C;C=parseInt(C)===0?1:C;this.set("value",C);},onEnter:A},{scriptClass:"mstrmojo.Label",alias:"totalPages",text:"",cssClass:"pagination-totalPages"},{scriptClass:"mstrmojo.Button",alias:"nextNode",text:"",cssClass:"pagination-nextNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(3012,"Next page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;if(B.start===(B.data.filtered-1)-((B.data.filtered-1)%B.limit)){return ;}B.set("start",B.start+B.limit);}},{scriptClass:"mstrmojo.Button",alias:"lastNode",text:"",cssClass:"pagination-lastNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(163,"Last page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;B.set("start",(B.data.filtered-1)-((B.data.filtered-1)%B.limit));}}]}]});})();(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HBox","mstrmojo.CheckBox");mstrmojo.requiresDescs(1143);var E=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",cssClass:"mstrmojo-wh-DBRoleCheckBox",postBuildRendering:function A(){if(this._super){this._super();}this.checkbox.set("label",this.label);this.helpBtn.set("visible",!!(this.helpLink));},children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",oncheckedChange:function C(){if(this._super){this._super();}this.parent.checked=this.checked;this.parent.oncheckedChange();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-wh-DBRoleCheckBox-help",alias:"helpBtn",visible:false,title:mstrmojo.desc(1143,"help"),onclick:function I(){E.showHelp(this.parent.helpLink);}}],checkbox:undefined,helpBtn:undefined,onlabelChange:function G(){this.checkbox.set("label",this.label);},helpLink:undefined,enabled:true,onenabledChange:function F(){this.checkbox.set("enabled",this.enabled);},isNumeric:false,getValue:function D(){if(this.isNumeric){return(this.checkbox.checked?"1":"0");}return(this.checkbox.checked?"true":"false");},setValue:function B(J){this.checkbox.set("checked",((J==="true")||(J===true)||(J==="1")));},isValid:function H(){return{val:true,msg:""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.func","mstrmojo.array","mstrmojo.Button","mstrmojo.HBox","mstrmojo.dom","mstrmojo.Box");var D=mstrmojo.dom;mstrmojo.Dialog=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Dialog",title:"",buttons:null,alignment:"center",btnAlignment:"right",zIndex:10,modal:true,markupString:'<div id="{@id}" class="mstrmojo-Dialog {@cssClass}" style="z-index: 1100;" tabindex="0" mstrAttach:click><div class="win mstrmojo-Editor" style="{@cssText}"><div class="mstrmojo-Editor-titlebar"><div class="mstrmojo-Editor-title">{@title}</div></div><div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div><div class="mstrmojo-Editor-tip"></div></div>',markupSlots:{editorNode:function(){return this.domNode.firstChild;},curtainNode:function(){return this.domNode.childNodes[1];},titleNode:function(){return this.domNode.firstChild.firstChild;},containerNode:function(){return this.domNode.firstChild.childNodes[1];},buttonNode:function(){return this.domNode.firstChild.lastChild;},tipNode:function(){return this.domNode.lastChild;}},editorNode:null,btnHbox:null,markupMethods:{onzIndexChange:function(){this.editorNode.style.zIndex=this.zIndex;this.curtainNode.style.zIndex=this.zIndex-1;},onwidthChange:function(){this.editorNode.style.width=this.width||"auto";},onvisibleChange:function(L){if(L){return ;}var J=this.visible,K=J?"block":"none";this.editorNode.style.display=K;if(this.modal){this.curtainNode.style.display=K;}},onleftChange:function(){this.editorNode.style.left=this.left||"";},ontopChange:function(){this.editorNode.style.top=this.top||"";},ontitleChange:function(){this.titleNode.firstChild.innerHTML=this.title||"";}},preBuildRendering:function F(){var J;var K=this.buttons;if(K&&!this.btnHbox){for(J in K){K[J].cssClass=(K[J].cssClass||"")+(this.noButtonCls?"":" mstrmojo-Editor-button");}this.addChildren([{scriptClass:"mstrmojo.HBox",cssText:"float:"+this.btnAlignment,slot:"buttonNode",alias:"btnHbox",children:K},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-clearMe",slot:"buttonNode"}]);}if(this.modal){this.cssClass+=" modal";}return this._super();},buildRendering:function B(){var J=this.placeholder;if(this._super()){if(!this.parent&&!J){document.body.appendChild(this.domNode);}return true;}return false;},getResizeHandler:function E(){var J=this.id;return function(){var K=mstrmojo.all[J];K.resizeDialog();K.positionDialog();};},postBuildRendering:function A(){this._super();if(this.modal&&this.visible){this.curtainNode.style.display="block";}if(!this._resizeHandler){var K=this._resizeHandler=this.getResizeHandler();D.attachEvent(window,"resize",K);}this.resizeDialog();this.positionDialog();try{this.domNode.focus();}catch(J){}return true;},resizeDialog:function G(){if(this.modal){this.resizeCurtain();}},resizeCurtain:function C(){var K=this,O=K.curtainNode,J=document.body,M=document.documentElement,N=O.style,L=K.curtainPosition;N.width=Math.max(J.clientWidth,M.scrollWidth)+"px";if(L&&L.h){N.height=L.h+"px";}else{N.height=Math.max(J.clientHeight,M.scrollHeight)+"px";}if(L&&L.y){N.top=L.y+"px";}K.raiseEvent({name:"resizeCurtain"});},positionDialog:function H(){var K=this.editorNode,M=this.left,L=this.top;if(!M||!L){D.center(K);var J=K.style;if(this.alignment==="top"){J.top="10px";}if(M){J.left=M;}if(L){J.top=L;}}},destroy:function(K){var J=this._resizeHandler;if(J){D.detachEvent(window,"resize",J);}this._super(K);}});mstrmojo.toast=function I(O,M,Q,J){var P="mojoToast9",N,L=M||3000;if(J&&J.id){P=J.id+"-"+P;}try{mstrmojo.all[P].destroy();}catch(K){}mstrmojo.insert({id:P,scriptClass:"mstrmojo.Label",cssClass:(J&&J.cssClass)?J.cssClass:"toastCss",text:O}).render();N=mstrmojo.all[P].domNode;if(J&&J.dom){J.dom.appendChild(N);}else{document.body.appendChild(N);D.bottomCenter(N);}window.setTimeout(function(){if(Q){Q();}try{mstrmojo.all[P].destroy();}catch(R){}},L);};mstrmojo.mask={show:function(){var J=mstrmojo.mask.win=mstrmojo.insert({scriptClass:"mstrmojo.Box",cssClass:"fullscreen-mask"});J.render();document.body.appendChild(J.domNode);},hide:function(){mstrmojo.mask.win.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo._HasLayout","mstrmojo.Box","mstrmojo.css","mstrmojo.HBox","mstrmojo.string","mstrmojo.TextBox");var H=mstrmojo.css,E=mstrmojo.dom,C=mstrmojo.desc(505,"Update"),D="clear";mstrmojo.warehouse.ui.SearchBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.ui.SearchBox",cssClass:"mstrmojo-wh-SearchBox",tableBox:undefined,inputBox:undefined,clearBtn:undefined,refreshBtn:undefined,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-wh-SearchBox-contents",alias:"tableBox",children:[{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-sb-input",alias:"inputBox",oldText:"",onkeydown:function G(){this.oldText=this.value;},onkeyup:function B(){var P=this,N=this.value,M=this.parent.clearBtn,Q=this._searchTimeoutId,O=this._hasText=N.length>0;if(this.oldText!==N){H.toggleClass(M.domNode,[D],O);window.clearTimeout(Q);this._searchTimeoutId=window.setTimeout(function(){P.parent.parent.triggerSearch();},this.searchDelay);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-sb-btn",alias:"clearBtn",onclick:function L(){var M=this.parent;if(M.inputBox._hasText){M.parent.clearSearch();}else{M.parent.triggerSearch();}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-sb-refresh",alias:"refreshBtn",visible:false,onclick:function L(){if(this.parent.parent._onRefresh){this.parent.parent._onRefresh();}},title:C,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var M=E.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",top:Math.max(M.y+40,0),left:Math.max(M.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});}}]}],title:"",tooltipOpenDelay:0,useRichTooltip:true,_preSearch:undefined,_onRefresh:undefined,searchDelay:-1,init:function K(N){this._super(N);var M=this.searchDelay;if(M===-1||isNaN(M)){this.searchDelay=parseInt(mstrApp.getSearchAutoCompleteDelay(),10);}},postBuildRendering:function A(){this._super();this.tableBox.inputBox.domNode.maxLength=248;this.tableBox.inputBox.value="";},clearSearch:function I(M){if(!this.hasRendered){return ;}this.tableBox.inputBox.set("value","");H.removeClass(this.tableBox.clearBtn.domNode,[D]);delete this.tableBox.inputBox._hasText;if(!M){this.triggerSearch();}},triggerSearch:function F(){var M=true;if(this._preSearch){M=this._preSearch();}if(M){this.raiseEvent({name:"searchTriggered",searchValue:mstrmojo.string.trim(this.tableBox.inputBox.value)});}},showTooltip:function J(R,Q){var P=this,N=E.findAncestorByAttr(E.eventTarget(Q,R),"tooltip",true,this.domNode),O=N&&N.value;if(!P.hasOpenTooltip&&O){var M=E.position(N.node);P.richTooltip={cssClass:"vi-regular vi-tooltip-A",content:O,top:Math.max(M.y+40,0),left:Math.max(M.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT};this._super(R,Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._HasPopup","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Label","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.ui.SimpleTree","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.array","mstrmojo.css");var H=mstrmojo.array,Q=mstrmojo.css;var A=mstrmojo.warehouse.EnumObjectTypes,J=A.ATTRIBUTE,K=A.METRIC,I=A.TABLE;mstrmojo.DI.DISearchTableBox=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DI.DISearchTableBox",cssClass:"mstrmojo-di-DISearchTableBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"",alias:"tableBox",children:[{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-tb-inputBox mstrmojo-wh-sb-input",alias:"inputBox",oldText:"",onkeydown:function E(){this.oldText=this.value;},onkeyup:function O(){var W=this,U=this.value,T=this.parent.clearBtn,V=this._hasText=U.length>0;if(this.oldText!==U){Q.toggleClass(T.domNode,["clear"],V);W.parent.parent.searchTableTree.searchTables(mstrmojo.string.trim(U));}},onclick:function S(T){var U=this.parent.parent,V=U.searchTableTree;if(!V.visible){V.searchTables(mstrmojo.string.trim(this.value));U.openPopup("searchTableTree",{});}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tb-clearBtn mstrmojo-wh-sb-btn",alias:"clearBtn",onclick:function S(){var V=this.parent,T=V.inputBox,U=V.parent.searchTableTree;if(T._hasText){T.set("value","");T._hasText=false;Q.removeClass(this.domNode,["clear"]);U.searchTables();}else{U.searchTables();}}}]}],initChildren:function B(){this.children.push({scriptClass:"mstrmojo.DI.DISearchTableTree",alias:"searchTableTree",cssClass:"mstrmojo-di-searchTableTree mstrmojo-wh-AvailableTablesTree mstrmojo-wh-TablesTree",visible:false,locksHover:true});this._super();},getPopupWidget:function D(){return this.searchTableTree;},getPopupHostNode:function F(){return this.domNode;},getPopupConfig:function G(){var T="mstrmojo-popup-widget-hosted",V=[T],U=this.hostedCSSClass;if(U){V.push(U);}return new mstrmojo.ui.PopupConfig({hostId:this.id,hostElement:this.getPopupHostNode(),anchorElement:this[this.anchorSlot],isHostedWithin:this.isHostedWithin,hostProxyCssClass:V.join(" ")});},postBuildRendering:function P(){var T=this.getPopupWidget();if(T){var U=this.getPopupConfig();T.popupConfig=T.addDisposable(U);}return this._super();},openPopup:function(V,T){var W,U;this._super(V,T);W=mstrApp.getRootController().getDialogController().getCurrentZIndex()+10;U=this.domNode.style;if(W!==U.zIndex){U.zIndex=W;}},anchorSlot:"domNode",isHostedWithin:true,hostedCSSClass:""});mstrmojo.DI.DISearchTableTree=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.DI.DISearchTableTree",cssClass:"mstrmojo-di-searchTableTree",getItemMarkup:function C(){return'<div class="{@cls}" title="{@ttp}"><span class=item-n>{@n}</span></div>';},getItemProps:function R(W,X,U){var V=W.n,T=mstrmojo.string.encodeHtmlString((V&&(V+""))||"");return{tag:"div",cls:"item "+(W.tp?("tp"+W.tp):""),n:T,idx:U};},searchTables:function M(h){var Z=mstrApp.getRootController(),U=Z.model.importSources,W,j,e=[],T,Y,c=[],V=[],a,d,l=[J,K],g=[],X,f,b;h=h||"";Y=h.toUpperCase();for(W in U){if(U.hasOwnProperty(W)){T=U[W];j={id:T.tableID,did:T.tableID,n:T.sourceInfo.name,tp:I,isLeaf:true};if(!Y||j.n.toUpperCase().indexOf(Y)!==-1){c.push(j);}a=Z.getAttributesAndMetrics(T.tableID,Y);H.forEach(a,function(m,k){if(!V[k]){V[k]={};}d=V[k];H.forEach(m,function(n){if(!d[n.alias]){d[n.alias]=[];}d[n.alias].push(T.tableID);});});}}H.forEach(V,function(n,o){var m;g[o]=[];for(m in n){if(n.hasOwnProperty(m)){j={n:m,tp:l[o],tableIds:n[m]};g[o].push(j);}}});H.forEach([c].concat(g),function(k){k.sort(function(n,m){var p=n.n.toUpperCase(),o=m.n.toUpperCase();return(p<o)?-1:((p===o)?0:1);});});e=c;H.forEach(g,function(k){e=e.concat(k);});this.expandedIndices={};this.set("items",e);f=e.length;if(!f){return ;}b=this.domNode.firstChild.children;for(X=c.length;X<f;X++){this.expandedIndices[X]=true;this.itemRenderer.expand(b[X],this.items[X],0,X,this);}},init:function N(U){if(this._super){this._super(U);}this.dataHelper={fetch:function T(Y,a){var W=[],Z,V=mstrApp.getRootController(),X=V.model.importSources;if(Y.tp===J||Y.tp===K){H.forEach(Y.tableIds,function(b){if(X.hasOwnProperty(b)&&X[b]){Z={id:b,did:b,n:X[b].sourceInfo.name,tp:I,isLeaf:true};W.push(Z);}});}a.success({items:W});if(a.complete){a.complete();}}};},treeHooks:{select:function L(V,b,T,a){var X,U=this.userSelections,W=b.id,Z,Y;if(b.tp!==I){this.selectedIndices={};return true;}for(X in U){if(U.hasOwnProperty(X)&&U[X]){this.toggleChildSelection(X,false);}}this.selectedIndices={};this.userSelections={};this.userSelections[a]=true;Q.toggleClass(V,"selected",true);Z=mstrApp.getRootController();Y=Z.getModel();if(Y.currentSource&&Y.currentSource.tableID===W){return true;}Z.selectSourceTable(W,true);return true;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.TextBox");var A=mstrmojo.css,C=mstrmojo.dom;mstrmojo.TextArea=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextArea",markupString:'<textarea id="{@id}" class="mstrmojo-TextArea {@cssClass}"  style="{@cssText}" title="{@tooltip}" placeholder="{@placeholderText}" rows="{@rows}" cols="{@cols}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keydown,keyup,blur></textarea>',maxLength:256,onkeydown:function B(K){var I=this.inputNode,J=this.value,E=this.maxLength,F=(J&&J.length)||0,M=K.e,L=M.keyCode;this.isDeleteKeys=L===8||L===46;this.isArrowKeys=L===37||L===38||L===39||L===40;if(E!==undefined&&E<=F){var G=I.selectionEnd,H=(G!==undefined)?(G-I.selectionStart)>0:document.selection.createRange().text.length>0;if(!this.isDeleteKeys&&!this.isArrowKeys&&!H){if(C.isIE7||C.isIE8||C.isIE9){I.blur();window.setTimeout(function(){I.focus();},1);}C.preventDefault(window,M);return false;}}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.TextArea,{oncssClassChange:function D(){A.addClass(this.domNode,this.cssClass||"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextBox");mstrmojo.requiresDescs(7564);var F,I=mstrmojo.string,J=mstrmojo.desc(7564,"Select...");mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector",postBuildRendering:function A(){if(this._super){this._super();}this.infobox.captionlbl.set("text",this.caption);},caption:"",text:"",infobox:undefined,captionlbl:undefined,ontextChange:function B(){this.infobox.txt.set("value",this.text);},isRequired:false,enabled:true,field:undefined,selectorOption:0,parentRBAlias:"",focus:function M(){this.infobox.txt.focus();},getValue:function D(){return this.text;},setValue:function C(N){this.set("text",N);this.set("value",N);},onenabledChange:function G(){this.infobox.captionlbl.set("enabled",this.enabled);this.infobox.txt.set("enabled",this.enabled);},isValid:function L(){var N=I.trim(this.getValue()),O={val:true,msg:""};if(!this.enabled){return O;}if(!this.isRequired&&N===""){return O;}if(this.isRequired&&N===""){O.val=false;O.msg=mstrmojo.desc(12937,"Value for '##' cannot be empty").replace("##",this.caption);return O;}return O;},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-InfoBox",alias:"infobox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Label",alias:"captionlbl"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Info",alias:"txt",onEnter:function E(){var N=this.parent.parent;if(N.onEnter){N.onEnter(N.parent.parent);}},onvalueChange:function H(N){this.parent.parent.setValue(N.value);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Select",alias:"fileSelector",text:J,bindings:{visible:function(){var O=this.parent.parent.selectorOption,N=!!(mstrApp.isSingleTier),P=(navigator.platform.indexOf("Win")!==-1),Q=!P;if(((O&1)===1)&&!N){return true;}if(((O&2)===2)&&N&&P){return true;}if(((O&4)===4)&&N&&Q){return true;}return false;}},onclick:function K(){F=this.parent;mstrApp.rootController.launchOneTierAccessFileBrowser("mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector.oneTierFileSelector");}}]}]});mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector.oneTierFileSelector=function(N){F.txt.set("value",N);};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.DI.DIConstants","mstrmojo.qb.thirdParty.UrlSourceItem");mstrmojo.requiresDescs(11098,12850,13992);var H=mstrmojo.css,F=mstrmojo.array;mstrmojo.qb.thirdParty.SourceInput=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.thirdParty.SourceInput",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload mstrmojo-di-fu mstrmojo-qb-thirdParty-SourceInput {@cssClass}" style="{@cssText}" ><div></div><div class="url-input"></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},instructionNode:function(){return this.domNode.firstChild;},urlInputNode:function(){return this.domNode.children[1];},urlContainerNode:function(){return this.domNode.lastChild;}},children:[{slot:"instructionNode",scriptClass:"mstrmojo.Label",cssClass:"connection-info-label",text:mstrmojo.desc(13992,"Please select a connection first"),postCreate:function(){var L=mstrApp.getRootController().model;L.attachEventListener("SelDBRoleNameChange",this.id,"updateInstruction");},updateInstruction:function E(L){var M=L.value?L.value:mstrmojo.desc(13992,"Please select a connection first");this.set("text",M);this.parent.enableFooterBtn();}},{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",emptyText:mstrmojo.desc(12850,"Enter URL"),onvalueChange:function(L){var M=!L.value||L.value==="";this.parent.toggleAddBtnState(!M);this.parent.enableFooterBtn();}},{slot:"urlInputNode",alias:"addBtn",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",cssDisplay:"inline-block",text:mstrmojo.desc(531,"Add"),onclick:function(){this.parent.addURL();}},{slot:"urlContainerNode",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-thirdParty-url-holder",alias:"urlList",bindings:{visible:function(){return this.getSrcCnt()>0;}},addURL:function G(O){var N=mstrApp.getRootController();var L=mstrmojo.insert({scriptClass:"mstrmojo.qb.thirdParty.UrlSourceItem",url:O,dbRoleID:N.model.SelDBRoleID,dbRoleName:N.model.SelDBRoleName});var M=this.addChildren(L);M.render();if(!this.visible){this.set("visible",true);}},deleteURL:function I(L){this.removeChildren(L);if(this.getSrcCnt()===0){this.set("visible",false);}this.parent.enableFooterBtn();},getSrcCnt:function(){return this.children?this.children.length:0;},getSrcs:function(){var L=[];F.forEach(this.children,function(M){L.push({url:M.url,dbRoleID:M.dbRoleID});});return L;}}],addURL:function G(){var L=mstrApp.getRootController();var N=L.model;var M=this.urlInput.value;M=M.replace(/^\s+|\s+$/g,"");if(M.length===0){return ;}if(!N.isNew){this.urlList.removeChildren();}this.urlList.addURL(M);this.urlInput.set("value","");},enableFooterBtn:function A(){var L=mstrApp.getRootController();var O=L.model;var P=this.urlList.getSrcCnt();var M=this.urlInput.value;if(P===0){var N=M&&O.SelDBRoleID;L.enableButton(N);}else{if(!O.isNew&&P===1){L.enableButton(M.length<1);}}},getSrcs:function C(){this.addURL();return this.urlList.getSrcs();},removeSrcs:function B(O){var L=this.urlList;var M=L.children,N=[];F.forEach(O,function(P){F.forEach(M,function(Q){if(Q.url===P.url){N.push(Q);return false;}});});F.forEach(N,function(P){L.removeChildren(P);});},initURL:function J(){var L=mstrApp.getRootController().model.SQLstmt;if(L&&L.length>0){this.urlList.addURL(L);this.enableFooterBtn();}},postBuildRendering:function D(){if(this._super){this._super();}var L=mstrApp.getRootController().model;L.attachEventListener("reportDefLoaded",this.id,this.initURL);},toggleAddBtnState:function K(L){H[L?"addClass":"removeClass"](this.addBtn.domNode,["hot"]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.warehouse.dbroles.DBRoleHelper");mstrmojo.requiresDescs(12937,12938);var G=mstrmojo.warehouse.dbroles.DBRoleHelper,F=mstrmojo.dom,K=mstrmojo.string;mstrmojo.warehouse.dbroles.DBRoleSetting=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",cssClass:"mstrmojo-wh-DBRoleSetting",postBuildRendering:function A(){if(this._super){this._super();}this.infobox.captionlbl.set("text",this.caption);var N=F.position(this.infobox.captionlbl.domNode).w,O=F.position(this.infobox.txt.domNode).w,P=F.position(this.infobox.domNode).w;if((N+O)>P){this.infobox.txt.domNode.style.width=(P-N-10)+"px";}},caption:"",text:"",infobox:undefined,captionlbl:undefined,ontextChange:function B(){this.infobox.txt.set("value",this.text);},isNumeric:false,isPassword:false,hiddenPwd:"",isRequired:false,enabled:true,field:undefined,parentRBAlias:"",focus:function M(){this.infobox.txt.focus();},getValue:function D(){return this.text;},setValue:function C(N){this.set("text",N);this.set("value",N);},onenabledChange:function H(){this.infobox.captionlbl.set("enabled",this.enabled);this.infobox.txt.set("enabled",this.enabled);},isValid:function L(){var N=K.trim(this.getValue()),O={val:true,msg:""};if(!this.enabled){return O;}if(!this.isRequired&&N===""){return O;}if(this.isRequired&&N===""){O.val=false;O.msg=mstrmojo.desc(12937,"Value for '##' cannot be empty").replace("##",this.caption);return O;}if(this.isNumeric&&!G.isNumeric(N)){O.val=false;O.msg=mstrmojo.desc(12938,"Only numeric values are allowed for '##'").replace("##",this.caption);return O;}return O;},children:[{scriptClass:"mstrmojo.Box",alias:"infobox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",alias:"captionlbl",text:"this.parent.caption"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-DBRoleSetting-Info",alias:"txt",preBuildRendering:function J(){var N=this.parent.parent;if(N.isPassword){this.set("type","password");this.set("autoComplete",(mstrApp.autocomplete==="1"));}},onEnter:function E(){var N=this.parent.parent;if(N.onEnter){N.onEnter(N.parent.parent);}},onvalueChange:function I(N){this.parent.parent.setValue(N.value);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Widget");var D={none:0,moveMetricHeader:1,moveData:2,moveDataColumn:3,moveDataRow:4};function M(Q,O,N){var P;if(N.startRow===N.endRow&&Q===N.startRow&&O>=N.startColumn){P=true;}else{P=N.startColumn===N.endColumn&&O===N.startColumn&&Q>=N.startRow;}return P;}function F(P,O,N){return P===N.startRow&&O===N.startColumn;}function E(P,O,N){return O===N.startColumn&&P>N.startRow;}function C(P,O,N){return P===N.startRow&&O>N.startColumn;}function I(Q,P,O,N){if(M(Q,P,O)||(this.operation===D.moveMetricHeader)){this.domNode.style.cursor="move";}else{if(F(Q,P,N)||(this.operation===D.moveData)){this.domNode.style.cursor="se-resize";}else{if(E(Q,P,N)||(this.operation===D.moveDataColumn)){this.domNode.style.cursor="w-resize";}else{if(C(Q,P,N)||(this.operation===D.moveDataRow)){this.domNode.style.cursor="n-resize";}else{this.domNode.style.cursor="auto";}}}}}function A(O){var N=O.currentTarget;var P=N.parentNode;if(M(P.rowIndex,N.cellIndex,this.xtabModel.mhb)){this.operation=D.moveMetricHeader;this.draw();}if(F(P.rowIndex,N.cellIndex,this.xtabModel.db)){this.operation=D.moveData;this.draw();}if(E(P.rowIndex,N.cellIndex,this.xtabModel.db)){this.operation=D.moveDataColumn;this.draw();}if(C(P.rowIndex,N.cellIndex,this.xtabModel.db)){this.operation=D.moveDataRow;this.draw();}}function G(O){var N=(O.currentTarget)?O.currentTarget:O.srcElement;var T=N.parentNode;var Q=this.xtabModel.mhb;var P=this.xtabModel.db;var S={x:T.rowIndex,y:N.cellIndex};var R=window.getSelection();R.removeAllRanges();if(this.operation===D.none){I.call(this,T.rowIndex,N.cellIndex,Q,P);return ;}switch(this.operation){case D.moveMetricHeader:if((S.x<P.startRow)&&(S.y>=P.startColumn)){Q.set("startRow",S.x);Q.set("startColumn",P.startColumn);Q.set("endRow",S.x);Q.set("endColumn",-1);}else{if((S.y<P.startColumn)&&(S.x>=P.startRow)){Q.set("startRow",P.startRow);Q.set("startColumn",S.y);Q.set("endRow",-1);Q.set("endColumn",S.y);}}break;case D.moveData:P.set("startRow",S.x);P.set("startColumn",S.y);if(Q.startColumn>-1&&Q.startRow>-1&&Q.startRow===Q.endRow){if(Q.startRow>=S.x){Q.set("startRow",S.x-1);Q.set("endRow",S.x-1);}Q.set("startColumn",S.y);}else{if(Q.startColumn>-1&&Q.startRow>-1&&Q.startRow!==Q.endRow){if(Q.startColumn>=S.y){Q.set("startColumn",S.y-1);Q.set("endColumn",S.y-1);}Q.set("startRow",S.x);}else{this.raiseEvent({name:"NoMetricHeaderBlock"});}}break;case D.moveDataRow:P.set("startRow",S.x);if(Q.startColumn>-1&&Q.startRow>-1&&Q.startRow===Q.endRow){if(Q.startRow>=S.x){Q.set("startRow",S.x-1);Q.set("endRow",S.x-1);}}else{if(Q.startColumn>-1&&Q.startRow>-1&&Q.startRow!==Q.endRow){if(Q.startColumn>=S.y){Q.set("startColumn",S.y-1);Q.set("endColumn",S.y-1);}Q.set("startRow",S.x);}else{this.raiseEvent({name:"NoMetricHeaderBlock"});}}break;case D.moveDataColumn:P.set("startColumn",S.y);if(Q.startColumn>-1&&Q.startRow>-1&&Q.startRow===Q.endRow){if(Q.startRow>=S.x){Q.set("startRow",S.x-1);Q.set("endRow",S.x-1);}Q.set("startColumn",S.y);}else{if(Q.startColumn>-1&&Q.startRow>-1&&Q.startRow!==Q.endRow){if(Q.startColumn>=S.y){Q.set("startColumn",S.y-1);Q.set("endColumn",S.y-1);}}else{this.raiseEvent({name:"NoMetricHeaderBlock"});}}break;}this.draw();I.call(this,T.rowIndex,N.cellIndex,Q,P);}function K(){this.operation=D.none;this.draw();}function H(){var V=this.domNode.firstChild.children;var P,O;var R=this;var N=function(W){G.call(R,W);};var S=function(W){A.call(R,W);};var Q=function(W){K.call(R,W);};for(P=0;P<V.length;P++){var U=V[P];var T=U.children;for(O=0;O<T.length;O++){mstrmojo.dom.attachEvent(T[O],"mousemove",N);mstrmojo.dom.attachEvent(T[O],"mousedown",S);mstrmojo.dom.attachEvent(T[O],"mouseup",Q);}}}function L(P){var O=200;var Q=this.parent&&this.parent.previewNode;if(!Q){return ;}var N=O*P;if(Q.clientWidth>N){this.cssText="width:100%";}else{this.cssText="width:"+N+"px";}}mstrmojo.DI.DIXtabPreview=mstrmojo.declare(mstrmojo.Table,null,{scriptClass:"mstrmojo.DI.DIXtabPreview",preview:null,colHdrs:null,xtabModel:null,operation:D.none,cellCssClass:"di-xtab-cell",setDimensions:function J(Q,O){if(!this.colHdrs){return ;}var P=parseInt(O,10);var N=parseInt(Q,10)-5+"px";var R=200;var S=this.parent&&this.parent.previewNode;if(!S){return ;}this.parent.preGrid.set("height",N);if(P>this.colHdrs.length*R){this.domNode.style.width="100%";}else{this.domNode.style.width=this.colHdrs.length*R+"px";}},initXtab:function(P,N,O){this.preview=P;this.xtabModel=N;this.colHdrs=O;if(!N){return ;}this.populate();H.call(this);},populate:function(){var N=this.colHdrs.length;this.removeChildren();this.unrender();this.rows=49;this.cols=N;L.call(this,N);this.render();this.addContents();this.draw();},addContents:function B(){var R=this.domNode.firstChild.children;var Q=this.preview;var S,O,P,N;for(P=0;P<R.length;P++){S=R[P];O=S.children;for(N=0;N<O.length;N++){if(P===0){O[N].innerHTML=this.colHdrs[N];}else{if(!mstrmojo.string.isEmpty(Q[P-1][N])){O[N].innerHTML=Q[P-1][N].toString();}}}}},draw:function(){var R,Q,W,U;var O=this.xtabModel.mhb;var V=this.xtabModel.db;var X=this.domNode.firstChild.children;if(V.startRow>this.rows||V.startColumn>this.cols||(O.startRow===-1&&O.startColumn===-1&&V.startRow===-1&&V.startColumn===-1)){V.set("startRow",0);V.set("startColumn",0);V.set("endRow",-1);V.set("endColumn",-1);O.set("startRow",-1);O.set("startColumn",-1);O.set("endRow",-1);O.set("endColumn",-1);for(R=0;R<X.length;R++){W=X[R];U=W.children;for(Q=0;Q<U.length;Q++){U[Q].className="di-xtab-cell di-xtab-cell-data";}}return ;}var S=V.endColumn>-1?V.endColumn:this.cols-1;var P=O.endColumn>-1?O.endColumn:this.cols-1;var T=V.endRow>-1?V.endRow:this.rows-1;var N=O.endRow>-1?O.endRow:this.rows-1;for(R=0;R<X.length;R++){W=X[R];U=W.children;for(Q=0;Q<U.length;Q++){U[Q].className="";if(Q>=V.startColumn&&R>=V.startRow){U[Q].className="di-xtab-cell di-xtab-cell-data";if(R===V.startRow){U[Q].className+=" di-xtab-cell-data-top";if((Q-V.startColumn)%5===0){U[Q].className+=" handler";}}if(R===T){U[Q].className+=" di-xtab-cell-data-bottom";}if(Q===V.startColumn){U[Q].className+=" di-xtab-cell-data-left";if((R-V.startRow)%5===0){U[Q].className+=" handler";}}if(Q===S){U[Q].className+=" di-xtab-cell-data-right";}}else{if(Q<V.startColumn&&R<V.startRow){U[Q].className="di-xtab-cell di-xtab-cell-undefined";}else{if(O.startColumn===V.startColumn&&R===O.startRow&&Q>=O.startColumn){U[Q].className="di-xtab-cell di-xtab-cell-metricHeader di-xtab-cell-metricHeader-top di-xtab-cell-metricHeader-bottom";if(Q===O.startColumn){U[Q].className+=" di-xtab-cell-metricHeader-left header-first-one";}else{if(Q===P){U[Q].className+=" di-xtab-cell-metricHeader-right";}}}else{if(O.startRow===V.startRow&&Q===O.startColumn&&R>=O.startRow){U[Q].className="di-xtab-cell di-xtab-cell-metricHeader di-xtab-cell-metricHeader-left di-xtab-cell-metricHeader-right";if(R===O.startRow){U[Q].className+=" di-xtab-cell-metricHeader-top header-first-one";}else{if(R===N){U[Q].className+=" di-xtab-cell-metricHeader-bottom";}}}else{U[Q].className="di-xtab-cell di-xtab-cell-dataElement";}}}}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.Table");mstrmojo.requiresDescs(12652,12653,12654,12657,12885,12886,12887,12910);var B=mstrmojo.DI.DIConstants;mstrmojo.DI.DISourceIntro=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DISourceIntro",markupString:'<div id="{@id}" class="mstrmojo-di-source-intro {@cssClass}" ><div></div></div>',markupSlots:{introNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onNextButtonClick:function A(){mstrApp.getRootController().getOAuthSourceReports(this.sourceInfo.type,false);},children:[{scriptClass:"mstrmojo.Label",alias:"subTitle",slot:"introNode",cssClass:"mstrmojo-di-source-intro-title",bindings:{text:function(){return mstrmojo.desc(12885,"With ####, You can now connect to @@@@").replace("####",mstrApp.applicationName()).replace("@@@@",this.parent.sourceInfo.name);}}},{slot:"introNode",scriptClass:"mstrmojo.Image",cssClass:"image-di-source-intro di-image"},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-di-source-steps",slot:"introNode",rows:2,cols:3,children:[{slot:"0,0",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step1",bindings:{text:function(){return mstrmojo.desc(12886,"Sign in to ####").replace("####",this.parent.parent.sourceInfo.name);}}},{slot:"0,1",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step2",bindings:{text:function(){return this.parent.parent.sourceInfo.step2||mstrmojo.desc(12652,"Select Your File");}}},{slot:"0,2",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step3",bindings:{text:function(){return this.parent.parent.sourceInfo.step3||mstrmojo.desc(12653,"Create a Visualization");}}},{slot:"1,0",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step1-detail",bindings:{text:function(){return mstrmojo.desc(12654,"MicroStrategy does not store or request your credentials");}}},{slot:"1,1",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step2-detail",bindings:{text:function(){return mstrmojo.desc(12887,"Max File Size: #### MB").replace("####",mstrApp.diParams.UploadSizeLimit);},visible:function(){switch(this.parent.parent.sourceInfo.type){case B.sourceType.dropbox:case B.sourceType.googleDrive:case B.sourceType.salesforce:return true;default:return false;}}}},{slot:"1,2",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step3-detail",bindings:{text:function(){return mstrmojo.desc(12910,"Publish a cube and then create dashboards and documents.");}}}]},{slot:"introNode",scriptClass:"mstrmojo.Image",cssClass:"image-di-divider di-image"},{scriptClass:"mstrmojo.Label",alias:"introText1",bindings:{text:function(){return mstrmojo.desc(12657,"Click Continue below to get started!");}},cssClass:"mstrmojo-di-source-continue",slot:"introNode"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.css","mstrmojo.Button");mstrmojo.requiresDescs(1143,8338,9111,9113);var M=mstrmojo.css,G=mstrmojo.dom,I=mstrmojo.array,F="mstrmojo-qb-toolbarIcon",N="on",J="connectionview",C="viewtable",B="conditionview",L="refreshOption",O="help",E=" ";function K(R){return mstrmojo.hash.copy(R,{scriptClass:"mstrmojo.Button",onactiveChange:function Q(){M.toggleClass(this.domNode,N,this.active);},onclick:function P(){this.set("active",!this.active);if(this.cmd){mstrApp.getRootController()[this.cmd](this.active);}if(!this.persistSelection){var S=this;window.setTimeout(function(){S.set("active",false);},100);}}});}function A(R){var Q="mstr-qb-oAuthSourcelogout",P=document.getElementById(Q);if(!P){P=document.createElement("IFRAME");P.id=Q;document.body.appendChild(P);P.style.display="none";G.attachEvent(P,"load",function(S){var U={};var V={success:function T(W){mstrApp.getRootController().handleLogout();}};U.dbRoleID=mstrApp.dbrid;if(mstrApp.said){U.sourceAccountID=mstrApp.said;}mstrApp.getRootController().getDataService().signOutOAuthSource(V,U);});}P.src=R;}function D(){var R={scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-toolbar-bigquery",bindings:{visible:function(){return mstrApp.said&&mstrApp.dbrid;}},children:[{scriptClass:"mstrmojo.Label",postCreate:function Q(){if(this._super){this._super();}var S=mstrApp.userName;if(mstrApp.userEmail){S+=" ("+mstrApp.userEmail+")";}this.set("text",S);this.set("title",S);},cssClass:"mstrmojo-qb-toolbar-bigquery-username"},{scriptClass:"mstrmojo.Label",text:"|",cssClass:"splitText"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(8338,"sign out"),cssClass:"mstrmojo-qb-toolbar-bigquery-signout",onclick:function P(){A("https://www.google.com/accounts/logout");}}]};return R;}function H(){var Q=[{cmd:"toggleDatabaseView",active:true,iconClass:[F,J,N].join(E),title:mstrmojo.desc(9111,"Database View"),persistSelection:true},{cmd:"toggleDataPreview",active:false,iconClass:[F,C].join(E),title:mstrmojo.desc(9113,"Data Preview"),persistSelection:true,postBuildRendering:function P(){var R=mstrApp.getRootController(),S=this.id;R.attachEventListener("dataPreview",S,function(){this.set("active",true);});R.attachEventListener("reportModeChange",S,function(T){this.set("active",T.showPreview);});}},{cmd:"openHelp",iconClass:[F,O].join(E),title:mstrmojo.desc(1143,"help")}];I.forEach(Q,function(S,R,T){T[R]=K(S);});Q.push(D());return Q;}mstrmojo.qb.Toolbar=mstrmojo.declare(mstrmojo.Box,null,{children:H()});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Box","mstrmojo.ui._HasScroller","mstrmojo.ME.Enum");mstrmojo.requiresDescs();var M=mstrmojo.dom,B=mstrmojo.string,D=mstrmojo.Widget;var H=/\r?\n?----\r?\n?/;function F(N){var O=B.decodeHtmlString((N||{}).desc||"",true).split(H);return{desc:O[0],example:O.length===2?O[1]:""};}mstrmojo.ME.FunctionInfo=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionInfo",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="mstrmojo-FunctionInfo-container"><div class="mstrmojo-FunctionInfo-syntax"></div><div class="mstrmojo-FunctionInfo-desc"></div><div class="mstrmojo-FunctionInfo-eg"><span class="icon" t="icon"></span><span class="text"></span></div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},syntaxNode:function(){return this.domNode.firstChild.firstChild;},descNode:function(){return this.domNode.firstChild.childNodes[1];},egNode:function(){return this.domNode.firstChild.lastChild;},egTextNode:function(){return this.domNode.firstChild.lastChild.lastChild;}},markupMethods:{onvisibleChange:D.visibleMarkupMethod,onfoiChange:function(){this.syntaxNode.innerHTML=B.htmlAngles(this.syntax)||"";this.descNode.innerHTML=this.desc;this.egTextNode.innerHTML=this.example;this.egNode.style.display=this.example?"block":"none";this.updateScrollbars();}},foi:{},syntax:"",desc:"",example:"",init:function L(N){this._super(N);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-FunctionInfo");},setupScrollNodes:function C(){if(!mstrmojo.dom.ISIE8){this.scrollNode=this.containerNode;}},onfoiChange:function A(){this.set("syntax",this.getFunctionSyntax());this.set("desc",this.getDesc()+" "+this.getHelpTopic());this.set("example",this.getExample());},getFunctionSyntax:function K(R){var T=R||this.foi;if(!T){return"";}if(T.did<0){return T.n;}var Q=T.pars,S=T.pros,O=[],P,N;O.push(T.n);S=mstrmojo.hash.clone(S)||[];if(T.ios){S.push({n:"SortBy"});}if(T.sqt===5){S.push({n:"BreakBy"});}if(this.showFullSyntax){if(S.length>0){O.push("<");for(P=0,N=S.length;P<N;P++){if(mstrmojo.array.indexOf(mstrmojo.ME.Enum.NonExposableParams,S[P].n)===-1){O.push(S[P].n);O.push(", ");}}O.pop();O.push(">");}}O.push("(");for(P=0,N=Q.length;P<N;P++){O.push(Q[P].n);if(P!==(N-1)){O.push(", ");}}O.push(")");return O.join("");},getDesc:function E(){return F(this.foi).desc;},getExample:function J(){return F(this.foi).example;},getHelpTopic:function G(N){var O=N||this.foi;if(!O||O.did===mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(O.h);},useRichTooltip:true,showTooltip:function I(N,Q){var P=M.eventTarget(Q,N),O=this.foi;if(P&&P.getAttribute("t")==="icon"){this.richTooltip=this.getTooltip(O,P);if(this.richTooltip){this._super(N,Q);}}},getTooltip:function(Q,R){var O=M.position(R),P=R.egTip||"";var N={areaId:Q._renderIdx+"text",cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:P,top:O.y-75,left:O.x+O.w-30,enableHover:false};return N;}});mstrmojo.ME.FunctionInfo.getDescAndExample=F;}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.dom","mstrmojo.string","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(5,49,2918,3289,8042,9948,8042,13305,13306,13307,12187);var D=mstrmojo.array,E=mstrmojo.dom,F=mstrmojo.string;function C(){var G=[],H=mstrApp.diParams,J=(E.isIE8||E.isIE7)&&!(H.flashVI||H.smartVI),I=mstrmojo.DI.DIExitOptions.pageRedirect;if(H.CreateAnalysis===1){G.push({hot:true,icon:"newvi",n:mstrmojo.desc(8042,"Create Dashboard"),desc:mstrmojo.desc(9948,"Explore data visually and discover trends, patterns, relationships and outliers"),redirect:J?I.unsupportedBrowser:I.analysis});}if(H.CreateReportServices===1){G.push({icon:"newdoc",n:mstrmojo.desc(2918,"Create Document"),desc:mstrmojo.desc(13858,"Create an enterprise report, scorecard, or dashboard"),redirect:I.doc});}if(H.CreateViewReport===1&&mstrApp.getRootController().model.isDirectDataAccess===false){G.push({icon:"newreport",n:mstrmojo.desc(5,"Create Report"),desc:mstrmojo.desc(13859,"Create a grid or graph report"),redirect:I.report});}return G;}mstrmojo.DI.DIExitOptions=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIExitOptions",cssClass:"mstrmojo-di-DIExitOptions",redirectToPage:function B(G){var H=mstrmojo.DI.DIExitOptions;if(G===H.pageRedirect.unsupportedBrowser){mstrmojo.alert(mstrmojo.desc(12187,"Unsupported browser."));}else{mstrApp.redirectToPage(H.getRedirectParams(G,this.model.cubeID,this.model.isDirectDataAccess));}},onCancelButtonClick:function(){mstrApp.getRootController().exitApplication();return true;},preBuildRendering:function(){var I=[],H,J,G=["mstrmojo-di-button","mstrmojo-WebButton"];if(this._super){this._super();}H=C();G.push("cnt"+H.length);D.forEach(H,function(L,K){J=new mstrmojo.Button({cssClass:K===0?G.concat(["hot",L.icon]).join(" "):G.concat(L.icon).join(" "),text:L.n,useRichTooltip:true,updateTooltipConfig:function(){var N=this,M=E.position(N.domNode);N.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:L.desc,top:Math.max(M.y+40,0),left:Math.max(M.x+M.w/2,0),posType:mstrmojo.tooltip.POS_TOPCENTER};},redirect:L.redirect,onclick:function(){this.parent.redirectToPage(this.redirect);}});I.push(J);});this.addChildren(I);},children:[{scriptClass:"mstrmojo.Label",cssClass:"title-one",useRichTooltip:true,allowHTML:true,updateTooltipConfig:function(){var G;if(this.title){G=E.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(G.y,0),left:Math.max(G.x+G.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});}},ontextChange:function(){var H=this;var G=function(){var O=H.parent.model.isDirectDataAccess?mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###."):mstrmojo.desc(13305,"Success! Your data was imported as ###."),K=H.domNode,Q=H.parent.model.path,J=H.parent.model.cubeName,P,M,N,L,I;if(!K){return ;}P=K.scrollWidth>K.clientWidth;M=Q;L=I=Q.indexOf(J);while(P&&(L>=0||I<=Q.length)){if(L>0){L--;}else{I++;}N=L>0?[Q.substr(0,L)]:[];N.push("...");if(I<Q.length){N.push(Q.substr(I));}M=O.replace("###","<b>"+F.encodeHtmlString(N.join(""),true,true)+"</b>");K.innerHTML=M;P=K.scrollWidth>K.clientWidth;}};if(H.domNode){G();}else{window.setTimeout(G,0);}},preBuildRendering:function(){var H=mstrmojo.desc(13305,"Success! Your data was imported as ###."),G;if(this.parent.model.isDirectDataAccess){H=mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###.");}G=H.replace("###","<b>"+F.encodeHtmlString(this.parent.model.path,true,true)+"</b>");this.set("text",G);this.set("title",G);}},{scriptClass:"mstrmojo.Label",cssClass:"title-two",text:mstrmojo.desc(13307,"What would you like to do now?")}]});mstrmojo.DI.DIExitOptions.pageRedirect={exit:0,report:1,doc:2,analysis:3,flashVI:4,historyList:5,existingAnalysis:6,unsupportedBrowser:7};mstrmojo.DI.DIExitOptions.getRedirectParams=function A(M,J,I,H){var L={},K=mstrmojo.DI.DIExitOptions.pageRedirect,G=mstrApp.name||microstrategy.servletName;switch(M){case K.analysis:if(mstrApp.diParams.flashVI){L={evt:"3104",src:G+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:"16",rwViewMode:"2048"};}else{L={evt:"3185",src:mstrApp.name+".3185",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:64};if(I){L.rwCreateFlags|=128;}if(mstrApp.cubeSaveFolderId){L.saveFolderId=mstrApp.cubeSaveFolderId;}}break;case K.doc:L={evt:"3104",src:mstrApp.name+".3104",executionMode:"2",rwDesignMode:"1",objectType:"3",objectID:J,rwCreateFlags:0};if(I){L.rwCreateFlags|=128;}if(mstrApp.cubeSaveFolderId){L.saveFolderId=mstrApp.cubeSaveFolderId;}break;case K.flashVI:L={evt:"3104",src:G+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:16,rwViewMode:"2048"};if(I){L.rwCreateFlags|=128;}break;case K.report:L={iframe:"true",evt:["5005","17004"],src:[mstrApp.name+".create.5005",mstrApp.name+".create.ObjectExplorer.17004"],selectedObjectID:J,defaultevtlist:"17004"};break;case K.exit:L={evt:"3010"};break;case K.historyList:L={evt:"3018",src:G+".3018"};break;case K.existingAnalysis:L={evt:"3140",src:G+".3140",documentID:H};break;}return L;};}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.css");var A=mstrmojo.css;var I=mstrmojo.dom;function B(K){var M=document.createElement("div"),L=M.style,J=K.domNode;M.className="mstrmojo-qb-VSplitPanel-avatar";L.width=J.clientWidth+"px";J.appendChild(M);K.avatar=M;return M;}mstrmojo.qb.VSplitPanel=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.VSplitPanel",draggable:true,dropZone:false,width:0,topP:40,topItemVisible:true,bottomItemVisible:true,borderoffset:0,marginSpan:20,minSpan:80,markupString:'<div id="{@id}" class="mstrmojo-VSplitPanel {@cssClass}" style="{@cssText}" mstrAttach:mouseup,mousemove ><div></div><div style="padding-top:{@marginSpan}px;"><div class="mstrmojo-qb-VSplitPanel-resizeHandle" style="width:{@width};height:{@marginSpan}px;margin-top:-{@marginSpan}px"></div></div></div>',markupSlots:{topItem:function(){return this.domNode.children[0];},bottomItem:function(){return this.domNode.children[1];}},children:[{scripClass:"mstrmojo.Box",slot:"topItem"},{scripClass:"mstrmojo.Box",slot:"bottomItem"}],getDragData:function H(J){var K=J.src,M=K.node;if(M.className&&M.className.indexOf("mstrmojo-qb-VSplitPanel-resizeHandle")>=0){var L=I.position(this.domNode);return{node:M,x:L.x,y:L.y,h:L.h,w:L.w};}else{if(this._super){return this.dropZone&&this._super(J);}}return null;},allowDrop:function E(J){var K=J.src,L=K&&K.data;if(L&&L.node){return true;}else{return this.dropZone;}},ondragmove:function F(J){var L=J.src,N=L&&L.data;if(N&&N.node){var K=J.tgt,M=this.avatar;if(M){M.style.top=Math.min(Math.max(N.y+this.minSpan,K.pos.y),N.y+N.h-this.minSpan)+"px";}}},isDragValid:function G(J){var K=J.src,L=K&&K.data;return !!(L&&L.node);},ondragstart:function C(J){var K=J.src,M=K&&K.data;var L=this.avatar||B(this);this.ownAvatar=true;L.style.top=Math.max(M.y,K.pos.y)+"px";L.style.left=M.x+"px";L.style.display="block";L.style.zIndex="9999";L.style.width=M.w+"px";},ondragend:function D(J){var M=J.src,O=M&&M.data;if(O&&O.node){var N=this.avatar;if(N){N.style.display="none";var K=parseInt(N.style.top)-O.y,L=this.domNode.clientHeight;this.topP=K*100/L;this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};this.doLayout();}this.ownAvatar=false;}else{if(this._super){this._super(J);}}},layoutConfig:{w:{topItem:"100%",bottomItem:"100%"},h:{topItem:"40%",bottomItem:"60%"}},afterLayout:function(){if(this.domNode){var K=this.domNode.children[1].children[0].style;if(this.topItemVisible&&this.bottomItemVisible){K.display="block";this.children[0].set("visible",true);this.children[1].set("visible",true);K.width=this.width;var J=parseInt(this.children[0].height);this.children[0].set("height",J+"px");this.bottomItem.style.height=parseInt(this.height)-J-this.marginSpan+"px";this.children[1].set("height",this.bottomItem.style.height);}else{K.display="none";if(this.topItemVisible){this.children[0].set("width",this.width);this.children[1].set("visible",false);}else{this.children[1].set("width",this.width);this.children[0].set("visible",false);}}}},_set_topItemVisible:function(L,J){if(this.topItemVisible!=J){this.topItemVisible=J;if(J){this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};if(this.bottomItem){var K=this.bottomItem;K.style["padding-top"]=this.marginSpan+"px";}}else{this.layoutConfig.h={topItem:"0%",bottomItem:"100%"};if(this.bottomItem){var K=this.bottomItem.parentNode;K.style["padding-top"]="0px";}}this.doLayout();}},_set_bottomItemVisible:function(K,J){if(this.bottomItemVisible!=J){this.bottomItemVisible=J;if(J){this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};}else{this.layoutConfig.h={topItem:"100%",bottomItem:"0%"};}this.doLayout();}},postBuildRendering:function(){if(this._super){this._super();}this.width=this.domNode.clientWidth+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom");var C=mstrmojo.dom,A=mstrmojo.css;mstrmojo.DI.DISourceItemAdmin=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DISourceItemAdmin",icon:"",n:"",desc:"",mode:"add",tooltipOpenDelay:0,useRichTooltip:true,markupString:'<div id="{@id}" class="mstrmojo-di-source-item mstrmojo-di-source-item-admin {@icon} {@mode}" mstrAttach:click><div class="mstrmojo-di-source-name"><span class="mstrmojo-di-source-name-span">{@n}</span></div><div class="mstrmojo-di-source-below"><div class="mstrmojo-di-Icons medium-{@icon}"></div><div class="mstrmojo-di-source-desc">{@desc}</div><div class="mstrmojo-di-source-cover {@mode}"><div class="mstrmojo-di-source-cover-img {@mode}" /></div></div></div>',markupSlots:{nameNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.children[1].children[0];},descNode:function(){return this.domNode.children[1].children[1];},coverNode:function(){return this.domNode.children[1].children[2];}},postBuildRendering:function B(){if(this._super){this._super();}this.set("enabled",true);if(!this.enabled){mstrmojo.css.addClass(this.domNode,"disabled");}else{mstrmojo.css.addClass(this.domNode,"enabled");}},onmodeChange:function(D){var F=D.valueWas,E=D.value;if(this.hasRendered){A.toggleClass(this.domNode,F,false);A.toggleClass(this.coverNode,F,false);A.toggleClass(this.domNode,E,true);A.toggleClass(this.coverNode,E,true);}},onclick:function(D){var E=D.getTarget(),F=this.mode;if(F==="add"&&C.contains(this.coverNode,E)){this.raiseEvent({name:"selectChange",type:"add"});}else{if(F==="remove"&&E===this.coverNode.children[0]){this.raiseEvent({name:"selectChange",type:"remove"});}}},updateTooltipConfig:function(){var D=C.position(this.domNode);if(this.title){this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-V",top:Math.max(D.y,0),left:Math.max(D.x+D.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui._HasScroller","mstrmojo.css");var B=mstrmojo.css;mstrmojo.ui.ColumnContainer=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ColumnContainer",markupString:'<div id="{@id}" class="mstrmojo-ui-ColumnContainer {@cssClass}"><div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},scrollNode:function(){return this.domNode.firstChild;}},markupMethods:{onnextChange:function A(){B.toggleClass(this.domNode,"hasNext",!!this.next);}},active:false,next:null,idx:undefined,updateColumnContainer:function D(){var E=this.next;if(E){E.updateColumnContainer();}},onactiveChange:function C(){B.toggleClass(this.domNode,"active",this.active);var E=this.next;if(E){E.updateColumnContainer();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box");var B=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox",cssClass:"mstrmojo-wh-DBRoleSettingGroupBox",groupbox:undefined,isRequired:false,isGroupSetting:true,enabled:true,onenabledChange:function E(){var F=this.enabled;B.forEach(this.children,function(G){G.set("enabled",F);});},getValue:function A(){return"";},setValue:function D(F){},isValid:function C(){return{val:true,msg:""};},children:[{scriptClass:"mstrmojo.Box",alias:"groupbox",children:[]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._HasLayout");mstrmojo.ui.LayoutBox=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.LayoutBox",layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"},xt:true}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._ListSelections","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var H=mstrmojo.dom,c=mstrmojo.css,R=mstrmojo.hash,I=mstrmojo.all,K="px";function C(g){if(this.dragging){return ;}this._moveCnt++;if(this._moveCnt>this.mousemoveBuffer){var f=document.body;H.detachEvent(f,"mousemove",this._mousemoveCallback);H.detachEvent(f,"mouseup",this._cancelCallback);this.initDrag(g);}}function N(h){var f=document.body;H.detachEvent(f,"mousemove",this._mousemoveCallback);H.detachEvent(f,"mouseup",this._cancelCallback);var g=this.afterDragCancel;if(g){g.call(this.target,h);}}function d(h){H.preventDefault(window,h);if(this.dragging){return true;}var f=this.target.id,g=document.body;if(!this._mousemoveCallback){this._mousemoveCallback=function(j){C.call(I[f].dnd,j);return true;};}this._moveCnt=0;this.startE=R.copy(h);H.attachEvent(g,"mousemove",this._mousemoveCallback);if(!this._cancelCallback){this._cancelCallback=function(j){N.call(I[f].dnd,j);return true;};}H.attachEvent(g,"mouseup",this._cancelCallback);return false;}function B(g){var f=this.duringDrag;if(f){f.call(this.target,g);}return true;}function A(h){this.dragging=false;var f=document.body;H.detachEvent(f,"mousemove",this._dragCallback);H.detachEvent(f,"mouseup",this._dragEndCallback);var g=this.afterDragEnd;if(g){g.call(this.target,h);}return true;}function M(){if(this._mousemoveCallback){H.detachEvent(document.body,"mousemove",this._mousemoveCallback);delete this._mousemoveCallback;}if(this._cancelCallback){H.detachEvent(document.body,"mouseup",this._cancelCallback);delete this._cancelCallback;}if(this._dragCallback){H.detachEvent(document.body,"mousemove",this._dragCallback);delete this._dragCallback;}if(this._dragEndCallback){H.detachEvent(document.body,"mouseup",this._dragEndCallback);delete this._dragEndCallback;}}mstrmojo.DnDComponent=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.DnDComponent",isDragging:false,initD:null,startE:null,afterDragStart:null,duringDrag:null,afterDragEnd:null,target:null,mousemoveBuffer:1,init:function P(e){R.copy(e,this);},initDrag:function X(k){this.dragging=true;var g=this.target.id,j=document.body;var l=this._dragCallback;if(!l){l=this._dragCallback=function(m){return B.call(I[g].dnd,m);};}H.attachEvent(j,"mousemove",l);var f=this._dragEndCallback;if(!f){f=this._dragEndCallback=function(m){return A.call(I[g].dnd,m);};}H.attachEvent(j,"mouseup",f);var h=this.afterDragStart;if(h){h.call(this.target,k);}this._dragCallback(k);}});function F(e){this.getUnit=function f(){var g=e.items.length;return g>1?e._effLen/(g-1):1;};this.calcMinMax=function(h,g){var j=Math.round((h/e.unit+g/e.unit)/2);return{min:j,max:j};};this.preUpdateThumb=function(){e.start=Math.min(e.min*e.unit,e._effLen)+K;e.sdCssText=e.orCfg.posCssP+":"+e.start+";";};this.updateThumb=function(){e.containerNode.style[e.orCfg.posCssP]=e.start=Math.min(Math.round(e.min*e.unit),e._effLen)+K;};return this;}function T(e){this.getUnit=function(){return e._effLen/e.items.length;};this.calcMinMax=function(h,g){return{min:Math.floor(h/e.unit+0.5),max:Math.floor(g/e.unit-0.5)};};function f(){var g=e.min,j=e.unit;var k=e.start=(g*j)+K;var h=e.length=Math.max(Math.round((e.max-g+1)*j-e.gap),0)+K;return{st:k,len:h};}this.preUpdateThumb=function(){var h=e.orCfg,g=f();e.sdCssText=h.posCssP+":"+g.st+";"+h.lenCssP+":"+g.len+";";};this.updateThumb=function(){var h=e.orCfg,g=f(),j=e.containerNode.style;j[h.posCssP]=g.st;j[h.lenCssP]=g.len;};return this;}var b="<span>{@content}</span>";mstrmojo.Slider=mstrmojo.declare(mstrmojo.Container,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.Slider",markupString:'<div id="{@id}" class="mstrmojo-Slider {@cssClass} {@clsType} {@clsOrientation}" style="{@cssText}" ><div class="cont"><div class="bk" style="{@bkCssText}"></div><div class="sdc" style="position:absolute;{@sdcCssText}" mstrAttach:mouseout><div class="sd" style="{@sdCssText}"><div class="t1"></div><div class="t2"></div><div class="t3"></div></div></div></div></div>',sdCssText:"",cssClass:"sc",clsType:"sc2",clsOrientation:"sc-v",orCfg:null,typeHelper:null,_tooltip_pos:"TL",useRichTooltip:true,init:function W(e){this._super(e);if(e.isHoriz){this.orCfg={posCssP:"left",marginCssP:"marginLeft",lenCssP:"width",lenP:"clientWidth",opPosCssP:"top",thickP:"clientHeight",offsetP:"x"};this.clsOrientation=" sc-h";this._tooltip_pos=mstrmojo.tooltip.POS_BOTTOMLEFT;}else{this.orCfg={posCssP:"top",marginCssP:"marginTop",lenCssP:"height",lenP:"clientHeight",opPosCssP:"left",thickP:"clientWidth",offsetP:"y"};this._tooltip_pos=mstrmojo.tooltip.POS_TOPRIGHT;this.titleHeight=(e.docSelector.fmts.ttl&&e.docSelector.fmts.ttl.height)?parseInt(e.docSelector.fmts.ttl.height,10):0;}this._exRoom=this.thumbWidth;if(this.multiSelect){this._exRoom*=2;}if(e.multiSelect){this.typeHelper=new T(this);}else{this.clsType="sc1";this.typeHelper=new F(this);}},markupSlots:{dndNode:function(){return this.domNode.firstChild;},bgNode:function(){return this.domNode.firstChild.firstChild;},sdcNode:function(){return this.domNode.firstChild.lastChild;},containerNode:function(){return this.domNode.firstChild.lastChild.firstChild;},frontNode:function(){return this.domNode.firstChild.lastChild.firstChild.firstChild;},thumbNode:function(){return this.domNode.firstChild.lastChild.firstChild.childNodes[1];},endNode:function(){return this.domNode.firstChild.lastChild.firstChild.lastChild;},tooltipNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:function(){this.synchronizeSlider();}},start:"50px",length:"30px",min:0,max:0,gap:1,ghost:null,thumbWidth:11,cssBkBW:1,dndNode:null,synchronizeSlider:function O(){var l=this.orCfg,k=l.lenCssP,g=this[k],e=parseInt(g,10),p=this.hasRendered,n=this.titleHeight||0;var h=this._effLen=isNaN(e)?0:(e-this._exRoom-n);if(g){var o={};o[k]=Math.max(parseInt(g,10)-(2*this.cssBkBW),0)-n+K;var j={};j[k]=h+K;j[l.posCssP]=Math.round(this._exRoom/2)+K;j[l.opPosCssP]="0"+K;if(p){R.copy(o,this.bgNode.style);R.copy(j,this.sdcNode.style);}else{this.bkCssText=c.getCssTextFromObj(o);this.sdcCssText=c.getCssTextFromObj(j);}}var q=this.selectedIndices;if(!R.isEmpty(q)){this.min=this.items.length-1;this.max=0;var m;for(m in q){if(q[m]){this.min=Math.min(this.min,m);this.max=Math.max(this.max,m);}}}var f=this.typeHelper;this.unit=f.getUnit();if(p){f.updateThumb();}else{f.preUpdateThumb();}},preBuildRendering:function E(){this.synchronizeSlider();},postBuildRendering:function Z(){this._super();if(this.items.length>1){var e=this.dnd=new mstrmojo.DnDComponent({target:this});var f=this.id;this.__mouseDownEvt=function(g){H.stopPropogation(window,g);d.call(I[f].dnd,g);return true;};H.attachEvent(this.dndNode,"mousedown",this.__mouseDownEvt);e.afterDragStart=this.initDrag;e.duringDrag=this.ondrag;e.afterDragEnd=this.ondrop;e.afterDragCancel=this.cancelDrag;}},initDrag:function X(l,f){f=f||window;var k=this.configureGhost(true),g=this.orCfg,j=this.dnd,h=j.startE;j.initD={tP:parseInt(this.start,10),sL:this._effLen,contL:k.containerNode[g.lenP],offset:H.getMousePosition(h,f)[g.offsetP],td:H.eventTarget(f,h)};},configureGhost:function V(f){var h=this.ghost;if(!h){var k=this.containerNode.cloneNode(true),j=k.childNodes;c.addClass(k,"gh");k.style.display="none";h=this.ghost={containerNode:k,frontNode:j[0],thumbNode:j[1],endNode:j[2]};this.sdcNode.appendChild(k);}var g=this.ghost.containerNode.style,e=this.orCfg;R.copyProps([e.posCssP,e.lenCssP],this.containerNode.style,g);if(f){g.display="block";}return h;},ondrag:function J(o,n){n=n||window;var p=this.dnd.initD,k=this.ghost.containerNode,w,h,f,m=this.min,q=this.max,l=this.orCfg,g=l.lenCssP,u=l.posCssP;var t=H.getMousePosition(o,n)[l.offsetP]-p.offset;switch(p.td){case this.thumbNode:w=Math.max(Math.min(p.tP+t,p.sL-p.contL),0);h=w+p.contL;k.style[u]=w+K;var j=this.typeHelper.calcMinMax(w,h);m=j.min;q=j.max;break;case this.frontNode:w=Math.max(Math.min(p.tP+t,p.tP+p.contL),0);f=Math.max(Math.min(p.contL-t,p.tP+p.contL),0);k.style[u]=w+K;k.style[g]=f+K;m=Math.min(Math.floor(w/this.unit+0.5),this.max);break;case this.endNode:f=Math.max(Math.min(p.contL+t,p.sL-p.tP),0);h=p.tP+f;k.style[g]=f+K;q=Math.max(Math.floor(h/this.unit-0.5),this.min);break;default:return ;}if(m!==this.min||q!==this.max){this.min=m;this.max=q;this.typeHelper.updateThumb();}this._updateTooltip();},ondrop:function a(){this.typeHelper.updateThumb();var j=this.ghost;if(j){j.containerNode.style.display="none";}this.hideTooltip();var k=this.dnd&&this.dnd.initD;if(this.makeSelection&&k){this.makeSelection({selItem:k.td});}var e=this.items;if(e&&e.length){var g=[],f;for(f=this.min;f<=this.max;f++){var h=e[f];if(h){g.push(f);}}this.select(g);}this.dnd.initD=null;},cancelDrag:function U(g,f){if(this.makeSelection){this.makeSelection({selItem:H.eventTarget(f||window,this.dnd.startE)});}},showTooltip:function G(g,f){this.configureGhost(false);this._updateTooltip(g,f);this._super(g,f);},hideTooltip:function L(g,f){if(this.dnd&&this.dnd.dragging){return ;}this._super(g,f);},_updateTooltip:function S(){var m=this.orCfg,n={contentNodeCssClass:"sc-tooltip",refNode:this.domNode,posType:this._tooltip_pos},f=(this.ghost)?this.ghost.containerNode:this.containerNode;n[m.opPosCssP]=0;n[m.posCssP]=f.style[m.posCssP];n.content="";var k=this.items,h=k.length;if(k&&h){var e=(k[this.min]||k[0]),g=this.getItemTooltip(e),j=g;if(this.min!==this.max){var l=(k[this.max]||k[h-1]);j=mstrmojo.desc(146,"From:")+" '"+g+"' "+mstrmojo.desc(147,"To:")+" '"+this.getItemTooltip(l)+"'";}n.content=b.replace(/\{@content\}/g,j);}this.set("richTooltip",n);},getItemTooltip:function D(e){var f=e?e.n:"";return"'"+(f.length>20?f.slice(0,20)+"...":f)+"'";},unrender:function Y(e){this.ghost=null;this.hideTooltip();this.min=0;this.max=(this.items&&this.items.length-1)||0;var f=this.dndNode,g=this.__mouseDownEvt;if(g&&f){H.detachEvent(f,"mousedown",g);}M.call(this);this._super(e);},onselectionChange:function Q(){var e=this.selectedIndices,f=R.isEmpty(e);if(e){this.set("max",f?this.items.length-1:R.max(e,false,true));this.set("min",f?0:R.min(e,false,true));if(this.typeHelper){this.typeHelper.updateThumb();}}if(this.onchange){this.onchange();}}});mstrmojo.Slider.SINGLE_HANDLE_WIDTH=11;mstrmojo.Slider.SCROLLHANDLEWIDTH=11;}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.tooltip");var E=mstrmojo.dom,D=mstrmojo.string,F=mstrmojo.hash,H=mstrmojo.array,C=mstrmojo.tooltip;mstrmojo.ui._HasListTooltip=mstrmojo.provide("mstrmojo.ui._HasListTooltip",{_mixinName:"mstrmojo.ui._HasListTooltip",tooltipOrientation:"horizontal",tooltipOffset:8,tooltipMarkup:'<div class="content" style="{@style}">{@c}</div>',tooltipCss:{},tooltipContrast:false,getTooltipText:function A(I){return I&&(I.ttp||I.n);},showTooltip:function G(W,M){var O=this;if(!O.hasOpenTooltip&&!(O._lastOpened&&O._lastOpened.visible)){var b=E.eventTarget(M,W),X=O.getItemFromTarget(b),R=O.getItemNodeFromTarget(b),d=O.getTooltipText(X),N=O.tooltipCss;if(!d){return ;}var c=E.position(R),V,P,L,T="",U=O.tooltipOffset;if(this.tooltipOrientation==="vertical"){V=c.x+c.w/2;L=C.POS_TOPCENTER;P=c.y+c.h+U;O.tooltipCss=F.copy({cssClass:"vi-regular vi-tooltip-A A-center"},N);}else{var K=E.windowDim(),S=40,Y=c.x+c.w+U,J=c.x-U,a=J-S,I=K.w-(Y+S),Z="vi-regular vi-tooltip-",Q;P=c.y;if(I>=a){V=Y;Q=I;L=C.POS_TOPLEFT;N.cssClass=Z+"C  "+N.rightCssClass;}else{V=J;Q=a;L=C.POS_TOPRIGHT;N.cssClass=Z+"D  "+N.leftCssClass;}T="max-width: "+Q+"px;";}if(O.tooltipContrast){N.cssClass=N.cssClass+" contrast";}if(N&&N.getItemCssClass){N.cssClass=H.filter([N.cssClass,N.getItemCssClass(X)],function(e){return !!e;}).join(" ");}O.richTooltip=F.copy(O.tooltipCss,{content:D.apply(O.tooltipMarkup,{c:d,style:T}),top:P,left:V,posType:L});O.richTooltip.keepArrowXPos=!!O.keepArrowXPos;O.richTooltip.keepArrowYPos=!!O.keepArrowYPos;this._super(W,M);}},onclick:function B(I){var J=this;window.setTimeout(function(){if(J.hasOpenTooltip){J.hideTooltip();}window.clearTimeout(J._tooltipTimeOut);},0);this._super(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.hash","mstrmojo.string");mstrmojo.requiresDescs(11038,11935,11936,11937,11856,11938,13138,13230,13260,14633,14636);var C=mstrmojo.hash.copy,P=mstrmojo.css,J=mstrmojo.dom,N=mstrmojo.array,E=mstrmojo.string,Q=function Q(V,T){if(!V){return ;}var S=T&&T.length||0,U;for(U=S;U>0;U--){V=V.replace(new Array(U+2).join("#"),T[U-1]);}return V;},L=function L(T){if(!T){return ;}var Z=this,V=J.position(T.refNode||Z.refNode),Y=J.position(Z.domNode),X=T.position||R.RIGHT,U=0,a=0,S=9+(T.margin!==undefined?T.margin:0),W=" ";switch(X){case R.TOP:a=-Y.h-S;W+="t";break;case R.BOTTOM:a=V.h+S;W+="b";break;case R.LEFT:U=-Y.w-S;W+="l";break;case R.RIGHT:U=V.w+S;W+="r";break;}mstrmojo.hash.forEach(C(T,{left:U,top:a,contentNodeCssClass:W,visible:false}),function(b,c){this[c]=b;},this);this.set("visible",T.invalid);},A=function A(S){var W=this,U,V=S.errorCode,X=S.errorMsg,T=S.args,Y=mstrmojo.vi.ui.rw.selectors.EnumWarningMessages;if(S.invalid){U={content:V!==null?(W.generateContentHTML(Q(Y[V],T))||Y["*"]):X};}return U;};mstrmojo.vi.ui.rw.selectors.EnumWarningMessages=C(mstrmojo.locales.validation,{"*":mstrmojo.desc(11038,"Invalid"),invalidValueVIWarning:mstrmojo.desc(11935,"Invalid characters"),emptyValueVIWarning:mstrmojo.desc(11936,"Please enter a number"),notIntegerVIWarning:mstrmojo.desc(11937,"Please enter an integer"),outOfRangeVIWarning:mstrmojo.desc(11856,"Please enter value between ## and ###."),noMultiSelectionVIWaring:mstrmojo.desc(11938,"This selector does not support multiple selections."),continuousSelectionVIWaring:mstrmojo.desc(13138,"This selector does not support non-continuous selections."),bigDecimalMetricSliderVIWaring:mstrmojo.desc(13230,"Cannot qualify on big decimal value. Please change qualification type to Rank"),unableDisplaySelectionVIWarning:mstrmojo.desc(13260,"Filter cannot display actual selections."),imageSizeExceedLimitVIWarning:mstrmojo.desc(14633,"Cannot embed an image larger than ##MB. Your image is still ###MB after compression. Enter a URL to the image instead."),imageFileTypeNotSupportedVIWarning:mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."),imageOverSizeNoCompessionVIWarning:mstrmojo.desc(14665,"Cannot embed an image larger than ##MB. Enter a URL to the image instead.")});mstrmojo.vi.ui.rw.selectors.EnumWarningPosition={TOP:1,BOTTOM:2,LEFT:3,RIGHT:4};var R=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition;mstrmojo.vi.ui.rw.selectors._HasWarningMessage=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._HasWarningMessage",{_mixinName:"mstrmojo.vi.ui.rw.selectors._HasWarningMessage",warningSlotName:"warning",showWarning:function G(U){var Y=this,a=Y.warningSlotName,c=Y[a],S=U&&U.lasting||6000,X=U.refNode||this.domNode,T=U.highlight!==false,b=U.closeOnClick===false?false:true,Z;if(!c){c=new mstrmojo.Tooltip({refNode:X,highlight:T,closeOnClick:b,updatePopupConfig:null,cssClass:"vi-warning vi-tooltip-V"});Y.addDisposable(c);Y[a]=c;Z=Y.closeOnClick=Y.getCloseOnClickListener();J.attachEvent(document.body,"click",Z);}var W=U.position||R.TOP,V="vi-warning vi-tooltip-";switch(W){case R.TOP:c.cssClass=V+"V";break;case R.BOTTOM:c.cssClass=V+"A";break;case R.LEFT:c.cssClass=V+"D";break;case R.RIGHT:c.cssClass=V+"C";break;}c.open(Y,A.call(Y,U));this.adjustPosition(U);if(T){P.toggleClass(c.refNode,"mstrmojo-Warning",true);}window.clearTimeout(Y._warningTimeOut);Y._warningTimeOut=window.setTimeout(function(){Y.hideWarning();},S);},hideWarning:function H(){var T=this,S=T[T.warningSlotName];if(S&&S.visible&&S.close){if(S.highlight){P.toggleClass(S.refNode,"mstrmojo-Warning",false);}S.close();window.clearTimeout(T._warningTimeOut);delete T._warningTimeOut;}},getCloseOnClickListener:function I(){var S=this;return function(){var T=S[S.warningSlotName];if(T.closeOnClick){S.hideWarning();}};},adjustPosition:function M(S){var T=this;L.call(T[T.warningSlotName],S);},generateContentHTML:function D(S){return E.encodeHtmlString(S,true);},bindWarningHandler:function F(){N.forEach(arguments,function S(U){if(!U||!U.attachEventListener){return ;}var V=U._validationEventListener,T;if(V){U.detachEventListener(V);delete U._validationEventListener;}T=this.getValidationEvtListener();if(T){U._validationEventListener=U.attachEventListener("validationChange",this.id,T);}},this);},getValidationEvtListener:function B(){var T=this;return function S(U){var V=U.value;T[(V&&V.invalid?"show":"hide")+"Warning"](V);};},unrender:function K(S){var T=this[this.warningSlotName];if(T){T.unrender();}this._super(S);},destroy:function O(S){J.detachEvent(document.body,"click",this.closeOnClick);return this._super(S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupWidget","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.css");mstrmojo.ui.menus.MenuPopup=mstrmojo.declare(mstrmojo.ui.PopupWidget,[mstrmojo.ui.menus._IsMenuPopup],{scriptClass:"mstrmojo.ui.menus.MenuPopup",popupConfig:null,init:function B(D){this._super(D);var C=this.popupConfig;if(!C.contents){throw new Error("Cannot open popup without contents.");}this.cssClass=C.cssClass||"";this.addChildren(C.contents);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-MenuPopup");},shouldPropagateLockHover:function A(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.MenuPopup");mstrmojo.ui.menus.PopupConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.PopupConfig",cssClass:"",contents:null,clear:function A(){this._super();this.contents=null;},close:function C(){([].concat(this.contents)[0]).parent.closeAllMenus();},newInstance:function B(){return new mstrmojo.ui.menus.MenuPopup({popupConfig:this});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.MenuPopup","mstrmojo.Button","mstrmojo.dom");mstrmojo.requiresDescs(1442,2140);var E=mstrmojo.dom,G=mstrmojo.array;function B(I,K){var H=2140,M="Cancel",L="this.parent.popupConfig."+(I?"ok":"cancel"),J=K&&K[(I?"ok":"cancel")+"BtnText"];if(I){H=1442;M="Ok";}return mstrmojo.Button.newWebButton(J||mstrmojo.desc(H,M),function(O){var P=this.parent,N=P.popupConfig;P.closeAllMenus();N["fn"+M](N.data,P);E.stopPropogation(O.hWin,O.e);},I,{slot:"btnNode",bindings:{enabled:L+"Enabled",visible:L+"Visible"},cssDisplay:"inline-block"});}mstrmojo.ui.menus.MenuEditor=mstrmojo.declare(mstrmojo.ui.menus.MenuPopup,null,{scriptClass:"mstrmojo.ui.menus.MenuEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-MenuEditor {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="me-content"></div><div class="me-buttons"></div><div class="me-bottom"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;},btnNode:function D(){return this.domNode.children[1];},bottomNode:function D(){return this.domNode.children[2];}},popupConfig:null,init:function F(J){this._super(J);var I=this.popupConfig,H=I.bottomNode;this.data=I.data||{};if(I.onOpen){this.onOpen=I.onOpen;}this.addChildren([B(true,I),B(false)]);if(H){H.slot="bottomNode";this.addChildren(H);}},onOpen:function C(){G.forEach(this.children,function(H){if(H.scriptClass==="mstrmojo.ui.ScrollableContainer"&&H.onOpen){H.onOpen();}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo._CanValidate","mstrmojo.css","mstrmojo.validation","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");var H=mstrmojo.css,E=mstrmojo.validation,G=E.TRIGGER,J=E.STATUSCODE;function F(L){if((this.constraints.trigger&L)>0){this.validate();}}mstrmojo.ValidationTextBox=mstrmojo.declare(mstrmojo.TextBox,[mstrmojo._CanValidate,mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.ValidationTextBox",validationDelay:500,getInvalidMsg:function K(L){return(L&&L.msg?L.msg:"");},postBuildRendering:function A(){this._super();this._original_tooltip=this.inputNode.title;},prekeyup:function I(L){this._super(L);var P=(this.constraints.trigger&G.ONKEYUP)>0;if(P){var M=this.validationDelay;if(M){this.clearValDelayTimer();var O=this._validateHandler;if(!O){var N=this;this._validateHandler=O=function(){N.validate();if(N._valDelayTimer){window.clearTimeout(N._valDelayTimer);delete N._valDelayTimer;}};}this._valDelayTimer=window.setTimeout(O,M);}else{this.validate();}}},preinput:function D(L){this._super(L);F.call(this,G.ONKEYUP);},preblur:function B(L){this._super(L);F.call(this,G.ONBLUR);},clearValidation:function C(){this._super();var L=this.inputNode;H.removeClass(L,this.constraints.invalidCssClass||"mstrmojo-TextBox-ErrValidation");L.title=this._original_tooltip;},clearValDelayTimer:function(){var L=this._valDelayTimer;if(L){window.clearTimeout(L);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ValidationTextBox,{onvalidationStatusChange:function(){var P=this.validationStatus;if(!P){return ;}var N=this.inputNode,L=(P.code>J.VALID),M=this.constraints.invalidCssClass;H.toggleClass(N,M||"mstrmojo-TextBox-ErrValidation",L);var O=L?this.getInvalidMsg(P):this._original_tooltip;if(!this.useRichTooltip&&O!==undefined&&O!==null){N.setAttribute("title",O);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.ui._HasListTooltip");mstrmojo.ui.PopupList=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo._IsPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.PopupList",autoCloses:true,locksHover:true,closeOnClick:true,parentDomNode:undefined,markupString:'<div id="{@id}" class="mstrmojo-PopupList {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu><div class="mstrmojo-popupList-scrollBar"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function D(){return this.domNode.firstChild.firstChild;},scrollboxNode:function F(){return this.domNode.firstChild;}},setupScrollNodes:function E(){this.scrollNode=this.scrollboxNode;},onOpen:function B(){this._super();this.updateScrollbars();},postBuildRendering:function C(){var H=this._super();if(!this.parent){var G=this.parentDomNode=this.parentDomNode||document.body;G.appendChild(this.domNode);}return H;},closePopup:function A(){this.set("visible",false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.ui.menus._HasMenuPopup","mstrmojo._CanAutoClose","mstrmojo._IsPopup","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.ui.PopupConfig","mstrmojo.ui._HasScroller","mstrmojo.ui._HasUITheme","mstrmojo.dom","mstrmojo.css","mstrmojo.ui._HasListTooltip");var D=mstrmojo.dom,P=mstrmojo.css,I=mstrmojo.ui.PopupConfig.directionCfg;var Q={};var K=false;function F(V,W){if(V.pop){if(W&&V.ax){window.clearTimeout(this._popupAxTimeout);V.actionFn();this.closeAllMenus();}else{var T=V.fn.call(mstrmojo.all[V.scope],V.ctxt);var U=T.ENUM_CORNERS;T.setAlignment(U.TOP_RIGHT,U.TOP_LEFT);T.hostId=this.id;T.hostElement=this._getItemNode(V._renderIdx);this.openPopup(T.newInstance());}}else{if(V.dsbld!==true){if(V.fn(V,this)!==false){this.closeAllMenus();}}}}function G(T){var U=parseInt(T);return U===null||isNaN(U)?0:U;}mstrmojo.ui.menus.Menu=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup,mstrmojo._IsPopup,mstrmojo.ui.menus._IsMenuPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip,mstrmojo.ui._HasScroller,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.ui.menus.Menu",selectionPolicy:"reselect",locksHover:true,closeOnClick:true,themeClassName:"mojo-theme-dark",icnCss:"mstrmojo-ui-Menu-item-container",popupConfig:null,tooltipCss:{leftCssClass:"menuTooltip",rightCssClass:"menuTooltip"},setupScrollNodes:function(){if(this.popupConfig&&this.popupConfig.supportsScroll){this.scrollNode=this.itemsContainerNode;this.scrollbarHostNode=this.domNode;}},updateScrollbars:function(){this._super();if(this.popupConfig&&this.popupConfig.supportsScroll&&this.hasCustomScrollbar){var V=this.scrollNode;if(!V){return ;}var T=(getComputedStyle&&getComputedStyle(V,null))||V.currentStyle,U=V.offsetWidth-G(T.borderLeftWidth)-G(T.borderRightWidth)-V.clientWidth;V.style.marginRight=-U+"px";V.style.paddingRight=0;}},onscroll:function(){this.closePopup();this._super();},init:function L(V){this._super(V);var T=this.popupConfig;this.items=T.getMenuItems();var U=["mstrmojo-ui-Menu","unselectable"],W=T.menuCssClass;if(W){U.push(W);}P.addWidgetCssClass(this,U);if(T&&T.supportsScroll&&T.maxHeight>0){this.icnCssText=(this.icnCssText||"")+";max-height:"+T.maxHeight+"px";}this.useRichTooltip=!!T.useTooltip;this.tstid=T.tstid;},markupMethods:{onvisibleChange:function J(){var T=this.visible;if(!K||T){P.toggleClass(this.domNode,"visible",T);}}},getItemMarkup:function C(X,T){if(X.getItemMarkup){return X.getItemMarkup.apply(this,[X,T]);}var V=!!X.pop,W=V?"submenu":"item",U=Q[W];if(!U){U=this._super(X,T).replace("{@en@n}",'<div class="micn"></div>{@en@n}');if(V){U=U.replace("{@en@n}",'{@en@n}<div class="arw"></div>');}Q[W]=U;}if(X.tstid){U=U.replace("{@tag}","{@tag} "+mstrmojo.tstid(X)+" ");}return U;},getItemProps:function R(V,T){var U=this._super(V,T);U.tag="a";U.addCls("mstrmojo-ui-Menu-item");U.addCls(V.cls);return U;},adjustCornersForPopupOverflow:function O(){var V=this._super(),Z=this.domNode,Y,X,T,U,W;if(V){Y=D.position(Z);T=Y.y;X=Z.style;U=this.popupConfig;W=U.position||D.position(U.hostElement);if(T<0||(T+Y.h>D.position(document.body).h)){X.top=(-W.y+5)+"px";X.bottom="auto";}}return V;},onmouseover:function E(T){var Y=T.getTarget(),X=this.getItemFromTarget(Y),W=this,V=W._lastOpened,a=V&&this.getItemFromTarget(V.popupConfig.hostElement)._renderIdx,Z=this.getItemNodeFromTarget(Y),U=(a!==undefined&&D.contains(this._getItemNode(a),Y,true,this.domNode));if(X){this._lastHoverIx=X._renderIdx;window.clearTimeout(this._popupTimeOut);window.clearTimeout(this._popupAxTimeout);if(this._lastHoverIx!==a&&!U){this._popupTimeOut=window.setTimeout(function(){if(W._lastOpened&&W._lastOpened.visible){W.closePopup();}if(W.visible&&X.pop){if(X.ax){W._popupAxTimeout=window.setTimeout(function(){P.removeClass(Z,"hlt-ax");F.call(W,X);},0);}else{F.call(W,X);}}},400);if(X.pop&&X.ax){P.addClass(Z,"hlt-ax");}}}},onclick:function S(T){this._evtTarget=T.getTarget();this._super(T);T.cancel();},postselectionChange:function H(T){var U=T.added;if(U){var V=this.items[U[0]];F.call(this,V,!(V.ax&&this._evtTarget.className==="arw"));delete this._evtTarget;}},oncontextmenu:function M(T){D.preventDefault(window,T.e);return false;},postBuildRendering:function N(T){this._super(T);if(this.popupConfig.supportsScroll){var U=this;window.setTimeout(function(){U.updateScrollbars();},10);}},showTooltip:function B(X,W){var V=D.eventTarget(W,X),U=this.getItemNodeFromTarget(V),T=this.getItemFromTarget(V);if(U&&((T&&T.ttp)||(U.scrollWidth>U.clientWidth))){this._super(X,W);}},onClose:function A(T){if(this._super){this._super(T);}this.closePopup();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Slider");var D=mstrmojo.dom,B="px";mstrmojo.Refine.SampleSlider=mstrmojo.declare(mstrmojo.Slider,null,{scriptClass:"mstrmojo.Refine.SampleSlider",markupString:'<div id="{@id}" class="mstrmojo-Slider {@cssClass} {@clsType} {@clsOrientation}" style="{@cssText}" ><div class="cont"><div class="bk" style="{@bkCssText}"><div class="progress" style=""></div></div><div class="sdc" style="position:absolute;{@sdcCssText}" mstrAttach:mouseout><div class="sd" style="{@sdCssText}"><div class="t1"></div><div class="t2"></div><div class="t3"></div></div></div></div></div>',markupSlots:{progressNode:function(){return this.domNode.firstChild.firstChild.firstChild;},dndNode:function(){return this.domNode.firstChild;},bgNode:function(){return this.domNode.firstChild.firstChild;},sdcNode:function(){return this.domNode.firstChild.lastChild;},containerNode:function(){return this.domNode.firstChild.lastChild.firstChild;},frontNode:function(){return this.domNode.firstChild.lastChild.firstChild.firstChild;},thumbNode:function(){return this.domNode.firstChild.lastChild.firstChild.childNodes[1];},endNode:function(){return this.domNode.firstChild.lastChild.firstChild.lastChild;},tooltipNode:function(){return this.domNode.firstChild.lastChild;}},postBuildRendering:function A(){this._super();this.moveProgress(parseInt(this.start,10)+5+"px");},moveProgress:function(F){var E=this.progressNode;E.style.width=F;},ondrag:function C(M,L){L=L||window;var N=this.dnd.initD,I=this.ghost.containerNode,R,G,E,K=this.min,O=this.max,J=this.orCfg,F=J.lenCssP,Q=J.posCssP;var P=D.getMousePosition(M,L)[J.offsetP]-N.offset;switch(N.td){case this.thumbNode:R=Math.max(Math.min(N.tP+P,N.sL-N.contL),0);G=R+N.contL;I.style[Q]=R+B;this.moveProgress(R+5+B);var H=this.typeHelper.calcMinMax(R,G);K=H.min;O=H.max;break;case this.frontNode:R=Math.max(Math.min(N.tP+P,N.tP+N.contL),0);E=Math.max(Math.min(N.contL-P,N.tP+N.contL),0);I.style[Q]=R+B;I.style[F]=E+B;this.moveProgress(R+5+B);K=Math.min(Math.floor(R/this.unit+0.5),this.max);break;case this.endNode:E=Math.max(Math.min(N.contL+P,N.sL-N.tP),0);G=N.tP+E;I.style[F]=E+B;O=Math.max(Math.floor(G/this.unit-0.5),this.min);break;default:return ;}if(K!==this.min||O!==this.max){this.min=K;this.max=O;this.typeHelper.updateThumb();}this._updateTooltip();},onselectionChange:function(){this._super();this.moveProgress(parseInt(this.containerNode.style.left,10)+5+"px");}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.Box","mstrmojo.array","mstrmojo._HasLayout","mstrmojo.ui.ColumnContainer");var E=mstrmojo.dom,G=mstrmojo.hash,C=mstrmojo.array;mstrmojo.ui.ColumnWalk=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.ColumnWalk",markupString:'<div id="{@id}" class="mstrmojo-ui-ColumnWalk cf {@cssClass}" mstrAttach:click></div>',layoutConfig:{h:{containerNode:"100%"},xt:true},currentColumn:-1,addNextColumn:function B(K){var J=this.children||[],L=J.length,I=J[L-1];var M=this.addChildren([G.copy(K,{scriptClass:"mstrmojo.ui.ColumnContainer",idx:L})])[0];if(I){I.set("next",M);}},onclick:function A(I){var K=I.getTarget();if(K){var J=this.children;C.forEach(J,function(M,L){if(E.contains(M.domNode,K,true,M.domNode)){this.set("currentColumn",L);}},this);}},oncurrentColumnChange:function D(I){var K=this.children,M=K[I.valueWas],J=K[this.currentColumn],L="active";if(M){M.set(L,false);}J.set(L,true);},removeTrailingContainer:function H(K){var J=this,I=this.children;if(!I||K>=I.length-1){return ;}C.forEach(I.slice(K+1),function(L){J.removeAndDestroyChild(L);});if(K>=0){I[K].set("next",null);}},insertAndRemoveTrailing:function F(J,I){this.removeTrailingContainer(J);this.addNextColumn(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DISourceItem","mstrmojo.DI.DISourceItemAdmin");var H=mstrmojo.DI.DIConstants,I="mstrmojo.DI.DISourceItem",C=mstrmojo.DI.DIConstants.pageType,G=mstrmojo.DI.DIConstants.sourceType,E=mstrmojo.desc(13227,"Set OAuth Parameters"),F=H.sourceItemLinkType&&H.sourceItemLinkType.oauthPara,B=mstrmojo.DI.DIDatabaseHelper,D=H.sourceItemType;mstrmojo.requiresDescs(1563,3958,9214,10171,10174,11108,11109,12712,13223,13411,13412,13413,13414,13415,13416,13417,13421,13422,13423,13424,13425,13426,12442,12444,12448,12449,12450,12455,12456,12460,12461,12462,12491,12463,12498,12542,12712,12713,12733,12751,12752,12755,12757,12758,12986,12988,13224,13225,13226,13418,13419,13420,13532,13533,13978,13993,14031,14188,14189,14190,14191,14616,14617,14618);mstrmojo.DI.model._DISources=mstrmojo.provide("mstrmojo.DI.model._DISources",{supportDBObjects:{},sourceItems:[{sid:D.file,scriptClass:I,icon:"ds_disk",n:mstrmojo.desc(12442,"File From Disk"),desc:mstrmojo.desc(14616,"Import Excel, CSV, JSON and Text files from your local machine"),pageType:C.file,sourceInfo:0,subtype:H.sourceSubtype.localFile,bindings:{enabled:function(){return true;},title:function(){return"";}},oneTier:true,privilege:H.privilegeType.accessFile},{sid:D.url,scriptClass:I,icon:"ds_url",n:mstrmojo.desc(12444,"File From URL"),desc:mstrmojo.desc(14617,"Import Excel, CSV, JSON and Text files from any URL"),bindings:{enabled:function(){return mstrApp.diParams.EnableURLImport;},title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},pageType:C.file,sourceInfo:1,subtype:H.sourceSubtype.url,oneTier:true,checkConectivity:true,showWhiteListLink:true,privilege:H.privilegeType.accessFile},{sid:D.database,scriptClass:I,icon:"ds_database",n:mstrmojo.desc(1563,"Database"),desc:mstrmojo.desc(13413,"Access data from Tables"),bindings:{enabled:function(){return mstrApp.diParams.ImportDatabase!==0;},title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},pageType:C.database,showDBList:true,dbIdExcludeFilter:[41],showImportOption:true,dbObjectsDisplayOptions:1,sourceInfo:{sourceType:G.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:H.xdaType.querybuilder,subtype:H.sourceSubtype.querybuilder},oneTier:true,privilege:H.privilegeType.accessDatabase,waitDbTypes:true},{sid:D.hadoop,scriptClass:I,n:mstrmojo.desc(12758,"Hadoop"),desc:mstrmojo.desc(13414,"query SQL on Hadoop, or type PigScripts"),icon:"ds_cloud",bindings:{enabled:function(){return mstrApp.diParams.ImportDatabase!==0;},title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},pageType:C.database,showDBList:true,showImportOption:true,enableHadoopOption:true,dbObjectsDisplayOptions:16,sourceInfo:{sourceType:G.hadoop,name:"hadoop",subtype:H.sourceSubtype.hadoop},containHadoopFile:true,oneTier:true,excludeDBVFilter:H.ibmDb2Versions.slice(0),privilege:H.privilegeType.accessDatabase,waitDbTypes:true},{sid:D.olap,scriptClass:I,icon:"ds_olap",n:mstrmojo.desc(13416,"OLAP"),desc:mstrmojo.desc(13415,"Access MDX cubes in SAP, Essbase, MSFT Analysis, and Cognos TM1"),dbObjectsDisplayOptions:2,bindings:{enabled:function(){if(mstrApp.showDDAOptions===false||mstrApp.isSingleTier){return false;}return mstrApp.diParams.ImportDatabase!==0;},title:function(){var J="";if(mstrApp.showDDAOptions===false){return"Disabled as Flash VI does not support this data source";}if(mstrApp.diParams.ImportDatabase===0){J=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}return J;}},pageType:C.database,sourceInfo:{sourceType:G.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:H.xdaType.mdx,subtype:H.sourceSubtype.mdx},oneTier:false,privilege:H.privilegeType.accessDatabase},{sid:D.publicData,scriptClass:I,icon:"ds_cloud",n:mstrmojo.desc(13978,"Public Data"),desc:mstrmojo.desc(14031,"Search for data on the internet and import them"),bindings:{enabled:function(){return mstrApp.diParams.EnableURLImport&&mstrApp.diParams.EnableHttpImport;},title:function(){if(!mstrApp.diParams.EnableURLImport){return mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}}},sourceInfo:1,subtype:H.sourceSubtype.publicData,pageType:C.publicData,oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessFile},{sid:D.salesforce,scriptClass:I,icon:"ds_cloud",n:mstrmojo.desc(12757,"Salesforce Reports"),desc:mstrmojo.desc(9214,"Import your reports from Salesforce.com"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return mstrApp.isSingleTier||document.location.protocol.indexOf("https")!==-1;}},pageType:C.sourceIntro,showOAuthLink:true,link:E,linkType:F,sourceInfo:{id:"4",name:"Salesforce",url:"Salesforce.com",type:G.salesforce,subtype:H.sourceSubtype.salesforce,step2:mstrmojo.desc(12463,"Select Your Report")},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessCloud},{sid:D.googleAnalytics,scriptClass:I,bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||document.location.protocol.indexOf("https")!==-1);}},n:mstrmojo.desc(12448,"Google Analytics"),icon:"ds_cloud",showOAuthLink:true,desc:mstrmojo.desc(12449,"Import your web analytics data"),pageType:C.sourceIntro,link:E,linkType:F,sourceInfo:{id:"1",name:"Google Analytics",url:"Google.com/analytics/",type:G.googleAnalytics,subtype:H.sourceSubtype.googleAnalytics},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessCloud},{sid:D.googleBigQuery,scriptClass:I,icon:"ds_cloud",n:mstrmojo.desc(12450,"Google BigQuery"),showOAuthLink:true,desc:mstrmojo.desc(13417,"Access Big Data in Google Cloud"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||document.location.protocol.indexOf("https")!==-1);}},pageType:C.sourceIntro,showImportOption:true,link:E,linkType:F,sourceInfo:{id:"2",name:"Google BigQuery",url:"Google.com/bigquery/",checkConectivity:true,type:G.googleBigQuery,subtype:H.sourceSubtype.googleBigQuery,step2:mstrmojo.desc(12461,"Make a query and get results"),step3:mstrmojo.desc(12462,"Publish cube to create documents")},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessDatabase},{sid:D.googleDrive,scriptClass:I,icon:"ds_drive",n:mstrmojo.desc(11108,"Google Drive"),desc:mstrmojo.desc(13418,"Import files from your account"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||document.location.protocol.indexOf("https")!==-1);}},pageType:C.sourceIntro,showOAuthLink:true,link:E,linkType:F,sourceInfo:{id:"3",name:"Google Drive",url:"Drive.google.com",type:G.googleDrive,subtype:H.sourceSubtype.googleDrive},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessFile},{sid:D.dropbox,scriptClass:I,icon:"ds_dropbox",n:mstrmojo.desc(11109,"Dropbox"),desc:mstrmojo.desc(13418,"Import files from your account"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||document.location.protocol.indexOf("https")!==-1);}},pageType:C.sourceIntro,link:E,showOAuthLink:true,linkType:F,sourceInfo:{id:"0",name:"Dropbox",url:"Dropbox.com",type:G.dropbox,subtype:H.sourceSubtype.dropbox},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessFile},{sid:D.searchAsASource,scriptClass:I,icon:"ds_search",n:mstrmojo.desc(13419,"Search Engine Indices"),desc:mstrmojo.desc(13420,"Search data via external search engine"),bindings:{enabled:function(){if(mstrApp.showDDAOptions===false||mstrApp.isSingleTier){return false;}return mstrApp.diParams.ImportDatabase!==0;},title:function(){var J="";if(mstrApp.showDDAOptions===false){return mstrmojo.desc(14188,"Disabled as Flash VI does not support this data source");}if(mstrApp.diParams.ImportDatabase===0){J=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}return J;}},pageType:C.database,sourceInfo:{sourceType:G.querybuilder,name:"Database",step2:mstrmojo.desc(12988,"Select a table"),type:H.xdaType.qbSingleTable,subtype:H.sourceSubtype.searchOnSource,extParams:{subtype:H.sourceSubtype.searchOnSource}},oneTier:false,privilege:H.privilegeType.accessDatabase},{sid:D.clipboard,scriptClass:I,icon:"ds_clipboard",n:mstrmojo.desc(12713,"Clipboard"),desc:mstrmojo.desc(13421,"Type or Paste your data"),bindings:{enabled:function(){return !mstrmojo.dom.isIE8;},title:function(){return(!mstrmojo.dom.isIE8)?mstrmojo.desc(12456,"Upload custom data or paste from another data source"):mstrmojo.desc(12981,"Custom data not supported for this browser");}},pageType:C.clipboard,sourceInfo:0,subtype:H.sourceSubtype.clipboard,oneTier:true,privilege:H.privilegeType.accessFile},{sid:D.bISources,scriptClass:I,icon:"ds_bi_tools",bindings:{enabled:function(){return(mstrApp.diParams.ImportDatabase!==0);},title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},n:mstrmojo.desc(13422,"BI Tools"),desc:mstrmojo.desc(13423,"Import Reports from SAP BO, OBIEE, and Cognos"),pageType:C.database,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:G.bisource,name:"BI Sources",type:H.xdaType.dataImportBISource,subtype:H.sourceSubtype.bisource},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessDatabase},{sid:D.facebook,scriptClass:I,icon:"ds_facebook",n:mstrmojo.desc(10171,"Facebook"),desc:mstrmojo.desc(13424,"Import data from Facebook Pages"),showOAuthLink:true,bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||document.location.protocol.indexOf("https")!==-1);}},pageType:C.sourceIntro,link:E,linkType:F,sourceInfo:{name:"Facebook",url:"facebook.com",type:G.facebook,subtype:H.sourceSubtype.facebook},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessCloud},{sid:D.twitter,scriptClass:I,icon:"ds_twitter",desc:mstrmojo.desc(13425,"Import Tweet data"),showOAuthLink:true,n:mstrmojo.desc(10174,"Twitter"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return mstrApp.isSingleTier||document.location.protocol.indexOf("https")!==-1;}},pageType:C.sourceIntro,link:E,linkType:F,sourceInfo:{id:"5",name:"Twitter",url:"twitter.com",type:G.twitter,subtype:H.sourceSubtype.twitter},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessCloud},{sid:D.samplefile,scriptClass:I,icon:"ds_sample",n:mstrmojo.desc(12712,"Sample Files"),desc:mstrmojo.desc(13426,"Import some sample files"),bindings:{enabled:function(){return true;}},sourceInfo:{subtype:H.sourceSubtype.samplefile},pageType:C.sampleFiles,oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessFile}],staticSourceList:[{n:mstrmojo.desc(12455,"Add Custom Data"),initial:"A",pageType:C.clipboard,sourceInfo:0,subtype:H.sourceSubtype.clipboard,oneTier:true,privilege:H.privilegeType.accessFile,title:function(){return(!mstrmojo.dom.isIE8)?mstrmojo.desc(12456,"Upload custom data or paste from another data source"):mstrmojo.desc(12981,"Custom data not supported for this browser");}},{n:mstrmojo.desc(12752,"BI Sources"),initial:"B",pageType:C.database,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:G.bisource,name:"BI Sources",type:H.xdaType.dataImportBISource,subtype:H.sourceSubtype.bisource},oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13533,"Cognos"),initial:"C",pageType:C.database,dbObjectsDisplayOptions:8,tags:["BI"],sourceInfo:{sourceType:G.bisource,name:"BI Sources",type:H.xdaType.dataImportBISource,subtype:H.sourceSubtype.bisource},oneTier:true,privilege:H.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13223,"Cognos TM1"),initial:"C",pageType:C.database,dbType:2900,sourceInfo:{sourceType:G.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:H.xdaType.mdx,subtype:H.sourceSubtype.mdx},tags:["MDX","OLAP","Cube"],isEnabled:function(){return !mstrApp.isSingleTier;},oneTier:false,privilege:H.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(12713,"Clipboard"),initial:"C",sourceInfo:0,pageType:C.clipboard,subtype:H.sourceSubtype.clipboard,oneTier:true,privilege:H.privilegeType.accessFile,title:function(){return(!mstrmojo.dom.isIE8)?mstrmojo.desc(12456,"Upload custom data or paste from another data source"):mstrmojo.desc(12981,"Custom data not supported for this browser");}},{n:mstrmojo.desc(14189,"CSV File"),initial:"C",pageType:C.file,sourceInfo:0,subtype:H.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:H.privilegeType.accessFile},{n:mstrmojo.desc(11109,"Dropbox"),initial:"D",pageType:C.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier;},sourceInfo:{id:"0",name:"Dropbox",url:"Dropbox.com",type:G.dropbox,subtype:H.sourceSubtype.dropbox},tags:["File","Cloud"],oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessFile,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(3958,"Excel"),initial:"E",pageType:C.file,sourceInfo:0,subtype:H.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:H.privilegeType.accessFile},{n:mstrmojo.desc(10171,"Facebook"),initial:"F",pageType:C.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier;},sourceInfo:{name:"Facebook",url:"facebook.com",type:G.facebook,subtype:H.sourceSubtype.facebook},tags:["Social","Cloud"],oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessCloud,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(12442,"File From Disk"),initial:"F",pageType:C.file,sourceInfo:0,subtype:H.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:H.privilegeType.accessFile},{n:mstrmojo.desc(12444,"File From URL"),initial:"F",pageType:C.file,sourceInfo:1,subtype:H.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:true,mode:0,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:H.privilegeType.accessFile,title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},{n:mstrmojo.desc(12448,"Google Analytics"),initial:"G",pageType:C.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier;},sourceInfo:{id:"3",name:"Google Analytics",type:G.googleAnalytics,subtype:H.sourceSubtype.googleAnalytics},tags:["Cloud"],oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessCloud,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(12542,"Google Big Query"),initial:"G",pageType:C.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier;},sourceInfo:{id:"2",name:"Google BigQuery",url:"Google.com/bigquery/",type:G.googleBigQuery,subtype:H.sourceSubtype.googleBigQuery},tags:["Database","Cloud","BigData"],oneTier:true,privilege:H.privilegeType.accessDatabase,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(11108,"Google Drive"),initial:"G",pageType:C.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier;},sourceInfo:{id:"3",name:"Google Drive",url:"Google.com/drive/",type:G.googleDrive,subtype:H.sourceSubtype.googleDrive},tags:["File","Cloud","SaaS"],oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessFile,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(12755,"Hadoop File Browser"),initial:"H",pageType:C.hadoop,sourceInfo:1,subtype:H.sourceSubtype.hadoop,tags:["Database","BigData","Hadoop","File"],oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13224,"Hyperion Essbase"),initial:"H",pageType:C.database,dbType:1600,sourceInfo:{sourceType:G.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:H.xdaType.mdx,subtype:H.sourceSubtype.mdx},tags:["MDX","OLAP","Cube"],isEnabled:function(){return !mstrApp.isSingleTier;},oneTier:false,privilege:H.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(14618,"JSON File"),initial:"J",pageType:C.file,sourceInfo:0,subtype:H.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:H.privilegeType.accessFile},{n:mstrmojo.desc(13225,"Microsoft Analysis Server"),initial:"M",pageType:C.database,dbType:1500,sourceInfo:{sourceType:G.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:H.xdaType.mdx,subtype:H.sourceSubtype.mdx},tags:["MDX","OLAP","Cube"],isEnabled:function(){return !mstrApp.isSingleTier;},oneTier:false,privilege:H.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(12733,"Network Browser"),initial:"N",pageType:C.file,sourceInfo:1,subtype:H.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:true,mode:1,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:H.privilegeType.accessFile,title:function(){if(!mstrApp.diParams.EnableURLImport){return mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}}},{n:mstrmojo.desc(13532,"OBIEE"),initial:"O",pageType:C.database,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:G.bisource,name:"BI Sources",type:H.xdaType.dataImportBISource,subtype:H.sourceSubtype.bisource},tags:["BI"],oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(12712,"Sample Files"),initial:"S",pageType:C.sampleFiles,sourceInfo:1,subtype:H.sourceSubtype.samplefile,tags:["File"],oneTier:true,checkConectivity:true,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:H.privilegeType.accessFile,title:function(){if(!mstrApp.diParams.EnableURLImport){return mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}}},{n:mstrmojo.desc(12757,"SalesForce Reports"),initial:"S",pageType:C.sourceIntro,dbType:300,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier;},sourceInfo:{id:"4",name:"Salesforce",url:"Salesforce.com",type:G.salesforce,subtype:H.sourceSubtype.salesforce},tags:["Cloud","SaaS"],oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessCloud,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(14190,"SAP Business Object"),initial:"S",pageType:C.database,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:G.bisource,name:"BI Sources",type:H.xdaType.dataImportBISource,subtype:H.sourceSubtype.bisource},tags:["BI"],oneTier:true,privilege:H.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13226,"SAP Business Warehouse"),initial:"S",pageType:C.database,dbType:1200,sourceInfo:{sourceType:G.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:H.xdaType.mdx,subtype:H.sourceSubtype.mdx},tags:["MDX","OLAP","Cube"],isEnabled:function(){if(mstrApp.showDDAOptions===false){return false;}return !mstrApp.isSingleTier;},oneTier:false,privilege:H.privilegeType.accessDatabase,title:function(){var J="";if(mstrApp.showDDAOptions===false){return"Disabled as Flash VI does not support this data source";}if(mstrApp.diParams.ImportDatabase===0){J=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}return J;}},{n:mstrmojo.desc(12986,"Search as a Source"),initial:"S",pageType:C.database,sourceInfo:{sourceType:G.querybuilder,name:"Database",step2:mstrmojo.desc(12988,"Select a table"),type:H.xdaType.qbSingleTable,subtype:H.sourceSubtype.searchOnSource,extParams:{subtype:H.sourceSubtype.searchOnSource}},oneTier:false,tags:["Search"],isEnabled:function(){return !mstrApp.isSingleTier;},privilege:H.privilegeType.accessDatabase,title:function(){var J="";if(mstrApp.showDDAOptions===false){return"Disabled as Flash VI does not support this data source";}if(mstrApp.diParams.ImportDatabase===0){J=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}return J;}},{n:mstrmojo.desc(14191,"Text File"),initial:"T",pageType:G.file,sourceInfo:0,subtype:H.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:H.privilegeType.accessFile},{n:mstrmojo.desc(10174,"Twitter"),initial:"T",pageType:C.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier;},sourceInfo:{id:"5",name:"Twitter",url:"twitter.com",type:G.twitter,subtype:H.sourceSubtype.twitter},tags:["Social","Cloud"],oneTier:true,checkConectivity:true,privilege:H.privilegeType.accessCloud,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}}],sourceList:[],searchTags:{1100:["Database","ODBC"],100:["Database","ODBC"],4200:["Database","ODBC"],2300:["Database","ODBC"],2200:["Database","ODBC"],700:["Database","ODBC"],4300:["Database","ODBC"],3600:["Database","ODBC","BigData"],400:["Database","ODBC"],1700:["Database","ODBC"],1300:["Database","ODBC"],200:["Database","ODBC"],300:["Database","ODBC"],2800:["Database","ODBC"],1800:["Database","ODBC"],600:["Database","ODBC"],4000:["Database","ODBC"],500:["Database","ODBC"],900:["Database","ODBC"],3500:["Database","ODBC"],2400:["Database","ODBC"],3100:["Database","BigData","Hadoop"],4100:["Database","BigData","Hadoop"],4800:["Cloud"],5400:["Hadoop"],5200:["Database","NoSQL"],5300:["Database","NoSQL"],4700:["Database","Cloud","BigData"],3300:["Cloud"],6400:["Database","BigData","Hadoop"],6600:["Database"],6700:["Database"],7200:["Database"]},postCreate:function(){this.sourceList=[];},populateDBRoles:function A(U){var T,W=new mstrmojo.warehouse.obj.DBObjects(),V=this.dbObjectsDisplayOptions,R=this,X,O,S,K,P=[],N,J,Q=(navigator.platform.indexOf("Win")!==-1||!mstrApp.isSingleTier)?1:2,L=(mstrApp.isSingleTier&&window.FormWrapper.isWin32&&window.FormWrapper.isWin32()),M=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")===-1));mstrmojo.array.forEach(U.DBS,function(Y){T=Y.dbType;if(mstrApp.isSingleTier&&M&&(T===100||T===1400)){return true;}J=(Y.connType===undefined)?1:Y.connType;if((J&Q)===Q){if(Q===2){Y.n=Y.n.replace(" (JDBC)","");}N=mstrmojo.array.find(P,"n",Y.n);if(N<0){P.push(Y);}else{P[N].id=[Y.id].concat(P[N].id);}}});W.supportDBType=P;W.dbVersions=U.dbVersions;W.dbTypes=U.dbTypes;W.dbIDs=U.dbIDs;W.preferences=U.Preferences;this.supportDBObjects=W;if(this.sourceList.length===0){mstrmojo.array.forEach(U.DBS,function(Y){T=Y.dbType;if(mstrApp.isSingleTier&&!L&&(T===100||T===1400)){return true;}J=(Y.connType===undefined)?1:Y.connType;if((J&Q)===Q){if(((Y.disp&V)===Y.disp&&T!==4700)||(T===1100)){var Z=R.getTags(T);if(Y.id===0&&T===1100){K=mstrmojo.desc(13993,"Generic Database");O="G";}else{K=Y.IDS>0?mstrmojo.desc(Y.IDS,Y.n):Y.n;O=K.substring(0,1);}if(Q===2){K=K.replace(" (JDBC)","");}X={n:K,initial:O,pageType:2,dbType:T,dbId:Y.id,sourceInfo:{sourceType:H.sourceType.querybuilder,subtype:H.sourceSubtype.querybuilder},tags:Z,oneTier:true,privilege:H.privilegeType.accessDatabase};X.showImportOption=B.getImportOptionByDBType(T);X.dbObjectsDisplayOptions=(Y.disp)?Y.disp:R.getDisplayOptionsByType(T);S=B.getSourceTypeByDBType(T);if(S>0){X.sourceInfo.type=S;}R.sourceList.push(X);}}});mstrmojo.array.forEach(this.staticSourceList,function(a){var Z=a,Y=R,b;if(a.dbObjectsDisplayOptions){b=Y.supportDBObjects&&Y.supportDBObjects.supportDBType;b=B.filterDBByDispOption(b,Z.dbObjectsDisplayOptions,Z.dbIdExcludeFilter);b=B.filterDBByAdminConfig(b,Z.dbRolesAdminConfig);Z.dbTypes=b;Z.dbIds=B.getDBIds(b);}R.sourceList.push(a);});this.sourceList.sort(function(Z,Y){if(Z.n<Y.n){return -1;}if(Z.n>Y.n){return 1;}return 0;});}this.raiseEvent({name:"dbTypeFetched",src:R});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.DI.DISourceItemAdmin");mstrmojo.requiresDescs(14456,14459);var A=mstrmojo.array,B=mstrmojo.hash;mstrmojo.DI.DIResourceAdmin=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIResourceAdmin",selectedSource:null,topLabel:mstrmojo.desc(14459,"Commonly used"),bottomLabel:mstrmojo.desc(14456,"Not commonly used"),markupString:'<div id="{@id}" class="mstrmojo-DI-DIResourceAdmin {@cssClass}" style="{@cssText}"><div class="mstrmojo-DI-DIResourceAdmin-Label top">{@topLabel}</div><div class="mstrmojo-DI-DIResourceAdmin-Content top cf"></div><div class="mstrmojo-DI-DIResourceAdmin-Label bottom">{@bottomLabel}</div><div class="mstrmojo-DI-DIResourceAdmin-Content bottom cf"></div></div>',markupSlots:{topContainerNode:function(){return this.domNode.children[1];},bottomContainerNode:function(){return this.domNode.children[3];}},children:[{scriptClass:"mstrmojo.Box",alias:"topBox",slot:"topContainerNode",cssClass:"mstrmojo-DI-DIResourceAdmin-Box top"},{scriptClass:"mstrmojo.Box",alias:"bottomBox",slot:"bottomContainerNode",cssClass:"mstrmojo-DI-DIResourceAdmin-Box bottom"}],preBuildRendering:function(){if(this._super){this._super();}this.populateResources();},populateResources:function(){var G=this,D=mstrApp.getRootController(),F=D.getModel(),E=[],H=[];var C=function(I){G.onItemSelectChange(I);};A.forEach(F.sourceItems,function(J){var I=B.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:J.selected!==false?"":"add",onselectChange:C},B.clone(J));if(I.selected!==false){H.push(B.copy({mode:"remove"},I));}else{E.push(I);}});this.selectedSource=H||[];this.topBox.addChildren(mstrApp.isSingleTier?D.filterSourcesForOneTier(H):D.filterSourcesByPrivileges(H));this.bottomBox.addChildren(mstrApp.isSingleTier?D.filterSourcesForOneTier(E):D.filterSourcesByPrivileges(E));},onItemSelectChange:function(C){switch(C.type){case"add":this.addItem(C);break;case"remove":this.removeItem(C);break;}},addItem:function(J){var H=this,G=mstrApp.getRootController().getModel(),C=J.src,E=G.sourceItems,F,D,I,K;var L=function(M){H.onItemSelectChange(M);};this.bottomBox.removeChildren(C);C.destroy();F=C.sid;I=A.find(E,"sid",F);D=E[I];K=B.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:"remove",onselectChange:L},B.clone(D));this.selectedSource.push(K);this.topBox.addChildren([K]);},removeItem:function(J){var H=this,C=J.src,G=mstrApp.getRootController().getModel(),D=G.sourceItems,I,F,K,E;var L=function(M){H.onItemSelectChange(M);};I=A.find(this.topBox.children,"sid",C.sid);if(I<0){return ;}K=this.topBox.children[I];this.topBox.removeChildren(K);I=A.find(this.bottomBox.children,"sid",C.sid);if(I>=0){K=this.bottomBox.children[I];K.set("mode","add");}else{F=A.find(D,"sid",C.sid);if(F>=0){E=B.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:"add",onselectChange:L},B.clone(D[F]));this.bottomBox.addChildren([E]);}}I=A.find(this.selectedSource,"sid",C.sid);if(I>=0){A.removeIndices(this.selectedSource,I,1);}},getAdminConfig:function(){var F=this,C=mstrApp.getRootController().getModel(),E=F.selectedSource,D=null;if(this.hasRendered){D=[];A.forEach(C.sourceItems,function(H){var G=H.sid;if(A.find(E,"sid",G)<0){D.push(G);}});}return D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DISourceIntro");mstrmojo.DI.DIDatabaseIntro=mstrmojo.declare(mstrmojo.DI.DISourceIntro,null,{scriptClass:"mstrmojo.DI.DIDatabaseIntro",sourceInfo:{},postBuildRendering:function(){if(this._super){this._super();}this.set("sourceInfo",this.sourceInfo);this.introText1.set("text","To connect to a database:</br></br>Ask your database or network specialist to grant MicroStrategy Express access to your database through your firewall. For extra security, use IP filtering to prevent unwanted access. MicroStrategy Express will use the following IP address: 199.255.82.20</br></br>Alternatively, we can work with your database or network specialist to establish a secure point-to-point VPN tunnel. Contact us at support@microstrategy.com if you prefer this option.</br></br>You can also use the data provided in our sample database. The connection has already been established for you.");},onNextButtonClick:function A(){mstrApp.getRootController().launchQueryBuilder(false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Dialog","mstrmojo.Button");mstrmojo.requiresDescs(1442,3610,11581,11582);var E=mstrmojo.css,A="on",D=mstrmojo.desc(11581,"Click for more details"),B=mstrmojo.desc(11582,"Collapse");mstrmojo.qb.QBAlertDialog=mstrmojo.declare(mstrmojo.Dialog,null,{scriptClass:"mstrmojo.qb.QBAlertDialog",cssClass:"mstrmojo-qb-AlertDialog",title:mstrmojo.desc(3610),genericMsg:"",detailedMsg:"",width:"475px",isExpanded:false,buttons:[mstrmojo.Button.newInteractiveButton(mstrmojo.desc(1442),function(H){var I=this.parent.parent;I.destroy();if(I.callback){I.callback();}},"#666666")],children:[{scriptClass:"mstrmojo.Label",alias:"genericLabel",text:"",cssClass:"mstrmojo-qb-alertdialog-genericlabel"},{scriptClass:"mstrmojo.Label",alias:"expandButton",text:"",cssClass:"mstrmojo-qb-alertdialog-expandbutton",cssDisplay:"",onclick:function C(H){var I=this.parent;I.isExpanded=!I.isExpanded;I.expandButton.set("text",I.isExpanded?B:D);E.toggleClass(I.detailedLabel.domNode,A,I.isExpanded);}},{scriptClass:"mstrmojo.Label",alias:"detailedLabel",text:"",cssClass:"mstrmojo-qb-alertdialog-detailedlabel",cssDisplay:""}],postBuildRendering:function F(){if(this._super){this._super();}this.isExpanded=false;this.genericLabel.set("text",this.genericMsg);this.detailedLabel.set("text",this.detailedMsg||"");this.expandButton.set("text",D);E.toggleClass(this.expandButton.domNode,A,!!this.detailedMsg);}});mstrmojo.qb.old_alert=function G(I,M,O,N,J){var H="mstr-qb-alert",P,K={id:H,zIndex:1000};try{mstrmojo.all[H].destroy();}catch(L){}if(J){mstrmojo.hash.copy(J,K);}P=new mstrmojo.qb.QBAlertDialog(K);P.title=N||mstrmojo.desc(3610);P.genericMsg=I;P.detailedMsg=M;P.callback=O;P.render();};mstrmojo.qb.alert=function G(H,L,K,J,I){if(mstrApp.isBISource){mstrApp.getRootController().handleServerRequestError(H,L,K,J);}else{mstrmojo.DI.controller.DIDialogController.showErrorDialog(H,L,K,J,I);}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.fx","mstrmojo.Dialog","mstrmojo.Label","mstrmojo._IsPopup","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ui._HasUITheme","mstrmojo.Button","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.tooltip","mstrmojo.ui.editors.ErrorDialogContent");var h=mstrmojo.func.composite,M=mstrmojo.dom,Z=mstrmojo.Button.newWebButton,C=mstrmojo.css,Y=mstrmojo.all,N=mstrmojo.hash,W=mstrmojo.array;function V(o){if(!this.modal){return ;}var p=window.mstrApp;if(p&&p.modalEditorChange){p.modalEditorChange(this.id,o);}}mstrmojo.Editor=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsPopup,mstrmojo._HasPopup,mstrmojo._IsMovable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.Editor",title:"",help:"",autoClose:false,showTitle:true,openEffect:null,themeClassName:"mojo-theme-light",useRichTooltip:true,closeEffect:null,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mouseup,mousedown,click,contextmenu>{@titlebarHTML}<div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',titleMarkupString:'<div class="mstrmojo-Editor-title-container"><div class="mstrmojo-Editor-title"></div><div class="edt-title-btn mstrmojo-Editor-help" tooltip="'+mstrmojo.desc(1143,"help")+'"></div><div class="edt-title-btn mstrmojo-Editor-close" tooltip="'+mstrmojo.desc(2102,"Close")+'"></div></div><div class="mstrmojo-Editor-titleSpacer"></div>',markupSlots:{editorNode:function X(){return this.domNode.firstChild;},titlebarNode:function k(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},titleNode:function R(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},helpNode:function l(){return this.showTitle?this.domNode.firstChild.firstChild.children[1]:null;},closeNode:function E(){return this.showTitle?this.domNode.firstChild.firstChild.lastChild:null;},containerNode:function S(){return this.domNode.firstChild.childNodes[2];},buttonNode:function I(){return this.domNode.firstChild.childNodes[3];},curtainNode:function m(){return this.domNode.lastChild;}},markupMethods:{ontitleChange:function(){if(this.showTitle){this.titleNode.innerHTML=this.title;}},onzIndexChange:function(){var o=this.zIndex;this.editorNode.style.zIndex=o;this.curtainNode.style.zIndex=o-1;},onvisibleChange:function(t){if(t){return ;}var q=this.visible,p="closeEffect",o="none";if(q){p="openEffect";o="block";}if(this[p]){this.playEffect(p);}else{this.editorNode.style.display=o;if(this.modal){this.curtainNode.style.display=o;}}},onhelpChange:function d(){if(this.showTitle){var p=this.help,o=this.helpNode;if(!p){o.style.display="none";}else{o.style.display="block";}}},onleftChange:function F(){this.editorNode.style.left=this.left||"";},ontopChange:function H(){this.editorNode.style.top=this.top||"";}},open:function Q(p,o){this._super(p,o);V.call(this,true);},close:function f(o){this._super(o);V.call(this,false);},unrender:function B(o){this._super(o);V.call(this,false);},destroy:function g(o){this._super(o);V.call(this,false);},preBuildRendering:function A(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));this._curtain_to_body=true;V.call(this,true);}this.titlebarHTML=(this.showTitle)?this.titleMarkupString:"<div></div><div></div>";return this._super();},getMovingHandle:function j(){return this.titlebarNode;},getMovingTarget:function U(){return this.editorNode;},onPreClose:function G(){this.hideTooltip();return true;},premousedown:function P(o){var p=o.getTarget();if(p===this.closeNode||p===this.helpNode){C.toggleClass(p,"active",true);}},premouseup:function O(o){var p=o.getTarget();if(p===this.closeNode||p===this.helpNode){C.toggleClass(p,"active",false);}if(o.getTarget()===this.closeNode&&this.onPreClose()){this.close();}},onclick:function c(p){if(p.getTarget()===this.helpNode){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(this.help);}else{var o=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");window.open(o+(this.help||""),"_blank");return false;}}},_set_visible:function b(w,q){var p=(this[w]!==q);if(p){this[w]=q;var u=this._close_handler;if(q){if(this._curtain_to_body){this.resizeDialog();this.positionDialog();}if(this.autoClose){var t=this;u=this._close_handler=u||function(x){var z=M.eventTarget(self,x);if(z&&z.parentNode&&!M.contains(t.editorNode,z,true,document.body)){t.close();}};M.attachEvent(document.body,"mousedown",u);}}else{var o=this._curtain_handler;if(o){M.detachEvent(window,"resize",o);}if(u){M.detachEvent(document.body,"mousedown",u);}}}return p;},showTooltip:function n(x,w){var u=this,p=M.findAncestorByAttr(M.eventTarget(w,x),"tooltip",true,this.domNode),q=p&&p.value;if(!u.hasOpenTooltip&&q){var o=M.position(p.node);u.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:q,top:Math.max(o.y+40,0),left:Math.max(o.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER};this._super(x,w);}}});mstrmojo.Editor.openEffect_fadeIn={scriptClass:"mstrmojo.fx.AnimateProp",slot:"curtainNode",props:{backgroundColor:{start:255,stop:0,fn:function(o){o=Math.round(o);return["rgb(",o,",",o,",",o,")"].join("");}}},preStart:function(){var p=this.target,o=this.widget;o.editorNode.style.display="block";if(!o.modal){return false;}p.style.display="block";C.setOpacity(p,60);return true;}};mstrmojo.Editor.closeEffect_fadeOut={scriptClass:"mstrmojo.fx.FadeOut",slot:"curtainNode",start:0.6,stop:0,preStart:function(){var o=this.widget;o.editorNode.style.display="none";return !!o.modal;}};function D(o){return function(){Y[o].destroy();};}function J(p,AA,AB,AC){var o=AA.id||"mojoAlertx9",w,z=AA.buttons;W.forEach(z,function(AE){var AD=AE.onclick;AE.onclick=function(AF){var AG=Y[o];if(AD&&AD.call(AE,AF)===false){return ;}AG.destroy();AG=null;};});try{Y[o].destroy();}catch(x){}var q=AA.cssClass,t=[];if(q){t.push(q);delete AA.cssClass;}if(AC){t.push(AC);}t.push("mstrmojo-alert");w={scriptClass:"mstrmojo.Editor",id:o,width:"475px",zIndex:1000,title:AB||mstrmojo.desc(11812,"Notification"),cssClass:t.join(" "),children:[{scriptClass:"mstrmojo.Label",cssClass:"alert-content",text:p,allowHTML:AA.allowHTML}],visible:true};var u=new mstrmojo.Editor(N.copy(AA,w));u.render();return u;}if(window.mstrConfig&&!window.mstrConfig.simpleDialog){mstrmojo.notify=function L(p,z,q){q=q||{};var AA=q.forceClose,x=q.callback||mstrmojo.emptyFn,w=N.copy(z||{},{buttons:AA?[mstrmojo.Button.newActionButton((q.buttonText||mstrmojo.desc(8607,"Dismiss")),x)]:null,showTitle:false,modal:false,top:"42px"}),t=q.duration||6000;var u=J(p,w,"",AA?"ed-notify":"ed-toast"),o=u.id;if(!AA){window.setTimeout(h([x,D(o)]),t);}else{window.setTimeout(function(){if(Y[o]){Y[o].editorNode.style.opacity=0.75;}},6000);}return u;};mstrmojo.confirm=function e(w,p,u){p=p||{};var o=p.confirmBtn||{},t=p.cancelBtn||{},q=[Z(o.t||mstrmojo.desc(219,"Yes"),o.fn,true),Z(t.t||mstrmojo.desc(218,"No"),t.fn)];return J(w,N.copy(u||{},{buttons:q,onPreClose:function(){if(t&&t.fn){t.fn();}return true;}}));};mstrmojo.warn=function K(q,o,p){p=p||{};p.cssClass=(p.cssClass||"")+" mstrmojo-warning";mstrmojo.confirm(q,o,p);};mstrmojo.alert=function a(w,q,u,x,o,t){var p={title:u,zIndex:x,cssClass:o,buttons:[Z(mstrmojo.desc(1442,"OK"),q,true)],onPreClose:function(){if(q){q();}return true;}};N.forEach(p,function(AA,z){if(!AA){delete p[z];}});return J(w,N.copy(t,p));};mstrmojo.error=function T(u,o,t){var p=u||{};var q=mstrmojo.desc(96,"Error");if(t){q=(t.title)?t.title:mstrmojo.desc(96,"Error");}J("",N.copy(t||{},{buttons:[Z(mstrmojo.desc(1442,"OK"),o,true)],children:[{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",shortDesc:p.shortDesc,longDesc:p.longDesc}]}),q);};}mstrmojo.Editor.ButtonConfigType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ToolBar","mstrmojo.boxmodel","mstrmojo.array","mstrmojo.EnumRWUnitType","mstrmojo.dom","mstrmojo.css");var Q=["background-color","border","border-color","border-left","border-style","border-top","border-width","filter","top","left","z-index","fx","normWidth","normHeight","normZIndex","normTop","normLeft","tbborder","lrborder","ttl"],X=["width","height"],o="p_fmts";var l="px";var j={getContentHeight:function(t,w){var u=w.ttl&&w.ttl.height;if(t&&u&&!this.floatingToolbar){return Math.max(parseInt(t,10)-parseInt(u,10),0)+l;}return"";},getPortletMinHeight:function(t){return t.ttl.height;},adjustTitleCss:function(){return ;}};var f={getContentHeight:function(t){return t;},getPortletMinHeight:function(){return 0;},adjustTitleCss:function(t){t.titlebarNodeClass+=" floating";return ;}};function A(x,u){var w=this.parent,t=x+"DirtyKey";if(w[t]){w[t](u);}}function P(){this.toolbarTitleTextNode.innerHTML=this.title+(this.count?" ("+this.count+")":"");}function h(){var u=this.parent,x=u&&u.defn;if(x&&parseInt(x.t,10)===mstrmojo.EnumRWUnitType.PANEL){var t=u.parent,w=t.defn;if(w&&w.ifp){return t;}}return null;}var R=mstrmojo.hash,G=2;mstrmojo.DocPortlet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable],{scriptClass:"mstrmojo.DocPortlet",floatingTitle:false,floatingTitleHeight:30,n:"",buttonWidth:17,markupString:'<div class="mstrmojo-portlet {@borderCss}" nm="{@n}" style="{@portletNodeCssText}"><div class="mstrmojo-portlet-slot-shadow" style="{@shadowNodeCssText}"></div><div class="mstrmojo-portlet-container" style="{@portletContainerNodeCssText}"><div class="mstrmojo-portlet-titlebar {@titlebarNodeClass}" style="{@titlebarNodeCssText}"><table style="height:100%;width:100%" class="mstrmojo-portlet-titlebar-table" cellspacing="0" cellpadding="0"><tr><td class="mstrmojo-portlet-slot-toolbar-left {@leftToolbarNodeClass}" style="{@leftToolbarNodeCssText}"></td><td class="mstrmojo-portlet-title" style="{@titleNodeCssText}"><div style="overflow: hidden;"></div></td><td class="mstrmojo-portlet-slot-toolbar {@toolbarNodeClass}" style="{@rightToolbarNodeCssText}"></td></tr></table></div><div class="mstrmojo-portlet-buttonbar {@buttonbarNodeClass}" style="{@buttonbarNodeCssText}"></div><div class="mstrmojo-portlet-slot-content" style="{@contentNodeCssText}"></div></div></div>',rightToolbarNodeCssText:"",leftToolbarNodeCssText:"",titleNodeCssText:"",titlebarNodeClass:"",titlebarNodeCssText:"",contentNodeCssText:"",borderCss:"no-border",buttonbarNodeClass:"",buttonbarNodeCssText:"",markupSlots:{containerNode:function(){return this.domNode.lastChild;},portletNode:function(){return this.domNode;},portletContainerNode:function(){return this.domNode.lastChild;},dimNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;},titleNode:function(){return this.domNode.lastChild.childNodes[0];},buttonbarNode:function(){return this.domNode.lastChild.childNodes[1];},toolbarNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[2];},toolbarTitleTextNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[1].firstChild;},leftToolbarNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[0];},contentNode:function(){return this.domNode.lastChild.lastChild;}},markupMethods:{ontitleChange:function(){P.call(this);},oncountChange:function(){P.call(this);},onfcChange:function(){if(this.fc&&this.content){this.updateContentHeight();}}},formatHandlers:{portletContainerNode:["RW","B","fx","background-color"],shadowNode:["RW","B","fx","background-color"],buttonbarNode:{src:"ttl",props:["background-color"]},titlebarNode:{src:"ttl",props:["F","B","background-color","height","fx","text-align","vertical-align"]},titleNode:{src:"ttl",props:["vertical-align","P","text-decoration"]}},updateServer:true,fc:false,content:null,rightToolbar:null,leftToolbar:null,floatingToolbar:false,_ts:j,getCacheKey:function F(){return this._super()+"-portlet";},getFormats:function M(){var u=this.content,t=u&&u.getFormats();return t&&t[o];},updateContentHeight:function d(z){var t=this.getFormats(),u=this.content,x=u.dimNode||u.domNode,w=((t.ttl&&parseInt(t.ttl.height,10))||0);if(x){if(!z){w+=((this.fc||this.isInFilterPanel())?x.offsetHeight:(t.height?parseInt(t.height,10):0));}this.containerNode.style.height=w+l;this.shadowNode.style.height=w+l;}},init:function p(t){this._super(t);var u=this.content;this.n=(t&&t.defn&&t.defn.n)||"";if(u&&u.getFormats()&&!this.getFormats()){this._createFormats();}},preBuildRendering:function B(){var u=this._ts=(this.floatingTitle)?f:j;if(this.isInFilterPanel()){var w=R.clone(this.formatHandlers);w.portletContainerNode=["z-index","height","B","backgroud-color"];w.shadowNode=["z-index","height","B","fx","background-color"];this.formatHandlers=w;}this._super();u.adjustTitleCss(this);var t="display:none;";if(!this.leftToolbar){this.leftToolbarNodeCssText+=t;}if(!this.toolbar){this.toolbarNodeCssText+=t;}var x=mstrmojo._Formattable.getBorderWidths(this);if(x.l||x.t||x.r){this.borderCss="has-border";}},postBuildRendering:function Y(){var x=mstrmojo.dom,AF=this.titleNode,AE=this.onclicktitle;if(this.floatingTitle&&this.titleNode){document.body.appendChild(this.titleNode);var z=mstrmojo.css,AB=this.contentNode,AC=this;if(!this._onhover){this._onhovertt=function(){z.addClass(AC.titleNode,["visible"]);AC._onflt=true;return true;};this._onhoverofftt=function(){z.removeClass(AC.titleNode,["visible"]);AC._onflt=false;return true;};this._onhover=function(){var AG=AC.titleNode;z.addClass(AG,["visible"]);var AH=x.position(AC.contentNode,true);AG.style.top=(AH.y-AG.clientHeight+2)+l;AG.style.left=AH.x+l;return true;};this._onhoveroff=function(){z.removeClass(AC.titleNode,["visible"]);return true;};}x.attachEvent(AB,"mouseover",this._onhover);x.attachEvent(AB,"mouseout",this._onhoveroff);x.attachEvent(AF,"mouseover",this._onhovertt);x.attachEvent(AF,"mouseout",this._onhoverofftt);}if(AF&&AE){x.attachEvent(AF,"click",AE);}if(this._super){this._super();}var AA=this.getFormats();this.set("fc",AA&&!AA.height);if(this.isInFilterPanel()&&!this.isHorizFP()){var u=this.portletContainerNode.style,w=this.shadowNode.style,AD=this.parent;u.width=w.width="99%";u.top=w.top=AD.topStart+l;u.left=w.left=G+l;}else{if(this.isInFilterPanel()&&this.isHorizFP()){G=8;this.portletContainerNode.style.left=this.shadowNode.style.left=parseInt(AA.left,10)+G*this.orgPos+l;}else{if(this.defn.ifp){this.adjustFPHeight2Fit();}}}if(this.buttonbarNode.clientHeight>0){this.buttonbarNode.style.height=this.buttonbarNode.clientHeight*this.model.getZoomFactor()+"px";}},adjustFPHeight2Fit:function(){var w=mstrmojo.dom,t=w.position(this.titleNode),u=w.position(this.contentNode).y-t.y-t.h;this.content.domNode.style.height=parseInt(this.defn.fmts.height,10)-u+"px";},unrender:function E(w){if(this.floatingTitle&&this.titleNode){var z=this.domNode,u=this.titleNode,x=mstrmojo.dom;if(z&&this._onhover){x.detachEvent(z,"mouseover",this._onhover);}if(z&&this._onhoveroff){x.detachEvent(z,"mouseout",this._onhoveroff);}if(u&&this._onhovertt){x.detachEvent(u,"mouseover",this._onhovertt);}if(u&&this._onhoverofftt){x.detachEvent(u,"mouseout",this._onhoverofftt);}if(u){document.body.removeChild(u);}}if(this._super){this._super(w);}},updateStyle:function(u,t){var z=this.shadowNode.style,x=this.containerNode.style;z.height=x.height=u;z.width=x.width=t;},_createFormats:function V(){var AA=this.content&&this.content.getFormats(),x;x=AA.p_fmts={};var t,z;for(t in Q){z=Q[t];if(AA[z]!==undefined){x[z]=AA[z];delete AA[z];}}for(t in X){z=X[t];if(AA[z]!==undefined){x[z]=AA[z];}}AA.height=this._ts.getContentHeight(AA.height,x);if(mstrmojo.dom.isIE&&x.fx&&x.fx.ds&&!x["background-color"]){x["background-color"]="#ffffff";}var w=x.ttl,u=w&&w["background-color"];if(u){this.titlebarNodeClass=mstrmojo.color.getContrastingColor(u,"light","dark");}},refresh:function q(){if(!this.hasRendered){return ;}var u=this.children,t;for(t=u.length-1;t>=0;t--){u[t].refresh();}},isInFilterPanel:function L(){return(h.call(this)!==null);},isHorizFP:function(){if(this.isInFilterPanel()){var t=this.getFilterPanel();return t&&t.defn&&parseInt(t.defn.fds,10)===2;}return false;},getFilterPanel:function H(){return h.call(this);},getContainerHeight:function c(){return this.containerNode.clientHeight;},relocate:function C(t){if(this.isInFilterPanel()&&!this.isHorizFP()){this.portletContainerNode.style.top=this.shadowNode.style.top=t+l;}},setInfoWindowDimensions:function n(z){var u=this.domNode.style,t=this.shadowNode.style,w=this.portletContainerNode.style,x=mstrmojo._Formattable.getBorderWidths(this);z.h-=x.h;z.w-=x.w;t.height=w.height=u.height=z.h+l;t.width=w.width=u.width=z.w+l;z.h-=this.titleNode.offsetHeight;this.toolbarNode.style.display="none";},addDirtyKey:function K(t){A.call(this,"add",t);},removeDirtyKey:function J(t){A.call(this,"remove",t);},setDirtyChildren:function Z(){var t=this.content;if(t&&t.setDirtyChildren){t.setDirtyChildren.apply(t,arguments);}}});var W=0,O=1,k=2;function N(t){var u=this.content.defn;if(u){u.set("ds",t);}}function m(t){return{FormattingOrder:{ZIndex:this.getFormats()["z-index"]},FormattingView:{WindowState:t}};}function a(AG,AE,t,AH){var AD=this.content,AF=AD.k,AC=mstrmojo.boxmodel.px2Inches,x=AD.model.docModel||AD.model,AJ=x.getZoomProps(),z=this.getFormats(),u=AE!==undefined&&t!==undefined,AI={},AA=this,AB=m.call(this,AG);if(u){AB.FormattingSize={OldHeight:AC(AJ,AE),OldWidth:AC(AJ,t),Height:AC(AJ,parseInt(z.height,10)),Width:AC(AJ,parseInt(z.width,10))};}AI.success=function(w){var AK=w&&w.data;if(AK){x.loadPartialData(AK,AF);}N.call(AA,AG);var AL=AA.parent;if(AL.adjustSectionSize&&u){AL.adjustSectionSize();}};x.updateUnitFormat(AD,1,AB,AI,{params:{suppressData:true},config:u?null:{silent:true},preserveUndo:true});if(!u&&!(AH&&AH.all)){x.saveRWProps(AF,props,1,this.loadDataOnResize,AI,true);}}function T(){var AB=this.content;if(!AB){return ;}var z=function(AF){mstrmojo.array.forEach(AF,function(AG){if(AG.ds!==undefined){AG.set("visible",(AG.ds!==AB.defn.ds));}});},AC;if(this.isInFilterPanel()){var w=(parseInt(this.defn.ds,10)===W);AB.set("visible",w);this.updateContentHeight(!w);AC=this.leftToolbar;z(AC&&AC.children);var x=this.parent;if(x.refreshFP){x.refreshFP();}}else{var t=AB.getFormats(),AD=this.getFormats(),u=this.portletContainerNode.style,AE=this.shadowNode.style,AA=this.contentNode.firstChild.style;AA.height=t.height;AA.width=t.width;AE.height=u.height=AD.height;AE.width=u.width=AD.width;AE.top=u.top=AD.top;AE.left=u.left=AD.left;if(AD["z-index"]!==undefined){AE.zIndex=u.zIndex=AD["z-index"];}AC=this.rightToolbar;z(AC&&AC.children);if(AB.resize){AB.resize();}}}mstrmojo.DocResizablePortlet=mstrmojo.declare(mstrmojo.DocPortlet,null,{scriptClass:"mstrmojo.DocResizablePortlet",loadDataOnResize:false,_createFormats:function V(){this._super();var u=this.getFormats();var t=parseInt(this.defn.ds,10);if(t===W){u.normHeight=u.height;u.normWidth=u.width;if(u["z-index"]!==null&&u["z-index"]!==undefined){u.normZIndex=u["z-index"];}}if(t!==k){u.normTop=u.top;u.normLeft=u.left;}},onmaximize:function e(){var x=this.parent,AB=this.content,AA=AB&&AB.getFormats(),w=this.getFormats(),u=w.height,t=w.width,z=mstrmojo._Formattable.getBorderWidths(this);this.clearCache();AB.clearCache();w.height=(parseInt(x.getHeight(),10)-z.h)+l;AA.height=this._ts.getContentHeight(w.height,w);w.width=AA.width=(x.getWidth()-z.w)+l;w.top=w.left=0;w["z-index"]=x.getMaxZIndex()+1;a.call(this,k,u,t);},onminimize:function b(){var AA=this.content,u=AA.dimNode||AA.domNode,z=AA&&AA.getFormats(),x=this.getFormats(),w=x.height||u.offsetHeight,t=x.width;this.clearCache();AA.clearCache();x.width=z.width=x.normWidth;x.top=x.normTop;x.left=x.normLeft;if(x.normZIndex!==null&&x.normZIndex!==undefined){x["z-index"]=x.normZIndex;}z.height=0;x.height=this._ts.getPortletMinHeight(x);a.call(this,O,w,t);},onrestore:function S(){var z=this.content,x=z&&z.getFormats(),w=this.getFormats(),u=w.height,t=w.width;this.clearCache();z.clearCache();w.height=w.normHeight;x.height=this._ts.getContentHeight(w.height,w);w.width=x.width=w.normWidth;w.top=w.normTop;w.left=w.normLeft;if(w.normZIndex!==null&&w.normZIndex!==undefined){w["z-index"]=w.normZIndex;}a.call(this,W,u,t);},changeWindowState:function I(x){N.call(this,x);var u=this.content,z=m.call(u,x),t=u.model.docModel||u.model;return t.getUnitFormatAction(u,1,z);},oncollapse:function U(t){a.call(this,O,undefined,undefined,t);},onexpand:function D(t){a.call(this,W,undefined,undefined,t);},adjustFP:function g(){var u=(parseInt(this.defn.ds,10)===W);this.content.set("visible",u);this.updateContentHeight(!u);var t=this.parent;if(t.refreshFP){t.refreshFP();}},postBuildRendering:function Y(){if(!this._sub_dsChange){this._sub_dsChange=this.defn.attachEventListener("dsChange",this.id,T);}this._super();if(this.isInFilterPanel()){var t=(parseInt(this.defn.ds,10)===W);this.updateContentHeight(!t);}}});mstrmojo.DocPortlet.ST_RESTORE=W;mstrmojo.DocPortlet.ST_MAX=k;mstrmojo.DocPortlet.ST_MIN=O;}());(function(){mstrmojo.requiresCls("mstrmojo.Arr","mstrmojo.Button","mstrmojo.HBox","mstrmojo.FishEye");var A=function(B){return mstrmojo.hash.copy(B,{scriptClass:"mstrmojo.Button",text:"",enabled:false,dir:"left",cssClass:"mstrmojo-icon left",onclick:function(){var D=this.parent.fishEyeList,C=D&&D.scroll(this.dir,D.step);}});};mstrmojo.FishEyeContainer=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.FishEyeContainer",cssClass:"mstrmojo-FishEyeContainer",selectedIndex:-1,setItems:function(B){this.fishEyeList.set("items",B);},setSelectedIndex:function(B){this.fishEyeList.set("selectedIndex",B);},scrollable:false,rightScrollbale:false,children:[A({bindings:{enabled:"!!this.parent.scrollable"}}),({scriptClass:"mstrmojo.FishEye",alias:"fishEyeList",items:mstrmojo.Arr.makeObservable([]),srcId:"obList"}),A({alias:"feScrollRight",cssClass:"mstrmojo-icon right",dir:"right",bindings:{enabled:"!!this.parent.rightScrollable"}})]});mstrmojo.css=mstrmojo.hash.copy({getStyleValue:function(D,E){var B=null;if(D.currentStyle){E=(E==="float"?"styleFloat":E);B=D.currentStyle[E];}if(document.defaultView&&document.defaultView.getComputedStyle){E=(E==="float"?"cssFloat":E);var C=document.defaultView.getComputedStyle(D,null);B=C?C[E]:null;}return B;},setStyleValue:function(D,F,E){var B=function(G){return !!(G&&(typeof G==="object")&&(typeof G.length==="number"));};if(B(F)&&B(E)){var C;for(C in F){D.style[F[C]]=E[C];}}else{D.style[F]=E;}}},mstrmojo.css);}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.dom","mstrmojo.TreeNodeSelector");var B=mstrmojo.dom,A={0:"closed",1:"opened",2:"leaf"};mstrmojo.TreeNode=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.TreeNode",markupString:'<li id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseover><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><ul class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</ul></li>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);},onstateChange:function(){this.stateNode.className="mstrmojo-TreeNode-state "+(A[this.state]||"closed");this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},onselectedChange:function(){var D=this.selected?"addClass":"removeClass";mstrmojo.css[D](this.domNode.firstChild,["selected"]);},ondropCuePosChange:mstrmojo.WidgetList.prototype.markupMethods.ondropCuePosChange},renderOnScroll:false,listSelector:mstrmojo.TreeNodeSelector,premousedown:function C(D){var E=this._super(D),F=B.eventTarget(D.hWin,D.e);if(F===this.stateNode){if(this.state!==2){this.set("state",this.state===1?0:1);}}return E;},preclick:function(D){mstrmojo.dom.stopPropogation(D.hWin,D.e);},prechange:function(D){var E=this._super(D);if(E!==false){var F=this.tree;if(F&&F.onnodechange){F.onnodechange(D);}}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dnd","mstrmojo.ui._HasScroller");function Z(f){var h=document.createElement("div"),g=h.style,e=f.domNode;h.className="mstrmojo-DataGrid-avatar";g.height=e.clientHeight+"px";e.appendChild(h);f.avatar=h;return h;}function Q(e){var f=mstrmojo.dom.position(e.domNode,true);return f.x;}function O(e){return'<div class="mstrmojo-DataGrid-resizeHandle" unselectable="on" onselectstart="return false" rh="'+e+'"></div>';}function b(g){var f=g.getAttribute("rh"),e=f&&parseInt(f,10);return e;}function Y(f,j,e){var h=e.src,k=h&&h.data,g=k&&k.resizingIdx;if(!(g&&g>0)){return j&&j.apply(f,[e]);}}mstrmojo.RESIZE_NEXT_COLUMN_MODE={getRange:function G(h,g){var e=h.colSizeArray;var f=[-e[g-1]+h.minColWidth,(g==e.length-1)?e[g]-h.resizeHandleWidth-h.minColWidth:e[g]-h.minColWidth];return f;},updateSize:function F(h,g,f){var e=h.colSizeArray;e[g-1]=e[g-1]+f;e[g]=e[g]-f;},updateColumnWidth:function T(h,f,j,g){var e=h.colSizeArray;f[g-1].style.width=e[g-1]+"px";j[g-1].style.width=e[g-1]+"px";f[g].style.width=e[g]+"px";j[g].style.width=e[g]+"px";}};mstrmojo.RESIZE_ALL_COLUMN_MODE={getRange:function G(k,j){var l=k.minColWidth+k.resizeHandleWidth,e=k.colSizeArray,g=0;for(var h=j;h<e.length;++h){g+=e[h]-l;}var f=[-e[j-1]+l,g];return f;},updateSize:function F(h,m,f){var l=h.minColWidth+h.resizeHandleWidth,j=h.colSizeArray;j[m-1]=j[m-1]+f;var e=[];for(var g=0;g<j.length-m;++g){e[g]=m+g;}e.sort(function(o,p){return j[o]-j[p];});for(var g=0;g<e.length;++g){var n=f/(e.length-g);var k=j[e[g]];f-=(k>=n+l)?n:k-l;j[e[g]]=(k>=n+l)?k-n:l;}},updateColumnWidth:function T(j,f,k,h){var e=j.colSizeArray;for(var g=h-1;g<e.length;++g){f[g].style.width=e[g]+"px";k[g].style.width=e[g]+"px";}}};mstrmojo._CanResizeColumn=mstrmojo.provide("mstrmojo._CanResizeColumn",{draggable:true,dropZone:false,avatar:null,colSizeArray:null,resizableColumns:true,resizeHandleWidth:10,minColWidth:5,resizeColumnBehavior:mstrmojo.RESIZE_NEXT_COLUMN_MODE,createColSizeArray:function c(){var f,k,h,g,j,e;k=this.headerContainerNode;h=k&&k.getElementsByTagName("table")[0];g=h.rows[0].cells;f=[];for(j=0,e=g.length;j<e;j++){f.push(g[j].offsetWidth);}return f;},postBuildRendering:function V(){if(this._super){this._super();}if(this.avatar){this.domNode.appendChild(this.avatar);}this.colSizeArray=null;},getDragData:function E(e){var g=e.src,h=g.node,f=b(h);if(f&&f>0){return{resizingIdx:f,startingX:g.pos.x,baseX:Q(this)};}if(this._super){return this.dropZone&&this._super(e);}return null;},allowDrop:function K(e){var g=e.src,h=g&&g.data,f=h&&h.resizingIdx;if(f&&f>0){return true;}return this.dropZone;},ondragenter:function R(e){Y(this,this._super,e);},ondragover:function S(e){Y(this,this._super,e);},ondragleave:function B(e){Y(this,this._super,e);},ondrop:function W(e){Y(this,this._super,e);},isDragValid:function C(e){var g=e.src,h=g&&g.data,f=h&&h.resizingIdx;if(f&&f>0){return true;}if(this._super){return this._super(e);}return false;},ondragstart:function X(e){var h=e.src,j=h&&h.data,g=j&&j.resizingIdx;if(g&&g>0){var f=this.avatar||Z(this);this.ownAvatar=true;f.style.left=(j.startingX-j.baseX)+"px";f.style.display="block";document.body.style.cursor="col-resize";if(!this.colSizeArray){this.colSizeArray=this.createColSizeArray();this._firstTimeResize=true;}j.resizingRange=this.resizeColumnBehavior.getRange(this,g);return ;}if(this._super){this._super(e);}},ondragmove:function P(f){var n=f.src,g=n&&n.data,l=g&&g.resizingIdx;if(l&&l>0){var m=f.tgt,h=this.avatar,k=g.resizingRange,j=m.pos.x-g.startingX,e=Math.min(k[1],Math.max(j,k[0]));g.deltaX=e;if(h){h.style.left=(g.startingX-g.baseX+e)+"px";}}else{if(this._super){this._super(f);}}},ondragend:function L(j){var q=j.src,k=q&&q.data,o=k&&k.resizingIdx;if(o&&o>0){var e=this.titleColGroup,p=e&&e.childNodes,m=this.dataColGroup,n=m&&m.childNodes,h=p.length,l=this.colSizeArray,f=k.deltaX;this.resizeColumnBehavior.updateSize(this,o,f);if(this._firstTimeResize){var g;for(g=0;g<h;g++){p[g].style.width=l[g]+"px";n[g].style.width=l[g]+"px";}this._firstTimeResize=false;}else{this.resizeColumnBehavior.updateColumnWidth(this,p,n,o);}this.avatar.style.display="none";document.body.style.cursor="";this.ownAvatar=false;}else{if(this._super){this._super(j);}}}});mstrmojo.requiresCls("mstrmojo._CanResizeColumn","mstrmojo.ListMapperTable","mstrmojo.WidgetList");function J(g){var k=document.createElement("colgroup"),e=g.length,f,j;for(j=0;j<e;j++){var h=document.createElement("col");f=g[j];if(f.colWidth){h.style.width=f.colWidth+"px";}h.className=f.colCss||("col"+j);k.appendChild(h);}return k;}function I(f){var g=f._headerWidgets_,e=g&&g.length;if(e>0){var h;for(h=0;h<e;h++){g[h].destroy(true);}}}function A(j,e,h,l,f){var g=[],k=j.headerWidget;h=h?(" "+h):"";l=l||this._headerWidgets;f=f?(" "+f):' w="1"';g.push("<td"+h+">");if(e>0&&this.resizableColumns){g.push(O(e));}g.push('<div class="mstrmojo-DataGrid-headerText');g.push(j.headerCss?" "+j.headerCss:"");if(k){l.push(mstrmojo.hash.copy(k));g.push('"'+f+">");}else{g.push('">');}g.push(j.headerText||"&nbsp");g.push("</div>");g.push("</td>");return g.join("");}function a(e,m){var g,k,l,f,n,j,h=[];e=e||"_headerWidgets";m=m||"1";g=this[e];k=g.length;if(k>0){l=this.headerContainerNode.getElementsByTagName("div");f=mstrmojo.array.filter(l,function(o){return o.getAttribute("w")==m;});for(j=0;j<k;j++){g[j].placeholder=f[j].firstChild;g[j].dataGrid=this;n=mstrmojo.registry.ref(g[j]);n.render();h.push(n);}}this[e+"_"]=h;}mstrmojo.DataGrid=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._CanResizeColumn,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DataGrid",banding:true,resizableColumns:true,columns:null,items:null,listMapper:mstrmojo.WidgetListMapperTable,lockHeader:false,contentWidth:"",renderHook:{},markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild.firstChild;},dropCueNode:function(){return this.domNode.lastChild.lastChild;},headerContainerNode:function(){return this.domNode.firstChild;}},markupMethods:{oncontentWidthChange:function(){var f=this.contentWidth,g=this.headerContainerNode,e=this.itemsContainerNode;if(f&&g&&e){g.style.width=f;e.style.width=f;}},onlockHeaderChange:function(){mstrmojo.css.toggleClass(this.domNode,"lockHeader",this.lockHeader);},onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";}},setupScrollNodes:function M(){this.scrollNode=this.scrollboxNode;},itemFunction:function(g,e,f){var h=new mstrmojo.DataRow({columns:f.columns,data:g,idx:e,dataGrid:f,parent:f});return h;},preBuildRendering:function D(){var k=this.renderHook;if(k&&k.pre){k.pre.apply(this,[A]);}else{var f=this.columns,e=f.length,g=['<table class="mstrmojo-DataGrid-headerTable" cellspacing="0" cellpadding="0"><tr>'],j;this._headerWidgets=[];var h;for(h=0;h<e;h++){j=A.apply(this,[f[h],h]);g.push(j);}g.push("</tr></table>");this.headerHtml=g.join("");}if(this._super){this._super();}},postBuildRendering:function V(){if(this._super){this._super();}var g=this.renderHook;if(g&&g.post){g.post.apply(this,[J,a]);}else{a.apply(this);this.titleColGroup=J(this.columns);}var e=this.titleColGroup,m=e.cloneNode(true),j=this.headerContainerNode,l=j&&j.getElementsByTagName("table")[0],n=this.itemsContainerNode,k=this.scrollboxNode,h=this.domNode,f=n&&n.getElementsByTagName("table")[0];this.dataColGroup=m;if(l&&f){l.insertBefore(e,l.firstChild);f.insertBefore(m,f.firstChild);}if(this.lockHeader){k.style.height=h.offsetHeight-j.offsetHeight+"px";mstrmojo.dom.attachEvent(k,"scroll",function(o){j.style.left=-k.scrollLeft+"px";});}},refresh:function H(e){I(this);if(this._super){this._super(e);}},destroy:function d(e){I(this);this._super(e);},unrender:function U(j){var g=this._headerWidgets_,f=g&&g.length,e;if(f>0){var h;for(h=0;h<f;h++){e=g[h];if(e&&e.hasRendered){e.unrender(true);}}}this._super(j);}});mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Container");mstrmojo.DataRow=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DataRow",cssClass:"mstrmojo-DataRow",columns:null,markupMethods:{onselectedChange:function(){mstrmojo.css.toggleClass(this.domNode,"selected",this.selected);}},buildDom:function(){this.children=[];var k=document.createElement("tr"),o=this.data,t=this.idx,f=this.dataGrid,l=this.cssClass,x=this.columns,e=this.children,g,p=-1,u,q;k.setAttribute("id",this.id);if(f.banding){l+=(t%2==1)?" odd":" even";}k.className=l+(mstrmojo.string.isEmpty(o[f.itemDisplayField||"n"])?" empty-row":"")+(" "+o[f.itemCSSField||"itemCss"]||"");var j,n;for(j=0,n=x.length;j<n;j++){u=x[j];q=(u.dataWidgetBuilder&&u.dataWidgetBuilder(o))||u.dataWidget;g=document.createElement("td");if(u.applyStyle2Cell&&u.colCss){g.setAttribute("class",u.colCss);}k.appendChild(g);if(q){g.setAttribute("w","1");p++;e.push(mstrmojo.hash.copy(q,{slot:"slot"+p,data:o,idx:t,dataGrid:f}));}else{if(u.dataFunction){g.innerHTML=u.dataFunction(o,t,f);}else{var h=mstrmojo.string.htmlAngles(o[u.dataField||"n"])||"&nbsp",m=u.tooltip?' title="'+h+'"':"";g.innerHTML='<div class="mstrmojo-DataRow-text" '+m+">"+h+"</div>";}}}this.initChildren();k.mstrmojoId=this.id;return k;},buildRendering:function N(){this._super();var j=this.domNode.childNodes,e=j.length,h={},g=0,k,f;for(f=0;f<e;f++){k=j[f];if(k.getAttribute("w")=="1"){h["slot"+g]=k;g++;}}this.addSlots(h);}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo._IsDial");mstrmojo.WidgetDial=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._IsDial],{scriptClass:"mstrmojo.WidgetDial"});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.ContextMenuItem","mstrmojo.WidgetList","mstrmojo.ListMapperTable");var H=false,B=20;function G(J,K){var L=J.itemsContainerNode;L.scrollTop=Math.min(Math.max(L.scrollTop+K,0),L.scrollHeight-L.offsetHeight);}function I(K,J){if(!K._scrollInter){var L=B*(J?-1:1);K._scrollInter=window.setInterval(function(){G(K,L);},50);}}function E(J){if(J._scrollInter){window.clearInterval(J._scrollInter);J._scrollInter=null;}}mstrmojo.ContextMenu=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.ContextMenu",zIndex:100,visible:true,makeObservable:true,markupString:'<div id={@id} class="mstrmojo-ContextMenu {@cssClass}" style="z-index: {@zIndex};{@cssText}"><div class="mstrmojo-CM-scrollup" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], true)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], true)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], true)" ></div><div class="mstrmojo-CM-itemsContainer">{@itemsHtml}</div><div class="mstrmojo-CM-scrolldown" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], false)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], false)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], false)" ></div></div>',markupSlots:{scrollupNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1];},scrolldownNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){var K=this.domNode,P=this.itemsContainerNode,N=this.scrollupNode,M=this.scrolldownNode;K.style.display=this.visible?"block":"none";if(this.visible){N.style.display="none";M.style.display="none";P.style.overflow="auto";P.style.height="auto";var J=mstrmojo.dom.windowDim().h,O=K.offsetHeight,L=K.offsetWidth;if(J<O){N.style.display="block";N.style.minWidth=L+"px";M.style.display="block";M.style.minWidth=L+"px";P.style.overflow="hidden";P.style.height=(J-42)+"px";}}},onleftChange:function(){this.domNode.style.left=(this.left!=null)?this.left:"";},ontopChange:function(){this.domNode.style.top=(this.top!=null)?this.top:"";}},listMapper:mstrmojo.WidgetListMapperTable,itemFunction:function C(N,J,L){if(!H){mstrmojo.requiresCls("mstrmojo.ContextMenuItem");H=true;}var K={data:N,parent:L,hasSubmenu:L._cmSource.hasSubmenu(N),dynamicUpdate:L.dynamicUpdate,_cmSource:L._cmSource,zIndex:L.zIndex,itemIdField:L.itemIdField,itemField:L.itemField,itemChildrenField:L.itemChildrenField,itemFunction:L.itemFunction},M=new mstrmojo.ContextMenuItem(K);return M;},onmousedownarrow:function A(L,K,J){I(this,J);},onclickarrow:function F(L,K,J){G(this,B*(J?-1:1));},onmouseuparrow:function D(L,K,J){E(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.Widget","mstrmojo.WidgetList","mstrmojo.Refine.RefineHelpers","mstrmojo.hash");var C=mstrmojo.hash;var D=mstrmojo.Refine.RefineHelpers;mstrmojo.requiresDescs(8953);function H(Y,P,R,S,U){var Q,Z=[],O,X,T,V,W;if(R===0){if(S!==-1&&U!==-1){if(Y.length>U){Z.push(Y.substring(0,S));Z.push(Y.substring(S,U));Z.push(Y.substring(U));}else{if(Y.length>S){Z.push(Y.substring(0,S));Z.push(Y.substring(S));}else{Z.push(Y);}}}else{if(S===-1){if(Y.length>U){Z.push(Y.substring(0,U));Z.push(Y.substring(U));}else{Z.push(Y);}}else{if(Y.length>S){Z.push(Y.substring(0,Y.length-S));Z.push(Y.substring(Y.length-S));}else{Z.push("");Z.push(Y);}}}}else{if(R===1){Q=Y.split(P);for(O=0;O<Q.length;O++){Z.push(Q[O]);}}else{if(R===2){if(Y.match(P)){T=Y.match(P)[0];X=Y.search(P);V=T.length+X;Z.push(Y.substring(0,V));Z.push(Y.substring(V));}else{Z.push(Y);}}else{if(R===3){if(Y.match(P)){V=Y.search(P);Z.push(Y.substring(0,V));Z.push(Y.substring(V));}else{Z.push(Y);}}else{if(R===4){if(Y.match(P)){Z.push(Y.match(P)[0]);}}else{if(R===5){if(Y.match(P)){T=Y.match(P)[0];X=Y.search(P);V=T.length+X;Z.push(Y.substring(V));}}else{if(R===6){if(Y.match(P)){V=Y.search(P);Z.push(Y.substring(0,V));}else{Z.push(Y);}}else{if(R===7){W=new RegExp(P.source,"g");Z.push(Y.replace(W,""));}else{if(R===8){if(Y.match(P)){T=Y.match(P)[0];X=Y.search(P);V=T.length+X;Z.push(Y.substring(0,V));}else{Z.push(Y);}}else{if(R===9){if(Y.match(P)){V=Y.search(P);Z.push(Y.substring(V));}else{Z.push(Y);}}}}}}}}}}}return Z;}function K(U,R,Y,S,T,V){var P,O=0,X,W,Q;if(S===0){if(T!==-1&&V!==-1){return 3;}else{return 2;}}else{if(S===1){for(P=0;P<Y.length;P++){X=Y[P].cells;if(X[U]){W=X[U].v;Q=W.toString().split(R);O=Math.max(Q.length,O);}}}else{if(S===2){return 2;}else{if(S===3){return 2;}else{if(S===4){return 1;}else{if(S===5){return 1;}else{if(S===6){return 1;}else{if(S===7){return 1;}else{if(S===8){return 1;}else{if(S===9){return 1;}}}}}}}}}}return O;}function N(O,P,X,R){var T=[],W,U,Q;switch(X){case 0:case 1:case 2:case 3:for(W=0;W<O;W++){Q={};if(O>4&&W>=2&&W<=O-1){if(W===2){Q.suggestionPreview=true;Q.cellIndex=W;Q.name="...";Q.columnNumber=(O>4?4:O);T.push(Q);}if(W===O-1){Q.suggestionPreview=true;Q.cellIndex=3;Q.name="New Column "+W;Q.columnNumber=(O>4?4:O);T.push(Q);}continue;}Q.suggestionPreview=true;Q.cellIndex=W;Q.name="New Column "+W;Q.columnNumber=(O>4?4:O);T.push(Q);}break;case 4:case 5:case 6:var Y,S,V;Q={};W=1;while(true){Y=P+" "+W;S=true;for(U=0;U<R.length;U++){if(Y===R[U].name){S=false;break;}}W++;if(S){V=Y;break;}}Q.suggestionPreview=true;Q.cellIndex=0;Q.name=V;Q.columnNumber=1;T.push(Q);break;case 7:case 8:case 9:Q={};Q.suggestionPreview=true;Q.cellIndex=0;Q.name=P;Q.columnNumber=1;T.push(Q);break;}return T;}function F(V,S,a,T,O,U,W){var R,Q;for(R=0;R<a.length;R++){var Z=a[R].cells,Y={};var P=[];if(Z[V]){var X=H(Z[V].v.toString(),S,T,U,W);for(Q=0;Q<O;Q++){Y={};if(Q<X.length){Y.v=X[Q];}else{Y.v="";}if(O>4&&Q>=2&&Q<O-1){if(Q===2){Y.v="...";}else{continue;}}Y.columnNumber=(O>4?4:O);P.push(Y);}}else{for(Q=0;Q<O;Q++){Y={};Y.v="";if(O>4&&Q>=2&&Q<O-1){if(Q===2){Y.v="...";}else{continue;}}Y.columnNumber=(O>4?4:O);P.push(Y);}}a[R].cells=[].concat(P);}}function M(Q,O){var P=O.controller;if(Q===1){P.model.raiseEvent({name:"unPreviewSuggestion"});}O.highlighted=false;}function G(O){M(O.src.data.suggestion_type,O.src.suggestions);}function J(X){var V=X.src.suggestions;var S=X.src.data;var Q=JSON.parse(JSON.stringify(V.columns));var U=JSON.parse(JSON.stringify(V.data));if(!V.highlighted){var T=V.controller;if(S.suggestion_type===1){var R,W,O;var P={};C.copy(Q[S.index],P);W=P.cellIndex;O=K(W,S.separator,U.rows,S.suggestion_subtype,S.startOffset,S.endOffset);R=N(O,P.name,S.suggestion_subtype,Q);F(W,S.separator,U.rows,S.suggestion_subtype,O,S.startOffset,S.endOffset);T.model.raiseEvent({name:"previewSuggestion",columns:R,data:U,scrollTop:S.scrollTop,cellPos:V.cellPos});}X.src.suggestions.highlighted=true;}}mstrmojo.Refine.RefineSuggestions=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineSuggestions",markupString:'<div id="{@id}" class="refine-suggestions"><div class="refine-suggestions-list"></div></div>',markupSlots:{listNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},setDimensions:function I(R,P){var O=parseInt(R,10);var Q=parseInt(P,10);if(isNaN(O)||isNaN(Q)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listNode=(O-3)+"px";this.layoutConfig.w.listNode=(Q)+"px";if(this._super){this._super((O)+"px",(Q)+"px");}},highlighted:false,children:[{scriptClass:"mstrmojo.WidgetList",renderOnScroll:false,slot:"listNode",alias:"suggestions",itemFunction:function B(R,O,P){var Q=new mstrmojo.Widget({data:R,markupString:'<div class="list-item" mstrAttach:mouseover,mouseout>'+R.description+"</div>"});if(R.suggestion_type!==undefined){Q.onmouseover=J;Q.onmouseout=G;Q.suggestions=P.parent;}return Q;},populate:function E(U){this.unrender();var R,Q,O=[];var P=this.parent.controller;var S=P.model;var T=P.refinePanel.bottomPanal.splitter.facetPanel;if(T.hasSelection()){R=JSON.parse(JSON.stringify(S.transformations.Delete.DeleteRowsInTheView));R.engineConfig=T.getJSON();var V=T.getRequirementDiscription();R.description=R.description.replace("[Requirement]",V);Q=JSON.parse(JSON.stringify(S.suggestions.partialCell.deleteRows[1]));Q.operations=JSON.stringify([R]);O.push(Q);R=JSON.parse(JSON.stringify(S.transformations.Delete.DeleteRowsNotInTheView));R.engineConfig=T.getJSON();R.description=R.description.replace("[Requirement]",V);Q=JSON.parse(JSON.stringify(S.suggestions.partialCell.deleteRows[2]));Q.operations=JSON.stringify([R]);O.push(Q);U=O.concat(U);}this.set("items",U);this.set("selectedIndex",-1);this.render();this.set("visible",U.length);this.parent.label.set("visible",!U.length);},onchange:function(R){var O=this.parent.controller,P,S,Q,T;if(this.selectedIndex===-1){return ;}if(R.src.selectedItem.suggestion_type===2){P=O.refinePanel.bottomPanal.splitter.facetPanel;P.resetAllFacets();}Q=JSON.parse(R.src.selectedItem.operations);if(Q&&Q.length){T=Q[0];}S={operations:R.src.selectedItem.operations,engine:JSON.stringify({facets:[],mode:"row-based"})};if(O.model.hasAddSample()&&T&&(T.op==="core/fill-down"||T.op==="core/blank-down")){D.confirmFilldownOrBlankdown(function(){O.applyOperations(S);});}else{O.applyOperations(S);}M(this.selectedItem.suggestion_type,this.parent);},multiSelect:false,visible:false},{scriptClass:"mstrmojo.Label",slot:"listNode",alias:"label",cssClass:"refine-suggestions-label",text:mstrmojo.desc(8953,"Suggestions")}],populate:function E(O){this.suggestions.populate(O);},handleDataChanged:function(O){this.data=O.value;},handleColumnsChanged:function(O){this.columns=O.value.columns;},handleGotSuggestions:function L(O){this.populate(O.list);if(O.cellPos){this.cellPos=O.cellPos;}},handleEmptySuggestions:function A(){this.populate([]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.OBList","mstrmojo.ui._IsIncFetchList","mstrmojo.ui._HasScroller");var F=mstrmojo.array,A=mstrmojo.chart.model.enums.EnumDSSObjectType;function D(G){return{browseConfig:null,parent:G,next:function(J){var I=this.browseConfig;if(!I){return ;}I.blockBegin+=I.blockCount;var H={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockBegin:I.blockBegin,blockCount:I.blockCount,includeAncestorInfo:true};if(I.folderLinksContextId){H.folderLinksContextId=I.folderLinksContextId;}if(I.includeObjectDesc){H.includeObjectDesc=I.includeObjectDesc;}if(I.rootFolderID){H.rootFolderID=I.rootFolderID;}else{if(I.rootFolderType){H.rootFolderType=I.rootFolderType;}}if(I.browsableTypes){H.objectType=I.browsableTypes;}if(I.searchPattern){H.searchPattern=I.searchPattern;if(I.recursive){H.recursive=I.recursive;}}this.parent.set("waiting",true);if(I.dataProvider){I.dataProvider.serverRequest(H,J);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,J,H);}},hasNext:function(){var H=this.browseConfig;return(H.blockBegin+H.blockCount-1)<H.totalSize;}};}mstrmojo.mstr.ui.IncFetchOBList=mstrmojo.declare(mstrmojo.OBList,[mstrmojo.ui._IsIncFetchList,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.mstr.ui.IncFetchOBList",cssClass:"mstrmojo-OBList mstrmojo-IF-OBList",makeObservable:true,renderOnScroll:false,waiting:false,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keypress,mousedown,mouseup,dblclick><div class="scroll-box" style="{@scrollBoxCssText}"><div class="mstrmojo-ListBase2-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onwaitingChange:function(){this.onwaitingChange();}},init:function E(G){if(this._super){this._super(G);}this.ifDataHelper=D(this);if(G.browseConfig){this.ifDataHelper.browseConfig=G.browseConfig;}},onwaitingChange:mstrmojo.emptyFn,addItems:function B(G){var H=this.browseConfig.browsableViewMedias;if(G&&H){var I={};F.forEach(H.split(","),function(J){I[parseInt(J,10)]=true;});G=F.filter(G,function(J){return(J.t!==A.DssTypeDocumentDefinition)||I[J.dvm];});}this.add(G,-1);this.set("waiting",false);if(this._super){this._super(G);}if(this.scrollNode){this.updateScrollbars();}},setupScrollNodes:function C(){this.scrollNode=this.scrollboxNode;}});}());(function(){var F=mstrmojo.string;function H(Q,R,K){var L,O,J,M=[],N,S;try{N=new RegExp(mstrmojo.string.regEscape(Q),"i");}catch(P){return M;}for(L=0,O=R.length;L<O;L++){J=R[L][K];N.lastIndex=0;if(N.test(J)){M.push(R[L]);}}return M;}function C(){if(this.searchEnabled){this.iconNode.style.display="none";this.inputBar.style.display="";if(this.autofocus){this.inputNode.focus();this.inputNode.select();}}else{this.hideInputNode();if(this.autofocus){if(mstrmojo.dom.isIE7||mstrmojo.dom.isIE8){var J=this;window.setTimeout(function(){try{J.iconNode.focus();}catch(K){}},100);}else{this.iconNode.focus();}}}}var G={8:"BackSpace",9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};mstrmojo.SearchableDropDownList=mstrmojo.declare(mstrmojo.Pulldown,null,{scriptClass:"mstrmojo.SearchableDropDownList",markupString:'<div id="{@id}" class="mstrmojo-SearchableDropDownList mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}"><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" tabindex="0" mstrAttach:mousedown,keyup>{@text}</div><table class="mstrmojo-InputNodeBar"><colgroup><col class="inputCol"/><col class="iconCol"/></colgroup><tr><td><input class="mstrmojo-SearchableDropDownList-inputNode" value="{@text}" placeholder="{@placeholderText}" mstrAttach:keyup,blur,click/></td><td><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" mstrAttach:mousedown></div></td></tr></table></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupSlots,{inputBar:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.firstChild.lastChild.rows[0].cells[0].firstChild;}}),markupMethods:mstrmojo.hash.copy({ontextChange:function(){this.iconNode.innerHTML=F.decodeHtmlString(this.text);this.inputNode.value=this.text;},onheightChange:function(){var J=parseInt(this.height,10);if(J>=0){this.domNode.style.height=J+"px";this.inputBar.style.height=J+"px";}}},mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupMethods)),popupToBody:true,searchEnabled:false,selectedIndex:-1,placeholderText:"",allItems:null,autofocus:true,focus:function(){C.call(this);},hideInputNode:function B(){this.inputBar.style.display="none";this.iconNode.style.display="block";},postBuildRendering:function A(){if(!this.allItems){this.allItems=this.items;}this._super();C.call(this);},clickInput2pop:false,onclick:function I(J){if(this.clickInput2pop){this.togglePopup();}},prekeyup:function E(R){var K=this.getSearchPattern(),P=[],M,Q=this.inputNode,O=R.e,J,L,N=this.items.length;if(G[O.keyCode]==="Enter"){if(this.items.length>0){this.set("selectedIndex",this.selectedIndex===-1?0:this.selectedIndex);}this.onEnter&&this.onEnter();this.closePopup();return ;}else{if(G[O.keyCode]==="Esc"){this.onEsc&&this.onEsc();if(this.popupRef.visible){this.popupRef.close();}return ;}else{if(G[O.keyCode]==="ArrowDown"){if(!this.popupRef.visible){this.togglePopup();}this.set("selectedIndex",(this.selectedIndex+1)%N);}else{if(G[O.keyCode]==="ArrowUp"){if(this.popupRef.visible&&N>0){this.set("selectedIndex",(this.selectedIndex+N-1)%N);}}else{if(this.searchEnabled){if(K&&K.length>0&&K.indexOf(this.lastSearchPattern)>-1){P=H(K,this.items,this.itemField);}else{P=H(K,this.allItems,this.itemField);}this.set("selectedIndex",-1);this.set("items",P);N=P.length;if(N===0){this.closePopup();}else{if(!this.popupRef.visible){this.togglePopup();}}if(K&&K.length>0){this.set("selectedIndex",mstrmojo.array.find(P,this.itemField,Q.value));}}}}}}this.lastSearchPattern=K;},getSearchPattern:function D(){return F.trim(this.inputNode.value);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo._HasPopup","mstrmojo.string","mstrmojo.Pulldown","mstrmojo.Container");var C=mstrmojo.css;mstrmojo.CustomGroupEl=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.CustomGroupEl",markupString:'<div id="{@id}" class="mstrmojo-onhoverparent mstrmojo-CustomGroupEl {@cssClass}" style="{@cssText}" mstrAttach:mouseover><div class="mstrmojo-CustomGroupEl-title {@cssClass}" mstrAttach:click><img class="mstrmojo-CustomGroupEl-state {@cssClass}" src="../images/1ptrans.gif" align="absmiddle" onclick="var w = mstrmojo.all[\'{@id}\']; w.set(\'state\', !w.state)" /><span class="mstrmojo-text"></span></div><div class="mstrmojo-onhover mstrmojo-abs mstrmojo-topright mstrmojo-CustomGroupEl-tools {@cssClass}"><img class="mstrmojo-dup" src="../images/1ptrans.gif" title="'+mstrmojo.desc(3397,"Duplicate")+'" onclick="mstrmojo.all[\'{@id}\'].dup()" /><img class="mstrmojo-ops" src="../images/1ptrans.gif"onclick="var w = mstrmojo.all[\'{@id}\'].showOps();" title="'+mstrmojo.desc(7932,"Element display options")+'" /><img class="mstrmojo-del" src="../images/1ptrans.gif" onclick="mstrmojo.all[\'{@id}\'].del()" title="'+mstrmojo.desc(7933,"Delete element")+'"/></div><div class="mstrmojo-CustomGroupEl-details {@cssClass}"><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr-tools {@cssClass}"></div></div></div>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},titleNode:function(){return this.domNode.firstChild.lastChild;},detailsNode:function(){return this.domNode.lastChild;},exprNode:function(){return this.domNode.lastChild.firstChild;},exprToolsNode:function(){return this.domNode.lastChild.lastChild;},titlebarNode:function(){return this.domNode.firstChild;}},markupMethods:{ondataChange:function(){var G=this.data,F=G&&G.n;this.titleNode.innerHTML=(F!=null)?mstrmojo.string.encodeHtmlString(F):"";},onstateChange:function(){var F=this.stateNode;F.className="mstrmojo-CustomGroupEl-state "+(this.state?"opened":"closed");this.detailsNode.style.display=this.state?"block":"none";},onselectedChange:function(){C.toggleClass(this.domNode,["selected"],this.selected);},onshowaddChange:function(){this.exprToolsNode.style.display=this.showadd?"block":"none";}},_set_data:function A(H,F){var G=this.data;this.data=F;this.set("expr",F&&F.expr);return G!==F;},optionsRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(7934,"Element Options"),contentNodeCssClass:"mstrmojo-balloon",cssClass:"mstrmojo-CGEOptionsEditor",help:"element_options_dialog_box.htm",ce:false,isp:false,onOpen:function(){var F=this.opener.data,G=this.ops.dsplb.dspl;G.set("value",F.ce?2:(F.isp?1:0));},save:function(){var F=this.ops.dsplb.dspl.value,G=this.opener.data;G.ce=(F==2);G.isp=(F==1);this.close();},children:[{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-ElementOptions",alias:"ops",children:[{scriptClass:"mstrmojo.HBox",alias:"dsplb",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(168,"Display:"),cssText:"margin: 0 5px;"},{alias:"dspl",scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:[{n:mstrmojo.desc(7935,"Display element name only (Default)"),v:0},{n:mstrmojo.desc(7936,"Display individual items only"),v:1},{n:mstrmojo.desc(7937,"Display element name and individual items"),v:2}]}]},{scriptClass:"mstrmojo.HBox",alias:"btns",cssText:"float:right;width:150px;margin:5px;",children:[{scriptClass:"mstrmojo.HTMLButton",alias:"ok",text:mstrmojo.desc(118,"Save"),cssClass:"mstrmojo-Editor-button",cssText:"width:72px;",onclick:function(){this.parent.parent.parent.save();}},{scriptClass:"mstrmojo.HTMLButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-Editor-button",cssText:"width:72px;margin: 5px;",onclick:function(){this.parent.parent.parent.close();}}]}]}]},showOps:function(){var G=this.titlebarNode,F=mstrmojo.dom.position(G,true);this.openPopup("optionsRef",{zIndex:30,left:Math.round(F.x+F.w-300)+"px",top:Math.round(F.y+F.h)+"px"});},init:function E(F){this._super(F);var G=this.data;if(G){delete this.data;this._set_data(null,G);}},del:function B(){var F=this.parent;if(F&&F.remove){F.remove(this.data);}},dup:function D(){var F=this.parent;if(F&&F.duplicate){var K=this.data,L=F.items,N=K.did,M=1,O=new RegExp(K.n+"_(\\d+)");for(var I=0,J=L.length;I<J;I++){var H=L[I],G=H.n&&H.n.match(O);if(G){M=Math.max(M,G[1]);}N=Math.max(N,parseInt(H.did,10));}F.duplicate(this.data,null,{n:mstrmojo.desc(3651,"Copy of ##").replace("##",K.n),did:F.getNextId(),state:1});}},onmouseover:function(F){this.set("showadd",this.state?true:false);}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBox","mstrmojo.ListBoxHoriz");var A={render:function(F,B,G){var H=(G.htmlName+B),D=G.selectedIndices[B]?"checked ":"",E=D?" selected":"",C=F.v!=="u;"?" nAll":"";return'<div class="'+G.itemCssClass+E+C+'"><input type="'+G.inputType+'" name="'+G.htmlName+'" id="'+H+'" value="'+B+'" '+D+'/><label for="'+H+'" title="'+(F[G.itemTitleField]||"")+'" style="'+G.labelCssText+'">'+F[G.itemDisplayField||"n"]+"</label></div>";},select:function(D,E,B,F){var C=D&&D.firstChild;if(C&&!C.checked){C.checked=true;}mstrmojo.css.toggleClass(D,"selected",C.checked);},unselect:function(D,E,B,F){var C=D&&D.firstChild;if(C&&C.checked){C.checked=false;}mstrmojo.css.toggleClass(D,"selected",C.checked);},rowHeight:23};mstrmojo._RendersInputItems=mstrmojo.provide("mstrmojo._RendersInputItems",{inputType:null,htmlName:null,itemRenderer:A,init:function(B){this._super(B);if(!this.htmlName){this.htmlName=this.id;}},preclick:function(E){var D=E.hWin,G=E.e,F=mstrmojo.dom.eventTarget(D,G);if(F&&F.nodeName.match(/input/i)){var C=parseInt(F.value,10);if(this.inputType&&this.inputType.match(/radio/i)){this.singleSelect(C);}else{var B=(F.checked)?"add":"remove";this[B+"Select"](C);}}}});mstrmojo._InputList=mstrmojo.declare(mstrmojo.ListBox,[mstrmojo._RendersInputItems],{scriptClass:"mstrmojo._InputList"});mstrmojo._InputListHoriz=mstrmojo.declare(mstrmojo.ListBoxHoriz,[mstrmojo._RendersInputItems],{scriptClass:"mstrmojo._InputListHoriz"});}());(function(){mstrmojo.requiresCls("mstrmojo.LegacySuggestionList","mstrmojo.ui._HasScroller");var C=mstrmojo.dom;mstrmojo.ui.ScrollableSuggestionList=mstrmojo.declare(mstrmojo.LegacySuggestionList,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",markupString:'<div id="{@id}" class="mstrmojo-ListBase mstrmojo-scrollable-suggestlist {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function B(){return this.domNode.firstChild.firstChild;},scrollboxNode:function E(){return this.domNode.firstChild;},scrollNode:function H(){return this.domNode.firstChild;}},onclick:function A(I){var J=this.getItemFromTarget(I.getTarget());if(J){this._super(I);}},onitemsChange:function D(){var I=this;window.setTimeout(function(){I.hideTooltip();I.updateScrollbars();},0);},updateScrollbars:function F(){this._super();var K=this,M=K.scrollNode,I=M.clientWidth,L=K.itemsContainerNode,J=L.clientWidth;L.style.width="auto";window.setTimeout(function(){if(I>J){L.style.width=J+(I-J)+"px";}},10);},useRichTooltip:true,getItemTooltip:function(L,M){var J=C.position(M),K=M.ttp;var I={areaId:L._renderIdx+"text",cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:K,top:J.y,left:J.x+J.w+6,enableHover:false};return I;},showTooltip:function G(I,L){var K=this.targetEl,J=this.targetItem;if(K&&K.ttp){this.richTooltip=this.getItemTooltip(J,K);if(this.richTooltip){this._super(I,L);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.qb.DBTableView","mstrmojo.qb.EnumDataChangeEvents","mstrmojo.qb.EnumDragActions","mstrmojo.qb.EnumMenuActions","mstrmojo.dom","mstrmojo.hash","mstrmojo.array");var I=mstrmojo.dom,E=mstrmojo.hash,K=mstrmojo.array,B="px",P=mstrmojo.qb.EnumDataChangeEvents,F=P.REMOVE,N=mstrmojo.qb.EnumDragActions.ADD_TABLE;function L(Q){var S=Q.item,R=Q.did||S.id,T=Q.name;K.forEach(this.children,function(U){if(U.isItemAvailable(R)){var V=U.handleEvent(Q);if(!V){switch(T){case F:this.removeTable(U.tableData);break;}}}},this);}mstrmojo.qb.TableContainer=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.TableContainer",markupString:'<div id="{@id}" class="mstrmojo-qb-TableContainer {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-tc-container"></div></div>',markupSlots:{containerNode:function D(){return this.domNode.lastChild;}},init:function O(R){this._super(R);var S={},Q=S[this.id]={};Q[P.TABLES_ADDED]=function T(U){K.forEach(U.tableItems,function(V){this[((U.toAdd?"add":"remove")+"Table")](V);},this);};Q[P.TABLE_CHANGED]=Q[P.RENAME]=Q[F]=L;},addTable:function C(U){var S=this,R=this.children,T=U.id;K.forEach(R,function(V){if(V.isItemAvailable(T)){this.removeTable(U);}},this);if((U.x===undefined)||(U.y===undefined)){var Q=25*(R?R.length:0)+B;U=E.copy({x:Q,y:Q},U);}S.addChildren([new mstrmojo.qb.DBTableView({tableData:U,left:U.x,top:U.y,linker:this.parent.linker})]);},removeTable:function H(S){var Q=this,R=S.id;K.forEach(this.children,function(U,T){if(U.getTableID()===R){Q.removeChildren(Q.children[T]);mstrApp.getRootController().removeFromCurrentLayer(U.tableData);return false;}return true;});},updateTablePositionCache:function A(){var S=this.children,Q=I.position(this.domNode),R=[];K.forEach(S,function(T){var U=I.position(T.domNode);R.push(E.copy({x:((U.x-Q.x)+B),y:((U.y-Q.y)+B),h:U.h+B,w:U.w+B},T.tableData));});mstrApp.getRootController().setTablePositions(R);},refresh:function J(Q){if(Q){this.updateTablePositionCache();}this.removeChildren();K.forEach(mstrApp.getRootController().getTablePositions(),function(R){this.addTable(R);},this);},dropZone:true,allowDrop:function G(Q){return N.indexOf(Q.action)!==-1;},ondrop:function M(R){var T=R.action,V=R.src;if(V&&V.data){var U=V.data;if(T===N){var S=R.tgt.pos,Q=mstrmojo.dom.position(R.tgt.node);U.x=S.x-Q.x+B;U.y=S.y-Q.y+B;mstrApp.getRootController().addWHTable([U],true);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.CheckList","mstrmojo.ImageCheckBox");mstrmojo.requiresDescs(12388);var F=mstrmojo.array,E=mstrmojo.desc;mstrmojo.DI.DIPartition=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPartition",markupString:'<div id="{@id}" class="mstrmojo-di-partition {@cssClass}" style="{@cssText}"><div class="mstrmojo-di-partition-content"></div><div class="mstrmojo-di-partition-notice"></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild;},noticeNode:function(){return this.domNode.lastChild;}},tables:null,sourceId:null,init:function D(I){this._super(I);var K=this.data,J=K&&K.id,G=K&&K.partition;var H=mstrApp.getRootController().getModel();this.isRefined=H.importSources[J].sourceInfo.isRefined;this.sourceId=J;this.tables=mstrApp.getRootController().partitionController.getAllPartitionTables(J,G);F.forEach(this.tables,function(L){L.selected=L.isMember;});if(this.isRefined){F.forEach(this.tables,function(L){L.title="Cannot change partition group after wrangling.";});}this.ontablesChange();},ontablesChange:function C(){var H=this.tables,G=H&&H.length>0;if(G){this.content.set("items",H);}this.content.set("visible",G);this.notice.set("visible",!G);},_close:function(){var G=this.parent;if(G&&G._cmSource){G._cmSource.closeMenuTree();}},onOK:function A(){var H=this.content.items,I=[],G=[],J;J=this.content.getSelectedItems();F.forEach(H,function(K){K.selected=(F.indexOf(J,K)!==-1);});F.forEach(H,function(K){if(K.isMember&&!K.selected){G.push(K.ptIndex.toString());}else{if(!K.isMember&&K.selected){I.push(K.sourceId);}}});if(I.length>0||G.length>0){mstrApp.getRootController().partitionController.changePartition(this.sourceId,I,G);}this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"content",slot:"contentNode",onRender:function B(){var G=this.items,H=[];F.forEach(G,function(I){if(I.selected){H.push(I);}});if(H.length){this.setSelectedItems(H,true);}if(this.parent.isRefined){this.set("enabled",false);}}},{scriptClass:"mstrmojo.Label",alias:"notice",slot:"noticeNode",text:E(12388,"No tables found with the same set of attributes and metrics.")}]});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._hasBigQueryModel","mstrmojo.qb.es.Model");mstrmojo.qb.bigquery.ESModel=mstrmojo.declare(mstrmojo.qb.es.Model,[mstrmojo.qb.bigquery._hasBigQueryModel],{scriptClass:"mstrmojo.qb.bigquery.ESModel",getDBRole:function A(){return{n:this.selectedProject};}});}());(function(){mstrmojo.requiresCls("mstrmojo._InputList","mstrmojo._InputListHoriz");mstrmojo.RadioList=mstrmojo.declare(mstrmojo._InputList,null,{scriptClass:"mstrmojo.RadioList",inputType:"radio",cssClass:"mstrmojo-RadioList",itemCssClass:"mstrmojo-RadioList-item",onenabledChange:function A(B){for(var C=0;C<this.items.length;C++){this._getItemNode(C).firstChild.disabled=!B.value;}}});mstrmojo.RadioListHoriz=mstrmojo.declare(mstrmojo._InputListHoriz,null,{scriptClass:"mstrmojo.RadioListHoriz",inputType:"radio",cssClass:"mstrmojo-RadioListHoriz",itemCssClass:"mstrmojo-RadioListHoriz-item"});})();(function(){mstrmojo.requiresCls("mstrmojo._InputList","mstrmojo._InputListHoriz","mstrmojo.hash");mstrmojo.CheckList=mstrmojo.declare(mstrmojo._InputList,null,{scriptClass:"mstrmojo.CheckList",inputType:"checkbox",cssClass:"mstrmojo-CheckList",itemCssClass:"mstrmojo-CheckList-item"});mstrmojo.requiresCls("mstrmojo._InputListHoriz");mstrmojo.CheckListHoriz=mstrmojo.declare(mstrmojo._InputListHoriz,null,{scriptClass:"mstrmojo.CheckListHoriz",inputType:"checkbox",cssClass:"mstrmojo-CheckListHoriz",itemCssClass:"mstrmojo-CheckListHoriz-item"});})();(function(){mstrmojo.requiresCls("mstrmojo.HTMLButton","mstrmojo._HasContextMenu","mstrmojo.ContextMenu");mstrmojo.MenuButton=mstrmojo.declare(mstrmojo.Button,[mstrmojo._HasContextMenu],{preclick:function A(B){this.showContextMenu();},openPopupMenu:function(){this.showContextMenu();}});})();(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.DataRow","mstrmojo.css","mstrmojo.hash","mstrmojo.ui._HasScroller");var G=mstrmojo.array,C=2;function L(O){var P=[],N;G.forEach(O,function(Q){N=Q.subColumns;P=P.concat((N&&N.length>1)?N:Q);});return P;}function F(N){G.forEach(N._subHeaderWidgets_,function(O){O.destroy(true);});}function B(V){var S=this.columns,U=['<table class="mstrmojo-DataGrid-headerTable" cellspacing="0" cellpadding="0"><tr>'],N=1,Z=["<tr>"],a=0,O,R,T,Q,Y,X,P,W='w="'+C+'"';this._headerWidgets=[];this._subHeaderWidgets=[];G.forEach(S,function(b){O=b.subColumns;if(O&&O.length>1){N=C;return false;}return true;});G.forEach(S,function(b){O=b.subColumns;R=O?O.length:0;if(R>1){T=1;Q=R;X=0;}else{T=N;Q=1;X=a++;}Y='rowspan="'+T+'" colspan="'+Q+'"';P=V.apply(this,[b,X,Y]);U.push(P);if(R>1){G.forEach(O,function(c){P=V.apply(this,[c,a,"",this._subHeaderWidgets,W]);Z.push(P);a++;},this);}},this);U.push("</tr>");Z.push("</tr>");G.forEach(Z,function(b){U.push(b);});U.push("</table>");this.headerHtml=U.join("");}function J(P,O){var N;O.apply(this);O.apply(this,["_subHeaderWidgets",C.toString()]);N=L(this.columns);this.titleColGroup=P.apply(this,[N]);}mstrmojo.DI.LevelDataGrid=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DI.LevelDataGrid",renderHook:{pre:B,post:J},itemFunction:function D(P,N,O){return new mstrmojo.DI.LevelDataGridDataRow({columns:O.columns,data:P,idx:N,dataGrid:O});},refresh:function H(N){F(this);if(this._super){this._super(N);}},destroy:function K(N){F(this);this._super(N);},unrender:function I(N){G.forEach(this._subHeaderWidgets_,function(O){if(O&&O.hasRendered){O.unrender(true);}});this._super(N);},createColSizeArray:function A(){var S=this.headerContainerNode,U=S&&S.getElementsByTagName("table")[0],Q=U.rows[0].cells,N=U.rows[1]&&U.rows[1].cells,T=0,V=[],O,R,P;G.forEach(Q,function(W){O=W.getAttribute("colspan");O=O?parseInt(O,10):1;if(O===1){V.push(W.offsetWidth);}else{for(R=0;R<O;R++){P=N[T++];V.push(P.offsetWidth);}}});return V;},setupScrollNodes:function E(){this.scrollNode=this.scrollboxNode;}});mstrmojo.DI.LevelDataGridDataRow=mstrmojo.declare(mstrmojo.DataRow,null,{scriptClass:"mstrmojo.DI.LevelDataGridDataRow",cssClass:"mstrmojo-DataRow",columns:null,init:function M(N){this._super(N);this.columns=L(this.columns);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DataGrid");mstrmojo.requiresDescs(39,12539);var C=mstrmojo.DI.DIConstants;function B(H){var F=(this.model.operationMode===C.operationMode.create),E=mstrApp.getRootController(),I=this.getSelectedItems(),G=this;this.urls=[];mstrmojo.array.forEach(I,function(K){var J=K.url;G.urls.push(J);});E.importURLEMMA(this,this.urls,F,!E.model.hasEMMAReportInstance(),this.id,true,H);}function D(E){var F=this.items.length;var H={},G;if(E){for(G=0;G<F;G++){H[G]=E;}}this.set("selectedIndices",H);}mstrmojo.DI.DISampleFiles=mstrmojo.declare(mstrmojo.DataGrid,null,{scriptClass:"mstrmojo.DI.DISampleFiles",cssClass:"mstrmojo-di-samplefiles",data:null,resizableColumns:false,multiSelect:true,selectionPolicy:"toggle",urls:[],visible:false,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},columns:[{headerCss:"mstrmojo-di-samplefiles-col1header",headerWidget:{scriptClass:"mstrmojo.ImageCheckBox",label:mstrmojo.desc(12539,"Sample File"),alias:"allSampleFiles",state:"unselect-all",preclick:function(){if(this.dataGrid.tableID){return ;}if(this.state==="select-all"){this.set("state","unselect-all");D.call(this.dataGrid,false);}else{this.set("state","select-all");D.call(this.dataGrid,true);}},onstateChange:function(){var E=mstrmojo.css;E.removeClass(this.inputNode,["select-all","unselect-all","select-some"]);E.addClass(this.inputNode,this.state);},postCreate:function(){this.set("state","unselect-all");}},colCss:"mstrmojo-di-samplefiles-col1",dataWidget:{scriptClass:"mstrmojo.ImageCheckBox",bindings:{label:"this.parent.data.display",checked:function(){return !!this.parent.dataGrid.selectedIndices[this.idx];}},preclick:function(){this.set("checked",!!this.parent.dataGrid.selectedIndices[this.idx]);var G=this.parent.dataGrid.items.length;var F=0,H;for(H=0;H<G;H++){if(this.parent.dataGrid.selectedIndices[H]){F++;}}var E=this.dataGrid._headerWidgets_[0];if(F<=0){E.set("state","unselect-all");}else{if(F>=G){E.set("state","select-all");}else{E.set("state","select-some");}}}}},{headerText:mstrmojo.desc(39,"Description"),colCss:"mstrmojo-di-samplefiles-col2",dataWidget:{scriptClass:"mstrmojo.Container",markupString:'<div class="mstrmojo-di-sampleitem-desc"><div class="sampleitem-desc-text""></div><div class="sampleitem-desc-downloadbtn"></div></div>',markupSlots:{textNode:function(){return this.domNode.children[0];},btnNode:function(){return this.domNode.children[1];}},children:[{scriptClass:"mstrmojo.Label",slot:"textNode",bindings:{text:"this.parent.data.desc"}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-di-download",slot:"btnNode",onclick:function(F){var E=this.parent.data.url;if(mstrApp.isSingleTier){window.FormWrapper.openPage(E);}else{mstrApp.openPage(E);}F.cancel();},premousedown:function(E){E.cancel();}}]}}],init:function(G){this._super(G);this.set("items",this.model.sampleFiles.file);var E=mstrApp.getRootController();E.sourceSelected(false);if(this.model.importSources[this.tableID]&&this.model.importSources[this.tableID].sourceInfo&&this.model.importSources[this.tableID].sourceInfo.url){var H,F=this.model.importSources[this.tableID].sourceInfo.url;for(H=0;H<this.items.length;H++){if(F===this.items[H].url){this.set("selectedIndex",H);break;}}this.set("multiSelect",false);}},onchange:function(){var E=mstrApp.getRootController();var F=this.getSelectedItems();if(F.length>0){E.sourceSelected(true);}else{E.sourceSelected(false);}},onvisibleChange:function(){var E=mstrApp.getRootController();if(this.selectedIndex!==-1){E.sourceSelected(true);}else{E.sourceSelected(false);}},getFileUrl:function(E){var F;if(E<this.urls.length){F=this.urls[E];return F;}return"";},getFilesCnt:function(){return this.urls?this.urls.length:0;},getFileTableID:function(E){if(this.urls&&E<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[E]];}},onNextButtonClick:function(){B.call(this,this.tableID?C.actions.refreshData:C.actions.importSource);},onFinishButtonClick:function(){B.call(this,C.actions.savePublish);},onHelpButtonClick:function A(){return"importing_data_from_a_sample_file.htm";},onBackButtonClick:function(){var E=mstrApp.getRootController();E.showPage(C.pageType.dataSelection);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.DataGrid");mstrmojo.requiresDescs(14615,1442,12381,12382,12403,12404,12405);var C=mstrmojo.desc;mstrmojo.qb.es.AlternateSourceDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.es.AlternateSourceDialog",cssClass:"mstrmojo-qb-ValidateAlternateSource-dialog",title:C(12405,"Alert"),items:null,onOpen:function A(){var I=this.table,E=[],D,G=[C(14615,"Match Status"),C(12403,"Original Table"),C(12404,"New Table")],K,F=this.items.length;MATCH_RESULT_COLUMN=0;function H(P,R,N){var O=[P[1],P[0],P[2]],Q=this.dataField,M=O[Q],L;if(parseInt(Q,10)===MATCH_RESULT_COLUMN){if(M<0){L="";}else{L=M?'<div class="matched-item"></div>':'<div class="unmatched-item"></div>';}}else{L=M;}return L;}for(D=0;D<G.length;D++){K={headerText:G[D],colWidth:(D===MATCH_RESULT_COLUMN)?"88":"261",dataFunction:H,dataField:D.toString()};E.push(K);}for(D=0;D<9-F;D++){var J={0:"",1:-1,2:""};J.prototype=this.items[0];this.items.push(J);}I.set("columns",E);I.set("items",this.items);},children:[{scriptClass:"mstrmojo.Label",cssClass:"validation-note1",text:C(12382,"The selected table cannot serve as an alternate source due to the above mismatches. Please select an alternate table.")},{scriptClass:"mstrmojo.DataGrid",alias:"table",cssClass:"validation-table",resizableColumns:false,columns:[]},{scriptClass:"mstrmojo.Label",cssClass:"validation-note2",text:C(12381,"Note: The column names and the data types have to match between the currently uploaded table and the original table for relational sources.")},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-Button mstrmojo-WebButton",onclick:function(){var D=this.parent.parent;D.close();}}]}],postBuildRendering:function B(){if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button","mstrmojo.DataGrid","mstrmojo.locales","mstrmojo.date","mstrmojo.string");mstrmojo.requiresDescs(96,187,1442,9620,10216,10290,11119,12907);mstrmojo.DI.ui.dialogs.DIRefreshHistoryDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIRefreshHistoryDialog",cssClass:"mstrmojo-di-refreshHistory",title:mstrmojo.desc(10216,"Refresh History"),zIndex:999,subsStatus:[],onOK:mstrmojo.emptyFn,onOpen:function(){this.grid.set("items",this.subsStatus||[]);this.set("detailMsg","");this.grid.set("selectedIndex",-1);this.grid.set("selectedIndex",0);},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refreshHistory-title",text:mstrmojo.desc(12907,"Status for the last 5 scheduled refreshes:")},{alias:"grid",scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-di-refreshHistory-grid",onchange:function(){var B="";var A=this.selectedIndex;if(A>=0&&this.items.length>0){B=this.items[A].en!==0?this.items[A].emsg:mstrmojo.desc(11119,"The scheduled data refresh was successful.");}this.parent.set("detailMsg",B);},columns:[{headerText:mstrmojo.desc(9620,"Timestamp"),headerCss:"grid-header timestamp",dataWidget:{scriptClass:"mstrmojo.Label",bindings:{text:function(){var C=mstrmojo.date;var D=mstrmojo.locales;var B=C.getDateJson(this.data.timestamp);var A=C.formatDateInfo(B,D.datetime.DATEDISPLAYFORMAT);var E=C.formatTimeInfo(B,D.datetime.TIMEDISPLAYFORMAT);return A+" "+E;},cssClass:function(){var A="grid-col timestamp ";if(this.data.en!==0){A+="error";}return A;}}}},{headerText:mstrmojo.desc(187,"Status"),headerCss:"grid-header status",dataWidget:{scriptClass:"mstrmojo.Label",bindings:{cssClass:function(){var A="grid-col status ";if(this.data.en!==0){A+="error";}return A;}}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refreshHistory-detail",bindings:{text:"this.parent.detailMsg"}},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1442,"OK"),onclick:function(){var A=this.parent;if(typeof A.onOK==="function"){A.onOK();}A.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.fx","mstrmojo.TreeNode");var K=mstrmojo.dom,E={0:"closed",1:"opened",2:"leaf"},I=function(R,Q){var N=R.style,M,P,L,S,O;N.display="block";N.height="auto";M=R.offsetHeight;P=Q?M:0;L=Q?0:M;S=Q?"block":"none";N.overflow="hidden";O=new mstrmojo.fx.AnimateProp({target:R,props:{height:{start:L,stop:P,suffix:"px",fn:Math.round,ease:mstrmojo.ease.linear}},onEnd:function(){N.height="auto";N.display=S;},interval:30,duration:300});O.play();};mstrmojo.TreeBrowserNode=mstrmojo.declare(mstrmojo.TreeNode,null,{scriptClass:"mstrmojo.TreeBrowserNode",markupString:'<div id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,click,dblclick><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><img class="mstrmojo-TreeNode-checkBox" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><div class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</div></div>',markupSlots:mstrmojo.hash.copy({displayNode:function(){return this.domNode.firstChild;},checkBoxNode:function(){return this.domNode.firstChild.childNodes[1];}},mstrmojo.TreeNode.prototype.markupSlots),markupMethods:mstrmojo.hash.copy({onstateChange:function(L){this.stateNode.className="mstrmojo-TreeNode-state "+(E[this.state]||"closed");if(this.tree.anim&&this.contentRetrieved&&!L){I(this.itemsContainerNode,this.state===1);}else{this.itemsContainerNode.style.display=(this.state===1)?"block":"none";}}},mstrmojo.TreeNode.prototype.markupMethods),blockBegin:1,allowUnlistedValues:false,contentRetrieved:false,_set_items:function(N,M){var L=this._super(N,M);if(L&&this.tree.anim){I(this.itemsContainerNode,true);}return L;},onstateChange:function J(){var L=this.tree;if(!this.contentRetrieved&&(this.state==1)){this.set("items",[L.loadingItemCreaterFunc()]);L.getContent(this,this.blockBegin);}else{if((this.state==1)&&L.onNodeExpand){L.onNodeExpand(this);}if((this.state==0)&&L.onNodeCollapse){L.onNodeCollapse(this);}}},toggleState:function G(){if(this.state!==2){this.set("state",this.state===1?0:1);}},preclick:function H(L){K.clearBrowserHighlights(L.hWin);return false;},predblclick:function D(L){K.clearBrowserHighlights(L.hWin);return false;},premousedown:function B(M){var R=mstrmojo.dom,O=mstrmojo.dom.eventTarget(M.hWin,M.e),L=this.tree,N=(this.state==2),Q=R.contains(this.itemsContainerNode,R.eventTarget(M.hWin,M.e),true,this.domNode),P=(L.branchClickPolicy==mstrmojo.TreeBrowserEnum.BRANCH_POLICY_TOGGLE);if((this.isSpecialNode()||!(O==this.checkBoxNode||((O==this.textNode||O==this.displayNode)&&(N||!P))))&&!this.draggable){R.stopPropogation(M.hWin,M.e);}if((O==this.stateNode)||((O==this.textNode||O==this.displayNode)&&!N&&P)){if(!N){this.toggleState();}}else{if(O==this.checkBoxNode||Q){if(this._super){this._super(M);}}else{this.handleNodeClicked();}}},isSpecialNode:function C(){var L=this.data&&this.data.st;return(L<0);},handleNodeClicked:function F(){var L=this.tree,M=this.parent,N=this.data;switch(N&&N.st){case"-4":mstrmojo.css.addClass(this.textNode,["loading"]);L.getContent(M,M.blockBegin-L.blockCount);break;case"-3":mstrmojo.css.addClass(this.textNode,["loading"]);L.getContent(M,M.blockBegin+L.blockCount);break;case"-1":case"-2":break;default:if(L.handleNodeClicked){L.handleNodeClicked(N);}}},init:function(L){this._super(L);this.set("state",this.tree.isBranch(this.data)?0:2);},postBuildRendering:function A(){if(this._super){this._super();}var L=function(M){K.preventDefault(window,M||window.event);return false;};K.attachEvent(this.domNode,"mousedown",L);if(this.isSpecialNode()||this.tree.noCheckBox){this.checkBoxNode.style.display="none";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo._HasOwnAvatar","mstrmojo.TreeNode");var F=mstrmojo.dom,K,E;var H={scriptClass:"mstrmojo.Container",slot:"tableNode",markupString:"<div class='mstrmojo-url-list-dnd' title='{@title}' mstrAttach:click ><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},imageNode:function(){return this.domNode.children[0];},contentNode:function(){return this.domNode.children[1];}},markupMethods:{onisFolderChange:function(){if(this.isFolder){mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-folder");}else{mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-file");}}},text:"",isFolder:"",children:[{slot:"contentNode",alias:"text",cssClass:"item-content",scriptClass:"mstrmojo.Label",bindings:{text:"this.parent.text"}},{slot:"imageNode",alias:"image",cssClass:"item-image",scriptClass:"mstrmojo.Label"}]};mstrmojo.DI.DITreeNodeDnD=mstrmojo.declare(mstrmojo.TreeNode,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.DI.DITreeNodeDnD",title:"",markupString:'<div id="{@id}" class="{@cssClass} mstrmojo-di-tree-node-list" style="{@cssText}" title="{@title}" mstrAttach:click,mouseover><div class="mstrmojo-di-tree-node"><img border="0" class="mstrmojo-di-tree-node-icon folder-closed" src="../images/1ptrans.gif"/><div class="mstrmojo-di-tree-node-text {@textCssClass}"></div><span class="mstrmojo-di-ga-tree-node-edit-icon"></span></div><ul class="mstrmojo-di-tree-node-itemsContainer">{@itemsHtml}</ul></div>',markupSlots:{listNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];},editIconNode:function(){return this.domNode.firstChild.children[2];},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{onstateChange:function(){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);},ontitleChange:function(){this.domNode.title=this.title;}},clickHandler:null,editHandler:null,deselect:function G(){if(this.listNode){this.listNode.className="mstrmojo-di-tree-node-file";}},fetched:false,iconEntity:"",iconFolderClosed:"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:"mstrmojo-di-tree-node-icon folder-open",supportFolderDrag:true,totalSize:undefined,draggable:true,createAvatar:function C(O){if(!this.supportFolderDrag&&this.data.isFolder){return document.createElement("div");}if(O.className.indexOf("mstrmojo-di-tree-node-text")>-1){O=O.parentNode;}var N=O.className;H.text=O.innerText;var P=mstrmojo.insert(H);P.render();var M=(N.indexOf("mstrmojo-di-tree-node-folder")>-1)?P.set("isFolder",true):P.set("isFolder",false);return P.domNode;},getDragData:function J(M){var O=[],P,T;if(!this.supportFolderDrag&&this.data.isFolder){return O;}var Q=M.target||F.eventTarget(M.src.hWin,M.src.e);var N=Q.className;var S=Q.parentNode.className;var R=(N.indexOf("selected")>-1||S.indexOf("selected")>-1);if(R){T=this.data.browser.fileTree.selectedNodes;for(P=0;P<T.length;P++){O.push(T[P]);}}else{O.push(this);}return O;},isDragValid:function I(){return !this.data.isFolder||this.supportFolderDrag;},ondragstart:function D(M){this._super(M);var N=M.src.data;if(N&&N.length>1){if(this.avatar&&this.avatar.getElementsByClassName){this.avatar.getElementsByClassName("item-content")[0].innerHTML=N.length;}}},postBuildRendering:function A(){if(this._super){this._super();}var M=0;var N=this;while(N&&N.parent&&N.parent.data){M++;N=N.parent;}this.iconNode.style.marginLeft=M*18+"px";if(this.data.isFolder){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.listNode.className="mstrmojo-di-tree-node-folder";this.editIconNode.style.display="none";}else{this.iconNode.className=this.data.iconEntity;this.listNode.className="mstrmojo-di-tree-node-file";}if(!this.data.edit){this.editIconNode.style.display="none";}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.textNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:-5,content:this.tooltipContent});},selectThisNode:function(M){this.listNode.className="mstrmojo-di-tree-node-file selected";var N=this;while(N&&N.parent&&N.parent.data){N=N.parent;}if(N&&N.tree&&N.tree.scriptClass==="mstrmojo.DI.DITreeDnD"){N.tree.selectNode(this,M);}this.data.clickHandler.call(this,this);},onmouseover:function L(M){if(!(K)){K=mstrApp.getRootController();}if(!this.parent.sizeTooltip||!this.parent.folderSizeTooltip){return ;}if(!this.data.isMouseOver&&this.data.isFolder&&(this.totalSize===undefined)){this.data.isMouseOver=true;K.hadoopController.browseHadoopForFolderSize(M.src.data.address,this);}},onclick:function B(M){var N=mstrmojo.dom.eventTarget(M.hWin,M.e);mstrmojo.dom.stopPropogation(M.hWin,M.e);if(N!==this.editIconNode){if(this.data.isFolder){if(this.state===0){if(this.data.fetched){this.set("state",1);}else{this.data.clickHandler.call(this,this);this.data.fetched=true;this.set("state",1);}}else{if(this.state===1){this.set("state",0);}}}else{this.selectThisNode(M);}}else{this.data.editHandler(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.WidgetTreeBuilder","mstrmojo.TreeNodeSelector");var E=false;mstrmojo.WidgetTree=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.WidgetTree",listBuilder:mstrmojo.WidgetTreeBuilder,listSelector:mstrmojo.TreeNodeSelector,renderOnScroll:true,itemIdField:"dssid",itemDisplayField:"n",itemIconField:"tp",itemChildrenField:"items",itemFunction:function D(L,I,J){if(!E){mstrmojo.requiresCls("mstrmojo.TreeNode");E=true;}var H=J.tree||J,K=new mstrmojo.TreeNode({data:L,state:0,parent:J,tree:H,multiSelect:J.multiSelect,text:L[J.itemDisplayField],textCssClass:H.item2textCss(L),items:L[J.itemChildrenField],itemIdField:J.itemIdField,itemDisplayField:J.itemDisplayField,itemIconField:J.itemIconField,itemChildrenField:J.itemChildrenField,itemFunction:J.itemFunction,listSelector:J.listSelector});return K;},item2textCss:function B(H){return H[this.itemIconField];},selectionParentNode:null,init:function F(H){this._super(H);this.selectionParentNode=this;this.tree=this;},clearTreeSelect:function A(){(this.selectionParentNode||this).clearSelect();},prechange:function G(H){var I=this._super(H);this.onnodechange(H);return I;},onnodechange:function C(I){if(!I){return ;}var J=mstrmojo.hash,M=this.selectionParentNode,L=I.src;if(L===M){if(J.isEmpty(L.selectedIndices)){L=this;this.selectionParentNode=this;}this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:I.removed});}else{if(I.added&&I.added.length){var K=[];if(!J.isEmpty(M.selectedIndices)){K=mstrmojo.hash.keyarray(M.selectedIndices,true);M.clearSelect();}this.selectionParentNode=L;this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:K});}else{}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.TreeNode","mstrmojo._IsExprNode","mstrmojo.array","mstrmojo.dom","mstrmojo.css","mstrmojo.expr","mstrmojo._HasOwnAvatar");var F=mstrmojo.array,M=mstrmojo.expr,P=mstrmojo.dom,A=mstrmojo.css;function J(R,Q){var T=R.data,S=T&&T.nds;if(!S){return null;}if(Q){Q.sort(F.numSorter);}else{Q=R.sortSelectedIndices();}if(!Q.length){return null;}return{idxs:Q,nds:F.get(S,Q)};}function N(S){var R=S.ctxtBuilder,U=R&&R.itemWidgets,Q=U&&U[0],T=Q&&Q.data;if(T&&T.not&&(U.length>0)){delete T.not;Q.paint();}}mstrmojo.AndOrNode=mstrmojo.declare(mstrmojo.TreeNode,[mstrmojo._IsExprNode,mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.AndOrNode",data:null,editable:false,prefixedAndOrEditable:false,markupString:'<div id="{@id}" class="mstrmojo-andor mstrmojo-AndOrNode {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-andor-prefix" mstrAttach:click><span class="mstrmojo-textset mstrmojo-andor-prefix-text"></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-andor-top"></div><div class="mstrmojo-andor-contentsWrapper" style="position:relative"><div class="mstrmojo-andor-contents" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue mstrmojo-AndOrNode-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner mstrmojo-AndOrNode-dropCue-inner"></div></div></div><div class="mstrmojo-andor-bottom"></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},itemsContainerPrefix:function(){return this.domNode.childNodes[1];},itemsContainerNode:function(){return this.domNode.childNodes[2].firstChild;},dropCueNode:function(){return this.domNode.childNodes[2].lastChild;},itemsContainerSuffix:function(){return this.domNode.lastChild;},scrollboxNode:function(){return this.domNode;}},markupMethods:{onitemCntChange:function(){A.toggleClass(this.itemsContainerNode,["multi"],this.itemCnt>2);},onprefixedAndOrEditableChange:function(){A.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();},ondropCuePosChange:mstrmojo.TreeNode.prototype.markupMethods.ondropCuePosChange},multiSelect:true,itemIdField:null,init:function(Q){this._super(Q);this.markupString=this.markupString.replace("{@_prefixAndOrToolsMarkup}",this.getPrefixAndOrToolsMarkup());var R=this.data;if(R){delete this.data;this._set_data(null,R);}},itemCnt:0,postBuildRendering:function(){var Q;this.set("itemCnt",this.items.length);if(this._super){Q=this._super();}N(this);return Q;},preadd:function L(Q){if(this._super){this._super(Q);}this.set("itemCnt",this.items.length);N(this);},preremove:function O(Q){if(this._super){this._super(Q);}this.set("itemCnt",this.items.length);N(this);},_set_data:function(T,Q){var R=this.data,S=(R!==Q);if(S){this.data=Q;if(Q&&!Q.nds){Q.nds=[];}this.set("items",Q&&Q.nds);}return S;},isDragValid:function K(){return true;},isSelectableArea:function(Q){return false;},getDragData:function(Q){var S=this._super(Q);if(S&&!S.html){var R=S.et&&M.ET2TGT[S.et];S.html=R?S[R]&&S[R].n||"":S.n||"";}return S;},remove:function I(R,S){var Q=this._super(R);if(Q>-1){var T=S||this.suppressConsolidation;if(!T){this.consolidate(false);}}return Q;},move:function(R,Q){this.suppressConsolidation=true;var S;if(this._super){S=this._super(R,Q);}this.suppressConsolidation=false;return S;},consolidate:function E(){var U=this.parent;if(!U||!U.remove){return ;}var S=this.items,R=S&&S.length;if(R<2){var T=R?S[0]:null,Q=this.childIndex();if(T){U.add([T],Q);}U.remove(this.data);}},indent:function G(S,Q){var R=J(this,S);if(!R){return ;}this.remove(R.idxs,true);var W=R.nds,V=Q&&Q.fn||this.data&&this.data.fn,U={et:M.ET.ANDOR,nds:W,fn:V};if(W.length===2&&W[0].not){if(W[1].not){delete W[0].not;delete W[1].not;U.not=true;U.fn=(V===M.FN.AND?M.FN.OR:M.FN.AND);}else{var T=W[0];W[0]=W[1];W[1]=T;}}this.add([U],R.idxs[0]);this.consolidate(false);},outdent:function C(R){var S=this.parent,Q=S&&S.data;if(!Q||Q.et!==M.ET.ANDOR){return ;}var T=J(this,R);if(!T){return ;}this.remove(T.idxs,true);if(this.data.not){T.nds[0].not=true;}S.add(T.nds,this.childIndex());this.consolidate(false);},edit:function D(Z,a,S){if(!Z){return ;}var Y=this.data,X=Y&&Y.fn,R=Z.data,f=R&&R.not;if(!R){R={};Z.data=R;}R.not=!!S;if(X!==a){var Q=Y.nds;if(Q&&Q.length>2){var e=Z.childIndex();if(e>0){this.indent([e-1,e],{fn:a});}}else{Y.fn=a;var V=this.ctxtBuilder,U=V&&V.itemWidgets;for(var T=0,W=(U&&U.length)||0;T<W;T++){var b=U[T];if(b){b.paint();}}}}else{Z.paint();}},preclick:function H(Q){var S=null,R=P.eventTarget(Q.hWin,Q.e);if(R===this.prefixNode){}else{if(P.contains(this.prefixNode,R,true)){S="andor";}}Q.part=S;},createAvatar:function B(S){var R=document.createElement("div"),T=P.findWidget(S),Q=T.getAvatarNode&&T.getAvatarNode();if(!Q){Q=T.condNode.cloneNode(true);Q.style.boxSizing="border-box";Q.style.width=T.condNode.offsetWidth+"px";}R.appendChild(Q);A.addClass(R,T.avatarCssCls||"mstrmojo-FE mstrmojo-ConditionNode");R.style.zIndex=20;return R;},_ndsToMove:J});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.TreeNode");mstrmojo.DI.DITreeNode=mstrmojo.declare(mstrmojo.TreeNode,null,{scriptClass:"mstrmojo.DI.DITreeNode",markupString:'<div id="{@id}" class="{@cssClass} mstrmojo-di-tree-node-list" style="{@cssText}" mstrAttach:mousedown><div class="mstrmojo-di-tree-node"><img border="0" class="mstrmojo-di-tree-node-icon folder-closed" src="../images/1ptrans.gif"/><span class="mstrmojo-di-tree-node-text {@textCssClass}"></span><span class="mstrmojo-di-ga-tree-node-edit-icon {@textCssClass}"></span><span class="mstrmojo-di-tree-node-desc {@textCssClass}"></span></div><ul class="mstrmojo-di-tree-node-itemsContainer">{@itemsHtml}</ul></div>',markupSlots:{listNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];},editIconNode:function(){return this.domNode.firstChild.children[2];},descNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{onstateChange:function(){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);if(this.data.desc){var D=this.data.desc;D=mstrmojo.string.multiReplace(D,{"&#10;":" "});this.descNode.innerHTML=mstrmojo.string.encodeHtmlString(D);this.descNode.title=D;}}},clickHandler:null,editHandler:null,deselect:function B(){if(this.listNode){this.listNode.className="mstrmojo-di-tree-node-file";}},fetched:false,iconEntity:"",iconFolderClosed:"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:"mstrmojo-di-tree-node-icon folder-open",isFolder:true,postBuildRendering:function A(){if(this._super){this._super();}var D=0;var E=this;while(E&&E.parent&&E.parent.data){D++;E=E.parent;}this.iconNode.style.marginLeft=D*18+"px";if(this.data.isFolder){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.listNode.className="mstrmojo-di-tree-node-folder";this.editIconNode.style.display="none";}else{this.iconNode.className=this.data.iconEntity;this.listNode.className="mstrmojo-di-tree-node-file";}if(!this.data.edit){this.editIconNode.style.display="none";}},selectThisNode:function(D){this.listNode.className="mstrmojo-di-tree-node-file selected";var E=this;while(E&&E.parent&&E.parent.data){E=E.parent;}if(E&&E.tree&&E.tree.scriptClass==="mstrmojo.DI.DITree"){E.tree.selectNode(this,D);}this.data.clickHandler.call(this,this);},premousedown:function C(D){var E=mstrmojo.dom.eventTarget(D.hWin,D.e);mstrmojo.dom.stopPropogation(D.hWin,D.e);if(E!==this.editIconNode){if(this.data.isFolder){if(this.state===0){if(this.data.fetched){this.set("state",1);}else{this.data.clickHandler.call(this,this);this.data.fetched=true;this.set("state",1);}}else{if(this.state===1){this.set("state",0);}}}else{this.selectThisNode(D);}}else{this.data.editHandler(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresDescs(14503);mstrmojo.DI.DIFacebookPageItem=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIFacebookPageItem",cssClass:"mstrmojo-di-fbpage-item",pg_id:null,picUrl:null,n:"",desc:"",likes:"",link:"",enabled:true,advancedProperties:null,markupString:'<div class={@cssClass} mstrAttach:click,mouseover,mouseout><div class="image" style="background-image:url({@picUrl});"></div><div><div class="name"><a href="{@link}" target="_blank" style="text-decoration: none;">{@n}</a><span class="desc">({@desc})</span></div><div class="info">{@likes} Likes</div><div class="info filter" style="color: #4099ff;">'+mstrmojo.desc(14503,"Filter post data by date...")+"</div></div></div>",markupSlots:{iconNode:function(){return this.domNode.firstChild;},nameNode:function(){return this.domNode.children[1].children[0];},likesNode:function(){return this.domNode.children[1].children[1];},advancedPropertiesNode:function(){return this.domNode.children[1].children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onclick:function(E){var F=E.e.target||E.e.srcElement;this.source.handleSelectionChange(this);if(F===this.advancedPropertiesNode){this.onadvancedSearchClick();}},postBuildRendering:function A(){if(this._super){this._super();}this.set("title",this.n);},setSelectedItem:function C(){mstrmojo.css.toggleClass(this.domNode,"selected",true);},setUnSelectedItem:function B(){mstrmojo.css.toggleClass(this.domNode,"selected",false);},onadvancedSearchClick:function D(){var E=this;var G=mstrApp.getRootController().dialogController.getCurrentZIndex()+1;var F=new mstrmojo.Editor({cssClass:"mstrmojo-di-facebookAdvancedEditor",cssText:"background: white; width:475px;border: 10px solid rgba(0, 0, 0, 0.3); border-radius:5px; -moz-border-radius:5px;-webkit-border-radius:10px;",showTitle:true,title:mstrmojo.desc(3653,"Advanced Options"),zIndex:G,onOpen:function(){var H=this.curtainNode.style;H.background="black";H.opacity=0.5;H.filter="alpha(opacity=50)";},children:[{scriptClass:"mstrmojo.DI.DIFacebookAdvancedEditor",alias:"editorContent",bindings:{advancedProperties:function(){return E.advancedProperties||{};}}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1442,"OK"),onclick:function(){var H=this.parent.parent;if(H.editorContent.onOk){H.editorContent.onOk();E.advancedProperties=H.editorContent.advancedProperties;}H.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var H=this.parent.parent;H.close();if(H.onCancel){H.onCancel();}}}]});F.open();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.List","mstrmojo.DI.DIConstants","mstrmojo.Table","mstrmojo.dom");mstrmojo.requiresDescs(12460);var B=mstrmojo.DI.DIConstants.pageType,D=mstrmojo.DI.DIConstants.sourceType,F=mstrmojo.DI.DIConstants.sourceType;var A=[{iconClass:"File",text:"File",pageType:B.file,sourceInfo:0},{iconClass:"File",text:"URL",pageType:B.file,sourceInfo:1},{iconClass:"Database",pageType:B.database,text:"Database",sourceInfo:{sourceType:D.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:F.qbSingleTable}},{iconClass:"SF",text:"Salesforce"},{iconClass:"File",text:"Sample"},{iconClass:"Eloqua",text:"Eloqua"},{iconClass:"analytics",text:"Google Analytics"},{iconClass:"bigQuery",text:"BigQuery"},{iconClass:"facebook",text:"Facebook"},{iconClass:"twitter",text:"Twitter"},{iconClass:"msDynamics",text:"MSFT Dynamics"},{iconClass:"OracleCRM",text:"Oracle CRM"},{scriptClass:"mstrmojo.Button",iconClass:"SugarCRM",text:"SugarCRM"},{iconClass:"Zendesk",text:"Zendesk"},{iconClass:"netsuit",text:"NetSuit"},{iconClass:"dropbox",text:"Clipboard"},{iconClass:"dropbox",text:"Dropbox"},{iconClass:"gdrive",text:"Google Drive"},{iconClass:"File",text:"Microstrategy"}];mstrmojo.DI.TableSources=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.TableSources",cssClass:"mstrmojo-di-table-sources",domSrc:null,enableDrag:false,clickhandler:null,showTitle:false,numOfcols:6,children:[{scriptClass:"mstrmojo.Button",alias:"closeBtn",text:"Close",innerIconClass:"mstrmojo-di-ts-close-btn",onclick:function(G){if(this.parent.onPreClose()){this.parent.close();}}},{scriptClass:"mstrmojo.Table",alias:"sourceTable",cssClass:"",rows:0,cols:0}],positionDialog:function E(){var G=mstrmojo.dom.position(this.domSrc,true);this.editorNode.style.left=Math.round(G.x)+"px";this.editorNode.style.top=Math.round(G.y+G.h)+"px";},preBuildRendering:function C(){if(this._super){this._super();}this.sourceTable.cols=this.numOfcols;this.sourceTable.rows=A.length/this.numOfcols;var H,J=[],L=0,I=0;var K=this;var G=function(){K.close();};for(H=0;H<A.length;H++){J.push({scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-table-sources-icons",iconClass:A[H].iconClass,innerIconClass:"mstrmojo-di-tablesources-text",text:A[H].text,slot:L+","+I,pageType:A[H].pageType,sourceInfo:A[H].sourceInfo,preclick:G,onclick:this.clickhandler});I++;if(I===this.numOfcols){I=0;L++;}}this.sourceTable.addChildren(J);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor");mstrmojo.requiresDescs(221,1442,12389,12999);var G=mstrmojo.array,F=mstrmojo.desc;mstrmojo.DI.DIPartitionGroupDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIPartitionGroupDialog",cssClass:"mstrmojo-di-partitiongroup-dialog",title:mstrmojo.desc(12999,"Partitioned Tables"),groups:null,callback:null,zIndex:1000,onOpen:function A(){var H=this.groups,I=[];G.forEach(H,function(J){I.push({n:J.tableNames.join(", ")});});this.content.set("items",I);},onPreClose:function D(){this.onCancel();return true;},onOK:function B(){mstrApp.getRootController().partitionController.addMultiPartitions(this.groups,this.callback);},onCancel:function E(){var H=this.callback;if(H&&H.onCancel){H.onCancel();}},children:[{scriptClass:"mstrmojo.Label",text:F(12389,"The following tables have the same set of objects. Do you want to group these partition tables into a single table?")},{scriptClass:"mstrmojo.WidgetList",cssClass:"partitiongroup-list",alias:"content",itemFunction:function(I,H,J){return new mstrmojo.Label({text:"- "+I.n});}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:F(219,"Yes"),onclick:function C(){var H=this.parent.parent;if(H.onOK){H.onOK();}H.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:F(218,"No"),onclick:function C(){var H=this.parent.parent;if(H.onCancel){H.onCancel();}H.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.TextArea","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Editor");function C(E,F){var D=this;if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(E,F,{silent:true});}else{mstrmojo.xhr.request("POST",D.path,F,E,undefined,D.XServer,D.baseParams);}}function A(H,I,G,D){var E=this,F={taskId:"createFolder",taskContentType:"json",folderID:H,name:I,description:G};C.call(E,F,D);}function B(E,I,F){if(!E){mstrmojo.alert(mstrmojo.desc(3380));return false;}var G=this,H=G.fId,D={success:function(J){G.contPanel.name.set("value","");G.contPanel.desc.set("value","");if(G.okFn){G.okFn(J,F);}},failure:function(J){if(J.getResponseHeader){mstrmojo.alert(J.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(mstrApp.isSingleTier&&this.dp){this.dp.newFolder(H,E,I,D);}else{A.call(G,H,E,I,D);}}mstrmojo.NewFolderEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.NewFolderEditor",cssClass:"mstrmojo-NewFolderEditor",title:mstrmojo.desc(663,"Create Folder"),help:"Create_a_new_folder.htm",navigateAfter:false,okFn:mstrmojo.emptyFn,path:mstrConfig.taskURL,fId:null,children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:2,cols:2,alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Name-Label",slot:"0,0",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",slot:"0,1",value:mstrmojo.desc(8116,"New Folder"),alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput"},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Desc-Label",slot:"1,0",text:mstrmojo.desc(1154,"Description:")},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",slot:"1,1",alias:"desc",rows:5}]},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"ok",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,G=E&&E.opener,D=E.contPanel.name.value,F=E.contPanel.desc.value;if(!B.call(E,D,F,E.navigateAfter)){E.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor");mstrmojo.requiresDescs(373,12460,12856,12857,12858,12859);var A="databaseImportDialog";var B=mstrmojo.DI.DIConstants;mstrmojo.DI.DIDatabaseImportOption=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.Editor",id:A,showTitle:false,cssClass:"mstrmojo-di-database-import",zIndex:999,positionDialog:function C(){var D=mstrmojo.dom.position(this.domSrc,true);this.editorNode.style.left=Math.round(D.x)+"px";this.editorNode.style.top=Math.round(D.y+D.h)+"px";},children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-table-sources-icons",iconClass:"Database"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12856,"Import from Database"),cssClass:"mstrmojo-di-database-import-title"},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(12857,"Individual Tables"),cssClass:"mstrmojo-di-table-sources-icons",iconClass:"Database1",onclick:function(){this.parent.set("visible",false);mstrApp.getRootController().showPage(B.pageType.database,{sourceType:B.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:B.xdaType.qbSingleTable});}},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(12858,"Build a Query using Multiple Tables"),cssClass:"mstrmojo-di-table-sources-icons",iconClass:"Database2",onclick:function(){this.parent.set("visible",false);mstrApp.getRootController().showPage(B.pageType.database,{sourceType:B.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:B.xdaType.querybuilder});}},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(12859,"Type your own Query script"),cssClass:"mstrmojo-di-table-sources-icons",iconClass:"Database3",onclick:function(){this.parent.set("visible",false);mstrApp.getRootController().showPage(B.pageType.database,{sourceType:B.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:B.xdaType.ffsql});}},{scriptClass:"mstrmojo.Button",alias:"closeBtn",text:mstrmojo.desc(373,"Back"),innerIconClass:"mstrmojo-di-ts-close-btn",onclick:function(){if(this.parent.onPreClose()){this.parent.close();}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Editor");mstrmojo.requiresDescs(221,1442,3393,5282,9124,12407);var S=mstrmojo.hash,X=mstrmojo.css,D=mstrmojo.dom,J=mstrmojo.desc,L=mstrmojo.array,C="on";var V={2219:[" IN "],2220:["[Not In]"]},B={525:[" LIKE "],526:["[Not Like]"],686:[" Contains "],2784:["[Not Contains]"],687:["[Begins With]"],2785:["[Not Begins With]"],688:["[Ends with]"],2786:["[Not ends with]"]},U=S.copy(V,{520:["="],612:["<>"],521:[">"],523:["<"],522:[">="],524:["<="],Between:[" between ","AND"],"Not between":["[Not Between]","AND"]});U=S.copy(B,U);var F=mstrmojo.desc(5282,"AND"),N={Between:[F],"Not between":[F]};var P={numeric:{2219:["1234,12345,123456"],2220:["1234,12345,123456"],520:["123456"],612:["123456"],521:["123456"],523:["123456"],522:["123456"],524:["123456"],Between:["1234","123456"],"Not between":["1234","123456"],525:["1%4_6"],526:["1%4_6"],686:["1%4_6"],2784:["1%4_6"],687:["1%4_6"],2785:["1%4_6"],688:["1%4_6"],2786:["1%4_6"]},vchar:{2219:["abcde,abcdef"],2220:["abcde,abcdef"],520:["abcde"],612:["abcde"],521:["aa"],523:["zz"],522:["aa"],524:["zz"],Between:["aa","zz"],"Not between":["mn","zz"],525:["a%d_f"],526:["a%d_f"],686:["a%d_f"],2784:["a%d_f"],687:["a%d_f"],2785:["a%d_f"],688:["a%d_f"],2786:["a%d_f"]},date:{2219:["2014-02-14,2014-12-25 00:00:00"],2220:["2014-02-14,2014-12-25 00:00:00"],520:["2014-12-25"],612:["2014-12-25"],521:["2014-12-25"],523:["2014-12-25"],522:["2014-12-25"],524:["2014-12-25"],Between:["2014-02-14","2014-12-25"],"Not between":["2014-02-14","2014-12-25"],525:["2014-0_-25%"],526:["2014-0_-25%"],686:["2014-0_-25%"],2784:["2014-0_-25%"],687:["2__4-"],2785:["2__4-"],688:["-25%"],2786:["-25%"]}};var R=",",I="'",W='"',G={"'":1,'"':1},M="(",O=")";function H(a){var Z=a.length;a=a.substring(G[a[0]]?1:0,(G[a[Z-1]]?Z-1:Z));return[I,a,I].join("");}function K(a){var Z=a.toString();if(Z.match(/#\d+#/)){return Z;}return"#"+Z+"#";}function Q(b){var a=b.split(R),Z=[];L.forEach(a,function(c){Z.push(H(c));});return Z.join(R);}function A(a,Z){var c,d=[],b=a;if(Z){c=a.split(R);L.forEach(c,function(e){d.push(W+e+W);});b=d.join(R);}return M+b+O;}mstrmojo.qb.FilterValueEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FilterValueEditor",init:function T(Z){this._super(Z);this.help=this.help||(mstrApp&&mstrApp.helpTopics&&mstrApp.helpTopics.filterValue)||"Enter_Value_dialog_box.htm";},zIndex:100,title:mstrmojo.desc(9124,"Enter Value"),cssClass:"mstrmojo-qb-filtervalue-editor",help:"",column:null,operatorID:null,paraNum:null,MAX_PARA_NUM:2,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-filtervalue-box",alias:"box",children:[{scriptClass:"mstrmojo.Label",alias:"label0",cssClass:"mstrmojo-qb-filtervalue-name1",cssDisplay:""},{scriptClass:"mstrmojo.TextBox",alias:"input0",cssClass:"mstrmojo-qb-filtervalue-textbox1",cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"label1",cssClass:"mstrmojo-qb-filtervalue-name2",cssDisplay:""},{scriptClass:"mstrmojo.TextBox",alias:"input1",cssClass:"mstrmojo-qb-filtervalue-textbox2",cssDisplay:""}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-filterexample-box",alias:"exampleBox",children:[{scriptClass:"mstrmojo.Label",alias:"exampleLabel",cssClass:"mstrmojo-qb-example-label",text:mstrmojo.desc(3993,"Example:")},{scriptClass:"mstrmojo.Label",alias:"exampleLabel0",cssClass:"mstrmojo-qb-example-name0",cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"exampleAndLabel",cssClass:"mstrmojo-qb-example-and-label",text:F,cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"exampleLabel1",cssClass:"mstrmojo-qb-example-name1",cssDisplay:""}]},{scriptClass:"mstrmojo.Label",alias:"err",cssClass:"mstrmojo-qb-filtervalue-errmsg",text:""},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonBox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),alias:"ok",onclick:function Y(){var k=this.parent.parent,d=k.box,Z=k.operatorID,j,m=k.isDateTime,p=k.isBigDecimal,a=k.isString,g,o=k.paraNum,c=[],b,n="["+k.column+"]",h,f=B.hasOwnProperty(Z),l=V.hasOwnProperty(Z),e;if(o<=0||o>k.MAX_PARA_NUM){return ;}for(b=0;b<o;b++){j=d["input"+b].value;if(j===""){return ;}if(m&&!f){j=Q(j);}else{if(p){j=K(j);}}if(l){j=A(j,a);}else{if(f||a){j=W+j+W;}}c.push(j);}e=U[Z];if(!e||e.length!==o){return ;}for(b=0,h=[n];b<o;b++){h.push(" ",e[b]," ",c[b]);}g=h.join("");mstrApp.getRootController().parseExpression({expr:g,qbrex:2,cIndex:1,vo:1},{success:function(t){if(t&&t.mi){var q=t.mi,u=q.reject_error_description;if(u){if(m&&q.reject_error_code===-2147214817){u=J(12407,"(Please enter a valid date/time value.)");}k.err.set("text",u);}else{k.close();mstrApp.getRootController().addNewFilter({et:"*",expr:q.items,n:g,sqltp:q.exp.sqltp});mstrApp.getRootController().refreshConditionDialog();}}}});}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),alias:"cancel",onclick:function(Z){var a=this.parent.parent;if(a.onCancel){a.onCancel();}a.close();}}]}],onOpen:function E(){var d=this.box,k=this.paraNum,j=this.MAX_PARA_NUM,b,l,n,m,a=this.buttonBox,g,o=this.exampleBox,c=o.exampleAndLabel,e,h=this.isDateTime,Z=this.isString;m=[this.n].concat(N[this.operatorID]||[]);var f=h?"date":(Z?"vchar":"numeric");e=P[f][this.operatorID]||[];this.err.set("text","");d.input0.focus();X.toggleClass(this.editorNode,"multi",k>1);for(b=0;b<j;b++){l=d["label"+b];l.set("text",m[b]||"");n=d["input"+b];n.set("value","");X.toggleClass(l.domNode,C,b<k);X.toggleClass(n.domNode,C,b<k);l=o["exampleLabel"+b];l.set("text",e[b]||"");X.toggleClass(l.domNode,C,b<k);X.toggleClass(c.domNode,C,b<k);}if(D.isIE7||D.isIE8){g=[a.ok,a.cancel];for(b=0;b<g.length;b++){g[b].inputNode.style.minWidth=(k===1)?"70px":"";}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor");mstrmojo.requiresDescs(2102,13475,13476,13477,13478,13479,13480,13481,13482,13483,13484,13485,13486,13487,13488,13489,13490,13491,13492,13493,13494,13495,13496,13497,13498,13499,13500,13501,13502,13503,13504,13505,13506,13507,13508,13509,13510,13511,13512,13513,13514,13515,13869,13870);var D=mstrmojo.desc;function C(){var E=[[D(13869,"Operators"),D(13475,"Find Tweets...")],[D(13476,"twitter search"),D(13477,'Containing both "twitter" and "search". This is the default operator.')],[D(13478,'"happy hour"'),D(13479,'Containing the exact phrase "happy hour".')],[D(13480,"love OR hate"),D(13481,'Containing either "love" or "hate" (or both).')],[D(13482,"beer -root"),D(13483,'Containing "beer" but not "root".')],[D(13484,"#haiku"),D(13485,'Containing the hashtag "haiku".')],[D(13486,"from:alexiskold"),D(13487,'sent from person "alexiskold".')],[D(13488,"to:techcrunch"),D(13489,'sent to person "techcrunch".')],[D(13490,"@mashable"),D(13491,'referencing person "mashable".')],[D(13492,"UN Security -council"),D(13493,'Containing "UN Security" but not "council"')],[D(13494,"superhero since:2010-12-27"),D(13495,'Containing "superhero" and sent since date "2010-12-27" (year-month-day).')],[D(13496,"ftw until:2010-12-27"),D(13497,'Containing "ftw" and sent up to date "2010-12-27".')],[D(13498,"movie -scary :)"),D(13499,'Containing "movie", but not "scary", and with a positive attitude.')],[D(13500,"flight :("),D(13501,'Containing "flight" and with a negative attitude.')],[D(13502,"traffic ?"),D(13503,'Containing "traffic" and asking a question.')],[D(13504,"hilarious filter:links"),D(13505,'Containing "hilarious" and linking to URLs.')],[D(13506,"news source:twitterfeed"),D(13507,'Containing "news" and entered via TwitterFeed')],[D(13508,"steelers&geocode=40.4417,-80.0000,25mi"),D(13509,"Containing steelers within 25 miles of Pittsburgh (40.4417 N, 80.0000 W)")],[D(13510,"Jon Stewart&result_type=popular"),D(13511,'Containing "Jon Stewart" and results which are popular')],[D(13512,"from:conanobrien&result_type=mixed"),D(13513,'Sent from person "Conan O Brien" and results which are both popular and recent')],[D(13514,"germany&lang=fr&count=5"),D(13515,'Containing "germany" and language is French (fr) and limit to five.')]];return E;}function B(){var E=C(),F,G=[];for(F=1;F<E.length;F++){G.push({key:E[F][0],value:E[F][1]});}return G;}mstrmojo.DI.DITwitterAdvancedOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DITwitterAdvancedOptions",cssClass:"mstrmojo-DI-DITwitterAdvancedOptions",title:mstrmojo.desc(13870,"Use Operators"),children:[{scriptClass:"mstrmojo.DataGrid",cssClass:"advOptsGrid",resizableColumns:false,items:B(),setupScrollNodes:function A(){this.scrollNode=this.scrollboxNode;},columns:[{headerText:D(13869,"Operators"),headerCss:"advOptsGrid-Col key header",colCss:"advOptsGrid-Col key",dataField:"key"},{headerText:D(13475,"Find Tweets..."),headerCss:"advOptsGrid-Col value header",colCss:"advOptsGrid-Col value",dataField:"value"}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(2102,"Close"),onclick:function(){this.parent.parent.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.TextBox","mstrmojo.HTMLButton","mstrmojo.DI.DIRemoteProjectDBRole");mstrmojo.requiresDescs(24,221,5369,13085,13086,13087,13088,13089,13090);var C,H=mstrmojo.array,F=mstrmojo.dom,G,E;C=function C(M){var Q=M;var P=Q.vBoxAlias,L=P.iServerNameNodeHBox.iServerNameNodeAlias.value,N=P.iServerPortHBox.iServerPortAlias.value,R=P.loginHBox.loginAlias.value,S=P.passwordHBox.passwordAlias.value,I=P.dsNameHBox.dsNameAlias.value,K,O;if(Q.dbrole){K=Q.dbrole;}else{K=new mstrmojo.DI.DIRemoteProjectDBRole();K.init();}O=K.mdDBRole;var J={str:"hostname="+L+"; Port="+N+"; ProjectID="+E+";",err:"error Msg"};O.n=I;O.connstr=J.str;O.ln=R;O.password=S;O.dbr_type="5";O.dbms="00000000000000000000000000000000";O.hostname=L;O.Port=N;O.selectedProjectName=G;O.ProjectID=E;mstrApp.getRootController().projectController.saveDBRole(O,Q);};mstrmojo.DI.DIProjectDBRoleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIProjectDBRoleEditor",title:mstrmojo.desc(24,"Data Source"),id:"projectDBRoleEditor",help:"Select_Objects_dialog_box_.htm",cssClass:"mstrmojo-project-login",dbrole:undefined,buttons:[{scriptClass:"mstrmojo.HTMLButton",alias:"submitButtonAlias",cssClass:"mstrmojo-Editor-button mstr-submit-button",text:mstrmojo.desc(5369,"Submit"),onclick:function(){C(this.parent.parent);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button mstr-cancel-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var I=this.parent.parent;I.close();}}],preBuildRendering:function B(){if(this._super){this._super();}if(this.dbrole&&this.dbrole.hostname&&this.dbrole.Port){mstrApp.getRootController().projectController.getProjectsFromRemote(this.dbrole.hostname,this.dbrole.Port);}mstrApp.getRootController().model.attachEventListener("projectsLoaded",this.id,this.projectsLoaded);},onOpen:function A(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("projectsLoaded",this.id,this.projectsLoaded);var J=this.dbrole;this.set("dbrole",new mstrmojo.DI.DIRemoteProjectDBRole());this.set("dbrole",J);if(this.dbrole&&this.dbrole.hostname&&this.dbrole.Port){mstrApp.getRootController().projectController.getProjectsFromRemote(this.dbrole.hostname,this.dbrole.Port);}else{var I=this.vBoxAlias.iServerProjectHBox.iServerProject;I.set("items",[]);I.set("defaultSelection",0);I.set("selectedIndex",-1);I.set("text","");}},projectsLoaded:function D(K){var L=K.data.srps.sp,M=this.vBoxAlias.iServerProjectHBox.iServerProject;if(Object.prototype.toString.call(L)!=="[object Array]"){L=[].concat(L);}M.set("items",L);if(!this.dbrole){M.set("defaultSelection",0);G=L[0].pn;E=L[0].pgd;}else{var J=this.dbrole.ProjectID,I=H.find(L,"pgd",J);E=J;if(I!==-1){M.set("defaultSelection",I);M.set("selectedIndex",I);}else{M.set("selectedIndex",-1);M.set("defaultSelection",-1);M.set("text","");}}M.render();},children:[{scriptClass:"mstrmojo.VBox",alias:"vBoxAlias",cssClass:"login_Vbox",children:[{scriptClass:"mstrmojo.HBox",alias:"iServerNameNodeHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13085,"Remote I-Server Location")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"iServerNameNodeAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.hostname;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"iServerPortHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13086,"Remote I-Server Port")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"iServerPortAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.Port;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"iServerProjectHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13087,"Remote Server Project")},{scriptClass:"mstrmojo.Pulldown",alias:"iServerProject",popupToBody:true,itemField:"pn",itemIdField:"pgd",bindings:{popupZIndex:"this.parent.parent.parent.zIndex"},onvalueChange:function(){var J=this,I=J.selectedIndex;G=J.items[I].pn;E=J.items[I].pgd;},premousedown:function(I){if(!this.items||(this.items.length===0)){var K=this.parent.parent.iServerNameNodeHBox.iServerNameNodeAlias.value;var J=this.parent.parent.iServerPortHBox.iServerPortAlias.value;if(K&&J){mstrApp.getRootController().projectController.getProjectsFromRemote(K,J);}}else{if(F.getButton(I.hWin,I.e)===F.MOUSE_BUTTON.LEFT){this.togglePopup();}}}}]},{scriptClass:"mstrmojo.HBox",alias:"loginHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13088,"Project Login")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"loginAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.mdDBRole.ln;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"passwordHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13089,"Project Password")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"passwordAlias",type:"password",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.mdDBRole.password;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"dsNameHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13090,"Data Source Name")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"dsNameAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.n;}return"";}}}]}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Button");var E=mstrmojo.desc,I=mstrmojo.css;mstrmojo.requiresDescs(221,1442,13216,13217,13218,13219,13220,13221,13222);function F(L){return L.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");}function G(L){return L.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&");}function H(L,S,O,P){var Q=F(S);var N=F(O);var R='<prs><ClientID v="'+Q+'"/><ClientSecret v="'+N+'"/>';if(!L){var M=F(P);R+='<RedirectURL v="'+M+'"/>';}return R+"</prs>";}function A(Q){var R=this;var L=R.oaDBRole;var P=mstrmojo.DI.DIConstants;var O;if(Q){O=P.setDefaultOAuthParamCMD;}else{O=H(R.isOneTier,R.inputPanel.clientID.value,R.inputPanel.clientSecret.value,R.inputPanel.callbackURL.value);}L.oa=O;mstrApp.getRootController().getDataService().saveDBRole({errorMsg:E(13216,"Save OAuth parameters failed."),success:mstrmojo.emptyFn,failure:function N(S){mstrApp.getRootController().displayError(this.errorMsg+S.message);},complete:function M(){R.close();}},{dbroleinfo:JSON.stringify(L)});}function B(P){var L=P.oaDBRole.oa;if(L!==""){var O=L.indexOf("ClientID");var M=L.indexOf("RedirectURL");var Q=L.substring(O+"ClientID".length+4,L.indexOf('"/>',O));var N=L.substring(M+"RedirectURL".length+4,L.indexOf('"/>',M));P.inputPanel.clientID.set("value",G(Q));if(!P.isOneTier&&M>-1){P.inputPanel.callbackURL.set("value",G(N));}}}function D(){var L=this;mstrApp.getRootController().getDataService().populateDBRoles({errorMsg:E(13217,"Get OAuth information failed."),success:function(M){L.oaDBRole=M.dbrs[0];B(L);},failure:function(M){mstrApp.getRootController().displayError(this.errorMsg+M.message);}},{objectID:L.did});}function K(){var M=this;var O=M.parent;var N=M.callbackURL.value;var P=M.clientID.value;var L=M.clientSecret.value;if(P&&P.length>0&&L&&L.length>0){if(O.isOneTier||(N&&N.length>0)){O.btns.ok.set("enabled",true);I.addClass(O.btns.ok.domNode,"hot");}}else{O.btns.ok.set("enabled",false);I.removeClass(O.btns.ok.domNode,"hot");}}mstrmojo.DI.DIOAuthParaEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIOAuthParaEditor",cssClass:"mstrmojo-di-DIOAuthParaEditor",title:"",sourceName:"",isOneTier:false,did:"",sourceItem:null,oaDBRole:null,children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:3,cols:2,alias:"inputPanel",checkValue:function(L){if(L.value&&L.value.length>0){K.call(this);}else{this.parent.btns.ok.set("enabled",false);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-OAuthParaEditor-Label",slot:"0,0",alias:"callbackURLLabel",text:E(13218,"Callback URL")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-OAuthParaEditor-urlInput",slot:"0,1",alias:"callbackURL",onvalueChange:function(){this.parent.checkValue(this);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-OAuthParaEditor-Label",slot:"1,0",text:E(13219,"Client ID")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-OAuthParaEditor-textInput",slot:"1,1",alias:"clientID",onvalueChange:function(){this.parent.checkValue(this);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-OAuthParaEditor-Label",slot:"2,0",text:E(13220,"Client Secret")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-OAuthParaEditor-textInput",slot:"2,1",alias:"clientSecret",type:"password",onvalueChange:function(){this.parent.checkValue(this);}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-OAuthParaEditor-setDefault",alias:"setDefault",text:E(13221,"Reset to Default"),onclick:function(){A.call(this.parent,true);}},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-VIButton mstrmojo-Editor-button",alias:"ok",text:mstrmojo.desc(1442,"OK"),enabled:false,onclick:function(){A.call(this.parent.parent,false);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-VIButton mstrmojo-Editor-button",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],onOpen:function C(){if(this._super){this._super();}this.set("title",E(13222,"Set OAuth Parameters for ###").replace("###",this.sourceName));this.inputPanel.callbackURL.set("value","");this.inputPanel.clientID.set("value","");this.inputPanel.clientSecret.set("value","");D.call(this);this.setDefault.set("visible",this.isOneTier);this.inputPanel.callbackURL.set("visible",!this.isOneTier);this.inputPanel.callbackURLLabel.set("visible",!this.isOneTier);},onClose:function J(){if(this._super){this._super();}mstrmojo.css.removeClass(this.sourceItem.domNode,"selected");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.warehouse.EnumObjectTypes");var K=mstrmojo.warehouse.EnumObjectTypes,H=mstrmojo.desc(12218,"Rename Object"),C=mstrmojo.desc(11457,"Please enter name:"),G=mstrmojo.desc(11440,"(lookup)"),D=mstrmojo.desc(518,"Attribute"),I=mstrmojo.desc(1821,"db conn"),J=mstrmojo.desc(11458,"Fact"),B=mstrmojo.desc(7755,"Table");function E(){var M=mstrmojo.string.trim(this.txtbox.value);if(!this.isNew){if(M===this.originalName){if(this.onCancel){this.onCancel();}this.close();return ;}}if(mstrApp.getRootController().validateName(this.tp||this.data.tp,M,((this.isNew?undefined:this.originalName)))){this.onOK(M);this.close();}}mstrmojo.architect.ui.editors.NameEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.NameEditor",cssClass:"mstrmojo-ar-ne",isNew:false,originalName:"",tp:undefined,txtbox:undefined,error:undefined,onOpen:function F(){var O=this.data,N=O.n||O.name,M=this.txtbox,P=M.domNode;N=(N.indexOf(G,0)>0)?N.substr(0,N.indexOf(G)):N;this.originalName=N;M.set("value",N);P.focus();P.select();switch(O.tp){case K.ATTRIBUTE:this.set("title",D+" - "+O.n);break;case K.FACT:this.set("title",J+" - "+O.n);break;case K.TABLE:this.set("title",B+" - "+O.n);this.warningBox.set("visible",true);break;case K.DBROLE:this.set("title",I);break;default:this.set("title",H);break;}},children:[{scriptClass:"mstrmojo.Label",text:C},{scriptClass:"mstrmojo.TextBox",alias:"txtbox",onkeyup:function A(M){switch(M.e.keyCode){case 13:E.call(this.parent);break;case 27:this.parent.close();break;default:break;}}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Warning-Box",alias:"warningBox",visible:false,children:[{scriptClass:"mstrmojo.Box",cssClass:"icon"},{scriptClass:"mstrmojo.Label",text:"This operation requries a schema update and can take a while",cssClass:"message"}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button rightfloat mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function L(){E.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function L(){var M=this.parent.parent;if(M.onCancel){M.onCancel();}M.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(12726,13016,13588,13589,13590,13591,13611);var B=mstrmojo.array,C=mstrmojo.dom;function A(){var D=[{dda:true,n:mstrmojo.desc(12726,"Connect Live"),desc:mstrmojo.desc(13588,"Access up-to-the-minute data via live queries."),hot:true},{dda:false,n:mstrmojo.desc(13589,"Import as an In-memory Dataset"),desc:mstrmojo.desc(13590,"Upload your data and build an in-memory dataset for rapid analysis."),hot:true}];return D;}mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog",callback:null,title:mstrmojo.desc(11922,"Data Access Mode"),cssClass:"mstrmojo-di-dda-confirm",selectedIndex:0,help:"",preBuildRendering:function(){var F=[],D=["mstrmojo-di-button","mstrmojo-WebButton"],E,G;if(this._super){this._super();}E=A();B.forEach(E,function(H){G=new mstrmojo.Button({cssClass:H.hot?D.concat(["hot",H.icon||""]).join(" "):D.concat(H.icon||"").join(" "),text:H.n,useRichTooltip:true,updateTooltipConfig:function(){var J=this,I=C.position(J.domNode);J.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:H.desc,top:Math.max(I.y+40,0),left:Math.max(I.x+I.w/2,0),posType:mstrmojo.tooltip.POS_TOPCENTER};},slot:"containerNode",onclick:function(){this.parent.handleContinue(H);}});F.push(G);});this.addChildren(F);},handleContinue:function(F){var D=mstrApp.getRootController(),H=this.callback,G=D.getDDAController(),E=this;G.onToggleDDA(F.dda);G.askUserAboutDDA(true);if(!H){D.getPublishController().saveAndPublishNoConfirm();}else{if(H.onOK){H.onOK();}}E.close();},children:[{scriptClass:"mstrmojo.Label",cssClass:"confirm-title",text:mstrmojo.desc(13591,"How would you like to access your data?")}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Button","mstrmojo.array");mstrmojo.requiresDescs(221,1442,13216,13217,13218,13219,13220,13221,13222,14712,14713,14714,14715);var E=mstrmojo.array;function C(){var H=this,G=H.urlList,F=mstrApp.getRootController();F.getDataService().DISetURLWhiteListTask({success:function(I){E.forEach(I&&I.split(";"),function(J){J=J.trim();if(J&&J.length){G.addURL(J);}});},failure:function(I){F.displayError(mstrmojo.desc(14713,"Get URL white list failed"),false,I&&I.message);}});}function D(){var H=this,G=H.urlList,F=mstrApp.getRootController(),I=G.urls.concat();F.getDataService().DISetURLWhiteListTask({success:function(){H.close();},failure:function(J){F.displayError(mstrmojo.desc(14714,"Save URL white list failed"),false,J&&J.message);}},{sv:I.join(";")});}mstrmojo.DI.DIWhiteListEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIWhiteListEditor",cssClass:"mstrmojo-di-DIWhiteListEditor",title:mstrmojo.desc(14712,"Set Allowed URLs"),help:"About_importing_data.htm",sourceName:"",isOneTier:false,sourceItem:null,children:[{scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",initValue:false,postBuildRendering:function(){this.emptyText=mstrmojo.desc(12812,"Supported URL format: #### ").replace("####",mstrmojo.DI.DIHelpers.getURLCaption());if(this._super){return this._super();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-add-url-button mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(531,"Add"),onclick:function(){var F=this.parent.urlInput.value;if(F.length===0){return ;}this.parent.urlList.addURL(F);this.parent.urlInput.set("value","");},visible:true},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-DIWhiteListEditor-title",text:mstrmojo.desc(14715,"List of Allowed URLs")},{scriptClass:"mstrmojo.DI.FileDragDropBox",alias:"urlList",text:"",draggable:false,fileUpload:false,cssClass:"mstrmojo-di-url-box",visible:true,getFilesCnt:function(){var F=0;if(this.parent.urlInput.value&&this.parent.urlInput.value!==""){F=this.urls?this.urls.length+1:1;}else{F=this.urls?this.urls.length:0;}return F;},getFileUrl:function(F){if(F<this.urls.length){return mstrmojo.string.trim(this.urls[F]);}if(this.parent.urlInput.value!==""){return mstrmojo.string.trim(this.parent.urlInput.value);}return"";},onurlsChange:function(){if(this._super){this._super();}if(this.updateItemsCount){this.updateItemsCount(this.getURLCnt());var F=this.getURLCnt();this.updateItemsCount(F);if(F>1&&F<5){this.countNode.style.marginTop=F*(-33)+"px";}else{if(F>=5){this.countNode.style.marginTop="-140px";}}}}},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",alias:"ok",text:mstrmojo.desc(1442,"OK"),onclick:function(){D.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],onOpen:function B(){if(this._super){this._super();}C.call(this);},onClose:function A(){if(this._super){this._super();}mstrmojo.css.removeClass(this.sourceItem.domNode,"selected");this.destroy();}});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo.Editor","mstrmojo.Label","mstrmojo.HBox");mstrmojo.requiresDescs(218,219,3610,9161,10040,10041,13318,13073,13074,13075,13076,13077,13078,13079,13080,13081);var C=[mstrmojo.desc(13073,"The following attribute, which is currently used to personalize the dashboard, is missing. ")+'<span style="color:red;"><u>'+mstrmojo.desc(13074,"If you do not include it, personalization will not be applied")+"</u></span>"+mstrmojo.desc(13075," and users could have access to more data than they are currently allowed to view."),mstrmojo.desc(13076,"The following attributes, which are currently used to personalize the dashboard, are missing. ")+'<span style="color:red;"><u>'+mstrmojo.desc(13077,"If you do not include them, personalization will not be applied")+"</u></span>"+mstrmojo.desc(13075," and users could have access to more data than they are currently allowed to view.")],B=[mstrmojo.desc(13078,"If you still want to make this change please unmap the attributes by going to Share>Personalize."),mstrmojo.desc(13079,"If you still want to make this change please unmap the attribute from your Recipient List by going to Share>Deliver.")],A=[mstrmojo.desc(13080,"The following object is missing which could affect your dashboard definition."),mstrmojo.desc(13081,"The following objects are missing which could affect your dashboard definition.")];mstrmojo.qb.MissingColumnWarning=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.MissingColumnWarning",cssClass:"",title:mstrmojo.desc(3610),hasPT:false,isCube:true,warning:mstrmojo.desc(10040,"Some of the previously uploaded columns are missing"),details:mstrmojo.desc(10041,"If you do not import previously used columns, existing reports, documents and analyses might be affected. Do you still want to continue?"),onOpen:function(){var F=this.mappings,E=this.hasPT,D=this.buttonBox,G=(F.length>1)?1:0;this.set("title",mstrApp.isCloudPro?(E?mstrmojo.desc(9161,"Oops!"):mstrmojo.desc(13318,"Just Checking")):mstrmojo.desc(3610));this.list.set("items",F);this.warningLabel.set("text",E?C[G]:(mstrApp.isCloudPro?A[G]:this.warning));this.detailLabel.set("text",E?B[this.isCube?0:1]:this.details);D.YesButton.set("visible",!E);D.NoButton.set("visible",!E);D.OKButton.set("visible",E);},cssText:"width: 400px",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-MissingColumns-title",alias:"warningLabel"},{scriptClass:"mstrmojo.List",alias:"list",cssClass:"mstrmojo-qb-MissingColumns-list",itemIdField:"did",itemMarkupFunction:function(D,F,G){var E='<div class="mstrmojo-qb-MissingColumns-bullet mstrmojo-qb-MissingColumns-Icon t'+D.tp+'">'+D.n+"</div>";return E;}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-MissingColumns-instruction",alias:"detailLabel"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-MissingColumns-buttonBox",slot:"buttonNode",alias:"buttonBox",cssText:"float:right;background:transparent;height:45px;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-Yes",text:mstrmojo.desc(219,"Yes"),alias:"YesButton",onclick:function(D){var F=this.parent.parent;var E=true;if(F.onOK){E=F.onOK();}if(E){F.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-No",text:mstrmojo.desc(218,"No"),alias:"NoButton",onclick:function(D){var E=this.parent.parent;if(E.onCancel){E.onCancel();}E.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-OK",alias:"OKButton",onclick:function(D){this.parent.parent.close();}}]}],onRender:function(){this.helpNode&&(this.helpNode.style.display="none");this.closeNode&&(this.closeNode.style.display="none");}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Editor","mstrmojo.Box","mstrmojo.CheckBox","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(4531,8262,12437,12438,12439);var D=mstrmojo.hash;var E={Automatic:0,Manual:3};var I={Automatic:-1,False:0,True:1};var H={Automatic:-1,False:1,True:2};var F={mps:{afb:I.False,sfb:H.False,fbf:E.Automatic}};var B=["mps"],K=function(P,N){var O=this.parent.parent,L=O.cloneModel,M=L.mps||{};if(M[P]!==N){M[P]=N;O.set("dirty",true);}};mstrmojo.ME.DerivedMetricOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ME.DerivedMetricOptions",cssClass:"mstrmojo-DerivedMetricOptions",dirty:false,init:function J(L){this._super(L);mstrmojo.css.addWidgetCssClass(this,"dme");},updateModel:function C(){var M=this.model,L=this.cloneModel,N=L.mps;if(N.fbf===E.Automatic){N.afb=I.Automatic;N.sfb=H.Automatic;}N.dirty=true;M.mps=L.mps;},onOpen:function A(){var N=this.cloneModel||{};D.make(N,mstrmojo.Obj);var M=mstrmojo.hash.copy(this.model,mstrmojo.hash.copy(F)),O,L;for(O=0,L=B.length;O<L;O++){N.set(B[O],D.clone(M[B[O]]));}this.cloneModel=null;this.set("cloneModel",N);},onClose:function G(){this.set("dirty",false);delete this.cloneModel;},children:[{scriptClass:"mstrmojo.HBox",alias:"fbFlagBox",cssClass:"mstrmojo-DerivedMetricOptions-aggBox",children:[{scriptClass:"mstrmojo.Label",cssText:"white-space: nowrap; margin-right: 8px; vertical-align: top;",text:mstrmojo.desc(12437,"Aggregation And Subtotal Behavior:")},{scriptClass:"mstrmojo.Pulldown",alias:"fbFlag",cssText:"min-width: 100px;",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"v",items:[{n:mstrmojo.desc(4531,"Automatic"),v:E.Automatic},{n:mstrmojo.desc(8262,"Manual"),v:E.Manual}],bindings:{value:function(){return this.parent.parent.cloneModel.mps.fbf||E.Automatic;}},onvalueChange:function(L){if(L.value!==undefined&&L.valueWas!==undefined){K.call(this,"fbf",L.value);}}}]},{scriptClass:"mstrmojo.Box",cssText:"height: 30px",cssClass:"mstrmojo-DerivedMetricOptions-afbBox",children:[{scriptClass:"mstrmojo.CheckBox",alias:"afb",cssDisplay:"inline-block",label:mstrmojo.desc(12438,"Aggregate From Base"),bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.afb===I.True;}},onclick:function(L){var M=this.parent.parent.fbFlagBox.fbFlag.value;K.call(this,"afb",M===E.Automatic?I.Automatic:(this.checked?I.True:I.False));}},{scriptClass:"mstrmojo.CheckBox",alias:"sfb",cssDisplay:"inline-block",label:mstrmojo.desc(12439,"Subtotals From Base"),oncheckedChange:function(L){var M=this.parent.afb;if(L.value){M.checked=I.True;M.onclick();if(M.inputNode){M.inputNode.checked=true;M.inputNode.disabled=true;}}else{if(M.inputNode){M.inputNode.disabled=false;}}},bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.sfb===H.True;}},onclick:function(){var L=this.parent.parent.fbFlagBox.fbFlag.value;K.call(this,"sfb",L===E.Automatic?H.Automatic:(this.checked?H.True:H.False));}}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:mstrmojo.desc(2397,"OK"),bindings:{enabled:function(){return this.parent.parent.dirty;}},onclick:function(){var L=this.parent.parent;L.updateModel();if(L.onOK){L.onOK();}L.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){var L=this.parent.parent;L.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Box","mstrmojo.Editor","mstrmojo.Widget","mstrmojo.hash");var G=mstrmojo.hash;mstrmojo.requiresDescs(12705);function I(T){var R="";var S;for(S in T){if(T.hasOwnProperty(S)){R+="&"+S+"="+encodeURIComponent(T[S]);}}return R;}function M(T){var R="";var S;for(S in T){if(T.hasOwnProperty(S)){R+="&"+S+"="+encodeURIComponent(T[S]);}}return R;}function D(S,W,Y,V,X,R){if(R.showProgress){mstrApp.showProgress(R);}var T=W+"?"+I.call(this,V);var U={taskId:"DataWranglerServer",command:T};if(S){U.postData=M.call(this,X);}window.setTimeout(function(){mstrApp.serverProxy.request(mstrmojo.func.wrapMethods({success:mstrmojo.emptyFn,complete:function(){if(R.showProgress){mstrApp.hideProgress();}},failure:mstrmojo.emptyFn},Y),U,false,{});},0);}mstrmojo.Refine.DataService=mstrmojo.declare(mstrmojo.Obj,null,{projectID:null,refineServerURL:null,getPreviewData:function J(T,R,S){D.call(this,true,"command/core/get-rows",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getColumns:function Q(S,R){D.call(this,false,"command/core/get-models",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getHistory:function E(S,R){D.call(this,false,"command/core/get-history",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getOperations:function F(S,R){D.call(this,false,"command/core/get-operations",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getProcesses:function C(T,S,R){D.call(this,false,"command/core/get-processes",T,S,null,{showProgress:true,progressValue:R.progress,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},applyOperations:function L(T,R,S){D.call(this,true,"command/core/apply-operations",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeFacets:function A(T,R,S){D.call(this,true,"command/core/compute-facets",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeFacetsQuiet:function N(T,R,S){D.call(this,true,"command/core/compute-facets",T,R,S,{showProgress:false,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeClusters:function B(T,R,S){D.call(this,true,"command/core/compute-clusters",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},massEdit:function K(T,R,S){D.call(this,true,"command/core/mass-edit",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},undoRedo:function P(T,R,S){D.call(this,true,"command/core/undo-redo",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},addSampleData:function O(T,R,S){D.call(this,true,"command/core/append-sample",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},setSampleData:function H(T,R,S){D.call(this,true,"command/core/set-sample",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getSampleStatus:function H(T,R,S){D.call(this,true,"command/core/get-sample",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Editor","mstrmojo.Box","mstrmojo.Label","mstrmojo.CheckBox","mstrmojo.ui.Checkbox","mstrmojo.HTMLButton","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(221,308,5369,12829,12830,12831,12862,12863,12864,12865,12866,12867,12868,12869,12870,12871,12872,12873,13643,13644,13645);var B=mstrmojo.DI.DIConstants.formsOptions,L=mstrmojo.array,P=mstrmojo.DI.DIConstants;mstrmojo.DI.MultiFormItem=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.MultiFormItem",editor:null,formMap:null,visible:true,linkedColumnId:null,closeButtonVisible:true,children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",bindings:{text:function(){return this.parent.parent.formMap.alias||this.parent.parent.formMap.name;},title:function(){return this.parent.parent.formMap.alias||this.parent.parent.formMap.name;}}},{scriptClass:"mstrmojo.Pulldown",alias:"formPullDown",popupToBody:true,itemField:"fmn",itemIdField:"fmid",bindings:{popupZIndex:"this.parent.parent.editor.zIndex",linkedColumnId:"this.parent.parent.linkedColumnId"},preBuildRendering:function O(){var R=this.parent.parent,U=R.editor,S=R.formMap,T=S.forms,V=S.formId,Q;if((U.attribute.isLinked)&&(V===U.idFormId)&&U.isMultiLinked&&(U.formsOption===B.CREATE_MULTIFORM_ATTRIBUTE)){this.set("items",T);Q=L.find(T,this.itemIdField,V);this.set("defaultSelection",Q);}else{if((U.attribute.isLinked)&&(V===U.idFormId)&&(!U.isMultiLinked)){this.enabled=false;this.set("items",[{fmid:0,fmn:U.idFormName}]);this.set("defaultSelection",0);}else{this.set("items",T);Q=L.find(T,this.itemIdField,V);this.set("defaultSelection",Q);}}},onvalueChange:function(){var S=this,R=S.selectedIndex,Q=this.parent.parent;Q.editor.onFormChanged(Q.formMap,S.items[R].fmid,this.parent);}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"displayFormCheckbox",checked:false,label:"",oncheckedChange:function(){var Q=this.parent.parent;Q.formMap.displayForm=this.checked?"1":"0";var R=Q.editor;L.forEach(R.tableIds,function(T){var S=R.tables[T];L.forEach(S.formMaps,function(U){if(U.formId===Q.formMap.formId){U.displayForm=Q.formMap.displayForm;}});});},preBuildRendering:function O(){var Q=this.parent.parent;this.set("checked",Q.formMap.displayForm==="1");}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-Editor-close",alias:"removeButton",onclick:function(){var Q=this.parent.parent;Q.editor.onRemoveMap(Q.formMap);},preBuildRendering:function O(){this.visible=this.parent.parent.closeButtonVisible;}}]}]});mstrmojo.DI.DIMultiFormEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIMultiFormEditor",tables:null,tableIds:null,attribute:null,attributes:null,cssClass:"mstrmojo-di-multiformeditor",formMaps:null,formsOption:null,idFormId:"",idFormName:"",idMap:null,isShared:null,isMultiLinked:null,tableId:null,noButtonCls:true,linkedColumnId:"",help:"Create_Multiform_Attribute_dialog_box.htm",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(5369,"Submit"),alias:"submit",useRichTooltip:true,updateTooltipConfig:function(){var Q=this.domNode;var R={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:Q,top:-32};R.content=this.title;this.set("richTooltip",R);},onclick:function(){var Q=this.parent.parent;Q.updateMapping();Q.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var Q=this.parent.parent;Q.close();Q.destroy();}}],children:[{scriptClass:"mstrmojo.VBox",alias:"boxContainer",cssClass:"mstrmojo-di-multiformeditor-boxContainer",children:[{scriptClass:"mstrmojo.VBox",alias:"tableAndAttributeNameContainer",children:[{scriptClass:"mstrmojo.HBox",alias:"attributeNameContainer",cssClass:"mstrmojo-di-multiformeditor-attributeNameContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"new-attribute-Label",text:mstrmojo.desc(12862,"New Attribute Name:")},{scriptClass:"mstrmojo.TextBox",alias:"attributeName",cssClass:"mstrmojo-di-multiformeditor-attributeName",onvalueChange:function(){var Q=this.parent.parent.parent.parent;Q.attribute.alias=this.value;}}]},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-di-multiformeditor-tablePulldown",alias:"tablesPullDown",popupToBody:true,itemField:"n",itemIdField:"id",visible:false,bindings:{popupZIndex:"this.parent.parent.parent.editor.zIndex"},preBuildRendering:function(){if(mstrmojo.ui.Pulldown.prototype.preBuildRendering){mstrmojo.ui.Pulldown.prototype.preBuildRendering.call(this);}var Q=this.getPopupList();Q.set("useRichTooltip",true);Q.set("tooltipOpenDelay",0);},postselectedIndexChange:function(Q){var S=this.parent.parent.parent;var U=Q.value,R=Q.valueWas,T;if(U!==R){T=S.tableIds[U];S.setEditorConfig(T);}}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-multiformeditor-formMapsListHeader",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-multiformeditor-formMapsListHeader-formName",text:""},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-multiformeditor-formMapsListHeader-formCategory",text:mstrmojo.desc(12864,"Form Category")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-multiformeditor-formMapsListHeader-displayForm",text:mstrmojo.desc(12865,"Display Form")}]},{scriptClass:"mstrmojo.WidgetList",alias:"formMapsList",cssClass:"mstrmojo-di-multiformeditor-formMapsList",visible:true,itemFunction:function J(U,R,T){var W=U.formId;var Q=!((T.parent.parent.isShared)&&(W===T.parent.parent.idFormId));var S=(T.items.length===1)?false:true;var V=new mstrmojo.DI.MultiFormItem({editor:T.parent.parent,formMap:U,linkedColumnId:T.parent.parent.linkedColumnId,parent:T,closeButtonVisible:Q&&S});return V;},bindings:{items:function(){return this.parent.parent.formMaps;},linkedColumnId:function(){return this.parent.parent.linkedColumnId;}}}]}],getDescription:function M(Q){switch(Q){case B.ADDTO_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12866,"Include in the Multi-forms Attribute the following attribute forms:");case B.CREATE_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12866,"Include in the Multi-forms Attribute the following attribute forms:");case B.EDIT_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12867,"Edit Multi-forms Attribute with the following attribute forms:");}return"";},getTitle:function H(Q){switch(Q){case B.ADDTO_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12868,"Add to Multi-forms Attribute");case B.CREATE_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12869,"Create Multi-forms Attribute");case B.EDIT_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12870,"Edit Multi-forms Attribute");}return"";},setEditorConfig:function N(T){this.set("tableId",T);var S=this.tables;var R=S[T];if(R.isShared){var Q=mstrApp.getRootController().formsController.getLinkedColumnId(R.attribute,R.attributes,R.idFormId);if(Q){this.set("linkedColumnId",Q);}}this.set("idMap",R.idMap);this.set("idFormId",R.idFormId);this.set("idFormName",R.idFormName);this.set("formsOption",R.formsOption);this.set("attribute",R.attribute);this.set("attributes",R.attributes);this.set("isShared",R.isShared);this.set("formMaps",R.formMaps);this.set("isMultiLinked",R.isMultiLinked);},onOpen:function F(){this.setEditorConfig(this.tableIds[0]);this.validateForms();this.set("title",this.getTitle(this.formsOption));var R=this.boxContainer.tableAndAttributeNameContainer;var S=R.tablesPullDown;var U="";if(this.formsOption===B.CREATE_MULTIFORM_ATTRIBUTE&&this.idMap){U=this.idMap.alias||this.idMap.name;}else{U=this.attribute.alias||this.attribute.name;}R.attributeNameContainer.attributeName.set("value",U);var Q=this.tableIds,X=this.tables;S.set("visible",false);if(this.formsOption===B.EDIT_MULTIFORM_ATTRIBUTE||this.formsOption===B.CREATE_MULTIFORM_ATTRIBUTE){if(this.tableIds.length>1){var T=[],Y,W="";L.forEach(Q,function(Z){W=X[Z].tableName;Y={};Y[S.itemIdField]=Z;Y[S.itemField]=W;T.push(Y);});S.set("items",T);var V=L.find(T,S.itemIdField,this.attribute.tableId);S.set("selectedIndex",V);S.set("visible",true);}}},preBuildRendering:function O(){this._super();this.setEditorConfig(this.tableIds[0]);},onFormChanged:function K(R,X,Y){R.formId=X;var U,T,V=this;if(V.isMultiLinked){L.forEach(V.tableIds,function(Z){U=V.tables[Z];T=U.formMaps;L.forEach(T,function(a){if(a.name===R.name){a.formId=X;}if(a.formId===V.idFormId){U.idMap=a;}});});}var Q=!((this.isShared)&&(X===this.idFormId));var S=(this.formMaps.length===1)?false:true;var W=Q&&S;Y.removeButton.set("visible",W);this.validateForms();if(X===this.idFormId){this.idMap=R;U=V.tables[V.tableId];U.idMap=R;}},onRemoveMap:function A(Q){Q.remove="-1";this.boxContainer.formMapsList._remove(Q);var T=this.tables[this.tableId];var S=T.formMaps;if(T.formsOption===B.CREATE_MULTIFORM_ATTRIBUTE){L.removeItem(S,Q);}var R=this.validateForms();if(Q.formId===this.idFormId){if(R[0].idMaps.length>0){this.idMap=R[0].idMaps[0];T.idMap=this.idMap;}else{this.idMap=null;T.idMap=null;}}},updateMapping:function E(){var R=this.validateAttributeName();var U=null;if(R){var Q=mstrApp.getRootController();var T=this;var S=0;var V={success:function(){S++;if(S>=T.tableIds.length){var W=P.requestFlag.mapping|P.requestFlag.sourceInfo|P.requestFlag.relationship;Q.getImportedDataEMMA(P.actions.none,W);T.destroy();}else{U=T.tables[T.tableIds[S]];Q.formsController.updateMapping(U.formsOption,U.tableId,U.attribute,U.attributes,U.isShared,U.formMaps,U.idMap,V);}}};if(T.tableIds&&T.tableIds.length){U=T.tables[T.tableIds[0]];Q.formsController.updateMapping(U.formsOption,U.tableId,U.attribute,U.attributes,U.isShared,U.formMaps,U.idMap,V);}}},setSubmitBtn:function D(V){var R=this.btnHbox.submit;var S,Y,X=true,W=[],T=[],Q=[],U="";for(S=0;S<V.length;S++){Y=V[S];X=X&&Y.valid;}R.set("enabled",X);if(X){R.title="";return ;}for(S=0;S<V.length;S++){Y=V[S];if(Y.idMaps.length===0){W.push(Y.tableName);}if(Y.haveEmptyForm){T.push(Y.tableName);}if(Y.duplicateMaps.length>0){Q.push(Y.tableName);}}if(W.length>0){U=mstrmojo.desc(13643,"A column must be assigned to the ID form category within each table containing a multi-form attribute. Table ### violates this condition.");U=this.concatErrorMsg(W,U);}else{if(Q.length>0){U=mstrmojo.desc(13644,"The same Form Category cannot be used more than once within each table containing a multi-form attribute. Table ### violates this condition.");U=this.concatErrorMsg(Q,U);}else{U=mstrmojo.desc(13645,"A column cannot have an empty Form Category  within any table containing a multi-form attribute. Table ### violates this condition.");U=this.concatErrorMsg(T,U);}}R.title=U;},concatErrorMsg:function G(Q,U){var R,S,T=Q.length;if(T===1){S=Q[0];}else{if(T===2){S=Q[0]+" "+mstrmojo.desc(308,"and")+" "+Q[1];}else{for(R=0;R<T-2;R++){S+=Q[R];S+=", ";}S+=Q[T-2];S+=" ";S+=mstrmojo.desc(308,"and");S+=" ";S+=Q[T-1];}}U=U.replace("###",S);return U;},validateAttributeName:function C(){var Y=this.attribute.alias;var W=mstrApp.getRootController(),V=W.model;if(!Y||Y.length<=0){W.displayError(mstrmojo.desc(12829,"Cannot rename column with empty string."));V.raiseEvent({name:"MappingsFetched"});return false;}if(Y.length>=250){W.displayError(mstrmojo.desc(12830,"Cannot rename column with a too long string."));V.raiseEvent({name:"MappingsFetched"});return false;}if(P.invalidObjectNameCharsRegex.test(Y)){W.displayError(mstrmojo.desc(12831,"Cannot rename column with string contains the following characters: ####").replace("####",P.invalidObjectNameChars));V.raiseEvent({name:"MappingsFetched"});return false;}var T=V.getAllMappings();var U,S,Q,Z,R;for(U=0;U<T.length;U++){Q=T[U];var X=false;for(S=0;S<this.attributes.length;S++){if(Q.oid===this.attributes[S].oid){X=true;break;}}if(X){continue;}if(Y===Q.alias&&this.attribute.tp===Q.tp){Z=true;break;}}if(Z){R=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");W.displayError(R.replace("##",Y));return false;}return true;},validateForms:function I(){var b,S,a,T,c,U=null,Z,Y,R,f;var d=this.tables,V=this.tableIds,e,X,W=[];for(Y=0;Y<V.length;Y++){b=[];S=[];c=[];f=false;X=V[Y];e=d[X];a=e.formMaps;T=a?a[0].forms:[];T.push({fmid:this.idFormId,fmn:"ID"});L.forEach(a,function(g){if(g.remove!=="-1"){c.push(g);}});a=c;L.forEach(a,function(g){f=f||(L.find(T,"fmid",g.formId)===-1);});T.pop();for(Z=0;Z<a.length;Z++){U=a[Z];if(U.formId===this.idFormId){b.push(U);}}for(Z=0;Z<a.length;Z++){U=a[Z];if(L.find(S,"formId",U.formId)===-1){var Q=L.findMulti(a,"formId",[U]);if(Q.count>1){S.push({formId:U.formId,indices:Q.indices});}}}R=((b.length===1)&&(S.length===0)&&!f);W.push({tableName:e.tableName,valid:R,idMaps:b,duplicateMaps:S,haveEmptyForm:f});}this.setSubmitBtn(W);return W;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo._HasPopup","mstrmojo.ListBase","mstrmojo.Popup","mstrmojo.Editor","mstrmojo.SuggestionList");function D(Y){var X=this.list,V=X.selectedIndex,U=X.items.length,W=Y?U-1:0;if(V===W){X.clearSelect();return ;}if(V===null||V<0){V=Y?0:U-1;}else{V+=Y?1:-1;}X.singleSelect(V);}mstrmojo._HasSuggestion=mstrmojo.provide("mstrmojo._HasSuggestion",mstrmojo.hash.copy(mstrmojo._HasPopup,{blockBegin:1,blockCount:-1,suggestCount:15,autoSelect:true,itemField:"n",candidates:null,suggestionShown:false,suggestionItems:null,_last_hit:null,_request_pattern:null,browseItemVisible:false,folderLinksContextId:25,browsableTypes:"1,8",REQUEST_THRESHOLD:20,noCache:false,disableClick:false,getCandidatesThroughTaskCall:mstrmojo.emptyFn,onSuggestionItemSelect:function J(U){this.hideSuggestion();},getSearchPattern:function T(){return"";},getSuggestionPos:function N(){return{left:"100px",top:"100px"};},getSuggestionTarget:function G(){return this;},showSuggestion:function B(V){var U=this.getSuggestion(V);if(!this.noCache&&U!==-1){this.updateSuggestion(U);}},hideSuggestion:function C(){this.suggestionShown=false;if(this.suggestionPopup.visible){this.suggestionPopup.close();}},getSelected:function M(){return(this.suggestionShown)?this._lastOpened.getSelected():null;},nextHighlight:function E(){if(this.suggestionShown){this._lastOpened.nextHighlight();}},preHighlight:function H(){if(this.suggestionShown){this._lastOpened.preHighlight();}},getSuggestion:function S(h){var d=this.candidates,a=d&&d.items,X=d&&d.isComplete,g=this._last_hit;if(!this.noCache&&(d||g)){var f=this.filterCandidates(a,h,this.REQUEST_THRESHOLD),b=f.length,e=this.suggestCount,U=false;if(!X&&b<e){var V=g&&g.pattern;if(g&&V&&(h.indexOf(V)>-1)){U=true;var k=this.filterCandidates(g.items,h,this.REQUEST_THRESHOLD),Y=k&&k.length,W=mstrmojo.array,j=this.itemField,Z;for(Z=0;Z<Y;Z++){if(W.find(f,j,k[Z][j])===-1){f.push(k[Z]);}}b=f.length;}}if(!X&&((h.length>2&&b<this.REQUEST_THRESHOLD)||(b<e))){this.requestCandidates(h);return -1;}return(b<e)?f:f.slice(0,e);}this.requestCandidates(h);return -1;},requestCandidates:function A(U){this._request_pattern=U;var X=this,V=this.getSuggestionTarget(),W={success:function(e){if(!e){return ;}var d=X.getSuggestionTarget();if(!d||(V!==d)){return ;}var j=d.getSearchPattern(),a=e.items;X._last_hit={items:a,pattern:U};X.sz=e.sz;if(!X.noCache&&a){var f=(X.candidates&&X.candidates.items)||[],g=[].concat(a),b=a.length,Z;for(Z=0;Z<b;Z++){var Y=g[Z];if(mstrmojo.array.indexOf(f,Y)>-1){mstrmojo.array.removeItem(a,Y);}}if(X.candidates){X.candidates.items=f.concat(a);}}if(j&&j.indexOf(U)>-1){var h=X.filterCandidates(a,j);X.updateSuggestion(h);}},failure:function(Y){if(Y.getResponseHeader){mstrmojo.alert(Y.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};this.getCandidatesThroughTaskCall({pattern:U,blockBegin:this.blockBegin,blockCount:this.blockCount,isSuggest:true},W);},filterCandidates:function Q(X,W,U){U=U||this.suggestCount;W=mstrmojo.string.regEscape(W);var Y=this.itemField,V=mstrmojo.array.filter(X,function(Z){return(new RegExp("\\s"+W+"|^"+W,"i")).test(Z[Y]);},{max:U});return V;},getHighlightedText:function P(W,Z){if(!this.highlightPattern||mstrmojo.string.isEmpty(W)){return Z;}try{if(!this.nameWildcards||mstr.$A.find([2,32],parseInt(this.nameWildcards,10))>-1){Z=Z.replace(new RegExp("(^|\\s)("+W+")","gi"),"$1<b>$2</b>");}else{var Y=W.split(" "),V,U;for(V=0,U=Y.length;V<U;V++){if(Y[V]!==""){Z=Z.replace(new RegExp("("+Y[V]+")","gi"),"<b>$1</b>");}}}}catch(X){}return Z;},updateSuggestion:function O(X){var V=X&&X.length,U=this.browseItemVisible;if(V||U){if(U){X=X||[];X.push({n:"Browse...",t:-99,cssClass:(V?"br":"bro")});}this.set("suggestionItems",X);if(this.suggestionShown){var W=this._lastOpened;if(W&&W.nudge){W.nudge();}if(this.autoSelect&&W){W.list.singleSelect(0);}}else{this.openPopup("suggestionPopup",this.getSuggestionPos());this.suggestionShown=true;}}else{this.hideSuggestion();}},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",onClose:function(){var U=this.opener;if(U&&U.onBrowserClose){U.onBrowserClose();}},onOpen:function(){var U=this.opener;if(U&&U.onBrowserOpen){U.onBrowserOpen();}},children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},onBrowserClose:function L(){this.browserShown=false;},handleSuggestionItemSelect:function K(U,V){if(this.browseItemVisible&&U.t===-99){this.hideSuggestion();mstrmojo.requiresCls("mstrmojo.ObjectBrowser");var W=this.zIndex;this.openPopup("ob",{zIndex:(W&&(W+10))||110});this.ob.browser.browse(mstrmojo.hash.copy(V,{folderLinksContextId:this.folderLinksContextId,onSelectCB:[this,"onSuggestionItemSelect"],browsableTypes:this.browsableTypes}));this.browserShown=true;}else{this.onSuggestionItemSelect(U);}},highlightPattern:true,suggestionPopupCssClss:"",suggestionPopup:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-ObjectInputBox-suggest",autoClose:true,locksHover:true,nextHighlight:function(){D.call(this,true);},preHighlight:function(){D.call(this,false);},getSelected:function M(){var U=this.list;return U.items[U.selectedIndex];},onOpen:function I(){var U=this.opener;if(U){mstrmojo.css.addClass(this.domNode,U.suggestionPopupCssClss||"");if(U.autoSelect){this.list.singleSelect(0);}if(U.nudge){U.nudge(this);}}},onClose:function F(){this.list.clearSelect();var U=this.opener;if(U){U.suggestionShown=false;mstrmojo.css.removeClass(this.domNode,U.suggestionPopupCssClss||"");}}},suggestionListClass:"mstrmojo.SuggestionList",postApplyProperties:function R(){this.suggestionPopup.children=[{scriptClass:this.suggestionListClass,alias:"list",cssClass:"mstrmojo-suggest-list"}];}}));}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.ImportSource","mstrmojo.DI.DIConstants","mstrmojo.DI.OAuthSource","mstrmojo.DI.OAuthAnalytics","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIDatabaseHelper","mstrmojo.DI.model.HistoryList","mstrmojo.DI.model._ConnectLive","mstrmojo.DI.model._DISources","mstrmojo.DI.model.Schedule");mstrmojo.requiresDescs(218,219,3958,7151,8516,8520,8531,8545,8552,8553,8556,8558,8560,8561,9149,9214,9926,10056,10057,10058,10059,10060,10061,10062,10072,10171,10174,11108,11109,11164,12442,12444,12447,12448,12449,12451,12452,12454,12455,12456,12460,12461,12462,12463,12498,12542,12711,12712,12713,12748,12749,12750,12751,12752,12753,12754,12755,12756,12757,12758,12759,12760,12977,12978,12979,12980,12981,12982,12983,12984,12985,12986,12987,12988,12989,12990,12991,12992,12993,12994,12995,12996,12997,12998,13041,13223,13224,13225,13226,13227,13411,13412,13413,13414,13415,13416,13417,13418,13419,13420,13421,13422,13423,13424,13425,13426,13978,14039,14040,14041,14042,14043,14044,14045,14046,14047,14048,14049,14050,14051,14052,14053,14054,14201);var g=mstrmojo.DI.DIConstants,T=mstrmojo.warehouse.EnumDatabaseType,P=mstrmojo.array,V=mstrmojo.hash,J=mstrmojo.DI.DIHelpers;function I(p){var n,o=0,m={},k=p.agis,j,t,h,l,q;if(k){o=k.length;}for(n=0;n<o;n++){t=k[n];h=t.atid;l=t.agi.fms;q=t.agi.maps;j={fms:l,maps:q};m[h]=j;}return m;}function W(k,h,l){var j=k+"_"+h;if(l){j=l;}return j;}function L(k,h,l){var j=new mstrmojo.DI.ImportSource();j.initialize(k,h,W(k,h,l),l);return j;}function Q(n,j){var l={isPartition:false},m,h=[],k;if(!j){n.set("partition",l);return ;}l.type=j.tp;l.isPartition=l.type!==0;m=j.ptabs||[];P.forEach(m,function(o){k={};if(o.n){k.name=o.n;}if(o.hasOwnProperty("shnb")){k.sheetIndex=o.shnb;}h.push(k);});l.tables=h;n.set("partition",l);}function C(l,k){var m=k.datap.srce,j,h;if(l.sourceInfo){l.sourceInfo.destroy();}j=l.sourceInfo=new mstrmojo.Obj();if(m.iurl){j.set("name",m.url);}else{j.set("name",mstrmojo.string.decodeHtmlString(m.tbn)||"");}if(m.tbal){j.set("name",mstrmojo.string.decodeHtmlString(m.tbal)||"");}j.set("dbTableName",m.tbn||"");if(m.xt===g.xdaType.excel||m.xt===g.xdaType.text||m.xt===g.xdaType.dataImportOAuthDropbox||m.xt===g.xdaType.dataImportOAuthGDrive){j.set("sheetName",m.file_description.shn);j.set("sheetIndex",m.file_description.shnb);j.set("hasInsertedColumnHeaders",m.file_description.hnchs);}if(m.dbrid){j.set("dbRoleId",m.dbrid);}if(m.des){j.set("des",m.des);}if(m.ns){j.set("dbNamespace",m.ns);}if(m.said){j.set("said",m.said);}if(m.gbqp){j.set("gbqp",m.gbqp);}Q(j,m.pti);h=m.file_description;if(h){if(h.url!==undefined){j.set("url",h.url);}if(h.srcid){j.set("sourceId",h.srcid);}if(h.oid){j.set("objectId",h.oid);}if(h.odesc){j.set("objectDesc",h.odesc);}if(h.rdtr){j.set("delimiter",h.rdtr);}if(h.qt){j.set("quotes",h.qt);}if(h.hasOwnProperty("chrn")){j.set("skipRows",h.chrn);}if(h.hasOwnProperty("fil")){j.set("fileStruct",h.fil);}if(h.hasOwnProperty("hnchs")){j.set("hasNewHeaders",h.hnchs);}if(h.mimetype){j.set("mimetype",h.mimetype);}if(h.maxr){l.set("fetchNum",h.maxr);}}j.set("isRefined",m.irfd);j.set("hasAggFilter",m.ifaa);j.set("hnc",m.hnc);}function e(m,l){if(!m){return null;}var h=m.datap.srce,o=m.datap.tbid||l,j,p;if(!h){if(l){j=this.getImportSource(l);}else{j=null;}return j;}switch(h.xt){case g.xdaType.text:case g.xdaType.excel:if(h.txt===g.xdaType.text){p=m.datap.shts&&m.datap.shts[0].indexOf(":\\fakepath\\");if(p&&p>=0){m.datap.shts[0]=m.datap.shts[0].substr(p+11);}}switch(h.dict){case g.backendSourceSubtype.samplefile:j=this.importSources[W(g.sourceType.file,g.sourceSubtype.samplefile,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.samplefile,o);}break;case g.backendSourceSubtype.publicData:j=this.importSources[W(g.sourceType.file,g.sourceSubtype.publicData,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.publicData,o);}break;case g.backendSourceSubtype.url:j=this.importSources[W(g.sourceType.file,g.sourceSubtype.url,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.url,o);}break;case g.backendSourceSubtype.localFile:j=this.importSources[W(g.sourceType.file,g.sourceSubtype.localFile,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.localFile,o);}break;case g.backendSourceSubtype.clipboard:j=this.importSources[W(g.sourceType.file,g.sourceSubtype.clipboard,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.clipboard,o);}break;default:if(h.file_description&&h.file_description.url!==""){j=this.importSources[W(g.sourceType.file,g.sourceSubtype.url,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.url,o);}}else{if(h.tbn===""){j=this.importSources[W(g.sourceType.file,g.sourceSubtype.clipboard,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.clipboard,o);}else{j.set("type",g.sourceType.file);j.set("subtype",g.sourceSubtype.clipboard);}}else{j=this.importSources[W(g.sourceType.file,g.sourceSubtype.localFile,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.localFile,o);}}}break;}break;case g.xdaType.refine:j=this.importSources[W(g.sourceType.file,g.sourceSubtype.localFile,o)];if(!j){j=this.selectImportSource(g.sourceType.file,g.sourceSubtype.localFile,o);}break;case g.xdaType.dataImportOAuthGDrive:j=this.importSources[W(g.sourceType.googleDrive,g.sourceSubtype.googleDrive,o)];if(!j){j=this.selectImportSource(g.sourceType.googleDrive,g.sourceSubtype.googleDrive,o);}break;case g.xdaType.dataImportOAuthDropbox:j=this.importSources[W(g.sourceType.dropbox,g.sourceSubtype.dropbox,o)];if(!j){j=this.selectImportSource(g.sourceType.dropbox,g.sourceSubtype.dropbox,o);}break;case g.xdaType.salesforce:j=this.importSources[W(g.sourceType.salesforce,g.sourceSubtype.salesforce,o)];if(!j){j=this.selectImportSource(g.sourceType.salesforce,g.sourceSubtype.salesforce,o);}break;case g.xdaType.dataImportOAuthGAnalytics:j=this.importSources[W(g.sourceType.googleAnalytics,g.sourceSubtype.googleAnalytics,o)];if(!j){j=this.selectImportSource(g.sourceType.googleAnalytics,g.sourceSubtype.googleAnalytics,o);}break;case g.xdaType.dataImportOAuthGBigQuery:j=this.importSources[W(g.sourceType.googleBigQuery,g.sourceSubtype.googleBigQuery,o)];if(!j){j=this.selectImportSource(g.sourceType.googleBigQuery,g.sourceSubtype.googleBigQuery,o);}break;case g.xdaType.dataImportOAuthGBigQueryFFSQL:j=this.importSources[W(g.sourceType.googleBigQuery,g.sourceSubtype.googleBigQueryFFSQL,o)];if(!j){j=this.selectImportSource(g.sourceType.googleBigQuery,g.sourceSubtype.googleBigQueryFFSQL,o);}break;case g.xdaType.dataImportOAuthGBigQuerySingleTable:j=this.importSources[W(g.sourceType.googleBigQuery,g.sourceSubtype.googleBigQuerySingleTable,o)];if(!j){j=this.selectImportSource(g.sourceType.googleBigQuery,g.sourceSubtype.googleBigQuerySingleTable,o);}break;case g.xdaType.mdx:j=this.importSources[W(g.sourceType.mdx,g.sourceSubtype.mdx,o)];if(!j){j=this.selectImportSource(g.sourceType.mdx,g.sourceSubtype.mdx,o);}break;case g.xdaType.qbSingleTable:case g.xdaType.ffsql:case g.xdaType.querybuilder:var q=g.sourceType.querybuilder,n=g.sourceSubtype.querybuilder,t,k;if(h.dbvs===223){q=g.sourceType.bisource;n=g.sourceSubtype.bisource;}else{if(m.datap.srce.dbtp!==undefined){t=m.datap.srce.dbtp;k=h.dbvs;switch(t){case T.SearchEngineSOLR:case T.SearchEngineSPLUNK:n=g.sourceSubtype.searchOnSource;break;case 4000:if(h.xt===g.xdaType.qbSingleTable){n=g.sourceSubtype.hanaSingleTable;}break;default:n=g.sourceSubtype.querybuilder;break;}}}j=this.importSources[W(q,n,o)];if(!j){j=this.selectImportSource(q,n,o);}j.xdaType=h.xt;j.databaseType=t;j.databaseVersion=k;j.dbrid=m.datap.srce.dbrid;break;case g.xdaType.twitter:j=this.importSources[W(g.sourceType.twitter,g.sourceSubtype.twitter,o)];if(!j){j=this.selectImportSource(g.sourceType.twitter,g.sourceSubtype.twitter,o);}break;case g.xdaType.facebook:j=this.importSources[W(g.sourceType.facebook,g.sourceSubtype.facebook,o)];if(!j){j=this.selectImportSource(g.sourceType.facebook,g.sourceSubtype.facebook,o);}break;}if(h&&h.tbn){if(J.strStartsWith(h.tbn,"hdfs://")){j.type=g.sourceType.hadoop;j.subtype=g.sourceSubtype.hadoop;}}j.xdaType=h.xt;if(m.datap.crt!==undefined){j.refreshType=m.datap.crt;j.origRefreshType=j.refreshType;}if(m.datap.bin!==undefined){j.binaryExists=(m.datap.bin!==1);}if(m.datap.ac!==undefined){j.executeAction=m.datap.ac;}if(m.datap.tbn!==undefined){j.dbTableName=m.datap.tbn;}if(m.datap.state){j.hasRefreshedData=m.datap.state.bin===1;if(m.datap.state.op!==undefined){j.tableState=m.datap.state.op;}}C(j,m);return j;}function B(h){var j=h.currentTransformations;return(j&&j.xtab&&j.xtab.isCrosstab)?h.transformedMapping:h.currentMapping;}function N(u,m,t,l){var k=g.xdaType,j=u.xdaType,q=u.sourceInfo,p=t.sourceInfo,h=j===t.xdaType,o,n;if(u.sourceInfo.isRefined||t.sourceInfo.isRefined){return false;}switch(j){case k.excel:if(u.subtype===g.sourceSubtype.url&&t.subtype===g.sourceSubtype.url){h=h&&q.url===p.url;h=h&&q.fileStruct===p.fileStruct&&q.skipRows===p.skipRows;}else{if(u.subtype===g.sourceSubtype.localFile&&t.subtype===g.sourceSubtype.localFile){o=u.srcTableID||u.tableID;n=t.srcTableID||t.tableID;h=h&&o===n;h=h&&q.fileStruct===p.fileStruct&&q.skipRows===p.skipRows;}else{h=false;}}break;case k.text:h=h&&u.subtype===g.sourceSubtype.url&&t.subtype===g.sourceSubtype.url;h=h&&q.fileStruct===p.fileStruct&&q.delimiter===p.delimiter;h=h&&q.quotes===p.quotes&&q.skipRows===p.skipRows;break;case k.qbSingleTable:h=h&&q.dbRoleId&&q.dbRoleId===p.dbRoleId;h=h&&((!q.dbNamespace&&!p.dbNamespace)||q.dbNamespace===p.dbNamespace);break;default:h=false;}h=h&&m&&l&&m.length===l.length;if(!h){return false;}P.forEach(m,function(x,w){if(!(x.ix===l[w].ix&&x.tp===l[w].tp&&x.id===l[w].id&&(j!==k.qbSingleTable||x.n===l[w].n))){h=false;return false;}return true;});return h;}function S(j){var k=g.cubeSchedStatus,h;P.forEach(j,function(l){var m=l.subs,n=false,o=true,p;m=m?[].concat(m):[];if(m.length>0){P.forEach(m,function(q){p=q.status&&q.status.length>0&&q.status[q.status.length-1];if(p){n=true;o=o&&(p.en===0);}});if(!n){h=k.unexecuted;}else{if(o){h=k.successful;}else{h=k.failed;}}}else{h=k.unscheduled;}l.schedStatus=h;});return j;}mstrmojo.DI.DIModel=mstrmojo.declare(mstrmojo.Obj,[mstrmojo.DI.model._ConnectLive,mstrmojo.DI.model._DISources],{scriptClass:"mstrmojo.DI.DIModel",refresh_opt:1,folderID:"",cubeID:"",cubeName:"",cubesInfo:0,isManagedCube:false,cubeDesc:"",analysisID:"",currentSource:null,externalSources:{},importSources:null,operationMode:g.operationMode.create,refineServerURL:null,dbObjectsDisplayOptions:17,subsInfo:null,subsStatus:null,isCubePublished:false,rawDataExistsInAE:false,attributeFormInfo:{},cubeConfig:{},xquerySources:{},cubeQuota:0,isAddingNewTable:false,datasets:null,publishedDatasets:null,currentDataset:null,hasMergedReportInstance:false,isCalledByFlex:false,cubePersisted:false,partitionGroups:null,isCubeSaved:false,reportDefinitionId:null,getHistoryList:function O(){if(this._HL===undefined){this._HL=new mstrmojo.DI.model.HistoryList();}return this._HL;},getSchedule:function(){if(this._Schedule===undefined){this._Schedule=new mstrmojo.DI.model.Schedule();}return this._Schedule;},sampleFiles:{file:[{display:mstrmojo.desc(14039,"Airline Sample Data"),name:"airline-sample-data.xls",url:"http://mirror.microstrategy.com/datahub/samples/airline-sample-data.xls",desc:mstrmojo.desc(14040,"On-time and delayed flights for airlines operating in the three main Washington, DC-area airports"),size:6.5,iscrosstab:"false"},{display:mstrmojo.desc(14041,"Campaign Finance Data"),name:"campaign-finance-sample-data.xls",url:"http://mirror.microstrategy.com/datahub/samples/campaign-finance-sample-data.xls",desc:mstrmojo.desc(14042,"Financial data about campaigns for Senate, House of Representatives, and President of the United States"),size:1,iscrosstab:"false"},{display:mstrmojo.desc(14044,"Gaming Sample Data"),name:"gaming-sample-data.xls",url:"http://mirror.microstrategy.com/datahub/samples/gaming-sample-data.xls",desc:mstrmojo.desc(14043,"Slot machine data for casino floor analysis. Data available at the day and individual machine level"),size:15.1,iscrosstab:"false"},{display:mstrmojo.desc(14045,"Global Migration Data"),name:"global-migration.xls",url:"http://mirror.microstrategy.com/datahub/samples/global-migration.xls",desc:mstrmojo.desc(14046,"2000 global bilateral migration data from the World Bank"),size:0.1,iscrosstab:"false"},{display:mstrmojo.desc(14047,"Income Tax Return Data"),name:"income-tax-sample-data.xls",url:"http://mirror.microstrategy.com/datahub/samples/income-tax-sample-data.xls",desc:mstrmojo.desc(14048,"2007 income tax return data items classified by state and county"),size:0.4,iscrosstab:"false"},{display:mstrmojo.desc(14049,"Inventory Sample Data"),name:"Inventory-Sample-Data.xls",url:"http://mirror.microstrategy.com/datahub/samples/Inventory-Sample-Data.xls",desc:mstrmojo.desc(14050,"Data for inventory analysis at standalone, mall and strip mall locations"),size:0.6,iscrosstab:"false"},{display:mstrmojo.desc(14051,"Retail Sample Data"),name:"retail-sample-data.xls",url:"http://mirror.microstrategy.com/datahub/samples/retail-sample-data.xls",desc:mstrmojo.desc(14052,"Retail data for category management analysis. Metrics include cost, revenue, unit cost, units sold"),size:2.3,iscrosstab:"false"},{display:mstrmojo.desc(14053,"Worldwide CO2 Emissions"),name:"Worldwide-CO2-Emissions.xls",url:"http://mirror.microstrategy.com/datahub/samples/Worldwide-CO2-Emissions.xls",desc:mstrmojo.desc(14054,"Worldwide, energy-related carbon dioxide emissions for the 1990-2010 time period"),size:0.5,iscrosstab:"false"}]},initParams:function U(h){switch(h.StatusCode){case g.statusCode.edit:this.set("operationMode",g.operationMode.edit);break;case g.statusCode.obtainSource:this.set("operationMode",g.operationMode.refresh);break;case g.statusCode.xformsError:case g.statusCode.mappingError:this.set("operationMode",g.operationMode.refresh);break;case g.statusCode.republish:this.set("operationMode",g.operationMode.refresh);break;case g.statusCode.schedule:this.set("operationMode",g.operationMode.subscribe);break;case g.statusCode.enterCredentials:this.set("operationMode",g.operationMode.enterCredentials);break;default:this.set("operationMode",g.operationMode.create);break;}if(mstrApp.isSingleTier){this.refineServerURL="http://localhost:3333/";}else{this.refineServerURL="http://"+mstrConfig.serverName+":3333/";}this.cubeID=h.ReportId;this.cubeName=h.CubeName;this.folderID=h.FolderId||"";this.cubeDesc=h.CubeDesc;if(h.isDirectDataAccess){this.set("isDirectDataAccess",h.isDirectDataAccess);}if(h.SubsId){this.getSchedule().subsID=h.SubsId;}if(h.SubsName){this.getSchedule().subsName=h.SubsName;}if(h.DocumentID){this.analysisID=h.DocumentID;}else{if(h.AnalysisId){this.analysisID=h.AnalysisId;if(h.isManagedCube!==undefined&&this.cubeID){this.isManagedCube=h.isManagedCube;}else{if(!mstrApp.isSingleTier&&mstrApp.launchingApp&&mstrApp.launchingApp.pageName==="Html5Vi"){this.isManagedCube=true;}else{this.isManagedCube=false;}}}}if(h.isCalledByFlex){this.isCalledByFlex=h.isCalledByFlex;this.isManagedCube=false;}if(h.datasets){this.populateVIDatasets(h.datasets);if(mstrApp.refreshMultipleCubes){this.set("cubesInfo",h.datasets);}}if(h.documentModel){this.set("documentModel",J.createMSTRObjects(h.documentModel,["dbRole"]));}if(h.missingCredentialsData){this.set("missingCredentialsData",h.missingCredentialsData);}this.refreshMode=h.RefreshMode;this.importSources={};this.publishedDatasets=[];},updateDocumentCredentials:function f(k,j){var h=this;mstrmojo.array.forEach(k,function(l){mstrmojo.array.forEach(h.documentModel.datasets,function(m){mstrmojo.array.forEach(m.tables,function(n){if(n.did===l){n.set("credentialsFetched",j);}});});});},selectImportSource:function X(l,h,k){var j=this.importSources[W(l,h,k)];if(!j){j=L(l,h,k);this.importSources[j.key]=j;}this.raiseEvent({name:"ImportTypeChanged"});return j;},populateExternalSources:function b(){if(document.location.protocol.indexOf("https")>-1||mstrApp.isSingleTier){var j=new mstrmojo.DI.OAuthSource({type:g.sourceType.dropbox,subtype:g.sourceSubtype.dropbox,name:"Dropbox",dbRoleID:"897B0012B9A24BF9AB297BA654F21482",scope:"",oauthVersion:"2.0",sourceID:"https://www.dropbox.com"});this.externalSources[g.sourceType.dropbox]=j;var o=new mstrmojo.DI.OAuthSource({type:g.sourceType.googleDrive,subtype:g.sourceSubtype.googleDrive,name:"Google Drive",dbRoleID:"4FC38D1FC0E140EB8FCD2CBAA235E1DE",scope:"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/drive.readonly",oauthVersion:"2.0",sourceID:"https://drive.google.com"});this.externalSources[g.sourceType.googleDrive]=o;var l=new mstrmojo.DI.OAuthAnalytics({type:g.sourceType.googleAnalytics,subtype:g.sourceSubtype.googleAnalytics,name:"Google Analytics",dbRoleID:"1304214B5640429EBC5FA0820E64DEC4",oauthVersion:"2.0",scope:"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/analytics.readonly ",sourceID:"http://www.google.com/analytics/"});this.externalSources[g.sourceType.googleAnalytics]=l;var n=new mstrmojo.DI.OAuthSource({type:g.sourceType.googleBigQuery,subtype:g.sourceSubtype.googleBigQuery,name:"Google BigQuery",dbRoleID:"021CDA5330A0437A8477B597796F2AC3",oauthVersion:"2.0",scope:"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/bigquery.readonly",step2:mstrmojo.desc(12461,"Make a query and get results"),step3:mstrmojo.desc(12462,"Publish cube to create documents"),sourceID:"https://developers.google.com/bigquery/"});this.externalSources[g.sourceType.googleBigQuery]=n;var k=new mstrmojo.DI.OAuthSource({type:g.sourceType.salesforce,subtype:g.sourceSubtype.salesforce,name:"Salesforce",step2:mstrmojo.desc(12463,"Select Your Report"),dbRoleID:"AC41E217C55342DC871C511E77EBE4D0",oauthVersion:"2.0",scope:"id api refresh_token web",sourceID:"https://www.salesforce.com"});this.externalSources[g.sourceType.salesforce]=k;var m=new mstrmojo.DI.OAuthSource({type:g.sourceType.twitter,subtype:g.sourceSubtype.twitter,name:"Twitter",dbRoleID:"7FADDA9B2CF44458A38DE40C786FD99D",oauthVersion:"1.0",sourceID:"https://www.twitter.com"});this.externalSources[g.sourceType.twitter]=m;var h=new mstrmojo.DI.OAuthSource({type:g.sourceType.facebook,subtype:g.sourceSubtype.facebook,name:"Facebook",dbRoleID:"C4232C63F23D4932B75CFBAC950EADE7",oauthVersion:"2.0",scope:"email user_likes public_profile",sourceID:"https://www.facebook.com"});this.externalSources[g.sourceType.facebook]=h;}},getTags:function(j){var h=this.searchTags[j];if(h){return h;}},getDisplayOptionsByType:function(k){var j=this.searchTags[k];var h;if(j){mstrmojo.array.forEach(j,function(l){if(l==="Hadoop"){h=16;}else{if(l==="Database"){h=1;}}});return h;}},populateAllTables:function(m,j,q){var p=this;var k=m.datap.length;var n;var h=0;var t={},o,u={},l=false;o=this.getAllTableID();if(m.rit){this.isCubePublished=(m.rit.pcube===1);this.rawDataExistsInAE=(m.rit.eprd===1);}if(m.prs&&m.prs.dda){this.connectLiveSupport=m.prs.dda;}if(this.operationMode!==g.operationMode.create&&m.prs&&m.prs.ddam){this.isDirectDataAccess=(m.prs.ddam===2);}for(n=0;n<k;n++){t.datap=m.datap[n];t.btb=m.btb;t.forms=m.forms;t.prs=m.prs;h|=this.populateEMMA(t,j,null,true);if(t.datap.tbid){u[t.datap.tbid]=true;}}if(m.rit&&m.rit.ts&&m.rit.ts.length){P.forEach(m.rit.ts,function(w){var x=p.getImportSource(w.tbid);if(x){x.forceRepublish=(w.ac===1);x.schemaChanged=(w.crt!==0);if(w.ac===1){x.refreshType=g.cubeRefreshType.replaceTable;x.executeAction=g.tableStatsExecutionAction.forceExecution;}}});}P.forEach(o,function(w){if(u[w]!==true){l=true;this.resetImportSource(w);}},this);if(l){this.raiseEvent({name:"MappingsFetched"});}this.raiseEvent({name:"tableNamesChanged"});n=this.populateTablesPosition(m);if(n&&!q){this.raiseEvent({name:"TablesPositionFetched"});}if((j&g.requestFlag.sourceInfo)===g.requestFlag.sourceInfo){if(!q){this.raiseEvent({name:"SourceInfoFetched"});}}if((h&g.requestFlag.relationship)===g.requestFlag.relationship){if(!q){this.raiseEvent({name:"RelationshipFetched"});}}if((h&g.requestFlag.mapping)===g.requestFlag.mapping){if(!q){this.raiseEvent({name:"MappingsFetched"});}}return h;},populateTablesPosition:function(n){var t=-1,o,m,l,p,k,j,h,q=false;if(n.btb){p=[].concat(n.btb);}for(o=0;p&&o<p.length;o++){if(p[o].oi&&p[o].oi.tp===3){t=o;break;}}if(t<0){return ;}m=n.btb[t].oi.def.em.sou.it_c;this.cubePersisted=n.btb[t].oi.sta&256;if(!m){return ;}m=[].concat(m);for(o=0;o<m.length;o++){l=m[o];k=l.tb.did;j=this.getImportSource(k);if(j){h=j.populatePosition(l.sqltf);q=q||h;}}return q;},populate:function K(k,l){if(k.btb&&k.btb[0]&&k.btb[0].oi&&k.btb[0].oi.def&&k.btb[0].oi.def.crpt){this.refresh_opt=k.btb[0].oi.def.crpt;}if(k.prs){this.connectLiveSupport=k.prs.dda;}var j;if((l&g.requestFlag.sourceInfo)===g.requestFlag.sourceInfo){j=e.call(this,k);this.raiseEvent({name:"SourceInfoFetched"});}var h=j.populate(k,l);if((h&g.requestFlag.preview)===g.requestFlag.preview){this.raiseEvent({name:"PreviewFetched"});}if((h&g.requestFlag.transformedPreview)===g.requestFlag.transformedPreview){this.raiseEvent({name:"TransformedPreviewFetched"});}if((h&g.requestFlag.mapping)===g.requestFlag.mapping){this.raiseEvent({name:"MappingsFetched"});}else{if((l&g.requestFlag.mapping)===g.requestFlag.mapping){this.raiseEvent({name:"MappingsNotFetched"});}}if((h&g.requestFlag.sheets)===g.requestFlag.sheets){this.raiseEvent({name:"SheetsFetched"});}if((h&g.requestFlag.transformations)===g.requestFlag.transformations){this.raiseEvent({name:"TransformationsFetched"});}this.currentSource=j;return h;},populateAttributeGroup:function F(j,h){this.attributeFormInfo[h]=I(j);},populateCubeConfig:function A(k){var h={},n=k.datap,m,l={},o=[];if(n[0]){m=n[0];}else{m=n;}var j=m.pas?m.pas[0]:null;h.keyId=j?j.atid:"";h.pf=m.pf||0;if(k.sidxes){P.forEach(k.sidxes,function(p){o.push({atid:p.stat,afid:p.stafid});});}l.distInfo=h;l.sidxes=o;l.initialSet=V.clone(l);l.autopa=m.autopa===1;if(m.autopa===1){l.distInfo.keyId="autopa";}this.cubeConfig=l;this.raiseEvent({name:"CubeConfigFetched"});},populateWikiSuggestions:function E(h){this.set("wikiSuggestions",h[1]);},populateWikiSearchResults:function Y(h){this.wikiSearchResults=h;this.raiseEvent({name:"wikiSearchResultsFetched"});},populateEMMA:function R(l,k,p,o){var h,m,q,n;if(l.rit){this.isCubePublished=(l.rit.pcube===1);this.rawDataExistsInAE=(l.rit.eprd===1);}if(l.prs&&l.prs.dda){this.connectLiveSupport=l.prs.dda;}if(this.operationMode!==g.operationMode.create&&l.prs&&l.prs.ddam){this.isDirectDataAccess=(l.prs.ddam===2);}q=-1;if(l.btb){n=[].concat(l.btb);for(m=0;n&&m<n.length;m++){if(n[m].oi&&n[m].oi.tp===3){q=m;break;}}if(q>-1){this.reportDefinitionId=l.btb[q].oi.did;}}if(Object.prototype.toString.call(l.datap)==="[object Array]"){return this.populateAllTables(l,k,o);}if((k&g.requestFlag.sourceInfo)===g.requestFlag.sourceInfo){h=e.call(this,l,p);if(!o){this.raiseEvent({name:"SourceInfoFetched"});}}if(!h){h=this.importSources[p];}var j=h.populate(l,k,h.tableID);if((j&g.requestFlag.preview)===g.requestFlag.preview){if(!o){this.raiseEvent({name:"PreviewFetched"});}}else{if((k&g.requestFlag.preview)===g.requestFlag.preview){if(!o){this.raiseEvent({name:"PreviewNotFetched"});}}}if((j&g.requestFlag.relationship)===g.requestFlag.relationship){if(!o){this.raiseEvent({name:"RelationshipFetched"});}}if((j&g.requestFlag.transformedPreview)===g.requestFlag.transformedPreview){if(!o){this.raiseEvent({name:"TransformedPreviewFetched"});}}if((j&g.requestFlag.mapping)===g.requestFlag.mapping){this.getAllMappings();if(!o){this.raiseEvent({name:"MappingsFetched"});}}else{if((k&g.requestFlag.mapping)===g.requestFlag.mapping){if(!o){this.raiseEvent({name:"MappingsNotFetched"});}}}if((j&g.requestFlag.sheets)===g.requestFlag.sheets){if(!o){this.raiseEvent({name:"SheetsFetched"});}}if((j&g.requestFlag.transformations)===g.requestFlag.transformations){if(!o){this.raiseEvent({name:"TransformationsFetched"});}}return j;},getAllMappings:function(){var l,k,m,o,p;var n=[];for(l in this.importSources){m=this.importSources[l];if(m.currentTransformations&&m.currentTransformations.xtab&&m.currentTransformations.xtab.isCrosstab){p=m.transformedMapping;}else{p=m.currentMapping;}if(p){for(k=0;p&&k<p.length;k++){o=p[k];o.isLinked=false;if(o.id){var h=mstrmojo.array.find(n,"id",o.id);if(h<0){n.push(o);}else{n[h].isLinked=true;o.isLinked=true;}}else{n.push(o);}}}}return n;},getAllRelationships:function(){var n,m,h,q,t,l;var o=[];var p=false;for(n in this.importSources){q=this.importSources[n];t=q.relationship;if(t){for(m=0;m<t.length;m++){l=t[m];p=false;for(h=0;h<o.length;h++){if(o[h].parent.id===l.parent.id&&o[h].child.id===l.child.id&&o[h].ert===l.ert){p=true;break;}}if(!p){o.push(l);}}}}return o;},findMappingSource:function(m){var k=[];var o,n,h,l,q;if(!m){return k;}for(o in this.importSources){h=this.importSources[o];if(h.currentTransformations&&h.currentTransformations.xtab&&h.currentTransformations.xtab.isCrosstab){q=h.transformedMapping;}else{q=h.currentMapping;}if(q){for(n=0;n<q.length;n++){l=q[n];if(m.id){if(l.id&&l.id===m.id){if(m.isAttributeForm){if(l.isMultiForm){var t=l.subColumns,p=mstrmojo.array.find(t,"afid",m.afid);if(p>=0){k.push(h);break;}}else{if(l.afid===m.afid){k.push(h);break;}}}else{k.push(h);break;}}}else{if(m.oid){if(l.oid&&l.oid===m.oid){k.push(h);break;}}else{if(l.did===m.did){k.push(h);break;}}}}}}return k;},findMappingItem:function(m,l){var k=this.getAllTableID();var n=[];var j,h;if(l){h=this.getImportSource(l).findMappingItem(m);if(h){n.push(h);}}else{for(j=0;j<k.length;j++){h=this.getImportSource(k[j]).findMappingItem(m);if(h){n.push(h);}}}return n;},getAllMissingColumns:function(){var l=this.getAllTableID();var h=[];var k,j,m;for(k=0;k<l.length;k++){m=this.getImportSource(l[k]);j=m.getMissingColumns();if(j&&j.length>0){h=h.concat(j);}}return h;},createImportSource:function(h,j,k){return this.selectImportSource(h,j,k);},getImportSource:function(h){return this.importSources[h]||null;},getAllTableID:function(){var h=[];var k,j;for(k in this.importSources){j=this.importSources[k];if(j&&j.tableID){h.push(k);}}return h;},selectSourceTable:function(h){if(this.currentSource&&this.currentSource.key===h){return ;}if(!this.currentSource&&(h===-1||h===null)){this.raiseEvent({name:"CurrentSourceChanged"});return ;}if(h===-1||h===null){this.currentSource=null;}else{this.currentSource=this.getImportSource(h);}this.raiseEvent({name:"CurrentSourceChanged"});},resetImportSource:function(h){if(h){if(this.sheetsInfo&&this.sheetsInfo[h]){delete this.sheetsInfo[h];}if(this.importSources[h]){if(this.importSources[h].sourceInfo){this.importSources[h].sourceInfo.destroy();}this.importSources[h].destroy();}delete this.importSources[h];if(this.currentSource&&this.currentSource.tableID===h){this.currentSource=null;this.raiseEvent({name:"CurrentSourceChanged"});}}else{if(this.currentSource!==null){this.currentSource=null;this.raiseEvent({name:"CurrentSourceChanged"});}this.importSources={};}},hasRelationship:function(l,k,o){var n=this.getImportSource(l),h=n.relationship||[],j,m=false;if(!l||!k||!o){return m;}if(!n){return m;}for(j=0;j<h.length;j++){if(h[j].parent.id===k.id&&h[j].child.id===o.id){m=true;break;}}return m;},isEMMACube:function(){var h;if(this.currentSource&&this.currentSource.tableID){return true;}h=this.getAllTableID().length>0;return h;},hasEMMAReportInstance:function(){return mstrApp.getRootController().dataService.messageID?true:false;},populateSubscriptions:function(l){var j=this;var m=j.cubesInfo;var k=(l&&l.items)||[];var h=m&&m.cubes&&m.cubes.cube;var n=m&&m.cubes&&m.cubes.doc;var o;h=h&&[].concat(h);k=[].concat(k);P.forEach(h,function(p){o=p.cube_id;p.subs=P.filter(k,function(q){return q.contentID===o;});});h=S(h);P.forEach(n,function(q){var p=q.cube?[].concat(q.cube):[];P.forEach(p,function(t){t.subs=P.filter(k,function(u){return u.contentID===t.cube_id;});});S(p);});j.set("subsInfo",k);},populateScheduleStatus:function(w){var h=this.cubesInfo&&this.cubesInfo.cubes&&this.cubesInfo.cubes.cube;var u=this.cubesInfo&&this.cubesInfo.cubes&&this.cubesInfo.cubes.doc;var l,m,t,p,q;var o=w.sesr&&w.sesr.subscription;var n={},k;function z(AA,j){return AA.timestamp-j.timestamp;}function x(j,AA){AA=[].concat(AA);P.forEach(AA,function(AB){l=AB.did;m=AB.content_id;t=P.find(j,"cube_id",m);if(t>=0){p=P.find(j[t].subs,"did",l);if(p>=0){q=[];P.forEach(AB.exec_status&&[].concat(AB.exec_status),function(AC){q.push({en:AC.en,emsg:AC.emsg,timestamp:new Date(J.normalizeTimestamp(AC.timestamp))});});q.sort(z);j[t].subs[p].status=q;n[l]=q;}}});j=S(j);}if(!o){return ;}x(h,o);P.forEach(u,function(AA){var j=AA.cube?[].concat(AA.cube):[];x(j,o);});k=mstrmojo.hash.copy(this.subsStatus,k);n=mstrmojo.hash.copy(n,k);this.set("subsStatus",n);},mapAttribute:function M(p,k,w,x){var m=this,j=m.getImportSource(p.tableId),q,AA=p.did,o,l,n=k.dssid,u;if(j.currentTransformations&&j.currentTransformations.xtab&&j.currentTransformations.xtab.isCrosstab){q=j.transformedMapping;}else{q=j.currentMapping;}l=k.aid;for(o=0,u=q.length;o<u;o++){if(q[o].afid===(l+n)){if(w&&w.failure){w.failure(mstrmojo.desc(9926,"The attribute form you select has been mapped. Please choose a different one."));}return false;}}var t=mstrmojo.array.find(q,"did",AA),h=q[t],z=function z(){mstrApp.getRootController().changeEMMAMappings();};if(h.isIDForm&&h.multiForms&&!h.ipa){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:function(){var AB=[];mstrmojo.array.forEach(q,function(AC){if(AC.oid===x&&AC.did!==AA){AB.push({did:AC.did,aid:"",ot:12});}});AB.push({did:AA,aid:l,fid:n});z(AB);}}});}else{z();}},getAllPartitionTables:function a(o,l){var m=this.importSources,t=m[o],j,h,p=[],u=[],q,n;function k(x,w){var z;if(x.n<w.n){z=-1;}else{if(x.n===w.n){z=0;}else{z=1;}}return z;}if(!t){return[];}j=B(t);n=this.getAllTableID();P.forEach(n,function(w){if(w!==o){h=m[w];if(N(t,j,h,B(h))){q=h.sourceInfo&&h.sourceInfo.name;p.push({n:q||"",isMember:false,sourceId:w});}}});p.sort(k);P.forEach(l,function(x,w){q=x.name||"";u.push({n:q,isMember:true,ptIndex:w+1});});u.sort(k);p=u.concat(p);return p;},detectPartitionGroups:function H(k){var n=this.importSources,t,l=[],h,o,q,p,j,m=[];if(k.length<=1){return l;}P.forEach(k,function(u){t=n[u];if(!t){return ;}h=B(t);if(!h||!h.length){return ;}o={importSource:t,mapping:h};q=false;P.forEach(l,function(w){if(N(o.importSource,o.mapping,w.importSource,w.mapping)){w.tableIds.push(u);q=true;return false;}return true;});if(!q){o.tableIds=[u];l.push(o);}});P.forEach(l,function(u){if(u.tableIds.length<=1){return ;}j=[];P.forEach(u.tableIds,function(w){t=n[w];p=(t.sourceInfo&&t.sourceInfo.name)||"";j.push(p);});m.push({tableIds:u.tableIds,tableNames:j});});return m;},populateVIDatasets:function(j){var h=[{name:mstrmojo.desc(14201,"A New Dataset"),did:-1}];j=P.filter(j,function(m){var l=true,k=m.tables&&m.tables[0];if(m.dsm===2&&k&&k.dict===g.backendSourceSubtype.url&&k.dbt===T.BDE){l=false;}return l;});h=h.concat(j);this.set("datasets",h);},selectDataset:function(j){var h=mstrApp.getRootController();if(j&&j.did!==-1){this.set("isManagedCube",!!j.mngd);h.rootView.showFooter({managedCheckbox:{enabled:false}});this.set("currentDataset",j||null);}else{this.set("currentDataset",null);h.rootView.showFooter({managedCheckbox:{enabled:true}});this.set("isManagedCube",true);}},canSubscribe:function(){var k=this.getAllTableID(),h=false,j;for(j=0;j<k.length;j++){h|=this.getImportSource(k[j]).canSubscribe();}return h;},isTableAliasUnique:function(k){var m=true,h=this.getAllTableID(),l,j;for(j=0;j<h.length;j++){l=this.getImportSource(h[j]);if(l&&l.sourceInfo&&k===l.sourceInfo.name){m=false;break;}}return m;},hasPrivilegesForAllTables:function d(j){var h=true,k=g.xdaType;P.forEach(j,function(l){switch(l.xdaType){case k.text:case k.excel:case k.refine:case k.dataImportOAuthGDrive:case k.dataImportOAuthDropbox:if(!mstrApp.diParams.AccessDataFromFiles){h=false;return ;}break;case k.dataImportOAuthGBigQuery:case k.dataImportOAuthGBigQueryFFSQL:case k.dataImportOAuthGBigQuerySingleTable:case k.qbSingleTable:case k.ffsql:case k.querybuilder:case k.mdx:if(!mstrApp.diParams.ImportDatabase){h=false;return ;}break;case k.salesforce:case k.dataImportOAuthGAnalytics:case k.twitter:case k.facebook:if(!mstrApp.diParams.AccessDataFromCloudApp){h=false;return ;}break;}});return h;},hasRefreshDataPrivilegesForAllTables:function Z(j){var h=this.hasPrivilegesForAllTables(j);return h||mstrApp.isSingleTier;},isRefreshDataSupported:function D(k,h){var j=g.xdaType;switch(k){case j.dataImportOAuthGDrive:case j.dataImportOAuthDropbox:case j.dataImportOAuthGBigQuery:case j.dataImportOAuthGBigQueryFFSQL:case j.dataImportOAuthGBigQuerySingleTable:case j.dataImportOAuthGAnalytics:case j.dataImportOAuthSalesforce:case j.twitter:case j.facebook:if(document.location.protocol.indexOf("https")<0&&!mstrApp.isSingleTier){return false;}else{return true;}break;default:return true&&!h;}},isRefined:function G(h){var j=this.getImportSource(h);return j?j.isRefined():false;},isParsed:function c(h){var j=this.getImportSource(h);return j?j.isParsed():false;},populateSourceListAdminConfig:function(m,l){var j=this,h=j.sourceItems,k=m;P.forEach(h,function(p){var o=p.sid,n;if(m){n=P.indexOf(k,o);p.selected=n<0;}if(l&&l[o]){p.dbRolesAdminConfig=l[o];}});},isLinkedMFA:function(j){var h=false;var k=this.findMappingItem(j);if(k.length>1){P.forEach(k,function(l){if(l.isMultiForm){h=true;return false;}});}return h;},getUniqueAlias:function(l,k){var m=false,n,j,h;n=this.getAllMappings();n=P.filter(n,function(o){return o.tp===l;});j=1;while(!m){m=true;j++;if(k.length>=250){k=k.substr(0,100)+"..."+k.substr(k.length-100,100);}h=P.find(n,"alias",k);if(h>=0){m=false;k=k+" ("+j+")";}}return k;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo.ui.PopupWidget","mstrmojo.Tooltip","mstrmojo.Slider","mstrmojo.Refine.SampleSlider","mstrmojo.css");mstrmojo.requiresDescs(1302,547,14703,14697,14697,14699,14700,14701,14702,14704,14724);var H=mstrmojo.Button.newWebButton,C=mstrmojo.hash,J=mstrmojo.css;var K=mstrmojo.desc(14697,"Full table size: ### rows"),D=mstrmojo.desc(14698,"Increase the sample size by <br>adding samples randomly <br>from the first 100,000 rows."),B=mstrmojo.desc(14699,"Increase the sample size by <br> adding samples randomly.");function I(N){var T=mstrApp.getRootController(),O=T.refineApp.rootController,M=O.model,S=O.tableID,P=this,R=P.inputbox.textbox.value,Q=null;R=A(P.inputbox.textbox.value);R=parseInt(R,10);if(N&&!isNaN(R)){if(M.hasUploadData){O.setSampleData(R);}else{T.dataService.startRefineStage({success:function(){M.hasUploadData=true;O.setSampleData(R);},failure:function(U){T.displayError(U&&U.message);}},{did:S,flag:4});}Q=M.attachEventListener("sampleStatusChange",this.id,function(){if(M.sampleStatus.total===1000){this.parent.set("useRichTooltip",true);this.parent.set("enabled",false);J.addClass(this.parent.textNode,"_disable-Button");}else{if(M.sampleStatus.total<=R+1000){T.displayError(mstrmojo.desc(14724,"All data from the source has been added in the data wrangler preview"));}}M.detachEventListener(Q);});}P.close();}function L(M){return M.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,");}function A(M){return parseInt(M.toString().replace(/,/g,""),10);}mstrmojo.Refine.RefineSampleButton=mstrmojo.declare(mstrmojo.ui.PopupButton,null,{scriptClass:"mstrmojo.Refine.RefineSampleButton",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-Refine-RefineSampleButton mstrmojo-Button mstrmojo-WebHoverButton {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-Refine-RefineSampleButton-text mstrmojo-Button-text" title="{@title}" style="{@labelCssText}">{@text}</div><div class="container"></div></div>',markupSlots:{textNode:function F(){return this.domNode.firstChild;},containerNode:function E(){return this.domNode.lastChild;}},text:mstrmojo.desc(14700,"Set Sample Size"),anchorSlot:"textNode",children:[],initChildren:function G(){this.children=this.getPopupWidgetRef();this._super();},getPopupWidget:function(){return this.popupWidget;},onPopupWidgetOpened:function(){var M=mstrApp.getRootController(),V=M.refineApp.rootController,R=V.model,W=R.sampleStatus,a=this.getPopupWidget(),T,U,X,N,b=K,Q=true,Z=0,S,P,O=[],Y={};if(!W){Z=1000;b=mstrmojo.desc(14703,"Full table size calculating...");}else{U=W.current;X=W.total;N=L(X);Z=Math.max(U,0);b=(X>=100000)?K.replace("###",">= 100,000"):K.replace("###",N);}a.inputbox.textbox.set("value",Z);a.inputbox.textbox.set("max",!X||X>11000?10000:parseInt(X,10)-1000);a.labelbox.label.set("text",b);a.labelbox.FTShelp.set("_content",(X>=100000)?D:B);a.labelbox.set("visible",Q);P=!X||(X>11000)?10000:parseInt(X,10)-1000;for(S=0;S<=P;S++){O[S]={n:S.toString()};}Y[Z]=true;T=[{scriptClass:"mstrmojo.Refine.SampleSlider",cssClass:"_sliderBar",alias:"slider_Bar",isHoriz:true,min:0,max:P,items:O,width:"195px",selectedIndices:Y,onchange:function(){var c=this.selectedItem.n;this.parent.parent.inputbox.textbox.set("value",c);}},{scriptClass:"mstrmojo.Box",cssClass:"box _sliderLabel",alias:"slider_lable",children:[{scriptClass:"mstrmojo.Label",alias:"label",text:"0",cssDisplay:"inline-block",cssText:"float:left"},{scriptClass:"mstrmojo.Label",alias:"label",text:L(P),cssDisplay:"inline-block",cssText:"float:right"}]}];a.slider.set("children",T);},getPopupWidgetRef:function(){return{alias:"popupWidget",scriptClass:"mstrmojo.ui.PopupWidget",visible:false,cssClass:"mstrmojo-Refine-RefineSampleButton-Popup",children:[{scriptClass:"mstrmojo.Box",cssClass:"box border",alias:"inputbox",children:[{scriptClass:"mstrmojo.Label",cssClass:"control",text:mstrmojo.desc(547,"Select"),cssDisplay:"inline-block"},{scriptClass:"mstrmojo.ValidationTextBox",cssClass:"control",alias:"textbox",cssDisplay:"inline-block",value:0,min:0,max:10000,valueChangeDelay:200,_validation:{invalid:true,errorCode:"",errorMsg:"",refNode:"",position:"BL",top:"0",left:"0",lasting:2000,closeOnClick:true,highlight:true},_isValid:true,onvalueChange:function(M){var O=M.value.toString().replace(/[^0-9,]/g,"");this.set("value",O);if(this._isValid){var N={};N[O]=true;if(this.parent.parent.slider.slider_Bar){this.parent.parent.slider.slider_Bar.set("selectedIndices",N);}}},onInvalid:function(){this.parent.parent.bottom_buttons.children[0].set("enabled",false);this._validation.refNode=this.domNode;this._validation.errorCode=null;this._validation.errorMsg=this.validationStatus.msg;this._validation.left=this.domNode.offsetWidth-this.domNode.clientWidth;this._validation.top="-"+(parseInt(this.domNode.offsetTop,10)+parseInt(this.domNode.offsetHeight,10)+3);this.showWarning(this._validation);this._isValid=false;},onValid:function(){this.parent.parent.bottom_buttons.children[0].set("enabled",true);this.hideWarning();this._isValid=true;},constraints:{trigger:mstrmojo.validation.TRIGGER.VALUESET,validator:function(N){var O=this.min,M=this.max,Q=C.isEmpty(N),P=A(N);if(Q){return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:mstrmojo.desc(14701,"Please input a number.")};}P=parseInt(P,10);if(P>=O&&P<=M){return{code:mstrmojo.validation.STATUSCODE.VALID};}M=L(M);return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:mstrmojo.desc(14702,"The maxinum is ###").replace("###",M)};},invalidCssClass:"invalid"},autoFormat:false,useRichTooltip:true},{scriptClass:"mstrmojo.Label",cssClass:"control",text:mstrmojo.desc(14704,"rows random data or"),cssDisplay:"inline-block"}]},{scriptClass:"mstrmojo.Box",cssClass:"box border _sliderContainer",alias:"slider",children:[]},{scriptClass:"mstrmojo.Box",cssClass:"box border _FTS",alias:"labelbox",children:[{scriptClass:"mstrmojo.Label",alias:"label",text:K,cssDisplay:"inline-block",cssText:"float:left"},{scriptClass:"mstrmojo.Label",alias:"FTShelp",cssClass:"control right pc mstrmojo-refine-help",cssDisplay:"inline-block",cssText:"float:right",useRichTooltip:true,_content:"",updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,left:((parseInt(this.parent.domNode.offsetWidth,10)-parseInt(this.domNode.offsetLeft,10)+3)).toString()+"px",content:this._content});}}]},{scriptClass:"mstrmojo.Box",cssClass:"box",alias:"bottom_buttons",cssDisplay:"inline-block",children:[H(mstrmojo.desc(1302,"Finish"),function(){I.call(this.parent.parent,true);},true,{alias:"finish",cssDisplay:"inline-block"}),H(mstrmojo.desc(2140,"Cancel"),function(){I.call(this.parent.parent,false);},false,{cssDisplay:"inline-block"})]}]};}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.Menu","mstrmojo.hash","mstrmojo.array");mstrmojo.ui.menus.MenuItemType=null;var U="separator";mstrmojo.ui.menus.MenuConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.MenuConfig",menus:null,menuCssClass:"",supportsScroll:false,maxHeight:0,hasMenuItems:function Q(){return !!this.menus.length;},getMenuItems:function E(V){return mstrmojo.array.filter(this.menus.slice().reverse(),function(Z,Y,X){var W=X[Y+1];return V||Z.cls!==U||(Y&&W&&W.cls!==U);}).reverse();},getMenuItem:function C(Y){var X=this.menus,V;if(X!==null){for(V=0;V<X.length;V++){var W=X[V];if(W.cls===Y){return W;}}}return null;},absorbMenuItems:function S(V){this.menus=this.menus.concat(V.menus);},addMenuItem:function I(c,Y,a,W,Z){var b,X,V;if(!c||typeof c==="string"){b=c;}else{b=c.n;X=c.ttp;}V={n:b,ttp:X,cls:Y,fn:a,ctxt:W};if(isNaN(Z)||Z>=this.menus.length){this.menus.push(V);}else{this.menus.splice(Z,0,V);}return V;},addCustomMenuItem:function T(a,X,Z,W,V){var Y=this.addMenuItem(a,X,Z,V);Y.getItemMarkup=W;return Y;},addDisabledMenuItem:function O(W,V){this.addNonInteractiveMenuItem(W,V,true);},addNonInteractiveMenuItem:function M(Z,W,V){var X=["non-int"];if(W){X.push(W);}if(V){X.push("disabled");}var Y=this.addMenuItem(Z,X.join(" "),mstrmojo.emptyFn);Y.dsbld=true;},addSeparator:function D(){this.addMenuItem("",U,function(){return false;});},addPopupMenuItem:function R(c,X,b,Y,W,Z){var a=["pop "];if(Y){a.push(Y);}var V=this.addMenuItem(c,a.join(" "),b,W,Z);V.pop=true;V.scope=X;return V;},addActionPopupMenuItem:function L(c,W,a,b,X,V,Z){var Y=this.addPopupMenuItem(c,W,b,(X||"")+" ax",V,Z);Y.actionFn=a;Y.ax=true;},addSubMenuItem:function K(Z,X,W,Y,V){this.addPopupMenuItem(Z,W,Y,X,V);},addEditorMenuItem:function P(Z,W,Y,V,X){this.addPopupMenuItem(Z,W,Y,"",V,X);},getToggleItemStates:function F(d,f,V,b,X,a){var Y,Z,W,c;if(typeof d==="string"){Y=Z=d;W=c="";}else{Y=d.on||"";Z=d.off||"";W=d.ttpOn||"";c=d.ttpOff||"";}var e=[{n:Y,ttp:W,cls:f+" on",fn:b,ctxt:a},{n:Z,ttp:c,cls:f,fn:V,ctxt:a}];if(!X){e.reverse();}return e;},addToggleMenuItem:function J(c,Y,a,X,W,b,V){var Z=this.getToggleItemStates(c,Y,a,X,b,V);return this.addDualStateItem(W,Z[0],Z[1]);},addDualStateItem:function G(W,V,X){return this.addMenuItem({n:V.n,ttp:V.ttp},V.cls,this.getDualStateHandler(W,V,X),V.ctxt);},getDualStateHandler:function H(W,V,X){return function(Z,a){var Y=[V,X];if(Z.cls===V.cls){Y.reverse();}Y[1].fn.call(mstrmojo.all[W],Z,a);Z.n=Y[0].n;Z.ttp=Y[0].ttp;Z.cls=Y[0].cls;};},addRadioMenuGroup:function B(X,c,Y,W,V,b,a){var Z=[];Y.forEach(function(g,d){if(g.separator){this.addSeparator();return ;}var j=g.text,h=(W||"")+" "+(g.cls||"")+(b?"":" radio")+(g.value===X?" on":""),f=function(){if(c.call(this.ctxt,g.value,X,g)===false){return false;}X=g.value;Z.forEach(function(k){k.cls=k.cls.replace(/ on$/,"")+(k.radioValue===X?" on":"");});return true;},e=a?this.addCustomMenuItem(j,h,f,a(g,d),V):this.addMenuItem(j,h,f,V);e.radioValue=g.value;Z.push(e);},this);},clear:function N(){this._super();this.menus=[];},newInstance:function A(V){return new mstrmojo.ui.menus.Menu(mstrmojo.hash.copy({popupConfig:this},V));}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.SimpleTree","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.warehouse.EnumObjectTypes");var Y=mstrmojo.array,a=mstrmojo.css,G=mstrmojo.dom,W=mstrmojo.hash,c="item-mn",K="item-n",A="userSel",T="mltSel",B=mstrmojo.warehouse.EnumObjectTypes,N=B.TABLE,D="li",L="ul",V="idx",H=":";function U(e){if(this.hasRendered){var f=this.domNode.getElementsByTagName(D);Y.forEach(f,e,this);}}function I(){var e=[];W.forEach(this.userSelections,function(f,g){e.push(this.getTreeItem(g));},this);return(e.length>1)?e:null;}mstrmojo.warehouse.ui.TablesTree=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._HasOwnAvatar,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.warehouse.ui.TablesTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree {@cssClass}" mstrAttach:click,dblclick>{@itemsHTML}</div>',userSelections:undefined,draggable:true,dropZone:true,getMenuHelper:mstrmojo.emptyFn,showTablesNum:true,init:function X(e){this._super(e);this.cssClass+=" mstrmojo-wh-TablesTree";this.userSelections=[];},getItemMarkup:function F(){return'<div class="{@cls}" title="{@ttp}"><span class='+K+' unselectable="on">{@n}</span><span class='+c+"></span></div>";},treeHooks:{select:function S(g,AA,f){var e=G.findAncestorByAttr(g,"idx",true,this.domNode),AB=e.value,AE=this.userSelections,t=this.rangeSelect,AD,z,l=Number.MAX_VALUE,k=Number.MIN_VALUE,m,x,h,o,p,w,u,q=this.shiftStartIndex,AC=parseInt(f,10),j=AE[AB]===true;if(AA.tp===N){if(j){delete AE[AB];}else{AE[AB]=true;}AD=W.keyarray(AE);z=AD.length;a.toggleClass(this.domNode,T,z>1);a.toggleClass(g,A,!j);if(t&&z&&q){o=q.split(H);h=AB.split(H);if(o&&h&&(o.length===h.length)&&o.length===(AC+1)){for(u=0;u<o.length;u++){if(o[u]!==h[u]){break;}}if(u===AC){m=parseInt(h[AC],10);x=parseInt(o[AC],10);if(!isNaN(m)&&!isNaN(x)){l=(m<x)?m:x;k=(m>x)?m:x;}for(var n=l;n<=k;n++){h[f]=n.toString();p=h.join(H);w=this.getTreeItem(p);if(w&&w.tp===N){AE[p]=true;delete this.selectedIndices[p];}}U.call(this,function(AG){var AF=AG.getAttribute(V);if(AE[AF]===true){a.toggleClass(AG,A,true);}});}}}}delete this.selectedIndices[AB];return true;},unselect:function M(f,g,h,e){this.itemRenderer.select(f,g,h,e,this);this.selectedIndices[g._renderIdx]=true;return true;}},tablesTreeHooks:{},showMenu:function Q(f){var g=this.getMenuHelper(),h=1;mstrApp.getRootController().setTableMenuContext(h);g.target=this;g.data=f.data;var e=g.getMenuConfig();e.hostId=this.id;e.hostElement=f.menuNode;e.isHostedWithin=false;e.hostProxyCssClass="item-mn-proxy";this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:e}));},onclick:function d(f){var k=f.target||G.eventTarget(f.hWin,f.e),j=G.findAncestorByAttr(k,"idx",true,this.domNode),l=j&&j.node.getAttribute("level"),h=G.shiftKey(f.hWin,f.e),g=j&&j.value,e=k.className===c&&g!==null&&!isNaN(l);if(!(G.ctrlKey(f.hWin,f.e)||G.metaKey(f.hWin,f.e)||h)){if(!e||!this.userSelections[g]){this.clearUserSelections(W.copy(this.userSelections));}else{this.userSelections[g]=false;}}if(h){this.rangeSelect=true;}else{this.shiftStartIndex=g;}this._super(f);if(e){this.showMenu({data:I.call(this)||this.getTreeItem(g),menuNode:k});}this.rangeSelect=false;},ondblclick:function J(n){var k=this,j=n.target||G.eventTarget(n.hWin,n.e),f=j.nodeName.toLowerCase(),q=G.findAncestorByAttr(j,"idx",true,this.domNode),e=q&&q.node.getAttribute("level"),m=q&&q.value,o=this.selectedIndices,l,p=o[m],g,h=k.tablesTreeHooks;k.onclick(n);if((f!==L)&&(f!==D)&&m!==null&&!isNaN(parseInt(e,10))){g=this.getTreeItem(m);if(h.isTable===undefined||h.isTable(g)){if(p){l=h.removeItem;}else{l=h.addItem;}if(l){l.call(k,q.node,g,e,m,o,this);}}}},createAvatar:function O(e){var g=document.createElement("div"),f=G.findAncestorByAttr(e,V,true,this.domNode);if(f&&f.node){g.appendChild(f.node.cloneNode(true));g.appendChild(document.createElement("div"));}g.className=this.domNode.className;return g;},toggleAvatarClass:function P(e,f){a.toggleClass(this.avatar,e,f);},getDragData:function E(f){var e=this.getNodeAttributes(f.src.node).index,h=this.getTreeItem(e),g=this.userSelections;if(h.tp===N){if(g[e]===true){return I.call(this)||[h];}this.clearUserSelections(W.copy(g));return[h];}return h;},isDragValid:function C(){return true;},ondragstart:function Z(e){this._super(e);var f=e.src.data;if(this.showTablesNum&&f&&f.length>1){this.avatar.getElementsByClassName(K)[0].innerHTML=f.length;}},getNodeAttributes:function b(f){var e=G.findAncestorByAttr(f,V,true,this.domNode),g=e&&e.node.getAttribute("level");return{index:e&&e.value,level:parseInt(g,10)};},clearUserSelections:function R(e){U.call(this,function(g){var f=g.getAttribute(V);if(e[f]===true){a.toggleClass(g,A,false);delete this.userSelections[f];}});a.toggleClass(this.domNode,T,false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo.ui._IsPulldown","mstrmojo.ui.PopupList","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var I=mstrmojo.css,G=mstrmojo.array,F=mstrmojo.dom;mstrmojo.ui.Pulldown=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo.ui._IsPulldown],{scriptClass:"mstrmojo.ui.Pulldown",onitemSelected:mstrmojo.emptyFn,allowHTML:true,init:function N(O){this._super(O);I.addWidgetCssClass(this.list,"ctrl-popup-list");},initChildren:function E(){this.children=this.getPopupListConfig();this._super();},getSelectedItem:function H(){var O=this.items;return O&&O[this.selectedIndex];},selectItemByField:function J(P,O){this.set("selectedIndex",G.find(this.items||[],P,O));},getPopupWidget:function D(){return this.list;},getPopupList:function K(){return this.list;},_set_items:function B(R,O){var Q=this.items;this.items=O;delete this.selectedIndex;if(Q!==O){var P=this.hasRendered;if(P){this.refresh();}return true;}return false;},onclick:function M(O){this._super(O);var Q=this,P=Q.getPopupWidget();Q.mw=Q.mw||function(R){if(!F.contains(P.domNode,F.eventTarget(self,R),true,document.body)){P.close();F.detachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Q.mw);}};F.attachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Q.mw);},_set_selectedIndex:function A(T,R){if((R!==0&&!R)||R<0){return false;}var P=this.selectedIndex=R,O=this.getPopupList(),Q=O.items,S=this.selectedNode;O.set("selectedIndex",P);if(S&&Q&&Q[P]){S.innerHTML=this.allowHTML?Q[P].n:mstrmojo.string.encodeHtmlString(Q[P].n);S.title=Q[P].title||"";}this.onitemSelected(Q[P],P);return true;},getPopupListConfig:function C(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,listHooks:{select:function O(R,S,Q){this.parent.set("selectedIndex",Q);this.close();}},getItemProps:function P(S,Q){var R=mstrmojo._IsList.getItemProps.call(this,S,Q);R.style=this.parent.itemCssText||"";return R;}};},children:[]});mstrmojo.ui.Pulldown.newPulldown=function L(P,T,O,S,R){S=S||{};S.items=P;var Q;if(R===true){Q=mstrmojo.hash.copy({scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:O||0},S);}else{Q=new mstrmojo.ui.Pulldown(S);if(O!==undefined){Q.set("selectedIndex",O);}}Q.postselectedIndexChange=function(U){var X=U.value,W=U.valueWas;if(X!==W){var V=this.items;T.call(this,V[X],V[W]);}};return Q;};}());(function(){mstrmojo.requiresCls("mstrmojo.ValidationTextBox","mstrmojo.hash");var A=mstrmojo.hash;mstrmojo.ui.editors.controls.ValidationTextBox=mstrmojo.declare(mstrmojo.ValidationTextBox,null,{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",errRevert:true,dtp:null,validationDelay:3000,orignText:null,trigger:mstrmojo.validation.TRIGGER.ONKEYUP,init:function(B){B=B||{};B.constraints=B.constraints||{};B.constraints.trigger=this.trigger;this._super(B);},prekeyup:function(B){if(B.e.keyCode===13){this.blur();return ;}this._super(B);},onfocus:function(){this.orignText=this.value;},onblur:function(){if(this.value!==this.orignText){this.validate();}},validate:function(){this._super();this.orignText=this.value;this.clearValDelayTimer();},preinput:mstrmojo.emptyFn,postinput:function(){var B=this.doValidation(this.value);if(B.code<=mstrmojo.validation.STATUSCODE.VALID){this.clearValidation();if(!this.errRevert){this.hideTooltip();}}},updateTooltipConfig:function(){this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+12,top:this.domNode.offsetHeight+5,refNode:this.domNode,content:mstrmojo.desc(13819,"Invalid input")};},onInvalid:function(){if(!this.errRevert){this.hideTooltip();this.showTooltip();}else{this.clearValidation();this.set("value",this.orignText);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Box","mstrmojo.Label","mstrmojo.expr","mstrmojo.ValidationTextBox","mstrmojo.Dialog","mstrmojo.cookies");mstrmojo.requiresDescs(17,18,221,9772,11773,14028,14136,14137,14138,14139,14140,14149,14522,14523,14524,14525,14526,14527);var CSS=mstrmojo.css,DOM=mstrmojo.dom,HASH=mstrmojo.hash;var _VAL=mstrmojo.validation,_SC=_VAL.STATUSCODE,_TR=_VAL.TRIGGER,_VALIDATOR=_VAL.VALIDATOR,DTP=mstrmojo.expr.DTP;var usherProps={intervalCtr:0,qrLoaded:false,maxPollingAttempts:80,timeDelay:3000};var DEFAULT_BADGE={mini_badge:"#ddd",mini_badge_icon:"https://uvs-v2.usher.com/assets/images/img_badge_placeholder.png",t_color:"#797979",appName:"",name:""};var userInfo={firstName:"",badgeId:""};var notificationTimer={duration:undefined,elem:undefined,callback:undefined,timerInterval:null,init:function(duration,elem,callback){this.duration=duration;this.elem=elem;this.callback=callback;},startTimer:function(){this.stopTimer();var start=Date.now(),diff,minutes,seconds;var me=this;function timer(){diff=me.duration-(((Date.now()-start)/1000)|0);minutes=(diff/60)|0;seconds=(diff%60)|0;minutes=minutes<10?"0"+minutes:minutes;seconds=seconds<10?"0"+seconds:seconds;me.elem.set("text",minutes+":"+seconds);if(diff<=0){start=Date.now()+1000;me.callback();me.stopTimer();}}timer();this.timerInterval=setInterval(timer,1000);},stopTimer:function(){if(this.timerInterval){clearInterval(this.timerInterval);}}};function addExtraParams(params){params.sn=this.serverName||mstrConfig.serverName;params.sp=this.serverPort||mstrConfig.serverPort;params.connectionId=this.connectionId||"";return params;}function disableQRCode(){this.set("expired",true);this.usherProps.qrLoaded=false;}function checkForUsherScan(){try{var widgetUsherProps=this.usherProps;var me=this;if(widgetUsherProps.qrLoaded){if(widgetUsherProps.intervalCtr>widgetUsherProps.maxPollingAttempts){disableQRCode.call(me);}else{clearTimeout(this.pullTimeout);this.pullTimeout=setTimeout(function(){widgetUsherProps.intervalCtr+=1;if(!me.stopPolling){usherPollForScan.call(me);}},widgetUsherProps.timeDelay);}}}catch(e){}}function serverRequest(params,callbacks,config){if(mstrApp.serverRequest){mstrApp.serverRequest(params,callbacks,config);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,callbacks,params);}}function usherPollForScan(){var me=this,widgetUsherProps=this.usherProps,params={taskId:"usherLoginWeb",pollOnly:"true",server:this.serverName||mstrConfig.serverName,port:this.serverPort||mstrConfig.serverPort,project:this.projectName||mstrConfig.projectName,connectionId:this.connectionId},callbacks={success:function(res){try{if(res.status=="invalid"){checkForUsherScan.call(me);}else{if(res.status=="success"){function doUsherLogin(res){me.onUsherLogin(res);widgetUsherProps.qrLoaded=false;}if(me.rememberMe===true){var callbacks={success:function(res){doUsherLogin(res);},failure:function(res){me.onUsherError(res);}};var params={taskId:"usherRememberMe"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(params,callbacks,{doNotHold:true});}else{doUsherLogin(res);}}}}catch(e){mstrmojo.alert("usherPollForScan:\n "+e.messsage);}},failure:function(res){disableQRCode.call(me);me.onUsherError(res);}};serverRequest(params,callbacks,{doNotHold:true});}function updateUserDetails(msg){this.userDetails.set("text",msg||"");}function toggleLoginNotification(show){var me=this;me.loginButton.set("visible",show);me.loginNotificationBox.set("visible",!show);}function submitLogin(){var widgetUsherProps=this.usherProps;var notificationTimer=this.notificationTimer;var me=this,callbacks={success:function(res){try{if(res.status==1){function callback(){toggleLoginNotification.call(me,true);}function submitForPolling(){if(me.pullTimeout){clearTimeout(me.pullTimeout);}me.usherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;checkForUsherScan.call(me);}var fiveMinutes=60*5;notificationTimer.init(fiveMinutes,me.loginNotificationBox.timer,callback);notificationTimer.startTimer();toggleLoginNotification.call(me,false);submitForPolling();}else{me.onUsherError(res);}}catch(e){mstrmojo.alert("Error:\n"+e.message);}},failure:function(res){me.onUsherError(res);}},params={taskId:"usherNotifyMe"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function forgetMe(){var me=this,callbacks={success:function(res){try{me.set("notificationMode",false);me.reloadQR();}catch(e){mstrmojo.alert("Error:\n"+e.messsage);}},failure:function(res){me.onUsherError(res);}},params={taskId:"usherRememberMe",rememberMe:false};if(me.userInfo.badgeId!==""){params.badgeId=me.userInfo.badgeId;}params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function getQRCode(ignoreNotificationMode){if(this.notificationMode==true&&!ignoreNotificationMode){return ;}var widgetUsherProps=this.usherProps;this.showQRLoading(true);var me=this,callbacks={success:function(res){try{if(res.img){me.set("notificationMode",false);me.updateQRCode(res.img);me.set("badge",res.badgeInfo&&res.badgeInfo[0]);widgetUsherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;this.stopPolling=false;checkForUsherScan.call(me);}else{var data=JSON.parse(res.data);var pn=data.pnEnabled||data.isPNEnabled;me.set("isPnEnabled",pn);if(data.code||data.proximityBasedLogin){me.set("notificationMode",false);if(data.proximityBasedLogin&&!ignoreNotificationMode){me.updateQRCodeProximity();me.set("proximityMode",true);}else{me.updateQRCode(data.code);me.set("proximityMode",false);}me.set("badge",res.badgeInfo&&res.badgeInfo[0]);widgetUsherProps.intervalCtr=0;widgetUsherProps.qrLoaded=true;this.stopPolling=false;mstrmojo.cookies.updateCookieSetting("usher_sso_device",res.device_id);checkForUsherScan.call(me);}else{me.set("proximityMode",false);me.set("notificationMode",true);me.refresh.set("visible",false);if(me.userInfoNode){me.userInfoNode.src="data:image/png;base64,"+data.photoData;}me.userInfo.firstName=data.firstName;me.userInfo.badgeId=data.badgeId;toggleLoginNotification.call(me,true);me.set("badge",res.badgeInfo&&res.badgeInfo[0]);}}}catch(e){mstrmojo.alert("getQRCode:\n "+e.messsage);}},failure:function(res){me.handleQRCodeError(res);disableQRCode.call(me);me.onUsherError(res);},complete:function(){me.showQRLoading(false);}},params={taskId:"usherQRWeb"};params.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";serverRequest(addExtraParams.call(this,params),callbacks,{doNotHold:true});}function registerHandler(){var me=this,regBtn=this.registerButton,dotsNode=this.parent.badgeNode.childNodes[1];if(regBtn.enabled){regBtn.set("enabled",false);CSS.addClass(dotsNode,["anim"]);var regMsg={},callbacks={success:function(res){var successful=res&&res.name==me.user.value;regMsg={msg:successful?mstrmojo.desc(14139,"You've successfully registered. Please check your email to continue.")+" "+mstrmojo.desc(14177,"Or perform an Usher badge recovery."):res.getResponseHeader("X-MSTR-TaskFailureMsg"),successful:successful};},failure:function(res){regMsg={msg:res.getResponseHeader("X-MSTR-TaskFailureMsg"),successful:false};},complete:function(){regBtn.set("enabled",true);CSS.removeClass(dotsNode,["anim"]);me.set("regMsg",regMsg);}},params={taskId:"usherRegUsr",server:this.serverName||mstrConfig.serverName,project:mstrConfig.projectName,port:this.serverPort||mstrConfig.serverPort,email:this.email.value,userid:this.user.value,password:this.pwd.value};serverRequest(params,callbacks);}}function getTextBoxJson(props){return mstrmojo.hash.copy(props,{scriptClass:"mstrmojo.ValidationTextBox",cssDisplay:"block",postCreate:function(){if(DOM.isIE9||DOM.isIE8||DOM.isIE7){this.emptyText=this.hint;}},onEnter:function(){registerHandler.call(this.parent);}});}mstrmojo.UsherLogin=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.UsherLogin",markupString:'<div id="{@id}" class="mstrmojo-UsherLogin-Container {@cssClass}" style="{@cssText}" ><div class="mstrmojo-UsherLogin-badge"><div class="icn"><img src="../images/1ptrans.gif"/></div><div class="dots"><div class="dot1"></div><div class="dot2"></div><div class="dot3"></div></div><div class="app"><img src="../style/mstr/images/badge-app.png"/></div></div><div class="mstrmojo-UsherLogin-badgeLabel"><div class="app-name"></div><div class="badge-name"></div></div><div class="mstrmojo-UsherLogin"><div class="mstrmojo-UsherLogin-QR mode"><img class="QR" src="../images/1ptrans.gif" alt="" /></div><div class="mstrmojo-UsherLogin-register mode"></div></div><div class="mstrmojo-UsherLogin-userInfo mode"><img class="userInfo" src="../images/1ptrans.gif" alt="" /></div><div class="mstrmojo-UsherLogin-notification"></div><div class="mstrmojo-UsherLogin-remember-setting"><div class = "mstrmojo-UsherLogin-remember"></div><div class = "mstrmojo-UsherLogin-forget"></div></div><div class="mstrmojo-UsherLogin-link"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},badgeNode:function(){return this.domNode.firstChild;},badgeIconNode:function(){return this.domNode.firstChild.firstChild.firstChild;},badgeLabelNode:function(){return this.domNode.childNodes[1];},usherNode:function(){return this.domNode.childNodes[2];},qrNode:function(){return this.domNode.childNodes[2].firstChild;},qrCodeNode:function(){return this.domNode.childNodes[2].firstChild.firstChild;},refreshNode:function(){return this.domNode.childNodes[2].firstChild.lastChild;},registerNode:function(){return this.domNode.childNodes[2].lastChild;},userNode:function(){return this.domNode.childNodes[3];},userInfoNode:function(){return this.domNode.childNodes[3].firstChild;},notificationNode:function(){return this.domNode.childNodes[4];},rememberSettingsNode:function(){return this.domNode.childNodes[5];},rememberNode:function(){return this.domNode.childNodes[5].firstChild;},forgetNode:function(){return this.domNode.childNodes[5].lastChild;},linksNode:function(){return this.domNode.lastChild;}},markupMethods:{onqrCodeChange:function(){if(this.qrCodeNode){this.qrCodeNode.src=this.qrCode;}},onbadgeChange:function(){var badge=this.badge||DEFAULT_BADGE,badgeFormat=badge.badgeFormat,fmt=badgeFormat&&(window.JSON?JSON.parse(badgeFormat):eval("("+badgeFormat+")"))||{isnull:true},labelNode=this.badgeLabelNode,iconNode=this.badgeIconNode,domNode=this.domNode;if(this.showBadgeBackgroundImage){domNode.style.backgroundColor=fmt.mini_badge;if(fmt.bg_4){domNode.style.backgroundImage="url("+fmt.bg_4+")";}}iconNode.src=fmt.mini_badge_icon||DEFAULT_BADGE.mini_badge_icon;if(!fmt.isnull&&!fmt.mini_badge_icon){CSS.addClass(iconNode.parentNode,"default");}labelNode.firstChild.innerHTML=badge.appName||DEFAULT_BADGE.appName;labelNode.lastChild.innerHTML=badge.name||DEFAULT_BADGE.name;labelNode.lastChild.title=badge.name||DEFAULT_BADGE.name;labelNode.style.color=fmt.t_color||DEFAULT_BADGE.t_color;this.linksNode.style.color=fmt.t_color||DEFAULT_BADGE.t_color;},onexpiredChange:function(){CSS.toggleClass(this.usherNode,"expired",this.expired);},onloadingChange:function(){CSS.toggleClass(this.usherNode,"loading",this.loading);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(this.visible&&this.canRequestQR()&&!this._lastVisible){getQRCode.call(this);}this.stopPolling=!this.visible;this._lastVisible=this.visible;},onnotificationModeChange:function(evt){CSS.toggleClass(this.containerNode,"notificationMode",this.notificationMode);},onproximityModeChange:function(evt){CSS.toggleClass(this.containerNode,"proximityMode",this.proximityMode);},onisPnEnabledChange:function(){this.hideRememberMe(!this.isPnEnabled);}},qrCode:"../images/1ptrans.gif",badge:DEFAULT_BADGE,expired:false,onUsherLogin:mstrmojo.emptyFn,onUsherError:mstrmojo.emptyFn,showBadgeBackgroundImage:true,usherProps:null,serverName:null,serverPort:null,rememberMe:false,userInfo:null,notificationTimer:null,loadQR:false,notificationMode:false,isPnEnabled:false,init:function init(props){if(this._super){this._super(props);}CSS.addWidgetCssClass(this,"");this.usherProps=this.usherProps?HASH.copy(this.usherProps,HASH.clone(usherProps)):HASH.clone(usherProps);this.userInfo=this.userInfo?HASH.copy(this.userInfo,HASH.clone(userInfo)):HASH.clone(userInfo);this.notificationTimer=this.notificationTimer?HASH.copy(this.notificationTimer,HASH.clone(notificationTimer)):HASH.clone(notificationTimer);},destroy:function destroy(ignoreDOM){this.stopPolling=true;clearTimeout(this.pullTimeout);this._super(ignoreDOM);},canRequestQR:function(){return this.usherProps&&(this.loadQR||(this.serverName||mstrConfig.serverName));},showUserInfo:function(res){this.refresh.set("visible",false);this.refresh.set("visible",false);},updateQRCode:function(res){this.set("qrCode","data:image/png;base64,"+res);this.set("expired",false);this.refresh.set("visible",false);},updateQRCodeProximity:function(){this.set("qrCode","../images/WaitUsherRadar.gif");this.set("expired",false);this.refresh.set("visible",false);},handleQRCodeError:function(){this.set("qrCode","../style/mstr/images/msgError.gif");this.set("expired",true);this.refresh.set("visible",true);},showQRLoading:function showQRLoading(show){this.set("loading",show);if(show){this.refresh.set("visible",false);}},postBuildRendering:function(){this._super();this.registerForm.set("tabIndex",-1);},toggleRegister:function(force){this.registerVisible=(force!==undefined)?force:!this.registerVisible;CSS.toggleClass(this.usherNode,"show-register",this.registerVisible);this.registerLink.set("text",this.registerLink.texts[this.registerVisible?1:0]);if(this.isPnEnabled===true){this.hideRememberMe(this.registerVisible&&this.isPnEnabled);}},hideRememberMe:function(force){CSS.toggleClass(this.rememberSettingsNode,"hide-rememeber",force);},reloadQR:function(){if(this.canRequestQR()){if(this.pullTimeout){clearTimeout(this.pullTimeout);}this.usherProps.intervalCtr=0;this.usherProps.qrLoaded=false;if(this.visible){getQRCode.call(this);}}},children:[{scriptClass:"mstrmojo.Label",slot:"qrNode",alias:"refresh",cssClass:"refresh",text:mstrmojo.desc(14028,"Refresh QR Code"),visible:false,onclick:function(){getQRCode.call(this.parent);}},{scriptClass:"mstrmojo.Box",slot:"registerNode",alias:"registerForm",regMsg:null,children:[getTextBoxJson({alias:"user",cssClass:"login-username",cssDisplay:"block",hint:mstrmojo.desc(17,"User name")}),getTextBoxJson({alias:"pwd",cssClass:"login-pwd",hint:mstrmojo.desc(18,"Password"),type:"password"}),getTextBoxJson({alias:"email",cssClass:"login-email",dtp:DTP.VARCHAR,constraints:{validator:_VALIDATOR.VALIDATE_EMAIL,trigger:mstrmojo.validation.TRIGGER.ONKEYUP},bindings:{visible:"this.parent.parent.usherRegistrationOption > 2"},hint:mstrmojo.desc(9772,"Email")}),getTextBoxJson({alias:"confirmEmail",cssClass:"login-email",bindings:{visible:function(){return this.parent.parent.usherRegistrationOption>2;}},hint:mstrmojo.desc(14149,"Confirm Email"),onpaste:function(evt){DOM.preventDefault(evt.hWin,evt.e||evt.hWin.event);}}),{scriptClass:"mstrmojo.Box",alias:"regMsg",cssClass:"register-msg",bindings:{regMsg:function(){return this.parent.regMsg;},visible:function(){return this.parent.regMsg;}},onregMsgChange:function(){if(this.domNode){this.domNode.style.color=this.regMsg&&this.regMsg.successful?"#42C31E":"#f00";}},children:[{scriptClass:"mstrmojo.Label",alias:"msg",cssClass:"register-msg-txt",bindings:{text:function(){return this.parent.regMsg.msg;}}},{scriptClass:"mstrmojo.Label",alias:"icn",cssClass:"register-msg-icn",onclick:function(){this.parent.parent.parent.toggleRegister();this.parent.parent.set("regMsg",null);}}]},{scriptClass:"mstrmojo.Button",alias:"registerButton",cssClass:"register mstrmojo-WebButton hot",cssDisplay:"inline-block",text:mstrmojo.desc(11773,"Register"),bindings:{enabled:function(){var username=this.parent.user.value,email=this.parent.email.value,confirmEmail=this.parent.confirmEmail.value;var registerStatus=username.length>0;if(registerStatus){if(this.parent.parent.usherRegistrationOption>1){var emailStatus=email.length>=3&&confirmEmail.length>=3&&email.toUpperCase()===confirmEmail.toUpperCase()&&this.parent.email.validationStatus.code===_SC.VALID;if(emailStatus){if(this.parent.parent.usherRegistrationOption==7){var restrictedDomains=this.parent.parent.usherRegistrationDomain.toUpperCase();var emailDomain=email.substr(email.indexOf("@")+1).toUpperCase();return restrictedDomains.indexOf(emailDomain)>=0;}}return emailStatus;}}return registerStatus;}},onclick:function(){registerHandler.call(this.parent);}},{scriptClass:"mstrmojo.Button",alias:"registerCancelButton",cssClass:"register-cancel",cssDisplay:"inline-block",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var p=this.parent;p.parent.toggleRegister();p.set("regMsg",null);p.user.set("value","");p.pwd.set("value","");p.email.set("value","");p.confirmEmail.set("value","");p.user.domNode.focus();}}]},{scriptClass:"mstrmojo.CheckBox",slot:"rememberNode",alias:"remember-me",label:mstrmojo.desc(14522,"Remember me"),onclick:function onclick(){this.parent.set("rememberMe",this.checked);}},{scriptClass:"mstrmojo.Label",slot:"forgetNode",allowHTML:true,text:mstrmojo.desc(14527,"Forget me/Switch user"),onclick:function(){forgetMe.call(this.parent);}},{scriptClass:"mstrmojo.Label",slot:"linksNode",allowHTML:true,text:'<a id="proximityProblems" href="#">Login via Phone</a>',onclick:function(evt){getQRCode.call(this.parent,true);return false;},bindings:{visible:"this.parent.proximityMode"},},{scriptClass:"mstrmojo.Label",slot:"linksNode",allowHTML:true,text:mstrmojo.desc(14136,"Use your ###Usher## app to scan the QR Code.").replace("###",'<a href="https://itunes.apple.com/us/app/usher-identity/id776079205" target="_blank">').replace("##","</a>"),},{scriptClass:"mstrmojo.Label",slot:"linksNode",alias:"registerLink",cssClass:"register-label",allowHTML:true,bindings:{visible:"this.parent.usherRegistrationOption > 0"},text:"",texts:[mstrmojo.desc(14137,"Don't have an Usher Badge? Click ###here## to register."),mstrmojo.desc(14140,"Display your ###QR Code##.")],postCreate:function(){this.set("text",this.texts[0]);},ontextChange:function(){this.text=this.text.replace("###",'<a href="#" onclick="mstrmojo.all.'+this.parent.id+'.toggleRegister(); return false;">').replace("##","</a>");}},{scriptClass:"mstrmojo.Label",alias:"userDetails",cssClass:"user-details",slot:"userNode"},{scriptClass:"mstrmojo.Button",alias:"loginButton",cssClass:"mstrmojo-WebButton login-button .mstrButton",cssDisplay:"inline-block",text:mstrmojo.desc(14525,"Login with Usher"),slot:"notificationNode",visible:false,onclick:function(){submitLogin.call(this.parent);},onvisibleChange:function(){var node=this.parent,msg=mstrmojo.desc(14523,"Hi ")+" "+node.userInfo.firstName;this.visible?msg+="!":msg+=mstrmojo.desc(14524,", please approve on your device.");updateUserDetails.call(node,msg);}},{scriptClass:"mstrmojo.Box",alias:"loginNotificationBox",cssClass:"login-notification",slot:"notificationNode",visible:false,children:[{scriptClass:"mstrmojo.Label",alias:"timer",cssClass:"notification-timer"},{scriptClass:"mstrmojo.Label",alias:"notificationFailure",cssClass:"notification-failure",text:mstrmojo.desc(14526,"Did not get notification"),onclick:function(){toggleLoginNotification.call(this.parent.parent,true);}}]},]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.PopupConfig","mstrmojo.ui.menus.MenuEditor");mstrmojo.ui.menus.EditorConfig=mstrmojo.declare(mstrmojo.ui.menus.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.EditorConfig",data:null,fnOk:null,fnCancel:null,okEnabled:true,cancelEnabled:true,okVisible:true,cancelVisible:true,init:function D(E){this._super(E);if(this.data&&!mstrmojo.all[this.data.id]){mstrmojo.hash.make(this.data,mstrmojo.Obj);}this.initBindings();},clear:function A(){this._super();this.data=null;this.fnOk=this.fnCancel=mstrmojo.emptyFn;},newInstance:function C(){return new mstrmojo.ui.menus.MenuEditor({popupConfig:this});},destroy:function B(){if(this.data){this.data.destroy();}this.destroyBindings();this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.List","mstrmojo.Pulldown","mstrmojo.ui.ButtonBar","mstrmojo.hash","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.Table","mstrmojo.DI.DIDatabaseImportOption","mstrmojo.DI.DISourceItem","mstrmojo.ui.CheckList","mstrmojo.array","mstrmojo.ui.SearchBox");mstrmojo.requiresDescs(10,489,1563,2461,4700,9095,9096,9097,9098,9100,9213,9214,10213,12459,12666,12726,12727,12758,12889,12890,13027,13416,13961,14101,14102,14103,14104,14208,14209,14210,14211,14212,14213);var H=mstrmojo.dom,X=mstrmojo.array,Z=mstrmojo.DI.DIConstants,J=mstrmojo.DI.DIDatabaseHelper,Q=Z.pageType,A="mstrmojo.DI.DISourceItem",T=0,K=1,C=mstrmojo.desc(12666,"Search..."),B=24,I=4,S=17,N,U;function P(){var a=[];if(mstrApp.diParams.ImportDatabase===1){a.push({n:mstrmojo.desc(14208,"BI"),did:0,v:"BI"});a.push({n:mstrmojo.desc(14209,"BigData"),did:1,v:"BigData"});}if(mstrApp.diParams.AccessDataFromCloudApp===1||mstrApp.diParams.AccessDataFromFiles===1){a.push({n:mstrmojo.desc(14210,"Cloud"),did:2,v:"Cloud"});}if(mstrApp.diParams.ImportDatabase===1){if(!mstrApp.isSingleTier){a.push({n:mstrmojo.desc(14211,"Cube"),did:3,v:"Cube"});}a.push({n:mstrmojo.desc(1563,"Database"),did:4,v:"Database"});}if(mstrApp.diParams.AccessDataFromFiles===1){a.push({n:mstrmojo.desc(489,"File"),did:5,v:"File"});}if(mstrApp.diParams.ImportDatabase===1){a.push({n:mstrmojo.desc(12758,"Hadoop"),did:6,v:"Hadoop"});if(!mstrApp.isSingleTier){a.push({n:mstrmojo.desc(13416,"OLAP"),did:9,v:"OLAP"});}a.push({n:mstrmojo.desc(14212,"NoSQL"),did:8,v:"NoSQL"});if(!mstrApp.isSingleTier){a.push({n:mstrmojo.desc(10,"Search"),did:11,v:"Search"});}}if(mstrApp.diParams.AccessDataFromCloudApp===1){a.push({n:mstrmojo.desc(14213,"Social"),did:12,v:"Social"});}return a;}function G(){var b=mstrApp.getRootController().model;if(mstrApp.showDDAOptions===false){return false;}if(mstrApp.diParams.ImportDatabase===0){return false;}if(b.currentDataset){return false;}var c=0,d,a=b.importSources;for(d in a){if(a.hasOwnProperty(d)){c++;}}return c<1;}var O={scriptClass:"mstrmojo.Container",markupString:"<div class='mstrmojo-di-search-tag' mstrAttach:click ><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},contentNode:function(){return this.domNode.children[0];},deleteNode:function(){return this.domNode.children[1];}},tag:"",children:[{scriptClass:"mstrmojo.Label",alias:"tagName",slot:"contentNode",cssClass:"mstrmojo-di-search-tag-name"},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-di-tag-delete-button",innerIconClass:"close-button"}],preBuildRendering:function(){if(this._super){this._super();}this.tagName.text=this.tag;},onclick:function(){var c=this.parent;c.removeChildren();var b=c.parent.filterTags;var a=X.find(b,"n",this.tag);if(a>-1){X.removeIndices(b,a,1);}c.parent.raiseEvent({name:"filterTagsChange"});}};function R(o,a,b){var g=0,e=0,q=4000;var l={},d=[],n;var j=0;var h=this;var u=h.isFilterDDA;var x=[];var t=[];var c=mstrApp.getRootController().getModel();var m=function m(z){var AA=mstrmojo.dom.findWidget(z.getTarget());if(AA===this.dbList){mstrmojo.css.addClass(this.domNode,"selected");}else{if(AA.alias==="closeList"){mstrmojo.css.removeClass(this.domNode,"selected");}else{if(this.parent.parent.mode===K){if(AA.sourceInfo.type===Z.sourceType.googleBigQuery){mstrApp.getRootController().showDialog(Z.dialogType.qbImportOptionDialog,{isODBC:true,srcInfo:AA.sourceInfo});}else{if(AA.dbTypes){t=J.getUniqueDBTypes(AA.dbTypes);X.forEach(t,function(AB){if(!u||c.canAddToDDACube(AA.sourceInfo.subtype,AB)){x.push(AB);}});mstrApp.dbTypes=x;}else{mstrApp.dbTypes=[AA.dbType];}mstrApp.supportDBObjects=mstrApp.getRootController().model.supportDBObjects;mstrApp.dbObjectsDisplayOptions=AA.dbObjectsDisplayOptions;if(AA.dbObjectsDisplayOptions===16){mstrApp.dbRolesVersionExcludeFilter=[17,18,21,22,23,24,25,37,45,46,47,48,63,66,74,89,92,101,103,105,123,134,157,172,202,232];}if(AA.dbIds){mstrApp.dbIds=AA.dbIds;}else{mstrApp.dbIds=AA.dbId?[].concat(AA.dbId):undefined;}if(AA.showImportOption){mstrApp.getRootController().showDialog(Z.dialogType.qbImportOptionDialog,(AA.dbType===q)?{isSAPHana:true}:{isODBC:true});}else{h.selectedSource=this;h.onNextButtonClick(z);}}}}}};var p=a?I:I+1;var k=0;var w=S;if(a&&N<940){p-=1;}U=p;X.forEach(o,function(z){if(!l[z.initial]){k++;l[z.initial]=true;}});l={};var f=k+o.length;if(f>p*S){w=f/p+1;}X.forEach(o,function(z){if(!l[z.initial]){d.push({scriptClass:"mstrmojo.Label",text:z.initial,cssClass:"initial",slot:g+","+e});g++;l[z.initial]=true;if(g>=w){g=0;e++;}}if(b){j=z.n.toLowerCase().indexOf(b.toLowerCase());if(j!==-1){n=z.n.substring(0,j)+'<span style="font-weight: bold;">'+z.n.substring(j,j+b.length)+"</span>"+z.n.substr(j+b.length);}}z.slot=g+","+e;if(z.isEnabled){z.enabled=z.isEnabled();}if(typeof z.title==="function"){z.title=z.title();}d.push(mstrmojo.hash.copy(z,{scriptClass:"mstrmojo.Label",allowHTML:true,text:n||z.n,onclick:m,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AA=H.position(this.domNode);if(this.title!==undefined){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",top:Math.max(AA.y,0),left:Math.max(AA.x+4,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.title});}}}));g++;if(g>=w){g=0;e++;}});return d;}mstrmojo.DI.DISourceList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DISourceList",cssClass:"mstrmojo-di-sources",selectedSource:null,filterTags:[],mode:T,hasDDAOnlySource:true,isFilterDDA:true,isSAPHana:false,markupString:'<div id="{@id}" class="mstrmojo-di-sources {@cssClass}" mstrAttach:mousedown ><div class="mstrmojo-di-source-datasets"></div><div class = "mstrmojo-di-source-content"></div><div class = "mstrmojo-di-search-tags"></div></div>',markupSlots:{datasetsNode:function(){return this.domNode.children[0];},allSourceNode:function(){return this.domNode.children[1];},searchTagsNode:function(){return this.domNode.children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onmodeChange:function(){var a=mstrApp.getRootController().model;if(this.mode===K){if(!this.sourceList.children){this.populateSources();}this.updateViewByMode();if(a.isDirectDataAccess!==this.sourceList.ddaList){this.update();}}else{if(!this.sourceTable.children){this.populateSources();}this.updateViewByMode();if(a.isDirectDataAccess!==this.sourceTable.ddaList){this.update();}}this.persistViewMode();},onhasDDAOnlySourceChange:function(){if(this.hasRendered){this.update();}},updateViewByMode:function W(){var a=mstrApp.getRootController().model;if(this.mode===K){this.sourceList.set("visible",true);this.sourceTable.set("visible",false);this.searchTagsNode.style.display="block";this.sourceView.set("selectedIndex",1);}else{this.sourceList.set("visible",false);this.sourceTable.set("visible",true);this.searchTagsNode.style.display="none";this.sourceView.set("selectedIndex",0);}if(a.isDirectDataAccess){this.allddatabs.children[0].set("selectedIndex",1);}else{this.allddatabs.children[0].set("selectedIndex",0);}},onfilterTagsChange:function(){var e=this,c={},b;var a=mstrApp.getRootController().model;var d=a.sourceList;this.searchTagList.removeChildren();X.forEach(this.filterTags,function(f){O.tag=f.n;e.searchTagList.addChildren([mstrmojo.insert(O)]);c[f.v]=true;});if(this.filterTags.length!==0){d=mstrApp.getRootController().filterSourcesbyTag(a.sourceList,c,I);}if(a.isDirectDataAccess){d=mstrApp.getRootController().filterSourcesByDDA(d);}if(!mstrApp.isSingleTier){d=mstrApp.getRootController().filterSourcesByPrivileges(d);}else{d=mstrApp.getRootController().filterSourcesForOneTier(d);}if(this.searchBox.inputNode.value!==""&&this.searchBox.inputNode.value!==C){d=mstrApp.getRootController().filterSourcesByText(d,this.searchBox.inputNode.value,I);}b=R.call(e,d,this.filterTags.length!==0);mstrmojo.css.toggleClass(this.sourceList.domNode,"narrow",this.filterTags.length>0);this.sourceList._set_children("children",b);},persistViewMode:function F(){mstrApp.getRootController().rootView.setHomepageViewMode(this.mode);},children:[{scriptClass:"mstrmojo.Box",slot:"datasetsNode",cssClass:"mstrmojo-di-source-datasets-box cf",bindings:{visible:function(){var a=X.filter(mstrApp.getRootController().model.datasets||[],function(b){return !b.hcs;});return a&&a.length>1&&!mstrApp.diParams.isEdit&&!mstrApp.getRootController().model.hasEMMAReportInstance();}},children:[{scriptClass:"mstrmojo.Label",cssClass:"dataset-box-label",text:mstrmojo.desc(13027,"Add to:")},{scriptClass:"mstrmojo.ui.Pulldown",bindings:{items:function(){var a=[];X.forEach(mstrApp.getRootController().model.datasets||[],function(b){if(!b.hcs){a.push({id:b.did,n:b.name});}});return a;}},onitemSelected:function M(c){var b=mstrApp.getRootController().getModel(),a=X.find(b.datasets,"did",c.id);if(a>-1){b.selectDataset(b.datasets[a]);this.parent.parent.set("hasDDAOnlySource",b.datasets[a].did===-1);this.parent.parent.allddatabs.set("visible",G());}},preBuildRendering:function D(){if(this._super){this._super();}if(this.items.length>0){this.selectedIndex=0;}}}]},{alias:"sourceView",slot:"allSourceNode",scriptClass:"mstrmojo.ui.ButtonBar",cssClass:"mstrmojo-di-source-view",renderOnScroll:false,selectedIndex:0,postselectionChange:function(a){var b=a.added&&this.items[a.added[0]].v;this.parent.set("mode",b);},items:[{v:T,css:"grid"},{v:K,css:"list"}]},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-source-direct-access-container",slot:"allSourceNode",alias:"allddatabs",bindings:{visible:function(){return G();}},children:[{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:false,selectedIndex:0,postselectionChange:function(b){var a=mstrApp.getRootController(),c=a.model,e=b.added&&this.items[b.added[0]].v,d=!!e;if(c.isDirectDataAccess!==d){a.getDDAController().setDirectDataAccess(d);c.origIsDirectDataAccess=d;this.parent.parent.update();}},items:[{n:mstrmojo.desc(2461,"All"),v:0},{n:mstrmojo.desc(12726,"Connect Live"),v:1}]}]},{scriptClass:"mstrmojo.Button",slot:"allSourceNode",alias:"dropDownBtn",cssClass:"mstrmojo-di-source-search-button",onclick:function(){this.parent.showEditorConfig();},bindings:{visible:function(){return this.parent.mode===K;}}},{scriptClass:"mstrmojo.Label",slot:"allSourceNode",text:mstrmojo.desc(12727,"Advanced Search"),cssClass:"mstrmojo-di-source-search-label",bindings:{visible:function(){return this.parent.mode===K;}},onclick:function(){this.parent.showEditorConfig();}},{scriptClass:"mstrmojo.ui.SearchBox",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><input class="mstrmojo-ui-sb-input" type="text" placeholder="{@emptyText}" mstrAttach:keyup,blur/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',searchDelay:0,cssClass:"mstrmojo-di-source-search",slot:"allSourceNode",alias:"searchBox",emptyText:C,bindings:{visible:function(){return this.parent.mode===K;}},searchTriggered:function(a){this.parent.onSearch(a);}},{scriptClass:"mstrmojo.Box",alias:"sourceTable",cssClass:"mstrmojo-di-sourceGrid",slot:"allSourceNode",ddaList:false},{scriptClass:"mstrmojo.Table",alias:"sourceList",cssClass:"mstrmojo-di-sourceList",slot:"allSourceNode",visible:false,rows:B,cols:5,ddaList:false},{scriptClass:"mstrmojo.Label",slot:"searchTagsNode",text:mstrmojo.desc(12889,"Returned results are related to:"),bindings:{visible:function(){return this.parent.filterTags.length>0;}}},{scriptClass:"mstrmojo.VBox",slot:"searchTagsNode",alias:"searchTagList"}],showEditorConfig:function(){var b=this;var a=new mstrmojo.ui.menus.EditorConfig({hostId:this.id,hostElement:this.dropDownBtn.domNode,isHostedWithin:false,hostProxyCssClass:"item-mn-proxy",cssClass:"searchTagMenu",contents:new mstrmojo.ui.CheckList({multiSelect:true,orientation:"v",itemIdField:"did",alias:"list",items:P.call()}),data:{}});a.fnOk=function(){var d=a.contents.getSelectedItems();b.set("filterTags",d);};var c=a.newInstance();if(this.filterTags&&this.filterTags.length>0){c.list.selectItems(this.filterTags);}this.openPopup(c);},preBuildRendering:function(){if(this._super){this._super();}var a=mstrApp.getRootController().getModel();this.populateSources();a.attachEventListener("isDirectDataAccessChange",this.id,this.update);a.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},adjustSize:function(a){var b=Math.floor(parseInt(a.size.w,10)),d,c;if(isNaN(b)||b<0||!this.domNode){return ;}d=Math.floor(b/160);if(d>0){c=Math.floor((b-d*160)/2);if(c<20){d--;c=Math.floor((b-d*160)/2);}}if(c>0){this.sourceTable.domNode.style.marginLeft=c+"px";}if(this.sourceList&&this.sourceList.domNode){this.sourceList.domNode.children[0].style.width=(b-28)+"px";if(b-630<200){this.dropDownBtn.domNode.style.marginRight=(b-630)+"px";}if(this.filterTags.length>0){if(b<940&&U!==3){this.onfilterTagsChange();}else{if(b>=940&&U===3){this.onfilterTagsChange();}}}}N=b;},postBuildRendering:function(){if(this._super){this._super();}this.updateViewByMode();},populateSources:function Y(){var a=mstrApp.getRootController(),d=mstrApp.getRootController().getModel(),c,b=this.hasNonSAPHana,e;e=X.filter(d.sourceItems,function(h){return h.selected!==false;});if(this.mode===T){if(this.parent.parent&&this.parent.parent.items){c=this.parent.parent.items;}else{if(this.isSAPHana){c=[d.sourceItems[2]];c[0].isSAPHanaDDA=true;}else{c=this.isFilterDDA&&d.isDirectDataAccess?mstrApp.getRootController().filterSourcesByDDA(e):e;X.forEach(c,function(h){h.hasNonSAPHana=b;h.isSAPHanaDDA=false;});}}c=a.filterSourcesByDDAOnly(c,this.hasDDAOnlySource);if(mstrApp.isSingleTier){c=mstrApp.getRootController().filterSourcesForOneTier(c);}else{c=mstrApp.getRootController().filterSourcesByPrivileges(c);}var g=[],f=[];X.forEach(c,function(h){if(h.bindings.enabled()){g.push(h);}else{f.push(h);}});c=g.concat(f);if(X.find(c,"alias","suggest")<0){c=c||[];c.push({scriptClass:A,icon:"ds_suggest",n:mstrmojo.desc(12890,"Suggest a Data Source"),desc:mstrmojo.desc(12459,"Is your data source not available? Tell us which source it is and why it is important to you."),pageType:Q.suggestNewSource,alias:"suggest",sourceInfo:0});}this.sourceTable.addChildren(c);}else{if(this.mode===K){if(d.sourceList.length===0&&mstrApp.diParams.ImportDatabase===1){d.attachEventListener("dbTypeFetched",this.id,this.populateListView);mstrApp.showProgress();}else{if(mstrApp.diParams.ImportDatabase===0){d.sourceList=d.staticSourceList;}this.populateListView();}}}},populateListView:function E(){var a=mstrApp.getRootController(),c=mstrApp.getRootController().getModel(),e={},b=c.isDirectDataAccess?mstrApp.getRootController().filterSourcesByDDA(c.sourceList):c.sourceList;b=a.filterSourcesByDDAOnly(b,this.hasDDAOnlySource);X.forEach(this.filterTags,function(f){e[f.v]=true;});if(this.filterTags.length!==0){b=mstrApp.getRootController().filterSourcesbyTag(b,e,I);}if(this.searchBox.inputNode&&this.searchBox.inputNode.value!==""&&this.searchBox.inputNode.value!==C){b=mstrApp.getRootController().filterSourcesByText(b,this.searchBox.inputNode.value,I);}if(mstrApp.isSingleTier){b=mstrApp.getRootController().filterSourcesForOneTier(b);}else{b=mstrApp.getRootController().filterSourcesByPrivileges(b);}var d=R.call(this,b,this.filterTags.length!==0);this.sourceList.addChildren(d);mstrApp.hideProgress();},update:function L(){var a=mstrApp.getRootController().model;if(this.mode===T){this.sourceTable.removeChildren();this.sourceTable.ddaList=a.isDirectDataAccess;}if(this.mode===K){this.sourceList.removeChildren();this.sourceList.ddaList=a.isDirectDataAccess;}this.populateSources();},onSearch:function(e){var a=mstrApp.getRootController().model;var d=mstrApp.getRootController().filterSourcesByText(a.sourceList,e,I);if(this.filterTags.length!==0){var c={};X.forEach(this.filterTags,function(f){c[f.v]=true;});d=mstrApp.getRootController().filterSourcesbyTag(d,c,I);}if(a.isDirectDataAccess){d=mstrApp.getRootController().filterSourcesByDDA(d);}if(!mstrApp.isSingleTier){d=mstrApp.getRootController().filterSourcesByPrivileges(d);}else{d=mstrApp.getRootController().filterSourcesForOneTier(d);}var b=R.call(this,d,this.filterTags.length!==0,e);this.sourceList._set_children("children",b);},onmousedown:function(a){if(a&&a.e&&a.e.button===1){a.preventDefault();a.cancel();}},onNextButtonClick:function(b){var a=mstrApp.getRootController(),f=this.selectedSource,g;if(f.enabled){if(mstrApp.isSingleTier&&f.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var c=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),e='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);mstrApp.getRootController().wrapUpDataImport();window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";c=c.replace("#",e)+".";a.displayError(c,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}g=mstrApp.getRootController().navigationController.getPageSlot();var d={operationMode:Z.operationMode.create};if(f.mode){d.mode=f.mode;}g.setConfig({properties:d});f.sourceInfo.evt=b;a.showPage(f.pageType,f.sourceInfo,g);}},onHelpButtonClick:function V(){return"About_importing_data.htm";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.HBox","mstrmojo.EnumAuthenticationModes","mstrmojo.UsherLogin","mstrmojo.string","mstrmojo.cookies");mstrmojo.requiresDescs(17,18,221,11804,11863);var E=mstrmojo.EnumAuthenticationModes,D={};D[E.LDAP]=mstrmojo.desc(1947,"LDAP Authentication");D[E.DATABASE]=mstrmojo.desc(1948,"Database Authentication");var K={LIVE_OR_HL:0,PERSISTED:1};function B(){return(JSON.parse(decodeURIComponent(mstrmojo.cookies.getCookieSetting("lastMsgID")||"{}")))[mstrConfig.lastMsgKey];}function C(){var P=this,Q=P.stdLoginInfo,N=Q.user.value,M=Q.tsvCode.value,R=Q.pwd.value,S={taskId:"login",server:mstrConfig.serverName,project:mstrmojo.string.decodeHtmlString(mstrConfig.projectName),port:mstrConfig.serverPort,authMode:mstrConfig.authMode,setAsActiveSession:true};var O=B();if(O){S.msgID=O;}if((this.authMode&(E.STANDARD|E.LDAP|E.DATABASE))>0){S.userid=N;S.password=R;S.tsvCode=M;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(V){if(V&&V.sessionState){mstrApp.updateSessionState(V.sessionState);if(mstrApp.sessionManager){mstrApp.sessionManager.restart();}var X=V;var U=V.resCode;if(U==K.LIVE_OR_HL&&(mstrApp.isVI||mstrApp.scriptClass==="mstrmojo.OIVMApp"||mstrApp.analysisID)){mstrmojo.xhr.request("post",mstrConfig.taskURL,{success:function(){var Y=P.config.callback,Z=Y.success;if(Z){Z(X);}},failure:function(){mstrmojo.form.send({evt:3010,src:mstrApp.name+".3010"},null,"POST");}},{taskId:"docXMLResults",sessionState:V.sessionState,msgID:V.msgID,resultFlags:33554432});}else{var T=P.config.callback,W=T.success;if(W){W(X);}}}P.destroy();},failure:function(T){mstrmojo.alert(T.getResponseHeader("X-MSTR-TaskFailureMsg"),null,null,P.zIndex);}},S);}function L(){if(mstrApp.sessionManager){mstrApp.sessionManager.gotoLogoutPage();}}mstrmojo.LoginEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.LoginEditor",cssClass:"mstrmojo-LoginEditor",title:mstrmojo.desc(11804,"Log in to"),btnAlignment:"right",help:"login_box",config:{callback:{},taskParams:{}},authMode:E.STANDARD,usherEnabled:false,init:function J(M){this._super(M);this.title+=" "+mstrApp.projectName;this.set("authMode",parseInt(mstrConfig.authMode,10));if(this.isUsherLogin()){mstrmojo.css.addWidgetCssClass(this,"usher");}},isUsherLogin:function(){return this.authMode===E.USHER;},onvisibleChange:function I(){if(this.visible&&(mstrmojo.dom.isFF||mstrmojo.dom.isWK)){var M=this.stdLoginInfo.user;window.setTimeout(function(){M.focus();},50);}},onClose:function F(){L();},destroy:function H(){mstrmojo.dom.detachEvent(document.body,"mousedown",this.stopPropagation,true);this._super();},postBuildRendering:function A(){if(this.authMode===mstrmojo.EnumAuthenticationModes.NTCREDENTIAL){C.call(this);return ;}else{var M=this._super();this.stopPropagation=function(N){N.stopPropagation();};mstrmojo.dom.attachEvent(document.body,"mousedown",this.stopPropagation,true);return M;}},preBuildRendering:function G(){if(this.isUsherLogin()){var N=this,M=mstrmojo.insert({scriptClass:"mstrmojo.UsherLogin",alias:"usherLogin",onUsherLogin:function(){mstrConfig.authMode=E.USHER;C.call(N);}});this.addChildren([M],1);}return this._super();},children:[{scriptClass:"mstrmojo.Label",cssText:"margin-bottom: 20px; line-height: 1.5em;",text:mstrmojo.desc(11863,"Your user session has timed out due to inactivity, and you have been automatically logged out. Please log in again.")},{scriptClass:"mstrmojo.Box",alias:"stdLoginInfo",cssClass:"std-login-container",bindings:{visible:function(){return this.parent.authMode!==E.USHER;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"user",cssClass:"login-username",cssDisplay:"block",hint:mstrmojo.desc(17,"User name"),postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(17,"User name");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.TextBox",alias:"pwd",cssClass:"login-pwd",cssDisplay:"block",hint:mstrmojo.desc(18,"Password"),type:"password",postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(18,"Password");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.TextBox",alias:"tsvCode",cssClass:"login-tsvCode",cssDisplay:"block",hint:mstrmojo.desc(13825,"Usher code"),bindings:{visible:function(){return mstrConfig.features["is-two-step-verification-required"];}},postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(13825,"Usher code");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-LoginEditor-authMode",bindings:{visible:function(){return this.parent.parent.authMode===E.LDAP||this.parent.parent.authMode===E.DATABASE;},text:function(){return D[this.parent.parent.authMode]||"";}}}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",alias:"btns",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:mstrmojo.desc(26,"Login"),bindings:{enabled:"this.parent.parent.stdLoginInfo.user.value.length > 0",visible:function(){return this.parent.parent.authMode!==E.USHER;}},onclick:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){L();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Stepper","mstrmojo._HasLayout","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.expr","mstrmojo.css");var C=mstrmojo.expr.DTP,B=mstrmojo.css,A="mstrmojo-Stepper-ErrValidation";mstrmojo.ui.editors.controls.Stepper=mstrmojo.declare(mstrmojo.Stepper,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.Stepper",markupString:'<div id="{@id}" class="mstrmojo-Stepper {@orientation} {@cssClass}" mstrAttach:click,mousedown,mouseup,mousemove,selectstart><div class="title">{@title}</div><div class="next">+</div><div class="text"></div><div class="prev">-</div></div>',layoutConfig:{w:{textNode:"100%"},xt:true},textInput:null,init:function E(F){var G=F.provider;this.children=[{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",alias:"textInput",slot:"textNode",dtp:G.dtp||C.INTEGER,constraints:{validator:G.validator,max:G.max,min:G.min},onValid:function(){var H=this.parent;B.removeClass(H.domNode,A);G.setVal(parseInt(this.value,10)||0);H.updateDisplayText();}}];this._super(F);this.addDisposable(G);B.addWidgetCssClass(this,"mstrmojo-ui-ctrl-Stepper");},postBuildRendering:function(){this.updateDisplayText();this._super();},updateDisplayText:function D(){this.textInput.set("value",this.provider.getVal());}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(134,9305,3124,12359,686,13059,13060,13574);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var E=[],I,K,H,J,F,G,N;K=this.parent;H=K.columns;J=H.selectedIndex;if(J===undefined){return ;}F=(H.items[J]).name;G=K.transformationList;N=G.subType%10;switch(N){case 0:I=JSON.parse(JSON.stringify(this.operations.CharInCell));break;case 1:if(this.optionsBox.type.selectedIndex===0){I=JSON.parse(JSON.stringify(this.operations.CellContains));}else{if(this.optionsBox.type.selectedIndex===1){I=JSON.parse(JSON.stringify(this.operations.CellBeginsWith));}else{I=JSON.parse(JSON.stringify(this.operations.CellEndsWith));}}break;}var M=this.optionsBox.find.from.value;var L=this.optionsBox.find.to.value;if(!M||!L){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[column name]",F);I.description=I.description.replace("####","'"+B(D(M))+"'");I.description=I.description.replace("@@@@","'"+B(D(L))+"'");I.columnName=F;I.expression=I.expression.replace("[from]","'"+D(M)+"'");I.expression=I.expression.replace("[to]","'"+D(L)+"'");I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.find.from.set("value","");this.optionsBox.find.to.set("value","");}mstrmojo.Refine.RefineControlFindAndReplace=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlFindAndReplace",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.FindAndReplace);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12359,"Where Cell"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(686,"Contains")},{n:mstrmojo.desc(13059,"Begins With")},{n:mstrmojo.desc(13060,"Ends with")}],selectedIndex:0,bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{scriptClass:"mstrmojo.HBox",alias:"find",children:[{scriptClass:"mstrmojo.TextBox",alias:"from",emptyText:mstrmojo.desc(9305,"From")},{scriptClass:"mstrmojo.TextBox",alias:"to",emptyText:mstrmojo.desc(3124,"To")}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.ui.Pulldown","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(118,221,5186,6389,12877,12878,12879,12880,12881,13783,13784,13785,13851,12706,14678,14679,14680,14689,14716);var C="rs-item";var G=mstrmojo.array,B=mstrmojo.hash,E=mstrmojo.dom,F=mstrmojo.css,J=mstrmojo.Widget,I=mstrmojo.DI.DIConstants;var H=function(){var K=this.getPopupWidget(),L;L=E.position(this.getPopupHostNode(),true);K.popupConfig.position=L;};function D(P,N,O,T){var d=I.relationshipEditType;var a=I.ERType;var M=[],c=[],S=[],R=[],X=[];var V=[];var Y,U,b,W,Q;var L=N&&N.length,Z=O&&O.length;var K=function(e,f){if(e.tp===f.tp){return 0;}if(e.tp===d.remove){return -1;}if(e.tp===d.create){return f.tp===d.remove?1:-1;}if(e.tp===d.changeERType){return 1;}};if(Z<L){return ;}for(Y=0;Y<Z;Y++){U=Y<L?N[Y]:null;b=O[Y];if(b.deleted){if(U){V.push({tp:d.remove,paid:U.parent.id,atid:U.child.id,ert:a.reserved,rstp:I.RSType.reserved});}}else{if(U){if(U.parent.id===b.parent.id&&U.child.id===b.child.id){if(U.ert!==b.ert){V.push({tp:d.changeERType,paid:b.parent.id,atid:b.child.id,ert:b.ert,rstp:b.type});}else{if(U.type!==b.type){V.push({tp:d.changeERType,paid:b.parent.id,atid:b.child.id,ert:b.ert,rstp:b.type});}}}else{V.push({tp:d.remove,paid:U.parent.id,atid:U.child.id,ert:a.reserved,rstp:I.RSType.reserved});V.push({tp:d.create,paid:b.parent.id,atid:b.child.id,ert:b.ert,rstp:b.type});}}else{if(b.parent&&b.parent.id&&b.child&&b.child.id){V.push({tp:d.create,paid:b.parent.id,atid:b.child.id,ert:b.ert,rstp:b.type});}}}}V.sort(K);W=false;G.forEach(V,function(e){if(e.paid===e.atid){W=true;Q=mstrmojo.desc(13851,"Cannot define the relationship between the same attributes.");}M.push(e.tp);c.push(e.paid);S.push(e.atid);R.push(e.ert);X.push(e.rstp);});if(W){if(T.failure){T.failure({message:Q});}if(T&&T.complete){T.complete();}return ;}if(V.length>0){mstrApp.getRootController().editRelationship([P],{tp:M.join(),paid:c.join(),atid:S.join(),ert:R.join(),rstp:X.join()},T);}else{if(T&&T.success){T.success();}if(T&&T.complete){T.complete();}}}function A(K,M){var L=true;G.forEach(K,function(P){var N,O,Q;if(P){N=G.find(M,"id",P.parent.id);if(N>=0){O=M[N];}N=G.find(M,"id",P.child.id);if(N>=0){Q=M[N];}if(O&&Q){if(O.id===Q.id){L=false;}else{if(O.ipa&&Q.ipa){L=false;}}}if(!L){return false;}}});return L;}mstrmojo.DI.DIRelationshipItem=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIRelationshipItem",markupString:'<div id="{@id}" class="mstrmojo-Box mstrmojo-di-relationship-item cf {@cssClass}" style="{@cssText}"><div class="rsitem-icon status{@status}" tooltip="{@tooltip}"></div><div class="rsitem-toggle {@toggle}"></div><div class="rsitem-pulldown parent"></div><div class="rsitem-pulldown child"></div><div class="rsitem-pulldown type"></div><div class="rsitem-button"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},toggleButtonNode:function(){return this.domNode.children[1];},parentPulldownNode:function(){return this.domNode.children[2];},childPulldownNode:function(){return this.domNode.children[3];},typePulldownNode:function(){return this.domNode.children[4];},buttonNode:function(){return this.domNode.children[5];}},markupMethods:{onvisibleChange:J.visibleMarkupMethod,onheightChange:J.heightMarkupMethod,onwidthChange:J.widthMarkupMethod,onstatusChange:function(){var K=this.domNode.firstChild;K.className="rsitem-icon status"+this.status;},ontooltipChange:function(){var K=this.domNode.firstChild;K.setAttribute("tooltip",this.tooltip);}},onstatusChange:function(){var K=this.data;K.status=this.status;},ontooltipChange:function(){var K=this.data;K.tooltip=this.tooltip;},ontypeChange:function(L){var M=this.toggleButtonNode,K=L.value===I.RSType.defined;if(this.hasRendered&&M){F.toggleClass(M,"toggle",K);if(E.isIE9||E.isIE8){M.firstChild.firstChild.style.display=K?"none":"block";}}},setRSType:function(K){var L=this.data;if(K!==L.type){L.type=K;this.set("type",K);this.parent.raiseEvent({name:"change",src:this});}},postBuildRendering:function(){var K=this.toggle,L=this.toggleButtonNode;if(this._super){this._super();}if(K==="toggle"&&(E.isIE9||E.isIE8)){L.firstChild.firstChild.style.display="none";}},children:[{slot:"toggleButtonNode",scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:click><div class="front"></div><div class="back"></div></div>',onclick:function(){var M=this.parent.data,L=M&&M.type,K=false;switch(L){case I.RSType.auto:M.type=I.RSType.defined;K=true;break;case I.RSType.defined:M.type=I.RSType.auto;K=true;break;}if(K){this.parent.set("type",M.type);this.parent.raiseEvent({name:"change",src:this});}}},{slot:"parentPulldownNode",scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,hostedCSSClass:"mstrmojo-di-relationship-item-hosted",bindings:{items:"this.parent.maps"},preBuildRendering:function(){if(this._super){this._super();}if(this.parent.data&&this.parent.data.parent){this.selectItemByField("id",this.parent.data.parent.id);}},postselectedIndexChange:function(K){var O=K.value,M=K.valueWas,L=this.items,N=this.parent.data;if(O!==M){if(L[O]){this.set("title",L[O].n);}N.parent.id=L[O].id;if(this.parent.hasRendered){N.type=I.RSType.defined;this.parent.set("type",N.type);this.parent.raiseEvent({name:"change",src:this});}}}},{slot:"childPulldownNode",scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,hostedCSSClass:"mstrmojo-di-relationship-item-hosted",bindings:{items:"this.parent.maps"},preBuildRendering:function(){if(this._super){this._super();}if(this.parent.data&&this.parent.data.child){this.selectItemByField("id",this.parent.data.child.id);}},postselectedIndexChange:function(K){var O=K.value,M=K.valueWas,L=this.items,N=this.parent.data;if(O!==M){if(L[O]){this.set("title",L[O].n);}N.child.id=L[O].id;if(this.parent.hasRendered){N.type=I.RSType.defined;this.parent.set("type",N.type);this.parent.raiseEvent({name:"change",src:this});}}}},{slot:"typePulldownNode",scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,hostedCSSClass:"mstrmojo-di-relationship-item-hosted ertype",preBuildRendering:function(){if(this._super){this._super();}if(this.parent.data){this.selectItemByField("id",this.parent.data.ert);}},postselectedIndexChange:function(K){var O=K.value,M=K.valueWas,L=this.items,N=this.parent.data;if(O!==M){N.ert=L[O].id;if(this.parent.hasRendered){N.type=I.RSType.defined;this.parent.set("type",N.type);this.parent.raiseEvent({name:"change",src:this});}}},items:[{n:mstrmojo.desc(13783,"One to One"),id:I.ERType.ERType11},{n:mstrmojo.desc(13784,"One to Many"),id:I.ERType.ERType1M},{n:mstrmojo.desc(13785,"Many to Many"),id:I.ERType.ERTypeMM}]},{slot:"buttonNode",scriptClass:"mstrmojo.Button",onclick:function(){this.parent.raiseEvent({name:"delete",src:this});}}]});mstrmojo.DI.DIRelationshipDefineEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIRelationshipDefineEditor",cssClass:"mstrmojo-di-relationship-define",title:mstrmojo.desc(12706,"Define Relations"),origItems:null,help:"attribute_relationships.htm",items:null,onOpen:function(){var L=mstrApp.getRootController().model;var O=this.tableID;var K,N;var M=L.getImportSource(O);if(!M){this.close();}if(M.currentTransformations&&M.currentTransformations.xtab&&M.currentTransformations.xtab.isCrosstab){N=M.transformedMapping;}else{N=M.currentMapping;}N=G.filter(N,function(P){return P.tp===12&&P.selected===true;});N=B.clone(N);G.forEach(N,function(P){P.n=P.alias;P.cls=P.ipa?"ipa":"";});K=B.clone(M.relationship);this.set("origItems",M.relationship);this.set("maps",N);this.set("items",K);},onClose:function(){this.destroy();},ondeleteItem:function(K){var M=K.src;var L=this.items;var N;M.data.deleted=true;this.set("items",L);this.hasChanged=true;N=A(this.list.items,this.maps);this.btnHbox.children[0].set("enabled",N);},onchangeItem:function(L){var N=true,O,P="",K,M,Q;this.hasChanged=true;O=L&&L.src&&L.src.data;if(O){K=G.find(this.maps,"id",O.parent.id);if(K>=0){M=this.maps[K];}K=G.find(this.maps,"id",O.child.id);if(K>=0){Q=this.maps[K];}if(M&&Q){if(M.id===Q.id){N=false;P=mstrmojo.desc(13851,"Cannot define the relationship between the same attributes.");}else{if(M.ipa&&Q.ipa){N=false;P=mstrmojo.desc(14689,"Do not support two project attributes have relationship here.");}}}}if(!N){L.src.set("status",8002);L.src.set("tooltip",P);this.btnHbox.children[0].set("enabled",N);return ;}else{L.src.set("status","");L.src.set("tooltip","");}N=A(this.list.items,this.maps);this.btnHbox.children[0].set("enabled",N);},_set_items:function(L,K){this.items=K;return true;},onitemsChange:function(){var L=null,K=false,M;M=G.filter(this.items,function(N){return !N.deleted;});if(this.list.items){K=M.length>this.list.items.length;}if(this.list.domNode){L=this.list.domNode.scrollTop;}this.list.set("items",M);if((L!==null||K)&&this.list.domNode){this.list.domNode.scrollTop=K?this.list.domNode.scrollHeight:L;}},deleteAllItems:function(){var K;G.forEach(this.items,function(L){L.deleted=true;});K=this.items;this.set("items",K);this.hasChanged=true;},toggleAllRSType:function(K){var L=this.list,M=L&&L.ctxtBuilder.itemWidgets;G.forEach(M,function(N){N.setRSType(K);});},children:[{scriptClass:"mstrmojo.Box",cssClass:"rseditor-header cf",children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"rseditor-header-label parent",text:mstrmojo.desc(12877,"Parent Attribute")},{scriptClass:"mstrmojo.Label",cssClass:"rseditor-header-label child",text:mstrmojo.desc(12878,"Child Attribute")},{scriptClass:"mstrmojo.Label",cssClass:"rseditor-header-label relation",text:mstrmojo.desc(12879,"Relationship")}]}]},{scriptClass:"mstrmojo.WidgetList",cssClass:"rseditor-list",alias:"list",bindings:{maps:"this.parent.maps"},itemFunction:function(N,K,O){var L={data:N,maps:O.maps,cssClass:C,idx:K,parent:O,tooltip:N.tooltip||""};if(N.hasOwnProperty("status")){L.status=N.status;if(L.status===2){L.tooltip=mstrmojo.desc(14716,"Please modify the relationship");}}if(N.hasOwnProperty("type")){L.type=N.type;L.toggle=L.type===I.RSType.defined?"toggle":"";}var M=new mstrmojo.DI.DIRelationshipItem(L);M.attachEventListener("delete",O.parent.id,"ondeleteItem");M.attachEventListener("change",O.parent.id,"onchangeItem");return M;}},{scriptClass:"mstrmojo.Box",cssClass:"rseditor-box cf",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton",iconClass:"addBtn",text:mstrmojo.desc(6389,"Add New"),onclick:function(){var L=this.parent.parent,K=L.items;K.push({parent:{},child:{},ert:I.ERType.ERType1M,type:I.RSType.defined});L.set("items",K);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton",iconClass:"delBtn",text:mstrmojo.desc(5186,"Delete All"),onclick:function(){this.parent.parent.deleteAllItems();}},{scriptClass:"mstrmojo.Box",cssClass:"sep"},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"toggleAllPulldown",value:mstrmojo.desc(14678,"Convert All"),items:[{n:mstrmojo.desc(14679,"To user managed"),cls:"defined",id:I.RSType.defined},{n:mstrmojo.desc(14680,"To auto managed"),cls:"auto",id:I.RSType.auto}],postselectedIndexChange:function(K){var P=this.parent.parent,R=K.value,N=K.valueWas,M=this.items,L=this.value,Q=this,O;this.set("value","");this.set("value",L);if(R!==N){O=M[R].id;P.toggleAllRSType(O);}if(R>=0){window.setTimeout(function(){Q.getPopupList().clearSelect();},0);}}}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),onclick:function(){var K=this.parent.parent;var L={success:function(){K.close();},failure:function(M){mstrApp.getRootController().displayError(mstrmojo.desc(12881,"Cannot save relationships."),false,M.message);}};D(K.tableID,K.origItems,K.items,L);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var K=this.parent.parent;K.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown");var H=mstrmojo.array,C=mstrmojo.hash,B=19,J=13,D=27;mstrmojo.ui.SearchablePulldown=mstrmojo.declare(mstrmojo.ui.Pulldown,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.ui.SearchablePulldown",editableSlot:"selectedNode",allowCustomText:false,isSearching:false,editOnClick:false,init:function K(P){this._super(P);var M=this.getPopupList();M.renderOnScroll=this.renderOnScroll||M.renderOnScroll;M.renderBlockSize=this.renderBlockSize||M.renderBlockSize;mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-SearchablePulldown");var O=M.constructor.prototype,N=M.getItemProps?M.getItemProps:O.getItemProps,Q=M.getItemMarkup?M.getItemMarkup:O.getItemMarkup;M.getItemProps=function(V,R){var S=this._spft||"",W=V.n,T=W.toUpperCase().indexOf(S);if(T===-1){S="";}var U=N.call(this,V,R);U.before=W.slice(0,T);U.input=W.substring(T,T+S.length);U.after=W.slice(T+S.length,W.length);return U;};M.getItemMarkup=function(S,R){return Q.call(this,S,R).replace("{@en@n}","{@en@before}<span class='sp-highlight'>{@en@input}</span>{@en@after}");};},onclick:function L(M){var P=this.selectedNode,Q=M.getTarget(),R=M.e.offsetX>=(P.offsetWidth-B),O=this.getPopupWidget(),N=O.visible;if(Q===P&&(!N||(N&&R))){this.set("isEditing",!N);this._super(M);}},onPopupWidgetClosed:function F(){this.set("isEditing",false);var P=this.getPopupList(),Q=P._oldItems,N=this.text;delete P._oldItems;if(Q){var M=H.find(Q,"n",N);if(M===-1&&!this.allowCustomText){var O=P.items[0]||Q[0];M=H.find(Q,"n",O.n);}P.set("items",Q);this.set("selectedIndex",M);}},_set_selectedIndex:function E(O,M){if(this.allowCustomText&&M===-1){this.selectedIndex=-1;this.onitemSelected(null,M);}else{this.isSearching=false;this._super(O,M);if(this.hasRendered){var N=this.selectedNode;this.text=N.innerText?N.innerText:N.textContent;}}return true;},onkeydown:function G(N){this._super(N);var M=window.event||N.e;if(M.keyCode===J){this.getPopupList().close();}},onkeyup:function A(O){this._super(O);var M=window.event||O.e,P=M.keyCode,N=this.getPopupList();if(P===D||P===J){N.close();}else{this.processSearch();}},processSearch:function I(){this.isSearching=true;this.hideTooltip();var M=[],O=this.getPopupList(),P=this.selectedNode.innerHTML,Q=O._oldItems||O.items,N=P.toUpperCase();N=N.replace(/<BR>/,"");if(N.length>0){H.forEach(Q,function(R){if(R.n.toUpperCase().indexOf(N)>-1){M.push(C.clone(R));}},this);}else{M=Q;}O._spft=N;if(this.customizeSearchResult){this.customizeSearchResult(M);}O.set("items",M);O.adjustCornersForPopupOverflow();delete O._spft;O._oldItems=Q;O.set("visible",M.length!==0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown");var J=mstrmojo.array,L=mstrmojo.hash,A=19,F=13,K=27;var R=mstrmojo.css,E=mstrmojo.dom;mstrmojo.Refine.RefineSearchablePulldown=mstrmojo.declare(mstrmojo.ui.Pulldown,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",editableSlot:"selectedNode",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-label" title="{@title}">Search</div><div class="mstrmojo-ui-Pulldown-text" title="{@title}" style="{@labelCssText}"></div><div class="container"></div></div>',markupSlots:{selectedNode:function Q(){return this.domNode.children[1];},labelNode:function I(){return this.domNode.children[0];},containerNode:function P(){return this.domNode.lastChild;}},allowCustomText:false,isSearching:false,editOnClick:false,init:function N(W){this._super(W);var T=this.getPopupList();T.renderOnScroll=this.renderOnScroll||T.renderOnScroll;T.renderBlockSize=this.renderBlockSize||T.renderBlockSize;mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-SearchablePulldown mstrmojo-Refine-SearchablePulldown");var V=T.constructor.prototype,U=T.getItemProps?T.getItemProps:V.getItemProps,X=T.getItemMarkup?T.getItemMarkup:V.getItemMarkup;T.getItemProps=function(c,Y){var Z=this._spft||"",d=c.n,a=d.toUpperCase().indexOf(Z);if(a===-1){Z="";}var b=U.call(this,c,Y);b.before=d.slice(0,a);b.input=d.substring(a,a+Z.length);b.after=d.slice(a+Z.length,d.length);return b;};T.getItemMarkup=function(Z,Y){return X.call(this,Z,Y).replace("{@en@n}","{@en@before}<span class='sp-highlight'>{@en@input}</span>{@en@after}");};},onclick:function S(T){var W=this.selectedNode,X=T.getTarget(),Y=T.e.offsetX>=(W.offsetWidth-A),V=this.getPopupWidget(),U=V.visible;if(X===W&&(!U||(U&&Y))){this.set("isEditing",!U);this.labelNode.style.display=U?"none":"block";R.toggleClass(this.labelNode,"hidden",false);this._super(T);}},onPopupWidgetClosed:function B(){this.set("isEditing",false);this.labelNode.style.display="none";var V=this.getPopupList(),W=V._oldItems,U=this.text;delete V._oldItems;if(W){var T=J.find(W,"n",U);if(T===-1&&!this.allowCustomText){V.set("items",W);return ;}V.set("items",W);this.set("selectedIndex",T);}},_set_selectedIndex:function C(X,U){if(this.allowCustomText&&U===-1){this.selectedIndex=-1;this.onitemSelected(null,U);}else{this.isSearching=false;this._super(X,U);if(this.hasRendered){var W=this.getPopupList();var V=this.selectedIndex;var T=W.items;this.text=T[V].n;}}return true;},onkeydown:function H(U){this._super(U);var T=window.event||U.e;if(T.keyCode===F){this.getPopupList().close();}},onkeyup:function O(V){this._super(V);var T=window.event||V.e,W=T.keyCode,U=this.getPopupList();if(W===K||W===F){U.close();}else{this.processSearch();}},onblur:function D(){},processSearch:function M(){this.isSearching=true;this.hideTooltip();var T=[],V=this.getPopupList(),W=this.selectedNode.innerHTML,X=V._oldItems||V.items,U=W.toUpperCase();if(W){R.toggleClass(this.labelNode,"hidden",true);}else{R.toggleClass(this.labelNode,"hidden",false);}U=U.replace(/<BR>/,"");if(U.length>0){J.forEach(X,function(Y){if(Y.n.toUpperCase().indexOf(U)>-1&&!Y.skipSearch){T.push(L.clone(Y));}},this);}else{T=X;}V._spft=U;if(this.customizeSearchResult){this.customizeSearchResult(T);}V.set("items",T);V.adjustCornersForPopupOverflow();delete V._spft;V._oldItems=X;V.set("visible",T.length!==0);},onisEditingChange:function G(){if(this.hasRendered){var T=this[this.editableSlot],U=!!this.isEditing;T.contentEditable=U;T.spellcheck=false;R.toggleClass(T,"editable",U);if(U){T.innerHTML="";T.focus();E.setElementSelection(T);}else{T.innerHTML=this.text;T.blur();T.scrollLeft=0;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.ui.Pulldown","mstrmojo.DI.DIDatabaseHelper");mstrmojo.requiresDescs(14455,14456,14457);var D=mstrmojo.array,G=mstrmojo.hash,B=mstrmojo.css,F=mstrmojo.dom,C=mstrmojo.DI.DIDatabaseHelper;var E={scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-DI-DIDBRoleAdmin-Item cf",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass} {@mode}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-DI-DIDBRoleAdmin-Item-Text">{@n}</div><div class="mstrmojo-DI-DIDBRoleAdmin-Item-Img"></div></div>',onmodeChange:function(H){var J=H.valueWas,I=H.value;if(this.hasRendered){B.toggleClass(this.domNode,J,false);B.toggleClass(this.coverNode,J,false);B.toggleClass(this.domNode,I,true);B.toggleClass(this.coverNode,I,true);}},onclick:function(H){var I=H.getTarget();if(this.mode==="remove"){if(this.domNode.children[1]===I){this.parent.raiseEvent({name:"selectChange",item:this});}}else{if(this.mode==="add"){if(F.contains(this.domNode,I,true)){this.parent.raiseEvent({name:"selectChange",item:this});}}}}};var A=function(){var H=this.items||[];this.destroyChildren();this.addChildren(H);};mstrmojo.DI.DIDBRoleAdmin=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIDBRoleAdmin",selectedDBRole:null,topLabel:mstrmojo.desc(14455,"Commonly used for"),bottomLabel:mstrmojo.desc(14456,"Not commonly used"),adminConfig:null,markupString:'<div id="{@id}" class="mstrmojo-DI-DIDBRoleAdmin {@cssClass}" style="{@cssText}"><div class="mstrmojo-DI-DIDBRoleAdmin-Label top cf"><div class="mstrmojo-DI-DIDBRoleAdmin-Label-Text">{@topLabel}</div></div><div class="mstrmojo-DI-DIDBRoleAdmin-Content top"></div><div class="mstrmojo-DI-DIDBRoleAdmin-Label bottom">{@bottomLabel}</div><div class="mstrmojo-DI-DIDBRoleAdmin-Content bottom"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},headerContainerNode:function(){return this.domNode.children[0];},topContainerNode:function(){return this.domNode.children[1];},bottomContainerNode:function(){return this.domNode.children[3];}},children:[{scriptClass:"mstrmojo.Box",alias:"topBox",slot:"topContainerNode",cssClass:"mstrmojo-DI-DIDBRoleAdmin-Box top cf",onitemsChange:function(){A.call(this);},onselectChange:function(H){this.parent.onselectChange(H);}},{scriptClass:"mstrmojo.Box",alias:"bottomBox",slot:"bottomContainerNode",cssClass:"mstrmojo-DI-DIDBRoleAdmin-Box bottom cf",onitemsChange:function(){A.call(this);},onselectChange:function(H){this.parent.onselectChange(H);}}],preBuildRendering:function(){var H;if(this._super){this._super();}H=mstrApp.getRootController().getModel();if(H.supportDBObjects&&H.supportDBObjects.supportDBType){this.populateDBRoles();}else{if(mstrApp.diParams.ImportDatabase){mstrApp.showProgress();H.attachEventListener("dbTypeFetched",this.id,"populateDBRoles");}else{this.set("topLabel",mstrmojo.desc(14457,"You do not have the right privilege to import from databases. Contact your administrator."));this.set("bottomLabel","");this.topBox.set("visible",false);this.bottomBox.set("visible",false);}}},populateDBRoles:function(I){var L=this,K=mstrApp.getRootController().getModel(),J,H;if(I){mstrApp.hideProgress();}this.adminConfig={};J=D.filter(K.sourceItems,function(M){return M.showDBList;});J=D.map(J,function(M){return{did:M.sid,n:M.n,dbObjectsDisplayOptions:M.dbObjectsDisplayOptions,dbIdExcludeFilter:M.dbIdExcludeFilter,dbRolesAdminConfig:M.dbRolesAdminConfig};});D.forEach(J,function(O){var M=O.did,P,N;if(!L.adminConfig[M]){P=K.supportDBObjects&&K.supportDBObjects.supportDBType;P=C.filterDBByDispOption(P,O.dbObjectsDisplayOptions,O.dbIdExcludeFilter);N=D.map(P,function(Q){return G.copy(E,{n:Q.n,dbId:Q.id,dbType:Q.dbType,selected:true});});if(O.dbRolesAdminConfig){D.forEach(N,function(R){var Q=D.indexOf(O.dbRolesAdminConfig,R.dbId);if(Q>=0){R.selected=false;}});}L.adminConfig[M]=N;}});if(!this.typePulldown){H=mstrmojo.ui.Pulldown.newPulldown(J,function(M,N){L.onselectSourceItemChange(M,N);},0,{alias:"typePulldown",slot:"headerContainerNode",isHostedWithin:true},true);this.addChildren([H]);this.onselectSourceItemChange(J[0]);}else{this.typePulldown.set("items",J);this.typePulldown.set("selectedIndex",this.typePulldown.selectedIndex||0);}},onselectSourceItemChange:function(I){var H,K,J;if(!I||!this.adminConfig[I.did]){return ;}H=D.map(this.adminConfig[I.did],function(L){return G.copy(L,{mode:L.selected?"remove":"add"});});K=D.filter(H,function(L){return L.selected;});J=D.filter(H,function(L){return !L.selected;});this.topBox.set("items",K);this.bottomBox.set("items",J);},onselectChange:function(I){var M=I.item,L=M.mode,K,J,H;K=this.typePulldown.getSelectedItem();if(!K){return ;}J=this.adminConfig[K.did];if(!J){return ;}H=D.find(J,"dbId",M.dbId);if(H>=0){if(L==="remove"){J[H].selected=false;}else{if(L==="add"){J[H].selected=true;}}}this.onselectSourceItemChange(K);},getAdminConfig:function(){var H=null;if(this.hasRendered&&this.adminConfig){H={};G.forEach(this.adminConfig,function(J,I){var K=D.filter(J,function(L){return L.selected!==true;});K=D.map(K,function(L){return L.dbId;});H[I]=K;});}return H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.List","mstrmojo.ui.Pulldown","mstrmojo.array","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(2057,7674,7675,7676,7677,7696,7697,9924,12375,12696,12919,12948,12973,13521,13522,13523,13524);var R=mstrmojo.css,S=mstrmojo.array;var L={NONE:0,CITY:1,STATE:2,COUNTRY:3,LOCATION:4,LATITUDE:5,LONGTITUDE:6,OTHER:7,ZIPCODE:8,COUNTY:9,AREACODE:10};var B=268435456,G=536870912,C=1073741824;var A=268435456,D=805306368,E=805306368,O=1879048192;var I=[{n:mstrmojo.desc(2057,"None"),v:L.NONE,geo:true},{n:mstrmojo.desc(7674,"Country"),v:L.COUNTRY,geo:true},{n:mstrmojo.desc(7676,"State"),v:L.STATE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B}]},{n:mstrmojo.desc(12919,"County"),v:L.COUNTY,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G}]},{n:mstrmojo.desc(7675,"City"),v:L.CITY,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G}]},{n:mstrmojo.desc(7677,"Zip Code"),v:L.ZIPCODE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G},{n:mstrmojo.desc(7675,"City"),did:C}]},{n:mstrmojo.desc(7696,"Latitude"),v:L.LATITUDE,geo:true},{n:mstrmojo.desc(7697,"Longtitude"),v:L.LONGTITUDE,geo:true},{n:mstrmojo.desc(12948,"City, State"),v:L.LOCATION,geo:true},{n:mstrmojo.desc(12973,"Area Code"),v:L.AREACODE,geo:true},{n:mstrmojo.desc(13521,"Custom"),v:L.OTHER,geo:true}];var H=[{n:mstrmojo.desc(2057,"None"),v:L.NONE,geo:true},{n:mstrmojo.desc(7677,"Zip Code"),v:L.ZIPCODE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G},{n:mstrmojo.desc(7675,"City"),did:C}]},{n:mstrmojo.desc(7696,"Latitude"),v:L.LATITUDE,geo:true},{n:mstrmojo.desc(7697,"Longtitude"),v:L.LONGTITUDE,geo:true},{n:mstrmojo.desc(12973,"Area Code"),v:L.AREACODE,geo:true}];mstrmojo.DI.DIGeoRole=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIGeoRole",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-qb-mapping-title"></div><div class="mstrmojo-qb-mapping-georole"></div><div class="mstrmojo-di-mapping-driveAttribute"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},formNode:function(){return this.domNode.firstChild.childNodes[0];},derivedAttributeNode:function(){return this.domNode.firstChild.childNodes[2];}},markupMethods:{onvisibleChange:function(){if(this.data.isSharedMultiForm){this.formNode.style.display="block";}else{this.formNode.style.display="none";}}},top:"0px",left:"0px",georole:0,shapeKeys:[],der:0,geoFormIndex:0,init:function M(T){this._super(T);this.raiseEvent({name:"shapeKeysChange"});this.raiseEvent({name:"dataChange"});this.multiFormList.attachEventListener("formChange",this.id,"updateGeoListSelection");this.geolist.attachEventListener("showDerivedAttribute",this.id,"showDerivedAttribute");},postBuildRendering:function P(){if(this._super){this._super();}this.updateGeoListSelection();},onshapeKeysChange:function J(){var Y=[];if(mstrApp.isCloud){I.splice(-1);}var X=this.data;if(X.isSharedMultiForm){var V=this.multiFormList.selectedIndex||this.multiFormList.idx;var T=this.data.mergeSubColumns[V];var U=T.dtp;var W;if(U===2){W=H;}else{if(U===1||U===8||U===9){W=[{n:mstrmojo.desc(2057,"None"),v:L.NONE,geo:true}];}else{W=I;}}mstrmojo.array.forEach(W,function(Z){if(Z.n!=="Latitude"&&Z.n!=="Longitude"){Y.push(Z);}});this.geolist.set("items",Y);this.geolist.refresh();}else{if(X.dtp===2){this.geolist.set("items",H);}else{this.geolist.set("items",I);}}},ondataChange:function N(){var X=this.data;if(X.isSharedMultiForm){var T=X.mergeSubColumns;var V=[];var U=0,W;mstrmojo.array.forEach(T,function(Z,Y){V.push({n:Z.fmn,v:Y});if(Z.georole&&Z.georole!==0){U=Y;}});this.multiFormList.set("items",V);this.geoFormIndex=U;W=T[this.geoFormIndex].der;this.multiFormList.set("selectedIndex",this.geoFormIndex);if(W){this.der=W;}}},updateGeoListSelection:function Q(){var V=this.data,U;if(V.isSharedMultiForm){var T=this.multiFormList.selectedIndex||0;V=this.data.mergeSubColumns[T];}U=S.find(this.geolist.items,"v",V.georole);this.geolist.set("selectedIndex",U);},_close:function(){var T=this.parent;if(T&&T._cmSource){T._cmSource.closeMenuTree();}},onOK:function(){var W,a,X,Y;if(this.data.isSharedMultiForm){Y=this.multiFormList.selectedIndex;X=this.data.mergeSubColumns[Y];}else{X=this.data;}var Z=this.geolist;var U=Z.items[Z.selectedIndex];if(U.geo){W=U.v;if(W===undefined){W=Z.selected;}a={2:A,1:D,9:E,8:O}[W]||0;X.georole=W;X.der=this.der=this.der&a;}else{X.georole=7;X.shapeKey=this.geolist.selectedItem.did;}if(this.data.isSharedMultiForm){Y=this.multiFormList.selectedIndex;if(Y!==this.geoFormIndex){var c=this.data.mergeSubColumns[Y];var b=this.data.mergeSubColumns[this.geoFormIndex];if((c.georole!==L.LATITUDE)&&(c.georole!==L.LONGTITUDE)){var V,T=this.data.mergeSubColumns;for(V=0;V<T.length;V++){if(V===Y){if(T[V].fmn==="ID"){this.data.georole=T[V].georole;}continue;}this.data.mergeSubColumns[V].georole=0;}}else{if((b.georole!==L.LONGTITUDE)&&(b.georole!==L.LATITUDE)){this.data.mergeSubColumns[b].georole=0;}}}}mstrApp.getRootController().setGeoRoles(this.data);this._close();},onCancel:function(){this._close();},showDerivedAttribute:function(U){var Y=this.data;if(Y.isSharedMultiForm){var T=this.multiFormList.selectedIndex;Y=this.data.mergeSubColumns[T];}var X=Y.der;var V=U.items;this.derivedAttrList.set("items",V);var W=[];if(X){S.forEach(V,function(a,Z){if(X&a.did){W.push(Z);}});this.derivedAttrList.addSelect(W);}this.derivedAttributeNode.style.display="block";},children:[{scriptClass:"mstrmojo.Label",slot:"formNode",alias:"title",text:mstrmojo.desc(13522,"Select Attribute Form:")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"formNode",alias:"multiFormList",idx:0,onitemSelected:function F(){this.parent.raiseEvent({name:"shapeKeysChange"});this.raiseEvent({name:"formChange",idx:this.selectedIndex});}},{scriptClass:"mstrmojo.Label",slot:"contentNode",text:mstrmojo.desc(13523,"Select Geographic Type:")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"contentNode",alias:"geolist",cssClass:"mstrmojo-qb-geolist",itemIdField:"did",cssClassItem:"",onitemSelected:function(){var T=this.items[this.selectedIndex];if(T.items){this.raiseEvent({name:"showDerivedAttribute",items:T.items});}else{this.parent.derivedAttributeNode.style.display="none";}},expandShapeKeyNode:function K(){},itemMarkupFunction:function(b,W,V){var Y=[],a=V.parent,U,X,Z,T;if(b.items){Z=b.items;T="onclick=\"mstrmojo.dom.captureDomEvent('"+V.id+"','click', self, event)\"";Y.push('<div class="mstrmojo-qb-georole-attribute-box"><span>');Y.push(mstrmojo.desc(9924,"Create attributes for:"));Y.push("</span>");for(U=0,X=Z.length;U<X;U++){Y.push('<div class="mstrmojo-qb-georole-attribute '+((a.der&Z[U].did)?"selected":"")+'" did="'+Z[U].did+'"'+T+'><img class="mstrmojo-qb-georole-checkbox" src="../images/1ptrans.gif"><span style="padding-left:5px;">');Y.push(Z[U].n);Y.push("</span></div>");}Y.push("</div>");}return'<div class="mstrmojo-qb-georole '+((b.did===L.OTHER)?"other":"")+(b.geo?"":"shapeKey ")+V.cssClassItem+'" idx="'+W+'" did="'+b.did+'"><div class="mstrmojo-qb-georole-itemtext"><img class="mstrmojo-qb-georole-img" src="../images/1ptrans.gif"><span class="mstrmojo-qb-georole-text">'+b.n+'</span></div><div class="mstrmojo-qb-georole-itemcontent">'+Y.join("")+"</div></div>";}},{scriptClass:"mstrmojo.Label",slot:"derivedAttributeNode",alias:"derivedAttrTitle",text:mstrmojo.desc(13524,"(Optional) Create Additional Attributes:")},{scriptClass:"mstrmojo.ui.CheckList",slot:"derivedAttributeNode",alias:"derivedAttrList",onchange:function(U){var T=U.removed&&U.removed.length>0?U.removed:U.added;var Y=this.items[T[0]];var W=Y.did;var X,V,Z;Z=[];V=(this.parent.der&W)?R.removeClass:R.addClass;for(X=0;X<Z.length;X++){V(Z[X],"selected");}if(U.added&&U.added.length>0){this.parent.der=this.parent.der|W;}else{this.parent.der=this.parent.der^W;}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.array","mstrmojo.Editor","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.Button","mstrmojo.Label","mstrmojo.DynamicClassFactory","mstrmojo.ui.Pulldown");var E=mstrmojo.array,D=mstrmojo.DynamicClassFactory.newComponent;mstrmojo.architect.ui.SimpleList=D(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.architect.ui.SimpleList"});function C(){var F=this.secondaryList,G=this.primaryDBRole;this.close();this.onSubmit({did:this.dataSources.did,primaryId:G.id,primaryName:G.n,secondary:F.getSelectedItems()});}mstrmojo.architect.ui.editors.DataSourceEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.DataSourceEditor",cssClass:"mstrmojo-ar-DataSourceEditor",title:mstrmojo.desc(4381,"Data Sources"),help:null,primaryPulldown:undefined,secondaryList:undefined,onSubmit:mstrmojo.emptyFn,onOpen:function A(){var F=this.dataSources.dbRoles;this.primaryPulldown.set("items",F);this.primaryPulldown.set("selectedIndex",E.find(F,"id",this.dataSources.primaryId));},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11387,"Primary Data Source")+":"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"primaryPulldown",onitemSelected:function B(L,I){var H=this.items.concat(),K=this.parent,G=K.secondaryList;H.splice(I,1);G.clearSelect(true);G.set("visible",H.length!==0);G.set("items",H);var J={};E.forEach(H,function F(N,M){J[M]=true;});G.set("selectedIndices",J);K.primaryDBRole=L;}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11389,"Secondary Data Source(s):")},{scriptClass:"mstrmojo.architect.ui.SimpleList",cssClass:"mstrmojo-ar-SecondaryDBRoles",multiSelect:true,selectionPolicty:"reselect",alias:"secondaryList"},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(1442,"OK"),slot:"buttonNode",onclick:function(){C.call(this.parent);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui.Pulldown");var F=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingPulldown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",cssClass:"mstrmojo-wh-DBRolePulldown",postBuildRendering:function A(){if(this._super){this._super();}this.captionlbl.set("text",this.caption);this.list.set("itemIdField",this.itemIdField);this.list.set("itemField",this.itemField);this.onenabledChange();if(typeof this.allowHTML==="boolean"){this.list.set("allowHTML",this.allowHTML);}},caption:"",contains:function C(M){var L=mstrmojo.array.find(this.items,this.itemIdField,M);return(L>0);},itemIdField:"",itemField:"n",items:null,onitemsChange:function K(){this.list.set("items",this.items);},selectedID:null,onselectedIDChange:function E(){var L=Math.max(F.find(this.items,this.itemIdField,this.selectedID),0);if(this.items&&this.items[L]){this.list.set("selectedIndex",L);}if(this.selectedID){this.selectedItem=this.items[L];}},selectedItem:undefined,enabled:true,onenabledChange:function G(){this.captionlbl.set("enabled",this.enabled);this.list.set("enabled",this.enabled);},getValue:function D(){var L=this.selectedItem||this.items[0];if(L){return L.v;}return"";},setValue:function B(L){this.set("selectedID",L);},isValid:function J(){return{val:true,msg:""};},onChange:mstrmojo.emptyFn,captionlbl:undefined,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",alias:"captionlbl"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"list",onitemSelected:function H(O,M){var N=this.parent,L=(N.selectedItem?N.selectedItem.id:"");if(O[this.itemIdField]!==L){N.set("selectedItem",O);if(N.onChange){N.onChange(O,M);}}},onitemsChange:function I(){var L=this.parent;L.selectedID=null;}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.RadioList","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Refine.RefineHelpers","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(13574,134,3434,1013,2052,14533);var A=mstrmojo.Refine.RefineConstants,C=mstrmojo.Refine.RefineHelpers;function B(F){F=F.replace(/\n/g,"\\n");F=F.replace(/\t/g,"\\t");return F;}function E(F){return F.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function D(){var F=[],J,M,I,K,G,H,N,L;M=this.parent;I=M.columns;K=I.selectedIndex;L=I.items[I.selectedIndex].cellIndex;if(K===undefined){return ;}G=(I.items[K]).name;H=M.transformationList;N=H.subType%10;switch(N){case 0:J=JSON.parse(JSON.stringify(this.operations.titlecase));break;case 1:J=JSON.parse(JSON.stringify(this.operations.uppercase));break;case 2:J=JSON.parse(JSON.stringify(this.operations.lowercase));break;case 3:J=JSON.parse(JSON.stringify(this.operations.unescape));break;case 4:switch(this.optionsBox.datatype.type.selectedIndex){case 0:J=JSON.parse(JSON.stringify(this.operations.number));break;case 1:J=JSON.parse(JSON.stringify(this.operations.text));var O=this.parentBox.controller.model.data.rows[0].cells[L];if(O.t){if(O.v.indexOf("T")!==-1){J.expression="toString(value, 'yyyy-MM-dd HH:mm:ss')";}else{J.expression="toString(value, 'yyyy-MM-dd')";}}break;case 2:if(!this.optionsBox.datatype.format.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}J=JSON.parse(JSON.stringify(this.operations.date));J.description=J.description.replace("[format]","'"+this.optionsBox.datatype.format.value+"'");J.expression=J.expression.replace("[format]","'"+this.optionsBox.datatype.format.value+"'");break;}break;case 5:J=JSON.parse(JSON.stringify(this.operations.fillDown));break;case 6:J=JSON.parse(JSON.stringify(this.operations.blankDown));break;case 7:J=JSON.parse(JSON.stringify(this.operations.padBefore));J.description=J.description.replace("[string]","'"+B(E(this.optionsBox.padString.value))+"'");J.expression=J.expression.replace("[string]","'"+E(this.optionsBox.padString.value)+"'");break;case 8:J=JSON.parse(JSON.stringify(this.operations.padAfter));J.description=J.description.replace("[string]","'"+B(E(this.optionsBox.padString.value))+"'");J.expression=J.expression.replace("[string]","'"+E(this.optionsBox.padString.value)+"'");break;}J.columnName=G;J.description=J.description.replace("[column name]",G);J.engineConfig=JSON.parse(this.controller.model.engine);F.push(J);this.controller.applyOperations({operations:JSON.stringify(F),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.datatype.format.set("value","");this.optionsBox.padString.set("value","");}mstrmojo.Refine.RefineControlTransformCell=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlTransformCell",markupString:'<div id="{@id}" class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===10||this.subType===11||this.subType===12||this.subType===13||this.subType===15||this.subType===16){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.TransformCell);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.TransformCell)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"datatype",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(3434,"Number")},{n:mstrmojo.desc(1013,"Text")},{n:mstrmojo.desc(2052,"Date")}],selectedIndex:0},{scriptClass:"mstrmojo.TextBox",alias:"format",visible:false,cssClass:"Date",emptyText:mstrmojo.desc(14533,"Input Date Format"),bindings:{visible:function(){return(this.parent.type.selectedIndex===2);}}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-help",title:mstrmojo.desc(1143,"Help"),onclick:function(){var F="data_wrangle_date_time.htm";mstrApp.showHelpTopic(F);},bindings:{visible:function(){return(this.parent.type.selectedIndex===2);}}}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.TextBox",alias:"padString",bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===7||this.parent.parent.parentBox.transformationList.subType%10===8);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){var H=this.parent.parent,G=H.controller.model,I=H.subType,F=A.transformationSubType;if((I===F.FillDown||I===F.BlankDown)&&G.hasAddSample()){C.confirmFilldownOrBlankdown(function(){D.call(H);});}else{D.call(H);}},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4||this.parent.parent.parentBox.transformationList.subType%10===7||this.parent.parent.parentBox.transformationList.subType%10===8);}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.RadioList","mstrmojo.ui.Pulldown","mstrmojo.Refine.RefineTagBox","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(13574,686,13059,13060,12359,12360,134,14290,14291);var A=mstrmojo.Refine.RefineConstants;function B(){var C=[],H,M,G,K,D,F,N;var E,Q;M=this.parent;K=M.columns.selectedIndex;F=M.transformationList;G=M.columns;N=F.subType%10;if(K===undefined&&!F.noColumn){return ;}if(!F.noColumn){D=(G.items[K]).name;}switch(N){case 0:H=JSON.parse(JSON.stringify(this.operations.Colomn));H.description=H.description.replace("[column name]",D);H.columnName=D;break;case 1:var L=this.optionsBox.rows.type.selectedIndex;var O=this.optionsBox.rows.text.value;var P,J,I;switch(L){case 0:H=JSON.parse(JSON.stringify(this.operations.RowsContains));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+=mstrmojo.string.regEscape(P[J].text);if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+=mstrmojo.string.regEscape(I);}break;case 1:H=JSON.parse(JSON.stringify(this.operations.RowsBegins));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+="^"+mstrmojo.string.regEscape(P[J].text);if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+="^"+mstrmojo.string.regEscape(I);}break;case 2:H=JSON.parse(JSON.stringify(this.operations.RowsEnds));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+=mstrmojo.string.regEscape(P[J].text)+"$";if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+=mstrmojo.string.regEscape(I)+"$";}break;case 3:H=JSON.parse(JSON.stringify(this.operations.RowsBlank));break;case 4:H=JSON.parse(JSON.stringify(this.operations.RowsEquals));break;case 5:H=JSON.parse(JSON.stringify(this.operations.RowsNotEquals));break;}if(L!==3&&!O){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(L===0||L===1||L===2){H.engineConfig.facets[0].query=H.engineConfig.facets[0].query.replace("[text]",O);H.description=H.description.replace("####","/"+O+"/");}else{if(L===4||L===5){H.engineConfig.facets[0].selection[0].v.v=O;H.engineConfig.facets[0].selection[0].v.l=O;H.description=H.description.replace("####","'"+O+"'");}}H.engineConfig.facets[0].name=H.engineConfig.facets[0].columnName=D;H.description=H.description.replace("[column name]",D);break;case 2:H=JSON.parse(JSON.stringify(this.operations.RemoveDuplicateCells));H.description=H.description.replace("[column name]",D);H.columnName=D;break;case 3:H=JSON.parse(JSON.stringify(this.operations.RemoveDuplicateRows));break;case 4:H=JSON.parse(JSON.stringify(this.operations.DeleteRowsInTheView));E=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;H.engineConfig=E.getJSON();Q=E.getRequirementDiscription();H.description=H.description.replace("[Requirement]",Q);E.resetAllFacets();break;case 5:H=JSON.parse(JSON.stringify(this.operations.DeleteRowsNotInTheView));E=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;H.engineConfig=E.getJSON();Q=E.getRequirementDiscription();H.description=H.description.replace("[Requirement]",Q);E.resetAllFacets();break;}if(N===1||N===2||N===3){H.engineConfig.facets=H.engineConfig.facets.concat(JSON.parse(this.controller.model.engine).facets);}C.push(H);this.controller.applyOperations({operations:JSON.stringify(C),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.rows.text.set("value","");this.optionsBox.rows.tagBox.removeTags();this.optionsBox.rows.tagBox.inputBox.input.set("value","");}mstrmojo.Refine.RefineControlDelete=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlDelete",markupString:'<div class="refine-controls delete"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===20||this.subType===22||this.subType===23||this.subType===24||this.subType===25){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Delete);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Delete)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"rows",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12359,"Where Cell")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(686,"Contains")},{n:mstrmojo.desc(13059,"Begins With")},{n:mstrmojo.desc(13060,"Ends With")},{n:mstrmojo.desc(12360,"Is Empty")},{n:mstrmojo.desc(14290,"Equals To")},{n:mstrmojo.desc(14291,"Not Equals To")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===3){this.parent.text.set("visible",false);this.parent.tagBox.set("visible",false);}else{if(this.selectedIndex===0||this.selectedIndex===1||this.selectedIndex===2){this.parent.text.set("visible",false);this.parent.tagBox.set("visible",true);}else{this.parent.text.set("visible",true);this.parent.tagBox.set("visible",false);}}}},{scriptClass:"mstrmojo.TextBox",alias:"text"},{scriptClass:"mstrmojo.Refine.RefineTagBox",alias:"tagBox"}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{slot:"optionsNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){B.call(this.parent.parent);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.ui.Pulldown","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(134,12361,13574,14178,14179,12348);var C=mstrmojo.Refine.RefineConstants;var D=mstrmojo.DI.DIConstants;var A=mstrmojo.css;function G(){var W=1,V,I,Z=[],P,O,J,M,K,b,R,a,X,c;O=this.parent;J=O.columns;M=J.selectedIndex;c=J.items[J.selectedIndex].columnIndex;if(M===undefined){return ;}K=(J.items[M]).name;b=O.transformationList;R=b.subType%10;if(R===0){var S=mstrApp.getRootController();var Y=S.showDialog(D.dialogType.refineClusteringPage,{columnName:K,controller:this.controller});this.controller.model.attachEventListener("clustersFetched",Y.id,Y.handleClustersFetched);return ;}while(true){X=K+" "+W;I=true;for(V=0;V<J.items.length;V++){if(X===(J.items[V]).name){I=false;break;}}W++;if(I){a=X;break;}}switch(R){case 1:P=JSON.parse(JSON.stringify(this.operations.duplicate));P.description=P.description.replace("[new column name]",a);P.description=P.description.replace("[column name]",K);P.columnInsertIndex=c+1;P.newColumnName=P.newColumnName.replace("[column name]",a);P.baseColumnName=P.baseColumnName.replace("[column name]",K);break;case 2:a=this.optionsBox.name.value;if(a===""){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}P=JSON.parse(JSON.stringify(this.operations.Rename));P.description=P.description.replace("####",K);P.description=P.description.replace("@@@@",a);P.oldColumnName=K;P.newColumnName=a;break;case 3:var N=this.optionsBox.columns.selectedIndex;if(N===undefined){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var Q=(this.optionsBox.columns.items[N]).name;P=JSON.parse(JSON.stringify(this.operations.ConcatenateColumns));P.description=P.description.replace("####",K);P.description=P.description.replace("@@@@",Q);P.description=P.description.replace("@@@@",a);P.baseColumnName=K;P.newColumnName=a;P.columnInsertIndex=Math.max(c,N)+1;P.expression=P.expression.replace(new RegExp("\\[column name 1\\]","gm"),K);P.expression=P.expression.replace(new RegExp("\\[column name 2\\]","gm"),Q);break;case 4:var U=this.optionsBox.name2.value;var T=this.optionsBox.name3.value;var H=this.optionsBox.columns;if(H.selectedIndex===undefined||!U||!H){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var L=H.items[H.selectedIndex].columnIndex-c+1;P=JSON.parse(JSON.stringify(this.operations.TransposeColumnsIntoRows));P.description=P.description.replace("####",L);P.description=P.description.replace("@@@@",K);P.description=P.description.replace("@@@@",U);P.description=P.description.replace("@@@@",T);P.startColumnName=K;P.keyColumnName=U;P.valueColumnName=T;P.columnCount=L;}if(!(R===2||R===4)){P.engineConfig=JSON.parse(this.controller.model.engine);}Z.push(P);this.controller.applyOperations({operations:JSON.stringify(Z),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.name.set("value","");}mstrmojo.Refine.RefineControlOther=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlOther",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===70||this.subType===71){this.optionsBox.apply.onclick();}if(this.subType===74){var I=this.parent.columns;var H=I.selectedIndex;var J=I.items[H].columnIndex;this.populate(this.columns.slice(J+1),J+1);this.handleColumnUnSelected();}else{if(this.subType===73){this.populate(this.columns);this.handleColumnUnSelected();}}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===C.transformationType.Other);},subType:function(){return((this.parentBox.transformationList.type===C.transformationType.Other)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",alias:"columns",cssClass:"refine-pulldown refine-other-columns",onitemSelected:function(H){A.toggleClass(this.domNode,"selected",true);this.set("value",H.name);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===3||this.parent.parent.parentBox.transformationList.subType%10===4);}},getPopupListConfig:function B(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",useRichTooltip:true,selectionPolicy:"reselect",locksHover:true,listHooks:{select:function H(K,L,J){this.parent.set("selectedIndex",J);this.close();}},getItemProps:function I(K,J){return mstrmojo._IsList.getItemProps.call(this,K,J);}};}},{scriptClass:"mstrmojo.TextBox",alias:"name",emptyText:mstrmojo.desc(12361,"Column Name"),tooltip:mstrmojo.desc(12361,"Column Name"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===2);}}},{scriptClass:"mstrmojo.TextBox",alias:"name2",emptyText:mstrmojo.desc(14178,"Key Column"),tooltip:mstrmojo.desc(14178,"Key Column"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.TextBox",alias:"name3",emptyText:mstrmojo.desc(14179,"Value Column"),tooltip:mstrmojo.desc(14179,"Value Column"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){G.call(this.parent.parent);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0&&this.parent.parent.parentBox.transformationList.subType%10!==1);}}}]}],populate:function F(J,K){if(!K){K=0;}var H=[],I;for(I=0;I<J.length;I++){H.push({n:J[I].name,name:J[I].name,columnIndex:I+K});}this.optionsBox.columns.set("items",H);},handleColumnsChanged:function E(H){this.columns=H.value.columns;this.populate(this.columns);},handleColumnUnSelected:function(){this.optionsBox.columns.set("value",mstrmojo.desc(12348,"Select Column"));this.optionsBox.columns.selectedIndex=undefined;this.optionsBox.columns.list.set("selectedIndex",null);A.toggleClass(this.optionsBox.columns.domNode,"selected",false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(134,13574);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(F,E){F=F.replace(/\$/g,"$$$$");if(!E){F=F.replace(/[\\"']/g,"\\$&");}return F;}function C(){var E=[],I,M,H,L,F,G,O;M=this.parent;H=M.columns;L=H.selectedIndex;if(L===undefined){return ;}F=(H.items[L]).name;G=M.transformationList;O=G.subType%10;var P,Q,K,J;switch(O){case 0:I=JSON.parse(JSON.stringify(this.operations.CutOn));Q=this.optionsBox.find.tagBox.children;P="";for(K=0;K<Q.length-1;K++){P+=mstrmojo.string.regEscape(Q[K].text);if(K!==Q.length-2){P+="|";}}J=Q[Q.length-1].input.value;if(J){if(Q.length>1){P+="|";}P+=mstrmojo.string.regEscape(J);}break;case 1:I=JSON.parse(JSON.stringify(this.operations.CutBefore));break;case 2:I=JSON.parse(JSON.stringify(this.operations.CutAfter));break;}var N=this.optionsBox.find.from.value;if((O===0&&!P)||(O!==0&&!N)){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[column name]",F);if(O===0){I.description=I.description.replace("####","/"+B(D(P,true))+"/");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"/"+D(P,true)+"/");}else{I.description=I.description.replace("####","'"+B(D(N))+"'");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"'"+D(N)+"'");}I.columnName=F;I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.find.from.set("value","");this.optionsBox.find.tagBox.removeTags();this.optionsBox.find.tagBox.inputBox.input.set("value","");}mstrmojo.Refine.RefineControlRemoveText=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlRemoveText",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.RemoveText);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"find",cssClass:"refine-controls-remove-text-box",children:[{scriptClass:"mstrmojo.TextBox",alias:"from",bindings:{visible:function(){return(this.parent.parent.parent.parentBox.transformationList.subType%10!==0);}}},{scriptClass:"mstrmojo.Refine.RefineTagBox",alias:"tagBox",bindings:{visible:function(){return(this.parent.parent.parent.parentBox.transformationList.subType%10===0);}}}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.HTMLButton","mstrmojo.Button","mstrmojo.Pulldown","mstrmojo.ui.Pulldown","mstrmojo.CheckBox","mstrmojo.HBox","mstrmojo.Label","mstrmojo.MenuButton","mstrmojo.Table","mstrmojo.string");var H=mstrmojo.array;var G=[{n:"(GMT-12:00)International Date Line West",v:"-12_0"},{n:"(GMT-11:00)Midway Island, Samoa",v:"-11_0"},{n:"(GMT-10:00)Hawaii",v:"-10_0"},{n:"(GMT-09:00)Alaska",v:"-9_1"},{n:"(GMT-08:00)Pacific Time (US & Canada)",v:"-8_1"},{n:"(GMT-07:00)Arizona",v:"-7_0"},{n:"(GMT-07:00)Mountain Time (US & Canada)",v:"-7_1"},{n:"(GMT-06:00)Central America, Saskatchewan",v:"-6_0"},{n:"(GMT-06:00)Central Time (US & Canada), Guadalajara, Mexico city",v:"-6_1"},{n:"(GMT-05:00)Indiana, Bogota, Lima, Quito, Rio Branco",v:"-5_0"},{n:"(GMT-05:00)Eastern time (US & Canada)",v:"-5_1"},{n:"(GMT-04:00)Caracas, La Paz",v:"-4_0"},{n:"(GMT-04:00)Atlantic time (Canada), Manaus, Santiago",v:"-4_1"},{n:"(GMT-03:00)Buenos Aires, Georgetown",v:"-3_0"},{n:"(GMT-03:00)Greenland, Brasilia, Montevideo",v:"-3_1"},{n:"(GMT-02:00)Mid-Atlantic",v:"-2_1"},{n:"(GMT-01:00)Azores, Cape Verde Is.",v:"-1_1"},{n:"(GMT 00:00)Casablanca, Monrovia, Reykjavik",v:"0_0"},{n:"(GMT 00:00)GMT: Dublin, Edinburgh, Lisbon, London",v:"0_1"},{n:"(GMT+01:00)West Central Africa",v:"1_0"},{n:"(GMT+01:00)Amsterdam, Berlin, Rome, Vienna, Prague, Brussels",v:"1_1"},{n:"(GMT+02:00)Harare, Pretoria",v:"2_0"},{n:"(GMT+02:00)Amman, Athens, Istanbul, Beirut, Cairo, Jerusalem",v:"2_1"},{n:"(GMT+03:00)Kuwait, Riyadh, Nairobi, Tbilisi",v:"3_0"},{n:"(GMT+03:00)Baghdad, Moscow, St. Petersburg, Volgograd",v:"3_1"},{n:"(GMT+04:00)Abu Dhadi, Muscat",v:"4_0"},{n:"(GMT+04:00)Baku, Yerevan",v:"4_1"},{n:"(GMT+05:00)Islamabad, Karachi, Tashkent",v:"5_0"},{n:"(GMT+05:00)Ekaterinburg",v:"5_1"},{n:"(GMT+06:00)Astana, Dhaka",v:"6_0"},{n:"(GMT+06:00)Almaty, Nonosibirsk",v:"6_1"},{n:"(GMT+07:00)Bangkok, Hanoi, Jakarta",v:"7_0"},{n:"(GMT+07:00)Krasnoyarsk",v:"7_1"},{n:"(GMT+08:00)Beijing, Hong Kong, Singapore, Taipei",v:"8_0"},{n:"(GMT+08:00)Irkutsk, Ulaan Bataar, Perth",v:"8_1"},{n:"(GMT+09:00)Seoul, Osaka, Sapporo, Tokyo",v:"9_0"},{n:"(GMT+09:00)Yakutsk",v:"9_1"},{n:"(GMT+10:00)Brisbane, Guam, Port Moresby",v:"10_0"},{n:"(GMT+10:00)Canberra, Melbourne, Sydney, Hobart, Vladivostok",v:"10_1"},{n:"(GMT+11:00)Magadan, Solomon Is., New Caledonia",v:"11_0"},{n:"(GMT+12:00)Fiji, Kamchatka, Marshall Is.",v:"12_0"},{n:"(GMT+12:00)Auckland, Wellington",v:"12_1"},{n:"(GMT+13:00)Nuku'alofa",v:"13_0"}];function D(){var Q=[],P,R;Q.push({n:"12:00AM",v:"12:00AM"});for(P=1;P<=11;P++){R=P+":00AM";Q.push({n:R,v:R});}Q.push({n:"12:00PM",v:"12:00PM"});for(P=1;P<=11;P++){R=P+":00PM";Q.push({n:R,v:R});}return Q;}var I=[mstrmojo.desc(9380),mstrmojo.desc(9381),mstrmojo.desc(9382),mstrmojo.desc(9383),mstrmojo.desc(9384),mstrmojo.desc(9385),mstrmojo.desc(9379)];function M(){var Q=[],P=0,R;for(;P<7;P++){R=I[P];Q.push({n:R,v:P});}return Q;}function C(){return[{n:"1st",v:"1"},{n:"15th",v:"15"}];}function N(){var Q=new Date(),P=new Date(Q.getFullYear(),0,1,0,0,0,0),V=new Date(Q.getFullYear(),6,1,0,0,0,0),W=P.toGMTString(),X=new Date(W.substring(0,W.lastIndexOf(" ")-1));W=V.toGMTString();var U=new Date(W.substring(0,W.lastIndexOf(" ")-1)),S=(P-X)/(1000*60*60),R=(V-U)/(1000*60*60),T=(S==R)?"0":"1";if(S-R>=0){S=R;}return S+"_"+T;}function A(T,X,R,S){var P=mstrmojo.desc(10155)+' <span class="mstrmojo-SREditor-timeHilight">',U=function(a,b){var Z=parseInt(a),Y=0;if(a=="12:00AM"){Z=0;}else{if(a=="12:00PM"){Z=12;}else{if(a.contains("PM")){Z+=12;}}}Z+=parseInt(b);if(Z>36){a=(Z-36)+":00PM";Y=1;}else{if(Z==36){a="12:00PM";Y=1;}else{if(Z>24&&Z<36){a=(Z-24)+":00AM";Y=1;}else{if(Z==24){a="12:00AM";Y=1;}else{if(Z>12&&Z<24){a=(Z-12)+":00PM";}else{if(Z==12){a="12:00PM";}else{if(Z>0&&Z<12){a=Z+":00AM";}else{if(Z==0){a="12:00AM";}else{if(Z>-12&&Z<0){a=(12+Z)+":00PM";Y=-1;}else{if(Z==-12){a="12:00PM";Y=-1;}else{if(Z>-24&&Z<-12){a=(-12-Z)+":00AM";Y=-1;}}}}}}}}}}}return{t:a,dd:Y};},V=U(R,S);switch(X){case"Daily":P+=mstrmojo.desc(9386,"every day");break;case"Weekday":P+=mstrmojo.desc(9387,"every weekday");break;case"Weekly":P+=mstrmojo.desc(10156)+" "+I[(T.schedules.wday.selectedItem.v+V.dd+7)%7];break;case"Monthly":var W=parseInt(T.schedules.mday.selectedItem.v)+V.dd,Q={"0":"last","1":"1st","2":"2nd","14":"14th","15":"15th","16":"16th"}[W];P+=mstrmojo.desc(9688)+" "+Q+" "+mstrmojo.desc(10157);break;}if(S>0){S="+"+S;}S+=":00";P+=" at "+V.t+"</span> "+mstrmojo.desc(10158)+":";return P;}var J=N(),B=D(),F=M(),L=C(),O={DAILY:"Daily",WEEKDAY:"Weekday",WEEKLY:"Weekly",MONTHLY:"Monthly"};function E(Q,P){return{slot:Q,scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-SREditor-tzPrev",bindings:{visible:function(){var R=this.parent.parent.stp;return R==P;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"preview-text",bindings:{text:function(){var V=this.parent.parent.parent,R=this.parent.parent.parent.stp,U=this.parent.parent.parent.time,S=this.parent.parent.parent.day,T=this.parent.parent.parent.date,W=this.parent.parent.parent.rrtz||mstrApp.rrtz||J;return A(V,R,U,parseInt(W));}}},{alias:"timezone",scriptClass:"mstrmojo.Pulldown",popupCssClass:"timezone-pulldown",items:null,itemIdField:"v",bindings:{value:function(){return this.parent.parent.parent.rrtz||mstrApp.rrtz||J;}},onvalueChange:function(){this.parent.parent.parent.set("rrtz",this.value);},onRender:function(){var R=this.value;this.set("items",G);this.set("value",R);}}]};}function K(P){return mstrmojo.array.filter(P,function(Q){return Q.isSubscribable;});}mstrmojo.SREditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SREditor",cssClass:"rrEditor rrEditor-defaultTitleSpacer mstrmojo-SREditor",cssText:"position:absolute;",zIndex:10,title:mstrmojo.desc(10160),cubeID:"",stp:"",day:"",date:"",time:"1:00AM",trgNm:null,showNote:true,subsID:null,obj:null,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11245,"Please note that only <# of # dataset> can be scheduled."),cssClass:"rrEditor-cubeType",alias:"sWarning",visible:false,cubes:[],setScheduleWarningText:function(){if(this.parent.obj===null){return ;}this.set("visible",false);var T=this,S=T.parent.obj,R=S.ds,Q=function(){var V=K(R);if(V.length!==R.length){var U=mstrmojo.desc(11245,"Please note that only <# of # dataset> can be scheduled.");U=U.replace("#",V.length).replace("#",R.length);U=U.replace(">","</a>");U=U.replace("<",'<a href="#" onclick="return false;" style="font-weight: bold;">');T.set("text",U);T.set("visible",true);}};if(R===undefined||R.length===0){var P={success:function(U){S.ds=transDatasets(U.ds);R=S.ds;Q();},failure:function(U){rrAlert(U.getResponseHeader("X-MSTR-TaskFailureMsg"));}};mstrmojo.xhr.request("POST",mstrApp.taskURL,P,{taskId:"getDashboardRefreshHistory",docID:S.did,recentN:5});}else{Q();}},onclick:function(T){if(T.e.target.tagName==="A"){var P=this.parent.obj.ds,S="datasetDetail",Q=mstrmojo.all,R=Q[S];if(R){R.set("datasets",P);}else{R=new mstrmojo.RRDatasetDetail({datasets:P});}R.open();}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-SREditor-header",bindings:{text:"this.parent.headerText"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-SREditor-note",text:mstrmojo.desc(11373,"NOTE: All schedules are defined in <Greenwich Mean Time (GMT)>. Once you select a schedule, a preview box displays the equivalent time in your local time zone.").replace(/<(.*?)>/,'<span class="mstrmojo-SREditor-timeHilight">$1</span>'),bindings:{visible:"this.parent.showNote"}},{alias:"schedules",scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-SREditor-scheduleTable",layout:[{cells:[{cssClass:"schedule-type"},{colSpan:2}],cssClass:"mstrmojo-SREditor-rowSpace"},{cells:[{colSpan:3}]},{cells:[{cssClass:"schedule-type"},{colSpan:2}],cssClass:"mstrmojo-SREditor-rowSpace"},{cells:[{colSpan:3}]},{cells:[{cssClass:"schedule-type"},{cssText:"width:143px"},{}],cssClass:"mstrmojo-SREditor-rowSpace"},{cells:[{colSpan:3}]},{cells:[{cssClass:"schedule-type"},{cssText:"width:143px"},{}],cssClass:"mstrmojo-SREditor-rowSpace"},{cells:[{colSpan:3}]},{cells:[{colSpan:3}]}],children:[{alias:"daily",slot:"0,0",scriptClass:"mstrmojo.RadioButton",cssClass:"mstrmojo-SREditor-radio",label:mstrmojo.desc(10639,"Daily"),tp:O.DAILY,bindings:{checked:function(){var P=this.parent.parent.stp,Q=this.tp;return P==Q;}},oncheckedChange:function(){if(this.checked){this.parent.parent.set("stp",this.tp);}}},{alias:"dtime",slot:"0,1",scriptClass:"mstrmojo.ui.Pulldown",hostedCSSClass:"hour-pulldown",popupCssClass:"hour-pulldown",cssText:"width:123px;",items:B,bindings:{visible:function(){return this.parent.daily.checked;}},preBuildRendering:function(){var P=H.find(this.items,this.itemIdField,this.parent.parent.time);if(P>=0){this.set("selectedIndex",P);}},itemIdField:"v",postselectedIndexChange:function(P){var Q=this.items[P.value];this.parent.parent.set("time",Q.v);}},E("1,0",O.DAILY),{alias:"weekday",slot:"2,0",scriptClass:"mstrmojo.RadioButton",cssClass:"mstrmojo-SREditor-radio",label:mstrmojo.desc(10159,"Weekday"),tp:O.WEEKDAY,bindings:{checked:function(){var P=this.parent.parent.stp,Q=this.tp;return P==Q;}},oncheckedChange:function(){if(this.checked){this.parent.parent.set("stp",this.tp);}}},{alias:"wdtime",slot:"2,1",scriptClass:"mstrmojo.ui.Pulldown",popupCssClass:"hour-pulldown",cssText:"width:123px;",items:B,bindings:{visible:function(){return this.parent.weekday.checked;}},preBuildRendering:function(){var P=H.find(this.items,this.itemIdField,this.parent.parent.time);if(P>=0){this.set("selectedIndex",P);}},itemIdField:"v",postselectedIndexChange:function(P){var Q=this.items[P.value];this.parent.parent.set("time",Q.v);}},E("3,0",O.WEEKDAY),{alias:"weekly",slot:"4,0",scriptClass:"mstrmojo.RadioButton",cssClass:"mstrmojo-SREditor-radio",label:mstrmojo.desc(9705,"Weekly"),tp:O.WEEKLY,bindings:{checked:function(){var P=this.parent.parent.stp,Q=this.tp;return P==Q;}},oncheckedChange:function(){if(this.checked){this.parent.parent.set("stp",this.tp);}}},{alias:"wday",slot:"4,1",scriptClass:"mstrmojo.ui.Pulldown",cssText:"width:123px;",items:F,bindings:{visible:"this.parent.weekly.checked"},preBuildRendering:function(){var P=H.find(this.items,this.itemIdField,this.parent.parent.day);if(P>=0){this.set("selectedIndex",P);}},itemIdField:"v",postselectedIndexChange:function(P){var Q=this.items[P.value];this.parent.parent.set("day",Q.v);}},{alias:"wtime",slot:"4,2",scriptClass:"mstrmojo.ui.Pulldown",popupCssClass:"hour-pulldown",cssText:"width:123px;",items:B,bindings:{visible:"this.parent.weekly.checked"},preBuildRendering:function(){var P=H.find(this.items,this.itemIdField,this.parent.parent.time);if(P>=0){this.set("selectedIndex",P);}},itemIdField:"v",postselectedIndexChange:function(P){var Q=this.items[P.value];this.parent.parent.set("time",Q.v);}},E("5,0",O.WEEKLY),{alias:"monthly",slot:"6,0",scriptClass:"mstrmojo.RadioButton",cssClass:"mstrmojo-SREditor-radio",label:mstrmojo.desc(9704,"Monthly"),tp:O.MONTHLY,bindings:{checked:function(){var P=this.parent.parent.stp,Q=this.tp;return P==Q;}},oncheckedChange:function(){if(this.checked){if(this.domNode){this.parent.parent.set("stp",this.tp);}}}},{alias:"mday",slot:"6,1",scriptClass:"mstrmojo.ui.Pulldown",cssText:"width:123px;",items:L,bindings:{visible:"this.parent.monthly.checked"},itemIdField:"v",preBuildRendering:function(){var P=H.find(this.items,this.itemIdField,this.parent.parent.date);if(P>=0){this.set("selectedIndex",P);}},postselectedIndexChange:function(P){var Q=this.items[P.value];this.parent.parent.set("date",Q.v);}},{alias:"mtime",slot:"6,2",scriptClass:"mstrmojo.ui.Pulldown",popupCssClass:"hour-pulldown",cssText:"width:123px;",items:B,visible:false,bindings:{visible:"this.parent.monthly.checked"},itemIdField:"v",preBuildRendering:function(){var P=H.find(this.items,this.itemIdField,this.parent.parent.time);if(P>=0){this.set("selectedIndex",P);}},postselectedIndexChange:function(P){var Q=this.items[P.value];this.parent.parent.set("time",Q.v);}},E("7,0",O.MONTHLY),{alias:"daylightLabel",slot:"8,0",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-DayLightLabel",text:mstrmojo.desc(10163),bindings:{visible:function(){var P=this.parent.parent.stp;return P===O.DAILY||P===O.WEEKDAY||P===O.WEEKLY||P===O.MONTHLY;},}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton ok hot",text:mstrmojo.desc(1442,"OK"),bindings:{enabled:"this.parent.parent.stp"},onclick:function(P){var Q=this.parent.parent.rrtz;if(Q&&(Q!=mstrApp.rrtz)){if(typeof rrCreateCookie==="function"){rrCreateCookie("rrtz",Q);}mstrApp.rrtz=Q;}this.parent.parent.onOK();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(P){var Q=this.parent.parent;if(Q.onCancel){Q.onCancel();}Q.close();}}]}],onOpen:function(){this.sWarning.setScheduleWarningText();var Q=this.trgNm&&mstrmojo.string.trim(this.trgNm.toUpperCase()).split(" ");if(Q&&Q.length>=2){switch(Q[0]){case"DAILY":this.set("stp",O.DAILY);this.set("time",Q[1]);break;case"WEEKDAY":this.set("stp",O.WEEKDAY);this.set("time",Q[1]);break;case"WEEKLY":var P=function(T){var R=0,S=I.length;for(;R<S;R++){if(I[R].toUpperCase()==T){break;}}return R;};this.set("stp",O.WEEKLY);this.set("day",P(Q[1]));this.set("time",Q[2]);break;case"MONTHLY":this.set("stp",O.MONTHLY);this.set("date",Q[1]);this.set("time",Q[2]);break;default:rrAlert(mstrmojo.desc(10164));this.close();}}},onOK:function(){var T=this,S=T.obj,R=S.ds,U={taskId:"saveRefreshSchedule",triggerName:this.getTrgName()};var V=function(Z,Y,X){var W=[];mstrmojo.array.forEach(Z,function(a){W.push(a[Y]);});return W.join(X);};var Q=function(){waitCurtain.open();mstrmojo.xhr.request("POST",mstrApp.taskURL,{success:function(W){T.obj.set("af",W.subs);T.close();},failure:function(W){T.close();if(W.getResponseHeader("X-MSTR-TaskErrorCode")==="-2147050197"){rrAlert(mstrmojo.desc(11605,"In order to set a schedule for automatically refreshing this dashboard please click on the Refresh Now option under Refresh Data menu. Once you have finished refreshing all your datasets, please click on the Set Schedule option again."));}else{rrAlert(W.getResponseHeader("X-MSTR-TaskFailureMsg"));}},complete:function(){waitCurtain.close();}},U);};if(S.af&&S.af.length>0){U.subscriptionID=V(S.af,"subID",",");Q();}else{if(S.ds&&S.ds.length>0){U.contentID=V(K(S.ds),"cubeID",",");Q();}else{var P={success:function(W){S.ds=transDatasets(W.ds);U.contentID=V(K(S.ds),"cubeID",",");Q();},failure:function(W){rrAlert(W.getResponseHeader("X-MSTR-TaskFailureMsg"));}};mstrmojo.xhr.request("POST",mstrApp.taskURL,P,{taskId:"getDashboardRefreshHistory",docID:S.did,recentN:1});}}},onClose:function(){var P=new Array(),Q=window.location.href;P[0]="state";P[1]="code";url=removeUrlParams(Q,P);if(Q!=url){window.location.href=url;}},getTrgName:function(){var P=this.schedules;switch(this.stp){case"Daily":return mstrmojo.desc(10639,"Daily")+" "+P.dtime.items[P.dtime.selectedIndex].v;case"Weekday":return mstrmojo.desc(10159,"Weekday")+" "+P.wdtime.items[P.wdtime.selectedIndex].v;case"Weekly":return mstrmojo.desc(9310,"Weekly")+" "+P.wday.items[P.wday.selectedIndex].n+" "+P.wtime.items[P.wtime.selectedIndex].v;case"Monthly":return mstrmojo.desc(9704,"Monthly")+" "+P.mday.items[P.mday.selectedIndex].v+" "+P.mtime.items[P.mtime.selectedIndex].v;default:return this.stp;}},getTrgDefinition:function(){var P=this.schedules;switch(this.stp){case"Daily":return this.stp+" "+P.dtime.selectedIndex;case"Weekday":return this.stp+" "+P.wdtime.selectedIndex;case"Weekly":return this.stp+" "+P.wday.selectedIndex+" "+P.wtime.selectedIndex;case"Monthly":return this.stp+" "+P.mday.selectedIndex+" "+P.mtime.selectedIndex;default:return this.stp;}}});})();(function(){var H=mstrmojo.array,A={NONE:0,EDIT:1,DELETE:2};function E(L,J){var K=this.data,I=(K&&K.length)?K[0]:K;return(I&&I[L])?I[L](K,J):true;}mstrmojo.qb.menu.SimpleGridMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.menu.SimpleGridMenu",dynamicUpdate:true,queryEnabled:function G(I){return E.call(this,"isEnabled",I);},queryVisible:function D(I){return E.call(this,"isVisible",I);},queryChecked:function C(I){return E.call(this,"isChecked",I);},executeCommand:function B(J){var K=this.data,I=mstrApp.getRootController();switch(J.action){case A.EDIT:I.editColumn(K);break;case A.DELETE:I.deleteColumn(K);break;}},getMenuConfig:function F(I){var L=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-qb-simplegrid-menu"}),K=I||this.cm,J=this;H.forEach(K,function(N){if(this.queryVisible(N)){var M=["xt "+(N.icn||"")],O=function O(){J.executeCommand(N);};L.addMenuItem(N.n||"",M.join(" "),O);}},this);return L;},cm:[{action:A.EDIT,n:mstrmojo.desc(1088,"Edit"),icn:"edit"},{action:A.DELETE,n:mstrmojo.desc(629,"Delete"),icn:"del"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.requiresDescs(2131,2122,2127,2125,2123,9938,2219,2220,520,612,521,523,522,524,525,526,686,2784,687,2785,688,2786,696,746,7555,13083,13084,4561,12939,12940,7227,13387,12078,12736);function L(t,n,q,AE,u,AB,o){var x=u?"height:"+u+"px;":"";var AA=AB?"width:"+AB+"px;":"",AD=q[1],z="";var AC='<div class="mstrmojo-qb-DBTableRow-bullet" style="'+x+AA+'">';if(AD==="tick"||AD==="mix"){z='style="font-weight: bold;"';AD=(AD==="tick")?0:16;}AC+='<div class="icon t'+AD+'"></div>';AC+='<div class="text" '+z+">"+t+"</div>";if(o&&o.length){for(var p=0;p<o.length;p++){AC+='<div class="cxtmenu '+o[p].n+'"></div>';}}AC+="</div></div>";return AC;}var I=mstrmojo.dom,F=mstrmojo.global.document,c=mstrmojo.array,J=mstrmojo.desc;var D,g,A;var a;function h(p,n,o){if(o!=null){g.innerHTML=o;}A.left=p.x+"px";A.top=p.y+"px";}function P(n,o){if(!D){D=F.createElement("div");A=D.style;A.position="absolute";A["z-index"]=9999;D.className="mstrmojo-qb-TableRow-avatar";D.innerHTML="<div></div>";g=D.firstChild;F.body.appendChild(D);}h(o,true,n);A.display="block";}function e(){if(D){A.display="none";}}function Z(o,n,q){if(!o.domNode){return false;}var p=I.position(o.domNode,true);return((p.y<=q)&&(p.x<=n)&&(p.x+p.w>=n)&&(p.y+p.h>=q));}function Y(p,n,u){var q=document.elementFromPoint(n,u);var o=I.findWidget(q);while(o){if(o.dropZone){if(o.allowDrop&&o.allowDrop(p)){return o;}}o=o.parent;}return null;}mstrmojo.qb.DBTableRow=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.DBTableRow",indent:0,text:"",checkBox:false,draggable:true,ownAvatar:true,dropZone:true,cxtmenus:null,allowDrop:function C(n){return true;},ondrop:function b(q){var p=q.src.widget,n=q.tgt.widget,o=mstrmojo.all.QBuilderModel;if(p.domNode.className.indexOf("mstrmojo-qb-DBTableRow")<0){return ;}if(p.srcID==n.srcID){return ;}if(o.joinsInfo[p.srcID+n.srcID]){o.addLink(p,n,p.srcID+n.srcID);}else{if(o.joinsInfo[n.srcID+p.srcID]){o.addLink(n,p,n.srcID+p.srcID);}else{o.addJoin(p,n,0,null);}}},_leftPos:0,_topPos:0,movable:false,dropTarget:null,markupString:'<div id="{@id}" class="mstrmojo-qb-DBTableRow {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,contextmenu></div>',markupMethods:{ontextChange:function(){this.domNode.innerHTML=L(this.text,this.indent,this.images,this.selected,null,null,this.cxtmenus);},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,oncssClassChange:function U(){this.domNode.className="mstrmojo-qb-DBTableRow "+(this.cssClass||"");}},getDragData:function(o){var n={};if(this.domNode){n.html=L(this.text,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth);n.n=this.text;}return n;},isDragValid:function S(n){return I.contains(this.domNode,n.src.node,true,document.body);},ondragstart:function(n){if(I.isWK){document.onselectstart=function(o){o.preventDefault();return false;};}this.domNode.style.cssText="opacity:0.3; filter: alpha(opacity=30);";a=I.position(this.domNode);P(L(this.text,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth),a);},ondragmove:function(o){var n=o.tgt.pos;h({x:n.x+5,y:n.y+5},true,L(this.text,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth));},ondragend:function(){if(I.isWK){document.onselectstart=function(){return true;};}if(this.domNode){this.domNode.style.cssText="opacity:1; filter: alpha(opacity=100);";}e();},onclick:function(o){var n=o.hWin,p=o.e||n.event,q=p.target||p.srcElement;if(q.type==="checkbox"){if(this.onCheck){this.onCheck(q.checked);}}},postBuildRendering:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-D",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPRIGHT,content:this.rIndex>=0?this.text:mstrmojo.desc(12736,"Add all columns")});if(!this._ontooltipover){var n=this.id;this._ontooltipover=function(p){var o=mstrmojo.all[n];o.showTooltip(p,self);};this._ontooltipout=function(p){var o=mstrmojo.all[n];o.hideTooltip(p,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return this._super();}});var W=[{n:J(2131,"Sum"),idx:1},{n:J(2122,"Average"),idx:2},{n:J(2127,"Minimum"),idx:3},{n:J(2125,"Maximum"),idx:4},{n:J(2123,"Count"),idx:5},{n:J(9938,"Count Distinct"),idx:6}];var d={SEPARATOR:-1,IN_LIST:0,NOT_IN_LIST:1,EXACTLY:2,NOT_EXACTLY:3,GREATER_THAN:4,LESS_THAN:5,GREATER_THAN_EQ:6,LESS_THAN_EQ:7,LIKE:8,NOT_LIKE:9,CONTAIN:10,NOT_CONTAIN:11,BEGIN_WITH:12,NOT_BEGIN_WITH:13,END_WITH:14,NOT_END_WITH:15,BETWEEN:16,NOT_BETWEEN:17},K={0:{did:2219,n:J(2219,"In list")},1:{did:2220,n:J(2220,"Not in list")},2:{did:520,n:J(520,"Exactly")},3:{did:612,n:J(612,"Not Exactly")},4:{did:521,n:J(521,"Greater than")},5:{did:523,n:J(523,"Less than")},6:{did:522,n:J(522,"Greater than equal")},7:{did:524,n:J(524,"Less than equal")},8:{did:525,n:J(525,"Like")},9:{did:526,n:J(526,"Not like")},10:{did:686,n:J(686,"Contains")},11:{did:2784,n:J(2784,"Does not contain")},12:{did:687,n:J(687,"Begins with")},13:{did:2785,n:J(2785,"Does not begin with")},14:{did:688,n:J(688,"Ends with")},15:{did:2786,n:J(2786,"Does not end with")},16:{did:"Between",n:J(696,"Between")},17:{did:"Not between",n:J(746,"Not between")}};var B=[d.IN_LIST,d.NOT_IN_LIST,d.SEPARATOR,d.EXACTLY,d.NOT_EXACTLY,d.SEPARATOR,d.GREATER_THAN,d.LESS_THAN,d.SEPARATOR,d.LIKE,d.NOT_LIKE],f=[d.IN_LIST,d.NOT_IN_LIST,d.SEPARATOR,d.EXACTLY,d.NOT_EXACTLY],V=[d.GREATER_THAN,d.LESS_THAN,d.SEPARATOR,d.GREATER_THAN_EQ,d.LESS_THAN_EQ,d.SEPARATOR,d.BETWEEN,d.NOT_BETWEEN],k=[d.LIKE,d.NOT_LIKE,d.SEPARATOR,d.CONTAIN,d.NOT_CONTAIN,d.SEPARATOR,d.BEGIN_WITH,d.NOT_BEGIN_WITH,d.SEPARATOR,d.END_WITH,d.NOT_END_WITH];mstrmojo.qb.DBTableRowMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.DBTableRowMenu",menuCssClass:"mstrmojo-qb-DBTableRowMenu",menuCfg:null,tableRow:null,handleAddColumn:function T(q){var n=this.tableRow,t=[n],p,o=mstrApp.getRootController(),u;p=o.gettIndex(n.parent.parent.id);u={success:function(){n.updateState(1);n.count++;}};o.addSelectedColumns(t,p,null,u);return true;},handleAddExpression:function m(p){var o=this.tableRow,n=0;mstrApp.getRootController().openExpressionEditor({type:n,w:o,tkn:o.expr});return true;},handleAddAggrColumn:function E(t){var o=t.ctxt,n=this.tableRow,w=o.aggrFuncIdx,u=[n],q,p=mstrApp.getRootController(),x;q=p.gettIndex(n.srcID);x={success:function(){if(n.state==0||n.state==2){n.state++;n.images[1]=n.img[n.state];n.render();}n.count++;}};p.addSelectedColumns(u,q,w,x);return true;},handleAddFuncExpr:function O(p){var n=p.ctxt,o=this.tableRow;mstrApp.getRootController().openExpressionEditor({type:0,selFuncItem:n,w:o});},getSubMenuConfigComFuncs:function X(n){var o=new mstrmojo.ui.menus.MenuConfig(),q,p=this;q=function(t){p.handleAddAggrColumn(t);};c.forEach(W,function(t){if(t.idx==6&&mstrApp.getRootController()&&mstrApp.getRootController().isBDE&&mstrApp.getRootController().isBDE==true){o.addDisabledMenuItem(t.n,"");}else{o.addMenuItem(t.n,"",q,{aggrFuncIdx:t.idx});}});return o;},getSubMenuConfigFuncs:function H(n){var p=new mstrmojo.ui.menus.MenuConfig(),w=this.id,q,t=this,o,u;q=function(x){t.handleAddFuncExpr(x);};if(!n){o=mstrApp.getRootController().getFunctionList();u=1;}else{o=n.funcList;u=n.depth;}c.forEach(o,function(x){if(x.fns&&x.fns.length){p.addSubMenuItem(x.n,"depth"+u.toString(),w,this.getSubMenuConfigFuncs,{funcList:x.fns,depth:u+1});}else{p.addMenuItem(x.n,"",q,x);}},this);return p;},handleAddFilter:function M(AB){var u=AB.ctxt,o=this.tableRow,n=u.opID,q=o.dt.tp,x={14:true,15:true,16:true},AA={30:true},t={8:true,9:true,10:true,17:true,18:true,33:true},w,p,z;mstrApp.getRootController().openConditionDialog();switch(n){case K[d.BETWEEN].did:case K[d.NOT_BETWEEN].did:z=2;break;default:z=1;}p="mstr-qb-fve";w=mstrmojo.all[p]||(new mstrmojo.qb.FilterValueEditor({id:p,zIndex:1000}));w.n=AB.n;w.operatorID=n;w.column=o.oriexpr;w.isDateTime=!!x[q];w.isBigDecimal=!!AA[q];w.isString=!!t[q];w.paraNum=z;w.open();},getSubMenuConfigClauses:function Q(t,n){var o=new mstrmojo.ui.menus.MenuConfig(),p,w=this,u,q;p=function(x){w.handleAddFilter(x);};switch(t){case"common":q=B;break;case"basic":q=f;break;case"numeric":q=V;break;case"string":q=k;break;}c.forEach(q,function(x){if(x===d.SEPARATOR){o.addSeparator();}else{u=K[x];o.addMenuItem(u.n,"",p,{opID:u.did});}});return o;},getSubMenuConfigComClauses:function G(n){return this.getSubMenuConfigClauses("common",n);},getSubMenuConfigAllClauses:function N(n){var o=new mstrmojo.ui.menus.MenuConfig(),p=this.id;o.addSubMenuItem(J(7227,"Basic"),"",p,this.getSubMenuConfigAllClausesBasic,n);o.addSubMenuItem(J(13387,"Comparison"),"",p,this.getSubMenuConfigAllClausesNumeric,n);o.addSubMenuItem(J(12078,"Pattern"),"",p,this.getSubMenuConfigAllClausesString,n);return o;},getSubMenuConfigAllClausesBasic:function R(n){return this.getSubMenuConfigClauses("basic",n);},getSubMenuConfigAllClausesNumeric:function j(n){return this.getSubMenuConfigClauses("numeric",n);},getSubMenuConfigAllClausesString:function l(n){return this.getSubMenuConfigClauses("string",n);},getMenuConfig:function(){var o=this.menuCfg,t=this.id,n,p,q=this;if(!o){o=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{o.clear();}n=function(u){q.handleAddColumn(u);};p=function(u){q.handleAddExpression(u);};o.addMenuItem(J(7555,"Add Column"),"",n);if(q.tableRow.enableExpr){o.addMenuItem(J(13083,"Edit Column"),"",p);}o.addSeparator();o.addSubMenuItem(J(13084,"Basic Functions"),"",t,this.getSubMenuConfigComFuncs);o.addSubMenuItem(J(4561,"All Functions"),"",t,this.getSubMenuConfigFuncs);o.addSeparator();o.addSubMenuItem(J(12939,"Basic Filters"),"",t,this.getSubMenuConfigComClauses);o.addSubMenuItem(J(12940,"All Filters"),"",t,this.getSubMenuConfigAllClauses);return o;}});})();(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.array","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._Formattable","mstrmojo._IsDocumentTemplate","mstrmojo.Label","mstrmojo.ui.menus.MenuConfig");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVisualizationTemplates","EnumVizStyles","EnumWidgetTypes");var T={top:"top",left:"left","z-index":"zIndex",width:"width",height:"height"};var D=["background-color","fx"],I=mstrmojo.array;mstrmojo.VisBase=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._Formattable,mstrmojo._IsDocumentTemplate],{scriptClass:"mstrmojo.VisBase",updated:false,waitingForData:false,node:null,skipReRender:false,updateFormatsOnUpdate:true,setModel:function M(Z){this.set("model",Z);},destroy:function W(){var Z=this.model;if(Z&&Z.destroy){Z.destroy();delete this.model;}this._super();},resize:function X(){var Z=this.getFormats();if(parseInt(Z.height,10)===0||parseInt(Z.width,10)===0){this.domNode.style.display="none";}else{this.setDimensions(Z.height,Z.width);this.domNode.style.display="";}},setDimensions:function O(b,a){var Z=this._super(b,a);if(Z&&this.hasRendered&&!this.skipReRender){this.reRender();}return Z;},reRender:function F(){this.unrender();this.render();},getWidth:function B(){return parseInt(this.width,10);},getHeight:function K(){return parseInt(this.height,10);},getLeft:function R(){return parseInt(this.left,10);},getTop:function A(){return parseInt(this.top,10);},buildRendering:function H(){this.height=this.getHeight();this.width=this.getWidth();this.left=this.getLeft();this.top=this.getTop();if(!this.updated){this.update();}this._super();},initFromVisProps:function V(){},postBuildRendering:function(){var Z=this.isEmpty();this._super();this.raiseEvent({name:"toggleCtrlOverlay",visible:Z,controls:this.getVisEmptyMsgControls()});this.applyBackground();return !Z;},applyBackground:function(){var a=this.defn&&this.defn.fmts,f=(a&&a.p_fmts)||a,c={},d,Z,e,b;if(mstrApp.isExpress&&f){d=this.formatHandlers=this.formatHandlers||{};e=d.domNode=d.domNode||[];Z="BG";b=I.indexOf(e,Z);if(b<0){e.push(Z);}I.forEach(D,function(g){if(f[g]){c[g]=f[g];}});this.applyCSSFormatToNode("domNode",c);}},update:function G(c){c=c||this.node;if(c){var Z=c.data;if(Z){this.model.set("data",Z);}this.waitingForData=!!Z.nsj;if(this.waitingForData){var a="ServerJsonRWDStyle";var d=this.model,b=d.getDataService(),e={host:this,nodes:[this.k]},g;if(Z.wid!==undefined){e.slices=[Z.wid];}g=mstrmojo.func.wrapMethods(d.docModel.getUpdateColorMapCallback(),d.docModel.getUpdateThemePaletteCallback(true),d.controller._getXtabCallback(this));b.retrieveServerJson(e,g,{preserveUndo:true,style:{name:a,params:{treesToRender:3}},params:{styleName:a}});this.updated=true;return false;}this.updateContentFormats(c);}if(this.model){var h=this.model&&this.model.docModel;this.initFromVisProps(this.model.vp);if(h&&h.getDocBuilder){var f=h.getDocBuilder().getMojoVisName(c);if(f){c.data.visName=f;}}}this.updated=true;if(this._super){return this._super(c);}return true;},updateContentFormats:function(e){var d=this.parent,c=e.defn,Z=c&&c.fmts;if(this.updateFormatsOnUpdate&&Z){if(this.clearFormats){this.clearFormats();}if(d&&d._createFormats&&!Z.p_fmts){d._createFormats();}Z=(this.getFormats&&this.getFormats())||Z;for(var b in T){if(T.hasOwnProperty(b)){var a=T[b];if(b in Z){this[a]=Z[b];}}}}},isEmpty:function L(){return false;},getVisEmptyMsgControls:function C(){return[{scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:mstrmojo.desc(11668,"Drag objects here.")}];},getModel:function N(){return this.model;},getData:function J(){return this.model.data;},getRowsAndCols:function(){var Z=this.model.data.gts;return(Z.row||[]).concat(Z.col||[]);},getExp:function(){var Z=this.model.data,a=Z&&Z.sc&&Z.sc.exp;return a;},getDocModel:function S(){return this.model&&this.model.docModel;},getTitleRMCPopup:mstrmojo.emptyFn,getMenuHandler:function U(){return mstrmojo.emptyFn;},renderErrorMessage:function Y(Z){this.domNode.innerHTML='<div class="mstrmojo-message">'+Z+"</div>";},getMessageID:function E(){return this.model.docModel.mid||this.model.mid;},performAction:function Q(Z){var b=this.model.getAction(Z),a=b&&b.h;if(a&&this.controller[a]){this.controller[a](this,b.a);return true;}return false;},findSelectorControl:function P(){var a=this.getData(),Z=a&&a.sc;if(Z&&parseInt(Z.ct,10)===6){this.selectorControl=Z;this.isMultiSelect=true;}else{delete this.selectorControl;}return this.selectorControl;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.MenuConfig");var D=mstrmojo.string,A=mstrmojo.dom,E=mstrmojo.ui.PopupConfig.ENUM_CORNERS;function B(){var K=this,J=K.statusList,F=J&&J.length||0,G=K.statusConfig||new mstrmojo.ui.menus.MenuConfig(),L=function(M){return function(N){K.set("status",M);K.onStatusClick(M);};};if(!G.hasMenuItems()&&F){for(var H=0;H<F;H++){var I=J[H];G.addMenuItem(I.n,I.cls||"",L(I),K);}}else{}if(G.hasMenuItems()){G.alignment=K.alignment||{host:E.BOTTOM_LEFT,popup:E.TOP_LEFT};G.hostId=K.id;G.hostElement=K[K.hostElementName]||K.domNode;K.openPopup(G.newInstance());}}function C(){var F=this.statusConfig||this.statusList&&this.statusList.length>1;this.menuButtonNode.style.display=F?"":"none";}mstrmojo.ui.StatusButton=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.ui.StatusButton",markupString:'<div id="{@id}" class="mstrmojo-StatusButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}"><div class="mstrmojo-Button {@innerIconClass}"  mstrAttach:click><span class="mstrmojo-text"></span></div><div class="menuButton" mstrAttach:click></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},textSpanNode:function(){return this.domNode.firstChild.firstChild;},menuButtonNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onstatusChange:function(){this.textSpanNode.innerHTML=D.encodeHtmlString(this.status&&this.status.n||"");},onstatusListChange:function(){C.call(this);},onstatusConfigChange:function(){C.call(this);}},status:null,statusList:null,statusConfig:null,onclick:function(F){var G=A.eventTarget(F.hWin,F.e);if(A.contains(this.menuButtonNode,G,true)){B.call(this);}else{if(A.contains(this.textNode,G,true)){this.onButtonClick(this.status,F);}}},onButtonClick:mstrmojo.emptyFn,onStatusClick:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(12346,12355,12356,1905,14543,10380,14544);var C=mstrmojo.Refine.RefineConstants;var E=mstrmojo.DI.DIConstants;var B=C.menuItems;var F=mstrmojo.array;mstrmojo.Refine.RefineFacetMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineFacetMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(12346,"Cluster and Edit"),did:B.REFINE_CLUSTER},{type:"list",did:B.SEPARATOR},{n:mstrmojo.desc(12355,"Sort by Name"),did:B.REFINE_SORT_NAME},{n:mstrmojo.desc(12356,"Sort by Count"),did:B.REFINE_SORT_COUNT},{type:"list",did:B.SEPARATOR},{n:mstrmojo.desc(1905,"Reset"),did:B.REFINE_RESET},{n:mstrmojo.desc(14543,"Reset ALL Selector"),did:B.REFINE_RESET_ALL},{did:B.SEPARATOR},{n:mstrmojo.desc(13039,"Delete"),did:B.REFINE_DELETE},{n:mstrmojo.desc(14544,"Delete ALL Selector"),did:B.REFINE_DELETE_ALL},{did:B.SEPARATOR},{n:mstrmojo.desc(null,"Delete Row Included In Selectors"),did:B.REFINE_DELETE_ROWS_IN_THE_VIEW},{n:mstrmojo.desc(null,"Delete Row Not-included In Selectors"),did:B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW}],queryEnabled:function H(L){var J=true;var I=this.target.parent.parent.parent.parent.controller;switch(L.did){case B.REFINE_DELETE_ROWS_IN_THE_VIEW:case B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:var K=I.refinePanel.bottomPanal.splitter.facetPanel;J=K.hasSelection();break;default:J=true;break;}return J;},queryVisible:function D(I){var J=true;switch(I.did){case B.REFINE_CLUSTER:case B.REFINE_SORT_NAME:case B.REFINE_SORT_COUNT:J=(this.target.type==="list");break;case B.SEPARATOR:if(I.type==="list"){J=(this.target.type==="list");}break;default:J=true;break;}return J;},queryChecked:function A(J){var I=false;switch(J.did){case B.REFINE_SORT_NAME:I=(this.target.options.sort==="name");break;case B.REFINE_SORT_COUNT:I=(this.target.options.sort!=="name");break;}return I;},executeCommand:function(P){var J,M,K,I=[],Q;var N=this.target.parent.parent.parent.parent.controller;switch(P.did){case B.REFINE_CLUSTER:var L=mstrApp.getRootController();var O=L.showDialog(E.dialogType.refineClusteringPage,{columnName:this.target.config.name,controller:N});N.model.attachEventListener("clustersFetched",O.id,O.handleClustersFetched);break;case B.REFINE_SORT_NAME:this.target.sortByName();break;case B.REFINE_SORT_COUNT:this.target.sortByCount();break;case B.REFINE_RESET:J=this.target.parent;this.target.reset();J.updateEngine(true);break;case B.REFINE_RESET_ALL:J=this.target.parent;J.resetAllFacets();J.updateEngine(true);break;case B.REFINE_DELETE_ALL:J=this.target.parent;J.removeAllFacets();J.updateEngine(true);break;case B.REFINE_DELETE:this.target.remove();break;case B.REFINE_DELETE_ROWS_IN_THE_VIEW:M=JSON.parse(JSON.stringify(N.model.transformations.Delete.DeleteRowsInTheView));K=N.refinePanel.bottomPanal.splitter.facetPanel;M.engineConfig=K.getJSON();Q=K.getRequirementDiscription();M.description=M.description.replace("[Requirement]",Q);I.push(M);K.resetAllFacets();N.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:M=JSON.parse(JSON.stringify(N.model.transformations.Delete.DeleteRowsNotInTheView));K=N.refinePanel.bottomPanal.splitter.facetPanel;M.engineConfig=K.getJSON();Q=K.getRequirementDiscription();M.description=M.description.replace("[Requirement]",Q);I.push(M);K.resetAllFacets();N.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;default:return false;}return true;},getMenuConfig:function G(J){var M=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-refine-menu"}),N=this.id,I,K=false,L=J||this.cm;F.forEach(L,function(P){I=(P.did===C.menuItems.SEPARATOR);if(this.queryVisible(P)){var O=[P.icn||""],Q=function Q(){this.executeCommand(P);};if(this.queryEnabled(P)===false||I){if((I&&!K)||!I){O.push(I?"separator":"");M.addDisabledMenuItem(P.n,O.join(" "));}if(I){K=true;}}else{if(P.items){M.addSubMenuItem(P.n,"",N,P.buildSubMenuConfig||this.getMenuConfig,P.items);K=false;}else{if(P.hasEdt){M.addEditorMenuItem(P.n,N,P.buildSubMenuConfig);K=false;}else{M.addToggleMenuItem(P.n||"",O.join(" "),Q,Q,N,this.queryChecked(P));K=false;}}}}},this);return M;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Refine.RefineHelpers");mstrmojo.requiresDescs(1388,629,14539,14540);var C=mstrmojo.Refine.RefineConstants;var F=mstrmojo.Refine.RefineHelpers;var B=C.menuItems;var E=mstrmojo.array;mstrmojo.Refine.RefineMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(1388,"Rename"),did:B.REFINE_RENAME},{did:B.SEPARATOR},{n:mstrmojo.desc(12575,"Delete Column"),did:B.REFINE_DELETE},{n:mstrmojo.desc(14274,"Duplicate Column"),did:B.REFINE_DUPLICATE},{did:B.SEPARATOR},{n:mstrmojo.desc(12341,"Fill Down"),did:B.REFINE_FILL_DOWN},{did:B.SEPARATOR},{n:mstrmojo.desc(14539,"Text Selector"),did:B.REFINE_TEXT_FACET},{n:mstrmojo.desc(14540,"Numeric Selector"),did:B.REFINE_NUMERIC_FACET},{did:B.SEPARATOR},{n:mstrmojo.desc(14268,"To Title Case"),did:B.REFINE_TITLE_CASE},{n:mstrmojo.desc(14269,"To Uppercase"),did:B.REFINE_UPPERCASE},{n:mstrmojo.desc(14270,"To Lowercase"),did:B.REFINE_LOWERCASE}],queryEnabled:function H(){return true;},queryVisible:function D(I){var J=true;switch(I.did){case B.REFINE_TEXT_FACET:case B.REFINE_NUMERIC_FACET:J=!mstrApp.getRootController().refineApp.isBDE;break;default:J=true;break;}return J;},queryChecked:function A(){return false;},executeCommand:function(W){var J={},T;var I,N,K=this.target.text;var S=this.target.preview.controller;var R=S.model;var M;switch(W.did){case B.REFINE_RENAME:this.target.inlineEdit.ondblclick();break;case B.REFINE_DELETE:this.target.inlineEdit.handleDelete();break;case B.REFINE_DUPLICATE:I=[];var V,U,P,Q=1,O;var L=this.target.preview.columns;while(true){V=K+" "+Q;P=true;for(O=0;O<L.length;O++){if(V===(L[O]).name){P=false;break;}}Q++;if(P){U=V;break;}}N=JSON.parse(JSON.stringify(R.transformations.Other.duplicate));N.description=N.description.replace("[new column name]",U);N.description=N.description.replace("[column name]",K);N.columnInsertIndex=this.target.columnIndex+1;N.newColumnName=N.newColumnName.replace("[column name]",U);N.baseColumnName=N.baseColumnName.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_FILL_DOWN:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.fillDown));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);M={operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})};if(R.hasAddSample()){F.confirmFilldownOrBlankdown(function(){S.applyOperations(M);});}else{S.applyOperations(M);}break;case B.REFINE_TEXT_FACET:J.name=this.target.text;J.columnName=this.target.text;T="list";J.expression="value";this.target.preview.controller.addFacets(T,J);break;case B.REFINE_NUMERIC_FACET:J.name=this.target.text;J.columnName=this.target.text;T="range";J.expression="value";J.mode="range";this.target.preview.controller.addFacets(T,J);break;case B.REFINE_TITLE_CASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.titlecase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_UPPERCASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.uppercase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_LOWERCASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.lowercase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;default:return false;}return true;},getMenuConfig:function G(J){var N=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu",useTooltip:true}),O=this.id,I,M=false,L=null,K=J||this.cm;E.forEach(K,function(Q){I=(Q.did===C.menuItems.SEPARATOR);if(this.queryVisible(Q)){if(I){if(null!==L){M=true;}}else{if(null===L){L=Q;}else{if(M){N.addSeparator();M=false;}}var P=[Q.icn||""],R=function R(){this.executeCommand(Q);};if(this.queryEnabled(Q)===false){N.addDisabledMenuItem(Q.n,P.join(" "));if(Q.title){N.menus[N.menus.length-1].title=Q.title;}}else{if(Q.items){N.addSubMenuItem(Q.n,"",O,Q.buildSubMenuConfig||this.getMenuConfig,Q.items);}else{if(Q.hasEdt){N.addEditorMenuItem(Q.n,O,Q.buildSubMenuConfig);}else{N.addToggleMenuItem(Q.n||"",P.join(" "),R,R,O,this.queryChecked(Q));}}}}}},this);return N;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.EditableLabel","mstrmojo.ui.menus.MenuConfig","mstrmojo.css");var b=mstrmojo.css,N=1,L=2,F=4,c=8,K=16;function E(e){return function(){b.toggleClass(this.menuBtnNode,"active",e);};}function H(f){var k=new mstrmojo.ui.menus.MenuConfig(),j=this.getMenuActions(),e=this.index,l=this.id,g=this.total;if((j&K)>0){this.addNewTabMenuItem(k);}if((j&F)>0){k.addMenuItem(mstrmojo.desc(3397,"Duplicate"),"dup",function(){mstrmojo.all[l].tabDuplicated();});}if((j&L)>0){if(e){k.addMenuItem(mstrmojo.desc(5362,"Move Left"),"lft",function(){mstrmojo.all[l].tabMoved(true);});}if(e<g-1){k.addMenuItem(mstrmojo.desc(5363,"Move Right"),"rgt",function(){mstrmojo.all[l].tabMoved(false);});}}k.addSeparator();if((j&N)>0){k.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){mstrmojo.all[l].lbl.set("isEditing",true);});}if((j&c)>0){if(g>1){k.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){mstrmojo.all[l].tabDeleted();});}}var h=this.getCustomMenu();if(h&&h.hasMenuItems()){k.addSeparator();k.absorbMenuItems(h);}k.addPopupHandlers(this.id,E(true),E(false));this.showTabMenu(this.updateMenuCfg(k),f);}mstrmojo.vi.ui.tabs.Tab=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.Tab",markupString:'<div id="{@id}" class="mstrmojo-VITab unselectable {@cssClass}" style="{@cssText}" unselectable="on" mstrAttach:click><div><div class="mstrmojo-VITab-tab"></div><div class="mstrmojo-VITab-menu"></div></div></div>',markupSlots:{containerNode:function W(){return this.domNode.firstChild.firstChild;},menuBtnNode:function a(){return this.domNode.firstChild.lastChild;}},markupMethods:{ontitleChange:function Z(){this.lbl.set("text",this.title);},onisSelectedChange:function V(){mstrmojo.css.toggleClass(this.domNode,"selected",this.isSelected);},onzIndexChange:function D(){this.domNode.style.zIndex=this.zIndex;}},zIndex:1,menuBtnNode:null,lbl:null,title:"",index:-1,total:-1,isSelected:false,children:[{scriptClass:"mstrmojo.EditableLabel",alias:"lbl",editOnClick:false,onTextEditComplete:function Q(f,e){if(f){this.parent.titleEdited(this.text,e);}}}],postBuildRendering:function X(){if(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()){this.draggable=false;}this._super();},onclick:function d(e){var f=e.getTarget();if(f===this.menuBtnNode){H.call(this,f);}else{if(!this.isSelected){this.tabSelected();}}},getMenuActions:function I(){return 0;},getCustomMenu:function B(){return null;},isDragValid:function A(){return this.parent.children.length>1&&!this.lbl.isEditing;},createAvatar:function S(){var e=document.createElement("div");e.appendChild(this.domNode.cloneNode(true));e.style.margin="-5px 0 0 10px";return e;},allowDrop:function G(e){var f=e.src.widget;return f&&f.parent===this.parent;},ondrop:function Y(e){var f=e.src.data;this.parent.moveTab(f.idx,this.index,f.fromIdx);this._super(e);},ondragenter:function P(f){this._super(f);var g=f.src.data,e=this.index;this.parent.moveTab(g.idx,e);g.idx=e;},ondragover:function T(g){var e=g.tgt.node,f=g.tgtData,h=f&&f.node;if(!f||h!==e){g.tgtData={node:e};if(h){h.style.borderColor="";}}e.style.borderColor="#0fe88f";},getDragData:function C(){var g=this.id,e=this.index;return{setAvatarClass:function f(h){var l=mstrmojo.all[g],j=l.avatar;if(j){var k=[l.avatarCssClass,"hasOwnAvatar",h];j.className=k.join(" ");}},fromIdx:e,idx:e};},getDropAvatarIcon:function R(){return"pivot";},cleanUpAfterTarget:function J(f){var e=f.tgtData&&f.tgtData.node;if(e){e.style.borderColor="";}this._super(f);},onAppStateChange:function U(e){var f=this.lbl,g=e.value===mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;f.set("isEditing",false);f.set("editOnDoubleClick",!g);this.draggable=!g;},addNewTabMenuItem:function O(e){this.throwAbstractMethodError("addNewTabMenuItem");},tabSelected:mstrmojo.emptyFn,titleEdited:mstrmojo.emptyFn,tabMoved:mstrmojo.emptyFn,tabDeleted:mstrmojo.emptyFn,tabDuplicated:mstrmojo.emptyFn,showTabMenu:mstrmojo.emptyFn,updateMenuCfg:function M(e){return e;}});mstrmojo.vi.ui.tabs.Tab.ACTIONS={NEW_TAB:K,RENAME:N,MOVE:L,DUPLICATE:F,DELETE:c};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.string","mstrmojo._FillsBrowser","mstrmojo.Refine.RefineSampleButton");var A=mstrmojo.dom,F=mstrmojo.DI.DIConstants,C=mstrmojo.css;function G(H){if(H.type===F.sourceType.file&&(H.subtype===F.sourceSubtype.localFile||H.subtype===F.sourceSubtype.url||H.subtype===F.sourceSubtype.samplefile)){return true;}else{if(H.type===F.sourceType.querybuilder&&H.subtype===F.sourceSubtype.querybuilder){return true;}}return false;}mstrmojo.requiresDescs(1143,221,12314,1442,14705);mstrmojo.Refine.RefinePopupPage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._IsPopup,mstrmojo._FillsBrowser],{scriptClass:"mstrmojo.Refine.RefinePopupPage",alias:"RefinePopupPage",markupString:'<div id="{@id}" class="refine-popup-page mojo-theme-light" mstrAttach:mousedown,mousemove><div class="refine-popup-page-header"></div><div class="refine-popup-page-content"></div><div class="refine-popup-page-footer"><div class="refine-popup-page-cancel"></div><div class="refine-popup-page-apply"></div></div><div class="refine-popup-page-overlay"></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.children[0];},refinePanelNode:function(){return this.domNode.children[1];},buttonNode:function(){return this.domNode.children[2];},cancelNode:function(){return this.domNode.children[2].children[0];},applyNode:function(){return this.domNode.children[2].children[1];},overlayNode:function(){return this.domNode.children[3];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;}},onmousedown:function(H){var J=H.e,I=A.eventTarget(H.hWin,J);if(!this.controller.refineApp.rootController.isClickedInDatePreview&&I.className.indexOf("mstrmojo-scrollbar")===-1){this.refinePanel.controller.model.raiseEvent({name:"columnUnSelected"});if(window.getSelection){window.getSelection().removeAllRanges();}else{document.selection.empty();}}this.controller.refineApp.rootController.isClickedInDatePreview=false;},preBuildRendering:function B(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}var I=mstrApp.getRootController(),H=I.refineApp.rootController.tableID,J=I.model.importSources[H];if(!G(J)){Array.prototype.splice.call(this.children[0].children,1,1);}return this._super();},postBuildRendering:function E(){this.setDimensions();if(this._super){this._super();}},setDimensions:function D(){var I=this.getBrowserDimensions();var H=Math.ceil(parseInt(I.h,10)*0.95);var J=Math.ceil(parseInt(I.w,10)*0.95);if(isNaN(H)||isNaN(J)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.refinePanelNode=(H-41-47-2)+"px";this.layoutConfig.w.refinePanelNode=(J-36)+"px";if(this._super){this._super(H+"px",J+"px");}if(this.domNode){mstrmojo.dom.center(this.domNode);}},children:[{scriptClass:"mstrmojo.Box",slot:"headerNode",alias:"header",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-refine-title",alias:"title",text:mstrmojo.desc(12314,"Wrangle Your Data")},{scriptClass:"mstrmojo.Refine.RefineSampleButton",cssClass:"mstrmojo-WebHoverButton mstrmojo-refine-sample-button",alias:"sampleButton",useRichTooltip:false,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,left:(parseInt(this.domNode.offsetWidth,10)+6).toString()+"px",content:mstrmojo.desc(14705,"All data from the source has <br>been added in the data <br>wrangler preview.")});},postBuildRendering:function(){var I=mstrApp.getRootController(),H=I.refineApp.rootController;this.m=H.model;this.listener=this.m.attachEventListener("dataChange",this.id,this.disableSetSampleButtonhandler);this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},disableSetSampleButtonhandler:function(H){var I=parseInt(H.value.totalInitial,10);if(I<1000){this.set("useRichTooltip",true);this.set("enabled",false);C.addClass(this.textNode,"_disable-Button");}this.m.detachEventListener(this.listener);}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-close",onclick:function(){this.parent.parent.cancel.onclick();}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-help",title:mstrmojo.desc(1143,"Help"),onclick:function(){var H="Data_Wrangler.htm";mstrApp.showHelpTopic(H);}}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",alias:"next",slot:"applyNode",text:mstrmojo.desc(1442,"OK"),onclick:function(){var Q,N,K;var L=mstrApp.getRootController();var O=L.model;var H=O.importSources[this.parent.tableID];K=this.parent.refinePanel.controller.model;Q=K.projectID;var M=JSON.parse(JSON.stringify(K.operations.entries));var P=[],J;if(M.length===0){L.cancelRefineStage(this.parent.tableID);}else{for(J=0;J<M.length;J++){P.push(M[J].operation);}N='<rss rpid="'+Q+'" rfmt=""><rpo></rpo><rjsops>'+mstrmojo.string.encodeXMLAttribute(JSON.stringify(P))+"</rjsops></rss>";L.startRefineStage(this.parent.tableID,3,N);}var I=this.parent.refinePanel.bottomPanal.splitter.facetPanel;I.removeAllFacets();K.engine=JSON.stringify(I.getJSON());H.inRefine=false;this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),slot:"cancelNode",alias:"cancel",onclick:function(){var P=[],K,N;var L=this.parent.refinePanel.controller.model;var M=mstrApp.getRootController();var O=M.model;var I=O.importSources[this.parent.tableID];if(I.RefineOperations.length===0){M.cancelRefineStage(this.parent.tableID);}else{if(!mstrmojo.hash.equals(I.RefineOperations,L.operations.entries)){var H=M.refineApp.rootController;N=I.RefineOperations;for(K=0;K<N.length;K++){P.push(N[K].operation);}H.rollBackOperations({operations:JSON.stringify(P),engine:JSON.stringify({facets:[],mode:"row-based"})});}}var J=this.parent.refinePanel.bottomPanal.splitter.facetPanel;J.removeAllFacets();L.engine=JSON.stringify(J.getJSON());I.inRefine=false;this.parent.destroy();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12792,12804);var J=mstrmojo.array,D=mstrmojo.hash,L=mstrmojo.DI.DIConstants,F=mstrmojo.DI.DIConstants.actions;function C(N,M){var O=M;if(N.isMultiForm){if(!M.isMultiForm){O=N;}else{var Q=N.subColumns,P=M.subColumns.concat();J.forEach(Q,function(S){var R=J.find(P,"afid",S.afid);if(R<0){P.push(S);}});O=D.copy(M);O.subColumns=P;}}if(!O.linkedTbs){O.linkedTbs={};O.linkedTbs[M.tableId]=true;O.linkedTbs[N.tableId]=true;}else{O.linkedTbs[N.tableId]=true;}return O;}function A(O){var M=O.initialSet.distInfo,N=O.distInfo;if(M.keyId===N.keyId&&M.pf===N.pf){return null;}else{return N;}}function B(Q){var N=Q.initialSet.sidxes,O=Q.sidxes,R={},M=false;if(O.length<N.length){M=true;}else{J.forEach(N,function P(S){R[S.atid+S.afid]=true;});J.forEach(O,function P(S){if(R[S.atid+S.afid]!==true){M=true;return false;}});}return M?O:null;}mstrmojo.DI.controller.DIAllObjectsViewController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIAllObjectsViewController",controller:null,init:function K(M){this._super(M);this.controller=mstrApp.getRootController();},getAllMappings:function(){var P,O,Q,S,T;var R=[],M=this.controller.model.importSources;for(P in M){Q=M[P];if(Q.currentTransformations&&Q.currentTransformations.xtab&&Q.currentTransformations.xtab.isCrosstab){T=Q.transformedMapping;}else{T=Q.currentMapping;}if(T){for(O=0;T&&O<T.length;O++){S=T[O];var N=mstrmojo.array.find(R,"id",S.id);if(N<0){R.push(mstrmojo.hash.copy(S));}else{R[N]=C(S,R[N]);}}}}return R;},getAllImportSources:function(){return this.controller.model.importSources;},getCubeConfig:function E(){var N=this.controller;var M=N.model;var O={browsetype:L.browseFlag.cubeConfig,previewflag:L.requestFlag.mapping};var P={success:function(Q){M.populateCubeConfig(Q);},failure:function(Q){N.displayError(mstrmojo.desc(12792,"Cannot retrieve cube config info.")+Q);}};N.dataService.getImportedData(P,O);},isCubeConfigEnabled:function G(){var M=this.controller.model;if(mstrApp.isSingleTier){return false;}else{if(M.isDirectDataAccess&&M.weakDDA!==true){return false;}else{return true;}}},persistCubeConfig:function I(S){var O=this.controller,N=A(S),R=B(S),P=[],Q=[],T={};if(!N&&!R){return ;}if(R){J.forEach(R,function(U){P.push(U.atid);Q.push(U.afid);});T.statid=P.join();T.stafid=Q.join();T.stic=true;}if(N){T.keyid=N.keyId;T.n=N.pf;}var M={success:function(){delete S.initialSet;S.initialSet=D.clone(S);O.model.set("isDirectDataAccess",false);var U=L.requestFlag.mapping|L.requestFlag.sourceInfo|L.requestFlag.relationship;O.getImportedDataEMMA(F.none,U);},failure:function(U){var V=mstrmojo.desc(12804,"Persist cube configurations failed:");O.displayError(V,false,U.message);}};O.dataService.persistCubeConfigInfo(M,T);},showAllObjects:function H(){var M=this.controller;M.model.attachEventListener("CubeConfigFetched",this.id,function(){M.showDialog(L.dialogType.allObjectsViewDialog,null);});this.getCubeConfig();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(11636);var C=mstrmojo.func,D=mstrmojo.hash,A={style:{params:{treesToRender:1}},hideCancel:true};mstrmojo.DI.controller.DIDocController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDocController",submitUpdate:function(I,J,H){var G=mstrApp,F=mstrApp.launchingApp,E={success:function(K){window.mstrApp=G;if(K&&K.mid){mstrApp.getRootController().getModel().analysisID=K.mid;}},failure:function(){window.mstrApp=G;}};window.mstrApp=F;if(mstrApp.rootCtrl.docCtrl){mstrApp.rootCtrl.docCtrl.cmdMgr.getInterimCmd().submitInterim(I,C.wrapMethods(E,J,{}),H);}else{E.success();J.success();}},createNewManagedDataset:function(G,F){var E={act:"createDataset",mgo:true,name:mstrmojo.desc(11636,"New Dataset"),prm:true,rid:"4B43EC5548911FC01AF5D3ACE3F16256",disablePU:true,execFlags:131072};this.submitUpdate(D.copy(F,E),G,{style:{params:{treesToRender:1}},hideCancel:true});},removeDataset:function(G,F){var E={act:"removeDataset",did:F&&F.id,disablePU:true};if(F&&F.id){this.submitUpdate(E,G,A);}},renameDataset:function B(F,E,H){var G={act:"renameDataset",datasetID:F,name:E};this.submitUpdate(G,H,A);},setDatasetDDA:function(H,G){var F={act:"toggleDatasetServeMode",execFlags:131072,dsid:G&&G.id,dsm:2};var E={style:{params:{treesToRender:1}},params:{stateID:-1}};if(G&&G.id){this.submitUpdate(F,H,E);}},getVIModelDatasets:function(){var E=mstrApp.launchingApp,F=null,G=[];if(E&&E.rootCtrl&&E.rootCtrl.docCtrl&&E.rootCtrl.docCtrl.model){F=E.rootCtrl.docCtrl.model.datasets;D.forEach(F,function(H){G.push(H);});}return G;},getVIDocData:function(F){var E={style:{params:{treesToRender:0}},hideCancel:true};this.submitUpdate([],F,E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants","mstrmojo.DI.DIModel");mstrmojo.requiresDescs(641,12783,12897,12899,12900,12901,12902,12903,12904,12510,12537,13324,12392,14708);var a=mstrmojo.DI.DIConstants,I=mstrmojo.array,Q=mstrmojo.func,F=a.xdaType,H=a.actions,O=mstrmojo.DI.DIHelpers;function R(j,g,k){var f=mstrApp.getRootController(),h=f.dataService,c=null,e=[];var d={success:function(n){var m=n.datap.shts,l=0;e=[];I.forEach(m,function(o){if(o!=="*"){e.push({idx:l,n:o});}l++;});if(e.length>0){if(k.success){k.success({sheets:e});}}else{if(k.failure){k.failure({message:mstrmojo.desc(12510,"The import process cannot proceed with an empty file.")});}}if(k.complete){k.complete();}},failure:function(l){if(k.failure){k.failure(l);}if(k.complete){k.complete();}}};var b={success:function(){c={tableID:g,previewflag:a.requestFlag.sheets};h.getImportedData(d,c);},failure:function(l){if(k.failure){k.failure(l);}if(k.complete){k.complete();}}};c=mstrmojo.hash.copy(j,{tbid:g});h.setDataImportInfo(b,c);}function P(g,j,f){var c=this;var e=g&&g.length;var d=0;var h;if(!e){if(j&&j.success){j.success();}if(j&&j.complete){j.complete();}return ;}var b={success:function(k){c.dataService.set("messageID",k.msgid);c.model.resetImportSource(g[d]);if(f){I.removeItem(c.tablesSrc[f],g[d]);}d++;if(d<e){h={did:g[d]};c.removeEMMASourceTable(b,h);}else{if(j&&j.success){j.success();}if(j&&j.complete){j.complete();}}},failure:function(k){if(j&&j.failure){j.failure(k);}}};if(d<e){h={did:g[d]};c.removeEMMASourceTable(b,h);}}function V(d,g,k,j){var h=this;var b=this.model.cubeID;var f=d.getFileName(g.idx);var e={msgID:h.dataService.messageID,tableID:j,__index:g.idx,fileName:f};var c={failure:function(l){var m=h.getImportController().handleImportError(l,f);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,m);},complete:function(){mstrApp.hideProgress();}};if(b){e.reportid=b;}e.behaviorFlags=a.importBehaviorFlag.reserved;if(this.model.operationMode===a.operationMode.refresh||this.model.operationMode===a.operationMode.edit){if(mstrApp.isCloudPro){e.behaviorFlags=a.importBehaviorFlag.newColumnsSilent|a.importBehaviorFlag.dataTypeSilent;}}h.dataService.importFile(d,Q.wrapMethods(c,k,{}),e);}function T(c,d,g,l){var j=this;var h=j.model;var k=mstrmojo.all[c].tableID;var e={xt:a.xdaType.dataImport};var b=h.getImportSource(k);g.files[g.idx].tableID=k;if(b.type===a.sourceType.file&&(b.subtype===a.sourceSubtype.localFile||b.subtype===a.sourceSubtype.clipboard)){var f=d.getFileName(g.idx);g.files[g.idx].fileName=f;V.call(j,d,g,{success:function(){if(l.success){l.success();}},failure:function(m){if(l.failure){l.failure(m);}}},k);}else{if((b.type===a.sourceType.file&&(b.subtype===a.sourceSubtype.url||b.subtype===a.sourceSubtype.samplefile||b.subtype===a.sourceSubtype.publicData))||b.type===a.sourceType.hadoop){g.files[g.idx].fileName=d.getFileUrl(g.idx);e.isUrl=true;e.url=d.getFileUrl(g.idx);if(d.tableidx){b.set("tableIdx",d.getUrlTableIndices(g.idx));b.set("currentIndex",d.getUrlTableIndices(g.idx));e.shtIx=b.tableIdx;}j.setDataImportInfoURL(l,e,k);}}}function X(c,e,h,m,d){var k=this;var j=k.model;var f={success:function(n){var p=n.msgid;var o=n.tbid;if(p){k.dataService.set("messageID",p);}var q=j.createImportSource(a.sourceType.file,d,o);var t=e.getFileName(h.idx);h.files[h.idx].tableID=o;h.files[h.idx].toDel=true;q.set("fileName",O.getAbsoluteFileName(t));O.setTablesrc(k,c,o);V.call(k,e,h,m,o);},failure:function(n){if(m&&m.failure){m.failure(n);}}};var g={xt:a.xdaType.dataImport,dict:O.getBackendSourceType(d)};if(e.getFileTableID(h.idx)){if(m.success){m.success();}if(m.complete){m.complete();}return ;}if(!h.files[h.idx]){h.files[h.idx]={};}if(h.idx===0&&mstrmojo.all[c].tableID){T.call(k,c,e,h,m);return ;}if(d===a.sourceSubtype.localFile){h.files[h.idx].fileName=e.getFileName(h.idx);k.dataService.createEMMASourceTable(f,g);}else{if(d===a.sourceSubtype.url||d===a.sourceSubtype.samplefile||d===a.sourceSubtype.publicData){var l=e.getFileUrl(h.idx);h.files[h.idx].fileName=l;g.isUrl=true;g.url=l;var b={success:function(n){var p=n.msgid;var o=n.tbid;g.tbid=o;if(p){k.dataService.set("messageID",p);}O.setTablesrc(k,c,o);var q=j.createImportSource(a.sourceType.file,d,o);var t=e.getFileUrl(h.idx);h.files[h.idx].tableID=o;h.files[h.idx].toDel=true;q.set("fileName",t);if(e.tableidx){q.set("tableIdx",e.getUrlTableIndices(h.idx));q.set("currentIndex",e.getUrlTableIndices(h.idx));g.shtIx=q.tableIdx;}k.setDataImportInfoURL(m,g,o);}};k.dataService.createEMMASourceTable(b,g);}}}function M(b,f,h,m,d,l){var k=this;var c=f.getFilesCnt();var g={idx:0,files:{}};function j(){var t=[],u=[],w=[],q=0,p;mstrmojo.hash.forEach(g.files,function(z,x){if(z.failed===true){t.push(x);if(z.tableID&&z.toDel){u.push(z.tableID);k.model.resetImportSource(z.tableID);}}else{if(z.tableID){w.push(z.tableID);}}});p=w.length;var n={success:function(){q++;if(q>=p){if(t.length>0){if(l&&l.failure){l.failure(g);}}else{if(l&&l.success){l.success(g);}}}},failure:function(){k.displayError(mstrmojo.desc(12897,"RS detection failure."));},complete:function(){if(q>=p){if(l&&l.complete){l.complete();}}}};var o={success:function(x){if(x&&x.msgid){k.dataService.set("messageID",x.msgid);}if(w.length>0){I.forEach(w,function(z){k.dataService.detectRelationshipSourceTable(n,{did:z});});}else{n.success();}},failure:function(){k.displayError(mstrmojo.desc(641,"Please try again. If the problem persists, contact the server Administrator."),true);}};if(u.length>0){k.removeEMMASourceTable(o,{did:u.join()});}else{o.success();}}var e={success:function(n){if(n&&n.msgid){k.dataService.set("messageID",n.msgid);}g.idx++;if(g.idx<c){X.call(k,b,f,g,e,d);}else{j();}},failure:function(n){g.files[g.idx].failed=true;g.files[g.idx].errRes=n;g.idx++;if(g.idx<c){X.call(k,b,f,g,e,d);}else{j();}}};if(c>0){X.call(k,b,f,g,e,d);}else{if(l&&l.success){l.success(g);}if(l&&l.complete){l.complete();}}}function B(b){var c,d,e;for(c in b){e=b[c].sheetsInfo;if(this.model.operationMode===a.operationMode.edit){if(b[c].sourceInfo){continue;}}if(b[c].subtype===a.sourceSubtype.localFile){if(!e){return false;}if(e.length===0){if(!b[c].isAutoMapped){return false;}}for(d=0;d<e.length;d++){if(!e[d].isAutoMapped&&e[d].selected){return false;}}}else{if(b[c].subtype===a.sourceSubtype.url||b[c].subtype===a.sourceSubtype.samplefile||b[c].subtype===a.sourceSubtype.publicData){if(!e){return false;}if(e.length===0){if(!b[c].isAutoMapped){return false;}}for(d=0;d<e.length;d++){if(!e[d].isAutoMapped&&e[d].selected){return false;}}}}}return true;}function G(c){var e,g,j,h,b,d=a.sourceSubtype,f=[];for(e in c){h=c[e];j=h.sheetsInfo;b=h.subtype;switch(b){case d.localFile:case d.url:case d.samplefile:case d.publicData:if(!j){break;}if(j.length===0){if(!h.isAutoMapped){f.push(e);break;}}for(g=0;g<j.length;g++){if(!j[g].isAutoMapped&&j[g].selected){f.push(e);break;}}break;}}return f;}function W(f,c,e,b,j){var g=this;f.idx=0;var k=true;var l=[];var d=function(){var p=g.model;var n=p.importSources,o,q=[];var m=B.call(g,n);if(m){if(p.operationMode===a.operationMode.create){for(o in n){q.push(o);}}else{for(o in n){if(!n[o].sourceInfo){q.push(o);}}}g.detectRelationshipSourceTable(null,q,e);}else{if(k){g.showSheetsSelectionDialog(l,e,null,b,m,h);k=false;}}};var h={success:function(){if(f.files[f.idx]){l.push(f.files[f.idx].tableID);}f.idx++;if(!j&&f.idx<c){g.getSheetsInfo(h,f.files[f.idx].tableID,a.requestFlag.sheets|0,e,f);}else{var n=[];var m=false;mstrmojo.hash.forEach(f.files,function(q){if(q.failed){m=true;n.push(q.tableID);}});if(m){var p={success:function(){g.tablesSrc[b]=[];K.call(g,f,d);for(var q in f.files){if(f.files[q].failed){delete f.files[q];}}}};P.call(g,n,p,b);}else{if(k){var o=G.call(g,g.model.importSources);g.showSheetsSelectionDialog(o,e,null,b,f,h);k=false;}}}},failure:function(){f.idx++;var n=g.model.operationMode;if(n===a.operationMode.create){if(f.idx<c){g.getSheetsInfo(h,f.files[f.idx].tableID,a.requestFlag.sheets|0,e,f);}else{var o=[];var m=true;mstrmojo.hash.forEach(f.files,function(q){if(q.failed){o.push(q.tableID);}else{m=false;}});var p={success:function(){if(m){C.call(g,f);}else{g.tablesSrc[b]=[];K.call(g,f,d);for(var q in f.files){if(f.files[q].failed){delete f.files[q];}}}}};if(!mstrmojo.all[b].tableID){P.call(g,o,p,b);}else{p.success();}}}else{C.call(g,f);}},complete:mstrmojo.emptyFn};g.getSheetsInfo(h,f.files[f.idx].tableID,a.requestFlag.sheets|0,e,f);}function Z(q,f,g,m,p,j){var h=mstrApp.getRootController(),n=h.dataService,c=[],e=0,l=[],k=[],d=[];function b(u,x){var w=mstrmojo.hash.copy(q,{shtIx:u.idx});if(u.tableID){w.tbid=u.tableID;}else{w.srctbid=m;w.xt=f;}if(c.length>1){w.behaviorFlags=a.behaviorChangeFlag.multiSheet;}n.autoMappingSourceTable(x,w);}function o(){mstrApp.hideProgress();if(d.length>0){l=l.concat(k);}if(l.length>0){if(!j){n.removeEMMASourceTable({success:function(){if(p.success){if(k.length>0){p.success({tableIDs:k});}else{p.failure({tableIDs:null,res:d[0]});}}if(p.complete){p.complete();}},failure:function(u){if(p.failure){p.failure(u);}if(p.complete){p.complete();}}},{did:l.join()});}else{if(p.failure){p.failure(d[0]);}if(p.complete){p.complete();}}}else{if(p.success){p.success({tableIDs:k});}if(p.complete){p.complete();}}}var t={success:function(u){if(u&&u.tbid){k.push(u.tbid);}else{k.push(m);}},failure:function(u){if(c[e].tableID){l.push(c[e].tableID);}d.push(u);},complete:function(){e++;if(e<c.length){b(c[e],t);}else{o();}}};I.forEach(g,function(u){if(u.selected){c.push(u);}});if(c.length<=0){n.removeEMMASourceTable(p,{did:m});}else{mstrApp.showProgress();c[0].tableID=m;b(c[0],t);}}function N(c){var d=c.code;var e=c.message;if(d===null||d===undefined){e=c.getResponseHeader("X-MSTR-TaskFailureMsg");}var f=e.indexOf("("),b=e.lastIndexOf(")");if(f>=0&&b>f){e=e.substring(f+1,b);}return e;}function L(d){var c=this;var b=[];var f=[];var e=c.rootView.currentPage;var g="<ul>";mstrmojo.hash.forEach(d.files,function(j,h){if(j.failed===true){b.push(j.fileName);g+="<li>"+j.fileName+"<br>"+N(j.errRes)||" </li>";}else{f.push(j.fileName);}});g+="</ul>";e.set("forceEnable",f.length>0?true:false);if(e.setFilesObject){e.setFilesObject(b);}return g;}function C(c){var b=this;var d=L.call(b,c);b.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,d);}function K(c,f,e){var b=this;var g=L.call(b,c);var d={detailErrorMessage:g,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:e};b.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),mstrmojo.desc(12537,"Data Import"),f,d);}function U(f,d,e){var b=this,h=false,g,c;if(f===a.operationMode.edit&&d===a.sourceSubtype.url&&e){g=b.model.importSources[e];c=g.sourceInfo.partition;h=!!c&&c.isPartition&&g.xdaType===a.xdaType.text;}return h;}function Y(b,h,o,t,d,m){var p=this;var c=h.getFilesCnt();var n={idx:0,files:{}};var e=p.model.operationMode,q=false;if(mstrmojo.DI.DIHelpers.isOperationMode(mstrmojo.all[b].operationMode)){e=mstrmojo.all[b].operationMode;}var g={success:function(k){if(k&&k.msgid){p.dataService.set("messageID",k.msgid);}n.idx++;if(!q&&n.idx<c){X.call(p,b,h,n,g,d);}else{W.call(p,n,c,m,b,q);}},failure:function(u){var k=n.files[n.idx];k.failed=true;k.errRes=u;n.idx++;if(!q&&k.tableID&&k.toDel){p.model.resetImportSource(k.tableID);p.removeEMMASourceTable(null,{did:k.tableID});}mstrApp.hideProgress();var w=p.getImportController().handleImportError(u);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,w);if(!q&&n.idx<c){X.call(p,b,h,n,g,d);}}};if(c>0){q=U.call(p,e,d,mstrmojo.all[b].tableID);if(q){E.call(p,b,h,n,g,d);}else{X.call(p,b,h,n,g,d);}}else{if(p.model.getAllTableID().length>0){var l=p.model.importSources;var f=[];for(var j in l){f.push(j);}if(B.call(p,p.model.importSources)){p.detectRelationshipSourceTable(null,f,m);}else{p.showSheetsSelectionDialog(f,m,null,b);}}}}function E(d,g,l,t,f){var o=this,p=mstrmojo.all[d].tableID,h,e=g.getFilesCnt(),m,q=[],c,j={xt:a.xdaType.dataImport},k,b,n=o.model;if(!l.files[l.idx]){l.files[l.idx]={};}k=g.getFileUrl(l.idx);l.files[l.idx].fileName=k;l.files[l.idx].tableID=p;h={success:function(u){var w=u.msgid;if(w){o.dataService.set("messageID",w);}b=n.getImportSource(p);if(b&&!b.fileName){b.set("fileName",k);}j.isUrl=true;j.url=k;o.setDataImportInfoURL(t,j,p);},failure:function(){mstrApp.hideProgress();o.displayError(mstrmojo.desc(12392,"Encounter error when set partition!"));}};for(m=0;m<e;m++){c=g.getFileUrl(m);q.push(c);}if(q.length>1){mstrmojo.confirm(mstrmojo.desc(14708,"Do you want to group these files into a single partition table?"),{confirmBtn:{fn:function(){o.partitionController.setPartitionURL(p,q,h);}}});}else{o.partitionController.setPartitionURL(p,q,h);}}mstrmojo.DI.controller.ImportController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.ImportController",importMultiOAuthReports:function(b,t,d,f){var n=mstrApp.getRootController();var c=n.getModel();var l=c.externalSources[b];var q=l.getSourceInfoParam(true);var g=null;var p=0,e=null;var o=[];var x=[];function m(){if(f.failure){f.failure({reports:d,status:o});}if(f.complete){f.complete();}}function u(){if(f.success){f.success({reports:d,status:o});}if(f.complete){f.complete();}}function h(z,AB){var AA=mstrmojo.hash.copy(q,{reportAddress:z.query,reportDesc:z.desc===undefined?"":z.desc,reportMimetype:z.type===undefined?"":z.type,reportName:z.n});if(z.tableID){AA.tbid=z.tableID;}else{AA.xt=g;}if(z.max){AA.reportMax=z.max;}AA.dict=O.getBackendSourceType(t);n.dataService.autoMappingSourceTable(AB,AA);}var w={success:function(){if(x.length>0){m();}else{u();}}};function j(){var AC=[],AA=0,AB;var z={success:function(){AA++;if(AA>=AB&&w.success){w.success();}},failure:function(AD){n.displayError(mstrmojo.desc(12901,"RS detection error."),false,AD.message);},complete:function(){if(AA>=AB&&w.complete){w.complete();}}};mstrmojo.array.forEach(o,function(AE,AD){if(AE.success){AC.push(AE.tableID);}else{x.push(AD);}});mstrApp.hideProgress();AB=AC.length;if(AC.length>0){I.forEach(AC,function(AD){n.dataService.detectRelationshipSourceTable(z,{did:AD});});}else{m();}}var k={success:function(z){e={success:true};if(z&&z.tbid){e.tableID=z.tbid;}else{e.tableID=d[p].tableID;}o.push(e);},failure:function(z){e={success:false,errCode:z.code,errMsg:z.message};o.push(e);},complete:function(){p++;if(p>=d.length){j();}else{h(d[p],k);}}};q.behaviorFlags=a.importBehaviorFlag.reserved;if(c.operationMode===a.operationMode.refresh||c.operationMode===a.operationMode.edit){if(mstrApp.isCloudPro){q.behaviorFlags=a.importBehaviorFlag.newColumnsSilent|a.importBehaviorFlag.dataTypeSilent;}}if(!d||d.length<=0){u();return ;}switch(b){case a.sourceType.googleDrive:g=F.dataImportOAuthGDrive;break;case a.sourceType.dropbox:g=F.dataImportOAuthDropbox;break;case a.sourceType.salesforce:g=F.dataImportOAuthSalesforce;break;case a.sourceType.googleAnalytics:g=F.dataImportOAuthGAnalytics;break;case a.sourceType.googleBigQuery:g=F.dataImportOAuthGBigQuery;break;case a.sourceType.twitter:g=F.twitter;break;case a.sourceType.facebook:g=F.facebook;break;}if(g===null){return ;}mstrApp.showProgress();h(d[0],k);},refreshDataOAuthReport:function(m,q,l,g,e,p){var j=mstrApp.getRootController(),h=j.getModel(),o=j.dataService,t=h.externalSources[m],u=t&&t.getSourceInfoParam(true),f,b;function n(w){if(p.failure){p.failure(w);}if(p.complete){p.complete();}}function d(){o.detectRelationshipSourceTable(p,{did:l});}var k={success:function(){d();},failure:function(w){n(w);}};if(!t||!g||!l){n();}var c={success:function(){f=mstrmojo.hash.copy(u,{behaviorFlags:a.behaviorChangeFlag.refreshData,reportAddress:g.query,reportDesc:g.desc,reportMimetype:g.type,reportName:g.n,reportMax:g.max===undefined?"":g.max,dict:O.getBackendSourceType(q),tbid:l});o.autoMappingSourceTable(k,f);},failure:function(w){n(w);}};b=h.getImportSource(l);if(b.sourceInfo.isRefined){f=mstrmojo.hash.copy(u,{reportAddress:g.query,reportDesc:g.desc,reportMimetype:g.type,reportName:g.n,tbid:l});o.setDataImportInfo(c,f);}else{c.success();}},importMultiFBReports:function(c,t,e,f){var m=mstrApp.getRootController(),d=m.getModel(),o=m.dataService,k=d.externalSources[c],q=k.getSourceInfoParam(true),g=a.xdaType.facebook,x={},b=[],n=[],w,p=0,h;function l(){if(f.failure){f.failure({reports:e});}if(f.complete){f.complete();}}function u(){if(f.success){f.success({reports:e,status:n});}if(f.complete){f.complete();}}var z={success:function(){var AA={success:true};n.push(AA);p++;if(h&&p>=h.length){u();}},failure:function(AA){var AB={success:false,errCode:AA.code,errMsg:AA.message};n.push(AB);}};var j={success:function(AA){h=AA&&AA.tbids;if(h.length>0){I.forEach(h,function(AB){m.dataService.detectRelationshipSourceTable(z,{did:AB.tbid});});}else{l();}},failure:function(AA){var AB={success:false,errCode:AA.code,errMsg:AA.message};n.push(AB);l();}};I.forEach(e,function(AA){b.push({reportName:AA.n,reportAddress:AA.query,reportMimetype:AA.type===undefined?"":AA.type,reportDesc:AA.desc===undefined?"":AA.desc});});x.reports=b;w=mstrmojo.hash.copy(q,{xt:g,hasMultiOAuth:true,multiOAuthReports:JSON.stringify(x),dict:O.getBackendSourceType(t)});o.autoMappingSourceTable(j,w);},importMultiOAuthFileReports:function(b,w,d,e){var n=mstrApp.getRootController(),c=n.getModel(),p=n.dataService,l=c.externalSources[b],u=l&&l.getSourceInfoParam(true),t=0,q=null,j=null,k=[],AA;function z(){var AB=false,AC=[];I.forEach(d,function(AD){AC.push(AD.status);if(AD.status&&AD.status.success===false){AB=true;}});if(AB){if(e.failure){e.failure({reports:d,status:AC});}}else{if(e.success){e.success({reports:d,status:AC});}}if(e.complete){e.complete();}}function h(AB,AE){var AD={success:function(AF){AB.id=AB.tableID;AB.sheets=AF.sheets;if(AB.sheets.length>0){AB.sheets[0].selected=true;}AB.multiSelection=true;if(AE.success){AE.success();}if(AE.complete){AE.complete();}},failure:function(AF){if(AE.failure){AE.failure(AF);}if(AE.complete){AE.complete();}}};var AC={success:function(AF){if(AF&&AF.tbid){AB.tableID=AF.tbid;}AA=mstrmojo.hash.copy(u,{reportAddress:AB.query,reportDesc:AB.desc,reportMimetype:AB.type,reportName:AB.n});R(AA,AB.tableID,AD);},failure:function(AF){if(AE.failure){AE.failure(AF);}if(AE.complete){AE.complete();}}};p.createEMMASourceTable(AC,{xt:j,dict:O.getBackendSourceType(w)});}function g(){var AC=0,AD;mstrApp.showProgress();var AB={success:function(){AC++;if(AC>=AD){z();}},failure:function(AE){n.displayError(mstrmojo.desc(12901,"RS detection error."),false,AE.message);},complete:function(){if(AC>=AD){mstrApp.hideProgress();mstrApp.hideProgress();}}};AD=k.length;if(k.length>0){I.forEach(k,function(AE){p.detectRelationshipSourceTable(AB,{did:AE});});}else{AB.success();AB.complete();}}function m(AB,AC){AA=mstrmojo.hash.copy(u,{reportAddress:AB.query,reportDesc:AB.desc,reportMimetype:AB.type,reportName:AB.n});Z(AA,j,AB.sheets,AB.tableID,AC);}var x={success:function(AB){if(AB.tableIDs&&AB.tableIDs.length>0){k=k.concat(AB.tableIDs);}t++;if(t<d.length){q=d[t];m(q,x);}else{g();}},failure:function(AB){q.status.success=false;q.status.errCode=AB&&AB.res&&AB.res.code;q.status.errMsg=AB&&AB.res&&AB.res.message;t++;if(t<d.length){q=d[t];m(q,x);}else{g();}}};function o(){mstrApp.showProgress();t=0;q=d[t];AA=mstrmojo.hash.copy(u,{reportAddress:q.query,reportDesc:q.desc,reportMimetype:q.type,reportName:q.n});Z(AA,j,q.sheets,q.tableID,x);}var f={failure:function(AB){q.status.success=false;q.status.errCode=AB.code;q.status.errMsg=AB.message;},complete:function(){var AB=false,AE=[],AD=[],AC;t++;if(t<d.length){q=d[t];q.status={success:true};h(q,f);}else{I.forEach(d,function(AF){if(AF.sheets&&AF.sheets.length>1){AB=true;AD.push(AF);}else{AE.push(AF);}});if(AB){AC={items:AD,onOK:function(){d=this.items?this.items.concat(AE):AE;this.close();o();},onBack:function(){var AF=[];I.forEach(d,function(AG){if(AG.tableID){AF.push(AG.tableID);}});if(AF.length>0){n.dataService.removeEMMASourceTable(null,{did:AF.join()});}}};n.showDialog(a.dialogType.sheetsSelectionDialog,AC);}else{o();}}}};if(!l||!d||d.length<=0){z();return ;}switch(b){case a.sourceType.googleDrive:j=F.dataImportOAuthGDrive;break;case a.sourceType.dropbox:j=F.dataImportOAuthDropbox;break;}if(j===null){return ;}q=d[t];q.status={success:true};h(q,f);},refreshDataOAuthFileReport:function(m,q,l,h,d,p){var k=mstrApp.getRootController(),o=k.dataService,t=k.getModel().externalSources[m],b=null,u=t&&t.getSourceInfoParam(true),c=k.getModel().getImportSource(l),g=mstrmojo.hash.copy(u,{reportAddress:h.query,reportDesc:h.desc,reportMimetype:h.type,reportName:h.n});function n(w){if(p.failure){p.failure(w);}if(p.complete){p.complete();}}var f={success:function(){o.detectRelationshipSourceTable(p,{did:l});},failure:function(w){n(w);}};function j(){Z(mstrmojo.hash.copy(g,{behaviorFlags:a.behaviorChangeFlag.refreshData}),b,h.sheets,l,f,true);}var e={success:function(z){var x,w;h.sheets=z.sheets;h.multiSelection=false;h.defaultSheetsIndex=0;if(c&&c.sourceInfo){w=I.find(z.sheets,"idx",c.sourceInfo.sheetIndex);if(w>-1){h.defaultSheetsIndex=w;}}if(h.sheets.length>1){x={items:[h],onOK:function(){h=this.items[0];this.close();j();}};k.showDialog(a.dialogType.sheetsSelectionDialog,x);}else{h.sheets[0].selected=true;j();}},failure:function(w){n(w);}};switch(m){case a.sourceType.googleDrive:b=F.dataImportOAuthGDrive;break;case a.sourceType.dropbox:b=F.dataImportOAuthDropbox;break;}if(b===null){return ;}if(c){if(!c.isExtensionValid(h.n)){k.displayError(mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube."),false);return ;}}R(g,l,e);},importProjects:function(j,f,g){var b=mstrApp.getRootController(),h=b.dataService,e=null;function d(l){var k={code:l.code,message:l.message};if(e){h.removeEMMASourceTable({success:function(){if(j.failure){j.failure(k);}if(j.complete){j.canceled();}},failure:function(m){b.displayError(mstrmojo.desc(12902,"Remove EMMA Source Table Error."),false,m.message);}},{did:e});}else{if(j.failure){j.failure(k);}if(j.complete){j.complete();}}}var c={success:function(k){if(k&&k.tbid){e=k.tbid;}if(j.success){j.success(k);}},failure:function(k){d(k);}};h.createEMMASourceTable(c,{xt:a.xdaType.projectsImport,dbrId:f,cubeId:g});},importClipboard:function(c,l){var f=mstrApp.getRootController(),h=f.dataService,g=null,d=c.uploader;function j(n){var m={code:n.code,message:n.message};if(g){h.removeEMMASourceTable({success:function(){if(l.failure){l.failure(m);}if(l.complete){l.canceled();}},failure:function(o){f.displayError(mstrmojo.desc(12902,"Remove EMMA Source Table Error."),false,o.message);}},{did:g});}else{if(l.failure){l.failure(m);}if(l.complete){l.complete();}}}var e={success:function(){h.detectRelationshipSourceTable(l,{did:g});},failure:function(m){j(m);}};var b={success:function(){h.autoMappingSourceTable(e,{tbid:g,shtIx:0,dlmt:",",qt:'\\"'});},failure:function(m){j(m);},complete:function(){mstrApp.hideProgress();}};var k={success:function(m){if(m&&m.tbid){g=m.tbid;}h.importFile(d,b,{msgid:h.messageID,tableID:g});},failure:function(m){j(m);}};h.createEMMASourceTable(k,{xt:a.xdaType.dataImport,dict:a.backendSourceSubtype.clipboard});},refreshDataClipboard:function(h,d,c,l){var g=mstrApp.getRootController(),j=g.dataService,e=d.uploader;function k(m){if(l.failure){l.failure(m);}if(l.complete){l.complete();}}var f={success:function(){j.detectRelationshipSourceTable(l,{did:h});},failure:function(m){k(m);}};var b={success:function(){j.autoMappingSourceTable(f,{tbid:h,shtIx:0,behaviorFlags:a.behaviorChangeFlag.refreshData});},failure:function(m){k(m);},complete:function(){mstrApp.hideProgress();}};j.importFile(e,b,{msgid:j.messageID,tableID:h});},handleImportError:function J(j,f){var g=j.code,o=j.message;if(g===undefined||g===null){g=parseInt(j.getResponseHeader("X-MSTR-TaskErrorCode"),10);o=j.getResponseHeader("X-MSTR-TaskFailureMsg");}var h=mstrApp.getRootController();var c=h.model;if(g===a.backendError.cubeQuotaReached){o=mstrmojo.desc(13031,"We could not import your data because there is not enough space left. Please consider removing some rows/columns and try again or contact your administrator.");}else{if(g===a.backendError.fileVersionError){o=mstrmojo.desc(12612,"Excel 5.0/7.0 files are not supported. Save the file to Excel version 97/2000/XP/2003 or higher.");}else{if(g===a.backendError.salesforceUnsavedReport){o=mstrmojo.desc(12786,"Cannot upload data because the Salesforce report Active Accounts has not been saved. Please save the report and try again!");}else{if(g===a.backendError.emptySheet){o=mstrmojo.desc(12618,"The import process cannot proceed with an empty sheet.");}else{if(g===a.backendError.salesforceUnresolvedFilter){o=mstrmojo.desc(12789,"You cannot import a Salesforce report with any unresolved filters.");}else{if(g===a.backendError.noExternalSourceInfo){var b=o.indexOf("Google Analytics");var e=o.indexOf("\t");o=o.substring(b,e);}else{if(g===a.backendError.switchingFileType){o=mstrmojo.desc(12790,"Switching the source file type between Excel, CSV and Text is not allowed. You had previously used ####. Please use the same file type.").replace("####",c.currentSource.sourceInfo.name);}else{if(g===a.backendError.memoryConsumptionExceeded){var d="";if(o.indexOf("Max memory size limit: ")>-1){var l=o.indexOf("Max memory size limit: ")+23;var k=o.indexOf(".",l);d="("+o.substring(l,k)+") ";}o=mstrmojo.desc(12791,"Memory consumption limit during data fetching #### is exceeded.").replace("####",d);}else{if(g===a.backendError.switchingFileType){o=mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube.");}else{if(g===a.backendError.unsupportedFileFormat){o=mstrmojo.desc(12619,"Only UTF 8/16 CSV or text files are supported. Save the file as UTF or 16 codepage and import again.");}}}}}}}}}}var n="<ul><li>"+f+"<br>"+o||N(j)+"</li></ul>";return n;},importFile:function S(f,h,p,n,b,c,g){var m=mstrApp.getRootController();var l,k,j=null;var e={success:function(){var u=m.model.getAllTableID();if(b){m.tablesSrc[b]=[];for(k=0;k<u.length;k++){if(I.indexOf(l,u[k])===-1){m.tablesSrc[b].push(u[k]);}}if(j&&j.length){for(k=0;k<u.length;k++){m.navigationController.deleteRoute(j[k]);}}}var q=a.requestFlag.mapping|a.requestFlag.sourceInfo|a.requestFlag.relationship,t=p?0:-1;m.getImportedDataEMMA(H.importSource,q,t);},failure:function(q){C.call(m,q);},complete:function(){mstrApp.hideProgress();}};var o={success:function(q){if(q&&q.msgid){m.dataService.set("messageID",q.msgid);}if(c){Y.call(m,b,f,h,p,a.sourceSubtype.localFile,g);}else{M.call(m,b,f,h,p,a.sourceSubtype.localFile,e);}},failure:function(q){m.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,q.message||"");}};var d={success:function(){l=m.model.getAllTableID();if(n){m.createNewReportInstance(o);}else{if(c){Y.call(m,b,f,h,p,a.sourceSubtype.localFile,g);}else{M.call(m,b,f,h,p,a.sourceSubtype.localFile,e);}}},failure:function(){m.displayError(mstrmojo.desc(12903,"remove previous imported table failed"));}};if(b){j=[];for(k=0;m.tablesSrc[b]&&k<m.tablesSrc[b].length;k++){if(m.model.getImportSource(m.tablesSrc[b][k])){j.push(m.tablesSrc[b][k]);}}P.call(m,j,d,b);}else{d.success();}},importURL:function D(e,b,q,o,c,d,h){var m=mstrApp.getRootController();var l,k,j;var n=a.sourceSubtype.url;if(e.scriptClass==="mstrmojo.DI.DISampleFiles"){n=a.sourceSubtype.samplefile;}if(e.scriptClass==="mstrmojo.DI.DIPublicData"){n=a.sourceSubtype.publicData;}var g={success:function(){var w=m.model.getAllTableID();if(c){m.tablesSrc[c]=[];for(k=0;k<w.length;k++){if(I.indexOf(l,w[k])===-1){m.tablesSrc[c].push(w[k]);}}if(j&&j.length){for(k=0;k<w.length;k++){m.navigationController.deleteRoute(j[k]);}}}var t=a.requestFlag.mapping|a.requestFlag.sourceInfo|a.requestFlag.relationship,u=q?0:-1,x;x={onOK:function(){m.getImportedDataEMMA(H.importSource,t,u);},onCancel:function(z){m.getImportedDataEMMA(H.importSource,t,u,undefined,undefined,undefined,undefined,z);}};if(!m.rootView.currentPage.tableID){m.autoDetectPartitionGroups(x,u);}else{m.getImportedDataEMMA(H.importSource,t,u);}},failure:function(t){C.call(m,t);}};var p={success:function(t){if(t&&t.msgid){m.dataService.set("messageID",t.msgid);}Y.call(m,c,e,b,q,n,h);},failure:function(t){m.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,t.message||"");}};var f={success:function(){l=m.model.getAllTableID();if(o){m.createNewReportInstance(p);}else{if(d){Y.call(m,c,e,b,q,n,h);}else{M.call(m,c,e,b,q,n,g);}}},failure:function(){m.displayError(mstrmojo.desc(12903,"remove previous imported table failed"));}};if(c){j=[];for(k=0;m.tablesSrc[c]&&k<m.tablesSrc[c].length;k++){if(m.model.getImportSource(m.tablesSrc[c][k])){j.push(m.tablesSrc[c][k]);}}P.call(m,j,f,c);}else{f.success();}},removeMultipleSourceTables:function A(c){var b=mstrApp.getRootController();var d={success:function(){},failure:function(){b.displayError(mstrmojo.desc(12904,"Failed to remove 1 or more tables"));}};P.call(b,c,d);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.range","mstrmojo.Widget","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo._HasSuggestion","mstrmojo.ME.MetricToken","mstrmojo.ME.MetricDataService","mstrmojo.ui.ScrollableSuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var M=mstrmojo.dom,O=mstrmojo.css,AB=mstrmojo.Enum_Keys,D=mstrmojo.range,c=D.EDGE,q=mstrmojo.ME.MetricToken.isDelimiter,L=mstrmojo.expr,h=mstrmojo.array,H=mstrmojo.hash;function AI(E){return E.ctrlKey||M.isMetaKey(window,E);}mstrmojo.ME.SpanListMapper=mstrmojo.provide("mstrmojo.SpanListMapper",mstrmojo.mixin({itemWrapperPrefix:function(E){return'<span class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"&nbsp;",itemWrapperSuffix:"</span>",createWrapperNode:function N(E){var AJ=E.ownerDocument,AK=AJ.createElement("span");return AK;},_iw2idx:function P(AJ,AM,AL){var AK=this.wrapperNodes(AM),E=mstrmojo.array.indexOf(AK,AL);return E===-1?AK.length:E;},itemOffsetLeft:function a(AJ,AN,E,AL){if(!AL){var AK=this.wrapperNodes(AN);AL=AK&&AK[E];if(!AL){return 0;}}var AM=AN.firstChild;if(!AM||(AM===AL)){return 0;}return AL.offsetLeft-AM.offsetLeft;},whereDrop:function AH(AR,E,AL,AQ,AJ){var AN=this._nd2iw(AR,E,AL),AS,AP,AM,AO,AK;if(AN){AP=this._iw2idx(AR,E,AN);AS=AP;AM=this.itemOffsetLeft(AR,E,null,AN);AO=AN.offsetTop;AK=AN.offsetWidth;if(AQ.x>AJ.left+AM+AK/2){AS++;AM+=AK;}}else{return AR.dropCuePos;}return{left:AM,top:AO,idx:AS,idxActual:AP};}},mstrmojo.hash.copy(mstrmojo.WidgetListMapper)));mstrmojo.ME.TokenInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._HasSuggestion],{scriptClass:"mstrmojo.ME.TokenInputBox",containerResizable:false,dropZone:true,suggestionPopupCssClss:"mstrmojo-ME-TokenInputBox-suggest",allowDrop:function C(E){var AJ=E.src.data;return !!AJ;},ondrop:function(E){E.src.data={v:mstrmojo.ME.MetricToken.brackets(E.src.data.item.n),oi:H.copyProps(["did","n","t"],E.src.data.item),isNew:true};if(this.prepareDropItem){this.prepareDropItem(E);}this.insertTokens([E.src.data]);this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");},ondragenter:function F(E){this.dragdata=E.src.data;this._super(E);this.set("dropCuePos",{left:0,top:0});mstrmojo.css.addClass(this.domNode,"unselectable");},ondragleave:function Q(){this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");},ondropCuePosChange:function S(AJ){var AK=AJ.value,E=this.dragdata;if(E&&E.setAvatarClass){if(AK){E.setAvatarClass("add");}else{E.setInvalidAvatarClass();}}},makeObservable:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,markupString:'<div id={@id} class="mstrmojo-TokenInputBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-TokenInputBox-edit" contenteditable="true" tabindex="1" spellcheck="false"ondragstart = "return false;" oncontextmenu = "document.oncontextmenu =  mstrmojo.all.{@id}.fnContextMenu;" onkeydown = "return mstrmojo.all.{@id}.handlekeydown(event);" onkeypress = "return mstrmojo.all.{@id}.handlekeypress(event);" onkeyup = "return mstrmojo.all.{@id}.handlekeyup(event);" onmouseup = "return mstrmojo.all.{@id}.handlemouseup(event);" onpaste = "return mstrmojo.all.{@id}.handlepasteDirect(event);" >{@itemsHtml}</div><textarea class = "mstrmojo-TokenInputBox-clipboard" onkeyup = "return mstrmojo.all.{@id}.handlepaste(event);"></textarea><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild;},clipboardNode:function(){return this.domNode.childNodes[1];},scrollboxNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",items:null,itemFunction:function G(AK,E,AJ){return new mstrmojo.ME.MetricToken({data:AK,parent:AJ});},listMapper:mstrmojo.ME.SpanListMapper,_set_items:function R(AJ,E){if(this._super){this._super(AJ,E);}if(!this.tokensCacheInitilized){this.pretokensModify();this.tokensCacheInitilized=true;}},tokensCache:[],tokensCachePointer:0,isDelimiter:q,postBuildRendering:function X(){if(this._super){this._super();}this._eros=false;if(M.isFF){document.body.spellCheck=false;}},fnContextMenu:function I(E){if(E){E.cancelBubble=true;E.returnValue=false;}return false;},handlekeydown:function V(AO){AO=AO||window.event;var AM=AO.keyCode||AO.charCode,AK=false,AP=D.getRangeInfo();if((AI(AO)||AM===AB.LEFT_ARROW||AM===AB.RIGHT_ARROW)&&this.doubleByte){this.doubleByte=false;var AN=this.prev_rInfo,AJ=AP,AQ=AJ.startContainer.data.slice(AN.startOffset,AP.startOffset);this.widgetHandleImeInput(AN,AQ);return ;}switch(AM){case AB.DELETE:if(!this.doubleByte){try{this.widgetHandleDelete(AP);this.startTokenSuggestion();this.raiseChangeEvent({type:"delete"});}catch(AL){}AK=true;}break;case AB.BACKSPACE:if(!this.doubleByte){try{this.widgetHandleBackspace(AP);this.raiseChangeEvent({type:"backspace"});this.startTokenSuggestion();this.editNode.focus();}catch(E){}AK=true;}break;case AB.ENTER:if(this.breakOnEnterKeyDown&&this.breakOnEnterKeyDown()){break;}case AB.TAB:this._startDebug=true;if(this.suggestionShown){this.handleSuggestionItemSelect(this.getSelected());}else{this.startTokenSuggestion();}AK=true;break;case AB.ESCAPE:this.endTokenSuggestion();AK=true;break;case 86:if(AI(AO)){this._saveRangeInfo=D.getRangeInfo();if(!this._saveRangeInfo.collapsed){this.widgetHandleDelete(this._saveRangeInfo);this._saveRangeInfo=D.getRangeInfo();}this.clipboardNode.focus();AK=false;}break;case 89:if(AI(AO)){this.widgetHandleUndoRedo("redo");AK=true;}break;case 90:if(AI(AO)){this.widgetHandleUndoRedo("undo");AK=true;}break;case 229:if(!this.doubleByte){this.doubleByte=true;this.prev_rInfo=AP;this.prev_items=this.items;}break;default:}if(AK){M.stopPropogation(window,AO);M.preventDefault(window,AO);return false;}return true;},getCharacter:function AD(AJ){var E=(M.isIE&&!M.isIE9)?AJ.keyCode:AJ.charCode;return(E>0)?String.fromCharCode(E):null;},handlekeypress:function A(AL){AL=AL||window.event;var AM=this.getCharacter(AL),AJ=false;if(AM&&!((AM==="c"||AM==="a")&&AI(AL))){try{this.widgetHandleInput(D.getRangeInfo(),AM);this.raiseChangeEvent({type:"input",character:AM});if(!this.isDelimiter(AM)){if(this.useKeyDelay){var AK=this;window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){AK.startTokenSuggestion();},mstrmojo.ME.MetricDataService.suggestDelay);}else{this.startTokenSuggestion();}}else{this.endTokenSuggestion(true);}}catch(E){}AJ=true;}if(AJ){M.stopPropogation(window,AL);M.preventDefault(window,AL);return false;}return true;},handlekeyup:function Y(AK){var E=AK.keyCode||AK.charCode,AJ;if(E===AB.LEFT_ARROW||E===AB.RIGHT_ARROW){AJ=this.findObjectToken();if(AJ&&AJ===this._saveActiveToken){this.startTokenSuggestion(AJ);}else{this.endTokenSuggestion();}}else{if(E===AB.UP_ARROW){this.preHighlight();}else{if(E===AB.DOWN_ARROW){this.nextHighlight();}}}this._saveRangeInfo=D.getRangeInfo();},handlemouseup:function g(AO){if(this.dropCuePos){return false;}var AK=this.findObjectToken();if(AK&&AK===this._saveActiveToken){this.startTokenSuggestion(AK);}else{this.endTokenSuggestion();}var AM=D.getRangeInfo();if(this.doubleByte){this.doubleByte=false;var AN=this.prev_rInfo,AL=this._saveRangeInfo,AJ=AL.startContainer.data.slice(AN.startOffset,AL.startOffset+1);if(AJ!==""){var E=this.widgetHandleImeInput(AN,AJ);this.prev_items=this.items;AK=M.findWidget(AM.startContainer);if(AK){this._delaySetTextCaretPos(AK.domNode,AM.startOffset);}else{this._delaySetTextCaretPos(E.domNode,AM.startOffset-1);}}this.prev_rInfo=AM;}this._saveRangeInfo=AM;},handlepasteDirect:function x(E){this.clipboardNode.value=E.clipboardData.getData("Text");this.handlepaste(E);M.stopPropogation(window,E);M.preventDefault(window,E);return false;},handlepaste:function e(AN){var AJ=this.clipboardNode.value;this.clipboardNode.value="";var AM=[],E=AJ&&AJ.length,AL,AK="",AO;if(E>0){for(AL=0;AL<E;AL++){AO=AJ.charAt(AL);if(this.isDelimiter(AO)){if(!mstrmojo.string.isEmpty(AK)){AM.push({v:AK,isNew:true});AK="";}AM.push({v:AO,isDelimiter:true,isNew:true});}else{AK=AK+AO;}}if(!mstrmojo.string.isEmpty(AK)){AM.push({v:AK,isNew:true});AK="";}this.insertTokens(AM);}},raiseChangeEvent:function(E){E.name="tokensModify";this.raiseEvent(E);},getTokensAsString:function AG(){var AJ=[],AL=this.items,AK,E;for(AK=0,E=AL.length;AK<E;AK++){AJ[AK]=AL[AK].v;}return AJ.join("| ");},replaceErrorToken:function j(AL){var AK=this.items||[],AM=mstrmojo.array.find(AK,"sta",-1),AJ,AN=function(AT,AR,AU){var AQ=(AT&&AT.items)||[],AP=h.find(AQ,"did",AR),AO,AS;if(AP>-1){AO=AQ[AP].fs;AS=h.filterOne(AO,function(AV){return AV.fnm&&AV.fnm.toUpperCase()===AU.toUpperCase();});}return AS;},E=function(AT,AR,AS){var AO={v:AR.n,oi:AR,isNew:true},AQ=AT.v&&AT.v.split("@"),AP;if(AQ&&AQ.length>1){AP=AN(AS,AR.did,AQ[1]);if(AP){AO.exv=AP.fmdid||AP.fid;AO.extp=8;AO.v=mstrmojo.ME.MetricToken.brackets(AR.n)+"@"+AP.fnm;}}return AO;};if(AM>-1){AJ=E(AK[AM],AL,this.candidates);this.remove(AM);this.add([AJ],AM);}},widgetHandleDelete:function Z(AM){if(AM.collapsed){var AL,AK,E,AN=AM.startOffset,AJ=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AM.startContainer,false,document.body)){D.collapseOnNode(this.editNode,false);return ;}AL=D.getEdgeInfo(AM.startContainer,AM.startOffset);AK=M.findWidget(AM.startContainer);E=this.itemIndex(AK.data);if(AL===c.EDGE_END){E++;AK=AJ[E];AN=0;}if(!AK){D.collapseOnNode(this.editNode,false);return ;}if(AK.length()===1){this.remove(E);AK=AJ[E];if(AK){D.collapseOnNode(AK.domNode,true);}else{D.collapseOnNode(this.editNode,false);}this.checkMergeTwoTokens(E-1,E);}else{AK.spliceContent(AN,1);D.collapseOnTextNode(AK.domNode,AN);}}else{this.widgetDeleteTokens(AM);}},widgetHandleBackspace:function p(AM){if(AM.collapsed){var AL,AK,E,AN=AM.startOffset,AJ=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AM.startContainer,false,document.body)){if(AM.startOffset>0&&M.isFF){AK=AJ[this.items.length-1];D.collapseOnNode(AK.domNode,false);AM=D.getRangeInfo();AL=D.getEdgeInfo(AM.startContainer,AM.startOffset);}else{D.collapseOnNode(this.editNode,true);return ;}}AL=D.getEdgeInfo(AM.startContainer,AM.startOffset);AK=M.findWidget(AM.startContainer);E=this.itemIndex(AK.data);if(AL===c.EDGE_BEGIN){E--;AK=AJ[E];AN=AK.length();}if(!AK){D.collapseOnNode(this.editNode,true);return ;}if(AK.length()===1){this.remove(E);AK=AJ[E-1];if(AK){D.collapseOnNode(AK.domNode,false);this.checkMergeTwoTokens(E-1,E);AK=AJ[E-1];}else{D.collapseOnNode(this.editNode,true);}}else{AK.spliceContent(AN-1,1);D.collapseOnTextNode(AK.domNode,AN-1);}}else{this.widgetDeleteTokens(AM);}},widgetHandleInput:function t(AN,AO){if(!AN.collapsed){this.widgetDeleteTokens(AN);AN=D.getRangeInfo();}var AK,AP,AQ,AR,E,AJ,AL=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AN.startContainer,false,document.body)){this.add([{v:AO,isDelimiter:this.isDelimiter(AO),isNew:true}],0);AP=AL[0];D.collapseOnTextNode(AP.domNode,1);return ;}AK=D.getEdgeInfo(AN.startContainer,AN.startOffset);AP=M.findWidget(AN.startContainer);AQ=this.itemIndex(AP.data);if(this.isDelimiter(AO)){AR={v:AO,isDelimiter:true,isNew:true};if(AK===c.EDGE_MIDDLE){var AM=AP.split2Tokens(AN.startOffset);this.remove(AQ);this.add([AM[0],AR,AM[1]],AQ);AQ=AQ+1;}else{AQ=(AK===c.EDGE_BEGIN)?AQ:AQ+1;this.add([AR],AQ);}AP=AL[AQ];D.collapseOnNode(AP.domNode,false);}else{AJ=AN.startOffset;if(AP.isDelimiter()){E=AL[(AK===c.EDGE_BEGIN)?AQ-1:AQ+1];if(E&&!E.isDelimiter()){AP=E;AJ=(AK===c.EDGE_BEGIN)?AP.length():0;}}if(!AP.isDelimiter()){AP.spliceContent(AJ,0,AO);D.collapseOnTextNode(AP.domNode,AJ+1);}else{this.add([{v:AO,isNew:true}],(AK===c.EDGE_BEGIN)?AQ:AQ+1);AP=AL[(AK===c.EDGE_BEGIN)?AQ:AQ+1];D.collapseOnNode(AP.domNode,false);}}},widgetHandleImeInput:function t(AM,AN){if(!AM.collapsed){this.widgetDeleteTokens(AM);AM=D.getRangeInfo();}var AK,AO,AP,AQ,E,AJ,AL=this.ctxtBuilder.itemWidgets;if(!M.contains(this.editNode,AM.startContainer,false,document.body)){this.clearTokens();this.add([{v:AN,isDelimiter:this.isDelimiter(AN),isNew:true}],0);AL=this.ctxtBuilder.itemWidgets;AO=AL[0];D.collapseOnTextNode(AO.domNode,1);this._delaySetCaretPos(AO.domNode,false);return ;}AK=D.getEdgeInfo(AM.startContainer,AM.startOffset);AO=M.findWidget(AM.startContainer);AP=this.itemIndex(AO.data);AJ=AM.startOffset;if(AO.isDelimiter()){this.clearTokens();this.set("items",this.prev_items);AL=this.ctxtBuilder.itemWidgets;E=AL[(AK===c.EDGE_BEGIN)?AP-1:AP+1];if(E&&!E.isDelimiter()){AO=E;AJ=(AK===c.EDGE_BEGIN)?AO.length():0;}}if(!AO.isDelimiter()){AO.spliceContent(AJ,0,AN);this._delaySetTextCaretPos(AO.domNode,AJ+AN.length);}else{this.add([{v:AN,isNew:true}],(AK===c.EDGE_BEGIN)?AP:AP+1);AO=AL[(AK===c.EDGE_BEGIN)?AP:AP+1];this._delaySetCaretPos(AO.domNode,false);}this.startTokenSuggestion();return AO;},findObjectToken:function B(){var AM=D.getRangeInfo(),AK=M.findWidget(AM.startContainer);if(!M.contains(this.editNode,AM.startContainer,false,document.body)){return null;}if(!AK||AK===this||!AK.isDelimiter){return null;}if(AK&&!AK.isDelimiter()){return AK;}var AL=D.getEdgeInfo(AM.startContainer,AM.startOffset),AJ=this.ctxtBuilder.itemWidgets,E=this.itemIndex(AK.data);AK=AJ[(AL===c.EDGE_BEGIN)?E-1:E+1];if(AK&&!AK.isDelimiter()){return AK;}return null;},checkMergeTwoTokens:function n(AM,AK){var AL=this.ctxtBuilder.itemWidgets,AJ=AL[AM],E=AL[AK];if((AJ&&!AJ.isDelimiter())&&(E&&!E.isDelimiter())){this.remove([AM,AK]);this.add([AJ.mergeTo(E)],AM);D.collapseOnTextNode(AL[AM].domNode,AJ.length());}},insertTokens:function w(AP){var E=0,AJ=this.editNode;var AO=this._saveRangeInfo||D.getRangeInfo();if(!AO||!M.contains(AJ,AO.startContainer,false,document.body)){this.add(AP);E=this.items.length-1;this._delaySetTextCaretPos(AJ,(AJ.innerText||AJ.textContent).length);}else{var AN=D.getEdgeInfo(AO.startContainer,AO.startOffset),AK=M.findWidget(AO.startContainer);E=this.itemIndex(AK.data);if(AN===c.EDGE_MIDDLE){var AM=AK.split2Tokens(AO.startOffset);this.remove(E);AP.unshift(AM[0]);AP.push(AM[1]);this.add(AP,E);}else{E=(AN===c.EDGE_BEGIN?E:E+1);this.add(AP,E);}E=E+AP.length-1;AK=this.ctxtBuilder.itemWidgets[E];this._delaySetCaretPos(AK.domNode,false);}this.raiseChangeEvent({type:"insert"});var AL=this;window.setTimeout(function(){AL._saveRangeInfo=D.getRangeInfo();},50);return E;},insertParenthesisTokens:function AA(AJ){var E=this;window.setTimeout(function(){var AK=E.insertTokens([{v:"(",isDelimiter:true,isNew:true},{v:")",isDelimiter:true,isNew:true}]);E._delaySetTextCaretPos(E.itemsContainerNode.childNodes[AK]);},AJ||50);},clearTokens:function m(E){this.set("items",E||[]);this._saveRangeInfo=null;this._delaySetCaretPos(this.editNode,false);},focus:function u(){var AJ=this.ctxtBuilder.itemWidgets,E=AJ.length;this._delaySetCaretPos(E>0?AJ[E-1].domNode:this.editNode,false);},startTokenSuggestion:function AC(E){this.endTokenSuggestion();if(!E){E=this.findObjectToken();}if(E&&!E.isDelimiter()){E.set("active",true);this._saveActiveToken=E;this.showSuggestion(this.getSearchPattern());}if(!E||this.getSearchPattern().length===0){this.hideSuggestion();}},browseItemVisible:true,folderLinksContextId:25,browsableTypes:[L.TP.FOLDER,L.TP.FACT,L.TP.ATTR,L.TP.FUNCTION,L.TP.FILTER,L.STP.PROMPT_OBJECTS,L.TP.ATTR,L.TP.DIM,L.TP.METRIC,L.TP.ROLE].join(","),getSearchPattern:function U(){var AJ=this._saveActiveToken,AL=AJ&&AJ.data.v,E=AL&&AL.length;if(E>2){if(AL.charAt(0)==="["){AL=AL.substring(1);}if(AL.charAt(AL.length-1)==="]"){AL=AL.substring(0,AL.length-1);}}if(AJ&&AJ.data.ift){var AK=AJ.data.v,AM=AK&&AK.indexOf("@");if(AM>=0){AL=AK.substring(AM);}}return AL||"";},getSuggestionPos:function b(){var E=this._saveActiveToken,AJ=null,AL,AK;if(E){AL=E.data&&E.data.ift;AK=mstrmojo.dom.position(E.domNode,true);AJ={left:Math.round(AK.x+(AL?AK.w:0))+"px",top:Math.round(AK.y+AK.h)+"px",zIndex:100};}return AJ;},item2textCss:function J(AJ){var E=(this._super&&this._super(AJ))||{4:"m",11:"fx",12:"a",13:"fc",43:"tr",21:"afm","-99":"br"}[AJ.t]||"";E+=AJ.da?" da":"";E+=(AJ.dm||AJ.um)?" dm":"";E+=AJ.de?" de":"";E+=AJ.fs&&AJ.fs.length&&AJ.fs.some(function(AK){return AK.fgr>0;})?" g":"";return E;},onBrowserOpen:function o(){this.editNode.blur();},onSuggestionItemSelect:function z(AJ){var E=this._saveActiveToken;this.endTokenSuggestion();if(E){if(E.data.ift&&AJ.t===21){E.setFormInfo(AJ);}else{E.setItemInfo(AJ);if(AJ.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){this.insertParenthesisTokens();}}this._delaySetCaretPos(E.domNode,false);}this.closePopup();},_delaySetCaretPos:function AE(E,AK){var AJ=this.editNode,AL=this,AM=function(){AJ.focus();AJ.focus();D.collapseOnNode(E,AK);AL._saveRangeInfo=D.getRangeInfo();};window.setTimeout(AM,0);},_delaySetTextCaretPos:function AE(E,AM){var AJ=this.editNode,AK=this,AL=function(){AJ.focus();AJ.focus();D.collapseOnTextNode(E,AM);AK._saveRangeInfo=D.getRangeInfo();};window.setTimeout(AL,0);},getCandidatesThroughTaskCall:function W(AJ,E){AJ.objectType="11,12,13,43,4";AJ.rootFolderType=39;AJ.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AJ,E);},filterCandidates:function l(AM,AL,E){var AJ=this._saveActiveToken,AN=AJ&&(AJ.data.oi||AJ.data.at),AK;if(AN&&AJ.data.ift){E=E||this.suggestCount;AL=mstrmojo.string.regEscape(AL);AK=h.filter(AM,function(AO){return AO.t===21&&AO.attid===AN.did&&(new RegExp("^"+AL,"i")).test("@"+AO.n);},{max:E});}else{AK=h.filter(AM,function(AO){return AO.t!==21;});AK=this._super(AK,AL,E);}return AK;},endTokenSuggestion:function AF(AJ){var E=this._saveActiveToken;if(E){if(AJ){this.hideSuggestion();}E.set("active",false);this._saveActiveToken=null;}},widgetDeleteTokens:function f(AR){var AJ=AR.startOffset,E=AR.endOffset,AU=M.findWidget(AR.startContainer),AS=M.findWidget(AR.endContainer),AN=this.itemIndex(AU.data),AL=this.itemIndex(AS.data),AO=[],AP=D.getEdgeInfo(AR.startContainer,AJ),AT=D.getEdgeInfo(AR.endContainer,E),AQ=(AP===c.EDGE_BEGIN?AN:AN+1),AK=(AT===c.EDGE_END?AL:AL-1),AM;if(AU===AS){if((AP===c.EDGE_BEGIN)&&(AT===c.EDGE_END)){this.remove(AN);AS=this.ctxtBuilder.itemWidgets[AN===0?AN:AN-1];if(AS){D.collapseOnNode(AS.domNode,AN===0);}else{D.collapseOnNode(this.editNode,true);}}else{AU.spliceContent(AJ,E-AJ);D.collapseOnTextNode(AS.domNode,AJ);}}else{for(AM=AQ;AM<=AK;AM++){AO.push(AM);}this.remove(AO);if(AP===c.EDGE_MIDDLE){AU.spliceContent(AJ);}if(AT===c.EDGE_MIDDLE){AS.spliceContent(0,E);}if(AP===c.EDGE_BEGIN){AU=this.ctxtBuilder.itemWidgets[AN===0?AN:AN-1];}if(AU){D.collapseOnNode(AU.domNode,AN===0);}else{D.collapseOnNode(this.editNode,false);}AN=(AP===c.EDGE_BEGIN)?AN-1:AN;this.checkMergeTwoTokens(AN,AN+1);}this.editNode.focus();},oncandidatesChange:function k(){var AJ=this.candidates,E=(AJ&&AJ.items)||[];if(!this.noCache&&AJ&&AJ.isComplete){this.suggestCount=this.REQUEST_THRESHOLD=E.length;}else{this.suggestCount=mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=20;}},nudge:function(E){var AJ=this.getSuggestionPos();if(AJ){E.set("left",AJ.left);E.set("top",AJ.top);}},pretokensModify:function K(){this.tokensCache=this.tokensCache.slice(0,this.tokensCachePointer);var E=this.findObjectToken();this.tokensCache.push({items:H.clone(this.items),rInfo:D.getRangeInfo(),idx:E!==null?this.itemIndex(E.data):-1});this.tokensCachePointer=this.tokensCache.length;},widgetHandleUndoRedo:function d(AK){var AL,E,AJ=function(AN){if(!AN){return ;}AN=AN||{};this.set("items",H.clone(AN.items));var AQ=this.ctxtBuilder.itemWidgets,AM=AQ[AN.idx],AP=AM&&AM.domNode||this.editNode,AO=AN.rInfo;this._delaySetTextCaretPos(AP,AO&&AO.startOffset||0);};switch(AK){case"undo":AL=--this.tokensCachePointer;if(AL>-1){E=this.tokensCache[AL-1];AJ.call(this,E);}else{this.tokensCachePointer=1;}break;case"redo":AL=this.tokensCachePointer++;if(AL>-1&&AL<this.tokensCache.length){E=this.tokensCache[AL];AJ.call(this,E);}else{this.tokensCachePointer=Math.min(Math.max(this.tokensCachePointer,1),this.tokensCache.length);}break;}},resetTokensCache:function T(){this.tokensCache=[];this.tokensCachePointer=-1;this.tokensCacheInitilized=false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo._HasSuggestion");var F=-1,E=0,D=1;mstrmojo._ValidateSuggestions=mstrmojo.provide("mstrmojo._ValidateSuggestions",mstrmojo.hash.copy(mstrmojo._HasSuggestion,{_mixinName:"mstrmojo._ValidateSuggestions",itemValidationField:"did",verifyObject:function C(J,H){var M=this.candidates,L;if(M){var I=M.items,G=mstrmojo.array.find(I,this.itemValidationField,H.data[this.itemValidationField]);G=G>-1?G:mstrmojo.array.find(I,this.itemField,J);if(G>-1){H.updateData(I[G]);L=E;}else{if(M.isComplete){L=D;}}}if(L!==undefined){return L;}var K=this._vqueue=this._vqueue||[];K.push({pattern:J,id:H.data[this.itemIdField]});if(!this._vInProgress){this.verifyNextCandidate();}return F;},verifyNextCandidate:function B(){var G=this._vqueue;if(!G||G.length===0){this._vInProgress=false;return ;}this.verifyCandidate(G.shift());},verifyCandidate:function A(H){var G=this;this._vInProgress=true;this.getCandidatesThroughTaskCall({pattern:H.pattern,blockBegin:1,blockCount:G.noCache?-1:this.suggestCount,isVerify:true},{success:function(N){var K=G.ctxtBuilder.itemWidgets,J=K&&K.length,O,M;for(M=0;M<J;M++){if(K[M].data[G.itemIdField]===H.id){O=K[M];break;}}if(!O){return ;}var L=N.items;if(L&&L.length===1){O.updateData(L[0]);}else{if(L&&L.length>1){var I=mstrmojo.array.find(L,"did",O.data.did);if(I>-1){O.updateData(L[I]);}else{O.set("state",D);}}else{O.set("state",D);}}},failure:function(I){mstrmojo.alert(I.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){G.verifyNextCandidate();}});}}));mstrmojo._ValidateSuggestions.ENUM_STATES={UNDETERMINED:F,VALID:E,INVALID:D};}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DIMultiFormEditor","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(13134,13136,13396,13887,14451);var d=mstrmojo.DI.DIConstants,D=mstrmojo.DI.DIConstants.formsOptions,M=mstrmojo.array,V=mstrmojo.hash,H=mstrmojo.DI.DIHelpers;function J(h,g){var k=h.linkedTbs,e=h.tableId,j=g.linkedTbs,n=g.tableId,l,m,f;if(!k&&!j){return e===n;}if(k&&j){l=false;V.forEach(j,function(o,p){if(o){if(k[p]){l=true;return false;}}});return l;}m=k||j;f=k?n:e;return m[f];}mstrmojo.DI.controller.DIFormsController=mstrmojo.declare(mstrmojo.Obj,null,{getLinkedAttribute:function X(e){var f,g=[];for(f=0;f<e.length;f++){if(this.isLinkedAttribute(e[f])){g.push(e[f]);}}return g;},countLinkedAttribute:function X(e){var g=0,f;for(f=0;f<e.length;f++){if(this.isLinkedAttribute(e[f])){g++;}}return g;},countSingleFormLinkedAttribute:function P(e){var g=0,f;for(f=0;f<e.length;f++){if(this.isLinkedAttribute(e[f])&&this.isAllSingleFormAttribute(e[f])){g++;}}return g;},getLinkedColumnId:function I(h,e,j){var g,f;if(this.isLinkedAttribute(h)&&!this.isSingleFormAttribute(h)){f=h.subColumns;for(g=0;g<f.length;g++){if(f[g].fmid===j||f[g].isIdForm){return f[g].did;}}}else{for(g=0;g<e.length;g++){if(this.isLinkedAttribute(e[g])){return e[g].did;}}}},isLinkedAttribute:function c(e){return e.isLinked;},isSingleFormAttribute:function O(e){return !(e.isMultiForm);},isAllSingleFormAttribute:function(g){var f=true,e;if(!g.isLinked){f=!(g.isMultiForm);}else{e=mstrApp.getRootController().getModel().findMappingItem(g);M.forEach(e,function(h){if(h.isMultiForm){f=false;return false;}});}return f;},isVisible:function U(f,e){switch(f){case D.ADDTO_MULTIFORM_ATTRIBUTE:return this.isVisibleAddtoMultiformAttribute(e);case D.CREATE_MULTIFORM_ATTRIBUTE:return this.isVisibleCreateMultiformAttribute(e);case D.EDIT_MULTIFORM_ATTRIBUTE:return this.isVisibleEditMultiformAttribute(e);}return false;},isVisibleAddtoMultiformAttribute:function N(f){if(f.length<2){return false;}var g=0,e;for(e=0;e<f.length;e++){if(!(this.isAllSingleFormAttribute(f[e]))){g++;}if(g>=2){return false;}if(f[e].ipa){return false;}if(!J(f[0],f[e])){return false;}}return(g===1);},isVisibleCreateMultiformAttribute:function Z(f){if(f.length<2){return false;}var e;for(e=0;e<f.length;e++){if(!(this.isAllSingleFormAttribute(f[e]))){return false;}if(f[e].ipa){return false;}}return true;},isVisibleEditMultiformAttribute:function T(e){if(e.length!==1){return false;}return !(this.isSingleFormAttribute(e[0]))&&e[0].subColumns&&e[0].subColumns[0].ipa!==1;},onClick:function G(f,h,g,e){switch(f){case D.ADDTO_MULTIFORM_ATTRIBUTE:this.onClickAddtoMultiformAttribute(h,e);break;case D.CREATE_MULTIFORM_ATTRIBUTE:this.onClickCreateMultiformAttribute(h,g,e);break;case D.EDIT_MULTIFORM_ATTRIBUTE:this.onClickEditMultiformAttribute(h,g);break;}},onClickAddtoMultiformAttribute:function C(h,f){var g=null,e;for(e=0;e<f.length;e++){if(!(this.isAllSingleFormAttribute(f[e]))){if(g!==null){return ;}g=f[e];}}var j=this.countSingleFormLinkedAttribute(f);if(this.isLinkedAttribute(g)){if(j>=1){this.showUnlinkError();}else{this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,h,g,f,true);}}else{if(j>=2){this.showUnlinkError();}else{if(j===1){g=this.getLinkedAttribute(f)[0];this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,h,g,f,true);}else{this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,h,g,f,false);}}}},checkMultiLinkedAttributes:function L(o){var m=this.getLinkedAttribute(o);var l=mstrApp.getRootController();var k=l.model;var t,q=[],n;M.forEach(m,function(j){n="";t=k.findMappingSource(j);M.forEach(t,function(u){n+=u.tableID;n+=";";});q.push(n);});var p=q[0].split(";");var h,g,f=false,e=p.length;for(h=0;h<q.length;h++){if(q[h].split(";").length!==e){f=true;break;}}if(f){return false;}for(h=0;h<p.length;h++){for(g=1;g<q.length;g++){if(q[g].indexOf(p[h])===-1){f=true;break;}}}if(f){return false;}return true;},onClickCreateMultiformAttribute:function B(h,g,f){var e=this.countLinkedAttribute(f);if(e>=2){if(!this.checkMultiLinkedAttributes(f)){this.showCreateMFAError();return ;}g=this.getLinkedAttribute(f)[0];this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,h,g,f,true,true);}else{if(e===1){g=this.getLinkedAttribute(f)[0];this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,h,g,f,true);}else{this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,h,g,f,false);}}},onClickEditMultiformAttribute:function Y(f,e){if(this.isLinkedAttribute(e)){this.showMultiformDialog(D.EDIT_MULTIFORM_ATTRIBUTE,f,e,[e],true);}else{this.showMultiformDialog(D.EDIT_MULTIFORM_ATTRIBUTE,f,e,[e],false);}},showMultiformDialog:function b(l,f,e,k,n,j){var m=mstrApp.getRootController(),o=this.showMultiformDialog2,h="",p;for(p=0;p<k.length;p++){h+=k[p].oid;if(p<k.length-1){h+=",";}}var g={tableID:f,selectedAttributeIds:h};var q={success:function(t){o(l,f,e,k,n,t,j);},failure:function(t){m.displayError(mstrmojo.desc(13134,"Cannot retrieve attribute form info.")+t);}};m.dataService.getAttributeGroupInfo(q,g);},showMultiformDialog2:function A(m,k,l,j,g,AA,f){var n=[],e=[],x=[],h=null,o={},z,p,t;var w=function(AC,AB){return AC.name===AB.name;};o.tableIds=[k];o.tables={};e=AA.agi.fms;x=AA.agi.attribute_forms;h=AA.agi.ts;if(m===D.EDIT_MULTIFORM_ATTRIBUTE&&g&&h.length>1){t=h[0].maps;for(p=1;p<h.length;p++){t=H.getCommonElements(t,h[p].maps,w);}if(t.length>=2){f=true;}}for(p=0;p<h.length;p++){var u=h[p];n=u.maps;var q=u.tbid;if(q!==k){o.tableIds.push(q);}z=mstrApp.getRootController().formsController.populateMFACommand(n,e,x,m,g,l,j,u.tbid,u.tbn,f);o.tables[q]=z;}mstrApp.getRootController().showDialog(d.dialogType.multiFormEditor,o);},populateMFACommand:function a(AA,f,AK,x,n,w,q,u,h,g){var o=[],AI=null,t,AG,AC,AF,AD;t=f[0].fmid;AG=f[0].fmn;AC=f.slice(0);M.forEach(AA,function(AO){var l=M.find(AC,"fmid",AO.fmid);if(l<0){var AN=M.find(AK,"fmid",AO.fmid);if(AN>=0){AC.push({fmid:AK[AN].fmid,fmn:AK[AN].fmn,});}else{AC.push({fmid:AO.fmid,fmn:AO.fmn||AO.name});}}});if(n&&!g){if(AC[0].fmn==="ID"){AC.splice(0,1);}}for(AF=0,AD=AA.length;AF<AD;AF++){var k=AA[AF],e=k.cmid,AM=k.name,AL=k.fmid,m=k.flags,AB=k.alias,p=k.isdf?"1":"0",j=k.atid;var z=M.find(q,"did",e);if(z!==-1){AM=q[z].alias;}var AH={columnId:e,name:AM,formId:AL,displayForm:p,remove:"0",forms:AC,flags:m,alias:AB,atid:j};o.push(AH);if(AL===t){AI=AH;}}var AJ={};AJ.formsOption=x;AJ.tableId=u;AJ.tableName=h;AJ.attribute=w;AJ.attributes=q;AJ.isShared=n;AJ.isMultiLinked=g;AJ.formMaps=o;AJ.idMap=AI;AJ.idFormId=t;AJ.idFormName=AG;if(n){var AE=mstrApp.getRootController().formsController.getLinkedColumnId(w,q,t);if(AE){AJ.linkedColumnId=AE;}}return AJ;},showUnlinkError:function K(){var e=mstrApp.getRootController();e.displayError(mstrmojo.desc(13396,"Unlink the Attribute that you want to use as the Non-ID form."));},showCreateMFAError:function S(){var e=mstrApp.getRootController();e.displayError(mstrmojo.desc(14451,"Unable to create Multi-form attribute since the selected attributes are not present in all tables."));},updateMapping:function F(g,j,h,e,k,m,f,l){switch(g){case D.ADDTO_MULTIFORM_ATTRIBUTE:this.updateMappingAddtoMultiformAttribute(j,h,e,k,m,f,l);break;case D.CREATE_MULTIFORM_ATTRIBUTE:this.updateMappingCreateMultiformAttribute(j,h,k,m,f,l);break;case D.EDIT_MULTIFORM_ATTRIBUTE:this.updateMappingEditMultiformAttribute(j,h,e,k,m,f,l,128);break;}},updateMappingAddtoMultiformAttribute:function R(j,h,f,k,m,g,l,e){this.updateMappingSourceTable(j,false,h.oid,h.alias,m,g,l,e);},updateMappingCreateMultiformAttribute:function E(h,g,j,l,f,k,e){if(j){this.updateMappingSourceTable(h,true,g.oid,g.alias,l,f,k,e);}else{this.updateMappingSourceTable(h,true,"",g.alias,l,f,k,e);}},updateMappingEditMultiformAttribute:function W(j,h,f,k,m,g,l,e){this.updateMappingSourceTable(j,false,h.oid,h.alias,m,g,l,e);},updateMappingSourceTable:function Q(n,e,u,q,l,AC,h,j){if(e){u="";}var w="",k="",m="",g="",AA="",t="",p="",z;for(z=0;z<l.length;z++){w+=l[z].columnId;if(z<l.length-1){w+=",";}k+=l[z].formId;if(z<l.length-1){k+=",";}m+=l[z].displayForm;if(z<l.length-1){m+=",";}g+=l[z].remove;if(z<l.length-1){g+=",";}var x=l[z].flags;if((x&d.formMappingFlag.formMappingFlagRemoveGeoRole)===d.formMappingFlag.formMappingFlagRemoveGeoRole){AA+="1";}else{AA+="0";}if(z<l.length-1){AA+=",";}if((x&d.formMappingFlag.formMappingFlagRemoveTimeRole)===d.formMappingFlag.formMappingFlagRemoveTimeRole){t+="1";}else{t+="0";}if(z<l.length-1){t+=",";}if((x&d.formMappingFlag.formMappingFlagRemoveDeriveFlags)===d.formMappingFlag.formMappingFlagRemoveDeriveFlags){p+="1";}else{p+="0";}if(z<l.length-1){p+=",";}}var AB={newAttribute:e,tableId:n,attributeId:u,attributeName:q,idMapColumnId:AC.columnId,idMapFormId:AC.formId,idMapDisplayForm:AC.displayForm,formMapsColumnIds:w,formMapsFormIds:k,formMapsDisplayForms:m,formMapsRemoves:g,formMapsRemoveGeoRoleFlags:AA,formMapsRemoveTimeRoleFlags:t,formMapsRemoveDeriveFlags:p};if(j!==undefined){AB.formMapsFlags=j;}var o=mstrApp.getRootController();var AD=this;var f={success:function(AF){var AE=o.model;var AG=AE.getImportSource(n);AG.invalidPreview();if(AG.canAutoMappingAndDetectRelation()){o.dataService.detectRelationshipSourceTable(h||AD.onRSDetected,{did:n});}else{if(h&&h.success){h.success(AF);}else{AD.onRSDetected.success(AF);}}},failure:function(AF){var AE=mstrApp.getRootController();AE.displayError(mstrmojo.desc(13136,"Cannot remap columns. "),false,AF.message);}};o.dataService.updateMappingSourceTable(f,AB);},onRSDetected:{success:function(g){var f=mstrApp.getRootController();f.dataService.set("messageID",g.msgid);var e=d.requestFlag.mapping|d.requestFlag.sourceInfo|d.requestFlag.relationship;f.getImportedDataEMMA(d.actions.none,e);},failure:function(){var e=mstrApp.getRootController();e.displayError(mstrmojo.desc(13136,"Cannot remap columns."));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME.DerivedMetricOptions");mstrmojo.requiresDescs(2140);var B=mstrmojo.array;mstrmojo.ME._DerivedMetricEditorHelper=mstrmojo.provide("mstrmojo.ME._DerivedMetricEditorHelper",{isDME:true,noCache:false,closeLabel:mstrmojo.desc(2140,"Cancel"),saveAsEnabled:false,tbBrowsable:false,init:function C(D){this._super(D);},onApplyMetricCallback:mstrmojo.emptyFn,optionPopupRef:{scriptClass:"mstrmojo.ME.DerivedMetricOptions",title:mstrmojo.desc(13035,"Metric Options"),help:"Metric_Options_dialog_box.htm",width:300},replaceAttributeWithForms:function A(E){var D=[];B.forEach(E,function(F){if(F.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Attribute&&F.fs){B.forEach(F.fs,function(G){if(G.obf||F.da){D.push({n:F.n+"@"+G.fnm,did:F.did+"@"+G.fid,fmdid:G.fid,fnm:G.fnm,t:G.t,frm:G,oi:F,path:F.path});}});}else{D.push(F);}});return D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.MissingColumnWarning","mstrmojo.Editor","mstrmojo.ui.List","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(122,218,219,221,1761,3415,3610,6724,8708,8973,9161,11581,12598,12609,12771,13164,13447,13448,13449,13450,13451,13452,13453,13454,13455,13456,13464,13465,8973,11581,13984,13985,13986,13987);var Q=mstrmojo.array,E=mstrmojo.dom,O=mstrmojo.DI.DIHelpers;var N=mstrmojo.desc(13448,"Missing Columns were detected."),K=mstrmojo.desc(13449,"Mismatched Datatypes were detected."),A=mstrmojo.desc(13450,"Missing Tables were detected."),T=mstrmojo.desc(13465,"Missing Columns and Mismatched Datatypes were detected."),J=mstrmojo.desc(13451,"Mismatched Datatypes and Missing Tables were detected."),M=mstrmojo.desc(13452,"Missing Columns and Missing Tables were detected."),R=mstrmojo.desc(13453,"Missing Columns, Mismatched Datatypes and Missing Tables were detected."),F=mstrmojo.desc(13454,"Missing Columns may cause errors in the dashboards that use them. Before republishing with missing columns, the schema changes must be saved to the cube and the refresh policy must be set to 'Replace Existing Data'."),S=mstrmojo.desc(13455,"Mismatched Datatypes were observed between the new data and the current cube data. If the refresh policy is 'Repalce Existing Data' then the cube datatype is replaced with the new datatype for all the other refresh policies the new data is converted to the cube datatype."),L=mstrmojo.desc(13984,"All the columns of the following tables ( ### ) were found to be missing. Incase your aim was to replace a table with a completely different table then please use the edit-dataset workflow to accomplish it."),I=mstrmojo.desc(13985,"Click 'OK' to make changes according to the below details or Click 'Cancel' to try again."),P=mstrmojo.desc(13986,"Please click 'Cancel' to try again."),H=mstrmojo.desc(13987,"The common reason for this error is because incorrect data was uploaded. Please click 'Cancel' to try again."),B=mstrmojo.desc(13464,"### (Cube Datatype: ***)");var G={"100":N,"010":K,"001":A,"110":T,"011":J,"101":M,"111":R};mstrmojo.DI.ui.dialogs.DIMissingColumnsList=mstrmojo.declare(mstrmojo.ui.List,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIMissingColumnsList",getItemMarkup:function D(){var V='<div class="MissingColumnList-item {@cls} cf"><div class="MissingColumnList-item-icon tp{@tp}"></div><div class="MissingColumnList-item-text">{@n}</div><div class="MissingColumnList-item-text2">{@name}</div><div class="MissingColumnList-item-text3" itemtooltip="{@comment}">{@comment}</div></div>';return V;},useRichTooltip:true,showTooltip:function C(a,Z){var Y=this,W=E.findAncestorByAttr(E.eventTarget(Z,a),"itemtooltip",true,this.domNode),X=W&&W.value;if(!Y.hasOpenTooltip&&X){var V=E.position(W.node);Y.richTooltip={cssClass:"vi-regular vi-tooltip-V",content:X,top:Math.max(V.y,0),left:Math.max(V.x+4,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT};this._super(a,Z);}},getItemProps:function U(Y,V){var W=mstrApp.getRootController().getModel(),X=this._super(Y,V),Z=W.getImportSource(Y.tableId);X.tp=Y.tp||"";if(Y.tableName){X.name=Y.tableName;}else{if(Z&&Z.sourceInfo){X.name=Z.sourceInfo.name;}else{X.name="";}}if(Y.isHeader){X.name=Y.name;X.addCls("header");}X.comment=Y.comment||"";return X;}});mstrmojo.DI.ui.dialogs.DIMissingColumnsDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIMissingColumnsDialog",cssClass:"mstrmojo-MissingColumnWarning",warning:mstrmojo.desc(12598,"The following previously uploaded columns are missing"),details:mstrmojo.desc(13164,"If you publish without these columns, existing reports, documents and analyses based on this cube might be affected. Tables with all missing columns will not be republished. Do you still want to continue?"),children:[{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-MissingColumnWarning-title",alias:"warningLabel"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-MissingColumnWarning-collapsed",alias:"collapseButton",text:mstrmojo.desc(189,"Details"),onclick:function(){var V=O.expandNode(this.parent.colllapsedBox);mstrmojo.css.toggleClass(this.domNode,"on",V);}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-MissingColumnWarning-collapsedBox",alias:"colllapsedBox",visible:false,children:[{scriptClass:"mstrmojo.DI.ui.dialogs.DIMissingColumnsList",cssClass:"mstrmojo-MissingColumnWarning-list",alias:"list"},{scriptClass:"mstrmojo.Box",alias:"detailMsgBox"}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(8708,"OK"),alias:"okButton",onclick:function(){var W=this.parent.parent,V=true;if(W.onOK){V=W.onOK();}if(V){W.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelButton",onclick:function(){var W=this.parent.parent,V=true;if(W.onCancel){V=W.onCancel();}if(V){W.close();}}}],onOpen:function(){var b=[{isHeader:true,n:mstrmojo.desc(122,"Columns"),name:mstrmojo.desc(1761,"Tables"),comment:mstrmojo.desc(6724,"Comment")}];var Z=mstrApp.getRootController().getModel(),Y=this.results,e=[],f=[],a=["0","0","0"],d,W,V=[],X=[],c=[];this.set("title",mstrApp.isCloudPro?mstrmojo.desc(9161,"Oops!"):mstrmojo.desc(3610));if(!Y){return ;}this.btnHbox.okButton.set("visible",true);this.btnHbox.cancelButton.set("visible",true);this.colllapsedBox.list.set("visible",false);if(Y.hasError){e.push("<ul>");d=mstrmojo.desc(14302,"We encountered some errors while republishing the cube.");Q.forEach(Y.errorTableTbids,function(k){var j=Z.getImportSource(k),g=j&&j.sourceInfo&&j.sourceInfo.name,h=O.getBackendErrorStr(Y.errorTableErrCode[k],j.type);e.push("<li>");e.push(g+"<br>"+h);e.push("</li>");});e.push("</ul>");this.warningLabel.set("text",d);if(Y.errorTableTbids.length){f.push(new mstrmojo.Label({allowHTML:true,cssClass:"mstrmojo-MissingColumnWarning-detailMsg",text:e.join("")}));if(f.length>0){this.colllapsedBox.detailMsgBox.removeChildren();this.colllapsedBox.detailMsgBox.addChildren(f);}this.colllapsedBox.set("visible",false);}this.btnHbox.cancelButton.set("text",mstrmojo.desc(8708,"OK"));this.btnHbox.okButton.set("visible",false);return ;}Q.forEach(Y.missingTableTbids,function(j){var h=Z.getImportSource(j),g=h&&h.sourceInfo&&h.sourceInfo.name;V.push(g);});Q.forEach(Y.missingColumnTbids,function(j){var h=Z.getImportSource(j),g=h&&h.sourceInfo&&h.sourceInfo.name,k=Y.missingColumns[j];X.push(g);Q.forEach(k,function(l){b.push({n:l.n,tableId:j,comment:mstrmojo.desc(13447,"Missing Columns")});});});Q.forEach(Y.mismatchedDatatypeTbids,function(j){var h=Z.getImportSource(j),g=h&&h.sourceInfo&&h.sourceInfo.name,k=Y.mismatchedDatatypeColumns[j];c.push(g);Q.forEach(k,function(l){b.push({n:l.n,tableId:j,comment:B.replace("###",O.getDataTypeString(l.src.ddt)).replace("***",O.getDataTypeString(l.ddt))});});});if(X.length>0){a[0]="1";e.push(F);W=I;}if(c.length>0){a[1]="1";e.push(S);W=I;}if(V.length>0){a[2]="1";e.push(L.replace("###",V.join(", ")));if(X.length>0||c.length>0){W=P;}else{W=H;}this.btnHbox.okButton.set("visible",false);}d=G[a.join("")];this.warningLabel.set("text",d+" "+W);if(b.length>1){this.colllapsedBox.list.set("items",b);this.colllapsedBox.list.set("visible",true);}else{this.colllapsedBox.list.set("items",null);this.colllapsedBox.list.set("visible",false);}Q.forEach(e,function(g){f.push(new mstrmojo.Label({cssClass:"mstrmojo-MissingColumnWarning-detailMsg",text:g}));});if(f.length>0){this.colllapsedBox.detailMsgBox.removeChildren();this.colllapsedBox.detailMsgBox.addChildren(f);}this.colllapsedBox.set("visible",false);},onOK:function(){var V=mstrApp.getRootController();V.handleRepublishError(this.results);return true;},onCancel:function(){mstrApp.getRootController().cancelRepublishError(this.results);return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIPartitionGroupDialog","mstrmojo.DI.DIInlineEditBox");mstrmojo.requiresDescs(218,219,517,518,221,8149,9912,11164,12532,12818,12819,12820,12821,12822,12823,12824,12825,12826,12827,12828,12829,12830,12831,12832,12833,12834,12835,12892,13266,13301,13331,13332,13333,13334,13335,13336,13337,13338,14196,14197);var b=mstrmojo.array,q=mstrmojo.string,j=mstrmojo.DI.DIConstants,g=j.actions,G=4;function e(u,x,AA){var z={},AB=u;var w,t;for(w=0,t=x.length;w<t;w++){if(x[w].tp===AA){z[x[w].alias]=1;}}w=0;while(z[AB]){AB=u+" ("+(++w)+")";}return AB;}function D(z,t){var x,w,u,AA;for(x=0;x<t.length;x++){u=t[x];for(w=0;w<z.length;w++){AA=z[w];if(AA.fmid===u.fmid){u.georole=AA.georole;u.der=AA.der;}}}}function P(x,t){var w,u;for(w=0;w<t.length;w++){u=t[w];if(u.fmn===x){return u;}}return null;}function K(u,x,t){var w=false;b.forEach(x,function(z){if(z.fmid===t.fmid&&z[u]!==t[u]){if(z[u]&&z[u]!==0){t[u]=z[u];w=true;}else{if(t[u]&&t[u]!==0){z[u]=t[u];w=true;}}}});return w;}function J(w,t){var u=false;b.forEach(w,function(x){if(x.fmid===t.fmid&&x.der!==t.der){x.der=t.der|x.der;t.der=t.der|x.der;u=true;}});return u;}function h(u,t){var w=false;if(u.isMultiForm&&t.isMultiForm){b.forEach(u.subColumns,function(x){w=w||K("georole",t.subColumns,x);});}else{if(u.isMultiForm&&!t.isMultiForm){w=K("georole",u.subColumns,t);}else{if(!u.isMultiForm&&t.isMultiForm){w=K("georole",t.subColumns,u);}else{if(u.georole!==t.georole){if(u.georole&&u.georole!==0){t.georole=u.georole;w=true;}}}}}return w;}function B(u,t){var w=false;if(u.isMultiForm&&t.isMultiForm){b.forEach(u.subColumns,function(x){w=w||J(t.subColumns,x);});}else{if(u.isMultiForm&&!t.isMultiForm){w=J(u.subColumns,t);}else{if(!u.isMultiForm&&t.isMultiForm){w=J(t.subColumns,u);}else{if(u.der!==t.der){t.der=u.der|t.der;u.der=u.der|t.der;w=true;}}}}return w;}function c(u,t){var w=false;if(u.isMultiForm&&t.isMultiForm){b.forEach(u.subColumns,function(x){w=w||K("timerole",t.subColumns,x);});}else{if(u.isMultiForm&&!t.isMultiForm){w=K("timerole",u.subColumns,t);}else{if(!u.isMultiForm&&t.isMultiForm){w=K("timerole",t.subColumns,u);}else{if(u.timerole!==t.timerole){if(u.timerole&&u.timerole!==0){t.timerole=u.timerole;w=true;}else{if(t.timerole&&t.timerole!==0){u.timerole=t.timerole;w=true;}}}}}}return w;}function C(u,t){u.tp=12;u.selected=true;u.georole=t.georole;u.der=t.der;u.shapeKey=t.shapeKey;}function H(u,t){u.tp=12;u.selected=true;u.timerole=t.timerole;}function Z(t){var w=this;var u=w.model.importSources;b.forEach(t,function(AB){var z=u[AB.tableId];var x=z.currentIndex;var AC=z.originalMappings[x];var AA=z.mappings[x];b.forEach(AC,function(AE,AD){if(AE.id===AB.id){AA[AD]=mstrmojo.hash.clone(AE);return false;}});});}function N(w,x,u){var t=false;b.forEach(x,function(z){if(z.fmid===u.fmid){if(z[w]!==0&&u[w]!==0&&z[w]!==u[w]){t=true;return false;}}});return t;}function L(z,t,x){var u=mstrApp.getRootController();if(z.ipa){u.displayError(mstrmojo.desc(14196,"Please unmap project attribute before trying to map it to other attributes."));return ;}var w=false;b.forEach(t,function(AC){if(AC.ipa){w=true;return false;}});if(w){u.displayError(mstrmojo.desc(14196,"Please unmap project attribute before trying to map it to other attributes."));return ;}var AA={success:function(AC){if(AC&&AC.msgid){u.dataService.set("messageID",AC.msgid);}p(z,t,x,null,16);},failure:function(){Z.call(u,t);u.displayError(mstrmojo.desc(13334,"Error to map two attributes"));}};var AB={success:function(){var AD=false;var AC=false;b.forEach(t,function(AE){if(z.georole&&AE.georole&&z.georole!==0&&AE.georole!==0&&z.georole!==AE.georole){if(z.isMultiForm&&AE.isMultiForm){b.forEach(z.subColumns,function(AF){if(N("georole",AE.subColumns,AF)){AC=true;return false;}});}else{if(z.isMultiForm&&!AE.isMultiForm){if(N("georole",z.subColumns,AE)){AC=true;return false;}}else{if(!z.isMultiForm&&AE.isMultiForm){if(N("georole",AE.subColumns,z)){AC=true;return false;}}else{AC=true;}}}if(AC){u.displayError(mstrmojo.desc(13332,"Cannot map two attribute which has different geo role"));Z.call(u,t);return false;}}if(z.timerole&&AE.timerole&&z.timerole!==0&&AE.timerole!==0&&z.timerole!==AE.timerole){if(z.isMultiForm&&AE.isMultiForm){b.forEach(z.subColumns,function(AF){if(N("timerole",AE.subColumns,AF)){AC=true;return false;}});}else{if(z.isMultiForm&&!AE.isMultiForm){if(N("timerole",z.subColumns,AE)){AC=true;return false;}}else{if(!z.isMultiForm&&AE.isMultiForm){if(N("timerole",AE.subColumns,z)){AC=true;return false;}}else{AC=true;}}}if(AC){this.displayError(mstrmojo.desc(13333,"Cannot map two attribute which has different time role"));Z.call(u,t);return false;}}AD=h.call(u,z,AE)||AD;AD=B.call(u,z,AE)||AD;AD=c.call(u,z,AE)||AD;if(AD){u.changeEMMAMappings(AA);}else{AA.success();return false;}});},failure:function(AD){var AE;var AF=/\(.*\)/g.exec(AD.message);if(AF&&AF.length>0){AE=AF[0].substr(1,AF[0].length-2);}var AC=function(){var AG=j.requestFlag.mapping|j.requestFlag.sourceInfo|j.requestFlag.relationship;u.getImportedDataEMMA(g.none,AG);};u.displayError(AE,false,null,AC);Z.call(u,t);}};p(z,t,x,AB,1);}function F(w,AB,z){var u=mstrApp.getRootController(),x=u.getModel(),AA,t;if(!w||!AB||!w.tableId||!AB.tableId){return ;}AA=x.getImportSource(w.tableId).findMappingItem(w);t=x.findMappingItem(AB);L(AA,t,z);}function p(z,t,x,AA,w){var u=mstrApp.getRootController();b.forEach(t,function(AB){AB.alias=x;AB.oid=z.id;AB.linkObjID=z.id;});u.changeEMMAMappings(AA,w);}function I(w,z,t){var u=this.model;var AA=u.findMappingItem(w);var x;for(x=0;x<AA.length;x++){if(AA[x].tableId===w.tableId){AA[x].alias=z;AA[x].linkObjID="";if(AA[x].tp===12){AA[x].formID="";AA[x].oid="";}AA[x].lv=0;}}if(!t){this.changeEMMAMappings();}}function f(AA,t){var u,w,x,z;for(u in t){x=t[u];if(x.currentTransformations&&x.currentTransformations.xtab&&x.currentTransformations.xtab.isCrosstab){z=x.transformedMapping;}else{z=x.currentMapping;}for(w=0;w<z.length;w++){if(z[w].alias===AA){return z[w];}}}return null;}function S(w,u){var t;for(t=0;t<w.length;t++){w[t].alias=u;if(this.linkObjID){w[t].linkObjID=this.linkObjID;this.linkObjID=null;}if(w.length>1){w[t].lv=1;}}mstrApp.getRootController().changeEMMAMappings();}mstrmojo.DI.controller.DIMappingController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIMappingController",changeDataType:function X(AE,AC,x){if(!AE||!AE.data||isNaN(AE.data[0].tp)){return ;}var AB=mstrApp.getRootController();var u=AE.data[0];var w=AB.model;var AA,z;var AD;var t;AD=w.findMappingItem(u);for(AA=0;AA<AD.length;AA++){if(AD[AA].isMultiForm){t=AD[AA].subColumns;for(z=0;z<t.length;z++){if(t[z].afid===u.afid){t[z].dtp=AC;if(typeof x==="number"&&!isNaN(x)){t[z].ctp=x;}t[z].selected=true;break;}}}else{AD[AA].dtp=AC;if(typeof x==="number"&&!isNaN(x)){AD[AA].ctp=x;}AD[AA].selected=true;}}AB.changeEMMAMappings();},linkAttributes:function Q(x,AG){if(!x||!AG){return ;}var AA=x.data[0],AE,w,AB,t=x.widget,AD=mstrmojo.dom.position(t.domNode),AF=mstrmojo.dom.position(x.node).y-AD.y,AC=mstrApp.getRootController(),z=0;if(AF>=22*3){if(t.containerNode.scrollTop<t.containerNode.scrollHeigh-t.containerNode.clientHeight){t.containerNode.scrollTop+=22;}else{z=-44;}}AF=mstrmojo.dom.position(x.node).y-AD.y-5+z;var u={scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-di-linkPopup",locksHover:true,slot:"domNode",children:[{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(13301,"Map?"),cssClass:"mstrmojo-di-link-button",onclick:function(AH){mstrmojo.dom.stopPropogation(AH.hWin,AH.e);F(AA,AG.data[0],AA.alias);this.set("visible",false);}}],onOpen:function(){var AH=this.txt,AI=this.txtConfig;mstrmojo.hash.forEach(AI,function(AJ,AK){AH.set(AK,AJ);});}};AE=AG.data[0];if(AA.id===AE.id){AC.displayError(mstrmojo.desc(13335,"#### and @@@@ are already mapped.").replace("####",AA.alias).replace("@@@@",AE.alias));return ;}w=AC.getModel().getImportSource(AE.tableId);AB=AC.getModel().getImportSource(AA.tableId);if(AB.findMappingItem(AE)){AC.displayError(mstrmojo.desc(13336,"#### is already mapped to another column in table @@@@.").replace("####",AE.alias).replace("@@@@",AB.sourceInfo.name));return ;}if(w.findMappingItem(AA)){AC.displayError(mstrmojo.desc(13336,"#### is already mapped to another column in table @@@@.").replace("####",AA.alias).replace("@@@@",w.sourceInfo.name));return ;}window.setTimeout(function(){t.openPopup(u,{left:"9px",top:AF+"px"});},100);},renameSourceTable:function M(AB,AD){var AA=mstrApp.getRootController();var z=AA.model;var t=z.importSources;var AC=z.getImportSource(AB);if(!AC){return ;}if(AC.sourceInfo&&AC.sourceInfo.name===AD){return ;}if(!AD||AD.length<=0){AA.displayError(mstrmojo.desc(12824,"Cannot rename table alias with empty string."));z.raiseEvent({name:"MappingsFetched"});return ;}if(AD.length>=250){AA.displayError(mstrmojo.desc(12825,"Cannot rename table alias with a too long string."));z.raiseEvent({name:"MappingsFetched"});return ;}if(j.invalidObjectNameCharsRegex.test(AD)){AA.displayError(mstrmojo.desc(12826,"Cannot rename table alis with string contains the following characters: ####.").replace("####",j.invalidObjectNameChars));z.raiseEvent({name:"MappingsFetched"});return ;}for(var x in t){if(t[x].tableID!==AB&&t[x].sourceInfo&&t[x].sourceInfo.name===AD){AA.displayError(mstrmojo.desc(14197,"Cannot rename table alias with a used name."));return ;}}var u={success:function(){var AE=j.requestFlag.mapping|j.requestFlag.sourceInfo|j.requestFlag.relationship;AA.getImportedDataEMMA(g.none,AE);},failure:function(AF){var AE=parseInt(AF.code,10);var AG=mstrmojo.desc(12827,"Cannot rename table alias.");switch(AE){case j.backendError.invalidObjectName:AG=mstrmojo.desc(12828,"Cannot rename table alias with invalid characters.");break;case j.backendError.stringTooLong:AG=mstrmojo.desc(12825,"Cannot rename table alias with a too long string.");break;}mstrApp.getRootController().displayError(AG,false,AF.message);z.raiseEvent({name:"MappingsFetched"});}};var w={did:AB,xml:"",n:AD};AA.dataService.editEMMASourceTable(u,w);},renameTableItem:function R(AC,z){var AE=mstrApp.getRootController(),AD=AE.model;var AG=mstrmojo.string.trim(AC.text);var AA=0,x,AH=false;var AF,u,w;if(AG===z.alias){return false;}if(!AG||AG.length<=0){AE.displayError(mstrmojo.desc(12829,"Cannot rename column with empty string."));AD.raiseEvent({name:"MappingsFetched"});return false;}if(AG.length>=250){AE.displayError(mstrmojo.desc(12830,"Cannot rename column with a too long string."));AD.raiseEvent({name:"MappingsFetched"});return false;}if(j.invalidObjectNameCharsRegex.test(AG)){AE.displayError(mstrmojo.desc(12831,"Cannot rename column with string contains the following characters: ####").replace("####",j.invalidObjectNameChars));AD.raiseEvent({name:"MappingsFetched"});return false;}var t=AD.findMappingSource(z);if(t.length===0){return false;}for(x=0;x<t.length;x++){u=t[x];if(z.tp===G&&!z.linkedTbs&&z.tableId!==u.tableID){continue;}if(u.currentTransformations&&u.currentTransformations.xtab&&u.currentTransformations.xtab.isCrosstab){AF=u.transformedMapping;}else{AF=u.currentMapping;}for(AA=0;AA<AF.length;AA++){if(AG===AF[AA].alias&&z.tp===AF[AA].tp){AH=true;break;}}}if(AH){w=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");AE.displayError(w.replace("##",AG));AD.raiseEvent({name:"MappingsFetched"});return false;}var AB=f(AG,AD.importSources);if(AB&&AB.tp!==G&&z.tp!==G){w=mstrmojo.desc(13337,"#### is already being used by other attributes. Would you like to map to those attributes?").replace("####",AG);mstrmojo.confirm(w,{confirmBtn:{t:mstrmojo.desc(13301,"Map?"),fn:function(){AF=AD.findMappingItem(z);F(AB,AF[0],AG);return true;}},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});}else{if(z.tp===4&&!z.linkedTbs){AF=AD.findMappingItem(z,z.tableId);}else{AF=AD.findMappingItem(z);}S(AF,AG);return true;}},openRenameTextBox:function V(AD,AE,t,AF){var u=t.data[0],AC=u.alias||u.n,z=this;var AA=AE;var x=AE.parentNode;var AB=mstrmojo.insert({scriptClass:"mstrmojo.DI.DIInlineEditBox",text:AC||"",cssDisplay:"inline-block",placeholder:AE,onSave:function w(){var AG;if(AD===j.contextMenuType.ITEM_MENU){AG=z.renameTableItem(this,u);if(!AG){x.replaceChild(AA,this.domNode);}}else{if(AD===j.contextMenuType.TABLE_MENU){x.replaceChild(AA,this.domNode);z.renameSourceTable(u.id,this.text);}else{if(AD===j.contextMenuType.LINK_MENU){F(u,AF.data[0],mstrmojo.string.decodeHtmlString(this.text));}}}}});if(parent&&parent.draggable){AB.parent=parent;}AB.render();AB.set("editMode",true);},openUnLinkDialog:function U(w){if(!w||!w.data||isNaN(w.data[0].tp)||!w.data[0].selected){return ;}var x=w.data[0];var u=x.alias;var t=x.tp===12?mstrmojo.desc(518,"attribute"):mstrmojo.desc(517,"metric");mstrApp.getRootController().showDialog(j.dialogType.previewRenameDialog,{curName:x.alias,text:mstrmojo.desc(13338,"#### is currently being used by other @@@@. Please rename to unmap this @@@@").replace("####",u).replace(/@@@@/g,t),onOk:function(z){var AA=mstrApp.getRootController();var AB=mstrmojo.string.encodeXMLAttribute(z);if(AB===x.alias){AA.displayError(mstrmojo.desc(12834,"Please input a different name."));return false;}if(AB.length<=0){AA.displayError(mstrmojo.desc(12829,"Cannot rename column with empty string."));return false;}if(AB.length>=250){AA.displayError(mstrmojo.desc(12830,"Cannot rename column with a too long string."));return false;}if(j.invalidObjectNameCharsRegex.test(AB)){AA.displayError(mstrmojo.desc(12835,"Cannot rename column with string contains the following characters: ")+j.invalidObjectNameChars);return false;}I.call(AA,x,AB);return true;}});},unlinkAll:function m(x,w){var t=mstrApp.getRootController(),u=t.getModel(),AA=x.data,AB=false,z;if(!w){w=AA[0].tableId;}z=u.getImportSource(w);b.forEach(AA,function(AC){var AD;if(AC.selected&&AC.tp===12&&AC.isLinked){AD=AC.alias+" - "+z.sourceInfo.name;AD=u.getUniqueAlias(12,AD);I.call(t,AC,q.encodeXMLAttribute(AD),true);AB=true;}});if(AB){t.changeEMMAMappings();}},unlinkAllCubeLevel:function k(w){var t=mstrApp.getRootController(),u=t.getModel(),x=w.data,z=false;b.forEach(x,function(AA){var AB;if(AA.selected&&AA.tp===12&&AA.isLinked){AB=u.findMappingItem(AA);b.forEach(AB,function(AE){var AD=u.getImportSource(AE.tableId),AC;AC=AE.alias+" - "+AD.sourceInfo.name;AC=u.getUniqueAlias(12,AC);I.call(t,AE,q.encodeXMLAttribute(AC),true);z=true;});}});if(z){t.changeEMMAMappings();}},unmap:function d(AE){var u=AE.data[0]||AE.data;if(!AE||!AE.data||isNaN(u.tp)||(u.tp===4&&u.selected)){return ;}var z,AD;var AA=mstrApp.getRootController();var x=AA.model;AD=x.findMappingItem(u);var AB,AC=true;var t=function w(){for(z=0;z<AD.length;z++){mstrmojo.array.forEach(AD[z].subColumns,function(AF){AF.oid="";AF.fmid="";AB=AF.originalAlias;AF.alias=AB;});}AA.changeEMMAMappings();};for(z=0;z<AD.length;z++){if(AD[z].isMultiForm&&AC){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:t}});AC=false;}else{AD[z].oid="";AD[z].fmid="";AB=AD[z].originalAlias;AD[z].alias=AB;}}if(AC){AA.changeEMMAMappings();}},isSingleFormAttribute:function T(t){return !(t.isMultiForm);},toProjectAttribute:function o(AL,AE){var AA=AL.data[0]||AL.data;if(!AL||!AL.data||isNaN(AA.tp)||(AA.tp===4&&AA.selected)){return ;}var AF=[];var AK,AI,AH,AM,x=[],AG;var t;var z=mstrApp.getRootController().model;if(AL.data.length>1){this.toProjectAttribute2(AL,AE);return ;}t=z.findMappingSource(AA);for(AK=0;AK<t.length;AK++){AG=t[AK];if(AG.currentTransformations&&AG.currentTransformations.xtab&&AG.currentTransformations.xtab.isCrosstab){AF=AF.concat(AG.transformedMapping);}else{AF=AF.concat(AG.currentMapping);}}if(AF){for(AI=0;AF&&AI<AF.length;AI++){AM=AF[AI];if(AM.type!=="amps"){continue;}if((AM.id===AA.id)&&(AM.isLinked||AM.isMultiForm)){var w=AM.subColumns,AD;for(AH=0;w&&AH<w.length;AH++){AD=w[AH];if(AD.georole){AA.georole=1;}var AC=mstrmojo.array.find(x,"fmid",AD.fmid);if(AC<0){x.push(AD);}}}}}var u=function AB(){var AP={};AP.attribute=AA;if(AA.isMultiForm||AA.isLinked){var AN=x,AQ,AO;AO=b.find(AN,"isIdForm",true);if(AO>0){AQ=AN[AO];AN.splice(AO,1);AN.unshift(AQ);}AP.formMaps=AN;}mstrApp.getRootController().showDialog(j.dialogType.mapProjectsAttributeDialog,AP);},AJ={confirmBtn:{fn:function(){u();}}};if(AA.georole){mstrmojo.confirm(mstrmojo.desc(9912,"Mapping this column to a project attribute will remove its geographical role and any derived attributes. Do you want to continue?"),AJ);}else{if(AA.timerole){mstrmojo.confirm(mstrmojo.desc(13297,"Mapping this column to a project attribute will remove all related derived date/time attributes, Do you want to continue?"),AJ);}else{u();}}},toProjectAttribute2:function(x,w){var AB=x.data,t=b.some(AB,function(AC){return AC.georole;}),z=b.some(AB,function(AC){return AC.timerole;}),u=function(){var AC={tableId:w||AB[0].tableId,attributes:AB};mstrApp.getRootController().showDialog(j.dialogType.mapProjectsAttributeDialog2,AC);},AA={confirmBtn:{fn:function(){u();}}};if(t){mstrmojo.confirm(mstrmojo.desc(9912,"Mapping this column to a project attribute will remove its geographical role and any derived attributes. Do you want to continue?"),AA);}else{if(z){mstrmojo.confirm(mstrmojo.desc(13297,"Mapping this column to a project attribute will remove all related derived date/time attributes, Do you want to continue?"),AA);}else{u();}}},toUnused:function n(AB){if(!AB||!AB.data||isNaN(AB.data[0].tp)||!AB.data[0].selected){return ;}var z=mstrApp.getRootController();var u=AB.data;var t=z.model;var AA,x,w,AC;for(AA=0;AA<u.length;AA++){w=u[AA];AC=t.findMappingItem(w);for(x=0;x<AC.length;x++){if(w.linkedTbs){AC[x].selected=false;}else{if(AC[x].tp===12){AC[x].selected=false;}else{if(AC[x].tableId===w.tableId){AC[x].selected=false;}}}}}z.changeEMMAMappings();},toAttribute:function a(AB){var AD=[],u=[],AC;var x,AA,t;var z=mstrApp.getRootController();var w=z.model;mstrmojo.array.forEach(AB,function(AE){if(!AE||isNaN(AE.tp)||(AE.tp===12&&AE.selected)){return ;}AC=[];u=w.findMappingSource(AE);for(x=0;x<u.length;x++){t=u[x];if(t.currentTransformations&&t.currentTransformations.xtab&&t.currentTransformations.xtab.isCrosstab){AC=AC.concat(t.transformedMapping);}else{AC=AC.concat(t.currentMapping);}}if(AE.tp!==12){AA=e(AE.alias,AC,12);}else{AA=AE.alias;}AD=w.findMappingItem(AE);for(x=0;x<AD.length;x++){AD[x].alias=AA;AD[x].tp=12;AD[x].selected=true;}});z.changeEMMAMappings();},toMetric:function Y(AB){var z=mstrApp.getRootController();var w=z.model;var u=[],AD=[],AC;var x,AA,t;mstrmojo.array.forEach(AB,function(AE){if(!AE||isNaN(AE.tp)||(AE.tp===4&&AE.selected)){return ;}AC=[];u=w.findMappingSource(AE);for(x=0;x<u.length;x++){t=u[x];if(t.currentTransformations&&t.currentTransformations.xtab&&t.currentTransformations.xtab.isCrosstab){AC=AC.concat(t.transformedMapping);}else{AC=AC.concat(t.currentMapping);}}if(AE.tp!==4){AA=e(AE.alias,AC,4);}else{AA=AE.alias;}AD=w.findMappingItem(AE);for(x=0;x<AD.length;x++){AD[x].alias=AA;AD[x].tp=4;AD[x].selected=true;}});z.changeEMMAMappings();},importItem:function l(z){var u=mstrApp.getRootController();var t=u.model;var AA=[],x,w;if(!z||isNaN(z.tp)){return ;}AA=t.findMappingItem(z);for(x=0;x<AA.length;x++){if(AA[x].idot===12){AA[x].alias=w;AA[x].tp=AA[x].idot;AA[x].selected=true;}else{if(AA[x].tableId===z.tableId){AA[x].alias=w;AA[x].tp=AA[x].idot;AA[x].selected=true;}}}u.changeEMMAMappings();},setMultipleImport:function O(u){var x=mstrApp.getRootController();var t=x.model;var w=[],AB=[],AC;var AA,z;mstrmojo.array.forEach(u,function(AD){if(!AD||isNaN(AD.tp)){return ;}AC=[];w=t.findMappingSource(AD);if(AD.tp===0&&AD.selected){AB=t.findMappingItem(AD);for(AA=0;AA<AB.length;AA++){if(AB[AA].idot===12){AB[AA].alias=z;AB[AA].tp=AB[AA].idot;AB[AA].selected=true;}else{if(AB[AA].tableId===AD.tableId){AB[AA].alias=z;AB[AA].tp=AB[AA].idot;AB[AA].selected=true;}}}}});x.changeEMMAMappings();},setTimeDimension:function A(x){if(!x||isNaN(x.tp)||(x.tp===4&&x.selected)){return ;}var w,z;var u=mstrApp.getRootController();var t=u.model;z=t.findMappingItem(x);for(w=0;w<z.length;w++){if(z[w].isMultiForm){z[w].subColumns=x.subColumns;}else{z[w].tp=12;z[w].selected=true;z[w].der=x.der;}}u.changeEMMAMappings();},setTimeRole:function W(z){if(!z||isNaN(z.tp)||(z.tp===4&&z.selected)){return ;}var AB=mstrApp.getRootController();var AA,x,AD,w,AC;var u=AB.model;AD=u.findMappingItem(z);for(AA=0;AA<AD.length;AA++){var t=AD[AA];if(AD[AA].isMultiForm){if(z.isMultiForm){AD[AA].subColumns=z.subColumns;}else{for(x=0;x<t.subColumns.length;x++){if(t.subColumns[x].isIdForm){w=t.subColumns[x];break;}}H(w,z);}}else{if(z.isMultiForm){for(x=0;x<z.subColumns.length;x++){if(z.subColumns[x].isIdForm){AC=z.subColumns[x];break;}}H(t,AC);}else{H(t,z);}}}AB.changeEMMAMappings();},setGeoRoles:function E(AC){if(!AC||isNaN(AC.tp)||(AC.tp===4&&AC.selected)){return ;}var AD,AB,AG,AA,AF,t;var AE=mstrApp.getRootController();var x=AE.model;AG=x.findMappingItem(AC);if(AC.isMultiForm){if(AC.mergeSubColumns){D(AC.mergeSubColumns,AC.subColumns);}}for(AD=0;AD<AG.length;AD++){var u=AG[AD];if(u.isMultiForm){if(AC.isMultiForm){if(u.tableId===AC.tableId){u.subColumns=AC.subColumns;}else{for(AB=0;AB<AC.mergeSubColumns.length;AB++){var w=AC.mergeSubColumns[AB];var z=P(w.fmn,u.subColumns);if(w.georole&&z){AA=z;AA.georole=w.georole;break;}}t=AA.fmn;for(AB=0;AB<u.subColumns.length;AB++){if(u.subColumns[AB].fmn!==t){u.subColumns[AB].georole=0;}}}}else{for(AB=0;AB<u.subColumns.length;AB++){if(u.subColumns[AB].isIdForm){AA=u.subColumns[AB];}else{u.subColumns[AB].georole=0;}}C(AA,AC);}}else{if(AC.isMultiForm){for(AB=0;AB<AC.subColumns.length;AB++){if(AC.subColumns[AB].isIdForm){AF=AC.subColumns[AB];break;}}C(u,AF);}else{C(u,AC);}}}AE.changeEMMAMappings();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIPartitionGroupDialog");mstrmojo.requiresDescs(12390,12391,12392);var K=mstrmojo.DI.DIConstants,D=K.actions,I=mstrmojo.array,C=mstrmojo.desc,G={UPDATE_SINGLE_PARTITION:0,ADD_MULTI_PARTITION:1,SET_SINGLE_PARTITION:2,SET_SINGLE_PARTITION_URL:3,SET_SINGLE_PARTITION_EMMA:4,SET_SINGLE_PARTITION_EXCEL:5};mstrmojo.DI.controller.DIPartitionController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIPartitionController",getAllPartitionTables:function J(P,O){var N=mstrApp.getRootController();return N.model.getAllPartitionTables(P,O);},changePartition:function M(S,Q,P,U){var O=mstrApp.getRootController(),N,T,R;R=O.model.getImportSource(S);R.invalidPreview();N={success:function(W){var V=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",W.msgid);O.getImportedDataEMMA(D.none,V);},failure:function(V){O.displayError(C(12390,"Cannot change partition group."),false,V.message||"");}};T={mode:G.UPDATE_SINGLE_PARTITION,partitionId:S,addTables:JSON.stringify(Q),delTables:JSON.stringify(P)};O.dataService.changePartition(U||N,T);},setPartition:function H(R,P,T){var O=mstrApp.getRootController(),N,S,Q;Q=O.model.getImportSource(R);Q.invalidPreview();N={success:function(V){var U=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",V.msgid);O.getImportedDataEMMA(D.none,U);},failure:function(U){O.displayError(C(12390,"Cannot change partition group."),false,U.message||"");}};S={mode:G.SET_SINGLE_PARTITION,partitionId:R,addTables:JSON.stringify(P)};O.dataService.changePartition(T||N,S);},addMultiPartitions:function E(S,U){var O=mstrApp.getRootController(),P=O.model,T,Q=[],N,R;I.forEach(S,function(V){Q.push(V.tableIds.join(","));R=P.getImportSource(V.tableIds[0]);R.invalidPreview();});T={mode:G.ADD_MULTI_PARTITION,partitions:Q.join("|")};N={success:function(W){var V=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",W.msgid);if(U&&U.onOK){U.onOK();}else{O.getImportedDataEMMA(D.none,V);}},failure:function(V){O.displayError(C(12391,"Cannot group partitions."),false,V.message||"",U&&U.onCancel);}};O.dataService.changePartition(N,T);},setPartitionURL:function B(R,P,T){var O=mstrApp.getRootController(),N,S,Q;Q=O.model.getImportSource(R);Q.invalidPreview();N={success:function(U){var V=U.msgid,W={};if(V){O.dataService.set("messageID",V);}W.url=P[0];O.autoMappingSourceTable(null,R,W);},failure:function(){O.displayError(C(12392,"Encounter error when set partition!"));}};S={mode:G.SET_SINGLE_PARTITION_URL,partitionId:R,addTables:JSON.stringify(P)};O.dataService.changePartition(T||N,S);},setPartitionExcel:function A(S,O,Q){var P=mstrApp.getRootController(),N,T,R;if(Q.length<=0){return ;}R=P.model.getImportSource(S);R.invalidPreview();N={success:function(U){var V={shtIx:Q[0]};P.autoMappingSourceTable(null,S,V,S);},failure:function(){P.displayError(C(12392,"Encounter error when set partition!"));}};T={mode:G.SET_SINGLE_PARTITION_EXCEL,partitionId:S,addSheetsName:JSON.stringify(O),addsheetsIndex:Q.join(",")};P.dataService.changePartition(N,T);},openPartitionGroupDialog:function F(N,O){mstrApp.getRootController().showDialog(K.dialogType.partitionGroupDialog,{groups:N,callback:O});},isSamePartitionGroups:function L(U,S){var Q={},N=true,P=U?U.length:0,O=S?S.length:0,T=0,R=0;if(P!==O){return false;}I.forEach(U,function(V){I.forEach(V.tableIds,function(W){Q[W]=true;T++;});});I.forEach(S,function(V){I.forEach(V.tableIds,function(W){if(!Q[W]){N=false;return false;}R++;});if(!N){return false;}});N=N&&(T===R);return N;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DITreeNode","mstrmojo.WidgetTree","mstrmojo.DI.DIHelpers");var C=mstrmojo.DI.DIHelpers,D=mstrmojo.array;mstrmojo.DI.DITree=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.DI.DITree",renderOnScroll:false,itemFunction:function B(I,F,G){var E=G.tree||G,H=new mstrmojo.DI.DITreeNode({edit:I.edit,data:I,state:0,parent:G,tree:E,multiSelect:G.multiSelect,text:I[G.itemDisplayField],textCssClass:E.item2textCss(I),items:I[G.itemChildrenField],itemIdField:G.itemIdField,itemDisplayField:G.itemDisplayField,itemIconField:G.itemIconField,itemChildrenField:G.itemChildrenField,itemFunction:G.itemFunction,listSelector:G.listSelector,iconFolderClosed:I.iconFolderClosed||"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:I.iconFolderOpen||"mstrmojo-di-tree-node-icon folder-open"});I.node=H;return H;},postCreate:function(){if(this._super){this._super();}this.selectedNodes=[];this.selectedNode=null;},isMultiSelect:false,selectedNodes:[],selectedNode:null,selectNode:function A(G,F){if(!this.isMultiSelect){if(this.selectedNode!==null&&this.selectedNode!==G){this.selectedNode.deselect();}this.selectedNode=G;this.selectedNodes=[G];}else{if(!F||(!C.isCtrlKey(F.hWin,F.e))){D.forEach(this.selectedNodes,function(H){if(H!==null&&H!==G){H.deselect();}});this.selectedNode=G;this.selectedNodes=[G];}else{if(F&&C.isCtrlKey(F.hWin,F.e)){var E=mstrmojo.array.find(this.selectedNodes,"id",G.id);if(E<0){this.selectedNodes.push(G);this.selectedNode=G;}else{G.deselect();this.selectedNodes.splice(E,1);if(this.selectedNode===G){this.selectedNode=null;}}}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout");mstrmojo.requiresDescs(39,12545);var E={"application/vnd.google-apps.spreadsheet":"mstrmojo-di-tree-node-icon google-spreadsheet","application/vnd.ms-excel":"mstrmojo-di-tree-node-icon excel-doc","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"mstrmojo-di-tree-node-icon excel-doc","text/csv":"mstrmojo-di-tree-node-icon csv-doc","text/plain":"mstrmojo-di-tree-node-icon text-doc",file:"mstrmojo-di-tree-node-icon ga-document",graph:"mstrmojo-ListIcon  t3 st769",gridGraph:"mstrmojo-ListIcon  t3 st774",cube:"mstrmojo-ListIcon  t3 st776",grid:"mstrmojo-ListIcon  t3 st768"};function D(H,G){var J=H.n.toLowerCase(),I=G.n.toLowerCase();if((H.isFolder&&G.isFolder)||(!H.isFolder&&!G.isFolder)){if(J<I){return -1;}if(J>I){return 1;}return 0;}if(H.isFolder&&!G.isFolder){return -1;}if(!H.isFolder&&G.isFolder){return 1;}}mstrmojo.DI.DIObjectBrowser=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIObjectBrowser",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{listHeaderNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},canRefresh:false,children:[{scriptClass:"mstrmojo.List",slot:"listHeaderNode",itemMarkupFunction:function(I,G,H){var J=H.parent.canRefresh?'<div class="di-refresh-reports icon-clickable di-object-browser-header-right" mstrAttach:click></div>':"";return'<div><table cellpadding="0" cellspacing="0" style="width: 100%;"><tr><td class="mstrmojo-di-so-list-header cf" style="width: 30%;"><div class="di-object-browser-header-left">'+I.n+"</div>"+J+'</td><td class="mstrmojo-di-so-list-header" style="width: 70%;">'+I.desc+"</td></tr></table></div>";},items:[{n:mstrmojo.desc(12545,"Files"),desc:mstrmojo.desc(39,"Description")}],onmousedown:function(G){if(G.e.target.className==="di-refresh-reports icon-clickable di-object-browser-header-right"){this.parent.clickedNode=this.parent.fileTree;this.parent.refreshFunction();}}},{scriptClass:"mstrmojo.DI.DITree",alias:"fileTree",slot:"listNode",cssClass:"mstrmojo-di-ga-table",bindings:{isMultiSelect:"this.parent.isMultiSelect"}}],browseFunction:mstrmojo.emptyFn(),editFunction:mstrmojo.emptyFn(),refreshFunction:mstrmojo.emptyFn(),clickedNode:null,fileList:null,sortRoot:true,isMultiSelect:false,forceEnableContinue:false,onfileListChange:function(){var H,G,J=[],M,N,Q;var I=this.fileList;var P=this;for(H=0;H<I.length;H++){var O=I[H];O.clickHandler=P.onTreeNodeClick;O.list=P.fileTree;O.browser=P;if(this.clickedNode.data){var L=this.clickedNode.data.folderPath||"";O.folderPath=L+"/"+this.clickedNode.data.n;}if(!O.isFolder){O.editHandler=P.onEditButtonClick;O.iconEntity=E[O.type]||E["text/plain"];}N=new mstrmojo.DI.DITreeNode(O);if(O.cItem){M=[];for(G=0;G<O.cItem.length;G++){var K=O.cItem[G];K.clickHandler=P.onTreeNodeClick;K.list=P.fileTree;K.browser=P;K.iconEntity="mstrmojo-di-tree-node-icon salesforce";Q=new mstrmojo.DI.DITreeNode(K);M.push(Q);}M.sort(D);N.set("items",M);N.fetched=true;}J.push(N);}if(this.sortRoot){J.sort(D);}this.clickedNode.set("items",J);this.clickedNode.selectedItem=null;this.clickedNode.selectedNode=null;},onEditButtonClick:function F(G){G.data.browser.editFunction(G);},onTreeNodeClick:function A(G){if(G.data.isFolder){G.data.browser.clickedNode=G;G.data.browser.browseFunction(G);}else{this.data.list.selectedItem=G.data;mstrApp.getRootController().sourceSelected(this.data.list.selectedNodes.length>0||G.data.browser.forceEnableContinue);}},postBuildRendering:function C(){if(this._super){this._super();}this.clickedNode=this.fileTree;},setDimensions:function B(J,H){var G=parseInt(J,10);var I=parseInt(H,10);if(isNaN(G)||isNaN(I)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listHeaderNode="28px";this.layoutConfig.w.listHeaderNode=I+"px";this.layoutConfig.w.listNode=Math.max(I,0)+"px";if(this._super){this._super(G+"px",H);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.TextBox","mstrmojo.TreeNode","mstrmojo.DI.DITreeNode");mstrmojo.DI.DIGATreeNode=mstrmojo.declare(mstrmojo.DI.DITreeNode,null,{scriptClass:"mstrmojo.DI.DIGATreeNode",markupString:'<div id="{@id}" class="{@cssClass} mstrmojo-di-tree-node-list" style="{@cssText}" mstrAttach:mousedown><div class="mstrmojo-di-tree-node"><img border="0" class="mstrmojo-di-tree-node-icon folder-closed" src="../images/1ptrans.gif"/><span class="mstrmojo-di-tree-node-text {@textCssClass}"></span><span class="mstrmojo-di-ga-tree-node-edit-icon {@textCssClass}"></span><span class="mstrmojo-di-tree-node-desc {@textCssClass}"></span></div><ul class="mstrmojo-di-tree-node-itemsContainer">{@itemsHtml}</ul></div>',markupSlots:{listNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];},editIconNode:function(){return this.domNode.firstChild.children[2];},descNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{onstateChange:function(){this.iconNode.className=(this.state===1)?this.data.iconFolderOpen:this.data.iconFolderClosed;this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);if(this.data.desc){this.descNode.innerHTML=mstrmojo.string.encodeHtmlString(this.data.desc);this.descNode.title=this.data.desc;}}},clickHandler:null,editHandler:null,deselect:function B(){if(this.listNode){this.listNode.className="mstrmojo-di-tree-node-file";}},fetched:false,iconEntity:"",iconFolderClosed:"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:"mstrmojo-di-tree-node-icon folder-open",isFolder:true,postBuildRendering:function A(){if(this._super){this._super();}var D=0;var E=this;while(E!=null&&E.parent!=null&&E.parent.data!=null){D++;E=E.parent;}this.iconNode.style.marginLeft=D*18+"px";if(this.data.isFolder){this.iconNode.className=(this.state===1)?this.data.iconFolderOpen:this.data.iconFolderClosed;this.listNode.className="mstrmojo-di-tree-node-folder";this.editIconNode.style.display="none";}else{this.iconNode.className=this.data.iconEntity;this.listNode.className="mstrmojo-di-tree-node-file";}},premousedown:function C(D){var E=mstrmojo.dom.eventTarget(D.hWin,D.e);mstrmojo.dom.stopPropogation(D.hWin,D.e);if(E!==this.editIconNode){if(this.data.isFolder){if(this.state===0){if(this.data.fetched){this.set("state",1);}else{this.data.clickHandler.call(this,this);this.data.fetched=true;this.set("state",1);}}else{if(this.state===1){this.set("state",0);}}}else{this.listNode.className="mstrmojo-di-tree-node-file selected";var F=this;while(F!=null&&F.parent!=null&&F.parent.data!=null){F=F.parent;}if(F!=null&&F.tree!=null&&F.tree.scriptClass=="mstrmojo.DI.DITree"){F.tree.selectNode(this,D);}this.data.clickHandler.call(this,this);}}else{this.data.editHandler(this);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.WidgetTree","mstrmojo.expr","mstrmojo.AndOrNode","mstrmojo.ConditionNode");var F=mstrmojo.expr,B=F.ET;function A(G){var I=G&&G.src,J=I&&I.data,H=J&&J.et;return(H in F.ETs);}mstrmojo.FilterExpr=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.FilterExpr",allowDrop:A,renderOnScroll:false,itemIdField:null,nodeClassMap:{14:mstrmojo.AndOrNode,"*":mstrmojo.ConditionNode},onBlankClick:function(G){this.clearTreeSelect();},onnodemousedown:function(H){var I=mstrmojo.dom.eventTarget(H.hWin,H.e),J=H.src,G=J.listMapper.findIndex(J,J.itemsContainerNode,I),K=G>=0?J.ctxtBuilder.itemWidgets[G]:null;if(!K||(K.isSelectableArea&&!K.isSelectableArea(I))){this.onBlankClick(H);}},getItemIdentityProp:function(G){return G.et;},itemFunction:function(L,I,M){var H=M.tree,J=H.getItemConfig(L,I,M),K=H.nodeClassMap,G=K[H.getItemIdentityProp(L)]||K["*"];return G&&(new G(J));},getItemConfig:function(J,G,K){var H=(J.et===B.ANDOR),I=K.tree||K;return{data:J,tree:I,parent:K,bindings:{prefixedAndOrEditable:"this.parent.editable"},itemFunction:(H)?K.itemFunction:null,draggable:H?I.draggable:false,dropZone:H?I.dropZone:false,allowDrop:H&&I.dropZone?I.allowDrop:null,allowCopy:H?I.allowCopy:false,editable:I.isEditable?I.isEditable(J):I.editable,makeObservable:H&&K.makeObservable,onclick:I.onnodeclick,onadd:I.onnodeadd,onremove:I.onnoderemove};},getDragData:function(G){var I=this._super(G);if(I&&!I.html){var H=I.et&&F.ET2TGT[I.et];I.html=H?I[H]&&I[H].n||"":I.n||"";}return I;},newCondition:function E(K){K=K||{et:B.AQ};var J=this.selectionParentNode,G;J=(J&&J.hasRendered)?J:this;if(J!==this){G=J.add([K]);}else{var I=this.addCondition([K],null,true);G=I.index;J=I.widget;}var H={widget:J,index:G,data:K};if(this.onNew){this.onNew(H);}return H;},addCondition:function D(I,K){var L=this.items,H=L&&L.length,N=I&&I.length;if(!N){return null;}var J,G;if(H&&L[0].et===B.ANDOR){J=this.ctxtBuilder.itemWidgets[0];G=J.add(I,null);}else{if(!H&&(N===1)){J=this;G=0;this.add(I,0);}else{if(H){var M=L[0];this.remove(M);I.unshift(M);}this.add([{et:B.ANDOR,fn:F.FN.AND,nds:I}],0);J=this.ctxtBuilder.itemWidgets[0];G=H?1:0;}}return{widget:J,index:G};},addSingleCondition:function C(H,G){var I=this.addCondition([H],G);return I.widget.ctxtBuilder.itemWidgets[I.index];},ondrop:function(J){if(this._super){this._super(J);}var H=this.items,G=H&&H.length,I=H.concat();if(G>1){if(H.remove){H.remove(0,H.length);}else{this.set("items",null);}this.add([{et:B.ANDOR,fn:F.FN.AND,nds:I}],0);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.AndOrNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo.expr","mstrmojo.dom","mstrmojo.array","mstrmojo.css");var L=mstrmojo.expr,N=mstrmojo.dom,C=mstrmojo.array,A=mstrmojo.css,F=mstrmojo.fe._IsRelationTreeNode.createSetHtml;var M=function(){var T="noRelationOperator",P=this[T],R=this.ctxtBuilder&&this.ctxtBuilder.itemWidgets||[],S=mstrmojo.array.filter(R,function(U){return U&&U[T]!==P&&U.data.et!==L.ET.RLS;}),O=S.length;for(var Q=0;Q<O;Q++){S[Q].set(T,P);}};mstrmojo.fe.AndOrNode=mstrmojo.declare(mstrmojo.AndOrNode,[mstrmojo.fe._IsRelationTreeNode],{scriptClass:"mstrmojo.fe.AndOrNode",markupString:'<div id="{@id}" class="mstrmojo-andor mstrmojo-AndOrNode {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-andor-prefix" mstrAttach:click><span class="mstrmojo-textset mstrmojo-andor-prefix-text"></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-andor-top"></div><div class="mstrmojo-andor-contentsWrapper" style="position:relative"><div class="mstrmojo-andor-contents" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue mstrmojo-AndOrNode-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner mstrmojo-AndOrNode-dropCue-inner"></div></div></div><div class="mstrmojo-andor-bottom"></div></div>',getPrefixAndOrToolsMarkup:function(){return(F+this._super());},markupSlots:mstrmojo.hash.copy({createSetNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;}},mstrmojo.hash.copy(mstrmojo.AndOrNode.prototype.markupSlots)),markupMethods:mstrmojo.hash.copy({onnoRelationOperatorChange:function(){A.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);}},mstrmojo.hash.copy(mstrmojo.AndOrNode.prototype.markupMethods)),removeSet:function G(P){var O=P.childIndex(),Q=P.data,R=[Q];if(O>=0){this.remove(O,true);if(Q.nds&&Q.nds.length>0){R=Q.nds;if(Q.not){R[0].not=true;}}else{delete Q.dmy;delete Q.relation;delete Q.applySubExpr;delete Q.relation;delete Q.useSchema;delete Q.dmt;}this.add(R,O);this.consolidate(false);}},createSet:function E(Q,O){var P=this._ndsToMove(this,Q);if(!P){return ;}this.remove(P.idxs,true);var U=P.nds,T;if(U){if(U.length>1){var S={et:L.ET.ANDOR,nds:U};S.fn=this.data.fn;U=[S];T=S.nds[0].not;}else{var V=U[0];if(V&&V.not&&V.et===L.ET.ANDOR){T=V.not;delete V.not;}}}if(O&&O.rq){var R;if(O.isMetric){R=O.cq;mstrmojo.hash.copyProps(["applySubExpr","dmy","dmt","relation","useSchema"],O.rq,R);}else{R=O.rq;R.nds=U;if(T){R.not=T;}}this.add([R],P.idxs[0]);}this.consolidate(false);},preclick:function H(O){var R=null,Q=N.eventTarget(O.hWin,O.e),P=this._super(O);if(N.contains(this.createSetNode,Q,true)&&!this.noRelationOperator){R="createSetOpt";}O.part=R||O.part;return P;},preadd:function I(O){if(this._super){this._super(O);}this.updateRelationOperator();},preremove:function K(O){if(this._super){this._super(O);}this.updateRelationOperator();},consolidate:function B(){this._super();this.updateRelationOperator();},postBuildRendering:function J(){var O=this._super();this.updateRelationOperator();return O;},updateRelationOperator:function D(){var O=this.ctxtBuilder&&this.ctxtBuilder.itemWidgets||[],P=!!C.filterOne(O,function(R){return R&&(R.data.et===L.ET.RLS||(R.data.et===L.ET.ANDOR&&R.noRelationOperator));}),Q=this.parent;this.set("noRelationOperator",P);M.call(this);if(Q&&Q.hasRendered&&Q.updateRelationOperator){Q.updateRelationOperator();}},onmouseover:function(){this.toggleGroupBorder(true);},onmouseout:function(){this.toggleGroupBorder(false);}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.WidgetTree","mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowserSelector");mstrmojo.TreeBrowserEnum={};var I=mstrmojo.TreeBrowserEnum;I.BRANCH_POLICY_TOGGLE="toggle";I.BRANCH_POLICY_SELECT="select";mstrmojo.TreeBrowser=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.TreeBrowser",cssClass:"mstrmojo-TreeBrowser",browserNodeClass:mstrmojo.TreeBrowserNode,blockCount:30,noCheckBox:false,selectionAcrossBranch:true,branchClickPolicy:I.BRANCH_POLICY_TOGGLE,contentRetrieved:false,listSelector:mstrmojo.TreeBrowserSelector,handleNodeClicked:function(J){},getContentThroughTaskCall:function H(K,J){},isBranch:function F(J){},item2textCss:function C(J){return{"-1":"failed","-2":"loading","-3":"next","-4":"prev"}[J.st]||"";},failItemCreaterFunc:function(){return{n:"Loading Failed!",did:"-1",tp:"-1",st:"-1"};},loadingItemCreaterFunc:function(){return{n:mstrmojo.desc(5674,"Loading..."),did:"-2",tp:"-2",st:"-2"};},nextItemCreaterFunc:function(J){return{n:mstrmojo.desc(4507,"Next ##  item(s)...").replace("##",J?Math.min(J,this.blockCount):this.blockCount),did:"-3",tp:"-3",st:"-3"};},prevItemCreaterFunc:function(){return{n:mstrmojo.desc(4508,"Previous ##  item(s)...").replace("##",this.blockCount),did:"-4",tp:"-4",st:"-4"};},updateTreeContent:function(K,M){K.contentRetrieved=true;var L=M[K.itemChildrenField]||[],J=K.tree||K,O=M.bc,N=M.sz,P=M.bb;if(O!==-1){if(P+O<N){L.push(J.nextItemCreaterFunc(N-P-O+1));}if((P-O)>-1){L.unshift(J.prevItemCreaterFunc());}}K.blockBegin=P;J.initializing=true;K.clearSelect(false);K.set("items",L);K.setSelectedItems(J.getTotalSelections(),true);J.initializing=false;if(J.onNodeExpand){J.onNodeExpand(K);}},getContent:function(K,O){var L=(K===this),J=this,P=function(Q){if(L){mstrmojo.css.removeClass(J.domNode,["loading"]);}J.updateTreeContent(K,Q);},M=function(Q){K.contentRetrieved=true;K.set("items",[J.failItemCreaterFunc()]);},N={success:P,failure:M};if(L){mstrmojo.css.addClass(J.domNode,["loading"]);}this.getContentThroughTaskCall({isRoot:L,data:K.data,blockBegin:L?0:(O||K.blockBegin),blockCount:J.blockCount},N);},postBuildRendering:function A(){this._super();if(!this.contentRetrieved){var J=this;setTimeout(function(){J.getContent(J);},0);}},itemFunction:function G(N,K,L){var J=L.tree||L,M=new J.browserNodeClass({data:N,state:0,parent:L,tree:J,multiSelect:L.multiSelect,text:N[L.itemDisplayField],textCssClass:J.item2textCss(N),items:N[L.itemChildrenField],itemIdField:L.itemIdField,itemDisplayField:L.itemDisplayField,itemIconField:L.itemIconField,itemChildrenField:L.itemChildrenField,itemFunction:L.itemFunction,listSelector:L.listSelector});return M;},clearTreeSelect:function E(){if(!this.selectionAcrossBranch){this._super();}else{var L=this._selectionParentNode,J=L&&L.length,K;for(K=0;K<J;K++){L[K].clearSelect();}this._selectionParentNode=null;this._totalSelections=null;}},onnodechange:function D(T){if(this.initializing){return ;}if(!this.selectionAcrossBranch){this._super(T);}else{this._totalSelections=this._totalSelections||[];this._selectionParentNode=this._selectionParentNode||[];var R=this._totalSelections,J=this._selectionParentNode,S=T.added,P=T.removed,Q=[],L=[],K=T.src,N,M,O,U;J.push(K);for(N=0,O=P&&P.length;N<O;N++){L.push(K.items[P[N]]);}mstrmojo.array.removeItems(R,"did",L);for(M=0,U=S&&S.length;M<U;M++){Q.push(K.items[S[M]]);}this._totalSelections=R.concat(Q);}},getTotalSelections:function B(){if(this.selectionAcrossBranch){return this._totalSelections||[];}var J=this.selectionParentNode;return J&&J.getSelectedItems();}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DITreeNodeDnD","mstrmojo.WidgetTree","mstrmojo.DI.DIHelpers");var C=mstrmojo.DI.DIHelpers,E=mstrmojo.dom,D=mstrmojo.array;mstrmojo.DI.DITreeDnD=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.DI.DITreeDnD",renderOnScroll:false,itemFunction:function B(J,G,H){var K="Name: "+J[H.itemDisplayField];if(H.sizeTooltip){if(J.isFolder){if(H.folderSizeTooltip){K+=" Size: ---";}}else{if(J.type==="application/vnd.google-apps.spreadsheet"){K+=" Size: unavailable";}else{if(typeof J.size==="number"){K+=" Size: "+C.getRoundSize(J.size);}}}}var F=H.tree||H,I=new mstrmojo.DI.DITreeNodeDnD({edit:J.edit,data:J,state:0,parent:H,tree:F,supportFolderDrag:H.supportFolderDrag,text:J[H.itemDisplayField],tooltipContent:K,useRichTooltip:true,_ontooltipover:function(L){E.stopPropogation(self,L);I.showTooltip(L,self);},textCssClass:"mstrmojo-di-tree-node-dnd",index:G,items:J[H.itemChildrenField],itemIdField:H.itemIdField,itemDisplayField:H.itemDisplayField,itemIconField:H.itemIconField,itemChildrenField:H.itemChildrenField,itemFunction:H.itemFunction,listSelector:H.listSelector,iconFolderClosed:J.iconFolderClosed||"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:J.iconFolderOpen||"mstrmojo-di-tree-node-icon folder-open"});J.node=I;return I;},postCreate:function(){if(this._super){this._super();}this.selectedNodes=[];this.selectedNode=null;},selectedNodes:[],selectedNode:null,selectNode:function A(H,N){if(!N||(!C.isCtrlKey(N.hWin,N.e)&&!mstrmojo.dom.shiftKey(N.hWin,N.e))){D.forEach(this.selectedNodes,function(O){if(O!==null&&O!==H){O.deselect();}});this.selectedNode=H;this.selectedNodes=[H];}else{if(N&&C.isCtrlKey(N.hWin,N.e)){var M=mstrmojo.array.find(this.selectedNodes,"id",H.id);if(M<0){this.selectedNodes.push(H);this.selectedNode=H;}else{H.deselect();this.selectedNodes.splice(M,1);if(this.selectedNode===H){this.selectedNode=null;}}}else{if(N&&mstrmojo.dom.shiftKey(N.hWin,N.e)){var G=H,J=G;if(this.selectedNode){var K=0;while(this.selectedNode.ancestorList[K]===H.ancestorList[K]){K++;}if(this.selectedNode.ancestorList[K]<H.ancestorList[K]){G=this.selectedNode;}else{J=this.selectedNode;}}var I;if(this.selectedNodes.length>=2){var L=this.selectedNodes.length;for(I=0;I<L;I++){this.selectedNodes[I].deselect();}}this.selectedNodes=[];this.selectedNode=H;var F=G;while(F!==J){if(!F.data.isFolder){this.selectedNodes.push(F);mstrmojo.css.addClass(F.listNode,"selected");}F=F.nextOrderNode;}this.selectedNodes.push(J);mstrmojo.css.addClass(J.listNode,"selected");}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.hash","mstrmojo.func","mstrmojo.css","mstrmojo.HBox","mstrmojo.Box","mstrmojo.DropDownButton","mstrmojo.Popup","mstrmojo.WidgetTree","mstrmojo.ObjectBrowserDataProvider","mstrmojo.OBList","mstrmojo.FishEyeContainer","mstrmojo.SearchBox2","mstrmojo.Booklet","mstrmojo.IncFetch","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.mstr.ui.IncFetchOBList");var O=mstrmojo.hash,W=mstrmojo.func,L=mstrmojo.meta.TP,F="5CECE58CC1D549F890EB61C4DB2156A3",T="E0CCB9CF22104A489CBE78D974AFD19E",Q=mstrmojo.chart.model.enums.EnumDSSObjectType,K=mstrmojo.array,D=mstrmojo.dom,X=function(f,g,a){var d=f.scrollableIncFetch,c=d?"mstrmojo.mstr.ui.IncFetchOBList":"mstrmojo.OBList",e={scriptClass:c,items:g.items,multiSelect:a};if(d){e.browseConfig={blockBegin:g.bb,blockCount:g.bc,totalSize:g.sz,folderLinksContextId:f.folderLinksContextId,rootFolderID:g.did,browsableTypes:f.browsableTypes,browsableViewMedias:f.browsableViewMedias,dataProvider:f.dataProvider};e.onwaitingChange=function(){if(f.booklet){f.booklet.set("waiting",this.waiting);}};}var b=mstrmojo.insert(e);b.render();return b;},A=function(c,d,a){var b=mstrmojo.ObjectBrowser.widgetHandler||X;return b(c,d,a);},N={success:function(c){var d=this.ob,b=c.items,e=d.pageCache[d.currentPage],a=e._w;e.items=b;a.set("items",b);this.ob=null;this.item=null;window.clearTimeout(d._btm);d.booklet.set("waiting",false);if(d.scrollableIncFetch&&a.scrollNode){a.initScroll();a.updateScrollbars();}},failure:function(a){window.alert(a.getResponseHeader("X-MSTR-TaskFailureMsg"));this.ob.booklet.set("waiting",false);}},S=function(f,e,c){var d=c?-1:1,b=f.pageCache.length,g;for(g=f.currentPage+d;g<b&&g>=0;g+=d){var a=f.pageCache[g];if(a._k===e.k){return{steps:g-f.currentPage,cache:a};}}return null;},C=function(e,d,c,f){var g=e.currentPage+1,b=e.pageCache.length,a;for(a=g;a<b;a++){e.pageCache[a]._w.destroy();delete e.pageCache[a].items;}e.pageCache=e.pageCache.slice(0,g);f._w=c;f._k=d.k;e.pageCache[g]=f;e.cacheChange();},H=function(b){var a=mstrmojo.hash.walk("anc.items.0.items",b);this.set("canGoUp",!(!b.pf||!a));},I=function(e,d,f,c,b){delete e._btm;var a;if(!c){a=A(e,f,e.multiSelect);a.attachEventListener("change",e.id,"navigate");if(e.useDblSelect||e.useBothSglDblSelect){a.attachEventListener("dblclick",e.id,"dblselect");}}else{a=f._w;}e.obList=a;e.booklet.turn(a,b>0);window.setTimeout(function(){e.onBrowsing=false;},300);if(!c){C(e,d,a,f);}e.set("currentFolder",f);e.set("currentPage",e.currentPage+b);e.updateUpButton(f);if(e.scrollableIncFetch&&a.scrollNode){a.initScroll();a.updateScrollbars();}},P=function(c,b,a){var d=S(c,b,false);d=d||S(c,b,true);if(!d){window.clearTimeout(c._btm);c._btm=window.setTimeout(function(){c.booklet.set("waiting",true);},300);a.ob=c;a.item=b;c.getDataProvider().fetchFolderContents(c,b,a);}else{I(c,b,d.cache,true,d.steps);}},B=function(b,c,d,a){P(b,{fid:b.pageCache[b.currentPage].did,blockBegin:c,searchPattern:d,recursive:a},N);},J={success:function(b){var c=this.ob;if(c){window.clearTimeout(c._btm);if(!b.items){b.items=[{did:"empty",n:"("+mstrmojo.desc(2210)+")",t:"e"}];}var a=function e(f){var j=f.length,g;for(g=0;g<j;g++){var h=f[g];if(h.did===F||h.did===T){h.n=(h.did===F)?mstrmojo.desc(8112):mstrmojo.desc(9277);}if(h.items){a(h.items);}}};if(b.did===F||b.did===T){b.n=(b.did===F)?mstrmojo.desc(8112):mstrmojo.desc(9277);if(b.anc&&b.anc.items){a(b.anc.items);}}if(b&&b.items&&c.browsableViewMedias){var d={};K.forEach(c.browsableViewMedias.split(","),function(f){d[parseInt(f,10)]=true;});b.items=K.filter(b.items,function(f){return(f.t!==Q.DssTypeDocumentDefinition)||d[f.dvm];});}if(b&&b.items&&mstrApp&&mstrApp.isSingleTier){b.items=K.filter(b.items,function(f){return(f.st!==772);});}if(b.did&&this.item.k!==b.did){this.item.k=b.did;}I(c,this.item,b,false,1);this.ob=null;this.item=null;}},failure:function(a){this.ob.booklet.set("waiting",false);if(this.ob.onError){this.ob.onError(a);}else{if(a.getResponseHeader){mstrmojo.alert(a.getResponseHeader("X-MSTR-TaskFailureMsg"));}else{mstrmojo.alert(a.message);}}},complete:function(){if(this.ob){this.ob.onBrowsing=false;}}},Z=function(c){var b=c.pageCache.length,a;for(a=0;a<b;a++){c.pageCache[a]._w.destroy();}c.pageCache=[];c.currentPage=-1;c.cacheChange();},M=function(d,c,e){var a=d.onBrowseFolder;if(a){a[0][a[1]](c);}if(c&&parseInt(c.acg,10)===33){return ;}var b={};if(c){b.k=c.did;b.fid=c.did;}else{if(d.rootFolderID){b.k=d.rootFolderID;b.fid=d.rootFolderID;}else{if(d.rootFolderType){b.k=d.rootFolderType;b.fty=d.rootFolderType;}else{if(d.folderLinksContextId){b.k=d.folderLinksContextId;}}}}P(d,b,W.wrapMethods(e,O.copy(J)));},V=function(f,a,c){if(!c){return a;}var d=f.showCompletePath,h=a[0],e,b;while(h){var g;for(g=c.length-1;g>=0;g--){if(h.did===c[g].did){c.splice(g,1);h._isSc=true;}}b=h;h._open=true;h=h.items;h=h&&h[0];if(!h){b.lastLeaf=true;}}if(!d){h=a[0];while(h){if(h._isSc){a[0]=h;break;}h=h.items;h=h&&h[0];}}return a.concat(c);},U=function(b,a,c){b._naviInfo=V(b,a,c);};mstrmojo.ObjectBrowser=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.ObjectBrowser",rootFolderType:null,rootFolderID:null,sId:null,closeOnSelect:true,browsableTypes:null,browsableViewMedias:null,includeObjectDesc:false,closeable:true,fishEyeVisible:false,searchVisible:true,upButtonVisible:false,currentFolder:null,pageCache:[],currentPage:-1,blockCount:50,canGoUp:true,folderLinksContextId:null,minSearchLength:2,showCompletePath:true,multiSelect:false,onCloseCB:null,onSelectCB:null,onBrowseFolder:null,scrollableIncFetch:false,useBothSglDblSelect:false,displaySaveLabel:false,useOldSearch:false,getDataProvider:function(){if(!this.dataProvider){this.dataProvider=mstrmojo.insert({scriptClass:"mstrmojo.ObjectBrowserDataProvider"});}return this.dataProvider;},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{scriptClass:"mstrmojo.HBox",alias:"titleBar",cssClass:"mstrmojo-OB-titleTable",children:[{alias:"saveLabel",scriptClass:"mstrmojo.Label",cssClass:"msrmojo-save-label",text:mstrmojo.desc(3178,"Save in:"),bindings:{visible:"this.parent.parent.displaySaveLabel"}},{alias:"title",scriptClass:"mstrmojo.DropDownButton",cssClass:"mstrmojo-FormatEditor-DropDownButton",cssText:"margin:0px;",popupRef:{scriptClass:"mstrmojo.Popup",contentNodeCssClass:"mstrmojo-OBNavigatorPopup",cssText:"position:relative;",slot:"popupNode",locksHover:true,onOpen:function(){var a=this.opener.parent.parent,d=this.tree,c=a._naviInfo,b=this.parent.parent.parent.extraDDItems;if(d.items!==c){d._pup=this;this.ob=a;if(b){K.forEach(b,function(e){e.isExtra=true;});c=c.concat(b);}d.set("items",c);}},children:[{alias:"tree",scriptClass:"mstrmojo.WidgetTree",itemIdField:"did",itemFunction:function(e,a,b){var d=mstrmojo.WidgetTree.prototype.itemFunction(e,a,b);if(e.isExtra){if(e.cssClass){d.cssClass=e.cssClass;}d.onmousedown=e.onmousedown||mstrmojo.emptyFn;return d;}if(e._open){d.state=1;}d._ll=!!e.lastLeaf;d._pup=b._pup;d.onmousedown=function(f){var g=mstrmojo.dom.eventTarget(f.hWin,f.e),h=this._pup;if(g===this.domNode||g===this.textNode){if(!this._ll){M(h.ob,this.data);}h.close();}};d.markupMethods=O.copy(d.markupMethods);d.markupMethods.onstateChange=function(){var f=this.data.items?this.state:0;this.stateNode.className="mstrmojo-TreeNode-state "+({0:"closed",1:"opened",2:"leaf"}[f]||"closed");this.itemsContainerNode.style.display=(f===1)?"block":"none";};d.useRichTooltip=true;var c=d.postBuildRendering;d.postBuildRendering=function(){if(c){c.call(d);}if(d.textNode.parentNode.clientWidth){d.textNode.style.width=(d.textNode.parentNode.clientWidth-20)+"px";}};d.premouseover=function(h){if(this.useRichTooltip){var g=this.textNode;if(g.clientWidth<g.scrollWidth){var f=D.position(g);this.richTooltip={areaId:this.id,cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.data[this.itemDisplayField],top:f.y-2,left:f.x+f.w+6};}else{this.richTooltip=null;}mstrmojo.dom.stopPropogation(h.hWin,h.e);}return true;};return d;}}]}},{alias:"upButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-OBListItemIcon up",title:mstrmojo.desc(1152,"Up One Level"),onclick:function(){this.parent.parent.goUp();},bindings:{enabled:"this.parent.parent.canGoUp",visible:"this.parent.parent.upButtonVisible"}},{alias:"closebtn",scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-OBCloseButton",title:mstrmojo.desc(2102,"Close"),bindings:{visible:"this.parent.parent.closeable"},onclick:function(){this.parent.parent.close();}}]},{alias:"fishEye",scriptClass:"mstrmojo.FishEyeContainer",cssText:"width:100%",bindings:{visible:"this.parent.fishEyeVisible"}},{alias:"searchUpBar",scriptClass:"mstrmojo.HBox",cssClass:"searchBox",children:[{alias:"obSearchBox",scriptClass:"mstrmojo.SearchBox2",cssClass:"mstrmojo-charcoalbox mstrmojo-dxsprite",cssText:"margin: 3px 0; ",contentWidget:mstrmojo.all.obList,taskId:"searchMetadata",searchIncFetch:true,enableMatchCase:false,forceResetCache:true,bindings:{minSearchLength:"this.parent.parent.minSearchLength",quickSearch:"this.parent.parent.quickSearch"},serverRequest:function(a,b){this.parent.parent.getDataProvider().serverRequest(a,b);},preFetch:function(){this.objectTypes=this.parent.parent.browsableTypes||this.objectTypes;this.parent.parent.booklet.set("waiting",true);},postFetch:function(){this.parent.parent.booklet.set("waiting",false);},onUpdateSearchParams:function G(c){var b=this.parent.parent,a=b.sId;if(a){c.sessionState=a;}if(b.useOldSearch){c.quickSearch=0;c.nameWildcards=1;c.sortKey=6;}}}],bindings:{visible:"this.parent.searchVisible"}},{scriptClass:"mstrmojo.Booklet",cssClass:"mstrmojo-OB-booklet",alias:"booklet",hasAnimation:false,bindings:{scrollableIncFetch:"this.parent.scrollableIncFetch"}},{alias:"obIncFetch",scriptClass:"mstrmojo.IncFetch",height:"17px",cssText:"height:0px;overflow:hidden;",visible:false,np:0,cp:0,ds:{f:mstrmojo.desc(4046,"First"),p:mstrmojo.desc(1058,"Previous"),n:mstrmojo.desc(1059,"Next"),l:mstrmojo.desc(4049,"Last"),pgs:mstrmojo.desc(5972,"## of ### pages"),gt:mstrmojo.desc(5878,"Go to:"),v:mstrmojo.desc(6079,"This field should be # between ## and ###.")},onvisibleChange:function(b){var d=parseInt(this.height,10),a=this.np>1,c={target:this.domNode,props:{height:{start:(a?0:d),stop:(a?d:0),suffix:"px"}},onEnd:function(){if(a){this.target.style.overflow="visible";}}},e=new mstrmojo.fx.AnimateProp(c);this.domNode.style.overflow="hidden";mstrmojo.css.toggleClass(this.parent.domNode,"show-inc-fetch",this.visible);e.play();},onifsChange:function(a){var b=this.np;mstrmojo.hash.copy(a.value,this);if(this.np>1){this.children=null;this.refresh();}if((b<=1&&this.np>1)||(b>1&&this.np<=1)||(b===0&&this.np>0)){this.set("visible",this.np>1);}this.cssText="";}}],destroy:function Y(){Z(this);if(this._super){this._super();}},postBuildRendering:function(){if(this._super){this._super();}if(this.fishEye&&this.fishEyeVisible){this.fishEye.attachEventListener("selectedIndexChange",this.id,"onFishEyeChange");}var c=this.searchUpBar;if(c&&c.obSearchBox&&this.searchVisible){this.obSearchBox=this.searchUpBar.obSearchBox;this.obSearchBox.attachEventListener("itemsChange",this.id,"onSearchItemsChange");var a=this.obSearchBox.contentWidget||this.obSearchBox;if(!this.scrollableIncFetch){a.attachEventListener("ifsChange",this.id,function(d){if(!this.scrollableIncFetch){this.obIncFetch.set("ifs",d.value);}});}}if(!this.scrollableIncFetch&&this.obIncFetch){var b=this.obIncFetch;b.attachEventListener("fetch",this.id,function(d){b.cp=d.v;b.children=null;b.refresh();B(this,(d.v-1)*this.blockCount+1,this.searchVisible?this.obSearchBox.inputNode.value:"",1);});}mstrmojo.css.addClass(this.domNode,"mstrmojo-ObjectBrowser");},onSearchItemsChange:function(b){var c=b.value,a=this.pageCache[this.currentPage]._w;if(!c||c.length===0){c=[{did:"empty",n:"("+mstrmojo.desc(2210,"")+")",t:"e"}];}else{if(this.browsableViewMedias){var d={};K.forEach(this.browsableViewMedias.split(","),function(e){d[parseInt(e,10)]=true;});c=K.filter(c,function(e){return(e.t!==Q.DssTypeDocumentDefinition)||d[e.dvm];});}}a.set("items",c);},navigate:function(h){var a=h.src,j=a.selectedItem,c=this.multiSelect,f=c&&a.getSelectedItems(),g=this,b=h.added&&h.added.length,e=h.removed&&h.removed.length,d=c?f.length===1&&(!e||b):!!j;if(d&&j.did==="empty"){return ;}if(d&&parseInt(j[L],10)===8){if(!this.onBrowsing){this.onBrowsing=true;M(this,j);}}else{if((j&&(!this.useDblSelect||this.useBothSglDblSelect))||f){this.select(c?f:j);}}},browseFolder:function(a,b){M(this,{did:a,n:b});},onFishEyeChange:function(a){this.goToPage(a.value);},goToPage:function(a){if(a<this.pageCache.length&&a!==this.currentPage){var c=a>this.currentPage,b=this.pageCache[a];this.set("currentPage",a);this.booklet.turn(b._w,c);this.set("currentFolder",b);H.call(this,b);}},oncurrentPageChange:function(a){if(this.fishEye){this.fishEye.setSelectedIndex(a.value);}var b=this.pageCache[this.currentPage];this.titleBar.title.set("text",mstrmojo.string.encodeHtmlString(b.n));if(this.searchVisible&&this.obSearchBox){this.obSearchBox.set("rootCacheItems",b.items||[]);this.obSearchBox.set("totalSize",b.sz);this.obSearchBox.set("rootID",b.did);this.obSearchBox.clearSearch();}if(!this.scrollableIncFetch&&this.obIncFetch){this.obIncFetch.set("ifs",{np:Math.floor(b.sz/b.bc)+((b.sz%b.bc>0)?1:0),cp:Math.floor(b.bb/b.bc)+((b.bb%b.bc>0)?1:0)});}},cacheChange:function(){if(this.fishEye&&this.fishEyeVisible){this.fishEye.setItems(this.pageCache);}},browse:function(b,a){O.copy(b,this);if(this.searchVisible&&this.obSearchBox){this.obSearchBox.clear();}Z(this);M(this,undefined,a);},close:function(){var b=this.ctx||this,a=b.onCloseCB;if(a){a[0][a[1]]();}b.set("visible",false);},select:function(b){var a=this.onSelectCB;if(a){a[0][a[1]](b);}if(this.closeOnSelect){this.close();}},dblselect:function R(b){var c=b&&b.src.selectedItem;if(!c||(c&&c.did==="empty")||c[L]===8){return ;}if(this.useBothSglDblSelect){var a=this.onDblSelectCB;if(a){a[0][a[1]](c);}if(this.closeOnSelect){this.close();}}else{this.select(c);}},goUp:function(){if(this.canGoUp){M(this,{did:this.currentFolder.pf});}},updateUpButton:function E(a){H.call(this,a);},oncurrentFolderChange:function(a){var b=a.value;U(this,b.anc.items,b.sc);},refreshContent:function(a){B(this,a);},onError:null,onheightChange:function(){var a=["titleBar","fishEye","searchUpBar","obIncFetch"],c=0,b;for(b in a){c+=parseInt(this[a[b]].domNode.offsetHeight,10);}this.booklet.set("height",parseInt(this.height,10)-c+"px");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.Button","mstrmojo.MenuButton");mstrmojo.requiresDescs(212,2140);var C="mstrmojo-qb-footerIcon",F="cancel",B="publish",E="disabled",H="new",D=" ";function I(L){return mstrmojo.hash.copy(L,{scriptClass:"mstrmojo.Button",onclick:function K(){if(this.cmd){mstrApp.getRootController()[this.cmd]();}}});}mstrmojo.qb.Footer=mstrmojo.declare(mstrmojo.Box,null,{hidePublish:function G(){this.publish.set("visible",false);},children:[I({cmd:"publish",enabled:false,text:mstrmojo.desc(212,"Continue"),alias:"publish",postBuildRendering:function A(){mstrApp.getRootController().attachEventListener("allowSave",this.id,function(K){this.set("enabled",K.value);});}}),I({cmd:"cancel",iconClass:[C,F].join(D),text:mstrmojo.desc(2140,"Cancel")})],addChildren:function J(N,K,L){var M=N[0];if(M.alias==="publish"){M.iconClass=[C,B,(mstrApp.reportID?"":H),E].join(D);}this._super(N,K,L);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.MenuButton","mstrmojo.Label","mstrmojo.Image","mstrmojo.CheckBox","mstrmojo.ui.Checkbox");mstrmojo.requiresDescs(172,212,373,1059,1279,1302,2140,2400,3345,8132,9115,10236,12387,12693,12694,12695,13195,13587,13852,14417,14195,14458,14597,14598);var F=13,N=9,T=mstrmojo.css,E=mstrmojo.dom,U=mstrmojo.DI.DIConstants;var K={UNVISIBLE:1,UNENABLED:2,ENABLED:3};function P(W,V){if(V){if(V.hasOwnProperty("visible")){W.set("visible",V.visible);}if(V.hasOwnProperty("enabled")){W.set("enabled",V.enabled);}if(V.hasOwnProperty("text")){W.set("text",V.text);}}}mstrmojo.DI.DIFooter=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIFooter",markupString:'<div id="{@id}" class="{@cssClass}" tabIndex="0"><div class="footer-buttons back"></div><div class="footer-buttons"></div><div class="footer-buttons"></div><div class="footer-buttons"></div><div class="footer-managed-checkbox"></div><div class="footer-managed-label"></div><div class="footer-dda-checkbox"></div><div class="footer-dda-label"></div><div class="footer-buttons"></div><div class="cube-quota"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},backNode:function(){return this.domNode.children[0];},cancelNode:function(){return this.domNode.children[1];},saveNode:function(){return this.domNode.children[2];},nextNode:function(){return this.domNode.children[3];},managedNode:function(){return this.domNode.children[4];},managedLabelNode:function(){return this.domNode.children[5];},ddaNode:function(){return this.domNode.children[6];},ddaLabelNode:function(){return this.domNode.children[7];},finishNode:function(){return this.domNode.children[8];},cubeQuotaNode:function(){return this.domNode.children[9];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},init:function Q(V){var W;if(this._super){W=this._super(V);}this.initButtons();return W;},controlButtons:[],hotButtonIndex:-1,toggleButtonHOTStyle:function M(W,V){T.toggleClass(this.controlButtons[W].obj.domNode,["select"],V);},initButtons:function L(){this.controlButtons=[];this.controlButtons.push({obj:this.back,status:K.UNVISIBLE});this.controlButtons.push({obj:this.finish,status:K.UNVISIBLE});this.controlButtons.push({obj:this.next,status:K.UNVISIBLE});this.controlButtons.push({obj:this.save,status:K.UNVISIBLE});this.controlButtons.push({obj:this.cancel,status:K.UNVISIBLE});},refreshControlButtonsStatus:function B(){mstrmojo.array.forEach(this.controlButtons,function(V){var W=V.obj;if(W&&W.visible&&W.visible===true){if(W.enabled&&W.enabled===true){V.status=K.ENABLED;}else{V.status=K.UNENABLED;}}else{V.status=K.UNVISIBLE;}});},selectNextButton:function I(){var V=(this.hotButtonIndex+1)%this.controlButtons.length;var W=this.hotButtonIndex;while(V!==W&&this.controlButtons[V].status!==K.ENABLED){V=(V+1)%this.controlButtons.length;}if(V!==W){this.toggleButtonHOTStyle(this.hotButtonIndex,false);this.hotButtonIndex=V;this.toggleButtonHOTStyle(this.hotButtonIndex,true);}},initSelectedButton:function H(){var V=0;while(V<this.controlButtons.length&&this.controlButtons[V].status!==K.ENABLED){V+=1;}if(V<this.controlButtons.length){this.hotButtonIndex=V;this.toggleButtonHOTStyle(this.hotButtonIndex,true);}},showControls:function S(V){if(V.next){P.call(this,this.next,V.next);}if(V.back){P.call(this,this.back,V.back);}if(V.cancel){P.call(this,this.cancel,V.cancel);}if(V.dda){P.call(this,this.ddaCheckbox,V.dda);P.call(this,this.ddaLabel,V.dda);}if(V.finish){P.call(this,this.finish,V.finish);}if(V.cubeQuota&&!mstrApp.isSingleTier){P.call(this,this.cubeQuotaLabel,V.cubeQuota);P.call(this,this.cubeQuota,V.cubeQuota);}if(V.save){P.call(this,this.save,V.save);}if(V.managedCheckbox){P.call(this,this.managedCheckbox,V.managedCheckbox);P.call(this,this.managedLabel,V.managedCheckbox);}if(V.mdxRACheckbox){P.call(this,this.mdxRA,V.mdxRACheckbox);}this.refreshControlButtonsStatus();},enableButton:function O(V){var W;if(!this.visible){return ;}switch(V.name){case"allowSave":W=V.value;break;case"refreshTables":W=V.items.length>0;if(V.hasOwnProperty("tablesEnabled")){W=W&&V.tablesEnabled;}break;}if(W!==undefined){this.set("enabled",W);}},onQuotaChange:function(){var V=this.model.cubesInfo;var W="";if(V===-1){this.cubeQuotaLabel.set("text",mstrmojo.desc(14195,"We are unable to retrieve the information about your cubes."));return ;}if(!V||!V.cubes){return ;}if(V.cubes.cquota===-1){this.cubeQuota.updateProgress(0);W=mstrmojo.desc(12693,"##### MB used. You have unlimited storage!").replace("#####",Math.round(V.cubes.cusage))+" "+mstrmojo.desc(13195,"Manage Your Datasets...");this.cubeQuotaLabel.set("text",W);}else{this.cubeQuota.updateProgress(Math.round(V.cubes.cusage/V.cubes.cquota*10000)/100);W=mstrmojo.desc(12694,"##### MB (*****%) out of @@@@@ MB used.").replace("#####",Math.round(V.cubes.cusage)).replace("*****",Math.round(V.cubes.cusage/V.cubes.cquota*10000)/100).replace("@@@@@",Math.round(V.cubes.cquota))+" "+mstrmojo.desc(13195,"Manage Your Datasets...");this.cubeQuotaLabel.set("text",W);}},preBuildRendering:function C(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("cubesInfoChange",this.id,"onQuotaChange");if(this.model.cubesInfo){var W="";var V=this.model.cubesInfo;if(V.cubes.cquota===-1){this.cubeQuota.updateProgress(0);W=mstrmojo.desc(12693,"##### MB used. You have unlimited storage!").replace("#####",Math.round(V.cubes.cusage))+" "+mstrmojo.desc(13195,"Manage Your Datasets...");this.cubeQuotaLabel.set("text",W);}else{W=mstrmojo.desc(12694,"##### MB (*****%) out of @@@@@ MB used.").replace("#####",Math.round(V.cubes.cusage)).replace("*****",Math.round(V.cubes.cusage/V.cubes.cquota*10000)/100).replace("@@@@@",Math.round(V.cubes.cquota))+" "+mstrmojo.desc(13195,"Manage Your Datasets...");this.cubeQuotaLabel.set("text",W);this.cubeQuota.updateProgress(Math.round(V.cubes.cusage/V.cubes.cquota*10000)/100);}}},postBuildRendering:function R(){if(this._super){this._super();}if(this.model.cubesInfo){var V=this.model.cubesInfo;if(V.cubes.cquota===-1){this.cubeQuota.updateProgress(0);}else{this.cubeQuota.updateProgress(Math.round(V.cubes.cusage/V.cubes.cquota*10000)/100);}}this.next.richTooltip.refNode=this.nextNode;},onkeydown:function G(V){if(V.e.keyCode===F){this.controlButtons[this.hotButtonIndex].obj.onclick(V);}else{if(V.e.keyCode===N){this.selectNextButton();}}mstrmojo.dom.preventDefault(V.hWin,V.e);return false;},children:[{scriptClass:"mstrmojo.ui.Checkbox",slot:"ddaNode",text:mstrmojo.desc(12387,"Direct Data Connection"),alias:"ddaCheckbox",oncheckedChange:function J(){mstrApp.getRootController().getDDAController().onToggleDDA(this.checked);},preBuildRendering:function D(){if(this._super){this._super();}},bindings:{visible:function(){return !mstrApp.isSingleTier;}},postCreate:function A(){if(this._super){this._super();}this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.onenabledChange=function(){T.toggleClass(this.domNode,"disabled",!this.enabled);T.toggleClass(this.parent.ddaLabel.domNode,"disabled",!this.enabled);};}},{scriptClass:"mstrmojo.Label",slot:"ddaLabelNode",text:mstrmojo.desc(12387,"Direct Data Connection"),alias:"ddaLabel",bindings:{visible:function(){return !mstrApp.isSingleTier;}}},{scriptClass:"mstrmojo.CheckBox",cssClass:"managedCheckbox",slot:"managedNode",alias:"managedCheckbox",visible:false,oncheckedChange:function J(){mstrApp.getRootController().model.set("isManagedCube",this.checked);},onenabledChange:function(){this.set("checked",mstrApp.getRootController().model.isManagedCube);},postBuildRendering:function(){var V=mstrApp.getRootController().model;V.attachEventListener("isManagedCubeChange",this.id,"update");},update:function(){var V=mstrApp.getRootController().model;this.set("checked",V.isManagedCube);},bindings:{enabled:function(){return mstrApp.getRootController().model.operationMode===U.operationMode.create;},checked:function(){if(mstrApp.getRootController().model.isCalledByFlex){return false;}return mstrApp.getRootController().model.isManagedCube;}}},{scriptClass:"mstrmojo.Label",slot:"managedLabelNode",text:"Managed Cube",alias:"managedLabel",visible:false,bindings:{enabled:function(){return mstrApp.getRootController().model.operationMode===U.operationMode.create;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(2140,"Cancel"),slot:"cancelNode",alias:"cancel",onclick:function(){mstrApp.getRootController().onCancelButtonClick();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(2400,"Save"),slot:"saveNode",alias:"save",onclick:function(){mstrApp.getRootController().onSaveButtonClick();},bindings:{visible:function(){return !mstrApp.isSingleTier;}}},{slot:"backNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button back mstrmojo-WebButton ",text:mstrmojo.desc(373,"Back"),alias:"back",onclick:function(){mstrApp.getRootController().onBackButtonClick();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",alias:"next",slot:"nextNode",text:mstrmojo.desc(212,"Continue"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,top:-32},ontextChange:function(){if(this.text!==mstrmojo.desc(13852,"Prepare Data")){this.richTooltip.content="";}else{this.richTooltip.content=mstrmojo.desc(13587,"Edit data and add more tables.");}if(this.text===mstrmojo.desc(1302,"Finish")){T.addClass(this.domNode,"hot");}},onclick:function(){mstrApp.getRootController().onNextButtonClick();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",alias:"finish",slot:"finishNode",text:mstrmojo.desc(1302,"Finish"),visible:false,onclick:function(){mstrApp.getRootController().onFinishButtonClick();}},{scriptClass:"mstrmojo.ProgressBar",alias:"cubeQuota",slot:"cubeQuotaNode",cssClass:"mstrmojo-di-user-quota",bindings:{visible:function(){return !mstrApp.isSingleTier;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-user-quota-text",alias:"cubeQuotaLabel",slot:"cubeQuotaNode",text:mstrmojo.desc(12695,"Fetching Cube Quota Information..."),bindings:{visible:function(){return !mstrApp.isSingleTier;}},onclick:function(V){mstrApp.getRootController().displayCubesInfo(V,true);}},{scriptClass:"mstrmojo.Label",allowHTML:true,cssClass:"mstrmojo-di-source-admin cf",alias:"sourceAdmin",visible:false,text:'<span class="icon"></span><span class="text">'+mstrmojo.desc(14417,"Customize")+"</span>",onclick:function(){mstrApp.getRootController().showPage(U.pageType.sourceAdmin);}},{scriptClass:"mstrmojo.Box",alias:"mdxRA",visible:false,cssClass:"mstrmojo-di-mdx-ra-checkbox cf",useRichTooltip:true,tooltipOpenDelay:1500,updateTooltipConfig:function(){var V=E.position(this.domNode);this.set("richTooltip",{top:Math.max(V.y+18,0),left:Math.max(V.x+V.w/2,0),cssClass:"vi-regular A-center vi-tooltip-V mstrmojo-di-mdx-ra-checkbox-tooltip",posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.content});},content:mstrmojo.desc(14598,"MicroStrategy provides two types of attributes: normal attributes and hierarchical attributes. A normal attribute represents a single hierarchy level, e.g., Month. A hierarchical attribute represents an entire hierarchy and its levels, e.g., Time. If a hierarchy is imported as a single hierarchical attribute, then the entire hierarchy can be placed on a report at once, and operations like filtering and sorting can be performed respecting the hierarchy. If a hierarchy is imported as multiple normal attributes to represent each hierarchy level, then each level can be placed on a report separately, and filters can be created on specific levels."),update:function(V){this.children[0].update();this.set("visible",!!V);},children:[{scriptClass:"mstrmojo.ui.Checkbox",oncheckedChange:function J(){mstrApp.getRootController().setRecursive(this.checked?1:0);},update:function(){var X=this,W={},V=W[this.id]={};V.recursiveChange=function(Y){X.set("checked",Y.value?true:false);};mstrApp.getRootController().attachDataChangeListeners(W);X.set("enabled",!mstrApp.tableID);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14597,"Import hierarchy as hierarchical attribute")}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.array","mstrmojo.CheckList","mstrmojo.fx");mstrmojo.requiresDescs(221,871,873,1442,2052,2057,2461,10042,10043,10044,10045,10046,10047,10048,10049,10050,10051,12929);var X=mstrmojo.hash;var C="all",A=1,M=2,T=4,U=8,Y=16,S=32,Q=64,R=128,B=256,F=512,L=1024,N=2048,O=4096;var K=[{n:mstrmojo.desc(2461,"All"),did:C}],J=[{n:mstrmojo.desc(873,"Year"),did:A},{n:mstrmojo.desc(10050,"Quarter"),did:M},{n:mstrmojo.desc(10051,"Quarter of Year"),did:T},{n:mstrmojo.desc(871,"Month"),did:U},{n:mstrmojo.desc(10049,"Month of Year"),did:Y},{n:mstrmojo.desc(10048,"Week"),did:S},{n:mstrmojo.desc(10047,"Week of Year"),did:Q},{n:mstrmojo.desc(2052,"Date"),did:R},{n:mstrmojo.desc(10046,"Day of Month"),did:B},{n:mstrmojo.desc(10045,"Day of Week"),did:F}],I=[{n:mstrmojo.desc(10042,"Hour"),did:L},{n:mstrmojo.desc(10043,"Minute"),did:N},{n:mstrmojo.desc(10044,"Second"),did:O}],E=[{n:mstrmojo.desc(2057,"None")},{n:mstrmojo.desc(873,"Year"),did:A},{n:mstrmojo.desc(10050,"Quarter"),did:M},{n:mstrmojo.desc(871,"Month"),did:U},{n:mstrmojo.desc(10048,"Week"),did:S},{n:"Day",did:R}];var H=false;var D=1,G=2,P=3,W=4;mstrmojo.qb.TimeDimension=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.TimeDimension",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};width:155px;height:{@height};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-qb-mapping-title">{@title}</div><div class="mstrmojo-qb-mapping-time"></div><div class="mstrmojo-qb-mapping-buttons"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},titleNode:function(){return this.domNode.firstChild.childNodes[0];},buttonNode:function(){return this.domNode.firstChild.childNodes[2];}},top:"0px",left:"0px",height:"320px",title:mstrmojo.desc(12929,"Please select additional time attributes that you want to create."),mode:P,init:function V(a){this._super(a);this.raiseEvent({name:"modeChange"});},onmodeChange:function Z(){var c=this.mode,a=[],b;switch(c){case D:a=K.concat(J);b=this.timebrowser;break;case G:a=K.concat(I);b=this.timebrowser;break;case P:a=K.concat(J).concat(I);b=this.timebrowser;break;case W:a=E.concat(I);b=this.timeRoleList;break;default:break;}b.set("items",a);b.set("visible",true);},_close:function(){var a=this.parent;if(a&&a._cmSource){a._cmSource.closeMenuTree();}},onOK:function(){var f;if(this.mode===W){f=this.timeRoleList.getSelectedItems();}else{f=this.timebrowser.getSelectedItems();}var e=this.parent,c,a,d,b;this.data.geo=false;d=f.slice();b=0;for(c=0,a=d.length;c<a;c++){(d[c].did!=="all")&&(b=b|d[c].did);}this.data.der=b;mstrApp.getRootController().setTimeRole(this.data);this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.CheckList",slot:"contentNode",alias:"timebrowser",cssClass:"mstrmojo-qb-time-tree",visible:false,onchange:function(b){var e=b.added,g=b.removed,c,f,a,d;if(H){H=false;return ;}if(e){c=this.items;f=c.length;d=this.selectedIndices;if(e[0]===0){for(a=0;a<f;a++){if(!d[a]){H=true;this.setSelectedItems(c,true);break;}}}else{for(a=1;a<f;a++){if(!d[a]){return ;}}if(!d[0]){H=true;this.toggleSelect(0,false);}}}if(g){if(g[0]===0){this.clearSelect();}else{if(this.selectedIndices[0]){H=true;this.toggleSelect(0,false);}}}},onRender:function(){var c=this.parent.der,b=this.items,e=[],d,a;for(d=0,a=b.length;d<a;d++){(c&b[d].did)&&(e.push({did:b[d].did}));}(a===e.length+1)&&(e.push({did:"all"}));e.length&&this.setSelectedItems(e,true);}},{scriptClass:"mstrmojo.RadioList",slot:"contentNode",alias:"timeRoleList",cssClass:"mstrmojo-qb-time-tree",visible:false}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.array","mstrmojo.CheckList","mstrmojo.fx","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(487,871,872,873,2052,2057,2461,10042,10043,10044,10045,10046,10047,10048,10049,10050,10051,12731,12732,13008);var E="all",O=0,A=1,Q=2,Y=4,Z=8,d=16,X=32,V=64,W=128,C=256,I=512,P=1024,R=2048,S=4096;var f=mstrmojo.DI.DIConstants;var B=f.timeRoles;var N=[{n:mstrmojo.desc(2461,"All"),did:E}],M=[{n:mstrmojo.desc(873,"Year"),did:A},{n:mstrmojo.desc(10050,"Quarter"),did:Q},{n:mstrmojo.desc(10051,"Quarter of Year"),did:Y},{n:mstrmojo.desc(871,"Month"),did:Z},{n:mstrmojo.desc(10049,"Month of Year"),did:d},{n:mstrmojo.desc(10048,"Week"),did:X},{n:mstrmojo.desc(10047,"Week of Year"),did:V},{n:mstrmojo.desc(2052,"Date"),did:W},{n:mstrmojo.desc(10046,"Day of Month"),did:C},{n:mstrmojo.desc(10045,"Day of Week"),did:I}],L=[{n:mstrmojo.desc(10042,"Hour"),did:P},{n:mstrmojo.desc(10043,"Minute"),did:R},{n:mstrmojo.desc(10044,"Second"),did:S}],G=[{n:mstrmojo.desc(2057,"None"),did:B.NONE},{n:mstrmojo.desc(873,"Year"),did:B.YEAR},{n:mstrmojo.desc(10050,"Quarter"),did:B.QUARTER},{n:mstrmojo.desc(871,"Month"),did:B.MONTH},{n:mstrmojo.desc(10048,"Week"),did:B.WEEK},{n:mstrmojo.desc(872,"Day"),did:B.DAY},{n:mstrmojo.desc(10042,"Hour"),did:B.HOUR},{n:mstrmojo.desc(10043,"Minute"),did:B.MINUTE},{n:mstrmojo.desc(10044,"Second"),did:B.SECOND},{n:mstrmojo.desc(487,"Time"),did:B.TIME},{n:mstrmojo.desc(13008,"Date Time"),did:B.DATE_TIME},{n:mstrmojo.desc(2052,"Date"),did:B.DATE}];var K=false;var F=1,J=2,T=3,c=4;mstrmojo.DI.DITimeDimension=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DITimeDimension",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};width:155px;height:{@height};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-di-mapping-title"></div><div class="mstrmojo-di-mapping-time"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},titleNode:function(){return this.domNode.firstChild.childNodes[0];}},top:"0px",left:"0px",height:"320px",mode:T,timeFormIndex:0,init:function b(g){this._super(g);this.raiseEvent({name:"dataChange"});},onmodeChange:function e(){var j=this.mode,g=[],h;this.timebrowser.set("visible",false);this.timeRoleList.set("visible",false);switch(j){case F:g=N.concat(M);h=this.timebrowser;break;case J:g=N.concat(L);h=this.timebrowser;break;case T:g=N.concat(M).concat(L);h=this.timebrowser;break;case c:g=G.concat(L);h=this.timeRoleList;break;default:break;}h.set("items",g);h.set("visible",true);},ondataChange:function a(){var k=this.data,h=0;if(k.isMultiForm){var g=k.subColumns;var j=[];mstrmojo.array.forEach(g,function(m,l){j.push({n:m.fmn,v:l});if((m.timerole&&m.timerole!==0)||(m.der&&m.der!==0)){h=l;}});this.timeFormIndex=h;this.getMode(k.subColumns[h]);this.multiFormList.set("options",j);this.title.set("text",mstrmojo.desc(12731,"Select a column to mark as a Time role: "));this.multiFormList.set("idx",this.timeFormIndex);}else{this.getMode(k);this.multiFormList.set("visible",false);this.title.set("text",mstrmojo.desc(12732,"Please select a time role for this attribute."));}},getMode:function D(h){var g;switch(h.dtp){case 8:this.set("height","220px");this.mode=1;g=false;break;case 9:this.set("height","100px");this.mode=2;g=false;break;case 1:this.set("height","260px");this.mode=3;g=false;break;case 2:case 3:this.set("height","260px");this.mode=4;g=false;break;default:this.georole=h.georole;break;}this.raiseEvent({name:"modeChange"});},_close:function(){var g=this.parent;if(g&&g._cmSource){g._cmSource.closeMenuTree();}},onOK:function(){var o=this.parent,j,k,n,h,p;var g,l=mstrApp.getRootController();if(this.data.isMultiForm){var m=this.multiFormList.idx;if(m!==this.timeFormIndex){this.data.subColumns[this.timeFormIndex].timerole=0;this.data.subColumns[this.timeFormIndex].der=0;}j=this.data.subColumns[m];}else{j=this.data;}if(this.mode===c){g=this.timeRoleList.getSelectedItems();j.timerole=g[0].did;l.setTimeRole(this.data);}else{g=this.timebrowser.getSelectedItems();h=g.slice();p=0;for(k=0,n=h.length;k<n;k++){if(h[k].did!=="all"){p=p|h[k].did;}}j.der=p;l.setTimeDimension(this.data);}this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.Label",slot:"titleNode",alias:"title"},{scriptClass:"mstrmojo.DropDownList",slot:"titleNode",alias:"multiFormList",idx:0,onvalueChange:function U(){var g=this.parent.data.subColumns[this.value];this.parent.getMode(g);}},{scriptClass:"mstrmojo.CheckList",slot:"contentNode",alias:"timebrowser",cssClass:"mstrmojo-di-time-tree",visible:false,onchange:function(h){var l=h.added,n=h.removed,j,m,g,k;if(K){K=false;return ;}if(l){j=this.items;m=j.length;k=this.selectedIndices;if(l[0]===0){for(g=0;g<m;g++){if(!k[g]){K=true;this.setSelectedItems(j,true);break;}}}else{for(g=1;g<m;g++){if(!k[g]){return ;}}if(!k[0]){K=true;this.toggleSelect(0,false);}}}if(n){if(n[0]===0){this.clearSelect();}else{if(this.selectedIndices[0]){K=true;this.toggleSelect(0,false);}}}},onRender:function(){var m=this.parent,n=m.data,h=this.items,l=[],k,j,g;if(n.isMultiForm){n=n.subColumns[m.multiFormList.value];}j=n.der;for(k=0,g=h.length;k<g;k++){if(j&h[k].did){l.push(h[k]);}}if(g===l.length+1){l.push(h[0]);}if(l.length){this.setSelectedItems(l,true);}}},{scriptClass:"mstrmojo.RadioList",slot:"contentNode",alias:"timeRoleList",cssClass:"mstrmojo-di-time-tree",visible:false,onRender:function H(){var m=this.parent,n=m.data;if(n.isMultiForm){n=n.subColumns[m.multiFormList.value];}var k=n.timerole,h=this.items,l=[],j,g;for(j=0,g=h.length;j<g;j++){if(k===h[j].did){l.push(h[j]);break;}}if(l.length){this.setSelectedItems(l,true);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.array","mstrmojo.CheckList","mstrmojo.fx","mstrmojo.dom","mstrmojo.DI.DIConstants","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(12725);var D=mstrmojo.dom;var C=mstrmojo.DI.DIConstants;mstrmojo.DI.DIShowAllColumns=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIShowAllColumns",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-di-mapping-title"></div><div class="mstrmojo-di-mapping-columns"></div></div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild.childNodes[0];},contentNode:function(){return this.domNode.firstChild.childNodes[1];}},top:"0px",left:"0px",onOK:function(){var H=this.allColumns.getSelectedItems();var G=this.allColumns.items,E=mstrApp.getRootController();for(var F in G){if(mstrmojo.array.indexOf(H,G[F])===-1){G[F].selected=false;}else{G[F].selected=true;}}E.setMultipleImport(G);},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.Label",slot:"titleNode",alias:"title",text:mstrmojo.desc(12725,"Include Columns:")},{scriptClass:"mstrmojo.ui.CheckList",multiSelect:true,orientation:"v",slot:"contentNode",alias:"allColumns",itemDisplayField:"alias",cssClass:"mstrmojo-di-all-columns",preBuildRendering:function A(){var F=this.parent,H=F.data,E=mstrApp.getRootController().model,G=E.getImportSource(H.id);if(G.currentTransformations&&G.currentTransformations.xtab&&G.currentTransformations.xtab.isCrosstab){this.items=G.transformedMapping;}else{this.items=G.currentMapping;}if(G.xdaType===C.xdaType.querybuilder||G.xdaType===C.xdaType.googleBigQuery||G.xdaType===C.xdaType.dataImportCustomSQL||G.sourceInfo.hasAggFilter){this.set("enabled",false);}},postBuildRendering:function B(){if(this._super){this._super();}var E=this.itemsContainerNode.childNodes;if(!E){return ;}if(!this._ontooltipover){var F=this.id;this._ontooltipover=function(G){var I=mstrmojo.all[F];D.stopPropogation(self,G);var H=D.findAncestorByAttr(G.target,"idx",true,I.itemsContainerNode);if(!!H&&!!H.node&&H.node.clientWidth<H.node.scrollWidth){I.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:H.node,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:H.node.innerText});I.showTooltip(G,self);}};this._ontooltipout=function(G){var H=mstrmojo.all[F];H.hideTooltip(G,self);};}D.attachEvent(this.itemsContainerNode,"mouseover",this._ontooltipover);D.attachEvent(this.itemsContainerNode,"mouseout",this._ontooltipout);},onRender:function(){var F=this.items,H=[],G,E;for(G=0,E=F.length;G<E;G++){if(F[G].selected){H.push(F[G]);}}if(H.length){this.setSelectedItems(H,true);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Pulldown");mstrmojo.requiresDescs(13574,134,1052,1053,12343,12362,12363,12364,3627,12365,13995,14551);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var K,E=[],J,N,I,L,F,G,P;N=this.parent;I=N.columns;L=I.selectedIndex;if(L===undefined){return ;}F=(I.items[L]).name;G=N.transformationList;P=G.subType%10;switch(P){case 0:if(!this.optionsBox.fixed.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var Q="["+this.optionsBox.fixed.value+"]";var H=[];try{var O=JSON.parse(Q);for(K=0;K<O.length;K++){if(typeof O[K]==="number"){H.push(O[K]);}}if(H.length===0){mstrmojo.alert(mstrmojo.desc(13995,"The given field lengths are not properly formatted."));return ;}}catch(M){mstrmojo.alert(mstrmojo.desc(13995,"The given field lengths are not properly formatted."));return ;}J=JSON.parse(JSON.stringify(this.operations.byFieldLengths));J.description=J.description.replace("[column name]",F);J.columnName=F;J.fieldLengths=H;break;case 1:case 2:case 3:if(!this.optionsBox.separatorBox.separator.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(P===1){J=JSON.parse(JSON.stringify(this.operations.bySeparator));}else{if(P===2){J=JSON.parse(JSON.stringify(this.operations.beforeFirst));}else{J=JSON.parse(JSON.stringify(this.operations.afterLast));}}J.description=J.description.replace("[column name]",F);J.columnName=F;J.separator=this.optionsBox.separatorBox.separator.value;if(this.optionsBox.separatorBox.separatorList.selectedIndex===7){J.regex=true;J.description=J.description.replace("####","/"+this.optionsBox.separatorBox.separator.value+"/");}else{J.description=J.description.replace("####","'"+B(D(this.optionsBox.separatorBox.separator.value))+"'");}break;case 4:J=JSON.parse(JSON.stringify(this.operations.cellIntoRow));J.description=J.description.replace("[column name]",F);J.columnName=F;J.keyColumnName=this.controller.model.columns.keyColumnName;J.separator=this.optionsBox.separatorBox2.separator.value;break;}J.engineConfig=JSON.parse(this.controller.model.engine);E.push(J);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.fixed.set("value","");this.optionsBox.separatorBox.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox.separator.set("value",",");this.optionsBox.separatorBox2.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox2.separator.set("value",",");}mstrmojo.Refine.RefineControlSplit=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlSplit",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Split);}},operations:null,children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.TextBox",alias:"fixed",cssClass:"refine-split-fromto",emptyText:mstrmojo.desc(14551,"List of integers separated by commas, e.g., 5, 7, 15"),tooltip:mstrmojo.desc(14551,"List of integers separated by commas, e.g., 5, 7, 15"),valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9,]/g,"");this.set("value",F);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===0);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"Comma")},{n:mstrmojo.desc(1053,"Tab")},{n:mstrmojo.desc(12343,"Whitespace")},{n:mstrmojo.desc(12362,"Newline")},{n:mstrmojo.desc(12363,"Pipe")},{n:mstrmojo.desc(12364,"Period")},{n:mstrmojo.desc(3627,"Other")},{n:mstrmojo.desc(12365,"regex")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6||this.selectedIndex===7){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0&&this.parent.parent.parentBox.transformationList.subType%10!==4);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox2",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"Comma")},{n:mstrmojo.desc(1053,"Tab")},{n:mstrmojo.desc(12343,"Whitespace")},{n:mstrmojo.desc(12362,"Newline")},{n:mstrmojo.desc(12363,"Pipe")},{n:mstrmojo.desc(12364,"Period")},{n:mstrmojo.desc(3627,"Other")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button","mstrmojo.RadioList","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(221,373,1059,12906,13166,13167);var B=mstrmojo.DI.DIConstants;mstrmojo.DI.ui.dialogs.DIQBImportOptionDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIQBImportOptionDialog",cssClass:"mstrmojo-di-import-option",title:mstrmojo.desc(13327,"Select Import Options"),showTitle:true,sourceInfo:null,help:"Select_Import_Options_dialog_box.htm",pageType:null,subtype:null,isContainHadoop:true,items:null,onOK:null,onClose:function(){this.onOK=null;},children:[{scriptClass:"mstrmojo.ui.CheckList",cssClass:"mstrmojo-di-io-radio-list",icnCss:"import-options",alias:"radioList",multiSelect:false,orientation:"v",bindings:{items:"this.parent.items"},getItemMarkup:function(D,C){return mstrmojo.ui.CheckList.prototype.getItemMarkup.call(this,D,C).replace("{@en@n}",'{@en@n}<div class="subtitle">{@en@sub}</div>');},getItemProps:function(E,C){var D=mstrmojo.ui.CheckList.prototype.getItemProps.call(this,E,C);D.sub=E.sub;return D;},onchange:function(){var D=this.parent,C=(D.srcInfo&&D.srcInfo.type),F,E;if(!this.selectedItem){return ;}switch(this.selectedItem.did){case"0":D.pageType=B.pageType.hadoop;D.subtype=B.sourceSubtype.hadoop;D.sourceInfo=1;break;case"1":D.sourceInfo={sourceType:B.sourceType.querybuilder,type:B.xdaType.qbSingleTable};D.pageType=B.pageType.database;F=B.xdaType.googleBigQuerySingleTable;break;case"2":D.sourceInfo={sourceType:B.sourceType.querybuilder,type:B.xdaType.querybuilder};D.pageType=B.pageType.database;F=B.xdaType.googleBigQuery;break;case"3":D.sourceInfo={sourceType:B.sourceType.querybuilder,type:B.xdaType.ffsql};D.pageType=B.pageType.database;F=B.xdaType.googleBigQueryFFSQL;break;}if(C===B.sourceType.googleBigQuery){D.pageType=B.pageType.sourceIntro;D.sourceInfo=this.parent.srcInfo;mstrApp.bigQueryXdatype=F;}E=D.btnHbox.nextBtn;if(!E.enabled){E.set("enabled",true);}}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1059,"Next"),alias:"nextBtn",enabled:false,onclick:function(){var D=this.parent.parent;var C=mstrApp.getRootController();if(D.onOK){D.onOK({pageType:D.pageType,sourceInfo:D.sourceInfo,enabled:true});}else{C.showPage(D.pageType,D.sourceInfo);}D.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelBtn",onclick:function(){var C=this.parent.parent;C.close();}}],onvisibleChange:function A(){if(this.visible){this.btnHbox.nextBtn.set("enabled",false);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(134);var A=mstrmojo.Refine.RefineConstants;function B(){var J,H,G,D,F,C;J=this.parent;H=J.columns;G=H.selectedIndex;if(G===undefined){return ;}D=(H.items[G]).name;F=J.transformationList;C=F.subType%10;var I;var E={};E.name=D;E.columnName=D;if(C===0){I="list";E.expression="value";}else{if(C===1){I="range";E.expression="value";E.mode="range";}else{if(C===2){I="timerange";E.expression="value";E.mode="range";}else{if(C===3){I="text";E.caseSensitive=false;E.mode="text";}}}}this.controller.addFacets(I,E);}mstrmojo.Refine.RefineControlFacet=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlFacet",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType!==-1){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Facet);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Facet)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",visible:false,children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){B.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.WidgetList","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.ui.CheckList","mstrmojo.RadioList","mstrmojo.StackContainer","mstrmojo.Editor");mstrmojo.requiresDescs(373,547,12724,12909);var D=mstrmojo.array,C=mstrmojo.hash,A=mstrmojo.DI.DIHelpers;mstrmojo.DI.ui.dialogs.DISheetsSelectionDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DISheetsSelectionDialog",cssClass:"mstrmojo-di-sheets-selection-dialog",title:mstrmojo.desc(12724,"Select Worksheets"),items:null,onBack:mstrmojo.func.emptyFn,onOK:function(){this.close();},noButtonCls:true,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ssd-file-content",alias:"filesAndSheets",children:[{scriptClass:"mstrmojo.VBox",alias:"leftPanel",cssClass:"mstrmojo-di-ssd-left-panel",children:[{scriptClass:"mstrmojo.WidgetList",alias:"fileList",cssClass:"mstrmojo-di-ssd-file-list",selectedIndex:0,itemFunction:function(H,E,I){var G=A.truncate(H.n,30);var F=new mstrmojo.Button({text:G,title:H.n,sheets:H.sheets,widget:I,onclick:function(){I.updateSheetsList(H,false);}});return F;},bindings:{items:"this.parent.parent.parent.items"},onitemsChange:function(){if(this.items&&this.items.length>0){this.set("selectedIndex",0);this.updateSheetsList(this.items[0],true);}},updateSheetsList:function(K,M){var H=this.parent.parent.parent;var G=this.parent.parent.rightPanel;var I=G.sheets;var L,F;if(!K.sheets||K.sheets.length<=0){I.set("selected",null);G.fileName.set("text",mstrmojo.desc(12909,"There are no sheets in this file."));return ;}if(I.children){for(F=0;F<I.children.length;F++){if(I.children[F].id===K.id){L=I.children[F];}}}if(!L){L=I.addChildren([mstrmojo.insert({scriptClass:"mstrmojo.ui.CheckList",cssClass:"mstrmojo-di-ssd-sheets-list",alias:"list",items:K.sheets,list:K.sheets,id:K.id,multiSelect:K.multiSelection,sheetsSelectionDialog:H,selectedIndex:K.defaultSheetsIndex||0,getItemMarkup:function J(){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@n}"><span>{@en@n}</span></{@tag}>';},postBuildRendering:function(){if(this._super){this._super();}this.onchange();},onchange:function(){var O=this.items,P=this.selectedIndices;D.forEach(O,function(Q){Q.selected=false;});C.forEach(P,function(R,Q){if(Q){O[Q].selected=R;}});var N=false;mstrmojo.array.forEach(this.items,function(Q){N=N||Q.selected;});this.parent.parent.parent.parent.btnHbox.selectBtn.set("enabled",N);}})])[0];}else{if(M){L.set("list",K.sheets);L.set("items",K.sheets);L.set("selectedIndex",K.defaultSheetsIndex||0);}}var E=A.truncate(K.n,42);G.fileName.set("text",E);I.set("selected",L);}}]},{scriptClass:"mstrmojo.VBox",alias:"rightPanel",cssClass:"mstrmojo-di-ssd-right-panel",children:[{scriptClass:"mstrmojo.Label",alias:"fileName"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-ssd-search",cssText:"font-size:10pt;",alias:"searchBox",visible:false,onkeyup:function(){var H=this.value;var G=this.parent.sheets.list.list;var F,I,E=[];for(F=0;F<G.length;F++){I=G[F].n.toLowerCase().search(H.toLowerCase());if(I>-1){E.push(G[F]);}}this.parent.sheets.list.set("items",E);}},{scriptClass:"mstrmojo.StackContainer",cssClass:"mappingpage-bottom",alias:"sheets"}]}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(373,"Back"),alias:"backBtn",onclick:function(){var E=this.parent.parent;if(E.onBack){E.onBack();}E.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(547,"Select"),alias:"selectBtn",enabled:true,onclick:function(){var E=this.parent.parent;if(E.onOK){E.onOK();}else{E.close();}}}],postBuildRendering:function B(){if(this._super){this._super();}this.closeNode.style.display="none";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.RadioList","mstrmojo.DI.DIConstants","mstrmojo.DI.FileDragDropBox");mstrmojo.requiresDescs(14659,14660);var B=mstrmojo.DI.DIConstants;function C(F){var E=F.toLowerCase(),D;if(E===".xls"||E===".xlsx"){D=B.xdaType.excel;}else{if(E===".txt"||E===".csv"){D=B.xdaType.text;}else{D=0;}}return D;}mstrmojo.DI.DIDataset=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIDataset",cssClass:"mstrmojo-di-dataset",markupString:'<div id="{@id}" class="{@cssClass}" ><div></div><div></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},titleNode:function(){return this.domNode.children[0];},fileDnDNode:function(){return this.domNode.children[1];},buttonNode:function(){return this.domNode.children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"titleNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-dataset-title",text:"Specify the location of the file that you would like to upload"},{slot:"titleNode",scriptClass:"mstrmojo.RadioListHoriz",cssClass:"mstrmojo-FileDragDropBox-radioList",itemCssClass:"mstrmojo-FileDragDropBox-radioList-item",alias:"radioList",selectedIndex:0,onchange:function(){var D=mstrApp.getRootController();},items:[{did:"0",n:"From my Computer/Network"},{did:"1",n:"From URL"},{did:"2",n:"From Clipboard"}]},{slot:"fileDnDNode",scriptClass:"mstrmojo.DI.FileDragDropBox",cssClass:"drag-drop-box",alias:"dnDBox",multiple:"multiple",markupMethods:{onvalueChange:function(){var D=mstrApp.getRootController();if(this.value!==""){D.sourceSelected(true);}else{D.sourceSelected(false);}},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}}}],onNextButtonClick:function A(){var F=this.model,I;var L=this.dnDBox;var D=L.files;var O;var K=mstrApp.getRootController();var N=(this.model.operationMode===B.operationMode.create)?true:this.showPrv.checked;var J;var H;for(I=0;I<D.length;I++){var E=D[I];H="C:\\fakepath\\"+E.name;O=H.substring(H.lastIndexOf("."));if(C(O)===0){K.displayError(mstrmojo.desc(14659,"The following file extension ## is not supported.").replace("##",O),false);return ;}if(D!==undefined){if(D[I]!==undefined){J=D[I].size;}}else{var G=new ActiveXObject("Scripting.FileSystemObject");var M=G.getFile(D);J=M.Size;}if(J>(mstrApp.diParams.UploadSizeLimit*1024*1024)){O=H.substring(H.lastIndexOf(".")+1);K.displayError(mstrmojo.desc(14660,"The maximum file size for ## files is @@ MB.").replace("##",O).replace("@@",mstrApp.diParams.UploadSizeLimit),false);return ;}}K.importFileEMMA(L,H,N,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.RadioList","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Pulldown");mstrmojo.requiresDescs(134);var A=mstrmojo.Refine.RefineConstants;function B(){var H=[],E,J,I,G,D,F,C;J=this.parent;I=J.columns;G=I.selectedIndex;if(G===undefined){return ;}D=(I.items[G]).name;F=J.transformationList;C=F.subType%10;switch(C){case 0:E=JSON.parse(JSON.stringify(this.operations.trim));break;case 1:E=JSON.parse(JSON.stringify(this.operations.collapse));break;}E.columnName=D;E.description=E.description.replace("[column name]",D);E.engineConfig=JSON.parse(this.controller.model.engine);H.push(E);this.controller.applyOperations({operations:JSON.stringify(H),engine:JSON.stringify({facets:[],mode:"row-based"})});}mstrmojo.Refine.RefineControlWhitespace=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlWhitespace",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType!==-1){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Whitespace);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Whitespace)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",visible:false,onclick:function(){B.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(13574,134,1052,1053,12343,12362,12363,12364,12365,3627,14549,14550);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var L=1,K,J,E=[],I,O,H,M,F,G,R,T,S,N;O=this.parent;H=O.columns;M=H.selectedIndex;N=H.items[H.selectedIndex].columnIndex;if(M===undefined){return ;}F=(H.items[M]).name;G=O.transformationList;R=G.subType%10;while(true){S=F+" "+L;J=true;for(K=0;K<H.items.length;K++){if(S===(H.items[K]).name){J=false;break;}}L++;if(J){T=S;break;}}switch(R){case 0:I=JSON.parse(JSON.stringify(this.operations.fromTo));var Q=this.optionsBox.fromto.from.value;var P=this.optionsBox.fromto.to.value;if(!Q||!P){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[new column name]",T);I.description=I.description.replace("[column name]",F);I.description=I.description.replace("[from]",parseInt(Q)-1);I.description=I.description.replace("[to]",P);I.columnInsertIndex=N+1;I.newColumnName=I.newColumnName.replace("[column name]",T);I.baseColumnName=I.baseColumnName.replace("[column name]",F);I.expression=I.expression.replace("[from]",parseInt(Q)-1);I.expression=I.expression.replace("[to]",P);break;case 1:case 2:if(!this.optionsBox.separatorBox.separator.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(R===1){I=JSON.parse(JSON.stringify(this.operations.beforeFirst));}else{I=JSON.parse(JSON.stringify(this.operations.afterLast));}I.description=I.description.replace("[new column name]",T);I.description=I.description.replace("[column name]",F);I.columnInsertIndex=N+1;I.newColumnName=I.newColumnName.replace("[column name]",T);I.baseColumnName=I.baseColumnName.replace("[column name]",F);if(this.optionsBox.separatorBox.separatorList.selectedIndex===7){I.description=I.description.replace("####","/"+this.optionsBox.separatorBox.separator.value+"/");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"/"+this.optionsBox.separatorBox.separator.value+"/");}else{I.description=I.description.replace("####","'"+B(D(this.optionsBox.separatorBox.separator.value))+"'");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"'"+D(this.optionsBox.separatorBox.separator.value)+"'");}break;}I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.fromto.from.set("value","");this.optionsBox.fromto.to.set("value","");this.optionsBox.separatorBox.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox.separator.set("value",",");}mstrmojo.Refine.RefineControlExtract=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlExtract",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Extract);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"fromto",children:[{scriptClass:"mstrmojo.TextBox",cssClass:"refine-extract-fromto",alias:"from",tooltip:mstrmojo.desc(14549,"Start Index")+" (1, 2, ...)",emptyText:mstrmojo.desc(14549,"Start Index")+" (1, 2, ...)",valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9]/g,"");if(F!==""){if(parseInt(F)===0){F="";}}this.set("value",F);}},{scriptClass:"mstrmojo.TextBox",cssClass:"refine-extract-fromto",alias:"to",tooltip:mstrmojo.desc(14550,"End Index")+" (1, 2, ...)",emptyText:mstrmojo.desc(14550,"End Index")+" (1, 2, ...)",valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9]/g,"");if(F!==""){if(parseInt(F)===0){F="";}}this.set("value",F);}}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===0);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"comma")},{n:mstrmojo.desc(1053,"tab")},{n:mstrmojo.desc(12343,"whitespace")},{n:mstrmojo.desc(12362,"newline")},{n:mstrmojo.desc(12363,"pipe")},{n:mstrmojo.desc(12364,"period")},{n:mstrmojo.desc(3627,"other")},{n:mstrmojo.desc(12365,"regex")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6||this.selectedIndex===7){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.FileUploadBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.CheckBox","mstrmojo.Image","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.DI.FileDragDropBox","mstrmojo.css");mstrmojo.requiresDescs(1825,12509,12691,12692,12737,12738,12739,12740,14099,14194);var R=mstrmojo.DI.DIConstants,K=mstrmojo.desc,C,M=mstrmojo.DI.DIHelpers,H=M.isOperationMode;function F(){var S=this.model;var T;if(this.currentSource){T=this.currentSource;}else{T=S.currentSource;}return T;}function J(W){var V=0,T,S;if(mstrApp.isSingleTier){for(T=0;T<W.length;T++){var U=W[T];var X=U.lastIndexOf("\\");if(X===-1){X=U.lastIndexOf("/");}if(X!==-1){V++;}}}else{for(S in W){if(W[S].size){V++;}}}return V;}function B(){var X=true;var T,S;var W=F.call(this);if(!W||!W.sourceInfo){return X;}var V=this.getOperationMode();if((V===R.operationMode.refresh)||(V===R.operationMode.edit)){if(this.origFileExt===""){T=mstrApp.isEMMACube?W.sourceInfo.dbTableName:W.sourceInfo.name;this.origFileExt=M.getExtensionType(T.substring(T.lastIndexOf(".")));}var U="";if(this.dnDBox.files&&this.dnDBox.files.length>0){U=this.dnDBox.files[0].name;}S=M.getExtensionType(U.substring(U.lastIndexOf(".")));if(this.origFileExt!==S){X=false;}}return X;}function I(a){var d;var Z=this.dnDBox;var V=Z.files;var m;var h;var W;var f="<ul>";var X=mstrApp.getRootController();var T=this.getOperationMode();var b=this;var U=true;var S=true;var c,o,g,Y;var l=false;var k=[];for(d=0;d<V.length;d++){h=V[d];m="C:\\fakepath\\"+h.name;W=m.substring(m.lastIndexOf(".")+1);if(V!==undefined){if(V[d]!==undefined){c=V[d].size;}}else{o=new ActiveXObject("Scripting.FileSystemObject");g=o.getFile(V);c=g.Size;}if(c>(mstrApp.diParams.UploadSizeLimit*1024*1024)){l=true;k.push(h.name);var p=mstrmojo.desc(12738,"The maximum file size for #### files is @@@@ MB. ").replace("####",W).replace("@@@@",mstrApp.diParams.UploadSizeLimit);f+="<li>"+h.name+"<br>"+p||" </li>";h.toDel=true;}else{U=false;}if(W==="mstr"){X.displayError(mstrmojo.desc(14194,"Error: Only Excel Text, CSV can be uploaded. Please use the Upload MicroStrategy File to import .MSTR files."),false);return ;}}if(T!==R.operationMode.create&&V.length>0){Y=F.call(this);m=V[0].name;if(!Y.isExtensionValid(m)){X.displayError(mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube."),false);return ;}}if(l){f+="</ul>";if(U){X.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,f);}else{var n=function(){for(d=0;d<Z.files.length;d++){var e=Z.files[d];if(e.toDel){mstrmojo.array.removeItem(Z.files,e);}}X.importFileEMMA(Z,m,S,!X.model.hasEMMAReportInstance(),this.id,true,a);};var j={detailErrorMessage:f,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:function(){var q=[];for(d=0;d<Z.files.length;d++){var e=Z.files[d];if(!e.toDel){q.push(e);}}if(b.setFilesObject){b.setFilesObject(k);}Z.files=q;}};X.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),mstrmojo.desc(12537,"Data Import"),n,j);}return ;}X.importFileEMMA(Z,m,S,!X.model.hasEMMAReportInstance(),this.id,true,a);}function N(X){var V=this,S=this.dnDBox,T=mstrApp.getRootController(),W,U;W=function(){I.call(V,X);};U={detailErrorMessage:"",okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:function(){}};if(S.failedFilesCount>0){T.displayWarning(K(14099,"Some files could not be imported last time. Click 'Yes' to ignore them and proceed with the rest files. Otherwise, click 'No' to check the erroneous files or delete them."),K(12537,"Data Import"),W,U);}else{I.call(V,X);}}mstrmojo.DI.DIFileUpload=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIFileUpload",cssClass:"mstrmojo-di-fu",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload {@cssClass}" ><div></div><div></div><div class="mstrmojo-di-fileUpload-fileinput"></div><div></div><div></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},URLOrFileSwitchNode:function(){return this.domNode.children[0];},radioListNode:function(){return this.domNode.children[1];},fileInputNode:function(){return this.domNode.children[2];},infoNode:function(){return this.domNode.children[3];},showPreviewNode:function(){return this.domNode.children[4];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},origFileExt:"",init:function O(T){if(this._super){this._super(T);}var U={},S=U[this.id]={};S.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(U);},onNextButtonClick:function L(){N.call(this,this.tableID?R.actions.refreshData:R.actions.importSource);},onFinishButtonClick:function(){N.call(this,R.actions.savePublish);},onBackButtonClick:function A(){var S=mstrApp.getRootController();S.showPage(R.pageType.dataSelection);},onHelpButtonClick:function Q(){return"importing_data_from_a_file.htm";},updatePageConfig:function(S){var T=this;if(S&&S.properties){mstrmojo.hash.forEach(S.properties,function(V,U){T.set(U,V);});}this.dnDBox.updatePageConfig(S);},setFilesObject:function(S){this.dnDBox.setFilesObject(S);},onforceEnableChange:function(){mstrApp.getRootController().sourceSelected(this.forceEnable);},getOperationMode:function(){var S=this.model.operationMode;if(H(this.operationMode)){S=this.operationMode;}return S;},adjustSize:function G(S){var U=S.size,V,T;this.dnDBox.adjustSize(U);if(mstrApp.isSingleTier){V=parseInt(U.w,10);T=this.fileInputNode.children[1];T.style.marginRight=V/2-(T.clientWidth/2+1)+"px";}},children:[{slot:"fileInputNode",scriptClass:"mstrmojo.DI.FileDragDropBox",cssClass:"drag-drop-box",alias:"dnDBox",markupMethods:{onvalueChange:function(){var S=mstrApp.getRootController();if(this.files&&this.files.length>0){S.sourceSelected(true);}else{S.sourceSelected(false);}},onfilesChange:function(){var T=mstrApp.getRootController(),U=this.parent.getOperationMode();if((this.files.length!==0||this.parent.forceEnable===true)){if(U===R.operationMode.create){T.sourceSelected(true);}else{if(U===R.operationMode.refresh||U===R.operationMode.edit){var S=J(this.files);T.sourceSelected((S===1));}}}else{T.sourceSelected(false);}},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.dragLabelNode.style.display=this.fileUpload&&!mstrmojo.dom.isIE8&&!mstrmojo.dom.isIE9?"block":"none";}},addOneTierFile:function E(V){var X=0;if(!V){return ;}var T=mstrmojo.dom.getOSInfo().name.toLowerCase().indexOf("windows")>=0,Y;if(T){Y=V.split("*");}else{Y=V.split(":");}var W,U=[].concat(this.files);if(this.parent.tableID&&U.length>0){this.removeChildren();U=[];}for(X=0;X<Y.length;X++){W=Y[X];U.push(W);this.addFile(mstrmojo.DI.DIHelpers.getAbsoluteFileName(W),W);}this.set("files",U);if(this.parent.tableID){var S=J(this.files);mstrApp.getRootController().sourceSelected((S===1));}},bindings:{value:function(){var T=F.call(this.parent);if((H(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==R.operationMode.create){if(!this.initValue){this.initValue=true;if(T.subtype===R.sourceSubtype.localFile){var S=T.sourceInfo.name;S=S.substr("C:/fakepath/".length);return mstrmojo.desc(12739,"Previously uploaded file:####").replace("####",S);}}}return"";}},preBuildRendering:function D(){if(this._super){this._super();}var T=mstrApp.getRootController().model;var U=F.call(this.parent);var S=U&&U.sourceInfo.partition;if(mstrApp.isSingleTier){this.markupString='<div><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="taskProc"><div class="mstrmojo-di-fileHolder {@cssClass}" mstrAttach:dragover,dragend,drop,click><div class="mstrmojo-FileDragDropBox-text {@textcssClass}">{@text}</div><div class="mstrmojo-FileDragDropBox-content"></div><div class="mstrmojo-FileDragDropBox-count"></div></div><div></div><div><div><div></div></div></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>';}if(T.operationMode!==R.operationMode.create&&(!S||!S.isPartition)&&!T.isAddingNewTable){this.descriptor=mstrmojo.desc(13867,"Drag a file to replace this file");this.browseLabel=mstrmojo.desc(13864,"Choose a file");}else{this.multiple="multiple";}this.text=mstrmojo.desc(12691,"Data can be in crosstab or tabular format");C=this.id;}},{slot:"fileInputNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot mstrmojo-onetier-browse",text:mstrmojo.desc(13865,"Choose files"),onclick:function(){mstrApp.getRootController().launchOneTierBrowser("mstrmojo.DI.DIFileUpload.OneTierFiles");},bindings:{visible:function(){return mstrApp.isSingleTier;}}},{slot:"fileInputNode",scriptClass:"mstrmojo.Label",text:"",cssClass:"di-fu-refresh-text",postBuildRendering:function P(){var S=F.call(this.parent);if((H(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==R.operationMode.create){var T=S.sourceInfo.dbTableName;this.set("text",mstrmojo.desc(13868,"Upload original file or a new file to refresh this table.")+"("+mstrmojo.desc(12739,"Previously uploaded file:####").replace("####",T)+")");}}}]});mstrmojo.DI.DIFileUpload.OneTierFiles=function(T){var S=mstrmojo.all[C];S.addOneTierFile(T);};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.dom","mstrmojo.DI.DIGeoRole","mstrmojo.DI.DITimeDimension","mstrmojo.ui.menus.EditorConfig","mstrmojo.DI.DIPartition","mstrmojo.DI.DIShowAllColumns","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(967,1388,2052,2170,2265,3434,3544,4530,4699,8002,8118,8984,9920,9134,9614,9919,9921,9922,11611,11805,11909,12697,12698,12699,12700,12701,12703,12706,12707,12708,12709,12710,13023,13024,13036,13037,13038,13039,13131,13132,13280,13303,13366,12388,13526,14198,14199,14200);var S=mstrmojo.DI.DIConstants;var R=S.menuItems,O=S.dataTypeMenuItems;var Q=mstrmojo.array,G=mstrmojo.DI.DIHelpers;var F=8,M=9,C=1;function L(V,U){var T;if(U&&U.length>0){return true;}T=mstrApp.getRootController().partitionController.getAllPartitionTables(V,U);return T.length>0;}mstrmojo.DI.DIMappingMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIMappingMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(12697,"Create Multiform Attribute"),did:R.CREATE_MULTIFORM_ATTRIBUTE},{n:mstrmojo.desc(12698,"Edit Multiform Attribute"),did:R.EDIT_MULTIFORM_ATTRIBUTE},{n:mstrmojo.desc(12699,"Add To Multiform Attribute"),did:R.ADDTO_MULTIFORM_ATTRIBUTE},{did:R.SEPARATOR},{n:mstrmojo.desc(13303,"Unmap"),did:R.UNLINK_ALL},{did:R.SEPARATOR},{n:mstrmojo.desc(11909,"Change Data Type"),did:R.CHANGE_DATA_TYPE,items:[{did:O.NUMBER,ctp:S.columnDataTypes.integer,n:mstrmojo.desc(9614,"Integer")},{did:O.NUMBER,ctp:S.columnDataTypes.nlong,n:mstrmojo.desc(13131,"Long")},{did:O.NUMBER,ctp:S.columnDataTypes.int64,n:mstrmojo.desc(13132,"Big Integer")},{did:O.NUMBER,ctp:S.columnDataTypes.dtfloat,n:mstrmojo.desc(8002,"Float")},{did:O.NUMBER,ctp:S.columnDataTypes.dtdouble,n:mstrmojo.desc(2265,"Double")},{did:O.BIG_DECIMAL,ctp:S.columnDataTypes.bigDecimal,n:mstrmojo.desc(9920,"Big Decimal")},{did:R.SEPARATOR},{did:O.DATE,n:mstrmojo.desc(2052,"Date")},{did:O.DATE_TIME,n:mstrmojo.desc(9919,"DateTime")},{did:O.TIME,n:mstrmojo.desc(2170,"Time")},{did:R.SEPARATOR},{did:O.TEXT,n:mstrmojo.desc(3544,"Text")},{did:O.HTML_TAG,n:mstrmojo.desc(9921,"HTML Tag")},{did:O.PHONE_NUMBER,n:mstrmojo.desc(8984,"Phone Number")},{did:O.SYMBOL,n:mstrmojo.desc(4530,"Symbol")},{did:O.URL,n:mstrmojo.desc(9922,"URL")},{did:O.EMAIL,n:mstrmojo.desc(4699,"Email")}]},{did:R.SEPARATOR},{n:mstrmojo.desc(13526,"Define Geography"),did:R.MARK_GEO_ROLES,items:[],buildSubMenuConfig:function K(){return this.buildGeoRoleMenuEditor();}},{n:mstrmojo.desc(12701,"Create Time Attributes"),did:R.CREATE_TIME_ATTRIBUTES,items:[],buildSubMenuConfig:function K(){return this.buildTimeRoleMenuEditor();}},{n:mstrmojo.desc(11611,"Convert to Attribute"),did:R.TO_ATTRIBUTE},{n:mstrmojo.desc(11805,"Convert to Metric"),did:R.TO_METRIC},{n:mstrmojo.desc(13036,"Do Not Import"),did:R.DO_NOT_IMPORT},{n:mstrmojo.desc(8118,"Import"),did:R.IMPORT},{n:mstrmojo.desc(1388,"Rename"),did:R.ITEM_RENAME},{did:R.SEPARATOR},{n:mstrmojo.desc(13037,"Map to Project Attribute"),did:R.MAP_TO_PROJECT_ATTRIBUTE},{n:mstrmojo.desc(13038,"Unmap from Project Attribute"),did:R.UNMAP},{n:mstrmojo.desc(12703,"Link ?"),did:S.menuItems.LINK},{n:mstrmojo.desc(13849,"Edit Table"),did:R.REFRESH_DATA},{n:mstrmojo.desc(1388,"Rename"),did:R.TABLE_RENAME},{n:mstrmojo.desc(13039,"Delete"),did:R.DELETE},{did:R.SEPARATOR},{n:mstrmojo.desc(13026,"Parse..."),did:R.PARSE},{n:mstrmojo.desc(13023,"Wrangle..."),did:R.REFINE},{n:mstrmojo.desc(13024,"Delete Wrangle Operations"),did:R.CANCEL_REFINE},{did:R.SEPARATOR},{n:mstrmojo.desc(12706,"Define Relationships"),did:R.DEFINE_RELATIONSHIPS},{n:mstrmojo.desc(12707,"Show All Attribute Forms"),did:R.SHOW_ALL_ATTRIBUTE_FORMS},{n:mstrmojo.desc(12708,"Hide All Attribute Forms"),did:R.HIDE_ALL_ATTRIBUTE_FORMS},{n:mstrmojo.desc(12709,"Show All Columns"),did:R.SHOW_ALL_COLUMNS,items:[],buildSubMenuConfig:function K(){return this.buildAllColumnsMenuEditor();}},{did:R.SEPARATOR},{n:mstrmojo.desc(12710,"Group Partition"),did:R.PARTITION,items:[],buildSubMenuConfig:function K(){return this.buildPartitionMenuEditor();}}],queryEnabled:function J(g){var e=true;var b=this.data[0];var T,U,W=this.data[0],d=mstrApp.getRootController().getModel(),c,Z;if(this.type!==S.contextMenuType.TABLE_MENU){U=d.findMappingSource(W);if(U.length===0){return false;}T=U[0];}else{if(this.type===S.contextMenuType.TABLE_MENU){T=d.importSources[this.data[0].id];}}if(b.isMultiForm&&!b.isAttributeForm){b=b.subColumns[0];}switch(g.did){case R.ITEM_RENAME:case R.CHANGE_DATA_TYPE:e=(b.ipa!==1);break;case R.MARK_GEO_ROLES:e=(b.ipa!==1)&&(T.type!==S.sourceType.hadoop)&&!d.isDirectDataAccess;var a=mstrApp.getRootController();var X=a.model;var f=X.findMappingItem(b);var Y,V;for(c=0;c<f.length;c++){Y=f[c];V=Y.subColumns;if(Y.isMultiForm){for(Z=0;Z<V.length;Z++){if(V[Z].fmn==="Latitude"||V[Z].fmn==="Longitude"){e=false;break;}}}}break;case R.DO_NOT_IMPORT:if(b.tp===12){mstrmojo.array.forEach(U,function(h){if(h.xdaType===S.xdaType.querybuilder||h.xdaType===S.xdaType.googleBigQuery||h.xdaType===S.xdaType.dataImportCustomSQL||h.sourceInfo.hasAggFilter){e=false;g.title=mstrmojo.desc(14198,"Unmap to enable this option");return false;}});}break;case R.CREATE_TIME_ATTRIBUTES:e=(b.ipa!==1)&&(T.type!==S.sourceType.hadoop)&&((b.dtp===F)||(b.dtp===M)||(b.dtp===C))&&!d.isDirectDataAccess;break;case R.PARSE:e=T&&(T.sourceInfo.isRefined===0&&T.sourceInfo.hasAggFilter===0)&&T.canAutoMappingAndDetectRelation();g.title=mstrmojo.desc(13902,"Edit table to enable this option.");break;case R.REFINE:e=true;break;case R.CANCEL_REFINE:e=T&&(T.canAutoMappingAndDetectRelation());break;case R.SHOW_ALL_COLUMNS:e=true;if(d.operationMode===S.operationMode.edit&&T&&!T.hasRefreshedData){e=false;g.title=mstrmojo.desc(13902,"Edit table to enable this option.");}if(T.xdaType===S.xdaType.querybuilder||T.xdaType===S.xdaType.dataImportCustomSQL||T.xdaType===S.xdaType.googleBigQuery||T.xdaType===S.xdaType.googleBigQueryFFSQL){e=false;g.title=mstrmojo.desc(14199,"This option is not applicable to Build Query and Type Query sources. Please use the 'edit table' operation to change the imported columns.");}break;case R.PARTITION:e=L(b.id,b.partition);g.title=e?"":mstrmojo.desc(12388,"No tables found with the same set of attributes and metrics.");break;case R.REFRESH_DATA:e=d.isRefreshDataSupported(T.xdaType,T.sourceInfo&&T.sourceInfo.hnc);g.title=e?"":(T.sourceInfo.hnc?mstrmojo.desc(14392,"We do not have the credentials needed to get the data for this table. Please provide the credentials to proceed publishing this table."):mstrmojo.desc(13977,"HTTPS is required to edit this table"));if(T.type===S.sourceType.file&&T.subtype===S.sourceSubtype.url){e=mstrApp.diParams.EnableURLImport;}break;case R.UNLINK:e=b.ipa!==1;break;default:e=true;break;}return e;},queryVisible:function B(l){var V=true;var m=(this.data.length>1);var f=false;var Z=this.data[0],W=Z.tp,U=(Z.type==="cmps"),j=!l.showLink,b=Z.isLinked,g,k=Z.isAttributeForm,Y=(Z.type==="mtmps"),X=mstrApp.getRootController().getModel(),a;if(!m){f=Z.isMultiForm;}if(this.type!==S.contextMenuType.TABLE_MENU){var T=X.findMappingSource(Z);if(T.length===0){return false;}g=T[0];}else{if(this.type===S.contextMenuType.TABLE_MENU){g=X.importSources[this.data[0].id];}}a=g&&(g.subtype===S.sourceSubtype.hanaSingleTable);switch(l.did){case R.SEPARATOR:V=true;break;case R.ITEM_RENAME:V=(this.type!==S.contextMenuType.TABLE_MENU)&&!m&&Z.selected&&!k;break;case R.TO_ATTRIBUTE:V=(this.type!==S.contextMenuType.TABLE_MENU)&&(W!==12||!Z.selected)&&!k&&!a;V=V&&!U;break;case R.TO_METRIC:V=(this.type!==S.contextMenuType.TABLE_MENU)&&(W!==4||!Z.selected)&&!k&&!a;V=V&&!U;break;case R.CREATE_MULTIFORM_ATTRIBUTE:V=(W===12)&&mstrApp.getRootController().formsController.isVisible(S.formsOptions.CREATE_MULTIFORM_ATTRIBUTE,this.data);break;case R.EDIT_MULTIFORM_ATTRIBUTE:V=(W===12)&&mstrApp.getRootController().formsController.isVisible(S.formsOptions.EDIT_MULTIFORM_ATTRIBUTE,this.data);break;case R.ADDTO_MULTIFORM_ATTRIBUTE:V=(W===12)&&mstrApp.getRootController().formsController.isVisible(S.formsOptions.ADDTO_MULTIFORM_ATTRIBUTE,this.data);break;case R.MAP_TO_PROJECT_ATTRIBUTE:if(!m){V=(this.type!==S.contextMenuType.TABLE_MENU)&&(W===12)&&!m&&!mstrApp.isSingleTier&&!k&&(Z.ipa!==1);V=V&&!U&&!(Z.isMultiForm||X.isLinkedMFA(Z));}else{V=!mstrApp.isSingleTier;if(V){Q.forEach(this.data,function(n){if(n.tp!==12||n.isAttributeForm||n.isMultiForm||X.isLinkedMFA(n)||n.ipa===1){V=false;return false;}});}}break;case R.MARK_GEO_ROLES:V=(this.type!==S.contextMenuType.TABLE_MENU)&&(W===12)&&!m&&!k;if(f){var d=Z.subColumns;var h=true;mstrmojo.array.forEach(d,function(o){var n=o.dtp;if(n!==1&&n!==8&&n!==9){h=false;}});if(h){V=false;}}else{var c=Z.dtp;if(c===1||c===8||c===9){V=false;}}V=V&&!a;V=V&&!U;break;case R.CREATE_TIME_ATTRIBUTES:V=false;break;case R.CHANGE_DATA_TYPE:case O.NUMBER:V=(k||((this.type!==S.contextMenuType.TABLE_MENU)&&!m&&!f&&Z.selected))&&!a;if(l.ctp===S.columnDataTypes.int64){V=V&&!Y;}break;case O.DATE_TIME:case O.TEXT:case O.DATE:case O.TIME:V=(k||((this.type!==S.contextMenuType.TABLE_MENU)&&!m&&!f&&Z.selected))&&!a;break;case O.BIG_DECIMAL:V=(k||((this.type!==S.contextMenuType.TABLE_MENU)&&!m&&!f&&Z.selected))&&!a;break;case O.HTML_TAG:case O.PHONE_NUMBER:case O.SYMBOL:case O.URL:case O.EMAIL:V=k||((this.type!==S.contextMenuType.TABLE_MENU)&&!m&&!f&&Z.selected);V=V&&!Y;break;case R.UNMAP:V=(this.type!==S.contextMenuType.TABLE_MENU)&&(W===12)&&!m&&!mstrApp.isSingleTier&&!k&&(Z.ipa===1);V=V&&!U;break;case R.UNLINK:V=j&&b&&!m&&(W===12)&&(this.type===S.contextMenuType.ITEM_MENU)&&!k;break;case R.UNLINK_ALL:V=false;Q.forEach(this.data,function(n){if(n.isLinked&&n.tp===12){V=true;return false;}});break;case R.IMPORT:V=U;break;case R.DO_NOT_IMPORT:if(k){return false;}g=X.importSources[this.data[0].tableId];if((this.type!==S.contextMenuType.TABLE_MENU)&&g&&Z.selected){if((g.xdaType===S.xdaType.querybuilder||g.xdaType===S.xdaType.dataImportCustomSQL||g.xdaType===S.xdaType.googleBigQuery||g.xdaType===S.xdaType.googleBigQueryFFSQL||g.sourceInfo.hasAggFilter)){V=false;}}else{V=false;}V=V&&!a;break;case R.CANCEL_REFINE:V=(g.sourceInfo.isRefined&&this.type===S.contextMenuType.TABLE_MENU)&&!k;break;case R.REFINE:var e=g.canRefine();V=(e&&this.type===S.contextMenuType.TABLE_MENU)&&!k;break;case R.PARSE:V=(this.type===S.contextMenuType.TABLE_MENU)&&(g.type===S.sourceType.file||g.type===S.sourceType.googleDrive||g.type===S.sourceType.dropbox||g.type===S.sourceType.hadoop);if(g.sourceInfo&&g.sourceInfo.des===S.sourceInfoDesc.json){V=false;}break;case R.TABLE_RENAME:case R.DELETE:case R.DEFINE_RELATIONSHIPS:case R.SHOW_ALL_COLUMNS:V=(this.type===S.contextMenuType.TABLE_MENU);break;case R.PARTITION:V=(this.type===S.contextMenuType.TABLE_MENU&&!X.isDirectDataAccess)&&!k;break;case R.SHOW_ALL_ATTRIBUTE_FORMS:V=(this.type===S.contextMenuType.TABLE_MENU)&&!this.target.isExpanded&&!k;break;case R.HIDE_ALL_ATTRIBUTE_FORMS:V=(this.type===S.contextMenuType.TABLE_MENU)&&this.target.isExpanded&&!k;break;case R.REFRESH_DATA:V=(this.type===S.contextMenuType.TABLE_MENU)&&!k&&X.hasRefreshDataPrivilegesForAllTables([g]);break;default:V=false;break;}return V;},queryChecked:function P(V){var U=false;var T=(this.data.length>1);if(this.data[0].dtp&&!T){if(V.ctp===undefined){U=V.did===this.data[0].dtp.toString();}else{U=(V.did===this.data[0].dtp.toString())&&V.ctp===this.data[0].ctp;}}return U;},executeCommand:function(W){var Z=this;var V=this.data[0].id;var T=mstrApp.getRootController();var X=T.model.importSources[V];switch(W.did){case R.ITEM_RENAME:mstrApp.getRootController().openRenameTextBox(S.contextMenuType.ITEM_MENU,this.menuNode||Z.target.textNode,Z);break;case R.IMPORT:mstrApp.getRootController().importItem(Z.data[0]);break;case R.DO_NOT_IMPORT:mstrApp.getRootController().toUnused(Z);break;case R.TO_ATTRIBUTE:mstrApp.getRootController().toAttribute(Z.data);break;case R.TO_METRIC:mstrApp.getRootController().toMetric(Z.data);break;case R.UNLINK:mstrApp.getRootController().openUnLinkDialog(Z);break;case R.UNLINK_ALL:mstrApp.getRootController().unlinkAll(Z);break;case R.MAP_TO_PROJECT_ATTRIBUTE:mstrApp.getRootController().toProjectAttribute(Z);break;case R.UNMAP:mstrApp.getRootController().unmap(Z);break;case R.PARSE:T.showDialog(S.dialogType.parseDataDialog,{model:T.model,height:"726px",w:"1328px",id:"parseDataDialog"+X.tableID,tableID:X.tableID});break;case R.CANCEL_REFINE:mstrApp.getRootController().cancelRefineStage(V);break;case R.REFINE:if(X.canLaunchWrangler()){T.launchWranglerDialog(X);}else{if(mstrmojo.DI.DIHelpers.isRefreshable(T.model)){T.model.isAddingNewTable=false;T.model.refreshToWrangle=X.tableID;T.refreshSourceTable(X.tableID);}else{T.displayError(mstrmojo.desc(14200,"Administrator has disabled importing a file from a URL. Hence we cannot proceed to wrangle the table."));}}break;case R.TABLE_RENAME:mstrApp.getRootController().openRenameTextBox(S.contextMenuType.TABLE_MENU,Z.target.titleNode,Z);break;case R.DELETE:mstrApp.getRootController().removeSourceTable(V);break;case R.REFRESH_DATA:if(G.isRefreshable(T.model)){T.model.isAddingNewTable=false;T.model.refreshToWrangle=null;T.refreshSourceTable(V);}else{T.displayError(mstrmojo.desc(13280,"Administrator has disabled importing a file from a URL."));}break;case R.DEFINE_RELATIONSHIPS:mstrApp.getRootController().openRelationsDefineEditor(V);break;case R.SHOW_ALL_ATTRIBUTE_FORMS:case R.HIDE_ALL_ATTRIBUTE_FORMS:this.target.expandAttrForms();break;case R.CREATE_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(S.formsOptions.CREATE_MULTIFORM_ATTRIBUTE,this.data[0].tableId,this.data[this.data.length-1],this.data);break;case R.EDIT_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(S.formsOptions.EDIT_MULTIFORM_ATTRIBUTE,this.data[0].tableId,this.data[this.data.length-1],this.data);break;case R.ADDTO_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(S.formsOptions.ADDTO_MULTIFORM_ATTRIBUTE,this.data[0].tableId,null,this.data);break;case O.NUMBER:case O.DATE_TIME:case O.TEXT:case O.URL:case O.EMAIL:case O.HTML_TAG:case O.DATE:case O.TIME:case O.SYMBOL:case O.BIG_DECIMAL:case O.PHONE_NUMBER:var U=parseInt(W.did,10);var Y=parseInt(W.ctp,10);if(typeof Y!=="number"){Y=null;}mstrApp.getRootController().changeDataType(Z,U,Y);break;default:return false;}return true;},buildDataTypeMenuEditor:function E(){var T=new mstrmojo.ui.menus.EditorConfig({cssClass:"geoRoleMenu",contents:new mstrmojo.DI.DIDataType({data:this.data[0]}),data:{}});T.fnOk=function(U){T.contents.onOK(U);};return T;},buildGeoRoleMenuEditor:function H(){var Y=this.data[0];var a=mstrApp.getRootController().model;var U=a.findMappingItem(Y);if(U.length>1){var Z,X,W,e,c,V,T,b;for(Z=0;Z<U.length;Z++){e=U[Z];if(!e.isMultiForm){continue;}b=e.subColumns;if(!T){T=b.slice(0);}else{for(X=0;X<b.length;X++){V=b[Z];c=false;for(W=0;W<T.length;W++){if(V.fmn===T[W].fmn){c=true;}}if(!c){T.push(V);}}}}if(T){this.data[0].mergeSubColumns=T;this.data[0].isSharedMultiForm=true;}}else{this.data[0].mergeSubColumns=this.data[0].subColumns;this.data[0].isSharedMultiForm=this.data[0].isMultiForm;}var d=new mstrmojo.ui.menus.EditorConfig({cssClass:"geoRoleMenu",contents:new mstrmojo.DI.DIGeoRole({georole:Y.georole,der:Y.der,shapeKeys:a.shapeKeys,data:this.data[0]}),data:{}});d.fnOk=function(f){d.contents.onOK(f);};return d;},buildTimeRoleMenuEditor:function I(){var U=this.data[0];var T=new mstrmojo.ui.menus.EditorConfig({cssClass:"timeRoleMenu",contents:new mstrmojo.DI.DITimeDimension({der:U.der,data:this.data[0]}),data:{}});T.fnOk=function(V){T.contents.onOK(V);};return T;},buildPartitionMenuEditor:function N(){var U=this.data[0],T;T=new mstrmojo.ui.menus.EditorConfig({cssClass:"partitionMenu",contents:new mstrmojo.DI.DIPartition({data:U}),data:{},cancelVisible:false});T.fnOk=function(V){T.contents.onOK(V);};return T;},buildAllColumnsMenuEditor:function A(){var U=this.data[0];var T=new mstrmojo.ui.menus.EditorConfig({cssClass:"timeRoleMenu",contents:new mstrmojo.DI.DIShowAllColumns({der:U.der,data:this.data[0]}),data:{}});T.fnOk=function(V){T.contents.onOK(V);};return T;},getMenuConfig:function D(U){var Y=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu",useTooltip:true}),Z=this.id,T,X=false,W=null,V=U||this.cm;Q.forEach(V,function(b){T=(b.did===S.menuItems.SEPARATOR);if(this.queryVisible(b)){if(T){if(null!==W){X=true;}}else{if(null===W){W=b;}else{if(X){Y.addSeparator();X=false;}}var a=[b.icn||""],c=function c(){this.executeCommand(b);};if(this.queryEnabled(b)===false){Y.addDisabledMenuItem(b.n,a.join(" "));if(b.title){Y.menus[Y.menus.length-1].title=b.title;}}else{if(b.items){Y.addSubMenuItem(b.n,"",Z,b.buildSubMenuConfig||this.getMenuConfig,b.items);}else{if(b.hasEdt){Y.addEditorMenuItem(b.n,Z,b.buildSubMenuConfig);}else{Y.addToggleMenuItem(b.n||"",a.join(" "),c,c,Z,this.queryChecked(b));}}}}}},this);if(!Y.hasMenuItems()){return new mstrmojo.ui.menus.MenuConfig({menuCssClass:"hidden"});}return Y;},getCategoryMenuConfig:function(T){var e=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu category-menu"}),f=this,V=this.id,W,b,a,Z;var h='<div class="category-menu-item cf"><div class="menu-category">',d="</div>",c='<div class="menu-item">',Y="</div></div>",U,g,l;function X(j){return function(){f.executeCommand(j);};}for(a=0;T&&a<T.length;a++){W=T[a];b=W&&W.items;for(Z=0;Z<b.length;Z++){var k=b[Z];U=(Z===0)?(W.n||"&nbsp"):"&nbsp";g=k.n||"";l=h+U+d+c+g+Y;e.addToggleMenuItem(l,"",X(k),X(k),V,this.queryChecked(k));}if(a<T.length-1){e.addDisabledMenuItem("","sep");}}return e;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.ObjectBrowser");var H=mstrmojo.array;var E=[257,1024,3072,12032];mstrmojo.vi.ui.editors.ObjectPicker=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.ObjectPicker",cssClass:"mstrmojo-vi-ObjectPicker",zIndex:9,title:mstrmojo.desc(11496,"Select Object"),help:null,rootFolderID:null,rootFolderType:null,folderLinksContextId:4,supportedTypes:H.hash(E),item:null,OKFn:null,children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"ob",closeable:false,browsableTypes:"8,"+E.join(","),closeOnSelect:false,showCompletePath:false,searchVisible:false,scrollableIncFetch:true,bindings:{rootFolderID:"this.parent.rootFolderID",rootFolderType:"this.parent.rootFolderType",folderLinksContextId:"this.parent.folderLinksContextId"}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",alias:"btnHBox",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function C(){var J=this.parent.parent;this.parent.parent.close({item:J.item});var I=J.OKFn;if(I){I(J.item);}J.set("item",null);},bindings:{enabled:function B(){return !!this.parent.parent.item;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancle"),onclick:function C(){var I=this.parent.parent;this.parent.parent.close();I.set("item",null);}}]}],preBuildRendering:function A(){if(this._super){this._super();}this.ob.onSelectCB=[this,"onOBSelect"];},postBuildRendering:function D(){if(this._super){this._super();}this.browse();},onOBSelect:function F(I){this.set("item",((this.supportedTypes[I.t]||this.supportedTypes[I.st])?I:null));},browse:function G(){this.ob.browse();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.TextArea","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Editor","mstrmojo.ObjectBrowser","mstrmojo.NewFolderEditor");function B(){var E={alias:"newFolder",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-createfolder",text:mstrmojo.desc(3245,"Create New Folder"),onclick:function(){var G=this.parent.parent,F={zIndex:G.zIndex+10,navigateAfter:false,fId:G.ob.currentFolder.did,okFn:function(H,I){G.ob.refreshContent();if(I){G.ob.browseFolder(H.fid,G.newFolder);}}};if(G.ob.dataProvider){F.dp=G.ob.dataProvider;}G.openPopup("newFolder",F);},postCreate:function(){this.set("visible",mstrmojo.resolveFeature("create-folder"));}},D=mstrmojo.hash.clone(mstrmojo.ObjectBrowser.prototype.children);D.push(E);return D;}mstrmojo.SaveAsObjectBrowser=mstrmojo.declare(mstrmojo.ObjectBrowser,null,{scriptClass:"mstrmojo.SaveAsObjectBrowser",cssClass:"mstrmojo-SaveAs-OB",children:B()});var A={success:function(D){var E=this.parent;if(E.onObjectSaved){E.onObjectSaved({name:E.name,did:D.did,desc:E.desc});}mstrmojo.alert(mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",E.typeDesc||"Object").replace("###",E.name),null,mstrmojo.desc(7984,"Object Saved"));E.ob.refreshContent();E.close();},failure:function(E){var D=parseInt(E.getResponseHeader("X-MSTR-TaskErrorCode"),10)+4294967296,F=this.parent;if(D==2147749923){mstrmojo.confirm(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",F&&F.typeDesc||"Object").replace("'###'",F&&F.name?'"'+F.name+'"':""),{confirmBtn:{fn:function(){F.saveAs(true);}}},{title:mstrmojo.desc(3179),zIndex:F&&F.zIndex+10});}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+E.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};mstrmojo.SaveAsEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SaveAsEditor",cssClass:"mstrmojo-SaveAsEditor",title:mstrmojo.desc(3167,"Save As"),sId:null,rootFolderID:null,rootFolderType:null,folderLinksContextId:null,browsableTypes:null,showCompletePath:true,desc:"",name:"",help:"Save_As_dialog_box.htm",displaySaveLabel:true,searchVisible:true,upButtonVisible:true,children:[{scriptClass:"mstrmojo.SaveAsObjectBrowser",alias:"ob",closeable:false,closeOnSelect:false,fishEyeVisible:false,bindings:{showCompletePath:"this.parent.showCompletePath",rootFolderID:"this.parent.rootFolderID",rootFolderType:"this.parent.rootFolderType",folderLinksContextId:"this.parent.folderLinksContextId",browsableTypes:"this.parent.browsableTypes",displaySaveLabel:"this.parent.displaySaveLabel",searchVisible:"this.parent.searchVisible",upButtonVisible:"this.parent.upButtonVisible",sId:"this.parent.sId"},postCreate:function(){this.onSelectCB=[this.parent,"onOBSelect"];this.onBrowseFolder=[this.parent,"onOBBrowseFolder"];}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:2,cols:2,alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Name-Label",slot:"0,0",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",slot:"0,1",value:mstrmojo.desc(8116,"New Folder"),alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput",bindings:{value:"this.parent.parent.name"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Desc-Label",slot:"1,0",text:mstrmojo.desc(1154,"Description:")},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",slot:"1,1",alias:"desc",bindings:{value:"this.parent.parent.desc"},rows:5}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot okButton",alias:"ok",text:mstrmojo.desc(2400,"Save"),onclick:function(){this.parent.parent.saveAs();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],newFolder:{scriptClass:"mstrmojo.NewFolderEditor"},onOpen:function(){this.ob.browse();},onOBBrowseFolder:mstrmojo.emptyFn,onOBSelect:function(D){this.set("name",D.n);},saveAsCallback:function C(){return A;},saveAs:function(F){var E=this.contPanel;this.name=E.name.value;this.desc=E.desc.value;if(!this.name){mstrmojo.alert(mstrmojo.desc(3380,"Please enter valid name"));return ;}var G=this.saveParams||{};G.folderID=this.ob.currentFolder.did;G.description=this.desc||"";G.name=this.name||"";G.saveAsOverwrite=!!F;var D=this.saveAsCallback();D.parent=this;mstrmojo.xhr.request("POST",mstrConfig.taskURL,D,G);}});mstrmojo.SaveAsEditor.SAVEAS_CALLBACK=A;})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.List","mstrmojo.DI.DITreeDnD","mstrmojo.DI.DITreeNodeDnD");mstrmojo.requiresDescs(12714);var G=mstrmojo.array;function D(I,H){var K=I.n.toLowerCase(),J=H.n.toLowerCase();if((I.isFolder&&H.isFolder)||(!I.isFolder&&!H.isFolder)){if(K<J){return -1;}if(K>J){return 1;}return 0;}if(I.isFolder&&!H.isFolder){return -1;}if(!I.isFolder&&H.isFolder){return 1;}}mstrmojo.DI.DIObjectBrowserDnD=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIObjectBrowserDnD",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{listHeaderNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},canRefresh:false,sizeTooltip:false,folderSizeTooltip:false,children:[{scriptClass:"mstrmojo.List",slot:"listHeaderNode",itemMarkupFunction:function(J,H,I){var K=I.parent.canRefresh?'<div class="di-refresh-reports-dnd icon-clickable di-object-browser-header-right" mstrAttach:click></div>':"";return'<div><table cellpadding="0" cellspacing="0" style="width: 100%;"><tr><td class="mstrmojo-di-so-list-header-dnd cf" style="width: 30%;"><div class="di-object-browser-header-left">'+J.n+"</div>"+K+"</td></tr></table></div>";},items:null,onmousedown:function(H){if(H.e.target.className==="di-refresh-reports-dnd icon-clickable di-object-browser-header-right"){this.parent.clickedNode=this.parent.fileTree;this.parent.refreshFunction();}}},{scriptClass:"mstrmojo.DI.DITreeDnD",alias:"fileTree",slot:"listNode",cssClass:"mstrmojo-di-ga-table",bindings:{supportFolderDrag:"this.parent.supportFolderDrag",sizeTooltip:"this.parent.sizeTooltip",folderSizeTooltip:"this.parent.folderSizeTooltip"}}],browseFunction:mstrmojo.emptyFn(),editFunction:mstrmojo.emptyFn(),refreshFunction:mstrmojo.emptyFn(),filterType:[],clickedNode:null,fileList:null,sortRoot:true,supportFolderDrag:true,setFileListForNode:function(N,H){var I,K=[],M;var J=N;var P=this;for(I=0;I<J.length;I++){var O=J[I];if((this.filterType.length>0)&&mstrmojo.array.indexOf(this.filterType,O.type)===-1){continue;}O.clickHandler=P.onTreeNodeClick;O.list=P.fileTree;O.browser=P;if(H.data){var L=H.data.folderPath||"";O.folderPath=L+"/"+H.data.n;}if(!O.isFolder){O.editHandler=P.onEditButtonClick;O.iconEntity="mstrmojo-di-tree-node-icon text-doc";}M=new mstrmojo.DI.DITreeNodeDnD(O);K.push(M);}if(this.sortRoot){K.sort(D);}H.set("sizeTooltip",this.sizeTooltip);H.set("folderSizeTooltip",this.folderSizeTooltip);H.set("items",K);H.selectedItem=null;H.selectedNode=null;H.data.fetched=true;this.buildNodeRelation(H);},onfileListChange:function(){var J,I,L=[],O,P,S;var K=this.fileList;var R=this;var H=[];for(J=0;J<K.length;J++){var Q=K[J];if((this.filterType.length>0)&&mstrmojo.array.indexOf(this.filterType,Q.type)===-1){continue;}Q.clickHandler=R.onTreeNodeClick;Q.list=R.fileTree;Q.browser=R;if(this.clickedNode.data){var N=this.clickedNode.data.folderPath||"";Q.folderPath=N+"/"+this.clickedNode.data.n;}if(!Q.isFolder){Q.editHandler=R.onEditButtonClick;Q.iconEntity="mstrmojo-di-tree-node-icon text-doc";}P=new mstrmojo.DI.DITreeNodeDnD(Q);if(Q.cItem){O=[];for(I=0;I<Q.cItem.length;I++){var M=Q.cItem[I];M.clickHandler=R.onTreeNodeClick;M.list=R.fileTree;M.browser=R;M.iconEntity="mstrmojo-di-tree-node-icon salesforce";S=new mstrmojo.DI.DITreeNodeDnD(M);O.push(S);}O.sort(D);P.set("items",O);P.fetched=true;H.push(P);}L.push(P);}if(this.sortRoot){L.sort(D);}this.clickedNode.set("sizeTooltip",this.sizeTooltip);this.clickedNode.set("folderSizeTooltip",this.folderSizeTooltip);this.clickedNode.set("items",L);this.clickedNode.selectedItem=null;this.clickedNode.selectedNode=null;this.buildNodeRelation(this.clickedNode);G.forEach(H,function(T){R.buildNodeRelation(T.node);});},buildNodeRelation:function F(J){var I=[],H=null,K=null,L=null;if(!!J.ancestorList){I=J.ancestorList;H=J;L=J.nextOrderNode;}mstrmojo.array.forEach(J.items,function(M){K=M.node;if(!K.ancestorList){K.ancestorList=[];}mstrmojo.hash.copy(I,K.ancestorList);K.ancestorList.push(K.index);if(H){H.nextOrderNode=K;}H=K;});if(K){K.nextOrderNode=L;}},onEditButtonClick:function E(H){H.data.browser.editFunction(H);},onTreeNodeClick:function A(H){if(H.data.isFolder){H.data.browser.clickedNode=H;H.data.browser.browseFunction(H);}else{this.data.list.selectedItem=H.data;}},postBuildRendering:function C(){if(this._super){this._super();}this.clickedNode=this.fileTree;},setDimensions:function B(K,I){var H=parseInt(K,10);var J=parseInt(I,10);if(isNaN(H)||isNaN(J)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listHeaderNode="44px";this.layoutConfig.w.listHeaderNode=J+"px";this.layoutConfig.h.listNode=Math.max((H-44),0)+"px";this.layoutConfig.w.listNode=Math.max(J,0)+"px";if(this._super){this._super(H+"px",I);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.TreeBrowser","mstrmojo.fx","mstrmojo.array","mstrmojo.hash");mstrmojo.requiresDescs(221,1442,8117,8953,9135,12911);function B(a,e){var d,b,f,g={};var c=function c(h){if(h.selected){if(h.ipa){g[h.oid]=g[h.oid]||(h.fmn==="ID");}}};for(d=0;d<a.length;d++){f=a[d];if(f.isMultiForm){for(b=0;b<f.subColumns.length;b++){c(f.subColumns[b]);}}else{c(f);}}if(!g[e[0].aid]&&e[0].n!=="ID"){return false;}else{return true;}}var X=mstrmojo.desc(8953,"Suggestions"),F=mstrmojo.desc(9135,"No match found"),V=mstrmojo.dom,Y=mstrmojo.css,T=mstrmojo.hash,M=mstrmojo.array,I=16,Z,E;function W(d,c){var b=d.did,a=d.n,e={success:function(k){if(k.container){var h=k.container.dssforms||[],j,g;for(j=0,g=h.length;j<g;j++){h[j].aid=b;h[j].an=a;h[j].did=b+h[j].dssid;h[j].idf=h[0].dssid;}if(c&&c.success){c.success({items:h});}}}},f={attributeID:b,displayedForms:0};mstrApp.getRootController().getDataService().getAttributeForms(e,f);}function G(b){var a=this.status;a.set("text",b);a.set("title",b);Y.addClass(a.domNode,"error");this.adjustPosition();}function D(){var b=mstrmojo.string.trim(this.inputNode.value),e=this,d,h,g;if(!b){return ;}h={success:function f(l){var k=[],j;Z=Z.toLowerCase();mstrmojo.array.forEach(l.items,function(m){if(m.n.toString().toLowerCase().indexOf(Z)===0){k.push(T.copy({items:[],st:-5},m));}});E=k;j=k.length>0;e.status.set("text",j?X:F);e.statusNode.style.display="block";e.set("showContent",j);Y.removeClass(e.status.domNode,"error");e.children[0].set("items",k);},failure:function c(j){if(e.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+j.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));}},complete:function a(j){if(e.spinnerNode){e.spinnerNode.style.display="none";}if(e.postFetch){e.postFetch();}}};if(typeof microstrategy!=="undefined"&&microstrategy.useQuickSearch){d=microstrategy.useQuickSearch();}else{d=false;}if(Z&&b.indexOf(Z)===0&&E.length<this.blockCount){Z=b;h.success({items:E});return ;}Z=b;if(this.spinnerNode){this.spinnerNode.style.display="block";}g={styleName:"MojoFolderStyle",nameWildcards:d?16:1,blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:true,includeAncestorInfo:true,objectType:"12",quickSearch:d};g.searchPattern=d?b:b+"*";mstrApp.getRootController().getDataService().searchMetadata(h,g);}mstrmojo.qb.AttributeMappingTreeBrowserNode=mstrmojo.declare(mstrmojo.TreeBrowserNode,null,{scriptClass:"mstrmojo.qb.AttributeMappingTreeBrowserNode",markupString:'<div id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" title="{@title}" mstrAttach:mousedown,click,dblclick><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><img class="mstrmojo-TreeNode-checkBox" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><div class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</div></div>',premousedown:function O(a){if(this._super){this._super(a);}var e=mstrmojo.dom,c=mstrmojo.dom.eventTarget(a.hWin,a.e),b=(this.state===2),d=(this.tree.branchClickPolicy===mstrmojo.TreeBrowserEnum.BRANCH_POLICY_TOGGLE);if(this.isSpecialNode()||!(c===this.checkBoxNode||((c===this.textNode||c===this.displayNode)&&(b||!d)))){e.stopPropogation(a.hWin,a.e);}else{this.tree.raiseEvent({name:"formSelected",evt:a,target:c});}}});mstrmojo.qb.AttributeMapping=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup],{scriptClass:"mstrmojo.qb.AttributeMapping",markupString:'<div id="{@id}"  class="mstrmojo-Editor {@cssClass}" style="top:{@top};left:{@left};" mstrAttach:mousedown><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown><div class="mstrmojo-qb-mapping-searchbox" mstrAttach:click ><input class="mstrmojo-SearchBox-input mstrmojo-qb-mapping-searchinput" type="text"  mstrAttach:keyup,blur/><span class="mstrmojo-qb-mapping-spinnerbox" style="width:20px;"><span class="mstrmojo-SearchBox2-spinner" id="{@id}sbSpinner"></span></span></div><div class="mstrmojo-qb-mapping-search-status"></div><div class="mstrmojo-qb-mapping-search-content"><div class="mstrmojo-di-mapping-search-tree" style="float:left"></div><div class="mstrmojo-di-mapping-search-form"></div></div><div class="mstrmojo-qb-mapping-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[2];},treeNode:function(){return this.domNode.firstChild.childNodes[2].firstChild;},formNode:function(){return this.domNode.firstChild.childNodes[2].lastChild;},inputNode:function(){return this.domNode.firstChild.firstChild.firstChild;},spinnerNode:function(){return this.domNode.firstChild.firstChild.lastChild.lastChild;},buttonNode:function(){return this.domNode.firstChild.childNodes[3];},statusNode:function(){return this.domNode.firstChild.childNodes[1];},curtainNode:function(){return this.domNode.lastChild;}},blockCount:50,cssClass:"mstrmojo-qb-mapping-editor",init:function S(a){this._super(a);this.tree.attachEventListener("formSelected",this.id,"updateFormSelector");},updateFormSelector:function J(b){var f=b.evt.src;var e=this.target.data[0];if(e.isMultiForm){if(f.text==="ID"){this.attrName.set("text",e.alias+"<br>ID");}else{var d=e.alias+"_"+f.text;if(!f.selected){var a=e.subColumns;var c=[];mstrmojo.array.forEach(a,function(h,g){if(h.fmn!=="ID"){c.push({n:h.fmn,v:g});}});this.addChildren(mstrmojo.insert({scriptClass:"mstrmojo.DropDownList",cssClass:"mstrmojo-di-mapping-form-list",slot:"formNode",options:c,alias:d}));}else{this.removeChildren(this[d]);}this.renderChildren();}}},children:[{scriptClass:"mstrmojo.TreeBrowser",slot:"treeNode",alias:"tree",noCheckBox:false,itemIdField:"did",cssClass:"mstrmojo-qb-mapping-tree",items:[],itemFunction:function K(f,c,d){var b=d.tree||d,e,g=[],a="";if(f.anc&&f.anc.items){M.forEach(f.anc.items,function(h){g.push(h.n||"");});}if(g.length>0){a="\\"+g.join("\\");}e=new mstrmojo.qb.AttributeMappingTreeBrowserNode({data:f,state:0,parent:d,tree:b,multiSelect:d.multiSelect,text:f[d.itemDisplayField],textCssClass:b.item2textCss(f),items:f[d.itemChildrenField],itemIdField:d.itemIdField,itemDisplayField:d.itemDisplayField,itemIconField:d.itemIconField,itemChildrenField:d.itemChildrenField,itemFunction:d.itemFunction,listSelector:d.listSelector,title:a,selectionPolicy:"toggle"});return e;},isBranch:function N(a){return a.items;},item2textCss:function H(a){return("mstrmojo-qb-ListIcon "+(a.items?"t12":"t21"));},selectionAcrossBranch:false,listSelector:mstrmojo.ListSelector,multiSelect:true,getContentThroughTaskCall:function R(c,b){var a=this;if(c.isRoot){b.success(a.items);}else{W(c.data,b);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-mapping-form-name",slot:"formNode",alias:"attrName"},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-mapping-status",slot:"statusNode",alias:"status",text:X},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-mapping-buttonbox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-qb-attributelink-button",cssText:"float: right",text:mstrmojo.desc(1442,"OK"),onclick:function(n){var a=this.parent.parent,c=a.children[0].getTotalSelections(),h,g,e,o,f,d,b;a.close();if(c&&c.length>0){h=mstrApp.getRootController().model;g=a.cols;var m,l;for(f=0;f<g.length;f++){e=g[f];b=h.importSources[e.tableId].currentMapping;if(!B(b,c)){var k=mstrmojo.desc(12911,"Key attribute form ID of attribute ## has not been mapped.").replace("##",c[0].an);mstrApp.getRootController().displayError(k);return ;}}for(f=0;f<g.length;f++){e=g[f];e.ipa=1;e.tp=12;if(e.isMultiForm){for(d=0;d<c.length;d++){e.subColumns[d].ipa=1;if(d===0){e.subColumns[0].oid=c[0].aid;e.subColumns[0].fmid=c[0].dssid;}else{m=e.alias+"_"+c[d].n;l=a[m].selectNode.value;e.subColumns[l].oid=c[d].aid;e.subColumns[l].fmid=c[d].dssid;}}}else{e.oid=c[0].aid;e.fmid=c[0].dssid;}e.nochange=true;}o={failure:function(j){G.call(a,j);}};h.mapAttribute(e,c[0],o,e.oid);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-qb-attributelink-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(a){var b=this.parent.parent;b.close();}}]}],onEnter:function(){D.call(this);},onEsc:function(){if(this.onCancel){this.onCancel();}this.close();},close:function(){var a;V.detachEvent(document.body,"mousedown",this._close_handler);if(this.target){Y.toggleClass(this.target.domNode,"highlight",false);}this.buttonNode.style.display="none";this.statusNode.style.display="none";this.slideProp(false,this.contentNode,95);this.slideProp(false,this.inputNode,16);a=this.domNode;self.setTimeout(function(){document.body.removeChild(a);},510);},onkeyup:function Q(b){var a=b.hWin,e=b.e||a.event;if(this.onEnter&&e.keyCode===13){this.onEnter();return ;}if(this.onEsc&&e.keyCode===27){this.onEsc();return ;}if(typeof microstrategy!=="undefined"&&microstrategy.enableQuickSearch){if(this._autoSearchTimer){self.clearTimeout(this._autoSearchTimer);}var d=microstrategy.searchAutoCompleteDelay,c=this;if(d){this._autoSearchTimer=self.setTimeout(function(){D.call(c);},d);}}else{D.call(this);}},slideProp:function(b,e,a){var c,d={target:e,props:{height:{start:(b?0:a),stop:(b?a:0),suffix:"px"}}};c=new mstrmojo.fx.AnimateProp(d);c.play();},onshowContentChange:function A(){if(this.showContent){this.contentNode.style.display="block";this.slideProp(true,this.contentNode,95);this.buttonNode.style.display="block";}else{this.contentNode.style.display="none";this.buttonNode.style.display="none";}},attachMousedownEvent:function P(){var a=this;if(!this._close_handler){this._close_handler=function(){if(!a.isOnMe(V.eventTarget(self,arguments[0]))){a.close();}};}V.attachEvent(document.body,"mousedown",this._close_handler);},isOnMe:function L(a){return V.contains(this.domNode.firstChild,a,true,document.body);},adjustPosition:function U(){var b=this.domNode,d=b.firstChild,a=d.offsetHeight,c=d.offsetWidth,f=V.windowDim(),e=V.position(d,false);if((e.x+c+I)>f.w){d.style.left=f.w-c-I+"px";}if((e.y+a+I)>f.h){d.style.top=f.h-a-I+"px";}},onOpen:function C(){var a=this.inputNode;this.tree.set("items",[]);a.value="";this.set("showContent",false);this.statusNode.style.display="none";if(!mstrmojo.dom.isWK){this.slideProp(true,a,16);}a.focus();this.attachMousedownEvent();}});}());(function(){mstrmojo.requiresCls("mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowser","mstrmojo.ACL.UserDataService");mstrmojo.ACL.UserTreeBrowser=mstrmojo.declare(mstrmojo.TreeBrowser,null,{scriptClass:"mstrmojo.ACL.UserTreeBrowser",itemIdField:"did",branchClickPolicy:mstrmojo.TreeBrowserEnum.BRANCH_POLICY_SELECT,getACLUserDataService:function D(){return mstrmojo.ACL.UserDataService;},getContentThroughTaskCall:function C(G,E){var F=this.getACLUserDataService();E.failure=mstrmojo.func.composite([function(H){if(H.getResponseHeader){mstrmojo.alert(H.getResponseHeader("X-MSTR-TaskFailureMsg"));}},E.failure]);if(G.isRoot){F.getTopLevelGroups(G,E);}else{F.getMembers(G,E);}},isBranch:function B(E){return E.isGroup;},item2textCss:function A(E){return(this._super&&this._super(E))||"mstrmojo-ACLInputBox-user "+{8704:"u",8705:"ug"}[E.st];}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsExprNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo._HasPopup","mstrmojo.fe.AndOrNode","mstrmojo.fe.DynamicNode","mstrmojo.ConditionNode","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.hash","mstrmojo.expr");var D=mstrmojo.css,A=mstrmojo.dom,G=mstrmojo.hash,C=function(L){var M=L.data,K=M.dmy&&M.dmy.uts||[],I=K.length,H=[],J;for(J=0;J<I;J++){H.push(K[J].n);}return'<span class="mstrmojo-text">'+H.join(", ")+"</span>";};mstrmojo.fe.RelationNode=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsExprNode,mstrmojo.fe._IsRelationTreeNode,mstrmojo._HasPopup],{scriptClass:"mstrmojo.fe.RelationNode",markupString:'<div id="{@id}" class="mstrmojo-relation {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-relation-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-relation-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}"><span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-relationNode"><span class="mstrmojo-relationNode-inf"><span class="mstrmojo-relation-prefix-text">'+mstrmojo.desc(2790,"Set of").replace(/##/g,"")+'</span><span class="mstrmojo-textset"  mstrAttach:click></span><span class="mstrmojo-relation-postfix-text">'+mstrmojo.desc(2793,"Where").replace(/##/g,"")+'</span><span class="mstrmojo-relation-convert-text"  mstrAttach:click >'+mstrmojo.desc(null,"Convert to Condition")+'</span><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'"onclick="mstrmojo.all[\'{@id}\'].del()" /></span><div class="mstrmojo-relation-childTreeNode" style="position:relative;"></div></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},relationNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[1];},convertNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[3];},containerNode:function(){return this.domNode.childNodes[1].childNodes[1];}},markupMethods:{onprefixedAndOrEditableChange:function(){D.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){D.toggleClass(this.relationNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=C(this);}},noRelationOperator:true,children:[{scriptClass:"mstrmojo.fe.RelationFilterExprTree",alias:"childTree",ignoreLayout:true,dropZone:false,draggable:false,nodeClassMap:{14:mstrmojo.fe.AndOrNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},onNew:function(H){this.parent.tree.onNew(H);},getItemConfig:function(K,H,L){var I=mstrmojo.fe.RelationFilterExprTree.prototype.getItemConfig.call(this,K,H,L),J=L.tree||L;return G.copy({tree:J,rootTree:this.parent.tree,noRelation:true,inRelation:true},I);},prenodeclick:function(H){if(!H||!H.part){return ;}var I=this.rootTree;if(I&&I.onnodeclick&&this.editable){H.editor=I.editor;I.onnodeclick.call(this,H);}}}],premousedown:function(H){if(this._super){this._super(H);}var I=A.eventTarget(H.hWin,H.e);if(!A.contains(this.childTree.domNode,I,true)){this.childTree.clearTreeSelect();}},preselectedChange:function(H){if(!H.value){this.childTree.clearTreeSelect();}},init:function(H){this._super(H);var I=this.data;if(I){delete this.data;this._set_data(null,I);}},_set_data:function(K,H){var I=this.data,J=(I!==H);if(J){this.data=H;if(H){this.childTree.set("items",H.nds||[H]);}}return J;},isSelectableArea:function(H){return mstrmojo.dom.contains(this.relationNode,H,true);},preclick:function E(H){var J=null,I=A.eventTarget(H.hWin,H.e);if(A.contains(this.prefixNode,I,true)){J="andor";}else{if(A.contains(this.textNode,I,true)){J="createSet";}else{if(A.contains(this.convertNode,I,true)){this.parent.removeSet(this);return false;}}}H.part=J;},del:function B(){var H=this.parent;if(H&&H.remove&&this.data){H.remove(this.data);}},newCondition:function F(H){this.childTree.newCondition(H);},avatarCssCls:"mstrmojo-FE mstrmojo-relationNode",getAvatarNode:function(){return this.relationNode.cloneNode(true);}});})();(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.hash","mstrmojo.FilterExpr");var D=mstrmojo.hash,B=mstrmojo.expr.ET;mstrmojo.fe.FilterExprTree=mstrmojo.declare(mstrmojo.FilterExpr,null,{scriptClass:"mstrmojo.fe.FilterExprTree",allowCopy:false,containerResizable:false,draggable:true,dropZone:true,editable:true,makeObservable:true,onConditionEdit:mstrmojo.emptyFn,modifyConditionNode:function(G,F){var H=G.data,E=H.isNew;D.copy(D.clone(F),D.clear(H));delete H.isNew;G.paint();if(H.et===B.MQ||H.et===B.MC){G.set("noCreateSet",true);}if(G.tree.onConditionEdit){G.tree.onConditionEdit(G,E);}},getItemConfig:function(H,E,I){var F=this._super(H,E,I),G=I.tree;return D.copy({onclick:G.prenodeclick,containerResizable:G.containerResizable,ondragend:G.ondragend,ondrop:G.ondrop},F);},ondragenter:function A(E){this.dropCuePos={left:0,top:0,idx:0,idxActual:0};this._super(E);},ondragend:function(E){if(this===this.tree){return this._super(E);}else{return this.constructor.prototype.ondragend.call(this,E);}},ondrop:function(E){if(this===this.tree){return this._super(E);}else{return this.constructor.prototype.ondrop.call(this,E);}},isEditable:function C(F){if(!this.editable){return false;}var E=false;switch(F&&F.et){case B.R:case B.F:E=false;break;case B.ANDOR:case B.MQ:case B.AQ:case B.AL:case B.AC:case B.MC:case B.AE:E=true;break;case B.XML:E=!F.xml||!!F.ph;}return E;},prenodeclick:function(E){if(!E||!E.part){return ;}if(E.part!=="createSet"&&E.part!=="createSetOpt"&&!(E.part==="andor"?this.prefixedAndOrEditable:this.editable)){return ;}var F=this.tree;if(F.onnodeclick){F.onnodeclick.call(this,E);}},getSelectedItemWidget:function(){var E=function(K){var I=K&&K.ctxtBuilder&&K.ctxtBuilder.itemWidgets,G=K.selectedIndex,F=I&&I.length||0;if(!I){return ;}if(G===-1){for(var H=0;H<F;H++){var J=E(I[H]);if(J){return J;}}}else{return I[G];}};return E(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.expr","mstrmojo.FilterExpr");var J=mstrmojo.expr,L=J.ET,C={},G=mstrmojo.hash,M=mstrmojo.dom;C[L.ANDOR]=mstrmojo.AndOrNode;C["*"]=mstrmojo.ConditionNode;function A(){var O=this.tree,N=O.parent,P=M.delta(this.domNode,O.domNode);if(this.data.sqltp===1){P.y+=parseInt(N.filterExpr.domNode.offsetHeight,10)+15;}N.parent.openPopup("andOrPopupRef",{condition:this,zIndex:this.zIndex?this.zIndex+100:100,left:P.x+40+"px",top:P.y+65-N.domNode.scrollTop+"px"});}function I(P){if(P.constructor!==Array){P=[P];}var T,S={b:0,c:0},U,R,O;for(var Q=0,N=P.length;Q<N;Q++){T=P[Q];if(!(T&&T.et)){continue;}U=T.nds;if(U){R=I(U);S.b+=R.b;S.c+=R.c;}else{O=(T.et===L.B);S[O?"b":"c"]++;}}return S;}function H(O){var P=O.parent.data;if(P){var N=O.items;if(O.alias==="filterExpr"){P.expr=N&&N[0];}else{P.aggexpr=N&&N[0];}}}function D(N){var P=I(N.value),O=this.tree;O.set("bandingCount",O.bandingCount+P.b);O.set("conditionCount",O.conditionCount+P.c);}function B(N){var P=I(N.value),O=this.tree;O.set("bandingCount",O.bandingCount-P.b);O.set("conditionCount",O.conditionCount-P.c);}mstrmojo.qb.FilterTree=mstrmojo.declare(mstrmojo.FilterExpr,null,{scriptClass:"mstrmojo.qb.FilterTree",draggable:true,dropZone:true,allowCopy:false,makeObservable:true,bandingCount:0,conditionCount:0,onadd:function(N){H(this);D.apply(this,[N]);},onremove:function(N){H(this);B.apply(this,[N]);},editable:true,onRender:function(){var O=I(this.items),N=this.tree;N.set("bandingCount",O.b);N.set("conditionCount",O.c);},itemFunction:function(S,O,T){var Q=(S.et===L.ANDOR),R=T.tree||T,P={data:S,tree:R,parent:T,itemFunction:Q?T.itemFunction:null,draggable:Q?R.draggable:false,dropZone:Q?R.dropZone:false,allowDrop:Q&&R.dropZone?R.allowDrop:null,allowCopy:Q?R.allowCopy:false,editable:R.isEditable?R.isEditable(S):R.editable,makeObservable:Q&&T.makeObservable,onclick:R.onnodeclick,onadd:R.onnodeadd,onremove:R.onnoderemove},N=C[S.et]||C["*"];return N&&(new N(P));},isEditable:function K(O){if(!this.editable){return false;}var N=false;switch(O&&O.et){case L.AQ:case L.ANDOR:case L.RLS:case"*":N=true;break;}return N;},onnodeclick:function F(O){if(!this.editable){return ;}if(O&&O.part==="andor"){A.call(this);}else{var N=this.tree;N.onexprclick&&N.onexprclick(this);}},onnodeadd:D,onnoderemove:B,allowDrop:function E(N){var P=N&&N.src,S=P&&P.data,R=S&&S.et,Q=(R===L.B),O=this.tree;return R&&((Q&&(O.conditionCount===0))||(!Q&&(O.bandingCount===0)));}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.expr","mstrmojo.hash","mstrmojo.Box","mstrmojo.Button","mstrmojo.Editor","mstrmojo.FilterExpr","mstrmojo.Label","mstrmojo.Obj","mstrmojo.ui.Checkbox","mstrmojo.ui.CheckList","mstrmojo.warehouse.EnumObjectTypes");var G=mstrmojo.expr,C=G.ET,B=mstrmojo.array,E=mstrmojo.string,F=mstrmojo.warehouse.EnumObjectTypes,D=mstrmojo.mstr.EnumNodeDimty;mstrmojo.fe.CreateSetEditor=mstrmojo.declare(mstrmojo.Editor,null,{onOpen:function(){var M=this.model,P=this.condition.data,N=!P.m,J=this.attrsBox.attrsList,H=this.relBox.relPd,Q=[{n:mstrmojo.desc(12037,"System Default"),t:-1,did:"default"}].concat(M.metrics),I=this.appQual;J.set("items",M.attrs);mstrmojo.array.forEach(["relBox","appQual"],function(R){this[R].set("visible",N);},this);if(P.dmt===4&&P.dmy.uts){var K={};B.forEach(P.dmy.uts,function(S){var R=B.find(M.attrs,"did",S.utgt.did);if(R>=0){K[R]=true;}});J.set("selectedIndices",K);}if(N){H.set("items",Q);if(P.relation&&P.relation.guide){var L=P.relation.guide,O=B.find(Q,"did",L.did);H.set("selectedIndex",O>=0?O:0);}else{H.set("selectedIndex",0);}I.set("checked",!!P.applySubExpr);}},onOK:function(){var O=this.model,R=this.condition,T=this.condition.data,L=this.attrsBox.attrsList,H=this.relBox.relPd,J=this.appQual;var V=L.getSelectedItems(),I=[];B.forEach(V,function(X){I.push({utgt:{n:X.n,did:X.did},utp:G.DMY_TP.ATTR,agg:1,flt:2,gb:true,rps:0,n:X.n});});var U;if(H.selectedIndex>0){var M=H.items[H.selectedIndex];U={n:M.n,did:M.did,t:F.METRIC,st:1024};}var K;if(T.et===15){T.dmt=D.NodeDimtyOutputLevel;T.dmy=T.dmy||{};T.dmy.uts=I;K=T.relation=T.relation||{};if(U){K.guide=U;T.useSchema=false;}else{delete K.guide;delete K.rsTp;delete K.joTp;delete K.paTp;delete K.erTp;T.useSchema=true;}T.applySubExpr=J.checked;R.set("data",T);}else{var S={et:15};S.dmt=D.NodeDimtyOutputLevel;S.dmy={};S.dmy.uts=I;K=S.relation={};if(U){K.guide=U;}else{S.useSchema=true;}S.applySubExpr=J.checked;var N=R,P={rq:S,cq:T},Q=[R.childIndex()];if(T.et===C.ANDOR){if(T.nds&&T.nds.length>2){var W=O.childIdx;Q=[W,W-1];}else{N=R.parent;}}else{N=R.parent;P.isMetric=!!T.m;}N.createSet(Q,P);}},children:[{scriptClass:"mstrmojo.Box",alias:"attrsBox",cssClass:"Attributes-Box",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14613,"Select attributes to create the set"),cssClass:"Label"},{scriptClass:"mstrmojo.ui.CheckList",alias:"attrsList",cssClass:"CheckList"}]},{scriptClass:"mstrmojo.Box",alias:"relBox",cssClass:"RelatedBy-Box",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12036,"Related by"),cssClass:"Label",cssDisplay:"inline-block"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"relPd",cssClass:"Pulldown",cssDisplay:"inline-block",onitemSelected:function A(H){}}]},{scriptClass:"mstrmojo.ui.Checkbox",alias:"appQual",cssClass:"AppQual-CheckBox",postBuildRendering:function(){this.domNode.innerHTML=E.encodeHtmlString(mstrmojo.desc(12038,"Apply this qualification independently of the relationship filter"));}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float: right; border-collapse: separate; display: table;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(2397,"OK"),onclick:function(){var H=this.editor;H.onOK();H.close();},bindings:{enabled:function(){var I=this.parent.parent.attrsBox.attrsList,H=this.parent.parent.attrsBox.attrsList.selectedIndices;return I.getSelectedItems().length>0;},editor:"this.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.editor.close();},bindings:{editor:"this.parent.parent"}}]}]});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.DI.DIObjectBrowser","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget");mstrmojo.requiresDescs(8338,8513,12891);var I=mstrmojo.DI.DIConstants,E=mstrmojo.DI.DIConstants.sourceType,D=mstrmojo.DI.DIHelpers.isOperationMode;function B(J,K){return J+"###path:"+K;}mstrmojo.DI.DISourceObjects=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DISourceObjects",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div class="cf source-objects-options"></div><div></div><div style="padding-left:20px;"></div><div style="padding-left:20px;padding-right:20px;"></div><div class="show-preview"></div><div class="source-objects-refresh"></div></div>',markupSlots:{subtitleNode:function(){return this.domNode.children[0];},analyticsNode:function(){return this.domNode.children[1];},listHeaderNode:function(){return this.domNode.children[2];},listNode:function(){return this.domNode.children[3];},previewNode:function(){return this.domNode.children[4];},refreshNode:function(){return this.domNode.children[5];}},markupMethods:{onvisibleChange:function(){var J=mstrApp.getRootController().getModel().operationMode;if(D(this.operationMode)){J=this.operationMode;}this.domNode.style.display=this.visible?"block":"none";}},isMultiSelect:true,children:[{slot:"subtitleNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-signout",text:mstrmojo.desc(8338,"sign out"),onclick:function(){mstrApp.getRootController().oAuthSignOut(this.parent.sourceObjectsInfo.type);}},{slot:"subtitleNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"username",postBuildRendering:function(){this.update();mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.update);},update:function(){var J=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type],K=J.userDisplayName;if(J.userEmail){K+=" ("+J.userEmail+")";}this.set("text",K);}},{slot:"subtitleNode",alias:"subtitle",scriptClass:"mstrmojo.Label",cssClass:"source-objects-subtitle",bindings:{text:function(){return mstrmojo.desc(12891,"Select Your file from ####").replace("####",this.parent.sourceObjectsInfo.name);}}},{slot:"subtitleNode",scriptClass:"mstrmojo.Label",allowHTML:true,cssClass:"source-objects-subtitle2",alias:"rightFormat",text:'|  Make sure your file is in <a target="_blank" href="http://www.microstrategy.com/express/resources/data-preparation">right format!</a>'},{scriptClass:"mstrmojo.DI.DIObjectBrowser",cssClass:"source-objects-browser",slot:"listNode",alias:"browser",browseFunction:function(J){return mstrApp.getRootController().oAuthSourceBrowserFunction(this.parent.sourceObjectsInfo.type,J);},editFunction:function(J){this.parent.onEditButtonClick(J);},refreshFunction:function(){mstrApp.getRootController().getOAuthSourceReports(this.parent.sourceObjectsInfo.type,false);},bindings:{visible:function(){if(this.parent.sourceObjectsInfo.type===E.googleAnalytics){return(this.parent.analyticsComponent.ultp.selectedIndex===0);}return true;},canRefresh:function(){return this.parent.sourceObjectsInfo.type!==E.googleAnalytics;},isMultiSelect:"this.parent.isMultiSelect"},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},autoSelectNode:function(J,K){if(J.data.isFolder){J.data.browser.clickedNode=J;mstrApp.getRootController().oAuthSourceBrowserFunction(this.parent.sourceObjectsInfo.type,J,K);}else{J.data.list.selectedItem=J.data;J.selectThisNode();mstrApp.getRootController().sourceSelected(true);}},postCreate:function(){this.sortRoot=(this.parent.sourceObjectsInfo.type!==E.salesforce);}},{scriptClass:"mstrmojo.TextArea",slot:"listNode",alias:"textarea",maxLength:2000,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onheightChange:function(){this.domNode.style.height=this.height||"";},onwidthChange:function(){this.domNode.style.width=this.width||"";}},onvalueChange:function(){if(this.value!==""){mstrApp.getRootController().sourceSelected(true);}else{mstrApp.getRootController().sourceSelected(false);}},bindings:{value:function(){var J=mstrApp.getRootController().getModel().operationMode;if(D(this.operationMode)){J=this.operationMode;}if(J!==I.operationMode.create){return this.model.currentSource.sourceInfo.name;}return"";},visible:function(){if(this.parent.sourceObjectsInfo.type===E.googleAnalytics){return(this.parent.analyticsComponent.ultp.selectedIndex===1);}return false;}}}],populate:function(V){var U=this.model.externalSources[this.sourceObjectsInfo.type].reports;var T=mstrApp.getRootController().parseOAuthSourceFolder(this.sourceObjectsInfo.type,U);this.browser.set("fileList",T);var W,S,L,P;var M=this.model.operationMode;if(D(this.operationMode)){M=this.operationMode;}var K,R,Q,O,J=null;if(V&&V.targetPageId){if(V.targetPageId!==this.id){return ;}}if(M===I.operationMode.refresh||M===I.operationMode.edit){J=this.model.currentSource;if(this.tableID){J=this.model.getImportSource(this.tableID);}if(this.currentSource){J=this.currentSource;}if(this.sourceObjectsInfo.type===E.salesforce){if(J&&J.sourceInfo&&J.sourceInfo.url){K=this.browser.fileTree.items;for(Q=0;Q<K.length;Q++){R=K[Q].items;for(O=0;O<R.length;O++){var N=R[O];if(N.n===J.sourceInfo.name){K[Q].node.set("state",1);N.node.selectThisNode();}}}}}if(this.sourceObjectsInfo.type===E.dropbox){if(J&&J.sourceInfo&&J.sourceInfo.url){R=K=this.browser.fileTree.items;W=J.sourceInfo.url;S=W.indexOf("/",1);if(S!==-1){L=W.substring(1,S);for(Q=0;Q<K.length;Q++){if(K[Q].isFolder===true&&K[Q].n===L){this.browser.autoSelectNode(K[Q].node,W.substring(S));K[Q].fetched=true;K[Q].node.set("state",1);}}}else{P=W.substring(1);for(Q=0;Q<R.length;Q++){if(R[Q].isFolder!==true&&R[Q].n===P){R[Q].node.selectThisNode();}}}}}if(this.sourceObjectsInfo.type===E.googleDrive){if(J&&J.sourceInfo&&J.sourceInfo.url){R=K=this.browser.fileTree.items;W=J.sourceInfo.url;W=W.substr(W.indexOf("###")+"###path:".length);S=W.indexOf("/",1);while(S!==-1){L=W.substring(1,S);for(Q=0;Q<K.length;Q++){if(K[Q].isFolder===true&&K[Q].n===L){this.browser.autoSelectNode(K[Q].node,W.substring(S));K[Q].fetched=true;K[Q].node.set("state",1);}}W=W.substr(S);S=W.indexOf("/",1);}P=W.substring(1);for(Q=0;Q<R.length;Q++){if(R[Q].isFolder!==true&&R[Q].n===P){R[Q].node.selectThisNode();}}}}}this.username.set("text",mstrmojo.desc(8513,"User:")+this.model.externalSources[this.sourceObjectsInfo.type].userDisplayName+" | ");},preBuildRendering:function G(){var K=this.model.operationMode;if(D(this.operationMode)){K=this.operationMode;}mstrApp.getRootController().sourceSelected(false);var J=this.sourceObjectsInfo.name.toLowerCase();if(J.indexOf(" ")!==-1){J=J.substring(0,J.indexOf(" "))+J.substring(J.indexOf(" ")+1,J.length);}this.subtitle.cssClass+=" extrasmall-"+J;if(this.sourceObjectsInfo.type===E.googleAnalytics||this.sourceObjectsInfo.type===E.salesforce||K===I.operationMode.refresh){this.rightFormat.set("visible",false);}this.setDimensions(parseInt(this.parent.layoutNode.offsetHeight,10),this.parent.layoutNode.offsetWidth);if(this._super){this._super();}},setDimensions:function F(M,K){var J=parseInt(M,10);var L=parseInt(K,10);var N=this.model.operationMode;if(D(this.operationMode)){N=this.operationMode;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listNode=(J-70)+"px";if(N===I.operationMode.refresh||N===I.operationMode.edit){this.layoutConfig.h.listNode=(J-340)+"px";}this.layoutConfig.w.listNode=(L-40)+"px";if(this._super){this._super(J+"px",K);}},postBuildRendering:function A(){if(this._super){this._super();}this.model.externalSources[this.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.populate);},onNextButtonClick:function C(){var O=this.model.operationMode;var K=[];var N,L,J,P;var M=this.tableID||null;if(D(this.operationMode)){O=this.operationMode;}J=(O===I.operationMode.create)?true:this.showPrv.checked;P=this.browser.fileTree;for(L=0;L<P.selectedNodes.length;L++){N=P.selectedNodes[L].data;K.push({n:N.n,desc:N.desc,query:B(N.address,N.folderPath+"/"+N.n),type:N.type,tableID:M});}mstrApp.getRootController().importMultiOAuthReports(this.sourceObjectsInfo.type,K,J,!mstrApp.getRootController().model.hasEMMAReportInstance(),M?I.actions.refreshData:I.actions.importSource,this.id);},onBackButtonClick:function H(){var J=mstrApp.getRootController();J.showPage(I.pageType.dataSelection);},setSelectedNodes:function(J){var M=this.browser.fileTree,K=0,L;for(K=0;K<M.selectedNodes.length;K++){L=M.selectedNodes[K];L.deselect();}M.selectedNodes=[];M.selectedNode=null;this.browser.set("forceEnableContinue",true);for(K=0;K<J.length;K++){J[K].selectThisNode();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo._ValidateSuggestions","mstrmojo.WidgetList","mstrmojo.Editor","mstrmojo.LegacySuggestionList");mstrmojo.Enum_OIB_States=mstrmojo.hash.copy(mstrmojo._ValidateSuggestions.ENUM_STATES,{EDITING:2,ADDING:3,EMPTY:4});mstrmojo.Enum_OIB_States_CSS=(function(){var AF=mstrmojo.Enum_OIB_States,AE={},AG;for(AG in AF){if(AF.hasOwnProperty(AG)){AE[String(AF[AG])]=AG;}}return AE;}());var Q=mstrmojo.dom,S=mstrmojo.hash,Z=mstrmojo.Enum_OIB_States,I=0,b="_did_",AA=mstrmojo.Enum_Keys,AC=80,U=200;function P(){return I++;}function g(AE){return(AE&&AE.state===Z.ADDING);}function p(AE){var AF={n:AE||"",state:Z.EMPTY};AF[b]=-2;return AF;}function O(AE){return(AE&&AE.state===Z.EMPTY);}function w(AF){var AG=AF.items,AE=AG&&AG.length;if(!AE){return true;}return(AE===1&&g(AG[0]))||(AE===2&&O(AG[0])&&g(AG[1]));}function l(){var AF=this.ctxtBuilder.itemWidgets,AE=AF[AF.length-1];if(AE&&AE.isAdding){var AG=this;Q.attachEvent(AE.domNode,"click",function(){AG.editingIdx=null;});return AE;}return null;}function L(){var AE=this.editingIdx;if(AE!==null){return this.ctxtBuilder.itemWidgets[AE];}return l.call(this);}function D(){this.isActive=false;var AF=this.emptyText||"",AG=this.items;if(w(this)&&!O(AG[0])&&(AF.length>0)){this.add([p(AF)],0);var AH=this.ctxtBuilder.itemWidgets[0];AH.set("shouldEllipsize",true);AH.doEllipsize();}var AE=L.call(this);if(AE){if(g(AE)&&this.showEmptyItem){AE.domNode.style.display="none";}this.scrollTo(this.items[0]);AE.blur();}Q.detachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.detachEvent(AE.inputNode,"keydown",this._tabKeyHander);}}function N(){if(!this.enabled){return ;}this.isActive=true;if(O(this.items[0])){this.remove(0);}var AE=L.call(this);if(AE){if(g(AE)&&!this.isFull){AE.domNode.style.display="block";}this.scrollTo(AE.data);AE.focus();}Q.attachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.attachEvent(AE.inputNode,"keydown",this._tabKeyHander);}}mstrmojo.ObjectInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._ValidateSuggestions],{scriptClass:"mstrmojo.ObjectInputBox",cssClass:"mstrmojo-ObjectInputBox",emptyText:"",showEmptyItem:true,items:null,itemField:"n",dynamicVerify:true,suggestCount:10,candidates:null,makeObservable:true,renderOnScroll:false,editingIdx:null,isActive:false,maxObjectCount:null,isFull:false,suggestionListClass:"mstrmojo.LegacySuggestionList",acptSugItemOnly:false,useKeyDelay:false,showSuggestionOnEdit:true,tabNavigable:false,getSearchPattern:function(){var AE=L.call(this);if(AE){return AE.getSearchPattern();}return"";},getSuggestionTarget:function m(){return this.suggestTarget;},onsuggestTargetChanged:function o(AE){this._request_pattern=null;},getSuggestionPos:function c(){return this._pop_cfg;},onSuggestionItemSelect:function x(AE){if(this.suggestTarget){this.suggestTarget.setItem(AE[this.itemField],AE,false);}this.hideSuggestion();this.closePopup();},hideEditButton:function(AE){return !!this.noEditButton;},_set_items:function k(AJ,AG){AG=mstrmojo.hash.clone(AG)||[];var AI=this.maxObjectCount;this.set("isFull",(AI&&AG.length>=AI));if(AG.length===0){var AF=this.emptyText||"";if(AF.length>0){AG.push(p(AF));}}var AH={n:"",state:Z.ADDING};AH[b]=-1;AG.push(AH);var AE=AG[AG.length-1];if(AE&&g(AE)&&this.maxObjectCount&&(this.getSelectedObjects().length>=this.maxObjectCount)){this.set("isFull",true);}this.itemIdField=b;return this._super(AJ,AG);},add:function E(AF,AE){var AG=l.call(this);if(!this.maxObjectCount||this.getSelectedObjects().length<this.maxObjectCount){this._super(AF,AE);}if(!w(this)&&O(this.items[0])){this.remove(0);}if(AG){AG.adjustInputWidth();if(this.maxObjectCount&&(this.getSelectedObjects().length===this.maxObjectCount)){this.set("isFull",true);AG.domNode.style.display="none";}else{AG.domNode.style.display=this.showEmptyItem?"none":"";}}},remove:function a(AE){this._super(AE);var AF=l.call(this);if(AF){if(this.maxObjectCount&&(this.getSelectedObjects().length<this.maxObjectCount)){this.set("isFull",false);}AF.adjustInputWidth();}},preBuildRendering:function(){if(this.items==null||this.items.length==0){this.set("items",[]);}if(this._super){this._super();}},postBuildRendering:function Y(){this._super();var AF=this,AE=l.call(AF);if(AE&&(this.showEmptyItem||this.isFull)){AE.domNode.style.display="none";}this._clickHandler=function(){N.call(AF);};this._mousedownHandler=function(AG){if(!AF.isActive||AF.browserShown){return ;}var AH=Q.eventTarget(self,AG);if(AH&&AH.parentNode&&!Q.contains(L.call(AF).domNode,AH,false,document.body)&&!Q.contains(AF.suggestionPopup.domNode,AH,false,document.body)){D.call(AF);}};if(this.tabNavigable){this._tabKeyHander=function(AG){var AH=parseInt(AG.keyCode||AG.charCode,10);if(AH===AA.TAB){if(!AF.isActive||AF.browserShown){return ;}D.call(AF);}};}Q.attachEvent(this.domNode,"click",this._clickHandler);},nextId:P,item2textCss:function M(AE){return AE.cssClass||"";},itemFunction:function G(AG,AE,AF){AG[AF.itemIdField]=P();var AH=new mstrmojo.ObjectItem({parent:AF,itemField:AF.itemField,cssClass:AF.item2textCss(AG),data:AG,showSuggestionOnEdit:this.showSuggestionOnEdit,enabled:AF.enabled});AF.attachEventListener4ItemWidget(AH,AF);return AH;},attachEventListener4ItemWidget:function h(AI,AG){var AF=["ItemEditBegin","ItemEditEnd","ItemDeletePrev","ItemDelete","ItemAdd","SuggestionOn","SuggestionOff","ItemEditing"],AE=AF.length,AH;for(AH=0;AH<AE;AH++){AI.attachEventListener(AF[AH],AG.id,"_itemChangeHandler");}return AI;},getSelectedObjects:function j(){if(w(this)){return[];}var AE=this.items,AF=AE.length-1;if((AF>-1)&&g(AE[AF])){return AE.slice(0,AF);}return AE.concat();},isValid:function C(){var AF=this.ctxtBuilder.itemWidgets,AE=AF&&AF.length,AG;for(AG=0;AG<AE;AG++){if(!AF[AG].isValid()){return false;}}return true;},isEmpty:function V(){return w(this);},_itemChangeHandler:function(AH){var AJ=AH.name,AK=AH.d,AF,AE=this.items.length,AG;switch(AJ){case"ItemEditBegin":if(this.editingIdx!==null){AG=L.call(this);if(AG){AG.blur();}}AF=this.itemIndex(AK);this.editingIdx=AF;N.call(this);break;case"ItemEditEnd":this.editingIdx=null;if(AH.deactivate){D.call(this);}else{N.call(this);}AG=l.call(this);if(AG){AG.adjustInputWidth();}break;case"ItemDelete":if(this.editingIdx!==null){AG=L.call(this);if(AG){AG.blur();}this.editingIdx=null;}AF=this.itemIndex(AK);this.remove(AF);if(!AH.deactivate){this.editingIdx=null;N.call(this);}else{if(!this.isActive){D.call(this);}else{N.call(this);}}break;case"ItemDeletePrev":if(AE>1){this.remove(AE-2);}break;case"ItemAdd":var AI=S.copy(AH.d);this.add([AI],AE-1);if(AH.deactivate){D.call(this);}else{N.call(this);}break;case"SuggestionOn":this.set("suggestTarget",AH.target);this._pop_cfg={target:AH.target,left:AH.l,top:AH.t,zIndex:this.zIndex?this.zIndex:100};this.showSuggestion(AH.pattern);break;case"SuggestionOff":this.set("suggestTarget",null);this.hideSuggestion();break;}if(this.onitemchange&&(AJ==="ItemEditEnd"||AJ==="ItemAdd"||AJ==="ItemDelete"||AJ==="ItemDeletePrev"||AJ==="ItemEditing")){this.onitemchange();}},unrender:function B(AF){var AE=this.suggestionPopup;if(AE.hasRendered){AE.unrender(false);}if(this._super){this._super(AF);}},destroy:function u(AF){var AE=this.suggestionPopup;if(AE&&AE.hasRendered){AE.destroy(false);}if(this._super){this._super(AF);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ObjectInputBox,{onenabledChange:mstrmojo.Widget.enabledMarkupMethod});mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasEllipsis");var q="mstrmojo-ObjectItem-text";mstrmojo.ObjectItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasEllipsis],{scriptClass:"mstrmojo.ObjectItem",markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode"><span title=" {@title}" class="'+q+' {@cssClass}"></span><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])"/></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" mstrAttach:keyup,keydown/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},editButtonNode:function(){return this.domNode.firstChild.childNodes[1];},delButonNode:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},markupMethods:{oncssClassChange:function(){this.textNode.className=q+" "+this.cssClass;},onstateChange:function(){var AH=this.state,AG=mstrmojo.Enum_OIB_States_CSS[AH],AF=this.domNode;if(AH===Z.EMPTY){AF.innerHTML=this.enabled?'<div class="mstrmojo-ObjectItem-emptyText">'+this.text+"</div>":"";}else{if(AH===Z.EDITING){var AE=Math.round(this.displayNode.clientWidth);this.editNode.style.width=AE-4+"px";this.inputNode.style.width=AE-9+"px";}}AF.className="mstrmojo-ObjectItem "+AG;this.updateButtonsVisibility(this.data);},ontextChange:function(){this.inputNode.value=this.text;this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);}},updateButtonsVisibility:function AD(){if(this.parent.hideEditButton(this.data)){this.editButtonNode.style.display="none";}},state:Z.VALID,onstateChange:function e(AE){this.data.state=this.state;},ontextChange:function H(AE){this.data[this.itemField]=this.text;},updateData:function F(AE){S.copy(AE,this.data);this.set("state",Z.VALID);this.set("text",this.data[this.itemField]);this.set("cssClass",this.parent.item2textCss(this.data));},init:function z(AF){this._super(AF);var AH=this.data,AE=AH.state,AG=this.parent;AE=this.initState();this.cssClass=AG.item2textCss(AH);this.text=AH[this.itemField];this.state=AE;this.isAdding=g(AH);this.useRichTooltip=true;this.title=this.text;},initState:function K(){var AF=this.parent,AG=this.data,AE=AG.state;if(AG&&AG.did){AG.state=Z.VALID;return AG.state;}if(typeof AE==="undefined"){AE=AF.dynamicVerify?AF.verifyObject(AG[this.itemField],this):Z.UNDETERMINED;AG.state=AE;}return AE;},isValid:function C(){var AE=parseInt(this.state,10);return(AE!==Z.INVALID&&AE!==Z.UNDETERMINED);},adjustInputWidth:function A(){if(this.isAdding){var AH=this.inputNode.style;AH.width=AC+"px";var AG=this.domNode.parentNode,AE=AG.parentNode.offsetWidth,AF=Math.max(AE-AG.offsetLeft-20,AC);if(!isNaN(AF)){AH.width=AF+"px";}}},blur:function T(){this.hideSuggestion();if(!this.isActive){return ;}this.isActive=false;var AG=this.inputNode,AE=AG.value,AF=this.parent;window.setTimeout(function(){try{AG.blur();}catch(AH){}},0);if(!AE){return ;}if(AF.acptSugItemOnly&&this._tWas_){this.set("text",AE);this.set("text","");this._tWas_=null;return ;}this.setItem(AE,null,true);},focus:function t(){var AF=this.inputNode,AE=this.isActive;window.setTimeout(function(){try{AF.focus();if(AF.createTextRange&&!AE){var AH=AF.createTextRange(),AG=AF.value.length;AH.move("character",AG);AH.select();}else{if(AF.setSelectionRange&&!AE){var AG=AF.value.length;AF.setSelectionRange(AG,AG);}}}catch(AI){}},0);this.isActive=true;},prekeydown:function J(AE){var AG=this.inputNode.value,AF=parseInt(AE.e.keyCode||AE.e.charCode,10),AI=this.parent;if(!AG){return ;}if(AF===AA.TAB||AF===AA.ENTER){if(AF===AA.ENTER){Q.preventDefault(AE.hWin,AE.e);}var AH=AI.getSelected();if(AH&&AH.did){AI.handleSuggestionItemSelect(AH);}else{this.hideSuggestion();if(!AI.acptSugItemOnly){this.setItem(AG,null,false);}else{this.set("text",AG);this.set("text","");}}}else{if(AF===AA.DOWN_ARROW){if(!AI.noCache&&!AI.suggestionShown){this.showSuggestion(AG);AI.preHighlight();}AI.nextHighlight();}else{if(AF===AA.UP_ARROW){AI.preHighlight();}}}},prekeyup:function AB(AE){var AG=this.inputNode.value,AF=parseInt(AE.e.keyCode||AE.e.charCode,10),AJ=this.isAdding,AI=this.parent;if(!AG){if(AJ){if(AF===AA.BACKSPACE&&!this._tWas_){this.raiseEvent({name:"ItemDeletePrev"});Q.preventDefault(AE.hWin,AE.e);}this._tWas_=null;}else{this.raiseEvent({name:"ItemDelete",d:this.data});}this.hideSuggestion();return ;}if(AF===AA.ESCAPE||AF===AA.TAB){this.hideSuggestion();if(AI.acptSugItemOnly){this.set("text",AG);this.set("text","");this._tWas_=null;return ;}}else{if(this._tWas_!==AG){this.textChanged=true;this.raiseEvent({name:"ItemEditing",d:this.data});if(AI.useKeyDelay){window.clearTimeout(this._timerID);var AH=this;this._timerID=window.setTimeout(function(){var AK=AH.inputNode.value;if(AK){AH.showSuggestion(AK);}AH._timerID=null;},U);}else{this.showSuggestion(AG);}}}this._tWas_=AG;},setItem:function(AE,AG,AF){var AH=this.isAdding;AF=AF||false;this.set("text",AE);if(AH){this.setItem_Adding(AE,AG,AF);}else{this.setItem_Editing(AE,AG,AF);}this._tWas_=null;},setItem_Adding:function(AE,AG,AF){this.set("text","");if(!AG){AG={};AG[this.itemField]=AE;}else{AG.state=Z.VALID;}this.raiseEvent({name:"ItemAdd",d:AG,deactivate:AF});},setItem_Editing:function(AE,AG,AF){var AH=this.parent;this.set("text",AE);if(AG){this.updateData(AG);}else{if(this.textChanged){var AI={};AI[b]=this.data[b];delete this.data.did;this.data=AI;this.textChanged=false;}this.set("state",AH.verifyObject(AE,this));this.set("cssClass",AH.item2textCss(this.data));}this.isActive=false;this.raiseEvent({name:"ItemEditEnd",d:AG,deactivate:AF});},getSearchPattern:function W(){return this.inputNode.value;},showSuggestion:function n(AE){var AF=mstrmojo.dom.position(this.domNode,true);this.raiseEvent({name:"SuggestionOn",l:Math.round(AF.x)+"px",t:Math.round(AF.y+AF.h)+"px",pattern:AE,target:this});},hideSuggestion:function f(){this.raiseEvent({name:"SuggestionOff"});},del:function R(AE){AE=AE||self.event;Q.stopPropogation(self,AE);this.raiseEvent({name:"ItemDelete",d:this.data,deactivate:true});if(this.useRichTooltip&&this.hideTooltip){this.hideTooltip();}},edit:function X(){this.set("state",Z.EDITING);this.raiseEvent({name:"ItemEditBegin",d:this.data});if(this.showSuggestionOnEdit){this.showSuggestion(this.text);}},doEllipsize:function d(){if(!this.shouldEllipsize){return ;}var AF=this.maxItemWidth,AE;if(AF){this.domNode.style.maxWidth=AF;switch(parseInt(this.state,10)){case Z.VALID:case Z.UNDETERMINED:case Z.INVALID:AE=this.textNode;break;case Z.EMPTY:AE=this.domNode.firstChild;break;}if(AE){this.set("richTooltip",{content:this.text,contentNodeCssClass:"sp-tooltip",posType:mstrmojo.tooltip.POS_TOPLEFT,left:0,top:30,refNode:this.domNode});mstrmojo.css.addClass(AE,"truncated");}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ME.TokenInputBox");mstrmojo.requiresDescs(13542,13543);var B=mstrmojo.array;var L={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3,AMBIGUITY:4},G={0:"valid",1:"unknown",2:"validating",3:"error",4:"ambiguity"},H={0:mstrmojo.desc(9565,"Valid Metric Formula."),1:mstrmojo.desc(9106,"Require Validation?"),2:mstrmojo.desc(9566,"Validation in Progress..."),3:mstrmojo.desc(9567,"Validation Failed with Syntax Error!"),4:mstrmojo.desc(9568,"Validation Failed with Object Ambiguity!")};function D(O){if(!O){return L.VALID;}return{"-2147214845":L.ERROR,"-2147214846":L.AMBIGUITY}[O]||L.ERROR;}mstrmojo.ME.MetricEditBox=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.MetricEditBox",vStatus:L.VALID,iStatus:"",showStatus:true,browseItemVisible:true,absorbAmbiguity:true,isObjectVisible:function(O){return true;},markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-MEBox-edit"></div><div class="mstrmojo-MEBox-status {@statusCssClass}"><div class="mstrmojo-MEBox-vStatus"></div><div class="mstrmojo-MEBox-iStatus"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},iStatusNode:function(){return this.domNode.lastChild.lastChild;},vStatusNode:function(){return this.domNode.lastChild.firstChild;}},markupMethods:{onvStatusChange:function(){var P=this.vStatus,O=this.vStatusNode;O.className="mstrmojo-MEBox-vStatus "+G[P];O.innerHTML=(this.getStatusDesc&&this.getStatusDesc(P))||H[P]||"";},oniStatusChange:function(){this.iStatusNode.innerHTML=this.iStatus;this.iStatusNode.title=this.iStatus;}},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",renderOnScroll:false,renderBlockSize:0,bindings:{browseItemVisible:"this.parent.browseItemVisible",candidates:"this.parent.candidates"}}],init:function N(O){if(this._super){this._super(O);}this.statusCssClass=this.showStatus?"":"hidden";},getSearchPattern:function M(){return this.inputBox.getSearchPattern();},getHighlightedText:function I(P,O){return this.inputBox.getHighlightedText(P,O);},item2textCss:function F(O){return{4:"m",7:"am",11:"fx",12:"a",13:"fc",43:"tr",47:"cs"}[O.t]||"";},handleSuggestionItemSelect:function E(O){var P=this.abiguityDialog;if(O){P.onItemSelect(O);}P.close();},showDesc:true,showPath:true,abiguityDialog:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-ME-ambiguityDialog",onOpen:function(){this.set("title",mstrmojo.desc(13542,"Object Ambiguity - ##").replace("##",this.ambiguousName));this.list.clearSelect();this.list.set("items",this.items);this.list.singleSelect(0);this.label.set("text",mstrmojo.desc(13543,"More than one object with the name '##' were found.").replace("##",this.ambiguousName));},children:[{scriptClass:"mstrmojo.Label",alias:"label",text:""},{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",alias:"list",cssClass:"mstrmojo-ME-ambiguityList",bindings:{items:"this.parent.opener.suggestionItems"},onclick:function(O){mstrmojo._IsList.onclick.call(this,O);}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:mstrmojo.desc(547,"Select"),onclick:function(){var O=this.parent.parent;O.opener.handleSuggestionItemSelect(O.list.selectedItem);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]},defaultOnTokensModify:function(){this.set("vStatus",L.UNKNOWN);this.set("iStatus","");},postBuildRendering:function A(){this._super();this.inputBox.attachEventListener("tokensModify",this.id,"defaultOnTokensModify");this.inputBox.attachEventListener("tokensModify",this.id,"ontokensModify");},updateInputBoxItems:function K(O){this.inputBox.set("items",O.items);},replaceErrorToken:function C(O){this.inputBox.replaceErrorToken(O);},handleValidation:function J(O){if(!O){this.set("vStatus",L.ERROR);return ;}O.vs=D(O.rjec);this.set("vStatus",O.vs);this.set("iStatus",O.rjed||"");this.updateInputBoxItems(O);this.inputBox.focus();if(O.vs===L.AMBIGUITY){var W=this,T=O.items,S=B.find(T,"sta",-1),P=T[S].v,U=function(X){W.replaceErrorToken(X);W.set("iStatus","");W.set("vStatus",L.UNKNOWN);if(W.continueValidataion){W.continueValidataion();}};var Q=B.filter(O.srfd.items,this.isObjectVisible);var V=this.parent.candidates,R=V&&V.items;if(R){B.forEach(Q,function(Y){var X=B.find(R,"did",Y.did);if(X===-1){if(this.absorbAmbiguity){R.push(Y);}}else{Y.path=R[X].path;}});}if(Q.length===1){U(Q[0]);return ;}this.openPopup("abiguityDialog",{zIndex:100,items:Q,ambiguousName:P,onItemSelect:U});}else{if(this.postHandleValidation){this.postHandleValidation();}}}});mstrmojo.ME.MetricEditBox.VALIDATION_STATUS=L;}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.range","mstrmojo.array","mstrmojo.WidgetListMapper","mstrmojo._HasSuggestion","mstrmojo.qb.FFsqlToken","mstrmojo.warehouse.EnumDataChangeEvents");var n=mstrmojo.dom,K=mstrmojo.array,N=mstrmojo.hash,AP=mstrmojo.Enum_Keys,k=mstrmojo.range,Q=mstrmojo.string,AE=k.EDGE,AR=mstrmojo.qb.FFsqlToken.isDelimiter,AI=67,P=86,AM=88,d=90,AT="\n",m="\t",J=" ",H="c",AX="v",T="x",o="z",AH="a",u=";",x=".",AK="[",l="]",I="addTable",F="addColumn",AC="compositionstart",a="compositionupdate",p="compositionend",AL="DOMCharacterDataModified",e="paste",E=mstrmojo.warehouse.EnumDataChangeEvents;function AS(Aa){var AZ=(n.isIE&&!n.isIE9)?Aa.keyCode:Aa.charCode;return(AZ>0)?String.fromCharCode(AZ):null;}var R,AV=100,c={" ":true,"\t":true,"\n":true},A=["select","update","insert","delete","create","drop","alter","set","exec"],S=A.concat(["from","where","having","in","group","by","order","into","on","values","table","case","then","else","join","as"]),AJ={};S=S.concat(["left","right","full","outer"]);function V(){if(!R){R=[];K.forEach(S,function(AZ){R.push({n:AZ,sta:AV,t:AV});});}return R;}mstrmojo.qb.FFsqlInput=mstrmojo.declare(mstrmojo.ME.TokenInputBox,null,{scriptClass:"mstrmojo.qb.FFsqlInput",renderBlockSize:50000,renderOnScroll:false,init:function q(Aa){this._super(Aa);var Ac={},Ab=this,AZ=Ac[this.id]={};AZ.sqlTokensAdded=this.onsqlTokensAdded;AZ[E.DBROLE_CHANGED]=function Ad(){mstrApp.getRootController().enableButton(Ab.getSQLstmt());};AZ[E.DBTABLES_ENABLED]=function(Ae){if(this.parent.visible){this.editNode.contentEditable=Ae.value?"true":"false";}};mstrApp.getRootController().attachDataChangeListeners(Ac);this.autoSelect=false;this.openPopup("suggestionPopup");this.suggestionPopup.close();this.autoSelect=true;},itemFunction:function AO(Aa,AZ,Ab){return new mstrmojo.qb.FFsqlToken({data:Aa});},item2textCss:function AG(AZ){return" mstrmojo-qb-SuggestIcon t"+AZ.t;},itemIdField:"did",itemCount:0,ostack:[],sqlTokens:V(),browseItemVisible:false,customFunctionVisible:false,raiseChangeEvent:function(Ab){var Aa=Q.trim(this.getSQLstmt()),AZ=mstrApp.getRootController();Ab.name="tokensModify";this.raiseEvent(Ab);AZ.enableButton(Aa);if(!Aa&&AZ.canAddTableSQL(true,Aa)){AZ.enableAvailableTables();}},getSQLstmt:function(){if(!this.items){return"";}var AZ=[];K.forEach(this.items,function(Ab,Aa){AZ[Aa]=Ab.v;});return AZ.join("");},onsqlTokensAdded:function t(AZ){var Ac=AZ.value,Ab=this.itemCount,Aa=this.items;if(Ab>0&&Aa[Ab-1]!==AT){Aa.push({isNew:true,v:AT,isDelimiter:true,did:Ab++});}K.forEach(Ac,function(Ad){Ad=N.copy({isNew:true,did:Ab++},Ad);});Aa=Aa.concat(Ac);this.itemCount=Ab;this.set("items",Aa);this.parent.updatepasses();},postBuildRendering:function AW(){var AZ=this.editNode;if(this._super){this._super();}n.detachEvent(AZ,AC,this.oncompositionstart);n.detachEvent(AZ,a,this.oncompositionupdate);n.detachEvent(AZ,p,this.oncompositionend);if(n.isIE9||n.isIE10||n.isIEW3C){n.detachEvent(AZ,AL,this.ondomcharmodifed);}n.attachEvent(AZ,AC,this.oncompositionstart);n.attachEvent(AZ,a,this.oncompositionupdate);n.attachEvent(AZ,p,this.oncompositionend);if(n.isIE9||n.isIE10||n.isIEW3C){n.attachEvent(AZ,AL,this.ondomcharmodifed);}n.detachEvent(AZ,e,this.onpaste);n.attachEvent(AZ,e,this.onpaste);mstrApp.getRootController().attachEventListener("failureLabel",this.id,function(Aa){this.markFailureLabel(Aa.value);});},handlekeydown:function U(Aj){var Av=this,Ab=Aj.keyCode||Aj.charCode;if(this.editNode.contentEditable==="false"){return true;}if(this._inComposition){return true;}if(Av._inHandleImeInputTimeout&&Ab===AP.ENTER){window.setTimeout(function(){Av.handlekeydown(Aj);},0);n.stopPropogation(window,Aj);n.preventDefault(window,Aj);return false;}Aj=Aj||window.event;var AZ,Ap=false,Ah=k.getRangeInfo(),Aa=Ah.range.startContainer,Ar=Ah.range.startOffset;switch(Ab){case AP.DELETE:if(!this.doubleByte){try{this.widgetHandleDelete(Ah);this.startTokenSuggestion();this.raiseChangeEvent({type:"delete"});this.parent.updatepasses();}catch(Ao){}Ap=true;}break;case AP.BACKSPACE:if(!this.doubleByte){try{this.widgetHandleBackspace(Ah);this.raiseChangeEvent({type:"backspace"});this.startTokenSuggestion();}catch(An){}Ap=true;}break;case AP.ENTER:if(this.suggestionShown){AZ=this.getSelected();if(AZ){this.handleSuggestionItemSelect(AZ);if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}}this.hideSuggestion();}else{var Ad,Ac,Ak,As=this.ctxtBuilder.itemWidgets,Aw,Af={v:AT,isDelimiter:true,isNew:true,did:this.itemCount++},Au={v:J,isDelimiter:true,isNew:true,did:this.itemCount++},At=null;Ac=n.findWidget(Aa);if(Ac.data!==undefined){Ad=k.getEdgeInfo(Aa,Ar);Ak=this.itemIndex(Ac.data);Aw=As[Ak].data.v===AT;}else{Ad=AE.EDGE_END;Ak=-1;Aw=false;}if(n.isFF){At=this.itemsContainerNode.scrollTop;}if(Ad===AE.EDGE_MIDDLE){var Ai=Ac.split2Tokens(Ah.startOffset,this.itemCount++);this.remove(Ak);this.add([Ai[0],Af,Ai[1]],Ak);Ak=Ak+1;}else{if(Ad===AE.EDGE_BEGIN){this.add([Af],Ak);}else{Ak=Ak+1;if((n.isFF||n.isIE||n.isIEW3C)&&Aw){this.add([Au,Af],Ak);}else{this.add([Af,Au],Ak);}}}if(n.isFF||n.isIE||n.isIEW3C){Ak=Aw?Ak:Ak+1;Ac=As[Ak];this._delaySetCaretPos(Ac.domNode,true);}else{Ac=As[Ak];this._delaySetCaretPos(Ac.domNode,false);}this.delayedScrollToItem(Ak,At);this.parent.updatepasses();}Ap=true;break;case AP.TAB:if(this.suggestionShown){AZ=this.getSelected();if(AZ){this.handleSuggestionItemSelect(AZ);if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}}}else{this.startTokenSuggestion();}Ap=true;break;case AP.ESCAPE:this.endTokenSuggestion();Ap=true;break;case AI:if(Aj.ctrlKey||Aj.metaKey){this.ctrx=false;Ap=false;}break;case P:if(Aj.ctrlKey||Aj.metaKey){this._saveRangeInfo=k.getRangeInfo();if(!this._saveRangeInfo.collapsed){this.widgetDeleteTokens(this._saveRangeInfo);this._saveRangeInfo=k.getRangeInfo();}if(this.ctrx){this.handlepaste(this.cutstr);Ap=true;}else{this.clipboardNode.focus();Ap=false;}this.parent.updatepasses();}break;case AM:if(Aj.ctrlKey||Aj.metaKey){try{var Ag=document.createElement("div");Ag.appendChild(Ah.range.cloneContents());Ag.innerHTML=Ag.innerHTML.replace(/<br\>/gi,"\n");this.cutstr=Ag.textContent.replace(/\u00A0/gi," ");this.widgetHandleDelete(Ah);this.startTokenSuggestion();this.ctrx=true;this.raiseChangeEvent({type:"cut"});}catch(Am){}Ap=true;}break;case d:if(Aj.ctrlKey||Aj.metaKey){try{var Ae=this.ostack,Aq=Ae.length;if(Aq>1){Ae.pop();this.set("items",Ae[Aq-2].its);this.parent.updatepasses();this.focus();this.raiseChangeEvent({type:"undo"});}}catch(Al){}Ap=true;}break;case AP.LEFT_ARROW:case AP.RIGHT_ARROW:this.endTokenSuggestion(true);break;case 229:if(!this.doubleByte){this.doubleByte=true;this.prev_rInfo=Ah;this.prev_items=this.items;}break;}if(Ap){n.stopPropogation(window,Aj);n.preventDefault(window,Aj);return false;}return true;},handlekeypress:function L(AZ){if(this.editNode.contentEditable==="false"){return true;}if(this._inComposition){return true;}AZ=AZ||window.event;var Ad=AS(AZ),Aa=false,Ab=this,Ac;function Ae(){try{this.widgetHandleInput(k.getRangeInfo(),Ad);this.raiseChangeEvent({type:"input",characeter:Ad});var Af=this._saveActiveToken;if(!AR(Ad)){if(!Af){Ac=this.findObjectToken();if(Ac&&!Ac.isDelimiter()){this._saveActiveToken=Af=Ac;}}if(Af&&Ad===x){var Ah=AJ[Af.data.v.toLowerCase().slice(0,-1)];if(Ah){if(Ah.columns){this.startTokenSuggestion();}else{var Ai=this;mstrApp.getRootController().getColumnsForDBTable({data:Ah},{success:function Aj(Am){var Al=Am.items,Ak=[],An=Af.data.v;Ah.columns=Al;K.forEach(Al,function(Ao){Ak.push({n:An+Ao.n,sta:2,t:26});});Ai.set("candidates",{items:Ai.candidates.items.concat(Ak),isComplete:true});Ai.startTokenSuggestion();}});}}else{Af.isCol=false;Af.col=null;this.startTokenSuggestion();}}else{this.startTokenSuggestion();}}else{this.endTokenSuggestion(true);}}catch(Ag){}}if(Ad&&!((Ad===H||Ad===T||Ad===AX||Ad===o||Ad===AH)&&AZ.ctrlKey)){if(Ab._inHandleImeInputTimeout||(n.isIE||n.isIEW3C)){if(Ab._inHandleImeInputTimeout&&(n.isIE9||n.isIE10||n.isIEW3C)&&Ad===" "){}else{window.setTimeout(function(){Ae.call(Ab);},1);}}else{Ae.call(Ab);}Aa=true;}if(Aa){n.stopPropogation(window,AZ);n.preventDefault(window,AZ);return false;}return true;},handlekeyup:function M(Ab){var Ac,AZ,Aa;if(this.doubleByte&&!this._inComposition){Ac=this.prev_rInfo;AZ=k.getRangeInfo();Aa=AZ.startContainer.data.slice(Ac.startOffset,AZ.startOffset);if(Aa){this.widgetHandleImeInput(Ac,Aa);}this.doubleByte=false;}else{if(this._super){this._super(Ab);}}},oncompositionstart:function Y(AZ){var Aa=n.findWidget(this);Aa._inComposition=true;Aa.doubleByte=true;Aa._savedCompositionData=null;if(!Aa._compositionDataArr){Aa.prev_rInfo=k.getRangeInfo();Aa.prev_items=Aa.items;Aa._compositionDataArr=[];Aa._savedCompositionData=null;Aa._beforeCompositionDOMChars=null;Aa._hasBeforeCompositionDOMChars=false;Aa._compositionDOMChars=null;}},oncompositionupdate:function AY(AZ){var Aa=n.findWidget(this);if(Aa._inComposition){Aa._savedCompositionData=AZ.data;}},ondomcharmodifed:function Z(AZ){var Ad=n.findWidget(this),Ac=AZ.newValue,Ab=AZ.prevValue,Aa;if(Ad._inComposition){if(Ad._savedCompositionData===null){Ad._beforeCompositionDOMChars=Ab;Ad._hasBeforeCompositionDOMChars=true;}else{Ad._compositionDOMChars=Ac;}if(n.isIEW3C&&!Ad._hasBeforeCompositionDOMChars){Aa=Ac.length<=Ab.length?Ac:Ab;Ad._beforeCompositionDOMChars=Aa;Ad._hasBeforeCompositionDOMChars=true;}}},oncompositionend:function G(AZ){var Ac=n.findWidget(this),Aa=Ac.prev_rInfo,Ad=Aa.range.startOffset,Ae,Ab;Ac._inComposition=false;Ac.doubleByte=false;Ab=AZ.data||Ac._savedCompositionData;if(Ab!==null&&Ab!==undefined){Ac._compositionDataArr.push(Ab);}if(n.isIE9||n.isIE10||n.isIEW3C){if(Ac._compositionDOMChars&&Ac._compositionDOMChars.length){if(Ac._beforeCompositionDOMChars!==null){Ae=Ac._compositionDOMChars.substr(Math.min(Ad,Ac._beforeCompositionDOMChars.length),Ac._compositionDOMChars.length-Ac._beforeCompositionDOMChars.length);}else{Ae=Ac._compositionDOMChars;}if(Ae.length){Ac._compositionDataArr=Ae.split("");}}}if(Ac._compositionDataArr.length){Ac._inHandleImeInputTimeout=true;window.setTimeout(function(){Ac._inHandleImeInputTimeout=false;if(!Ac._inComposition&&Ac._compositionDataArr){if(n.findWidget(Aa.startContainer.parentNode?Aa.startContainer:Aa.range.startContainer)){Ab=Ac._compositionDataArr.join("");Ac._compositionDataArr=null;Ac.widgetHandleImeInput(Aa,Ab);Ac.raiseChangeEvent({type:"insert"});}}},0);}},markFailureLabel:function AN(AZ){this.pnum=AZ;this.parent.updatepasses();},getPassLabelYCoords:function W(){var Ab=[],Aa=this.ctxtBuilder.itemWidgets,Ae=true,AZ=n.position(this.domNode).y,Ad,Ac;K.forEach(Aa,function(Af){Ad=Af.data;Ac=Ad.v;if(Ae&&!c[Ac]){if(Ac&&K.indexOf(A,Ac.toString().toLowerCase())>-1){Ab.push(n.position(Af.domNode).y-AZ);}Ae=false;}else{if(Ac===u){Ae=true;}}});if(Ab.length===1){Ab=[];}return Ab;},widgetHandleBackspace:function z(Ae){if(Ae.collapsed){var Aa=this._saveActiveToken,Ab,Ag;if(Aa&&Aa.data){Ag=Aa.data.v;if(Ag&&Ag[Ag.length-1]===x&&Aa.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});Aa.isCol=false;Aa.col=null;}}var AZ,Ad,Ah,Af=Ae.startOffset,Ac=this.ctxtBuilder.itemWidgets;if(!n.contains(this.editNode,Ae.startContainer,false,document.body)){if(Ae.startOffset>0&&n.isFF){Ad=Ac[this.items.length-1];k.collapseOnNode(Ad.domNode,false);Ae=k.getRangeInfo();AZ=k.getEdgeInfo(Ae.range.startContainer,Ae.range.startOffset);}else{k.collapseOnNode(this.editNode,true);return ;}}AZ=k.getEdgeInfo(Ae.range.startContainer,Ae.range.startOffset);Ad=n.findWidget(Ae.range.startContainer);Ah=this.itemIndex(Ad.data);if(AZ===AE.EDGE_BEGIN){Ah--;Ad=Ac[Ah];Af=Ad.length();}if(!Ad){k.collapseOnNode(this.editNode,true);return ;}if(Ad.length()<=1){this.remove(Ah);if(Ad.data.v===u||Ad.data.v===AT){this.parent.updatepasses();}Ad=Ac[Ah-1];if(Ad){k.collapseOnNode(Ad.domNode,false);this.checkMergeTwoTokens(Ah-1,Ah);Ad=Ac[Ah-1];}else{k.collapseOnNode(this.editNode,true);}}else{Ad.spliceContent(Af-1,1);if(Ad.isCol){this.set("candidates",{items:Ad.col,isComplete:true,isCol:true});}k.collapseOnTextNode(Ad.domNode,Af-1);}}else{this.widgetDeleteTokens(Ae);this.parent.updatepasses();}},onpaste:function AF(AZ){var Ab=n.findWidget(this),Ac,Aa;if(!Ab){return ;}if(AZ&&AZ.clipboardData&&AZ.clipboardData.getData){Ac=AZ.clipboardData.getData("text/plain");}else{if(window.clipboardData&&window.clipboardData.getData){Ac=window.clipboardData.getData("Text");}}if(typeof Ac!=="string"){return ;}Aa=Ac.replace(/\r/g,"");if(Aa===""){return ;}Ab.handlepaste(Aa);n.stopPropogation(window,AZ);n.preventDefault(window,AZ);return false;},handlepaste:function h(Aa){var Ab;if(typeof Aa!=="string"){Ab=this.clipboardNode.value;}else{Ab=Aa;}this.clipboardNode.value="";var Af=[],AZ=Ab&&Ab.length,Ac,Ad="",Ae;if(AZ>0){for(Ac=0;Ac<AZ;Ac++){Ae=Ab.charAt(Ac);if(AR(Ae)){if(!Q.isEmpty(Ad)){Af.push({v:Ad,isNew:true,did:this.itemCount++});Ad="";}Af.push({v:Ae,isDelimiter:true,isNew:true,did:this.itemCount++});}else{Ad=Ad+Ae;}}if(!Q.isEmpty(Ad)){Af.push({v:Ad,isNew:true,did:this.itemCount++});}this.insertTokens(Af);}},insertTokens:function f(Af){var Ae=this._saveRangeInfo,Ab,Ad,Ac,AZ;if(!Ae||!n.contains(this.editNode,Ae.startContainer,false,document.body)){this.add(Af);Ab=this.ctxtBuilder.itemWidgets;AZ=Ab.length-1;Ad=Ab[AZ];this._delaySetCaretPos(Ad.domNode,false);this.delayedScrollToItem(AZ);this.raiseChangeEvent({type:"insert"});return ;}Ac=k.getEdgeInfo(Ae.startContainer,Ae.startOffset);Ad=n.findWidget(Ae.startContainer);AZ=this.itemIndex(Ad.data);if(Ac===AE.EDGE_MIDDLE){var Aa=Ad.split2Tokens(Ae.startOffset,this.itemCount++);this.remove(AZ);Af.unshift(Aa[0]);Af.push(Aa[1]);this.add(Af,AZ);}else{AZ=(Ac===AE.EDGE_BEGIN?AZ:AZ+1);this.add(Af,AZ);}AZ=AZ+Af.length-1;Ad=this.ctxtBuilder.itemWidgets[AZ];this._delaySetCaretPos(Ad.domNode,false);this.delayedScrollToItem(AZ);this.raiseChangeEvent({type:"insert"});},widgetHandleInput:function AB(Ah,Af){if(!Ah.collapsed){this.widgetDeleteTokens(Ah);Ah=k.getRangeInfo();}var Aa,Ae,Am,Ab,Ai,Aj,Ad=this.ctxtBuilder.itemWidgets,Al=this,Ak=Ah.startContainer,AZ=Ah.startOffset,Ac;if(!n.contains(this.editNode,Ak,false,document.body)||!Ad||Ad.length===0){this.add([{v:Af,isDelimiter:AR(Af),isNew:true,did:this.itemCount++}],0);Ae=Ad[0];k.collapseOnTextNode(Ae.domNode,1);this.delayedScrollToItem(0);return ;}Aa=k.getEdgeInfo(Ak,AZ);Ae=n.findWidget(Ak);Am=this.itemIndex(Ae.data);if(AR(Af)){if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}Ab={v:Af,isDelimiter:true,isNew:true,did:this.itemCount++};if(Aa===AE.EDGE_MIDDLE){var Ag=Ae.split2Tokens(AZ,this.itemCount++);this.remove(Am);this.add([Ag[0],Ab,Ag[1]],Am);Am=Am+1;}else{Am=(Aa===AE.EDGE_BEGIN)?Am:Am+1;this.add([Ab],Am);}Ae=Ad[Am];k.collapseOnNode(Ae.domNode,false);this._delaySetCaretPos(Ae.domNode,false);if(Af===u){this.parent.updatepasses();}}else{Aj=AZ;if(Ae.isDelimiter()){Ai=Ad[(Aa===AE.EDGE_BEGIN)?Am-1:Am+1];if(Ai&&!Ai.isDelimiter()){Ae=Ai;Aj=(Aa===AE.EDGE_BEGIN)?Ae.length():0;}Am=(Aa===AE.EDGE_BEGIN)?Am:Am+1;this.add([{v:Af,isNew:true,did:this.itemCount++}],Am);Ae=Ad[Am];k.collapseOnNode(Ae.domNode,false);this.parent.updatepasses();}else{Ac=Ae.data.v;Ah=k.getRangeInfo();Ae.spliceContent(Aj,0,Af);if(n.isIE||n.isIEW3C){k.collapseOnTextNodeIE(Ae.domNode,Aj+1);window.setTimeout(function(){Al.editNode.focus();Al.editNode.focus();k.collapseOnTextNodeIE(Ae.domNode,Aj+1);},0);}else{k.collapseOnTextNode(Ae.domNode,Aj+1);this._delaySetTextCaretPos(Ae.domNode,Aj+1);}}}this.delayedScrollToItem(Am);},widgetHandleImeInput:function X(Ag,AZ){if(!Ag.collapsed){this.widgetDeleteTokens(Ag);Ag=k.getRangeInfo();}var Ab,Ae,Al,Ah,Ai,Ad=this.ctxtBuilder.itemWidgets,Ak=this,Af,Aj=Ag.range.startContainer,Aa=Ag.range.startOffset,Ac=this.itemsContainerNode.scrollTop;if(!n.contains(this.editNode,Aj,false,document.body)||!Ad||Ad.length===0){this.clearTokens();this.add([{v:AZ,isDelimiter:this.isDelimiter(AZ),isNew:true,did:this.itemCount++,isIME:true}],0);Ad=this.ctxtBuilder.itemWidgets;Ae=Ad[0];k.collapseOnTextNode(Ae.domNode,Ae.data.v.length||1);this._delaySetCaretPos(Ae.domNode,false);this.delayedScrollToItem(0,Ac);return ;}Ab=k.getEdgeInfo(Aj,Aa);Ae=n.findWidget(Aj);Al=this.itemIndex(Ae.data);Ai=Aa;if(Ae.isDelimiter()){this.clearTokens();this.set("items",this.prev_items);Ad=this.ctxtBuilder.itemWidgets;Af=(Ab===AE.EDGE_BEGIN)?Al-1:Al+1;Ah=Ad[Af];if(Ah&&!Ah.isDelimiter()){Ae=Ah;Ai=(Ab===AE.EDGE_BEGIN)?Ae.length():0;Al=Af;}}if(!Ae.isDelimiter()){Ae.spliceContent(Ai,0,AZ);if(n.isIE||n.isIEW3C){k.collapseOnTextNodeIE(Ae.domNode,Ai+AZ.length);window.setTimeout(function(){Ak.editNode.focus();Ak.editNode.focus();k.collapseOnTextNodeIE(Ae.domNode,Ai+AZ.length);},0);}else{k.collapseOnTextNode(Ae.domNode,Ai+AZ.length);this._delaySetTextCaretPos(Ae.domNode,Ai+AZ.length);}}else{Al=(Ab===AE.EDGE_BEGIN)?Al:Al+1;this.add([{v:AZ,isNew:true,did:this.itemCount++}],Al);Ae=Ad[Al];k.collapseOnNode(Ae.domNode,false);this._delaySetCaretPos(Ae.domNode,false);}this.delayedScrollToItem(Al,Ac);this.startTokenSuggestion();return Ae;},getSearchPattern:function AA(){var Aa=this._saveActiveToken,Ac,AZ;if(Aa.isCol){var Ab=Aa.data.v;Ac=Ab.slice(Ab.lastIndexOf(x)+1,Ab.length);}else{Ac=Aa&&Aa.data.v;}AZ=Ac&&Ac.length;if(AZ>2){if(Ac.charAt(0)===AK){Ac=Ac.substring(1);}if(Ac.charAt(Ac.length-1)===l){Ac=Ac.substring(0,Ac.length-1);}}return Ac;},getSuggestionPos:function AQ(){var Ah=this._saveActiveToken,Ad=null,Ab,Af=0;if(Ah&&Ah.isCol){Af=Ah.domNode.offsetWidth;}if(Ah){Ab=n.position(Ah.domNode,true);var Ai=Math.round(Ab.y+Ab.h),Ae=this.suggestionItems.length*19,Ag=mstrmojo.all.QBuilderPage,AZ=parseInt(Ag.height,10),Aa=n.position(Ag.domNode,true),Ac=(AZ>Ai-40-Aa.y+Ae)?Ai:Ab.y-Ae;Ad={left:Math.round(Ab.x)+Af+"px",top:Ac+"px",zIndex:100};}return Ad;},onSuggestionItemSelect:function AD(Ab){var Aa=this._saveActiveToken,Ac,Ae=this;this.endTokenSuggestion();if(Ab.t===-98){Ac=this.items;this.clearTokens();K.forEach(Ac,function(Ah){Ah.did=Ae.itemCount++;});this.customFunctionMode=true;Ac=[{v:"{",isDelimiter:true,sta:1,isNew:true,did:this.itemCount++}].concat(Ac).concat([{v:"}",isDelimiter:true,sta:1,isNew:true,did:this.itemCount++}]);this.set("items",Ac);var AZ=this.itemIndex({did:this.itemCount-1}),Ag=this.ctxtBuilder.itemWidgets[AZ-1];this._delaySetCaretPos(Ag.domNode,false);}else{if(Aa){if(Aa.isCol){var Ad=Aa.data.v,Af={};N.copy(Ab,Af);Af.n=Ad.slice(0,Ad.lastIndexOf(x)+1)+Ab.n;Aa.setItemInfo(Af);}else{Aa.setItemInfo(Ab);}this._delaySetCaretPos(Aa.domNode,false);}}},ontokensModify:function(AZ){this.ostack.push({its:N.cloneArray(this.items)});this.pnum=-1;this.parent.updatepasses();},dropZone:true,allowDrop:function B(AZ){return(AZ.action===I||AZ.action===F);},getAvatarIconClass:function C(AZ){return"enabled";},ondragenter:function D(AZ){var Aa=AZ.src.widget;if(Aa&&Aa.toggleAvatarClass&&this.allowDrop(AZ)){Aa.toggleAvatarClass(this.getAvatarIconClass(AZ),true);}},ondragleave:function b(AZ){var Aa=AZ.src.widget;if(Aa&&Aa.toggleAvatarClass&&this.allowDrop(AZ)){Aa.toggleAvatarClass(this.getAvatarIconClass(AZ),false);}},ondragover:function j(Ae){var Ab=Ae.tgt.widget,Aj=Ae.tgt.pos.x,Ai=Ae.tgt.pos.y;var Ag=Ab.ctxtBuilder.itemWidgets,Ad=Ag.length;if(Ad===0){return ;}var Ac=Ag[Ad-1].domNode,Af=n.position(Ac),Aa;if(Ai>Af.y+Ac.clientHeight){Ab._delaySetCaretPos(Ac,false);}else{for(Aa=Ad-1;Aa>-1;Aa--){if(Ag[Aa].data.v===AT||Ag[Aa].data.v===m){continue;}var Ah=Ag[Aa].domNode,AZ=n.position(Ah).y;if(AZ<Ai&&!(AZ+14<Ai)){Ab._delaySetCaretPos(Ah,false);break;}}}},ondrop:function(Aa){var Ad=Aa.action,Ag=Aa.src,AZ=mstrApp.getRootController(),Ac=this;if(Ag&&Ag.data){var Af=Ag.data;if(Ad===I){var Ae=Ag.widget.dataHelper;if(!AZ.canAddTableSQL()){return ;}K.forEach(Af,function(Ai){Ae.fetch(Ai,{success:function Ah(Aj){AZ.addTableSQL(Ai,Aj.items);AZ.enableButton(Ac.getSQLstmt());}});});}else{if(Ad===F){if(!AZ.canAddTableSQL()){return ;}var Ab=Ag.widget.items[parseInt(Af._renderIdx.split(":")[0],10)];AZ.addTableSQL(Ab,[Af]);AZ.enableButton(Ac.getSQLstmt());}}}},onscroll:function(AZ){if(n.isIE8){editNode=AZ.srcElement;}if(this.parentNode){mstrmojo.all[this.parentNode.id].parent.updatepasses();}},onRender:function O(){if(this.hasRendered){n.attachEvent(this.editNode,"scroll",this.onscroll);this.itemsContainerNode.style.height="100%";}},addCandidateTables:function AU(AZ){var Aa=[],Ab,Ac=AZ.value;AJ={};K.forEach(Ac,function(Ad){Ab=Ad.ns?Ad.ns+x+Ad.n:Ad.n;Aa.push({n:Ab,sta:2,t:15});AJ[Ab.toLowerCase()]=Ad;});this.set("candidates",{items:this.sqlTokens.concat(Aa).concat(mstrApp.getRootController().getSuggestionItems(true)),isComplete:true});},scrollToItem:function g(Af,Ab){var AZ=this.itemsContainerNode,Ad=AZ.childNodes[Af],Ae,Aa,Ac=AZ.clientHeight,Ag;if(typeof Ab!=="number"){Ab=AZ.scrollTop;}Aa=Ab;if(!Ad){return ;}Ag=Ad.offsetHeight;Ae=Ad.offsetTop;if(Ae<Ab){Aa=Ae;}else{if(Ab+Ac<Ae+Ag){Aa=Math.min(Ae,Ae+Ag-Ac);}}AZ.scrollTop=Aa;},delayedScrollToItem:function w(Ab,AZ){var Aa=this;if(typeof AZ!=="number"){AZ=this.itemsContainerNode.scrollTop;}window.setTimeout(function(){Aa.scrollToItem(Ab,AZ);},0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.tabs.Tab","mstrmojo.dom","mstrmojo.css");var G=mstrmojo.dom,R=mstrmojo.array,d=mstrmojo.css,c="animate",W="31px";function X(){var j=window.Modernizr,h="transition";if(j.testProp(h)){return G.transEndEvtNames[j.prefixed(h)];}return null;}function D(h){return function(){this.menuNode.style.display=h?"block":"none";};}function I(h){return Math.min(h.offsetWidth-h.firstChild.offsetWidth,0);}function S(h){return h.isAlignRight?"right":"left";}function e(h,j){return parseInt(h.style[S(j)],10)||0;}function O(){var j=this.tabContainerNode,k=false,h=false;if(I(j)<0){var m=G.position(j),l=G.position(j.firstChild);k=(l.x<m.x);h=(l.x+l.w>m.x+m.w+0.1);}this.downBtnNode.style.display=k?"block":"none";this.upBtnNode.style.display=h?"block":"none";}function T(h,j){h=(h||[]);if(!h.filter){return R.filter(h,j);}return h.filter(j);}function Q(h,j){h=(h||[]);if(!h.map){return R.map(h,j);}return h.map(j);}function J(AB,k){if(this.isStatic){return ;}var z=this.tabContainerNode,x=T(this.children,function(AC){return AC.isSelected;})[0],t=x&&x.domNode;if(!z||!t){return ;}var l=G.position(z),p=z.firstChild,AA=I(z),m=e(p,this),j=Math.max(m,AA);if(AB){if(AA<0){var o=G.position(t),q=o.x-l.x,w=o.x+o.w-(l.x+l.w),u=this.isAlignRight,h=function(AC){j=u?j+AC:j-AC;};if(q<0){h(q);}else{if(w>0){h(w);}}}}if(j!==m){var n=X();if(k&&n){d.addClass(p,c);G.attachOneTimeEvent(p,n,function(){d.removeClass(p,c);});}p.style[S(this)]=Math.max(AA,Math.min(j,0))+"px";}O.call(this);}function K(h){return h.hasOwnProperty("index");}function H(){var h=this.children,j=0;(h||[]).every(function(l,k){if(!K(l)){return false;}j++;l.index=k;return true;});(h||[]).every(function(k){if(!K(k)){return false;}k.total=j;return true;});}function B(m,j){var q=m.ENUM_CORNERS,n=[q.TOP_RIGHT,q.BOTTOM_RIGHT],o=this.parent;if(o.position!=="bottom"){n.reverse();}m.setAlignment(n[0],n[1]);var l=G.position(o.domNode),h=G.position(j),k=o.menuNode;var p=k.style;p.top=(h.y-l.y)+"px";p.left=(h.x-l.x)+"px";m.addPopupHandlers(o.id,D(true),D(false));m.hostId=o.id;m.hostElement=k;m.isHostedWithin=false;o.openPopup(m.newInstance());}function Y(h){h.raiseEvent({name:"TabsChange"});}mstrmojo.vi.ui.tabs.TabStrip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",markupString:'<div id="{@id}" class="mstrmojo-VITabStrip {@cssClass}" style="{@cssText}" ><div class="mstrmojo-VITabStrip-tabs"><div style="display:table"><div style="display:table-row"></div></div></div><div class="mstrmojo-VITabStrip-addBtn" mstrAttach:click><div></div></div><div class="mstrmojo-VITabStrip-downBtn" mstrAttach:click,mousedown><div></div></div><div class="mstrmojo-VITabStrip-upBtn" mstrAttach:click,mousedown><div></div></div><div class="mstrmojo-VITabStrip-menuHost"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{tabContainerNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.firstChild.firstChild.firstChild;},addBtnNode:function(){return this.domNode.childNodes[1];},addBtnImgNode:function(){return this.domNode.childNodes[1].firstChild;},downBtnNode:function(){return this.domNode.childNodes[2];},upBtnNode:function(){return this.domNode.childNodes[3];},menuNode:function(){return this.domNode.childNodes[4];},maskNode:function(){return this.domNode.lastChild;}},isStatic:false,isAlignRight:true,tabContainerNode:null,downBtnNode:null,upBtnNode:null,menuNode:null,position:"bottom",layoutConfig:{w:{tabContainerNode:"100%",addBtnNode:W},xt:true},onAppStateChange:function V(j){var h=mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;if(j.value===h||j.valueWas===h){this.layoutConfig.w.addBtnNode=mstrApp.appState===h?"0px":W;this.doLayout();}},setStatic:function U(h,j){this.isStatic=h;if(!h){J.call(this,true,j);}},setTabs:function C(k,h){this.removeChildren();var l=this,j=k.length;this.addChildren(Q(k,function(o,m){var n=o.k;return l.getTabCfg(k,o,{scriptClass:"mstrmojo.vi.ui.tabs.Tab",index:m,total:j,draggable:!!j,dropZone:!!j,k:n,isSelected:n===h,showTabMenu:B,tabMoved:function(q){var p=this.index;this.parent.moveTab(p,p+(q?-1:1),p);}});}));J.call(this,true);Y(this);},getTabs:function N(){return T(this.children,K);},getTabCfg:function F(j,k,h){return h;},deleteTab:function P(h){var o=this.id,n=this.children[h],m=X(),l=function(){var p=mstrmojo.all[o];p.removeChildren(n);n.destroy();H.call(p);O.call(p);Y(p);};if(m){var k=n.domNode.firstChild,j=k.style;j.width=k.offsetWidth+"px";window.setTimeout(function(){d.addClass(k,c);G.attachOneTimeEvent(k,m,l);j.width=0;},0);}else{l();}},buildRendering:function E(){this._super();d.toggleClass(this.domNode,"alignLeft",!this.isAlignRight);},postBuildRendering:function Z(){var h=this._super();J.call(this,true);return h;},doLayout:function A(){this._super();J.call(this);},setSelectedTab:function b(h){(this.children||[]).forEach(function(j){j.set("isSelected",j.k===h);});Y(this);},getSelectedTab:function M(){var k=null,j=this.children||[],h;for(h=0;h<j.length;h++){if(j[h].isSelected){k=j[h];break;}}return k;},onclick:function g(h){if(h.getTarget()===this.addBtnImgNode){this.addTab();}},addTab:mstrmojo.emptyFn,onmousedown:function f(w){var p=w.getTarget().parentNode,x=(p===this.downBtnNode);if(x||p===this.upBtnNode){var u=this.tabContainerNode,o=u.firstChild,j=I(u),l=e(o,this),n=this.isAlignRight?(x?-10:10):(x?10:-10),k=this.id,q=this,m;if(mstrApp.setInteractive){mstrApp.setInteractive(false);}d.addClass(p,"active");var t=function(){window.clearInterval(m);d.removeClass(p,"active");O.call(mstrmojo.all[k]);if(mstrApp.setInteractive){mstrApp.setInteractive(true);}};G.attachOneTimeEvent(document.body,"mouseup",t);m=window.setInterval(function(){l=Math.min(Math.max(j,l+n),0);o.style[S(q)]=l+"px";if(l===j||l===0){t();}},33);}},moveTab:function L(h,q,o,n){var j=this.children,t=j.splice(h,1)[0];j.splice(q,0,t);H.call(this);var k=this.containerNode,l=k.childNodes,p=k.removeChild(l[h]),m=l[q];if(m){k.insertBefore(p,m);}else{k.appendChild(p);}if(t.isSelected){J.call(this,true,true);}if(!n&&o!==undefined&&o!==q){this.commitTabMove(o,q);Y(this);}},commitTabMove:function a(h,j){throw new Error(this.scriptClass+" must implement commitTabMove.");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineMenu","mstrmojo.InlineEditBox");var A=mstrmojo.dom;var B=0;var C=mstrmojo.DI.DIHelpers;mstrmojo.Refine.RefineDataHeader=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.RefineDataHeader",text:"",markupString:'<div id="{@id}" class="refine-data-header {@cssClass}" style="{@cssText}" mstrAttach:mousedown><div class="refine-data-header-text"></div><div class="refine-data-header-menu"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{textNode:function(){return this.domNode.children[0];},menuNode:function(){return this.domNode.children[1];}},onmousedown:function(D){this.preview.controller.model.raiseEvent({name:"columnSelected",columnIndex:this.columnIndex,columnName:this.text,isCtrlKey:C.isCtrlKey(D.hWin,D.e)});this.preview.controller.isClickedInDatePreview=true;this.preview.controller.resetRecords();},children:[{slot:"textNode",alias:"inlineEdit",scriptClass:"mstrmojo.InlineEditBox",markupString:'<div id="{@id}" class="mstrmojo-InlineEditBox {@cssClass}" style="{@cssText}" mstrAttach:mousedown,dblclick><div class="mstrmojo-InlineEditBox-text"></div><div class="mstrmojo-InlineEditBox-edit"><input type="text" class="mstrmojo-InlineEditBox-input" mstrAttach:keyup/><img class="mstrmojo-InlineEditBox-ok" src="../images/1ptrans.gif" title="Save"/><img class="mstrmojo-InlineEditBox-cancel" src="../images/1ptrans.gif" title="Cancel"/></div><div class="mstrmojo-InlineEditBox-overlay"></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},inputNode:function(){return this.domNode.childNodes[1].firstChild;},okNode:function(){return this.domNode.childNodes[1].childNodes[1];},cancelNode:function(){return this.domNode.childNodes[1].lastChild;},overlayNode:function(){return this.domNode.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text||"",null,true);this.textNode.title=this.text;},oneditModeChange:function(){var J=this.editMode,G=this.domNode,E=this.textNode,F=this.overlayNode,I=this.editNode;mstrmojo.css.toggleClass(G,["edit"],J);if(J){E.style.display="none";I.style.display="block";F.style.display="block";E=this.inputNode;var H=E.style;E.value=this.text||"";H.width=(this.nodeWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";H.height=this.nodeHeight+"px";E.select();E.focus();if(E.createTextRange){var K=E.createTextRange(),D=E.value.length;K.move("character",D);K.select();}}else{E.style.display="block";I.style.display="none";F.style.display="none";}},onokSaveChange:function(){var D=this.okSave?"inline":"none";this.okNode.style.display=D;this.cancelNode.style.display=D;},onallowEditChange:function(){mstrmojo.css.toggleClass(this.domNode,["disable"],!this.allowEdit);}},bindings:{text:"this.parent.text"},ondblclick:function(){this.nodeWidth=this.domNode.clientWidth;this.nodeHeight=this.domNode.clientHeight;this.set("editMode",this.allowEdit);},onmousedown:function(D){var F=D.e,E=A.eventTarget(D.hWin,F);if(E===this.okNode){this.save();}else{if(E===this.cancelNode){this.cancel();}}},save:function(){this.oldColumn=this.text;this.newColumn=this.inputNode.value;this.set("editMode",false);if(this.oldColumn===this.newColumn){return ;}if(this.onSave){this.onSave();}},onSave:function(){this.handleRename();},handleRename:function(){var D=this.parent.preview.controller;var G=D.model;var H=this.oldColumn;var I=this.newColumn;var F=[],E;E=JSON.parse(JSON.stringify(G.transformations.Other.Rename));E.description=E.description.replace("####",H);E.description=E.description.replace("@@@@",I);E.oldColumnName=H;E.newColumnName=I;F.push(E);D.applyOperations({operations:JSON.stringify(F),engine:JSON.stringify({facets:[],mode:"row-based"})});},handleDelete:function(){var E=this.parent.preview.controller;var H=E.model;var D=this.text;var G=[],F;F=JSON.parse(JSON.stringify(H.transformations.Delete.Colomn));F.description=F.description.replace("[column name]",D);F.columnName=D;G.push(F);E.applyOperations({operations:JSON.stringify(G),engine:JSON.stringify({facets:[],mode:"row-based"})});},_attachEvents:function(){var D=this;if(this.editMode){if(!this._save_handler){this._save_handler=function(){var E=A.eventTarget(self,arguments[0]);if(E===D.overlayNode){D.save();}};}A.attachEvent(document.body,"mousedown",this._save_handler);}else{if(this._save_handler){A.detachEvent(document.body,"mousedown",this._save_handler);}}}},{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var G=this.parent;var E=mstrmojo.Refine.RefineDataHeader;var F=E.menuHelper=E.menuHelper||new mstrmojo.Refine.RefineMenu();F.target=G;F.data=[G.data];F.type=B;var D=F.getMenuConfig();D.hostId=G.id;D.hostElement=this.domNode;D.isHostedWithin=false;D.position=A.position(this.domNode,true);G.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:D}));},bindings:{visible:function(){return(!this.parent.suggestionPreview);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.Refine.HistogramWidget","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Refine.SliderWidget");mstrmojo.requiresDescs(1395,12353,2797,96,1905,8445,13687);var A=mstrmojo.dom;var B={scriptClass:"mstrmojo.Widget",count:null,label:null,checked:null,markupString:'<div class="facet-range-item" mstrAttach:click><input type="checkbox" id="{@id}"><label for="{@id}"><span class="facet-range-choice-label">{@label}</span><div class="facet-range-choice-count">({@count})</div></label></div>',markupSlots:{inputNode:function(){return this.domNode.children[0];}},onclick:function(C){var E=C.e,D=A.eventTarget(C.hWin,E);if(D===this.inputNode){if(this.label===mstrmojo.desc(1395,"Numeric")){this.parent.selectNumeric=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(12353,"Non-numeric")){this.parent.selectNonNumeric=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(2797,"Blank")){this.parent.selectBlank=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(96,"Error")){this.parent.selectError=!this.checked;this.parent.parent.updateEngine(true);}}}}}},postBuildRendering:function(){if(this.checked){this.inputNode.setAttribute("checked","checked");}}};mstrmojo.Refine.RangeFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.RangeFacet",config:null,options:null,from:null,to:null,selectNumeric:true,selectNonNumeric:true,selectBlank:true,selectError:true,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><div class="facet-column-name"></div></div><div class="facet-menu"></div></div><div class="facet-range-body"><div class="facet-range-message">'+mstrmojo.desc(8445,"Loading")+'...</div><div class="facet-range-slider slider-widget"><div class="facet-range-histogram"></div></div><div class="facet-range-status"></div><div class="facet-range-other-choices"><div class="facet-range-choices"></div></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},titleNode:function(){return this.domNode.children[0].children[0].children[1];},messageNode:function(){return this.domNode.children[1].children[0];},statusNode:function(){return this.domNode.children[1].children[2];},otherChoicesNode:function(){return this.domNode.children[1].children[3];},choicesNode:function(){return this.domNode.children[1].children[3].children[0];},sliderNode:function(){return this.domNode.children[1].children[1];},histogramNode:function(){return this.domNode.children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var F=this.parent;var D=mstrmojo.Refine.RangeFacet;var E=D.menuHelper=D.menuHelper||new mstrmojo.Refine.RefineFacetMenu();E.target=F;E.type=0;var C=E.getMenuConfig();C.hostId=F.id;C.hostElement=this.domNode;C.isHostedWithin=false;C.position=A.position(this.domNode,true);F.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:C}));}}],onclick:function(C){var E=C.e,D=A.eventTarget(C.hWin,E);if(D===this.resetNode){this.reset();this.parent.updateEngine(true);}},reset:function(){this.from=null;this.to=null;this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.selectNumeric=true;this.selectNonNumeric=true;this.selectBlank=true;this.selectError=true;this.setRangeIndicators();},setRangeIndicators:function(){if(this.from===null||this.to===null){return ;}this.statusNode.innerHTML=this.addCommas(this.from.toFixed(2))+" &mdash; "+this.addCommas(this.to.toFixed(2));},addCommas:function(G){var C,F,D;G+="";C=G.split(".");F=C[0];D=C.length>1?"."+C[1]:"";var E=/(\d+)(\d{3})/;while(E.test(F)){F=F.replace(E,"$1,$2");}return F+D;},remove:function(){this.parent.removeFacet(this);this.config=null;this.data=null;},hasSelection:function(){if(!this.selectNumeric||!this.selectNonNumeric||!this.selectBlank||!this.selectError){return true;}return(this.from!==null&&(!this.initializedUI||this.from>this.config.min))||(this.to!==null&&(!this.initializedUI||this.to<this.config.max));},getRequirementDiscription:function(){var C='{cells in "'+this.config.name+'" are';var D="";if(this.selectNumeric&&this.numericCount>0){D+=" "+this.statusNode.innerHTML;}if(this.selectNonNumeric&&this.nonNumericCount){if(D){D+=" /";}C+=" (Non-Numeric)";}if(this.selectBlank&&this.blankCount){if(D){D+=" /";}C+=" (blank)";}D+="}";return C+D;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(C){if(C.hasOwnProperty("min")&&C.hasOwnProperty("max")){this.error=false;this.config.min=C.min;this.config.max=C.max;this.config.step=C.step;this.baseBins=C.baseBins;this.bins=C.bins;switch(this.config.mode){case"min":this.from=Math.max(C.from,this.config.min);break;case"max":this.to=Math.min(C.to,this.config.max);break;default:this.from=Math.max(C.from,this.config.min);if(C.to!==undefined){this.to=Math.min(C.to,this.config.max);}else{this.to=C.max;}}this.baseNumericCount=C.baseNumericCount;this.baseNonNumericCount=C.baseNonNumericCount;this.baseBlankCount=C.baseBlankCount;this.baseErrorCount=C.baseErrorCount;this.numericCount=C.numericCount;this.nonNumericCount=C.nonNumericCount;this.blankCount=C.blankCount;this.errorCount=C.errorCount;}else{this.error=true;this.errorMessage=C.hasOwnProperty("error")?C.error:mstrmojo.desc(13687,"Unknown error");}this._render();},initializeUI:function(){this.histogram=new mstrmojo.Refine.HistogramWidget({slot:"histogramNode",options:{binColors:["#dad8d8","#67c0f0"],binBorderColors:["cbcbcb","4bafe5"]}});this.addChildren([this.histogram]);this.sliderWidget=new mstrmojo.Refine.SliderWidget({sliderNode:this.sliderNode});this.addChildren([this.sliderWidget]);this.attachEventListener("slide",this.id,this.handleSlide);this.attachEventListener("stop",this.id,this.handleStop);},handleSlide:function(C){this.from=C.from;this.to=C.to;this.setRangeIndicators();},handleStop:function(C){this.from=C.from;this.to=C.to;this.selectNumeric=true;this.parent.updateEngine(true);},_render:function(){if(!this.initializedUI){this.initializeUI();this.initializedUI=true;}if(this.error){this.messageNode.innerHTML=this.errorMessage;this.messageNode.style.display="block";this.sliderNode.style.display="none";this.histogramNode.style.display="none";this.statusNode.style.display="none";this.otherChoicesNode.style.display="none";return ;}this.messageNode.style.display="none";this.sliderNode.style.display="block";this.histogramNode.style.display="block";this.statusNode.style.display="block";this.otherChoicesNode.style.display="block";this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.histogram.update(this.config.min,this.config.max,this.config.step,[this.baseBins,this.bins]);this.setRangeIndicators();this.renderOtherChoices();},hasOtherChoices:function(){if(this.baseNonNumericCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return false;}return true;},renderOtherChoices:function(){while(this.otherChoicesNode.hasChildNodes()){this.otherChoicesNode.removeChild(this.otherChoicesNode.lastChild);}if(!this.hasOtherChoices()){return ;}this.choicesNode=document.createElement("div");this.choicesNode.className="facet-range-choices";this.otherChoicesNode.appendChild(this.choicesNode);var C=[];B.slot="choicesNode";B.label=mstrmojo.desc(1395,"Numeric");B.count=this.numericCount;B.checked=(this.selectNumeric&&this.baseNumericCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(12353,"Non-numeric");B.count=this.nonNumericCount;B.checked=(this.selectNonNumeric&&this.baseNonNumericCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(2797,"Blank");B.count=this.blankCount;B.checked=(this.selectBlank&&this.baseBlankCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(96,"Error");B.count=this.errorCount;B.checked=(this.selectError&&this.baseErrorCount!==0);C.push(new mstrmojo.Widget(B));this.addChildren(C);},getJSON:function(){var C={type:"range",name:this.config.name,columnName:this.config.columnName,expression:this.config.expression,selectNumeric:this.selectNumeric,selectNonNumeric:this.selectNonNumeric,selectBlank:this.selectBlank,selectError:this.selectError};if(this.from!==null){C.from=this.from;}if(this.to!==null){C.to=this.to;}return C;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu");mstrmojo.requiresDescs(4326,8983);var A=mstrmojo.dom;mstrmojo.Refine.TextSearchFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.TextSearchFacet",config:null,options:null,query:null,timerID:null,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><div class="facet-column-name text"></div></div><div class="facet-menu"></div></div><div class="facet-text-body"><div class="input-container" mstrAttach:keyup><textarea></textarea></div><div class="facet-text-options"><div class="facet-text-item"><input type="checkbox"/><label>'+mstrmojo.desc(4326,"Case Sensitive")+'</label></div><div class="facet-text-item"><input type="checkbox"/><label>'+mstrmojo.desc(8983,"Regular Expression")+"</label></div></div></div></li>",markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},titleNode:function(){return this.domNode.children[0].children[0].children[0];},inputNode:function(){return this.domNode.children[1].children[0].children[0];},caseSensitiveNode:function(){return this.domNode.children[1].children[1].children[0].children[0];},regexNode:function(){return this.domNode.children[1].children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var E=this.parent;var C=mstrmojo.Refine.RangeFacet;var D=C.menuHelper=C.menuHelper||new mstrmojo.Refine.RefineFacetMenu();D.target=E;D.type=0;var B=D.getMenuConfig();B.hostId=E.id;B.hostElement=this.domNode;B.isHostedWithin=false;B.position=A.position(this.domNode,true);E.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:B}));}}],onkeyup:function(){this.query=this.inputNode.value;this.scheduleUpdate();},onclick:function(B){var D=B.e,C=A.eventTarget(B.hWin,D);if(C===this.removeNode){this.remove();}else{if(C===this.caseSensitiveNode){this.config.caseSensitive=!this.config.caseSensitive;if(this.query!==null&&this.query.length>0){this.scheduleUpdate();}}else{if(C===this.regexNode){if(this.config.mode==="regex"){this.config.mode="text";}else{this.config.mode="regex";}if(this.query!==null&&this.query.length>0){this.scheduleUpdate();}}}}},scheduleUpdate:function(){var B=this;if(!this.timerID){this.timerID=window.setTimeout(function(){B.timerID=null;B.parent.updateEngine(true);},500);}else{window.clearTimeout(this.timerID);this.timerID=window.setTimeout(function(){B.timerID=null;B.parent.updateEngine(true);},500);}},reset:function(){this.query=null;this.inputNode.value="";this.parent.updateEngine(true);},remove:function(){this.parent.removeFacet(this);this.config=null;this.options=null;},hasSelection:function(){return(this.query!==null&&this.query!=="");},getRequirementDiscription:function(){var B='{cells in "'+this.config.name+'" contains "'+this.query+'"}';return B;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(B){this.config.caseSensitive=B.caseSensitive;this.config.mode=B.mode;if(this.config.caseSensitive){this.caseSensitiveNode.checked=true;}if(this.config.mode==="regex"){this.regexNode.checked=true;}},getJSON:function(){return{type:"text",name:this.config.name,columnName:this.config.columnName,mode:this.config.mode,caseSensitive:this.config.caseSensitive,query:this.query};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Widget","mstrmojo.dom");mstrmojo.requiresDescs(3946,3945,12352,1905,8445,1088);var A=mstrmojo.dom;var B=mstrmojo.css;var D=100;var C={scriptClass:"mstrmojo.Widget",choiceIndex:null,label:null,count:null,s:false,markupString:'<div class="facet-choice" mstrAttach:click,mouseover,mouseout><a class="facet-choice-link"></a><a class="facet-choice-link" title="'+mstrmojo.desc(1088,"Edit")+'">'+mstrmojo.desc(1088,"Edit")+'</a><div class="facet-choice-label"></div><span class="facet-choice-count">({@count})</span><div class="facet-choice-count-bar"></div></div>',markupSlots:{toggleNode:function(){return this.domNode.children[0];},editNode:function(){return this.domNode.children[1];},labelNode:function(){return this.domNode.children[2];},countNode:function(){return this.domNode.children[3];},barNode:function(){return this.domNode.children[4];}},markupMethods:{onlabelChange:function(){this.labelNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.label)||"",null,true);this.labelNode.title=this.label;}},onmouseover:function(){if(!this.s){this.toggleNode.style.visibility="visible";}this.editNode.style.visibility="visible";},onmouseout:function(){if(!this.s){this.toggleNode.style.visibility="hidden";}this.editNode.style.visibility="hidden";},onclick:function(E){var J=E.e,F=A.eventTarget(E.hWin,J);if(F===this.labelNode){this.parent.labelClick(this.choiceIndex);}else{if(F===this.toggleNode){this.parent.toggleClick(this.choiceIndex);}else{if(F===this.editNode){var G=A.position(this.domNode);var I=G.x-1;var H=G.y-1;mstrmojo.insert({scriptClass:"mstrmojo.PopupEditBox",cssClass:"facet",top:H+document.body.scrollTop+"px",left:I+document.body.scrollLeft+"px",width:G.w+"px",text:this.blankChoice?"":this.label,preview:this.parent.parent.parent.parent.parent,columnName:this.parent.config.name,type:"text",blankChoice:this.blankChoice,fromFacet:true,floatLeft:true}).render();}}}},postBuildRendering:function(){if(this.s){B.toggleClass(this.domNode,"facet-choice-selected",true);}this.toggleNode.style.visibility=(this.s?"visible":"hidden");this.toggleNode.innerHTML=(this.parent.config.invert!==this.s?mstrmojo.desc(3946,"exclude"):mstrmojo.desc(3945,"include"));this.toggleNode.title=(this.parent.config.invert!==this.s?mstrmojo.desc(3946,"exclude"):mstrmojo.desc(3945,"include"));this.editNode.style.visibility="hidden";if(this.toggleNode.clientWidth+this.editNode.clientWidth+this.labelNode.clientWidth+this.countNode.offsetWidth+21>291){this.toggleNode.style.maxWidth="45px";this.editNode.style.maxWidth="45px";}this.barNode.style.right=(1-this.bar)*100+"%";}};mstrmojo.Refine.ListFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.ListFacet",config:null,options:null,selection:[],blankChoice:null,errorChoice:null,data:null,_dataIndex:0,_childrenNodes:[],markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><a class="facet-choice-link" >'+mstrmojo.desc(12352,"invert")+'</a><div class="facet-column-name"></div><div class="choiceCountContainer"></div> </div><div class="facet-menu"></div></div><div class="facet-body"><div class="facet-body-inner"></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},invertNode:function(){return this.domNode.children[0].children[0].children[1];},choiceCountNode:function(){return this.domNode.children[0].children[0].children[3];},titleNode:function(){return this.domNode.children[0].children[0].children[2];},bodyInnerNode:function(){return this.domNode.children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var H=this.parent;var F=mstrmojo.Refine.ListFacet;var G=F.menuHelper=F.menuHelper||new mstrmojo.Refine.RefineFacetMenu();G.target=H;G.type=0;var E=G.getMenuConfig();E.hostId=H.id;E.hostElement=this.domNode;E.isHostedWithin=false;E.position=A.position(this.domNode,true);H.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:E}));}}],labelClick:function(G){var H=this.data.choices,F;var E=this.selection.length+(this.blankChoice!==null&&this.blankChoice.s?1:0)+(this.errorChoice!==null&&this.errorChoice.s?1:0);if(G===-1){F=this.blankChoice;}else{if(G===-2){F=this.errorChoice;}else{F=H[G];}}if(F.s){if(E>1){this.select(F,true);}else{this.deselect(F);}}else{if(E>0){this.select(F,true);}else{this.select(F,false);}}},toggleClick:function(F){var G=this.data.choices,E;if(F===-1){E=this.data.blankChoice;}else{E=G[F];}if(E.s){this.deselect(E);}else{this.select(E,false);}},select:function(E,F){if(F){this.selection=[];if(this.blankChoice!==null){this.blankChoice.s=false;}if(this.errorChoice!==null){this.errorChoice.s=false;}}E.s=true;if(E!==this.errorChoice&&E!==this.blankChoice){this.selection.push(E);}this.parent.updateEngine(true);},deselect:function(E){var F;if(E===this.errorChoice||E===this.blankChoice){E.s=false;}else{for(F=this.selection.length-1;F>=0;F--){if(this.selection[F]===E){this.selection.splice(F,1);break;}}}this.parent.updateEngine(true);},onclick:function(E){var G=E.e,F=A.eventTarget(E.hWin,G);if(F===this.invertNode){this.config.invert=!this.config.invert;this.parent.updateEngine(true);}else{if(F===this.resetNode){this.reset();this.parent.updateEngine(true);}}},sortByName:function(){if(this.options.sort!=="name"){this.options.sort="name";this.reSortChoices();this.update();}},sortByCount:function(){if(this.options.sort!=="count"){this.options.sort="count";this.reSortChoices();this.update();}},reset:function(){this.selection=[];this.blankChoice=null;this.errorChoice=null;this.config.invert=false;},remove:function(){this.parent.removeFacet(this);this.config=null;this.selection=null;this.blankChoice=null;this.errorChoice=null;this.data=null;},hasSelection:function(){return this.selection.length>0||(this.blankChoice!==null&&this.blankChoice.s)||(this.errorChoice!==null&&this.errorChoice.s);},getRequirementDiscription:function(){var F,E='{cells in "'+this.config.name+'" '+(this.config.invert?"are not equal to ":"are equal to ");for(F=0;F<this.selection.length;F++){var G=this.selection[F];E+='"'+G.v.l+'"';if(F!==this.selection.length-1){E+=" / ";}}E+="}";return E;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;this.config.invert=false;this.update();this.bodyInnerNode.onscroll=function(){var E=A.findWidget(this.parentNode.parentNode);if(this.scrollTop+this.clientHeight+3>=this.scrollHeight){if(E._dataIndex<E._childrenNodes.length-1){E.incrementalRender(E._childrenNodes,E._dataIndex);}}};},updateState:function(I){this.maxCount=0;this.data=I;var F,H=false;if(I.choices){var G=[];var J=I.choices;for(F=0;F<J.length;F++){var E=J[F];this.maxCount=Math.max(this.maxCount,E.c);if(E.s){if(E.c===0){H=true;}else{G.push(E);}}}this.selection=G;this.reSortChoices();this.blankChoice=null;if(I.blankChoice){this.maxCount=Math.max(this.maxCount,I.blankChoice.c);if(I.blankChoice.c===0){I.blankChoice=null;H=true;}else{this.blankChoice=I.blankChoice;}}this.errorChoice=I.errorChoice||null;}if(H===true){this.parent.updateEngine(true);return ;}this.update();},reSortChoices:function(){this.data.choices.sort(this.options.sort==="name"?function(F,E){return F.v.l.toLowerCase().localeCompare(E.v.l.toLowerCase());}:function(F,E){var G=E.c-F.c;return G!==0?G:F.v.l.localeCompare(E.v.l);});},update:function(){var I,J;var K=this.config.invert;if(K){B.toggleClass(this.bodyInnerNode,"facet-mode-inverted",true);B.toggleClass(this.invertNode,"facet-mode-inverted",true);}else{B.toggleClass(this.bodyInnerNode,"facet-mode-inverted",false);B.toggleClass(this.invertNode,"facet-mode-inverted",false);}while(this.bodyInnerNode.hasChildNodes()){this.bodyInnerNode.removeChild(this.bodyInnerNode.firstChild);}if(!this.data){J=document.createElement("div");J.className="facet-body-message";J.innerHTML=mstrmojo.desc(8445,"Loading")+"...";this.bodyInnerNode.appendChild(J);return ;}if(this.data.hasOwnProperty("error")){J=document.createElement("div");J.className="facet-body-message";J.innerHTML=this.data.error;this.bodyInnerNode.appendChild(J);return ;}var L=this.data.choices;var G=this.selection.length+(this.blankChoice!==null&&this.blankChoice.s?1:0)+(this.errorChoice!==null&&this.errorChoice.s?1:0);this.choiceCountNode.innerHTML="("+L.length+")";if(G>0){this.invertNode.style.display="block";this.resetNode.style.display="block";}else{this.invertNode.style.display="none";this.resetNode.style.display="none";}var E=[];var H,F;for(I=0;I<L.length;I++){H=L[I];if(H.c===0){continue;}C.slot="bodyInnerNode";C.choiceIndex=I;C.label=H.v.l;C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;C.blankChoice=false;F=new mstrmojo.Widget(C);E.push(F);}if(this.blankChoice!==null){H=this.blankChoice;C.slot="bodyInnerNode";C.choiceIndex=-1;C.label="(blank)";C.blankChoice=true;C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;F=new mstrmojo.Widget(C);E.push(F);}if(this.errorChoice!==null){H=this.errorChoice;C.slot="bodyInnerNode";C.choiceIndex=-2;C.label="(error)";C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;F=new mstrmojo.Widget(C);E.push(F);}this.set("_dataIndex",0);this.set("_childrenNodes",E);this.incrementalRender(this._childrenNodes,this._dataIndex);},incrementalRender:function(F,H){var I=H===0?H:H+1,G=I+D-1,E=F.slice(I,G+1);this.set("_dataIndex",G);this.addChildren(E);},getJSON:function(){var F;var G={type:"list",name:this.config.name,columnName:this.config.columnName,expression:this.config.expression,omitBlank:this.config.omitBlank||false,omitError:this.config.omitError||false,selection:[],selectBlank:this.blankChoice!==null&&this.blankChoice.s,selectError:this.errorChoice!==null&&this.errorChoice.s,invert:this.config.invert};for(F=0;F<this.selection.length;F++){var E={v:this.selection[F].v};G.selection.push(E);}return G;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Refine.HistogramWidget","mstrmojo.Refine.SliderWidget");mstrmojo.requiresDescs(487,12354,2797,96,1905,8445);var A=mstrmojo.dom;function C(D){return new Date(D.getUTCFullYear(),D.getUTCMonth(),D.getUTCDate(),D.getUTCHours(),D.getUTCMinutes(),D.getUTCSeconds());}var B={scriptClass:"mstrmojo.Widget",count:null,label:null,checked:null,markupString:'<div class="facet-range-item" mstrAttach:click><input type="checkbox" id="{@id}"><label for="{@id}"><span class="facet-range-choice-label">{@label}</span><div class="facet-range-choice-count">({@count})</div></label></div>',markupSlots:{inputNode:function(){return this.domNode.children[0];}},onclick:function(D){var F=D.e,E=A.eventTarget(D.hWin,F);if(E===this.inputNode){if(this.label===mstrmojo.desc(487,"Time")){this.parent.selectTime=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(12354,"Non-Time")){this.parent.selectNonTime=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(2797,"Blank")){this.parent.selectBlank=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(96,"Error")){this.parent.selectError=!this.checked;this.parent.parent.updateEngine(true);}}}}}},postBuildRendering:function(){if(this.checked){this.inputNode.setAttribute("checked","checked");}}};mstrmojo.Refine.TimeRangeFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.TimeRangeFacet",config:null,options:null,from:null,to:null,step:null,selectTime:true,selectNonTime:true,selectBlank:true,selectError:true,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><div class="facet-column-name"></div></div><div class="facet-menu"></div></div><div class="facet-range-body"><div class="facet-range-message">'+mstrmojo.desc(8445,"Loading")+'...</div><div class="facet-range-slider slider-widget"><div class="facet-range-histogram"></div></div><div class="facet-range-status"></div><div class="facet-range-other-choices"><div class="facet-range-choices time"></div></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},titleNode:function(){return this.domNode.children[0].children[0].children[1];},messageNode:function(){return this.domNode.children[1].children[0];},statusNode:function(){return this.domNode.children[1].children[2];},otherChoicesNode:function(){return this.domNode.children[1].children[3];},choicesNode:function(){return this.domNode.children[1].children[3].children[0];},sliderNode:function(){return this.domNode.children[1].children[1];},histogramNode:function(){return this.domNode.children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var G=this.parent;var E=mstrmojo.Refine.RangeFacet;var F=E.menuHelper=E.menuHelper||new mstrmojo.Refine.RefineFacetMenu();F.target=G;F.type=0;var D=F.getMenuConfig();D.hostId=G.id;D.hostElement=this.domNode;D.isHostedWithin=false;D.position=A.position(this.domNode,true);G.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:D}));}}],onclick:function(D){var F=D.e,E=A.eventTarget(D.hWin,F);if(E===this.removeNode){this.remove();}else{if(E===this.resetNode){this.reset();this.parent.updateEngine(true);}}},reset:function(){this.from=null;this.to=null;this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.selectTime=true;this.selectNonTime=true;this.selectBlank=true;this.selectError=true;this.setRangeIndicators();},setRangeIndicators:function(){if(!this.from||!this.to){return ;}var F=new Date(this.from);var E=new Date(this.to);var D="yyyyMMdd";var G="HH:mm:ss";F=C(F);E=C(E);if(this.config.step>2629746000){this.statusNode.innerHTML=(F.getFullYear()+" &mdash; "+E.getFullYear());}else{if(this.config.step>3600000){this.statusNode.innerHTML=(F.toString(D)+" &mdash; "+E.toString(D));}else{this.statusNode.innerHTML=(F.toString(D)+" "+F.toString(G)+" &mdash; "+E.toString(D)+" "+E.toString(G));}}},remove:function(){this.parent.removeFacet(this);this.config=null;this.data=null;},hasSelection:function(){if(!this.selectTime||!this.selectNonTime||!this.selectBlank||!this.selectError){return true;}return(this.from!==null&&(!this.initializedUI||this.from>this.config.min))||(this.to!==null&&(!this.initializedUI||this.to<this.config.max));},getRequirementDiscription:function(){var D='{cells in "'+this.config.name+'" are';var E="";if(this.selectTime&&this.timeCount>0){E+=" "+this.statusNode.innerHTML;}if(this.selectNonTime&&this.nonTimeCount>0){if(E){E+=" /";}E+=" (Non-Time)";}if(this.selectBlank&&this.blankCount){if(E){E+=" /";}E+=" (blank)";}E+="}";return D+E;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(D){if(D.hasOwnProperty("min")&&D.hasOwnProperty("max")&&D.baseTimeCount!==0){this.error=false;this.config.min=D.min;this.config.max=D.max;this.config.step=D.step;this.baseBins=D.baseBins;this.bins=D.bins;switch(this.config.mode){case"min":this.from=Math.max(D.from,this.config.min);break;case"max":this.to=Math.min(D.to,this.config.max);break;default:this.from=Math.max(D.from,this.config.min);if(D.to){this.to=Math.min(D.to,this.config.max);}else{this.to=D.max;}}this.baseTimeCount=D.baseTimeCount;this.baseNonTimeCount=D.baseNonTimeCount;this.baseBlankCount=D.baseBlankCount;this.baseErrorCount=D.baseErrorCount;this.timeCount=D.timeCount;this.nonTimeCount=D.nonTimeCount;this.blankCount=D.blankCount;this.errorCount=D.errorCount;}else{if(D.baseTimeCount===0){this.error=true;this.errorMessage="No date value present.";}else{this.error=true;this.errorMessage=D.hasOwnProperty("error")?D.error:"Unknown error.";}}this._render();},initializeUI:function(){this.histogram=new mstrmojo.Refine.HistogramWidget({slot:"histogramNode",options:{binColors:["#dad8d8","#67c0f0"],binBorderColors:["cbcbcb","4bafe5"]}});this.addChildren([this.histogram]);this.sliderWidget=new mstrmojo.Refine.SliderWidget({sliderNode:this.sliderNode});this.addChildren([this.sliderWidget]);this.attachEventListener("slide",this.id,this.handleSlide);this.attachEventListener("stop",this.id,this.handleStop);},handleSlide:function(D){this.from=D.from;this.to=D.to;this.setRangeIndicators();},handleStop:function(D){this.from=D.from;this.to=D.to;this.selectTime=true;this.parent.updateEngine(true);},_render:function(){if(!this.initializedUI){this.initializeUI();this.initializedUI=true;}if(this.error){this.messageNode.innerHTML=this.errorMessage;this.messageNode.style.display="block";this.sliderNode.style.display="none";this.histogramNode.style.display="none";this.statusNode.style.display="none";this.otherChoicesNode.style.display="none";return ;}this.messageNode.style.display="none";this.sliderNode.style.display="block";this.histogramNode.style.display="block";this.statusNode.style.display="block";this.otherChoicesNode.style.display="block";this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.histogram.update(this.config.min,this.config.max,this.config.step,[this.baseBins,this.bins]);this.setRangeIndicators();this.renderOtherChoices();},hasOtherChoices:function(){if(this.baseNonTimeCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return false;}return true;},renderOtherChoices:function(){while(this.otherChoicesNode.hasChildNodes()){this.otherChoicesNode.removeChild(this.otherChoicesNode.lastChild);}if(this.baseNonTimeCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return ;}this.choicesNode=document.createElement("div");this.choicesNode.className="facet-range-choices";this.otherChoicesNode.appendChild(this.choicesNode);var D=[];B.slot="choicesNode";B.label=mstrmojo.desc(487,"Time");B.count=this.timeCount;B.checked=(this.selectTime&&this.baseTimeCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(12354,"Non-Time");B.count=this.nonTimeCount;B.checked=(this.selectNonTime&&this.baseNonTimeCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(2797,"Blank");B.count=this.blankCount;B.checked=(this.selectBlank&&this.baseBlankCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(96,"Error");B.count=this.errorCount;B.checked=(this.selectError&&this.baseErrorCount!==0);D.push(new mstrmojo.Widget(B));this.addChildren(D);},getJSON:function(){var D={type:"timerange",name:this.config.name,columnName:this.config.columnName,expression:this.config.expression,selectTime:this.selectTime,selectNonTime:this.selectNonTime,selectBlank:this.selectBlank,selectError:this.selectError};if(this.from!==null){D.from=this.from;}if(this.to!==null){D.to=this.to;}return D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.VisBase","mstrmojo.DocPortlet");var L={top:"top",left:"left","z-index":"zIndex",width:"width",height:"height"},P,B;mstrmojo.Vis=mstrmojo.declare(mstrmojo.VisBase,null,{scriptClass:"mstrmojo.Vis",offsetTop:0,offsetLeft:0,isAndroid:window.navigator.userAgent.indexOf("Android")!=-1,reRenderOnDimensionChg:true,isVis:function(){return true;},setModel:function Q(R){this._super(R);if(R.data){this.set("model",R.data);}this.xtabModel=R;if(this.controller&&typeof (this.controller.getPageByTree)!="undefined"){this.controller.getPageByTree(false);}},destroy:function O(){this._super();var R=this.xtabModel;if(R&&R.destroy){R.destroy();delete this.xtabModel;}},setDimensions:function N(T,S){var R=this._super(T,S);if(R&&this.hasRendered&&this.reRenderOnDimensionChg){this.reRender();}return R;},buildRendering:function M(){if(this.parent instanceof mstrmojo.DocPortlet){delete this.left;delete this.top;this.height=this.fmts&&this.fmts.height;}this._super();},postBuildRendering:function G(){P=this.width;B=this.height;this.adjustWidgetOffsets();this._super();},adjustWidgetOffsets:function E(){var R=this.domNode,S={top:0,left:0};if(typeof (mstr)!="undefined"&&mstr.utils.BoxModel){S.top=mstr.utils.BoxModel.getElementSumOffsetTop(R);S.left=mstr.utils.BoxModel.getElementSumOffsetLeft(R);}else{if(typeof (mstrmojo)!="undefined"){S=mstrmojo.boxmodel.offset(R);}}this.offsetTop=S.top;this.offsetLeft=S.left;},update:function F(V){V=V||this.node;if(V){if(V.data){this.set("model",V.data);if(this.xtabModel&&this.xtabModel.set){this.xtabModel.set("data",V.data);}this.model=V.data;if(this.model.layoutModel){this.layoutModel=this.model.layoutModel;}if(this.model.layoutNode){this.layoutNode=this.model.layoutNode;}mstrmojo.hash.copy(V.data.extProps,this);}var T=this.controller,S=T.view,X=(S.hasRendered&&S.getCurrentLayout&&S.getCurrentLayout());if(T.view.fullScreenInfoWindow&&(X&&X.defn.visName)){var W=mstrApp.rootView.getContentDimensions();this.height=W.h+"px";this.width=W.w+"px";}else{this.fmts=V.defn.fmts||V.defn.units[this.model.k].fmts;var R=this.fmts;if(R){for(var U in L){v=L[U];if(U in R){this[v]=R[U];}}}}}if(this.model){this.initFromVisProps(this.model.vp);}this.updated=true;return true;},getModel:function A(S){if(S){var R=mstrmojo.Vis.getVisGrid(this.layoutModel,this.layoutNode,S);if(R){return R.data;}else{alert(mstrmojo.desc(8427,"Incorrect visualization properties encountered.  Data may be inconsistent.  Please reset your properties."));return{};}}else{return this.model;}},getDataParser:function K(R){return new mstrmojo.Vis.DataParser(this.getModel(R));},renderErrorMessage:function H(R){this.domNode.innerHTML='<div class="mstrmojo-message">'+R+"</div>";},getMessageID:function J(){return this.model.mid&&this.model.mid||this.xtabModel&&this.xtabModel.docModel&&this.xtabModel.docModel.mid;},hasNoninfowindowTarget:function D(U){var b=this.xtabModel,a=(b&&b.docModel);var c=false;if(a){var Z=a.defn&&a.defn.layouts,T=null;var S;if(Z){for(S in Z){if(Z[S].loaded){T=Z[S];break;}}}var V=T&&T.units;this.selectorTargets={};if(V&&U.scObjList){for(var S=0;S<U.scObjList.length;S++){var W=U.scObjList[S];var X=W.sc.tks.split("\x1E");for(var R=0;R<X.length;R++){var Y=V[X[R]];if(Y){this.selectorTargets[X[R]]=Y;if(!this.isChildOfIfw(V,Y)){c=true;}}}}}}return c;},isChildOfIfw:function I(R,S){while(S){if(S.ifw){return true;}S=R[S.pnk];}return false;},performAction:function C(R){var T=this.xtabModel.getAction(R),S=T&&T.h;if(S&&this.controller[S]){this.controller[S](this,T.a);return true;}return false;}});mstrmojo.Vis.getVisGrid=function(R,Y,S){var W=Y;var U=R.getChildren(Y,false);for(var T=0;T<U.length;T++){var X=U[T];if(X.k==S){return X;}else{var V=mstrmojo.Vis.getVisGrid(R,X,S);if(V){Y=W;return V;}}}};mstrmojo.Vis.DataParser=function(T){var a=mstrmojo.Vis;return{getRowTitles:function(){return new a.Titles(T,true);},getColTitles:function(){return new a.Titles(T,false);},findMetricValue:function(f,k){var j=T.ghs.rhs.items;for(var g in j){var h=j[g].items;var d=true;for(var b in f){if(f[b]!=h[b].idx){d=false;break;}}if(d){return new mstrmojo.Vis.MetricValue(T.gvs.items[g].items[k]);}}},getTotalRows:function W(){var b=T.ghs&&T.ghs.rhs&&T.ghs.rhs.items;return(T.eg||!b)?0:b.length;},getTotalColHeaderRows:function U(){return(!T.ghs.chs.items?0:T.ghs.chs.items.length);},getTotalCols:function R(){return this.getColHeaders(0).size();},getRowHeaders:function Z(b){return new a.Headers(T,b,true);},getColHeaders:function Y(b){return new a.Headers(T,b,false);},getMetricValue:function X(c,b){return new a.MetricValue(T,T.gvs.items[c].items[b]);},getColumnHeaderCount:function V(){return T.gvs.items[0].items.length;},getCSSString:function S(){return T.cssString;}};};mstrmojo.Vis.Titles=function(R,W){var V=(W)?R.gts.row:R.gts.col;return{size:function U(){return V.length;},getTitle:function T(X){return new mstrmojo.Vis.Title(V[X]);},getCSS:function S(X){return R.css[V[X].cni].n;}};};mstrmojo.Vis.Headers=function(S,T,X){var Y=(X)?S.gts.row:S.gts.col;var W=(X)?S.ghs.rhs:S.ghs.chs;var U=W.items&&W.items[T].items;return{size:function Z(){return(!U?0:U.length);},getHeader:function R(a){return U&&U[a]&&new mstrmojo.Vis.Header(U[a],X?Y[a]:Y[T]);},getCSS:function V(a){return U&&S.css[U[a].cni].n;},getHeaderCell:function(a){return U&&U[a];}};};mstrmojo.Vis.Title=function(S){return{getActionType:function(){return S.at;},getDrillPath:function(){return S.dp;},getHeaderValues:function R(){return S.es;},getHeaderName:function T(V){return S.es[V].n;},getHeaderId:function T(V){return S.es[V].id;},getForms:function U(){return S.fs;},getFormId:function(){return S.fid;},getFormType:function(){return S.ftp;},getUnitId:function(){return S.id;},getLinkMap:function(){return S.lm;},getName:function(){return S.n;},getUnitDssType:function(){return S.otp;},getSelectorControl:function(){return S.sc;}};};mstrmojo.Vis.Header=function(T,R){return{getName:function V(){return(T.idx===-1)?"":R.es[T.idx].n;},getElementId:function Y(){return(T.idx===-1)?"":R.es[T.idx].id;},getObjectId:function U(){return(T.idx===-1)?"":R.es[T.idx].oid;},getElementIndex:function S(){return T.idx;},getActionType:function X(){return T.at;},isTotal:function W(){return T.otr===1;}};};mstrmojo.Vis.MetricValue=function(R,Y){var X=Y;return{getValue:function S(){return X.v;},getThresholdType:function T(){return X.ty;},getRawValue:function W(){return X.rv;},getCSS:function U(){return R.css[X.cni].n;},getThresholdValue:function Z(a){if(X.ti==undefined){return a;}return R.th[X.ti].n;},getFillColor:function V(a){if(X.ci==undefined){return a;}return R.fc[X.ci].n;}};};})();(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.array","mstrmojo.qb.DBTableRow");mstrmojo.requiresDescs(629,12912,12913,12914,10);var N=mstrmojo.string,Y=mstrmojo.dom,a=mstrmojo.css,K=mstrmojo.array;function C(b,d,e){var c=b.editorNode.style;d=(d<0)?0:d+"px";e=(e<0)?0:e+"px";c.left=d;b.set("left",d);b.left=d;c.top=e;b.set("top",e);b.top=e;}function A(b){var c=b.children[0].children;K.forEach(c,function(e,d){if(b.selectedIndex[d]){a.addClass(e.domNode,["selected"]);}else{a.removeClass(e.domNode,["selected"]);}});}function X(c,b){c.canvasbox.domNode.style.width=c.maxWidth+"px";c.canvasbox.width=c.maxWidth+"px";c.linker.width=c.maxWidth;b.linkerNeedRender=true;c.linker.drawLinks();}function R(d,c,b){d.canvasbox.domNode.style.height=d.maxHeight+"px";d.canvasbox.height=d.maxHeight+"px";d.linker.height=d.maxHeight;c.linkerNeedRender=true;if(!b){d.linker.drawLinks();}}function D(b,d){var c=22;d=d?d+2:1;if(b.searchBox.visible){d++;}return c*d;}function Q(d,e){var f=d.editorNode.style,k=parseInt(f.top),c=parseInt(f.height),j=d.container,g,b=false;if(k+c>j.maxHeight){j.maxHeight=k+c+10;g=parseInt(j.domNode.clientHeight);if(j.maxHeight>g){R(j,e,true);b=true;}else{j.domNode.scrollTop=0;}}return b;}function E(b){var c=this.Rows.children;K.forEach(c,function(d){d.domNode.firstChild.childNodes[1].style.width=(b-20)+"px";});}mstrmojo.qb.DBTable=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.DBTable",title:"",left:"",top:"",minWidth:80,maxWidth:250,maxHeight:300,minHeight:20,model:null,prevPos:{},container:null,selectedIndex:[],draggable:true,noCheckBox:true,topAnchor:function I(){return(this.titlebarNode)?parseInt(this.top,10)+(this.titlebarNode.clientHeight/2)+"px":"0px";},leftAnchor:function T(){return this.left;},rightAnchor:function V(){return(this.editorNode)?parseInt(this.left,10)+this.editorNode.clientWidth+"px":"0px";},modal:false,zIndex:7,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor mstrmojo-qb-DBTable {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,mouseup,click><div class = "mstrmojo-qb-DBTable-header" style="position:absolute;"><table cellspacing="0" cellpadding="0" class="mstrmojo-qb-DBTable-titlebar"><tr><td><input id="{@id}check" type="checkbox" mstrAttach:click></td><td><div class="mstrmojo-qb-DBTable-titleIcon"></div></td><td class="mstrmojo-Editor-titleCell"><div id="{@id}title" class="mstrmojo-qb-DBTable-title"  mstrAttach:dblclick></div></td><td><div class="mstrmojo-qb-DBTable-searchIcon" title="'+mstrmojo.desc(10,"Search")+'"></div></td><td><div class="mstrmojo-qb-DBTable-close" title="'+mstrmojo.desc(629,"Delete")+'"></div></td><td><div style="display:none;"></div></td></tr></table></div><div class="mstrmojo-Editor-titleSpacer"></div>{@titlebarHTML}<div class="mstrmojo-qb-DBTable-searchBox"></div><div class="mstrmojo-Editor-content" style="padding:0px;" mstrAttach:scroll,mouseover,mouseout></div><div class="mstrmojo-qb-table-resize-handle north" id="{@id}north" ></div><div class="mstrmojo-qb-table-resize-handle east" id="{@id}east"></div><div class="mstrmojo-qb-table-resize-handle south" id="{@id}south"></div><div class="mstrmojo-qb-table-resize-handle west" id="{@id}west"></div></div></div>',titleMarkupString:"",children:[{scriptClass:"mstrmojo.Box",alias:"Rows",cssText:"width:100%; background-color:white; border-top: 1px solid #C6C6C6; height:100%;white-space: nowrap;"},{scriptClass:"mstrmojo.TextBox",slot:"searchBoxNode",alias:"searchBox",visible:false,cssClass:"mstrmojo-qb-DBTable-searchInput",onvisibleChange:function O(d){var c=this.parent,f,j=22,h=this.visible?j:-j,b,e=mstrmojo.all.QBuilderModel,g=this;f=c.editorNode.style;f.height=parseInt(f.height)+h+"px";c.maxHeight+=h;if(this.visible){this.set("width",parseInt(f.width)-48+"px");window.setTimeout(function(){g.focus();},0);}b=Q(c,e);if(mstrApp.getRootController().hasTableJoin(c.id)||b){window.setTimeout(function(){c.container.linker.drawLinks();},0);}},onvalueChange:function P(){var n=this.parent,e,k=n.Rows.children,m,h=this.inputNode.value.toLowerCase(),d=0,c,f,j=264,l=false,g,b=mstrmojo.all.QBuilderModel;for(e=1;e<k.length;e++){m=k[e];if(m.text.toLowerCase().indexOf(h)>=0){d++;f=true;}else{f=false;}if(m.visible!==f){m.set("visible",f);l=true;}if(l&&f){m.set("cssClass",(d-1)%2?"odd":"even");}}if(!l){return ;}k[0].set("visible",d>0);c=D(n,d);n.maxHeight=c;n.set("height",(c>j)?j:c);g=Q(n,b);if(l||g){n.container.linker.drawLinks();}}}],markupSlots:{editorNode:function(){return this.domNode.firstChild;},titlebarNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},checkBoxNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[0].firstChild:null;},titleIconNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[1].firstChild:null;},titleNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[2].firstChild:null;},helpNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[5].firstChild:null;},searchIconNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[3].firstChild:null;},closeNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[4].firstChild:null;},searchBoxNode:function(){return this.domNode.firstChild.childNodes[2];},containerNode:function(){return this.domNode.firstChild.childNodes[3];},buttonNode:function(){return this.domNode.firstChild.childNodes[4];},curtainNode:function(){return this.domNode.lastChild;},leftanchor:function(){return this.left;}},onscroll:function(){this.parent.parent.linker.drawLinks();},premousedown:function M(c){var d=mstrmojo.dom.eventTarget(c.hWin,c.e),b;if(d===this.closeNode){if(!this.readOnly){this.close();}}else{if(d===this.searchIconNode){b=this.searchBox.visible;this.searchBox.set("visible",!b);}}},onmousedown:function(b){this.editorNode.style.zIndex=8;},onmouseup:function(b){this.editorNode.style.zIndex=7;},toggleSelect:function(b){var d,c;if(this.selectedIndex[b]){this.selectedIndex[b]=false;}else{this.selectedIndex[b]=true;}A(this);},rangeSelect:function(b){},singleSelect:function(c){var d,b;for(d=0,b=this.selectedIndex.length;d<b;d++){this.selectedIndex[d]=false;}this.selectedIndex[c]=true;A(this);},clearSelect:function(){var c,b;for(c=0,b=this.selectedIndex.length;c<b;c++){this.selectedIndex[c]=false;}A(this);},onmouseover:function(c){var b=parseInt(this.editorNode.style.height);this.containerNode.style.overflowY=(b>=this.minHeight&&b<this.maxHeight)?"auto":"hidden";this.containerNode.style.overflowX="hidden";},onmouseout:function H(){this.containerNode.style.overflow="hidden";},touchBegin:function U(c){var b=this.editorNode.style;this._tl=parseInt(b.left);this._tt=parseInt(b.top);},touchSwipeMove:function S(e){var b=mstrmojo.all.QBuilderModel,c=this.container,d=b.tables[this.id];C(this,e.delta.x+this._tl,e.delta.y+this._tt);if(d&&d.njoins>0){c.linker.drawLinks();}},addRow:function L(b,g,c,d){var e=this.children[0];var f={scriptClass:"mstrmojo.qb.DBTableRow",images:c,indent:g,text:b};e.addChildren([f]);},onclick:function(m){var g=m.hWin,h=m.e||g.event,f=h.target||h.srcElement,d=document.elementFromPoint(h.clientX,h.clientY),b=f&&f.id;if(b.replace(this.id,"")=="check"){if(this.onCheck){this.onCheck(f.checked);}}var k=Y.findWidget(d);if(!k||!k.srcData){this.clearSelect();return ;}var l=k.rIndex,j=Y.ctrlKey(g,h),n=Y.shiftKey(g,h);if(j||n){Y.clearBrowserHighlights(g);}if(j){this.toggleSelect(l);}else{this.singleSelect(l);}},ondblclick:function(c){var b=c.hWin,f=c.e||b.event,k=f.target||f.srcElement,j=k&&k.id;if(j.replace(this.id,"")=="title"){var h=Y.delta(this.titleNode,this.titlebarNode);var g=this.title,d=this.titleNode.clientWidth-6;this.openPopup("inlineTextRef",{left:h.x+"px",top:(Y.isIE?0:-1)+"px",txtConfig:{cssClass:"mstrmojo-qb-tablealias-edit",width:d+"px",value:N.decodeHtmlString(g)||"",onEnter:function(){var n=N.trim(this.value);this.parent.close({enter:true});if(n){var q=this.parent.parent;if(N.encodeHtmlString(n)!==q.title){var e=q.model;if(e&&e.tbns){var p="";if(n.match(/[~#'"?;:[\]]/)){p=mstrmojo.desc(12912,"A table alias cannot contain the following characters: ~#'\"?;:/[]");mstrmojo.alert(p);return ;}if(!n.match(/^[a-zA-Z]/)){n=n.replace(/^\S/,"L");p=mstrmojo.desc(12913,"Table alias starting with non alphabetic character will be replaced by the character L.");}var o=N.encodeHtmlString(n);if(e.tbns[n]&&(o!==q.title)){p+=mstrmojo.desc(12914,"'##' has been used as the alias of another table. Please give a new name.").replace("##",o);mstrmojo.alert(p);return ;}if(p){mstrmojo.alert(p);}}var l=N.decodeHtmlString(q.title);if(e&&e.renameTable){e.renameTable(q.id,l,n);}q.set("title",N.encodeHtmlString(n));if(q.onHeaderChange){q.onHeaderChange(l,n);}}}},onCancel:function(){this.set("value",this.parent.title);}}});}},onCheck:function(b){},postBuildRendering:function W(){if(this._super){this._super();}if(this.noCheckBox){this.checkBoxNode.style.display="none";}},getDragData:function F(b){var c=b.src,e=c.node,d=e.id;if(d){switch(d.replace(this.id,"")){case"north":case"east":case"south":case"west":return{dir:d.replace(this.id,""),startX:c.pos.x,startY:c.pos.y};break;default:break;}}else{if(this._super){return this.dropZone&&this._super(b);}}return null;},isDragValid:function B(b){return true;},ondragstart:function Z(b){var e=b.src,f=e&&e.data,c=f&&f.dir;if(c){this.prevPos={x:e.pos.x,y:e.pos.y};return true;}else{if(this._super){return this._super(b);}}},ondragmove:function J(k){var o=k.src,AI=o&&o.data,u=AI&&AI.dir,q,t,c,x,b,g,AC,n,l,z,AE,m,AG,AH,AA,j,AB,AD;b=this.container;g=mstrmojo.all.QBuilderModel;if(u){switch(u){case"north":case"south":AC=k.tgt;l=AC.pos.y-this.prevPos.y;l=(u==="north")?l:-l;this.prevPos=AC.pos;z=this.editorNode.style;if(parseInt(z.height)-l>=this.minHeight&&parseInt(z.height)-l<=this.maxHeight){q=parseInt(z.top);if(u==="north"){q+=l;if(q<0){q=0;}z.top=q+"px";this.top=z.top;}t=parseInt(z.height)-l;z.height=t+"px";this.containerNode.style.height=t-this.titlebarNode.clientHeight-1-(this.searchBox.visible?this.searchBoxNode.clientHeight:0)+"px";if(q+t>b.maxHeight){b.maxHeight=q+t+10;AE=parseInt(b.domNode.clientHeight);if(b.maxHeight>AE){R(b,g);}else{b.domNode.scrollTop=0;}}}break;case"east":case"west":AC=k.tgt;j=this.noCheckBox?57:77;n=AC.pos.x-this.prevPos.x;n=(u==="east")?n:-n;this.prevPos=AC.pos;z=this.editorNode.style;if(parseInt(z.width)+n>=this.minWidth&&parseInt(z.width)+n<=this.maxWidth){c=parseInt(z.left);if(u==="west"){c-=n;if(c<0){c=0;}z.left=c+"px";this.left=z.left;}x=parseInt(z.width)+n;z.width=x+"px";this.titleNode.style.width=x-j+"px";this.titlebarNode.style.width=x+"px";if(this.searchBox.visible){this.searchBox.set("width",x-48+"px");}if(c+x>b.maxWidth){b.maxWidth=c+x+10;m=parseInt(b.domNode.clientWidth);if(b.maxWidth>m){X(b,g);}else{b.domNode.scrollLeft=0;}}E.call(this,x);}break;}b.linker.drawLinks();}else{AE=parseInt(b.domNode.clientHeight);m=parseInt(b.domNode.clientWidth);AG=k.tgt.pos;o=k.src.pos;n=AG.x-o.x;l=AG.y-o.y;z=this.getMovingTarget().style;AH=this._leftPos+n;AA=this._topPos+l;AH=(AH<0)?0:AH;AA=(AA<0)?0:AA;var p=true,AJ=true,AF=b.canvasbox.children;for(AB=0,AD=AF.length;AB<AD;AB++){if(!AF[AB].visible){continue;}if(this.id!=AF[AB].id&&AH+this.editorNode.clientWidth<parseInt(AF[AB].left)+AF[AB].editorNode.clientWidth){p=false;break;}}if(p){b.maxWidth=AH+this.editorNode.clientWidth;if(b.maxWidth>m){X(b,g);}}for(AB=0,AD=AF.length;AB<AD;AB++){if(!AF[AB].visible){continue;}if(this.id!=AF[AB].id&&AA+this.editorNode.clientHeight<parseInt(AF[AB].top)+AF[AB].editorNode.clientHeight){AJ=false;break;}}if(AJ){b.maxHeight=AA+this.editorNode.clientHeight+10;if(b.maxHeight>AE){R(b,g);}}z.left=AH+"px";z.top=AA+"px";this.top=AA+"px";this.left=AH+"px";var f=g.tables[this.id];if(f&&f.njoins>0){b.linker.drawLinks();}if(b.maxWidth<=m){b.domNode.scrollLeft=0;}if(b.maxHeight<=AE){b.domNode.scrollTop=0;}}},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,slot:"containerNode",children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onEsc:function(){if(this.onCancel){this.onCancel();}this.parent.close({cancel:true});}}],onOpen:function(){var d=this.txt,e=this.txtConfig;if(e){for(var b in e){d.set(b,e[b]);}}d.domNode.style.width=d.width;d.focus();},onClose:function(b){if(!b||(!b.cancel&&!b.enter)){this.txt.onEnter();}}},_set_height:function(e,d){var c=this.searchBox.visible?this.searchBoxNode.clientHeight:0;if(this.editorNode&&parseInt(d)>this.titlebarNode.clientHeight+c){var b=this.editorNode.style;b.height=parseInt(d)+"px";this.containerNode.style.height=parseInt(b.height)-this.titlebarNode.clientHeight-1-c+"px";}},useRichTooltip:true,showTooltip:function G(c,f){var e=mstrmojo.dom;var d=c.target||e.eventTarget(c.hWin,c.e);if(d.className&&((d.className==="mstrmojo-qb-DBTable-title")||(d.className==="mstrmojo-qb-DBTable-titleIcon"))){d=d.parentNode.parentNode.parentNode.children[0].children[2].children[0];var b=e.position(d);this.set("richTooltip",{posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:d.textContent,top:b.y+b.h+5,left:b.x});mstrmojo._HasTooltip.showTooltip.call(this,c,f);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.qb.menu.SimpleGridMenu");var I=mstrmojo.string,H=mstrmojo.array;var C;function G(K){var J=[];H.forEach(K,function(L){J.push(L.v);});return J.join("");}mstrmojo.qb.QBSimplePreview=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.qb.QBSimplePreview",resizeColumnBehavior:mstrmojo.RESIZE_ALL_COLUMN_MODE,dataset:null,mappings:null,selectedColumns:null,visible:false,cssClass:"lockHeader mstrmojo-qb-simplepreview",lockHeader:true,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},menuButton:null,adjustSize:function(N){var M=200,L=this.parent&&this.parent.domNode,P=M*N;if(!L||!this.scrollboxNode){return ;}this.scrollboxNode.style.overflow="hidden";this.contentWidth=Math.max(P,L.clientWidth)+"px";var K=this.contentWidth,O=this.headerContainerNode,J=this.itemsContainerNode;if(K&&O&&J){O.style.width=K;J.style.width=K;}},onmouseover:function(){var L=200,K=this.mappings.length,J=this.parent&&this.parent.domNode,M=L*K;this.scrollboxNode.style.overflowX=(M>J.clientWidth)?"auto":"hidden";this.scrollboxNode.style.overflowY="auto";},onmouseout:function(){this.scrollboxNode.style.overflow="hidden";},onheightChange:function D(){var L=this.height,J=this.headerContainerNode,K=this.scrollboxNode;if(L&&J&&K){K.style.height=parseInt(L,10)-J.clientHeight+"px";}this.domNode.style.height=this.height;},onwidthChange:function E(){if(this.domNode&&this.mappings){this.domNode.style.width="100%";this.adjustSize(this.mappings.length);}},postBuildRendering:function B(){if(this._super){this._super();}mstrmojo.dom.attachMarkupEvent(this.id,this.domNode,"mouseover");mstrmojo.dom.attachMarkupEvent(this.id,this.domNode,"mouseout");},populatePreview:function A(){var O=this.mappings,R=this.selectedColumns,K=0,J=this.scrollboxNode,N,Q,L,M,S=this;this.columns=[];if(J){K=J.scrollLeft||0;}this.unrender();if(this.isRefined&&!mstrApp.isFFSQLMode){H.forEach(R,function(W,Z){var b=W.colo,a,V;a=mstrApp.isFFSQLMode?W.n:G(R[Z].expr);V={tag:W,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:Z,headerText:a,menuCssClass:mstrApp.isFFSQLMode?"":"mstrmojo-qb-simplegrid-itemmenu",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@headerText}</span><span class="{@menuCssClass}" mstrAttach:click></span></div>',useRichTooltip:true,postBuildRendering:function Y(){if(this._super){this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:a});if(!this._ontooltipover){var c=this.id;this._ontooltipover=function(f){var d=mstrmojo.all[c];d.showTooltip(f,self);};this._ontooltipout=function(f){var d=mstrmojo.all[c];d.hideTooltip(f,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);},onclick:function X(){var e=this.columnIndex,d=mstrApp.isFFSQLMode;if(d){return ;}C.showPopupMenu(S,{menuNode:this.domNode.lastChild,data:{columnIndex:e,isVisible:function c(g,f){return d?false:true;}}});}},colWidth:"60",dataFunction:function(h,e,g){var c=h[this.dataField],f="mstrmojo-di-datapreview-DataRow-text";f+=(e%2===1)?" odd":" even";return'<div class="'+f+'" title="'+c+'">'+c+"</div>";},dataField:Z.toString()};S.columns.push(V);});}else{H.forEach(O,function(W,Z){var b=W.colo,a,V;a=mstrApp.isFFSQLMode?W.n:G(R[b].expr);V={tag:W,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:b,headerText:a,menuCssClass:mstrApp.isFFSQLMode?"":"mstrmojo-qb-simplegrid-itemmenu",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@headerText}</span><span class="{@menuCssClass}" mstrAttach:click></span></div>',useRichTooltip:true,postBuildRendering:function Y(){if(this._super){this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:a});if(!this._ontooltipover){var c=this.id;this._ontooltipover=function(f){var d=mstrmojo.all[c];d.showTooltip(f,self);};this._ontooltipout=function(f){var d=mstrmojo.all[c];d.hideTooltip(f,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);},onclick:function X(){var e=this.columnIndex,d=mstrApp.isFFSQLMode;if(d){return ;}C.showPopupMenu(S,{menuNode:this.domNode.lastChild,data:{columnIndex:e,isVisible:function c(g,f){return d?false:true;}}});}},colWidth:"60",dataFunction:function(h,e,g){var c=h[this.dataField],f="mstrmojo-di-datapreview-DataRow-text";f+=(e%2===1)?" odd":" even";return'<div class="'+f+'" title="'+c+'">'+c+"</div>";},dataField:Z.toString()};S.columns.push(V);});}L=this.dataset;if(L.length===0&&this.columns.length>0){var T=21;var P=parseInt(parseInt(this.parent.height,10)/T,10)-1;P=P>0?P:1;var U;for(N=0;N<P;N++){U=[];for(M=0,Q=this.columns.length;M<Q;M++){U.push("");}L.push(U);}}this.items=L;this.render();this.adjustSize(O.length);this.scrollboxNode.scrollLeft=K;},onvisibleChange:function(J){if(J.value){this.populatePreview();}}});C=mstrmojo.qb.QBSimplePreview;C.showPopupMenu=function F(M,K){var L=C.menuHelper=C.menuHelper||new mstrmojo.qb.menu.SimpleGridMenu();L.target=M;L.data=K.data;var J=L.getMenuConfig();J.hostId=M.id;J.hostElement=K.menuNode;J.isHostedWithin=false;J.position=mstrmojo.dom.position(K.menuNode,true);M.openPopup(J.newInstance());};}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.Editor");mstrmojo.requiresDescs(8538,8513,2523,2399,13708,1162,11134,14295);var B=mstrmojo.hash;function C(){var D=this.dbInfoBox,G,I=this.dsnlessBox,F=this.data.dbRole,H,E=function E(M){var K,J=mstrmojo.desc(M.IDS,M.n),L=M.fieldV;if(J&&J[J.length-1]!==":"){J+=":";}switch(M.tp){case"text":case"number":K=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:J,value:L});K.set("text",L);break;case"list":K=new mstrmojo.warehouse.dbroles.DBRoleSettingPulldown({caption:J,itemIdField:"v",itemField:"v"});K.render();K.set("items",M.options);K.set("selectedID",L);break;case"boolean":K=new mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox({label:J,driverMode:1});K.render();K.setValue(L);break;}K.set("enabled",false);return K;};H=F.dbmsObj.DBInfo.DBS[0].dbVersions[0].DBPS[0].DBP;if(H){mstrmojo.array.forEach(H,function(J){D.addChildren([E(J)]);});}B.forEach(F.dbmsObj.DBInfo.dbTypes,function(K,J){G=J;});I.database.set("enabled",false);I.database.list.set("value",G);I.version.set("enabled",false);I.version.list.set("value",F.dbmsObj.n);this.txtlogin.set("text",F.ln||"");this.txtpwd.set("text",F.password||"");this.txtname.set("text",F.n);this.txtname.set("enabled",false);}mstrmojo.onetier.vi.ui.DBCredentialEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.onetier.vi.ui.DBCredentialEditor",title:"Data Source",help:"pending.htm",data:undefined,cssClass:"mstrmojo-DBCredentialEditor",children:[{alias:"dsnlessBox",scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"database",caption:mstrmojo.desc(8538,"Database:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"version",caption:mstrmojo.desc(2523,"Version:")}]},{alias:"dsnBox",scriptClass:"mstrmojo.Box",visible:false,children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dsn",caption:"dsn:"},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"version",caption:mstrmojo.desc(2523,"Version:")}]},{alias:"dbInfoBox",scriptClass:"mstrmojo.Box",visible:true},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtlogin",isRequired:true,caption:mstrmojo.desc(8513,"login:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtpwd",isPassword:true,isRequired:true,caption:mstrmojo.desc(1162,"password:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtname",caption:mstrmojo.desc(11134,"ds name:")},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",alias:"buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"OK",text:mstrmojo.desc(13708,"Test & Save Changes"),onclick:function(){var F=this.parent.parent,G=F.data,H=F.txtlogin,E=F.txtpwd,D;D=H.isValid();if(!D.val){mstrmojo.alert(D.msg);return ;}D=E.isValid();if(!D.val){mstrmojo.alert(D.msg);return ;}mstrApp.serverRequest({taskId:"setDBCredentials",dbroleinfo:JSON.stringify(B.copy({ln:H.getValue(),password:E.getValue()},B.copy(G.dbRole)))},{success:function I(J){if(J.dbr){G.set("credentialsFetched",true);G.dbRole.ln=H.getValue();G.dbRole.password=E.getValue();F.close();}else{mstrmojo.alert(mstrmojo.desc(14295,"Invalid Username, Password. Please check your login credential again."));}}},{doNotHold:true});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],postBuildRendering:function A(D){this._super(D);C.call(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox","mstrmojo.warehouse.dbroles.DBRoleSettingPulldown");mstrmojo.requiresDescs(14036,14037,14038,14467);var K=mstrmojo.array,D=mstrmojo.hash,G=mstrmojo.warehouse.dbroles.DBRoleHelper,P="MSTR_CUSTOM=true;",I=mstrmojo.desc(14036,"Show connection string"),J=mstrmojo.desc(14037,"Hide connection string"),C=mstrmojo.desc(14038,"Edit connection string");mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor",cssClass:"mstrmojo-wh-DBRoleSettingConnectionStringEditor",enabled:true,getValue:function F(){if(this.visibleContents&&this.enabledContents){var Q=this.contents.connectionArea.value;return G.cleanDSNConnection(Q+(Q.slice(-1)===";"?"":";")+P);}return"";},setValue:function B(Q){var R=this.contents;this.toggleContents();R.editString.setValue(true);R.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(Q).replace(P,""));},isValid:function O(){return{val:true,msg:""};},connectionArea:undefined,driverList:undefined,showLabel:undefined,editString:undefined,info:{},drivers:[],enableFn:mstrmojo.emptyFn,generateConnectionStringFn:mstrmojo.emptyFn,dbID:{},dbms:{},load:function L(){var Y=this.contents,Z=this.dbID,U=this.dbms,S=Z.dbVersions[K.find(Z.dbVersions,"v",U.db_ver)],R=S.connections[0],T=G.driverExists.call(this,[R]),V={},W=[];K.forEach(this.dbIDVersions,function(a){K.forEach(a.dbVersions,function(b){K.forEach(b.connections.concat(b.altconnections),function(c){V[c.driver]=c;});});});var Q;D.forEach(this.drivers,function(a){Q=mstrmojo.hash.clone(a);if(V[a.n]){Q.n=Q.n+" (Certified)";Q.title=Q.n;Q.str=V[a.n].str;}W.push(Q);});Y.driverList.set("items",W);if(T.exists){var X=K.find(this.drivers,"n",T.driver);if(X<0){X=0;}Y.driverList.set("selectedID",W[X].n);}this.updateString();},visibleContents:false,enabledContents:false,toggleContents:function A(){this.visibleContents=!this.visibleContents;this.contents.set("visible",this.visibleContents);this.showLabel.set("text",(this.visibleContents?J:I));if(!this.visibleContents){this.contents.editString.setValue(false);this.enableFn(true);}else{this.load();}},updateString:function N(){if(this.visibleContents){this.contents.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(this.generateConnectionStringFn()));}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-ShowConnection",alias:"showLabel",text:I,onclick:function M(){this.parent.toggleContents();}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionStringContents",alias:"contents",visible:false,children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",label:C,alias:"editString",oncheckedChange:function E(){var Q=this.parent;Q.parent.enableFn(!this.checked);Q.connectionArea.set("enabled",this.checked);Q.driverList.set("enabled",this.checked);Q.parent.enabledContents=this.checked;}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",cssClass:"mstrmojo-wh-DBRolePulldown mstrmojo-wh-DBRoleConnection-driverList",caption:mstrmojo.desc(14467,"Driver"),alias:"driverList",itemIdField:"n",itemField:"n",enabled:false,bindings:{visible:function(){var Q=this.parent.parent;return(Q.dbID.connType&4)!==4;}},onChange:function H(Q){var R=this.parent.parent,T=this.parent.parent.contents,S;if(R.enabledContents){S=Q.str||"";}T.connectionArea.set("value",G.cleanDSNConnectionPlaceHolders(R.generateConnectionStringFn(S).replace(P,"")));}},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionString",value:"",alias:"connectionArea",enabled:false}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.architect.ui.editors.DataSourceEditor","mstrmojo.warehouse.EnumObjectTypes");var J=mstrmojo.array,C=mstrmojo.architect.menu.EnumMenuActions,L=mstrmojo.warehouse.EnumObjectTypes,E=mstrmojo.desc(11398,"Functionality not yet implemented."),G=mstrmojo.desc(6722,"Are you sure you want to delete '##'?"),I="Are you sure you want to delete these ## objects?";var K=false;function F(P,N){var O=this.data,M=(O&&O.length)?O[0]:O;return(M&&M[P])?M[P](O,N):true;}mstrmojo.architect.menu.ArchitectMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.menu.ArchitectMenu",dynamicUpdate:true,queryEnabled:function H(M){return F.call(this,"isEnabled",M)||K;},queryVisible:function D(M){return F.call(this,"isVisible",M)||K;},queryChecked:function B(M){return F.call(this,"isChecked",M)||K;},executeCommand:function(V){var U=mstrmojo.architect.menu.ArchitectMenu.EnumRelationType,Q=this.data,R=mstrApp.getRootController(),P=Q.parentAttributeId,M=Q.childAttributeId,N=Q.relationTableId;switch(V.action){case C.NONE:break;case C.DELETE:var O;if(Q.length){O=I.replace("##",Q.length);}else{O=G.replace("##",Q.n);}mstrmojo.confirm(O,{confirmBtn:{fn:function(){R.deleteObject(Q);}}});break;case C.RENAME:R.renameObject(Q);break;case C.AUTOMAP:R.autoMapTable([].concat(Q));break;case C.SAMPLE_DATA:R.showSampleData(Q);break;case C.CONVERT_ATTR_TO_FACT:R.convertAttributeToFact(Q);break;case C.CONVERT_ATTR_TO_FORM:R.convertAttributeToForm(Q,V);break;case C.LOGICAL_TABLE_SIZE:R.setTableLogicalSize(Q);break;case C.CONVERT_COLUMN_TO_FORM:R.convertColumnToForm(Q,V);break;case C.SET_AS_MULTILINGUAL:R.setAsMultiLingual(Q);break;case C.CONVERT_FACT_TO_ATTR:R.convertFactToAttribute(Q);break;case C.REMOVE_FROM_TABLE:R.removeFromTable(Q);break;case C.SET_AS_LOOKUP:R.setAsLookup(Q);break;case C.NEW_FACT:V.tp=L.FACT;V.isNew=true;R.openExpressionEditor(Q,V);break;case C.NEW_ATTR:V.tp=L.ATTRIBUTE;V.isNew=true;R.openExpressionEditor(Q,V);break;case C.UPDATE_FORMAT:R.updateFormFormat(Q,V);break;case C.EDIT:V.tp=Q.tp;V.isNew=false;R.openExpressionEditor(Q,V);break;case C.MAPPING:R.updateMappingMethod(Q,V);break;case C.UPDATE_AGGR:R.updateAggregation(Q,V);break;case C.REMOVE_TABLE:R.removeFromCurrentLayer(Q);break;case C.ADD_ATTRIBUTE:R.createAttribute(Q);break;case C.ADD_FACT:R.createFact(Q);break;case C.DATA_SOURCES:var T=mstrmojo.all[this._dseid]||new mstrmojo.architect.ui.editors.DataSourceEditor({onSubmit:function S(W){R.setTableDBRoles(W);}});this._dseid=T.id;T.open(undefined,{dataSources:R.getTableDBRoles(Q)});break;case C.REMOVE_ATTR_FROM_RELATIONSHIP:R.removeAttributeFromRelation(Q);break;case C.DELETE_RELATIONSHIP:R.removeRelation(P,M);return ;case C.ONE_TO_ONE:R.updateRelation(P,M,U.ONE_TO_ONE,N);break;case C.ONE_TO_MANY:R.updateRelation(P,M,U.ONE_TO_MANY,N);break;case C.MANY_TO_MANY:R.updateRelation(P,M,U.MANY_TO_MANY,N);break;case C.RELATIONSHIP_TABLE_ENTRY:R.updateRelation(P,M,Q.relationType,V.did);break;case C.SHOW_UNUSED_COLUMNS:R.changeLayerTableColumnView([].concat(Q),V);break;case C.ADD_TO_LAYER:R.addOrRemoveTables([].concat(Q),true);break;case C.REMOVE_FROM_LAYER:R.addOrRemoveTables([].concat(Q),false);break;case C.UPSTRUCT:R.handleUpdateStructures([].concat(Q));break;case C.CREATE_ALIAS:R.createTableAlias([].concat(Q));break;case C.LINKS:R.showLinks(Q);break;case C.UPDATE_CATEGORY:R.updateFormCategory(Q,V);break;case C.UNGROUP_FORMS:R.unGroupForms(Q,V);break;case C.UPDATE_GROUP:R.groupForms([Q],V);break;case C.UNGROUP_FORM:R.unGroupForms(Q,V);break;case C.TX_ONE_TO_ONE:R.setTransformationCardinality(Q.did,true);break;case C.TX_MANY_TO_MANY:R.setTransformationCardinality(Q.did,false);break;case C.TX_APPLY_TO_ALL:R.setTransformationAllAttributes(Q.did,true);break;case C.TX_APPLY_TO_HIGHEST:R.setTransformationAllAttributes(Q.did,false);break;case C.SET_ENTRY_POINT:R.addEntryPoint(Q.attributeId);break;case C.REMOVE_ENTRY_POINT:R.removeEntryPoint(Q.attributeId);break;case C.ATTRIBUTE_FILTERS:R.editFilters(Q.attributeId,undefined,undefined);break;case C.ADD_JOIN_CHILDREN:R.addJointChildren(Q,V.did);break;case C.USE_AS_DRILL:R.updateHiearchySubtype(true);break;case C.USE_AS_BROWSE:R.updateHiearchySubtype(false);break;default:mstrmojo.alert(E);break;}},getMenuConfig:function A(N){var Q=new mstrmojo.ui.menus.MenuConfig(),R=this.id,O=false,M,P=N||this.cm;J.forEach(P,function(T){M=T.action===C.NONE;if(this.queryVisible(T)){var S=["xt "+(T.icn||"")],U=function U(){this.executeCommand(T);};if((this.queryEnabled(T)===false)||M){if((M&&!O)||!M){S.push(M?"sep":"");Q.addDisabledMenuItem(T.n,S.join(" "));}if(M){O=true;}}else{if(T.items){Q.addSubMenuItem(T.n,"",R,T.buildSubMenuConfig||this.getMenuConfig,T.items);O=false;}else{if(T.hasEdt){Q.addEditorMenuItem(T.n,R,T.buildSubMenuConfig);O=false;}else{Q.addToggleMenuItem(T.n||"",S.join(" "),U,U,R,this.queryChecked(T));O=false;}}}}},this);return Q;}});mstrmojo.architect.menu.ArchitectMenu.EnumRelationType={ONE_TO_ONE:1,ONE_TO_MANY:2,MANY_TO_MANY:4,PARENT_CHILD:0};}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.StackContainer","mstrmojo.ui.CheckList","mstrmojo.DI.DIResourceAdmin","mstrmojo.DI.DIDBRoleAdmin","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(14460,14461);var C=mstrmojo.DI.DIConstants,D=0,B=1;mstrmojo.DI.DISourceListAdmin=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DISourceListAdmin",mode:D,markupString:'<div id="{@id}" class="mstrmojo-di-sources-admin {@cssClass}"><div class="mstrmojo-di-source-headers"></div><div class = "mstrmojo-di-source-content"></div></div>',markupSlots:{headersNode:function(){return this.domNode.children[0];},contentsNode:function(){return this.domNode.children[1];}},onmodeChange:function(){this.contentStack.set("selected",this.contentStack.children[this.mode]);},children:[{slot:"headersNode",scriptClass:"mstrmojo.ui.ButtonBar",cssClass:"mstrmojo-di-source-menu",renderOnScroll:false,showIcon:false,selectedIndex:0,postselectionChange:function(E){var F=E.added&&this.items[E.added[0]].v;this.parent.set("mode",F);},items:[{n:mstrmojo.desc(14460,"Resources"),v:D},{n:mstrmojo.desc(14461,"Databases"),v:B}]},{scriptClass:"mstrmojo.StackContainer",alias:"contentStack",cssClass:"mstrmojo-di-source-content-stack",slot:"contentsNode",children:[{scriptClass:"mstrmojo.DI.DIResourceAdmin",visible:true},{scriptClass:"mstrmojo.DI.DIDBRoleAdmin",visible:false}]}],preBuildRendering:function(){if(this._super){this._super();}var E=mstrApp.getRootController().getModel();this.onmodeChange();E.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},adjustSize:function(E){var F=Math.floor(parseInt(E.size.w,10));if(!isNaN(F)&&F>0){this.set("width",F+"px");}},onFinishButtonClick:function(){var E=this.contentStack;mstrApp.getRootController().saveSourceListAdminConfig(E.children[0].getAdminConfig(),E.children[1].getAdminConfig());},onBackButtonClick:function(){mstrApp.getRootController().showPage(C.pageType.dataSelection);},onCancelButtonClick:function(){mstrApp.getRootController().showPage(C.pageType.dataSelection);return true;},onHelpButtonClick:function A(){return"";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineSearchablePulldown","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(629,6052,6051,12316,12317,12318,12319,12320,12321,4728,14539,14540,14541,14542,12327,12328,12329,12330,12331,12332,12333,12334,12335,14268,14269,14270,12339,12340,12341,12342,12343,12344,12345,3627,12346,14274,1388,12347,12348,12349,13647,13884,13957,13958,12575,12577,190,14514,14515,14516);var H=mstrmojo.Refine.RefineConstants;var C=mstrmojo.css;var I=mstrmojo.dom;var E=[{name:mstrmojo.desc(629,"Delete"),type:H.transformationType.Delete,items:[{name:mstrmojo.desc(12575,"Delete Column"),subType:H.transformationSubType.DeleteColumn},{name:mstrmojo.desc(12577,"Delete Row"),subType:H.transformationSubType.DeleteRow},{name:mstrmojo.desc(12316,"Remove Duplicate Cells"),subType:H.transformationSubType.RemoveDuplicateCells},{name:mstrmojo.desc(12317,"Remove Duplicate Rows"),subType:H.transformationSubType.RemoveDuplicateRows,noColumn:true},{name:mstrmojo.desc(null,"Delete Row Included In Selectors"),subType:H.transformationSubType.DeleteRowsInTheView},{name:mstrmojo.desc(null,"Delete Row Not-included In Selectors"),subType:H.transformationSubType.DeleteRowsNotInTheView}]},{name:mstrmojo.desc(12318,"Extract"),type:H.transformationType.Extract,items:[{name:mstrmojo.desc(12319,"Extract By Fixed Length"),subType:H.transformationSubType.ExtractByFixedLength},{name:mstrmojo.desc(12320,"Extract Before Separator"),subType:H.transformationSubType.ExtractBeforeSeparator},{name:mstrmojo.desc(12321,"Extract After Separator"),subType:H.transformationSubType.ExtractAfterSeparator}]},{name:mstrmojo.desc(4728,"Selector"),type:H.transformationType.Facet,items:[{name:mstrmojo.desc(14539,"Text Selector"),subType:H.transformationSubType.TextFacet},{name:mstrmojo.desc(14540,"Numeric Selector"),subType:H.transformationSubType.NumericFacet},{name:mstrmojo.desc(14541,"Timeline Selector"),subType:H.transformationSubType.TimelineFacet},{name:mstrmojo.desc(14542,"Text Search"),subType:H.transformationSubType.SearchFacet}]},{name:mstrmojo.desc(12327,"Find And Replace"),type:H.transformationType.FindAndReplace,items:[{name:mstrmojo.desc(12328,"Find And Replace Characters In Cell"),subType:H.transformationSubType.FindAndReplaceCharactersInCell},{name:mstrmojo.desc(12329,"Find And Replace Cell"),subType:H.transformationSubType.FindAndReplaceCell}]},{name:mstrmojo.desc(190,"Remove"),type:H.transformationType.RemoveText,items:[{name:mstrmojo.desc(14514,"Remove Characters"),subType:H.transformationSubType.RemoveTheText},{name:mstrmojo.desc(14515,"Remove Characters Before"),subType:H.transformationSubType.RemoveTheTextBefore},{name:mstrmojo.desc(14516,"Remove Characters After"),subType:H.transformationSubType.RemoveTheTextAfter}]},{name:mstrmojo.desc(12330,"Split"),type:H.transformationType.Split,items:[{name:mstrmojo.desc(12331,"Split By Fixed Length"),subType:H.transformationSubType.SplitByFixedLength},{name:mstrmojo.desc(12332,"Split On Separator"),subType:H.transformationSubType.SplitOnSeparator},{name:mstrmojo.desc(12333,"Split Before Separator"),subType:H.transformationSubType.SplitBeforeSeparator},{name:mstrmojo.desc(12334,"Split After Separator"),subType:H.transformationSubType.SplitAfterSeparator},{name:mstrmojo.desc(13884,"Split Cell Into Rows On Separator"),subType:H.transformationSubType.SplitCellIntoRows}]},{name:mstrmojo.desc(12335,"Transform Cell"),type:H.transformationType.TransformCell,items:[{name:mstrmojo.desc(14268,"To Title Case"),subType:H.transformationSubType.Titlecase},{name:mstrmojo.desc(14269,"To Uppercase"),subType:H.transformationSubType.Uppercase},{name:mstrmojo.desc(14270,"To Lowercase"),subType:H.transformationSubType.Lowercase},{name:mstrmojo.desc(12339,"Unescape HTML"),subType:H.transformationSubType.UnescapeHTML},{name:mstrmojo.desc(12340,"Change Data Type"),subType:H.transformationSubType.ChangeDataType},{name:mstrmojo.desc(12341,"Fill Down"),subType:H.transformationSubType.FillDown},{name:mstrmojo.desc(12342,"Blank Down"),subType:H.transformationSubType.BlankDown},{name:mstrmojo.desc(13957,"Pad Before"),subType:H.transformationSubType.PadBefore},{name:mstrmojo.desc(13958,"Pad After"),subType:H.transformationSubType.PadAfter}]},{name:mstrmojo.desc(12343,"Whitespace"),type:H.transformationType.Whitespace,items:[{name:mstrmojo.desc(12344,"Trim Leading And Trailing Whitespace"),subType:H.transformationSubType.TrimLeadingTrailingWhitespace},{name:mstrmojo.desc(12345,"Collapse Consecutive Whitespace"),subType:H.transformationSubType.CollapseConsecutiveWhitespace}]},{name:mstrmojo.desc(3627,"Other"),type:H.transformationType.Other,items:[{name:mstrmojo.desc(12346,"Cluster And Edit"),subType:H.transformationSubType.ClusterAndEdit},{name:mstrmojo.desc(14274,"Duplicate Column"),subType:H.transformationSubType.Duplicate},{name:mstrmojo.desc(1388,"Rename"),subType:H.transformationSubType.Rename},{name:mstrmojo.desc(12347,"Concatenate Columns"),subType:H.transformationSubType.ConcatenateColumns},{name:mstrmojo.desc(13975,"Transpose Columns To Rows"),subType:H.transformationSubType.TransposeColumnsToRows}]}];mstrmojo.Refine.RefineTransformations=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineTransformations",alias:"RefineTransformations",markupString:'<div class="refine-transformations" mstrAttach:mousedown><div class="refine-transformations-top"><div class="refine-transformations-columns"></div><div class="refine-transformations-functions"></div><div class="refine-transformations-control"></div></div><div class="refine-transformations-suggestions"></div></div>',markupSlots:{transformationNode:function(){return this.domNode.children[0];},columnsNode:function(){return this.domNode.children[0].children[0];},functionNode:function(){return this.domNode.children[0].children[1];},controlNode:function(){return this.domNode.children[0].children[2];},suggestionsNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},setDimensions:function G(N,L){var J=parseInt(N,10);var M=parseInt(L,10);if(isNaN(J)||isNaN(M)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var O=44;C.toggleClass(this.domNode,"selected",true);var K=Math.floor(M*0.65);if(K<980){C.toggleClass(this.domNode,"short",true);}else{C.toggleClass(this.domNode,"short",false);}K=Math.max(Math.floor(M*0.65),618);this.layoutConfig.h.transformationNode=O+"px";this.layoutConfig.w.transformationNode=K+"px";this.layoutConfig.h.suggestionsNode=(J-O-14)+"px";this.layoutConfig.w.suggestionsNode=(K-14)+"px";if(this._super){this._super(J+"px",K+"px");}},postBuildRendering:function B(){this.setDimensions(this.parent.domNode.style.height,this.parent.domNode.style.width);if(this._super){this._super();}},onmousedown:function(J){var L=J.e,K=I.eventTarget(J.hWin,L);if(K.className.indexOf("mstrmojo-scrollbar")===-1){this.controller.isClickedInTransformation=true;I.stopPropogation(J.hWin,J.e);}},populate:function F(L){var J=[],K;for(K=0;K<L.columns.length;K++){J.push({n:L.columns[K].name,name:L.columns[K].name,columnIndex:K,cellIndex:L.columns[K].cellIndex});}J.sort(function(N,M){return N.n.localeCompare(M.n);});this.columns.selectedIndex=null;this.columns.set("items",J);},handleColumnsChanged:function A(J){this.populate(J.value);},handleColumnSelected:function(L){var K,J=this.columns.list.items;for(K=0;K<J.length;K++){if(L.columnIndex===J[K].columnIndex){if(this.columns.list.selectedIndex!==K){this.columns.list.set("selectedIndex",K);}}}},handleColumnUnSelected:function(){this.columns.set("value",mstrmojo.desc(12348,"Select Column"));this.columns.set("text",mstrmojo.desc(12348,"Select Column"));this.columns.selectedIndex=undefined;this.columns.list.set("selectedIndex",null);C.toggleClass(this.columns.domNode,"selected",false);this.transformationList.set("value",mstrmojo.desc(12349,"Select Function"));this.transformationList.set("text",mstrmojo.desc(12349,"Select Function"));this.transformationList.list.set("selectedIndex",null);this.transformationList.set("type",-1);this.transformationList.set("subType",-1);C.toggleClass(this.transformationList.domNode,"selected",false);C.toggleClass(this.transformationList.domNode,"disable",true);this.transformationList.selectedNode.title=mstrmojo.desc(13647,"Select a column for more functions");},children:[{slot:"columnsNode",scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",hostedCSSClass:"refine-column-pulldown",cssClass:"refine-pulldown",alias:"columns",allowHTML:false,title:mstrmojo.desc(13647,"Select a column for more functions"),onitemSelected:function(J){C.toggleClass(this.domNode,"selected",true);C.toggleClass(this.parent.transformationList.domNode,"disable",false);this.parent.transformationList.selectedNode.title="";this.parent.controller.model.raiseEvent({name:"columnSelected",columnIndex:J.columnIndex,columnName:J.n,updateScrollLeft:true});if(this.parent.transformationList.subType===74){this.parent.transformationList.subType=-1;this.parent.transformationList.set("subType",74);}}},{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",hostedCSSClass:"refine-transformation-pulldown",cssClass:"refine-pulldown disable",slot:"functionNode",alias:"transformationList",type:-1,subType:-1,preBuildRendering:function(){this.setItems();},setItems:function(){var U,T,K,N,R=[],Q,M,S;var O,L,P;P=mstrmojo.hash.clone(E);if(mstrApp.getRootController().refineApp.isBDE){P[0].items=P[0].items.slice(0,2);P.splice(2,1);}for(O=0;O<P.length;O++){Q=P[O];K=Q.name;S=Q.items;U={};U.type=Q.type;U.n=K;U.cls="refine-transformations-list-big";U.skipSearch=true;R.push(U);for(L=0;L<S.length;L++){U={};M=S[L];N=M.name;U.subType=M.subType;U.type=Q.type;T="refine-transformations-list-small";if(M.noColumn===true){U.noColumn=true;T="refine-transformations-list-small noColumn";}if(M.subType===H.transformationSubType.DeleteRowsInTheView||M.subType===H.transformationSubType.DeleteRowsNotInTheView){var J=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;if(!J.hasSelection()){U.disable=true;T="refine-transformations-list-small disable";}else{U.noColumn=true;T="refine-transformations-list-small noColumn";}}U.n=N;U.cls=T;R.push(U);}}this.set("items",R);},onitemSelected:function(J){C.toggleClass(this.domNode,"selected",true);this.set("noColumn",J.noColumn);this.set("subType",J.subType);this.set("type",J.type);},getPopupListConfig:function D(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,listHooks:{select:function J(M,P,L){var O=this.parent.parent;var N=O.columns.selectedIndex;if((N===undefined&&P.noColumn!==true)||P.subType===undefined||P.disable===true){return true;}this.parent.set("selectedIndex",L);this.close();}},getItemProps:function K(M,L){return mstrmojo._IsList.getItemProps.call(this,M,L);}};}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.SearchablePulldown");var G=13,F=mstrmojo.array;mstrmojo.DI.DISearchableTextBox=mstrmojo.declare(mstrmojo.ui.SearchablePulldown,null,{scriptClass:"mstrmojo.DI.DISearchableTextBox",allowCustomInput:true,allowCustomText:true,editOnClick:true,editOnDoubleClick:true,onclick:function I(){this.set("isEditing",true);},onmousedown:function C(J){var K=J.getTarget();if(K===this.selectedNode){var L=this.getPopupList();if(!L.visible&&L.items.length>0){L.open(this);}J.cancel();}},onPopupWidgetClosed:function D(){var M=this.getPopupList(),N=M._oldItems,K=this.text;delete M._oldItems;if(N){var J=F.find(N,"n",K);if(J===-1&&!this.allowCustomText){var L=M.items[0]||N[0];J=F.find(N,"n",L.n);}M.set("items",N);}},onkeydown:function E(K){this._super(K);var J=this;if(K.e.keyCode===G){window.setTimeout(function(){J.onitemSelected(null,-1);},0);}},populateList:function H(){var Q=this.getPopupList();var M=mstrApp.getRootController().model.wikiSuggestions;var K=[],P=Q._oldItems||Q.items;var L;if(M.length===0){Q.set("visible",false);return ;}if(M){for(L=0;L<M.length;L++){K.push({n:M[L],rgt:""});}}var O=this.selectedNode.innerText||this.selectedNode.textContent||"";var N=mstrmojo.string.trim(O),J=N.toUpperCase();Q._spft=J;Q.set("items",K);Q.selectedIndex=-1;Q.adjustCornersForPopupOverflow();delete Q._spft;Q._oldItems=P;if(!Q.visible){Q.open(this);}},onkeyup:function B(K){if(this._super){this._super(K);}var L=this.getPopupList();var J=this.selectedNode.innerText||this.selectedNode.textContent||"";if(!J||J.length===0){L.set("visible",false);}else{mstrApp.getRootController().scrapeWiki(J,true);}},postBuildRendering:function A(){if(this._super){this._super();}var K=this.domNode;mstrmojo.dom.attachEvent(K,"paste",function J(M){var L="";setTimeout(function(){L=K.children[0].innerText;L=L.replace(/<\/?.+?>/g," ").replace(/[\r\n]/g," ").replace(/\r/g," ").replace(/\n/g," ").replace(/\s+/g," ");K.children[0].innerText=L;});});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown","mstrmojo.ui.SearchablePulldown");var C=mstrmojo.css,H=mstrmojo.array,A=13;function E(I){H.forEach(I,function(J){var K=J.anc.items;J.title="";if(K){H.forEach(K,function(L){J.title+=L.n+"/";});}});}function G(){var N=mstrmojo.string.trim(this.selectedNode.innerText||this.selectedNode.innerHTML),M=this,I,P,L,O;if(!N||!M.isEditing){M.getPopupList()._oldItems=null;M.getPopupList().set("items",[]);M.getPopupList().set("visible",false);return ;}N=N.toString();N=N.replace(/<BR>/,"").replace(/<br>/,"").replace("\u00A0","\u0020");P={success:function Q(T){O=mstrmojo.string.trim(M.selectedNode.innerText||M.selectedNode.innerHTML);O=O.toString();O=O.replace(/<BR>/,"").replace(/<br>/,"").replace("\u00A0","\u0020");var U=M.getPopupList(),R=T.items,S=false;if(O===N){E(R);U._spft=(N||"").toUpperCase();M.set("items",R);U.set("items",R);if(!R||R.length===0){M.closePopup();}else{S=true;}}else{U._oldItems=null;M.set("items",[]);M.closePopup();}var V=U._oldItems||U.items;if(S){M.openPopup(U);}delete U._spft;U._oldItems=V;},failure:function K(R){if(M.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+R.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));}},complete:function J(){M.set("isEditing",true);C.removeClass(M.domNode,"wait");}};if(typeof microstrategy!=="undefined"&&microstrategy.useQuickSearch){I=microstrategy.useQuickSearch();}else{I=false;}L={styleName:"MojoFolderStyle",nameWildcards:I?16:1,blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:true,includeAncestorInfo:true,objectType:"12",quickSearch:I};L.searchPattern=I?N:N+"*";mstrApp.getRootController().getDataService().searchMetadata(P,L);}mstrmojo.DI.DISearchablePulldown=mstrmojo.declare(mstrmojo.ui.SearchablePulldown,null,{scriptClass:"mstrmojo.DI.DISearchablePulldown",onPopupWidgetClosed:mstrmojo.emptyFn,onkeyup:function D(N){var J=window.event||N.e,I=this.getPopupList(),O=this.selectedNode.innerText||this.selectedNode.textContent,P=O.replace(/\n/g,""),K;if(J.keyCode===A){if(this.selectedNode.innerText){this.selectedNode.innerText=P;}else{this.selectedNode.textContent=P;}this.set("isEditing",true);I._oldItems=null;if(this.items&&this.items.length){this.set("items",[]);}C.addClass(this.domNode,"wait");if(typeof microstrategy!=="undefined"&&microstrategy.enableQuickSearch){if(this._autoSearchTimer){self.clearTimeout(this._autoSearchTimer);}var M=1000,L=this;if(M){this._autoSearchTimer=self.setTimeout(function(){G.call(L);},M);}}else{G.call(this);}}else{K=(P||"").length>0;C.toggleClass(this.selectedNode,"clear",K);if(I._oldItems){I._oldItems=null;}if(this.items&&this.items.length){this.set("items",[]);}this.closePopup();}},onkeydown:function(J){var I=window.event||J.e;if(I.keyCode===A){I.preventDefault();return false;}},onclick:function B(I){var L=I.getTarget(),K=this.selectedNode,J=I.e.offsetX>=(K.offsetWidth-19),M=this.getPopupList();if(L===this.selectedNode&&!J){this.set("isEditing",true);if(!M.visible&&this.items&&this.items.length>0){this.openPopup(M);}else{this.closePopup();}}if(J&&this.selectedNode.className.indexOf("clear")>=0){this.set("text","");this.set("isEditing",true);C.toggleClass(this.selectedNode,"clear",false);this.set("selectedIndex",-1);this.set("items",[]);M._oldItems=null;this.closePopup();}I.cancel();},_set_items:function F(M,J){var K=this.items,I=this.getPopupList(),L;if(this.isEditing){delete this.selectedIndex;this.items=J;I.set("items",J);L=(K!==J);}else{L=this._super(M,J);}return L;},onselectedIndexChange:function(){var I=this.selectedIndex;if(this._super){this._super();}if(I>=0){C.toggleClass(this.selectedNode,"clear",true);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Box","mstrmojo.ui.SearchablePulldown");mstrmojo.requiresDescs(14185,14186,14187);var K=mstrmojo.array,J=mstrmojo.dom,M=mstrmojo.desc(14185,"Search for a namespace"),F=mstrmojo.desc(14186,"Loading namespaces..."),I=mstrmojo.desc(14187,"Update namespaces"),Q=mstrmojo.warehouse.EnumDataChangeEvents;var D=31;mstrmojo.warehouse.ui.NameSpacePullDown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.NameSpacePullDown",cssClass:"mstrmojo-wh-NameSpacePullDown",visible:false,pulldown:undefined,btnRefreshNS:undefined,selectedIndex:undefined,children:[{scriptClass:"mstrmojo.ui.SearchablePulldown",alias:"pulldown",isHostedWithin:false,hostedCSSClass:"mstrmojo-wh-Panel.AvailableTables",visible:false,nameSpacesLoaded:undefined,renderOnScroll:true,updateText:function E(R){this.selectedNode.textContent=R;},onPopupWidgetOpened:function H(){this.getPopupWidget().set("width",mstrmojo.dom.position(this.domNode).w+"px");},onitemSelected:function B(R){if(this.parent.mode===1){if(this.getPopupList()._oldItems!==undefined){return ;}this.parent.selectedIndex=this.selectedIndex;if(this.parent.onItemSelectedCallback){this.parent.onItemSelectedCallback(R);}}else{this.updateText(F);this.parent.selectedIndex=undefined;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-btnRefreshNS",alias:"btnRefreshNS",visible:false,onclick:function P(){mstrApp.rootController.getNameSpaces({sourceInfo:this.parent.sourceInfo,getFresh:true});},title:I,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var R=J.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",top:Math.max(R.y+40,0),left:Math.max(R.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});},onvisibleChange:function N(R){var S=this.parent.domNode.clientWidth||parseInt(this.parent.width,10);if(typeof S==="number"&&S>0){this.parent.pulldown.set("width",S-(this.visible?D:0)+"px");}}}],onwidthChange:function G(R){var S=parseInt(R.value,10);if(S>0){this.pulldown.set("width",S-(this.btnRefreshNS.visible?D:0)+"px");}},onvisibleChange:function N(R){var S=this.domNode.clientWidth||parseInt(this.width,10);if(this.visible&&typeof S==="number"&&S>0){this.pulldown.set("width",S-D+"px");}},postBuildRendering:function A(){if(this._super){this._super();}if(J.isIE8||J.isIE9){mstrmojo.css.addClass(this.domNode,"ie9");}},init:function O(S){this._super(S);var V=this,T={},R=T[this.id]={};R[Q.NAMESPACES_CHANGED]=function U(W){V.loadNameSpaces(W);};R[Q.NAMESPACES_REQUESTED]=function U(W){V.preLoadNameSpaces(W);};mstrApp.getRootController().attachDataChangeListeners(T);},mode:0,preLoadNameSpaces:function C(R){if(!((this.sourceInfo===R.sourceInfo)||(R.sourceInfo==="")||(R.sourceInfo===undefined))){return ;}var S=[];this.mode=0;S[0]={n:""};S[1]={n:F};this.pulldown.set("items",S);this.pulldown.set("selectedIndex",0);this.pulldown.set("visible",true);this.set("visible",true);this.pulldown.updateText(M);},loadNameSpaces:function L(V){if(!((this.sourceInfo===V.sourceInfo)||(V.sourceInfo==="")||(V.sourceInfo===undefined))){return ;}var S=V.namespaces||[],X=true,Y=V.dbRoleID,T,W,Z=-1;if(S.length===0){S.push({n:""});X=false;}S=S.sort(function(d,c){return d.n.toLowerCase().localeCompare(c.n.toLowerCase());});var U=this.pulldown.selectedNode.innerHTML,R=this.pulldown.getPopupList().visible;if(R){this.pulldown.getPopupList().close();}this.mode=1;this.pulldown.set("items",S);this.pulldown.set("visible",X);this.set("visible",X);this.btnRefreshNS.set("visible",X);if(!X&&!V.error){this.pulldown.set("selectedIndex",0);}this.dbRoleID=Y;if(this.nameSpacesLoaded){this.nameSpacesLoaded();}if(X){if(R){this.pulldown.getPopupList().open();}if(mstrApp.getRootController().isUsingCookieNamespace()){T=window.localStorage;W=(T&&T.getItem(Y));Z=K.find(S,"n",W);}if(Z>=0){this.pulldown.set("selectedIndex",Z);}else{this.pulldown.updateText(U);}if(U!==M){this.pulldown.processSearch();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher","mstrmojo.Widget","mstrmojo.fx","mstrmojo.locales","mstrmojo.expr","mstrmojo.Button","mstrmojo.date","mstrmojo.ui.editors.controls.Stepper","mstrmojo.css");var AF=function(){return mstrmojo.locales.datetime;},j=mstrmojo.dom,h=mstrmojo.expr,AC=h.DTP,Z=mstrmojo.date,J=mstrmojo.publisher,e=mstrmojo.hash,l=mstrmojo.array,N=l.removeIndices,k=mstrmojo.css;var AE=0,C=3,M=4,o=5,Q=6;var AG="month",c="day",V="year",X="hour",AJ="minute",z="second";var G='<table border="0" cellpadding="0" cellspacing="0">',x="</table>";function O(AK){return'<table border="0" cellpadding="0" cellspacing="0" style="'+AK+'">';}function H(AN,AK,AL){var AM=Z.getFirstDateOfMonth(AN,AK);return(AM.getDay()-AL+8)%7;}function m(AN){var AM=Z.parseDateAndOrTime(AN),AO,AK,AL;if(AM){AL={};AO=AM.date;AK=AM.time;if(AO){e.copy(AO,AL);}if(AK){e.copy(AK,AL);}}return AL;}function F(AL,AO,AN,AM,AK){var AP=Z.formatDateInfo({day:AL,month:AO,year:AN},AF().DATEOUTPUTFORMAT);return Z.inDateTimeRange(AP,AM,AK)===0;}function T(AO,AN,AM){var AL=AO.decreaseButton,AK=AO.increaseButton,AP="mstrmojo-Calendar";AL.className=(AP+"-decrease");AK.className=(AP+"-increase");}function W(AO,AL,AQ,AN){var AM=0,AK=AO.length,AP;for(AM=0;AM<AK;AM++){AP=AO[AM];if(AP&&AP.day===AL&&AP.month===AQ&&AP.year===AN){return AM;}}return -1;}function p(AK,AM,AL){var AN=new Date();return(AN.getFullYear()===AL)&&((AN.getMonth()+1)===AM)&&(AN.getDate()===AK);}function w(AR,AS){var AW=AR.dayView.getElementsByTagName("div"),AU=AR.selectedDates,AM=AU[AS],AV=AR.browseYear,AL=AR.browseMonth,AO=Z.getDaysOfMonth(AV,AL),AN=Z.getPreMonth(AV,AL),AQ=Z.getDaysOfMonth(AN.y,AN.m),AK=H(AV,AL,AR.firstDayOfWeek),AP=((AM.month===AL)?AM.day+AK-1:(AM.month>AL?AM.day+AK+AO-1:AK-AQ+AM.day-1)),AT=AW[AP];if(AT){b(AT,AR,false);}N(AU,AS,1);}function B(AK){var AL=AK.selectedDates;while(AL.length){w(AK,0);}}function AI(AM,AK){var AL=K(AM,AK),AN=AM.selectedDates;AN.push({day:AL.d,month:AL.m,year:AL.y});b(AK,AM,true);}function n(AM,AN){if(!AN||!AN.length){return null;}var AP=AM.selectedDates;for(var AL=0,AK=AN.length;AL<AK;AL++){var AO=AN[AL],AQ=q(AM,AO);AP.push({day:AO.d,month:AO.m,year:AO.y});if(AQ){b(AQ,AM,true);}}}function q(AS,AU){var AW=AS.dayView.getElementsByTagName("div"),AN=AW.length,AV=AS.browseYear,AL=AS.browseMonth,AO=Z.getPreMonth(AV,AL),AP=Z.getDaysOfMonth(AO.y,AO.m),Aa=Z.getNextMonth(AV,AL),AM=Z.getDaysOfMonth(AV,AL),AK=H(AV,AL,AS.firstDayOfWeek);var AQ=AK>0?{y:AO.y,m:AO.m,d:AW[0].innerHTML}:{y:AV,m:AL,d:AW[0].innerHTML},AY=(AW.length-AM-AK)>0?{y:Aa.y,m:Aa.m,d:AW[AN-1].innerHTML}:{y:AV,m:AL,d:AW[AN-1].innerHTML},AZ=S(AQ,AU),AR=S(AU,AY),AT=null;if(AZ>=0&&AR>=0){var AX=0;if(AZ<AK){AX=-1;}if(AR<(AW.length-AK-AM)){AX=1;}AT=((AX===0)?AU.d+AK-1:(AX===1?AU.d+AK+AM-1:AK-AP+AU.d-1));return AW[AT];}else{return null;}}function f(AS,AK){var AU=AS.selectedDates,AM=AU.length;if(!AM){return null;}var AL=AU[AM-1],AN=K(AS,AK),AX=S({y:AL.year,m:AL.month,d:AL.day},AN),AY=[],AP=AX>0,AV=Math.abs(AX);for(var AR=0;AR<=AV;AR++){var AQ=new Date(AN.y,AN.m-1,AN.d);AQ.setDate(AQ.getDate()+(AP?-AR:AR));var AW=AQ.getFullYear(),AO=AQ.getMonth()+1,AT=AQ.getDate();if(AS.isDateDisabled(AT,AO,AW,AS.min,AS.max)&&!AS.canSelectDisabledDate){continue;}AY.push({y:AW,m:AO,d:AT});}return AY;}function S(AN,AM){var AK=new Date(AN.y,AN.m-1,AN.d),AL=new Date(AM.y,AM.m-1,AM.d);return(AL-AK)/1000/3600/24;}function K(AM,AK){var AN=AM.browseYear,AP=AM.browseMonth,AO=parseInt(AK.innerHTML,10),AQ=parseInt(AK.getAttribute("m"),10),AL=null;AL=(AQ===0)?{y:AN,m:AP}:(AQ===1?Z.getNextMonth(AN,AP):Z.getPreMonth(AN,AP));AL.d=AO;return AL;}function g(AK){var AM=AK.selectedDates,AL=AM.length;return(AL===0)?null:AM[AL-1];}function b(AL,AM,AK){var AN=AM.selectedColor;k.toggleClass(AL,["selected",AM.selectedCssStyle],AK);AL.parentNode.style.backgroundColor=AK?AN:"";AL.style.backgroundColor=AK?AN:"";}function AB(AK){return AK.selectedColor?('style="background-color:'+AK.selectedColor+';"'):"";}function P(AK){return(AK.tagName.toLowerCase()==="td")?AK.firstChild:AK;}function R(AL,AM){var AN=Z.getDateJson(AL),AK=Z.formatDateInfo(AN,mstrmojo.locales.datetime.DATEOUTPUTFORMAT);if(AM===AC.TIMESTAMP){AK+=" "+Z.formatTimeInfo(this.timeVal,mstrmojo.locales.datetime.TIMEOUTPUTFORMAT);}return AK;}function t(AP,AM){var AK=this.advancedValues,AL=null;AK.set(AP,AM);switch(AK.baseDate){case C:AL=new Date();break;case M:break;case o:break;case Q:break;default:return ;}var AN=AK.monthsToAdjust;if(AN>0){AL.setMonth(AL.getMonth()+(AK.toAddMonths?AN:-AN));}var AO=AK.daysToAdjust;if(AO>0){AL.setDate(AL.getDate()+(AK.toAddDays?AO:-AO));}this.set("value",R.call(this,AL,this.dtp));}function U(){var AK=this.advancedValues,AL=["isDyn"];if(AK.baseDate===AE){return null;}AL.push(AK.baseDate);AL.push(AK.toAddDays?AK.daysToAdjust:-AK.daysToAdjust);AL.push(AK.toAddMonths?AK.monthsToAdjust:-AK.monthsToAdjust);AL.push(0);AL.push(0);AL.push(0);AL.push(0);AL.push(this.value);AL.push(this.timeVal.hour);AL.push(this.timeVal.min);AL.push(this.timeVal.sec);return AL.join("::");}function AH(AK){if(AK.value!==undefined&&this.hasRendered){this.updateSelectedDate();}}function I(AM,AL){var AN=this,AK=function(AO){return AO[0].toUpperCase()+AO.substring(1);};return{scriptClass:"mstrmojo.HBox",cssClass:"dateAdjustBox",alias:AM+"AdjustBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:AL>=0?0:1,onitemSelected:function(AP,AO){t.call(AN,"toAdd"+AK(AM),AO===0);},items:[{did:0,n:mstrmojo.desc(9424,"plus")},{did:1,n:mstrmojo.desc(9425,"minus")}]},{scriptClass:"mstrmojo.ui.editors.controls.Stepper",width:null,height:null,provider:new mstrmojo.NumStepperContentProvider({item:{interval:1,min:0,value:Math.abs(AL)},onTraverse:function(){t.call(AN,AM+"ToAdjust",this.curVal);}})},{scriptClass:"mstrmojo.Label",text:AM==="days"?mstrmojo.desc(707,"Days"):mstrmojo.desc(710,"Months")}]};}function Y(){this.buttonsNode.style.display=(this.wasAdvanced||this.changeValueOnOK||(this.showAdvanced&&this.isAdvanced)?"block":"none");this.advancedNode.style.display=this.showAdvanced?"block":"none";}mstrmojo.Calendar=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Calendar",cssPrefix:"",browseMonth:null,browseYear:null,yearRangStart:null,selectedDates:null,selectedColor:"",isMultiSelect:false,hilightToday:false,yearViewSize:5,cssTextDay:"",cssTextMonth:"",cssTextYear:"",cssTextWeekDay:"",cssTextHeader:"",cssTextMonthYearLabel:"",forceNonEmptySelection:false,showCurMonthDatesOnly:false,currentView:c,duration:600,timeDelimiter:":",dtp:AC.DATE,value:"",firstDayOfWeek:1,changeValueOnOK:false,wasAdvanced:false,showAdvanced:false,isAdvanced:false,dynDateValue:null,canSelectDisabledDate:false,monthNames:function(AK){return AF().MONTHNAME_SHORT[AK];},dayNames:function(AK){return AF().dayShortNames[AK];},min:null,max:null,supportedViews:{day:true,month:true,year:true,hour:true,minute:true,second:true},sDirMatrix:{day:{month:"down",year:"down",hour:"up",minute:"up",second:"up"},month:{day:"up",year:"left",hour:"up",minute:"up",second:"up"},year:{day:"up",month:"right",hour:"up",minute:"up",second:"up"},hour:{day:"down",month:"down",year:"down",minute:"left",second:"left"},minute:{day:"down",month:"down",year:"down",hour:"right",second:"left"},second:{day:"down",month:"down",year:"down",hour:"right",minute:"right"}},markupString:'<div id="{@id}" class="{@cssPrefix} mstrmojo-Calendar {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,mouseover,mouseout><div class="mstrmojo-Calendar-header" style="{@cssTextHeader}"><div class="mstrmojo-Calendar-decrease"></div><div class="mstrmojo-Calendar-increase"></div><div class="mstrmojo-Calendar-title"><span class="mstrmojo-Calendar-monthLabel" style="{@cssTextMonthYearLabel}">{@browseMonth}</span><span class="mstrmojo-Calendar-yearLabel" style="{@cssTextMonthYearLabel}">{@browseYear}</span></div></div><div class="mstrmojo-Calendar-body" style="{@cssTextBody}"><div class="mstrmojo-Calendar-dayView"></div></div><div class="mstrmojo-Calendar-timePart"><span class="mstrmojo-Calendar-hourLabel">00</span><span class="mstrmojo-Calendar-timeDelimiter">{@timeDelimiter}</span><span class="mstrmojo-Calendar-minuteLabel">00</span><span class="mstrmojo-Calendar-timeDelimiter">{@timeDelimiter}</span><span class="mstrmojo-Calendar-secondLabel">00</span><span class="mstrmojo-Calendar-AMPMLabel">AM</span></div><div class="mstrmojo-Calendar-advanced"></div><div class="mstrmojo-Calendar-buttons cf"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onbrowseMonthChange:function(){this.monthLabel.innerHTML=this.monthNames(this.browseMonth-1);},onbrowseYearChange:function(){this.yearLabel.innerHTML=this.browseYear;},ondtpChange:function(){this.timePart.style.display=(this.dtp===AC.TIMESTAMP||this.dtp===AC.TIME)?"block":"none";this.advancedNode.style.display=this.showAdvanced?"block":"none";},onvalueChange:function(){if(this.lastValue===undefined||this.value!==this.lastValue){this.updateSelectedDate();}},onchangeValueOnOKChange:Y,onisAdvancedChange:Y},markupSlots:{monthLabel:function(){return this.domNode.firstChild.lastChild.firstChild;},yearLabel:function(){return this.domNode.firstChild.lastChild.lastChild;},decreaseButton:function(){return this.domNode.firstChild.firstChild;},increaseButton:function(){return this.domNode.firstChild.childNodes[1];},bodyContainer:function(){return this.domNode.childNodes[1];},dayView:function(){return this.domNode.childNodes[1].firstChild;},monthView:function(){return this.domNode.childNodes[1].firstChild;},yearView:function(){return this.domNode.childNodes[1].firstChild;},hourView:function(){return this.domNode.childNodes[1].firstChild;},minuteView:function(){return this.domNode.childNodes[1].firstChild;},secondView:function(){return this.domNode.childNodes[1].firstChild;},timePart:function(){return this.domNode.childNodes[2];},hourLabel:function(){return this.domNode.childNodes[2].firstChild;},minuteLabel:function(){return this.domNode.childNodes[2].childNodes[2];},secondLabel:function(){return this.domNode.childNodes[2].childNodes[4];},AMPMLabel:function(){return this.domNode.childNodes[2].childNodes[5];},advancedNode:function(){return this.domNode.childNodes[3];},buttonsNode:function(){return this.domNode.childNodes[4];}},init:function AD(AK){if(this._super){this._super(AK);}if(this.duration<1){this.duration=1;}if(!this.selectedDates){this.selectedDates=[];}this.timeVal={hour:0,min:0,sec:0};},ondynDateValueChange:function u(AK){if(AK.value!==undefined&&this.hasRendered){this.updateSelectedDate();this.buildChildren();}},onminChange:AH,onmaxChange:AH,buildChildren:function a(){var AQ=this;if(this.showAdvanced){var AN=this.dynDateValue,AM=this.advancedValues||this.addDisposable(new mstrmojo.Model({})),AT=AN&&AN.split("::")||[],AP=AT[1]||AE,AL=AT[2]||0,AU=AT[3]||0,AR=function AR(){if(AQ.isAdvanced){AQ.wasAdvanced=true;AQ.changeValueOnOK=true;}AQ.set("isAdvanced",!AQ.isAdvanced);mstrmojo.css.toggleClass(AQ.markupSlots.dayView.call(AQ),["ddSelected"],AQ.isAdvanced);t.call(AQ,"baseDate",AQ.isAdvanced?3:0);if(AQ.parent&&AQ.parent.nudge&&AQ.isAdvanced){AQ.parent.nudge();}};this.advancedValues=AM;AM.baseDate=parseInt(AP);AM.toAddDays=AL>=0;AM.daysToAdjust=Math.abs(AL);AM.toAddMonths=AU>=0;AM.monthsToAdjust=Math.abs(AU);this.isAdvanced=!!this.dynDateValue;if(this.domNode){mstrmojo.css.toggleClass(this.markupSlots.dayView.call(this),["ddSelected"],this.isAdvanced);}if(this.isAdvanced&&this.value){var AK=m(this.value),AO=this.timeVal;if(AK&&AK.hour!==undefined){AO.hour=AK.hour;AO.min=AK.min;AO.sec=AK.sec;}}t.call(AQ,"baseDate",this.isAdvanced?3:0);this.destroyChildren(false);this.addChildren([{scriptClass:"mstrmojo.HBox",alias:"checkLabel",slot:"advancedNode",children:[{scriptClass:"mstrmojo.ui.Checkbox",alias:"checkbox",checked:!!AQ.isAdvanced,oncheckedChange:AR},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13844,"Dynamic Date"),onclick:function AS(){this.parent.checkbox.onclick();}}]},{scriptClass:"mstrmojo.Box",alias:"advancedPanel",slot:"advancedNode",bindings:{visible:"this.parent.isAdvanced"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9423,"Today"),cssClass:"tdLabel"},I.call(this,"days",AL),I.call(this,"months",AU)]},]);}else{this.destroyChildren(false);}this.addChildren([mstrmojo.Button.newWebButton(mstrmojo.desc(2140,"Cancel"),function(){AQ.parent.close();},false,{slot:"buttonsNode"}),mstrmojo.Button.newWebButton(mstrmojo.desc(1442,"OK"),function(){if(AQ.changeValueOnOK||AQ.isAdvanced||AQ.wasAdvanced){AQ.updateValue(true);}},true,{slot:"buttonsNode"})]);},preBuildRendering:function A(){this.buildChildren();return this._super();},getSelectedDatesAsString:function E(AL){var AK=[];l.forEach(this.selectedDates,function(AM){AK.push(Z.formatDateInfo(AM,AL||AF().DATEOUTPUTFORMAT));});return AK;},updateSelectedDate:function L(AO){var AK=this.value,AL=this.timeVal,AN=this.selectedDates,AM,AP=function(AR,AQ){AR.set("browseYear",AQ.year);AR.set("browseMonth",AQ.month);AR.updateTimePart();AR.updateView(AR.currentView);if(!AR.changeValueOnOK&&AR.hasRendered&&AR.closeOnValueChange!=true){AR.updateValue();}};if(this.wasAdvanced){this.wasAdvanced=false;this.changeValueOnOK=false;}if(AK){AM=m(AK);if(AM&&AM.hour!==undefined){AL.hour=AM.hour;AL.min=AM.min;AL.sec=AM.sec;}}if((AM&&!this.isMultiSelect)||AO){B(this);}if(AN.length===0){if(!AM){if(this.parent.opener&&this.parent.opener.defaultDate){AM=m(this.parent.opener.defaultDate);}else{AM=Z.getDateJson(new Date());}}if(!this.canSelectDisabledDate&&this.isDateDisabled(AM.day,AM.month,AM.year,this.min,this.max)){if(this.min&&Z.compareDate(AM,this.min)<0){AM=m(this.min);}else{if(this.max&&Z.compareDate(AM,this.max)>0){AM=m(this.max);}}}AN.push(AM);AP(this,AM);}else{AM=AN[0];if(!this.value){AP(this,AM);}}},updateValue:function d(AK){var AM=g(this),AL="";if(AM){AL=Z.formatDateInfo(AM,AF().DATEOUTPUTFORMAT);if(this.dtp!==AC.DATE){AL+=" "+Z.formatTimeInfo(this.timeVal,AF().TIMEOUTPUTFORMAT);}}this.lastValue=AL;this.set("value",AL);if(this.showAdvanced){this.set("dynDateValue",AK?U.call(this):null);}if(this.onValueUpdate){this.onValueUpdate();}},updateTimePart:function AA(){var AL=this.timeVal,AK=AL.hour||0,AM=(AK%12===0)?12:(AK%12);this.hourLabel.innerHTML=AM;this.minuteLabel.innerHTML=Z.formatInteger(AL.min||0,2);this.secondLabel.innerHTML=Z.formatInteger(AL.sec||0,2);this.AMPMLabel.innerHTML=AK<12?" "+AF().AM_NAME:" "+AF().PM_NAME;},premousedown:function(AK){var AM=AK.e,AL=j.eventTarget(AK.hWin,AM);if(AL===this.decreaseButton||AL===this.increaseButton){if(j.isFF){j.stopPropogation(window,AM);}return true;}else{return this.processEvent(AL,AM);}},premouseup:function(AK){var AM=AK.e;if(AM.ctrlKey||AM.shiftKey){j.clearBrowserHighlights();}var AL=j.eventTarget(AK.hWin,AM);if(AL===this.decreaseButton&&!AL.disabled){this.decrease();return true;}if(AL===this.increaseButton&&!AL.disabled){this.increase();return true;}},processEvent:function(AV,Ac){var AN=this.currentView,AO=this.selectedDates,AS,AX,Ad,AK,AU;if(AV===this.monthLabel){if(AN!==AG){this.switchViewTo(AG);}return true;}if(AV===this.yearLabel){if(AN!==V){this.adjustYearStart();this.switchViewTo(V);return true;}}if(AV===this.hourLabel){if(AN!==X){this.switchViewTo(X);}return true;}if(AV===this.minuteLabel){if(AN!==AJ){this.switchViewTo(AJ);}return true;}if(AV===this.secondLabel){if(AN!==z){this.switchViewTo(z);}return true;}if(AV===this.AMPMLabel){if(AN!==X){this.switchViewTo(X);}return true;}if(AN===X){var AQ=AV.getAttribute("h");AU=parseInt(AV.innerHTML,10);if(!isNaN(AQ)&&!isNaN(AU)){AQ=parseInt(AQ,10);this.timeVal.hour=AU%12+AQ*12;this.updateTimePart();this.switchViewTo(c);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AN===AJ){AU=parseInt(AV.innerHTML,10);if(!isNaN(AU)){this.timeVal.min=AU;this.updateTimePart();this.switchViewTo(c);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AN===z){AU=parseInt(AV.innerHTML,10);if(!isNaN(AU)){this.timeVal.sec=AU;this.updateTimePart();this.switchViewTo(c);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AN===c){var Ab=this.browseYear,AL=this.browseMonth,AM;AV=P(AV);Ad=parseInt(AV.innerHTML,10);AK=parseInt(AV.getAttribute("m"),10);if(!isNaN(Ad)&&!isNaN(AK)){AM=(AK===0)?{y:Ab,m:AL}:(AK===1?Z.getNextMonth(Ab,AL):Z.getPreMonth(Ab,AL));if((!this.canSelectDisabledDate&&this.isDateDisabled(Ad,AM.m,AM.y,this.min,this.max))||Ac.button===2){return true;}if(this.isAdvanced){return true;}var AY=W(AO,Ad,AL,Ab),AW=AO.length>1,AT=this.forceNonEmptySelection,AZ=this.isMultiSelect,AR=AZ&&Ac.ctrlKey,Aa=AZ&&Ac.shiftKey,AP=null;if(Aa){AP=f(this,AV);B(this);n(this,AP);}else{if(AR){if(AY===-1){AI(this,AV);}else{if(!AT||AW){w(this,AY);}}}else{B(this);if(AW||AY===-1||AT){AI(this,AV);}}}if(this.onselect||J.hasSubs(this.id,"select")){this.raiseEvent({name:"select",value:this.selectedDates});}if(AK===1){this.increase();}else{if(AK===-1){this.decrease();}}if(!this.changeValueOnOK){this.updateValue();}else{if(this.showAdvanced){this.checkLabel.checkbox.set("checked",false);t.call(this,"baseDate",0);}}}return true;}if(AN===AG){AV=P(AV);AX=parseInt(AV.getAttribute("m"),10);if(!isNaN(AX)){this.set("browseMonth",AX+1);this.switchViewTo(c);}return true;}if(AN===V){AV=P(AV);AS=parseInt(AV.innerHTML,10);if(!isNaN(AS)){this.set("browseYear",AS);this.switchViewTo(c);}return true;}return true;},decrease:function(){var AM=this.currentView,AP=AM,AO=this.browseYear,AK=this.browseMonth,AL=this.yearRangStart,AN;switch(AM){case c:AN=Z.getPreMonth(AO,AK);this.set("browseMonth",AN.m);this.set("browseYear",AN.y);break;case AG:this.set("browseYear",AO-1);break;case V:this.yearRangStart=AL-this.yearViewSize*this.yearViewSize;break;case X:AP=z;break;case AJ:AP=X;break;case z:AP=AJ;break;}this.switchViewTo(AP,"right");},increase:function(){var AM=this.currentView,AP=AM,AO=this.browseYear,AK=this.browseMonth,AL=this.yearRangStart,AN;switch(AM){case c:AN=Z.getNextMonth(AO,AK);this.set("browseMonth",AN.m);this.set("browseYear",AN.y);break;case AG:this.set("browseYear",AO+1);break;case V:this.yearRangStart=AL+this.yearViewSize*this.yearViewSize;break;case X:AP=AJ;break;case AJ:AP=z;break;case z:AP=X;break;}this.switchViewTo(AP,"left");},updateView:function(AK){var AL=this[AK+"ViewHTML"]();this[AK+"View"].innerHTML=AL;},adjustYearStart:function(){this.yearRangStart=this.browseYear-10-this.browseYear%5;},switchViewTo:function(AL,AN){var AR="mstrmojo-Calendar-"+AL+"View",AQ=document.createElement("div"),AK=this[this.currentView+"View"],AO=AL+"ViewHTML",AP=this[this.currentView+"Label"],AM=this[AL+"Label"];if(!this.supportedViews[AL]){return ;}if(!AN){AN=this.sDirMatrix[this.currentView][AL];}AQ.className=AR;AQ.innerHTML=this[AO]();this.currentView=AL;this[AL+"View"]=AQ;mstrmojo.css.toggleClass(AQ,["ddSelected"],this.isAdvanced);this._slideIntoView(AK,AQ,AN);},_slideIntoView:function(AO,AS,AM){var AK=this.bodyContainer,AQ=(AM==="left"||AM==="right")?AO.offsetWidth:AO.offsetHeight,AL=(AM==="left"||AM==="right")?"left":"top",AR=(AM==="left"||AM==="up")?AQ:-AQ,AP=new mstrmojo.fx.AnimateProp({props:{},duration:this.duration,interval:this.duration/10,target:AO,onEnd:function(){AK.removeChild(AO);}}),AN=new mstrmojo.fx.AnimateProp({props:{},duration:this.duration,interval:this.duration/10,target:AS});AS.style[AL]=AR+"px";AK.appendChild(AS);AP.props[AL]={start:0,stop:-AR,suffix:"px"};AN.props[AL]={start:AR,stop:0,suffix:"px"};AP.play();AN.play();},dayViewHTML:function(){var AP=this.browseYear,AS=this.browseMonth,AX=Z.getDaysOfMonth(AP,AS),Ab=Z.getPreMonth(AP,AS),AM=Z.getDaysOfMonth(Ab.y,Ab.m),AL=Z.getNextMonth(AP,AS),AT=H(AP,AS,this.firstDayOfWeek),AQ=[],AN=AB(this),Ad=0,AK=this.selectedDates,AV=this.min,AZ=this.max,Ae,AW,Aa,AY,Ac=this.showCurMonthDatesOnly?'style="visibility:hidden;"':"";T(this,{d:AM,m:Ab.m,y:Ab.y},{d:1,m:AL.m,y:AL.y});AQ.push(O(this.cssTextDay));AQ.push(this._dayViewTHead());AQ.push("<tr>");for(Aa=0;Aa<AT;Aa++){Ae=AM-AT+Aa+1;AW=this.isDateDisabled(Ae,Ab.m,Ab.y,AV,AZ)?"disabled":"";AQ.push("<td "+Ac+'><div class="mstrmojo-Calendar-day-pre '+AW+'" m="-1">');AQ.push(Ae);AQ.push("</div></td>");Ad++;}for(Aa=0;Aa<AX;Aa++){Ae=Aa+1;AW=this.isDateDisabled(Ae,AS,AP,AV,AZ)?" disabled":"";var AO=p(Ae,AS,AP),AR=AO?" today":"",AU=W(AK,Ae,AS,AP)!==-1;AR=(this.hilightToday&&AO)?" hilightToday":AR;AQ.push("<td "+(AO?('class="'+AR+'" '):" ")+(AU?AN:"")+'><div class="mstrmojo-Calendar-day-cur'+(AU?(" selected "):"")+AW+'" m="0"'+(AU?AN:"")+">");AQ.push(Aa+1);AQ.push("</div></td>");if((++Ad)%7===0){AQ.push("</tr><tr>");}}for(AY=Ad;AY<42;AY++){Ae=Ad-AX-AT+1;AW=this.isDateDisabled(Ae,AL.m,AL.y,AV,AZ)?"disabled":"";AQ.push("<td "+Ac+'><div class="mstrmojo-Calendar-day-next '+AW+'" m="1">');AQ.push(Ae);AQ.push("</div></td>");if((++Ad)%7===0&&Ad!==42){AQ.push("</tr><tr>");}}AQ.push("</tr>");AQ.push(x);return AQ.join("");},_dayViewTHead:function(){var AN=[],AO='<thead><tr class="mstrmojo-Calendar-thead" style="'+this.cssTextWeekDay+';">',AM="</tr></thead>",AL=this.firstDayOfWeek-1,AP=this.dayNames,AK;AN.push(AO);for(AK=AL;AK<AL+7;AK++){AN.push("<td>");AN.push(AP(AK%7));AN.push("</td>");}AN.push(AM);return AN.join("");},monthViewHTML:function(){var AL=[],AN=this.browseMonth-1,AM=this.browseYear,AK;T(this,{d:31,m:12,y:AM-1},{d:1,m:1,y:AM+1});AL.push(O(this.cssTextMonth));AL.push("<tr>");for(AK=0;AK<12;AK++){AL.push("<td "+((AK===AN)?AB(this):"")+'><div class="mstrmojo-Calendar-month'+((AK===AN)?" selected":"")+'" m="');AL.push(String(AK));AL.push('">');AL.push(this.monthNames(AK));AL.push("</div></td>");if(AK%3===2){AL.push("</tr><tr>");}}AL.pop();AL.push("</tr>");AL.push(x);return AL.join("");},yearViewHTML:function(){var AP=this.yearRangStart,AL=[],AN=this.browseYear,AO,AK,AM=this.yearViewSize;T(this,{d:31,m:12,y:AP-1},{d:1,m:1,y:AP+AM*AM});AL.push(O(this.cssTextYear));AL.push("<tr>");for(AK=0;AK<AM*AM;AK++){AO=AP+AK;AL.push("<td "+((AN===AO)?AB(this):"")+'><div class="mstrmojo-Calendar-year'+((AN===AO)?" selected":"")+'">');AL.push(AO);AL.push("</div></td>");if(AK%AM===(AM-1)){AL.push("</tr><tr>");}}AL.pop();AL.push("</tr>");AL.push(x);return AL.join("");},hourViewHTML:function(){var AM=[],AL=this.timeVal.hour,AK;AM.push(G);AM.push('<tr><td colspan="6"><div class="mstrmojo-Calendar-hourTitle">');AM.push(AF().AM_NAME);AM.push("</div></td></tr>");for(AK=0;AK<12;AK++){AM.push('<td><div class="mstrmojo-Calendar-hour'+((AK===AL)?" selected":"")+'" h="0">');AM.push((AK===0)?12:AK);AM.push("</div></td>");if(AK===5){AM.push("</tr><tr>");}}AM.push('</tr><tr><td colspan="6"><div class="mstrmojo-Calendar-hourTitle">');AM.push(AF().PM_NAME);AM.push("</div></td></tr>");for(AK=0;AK<12;AK++){AM.push('<td><div class="mstrmojo-Calendar-hour'+(((12+AK)===AL)?" selected":"")+'" h="1">');AM.push((AK===0)?12:AK);AM.push("</div></td>");if(AK===5){AM.push("</tr><tr>");}}AM.push("</tr>");AM.push(x);return AM.join("");},minuteViewHTML:function(){return this._minuteSecondViewHTML(this.timeVal.min,"mstrmojo-Calendar-minute");},secondViewHTML:function(){return this._minuteSecondViewHTML(this.timeVal.sec,"mstrmojo-Calendar-second");},_minuteSecondViewHTML:function(AM,AN){var AL=[],AK;AL.push(G);AL.push("<tr>");for(AK=0;AK<60;AK++){AL.push('<td><div class="');AL.push(AN);AL.push((AK===AM)?' selected">':'">');AL.push(AK);AL.push("</div></td>");if(AK%10===9){AL.push("</tr><tr>");}}AL.pop();AL.push("</tr>");AL.push(x);return AL.join("");},isDateDisabled:function(AK,AM,AL){return !F(AK,AM,AL,this.min,this.max);},unrender:function D(AK){delete this.lastValue;this._super(AK);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Dialog","mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.form","mstrmojo.LoginEditor");mstrmojo.requiresDescs(2699,7773,11812,11865,13380,13381,13382);var D=mstrmojo.desc(13382,"Your user session will time out due to inactivity in # ##."),S=60,M=false,G=null,A=null,H=null;function N(){return mstrApp.sessionState||microstrategy.sessionState;}function K(V,U){if(mstrApp.is508){for(var T in U){V.setAttribute(T,U[T]);}}}mstrmojo.SessionManager=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SessionManager",cssClass:"mstrmojo-SessionManager",width:"370px",title:mstrmojo.desc(11812,"Notification"),msgInterval:1,checkSessionInterval:20,zIndex:10000,maxSessionIdleTime:600,timeBeforeSessionTimeoutWarning:60,remainingTime:60,sessionTimedout:false,buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(13381,"Stay logged in"),function(){var T=this.parent.parent;if(A){T.keepSessionAlive();}T.hideMessage();},true,{onRender:function(){K(this.domNode,{tabindex:0,role:"button","aria-label":mstrmojo.desc(13381,"Stay logged in")});}}),mstrmojo.Button.newWebButton(mstrmojo.desc(13380,"Log out"),function(){this.parent.parent.hideMessage();mstrmojo.form.send({evt:3019,src:mstrApp.name+".3019"});},null,{onRender:function(){K(this.domNode,{tabindex:0,role:"button","aria-label":mstrmojo.desc(13380,"Log out")});}})],children:[{scriptClass:"mstrmojo.Label",alias:"message",cssClass:"mstrmojo-SessionManager-msg",text:"",allowHTML:true,ontextChange:function(){if(mstrApp.is508){this.refresh();var T=this.domNode;K(T,{tabindex:-1,role:"alert"});window.setTimeout(function(){T.focus();},0);}}}],postBuildRendering:function(){this._super();if(mstrApp.is508){this.msgInterval=10;K(this.editorNode,{role:"alertdialog",tabindex:-1});}},updateMsg:function B(U){var T;if(U>60){T=D.replace("##",mstrmojo.desc(2699,"minutes")).replace("#","<b>"+Math.ceil(U/S)+"</b>");}else{if(U>-1){T=D.replace("##",mstrmojo.desc(7773,"seconds")).replace("#","<b>"+U+"</b>");}else{T=mstrmojo.desc(11865,"Your session is expired.");}}this.message.text="";this.message.set("text",T);this.remainingTime=U;},showMessage:function F(T){this.updateMsg(T);this.set("visible",true);M=true;},hideMessage:function I(){if(A){window.clearInterval(A);A=null;window.clearInterval(H);H=null;}this.set("visible",false);M=false;},popupTimeoutWarning:function L(X){if(M){return ;}var V=this,W=(typeof X==="number")?X:V.timeBeforeSessionTimeoutWarning,T=W,U=mstrmojo.now();if(mstrApp.enableWarningSessionTimeout){if(!this.hasRendered){this.render();}this.showMessage(T);}window.clearInterval(A);A=window.setInterval(function(){if(T<1){window.clearInterval(A);A=null;window.setTimeout(function(){if(mstrApp.enableWarningSessionTimeout){V.gotoLogoutPage();}else{V.sessionTimedout=true;V.closeSession();}},200);}var Y=Math.round((mstrmojo.now()-U)/1000);T=W-Y;V.updateMsg(T);},this.msgInterval*1000);window.clearInterval(H);H=window.setInterval(function(){V.isSessionAlive();},this.checkSessionInterval*1000);},warningTimeoutTimer:function Q(T){var U=this;window.clearTimeout(G);G=window.setTimeout(function(){G=null;U.isSessionAlive();},(T-this.timeBeforeSessionTimeoutWarning)*1000);},isSessionAlive:function E(){var T=this,V={success:function(W){var X=parseInt(W,10);if(X!==-1){if(X>T.remainingTime){T.hideMessage();}if(X>T.timeBeforeSessionTimeoutWarning){T.warningTimeoutTimer(X);}else{T.popupTimeoutWarning(X);}}else{window.clearInterval(H);T.popupTimeoutWarning(0);}},failure:function(){mstrmojo.alert("Problems encountered during checking for whether session is alive. Connection is down or session already time out.");}},U={taskId:"isSessionAlive",notRestartSessionManager:true};mstrmojo.xhr.request("POST",mstrConfig.taskURL,V,U);},keepSessionAlive:function R(){var T=this,V={success:function(W){if(W){T.warningTimeoutTimer(T.maxSessionIdleTime);}else{T.sessionTimedout=true;mstrmojo.alert("Your session is expired.");}},failure:function(){mstrmojo.alert("Problems encountered during activating session. Connection is down or session already time out.");}},U={taskId:"keepSessionAlive"};mstrmojo.xhr.request("POST",mstrConfig.taskURL,V,U);},closeSession:function J(){var T=this;mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(){T.sessionTimedout=true;}},{taskId:"closeSessions",sessionStates:N(),notRestartSessionManager:true});},restart:function(){this.sessionTimedout=false;this.hideMessage();if(this.maxSessionIdleTime>this.timeBeforeSessionTimeoutWarning){this.warningTimeoutTimer(this.maxSessionIdleTime);}},start:function C(){var V=mstrConfig.lastMsgKey;if(this.maxSessionIdleTime>this.timeBeforeSessionTimeoutWarning){this.warningTimeoutTimer(this.maxSessionIdleTime);}var U=function(){window.localStorage.setItem("msg_recovery_notify"+V,1);};if(window.addEventListener){window.addEventListener("beforeunload",U);}else{window.attachEvent("onbeforeunload",U);}var T=window.sessionStorage;if(T){T.setItem("msg_browser_not_closed"+V,1);T.setItem("msg_user_login",0);}},openLoginEditor:function P(V){var U="LoginEditor",T=mstrmojo.all[U];if(!T){T=mstrmojo.insert({id:U,scriptClass:"mstrmojo.LoginEditor",config:{callback:{}},zIndex:10000});}T.config.callback=V;T.open();},gotoLogoutPage:function O(){mstrmojo.form.send({evt:3008,src:mstrApp.name+".3008",autoLoggedout:true,Server:mstrConfig.serverName,Port:mstrConfig.serverPort,Project:mstrConfig.projectName,loginReq:true},null,"POST");}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.dom","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.LoginEditor","mstrmojo.SessionManager");function O(b,Z){var a=(Z?"add":"remove")+"LoadingGraph";this.serverProxy[a](b);}var K=true,N="waitBox";mstrmojo._IsWebApp=mstrmojo.provide("mstrmojo._IsWebApp",{_mixinName:"mstrmojo._IsWebApp",serverProxy:null,init:function T(Z){this._super(Z);if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}},start:mstrmojo.emptyFn,styleName:"RWDocumentMojoStyle",modelFactory:null,enableWaitBox:false,onMobileDevice:function D(){return false;},isTouchApp:function G(){return false;},getContentDimensions:function X(Z){return null;},getConfiguration:mstrmojo.emptyFn,setInteractive:function J(Z){if(K!==Z){K=Z;mstrmojo.dom.toggleSelection(window.document.body,Z);return true;}return false;},isInteractive:function W(){return K;},addLoadingGraph:function E(Z){O.call(this,Z,true);},removeLoadingGraph:function U(Z){O.call(this,Z);},serverRequest:function R(f,g,a){try{g=g||{};a=a||{};var c=a.src||(arguments.callee&&arguments.callee.caller.name),Z=!this.enableWaitBox||a.silent,e=a.hideFailureErr,d=this;f.styleName=f.styleName||this.styleName;g=mstrmojo.func.wrapMethods(g,{submission:function(h){if(!Z){mstrmojo.all[N].requestId=h;}},failure:function(h){if(!Z){h.method=c;if(!(mstrApp.isSingleTier&&h.code===403)&&!e){mstrmojo.err(typeof h.mstrerr==="object"?h.mstrerr:h);}}},complete:function(){if(!Z){if(mstrmojo.all[N]){delete mstrmojo.all[N].requestId;}d.hideWait();}}});if(!Z){this.showWait(a&&a.waitBoxCfg);}window.setTimeout(function(){d.serverProxy.request(g,f,!!a.override,a);},0);}catch(b){mstrmojo.err(b);}},hasRequests:function Q(){return this.serverProxy.hasRequests();},getWaitBoxPosition:function(){return null;},isWaiting:function B(){var Z=mstrmojo.all[N];return !!(Z&&Z.visible);},showWait:function F(a){var c=this,d=mstrmojo.all[N]||mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:N,cssClass:"mstrWaitBox",draggable:false,showTitle:false,zIndex:99999,counter:0,displayMsg:null,position:null,ondisplayMsgChange:function b(){this.msgfield.set("text",this.displayMsg);},oncounterChange:function Z(){var f=this.counter,j=this.visible;if(f===0&&j){this.close();}else{if(f>0&&!j){this.open();mstrmojo.dom.center(this.editorNode);var e=this.position||c.getWaitBoxPosition();if(e){var h=e.top,g=e.left;if(h!==undefined){this.set("top",h+"px");}if(g!==undefined){this.set("left",g+"px");}}}}},children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrIcon-wait",alias:"icon"},{scriptClass:"mstrmojo.Label",cssClass:"mstrWaitMsg",alias:"msgfield"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrWaitCancel",alias:"cancelBtn",text:mstrmojo.desc(2140,"Cancel")}]});d.cancelBtn.set("visible",!!(a&&a.showCancel));d.cancelBtn.onclick=function(){c.serverProxy.cancelRequests();};if(a&&a.position){d.position=a.position;}else{d.position=null;}d.set("displayMsg",(a&&a.message)||mstrmojo.desc(11960,"Loading Data..."));if(!this._waitUserLogin){d.set("counter",d.counter+1);}else{this._waitCounter=this._waitCounter+1;}return d;},hideWait:function L(Z){var a=mstrmojo.all[N];if(a){a.set("counter",Z?0:Math.max(0,a.counter-1));}},startSessionManager:function S(a){var b=mstrApp,Z=b.enableAutomaticSessionRecovery&&b.maxSessionIdleTime;b.sessionManager=b.addDisposable(new mstrmojo.SessionManager(mstrmojo.hash.copy(a,Z?{timeBeforeSessionTimeoutWarning:mstrApp.timeBeforeSessionTimeoutWarning,maxSessionIdleTime:b.maxSessionIdleTime}:{})));if(Z){b.sessionManager.start();}},isSessionExpiredError:function Y(e){var d=2147760371,b=2147760372,a=2147758245,Z=2147759877;e=(e<0)?(4294967296+parseInt(e,10)):e;switch(e){case d:case b:case a:case Z:return true;}return false;},onSessionExpired:function V(b){if(mstrApp.authMode==mstrmojo.EnumAuthenticationModes.INTEGRATED){var e={evt:5005,src:mstrApp.name+"."+mstrApp.pageName+".5005"},a=(mstrApp.docModel&&mstrApp.docModel.bs)||(mstrApp.rootCtrl&&mstrApp.rootCtrl.docCtrl&&mstrApp.rootCtrl.docCtrl.model&&mstrApp.rootCtrl.docCtrl.model.bs)||(mstrApp.docModelData&&mstrApp.docModelData.bs);if(a){e.rwb=a;}mstrmojo.form.send(e);return ;}if(mstrApp.sessionManager){var d=mstrmojo.all[N],Z=d&&d.counter>0,c=this;this._waitCounter=-1;if(Z){this._waitCounter=d.counter-1;c.hideWait(true);}this._waitUserLogin=true;mstrApp.sessionManager.openLoginEditor({success:function(f){c._waitUserLogin=false;if(f&&f.sessionState){if(b){if(b.params.sessionState){b.params.sessionState=f.sessionState;}if(Z){d.counter=c._waitCounter;c.showWait();}mstrmojo.xhr.request(b.method,b.baseUrl,b.callback,b.params);}}},cancelRequests:function(){mstrApp.serverProxy.cancelRequests();}});}},updateSessionState:function M(Z){this.sessionState=Z;},onNavigateOut:mstrmojo.emptyFn,showHelpTopic:function A(a){var Z=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");if(a&&typeof a==="string"){Z+=a;}if(mstrApp.isSingleTier){window.FormWrapper.openPage(Z);}else{mstrApp.openPage(Z);}return false;},getSearchAutoCompleteDelay:function P(){return parseInt(mstrConfig&&mstrConfig.searchAutoCompleteDelay,10)||200;},getThemeClassName:function C(){return"mojo-theme-light";},openPage:function I(Z,a){window.open(Z,a);},modalEditorChange:function H(a,Z){}});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.fx","mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.string","mstrmojo.css");var P=mstrmojo.css,O=mstrmojo.dom,N=mstrmojo.expr,I=N.DTP,J=mstrmojo.date,M=mstrmojo.hash,Q=mstrmojo.array,H=mstrmojo.string,B=Q.removeIndices;var A='<table style="width: 200px; table-layout: fixed">',G="</table>";var R=7;function C(X,U,V){var W=J.getFirstDateOfMonth(X,U);return(W.getDay()-V+8)%R;}function S(W,Z,Y,X,U){var V=J.getDateJson(new Date(Z+"/"+W+"/"+Y));return(J.compareDate(V,U)>0);}function E(W,U,X,V){if(W&&W.day===U&&W.month===X&&W.year===V){return 0;}return -1;}function T(Y,W,V,Z,X){var U=J.getDateJson(new Date(Z+"/"+V+"/"+X));if(W.day.toString()==="NaN"){return -1;}else{if(Y&&W&&J.compareDate(Y,W)<=0&&J.compareDate(Y,U)<=0&&J.compareDate(W,U)>=0){return 0;}}return -1;}function K(Y,X,W){var V=Y.decreaseButton,U=Y.increaseButton,a="mstrmojo-Calendar",Z=function(d,c,b){d.className=(a+c)+((S(b.d,b.m,b.y,Y.min,Y.max))?" disabled":"");};Z(V,"-decrease",X);Z(U,"-increase",W);}function L(X){var W=J.parseDateAndOrTime(X),Y,U,V;if(W){V={};Y=W.date;U=W.time;if(Y){M.copy(Y,V);}if(U){M.copy(U,V);}}return V;}function D(c,a,X,Z,Y,V,U){var W,b,d;switch(c){case"day":W=(U==="decrease")?J.getPreMonth(a,X):J.getNextMonth(a,X);Y.set("browseMonth",W.m);Y.set("browseYear",W.y);V.set("browseMonth",X);V.set("browseYear",a);break;case"month":b=(U==="decrease")?a-1:a+1;Y.set("browseYear",b);V.set("browseYear",a);break;case"year":b=(U==="decrease")?Z-25:Z+25;Y.yearRangStart=b;V.yearRangStart=Z;break;}d=(U==="decrease")?"left":"right";Y.switchViewTo(c,d);V.switchViewTo(c,d);}mstrmojo.DI.DICalendar=mstrmojo.declare(mstrmojo.Calendar,null,{cssClass:"mstrmojo-di-calendar",max:J.getDateJson(new Date()),markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onbrowseMonthChange:function(){this.monthLabel.innerHTML=this.monthNames(this.browseMonth-1);},onbrowseYearChange:function(){this.yearLabel.innerHTML=this.browseYear;},ondtpChange:function(){this.timePart.style.display=(this.dtp===I.TIMESTAMP||this.dtp===I.TIME)?"block":"none";},onvalueChange:function(){this.updateSelectedDate();},onchangeValueOnOKChange:function(){if(this.tools){this.tools.style.display=(this.changeValueOnOK?"block":"none");}this.buttonsNode.style.display=(this.wasAdvanced||this.changeValueOnOK||(this.showAdvanced&&this.isAdvanced)?"block":"none");this.advancedNode.style.display=this.showAdvanced?"block":"none";}},dayNames:function(V){var U=["Su","M","Tu","W","Th","F","Sa"];return U[V];},decrease:function(){var U=this.parent.getRightCalendar();D(this.currentView,this.browseYear,this.browseMonth,this.yearRangStart,this,U,"decrease");},increase:function(){var U=this.parent.getLeftCalendar();D(this.currentView,this.browseYear,this.browseMonth,this.yearRangStart,this,U,"increase");},updateSelectedDate:function F(){var W=this.value,V=this.selectedDates,U;if(W){U=L(W);}if(!U){U=J.getDateJson(new Date());}if(S(U.day,U.month,U.year,this.min,this.max)){if(this.min&&J.compareDate(U,this.min)<0){U=L(this.min);}else{if(this.max&&J.compareDate(U,this.max)>0){U=L(this.max);}}}if(this.alias==="leftCal"&&U.month!==1){U.month=U.month-1;}else{if(this.alias==="rightCal"&&U.month===1){U.month=U.month+1;}else{if(this.parent.parent.alias==="fromDate"){V.push(U);}}}this.set("browseMonth",U.month);this.set("browseYear",U.year);this.updateView(this.currentView);},onValueUpdate:function(){var W=this.parent&&this.parent.opener;if(W){var V=W.value,U=(window.mstrConfig&&window.mstrConfig.listSep)||";";if(W.isList&&!H.isEmpty(V)){W.set("value",W.value+U+this.value);}else{W.set("value",this.value);}W.closePopup();}},processEvent:function(U){var Y=this.selectedDates,W,b;if(U===this.monthLabel){return true;}if(U===this.yearLabel){return true;}if(O.contains(this.dayView,U,false,this.domNode)){var Z=this.browseYear,a=this.browseMonth,X;W=parseInt(U.innerHTML,10);b=parseInt(U.getAttribute("m"),10);if(!isNaN(W)&&!isNaN(b)){X=(b===0)?{y:Z,m:a}:(b===1?J.getNextMonth(Z,a):J.getPreMonth(Z,a));if(S(W,X.m,X.y,this.min,this.max)){return true;}var V=E(Y,W,a,Z);if(V===-1){this.parent.removeSelection(0);P.addClass(U,["selected"]);Y.push({day:W,month:X.m,year:X.y});}else{this.parent.removeSelection(V);}if(b===1){this.increase();}else{if(b===-1){this.decrease();}}if(!this.changeValueOnOK){this.updateValue();}}}else{this._super(U);}return true;},dayViewHTML:function(){var Y=this.browseYear,d=this.browseMonth,h=J.getDaysOfMonth(Y,d),l=J.getPreMonth(Y,d),W=J.getDaysOfMonth(l.y,l.m),V=J.getNextMonth(Y,d),e=C(Y,d,this.firstDayOfWeek),Z=[],o=0,b=this.parent.parent.fromDate.value||this.parent.parent.fromDate,X=this.parent.parent.toDate.value||this.parent.parent.toDate,f=this.min,j=this.max,q,g,k;var p=(this.alias==="leftCal")?this.parent.getRightCalendar():this.parent.getLeftCalendar();var U=(this.selectedDates.length===0)?p.selectedDates:this.selectedDates;var a=J.getDateJson(new Date(b));var n=J.getDateJson(new Date(X));K(this,{d:W,m:l.m,y:l.y},{d:1,m:V.m,y:V.y});Z.push(A);Z.push(this._dayViewTHead());Z.push("<tr>");for(k=0;k<e;k++){g=(S(q,l.m,l.y,f,j))?"disabled":"";Z.push('<td><div m="-1">');Z.push("");Z.push("</div></td>");o++;}for(k=0;k<h;k++){q=k+1;g=(S(q,d,Y,f,j))?" disabled":"";if(this.parent.parent.alias==="fromDate"){if(n.day.toString()==="NaN"&&a.day.toString()==="NaN"){Z.push('<td><div class="mstrmojo-Calendar-day-cur'+((E(U[0],q,d,Y)!==-1)?" selected":"")+g+'" m="0">');}else{if(n.day.toString()==="NaN"){Z.push('<td><div class="mstrmojo-Calendar-day-cur'+((E(a,q,d,Y)!==-1)?" selected":"")+g+'" m="0">');}else{Z.push('<td><div class="mstrmojo-Calendar-day-cur'+((T(a,n,q,d,Y)!==-1)?" selected":"")+g+'" m="0">');}}}else{if(n.day.toString()==="NaN"){Z.push('<td><div class="mstrmojo-Calendar-day-cur'+((E(a,q,d,Y)!==-1)?" selected":"")+g+'" m="0">');}else{Z.push('<td><div class="mstrmojo-Calendar-day-cur'+((T(a,n,q,d,Y)!==-1)?" selected":"")+g+'" m="0">');}}Z.push(k+1);Z.push("</div></td>");if((++o)%R===0){Z.push("</tr><tr>");}}Z.push("</tr>");Z.push(G);return Z.join("");},_dayViewTHead:function(){var X=[],Y='<thead><tr class="mstrmojo-di-Calendar-thead">',W="</tr></thead>",V=this.firstDayOfWeek===1?0:1,Z=this.dayNames,U;X.push(Y);for(U=V;U<R;U++){X.push("<td>");X.push(Z(U));X.push("</td>");}if(V===1){X.push(Z(0));}X.push(W);return X.join("");}});}());(function(){mstrmojo.requiresCls("mstrmojo.ValidationTextBox","mstrmojo.Calendar","mstrmojo.Popup","mstrmojo._HasPopup","mstrmojo.locales","mstrmojo.date","mstrmojo.string");var B=mstrmojo.ValidationTextBox.prototype.markupMethods,D=mstrmojo.string,A=function(){return mstrmojo.locales.datetime;},C=mstrmojo.date;mstrmojo.DateTextBox=mstrmojo.declare(mstrmojo.ValidationTextBox,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DateTextBox",calendarToBody:false,calendarZIndex:100,changeValueOnOK:false,dynDateValue:null,showAdvanced:false,canSelectDisabledDate:false,isList:false,dtp:14,defaultDate:null,autoFormat:true,enabled:true,min:"",max:"",markupString:'<div id="{@id}" class="mstrmojo-DateTextBox {@cssClass}" style="{@cssText}"><input class="mstrmojo-DateTextBox-input" type="text" title="{@tooltip}"value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur /><div class="mstrmojo-DateTextBox-icon" mstrAttach:click> </div><div class="mstrmojo-DateTextBox-popup"></div></div>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.childNodes[1];},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},onwidthChange:function(){if(this.width){this.inputNode.style.width=(this.width-20)+"px";this.iconNode.style.left=(this.width-18)+"px";this.domNode.style.width=this.width+"px";}},onvalueChange:B.onvalueChange,onenabledChange:B.onenabledChange,onvalidationStatusChange:B.onvalidationStatusChange},calConfig:null,calendar:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DateTextBox-calendar",locksHover:true,slot:"popupNode",onOpen:function(){var H=this.opener,G=H&&H.calendarZIndex,I=this.cal,E=H&&H.calConfig;if(G){this.domNode.style.zIndex=G;}for(var F in E){I.set(F,E[F]);}},children:[{scriptClass:"mstrmojo.Calendar",alias:"cal",forceNonEmptySelection:true,bindings:{showAdvanced:"this.parent.opener.showAdvanced",dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",dynDateValue:"this.parent.opener.dynDateValue",enabled:"this.parent.opener.enabled",min:"this.parent.opener.min",max:"this.parent.opener.max",canSelectDisabledDate:"this.parent.opener.canSelectDisabledDate",changeValueOnOK:function(){var F=this.parent.opener.dtp,E=this.parent.opener.changeValueOnOK;return F===15||F===16||E;}},closeOnValueChange:true,onValueUpdate:function(F){var I=this.parent&&this.parent.opener;if(I){var G=I.value,E=window.mstrConfig&&window.mstrConfig.listSep||";",H=I.dtp===15?C.formatTimeInfo(this.timeVal,A().TIMEOUTPUTFORMAT):this.value;if(I.isList&&!D.isEmpty(G)){I.set("value",I.value+E+H);}else{I.set("dynDateValue",this.dynDateValue);I.set("value",H);}I.closePopup();}}}]},onclick:function(E){var F=this._lastOpened,G=this._calendarConfig;if(!G){G={};if(this.calendarToBody){delete this.calendar.slot;G.placeholder=document.body.appendChild(document.createElement("div"));G.nudge=function(){var M=this.opener;if(M){var H=mstrmojo.dom.position(M.popupNode,true),L=this.domNode,P=L.offsetHeight,I=L.offsetWidth,J=mstrmojo.dom.windowDim(),K=H.x,N=H.y;if(N+P>=J.h){N=Math.max(N-P,0);}if(K+I>=J.w){K=Math.max(K-I,0);}var O=L.style;O.top=N+"px";O.left=K+"px";}};}this._calendarConfig=G;}G.lockIW=this;if(F&&F.visible){this.closePopup();}else{this.openPopup("calendar",G);this.calendar.cal.updateSelectedDate(true);}},unrender:function(){this._super();if(this.calendarToBody&&this._calendarConfig){delete this._calendarConfig;}if(this.calendar.hasRendered){this.calendar.unrender();}},_set_value:function(H,F){var G=this.value,E=(G!==F);if(E){this.value=F;this.validate(F);}if(this.showAdvanced&&this.dynDateChanged){this.dynDateChanged=false;E=true;}return E;},_set_dynDateValue:function(H,F){var G=this.dynDateValue,E=(G!==F);if(E){this.dynDateValue=F;this.dynDateChanged=true;}return E;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.ui.Pulldown","mstrmojo.DI.DISearchablePulldown");mstrmojo.requiresDescs(221,641,1825,5369,13037,13242,13243,13244,13606,13642,13853,13989,14202,14203,14462,14463,14464,14465,14466);var J=mstrmojo.array,I=mstrmojo.dom,E=mstrmojo.hash,L=mstrmojo.string,N=mstrmojo.DI.DIConstants;function O(R,T){var Q=R.did,P=R.n;var S={success:function(W){var V=[],U;function X(c,Z,d,a,Y){if(J.find(V,"did",c.did)<0){var b={did:c.did,n:c.n,name:c.fdt.content,idf:c.fdt.id_form===1,aid:Q,an:P};if(Z){b.caf={did:Z.id,n:Z.n,name:Z.fdt.content,items:Y};b.cafi=d;b.cafl=a;}V.push(b);}}if(!W||!W.mi){return ;}U=W.mi["in"].oi;if(U){U=[].concat(U);J.forEach(U,function(Z){var Y;if(Z.tp!==21){return ;}if(Z.fdt.bfi!==-1){X(Z);}else{Y=Z.item===undefined?[]:[].concat(Z.item);J.forEach(Y,function(c,b){var a=J.find(U,"did",c);if(a>=0){X(U[a],Z,b,Y.length,Y);}});}});if(T&&T.success){T.success({forms:V});}}},failure:function(U){mstrApp.getRootController().displayError(mstrmojo.desc(641,"Please try again. If the problem persists, contact the server Administrator."),false,U.message);}};mstrApp.getRootController().getDataService().getProjectAttributeInfo(S,{id:Q});}function F(Q,R,P){Q.set("projectAttribute",R);Q.set("projectFormMaps",P);}function M(){var Q=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this),P=" mstrmojo-di-mapProjectAttribute-formMapItem-popupList";Q.getItemMarkup=function(S,R){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@n}</{@tag}>';};Q.cssClass=Q.cssClass||"";Q.cssClass+=P;return Q;}function A(R,Q){var P=[];var S=J.map(R,function(T){return T.projectFormMap;});J.forEach(Q,function(U){var T=J.find(S,"did",U);if(T>=0){if(R[T].formMap){P.push(R[T].formMap);}}});return P;}function C(R){var P=mstrApp.getRootController().getModel(),Q=[],S=[];J.forEach(R,function(U){var V=U.formMap,W=U.projectFormMap,T;if(!V||!W){return ;}if(W.idf){T=J.find(S,"did",V.did);if(T<0){S.push(V.data);}}});J.forEach(R,function(T){var U=T.formMap,W=T.projectFormMap,V;if(!U||!W){return ;}V=P.findMappingSource(U.data);J.forEach(V,function(Y){var Z=true,X;J.forEach(S,function(a){var b=P.findMappingItem(a,Y.tableID);if(!b||b.length===0){Z=false;return false;}});if(Z){X=J.indexOf(Q,Y.tableID);if(X<0){Q.push(Y.tableID);}}});});return Q;}mstrmojo.DI.ui.dialogs.DIMapProjectAttributeDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIMapProjectAttributeDialog",cssClass:"mstrmojo-di-mapProjectAttribute-dialog",title:mstrmojo.desc(13037,"Map to Project Attribute"),blockCount:50,found:false,attributes:null,formMapOptions:null,formMaps:null,projectAttribute:null,projectFormMaps:null,selections:null,help:"About_mapping_imported_data.htm",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(5369,"Submit"),alias:"submit",enabled:false,onclick:function(){var P=this.parent.parent;P.updateMapping();P.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var P=this.parent.parent;P.close();}}],children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-mapProjectAttribute-dialog-content",alias:"content",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="content-box top cf"></div><div class="content-box bottom cf"><div class="content-bottom-box left"></div><div class="content-bottom-box right"></div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},topNode:function(){return this.domNode.children[0];},bottomNode:function(){return this.domNode.children[1];},bottomLeftNode:function(){return this.domNode.children[1].children[0];},bottomRightNode:function(){return this.domNode.children[1].children[1];}},children:[{slot:"topNode",alias:"searchPulldown",scriptClass:"mstrmojo.DI.DISearchablePulldown",cssClass:"mstrmojo-di-mapProjectAttribute-searchPulldown",blockCount:50,value:mstrmojo.desc(14203,"Type attribute name and press 'Enter' to search"),items:[],onitemSelected:function(Q){var P=this;var R={success:function(S){var T=P.parent.parent;P.set("isEditing",false);F(T,Q,S.forms);}};O(this.getSelectedItem(),R);}},{slot:"topNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton mstrmojo-di-mapProjectAttribute-browseButton",text:mstrmojo.desc(1825,"Browse"),onclick:function(){var Q=this;var P={OKFn:function(R){var S={success:function(T){var U=Q.parent.parent;F(U,R,T.forms);U.content.searchPulldown.set("items",[R]);U.content.searchPulldown.set("selectedIndex",0);}};O(R,S);},oTypes:[12]};mstrApp.getRootController().showDialog(N.dialogType.objectPicker,P);}},{slot:"bottomLeftNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-mapProjectAttribute-label left",text:mstrmojo.desc(13242,"Imported Attribute")},{slot:"bottomLeftNode",scriptClass:"mstrmojo.WidgetList",alias:"formMapsList",cssClass:"mstrmojo-di-mapProjectAttribute-formMapsList",renderOnScroll:false,onitemsChange:function(){var P=this;if(!!navigator.userAgent.match(/Edge/)){window.setTimeout(function(){P.refresh();},0);}},itemFunction:function H(W,V,U){var S=U.parent.parent,P=S.formMapOptions,Q=-1,X=["mstrmojo-di-mapProjectAttribute-formMapItem"];var T={n:"---",did:-1};var R={scriptClass:"mstrmojo.ui.Pulldown",getPopupListConfig:M,isHostedWithin:false,data:W,enabled:W.enabled,value:W.enabled?mstrmojo.desc(14462,"Select attribute"):"---",parent:U};if(W.projectFormMap){if(W.projectFormMap.caf){X.push("caf");}if(W.projectFormMap.cafi===0){X.push("cafb");}if(W.projectFormMap.cafi===W.projectFormMap.cafl-1){X.push("cafe");}}if(!W.projectFormMap||!W.projectFormMap.idf){P=[T].concat(E.clone(P));}else{P=E.clone(P);}if(W.formMap&&W.enabled){Q=J.find(P,"did",W.formMap.did);if(Q<0){R.data.formMap=null;}}R.cssClass=X.join(" ");return mstrmojo.ui.Pulldown.newPulldown(P,function(Y){this.data.formMap=Y.did!==-1?Y:null;this.parent.parent.parent.validateForms();},Q,R);}},{slot:"bottomRightNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-mapProjectAttribute-label right",text:mstrmojo.desc(14463,"Project Attribute: "),postBuildRendering:function(){var P=this.parent.parent;P.attachEventListener("projectAttributeChange",this.id,"update");},update:function(){var P=this.parent.parent;if(P.projectAttribute){this.set("text",mstrmojo.desc(14463,"Project Attribute: ")+P.projectAttribute.n);this.set("title",P.projectAttribute.n);}}},{slot:"bottomRightNode",alias:"projectFormMapsPlaceholder",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-mapProjectAttribute-placeholder",text:mstrmojo.desc(13244,"Search or browse Attribute above")},{slot:"bottomRightNode",scriptClass:"mstrmojo.WidgetList",alias:"projFormMapsList",cssClass:"mstrmojo-di-mapProjectAttribute-formMapsList",visible:false,renderOnScroll:false,onitemsChange:function(){var Q=this;var P=this.items&&this.items.length;this.set("visible",P);this.parent.projectFormMapsPlaceholder.set("visible",!P);if(!!navigator.userAgent.match(/Edge/)){window.setTimeout(function(){Q.refresh();},0);}},itemFunction:function H(T,P,S){var R=["mstrmojo-di-mapProjectAttribute-formMapItem","proj"];var Q={parent:S,scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" tooltip="{@tooltip}"><div class="proj-item-text"><span class="icon"></span><span class="text">{@text}</span></div></div>',text:L.encodeHtmlString(T.name)};if(T.caf){R.push("caf");if(T.cafi===0){R.push("cafb");}if(T.cafi===T.cafl-1){R.push("cafe");}Q.tooltip=mstrmojo.desc(14464,"Compound Attribute");Q.text=L.encodeHtmlString(T.caf.name)+"@"+L.encodeHtmlString(T.name);}Q.cssClass=R.join(" ");return new mstrmojo.Box(Q);}}]}],showTooltip:function K(U,T){var S=this,Q=I.findAncestorByAttr(I.eventTarget(T,U),"tooltip",true,this.domNode),R=Q&&Q.value;if(R&&I.contains(S.containerNode,Q.node)){if(!S.hasOpenTooltip&&R){var P=I.position(Q.node);S.richTooltip={cssClass:"vi-regular vi-tooltip-C",content:R,top:Math.max(P.y+P.h+4,0),left:Math.max(P.x+P.w+8,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT};mstrmojo._HasTooltip.showTooltip.call(S,U,T);}}else{this._super(U,T);}},onOpen:function D(){var Q=mstrApp.getRootController().getModel(),T=this,P=T.attributes,S=T.tableId,V=[],R=0,U;J.forEach(P,function(Y){var X,Z='<span class="icon"></span><span class="text">'+mstrmojo.string.encodeHtmlString(Y.alias)+"</span>",W='<span class="icon"></span><span class="text ipa">'+mstrmojo.string.encodeHtmlString(Y.alias)+"</span>";if(!Y.isMultiForm){X={n:Y.ipa?W:Z,alias:Y.alias,did:Y.did,oid:Y.oid,id:Y.id,tableId:Y.tableId,isMultiForm:Y.isMultiForm,ipa:Y.ipa,aid:Y.id,data:Y};V.push(X);}else{if(R===0){J.forEach(Y.subColumns,function(a){X={did:a.did,oid:a.oid,id:a.id,tableId:Y.tableId,isMultiForm:true,aid:Y.id,data:Y};if(Y.ipa){X.n='<span class="icon form"></span><span class="text ipa">'+L.encodeHtmlString(Y.alias)+"@"+L.encodeHtmlString(a.alias)+"</span>";}else{X.n='<span class="icon form"></span><span class="text ipa">'+L.encodeHtmlString(Y.alias)+"@"+L.encodeHtmlString(a.alias)+"</span>";}V.push(X);});R++;}}});this.set("formMaps",V);U=[];J.forEach(Q.getImportSource(S).getCurrentMappings(function(W){return W.tp===12;}),function(Z){var Y,W,a='<span class="icon"></span><span class="text">'+L.encodeHtmlString(Z.alias)+"</span>",X='<span class="icon"></span><span class="text ipa">'+L.encodeHtmlString(Z.alias)+"</span>";if(!Z.isMultiForm){if(Z.ipa!==1){Y={n:Z.ipa?X:a,alias:Z.alias,did:Z.did,oid:Z.oid,id:Z.id,tableId:Z.tableId,isMultiForm:Z.isMultiForm,ipa:Z.ipa,aid:Z.id,data:Z};U.push(Y);}}else{W=-1;if(W>=0){J.forEach(Z.subColumns,function(b){Y={did:b.did,oid:b.oid,id:b.id,tableId:Z.tableId,isMultiForm:true,aid:Z.id,data:Z};if(Z.ipa){Y.n='<span class="icon form"></span><span class="text ipa">'+L.encodeHtmlString(Z.alias)+"@"+L.encodeHtmlString(b.alias)+"</span>";}else{Y.n='<span class="icon form"></span><span class="text">'+L.encodeHtmlString(Z.alias)+"@"+L.encodeHtmlString(b.alias)+"</span>";}U.push(Y);});}}});this.set("formMapOptions",U);this.set("projectFormMaps",[]);},onprojectFormMapsChange:function(){var U=this.formMaps||[],T=this.projectFormMaps||[],P=Math.max(U.length,T.length),Q=[],S,R;this.content.projFormMapsList.set("items",T);for(R=0;R<P;R++){if(R<U.length&&R<T.length){S={formMap:U[R],projectFormMap:T[R],enabled:true};}else{if(R<U.length){S={formMap:U[R],projectFormMap:null,enabled:T.length===0};}else{S={formMap:null,projectFormMap:T[R],enabled:true};}}Q.push(S);}this.set("selections",Q);},onselectionsChange:function(){this.content.formMapsList.set("items",this.selections);this.validateForms();},updateMapping:function(){var P=mstrApp.getRootController(),Q=P.getModel(),S=this.selections,R;if(!this.checkUpdateMapping()){return ;}R=C(S);J.forEach(S,function(T){var U=T.formMap,W=T.projectFormMap,V;if(!U||!W){return ;}if(!U.isMultiForm){V=Q.findMappingItem(U.data);J.forEach(V,function(X){if(J.indexOf(R,X.tableId)>=0){X.ipa=1;X.tp=12;X.nochange=true;X.oid=W.aid;X.fmid=W.did;}});}else{V=Q.findMappingItem(U.data);J.forEach(V,function(X){if(J.indexOf(R,X.tableId)>=0){J.forEach(X.subColumns,function(Y){if(Y.did===U.did){X.ipa=1;X.tp=12;X.nochange=true;Y.ipa=1;Y.oid=W.aid;Y.fmid=W.did;}});}});}});P.changeEMMAMappings();},checkUpdateMapping:function(){var U=this,R=true,P=mstrApp.getRootController(),Q=P.getModel(),S=this.selections,T=U.projectAttribute.n,W=[],V;J.forEach(S,function(Y){var X=Y.formMap,Z=Y.projectFormMap;if(!X||!Z){return ;}W.push(X);});if(R){J.forEach(S,function(Y){var X=Y.formMap,a=Y.projectFormMap,Z;if(!X||!a){return ;}if(!R){return false;}if(a.idf){Z=Q.findMappingItem(X.data);J.forEach(Z,function(c){var d=c.tableId,e,b;e=Q.getImportSource(d).getCurrentMappings(function(f){return f.tp===12;});b=J.find(e,"alias",T);if(b>=0&&J.find(W,"id",e[b].id)<0){R=false;V=mstrmojo.desc(13853,"The Attribute ## cannot be mapped to the Project Attribute ### since there is already an Attribute with the same name as the Project Attribute within the current dataset. Please rename the Attribute ### in the current dataset to something else.");V=V.replace(/###/g,T).replace("##",L.encodeHtmlString(X.data.alias));return false;}});}});}if(!R&&V){P.displayError(V);}return R;},validateForms:function G(){var R=this.selections,S=true,T="",P=[],Q;if(!this.projectFormMaps||!this.projectFormMaps.length){S=false;T=mstrmojo.desc(13244,"Search or browse Attribute above");}if(S){Q=0;J.forEach(R,function(U){if(U.formMap&&U.projectFormMap){Q++;if(J.indexOf(P,U.formMap.did)<0){P.push(U.formMap.did);}}});if(Q===0){S=false;T=mstrmojo.desc(13244,"Search or browse Attribute above");}else{if(P.length!==Q){S=false;T=mstrmojo.desc(14465,"Cannot map two attributes to same form");}}}if(S){J.forEach(R,function(V){var Y=V.projectFormMap,X=V.formMap,W,U;if(Y){if(Y.idf&&!X){S=false;return false;}if(Y.caf&&Y.caf.items){W=A(R,Y.caf.items);U=W.length;if(U!==0&&U!==Y.caf.items.length){S=false;T=mstrmojo.desc(14466,"Compound attribute forms need to be mapped together");return false;}}}});}this.setSubmitBtn(S,T);},setSubmitBtn:function B(P,R){var Q=this.btnHbox.submit;Q.set("enabled",P);Q.textNode.setAttribute("tooltip",R);},onClose:function(){var P=this;window.setTimeout(function(){P.destroy();},0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.Pulldown","mstrmojo.DI.DISearchablePulldown");mstrmojo.requiresDescs(221,1825,5369,13037,13242,13243,13244,13606,13642,13853,13989,14202,14203);var I=mstrmojo.array,K=mstrmojo.DI.DIConstants;function L(P,O){var N=P.did,M=P.n,Q={success:function(V){if(V.container){var T=V.container.dssforms||[],U,S;for(U=0,S=T.length;U<S;U++){T[U].aid=N;T[U].an=M;T[U].did=N+T[U].dssid;T[U].idf=T[0].dssid;}if(O&&O.success){O.success({items:T});}}}},R={attributeID:N,displayedForms:0};mstrApp.getRootController().getDataService().getAttributeForms(Q,R);}function E(R,a,X){var W=R.formMaps;var Z=a.n;var O=[];var Q=X.items;var b,U,S,N;for(S=0;S<Q.length;S++){N=Q[S];if(N.dssid===N.idf){b=N;}}R.idForm=b;if(W&&W.length>0){mstrmojo.array.removeItem(Q,b);for(U=0;U<W.length;U++){O.push({did:W[U].did,dssid:(U===0)?b.idf:null,aid:a.did,projectFormMaps:Q,proAttrName:Z,isMultiForm:true,fmid:W[U].fmid});}}else{var T=R.attribute;var V=mstrApp.getRootController().model,M=V.importSources[T.tableId],Y;if(M.currentTransformations&&M.currentTransformations.xtab&&M.currentTransformations.xtab.isCrosstab){Y=M.transformedMapping;}else{Y=M.currentMapping;}R.found=false;for(U=0;U<Y.length;U++){if(b&&((b.aid+b.dssid)===Y[U].afid||b.aid===Y[U].oid)){if(Q.length>1){R.found=true;R.set("found",true);R.set("formMaps",[{fmn:mstrmojo.desc(14202,"Default form")}]);mstrmojo.array.removeItem(Q,b);break;}else{var P=mstrmojo.desc(13989,"The project attribute '##' has a single form which has already been mapped within the current table.");mstrApp.getRootController().displayError(P.replace("##",b.an));return ;}}}O=[{isMultiForm:false,aid:Q[0].aid,dssid:Q[0].dssid,projectFormMaps:Q,proAttrName:Z}];if(R.found){O[0].isMultiForm=true;}}R.set("projectAttribute",a);R.set("selections",O);R.validateForms();}mstrmojo.DI.ProjectAttributeItem=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.ProjectAttributeItem",editor:null,projectFormMap:null,item:null,visible:true,linkedColumnId:null,did:null,cssClass:"mstrmojo-di-projects-form-select",children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Pulldown",alias:"formPullDown",popupToBody:true,itemField:"n",itemIdField:"dssid",bindings:{popupZIndex:"this.parent.parent.editor.zIndex",linkedColumnId:"this.parent.parent.linkedColumnId"},preBuildRendering:function J(){var M=this.parent.parent,N=M.item;this.set("items",N.projectFormMaps);this.set("defaultSelection",0);var O=this.parent.parent;if(this.items[0]){O.item.dssid=this.items[0].dssid;}},onvalueChange:function(){var P=this,M=P.selectedIndex,N=this.parent.parent.editor,O=this.parent.parent;N.onFormChanged(O.item,P.items[M].dssid);N.validateForms();}}]}]});var D=mstrmojo.desc(14203,"Type attribute name and press 'Enter' to search");mstrmojo.DI.DIProjectsAttribute=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIProjectsAttribute",cssClass:"di-projects-attribute-panel",title:mstrmojo.desc(13037,"Map to Project Attribute"),titleWidget:"",blockCount:50,attribute:null,formMaps:null,found:false,projectAttribute:null,projectFormMaps:null,selections:{},help:"About_mapping_imported_data.htm",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(5369,"Submit"),alias:"submit",enabled:false,onclick:function(){var M=this.parent.parent;M.updateMapping();M.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var M=this.parent.parent;M.close();}}],updateHintText:function(){var M=this.mainPage.title.attributePulldown.selectedNode;if(M.textContent!==undefined){M.textContent=D;}else{M.innerText=D;}},children:[{scriptClass:"mstrmojo.VBox",cssClass:"",alias:"mainPage",children:[{scriptClass:"mstrmojo.HBox",alias:"title",cssClass:"mstrmojo-di-title-box",children:[{alias:"attributePulldown",scriptClass:"mstrmojo.DI.DISearchablePulldown",cssClass:"mstrmojo-di-projectAttributeSearchbox",visible:true,blockCount:50,onitemSelected:function(N){var M=this;var O={success:function(P){M.set("isEditing",false);var Q=M.parent.parent.parent;E(Q,N,P);}};L(this.getSelectedItem(),O);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton browseButton",text:mstrmojo.desc(1825,"Browse"),onclick:function(){var N=this;var M={OKFn:function(O){var P={success:function(Q){var R=N.parent.parent.parent;E(R,O,Q);}};L(O,P);},oTypes:[12]};mstrApp.getRootController().showDialog(K.dialogType.objectPicker,M);}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-content-box",alias:"contentH",children:[{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-di-projects-attribute-left-box",alias:"contentV",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-projects-attribute-title-label",text:mstrmojo.desc(13242,"Imported Attribute")},{scriptClass:"mstrmojo.Label",alias:"attributeName",cssClass:"mstrmojo-di-projects-attribute-label",visible:true,bindings:{text:function(){return this.parent.parent.parent.parent.attribute.alias;}}},{scriptClass:"mstrmojo.WidgetList",alias:"formMapsList",cssClass:"mstrmojo-di-projects-attribute-formMapsList",visible:true,itemFunction:function G(O,M,N){return new mstrmojo.Label({cssClass:"mstrmojo-di-projects-form-label",text:O.fmn});},bindings:{items:function(){return this.parent.parent.parent.parent.formMaps;}}}]},{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-di-projects-attribute-right-box",alias:"selected_content",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-projects-attribute-title-label",text:mstrmojo.desc(13243,"Project Attribute")},{scriptClass:"mstrmojo.Label",alias:"selected_attribute_select_placeholder",cssClass:"mstrmojo-di-projects-attribute-placeholder",text:mstrmojo.desc(13244,"Search or browse Attribute above"),visible:true,bindings:{visible:function(){var M=this.parent.parent.parent.parent.projectAttribute;if(M){return false;}return true;}}},{scriptClass:"mstrmojo.Label",alias:"selected_attribute",cssClass:"mstrmojo-di-projects-attribute-label ipa",visible:false,bindings:{text:function(){var M=this.parent.parent.parent.parent.projectAttribute;var N="";if(M){N=M.n;}return N;},visible:function(){var M=this.parent.parent.parent.parent.projectAttribute;if(M){return true;}return false;}}},{scriptClass:"mstrmojo.WidgetList",alias:"selected_formMapsList",cssClass:"mstrmojo-di-projects-attribute-formMapsList",visible:false,itemFunction:function G(O,M,N){if(!O.isMultiForm){return ;}if(N.parent.parent.parent.parent.found){return new mstrmojo.DI.ProjectAttributeItem({editor:N.parent.parent.parent.parent,projectFormMap:N.parent.parent.parent.parent.projectFormMaps,item:O,did:O.did});}else{if(M===0){return new mstrmojo.Label({cssClass:"mstrmojo-di-projects-form-label",text:N.parent.parent.parent.parent.idForm?N.parent.parent.parent.parent.idForm.n:"ID"});}else{return new mstrmojo.DI.ProjectAttributeItem({editor:N.parent.parent.parent.parent,projectFormMap:N.parent.parent.parent.parent.projectFormMaps,item:O,did:O.did});}}},bindings:{items:function(){return this.parent.parent.parent.parent.selections;},visible:function(){var M=this.parent.parent.parent.parent.projectAttribute;if(M){return true;}return false;}}}]}]}]}],preBuildRendering:function J(){this._super();},onOpen:function C(){this.mainPage.title.attributePulldown.set("items",[]);this.mainPage.title.attributePulldown.set("text","");this.set("isEditing",true);this.set("selections",{});this.set("projectAttribute",null);this.set("projectFormMaps",null);this.btnHbox.submit.set("enabled",false);this.set("found",false);},updateMapping:function B(){var X,f,e,d,T;var Q=this.selections;X=this.attribute;var a=mstrApp.getRootController(),P=mstrApp.getRootController().model,W=false,b=false,c,R,Z,h,Y;var S=Q[0].aid;var N=Q[0].dssid;var g=Q[0].proAttrName;var M=P.findMappingSource(X);Y=this.projectAttribute.n;for(f=0;f<M.length;f++){b=false;c=M[f];if(c.currentTransformations&&c.currentTransformations.xtab&&c.currentTransformations.xtab.isCrosstab){Z=c.transformedMapping;}else{Z=c.currentMapping;}for(e=0;e<Z.length;e++){h=Z[e];if(h.afid===(S+N)){a.displayError(mstrmojo.desc(9926,"The attribute form you select has been mapped. Please choose a different one."));P.raiseEvent({name:"MappingsFetched"});return false;}if(X.did===h.did||X.afid===h.afid){continue;}if(X.oid===h.oid&&X.tableId!==h.tableId){continue;}if(X.oid===h.oid&&this.projectAttribute.t===h.tp){if(h.oid&&h.oid===this.projectAttribute.did){continue;}else{if(!h.isMultiForm&&(this.projectAttribute.did+h.fmid)!==h.afid){W=true;break;}else{if(h.isMultiForm&&!h.isLinked){W=true;break;}}}}if(X.oid!==h.oid&&g===h.alias&&!h.ipa){W=true;}}if(W){R=mstrmojo.desc(13853,"The Attribute ## cannot be mapped to the Project Attribute ### since there is already an Attribute with the same name as the Project Attribute within the current dataset. Please rename the Attribute ### in the current dataset to something else.");a.displayError(R.replace(/###/g,Y).replace("##",this.attribute.alias));P.raiseEvent({name:"MappingsFetched"});return false;}if(N===this.idForm.idf){b=true;}else{for(e=0;e<Z.length;e++){h=Z[e];if(h.ipa&&h.oid&&(h.oid===this.projectAttribute.did)&&(h.fmid===this.idForm.idf)){b=true;}}}if(!b){R=mstrmojo.desc(13606,"Linked non-id form can't mapped to project attribute: ###, please unlink the non-id form first.");a.displayError(R.replace(/###/g,Y).replace("##",this.attribute.alias));P.raiseEvent({name:"MappingsFetched"});return false;}}for(f=0;f<M.length;f++){c=M[f];var O=c.findMappingItem(X);if(O.isMultiForm){O.ipa=1;O.tp=12;O.nochange=true;var U=O.subColumns,V;for(T=0;T<Q.length;T++){var l=Q[T];for(d=0;d<U.length;d++){if(l.fmid===U[d].fmid){V=U[d];}}V.ipa=1;V.oid=l.aid;V.fmid=l.dssid;}}else{O.ipa=1;O.tp=12;O.nochange=true;O.oid=Q[0].aid;O.fmid=Q[0].dssid;}}mstrApp.getRootController().changeEMMAMappings();},onFormChanged:function H(M,N){M.dssid=N;},validateForms:function F(){var M=[],R=this.selections,N,Q,P=false;for(N=0;N<R.length;N++){Q=R[N];if(I.find(M,"dssid",Q.dssid)===-1){var O=I.findMulti(R,"dssid",[Q]);if(O.count>1){M.push({dssid:Q.dssid,indices:O.indices});}}}P=(M.length===0);this.setSubmitBtn(P);},setSubmitBtn:function A(M){var N=this.btnHbox.submit;N.set("enabled",M);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Box","mstrmojo.Image","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.DI.DISearchableTextBox","mstrmojo.DataGrid");mstrmojo.requiresDescs(39,4283,14032,14033);var N=mstrmojo.DI.DIConstants;function I(P){var Q=this.items.length;var S={},R;if(P){for(R=0;R<Q;R++){S[R]=P;}}this.set("selectedIndices",S);}function G(S){var R;var T=[];var P=mstrApp.getRootController();var Q;for(R=0;R<this.outputGrid.items.length;R++){if(this.outputGrid.selectedIndices[R]){T.push(this.outputGrid.items[R].url);this.setTableIndex(T.length-1,this.outputGrid.items[R].index);}}this.urls=T;for(R=0;R<T.length;R++){Q=mstrmojo.string.trim(T[R]);T[R]=Q;}P.importURLEMMA(this,T,true,!P.model.hasEMMAReportInstance(),this.id,true,S,this.id);}mstrmojo.DI.DIPublicData=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPublicData",markupString:'<div id = "{@id}" ><div class= "{@cssClass} cf" mstrAttach:click></div><div></div><div></div></div>',cssClass:"mstrmojo-di-public-data-search",searchField:null,resultSize:0,markupSlots:{containerNode:function(){return this.domNode;},textInputNode:function(){return this.domNode.children[0];},textOutputNode:function(){return this.domNode.children[1];},gridOutputNode:function(){return this.domNode.children[2];}},preBuildRendering:function J(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("wikiSearchResultsFetched",this.id,"populate");},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onBackButtonClick:function M(){mstrApp.getRootController().showPage(N.pageType.dataSelection);},onNextButtonClick:function E(){G.call(this,this.tableID?N.actions.refreshData:N.actions.importSource);},onFinishButtonClick:function B(){G.call(this,N.actions.savePublish);},onHelpButtonClick:function D(){return"Importing_data_by_scraping_a_web_page_public_data.htm";},populate:function H(){var T=mstrApp.getRootController().model.wikiSearchResults;if(T.length===0){this.outputText.set("text",mstrmojo.desc(14032,"We could not find any results for your search."));this.outputText.set("visible",true);this.outputGrid.set("visible",false);}else{this.outputText.set("visible",false);this.outputGrid.set("visible",true);this.outputGrid.set("items",T);I.call(this.outputGrid,false);}if(this.model.importSources[this.tableID]&&this.model.importSources[this.tableID].sourceInfo&&this.model.importSources[this.tableID].sourceInfo.name&&!this.autoselected){this.autoselected=true;var S=this.model.importSources[this.tableID];var R,Q=S.sourceInfo.url,P=S.sourceInfo.sheetIndex;this.outputGrid.set("multiSelect",false);for(R=0;R<this.outputGrid.items.length;R++){if(Q===this.outputGrid.items[R].url&&P===this.outputGrid.items[R].index){this.outputGrid.set("selectedIndex",R);break;}}this.outputGrid.updateHeaderCheckbox();}},updateSearchResult:function L(P){if(!this.stillSearching&&!P.newValue){return ;}if(P.newValue){this.searchField=P.newValue;}this.outputGrid.set("visible",false);if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrApp.getRootController().scrapeWiki(P.newValue);},children:[{slot:"textInputNode",scriptClass:"mstrmojo.DI.DISearchableTextBox",alias:"urlInput",value:mstrmojo.desc(14033,"Search for data or enter a URL to extract data."),items:[],itemField:"n",itemIdField:"rgt",preBuildRendering:function J(){if(this._super){this._super();}this.attachEventListener("itemSelectedChanged",this.parent.id,"updateSearchResult");mstrApp.getRootController().model.attachEventListener("wikiSuggestionsChange",this.id,"populateList");},onitemSelected:function(R,P){var Q;if(R){Q=(R.n);}else{if(P&&P!==-1){Q=(this.items[P]);}else{Q=(this.text);}}this.raiseEvent({name:"itemSelectedChanged",newValue:Q,limit:25,off:0});}},{slot:"textInputNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",cssText:"float:left;margin-left:410px;margin-top:-22px;",text:mstrmojo.desc(10,"Search"),onclick:function(){if(this.parent.urlInput.text!=="Search for data or enter a URL to extract data."){this.parent.urlInput.raiseEvent({name:"itemSelectedChanged",newValue:this.parent.urlInput.text,limit:25,off:0});}}},{slot:"textOutputNode",scriptClass:"mstrmojo.Label",alias:"outputText",cssClass:"mstrmojo-di-public-data-output"},{slot:"gridOutputNode",scriptClass:"mstrmojo.DataGrid",alias:"outputGrid",cssClass:"mstrmojo-di-public-data-grid",setupScrollNodes:function F(){this.scrollNode=this.scrollboxNode;},visible:false,multiSelect:true,markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="height:336px; {@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',selectionPolicy:"toggle",columns:[{headerCss:"mstrmojo-di-samplefiles-col1header",headerWidget:{scriptClass:"mstrmojo.ImageCheckBox",cssText:"padding-top:8px;",alias:"checkall",state:"unselect-all",preclick:function(){var P=this.dataGrid.parent;if(P.tableID){return ;}if(this.state==="select-all"){this.set("state","unselect-all");I.call(this.dataGrid,false);}else{this.set("state","select-all");I.call(this.dataGrid,true);}},onstateChange:function(){var P=mstrmojo.css;P.removeClass(this.inputNode,["select-all","unselect-all","select-some"]);P.addClass(this.inputNode,this.state);},postCreate:function(){this.set("state","unselect-all");}},colCss:"mstrmojo-di-samplefiles-col1",colWidth:"30",dataWidget:{scriptClass:"mstrmojo.ImageCheckBox",bindings:{label:"this.parent.data.display",checked:function(){return !!this.parent.dataGrid.selectedIndices[this.idx];}},preclick:function(){this.set("checked",!!this.parent.dataGrid.selectedIndices[this.idx]);this.parent.dataGrid.updateHeaderCheckbox();}}},{headerText:mstrmojo.desc(4283,"Source"),dataWidget:{colCss:"mstrmojo-di-public-data-grid-entry",scriptClass:"mstrmojo.Widget",markupString:'<div class="mstrmojo-di-public-data-source-container"><a href="{@value}" target="_blank"" mstrAttach:mouseover,mouseout,mousedown>{@value}</a></div>',bindings:{value:function(){return this.data.url+"#"+this.data.section.replace(/ /g,"_");}},onmouseover:function O(Q){var P=mstrmojo.all[this.id];P.showTooltip(Q,self);},onmouseout:function K(Q){var P=mstrmojo.all[this.id];P.hideTooltip(Q,self);},onmousedown:function C(P){P.e.stopPropagation();},postBuildRendering:function A(){function Q(R){return decodeURIComponent(R.replace(/\+/g," "));}var P=Q(this.data.contents);P=P.replace(/\/\/upload.wikimedia.org\//ig,"http://upload.wikimedia.org/");this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:P});}}},{headerText:mstrmojo.desc(39,"Description"),dataWidget:{colCss:"mstrmojo-di-public-data-grid-entry",scriptClass:"mstrmojo.Widget",markupString:"<div mstrAttach:mouseover,mouseout>{@value}</div>",bindings:{value:function(){return this.data.desc;}},onmouseover:function O(Q){var P=mstrmojo.all[this.id];P.showTooltip(Q,self);},onmouseout:function K(Q){var P=mstrmojo.all[this.id];P.hideTooltip(Q,self);},postBuildRendering:function A(){function Q(R){return decodeURIComponent(R.replace(/\+/g," "));}var P=Q(this.data.contents);P=P.replace(/\/\/upload.wikimedia.org\//ig,"http://upload.wikimedia.org/");this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:P});}},colCss:"mstrmojo-di-public-data-grid-entry"}],onchange:function(){var P=mstrApp.getRootController();var Q=this.getSelectedItems();if(Q.length>0){P.sourceSelected(true);}else{P.sourceSelected(false);}},updateHeaderCheckbox:function(){var R=this,S=R.items.length,Q=0,P=R._headerWidgets_[0],T;if(!P){return ;}for(T=0;T<S;T++){if(R.selectedIndices[T]){Q++;}}if(Q<=0){P.set("state","unselect-all");}else{if(Q>=S){P.set("state","select-all");}else{P.set("state","select-some");}}}}],tableidx:[],getFilesCnt:function(){if(this.urls){return this.urls.length;}return 0;},getFileUrl:function(P){if(P>=0){return this.urls[P];}return -1;},setUrlTableIndices:function(){var P;for(P=0;P<this.urls.length;P++){this.tableidx[P]=0;}},setTableIndex:function(P,Q){this.tableidx[P]=Q;},getUrlTableIndices:function(P){if(this.tableidx){return this.tableidx[P];}},getFileTableID:function(P){if(this.urls&&P<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[P]];}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu");mstrmojo.requiresDescs(11411,11424,11417);var D=mstrmojo.architect.menu.EnumMenuActions,E=mstrmojo.desc(11411,"Sample Data"),A=mstrmojo.desc(11424,"Add to Project"),C=mstrmojo.desc(11417,"Update Structure");mstrmojo.warehouse.menu.AvailableTablesMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.AvailableTablesMenu",cm:[{action:D.ADD_TO_PROJECT,n:A},{action:D.UPSTRUCT,n:C},{action:D.NONE},{action:D.SAMPLE_DATA,n:E,icn:"smpl"}],executeCommand:function B(G){var H=this.data,F=mstrApp.getRootController();switch(G.action){case D.UPSTRUCT:F.getColumnsForDBTables({tables:[].concat(H),getFresh:true},{});break;case D.ADD_TO_PROJECT:F.addTables([].concat(H));break;case D.SAMPLE_DATA:F.showSampleData(H);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.EnumMenuActions");mstrmojo.requiresDescs(1088,629,1388,3397,12259,11425,4572);var G=mstrmojo.architect.menu.EnumMenuActions,C=G.NONE,E=G.EDIT,J=G.DELETE,N=G.RENAME,O=G.DUPLICATE,Q=G.CATALOG_SQL,D=G.SET_AS_PRIMARY,P=G.IS_PRIMARY,I=mstrmojo.desc(1088,"Edit"),B=mstrmojo.desc(629,"Delete"),H=mstrmojo.desc(1388,"Rename"),M=mstrmojo.desc(3397,"Duplicate"),L=mstrmojo.desc(12259,"Catalog SQL"),A=mstrmojo.desc(11425,"Set as Primary"),F=mstrmojo.desc(4572,"Primary");mstrmojo.warehouse.menu.DBConnectionsMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.DBConnectionsMenu",cm:[{action:E,n:I,icn:"edt"},{action:J,n:B,icn:"del"},{action:N,n:H,icn:"rnm"},{action:O,n:M},{action:D,n:A},{action:C},{action:P,n:F},{action:C},{action:Q,n:L,icn:"catsql"}],executeCommand:function K(S){var T=this.data,R=mstrApp.getRootController();switch(S.action){case E:R.editDBRole(T);break;case N:R.renameDBRole(T);break;case J:R.deleteDBRole(T);break;case O:R.duplicateDBRole(T);break;case D:R.setProjectPrimaryDBRole(T);break;case Q:R.displayCatalogSQL(T.did);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.DI.DIMappingMenu");mstrmojo.requiresDescs(629,1088,3397);var E=mstrmojo.architect.menu.EnumMenuActions,C=E.EDIT,G=E.DELETE,K=E.DUPLICATE,F=mstrmojo.desc(1088,"Edit"),B=mstrmojo.desc(629,"Delete"),J=mstrmojo.desc(3397,"Duplicate");mstrmojo.DI.DIProjectsMenu=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIProjectsMenu",cm:[{action:C,n:F,icn:"rnm"},{action:G,n:B,icn:"del"},{action:K,n:J}],executeCommand:function H(M){var N=this.data,L=mstrApp.getRootController();switch(M.action){case C:L.projectController.editDBRole(N);break;case G:L.projectController.deleteDBRole(N);break;case K:L.projectController.duplicateDBRole(N);break;}},queryVisible:function D(L){return true;},queryEnabled:function I(L){return true;},queryChecked:function A(L){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.dbroles.DBRoleSetting","mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox","mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor","mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector","mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox","mstrmojo.warehouse.dbroles.DBRoleSettingPulldown","mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton");mstrmojo.requiresDescs(15,260,512,689,1034,2523,3332,3989,7790,7952,8517,8518,8519,8521,8522,8523,8524,8526,8528,8529,8530,8532,8533,8534,8536,8538,8539,8540,8546,8547,8548,8549,8550,8560,10055,10058,10059,10061,10064,10065,11392,11394,12308,12309,12310,12312,12313,12542,12752,12758,12997,13100,13101,13103,13104,13105,13106,13107,13108,13109,13110,13111,13112,13113,13114,13115,13116,13117,13118,13119,13121,13122,13123,13124,13125,13126,13234,13373,13531,13532,13533,13540,13541,13904,13905,13906,13907,13908,13909,13910,13944,13945,13946,13947,13948,13949,13950,13951,13952,13962,13979,13980,13981,13982,13990,14002,14005,14620,14621,14641,14685,14686,14687);var g=mstrmojo.array,a=mstrmojo.hash,N=mstrmojo.string,f="hideUnavailableDrivers",M="FULLCONNECTION",j,E=mstrmojo.warehouse.dbroles.DBRoleHelper,q=mstrmojo.desc(8538,"Database:"),T=mstrmojo.desc(2523,"Version:"),I=mstrmojo.desc(13540,"Show databases whose certified drivers were not found"),d=mstrmojo.desc(13990,"Show databases which are not certified for the DSNs driver"),P=mstrmojo.desc(13234,"Add driver"),h=mstrmojo.desc(11392,"Missing parameters"),m=" ("+mstrmojo.desc(13541,"Certified driver not found")+")",G=mstrmojo.desc(11394,"The ODBC driver used by this database connection is currently not installed, until that happens this connection may not work"),D=mstrmojo.desc(14002,"The JDBC driver used by this database connection is currently not installed, until that happens this connection may not work"),k=mstrmojo.desc(8526,"select a dsn");function w(AE,AP,AS){var AQ,AG="";if(this.isDSNLess){var AD={},AR,AH=this.contents.children,AV=1;if(AS===undefined){var AU=this.dbIDSelectList.selectedItem,AI=AU.dbVersions[g.find(AU.dbVersions,"v",this.dbmsList.selectedItem.db_ver)],AM=AI.connections[this.selectedSection],AJ=E.driverExists.call(this,[AM]);if(AJ.exists){AR=AM.str;}else{if(AI.altconnections.length>0){AR=AI.altconnections[this.selectedSection].str;}else{AR=AM.str;AG=G;if(AR.indexOf("JDBC;")>=0){AG=D;}}}}else{AR=AS;}g.forEach(AH,function(AX){var AW=AX.getValue();if(AX.field){if(typeof AW==="string"){AD[AX.field]=N.trim(AW);}else{AD[AX.field]=AW;}}if((!!AW)&&AX.driverMode){AV=AX.driverMode;}});this.driverMode=AV;AQ=AR.replace(/@([\w\d]+)/gm,function AL(AW,AX){return(AD.hasOwnProperty(AX)&&AD[AX]!==null)?AD[AX]:"";});if(AP){var AF="=;",AN,AO,AK,AT=/[\s\x28\x29\x3B]/g;do{AN=AQ.indexOf(AF);if(AN>-1){AO=AQ.substring(0,AN);while(AT.test(AO)){AN=AT.lastIndex;}AK=AO.substring(AN);AQ=AQ.replace(AK+AF,"");}}while(AQ.indexOf(AF)>0);}}else{AQ="DSN="+this.dsnBox.dsnList.selectedItem.n+";";}if(AE){AQ=E.cleanDSNConnection(AQ);}return{str:AQ,err:AG};}function l(AG,AT){var AH=mstrApp.rootController,AN="XQUERY",AI="@",AE,AQ,AR="",AK="",AO=[],AY="",AF={},AS=/[,:]/g,AJ=0,AU=/[\x28\x29\x3B\x7D]|(!#)/g,AZ,AP="",AL=/[\x29\x3B\x7D\/!]/g,AM=E.cleanDriver(AT),AV,AD={},AX=0,AW=0;g.forEach(AG,function(Ab){AE=Ab.str;AO=[];AF={};AV=E.cleanDriver(AE);AJ++;if(AE.indexOf(M)===0){if(Ab.driver===AN){AK=AE.replace(M+"="+AN+";"+AI,"");var Ac=AT.indexOf(";;");if(Ac>=0){AT=AT.substring(0,Ac+1);}AF[AK]=AT.replace(AN+";","");AD=AF;AW=AH.getObjectCount(AF);return false;}AE=AE.replace(M+"=",";");}if(AM.toUpperCase()!==AV.toUpperCase()){return true;}do{AQ=AE.indexOf(AI);AR=AE.substring(0,AQ);AU.lastIndex=0;while(AU.test(AR)){AQ=AU.lastIndex;}AK=N.trim(AR.substring(AQ));AE=AE.replace(AR,"").replace(AI,"");AL.test(AE);AZ=AL.lastIndex-1;AP=AE[AZ];AL.lastIndex=1;AY=AE.substring(0,AZ).replace("@","");AO.push({key:AY,token:AK,endoftokenChar:AP});}while(AE.indexOf(AI,AZ)>0);var Aa;g.forEach(AO,function(Ah,Ad){Aa=Ah.token;Ad=AT.toUpperCase().indexOf(Aa.toUpperCase());if(Ad>-1){Ad+=Aa.length;AU.lastIndex=0;var Ag=AT.substring(Ad);var Af=AU.exec(Ag);if(Af){var Aj=Ag.substring(0,Af.index);if(Ag[Af.index]!==Ah.endoftokenChar&&Aj.length){if(Aj[Aj.length-1]===Ah.endoftokenChar){Aj=Aj.substring(0,Aj.length-1);}}AS.test(Aj);var Ae=Aj.substring(AS.lastIndex-1,AS.lastIndex)||",",Ak=Ah.key.split(Ae),Ai=Aj.split(Ae);if(Ak.length===Ai.length){g.forEach(Ak,function(Al,Am){AF[Al]=Ai[Am];});}else{AF[Ah.key]=Aj;}}}});if(AH.getObjectCount(AF)>AW){AD=AF;AW=AH.getObjectCount(AF);AX=AJ;}return true;});AD["RB"+AX]=true;return AD;}function S(AG){var AF={},AD=AG.split(";"),AE=[];g.forEach(AD,function(AH){AE=AH.split("=");if(AE[0]!==""){AF[AE[0]]=AE[1];}});return AF;}function C(AD,AI){var AH,AG,AE=[],AF={};g.forEach(a.keyarray(AI),function(AJ){AH=AI[AJ];if(AJ){AF[AJ]=AJ+"="+AH;}else{g.forEach(a.keyarray(AF),function(AK){AE.push(AK);});g.forEach(AE,function(AK){AG=false;g.forEach(AD.parent.children,function(AL){if(AL.propfield===AK){AG=true;return !AG;}});if(!AG){delete AF[AK];}});AF[AJ]=AH;}});return a.valarray(AF).join(";");}function u(AG,AJ,AE){var AI,AF;if(AG.field){AI=AJ[AG.field];}else{if(AG.propset){AF=AE[AG.propset][AG.prop];if(AG.propformat==="json"){AI=JSON.parse(AF||"{}")[AG.propfield];}else{if((AG.propformat==="text")){if(AG.propfield){AI=(S(AF||"")[AG.propfield]);}else{var AD=S(AF||"");g.forEach(AG.parent.children,function(AK){if(AK.propfield){delete AD[AK.propfield];}});var AH=[];g.forEach(a.keyarray(AD),function(AK){AH.push(AK+"="+AD[AK]);});AI=AH.join(";");}}else{AI=AF;}}}else{g.forEach(AG.children,function(AK){u(AK,AJ,AE);});}}if(AI){AG.setValue(AI);}}function Z(AI,AE){var AJ,AH,AF,AD={},AG={};if(AI.propset){AJ=AI.getValue();if(typeof AJ==="string"){AH=N.trim(AJ).replace(/\\/g,"\\\\");}else{AH=AJ;}AF=AE[AI.propset][AI.prop];if(AI.propformat==="json"){AG=JSON.parse(AF||"{}");AG[AI.propfield]=AH;AE[AI.propset][AI.prop]=JSON.stringify(AG).replace(/\\"/g,'"');}else{if((AI.propformat==="text")){AD=S(AF||"");AD[AI.propfield]=AH;AE[AI.propset][AI.prop]=C(AI,AD);}else{AE[AI.propset][AI.prop]=AH;}}}else{g.forEach(AI.children,function(AK){Z(AK,AE);});}}function R(AJ){if(this.info.connstr){var AI=this.contents;var AF=this.info.connstr.split(";")[0],AE=(AF.split("=")[0]).toUpperCase();switch(AE){case"DSN":AI=this.dsnBox;AF=AF.substring(AE.length+1,AF.length);AI.dsnList.set("selectedID",AF.toUpperCase());break;default:AF=E.cleanLoadedDSNConnection(this.info.connstr,AJ.dbID);var AK=this.supportedDBs[g.find(this.supportedDBs,"id",AJ.dbID)],AD=AK.dbVersions[g.find(AK.dbVersions,"v",AJ.dbver)],AL=AD.connections.concat(AD.altconnections);var AG=l(AL,AF);var AH=this.info.vldbProperties;g.forEach(AI.children,function(AM){u(AM,AG,AH);});if(E.isCustomConnection(AF)||mstrApp.rootController.getObjectCount(AG)<=AD.DBPS.length){AI.stringEditor.setValue(AF);}}}}function AA(){var AH;if(this.info.connstr){var AO=E.cleanDriver(this.info.connstr),AL=E.isCustomConnection(this.info.connstr),AD=(AO.split("=")[0]).toUpperCase(),AK=this.dbObjects.dbms,AF=AK[g.find(AK,"did",this.info.dbms)],AM,AI=function AE(AQ,AP){g.forEach(AQ,function(AR){if(AF.db_ver===AR.v){AM=AR.connections.concat(AR.altconnections);if(AO!==""&&!AL){if(g.find(AM,"driver",AO)>=0){AH={dbver:AR.v,dbID:AP};}}else{AH={dbver:AR.v,dbID:AP};}}if(AH){return false;}return true;});};switch(AD){case"DSN":AH={dbver:AF.db_ver,dbID:this.dbIDs.Undefined};break;default:var AG=parseInt(this.info.ab,10)||0;if(AG>=0){var AJ=g.find(this.supportedDBs,"id",AG),AN;if(AJ>=0){AN=this.supportedDBs[AJ];AI(AN.dbVersions,AN.id);}}if(!AH){g.forEach(this.supportedDBs,function(AP){AI(AP.dbVersions,AP.id);if(AH){return false;}return true;});}if(!AH){AL=true;g.forEach(this.supportedDBs,function(AP){AI(AP.dbVersions,AP.id);if(AH){return false;}return true;});}break;}}if(!AH){AH={dbID:-1};}return AH;}function Q(AG,AF,AE,AD){var AJ=this,AI=[],AK,AH;AH=new mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox({alias:AG.alias+"groupBox"});AJ.contents.addChildren([AH]);g.forEach(AF,function(AL){if(AL.group===AE){AK=a.clone(AL);delete AK.group;AI.push(AK);}});AD.call(AJ,AI,AH.alias,AH);if(AG.oncheckedChange){AG.checked=true;AG.set("checked",false);}}function AC(AI,AE,AD){var AG=this,AF=[];g.forEach(AI,function(AJ){if(!!(AJ.group)){AF.push(AJ);}});var AH;g.forEach(AI,function(AQ,AR){AH=false;if(mstrApp.isSingleTier){if((AQ.scope&2)===2){AH=true;}}else{if((AQ.scope&1)===1){AH=true;}}if(!AH){return ;}var AT,AS=mstrmojo.desc(AQ.IDS,AQ.n),AM="dbp"+AR,AP=(AQ.isgroup===1);if(AS&&AS[AS.length-1]!==":"){AS+=":";}if(AQ.group){return true;}switch(AQ.tp){case"text":AT=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AS,alias:AM,isRequired:AQ.req,onEnter:AG.onEnterFn,onvalueChange:function AK(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"number":AT=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AS,alias:AM,isNumeric:true,isRequired:AQ.req,onEnter:AG.onEnterFn,onvalueChange:function AK(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"list":var AO="v",AJ=AQ.options;if(AJ[0].n){AO="n";g.forEach(AJ,function(AU){AU.n=mstrmojo.desc(AU.IDS,AU.n);});}else{g.forEach(AJ,function(AU){AU.n=AU.v;});}AT=new mstrmojo.warehouse.dbroles.DBRoleSettingPulldown({caption:AS,alias:AM,itemIdField:"v",itemField:AO,onChange:function AN(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});AT.render();AT.set("items",AJ);AT.set("selectedID",AJ[0].v);break;case"boolean":AT=new mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox({label:AS,alias:AM,isGroup:AP,isNumeric:(AQ.stp&&(AQ.stp==="numeric")),driverMode:1,helpLink:AQ.help,driverModeChecked:AQ.driverMode||1,display:AQ.display,oncheckedChange:function AL(){if(this.parent.stringEditor){this.parent.stringEditor.updateString();}this.driverMode=(this.checked?this.driverModeChecked:1);if(!this.isGroup){return ;}var AU=(this.checked&&(this.display==="onChecked"))||(!this.checked&&(this.display==="onUnChecked"));this.parent[this.alias+"groupBox"].set("visible",AU);}});break;case"file":AT=new mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector({caption:AS,alias:AM,isRequired:AQ.req,selectorOption:AQ.selectorOption,onEnter:AG.onEnterFn,onvalueChange:function AK(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;}AT.field=AQ.field;AT.parentRBAlias=AE;AT.propset=AQ.propset;AT.prop=AQ.prop;AT.propformat=AQ.propformat;AT.propfield=AQ.propfield;if(AQ.defaultValue){AT.setValue(AQ.defaultValue);}AD.addChildren([AT]);if(AP){Q.call(AG,AT,AF,AQ.groupid,AC);}});}function V(AF,AE,AD){return new mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton({label:mstrmojo.desc(AF.IDS,AF.n),index:AE,alias:"RB"+AE,count:AD,field:"RB"+(AE+1),onclick:function AG(){var AI;if(this.checked){for(AI=0;AI<this.count;AI++){this.parent["RB"+AI].set("checked",false);this.parent["RB"+AI].enableChildren();}this.set("checked",true);this.enableChildren();}},oncheckedChange:function AH(){if(this.checked){this.parent.parent.selectedSection=this.index;}}});}function t(){if(!this.isDSNLess){return ;}var AH=this.contents,AK,AF,AI=this;if(!AH){return ;}if(AH.children){AH.removeChildren(null,true);}if(!this.dbmsList.selectedItem){return ;}AK=this.dbIDSelectList.selectedItem||this.dbIDSelectList.items[0];var AD=AK.dbVersions[g.find(AK.dbVersions,"v",this.dbmsList.selectedItem.db_ver)];if(!AD){return ;}if(!E.driverExists.call(this,AD.connections).exists&&(AD.altDBPS.length>0)){AF=AD.altDBPS;}else{AF=AD.DBPS;}if(AF&&AF.length>1){var AG=AF.length;g.forEach(AF,function(AN,AM){if(AN.defaultSection){AI.selectedSection=AM;}var AO=V(AN,AM,AG);AH.addChildren([AO]);AC.call(AI,AN.DBP,AO.alias,AI.contents);});AH["RB"+AI.selectedSection].checked=true;AH["RB"+AI.selectedSection].onclick();}else{AC.call(AI,AF[0].DBP,"",AI.contents);}var AL=new mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor({alias:"stringEditor",drivers:AI.drivers,dbIDVersions:this.dbIDSelectList.items,info:AI.info,dbID:AI.dbIDSelectList.selectedItem,dbms:AI.dbmsList.selectedItem,enableFn:function AJ(AN){var AO=this.parent.parent,AM=AO.contents["RB"+AO.selectedSection];g.forEach(AH.children,function(AP){if(!AP.isGroupSetting&&!AP.isGroup){AP.set("enabled",AN);}});if(AN&&AM){AM.setValue(true);}},generateConnectionStringFn:function AE(AM){return w.call(AI,false,false,AM).str.replace(M+"=","");}});AH.addChildren([AL]);}function z(AE){var AD=this.dbObjects.dbms;return AD[g.find(AD,"db_ver",AE)];}function H(){var AM=this,AI=false,AL=this.dbObjects.supportedDBs,AN=this.dbIdFilter||[],AO=this.dbIdExcludeFilter||[],AH=[],AG,AK=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")===-1)),AJ=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")!==-1)),AE=(mstrApp.isSingleTier&&window.FormWrapper.isWin32&&window.FormWrapper.isWin32()),AF=function AF(AQ){if(AK){var AR=a.clone(AQ);AR.n=N.trim(AQ.n.replace("(JDBC)",""));return AR;}if(AJ){var AP=a.clone(AQ);AP.n=N.trim(AQ.n.replace("(32 bit)",""));return AP;}return AQ;},AD=[6800,5300,5600,6600,7000];g.forEach(AL,function(AP){AI=false;if(mstrApp.isSingleTier&&AK&&AP.dbType===100){return true;}if(mstrApp.isSingleTier){if(g.indexOf(AD,AP.dbType)!==-1){return true;}}g.forEach(AP.dbVersions,function(AQ){if(AQ.dsnless){if(!AM.showUnavailable){g.forEach(AQ.connections.concat(AQ.altconnections),function(AR){if(E.driverAvailable.call(AM,AR)){AI=true;}return !AI;});}else{AI=true;}return !AI;}return !AI;});if(AI){AG=false;g.forEach(AO,function(AQ){if(AQ===AP.id){AG=true;return false;}});if(!AG){if(AN.length>0){g.forEach(AN,function(AQ){if(AQ===AP.id){AH.push(AF(AP));}});}else{AH.push(AF(AP));}}}});this.dbIDSelectList.set("items",AH);if(AH.length===0&&!AM.showUnavailable){AM.showUnavailable=true;this.driverBox.hideUnavailable.setValue(true);}}function x(AG,AF){var AL=this.dbObjects.dbms,AN=this.dbmsList;if(AG.length===0){var AD,AH=this.dbObjects.dsndbms,AI={};if(this.cfgDbmsTypeExcludeFilter&&this.cfgDbmsTypeExcludeFilter.length>0){g.forEach(this.cfgDbmsTypeExcludeFilter,function(AO){AI[AO]=true;});AH=g.filter(this.dbObjects.dsndbms,function(AO){return !AI[AO.db_type];});}AD=a.cloneArray(AH);g.forEach(AF,function(AP){if(AP.v>-1){var AO=g.find(AD,"db_ver",AP.v);if(AO>=0){AD[AO].n+=" (Certified for DSN)";}}});AN.set("items",AD);}else{var AJ={},AM=this;g.forEach(AL,function(AO){AO.enabled=true;if(!(AG.length===1&&AG[0].v===-1)){if((AO.db_type===AM.dbTypes.Generic.v)||(AO.db_ver===-1)){if(!AM.alwaysShowGeneric){return true;}}}g.forEach(AG,function(AS){if(AO.db_ver===AS.v){if((AS.dsnless&&AM.isDSNLess)||(!AM.isDSNLess)){var AQ=AS.connections.concat(AS.altconnections);if(!AM.showUnavailable){g.forEach(AQ,function(AT){if(E.driverAvailable.call(AM,AT)){AJ[AO.did]=AO;}return true;});}else{var AP=false;g.forEach(AQ,function(AT){if(E.driverAvailable.call(AM,AT)){AP=true;}return !AP;});if(AP){AO.title=(AO.n.length>50)?AO.n:"";AJ[AO.did]=AO;}else{var AR=mstrmojo.hash.clone(AO);AR.n=AR.n+m;AO.enabled=false;AR.title=(AR.n.length>50)?AR.n:"";AJ[AR.did]=AR;}}}}});});if(mstrApp.rootController.getObjectCount(AJ)===0){var AE=z.call(this,-1);if(AE){AJ[AE.did]=AE;}}AN.set("items",mstrmojo.hash.valarray(AJ));}var AK=AN.items;if(AK.length>0){if(this.info&&this.info.dbms){AN.set("selectedID",this.info.dbms);}else{if(AN.selectedItem&&(g.find(AK,"did",AN.selectedItem.did)>-1)){AN.set("selectedID",AN.selectedItem.did);}else{AN.set("selectedID",AK[0].did);}}AN.onChange();}else{AN.set("selectedID","");}}function Y(){var AL=this,AM={n:k,nU:k.toUpperCase(),des:0};var AK={},AI=AL.dbObjects.dsns,AE=[];AK[AM.nU]=AM;if(AL.dbIdFilter.length===1){g.forEach(AL.supportedDBs,function(AN){g.forEach(AN.dbVersions,function(AO){g.forEach(AO.connections.concat(AO.altconnections),function(AP){g.forEach(AI,function(AQ){if(AP.driver===AQ.des){AK[AQ.nU]=AQ;}return true;});});});});AE=a.cloneArray(a.valarray(AK));}else{AE=a.cloneArray(AL.dbObjects.dsns);}var AD={};if(AL.dsnDbTypeExcludeFilter&&AL.dsnDbTypeExcludeFilter.length>0){g.forEach(AL.dsnDbTypeExcludeFilter,function(AN){g.forEach(AL.dsnMapDBs,function(AO){if(AO.dbType===AN){g.forEach(AO.dbVersions,function(AP){g.forEach(AP.connections.concat(AP.altconnections),function(AQ){g.forEach(AE,function(AR){if(AQ.driver===AR.des){AD[AR.nU]=AR;}return true;});});});}});});var AG,AJ,AF=a.valarray(AD),AH=AF.length;for(AG=0;AG<AH;AG++){AJ=g.find(AE,"nU",AF[AG].nU);if(AJ>=0){AE.splice(AJ,1);}}}this.dsnBox.dsnList.set("items",AE);this.onisDSNLessChange();}mstrmojo.warehouse.dbroles.DBRoleDSNConnection=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleDSNConnection",cssClass:"mstrmojo-wh-DBRoleDSNConnection",postCreate:function c(){var AD=mstrApp.rootController.getDBObjects();this.dbObjects=AD;this.dbTypes=AD.dbTypes;this.dbIDs=AD.dbIDs;this.dbVersions=AD.dbVersions;this.supportedDBs=AD.supportedDBs;this.dsnMapDBs=AD.dsnMapDBs;this.drivers=AD.drivers;this.preferences=AD.preferences;},onEnterFn:mstrmojo.emptyFn,info:undefined,oninfoChange:function K(){var AF=this.info.connstr;if(AF&&(AF.substring(0,1)===";")){this.info.connstr=this.info.connstr.replace(";","");}H.call(this);var AD=AA.call(this);var AE=window.localStorage,AG=(AE&&AE.getItem(f));this.driverBox.hideUnavailable.setValue((AG?(AG==="1"):false));if((mstrApp.rootController.getObjectCount(this.info)>0)&&(this.info.did!=="")&&(g.find(this.dbIDSelectList.items,"id",AD.dbID)<0)){this.driverBox.hideUnavailable.setValue(true);}if(this.isDSNLess){this.dbIDSelectList.set("selectedID",AD.dbID);this.dbmsList.set("selectedID",this.info.dbms);}else{if(this.info.n){Y.call(this);}}R.call(this,AD);this.driverBox.hideUnavailable.set("visible",!this.hideDriverCheck);},selectedSection:0,isDSNLess:undefined,dbIdFilter:[],dbIdExcludeFilter:[],dsnDbTypeExcludeFilter:[],driverMode:1,singleType:false,onisDSNLessChange:function L(){var AJ=this.dbIDSelectList,AG=this.dsnBox,AI=AG.dsnList,AD=this.info&&this.info.connstr,AF,AH,AE;if(this.isDSNLess){AJ.set("selectedItem",null);AJ.set("selectedID",this.supportedDBs[0].id);this.driverBox.hideUnavailable.set("label",I);}else{if(!(AI.items&&AI.items.length>0)){Y.call(this);}if(AD){AF=AD.split(";")[0];AH=(AF.split("=")[0]).toUpperCase();if(AH==="DSN"){AF=AF.substring(AH.length+1,AF.length);AE=AF.toUpperCase();}}if(AE===undefined){AE=AI.items[0].nU;}AI.set("selectedID",AE);AI.onChange();this.driverBox.hideUnavailable.set("label",d);}AJ.set("visible",this.isDSNLess&&!this.singleType);this.contents.set("visible",this.isDSNLess);AG.set("visible",!this.isDSNLess);},dsnBox:undefined,dsnList:undefined,dbIDSelectList:undefined,dbmsList:undefined,contents:undefined,hideUnavailable:undefined,hideDriverCheck:false,onhideDriverCheckChange:function e(){this.driverBox.hideUnavailable.set("visible",!this.hideDriverCheck);},driverBox:undefined,addDriver:undefined,showAddDriver:false,showConnectionString:false,Hive:undefined,db_ver:undefined,DBP:undefined,DBPS:undefined,altDBPS:undefined,IDS:undefined,connections:undefined,altconnections:undefined,dsnless:undefined,Undefined:undefined,isgroup:undefined,groupid:undefined,showUnavailable:false,alwaysShowGeneric:false,children:[{scriptClass:"mstrmojo.Table",rows:1,cols:2,alias:"dsnBox",postCreate:function c(){this.cssClass="mstrmojo-wh-DSNConnection-Box "+((mstrApp.isSingleTier&&navigator.platform.indexOf("Win")!==-1)?"one-tier-win":"");},layout:[{cells:[{cssClass:"mstrmojo-wh-DSNConnection-Box-list"},{cssClass:"mstrmojo-wh-DSNConnection-Box-btn"}]}],children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",slot:"0,0",caption:"dsn:",alias:"dsnList",itemIdField:"nU",allowHTML:false,onChange:function X(){var AF=this.parent.parent,AE=AF.dsnBox.dsnList.selectedItem,AD=[];if(AE){g.forEach(AF.supportedDBs,function(AG){g.forEach(AG.dbVersions,function(AH){g.forEach(AH.connections.concat(AH.altconnections),function(AI){if(AI.driver===AE.des){AD.push(AH);return false;}return true;});});});}if(AF.showUnavailable){x.call(AF,[],AD);}else{x.call(AF,AD);}}},{scriptClass:"mstrmojo.Button",slot:"0,1",onclick:function p(){var AD=this.parent.parent.parent.parent.buttonsbox.buttonCancel;if(AD){AD.onclick();}mstrApp.getRootController().getDataService().submitRequest({},{taskId:"openODBCAdmin"});}}]},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dbIDSelectList",itemIdField:"id",caption:q,bindings:{visible:function(){return !this.parent.singleType;}},onChange:function X(AD){var AE=this.parent,AF;if(AD){AF=AD.id;x.call(AE,AE.supportedDBs[g.find(AE.supportedDBs,"id",AF)].dbVersions);this.set("selectedID",AF);if((AD.connType&4)!==4){AE.driverBox.addDriver.set("visible",AE.showAddDriver);}AE.updateLoginFn(AD.stdLogin!==0);}}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dbmsList",itemIdField:"did",caption:T,bindings:{visible:function(){return !this.parent.singleType;}},onChange:function X(){var AD=this.parent;if(AD.isDSNLess&&AD.dbIDSelectList.selectedItem){t.call(AD);}this.selectedID=this.selectedItem.did;if(AD.onDBMSSelectFn){AD.onDBMSSelectFn(this.selectedItem);}}},{scriptClass:"mstrmojo.Box",alias:"driverBox",children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",alias:"hideUnavailable",label:I,oncheckedChange:function W(){var AG=window.localStorage;if(AG){AG.setItem(f,this.checked?"1":"0");}var AF=this.parent.parent,AD,AE;if(AF.dbIDSelectList.items){AD=AF.dbIDSelectList.selectedID;}if(AF.dbmsList.items){AE=AF.dbmsList.selectedID;}AF.showUnavailable=(this.checked);if(AF.isDSNLess){H.call(AF);if(AF.dbIDSelectList.hasRendered){if(!!(AF.dbIDSelectList.items.length)&&((!AD)||(g.find(AF.dbIDSelectList.items,"id",AD)<0))){AD=AF.dbIDSelectList.items[0].id;AF.dbIDSelectList.selectedID=-1;AF.dbIDSelectList.set("selectedID",AD);}else{AF.dbIDSelectList.onChange(AF.dbIDSelectList.selectedItem);}}}else{if(this.parent.parent.hasRendered){this.parent.parent.dsnBox.dsnList.onChange();}}if(AF.dbmsList.hasRendered){if(((!AE)||(g.find(AF.dbmsList.items,"did",AE)<0))&&(AF.dbmsList.items&&AF.dbmsList.items[0])){AE=AF.dbmsList.items[0].id;AF.dbmsList.selectedID=-1;AF.dbmsList.set("selectedID",AE);}}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-AddDriver",visible:false,alias:"addDriver",text:P,onclick:function p(){j=this.parent.parent;mstrApp.rootController.launchOneTierFileBrowser("mstrmojo.warehouse.dbroles.DBRoleDSNConnection.oneTierFileUploader");}}]},{scriptClass:"mstrmojo.Box",alias:"contents",cssClass:"mstrmojo-wh-DBRoleConnection-Box"}],dbObjects:{},dbVersions:[],dbTypes:[],preferences:{},dbIDs:{},supportedDBs:[],dsnMapDBs:[],drivers:[],getConnectionStr:function O(){if(this.isDSNLess){var AD=this.contents.stringEditor;if(AD.visibleContents&&AD.enabledContents){return{str:AD.getValue(),err:""};}}return w.call(this,true,true,undefined);},getVLDBProperties:function B(AD){if(this.isDSNLess&&AD){g.forEach(this.contents.children,function(AE){if(!(AE.field)){Z(AE,AD);}});}},isValidInput:function F(){var AD=this.contents.children,AE={val:false,msg:h};if(this.isDSNLess){g.forEach(AD,function(AF){if(AF.isGroupSetting&&AF.visible){g.forEach(AF.children,function(AG){if(AG.alias!=="groupbox"){AE=AG.isValid();return(AE.val);}return true;});}else{AE=AF.isValid();}return(AE.val);});return AE;}return this.dsnBox.dsnList.isValid();},getDbmsID:function J(){return this.dbmsList.selectedItem.did;},getDBId:function A(){if(this.dbIDSelectList.selectedItem&&this.isDSNLess){return this.dbIDSelectList.selectedItem.id;}return 0;},getDBType:function AB(){return this.dbmsList.selectedItem.db_type;},getCharEncodingForUnix:function b(){var AF=this.dbmsList.selectedItem,AE=AF.db_ver,AD=g.find(this.dbVersions,"v",AE);if(AD>=0){return this.dbVersions[AD].unixEncoding;}return 1;},getDriverMode:function U(){return this.driverMode;},getOdbcv:function o(){if(this.getDBType()===this.dbTypes.Hive.v){return"20";}return"";},clear:function n(){this.set("info",{});}});mstrmojo.warehouse.dbroles.DBRoleDSNConnection.oneTierFileUploader=function(AD){mstrApp.rootController.oneTierFileUploader({success:function AE(){j.dbObjects.reloadDrivers({success:function AF(){j.drivers=j.dbObjects.drivers;j.oninfoChange.call(j);}});}},{fp:AD});};}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.WidgetTree","mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.onetier.vi.ui.DBCredentialEditor");mstrmojo.requiresDescs(221,8708,14284,14285,14286,14287,14328);var B=mstrmojo.DI.DIConstants,C=30,D=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICredentialsTable",data:null,cssClass:"dataset-table",markupString:'<div id="{@id}" class="cf {@cssClass}" ><div class="dataset-table-status"></div><div></div><div></div></div>',markupSlots:{tableNode:function(){return this.domNode.children[1];},statusNode:function(){return this.domNode.children[0];},buttonNode:function(){return this.domNode.children[2];}},children:[{scriptClass:"mstrmojo.Label",slot:"tableNode",bindings:{text:function(){var E=this.parent.data.name;if(E.length>C){E=E.substr(0,C)+"...";}return E;},title:function(){var E="";if(this.parent.data.name.length>C){E=this.parent.data.name;}return E;},cssClass:function(){var E="table-font-credentials-not-fetched";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.domNode,E);E="";}else{mstrmojo.css.addClass(this.domNode,E);}return"dataset-table-name "+E;}}},{scriptClass:"mstrmojo.Label",slot:"statusNode",tableStatusClass:{"0":"","1":"waiting","2":"finished","3":"warning"},bindings:{cssClass:function(){var E;if(this.parent.data.credentialsFetched){E=this.tableStatusClass[2];}else{if(this.parent.data.credentialsFetched===false){E=this.tableStatusClass[3];}else{E=this.tableStatusClass[0];}}mstrmojo.css.addClass(this.domNode,E);return E;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.data.credentialsFetched?mstrmojo.desc(14286,"Edit Credentials"):mstrmojo.desc(14287,"Input Credentials");},innerIconClass:function(){var E="button-font-input";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.textNode,E);E="";}else{mstrmojo.css.addClass(this.textNode,E);}return E;}},slot:"buttonNode",onclick:function(){var G=this.parent.data;var H=[this.parent.data.did];var E=mstrApp.getRootController();switch(G.dict){case B.backendSourceSubtype.googleBigQuery:case B.backendSourceSubtype.googleBigQueryFFSQLModel:case B.backendSourceSubtype.googleBigQuerySingleTable:E.setTableIDsForOAuth(H);E.gotoOAuthLogin(B.sourceType.googleBigQuery);break;case B.backendSourceSubtype.dropbox:E.setTableIDsForOAuth(H);E.gotoOAuthLogin(B.sourceType.dropbox);break;case B.backendSourceSubtype.googleAnalytics:E.setTableIDsForOAuth(H);E.gotoOAuthLogin(B.sourceType.googleAnalytics);break;case B.backendSourceSubtype.googleDrive:E.setTableIDsForOAuth(H);E.gotoOAuthLogin(B.sourceType.googleDrive);break;case B.backendSourceSubtype.facebook:E.setTableIDsForOAuth(H);E.gotoOAuthLogin(B.sourceType.facebook);break;case B.backendSourceSubtype.twitter:E.setTableIDsForOAuth(H);E.gotoOAuthLogin(B.sourceType.twitter);break;case B.backendSourceSubtype.salesforce:E.setTableIDsForOAuth(H);E.gotoOAuthLogin(B.sourceType.salesforce);break;default:var F=G.dbRole.dbmsObj;if(F.DBInfo.driverInstalled){new mstrmojo.onetier.vi.ui.DBCredentialEditor({data:G,zIndex:this.parent.parent.tree.parent.zIndex+1}).open();}else{mstrmojo.alert(mstrmojo.desc(14328,"There is no driver installed for ##. Please install it and try again.").replace("##",F.n));}break;}}}]});mstrmojo.DI.ui.dialogs.DICredentialsDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICredentialsDialog",title:mstrmojo.desc(14285,"Connection Information"),cssClass:"mstrmojo-di-credentials-dialog",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(8708,"OK"),alias:"okButton",onclick:function(){var F=this.parent.parent,E=true;if(F.onOK){E=F.onOK();}if(E){F.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelButton",onclick:function(){var F=this.parent.parent,E=true;if(F.onCancel){E=F.onCancel();}if(E){F.close();}}}],onOpen:function(){this.set("items",this.model.datasets);if(this._super){this._super();}},onOK:function(){mstrApp.getRootController().wrapUpDataImport();return true;},onCancel:function(){mstrApp.serverRequest({taskId:"authenticationCancelled"},null,{doNotHold:true});return true;},onClose:function(){window.setTimeout(function(){if(mstrApp.container){mstrApp.container.close();}},0);},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tablestatuslist-title",text:mstrmojo.desc(14284,"Please enter credentials used to create these datasets in order to access the following datasets in the dashboard:")},{scriptClass:"mstrmojo.WidgetTree",bindings:{items:"this.parent.items"},itemIdField:"did",itemDisplayField:"name",itemChildrenField:"tables",cssClass:"datasets-list",itemFunction:function A(I,F,G){var E=G.tree||G,H=new mstrmojo.TreeNode({idx:F,data:I,state:1,parent:G,tree:E,multiSelect:G.multiSelect,text:I[G.itemDisplayField],textCssClass:E.item2textCss(I),items:I[G.itemChildrenField],itemIdField:G.itemIdField,itemDisplayField:G.itemDisplayField,itemIconField:G.itemIconField,itemChildrenField:G.itemChildrenField,itemFunction:function(L,J,K){return new D({idx:J,data:L,parent:K});},listSelector:G.listSelector});return H;}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBSimplePreview");var E=mstrmojo.dom,F=mstrmojo.array;var C;mstrmojo.DI.DIPreviewGrid=mstrmojo.declare(mstrmojo.qb.QBSimplePreview,null,{scriptClass:"mstrmojo.DI.DIPreviewGrid",cssClass:"lockHeader mstrmojo-di-previewGrid",adjustSize:function(K){var J=200,I=this.parent&&this.parent.domNode,M=J*K;if(!I||!this.scrollboxNode){return ;}this.scrollboxNode.style.overflowX=(M>I.clientWidth)?"scroll":"hidden";this.contentWidth=Math.max(M,I.clientWidth)+"px";var H=this.contentWidth,L=this.headerContainerNode,G=this.itemsContainerNode;if(H&&L&&G){L.children[0].style.width=H;G.style.width=H;}},renderOnScroll:false,setupScrollNodes:function B(){this.scrollNode=this.scrollboxNode;},lockHeader:false,postBuildRendering:function A(){if(this._super){this._super();}var G=this.domNode,I=this.scrollboxNode,H=this.headerContainerNode;I.style.height=G.offsetHeight-H.offsetHeight+"px";E.attachEvent(I,"scroll",function(){if(H.scrollLeft!==I.scrollLeft){H.scrollLeft=I.scrollLeft;}});E.attachEvent(H,"scroll",function(){if(I.scrollLeft!==H.scrollLeft){I.scrollLeft=H.scrollLeft;}});},populatePreview:function D(){var L=this.mappings,O=this.selectedColumns,H=0,G=this.scrollboxNode,K,N,I,J,P=this;this.columns=[];if(G){H=G.scrollLeft||0;}this.unrender();F.forEach(L,function(T,V){var X=T.ix,W,S;W=T.n;S={tag:T,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:X,headerText:W,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@headerText}</span></div>',onclick:function U(){var Z=this.columnIndex;C.showPopupMenu(P,{menuNode:this.domNode.lastChild,data:{columnIndex:Z,isVisible:function Y(b,a){return mstrApp.isFFSQLMode?false:true;}}});}},colWidth:"60",dataFunction:function(c,Z,b){var Y=c[this.dataField],a="mstrmojo-di-datapreview-DataRow-text";a+=(Z%2===1)?" odd":" even";return'<div class="'+a+'">'+Y+"</div>";},dataField:V.toString()};P.columns.push(S);});I=this.dataset;if(I.length===0&&this.columns.length>0){var Q=21;var M=parseInt(parseInt(this.parent.height)/Q)-1;M=M>0?M:1;var R;for(K=0;K<M;K++){R=[];for(J=0,N=this.columns.length;J<N;J++){R.push("");}I.push(R);}}this.items=I;this.render();this.adjustSize(L.length);this.updateScrollbars();this.scrollboxNode.scrollLeft=H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.qb.QBSimplePreview");mstrmojo.requiresDescs(13033,12419);var H=mstrmojo.desc;var E;mstrmojo.qb.QBMappings=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBMappings",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},cssClass:"mstrmojo-di-datapreview",cssText:"position:relative;overflow:hidden;border-bottom-right-radius:6px;border-bottom-left-radius:6px;padding:0px;",width:0,height:0,dropZone:false,active:false,children:[{scriptClass:"mstrmojo.Box",alias:"previewInfo",cssClass:"mstrmojo-qb-preview-info",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-preview-text">'+H(13033,"Sample Preview")+'</span><span class="mstrmojo-qb-preview-menu" mstrAttach:click></span></div>',visible:false,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.domNode.lastChild.style.display=(mstrApp.isFFSQL||mstrApp.isFFSQLMode)?"none":"block";}},onclick:function D(){E.showPopupMenu(this.parent,{menuNode:this.domNode.lastChild});}},{scriptClass:"mstrmojo.qb.QBSimplePreview",alias:"content",columns:[],cssText:"width:100%"},{scriptClass:"mstrmojo.Label",alias:"notice",cssClass:"warnLabel",text:H(12419,"No preview available.")}],init:function G(J){var K,I;this._super(J);K={};I=K[this.id]={};I.dataPreview=this.handleDataPreview;mstrApp.getRootController().attachDataChangeListeners(K);},handleDataPreview:function A(J){mstrApp.getRootController().toggleDataPreview(true);var K=this.content,L=this.notice,P=J.mappings,M=J.dataset,I=J.selectedColumns,O=J.isRefined,N=(P&&P.length>0);K.mappings=P;K.dataset=M;K.selectedColumns=I;K.isRefined=O;K.set("visible",N);L.set("visible",!N);this.previewInfo.set("visible",N);N&&K.populatePreview();},onheightChange:function(K){if(this.domNode){var L=Math.max(parseInt(K.value,10)-2,0),I=38,J;this.domNode.style.height=L+"px";J=Math.max(L-I,0);this.content.set("height",J+"px");}},onwidthChange:function B(J){if(this.domNode){var I=parseInt(J.value,10)+"px";if(I!=="NaNpx"){this.domNode.style.width=I;this.content.set("width",I);}}}});function C(){mstrApp.getRootController().deleteAllColumns();}E=mstrmojo.qb.QBMappings;E.showPopupMenu=function F(L,J){var K=E.menuHelper=E.menuHelper||new mstrmojo.qb.QBPreviewMenu();K.target=L;var I=K.getMenuConfig();I.hostId=L.id;I.hostElement=J.menuNode;I.isHostedWithin=false;I.position=mstrmojo.dom.position(J.menuNode,true);L.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:I}));};mstrmojo.qb.QBPreviewMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.DBTableRowMenu",menuCssClass:"mstrmojo-qb-DBTableRowMenu",menuCfg:null,getMenuConfig:function(){var I=this.menuCfg;if(!I){I=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{I.clear();}I.addMenuItem(H(5186,"Delete All"),"",C);return I;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Vis","mstrmojo.color");var A=mstrmojo.css,G=mstrmojo.dom,D;mstrmojo.qb.QBTableLinker=mstrmojo.declare(mstrmojo.Vis,null,{scriptClass:"mstrmojo.qb.QBTableLinker",width:null,height:0,context:0,markupString:'<div id="{@id}" class="mstrmojo-Chart {@cssClass}" style="position:absolute;left:0px;top:0px;width:{@width}px;height:{@height}px;overflow:hidden;"  mstrAttach:mouseover,mousemove,click ><canvas width="{@width}px" height="{@height}px"></canvas><canvas style="position:absolute;left:0;top:0" width="{@width}px" height="{@height}px"></canvas><div id="{@id}-tooltip" class="mstrmojo-Map-tooltip"></div></div>',markupSlots:{canvas:function(){return this.domNode.firstChild;},highlightCanvas:function(){return this.domNode.childNodes[1];},tooltip:function(){return this.domNode.childNodes[2];}},postBuildRendering:function F(){if(this._super){this._super();}if(D===undefined){D=this.canvas&&this.canvas.getContext&&this.canvas.getContext("2d");}if(D){this.context=this.canvas.getContext("2d");this.highlight=this.highlightCanvas.getContext("2d");}else{this.createVMLCanvas();}this.model=mstrmojo.all.QBuilderModel;},getCordValue:function H(L){return CordValue;},drawLinks:function I(){this.clearCanvas();var R=mstrmojo.all.QBuilderModel;if(R.linkerNeedRender){this.render();R.linkerNeedRender=false;}var L=this.model&&this.model.joinsInfo;for(var Q in L){var X=L[Q],N=X.links;for(linkid in N){var T=N[linkid].srcw,O=N[linkid].tgtw,V=T.parent.parent,S=O.parent.parent,Z=parseInt(V.leftAnchor()),P=parseInt(V.rightAnchor()),M=parseInt(S.leftAnchor()),Y=parseInt(S.rightAnchor()),d=V.containerNode.clientWidth,U=G.position(T.domNode),W=G.position(O.domNode),b=G.position(this.domNode),c=G.position(V.containerNode),a=G.position(S.containerNode);if(U.y>c.y&&U.y+0.5*U.h<c.y+c.h){srcwy=U.y-b.y+0.5*T.domNode.clientHeight;}else{srcwy=c.y-b.y-0.5*V.titleNode.clientHeight;}if(W.y>a.y&&W.y+0.5*W.h<a.y+a.h){tgtwy=W.y-b.y+0.5*O.domNode.clientHeight;}else{tgtwy=a.y-b.y-0.5*S.titleNode.clientHeight;}if(M>Z+0.5*d){srcwx=P;srcwx1=srcwx+20;tgtwx=M;tgtwx1=tgtwx-20;}else{if(M>Z&&M<Z+0.5*d){srcwx=P;srcwx1=srcwx+20;tgtwx=Y;tgtwx1=tgtwx+20;}else{if(M<Z&&Y>Z+0.5*d){srcwx=Z;srcwx1=srcwx-20;tgtwx=M;tgtwx1=tgtwx-20;}else{srcwx=Z;srcwx1=srcwx-20;tgtwx=Y;tgtwx1=tgtwx+20;}}}N[linkid].marker=[{x:srcwx,y:srcwy},{x:srcwx1,y:srcwy},{x:tgtwx1,y:tgtwy},{x:tgtwx,y:tgtwy}];N[linkid].coords=[srcwx,srcwy+5,srcwx,srcwy-5,srcwx1,srcwy-5,tgtwx1,tgtwy-5,tgtwx,tgtwy-5,tgtwx,tgtwy+5,tgtwx1,tgtwy+5,srcwx1,srcwy+5];this.drawLine(srcwx,srcwy,srcwx1,srcwy);this.drawLine(srcwx1,srcwy,tgtwx1,tgtwy);this.drawLine(tgtwx1,tgtwy,tgtwx,tgtwy);switch(X.jt){case"3":this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy+5);this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy+5);break;case"1":this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy+5);this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy-5);break;case"2":this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy+5);break;default:break;}}}if(D){this.context.stroke();}this.drawMarker();},clearCanvas:function K(){if(D){this.context.clearRect(0,0,this.width,this.height);this.context.beginPath();}else{var L=document.getElementById("vmlCanvas");if(L&&L.hasChildNodes()){while(L.childNodes.length>=1){L.removeChild(L.firstChild);}this.createVMLCanvasFrame();}}},clearHighLightCanvas:function(){if(D){this.highlight.clearRect(0,0,this.width,this.height);this.highlight.beginPath();}},drawMarker:function(){if(D){this.clearHighLightCanvas();if(!this.model.selLink){return ;}var P=this.model;var O=P.joinsInfo[P.selLink[0]].links[P.selLink[1]].marker,M=this.highlight;for(var N=0,L=O.length;N<L;N++){M.strokeStyle="blue";M.beginPath();M.arc(O[N].x,O[N].y,3,0,Math.PI*2,true);M.closePath();M.stroke();}}},drawLine:function C(N,P,M,O){if(D){this.context=this.canvas.getContext("2d");this.context.moveTo(N,P);this.context.lineTo(M,O);}else{var L=document.createElement("v:line");L.setAttribute("from",N+" "+P);L.setAttribute("to",M+" "+O);document.getElementById("vmlCanvas").appendChild(L);}},createVMLCanvasFrame:function J(){var L=document.createElement("v:rect");L.setAttribute("id","vmlFrame");L.setAttribute("stroke","true");L.setAttribute("strokecolor","red");L.style.width=isNaN(this.width)?"auto":this.width;L.style.height=isNaN(this.height)?"auto":this.height;L.style.zindex="-1";document.getElementById("vmlCanvas").appendChild(L);},createVMLCanvas:function E(){var N=parseInt(this.width);var M=parseInt(this.height);var L=document.createElement("v:group");L.setAttribute("id","vmlCanvas");L.style.width=isNaN(this.width)?"auto":this.width;L.style.height=isNaN(this.height)?"auto":this.height;L.setAttribute("coordorigin","0, 0");L.setAttribute("coordsize",N+", "+M);this.domNode.appendChild(L);this.createVMLCanvasFrame();return ;},renderTooltip:function B(O,R,Q,S){var L=this.model.gts;if(S>=0){var N=L.row[0].n+": "+O;var M;for(M=0,len=L.col[0].es.length;L&&L.col&&M<len;M++){var T=this.model.gvs.items[S].items[M];var P=T.v;if(T.ty==4){P='<img src="'+P+'" >';}N+="<br>"+L.col[0].es[M].n+": "+P;}this.tooltip.innerHTML=N;}if(R+this.tooltip.offsetWidth>this.width){R=R-this.tooltip.offsetWidth;}this.tooltip.style.webkitTransform="translate3d("+R+"px, "+Q+"px, 0)";this.tooltip.style.MozTransform="translate("+R+"px, "+Q+"px)";if(this.tooltip.className.indexOf("fadeIn")<0){this.tooltip.className=this.tooltip.className+" fadeIn";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.ListFacet","mstrmojo.Refine.RangeFacet","mstrmojo.Refine.TimeRangeFacet","mstrmojo.Refine.TextSearchFacet");var A=mstrmojo.dom;mstrmojo.Refine.RefineFacetPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineFacetPanel",facets:[],markupString:'<div class="refine-facet-panel"><div class="browsing-panel-header"><div class="browsing-panel-indicator"><img src="../javascript/mojo/css/images/Refine/small-spinner.gif"> Refreshing facets...</div><div class="browsing-panel-controls"  mstrAttach:click><div class="browsing-panel-controls-refresh"><a class="button" title="Update all facets">Refresh</a></div><a class="button button-pill-left" title="Clear selection in all facets">Reset All</a><a class="button button-pill-right" title="Remove all facets">Remove All</a></div></div><ul class="facets-container ui-sortable"></ul></div>',markupSlots:{ulNode:function(){return this.domNode.children[1];},indicatornNode:function(){return this.domNode.children[0].children[0];},controlsNode:function(){return this.domNode.children[0].children[1];},refreshNode:function(){return this.domNode.children[0].children[1].children[0].children[0];},resetNode:function(){return this.domNode.children[0].children[1].children[1];},removeNode:function(){return this.domNode.children[0].children[1].children[2];},headerNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onclick:function(C){var F=C.e,E,D=A.eventTarget(C.hWin,F);if(D===this.refreshNode){this.updateEngine(true);}else{if(D===this.resetNode){this.resetAllFacets();this.updateEngine(true);}else{if(D===this.removeNode){this.removeAllFacets();this.updateEngine(true);}}}},resetAllFacets:function(){var C;for(C=0;C<this.facets.length;C++){var D=this.facets[C];D.reset();}},removeAllFacets:function(){var D;while(this.facets.length){var C=this.facets[0];this.facets.splice(0,1);this.removeChildren(C);C.destroy();}for(D=0;D<this.facets.length;D++){if(typeof this.facets[D].update==="function"){this.facets[D].update();}}},hasSelection:function(){var C;for(C=0;C<this.facets.length;C++){var D=this.facets[C];if(D.hasSelection()){return true;}}return false;},getRequirementDiscription:function(){var D,C="";var E=[],F;for(D=0;D<this.facets.length;D++){F=this.facets[D];if(F.hasSelection()){E.push(F);}}for(D=0;D<E.length;D++){F=E[D];C+=F.getRequirementDiscription();if(D!==E.length-1){C+=" & ";}}return C;},getJSON:function(D){var E;var C={facets:[],mode:"row-based"};for(E=0;E<this.facets.length;E++){var F=this.facets[E];if(D||F.hasSelection()){C.facets.push(F.getJSON());}}return C;},updateEngine:function(E){var C=this.parent.parent.parent.controller;var D=C.model;if(E){this.parent.toggleSecondItemVisibility(true);this.controlsNode.style.visibility="hidden";this.indicatornNode.style.visibility="visible";D.engine=JSON.stringify(this.getJSON());D.start=0;C.loadData();}else{D.engine=JSON.stringify(this.getJSON());}},addFacets:function(D,C){var E;switch(D){case"range":E=new mstrmojo.Refine.RangeFacet({slot:"ulNode",type:D,config:C,options:{}});break;case"timerange":E=new mstrmojo.Refine.TimeRangeFacet({slot:"ulNode",type:D,config:C,options:{}});break;case"text":E=new mstrmojo.Refine.TextSearchFacet({slot:"ulNode",type:D,config:C,options:{}});break;default:E=new mstrmojo.Refine.ListFacet({slot:"ulNode",type:D,config:C,options:{sort:"name"}});}this.addChildren([E]);this.facets.push(E);this.updateEngine(true);},removeFacet:function(F){var D;var E=F.hasSelection();for(D=this.facets.length-1;D>=0;D--){var C=this.facets[D];if(C===F){this.facets.splice(D,1);this.removeChildren(C);C.destroy();break;}}for(D=0;D<this.facets.length;D++){if(typeof this.facets[D].update==="function"){this.facets[D].update();}}if(E){this.updateEngine(true);}else{this.updateEngine(false);if(this.facets.length===0){this.parent.toggleSecondItemVisibility(false);}}},handleFacetsFetched:function(E){var D=E.facets,C;for(C=0;C<D.length;C++){this.facets[C].updateState(D[C]);}this.indicatornNode.style.visibility="hidden";if(this.facets.length>0){this.controlsNode.style.visibility="visible";}else{this.parent.toggleSecondItemVisibility(false);}this.updateEngine(false);},children:[],setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);if(isNaN(C)||isNaN(E)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}if(C<2){C=2;}this.layoutConfig.h.ulNode=(C-2)+"px";this.layoutConfig.w.ulNode=(E-2)+"px";if(this._super){this._super((C-2)+"px",(E-2)+"px");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.PopupEditBox","mstrmojo.Widget","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.Container","mstrmojo.Refine.RefineDataHeader","mstrmojo.Refine.RefineDataCell","mstrmojo.Refine.RefinePagination","mstrmojo.dom");mstrmojo.requiresDescs(4046,4049,1058,1059,2968);var C={scriptClass:"mstrmojo.Refine.RefineDataHeader"};var B={scriptClass:"mstrmojo.Refine.RefineDataCell"};var E="### rows";function A(F){return F.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,");}mstrmojo.Refine.RefineDataPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineDataPreview",markupString:'<div class="refine-data-preview"><div class="fixed-width-preview-container"><div class="fixed-width-preview-container-inner" mstrAttach:scroll></div></div><div class="refine-viewpanel-header"></div></div>',markupSlots:{headerNode:function(){return this.domNode.children[1];},dataNode:function(){return this.domNode.children[0];},tableNode:function(){return this.domNode.children[0].children[0];}},enableEdit:true,columnIndex:-1,lastColumnIndex:-1,markupMethods:{onvisibleChange:function(){this.headerNode.style.display=this.enableEdit?"block":"none";}},onscroll:function(){this.controller.model.raiseEvent({name:"previewScrollTop",scrollTop:this.tableNode.scrollTop});},setDimensions:function D(I,G){var F=parseInt(I,10);var H=parseInt(G,10);if(isNaN(F)||isNaN(H)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.dataNode=(this.enableEdit?(F-21-2):(F-2))+"px";this.layoutConfig.w.dataNode=(H-2)+"px";this.layoutConfig.h.tableNode=(this.enableEdit?(F-21-2):(F-2))+"px";this.layoutConfig.w.tableNode=(H-2)+"px";this.layoutConfig.w.headerNode=(H-16-2)+"px";if(this._super){this._super((F-2)+"px",(H-2)+"px");}},children:[{scriptClass:"mstrmojo.Refine.RefinePagination",slot:"headerNode",alias:"pagingNode",},{scriptClass:"mstrmojo.Table",slot:"tableNode",cssClass:"refine-table",alias:"dataTable",onremoveChild:function(F){var H=F.value;for(var G=0;G<H.length;G++){H[G].destroy();}},populateData:function(I,J){this.removeChildren();this.unrender();var H=0,G,F;this.rows=J.rows.length+1;this.cols=I.length;for(G=0;G<I.length;G++){C.slot=H+","+G;C.columnIndex=G;C.text=I[G].name;C.preview=this.parent;C.allowEdit=this.parent.enableEdit;this.addChildren(C);}for(H=1;H<=J.rows.length;H++){for(G=0;G<I.length;G++){F=B;F.slot=H+","+G;F.columnIndex=G;F.column=I;F.rowIndex=J.rows[H-1].i;var K=J.rows[H-1].cells[I[G].cellIndex];if(K===null||K===undefined){K={v:""};}if(K.v===null||K.v===undefined){K.v="";}F.text=K.v;if(K.t){F.cssClass=K.t;}else{if(typeof K.v==="string"||K.v instanceof String){F.cssClass="text";F.text=K.v;}else{F.cssClass="number";}}F.preview=this.parent;F.columnName=I[G].name;this.addChildren(F);}}this.render();this.updateCellClass(I,J);},updateCellClass:function(I,K){var H,G;var J=this.domNode.firstChild.children;for(H=0;H<=K.rows.length;H++){var L=J[H];var F=L.children;for(G=0;G<I.length;G++){if(H===0){F[G].className="refine-header";}else{F[G].className="refine-cell";}if(this.parent.columnIndex>=0&&this.parent.columnIndex===G){F[G].className+=" selected";if(H===K.rows.length){F[G].className+=" last";}}if(this.parent.lastColumnIndex>=0&&this.parent.lastColumnIndex===G){F[G].className+=" last-selected";if(H===K.rows.length){F[G].className+=" last";}}}}}}],columns:null,populate:function(G,H){var F=this.controller.model;this.dataTable.populateData(G,H);this.pagingNode.children[2].set("text",E.replace("###",A(F.data.filtered)));this.pagingNode.right.totalPages.set("text","/ "+Math.ceil((parseInt(F.data.filtered,10)/parseInt(F.limit,10))).toString());this.pagingNode.set("totalPages",Math.ceil((parseInt(F.data.filtered,10)/parseInt(F.limit,10))).toString());this.handleStartChange();},handleDataChanged:function(F){this.data=F.value;this.populate(this.columns,this.data);this.controller.model.raiseEvent({name:"columnUnSelected"});},handleColumnsChanged:function(F){this.columns=F.value.columns;},handleColumnSelected:function(F){if(this.columnIndex!==F.columnIndex){if(F.isCtrlKey){this.lastColumnIndex=this.columnIndex;this.lastColumnName=this.columnName;}else{this.lastColumnIndex=-1;}this.columnIndex=F.columnIndex;this.columnName=F.columnName;this.dataTable.updateCellClass(this.columns,this.data);if(F.updateScrollLeft){this.tableNode.scrollLeft=this.dataTable["0,"+this.columnIndex].offsetLeft;}}if(this.lastColumnIndex>=0){if(this.lastColumnIndex<this.columnIndex){this.controller.generateColumnSuggestions(this.columnIndex,this.lastColumnName,this.columnName,this.columnIndex-this.lastColumnIndex+1);}else{this.controller.generateColumnSuggestions(this.columnIndex,this.columnName,this.lastColumnName,this.lastColumnIndex-this.columnIndex+1);}}else{this.controller.generateColumnSuggestions(this.columnIndex);}},handleColumnUnSelected:function(){this.columnIndex=-1;this.lastColumnIndex=-1;if(this.data){this.dataTable.updateCellClass(this.columns,this.data);}this.controller.model.raiseEvent({name:"emptySuggestions"});},handleStartChange:function(){var F=this.controller.model;if(F.start===0){this.pagingNode.right.firstNode.set("enabled",false);this.pagingNode.right.firstNode.set("useRichTooltip",false);this.pagingNode.right.previousNode.set("enabled",false);this.pagingNode.right.previousNode.set("useRichTooltip",false);}else{this.pagingNode.right.firstNode.set("enabled",true);this.pagingNode.right.firstNode.set("useRichTooltip",true);this.pagingNode.right.previousNode.set("enabled",true);this.pagingNode.right.previousNode.set("useRichTooltip",true);}if(F.start+F.limit>=F.data.filtered){this.pagingNode.right.nextNode.set("enabled",false);this.pagingNode.right.nextNode.set("useRichTooltip",false);this.pagingNode.right.lastNode.set("enabled",false);this.pagingNode.right.lastNode.set("useRichTooltip",false);this.pagingNode.right.currentPage.set("value",parseInt(parseInt(F.start,10)/parseInt(F.limit,10),10)+1);this.pagingNode.children[0].set("text",A(parseInt(F.start,10)+1)+" - "+A(F.data.filtered));}else{this.pagingNode.right.nextNode.set("enabled",true);this.pagingNode.right.nextNode.set("useRichTooltip",true);this.pagingNode.right.lastNode.set("enabled",true);this.pagingNode.right.lastNode.set("useRichTooltip",true);this.pagingNode.right.currentPage.set("value",parseInt(parseInt(F.start,10)/parseInt(F.limit,10),10)+1);this.pagingNode.children[0].set("text",A(parseInt(F.start,10)+1)+" - "+A(parseInt(F.start,10)+parseInt(F.limit,10)));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.PopupEditBox","mstrmojo.Widget","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.Container","mstrmojo.Refine.RefineDataHeader","mstrmojo.Refine.RefineDataCell","mstrmojo.dom");var B={scriptClass:"mstrmojo.Refine.RefineDataHeader"};var A={scriptClass:"mstrmojo.Refine.RefineDataCell"};mstrmojo.Refine.RefineSuggestionPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineSuggestionPreview",markupString:'<div class="refine-suggestion-preview"><div class="fixed-width-preview-container"><div class="fixed-width-preview-container-inner"></div></div></div>',markupSlots:{dataNode:function(){return this.domNode.children[0];},tableNode:function(){return this.domNode.children[0].children[0];}},enableEdit:true,scrollTop:0,setDimensions:function C(E){var D=parseInt(E,10);if(isNaN(D)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.dataNode=(this.enableEdit?(D-21-2):(D-2))+"px";this.layoutConfig.w.dataNode="auto";this.layoutConfig.h.tableNode=(this.enableEdit?(D-21-2):(D-2))+"px";this.layoutConfig.w.tableNode="auto";if(this.domNode){if(this.cellPos){this.domNode.style.top=this.cellPos.tableTop+"px";if(this.domNode.clientWidth+10<this.cellPos.distanceToRight){this.domNode.style.left=this.cellPos.cellRight+10+"px";this.domNode.style.right="";this.domNode.className="refine-suggestion-preview left";}else{if(this.domNode.clientWidth+10<this.cellPos.distanceToLeft){this.domNode.style.right=(this.cellPos.cellRight+this.cellPos.distanceToRight)-this.cellPos.cellLeft+10+"px";this.domNode.style.left="";this.domNode.className="refine-suggestion-preview right";}else{if(this.cellPos.distanceToRight>=this.cellPos.distanceToLeft){this.domNode.style.left="";this.domNode.style.right="0px";this.domNode.className="refine-suggestion-preview left";}else{this.domNode.style.left="0px";this.domNode.style.right="";this.domNode.className="refine-suggestion-preview right";}}}}}if(this._super){this._super((D-2)+"px","auto");}},children:[{scriptClass:"mstrmojo.Table",slot:"tableNode",cssClass:"refine-table",alias:"dataTable",onremoveChild:function(D){var F=D.value;for(var E=0;E<F.length;E++){F[E].destroy();}},populateData:function(G,H){if(!G||!H){this.parent.domNode.style.display="none";return ;}else{this.parent.domNode.style.display="block";this.parent.domNode.style.left="";this.parent.domNode.style.right="";}this.removeChildren();this.unrender();var F=0,E,D;this.rows=H.rows.length+1;this.cols=G.length;for(E=0;E<G.length;E++){B.slot=F+","+E;B.columnIndex=E;B.text=G[E].name;B.preview=this.parent;B.suggestionPreview=G[E].suggestionPreview;B.cssClass="suggestion-preview columnNumber"+G[E].columnNumber;B.allowEdit=this.parent.enableEdit;this.addChildren(B);}for(F=1;F<=H.rows.length;F++){for(E=0;E<G.length;E++){D=A;D.slot=F+","+E;D.columnIndex=E;D.column=G;D.rowIndex=H.rows[F-1].i;var I=H.rows[F-1].cells[G[E].cellIndex];if(I===null||I===undefined){I={v:""};}if(I.v===null||I.v===undefined){I.v="";}D.text=I.v;if(I.t){D.cssClass="date";}else{if(typeof I.v==="string"||I.v instanceof String){D.cssClass="text";D.text=I.v;}else{D.cssClass="number";}}D.cssClass+=" suggestion-preview";D.cssClass+=" columnNumber"+I.columnNumber;D.preview=this.parent;D.columnName=G[E].name;this.addChildren(D);}}this.render();this.updateCellClass(G,H);this.parent.setDimensions(parseInt(this.parent.domNode.style.height,10)+2);},updateCellClass:function(G,I){var F,E;var H=this.domNode.firstChild.children;for(F=0;F<=I.rows.length;F++){var J=H[F];var D=J.children;for(E=0;E<G.length;E++){if(F===0){D[E].className="refine-header";if(E===0){D[E].className+=" left";}if(E===G.length-1){D[E].className+=" right";}}else{D[E].className="refine-cell";if(E===0){D[E].className+=" left";}if(E===G.length-1){D[E].className+=" right";}if(F===I.rows.length){D[E].className+=" bottom";}}}}this.parent.tableNode.scrollTop=this.parent.scrollTop;}}],populate:function(D,E){this.dataTable.populateData(D,E);},handlePreviewSuggestion:function(D){this.cellPos=D.cellPos;this.populate(D.columns,D.data);},handleUnPreviewSuggestion:function(){this.populate();},handlePreviewScrollTop:function(D){this.scrollTop=D.scrollTop;}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui.tabs.Tab","mstrmojo.ME.MetricEditBox","mstrmojo.array","mstrmojo.hash");var Z=mstrmojo.array,M=mstrmojo.hash,K=mstrmojo.ME.MetricToken.brackets,L=mstrmojo.dom,B=mstrmojo.css,Q=mstrmojo.vi.ui.tabs.Tab.ACTIONS,g=Q.DELETE+Q.RENAME,j=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,D=mstrmojo.string,l="This@ID",T="45C11FA478E745FEA08D781CEA190FE5";function G(p){return{n:p,k:p,ftk:[],vs:1,is:""};}function O(x,z,p,u){var t=x.forms[z]||{},w=x.forms[p],q=x.inputBox;if(z!==p){t.vs=x.vStatus;t.is=x.iStatus;t.ftk=q.items;x.set("vStatus",j.UNKNOWN);}x.set("vStatus",w.vs);x.set("iStatus",w.is);x.updateInputBoxItems({items:w.ftk});if(x.curFormIdx!==p){x.curFormIdx=p;x.tabstrip.setSelectedTab(w.k);}x.raiseEvent({name:"tabSwitch",tks:w.ftk,vs:w.vs,is:w.is,oidx:z,nidx:p,toNewTab:u});}function N(q){var p=q.forms[q.curFormIdx];if(p){p.ftk=q.inputBox.items;p.vs=q.vStatus;p.is=q.iStatus;}}var e=0;function W(p){e=Math.max(p.length-1,e);}function V(){e=0;}function m(p){var q="DESC"+(e?" "+e:"");e++;if(Z.find(p,"n",q)>=0){return m(p);}return q;}function I(w){var u={v:K(w.n),oi:w,isNew:true},q,p;if(w.t===12){q=Z.filter(w.fs,function(t){return t.obf||w.da;}).length;if(q===1){p=w.fs[0];u=M.copy({v:K(w.n)+"@"+K(p.fnm),ift:true,exv:p.fid,extp:8},u);}else{u=M.copy({v:K(w.n)+"@",ift:true},u);}}return u;}function E(q,p){q.set("enabled",!p);var t="mstrmojo-InlineWaitIcon";if(q.iconClass){q.set("iconClass",q.iconClass.replace(new RegExp(t),"")+" "+(p?t:""));}else{mstrmojo.css.toggleClass(q.domNode,t,p);}}var U=function(AB){var u=AB.items,w=u.length,x=u[u.length-1],t,q,AA=[],p="",z;if(u[0]&&u[0].tp!==33){AA.push({v:"!",tp:33,lv:4,sta:2});}for(t=0;t<w;t++){q=u[t];if(q.isNew&&!q.oi){p+=q.v;}else{if(!D.isEmpty(p)){AA.push({v:p,tp:2,lv:1});p="";}if(q.v&&q.v.indexOf(l)>=0){q.v=q.v.replace("["+l+"]",l);q.exv=T;q.extp=8;delete q.oi;}AA.push(q);}}if(!D.isEmpty(p)){AA.push({v:p,tp:2,lv:1});p="";}if(x&&x.tp!==-1){AA.push({v:"",tp:-1,lv:4,sta:2});}return{items:AA};},a=function(t){var p=t.items||[],q=p[p.length-1];if(q&&q.tp===-1){p.pop();}if(p[0]&&(p[0].tp===33||p[0].tp===37)){p.splice(0,1);}Z.forEach(p,function(u){if(u.v&&u.v.indexOf(l)>=0){M.copy({extp:8,exv:T,oi:{n:"This",did:"This",t:12}},u);}});},Y=function(p){if(!p){return j.VALID;}return{"-2147214845":j.ERROR,"-2147214846":j.AMBIGUITY}[p]||j.ERROR;},R=function(t){t=U(t);var q={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true,vtp:true},p={getArrItemName:function(){return"tkn";},isSerializable:function(u){return(q[u])?true:false;}};return D.json2xml("tknstrm",t,p);},F=function(t,x,w,q){var u=R(x),z=function(AA){if(AA&&AA.tks){var AB=AA.tks;a(AB);AB.vs=Y(AB.rjec);AB.tokenXML=u;if(q){q(AB);}}},p=function(AA){mstrmojo.alert(AA.message||AA.getResponseHeader&&AA.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:u,localSymbolFolderXML:"",metricXML:"",metricId:t||"",isNew:true,objectType:12,isIDForm:w,msgID:mstrApp.getMsgID()},{success:z,failure:p});};mstrmojo.ME.DerivedAttributeFormTab=mstrmojo.declare(mstrmojo.vi.ui.tabs.Tab,null,{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",valid:true,editable:true,postBuildRendering:function S(){if(this._super){this._super();}var p=this,q=p.lbl;q.editOnDoubleClick=this.editable;q.onTextEditComplete=function(u,t){if(p.validate(q.text)){p.titleEdited(q.text,t);}};},onclick:function d(p){var q=mstrmojo.dom.eventTarget(p.hWin,p.e);if(q===this.menuBtnNode){this.tabDeleted();}else{if(!this.isSelected){this.tabSelected();}}},validate:function(p){var q=!/[\[\]\"\\]/g.test(p);if(!q){this.lbl.set("isEditing",true);}this.set("valid",q);return q;},showErrTooltip:function o(w,t){var p=mstrmojo.dom.position(this.domNode),q=this,u=q.errTooltip;if(!u){q.errTooltip=u=new mstrmojo.Tooltip({contentNodeCssClass:"me-tooltip-content up me-err",updatePopupConfig:null});this.addDisposable(u);}u.set("top",p.y+p.h+2);u.set("left",p.x+p.w/2-t);u.set("content",'<div class="content"><span>'+w+"</span></div>");u.open();window.setTimeout(function(){u.close();},2500);},onvalidChange:function(){if(this.valid){this.hideTooltip();}else{this.showErrTooltip(mstrmojo.desc(11569,"Input contains invalid character"),95);}}});function f(u,w,x){var t=Z.find(w,"k",x.k);return{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",title:x.n,draggable:false,editable:t!==0,cssClass:"mstrmojo-AEB-Tab "+(t===0?"mstrmojo-AEB-IDTab":""),getMenuActions:function(){return g;},tabSelected:function(){O(u,u.curFormIdx,t);},titleEdited:function q(AA,z){if(AA!==z){if(Z.find(u.forms,"n",AA)>=0){this.showErrTooltip(mstrmojo.desc(7209,"Name already exists"),69);}var AB=u.forms[t];AB.n=AA;}},tabDeleted:function p(){var z=u.forms.length,AC=(u.curFormIdx===z-1)?0:u.curFormIdx,AA=u.forms.slice(0),AB=AA[t];if(AB&&AB.did){u.delForms.push({n:AB.n,did:AB.did});}AA.splice(t,1);u.curFormIdx=AC;u.set("forms",AA);O(u,-1,AC);u.set("dirty",true);}};}mstrmojo.ME.AttributeEditBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,null,{scriptClass:"mstrmojo.ME.AttributeEditBox",markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-AEB-TabStrip"></div><div class="mstrmojo-MEBox-edit mstrmojo-AEB-edit"></div><div class="mstrmojo-MEBox-status {@statusCssClass}"><div class="mstrmojo-MEBox-vStatus"></div><div class="mstrmojo-MEBox-iStatus"></div></div></div>',markupSlots:{tabstripNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},statusNode:function(){return this.domNode.lastChild;},iStatusNode:function(){return this.domNode.lastChild.lastChild;},vStatusNode:function(){return this.domNode.lastChild.firstChild;}},forms:null,delForms:[],curFormIdx:0,attrid:null,absorbAmbiguity:false,init:function k(t){var u=this;u.children=[{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",alias:"tabstrip",position:"top",slot:"tabstripNode",isAlignRight:false,getTabCfg:function q(z,AA,x){return M.copy(f(u,z,AA),x);},addTab:function w(){var AA=u.forms,x=AA.length,AB=m(AA),z=AA.slice(0);z.push(G(AB));u.set("forms",z);O(u,u.curFormIdx,x,true);u.set("dirty",true);},clear:function p(){Z.forEach(this.children,function(x){x.hideTooltip();});}},{scriptClass:"mstrmojo.Button",alias:"clearBtn",slot:"tabstripNode",text:mstrmojo.desc(1763,"Clear All"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-clearAll",onclick:function(){u.inputBox.clearTokens([]);}},{scriptClass:"mstrmojo.Button",alias:"validateBtn",slot:"tabstripNode",text:mstrmojo.desc(11897,"Validate"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-validate",onclick:function(){u.validateCurrentForm();}}].concat(this.children);this._super(t);},item2textCss:function J(p){return this._super(p)||{21:"afm"}[p.t]||"";},onformsChange:function X(){var p=this.forms,q=p[this.curFormIdx].k;Z.forEach(p,function(t){a({items:t.ftk});});this.tabstrip.setTabs(p,q);W(p);},selectFormTab:function A(p){O(this,this.curFormIdx,p);},postBuildRendering:function S(){if(this._super){this._super();}this.clear();var p=this;this.inputBox.ondrop=function(AB){if(!AB.src.data||!AB.src.data.item){return ;}var AA=p.inputBox,w=AA.ctxtBuilder.itemWidgets,x=M.copyProps(["did","n","t","fs"],AB.src.data.item),u=I(x),z,q,t;AB.src.data=u;mstrmojo.ListBase2.prototype.ondrop.call(this,AB);if(p.ontokensModify){p.ontokensModify();}z=this.selectedIndices;if(x.t===12&&u.ift&&!u.exv){for(q in z){t=w[q];if(t){AA.startTokenSuggestion(t);}}}AA.clearSelect(true);B.removeClass(AA.domNode,"unselectable");};},clear:function c(){this.curFormIdx=0;this.delForms=[];this.attrid=null;V();this.set("forms",[G("ID")]);this.inputBox.set("items",[]);this.inputBox.resetTokensCache();this.set("vStatus",j.UNKNOWN);this.set("iStatus","");this.tabstrip.clear();},validateCurrentForm:function C(q){var t=this,u=this.validateBtn,p=function(w){E(u,false);t.set("vStatus",w.vs);t.set("iStatus",w.rjed||"");t.updateInputBoxItems({items:w.items});t.statusNode.style.display="block";t.handleValidation(w);if(q){q(w.items,w.vs===j.VALID);}};t.set("vStatus",j.VALIDATING);E(u,true);F(this.attrid,{items:this.inputBox.items},t.curFormIdx===0,p);},validateAllForms:function n(t){var u=this,q=u.forms,p=0,w=function(AA){var z=(p===0);if(AA){var x=q[p-1];x.ftk=AA.items;x.vs=AA.vs;x.is=AA.rjed||"";x.tokenXML=R({items:AA.items});if(AA.vs!==j.VALID){u.selectFormTab(p-1);u.handleValidation(AA);if(t){t(null,false);}return ;}}if(p===q.length){if(t){t(q,true);}return ;}F(u.attrid,{items:q[p++].ftk},z,w);};N(u);w();},continueValidataion:function P(){this.validateCurrentForm();},getStatusDesc:function b(p){return{0:mstrmojo.desc(11655,"Valid Formula.")}[p];},onvStatusChange:function h(){this.statusNode.style.display=this.vStatus>=j.VALIDATING?"block":"none";},onObjectInsert:function H(u){var w=this.inputBox,t=I(u),p=w.insertTokens([t]),q;if(u.t===12&&t.ift&&!t.exv){q=w.ctxtBuilder.itemWidgets[p];if(q){w.startTokenSuggestion(q);}}}});mstrmojo.ME.AttributeEditBox.preprocessTokenStream=a;mstrmojo.ME.AttributeEditBox.postprocessTokenStream=U;mstrmojo.ME.AttributeEditBox.mapErrorCode=Y;mstrmojo.ME.AttributeEditBox.getTokenStreamXML=R;mstrmojo.ME.AttributeEditBox.validateSyntax=F;mstrmojo.ME.AttributeEditBox.prepareInsertToken=I;}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.qb.FFsqlInput");var H=mstrmojo.array,G=mstrmojo.hash;function C(J,K){var I=K?"\n":"",L;for(L=0;L<J;++L){I+=" ";}return I;}mstrmojo.qb.FFsqlEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.FFsqlEditor",cssClass:"mstrmojo-qb-ffsqlview",children:[{scriptClass:"mstrmojo.Box",alias:"passlabel",cssClass:"mstrmojo-qb-ffsqlview-passlabel"},{scriptClass:"mstrmojo.qb.FFsqlInput",alias:"ffsql",cssClass:"mstrmojo-qb-ffsqlview-editnode",id:"FFsql",txt:"",dropZone:true,onwidthChange:function B(){if(this.hasRendered){this.parent.updatepasses();}},onheightChange:function E(){if(this.hasRendered){this.parent.updatepasses();}},updateSQL:function D(I){if(!this.candidates){this.set("candidates",{items:this.sqlTokens.concat(mstrApp.getRootController().getSuggestionItems(true)),isComplete:true});}this.clearTokens();this.txt=I.value;this.clipboardNode.value=I.keepFormat?this.txt:this.formatSQL(this.txt);this.handlepaste();if(I.value===""){this.parent.updatepasses();}this.oriSQL=this.getSQLstmt();},formatSQL:function A(P){var N,L=false,J=C(2,false),Q=C(1,false),M="\n",O=C(9,true),K=C(10,true),I=false;N=P.replace(/,/g," ,").replace(/;/g," ;").replace(/\n/g," ").replace(/ +/g," ").split(" ");H.forEach(N,function(S,R){switch(S){case"from":case"having":N[R]="\n"+N[R]+J;break;case"group":if(N[R+1]==="by"){N[R]="\n"+N[R]+Q;}break;case"where":N[R]=M+N[R];break;case"join":case"outer":if(L){break;}case"full":case"left":case"right":N[R]=K+N[R];L=true;break;case",":if(!I){N[R]=N[R]+O;}break;case"on":N[R]=K+N[R];L=false;break;case";":N[R]=N[R]+"\n";break;case"in":I=true;break;default:if(I&&S.length>=1&&S[S.length-1]===")"){I=false;}break;}});return N.join(" ").replace(/ ,/g,",");}}],onwidthChange:function B(I){var L=this.ffsql,K=L.domNode,J;J=Math.max(parseInt(I.value,10)-10,0)+"px";L.set("width",J);if(K){K.style.width=J;}},updatepasses:function F(){var L,N=this.ffsql,M=[],K={scriptClass:"mstrmojo.Button"},I=this.domNode.clientHeight,J=this.passlabel;L=N.getPassLabelYCoords();H.forEach(L,function(P,O){if(P>=0&&P<=I){M.push(G.copy(K,{cssText:["top:",P,"px;"].join(""),cssClass:(N.pnum===O?"error":"")}));}});J.removeChildren(null,true);J.addChildren(M,0,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.string","mstrmojo.form","mstrmojo._FormatDefinition","mstrmojo.ME.MetricDataService","mstrmojo.ME.MetricEditBox","mstrmojo.mstr.EnumDataType","mstrmojo.ME.Enum");mstrmojo.requiresDescs(218,219,221,531,628,1442,1918,2102,2116,2154,2213,2919,5298,5424,5728,5891,7558,7984,7987,11566,13249);var F=mstrmojo.string,n=mstrmojo.mstr.EnumDataType,A=mstrmojo.ME.MetricDataService;function R(u){var p=u.items,S=p.length,t="",q;for(q=0;q<S;q++){t+=p[q].v;}return t;}var J=mstrmojo.dom,E=mstrmojo.string,P=mstrmojo._FormatDefinition,k=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,C=mstrmojo.ME.Enum.METRIC_EDIT_TYPES;var U=function(S){if(!S){return k.VALID;}return{"-2147214845":k.ERROR,"-2147214846":k.AMBIGUITY}[S]||k.ERROR;},T=function(z){var u=z.items,p=u.length,x=u[u.length-1],t,w,q=[],S="";if(u[0]&&u[0].tp!==38){q.push({v:"&",tp:38,lv:4,sta:2});}for(t=0,p=u.length;t<p;t++){w=u[t];if(w.isNew&&!w.oi){S+=w.v;}else{if(!E.isEmpty(S)){q.push({v:S,tp:2,lv:1});S="";}q.push(w);}}if(!E.isEmpty(S)){q.push({v:S,tp:2,lv:1});S="";}if(x&&x.tp!==-1){q.push({v:"",tp:-1,lv:4,sta:2});}return{items:q};},N=function(q){var t=T(q.tks);var p={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true},S={getArrItemName:function(x,u,w){return"tkn";},isSerializable:function(x,w,u){return(p[x])?true:false;}};return E.json2xml("tknstrm",t,S);},j=function(t){var p=t.items,S=p.length,q=p[p.length-1];if(q&&q.tp===-1){p.pop();}if(p[0]&&p[0].tp===38){p.splice(0,1);}},l=function(S){return"";},g=function(S,q){var p=[];S.oi.tks.items=p;q.clearTokens(p);},K=function(w,u){var t=[];t.push("<mt>");if(w.fmt&&!u){var S={getArrItemName:function(AA,x,z){return AA.substr(0,AA.length-1);},isSerializable:function(AF,AD,AC){if(mstrmojo.array.indexOf(["header_format","grid_format"],AF)>-1){var AG=AD[AC][AF];if(!AG){return{};}var AA="<"+AF+">",AE;for(AE in AG){AA+="<prs n='"+AE+"'>";var z=AG[AE],x;for(x in z){var AB=z[x];AA+="<pr n='"+x+"' v='"+(AB==="pru"?"":AB)+"'";AA+=AB==="pru"?' pru="1"':"";AA+="/>";}AA+="</prs>";}AA+="</"+AF+">";return{child:AA};}return true;},skipNull:true};t.push(E.json2xml("fmt",w.fmt,S));}if(w.prss&&!u){var q={getArrItemName:function(AA,x,z){return AA.substr(0,AA.length-1);},isSerializable:function(AF,AC,AA){if(mstrmojo.array.indexOf(["AnalyticalEngineProperties","DatamartProperties","VLDBSelect","VLDBFunction","VLDBReport"],AF)>-1){var AB=AC[AA][AF];if(!AB){return{};}var z=[],AD=[],AE;z.push("<prs n='"+AF+"' ");for(AE in AB){var x=AB[AE];if(x!=null){if(typeof x==="object"){AD.push(E.json2xml("pr",x,{skipNull:true,convertBoolean:true,isSerializable:function(AI,AH,AG){return true;}}));}else{z.push(AE+"='"+x+"' ");}}}z.push(">");z.push(AD.join(""));z.push("</prs>");return{child:z.join("")};}return true;},skipNull:true};t.push(E.json2xml("prss",w.prss,q));}if(w.mps){t.push(E.json2xml("mps",w.mps,{skipNull:true,convertBoolean:true,isSerializable:function(AA,z,x){return true;}}));}if(w.datp&&!u){t.push(E.json2xml("datp",w.datp,{skipNull:true,convertBoolean:true,isSerializable:function(AA,z,x){return true;}}));}if(w.sbs&&!u){var p={getArrItemName:function(AA,x,z){return(AA==="avs")?"sb":AA.substr(0,AA.length-1);},isSerializable:function(AA,z,x){return true;},skipNull:true};t.push(E.json2xml("sbs",w.sbs,p));}t.push("</mt>");return t.join("");},G=function(p,S){p.set("enabled",!S);var q="mstrmojo-InlineWaitIcon";if(p.iconClass){p.set("iconClass",p.iconClass.replace(new RegExp(q),"")+" "+(S?q:""));}else{mstrmojo.css.toggleClass(p.domNode,q,S);}},H=function(p,S){var q={taskId:"saveMetricDefinition",tokenStreamXML:N(p),localSymbolFolderXML:l(p),metricXML:K(p),metricId:p.did||"",outputFlags:327695,description:p.desc||"",name:p.n||"",saveAs:S};if(E.isEmpty(p.metricId)){q.isNew=true;}return q;},M=function(q){var p=function(t){var w=this.parent;var u=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##","Object").replace("'###'","");if(w){w.ob.refreshContent();w.onObjectSaved({name:w.name,did:t.did,desc:w.desc});u=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",w.typeDesc||"Object").replace("###",w.name);}mstrmojo.alert(u,q.onSaved,mstrmojo.desc(7984,"Object Saved"));if(w){w.close();}q.dirty=false;},S={success:p,failure:mstrmojo.SaveAsEditor.SAVEAS_CALLBACK.failure};return S;},L=function(z,u){var q=this;G(q,true);var AA=mstrmojo.ME._MetricEditorHelper.oi=z.oi,t=N(AA),w=l(AA),x=K(AA,true),AB=function(AC){if(AC&&AC.tks){var AD=AC.tks;j(AD);AA.tks=AD;z.checkEditorFallback(z.ide.candidates.items,AA);AD.vs=U(AD.rjec);z.set("vStatus",AD.vs);z.set("iStatus",AD.rjed||"");if(z.handleValidation){z.handleValidation(AD);}if(u&&(AD.vs===k.VALID)){switch(u){case"save":case"saveAs":if(z.isDME){z.handleDerivedMetricAction(u,AA);}else{z.handleMetricAction(u,AA);}break;case"switch":if(z.cbSwtichEditor){z.cbSwtichEditor(z);}break;}}else{if(u&&AD.vs===k.ERROR){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));}}}},p=function(AC){mstrmojo.alert(AC.message||AC.getResponseHeader("X-MSTR-TaskFailureMsg"));},S=function(AC){G(q,false);};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:t,localSymbolFolderXML:w,metricXML:x,metricId:AA.did,isNew:E.isEmpty(AA.did),msgID:z.ide.isDME?mstrApp.getMsgID():null},{success:AB,failure:p,complete:S});},D=function(p,t){var u=t,S=u.oi.fmt,q=P.MetricFormatTarget;G(p,true);window.setTimeout(function(){if(!S){S=u.oi.fmt={};var w;for(w=0;w<q.length;w++){S[q[w].p]={};}}var x=J.position(p.domNode,true);u.openPopup("formatPopupRef",{zIndex:u.zIndex+10,model:S,left:Math.max(0,(x.x-(u.formatPopupRef.width||565)))+"px",top:x.y+"px"});G(p,false);},50);},e=function(q,t){var u=t,S=u.oi,p=function(){var w=J.position(q.domNode,true);u.openPopup(mstrmojo.all.mstrMEOptionsDialog||"optionPopupRef",{zIndex:u.zIndex+10,model:S,funcs:u.funcs,left:Math.max(0,(w.x-(u.optionPopupRef.width||565)))+"px",top:w.y+"px"});};if(!u.isDME&&!u.funcs){G(q,true);mstrmojo.ME.MetricDataService.getSubtotalFunctions(null,{success:function(w){if(w.items){u.funcs=w.items;p();G(q,false);}},failure:function(w){mstrmojo.alert(w.message||w.getResponseHeader("X-MSTR-TaskFailureMsg"));G(q,false);}});}else{p();}};mstrmojo.ME._MetricEditorHelper=mstrmojo.provide("mstrmojo.ME._MetricEditorHelper",{noCache:true,useKeyDelay:true,tbBrowsable:true,functionNameRef:{scriptClass:"mstrmojo.Label",alias:"fnLabel",cssClass:"mstrmojo-ME-fct-name",bindings:{visible:function(){return !this.parent.insertMode;},text:function(){return mstrmojo.desc(5424,"Function:")+" "+this.parent.fctName;}}},nameEditBoxRef:{scriptClass:"mstrmojo.Box",alias:"nameEditBox",cssClass:"mstrmojo-ME-nameEditBox",cssDisplay:"inline-block",visible:false,bindings:{visible:function(){return !this.parent.insertMode&&this.parent.visible;}},onvisibleChange:function(S){if(S.value==false){return ;}var p=this;if(!p.tmr){p.tmr=window.setInterval(function(){if(p.domNode){window.clearInterval(p.tmr);delete p.tmr;p.nameInput.inputNode.select();}},50);}},children:[{alias:"nameInput",scriptClass:"mstrmojo.TextBoxWithLabel",inputNodeCssClass:"mstrmojo-ME-nameInput",value:mstrmojo.desc(2213,"New metric"),size:20,useRichTooltip:true,showErrTooltip:function o(){var p=J.position(this.domNode),S=E.isEmpty(this.value)?mstrmojo.desc(9122,"Name cannot be empty"):mstrmojo.desc(11569,"Input contains invalid character");this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+S+"</span></div>",top:p.y-5,left:p.x+p.w+10};this.hasOpenTooltip=false;this.showTooltip();},bindings:{value:function(){var S=this.parent.visible;return this.parent.parent.oi.alias||this.parent.parent.oi.n;},label:function(){var p=this.parent.parent.ide||{},S=p.nameLabel||mstrmojo.desc(11566,"Metric Name:");return this.parent.parent.oi.alias?mstrmojo.desc(13249,"Display Name:"):S;}},onvalueChange:function(q){var S=this.parent.parent.ide.action.alias,x=function(z){return !E.isEmpty(z)&&(S?true:!/[\[\]\"\\]/g.test(z));},w=x(this.value);if(w){this.hideTooltip();}else{this.showErrTooltip();}mstrmojo.css.toggleClass(this.parent.domNode,"err",!w);var t=this.parent.parent;t.set("cValid",w);var u=t.oi;if(u){var p={n:u.n,alias:u.alias};u.n=this.value;u.alias=this.value;if(u.n!==p.n&&u.alias!==p.alias){t.dirty=true;}}}}]},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:"Metric",browsableTypes:"4,8",onObjectSaved:function(t){var q=this.opener,S=q&&q.oi;if(q&&S){S.did=t.did;S.n=t.name;S.desc=t.desc;q.set("title",mstrmojo.desc(2154,"Metric:")+" "+t.name);}}},optionPopupRef:{id:"mstrMEOptionsDialog",scriptClass:"mstrmojo.ME.OptionDialog",title:mstrmojo.desc(9572,"Advanced Metric Options"),help:"Advanced_Metric_Options_dialog_box.htm",height:340},formatPopupRef:{scriptClass:"mstrmojo.ME.MetricFormatEditor",contentNodeCssClass:"mstrmojo-balloon",alias:"formatEditor",title:mstrmojo.desc(2116,"Format"),left:"100px",top:"100px",useAnimate:false,height:360,width:565,help:"Format_Metric_dialog_box.htm",locksHover:true},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px;",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},switchRef:{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"switchToMetricEdtior",cssClass:"mstrmojo-ME-switch mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(9563,"Switch to Formula Editor"),closeAfterSwitch:true,bindings:{visible:function(){return !this.parent.insertMode;}},getEditor:function(){return this.parent;},getFormulaEditorId:function(){var S=this.getEditor();return(S.ide&&S.ide.formulaEditorId)||"mstrME";},onclick:function(){var q=this.getEditor(),p=this.getFormulaEditorId();q.oi.tks.items=q.getMetricDefAsTokens();var S={vStatus:mstrmojo.ME.MetricEditBox.VALIDATION_STATUS.UNKNOWN,oi:q.oi,did:q.oi.did};if(q.dirty){S.dirty=q.dirty;}q.switch2Editor(p,S);if(q.ide){q.ide.set("showLeftPanel",true);q.set("simple",false);}}},formatAndOptionsBarRef:{scriptClass:"mstrmojo.HBox",alias:"formatbar",cssClass:"mstrmojo-ME-formatbar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link format",alias:"formatButton",text:mstrmojo.desc(1918,"Format"),bindings:{visible:function(){return this.parent.parent.tbFormatable&&!this.parent.parent.insertMode;}},onclick:function(){D(this,this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link property",alias:"optButton",text:mstrmojo.desc(13035,"Metric Options"),bindings:{visible:function(){var S=this.parent.parent;return !S.insertMode&&!S.ide.disableAFB;}},onclick:function(){e(this,this.parent.parent);}}]},saveLabel:mstrmojo.desc(5891,"Save"),saveAsLabel:mstrmojo.desc(628,"Save As"),closeLabel:mstrmojo.desc(221,"Cancel"),saveAsEnabled:true,cValid:true,buttonBarRef:{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:"",bindings:{enabled:function(){return this.parent.parent.cValid;},text:function(){return this.parent.parent.insertMode?mstrmojo.desc(531,"Add"):this.parent.parent.saveLabel;}},onclick:function(){var p=this.parent.parent;if(!p.insertMode&&p.isDirty&&!p.isDirty()){p.close();p.onCancel();return ;}if(!p.cValid){return ;}if(p.insertMode){p.insertOnFinish(p.getMetricDefAsTokens());p.close();}else{if(p.getMetricDefAsTokens){p.oi.tks.items=p.getMetricDefAsTokens();}var S=this;if(p.validateAndSave){G(S,true);p.validateAndSave(p.oi,function(){G(S,false);});}else{if(p.ide&&p.ide.validateAndSave){G(S,true);p.ide.validateAndSave(p.oi,function(){G(S,false);});}else{p.tbValidate=this;L.call(this,p,"save");}}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",alias:"btnSaveAs",text:mstrmojo.desc(628,"Save As"),bindings:{visible:function(){return !this.parent.parent.insertMode&&!this.parent.parent.isDME;},text:function(){return this.parent.parent.saveAsLabel;}},onclick:function(){var S=this.parent.parent;if(S.getMetricDefAsTokens){S.oi.tks.items=S.getMetricDefAsTokens();}S.tbValidate=this;L.call(this,this.parent.parent,"saveAs");}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.parent.closeLabel;}},onclick:function(){var S=this.parent.parent;if(S.onPreClose()){S.close();if(!S.insertMode){S.onCancel();}}}}]},validateSyntax:function B(S){L.call(S,this);},validateSyntaxAndSwitch:function Y(S){L.call(S,this,"switch");},preprocessTokenStram:function Q(S){j(S);},isDirty:function f(){if(this.insertMode){return false;}return this.dirty||this.oi.dirty||(this.oi.fmt||{}).dirty||(this.oi.mps||{}).dirty;},onmetricModify:function d(){this.dirty=true;},save:function O(){this.buttonBar.btnSaveAs.onclick();},prompt2saveRef:{scriptClass:"mstrmojo.Editor",cssText:"width:350px;",title:mstrmojo.desc(5728,"Confirm save"),children:[{scriptClass:"mstrmojo.Label",cssText:"margin:5px 5px 20px;",allowHTML:true,bindings:{text:function(){return mstrmojo.desc(9573,"Do you want to save changes made to #?").replace("#","<b>"+this.parent.opener.oi.n+"</b>");}}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"left",cssText:"width:10px;"},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(219,"Yes"),onclick:function(){var S=this.parent.parent;S.opener.save();S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(218,"No"),onclick:function(){var S=this.parent.parent;S.opener.close();if(S.opener.onCancel){S.opener.onCancel();}S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var S=this.parent.parent;S.close();}}]}]},prompt2save:function(){if(this.getMetricDefAsTokens){this.oi.tks.items=this.getMetricDefAsTokens();}this.openPopup("prompt2saveRef",{zIndex:this.zIndex+1});},handleMetricAction:function b(q,p){var S=this;var t=H(p,false);if((q==="save")&&p.did){mstrmojo.xhr.request("POST",mstrConfig.taskURL,M(S),t);}else{if(((q==="save")&&E.isEmpty(p.did))||q==="saveAs"){t.saveAs=true;S.openPopup("saveasRef",{zIndex:S.zIndex+10,folderLinksContextId:17,name:p.n||p.name||(S.name&&S.name.value)||mstrmojo.desc(2213,"New Metric"),saveParams:t,saveAsCallback:function(){var u=M(S);if(u.success){var w=u.success;u.success=function(x){w.call(this,x);if(S.ide.noRefresh!==true){var z=mstrApp;mstrmojo.form.send({evt:5005,src:z.name+"."+z.pageName+".5005"});}};}return u;}});}}},handleDerivedMetricAction:function c(u,t){t=t||this.oi;if(u==="save"){var S={tokenStreamXML:N(t),alias:t.n};var p=t.mps||{};if(p.dirty){if(p.fbf===0){p.afb=p.sfb=-1;}S.afb=p.afb;S.sfb=p.sfb;}var w=mstrmojo.all.mstrMetricIDE,q=w.disableAFB;if(q){S.afb=0;S.sfb=1;}w.onApplyMetricCallback(S);w.close();}},onPreClose:function(){var S=this;if(S.isDirty&&S.isDirty()&&!this.isDME){S.prompt2save();return false;}return true;},onClose:function W(){this.dirty=false;if(this.onPostClose){this.onPostClose();}},init:function m(q){if(this._super){this._super(q);}var t=mstrApp,S=t&&t.useQuickSearch&&t.useQuickSearch(),p=S?((t&&t.searchAutoCompleteDelay&&t.searchAutoCompleteDelay())||0):0;this.suggestDelay=p||200;this.noCache=this.noCache&&S&&!this.isDME;this.ob.children[0].quickSearch=S;mstrmojo.ME.MetricDataService.suggestDelay=this.suggestDelay;mstrmojo.ME.MetricDataService.noCache=this.noCache;},_setupCandidatesCache:function h(S){if(this.candidates&&S){S.candidates=null;S.set("candidates",this.candidates);}},item2textCss:function I(S){return"mstrmojo-ME-icon t"+S.t+(S.st?" st"+S.st:(S.um||S.da?"d":""));},getSpecialFunctionEditorId:function a(S,t){var q=S&&S.did,p;if(q){if(mstrmojo.ME.MetricDataService.isBasicAggMap(q)){p="mstrSME";}else{if(mstrmojo.ME.MetricDataService.isRank(q)){p="mstrRFE";}else{if(A.isOLAPAgg(q)){p="mstrOFE";}else{p="mstrFE";}}}if(p){p+=t?"_1":"";}}return p;},isDimty:function(p,S){return(/^@[a-z]{1,}(\s*[+-]\s*\d{1,})?$/i).test(F.trim(p));},validateByDataType:function Z(p,S){var q=false;switch(p){case n.DataTypeInteger:q=/^(-)?\d+$/.test(S);break;case n.DataTypeNumeric:case n.DataTypeReal:case n.DataTypeDouble:q=mstrmojo.num.isNumeric(S);break;case n.DataTypeChar:case n.DataTypeVarChar:q=true;break;case n.DataTypeDate:case n.DataTypeTimeStamp:q=true;break;default:q=true;}return q;},getRootFunction:function X(q){var p,S=q&&q.tks&&q.tks.met;if(S!==C.ADVANCED){var t=q.tks.items[0];p=t&&t.oi;}return p;},checkEditorFallback:function V(S,t){var p=this.getRootFunction(t),q=mstrmojo.array.find(S,"did",p&&p.did)===-1;if(q&&t&&t.tks&&t.tks.items&&t.tks.items.length>0){t.tks.met=C.ADVANCED;}return q;}});mstrmojo.ME._MetricEditorHelper.getTokenStreamXML=N;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.ME.MetricEditBox","mstrmojo.warehouse._CanToggleAvatarClass");var T=mstrmojo.array,I=mstrmojo.string,W=mstrmojo.css,U=mstrmojo.dom,Q="visible",Y=["(",")","{","}","-","+","*","/","<",">","=","|","~",","," ","\t","\n",";"],X=null,A=mstrmojo.warehouse.EnumObjectTypes,L=A.TABLE,O=A.COLUMN;function M(a){var Z;if(!X){X={};for(Z=0;Z<Y.length;Z++){X[Y[Z]]=true;}}return X[a];}mstrmojo.architect.ui.SQLInputBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,[mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.SQLInputBox",cssClass:"mstrmojo-ar-sqlInput-inputbox",dropZone:true,allowDrop:function B(a){var b=[].concat(a.src.data)[0],Z=mstrApp.rootController.model;if(!b){return false;}if(!((b.tp===O)||(b.tp===L))){return false;}return(Z.SelDBRoleID===Z.projPrimaryDBRoleID);},ondrop:function S(b){var d=this,c=[].concat(b.src.data)[0],a=this.inputBox.items,f=function f(g){a=[{v:"select"}];a.push({v:String.fromCharCode(10)});T.forEach(g,function(h){a.push({v:h.cln});a.push({v:", "});});a.pop();a.push({v:String.fromCharCode(10)});a.push({v:"from"});a.push({v:String.fromCharCode(10)});a.push({v:c.n});d.inputBox.set("items",a);d.parent.execSQL.onclick({cancel:mstrmojo.emptyFn});d.inputBox.focus();};if(!c){return ;}this.inputBox.set("items",[]);switch(c.tp){case O:a.push({v:c.cln});this.inputBox.set("items",a);break;case L:var Z=(b.src.widget.alias==="dbTableTree");if(Z){mstrApp.rootController.getColumnsForDBTable({data:c},{success:function e(g){f(g.items);}});}else{mstrApp.rootController.model.getAttributesFactsInTable(c.did,{success:function e(){f(mstrApp.rootController.model.getTable(c.did).columns);}});}break;}},postBuildRendering:function R(){if(this._super){this._super();}this.onheightChange({value:this.height});this.onwidthChange({value:this.width});this.reset();},onheightChange:function G(a){var b=this.inputBox,Z=a.value;if(b.hasRendered&&Z!==undefined){b.height=Z;b.domNode.style.height=Z;b.editNode.style.height=Z;}},onwidthChange:function J(Z){var b=this.inputBox,a=Z.value;if(b.hasRendered&&a!==undefined){b.width=a;b.editNode.style.width=a;}},tables:[],columns:[],sqlFunctions:[{n:"Select"},{n:"Update"},{n:"Insert"},{n:"Delete"},{n:"Create"},{n:"Drop"},{n:"Alter"},{n:"Set"},{n:"Exec"},{n:"From"},{n:"Where"},{n:"Having"},{n:"In"},{n:"Group"},{n:"By"},{n:"Order"},{n:"Into"},{n:"On"},{n:"Values"},{n:"Table"},{n:"Case"},{n:"Then"},{n:"Else"},{n:"Join"},{n:"As"}],getSQLStatement:function E(){var Z=[];T.forEach(this.inputBox.items,function(a){Z.push(a.v);});return I.trim(Z.join("").replace(/<\s/g,"<").replace(/>\s/g,">"));},setSQLStatement:function H(f){var c=[],b,d="\n",Z=", ",e=f.split(d),a;T.forEach(e,function(g){b=I.trim(g);if(b.indexOf(Z)>0){a=b.split(Z);T.forEach(a,function(h){c.push({v:I.trim(h)});c.push({v:Z});});c.pop();}else{c.push({v:b});}c.push({v:d});});this.inputBox.set("items",c);},onvisibleChange:function N(){W.toggleClass(this.domNode,Q,this.visible);W.toggleClass(this.inputBox.domNode,Q,this.visible);},reset:function V(){var Z={items:this.sqlFunctions.concat(this.tables).concat(this.columns),isComplete:true};this.inputBox.set("candidates",Z);this.inputBox.set("items",[]);},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",cssClass:"mstrmojo-ar-sqlInput-tokenbox",alias:"inputBox",slot:"editNode",browseItemVisible:false,renderBlockSize:1000,lastPagePos:{left:0,top:0,width:0,height:0},lastScrollPos:{left:0,top:0,width:0,height:0},breakOnEnterKeyDown:function P(){return !this.suggestionShown;},getCharacter:function C(a){var Z=(U.isIE&&!U.isIE9)?a.keyCode:a.charCode;return(Z>0)?((Z===13)?"\n":String.fromCharCode(Z)):null;},ondrop:function(Z){this.parent.ondrop(Z);},ondragenter:function K(Z){this.parent.ondragenter(Z);},allowDrop:function B(Z){return this.parent.allowDrop(Z);},item2textCss:function F(Z){return{15:" mstrmojo-ArchitectListIconSuggest t15 ",26:" mstrmojo-ArchitectListIconSuggest t26 "}[Z.tp||Z.t]||"";},itemFunction:function D(a){return new mstrmojo.ME.MetricToken({data:a,brackets:function(b){return b;},isDelimiter:function Z(){var b=this.data,c=b.v.length;if(b){return b.isDelimiter||(c===1&&M(b.v));}return false;}});},isDelimiter:M}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ObjectInputBox","mstrmojo.ACL.UserDataService");mstrmojo.ACL.UserInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{suggestionPopupCssClss:"mstrmojo-ACLInputBox-suggest",getACLUserDataService:function C(){return mstrmojo.ACL.UserDataService;},item2textCss:function A(D){return(this._super&&this._super(D))||"mstrmojo-ACLInputBox-user "+{8704:"u",8705:"ug"}[D.st]||"";},getCandidatesThroughTaskCall:function B(E,D){this.getACLUserDataService().searchUserCandidates(E.pattern,!E.isVerify,E.blockCount,D);}});})();(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.ObjectInputBox","mstrmojo.DataGrid","mstrmojo.Editor");mstrmojo.requiresDescs(221,629,945,1442,1825,3095,4114,4115,4563,5298,8246,9125,12173,12916,12918,12947);var F=mstrmojo.hash,D=mstrmojo.expr,A=mstrmojo.ME.MetricToken.brackets,G=function(M){var J=null;if(M.isParam){J={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",alias:"paramInput",slot:"0,0",itemValidationField:"_did_",item2textCss:function E(N){return" mstrmojo-qb-SuggestIcon t"+N.t;},hideEditButton:function(){return false;},browseItemVisible:false,dynamicVerify:false,emptyText:mstrmojo.desc(9125,"Type here to input columns..."),postCreate:function(O){var N=this.parent.dataGrid,P=N&&N.parent;this.candidates=P.getCandidates(function(Q){return Q.t===26;});if(!O){N.candidatesListener.push(this);}this.autoSelect=false;this.openPopup("suggestionPopup");this.suggestionPopup.close();this.autoSelect=true;}}],onParamAdded:function(P){var O=this.dataGrid.parent,N=this.paramInput;O.closePopup();P.state=0;N.add([P],N.items.length-1);},getTokens:function(){var Q=this.paramInput.getSelectedObjects(),N=Q.length,P,R=[],O;if(N>0){for(P=0;P<N;P++){if(Q[P].state===mstrmojo.Enum_OIB_States.VALID){O={v:A(Q[P].n)};O.oi=Q[P];}else{O={v:Q[P].n};}R.push(O);R.push({v:",",isDelimiter:true});}R.pop();}return R;}};var K=J.children[0];if(!M.isRepeated){K.cssClass="mstrmojo-ObjectInputBox singleObject noVerify";K.maxObjectCount=1;}else{K.cssClass="mstrmojo-ObjectInputBox noVerify";}}else{switch(M&&M.dtp){case 11:J={scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-functionArgs-pulldown mstrmojo-Pulldown",items:[{n:mstrmojo.desc(4115,"False"),did:"0"},{n:mstrmojo.desc(4114,"True"),did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(N){this.value=this.data.dfv||0;},getTokens:function(){var N=this.data;if(this.value!==N.dfv){return[{v:N.n},{v:"=",isDelimiter:true},{v:String(this.value)==="-1"?"True":"False"}];}return[];}};break;case -2:J={scriptClass:"mstrmojo.Table",cssClass:"breakBy",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",slot:"0,0",alias:"breakByInput",item2textCss:function E(N){return(this._super&&this._super(N))||{12:"a","-99":"br"}[N.t]||"";},emptyText:mstrmojo.desc(12916,"Type here to input breakby attributes..."),noEditButton:true,browseItemVisible:true,folderLinksContextId:16,browsableTypes:[D.TP.FOLDER,D.TP.ATTR].join(","),getCandidatesThroughTaskCall:function L(O,N){mstrmojo.ME.MetricDataService.getAttributes(O,N);},postCreate:function(O){var N=this.parent.dataGrid,P=N&&N.parent;this.candidates=P.getCandidates(function(Q){return Q.t===12;});if(!O){N.candidatesListener.push(this);}}},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var O=this.parent.parent.dataGrid.parent;O.openPopup("ob",{zIndex:O.zIndex+10});var N=O.ob.browser;N.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onBreakByAdded"],browsableTypes:[D.TP.ATTR,D.TP.FOLDER].join(",")});}}]}],onBreakByAdded:function(P){var O=this.dataGrid.parent,N=this.breakByInput;O.closePopup();N.add([P],N.items.length-1);},getTokens:function(){var P=this.breakByInput.getSelectedObjects(),N=P.length,O,Q=[];if(N>0){Q.push({v:"BreakBy"});Q.push({v:"=",isDelimiter:true});Q.push({v:"{",isDelimiter:true});for(O=0;O<N;O++){Q.push({v:A(P[O].n),oi:P[O]});if(O!==(N-1)){Q.push({v:",",isDelimiter:true});}}Q.push({v:"}",isDelimiter:true});}return Q;}};break;case -1:J={scriptClass:"mstrmojo.Table",cssClass:"sortBy",layout:[{cells:[{cssText:"width: 330px"},{}]}],getTokens:function(){var Q=this.sortByGrid.items,N=Q.length,P,T=[];if(N>0){T.push({v:"SortBy"});T.push({v:"=",isDelimiter:true});T.push({v:"(",isDelimiter:true});for(P=0;P<N;P++){var R=Q[P],S=R.selFrm||(R.dssforms&&R.dssforms[0]),O={v:A(R.n),oi:R};if(S&&parseInt(R.t,10)===12){F.copy({v:A(R.n)+"@"+A(S.n),exv:S.dssid,extp:S.dtp},O);}T.push(O);if(P!==(N-1)){T.push({v:",",isDelimiter:true});}}T.push({v:")",isDelimiter:true});}return T;},children:[{scriptClass:"mstrmojo.DataGrid",slot:"0,0",cssClass:"mstrmojo-functionArgs-sort",alias:"sortByGrid",renderOnScroll:false,resizableColumns:true,makeObservable:true,itemDisplayField:"n",columns:[{headerText:mstrmojo.desc(945,"Name"),dataField:"n",colCss:"nmCol"},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(3095,"Order"),dataField:"order",colCss:"ordCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.asc=this.value;}}},{dataWidget:{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(N){this.dataGrid.remove(this.data);}},headerText:"&nbsp",colCss:"actionsCol"}]},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var O=this.parent.parent.dataGrid.parent;O.openPopup("ob",{zIndex:O.zIndex+10});var N=O.ob.browser;N.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onSortByAdded"],browsableTypes:[D.TP.ATTR,D.TP.METRIC,D.TP.FOLDER].join(",")});}}]}],onSortByAdded:function(Q){var O=this.dataGrid.parent,P=this.sortByGrid;O.closePopup();if(Q){switch(Q.t){case 12:var R=function(S){if(S){var T=S.container;if(T&&T.dssforms){Q.dssforms=T.dssforms;P.add([Q]);}}},N=function(S){mstrmojo.alert(S.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:Q.did,displayedForms:0},{success:R,failure:N});break;case 4:Q.dssforms=[{n:"Value"}];default:P.add([Q]);}}}};break;default:J={scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(N){var O=this.data;this.value=(O.dfv||O.dfv===0)?O.dfv:"";},getTokens:function(){var N=this.data;if(this.value!==N.dfv){return[{v:N.n},{v:"=",isDelimiter:true},{v:this.value}];}return[];}};break;}}J.alias="inputWidget";return J;},I=function(K,E,J){return'<div class="mstrmojo-DataRow-text"title="'+(K.desc||"")+'">'+K.n+(K.isParam?"*":"")+":</div>";};mstrmojo.qb.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FunctionWizard",init:function H(E){this._super(E);this.help=this.help||(mstrApp&&mstrApp.helpTopics&&mstrApp.helpTopics.fnWiz);},cssClass:"mstrmojo-FunctionWidzard",title:mstrmojo.desc(4563,"Function Arguments"),help:"",fctOi:null,fctArgs:null,fctSyntax:"",bindings:{candidates:"this.opener.candidates"},getCandidates:function B(K){var J=this.candidates,E;if(J){E=mstrmojo.array.filter(J.items,K);return{items:E,isComplete:J.isComplete};}return null;},_set_candidates:function(N,J){this.candidates=J;if(this.hasRendered&&this.visible){var L=this.argsGrid,M=L.candidatesListener,E=M.length,K;for(K=0;K<E;K++){M.postCreate(true);}}return true;},onOpen:function(){var J=this,L,K=function(P){if(P){J.set("fctOi",P);var R=[],O,M,Q,N=[];N.push(P.n);N.push("(");M=(P.pars&&P.pars.length)||0;for(O=0;O<M;O++){Q=F.copy(P.pars[O]);Q.isParam=true;R.push(Q);N.push(P.pars[O].n);if(O!==(M-1)){N.push(", ");}}N.push(")");if(P.rpc>0){Q.isRepeated=true;}M=(P.pros&&P.pros.length)||0;if(P.did==="6F7DF5FF449111D5BEA300B0D01A55EF"){M=0;}for(O=0;O<M;O++){if(P.pros[O].n!=="UseLookupForAttributes"){R.push(F.copy(P.pros[O]));}}if(P.sqt===5){R.push({n:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:mstrmojo.desc(12918,"Break By is a parameter representing the break by levels for this function.")});}J.set("fctArgs",R);J.set("fctSyntax",N.join(""));}mstrmojo.css.removeClass(J.argsGrid.domNode,["loading"]);},E=function(M){mstrmojo.alert(M.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));mstrmojo.css.removeClass(this.argsGrid.domNode,["loading"]);};this.argsGrid.set("items",[]);mstrmojo.css.addClass(this.argsGrid.domNode,["loading"]);this.set("fctSyntax","");this.set("title",mstrmojo.desc(12947,"Function arguments for:")+this.fctOi.n);L={functionId:this.fctOi.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};mstrApp.getRootController().getDataService().getFunctionDetails({success:K,failure:E},L);},getTokens:function C(){var L=this.argsGrid.ctxtBuilder.itemWidgets,O=L.length,N,S,P=[],K=[],T=[],Q,M,J,E,R=this.fctOi;for(N=0;N<O;N++){S=L[N].inputWidget;if(S.data.isParam){K.push(S.getTokens());}else{P.push(S.getTokens());}}T.push({v:R.n,oi:R});O=P.length;if(O>0){E=false;T.push({v:"<",isDelimiter:true});for(N=0;N<O;N++){Q=P[N];J=Q.length;if(J===0){continue;}E=true;for(M=0;M<J;M++){T.push(Q[M]);}T.push({v:",",isDelimiter:true});}T.pop();if(E){T.push({v:">",isDelimiter:true});}}O=K.length;T.push({v:"(",isDelimiter:true});E=false;for(N=0;N<O;N++){Q=K[N];J=Q.length;if(J===0){continue;}E=true;for(M=0;M<J;M++){T.push(Q[M]);}T.push({v:",",isDelimiter:true});}if(E){T.pop();}T.push({v:")",isDelimiter:true});return T;},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},children:[{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:"functionArgs",banding:false,columns:[{headerText:"Property Name",dataFunction:I,colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:G,colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-syntaxLabel",text:"",bindings:{text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-descLabel",text:"",bindings:{text:function(){return this.parent.fctOi.desc;}}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-FW-buttonBox",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;if(E.insertOnFinish){E.insertOnFinish(E.getTokens());}E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.WidgetList","mstrmojo.qb.FilterTree","mstrmojo.CustomGroupEl","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ConditionNode","mstrmojo._IsPopup");mstrmojo.requiresDescs(1994,2550,3415,3416,5893,7953,12367,12368);var D=mstrmojo.hash,G=mstrmojo.array,M=mstrmojo.expr,H=M.BRANCH_FNS,N=mstrmojo.dom,E=mstrmojo.desc;function B(O){if(!O){return undefined;}var P=O.nds;if(!P){return O;}G.forEach(P,function(R,Q){P[Q]=B(R);});O.nds=P.slice(0);return O;}function I(O,Q,P){G.forEach(O,function(S,R){if(S.nds){I(S.nds,Q,P);}else{if(S===Q){O[R]=P;}}});}function L(P,O){var Q=P.data;mstrApp.getRootController().openExpressionEditor({n:O?mstrmojo.desc(5893,"New Condition"):mstrmojo.desc(7953,"Condition Editor"),tkn:O?[]:Q.expr,callbacks:{success:function R(T){var V={0:"filterExpr",1:"aggfilterExpr"},S=T.mi,U=S.exp.sqltp;var W={et:"*",expr:S.items,n:T.expr,sqltp:U};if(O){P[V[U]].newCondition(W);}else{if(Q.sqltp===U){I(P.tree.items,P.data,W);P.data=W;P.paint();}else{P.del();P.tree.parent[V[U]].newCondition(W);}}}}});}function F(O){var P=O&&O.items;if(P){O.remove(P);}}mstrmojo.qb.ConditionEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._HasPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.qb.ConditionEditor",cssClass:"mstrmojo-qb-filterEditor",title:mstrmojo.desc(2550,"Filters"),ondataChange:function C(){var O=this.CEl,Q=this.data,P=Q.having,R=D.clone(Q.where);O.filterExpr.set("items",[]);O.filterExpr.add(R?[R]:[],0);O.aggfilterExpr.set("items",[]);O.aggfilterExpr.add(P?[P]:[],0);},children:[{scriptClass:"mstrmojo.CustomGroupEl",cssClass:"mstrmojo-qb-filterTreeBox",alias:"CEl",markupString:'<div id="{@id}" class="mstrmojo-onhoverparent mstrmojo-CustomGroupEl {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-cond-details" {@cssClass}"><div class="mstrmojo-qb-expr-tools {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"><br></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div></div></div>',markupMethods:{onstateChange:function(){this.detailsNode.style.display=this.state?"block":"none";}},markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},detailsNode:function(){return this.domNode.lastChild;},exprNode:function(){return this.domNode.lastChild.children[2];},expr2Node:function(){return this.domNode.lastChild.children[4];},exprToolsNode:function(){return this.domNode.lastChild.firstChild;}},parent:this.parent,children:[{scriptClass:"mstrmojo.qb.FilterTree",slot:"exprNode",alias:"filterExpr",onexprclick:function A(O){L(O,false);}},{scriptClass:"mstrmojo.qb.FilterTree",slot:"expr2Node",alias:"aggfilterExpr",onexprclick:function A(O){L(O,false);}},{scriptClass:"mstrmojo.Box",slot:"exprToolsNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-CGE-addCondition",text:mstrmojo.desc(1994,"Add Condition"),onclick:function(){L(this.parent.parent,true);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5186,"Delete All"),cssClass:"mstrmojo-qb-deleteAll",onclick:function(){var O=this.parent.parent;F(O.filterExpr);F(O.aggfilterExpr);}}]}],state:true}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function K(){var P=this.parent.parent,O=P.CEl;mstrApp.getRootController().updateFilters(B(O.filterExpr.items[0]),B(O.aggfilterExpr.items[0]));P.set("visible",false);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(3416,"Cancel"),onclick:function K(){var Q=this.parent.parent,P=Q.CEl,R=Q.data,T=1000;if(D.equals(B(P.filterExpr.items[0]),R.where)&&D.equals(B(P.aggfilterExpr.items[0]),R.having)){Q.set("visible",false);return ;}var O=mstrmojo.Button.newInteractiveButton;mstrmojo.confirm(E(12367,"All your changes on the filter will be lost. Do you want to exit?"),null,{buttons:[O(mstrmojo.desc(1442,"OK"),function S(){Q.set("visible",false);},null,{onRender:function(){if(mstrApp.isCloudPro){mstrmojo.css.addClass(this.domNode,"cloud");}else{mstrmojo.css.addClass(this.domNode,["mstrmojo-di-button","mstrmojo-WebButton","hot"]);}}}),O(mstrmojo.desc(3416,"Cancel"),mstrmojo.emptyFn,null,{onRender:function(){if(mstrApp.isCloudPro){mstrmojo.css.addClass(this.domNode,"cloud cancel");}else{mstrmojo.css.addClass(this.domNode,["mstrmojo-di-button","mstrmojo-WebButton"]);}}})],title:E(12368,"Lose Your Changes?"),zIndex:T});}}],getMovingHandle:function J(){return this.children[0].domNode;},andOrPopupRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-CGE-andOrPopup mstrmojo-ConditionWalk",cssText:"width: auto;",contentNodeCssClass:"mstrmojo-balloon",left:"250px",top:"15px",slot:"containerNode",autoClose:true,showTitle:false,draggable:false,openEffect:null,closeEffect:null,onOpen:function(){var O=this.condition,R=O&&O.data&&O.data.not,T=O&&O.parent,P=T&&T.data,Q=(P&&P.fn)+(R?21:0),S=this.list;S.opening=true;S.set("selectedItem",isNaN(Q)?null:{did:Q});S.opening=false;this.curtainNode.style.position="fixed";},children:[{scriptClass:"mstrmojo.Dial",cssClass:"mstrmojo-CGE-andOrDial",alias:"list",itemMarkup:'<div class="dial-item {@css}">{@n}</div>',itemIdField:"did",items:[{did:19,n:H[19]},{did:20,n:H[20]},{did:19+21,n:H["19_21"]},{did:20+21,n:H["20_21"]}],onchange:function(){if(this.opening){return ;}var P=this.parent,O=P.condition,U=this.selectedItem,T=U&&U.did,S=T>21?true:null,R=T-(S?21:0);P.close();var Q=O&&O.parent;if(Q&&Q.data&&Q.data.et===M.ET.ANDOR){Q.edit(O,R,S);}else{var V=O&&O.data;if(V&&(V.not!==S)){V.not=S;O.paint();}}}}]},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onTab:function(P){if(this.onEnter){this.onEnter();}var O=N.shiftKey(P.hWin,P.e)?this.prevTab:this.nextTab;if(O&&O.onclick){O.onclick();}},onblur:function(){if(this.onEnter){this.onEnter();}},onEsc:function(){if(this.onCancel){this.onCancel();}this.parent.close({cancel:true});}}],onOpen:function(){var P=this.txt,O=this.txtConfig;D.forEach(O,function(Q){P.set(Q,O[Q]);});P.focus();},onClose:function(O){if(!O||(!O.cancel&&!O.enter)){this.txt.onEnter();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.fe.FilterExprTree","mstrmojo.fe.AndOrNode","mstrmojo.fe.RelationNode","mstrmojo.fe.DynamicNode","mstrmojo.fe.ConditionNode");var K=mstrmojo.expr.ET;mstrmojo.fe.RelationFilterExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.RelationFilterExprTree",nodeClassMap:{14:mstrmojo.fe.AndOrNode,15:mstrmojo.fe.RelationNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},getItemIdentityProp:function(L){if(L.ph){return"ph";}if((L.et===10||L.et===12)&&L.dmt===4){return K.RLS;}return L.et;},isEditable:function J(M){var L=false;switch(M&&M.et){case K.RLS:L=true;break;}return L||this._super(M);},getItemConfig:function(O,L,P){var M=this._super(O,L,P),N=(O.et===K.RLS||!!O.relation);if(N){M.itemFunction=P.itemFunction;}return M;},newCondition:function E(M){var L=this.getSelectedItemWidget();if(M&&M.ph&&!M.ph.idx&&microstrategy.bones.rwb_viewer){M.ph.idx=microstrategy.bones.rwb_viewer.nextPhIndex++;}if(L&&L.selected&&L.newCondition){return L.newCondition(M);}else{return this._super(M);}},createSet:function D(M,L){var N=L.rq,O=L.cq;if(N&&O){this.remove(O);if(L.isMetric){mstrmojo.hash.copyProps(["applySubExpr","dmy","dmt","relation","useSchema"],N,O);N=O;}else{N.nds=[O];}this.add([N],M[0]);}},removeSet:function G(L){var M=L.data,N=[M];this.remove(M);if(M.nds&&M.nds.length>0){N=M.nds;}else{delete M.dmy;delete M.relation;delete M.applySubExpr;delete M.relation;delete M.useSchema;delete M.dmt;}this.add(N,0);},nameFactory:{counter:1,names:{},clear:function(){this.resetCounter();this.names={};},resetCounter:function C(){this.counter=1;},isNameExist:function I(L){return !!this.names[L];},setName:function H(L,M){this.names[L]=M;},changeName:function B(M,L,N){this.removeName(M);this.setName(L,N);},getNewName:function F(O,N,Q){var P=N||"",M=Q||"",L;while(this.isNameExist(P+this.counter+M)){this.counter++;}L=P+this.counter+++M;this.names[L]=O;return L;},removeName:function A(L){delete this.names[L];this.resetCounter();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.HBox","mstrmojo.Box","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.qb.AttributeMapping","mstrmojo.qb.TimeDimension","mstrmojo.qb.GeoRole");mstrmojo.requiresDescs(218,219,517,518,629,1088,1388,2052,2170,3434,3544,4530,4699,8984,9133,9134,9912,9918,9919,9920,9921,9922,11170,11171,11621,12927,13036);var B=mstrmojo.css,Q=mstrmojo.dom,M=mstrmojo.string;var N=mstrmojo.desc(11170,"This column contains geographical locations. Additional columns will be created automatically so that you can view your data on Google Maps. See menu options for details."),E=mstrmojo.desc(11171,"This column contains date values. Additional columns will be created automatically. See menu options for details.");var I=function(S,U,W){var V={},X=S,T,R;for(T=0,R=U.length;T<R;T++){(U[T].tp==W)&&(V[U[T].alias]=1);}T=0;while(V[X]){X=S+" ("+(++T)+")";}return X;};function O(U,R,S){var V="mstrmojo-di-timedimension";var T=mstrmojo.all[V];if(!T){T=new mstrmojo.qb.TimeDimension({height:R,mode:U,der:S});}else{T.set("height",R);T.set("mode",U);T.set("der",S);}return T;}function P(V,R,T,S){var W="mstrmojo-di-georole";var U=mstrmojo.all[W];if(!U){U=new mstrmojo.qb.GeoRole({height:"200px",georole:V,der:R,shapeKey:T,shapeKeys:S});}else{U.set("georole",V);U.set("der",R);U.set("shapeKey",T);}return U;}var H=[{did:"QBAttribute",n:mstrmojo.desc(518,"Attribute"),items:[{did:"QBTimeGeo"}]},{did:"QBMetric",n:mstrmojo.desc(517,"Metric")},{did:"QBNone",n:mstrmojo.desc(13036,"Do Not Import")},{did:-1,n:"-"},{did:"QBRename",n:mstrmojo.desc(1388,"Rename")},{did:"QBMap",n:mstrmojo.desc(9133,"Map to project ...")},{did:"QBUnMap",n:mstrmojo.desc(9134,"Unmap from project")},{did:-1,n:"-"},{did:"QBEdit",n:mstrmojo.desc(1088,"Edit")},{did:"QBRemove",n:mstrmojo.desc(629,"Delete")}];function K(S,T,U){var R,V={1:1|2|4|8|16|32|64|128|256|512|1024|2048|4096,8:1|2|4|8|16|32|64|128|256|512,9:1024|2048|4096};R=V[U];R=R?R:(268435456|536870912|1073741824);S.der=S.der&R;T.der=S.der;}var L={scriptClass:"mstrmojo.MenuButton",cssClass:"mstrmojo-di-datapreview-cxtmenu",cmCssClass:"mstrmojo-di-datapreview-popmenu",id:"mstrmojo-di-datapreview-cm",postCreate:function(){if(!mstrApp.isCloudPro){H=H.concat([{did:-1,n:"-"},{did:"QBDataType",n:mstrmojo.desc(9918,"Data Type"),items:[{did:"2",n:mstrmojo.desc(3434,"Number")},{did:"3",n:mstrmojo.desc(3544,"Text")},{did:"8",n:mstrmojo.desc(2052,"Date")},{did:"1",n:mstrmojo.desc(9919,"DateTime")},{did:"9",n:mstrmojo.desc(2170,"Time")},{did:"11",n:mstrmojo.desc(9920,"Big Decimal")},{did:"6",n:mstrmojo.desc(4699,"Email")},{did:"7",n:mstrmojo.desc(9921,"HTML Tag")},{did:"12",n:mstrmojo.desc(8984,"Phone Number")},{did:"10",n:mstrmojo.desc(4530,"Symbol")},{did:"5",n:mstrmojo.desc(9922,"URL")}]}]);}this.cm=H;},getMenuPosition:function J(){var R=mstrmojo.dom.position(this.domSrc,true);return{x:Math.round(R.x),y:Math.round(R.y+R.h)};},dataGrid:null,widget:null,dynamicUpdate:true,queryEnabled:function(R){var S=this.widget;switch(R.did){case"QBAttribute":return !S.ipa;break;case"QBMetric":return(S.tp!=4)&&!S.ipa;break;case"QBNone":return S.mapped;break;case"QBRename":return S.mapped&&!S.ipa;break;case"QBEdit":case"QBMap":return !S.ipa;break;case"QBUnMap":return S.ipa;break;default:return true;}},queryVisible:function(T){var S=this.dataGrid,R=this.widget;switch(T.did){case"QBAttribute":case"QBMetric":case"QBRename":return this.widget.hasMapped;break;case"QBMap":case"QBUnMap":return this.widget.hasMapped&&this.widget.tp==12&&this.widget.sptMap;break;case"QBEdit":return !!this.widget.isQB;break;case"QBRemove":return !!this.widget.isQB&&(!this.widget.isReadOnly);break;case"QBNone":return !!this.widget.isDI;break;case"QBDataType":return this.widget.hasMapped&&this.widget.sptGeo&&this.widget.tp==12;break;default:return true;}},queryChecked:function(T){var R=this.widget;var S=parseInt(T.did,10);if(S>0&&S<=12){return S==R.dtp;}return false;},executeCommand:function(k){var l=this.widget.did;var U=this.dataGrid.model;var g=U.mappings;var b=mstrmojo.array.find(g,"did",l);var Y=this.dataGrid;var S;if(b!=-1){S=mstrmojo.hash.copy(g[b]);}var d={failure:function(m){g[b]=S;Y.populatePreview();}};switch(k.did){case"QBAttribute":if(b!=-1){g[b].alias=g[b].isPA?g[b].alias:I(g[b].alias,g,12);g[b].tp=12;g[b].selected=true;if(g[b].isPA){g[b].ipa=1;}this.dataGrid.populatePreview();if(U.remap){U.remap({did:g[b].did,alias:g[b].alias,ot:12},d);}}break;case"QBMetric":if(b!=-1){g[b].alias=I(g[b].alias,g,4);g[b].tp=4;g[b].selected=true;g[b].dtp=2;this.dataGrid.populatePreview();if(U.remap){U.remap({did:g[b].did,alias:g[b].alias,ot:4},d);}}break;case"QBNone":if(b!=-1){if(U.unimport){U.unimport(l,g[b]);}}break;case"QBRename":var c=g[b].alias;var a=this.widget;var f=a.domNode.parentNode.clientWidth-25;f=(f>0)?(f+"px"):"20px";var V=Q.position(a.domNode).x-Q.position(Y.domNode).x+Y.scrollboxNode.scrollLeft+20+"px";Y.openPopup("inlineTextRef",{top:(Q.isIE?0:-1)+"px",left:V,txtConfig:{value:c||"",width:f,onEnter:function(){var m=M.trim(this.value),o=false;this.parent.close({enter:true});if(m===g[b].alias){return ;}if(U.validateRename){o=U.validateRename(m);}else{o=(m===I(m,g,g[b].tp));}if(o){g[b].alias=m;a.set("text",M.encodeHtmlString(m));U.remap&&U.remap({did:a.did,alias:m},d);}else{var p=mstrmojo.desc(12927,"The name ## has been used by another column. Please give a new name.");mstrmojo.alert(M.encodeHtmlString(p.replace("##",m)),null,U.alertTitle);}}}});break;case"QBEdit":var b=this.widget.ix,j=U.selectedClns[b],n=3;mstrApp.getRootController().openExpressionEditor({type:n,w:j,tkn:j.expr,cIndex:b+1});break;case"QBRemove":var a=this.widget;var e=a.ix+1;if(U.removeSelectedColumn){U.removeSelectedColumn(e);}break;case"QBMap":var Y=this.dataGrid,a=this.widget,X=Q.position(a.domNode),T=U.mappings[b],R=function W(){var m=new mstrmojo.qb.AttributeMapping({model:U});m.placeholder=document.body.appendChild(document.createElement("div"));m.top=X.y+22+"px";m.left=X.x+"px";m.did=a.did;m.target=a;m.open();},h={confirmBtn:{t:mstrmojo.desc(219,"Yes"),fn:function(){R();}},cancelBtn:{t:mstrmojo.desc(218,"No")}};B.toggleClass(a.domNode,"highlight",true);if(T.georole){mstrmojo.confirm(mstrmojo.desc(9912,"Mapping this column to a project attribute will remove its geographical role and any derived attributes. Do you want to continue?"),h);}else{if(T.der){mstrmojo.confirm(mstrmojo.desc(11621,"Mapping this column to a project attribute will remove all related derived date/time attributes. Do you want to continue?"),h);}else{R();}}break;case"QBUnMap":if(U.unmap){U.unmap(l,g[b].oid);}break;case"1":case"8":case"9":case"2":case"3":case"4":case"5":case"6":case"7":case"10":case"11":case"12":var a=this.widget;var Z=parseInt(k.did,10);if(a.dtp!=Z){a.dtp=Z;U.mappings[b].dtp=Z;U.remap&&U.remap({did:l,bft:Z},d);if(Z==1||Z==8||Z==9){a.georole=0;B.removeClass(a.domNode,"geo");!a.ipa&&B.addClass(a.domNode,"time");}else{B.removeClass(this.widget.domNode,"time");}K(a,U.mappings[b],Z);}break;case"QBTime":if(b!=-1){var T=U.mappings[b];T.tp=12;T.selected=true;T.der=k.der;Y.populatePreview();}break;case"QBGeo":if(b!=-1){var T=U.mappings[b];T.tp=12;T.selected=true;T.georole=k.georole;T.der=k.der;T.shapeKey=k.shapeKey;Y.populatePreview();}break;default:break;}}};function G(R,X,T){var S="mstrmojo-di-datapreview-cm",W=mstrmojo.all[S];var Y=R.parent.dataGrid;if(!W){W=mstrmojo.insert(L);W.set("domSrc",X);W.widget=R;W.dataGrid=Y;W.render();}else{W.widget=R;W.dataGrid=Y;W.set("domSrc",X);}W._subMenu&&W._subMenu.domNode&&W._subMenu.domNode.parentNode.removeChild(W._subMenu.domNode);W._subMenu=null;if(R.sptGeo&&R.tp!=4&&R.tp!=0&&!R.ipa){var V={},Z=true;switch(R.dtp){case 8:V={height:"220px",mode:1};Z=false;break;case 9:V={height:"100px",mode:2};Z=false;break;case 1:V={height:"260px",mode:3};Z=false;break;default:V={georole:R.georole};break;}if(Z){var U=Y.model;H[0].items=[{did:"QBGeo",itemWidget:P(R.georole,R.der,R.shapeKey,U.shapeKeys)}];}else{H[0].items=[{did:"QBTime",itemWidget:O(V.mode,V.height,R.der)}];}}else{delete (H[0].items);}W.cm=H;W.showContextMenu();}function D(T){var R={},S;mstrmojo.array.forEach(T,function(U){if(U.tp===12||U.tp===0){S=U.oid;R[S]=(R[S]||0)+1;}});return R;}mstrmojo.qb.QBPreview=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBPreview",resizeColumnBehavior:mstrmojo.RESIZE_ALL_COLUMN_MODE,model:null,visible:false,cssClass:"lockHeader",lockHeader:true,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},adjustSize:function(V){var U=200,T=this.parent&&this.parent.domNode,X=U*V;if(!T||!this.scrollboxNode){return ;}this.scrollboxNode.style.overflowX=(X>T.clientWidth)?"auto":"hidden";this.contentWidth=Math.max(X,T.clientWidth)+"px";var S=this.contentWidth,W=this.headerContainerNode,R=this.itemsContainerNode;if(S&&W&&R){W.style.width=S;R.style.width=S;}},onheightChange:function C(){var T=this.height,R=this.headerContainerNode,S=this.scrollboxNode;if(T&&R&&S){S.style.height=parseInt(T,10)-R.clientHeight+"px";}},onwidthChange:function F(){if(this.domNode&&this.model&&this.model.mappings){this.domNode.style.width="100%";this.adjustSize(this.model.mappings.length);}},populatePreview:function A(){if(!this.model){return ;}var T=this.model,R=T.mappings,h=T.supportTimeGeo,c=!mstrApp.isCloudPro,a=0,W=this.scrollboxNode;this.columns=[];if(W){a=W.scrollLeft?W.scrollLeft:0;}this.unrender();var m,k,l,f,S,n,Y=D(R);for(var d=0,e=R.length;d<e;d++){m=R[d];l=M.encodeHtmlString(m.alias);l=(Y[m.oid]>1&&m.fmn)?[l,"(",m.fmn,")"].join(""):l;f=m.tp;S=((m.dtp==1)||(m.dtp==8)||(m.dtp==9))&&!m.ipa;n="";if(S){f+=" time";if(m.tp===12){n=E;}}else{if(m.georole){f+=" geo";if(m.tp===12){n=N;}}}k={tag:m,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-datapreview-header",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-datapreview-headerIcon t"+(m.selected?f:0).toString(),text:l,did:m.did,tp:m.tp,isReadOnly:m.isReadOnly,hasMapped:m.hasMapped,isQB:m.isQB,isDI:m.isDI,sptGeo:h,sptMap:c,mapped:m.selected,ix:m.ix,nochange:m.nochange,ipa:m.ipa,dtp:m.dtp,georole:m.georole,der:m.der,shapeKey:m.shapeKey,multiForms:m.multiForms,isIDForm:m.isIDForm},{scriptClass:"mstrmojo.Widget",cssClass:"menu",alias:"tips",title:n,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" title="{@title}" style="{@cssText}" mstrAttach:click></div>',onclick:function(){var j=this.parent.children[0],o=j.tag;G(j,this.domNode,o);},markupMethods:{ontitleChange:function(){this.domNode.title=this.title;}}}]},colWidth:"60",colCss:"mstrmojo-qb-metric",dataFunction:function(u,o,t){var p=t.columns,j=u[this.dataField],q="mstrmojo-di-datapreview-DataRow-text";if(this.tag.selected){q+={"12":" Attribute","4":" Metric"}[this.tag.tp];}q+=(o%2==1)?" odd":" even";return'<div class="'+q+'">'+j+"</div>";},dataField:d.toString()};this.columns.push(k);}var Z=T.dataset;if(Z.length==0&&this.columns.length>0){var g=21;var V=parseInt(parseInt(this.parent.height)/g)-1;V=V>0?V:1;var U;for(var d=0;d<V;d++){U=[];for(var b=0,e=this.columns.length;b<e;b++){U.push("");}Z.push(U);}}this.items=Z;this.render();this.adjustSize(R.length);var X=this;window.setTimeout(function(){X.scrollboxNode.scrollLeft=a;},3);},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,slot:"headerContainerNode",children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onblur:function(){this.onEsc();},onEsc:function(){if(this.onCancel){this.onCancel();}this.parent.close({cancel:true});}}],onOpen:function(){var S=this.txt,T=this.txtConfig;if(T){for(var R in T){S.set(R,T[R]);}}S.domNode.style.width=S.width;S.focus();},onClose:function(R){if(!R||(!R.cancel&&!R.enter)){this.txt.onEnter();}this.unrender();}},onvisibleChange:function(R){if(R.value){this.populatePreview();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.InlineEditBox","mstrmojo.Tooltip","mstrmojo.MenuButton","mstrmojo.string","mstrmojo.qb.AttributeMapping","mstrmojo.DI.DIInlineEditBox");mstrmojo.requiresDescs(12532,12829,12830,12831);var J="idx",F=mstrmojo.string;var C=mstrmojo.dom;var I=mstrmojo.DI.DIConstants;function G(N){if(!N||!N.data||isNaN(N.data.tp)||!N.data.selected){return ;}var L=N.data;var K=mstrApp.getRootController().model;var M,O=[];O=K.findMappingItem(L);for(M=0;M<O.length;M++){O[M].selected=false;}mstrApp.getRootController().changeEMMAMappings();}function B(L){var M=this;M.menuHelper=mstrApp.getRootController().getMappingMenu(M.data.tableId);M.menuHelper.target=M;M.menuHelper.data=[M.data];M.menuHelper.type=I.contextMenuType.PREVIEW_ITEM_MENU;M.menuHelper.position=C.position(this.menuNode,true);var K=M.menuHelper.getMenuConfig();K.hostId=M.id;K.hostElement=this.domNode;K.isHostedWithin=false;K.position=M.menuHelper.position;K.popupHandlers[M.id]={close:function(){this.menuHelper.destroy();}};M.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:K}));}mstrmojo.DI.DIMappingItem=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIMappingItem",type:"",subtype:"",georole:null,timerole:null,name:"",allowEdit:true,tooltip:"",markupString:'<div id="{@id}" class="mstrmojo-di-mappingitem {@cssClass}" style="{@cssText}" title="{@itemTitle}" mstrAttach:contextmenu><div class="mappingitem-icon mstrmojo-di-datapreview-headerIcon t{@type} {@subtype}" style="{@iconStyle}"></div><div class="mappingitem-text t{@type}" style="{@textStyle}"></div><div class="mappingitem-menu" style="{@menuStyle}"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{iconNode:function(){return this.domNode.children[0];},textNode:function(){return this.domNode.children[1];},menuNode:function(){return this.domNode.children[2];}},useRichTooltip:true,setSubtype:function A(){if(this.georole&&this.georole>0){this.subtype="geo";}else{if(this.timerole&&this.timerole>0){this.subtype="time";}}},postCreate:function(){if(this._super){this._super();}this.setSubtype();this.itemTitle=0===this.type?mstrmojo.string.decodeHtmlString(this.name,false):"";this.iconStyle=0===this.type?"display:none;":"display:block;";this.textStyle=0===this.type?"display:none;":"display:block;";this.menuStyle=0===this.type?"float:left;":"float:right";},toUnused:function H(){G(this);},rename:function(K){if(K){this.linkObjID=K;}this.text.rename();},onitemOnSave:function(L){var K=mstrApp.getRootController();var N=L.src;var M=N.data;K.mappingController.renameTableItem(this.text,M);this.text.set("text",M.alias);return true;},postBuildRendering:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:(this.data.ipa?(mstrmojo.desc(13243,"Project Attribute")+": "):"")+this.name});if(!this._ontooltipover){var K=this.id;this._ontooltipover=function(M){var L=mstrmojo.all[K];if(L.text.textNode.scrollWidth>L.text.textNode.clientWidth){L.showTooltip(M,self);}};this._ontooltipout=function(M){var L=mstrmojo.all[K];L.hideTooltip(M,self);};}C.attachEvent(this.textNode,"mouseover",this._ontooltipover);C.attachEvent(this.textNode,"mouseout",this._ontooltipout);if(this._super){return this._super();}},children:[{slot:"textNode",alias:"text",cssClass:"mstrmojo-di-rename-box mappingitem-text-div",scriptClass:"mstrmojo.DI.DIInlineEditBox",preclick:function E(){if(this.parent.data.selected&&this.parent.data.ipa!==1){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}}},rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){var K=this.text;this.parent.raiseEvent({name:"itemOnSave",src:this,text:K});},onCancel:function(){this.parent.linkObjID=null;},bindings:{allowEdit:"this.parent.allowEdit",text:"this.parent.name",cssClass:function(){var K="mstrmojo-di-rename-box mappingitem-text-div";if(this.parent.data.ipa){K+=" ipa";}return K;}}},{slot:"textNode",alias:"linkedIcon",iconClass:"mappingitem-linkedIcon",scriptClass:"mstrmojo.Button"},{slot:"menuNode",alias:"menu",scriptClass:"mstrmojo.Button",onclick:function(K){B.call(this.parent,K);}}],oncontextmenu:function D(K){C.stopPropogation(self,K.e);if(this.dataGrid&&this.dataGrid.hasContextMenu){B.call(this,K);}C.preventDefault(window,K.e);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.DI.DIObjectBrowserDnD","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.DI.FileDragDropBoxDnD","mstrmojo.css");mstrmojo.requiresDescs(12679);mstrmojo.DI.DIDragFiles=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIDragFiles",cssClass:"di-connector-panel",titleWidget:"",children:[{scriptClass:"mstrmojo.VBox",cssClass:"",alias:"mainPage",children:[{scriptClass:"mstrmojo.HBox",cssClass:"",alias:"content",children:[{scriptClass:"mstrmojo.VBox",cssClass:"di-connector-left-panel",alias:"objectListPanel",children:[{scriptClass:"mstrmojo.DI.DIObjectBrowserDnD",cssClass:"di-object-browser",alias:"browser",rootUrl:"",visible:true,populate:function C(J){this.set("fileList",J);},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},bindings:{canRefresh:"this.parent.parent.parent.parent.canRefresh"}}]},{scriptClass:"mstrmojo.DI.FileDragDropBoxDnD",alias:"urlList",draggable:false,fileUpload:false,dropZone:true,visible:true,text:mstrmojo.desc(12679,"Drag and drop file(s) from left."),cssClass:"di-connector-right-panel",getFilesCnt:function(){return this.urls?this.urls.length:0;},getFileUrl:function(J){if(J<this.urls.length){return this.urls[J];}return"";},onurlsChange:function(){if(this._super){this._super();}var K=mstrApp.getRootController();if(!this.parent.parent.parent.multiSelect){K.sourceSelected(this.urls.length===1);}else{if(this.urls.length>0||this.forceEnable===true){K.sourceSelected(true);}else{K.sourceSelected(false);}}var L=this.domNode.firstChild.children[0];var J=mstrmojo.css;if(this.urls&&this.urls.length>0){J.toggleClass(L,"solid",true);}else{J.toggleClass(L,"solid",false);}this.updateItemsCount(this.getURLCnt());}}]}]}],createTitleWidget:mstrmojo.emptyFn,ondrop:mstrmojo.emptyFn,onNextButtonClick:mstrmojo.emptyFn,browseFunction:mstrmojo.emptyFn,refreshFunction:mstrmojo.emptyFn,editFunction:mstrmojo.emptyFn,supportFolderDrag:true,sourceObjectsInfo:null,autoSelectNode:mstrmojo.emptyFn,canRefresh:false,sizeTooltip:false,folderSizeTooltip:false,multiSelect:true,filterType:[],preBuildRendering:function F(){var L,K,J;if(this._super){this._super();}this.titleWidget=this.createTitleWidget();L=this.mainPage.content;K=L.objectListPanel;J=K.browser;K.addChildren(this.titleWidget,0);L.urlList.set("ondrop",this.ondrop);J.set("browseFunction",this.browseFunction);J.set("refreshFunction",this.refreshFunction);J.set("editFunction",this.editFunction);J.set("supportFolderDrag",this.supportFolderDrag);J.set("sourceObjectsInfo",this.sourceObjectsInfo);J.set("autoSelectNode",this.autoSelectNode);J.set("container",this);J.set("sizeTooltip",this.sizeTooltip);J.set("folderSizeTooltip",this.folderSizeTooltip);J.set("filterType",this.filterType);},getObjectBrowser:function A(){var L,K,J;L=this.mainPage.content;K=L.objectListPanel;J=K.browser;return J;},getDropZone:function E(){var J=this.mainPage.content;return J.urlList;},getTitleWidget:function G(){return this.titleWidget;},refreshBrowser:function I(){var L,K,J;L=this.mainPage.content;K=L.objectListPanel;J=K.browser;J.clickedNode=this.mainPage.content.objectListPanel.browser.fileTree;J.refreshFunction();},setRootURL:function D(L){var M,K,J;M=this.mainPage.content;K=M.objectListPanel;J=K.browser;J.set("rootUrl",L);},adjustSize:function H(K){var L=parseInt(K.w,10),M,J,N=Math.round(L*0.482);this.domNode.style.width=L+"px";M=this.mainPage.content;J=M.objectListPanel;J.domNode.style.width=N+"px";M.urlList.dnDNode.style.width=L-N-31+"px";},changeSize:function B(J){var K=Math.ceil(parseInt(J.size.w,10));if(isNaN(K)){return ;}this.mainPage.content.objectListPanel.domNode.style.width=K*0.5+"px";this.mainPage.content.urlList.dnDNode.style.width=(K*0.5-41)+"px";}});}());(function(){mstrmojo.requiresCls("mstrmojo.SaveAsEditor","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(1442,12376,12377,12908);var E=mstrmojo.array,G=mstrmojo.DI.DIConstants,B=mstrmojo.desc;var C=0,D=-1,A=-2;mstrmojo.DI.ui.dialogs.DISaveAsDialog=mstrmojo.declare(mstrmojo.SaveAsEditor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DISaveAsDialog",cssClass:"mstrmojo-SaveAsEditor",typeDesc:"Cube",browsableTypes:"776,779,8",zIndex:1000,folderLinksContextId:28,onRender:function H(){this.ob.set("scrollableIncFetch",true);},validateInput:function(N,P){var M=mstrApp.getRootController(),J=this.contPanel,L=this.ob.currentFolder,Q=J.name.value,O=this,R=C,K;this.name=J.name.value;this.desc=J.desc.value;this.folderID=L.did;this.saveAsOverwrite=!!N;if(!this.name){R=D;P(R);return ;}E.forEach(L.items,function(S){if(S.t===3&&S.n.toUpperCase()===Q.toUpperCase()){R=A;return false;}});if(R!==C){P(R);return ;}K={rootFolderID:L.did,searchPattern:Q,objectType:O.browsableTypes,nameWildcards:0};if(this.ob.enableQuickSearch){K.quickSearch=this.ob.enableQuickSearch;}M.dataService.searchFolderContents({success:function(S){if(S&&S.items){E.forEach(S.items,function(T){if(T.t===3&&T.n.toUpperCase()===Q.toUpperCase()){R=A;return false;}});}P(R);},failure:function(S){M.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,S.message);}},K);},saveCube:function I(){var O=mstrApp.getRootController(),N=O.getModel();var L=this.saveParams||{};L.folderID=this.folderID;L.objDesc=this.desc||"";L.objName=this.name||"";L.saveAsOverwrite=this.saveAsOverwrite;var K=this.saveAsCallback();K.parent=this;var P=N.isDirectDataAccess?true:false;mstrApp.serverRequest(L,K,{showProgress:P});this.close();var M,Q=[],R=N.importSources;for(M in R){var J=R[M].sourceInfo.name;R[M].status="0";Q.push({n:J,complete:false});}N.cubeName=this.name||"";if(!N.isDirectDataAccess){N.raiseEvent({name:"PublishStatusUpdate"});O.showDialog(G.dialogType.publishStatusDialog,{model:N,zIndex:mstrApp.getRootController().dialogController.getNextZIndex()});}O.enableFinishButton(false);},saveAs:function(J){var K=this;this.validateInput(J,function(L){switch(L){case C:K.saveCube();break;case D:mstrmojo.alert(B(12376,"Please enter a valid cube name"));break;case A:var M=B(12377,"Saving cube with the same name");mstrApp.getRootController().displayWarning(mstrmojo.desc(12908,"The name #### already exists. Do you want to replace the existing one?").replace("####",this.name),M,function(){K.saveCube();});break;}});},getObjectPath:function F(){var L=this.ob.currentFolder,M=this.name,K="\\",N="",J;if(L){J=L.anc&&L.anc.items;while(J[0].n!==L.n&&J[0].n!=="Shared Reports"&&J[0].n!=="My Reports"){J=J[0].items;}while(J){N=N+J[0].n+K;J=J[0].items;}}N+=M;return N;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.qb.DBTableRows","mstrmojo._IsMovable","mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.css","mstrmojo.DI.DIMappingTableRows","mstrmojo.DI.DIMappingMenu");mstrmojo.requiresDescs(962,3581);var L=mstrmojo.dom,T=mstrmojo.hash,Y=mstrmojo.array,D=mstrmojo.css,K=mstrmojo.Widget,e=Math.max,I=Math.min,k="px",S=12,J=4,h=mstrmojo.DI.DIConstants,o="dragging",X=264,P=175,p;function a(u){Y.forEach(u,function(w){w.ttp=w.alias;if(w.subColumns){a(w.subColumns);}});}function O(u,w){var x=[];Y.forEach(u,function(z){if(z.tp===w){x.push(z);}});return x;}function Q(){if(this.domNode){var u=this.domNode.style,w=this.tableData;u.left=this.left||w.x;u.top=this.top||w.y;}}function l(u,AA){var AD,AB,AC,z,x;AB=this.parent.domNode.clientHeight-40;if(u===undefined||AA===undefined){AC=L.position(this.domNode);AD=AC.h;z=I(e(AD,X),AB);x=P;}else{z=e(u,X);x=e(AA,P);}this.set("height",z+k);this.set("width",x+k);}function g(u){return u.src.node===this.resizeHandle;}mstrmojo.DI.DIMappingTable=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsMovable,mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.DI.DIMappingTable",markupString:'<div id="{@id}" class="mstrmojo-di-TableView {@cssClass} {@group}" mstrAttach:contextmenu,click><div class="mstrmojo-di-tv-header item" ><span class="mstrmojo-di-tv-ttl" mstrAttach:dblclick>{@title}</span><span class="di-item-mn" mstrAttach:click></span></div><div class="mstrmojo-qb-tv-rsz"></div></div>',markupSlots:{headerNode:function n(){return this.domNode.firstChild;},titleNode:function V(){return this.domNode.firstChild.firstChild;},containerNode:function W(){return this.domNode;},menuNode:function t(){return this.domNode.firstChild.lastChild;},resizeHandle:function m(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:K.visibleMarkupMethod,onheightChange:K.heightMarkupMethod,onwidthChange:K.widthMarkupMethod},onheightChange:function(AF){var AD=this.attrRows,x=this.metricRows,AA=parseInt(this.height,10),u=this._ttlHeight,w,AB,AE,AC,z;if(this._super){this._super(AF);}w=(AD.containerNode||AD.domNode).clientHeight;AB=(x.containerNode||x.domNode).clientHeight;z=AA-u*3-2;AE=Math.floor(z/2);AC=AE;if(AE>w){AE=w;AC=z-AE;}else{if(AC>AB){AC=AB;AE=z-AC;}}if(AE>=0){AD.set("height",AE+k);}if(AC>=0){x.set("height",AC+k);}},initSelectNode:null,draggable:true,dropZone:true,ownAvatar:true,tableMapping:null,model:null,isExpanded:false,group:"",init:function(AB){if(this._super){this._super(AB);}var AA=this.id,x="tableViewMenuSelect",w="tableSelectionClear";Y.forEach([this.attrRows,this.metricRows],function z(AE){AE.attachEventListener(x,AA,function AD(AF){p.showPopupMenu(this,AF);});AE.attachEventListener(w,AA,function AC(AF){this.clearRowSelections(AF);});},this);this.attrRows.convertEnabled=this.metricRows.convertEnabled=this.convertEnabled;this.attrRows.attachEventListener("selectLinkedItems",AA,function u(AC){this.parent.selectLinkedAttribute(AC);});this.metricRows.attachEventListener("selectLinkedItems",AA,function u(AC){this.parent.selectLinkedAttribute(AC);});},preBuildRendering:function A(){this._super();var x=this.tableData,w=x.items,z=this.attrRows,u=this.metricRows;a(w);this.title=x.n;z.items=O(w,S);z.tableData=x;z.tp=S;u.items=O(w,J);u.tableData=x;u.tp=J;},onselectedChange:function(){if(!this.domNode){return ;}if(this.selected){this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+2;}else{this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+1;}},postBuildRendering:function N(){this._super();Q.call(this);this._ttlHeight=this.headerNode.clientHeight;l.call(this,this.height,this.width);if(this.attrRows.domNode&&this.tableData.attrRowsScroll!==undefined){this.attrRows.domNode.scrollTop=this.tableData.attrRowsScroll;}if(this.metricRows.domNode&&this.tableData.metricRowsScroll!==undefined){this.metricRows.domNode.scrollTop=this.tableData.metricRowsScroll;}if(this.selected){this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+2;}else{this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+1;}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.title});if(!this._ontooltipover){var u=this.id;this._ontooltipover=function(z){var x=mstrmojo.all[u];var w=x.titleNode;var AA=mstrmojo.dom.position(w);if(AA.w<w.scrollWidth){x.showTooltip(z,self);}};this._ontooltipout=function(x){var w=mstrmojo.all[u];w.hideTooltip(x,self);};}L.attachEvent(this.domNode,"mouseover",this._ontooltipover);L.attachEvent(this.domNode,"mouseout",this._ontooltipout);L.attachEvent(this.domNode,"mousedown",this._ontooltipout);if(this.shouldExpand){this.expandAttrForms();}},expandAttrForms:function G(){var w=this.attrRows,u=w.items,x=false;if(this.isExpanded){w.expandedIndices={};x=true;this.isExpanded=false;}else{Y.forEach(u,function(AA,z){if(AA.subColumns&&!AA.items){AA.items=AA.subColumns;w.expandedIndices[z]=true;x=true;}else{if(AA.items&&!this.isExpanded){w.expandedIndices[z]=true;x=true;}}});this.isExpanded=true;}if(x){this.attrRows.render();mstrmojo.css.toggleClass(this.attrRows.domNode,"expand",this.isExpanded);}},getTableID:function C(){return this.tableData.id;},getMovingHandle:function q(){return(this.isEditing?null:this.headerNode);},toggleAvatarClass:function j(u,w){D.toggleClass(this.avatar,u,w);},isDragValid:function U(u){return g.call(this,u)||this._super(u)||false;},ondragstart:function d(u){this.dragging=true;this._super(u);if(!this.selected){this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+3;}D.toggleClass(this.domNode,[o],true);if(g.call(this,u)){this._rszCfg={h:parseInt(this.height,10),w:parseInt(this.width,10)};}this.parent.parent.linker.clearLinks();},ondragmove:function H(u){var w=u.src.pos,AE=u.tgt.pos;if(this._rszCfg){var x=this._rszCfg;l.call(this,x.h+AE.y-w.y,x.w+AE.x-w.x);}else{var AB=this.getMovingTarget();var AC=AB.style;var z=L.windowDim();if(parseInt(AC.left,10)<0){AC.left=this.left="0px";}else{AC.left=this.left=Math.max(this._leftPos+AE.x-w.x,-this._hWidth+40)+"px";}AC.top=this.top=Math.min(Math.max(this._topPos+AE.y-w.y,-this._hHeight+20),z.h-20)+"px";var AA=u.src.widget.attrRows;var AD=AA.getUserSelectedData();if(AD.length===1&&AD[0].isLinked){this.attrRows.raiseEvent({name:"drawLinks",source:this,oid:AD[0].oid});}}},ondragend:function E(w){var AB,z;this._super(w);var x=this.domNode,AA=x.style.zIndex,u=mstrApp.getRootController().getDialogController();D.toggleClass(x,[o],false);if(parseInt(AA,10)<(u.getCurrentZIndex()-1)){x.style.zIndex=u.getNextZIndex();}if(this.selected){x.style.zIndex=u.getCurrentZIndex()+2;}else{x.style.zIndex=u.getCurrentZIndex()+1;}delete this._rszCfg;z=mstrApp.getRootController().getModel().getImportSource(this.getTableID());AB={x:Math.max(parseInt(x.style.left,10),0),y:Math.max(parseInt(x.style.top,10),0),w:x.clientWidth,h:x.clientHeight};if(!z){return ;}z.updateTablePosition(AB);},selectItemById:function R(u){return this.attrRows.selectItem("id",u);},selectItemByName:function b(u){return this.metricRows.selectItem("alias",u);},onclick:function c(u){var x=u.getTarget();mstrmojo.dom.stopPropogation(u.hWin,u.e);if(x===this.menuNode){p.showPopupMenu(this,{position:L.position(this.menuNode,true),data:[this.tableData],menuType:h.contextMenuType.TABLE_MENU});}else{if(x===this.titleNode&&this.dragging){this.dragging=false;return ;}else{if(mstrApp.getRootController().selectSourceTable){var w=mstrApp.getRootController().getModel();if(!w.currentSource||w.currentSource.tableID!==this.tableData.id){mstrApp.getRootController().selectSourceTable(this.tableData.id);}}}}},clearRowSelections:function f(w){var u=w&&w.source&&w.source.id;Y.forEach([this.attrRows,this.metricRows],function x(z){if(z.id!==u){z.clearSelections(T.copy(z.userSelections));}});},oncontextmenu:function Z(w){L.preventDefault(window,w.e);var x=w.target||L.eventTarget(w.hWin,w.e);var u;if(x.nodeName==="SPAN"){if(x.className.indexOf("di-item-n")===-1&&x.nextSibling&&x.nextSibling.className.indexOf("di-item-n")!==-1){x=x.nextSibling;}if(x.className.indexOf("di-item-n")===-1){return false;}}else{if(x.childNodes[1]&&x.childNodes[1].className.indexOf("di-item-n")!==-1){x=x.childNodes[1];}else{if(x.className==="linked"){x=x.parentNode.childNodes[1];}else{return false;}}}u=L.getMousePosition(w.e,w.hWin);Y.forEach([this.attrRows,this.metricRows],function z(AB){if(T.keyarray(AB.userSelections).length){var AA=AB.getUserSelectedData();p.showPopupMenu(this,{menuNode:x,data:AB.getUserSelectedData(),menuType:h.contextMenuType.ITEM_MENU,position:u});}},this);return false;},ondblclick:function M(u){var w=u.getTarget();if(w.nodeName!=="SPAN"){w=w.childNodes[1];}var x={data:[this.tableData],target:u.src,position:L.position(w,true)};mstrApp.getRootController().openRenameTextBox(h.contextMenuType.TABLE_MENU,w,x);},ontableDataChange:function F(){this.refresh();},clearSelectionRowsOrSelectTable:function(){var u=mstrApp.getRootController().getModel();if(!u.currentSource||u.currentSource.tableID!==this.tableData.id){mstrApp.getRootController().selectSourceTable(this.tableData.id);}else{this.clearRowSelections();}},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3581,"Attributes"),cssClass:"mstrmojo-di-subTitle",onclick:function c(){this.parent.clearSelectionRowsOrSelectTable();}},{scriptClass:"mstrmojo.DI.DIMappingTableRows",alias:"attrRows",allowEdit:true,cssClass:"attrRows"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(962,"Metrics"),cssClass:"mstrmojo-di-subTitle",onclick:function c(){this.parent.clearSelectionRowsOrSelectTable();}},{scriptClass:"mstrmojo.DI.DIMappingTableRows",alias:"metricRows",allowEdit:true,cssClass:"metricRows"}]});p=mstrmojo.DI.DIMappingTable;p.showPopupMenu=function B(u,x){u.menuHelper=mstrApp.getRootController().getMappingMenu(u.tableData.id);u.menuHelper.target=u;u.menuHelper.data=x.data;u.menuHelper.type=x.menuType;u.menuHelper.position=x.position;u.menuHelper.menuNode=x.menuNode;var w=u.menuHelper.getMenuConfig();w.hostId=u.id;w.hostElement=x.menuNode;w.isHostedWithin=false;w.position=x.position;w.popupHandlers[u.id]={close:function(){this.menuHelper.destroy();}};if(w.menus&&w.menus.length>0){u.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:w}));}};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuHadoop=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuHadoop",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIMappingMenu");var B=mstrmojo.DI.DIConstants,A=B.menuItems,F=mstrmojo.hash,C=mstrmojo.array;function E(I,H){var G=[];if(!H){if(I.linkedTbs){F.forEach(I.linkedTbs,function(J,K){if(J){G.push(K);}});}else{G.push(I.tableId);}}else{C.forEach(H,function(K){var J=false;if(I.linkedTbs){if(I.linkedTbs[K]){J=true;}}else{if(K===I.tableId){J=true;}}if(J){if(C.indexOf(G,K)<0){G.push(K);}}});}return G;}mstrmojo.DI.DIAllObjectsMappingMenu=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIAllObjectsMappingMenu",queryEnabled:function D(J){var G=true;if(J.did===A.CREATE_MULTIFORM_ATTRIBUTE||J.did===A.MAP_TO_PROJECT_ATTRIBUTE){var H,K=this.data,I;I=K[0].linkedTbs?F.keyarray(K[0].linkedTbs):[K[0].tableId];for(H=1;H<K.length;H++){I=C.intersection(I,K[H].linkedTbs?F.keyarray(K[H].linkedTbs):[K[H].tableId]);}if(I.length){K[0].tableId=I[0];}else{G=false;}}else{G=this._super(J);}return G;},executeCommand:function(I){var K=this.data,J,H,G;if(I.did===A.CREATE_MULTIFORM_ATTRIBUTE||I.did===A.EDIT_MULTIFORM_ATTRIBUTE||I.did===A.ADDTO_MULTIFORM_ATTRIBUTE||I.did===A.MAP_TO_PROJECT_ATTRIBUTE){for(G=0;G<K.length;G++){if(G===0){J=E(K[0]);}else{J=E(K[G],J);}}if(J.length){H=J[0];}switch(I.did){case A.CREATE_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(B.formsOptions.CREATE_MULTIFORM_ATTRIBUTE,H,this.data[this.data.length-1],this.data);break;case A.EDIT_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(B.formsOptions.EDIT_MULTIFORM_ATTRIBUTE,H,this.data[this.data.length-1],this.data);break;case A.ADDTO_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(B.formsOptions.ADDTO_MULTIFORM_ATTRIBUTE,H,null,this.data);break;case A.MAP_TO_PROJECT_ATTRIBUTE:mstrApp.getRootController().toProjectAttribute(this,H);break;}}else{if(I.did===A.UNLINK_ALL){mstrApp.getRootController().unlinkAllCubeLevel(this);}else{return this._super(I);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuSearchOnSource=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuSearchOnSource",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}switch(D.did){case A.MARK_GEO_ROLES:E=false;break;case A.CREATE_TIME_ATTRIBUTES:E=false;break;case A.CREATE_MULTIFORM_ATTRIBUTE:E=false;break;case A.MAP_TO_PROJECT_ATTRIBUTE:E=false;break;case A.UNMAP:E=false;break;}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuSAPHana=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuSAPHana",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}switch(D.did){case A.CREATE_MULTIFORM_ATTRIBUTE:case A.ADDTO_MULTIFORM_ATTRIBUTE:case A.EDIT_MULTIFORM_ATTRIBUTE:case A.CHANGE_DATA_TYPE:case A.DO_NOT_IMPORT:case A.TO_ATTRIBUTE:case A.DEFINE_RELATIONSHIPS:case A.TO_METRIC:case A.MARK_GEO_ROLES:case A.CREATE_TIME_ATTRIBUTES:case A.SHOW_ALL_COLUMNS:E=false;break;}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIMappingMenu","mstrmojo.DI.DIMappingMenuSearchOnSource","mstrmojo.DI.DIMappingMenuHadoop","mstrmojo.DI.DIMappingMenuSAPHana");var A=mstrmojo.DI.DIConstants;mstrmojo.DI.controller.DIMappingMenuController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIMappingMenuController",getMappingMenu:function B(E){var D=mstrApp.getRootController().getModel();var F=D.importSources[E],C;if(F!==undefined&&F.type===A.sourceType.querybuilder&&F.subtype===A.sourceSubtype.searchOnSource){C=new mstrmojo.DI.DIMappingMenuSearchOnSource();}else{if(F!==undefined&&F.type===A.sourceType.hadoop&&F.subtype===A.sourceSubtype.hadoop){C=new mstrmojo.DI.DIMappingMenuHadoop();}else{if(F!==undefined&&F.databaseType===4000&&F.xdaType===A.xdaType.qbSingleTable){C=new mstrmojo.DI.DIMappingMenuSAPHana();}else{C=new mstrmojo.DI.DIMappingMenu();}}}return C;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.DI.DIConstants","mstrmojo.CheckBox","mstrmojo.Container","mstrmojo._HasOwnAvatar","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.HBox","mstrmojo.Label","mstrmojo.ui.SearchBox","mstrmojo.DI.DIMappingItem","mstrmojo.DI.DIAllObjectsMappingMenu");mstrmojo.requiresDescs(191,192,962,2461,3581,7755,11611,11805,12665,12666,14029);var R=mstrmojo.dom,B=mstrmojo.css,k=mstrmojo.array,V=mstrmojo.hash,p=mstrmojo.DI.DIConstants,x="ConvertAttributeToMetric",G="ConvertMetricToAttribute",e=0,J=null,AA={ALL:"select-all",NON:"unselect-all",PART:"select-some"},AC={Attribute:"amps",Metric:"mtmps"},u=[3,11];function O(AG,AF){var AI=AG.findMappingSource(AF);var AJ=[];k.forEach(AI,function AH(AK){AJ.push(AK.sourceInfo.name);});return AJ;}function g(AH){var AL=mstrApp.getRootController().allObjectsController.getAllMappings();if(!AL||!AL.length){return null;}var AJ=k.filter(AL,function AI(AM){return AM.type===AH;});var AG,AK;var AF=[];for(AG=0;AG<AJ.length;AG++){AK=AJ[AG];AF.push({n:AK.alias,tp:AK.tp,col:AK,idx:AG,isLinked:AK.isLinked});}return AF;}function AD(){if(!J){J=new mstrmojo.DI.DIAllObjectsMappingMenu();}return J;}function S(AF){return AF===AC.Attribute?1:0;}function z(AG){var AF=k.indexOf(u,AG);return AF===-1?false:true;}function L(AF,AG){if(AG){this.set("state",AA.NON);}else{if(AF){this.set("state",AA.ALL);}else{this.set("state",AA.PART);}}}function M(AJ,AK){var AN=AJ.cubeConfig.sidxes;var AM=0,AL=AN.length;var AI,AH,AG;for(AI=0;AI<AK.length;AI++){if(AM===AL){break;}var AF=AK[AI].col;if(!AF.isMultiForm){AF.indexOn=false;}for(AH=0;AH<AN.length;AH++){if(AF.id===AN[AH].atid){if(!AF.isMultiForm){AF.indexOn=true;AM++;break;}else{for(AG=0;AG<AF.subColumns.length;AG++){if(AF.subColumns[AG].fmid===AN[AH].afid){AF.subColumns[AG].indexOn=true;AM++;break;}}}}}}}function C(AF){this.data=AF;this.type=AF.tp;this.name=AF.alias;this.tooltip=AF.alias;this.georole=AF.georole;this.timerole=AF.timerole;if(AF.isLinked){this.cssClass+=" linked";}this.setSubtype();}function F(AH){var AF=this;var AG={headerWidget:{scriptClass:"mstrmojo.DI.HeaderWidget",text:(this.type==="amps"?mstrmojo.desc(3581,"Attributes"):mstrmojo.desc(962,"Metrics")),menuController:AF,field:"n",cm:[{n:mstrmojo.desc(191,"Sort Ascending"),did:"ASC"},{n:mstrmojo.desc(192,"Sort Descending"),did:"DES"}]},colWidth:AH,dataWidgetBuilder:function(AN){var AI=null;if(AN.col.isMultiForm){var AJ=AN.col.subColumns;AI={scriptClass:"mstrmojo.Box",cssClass:"multiform-attribute cf",at:AN.col,children:[{scriptClass:"mstrmojo.Button",cssClass:"mfa-status-button",onclick:function AK(){this.parent.toggleState();}},{scriptClass:"mstrmojo.DI.DIMappingItem",allowEdit:false,oncontextmenu:mstrmojo.emptyFn,postCreate:function(){var AO=this.parent.at;C.call(this,AO);}},{scriptClass:"mstrmojo.ui.List",cssClass:"attribute-forms-list",items:AJ,getItemDisplayName:function AL(AO){return AO.alias+"@"+AO.fmn;},oncontextmenu:function(AP){R.preventDefault(window,AP.e);this.onclick(AP);var AT=R.eventTarget(AP.hWin,AP.e);var AR=AD();var AS=[this.selectedItem];AR.target=this;AR.data=AS;AR.type=p.contextMenuType.ITEM_MENU;AR.position=R.position(this.domNode);var AO=AR.getMenuConfig(),AQ=this.parent.dataGrid;AO.hostId=AQ.id;AO.hostElement=AT;AO.isHostedWithin=false;AQ.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:AO}));},onchange:function AM(){this.parent.dataGrid.hightlightAttFormList=this;}}],onclick:function AK(AP){var AQ=AP.target||R.eventTarget(AP.hWin,AP.e);var AO=R.findWidget(AQ);if(AO===this){this.collapse=!this.collapse;this.toggleState();}},toggleState:function(){this.collapse=!this.collapse;var AO=this.domNode.parentNode.parentNode;B.toggleClass(AO,"collapse",this.collapse);}};}else{AI={scriptClass:"mstrmojo.DI.DIMappingItem",cssClass:"sfa",allowEdit:false,oncontextmenu:mstrmojo.emptyFn,postCreate:function(){var AO=this.parent.data.col;C.call(this,AO);}};}return AI;}};return AG;}function N(AG){var AF={headerText:mstrmojo.desc(7755,"Table"),colWidth:AG,dataWidgetBuilder:function(AL){var AM=null,AK=mstrApp.getRootController().model,AP,AN=mstrApp.getRootController().allObjectsController.getAllImportSources();var AH=V.keyarray(AN).length;if(AN.length===0){return ;}if(AL.col.isMultiForm){AM={scriptClass:"mstrmojo.Box",cssClass:"multiform-attribute-src-box",children:[{scriptClass:"mstrmojo.DI.DIAllObjectsSourceLabel",cssClass:"attribute-form-label"},{scriptClass:"mstrmojo.Box",cssClass:"attribute-forms-src-list",alias:"srcTableCount",children:[]}]};var AJ,AQ=AL.col.subColumns,AO=AM.children[0],AI=AM.children[1];for(AJ=0;AJ<AQ.length;AJ++){AP=O(AK,AQ[AJ]);AI.children.push({scriptClass:"mstrmojo.DI.DIAllObjectsSourceLabel",cssClass:"attribute-form-label",text:AP.length+"/"+AH,src:AP,total:AH});if(AQ[AJ].isIdForm){AO.text=AP.length+"/"+AH;AO.src=AP;AO.total=AH;}}}else{AP=O(AK,AL.col);AM={scriptClass:"mstrmojo.DI.DIAllObjectsSourceLabel",cssClass:"attribute-form-label",text:AP.length+"/"+AH,src:AP,total:AH};}return AM;}};return AF;}function Q(AH){var AG=this;var AF={colWidth:AH,headerCss:"mstrmojo-di-samplefiles-col1header",headerWidget:{scriptClass:"mstrmojo.ImageCheckBox",label:mstrmojo.desc(12665,"Search Index"),state:AA.NON,enabled:false,onclick:function(){if(this.state===AA.ALL){this.set("state",AA.NON);this.dataGrid.initSearchIndex(false);}else{this.set("state",AA.ALL);this.dataGrid.initSearchIndex(true);}AG.raiseEvent({name:"searchIndexChange"});},onstateChange:function(){B.removeClass(this.inputNode,[AA.ALL,AA.NON,AA.PART]);B.addClass(this.inputNode,this.state);},updateState:function(){var AI=this.dataGrid;var AP=AI.items;var AK=AP.length;var AM,AQ=true,AN=true,AJ,AO=0;for(AM=0;AM<AK;AM++){var AL=AI.getCellWidget(AM,e);if(AL){AJ=AP[AM].col.isMultiForm?AL.mfaIndexControl.state:AL.checked;if(AJ===AA.ALL||AJ===true){AN=false;}else{if(AJ===AA.PART){AN=false;AQ=false;}else{AQ=false;}}AO=true;}}L.call(this,AQ,AN);this.set("enabled",AO>0);}},dataWidgetBuilder:function(AO){var AR=null;if(AO.col.isMultiForm){AR={scriptClass:"mstrmojo.Box",cssClass:"multiform-attribute-index-box",at:null,children:[{scriptClass:"mstrmojo.ImageCheckBox",markupString:'<span id="{@id}" class="mstrmojo-CheckBox mstrmojo-ImageCheckBox {@cssClass}" style="{@cssText}" title="{@tooltip}"><input id="{@id}_input" class="{@cssClass}" type="{@type}" name="{@name}" value="{@value}" tabIndex="{@tabIndex}" mstrAttach:click tstid="{@tstid}"/><label for="{@id}_input">{@label}</label></span>',alias:"mfaIndexControl",bindings:{checked:"this.parent.data.col.indexOn"},state:AA.NON,getHeaderCheckBox:function(){return this.parent.dataGrid._headerWidgets_[e];},oncheckedChange:function AQ(AU){this.parent.data.col.indexOn=AU.value;this.parent.dataGrid._headerWidgets[e].enabled=true;},onstateChange:function(){B.removeClass(this.inputNode,[AA.ALL,AA.NON,AA.PART]);B.addClass(this.inputNode,this.state);var AU=this.getHeaderCheckBox();AU.updateState();},onclick:function AS(){if(this.state===AA.ALL){this.set("state",AA.NON);this.set("checked",false);}else{this.set("state",AA.ALL);this.set("checked",true);}var AV=this.parent.formsList.children,AW=this.checked;k.forEach(AV,function AU(AX){if(AX.enabled){AX.set("checked",AW);}});AG.raiseEvent({name:"searchIndexChange"});},updateByForms:function AN(){var AW=this.parent.formsList.children,AX=false,AV=true,AY=true;k.forEach(AW,function AU(AZ){if(AZ.enabled){if(AZ.checked){AX=true;AY=false;}else{AV=false;}}});L.call(this,AV,AY);this.set("checked",AX);}},{scriptClass:"mstrmojo.Box",cssClass:"attribute-forms-index-list",alias:"formsList",children:[]}]};var AK,AJ=AR.children[1],AT=AO.col.subColumns,AM=false,AL=true,AP=true,AI;for(AK=0;AK<AT.length;AK++){AJ.children.push({scriptClass:"mstrmojo.ImageCheckBox",checked:AT[AK].indexOn,afidx:AK,enabled:true,oncheckedChange:function AQ(AU){AO.col.subColumns[this.afidx].indexOn=AU.value;},onclick:function AS(){this.parent.parent.mfaIndexControl.updateByForms();AG.raiseEvent({name:"searchIndexChange"});}});if(!z(AT[AK].dtp)){AJ.children[AK].cssText="visibility:hidden;";AJ.children[AK].enabled=false;}else{AM=true;if(AT[AK].indexOn){AP=false;}else{AL=false;}}}if(AP){AI=AA.NON;}else{if(AL){AI=AA.ALL;}else{AI=AA.PART;}}AR.children[0].state=AI;AR.children[0].cssClass=AI;if(!AM){AR.cssText="visibility:hidden;";AR.children[0].enabled=false;}}else{if(z(AO.col.dtp)){AR={scriptClass:"mstrmojo.ImageCheckBox",bindings:{checked:"this.parent.data.col.indexOn"},getHeaderCheckBox:function(){return this.dataGrid._headerWidgets_&&this.dataGrid._headerWidgets_[e];},oncheckedChange:function AQ(AU){this.parent.data.col.indexOn=AU.value;this.dataGrid._headerWidgets[e].enabled=true;},onclick:function(){var AU=this.getHeaderCheckBox();AU.updateState();AG.raiseEvent({name:"searchIndexChange"});}};}}return AR;},dataFunction:function(){return"";}};return AF;}function a(AF){return AF===AC.Attribute&&mstrApp.getRootController().allObjectsController.isCubeConfigEnabled();}mstrmojo.DI.DIAllObjectsGrid=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo._HasOwnAvatar,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIAllObjectsGrid",type:null,resizableColumns:false,lockHeader:true,multiSelect:true,selectionPolicy:"reselect",draggable:true,dropZone:true,allItems:null,sortFlag:true,markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,click><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',isDragValid:function c(){return true;},allowDrop:function E(AF){var AG=false;if(AF.action===x&&this.type===AC.Metric){AG=true;}else{if(AF.action===G&&this.type===AC.Attribute){AG=true;}}return AG;},createAvatar:function d(AJ){var AL=S(this.type);var AF=document.createElement("div");var AN=R.findAncestorByName(AJ,"tr",true,this.domNode);if(AN){var AH=this.sortSelectedIndices(),AI=this.domNode.getElementsByTagName("tr"),AM,AG;k.forEach(AH,function(AO){AM=1+parseInt(AO,10);AG=AI[AM];AF.appendChild(AG.children[AL].firstChild.cloneNode(true));});}var AK=document.createElement("div");AF.appendChild(AK);AF.className="mstrmojo-all-objects-avatar";AK.className="avatar-hint";return AF;},createCols:function o(){var AF=[];if(a(this.type)){AF.push(Q.call(this,30));}AF.push(F.call(this,50));AF.push(N.call(this,20));this.columns=AF;},filterItems:function n(AI){var AH=this;if(AI===undefined){AI=this.searchPattern;}if(AI===undefined){return ;}var AF=k.filter(this.allItems,function AG(AK){var AJ=AK.n.toLowerCase();var AL=AI.toLowerCase();return ~AJ.indexOf(AL);});this.set("searchPattern",AI);this.set("items",AF);this.sort("n",this.sortFlag);setTimeout(function(){if(AH.type===AC.Attribute&&AH._headerWidgets_){AH._headerWidgets_[e].updateState();}});},getAllItems:function I(){return this.allItems;},getCellWidget:function A(AG,AF){var AH=this.itemsContainerNode.firstChild;var AI=AH.rows[AG];if(AI){return mstrmojo.dom.findWidget(AI.cells[AF].firstChild);}},getDragAction:function T(){return this.type===AC.Attribute?x:G;},getDragData:function m(AG){var AH=R.eventTarget(AG.src.hWin,AG.src.e);var AF=this.listMapper.findIndex(this,this.itemsContainerNode,AH);if(AF>=0&&this.selectedIndices[AF]!==true){this.raiseEvent({name:"beginSelectionItem"});this.singleSelect(AF);}return this.getSelObjs();},getSearchIdxes:function q(){var AF=this.items;var AK=AF.length;var AJ=[];var AH,AI,AG;for(AI=0;AI<AK;AI++){AH=AF[AI].col;if(!AH.isMultiForm){if(AH.indexOn){AJ.push({atid:AH.id,afid:AH.fmid});}}else{for(AG=0;AG<AH.subColumns.length;AG++){if(AH.subColumns[AG].indexOn){AJ.push({atid:AH.id,afid:AH.subColumns[AG].fmid});}}}}k.forEach(k.difference(this.allItems,this.items),function(AM){var AL=AM.col;if(!AL.isMultiForm){if(AL.indexOn){AJ.push({atid:AL.id,afid:AL.fmid});}}else{for(AG=0;AG<AL.subColumns.length;AG++){if(AL.subColumns[AG].indexOn){AJ.push({atid:AL.id,afid:AL.subColumns[AG].fmid});}}}});return AJ;},getSelObjs:function f(){var AG=this.getSelectedItems();var AF=[];k.forEach(AG,function(AH){AF.push(AH.col);});return AF;},init:function(AF){if(this._super){this._super(AF);}this.model=mstrApp.getRootController().model;this.createCols();this.updateItems();this.model.attachEventListener("CurrentSourceChanged",this.id,"updateItems");this.model.attachEventListener("MappingsFetched",this.id,"updateItems");},initSearchIndex:function P(AJ){var AG=this.items;var AK=AG.length;var AH,AI;for(AH=0;AH<AK;AH++){var AF=this.getCellWidget(AH,e);if(AF){if(AG[AH].col.isMultiForm){AI=AJ?AA.ALL:AA.NON;AF.mfaIndexControl.set("state",AI);k.forEach(AF.formsList.children,function(AL){if(AL.enabled){AL.set("checked",AJ);}});AF.mfaIndexControl.set("checked",AJ);}else{AF.set("checked",AJ);}}}},itemFunction:function(AH,AF,AG){var AI=this._super(AH,AF,AG);AI.parent=AG;return AI;},oncontextmenu:function H(AP){R.preventDefault(window,AP.e);var AI=AD();var AG=R.eventTarget(AP.hWin,AP.e);var AO=this.listMapper.findIndex(this,this.itemsContainerNode,AG);if(AO>=0&&this.selectedIndices[AO]!==true){this.raiseEvent({name:"beginSelectionItem"});this.singleSelect(AO);}var AH=this.getSelObjs();var AF=R.eventTarget(AP.hWin,AP.e);var AM=R.findAncestorByName(AF,"tr",true,this.domNode);if(!AM){return ;}var AN=S(this.type);var AL=AM.children[AN].firstChild;var AK=R.findWidget(AL);if(AK.scriptClass==="mstrmojo.Box"){AK=AK.children[1];}AI.target=AK;AI.data=AH;AI.type=p.contextMenuType.ITEM_MENU;var AJ=AI.getMenuConfig();AJ.hostId=this.id;AJ.hostElement=AF;AJ.isHostedWithin=false;AJ.position=R.getMousePosition(AP.e,AP.hWin);this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:AJ}));},ondragenter:function K(AF){if(this._super){this._super(AF);}var AG=AF.src.widget;if(AG&&AG.updateAvatarHTML){AG.updateAvatarHTML(AF.action,this.type);}},ondragleave:function U(AF){if(this._super){this._super(AF);}var AG=AF.src.widget;AG.avatar.lastChild.innerHTML="";},ondrop:function j(AG){var AF=mstrApp.getRootController(),AJ=AG.src;if(AJ&&AJ.data){var AH=AJ.data;if(AG.action===x&&this.type===AC.Metric){AF.toMetric(AH);}else{if(AG.action===G&&this.type===AC.Attribute){AF.toAttribute(AH);}}var AI=AG.src.widget;AI.clearSelect();}},onmousedown:function l(AF){var AH=this.hightlightAttFormList;if(AH){AH.clearSelect();AH=null;}var AI=R.eventTarget(AF.hWin,AF.e);var AG=R.findAncestorByName(AI,"table",true,this.domNode);if(!AG){this.clearSelect();}},postBuildRendering:function w(AF){this._super(AF);R.attachMarkupEvent(this.id,this.domNode,"contextmenu");},premousedown:function Y(AF){if(AF.e.button===2){var AI=R.eventTarget(AF.hWin,AF.e);var AH=R.findAncestorByName(AI,"tr",true,this.domNode);var AG=R.findWidget(AH);if(AG.selected){return ;}}},preclick:function t(AI){if(R.isPrimaryMouseBtn(AI.e)){var AH=AI.hWin,AL=AI.e,AK=R.eventTarget(AH,AL),AG=this.listMapper.findIndex(this,this.itemsContainerNode,AK);if(AG>-1){var AF=this.multiSelect,AM=R.isMetaKey(AH,AL),AJ=R.shiftKey(AH,AL);if(AM||AJ){R.clearBrowserHighlights(AH);}this.raiseEvent({name:"beginSelectionItem"});if(AF&&(AM||(this.selectionPolicy==="toggle"))){this.toggleSelect(AG);}else{if(AF&&AJ){this.rangeSelect(AG);}else{this.singleSelect(AG);}}}}},rangeSelect:function X(AF,AH){var AK=this.selectedIndex,AG=AF,AL=AG-AK,AJ=1,AI=[];if(AG<AK){AJ=-1;AL=-AL;}while(AL>=0){AI.push(AK);AK=AK+AJ;AL--;}this.addSelect(AI,AH);},sort:function AE(AJ,AF){var AI=AF?1:-1;var AG=this.items;AG.sort(function AH(AL,AK){if(AL[AJ]>AK[AJ]){return AI;}return -AI;});this.set("items",AG.concat());},updateAvatarHTML:function AB(AG,AF){var AH="";if(AG===x&&AF===AC.Metric){AH=mstrmojo.desc(11805,"Convert to Metric");}else{if(AG===G&&AF===AC.Attribute){AH=mstrmojo.desc(11611,"Convert to Attribute");}}this.avatar.lastChild.innerHTML=AH;},updateItems:function h(){var AH=this,AG=g(this.type),AF=mstrApp.getRootController().allObjectsController;if(this.type===AC.Attribute){M(this.model,AG);}this.clearSelect();this.items=AG;this.sort("n",this.sortFlag);this.set("allItems",AG);setTimeout(function(){if(AH.type===AC.Attribute&&AH._headerWidgets_){AH._headerWidgets_[e].updateState();}});this.filterItems();AF.raiseEvent({name:"updateDistKey"});}});mstrmojo.DI.HeaderWidget=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.HeaderWidget",field:"",text:"",cm:[],menuController:null,tooltip:"",markupString:'<div id="{@id}" class="mstrmojo-di-headerwidget {@cssClass}" style="{@cssText}"><div class="header-text"></div><div class="header-menu"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"table":"none";}},markupSlots:{textNode:function(){return this.domNode.children[0];},menuNode:function(){return this.domNode.children[1];}},onexecuteCommand:function(AF){var AG=this.menuController;switch(AF.item.did){case"ASC":AG.sort(this.field,true);AG.sortFlag=true;break;case"DES":AG.sort(this.field,false);AG.sortFlag=false;break;default:break;}},children:[{slot:"textNode",alias:"text",scriptClass:"mstrmojo.Label",bindings:{text:"this.parent.text"}},{slot:"menuNode",alias:"menu",scriptClass:"mstrmojo.Button",onclick:function(){var AH=this.parent;var AG=new mstrmojo.DI.DIAllObjectsHeaderMenu();AG.target=AH;AG.cm=AH.cm;AG.type=p.contextMenuType.ITEM_MENU;AG.position=R.position(this.domNode,true);var AF=AG.getMenuConfig();AF.hostId=AH.id;AF.hostElement=this.domNode;AF.isHostedWithin=false;AF.position=AG.position;AH.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:AF}));}}]});mstrmojo.DI.DIAllObjectsHeaderMenu=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIAllObjectsHeaderMenu",queryVisible:function W(AF){if(AF.did==="ASC"||AF.did==="DES"){return true;}else{return false;}},queryEnabled:function D(AF){if(AF.did==="ASC"||AF.did==="DES"){return true;}else{return false;}},queryChecked:function b(){return false;},executeCommand:function(AF){this.target.raiseEvent({name:"executeCommand",src:this.target,item:AF});}});mstrmojo.DI.DIAllObjectsSourceLabel=mstrmojo.declare(mstrmojo.Label,null,{scriptClass:"mstrmojo.DI.DIAllObjectsSourceLabel",useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,top:-32},src:null,total:0,postBuildRendering:function Z(){var AG=mstrmojo.desc(14029,"Exists in #### of @@@@ tables");if(!this.src){return this._super();}AG=AG.replace("####",this.src.length).replace("@@@@",this.total);AG+="</br>";AG+=this.src.join("</br>");var AF={cssClass:"vi-regular vi-tooltip-C",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,content:AG,top:-6,left:50};this.set("richTooltip",AF);return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.qb.DBTableView","mstrmojo.qb.EnumDataChangeEvents","mstrmojo.qb.EnumDragActions","mstrmojo.qb.EnumMenuActions","mstrmojo.dom","mstrmojo.hash","mstrmojo.array");var E=mstrmojo.dom,O=mstrmojo.hash,J=mstrmojo.array,S=mstrmojo.css,C=mstrmojo.string,F="px",T=mstrmojo.DI.DIConstants,L=16,M=260+4,D=175;function B(Y,W){var U,X,V=false;if(!Y||!W){return false;}U=parseInt(Y.x,10);X=parseInt(Y.y,10);O.forEach(W,function(j){var e,d,g,c;var a=0,b=0,f=0,Z=0;if(!j.x||!j.y){return ;}e=parseInt(j.x,10);d=parseInt(j.y,10);g=parseInt(j.w,10);c=parseInt(j.h,10);if(isNaN(g)){g=D;}if(isNaN(c)){c=M;}a=e>U?e:U;b=d>X?d:X;f=(e+g)<(U+D)?(e+g):(U+D);Z=(d+c)<(X+M)?(d+c):(X+M);if(a<=f&&b<=Z){V=true;return false;}});return V;}mstrmojo.DI.DIMappingTableContainer=mstrmojo.declare(mstrmojo.qb.TableContainer,null,{scriptClass:"mstrmojo.DI.DIMappingTableContainer",dropZone:false,joinInfos:null,clickedNode:null,postCreate:function A(){if(this._super){this._super();}var U=this.parent.model;U.attachEventListener("CurrentSourceChanged",this.id,"updateSelected");U.attachEventListener("MappingsFetched",this.id,"update");U.attachEventListener("scrollToTable",this.id,"showTable");this.attachEventListener("allTableSelectionClear",this.id,"clearAllTableSelection");},postBuildRendering:function R(){var U=this;if(this._super){this._super();}window.setTimeout(function(){U.update();},0);},clearAllTableSelection:function I(U){J.forEach(this.children,function(V){if(U&&U.source&&U.source.id===V.tableData.id){return true;}else{V.clearRowSelections();}});},recordTableData:function K(){var X=this.children;var V=E.position(this.containerNode),a,U,b,W={},Y,Z;J.forEach(X,function(c){var d=null;if(c.domNode){d=E.position(c.domNode);}Y=c.tableData.id;if(d){U=d.x-V.x;b=d.y-V.y;if(U<0){return false;}a={x:(U+F),y:(b+F),w:d.w,h:d.h,shouldExpand:c.isExpanded};if(c.attrRows&&c.attrRows.domNode){Z=c.attrRows.domNode;a.attrRowsScroll=Z.scrollTop;a.attrRowsHeight=Z.clientHeight;}if(c.metricRows&&c.metricRows.domNode){Z=c.metricRows.domNode;a.metricRowsScroll=Z.scrollTop;a.metricRowsHeight=Z.clientHeight;}W[Y]=a;}else{W[Y]=null;}});return W;},selectLinkedAttribute:function P(g){var e=g.alias,Y=g.oid,c,a,W,h,Z=this.joinInfos&&this.joinInfos.joins,f,V,b,X,d,U;if(g.source&&g.source.tableData){b=this.findTableById(g.source.tableData.id);if(g.oid){b.selectItemById(g.oid);}else{if(g.alias){b.selectItemByName(g.alias);}}}if(Z){for(c=0;c<Z.length;c++){W=Z[c];h=W.links;for(a=0;a<h.length;a++){if(h[a].source.alias===e){f=h[a].source.tableId;V=h[a].target.tableId;b=this.findTableById(f);X=this.findTableById(V);if(Y){if(b){d=b.selectItemById(Y);}if(X){U=X.selectItemById(Y);}}else{if(e){if(b){d=b.selectItemByName(e);}if(X){U=X.selectItemByName(e);}}}if(U&&X&&d&&b&&(g.source.parent===X||g.source.parent===b)){if(h[a].source.tp===12&&h[a].target.tp===12){this.parent.linker.drawLink(U,X,d,b);}}}}}}},findTableById:function N(V){var U;for(U=0;U<this.children.length;U++){if(this.children[U].tableData.id===V){return this.children[U];}}},updateSelected:function(){var W=this,U=this.parent.model,V;V=J.filter(W.children,function(X){return X.scriptClass==="mstrmojo.DI.DIMappingTable";});J.forEach(V,function(Z){var X=Z.tableData.id,Y=U.currentSource&&(U.currentSource.tableID===X);Z.set("selected",Y);S.toggleClass(Z.domNode,"selected",Y);});},onremoveChild:function(U){var W=U.value;for(var V=0;V<W.length;V++){W[V].destroy();}},update:function H(){var h,l,AA,X;var u,U,x,f,n=this.parent.model,Z,j=false,p,d,o,q=true;if(!this.hasRendered){return ;}p=this.domNode.scrollLeft;if(this.children){x=this.recordTableData();this.removeChildren();q=false;}var a=0;var V=function(k){return k.selected;};var Y=this.clickedNode;function t(k){var AB,m,AD={},AC=[],z=[];for(AB in k){m=k[AB].srcTableID||AB;if(!AD[m]){AD[m]=[];AC.push(m);}AD[m].push(AB);}J.forEach(AC,function(AE){z=z.concat(AD[AE]);});return z;}d=t(n.importSources);for(o=0;o<d.length;o++){u=d[o];if(!n.importSources[u].sourceInfo){continue;}if(n.importSources[u].currentTransformations&&n.importSources[u].currentTransformations.xtab&&n.importSources[u].currentTransformations.xtab.isCrosstab){f=n.importSources[u].transformedMapping;}else{f=n.importSources[u].currentMapping;}h=mstrmojo.hash.clone(f);h=mstrmojo.array.filter(h,V);if(!h){continue;}l=n.importSources[u];AA=l.sourceInfo;X=AA.partition;U={n:AA.name,items:h,id:l.tableID,idx:a++,partition:X&&X.tables,type:l.type,subtype:l.subtype};if(U.subtype===T.sourceSubtype.searchOnSource){j=true;}var g=mstrApp.getRootController();if(U.subtype===T.sourceSubtype.hadoop&&g.model.isDirectDataAccess){j=true;}Z=null;if(q){if(l.tablePosition){Z={};if(l.tablePosition.x){Z.x=Math.max(l.tablePosition.x,0)+F;}if(l.tablePosition.y){Z.y=Math.max(l.tablePosition.y,0)+F;}if(l.tablePosition.w){Z.w=l.tablePosition.w+F;}if(l.tablePosition.h){Z.h=l.tablePosition.h+F;}}}if(!Z&&x){Z=x[u];}O.copy(Z,U);x=this.addTable(U,x);}for(u in n.importSources){if(!n.importSources[u].sourceInfo){continue;}if(n.importSources[u].currentTransformations&&n.importSources[u].currentTransformations.xtab&&n.importSources[u].currentTransformations.xtab.isCrosstab){f=n.importSources[u].transformedMapping;}else{f=n.importSources[u].currentMapping;}h=mstrmojo.hash.clone(f);h=mstrmojo.array.filter(h,V);if(!h){continue;}l=n.importSources[u];if(Y&&l.tableID===Y.tableId){var b,w,W=this.children;for(o=0;o<W.length;o++){if(W[o].tableData.id===Y.tableId){w=W[o];break;}}if(Y.tableRow.alias==="metricRows"){var c=w.metricRows.items;for(b=0;b<c.length;b++){if(Y.node.innerText&&c[b].alias===Y.node.innerText.replace("\xA0"," ")){w.metricRows.raiseEvent({name:"selectLinkedItems",source:w.metricRows,oid:c[b].oid,alias:c[b].alias});}}}else{var e=w.attrRows.items;for(b=0;b<e.length;b++){if(Y.node.innerText&&e[b].alias===Y.node.innerText.replace("\xA0"," ")){w.attrRows.raiseEvent({name:"selectLinkedItems",source:w.attrRows,oid:e[b].oid,alias:e[b].alias});}}}}}if(this.children&&this.children.length>1){this.joinInfos={joins:this.addJoinInfos()};}this.domNode.scrollLeft=p;this.parent.set("disableNewTables",j);},addTable:function Q(V,U){var d=this;var b=V.id;var W=this.parent.model;var a=W.currentSource&&(W.currentSource.tableID===b),Y="",c,X,Z;if((V.x===undefined)||(V.y===undefined)){X=0;while(!c||B(c,U)){c={x:(X*209)+F,y:L+F};X++;}}if(c){V=O.copy(c,V);if(!U){U={};}U[b]=c;}Z=V.partition;if(Z&&Z.length>1){Y="partition-group";}d.addChildren([new mstrmojo.DI.DIMappingTable({alias:"table",tableData:V,left:V.x,top:V.y,height:V.h,width:V.w,shouldExpand:V.shouldExpand,attrRowsScroll:V.attrRowsScroll,metricsScroll:V.metricRowsScroll,attrRowsHeight:V.attrRowsHeight,metricRowsHeight:V.metricRowsHeight,model:W,linker:this.parent.linker,selected:a,cssClass:a?"selected":"",group:Y,convertEnabled:V.subtype!==T.sourceSubtype.hanaSingleTable,initSelectNode:V.initSelectNode})]);return U;},addJoinInfos:function(){var W,V;var X=[],U;for(W=0;W<this.children.length;W++){for(V=W+1;V<this.children.length;V++){U=this.findCommonRows(this.children[W],this.children[V]);if(U&&U.length>0){X.push({targetTable:this.children[W],sourceTable:this.children[V],links:U});}}}return X;},findCommonRows:function(a,Y){var Z=a.attrRows.items,X=Y.attrRows.items,V=a.metricRows.items,U=Y.metricRows.items,W=[];J.forEach(Z,function(b){J.forEach(X,function(c){if(b.oid&&c.oid&&b.oid===c.oid){W.push({target:b,source:c});}});});J.forEach(V,function(b){J.forEach(U,function(c){if(b.alias&&c.alias&&b.alias===c.alias){W.push({target:b,source:c});}});});return W;},showTable:function G(f){var a=f.value,Z=null,j,X,V,c,Y,U,W,b,d,h,g,e;J.forEach(this.children,function(k){if(k.tableData.id===a){Z=k;return false;}});if(!Z){return ;}j=Z.domNode;X=j.style;V=parseInt(X.left);c=parseInt(X.top);if(V<0||c<0){return ;}Y=j.offsetWidth;U=j.offsetHeight;W=this.domNode;b=W.style;d=parseInt(b.width);h=parseInt(b.height);g=W.scrollLeft;e=W.scrollTop;if(V-g<0||V-g+Y>d){W.scrollLeft=V;}if(c-e<0||c-e+U>h){W.scrollTop=c-L;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.ui.dialogs.DISaveAsDialog");mstrmojo.requiresDescs(1442,3415,3416,12376,12377,12925);var D=mstrmojo.desc;var B;mstrmojo.qb.QBHelpers={showSaveAsDialog:function A(J,I){var E=0,H=-1,F=-2;var G;G=B&&mstrmojo.all[B];if(!G){G=new mstrmojo.DI.ui.dialogs.DISaveAsDialog();B=G.id;}G.set("name",I.name||"");G.set("desc",I.desc||"");G.set("saveParams",{});G.set("retainPrevFolder",true);if(mstrApp.cubeSaveFolderId){G.set("rootFolderID",mstrApp.cubeSaveFolderId);}G.saveAs=function(K){var L=G.zIndex+2;this.validateInput(K,function(M){var N={folderID:G.folderID,objDesc:G.desc||"",objName:G.name||"",saveAsOverwrite:G.saveAsOverwrite,objPath:G.getObjectPath()};switch(M){case E:G.close();J.onOK(N);break;case H:mstrmojo.alert(D(12376,"Please enter a valid cube name"),null,"",L);break;case F:mstrmojo.confirm(mstrmojo.desc(12925,"The name ## already exists. Do you want to replace the existing one?").replace("##",this.name),{confirmBtn:{fn:function(){G.close();J.onOK(N);}}},{title:D(12377,"Saving cube with the same name"),zIndex:L});break;}});};G.open();return G;},clone:function C(I){if(!I){return null;}var K;if(I.constructor===Array){K=I.concat();var J=K[0];if(J&&typeof J==="object"){var E=K.length,H;for(H=0;H<E;H++){K[H]=this.clone(I[H]);}}}else{K={};var G,F;for(G in I){if(G==="parent"){continue;}F=I[G];if(F&&typeof F==="object"){K[G]=this.clone(F);}else{K[G]=F;}}}return K;}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.DI.DIDragFiles","mstrmojo.DI.DIProjectsMenu");mstrmojo.requiresDescs(12783,13091,13092,13093,13094,13095);var M=mstrmojo.array,H=mstrmojo.dom,E,F,G;mstrmojo.DI.DIRemoteProjects=mstrmojo.declare(mstrmojo.DI.DIDragFiles,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIHadoop",supportFolderDrag:false,sizeTooltip:false,createTitleWidget:function B(){var U={dbRoleName:mstrmojo.desc(13091,"Choose a connection"),children:[{scriptClass:"mstrmojo.Label",cssClass:"di-connector-projects-title",bindings:{text:"this.parent.dbRoleName"}},{scriptClass:"mstrmojo.Pulldown",alias:"dbRoleList",popupToBody:true,itemField:"dbrn",itemIdField:"dbrid",defaultText:mstrmojo.desc(13092,"Select a MicroStrategy Project"),bindings:{popupZIndex:"this.parent.parent.zIndex"},onvalueChange:function(){var W=this,V=W.selectedIndex;E=W.items[V].dbrn;F=W.items[V].dbrid;G.projectController.getProjectSourceFolderId(F);}},{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title-menu-connection",onclick:function(W){if(!F){return ;}var X=this.menuHelper;if(!X){X=new mstrmojo.DI.DIProjectsMenu();}X.data=F;var V=X.getMenuConfig();V.hostId=this.parent.parent.parent.parent.parent.id;V.hostElement=W.target||H.eventTarget(W.hWin,W.e);V.position=H.position(V.hostElement,true);V.isHostedWithin=false;V.hostProxyCssClass="item-mn-proxy";this.parent.parent.parent.parent.parent.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:V}));}},{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title-add-connection",onclick:function(){G.projectController.renderDBRoleEditor();}}]};return new mstrmojo.HBox(U);},ondrop:function S(V){if(!this.droppable){return ;}var a=V.src.data,Y,W,U=mstrApp.getRootController(),X=this.urls;if(U.model.isDirectDataAccess&&(X.length+a.length)>1){var Z=mstrmojo.desc(13093,"A dataset can have only a single MicroStrategy Cube. Please create another dataset to import the second MicroStrategy cube.");U.displayError(Z,false);return ;}for(W=0;W<a.length;W++){Y=a[W];this.addURL(Y.data.address,Y.text,Y.data.isFolder);}},filterType:["folder","emmaCube"],browseFunction:function D(U){return mstrApp.getRootController().projectSourceBrowserFunction(U.data.browser,U.data.address,F);},refreshFunction:function K(U){if(!U){this.getObjectBrowser().set("fileList",[]);return ;}this.getObjectBrowser().clickedNode=this.mainPage.content.objectListPanel.browser.fileTree;return mstrApp.getRootController().projectSourceBrowserFunction(this.getObjectBrowser(),U,F);},preBuildRendering:function C(){if(this._super){this._super();}this.model.attachEventListener("projectsDBRoleLoaded",this.id,this.projectsDBRoleLoaded);this.model.attachEventListener("getFolderId",this.id,this.projectsFolderIdLoaded);this.model.attachEventListener("DBRoleLoadedById",this.id,this.projectDBRoleLoadedById);this.model.attachEventListener("projectDBRoleSaved",this.id,this.handleDBRoleSaved);this.model.attachEventListener("deleteDBRole",this.id,this.deleteDBRole);this.model.attachEventListener("DuplicateDBRole",this.id,this.duplicateDBRole);this.model.attachEventListener("getFolderIdFailure",this.id,this.getFolderIdFailure);this.getDropZone().set("text",mstrmojo.desc(13094,"Drag and Drop a Cube"));G=mstrApp.getRootController();G.projectController.loadRemoteProjectsDBRole();G.model.isDirectDataAccess=true;var U={success:function(V){if(V&&V.msgid){G.dataService.set("messageID",V.msgid);G.model.resetImportSource();}mstrApp.hideProgress();},failure:function(V){G.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,V.message||"");}};G.createNewReportInstance(U);},getFolderIdFailure:function O(){this.refreshFunction();},deleteDBRole:function L(){var W=this.getTitleWidget(),V=W.dbRoleList.items;var U=M.find(V,"dbrid",F);if(U!==-1){V.splice(U,1);W.dbRoleList.set("items",V);W.dbRoleList.set("selectedIndex",-1);W.dbRoleList.set("text",mstrmojo.desc(13092,"Select a MicroStrategy Project"));F="";this.refreshFunction();}else{this.set("defaultSelection",U);}},duplicateDBRole:function R(){G.projectController.duplicate();},handleDBRoleSaved:function I(V){var Y=this.getTitleWidget(),W=Y.dbRoleList.items,X=V.data;var U=M.find(W,"dbrid",X.dbrid);if(U===-1){W.push(X);Y.dbRoleList.set("items",W);Y.dbRoleList.set("defaultSelection",W.length-1);Y.dbRoleList.set("text",W[W.length-1].dbrn);Y.dbRoleList.set("selectedIndex",W.length-1);F=X.dbrid;}else{this.set("defaultSelection",U);}G.projectController.getProjectSourceFolderId(F);},projectsFolderIdLoaded:function J(V){var U=V.data.fid;this.refreshFunction(U);},projectDBRoleLoadedById:function P(){var V=mstrApp.getRootController().projectController;var U=V.dbRole;V.renderDBRoleEditor(U);},projectsDBRoleLoaded:function N(V){var W=V.data;if(W){var X=this.getTitleWidget(),Y=G.projectController.dbRoleID;X.dbRoleList.set("items",W);if(Y){var U=M.find(W,"dbrid",Y);X.dbRoleList.set("text",W[U].dbrn);X.dbRoleList.set("selectedIndex",U);F=Y;G.projectController.getProjectSourceFolderId(Y);}else{X.dbRoleList.set("selectedIndex",-1);X.dbRoleList.set("text",mstrmojo.desc(13092,"Select a MicroStrategy Project"));F="";this.refreshFunction();}}},onHelpButtonClick:function Q(){return"importing_a_microstrategy_file.htm";},onFinishButtonClick:function T(){var U=this.getDropZone(),W=[];mstrmojo.hash.copy(U.urls,W);var V={success:function(){G.getImportController().importProjects({success:function(){G.saveAndPublish();},failure:function(X){G.displayError(mstrmojo.desc(13095,"Error in importing the cube. Please check the cube being imported."),false,X.message);}},F,W[0]);},failure:function(X){G.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,X.message||"");}};G.duplicateSelectedDataset(V);},onBackButtonClick:function A(){var U=mstrApp.getRootController();U.showPage(mstrmojo.DI.DIConstants.pageType.dataSelection);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.ImageCheckBox","mstrmojo.DI.DIConstants","mstrmojo.DI.FileDragDropBox","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIDragFiles");mstrmojo.requiresDescs(531,12444,12512,12691,12733,12734,12811,12812,13133);var W=mstrmojo.DI.DIConstants,N=mstrmojo.DI.DIHelpers,E=N.isOperationMode,F=0,I=1,H=mstrmojo.array;function M(X){X=X.toLowerCase();X=X.replace(/\s+/g," ");return(X.indexOf("file://")===0)||(X.indexOf("ftp://")===0)||(X.indexOf("http://")===0)||(X.indexOf("https://")===0)||(X.indexOf("hdfs://")===0);}function J(X){var Y={protocolDisabled:false,protocol:""};if(!mstrApp.diParams.EnableURLImport){Y.protocolDisabled=true;Y.protocol="url";}else{X.toLowerCase();X.replace(/\s+/g," ");if(!mstrApp.diParams.EnableFileImport&&(X.indexOf("file://")===0)){Y.protocolDisabled=true;Y.protocol+="file://";}if(!mstrApp.diParams.EnableFTPImport&&(X.indexOf("ftp://")===0)){Y.protocolDisabled=true;Y.protocol+="ftp://";}if(!mstrApp.diParams.EnableHttpImport&&(X.indexOf("http://")===0)){Y.protocolDisabled=true;Y.protocol+="http://";}if(!mstrApp.diParams.EnableHttpImport&&(X.indexOf("https://")===0)){Y.protocolDisabled=true;Y.protocol+="https://";}}return Y;}function O(c){var b;var d=[];var a;if(this.mode===F){mstrmojo.hash.copy(this.urlList.urls,d);}else{mstrmojo.hash.copy(this.urlBrowse.getDropZone().urls,d);}var Y=mstrApp.getRootController();var X,e,Z;if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}if(this.mode===F){if(this.urlInput.value&&this.urlInput.value.length>0){d.push(this.urlInput.value);}}for(b=0;b<d.length;b++){Z=d[b].trim();d[b]=Z;if(!M.call(this,Z)){Y.displayError(mstrmojo.desc(12512,"We do not support the URL protocol you provided."),false);return ;}X=J.call(this,Z);if(X.protocolDisabled){e=mstrmojo.desc(12811,"Unable to fetch data. Importing files using #### has been disabled by the administrator.").replace("####",X.protocol);Y.displayError(e,false);return ;}}if(this.mode===F){a=this.urlList;}else{a=this.urlBrowse.getDropZone();}Y.importURLEMMA(a,d,true,!Y.model.hasEMMAReportInstance(),this.id,true,c,this.id);}mstrmojo.DI.DIURLUpload=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIURLUpload",cssClass:"mstrmojo-di-fu",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload {@cssClass}" ><div class="mstrmojo-di-URLUpload-networkBrowser"></div><div class="mstrmojo-di-URLUpload-label"></div><div class="mstrmojo-di-URLUpload-urlInput"></div><div class="mstrmojo-di-URLUpload-urlList"></div><div class="mstrmojo-di-URLUpload-info"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},networkBrowserNode:function(){return this.domNode.children[0];},labelNode:function(){return this.domNode.children[1];},urlInputNode:function(){return this.domNode.children[2];},urlListNode:function(){return this.domNode.children[3];},infoNode:function(){return this.domNode.children[4];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},oriFileExt:"",mode:F,singleURL:false,isRefreshPartition:false,init:function Q(Y){if(this._super){this._super(Y);}var Z={},X=Z[this.id]={};X.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(Z);},adjustSize:function D(X){var Z=parseInt(X.size.w,10),Y,a=Z/2-260,b;if(isNaN(Z)){return ;}Y=this.urlInputNode.children;Y[0].style.marginLeft=a+"px";Y[1].style.left=-a+"px";this.urlList.dnDNode.style.marginLeft=a+"px";this.urlList.countNode.style.right=(a+10)+"px";b=Math.round(Z*0.482);Y[2].style.width=b-127+"px";this.urlBrowse.adjustSize(X.size);},preBuildRendering:function C(){if(this._super){this._super();}this.urlBrowse.multiSelect=!this.singleURL;},onclick:function(X){var Z=mstrmojo.dom.eventTarget(X.hWin,X.e);var Y=this.urlInput;if(Z!==Y.domNode){Y.blur();}},postBuildRendering:function(){mstrmojo.dom.attachMarkupEvent(this.id,this.containerNode,"click");if(this._super){return this._super();}},onHelpButtonClick:function S(){return"importing_data_from_a_file.htm";},onNextButtonClick:function G(){O.call(this,this.tableID?W.actions.refreshData:W.actions.importSource);},onFinishButtonClick:function(){O.call(this,W.actions.savePublish);},onBackButtonClick:function A(){var X=mstrApp.getRootController();X.showPage(W.pageType.dataSelection);},updatePageConfig:function(Y){var c=this,a,b,d=[],X=this.urlList,Z=this.urlInput;if(Y&&Y.properties){mstrmojo.hash.forEach(Y.properties,function(f,e){c.set(e,f);});}this.set("isRefreshPartition",this.isRefreshPartitionTable());if(this.isRefreshPartition){a=this.tableID;b=this.model.importSources[a];H.forEach(b.sourceInfo.partition.tables,function(e){d.push(e.name||"");});}if(d.length>1){Z.set("value","");if(X.visible===false){X.set("visible",true);}H.forEach(d,function(e){X.addURL(e);});}else{Z.set("value",Y.name);}},setFilesObject:function(Y){if(Y.length>0){if(this.mode===F){var Z=mstrmojo.string.trim(this.urlInput.value);var X=mstrmojo.array.indexOf(Y,Z);if(X>=0){Y.splice(X,1);this.urlList.setURLsObject(Y);}else{this.urlInput.set("value","");this.urlList.setURLsObject(Y);}}else{this.urlBrowse.setURLsObject(Y);}}},onforceEnableChange:function(){mstrApp.getRootController().sourceSelected(this.forceEnable);},getOperationMode:function(){var X=this.model.operationMode;if(E(this.operationMode)){X=this.operationMode;}return X;},enableImport:function L(){var X=mstrApp.getRootController();if(this.urlList.urls.length>0||(this.urlInput.value&&this.urlInput.value!==""&&this.mode===F)||this.forceEnable===true){X.sourceSelected(true);}else{X.sourceSelected(false);}},onmodeChange:function V(){var X;if(this.mode===F){this.urlList.urls=[];this.urlList.removeChildren();for(X=0;X<this.urlBrowse.getDropZone().urls.length;X++){this.urlList.addURL(this.urlBrowse.getDropZone().urls[X]);}if(this.urlList.urls.length>0){if(this.urlList.visible===false){this.urlList.set("visible",true);}}}else{this.urlList.set("visible",false);this.urlBrowse.getDropZone().urls=[];this.urlBrowse.getDropZone().removeChildren();for(X=0;X<this.urlList.urls.length;X++){this.urlBrowse.getDropZone().addURL(this.urlList.urls[X],this.urlList.urls[X].substr(this.urlList.urls[X].lastIndexOf("/")+1));}}this.enableImport();},getURLs:function P(){var X=[];if(this.mode===F){X=this.urlList.urls.concat();if(this.urlInput.value.length>0){X.push(this.urlInput.value);}}else{X=this.urlBrowse.getDropZone().urls.concat();}H.forEach(X,function(Y,Z){X[Z]=Y.trim();});return X;},isRefreshPartitionTable:function U(){var b=this.getOperationMode(),Y,Z,X,a=false;if(b===W.operationMode.edit){Y=this.tableID;Z=this.model.importSources[Y];X=Z.sourceInfo.partition;a=!!X&&X.isPartition&&Z.xdaType===W.xdaType.text;}return a;},children:[{slot:"networkBrowserNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-fu-link",text:mstrmojo.desc(12733,"Network Browser"),alias:"urlRadioList",onclick:function(){if(this.parent.mode===F){this.parent.set("mode",I);this.set("text",mstrmojo.desc(12444,"File from URL"));}else{this.parent.set("mode",F);this.set("text",mstrmojo.desc(12733,"Network Browser"));}},bindings:{text:function(){if(this.parent.mode===I){return mstrmojo.desc(12444,"File from URL");}else{return mstrmojo.desc(12733,"Network Browser");}}}},{slot:"labelNode",scriptClass:"mstrmojo.Image",cssClass:"mstrmojo-di-fu-img",src:"../javascript/mojo/css/images/DI/crosstab.png",bindings:{visible:function(){return this.parent.mode===F;}}},{slot:"labelNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-fu-title",text:mstrmojo.desc(12691,"Data can be in crosstab or tabular format"),bindings:{visible:function(){return this.parent.mode===F;}}},{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",initValue:false,onvalueChange:function(){if(this._super){this._super();}this.parent.enableImport();},bindings:{visible:function(){return this.parent.mode===F;}},postBuildRendering:function(){this.emptyText=mstrmojo.desc(12812,"Supported URL format: #### ").replace("####",mstrmojo.DI.DIHelpers.getURLCaption());if(this._super){return this._super();}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",cssClass:"mstrmojo-di-fu-url-supported",bindings:{text:function(){return"Use original URL or update with a new URL to refresh this table.";},visible:function(){return this.parent.mode===F&&this.parent.getOperationMode()!==W.operationMode.create;}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",text:"",cssClass:"mstrmojo-di-fu-url-previously",bindings:{visible:function(){return this.text!==""&&!this.parent.isRefreshPartition&&this.parent.mode===F;}},postBuildRendering:function R(){if((E(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==W.operationMode.create){this.set("text",mstrmojo.desc(13133,"Previously uploaded URL:"));}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",text:"",cssClass:"mstrmojo-di-fu-url-info",bindings:{visible:function(){return this.text!==""&&!this.parent.isRefreshPartition&&this.parent.mode===F;}},postBuildRendering:function R(){var X=this.parent.model;var Z=this.parent.tableID;var a;if(this.currentSource){a=this.currentSource;}else{a=X.importSources[Z];}if((E(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==W.operationMode.create){var Y=a.sourceInfo.url;if(Y.length>90){this.set("text",Y.substring(0,65)+"..."+Y.substring(Y.length-20));}else{this.set("text",Y);}this.set("title",Y);}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",text:"",cssClass:"mstrmojo-di-url-browser-info",bindings:{visible:function(){return this.text!==""&&!this.parent.isRefreshPartition&&this.parent.mode===I;}},postBuildRendering:function R(){var X=this.parent.model;var Z=this.parent.tableID;var a;if(this.currentSource){a=this.currentSource;}else{a=X.importSources[Z];}if((E(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==W.operationMode.create){var Y=a.sourceInfo.url;if(Y.length>75){this.set("text",mstrmojo.desc(13133,"Previously uploaded URL:")+" "+Y.substring(0,50)+"..."+Y.substring(Y.length-20));}else{this.set("text",mstrmojo.desc(13133,"Previously uploaded URL:")+" "+Y);}this.set("title",Y);}}},{slot:"urlInputNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-add-url-button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(531,"Add"),onclick:function(){var X=this.parent.urlInput.value;if(X.length===0){return ;}if(this.parent.urlList.visible===false){this.parent.urlList.set("visible",true);}this.parent.urlList.addURL(X);this.parent.urlInput.set("value","");},bindings:{visible:function(){var X=this.parent;var Y=X.getOperationMode();var Z=true;if(Y===W.operationMode.create){Z=true;}else{Z=X.isRefreshPartitionTable();}return(this.parent.mode===F&&Z&&!X.singleURL);}}},{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",alias:"urlBrowseInput",cssClass:"mstrmojo-di-url-browse-input",initValue:false,onvalueChange:function(){if(this._super){this._super();}this.parent.enableImport();},bindings:{visible:function(){return this.parent.mode===I;}},preBuildRendering:function(){if(this._super){this._super();}this.emptyText=mstrmojo.desc(12812,"Supported URL format: #### ").replace("####",mstrmojo.DI.DIHelpers.getURLCaption());}},{slot:"urlInputNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-add-url-browse-button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(12734,"Enter"),onclick:function(){var X=this.parent.urlBrowse.getObjectBrowser();X.clickedNode=X.fileTree;mstrApp.getRootController().browseURLPath(this.parent.urlBrowseInput.value,this.parent.urlBrowse);},bindings:{visible:function(){return this.parent.mode===I;}}},{slot:"urlListNode",scriptClass:"mstrmojo.DI.FileDragDropBox",alias:"urlList",text:"",draggable:false,fileUpload:false,cssClass:"mstrmojo-di-url-box",bindings:{visible:function(){var Y=this.parent,Z=Y.getOperationMode(),X=this.urls.length>0&&Y.mode===F;X=X&&(Z===W.operationMode.create||Y.isRefreshPartitionTable());return X;}},getFilesCnt:function(){var X=0;if(this.parent.urlInput.value&&this.parent.urlInput.value!==""){X=this.urls?this.urls.length+1:1;}else{X=this.urls?this.urls.length:0;}return X;},getFileUrl:function(X){if(X<this.urls.length){return mstrmojo.string.trim(this.urls[X]);}if(this.parent.urlInput.value!==""){return mstrmojo.string.trim(this.parent.urlInput.value);}return"";},onurlsChange:function(){if(this._super){this._super();}this.parent.enableImport();if(this.updateItemsCount){this.updateItemsCount(this.getURLCnt());var X=this.getURLCnt();this.updateItemsCount(X);if(X>1&&X<5){this.countNode.style.marginTop=X*(-33)+"px";}else{if(X>=5){this.countNode.style.marginTop="-140px";}}}}},{slot:"urlListNode",scriptClass:"mstrmojo.DI.DIDragFiles",alias:"urlBrowse",supportFolderDrag:false,bindings:{visible:function(){return(this.parent.mode===I);}},postBuildRendering:function(){var X=this.parent,Z=X.getOperationMode(),Y=Z===W.operationMode.create||X.isRefreshPartitionTable();if(mstrmojo.DI.DIDragFiles.prototype.postBuildRendering){mstrmojo.DI.DIDragFiles.prototype.postBuildRendering.call(this);}this.set("multiSelect",Y);},ondrop:function T(X){if(!this.droppable){return ;}var Z=X.src.data,Y;for(Y=0;Y<Z.length;Y++){this.addURL(Z[Y].data.address,Z[Y].text,undefined,Z[Y].data.address);}mstrmojo.css.removeClass(this.dnDNode,"dragging");},browseFunction:function B(X){mstrApp.getRootController().urlBrowserFunction(X);},setURLsObject:function K(b){var a,d,Z;var c=[];var Y=this.mainPage.content.urlList;for(a=0;Y.children&&a<Y.children.length;a++){d=Y.children[a];c.push(d);}Z=c.length;for(a=0;a<Z;a++){Y.removeChildren(c[a]);}Y.urls=[];for(a=0;a<b.length;a++){var X=decodeURI(b[a].substr(b[a].lastIndexOf("/")+1));Y.addURL(null,X);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DIModel","mstrmojo.DI.DIDragFiles");mstrmojo.requiresDescs(12729,12741);var E=mstrmojo.DI.DIHelpers.isOperationMode,C=mstrmojo.DI.DIConstants,G=mstrmojo.array;function D(H,I){return H+"###path:"+I;}function B(I){var K=mstrApp.getRootController(),O=this.getDropZone(),L=O.urls,N=[],P=null,H=null,M=this.tableID||null,J;if(M&&L&&L.length>1){K.displayError(mstrmojo.desc(12741,"You can upload only one file when refresh a table."));return ;}for(J=0;L&&J<L.length;J++){P=L[J];H={n:P.n,desc:P.desc,query:D(P.address,(P.folderPath===undefined?"":P.folderPath)+"/"+P.n),type:P.type};if(!mstrApp.isSingleTier){H.data=P;}N.push(H);}if(!M){K.importMultiOAuthReports(this.sourceObjectsInfo.type,N,true,!K.model.hasEMMAReportInstance(),I,this.sourceObjectsInfo.subtype,this.id);}else{K.refreshDataOAuthReport(this.sourceObjectsInfo.type,this.sourceObjectsInfo.subtype,M,N[0],I);}}mstrmojo.DI.DISourceObjectsDnD=mstrmojo.declare(mstrmojo.DI.DIDragFiles,null,{scriptClass:"mstrmojo.DI.DISourceObjectsDnD",supportFolderDrag:false,canRefresh:true,userDisplayName:null,sizeTooltip:true,createTitleWidget:function(){var J=this,I=this.sourceObjectsInfo.type;var H={cssClass:"DISourceObjectsDnd-titleWidget cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"userInfo",postBuildRendering:function(){this.update();J.model.externalSources[J.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.update);},update:function(){var K=J.model.externalSources[J.sourceObjectsInfo.type],L=K&&K.userDisplayName;if(!K){return ;}if(K.userEmail){L+=" ("+K.userEmail+")";}this.set("text",L);this.set("title",L);}},{scriptClass:"mstrmojo.Button",cssClass:"refresh",title:mstrmojo.desc(773,"Refresh"),onclick:function(){var L=J.model.externalSources[J.sourceObjectsInfo.type],K=J.getObjectBrowser();mstrApp.getRootController().getOAuthSourceReports(I,false,null,null,{success:function(M){K.clickedNode=K.fileTree;L.populateReports(M,true);}});}},{scriptClass:"mstrmojo.Label",cssClass:"signOut",text:mstrmojo.desc(12729,"Sign Out..."),onclick:function(){mstrApp.getRootController().oAuthSignOut(I);}}]};return new mstrmojo.Box(H);},ondrop:function(H){var M=H.src.data,J=0,I,K=this.parent.parent.parent.sourceObjectsInfo.type,L;for(J=0;M&&J<M.length;J++){L=M[J].data;switch(K){case C.sourceType.salesforce:I="/"+(L.folderPath?L.folderPath+"/":"")+L.n;break;default:I=L.address;break;}this.addURL(L,L.n,undefined,I);}mstrmojo.css.removeClass(this.dnDNode,"dragging");},browseFunction:function(H){return mstrApp.getRootController().oAuthSourceBrowserFunction(this.sourceObjectsInfo.type,H);},autoSelectNode:function(J,K,H){var I=this.container;if(J.data.isFolder){J.data.browser.clickedNode=J;mstrApp.getRootController().oAuthSourceBrowserFunction(this.sourceObjectsInfo.type,J,K,H);}else{I.getDropZone().addURL(J.data,J.data.n);J.selectThisNode();mstrApp.getRootController().sourceSelected(true);}},postBuildRendering:function(){if(this._super){this._super();}this.model.externalSources[this.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.populate);this.model.attachEventListener("windowSizeChanged",this.id,this.changeSize);},populate:function(O){var Y=this.model.externalSources[this.sourceObjectsInfo.type].reports,V=mstrApp.getRootController().parseOAuthSourceFolder(this.sourceObjectsInfo.type,Y),I=this.model.operationMode,M=C.sourceType,N=this.getDropZone(),W=this.getObjectBrowser(),P,J,L,H,X,Q,U,K,S,T,R;if(O&&O.targetPageId){if(O.targetPageId!==this.id){return ;}}W.set("fileList",V);if(O&&O.isRefresh){return ;}if(E(this.operationMode)){I=this.operationMode;}if(I===C.operationMode.refresh||I===C.operationMode.edit){Q=null;if(this.tableID){Q=this.model.getImportSource(this.tableID);}if(this.currentSource){Q=this.currentSource;}if(Q){this.set("multiSelect",false);if(this.sourceObjectsInfo.type===M.salesforce){if(Q&&Q.sourceInfo&&Q.sourceInfo.url){P=Q.sourceInfo.url;J=P.substr(0,P.indexOf("###"));P=P.substr(P.indexOf("###")+"###path:".length);if(P.indexOf("undefined/")===0){P=P.substr("undefined/".length-1);}X=P.substr(P.lastIndexOf("/")+1);U=W.fileTree.items;for(T=0;T<U.length;T++){K=U[T].items;for(R=0;R<K.length;R++){S=K[R];if(S.n===X&&S.address===J){U[T].node.set("state",1);N.addURL(S.node.data,S.node.data.n);S.node.selectThisNode();}}}}}if(this.sourceObjectsInfo.type===M.dropbox){if(Q&&Q.sourceInfo&&Q.sourceInfo.url){K=U=W.fileTree.items;P=Q.sourceInfo.url;P=P.substr(P.indexOf("###")+"###path:".length);if(P.indexOf("undefined/")===0){P=P.substr("undefined/".length-1);}L=P.indexOf("/",1);if(L!==-1){H=P.substring(1,L);for(T=0;T<U.length;T++){if(U[T].isFolder===true&&U[T].n===H){W.autoSelectNode(U[T].node,P.substring(L));U[T].fetched=true;U[T].node.set("state",1);}}}else{X=P.substring(1);for(T=0;T<K.length;T++){if(K[T].isFolder!==true&&K[T].n===X){N.addURL(K[T].node.data,K[T].node.data.n);K[T].node.selectThisNode();}}}}}if(this.sourceObjectsInfo.type===M.googleDrive){if(Q&&Q.sourceInfo&&Q.sourceInfo.url){K=U=W.fileTree.items;P=Q.sourceInfo.url;J=P.substr(0,P.indexOf("###"));P=P.substr(P.indexOf("###")+"###path:".length);L=P.indexOf("/",1);while(L!==-1){H=P.substring(1,L);for(T=0;T<U.length;T++){if(U[T].isFolder===true&&U[T].n===H){W.autoSelectNode(U[T].node,P.substring(L),J);U[T].fetched=true;U[T].node.set("state",1);}}P=P.substr(L);L=P.indexOf("/",1);}X=P.substring(1);for(T=0;T<K.length;T++){if(K[T].isFolder!==true&&K[T].n===X&&K[T].address===J){N.addURL(K[T].node.data,K[T].node.data.n);K[T].node.selectThisNode();}}}}}}},onHelpButtonClick:function A(){var I=this.sourceObjectsInfo.type,H;switch(I){case C.sourceType.dropbox:H="importing_data_from_dropbox.htm";break;case C.sourceType.salesforce:H="Importing_data_from_salesforce.htm";break;case C.sourceType.googleDrive:H="importing_data_from_google_drive.htm";break;}return H;},onNextButtonClick:function(){B.call(this,this.tableID?C.actions.refreshData:C.actions.importSource);},onFinishButtonClick:function(){B.call(this,C.actions.savePublish);},onBackButtonClick:function F(){var H=mstrApp.getRootController();H.showPage(C.pageType.dataSelection);},handleImportError:function(J,I,K){var H=this.getDropZone();H.set("forceEnable",!K);G.forEach(J,function(M,L){if(I[L].success===true){H.removeURL(M.data);}});return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.DI.DIDragFiles");mstrmojo.requiresDescs(12512,12741,12744,12745,13030);function L(T){T=T.toLowerCase();T=T.replace(/\s+/g," ");return(T.indexOf("file://")===0)||(T.indexOf("ftp://")===0)||(T.indexOf("http://")===0)||(T.indexOf("https://")===0)||(T.indexOf("hdfs://")===0);}function K(T){var U={protocolDisabled:false,protocol:""};T.toLowerCase();T.replace(/\s+/g," ");return U;}function O(U){if(!U){return"";}var T,W,V;T=U.lastIndexOf("/")+1;W=U.indexOf("?op=");V=U.substring(T,W);return V;}function E(){var T=this.model;var U;if(this.currentSource){U=this.currentSource;}else{U=T.currentSource;}return U;}var S=mstrmojo.DI.DIConstants;function N(X){var Z,g=this.getDropZone(),d=this.tableID||null,e=[],c=g.urls;mstrmojo.hash.copy(g.urls,e);var a=mstrApp.getRootController();var Y=false;if(d&&c&&c.length>1){var T=this.model&&this.model.getImportSource(d);if(T&&T.sourceInfo&&T.sourceInfo.url){var b=T.sourceInfo.partition;if(b&&b.isPartition){Y=true;}}if(!Y){a.displayError(mstrmojo.desc(12741,"You can upload only one file when refresh a table."));return ;}}var f=true;var W,V;if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}for(Z=0;Z<e.length;Z++){var U=e[Z].trim();e[Z]=U;if(!L.call(this,U)){a.displayError(mstrmojo.desc(12512,"We do not support the URL protocol you provided."),false);return ;}W=K.call(this,U);if(W.protocolDisabled){V=mstrmojo.desc(13030,"Unable to fetch data. Importing files using ## has been disabled by the administrator.").replace("##",W.protocol);a.displayError(V,false);return ;}}a.importURLEMMA(g,e,f,!a.model.hasEMMAReportInstance(),this.id,true,X);}mstrmojo.DI.DIHadoop=mstrmojo.declare(mstrmojo.DI.DIDragFiles,null,{scriptClass:"mstrmojo.DI.DIHadoop",supportFolderDrag:true,sizeTooltip:true,folderSizeTooltip:true,controller:null,dbRoleSavedEvt:null,dbRoleLoadedEvt:null,createTitleWidget:function B(){var T={dbRoleName:"Hadoop Connection",cssClass:"di-hadoop-titleWidget",children:[{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title",bindings:{text:"this.parent.dbRoleName"}},{scriptClass:"mstrmojo.Label",text:"(##)".replace("##",mstrmojo.desc(12744,"Change Connection...")),cssClass:"di-connector-title-connection",onclick:function(){var U=mstrApp.getRootController(),V=U.hadoopController.dbRole;U.hadoopController.renderDBRoleEditor(V);}},{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title-refresh",onclick:function(){var U=mstrApp.getRootController(),V=U.hadoopController.dbRoleID;U.hadoopController.loadBDETypeDBRole(V);}}]};return new mstrmojo.Box(T);},ondrop:function R(U){if(!this.droppable){return ;}var Z=U.src.data,X,V,T=mstrApp.getRootController(),W=this.urls;if(T.model.isDirectDataAccess&&(W.length+Z.length)>1){var Y=mstrmojo.desc(12745,"Live mode Cube with multiple files or folders from HDFS is not supported yet. Please keep only one file or folder and remove others.");T.displayError(Y,false);return ;}for(V=0;V<Z.length;V++){X=Z[V];this.addURL(X.data.address,X.text,X.data.isFolder);}mstrmojo.css.removeClass(this.dnDNode,"dragging");},browseFunction:function D(T){return mstrApp.getRootController().hadoopController.hadoopBrowserFunction(T);},refreshFunction:function I(){mstrApp.getRootController().hadoopController.browseHadoop(this.rootUrl,this);},preBuildRendering:function C(){if(this._super){this._super();}this.controller=mstrApp.getRootController();var T=this.controller.hadoopController.dbRoleID;this.controller.hadoopController.loadBDETypeDBRole(T);},postBuildRendering:function Q(){if(this._super){this._super();}if(this.dbRoleSavedEvt){this.model.detachEventListener(this.dbRoleSavedEvt);}if(this.dbRoleLoadedEvt){this.model.detachEventListener(this.dbRoleLoadedEvt);}this.dbRoleSavedEvt=this.model.attachEventListener("HadoopDBRoleSaved",this.id,this.handleDBRoleSaved);this.dbRoleLoadedEvt=this.model.attachEventListener("BDEDBRoleLoaded",this.id,this.handleDBRoleLoaded);this.model.attachEventListener("windowSizeChanged",this.id,this.changeSize);this.controller.sourceSelected(false);},handleDBRoleSaved:function H(){var T=mstrApp.getRootController();var U=T.hadoopController.dbRoleID;T.hadoopController.loadDBRoleByID(U);},handleDBRoleLoaded:function M(){if(this.controller.rootView.currentPage.id!==this.id){return ;}var T=this.controller.hadoopController;var W=T.dbRoleID;if(W){var U=T.hadoopConnURL;this.setRootURL(U);this.refreshBrowser();this.setFilesForRefreshData();var V=this.getTitleWidget();V.set("dbRoleName",T.dbRole.n);}else{T.renderDBRoleEditor();}},setFilesForRefreshData:function G(){var V=this.tableID;var W=this.model&&this.model.getImportSource(V);if(W&&W.sourceInfo&&W.sourceInfo.url){var X=W.sourceInfo.url;var T=W.sourceInfo.partition;var Y=this.getDropZone();if(T&&T.isPartition){var U;for(U=0;U<T.tables.length;U++){Y.addURL(T.tables[U].name,O(T.tables[U].name),false);}}else{Y.addURL(X,O(W.sourceInfo.name),false);}}},onHelpButtonClick:function P(){return"importing_data_from_a_Hadoop_file_browser.htm";},onNextButtonClick:function J(){N.call(this,this.tableID?S.actions.refreshData:S.actions.importSource);},onFinishButtonClick:function(){N.call(this,S.actions.savePublish);},onBackButtonClick:function A(){this.controller.showPage(S.pageType.dataSelection);},setFilesObject:function F(U){var T=this.getDropZone();T.setURLsObject(U);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.LevelDataGrid","mstrmojo.DI.DIMappingItem","mstrmojo.string");var E=mstrmojo.array,C=mstrmojo.dom,J=mstrmojo.Widget;var D=200;var F=22;function I(P,L,M){var K=P[this.dataField];var N="mapping-column",O=mstrmojo.DI.DIHelpers.encodeData(K);if(K===null){O="";}if(this.tag.selected){N+={"12":" Attribute","4":" Metric"}[this.tag.tp];}N+=(L%2===1)?" odd":" even";if(0===this.tag.tp||false===this.tag.selected){O="";}return'<div class="'+N+'" title="'+O+'">'+O+"</div>";}function A(P,N,O){var K="";if(P.isLinked){K+="linked ";}if(P.isAttributeForm){K+="attrForm";}var R=P.isLinked;var M=false;if(R){var Q=mstrApp.getRootController().model.findMappingItem(P);var L;for(L=0;L<Q.length;L++){if(Q[L].georole){M=true;break;}}}return{tag:P,headerWidget:{scriptClass:"mstrmojo.DI.DIMappingItem",data:P,allowEdit:this.hasContextMenu,name:P.isAttributeForm?P.alias+"@"+P.fmn:P.alias,type:P.tp,georole:P.georole||M,timerole:P.timerole,_allowDnD:false,cssClass:K},dataField:N.toString(),colWidth:O,colCss:O===F?"NotImported":"mapping-column",applyStyle2Cell:O===F,dataFunction:I};}function H(K){if(!this.model||!this.model.mappings){return false;}var O=K.src,P=O&&O.data,N=P&&P.resizingIdx;var L=N-1;if(N&&N>0){var M=this.model.mappings[N];var Q=this.model.mappings[L];if(0===M||false===M.selected||(L>=0&&(0===this.model.mappings[L].tp||false===Q.selected))){return false;}}return true;}mstrmojo.DI.DIMappingPreview=mstrmojo.declare(mstrmojo.DI.LevelDataGrid,null,{scriptClass:"mstrmojo.DI.DIMappingPreview",cssClass:"lockHeader mstrmojo-di-mappingpreview",lockHeader:false,hasContextMenu:true,model:null,markupMethods:{onheightChange:function(){var K=this.height,L=parseInt(K,10);if(isNaN(L)||L<0){return ;}if(K){this.domNode.style.height=K;}this.widgetResized();},onwidthChange:function(){var L=this.width,K=parseInt(L,10);if(isNaN(K)||K<0){return ;}if(L){this.domNode.style.width=L;}this.widgetResized();},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},oncontentWidthChange:function(){var M=this.contentWidth||this.width,L=this.domNode,K=this.itemsContainerNode;if(M&&L&&K){if(M==="auto"&&this.parent.containerNode.clientWidth>40){M=this.parent.containerNode.clientWidth-40+"px";}L.style.width=M;K.style.width=M;}}},postBuildRendering:function(){var K=this;if(this._super){this._super();}window.setTimeout(function(){var L=K.domNode,N=K.scrollboxNode,M=K.headerContainerNode;if(L.offsetHeight>=M.offsetHeight){N.style.height=L.offsetHeight-M.offsetHeight+"px";}K.widgetResized();C.attachEvent(N,"scroll",function(){if(M.scrollLeft!==N.scrollLeft){M.scrollLeft=N.scrollLeft;}});C.attachEvent(M,"scroll",function(){if(N.scrollLeft!==M.scrollLeft){N.scrollLeft=M.scrollLeft;}});},0);},setDimensions:function(O,M){var L=parseInt(O,10);var N=parseInt(M,10);var K=this.itemsContainerNode;var P=this.scrollNode;if(isNaN(L)||isNaN(N)){return ;}this.set("height",Math.max((L-4),0)+"px");this.set("width",Math.max((N-4),0)+"px");if(K){K.style.width=Math.max((N-4),0)+"px";}if(P){P.style.height=Math.max((L-25),0)+"px";P.style.width=Math.max((N-4),0)+"px";}if(this._super){return this._super(O,M);}},isDragValid:function G(K){if(!H.call(this,K)){return false;}if(this._super){return this._super(K);}},ondragstart:function B(K){if(!H.call(this,K)){return false;}if(this._super){return this._super(K);}},populatePreview:function(){if(!this.model||!this.model.mappings){return ;}var T=this.model.mappings;var S=this.model.dataset;var W=0,P=0,K,R,Q,M,X;var Y=function(b){return b.selected;};P=this.scrollNode&&this.scrollNode.scrollLeft;this.unrender();this.refresh();var L=this.parent&&this.parent.domNode;if(!L){return ;}var V=this.parent&&this.parent.previewNode;var U=V?V.clientWidth:parseInt(this.contentWidth);var Z=this.countNotIMColumn();var a=(T.length-Z)*D+Z*F;var O=U>a?U:a;O-=2;var N=Math.floor((O-Z*F)/(T.length-Z));this.columns=[];X=mstrmojo.hash.clone(T);X=mstrmojo.array.filter(X,Y);E.forEach(X,function(b){Q=A.call(this,b,b.dataIdx,0===b.tp||false===b.selected?F:N);K=b.subColumns;if(K&&K.length>1){Q.dataField=null;Q.dataFunction=null;M=Q.subColumns=[];E.forEach(K,function(c){R=A.call(this,c,c.dataIdx,0===b.tp||false===b.selected?F:N/K.length);M.push(R);W++;});}else{W++;}this.columns.push(Q);},this);this.items=S;this.render();if(this.scrollNode&&P!==undefined){this.scrollNode.scrollLeft=P;}if(this.headerContainerNode&&P!==undefined){this.headerContainerNode.scrollLeft=P;}},countNotIMColumn:function(){var K=0;var L=this.model.mappings;E.forEach(L,function(M){if(0===M.tp||false===M.selected){K++;}});return K;},onvisibleChange:function(K){if(K.value){this.populatePreview();}},getMappingColumnOffset:function(M){var L=this,O=L._headerWidgets_,K,N;if(L.scrollNode){N=L.scrollNode.scrollLeft;}K=E.filterOne(O,function(P){return P.data.id===M.id||P.data.did===M.did;});if(K&&K.domNode){N=C.delta(K.domNode,O[0].domNode).x;}return N;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Panel","mstrmojo.Container","mstrmojo.Button","mstrmojo.MenuButton","mstrmojo.WidgetList","mstrmojo.DI.DIMappingItem","mstrmojo.DI.DIMultiFormEditor");var G=mstrmojo.dom;var L=mstrmojo.DI.DIConstants;var A=mstrmojo.DI.DIConstants.menuItems;function B(O,N){var M={placeholder:document.body.appendChild(document.createElement("div")),cssClass:"mstrmojo-di-mappingitem-avatar",visible:false,data:N,name:N.n,type:N.tp,georole:N.georole,timerole:N.der,parent:O};var P=new mstrmojo.DI.DIMappingItem(M);P.render();O.avatar=P;return P;}function J(Q,M){var O=M.src;var P,N;if(!O){return false;}P=O.node;if(P){N=G.findWidget(P);}if(!N||!N._allowDnD){return false;}var S=G.position(N.domNode);var R=Q.avatar||B(Q,N.data);R.set("name",N.data.n);R.domNode.style.top=(O.pos.y+1)+"px";R.domNode.style.left=(O.pos.x+1)+"px";R.domNode.style.display="block";R.domNode.style.zIndex="9999";R.domNode.style.width=(S.w-2)+"px";R.domNode.style.height=(S.h-2)+"px";}function H(N,M){if(N.avatar&&N.avatar.domNode){N.avatar.domNode.style.display="none";}}function D(P,M){var O=M.src;var N=M.tgt;if(N&&N.pos&&P.avatar&&P.avatar.domNode){P.avatar.domNode.style.left=(N.pos.x+1)+"px";P.avatar.domNode.style.top=(N.pos.y+1)+"px";}}function K(U){if(!U||!U.data||!U.data.ert||!U.data.col){return ;}var N=this.model;var S=U.data.col;var O=[];var R,M;var P={tp:L.relationshipEditType.remove,paid:S.parent.id,atid:S.child.id,ert:L.ERType.reserved};if(N.currentSource){O=[N.currentSource.tableID];}else{var Q=N.findMappingSource(S.parent);var T=N.findMappingSource(S.child);for(R=0;R<Q.length;R++){if(T.indexOf(Q[R])>-1){if(N.hasRelationship(Q[R].tableID,S.parent,S.child)){O.push(Q[R].tableID);}}}}mstrApp.getRootController().editRelationship(O,P);}function F(P){if(!P||!P.data||!P.data.ert||!P.data.col){return ;}var M=this.model;var T=P.data.col;var S=[];var O;if(M.currentSource){S=[M.currentSource.tableID];}else{var N=M.findMappingSource(T.parent);var Q=M.findMappingSource(T.child);for(O=0;O<N.length;O++){if(Q.indexOf(N[O])>-1){if(M.hasRelationship(N[O].tableID,T.parent,T.child)){S.push(N[O].tableID);}}}}var R={tp:L.relationshipEditType.flip,paid:T.parent.id,atid:T.child.id,ert:T.ert};mstrApp.getRootController().editRelationship(S,R);}function C(U,R){if(!U||!U.data||!U.data.ert||!U.data.col){return ;}var M=this.model;var S=U.data.col;var N=[];var Q;if(S.ert===R){return ;}if(M.currentSource){N=[M.currentSource.tableID];}else{var P=M.findMappingSource(S.parent);var T=M.findMappingSource(S.child);for(Q=0;Q<P.length;Q++){if(T.indexOf(P[Q])>-1){if(M.hasRelationship(P[Q].tableID,S.parent,S.child)){N.push(P[Q].tableID);}}}}var O={tp:L.relationshipEditType.changeERType,paid:S.parent.id,atid:S.child.id,ert:R};mstrApp.getRootController().editRelationship(N,O);}function E(N){var O=this.data;var M=false;if(O&&O.ert!==undefined){if(N.did===A.ONE_TO_ONE&&O.ert===L.ERType.ERType11){M=true;}if(N.did===A.ONE_TO_MANY&&O.ert===L.ERType.ERType1M){M=true;}if(N.did===A.MANY_TO_ONE&&O.ert===L.ERType.ERTypeM1){M=true;}if(N.did===A.MANY_TO_MANY&&O.ert===L.ERType.ERTypeMM){M=true;}}return M;}mstrmojo.DI.DIMappingDeck=mstrmojo.declare(mstrmojo.Container,null,{title:"",type:"",titlebarCss:"",scriptClass:"mstrmojo.DI.DIMappingDeck",markupString:'<div id="{@id}" class="mstrmojo-di-mappingdeck {@cssClass}" style="{@cssText}"><div class="mstrmojo-di-mappingdeck-titlebar {@titlebarCss}"></div><div class="mstrmojo-di-mappingdeck-list"></div></div>',markupSlots:{titlebarNode:function(){return this.domNode.children[0];},containerNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"titlebarNode",scriptClass:"mstrmojo.Table",cssClass:"titlebar-table",rows:1,cols:2,children:[{slot:"0,0",scriptClass:"mstrmojo.Label",cssClass:"titlebar-label",bindings:{text:"this.parent.parent.title"}},{slot:"0,1",scriptClass:"mstrmojo.Button",cssClass:"titlebar-button",text:"?",onclick:function(){if(this.parent.parent.onCaptionOK){this.parent.parent.onCaptionOK();}}}]},{slot:"containerNode",alias:"list",scriptClass:"mstrmojo.WidgetList",cssClass:"mstrmojo-di-mappingdeck-list",draggable:true,dropZone:true,ownAvatar:true,allowDrop:function(M){var O=M.src;var P,N;if(!O){return false;}P=O.node;if(P){N=G.findWidget(P);}return N&&N._allowDnD;},getDragData:function(M){var Q=null;var O=M.src;var P,N;if(!O){return false;}P=O.node;if(P){N=G.findWidget(P);}if(N&&N._allowDnD){Q={item:N.data};}return Q;},isDragValid:function I(N){var O=N.src;if(!O){return false;}var P,M;P=O.node;if(P){M=G.findWidget(P);}if(!M||!M.data||!M.data.col||isNaN(M.data.tp)){return false;}if(M&&M._allowDnD){J(this,N);}return M&&M._allowDnD;},ondragstart:function(N){var O=N.src;var P,M;P=O.node;if(P){M=G.findWidget(P);}if(M&&M._allowDnD){J(this,N);}},ondragend:function(M){H(this,M);},ondrop:function(M){var P=M&&M.src;var O=M&&M.tgt;var Q,S,N,R,T;if(!P||!P.node||!O||!O.node){return ;}Q=P.node;S=G.findWidget(Q);Q=O.node;N=G.findWidget(Q);R=O.pos;if(!N._allowDnD&&N.parent._allowDnD){N=N.parent;}if(N.textNode){T=G.position(N.textNode);}if(!S||!S._allowDnD){return ;}if(N._allowDnD&&T&&(R.x<=T.x)){this.parent.onMappingItemsDnD(S,N);}else{if(N===O.widget){this.parent.onItemToDeck(S,N.parent);}else{if(N._allowDnD&&T&&(R.x>T.x)){if(P.widget===O.widget){this.parent.onMappingItemsDnD(S,N);}else{this.parent.onItemToDeck(S,O.widget.parent);}}}}},ondragenter:function(M){var O=M.src;var P,N;if(!O){return false;}P=O.node;if(P){N=G.findWidget(P);}if(!N||!N._allowDnD){return false;}var Q=O.widget;J(Q,M);D(Q,M);return true;},ondragmove:function(M){D(this,M);},ondragover:function(M){},ondragleave:function(M){var N=M.src;if(!N||!N.widget){return false;}H(N.widget,M);},getItemContainerChildrenHeight:function(){var N=0;var M;if(this.domNode&&this.itemsContainerNode&&this.itemsContainerNode.childNodes){for(M=0;M<this.itemsContainerNode.childNodes.length;M++){N+=this.itemsContainerNode.childNodes[M].clientHeight;}}return N;},onheightChange:function(N){var M;if(this.domNode){this.domNode.style.height=parseInt(N.value,10)+"px";M=this.getItemContainerChildrenHeight();if(M>parseInt(N.value,10)-20){this.domNode.childNodes[0].style.height=this.domNode.childNodes[0].clientHeight+50+"px";}else{if(M>0){this.domNode.childNodes[0].style.height=M+10+"px";}}}},itemFunction:function(P,O,Q){var M={data:P.col,name:P.n,tooltip:P.n,type:P.tp,queryChecked:P.queryChecked,queryVisible:P.queryVisible,model:Q.parent.model,_allowDnD:true,cssClass:P.isLinked?"linked":"",georole:P.georole,timerole:P.der,parent:Q};if(typeof P.allowEdit==="boolean"){M.allowEdit=P.allowEdit;}var N=new mstrmojo.DI.DIMappingItem(M);return N;},postCreate:function(){var M=this.parent.model;this.update();M.attachEventListener("MappingsFetched",this.id,"update");M.attachEventListener("CurrentSourceChanged",this.id,"update");},update:function(){var N=this.parent.model;var S;if(N.currentSource){if(N.currentSource.currentTransformations&&N.currentSource.currentTransformations.xtab&&N.currentSource.currentTransformations.xtab.isCrosstab){S=N.currentSource.transformedMapping;}else{S=N.currentSource.currentMapping;}}else{S=N.getAllMappings();}if(!S||!S.length){return ;}var P,M,V;var R=[];for(P=0;P<S.length;P++){M=S[P];V=false;switch(this.parent.type){case"amps":if(M.tp===12&&M.selected){V=true;}break;case"mtmps":if(M.tp===4&&M.selected){V=true;}break;case"cmps":if(!M.selected){V=true;}break;}if(V){R.push({n:M.alias,tp:M.tp,col:M,idx:P,isLinked:M.isLinked,queryVisible:queryMenuItemVisible,isMultiForm:M.isMultiForm});}}var Q=[];var T,O,U;if(this.parent.type==="amps"){if(N.currentSource){Q=N.currentSource.relationship||[];}else{Q=N.getAllRelationships();}for(P=0;P<Q.length;P++){O=Q[P];U={n:"&lt"+O.parent.n+", "+O.child.n+"&gt",tp:"rs",allowEdit:false,ert:O.ert,col:O,queryChecked:E};if(O.ert===L.ERType.ERType11){U.n=U.n+"(1:1)";}else{if(O.ert===L.ERType.ERType1M){U.n=U.n+"(1:M)";}else{if(O.ert===L.ERType.ERTypeM1){U.n=U.n+"(M:1)";}else{if(O.ert===L.ERType.ERTypeMM){U.n=U.n+"(M:M)";}}}}R.push(U);}}this.set("items",R);}}],onheightChange:function(M){this.list.set("height",parseInt(M.value,10)-20+"px");},onMappingItemsDnD:function(M,U){var P=M.name;var W=U.name;var N=this.model;var O=[],T;var Q,V,S;if(M.type!==12||U.type!==12){if(U.type===12||U.type==="rs"){M.toAttribute();return ;}if(U.type===4){M.toMetric();return ;}return ;}if(!M.data||!M.data.col||!U.data||!U.data.col){return ;}if(!M.data.col.selected&&U.data.col.selected){M.toAttribute();return ;}if(M.data.col.selected&&!U.data.col.selected){M.toUnused();return ;}if(!M.data.col.selected&&!U.data.col.selected){return ;}if(M.data.col.id===U.data.col.id){return ;}if(N.currentSource){if(!(N.hasRelationship(N.currentSource.tableID,U.data.col,M.data.col)||N.hasRelationship(N.currentSource.tableID,M.data.col,U.data.col))){O.push(N.currentSource.tableID);}}else{Q=N.findMappingSource(M.data.col);V=N.findMappingSource(U.data.col);for(S=0;S<Q.length;S++){if(V.indexOf(Q[S])>-1){if(!(N.hasRelationship(Q[S].tableID,U.data.col,M.data.col)||N.hasRelationship(Q[S].tableID,M.data.col,U.data.col))){O.push(Q[S].tableID);}}}}var R={tp:L.relationshipEditType.create,paid:U.data.col.id,atid:M.data.col.id,ert:L.ERType.ERType1M};mstrApp.getRootController().editRelationship(O,R);},onItemToDeck:function(O,P){var N=O.name;var M=O.type;var Q=P.type;switch(Q){case"amps":O.toAttribute();break;case"mtmps":O.toMetric();break;case"cmps":O.toUnused();break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.Box","mstrmojo.qb.FilterValueEditor","mstrmojo.qb.QBTableLinker","mstrmojo.qb.ConditionEditor","mstrmojo.qb.DBTable","mstrmojo.ui.menus.Menu","mstrmojo.qb.DBTableRowMenu");mstrmojo.requiresDescs(221,520,521,522,523,524,525,526,612,629,686,687,688,696,746,1442,2122,2123,2125,2127,2131,2151,2219,2220,2784,2785,2786,4449,5893,8571,9126,9127,9128,9129,9640,9641,9913,9938,9939,9940,9941,12736,12928);var Y=mstrmojo.dom,L=mstrmojo.array,K="addTable",X="264px",Z=22;var N=[0,"tick",16,"mix"];var H=[{did:"Delete",n:mstrmojo.desc(629,"Delete")},{did:-1,n:"-"},{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:"2",n:mstrmojo.desc(9941,"Right Outer Join")},{did:"3",n:mstrmojo.desc(9641,"Outer Join")},{did:-1,n:"-"},{did:"More Options",n:mstrmojo.desc(9126,"More Options")}];var F=[{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:"2",n:mstrmojo.desc(9941,"Right Outer Join")},{did:"3",n:mstrmojo.desc(9641,"Outer Join")}];var P=[{n:"=",dssid:"0"},{n:">",dssid:"1"},{n:">=",dssid:"2"},{n:"<",dssid:"3"},{n:"<=",dssid:"4"},{n:"<>",dssid:"5"}];var c=[{did:"-2",n:mstrmojo.desc(4449,"Expression")},{did:-1,n:"-"},{did:2219,n:mstrmojo.desc(2219,"In list")},{did:2220,n:mstrmojo.desc(2220,"Not in list")},{did:-1,n:"-"},{did:520,n:mstrmojo.desc(520,"Exactly")},{did:612,n:mstrmojo.desc(612,"Not Exactly")},{did:-1,n:"-"},{did:521,n:mstrmojo.desc(521,"Greater than")},{did:523,n:mstrmojo.desc(523,"Less than")},{did:522,n:mstrmojo.desc(522,"Greater than equal")},{did:524,n:mstrmojo.desc(524,"Less than equal")},{did:-1,n:"-"},{did:"-5",n:mstrmojo.desc(9939,"Strings"),fns:[{did:525,n:mstrmojo.desc(525,"Like")},{did:526,n:mstrmojo.desc(526,"Not like")},{did:686,n:mstrmojo.desc(686,"Contains")},{did:2784,n:mstrmojo.desc(2784,"Does not contain")},{did:687,n:mstrmojo.desc(687,"Begins with")},{did:2785,n:mstrmojo.desc(2785,"Does not begin with")},{did:688,n:mstrmojo.desc(688,"Ends with")},{did:2786,n:mstrmojo.desc(2786,"Does not end with")}]},{did:-1,n:"-"},{did:"Between",n:mstrmojo.desc(696,"Between")},{did:"Not between",n:mstrmojo.desc(746,"Not between")}];var a=[{did:"0",n:mstrmojo.desc(4449,"Expression")},{did:"1",n:mstrmojo.desc(9913,"Aggregation Function"),fns:[{did:"-6",n:mstrmojo.desc(2131,"Sum"),idx:1},{did:"-6",n:mstrmojo.desc(2122,"Average"),idx:2},{did:"-6",n:mstrmojo.desc(2127,"Minimum"),idx:3},{did:"-6",n:mstrmojo.desc(2125,"Maximum"),idx:4},{did:"-6",n:mstrmojo.desc(2123,"Count"),idx:5},{did:"-6",n:mstrmojo.desc(9938,"Count Distinct"),idx:6}]},{did:"2",n:mstrmojo.desc(2151,"Filter"),fns:c}];function T(j){return Z*(j?(j+2):1);}function M(p){var k=mstrmojo.all.QBuilderModel,m,n=[],o;if(!p.srcData){m=k.gettIndex(p.id);for(var l=1,j=p.Rows.children.length;l<j;l++){o=p.Rows.children[l];if(o.visible){n.push(o);}}}else{n.push(p);m=k.gettIndex(p.parent.parent.id);}k.addSelectedColumns(n,m,null,{success:function(){var u=0,q=n.length,t;for(u;u<q;u++){t=n[u];t.updateState(1);t.count++;}}});}var B=0,J=1,h=3;function f(j,l,n){var o="mstr-qb-table-moreCM",m=mstrmojo.all[o];if(!m){m=new mstrmojo.MenuButton({id:o,cmCssClass:"mstrmojo-CXM",alias:"fctmenu",itemChildrenField:"fns",itemIdField:"did",itemField:"n",iconClass:"mstrmojo-qb-ListIcon div",cm:a,domSrc:l,obj:n,dynamicUpdate:true,getMenuPosition:function k(){var p=mstrmojo.dom.position(this.domSrc,true);return{x:Math.round(p.x),y:Math.round(p.y+p.h)};},executeCommand:function(AK){var AD=this.obj,x=mstrmojo.all.QBuilderModel,u=AD.parent.parent,AJ=x.gettIndex(AD.srcID);switch(AK.did){case"0":mstrApp.getRootController().openExpressionEditor({type:B,w:AD,tkn:AD.expr});break;case"-2":mstrApp.getRootController().openExpressionEditor({n:mstrmojo.desc(5893,"New Condition"),w:AD,tkn:AD.expr,callbacks:{success:function AC(AN){var w=AN.mi;mstrApp.getRootController().addNewFilter({et:"*",expr:w.items,n:AN.expr,sqltp:w.exp.sqltp});}}});break;case"-6":var p=x.selectedClns,AG=p.length,AI=new Array(),z=AD.parent.children,AH=u.selectedIndex;AI.push(AD);var AF={success:function(){var AP=0,AN=AI.length,AO;for(AP;AP<AN;AP++){AO=AI[AP];if(AO.state==0||AO.state==2){AO.state++;AO.images[1]=AO.img[AO.state];AO.render();}AO.count++;}},failure:function(){}};x.addSelectedColumns(AI,AJ,AK.idx,AF);break;default:var t=this.obj,AE=t.dt.tp,AA={14:true,15:true,16:true},AL={30:true},AB,AM,q;switch(AK.did){case"Between":case"Not between":q=2;break;default:q=1;}AM="mstr-qb-fve";AB=mstrmojo.all[AM]||(new mstrmojo.qb.FilterValueEditor({id:AM}));AB.n=AK.n;AB.operatorID=AK.did;AB.column=t.oriexpr;AB.isDateTime=AA[AE];AB.isBigDecimal=AL[AE];AB.paraNum=q;AB.open();}}});m.render();}else{m.set("domSrc",l);m.set("obj",n);}m.showContextMenu();m.onContextMenuClose=function(){l.style.visibility="inherit";};}function d(k,l){var n={success:function(){var p,o;p=k.menuHelper;if(!p){p=k.menuHelper=new mstrmojo.qb.DBTableRowMenu();}p.tableRow=k;o=p.getMenuConfig();o.hostId=k.id;o.hostElement=k.domNode;if(l.position){o.position=l.position;}o.isHostedWithin=false;k.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:o}));}},j=mstrApp.getRootController();if(j.getFunctionList()){n.success();return ;}j.model.getFunctions(false,{success:function m(){n.success();}},{showWait:true});}function G(n,m,l){var j=mstrmojo.all.QBuilderModel,o=Y.position(l.domNode),t=n.clientX,p=n.clientY,q=j.getTouchValue(t-o.x,p-o.y),k=Y.position(l.domNode,true);if(q){j.selLink=q;m.drawMarker();e.call(this,n,q,m,{x:t+(k.x-o.x),y:p+(k.y-o.y)});}else{j.selLink=null;m.clearHighLightCanvas();}}var S={};function e(w,k,n,t){var l=mstrApp.diCurrentZIndex,m=l>999?l+1:999,q=this,u=q.joinMenuOption.mappingKey,j=q.joinMenuOption.menuItems,o=S[u];if(!o){o=S[u]=new mstrmojo.MenuButton({cmCssClass:"mstrmojo-CXM",cm:j,zIndex:m,itemChildrenField:"fns",itemIdField:"did",itemField:"n",dynamicUpdate:true,obj:k,pos:t,linker:n,getMenuPosition:function p(){return this.pos;},queryChecked:function(AA){switch(AA.did){case"Delete":case -1:case"More Options":return false;default:var x=mstrmojo.all.QBuilderModel;var z=x.selLink[0];return(x.joinsInfo[z].jt==AA.did);}},executeCommand:function(AC){var AD=this.linker;var z=mstrmojo.all.QBuilderModel;var AB=this.obj,AA=AC.did;switch(AA){case"Delete":var x={success:function(){z.selLink=null;AD.drawLinks();},failure:function(){}};z.removeLink(AB[1],AB[0],x);break;case"0":case"1":case"2":case"3":z.editJoin({joinID:AB[0],linkID:AB[1],type:AA});break;case"More Options":R.call(q,w,AB,AD);break;default:break;}}});}else{o.set("pos",t);o.set("obj",k);o.set("linker",n);}o.showContextMenu();}var U={};function R(u,q,m,p){var x=this.joinMenuOption.joinItems,t=this.joinMenuOption.mappingKey,n=U[t],l=this.joinMenuOption.joinOperators;if(!n){n=U[t]=new mstrmojo.Editor({slink:q,linker:m,title:mstrmojo.desc(9127,"Join Options"),help:(mstrApp.helpTopics&&mstrApp.helpTopics.tableJoin)||"join_options_dialog_box.htm",zIndex:100,cssText:"width:350px;",children:[{scriptClass:"mstrmojo.Label",cssText:"font-weight:bold; width:100%; padding: 5px;",text:mstrmojo.desc(9128,"Join")},{scriptClass:"mstrmojo.RadioList",alias:"radiolist",cssText:"padding-left:25px;",itemCssClass:"mstrmojo-QB-radiolist-item",items:x},{scriptClass:"mstrmojo.Label",cssText:"font-weight:bold; width:100%; padding-left: 5px;",text:mstrmojo.desc(9129,"Join Operator")},{scriptClass:"mstrmojo.Label",cssText:"padding-left:100px;",bindings:{text:"this.parent.srcText"}},{scriptClass:"mstrmojo.HBox",alias:"jop",cssText:"position:relative;left:100px;",children:[{scriptClass:"mstrmojo.Pulldown",items:l,popupToBody:true}]},{scriptClass:"mstrmojo.Label",cssText:"padding-left:100px;",bindings:{text:"this.parent.tgtText"}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),onclick:function(z){var AG=this.parent.parent;var AA=mstrmojo.all.QBuilderModel,AE=AG.radiolist.selectedItem.did,AD=AG.slink[1],AB=AG.slink[0],AC=AG.jop.children[0].selectedItem,AF=AA.brackets(AG.srcText)+AC.n+AA.brackets(AG.tgtText);AA.editJoin({joinID:AB,linkID:AD,type:AE,exp:AF,op:AC.dssid});if(AG.onOK){AG.onOK();}AG.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(z){var AA=this.parent.parent;if(AA.onCancel){AA.onCancel();}AA.close();}}]}]});}else{n.set("slink",q);n.set("linker",m);}var j=mstrmojo.all.QBuilderModel,w=j.joinsInfo[q[0]].links[q[1]],k=w.srcw.oriexpr,o=w.tgtw.oriexpr;n.set("srcText",k);n.set("tgtText",o);n.radiolist.set("selectedIndex",parseInt(j.joinsInfo[q[0]].jt));n.jop.children[0].set("value",w.op||"0");n.open();}function C(m,n,q,p,l){var j=mstrmojo.all.QBuilderModel;var z=new mstrmojo.qb.DBTable({scriptClass:"mstrmojo.qb.DBTable",cssText:"opacity:0.3;filter:alpha(opacity=30);left:0px;top:0px;width:180px;height:"+n+"px;",title:l,visible:false,noCheckBox:true});z.container=m.parent;z.selectedIndex=new Array();var u=j.gettIndex(z.id);m.addChildren([z]);z.maxHeight=z.editorNode.clientHeight;z.maxWidth=Math.max(z.Rows.domNode.clientWidth,z.titlebarNode.clientWidth);if(z.maxHeight>parseInt(X)){z.set("height",X);}var k=q+"px",t=p+"px",AA=q+z.editorNode.clientWidth,o=p+z.editorNode.clientHeight,w=z.editorNode.style;w.left=k;w.top=t;w.width=z.titlebarNode.clientWidth+"px";z.left=k;z.top=t;return z;}function E(n){var m,l,k=0,p,o=20,j;L.forEach(n,function(q){j=mstrmojo.all[q];l=parseInt(j.left)+parseInt(j.editorNode.style.width);if(l>k){k=l;m=j;}});p=Math.ceil(k/200)*200+20;return{left:p,top:o};}function Q(z,AQ){var AN=AQ.h,u=AQ.w,t=AQ.x,q=AQ.y,l=AQ.tbn,AO=AQ.did,AA=AQ.dbtbn,AB=AQ.ns,AK=AQ.readOnly,n=mstrmojo.all.QBuilderModel,AS;var AC=T(z.length);AS=E(n.dbtables);t=AS.left;q=AS.top;var AF=new mstrmojo.qb.DBTable({scriptClass:"mstrmojo.qb.DBTable",cssText:"position:absolute;left:0px;top:0px;width:"+(u?u:180)+"px;height:"+AC+"px;",left:t+"px",top:q+"px",readOnly:AK,title:l,visible:true,readOnly:AK,noCheckBox:true,onClose:function(){var x=this;var w={success:function(){x.parent.parent.linker.drawLinks();},failure:function(){}};n.removeTable(this,w);},onRender:function(){if(AK&&this.closeNode){this.closeNode.title=mstrmojo.desc(12928,"Cannot delete this table since it is being used by the dashboard");mstrmojo.css.addClass(this.closeNode,"readonly");}}});n.upttIndex(l,AA,AF.id,true,AO,AB);n.raiseEvent({name:"refreshTables",items:n.dbtables.slice(0)});if(AO){n.uiids[AO]=AF.id;}AF.model=n;AF.container=this.parent;AF.selectedIndex=new Array();var AP=n.gettIndex(AF.id);var o,p,AE,AJ,AM=z.length;if(AM){AF.addRow(('* <span class = "all"> '+mstrmojo.desc(12736,"Add all columns")+"</span>"),0,["0","0"],"");o=AF.Rows.children[0];o.draggable=false;o.dropZone=false;o.allowDrop=false;o.rIndex=-1;o.table=AF;o.ondblclick=function(w){if(mstrmojo.dom.eventTarget(w.hWin,w.e).className.indexOf("add")<0){M(AF);}};o.oncontextmenu=function AL(w){Y.preventDefault(window,w.e);};}for(AJ=0;AJ<AM;AJ++){p=z[AJ].cln;AE=z[AJ].state?["0",N[z[AJ].state]]:["0","0"];AF.addRow(z[AJ].cln,0,AE,"");AF.selectedIndex[AJ]=false;o=AF.Rows.children[AJ+1];o.cssClass=(AJ%2)?"odd":"even";o.srcTable=l;o.srcID=AF.id;o.srcData=z[AJ];o.oriexpr=z[AJ].exp?z[AJ].exp:(l+"."+z[AJ].cln);o.expr=[{isNew:true,v:n.brackets(o.oriexpr),oi:{tIndex:AP,rIndex:AJ+1,t:"26",n:o.oriexpr}}];o.img=N;o.enableExpr=!z[AJ].hideExpr;o.state=!z[AJ].state?0:z[AJ].state;n.tables[AF.id].rows[o.id]=o;o.rIndex=AJ;o.count=!z[AJ].count?0:z[AJ].count;o.dt=z[AJ].dt;o.updateState=function(x){if(this.count<=0){this.state=this.state&2;}this.state=this.state|x;var w=(this.state&1)+(this.state&2);this.images[1]=this.img[w];this.render();};o.ondblclick=function(w){if(mstrmojo.dom.eventTarget(w.hWin,w.e).className.indexOf("add")<0){M(this);}};o.oncontextmenu=function AL(w){Y.preventDefault(window,w.e);d(this,{position:Y.getMousePosition(w.e,window)});};if(AO){n.uiids[AO+z[AJ].did]=o.id;}}this.addChildren([AF]);AF.maxHeight=AC;var AT=AF.Rows.domNode.clientWidth;mstrmojo.array.forEach(AF.Rows.domNode.children,function(w){AT=Math.max(AT,w.firstChild.children[1].clientWidth+30);});AF.maxWidth=Math.max(AT,AF.titlebarNode.clientWidth);if(AN<AC){AF.set("height",AN+"px");}var AR=t+"px",AH=q+"px",AI=t+AF.editorNode.clientWidth,k=q+AF.editorNode.clientHeight+10,AG=AF.editorNode.style,j=this.parent,m=this.domNode.style,AD=j.linker;AF.titlebarNode.style.width=parseInt(AG.width,10)-56+"px";AF.titleNode.style.width=AF.titlebarNode.style.width;AN=parseInt(j.domNode.clientHeight);u=parseInt(j.domNode.clientWidth);if(u<AI&&j.maxWidth<AI){j.maxWidth=AI;j.canvasbox.set("width",j.maxWidth+"px");j.linker.set("width",j.maxWidth+"px");n.linkerNeedRender=true;}if(AN<k&&j.maxHeight<k){j.maxHeight=k;j.canvasbox.set("height",j.maxHeight+"px");j.linker.set("height",j.maxHeight+"px");n.linkerNeedRender=true;}j.domNode.style["overflow-x"]=(j.maxWidth>u)?"auto":"hidden";j.domNode.style["overflow-y"]=(j.maxHeight>AN)?"auto":"hidden";return AF;}mstrmojo.qb.QBTableView=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.QBTableView",joinMenuOption:{menuItems:H,joinItems:F,mappingKey:"database",joinOperators:P},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},init:function W(l){this._super(l);var o={},k=o[this.id]={},n=this;k.joinChanged=k.JoinsLoaded=k.JoinsAdded=function j(){n.scrollBox.linker.drawLinks();};k.BindingTableLoaded=function m(p){n.scrollBox.canvasbox.displayBindingTable(p);};k.refreshTables=n.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(o);},onTableRefresh:function V(j){var k=j.items.length>0;var l=this.scrollBox;mstrmojo.css.toggleClass(l.hintbox.domNode,["off"],k);mstrmojo.css.toggleClass(l.domNode,["active"],k);if(!k){mstrApp.getRootController().toggleDataPreview(false);}},children:[{scriptClass:"mstrmojo.Box",alias:"scrollBox",cssClass:"mstrmojo-qb-tableview-box",maxWidth:0,maxHeight:0,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout></div>',onmouseover:function(){var j=parseInt(this.domNode.clientHeight),l=parseInt(this.domNode.clientWidth),k=this.domNode.style;if(l<this.maxWidth){k.overflowX="auto";}else{k.overflowX="hidden";this.domNode.scrollLeft=0;}if(j<this.maxHeight){k.overflowY="auto";}else{k.overflowY="hidden";this.domNode.scrollTop=0;}},onmouseout:function(){this.domNode.style.overflow="hidden";},children:[{scriptClass:"mstrmojo.Box",alias:"hintbox",markupString:'<div class="mstrmojo-qb-EmptyHint">{@emptyHint}</div>',cssDisplay:"",emptyHint:mstrmojo.desc(13246,"Drag and Drop table(s) from any database connections")},{scriptClass:"mstrmojo.qb.QBTableLinker",alias:"linker",cssClass:"mstrmojo-qb-tableview-linker",dropZone:true,allowDrop:function D(j){return(j.action===K);},ondrop:function b(j){this.parent.canvasbox.ondrop(j);mstrmojo.css.removeClass(this.domNode,"dragging");},ondragenter:function O(j){this.parent.canvasbox.ondragenter(j);mstrmojo.css.addClass(this.parent.domNode,"dragging");},ondragleave:function O(j){this.parent.canvasbox.ondragleave(j);mstrmojo.css.removeClass(this.domNode,"dragging");},onclick:function g(k){var j=this.parent.parent;G.call(j,k.e,this,this);}},{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousemove> </div>',cssClass:"mstrmojo-qb-tableview-canvas",alias:"canvasbox",dropZone:true,allowDrop:function D(j){return(j.action===K);},onclick:function g(k){var j=this.parent.parent;G.call(j,k.e,this.parent.linker,this);},displayBindingTable:function(u){var w=u.value,k=0,o=20,q=20,x=0,j=0,p,AA,l=0;for(var m=0,n=w.length;m<n;m++){AA=w[m];p=AA.pos;if(p){q=p.t;k=p.l;x=p.h;j=p.w;}else{x=T(AA.cs.length);k+=l+o;}AA.h=x;AA.w=j;AA.x=k;AA.y=q;var z=Q.call(this,AA.cs,AA);l=z.editorNode.clientWidth;}},updateTableName:function(o){var n=o.tid;if(n&&mstrmojo.all[n]){var l=mstrmojo.all.QBuilderModel,m=mstrmojo.all[n],k=m.Rows.children,p,j=o.value;mstrmojo.array.forEach(k,function(t,q){if(q>0){t.oriexpr=j+"."+t.srcData.cln;t.expr[0].v=l.brackets(t.oriexpr);t.expr[0].n=t.oriexpr;l.tables[n].rows[t.id]=t;}});}},postCreate:function(){var j=mstrmojo.all.QBuilderModel;if(!j){return ;}j.attachEventListener("TableAdded",this.id,"drawTable");j.attachEventListener("TableNameChanged",this.id,"updateTableName");},ondrop:function b(j){var q=j.action,m=j.src;if(m&&m.data){var n=m.data;if(q===K){var l=j.tgt.pos,o=mstrmojo.dom.position(j.tgt.node),t=l.x-o.x;y=l.y-o.y;var k=m.widget.dataHelper,p=0;mstrmojo.array.forEach(n,function(w){k.fetch(w,{success:function u(x){w.x=t+p*15;w.y=y+p*15;p++;mstrApp.getRootController().addTable(w,x.items);}});});}}mstrmojo.css.removeClass(this.parent.domNode,"dragging");},getAvatarIconClass:function I(j){return"enabled";},ondragenter:function O(j){var k=j.src.widget;if(k&&k.toggleAvatarClass&&this.allowDrop(j)){k.toggleAvatarClass(this.getAvatarIconClass(j),true);}mstrmojo.css.addClass(this.parent.domNode,"dragging");},ondragleave:function A(j){var k=j.src.widget;if(k&&k.toggleAvatarClass&&this.allowDrop(j)){k.toggleAvatarClass(this.getAvatarIconClass(j),false);}mstrmojo.css.removeClass(this.parent.domNode,"dragging");},drawTable:function(j){var m=j.data,l=j.table,k=T(m.length);k=(k>parseInt(X,10))?parseInt(X,10):k;l.h=k;l.w=null;Q.call(this,m,l);}}]}],onheightChange:function(l){var k=parseInt(l.value)-3;this.scrollBox.set("height",k+"px");var j=this.scrollBox.canvasbox;if((!j.height)||(j.domNode&&k>j.domNode.clientHeight)){j.set("height",k+"px");this.scrollBox.linker.set("height",k);}if(this.scrollBox.domNode){this.scrollBox.hintbox.domNode.style.lineHeight=k+100+"px";this.scrollBox.domNode.style.height=this.scrollBox.height;if(parseInt(this.scrollBox.height)<this.scrollBox.maxHeight){this.scrollBox.linker.set("height",parseInt(this.scrollBox.maxHeight));this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();this.scrollBox.canvasbox.domNode.style.height=parseInt(this.scrollBox.maxHeight)+"px";}else{this.scrollBox.linker.set("height",k);this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();j.domNode.style.height=k+"px";j.height=j.domNode.style.height;}}},onwidthChange:function(l){var j=parseInt(l.value)-2;this.scrollBox.set("width",j+"px");var k=this.scrollBox.canvasbox;if((!k.width)||(k.domNode&&j>k.domNode.clientWidth)){k.set("width",j+"px");this.scrollBox.linker.set("width",j);}if(this.scrollBox.domNode){this.scrollBox.domNode.style.width=this.scrollBox.width;if(parseInt(this.scrollBox.width)<this.scrollBox.maxWidth){this.scrollBox.linker.set("width",parseInt(this.scrollBox.maxWidth));this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();this.scrollBox.canvasbox.domNode.style.width=parseInt(this.scrollBox.maxWidth)+"px";}else{this.scrollBox.linker.set("width",j);this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();k.domNode.style.width=j+"px";k.width=k.domNode.style.width;}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper","mstrmojo.ui.ScrollableSuggestionList");var H=mstrmojo.expr,O=mstrmojo.Enum_OIB_States,J=mstrmojo.ME._MetricEditorHelper,R=mstrmojo.dom;mstrmojo.ME.ObjectInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{cssClass:"",autoSelect:false,suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",suggestionPopupCssClss:"mstrmojo-ME-ObjectInputBox-suggest",blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,useKeyDelay:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,emptyText:"Search for an object",showEmptyItem:false,noEditButton:true,browseItemVisible:true,click2edit:true,showSuggestionOnEdit:false,tabNavigable:true,obCfg:{},dynamicVerify:true,init:function P(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-ObjectInputBox");if(this.isDME){this.browseItemVisible=!this.isDME;this.suggestCount=this.isDME?1000:mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=1000;this.dynamicVerify=false;}},item2textCss:function D(W){if(this.isDME){return mstrmojo.ME._MetricEditorHelper.item2textCss(W);}var E=this._super(W)||{1:"f",4:"m",12:"a",13:"fc",43:"tr","-1":"rl","-99":"br"}[W.t]||"";return E?" icn "+E:"";},itemFunction:function B(X,E,W,Y){X[W.itemIdField]=W.nextId();var Z=Y||mstrmojo.ME.ObjectItem,a=new Z({parent:W,itemField:W.itemField,cssClass:W.item2textCss(X),data:X,bindings:{isFull:"this.parent.isFull"},onisFullChange:function(){if(this.hasRendered){this.updateButtonsVisibility();}}});W.attachEventListener4ItemWidget(a,W);return a;},getActiveItem:function M(){var E=this.editingIdx,X,W;if(E>-1){X=this.ctxtBuilder.itemWidgets[E];W=X&&X.data;}return W;},showObjectBrowser:function(E){this.set("suggestTarget",E);this.handleSuggestionItemSelect({t:-99},this.obCfg);},hideItemWidgetBrowseButton:function S(){return false;},hidePulldownButton:function G(){return true;},hideDelButton:function A(){return false;},dtp:0,verifyObject:function C(W,E){if(!this.dynamicVerify){return O.VALID;}var Y=E.data;var X=parseInt(this.dtp,10);switch(X){case -1:case -2:case -4:case -5:case -6:if(Y.t===-1||J.isDimty(W,X===-1)){return O.VALID;}if(this.dynamicVerify){return this._super(W,E);}return Y.did?O.VALID:O.INVALID;case 1:case 2:case 3:case 4:case 5:case 6:case 7:if(Y.t<0){return O.VALID;}if(/^\d{1,}$/.test(mstrmojo.string.trim(W))||Y.did){return O.VALID;}if(this.dynamicVerify){return this._super(W,E);}return O.INVALID;default:return O.VALID;}},getItemsToFilterOut:function N(){return this.items;},updateSuggestion:function Q(E){var X=this.getActiveItem();var W=this.getItemsToFilterOut();E=mstrmojo.array.filter(E,function(a){var Z=a.did,Y=false,c;var b=function(d){mstrmojo.array.forEach(W,function(e){if(e!==X&&e.did===d){Y=true;return false;}});};b(Z);if(!Y){c=a;}return c;});if(this._super){this._super(E);}},nudge:function I(W){W.domNode.style.minWidth=this.suggestTarget.domNode.offsetWidth+(this.isDME?13:0)+"px";var X=R.position(W.domNode),Y=R.position(this.suggestTarget.domNode),E=R.windowDim();if(X.y+X.h>E.h){W.domNode.style.top=(Y.y-X.h-5)+"px";}}});mstrmojo.ME.ObjectItem=mstrmojo.declare(mstrmojo.ObjectItem,[mstrmojo._HasPopup],{markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode" tabindex="0" mstrAttach:click,focus><span class="mstrmojo-ObjectItem-text {@cssClass}"></span></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" placeholder="{@placeholderText}" mstrAttach:keyup,keydown/></div><div class="mstrmojo-ObjectItem-icons"><div class="mstrmojo-ObjectItem-down" onclick="mstrmojo.all[\'{@id}\'].showSuggestion(\'\')"></div><img class="mstrmojo-ObjectItem-browse" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1825,"Browse")+'" onclick="mstrmojo.all[\'{@id}\'].browse()"/><div class="mstrmojo-ObjectItem-opts" title="'+mstrmojo.desc(9598,"Level options")+'" onclick="mstrmojo.all[\'{@id}\'].options(arguments[0])" style="display:none;"></div><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])" style="display:none;"/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},pulldownButtonNode:function(){return this.domNode.lastChild.childNodes[0];},browseButtonNode:function(){return this.domNode.lastChild.childNodes[1];},optionButtonNode:function(){return this.domNode.lastChild.childNodes[2];},editButtonNode:function(){return this.domNode.lastChild.childNodes[3];},delButtonNode:function(){return this.domNode.lastChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},init:function P(E){this._super(E);this.placeholderText=this.parent.emptyText;},initState:function T(){var W=this.parent,X=this.data,E=X.state;if(W.dynamicVerify){return this._super();}if(typeof E==="undefined"){E=W.verifyObject(X[this.itemField],this);X.state=E;}return E;},updateButtonsVisibility:function F(){if(this._super){this._super();}if(this.parent.hidePulldownButton()){this.pulldownButtonNode.style.display="none";}if(this.parent.hideItemWidgetBrowseButton()){this.browseButtonNode.style.display="none";}this.optionButtonNode.style.display=this.data.state!==O.ADDING&&this.optionButtonVisible?"":"none";this.delButtonNode.style.display=this.data.state!==O.ADDING&&!this.parent.hideDelButton()&&!this.isFull?"":"none";},browse:function L(){this.set("state",this.data.state===O.ADDING?O.ADDING:O.EDITING);this.parent.showObjectBrowser(this);},click2edit:function K(){if(this.parent.click2edit){this.edit();}},onclick:function V(){this.click2edit();},onfocus:function U(){this.click2edit();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Button","mstrmojo.Editor","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper");mstrmojo.requiresDescs(12852);var J=mstrmojo.expr,A=mstrmojo.array,G=mstrmojo.hash,M=mstrmojo.ME._MetricEditorHelper,B=mstrmojo.ME.Enum.DYNAMIC_DIMTY,L=mstrmojo.ME.Enum.UI_DATA_TYPE,I=mstrmojo.ME.Enum.UI_OBJECT_TYPE,F=mstrmojo.ME.MetricToken.brackets;var K;function Q(){var E=mstrmojo.all[K];if(E&&E.onmetricModify){E.onmetricModify();}}function C(){var E=mstrmojo.all[K];if(E&&E.updateScrollbars){E.updateScrollbars();}}mstrmojo.ME.SortByInputList=mstrmojo.declare(mstrmojo.WidgetList,null,{makeObservable:true,isNewDef:true,isDME:false,init:function R(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-sortby");},preBuildRendering:function(){var E=this.items||[];if(this.isNewDef&&this.isDME){E.push(B.getAutomaticDimtyObject());}E.push({n:""});this.items=E;if(this._super){this._super();}},getTokens:function(){var W=this.items,E=W.length-1,V,a=[];if(E>0){a.push({v:"SortBy"});a.push({v:"=",isDelimiter:true});a.push({v:"(",isDelimiter:true});for(V=0;V<E;V++){var Y=W[V],Z=Y.selFrm,U,X=false;if(M.isDimty(Y.n)){U={v:Y.n};X=true;}else{if(/^@/.test(Y.did)){U={v:Y.did};X=true;}else{U={v:F(Y.n),oi:Y};}}if(Z&&(Y.t===J.TP.ATTR||(Y.t===J.TP.CONS&&Y.st===J.STP.NDE))){G.copy({v:F(Y.n)+"@"+F(Z.n),exv:Z.dssid,extp:8},U);}a.push(U);if(!X){if(!!Y.asc){a.push({v:"Desc",tp:259});}}if(V!==(E-1)){a.push({v:",",isDelimiter:true});}}a.push({v:")",isDelimiter:true});}return a;},itemFunction:function(X,E,U){return new mstrmojo.Box({cssClass:"mstrmojo-ME-sortby-item",alias:"sortByItem",parent:U,children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"sortByInput",cssClass:"mstrmojo-ME-ObjectInputBox-sortby",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),isDME:U.isDME,dtp:L.Sortby,maxObjectCount:1,folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(","),getCandidatesThroughTaskCall:function Z(c,b){c.objectType=J.TP.ATTR+","+J.TP.METRIC;c.rootFolderType=39;c.blockCount=c.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(c,b);},obCfg:{folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(",")},bindings:{candidates:"this.parent.parent.candidates"},postCreate:function(b){if(!b){this.set("items",X.did||X.dimty?[X]:null);}},onitemchange:function(){var d=this.getSelectedObjects()[0];if(!d||!d.did&&!d.n){return ;}X.selFrm=null;mstrmojo.hash.copy(d,X);var c=this.parent.formsPulldown;if(c){c.updateForms(d);}var b=this.parent.ascPulldown;if(b){b.set("visible",X.t===4||X.st===J.STP.NDE);}Q();},onadd:function V(){if(this.getSelectedObjects().length===0){return ;}if(this.parent===U.ctxtBuilder.itemWidgets[U.items.length-1]){U.add([{n:""}]);this.parent.del.set("visible",true);}},hidePulldownButton:function(){return !U.isDME;},hideDelButton:function(){return true;},hideItemWidgetBrowseButton:function(){return U.isDME;},getItemsToFilterOut:function(){return U.items;}},{scriptClass:"mstrmojo.Pulldown",alias:"formsPulldown",cssClass:"mstrmojo-ME-sortby-forms mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",defaultSelection:-1,bindings:{visible:function(){return this.items&&this.items.length>0;}},popupToBody:true,popupZIndex:100,postCreate:function(){this.retrieveDssForms(X);},retrieveDssForms:function W(d){var c=this,b=function(){var l=function(m){d.dssforms=m;c.set("items",d.dssforms);c.selectedIndex=-1;c.selectedItem=null;c.value=null;c.set("value",d.selFrm);};var j=c.parent.sortByInput.candidates,e=j&&j.items;if(d.did&&e){var h=A.find(e,"did",d.did);if(h>-1){var g=mstrmojo.hash.clone(e[h].fs);if(g){A.forEach(g,function(m){m[c.itemIdField]=m.fid;m[c.itemField]=m.fnm;});l(g);return ;}}}var k=function(m){if(m){var n=m.container;if(n&&n.dssforms){d.dssforms=n.dssforms;l(d.dssforms);}}},f=function(m){mstrmojo.alert(m.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:d.did,displayedForms:0},{success:k,failure:f});};switch(d.t){case J.TP.ATTR:b();break;case J.TP.CONS:if(d.st===J.STP.NDE){c.set("visible",false);}break;case J.TP.METRIC:c.set("visible",false);break;case I.Dimty:c.set("visible",false);break;}},updateForms:function Y(b){this.retrieveDssForms(b);},onvalueChange:function a(){if(this.selectedItem){X.selFrm=this.selectedItem;}if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Pulldown",alias:"ascPulldown",cssClass:"mstrmojo-ME-sortby-asc mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,visible:false,bindings:{value:function(){return this.parent.parent.items[E].asc;},visible:function(){var b=this.parent.sortByInput.getSelectedObjects()[0];return this.parent.formsPulldown.visible&&this.parent.formsPulldown.value||b.t===J.TP.METRIC||b.st===J.STP.NDE;}},onvalueChange:function(b){X.asc=this.value;if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Button",alias:"del",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),bindings:{visible:function(){var b=U.itemIndex(X);return this.parent.parent.items[b].did;}},onclick:function(){U.remove(U.items[U.itemIndex(X)]);Q();}}]});},onadd:function H(){C();},onremove:function S(){C();}});mstrmojo.ME._HasSortBy=mstrmojo.provide("mstrmojo.ME._HasSortBy",{_mixinName:"mstrmojo.ME._HasSortBy",ios:false,oniosChange:function P(E){this.sortByContainer.set("visible",E.value);},onOpen:function(){if(this._super){this._super();}K=this.id;var U=this.oi.tks,V=!U.met;var E=this.sortByContainer&&this.sortByContainer.sortByWidgetList;if(E){E.set("isNewDef",V);E.set("isDME",this.isDME);E.set("candidates",this.getCandidates4Sortby());E.set("items",this.getSortByDefFromTokens().items||[]);}},getCandidates4Sortby:function T(){var U=this.candidates,E;if(U&&!this.noCache){E=A.filter(U.items,function(V){return V.t===J.TP.ATTR||V.t===J.TP.METRIC||V.st===J.STP.NDE;});if(this.isDME){E=B.getItems("sortby").concat(E);}}return{items:E||[],isComplete:U&&U.isComplete};},getSortByWidget:function D(E){var W=this,V=[{scriptClass:"mstrmojo.ME.SortByInputList",alias:"sortByWidgetList",cssClass:"sortBy mstrmojo-ME-sortby",cssDisplay:"table-cell"}],U={scriptClass:"mstrmojo.Label",alias:"sortByLabel",cssClass:"mstrmojo-ME-SortBy-label",cssDisplay:"table-cell",text:mstrmojo.desc(12852,"Sort By")};if(E){V.unshift(U);}return{scriptClass:"mstrmojo.Box",alias:"sortByContainer",cssClass:"mstrmojo-ME-SortBy-Container",cssDisplay:"table-row",visible:W.ios,postCreate:function(){W.sortByContainer=this;this.editor=W;},getTokens:function(){return this.sortByWidgetList.getTokens();},children:V};},getSortByDefFromTokens:function N(){var a=this.oi.tks.items,W=a.length,b,Y,U,V,X={};for(V=0;V<W;V++){b=a[V];Y=b.tp;U=b.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(b.v)&&(b.v!=="("&&b.v!==")")||b.v==="&gt;"||b.v==="&lt;"){continue;}switch(U){case 131072:if(Y===302){b=a[++V];while(b){if(b.tp!==282){if(b.oi){b.oi.selFrm=b.exv;var Z=a[V+1];if(Z.v==="Desc"&&Z.tp===259){b.oi.asc=1;V++;}X.items=X.items||[];X.items.push(b.oi);}else{if(b.tp===64){X.items=X.items||[];var E=b.v+a[++V].v;b=a[V+1];if(b.tp===43||b.tp===45){E+=a[++V].v;E+=a[++V].v;}X.items.push(B.getDimtyObject(E,this.isDME));}}}if((b=a[++V])["v"]===")"){break;}}}}}return X;},getSortByDefAsTokens:function O(){return this.sortByContainer.getTokens();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.List","mstrmojo.ui.LayoutBox","mstrmojo.ui.Splitter","mstrmojo.Refine.RefineFacetPanel","mstrmojo.Refine.RefineDataPreview","mstrmojo.Refine.RefineHistoryList");mstrmojo.Refine.RefinePanel=mstrmojo.declare(mstrmojo.ui.Splitter,null,{scriptClass:"mstrmojo.Refine.RefinePanel",alias:"refinePanel",cssClass:"refine-panal",markupString:'<div id="{@id}" class="mstrmojo-Splitter {@orientationCss} {@cssClass}"><div class="mstrmojo-SplitterPanel refine-transformation-panal"></div><div class="mstrmojo-SplitterHandle refine-panal-middle"></div><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-clearingDiv"></div></div>',setDimensions:function B(G,E){var C=parseInt(G,10);var F=parseInt(E,10);if(isNaN(C)||isNaN(F)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var D=Math.max(F,980);this.layoutConfig.w.firstSplitNode=D+"px";this.layoutConfig.w.resizeHandleNode=D+"px";this.layoutConfig.w.secondSplitNode=D+"px";if(this._super){this._super(C+"px",F+"px");}},postBuildRendering:function A(){this.setDimensions("0px","0px");this.setDimensions(this.parent.refinePanelNode.style.height,this.parent.refinePanelNode.style.width);if(this._super){this._super();}},handleSampleStatusChanged:function(){var C=this.bottomPanal.splitter.facetPanel;if(C&&C.hasRendered){C.resetAllFacets();}C.updateEngine(false);},config:{firstSplit:{v:"150px",min:"100px",max:undefined},secondSplit:{v:"100%",min:"100px",max:undefined},resizeHandle:{v:"2px"}},orientation:1,children:[{slot:"firstSplitNode",alias:"topPanal",scriptClass:"mstrmojo.ui.LayoutBox",cssClass:"refine-panal-top",setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.containerNode=C+"px";this.layoutConfig.w.containerNode=(E)+"px";if(mstrmojo.ui.LayoutBox.prototype.setDimensions){mstrmojo.ui.LayoutBox.prototype.setDimensions.call(this,C+"px",(E-22)+"px");}}},{slot:"secondSplitNode",alias:"bottomPanal",scriptClass:"mstrmojo.ui.LayoutBox",cssClass:"refine-panal-bottom",children:[{alias:"splitter",scriptClass:"mstrmojo.ui.Splitter",orientation:1,draggable:false,config:{firstSplit:{v:"100%"},secondSplit:{v:"120px"},resizeHandle:{v:"11px"}},children:[{slot:"secondSplitNode",alias:"facetPanel",scriptClass:"mstrmojo.Refine.RefineFacetPanel"}]}],setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.containerNode=(C-28)+"px";this.layoutConfig.w.containerNode=(E)+"px";if(mstrmojo.ui.LayoutBox.prototype.setDimensions){mstrmojo.ui.LayoutBox.prototype.setDimensions.call(this,C+"px",E+"px");}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBMappings","mstrmojo.DI.DIPreviewGrid");var A=mstrmojo.DI.DIConstants;mstrmojo.DI.DIPreviewSimpleGrid=mstrmojo.declare(mstrmojo.qb.QBMappings,null,{scriptClass:"mstrmojo.DI.DIPreviewSimpleGrid",cssClass:"lockHeader mstrmojo-di-mappingpreview",cssText:"position:relative;overflow:hidden;border:0px solid lightGrey;border-width:1px;border-bottom-right-radius:6px;border-bottom-left-radius:6px;padding:0px;",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{scriptClass:"mstrmojo.DI.DIPreviewGrid",alias:"content",columns:[],cssText:"overflow:hidden;",banding:false}],populate:function B(L){var H=mstrApp.getRootController(),C=H.model,E=C.importSources,D=L.data,G,F,J,I,K;G=E[D].currentMapping;F=E[D].currentPreview.data;J=this.content;I=L.selectedColumns;K=(G&&G.length>0);J.mappings=G;J.dataset=F;J.selectedColumns=I;J.set("visible",K);if(K){J.populatePreview();}else{H.raiseModelEvent({name:A.dataEvents.NO_DATA_RETURNED_EVENT});}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.Splitter","mstrmojo.qb.QBMappings");mstrmojo.requiresDescs(12735);var C="firstSplitNode",B="secondSplitNode";mstrmojo.qb.QBPageLayout=mstrmojo.declare(mstrmojo.ui.Splitter,null,{cssClass:"mstrmojo-qb-whole-panel",config:{firstSplit:{v:"20%",min:"150px",max:undefined},secondSplit:{v:"80%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function E(){return{w:36,h:0};},toggleDatabaseView:function A(F){this.toggleFirstItemVisibility(F);},toggleDataPreview:function D(F){this.workPanel.toggleSecondItemVisibility(F);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",slot:C,config:{firstSplit:{v:"40%",min:"100px"},secondSplit:{v:"60%",min:"100px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-main-panel",alias:"workPanel",slot:B,orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,getLayoutOffsets:function E(){return{h:0,w:12};},children:[{scriptClass:"mstrmojo.qb.QBPanel",slot:C},{scriptClass:"mstrmojo.qb.QBMappings",alias:"mappingPanel",slot:B}],config:{firstSplit:{v:"50%",min:"150px",max:undefined},secondSplit:{v:"50%",min:"150px",max:undefined},resizeHandle:{v:"5px"}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.HTMLButton","mstrmojo.CheckBox","mstrmojo.Editor","mstrmojo.HBox","mstrmojo.Label","mstrmojo.RadioButton","mstrmojo.warehouse.dbroles.DBRoleDSNConnection","mstrmojo.warehouse.dbroles.DBRoleSetting","mstrmojo.warehouse.obj.DBRole");mstrmojo.requiresDescs(10070,12933,12949,11139,8513,1162,11134,10071,1442,221);var G=mstrmojo.array,M=mstrmojo.string,K=mstrmojo.warehouse.EnumObjectTypes,B="PWDHIDDEN123!@#",L=57;function J(){var P=this,N=this.dbrole.mdDBRole,Q=M.trim(P.container.txtname.text),R;if(Q!==N.n){if(!mstrApp.getRootController().validateName(K.DBROLE,Q,N.n)){return false;}}if(P.container.txtlogin.visible){R=P.container.txtlogin.isValid();if(!R.val){mstrmojo.alert(R.msg);return false;}}if(P.container.txtpwd.visible){R=P.container.txtpwd.isValid();if(!R.val){mstrmojo.alert(R.msg);return false;}}if(P.container.dsnSelector.WHDSNLIST.selectedIndex===1){var O=P.container.dsninfo.dsnBox.dsnList.selectedItem;if(!O||O.des==="0"){mstrmojo.alert(mstrmojo.desc(10070,"Please select a DSN first"));return false;}}else{R=P.container.dsninfo.isValidInput();if(!R.val){mstrmojo.alert(R.msg);return false;}}return true;}function F(){var Q=this,V=this.container.dsninfo,R=this.dbrole.mdDBRole,O=this.config,N=R.connstr,P=this.container,S=false,T=function T(){V.clear();if(!N){var Y=window.localStorage,W=parseInt((Y&&Y.getItem("dbRoleDSNOption"))||0,10);if(W===0||S){P.dsnSelector.WHDSNLIST.set("selectedIndex",0);}else{P.dsnSelector.WHDSNLIST.set("selectedIndex",1);}}else{var X=(N.split("=")[0]).toUpperCase();if(X==="DSN"){P.dsnSelector.WHDSNLIST.set("selectedIndex",1);}else{P.dsnSelector.WHDSNLIST.set("selectedIndex",0);}}V.set("info",R);if(!R.shared){R.shared="0";}if(mstrApp.isSingleTier){P.sharedConnection.domNode.style.display="none";}else{P.sharedConnection.checked=(R.shared==="1");P.sharedConnection.refresh();}R.des=(mstrApp.rootController.isCloud()?R.n:"");R.ln=R.ln||"";P.txtlogin.set("text",R.ln);if(R.did===""){R.password=R.password||"";}else{R.password=R.password||B;}P.txtpwd.set("text",R.password);P.txtname.set("text",R.n||R.des);};if(O||mstrApp.isSingleTier){mstrApp.rootController.getDBObjects().reloadDSNs({success:function U(){T.call(Q);}});if(O.hideDSNOption||(mstrApp.isSingleTier&&navigator.userAgent.indexOf("Macintosh")>-1)){P.dsnSelector.domNode.style.display="none";S=true;}if(O.hideDriverCheck){P.dsninfo.set("hideDriverCheck",O.hideDriverCheck);}if(O.requiresLogin!==undefined){P.txtlogin.isRequired=O.requiresLogin;P.txtpwd.isRequired=O.requiresLogin;}if(O.dbIdFilter){P.dsninfo.dbIdFilter=O.dbIdFilter.sort(G.numSorter);}if(O.dbIdExcludeFilter){P.dsninfo.dbIdExcludeFilter=O.dbIdExcludeFilter.sort(G.numSorter);}if(O.dsnDbTypeExcludeFilter){P.dsninfo.dsnDbTypeExcludeFilter=O.dsnDbTypeExcludeFilter.sort(G.numSorter);}if(O.showAddDriver){P.dsninfo.set("showAddDriver",O.showAddDriver);}if(O.singleType){P.dsninfo.set("singleType",true);}if(O.cfgDbmsTypeExcludeFilter){P.dsninfo.set("cfgDbmsTypeExcludeFilter",O.cfgDbmsTypeExcludeFilter);}P.sharedConnection.set("visible",!(O.hideShareConnection||false));}else{T.call(Q);}}function H(T){var R=this;var U=this.container,P=U.dsninfo,N=this.dbrole.mdDBRole;if(mstrApp.rootController.isCloud()){N.des=M.trim(U.txtname.text);N.n=N.des+"___"+new Date().getTime();}else{N.n=M.trim(U.txtname.text);}N.des=N.des.replace(",","%%%");N.n=N.n.replace(",","%%%");N.dbr_type="2";N.owned="1";N.writable="1";if(U.sharedConnection.isChecked()){N.shared="1";}else{N.shared="0";}if(U.txtlogin.visible){N.ln=M.trim(U.txtlogin.text);}else{N.ln="";}if((U.txtpwd.text!==B)&&(U.txtpwd.visible)){N.password=U.txtpwd.text;}else{delete N.password;}var Q=P.getConnectionStr();N.connstr=Q.str;N.db_type=P.getDBType();N.cefu=P.getCharEncodingForUnix();N.driverMode=P.getDriverMode();N.odbcv=P.getOdbcv();N.dbms=P.getDbmsID();N.ab=P.getDBId();P.getVLDBProperties(N.vldbProperties);mstrApp.rootController.saveDBRole(this.dbrole,(N.did===""),{errorMsg:Q.err,success:function S(){if(R.callback&&R.callback.success){R.callback.success(R.dbrole);}if(T&&T.keepOpen){T.success();}else{R.close();}},complete:function O(){if(this.errorMsg!==""){mstrmojo.alert(this.errorMsg);}}});}function A(P,Q){var O=(P.dbrole?P:P.parent),N=O.dbrole.mdDBRole;if(N.writable==="1"&&mstrApp.rootController.hasPrivilege(L)){if(J.call(O)){H.call(O,Q);}}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}mstrmojo.warehouse.dbroles.DBRoleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleEditor",cssClass:"mstrmojo-wh-DBRoleEditor",title:mstrmojo.desc(12949,"Data Source"),zIndex:100,dbrole:undefined,useDSN:true,callback:mstrmojo.emptyFn(),onOpen:function C(){F.call(this);},onClose:function I(){if(this.callback&&this.callback.close){this.callback.close();}},container:undefined,dsnSelector:undefined,WHDSNLIST:undefined,dsninfo:undefined,txtlogin:undefined,txtpwd:undefined,sharedConnection:undefined,hideDSNOption:undefined,hideDriverCheck:undefined,requiresLogin:undefined,children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DBRoleEditor-container",alias:"container",children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DSNSelector",alias:"dsnSelector",children:[{scriptClass:"mstrmojo.ui.CheckList",cssClass:"mstrmojo-wh-DSNSelector-radio",multiSelect:false,orientation:"h",alias:"WHDSNLIST",items:[{did:"0",n:mstrmojo.desc(11132,"DSN less data sources")},{did:"1",n:mstrmojo.desc(11133,"DSN data sources")}],onchange:function(){if(this.selectedIndex===0){this.parent.parent.dsninfo.set("isDSNLess",true);}else{this.parent.parent.dsninfo.set("isDSNLess",false);}var N=window.localStorage;if(N){N.setItem("dbRoleDSNOption",this.selectedIndex);}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleEditor-info",text:mstrmojo.desc(11139,"Connection Information"),visible:false},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleDSNConnection",alias:"dsninfo",onEnterFn:function E(N){A(N.parent.parent);},updateLoginFn:function D(N){this.parent.txtlogin.set("visible",N);this.parent.txtpwd.set("visible",N);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtlogin",isRequired:true,caption:mstrmojo.desc(8513,"login:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtpwd",isPassword:true,hiddenPwd:B,isRequired:true,caption:mstrmojo.desc(1162,"password:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtname",caption:mstrmojo.desc(11134,"ds name:"),onEnter:function E(){A(this.parent.parent);}},{scriptClass:"mstrmojo.CheckBox",cssClass:"mstrmojo-wh-DBRoleEditor-infoCheckbox",alias:"sharedConnection",label:mstrmojo.desc(10071,"Share this connection with everybody")}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonsbox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button rightfloat mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){A(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"buttonCancel",onclick:function(){var N=this.parent.parent;if(N.onCancel){N.onCancel();}N.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo._IsList","mstrmojo.ListBase","mstrmojo.array","mstrmojo.string","mstrmojo.dom","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.Menu","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.menu.DBConnectionsMenu");mstrmojo.requiresDescs(2901);var H=mstrmojo.array,G=mstrmojo.dom,M=mstrmojo.string,C="item-mn",Q=mstrmojo.warehouse.EnumDataChangeEvents,N=mstrmojo.desc(2901,"Loading..."),J=57;function B(S){var U=S.item,R=this.items,T=H.find(R,"did",U.did);R[T]=U;this._getItemNode(T).outerHTML=this.itemRenderer.render(U,T,this);}function D(T){var U=T.item,S=this.items.concat(),R=H.find(S,"did",U.did);if(R>-1){S.splice(R,1);}this.set("items",S);}mstrmojo.warehouse.ui.DBConnectionsList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.architect.ui.DBConnectionsList",cssClass:"mstrmojo-wh-dbConnectionslist",selectionPolicy:"reselect",useRichTooltip:true,showTooltip:function L(S,V){var U=S.target||G.eventTarget(S.hWin,S.e),T=this.getItemFromTarget(U);if(U.className&&(U.className.indexOf("item-n")>-1)){U=U.parentNode;}if(T&&T.n&&(U.scrollWidth>U.clientWidth)){var R=G.position(U);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:M.encodeHtmlString(T.n+"",true),top:R.y+R.h+5,left:R.x};this._super(S,V);}},postBuildRendering:function A(){if(G.isChrome){G.attachEvent(this.domNode,"mousedown",function(R){if(R.which===2){G.stopPropogation(window,R);G.preventDefault(window,R);}});}if(this._super){this._super();}},init:function P(V){this._super(V);var X=this,W={},T=W[this.id]={};T[Q.DBROLES_REQUESTED]=function R(){var Y={n:N,tp:"0",isPrimary:function(){return false;}};X.set("items",[Y]);};T[Q.DBROLES_LOADED]=function U(Y){var Z=Y.offset||0;X.set("items",Y.items);if(Z>0){X.adjustScrollPosition(Z);}};T[Q.DBROLES_ADD]=function S(Y){X.addItems([Y.item]);};T[Q.DBROLE_CHANGED]=B;T[Q.DBROLES_RENAME]=B;T[Q.DBROLES_DELETE]=D;mstrApp.getRootController().attachDataChangeListeners(W);},getItemMarkup:function K(S){var R=(S.mdDBRole&&S.mdDBRole.shared==="1"?" shared":"");return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-ic'+R+'"></span><span class="item-n" >{@n}</span><span class='+C+"></span></div>";},getItemProps:function I(U,R){var V=!!this.selectedIndices[R],T=M.encodeHtmlString(U.n),S=mstrApp.rootController.hasPrivilege(J)?"":" hide-menu";return{sel:V,cls:"tp"+U.tp+(U.isPrimary()?" primary":"")+(V?" selected":"")+S,n:T,idx:R};},onclick:function O(Y){try{var U=Y.target||G.eventTarget(Y.hWin,Y.e),Z=G.findAncestorByAttr(U,"idx",true,this.domNode),X=Z&&parseInt(Z.value,10),R=this.items[X];if(U.className===C&&X!==null&&!isNaN(X)){var W=mstrmojo.warehouse.ui.DBConnectionsList,S=W.dbCtxMenu=W.dbCtxMenu||new mstrmojo.warehouse.menu.DBConnectionsMenu();S.data=R.data;var T=S.getMenuConfig();T.hostId=this.id;T.hostElement=U;T.isHostedWithin=false;T.hostProxyCssClass="item-mn-proxy";T.position=G.position(T.hostElement,true);this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:T}));}else{if(X!==null){this._super(Y);}}}catch(V){throw V;}},onchange:function E(){if(this.selectedItem){mstrApp.getRootController().setSelectedDBRoleID(this.selectedItem);}},adjustScrollPosition:function F(U){var R=this.domNode.clientHeight,T=this.domNode.scrollHeight,S=this.items.length;if(S>0&&T>R){this.domNode.scrollTop=U*(T/S);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.ui.TablesTree","mstrmojo.warehouse.menu.AvailableTablesMenu");mstrmojo.requiresDescs(2901);var R=mstrmojo.array,N=mstrmojo.hash,A=mstrmojo.string,S=mstrmojo.css,J="loading",C=mstrmojo.dom,L=mstrmojo.warehouse.EnumDataChangeEvents,K=mstrmojo.architect.EnumDragActions,F=mstrmojo.warehouse.EnumObjectTypes,M=mstrmojo.desc(2901,"Loading..."),Q;mstrmojo.warehouse.ui.AvailableTablesTree=mstrmojo.declare(mstrmojo.warehouse.ui.TablesTree,null,{scriptClass:"mstrmojo.architect.ui.AvailableTablesTree",cssClass:"mstrmojo-wh-AvailableTablesTree",tablesTreeHooks:{addItem:function(W,X){var V=mstrApp.getRootController();V.addTables([].concat(X));},isTable:function U(V){return V&&V.tp===F.TABLE;}},createAvatarFunc:undefined,positionAvatarFunc:undefined,useRichTooltip:true,showTooltip:function B(W,Y){var X=W.target||C.eventTarget(W.hWin,W.e);if(X.className&&(X.className.indexOf("item-n")>-1)){X=X.parentNode;}if(X.className.indexOf("item tp")>-1&&(X.scrollWidth>X.clientWidth)){var V=C.position(X);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:X.textContent,top:V.y+V.h+5,left:V.x};this._super(W,Y);}},init:function P(b){this._super(b);var c={},Y=mstrApp.getRootController(),W=c[this.id]={};W[L.DBTABLES_CHANGED]=function Z(e){if(!((this.sourceInfo===e.sourceInfo)||(e.sourceInfo==="")||(e.sourceInfo===undefined))){return ;}this.cleanUp();var h=e.selectedItems||[],g=this.selectedIndices={},f=e.items;R.forEach(h,function(j){g[R.find(f,"n",j)]=true;});this.expandedIndices=e.expandedIndices||{};this.set("items",f);if(this.domNode){this.domNode.onmousedown=function(j){C.preventDefault(window,j);};}};W[L.DBTABLES_REQUESTED]=function a(f){if(!((this.sourceInfo===f.sourceInfo)||(f.sourceInfo===""))){return ;}this.cleanUp();var g=[];g.push({n:M,tp:"0",isVisible:function e(){return true;}});this.set("items",g);S.toggleClass(this.getLeafNode(0),J,true);};W[L.DBTABLE_UPDATED]=function d(e){R.forEach(this.getItemWithPropName(this.items,"did",e.item.did),function(f){this.updateChild(f._renderIdx,e.item);},this);};W[L.DBTABLES_USED]=function X(e){var g=e.items||[],f=this.items;N.forEach(this.selectedIndices,function(h,j){this.toggleChildSelection(String(j),false);},this);R.forEach(g,function(h){this.toggleChildSelection(String(R.find(f,"n",h)),true);},this);};Y.attachDataChangeListeners(c);this.dataHelper={fetch:function V(e,f){if(e.tp===F.TABLE){Y.getColumnsForDBTable({data:e},f);}else{f.success({items:[]});}}};},createAvatar:function I(V){if(this.createAvatarFunc){return this.createAvatarFunc.call(this,V);}else{return this._super(V);}},positionAvatar:function E(W,V){if(this.positionAvatarFunc){this.positionAvatarFunc.call(this,W,V);}else{this._super(W,V);}},cleanUp:function H(){this.expandedIndices={};this.selectedIndices={};this.userSelections={};},onitemsChange:function O(V){if(this._super){this._super(V);}delete this._oldItems;},getItemProps:function T(X,Y,W){var V=A.encodeHtmlString((X.n&&(X.n+""))||"");return{tag:"div",cls:"item "+(X.tp?("tp"+X.tp):""),n:V,idx:W};},getMenuHelper:function D(){Q.menuHelper=Q.menuHelper||new mstrmojo.warehouse.menu.AvailableTablesMenu();return Q.menuHelper;},getDragAction:function G(W){var X=this.getNodeAttributes(W.src.node),V=X&&this.getTreeItem(X.index);switch(V&&V.tp){case F.TABLE:return K.ADD_TABLE;}}});Q=mstrmojo.warehouse.ui.AvailableTablesTree;}());(function(){mstrmojo.requiresCls("mstrmojo.DateTextBox","mstrmojo.Calendar","mstrmojo.Popup","mstrmojo._HasPopup","mstrmojo.DI.DICalendar","mstrmojo.css");mstrmojo.requiresDescs(13128,13129,13130);var G=mstrmojo.css,L=mstrmojo.date,E=mstrmojo.array,I=E.removeIndices,C=7;var B=["MM/DD/YYYY","today","yesterday"],D=/^\d+daysAgo$/;function H(){var O=this._lastOpened;if(O&&O.visible){var N=this.calendar.leftCal;var M=this.calendar.rightCal;N.updateView(N.currentView);M.updateView(M.currentView);}}function F(P,M,N){var O=L.getFirstDateOfMonth(P,M);return(O.getDay()-N+8)%C;}function J(N,M){return(L.compareDate(N,M)>0);}var K="MM/DD/YYYY";mstrmojo.DI.DIDateTextBox=mstrmojo.declare(mstrmojo.DateTextBox,null,{scriptClass:"mstrmojo.DI.DIDateTextBox",fromDate:"",toDate:"",disabled:false,cssClass:"mstrmjo-di-DateTextBox",calendar:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DateTextBox-calendar",locksHover:true,max:L.getDateJson(new Date()),slot:"popupNode",onOpen:function(){var R=this.opener,Q=R&&R.calendarZIndex,O=this.leftCal,P=this.rightCal,M=R&&R.calConfig,N;if(Q){this.domNode.style.zIndex=Q;}for(N in M){O.set(N,M[N]);P.set(N,M[N]);}},onvisibleChange:function(){var P=this.visible,N=this.opener.iconNode,O=this.opener.inputNode,M=" selected";N.className="mstrmojo-DateTextBox-icon";O.className="mstrmojo-DateTextBox-input";G.toggleClass(N,M,P);G.toggleClass(O,M,P);},getLeftCalendar:function(){return this.children[0];},getRightCalendar:function(){return this.children[1];},removeSelection:function(N){var Q=this.leftCal.selectedDates.length>0?this.leftCal:this.rightCal;if(Q.selectedDates.length>0){var O=Q.dayView.getElementsByTagName("div"),R=Q.selectedDates,M=R[N],P=F(M.year,M.month,Q.firstDayOfWeek);G.removeClass(O[P+M.day-1],["selected"]);I(R,N,1);}},children:[{scriptClass:"mstrmojo.DI.DICalendar",cssClass:"mstrmojo-di-calendar mstrmojo-Calendar-left",alias:"leftCal",bindings:{dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",changeValueOnOK:function(){var N=this.parent.opener.dtp,M=this.parent.opener.changeValueOnOK;return N===15||N===16||M;}}},{scriptClass:"mstrmojo.DI.DICalendar",cssClass:"mstrmojo-di-calendar mstrmojo-Calendar-right",alias:"rightCal",bindings:{dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",changeValueOnOK:function(){var N=this.parent.opener.dtp,M=this.parent.opener.changeValueOnOK;return N===15||N===16||M;}}}]},onclick:function(){this.calendarHandler();},onfocus:function(){this.calendarHandler();},onblur:function(){if(!this.disabled){var O=this._lastOpened,P=this._calendarConfig;if(this.value===""){this.set("value",K);}if(this.value.indexOf("-")!==-1){this.value=mstrmojo.string.multiReplace(this.value,{"-":"/"});}var M=mstrmojo.date.getDateJson(new Date(this.value));if(mstrmojo.array.indexOf(B,this.value)!==-1||D.test(this.value)){return ;}else{if(J(M,this.calendar.max)){var N=new Date();this.set("value",N.getMonth()+1+"/"+N.getDate()+"/"+N.getFullYear());}else{if(!mstrmojo.date.doesDateExist(M.month,M.day,M.year)){mstrApp.getRootController().displayError(mstrmojo.desc(13128,"Requests can only specify a date formatted as YYYY-MM-DD, ")+mstrmojo.desc(13129,"or as a relative date (e.g., today, yesterday, or NdaysAgo where N is a positive integer). ")+mstrmojo.desc(13130,"Please change your input into any of the aforementioned formats."),false);}else{this.set("value",M.month+"/"+M.day+"/"+M.year);}}}}},onkeyup:function A(M){M.e.which=M.e.which||M.e.keyCode;if(M.e.which===13){this.inputNode.blur();}},calendarHandler:function(){if(!this.disabled){if(this.value===K){this.set("value","");}var M=this._lastOpened,N=this._calendarConfig;this.fromDate=this.parent.fromDate;this.toDate=this.parent.toDate;if(!N){N={};if(this.calendarToBody){delete this.calendar.slot;N.placeholder=document.body.appendChild(document.createElement("div"));N.nudge=function(){var Q=this.opener;if(Q){var P=mstrmojo.dom.position(Q.popupNode,true),O=this.domNode.style;O.left=P.x+"px";O.top=P.y+"px";}};}this._calendarConfig=N;}if(M&&M.visible){this.closePopup();}else{this.openPopup("calendar",N);}}},onfromDateChange:function(){H.call(this);},ontoDateChange:function(){H.call(this);},onvalueChange:function(){H.call(this.parent.fromDate);H.call(this.parent.toDate);},ondisabledChange:function(M){this.inputNode.disabled=M.value;if(M.value===true&&this.inputNode.value!==""){this.set("value","MM/DD/YYYY");}},postBuildRendering:function(){if(this._super){this._super();}if(mstrmojo.dom.isIE){this.inputNode.style.lineHeight="23px";}this.inputNode.disabled=this.disabled;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DateTextBox");mstrmojo.DI.DIDateTextBox2=mstrmojo.declare(mstrmojo.DateTextBox,null,{scriptClass:"mstrmojo.DI.DIDateTextBox2",markupString:'<div id="{@id}" class="mstrmojo-DateTextBox {@cssClass}" style="{@cssText}"><input class="input" type="text" title="{@tooltip}"value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur /><div class="icon" mstrAttach:click> </div><div class="mstrmojo-DateTextBox-popup"></div></div>',disabled:false,calendar:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DateTextBox-calendar",locksHover:true,slot:"popupNode",onOpen:function(){var D=this.opener,C=D&&D.calendarZIndex,E=this.cal,A=D&&D.calConfig;if(C){this.domNode.style.zIndex=C;}for(var B in A){E.set(B,A[B]);}},children:[{scriptClass:"mstrmojo.Calendar",alias:"cal",duration:0,forceNonEmptySelection:true,bindings:{dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",changeValueOnOK:function(){var B=this.parent.opener.dtp,A=this.parent.opener.changeValueOnOK;return B===15||B===16||A;}},onValueUpdate:function(B){var D=this.parent&&this.parent.opener;if(D){var C=D.value,A=window.mstrConfig&&window.mstrConfig.listSep||";";if(D.isList&&!_S.isEmpty(C)){D.set("value",D.value+A+this.value);}else{D.set("value",this.value);}D.closePopup();}}}]},onclick:function(A){if(this.disabled===true){return ;}if(this._super){this._super();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.css","mstrmojo.registry","mstrmojo.AjaxCall","mstrmojo.hash","mstrmojo.array","mstrmojo.Arr","mstrmojo.expr","mstrmojo.dom","mstrmojo.mstr.EnumDataType","mstrmojo.Label","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.WidgetDial","mstrmojo.Calendar","mstrmojo.DateTextBox","mstrmojo.mstr.EnumNodeDimty","mstrmojo.ValidationTextBox","mstrmojo.ui.CheckList","mstrmojo.ui._HasScroller","mstrmojo.ui.ColumnContainer","mstrmojo.elementHelper");var AV=mstrmojo.css,AO=mstrmojo.registry,M=mstrmojo.hash,c=mstrmojo.mstr.EnumDataType,K=mstrmojo.array,t=K.map,L=mstrmojo.Arr,AR=mstrmojo.expr,b=AR.ET,n=AR.ET2TP,AH=AR.ET2TGT,O=AR.FN,AA=AR.FN_MRP,AP=AR.DTP,k=AR.DTP2FN_DTP,AK=mstrmojo.meta.TP,P=mstrmojo.meta.STP,AW=AR.TP,W=AR.STP,U=mstrmojo.elementHelper;var Ac={};Ac[b.AQ]={target:1,fm:1,fn:1,c0:1,c1:1};Ac[b.AL]={target:1,fm:1,fn:1,c0:1};Ac[b.AE]={target:1,fm:1,es:1};Ac[b.AC]={target:1,fm:1,fm2:1,fm3:1,fn:1,c0:1,c1:1};Ac[b.MQ]={target:1,fn:1,c0:1,c1:1,dmy:1};Ac[b.MC]=Ac[b.MQ];Ac["*"]={target:1};var B={};B[b.MQ]={key:"metricFns",def:AR.METRIC_FNS};B[b.MC]={key:"metricFns",def:AR.METRIC_FNS};B[b.AQ]={key:"formFns",def:AR.FORM_FNS};B[b.AL]={key:"formFns",def:AR.FORM_FNS};B[b.AC]={key:"formFns",def:AR.FORM_FNS};B[b.AE]={key:"elemFns",def:AR.ELEM_FNS};var AC=mstrmojo.desc(14084,"Select a filter option or a qualification."),AB=mstrmojo.desc(14085,"Select one or more elements."),z=mstrmojo.desc(14086,"Select an operator."),x=mstrmojo.desc(14087,"Enter a value or select an attribute from the list."),w=mstrmojo.desc(14088,"Select an attribute form. When done, click ## button.").replace("##",'""'),u=mstrmojo.desc(14089,"Select a condition."),q=mstrmojo.desc(14090,"Enter a value or select a metric from the list.");var AN=0,Aa=1;var H=mstrmojo.ui.ColumnContainer.prototype.updateColumnContainer;function F(Ah){var Ag=true,Ad=Ah.model,Ae,Af=Ad&&AR.fnCstCount(Ad.fn,Ad.fnt);if(!Ad){return ;}switch(Ad.et){case b.AQ:case b.AL:case b.MQ:for(Ae=0;Ae<Af;Ae++){Ag=Ag&&!Ah["invalid"+Ae];}break;}Ah.okBtn.set("visible",Ag&&!!Ad.completed);}function J(){var Ae=this.parent,Ad=((Ae&&Ae.cssText)||"").match(/height:\s*(\d*)px/);this.cssText=Ad&&Ad[0];}var Y="dummy",p={did:"idErr",v:"idErr",n:mstrmojo.desc(7929,"Error loading data."),t:Y,css:"unselectable"},A={did:"idWait",v:"idWait",n:mstrmojo.desc(2901,"Loading..."),t:Y,css:"unselectable"},AY={did:"idSelect",v:"idSelect",n:mstrmojo.desc(547,"Select"),t:Y,css:"unselectable"},AL={did:"idWait",v:"idQualification",n:mstrmojo.desc(5225,"Qualification"),t:Y,css:"unselectable"},a={did:"idAttribute",v:"idAttribute",n:mstrmojo.desc(518,"Attribute"),t:Y,css:"unselectable"},AG={did:"idMetric",v:"idMetric",n:mstrmojo.desc(517,"Metric"),t:Y,css:"unselectable"};function l(Af){if(this.updating){return ;}var Ag=this.multiSelect,Aj=this.selectedItem,Ai=Af&&Af.added,Ak=Af&&Af.removed;if(!Ag&&Ai&&Ak&&Ai[0]===Ak[0]){return ;}if(Aj&&Aj[AK]===Y){this.updating=true;if(Ag){this.removeSelect([this.selectedIndex]);}else{var Ae=Ak&&Number(Ak[0]);Ae=(Ae==null)?-1:Ae;this.set("selectedIndex",Ae);}this.updating=false;}else{var Ad=this.parent.parent.parent.model;if(Ag){var Ah=this.items;Ad.edit(this.alias,{added:Ai&&K.get(Ah,Ai),removed:Ak&&K.get(Ah,Ak),itemIdField:this.itemIdField});}else{Ad.edit(this.alias,Aj);}}}mstrmojo.rw.ConditionList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.rw.ConditionList",allowUnlistedValues:true,itemIdField:"did",getItemProps:function AT(Ah,Ad){var Ag=!!this.selectedIndices[Ad],Ai=Ah.n,Af=false;if(Ah.t===12){var Ae=K.filter(Ah.fs,function(Aj){return Aj.fgr>0;});if(Ae.length>0){Af=true;}}return M.copy({cls:(Ag?mstrmojo._IsList.SELECTED_CLS:"")+" "+(Ah.css||"")+" "+(Ah.t?("t"+Ah.t+((Ah.da||Ah.um)?"d":"")+(Af?"g":"")+(Ah.st?(" st"+Ah.st):"")):""),n:Ai||"&nbsp;"},this._super(Ah,Ad));},onselectionChange:function o(Ad){this._super(Ad);l.call(this,Ad);}});function AF(Af,Ah,Ae){var Ag=Af.items,Ad=K.indexOf(Ag,Ah);if((Ad===0)&&(Ag.length===1)){Ae=mstrmojo.Arr.makeObservable((Ae&&Ae.length)?Ae.concat():[]);Af.set("items",Ae);}else{if(Ad>-1){Ag.splice(Ad,1);}if(Ae&&Ae.length){K.insert(Ag,(Ad>-1)?Ad:Ag.length,Ae);}Af.refresh();}}function N(Ad){return mstrmojo.mixin(Ad,{scriptClass:"mstrmojo.rw.ConditionList",cssClass:"mstrmojo-"+Ad.alias,postCreate:J});}function V(Af,Ad,Ag){var Ae=Af.cfg;if(Ae){Ae.data=Af;Ae.parent=Ag;return AO.ref(Ae);}Ae=new mstrmojo.Label({text:Af.n||"&nbsp;",cssClass:"dial-item "+(Af.t?("t"+Af.t):"")});Ae.markupMethods.onselectedChange=function(){AV.toggleClass(this.domNode,["selected"],this.selected);};Ae.data=Af;Ae.parent=Ag;return Ae;}function f(Ae,Ad){var Af=Ad+AR.FN_SEP+Ae;return(Ae!=null)?{did:Af,n:Af}:null;}function AZ(Ad){return Ad.targets?K.filter(Ad.targets,function(Ae){return Ae[AK]===AR.TP.ATTR;}):[];}function Q(Af,Ae,Ag,Aj){Af.updating=true;if(Ae){if(Ag!=null){Af.clearSelect();Af.set("items",Ag);}var Ai=Af.itemIdField,Ah=Af.selectedItem;if((Ah&&Ah[Ai])!=(Aj&&Aj[Ai])){var Ad=Math.max(K.indexOf(t((Ag||[]),function(Ak){return Ak[Ai];}),Aj&&Aj[Ai]),0);Af.set("selectedIndex",Ad);}}Af.updating=false;}function AS(Ad,Ae,Ag,Af){Ad.updating=true;Ad.clearSelect();K.forEach(Ae,function(Ah){Ah.title=Ah.title||Ah.n||"";});if(Ae){Ad.set("items",Ae);}if(Ag&&Ag.length){Ad.setSelectedItems(Ag);}else{if(Af&&Af.length){Ad.select(Af);}}Ad.updating=false;}function AJ(Ae,Ad,Af,Ah,Ag){if(Ad){AS(Ae,Af,Ah,Ag);}}function AI(Af,Ae){var Ad=Af.model||{},Ag=Ad.fn;return(Ag!=null)&&((Ad.et===b.MQ)||(Ad.et===b.MC)||(Ad.et===b.AQ)||(Ad.et===b.AL)||(Ad.et===b.AC))&&(AR.fnCstCount(Ag,Ad.fnt)>Ae);}var e={};e[AP.DATE]=1;e[AP.TIME]=1;e[AP.TIMESTAMP]=1;function m(Ad,Af){var Ae;if(Af){switch(AH[Ad.et]){case"a":Ae=Af[b.AC];break;case"m":Ae=Af[b.MC];break;default:Ae=false;break;}}else{Ae=true;}return Ae&&AR.fn_AC_MC(Ad&&Ad.fn);}function j(Ae){var Ah=Ae&&n[Ae.et],Ag=Ae&&Ae.fm&&Ae.fm.dtp,Ad=Ag&&AR.DTP2PROMPT_STP[Ag],Af={};Af[Ah]=true;if(Ad){Af[Ad]=true;}return Af;}function d(Ad){switch(Ad){case c.DataTypeInteger:case c.DataTypeUnsigned:case c.DataTypeDecimal:case c.DataTypeReal:case c.DataTypeDouble:case c.DataTypeFloat:return c.DataTypeNumeric;default:return Ad;}}function C(Ae){var Ag=Ae.model,Al=Ag&&Ag[AH[Ag.et]]&&Ag[AH[Ag.et]][Ae.columnWalk.target.itemIdField],Af=Ag&&Ag.fm,Ad=Af&&Af.dtp,Ai=m(Ag,Ae.ets);if(this.targetsLastMod&&this.targetsLastMod===Ae.targetsLastMod&&Al&&Al===this._lastTargetId&&this.lastFmDtp===Ad&&this.lastFnTp===Ai){return ;}if(!Ai){this.clearSelect();this.set("items",this.items.slice(0,this.preLen));}else{var Aj=j(Ag),Am=Ag[AH[Ag.et]],Ah=Ag.a?[a]:Ag.m?[AG]:[],An=Ah.concat(AR.getSortedObjectsByTypeGroup(K.filter(Ae.targets,function(Ao){return(Ao.t!==4||Ao.did!==Am.did)&&(Aj[Ao[AK]]||Aj[Ao[P]]);}))),Ak=this.items.slice(this.preLen);K.forEach(Ak.reverse(),function(Ao){this.remove(Ao);},this);this.add(An,-1);}this._lastTargetId=Al;this.lastFnTp=Ai;this.lastFmDtp=Ad;this.targetsLastMod=Ae.targetsLastMod;}function AM(Aw,An){Aw.updating=true;var Aj=Aw.parent.parent.parent,Av=AI(Aj,An),Ap,Ar;if(Av){var Af=Aj.model||{},Ah=Af.cs,At=Ah&&Ah[An],Am=At&&At.v,Ak;C.call(Aw,Aj);switch(Af.et){case b.MQ:case b.MC:Ak=(At&&At.dtp)||d(Af.m.dt)||AR.METRIC_DTP;break;case b.AQ:case b.AC:case b.AE:Ak=Af.fm&&Af.fm.dtp;break;case b.AL:Ak=Af.fm&&Af.fm.dtp;Am=[];for(Ap=0,Ar=Ah&&Ah.length;Ap<Ar;Ap++){Am.push(Ah[Ap].v);}Am=Am.join(mstrConfig.listSep);break;}Ak=Ak||AP.CHAR;var Ai=Af.fn,Ao=AR.fn_List(Ai,Af.fnt),Aq=e[Ak],As=Aq&&!Ao;var Ae=Aw.ctxtBuilder,Ad=Ae&&Ae.itemWidgets,Au=Aq?(As?Aw.calIndex:Aw.dtxtIndex):Aw.txtIndex,Ag;for(Ap=0,Ar=Aw.preLen;Ap<Ar;Ap++){Ag=Ad[Ap];if(Ap==Au){Ag.set("dtp",Ak);Ag.set("isList",Ao);Ag.set("value",Am);Ag.set("visible",true);try{if(Aw.alias!=="c1"){Ag.focus&&Ag.focus();}}catch(Al){}if(Ai===1||Ai===2){Ag.constraints.min=0;}if(Ag.clearValidation){Ag.clearValidation();}}else{Ag.set("visible",false);}if(Ao){Ag.set("hint",mstrmojo.desc(8191,"value1## value2## ...## valueN").replace(/##/g,mstrConfig.listSep||";"));}else{Ag.set("hint","");}}if(Aj.hasPrompt&&Aw.selectedItem&&Aw.selectedItem.st===AR.STP.PROMPT_STRING){Aj.invalid0=false;}switch(Af.et){case b.AQ:case b.AL:case b.MQ:if(At&&At.p){Aw.set("selectedItem",At.p);}else{Aw.set("selectedIndex",Au);}break;case b.MC:case b.AC:Aw.set("selectedItem",Af[AH[Af.et]+(2+An)]);break;}}Aw.updating=false;}function h(){var Ag=this.parent,Ae=Ag.parent.parent.parent,Af=(this.isValid&&this.isValid())||(!this.isValid&&!mstrmojo.string.isEmpty(this.value)),Ad=Ae.model;Ae["invalid"+Ag.cstIndex]=!Af;if(!this.updating&&Af){this.updating=true;if(Ad){Ad.edit(Ag.alias,{v:this.value,dtp:this.dtp});}this.updating=false;}F(Ae);}function AU(){var Ae=this.parent,Ad=Ae.parent;Ad["invalid"+Ae.cstIndex]=false;}function AE(Ad){this.tip.set("text",Ad);}function D(Af){var Ah=this.selectedItem;Af=K.filter(Af,function(Ai){return(!Ai.icf);});if(Ah){var Ae=K.find(Af,this.itemIdField,Ah[this.itemIdField]);if(Ae>-1){Af=Af.concat();Af.splice(Ae,1);}}AF(this,A,Af);var Ag=this.items,Ad=Ag.length;if(Ad===1){this.singleSelect(0);}this.parent.updateScrollbars();}function I(Ae){var Ad=[{did:660,cfg:{scriptClass:"mstrmojo.ValidationTextBox",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP|mstrmojo.validation.TRIGGER.VALUESET},onValid:h,onInvalid:h,onClearValidation:AU,size:6,visible:false}},{did:154,cfg:{scriptClass:"mstrmojo.Calendar",onvalueChange:h,visible:false}},{did:23,cfg:{scriptClass:"mstrmojo.DateTextBox",cssText:"margin-left:9px;",cssDisplay:"inline-block",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL},onValid:h,onInvalid:h,onClearValidation:AU,calendarToBody:true,autoFormat:false,calConfig:{onmousedown:function(Af){mstrmojo.dom.stopPropogation(Af.hWin,Af.e);}},visible:false}}];return N(M.copy(Ae,{scriptClass:"mstrmojo.WidgetDial",makeObservable:true,itemFunction:V,selectionPolicy:"reselect",items:Ad.concat(),txtIndex:0,calIndex:2,dtxtIndex:2,preLen:Ad.length,insertUnlistedValuesAt:-1,itemIdField:"did",update:function(){AM(this,this.cstIndex);this.parent.updateScrollbars();},postCreate:function(){this._super();this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});},itemsEffect:undefined,onchange:l}));}function G(Ad){return N(M.copy(Ad,{insertUnlistedValuesAt:-1,postCreate:function(){J.apply(this,[]);this.ajx=mstrmojo.insert({parent:this,scriptClass:"mstrmojo.AjaxCall",isTask:true,readCache:true,writeCache:true,params:{taskId:"getAttributeForms",attributeId:null,displayedForms:"0",styleName:"MojoAttributeStyle"},onsuccess:function(){var Af=this.parent,Ae=this.response;if((Ae&&Ae.did)!==Af.lastAttrId){return ;}D.call(this.parent,Ae.fms||[]);},onerr:function(){AF(this.parent,A,[p]);}});},update:function(){var Ao=this.fmPost,Ag=this.parent.parent.parent,Ai=Ag.model,An=Ai&&Ai["a"+Ao],Al=!!An,Ah,Ak,Ap,Af=Ag.disableElementsBrowsing,Ae=An&&Af&&Af(An);if(Al){switch(Ai.et){case b.AQ:case b.AL:Ak=Ai.fm;break;case b.AC:Ak=Ai["fm"+Ao];break;case b.AE:Ak=f(Ai.fn,1);break;}if(this.lastAttrId!==An.did){this.lastAttrId=An.did;Ah=[];if(this.isFirstFm){if(!Ae&&(!An.ilk&&(!Ag.ets||Ag.ets[b.AE]))){Ah.push(AY);var Aj=B[b.AE],Am=Aj&&Aj.key;Ah=Ah.concat((Am&&Ag[Am])||Aj.def||[]);}Ah.push(AL);}if(Ak&&(Ai.et!==b.AE)){Ah.push(Ak);}Ap=this.ajx;Ap.params.attributeId=An.did;Ap.params.otp=An.t||12;Ah.push(A);L.makeObservable(Ah);}}if(Ae&&Ai.et===b.AE){Ak=null;}Q(this,Al,Ah,Ak);if(Al&&Ap){if(Ag.getAttributeForms){D.call(this,Ag.getAttributeForms(An.did)||[]);}else{if(An.fms){D.call(this,An.fms);}else{if(Ap){if(Ap._delayId){window.clearTimeout(Ap._delayId);delete Ap._delayId;}Ap._delayId=window.setTimeout(function(){delete Ap._delayId;Ap.send();},500);}}}}}}));}var AD=[AR.STP.PROMPT,AR.STP.PROMPT_OBJECTS,AR.STP.PROMPT_ELEMENTS,AR.STP.PROMPT_EXPRESSION,AR.STP.PROMPT_EXPRESSION_DRAFT];function Z(Ad){if(Ad&&!M.isEmpty(Ad)){var Ae=K.hash(AD);M.forEach(Ad,function(Ag,Af){if(Ag){Ae[n[Af]]=true;}});return Ae;}return null;}mstrmojo.rw.ConditionWalkProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.rw.ConditionWalkProvider",browseEs:function S(Ag,Af,Ai){Ag.openPopup("eb",{zIndex:Ag.parent.zIndex+10,left:Math.round(Ai.x)+"px",top:Math.round(Ai.y)+"px"});var Ae=Ag.eb.browser,Ad=Ag.model,Ah=Ad&&Ad.a&&Ad.a.did;if(!Ah){return ;}Ae.set("attributeID",Ah);Ae.set("selectedItems",Ad.es?M.clone(Ad.es):[]);Ae.initBrowser();},browseObjs:function AX(Ak,Ad,Ae){Ak.openPopup("ob",{zIndex:Ak.parent.zIndex+10,left:Math.round(Ae.x)+"px",top:Math.round(Ae.y)+"px"});var Af=Ak.ob.browser;Af.target=Ad;var Ag;switch(Ad.alias){case"dmy":Ag=[AR.TP.ATTR,AR.TP.DIM];break;case"c0":case"c1":var Ai=Ak.model,Ah=Ai&&Ai.et,Al=Ai&&Ai.fm,Aj=Al&&Al.dtp||(Ai.m?AR.DTP.DECIMAL:AR.DTP.UNKNOWN);Ag=(Ah===b.MQ||Ah===b.MC)?[AR.TP.METRIC,AR.DTP2PROMPT_STP[Aj]]:[AR.TP.ATTR,AR.DTP2PROMPT_STP[Aj]];break;default:Ag=Z(Ak.ets);Ag=Ag?M.keyarray(Ag,true):[AR.TP.ATTR,AR.TP.METRIC,AR.STP.REPORT_GRID,AR.STP.REPORT_GRAPH,AR.STP.REPORT_ENGINE,AR.STP.REPORT_TEXT,AR.STP.REPORT_DATAMART,AR.STP.REPORT_BASE,AR.STP.REPORT_GRIDGRAPH,AR.STP.REPORT_NONINTERACTIVE,AR.STP.FILTER].concat(AD);}Ag[Ag.length]=AR.TP.FOLDER;Af.browse({rootFolderType:Ai&&(Ai.et===b.MQ||Ai.et===b.MC)?5:26,folderLinksContextId:33,onSelectCB:[Ak,"onOBSelect"],browsableTypes:Ag.join(",")});},getFm2NodeProps:function AQ(){return{alias:"fm2",children:[G({alias:"fm2",fmPost:2})],updateColumnContainer:function Ad(){var Ae=this.parent.parent;this.fm2.update();AE.call(Ae,w);H.call(this);}};},getC0NodeProps:function E(){var Ad=this;return{alias:"c0",children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(527,"Value")},I({alias:"c0",cstIndex:0}),{scriptClass:"mstrmojo.Label",alias:"btwn",cssClass:"btwn",text:mstrmojo.desc(308,"and"),visible:false},I({alias:"c1",cstIndex:1,visible:false}),{alias:"browseLink",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7926,"Browse..."),onclick:function(){this.parent.parent.parent.browse(this.parent.c0);},visible:false}],updateColumnContainer:function Ae(){this.c0.update();var Ah=this.parent,Aj=Ah.parent,Ak=Ah.parent.model,Am=Ak&&Ak.fn,Ai=Am===O.BETWEEN||Am===O.NOT_BETWEEN||Am===AA.BETWEEN||Am===AA.BETWEEN_DESCENDING,Ag=Am===O.EQUAL||Am===O.NOT_EQUAL||Am===O.GREATER||Am===O.GREATER_EQUAL||Am===O.LESS||Am===O.LESS_EQUAL,Af=this.idx,Al=this.next;this.browseLink.set("visible",Aj.objectBrowsingEnabled&&m(Ak,Aj.ets));this.btwn.set("visible",Ai);this.c1.set("visible",Ai);if(Ai){this.c1.update();}else{Ak.edit("c1",{v:null,dtp:null,skipET:true});}if(Ak.a2&&Ag){if(!(Al&&Al.fm2)){Ah.insertAndRemoveTrailing(Af,Ad.getFm2NodeProps());}}else{Ah.removeTrailingContainer(Af);}AE.call(Aj,Ak.a?x:Ak.m?q:"");H.call(this);}};},getFnNodeProps:function Ab(){var Ad=this;return{alias:"fn",children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(9579,"Condition")},G({alias:"fn",allowUnlistedValues:false,update:function(){var Ak=this.parent.parent.parent,Ag=Ak.model||{},Al=Ag.et,Aj,Am=false,An,Af;switch(Al){case b.AE:Am=!!Ag.a;break;case b.AQ:case b.AC:case b.AL:Am=!!(Ag.fm&&Ag.fm.did);Aj=Am?Ag.fm.dtp:null;break;case b.MQ:case b.MC:Am=!!Ag.m;Aj=Am?AR.METRIC_DTP:null;break;}if(Am){var Ao=k[Aj];if((this.lastEt!==Al)||(this.lastFnDtp!==Ao)){this.lastEt=Al;this.lastFnDtp=Ao;var Ai=Al?B[Al]:null,Ah=Ai&&Ai.key;An=(Ah&&Ak[Ah])||Ai.def||[];if(typeof (An)==="object"){An=An[Ao]||An["*"];}}Af=f(Ag.fn,Ag.fnt||1);}Q(this,Am,An,Af);this.parent.updateScrollbars();}})],updateColumnContainer:function Ae(){this.fn.update();var Af=this.parent,Ag=Af.parent,Ah=Ag.model,Aj=Ah&&Ah.fn,Ai=this.next,Ak=Aj===O.IS_NULL||Aj===O.IS_NOT_NULL;if(Aj&&Ak){Af.removeTrailingContainer(this.idx);}else{if(Aj&&!(Ai&&Ai.c0)){Af.insertAndRemoveTrailing(this.idx,Ad.getC0NodeProps());}}AE.call(Ag,Ah.a?z:Ah.m?u:"");Ai=this.next;if(Ai){Ai.updateColumnContainer();}}};},getEsNodeProps:function T(){var Af=[{scriptClass:"mstrmojo.ui.CheckList",alias:"es",itemIdField:"v",allowUnlistedValues:true,insertUnlistedValuesAt:0,selectionPolicy:"toggle",postCreate:function Ae(){J.apply(this,[]);this.ajx=mstrmojo.insert({parent:this,scriptClass:"mstrmojo.AjaxCall",isTask:true,params:{taskId:"browseElements",attributeID:null,styleName:"MojoAttributeStyle",blockBegin:1,blockCount:mstrApp.elementsBlockCount||30},onsuccess:function(){var Aq=this.parent,Ak=this.response;if((Ak&&Ak.did)!==Aq.lastAttrId){return ;}var Am=(Ak&&Ak.es)?K.filter(Ak.es,function(Ar){return !U.isNullElem(Ar.v);}):[],Ap=Aq.parent.parent.parent.model&&Aq.parent.parent.parent.model.es,An=function(Ax,As){var Aw=Ax&&Ax.length||0,Av=As&&As.length||0,Ar=[],Au,At;for(Au=0;Au<Av;Au++){for(At=0;At<Aw;At++){if(As[Au].n===Ax[At].n){break;}}if(At===Aw){Ar.push(As[Au]);}}return Ar;},Ao=function(Ar,As,Av){var Au=[],At;K.forEach(Ar,function(Aw){At=K.filterOne(As,function(Ax){return Aw[Av]&&Ax[Av]&&Aw[Av]===Ax[Av];});if(At){Au.push(At);}});return Au.length===Ar.length?Au:Ar;};Ap=Ap&&Ao(Ap,Am,"v");if(Aq.allowUnlistedValues){var Al=An(Am,Ap);Am=(Aq.insertUnlistedValuesAt===0)?Al.concat(Am):Am.concat(Al);}AS(Aq,Am,Ap,null);Aq.parent.updateScrollbars();},onerr:function(){AF(this.parent,A,[p]);}});},onselectionChange:function Ai(Ak){mstrmojo.ListBase.prototype.onselectionChange.call(this,Ak);l.call(this,Ak);},update:function Ah(){var An=this.parent.parent.parent,Am=An.model,Ar=Am&&Am.a,As=!!Ar&&!Ar.ilk,At,Ak,Aq,Ao,Al,Au;if(As){if(this.lastAttrId!==Ar.did){this.lastAttrId=Ar.did;At=Am.es;Ao=At&&At.length;At=Ao?At.concat():[];At.push(A);if(Ao){Aq=[];for(Al=1;Al<=Ao;Al++){Aq[Al]=Al;}}Au=this.ajx;An.updateBrowseElementsParams(Au.params,Ar);}else{Ak=Am.es;}}AJ(this,As,At,Ak,Aq);if(As&&Au){if(An.getElements){var Ap=this;An.getElements(Ar,{success:function(Av){AS(Ap,Av.es||[],An.model&&An.model.es,null);Ap.parent.updateScrollbars();},failure:function(){AF(Ap,A,[p]);}});}else{Au.send();}}},setupScrollNodes:function Ag(){this.scrollNode=null;}}];if(!mstrApp.isSingleTier){Af.splice(0,0,{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7928,"Browse elements..."),onclick:function Ad(){this.parent.parent.parent.browse(this.parent.es);}});}return{alias:"es",children:Af,updateList:function(Ak){AJ(this.es,true,Ak,this.parent.parent.model.es,null);this.updateScrollbars();},updateColumnContainer:function Aj(){var Ak=this.parent.parent;this.es.update();AE.call(Ak,AB);}};},getFmNodeProps:function g(){var Ad=this;return{alias:"fm",children:[G({alias:"fm",fmPost:"",filter:false,isFirstFm:true})],updateColumnContainer:function Ae(){this.fm.update();var Ao=this.parent,Aj=Ao.parent,Ai=Aj.model,Al=Ai&&Ai.fm,An=this.idx,Am=Ai&&Ai.a,Ag=Aj.disableElementsBrowsing,Af=Am&&Ag&&Ag(Am);var Ak=(Ai.etWas&&Ai.etWas===b.AE)?Aa:AN,Ah=AN;if(Ai.et===b.AE&&!Af){Ah=Aa;}if(Ak!==Ah||Ah===AN){Ao.removeTrailingContainer(An);if(Ah===AN&&Al){Ao.addNextColumn(Ad.getFnNodeProps());}else{if(Ah===Aa){Ao.addNextColumn(Ad.getEsNodeProps());}}}AE.call(Aj,AC);H.call(this);}};},getTargetNodeProps:function R(){var Ad=this;return{alias:"target",target:null,browseLink:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(11859,"Based On")},N({alias:"target",insertUnlistedValuesAt:0,makeObservable:true,hideIfEmpty:true,postCreate:function(){this._super();this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});},onObjBrowsed:function(Ag){if(Ag.st===W.FILTER||Ag.t===AW.REPORT||Ag.t===AW.PROMPT){this.parent.parent.parent.onOK();}},update:function Af(){var Ah=this.parent.parent.parent,Ai=Ah.model,Al=Ah.targetsLastMod,Am=Ai&&Ai.et;if(this.lastModel!==Ai||this.targetsLastMod!==Al){this.lastModel=Ai;this.targetsLastMod=Al;var Ag=Ah.targets,An=Ah.ets;if(An&&Ag&&Ag.length){var Ak=Z(Ah.ets);Ag=K.filter(Ag,function(Ao){return Ak[Ao[AK]];});}var Aj=Ai&&Ai[AH[Am]];Q(this,true,AR.getSortedObjectsByTypeGroup(Ag),Aj);this.parent.updateScrollbars();}}}),{alias:"browseLink",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7926,"Browse..."),onclick:function(){this.parent.parent.parent.browse(this.parent.target);}}],updateColumnContainer:function Ae(){this.target.update();var Ah=this.parent,Ai=Ah.parent,Aj=Ai.model,Al=Aj&&Aj.et,Ag=this.idx,Ak=this.next;this.browseLink.set("visible",Ai.objectBrowsingEnabled);if(Al){switch(Al){case b.AQ:case b.AL:case b.AC:case b.AE:if(Aj.a&&!(Ak&&Ak.fm)){this.parent.insertAndRemoveTrailing(Ag,Ad.getFmNodeProps());}break;case b.MQ:case b.MC:if(Aj.m&&!(Ak&&Ak.fn)){this.parent.insertAndRemoveTrailing(Ag,Ad.getFnNodeProps());}break;case b.R:case b.F:case b.XML:this.parent.removeTrailingContainer(Ag);break;}}Ak=this.next;if(Ak){Ak.updateColumnContainer();}}};}});var X=mstrmojo.rw.ConditionWalkProvider;X.updateOkBtn=F;X.setTip=AE;X.getChildJSON=N;X.updateList=Q;X.fmJson=G;X.cstJson=I;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasPopup","mstrmojo.ui.ColumnWalk","mstrmojo.Button","mstrmojo.mstr.EnumNodeDimty","mstrmojo.ConditionModel","mstrmojo.rw.ConditionWalkProvider");var P=mstrmojo.Widget,H=mstrmojo.array,E=mstrmojo.dom,M=mstrmojo.hash,A=mstrmojo.mstr.EnumNodeDimty,S=mstrmojo.rw.ConditionWalkProvider.updateOkBtn,I=mstrmojo.rw.ConditionWalkProvider.setTip;var C=mstrmojo.desc(11899,"Select a dataset object.");var K=H.hash([A.NodeDimtyOutputLevel]);function D(){var T=this.model;if(T){if(!T.attachEventListener){mstrmojo.hash.make(T,mstrmojo.ConditionModel,{});}T.attachEventListener("edit",this.id,"onmodeledit");}}function L(U,T){if(T&&T.detachEventListener){T.detachEventListener("edit",U.id,"onmodeledit");}}function N(Y,T){var W=T,X=[],V=[],U=[],Z=false;M.forEach(W,function(a){X=X.concat(a.att.filter(function(b){return b.did===Y;}));});Z=X[0]&&X[0].da;X.forEach(function(a){V=V.concat(a.fs||[]);});V.forEach(function(a){if((a.obf||Z)&&U.filter(function(b){return b.did===a.fid;}).length===0){U.push({did:a.fid,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(a.bftp),n:a.fnm,t:a.t});}});return U;}mstrmojo.rw.ConditionWalk=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.rw.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="apply"></div></div>',markupSlots:{conditionNode:function(){return this.domNode.firstChild;},walkNode:function(){return this.domNode.children[1];},applyNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function J(){P.visibleMarkupMethod.call(this);if(this.visible){this.initWalk();}},onheightChange:P.heightMarkupMethod,onwidthChange:P.widthMarkupMethod},layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",applyNode:"auto"},xt:true},editor:undefined,columnWalk:undefined,tip:undefined,walkProvider:null,objectBrowsingEnabled:true,postCreate:function B(){if(this._super){this._super();}if(!this.walkProvider){this.walkProvider=mstrmojo.insert(mstrmojo.rw.ConditionWalkProvider);}},initWalk:function O(){var T=this.columnWalk,U=this.walkProvider;I.call(this,C);T.removeTrailingContainer(-1);T.addNextColumn(U.getTargetNodeProps());T.target.updateColumnContainer();S(this);},updateBrowseElementsParams:function(W,V){W.attributeID=V.did;W.otp=V.t||12;var U=this.editor,T=U&&U.onUpdateBrowseElementsParams;if(T){T.call(U,W,V);}},children:[{scriptClass:"mstrmojo.ui.ColumnWalk",alias:"columnWalk",slot:"walkNode",height:"333px",width:"750px"},{alias:"cancelBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"cancelBtn",title:mstrmojo.desc(2399,"Cancel"),ignoreLayout:true,onclick:function(){var T=this.parent;if(T.close){T.close();}}},{alias:"okBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"okBtn",title:mstrmojo.desc(2397,"OK"),onclick:function(){var T=this.parent;if(T.onOK){T.onOK();}}},{scriptClass:"mstrmojo.Label",alias:"tip",slot:"applyNode",cssClass:"tip",text:C,ignoreLayout:true}],eb:{scriptClass:"mstrmojo.Editor",cssClass:E.isIE7?"mstrmojo-ElementsEditorIE7":"mstrmojo-ElementsEditor",title:mstrmojo.desc(6149,"Select Elements"),help:"element_browser_dialog_box.htm",children:[{scriptClass:"mstrmojo.ElementsBrowser",alias:"browser",onUpdateBrowseElementsParams:function(U){var T=this.parent.opener;T.updateBrowseElementsParams(U,T.model.a);}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-WebButton hot",cssText:"width: 66px;",onclick:function(){var T=this.parent.parent,U=T&&T.opener;if(U){U.onEBSelect();U.closePopup();}}},{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-WebButton",cssText:"min-width: 66px; margin-left: 11px;",onclick:function(){var T=this.parent.parent,U=T&&T.opener;if(U){U.closePopup();}}}]}]},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",fishEyeVisible:false,upButtonVisible:true,scrollableIncFetch:true,showCompletePath:false,closeable:false,closeOnSelect:false,browsableTypes:"3,4,8,10,12,256",includeObjectDesc:true,quickSearch:true,minSearchLength:1}]},_set_model:function R(W,T){var U=this.model,V=(T!==U);if(V){L.call(this,U);T.dimtyTypes=this.dimtyTypes||K;this.model=T;D.call(this,T);if(this.hasRendered&&this.visible){this.columnWalk.target.updateColumnContainer();}}return V;},onmodeledit:function G(T){this.columnWalk[T.prop==="c1"?"c0":T.prop].updateColumnContainer();S(this);},browse:function F(V){var X=this.parent.editorNode,W=function(Z,b){var Y=mstrmojo.dom.position(Z,true),a=mstrmojo.dom.position(b,true);return{x:Y.x+Y.w,y:a.y};},T=this.columnWalk,U=this.walkProvider;switch(V&&V.alias){case"target":case"dmy":U.browseObjs(this,V,W(V.alias==="target"?T.target.domNode:this.dmyNode,X));break;case"c0":case"c1":U.browseObjs(this,V,W(T.c0.domNode,X));break;case"es":U.browseEs(this,V,W(T.es.domNode,X));break;}},onOBSelect:function(X){var V=this.ob.browser,Z=V.target;this.closePopup();var U=this.targets,Y=Z.itemIdField,W=U||[],T=H.find(U,Y,X[Y]);if(T===-1){W.push(X);this.targets=W;this.targetsLastMod=new Date();this.raiseEvent({name:"updateTargets",targets:this.targets});}Z.setSelectedItems([X],Z.multiSelect);if(Z.onObjBrowsed){Z.onObjBrowsed(X);}},onEBSelect:function(){var U=this.eb.browser,W=this.columnWalk.es.es;W.set("selectedIndices",{});var T=W.items,V=[];H.forEach(U.selectedItems||[],function(Y){if(H.find(W.items,"v",Y.v)<0){V.push(Y);}});var X=W.insertUnlistedValuesAt||0;if(X<0){X=T.length;}W.set("items",T.slice(0,X).concat(V).concat(T.slice(X)));W.setSelectedItems(U.selectedItems,false);},destroy:function Q(U){var T=this.walkProvider;if(T&&T.destroy){this.walkProvider.destroy();}this._super(U);}});mstrmojo.rw.ConditionWalk.getAttForms=N;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.DI.DITree","mstrmojo.DI.DIGATreeNode","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.DropDownList","mstrmojo.TextArea","mstrmojo.RadioList","mstrmojo.Widget","mstrmojo.DateTextBox","mstrmojo.DI.DIDateTextBox");mstrmojo.requiresDescs(146,147,1088,1995,12551,12552,12553,12554,12555,12556,12557,12558,12559,12560,12561,12562,12565,12566,12567,12568,12671,12672,12673,12674,12675);var J=mstrmojo.DI.DIConstants.sourceType;var M="mstrmojo-di-ga-label";var D="mstrmojo-di-ga-dropDownList";var C=["MM/DD/YYYY","today","yesterday"],F=/^\d+daysAgo$/;var H="###";var E=["308","200","100"];function I(){var O=this.parent;var P=0,N;if(!this.optionNode){return ;}if(this.optionNode.style.display==="block"){P++;}if(this.dateOptionNode.style.display==="block"){P++;}N=E[P];O.browser.domNode.style.height=N+"px";O.textarea.domNode.style.height=(N-10)+"px";O.browser.domNode.parentNode.style.height="";}function L(N){var O=(N.style.display==="none")?false:true;if(!O){N.style.display="block";this.set("text",mstrmojo.desc(1995,"Hide"));}else{N.style.display="none";this.set("text",mstrmojo.desc(1088,"Edit"));}I.call(this.parent);}function K(O,P){var Q=O.indexOf(P);if(Q===-1){return"";}var N=O.indexOf("&",Q+P.length)===-1?O.length:O.indexOf("&",Q+P.length);return O.substring(Q,N);}function B(P){var O;if(P.toUpperCase()==="MM/DD/YYYY"){O="YYYY-MM-DD";}else{if(mstrmojo.array.indexOf(C,P)!==-1||F.test(P)){O=P;}else{var N=mstrmojo.date.getDateJson(new Date(P));if(N.day.toString()!=="NaN"){O=mstrmojo.date.formatDateInfo(N,"yyyy-MM-dd");}else{mstrApp.getRootController().displayError(mstrmojo.desc(12565,"Requests can only specify a date formatted as YYYY-MM-DD, or as a relative date (e.g., today, yesterday, or NdaysAgo where N is a positive integer). Please change your input into any of the aforementioned formats."),false);}}}return O;}function G(N){var P="",O=N.dateTable;if(O.dates.idx===0){P="&start-date="+B(O.fromDate.value)+"&end-date="+B(O.toDate.value);}else{if(O.dates.idx!==0){P="&dynamic-date={"+O.dates.options[O.dates.idx].qn+"}";}}return P;}function A(N){var O,P;O=G(N);P="ids=ga:"+N.selectedProfile.id+"&dimensions=ga:source&metrics=ga:visits&segment=gaid::-11";if(O){P+=O;}return P;}mstrmojo.DI.DIAnalytics=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIAnalytics",cssClass:"mstrmojo-di-ga",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div class="cf sf-options"></div><div style="display:none;" class="mstrmojo-di-ga-options sf-options"></div><div class="cf sf-options"></div><div style="display:block;"class="mstrmojo-di-ga-options"></div><div class="cf sf-options"></div><div style="display:none;"></div><div></div></div>',markupSlots:{firstNode:function(){return this.domNode.children[0];},optionNode:function(){return this.domNode.children[1];},secondNode:function(){return this.domNode.children[2];},dateOptionNode:function(){return this.domNode.children[3];},thirdNode:function(){return this.domNode.children[4];},listHeaderNode:function(){return this.domNode.children[5];},listNode:function(){return this.domNode.children[6];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},account:undefined,webproperty:undefined,analyticsList:undefined,ultp:undefined,textarea:undefined,username:undefined,showPrv:undefined,fromDate:undefined,toDate:undefined,expand:false,selectedAccount:undefined,selectedWebProperty:undefined,fixObjectBrowserHeight:function(){I.call(this);},postCreate:function(){this.selectedAccount=null;this.selectedWebProperty=null;},children:[{slot:"firstNode",scriptClass:"mstrmojo.Label",cssClass:M,text:mstrmojo.desc(12549,"Select your Account, Web Property and Profile")},{scriptClass:"mstrmojo.Label",slot:"firstNode",alias:"edit",text:mstrmojo.desc(1088,"Edit"),cssClass:"mstrmojo-di-ga-collapsed",onclick:function(){L.call(this,this.parent.optionNode);}},{scriptClass:"mstrmojo.Table",alias:"accountTable",slot:"optionNode",rows:3,cols:2,children:[{scriptClass:"mstrmojo.Label",slot:"0,0",cssClass:"mstrmojo-di-ga-account-label",text:mstrmojo.desc(12566,"Account:")},{scriptClass:"mstrmojo.DropDownList",slot:"0,1",cssClass:D,selectCssClass:"mstrmojo-di-ga-dropDownList-select",alias:"account",onidxChange:function(){var O=this.parent.parent,N=O.model.externalSources[J.googleAnalytics];if(this.idx===undefined||this.idx<0){return ;}O.selectedAccount=N.accounts[this.idx];mstrApp.getRootController().getAnalyticsWebProperties(N.accounts[this.idx].id);}},{scriptClass:"mstrmojo.Label",slot:"1,0",text:mstrmojo.desc(12567,"Web Property:")},{scriptClass:"mstrmojo.DropDownList",slot:"1,1",cssClass:D,selectCssClass:"mstrmojo-di-ga-dropDownList-select",alias:"webproperty",onidxChange:function(){var N=this.parent.parent;if(this.idx===undefined||this.idx<0){return ;}if(this.idx!==-1){N.selectedWebProperty=N.selectedAccount.webProperties[this.idx];mstrApp.getRootController().getAnalyticsProfiles(N.selectedAccount.id,N.selectedAccount.webProperties[this.idx].id);}}},{scriptClass:"mstrmojo.Label",slot:"2,0",text:mstrmojo.desc(12568,"Profile:")},{scriptClass:"mstrmojo.DropDownList",slot:"2,1",cssClass:D,alias:"profiles",selectCssClass:"mstrmojo-di-ga-dropDownList-select",onidxChange:function(){var N=this.parent.parent;if(this.idx===undefined||this.idx<0){return ;}if(this.idx!==-1){N.selectedProfile=N.selectedWebProperty.profiles[this.idx];}},onvalueChange:function(){}}]},{slot:"secondNode",scriptClass:"mstrmojo.Label",cssClass:M,text:mstrmojo.desc(12550,"Select Date Range: ")},{scriptClass:"mstrmojo.Label",slot:"secondNode",alias:"edit",text:mstrmojo.desc(1995,"Hide"),cssClass:"mstrmojo-di-ga-collapsed",onclick:function(){L.call(this,this.parent.dateOptionNode);}},{slot:"dateOptionNode",scriptClass:"mstrmojo.Table",alias:"dateTable",rows:3,cols:2,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-date-label",slot:"0,0",text:mstrmojo.desc(12551,"Date Range: ")},{scriptClass:"mstrmojo.DropDownList",slot:"0,1",alias:"dates",selectCssClass:"mstrmojo-di-ga-dropDownList-select",options:[{n:mstrmojo.desc(12552,"Custom range"),qn:"Custom range",v:0},{n:mstrmojo.desc(12553,"Last 7 days"),qn:"Last 7 days",v:1},{n:mstrmojo.desc(12554,"This month"),qn:"This month",v:2},{n:mstrmojo.desc(12555,"Last month"),qn:"Last month",v:3},{n:mstrmojo.desc(12556,"Last 3 months"),qn:"Last 3 months",v:4},{n:mstrmojo.desc(12557,"Last 6 months"),qn:"Last 6 months",v:5},{n:mstrmojo.desc(12558,"Last 12 months"),qn:"Last 12 months",v:6},{n:mstrmojo.desc(12559,"This year"),qn:"This year",v:7},{n:mstrmojo.desc(12560,"Last year"),qn:"Last year",v:8}],idx:3,onidxChange:function(){switch(this.idx){case 0:this.parent.fromDate.set("disabled",false);this.parent.toDate.set("disabled",false);break;default:this.parent.fromDate.set("disabled",true);this.parent.toDate.set("disabled",true);break;}}},{scriptClass:"mstrmojo.Label",slot:"1,0",text:mstrmojo.desc(146,"From:")},{scriptClass:"mstrmojo.DI.DIDateTextBox",slot:"1,1",alias:"fromDate",cssDisplay:"inline-block",cssClass:"mstrmjo-di-DateTextBox fromDate",value:"MM/DD/YYYY",disabled:true,bindings:{toDate:function(){return this.parent.toDate.value;}}},{scriptClass:"mstrmojo.Label",slot:"2,0",text:mstrmojo.desc(147,"To: ")},{scriptClass:"mstrmojo.DI.DIDateTextBox",slot:"2,1",alias:"toDate",cssDisplay:"inline-block",cssClass:"mstrmjo-di-DateTextBox toDate",value:"MM/DD/YYYY",disabled:true,bindings:{fromDate:function(){return this.parent.fromDate.value;}}}]},{slot:"thirdNode",scriptClass:"mstrmojo.RadioListHoriz",cssClass:"upload-options",itemCssClass:"mstrojo-di-ga-upload-options-item",alias:"ultp",selectedIndex:0,onchange:function(){var N=mstrApp.getRootController();if(this.selectedIndex===0){if(this.parent.parent.browser.fileTree.selectedItem!==null){N.sourceSelected(true);}else{N.sourceSelected(false);}}else{if(this.selectedIndex===1){if(!this.parent.parent.textarea.value||this.parent.parent.textarea.value===""){var O=A.call(this,this.parent);this.parent.parent.textarea.set("value",O);this.parent.parent.textarea.domNode.style.display="block";this.parent.parent.textarea.domNode.focus();}N.sourceSelected(true);}}},postBuildRendering:function(){if(this._super){this._super();}var P=mstrApp.getRootController();var R=P.model;var Q=null,O=null,N;var T=null;var S=this;if(this.parent.tableID){T=R.getImportSource(this.parent.tableID);}if(this.parent.currentSource){T=this.parent.currentSource;}if(T&&T.sourceInfo){Q=T.sourceInfo.dbTableName;O=T.sourceInfo.url.substr("SQL=".length);N=O.indexOf(H);if(N>-1){O=O.substr(0,N);}if(Q.indexOf("CustomQuery")>-1||Q.indexOf("Google Analytics Query")>-1||T.sourceInfo.url.indexOf("folderName:")<0){O=mstrmojo.string.decodeHtmlString(O);this.parent.parent.textarea.set("value",O);this.set("selectedIndex",1);window.setTimeout(function(){S.parent.parent.textarea.domNode.focus();},0);}else{mstrApp.getRootController().sourceSelected(false);}}else{mstrApp.getRootController().sourceSelected(false);}},items:[{did:"0",n:mstrmojo.desc(12561,"Pick a report")},{did:"1",n:mstrmojo.desc(12562,"Write your own query")}]},{slot:"thirdNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-label link",text:mstrmojo.desc(12675,"Help: Query Explorer"),onclick:function(){mstrApp.showHelpTopic("importing_data_google_query_explorer.htm");},bindings:{visible:function(){return this.parent.ultp.selectedIndex===1;}}},{slot:"thirdNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-label link",text:mstrmojo.desc(12674,"Update Query"),onclick:function(){var R=this.parent.parent,T=R.textarea.value,P=R.domNode.scrollTop;var V=K(T,"ids=ga:");var U="ids=ga:"+R.analyticsComponent.selectedProfile.id.toString();var S=T.indexOf("&dynamic-date={")!==-1?K(T,"&dynamic-date={"):K(T,"&start-date=")+K(T,"&end-date=");var O=G(R.analyticsComponent);var N,Q;R.textarea.domNode.blur();if(V!==U){T=U+T.substr(T.indexOf("&"));R.textarea.set("value",T);}if(S!==O&&O!==""){if(T.indexOf("&dynamic-date={")!==-1){N=T.indexOf(S);T=T.substring(0,N)+O+T.substr(N+S.length);}else{if(T.indexOf("&start-date=")!==-1){N=T.indexOf("&start-date=");Q=T.indexOf("&",N+"&start-date=".length)===-1?T.length:T.indexOf("&",N+"&start-date=".length);T=T.substring(0,N)+T.substr(Q);}if(T.indexOf("&end-date=")!==-1){N=T.indexOf("&end-date=");Q=T.indexOf("&",N+"&end-date=".length)===-1?T.length:T.indexOf("&",N+"&end-date=".length);T=T.substring(0,N)+T.substr(Q);}T=T.trim()+O;}R.textarea.set("value",T);}R.textarea.domNode.focus();R.domNode.scrollTop=P;},bindings:{visible:function(){return this.parent.ultp.selectedIndex===1;}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.SearchablePulldown","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.NameSpacePullDown","mstrmojo.warehouse.ui.SearchBox");mstrmojo.requiresDescs(12260,9142,12259);var I=mstrmojo.array,J=mstrmojo.css,E="mstrmojo-wh-",G=mstrmojo.dom,A=mstrmojo.desc(12260,"%% Tables, Last cache update: $$"),K=mstrmojo.desc(9142,"Available Tables"),F=mstrmojo.desc(12259,"Catalog SQL"),P=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.ui.AvailableTablesPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",cssClass:"AvailableTables",title:K,dbTableTree:undefined,searchBox:undefined,nameSpaces:undefined,catalogSQLBtn:undefined,refreshBtn:undefined,catSQL:undefined,useRichTooltip:true,showTooltip:function L(Q,S){var R=Q.target||G.eventTarget(Q.hWin,Q.e);if(R===this.titleNode||R===this.titleTextNode){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.titleNode,top:32,content:this.titleTooltip};this._super(Q,S);}},init:function M(T){this._super(T);var W=this.searchBox,S=this.dbTableTree;W.attachEventListener("searchTriggered",this.id,function(X){S.userSelections={};mstrApp.getRootController().availableTableSearch(X.searchValue);});this.addNewTitleButton({alias:"catalogSQLBtn",title:F,cssClass:E+"catalogSQL hidden",onclick:function Q(){mstrApp.getRootController().displayCatalogSQL();}});var V=this,U={},R=U[this.id]={};R[P.DBTABLES_CHANGED]=function(X){V.set("titleTooltip",A.replace("%%",X.items.length.toString()).replace("$$",X.src.catalogStamp||""));};R[P.DBROLE_SELECTION]=function(Y){var Z=this,X=Y.src.dbrs[I.find(Y.src.dbrs,"did",Y.value)];W.tableBox.refreshBtn.set("visible",false);if(X){X.populate(function a(b){W.clearSearch(true);J.toggleClass(Z.catalogSQLBtn.domNode,"hidden",!(mstrApp.getRootController().canDisplayCatalogSQL(Y.src.dbObjects.dbTypes,b.mdDBRole.db_type)));W.tableBox.refreshBtn.set("visible",W._preSearch?W._preSearch():false);});}else{if(!Y.value){W.clearSearch(true);J.toggleClass(Z.catalogSQLBtn.domNode,"hidden",true);}}};mstrApp.getRootController().attachDataChangeListeners(U);},onheightChange:function B(Q){if(!this.nameSpaces.heightOffset){this.nameSpaces.heightOffset=21;}if(!this.heightOffset){this.heightOffset=85;}this.dbTableTree.set("height",parseInt(Q.value,10)-this.heightOffset-(this.nameSpaces.visible?this.nameSpaces.heightOffset:0)+"px");},onwidthChange:function D(Q){if(!this.searchBox.widthOffset){this.searchBox.widthOffset=0;}var R=parseInt(Q.value,10);this.searchBox.set("width",R-6-this.searchBox.widthOffset+"px");this.nameSpaces.set("width",R-12+"px");},children:[{alias:"nameSpaces",scriptClass:"mstrmojo.warehouse.ui.NameSpacePullDown",sourceInfo:"tablesPanel",nameSpacesLoaded:function C(){this.parent.searchBox.clearSearch(true);this.parent.onheightChange({value:this.parent.height});},onItemSelectedCallback:function O(Q){var R=this.parent.searchBox;R.clearSearch(true);mstrApp.getRootController().setNameSpaceID(Q.n);R.tableBox.refreshBtn.set("visible",R._preSearch?R._preSearch():false);}},{scriptClass:"mstrmojo.warehouse.ui.SearchBox",alias:"searchBox",_preSearch:function N(){if(this.parent.nameSpaces.visible){return(this.parent.nameSpaces.selectedIndex!==undefined);}return true;},_onRefresh:function H(){this.clearSearch(true);mstrApp.getRootController().handleDBTableRefresh();}},{alias:"dbTableTree",scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",sourceInfo:"tablesPanel",renderOnScroll:true}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.DataGrid","mstrmojo.dom","mstrmojo.Editor","mstrmojo.RadioButton","mstrmojo.architect.ui.SQLInputBox","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.NameSpacePullDown");var j=mstrmojo.array,c=mstrmojo.hash,D=mstrmojo.css,U=mstrmojo.dom,h="1",l="2",n="0",g="2",w="4",f=mstrmojo.warehouse.EnumNamespaceMode.ALL,m=mstrmojo.warehouse.EnumNamespaceMode.CURRENT,T="mstrmojo-ar-catSQL",u=mstrmojo.desc(12261,"Catalog Options"),b=mstrmojo.desc(12262,"Catalog mode"),P=mstrmojo.desc(12263,"Data source SQL"),W=mstrmojo.desc(12264,"ODBC calls"),V=mstrmojo.desc(8368,"Caching"),H=mstrmojo.desc(12265,"Table names only"),L=mstrmojo.desc(12266,"Table and column names"),q=mstrmojo.desc(2057,"None"),k=mstrmojo.desc(12267,"Cannot guarantee caching when using non-default SQL"),E=mstrmojo.desc(2177,"Close"),M=mstrmojo.desc(12268,"Namespaces"),F=mstrmojo.desc(3524,"All"),A=mstrmojo.desc(12269,"Current only"),J=mstrmojo.desc(12270,"SQL statement to retrieve table and column names for this data source"),Z=mstrmojo.desc(12271,"SQL statement to retrieve tables available in the data source"),X=mstrmojo.desc(12272,"SQL statement to retrieve columns for the selected tables"),I=mstrmojo.desc(3389,"Preview"),O=mstrmojo.desc(134,"Apply"),G=mstrmojo.desc(12273,"Use default value"),C={full:J,table:Z,column:X};var t;var Y;function S(x){return x.replace(/[ \n\r\t]/g,"");}function e(AF,AA,AC){var AB=new mstrmojo.Box({alias:"sqlBox",cssClass:T+"-sqlBox",defaultSQL:"",useDefaultSQL:function AE(){return(S(this.defaultSQL)===S(this.currentSQL));},currentSQL:"",resize:function z(){var AK=this.sqlText.domNode,AI=U.position(AK).h,AH=AK.offsetTop,AG=U.position(AK).w,AJ=this.curtain;AJ.domNode.style.height=AI+"px";AJ.domNode.style.width=AG+"px";AJ.domNode.style.top=AH+"px";},children:[{scriptClass:"mstrmojo.HBox",alias:"sqlHead",cssClass:"sqlSection-box",children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sqlLabel",text:C[AC]},{scriptClass:"mstrmojo.CheckBox",cssClass:T+"-check",alias:"sqlCheck",index:AC,label:G,oncheckedChange:function AD(){var AH=this.parent.parent,AG=AH.parent.parent.parent,AI;AH.curtain.set("visible",this.checked);if(this.checked){AH.sqlText.setSQLStatement(AH.defaultSQL);}else{if(!AG.loadingPanel){switch(AG.options.cacheMode.value){case n:AI=L;break;case g:if(this.index==="column"){return ;}AI=H;break;case w:return ;}mstrmojo.alert(k,undefined,V+": "+AI);}}}}]},{scriptClass:"mstrmojo.architect.ui.SQLInputBox",cssClass:"mstrmojo-ar-sqlInput-inputbox visible "+T,alias:"sqlText"},{scriptClass:"mstrmojo.Label",cssClass:T+"-curtain",alias:"curtain"}]});this.contents.rightPanel.addChildren([AB]);var x=AB.sqlText;D.toggleClass(x.domNode,"full",(this.options.cacheMode.value===n));AB.resize();AB.defaultSQL=AF[j.find(AF,"tp",AC)].sql;AB.currentSQL=AA[j.find(AA,"tp",AC)].sql;x.setSQLStatement(AB.currentSQL);AB.sqlHead.sqlCheck.checked=!AB.useDefaultSQL();AB.sqlHead.sqlCheck.set("checked",AB.useDefaultSQL());return AB;}function R(AF,AA,AD,z){var AC=this,AB,x,AE;x=AF[j.find(AF,"tp",AD)];AB=AA[j.find(AA,"tp",AD)];AE=AC.contents.rightPanel.children[z].sqlText.getSQLStatement();if(AE===x.sql){AE="";}AB.sql=AE;return AB;}function N(AC,AB,AA,x){var z,AF;if((AB.value===f)){z=c.cloneArray(AC.SQLStatements.currentSQLs.allNS);AF=c.cloneArray(AC.SQLStatements.defaultSQLs.allNS);if(AA.value===w){if(AC.supportsNameSpaces){z=c.cloneArray(AC.SQLStatements.currentSQLs.currentNS);AF=c.cloneArray(AC.SQLStatements.defaultSQLs.currentNS);}}else{if(AA.value===g){if(AC.supportsNameSpaces){var AE=AC.SQLStatements.currentSQLs.currentNS,AD=AC.SQLStatements.defaultSQLs.currentNS;z[j.find(z,"tp","column")]=AE[j.find(AE,"tp","column")];AF[j.find(AF,"tp","column")]=AD[j.find(AD,"tp","column")];}}}}else{z=c.cloneArray(AC.SQLStatements.currentSQLs.currentNS);AF=c.cloneArray(AC.SQLStatements.defaultSQLs.currentNS);}if(x){return z;}return AF;}function B(){var AB=this,z=new mstrmojo.Box({alias:"sqlPreviewBox",cssClass:T+"-sqlBox",children:[{scriptClass:"mstrmojo.Box",cssClass:T+"-preview",alias:"sqlPreviewContents",children:[{scriptClass:"mstrmojo.Table",alias:"sqlPreviewTable",rows:1,cols:3,children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sqlPreviewLabel",slot:"0,0",text:I},{scriptClass:"mstrmojo.warehouse.ui.NameSpacePullDown",alias:"nameSpaces",sourceInfo:"CatSQL",slot:"0,1",onItemSelectedCallback:function AC(AD){AB.selectedNS=AD.n;}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+T+"-button",slot:"0,2",text:O,onclick:function x(){var AG=AB.options,AD=AG.catalogMode,AH=AG.nsMode,AF=AG.cacheMode,AE,AJ,AI=[];AI.push(AD);AI.push(AH);AI.push(AF);if(AG.catalogMode.value===h){AE=N(AB,AH,AF,true);AJ=N(AB,AH,AF,false);switch(AF.value){case n:AI.push(R.call(AB,AJ,AE,"full",0));break;case g:AI.push(R.call(AB,AJ,AE,"table",0));AI.push(R.call(AB,AJ,AE,"column",1));break;case w:AI.push(R.call(AB,AJ,AE,"table",0));AI.push(R.call(AB,AJ,AE,"column",1));break;}}AB.onUpdateInfo({options:AI});if((AB.supportsNameSpaces&&AB.selectedNS)||(!AB.supportsNameSpaces)){mstrApp.rootController.availableTableSearch("",{dbRoleID:AB.dbRole.did,nameSpace:AB.selectedNS||"",getFresh:true,sourceInfo:"CatSQL"});}}}]}]},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",alias:"dbTableTree",cssClass:"mstrmojo-wh-AvailableTablesTree "+T+"-dbTablesTree",sourceInfo:"CatSQL",editor:AB,postCreate:function AA(){if(this.editor.options.catalogMode.value===l){this.cssClass+="-none";}}}]});this.contents.rightPanel.addChildren([z]);}function Q(){var x,z=this.parent.count,AA=this.parent.prefix;if(this.checked){for(x=0;x<z;x++){this.parent[AA+x].set("checked",false);}this.set("checked",true);}}function K(){var AC=this,z=AC.options,AB=AC.contents.rightPanel,x,AD,AA;if(AC.loading){return ;}this.loadingPanel=true;AB.removeChildren();if(z.catalogMode.value===h){x=N(AC,z.nsMode,z.cacheMode,true);AD=N(AC,z.nsMode,z.cacheMode,false);Y=[];switch(z.cacheMode.value){case n:AA=e.call(AC,AD,x,"full");Y.push(AA);break;case g:Y.push(e.call(AC,AD,x,"table"));Y.push(e.call(AC,AD,x,"column"));break;case w:Y.push(e.call(AC,AD,x,"table"));Y.push(e.call(AC,AD,x,"column"));break;}}B.call(AC);AC.contents.rightPanel.sqlPreviewBox.sqlPreviewContents.sqlPreviewTable.nameSpaces.domNode.style.visibility=(AC.supportsNameSpaces?"":"hidden");if(AC.supportsNameSpaces){mstrApp.rootController.getNameSpaces({dbRoleID:AC.dbRole.did,sourceInfo:"CatSQL"});}this.loadingPanel=false;}mstrmojo.warehouse.ui.editors.CatalogSQLEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.warehouse.ui.editors.CatalogSQLEditor",cssClass:T,title:u,options:{},SQLStatements:[],onUpdateInfo:undefined,supportsNameSpaces:false,dbRole:undefined,sql:"",curtain:undefined,useDefaultSQL:undefined,contents:undefined,rightPanel:undefined,sqlPreviewBox:undefined,sqlPreviewContents:undefined,sqlPreviewTable:undefined,leftPanel:undefined,currentSQLs:undefined,defaultSQLs:undefined,catalogModeRBBox:undefined,catalogModeRB0:undefined,catalogModeRB1:undefined,cacheMode:undefined,nsMode:undefined,catalogMode:undefined,sqlCheck:undefined,allNS:undefined,currentNS:undefined,cacheModeRBBox:undefined,nsModeRBBox:undefined,nsModeRB1:undefined,browserResized:function p(x){var z=parseInt(x.w,10);t=x;if(isNaN(z)||z<0||!this.domNode){return ;}if(z<800){z=760;}else{if(z>1063){z=1010;}else{z=Math.ceil(z*0.95);}}this.domNode.children[0].style.width=z+"px";this.contents.rightPanel.domNode.style.width=(z-219)+"px";j.forEach(Y,function(AA){AA.resize();});},onOpen:function d(){var AA=this.contents.leftPanel,z,AB,AC;this.loading=true;var x=(j.find(mstrApp.rootController.getDBObjects().catalogDbTypes,"v",this.dbRole.mdDBRole.db_type)>=0);AA.catalogModeRBBox.catalogModeRB0.set("enabled",x);if((this.options.catalogMode.value===h)&&x){z=0;}else{z=1;}AA.catalogModeRBBox["catalogModeRB"+z].set("checked",true);AA.catalogModeRBBox["catalogModeRB"+z].onclick();AA.nsModeRBBox.nsModeRB1.set("enabled",this.supportsNameSpaces);if(this.supportsNameSpaces){if(this.options.nsMode.value===n){z=0;}else{z=1;}}else{z=0;}AA.nsModeRBBox["nsModeRB"+z].set("checked",true);AA.nsModeRBBox["nsModeRB"+z].onclick();if(this.options.cacheMode.value===n){z=0;}else{if(this.options.cacheMode.value===g){z=1;}else{if(this.options.cacheMode.value===w){z=2;}}}AA.cacheModeRBBox["cacheModeRB"+z].set("checked",true);AA.cacheModeRBBox["cacheModeRB"+z].onclick();this.selectedNS=undefined;this.loading=false;K.call(this);AB=this.domNode.children[0];AC=parseInt(AB.style.top,10);if(AC<0){AB.style.top="0px";}if(t){this.browserResized(t);U.center(AB);}},children:[{scriptClass:"mstrmojo.HBox",alias:"contents",cssClass:"catsql-hbox",children:[{scriptClass:"mstrmojo.Box",cssClass:T+"-leftPanel",alias:"leftPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:b},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:2,prefix:"catalogModeRB",alias:"catalogModeRBBox",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:P,index:0,alias:"catalogModeRB0",onclick:function o(){Q.call(this);},oncheckedChange:function a(){}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:W,index:1,alias:"catalogModeRB1",onclick:function o(){Q.call(this);},oncheckedChange:function a(){var x=this.parent.parent.parent.parent;x.options.catalogMode.value=(this.checked?l:h);K.call(x);}}]},{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:M},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:2,alias:"nsModeRBBox",prefix:"nsModeRB",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:F,index:0,alias:"nsModeRB0",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var x=this.parent.parent.parent.parent;x.options.nsMode.value=f;K.call(x);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:A,index:1,alias:"nsModeRB1",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var x=this.parent.parent.parent.parent;x.options.nsMode.value=m;K.call(x);}}]},{scriptClass:"mstrmojo.Label",cssClass:T+"-sectionTitle",text:V},{scriptClass:"mstrmojo.Box",cssClass:T+"-sectionBox",count:3,alias:"cacheModeRBBox",prefix:"cacheModeRB",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:L,index:0,alias:"cacheModeRB0",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var x=this.parent.parent.parent.parent;x.options.cacheMode.value=n;K.call(x);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:H,index:1,alias:"cacheModeRB1",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var x=this.parent.parent.parent.parent;x.options.cacheMode.value=g;K.call(x);}},{scriptClass:"mstrmojo.RadioButton",cssClass:T+"-option",label:q,index:2,alias:"cacheModeRB2",onclick:function o(){Q.call(this);},oncheckedChange:function a(){if(!this.checked){return ;}var x=this.parent.parent.parent.parent;x.options.cacheMode.value=w;K.call(x);}}]}]},{scriptClass:"mstrmojo.Box",cssClass:T+"-rightPanel",alias:"rightPanel",children:[]}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+T+"-closeBtn",text:E,onclick:function o(){var x=this.parent.parent;j.forEach(x.contents.rightPanel.sqlPreviewBox.dbTableTree.items,function(z){delete z.items;});x.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.warehouse.ui.DBConnectionsList");mstrmojo.requiresDescs(13531,13532,13533,14034,14035);var E=57,D="reportDefLoaded",C=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.thirdParty.BISourceSelector=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.thirdParty.BISourceSelector",cssClass:"mstrmojo-qb-thirdParty-BISourceSelector",title:mstrmojo.desc(4381,"data sources"),newDBBtn:undefined,dbConnections:undefined,onheightChange:function B(G){if(!this.heightOffset){this.heightOffset=37;}this.dbConnections.set("height",parseInt(G.value,10)-this.heightOffset+"px");},children:[{scriptClass:"mstrmojo.Box",cssClass:"selector-panel-header cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"title-label",text:mstrmojo.desc(14034,"Select a source connection")+":"},{scriptClass:"mstrmojo.Button",cssClass:"add-connection-button",text:mstrmojo.desc(14035,"Add a new connection")+"...",onclick:function F(){if(mstrApp.rootController.hasPrivilege(E)){mstrApp.getRootController().editDBRole();}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}}]},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"source-type-selector",visible:false,items:[{id:0,n:"All"},{id:1,n:"SAP Business Objects"},{id:2,n:"OBIEE"},{id:3,n:"Cognos"}],selectedIndex:0,onitemSelected:function(G){this.parent.dbConnections.filterBySource(G.n);}},{scriptClass:"mstrmojo.warehouse.ui.DBConnectionsList",alias:"dbConnections",postCreate:function(){var H={},G=H[this.id]={};G[C.DBROLES_LOADED]=this.onDBRolesLoaded;G[D]=this.onReportDefLoaded;mstrApp.getRootController().attachDataChangeListeners(H);},onDBRolesLoaded:function(G){this.allDBRoles=G.items;},onReportDefLoaded:function(){var G=mstrApp.getRootController().model;this.singleSelectByField(G.SelDBRoleID,"did");},onchange:function(){var H=this.selectedItem,G=mstrApp.getRootController().model;if(H){G.SelDBRoleID=H.did;G.set("SelDBRoleName",H.n);}else{if(G.SelDBRoleID){this.singleSelectByField(G.SelDBRoleID,"did");}else{G.set("SelDBRoleName","");}}},filterBySource:function A(G){}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.DBConnectionsList");mstrmojo.requiresDescs(4381,11131,12933);var B=57;mstrmojo.warehouse.DBRoleSelector=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.DBRoleSelector",cssClass:"DBConnections",title:mstrmojo.desc(4381,"data sources"),newDBBtn:undefined,dbConnections:undefined,init:function C(D){this._super(D);this.addNewTitleButton({alias:"newDBBtn",cssClass:"mstrmojo-wh-addDB",title:mstrmojo.desc(11131,"New data source"),onclick:function E(){if(mstrApp.rootController.hasPrivilege(B)){mstrApp.getRootController().editDBRole();}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}});},onheightChange:function A(D){if(!this.heightOffset){this.heightOffset=30;}this.dbConnections.set("height",parseInt(D.value,10)-this.heightOffset+"px");},children:[{scriptClass:"mstrmojo.warehouse.ui.DBConnectionsList",alias:"dbConnections"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.qb.DataService","mstrmojo.DI.DIProjectDBRoleEditor","mstrmojo.DI.DIRemoteProjectDBRole");mstrmojo.requiresDescs(12815,13098);var E=mstrmojo.array;mstrmojo.DI.controller.DIRemoteProjectsController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIRemoteProjectsController",dbRoleID:"",hadoopConnURL:"",dbRole:"",saveDBRole:function J(P,O){var N=mstrApp.getRootController(),Q=this;O.set("visible",false);O.close();N.getDataService().saveDBRole({success:function R(S){Q.dbRoleID=S.dbr.did;N.model.raiseEvent({name:"projectDBRoleSaved",data:{dbrid:S.dbr.did,dbrn:S.dbr.n}});},fail:function M(S){mstrmojo.alert(S.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{dbroleinfo:JSON.stringify(P)});},deleteDBRole:function L(Q){var N=mstrApp.getRootController(),O=this;N.getDataService().deleteDBRole({success:function P(R){O.dbRoleID=undefined;O.dbRole=undefined;N.model.raiseEvent({name:"deleteDBRole"});},fail:function M(R){mstrmojo.alert(R.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{objectid:Q});},loadRemoteProjectsDBRole:function H(){var M=mstrApp.getRootController(),O=this,N=[];var P={success:function(Q){var R=Q.dbrs;if(R){E.forEach(R,function(S){if(S.dbr_type==="5"){N.push({dbrid:S.did,dbrn:S.n});}});}if(N){M.model.raiseEvent({name:"projectsDBRoleLoaded",data:N});}},failure:function(){O.displayError(mstrmojo.desc(12815,"Error when loading DB Roles."));}};M.getDataService().loadDBRoles(P,{});},loadDBRoleByID:function G(Q,O){var P=this,N=new mstrmojo.DI.DIRemoteProjectDBRole(),M=mstrApp.getRootController();N.mdDBRole.did=Q;N.populate(function(S){var R=S.mdDBRole.connstr;E.forEach(R.split(";"),function(U){var T=U.split("=");S[T[0].trim()]=T[1];});P.dbRoleID=Q;P.dbRole=N;if(O){M.model.raiseEvent({name:"DuplicateDBRole"});}else{M.model.raiseEvent({name:"DBRoleLoadedById"});}});},populateDBRole:function D(N,O){var M=mstrApp.getRootController();M.model.populateDBRole(N,O);},renderDBRoleEditor:function I(N){var M=mstrmojo.all.projectDBRoleEditor;if(M){M.set("dbrole",N);M.open();}else{mstrmojo.insert(new mstrmojo.DI.DIProjectDBRoleEditor({zIndex:9999}));M=mstrmojo.all.projectDBRoleEditor;M.set("dbrole",N);M.render();}},editDBRole:function F(M){this.loadDBRoleByID(M);},getProjectSourceFolderId:function K(N){var M=mstrApp.getRootController();var O={dbrid:N};var P={success:function(Q){mstrApp.getRootController().model.raiseEvent({name:"getFolderId",data:Q});},failure:function(){mstrApp.getRootController().model.raiseEvent({name:"getFolderIdFailure"});mstrmojo.alert(mstrmojo.desc(13098,"Invalid Username, Password. Please check your login credentials to browse the Project"));}};M.dataService.fetchRemoteFolderID(P,O);},getProjectsFromRemote:function A(Q,O){var M=mstrApp.getRootController();var N={serverName:Q,serverPort:O};var P={success:function(R){mstrApp.getRootController().model.raiseEvent({name:"projectsLoaded",data:R});},failure:function(){}};M.dataService.getProjectsFromRemote(P,N);},duplicateDBRole:function B(M){this.loadDBRoleByID(M,true);},duplicate:function C(){var M=this.dbRole,O=new mstrmojo.DI.DIRemoteProjectDBRole({mdDBRole:M.mdDBRole}),N="Duplicate "+M.n;O.hostname=M.hostname;O.Port=M.Port;O.ProjectID=M.ProjectID;O.did="";O.mdDBRole.did="";O.mdDBRole.n=N;O.n=N;O.des=N;O.mdDBRole.ln=M.mdDBRole.ln;O.mdDBRole.connstr="";delete O.mdDBRole.password;this.renderDBRoleEditor(O);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIPreviewSimpleGrid","mstrmojo.DI.DIFacebookPageItem");var I=mstrmojo.DI.DIConstants,A="grid",F="list",E="table",G=mstrmojo.DI.DIConstants.sourceType,J=mstrmojo.DI.DIFacebookPageItem;mstrmojo.DI.DIPreviewSimple=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPreviewSimple",cssClass:"mstrmojo-di-dataPreviewSimple",previewType:A,markupString:'<div id="{@id}" class ="mstrmojo-DI-previewSlot {@previewType}"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{mappings:function(){return this.domNode;}},getListItems:function(M){var N=M.mi.ca.value;var K=[],L,O;for(L in N){O=N[L];K.push({n:O.n,d:O.cat,id:O.auto_id,pg_id:O.id,picUrl:O.picurl,likes:this.addCommas(O.likes),whCount:O.whCount,taCount:O.taCount});}return K;},addCommas:function D(O){O+="";var K=O.split("."),N=K[0],L=K.length>1?"."+K[1]:"",M=/(\d+)(\d{3})/;while(M.test(N)){N=N.replace(M,"$1,$2");}return N+L;},getTableItems:function(O,P){var S=[],Q,T=this.content,R;if(O.mi.ca.value.length===undefined){R=O.mi.ca.value;S.push({scriptClass:"mstrmojo.DI.DIFacebookPageItem",n:R.n,desc:R.cat,pg_id:R.id,picUrl:R.picurl,likes:this.addCommas(R.likes),link:R.link,slot:"0,0",source:T,advancedProperties:P});}else{var N=O.mi.ca.value;for(Q in N){R=N[Q];var L=Q,U,K,M;if(L%3===0){K=L/3;M=0;}else{K=Math.floor(L/3);M=M+1;}U=K+","+M;S.push({scriptClass:"mstrmojo.DI.DIFacebookPageItem",n:R.n,desc:R.cat,pg_id:R.id,picUrl:R.picurl,likes:this.addCommas(R.likes),link:R.link,slot:U,source:T,advancedProperties:P});}}return S;},populate:function C(K){if(this.previewType===A){this.content.populate(K);}else{var L=mstrApp.getRootController().model.externalSources[G.facebook].reports;if(this.previewType===F){this.content.set("items",this.getListItems(L));this.content.set("selectedIndex",0);}else{if(this.previewType===E){if(this.content.children){this.content.children=[];}this.content.addChildren(this.getTableItems(L,this.parent.advancedProperties));this.content.refresh();}}}},toggleDataPreview:function B(K){this.parent.toggleDataPreview(K);},preBuildRendering:function H(){if(this._super){this._super();}var L=mstrApp.getRootController(),K=L.model;if(this.previewType===A){this.set("class","mstrmojo-DI-previewSlot grid");this.addChildren({scriptClass:"mstrmojo.DI.DIPreviewSimpleGrid",alias:"content",slot:"mappings",columns:[],cssText:"height:100%;"});}else{if(this.previewType===F){this.set("class","mstrmojo-DI-previewSlot list");this.addChildren({scriptClass:"mstrmojo.List",cssText:"background-color: 0xffffff; overflow-x: hidden; overflow-y: auto; width: 100%",onchange:function(){var N=document.getElementById("mstrmojo-DI-FBList-row"+this.selectedIndex);mstrmojo.css.toggleClass(N,"selected",true);},itemMarkupFunction:function(S,O){var Q=" class = mstrmojo-DI-FBList-row",N=S.picUrl,P="",T=' id="mstrmojo-DI-FBList-row'+O+'"',R='<p style= "margin:0px; font-size:10pt;">';return"<div"+Q+'><table cellpadding="0" cellspacing="0" style="width: 100%; padding-left: 10px"><tr'+T+'class = "mstrmojo-DI-FBList-row"><td style="vertical-align: middle; width: 20%;"><img src='+N+'> </td><td style="vertical-align: middle; width: 40%;">'+S.n+"</td><td"+P+' style="vertical-align: middle; width: 40%;">'+R+S.d+"</p>"+R+"Likes: "+S.likes+"</p></td></tr></table></div>";},slot:"mappings",alias:"content"});}else{if(this.previewType===E){this.set("class","mstrmojo-DI-previewSlot table");this.addChildren({scriptClass:"mstrmojo.Table",slot:"mappings",alias:"content",cssClass:"mstrmojo-di-facebook-previewTable",bindings:{rows:function(){return 20;}},cols:3,selectedItem:undefined,handleSelectionChange:function M(O){var N=this.selectedItem;if(N){N.setUnSelectedItem();}O.setSelectedItem();this.selectedItem=O;mstrApp.getRootController().sourceSelected(true);}});}}}},children:[]});}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.RefinePanel","mstrmojo.Refine.RefineDataPreview","mstrmojo.Refine.RefineSuggestionPreview","mstrmojo.Refine.RefineControlSplit","mstrmojo.Refine.RefineControlWhitespace","mstrmojo.Refine.RefineControlDelete","mstrmojo.Refine.RefineControlFacet","mstrmojo.Refine.RefineControlTransformCell","mstrmojo.Refine.RefineControlFindAndReplace","mstrmojo.Refine.RefineControlRemoveText","mstrmojo.Refine.RefineControlOther","mstrmojo.Refine.RefineSuggestions","mstrmojo.Refine.RefineControlExtract","mstrmojo.string","mstrmojo.array","mstrmojo.Refine.RefineTransformations","mstrmojo.Refine.RefineHelpers");mstrmojo.requiresDescs(12799);var K=mstrmojo.array,F=mstrmojo.Refine.RefineHelpers;function M(P){P=P.replace(/\n/g,"\\n");P=P.replace(/\t/g,"\\t");return P;}function L(P){return P.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}var A={};A.regex=function(){var Q={};var P=function(U){return[new RegExp(U),/\d+/];};var T=function(U){var V=[new RegExp(U),/[a-zA-Z]+/];if(U.toLowerCase()===U){V.push(/[a-z]+/);}else{if(U.toUpperCase()===U){V.push(/[A-Z]+/);}}return V;};var R=function(U){return[new RegExp(mstrmojo.string.regEscape(U))];};Q.candidates=function(W){if(W.length){var b=Q.parse(W[0].text,W[0].start,W[0].end),V=W.slice(0),Z,c,Y,X;Z=(b.on||[]).map(function(d){return{on:d};});var a=b.before,U=b.after;if(a===undefined||a.length===0){c=U.map(function(d){return{after:d,on:/.*/};});}else{if(U===undefined||U.length===0){c=a.map(function(d){return{before:d,on:/.*/};});}else{c=U.map(function(d){return{after:d,on:/.*/};}).concat(a.map(function(d){return{before:d,on:/.*/};}));}}X=Z.concat(c);if(V.length===0){return X;}X=X.filter(function(d){return V.filter(function(f){Y=A.regex.match(f.text,d);if(V.length===1){if((d.before===undefined)&&(d.after===undefined)){var e;if(d.on.source.length===1){e=d.on.source.charCodeAt(0);if(!(e>64&&e<91)&&!(e>96&&e<123)&&!(e>47&&e<58)){return false;}}if(d.on.source[0]==="\\"&&d.on.source.length===2){e=d.on.source.charCodeAt(1);if(!(e>64&&e<91)&&!(e>96&&e<123)&&!(e>47&&e<58)){return false;}}}}return(Y.length<2||((d.before===undefined)&&Y[1].start!==f.start)||((d.after===undefined)&&Y[1].end!==f.end));}).length===0;});return X;}return[];};var S=function(U){var V=U.map(function(W){return W.toString().replace(/^\/|\/$/g,"");}).join("");return new RegExp(V);};Q.parse=function(k,a,Z,e){k=String(k);var c=/([a-zA-Z]+)|([0-9]+)|([^a-zA-Z0-9])/g;var d=(k.substring(0,a).match(c)||[]).concat(k.substring(a,Z).match(c)||[]).concat(k.substring(Z).match(c)||[]);var j=e||{},U,l,Y,W,b=0,f,g,X,m=j.matchAfter||2,V=j.matchBefore||2;if(!Array.prototype.filter){Array.prototype.filter=function(t){var p=0,n=this&&this.length||0,o=[],q;for(;p<n;++p){q=this[p];if(t(q,p,this)){o.push(q);}}return o;};}if(!Array.prototype.map){Array.prototype.map=function(q){var p=0,n=this&&this.length||0,o=new Array(n);for(;p<n;++p){o[p]=q(this[p],p,this);}return o;};}if(!Array.prototype.reduce){Array.prototype.reduce=function(w,o){if(this===null){throw new TypeError("Array.prototype.reduce called on null or undefined");}if(typeof w!=="function"){throw new TypeError(w+" is not a function");}var q=Object(this),n=q.length>>>0,p=0,u;if(arguments.length===2){u=o;}else{while(p<n&&!(p in q)){p++;}if(p>=n){throw new TypeError("Reduce of empty array with no initial value");}u=q[p++];}for(;p<n;p++){if(p in q){u=w(u,q[p],p,q);}}return u;};}if(!Array.prototype.forEach){Array.prototype.forEach=function(p){var o=0,n=this&&this.length||0;for(;o<n;++o){p(this[o],o,this);}};}d=d.filter(function(n){return n!==null;});l=d.map(function(n,o){U=n.charCodeAt(0);if(a>=b&&a<b+n.length){Y=o;}if(Z>b&&Z<=b+n.length){W=o;}b+=n.length;if((U>64&&U<91)||(U>96&&U<123)){return T(n);}if(U>47&&U<58){return P(n);}return R(n);});if(Y===undefined){Y=d.length-1;}if(W===undefined){W=d.length-1;}if(W-Y>10){f=[[]];l.slice(Y,W+1).forEach(function(n){f[0].push(n[0]);});}else{f=l.slice(Y,W+1).reduce(function(o,n){var p=[];o.forEach(function(q){n.forEach(function(t){p.push(q.concat(t));});});return p;},[[]]);}var h=function(o,n){var p=[];if(o.length){o.forEach(function(q){n.forEach(function(t){p.push(q.concat(t));});});return o.concat(p);}return n.map(function(q){return[q];});};X=l.slice(Math.max(Y-m,0),Y).reverse().reduce(h,[]);g=l.slice(W+1,Math.min(W+V+1,l.length)).reduce(h,[]);return{on:f.map(S),after:(X||[]).map(function(n){return S(n.reverse());}),before:(g||[]).map(function(n){return S(n);})};};return Q;};A.regex.record=function(T,U,P,Q,S,R){return{text:T,start:U,end:P,col:Q,row:S,table:R};};A.regex.friendly_description=function(P){var Q=P.toString().replace(/^\/|\/$/g,"");Q=Q.replace(/\n/g,"newline");Q=Q.replace(/ /g," ");Q=Q.replace(/\t/g,"tab");Q=Q.replace(/\(?(\[0\-9\]|\\d)\+\)?/g,"any number");Q=Q.replace(/\(?(\[a\-z\A\-Z\]|\[A\-Z\a\-\z\])\+\)?/g,"any word");Q=Q.replace(/\(?(\[a\-z\])\+\)?/g,"any lowercase word");Q=Q.replace(/\(?(\[A\-Z\])\+\)?/g,"any uppercase word");Q=Q.replace("\\","");if(Q==="newline"){return Q;}return Q;};A.regex.match=function(X,Q){if(!X){return"";}var U=Q.max_splits;if(U===undefined){U=1;}var P={start:0,end:X.length,value:X};var W=[];var V=0;var R=Number(Q.which);var Y;if(isNaN(R)){R=1;}while(U<=0||V<U*R){var a=A.regex.matchOnce(P.value,Q);if(a.length>1){P=a[2];W.push(a[0]);W.push(a[1]);Y=0;}else{break;}V++;if(V>1000){break;}}W.push(P);Y=0;var Z=[];var T="";var S;for(S=0;S<W.length;++S){if(S%2===1){Y++;if(Y===R){Z.push({value:T,start:0,end:T.length});Z.push({start:T.length,end:T.length+W[S].value.length,value:W[S].value});Y=0;T="";continue;}}T+=W[S].value;}Z.push({start:0,end:T.length,value:T});return Z;};A.regex.matchOnce=function(b,T){var U=T.positions;var a=[];var Q,e;if(U&&U.length){if(U.length===2){if(b.length>=U[1]){Q=U[0];e=U[1];a.push({start:0,end:Q,value:b.substr(0,Q)});a.push({start:Q,end:e,value:b.substr(Q,e-Q)});a.push({start:e,end:b.length,value:b.substr(e)});return a;}return[{start:0,end:b.length,value:b}];}}var Z=T.before;var P=T.after;var X=T.on;var S=T.ignore_between;var d=b;var c=0;var W=0;var V;while(d.length){var Y=d;var R=0;W=c;if(S){V=d.match(S);if(V){Y=Y.substr(0,V.index);c+=V.index+V[0].length;d=d.substr(V.index+V[0].length);}else{d="";}}else{d="";}if(P){V=Y.match(P);if(V){R=V.index+V[0].length;Y=Y.substr(R);}else{continue;}}if(Z){V=Y.match(Z);if(V){Y=Y.substr(0,V.index);}else{continue;}}V=Y.match(X);if(V){Q=W+R+V.index;e=Q+V[0].length;a.push({start:0,end:Q,value:b.substr(0,Q)});a.push({start:Q,end:e,value:b.substr(Q,e-Q)});a.push({start:e,end:b.length,value:b.substr(e)});return a;}}return[{start:0,end:b.length,value:b}];};function I(){var P=this.model;var S={success:function(T){P.populateData(T);},failure:function(T){var U=mstrApp.getRootController();U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,T.message||"");}};var Q={},R={};Q={project:P.projectID,start:P.start,limit:P.limit};R={engine:this.model.engine};this.dataService.getPreviewData(S,Q,R);}function O(){var P=this.model;var R={success:function(S){P.populateColumns(S.columnModel);},failure:function(S){var T=mstrApp.getRootController();T.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,S.message||"");}};var Q;Q={project:P.projectID};this.dataService.getColumns(R,Q);}function D(){var P=this.model;var R={success:function(S){P.populateHistory(S);},failure:function(S){var T=mstrApp.getRootController();T.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,S.message||"");}};var Q={project:P.projectID};this.dataService.getHistory(R,Q);}function C(){var P=this.model;var Q=this;var S={success:function(V){P.populateOperations(V);Q.raiseEvent({name:"RefineStarted"});var W=Q.tableID;var U=mstrApp.getRootController();var T=U.model;var X=T.importSources[W];if(!X.inRefine){X.inRefine=true;X.RefineOperations=V.entries;}},failure:function(T){var U=mstrApp.getRootController();U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,T.message||"");}};var R={project:P.projectID};this.dataService.getOperations(S,R);}function B(S,T){var P=this;var R=this.model;var V={success:function(W){if(!W.processes.length){if(typeof T==="function"){T();}else{P.loadData();}}else{B.call(P,W.processes[0].progress/100);}},failure:function(W){var X=mstrApp.getRootController();X.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,W.message||"");}};var U={project:R.projectID};var Q={progress:0};if(S){Q.progress=S;}this.dataService.getProcesses(V,U,Q);}mstrmojo.Refine.RefineController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineController",refinePanel:null,parsePanel:null,records:[],start:function(P){if(!this.dataService){this.dataService=new mstrmojo.Refine.DataService({model:this.model,projectID:this.model.rpid,refineServerURL:P});}this.loadData();this.loadSampleStatus();this.model.attachEventListener("startChange",this.id,this.handleStartChanged);this.model.attachEventListener("columnUnSelected",this.id,this.handleColumnUnSelected);},applyOperations:function J(U,P){var T=this;var S=this.model;var W={success:function(Y){if(Y.code==="ok"){T.loadData();}else{if(Y.code==="pending"){B.call(T);}else{if(Y.code==="error"){T.loadData();var Z=mstrApp.getRootController();Z.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,Y.message||"");}}}},failure:function(Y){var Z=mstrApp.getRootController();Z.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,Y.message||"");}};var Q={project:S.projectID};var V=false,X=true;if(U.hasOwnProperty("lastDoneID")){for(var R=0;R<S.history.future.length;R++){if(S.history.future[R].op){V=true;}if(U.lastDoneID.toString()===S.history.future[R].id.toString()){X=false;break;}}}if(P){S.start=0;S.limit=50;if(S.hasAddSample()&&V&&!X){F.confirmFilldownOrBlankdown(function(){T.dataService.undoRedo(W,Q,U);});}else{this.dataService.undoRedo(W,Q,U);}}else{this.dataService.applyOperations(W,Q,U);}},MergeCluster:function H(U,T){var P=this;var Q=this.model;var S={success:function(V){if(V.code==="ok"){P.loadData();T();}else{if(V.code==="pending"){B.call(P);}}},failure:function(V){var W=mstrApp.getRootController();W.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}};var R={project:Q.projectID};this.dataService.massEdit(S,R,U);},computeFacets:function(){var Q=this;var P=this.model;var T={success:function(U){if(U.code==="error"){var V=mstrApp.getRootController();V.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,U.message||"");return ;}Q.refinePanel.bottomPanal.splitter.facetPanel.handleFacetsFetched(U);Q.refinePanel.topPanal.RefineTransformations.transformationList.setItems();I.call(Q);},failure:function(U){var V=mstrApp.getRootController();V.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,U.message||"");}};var S={engine:this.refinePanel?JSON.stringify(this.refinePanel.bottomPanal.splitter.facetPanel.getJSON(true)):this.model.engine};var R={project:P.projectID};this.dataService.computeFacets(T,R,S);},computeClusters:function(S){var P=this.model;var R={success:function(T){P.raiseEvent({name:"clustersFetched",clusters:T});P.raiseEvent({name:"columnUnSelected"});},failure:function(T){var U=mstrApp.getRootController();U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,T.message||"");}};var Q={project:P.projectID};this.dataService.computeClusters(R,Q,S);},loadData:function(){O.call(this);D.call(this);C.call(this);this.computeFacets();},rollBackOperations:function(U){var P=this;var Q=this.model;var S={project:Q.projectID};var R={success:function(){},failure:function(V){var W=mstrApp.getRootController();W.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}};var T={success:function(){P.dataService.applyOperations(R,S,U);},failure:function(V){var W=mstrApp.getRootController();W.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}};Q.start=0;Q.limit=50;this.dataService.undoRedo(T,S,{lastDoneID:0});},addFacets:function(Q,P){this.refinePanel.bottomPanal.splitter.facetPanel.addFacets(Q,P);},getRefinePanel:function G(){this.refinePanel=new mstrmojo.Refine.RefinePanel({controller:this});this.model.attachEventListener("sampleStatusChange",this.refinePanel.id,this.refinePanel.handleSampleStatusChanged);var Y=new mstrmojo.Refine.RefineDataPreview({controller:this});if(this.model.data.rows){Y.populate(this.model.data);}this.model.attachEventListener("dataChange",Y.id,Y.handleDataChanged);this.model.attachEventListener("columnsChange",Y.id,Y.handleColumnsChanged);this.model.attachEventListener("unHighlightSuggestion",Y.id,Y.handleUnHighlightSuggestion);this.model.attachEventListener("startChange",Y.id,Y.handleStartChange);this.model.attachEventListener("columnSelected",Y.id,Y.handleColumnSelected);this.model.attachEventListener("columnUnSelected",Y.id,Y.handleColumnUnSelected);Y.slot="firstSplitNode";Y.alias="refinePreview";this.refinePanel.bottomPanal.splitter.addChildren(Y);var c=new mstrmojo.Refine.RefineSuggestionPreview({controller:this});this.model.attachEventListener("previewSuggestion",c.id,c.handlePreviewSuggestion);this.model.attachEventListener("unPreviewSuggestion",c.id,c.handleUnPreviewSuggestion);this.model.attachEventListener("previewScrollTop",c.id,c.handlePreviewScrollTop);c.slot="firstSplitNode";this.refinePanel.bottomPanal.splitter.addChildren(c);var T=new mstrmojo.Refine.RefineTransformations({controller:this});this.model.attachEventListener("columnsChange",T.id,T.handleColumnsChanged);this.model.attachEventListener("columnSelected",T.id,T.handleColumnSelected);this.model.attachEventListener("columnUnSelected",T.id,T.handleColumnUnSelected);this.refinePanel.topPanal.addChildren([T]);var V=new mstrmojo.Refine.RefineHistoryList({controller:this});V.populate(this.model.history);this.model.attachEventListener("historyChange",V.id,V.handleListChanged);this.refinePanel.topPanal.addChildren([V]);var X=new mstrmojo.Refine.RefineControlSplit({controller:this,operations:this.model.transformations.split,parentBox:T});X.slot="controlNode";T.addChildren([X]);var W=new mstrmojo.Refine.RefineControlWhitespace({controller:this,operations:this.model.transformations.Whitespace,parentBox:T});W.slot="controlNode";T.addChildren([W]);var Q=new mstrmojo.Refine.RefineControlTransformCell({controller:this,operations:this.model.transformations.TransformCell,parentBox:T});Q.slot="controlNode";T.addChildren([Q]);var P=new mstrmojo.Refine.RefineControlDelete({controller:this,operations:this.model.transformations.Delete,parentBox:T});P.slot="controlNode";T.addChildren([P]);var Z=new mstrmojo.Refine.RefineControlExtract({controller:this,operations:this.model.transformations.Extract,parentBox:T});Z.slot="controlNode";T.addChildren([Z]);var R=new mstrmojo.Refine.RefineControlFacet({controller:this,operations:this.model.transformations.Facet,parentBox:T});R.slot="controlNode";T.addChildren([R]);var S=new mstrmojo.Refine.RefineControlFindAndReplace({controller:this,operations:this.model.transformations.FindAndReplace,parentBox:T});S.slot="controlNode";T.addChildren([S]);var b=new mstrmojo.Refine.RefineControlRemoveText({controller:this,operations:this.model.transformations.FindAndReplace,parentBox:T});b.slot="controlNode";T.addChildren([b]);var a=new mstrmojo.Refine.RefineControlOther({controller:this,operations:this.model.transformations.Other,parentBox:T});a.slot="controlNode";this.model.attachEventListener("columnsChange",a.id,a.handleColumnsChanged);this.model.attachEventListener("columnUnSelected",a.id,a.handleColumnUnSelected);T.addChildren([a]);var U=new mstrmojo.Refine.RefineSuggestions({controller:this});U.slot="suggestionsNode";T.addChildren([U]);this.model.attachEventListener("dataChange",U.id,U.handleDataChanged);this.model.attachEventListener("columnsChange",U.id,U.handleColumnsChanged);this.model.attachEventListener("gotSuggestions",U.id,U.handleGotSuggestions);this.model.attachEventListener("emptySuggestions",U.id,U.handleEmptySuggestions);return this.refinePanel;},generateSuggestions:function N(Y,T,d,g,m,X,R,P){var n=1,k,c,h,e=[];var W,o,Q;while(true){o=T+" "+n;Q=true;for(k=0;k<R.length;k++){if(o===R[k].name){Q=false;break;}}n++;if(Q){W=o;break;}}if(m===0){c=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));c.description=c.description.replace("[column name]",T);c.columnName=T;c.fieldLengths.push(X);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));h.operations=JSON.stringify([c]);h.startOffset=-1;h.endOffset=X;h.index=Y;e.push(h);}else{if(g===X){c=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));c.description=c.description.replace("[column name]",T);c.columnName=T;c.fieldForward=false;c.fieldLengths.push(X-m);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));h.operations=JSON.stringify([c]);h.startOffset=X-m;h.endOffset=-1;h.index=Y;e.push(h);}else{c=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));c.description=c.description.replace("[column name]",T);c.columnName=T;c.fieldLengths.push(m);c.fieldLengths.push(X-m);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));h.operations=JSON.stringify([c]);h.startOffset=m;h.endOffset=X;h.index=Y;e.push(h);}}var S={text:d,start:m,end:X,col:Y,cell:P};if(this.records.length===0||S.col===this.records[0].col){if(this.records.length>0){for(k=0;k<this.records.length;k++){if(this.records[k].cell===P){this.records.splice(k,1);}}}this.records.push(S);}else{if(this.records.length!==0){this.resetRecords();}this.records=[S];}P.highlightSelectedText(m,X);var Z,U=A.regex().candidates(this.records);while(this.records.length>0&&U.length===0){this.records[0].cell.resetText();this.records=this.records.slice(1);U=A.regex().candidates(this.records);}for(k=0;k<U.length;k++){Z=U[k];if(Z.before!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.split.beforeFirst));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.before.toString()));c.columnName=T;c.separator=Z.before.source;c.regex=true;c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[1]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.before),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.before;e.push(h);}else{if(Z.after!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.split.afterFirst));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.after.toString()));c.columnName=T;c.separator=Z.after.source;c.regex=true;c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[2]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.after),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.after;e.push(h);}else{c=JSON.parse(JSON.stringify(this.model.transformations.split.bySeparator));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.on.toString()));c.columnName=T;c.separator=Z.on.source;c.regex=true;c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[3]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.on),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.on;e.push(h);}}}for(k=0;k<U.length;k++){Z=U[k];if(Z.before!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.Extract.beforeFirst));c.description=c.description.replace("[new column name]",W);c.description=c.description.replace("[column name]",T);c.description=c.description.replace("[index]",Y+1);c.description=c.description.replace("####",M(Z.before.toString()));c.columnInsertIndex=Y+1;c.newColumnName=c.newColumnName.replace("[column name]",W);c.baseColumnName=c.baseColumnName.replace("[column name]",T);c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.before);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[0]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.before),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.before;e.push(h);}else{if(Z.after!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.Extract.afterFirst));c.description=c.description.replace("[new column name]",W);c.description=c.description.replace("[column name]",T);c.description=c.description.replace("[index]",Y+1);c.description=c.description.replace("####",M(Z.after.toString()));c.columnInsertIndex=Y+1;c.newColumnName=c.newColumnName.replace("[column name]",W);c.baseColumnName=c.baseColumnName.replace("[column name]",T);c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.after);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[1]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.after),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.after;e.push(h);}else{c=JSON.parse(JSON.stringify(this.model.transformations.Extract.on));c.description=c.description.replace("[new column name]",W);c.description=c.description.replace("[column name]",T);c.description=c.description.replace("[index]",Y+1);c.description=c.description.replace("####",M(Z.on.toString()));c.columnInsertIndex=Y+1;c.newColumnName=c.newColumnName.replace("[column name]",W);c.baseColumnName=c.baseColumnName.replace("[column name]",T);c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.on);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[2]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.on),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.on;e.push(h);}}}for(k=0;k<U.length;k++){Z=U[k];if(Z.before!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutBefore));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.before.toString()));c.columnName=T;c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.before);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[0]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.before),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.before;e.push(h);}else{if(Z.after!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutAfter));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.after.toString()));c.columnName=T;c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.after);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[1]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.after),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.after;e.push(h);}else{c=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutOn));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.on.toString()));c.columnName=T;c.expression=c.expression.replace("[separator]",Z.on);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[2]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.on),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.on;e.push(h);}}}c=JSON.parse(JSON.stringify(this.model.transformations.Delete.RowsContains));c.engineConfig.facets[0].query=d.substring(m,X);c.description=c.description.replace("####","'"+M(L(d.substring(m,X)))+"'");c.description=c.description.replace("[column name]",T);c.engineConfig.facets[0].name=c.engineConfig.facets[0].columnName=T;c.engineConfig.facets[0].mode="text";c.engineConfig.facets=c.engineConfig.facets.concat(JSON.parse(this.model.engine).facets);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.deleteRows[0]));h.description=h.description.replace("####","'"+mstrmojo.string.encodeHtmlString(M(L(d.substring(m,X))),false,true)+"'");h.operations=JSON.stringify([c]);e.push(h);var p=(window.innerWidth||document.documentElement.clientWidth);var f=P.domNode.getBoundingClientRect();var a=f.left;var b=p-f.right;var V=P.preview.domNode.getBoundingClientRect();var l={tableTop:V.top,cellLeft:f.left,cellRight:f.right,distanceToLeft:a,distanceToRight:b};this.model.raiseEvent({name:"gotSuggestions",src:this,list:e,cellPos:l});},generateColumnSuggestions:function E(P,Y,Z,U){var T,V,X=[];var R=this.refinePanel.bottomPanal.splitter.refinePreview;var W=R.data;var S=R.columns;var b=S[P].name;var c=W.rows[0]?W.rows[0].cells[S[P].cellIndex]:null,a="text";if(c){if(c.t){a="date";}else{if(typeof c.v==="string"||c.v instanceof String){a="text";}else{a="number";}}}if(Y){T=JSON.parse(JSON.stringify(this.model.transformations.Other.TransposeColumnsIntoRows));T.description=T.description.replace("####",U);T.description=T.description.replace("@@@@",Y);T.description=T.description.replace("@@@@","Transpose:key");T.description=T.description.replace("@@@@","Transpose:value");T.startColumnName=Y;T.keyColumnName="Transpose:key";T.valueColumnName="Transpose:value";T.columnCount=U;V=JSON.parse(JSON.stringify(this.model.suggestions.column[8]));V.description=V.description.replace("####",Y);V.description=V.description.replace("@@@@",Z);V.operations=JSON.stringify([T]);X.push(V);}T=JSON.parse(JSON.stringify(this.model.transformations.Delete.Colomn));T.description=T.description.replace("[column name]",b);T.columnName=b;V=JSON.parse(JSON.stringify(this.model.suggestions.column[0]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.fillDown));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[1]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.blankDown));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[2]));V.operations=JSON.stringify([T]);X.push(V);if(a==="text"){T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.titlecase));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[3]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.uppercase));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[4]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.lowercase));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[5]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.Whitespace.collapse));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[7]));V.operations=JSON.stringify([T]);X.push(V);}var Q=b;if(b.length>50){Q=b.substring(0,50)+"...";}T=JSON.parse(JSON.stringify(this.model.transformations.Delete.RowsBlank));T.description=T.description.replace("[column name]",b);T.engineConfig.facets[0].name=T.engineConfig.facets[0].columnName=b;T.engineConfig.facets=T.engineConfig.facets.concat(JSON.parse(this.model.engine).facets);V=JSON.parse(JSON.stringify(this.model.suggestions.column[6]));V.description=V.description.replace("[column name]",Q);V.operations=JSON.stringify([T]);X.push(V);this.model.raiseEvent({name:"gotSuggestions",src:this,list:X});},handleStartChanged:function(){I.call(this);},handleColumnUnSelected:function(){this.resetRecords();},resetRecords:function(){for(var P=0;P<this.records.length;P++){this.records[P].cell.resetText();}this.records=[];},setSampleData:function(Q){var S=this,T=mstrApp.getRootController(),P=S.model,U={project:P.projectID};function R(V){T.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}S.dataService.setSampleData({success:function(V){if(V.code==="error"){S.loadData();R(V);return ;}P.populateSampleStatus(V);S.loadData();},failure:R},U,{row_num:Q});},loadSampleStatus:function(){var R=this,S=mstrApp.getRootController(),P=R.model,T={project:P.projectID};function Q(U){S.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,U.message||"");}R.dataService.getSampleStatus({success:function(U){if(U.code==="error"){Q(U);return ;}if(U.hasSample){P.hasUploadData=true;P.populateSampleStatus(U);}else{P.hasUploadData=false;}},failure:Q},T);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.TransformInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-transform",items:[],noEditButton:true,folderLinksContextId:26,browsableTypes:[B.TP.FOLDER,B.TP.ROLE].join(","),getCandidatesThroughTaskCall:function A(E,D){mstrmojo.ME.MetricDataService.getTransformations(E,D);},hideItemWidgetBrowseButton:function C(){return this.isDME;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.ConditionInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-condition",folderLinksContextId:10,browsableTypes:[B.TP.FOLDER,B.TP.FILTER,B.STP.PROMPT_OBJECTS].join(","),noEditButton:true,maxObjectCount:1,getCandidatesThroughTaskCall:function A(D,C){D.rootFolderType=39;D.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getFilters(D,C);},hideItemWidgetBrowseButton:function(){return this.isDME;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ME.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME.Enum");mstrmojo.requiresDescs(1107,12178);var J=mstrmojo.expr,D=mstrmojo.ME.Enum.DYNAMIC_DIMTY;mstrmojo.ME.LevelInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-level",oncandidatesChange:function F(E){this.candidates.items=D.getItems("level").concat(this.candidates.items);},hidePulldownButton:function(){return !this.isDME;},hideItemWidgetBrowseButton:function(){return this.isDME;},folderLinksContextId:16,browsableTypes:[J.TP.FOLDER,J.TP.ATTR,J.TP.DIM].join(","),getCandidatesThroughTaskCall:function K(L,E){L.rootFolderType=39;L.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(L,E);},itemFunction:function B(M,E,L){M.filtering=M.filtering||1;M.grouping=M.grouping||1;var N=this._super(M,E,L,mstrmojo.ME.LevelObjectItem);N.optionButtonVisible=true;return N;},updateSuggestion:function C(E){E=[{n:this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level"),did:-1,t:-1,state:0}].concat(E);if(this._super){this._super(E);}},add:function H(L,E){var N=true,M=this.items;mstrmojo.array.forEach(L,function(O){mstrmojo.array.forEach(M,function(P){if(P.did&&P.did===O.did){N=false;return false;}});});if(N){this._super(L,E);}}});mstrmojo.ME.LevelObjectItem=mstrmojo.declare(mstrmojo.ME.ObjectItem,[mstrmojo._HasPopup],{optsRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9598,"Level Options"),cssText:"width: 450px;",onOpen:function A(){var E=this.opener.data;this.filterOption.set("value",E.filtering);this.groupOption.set("value",E.grouping);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9599,"Relationship with Report Filter:")},{scriptClass:"mstrmojo.Pulldown",alias:"filterOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9600,"Standard - Metric calculates only for elements found in the filter"),did:1},{n:mstrmojo.desc(9601,"Absolute - Raises the calculation to the selected level, if possible"),did:2},{n:mstrmojo.desc(9602,"Ignore - Omit filtering criteria based on selected level and its related attributes"),did:3},{n:mstrmojo.desc(9603,"None - Unspecified - the selected level and group components define the filter"),did:4}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9604,"Metric Aggregations:")},{scriptClass:"mstrmojo.Pulldown",alias:"groupOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9605,"Standard - Metric calculates at the selected level, if possible"),did:1},{n:mstrmojo.desc(9606,"None - Exclude the selected level and children from the GROUP BY clause in the SQL"),did:2},{n:mstrmojo.desc(9607,"Beginning lookup - Use the first value of the lookup table"),did:3},{n:mstrmojo.desc(9608,"Ending lookup - Use the last value of the lookup table"),did:4},{n:mstrmojo.desc(9609,"Beginning fact - Use the first value of the fact table"),did:5},{n:mstrmojo.desc(9610,"Ending fact - Use the last value of the fact table"),did:6}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,L=E.opener;if(L.saveOnClose){L.saveOnClose(E.filterOption.value,E.groupOption.value);}E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},saveOnClose:function G(E,M){var L=this.data;L.filtering=E;L.grouping=M;if(this.parent.onSaveOnClose){this.parent.onSaveOnClose();}},options:function I(){this.openPopup("optsRef",{title:'"'+this.data[this.itemField]+'" '+mstrmojo.desc(9598,"Level Options"),zIndex:40});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.css","mstrmojo.string","mstrmojo.qb.QBTableView","mstrmojo.qb.FFsqlEditor","mstrmojo.Label","mstrmojo.Table","mstrmojo.Button");mstrmojo.requiresDescs(2827,9130,9137,9141,9215,9927,12378,12417,13403);var K=mstrmojo.string,F=mstrmojo.css,D=mstrmojo.desc,H="on",N=mstrmojo.warehouse.EnumDataChangeEvents;var G=1,I=2;var B=mstrmojo.desc(9215,"Type multi-pass SQL or double-click a table name");mstrmojo.qb.Button=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.qb.Button",markupString:'<div id="{@id}" class="mstrmojo-Button mstrmojo-qb-Button {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:touchstart,click,mousedown,mouseup><div class="mstrmojo-qb-Button-icon {@innerIconClass}"></div><div class="mstrmojo-Button-text mstrmojo-qb-Button-text {@innerIconClass}"></div></div>',markupSlots:{iconNode:function(){return this.domNode.firstChild;},textNode:function(){return this.domNode.lastChild;}},postBuildRendering:function(){var P;if(this._super){P=this._super();}var O=this;this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:this.text||""});if(!this._ontooltipover){this._ontooltipover=function(Q){var R=O.textNode;if(R.offsetWidth<R.scrollWidth){O.showTooltip(Q,self);}};this._ontooltipout=function(Q){var R=O.textNode;if(R.offsetWidth<R.scrollWidth){O.hideTooltip(Q,self);}};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return P;}});mstrmojo.qb.QBPanel=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.QBPanel",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},cssText:"position:relative;",mode:G,children:[{scriptClass:"mstrmojo.Box",alias:"header",cssClass:"mstrmojo-qb-tableview-toolbar",children:[{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon play",text:D(9130,"Execute SQL"),postCreate:function L(){var P={},O=P[this.id]={};O[N.DBTABLES_ENABLED]=function(Q){this.set("enabled",Q.value);};mstrApp.getRootController().attachDataChangeListeners(P);},onclick:function(){var P=mstrApp.getRootController(),O=this.parent.parent;if(O.mode===G){P.autoMap();}else{P.autoMapFFSQL(O.SQL.ffsql.getSQLstmt());}}},{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon erase",text:D(2827,"Clear"),bindings:{visible:function(){return this.parent.parent.mode===I;}},postCreate:function L(){var P={},O=P[this.id]={};O[N.DBTABLES_ENABLED]=function(Q){this.set("enabled",Q.value);};mstrApp.getRootController().attachDataChangeListeners(P);},onclick:function M(){var P=this.parent.parent.SQL,Q=P.ffsql,O=mstrApp.getRootController();Q.clearTokens();P.updatepasses();O.autoMapFFSQL("");if(O.canAddTableSQL(true,"")){O.enableAvailableTables();}}},{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon refresh",text:D(9927,"Update Tables"),bindings:{visible:function(){return(this.parent.parent.mode===G&&!mstrApp.isBigQuery);}},onclick:function(){mstrApp.getRootController().updateTableStructure();}},{scriptClass:"mstrmojo.Label",cssClass:"condition",text:D(12378,"Filter..."),postBuildRendering:function A(){var P=this;mstrApp.getRootController().attachEventListener("reportModeChange",this.id,function(Q){P.set("visible",Q.mode!==2);});var O;if(this._super){O=this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:D(12378,"Filter...")});if(!this._ontooltipover){this._ontooltipover=function(Q){P.showTooltip(Q,self);};this._ontooltipout=function(Q){P.hideTooltip(Q,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return O;},onclick:function(){mstrApp.getRootController().openConditionDialog();}},{scriptClass:"mstrmojo.Button",cssClass:"FFSQL_QB_converter",useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-A",top:32,posType:mstrmojo.tooltip.POS_TOPLEFT},bindings:{text:function(){var O=this.parent.parent.mode===G;return O?D(9137,"Edit SQL"):D(13403,"Switch to Build a Query");},visible:function(){return !mstrApp.isFFSQL;}},onclick:function(){if(!mstrApp.isCloudPro||mstrApp.said){mstrApp.getRootController().convertMode(this.parent.parent.mode===G);}},postBuildRendering:function A(){var Q=this;var P;if(this._super){P=this._super();}var O;if(!this._ontooltipover){this._ontooltipover=function(R){if(R.relatedTarget!==Q.domNode&&R.relatedTarget!==Q.domNode.childNodes[0]){O=mstrApp.isCloudPro?D(12417,"View SQL"):D(9137,"Edit SQL");Q.richTooltip.refNode=Q.domNode;if(Q.parent.parent.mode===G){mstrApp.getRootController().getSQLPreview({success:function T(U){Q.richTooltip.content=U?O+"<br><br>"+U.replace("\n","<br>"):O;Q.showTooltip(R,self);},failure:function S(){Q.richTooltip.content=O;Q.showTooltip(R,self);}});}else{Q.richTooltip.content=Q.text;Q.showTooltip(R,self);}}};this._ontooltipout=function(R){Q.hideTooltip(R,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return P;}}]},{scriptClass:"mstrmojo.qb.QBTableView",cssClass:"mstrmojo-qb-tableview on",alias:"tables",bindings:{visible:function(){return(this.parent.mode===G);}}},{scriptClass:"mstrmojo.qb.FFsqlEditor",cssClass:"mstrmojo-qb-ffsqlview",alias:"SQL",bindings:{visible:function(){return(this.parent.mode===I);}}}],enterMode:function J(O){var R=O.mode;this.set("mode",R);var P=(R===I);this.tables.set("visible",!P);F.toggleClass(this.tables.domNode,H,!P);F.toggleClass(this.SQL.domNode,H,P);this.SQL.set("visible",P);if(P){var Q=this.SQL.ffsql;Q.updateSQL(O);}else{this.tables.scrollBox.linker.drawLinks();}},onheightChange:function(O){if(this.domNode&&this.header.domNode){this.tables.set("height",parseInt(O.value,10)-this.header.domNode.clientHeight+"px");this.SQL.set("height",this.tables.height);}},onwidthChange:function C(O){if(this.width!=="NaNpx"){this.tables.set("width",this.width);this.SQL.set("width",this.width);}},postBuildRendering:function E(){if(this._super){this._super();}var O=mstrApp.getRootController();O.attachEventListener("reportModeChange",this.id,this.enterMode);O.attachEventListener("addCandidateTables",this.SQL.ffsql.id,"addCandidateTables");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.TableSources","mstrmojo.DI.DIDatabaseImportOption","mstrmojo.DI.DIMappingDeck");mstrmojo.requiresDescs(702,962,967,1388,3581,11403,12860,12861,13039);var M=mstrmojo.DI.DIConstants;var A=mstrmojo.DI.DIConstants.menuItems;var F=mstrmojo.dom;var G="databaseImportDialog";var E="__di_table_source_dialog";var K=mstrmojo.DI.DIConstants.pageType;function D(){var O=this.pageType;if(O){switch(O){case K.database:var P=mstrmojo.all[G];if(!P){var N={scriptClass:"mstrmojo.DI.DIDatabaseImportOption",domSrc:this.parent.parent.domSrc};P=mstrmojo.insert(N);}P.open();break;default:var Q=mstrApp.getRootController().navigationController.getPageSlot();Q.setConfig({properties:{operationMode:M.operationMode.create}});mstrApp.getRootController().showPage(O,this.sourceInfo,Q);mstrmojo.Obj.free(Q);}}}function B(P,N){var R=document.createElement("div"),Q=R.style,O=P.domNode;R.className="resize-handler-avatar";Q.width=O.clientWidth+"px";O.appendChild(R);P.avatar=R;return R;}function J(P,N){var O=N.src,R=O&&O.data;if(R&&R.node){var Q=P.avatar||B(P,N);Q.style.top=Math.max(R.pos.y,O.pos.y)+"px";Q.style.left=R.pos.x+"px";Q.style.display="block";Q.style.zIndex="9999";Q.style.width=R.pos.w+"px";return true;}}function H(O,N){if(O.avatar){O.avatar.style.display="none";}}function C(Q,N){var T=N.src;var P=N.src;if(!P){return false;}var S=P.data;var O=N.tgt,R=Q.avatar;if(R){R.style.top=Math.min(Math.max(S.pos.y+Q.minSpan,O.pos.y),S.pos.y+S.pos.h-Q.minSpan)+"px";}}mstrmojo.DI.DITableItem=mstrmojo.declare(mstrmojo.Container,null,{type:"",name:"",cm:"",cssClass:"",allowEdit:true,markupString:'<div id="{@id}" class="mstrmojo-di-tableitem {@cssClass}" style="{@cssText}" ><div class="mstrmojo-di-tableitem-icon t{@type}"></div><div class="mstrmojo-di-tableitem-name"></div><div class="mstrmojo-di-tableitem-button"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"table":"none";}},markupSlots:{textNode:function(){return this.domNode.children[1];},menuNode:function(){return this.domNode.children[2];}},rename:function(){this.text.rename();},children:[{slot:"textNode",alias:"text",scriptClass:"mstrmojo.InlineEditBox",getValueFromText:function(){return this.text?mstrmojo.string.decodeHtmlString(this.text):"";},rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){var N=this.text;this.parent.raiseEvent({name:"itemOnSave",src:this,text:N});},bindings:{allowEdit:"this.parent.allowEdit",text:"this.parent.name"}},{slot:"menuNode",scriptClass:"mstrmojo.MenuButton",postCreate:function(){if(this.parent.cm){this.cm=this.parent.cm;}else{this.set("visible",false);}this.menuZIndex=this.parent.menuZIndex||999;},onclick:function(){var N=this;if(!this._close_handler_onmouseup_set){if(this._close_handler){mstrmojo.dom.attachEvent(document.body,"mouseup",this._close_handler);}this._close_handler_onmouseup_set=true;}},onmousedown:function(N){N.cancel();},executeCommand:function(N){this.parent.raiseEvent({name:"executeCommand",src:this,item:N});}}]});mstrmojo.DI.DIMappingPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIMappingPanel",draggable:true,dropZone:true,ownAvatar:true,minSpan:80,markupString:'<div id="{@id}" class="mstrmojo-di-mapping-panel {@cssClass}" style="{@cssText}"><div class="table-list"></div><div class="table-deck"><div class="resize-handler __r0"></div></div><div class="table-deck"><div class="resize-handler __r1"></div></div><div class="table-deck"><div class="resize-handler __r2"></div></div><div class="unused-option"></div></div>',markupSlots:{tableListNode:function(){return this.domNode.children[0];},attrDeckNode:function(){return this.domNode.children[1];},metricDeckNode:function(){return this.domNode.children[2];},unusedDeckNode:function(){return this.domNode.children[3];},unusedOptionNode:function(){return this.domNode.children[4];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},layoutConfig:{h:{tableListNode:"20%",attrDeckNode:"40%",metricDeckNode:"40%",unusedDeckNode:"0%",unusedOptionNode:"20px"},w:{tableListNode:"100%",attrDeckNode:"100%",metricDeckNode:"100%",unusedDeckNode:"100%",unusedOptionNode:"100%"}},getDragData:function(R){var N=R.src;var O=N.node;var S,W;var T=null;if(O.className&&O.className.indexOf("resize-handler")>=0){var P=O.className.indexOf("__r");var V=parseInt(O.className.substr(P+3,1),10);switch(V){case 0:W=this.tableListNode;S=this.attrDeckNode;break;case 1:W=this.attrDeckNode;S=this.metricDeckNode;break;case 2:W=this.metricDeckNode;S=this.unusedDeckNode;break;}if(W&&S){var Q=F.position(W);var U=F.position(S);T={x:Q.x,y:Q.y,w:Q.w,h:Q.h+U.h};}return{node:O,pos:T,idx:V};}return null;},allowDrop:function(N){var O=N.src;return O&&O.data&&O.data.node;},isDragValid:function I(N){var O=N.src,P=O&&O.data;return !!(P&&P.node);},ondragstart:function(N){J(this,N);},ondragmove:function(N){C(this,N);},ondragend:function(R){var X=R.src,T=X&&X.data;var O=null;if(T&&T.node){var N=this.avatar;if(N){O=parseInt(N.style.top,10)-T.pos.y;}}H(this,R);if(O){var W=T.idx;var U=F.position(this.domNode).h;var V=null,Q=null,S=null,P=null;switch(W){case 0:V=O/U*100;Q=(F.position(this.tableListNode).h+F.position(this.attrDeckNode).h-O)/U*100;S=F.position(this.metricDeckNode).h/U*100;P=F.position(this.unusedDeckNode).h/U*100;break;case 1:V=F.position(this.tableListNode).h/U*100;Q=O/U*100;S=(F.position(this.attrDeckNode).h+F.position(this.metricDeckNode).h-O)/U*100;P=F.position(this.unusedDeckNode).h/U*100;break;case 2:V=F.position(this.tableListNode).h/U*100;Q=F.position(this.attrDeckNode).h/U*100;S=O/U*100;P=(F.position(this.metricDeckNode).h+F.position(this.unusedDeckNode).h-O)/U*100;break;}if(V!==null&&Q!==null&&S!==null&&P!==null){V=Math.round(V);Q=Math.round(Q);if(P!==0){S=Math.round(S);P=100-V-Q-S;}else{S=100-V-Q;}this.layoutConfig.h={tableListNode:V+"%",attrDeckNode:Q+"%",metricDeckNode:S+"%",unusedDeckNode:P+"%",unusedOptionNode:"20px"};this.doLayout();}}},afterLayout:function(){var N;if(this.tableListNode){this.tableList.set("height",this.tableListNode.clientHeight);}if(this.attrDeckNode){N=this.attrDeckNode.children[0].clientHeight;this.attrDeck.set("height",this.attrDeckNode.clientHeight-N);}if(this.metricDeckNode){N=this.metricDeckNode.children[0].clientHeight;this.metricDeck.set("height",this.metricDeckNode.clientHeight-N);}if(this.unusedDeckNode){N=this.unusedDeckNode.children[0].clientHeight;this.unusedDeck.set("height",this.unusedDeckNode.clientHeight-N);}},reInitLayout:function(S){var U=this[S].visible;var N=["attrDeckNode","metricDeckNode","unusedDeckNode"];var W=this.layoutConfig.h;var T=0;var R,Q,O,P,V;P=N.length;for(R=0;R<N.length;R++){T+=parseInt(W[N[R]],10);}if(U){O=Math.round(T/P);}else{O=0;}Q=0;for(R=0;R<N.length;R++){V=N[R];if(V===S+"Node"){this.layoutConfig.h[V]=O+"%";}else{if(Q<P-2){this.layoutConfig.h[V]=Math.round((T-O)/(P-1))+"%";Q++;}else{this.layoutConfig.h[V]=T-O-Math.round((T-O)/(P-1))*(P-2)+"%";}}}this.doLayout();},preBuildRendering:function(){if(this._super){this._super();}this.model.attachEventListener("CurrentSourceChanged",this.id,"update");this.update();},update:function(){var N=this.model.currentSource;var O=true;if(N===null){O=false;}else{if(N.type===M.sourceType.querybuilder){if(N.xdaType===M.xdaType.qbSingleTable){O=true;}else{O=false;}}}if(O){this.unusedOption.set("visible",true);this.layoutConfig.w.unusedOptionNode="100%";this.layoutConfig.h.unusedOptionNode="20px";this.unusedDeck.set("visible",this.unusedOption.checked);}else{this.unusedOption.set("visible",false);this.layoutConfig.w.unusedOptionNode="0px";this.layoutConfig.h.unusedOptionNode="2px";this.unusedDeck.set("visible",false);}},children:[{slot:"tableListNode",alias:"tableList",scriptClass:"mstrmojo.Container",markupString:'<div class="tablelist" style="{@cssText}"><div></div><div></div></div>',markupSlots:{captionNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},onheightChange:function(N){this.list.set("height",(parseInt(N.value,10)-20)+"px");},children:[{slot:"captionNode",alias:"table",scriptClass:"mstrmojo.Table",cssClass:"titlebar-table",rows:1,cols:2,children:[{scriptClass:"mstrmojo.Label",cssClass:"titlebar-label",text:"Table",slot:"0,0"},{scriptClass:"mstrmojo.Button",cssClass:"titlebar-button",text:"+",slot:"0,1",onclick:function L(){var N=mstrmojo.all[E];if(!N){N=mstrmojo.insert({id:E,scriptClass:"mstrmojo.DI.TableSources",zIndex:999,domSrc:this.domNode,clickhandler:D});}N.open();}}]},{slot:"listNode",alias:"list",scriptClass:"mstrmojo.WidgetList",cssClass:"mstrmojo-di-mappingpanel-tablelist",itemFunction:function(Q,P,R){var N={type:Q.type,name:Q.n,cm:Q.cm,data:Q,parent:R,index:P};if(typeof Q.allowEdit==="boolean"){N.allowEdit=Q.allowEdit;}var O=new mstrmojo.DI.DITableItem(N);O.attachEventListener("executeCommand",R.id,"onExecuteCommand");O.attachEventListener("itemOnSave",R.id,"onTableItemRename");return O;},onheightChange:function(N){if(this.domNode){this.domNode.style.height=parseInt(N.value,10)+"px";}},onchange:function(){var Q=this.selectedItem;var P=this.parent.parent.model.currentSource?this.parent.parent.model.currentSource.tableID:-1;var O;if(!Q){return ;}for(O=0;O<this.items.length;O++){if(this.itemsContainerNode&&this.itemsContainerNode.childNodes){mstrmojo.css.toggleClass(this.itemsContainerNode.childNodes[O],"selected",(O===Q.index||this.itemsContainerNode.childNodes.length===1));}}var N=Q.dssid;mstrApp.getRootController().selectSourceTable(N);},postCreate:function(){var N=this.parent.parent.model;this.update();if(this.items.length>0){mstrApp.getRootController().selectSourceTable(this.items[0].dssid);}N.attachEventListener("MappingsFetched",this.id,"update");},update:function(){var Q=[];var P=this.parent.parent.model;var S;var O=[];O.push({n:mstrmojo.desc(1388,"Rename"),did:A.RENAME});O.push({n:mstrmojo.desc(12860,"Clean your data"),did:A.REFINE});O.push({n:mstrmojo.desc(702,"Advanced"),did:A.REFINE_WITHOUT_PARSING});O.push({did:A.SEPARATOR});O.push({n:mstrmojo.desc(13039,"Delete"),did:A.DELETE});if(P.operationMode===M.operationMode.edit){O.push({did:A.SEPARATOR});O.push({n:mstrmojo.desc(967,"Refresh Data"),did:A.REFRESH_DATA});}var N=P.getAllTableID();var R,T;for(R=0;R<N.length;R++){T=P.getImportSource(N[R]);if(T.sourceInfo){S={n:T.sourceInfo.name,type:T.type,dssid:T.key,cm:O,index:R+1};Q.push(S);}}if(Q.length>1){Q.splice(0,0,{n:"All",type:"All",dssid:-1,index:0,allowEdit:false});}this.set("items",Q);if(this.items.length>0){R=this.selectedIndex===-1?0:this.selectedIndex;if(R>=this.items.length){R=0;}this.set("selectedIndex",-1);this.set("selectedIndex",R);}},onTableItemRename:function(N){var R=N.src;var Q=N.text;var O=R.data.dssid;var P=mstrApp.getRootController().model.getImportSource(O);if(!P||!P.sourceInfo){return ;}if(Q===P.sourceInfo.name){return ;}mstrApp.getRootController().renameSourceTable(O,Q);},onExecuteCommand:function(N){var S=N.src;var R=N.item;switch(R.did){case A.REFINE:mstrApp.getRootController().startRefineStage(S.data.dssid,1);break;case A.REFINE_WITHOUT_PARSING:var O=mstrmojo.all.DIModel.importSources[S.data.dssid].sourceInfo.dbTableName;var T=O.lastIndexOf(".");var Q=O.substr(T+1);var P;if(Q==="xls"){P='<rss rfmt="binary/xls"><rpo>{"includeFileSources":false,"xmlBased":false,"storeBlankRows":true,"ignoreLines":-1,"storeBlankCellsAsNulls":true,"headerLines":1,"skipDataLines":0,"sheets":[0],"projectName":"lmy"}</rpo></rss>';}else{if(Q==="xlsx"){P='<rss rfmt="text/xml/xlsx"><rpo>{"includeFileSources":false,"xmlBased":true,"storeBlankRows":true,"ignoreLines":-1,"storeBlankCellsAsNulls":true,"headerLines":1,"skipDataLines":0,"sheets":[0],"projectName":"lmy"}</rpo></rss>';}else{P='<rss rfmt="text/line-based/*sv"><rpo>{"encoding":"","separator":"","ignoreLines":-1,"headerLines":0,"skipDataLines":0,"limit":-1,"storeBlankRows":true,"guessCellValueTypes":false,"processQuotes":true,"storeBlankCellsAsNulls":true,"includeFileSources":false,"projectName":"lmy"}</rpo></rss>';}}mstrApp.getRootController().startRefineStage(S.data.dssid,2,P);break;case A.RENAME:S.rename();break;case A.DELETE:mstrApp.getRootController().removeSourceTable(S.data.dssid);break;case A.REFRESH_DATA:mstrApp.getRootController().refreshSourceTable(S.data.dssid);break;}}}]},{slot:"attrDeckNode",alias:"attrDeck",scriptClass:"mstrmojo.DI.DIMappingDeck",title:mstrmojo.desc(3581,"Attributes"),type:"amps",bindings:{model:"this.parent.model"}},{slot:"metricDeckNode",alias:"metricDeck",scriptClass:"mstrmojo.DI.DIMappingDeck",title:mstrmojo.desc(962,"Metrics"),type:"mtmps",bindings:{model:"this.parent.model"}},{slot:"unusedDeckNode",alias:"unusedDeck",scriptClass:"mstrmojo.DI.DIMappingDeck",cssClass:"unused",title:mstrmojo.desc(12861,"Unused"),type:"cmps",visible:false,bindings:{model:"this.parent.model"},markupMethods:{onvisibleChange:function(){this.parent.unusedDeckNode.style.display=this.visible?"block":"none";this.parent.reInitLayout("unusedDeck");}}},{slot:"unusedOptionNode",alias:"unusedOption",scriptClass:"mstrmojo.ImageCheckBox",cssClass:"unusedOption",label:mstrmojo.desc(11403,"Show unused columns"),oncheckedChange:function(){var N=this.checked;this.parent.unusedDeck.set("visible",N);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBPreview","mstrmojo.DI.DIMappingPreview","mstrmojo._HasLayout","mstrmojo.DI.DIConstants","mstrmojo.Container","mstrmojo.DI.DIXtabPreview","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(134,221,1052,1053,1054,1055,1823,2057,2966,3477,10986,12522,12532,12639,12838,12839,12840,12841,12842,12843,12844,12845,12846,12847);var M=mstrmojo.DI.DIConstants,G=mstrmojo.array,C=mstrmojo.hash,E={raw:0,xtab:1},L;function O(P){return P<0?Math.abs(parseInt(P,10)+1):parseInt(P,10);}function J(){var T=this;var R=mstrApp.getRootController();var P=R.getModel();var S=P.importSources[this.tableID];var Q=true;if(!S){Q=false;}else{if(T.sourceTableKey&&T.sourceTableKey!==S.key){Q=false;}}return Q;}function F(Q){var P;if(Q){switch(Q){case"none":P=0;break;case",":P=1;break;case";":P=2;break;case"\t":P=3;break;case" ":P=4;break;default:P=5;break;}}else{P=0;}return P;}function H(Q){var P;switch(Q){case"'":P=1;break;case'"':P=2;break;default:P=0;}return P;}mstrmojo.DI.ui.dialogs.DIParseDataDialog=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.ui.dialogs.DIParseDataDialog",cssClass:"mstrmojo-di-parse-data-dialog",title:mstrmojo.desc(12838,"Parse Your Data"),mode:E.raw,noButtonCls:true,showTitle:true,originalDelimiter:"",originalQuotes:"",originalSkipRows:"",originalNewCH:false,originalMode:E.raw,bindings:{help:function(){if(mstrApp.isSingleTier){return"Parse_Your_Data.htm";}else{return"Parse_Your_Data_page.htm";}}},children:[{scriptClass:"mstrmojo.Label",cssClass:"view-Label",text:mstrmojo.desc(2966,"View: "),bindings:{visible:function(){var Q=mstrmojo.all.DIModel;var R=Q.importSources[this.parent.tableID].type;var P=(R!==M.sourceType.hadoop);return P;}}},{scriptClass:"mstrmojo.ui.CheckList",cssClass:"upload-options",multiSelect:false,orientation:"h",alias:"DIPreviewXtab",selectedIndex:0,items:[{did:"0",n:mstrmojo.desc(10986,"Tabular")},{did:"1",n:mstrmojo.desc(3477,"Crosstab")}],bindings:{visible:function(){var Q=mstrmojo.all.DIModel;var R=Q.importSources[this.parent.tableID].type;var P=(R!==M.sourceType.hadoop);return P;}},postBuildRendering:function(){var P=mstrmojo.all.DIModel;P.attachEventListener("changeToXtab",this.id,"changeToXtab");},changeToXtab:function(){var Q=mstrApp.getRootController();var P=Q.getModel();var R=P.importSources[this.parent.tableID];R.currentTransformations.xtab.set("isCrosstab",true);this.parent.set("mode",E.xtab);this.set("selectedIndex",1);},onchange:function(){var S=mstrApp.getRootController();var P=S.getModel();var U=P.importSources[this.parent.tableID];var T=U.sourceInfo;if(this.selectedIndex===0){if(U.currentTransformations.xtab.isCrosstab===true){U.currentTransformations.xtab.set("isCrosstab",false);S.editImportedData(M.requestFlag.preview|M.requestFlag.mapping|M.requestFlag.sourceInfo|M.requestFlag.relationship,U.currentIndex,null,U.currentTransformations.xtab.getXML(),null,null,this.parent.tableID);}S.clearModalNodes();this.parent.set("mode",E.raw);}else{var R=M.requestFlag.preview|M.requestFlag.mapping|M.requestFlag.transformations|M.requestFlag.sourceInfo|M.requestFlag.relationship|M.requestFlag.anyState;var Q=T.sheetIndex;var V={success:function(){S.getImportedDataEMMA(M.actions.transform,R,Q,false,U.tableID);},failure:function(W){S.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,W.message||"");}};if(parseInt(this.parent.crosstab.skipRows.value,10)!==O(this.parent.originalSkipRows)||this.parent.newCH.checked){this.parent.originalSkipRows=T.skipRows;this.parent.newCH.set("checked",false);S.editImportedDataEMMA(R,Q,"<chs/>",null,this.parent.tableID,-2,null,null,V);}else{this.parent.set("mode",E.xtab);}}this.parent.browserResized(L);}},{scriptClass:"mstrmojo.ImageCheckBox",alias:"newCH",label:mstrmojo.desc(12522,"Insert new column headers"),enabled:true,postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";var P=mstrmojo.all.DIModel;P.attachEventListener("PreviewFetched",this.id,"insertHdrs");P.attachEventListener("PreviewNotFetched",this.id,"insertHdrs");P.attachEventListener("CurrentSourceChanged",this.id,"insertHdrs");P.attachEventListener("sourceInfoFetched",this.id,"updateHdrs");P.attachEventListener("CurrentSourceChanged",this.id,"updateHdrs");this.updateHdrs();},updateHdrs:function(){var Q=mstrApp.getRootController();var P=Q.getModel();var R=P.importSources[this.parent.tableID];if(R&&R.sourceInfo&&R.sourceInfo.hasNewHeaders){this.set("checked",true);this.parent.originalNewCH=true;}},insertHdrs:function(){var W=this.parent;var Q=mstrApp.getRootController();var P=Q.getModel();if(!J.call(W)){return ;}var U=W.DIPreviewXtab;var T=P.importSources[this.parent.tableID];var V=T&&T.currentPreview;if(!V){this.set("visible",false);return ;}var S=T.type;var R=(S===M.sourceType.file||S===M.sourceType.dropbox||S===M.sourceType.googleDrive||S===M.sourceType.hadoop);if(U.selectedIndex===0&&W.mode===E.raw&&R){this.set("visible",true);if(T.canAutoMappingAndDetectRelation()){this.set("visible",true);}else{this.set("visible",false);}}},onclick:function(){var Q=mstrApp.getRootController();var P=Q.getModel();var S=P.importSources[this.parent.tableID];var T=S.currentPreview;var R;var U="<chs>";if(this.checked){for(R=1;R<=T.chs.length;R++){U=U+"<ch>Column "+R+"</ch>";}S.set("hasNewHeaders",true);}else{S.set("hasNewHeaders",false);}U=U+"</chs>";mstrApp.getRootController().editImportedData(M.requestFlag.sourceInfo|M.requestFlag.mapping|M.requestFlag.relationship|M.requestFlag.preview,S.currentIndex,U,null,null,null,this.parent.tableID);},bindings:{visible:function(){var Q=mstrmojo.all.DIModel;var R=Q.importSources[this.parent.tableID].type;var P=(R===M.sourceType.file||R===M.sourceType.dropbox||R===M.sourceType.googleDrive||R===M.sourceType.hadoop);return(this.parent.mode===E.raw&&P);}}},{scriptClass:"mstrmojo.HBox",alias:"crosstab",cssClass:"di-preview-parse-options",postCreate:function K(){var R=this.parent;var Q=mstrApp.getRootController();var P=Q.getModel();R.attachEventListener("modeChange",this.id,this.makeVisible);P.attachEventListener("MappingsFetched",this.id,this.makeVisible);P.attachEventListener("CurrentSourceChanged",this.id,this.makeVisible);},onRender:function N(){this.makeVisible();},makeVisible:function B(){var T=this.parent;var Q=mstrApp.getRootController();var P=Q.getModel();var S=P.importSources[this.parent.tableID];if(!J.call(T)){return ;}var R=S&&S.type;var W=S&&S.xdaType;var V=S&&S.subtype;var U=S&&S.sourceInfo&&S.sourceInfo.mimetype;if(R===null){this.set("visible",false);return ;}if(R!==M.sourceType.file&&R!==M.sourceType.dropbox&&R!==M.sourceType.googleDrive&&R!==M.sourceType.hadoop){this.set("visible",false);return ;}if(T.mode===E.raw){if(S.canAutoMappingAndDetectRelation()){this.set("visible",true);}else{this.set("visible",false);}}else{this.set("visible",false);}if(((R===M.sourceType.file||R===M.sourceType.hadoop)&&W===M.xdaType.text&&V!==M.sourceSubtype.clipboard)||(R===M.sourceType.googleDrive&&(U==="text/plain"||U==="text/csv"))||(R===M.sourceType.dropbox&&(U==="text/plain"||U!=="text/csv"))){this.delimiter.set("visible",true);this.quotes.set("visible",true);}else{this.delimiter.set("visible",false);this.delimiterCustom.set("visible",false);this.quotes.set("visible",false);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"di-preview-skip-N-rows",text:mstrmojo.desc(13266,"Skip"),alias:"skipRowsLabel1"},{scriptClass:"mstrmojo.TextBox",cssClass:"di-preview-skip-N-rows-input",alias:"skipRows",postCreate:function K(){var Q=mstrApp.getRootController();var P=Q.getModel();P.attachEventListener("CurrentSourceChanged",this.id,this.update);this.update();},postBuildRendering:function A(){var Q=mstrApp.getRootController();var P=Q.getModel();var R=P.importSources[this.parent.parent.tableID];this.parent.parent.originalSkipRows=R&&R.sourceInfo.skipRows;},update:function(){var Q=mstrApp.getRootController();var P=Q.getModel();var S=P.importSources[this.parent.parent.tableID];var R=S&&S.sourceInfo.skipRows;R=O(R);this.set("value",R);}},{scriptClass:"mstrmojo.Label",cssClass:"di-preview-skip-N-rows",text:mstrmojo.desc(13267,"rows from beginning"),alias:"skipRowsLabel2"},{scriptClass:"mstrmojo.DropDownList",alias:"delimiter",title:mstrmojo.desc(12840,"Delimiter"),cssClass:"di-preview-delimiter",options:[{n:mstrmojo.desc(2057,"None"),v:"none"},{n:mstrmojo.desc(1052,"Comma"),v:","},{n:mstrmojo.desc(1054,"Semicolon"),v:";"},{n:mstrmojo.desc(1053,"Tab"),v:"tab"},{n:mstrmojo.desc(1055,"Space"),v:"space"},{n:mstrmojo.desc(1823,"Custom"),v:""}],onidxChange:function(){if(this.idx===5){this.parent.delimiterCustom.set("visible",true);if(this.parent.delimiterCustom.inputNode){this.parent.delimiterCustom.focus();}}else{this.parent.delimiterCustom.set("visible",false);}},postBuildRendering:function(){var R=mstrApp.getRootController();var Q=R.getModel();var U=Q.importSources[this.parent.parent.tableID];var S=U&&U.sourceInfo.delimiter;var T=this.parent.parent;T.originalDelimiter=S;var P=F(S);this.set("idx",P);}},{scriptClass:"mstrmojo.TextBox",alias:"delimiterCustom",cssClass:"di-preview-delimiter-inputBox",maxLength:"1",postBuildRendering:function(){var R=mstrApp.getRootController();var Q=R.getModel();var T=Q.importSources[this.parent.parent.tableID];var S=T&&T.sourceInfo.delimiter;var P=F(S);if(P===5){this.set("value",S);}}},{scriptClass:"mstrmojo.DropDownList",alias:"quotes",title:mstrmojo.desc(12841,"Quotes"),cssClass:"di-preview-quotes",options:[{n:mstrmojo.desc(2057,"None"),v:"none"},{n:mstrmojo.desc(12842,"Single Quotes"),v:"\\'"},{n:mstrmojo.desc(12843,"Double Quotes"),v:'\\"'}],postBuildRendering:function(){var S=mstrApp.getRootController();var Q=S.getModel();var U=Q.importSources[this.parent.parent.tableID];var R=U&&U.sourceInfo.quotes;var T=this.parent.parent;T.originalQuotes=R;var P=H(R);this.set("idx",P);}},{scriptClass:"mstrmojo.Button",alias:"delimiterOK",text:mstrmojo.desc(134,"Apply"),cssClass:"mstrmojo-di-button mstrmojo-WebButton",onclick:function(){var V=mstrApp.getRootController().model;var P=V.importSources[this.parent.parent.tableID];var U=P.nrows-1;var X=this.parent.delimiter;var S=this.parent.quotes;var W=this.parent.skipRows;var Q,R,Y;if(parseInt(W.value,10)!==O(P.sourceInfo.skipRows)){Q=parseInt(W.value,10);if(Q>U){var T="There are only ## rows in the original data. Please input a number lower than that.";mstrApp.getRootController().displayError(T.replace("##",U));return ;}}if(X.idx===5){var a=this.parent.delimiterCustom.value;switch(a){case" ":a="space";break;case"  ":a="tab";break;default:break;}R=a;}else{R=X.options[X.idx].v;}if(S.idx!==undefined){Y=S.options[S.idx].v;}var Z=M.requestFlag.preview|M.requestFlag.mapping|M.requestFlag.transformations|M.requestFlag.sourceInfo|M.requestFlag.sheets|M.requestFlag.relationship|M.requestFlag.anyState;var b=P.sourceInfo.sheetIndex;mstrApp.getRootController().editImportedDataEMMA(Z,b,null,null,this.parent.parent.tableID,Q,R,Y);}}]},{scriptClass:"mstrmojo.ImageCheckBox",alias:"mhb",label:mstrmojo.desc(12639,"No metric headers"),origMhb:null,postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";var P=mstrmojo.all.DIModel;var Q=this.parent;P.attachEventListener("TransformationsFetched",this.id,"hasNoMetric");P.attachEventListener("CurrentSourceChanged",this.id,"hasNoMetric");Q.xtab_container.xtab.attachEventListener("NoMetricHeaderBlock",this.id,"hasNoMetric");},hasNoMetric:function(){var T=this.parent;var Q=mstrApp.getRootController();var P=Q.getModel();var S=P.importSources[this.parent.tableID];if(!J.call(T)){return ;}if(S===null){return ;}if(!S.currentTransformations){return ;}if(S.currentTransformations.xtab){var R=S.currentTransformations.xtab.mhb;if(R.startRow===-1||R.startColumn===-1){this.set("checked",true);}else{this.set("checked",false);}}},setDefaultMhb:function(Q,P){if(P.startRow>0){Q.set("startRow",P.startRow-1);Q.set("endRow",P.startRow-1);Q.set("startColumn",P.startColumn);Q.set("endColumn",-1);}else{if(P.startColumn>0){Q.set("startRow",P.startRow);Q.set("endRow",-1);Q.set("startColumn",P.startColumn-1);Q.set("endColumn",P.startColumn-1);}else{this.set("checked",true);}}},onclick:function(){var U=this.parent;var Q=mstrApp.getRootController();var P=Q.getModel();var T=P.importSources[this.parent.tableID];var S=T.currentTransformations.xtab.mhb;var R=T.currentTransformations.xtab.db;if(this.checked){this.origMhb=mstrmojo.hash.copy(S);S.set("startColumn",-1);S.set("startRow",-1);S.set("endColumn",-1);S.set("endRow",-1);}else{if(!this.origMhb){this.origMhb=mstrmojo.hash.copy(S);}if((this.origMhb.startRow===-1)||(this.origMhb.startColumn===-1)){this.setDefaultMhb(S,R);}else{if(this.origMhb.startRow===this.origMhb.endRow){if(this.origMhb.startRow>=R.startRow){this.setDefaultMhb(S,R);}else{S.set("startColumn",R.startColumn);S.set("endRow",this.origMhb.endRow);S.set("endColumn",this.origMhb.endColumn);S.set("startRow",this.origMhb.startRow);}}else{if(this.origMhb.startColumn>=R.startColumn){this.setDefaultMhb(S,R);}else{S.set("startRow",R.startRow);S.set("endRow",this.origMhb.endRow);S.set("endColumn",this.origMhb.endColumn);S.set("startColumn",this.origMhb.startColumn);}}}}U.xtab_container.xtab.draw();},bindings:{visible:function(){return(this.parent.mode===E.xtab);}}},{scriptClass:"mstrmojo.HBox",cssClass:"di-preview-xtab-legend",alias:"xtabLegend",children:[{scriptClass:"mstrmojo.Label",cssClass:"attribute-headers",text:mstrmojo.desc(12844,"Attribute Headers")},{scriptClass:"mstrmojo.Label",cssClass:"attribute-elements",text:mstrmojo.desc(12845,"Attribute elements")},{scriptClass:"mstrmojo.Label",cssClass:"metrics-headers",text:mstrmojo.desc(12846,"Metrics Headers")},{scriptClass:"mstrmojo.Label",cssClass:"metrics-values",text:mstrmojo.desc(12847,"Metrics values")}],bindings:{visible:function(){return(this.parent.mode===E.xtab);}}},{scriptClass:"mstrmojo.DI.DIMappingPreview",alias:"preGrid",hasContextMenu:false,columns:[],postCreate:function(){var Q=mstrApp.getRootController();var P=Q.getModel();P.attachEventListener("MappingsFetched",this.id,"initPreview");if(mstrApp.isEMMACube){P.attachEventListener("CurrentSourceChanged",this.id,"initPreview");}},initPreview:function(){var X=mstrApp.getRootController();var Y=X.getModel();var P=Y.importSources[this.parent.tableID];var T,V=[],U,R,S;if(!J.call(this.parent)){return ;}if(!P){return ;}var Q,Z;if(this.parent.mode===E.raw){Q=P.currentMapping;if(!Q){return ;}if(!P.currentPreview){return ;}Z=P.currentPreview.data;}else{Q=P.transformedMapping;if(!Q){return ;}if(!P.transformedPreview){return ;}Z=P.transformedPreview.data;}G.forEach(Q,function(a){T=a.subColumns;if(T&&T.length>=1){R=[];G.forEach(T,function(b){if(b.columnState!==4&&(b.type!=="cmps"||P.executeAction!==0)){R.push(b);}});S=R.length;if(S>1){U={};C.copy(a,U);U.subColumns=R;V.push(U);}else{if(S===1){V.push(R[0]);}}}else{if(a.columnState!==4&&(a.type!=="cmps"||P.executeAction!==0)){V.push(a);}}});var W={mappings:V,dataset:Z,supportTimeGeo:true,shapeKeys:Y.shapeKeys,renameMapped:function(g,f,h){var b=this,c=b.mappings,j=false,d,e;for(d=0,e=c.length;d<e;d++){if(d!==f){if(h===c[d].alias&&c[f].tp===c[d].tp){j=true;break;}}}if(j){var a=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");mstrApp.getRootController().displayError(a.replace("##",h),null,b.alertTitle);return ;}b.mappings[f].alias=h;mstrApp.getRootController().model.raiseEvent({name:"MappingsFetched"});}};this.set("model",W);if(!W.mappings){return ;}this.populatePreview();if(L){this.parent.browserResized(L);}},bindings:{visible:function(){return(this.parent.mode===E.raw);},height:function(){var P=mstrmojo.all.DIModel;var Q=P.importSources[this.parent.tableID].type;if(Q!==M.sourceType.hadoop){return"80%";}else{return"86%";}}}},{scriptClass:"mstrmojo.Box",cssClass:"di-xtab-container",alias:"xtab_container",children:[{scriptClass:"mstrmojo.DI.DIXtabPreview",alias:"xtab",cssClass:"di-xtab",postCreate:function(){var Q=mstrApp.getRootController();var P=Q.getModel();P.attachEventListener("TransformationsFetched",this.id,"initPreview");if(mstrApp.isEMMACube){P.attachEventListener("CurrentSourceChanged",this.id,"initPreview");}P.attachEventListener("FlatPreviewFetched",this.id,"initPreview");},initPreview:function(){var S=this.parent.parent.DIPreviewXtab;var Q=mstrApp.getRootController();var P=Q.getModel();var R=P.importSources[this.parent.parent.tableID];if(!J.call(this.parent.parent)){return ;}if(!R){return ;}if(!R.currentTransformations){return ;}if(!R.currentTransformations.xtab){return ;}if(!R.currentPreview){return ;}this.initXtab(R.currentPreview.data,R.currentTransformations.xtab,R.currentPreview.chs);if(R.currentTransformations.xtab.isCrosstab===true){S.set("selectedIndex",1);if(R.executeAction===0){this.parent.parent.set("mode",E.xtab);}}else{S.set("selectedIndex",0);this.parent.parent.set("mode",E.raw);}},bindings:{visible:function(){return(this.parent.parent.mode===E.xtab);}}}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"applyBtn",enabled:true,onclick:function(){var Q=this.parent.parent;var P=mstrApp.getRootController();var T=P.model.importSources[this.parent.parent.tableID];var S=T.sourceInfo;Q.originalNewCH=Q.newCH.checked;if(S.skipRows!==undefined){Q.originalSkipRows=S.skipRows.toString();}if(S.delimiter){Q.originalDelimiter=S.delimiter;}else{Q.originalDelimiter="none";}if(S.quotes){Q.originalQuotes=S.quotes;}else{Q.originalQuotes="none";}Q.originalMode=Q.mode;var R=Q.DIPreviewXtab;if(R.selectedIndex===1&&Q.mode===E.xtab){T.currentTransformations.xtab.set("isCrosstab",true);Q.set("mode",E.raw);P.clearModalNodes();P.editImportedData(M.requestFlag.transformedPreview|M.requestFlag.mapping|M.requestFlag.sourceInfo|M.requestFlag.relationship,T.currentIndex,null,T.currentTransformations.xtab.getXML(),null,null,this.parent.parent.tableID);}Q.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelBtn",onclick:function(){var Y=this.parent.parent;var W=mstrApp.getRootController();var T=W.getModel();var R=T.importSources[this.parent.parent.tableID];var a=R.currentPreview;var V=false;var b=M.requestFlag.preview|M.requestFlag.mapping|M.requestFlag.transformations|M.requestFlag.sourceInfo|M.requestFlag.sheets|M.requestFlag.relationship|M.requestFlag.anyState;var e=R.sourceInfo.sheetIndex;var Q=O(Y.originalSkipRows);var Z,P,S,c;if(Y.originalMode===Y.mode&&Y.mode===E.raw){if(parseInt(Y.crosstab.skipRows.value,10)!==Q){V=true;Z=Y.originalSkipRows<0?"-2":Y.originalSkipRows;}if(Y.newCH.checked!==Y.originalNewCH){Y.newCH.set("checked",Y.originalNewCH);R.hasNewHeaders=Y.originalNewCH;V=true;var U;P="<chs>";if(Y.originalNewCH){for(U=1;U<=a.chs.length;U++){P=P+"<ch>Column "+U+"</ch>";}}P=P+"</chs>";}var X=Y.crosstab.delimiter;var f=Y.crosstab.quotes;if(X.visible){if(X.idx===5){var d=R.sourceInfo.delimiter;if(d!==Y.originalDelimiter){V=true;S=Y.originalDelimiter;}}else{if(X.idx!==F(Y.originalDelimiter)){V=true;S=Y.originalDelimiter;}}}if(f.visible){if(f.idx!==H(Y.originalQuotes)){V=true;c=Y.originalQuotes;}}if(V){W.editImportedDataEMMA(b,e,P,null,this.parent.parent.tableID,Z,S,c);}}else{if(Y.originalMode===Y.mode&&Y.mode===E.xtab){if(Y.newCH.checked!==Y.originalNewCH){Y.newCH.set("checked",Y.originalNewCH);R.hasNewHeaders=Y.originalNewCH;}}else{if(Y.originalMode!==Y.mode&&Y.originalMode===E.raw){if(R.currentTransformations.xtab.isCrosstab===true){R.currentTransformations.xtab.set("isCrosstab",false);W.editImportedData(M.requestFlag.preview|M.requestFlag.mapping|M.requestFlag.sourceInfo|M.requestFlag.relationship,R.currentIndex,null,R.currentTransformations.xtab.getXML(),null,null,this.parent.parent.tableID);}W.clearModalNodes();Y.set("mode",E.raw);}else{if(Y.originalMode!==Y.mode&&Y.originalMode===E.xtab){b=M.requestFlag.transformedPreview|M.requestFlag.mapping|M.requestFlag.sourceInfo|M.requestFlag.relationship;R.currentTransformations.xtab.set("isCrosstab",true);Y.set("mode",E.xtab);W.clearModalNodes();W.editImportedDataEMMA(b,R.currentIndex,null,R.currentTransformations.xtab.getXML(),this.parent.parent.tableID,Y.originalSkipRows,Y.originalDelimiter,Y.originalQuotes);}}}}Y.close();}}],browserResized:function I(Q){var R=parseInt(Q.w,10),P=Math.floor(parseInt(Q.h,10)*0.95),S=this.preGrid;L=Q;if(isNaN(R)||R<0||!this.domNode){return ;}if(R<800){R=760;this.domNode.children[0].style.width="760px";}else{R=Math.ceil(R*0.95);this.domNode.children[0].style.width="";}if(R>40&&S.domNode){S.domNode.style.width=(R-40)+"px";S.itemsContainerNode.style.width=(R-40)+"px";if(P>271){this.domNode.children[0].style.height=P+"px";this.containerNode.style.height=(P-112)+"px";S.domNode.style.height=(P-250)+"px";S.scrollNode.style.height=(P-271)+"px";this.xtabLegend.domNode.style.width=(R-40)+"px";this.xtab_container.domNode.style.width=(R-40)+"px";this.xtab_container.domNode.style.height=(P-250)+"px";}S.widgetResized();}if(this.domNode.childNodes[0]){mstrmojo.dom.center(this.domNode.childNodes[0]);}},onOpen:function D(){var V=mstrApp.getRootController();var S=V.getModel();var P=S.importSources[this.tableID];mstrApp.getRootController().selectSourceTable(this.tableID);if(this.originalMode===E.xtab){if(!P.currentTransformations.xtab.isCrosstab){P.currentTransformations.xtab.set("isCrosstab",true);}this.set("mode",E.xtab);}if((V.model.operationMode!==M.operationMode.create&&P.currentTransformations&&P.currentTransformations.xtab.isCrosstab)||!P.currentPreview){var W=M.requestFlag.preview|M.requestFlag.mapping|M.requestFlag.transformations;var R=P.sourceInfo;var X=R.sheetIndex;V.getImportedDataEMMA(M.actions.getFlatPreview,W,X,false,this.tableID);this.originalMode=E.xtab;}this.preGrid.initPreview();this.xtab_container.xtab.initPreview();var U=F(this.originalDelimiter);if(this.crosstab.delimiter.idx!==U){this.crosstab.delimiter.set("idx",U);}var T=H(this.originalQuotes);if(this.crosstab.quotes.idx!==T){this.crosstab.quotes.set("idx",T);}var Q=O(this.originalSkipRows);this.crosstab.skipRows.set("value",Q);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIMappingTableContainer","mstrmojo.qb.DBTableLinker","mstrmojo.DI.DIConstants","mstrmojo._HasLayout","mstrmojo.dom","mstrmojo.array","mstrmojo.DI.DILabel");mstrmojo.requiresDescs(531,12730);var P=mstrmojo.DI.DIConstants,B,N=1500,H=590,G=4000,J=mstrmojo.array,E=mstrmojo.dom,K=mstrmojo.css;function C(){var R=document.createElement("v:rect"),Q=R.style;R.setAttribute("id","vmlFrame");R.setAttribute("stroke","true");R.setAttribute("strokecolor","red");Q.width=this.width;Q.height=this.height;Q.zindex="-1";document.getElementById("vmlCanvas").appendChild(R);}function I(){if(this.highlight){this.highlight.clearRect(0,0,N,H);this.hl_link=null;this.highlight.beginPath();}}function F(S,V,R,U){if(B){var T=this.context=this.context||this.canvas.getContext("2d");T.lineJoin="round";T.lineCap="round";T.moveTo(S,V);T.lineTo(R,U);}else{var Q=document.createElement("v:line");Q.setAttribute("from",[S," ",V].join(""));Q.setAttribute("to",[R," ",U].join(""));document.getElementById("vmlCanvas").appendChild(Q);}}mstrmojo.DI.DITablePanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DITablePanel",markupString:'<div id="{@id}" class="mstrmojo-di-DBTablePanel cf {@cssClass}" ><div class="button-node"></div><div class="container-node"></div></div>',markupSlots:{containerNode:function(){return this.domNode.children[1];},buttonNode:function(){return this.domNode.children[0];}},setDimensions:function M(S,Q){var R=parseInt(Q,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.buttonNode="100%";this.layoutConfig.h.containerNode="100%";this.layoutConfig.w.buttonNode="220px";this.layoutConfig.w.containerNode=(R-220-30)+"px";if(this._super){this._super(S,Q);}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},tableContainer:undefined,joinInfos:[],children:[{scriptClass:"mstrmojo.qb.DBTableLinker",alias:"linker",clearLinks:function D(){if(B){var R=this.context;if(R&&R.clearRect){R.clearRect(0,0,N,H);R.beginPath();}}else{var Q=document.getElementById("vmlCanvas");if(Q&&Q.hasChildNodes()){while(Q.childNodes.length>=1){Q.removeChild(Q.firstChild);}C.call(this);}}I.call(this);},drawLink:function(T,h,l,R){var S=this.canvas;B=S&&S.getContext&&S.getContext("2d");var V=mstrmojo.dom.position(this.domNode),Q=8,Z,k,j,W,f,e,a,Y,X,b,c,U,g,d;j=E.position(h.domNode);W=E.position(R.domNode);X=j.y+h.headerNode.clientHeight*1.5-V.y;b=W.y+R.headerNode.clientHeight*1.5-V.y;c=j.y+h.domNode.clientHeight-V.y;U=W.y+R.domNode.clientHeight-V.y;Z=E.position(T).y;k=E.position(l).y;f=j.x+j.w-V.x;e=Math.max(Z+0.5*T.clientHeight-V.y,X);a=W.x-V.x;Y=Math.max(k+0.5*l.clientHeight-V.y,b);g=f<a;d=g?Q:-Q;f-=g?0:j.w;a+=g?0:W.w;if(c-118>=e&&U-118>=Y){F.call(this,f,e,f+d,e);F.call(this,f+d,e,a-d,Y);F.call(this,a-d,Y,a,Y);}else{if(c-118<e&&U-118>Y){F.call(this,f,X,f+d,X);F.call(this,f+d,X,a-d,Y);F.call(this,a-d,Y,a,Y);}else{if(c-118>e&&U-118<Y){F.call(this,f,e,f+d,e);F.call(this,f+d,e,a-d,b);F.call(this,a-d,b,a,b);}}}if(B){this.context.strokeStyle="#999999";this.context.stroke();}},drawLinks:function L(R){var Q=this.parent.tableContainer.joinInfos,W=R.oid;var V=this,T,S,U,X;J.forEach(Q.joins,function(Y){T=Y.sourceTable;S=Y.targetTable;if(T&&S){J.forEach(Y.links,function(a,Z){if(a.source.oid===W){U=T.attrRows.getRowNode("did",a.source.did);X=S.attrRows.getRowNode("did",a.target.did);V.drawLink(U,T,X,S,Z,Y);return false;}});}});},postCreate:function O(){if(this._super){this._super();}var Q=this.parent.parent.model;Q.attachEventListener("MappingsFetched",this.id,"clearLinks");},postBuildRendering:function A(){if(mstrmojo.qb.DBTableLinker.prototype.postBuildRendering){mstrmojo.qb.DBTableLinker.prototype.postBuildRendering.call(this);}this.clearLinks();}},{scriptClass:"mstrmojo.DI.DIMappingTableContainer",cssClass:"mstrmojo-di-tableview",alias:"tableContainer"},{slot:"buttonNode",scriptClass:"mstrmojo.Label",alias:"background",cssClass:"plus-background",onclick:function(Q){mstrmojo.dom.stopPropogation(Q.hWin,Q.e);var S=mstrApp.getRootController(),R=S.model;R.isAddingNewTable=true;S.showDialog(P.dialogType.diPageDialog,{pageType:P.pageType.dataSelection,left:"200px",top:"115px",cssClass:"mstrmojo-di-homepage-editor"});},bindings:{enabled:function(){return !this.parent.disableNewTables;}},onenabledChange:function(){K.toggleClass(this.domNode,"disable-button",!this.enabled);this.set("enabled",this.enabled);}},{slot:"buttonNode",scriptClass:"mstrmojo.DI.DILabel",cssClass:"button-label button",alias:"background-button",text:mstrmojo.desc(12730,"Add a new table"),onclick:function(Q){mstrmojo.dom.stopPropogation(Q.hWin,Q.e);var S=mstrApp.getRootController(),R=S.model;R.isAddingNewTable=true;S.showDialog(P.dialogType.diPageDialog,{pageType:P.pageType.dataSelection,left:"200px",top:"115px",cssClass:"mstrmojo-di-homepage-editor"});},onmouseover:function(){if(this.enabled){K.removeClass(this.domNode,"button-label");K.addClass(this.domNode,"button-label-hover");K.removeClass(this.parent.background.domNode,"plus-background");K.addClass(this.parent.background.domNode,"plus-background-hover");}},onmouseout:function(){if(this.enabled){K.addClass(this.domNode,"button-label");K.removeClass(this.domNode,"button-label-hover");K.addClass(this.parent.background.domNode,"plus-background");K.removeClass(this.parent.background.domNode,"plus-background-hover");}},bindings:{enabled:function(){return !this.parent.disableNewTables;}},onenabledChange:function(){K.toggleClass(this.domNode,"disable-button",!this.enabled);this.set("enabled",this.enabled);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIAllObjectsGrid","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.Pulldown");mstrmojo.requiresDescs(10,118,221,2177,4531,12667,12668,12954,13912,13913);var N=mstrmojo.array,L=mstrmojo.func,R=[1,2,3,8,9,11],D="DI-All-Attributes-View",C="DI-All-Metrics-View",J="DI-Dist-Key-Selector",A="DI-Dist-Num-Input",P=mstrmojo.desc(10,"Search"),B={id:"",alias:mstrmojo.desc(12667,"---- none ----")},Q={id:"autopa",alias:mstrmojo.desc(4531,"Automatic")},T=null,O=null,K=mstrmojo.emptyFn;function I(V){if(V.isMultiForm){var W,X=V.subColumns.length;for(W=0;W<X;W++){if(V.subColumns[W].fmn==="ID"){return V.subColumns[W].dtp;}}}return V.dtp;}function E(){var W,V;if(!O){return ;}W=T.cubeConfig;V=mstrmojo.all[D];if(V){W.sidxes=V.getSearchIdxes();}O.persistCubeConfig(W);}mstrmojo.DI.DIAllObjectsView=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIAllObjectsView",cssClass:"mstrmojo-di-allObjects-dialog",title:mstrmojo.desc(12668,"All Objects View"),model:null,noButtonCls:true,showTitle:true,help:"Multi_Table_View_Editor.htm",init:function S(W){var V;O=mstrApp.getRootController().allObjectsController;T=mstrApp.getRootController().model;K=mstrmojo.emptyFn;if(this._super){this._super(W);}T.attachEventListener("MappingsFetched",this.id,"onMappingsChange");V=this.id;N.forEach([D,C],function(Y){var X=mstrmojo.all[Y];X.attachEventListener("beginSelectionItem",V,"gridBeginSelectionItem");});mstrmojo.all[D].attachEventListener("searchIndexChange",V,"onsearchIndexChange");},onOpen:function(){if(this._super){this._super();}K=L.debounce(E,500);},gridBeginSelectionItem:function(V){var W=V.src;N.forEach([D,C],function(X){if(X!==W.id){mstrmojo.all[X].clearSelect();}});},onsearchIndexChange:function(){K();},onClose:function F(){this.destroy();},onMappingsChange:function(){var X=mstrmojo.all[J];var W;if(X){W=X.updateKeys(true);}if(!W){var V=mstrmojo.all[A];if(V){V.enableInput(false);}}},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),visible:false,onclick:function(){var W=T.cubeConfig;var V=mstrmojo.all[D];if(V){W.sidxes=V.getSearchIdxes();}O.persistCubeConfig(W);this.parent.parent.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(2177,"Close"),onclick:function(){this.parent.parent.close();}}],children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.Box",cssClass:"all-objects-header cf",children:[{scriptClass:"mstrmojo.ui.SearchBox",cssClass:"all-objects-search",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><input class="mstrmojo-ui-sb-input" type="text" mstrAttach:keyup,blur,focus/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',searchDelay:200,onSearch:false,setSearchTip:function(){this.inputNode.value=P;},postBuildRendering:function U(V){if(this._super){this._super(V);}this.setSearchTip();},onfocus:function(){if(this.text){this.inputNode.value=this.text;}else{this.clearSearch(true);}},onblur:function(){if(!this.text){this.setSearchTip();var V=mstrmojo.all[D];if(V.items.length===0){V.set("items",V.allItems);}V=mstrmojo.all[C];if(V.items.length===0){V.set("items",V.allItems);}}},searchTriggered:function(V){if(V===P){return ;}var W=mstrmojo.all[D];if(W){W.filterItems(V);}W=mstrmojo.all[C];if(W){W.filterItems(V);}}},{scriptClass:"mstrmojo.HBox",cssClass:"distribution-key-box",cellPadding:5,bindings:{visible:function(){return mstrApp.getRootController().allObjectsController.isCubeConfigEnabled();}},children:[{scriptClass:"mstrmojo.Label",cssClass:"distribution-key-caption",text:mstrmojo.desc(13912,"Partition Attribute")},{scriptClass:"mstrmojo.Pulldown",id:J,itemField:"alias",itemIdField:"id",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup mstrmojo-di-Pulldown-scrollOnHover",postCreate:function(){if(this._super){this._super();}var V=mstrApp.getRootController().allObjectsController;V.attachEventListener("updateDistKey",this.id,"updateKeys");},onvalueChange:function(){if(this._super){this._super();}T.cubeConfig.distInfo.keyId=this.value;mstrmojo.all[A].enableInput(!!this.selectedIndex);K();},updateKeys:function(a){var b=mstrmojo.all[D].getAllItems(),W=[];N.forEach(b,function X(e){W.push(e.col);});var d=N.filter(W,function V(f){var e=I(f);return ~N.indexOf(R,e);});d.splice(0,0,Q);d.splice(0,0,B);var c=T.cubeConfig.distInfo;var Y=0;if(c&&c.keyId){var Z;for(Z=0;Z<d.length;Z++){if(d[Z].id===c.keyId){Y=Z;break;}}}this.defaultSelection=Y;this.items=d;if(a===true){this.paint();}return Y;}},{scriptClass:"mstrmojo.Label",cssClass:"distribution-number-caption",text:mstrmojo.desc(13913,"Number of Partition")},{scriptClass:"mstrmojo.TextBox",id:A,cssClass:"mstrmojo-di-distribution-number-input",type:mstrmojo.dom.isIE9?"text":"number",value:0,max:128,min:2,tooltip:mstrmojo.desc(12954,"Enter an integer between 2 and 128"),valueChangeDelay:1000,validateInput:function M(V){if(this.enabled){if(V>this.max){this.set("value",this.max);}else{if(V!==""&&V<this.min){this.set("value",this.min);}}}},onvalueChange:function(V){if(this._super){this._super();}var W=V.value;this.validateInput(W);T.cubeConfig.distInfo.pf=this.value;K();},onblur:function H(){if(this.value<this.min){this.set("value",this.min);T.cubeConfig.distInfo.pf=this.value;}},enableInput:function G(V){if(this.enabled!==V){this.set("enabled",V);if(V){this.set("value",4);}else{this.set("value",0);}}},postCreate:function(){this._super();this.set("value",T.cubeConfig.distInfo.pf);},postBuildRendering:function U(){if(this._super){this._super();}if(mstrmojo.all[J].defaultSelection===0){this.set("enabled",false);}}}]}]},{scriptClass:"mstrmojo.HBox",cssClass:"attribute-metric-box",cellPadding:5,children:[{scriptClass:"mstrmojo.DI.DIAllObjectsGrid",cssClass:"mstrmojo-di-all-objects-grid",id:D,type:"amps"},{scriptClass:"mstrmojo.DI.DIAllObjectsGrid",cssClass:"mstrmojo-di-all-objects-grid",id:C,type:"mtmps"}]}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.DI.DIConstants","mstrmojo.qb.QBPanel");mstrmojo.requiresDescs(1442,3416,6189,9130);var D=mstrmojo.string.decodeHtmlString,G=mstrmojo.DI.DIConstants,C=G.browseFlag,A=G.requestFlag;function F(K){return D(K).replace(/&apos;/g,"'");}mstrmojo.DI.ui.dialogs.DIAggregationDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIAggregationDialog",zIndex:10,cssClass:"mstrmojo-di-aggregationDialog",tableID:undefined,model:undefined,controller:undefined,onClose:mstrmojo.emptyFn,onOpen:function E(){var L=this,K=this.model,N={success:function(O){mstrApp.msgid=O.msgid;K.loadReport(C.reportBindingTable+C.dataPreview,0,A.mapping,null,{success:function P(Q){K.loadDefinition(Q);}});}};K.getFunctions(true);K.originalMsgID=mstrApp.msgid;mstrApp.getRootController().getDataService().removeOrDuplicateRI({success:function M(O){mstrApp.msgid=O.msgid;if(L.hasAggFilter){K.firstTimeLoading=true;N.success({msgid:mstrApp.msgid});}else{L.controller.getDataService().submitRequest(N,{taskId:"DIStartOrCancelAggFilterChange",tbid:L.tableID});}}},{messageID:mstrApp.msgid});},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-main-panel",orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,getLayoutOffsets:function H(){return{h:2,w:2};},children:[{scriptClass:"mstrmojo.Box",slot:"firstSplitNode",children:[{scriptClass:"mstrmojo.Box",alias:"header",cssClass:"mstrmojo-qb-tableview-toolbar",children:[{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon play",useRichTooltip:true,text:mstrmojo.desc(9130,"Execute SQL"),onclick:function(){mstrApp.getRootController().model.autoMap(null,false,false);}},{scriptClass:"mstrmojo.Label",cssClass:"condition",text:mstrmojo.desc(12378,"Filter..."),onclick:function(){mstrApp.getRootController().openConditionDialog();}}]},{scriptClass:"mstrmojo.qb.QBTableView",cssClass:"mstrmojo-qb-tableview on",cssText:"height: 200px;"}]},{scriptClass:"mstrmojo.qb.QBMappings",alias:"mappingPanel",cssText:"position:relative;overflow:hidden;border:0px solid lightGrey;border-width:1px;padding:0px;",onRender:function J(){this.set("height","215px");},slot:"secondSplitNode"}],config:{firstSplit:{v:"400px",min:"150px",max:undefined},secondSplit:{v:"215px",min:"150px",max:undefined},resizeHandle:{v:"5px"}}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1442,"OK"),onclick:function(){var L=this.parent.parent,K=L.model;K.autoMap({success:function M(){K.buildRelations({success:function(){K.cleanDuplicateRI(false);L.close();L.destroy();}});}},true);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(3416,"Cancel"),onclick:function(){var L=this.parent.parent,K=L.model;K.cleanDuplicateRI(true);L.close();L.destroy();}}]}],toggleDataPreview:function B(){return ;},openExpressionEditor:function I(M,N){var K="qb-expr",L=mstrmojo.all[K]||mstrmojo.insert({scriptClass:"mstrmojo.qb.ExpressionEditor",id:K});L.set("oi",mstrmojo.hash.copy(M,{mhfts:{},mvfts:{}}));L.open(null,{zIndex:N+1||10});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Table","mstrmojo.CheckBox","mstrmojo.ME.LevelInputBox","mstrmojo.ME.ConditionInputBox","mstrmojo.ME.TransformInputBox","mstrmojo.ME.MetricDataService","mstrmojo.Button","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.mstr.EnumFunction");mstrmojo.requiresDescs(1107,1281,2148,2397,2399,3324,3377,4788,6223,9577,9579,9581,9582,9583,9584,11564,11565,12178,12179,12853);var Q=mstrmojo.expr,G=mstrmojo.array,B=mstrmojo.mstr.EnumFunction,R=mstrmojo.ME._MetricEditorHelper,A=mstrmojo.ME.MetricToken.brackets;var N,M;var C=function(){var E=this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level");return mstrmojo.hash.copy({n:E,did:-1,t:-1,state:0});};var X={level:-4,condition:-5,transformation:-6,simple:-7},O=function(E){return !(E===-4||E===-5||E===-6);},L=function(Y,E){return O(Y)||parseInt(Y,10)===X[E];},U=function(E){return E===-4||E===-5||E===-6||E===-7;};var W={n:"",did:"-1",desc:""},D={1:"+",2:"*",3:"%",4:""},F={1:"",2:"!",3:"<",4:">",5:"<|",6:">|"},H=function(a,Z){var c,E,b;switch(Z){case"level":c=[Q.TP.ATTR,Q.TP.DIM];E="onLevelAdded";b=16;break;case"transform":c=[Q.TP.ROLE];E="onTransformAdded";b=26;break;case"condition":c=[Q.TP.FILTER,Q.STP.PROMPT_OBJECTS];E="onConditionAdded";b=10;break;case"expression":c=[Q.TP.FACT,Q.TP.ATTR,Q.TP.FUNCTION,Q.TP.METRIC];E="onExpressionAdded";b=25;break;default:}c[c.length]=Q.TP.FOLDER;a.openPopup("ob",{zIndex:a.zIndex+10});var Y=a.ob.browser;Y.browse({folderLinksContextId:b,onSelectCB:[a,E],browsableTypes:c.join(","),includeObjectDesc:true});};mstrmojo.ME._HasLevel=mstrmojo.provide("mstrmojo.ME._HasLevel",{_mixinName:"mstrmojo.ME._HasLevel",isAggFunction:false,init:function V(E){if(this._super){this._super(E);}N=this.id;M=this;},onOpen:function K(){if(this._super){this._super();}if(!this.isAggFunction){return ;}M=this;var Y=this.getLCTDefFromTokens();this.updateToggleBarStatus(Y);var E=this.metricLCT.levelInput;E.set("candidates",this.getCandidates4LCT([Q.TP.ATTR,Q.STP.NDE]));E.set("items",Y.level);var Z=this.metricLCT.conditionInput;if(!this.noCache&&!Z.candidates&&!this.isDME){mstrmojo.ME.MetricDataService.getFilters({pattern:"*",blockBegin:1,blockCount:-1},{success:function(b){if(b){Z.set("candidates",{items:b.items,isComplete:(b.bc===-1||(b.bb+b.bc>b.sz))});}},failure:function(b){mstrmojo.alert(b.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{Z.candidates=this.getCandidates4LCT([Q.TP.FILTER,Q.STP.PROMPT_OBJECTS]);this.metricLCT.lblCondition.set("visible",Y.filter.length>0);}Z.set("items",Y.filter);var a=this.metricLCT.transformInput;if(!this.noCache&&!a.candidates&&!this.isDME){mstrmojo.ME.MetricDataService.getTransformations({pattern:"*",blockBegin:1,blockCount:-1},{success:function(b){if(b){a.set("candidates",{items:b.items,isComplete:(b.bc===-1||(b.bb+b.bc>b.sz))});}},failure:function(b){mstrmojo.alert(b.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{a.candidates=this.getCandidates4LCT(Q.TP.ROLE);this.metricLCT.lblTransform.set("visible",Y.tranformation.length>0);}a.set("items",Y.tranformation);},getLCTDefAsTokens:function P(){if(!this.isAggFunction){return[];}var h=this.metricLCT.levelInput.getSelectedObjects(),b=this.metricLCT.conditionInput.getSelectedObjects(),Z=this.metricLCT.transformInput.getSelectedObjects(),e=[],Y,a,c,E=function(k,j){return k.filtering===1?"("+j+")":j;};e.push({v:"{",isDelimiter:true});var f=null;for(a=0,c=h.length;a<c;a++){f=h[a];e.push({v:F[f.grouping],isDelimiter:true});if(R.isDimty(f.n)){e.push({v:E(f,f.n)});}else{if(/^@/.test(f.did)){e.push({v:E(f,f.did)});}else{if(f.did===-1){e.push({v:"~",isDelimiter:true});}else{e.push({v:A(f.n),oi:f});}}}e.push({v:D[f.filtering],isDelimiter:true});if(a<(c-1)){e.push({v:", ",isDelimiter:true});}}if(!this.levelFilterRest){e.push({v:";",isDelimiter:true});e.push({v:"-",isDelimiter:true});}if(!this.levelCanContinue){e.push({v:";",isDelimiter:true});e.push({v:"/",isDelimiter:true});}e.push({v:"}",isDelimiter:true});if(b.length>0){e.push({v:"<",isDelimiter:true});Y={v:A(b[0].n)};if(b[0].did){Y.oi=b[0];}e.push(Y);e.push({v:";",isDelimiter:true});e.push({v:"@",isDelimiter:true});e.push({v:this.conditionEmbedMethod});e.push({v:";",isDelimiter:true});e.push({v:this.conditionIgnoreFilterElem?"-":"+",isDelimiter:true});e.push({v:">",isDelimiter:true});}var g=G.indexOf(Z,W);c=g<0?Z.length:g;if(c>0){e.push({v:"|",isDelimiter:true});var d=null;for(a=0;a<c;a++){d=Z[a];Y={v:A(d.n)};if(d.did){Y.oi=d;}e.push(Y);if(a<(c-1)){e.push({v:", ",isDelimiter:true});}}e.push({v:"|",isDelimiter:true});}for(a=0,c=e.length;a<c;a++){e[a].isNew=true;}return e;},getLCTDefFromTokens:function S(){var Y=[],a=false,f=[],d=[],h=this.oi.tks.items,g=h.length,e;if(this.insertMode||g===0){Y.push(C.call(this));}else{for(e=0;e<g;e++){var b=h[e],j=b.tp,Z=b.sctt;switch(Z){case 262144:a=true;switch(j){case 64:case 126:case 264:case 265:case 310:var c=e,k;if(j===64){var E=b.v+h[++e].v;b=h[e+1];if(b.tp===43||b.tp===45){E+=h[++e].v;E+=h[++e].v;}else{if(b.tp===41){e++;}}k=mstrmojo.ME.Enum.DYNAMIC_DIMTY.getDimtyObject(E,this.isDME);}else{k=j===126?C.call(this):b.oi;}k.grouping=1;k.filtering=4;switch(h[c-1].tp){case 33:k.grouping=2;break;case 60:k.grouping=3;break;case 62:k.grouping=4;break;case 297:k.grouping=5;break;case 298:k.grouping=6;break;}switch(h[e+1].tp){case 37:k.filtering=3;break;case 42:k.filtering=2;break;case 43:k.filtering=1;break;}Y.push(k);break;case 45:this.levelFilterRest=false;break;case 47:this.levelCanContinue=false;break;}break;case 327680:switch(j){case 270:case 273:f.push(b.oi);break;case 262:this.conditionEmbedMethod=b.v;break;case 43:this.conditionIgnoreFilterElem=false;break;case 45:this.conditionIgnoreFilterElem=true;break;}break;case 393216:switch(j){case 271:d.push(b.oi);break;}break;}}if(Y.length===0&&!a){Y.push(C.call(this));}}return{level:Y,filter:f,tranformation:d};},levelCanContinue:true,levelFilterRest:true,conditionEmbedMethod:2,conditionIgnoreFilterElem:true,_set_candidates:function(b,Y){this.candidates=Y;if(this.hasRendered){var E=this.metricLCT.levelInput,Z=this.metricLCT.conditionInput,a=this.metricLCT.transformInput;E.candidates=this.getCandidates4LCT([Q.TP.ATTR,Q.STP.NDE]);Z.candidates=this.getCandidates4LCT([Q.TP.FILTER]);a.candidates=this.getCandidates4LCT([Q.TP.ROLE]);}return true;},getCandidates4LCT:function J(a,E){var Z=this.candidates,Y;if(Z){a=G.ensureArray(a);Y=G.filter(Z.items,function(b){return G.indexOf(a,b.t)>-1||G.indexOf(a,b.st)>-1;});if(G.indexOf(a,12)>-1&&E){if(this.replaceAttributeWithForms){Y=this.replaceAttributeWithForms(Y);}}return{items:Y,isComplete:Z.isComplete};}return null;},updateToggleBarStatus:function I(E){var Y=false;if(E.level){Y=E.level.length>1||E.level.length==1&&E.level[0].did!==-1;}if(E.filter){Y=Y||E.filter.length>0;}if(E.transformation){Y=Y||E.transformation.length>0;}if(U(this.did)){Y=true;}this.metricLCT.toggle.set("selected",Y);},levelAdvRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9577,"Level Advanced Options"),help:"Level_Advanced_Options_dialog_box.htm",cssClass:"mstrmojo-ME-level-options",onOpen:function(){var E=this.opener;this.contentTable.ccCheckBox.set("checked",E.levelCanContinue);this.contentTable.frCheckBox.set("checked",E.levelFilterRest);},children:[{scriptClass:"mstrmojo.Table",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.CheckBox",alias:"ccCheckBox",slot:"0,0",label:mstrmojo.desc(9583,"Allow other users to add extra units to this definition")},{scriptClass:"mstrmojo.CheckBox",alias:"frCheckBox",slot:"1,0",label:mstrmojo.desc(9584,"Include filter attributes which are not in report or level in metric calculation")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveLevelOptions(E.contentTable.ccCheckBox.checked,E.contentTable.frCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},conditionAdvRef:{scriptClass:"mstrmojo.Editor",title:"Condition Advanced Options",help:"Condition_Advanced_Options_dialog_box.htm",cssText:"width: 286px;",onOpen:function(){var E=this.opener;this.contentTable.emPulldown.set("value",E.conditionEmbedMethod);this.contentTable.irfeCheckBox.set("checked",E.conditionIgnoreFilterElem);},children:[{scriptClass:"mstrmojo.Table",cssText:"margin-top:5px;",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.Label",slot:"0,0",text:mstrmojo.desc(9585,"Interaction between metric filter and report filter: ")},{scriptClass:"mstrmojo.Pulldown",alias:"emPulldown",itemField:"n",itemIdField:"did",slot:"1,0",value:2,items:[{n:mstrmojo.desc(9586,"Merge into new"),did:1},{n:mstrmojo.desc(9587,"Merge report filter into metric"),did:2},{n:mstrmojo.desc(9588,"Merge metric condition into report"),did:3}]},{scriptClass:"mstrmojo.CheckBox",alias:"irfeCheckBox",slot:"2,0",label:mstrmojo.desc(9589,"Ignore related report filter elements")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveConditionOptions(E.contentTable.emPulldown.value,E.contentTable.irfeCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},getLCTComponent:function T(){return{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-ME-LCT",alias:"metricLCT",layout:[{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{cssText:"width:252px;padding-right:6px;"}]}],bindings:{visible:function(){return this.parent.isAggFunction;}},labelWidth:"auto",children:[{scriptClass:"mstrmojo.Button",cssClass:"toggle",alias:"toggle",text:mstrmojo.desc(6223,"Show All"),selected:false,bindings:{visible:function(){return !this.parent.parent.isDME;}},onclick:function(E){var Y=!this.selected;this.set("selected",Y);},slot:"0,0"},{scriptClass:"mstrmojo.Label",alias:"lblLevel",text:mstrmojo.desc(4788,"Level"),bindings:{visible:function(){return this.parent.parent.isDME||!this.parent.parent.isDME&&this.parent.toggle.selected;},width:"this.parent.labelWidth"},onwidthChange:function(){if(this.hasRendered){this.domNode.style.width=this.width;}},slot:"1,0"},{scriptClass:"mstrmojo.ME.LevelInputBox",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),alias:"levelInput",dtp:-4,xacptSugItemOnly:true,bindings:{noCache:function(){return this.parent.parent.noCache;},isDME:function(){return this.parent.parent.isDME;},visible:function(){return this.parent.lblLevel.visible;}},reportLevelAdded:true,onadd:function(E){var Y=this.getSelectedObjects();this.set("reportLevelAdded",G.find(Y,"did",-1)>-1);},onremove:function(E){var Y=this.getSelectedObjects();this.set("reportLevelAdded",G.find(Y,"did",-1)>-1);},onitemchange:function(){this.parent.parent.onmetricModify();if(M.updateScrollbars){M.updateScrollbars();}},onSaveOnClose:function(){this.parent.parent.onmetricModify();},slot:"1,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold",text:mstrmojo.desc(9577,"Level Advanced Options"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},onclick:function(){var E=this.parent.parent;E.openPopup("levelAdvRef",{saveLevelOptions:function(Z,Y){E.levelCanContinue=Z;E.levelFilterRest=Y;},zIndex:E.zIndex+10});},slot:"1,1"},{scriptClass:"mstrmojo.Label",alias:"lblCondition",text:mstrmojo.desc(9579,"Condition"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"2,0"},{scriptClass:"mstrmojo.ME.ConditionInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-condition singleObject",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(1281,"Filter").toLowerCase()),alias:"conditionInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblCondition.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();},slot:"2,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold condition",text:mstrmojo.desc(9581,"Condition Advanced Options"),bindings:{visible:function(){return this.parent.lblCondition.visible&&!this.parent.parent.isDME;}},onclick:function(){var E=this.parent.parent;E.openPopup("conditionAdvRef",{saveConditionOptions:function(Z,Y){E.conditionEmbedMethod=Z;E.conditionIgnoreFilterElem=Y;},zIndex:E.zIndex+10});},slot:"2,1"},{scriptClass:"mstrmojo.Label",alias:"lblTransform",text:mstrmojo.desc(3324,"Transformation"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"3,0"},{scriptClass:"mstrmojo.ME.TransformInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-transform",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),alias:"transformInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblTransform.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();if(M.updateScrollbars){M.updateScrollbars();}},slot:"3,1"}]};}});mstrmojo.ME._HasLevel.EnumEditorComponents=X;}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.RefineModel","mstrmojo.Refine.RefineController");var C=mstrmojo.DI.DIConstants;mstrmojo.Refine.Refine=mstrmojo.declare(mstrmojo.Obj,null,{start:function D(F,E,G){this.isBDE=false;var H=mstrApp.getRootController().model.importSources[G];if(H.type===C.sourceType.hadoop&&H.subtype===C.sourceSubtype.hadoop){this.isBDE=true;}if(!this.rootController){this.rootController=new mstrmojo.Refine.RefineController({model:new mstrmojo.Refine.RefineModel({projectID:E}),tableID:G});}else{this.rootController.model.projectID=E;this.rootController.model.columns={};this.rootController.model.data={};this.rootController.model.history={};this.rootController.model.operations={entries:[]};this.rootController.model.start=0;this.rootController.tableID=G;this.rootController.model.sampleStatus=null;}this.rootController.start(F);},getRefinePanel:function A(){return this.rootController.getRefinePanel();},stop:function B(){}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.Splitter","mstrmojo.DI.DIPreviewSimple","mstrmojo.DI.DISearchBox");mstrmojo.requiresDescs(10,12882);var F="firstSplitNode",J="secondSplitNode",D={firstSplit:{v:"25%",min:"200px",max:undefined},secondSplit:{v:"75%",min:"150px",max:undefined},resizeHandle:{v:"2px"}};mstrmojo.DI.DISearchBoxPage=mstrmojo.declare(mstrmojo.ui.Splitter,null,{orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,showOperators:true,showAdvancedOptions:false,showFetchOptions:false,tableID:"",searchPanel:undefined,previewPanel:undefined,advancedProperties:undefined,headerLabelText:mstrmojo.desc(10,"Search"),placeHolderText:mstrmojo.desc(10,"Search"),searchTerm:undefined,iconCssClass:"",noDataErrorString:mstrmojo.desc(12882,"No data was returned, please try another search string."),hideSignout:false,searchBoxHint:"",config:{firstSplit:{v:"100%",min:"200px",max:undefined},secondSplit:{v:"0%",min:"0px",max:undefined},resizeHandle:{v:"0px"}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onSearchClick:function L(N){if(this.searchPanel&&this.searchPanel.searchFieldNode){this.searchPanel.searchFieldNode.blur();}},handleSearchChange:function B(N){this.searchText=this.searchPanel.getSearchQuery();if(N.e.keyCode===13&&this.searchText!==""){this.onSearchClick(this.searchText);}},refreshSearch:function H(){if(this.searchParam!==undefined){this.searchPanel.searchFieldNode.value=this.searchParam;}if(this.fetchNum){this.searchPanel.fetchNode.children[0].value=this.fetchNum;}},updatePageLayout:function M(){this.searchPanel.updateLayout();},toggleDataPreview:function C(N){this.refreshConfig();this.updatePageLayout();this.toggleSecondItemVisibility(N);},children:[{scriptClass:"mstrmojo.DI.DISearchBox",alias:"searchPanel",bindings:{headerLabelText:function(){return this.parent.headerLabelText;},placeHolderText:function(){return this.parent.placeHolderText;},showOperators:function(){return this.parent.showOperators;},showFetchOptions:function(){return this.parent.showFetchOptions;},showAdvancedOptions:function(){return this.parent.showAdvancedOptions;},noDataErrorString:function(){return this.parent.noDataErrorString;},hideSignout:function(){return this.parent.hideSignout;},hint:function(){return this.parent.searchBoxHint;},iconCssClass:function(){return this.parent.iconCssClass;}},slot:F},{scriptClass:"mstrmojo.DI.DIPreviewSimple",slot:J,alias:"previewPanel"}],setDimensions:function I(R,O){var P,N=parseInt(R,10),Q=parseInt(O,10);if(isNaN(N)||isNaN(Q)){return ;}if(this._super){this._super(R,O);}this.set("height",R);this.set("weight",O);if(!this.children){return ;}for(P=0;P<this.children.length;P++){if(this.children[P].setDimensions){this.children[P].setDimensions(R,O);}else{this.children[P].set("height",R);this.children[P].set("weight",O);}}},browserResized:function(Q,O){var P=parseInt(Q,10)+"px",N=parseInt(O,10)+"px";if(this.height&&N!==this.height){this.set("height",N);}else{this.height=N;}if(this.width&&P!==this.width){this.set("width",P);}else{this.width=P;}return true;},updatePageConfig:function(N){var O=this;if(N&&N.properties){mstrmojo.hash.forEach(N.properties,function(Q,P){O.set(P,Q);});}},populate:function E(N){if(N&&N.targetPageId){if(N.targetPageId!==this.id){return ;}}this.searchPanel.populate(N);},postBuildRendering:function A(){if(this._super){this._super();}this.browserResized(this.domNode.parentNode.style.width,this.domNode.parentNode.style.height);mstrApp.getRootController().model.externalSources[this.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.populate);},getTableId:function K(){var N=this.tableID;if(N===""){N=this.searchPanel.previewTableId;}return N;},refreshConfig:function G(){this.config=D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.DBRoleSelector","mstrmojo.ui.Splitter","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.ui.AvailableTablesPanel");var A=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.WHPanel=mstrmojo.declare(mstrmojo.ui.Splitter,null,{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"WHPanel",orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,config:{firstSplit:{v:"300px",min:"100px"},secondSplit:{v:"100%",min:"100px"},resizeHandle:{v:"2px"}},getLayoutOffsets:function C(){return{h:0,w:0};},init:function B(E){this._super(E);var F={},D=F[this.id]={};D[A.DBROLE_SELECTION]=this.onDBRoleSelection;mstrApp.getRootController().attachDataChangeListeners(F);},onDBRoleSelection:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.warehouse.DBRoleSelector",slot:"firstSplitNode",alias:"topPanel"},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",slot:"secondSplitNode",alias:"bottomPanel"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.qb.thirdParty.BISourceSelector","mstrmojo.qb.thirdParty.SourceInput");mstrmojo.requiresDescs(12384);var C="firstSplitNode",H="secondSplitNode";var G=0,B=1;mstrmojo.qb.thirdParty.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.thirdParty.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},onError:mstrmojo.emptyFn,loadView:mstrmojo.emptyFn,toggleDatabaseView:mstrmojo.emptyFn,viewMode:G,fixedViewSize:null,init:function I(N){this._super(N);var O={},M=O[this.id]={},L,J,K;M.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(O);if(this.viewMode===G&&!mstrApp.isCloudPro){this.viewMode=B;K=mstrApp.container.size;if(K){L=parseInt(K.w,10);J=parseInt(K.h,10);}this.fixedViewSize=(!isNaN(L)&&!isNaN(J))?{w:L+"px",h:J+"px"}:{w:"1006px",h:"540px"};}if(this.viewMode===B){this.getBrowserDimensions=function P(){return this.fixedViewSize;};}},preBuildRendering:function F(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size});},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"40%",min:"335px",max:undefined},secondSplit:{v:"60%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function E(){return{h:0,w:48};},slot:"layout",alias:"main",children:[{scriptClass:"mstrmojo.qb.thirdParty.BISourceSelector",slot:C,alias:"srcSelector"},{scriptClass:"mstrmojo.qb.thirdParty.SourceInput",slot:H,alias:"srcInput"}]}],adjustSize:function(K){var L=K.size,N=mstrApp.isCloudPro,P=N?40:0,O=N?180:104;var M=parseInt(L.w,10)-P+"px",J=parseInt(L.h,10)-O+"px";if(this.height&&J!==this.height){this.set("height",J);}else{this.height=J;}if(this.width&&M!==this.width){this.set("width",M);}else{this.width=M;}return true;},getSrcCnt:function(){return this.main.srcInput.children.length;},getSrcUrls:function D(){return this.main.srcInput.getSrcs();},removeSrcs:function A(J){this.main.srcInput.removeSrcs(J);}});}());(function(){mstrmojo.requiresCls("mstrmojo.form","mstrmojo.hash","mstrmojo.Obj","mstrmojo.architect.ui.editors.NameEditor","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.obj.DBRole","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.warehouse.ui.editors.CatalogSQLEditor","mstrmojo.DI.DIConstants");var O=mstrmojo.hash,L=mstrmojo.func.wrapMethods,M=mstrmojo.warehouse.EnumDataChangeEvents,Q=M.DBTABLES_CHANGED,u=mstrmojo.warehouse.EnumObjectTypes,d=u.DBROLE,k=mstrmojo.DI.DIConstants,P,C,Z=57;function l(AH,AG){var AF;if(AH){AF=this.model.getDBRole(AH.did);if(AF){return AF;}}if(AG){AF=new mstrmojo.warehouse.obj.DBRole({mdl:this.model});if(AH&&AH.did){AF.did=AH.did;}return AF;}return null;}function S(){var AF="creating_a_database_connection.htm";if(mstrApp.type===k.xdaType.mdx){AF="Creating_a_data_source_connection_to_an_OLAP_source.htm";}else{if(mstrApp.subtype===k.sourceSubtype.searchOnSource){AF="Creating_a_data_source_connection_to_search.htm";}}return AF;}mstrmojo.warehouse.WHController=mstrmojo.declare(mstrmojo.Obj,null,{start:mstrmojo.emptyFn,getDataService:mstrmojo.emptyFn,loadDBRoles:function D(AF){this.model.loadDBRoles(AF);},isCloud:function R(){return false;},isUsingCookieNamespace:function A(){return this.model.usingCookieNamespace;},getDBRoles:function E(){return this.model.dbrs;},getAllDBRoleNames:function Y(){return this.model.allDBRoleNames;},loadDBObjects:function N(AF){this.model.loadDBObjects(AF);},getDBObjects:function T(){return this.model.dbObjects;},setNameSpaceID:function b(AF){this.model.set("SelNameSpaceID",AF);},getNameSpaceID:function t(){return this.model.SelNameSpaceID;},getNameSpaces:function AA(AF){this.model.SelNameSpaceID=undefined;this.model.getNameSpaces(AF);},getColumnsForDBTables:function F(AI,AJ){var AF=this.model,AG=AI.tables,AH=AI.getFresh;O.forEach(AG,function(AL){AF.getColumnsForDBTable({data:AL,getFresh:AH},L({success:function AM(AN){AL.items=O.clone(AN.items);},complete:function AK(){AF.raiseEvent({name:M.DBTABLE_UPDATED,item:AL});}},AJ));});},getColumnsForDBTable:function W(AF,AG){if(P&&P.visible){AF.data.dbrole=P.dbRole.did;}this.model.getColumnsForDBTable(AF,AG);},setSelectedDBRoleID:function J(AF){this.model.set("SelDBRoleID",AF.did);},handleDBTableRefresh:function a(AG){var AF=this.model;AF.catalogRefresh=true;this.availableTableSearch("",O.copy(AG,{sourceInfo:"tablesPanel"}));},sqls:undefined,getCurrentZIndex:function X(){if(mstrApp.sessionManager){return mstrApp.sessionManager.zIndex;}return undefined;},displayCatalogSQL:function w(AH){var AG=this,AF=this.model,AI=AH||AF.SelDBRoleID;P=P||new mstrmojo.warehouse.ui.editors.CatalogSQLEditor({help:"defining_tables_are_retrieved_and_cached_for_a_data_source.htm"});AG.getDataService().catalogAction({success:function AJ(AL){P.options=AL.options;P.SQLStatements=AL.sqls;AF.getDBRole(AI).populate(function AK(AN){P.dbRole=AN;P.supportsNameSpaces=AN.supportsNameSpaces;P.onUpdateInfo=function AP(AQ){AG.getDataService().catalogAction({success:function AR(){if(AF.SelDBRoleID===AI&&AF.SelNameSpaceID){AG.availableTableSearch("",{sourceInfo:"tablesPanel"});}}},{dbrid:AI,info:JSON.stringify(AQ.options),flags:10003});};var AO=AG.getCurrentZIndex(),AM={};if(AO){AM.zIndex=AO+1;}P.open(null,AM);});}},{dbrid:AI,flags:10002});},attachDataChangeListeners:function g(AG){var AF=this.model;O.forEach(AG,function(AH,AI){O.forEach(AH,function(AK,AJ){AF.attachEventListener(AJ,AI,AK);});});},editDBRole:function c(AF,AH){var AG=this;l.call(this,AF,true).populate(function(AI){AG.loadDBObjects({success:function AJ(){C=C||new mstrmojo.warehouse.dbroles.DBRoleEditor({help:S()});C.config=AG.model.dbRoleEditorCfg;C.config.showAddDriver=AG.model.showAddDriver;C.callback=AH||mstrmojo.emptyFn;C.dbrole=AI;C.container.dsninfo.clear();C.open();}});});},renameDBRole:function AE(AF){l.call(this,AF,false).populate(function(AG){if(!AG){return ;}var AI=new mstrmojo.architect.ui.editors.NameEditor({data:AG,tp:d,zIndex:9999,isNew:false,help:S(),onOK:function AH(AJ){AG.rename(AJ);}});AI.open();});},duplicateDBRole:function o(AF){var AG=this;l.call(AG,AF,false).populate(function(AH){if(!AH){return ;}AH.duplicate();});},deleteDBRole:function K(AF){var AG=this;l.call(AG,AF,false).populate(function(AI){var AH=mstrmojo.Button.newInteractiveButton;if(!AI){return ;}mstrmojo.confirm(mstrmojo.desc(10073,"Are you sure you want to delete the Database Connection")+" "+AI.n+"?",null,{buttons:[AH(mstrmojo.desc(219,"Yes"),function AJ(){AG.model.deleteDBRole(AI.mdDBRole.did,{success:function AK(){}});},null,{iconClass:"mstrmojo-Editor-button-Yes"}),AH(mstrmojo.desc(218,"no"),null,null,{iconClass:"mstrmojo-Editor-button-No"})],title:mstrmojo.desc(3169,"delete"),zIndex:9999});});},setProjectPrimaryDBRole:function e(AG,AH){var AF=this.model;AF.SelDBRoleID=AG.did;AF.setProjectPrimaryDBRole(true,AH);},getProjectPrimaryDBRoleID:function I(){return this.model.projPrimaryDBRoleID;},saveDBRole:function G(AG,AF,AJ){var AH=this;AH.model.saveDBRole(AG.mdDBRole,AF,L(AJ,{success:function AI(AL){var AM=AL.dbr.did,AN=AL.dbr.n,AK=l.call(AH,{did:AM},true);AK.populated=false;AK.n=AN;}}));},populateDBRole:function V(AF,AG){this.model.populateDBRole(AF,AG);},navigateProject:function h(AF){if(AF){mstrmojo.form.send({evt:3010,Server:AF.sname,Project:AF.pname,Port:AF.port,loginReq:true},mstrApp.name,"POST",null,null,false);}else{mstrmojo.form.send({evt:3010},mstrApp.name,"POST",null,null,false);}},navigateArchitect:function AD(AF){mstrmojo.form.send({evt:3176,Server:AF.sname,Project:AF.pname,Port:AF.port,loginReq:true},mstrApp.name,"POST",null,null,false);},availableTableSearch:function z(AF,AG){this.model.getSelectedDBRoleTables(L({blockBegin:0,blockCount:1000,filterText:AF},AG||{}));},getPrimaryDBRoleTablesAndColumns:function AC(AF){this.model.getDBRoleTablesAndColumns({dbRoleID:this.model.projPrimaryDBRoleID},AF);},hasPrivilege:function f(AF){return mstrApp.isSingleTier||this.model.privileges[AF]||false;},validateName:function U(AH,AF,AG,AI){return this.model.validateName(AH,AF,AG,AI);},findNextName:function x(AF,AG,AH){return this.model.findNextName(AF,AG,AH);},findinArray:function AB(AF,AH,AG){return this.model.findinArray(AF,AH,AG);},getObjectCount:function B(AH){if(Object.keys){return Object.keys(AH).length;}var AF,AG=[];for(AF in AH){if(AH.hasOwnProperty(AF)){AG.push(AF);}}return AG.length;},destroy:function q(AF){if(C){C.destroy(AF);C=null;}this._super(AF);},cleanError:function n(AF){AF=AF.replace("com.microstrategy.webapi.MSTRWebAPIException:","");AF=AF.replace("Internal Error:","");return mstrmojo.string.trim(AF);},launchOneTierFileBrowser:function j(AF){window.FormWrapper.openFileDialog(AF);},launchOneTierAccessFileBrowser:function j(AF){window.FormWrapper.openAccessDialog(AF);},oneTierFileUploader:function m(AG,AF){mstrApp.serverRequest(O.copy(AF,{taskId:"addDriver"}),AG,true);},clearDBTables:function H(){this.model.raiseEvent({name:Q,items:[],selectedItems:[]});},canDisplayCatalogSQL:function p(AJ,AI){var AF=mstrmojo.hash.valarray(AJ),AH=mstrmojo.array.find(AF,"v",AI),AG=AF[AH];if(mstrApp.isSingleTier){return false;}if((AG.disp&2)===2||(AG.disp&4)===4){return false;}if(!this.hasPrivilege(Z)){return false;}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DISourceObjects","mstrmojo.DI.DIAnalytics","mstrmojo.date");mstrmojo.requiresDescs(14214,14534);var H=["MM/DD/YYYY","today","yesterday"],P=/^\d+daysAgo$/;var I=mstrmojo.DI.DIConstants.sourceType;var c=mstrmojo.DI.DIConstants;var D="###";var A="yyyy-MM-dd";var E=mstrmojo.DI.DIHelpers.isOperationMode,N=mstrmojo.array,Q=mstrmojo.locales,Y=mstrmojo.date;var J={scriptClass:"mstrmojo.DI.DIAnalytics",alias:"analyticsComponent",slot:"analyticsNode"};function S(f){var e;if(f.toUpperCase()==="MM/DD/YYYY"){e="YYYY-MM-DD";}else{if(mstrmojo.array.indexOf(H,f)!==-1||P.test(f)){e=f;}else{var d=mstrmojo.date.getDateJson(new Date(f));if(d.day.toString()!=="NaN"){e=mstrmojo.date.formatDateInfo(d,"yyyy-MM-dd");}else{mstrApp.getRootController().displayError(mstrmojo.desc(14214,"Requests can only specify a date formatted as YYYY-MM-DD, or as a relative date (e.g., today, yesterday, or N days ago where N is a positive integer). Please change your input into any of the aforementioned formats."),false);return ;}}}return e;}function R(d){var f,e=d.dateTable;if(e.dates.idx===0){f="&start-date="+S(e.fromDate.value)+"&end-date="+S(e.toDate.value);}else{f="&dynamic-date={"+e.dates.options[e.dates.idx].qn+"}";}return f;}function F(d,e){var f,g;f=R(d);var h=e.address.replace("${PROFILEIDS}","ga:"+d.selectedProfile.id);g=h+f;return g;}function O(d){d=d.substr(d.indexOf("?")+1);return decodeURIComponent(d);}function W(e,f){var g=e.indexOf(f);if(g===-1){return"";}var d=e.indexOf("&",g+f.length)===-1?e.length:e.indexOf("&",g+f.length);return e.substring(g,d);}function T(e,d){var f="";if(d.node){f=e+D+"accountID:"+this.selectedAccount.id+",webPropertyID:"+this.selectedWebProperty.id+",profileID:"+this.selectedProfile.id+",folderName:"+d.node.parent.text;}else{f=e+D+"accountID:"+this.selectedAccount.id+",webPropertyID:"+this.selectedWebProperty.id+",profileID:"+this.selectedProfile.id;}return f;}function L(e){var d,l,m,h,j,f;if(this.tableID){d=this.model.getImportSource(this.tableID);}if(this.currentSource){d=this.currentSource;}if(!d){return ;}l=d.sourceInfo.url.substr("SQL=".length);m=l.indexOf(D);if(m>-1){var g=l.substr(m+D.length,l.length);g=g.split(",");h=this.model.externalSources[I.googleAnalytics];var k=this.analyticsComponent.accountTable;switch(e){case"accountID":mstrmojo.array.forEach(g,function(o){var n=o.split(":");if(n[0]===e){j=mstrmojo.array.find(h.accounts,"id",n[1]);k.account.set("idx",j);}});break;case"webPropertyID":mstrmojo.array.forEach(g,function(o){var n=o.split(":");if(n[0]===e){j=mstrmojo.array.find(h.accounts[k.account.idx].webProperties,"id",n[1]);k.webproperty.set("idx",j);}});break;case"profileID":mstrmojo.array.forEach(g,function(o){var n=o.split(":");if(n[0]===e){j=mstrmojo.array.find(h.accounts[k.account.idx].webProperties[k.webproperty.idx].profiles,"id",n[1]);k.profiles.set("idx",j);}});break;case"folderName":mstrmojo.array.forEach(g,function(o){var n=o.split(":");if(n[0]===e){f=n[1];}});return f;}}}function b(){var e=mstrApp.getRootController().getModel(),g="CustomQuery",f=this.customQueryCnt,d;if(!f){f=1;}do{d=g+f;f++;}while(!e.isTableAliasUnique(d));return d;}function V(f){var m=[];var p,h,g,o;var e=this.model.operationMode;var j=this.browser.fileTree,n,l=this.analyticsComponent;var k=this.tableID||null,d;if(E(this.operationMode)){e=this.operationMode;}o=true;if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}if(this.analyticsComponent.ultp.selectedIndex===0){for(h=0;h<j.selectedNodes.length;h++){g=j.selectedNodes[h].data;p={n:g.n,desc:g.desc,type:g.type,tableID:k};if(!mstrApp.isSingleTier){p.node=j.selectedNodes[h];}n=F(this.analyticsComponent,g);n=O(n);n=T.call(l,n.trim(),g);p.query=n;m.push(p);}}else{if(this.analyticsComponent.ultp.selectedIndex===1){p={desc:"Google Analytics",type:"file",tableID:k,node:null};if(k){d=mstrApp.getRootController().getModel().getImportSource(k);if(d&&d.sourceInfo){p.n=d.sourceInfo.name;}else{p.n=b.call(this);}}else{p.n=b.call(this);}n=this.textarea.value.substr(this.textarea.value.indexOf("ids=ga"));n=O(n);n=T.call(l,n.trim(),p);p.query=n;m.push(p);}}if(k){mstrApp.getRootController().refreshDataOAuthReport(this.sourceObjectsInfo.type,this.sourceObjectsInfo.subtype,k,m[0],c.actions.refreshData);}else{mstrApp.getRootController().importMultiOAuthReports(this.sourceObjectsInfo.type,m,o,!mstrApp.getRootController().model.hasEMMAReportInstance(),f,this.sourceObjectsInfo.subtype,this.id);}}mstrmojo.DI.DISourceObjectsGA=mstrmojo.declare(mstrmojo.DI.DISourceObjects,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DISourceObjectsGA",cssClass:"mojo-di-sourceobjectsga",refreshed:false,populate:function(o){var q=[],j,e,d,g,n=this.analyticsComponent.accountTable;var h=this.model.externalSources[I.googleAnalytics];var f=this.model.operationMode;if(E(this.operationMode)){f=this.operationMode;}if(o&&o.targetPageId){if(o.targetPageId!==this.id){return ;}}for(j in h.accounts){q.push({n:h.accounts[j].n,v:j});}n.account.set("options",q);n.account.notExist=false;if(this.tableID&&(f===c.operationMode.refresh||f===c.operationMode.edit)){L.call(this,"accountID");if(n.account.idx===-1){n.account.notExist=true;mstrApp.getRootController().displayError(mstrmojo.desc(14534,"The user has not been granted permissions on the account."),false);if(n.account.options.length>0){n.account.set("idx",0);}}}else{n.account.set("idx",0);}n.account.refresh();var m=this.model.externalSources[this.sourceObjectsInfo.type].reports;var l=mstrApp.getRootController().parseOAuthSourceFolder(this.sourceObjectsInfo.type,m);this.browser.set("fileList",l);if(f===c.operationMode.refresh||f===c.operationMode.edit){if(this.tableID){d=this.model.getImportSource(this.tableID);}if(this.currentSource){d=this.currentSource;}if(d&&d.sourceInfo&&d.sourceInfo.name){var k=d.sourceInfo.dbTableName;var p=L.call(this,"folderName");if(k.indexOf("CustomQuery")<0&&k.indexOf("Google Analytics Query")<0&&!!p){e=this.browser.fileTree.items;if(p){for(g=0;g<e.length;g++){if(e[g].isFolder===true&&e[g].n===p){this.browser.autoSelectNode(e[g].node,"/"+k);e[g].fetched=true;e[g].node.set("state",1);}}}}}}},onHelpButtonClick:function a(){return"Importing_data_from_google_analytics.htm";},onNextButtonClick:function K(){V.call(this);},onFinishButtonClick:function(){V.call(this,c.actions.savePublish);},handleImportError:function(e,d){if(this.analyticsComponent.ultp.selectedIndex===0){this.browser.set("forceEnableContinue",!this.tableID);N.forEach(e,function(g,f){if(d[f].success===true){g.node.deselect();}});}return true;},onEditButtonClick:function G(e){var d=this.analyticsComponent;var g=d.ultp;var f;f=F(d,e.data);e.data.browser.parent.textarea.value=f;g.setSelectedItems(g.items[1]);e.data.browser.parent.textarea.focus();},postBuildRendering:function Z(){if(this._super){this._super();}this.model.externalSources[I.googleAnalytics].attachEventListener("analyticsWebPropertiesFetched",this.id,this.populateWebProperties);this.model.externalSources[I.googleAnalytics].attachEventListener("analyticsProfilesFetched",this.id,this.populateProfiles);this.populateDate();},populateDate:function X(){var e=this.model.operationMode,f=this.analyticsComponent.dateTable,d;if(E(this.operationMode)){e=this.operationMode;}if(e===c.operationMode.refresh||e===c.operationMode.edit){if(this.tableID){d=this.model.getImportSource(this.tableID);}if(this.currentSource){d=this.currentSource;}if(d){var o=d.sourceInfo.url.substr("SQL=".length);o=o.substring(0,o.indexOf(D));if(o.indexOf("start-date=")!==-1){f.dates.set("idx",0);var n=W(o,"start-date=").substr("start-date=".length);var k=W(o,"end-date=").substr("end-date=".length);var q;q=Y.parseDate(n,false,A);if(!q){q=Y.parseDate(n);}n=q?Y.formatDateInfo(q,Q.datetime.DATEOUTPUTFORMAT):n;f.fromDate.set("value",n);q=Y.parseDate(k,false,A);if(!q){q=Y.parseDate(k);}k=q?Y.formatDateInfo(q,Q.datetime.DATEOUTPUTFORMAT):k;f.toDate.set("value",k);}else{if(o.indexOf("dynamic-date={")!==-1){var j=o.substring(o.indexOf("dynamic-date={")+"dynamic-date={".length,o.indexOf("}",o.indexOf("dynamic-date={")+"dynamic-date={".length));var m=3;var p=f.dates.options;for(var h=0,l=p&&p.length||0;h<l;h++){var g=p[h];if(g&&g.qn.indexOf(j)>-1){m=h;}}f.dates.set("idx",m);}}}}},postCreate:function C(){this.children=mstrmojo.hash.clone(this.children);if(this._super){this._super();}J.model=this.model;J.tableID=this.tableID;J.currentSource=this.currentSource;this.addChildren([new mstrmojo.DI.DIAnalytics(J)]);},populateWebProperties:function B(d){var g=this.model.operationMode,j=this.analyticsComponent.accountTable,k=j.account.idx;if(E(this.operationMode)){g=this.operationMode;}if(d&&d.targetPageId){if(d.targetPageId!==this.id){return ;}}var f=[],h;var e=this.model.externalSources[I.googleAnalytics];if(k!==undefined){for(h in e.accounts[k].webProperties){f.push({n:e.accounts[k].webProperties[h].n,v:h});}}j.webproperty.set("options",f);if((g===c.operationMode.refresh||g===c.operationMode.edit)&&(!this.refreshed)&&this.tableID){if(f.length!==0){if(!j.account.notExist){L.call(this,"webPropertyID");}else{j.webproperty.set("idx",0);}}else{j.webproperty.set("idx",-1);}}else{j.webproperty.set("idx",-1);j.webproperty.set("idx",0);}j.webproperty.refresh();},populateProfiles:function M(d){var f=[],k=this.analyticsComponent.accountTable,h,l=k.account.idx,g;var e=this.model.externalSources[I.googleAnalytics];var j=this.model.operationMode;if(E(this.operationMode)){j=this.operationMode;}if(d&&d.targetPageId){if(d.targetPageId!==this.id){return ;}}if(l!==undefined&&e.accounts[l].webProperties){g=e.accounts[l].webProperties[k.webproperty.idx];if(g){for(h in g.profiles){f.push({n:g.profiles[h].n,v:h});}}}k.profiles.set("options",f);if((j===c.operationMode.refresh||j===c.operationMode.edit)&&(!this.refreshed)&&this.tableID){if(f.length!==0){if(!k.account.notExist){L.call(this,"profileID");}else{k.profiles.set("idx",0);}this.refreshed=true;}else{k.profiles.set("idx",-1);}}else{k.profiles.set("idx",-1);k.profiles.set("idx",0);}k.profiles.refresh();},setDimensions:function U(g,e){var d=parseInt(g,10);var f=parseInt(e,10);if(isNaN(d)||isNaN(f)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listNode=Math.max((d-250),0)+"px";this.layoutConfig.w.listNode=Math.max((f-40),0)+"px";if(this._super){this._super(d+"px",e);}if(this.analyticsComponent){this.analyticsComponent.fixObjectBrowserHeight();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.rw.ConditionWalk","mstrmojo.Label","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.expr","mstrmojo.css");var F=mstrmojo.expr.ET.MQ,H=mstrmojo.expr.ET.MC,C=mstrmojo.css,B=mstrmojo.desc(14387,"Evaluate this condition independent of other dataset level conditions");var G=function(K,M){var J=K.et,L=((J===F||J===H)&&!this.inRelation)?"block":"none",I=((M===1)||J!==F)?1:0;C.toggleClass(this.toolNode,"unselectable",J===H);this.toolNode.style.display=L;this.level.set("selectedIndex",I);this.includeExist.set("visible",I===1&&(J===H||J===F));this.includeExist.set("checked",K.idcsi===undefined?false:K.idcsi);};mstrmojo.fe.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,null,{scriptClass:"mstrmojo.fe.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="tools"></div><div class="apply"></div></div>',markupSlots:mstrmojo.hash.copy({toolNode:function(){return this.domNode.childNodes[2];}},mstrmojo.hash.copy(mstrmojo.rw.ConditionWalk.prototype.markupSlots)),layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",toolNode:"auto",applyNode:"auto"},xt:true},postCreate:function E(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Label",slot:"toolNode",text:mstrmojo.desc(13517,"Calculate on")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"toolNode",alias:"level",isHostedWithin:false,items:[{n:mstrmojo.desc(13518,"Template level"),v:0},{n:mstrmojo.desc(13519,"Dataset level"),v:1}],onitemSelected:function I(J){var K=this.parent;if(K&&K.condition&&K.visible){K.includeExist.set("visible",J.v===1);K.condition.level=J.v;}}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"includeExist",slot:"toolNode",postBuildRendering:function(){this.domNode.innerHTML=B;},oncheckedChange:function(){var J=this.parent;if(J){J.model.set("idcsi",this.checked);}}}]);if(this._super){this._super();}},onvisibleChange:function A(I){var J=this.condition;if(J&&this.toolNode&&this.visible){G.call(this,J.data,J.tree.level);}if(this._super){this._super(I);}},onmodeledit:function D(I){if(this._super){this._super(I);}if(this.toolNode){G.call(this,this.model.get(),this.model.level);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.Box","mstrmojo.Button","mstrmojo.Dial","mstrmojo.Editor","mstrmojo.FilterExpr","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Obj","mstrmojo.CheckBox","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.fe.FilterExprTree","mstrmojo.fe.RelationFilterExprTree","mstrmojo.fe.CreateSetEditor","mstrmojo.fe.ConditionWalk","mstrmojo.ui.Pulldown","mstrmojo.ui.StatusButton");var Z=mstrmojo.expr,I=Z.ET,P=Z.BRANCH_FNS,X=mstrmojo.Obj,W=mstrmojo.dom,a=mstrmojo.array,T=mstrmojo.hash,d=mstrmojo.css,C=mstrmojo.warehouse.EnumObjectTypes,K={TEMPLATE:0,DATASET:1},E=mstrmojo.mstr.EnumNodeDimty,R=a.hash([E.NodeDimtyUnspecified,E.NodeDimtyNone]),N=200,H=mstrmojo.ui.PopupConfig.ENUM_CORNERS;function B(g){a.forEach(this.buttonBar.children[0].children,function(h){h.set("enabled",g);});}function Y(){var g=this.avatar;if(g){g.parentNode.removeChild(g);delete this.avatar;d.removeClass(g,[this.avatarCssClass]);}}mstrmojo.fe.FilterEditorBase=mstrmojo.declare(mstrmojo.Editor,null,{onSave:null,title:mstrmojo.desc(12032,"View Filter Editor"),help:"view_filter_editor_for_report_services_documents.htm",cssClass:"mstrmojo-charcoalboxe mstrmojo-FE",showLimits:true,objectBrowsingEnabled:false,children:null,init:function U(g){this.children=[{alias:"feContent",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-content",postCreate:function(){this.children=[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-exprTool",children:[{scriptClass:"mstrmojo.ui.StatusButton",cssClass:"mstrmojo-FE-addCondition",postCreate:function h(){this.editor=this.parent.parent.parent;this.statusList=this.editor.getAddConditionList();this.status=this.statusList[0];},onButtonClick:function(j){if(j){j.handler.apply(this.editor);}}}]},this.parent.getExpressionContainerCfg()];}},this.getConditionWalkConfig(),{alias:"buttonBar",scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HBox",cssText:"float:right; border-collapse: separate",cellSpacing:3,children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),onclick:function(){var h=this.editor;M(h);h.close();},bindings:{enabled:function(){return !this.editor.readOnly;},editor:"this.parent.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.editor.close();},bindings:{editor:"this.parent.parent.parent"}}]}]}];this._super(g);this.model=this.model||new X();},getExpressionContainerCfg:function(){var g=this;return{alias:"feExpr",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-expr-list",postCreate:function(){this.children=g.getExpressionContentsConfig();},onRender:function(){W.attachMarkupEvent(this.id,this.domNode,"mousedown");},onmousedown:function(h){var j=W.eventTarget(h.hWin,h.e);if(this.isBlankArea(j)){this.clearSelect();}},isBlankArea:function(h){return h===this.domNode;},clearSelect:function(){}};},getExpressionContentsConfig:function(){return[];},getConditionWalkConfig:function(){var h=this;return{scriptClass:"mstrmojo.rw.ConditionWalk",width:"750px",objectBrowsingEnabled:false,dimtyTypes:R,alias:"walk",visible:false,onOK:function g(){var k=this.condition;h.feContent.set("visible",true);this.set("visible",false);h.onConditionEdit(k,this.model.get());B.call(h,true);},close:function j(){h.feContent.set("visible",true);this.set("visible",false);var k=this.condition;if(k.isEmpty()){k.del();}B.call(h,true);},targets:null,targetsLastMod:null,ets:null,condition:null,bindings:{disableElementsBrowsing:"this.parent.disableElementsBrowsing"}};},onConditionEdit:function(h,g){h.tree.modifyConditionNode(h,g);},getAddConditionList:function c(){return[{n:mstrmojo.desc(1994,"Add Condition"),handler:function(){this.mainExpr.newCondition(null,true);}}];},andOrPopupRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-FE-andOrPopup mstrmojo-CGE-andOrPopup mstrmojo-ConditionWalk",contentNodeCssClass:"mstrmojo-balloon",slot:"containerNode",modal:false,autoClose:true,showTitle:false,draggable:false,openEffect:null,closeEffect:null,onOpen:function(){var g=this.condition,k=g&&g.data&&g.data.not,l=g&&g.parent,h=l&&l.data,j=(h&&h.fn)+(k?21:0);this.list.opening=true;this.list.set("selectedItem",isNaN(j)?null:{did:j});this.list.opening=false;},children:[{scriptClass:"mstrmojo.Dial",cssClass:"mstrmojo-CGE-andOrDial",alias:"list",itemMarkup:'<div class="dial-item {@css}">{@n}</div>',itemIdField:"did",items:[{did:19,n:P[19]},{did:20,n:P[20]},{did:19+21,n:P["19_21"]},{did:20+21,n:P["20_21"]}],onchange:function(){if(this.opening){return ;}var h=this.parent,g=h.condition,n=this.selectedItem,m=n&&n.did,l=m>21?true:null,k=m-(l?21:0);h.close();var j=g&&g.parent;if(j&&j.data&&j.data.et===I.ANDOR){j.edit(g,k,l);}else{var o=g&&g.data;if(o&&(o.not!==l)){o.not=l;g.paint();}}}}]},createSetPopupRef:{scriptClass:"mstrmojo.fe.CreateSetEditor",contentNodeCssClass:"",cssClass:"CreateSet-Editor",title:mstrmojo.desc(12034,"Create a Set"),slot:"containerNode"},_set_busy:function(h,g){if(g){this.set("enabled",false);this.set("iconClass","mstrmojo-WaitIcon");}else{this.set("enabled",true);this.set("iconClass","");}},_set_model:function(l,h){var j=this.model,k=j!==h;if(k){this.model=h;this.modelLastSet=new Date();var g=function(m){return Q(J(m));};h.exprForest=g(h.expr);h.limitExprForest=g(h.limitExpr);if(this.feContent&&this.feContent.feExpr.ve){this.feContent.feExpr.ve.nameFactory.clear();}}return k;},onUpdateBrowseElementsParams:mstrmojo.emptyFn});mstrmojo.fe.ReportFilterEditor=mstrmojo.declare(mstrmojo.fe.FilterEditorBase,null,{getExpressionContainerCfg:function(){var g=this._super();return mstrmojo.mixin({clearSelect:function(){this.re.clearTreeSelect();}},g);},getExpressionContentsConfig:function(){return[{alias:"re",scriptClass:"mstrmojo.fe.ReportFilterExprTree",level:K.DATASET,bindings:{items:"this.editor.model.exprForest || []"},postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("mainExpr",this);}}];}});mstrmojo.fe.ReportFilterExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.ReportFilterExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-datasetExpr",onNew:function(g){g.data.isNew=true;F(this.editor,g.data,g.widget.ctxtBuilder.itemWidgets[g.index],"condition");},onnodeclick:function A(g){F(g.editor||this.tree.editor,this.data,this,g&&g.part);},allowDrop:function G(g){var j=g&&g.src,l=j&&j.data,k=l&&l.et,h=j&&j.widget&&j.widget.tree;return k&&this!==h;}});mstrmojo.fe.FilterEditor=mstrmojo.declare(mstrmojo.fe.FilterEditorBase,null,{getExpressionContainerCfg:function(){var g=this._super();return mstrmojo.mixin({isBlankArea:function(h){if(this._super(h)){return true;}return !a.filterOne([this.ve,this.vle],function(j){if(W.contains(j.domNode,h,true)){return true;}});},clearSelect:function(){this.ve.clearTreeSelect();this.vle.clearTreeSelect();}},g);},getExpressionContentsConfig:function(){return[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11746,"Dataset Level Conditions"),cssClass:"mstrmojo-FE-expr-header dl",bindings:{visible:"true || this.parent.parent.parent.showLimits"}},{alias:"ve",scriptClass:"mstrmojo.fe.RWViewFilterExprTree",level:K.DATASET,bindings:{items:"this.editor.model.exprForest || []"},onBlankClick:function(g){this.parent.clearSelect(g);},supportRelation:true,postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("mainExpr",this);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11747,"Template Level Conditions"),cssClass:"mstrmojo-FE-expr-header tl",bindings:{visible:"this.parent.parent.parent.showLimits"}},{alias:"vle",scriptClass:"mstrmojo.fe.RWViewLimitExprTree",level:K.TEMPLATE,bindings:{visible:"this.editor.showLimits",items:"this.editor.model.limitExprForest || []"},onBlankClick:function(g){this.parent.clearSelect(g);},postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("limitExpr",this);}}];},getConditionWalkConfig:function(){var g=this._super();T.copy({scriptClass:"mstrmojo.fe.ConditionWalk"},g);return g;},getAddConditionList:function c(){var g=this._super();g.push({n:mstrmojo.desc(12055,"Add Dynamic Condition"),handler:function(){this.mainExpr.newCondition({et:I.XML,idc:1,ph:{}},true);}});return g;},onConditionEdit:function(j,h){if(j.tree.level===j.level||j.tree.level===undefined){this._super(j,h);}else{j.parent.remove(j.data);var g=K.TEMPLATE===j.level?this.limitExpr:this.mainExpr;g.addSingleCondition(h);}}});mstrmojo.fe.RWViewFilterExprTree=mstrmojo.declare(mstrmojo.fe.RelationFilterExprTree,null,{scriptClass:"mstrmojo.fe.RWViewFilterExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-datasetExpr",onNew:function(g){g.data.isNew=true;if(!g.data.ph){F(this.editor,g.data,g.widget.ctxtBuilder.itemWidgets[g.index],"condition");}},onnodeclick:function A(g){F(g.editor||this.tree.editor,this.data,this,g&&g.part);},ondragend:function O(j){var h=j&&j.tgt,g=h&&h.widget;if(this.tree&&g&&g.tree&&g.tree!==this.tree){Y.call(this);return ;}this._super(j);},getItemConfig:function(j,g,k){var h=this._super(j,g,k);return T.copy({getConditionTextPostfix:function(){if(this.data.et!==I.MQ){return"";}return'<img class="mstrmojo-moveToViewLimit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(4978,"Move to view limit")+'"onclick="var w = mstrmojo.all[\''+this.id+"']; w.tree.moveMQNodeToViewLimit(w); return false;\" />";}},h);},moveMQNodeToViewLimit:function(j){if(j.data.et!==I.MQ){return ;}var h=T.copy(j.data);j.parent.remove(j.data);var g=this.editor.limitExpr;g.addSingleCondition(h);},allowDrop:function G(g){var j=g&&g.src,m=j&&j.data,l=m&&m.et,k=this.tree,h=j&&j.widget&&j.widget.tree;return l&&(this===k?(h!==k):true);}});mstrmojo.fe.RWViewLimitExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.RWViewLimitExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-limitExpr",validExprTypes:a.hash([I.MQ]),onnodeclick:function A(g){F(this.tree.editor,this.data,this,g&&g.part);},onConditionEdit:function(h,g){this._super(h,g);h.data.mdxUnitId=h.data.m.did;V(h);},addSingleCondition:function(h){var g=this._super(h);V(g);},allowDrop:function(g){var k=g&&g.src,m=k&&k.data,l=m&&m.et,j=this.tree,h=k&&k.widget&&k.widget.tree;if(j===h){return this!==h&&this.data&&(this===k.parent||this.data.mdxUnitId===m.mdxUnitId);}return l===I.MQ;},ondrop:function L(h){var l=h&&h.src,g=l&&l.widget;if(g&&g.tree!==this.tree){var k=l&&l.data;if(k&&k.index!==null){var j=g.ctxtBuilder.itemWidgets[k.index];j.tree.moveMQNodeToViewLimit(j);}l.data=null;}this._super(h);},isEditable:function(g){return g.mdxUnitId&&this._super(g);},ondragend:function S(g){var k=g&&g.tgt,h=k&&k.widget;if(h&&h.tree!==this.tree){var j=g.src&&g.src.data;if(j&&(j.indices||(j.index!==null))){this.remove(j.indices||j.index);}Y.call(this);}else{this._super(g);}},moveMQNodeToViewFilter:function(h){var g=this.editor.mainExpr;h.parent.remove(h.data);g.addSingleCondition(h.data);},getItemConfig:function(j,g,k){j.mdxUnitId=D(j);var h=this._super(j,g,k);return T.copy({cssClass:f(j,g,k)?"per-metric-limit":"",forbidRelation:true,getConditionTextPostfix:function(){if(this.data.et!==I.MQ){return"";}return'<img class="mstrmojo-moveToViewFilter" src="../images/1ptrans.gif" title="'+mstrmojo.desc(9746,"Move to view filter")+'"onclick="var w = mstrmojo.all[\''+this.id+"']; w.tree.moveMQNodeToViewFilter(w); return false;\" />";}},h);}});function F(p,m,o,u){var h=W.delta(o.domNode,p.containerNode);h.y+=(u==="andor"?16:parseInt(o.domNode.offsetHeight,10));var q={condition:o,zIndex:p.zIndex+10,left:h.x+"px",top:h.y+"px"},g;switch(u){case"andor":if(p.skipAndOrPopup){return ;}g="andOrPopupRef";break;case"createSet":case"createSetOpt":var t=p.model.targets;g="createSetPopupRef";q.type=u;q.model={attrs:a.filter(t,function(n){return n.t===C.ATTRIBUTE;}),metrics:a.filter(t,function(n){return n.t===C.METRIC;})};if(u==="createSetOpt"){q.condition=o.parent;q.model.childIdx=o.childIndex();}break;case"condition":var l=p.walk,j=o.textNode.cloneNode(true),k=l.conditionNode.firstChild;d.removeClass(j,"editable");d.addClass(l.conditionNode,"mstrmojo-ConditionNode");if(k.firstChild){k.removeChild(k.firstChild);}k.appendChild(j);l.set("objectBrowsingEnabled",p.objectBrowsingEnabled);l.set("targets",p.model.targets);l.set("targetsLastMod",p.modelLastSet);l.set("ets",o.tree.validExprTypes||p.validExprTypes);l.set("condition",o);l.set("model",T.clone(m));l.set("hasPrompt",p.model.hasPrompt);l.set("disableElementsBrowsing",p.disableElementsBrowsing||l.disableElementsBrowsing);l.set("editor",p);l.set("inRelation",o.inRelation);p.feContent.set("visible",false);l.set("visible",true);l.columnWalk.target.updateScrollbars();B.call(p,false);return ;}p.openPopup(g,q);}function M(h){var g=h.model;g.expr=e(g.exprForest);g.limitExpr=e(b(g.limitExprForest));h.onSave(g);}function Q(h){var g=[];a.forEach(h,function(j){if(!j){return ;}if(j.et===I.ANDOR){j.nds=Q(j.nds);if(j.nds.length===0){return ;}else{if(j.nds.length===1){var k=j.nds[0];if(j.not){k.not=!k.not;}g.push(k);return ;}}}g.push(j);});return g;}function J(g){return g?[g]:[];}function e(g){return g&&g.length===1?g[0]:null;}function b(j){var h=Q(j),g;if(!h[0]||h[0].mdxUnitId){g={et:I.ANDOR,fn:Z.FN.AND,nds:h};}else{g=h[0];}return[g];}function f(h,g,j){return(j===j.tree||j.parent===j.tree)&&!!h.mdxUnitId;}function D(h){if(!("mdxUnitId" in h)){var g;switch(h.et){case I.MQ:g=h.m.did||null;break;case I.ANDOR:a.forEach(h.nds,function(k){var j=D(k);if(g===undefined){g=j;}else{if(g!==j){g=null;return false;}}return true;});break;default:g=undefined;break;}h.mdxUnitId=g;}return h.mdxUnitId;}function V(m){var o=m.tree,n=o.ctxtBuilder.itemWidgets[0],t=m.parent,p=a.indexOf(t.items,m.data),k=t.items[p],h=k.mdxUnitId;if(t===o){return ;}if(t.data.mdxUnitId===h){return ;}if(n.data.mdxUnitId){var j={et:I.ANDOR,fn:Z.FN.AND,nds:[n.data,k]};o.remove(0);o.add([j]);o.ctxtBuilder.itemWidgets[0].ctxtBuilder.itemWidgets[0].remove(k);}else{var l=n,g;a.forEach(n.data.nds,function(w,u){if(w.mdxUnitId===k.mdxUnitId&&n.items[u]!==k){l=n.ctxtBuilder.itemWidgets[u];g=u;return false;}});if(l===t){return ;}if(l.data.et!==I.ANDOR){var q={et:I.ANDOR,fn:Z.FN.AND,nds:[l.data,k]};n.add([q],g+1);n.remove(l.data);}else{l.add([k]);}t.remove(k);}}}());(function(){mstrmojo.requiresCls("mstrmojo.qb.es.DataService","mstrmojo.warehouse.WHController","mstrmojo.qb.es.AlternateSourceDialog","mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog","mstrmojo.qb.QBHelpers","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12379,12380,2171,9614,9621,1395,9613,9619,2265,8002,9612,9623,9616,9611,9622,9615,2052,2170,9620,9617,9618,5471,4444);var b=mstrmojo.array,U=mstrmojo.hash,e=mstrmojo.qb.QBHelpers,L=mstrmojo.desc,c=mstrmojo.DI.DIHelpers,j=mstrmojo.qb.EnumQBAppType,O=mstrmojo.DI.DIConstants;var h=1,R="mstr-qb-alternatesource";var H={1:L(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),2:L(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this.")};function E(n){var o=mstrApp.diShowFooterFunction;if(o){o({finish:{visible:n}});}}function I(n,p){var o;o=mstrmojo.all[R]||(new mstrmojo.qb.es.AlternateSourceDialog({id:R}));if(p){o.set("zIndex",p);}o.items=n;o.open();}var G={0:L(2171,"Default"),1:L(9614,"Integer"),2:L(9621,"Unsigned"),3:L(1395,"Numeric"),4:L(9613,"Decimal"),5:L(9619,"Real"),6:L(2265,"Double"),7:L(8002,"Float"),8:L(9612,"Char"),9:L(9623,"VarChar"),10:L(9616,"Long VarChar"),11:L(9611,"Binary"),12:L(9622,"VarBin"),13:L(9615,"Long VarBin"),14:L(2052,"Date"),15:L(2170,"Time"),16:L(9620,"TimeStamp"),17:L(9617,"NChar"),18:L(9618,"NVarChar"),30:L(5471,"Big decimal")};function P(n){return G[n]||L(4444,"Unknown");}function C(z){var w=[],t,u,x,AA,n,p,q,o;b.forEach(z,function(AB){t=u=x=AA="";p=(AB.vt===3)?1:0;switch(AB.vt){case 0:case 1:case 2:case 3:t=AB.n;u=P(AB.ddt);n=AB.src;x=n.n;AA=P(n.ddt);break;case 4:t=AB.n;u=P(AB.ddt);break;case 8:n=AB.src;x=n.n;AA=P(n.ddt);break;}q=u?t+"("+u+")":t;o=AA?x+"("+AA+")":x;w.push([q,p,o]);});return w;}function X(o){var n=[];b.forEach(o.tables,function(p){n.push(p.dbtn||"");});return{name:c.generateCubeName(n)};}mstrmojo.qb.es.Controller=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{ddaController:null,start:function V(){var t=this.rootView,p=this.model,q=this,n,u,o,z;this.dataService=mstrmojo.qb.es.DataService;if(mstrApp.emmaIRRMessageID){this.dataService.emmaIRRMessageID=mstrApp.emmaIRRMessageID;}t.render();this.toggleDatabaseView(true);var w=function w(){q.loadDBRoles({success:function AA(){var AB;AB=(mstrApp.emmaTablesNum===0);E(AB);if(mstrApp.tableID&&mstrApp.msgid){p.loadTable(mstrApp.tableID);}else{if(!q.model.isForAlternateSource&&!mstrApp.msgid){q.dataService.createEmmaInstance({success:function AC(AD){mstrApp.msgid=AD.msgid;}});}}}});};if(p.specifyDBTypes){p.dbObjects.populateDBProperties({success:function x(){w();}});}else{p.loadDBTypeFilters({success:function x(){w();}});}n=mstrApp.diFooterID;u=n?mstrmojo.all[n]:undefined;if(u){o=u.next;z=u.finish;p.attachEventListener("refreshTables",o.id,u.enableButton);p.attachEventListener("refreshTables",z.id,u.enableButton);}},getCurrentZIndex:function W(){return mstrApp.diCurrentZIndex;},getDataService:function M(){return this.dataService;},toggleDatabaseView:function g(n){this.rootView.toggleDatabaseView(n);},openHelp:function Q(){var n=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/MicroStrategy_Web_Help.htm#"+(mstrApp.isFFSQL?"freeform_import_page.htm":"database_import_page.htm");window.open(n);},addTable:function a(n){this.model.addTable(n);},addTables:function d(n){this.model.addTable(n);},removeTable:function T(n){this.model.removeTable(n);},removeDBRoleTables:function k(n){if(mstrApp.type===j.EmmaSingleTable){this.model.removeDBRoleTables(n);}},cancel:function F(){if(!mstrApp.isFromDI){var n=mstrApp.origin?"-2":"-1";mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:n},mstrApp.name,"POST",null,null,false);}},commitChanges:function Z(){this.model.commitChanges({success:function n(o){var p=o.msgid;mstrmojo.form.send({evt:"3172",messageID:p,launchingApp:"QB"},mstrApp.name,"POST",null,null,false);}});},onNextButtonClick:function K(){this.model.commitChanges({success:function n(q){var o=mstrApp.getRootController().model,t=o.isDDA,p=o.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=q.msgid;mstrApp.isDDA=t;mstrApp.isManagedCube=p;mstrApp.getRootController().afterQBProcess();}});},saveDDACube:function m(o){var p=this.model,q={},t;t={success:function(AC){var u=mstrApp.msgid,x=p.isDDA,z,AD,AA,AB,w,AE=p.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=u;mstrApp.isDDA=x;mstrApp.isManagedCube=AE;z=mstrApp.getRootController();AD=z.model;z.getDDAController().setDirectDataAccess(mstrApp.isDDA);z.dataService.set("messageID",mstrApp.messageID);AD.isManagedCube=mstrApp.isManagedCube;AD.cubeName=X(p).name;if(mstrApp.isSingleTier){AA={isDirectDataAccess:AD.isDirectDataAccess,name:AD.cubeName};AB={success:function(AF){if(AF.objectId){AD.cubeID=AF.objectId;}z.wrapUpDataImport();},failure:function(AF){mstrApp.hideProgress();z.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,AF&&AF.message);}};w={success:function(){z.dataService.createOneTierDoc(AB,AA);},failure:function(AF){mstrApp.hideProgress();z.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,AF&&AF.message);}};if(AD.operationMode===O.operationMode.edit||AD.operationMode===O.operationMode.refresh){z.dataService.duplicateReportInstance(w,{messageID:AD.analysisID,datasetID:AD.cubeID,duplicateRIMsgID:z.dataService.messageID});}else{z.dataService.createOneTierDoc(AB,AA);}return ;}if(AE){z.wrapUpDataImport();return ;}AD=z.model;if(AC&&AC.objectId){AD.cubeID=AC.objectId;}AD.path=o&&o.objPath;z.wrapUpDataImport();}};function n(){if(p.isManagedCube){t.success();return ;}q.displayMode=12;q.shouldRefresh=false;if(p.isDDA){q.shouldRefresh=false;q.saveAsFlags=O.saveAsFlags.saveAsDDA|O.saveAsFlags.saveAsOverWrite;}else{q.saveAsFlags=O.saveAsFlags.saveAsInMemory|O.saveAsFlags.saveAsOverWrite;}q.taskId="saveAndPublishCube";q.showWait=true;q=U.copy(o,q);q.saveAsOverwrite=true;delete q.objPath;mstrApp.getRootController().model.submitRequest(t,q);}mstrApp.getRootController().model.submitRequest({success:function(){if(p.operationMode!==2){mstrApp.getRootController().model.submitRequest({success:function(){n();}},{taskId:"DIClearRelationshipEMMASourceTable",showWait:true});}else{n();}}},{taskId:"DIToggleDatasetServeMode",serveMode:p.isDDA?O.datasetServeMode.dda:O.datasetServeMode.inMemory,showWait:true});},handleFinish:function N(){var n=this.model,p=this,o=n.operationMode,q={};q.onOK=function(u){n.commitChanges({success:function t(z){var w=z.msgid,AA=n.isDDA,x=n.isManagedCube;if(AA&&o!==1){p.saveDDACube(u);}else{mstrApp.container.unloadQB();mstrApp.messageID=w;mstrApp.isDDA=AA;mstrApp.saveCubeParams=u;mstrApp.isManagedCube=x;mstrApp.getRootController().afterQBProcess(true);}}});};if(o===1){q.onOK();}else{if(!n.isManagedCube&&!mstrApp.isSingleTier){e.showSaveAsDialog(q,X(this.model));}else{q.onOK();}}},onFinishButtonClick:function l(){var o=this,n=this.model,q=o.getDDAController(),x,w,p,u=mstrApp.diCurrentZIndex,t=u?u+1:10;b.forEach(n.tables,function(z){if(z.extt||z.hanai){w=true;n.isDDA=true;}});if(!n.origIsDDA&&q.allowDDA()&&!w){x={onOK:function(){o.handleFinish();}};p={callback:x,selectedIndex:n.isDDA?0:1,zIndex:t};q.showDDAConfirmDialog(p);return ;}this.handleFinish();},onBackButtonClick:function S(){mstrApp.container.unloadQB();mstrApp.getRootController().backFromQB();},onCancelButtonClick:function f(){this.exitApplication();},exitApplication:function D(){mstrApp.container.unloadQB();mstrApp.getRootController().onCancelButtonClick();},getTableErrorMsg:function(){return this.model.addTableErrorMsg;},selectAlternateSource:function Y(x,AA,q){var u=this,z=u.dataService,t=this.model,AB=t.tables,AC,p,n,o=null,w={zIndex:q+1000};if(AB.length===0){return ;}AC=AB[0];if(AA.failure){o=function(AD){AA.failure(AD);};}p={success:function(){var AD;mstrApp.hasEditEmmaIRRSource=true;AD={success:function(AG){var AH,AF,AI,AE;if(AG.vt===1){AF=mstrApp.msgid;AI=z.emmaIRRMessageID;mstrApp.container.unloadQB();AH=mstrApp.getRootController().dataService;mstrApp.messageID=AF;if(AF){AH.set("messageID",AF);}if(AI){AH.set("emmaIRRMessageID",AI);}if(AA.success){AA.success({tableName:AC.n});}}else{AE=C(AG.cols);I(AE,q);}},failure:o};z.validateEmmaIRRAlternateSource(AD,{tbid:x,alertCfg:w});},failure:o};n={sourceType:h,tables:x,deleteTables:"0",dbRoleID:AC.dbr,dbTableName:AC.n,alertCfg:w};if(AC.ns){n.dbNamespace=AC.ns;}z.editEmmaIRRSourceTable(p,n);},getDDAController:function J(){if(this.ddaController===null){this.ddaController={shouldAskUser:true,allowDDA:function t(){var AA=mstrApp.getRootController().model,z=null,AC=!!AA.canSupportDDA,x,AB=AA.tables;if(!AC){return false;}if(AB.length>0){z=AB[0].dbr;}x=AA.dbridForDDA;if(x&&z!==null&&x!==z){AC=false;}if(!AC){return false;}b.forEach(AB,function(AD){if(AD.dbr!==z){AC=false;return false;}return true;});return AC;},onlyAllowDDA:function w(){return !!mstrApp.getRootController().model.shouldSupportDDA;},onToggleDDA:function n(AB){var z=mstrApp.getRootController().model,x=0,AA;if(z.isDDA===AB){return ;}if(AB){z.set("isDDA",true);if(!this.allowDDA()){x=1;AA=false;}}else{z.set("isDDA",false);if(this.onlyAllowDDA()){x=2;AA=true;}}if(x){mstrmojo.qb.alert(H[x]);z.set("isDDA",AA);}},checkDDACheckbox:function p(AA){var x=mstrApp.getRootController().model.ddaCheckboxID,z;if(x){z=mstrmojo.all[x];if(z){z.set("checked",AA);}}},tryEnableDDACheckbox:function q(AA){var x=mstrApp.getRootController().model.ddaCheckboxID,z;if(x){z=mstrmojo.all[x];}if(!z||!z.visible){return ;}if(!AA){if(z.enabled&&!z.checked&&!this.allowDDA()){z.set("enabled",false);}}else{if(!z.enabled&&!z.checked&&this.allowDDA()){z.set("enabled",true);}}},askUserAboutDDA:function u(x){if(x){this.shouldAskUser=false;}return this.shouldAskUser;},showDDAConfirmDialog:function o(x){var z=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog(x||{});z.open();}};}return this.ddaController;},onHelpButtonClick:function A(){mstrApp.showHelpTopic(this.model.getHelpTopic());},selectDBRole:function B(p){var o,n;if(!p){return ;}o=this.rootView.getDBConnectionList();n=b.find(o.items,"did",p);if(n>=0){o.set("selectedIndex",n);o.adjustScrollPosition(n);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.mdx.DataService","mstrmojo.warehouse.WHController","mstrmojo.qb.QBHelpers");var O=mstrmojo.hash,I=mstrmojo.qb.QBHelpers,S=mstrmojo.DI.DIConstants;function B(X){var Y=mstrApp.diShowFooterFunction;if(Y){Y({finish:{visible:X}});}}function H(a){var Z=a.SelDBRoleID;var c=a.dbrs;var b;var Y;var X;for(b=0;b<c.length;b++){if(Z===c[b].did){Y=c[b].n;break;}}X=a.cubes[0].n;return{name:X,desc:Y};}mstrmojo.qb.mdx.Controller=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{start:function G(){var b=this.rootView,X=this.model,Y,d,a,Z;this.dataService=mstrmojo.qb.mdx.DataService;b.render();this.toggleDatabaseView(true);X.loadDBTypeFilters({success:function c(){X.loadDBRoles({success:function e(){B(true);X.initialize();}});}});Y=mstrApp.diFooterID;d=Y?mstrmojo.all[Y]:undefined;if(d){a=d.next;Z=d.finish;X.attachEventListener("refreshTables",a.id,d.enableButton);X.attachEventListener("refreshTables",Z.id,d.enableButton);setTimeout(function(){d.mdxRA.update();},0);}},getDataService:function J(){return this.dataService;},toggleDatabaseView:function W(X){this.rootView.toggleDatabaseView(X);},addCubes:function N(X){this.model.addCubes(X);},addTables:function K(X){this.model.addCubes(X);},removeCube:function P(X){this.model.removeCube(X);},updateCube:function U(X){this.model.updateCube(X);},handleDBTableRefresh:function R(){var Y=this.model,X=Y.SelDBRoleID;Y.catalogRefresh=true;Y.onSelNameSpaceIDChange({value:Y.SelNameSpaceID});},attachDataChangeListeners:function M(Y){var X=this.model;O.forEach(Y,function(Z,a){O.forEach(Z,function(c,b){X.attachEventListener(b,a,c);});});},detachDataChangeListeners:function E(Y){var X=this.model;mstrmojo.array.forEach(Y,function(Z){X.detachEventListener(Z);});},onCancelButtonClick:function F(){mstrApp.container.unloadQB();mstrApp.getRootController().onCancelButtonClick();},onFinishButtonClick:function T(){var X=this.model,Y={};Y.onOK=function(a){if(a){X.folderID=a.folderID;X.cubeDesc=a.objDesc;X.cubeName=a.objName;}X.commitChanges({success:function Z(e){var c=mstrApp.msgid,d=X.isManagedCube,j,b;mstrApp.container.unloadQB();mstrApp.messageID=c;mstrApp.isDDA=true;mstrApp.saveCubeParams=a;mstrApp.isManagedCube=d;j=mstrApp.getRootController();if(X.isNew){j.getDDAController().setDirectDataAccess(mstrApp.isDDA);j.dataService.set("messageID",mstrApp.messageID);j.model.isManagedCube=mstrApp.isManagedCube;b=j.model;b.cubeName=H(X).name;if(mstrApp.isSingleTier){var g={isDirectDataAccess:b.isDirectDataAccess},h={success:function(k){if(k.objectId){b.cubeID=k.objectId;}j.wrapUpDataImport();},failure:function(k){mstrApp.hideProgress();j.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,k&&k.message);}},f={success:function(){j.dataService.createOneTierDoc(h,g);},failure:function(k){mstrApp.hideProgress();j.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,k&&k.message);}};if(b.operationMode===S.operationMode.edit||b.operationMode===S.operationMode.refresh){j.dataService.duplicateReportInstance(f,{messageID:b.analysisID,datasetID:b.cubeID,duplicateRIMsgID:j.dataService.messageID});}else{j.dataService.createOneTierDoc(h,g);}return ;}if(d){j.wrapUpDataImport();return ;}b=j.model;if(e&&e.objectId){b.cubeID=e.objectId;}b.path=a&&a.objPath;j.wrapUpDataImport();}else{j.wrapUpDataImport();return ;}}});};if(!X.isManagedCube&&X.isNew&&!mstrApp.isSingleTier){I.showSaveAsDialog(Y,H(this.model));}else{Y.onOK();}},onBackButtonClick:function A(){mstrApp.container.unloadQB();mstrApp.getRootController().backFromQB();},exitApplication:function D(){mstrApp.container.unloadQB();mstrApp.getRootController().exitApplication();},onHelpButtonClick:function Q(){mstrApp.showHelpTopic("importing_data_from_an_OLAP_source.htm");},getProjectPrimaryDBRoleID:function V(){return this.model.SelDBRoleID;},setRecursive:function L(X){this.model.set("recursive",X);},getRecursive:function C(){return this.model.recursive;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.Label","mstrmojo.warehouse.DBRoleSelector","mstrmojo.warehouse.WHPanel","mstrmojo.warehouse.ui.AvailableTablesPanel");var B=mstrmojo.dom,C=mstrmojo.css,I=mstrmojo.warehouse.EnumDataChangeEvents;function A(O){var N="mstr-qb-oAuthSourcelogout",K=document.getElementById(N),J=mstrApp.getRootController().model,L=J.tableID,M=mstrApp.getRootController().getDataService();if(!K){K=document.createElement("IFRAME");K.id=N;document.body.appendChild(K);K.style.display="none";B.attachEvent(K,"load",function(Q){var R={};var P=function P(){M.signOutOAuthSource({success:function S(){mstrApp.getRootController().handleLogout();}},R);};R.dbRoleID=mstrApp.dbrid;if(mstrApp.said){R.sourceAccountID=mstrApp.said;}if(J.isNew&&L){M.removeEmmaTable({success:P},{did:L});}else{P();}});}K.src=O;}mstrmojo.qb.bigquery.BigQuerySignOut=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.bigquery.BigQuerySignOut",cssClass:"mstrmojo-qb-bigquery-signout",bindings:{visible:function(){var K=mstrmojo.qb.EnumQBAppType,J=mstrApp.type;return J===K.BigQuery||J===K.BigQueryFFSQL||J===K.BigQuerySingleTable;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"username",postCreate:function F(){if(this._super){this._super();}this.set("text",mstrApp.userEmail||"");}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12735,"Sign Off..."),cssClass:"signout",onclick:function H(){A("https://www.google.com/accounts/logout");}}]});mstrmojo.qb.bigquery.DBRoleSelector=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.bigquery.DBRoleSelector",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{bqSignOutNode:function(){return this.domNode.children[0];},dbSelectorNode:function(){return this.domNode.children[1];}},slot:"firstSplitNode",alias:"topPanel",children:[{scriptClass:"mstrmojo.qb.bigquery.BigQuerySignOut",alias:"bqSignOut",slot:"bqSignOutNode"},{scriptClass:"mstrmojo.warehouse.DBRoleSelector",alias:"dbSelector",slot:"dbSelectorNode"}],init:function G(J){if(this._super){this._super(J);}var K=this.dbSelector.dbConnections;K.onclick=function(M){try{var P=M.target||B.eventTarget(M.hWin,M.e),O=B.findAncestorByAttr(P,"idx",true,this.domNode),L=O&&parseInt(O.value,10);if(P.className==="item-mn"&&L!==null&&!isNaN(L)){return false;}if(L!==null){mstrmojo.warehouse.ui.DBConnectionsList.prototype.onclick.call(K,M);}}catch(N){throw N;}};},setDimensions:function D(N,K){var J=parseInt(N,10);var M=parseInt(K,10),L;if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}L=this.layoutConfig;if(this.bqSignOut.visible){L.h.bqSignOutNode="38px";L.h.dbSelectorNode=(J-38)+"px";}else{L.h.dbSelectorNode=J+"px";}L.w.bqSignOutNode=M+"px";L.w.dbSelectorNode=M+"px";if(this._super){this._super(J+"px",K);}}});mstrmojo.qb.bigquery.BigQueryWHPanel=mstrmojo.declare(mstrmojo.warehouse.WHPanel,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.bigquery.BigQueryWHPanel",cssClass:"mstrmojo-qb-whpanel",children:[{scriptClass:"mstrmojo.qb.bigquery.DBRoleSelector",slot:"firstSplitNode",alias:"topPanel"},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",slot:"secondSplitNode",alias:"bottomPanel"}],init:function G(K){if(this._super){this._super(K);}var L={},J,M;J=L[this.id]={};M=this.bottomPanel;J[I.DBROLE_SELECTION]=function(N){if(M.refreshBtn){C.toggleClass(M.refreshBtn.domNode,"hidden",false);}};mstrApp.getRootController().attachDataChangeListeners(L);},preBuildRendering:function E(){if(this._super){this._super();}var J,K;J=this.topPanel.dbSelector;K=this.bottomPanel;J.title=mstrmojo.desc(37,"Projects");J.cssClass="bigquery-projects";K.title=mstrmojo.desc(12569,"Available Datasets");K.cssClass="AvailableTables bigquery-datasets";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.warehouse.WHPanel","mstrmojo.qb.mdx.CubeDropbox","mstrmojo.hash");mstrmojo.requiresDescs(531,12932,12923,12941);var B=mstrmojo.hash;var D="firstSplitNode",J="secondSplitNode";var C=1;mstrmojo.qb.mdx.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.mdx.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},viewMode:C,init:function K(P){this._super(P);var R={};R[this.id]={maxCubeError:this.onErrorDisplay};R[this.id].windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(R);var L=this.main.whPanel;L.topPanel.title=mstrmojo.desc(12923,"MDX Connections");L.bottomPanel.title=mstrmojo.desc(12941,"Browse Catalog");L.bottomPanel.dbTableTree.getDragAction=function Q(V){var W=this.getNodeAttributes(V.src.node),U=W&&this.getTreeItem(W.index);if(U&&U.cubetp){return"addCube";}};this.getBrowserDimensions=function T(){return{w:"1010px",h:"552px"};};var O=L.bottomPanel;O.searchBox.widthOffset=21;var M=this.getDBRoleSelector();M.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");O.getLayoutOffsets=function(){return{h:32,w:0};};M.getLayoutOffsets=function(){return{h:32,w:0};};O.heightOffset=59;var S=O.dbTableTree,N=B.clone(S.tablesTreeHooks);N.isTable=function(U){return U&&U.cubetp;};S.tablesTreeHooks=N;},getDBRoleSelector:function H(){return this.main.children[0].topPanel;},preBuildRendering:function I(){var L=true;if(this._super){L=this._super();}if(this.viewMode===C){if(this._listenerProc){mstrmojo.dom.detachEvent(window,"resize",this._listenerProc);this._listenerProc=null;}}return L;},onErrorDisplay:function E(L){var M="";if(L.name==="maxCubeError"){M=mstrmojo.desc(12932,"A dataset can have only a single OLAP cube. Please create another dataset to import the second OLAP cube.");}mstrmojo.qb.alert(M,null,null,null,this.alertCfg);},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"50%",min:"350px",max:undefined},secondSplit:{v:"50%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function G(){return{h:0,w:36};},slot:"layout",alias:"main",toggleDatabaseView:function F(L){this.toggleFirstItemVisibility(L);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"mstrmojo-qb-es-whpanel mdx-panel",alias:"whPanel",slot:D,orientation:mstrmojo.ui.Splitter.ENUM_OR.HORIZONTAL,config:{firstSplit:{v:"50%",min:"200px"},secondSplit:{v:"50%",min:"200px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.qb.mdx.CubeDropbox",slot:J}]}],toggleDatabaseView:function F(L){this.main.toggleDatabaseView(L);},adjustSize:function(M){var N=M.size,P=mstrApp.isCloudPro,R=P?40:0,Q=P?180:104;var O=parseInt(N.w,10)-R+"px",L=parseInt(N.h,10)-Q+"px";if(this.height&&L!==this.height){this.set("height",L);}else{this.height=L;}if(this.width&&O!==this.width){this.set("width",O);}else{this.width=O;}return true;},postBuildRendering:function A(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.qb.es.TableDropbox","mstrmojo.warehouse.WHPanel");mstrmojo.requiresDescs(531,12384,14083);var D=mstrmojo.desc,C=mstrmojo.dom,R=mstrmojo.array;var S="firstSplitNode",P="secondSplitNode";var W=0,I=1;var N="idx",A="li";var M=D(12384,"LIVE Data Connection does NOT support connection to multiple Database Instances currently. Please uncheck LIVE Data Connection to add table(s) from this Database Instance.");var L=D(14083,"The following table(s) cannot be added since they are not Information Views: ###");function J(a){var Y=document.createElement("div"),g=C.findAncestorByAttr(a,N,true,this.domNode),e='<div class="item-ic"></div><div class="item-n" title="" style="max-width: 340px">{@n}</div><div class="item-del"></div>',b,f,X;function c(h){b=document.createElement("div");b.className="item cf";b.innerHTML=e.replace("{@n}",h).replace("\n","");return b;}if(g&&g.node){var Z=this.userSelections;if(Z[g.value]){var d=this.domNode.getElementsByTagName(A);R.forEach(d,function(h){X=h.getAttribute(N);if(Z[X]===true){f=this.items[X].n;b=c(f);Y.appendChild(b);}},this);}else{f=this.items[parseInt(g.value)].n;b=c(f);Y.appendChild(b);}Y.appendChild(document.createElement("div"));}Y.className="mstrmojo-qb-emma-tablelist";return Y;}function F(a,X){var Z=this.avatar.style,Y=this.restrictedToAxis;if(Y!=="y"){Z.left=a.x+1+"px";}if(Y!=="x"){Z.top=a.y+1+"px";}}mstrmojo.qb.es.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.es.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},onError:mstrmojo.emptyFn,init:function O(a){this._super(a);var b={},Z={},Y;b[this.id]=Z;Z.directDataAccessTableError=this.onTableAdded;Z.maxTableError=this.onTableAdded;Z.SapHanaIncompatibleTypeError=this.onTableAdded;Z.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(b);var c=this.getDBRoleSelector();var X=this.main.children[0].bottomPanel;X.getLayoutOffsets=function(){return{h:32,w:0};};c.getLayoutOffsets=function(){return{h:32,w:0};};X.searchBox.widthOffset=21;X.nameSpaces.heightOffset=35;c.heightOffset=31;X.heightOffset=31;c.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");Y=X.dbTableTree;Y.createAvatarFunc=J;Y.positionAvatarFunc=F;Y.showTablesNum=false;},getDBRoleSelector:function G(){return this.main.children[0].topPanel;},getDBConnectionList:function H(){return this.getDBRoleSelector().dbConnections;},preBuildRendering:function B(){if(this._super){this._super();}if(this.viewMode===I){if(this._listenerProc){mstrmojo.dom.detachEvent(window,"resize",this._listenerProc);this._listenerProc=null;}}},onTableAdded:function K(X){var Y="",Z=[];switch(X.name){case"maxTableError":Y=mstrApp.getRootController().getTableErrorMsg();break;case"directDataAccessTableError":Y=M;break;case"SapHanaIncompatibleTypeError":R.forEach(X.data,function(a){Z.push(a.n);});Y=L.replace("###",Z.join(", "));break;}mstrmojo.qb.alert(Y,null,null,null,this.alertCfg);},renderPageLoadError:function E(){var Z=this.error,Y=Z.message,a=Z.title,X=Z.btns;this.onError(Z);if(!X||!X.length){mstrmojo.alert(Y,null,a);}else{mstrmojo.confirm(Y,null,{buttons:X,title:a});}},render:function V(){if(this.error){this.renderPageLoadError();}else{this._super();}},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"50%",min:"350px",max:undefined},secondSplit:{v:"50%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function T(){return{h:0,w:36};},slot:"layout",alias:"main",toggleDatabaseView:function U(X){this.toggleFirstItemVisibility(X);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"mstrmojo-qb-es-whpanel",slot:S,orientation:mstrmojo.ui.Splitter.ENUM_OR.HORIZONTAL,config:{firstSplit:{v:"50%",min:"200px"},secondSplit:{v:"50%",min:"200px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.qb.es.TableDropbox",slot:P}]}],toggleDatabaseView:function U(X){this.main.toggleDatabaseView(X);},adjustSize:function(Y){var Z=Y.size,b=mstrApp.isCloudPro,d=b?40:0,c=b?180:104;var a=parseInt(Z.w,10)-d+"px",X=parseInt(Z.h,10)-c+"px";if(this.height&&X!==this.height){this.set("height",X);}else{this.height=X;}if(this.width&&a!==this.width){this.set("width",a);}else{this.width=a;}return true;},postBuildRendering:function Q(){if(this._super){this._super();}if(mstrApp.size){this.adjustSize({size:mstrApp.size});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DISearchBoxPage","mstrmojo.DI.DIDateTextBox2","mstrmojo.DI.DIFacebookAdvancedEditor");mstrmojo.requiresDescs(221,1442,3653,12689,12690,14124);var M=mstrmojo.array,U=mstrmojo.DI.DIConstants,J=mstrmojo.DI.DIConstants.sourceType;function E(){var W=this.searchPanel.blockNode.clientWidth;if(W>90){this.searchPanel.searchFieldNode.style.width=(W-90)+"px";}}mstrmojo.DI.DIFacebookPage=mstrmojo.declare(mstrmojo.DI.DISearchBoxPage,null,{scriptClass:"mstrmojo.DI.DIFacebookPage",advancedProperties:null,groupID:"",searchBoxHint:mstrmojo.desc(12689,"Search for Pages"),signOutTooltipText:mstrmojo.desc(14124,"Please logout of Facebook in the popup window."),handleNoDataReturned:function L(){this.toggleDataPreview(false);},init:function R(X){var Y,W;this._super(X);Y={};W=Y[this.id]={};W[U.dataEvents.NO_DATA_RETURNED_EVENT]=this.handleNoDataReturned;W.oAuthReportsFetched=this.populate;W.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(Y);this.searchPanel.signOutTooltipText=this.signOutTooltipText;},adjustSize:function F(W){var X=W.size,Y=Math.ceil(parseInt(X.w,10)),Z=this.previewPanel.content;if(!Z){return ;}if(Y>=760&&Y<=950){if(Z.cols!==2){Z.cols=2;Z.refresh();}}else{if(Z.cols!==3){Z.cols=3;Z.refresh();}}E.call(this);},refreshConfig:function C(){this.config={firstSplit:{v:"60px",min:"60px",max:undefined},secondSplit:{v:"100%",min:"150px",max:undefined},resizeHandle:{v:"2px"}};},generateGUID:function V(){function W(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}return(W()+W()+"-"+W()+"-"+W()+"-"+W()+"-"+W()+W()+W());},populate:function H(W){var X;if(this._super){this._super(W);}if(W&&W.targetPageId){if(W.targetPageId!==this.id){return ;}}X=mstrApp.getRootController().model.externalSources[J.facebook].reports;if(!X.mi.ca){mstrApp.getRootController().raiseModelEvent({name:U.dataEvents.NO_DATA_RETURNED_EVENT});return ;}this.toggleDataPreview(true);this.previewPanel.populate(W);E.call(this);},preBuildRendering:function D(){if(this._super){this._super();}this.set("headerLabelText",mstrmojo.desc(12689,"Search for Pages"));this.set("placeHolderText",mstrmojo.desc(12689,"Search for Pages"));this.set("showOperators",false);this.set("showAdvancedOptions",false);this.set("noDataErrorString",mstrmojo.desc(12690,"No Pages found, please try another search string."));this.set("iconCssClass","facebookIcon");this.previewPanel.previewType="table";},postBuildRendering:function T(){var W=mstrApp.getRootController();if(this.tableID!==undefined&&this.tableID!==""){if(this.advProps!==undefined){this.advancedProperties=this.advProps;}}W.sourceSelected(false);if(this._super){this._super();}},onSearchClick:function K(Y){if(Y===undefined||Y===""){return ;}if(this._super){this._super(Y);}var W=mstrApp.getRootController(),X="searchedPage?q="+encodeURIComponent(Y);W.oAuthSourceFetchFunction(J.facebook,{fbPageSearchQuery:X});},handleSearchChange:function G(W){if(this._super){this._super(W);}mstrApp.getRootController().enableFinishButton(false);},getSelectedPageInfo:function O(){return this.previewPanel.content.selectedItem;},getTimeFeed:function I(Y){var b=Y||"?since=-1%20days",X=this.getSelectedPageInfo().advancedProperties;if(X&&X.getProperties){var c=X.getProperties(),a=(!c.since||c.since==="MM/DD/YYYY")?"":encodeURIComponent(c.since),Z=(!c.until||c.until==="MM/DD/YYYY")?"":encodeURIComponent(c.until),W="";if(a){b="?since="+a;}else{b="";}if(Z){if(a){W="&";}else{W="?";}b+=W+"until="+Z;}}return b;},getTableQuery:function P(Y,X,d){var W=this.getSelectedPageInfo().pg_id,c=this.searchPanel.getSearchQuery(),b="",a=this.getSelectedPageInfo().advancedProperties;var Z={query:encodeURIComponent(c),groupID:Y,advProps:a};d=this.getTimeFeed(d);Z.timeFeed=d;switch(X){case"page":Z.name="page";b=W+"_Page###"+JSON.stringify(Z);break;case"posts":Z.name="posts";b=W+":feed_Posts"+d+"###"+JSON.stringify(Z);break;case"comments":Z.name="comments";b=W+":feed_Comments"+d+"###"+JSON.stringify(Z);break;case"likes":Z.name="likes";b=W+":feed_Likes"+d+"###"+JSON.stringify(Z);break;}return b;},getItems:function B(Z){var f=mstrApp.getRootController(),e=f.getModel(),a=this,g=[],X=this.getSelectedPageInfo().n,W=X.substr(0,10),c=this.generateGUID();if(Z===""){var h={query:a.getTableQuery(c,"page"),n:W+" Page"};g.push(h);var k={query:a.getTableQuery(c,"posts"),n:W+" Posts"};g.push(k);var b={query:a.getTableQuery(c,"comments"),n:W+" Comments"};g.push(b);var d={query:a.getTableQuery(c,"likes"),n:W+" Likes"};g.push(d);}else{var j=this.groupID,Y=[];g=[];M.forEach(e.getAllTableID(),function(l){var m=e.getImportSource(l),o=decodeURIComponent(m.sourceInfo.url.split("###")[1]),n=JSON.parse(o);if(n&&n.groupID===j){Y.push(m);}});if(Y.length>0){M.forEach(Y,function(n){var o=n.sourceInfo,t=decodeURIComponent(o.url.split("###")[1]),q=JSON.parse(t),l=q.name,p=q.timeFeed.replace(" ","%20"),m=n.tableID;switch(l){case"page":g.push({query:a.getTableQuery(j,"page",p),n:W+" Page",tableID:m});break;case"posts":g.push({query:a.getTableQuery(j,"posts",p),n:W+" Posts",tableID:m});break;case"comments":g.push({query:a.getTableQuery(j,"comments",p),n:W+" Comments",tableID:m});break;case"likes":g.push({query:a.getTableQuery(j,"likes",p),n:W+" Likes",tableID:m});break;}});}}return g;},performAction:function Q(Y){var W=mstrApp.getRootController(),X=this.getItems(this.tableID);if(this.tableID!==""){W.refreshMultiOAuthReports(this.sourceObjectsInfo.type,U.sourceSubtype.facebook,X,Y);}else{W.importMultiOAuthReports(this.sourceObjectsInfo.type,X,true,!W.model.hasEMMAReportInstance(),Y,U.sourceSubtype.facebook,this.id);}},onNextButtonClick:function(){this.performAction(this.tableID?U.actions.refreshData:U.actions.importSource);},onBackButtonClick:function A(){var W=mstrApp.getRootController();W.showPage(U.pageType.dataSelection);},onHelpButtonClick:function S(){return"importing_data_from_Facebook.htm";},onFinishButtonClick:function(){this.performAction(U.actions.savePublish);},onadvancedSearchClick:function N(){var W=this;var Y=mstrApp.getRootController().dialogController.getCurrentZIndex()+1;var X=new mstrmojo.Editor({cssClass:"mstrmojo-di-facebookAdvancedEditor",cssText:"background: white; width:460px;height: 380px;border: 10px solid rgba(0, 0, 0, 0.3); border-radius:5px; -moz-border-radius:5px;-webkit-border-radius:10px;",showTitle:true,title:"Filter Post Data by Date",zIndex:Y,onOpen:function(){var Z=this.curtainNode.style;Z.background="black";Z.opacity=0.5;Z.filter="alpha(opacity=50)";},children:[{scriptClass:"mstrmojo.DI.DIFacebookAdvancedEditor",alias:"editorContent",bindings:{advancedProperties:function(){return W.advancedProperties||{};}}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1442,"OK"),onclick:function(){var Z=this.parent.parent;if(Z.editorContent.onOk){Z.editorContent.onOk();W.advancedProperties=Z.editorContent.advancedProperties;}Z.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var Z=this.parent.parent;Z.close();if(Z.onCancel){Z.onCancel();}}}]});X.open();}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DISearchBoxPage");mstrmojo.requiresDescs(12809,12810);var I=mstrmojo.DI.DIConstants;mstrmojo.DI.DITwitterPage=mstrmojo.declare(mstrmojo.DI.DISearchBoxPage,null,{scriptClass:"mstrmojo.DI.DITwitterPage",cssClass:"mstrmojo-di-twitter",preBuildRendering:function F(){if(this._super){this._super();}this.set("headerLabelText",mstrmojo.desc(12809,"Search for Tweets"));this.set("placeHolderText",mstrmojo.desc(12809,"Search for Tweets"));this.set("showOperators",true);this.set("showAdvancedOptions",false);this.set("showFetchOptions",true);this.set("noDataErrorString",mstrmojo.desc(12810,"No Tweets found, please try another search string."));this.set("iconCssClass","twitterIcon");this.previewPanel.previewType="grid";},handleDataPreview:function M(N){this.searchPanel.previewTableId=N.data;this.toggleDataPreview(true);this.searchPanel.populate(N);this.previewPanel.populate(N);this.adjustSize();},handleNoDataReturned:function K(){this.toggleDataPreview(false);},init:function H(O){var P,N;this._super(O);P={};N=P[this.id]={};N[I.dataEvents.DATA_PREVIEW_EVENT]=this.handleDataPreview;N[I.dataEvents.NO_DATA_RETURNED_EVENT]=this.handleNoDataReturned;N.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(P);},adjustSize:function L(){var N=this.searchPanel.blockNode.clientWidth;if(N>90){this.searchPanel.searchFieldNode.style.width=(N-90)+"px";}},onSearchClick:function J(S){if(S===undefined||S===""){return ;}if(this._super){this._super(S);}var Q={query:S};var N=mstrApp.getRootController(),R="searchedTweets?q="+S+"###"+JSON.stringify(Q),P=(S.replace(/['"]/g,"")).substr(0,8)+" Twitter",O=[],T={query:R,n:P,max:this.searchPanel.getFetchValue().value};T.tableID=this.searchPanel.previewTableId;O.push(T);if(this.searchPanel.previewTableId!==""){N.refreshDataOAuthReport(this.sourceObjectsInfo.type,I.sourceSubtype.twitter,this.searchPanel.previewTableId,O[0],I.actions.quickPreview);}else{N.importMultiOAuthReports(this.sourceObjectsInfo.type,O,true,!N.model.hasEMMAReportInstance(),I.actions.quickPreview,I.sourceSubtype.twitter);}},toggleFooterButtons:function E(){if(this.searchText===undefined||this.searchText===""){mstrApp.getRootController().enableFinishButton(false);}else{mstrApp.getRootController().enableFinishButton(true);}},handleSearchChange:function B(N){if(this._super){this._super(N);}this.toggleFooterButtons();},getImportTable:function A(){var P=this.searchPanel.getSearchQuery();var R={query:P};var O=(P.replace(/['"]/g,"")).substr(0,8)+" Twitter",S="searchedTweets?q="+P+"###"+JSON.stringify(R),N=this.searchPanel.getFetchValue().value,Q=this.getTableId();return{query:S,tableID:Q,n:O,max:N};},performAction:function D(Q){this.searchTerm=this.searchPanel.getSearchQuery();var N=mstrApp.getRootController(),O=[],P=this.getTableId();O.push(this.getImportTable());if(O[0].tableID&&!this.tableID){N.dataService.removeEMMASourceTable(null,{did:O[0].tableID});O[0].tableID=null;}if(this.tableID!==""){if(this.searchPanel.previewTableId!==""){N.removeSourceTable(this.searchPanel.previewTableId);}N.refreshDataOAuthReport(this.sourceObjectsInfo.type,I.sourceSubtype.twitter,P,O[0],Q);}else{N.importMultiOAuthReports(this.sourceObjectsInfo.type,O,true,!N.model.hasEMMAReportInstance(),Q,I.sourceSubtype.twitter,this.id);}},onNextButtonClick:function(){this.performAction(this.tableID?I.actions.refreshData:I.actions.importSource);},onBackButtonClick:function G(){var N=mstrApp.getRootController(),O=[];O.push(this.getImportTable());if(O.length&&O[0].tableID&&!this.tableID){N.dataService.removeEMMASourceTable(null,{did:O[0].tableID});N.getModel().resetImportSource(O[0].tableID);O[0].tableID=null;}N.showPage(I.pageType.dataSelection);},onHelpButtonClick:function C(){return"Importing_data_from_Twitter.htm";},onFinishButtonClick:function(){this.performAction(I.actions.savePublish);},onCancelButtonClick:function(){var N=mstrApp.getRootController();if(this.searchPanel.previewTableId!==""){if(N.dialogController!==undefined&&N.dialogController.pageZIndex>0){N.removeSourceTable(this.searchPanel.previewTableId);}}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.DataGrid","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.ObjectInputBox","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME._HasLevel","mstrmojo.ME._HasSortBy","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(629,2148,3377,9582,12173,12179,12852);var J=mstrmojo.hash,l=mstrmojo.array,M=mstrmojo.expr,h=mstrmojo.ME._MetricEditorHelper,A=mstrmojo.ME.MetricDataService,c=mstrmojo.mstr.EnumDSSXMLObjectTypes,o=mstrmojo.ME.Enum.DYNAMIC_DIMTY,O=mstrmojo.ME.Enum.UI_OBJECT_TYPE;var U,X;var e=function(E){if(E.onmetricModify){E.onmetricModify();}},b=function(){if(X.updateScrollbars){X.updateScrollbars();}};var Y=mstrmojo.ME.MetricToken.brackets,L=mstrmojo.ME.MetricToken.quotes,Z=mstrmojo.ME.MetricToken.unquotes;var d=function(){var E={"9C374236DD9F11D3B98100C04F2233EA":"Forecast","9C374233DD9F11D3B98100C04F2233EA":"Growth","9C374233DD9F11D3B98100C04F2233EA":"Trend","677E93B2786B11D4B82F00C04F356781":"Case",C41C34F0786B11D4B82F00C04F356781:"CaseV",B2C0FA4420C711D6AD1400C04F0423DE:"IF","8107C324DD9911D3B98100C04F2233EA":"Not"};return E.hasOwnProperty(this.fctOi.did);};var g=function(u){var t=u.split(",")[0],q=t.replace(/\d$/,""),E=t.replace(q,"");return{prefix:q,startAt:parseInt(E,10)};};var G=function(AB){var AA=function(){if(AB.isRepeated){var w=this.parent.dataGrid.ctxtBuilder.itemWidgets[this.parent.idx].labelWidget;if(w){w.set("count",this.getSelectedObjects().length);}}};var q=X.getParamObjectTypes();var E={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"paramInput",slot:"0,0",cssClass:"mstrmojo-ME-param",dtp:AB.dtp,isDME:X.isDME,hideEditButton:function(w){return true;},hideDelButton:function(w){return this.isFull;},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},browsableTypes:q.concat([M.TP.FOLDER]).join(","),folderLinksContextId:17,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),getCandidatesThroughTaskCall:function z(AC,w){AC.objectType=q.join(",");AC.rootFolderType=39;AC.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AC,w);},postCreate:function(AF){var AE=this.parent.dataGrid,AH=AE&&AE.parent;this.noCache=AH.noCache;if(!this.noCache){this.candidates=AH.getCandidates(function(AI){return mstrmojo.array.indexOf(q,AI.t)>-1;});var w=this.candidates.items||[];if(X.isDME){w=X.replaceAttributeWithForms(l.filter(w,function(AI){return l.indexOf(q,AI.t)>-1&&AI.st!==M.STP.NDE;}));}for(var AD=0,AC=(AB.items||[]).length;AD<AC;AD++){var AG=AB.items[AD];if(AG&&AG.t===mstrmojo.ME.Enum.UI_OBJECT_TYPE.Sub_Expression){w.push(AG);}}this.candidates.items=w;if(!AF){AE.candidatesListener.push(this.id);}}if(!AF){this.set("items",AB.items);}},onitemchange:function(){e(this.parent.dataGrid.parent);},onadd:function t(){AA.call(this);},onremove:function x(){AA.call(this);},obCfg:{folderLinksContextId:17,browsableTypes:q.concat([M.TP.FOLDER]).join(",")}}],getTokens:function(){var AE=this.paramInput.getSelectedObjects(),AF,w=AE.length,AD,AG=[],AC;if(w>0){for(AD=0;AD<w;AD++){AF=AE[AD];if(AF.state===mstrmojo.Enum_OIB_States.VALID&&AF.did){if(AF.t===O.Sub_Expression){AG=AG.concat(AF.tks);}else{AC={v:Y(AF.n)};if(AF.t===21){AC.oi=AF.oi;AC.exv=AF.fmdid||AF.exv;AC.extp=8;AC.v=AF.fnm?Y(AF.oi.n)+"@"+Y(AF.fnm):AC.v;}else{AC.oi=AF;}AG.push(AC);}}else{AC={v:L(AB.dtp,AF.n)};AG.push(AC);}AG.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}AG.pop();}return AG;}};var u=E.children&&E.children[0];if(!AB.isRepeated){u.cssClass="mstrmojo-ME-ObjectInputBox-param singleObject noVerify";u.maxObjectCount=1;}else{u.cssClass="mstrmojo-ME-ObjectInputBox-param noVerify";}return E;};var C=function(t){var q=mstrmojo.all[U];var E=null;if(t.isParam){E=q.getParamWidget(t);}else{switch(t&&t.dtp){case 11:E={scriptClass:"mstrmojo.Pulldown",cssClass:"bool mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"False",did:"0"},{n:"True",did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(u){var w=this.data;this.value=!!w.v?(w.v==="False"?0:-1):(w.dfv||0);},getTokens:function(){var u=this.data;if(this.value!==u.dfv){return[{v:u.n},{v:"=",isDelimiter:true},{v:this.value=="-1"?"True":"False"}];}return[];},onvalueChange:function(){e(this.parent.dataGrid.parent);}};break;case -2:E=q.getBreakByWidget(t);break;case -1:E=q.getSortByWidget(t);break;default:E=q.getTextWidget(t);break;}}E.alias="inputWidget";return E;};var W=function(u,E,q){var t={scriptClass:"mstrmojo.ui.List",alias:"labelWidget",cssClass:"mstrmojo-FunctionWidzard-labels",count:u.items&&u.items.length||0,buildItems:function(){var w=[],z=this.count,AB=(u.isParam?"*":"")+":",AA=u.np;if(AA){for(var x=0;x<=z;x++){w.push({n:AA.n+(AA.startAt+x)+AB,title:u.desc||""});}}else{w.push({n:(u.dn||u.n)+AB,title:u.desc||""});}this.set("items",w);},postCreate:function(){this.buildItems();},oncountChange:function(){this.buildItems();}};return t;};var P=function(w){var q=mstrmojo.all[U];return{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"breakByInput",cssClass:"mstrmojo-ME-breakby",isDME:q.isDME,dtp:w.dtp,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),folderLinksContextId:16,browsableTypes:[M.TP.FOLDER,M.TP.ATTR].join(","),getCandidatesThroughTaskCall:function u(z,x){z.rootFolderType=39;z.blockCount=z.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(z,x);},obCfg:{folderLinksContextId:16,browsableTypes:[M.TP.ATTR,M.TP.FOLDER].join(",")},postCreate:function(AA){var x=this.parent.dataGrid,AB=x&&x.parent;this.noCache=AB.noCache;if(!this.noCache){this.candidates=AB.getCandidates(function(AE){return AE.t===c.Attribute||AE.t===c.Consolidation;});if(this.isDME){this.candidates.items=o.getItems("breakby").concat(this.candidates.items);}if(!AA){x.candidatesListener.push(this.id);}}if(!AA){var z=w.items||[],AC=q.oi.tks,AD=!AC.met||AC.items&&(AC.items.length===0);if(AD&&this.isDME){z.push(o.getAutomaticDimtyObject());}this.set("items",z);}},onitemchange:function(){e(this.parent.dataGrid.parent);},onadd:function E(){b();},onremove:function t(){b();},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},getTokens:function(){var AB=this.getSelectedObjects(),x=AB.length,AA,AD=[];if(x>0){AD.push({v:"BreakBy"});AD.push({v:"=",isDelimiter:true});AD.push({v:"{",isDelimiter:true});for(AA=0;AA<x;AA++){var AC=AB[AA],z;if(h.isDimty(AC.n)){z={v:AC.n};}else{if(/^@/.test(AC.did)){z={v:AC.did};}else{z={v:Y(AC.n),oi:AC};}}AD.push(z);if(AA!==(x-1)){AD.push({v:",",isDelimiter:true});}}AD.push({v:"}",isDelimiter:true});}return AD;}};};var F=function(u,w){var q=u.length,E;for(E=0;E<q;E++){var t=mstrmojo.array.find(u[E].fns,"n",w);if(t>-1){return J.clone(u[E].fns[t]);}}return null;};var S=function(t,u){var q,E=u.length,w=t&&t.length;if(w>0){for(q=0;q<w-1;q++){t[q].items=[u[q]];t[q].dynamicVerify=true;}t[w-1].items=[];for(q=w-1;q<E;q++){t[w-1].items.push(u[q]);t[w-1].dynamicVerify=true;}}return t;};var N=function(q,t,x){var w={items:[]},u={301:"}",302:")"}[x],E=t[++q];while(E){if(E.oi){if(x==302){E.oi.selFrm=E.exv;E.oi.asc=E.asc;}w.items.push(E.oi);}if((E=t[++q]).v===u){break;}}return w;};mstrmojo.ME.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ME._MetricEditorHelper,mstrmojo.ME._HasLevel,mstrmojo.ME._HasSortBy],{scriptClass:"mstrmojo.ME.FunctionWizard",cssClass:"mstrmojo-Editor-me mstrmojo-FunctionWidzard",title:mstrmojo.desc(9582,"Function Editor: "),help:"Function_Arguments_dialog_box.htm",fctOi:null,fctArgs:null,fctArgsDataGridCssClass:"functionArgs",fctSyntax:"",fctDesc:"",hiddenPs:[],bindings:{candidates:"this.opener.candidates"},getParamObjectTypes:function f(){var E=[M.TP.METRIC,M.TP.FACT];if(this.isAgg(this.fctOi)){E.push(M.TP.ATTR);}return E;},getCandidates:function R(t){var q=this.candidates,E;if(q){E=mstrmojo.array.filter(q.items,t);return{items:E,isComplete:q.isComplete};}return{};},_set_candidates:function(x,q){this.candidates=q;if(this.hasRendered&&this.visible){var u=this.argsGrid,w=u.candidatesListener,E=w.length,t;for(t=0;t<E;t++){if(mstrmojo.all[w[t]]){mstrmojo.all[w[t]].postCreate(true);}}}if(this._super){this._super(x,q);}return true;},postProcessParamsFromToken:function(u){if(this.refOi&&this.candidates){var w=this.refOi.did;this.refOi=mstrmojo.array.filterOne(this.candidates.items,function(AB){return AB.did===w;});}var AA=[],x,t,q=u.pars,E=(q&&q.length)||0;for(t=0;t<E;t++){x=J.copy(q[t]);x.isParam=true;if(t===0&&this.refOi){x.items=[this.refOi];this.refOi=null;}AA.push(x);}if(u.rpc>0&&!d.call(this)){x.isRepeated=true;var z=g(x.n);x.np={n:z.prefix,startAt:z.startAt||1};}return AA;},postProcessProsFromToken:function(u){var w=[],t,E=(u.pros&&u.pros.length)||0,q=function(x){if(l.indexOf(mstrmojo.ME.Enum.NonExposableParams,x.n)>-1){x.itemCss="hidden";}return x;};for(t=0;t<E;t++){w.push(q(J.copy(u.pros[t])));}return w;},buildSyntax:function(t){var q=[],u,E;q.push(t.n);q.push("(");E=(t.pars&&t.pars.length)||0;for(u=0;u<E;u++){q.push(t.pars[u].n);if(u!==(E-1)){q.push(", ");}}q.push(")");return q;},onOpen:function(){U=this.id;this._setupCandidatesCache();var t=this.getArgsFromTokens();var w=this,u=t||this.fctOi;var E=this.buildSyntax(u),x=this.postProcessParamsFromToken(u);x=x.concat(this.postProcessProsFromToken(u));if(u.sqt===5){x.push({n:"BreakBy",dn:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:"Break By is a parameter representing the break by levels for this function.",items:u.bb&&u.bb.items});}if(u.ios){x.push({n:"SortBy",dn:mstrmojo.desc(12852,"Sort By"),dtp:-1,desc:"Sort By is a parameter representing the sort by levels for this function.",items:u.sb&&u.sb.items});}x=x.concat(this.hiddenPs||[]);w.set("fctArgs",x);w.set("fctSyntax",E.join(""));w.set("fctDesc",mstrmojo.ME.FunctionInfo.getDescAndExample(this.fctOi).desc+"  "+mstrmojo.ME.MetricDataService.getFunctionHelpTopic(u.h));w.set("title",this.insertMode?u.n:mstrmojo.desc(9582,"Function Editor: ")+" "+this.oi.n);w.set("fctName",u.n);this.raiseEvent({name:"fctDidChange",did:this.fctOi.did});this.set("isAggFunction",this.isAgg());this.set("ios",u.ios);if(this._super){this._super();}if(this.isAggFunction){var q=this.argsGrid.ctxtBuilder.itemWidgets;if(q&&q.length>0){this.metricLCT.set("labelWidth",q[0].labelWidget&&q[0].labelWidget.domNode.clientWidth+"px");}}},getArgsFromTokens:function Q(){if(!this.oi||this.oi.tks.items.length===0){return null;}var u={},x=this.oi.tks.items,AM=x.length,AH=[],q=[],AG=0,E=[],AL;for(AL=0;AL<AM;AL++){var AA=x[AL],t=AA.tp,AO=AA.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(AA.v)&&(AA.v!=="("&&AA.v!==")")||AA.v==="&gt;"||AA.v==="&lt;"){continue;}switch(AO){case 65536:u.n=AA.oi?AA.oi.n:AA.v;var AB=this.fctOi=F(this.functions,u.n);AH=AB.pars||[];q=AB.pros||[];u.rpc=AB.rpc;u.sqt=AB.sqt;u.ios=AB.ios;break;case 196608:var AK=[],AF=[],AD,AJ,AI;AA=x[++AL];while(AA&&(AA.sctt===196608||AA.sctt===196609)){if(AA.sctt===196608){AF.push(AA);}else{AK.push(AF);AF=[];}AA=x[++AL];}AK.push(AF);AK[AK.length-1].pop();for(AI=0;AI<AK.length;AI++){AF=AK[AI];var w={n:""};AD=AF.length;if(AD===1){AA=AF[0];if(AA.extp){w={n:AA.v,did:AA.oi.did+"@"+AA.exv,exv:AA.exv,extp:AA.extp,oi:AA.oi,t:21,tk:AA};}else{var AE=Math.min(AH.length-1,E.length),AN=Z(AA,AA.v,AH[AE].dtp);w=AA.oi||{n:AN,v:AN};}}else{for(AJ=0;AJ<AD;AJ++){w.n+=AF[AJ].v;}w.v=w.n;w.did=w.n;w.t=O.Sub_Expression;w.tks=AF;}E.push(w);}break;case 131072:if(t==301){var AC={};AA=x[++AL];while(AA){if(AA.tp!=282){if(AA.oi){AC.items=AC.items||[];AC.items.push(AA.oi);}else{if(AA.tp===64){AC.items=AC.items||[];var z=AA.v+x[++AL].v;AA=x[AL+1];if(AA.tp===43||AA.tp===45){z+=x[++AL].v;z+=x[++AL].v;}AC.items.push(o.getDimtyObject(z,this.isDME));}}}if((AA=x[++AL])["v"]==="}"){break;}}u.bb=AC;}else{if(t==302){u.sb={};}else{if(t==259){mstrmojo.array.forEach(q,function(AR){if(AR.n===x[AL].v){AL=AL+2;var AQ=x[AL],AP=[];do{AP.push(x[AL++].v);if(x[AL].sctt===131072&&x[AL].tp===62||x[AL].sctt===131073){break;}}while(true);AP=AP.join("");AP=Z(AQ,AP,AR.dtp);AR.v=AP;return false;}});}}}break;}}u.pars=S(AH,E);u.pros=q;return u;},getTokens:function H(){var u=this.argsGrid.ctxtBuilder.itemWidgets,AA=u.length,z,AE,AB=[],t=[],AF=[],AC,x,q,E,AD=this.fctOi;for(z=0;z<AA;z++){AE=u[z].inputWidget;if(AE.data.isParam){t.push(AE.getTokens());}else{AB.push(AE.getTokens());}}AF.push({v:AD.n,oi:AD});AA=AB.length;if(AA>0){E=false;AF.push({v:"<",isDelimiter:true});for(z=0;z<AA;z++){AC=AB[z];q=AC.length;if(q===0){continue;}E=true;for(x=0;x<q;x++){AF.push(AC[x]);}AF.push({v:",",isDelimiter:true});}AF.pop();if(E){AF.push({v:">",isDelimiter:true});}}AA=t.length;AF.push({v:"(",isDelimiter:true});E=false;for(z=0;z<AA;z++){AC=t[z];q=AC.length;if(q===0){continue;}E=true;for(x=0;x<q;x++){AF.push(AC[x]);}AF.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}if(E){AF.pop();}AF.push({v:")",isDelimiter:true});for(z=0,AA=AF.length;z<AA;z++){AF[z].isNew=true;}return AF;},getMetricDefAsTokens:function p(){var E=this.getTokens();if(this.getLCTDefAsTokens){E=E.concat(this.getLCTDefAsTokens());}return E;},handleValidation:function n(u){if(u&&!u.rjec){return ;}var t=u&&u.rjec==="-2147214846";if(t){var q=u.items,w=mstrmojo.array.find(q,"sta",-1),E=q[w].v;mstrmojo.alert('More than one object with the name "#" found. Browse to select the object or retype to select it from the search autocomplete list.'.replace("#",E));}else{mstrmojo.alert(u&&u.rjed);}},getPROPBuilder:function a(){return W;},getDTPBuilder:function j(){return C;},getParamWidget:function B(E){return G(E);},getBreakByWidget:function T(E){return P(E);},getSortByWidget:function k(E){return this._super();},getTextWidget:function V(E){return{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(q){var t=this.data;this.value=t.v||((t.dfv||t.dfv===0)?t.dfv:"");},getTokens:function(){var q=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==q.dfv){return[{v:q.n},{v:"=",isDelimiter:true},{v:L(q.dtp,this.value)}];}return[];},onvalueChange:function(){e(this.parent.dataGrid.parent);}};},getDataGridRef:function D(){return{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:this.fctArgsDataGridCssClass,makeObservable:true,banding:false,columns:[{headerText:"Property Name",dataWidgetBuilder:this.getPROPBuilder(),colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:this.getDTPBuilder(),colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"},onadd:function(){b();}};},init:function m(E){this.children=this.getChildren();this._super(E);U=this.id;X=this;},isAgg:function K(E){return(E||this.fctOi||{}).sqt===1;},getChildren:function I(){return[mstrmojo.ME._MetricEditorHelper.formatAndOptionsBarRef,mstrmojo.ME._MetricEditorHelper.nameEditBoxRef,mstrmojo.ME._MetricEditorHelper.functionNameRef,this.getDataGridRef(),this.getLCTComponent(),{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionSyntax",bindings:{visible:"this.parent.insertMode",text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionDesc",allowHTML:true,bindings:{visible:"this.parent.insertMode || this.parent.simplex",text:function(){return this.parent.fctDesc;}}},mstrmojo.ME._MetricEditorHelper.switchRef,mstrmojo.ME._MetricEditorHelper.buttonBarRef];}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.ui._HasScroller","mstrmojo.SearchableDropDownList","mstrmojo.ME.FunctionWizard","mstrmojo.ME._DerivedMetricEditorHelper");mstrmojo.requiresDescs(3377,11569,12179);var A,C;mstrmojo.ME.DerivedFunctionWizard=mstrmojo.declare(mstrmojo.ME.FunctionWizard,[mstrmojo.ME._DerivedMetricEditorHelper,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.DerivedFunctionWizard",init:function F(G){mstrmojo.css.addWidgetCssClass(this,"dme");this._super(G);A=this.id;C=this;},setupScrollNodes:function E(){this.scrollNode=this.containerNode;},onOpen:function B(){this._super();if(this.updateScrollbars){this.updateScrollbars();}},getParamObjectTypes:function D(){var G=this.opener||{};return G.getValidFuncParamTypes?G.getValidFuncParamTypes(this.fctOi):this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.es.RootView","mstrmojo.qb.QBHelpers");var C=mstrmojo.qb.QBHelpers;mstrmojo.qb.bigquery.ESRootView=mstrmojo.declare(mstrmojo.qb.es.RootView,null,{scriptClass:"mstrmojo.qb.bigquery.ESRootView",init:function A(D){this.children=C.clone(this.children);this.children[0].children[0].scriptClass="mstrmojo.qb.bigquery.BigQueryWHPanel";if(this._super){this._super(D);}},getDBRoleSelector:function B(){return this.main.children[0].topPanel.dbSelector;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._BigQueryController","mstrmojo.qb.es.Controller");mstrmojo.qb.bigquery.ESController=mstrmojo.declare(mstrmojo.qb.es.Controller,[mstrmojo.qb.bigquery._BigQueryController],{scriptClass:"mstrmojo.qb.bigquery.ESController"});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.CheckBox","mstrmojo.StackContainer","mstrmojo.FileUploadBox","mstrmojo.DataGrid","mstrmojo.fe.FilterEditor","mstrmojo.fe.FilterUtils","mstrmojo.ui.menus.Menu","mstrmojo.ui.menus.MenuConfig","mstrmojo.qb.QBAlertDialog","mstrmojo.onetier.vi.ui.DBCredentialEditor");mstrmojo.requiresDescs(187,221,773,1088,1302,2461,9117,9118,12085,12393,12394,12395,12396,12397,12398,12399,12400,12401,12402,12814,12837,13048,13049,13050,13051,13052,13053,13054,13055,13056,13057,13099,1825,13275,13276,13277,12949,13942,13943,13959,13960,13969,13970,13971,13972,14215);var M=mstrmojo.DI.DIConstants,K=4*1024*1024,H=mstrmojo.array,C=mstrmojo.hash,J=mstrmojo.css,E=mstrmojo.dom,D=mstrmojo.desc,I="canSaveSchedule",L="canStartRefresh",G={"0":"tablestatus-col status waiting","1":"tablestatus-col status waiting","2":"tablestatus-col status waiting","3":"tablestatus-col status finished","4":"tablestatus-col status warning","5":"tablestatus-col status waiting","6":"tablestatus-col status warning"};function B(Y){var R=this.parent,O=this.parent.dataGrid.parent,a="di-alt-popup",P,W=O.parent.zIndex+10,V={emmaIRRMessageID:mstrApp.getRootController().dataService.emmaIRRMessageID,emmaSingleIsForAlternateSource:true,emmaSingleAlertCfg:{zIndex:W+1000}},N=mstrApp.getRootController().getModel().getImportSource(Y),X=M.xdaType,Q=N.xdaType;if(mstrApp.size){V.size=mstrApp.size;}else{mstrApp.size={};mstrApp.size.h="552px";mstrApp.size.w="1010px";V.size=mstrApp.size;}if(Q===X.excel||Q===X.text){var U=mstrApp.getRootController(),Z=U.navigationController.getPageSlot(),T=false;Z.setConfig({properties:{operationMode:M.operationMode.create,singleURL:true,onFinishButtonClick:function(){var c=this.getURLs(),b=(c.length===1)?c[0]:"",d={success:function(){var f,e;U.showPage(M.pageType.emmaPreview);f=R.data;if(!f.alternateSource){f.alternateSource={};}e=f.alternateSource;e.tableName=mstrmojo.DI.DIHelpers.getURLFileName(b);R.update();},failure:function(e){U.displayError(mstrmojo.desc(12837,"Cannot set alternate source."),false,(e&&e.message)||"");}};if(!b){return ;}U.getScheduleController().selectAlternateSourceURL(Y,b,d);T=true;},onCancelButtonClick:function(){if(T){var b={success:function(){R.data.alternateSource=null;R.update();},failure:function(c){U.displayError(D(12394,"Cannot delete alternate source."),false,(c&&c.message)||"");}};U.getScheduleController().editEmmaIRRSourceTableSingleTable(Y,null,"1",null,null,null,b);}}},footerConfig:{next:{visible:false},back:{visible:false},cancel:{visible:true},finish:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false}}});U.showDialog(M.dialogType.diPageDialog,{slot:Z,pageType:M.pageType.file,sourceInfo:1,cssClass:"mstrmojo-di-SelectURLAlternateSource-editor"});return ;}if(Q!==X.qbSingleTable){return ;}P=mstrmojo.all[a];if(!P){P=mstrmojo.insert({scriptClass:"mstrmojo.qb.QBContainer",id:a});mstrmojo.hash.copy(V,P.QBParams);}O.openPopup({scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(13048,"Select Alternate Source"),cssClass:"mstrmojo-di-SelectAlternateSource-editor",onPreClose:function S(){this.buttonBox.cancel.onclick();return true;},children:[P,{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonBox",children:[{scriptClass:"mstrmojo.Button",alias:"finish",text:mstrmojo.desc(1302,"Finish"),cssClass:"mstrmojo-WebButton hot",onclick:function(){var b=this.parent.parent,c=b&&b.opener,d;d={success:function(e){var g,f;g=R.data;if(!g.alternateSource){g.alternateSource={};}f=g.alternateSource;f.tableName=e.tableName;R.update();if(c){c.closePopup();}}};mstrApp.getRootController().selectAlternateSource(Y,d,W+10);}},{scriptClass:"mstrmojo.Button",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-WebButton",onclick:function(){var d=this.parent.parent,f=d&&d.opener,b,h,e,g,c;b=mstrApp.msgid;h=mstrApp.getRootController().dataService.emmaIRRMessageID;c=mstrApp.hasEditEmmaIRRSource;mstrApp.container.unloadQB();e=mstrApp.getRootController().dataService;mstrApp.messageID=b;if(b){e.set("messageID",b);}if(h){e.set("emmaIRRMessageID",h);}g={success:function(){R.data.alternateSource=null;R.update();if(f){f.closePopup();}},failure:function(j){mstrApp.getRootController().displayError(D(12394,"Cannot delete alternate source."),false,(j&&j.message)||"");}};if(c){mstrApp.rootController.getScheduleController().editEmmaIRRSourceTableSingleTable(Y,null,"1",null,null,null,g);}else{if(f){f.closePopup();}}}}]}]},{zIndex:W});P.loadQB();mstrmojo.dom.center(P.domNode.parentNode.parentNode);mstrApp.hasEditEmmaIRRSource=false;}function F(P){var N=this.parent.dataGrid,O=function O(W,U){var V={expr:U,targets:W.slice(0)},Q=function Q(Y){var a=Y.expr;P.filter=a;mstrApp.getRootController().getScheduleController().setEmmaIRRFilter(mstrmojo.fe.FilterUtils.getExprXml(a),{success:function Z(){P.updateFilterUsedInTable();N.refresh();},failure:function(b){mstrApp.getRootController().displayError(D(13099,"Failed to set refresh filter."),false,(b&&b.message)||"");}});},T="irrfe",S,X=function X(){return true;};S=T&&window.mstrmojo&&mstrmojo.all[T];if(!S){S=mstrmojo.insert({id:T,scriptClass:"mstrmojo.fe.FilterEditor",showLimits:false,cssClass:"mstrmojo-charcoalboxe mstrmojo-FE mstrmojo-IRRFilter-editor"});S.walk.getAttributeForms=function R(Y){return S.IRRAttrForms&&S.IRRAttrForms[Y];};}S.IRRAttrForms=P.IRRAttrForms;S.objectBrowsingEnabled=false;S.set("title",mstrmojo.desc(12085,"Select a filter"));S.set("onSave",Q);S.set("model",V);S.set("disableElementsBrowsing",X);S.open(null,{zIndex:mstrApp.getRootController().getDialogController().getNextZIndex()});};O(P.IRRAttributes,P.filter||"");}mstrmojo.DI.AlternateSourceMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.AlternateSourceMenu",menuCssClass:"mstrmojo-di-AlternateSourceMenu",tableID:null,menuCfg:null,getMenuConfig:function(){var N=this.menuCfg;if(!N){N=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{N.clear();}N.addMenuItem(D(12393,"Set Source"),"",this.handleSetSource,{tableID:this.tableID,cellWidget:this.cellWidget});N.addMenuItem(D(12396,"Delete Source"),"",this.handleDeleteSource,{tableID:this.tableID,cellWidget:this.cellWidget});return N;},handleSetSource:function(O){var N=O.ctxt;B.call(N.cellWidget,N.tableID);return true;},handleDeleteSource:function(P){var N=P.ctxt,O=N.tableID,Q=N.cellWidget,R;R={success:function(){Q.data.alternateSource=null;Q.update();},failure:function(S){mstrApp.getRootController().displayError(D(12394,"Cannot delete alternate source."),false,(S&&S.message)||"");}};mstrApp.rootController.getScheduleController().editEmmaIRRSourceTableSingleTable(O,null,"1",null,null,null,R);return true;}});function A(P,Q){var O,N;if(!P.openPopup){P.openPopup=function(S,R){mstrmojo._HasPopup.openPopup.call(P,S,R);};}if(!P.closePopup){P.closePopup=function(){mstrmojo._HasPopup.closePopup.call(P);};}O=P.menuHelper;if(!O){O=P.menuHelper=new mstrmojo.DI.AlternateSourceMenu();}O.tableID=Q.tableID;O.cellWidget=Q.cellWidget;N=O.getMenuConfig();N.hostId=P.id;N.hostElement=P.domNode;N.isHostedWithin=false;P.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:N}));}mstrmojo.DI.DITableStatusList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DI.DITableStatusList",bHasRefreshCheckbox:true,bHasRefreshPolicy:true,bHasSourceFilter:false,bHasAlternateSource:false,title:null,items:null,importFileFunc:mstrmojo.func.emptyFn,forceFullPublish:true,hasIRR:false,markupString:'<div id="{@id}" class="mstrmojo-di-tablestatuslist {@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{titleNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function(){var N=this.model;this.update();N.attachEventListener("PublishStatusUpdate",this.id,"updateStatus");if(this._super){this._super();}},updateStatus:function(N){var O=this;if(N&&N.name){this.set("updateStarted",true);}if(N&&N.reset){this.set("updateStarted",false);window.setTimeout(function(){O.checkCanRefresh();},0);}},update:function(N){var P=this.model,O=[];if(N&&N.name){this.set("updateStarted",true);}mstrmojo.hash.forEach(P.importSources,function(Q){if(Q.checked===undefined){if(P.operationMode===M.operationMode.create||P.operationMode===M.operationMode.edit){Q.checked=true;}else{Q.checked=false;}if(P.operationMode===M.operationMode.refresh){if(Q.canSubscribe()){Q.checked=true;}else{Q.checked=false;}}}O.push(Q);});this.set("items",O);},getFileUploader:function(O){var N=this.model;var P=null;if(N.importSources[O]){P=N.importSources[O].fileUploader;}return P;},checkCanRefresh:function(){var O=mstrApp.getRootController(),N=this.model,R=N.operationMode,Q=N.getAllTableID(),S=true,P=0;if(R===M.operationMode.refresh){H.forEach(Q,function(U){var T=N.getImportSource(U);if(T.checked){P++;if(T.type===M.sourceType.file){if(T.subtype===M.sourceSubtype.clipboard||T.subtype===M.sourceSubtype.localFile){if(!T.hasSelectFile){S=false;}}}}});if(P===0){S=false;}}if(R===M.operationMode.edit){H.forEach(Q,function(V){var U=N.getImportSource(V),T=false;if(U.type===M.sourceType.file){if(U.subtype===M.sourceSubtype.clipboard||U.subtype===M.sourceSubtype.localFile){if(!N.isCubePublished||!N.rawDataExistsInAE){T=!U.hasRefreshedData;}else{T=!U.isAll&&U.executeAction===M.tableStatsExecutionAction.forceExecution&&!U.hasRefreshedData;}if(T&&!U.hasSelectFile){S=false;}}}});}O.raiseModelEvent({name:L,value:S});return S;},checkCanChange:function(){var N=this.model,Q=N.operationMode,O=N.getAllTableID(),P=false;if(Q===M.operationMode.refresh){P=true;}if(Q===M.operationMode.edit){if(!N.isCubePublished||!N.rawDataExistsInAE){P=false;}else{H.forEach(O,function(T){var S=N.getImportSource(T),R;R=S.hasRefreshedData&&(!S.forceRepublish||!S.schemaChanged);if(R){P=true;}});}}return P;},children:[{slot:"titleNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tablestatuslist-title",bindings:{text:"this.parent.title",visible:"this.parent.title"}},{slot:"listNode",alias:"list",scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-di-tablestatuslist-list",lockHeader:true,bindings:{items:"this.parent.items",forceFullPublish:"this.parent.forceFullPublish",updateStarted:"this.parent.updateStarted"},columns:[],listSelector:null,resizableColumns:true,onitemsChange:function(){if(this._super){this._super();}var P=this.parent.bHasRefreshCheckbox,Q=this.parent.bHasRefreshPolicy,O=this.parent.bHasSourceFilter,R=this.parent.bHasAlternateSource,N=[];if(P){N.push({headerWidget:{scriptClass:"mstrmojo.TristateCheckBox",cssClass:"tristate tablestatus-header refresh",grayed:false,checked:false,eventSubs:null,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var Y;if(this.tooltipContent){Y=E.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(Y.y-3,0),left:Math.max(Y.x-7,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});}},preBuildRendering:function(){this.evts=[];if(!this.eventSubs){var Z={},Y=Z[this.id]={};Y.scheduleCheckedChange=this.updateStatus;Y.refreshCheckedChange=this.updateStatus;Y.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(Z);}this.updateStatus();},onUnRender:function U(){if(this.eventSubs){mstrApp.getRootController().detachDataChangeListeners(this.eventSubs);this.eventSubs=null;}if(this._super){this._super();}},updatePublishStatus:function S(Y){if(Y&&Y.name){this.set("enabled",false);}if(Y&&Y.reset){this.set("enabled",this.origEnabled);}},updateStatus:function V(){if(!this.visible){return ;}var c=this,f=0,Y=0,Z,g,e=true,b=false,d=c.dataGrid.parent.model,a=d.operationMode;if(a===M.operationMode.create||a===M.operationMode.edit){c.dataGrid.parent.checkCanRefresh();this.set("visible",false);return ;}H.forEach(c.dataGrid.items,function(h){if(!h.isAll){if(h.checked){Y++;}f++;}});if(!Y){Z=false;g=false;}else{if(Y<f){Z=true;g=true;}else{Z=false;g=true;b=true;}}if(a===M.operationMode.refresh){e=!c.dataGrid.forceFullPublish;if(!e){this.set("tooltipContent",mstrmojo.desc(13960,"Cube doesnot exist in memory so all tables must be republished."));}}d.checked=b;this.set("grayed",Z);this.set("checked",g);this.set("enabled",e);this.set("origEnabled",e);if(a===M.operationMode.subscribe){mstrApp.getRootController().raiseModelEvent({name:I,value:Y>0});}if(a===M.operationMode.refresh){c.dataGrid.parent.checkCanRefresh();}},onclick:function(){if(this.grayed){this.set("grayed",!this.grayed);}else{this.set("checked",!this.checked);}var f=this,Z=f.dataGrid.parent.model.operationMode,k=[],Y=[],b=this.checked,a=f.dataGrid.parent.hasIRR,d=mstrApp.getRootController(),g=d.getScheduleController(),e=f.dataGrid.parent.model,c=e.cubeID,j=f.dataGrid.items,h=false;e.checked=!this.grayed&&this.checked;if(Z===M.operationMode.refresh||Z===M.operationMode.subscribe){H.forEach(j,function(l){if(!l.isAll&&l.checked!==b){if(b&&Z===M.operationMode.subscribe&&!l.canSubscribe()){return true;}if(Z===M.operationMode.refresh&&l.forceRepublish){f.set("grayed, true");return true;}k.push(l.tableID);Y.push(l.refreshType.toString());l.checked=b;}});if(k.length>0){d.raiseModelEvent({name:"allCheckedChange"});if(a){if(b){g.createEmmaIRRSourceTables(c,k,Y);}else{g.deleteEmmaIRRSourceTable(k);}}}if(Z===M.operationMode.subscribe){H.forEach(j,function(l){if(l.checked){h=true;return false;}});d.raiseModelEvent({name:I,value:h});}if(Z===M.operationMode.refresh){f.dataGrid.parent.checkCanRefresh();}}}},colWidth:"65",dataWidget:{scriptClass:"mstrmojo.StackContainer",cssClass:"tablestatus-col refreshBox",colWidth:"65",children:[{scriptClass:"mstrmojo.CheckBox",cssClass:"refreshCheckbox",cssDisplay:"table",colWidth:"65",visible:false,text:"",tooltipOpenDelay:0,useRichTooltip:true,preBuildRendering:function(){var Y=this.parent.dataGrid,Z=Y.parent.model,b=this.parent.data,a;this.update();this.subEvts=[];a=Z.attachEventListener("allCheckedChange",this.id,"updateCheck");this.subEvts.push(a);if(!b.isAll){this.dataEvt=b.attachEventListener("checkedChange",this.id,"updateCheck");}a=Z.attachEventListener("PublishStatusUpdate",this.id,"updatePublishStatus");this.subEvts.push(a);},onUnRender:function(){var Y=this.parent.dataGrid,a=this.parent.data,Z=Y.parent.model;H.forEach(this.subEvts,function(b){Z.detachEventListener(b);});if(this.dataEvt){a.detachEventListener(this.dataEvt);}},updatePublishStatus:function(Y){if(Y&&Y.name){this.set("enabled",false);}if(Y&&Y.reset){this.set("enabled",this.origEnabled);}},updateTooltipConfig:function(){var Y;if(this.tooltipContent){Y=E.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(Y.y-3,0),left:Math.max(Y.x-7,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});}},update:function(){var c=this.parent,b=this.parent.data,a=c.dataGrid.parent.model.operationMode,Y=true,Z=false;if(b.isAll){return false;}if(a===M.operationMode.refresh){Y=!c.dataGrid.forceFullPublish&&!b.forceRepublish;Z=c.dataGrid.forceFullPublish||c.data.checked===true||b.forceRepublish;if(!Y){if(c.dataGrid.forceFullPublish){this.set("tooltipContent",mstrmojo.desc(13960,"Cube doesnot exist in memory so all tables must be republished."));}else{if(b.forceRepublish){this.set("tooltipContent",mstrmojo.desc(13969,"The edit operations require the following table to be refreshed."));}}}}else{if(a===M.operationMode.subscribe){Y=c.data.canSubscribe();Z=c.data.checked;if(!Y){this.set("tooltipContent",mstrmojo.desc(13056,"No scheduling support for local files"));}}}this.set("enabled",Y);this.set("origEnabled",Y);this.set("checked",Z);},updateCheck:function(){var Y=this.parent.data;this.set("checked",!!Y.checked);},oncheckedChange:function(){var g=this.parent,j=g.dataGrid.parent.model,f=mstrApp.getRootController(),h=f.getScheduleController(),k,e,c=j.cubeID,d=g.data,l,b=this.checked,a=g.dataGrid.parent.hasIRR,Z=j.operationMode;if(d.checked===b){if(j.operationMode===M.operationMode.refresh){f.raiseModelEvent({name:"refreshCheckedChange",data:d});}return ;}if(!d.isAll){if(b&&Z===M.operationMode.subscribe&&!d.canSubscribe()){return ;}d.set("checked",b);}if(j.operationMode===M.operationMode.refresh){f.raiseModelEvent({name:"refreshCheckedChange",data:d});}if(j.operationMode===M.operationMode.subscribe){f.raiseModelEvent({name:"scheduleCheckedChange"});k=d.tableID;if(!a){return ;}if(b){e=d.refreshType.toString();l={failure:function Y(m){f.displayError(D(12395,"Cannot create source table."),false,(m&&m.message)||"");}};h.createEmmaIRRSourceTables(c,[k],[e],l);}else{l={failure:function Y(m){f.displayError(D(12394,"Cannot delete source table."),false,(m&&m.message)||"");}};h.deleteEmmaIRRSourceTable([k],l);}}}},{scriptClass:"mstrmojo.Label",cssClass:"refreshBox-status",visible:false,preBuildRendering:function(){var Y=this.parent.dataGrid.parent.model;this.update();this.subEvt=Y.attachEventListener("PublishStatusUpdate",this.id,"update");},onUnRender:function(){var Y=this.parent.dataGrid.parent.model;if(this.subEvt){Y.detachEventListener(this.subEvt);}},update:function(){var b=this.parent.data,a=this.parent.dataGrid.parent.updateStarted,Z=b&&b.status,c="",Y="tablestatus-col status";if(Z==="4"||Z==="6"){c=b.errmsg||"";}if(G[Z]){Y=G[Z];}else{if(a){Y=G[0];}}this.set("title",c);this.set("cssClass",Y);if(this.domNode){this.domNode.className=Y;}}}],preBuildRendering:function(){var Y=this.dataGrid.parent.model;this.update();this.subEvt=Y.attachEventListener("PublishStatusUpdate",this.id,"update");},onUnRender:function(){var Y=this.dataGrid.parent.model;if(this.subEvt){Y.detachEventListener(this.subEvt);}},update:function(Z){var a=null,b=this.dataGrid.parent.model.operationMode,Y=this.dataGrid.parent.updateStarted,c=this.data;if(Z&&Z.reset){Y=false;}if(c.isAll){a=null;}else{a=this.children[0];if(b!==M.operationMode.subscribe&&c.checked){if((Y&&c.published)||b!==M.operationMode.refresh){a=this.children[1];}}}this.set("selected",a);}}});}N.push({headerText:mstrmojo.desc(12949,"Data Source"),headerCss:"tablestatus-header label",dataWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-col tableNameBox cf",preBuildRendering:function(){var Y=this.dataGrid.parent.model,Z=Y.operationMode;if(Z===M.operationMode.refresh){Y.attachEventListener("refreshCheckedChange",this.id,"update");}if(Z===M.operationMode.subscribe){if(!this.data.isAll&&!this.data.canSubscribe()){this.children[0].set("enabled",false);}}this.update();},update:function(){var d=this.data,b=d.checked,Y=this.dataGrid.parent.model,Z=d.hasSelectFile,c=this.children[0],a=c&&c.domNode,e=false;if(Y.operationMode===M.operationMode.refresh){e=b;}if(Y.operationMode===M.operationMode.edit){if(!Y.isCubePublished||!Y.rawDataExistsInAE){e=!d.hasRefreshedData;}else{e=!d.isAll&&d.executeAction===M.tableStatsExecutionAction.forceExecution&&!d.hasRefreshedData;}}if(a){J.toggleClass(a,"selected",b);J.toggleClass(a,"hasSelectFile",Z||!e);}else{if(b){J.addWidgetCssClass(c,"selected");}else{J.removeWidgetCssClass(c,"selected");}if(Z||!e){J.addWidgetCssClass(c,"hasSelectFile");}else{J.removeWidgetCssClass(c,"hasSelectFile");}}this.children[1].set("visible",e);},children:[{scriptClass:"mstrmojo.Label",tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var Y;if(this.title){Y=E.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-A",top:Math.max(Y.y+Y.h+2,0),left:Math.max(Y.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});}},resetText:function(){var Z=this.parent.data,Y="";if(Z.sourceInfo){Y=Z.sourceInfo.dbTableName||Z.sourceInfo.name;}this.set("text",Y);},bindings:{title:function(){var Y=mstrmojo.desc(13050,"###T Name: ###F."),Z=mstrmojo.desc(13051," Sheet Name: ###S."),a="";if(this.parent.data.getDataSource){a=this.parent.data.getDataSource()+" ";}if(this.parent.data.sourceInfo){Y=Y.replace("###T",this.parent.data.getSourceObjectType());Y=Y.replace("###F",this.parent.data.sourceInfo.dbTableName||this.parent.data.sourceInfo.name);if(this.parent.data.sourceInfo.sheetName){Z=Z.replace("###S",this.parent.data.sourceInfo.sheetName);Y+="<br>";Y+=Z;}}else{Y="";}return a+"<br>"+Y;},cssClass:function(){var a=this.parent.data,Z=this.parent.dataGrid.parent.model,Y="tableNameBox-name";if(a.type===M.sourceType.file&&Z.operationMode!==M.operationMode.create){if(a.subtype===M.sourceSubtype.localFile||a.subtype===M.sourceSubtype.clipboard){Y+=" hasBrowse";}}return Y;},text:function(){var Z=this.parent.data,Y="";if(Z.sourceInfo){Y=Z.sourceInfo.dbTableName||Z.sourceInfo.name;}return Y;}}},{scriptClass:"mstrmojo.StackContainer",renderMode:"notonShow",markupMethods:mstrmojo.hash.copy({onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},mstrmojo.StackContainer.prototype.markupMethods),cssClass:"tableNameBox-stack",visible:false,children:[{scriptClass:"mstrmojo.Button",cssClass:"tableNameBox-stack-edit",visible:false,text:mstrmojo.desc(1088,"Edit"),onclick:function(){mstrApp.getRootController().showDialog(M.dialogType.diPageDialog,{tableID:this.parent.parent.data.tableID,left:"200px",top:"115px",cssClass:"mstrmojo-di-refresh-data-editor"});}},{scriptClass:"mstrmojo.FileUploadBox",cssClass:"mstrmojo-di-button mstrmojo-WebButton",visible:false,uploadTaskId:"importFile",action:mstrConfig.taskURL,fileFieldName:"myFile",initValue:false,browseLabel:mstrmojo.desc(1825,"Browse"),onvalueChange:function(){var Z=this.parent.parent.data,a=(this.value!==""),Y=this.parent.parent.dataGrid;Z.hasSelectFile=a;Z.fileUploader=this;if(a){Z.set("checked",true);}this.parent.parent.update();if(a){this.parent.parent.children[0].set("text",this.getFileName());}else{this.parent.parent.children[0].resetText();}Y.parent.checkCanRefresh();},getFileName:function(){var Y;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)&&this.fileNode.files){Y=this.fileNode.files.length>0&&this.fileNode.files[0].name;}else{Y=this.value;}return Y;},getFileSize:function(){var Y=0;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)&&this.fileNode.files){Y=this.fileNode.files.length>0&&this.fileNode.files[0].size;}else{try{var b=new ActiveXObject("Scripting.FileSystemObject");var Z=b.getFile(this.fileNode.value);if(Z){Y=Z.Size;}}catch(a){}}return Y;},submit:function(a,m,g){function n(p){var q=[];q.push(p.target.result);var h=new Blob(q);mstrApp.showProgress(g);mstrmojo.xhr.upload("POST",mstrConfig.taskURL,m,a,h,g);}function b(){var h={code:0,message:mstrmojo.desc(12814,"Cannot read file content")};if(m.failure){m.failure(h);}if(m.complete){m.complete();}}function o(p){a.fileName=Z;a.index++;var q=[];q.push(p.target.result);var h=new Blob(q);if(a.index===a.numberOfChunks){mstrmojo.xhr.upload("POST",mstrConfig.taskURL,m,a,h,g);}else{mstrmojo.xhr.upload("POST",mstrConfig.taskURL,null,a,h,g);}if(e+K<j.size){e=e+K;l=new FileReader();q=j.slice(e,Math.min(j.size,e+K));l.onload=o;l.readAsArrayBuffer(q);}}var c=true;var l,j,Z,f,e,Y;if(this.onsubmit){c=this.onsubmit();}if(c){a=a||{};a.fileFieldName=this.fileFieldName;a.taskId=this.uploadTaskId;a.jsonp=this.jsonp.replace("{@id}",this.id);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){l=new FileReader();j=this.fileNode.files[0];Z=j.name;if(this.params){a=this.params;}l.onerror=b;if(j.size>K){f=Math.ceil(j.size/K);e=0;a.index=0;a.numberOfChunks=f;a.chunkSize=K;a.fileSize=j.size;a.fileType="application/octet-stream";mstrApp.showProgress(g);mstrmojo.xhr.upload("POST",mstrConfig.taskURL,null,a,null,g);Y=j.slice(e,e+K);l.onload=o;l.readAsArrayBuffer(Y);}else{a.fileName=this.fileNode.files[0].name;l.onload=n;l.readAsArrayBuffer(j);}}else{a.taskEnv="jsonp2";a.fileName=this.value;var k=[],d;for(d in a){k.push('<input type="hidden" name="'+d+'" value="'+mstrmojo.string.encodeHtmlString(a[d])+'"/>');}if(this.params){a=this.params;for(d in a){k.push('<input type="hidden" name="'+d+'" value="'+mstrmojo.string.encodeHtmlString(a[d])+'"/>');}}this.paramsNode.innerHTML=k.join("");if(m){this.onSuccess=m.success;this.onFailed=m.failure;}this.formNode.submit();}this.set("status","loading");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",visible:false,text:mstrmojo.desc(13052,"Upload"),replaceOneTierFile:function(b){var a=this.parent.parent.data,Z=this.parent.parent.dataGrid;var d=0,f;if(!b){return ;}var e=b.split("*"),c,Y=[];for(d=0;d<e.length;d++){c=e[d];Y.push(c);f=c.lastIndexOf("\\");if(f===-1){f=c.lastIndexOf("/");}a.hasSelectFile=true;a.files=[];a.files.push(Y[0]);this.parent.parent.children[0].set("text",Y[0].substr(f+1));this.parent.parent.update();Z.parent.checkCanRefresh();}},onclick:function(){var b=mstrApp.getRootController(),a=this.parent.parent.data,Y=this.parent.parent.dataGrid,f=b.navigationController.getPageSlot(),Z=M.pageType.dataSelection,d=null,c=this.parent.parent,e={next:{visible:true,text:mstrmojo.desc(13052,"Upload")},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};switch(a.type){case M.sourceType.file:if(a.subtype===M.sourceSubtype.clipboard){f.setConfig({footerConfig:e,properties:{operationMode:M.operationMode.refresh,tableID:a.tableID,currentSource:a,onNextButtonClick:function(){b.showPage(M.pageType.emmaPreview);a.hasSelectFile=true;a.fileUploader=this;c.update();Y.parent.checkCanRefresh();}}});this.pageSlot=f;Z=M.pageType.clipboard;d=0;b.showDialog(M.dialogType.diPageDialog,{pageType:Z,sourceInfo:d,slot:f});}else{if(a.subtype===M.sourceSubtype.localFile){mstrmojo.DI.DITableStatusList.selectedUploader=this.id;b.launchOneTierBrowser("mstrmojo.DI.DITableStatusList.OneTierFiles");}}break;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",visible:false,text:mstrmojo.desc(14287,"Input Credentials"),onclick:function(){var Z=this.parent.parent.data;var a=[this.parent.parent.data.did];var Y=mstrApp.getRootController();switch(Z.type){case M.sourceType.googleBigQuery:case M.sourceType.dropbox:case M.sourceType.facebook:case M.sourceType.googleAnalytics:case M.sourceType.googleDrive:case M.sourceType.salesforce:case M.sourceType.twitter:Y.setTableIDsForOAuth(a);Y.gotoOAuthLogin(Z.type);break;default:new mstrmojo.onetier.vi.ui.DBCredentialEditor({data:Z,zIndex:Y.getDialogController().getNextZIndex()}).open();break;}}}],preBuildRendering:function(){var b=this.parent.data,Y=this.parent.dataGrid.parent.model,Z=null;switch(b.type){case M.sourceType.file:if(b.subtype===M.sourceSubtype.clipboard){Z=this.children[2];}else{if(b.subtype===M.sourceSubtype.localFile){if(mstrApp.isSingleTier){Z=this.children[2];}else{Z=this.children[1];}}}break;default:Z=null;if(mstrApp.isSingleTier&&Y.missingCredentialsData){var a=this;mstrmojo.array.forEach(Y.missingCredentialsData.datasets[0].tables,function(c){if(c.did===b.tableID){if(c.dbRole){b.dbRole=c.dbRole;}Z=a.children[3];}});}break;}if(Z){this.set("selected",Z);}this.subEvt=Y.attachEventListener("PublishStatusUpdate",this.id,"update");if(this._super){this._super();}},onUnRender:function(){var Y=this.parent.dataGrid.parent.model;if(this.subEvt){Y.detachEventListener(this.subEvt);}},update:function(Y){if(Y&&Y.name&&this.selected){this.selected.set("enabled",false);}if(Y&&Y.reset&&this.selected){this.selected.set("enabled",true);this.parent.update();}if(Y&&Y.reset&&Y.errors){switch(Y.errors[this.parent.data.tableID]){case M.backendError.noExternalSession:case M.backendError.databaseCredentialsNotAvailable:this.selected=this.children[3];this.selected.set("visible",true);this.parent.update();break;case M.backendError.switchingFileType:if(this.selected){this.selected.set("enabled",true);this.parent.update();}break;}}}}]}});if(Q){N.push({headerText:mstrmojo.desc(13053,"Refresh Policy"),headerCss:"tablestatus-header pulldown",colWidth:"260",dataWidget:{scriptClass:"mstrmojo.StackContainer",cssClass:"tablestatus-col stack pulldown",colWidth:"65",children:[{scriptClass:"mstrmojo.Pulldown",popupZIndex:9999,popupToBody:true,colWidth:"230",visible:false,items:[],tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var Y;if(this.tooltipContent){Y=E.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(Y.y-3,0),left:Math.max(Y.x,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});}},postCreate:function X(){var b=this.parent.data,c=this.parent,Z=true,a=this.parent.dataGrid.parent.model.operationMode,Y=[{n:D(9117,"Replace existing data"),dssid:M.cubeRefreshType.replaceTable},{n:D(9118,"Update existing data and add new data"),dssid:M.cubeRefreshType.upsert},{n:D(12397,"Update existing data"),dssid:M.cubeRefreshType.update},{n:D(12398,"Add new data"),dssid:M.cubeRefreshType.add}];if(b.isAll){Y.push({n:"",dssid:M.cubeRefreshType.dummy});this.parent.set("visible",false);}else{if(a===M.operationMode.edit){if(c.dataGrid.forceFullPublish){Z=false;}else{Z=(!b.forceRepublish||!b.schemaChanged)&&b.hasRefreshedData;}this.set("enabled",Z);if(!Z){this.set("tooltipContent",mstrmojo.desc(13970,'The edit operations require the refresh policy to be "Replace existing data".'));}}if(a===M.operationMode.refresh){Z=!c.dataGrid.forceFullPublish&&(!b.forceRepublish||!b.schemaChanged);this.set("enabled",Z);if(!this.enabled){if(c.dataGrid.forceFullPublish){this.set("tooltipContent",mstrmojo.desc(13971,'Cube doesnot exist in memory so the refresh policy has to be "Replace existing data".'));}else{this.set("tooltipContent",mstrmojo.desc(13972,'The edit operations require the refresh policy to be "Replace existing data".'));}}}if(a===M.operationMode.subscribe){Z=b.canSubscribe();this.set("enabled",Z);if(!Z){this.set("tooltipContent",mstrmojo.desc(13056,"No scheduling support for local files"));}}}this.set("origEnabled",this.enabled);this.set("items",Y);},updateStatus:function V(){var c=this.parent,b=c.data,Z=null,a=b.model.refreshType,Y=true;H.forEach(c.dataGrid.items,function(d){if(!d.isAll){if(d.refreshType!==Z){if(Z===null){Z=d.refreshType;}else{Y=false;return false;}}}return true;});if(!Y){Z=M.cubeRefreshType.dummy;}if(Z!==null&&Z!==a){b.model.set("refreshType",Z);}},updatePublishStatus:function(Y){if(Y&&Y.name){this.set("enabled",false);}if(Y&&Y.reset){this.set("enabled",this.origEnabled);}},preBuildRendering:function T(){var Z,Y;if(this._super){this._super();}if(!this.parent.data.isAll){if(!this.eventSubs){Z={};Y=Z[this.id]={};Y.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(Z);}return ;}if(!this.eventSubs){Z={};Y=Z[this.id]={};Y.scheduleRefreshTypeChange=this.updateStatus;Y.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(Z);}this.updateStatus();},onUnRender:function U(){if(this.eventSubs){mstrApp.getRootController().detachDataChangeListeners(this.eventSubs);this.eventSubs=null;}if(this._super){this._super();}},premousedown:function W(Y){if(this.enabled){mstrmojo.Pulldown.prototype.premousedown.call(this,Y);}},onvalueChange:function(){var l=H.find(this.items,this.itemIdField,this.value),f=mstrApp.getRootController(),h=f.getScheduleController(),e,j,m,d=this.parent.data,a,g=this.parent,k=[],Y=[],c=g.dataGrid.parent.hasIRR,b=g.dataGrid.parent.model.operationMode;if(l<0){return ;}m={failure:function Z(n){f.displayError(mstrmojo.desc(13054,"Cannot edit source table."),false,(n&&n.message)||"");}};e=this.items[this.selectedIndex].dssid;if(d.isAll){a=d.model.refreshType;if(e===a){return ;}d.model.refreshType=e;if(e===M.cubeRefreshType.dummy){return ;}H.forEach(g.dataGrid.items,function(n){if(!n.isAll&&n.refreshType!==e){if(n.checked){k.push(n.tableID);Y.push(e.toString());}n.set("refreshType",e);}});if(b===M.operationMode.subscribe&&k.length>0&&c){h.editEmmaIRRSourceTableRefreshTypes(k,Y,null,m);}return ;}a=d.refreshType;if(e===a){return ;}d.refreshType=e;f.raiseModelEvent({name:"scheduleRefreshTypeChange"});if(!(c&&d.checked&&a!==e)){return ;}j=d.tableID;h.editEmmaIRRSourceTableURL(j,e.toString(),null,null,m);},bindings:{value:function(){return this.parent.data.isAll?this.parent.data.model.refreshType:this.parent.data.refreshType;}}},{scriptClass:"mstrmojo.Label",colWidth:"100",visible:false,bindings:{text:function(){var Y="";var Z=this.parent.data.xdaType;switch(Z){case M.xdaType.excel:case M.xdaType.text:Y=mstrmojo.desc(13056,"No scheduling support for local files");break;}return Y;}}}],preBuildRendering:function(){this.set("selected",this.children[0]);if(this._super){this._super();}}}});}if(O){N.push({headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-header sourceFilter cf",preBuildRendering:function(){var Z=this.dataGrid.parent.model,Y=false;C.forEach(Z.isFilterInTable,function(a){if(a){Y=true;return false;}});if(Y){this.children[0].set("text",mstrmojo.desc(13275,"Edit Refresh Filter"));}else{this.children[0].set("text",mstrmojo.desc(13276,"Set Refresh Filter"));}this.children[1].set("visible",Y);},children:[{scriptClass:"mstrmojo.Label",cssClass:"filterLink",onclick:function(){F.call(this,this.parent.dataGrid.parent.model);}},{scriptClass:"mstrmojo.Button",cssClass:"deleteFilter",onclick:function(){var Y=this.parent.dataGrid,Z=Y.parent.model;Z.filter="";mstrApp.getRootController().getScheduleController().setEmmaIRRFilter(mstrmojo.fe.FilterUtils.getExprXml(""),{success:function a(){Z.updateFilterUsedInTable();Y.refresh();},failure:function(b){mstrApp.getRootController().displayError(D(13099,"Failed to set refresh filter."),false,(b&&b.message)||"");}});}}]},dataWidget:{scriptClass:"mstrmojo.StackContainer",cssClass:"tablestatus-col sourceFilterBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"sourceFilterButton",visible:false,bindings:{enabled:function(){var Y=this.parent.data;return Y.model&&Y.model.IRRAttributes&&Y.model.IRRAttributes.length>0;}},text:D(12400,"Set Filter"),onclick:function(){F.call(this,this.parent.data.model);}},{scriptClass:"mstrmojo.Label",cssClass:"sourceFilterLabel",visible:false,bindings:{text:function(){var a,Z=this.parent.data,Y=this.parent.dataGrid.parent.model;if(Z.xdaType===M.xdaType.qbSingleTable){a=(Y.isFilterInTable&&Y.isFilterInTable[Z.tableID])?D(14215,"Set"):D(12402,"Not Set");}else{a="";}return a;}}}],preBuildRendering:function(){var Y;if(this.data.isAll){Y=this.children[0];}else{Y=this.children[1];}this.set("selected",Y);if(this._super){this._super();}}}});}if(R){N.push({headerText:D(12401,"Alternate Source"),headerCss:"tablestatus-header alternateSource",dataWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-col alternateSourceBox cf",preBuildRendering:function(){this.update();},update:function(){var c=this.data,a=c.canSetAlternateSource(),Z,b=c.alternateSource,Y=this.children[0];this.set("visible",a);if(b){Z=mstrmojo.desc(13277,"Edit Source");Y.set("title",b.tableName);}else{Z=mstrmojo.desc(12393,"Set Source");Y.set("title","");}Y.set("text",Z);this.children[1].set("visible",!!b);},children:[{scriptClass:"mstrmojo.Label",cssClass:"tablestatus-col alternateSource active",onclick:function(){var Y=this.parent.data;if(!(Y.checked&&mstrApp.getRootController().getScheduleController().isAdvMode())){return ;}B.call(this,Y.tableID);}},{scriptClass:"mstrmojo.Button",cssClass:"deleteAltersource",onclick:function(){var Z=this.parent,Y=this.parent.data.tableID,a={success:function(){Z.data.alternateSource=null;Z.update();},failure:function(b){mstrApp.getRootController().displayError(D(12394,"Cannot delete alternate source."),false,(b&&b.message)||"");}};mstrApp.rootController.getScheduleController().editEmmaIRRSourceTableSingleTable(Y,null,"1",null,null,null,a);}}]}});}if(this.hasRendered){this.unrender();this.columns=N;this.render();}else{this.columns=N;}}}]});mstrmojo.DI.DITableStatusList.OneTierFiles=function(O){var N=mstrmojo.all[mstrmojo.DI.DITableStatusList.selectedUploader];N.replaceOneTierFile(O);};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.ListMapperHoriz","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo.TristateCheckBox","mstrmojo.Pulldown","mstrmojo.ACL.UserTreeBrowser","mstrmojo.DataGrid","mstrmojo.DropDownButton","mstrmojo.ListBox","mstrmojo.DivItemRenderer","mstrmojo.VBox","mstrmojo.Box","mstrmojo.ACL.UserInputBox","mstrmojo.Editor","mstrmojo.ACL.UserDataService","mstrmojo.StackContainer","mstrmojo.fe.FilterUtils","mstrmojo.fe.FilterEditor");mstrmojo.requiresDescs(218,219,221,308,505,531,629,767,922,959,1088,1442,1825,2056,2102,2140,2156,3336,5657,8078,8079,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,9048,9149,9151,12085,12299,12436,12905,13082);var Enum_RIGHT_FLAGS=[1,4,8,16,32,64,128],Enum_RIGHT_DESC=[mstrmojo.desc(1825,"Browse"),mstrmojo.desc(8078,"Read"),mstrmojo.desc(8079,"Write"),mstrmojo.desc(629,"Delete"),mstrmojo.desc(8080,"Control"),mstrmojo.desc(8081,"Use"),mstrmojo.desc(8082,"Execute")],Enum_RIGHT_DESC_SHORT=["B","R","W","D","C","U","E"],$EMMA_CUBE_FILTER_EDITOR_ID="emmacubeSFE",$USER_LOGIN_ID="93B9A8EB46D9C6A4ADA5FEBAB092A7CF",$ARR=mstrmojo.array,$EXPR=mstrmojo.expr,$ET=$EXPR.ET,$ANGLES=mstrmojo.string.htmlAngles,$GET_EXPRESSION_XML=mstrmojo.fe.FilterUtils.getExprXml,$DISABLED_TOOLTIP=mstrmojo.desc(12905,"Security rules cannot be defined/updated for metric only datasets."),$SPACE_TEXT=" ",$LEFT_CURLY_PARENTHESIS_TEXT="{",$RIGHT_CURLY_PARENTHESIS_TEXT="}",$LEFT_PARENTHESIS_TEXT="(",$RIGHT_PARENTHESIS_TEXT=")",$BETWEEN_TEXT=mstrmojo.desc(308,"and");function getNodeExpression(node){var result=[],constantCount,temp,constants,constant0,constant1,value;if(node&&node.a&&node.a.n){result.push($ANGLES(node.a.n));if(node.fm&&node.fm.n){result.push($LEFT_PARENTHESIS_TEXT+$ANGLES(node.fm.n)+$RIGHT_PARENTHESIS_TEXT);if(node.fn!==undefined){result.push($ANGLES($EXPR.fnName(node.et,node.fn,node.fnt,node.fm.dtp)));constantCount=$EXPR.fnCstCount(node.fn,node.fnt);if(node.et===$ET.AC){if(constantCount>=1){if(node.a2&&node.a2.n){result.push($ANGLES(node.a2.n));if(node.fm2&&node.fm2.n){result.push($LEFT_PARENTHESIS_TEXT+$ANGLES(node.fm2.n)+$RIGHT_PARENTHESIS_TEXT);}}if(constantCount>1){result.push($BETWEEN_TEXT);if(node.a3&&node.a3.n){result.push($ANGLES(node.a3.n));if(node.fm3&&node.fm3.n){result.push($ANGLES(node.fm3.n));}}}}}else{if(node.et===$ET.AL){temp=[];$ARR.forEach(node.cs,function(item){temp.push(item.v);});result.push(temp.join(mstrConfig.listSep||$SPACE_TEXT));}else{if(constantCount>=1){constants=node.cs;constant0=constants&&constants[0];value=constant0&&constant0.p&&constant0.p.n;result.push(value?($LEFT_CURLY_PARENTHESIS_TEXT+$ANGLES(value)+$RIGHT_CURLY_PARENTHESIS_TEXT):$ANGLES(constant0&&constant0.v));if(constantCount>1){constant1=constants&&constants[1];result.push($BETWEEN_TEXT);value=constant1&&constant1.p&&constant1.p.n;result.push(value?($LEFT_CURLY_PARENTHESIS_TEXT+$ANGLES(value)+$RIGHT_CURLY_PARENTHESIS_TEXT):$ANGLES(constant1&&constant1.v));}}}}}}}return $LEFT_PARENTHESIS_TEXT+result.join($SPACE_TEXT)+$RIGHT_PARENTHESIS_TEXT;}function getFilterText(node){var result=[];if(!node){return"";}if(node.nds){$ARR.forEach(node.nds,function(item){result.push(getNodeExpression(item));});}else{return getNodeExpression(node);}return result.join($SPACE_TEXT+$EXPR.BRANCH_FNS[node.fn]+$SPACE_TEXT);}function saveSecurityFilters(){var objectInfo=this.oi,editor=this,filters=[];mstrmojo.array.forEach(objectInfo.acls,function(item){if(item.isDirty){filters.push({uid:item.did,fg:item.fg,exp:$GET_EXPRESSION_XML(item.filter)});}});mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function success(res){if(editor.postSaveACL){editor.postSaveACL(true);}editor.close();},failure:function failure(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{taskId:"DISetCubeSecurityFilter",cubeid:objectInfo.did,filter:JSON.stringify(filters)});}function openSecurityFilterEditor(dataInfo){var dataGrid=this.dataGrid,showEditor=function showEditor(data,filter){var filterModel={expr:filter,hasPrompt:true,targets:data.concat({n:"User Login",t:$EXPR.TP.PROMPT,did:$USER_LOGIN_ID,st:$EXPR.STP.PROMPT_STRING})},fnOnSaveFilter=function fnOnSaveFilter(filterModel){var expression=filterModel.expr;dataInfo.isDirty=true;dataInfo.filter=expression;dataGrid.set("items",dataGrid.items.slice(0));},editor,disableElementBrowsing=function disableElementBrowsing(){return true;};editor=window.mstrmojo&&mstrmojo.all[$EMMA_CUBE_FILTER_EDITOR_ID]||mstrmojo.insert({id:$EMMA_CUBE_FILTER_EDITOR_ID,scriptClass:"mstrmojo.fe.FilterEditor",skipAndOrPopup:true,showLimits:false,cssClass:"mstrmojo-charcoalboxe mstrmojo-FE mstrmojo-SecurityFilter-editor"});editor.validExprTypes=$ARR.hash([mstrmojo.expr.ET.AQ,mstrmojo.expr.ET.AC]);editor.set("title",mstrmojo.desc(12085,"Select a filter"));editor.set("onSave",fnOnSaveFilter);editor.set("model",filterModel);editor.set("disableElementsBrowsing",disableElementBrowsing);editor.open(null,{zIndex:dataGrid.parent.zIndex+10||10});};showEditor(this.parent.dataGrid.parent.candidates,dataInfo.filter||"");}function showPopMenu(dataInfo,target){var $this=this,dataGrid=this.dataGrid,menuHelper=this.menuHelper=this.menuHelper||new mstrmojo.MenuButton({cm:[{n:mstrmojo.desc(1088,"Edit"),did:"Edit"},{n:mstrmojo.desc(629,"Delete"),did:"Delete"}],cmCssClass:"di-sf-cxt-menu",getMenuPosition:function getMenuPosition(){var pos=mstrmojo.dom.position(target,true);return{x:Math.round(pos.x),y:Math.round(pos.y+pos.h)};},executeCommand:function(item){switch(item.did){case"Edit":openSecurityFilterEditor.call($this,dataInfo);break;case"Delete":dataInfo.isDirty=true;dataInfo.filter=null;dataGrid.set("items",dataGrid.items.slice(0));break;}}});menuHelper.set("zIndex",dataGrid.parent.zIndex+10);menuHelper.showContextMenu();}function _getACLHint(r){var h=[],d=Math.floor(r/1000),g=r%1000,rf=Enum_RIGHT_FLAGS,rd=Enum_RIGHT_DESC,len=rf.length,s,i;for(i=0;i<len;i++){h.push(rd[i]);h.push(" ");if((g&rf[i])>0){h.push(mstrmojo.desc(8083,"Granted"));}else{if((d&rf[i])>0){h.push(mstrmojo.desc(8084,"Denied"));}else{h.push(mstrmojo.desc(959,"Default"));}}h.push(",");}s=h.join("");return s.substring(s,s.length-1);}function _getACLLabel(r){var h=[],g=r%1000,rf=Enum_RIGHT_FLAGS,rd=Enum_RIGHT_DESC_SHORT,len=rf.length,s,i;for(i=0;i<len;i++){if((g&rf[i])>0){h.push(rd[i]);h.push(",");}}s=h.join("");return s.substring(s,s.length-1);}function _fixACL(v){return{"253000":255000,"253":255,"221":223,"197":199,"69":71}[v]||v;}function _fixACLTwoStates(v){return{"253000":255000,"253":255,"32221":223,"56197":199}[v]||v;}function _updatePulldown(w,v){var its=w.items,idx=mstrmojo.array.find(its,w.itemIdField,v),iWas=w.customItem,iIdx=its.length-2;if(idx===-1){var iNew={n:_getACLLabel(v),rgt:v};if(iWas){its.splice(iIdx,1);}iIdx=its.length-1;its.splice(iIdx,0,iNew);w.customItem=iNew;}else{if(iWas&&idx!==iIdx){its.splice(iIdx,1);w.customItem=null;}}w.set("title",_getACLHint(v));w.value=v;}function _getCategoriesByType(t){return{"776":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}],"779":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}]}[t]||[{n:mstrmojo.desc(8090,"View"),rgt:199},{n:mstrmojo.desc(767,"Modify"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8092,"Custom Permission Level"),rgt:-1}];}function _isFolder(oi){return(oi&&oi.t===8);}function _postProcessACLs(oi){var acls=oi.acls,inhs=oi.inhs,exAcls=[],acl,g,rgt,i,len;if(_isFolder(oi)){acls=acls.concat(mstrmojo.hash.valarray(inhs));}for(i=0,len=acls.length;i<len;i++){acl=acls[i];rgt=acl.rgt;if(rgt>1000){g=mstrmojo.hash.copy(acl);g.den=true;g.rgt=Math.floor(rgt/1000);exAcls.push(g);}if((rgt%1000)>0){g=mstrmojo.hash.copy(acl);g.den=false;g.rgt=rgt%1000;exAcls.push(g);}}oi.acls=exAcls;return oi;}function _getSaveXML(oi){var cfg={isSerializable:function(nodeName,jsons,idx){switch(nodeName){case"did":case"rgt":case"n":case"acls":case"t":case"st":case"inh":case"den":return true;}return false;},getArrItemName:function(n,v,i){if(n==="acls"){return"acl";}},convertBoolean:true};return mstrmojo.string.json2xml("oi",oi,cfg);}function _saveACL(e,isToClose){var oi=e&&e.oi,xml;if(oi){oi=_postProcessACLs(oi);xml=_getSaveXML(oi);var params={taskId:"saveObjectACL",objectXML:xml,objectType:oi.t,objectID:oi.did};mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(res){if(isToClose){if(e.postSaveACL){e.postSaveACL(true);}e.close();}},failure:function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));if(isToClose){if(e.postSaveACL){e.postSaveACL(false);}e.close();}}},params);}}function _addACL(e){var acl=e.aclList,ci=e.objectInputer,pd=e.rightPulldown,its=ci.getSelectedObjects(),len=its.length,added=[],it,rgt=pd.value,i,idx,ace;if(!ci.isValid()){mstrmojo.alert(mstrmojo.desc(9048,"Some users/groups do not exist. Please remove them in order to proceed."),null,e.alertTitle);return false;}for(i=0;i<len;i++){it=its[i];idx=mstrmojo.array.find(acl.items,"did",it.did);if(idx!==-1){ace=acl.items[idx];if(e.uneditableRights[ace.rgt]){continue;}}added.push(new mstrmojo.Obj({n:it.n,did:it.did,st:it.st,rgt:rgt,filter:"",fg:1,newItem:true}));}if(added.length>0){var count=0;mstrmojo.array.forEach(added,function(item){mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function success(res){var userInfo=res.oi.gsfsr.u,current;if(userInfo.mi){current=added[count];current.partial=userInfo.partial_type;current.fg=userInfo.partial_type||3;current.filter=mstrmojo.DI.ui.dialogs.DIPermissionDialog.buildWalk(userInfo.mi.exp.nd,[].concat(userInfo.mi["in"].oi),e.formTypes);current.filterText=userInfo.mi.exp.content;}count++;if(count===added.length){acl.add(added);e.set("hasChanged",true);}}},{taskId:"DIGetCubeSecurityFilter",uid:item.did,cubeid:e.cubeid});});var ret=mstrmojo.array.findMulti(acl.items,"did",added);if(ret.count){var idxs=ret.indices.concat().sort(mstrmojo.array.numSorter).slice(0,ret.count);for(i=idxs.length-1;i>-1;i--){acl.remove(idxs[i]);}}}ci.set("items",[]);e.set("inEditMode",false);return true;}mstrmojo.DI.ui.dialogs.DIPermissionDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIPermissionDialog",cssClass:"mstrmojo-di-permissions",zIndex:10,inEditMode:false,hasChanged:false,showButtonText:true,showObjectNameOnTitle:true,uneditableRights:{},defaultRight:223,viewOnlyMode:false,title:mstrmojo.desc(13082,"Permissions"),userSelectorTitle:mstrmojo.desc(8091,"User/User Group Browser"),formTypes:{},userSelector:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-UserEditor",help:"user_group_browser.htm",onClose:function(){this.userBrowser.clearTreeSelect();},children:[{scriptClass:"mstrmojo.ACL.UserTreeBrowser",alias:"userBrowser",anim:true,selectionAcrossBranch:true,multiSelect:true},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(evt){var ue=this.parent.parent,e=ue.opener,ci=e.objectInputer,ub=ue.userBrowser,sls=ub.getTotalSelections();if(sls&&sls.length>0){ci.add(sls,ci.items.length-1);e.set("inEditMode",true);}ue.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(evt){this.parent.parent.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}}]}],onOpen:function(){this.set("title",this.opener.userSelectorTitle);}},customACL:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(8092,"Custom Permission Level"),cssClass:"mstrmojo-CustomACLEditor",help:"Custom_Permission_Level_dialog_box.htm",onOpen:function(){var rgt=this.rgt,d=Math.floor(rgt/1000),g=rgt%1000,chs=this.children,ch,r,i,len;for(i=0,len=chs.length;i<len;i++){ch=chs[i];r=ch.right;if(this.twoStates){ch.set("grayed",false);ch.set("checked",false);}else{ch.set("grayed",true);ch.set("checked",true);}if((d&r)>0){ch.set("checked",false);ch.set("grayed",false);}if((g&r)>0){ch.set("checked",true);ch.set("grayed",false);}}},getACLValue:function(){var g=0,d=0,chs=this.children,ch,i,len;for(i=0,len=chs.length;i<len;i++){ch=chs[i];if(ch.grayed||!ch.right){continue;}if(ch.checked){g+=ch.right;}else{d+=ch.right;}}return d*1000+g;},children:[{scriptClass:"mstrmojo.TristateCheckBox",alias:"browse",right:1,text:mstrmojo.desc(1825,"Browse")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"read",right:4,text:mstrmojo.desc(8078,"Read")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"write",right:8,text:mstrmojo.desc(8079,"Write")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"delete",right:16,text:mstrmojo.desc(629,"Delete")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"control",right:32,text:mstrmojo.desc(8080,"Control")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"use",right:64,text:mstrmojo.desc(8081,"Use")},{scriptClass:"mstrmojo.TristateCheckBox",alias:"execute",right:128,text:mstrmojo.desc(8082,"Execute")},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(evt){var e=this.parent.parent;if(e.onOK){e.onOK();}e.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(221,"Cancel"),onclick:function(evt){var e=this.parent.parent;if(e.onCancel){e.onCancel();}e.close();}}]}]},_set_oi:function(n,v){this.oi=this.preProcessACLs(v);return true;},postCreate:function(){this.oi=this.preProcessACLs(this.oi);},preProcessACLs:function(oi){var acls=oi.acls,len=acls&&acls.length,isF=_isFolder(oi),aclMap={},acl,r,inhs,i;if(isF){inhs={};oi.inhs=inhs;}for(i=0;i<len;i++){acl=new mstrmojo.Obj(acls[i]);if(isF&&acl.inh){inhs[acl.did]=mstrmojo.hash.copy(acl);continue;}r=aclMap[acl.did];if(!r){r=mstrmojo.hash.copy(acl);r.rgt=0;delete r.den;aclMap[acl.did]=r;}r.rgt+=acl.den?acl.rgt*1000:acl.rgt;}acls=mstrmojo.hash.valarray(aclMap);oi.acls=acls;return oi;},postSaveACL:function(){},getAvailableRightsForDisplay:function(){return _getCategoriesByType(this.oi.st);},getAvailableRightsForSelection:function(){return _getCategoriesByType(this.oi.st);},onOpen:function(){delete mstrmojo.all[$EMMA_CUBE_FILTER_EDITOR_ID];var pd=this.rightPulldown;pd.set("items",this.getAvailableRightsForSelection());pd.set("value",this.defaultRight);var ci=this.objectInputer,us=this.userSelector,ub=us&&us.userBrowser;ci.zIndex=this.zIndex+1||11;if(ub&&ub.hasRendered){ub.set("items",[]);ub.getContent(ub);}var DS=mstrmojo.ACL.UserDataService,INITIAL_USERS_COUNT=200,success=function(candidates){ci.set("candidates",candidates);},failure=function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));},callbacks={success:success,failure:failure};DS.getUserCandidates(INITIAL_USERS_COUNT,callbacks);this.set("inEditMode",false);this.set("hasChanged",false);},onClose:function(){var ci=this.objectInputer;ci.set("items",[]);this.aclList.clearSelect();this.destroy();},oninEditModeChange:function(){var e=this;if(e.inEditMode){mstrmojo.css.removeClass(e.objectInputer.domNode,"small");}else{mstrmojo.css.addClass(e.objectInputer.domNode,"small");}},children:[{scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-ACLEditor-ACLList",cssText:"width: 100%",alias:"aclList",renderOnScroll:false,makeObservable:true,itemDisplayField:"n",dropZone:true,bindings:{items:"this.parent.oi.acls"},sortCol:"",sortAsc:new mstrmojo.Obj({n:true,rgt:true}),sort:function(prop,asc){var sortFunc=function mySort(p,s){return function(a,b){var aProp=eval("a."+p),bProp=eval("b."+p),r=aProp>bProp;if(aProp===bProp){return 0;}if(s===r){return 1;}return -1;};};if(this.items){this.items.sort(sortFunc(prop,asc));this.render();}},onremove:function(evt){var oi=this.parent.oi;if(!_isFolder(oi)){return ;}var inhs=oi.inhs,its=evt.value,len=its&&its.length,did,i;for(i=0;i<len;i++){did=its[i].did;delete inhs[did];}},onadd:function(evt){var oi=this.parent.oi;if(!_isFolder(oi)){return ;}var inhs=oi.inhs,its=evt.value,len=its&&its.length,did,i;for(i=0;i<len;i++){did=its[i].did;inhs[did]=mstrmojo.hash.copy(its[i]);inhs[did].inh=true;}},onACLChanged:function(d){var oi=this.parent.oi;this.parent.set("hasChanged",true);if(!_isFolder(oi)){return ;}oi.inhs[d.did]=mstrmojo.hash.copy(d);oi.inhs[d.did].inh=true;},postCreate:function postCreate(){this.columns=[{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5657,"User/Group"),onclick:function(){var asc=!(this.dataGrid.sortAsc.n);this.dataGrid.set("sortCol","n");this.dataGrid.sortAsc.set("n",asc);this.dataGrid.sort("n",asc);},postCreate:function(){if(this.dataGrid.sortCol==="n"){this.set("cssClass",(this.dataGrid.sortAsc.n)?"mstrmojo-sortAsc":"mstrmojo-sortDesc");}}},dataFunction:function(item,idx,w){return'<div class="mstrmojo-ACLEditor-user '+(item.st===8705?"ug":"u")+'">'+mstrmojo.string.encodeHtmlString(item.n)+"</div>";},colCss:"userCol"},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9149,"Access"),onclick:function(){var asc=!(this.dataGrid.sortAsc.rgt);this.dataGrid.set("sortCol","rgt");this.dataGrid.sortAsc.set("rgt",asc);this.dataGrid.sort("rgt",asc);},postCreate:function(){if(this.dataGrid.sortCol==="rgt"){this.set("cssClass",(this.dataGrid.sortAsc.rgt)?"mstrmojo-sortAsc":"mstrmojo-sortDesc");}}},colCss:"rgtCol",dataWidget:{scriptClass:"mstrmojo.MouseOverContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"access-label",bindings:{text:function(){var access=this.parent.dataGrid.parent.getAvailableRightsForDisplay(),len=access.length,i;for(i=0;i<len;i++){if(access[i].rgt===this.parent.data.rgt){return access[i].n;}}return mstrmojo.desc(2056,"Custom");}}},{scriptClass:"mstrmojo.HBox",visible:false,children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"rgt",popupToBody:true,selectionPolicy:"reselect",defaultSelection:0,postCreate:function(){this.markupMethods=mstrmojo.hash.copy({ondataChange:function(){var d=this.parent.parent.data;this.set("value",d[this.itemIdField]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(!this.visible&&this.popupRef){this.popupRef.set("visible",false);}}},mstrmojo.hash.copy(this.markupMethods));this.items=this.parent.parent.dataGrid.parent.getAvailableRightsForSelection();},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){if(v===-1){var e=this.parent.parent.dataGrid.parent,me=this;e.openPopup("customACL",{zIndex:e.zIndex+10,rgt:vWas,twoStates:!!this.parent.parent.data.newItem,onOK:function(){me.set("value",this.getACLValue());},onCancel:function(){me.set("value",vWas);}});return false;}v=_fixACL(v);_updatePulldown(this,v);this.parent.parent.data.set(this.itemIdField,v);if(vWas!==null){this.parent.parent.dataGrid.onACLChanged(this.parent.parent.data);}return true;}return true;}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(evt){var me=this,fnOk=function(){var dg=me.parent.parent.dataGrid;dg.remove(me.parent.parent.data);dg.parent.set("hasChanged",true);};mstrmojo.confirm(mstrmojo.desc(12299,"Are you sure you want to delete the user/user group #?").replace("#",this.parent.parent.data.n),{confirmBtn:{fn:fnOk}},{zIndex:9999});}}]}],postCreate:function(){var doSwitch=!this.dataGrid.parent.viewOnlyMode&&!this.dataGrid.parent.uneditableRights[this.data.rgt];this.set("doSwitch",doSwitch);}}}];if(this.parent.oi.canEdit){this.columns.push({headerText:mstrmojo.desc(12436,"Data Security"),headerCss:"di-security-header",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"security-filter-col",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click><span class="di-sf-icon"></span><span class="di-sf-n"></span><span class="di-sf-mn"></span></div>',markupMethods:{ontitleChange:function(){this.domNode.title=this.title;},ontextChange:function(){this.domNode.children[1].innerHTML=this.text||"";},oncssTextChange:mstrmojo.Widget.cssTextMarkupMethod,onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod},onclick:function(evt){var target=evt.target||mstrmojo.dom.eventTarget(evt.hWin,evt.e);if(target.className.indexOf("di-sf-mn")>-1){showPopMenu.call(this,this.parent.data,target);}else{if(!this.parent.data.filter){openSecurityFilterEditor.call(this,this.parent.data);}}},onRender:function onrender(){var data=this.parent.data;if(this.domNode){if(data.noElement){mstrmojo.css.toggleClass(this.domNode,"noEdit",true);this.domNode.title="Security rules cannot be defined/updated for metric only datasets.";}else{mstrmojo.css.toggleClass(this.domNode,"update",!!data.filter);}}},bindings:{text:function(){var data=this.parent.data;return data.filter?mstrmojo.desc(505,"Update"):mstrmojo.desc(922,"Add...");}}}});}}},{scriptClass:"mstrmojo.HBox",cssClass:"di-permission-MorePanel",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2156,"Add")+":",cssClass:"di-permission-addLabel"},{scriptClass:"mstrmojo.ACL.UserInputBox",emptyText:mstrmojo.desc(9151,"Type users or groups here."),cssClass:"mstrmojo-ObjectInputBox mstrmojo-ACLEditor-inputBox small",noCache:true,onRender:function(){var e=this.parent.parent;if(e){e.objectInputer=this;}},postBuildDom:function(){var me=this;this._clickHandler=function(evt){me.parent.parent.set("inEditMode",true);};mstrmojo.dom.attachEvent(this.domNode,"click",this._clickHandler);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",onclick:function(evt){var e=this.parent.parent;e.openPopup("userSelector",{zIndex:e.zIndex+10});},text:"..."},{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"rgt",value:-1,defaultSelection:0,selectionPolicy:"reselect",onRender:function(){var e=this.parent.parent;if(e){e.rightPulldown=this;}},postCreate:function(){this.items=this.parent.parent.getAvailableRightsForSelection();},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){if(v===-1){var e=this.parent.parent,me=this;e.openPopup("customACL",{zIndex:e.zIndex+10,rgt:vWas,twoStates:true,onOK:function(){me.set("value",this.getACLValue());},onCancel:function(){me.set("value",vWas);}});return false;}v=_fixACLTwoStates(v);_updatePulldown(this,v);return true;}return true;},bindings:{visible:"this.parent.parent.inEditMode"}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",onclick:function(){var e=this.parent.parent;_addACL(e);},text:mstrmojo.desc(2156,"Add"),bindings:{visible:"this.parent.parent.inEditMode"}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),bindings:{enabled:function(){var oi=this.parent.parent.oi;return(oi.acg&32)>0;},visible:"!this.parent.parent.viewOnlyMode"},onclick:function(evt){var e=this.parent.parent;if(_addACL(e)){_saveACL(e,true);}saveSecurityFilters.call(this.parent.parent);},preBuildRendering:function(){if(!this.parent.parent.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",onclick:function(evt){if(!this.parent.parent.inEditMode){this.parent.parent.close();this.parent.parent.set("hasChanged",false);}this.parent.parent.objectInputer.set("items",[]);this.parent.parent.set("inEditMode",false);},bindings:{iconClass:function(){if(this.parent.parent.inEditMode||this.parent.parent.hasChanged){return"mstrmojo-Editor-button-Cancel";}return"mstrmojo-Editor-button-Close";},text:function(){if(!this.parent.parent.showButtonText){return"";}if(this.parent.parent.inEditMode||this.parent.parent.hasChanged){return mstrmojo.desc(2140,"Cancel");}return mstrmojo.desc(2102,"Close");}}}]}]});mstrmojo.MouseOverContainer=mstrmojo.declare(mstrmojo.StackContainer,null,{scriptClass:"mstrmojo.MouseOverContainer",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout></div>',doSwitch:true,markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onmouseover:function(){if(this.doSwitch){this.set("selected",this.children[1]);}},onmouseout:function(){if(this.doSwitch){this.set("selected",this.children[0]);}},preBuildRendering:function(){this.set("selected",this.children[0]);}});$ENUM_DataType={Char:8,Date:14,Time:15,TimeStamp:16,BigDecimal:30,Int64:34};$PERMISSION_DIALOG=mstrmojo.DI.ui.dialogs.DIPermissionDialog;$PERMISSION_DIALOG.buildWalk=function buildWalk(node,objectInfos,formDataTypes){var result,attributeTagName,formTagName,prompt,attribute,form,attributeId,formId,formDTMapping={1:$ENUM_DataType.TimeStamp,8:$ENUM_DataType.Date,9:$ENUM_DataType.Time,2:$ENUM_DataType.Int64,3:$ENUM_DataType.Char,11:$ENUM_DataType.BigDecimal,};if(node===undefined){return null;}if(node.op&&node.op.fnt===mstrmojo.expr.FN.AND){if(Object.prototype.toString.call(node.nd)==="[object Array]"){result={fn:node.op.fnt,et:node.et,nds:[]};$ARR.forEach(node.nd,function(item){result.nds.push(buildWalk(item,objectInfos,formDataTypes));});}else{if(!node.nd){return null;}result=buildWalk(node.nd,objectInfos,formDataTypes);}}else{result={fn:node.op.fnt,et:node.et};$ARR.forEach($ARR.ensureArray(node.nd),function(item){if(item.at){attributeTagName=result.a?"a2":"a";formTagName=result.fm?"fm2":"fm";attribute=item.at.mi["in"].oi[0];attributeId=attribute.did;form=item.fm.mi["in"].oi[0];formId=form.did;result[attributeTagName]={did:attributeId,n:attribute.n,t:attribute.tp};result[formTagName]={did:formId,n:form.n,t:form.tp,dtp:formDTMapping[formDataTypes[attributeId+formId]]||$ENUM_DataType.Char,ibf:true,idf:true,itf:true};}else{if(item.cst){if(item.prompt_instances){prompt=objectInfos[item.prompt_instances.prompt_instance.pin];result.cs=[{p:{did:prompt.did,n:prompt.n,st:prompt.stp,t:prompt.tp}}];}else{result.cs=result.cs||[];result.cs.push({v:item.cst.content,dtp:item.ddt});}}else{if(item.content!==undefined){result.cs=result.cs||[];result.cs.push({v:item.content,dtp:item.ddt});}}}});}return result;};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.DataGrid","mstrmojo.Table","mstrmojo.HBox","mstrmojo.form","mstrmojo.MenuButton","mstrmojo.date","mstrmojo.DI.DIConstants","mstrmojo.DI.DIExitOptions","mstrmojo.ui.menus.Menu","mstrmojo.ui.menus.MenuConfig","mstrmojo.DI.ui.dialogs.DIPermissionDialog","mstrmojo.locales","mstrmojo.date","mstrmojo.css","mstrmojo.expr");mstrmojo.requiresDescs(60,172,239,767,1085,1088,1279,3610,7559,9099,9101,9242,10216,10380,12855,13042,13043,13044,13045,13046,13047,13127,9252,13241,773,8733,1388,14055,14056,14452,14453,14454);var J=mstrmojo.array,Q=mstrmojo.css,I=mstrmojo.DI.DIExitOptions,E=mstrmojo.dom,A=mstrmojo.string,K=mstrmojo.expr,N=K.STP,S=mstrmojo.DI.DIConstants;var H="highlight",L={TYPE:"type",NAME:"n",SIZE:"sz",DATE:"dt",SCHEDULE:"sched"};function F(V){var U=V.canEdit,c,W={};J.forEach(V.mapping.datap,function f(k){J.forEach(k.maps&&k.maps.amps,function j(l){c=l.aimp.atid;J.forEach(l.afmps,function m(n){W[c+n.fmid]=n.bft;});});});V=V.oi.gsfsr;var d=[].concat(V.mi["in"].oi),b=d[0],Y={ab:b.ab,acg:b.acg,desc:b.des,did:b.did,n:b.n,own:b.ow.content,st:b.stp,t:b.tp},a=[],Z=[].concat(V.mi.acl.ace),X,g,h,T;Y.canEdit=U;if(!V.mi.acl||V.u===undefined){Y.acls=[];return Y;}T=[].concat(V.u);J.forEach(Z,function e(j){X=d[J.find(d,"id",j.trustee)];h={den:!!j.deny,did:X.did,inh:!!j.inheritable,n:X.n,rgt:j.rights,st:X.stp};g=T[J.find(T,"uid",X.did)];if(g.mi){h.partial=g.partial_type;h.fg=g.partial_type||3;h.filter=mstrmojo.DI.ui.dialogs.DIPermissionDialog.buildWalk(g.mi.exp.nd,[].concat(g.mi["in"].oi),W);h.filterText=g.mi.exp.content;}else{h.filter="";h.filterText="";h.fg=1;}a.push(h);});Y.acls=a;Y.formTypes=W;return Y;}mstrmojo.DI.CubeListCubeMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.CubeListCubeMenu",menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-cubeListCubeMenu",data:null,cubeID:null,cubeName:null,subs:null,handleRepublish:function(T){mstrApp.fromCubesList=true;mstrApp.getRootController().resetAppforRepublish(T.ctxt);},handleEdit:function(U){var T=U.ctxt;mstrApp.getRootController().closeDialog(S.dialogType.cubesList);mstrApp.restart({ReportId:T.cubeID,CubeName:T.cubeName,StatusCode:S.statusCode.edit,AnalysisId:undefined,datasets:null});},handleShare:function(W){var T=W.ctxt,V=T.cubeID,X=[],a="mstrACL",U=function(c){var b=mstrmojo.all[a];if(!b){b=new mstrmojo.DI.ui.dialogs.DIPermissionDialog({id:a,oi:c,cubeid:V,candidates:X});}else{b.set("oi",c);b.cubeid=V;b.candidates=X;}b.formTypes=c.formTypes;b.open(null,{zIndex:mstrApp.getRootController().getDialogController().getNextZIndex()});};var Z=mstrApp.getRootController().getDataService();Z.getSecurityFilter({success:function Y(c){var d;J.forEach(c.mapping.datap,function b(f){J.forEach(f.maps&&f.maps.amps,function e(g){d=g.aimp;if(J.find(X,"did",d.atid)===-1){X.push({n:d.atnm,did:d.atid,t:12});}});});if(X.length===0){c.canEdit=0;}U(F(c));}},{cubeid:V,isNew:true});},handleDelete:function(U){var X={objectID:U.ctxt.cubeID,objectType:3};var T=mstrApp.getRootController();var W=mstrmojo.desc(13127,"Are you sure you want to delete the intelligent cube, ##?").replace("##",this.ctxt.cubeName);var Y={success:function(){X={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")};T.getCubeQuota({success:function(){T.getCubeQuota({success:function(){T.scheduleController.updateScheduleAndStatus();}},X);}},X);},failure:function(Z){T.displayError(Z.message||Z.getResponseHeader("X-MSTR-TaskFailureMsg"));}};var V=function(){T.deleteObject(Y,X);};T.displayWarning(W,mstrmojo.desc(3610,"Microstrategy Web"),V);},handleRename:function(T){T.ctxt.nameWidget.set("editMode",true);},handleShowInFolder:function(U){var T=mstrApp.getRootController();var V={success:function(X){if(X&&X.items&&X.items.length===1){var W=X.items[0].fid;mstrApp.redirectToPage({evt:"2001",folderID:W});}},failure:function(W){T.displayError(mstrmojo.desc(14056,"Error when getting the cube's folder id."),false,W.message);}};T.dataService.getObjectFolder(V,{dids:U.ctxt.cubeID,types:3});},handleRepublish2:function(V){var T=V.ctxt;var U={ReportId:T.cubeID,CubeName:T.cubeName,StatusCode:S.statusCode.republish};mstrApp.getRootController().getDialogController().show(S.dialogType.diPageDialog,{pageType:S.pageType.republish,diParams:U});return true;},handleAddSchedule:function(V){var T=V.ctxt;var U={ReportId:T.cubeID,CubeName:T.cubeName,StatusCode:S.statusCode.schedule};mstrApp.getRootController().getDialogController().show(S.dialogType.diPageDialog,{pageType:S.pageType.schedule,diParams:U});return true;},handleEditSubscription:function(V){var T=V.ctxt;var U={ReportId:T.contentID,CubeName:T.contentName,SubsId:T.did,SubsName:T.subsName,StatusCode:S.statusCode.schedule};mstrApp.getRootController().getDialogController().show(S.dialogType.diPageDialog,{pageType:S.pageType.schedule,diParams:U});return true;},handleDeleteSubscription:function(V){var U=V.ctxt.did;var T={success:function(){mstrApp.getRootController().getScheduleController().updateScheduleAndStatus();},failure:function(W){mstrApp.getRootController().displayError(mstrmojo.desc(12855,"Cannot remove this subscription."),false,W.message);}};mstrApp.getRootController().getScheduleController().removeSubscription([U],T);return true;},handleRefreshHistory:function(U){var T=U.ctxt.did;mstrApp.getRootController().getScheduleController().getScheduleStatus([T],{complete:function(){mstrApp.getRootController().getScheduleController().showScheduleStatusDialog(T);}});return true;},handleCreate:function(T){mstrApp.redirectToPage(I.getRedirectParams(T.ctxt.did,T.ctxt.cubeID,T.ctxt.isDDA));},getSubsMenuConfig:function(T){var V=this,U=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu subscriptionMenu"});if(mstrApp.diParams.canSubscribe){U.addMenuItem(mstrmojo.desc(767,"Modify"),"",V.handleEditSubscription,T);U.addMenuItem(mstrmojo.desc(9252,"Delete"),"",V.handleDeleteSubscription,T);}else{U.addDisabledMenuItem(mstrmojo.desc(767,"Modify"),"");U.addDisabledMenuItem(mstrmojo.desc(9252,"Delete"),"");}U.addMenuItem(mstrmojo.desc(10216,"Refresh History"),"",V.handleRefreshHistory,T);return U;},getCreateMenuConfig:function(){var U=this,T=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});T.addMenuItem(mstrmojo.desc(8042,"Create Dashboard"),"dashboard",U.handleCreate,{did:I.pageRedirect.analysis,cubeID:U.cubeID,isDDA:false});T.addMenuItem(mstrmojo.desc(2918,"Create Document"),"document",U.handleCreate,{did:I.pageRedirect.doc,cubeID:U.cubeID,isDDA:false});T.addMenuItem(mstrmojo.desc(5,"Create Report"),"report",U.handleCreate,{did:I.pageRedirect.report,cubeID:U.cubeID,isDDA:false});return T;},getCreateMenuConfigDDA:function(){var U=this,T=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});T.addMenuItem(mstrmojo.desc(8042,"Create Dashboard"),"dashboard",U.handleCreate,{did:I.pageRedirect.analysis,cubeID:U.cubeID,isDDA:true});T.addMenuItem(mstrmojo.desc(2918,"Create Document"),"document",U.handleCreate,{did:I.pageRedirect.doc,cubeID:U.cubeID,isDDA:true});return T;},getScheduleMenuConfig:function(){var U=this,T=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});if(mstrApp.diParams.canSubscribe){T.addMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add",U.handleAddSchedule,{cubeID:U.cubeID,cubeName:U.cubeName});}else{T.addDisabledMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add");}if(U.subs&&U.subs.length>0){T.addSeparator();J.forEach(U.subs,function(W){var Y="",V="subscription ",Z=W.status&&W.status.length>0&&W.status[W.status.length-1],X;if(Z){if(Z.en===0){V+="success";}else{V+="fail";X=Z.emsg;}}else{V+="empty";}if(W.subsName.indexOf(W.contentName)===0){Y="..."+W.subsName.substr(W.contentName.length);}else{Y=W.subsName;}if(Y.length>50){Y=Y.substr(0,50);}if(X){X=A.encodeHtmlString(X);Y=A.encodeHtmlString(Y);Y='<span title="'+X+'">'+Y+"</span>";}T.addSubMenuItem(Y,V,U.id,U.getSubsMenuConfig,W);});}return T;},getMenuConfig:function(){var V=this,T,U;T=new mstrmojo.ui.menus.MenuConfig({menuCssClass:V.menuCssClass});if(mstrApp.refreshMultipleCubes){U=V.data.sz?mstrmojo.desc(9242,"Republish"):mstrmojo.desc(172,"Publish");T.addMenuItem(U,"republish",V.handleRepublish2,{cubeID:V.cubeID,cubeName:V.cubeName});}else{if(V.data.type!=="Managed"){if(V.data.ddam===S.datasetServeMode.dda){T.addSubMenuItem(mstrmojo.desc(3291,"Create"),"create",V.id,V.getCreateMenuConfigDDA);}else{T.addSubMenuItem(mstrmojo.desc(3291,"Create"),"create",V.id,V.getCreateMenuConfig);}}U=V.data.sz?mstrmojo.desc(9242,"Republish"):mstrmojo.desc(172,"Publish");T.addMenuItem(U,"republish",V.handleRepublish2,{cubeID:V.cubeID,cubeName:V.cubeName});if(V.data.type!=="Managed"){T.addMenuItem(mstrmojo.desc(1088,"Edit"),"edit",V.handleEdit,{cubeID:V.cubeID,cubeName:V.cubeName});}if(V.subs&&V.subs.length>0){T.addSubMenuItem(mstrmojo.desc(1085,"Schedule"),"schedule",V.id,V.getScheduleMenuConfig);}else{if(mstrApp.diParams.canSubscribe){T.addMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add",V.handleAddSchedule,{cubeID:V.cubeID,cubeName:V.cubeName});}else{T.addDisabledMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add");}}if(V.data.type!=="Managed"){T.addMenuItem(mstrmojo.desc(9099,"Share"),"share",V.handleShare,{cubeID:V.cubeID,cubeName:V.cubeName});T.addMenuItem(mstrmojo.desc(9252,"Delete"),"delete",V.handleDelete,{cubeID:V.cubeID,cubeName:V.cubeName});T.addMenuItem(mstrmojo.desc(1388,"Rename"),"rename",V.handleRename,{nameWidget:V.opener.parent.children[0]});T.addMenuItem(mstrmojo.desc(14055,"Show in folder"),"show",V.handleShowInFolder,{cubeID:V.cubeID});}}return T;}});function D(U,V){var T=U.menuHelper,W;if(!U.openPopup){U.openPopup=function(Y,X){mstrmojo._HasPopup.openPopup.call(U,Y,X);};}if(!U.closePopup){U.closePopup=function(){mstrmojo._HasPopup.closePopup.call(U);};}if(!T){T=new mstrmojo.DI.CubeListCubeMenu();U.menuHelper=T;}T=U.menuHelper;T.data=V;T.cubeID=V.cube_id;T.cubeName=V.cname;T.subs=V.subs;T.opener=U;W=T.getMenuConfig();W.hostId=U.id;W.hostElement=U.domNode;W.position=E.position(U.domNode,true);W.isHostedWithin=false;W.zIndex=mstrApp.getRootController().getDialogController().getNextZIndex();U.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:W}));}function R(T,V){var U=null;switch(T){case L.TYPE:U=function(Y,W){var X=Y.cname===undefined?"":Y.cname,d=W.cname===undefined?"":W.cname,Z=Y.type===undefined?"":Y.type,c=W.type===undefined?"":W.type;if(Z.toString().toLowerCase()<c.toString().toLowerCase()){return V;}else{if(Z.toString().toLowerCase()===c.toString().toLowerCase()){if(X.toString().toLowerCase()<d.toString().toLowerCase()){return -1;}else{return 1;}}else{return(-V);}}};break;case L.NAME:U=function(X,W){var Y=X.cname===undefined?"":X.cname,Z=W.cname===undefined?"":W.cname;return(Y.toString().toLowerCase()<Z.toString().toLowerCase())?V:(-V);};break;case L.SIZE:U=function(X,W){return(parseInt(X.sz||0,10)<parseInt(W.sz||0,10))?V:(-V);};break;case L.DATE:U=function(X,W){var Z=X.mdt||X.nutm||X.utm||"",Y=W.mdt||W.nutm||W.utm||"";Z=Z.replace(/-/g,"/");Y=Y.replace(/-/g,"/");return(new Date(Z).getTime()<(new Date(Y).getTime()))?V:(-V);};break;case L.SCHEDULE:U=function(X,W){return X.schedStatus>W.schedStatus?V:(-V);};break;}return U;}function C(T,W){var V=[],X,U;if(!W){return T;}for(U=0;T&&U<T.length;U++){X=T[U].cname===undefined?"":T[U].cname.toString().toUpperCase();if(X.indexOf(W.toUpperCase())>-1){V.push(T[U]);}}return V;}mstrmojo.DI.DICubesList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DICubesList",markupString:'<div class="mstrmojo-di-cubes cf"><div></div><div></div></div>',markupSlots:{subTitleNode:function(){return this.domNode.children[0];},cubesNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},searchPattern:"",items:null,setDimensions:function M(W,U){var T=parseInt(W,10);var V=parseInt(U,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.cubesNode=(T-10)+"px";this.layoutConfig.w.cubesNode=V+"px";if(this._super){this._super(T+"px",U);}},preBuildRendering:function B(){if(this._super){this._super();}this.update();},postBuildRendering:function(){if(this._super){this._super();}var T=mstrApp.getRootController().getModel();T.attachEventListener("cubesInfoChange",this.id,"update");T.attachEventListener("subsInfoChange",this.id,"update");T.attachEventListener("subsStatusChange",this.id,"update");},populateACLItems:function(T){return F(T);},update:function(){var V=mstrApp.getRootController().getModel(),W,Z=this.cubesList.curSortBy,T=null,X;if(V.cubesInfo){W=V.cubesInfo;}if(this.cubesList.scrollNode){T=this.cubesList.scrollNode.scrollTop;}var U=W.cubes&&W.cubes.cube?[].concat(W.cubes&&W.cubes.cube):[];J.forEach(U,function(a){if(a.ddam===S.datasetServeMode.dda){a.type=mstrmojo.desc(14452,"Live");}else{a.type=mstrmojo.desc(14453,"In memory");}});var Y=W.cubes&&W.cubes.doc?[].concat(W.cubes&&W.cubes.doc):[];J.forEach(Y,function(b){var a=b.cube?[].concat(b.cube):[];J.forEach(a,function(c){c.docn=b.docn;c.docid=b.id;c.docp=b.objp;c.type=mstrmojo.desc(14454,"Managed");U.push(c);});});if(Z&&Z.k){X=R(Z.k,Z.v);if(X){U=U.sort(X);}}this.set("items",U);this.cubesList.set("items",C(U,this.searchPattern));if(T!==null){this.cubesList.scrollNode.scrollTop=T;}},onsearchPatternChange:function(){var T=this.items,U=this.searchPattern,V;V=C(T,U);this.cubesList.set("items",V);},children:[{scriptClass:"mstrmojo.Box",slot:"subTitleNode",cssClass:"mstrmojo-di-cubes-subTitleBox cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-cubes-subTitle",postBuildRendering:function(){var T=mstrApp.getRootController().getModel();if(this._super){this._super();}this.update();T.attachEventListener("cubesInfoChange",this.id,"update");},update:function(){var W=mstrApp.getRootController().model.cubesInfo,X,T,U;if(W===undefined||!W.cubes){return ;}var Y=W.cubes.cusage,V=0;if(Y<1){V=2;}else{if(Y<10){V=1;}}if(Y!==undefined){Y=Number(Y.toFixed(V));if(W.cubes.cquota===-1){T=mstrmojo.desc(12693,"##### MB used. You have unlimited storage!").replace("#####",Math.round(Y*100)/100);}else{X=W.cubes.cquota;U=Math.round(Y/X*10000)/100;T=mstrmojo.desc(13241,"You are currently using ## MB (###) out of #### MB in allocated In-memory space.");T=T.replace("####",X).replace("###",U+"%").replace("##",Y);}this.set("text",T);}}},{scriptClass:"mstrmojo.ui.SearchBox",cssClass:"mstrmojo-di-cubes-subTitle-search",searchDelay:600,searchTriggered:function(U){var T=this.parent.parent;T.set("searchPattern",U);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-cubes-subTitle-refresh",title:mstrmojo.desc(773,"Refresh"),bindings:{visible:"!mstrApp.refreshMultipleCubes"},onclick:function(){var T=mstrApp.getRootController();T.getCubeQuota({success:function(){T.scheduleController.updateScheduleAndStatus();}},{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});}}]},{scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-di-QuotaGrid",alias:"cubesList",slot:"cubesNode",resizableColumns:false,setupScrollNodes:function G(){this.scrollNode=this.scrollboxNode;},bindings:{items:"this.parent.items"},sortBy:{n:1,sz:1,own:1,dt:1,sched:1,type:1},curSortBy:{k:null,v:1},columns:[{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(8733,"Type"),onclick:function(){var V=this.dataGrid;V.sortBy.type=-V.sortBy.type;var U=V.sortBy.type;V.curSortBy.k=L.TYPE;V.curSortBy.v=U;var T=[];T=T.concat(V.items);V.set("items",T.sort(R(L.TYPE,U)));},postBuildRendering:function P(){var T=this.dataGrid;if(T.curSortBy.k===L.TYPE){Q.addClass(this.domNode,H);}}},colCss:"typeCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"typeLabel",bindings:{text:"this.parent.data.type"}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(7559,"Name"),onclick:function(){var V=this.dataGrid;V.sortBy.n=-V.sortBy.n;var U=V.sortBy.n;V.curSortBy.k=L.NAME;V.curSortBy.v=U;var T=[];T=T.concat(V.items);V.set("items",T.sort(R(L.NAME,U)));},postBuildRendering:function P(){var T=this.dataGrid;if(T.curSortBy.k===L.NAME){Q.addClass(this.domNode,H);}}},colCss:"nameCol",dataWidget:{scriptClass:"mstrmojo.Table",cssClass:"nameTable",rows:1,cols:2,children:[{slot:"0,0",scriptClass:"mstrmojo.InlineEditBox",cssClass:"nameLabel",useRichTooltip:true,okSave:true,bindings:{text:function(){var T=this.parent.data.cname+(this.parent.data.docn?" ("+this.parent.data.docn+")":"");return mstrmojo.string.escape4HTMLText(T);},richTooltip:function(){var T={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT};T.content=this.parent.data.docp?this.parent.data.docp:this.parent.data.objp;return T;}},postBuildRendering:function O(){if(this._super){this._super();}this._em_sub=this.attachEventListener("editModeChange",this.id,"_attachEvents");this.tooltipNode=this.textNode;this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},save:function(){this.oldColumn=this.text;this.newColumn=this.inputNode.value;this.set("editMode",false);if(this.oldColumn===this.newColumn){return ;}this.set("text",this.inputNode.value);if(this.onSave){this.onSave();}},onSave:function(){var U={objectid:this.parent.data.cube_id,objecttype:3,objectname:this.text};var T=mstrApp.getRootController();var V={success:function(){U={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")};T.getCubeQuota({success:function(){T.getCubeQuota({success:function(){T.scheduleController.updateScheduleAndStatus();}},U);}},U);},failure:function(W){T.displayError(W.message||W.getResponseHeader("X-MSTR-TaskFailureMsg"));}};T.renameObject(V,U);},preclick:function(U){var X=U.e,W=E.eventTarget(U.hWin,X);if(W===this.okNode){this.save();}else{if(W===this.cancelNode){this.cancel();}else{if(W===this.textNode){if(mstrApp.refreshMultipleCubes){var V=this.parent.data.st;if(V===N.REPORT_EMMACUBE||V===N.REPORT_GRID||V===N.REPORT_GRAPH||V===N.REPORT_GRIDGRAPH){var T={ReportId:this.parent.data.cube_id,CubeName:this.parent.data.cname,StatusCode:S.statusCode.republish};mstrApp.getRootController().getDialogController().show(S.dialogType.diPageDialog,{pageType:S.pageType.republish,diParams:T});}else{if(V===N.REPORT_CUBE){mstrApp.getRootController().publishNonEmmaCube(this.parent.data.cube_id);}}}else{if(this.parent.data.type==="Managed"){mstrApp.redirectToPage(I.getRedirectParams(I.pageRedirect.existingAnalysis,null,false,this.parent.data.docid));}else{mstrApp.redirectToPage(I.getRedirectParams(I.pageRedirect.analysis,this.parent.data.cube_id,this.parent.data.type==="Live"));}}}}}}},{slot:"0,1",scriptClass:"mstrmojo.MenuButton",cssClass:"cubeList-menu-button",cmCssClass:"cubeList-menu",menuZIndex:1000,preclick:mstrmojo.func.emptyFn,preBuildRendering:function(){var T=this.parent.data,U=true;if(this._super){this._super();}if(!T||!T.cube_id||mstrApp.refreshMultipleCubes){U=false;}this.set("visible",U);},onclick:function(){var U=this.parent.data,T=this;D(T,U);}}]}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13045,"Size(KB)"),onclick:function(){var V=this.dataGrid;V.sortBy.sz=-V.sortBy.sz;var U=V.sortBy.sz;V.curSortBy.k=L.SIZE;V.curSortBy.v=U;var T=[];T=T.concat(V.items);V.set("items",T.sort(R(L.SIZE,U)));},postBuildRendering:function P(){var T=this.dataGrid;if(T.curSortBy.k===L.SIZE){Q.addClass(this.domNode,H);}}},colCss:"sizeCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"sizeLabel",bindings:{text:"this.parent.data.sz"}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13046,"Last Modified"),onclick:function(){var V=this.dataGrid;V.sortBy.dt=-V.sortBy.dt;var U=V.sortBy.dt;V.curSortBy.k=L.DATE;V.curSortBy.v=U;var T=[];T=T.concat(V.items);V.set("items",T.sort(R(L.DATE,U)));},postBuildRendering:function P(){var T=this.dataGrid;if(T.curSortBy.k===L.DATE){Q.addClass(this.domNode,H);}}},colCss:"modifiedCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"mtLabel",bindings:{text:function(){var U=this.parent.data;var T=U.mdt;if(T===undefined){T=U.nutm||U.utm;}if(T===undefined){return"";}return mstrmojo.DI.DIHelpers.formatDateAndTime(T,true);}}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13047,"Schedule Status"),onclick:function(){var V=this.dataGrid;V.sortBy.dt=-V.sortBy.dt;var U=V.sortBy.dt;V.curSortBy.k=L.SCHEDULE;V.curSortBy.v=U;var T=[];T=T.concat(V.items);V.set("items",T.sort(R(L.SCHEDULE,U)));},postBuildRendering:function P(){var T=this.dataGrid;if(T.curSortBy.k===L.SCHEDULE){Q.addClass(this.domNode,H);}}},colCss:"scheStatusCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"scheStatus",bindings:{cssClass:function(){var U=["scheStatus"],V=this.parent.data,T=S.cubeSchedStatus;switch(V.schedStatus){case T.failed:U.push("fail");break;case T.successful:U.push("success");break;case T.unexecuted:U.push("empty");break;}return U.join(" ");},visible:function(){var T=this.parent.data.subs;return T&&T.length>0;}}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ui.Pulldown","mstrmojo.CheckBox","mstrmojo.TextBox","mstrmojo.SREditor","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DIModel","mstrmojo.DI.DITableStatusList","mstrmojo.locales","mstrmojo.date","mstrmojo.ProgressBar");mstrmojo.requiresDescs(221,773,1302,4311,4364,4996,8473,10160,12761,12762,12763,12764,12765,12766,12767,12769,13005,13028,13029,2502,13257,9242,13274,13444,13882);var E=mstrmojo.array,D=mstrmojo.hash,H=mstrmojo.DI.DIConstants,F="canSaveSchedule",I="canStartRefresh",C=mstrmojo.desc(13882,"Please upload the data or unselect the source in order to enable this option.");mstrmojo.DI.DIRepublishScheduleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIRepublishScheduleEditor",cssClass:"mstrmojo-di-scheduleEMMA",title:"",simpleProgressMode:false,showTimeWarningMsg:false,width:"650px",onOpen:function(){var J=mstrApp.getRootController().model,L=this.model,N=false,K=false,P,O,M;if(this.opened){return ;}this.opened=true;if(this.subEvt){L.detachEventListener(this.subEvt);}if(L.operationMode===H.operationMode.refresh){this.subEvt=L.attachEventListener("PublishStatusUpdate",this.id,"update");this.set("title",mstrmojo.desc(12761,"Republish ####").replace("####",L.cubeName));this.set("showTimeWarningMsg",!!J.analysisID);this.okButton.set("text",J.analysisID?mstrmojo.desc(13953,"Republish"):mstrmojo.desc(1302,"Finish"));this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));}if(L.operationMode===H.operationMode.subscribe){this.set("help","scheduling_updates_for_Intelligent_Cube_imported_data.htm");this.subEvt=L.attachEventListener("CreateScheduleUpdate",this.id,"update");this.set("title",mstrmojo.desc(12762,"Schedule for ####").replace("####",L.cubeName));this.okButton.set("visible",true);this.okButton.set("text",mstrmojo.desc(1302,"Finish"));this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));P=L.getAllTableID();for(M=0;M<P.length;M++){O=L.getImportSource(P[M]);if(O.canSetAlternateSource()){N=true;}if(O.type===H.sourceType.hadoop||O.databaseType===mstrmojo.warehouse.EnumDatabaseType.BDE){K=true;}}if(K){N=false;}this.advLink.set("visible",N);}if(L.operationMode===H.operationMode.create){this.subEvt=L.attachEventListener("CreateScheduleUpdate",this.id,"update");this.set("title",mstrmojo.desc(13028,"### Publishing Status").replace("###",L.cubeName));this.set("width","450px");}if(L.operationMode===H.operationMode.edit){this.subEvt=L.attachEventListener("PublishStatusUpdate",this.id,"update");this.okButton.set("visible",true);this.okButton.set("text",mstrmojo.desc(1302,"Finish"));this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));if(J.isDirectDataAccess){this.set("title",mstrmojo.desc(13029,"### Saving Status").replace("###",L.cubeName));}else{this.set("title",mstrmojo.desc(13028,"### Publishing Status").replace("###",L.cubeName));}if(this.simpleProgressMode){this.okButton.set("visible",false);this.cancelButton.set("visible",false);this.progress.updateProgress(50);}}},onClose:function(){var J=mstrApp.getRootController(),K=this.model,L=K.cubeID,M=this;this.opened=false;if(this.subEvt){K.detachEventListener(this.subEvt);}E.forEach(K.getAllTableID(),function(P){var O=K.getImportSource(P);O.hasSelectFile=false;O.republishError=undefined;});this.toggleEnable(true);this.statusList.updateStarted=false;this.stopPublishAnimation();this.destroy();if(this.onCompleted&&K.operationMode===H.operationMode.subscribe&&J.dialogController.pageZIndex>0){window.setTimeout(function(){if(M.isSendNow){J.getCubeQuota({success:function(){J.scheduleController.updateScheduleAndStatus();}},{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});}else{J.scheduleController.updateScheduleAndStatus();}},1);}if(this.onCompleted&&K.operationMode===H.operationMode.refresh&&J.dialogController.pageZIndex>0){window.setTimeout(function(){var R,P,Q,O,S={did:L};if(mstrApp.refreshMultipleCubes){R=mstrApp.getRootController().getModel();R.publishedDatasets.push(S);P=R.cubesInfo;Q=P&&P.cubes&&P.cubes.cube;O=E.find(Q,"cube_id",L);if(O>=0){Q.splice(O,1);R.raiseEvent({name:"cubesInfoChange"});}}},1);}if(K.operationMode===H.operationMode.refresh||K.operationMode===H.operationMode.subscribe){if(this.onCompleted&&!mstrApp.fromCubesList){mstrApp.getRootController().exitApplication();}else{if(mstrApp.fromCubesList){mstrApp.fromCubesList=false;var N=mstrApp.getRootController().model.cubeID;J.resetAppforImport();if(!mstrApp.refreshMultipleCubes){J.getCubeQuota();}else{J.getCubeInfo(N);}}else{mstrApp.getRootController().cancelApplication();}}}this.toggleEnable(true);this.statusList.updateStarted=false;},onwidthChange:function(){if(this.editorNode){this.editorNode.style.width=this.width||"auto";}},startPublishAnimation:function(){var K=this.title,J=0,M=this;this._origTitle=K;var L=function(){var N,O;if(M._tickTimer===null||!M.titleNode){return ;}switch(J%3){case 0:O=".&nbsp;&nbsp;";break;case 1:O="..&nbsp;";break;case 2:O="...";break;}N='<span class="republish-success-label">'+M._origTitle+'</span><span class="republish-success-label color">(&nbsp;'+mstrmojo.desc(4311,"Processing")+O+"&nbsp)</span>";M.titleNode.innerHTML=N;J++;};if(this._tickTimer){return ;}this._tickTimer=window.setInterval(L,1000);},stopPublishAnimation:function(){if(this._tickTimer){window.clearInterval(this._tickTimer);this._tickTimer=null;this.titleNode.innerHTML=this._origTitle;}},update:function(J){var K=this.model,N,M,L,O;this.onCompleted=false;this.onError=false;if(K.operationMode===H.operationMode.refresh||(K.operationMode===H.operationMode.edit&&!this.simpleProgressMode)){this.startPublishAnimation();if(J.completed!==undefined){this.onCompleted=J.completed;}if(J.error!==undefined){this.onError=J.error;}if(this.onCompleted){this.toggleEnable(true);}else{this.toggleEnable(false);}this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));if(this.onError){this.okButton.set("visible",false);this.cancelButton.set("visible",true);this.sendToHistoryList.set("visible",false);this.stopPublishAnimation();}else{if(this.onCompleted&&!this.onError){this.stopPublishAnimation();O=this.title;if(O.indexOf('<span class="republish-success-label">')<0){O='<span class="republish-success-label">'+O+'</span><span class="republish-success-label color">'+mstrmojo.desc(13444,"( Successfully published to memory )")+"</span>";}this.set("title",O);this.okButton.set("visible",false);this.cancelButton.set("text",mstrmojo.desc(8473,"Done"));this.cancelButton.set("enabled",true);this.sendToHistoryList.set("visible",false);this.cancelButton.set("visible",true);}}if(J&&J.reset){this.stopPublishAnimation();this.toggleEnable(true);this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("enabled",true);}}if(K.operationMode===H.operationMode.subscribe){N=J.res;if(N.subsID){this.okButton.set("visible",false);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(8473,"Done"));this.onCompleted=true;}else{this.onError=true;mstrApp.getRootController().displayError(mstrmojo.desc(12763,"Cannot save this subscription."),false,N.message);}}if(K.operationMode===H.operationMode.edit&&this.simpleProgressMode){L=0;M=0;D.forEach(K.importSources,function(P){M++;if(P.status!=="3"&&P.status!=="4"&&P.status!=="6"){this.onCompleted=false;}if(P.status==="4"||P.status==="6"){this.onError=true;}if(P.status==="3"||P.status==="4"||P.status==="6"){L++;}},this);this.progress.updateProgress(50+L*50/M);}},toggleEnable:function(J){this.okButton.set("enabled",!!J);},getFileUploader:function(J){return this.statusList.getFileUploader(J);},checkCanRefresh:function(){return this.statusList.checkCanRefresh();},checkCanChange:function(){return this.statusList.checkCanChange();},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13005,"Building the cube"),cssClass:"simpleProgress-label",bindings:{visible:"this.parent.simpleProgressMode"}},{alias:"progress",scriptClass:"mstrmojo.ProgressBar",cssClass:"simpleProgress-progress",bindings:{visible:"this.parent.simpleProgressMode"}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13956,"Publishing time depends on your dataset. Are you sure you want to republish?"),cssClass:"timewarning-label",bindings:{visible:"this.parent.showTimeWarningMsg"}},{scriptClass:"mstrmojo.DI.DITableStatusList",alias:"statusList",bindings:{model:"this.parent.model",forceFullPublish:"(!this.parent.model.isCubePublished || !this.parent.model.rawDataExistsInAE)",bHasRefreshPolicy:function(){return this.parent.model.operationMode===H.operationMode.refresh||this.parent.model.operationMode===H.operationMode.subscribe||this.parent.model.operationMode===H.operationMode.edit;},visible:"!this.parent.simpleProgressMode"}},{alias:"advLink",scriptClass:"mstrmojo.Label",cssClass:"advanceOpsLink",cssDisplay:"table",text:mstrmojo.desc(12765,"Show Advanced Update Options"),postCreate:function G(){mstrmojo.ImageCheckBox.prototype.postCreate.call(this);var K={},J=K[this.id]={};J.isScheduleAdvancedChange=this.handleAdvMode;mstrApp.getRootController().attachDataChangeListeners(K);},postBuildRendering:function A(){this.set("checked",mstrApp.getRootController().getScheduleController().isAdvState());},handleAdvMode:function B(J){this.set("checked",J.value);},bindings:{visible:function(){return(this.parent.model.operationMode===H.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},onclick:function(){this.set("checked",!this.checked);},oncheckedChange:function(){var N=this.checked,O=this.parent,R=O.statusList,L=mstrApp.getRootController(),M=L.getScheduleController(),K=O.model.cubeID,P={success:function Q(){var S=[],T=[];M.setAdvMode(true);R.set("hasIRR",true);mstrmojo.array.forEach(R.items,function(U){if(!U.isAll&&U.checked){S.push(U.tableID);T.push(U.refreshType.toString());}});if(S.length>0){M.createEmmaIRRSourceTables(K,S,T);}},failure:function J(S){M.setAdvMode(false);L.displayError(mstrmojo.desc(12766,"Cannot create emma IRR report instance."),false,(S&&S.message)||"");}};R.set("bHasSourceFilter",N);R.set("bHasAlternateSource",N);R.refresh();if(N){this.set("text",mstrmojo.desc(13257,"Hide Advanced Update Options"));O.set("width","800px");}else{this.set("text",mstrmojo.desc(12765,"Show Advanced Update Options"));O.editorNode.style.width="650px";O.set("width","650px");}O.positionDialog();if(N){if(!L.dataService.emmaIRRMessageID){M.createEmmaIRRReportInstance(L.model.IRRid,null,P);return ;}if(!R.hasIRR){R.set("hasIRR",true);}M.setAdvMode(true);M.setAdvState(true);}else{M.setAdvState(false);}}},{scriptClass:"mstrmojo.Box",cssClass:"cf firstBox",bindings:{visible:function(){return(this.parent.model.operationMode===H.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"text",text:mstrmojo.desc(12767,"Choose a Schedule Template: ")},{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,cssClass:"chooseSchedPulldown",hostedCSSClass:"mstrmojo-di-republishSchedule-chooseSched-hosted",popupToBody:true,popupZIndex:999,defaultSelection:-1,itemIdField:"id",itemField:"n",preBuildRendering:function(){var J=this.parent.parent.model,K=J&&J.getSchedule();this.update();if(K){K.attachEventListener("availableTriggersChange",this.id,"update");K.attachEventListener("trgIDChange",this.id,"update");}},update:function(){var K=this.parent.parent.model,L=K&&K.getSchedule(),J=-1;if(L){this.set("items",L.availableTriggers);if(L.trgID){J=E.find(L.availableTriggers,this.itemIdField,L.trgID);}if(J>=0){this.set("selectedIndex",J);}}},postselectedIndexChange:function(S){var N=this.parent.parent.model,O=N&&N.getSchedule(),P=mstrmojo.date,L=mstrmojo.locales,K,Q,M,J,R;if(!N){return ;}R=S.value;if(R>=0){O.set("curTrg",this.items[R]);O.set("trgName",this.items[R].n);if(!O.subsID){K=new Date();Q=P.getDateJson(K);M=P.formatDateInfo(Q,L.datetime.DATEDISPLAYFORMAT);J=P.formatTimeInfo(Q,L.datetime.TIMEDISPLAYFORMAT);O.set("subsName",N.cubeName+" "+O.trgName+" "+M+" "+J);}}}},{scriptClass:"mstrmojo.Button",cssClass:"button new",text:mstrmojo.desc(4996,"new"),onclick:function(){var K=this.parent.parent.model,M=K&&K.getSchedule(),L=this.SREditor,J={zIndex:mstrApp.getRootController().dialogController.getNextZIndex()};if(!L){L=new mstrmojo.SREditor({cssClass:"mstrmojo-SREditor mstrmojo-di-scheduleEMMA-SREditor",title:mstrmojo.desc(10160,"Select a schedule below"),zIndex:mstrApp.getRootController().dialogController.getNextZIndex(),showNote:false,onOK:function(){var N=this.getTrgDefinition();M.set("trgName",this.getTrgName());if(E.find(M.availableTriggers,"id",M.trgName)<0){M.set("availableTriggers",M.availableTriggers.concat({n:M.trgName,id:N,isHidden:true}));M.set("trgID",N);}var O=new Date();if(!M.subsID){M.set("subsName",K.cubeName+" "+M.trgName+" "+O.toLocaleString());}this.close();},onCancel:function(){this.close();},onClose:mstrmojo.emptyFn});this.SREditor=L;}L.set("trgName",M.trgName||null);L.open(null,J);}}]},{scriptClass:"mstrmojo.Box",cssClass:"cf secondBox",bindings:{visible:function(){return(this.parent.model.operationMode===H.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"text",text:mstrmojo.desc(12769,"Schedule Name:")},{scriptClass:"mstrmojo.TextBox",cssClass:"inputName",onvalueChange:function(){if(this.parent.parent.model){this.parent.parent.model.getSchedule().set("subsName",this.value);}},postBuildRendering:function(){var J=this.parent.parent.model,K=J&&J.getSchedule();this.update();if(K){K.attachEventListener("subsNameChange",this.id,"update");}},update:function(){var J=this.parent.parent.model,K=J&&J.getSchedule();if(K){this.set("value",K.subsName||"");}}}]},{scriptClass:"mstrmojo.CheckBox",cssClass:"advanceOpsCheckbox",label:mstrmojo.desc(13274,"Refresh data now"),cssDisplay:"table",postBuildRendering:function(){var J=this.parent.model,K=J&&J.getSchedule();this.update();if(K){K.attachEventListener("trgNameChange",this.id,"update");K.attachEventListener("isSendNowChange",this.id,"update");}},update:function(){var J=this.parent.model,K=J&&J.getSchedule();if(J){this.set("visible",J.operationMode===H.operationMode.subscribe&&mstrApp.diParams.canSendNow);this.set("enabled",!!K.trgName);this.set("checked",K.isSendNow);}},oncheckedChange:function(){var J=this.parent.model,K=this.checked;if(J){J.getSchedule().set("isSendNow",K);}}},{slot:"buttonNode",alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var J=this.parent;J.close();},postBuildRendering:function(){var J=this.parent.model;J.attachEventListener("PublishStatusUpdate",this.id,"update");},update:function(J){if(J&&J.name&&!J.completed&&!J.hasError){this.set("enabled",false);}if(J&&J.reset){this.set("enabled",true);}},bindings:{visible:function(){return(mstrApp.getRootController().model.operationMode!==H.operationMode.create&&!this.parent.simpleProgressMode);}}},{slot:"buttonNode",alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1302,"Finish"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},postCreate:function G(){var M=this,L={},K=L[this.id]={};var J=function(N){var O=M.parent.model,P=O.operationMode;if(P===H.operationMode.subscribe||P===H.operationMode.refresh||P===H.operationMode.edit){M.set("enabled",N.value);M.richTooltip.content=N.value?"":C;}};K[F]=J;K[I]=J;mstrApp.getRootController().attachDataChangeListeners(L);},onclick:function(){var J=this.parent.model;if(J.operationMode===H.operationMode.subscribe){mstrApp.getRootController().getScheduleController().createSchedule();this.parent.isSendNow=this.parent.model.getSchedule().isSendNow;}if(J.operationMode===H.operationMode.refresh){this.parent.toggleEnable(false);mstrApp.getRootController().saveAndPublish();}if(J.operationMode===H.operationMode.edit){this.parent.toggleEnable(false);mstrApp.getRootController().getPublishController().startSaveAndPublish();}},bindings:{visible:function(){return(mstrApp.getRootController().model.operationMode!==H.operationMode.create&&!this.parent.simpleProgressMode);}}},{slot:"buttonNode",alias:"sendToHistoryList",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(4364,"Send to History List"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT},onclick:function(){mstrApp.getRootController().getPublishController().sendToHistoryList();},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},postCreate:function G(){var M=this,L={},K=L[this.id]={};var J=function(N){var O=M.parent.model,P=O.operationMode;if(P===H.operationMode.refresh||P===H.operationMode.edit){M.set("enabled",N.value);M.richTooltip.content=N.value?"":C;}};K[I]=J;mstrApp.getRootController().attachDataChangeListeners(L);},bindings:{visible:function(){return(mstrApp.getRootController().model.operationMode!==H.operationMode.subscribe&&!mstrApp.isSingleTier&&!mstrApp.getRootController().model.analysisID&&!mstrApp.refreshMultipleCubes);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME.MetricDataService","mstrmojo.ME.AttributeEditBox","mstrmojo.expr","mstrmojo.array","mstrmojo.hash");var G;var e=mstrmojo.ME.MetricDataService,U=mstrmojo.hash,N=mstrmojo.array,W=mstrmojo.ME.AttributeEditBox.getTokenStreamXML,a=mstrmojo.expr.DTP,Q={SHOW_BAND_NAMES:-4,BANDON_UNITS:-6},B={START_END:'BandNames<ResidueName="All Others">(this@ID, "#s - #e")',BAND_NUM:'BandNames<ResidueName="All Others">(this@ID, "Band #b")',BAND_NUM_START_END:'BandNames<ResidueName="All Others">(this@ID, "Band #b: #s - #e")',NO:"No"},R=[{n:mstrmojo.desc(14145,"Start - End"),v:B.START_END},{n:mstrmojo.desc(14146,"Band #"),v:B.BAND_NUM},{n:mstrmojo.desc(14147,"Band #: Start - End"),v:B.BAND_NUM_START_END},{n:mstrmojo.desc(218,"No"),v:B.NO}],K={"8107C337DD9911D3B98100C04F2233EA":"BAND_SIZE","8107C338DD9911D3B98100C04F2233EA":"BAND_COUNT","8107C339DD9911D3B98100C04F2233EA":"BAND_POINTS"},D=function(){return[];};function Y(f){return f.replace(/\s/g,"").toLowerCase();}function O(f){var g=[{v:"BandNames",tp:279,lv:1,oi:{did:"ACA96B1F9F99412B867045747DD88575",n:"BandNames",st:2816,t:11}},{v:"<",tp:60,lv:1},{v:"ResidueName",tp:259,lv:1},{v:"=",tp:282,lv:1},{v:'"All Others"',tp:261,lv:1},{v:">",tp:62,lv:1},{v:"(",tp:40,lv:1},{lv:1,tp:275,v:"this@ID"},{v:",",tp:44,lv:1}];switch(f){case B.BAND_NUM:g.push({v:'"Band #b"',tp:261,lv:1});break;case B.BAND_NUM_START_END:g.push({v:'"Band #b: #s - #e"',tp:261,lv:1});break;case B.START_END:g.push({v:'"#s - #e"',tp:261,lv:1});break;}g.push({v:")",tp:41,lv:1});return g;}function d(f){var g="";N.forEach(f.slice(1,-1),function(h){g+=h.v;});return g;}function J(f){if(f.t===4){return"BandOn";}return f.n;}function E(f){if(f.t===4){return Q.BANDON_UNITS;}return f.dtp;}var C=function(f,g){return{did:"",n:"New Attribute",forms:[{n:"ID",tks:{items:[]}}]};};function T(g,f){return g.dtp===8&&g.n==="Delimiter"?'"'+f+'"':f;}function P(j){var h=j.split(",")[0],g=h.replace(/\d$/,""),f=h.replace(g,"");return{prefix:g,startAt:parseInt(f,10)};}function L(f,g){return{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:f,popupToBody:true,itemIdField:"v",postCreate:function(){var h=this.data;this.value=h.v||h.dfv;},getTokens:g||D,onvalueChange:function(){G.set("dirty",true);}};}function I(g,j){var f=function(k){return k.inputWidget&&k.inputWidget.widgetName===j;},h=mstrmojo.array.filterOne(g.argsGrid.ctxtBuilder.itemWidgets,f);return h&&h.inputWidget;}var H=function(g){var f=null;switch(g&&g.dtp){case Q.SHOW_BAND_NAMES:f=L(R);f.widgetName="bandNames";f.getDescTokens=function(){var h=this.selectedItem&&this.selectedItem.v;return h===B.NO?null:O(h);};break;case Q.BANDON_UNITS:f=G.getParamWidget(g);f.widgetName="bandOn";break;case a.DOUBLE:case a.INTEGER:case a.VARCHAR:f=G.getTextWidget(g);break;default:f=G.getParamWidget(g);f.onitemsChange=mstrmojo.emptyFn;break;}if(f){f.alias="inputWidget";}return f;};var M=function(n,o,k,p){var l=n.did,h=n.n,f=n.dsid,g=n.forms,m={items:o},j=function(q){if(q.vs!==0){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));return ;}var u,t={n:"ID",formula:q.tokenXML};if(l){t.did=g[0].did;u={act:"updateDA",name:h,dsid:f,attrId:l,isTokenStream:true,update:[t]};if(k){if(k.did&&!k.del){u.update.push(k);}else{if(k.did&&k.del){u.del=[{did:k.did}];}else{u.add=[k];}}}}else{u={act:"addDAToDataset",dsid:f,name:h,evFlags:1,isTokenStream:true,forms:[t].concat(k?[k]:[])};}p(u);};mstrmojo.ME.AttributeEditBox.validateSyntax(l,m,true,j);};var Z=function(l){var k=l.forms,g=k&&k.length,j=g&&k[0],h=g&&k[1],n=N.some(j&&j.ftk,function(o){return o.oi&&K[o.oi.did];});if(!n){return false;}if(g===1){return true;}if(h&&h.ftk&&g===2){var f=false,m=Y(d(h.ftk));U.forEach(B,function(o){if(Y(o)===m){f=true;return false;}});return f;}return false;};mstrmojo.ME.BandingDAEditor=mstrmojo.declare(mstrmojo.ME.DerivedFunctionWizard,null,{scriptClass:"mstrmojo.ME.BandingDAEditor",ide:null,insertMode:false,init:function V(f){this._super(f);G=this;},getDTPBuilder:function X(){return H;},getParamObjectTypes:function S(){return[mstrmojo.expr.TP.METRIC];},getTextWidget:function b(g){var h=P(g.n).prefix;return{scriptClass:"mstrmojo.ValidationTextBox",emptyText:(g.dtp===a.DOUBLE||g.dtp===a.INTEGER)?mstrmojo.desc(14143,"Type a number"):"",postCreate:function(){this.value=(g.items&&g.items[0].v)||g.dfv;},oninput:function j(k){G.set("dirty",true);this.createNextInputParamWidget();},constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP,min:1},dtp:g.dtp,getTokens:function(){var k=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==k.dfv){return[{v:T(k,this.value)}];}return[];},createNextInputParamWidget:function f(){var o=this.data,n=this.dataGrid,p=G._lastRpIdx;if(!(o.isRepeated&&o.rpIdx===p)){return ;}var l=p+1,m=h+l,k=mstrmojo.hash.copy({desc:m,n:m,items:null,dn:m,rpIdx:l},mstrmojo.hash.copy(o));n.items.add([k],mstrmojo.array.indexOf(n.items,o)+1);G._lastRpIdx=k.rpIdx;if(G.updateScrollbars){G.updateScrollbars();}}};},onOpen:function F(){G=this;this.oi.tks=this.oi.forms[0].tks||{items:this.oi.forms[0].ftk};this._super();if(this.updateScrollbars){this.updateScrollbars();}},insertOnFinish:function(){var k=mstrmojo.all.mstrDAE.attrEditBox,f=k.inputBox,j=I(this,"bandNames"),g=this.getTokens(),h=j.getDescTokens();f.insertTokens(g);if(h){k.tabstrip.addTab();f.insertTokens(h);}},validateAndSave:function A(m,l){var k=this,j=k.ide.action,f=m.forms,g=I(this,"bandNames"),o=g.getDescTokens(),h=U.copy(o?{n:"DESC",formula:W({items:o})}:null,f[1]?{did:f[1].did}:null),n=function(q){l();k.ide.close();var p=m.did?j.onupdate:j.oncreate;if(p){p(q);}};if(o===null&&h){h.del=true;}M.call(k,k.oi,this.getTokens(),h,n);},postProcessParamsFromToken:function(j){var l=[],k,h,g=j.pars,f=(g&&g.length)||0;for(h=0;h<f;h++){k=U.copy(g[h]);k.dtp=E(k);k.n=J(k);k.isParam=true;l.push(k);}k=l[l.length-1];if(j.rpc>0){l=l.concat(this.postProcessRepeatParam(k));}return l;},postProcessRepeatParam:function c(n){var m=P(n.n),l=m.prefix,h=m.startAt||1,f=[],k,g;n.isRepeated=true;n.rpIdx=this._lastRpIdx=h;n.n=l+(h++);var j=n.items||[];if(j.length>0){n.items=[j[0]];for(g=1;g<=j.length;g++){k=U.copy(n);k.rpIdx=h;k.n=l+(h++);k.items=(g===j.length?null:[j[g]]);f.push(k);}this._lastRpIdx=k.rpIdx;}return f;},postProcessProsFromToken:function(f){var h=[],g={dfv:B.START_END,n:"ShowBandNames",desc:mstrmojo.desc(14144,"Show band names"),dtp:Q.SHOW_BAND_NAMES};if(this.oi.forms.length>1){var j=Y(d(this.oi.forms[1].ftk));U.forEach(B,function(k){if(Y(k)===j){g.v=k;return false;}});}else{if(this.oi.did!==""){g.v=B.NO;}}h.push(g);return h;}});mstrmojo.ME.BandingDAEditor.getNewDefinition=C;mstrmojo.ME.BandingDAEditor.showAsBandingEditor=Z;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Editor","mstrmojo.tooltip","mstrmojo.SearchWidget","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.BandingDAEditor","mstrmojo.ME.Enum","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(13141);var R=mstrmojo.hash,W=mstrmojo.dom,M=mstrmojo.css,Y=mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS;var D={n:mstrmojo.desc(9590,"Search Result"),did:-1,fns:[]},E={n:mstrmojo.desc(4561,"All Functions"),did:-2,fns:[]},Q={n:mstrmojo.desc(9591,"Metric Templates"),did:-3,fns:[{n:mstrmojo.desc(3273,"Level"),did:Y.Level,desc:mstrmojo.desc(9592,"Create a level metric."),h:"standard_functions_Level"},{n:mstrmojo.desc(9579,"Condition"),did:Y.Condition,desc:mstrmojo.desc(9593,"Create a conditional metric."),h:"standard_functions_condition"},{n:mstrmojo.desc(3324,"Transformation"),did:Y.Transformation,desc:mstrmojo.desc(9594,"Create a transformation metric."),h:"standard_functions_transformation"},{n:mstrmojo.desc(11656,"Row Count"),desc:mstrmojo.desc(11657,"Row Count calculates the total number of rows in the dataset."),did:Y.Row_Count,tks:{items:[{v:"Count",tp:280,oi:{n:"Count",did:"8107C31CDD9911D3B98100C04F2233EA",t:11,st:2816}},{v:"<",tp:60},{v:"Null",tp:259},{v:"=",tp:282},{v:"True",tp:299},{v:",",tp:44},{v:"UseLookupForAttributes",tp:259},{v:"=",tp:282},{v:"False",tp:300},{v:">",tp:62},{v:"(",tp:40},{v:'"*"',tp:261},{v:")",tp:41},{v:"{",tp:123},{v:"~",tp:126},{v:"}",tp:125}]}}]},G={n:mstrmojo.desc(4565,"Select a category:"),did:-4,fns:[]},F=function(Z,a){var b=Z.functionList;Z.openWizard(b.items[b.selectedIndex],a);},H=function(){return mstrmojo.hash.copy(mstrmojo.ME.ENUM.NEW_METRIC_DEFINITION);};var X=function(a){var Z="mstrmojo-ME-fct-tip",b=this.tooltip&&this.tooltip.domNode;if(b){M.toggleClass(b,Z,a);}};mstrmojo.ME.FunctionSelector=mstrmojo.declare(mstrmojo.Editor,[],{scriptClass:"mstrmojo.ME.FunctionSelector",title:mstrmojo.desc(9595,"Select a function or template"),help:"Select_a_Function_dialog_box.htm",isDME:false,functions:null,includeFakeFuncs:true,functionItems:null,selectedCategory:1,selectedIndex:-1,init:function T(Z){this._super(Z);M.addWidgetCssClass(this,"mstrmojo-FunctionSelector");},getFunctionSyntax:function L(g,b){var d=this.functionItems;if(!d){return"";}var e=d[g].fns[b];if(e.did<0){return e.n;}var Z=e.pars,j=e.pros,h=[],a,c;h.push(e.n);j=mstrmojo.hash.clone(j)||[];if(e.ios){j.push({n:"SortBy"});}if(e.sqt===5){j.push({n:"BreakBy"});}if(this.showFullSyntax){if(j.length>0){h.push("<");for(a=0,c=j.length;a<c;a++){h.push(j[a].n);h.push(", ");}h.pop();h.push(">");}}h.push("(");for(a=0,c=Z.length;a<c;a++){h.push(Z[a].n);if(a!==(c-1)){h.push(", ");}}h.push(")");return h.join("");},getFunctionDesc:function P(c,Z){var b=this.functionItems;if(!b){return"";}var a=b[c].fns[Z];return mstrmojo.ME.FunctionInfo.getDescAndExample(a).desc;},getFunctionHelpTopic:function O(c,Z){var b=this.functionItems;if(!b){return"";}var a=b[c].fns[Z];if(a.did===Y.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(a.h);},getMetricDefAsTokens:function S(){return this.getTokens();},getTokens:function K(){var a=this.functionList,Z=a.items[a.selectedIndex],b=[];if(Z){if(Z.did<-1){switch(Z.did){case -7:b=Z.tks.items;break;case -4:case -5:case -6:break;}}else{b.push({v:Z.n,oi:Z,isNew:true});}}return b;},onfunctionsChange:function V(){if(!this.functions){return ;}this.selectedCategory=0;this.set("selectedCategory",1);this.set("selectedIndex",-1);var b=mstrmojo.hash.clone(this.functions),Z=b.length;if(!b.add){b=R.make(b,mstrmojo.Arr);}if(Z>=1&&this.includeFakeFuncs){var a=b[mstrmojo.ME.MetricDataService.getBasicCategoryIndex(b)];a.fns.push(Q.fns[0]);if(!this.isDME){a.fns.push(Q.fns[1]);a.fns.push(Q.fns[2]);}else{a.fns.push(Q.fns[3]);}}this.set("functionItems",b);},onPreClose:function N(){this.cleanup();return true;},cleanup:function I(){this.searchWidget.clearSearch();this.set("selectedIndex",-1);},handleCloseAction:function C(){this.close();},clearSearchResult:function U(a){var b=this.fcHBox.fcPulldown,c=this.functionItems,Z=c.length-1;if(Z>-1&&c[Z]===D){if(this.selectedCategory===Z){if(a!==false){this.set("selectedCategory",1);this.set("selectedIndex",-1);}}c.remove(Z);b.refresh();}},clearSearchPattern:function A(){var Z=this.searchWidget;if(Z&&Z.hasRendered){Z.reset();this.clearSearchResult(false);}},openWizard:function J(c,b){var a=this,Z;if(mstrmojo.ME.MetricDataService.isBasicAggMap(c.did)||c.did<-1){Z={zIndex:a.zIndex+10,did:c.did,oi:H};Z.insertMode=false;Z.id="mstrSME";}else{Z={functions:mstrmojo.ME.MetricDataService.getFunctionCatList(),fctOi:c,zIndex:a.zIndex+10,oi:H};Z.id="mstrFE";}Z.insertMode=this.insertMode;if(Z.insertMode){Z.insertOnFinish=this.insertOnFinish;}a.switch2Editor(Z.id,Z);},handleSelectedFunction:function(Z){F(this);},onshowFullSyntaxChange:function B(){this.functionList.onchange();},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FunctionSelector-label",text:mstrmojo.desc(9925,"Functions")},{scriptClass:"mstrmojo.SearchWidget",alias:"searchWidget",cssClass:"mstrmojo-FunctionSelector-search",width:"65px",quickSearch:true,placeholderText:"",onsearch:function(g){var Z=this.parent,f=Z.fcHBox.fcPulldown,d=Z.functionItems,h=Z.functionList.itemDisplayField,e=[],a=function(k){var j=mstrmojo.hash.copy(k),m=j.n,l;try{l=new RegExp(g,"ig");}catch(n){l=new RegExp(mstrmojo.string.regEscape(g),"ig");}if(l.test(m)){j[h]=m.replace(l,function(o){return"<em>"+mstrmojo.string.encodeHtmlString(o)+"</em>";});e.push(j);}},b,c;for(b=0,c=d.length;b<c;b++){if(d[b]===D||d[b].did===E.did){continue;}if(g){mstrmojo.array.forEach(d[b].fns,a);}}D.fns=e;if(d[d.length-1]!==D){d.add([D]);}f.refresh();Z.selectedCategory=0;Z.set("selectedCategory",d.length-1);Z.set("selectedIndex",-1);},onclear:function(Z){if(Z){this.parent.clearSearchResult();}}},{scriptClass:"mstrmojo.HBox",alias:"fcHBox",cssClass:"mstrmojo-FunctionSelector-fctBox",children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",alias:"fcPulldown",itemIdField:"did",itemField:"n",items:[],bindings:{items:function(){var a=this.parent.parent.functionItems,b=[];if(!a){return a;}b=mstrmojo.ME.MetricDataService.sortFunctions(a);if(a[0].did!==E.did){var Z=E;Z.fns=b;a.unshift(Z);}return a;},selectedIndex:"this.parent.parent.selectedCategory",value:function(){var Z=this.parent.parent.selectedCategory;return this.items[Z][this.itemIdField];}},onvalueChange:function(Z){var a=this.parent.parent;a.set("selectedCategory",this.selectedIndex);a.set("selectedIndex",-1);if(Z.valueWas===D.did&&this.selectedItem.did!==D.did){this.parent.parent.clearSearchPattern();}}}]},{scriptClass:"mstrmojo.ME.FunctionList",alias:"functionList",itemIdField:"dssid",itemField:"n",itemDisplayField:"dn",items:[{n:"",cls:"wait"}],cssClass:"mstrmojo-FE-functionList mstrmojo-suggest-list",renderOnScroll:false,itemMarkupFunction:function(b,Z,a){return'<div class="mstrmojo-suggest-text '+(b.cls||"fn")+'" idx="'+Z+'"'+(b.did<0?'did="'+b.did+'"':"")+" onmouseover=\"mstrmojo.all['"+a.id+"'].onmouseover(this, event)\" onmouseout=\"mstrmojo.all['"+a.id+"'].onmouseout(this, event)\">"+((a.itemDisplayField&&b[a.itemDisplayField])||b[a.itemField])+'<div class="mstrmojo-Button mstrmojo-Editor-button mstrmojo-WebButton hot tbFunction" t="edt"><div class="mstrmojo-Button-text" t="edt">'+mstrmojo.desc(1088,"Edit")+"</div></div></div>";},bindings:{items:function(){var Z=this.parent.functionItems,a=this.parent.selectedCategory;return(Z&&Z[a].fns)||this.items;},selectedIndex:"this.parent.selectedIndex"},buffer:"",onkeypress:function(l){var j=this,g=l.e,c=g.keyCode||g.charCode,m=mstrmojo.Enum_Keys,Z=function(o){var n=(W.isIE&&!W.isIE9)?o.keyCode:o.charCode;return(n>0)?String.fromCharCode(n):"";},h=this.items,f=h.length,a=this.selectedIndex,b=function(e){j.scrollTo(e);};switch(c){case m.UP_ARROW:this.set("selectedIndex",(a+f-1)%f);break;case m.DOWN_ARROW:this.set("selectedIndex",(a+1)%f);break;default:var d=(this.buffer+=Z(g));if(f>0&&d.length>0){mstrmojo.array.forEach(h,function(o,k,e){var n=new RegExp("^"+d,"i");if(n.test(o[j.itemField])){if(k>-1){this.selectedIndex=-1;this.set("selectedIndex",k);}return false;}},this);}}if(this.selectedIndex>-1){b(this.selectedIndex);}window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){j.buffer="";},300);mstrmojo.dom.stopPropogation(l.hWin,g);return false;},onkeyup:function(Z){this.onkeypress(Z);},onchange:function(Z){var b=this.parent;if(this.selectedIndex!==b.selectedIndex){b.set("selectedIndex",this.selectedIndex);}var d=b.selectedCategory,a=b.selectedIndex,c=d>-1&&a>-1;b.set("funcSyntax",c?b.getFunctionSyntax(d,a):"");b.set("funcDesc",c?b.getFunctionDesc(d,a)+"  "+b.getFunctionHelpTopic(d,a):"");if(this.changeByMouse){if(b.selectedCategory>-1&&b.selectedIndex>-1){b.handleSelectedFunction(false);}this.changeByMouse=false;}},onmouseup:function(Z){var b=Z.getTarget(),a=b.getAttribute("t");if(a==="edt"){mstrmojo.dom.stopPropogation(Z.hWin,Z.e);mstrmojo.dom.preventDefault(Z.hWin,Z.e);this.openFunctionEditor();return false;}},openFunctionEditor:function(){var b=this.parent.parent.parent,c=b.getTokenInputBox(),Z={zIndex:b.zIndex+1,insertMode:true,oi:mstrmojo.ME.ENUM.getNewDefinition(),insertOnFinish:function(d){c.insertTokens(d);}},a=this.parent.functionList.selectedItem;if(b.isBanding&&b.isBanding(a.did)){Z={zIndex:b.zIndex+1,insertMode:true,fctOi:a,id:"mstrBDAE_1",oi:mstrmojo.ME.BandingDAEditor.getNewDefinition(),ide:b};}else{if(mstrmojo.ME.MetricDataService.isBasicAggMap(a.did)||a.did<-1){Z.candidates=c.candidates;Z.did=a.did;Z.id="mstrSME_1";Z.useGUIDefault=true;}else{Z.fctOi=a;Z.id="mstrFE_1";Z.paramItemsPath=b.feParamItemsPath;}}Z.modal=true;b.getModalEditor(Z).open(b);},ondblclick:function(Z){var b=this.getItemNodeFromTarget(Z.getTarget());if(b){var a=this.parent;if(a.selectedCategory>-1&&a.selectedIndex>-1){a.handleSelectedFunction(true);}}},useRichTooltip:false,onmouseover:function(b,j){var l=this,a=this.parent,k=a.selectedCategory,d=b.getAttribute("idx"),c=W.eventTarget(window,j),Z=c.getAttribute("t")==="edt";if((!isNaN(d)&&d>-1)||Z){window.clearTimeout(l.hideTmr);var h='<dl class="fct-info"><dt class="fct-syntax">'+a.getFunctionSyntax(k,d)+'</dt><dd class="fct-desc">'+(a.getFunctionDesc(k,d)+"  "+a.getFunctionHelpTopic(k,d))+"</dd></dl>";var m=mstrmojo.dom.position(b,true),n=function(){var p=(l.tooltip&&l.tooltip.domNode.offsetWidth+15)||200,e=m.x,u=m.y-b.offsetHeight/2,t=e<p?"left":"right",q=e<p?mstrmojo.tooltip.POS_TOPLEFT:mstrmojo.tooltip.POS_TOPRIGHT;e=e<p?m.x+m.w+8:e-10;return{arrow_css:t,contentNodeCssClass:"me-tooltip-content "+t,posType:q,left:e,top:u};},g=n(),f="hidden";l.richTooltip=Z?l.getEditBtnTooltip(c,d):{cssClass:f,contentNodeCssClass:"me-tooltip-content "+g.arrow_css,posType:g.posType,left:g.left,top:g.top,content:h,areaId:d};l.useRichTooltip=true;l.hasOpenTooltip=false;l.showTooltip();window.clearInterval(l.posTmr);var o=0;if(!l.posTmr){l.posTmr=window.setInterval(function(){if(l.tooltip){var q=l.tooltip.domNode,p=q.childNodes[1].firstChild,e=g.posType;g=n();if(g.posType!==e){q.style.left=g.left+"px";M.addClass(p,[g.arrow_css]);}window.setTimeout(function(){M.removeClass(q,f);},10);window.clearInterval(l.posTmr);delete l.posTmr;}else{if(o++>10){window.clearInterval(l.posTmr);}}},200);}X.call(this,!Z);}},getEditBtnTooltip:function(Z,a){return{posType:mstrmojo.tooltip.POS_TOPRIGHT,contentNodeCssClass:"me-tooltip-content regular up tbFunction",top:28,left:67,refNode:Z,content:mstrmojo.desc(13141,"Edit function parameters"),areaId:a};},onmouseout:function(){var Z=this;this.hideTmr=window.setTimeout(function(){X.call(Z);Z.hideTooltip();Z.useRichTooltip=false;},500);}},R.copy({slot:"buttonNode",cssText:"text-align: center; float:left;",text:mstrmojo.desc(9563,"Switch to Formula Editor"),title:mstrmojo.desc(9597,"Build a metric formula using metrics, facts, attributes and functions."),closeAfterSwitch:false,getEditor:function(){return this.parent;},postclick:function(){this.getEditor().buttonNode.style.visibility="hidden";},bindings:{visible:function(){return !this.parent.insertMode;}}},R.copy(mstrmojo.ME._MetricEditorHelper.switchRef)),{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.handleCloseAction();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo.ui._HasScroller");var D=mstrmojo.dom;mstrmojo.ME.FunctionList=mstrmojo.declare(mstrmojo.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionList",setupScrollNodes:function C(){this.scrollNode=this.itemsContainerNode;this.scrollNode.style.height=this.scrollboxNode.offsetHeight+"px";this.scrollboxNode=this.itemsContainerNode;},getItemNodeFromTarget:function B(G){var F=mstrmojo.dom.findAncestorByAttr(G,"idx",true,this.domNode);return(F&&F.node)||null;},premousedown:function A(G){this.changeByMouse=false;if(D.isPrimaryMouseBtn(G.e)){var H=this.getItemNodeFromTarget(G.getTarget()),F=H&&parseInt(H.getAttribute("idx"));if(F!==null&&!isNaN(F)&&F!==this.selectedIndex){this.domNode.tabIndex=0;this.domNode.focus();this.changeByMouse=true;}this._super(G);}},premouseup:function E(F){if(D.getButton(F.hWin,F.e)===D.MOUSE_BUTTON.LEFT){this._super(F);return true;}mstrmojo.dom.stopPropogation(F.hWin,F.e);mstrmojo.dom.preventDefault(F.hWin,F.e);return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIModel","mstrmojo.DI.DIRepublishScheduleEditor","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12394,12836,12837);var X=mstrmojo.array,U=mstrmojo.hash,Z=mstrmojo.DI.DIConstants,I="CDE80A9048DB5E6E1B1A378503859835";var S=0,W=1;var E={success:function J(a){mstrApp.getRootController().dataService.set("emmaIRRMessageID",a.msgid);}};function P(b){var a=[];if(!b){return a;}if(b.fn===mstrmojo.expr.FN.AND||b.fn===mstrmojo.expr.FN.OR||b.fn===mstrmojo.expr.FN.NOT){if(Object.prototype.toString.call(b.nds)==="[object Array]"){X.forEach(b.nds,function(c){a=a.concat(P(c));});}}else{if(b.a){a.push(b.a.did);if(b.a2){a.push(b.a2.did);}}}return a;}function H(e,c){var a,f,d,b=0;e=e&&e.nd;if(e===undefined){return null;}if(e.op&&(e.op.fnt===mstrmojo.expr.FN.AND||e.op.fnt===mstrmojo.expr.FN.OR)){if(Object.prototype.toString.call(e.nds)==="[object Array]"){a={fn:e.op.fnt,et:e.et,nds:[]};X.forEach(e.nds,function(g){a.nds.push(H(g,c));});}else{if(!e.nd){return null;}a=H(e.nd,c);}}else{if(e.op.fnt===mstrmojo.expr.FN.NOT){e=e.nds[0].nd;e.not=true;}a={fn:e.op.fnt,et:e.et,not:e.not||false};X.forEach(e.nds,function(g){b=g.cst&&g.cst.ddt;});X.forEach(e.nds,function(g){if(g.fmshct){f=a.a?"a2":"a";d=a.fm?"fm2":"fm";a[f]={did:g.fmshct.atid,n:c[g.fmshct.atid],t:12};a[d]={did:g.fmshct.fmid,n:c[g.fmshct.fmid],t:21,dtp:b||g.ddt};}else{if(g.cst){a.cs=a.cs||[];a.cs.push({v:g.cst.v,dtp:g.cst.ddt});}}});}return a;}mstrmojo.DI.controller.DIScheduleController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIScheduleController",getCubeSubscription:function(c){var b=mstrApp.getRootController();var a={success:function(d){b.getModel().populateSubscriptions(d);},failure:function(d){b.displayError(d.message||d.getResponseHeader("X-MSTR-TaskFailureMsg"));}};b.dataService.getObjectSubscriptions(mstrmojo.func.wrapMethods(a,c),{detailFlag:5});},getAvailableTriggers:function(c){var b=mstrApp.getRootController();var a={success:function(e){var d=b.model;d.getSchedule().populateTriggers(e);},failure:function(d){b.displayError(d.message||d.getResponseHeader("X-MSTR-TaskFailureMsg"));}};b.dataService.getAvailableTriggers(mstrmojo.func.wrapMethods(a,c),{});},getSubscriptionDefinition:function(a,c){var b=mstrApp.getRootController();b.dataService.getSubscriptionInfo(c,{subscriptionID:a});},launchScheduleEditor:function(){var g=this,c=mstrApp.getRootController(),d=mstrApp.getRootController().getModel(),e=d.getSchedule(),f=null,b;d.rawFilter=undefined;d.updateFilterUsedInTable=function j(){var m=P(d.filter),l=m.length>0,k=d.isFilterInTable={};U.forEach(d.IRRTableAttrs,function(n,o){k[o]=true;X.forEach(m,function(p){if(X.indexOf(n,p)<0){k[o]=false;return false;}});k[o]=k[o]&&l;});};function a(){f=c.showDialog(Z.dialogType.publishStatusDialog,{zIndex:999,model:d});}function h(){mstrmojo.hash.forEach(d.importSources,function(l){if(l.xdaType===Z.xdaType.qbSingleTable){b=true;}});if(b){g.getEmmaIRRAttributes({success:function k(p){var m=[],t,u={},o={},l={},q;X.forEach(p.ts,function n(x){X.forEach(x.amps,function w(AA){q=AA.atid;t=x.tbid;u[t]=u[t]||[];u[t].push(q);if(X.find(m,"did",q)===-1){m.push({n:AA.atnm,did:q,t:12});}o[q]=AA.atnm;X.forEach(AA.afmps,function z(AB){o[AB.fmid]=AB.fmn;l[q]=l[q]||[];if(X.find(l[q],"did",AB.fmid)<0){l[q].push({did:AB.fmid,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(AB.bft),n:AB.fmn,t:21});}});});});d.filter=H(d.rawFilter,o);d.IRRAttributes=m;d.IRRTableAttrs=u;d.IRRAttrForms=l;d.updateFilterUsedInTable();a();}});}else{d.IRRAttributes=[];a();}}this.getAvailableTriggers({success:function(){if(e.subsID){g.getSubscriptionDefinition(e.subsID,{success:function(m){var n,o,k;e.set("trgID",m.trgID);e.set("trgName",m.trgName);k=X.find(e.availableTriggers,"id",m.trgID);if(k<0){e.availableTriggers.push({n:m.trgName,id:m.trgID});e.set("curTrg",{n:m.trgName,id:m.trgID});}else{e.set("curTrg",e.availableTriggers[k]);}e.set("subsName",m.subsName);o=m.delta;if(o){mstrApp.getRootController().dataService.set("emmaIRRMessageID",null);g.createEmmaIRRReportInstance(d.IRRid,o,{success:function p(w){var t=w.def,AF,x,u=Z.xdaType,AC,AB,z=[],AE;X.forEach(t.datap,function AA(AG){n=d.getImportSource(AG.tbid);if(!n){z.push(AG.tbid);return true;}n.checked=true;if(AG.crt!==undefined){n.refreshType=parseInt(AG.crt,10);}x=null;AF=AG.srce;if(AF){switch(AF.xt){case u.qbSingleTable:x={tableName:AF.tbn};break;case u.excel:case u.text:AC=AF.file_description;if(AC&&AC.url){AB=mstrmojo.DI.DIHelpers.getURLFileName(AC.url);}else{AB=AF.tbal;}x={tableName:AB};break;}}n.alternateSource=x;});AE={success:function AD(){var AG=window.localStorage,AI,AH=true;if(AG){AI=AG.getItem("irr"+e.subsID);if(AI==="true"){AH=true;}if(AI==="false"){AH=false;}}d.rawFilter=t.f.exp;h();g.setAdvMode(true);g.setOldIsAdvMode(true);g.setAdvState(AH);},failure:function q(AG){c.displayError(mstrmojo.desc(12394,"Cannot delete source table."),false,(AG&&AG.message)||"");}};if(z.length>0){g.deleteEmmaIRRSourceTable(z,AE);}else{AE.success();}}});return ;}X.forEach(m.ts,function l(q){n=d.getImportSource(q.did);if(!n){return true;}n.checked=true;if(q.crb!==undefined){n.refreshType=parseInt(q.crb,10);n.checked=true;}if(q.ac!==undefined){n.executeAction=parseInt(q.ac,10);n.checked=true;}});h();},failure:function(k){c.displayError(mstrmojo.desc(12836,"Cannot get definition about this subscription"),false,k.message||k.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{U.forEach(d.importSources,function(k){k.checked=k.canSubscribe();});h();}}});},createSchedule:function(m){var g=mstrApp.getRootController(),k=g.getModel(),l=k.getSchedule(),c=k.cubeID,b=l.subsID,h=l.subsName,e=[],a=[],j=[];var f={subscriptionName:h,contentID:c};var d={success:function(o){var p=o.subsID,n=window.localStorage;k.raiseEvent({name:"CreateScheduleUpdate",res:o});if(p&&n){n.setItem("irr"+p,l.showAdvanceState);}},failure:function(n){k.raiseEvent({name:"CreateScheduleUpdate",res:n});}};if(!l.curTrg){return ;}mstrmojo.hash.forEach(k.importSources,function(n){if(n.checked&&n.canSubscribe()){e.push(n.tableID);a.push(n.refreshType);j.push(1);}});f.tableIDs=e.join();f.refreshTypes=a.join();f.executeActions=j.join();if(l.curTrg.isHidden){f.triggerPattern=l.curTrg.id;}else{f.triggerID=l.curTrg.id;}if(b){f.subscriptionID=b;}if(this.isAdvMode()&&(this.hasRefreshFilter()||this.hasAlternateSource())){f.hasIRR=1;}if(this.getOldIsAdvMode()){f.oldHasIRR=1;}f.sendNow=l.isSendNow;g.dataService.saveEMMASchedule(mstrmojo.func.wrapMethods(d,m),f);},removeSubscription:function(b,a){mstrApp.getRootController().dataService.removeSubscription(a,{subscriptionID:b.join()});},getScheduleStatus:function(b,f){var d=mstrApp.getRootController();var c=d.getModel();var e={dids:b.join(),type:3,size:5};var a={success:function(g){c.populateScheduleStatus(g);}};d.dataService.getScheduleStatus(mstrmojo.func.wrapMethods(a,f),e);},getScheduleStatusBySubscription:function(b,f){var d=mstrApp.getRootController(),c=d.getModel(),e={dids:b.join(),type:255,size:5};var a={success:function(g){c.populateScheduleStatus(g);}};d.dataService.getScheduleStatus(mstrmojo.func.wrapMethods(a,f),e);},updateScheduleAndStatus:function(b){var a=mstrApp.getRootController();a.getScheduleController().getCubeSubscription({success:function(){var d=a.getModel(),e=d.subsInfo,c=[];X.forEach(e,function(f){c.push(f.did);});if(c.length>0){a.getScheduleController().getScheduleStatusBySubscription(c,b);}else{if(b&&b.success){b.success();}if(b&&b.complete){b.complete();}}},failure:function(c){if(b&&b.failure){b.failure(c);}if(b&&b.complete){b.complete();}}});},showScheduleStatusDialog:function(b,e){var a=mstrApp.getRootController().getModel();var d=a.subsStatus&&a.subsStatus[b];if(d){d=d.slice().reverse();}else{d=[];}var c={subsStatus:d};if(e){c.onOK=e;}mstrApp.getRootController().showDialog(mstrmojo.DI.DIConstants.dialogType.refreshHistoryDialog,c);},selectAlternateSourceURL:function(d,c,g){var b=mstrApp.getRootController(),f=mstrApp.getRootController().dataService;var a={success:function(j){if(j.vt===1){if(g.success){g.success(j);}if(g.complete){g.complete();}}else{var h=mstrmojo.DI.DIHelpers.parseAlternateSourceValidationResults(j.cols);b.showDialog(Z.dialogType.alternateSourceValidateDialog,{items:h,zIndex:b.rootView.zIndex+10});}},failure:function(h){if(g.failure){g.failure(h);}if(g.complete){g.complete();}}};var e={success:function(h){if(h&&h.msgid){f.set("emmaIRRMessageID",h.msgid);}f.validateEmmaIRRAlternateSource(a,{tbid:d});},failure:function(h){b.displayError(mstrmojo.desc(12837,"Cannot set alternate source."),false,(h&&h.message)||"");}};this.editEmmaIRRSourceTableURL(d,null,"0",c,e);},isAdvMode:function K(){return mstrApp.rootController.model.getSchedule().isScheduleAdvanced;},setAdvMode:function C(b){var a=mstrApp.rootController.model,c=a.getSchedule();if(c.isScheduleAdvanced!==b){c.set("isScheduleAdvanced",b);}},setAdvState:function Q(b){var a=mstrApp.rootController.model,c=a.getSchedule();c.set("showAdvanceState",b);},isAdvState:function F(){return mstrApp.rootController.model.getSchedule().showAdvanceState;},getOldIsAdvMode:function G(){return mstrApp.rootController.model.getSchedule().oldIsScheduleAdvanced;},setOldIsAdvMode:function Y(b){var a=mstrApp.rootController.model,c=a.getSchedule();if(c.oldIsScheduleAdvanced!==b){c.oldIsScheduleAdvanced=b;}},createEmmaIRRReportInstance:function B(b,c,f){var e=mstrApp.getRootController().dataService,a;if(e.emmaIRRMessageID){return ;}a={success:function d(g){e.set("emmaIRRMessageID",g.msgid);}};e.createEmmaIRRReportInstance(mstrmojo.func.wrapMethods(a,f),{reportID:b||I,delta:c||""});},createEmmaIRRSourceTables:function A(e,b,a,f){var d=mstrApp.getRootController().dataService,c={};if(e){c.brid=e;}c.tbids=b.join(",");c.crts=a.join(",");d.createEmmaIRRSourceTables(mstrmojo.func.wrapMethods(E,f),c);},editEmmaIRRSourceTableURL:function N(d,b,c,a,g){var f=mstrApp.getRootController().dataService,e={sourceType:S,tables:d};if(b){e.refreshTypes=b;}if(c){e.deleteTables=c;}if(a){e.url=a;}f.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(E,g),e);},editEmmaIRRSourceTableSingleTable:function L(f,c,e,a,d,j,h){var g=mstrApp.getRootController().dataService,b={sourceType:W,tables:f};if(c){b.refreshTypes=c;}if(e){b.deleteTables=e;}if(a){b.dbRoleID=a;}if(d){b.dbNamespace=d;}if(j){b.dbTableName=j;}g.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(E,h),b);},editEmmaIRRSourceTableRefreshTypes:function D(d,a,f,e){var c=mstrApp.getRootController().dataService,b={sourceType:W,tables:d.join(",")};if(a){b.refreshTypes=a.join(",");}if(f){b.deleteTables=f.join(",");}c.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(E,e),b);},deleteEmmaIRRSourceTable:function R(a,b){mstrApp.getRootController().dataService.deleteEmmaIRRSourceTable(mstrmojo.func.wrapMethods(E,b),{tbids:a.join(",")});},getEmmaIRRAttributes:function T(a){mstrApp.getRootController().dataService.getEmmaIRRAttributes(a);},setEmmaIRRFilter:function M(a,b){mstrApp.getRootController().dataService.setEmmaIRRFilter(mstrmojo.func.wrapMethods(E,b),{exp:a});},hasRefreshFilter:function O(){var a=mstrApp.getRootController().getModel(),b=false;U.forEach(a.isFilterInTable,function(c){if(c){b=true;return false;}});return b;},hasAlternateSource:function V(){var a=mstrApp.getRootController().getModel(),b=false;U.forEach(a.importSources,function(c){if(c.alternateSource){b=true;return false;}});return b;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.DI.DICubesList");mstrmojo.requiresDescs(13058,13240,14192);mstrmojo.DI.ui.dialogs.DICubesListDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICubesListDialog",title:mstrmojo.desc(13058,"Data Storage"),showTitle:true,help:"Data_Storage_page.htm",children:[{scriptClass:"mstrmojo.DI.DICubesList",alias:"cubes"}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(2102,"Close"),onclick:function(){this.parent.parent.close();}}],onOpen:function A(){if(mstrApp.diParams.userName!==undefined&&!mstrApp.refreshMultipleCubes){this.set("title",mstrmojo.desc(13240,"###'s Data Storage").replace("###",mstrApp.diParams.userName));}if(mstrApp.refreshMultipleCubes){this.set("title",mstrmojo.desc(14192,"Please republish the following datasets by clicking on them."));}this.cubes.set("visible",true);this.cubes.update();if(this._super){this._super();}},onClose:function(){if(mstrApp.refreshMultipleCubes){mstrApp.getRootController().exitApplicationRefreshMultipleCubes();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Editor","mstrmojo.List","mstrmojo.ME.MetricEditBox","mstrmojo.ME.FunctionSelector","mstrmojo.qb.FunctionWizard","mstrmojo.MenuButton","mstrmojo.qb.FFsqlToken","mstrmojo.array");mstrmojo.requiresDescs(221,2827,2919,4449,5891,9105,9106,9107,9108,9109,9110,9925);var Q=mstrmojo.string,S=mstrmojo.hash,O=mstrmojo.array,P={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3},X={0:"valid",1:"unknown",2:"validating",3:"error"},T={0:mstrmojo.desc(9105,"Valid Expression Formula."),1:mstrmojo.desc(9106,"Require Validation?"),2:mstrmojo.desc(9107,"Validation in Progress..."),3:mstrmojo.desc(9108,"Validation Failed with Syntax Error")},B=0,Y=3;function D(Z){return(Z?P.ERROR:P.VALID);}function M(Z){var a=[];O.forEach(Z,function(b){a.push(b.v);});return a.join("").replace(/<\s/g,"<").replace(/>\s/g,">");}function A(e){var d=e[e.length-1],b,c,a=[],Z="";if(e[0]&&e[0].tp!==64){a.push({v:"",tp:64,lv:3,sta:1});}O.forEach(e,function(f){if(!f.oi){Z+=f.v;}else{if(!Q.isEmpty(Z)){a.push({v:Z,tp:2,lv:1});Z="";}a.push(S.copy(f,{lv:1,tp:2,sta:1}));}});if(!Q.isEmpty(Z)){a.push({v:Z,tp:2,lv:1});Z="";}if(d&&d.tp!==-1){a.push({v:"",tp:-1,lv:2,sta:1});}return{omit:a,cn:a.length};}function N(c){var b=A(c),a={v:true,tp:true,lv:true,n:true,did:true,t:true,st:true,cn:true,mi:true,omit:true,extra:true,tknctx:true,sqlti:true,tindex:true,cli:true,sta:true,ix:true},Z={getArrItemName:function(){return"tkn";},isSerializable:function(d){return(a[d])?true:false;}};return mstrApp.getRootController().exprjson2xml("mi",b,Z);}function R(e){var a="",d=1,c="",Z=this.exprEditBox.inputBox;if(Z.doubleByte){c=Z.editNode.innerText||Z.editNode.textContent;Z.ime=false;}else{if(this.oi.type!==0&&this.oi.type!==3){c=M(Z.items);d=2;}else{a=N(Z.items);}}var b=this;mstrApp.getRootController().parseExpression({expr:c,tKnStrm:a,isNew:true,qbrex:d,vo:1},{success:function(g){if(g&&g.mi&&g.mi.items){var f=g.mi.exp.sqltp;if(f!==null){b.sqltp=f;}b.exprEditBox.handleValidation(g.mi,false);if(!g.mi.reject_error_code&&e&&e.success){e.success(g);}else{if(e&&e.failure){e.failure(g);}}}}});}function W(a){var b=[],Z=a.length;O.forEach(a,function(d,c){var e=d.v;if(typeof e!=="string"&&e.toString){e=d.v=e.toString();}if(d.orf){if(c>0&&e.slice(0,1)!==" "){b.push({v:" "});}b.push(d);if(c<Z-1&&e.slice(-1)!==" "){b.push({v:" "});}}else{b.push(d);}});O.forEach(b,function(d,c){a[c]=d;});}function U(a){if(!a.length){return ;}var Z=a[a.length-1];if(Z&&Z.tp===-1){a.pop();}if(a[0]&&(a[0].tp===64||(a[0].tp===36&&a[0].v==="$"))){a.splice(0,1);}W(a);}function K(Z){return["[",Z,"]"].join("");}mstrmojo.qb.ExpressionEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.ExpressionEditor",cssClass:"mstrmojo-MetricEditor mstrmojo-qb-ExpressionEditor",zIndex:70,title:mstrmojo.desc(4449,"Expression"),functionSelector:{scriptClass:"mstrmojo.ME.FunctionSelector"},wizard:{scriptClass:"mstrmojo.qb.FunctionWizard"},model:null,selFuncItem:null,onfunclistChange:function I(){this.toolBox.toolBar.func.set("cm",[{n:mstrmojo.desc(9925,"Functions"),did:-3,fns:this.funclist}]);},onOpen:function E(){var c=this,b=this.oi,f=this.exprEditBox,g=f.inputBox;g.customFunctionMode=false;g.doubleByte=false;b.isSave=false;this.set("funclist",(this.funclist||mstrApp.getRootController().getFunctionList()));var e={items:mstrApp.getRootController().getSuggestionItems(false),isComplete:true};g.set("candidates",e);c.set("candidates",e);f.set("iStatus","");f.set("vStatus",0);var a={0:mstrmojo.desc(4449,"Expression"),1:mstrmojo.desc(9109,"Filter Expression"),3:mstrmojo.desc(4449,"Expression")},d={0:(mstrApp.helpTopics&&mstrApp.helpTopics.expression)||"expression_dialog_box.htm",3:(mstrApp.helpTopics&&mstrApp.helpTopics.expression)||"expression_dialog_box.htm"};this.set("title",[a[b.type]||"",b.n].join(""));this.set("help",d[b.type]||((mstrApp.helpTopics&&mstrApp.helpTopics.condition)||"new_condition_dialog_box.htm"));var Z;if(b&&b.tkn){Z=S.clone(b.tkn);U(Z);g.set("items",Z);}if(b&&b.selFuncItem){c.openPopup("wizard",{fctOi:b.selFuncItem,zIndex:c.zIndex+10,insertOnFinish:function(h){g.insertTokens(h);}});}},onClose:function C(){var Z=this.exprEditBox.inputBox;Z.set("items",[]);Z.itemcount=0;},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-toolBox",alias:"toolBox",children:[{scriptClass:"mstrmojo.Label",cssText:"font-size: 10pt",text:mstrmojo.desc(4449,"Expression")+":"},{scriptClass:"mstrmojo.ToolBar",cssClass:"mstrmojo-oivmSprite grouped",alias:"toolBar",cssText:"float: right",children:[{scriptClass:"mstrmojo.MenuButton",alias:"func",iconClass:"tbInsert",title:mstrmojo.desc(2919,"Insert"),zIndex:80,itemIdField:"did",itemField:"n",itemChildrenField:"fns",isSeparatorItem:function L(Z){return Z[this.itemIdField]===-1;},executeCommand:function V(a){var Z=this.parent.parent.parent,b=Z.exprEditBox.inputBox;if(a.did===-999){Z.openPopup("functionSelector",{functions:Z.funclist,zIndex:Z.zIndex+10,openWizard:function(c){Z.openPopup("wizard",{fctOi:c,zIndex:Z.zIndex+10,insertOnFinish:function(d){b.insertTokens(d);}});}});}else{Z.openPopup("wizard",{fctOi:a,zIndex:Z.zIndex+10,insertOnFinish:function(c){b.insertTokens(c);}});}}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(9110,"Syntax Validation"),iconClass:"tbValidate",onclick:function(){R.call(this.parent.parent.parent);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(2827,"Clear"),iconClass:"tbClear",onclick:function(){var Z=this.parent.parent.parent,a=[];Z.oi.tkn=a;Z.exprEditBox.inputBox.clearTokens(a);Z.exprEditBox.resizeInputBox();}}]}]},{scriptClass:"mstrmojo.ME.MetricEditBox",alias:"exprEditBox",cssText:"height:132px;",children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",browseItemVisible:false,renderBlockSize:1000,item2textCss:function J(Z){return" mstrmojo-qb-SuggestIcon t"+Z.t;},itemFunction:function G(c,Z,a){return new mstrmojo.ME.MetricToken({data:c,brackets:K,isDelimiter:function b(){return this.data.isDelimiter||(this.length()===1&&mstrmojo.qb.FFsqlToken.isDelimiter(this.data.v));}});},isDelimiter:mstrmojo.qb.FFsqlToken.isDelimiter}],markupMethods:{onvStatusChange:function(){var a=this.vStatus,Z=this.vStatusNode;Z.className="mstrmojo-MEBox-vStatus "+X[a];Z.innerHTML=T[a];},oniStatusChange:function(){this.iStatusNode.innerHTML=this.iStatus;this.resizeInputBox();}},handleValidation:function F(c,e){if(!c){this.set("vStatus",P.ERROR);return ;}c.vs=D(c.reject_error_code);this.set("vStatus",c.vs);this.set("iStatus",c.reject_error_description||"");var d=c.items,g=[],f,Z=".",b,a;O.forEach(d,function(j,h){g[h]={};if(j.tp===304&&!/^'.*'$/.test(j.v)){j.v=["'",j.v,"'"].join("");}if(j.tp===309){f=j.v;b=f.lastIndexOf(Z);if(b>=1){j.v=f;g[h].oi={tn:f.slice(0,b),rn:f.slice(b+1),tp:26};}else{g[h].oi={tn:null,rn:f,tp:26};}}if(j.orf){g[h].oi=j.orf;j.v=[" ",j.v," "].join("");}g[h].v=!j.v||(typeof j.v)==="string"?j.v:j.v.toString();g[h].sta=j.sta;});this.inputBox.set("items",g);this.resizeInputBox();if(!e){this.inputBox.focus();}},resizeInputBox:function H(){var b=this.inputBox.domNode,a=this.iStatusNode.parentNode,c=parseInt(this.domNode.clientHeight,10)-7,Z=a.offsetHeight;if(b){b.style.height=c-Z+"px";}}},{scriptClass:"mstrmojo.HBox",cssText:"float: right; border-collapse: separate;margin:10px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(5891,"Save"),onclick:function(){var e=this.parent.parent,d=e.oi,a=d.type,c=d.w,Z=e.exprEditBox.inputBox,b=M(Z.items),g={success:function f(){e.close();}};d.isSave=true;switch(a){case B:R.call(e,{success:function f(){mstrApp.getRootController().addColumnWithExpression(c,b,Z.items,g);}});break;case Y:R.call(e,{success:function f(){mstrApp.getRootController().editColumnExpression(d.cIndex,b,Z.items,g);}});break;default:R.call(e,mstrmojo.func.wrapMethods(d.callbacks,g));}}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.form","mstrmojo.qb.ExpressionEditor","mstrmojo.qb.MissingColumnWarning","mstrmojo.qb.DataService","mstrmojo.warehouse.EnumDataChangeEvents");mstrmojo.requiresDescs(218,219,1442,9220,9221,9222,9223,9224,9225,9226,9227,9228,9229,9230,9945,9946,11164);var P=mstrmojo.string,U=mstrmojo.hash,Y=mstrmojo.array,X=mstrmojo.css,BV=mstrmojo.DI.DIHelpers,AO=mstrmojo.DI.DIConstants,BR=P.decodeHtmlString,A6=mstrmojo.warehouse.EnumDataChangeEvents,BT="    ",A7="A61B85F4485D3B953003B195E58B5138",BU=15,L=200,A4=200,l=0,R=0,a=["0DFE6FB4356F4FA2A0C1C10D0B415355","375104850C3E45EA889D9F5FEB37D317","B2C0FA4020C711D6AD1400C04F0423DE","B2C0FA4120C711D6AD1400C04F0423DE","9AD889E56E4D4E56A127207B4AF77166","AB08D4FC700B4EE58C021BFA2ABD77D0","993F6897863E43CFBEA4969F68BBDED7","C50F2A4F75AE49D6B20E00224967B500","0150F348CB0B4D9AB8CCA458C1ACC4B0","6F7DF5F2449111D5BEA300B0D01A55EF","6F7DF5F3449111D5BEA300B0D01A55EF","6F7DF5F4449111D5BEA300B0D01A55EF","6F7DF5FB449111D5BEA300B0D01A55EF","6F7DF5FE449111D5BEA300B0D01A55EF","6F7DF5FC449111D5BEA300B0D01A55EF","6F7DF5F6449111D5BEA300B0D01A55EF","A9A5B40DF7204F27A04AB3C74225477E","B651EC29A3074BA68F31DE99FC300AF7","7C63D4E70B2741C3A5B54A2EFD40961B","6F7DF5F7449111D5BEA300B0D01A55EF","6F7DF5FD449111D5BEA300B0D01A55EF","6F7DF5F5449111D5BEA300B0D01A55EF","6F7DF5F8449111D5BEA300B0D01A55EF","2146A148C528458181CD816CD96E71D3","8F090B600594488A8FF89A5867C78973","8107C33EDD9911D3B98100C04F2233EA","8107C33FDD9911D3B98100C04F2233EA","6F7DF5FF449111D5BEA300B0D01A55EF","8107C357DD9911D3B98100C04F2233EA","6F7DF606449111D5BEA300B0D01A55EF","6F7DF609449111D5BEA300B0D01A55EF","6F7DF600449111D5BEA300B0D01A55EF","6F7DF601449111D5BEA300B0D01A55EF","6F7DF602449111D5BEA300B0D01A55EF","6F7DF603449111D5BEA300B0D01A55EF","6F7DF608449111D5BEA300B0D01A55EF","6F7DF604449111D5BEA300B0D01A55EF","6F7DF605449111D5BEA300B0D01A55EF","6F7DF607449111D5BEA300B0D01A55EF","8107C347DD9911D3B98100C04F2233EA","8107C327DD9911D3B98100C04F2233EA","F262C811DDA611D3B98100C04F2233EA","F262C812DDA611D3B98100C04F2233EA","F262C813DDA611D3B98100C04F2233EA","F262C830DDA611D3B98100C04F2233EA","F262C814DDA611D3B98100C04F2233EA","F262C815DDA611D3B98100C04F2233EA","F262C816DDA611D3B98100C04F2233EA","F262C817DDA611D3B98100C04F2233EA","F262C818DDA611D3B98100C04F2233EA","F262C819DDA611D3B98100C04F2233EA","F262C81ADDA611D3B98100C04F2233EA","F262C81BDDA611D3B98100C04F2233EA","F262C81CDDA611D3B98100C04F2233EA","F262C81DDDA611D3B98100C04F2233EA","F262C81EDDA611D3B98100C04F2233EA","F262C81FDDA611D3B98100C04F2233EA","F262C820DDA611D3B98100C04F2233EA","F262C821DDA611D3B98100C04F2233EA","F262C822DDA611D3B98100C04F2233EA","F262C831DDA611D3B98100C04F2233EA","F262C824DDA611D3B98100C04F2233EA","F262C825DDA611D3B98100C04F2233EA","F262C826DDA611D3B98100C04F2233EA","F262C828DDA611D3B98100C04F2233EA","F262C829DDA611D3B98100C04F2233EA","5CCBF590DAB311D5AD0E00C04F0423DE","F262C82ADDA611D3B98100C04F2233EA","F262C82BDDA611D3B98100C04F2233EA","F262C82CDDA611D3B98100C04F2233EA","F262C82DDDA611D3B98100C04F2233EA","F262C82EDDA611D3B98100C04F2233EA","F262C82FDDA611D3B98100C04F2233EA","A202C222DD9D11D3B98100C04F2233EA","A202C223DD9D11D3B98100C04F2233EA","A202C224DD9D11D3B98100C04F2233EA","A202C225DD9D11D3B98100C04F2233EA","A202C226DD9D11D3B98100C04F2233EA","A202C228DD9D11D3B98100C04F2233EA","A202C227DD9D11D3B98100C04F2233EA","A202C229DD9D11D3B98100C04F2233EA","A202C210DD9D11D3B98100C04F2233EA","A202C211DD9D11D3B98100C04F2233EA","A202C212DD9D11D3B98100C04F2233EA","A202C213DD9D11D3B98100C04F2233EA","A202C22ADD9D11D3B98100C04F2233EA","A202C22BDD9D11D3B98100C04F2233EA","A202C214DD9D11D3B98100C04F2233EA","A202C215DD9D11D3B98100C04F2233EA","A202C216DD9D11D3B98100C04F2233EA","A202C217DD9D11D3B98100C04F2233EA","A202C22DDD9D11D3B98100C04F2233EA","A202C218DD9D11D3B98100C04F2233EA","A202C22CDD9D11D3B98100C04F2233EA","A202C219DD9D11D3B98100C04F2233EA","A202C21ADD9D11D3B98100C04F2233EA","A202C22EDD9D11D3B98100C04F2233EA","A202C22FDD9D11D3B98100C04F2233EA","A202C230DD9D11D3B98100C04F2233EA","A202C231DD9D11D3B98100C04F2233EA","A202C21BDD9D11D3B98100C04F2233EA","A202C21CDD9D11D3B98100C04F2233EA","A202C232DD9D11D3B98100C04F2233EA","A202C233DD9D11D3B98100C04F2233EA","A202C234DD9D11D3B98100C04F2233EA","A202C21DDD9D11D3B98100C04F2233EA","A202C21EDD9D11D3B98100C04F2233EA","A202C236DD9D11D3B98100C04F2233EA","A202C21FDD9D11D3B98100C04F2233EA","A202C220DD9D11D3B98100C04F2233EA","A202C237DD9D11D3B98100C04F2233EA","A202C238DD9D11D3B98100C04F2233EA","A202C239DD9D11D3B98100C04F2233EA","A202C221DD9D11D3B98100C04F2233EA","A202C235DD9D11D3B98100C04F2233EA","A202C23ADD9D11D3B98100C04F2233EA","A202C23BDD9D11D3B98100C04F2233EA","9C374206DD9F11D3B98100C04F2233EA","9C374207DD9F11D3B98100C04F2233EA","9C374209DD9F11D3B98100C04F2233EA","9C374220DD9F11D3B98100C04F2233EA","9C37421CDD9F11D3B98100C04F2233EA","9C37420CDD9F11D3B98100C04F2233EA","9C374208DD9F11D3B98100C04F2233EA","9C37421DDD9F11D3B98100C04F2233EA","9C374236DD9F11D3B98100C04F2233EA","9C37420DDD9F11D3B98100C04F2233EA","9C374233DD9F11D3B98100C04F2233EA","9C37420EDD9F11D3B98100C04F2233EA","9C374214DD9F11D3B98100C04F2233EA","9C374216DD9F11D3B98100C04F2233EA","9C374215DD9F11D3B98100C04F2233EA","9C37421EDD9F11D3B98100C04F2233EA","9C374219DD9F11D3B98100C04F2233EA","9C37421ADD9F11D3B98100C04F2233EA","9C374218DD9F11D3B98100C04F2233EA","9C37421BDD9F11D3B98100C04F2233EA","9C37420FDD9F11D3B98100C04F2233EA","9C374210DD9F11D3B98100C04F2233EA","9C37420BDD9F11D3B98100C04F2233EA","9C37421FDD9F11D3B98100C04F2233EA","9C374211DD9F11D3B98100C04F2233EA","9C374221DD9F11D3B98100C04F2233EA","9C37420ADD9F11D3B98100C04F2233EA","9C374212DD9F11D3B98100C04F2233EA","9C374213DD9F11D3B98100C04F2233EA"],BF=12,B=4,AE=1,A2=2,Be=4,BC=256,BP=15,Bc=1,BA=2,AP=4,Ar=8,b=1,Am=2,AK=8,Bm=16,AM=1,H=0,E=" ",c=".",Q="/",Au=";";function K(Bn){var Bo=P.trim(Bn);if(Bo.slice(-1)===Au){Bo=Bo.slice(0,-1);}return Bo;}function x(Bn,Bo){if(!Bo){return Bn;}return(Bn.indexOf(E)>-1||Bn.indexOf(c)>-1||Bn.indexOf(Q)>-1)?Bo.replace("#0",Bn):Bn;}function j(Bp,Bs,Bq){var Bu=[],Bo=Bq.length,Bt,Bn,Br,Bv=10;Bn=mstrApp.isBigQuery?"":((this.getDBRole&&this.getDBRole(this.SelDBRoleID).mdDBRole.cpat)||"");Bu.push({v:"select",oi:{n:"select",sta:100,t:100}},{isNew:true,v:" ",isDelimiter:true});Y.forEach(Bq,function(Bx,Bw){Bu.push({v:x(Bx.cln,Bn)});Bt=Bw<Bo-1;if(Bt){Bu.push({v:",",isDelimiter:true});}Bu.push({v:"\n",isDelimiter:true});if(Bt){for(Br=0;Br<Bv;++Br){Bu.push({v:" ",isDelimiter:true});}}});Bs=x(Bs,Bn);Bu.push({v:"from",oi:{n:"from",sta:100,t:100}},{v:" ",isDelimiter:true},{v:" ",isDelimiter:true},{v:" ",isDelimiter:true},{v:(Bp?x(Bp,Bn)+c+Bs:Bs)},{v:";"});this.raiseEvent({name:"sqlTokensAdded",value:Bu});}function AA(Bo){if(!Bo||!Bo.length){return ;}var Bn=Bo[Bo.length-1];if(Bn&&Bn.tp===-1){Bo.pop();}if(Bo[0]&&(Bo[0].tp===64||(Bo[0].tp===36&&Bo[0].v==="$"))){Bo.splice(0,1);}}function C(Bo){var Bn=[];Y.forEach(Bo,function(Bp){Bn.push(Bp.v);});return Bn.join(" ");}function Ai(Bo){var Bn={">=":2,"<>":5,"<=":4,"<":3,">":1},Bp;for(Bp in Bn){if(Bo.indexOf(Bp)>-1){return Bn[Bp];}}return 0;}function D(Bp,Br){var Bn=function(Bt,Bs){return mstrmojo.array.stringSorter(Bt.n||Bt.did,Bs.n||Bs.did);},Bq,Bo=[];if(Br){Y.forEach(Bp,function(Bs){Y.forEach(Bs.fns,function(Bt){if(Y.indexOf(a,Bt.did)>-1){Bs.fns=Bs.fns.sort(Bn);Bq=[];Y.forEach(Bs.fns,function(Bu){if(Y.indexOf(a,Bu.did)>-1){Bq.push(Bu);}});Bs.fns=Bq;Bo.push(Bs);return false;}});});}else{Y.forEach(Bp,function(Bs){Y.forEach(Bs.fns,function(Bt){if(Y.indexOf(BW,Bt.did)>-1){Bs.fns=Bs.fns.sort(Bn);if(mstrApp.isCloudPro&&Bt.did===BW[2]){Y.removeItems(Bs.fns,"did",[{did:BM}]);}Bo.push(Bs);return false;}});});}Bo=Bo.sort(Bn);return Bo;}var AR={1:"Sum",2:"Avg",3:"Min",4:"Max",5:"Count",6:"Count<Distinct=true>"};var BW=["8107C31BDD9911D3B98100C04F2233EA","6F7DF5F8449111D5BEA300B0D01A55EF","4A257916A153468384320E8DB7FD338B","8107C345DD9911D3B98100C04F2233EA","6F7DF605449111D5BEA300B0D01A55EF","8107C324DD9911D3B98100C04F2233EA","F262C81CDDA611D3B98100C04F2233EA"];var BM="8107C344DD9911D3B98100C04F2233EA",Bh=".";function BE(Bo){var Bp=Bo.indexOf(Bh),Bn;if(Bp>=1){Bn=Bo.slice(0,Bp).toLowerCase();}return Bn;}function AB(Bu,Bo){if(!Bu){return false;}var Br=Bu.nds,Bt;if(Br){var Bs=[],Bn,Bp;Y.forEach(Br,function(Bw,Bv){AB(Bw,Bo)&&Bs.push(Bv);});for(Bn=Bs.length-1;Bn>-1;Bn--){Br.splice(Bs[Bn],1);}Bp=Br.length;if(Bp===1){Bu=Br[0];}return(Bp===0);}var Bq;Y.forEach(Bu.expr,function(Bv){if(Bv.tp===309){Bt=BE(Bv.v);if(Bt!==undefined&&Bo===Bt){Bq=true;return false;}}});return Bq;}function A5(Br,Bn,Bs){if(!Bs){return ;}var Bq=Bs.expr,Bo,Bp=Bs.cols;Y.forEach(Bq,function(Bt){Bo=Bt.tknctx&&Bt.tknctx.oi;if(Bo&&Bo.tp===26){if(Bt.extra.sqlti.als===Br){Bt.extra.sqlti.als=Bn;Bt.v=(Bt.v+"").replace(Br,Bn);}}});Y.forEach(Bp,function(Bt){if(Bt.t===Br){Bt.t=Bn;Bt.v=(Bt.v+"").replace(Br,Bn);}});Bs.n=(Bs.n+"").replace(Br,Bn);Y.forEach(Bs.nds,function(Bt){A5(Br,Bn,Bt);});}function I(Bp,Bu){Bp=Bp||{};if(!Bu){return ;}var Bs=Bu.expr,Bo,Bn,Br=Bu.cols,Bt,Bq;Y.forEach(Bs,function(Bv){if(Bv.tp===309){var Bx=Bv.v.toString().indexOf(Bh),Bw=Bv.v.toString();if(Bx>=1){Bn=Bw.slice(0,Bx).toLowerCase();Bq=Bw.slice(Bx+1).toLowerCase();if(Bn&&Bq){Bp[Bn]=Bp[Bn]||{};Bp[Bn][Bq]=true;}}}});Y.forEach(Br,function(Bv){Bn=Bv.t.toLowerCase();Bp[Bn]=Bp[Bn]||{};Bp[Bn][Bv.col.toLowerCase()]=true;});Y.forEach(Bu.nds,function(Bv){I(Bp,Bv);});}var W=mstrmojo.expr,BG=W.ET,A={19:" AND ",20:" OR ",21:"(NOT( "},AU="))";function An(Br){if(!Br){return"";}if(!Br.nds){return Br.n||"";}var Bp=[],Bq=Br.nds,Bo=Br.fn,Bn;Y.forEach(Bq,function(Bt,Bs){Bn=Bt.not;if(Bs!==0){Bp.push(A[Bo]);}Bn&&Bp.push(A[21]);Bp.push("(");Bp.push(An(Bt));Bp.push(")");Bn&&Bp.push(AU);});return Bp.join("");}function AJ(Bn){return BR(Bn).replace(/&apos;/g,"'");}function Ah(Bn){return Bn.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}var BI=function(Bn){if(Bn==null){return"null";}var Bo=typeof (Bn);if(Bo!="object"){return Bo;}else{if(Bn.length===undefined){return"object";}else{return"array";}}};var AF=[{n:"Text",v:"3"},{n:"Number",v:"2"},{n:"Date",v:"8"},{n:"Time",v:"9"},{n:"DateTime",v:"1"},{n:"URL",v:"5"},{n:"Email",v:"6"},{n:"HTML Tag",v:"7"},{n:"Symbol",v:"10"},{n:"Big Decimal",v:"11"},{n:"Phone Number",v:"12"}];function u(Br){var Bp=[],Bo=[];var Bq={mi:true,cn:true,v:true,tp:true,lv:true,sta:true,tkn:true};Bp.push({lv:3,sta:1,tp:64,v:""});Bp.push({lv:1,sta:1,tp:2,v:Br});Bp.push({lv:2,sta:1,tp:-1,v:""});var Bn={getArrItemName:function(Bu,Bs,Bt){return"tkn";},isSerializable:function(Bu,Bt,Bs){return(Bq[Bu])?true:false;}};Bo.push('<mi cn="3">');Bo.push(P.json2xml("tkn",Bp[0],Bn));Bo.push(P.json2xml("tkn",Bp[1],Bn));Bo.push(P.json2xml("tkn",Bp[2],Bn));Bo.push("</mi>");return Bo.join("");}var Ak=0,f=1,o=2,Bg=3,Bf=4,Av=5,F=6,AI=7,BQ=8,BH=9,Aq=10,Ad=11,AS=12;var Al={0:Ak,1:o,2:o,3:o,4:o,5:o,6:o,7:o,8:Bg,9:Bg,10:Bg,11:Bg,12:Bg,13:Bg,14:BQ,15:BH,16:f,17:Bg,18:Bg,30:Ad,31:Ak,33:Ak};function q(Bp,Bt){var Br=[],Bo,Bs;for(var Bq=0,Bn=Bt.length;Bq<Bn;Bq++){Bo=Bt[Bq];if(Bp.uiids[Bo.tid+Bo.cid]){Bs=Bp.uiids[Bo.tid+Bo.cid];Br.push(Bs);}}return Br;}function AW(Bs,Bp,Bt,Bn,Bz,Bw){if(!Bp.ftype){var Bo=Ah(Bp.exp);if(Bo.indexOf("? aptqbr_prompt")>-1){Bw.push({n:Bo,cid:Bn.chn[0].cmid});return ;}var B0=q(Bs,AY(Bn,[])),Bv,Bx=[];Y.forEach(B0,function(B1){Bv=mstrmojo.all[B1];Bv&&Bv.updateState&&Bv.updateState(2);Bx.push({t:Bv.srcTable,col:Bv.text});});return Bt.push({et:"*",n:Bo,expr:[{v:Bo}],sqltp:Bz,cols:Bx});}switch(Bp.ftype){case 19:case 20:case 21:var Br=[],By;for(var Bq=0,Bu=Bp.children.length;Bq<Bu;Bq++){By=Bp.children[Bq];AW(Bs,By,Br,Bn.chn[Bq],Bz,Bw);}if(Br.length==0){return ;}if(Br.length<Bu&&Br.length==1){Bt.push(Br[0]);}else{Bt.push({et:14,fn:Bp.ftype,nds:Br,not:(Bp.ftype==21),sqltp:Bz});}break;default:break;}}function M(Bp,Br,Bn){if(!Br.ftype){Bn.push({lcid:Bp.chn[0].col,rcid:Bp.chn[1].col,exp:Br.exp});return Br.exp;}var Bq,Bo,Bs;switch(Br.ftype){case 19:case 20:Bq=M(Bp.chn[0],Br.children[0],Bn);Bo=M(Bp.chn[1],Br.children[1],Bn);Bs=Bq+((Br.ftype==19)?" AND ":" OR ")+Bo;break;case 21:Bs=" NOT "+M(Bp.chn[0],Br.children[0],Bn);break;default:break;}return Bs;}function AY(Bp,Bq){var Br=Bp.chn;if(!Br){if(Bp.col&&Bp.stbid){Bq.push({cid:Bp.col,tid:Bp.stbid});}return Bq;}for(var Bo=0,Bn=Br.length;Bo<Bn;Bo++){Bq=AY(Br[Bo],Bq);}return Bq;}function g(Bn){Bn.raiseEvent({name:"dataPreview",mappings:Bn.mappings,dataset:Bn.dataset,selectedColumns:Bn.selectedClns,isRefined:Bn.isRefined});}function BJ(Bn,Bq,Bo){var Bp=Bn[Bn.length-1].oi.def.csl.roo.chn[0].va.vv;Bp=Bp?Ah(Bp):"";mstrApp.getRootController().raiseEvent({name:"reportModeChange",mode:2,value:Bp});Bo.populateFFSQLMapping(Bq);if(Bo.firstTimeLoading){g(Bo);Bo.firstTimeLoading=false;}}function At(CP,Bs){if(!CP||!CP.btb){return ;}var CA=CP.btb;var CU=CP.datap.maps;if(Bs.firstTimeLoading){Bs.orimaps=CU;}Bs.refresh_opt=CA[0].oi.def.crpt;var B9=null;if(CA[0].oi.ext_type===304){Bs.set("isFFSQL",true);Bs.set("FFSQLMode",true);mstrApp.isFFSQL=mstrApp.isFFSQLMode=true;for(var Ca=0,CB=CA.length;Ca<CB;Ca++){if(CA[Ca].oi.tp===53){B9=CA[Ca].oi.def.dbr.did;}}B9&&Bs._set_SelDBRoleID("SelDBRoleID",B9,false);BJ(CA,CU,Bs);return ;}var Cc={},Bp={},Bo,Br;for(var Ca=0,CB=CA.length;Ca<CB;Ca++){Br=CA[Ca].oi;switch(Br.tp){case 53:Cc[Br.did]={cs:Br.def.cs.cs,tbn:AJ(Br.def.tbn),did:Br.did,ns:Br.def.ns};break;case 26:Bp[Br.did]={did:Br.did,cln:AJ(Br.def.cln),dttp:Br.def.dt.tp,dtps:Br.def.dt.ps,dtsc:Br.def.dt.sc};break;case 3:Bo=Br.efd;break;default:break;}}var CC=null,CQ=null;for(var Ca=0,CB=Bo.length;Ca<CB;Ca++){CQ=Bo[Ca].oi;switch(CQ.tp){case 53:CC=CQ.def.sqs.c_c[0];B9=CQ.def.dbr.did;break;default:break;}}Bs._set_SelDBRoleID("SelDBRoleID",B9,false);if(CC===null){return ;}var CJ=CC.sqcs.c_c;var B5=CC.sjs.c_c;var Cb=CC.stbs.c_c;var B1=CC.whe;var CS=CC.w_cond;var Cf=CC.he;var Bu=CC.h_cond;Bs.selectedClns=[];Bs.dbtables=[];Bs.joins=[];Bs.joinsInfo={};Bs.uiids={};Bs.tables={};var CX=Bs.selectedClns;var CO={},B8,Cd,B0,B4,Bx;for(var Ca=0,CB=CJ.length;Ca<CB;Ca++){if(CJ[Ca].der&2147483648){CX.push({isDerived:true,existing:true});continue;}B8=AY(CJ[Ca].exp.roo,[]);Cd=AJ(CJ[Ca].exp.exp);CX.push({wid:[],expr:[{v:Cd}],existing:true});for(var CZ=0;CZ<B8.length;CZ++){Bx=B8[CZ];B0=Bx.cid;B4=Bx.tid;CO[B4]=CO[B4]||{};CO[B4][B0]=CO[B4][B0]||{};CO[B4][B0].state=1;CO[B4][B0].count=!CO[B4][B0].count?1:CO[B4][B0].count+1;CX[Ca].wid.push(B4+B0);}}Bs.tbns={};var B3=Bs.pos_hash;var Bw=Bs.tbns,CY=[];var CV,Bv,Bt,B0,CG,CT,B7;for(var Ca=0,CB=Cb.length;Ca<CB;Ca++){CY[Ca]={};CV=Cb[Ca];B4=CV.id;Bv=CV.dbt.did;B7=CV.als?AJ(CV.als):Cc[Bv].tbn;CG=Cc[Bv].cs;if(B3&&B3[B7]){CY[Ca].pos={w:B3[B7].w,h:B3[B7].h,t:B3[B7].t,l:B3[B7].l};}else{Bt=CV.sqltf;if(Bt&&Bt.length){CY[Ca].pos={w:(Bt[0]&&Bt[0].pdv)/BU||A4,h:(Bt[1]&&Bt[1].pdv)/BU||L,t:(Bt[2]&&Bt[2].pdv)/BU||l,l:(Bt[3]&&Bt[3].pdv)/BU||R};}}CT=[];for(var CZ=0,CE=CG.length;CZ<CE;CZ++){B0=CG[CZ].did;CT.push(U.copy(Bp[B0]));if(CO[B4]&&CO[B4][B0]){CT[CZ].state=1;CT[CZ].count=CO[B4][B0].count;}}CY[Ca].did=B4;CY[Ca].cs=CT;CY[Ca].tbn=B7;CY[Ca].ns=Cc[Bv].ns;CY[Ca].dbtbn=Cc[Bv].tbn;Bw[B7]=B7;}if(Bs.firstTimeLoading&&!Bs.isNew){Bs.orits=Bs.orits||CY.slice(0);}var B6=Bs.orits;Y.forEach(CY,function(Cg){if(Y.find(B6,"did",Cg.did)>-1){Cg.existing=true;Cg.readOnly=mstrApp.isCloudPro;}});Bs.raiseEvent({name:"BindingTableLoaded",value:CY});for(var Ca=0,CB=CX.length;Ca<CB;Ca++){var CW=CX[Ca].wid;if(CW){for(var CZ=0,CE=CW.length;CZ<CE;CZ++){CW[CZ]=Bs.uiids[CW[CZ]];}}}Bs.populateMappings(CU);if(CP.datap.data){Bs.populateDataset(CP.datap.data);}g(Bs);var B2,CM,Bq,By,CN,CH,CK,Bn,Cd,CD,Ce;for(var Ca=0,CB=B5.length;Ca<CB;Ca++){B2=B5[Ca];CM=B2.ltid,Bq=B2.rtid,By=B2.jt,idx=B2.ix;CH=B2.cdn.roo;Ce=[];Cd=AJ(M(CH,B2.exp_bo,Ce));CD=Bs.uiids[CM]+Bs.uiids[Bq];Bs.joins.push(CD);Bs.joinsInfo[CD]=new Object();Bs.joinsInfo[CD].jt=""+By;Bs.joinsInfo[CD].exp=Cd;Bs.joinsInfo[CD].srctID=Bs.uiids[CM];Bs.joinsInfo[CD].tgttID=Bs.uiids[Bq];if(!Bs.joinsInfo[CD].links){Bs.joinsInfo[CD].links=new Object();}if(Bs.tables[Bs.uiids[CM]].njoins){Bs.tables[Bs.uiids[CM]].njoins++;}else{Bs.tables[Bs.uiids[CM]].njoins=1;}if(Bs.tables[Bs.uiids[Bq]].njoins){Bs.tables[Bs.uiids[Bq]].njoins++;}else{Bs.tables[Bs.uiids[Bq]].njoins=1;}for(var CZ=0;CZ<Ce.length;CZ++){CK=Ce[CZ].lcid;Bn=Ce[CZ].rcid;Cd=AJ(Ce[CZ].exp);var CR=Bs.uiids[CM+CK],Bz=Bs.uiids[Bq+Bn];Bs.joinsInfo[CD].links[CR+Bz]={srcw:mstrmojo.all[CR],tgtw:mstrmojo.all[Bz],coords:[],exp:Cd,jid:CD,op:Ai(Cd)};if(Bs.joinsInfo[CD].nlinks){Bs.joinsInfo[CD].nlinks++;}else{Bs.joinsInfo[CD].nlinks=1;}}}Bs.raiseEvent({name:"JoinsLoaded"});var CA=[],CI=[];if(B1.exp!=""){AW(Bs,CS,CA,B1.roo,0,CI);CA.length&&(Bs.conditions.where=CA[0]);if(CI.length&&!Bs.isCubeReport){Bs.pattrs={};var CF=CU.amps,CL;Y.forEach(CF,function(Cg){if(Y.find(CI,"cid",Cg.afmps[0].sqc.id)>=0){CL=Cg.aimp;Bs.pattrs[CL.atid]={n:CL.atnm,tp:12};}});}}if(Cf.exp!=""){CA=[];AW(Bs,Bu,CA,Cf.roo,1);CA.length&&(Bs.conditions.having=CA[0]);}Bs.firstTimeLoading=false;}function AQ(Bp,Bo,Bn){mstrApp.getRootController().getDataService()[Bn||"submitRequest"](Bp,Bo);}function G(Bn,Bq,Bp){var Bo={};if(!Bn[Bq]){Bn[Bq]=Bp;}else{if(!Bn[Bp]){Bn[Bp]=Bq;}else{while(Bn[Bq]){Bo[Bq]=true;Bq=Bn[Bq];if(Bo[Bq]){return ;}}Bn[Bq]=Bp;}}}function BN(Bn,Bp,Bo){if(Bn[Bp]){delete Bn[Bp];}else{if(Bn[Bo]){delete Bn[Bo];}}}function BD(Bn,Bq,Bp){var Bo={};while(Bn[Bq]){Bo[Bq]=true;Bq=Bn[Bq];if(Bo[Bq]){return true;}}while(Bn[Bp]){Bo[Bp]=true;Bp=Bn[Bp];if(Bo[Bp]){return true;}}return Bq===Bp;}function Bj(Bs,Bq){var Bt=[],Bp,Bo,Bn,Br;for(Bo in Bs){Bn=Bs[Bo].links;Br=Bn[0];Bp={srcIndex:Bq.gettIndex(Br.srcw.srcID),destIndex:Bq.gettIndex(Br.tgtw.srcID),jtype:Br.jtype,jexp:Bs[Bo].jexp};Bt.push(Bp);}return Bt;}mstrmojo.qb._hasQBModel=mstrmojo.provide("mstrmojo.qb._hasQBModel",{id:"QBuilderModel",tables:{},selLink:null,dbtbls:{},uiids:{},riid:"",analysisID:null,alertTitle:null,msgid:"",dbtables:[],selectedClns:[],joins:[],joinsInfo:{},joinCols:{},dbrs:[],dsns:[],drivers:[],dbms:[],suppdbs:[],pos_hash:{},bindingT:[],tbns:{},catalogRefresh:false,SelDBRoleID:null,prevDBRoleID:null,isDI:false,FFSQLMode:false,isFFSQL:false,isCloud:false,supportTimeGeo:true,isCubeReport:true,autoRefreshSQL:false,isDirty:false,SQLPreviewStmt:"",SQLstmt:undefined,refresh_opt:1,mappings:[],cloneMappings:[],dataset:[],cacheMP:[],cacheDS:[],conditions:{},cnum:0,datatypes:AF,init:function Bi(Bn){if(this._super){this._super(Bn);}this.dbtables=[];this.tables={};this.selectedClns=[];this.tbns={};this.joins=[];this.joinsInfo={};this.joinCols={};this.uiids={};this.conditions={};this.mappings=[];this.cloneMappings=[];this.dataset=[];this.cacheMP=[];this.cacheDS=[];},addLink:function m(Bp,Bt,Bo,Bs){var Bq=this,Bx=Bp.id+Bt.id,By=Bq.joinsInfo[Bo].links,Br=Bq.joinsInfo[Bo].jt;var Bw=this.getjIndex(Bo),Bn=this.brackets(Bp.oriexpr)+"="+this.brackets(Bt.oriexpr),Bv=Bq.joinsInfo[Bo].exp+" AND "+Bn;if(By[Bx]||By[Bt.id+Bp.id]){return ;}var Bu={success:function(Bz){Bq.joinsInfo[Bo].exp=Bv;By[Bx]={};By[Bx].srcw=Bp;By[Bx].tgtw=Bt;By[Bx].coords=[];By[Bx].exp=Bn;By[Bx].jid=Bo;Bq.joinsInfo[Bo].exp=Bv;if(Bs&&Bs.success){Bs.success();}Bq.raiseEvent({name:"JoinsAdded"});}};G(Bq.joinCols,Bp.id,Bt.id);mstrApp.getRootController().getDataService().editJoin(Bu,{jindex:Bw,exp:Bv,tbid:Bq.tableID||"",jtype:Br});},removeLink:function AC(Bt,Bn,Bq){var Bo=this,Bw=Bo.joinsInfo[Bn].links,Bp=Bo.joinsInfo[Bn].jt,Bv=Bo.getjIndex(Bn),Bs="",Bu=Bw[Bt];U.forEach(Bw,function(By,Bx){if(Bx!==Bt){Bs+=(Bs?" AND ":"")+By.exp;}});BN(Bo.joinCols,Bu.srcw.id,Bu.tgtw.id);if(!Bs){Bo.removeJoin(Bn,Bq);}else{var Br={success:function(Bx){mstrApp.msgid=Bx.msgid;Bo.joinsInfo[Bn].exp=Bs;delete Bw[Bt];if(Bq&&Bq.success){Bq.success();}}};mstrApp.getRootController().getDataService().editJoin(Br,{jindex:Bv,exp:Bs,tbid:Bo.tableID||"",jtype:Bp});}},getTouchValue:function Aw(Bn,Bs){for(var Bq in this.joinsInfo){var Bp=this.joinsInfo[Bq].links;for(var Br in Bp){var Bo=Bp[Br].coords;if(this.inPoly(Bo,Bn,Bs)){return[Bq,Br];}}}return null;},inPoly:function BB(Bp,Bz,By){var Bv=Bp.length;var Bs,Bn,B0,Bu,Bq,Bx,Bo,Bw,Bt;var Br=false;if(Bv/2<3){return false;}B0=Bp[Bv-2];Bu=Bp[Bv-1];for(Bt=0;Bt<Bv;Bt=Bt+2){Bs=Bp[Bt];Bn=Bp[Bt+1];if(Bs>B0){Bq=B0;Bo=Bs;Bx=Bu;Bw=Bn;}else{Bq=Bs;Bo=B0;Bx=Bn;Bw=Bu;}if((Bs<Bz)==(Bz<=B0)&&((By-Bx)*(Bo-Bq)<(Bw-Bx)*(Bz-Bq))){Br=!Br;}B0=Bs;Bu=Bn;}return Br;},exprEditor:function(Bo,Bp,Bq,Bn){this.getFunctions();},brackets:function(Bn){return"["+Bn+"]";},isEquivalentExpr:function(Bp,Bo){var Bn=function Bn(Bq){return Bq.replace(/\s/g,"").replace(/\[+(.*?)\]+/g,"$1").replace(/\(+(.*?)\)+/g,"($1)").toUpperCase();};return(Bn(Bp)===Bn(Bo));},_set_SelDBRoleID:function(Bq,Bo){var Bn=this,Bp=(Bn.SelDBRoleID!==Bo);this._super&&this._super(Bq,Bo);Bn.SelDBRoleID=Bo;if(Bp&&Bo){Bn.setDBRole&&Bn.setDBRole(Bo);}Y.forEach(Bn.dbrs,function(Br){if(Br.data.isPrimary){Br.data.isPrimary=false;Bn.raiseEvent({name:A6.DBROLE_CHANGED,item:Br});}if(Br.did===Bo){Br.data.isPrimary=true;Bn.raiseEvent({name:A6.DBROLE_CHANGED,item:Br});}});if(Bp){Bn.raiseEvent({name:A6.DBTABLES_ENABLED,value:Bn.getAvailableTablesEnabled()});mstrApp.getRootController().enableButton();}return Bp;},setDBRole:function(Bo){var Bn=this;Bn.connectLiveSupport=undefined;mstrApp.getRootController().getDataService().setDBRole({success:function(Bp){mstrApp.msgid=Bp.msgid;Bn.loadConnectLiveSupport();}},{dbrid:Bo,tbid:this.tableID||""});},autoMap:function(Bp,Bo,Br){var Bq=this;if(!Bq.FFSQLMode){if(Bq.getColumnsCount()===0){mstrmojo.alert(mstrmojo.desc(9945,"Please add at least one column and try again."));if(Bp&&Bp.failure){Bp.failure();}return ;}else{if(Bq.getTablesCount()===0){mstrmojo.alert(mstrmojo.desc(9946,"Please add at least one table and try again."));if(Bp&&Bp.failure){Bp.failure();}return ;}}}var Bn={success:function(Bt){Bq.isDirty=false;if(!Bo){var Bs=Bt.datap,Bw=Bs.maps,Bu=Bs.data;if(Bq.FFSQLMode){var Bv=[];Bq.populateFFSQLMapping(Bw);Bq.populateDataset(Bu);}else{Bq.populatePreview(Bw,Bu);}g(Bq);}if(Bp&&Bp.success){Bp.success(Bt);}}};Bq.loadReport(Be,BP,b+Am,Br?H:AM,Bn);},convertToQueryBuilder:function z(Bn){var Bo=this;mstrApp.getRootController().getDataService().convertToQB({success:function Bp(Bq){mstrApp.msgid=Bq.msgid;mstrApp.isFFSQLMode=false;Bo.isDirty=true;Bo.FFSQLMode=false;Bo.mappings=Bo.cacheMP;Bo.dataset=Bo.cacheDS;g(Bo);Bn&&Bn.success&&Bn.success(Bq);}},{tbid:Bo.tableID||""});},convertToFFSQL:function AH(Bq,Bo,Bn){var Bp=this;Bp.SQLstmt=Bq;mstrApp.getRootController().getDataService().convertToFFSQL({success:function Br(Bs){mstrApp.msgid=Bs.msgid;Bp.isDirty=true;Bp.FFSQLMode=true;mstrApp.isFFSQLMode=true;Bp.cacheMP=Bp.mappings;Bp.cacheDS=Bp.dataset;Bp.dataset=[];Bp.mappings=[];if(!Bn){g(Bp);}Bo&&Bo.success&&Bo.success(Bs);}},{tbid:Bp.tableID||"",exp:P.encodeXMLAttribute(Bq)});},isMultiPassSQL:function Ac(Bn){return K(Bn).indexOf(Au)>-1;},autoMapFFSQL:function Ab(Bo,Bq){var Bn=this;Bo=K(Bo);mstrApp.getRootController().getDataService().editFFSQL({success:function Bp(Br){Bn.isDirty=Bn.isDirty||(P.trim(Bn.SQLstmt)===P.trim(Bo)?false:true);Bn.SQLstmt=Bo;Bn.isDDA=Bn.isDDA&&!Bn.isMultiPassSQL(Bo);if(Bo){Bn.autoMap(Bq);}else{Bn.dataset=[];Bn.mappings=[];g(Bn);Bq&&Bq.success&&Bq.success({msgid:mstrApp.msgid});}}},{exp:P.encodeXMLAttribute(Bo).replace(/\t/g,BT),tbid:Bn.tableID||""});},editFFSQL:function BX(Bo,Bp){var Bn=this;if(this.SQLstmt===Bp){if(Bo&&Bo.success){Bo.success();return ;}}Bp=K(Bp);mstrApp.getRootController().getDataService().editFFSQL({success:function Bq(Br){mstrApp.msgid=Br.msgid;Bn.isDirty=true;Bn.SQLstmt=Bp;Bo&&Bo.success&&Bo.success(Br);}},{exp:P.encodeXMLAttribute(Bp).replace(/\t/g,BT),tbid:Bn.tableID||""});},updateSQL:function(Bn){this.getSQL(Bn);},getSQL:function e(Bo){var Bp=this;if((!Bp.SelDBRoleID&&Bp.riid===A7)||Bp.dbtables.length===0){var Bn="";if(Bo&&Bo.success){Bo.success(Bn);}}else{Bp.loadReport(A2,BP,null,null,{success:function Bq(Bs){var Bt=Bs.sqls[Bs.sqls.length-1],Br=Bt?Ah(Bt):"";if(Bo&&Bo.success){Bo.success(Br);}}},true);}},isNameUnique:function(Bs,Bo,Bp){var Bt=this,Br=Bt.mappings;for(var Bq=0,Bn=Br.length;Bq<Bn;Bq++){if(Bq!=Bo){if(Bp===Br[Bq].alias&&Br[Bo].tp==Br[Bq].tp){return false;}}}return true;},mapAttribute:function(Bz,Bo,Bq,Bv,Bw,Bx){var Bp=this,Bs=Bp.mappings;for(var Br=0,Bu=Bs.length;Br<Bu;Br++){if(Bs[Br].afid===(Bo+Bq)){if(Bw&&Bw.failure){Bw.failure(mstrmojo.desc(9926,"The attribute form you select has been mapped. Please choose a different one."));}return false;}}var Bt=Y.find(Bs,"did",Bz),Bn=Bs[Bt],By=function By(B0){mstrApp.getRootController().getDataService().remapObject({success:function B1(B2){Bp.autoMap();if(Bw&&Bw.success){Bw.success(B2);}}},{mpcs:JSON.stringify(B0),docid:mstrApp.docID||"",suppressError:true});};if(Bn.isIDForm&&Bn.multiForms&&!Bn.ipa){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:function(){var B0=[];Y.forEach(Bs,function(B1){if(B1.oid===Bx&&B1.did!==Bz){B0.push({did:B1.did,aid:"",ot:BF});}});B0.push({did:Bz,aid:Bo,fid:Bq});By(B0);}}});}else{By([{did:Bz,aid:Bo,fid:Bq}]);}},unmap:function(Br,Bq){var Bs=this,Bt=Bs.mappings,Bo=Y.find(Bt,"did",Br),Bn=Bt[Bo],Bp=function Bp(Bu){mstrApp.getRootController().getDataService().remapObject({success:function Bv(Bw){Bs.autoMap();}},{mpcs:JSON.stringify(Bu),docid:mstrApp.docID||"",suppressError:true});};if(Bn.isIDForm&&Bn.multiForms){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:function(){var Bu=[];Y.forEach(Bt,function(Bv){if(Bv.oid===Bq&&Bv.did!==Br){Bu.push({did:Bv.did,aid:"",ot:BF});}});Bu.push({did:Br,aid:"",ot:BF});Bp(Bu);}}});}else{Bp([{did:Br,aid:"",ot:BF}]);}},remap:function S(Bo,Bn){mstrApp.getRootController().getDataService().changeMapping({success:function Bp(Bq){if(Bn&&Bn.success){Bn.success(Bq);}}},{tbid:this.tableID||"",mpcs:JSON.stringify([Bo]),docid:mstrApp.docID||""});},commitMapping:function(Bu){var Bo=this;var Bv=this.cloneMappings,Bw=this.mappings;var Br,Bs=[],Bn,Bp,Bx;for(var Bq=0,Bt=Bv.length;Bq<Bt;Bq++){Bp=Bv[Bq];Bx=Bw[Bq];Br={};Bn=false;if(!Bx.selected){Bs.push({did:Bx.did,cmf:0});}else{if(Bx.alias!=Bp.alias){Br.alias=Bx.alias;Bn=true;}if(Bx.dtp!=Bp.dtp){Br.bft=Bx.dtp;Bn=true;}if(Bx.tp!=Bp.tp){Br.ot=Bx.tp;Bn=true;}if(Bn){Br.did=Bx.did;Bs.push(Br);}}}if(Bs.length>0){mstrApp.getRootController().getDataService().remapObject({success:function(By){if(Bu&&Bu.success){Bu.success(By);}}},{mpcs:JSON.stringify(Bs),docid:mstrApp.docID||""});}else{if(Bu&&Bu.success){Bu.success();}}},validateExpr:function J(Bo,Bn){this.parseExpression(Bo.vo===1,1,Bo.cIndex,null,Bo.qbrex,Bo.expr,Bo.tKnStrm,Bn);},parseExpression:function AL(Bu,Bo,Bv,Bn,Bt,Bq,Bs,Br){var Bp={qbrex:Bt};Bp.qindex=Bo||1;Bp.tbid=this.tableID||"";if(Bn!=null){Bp.jindex=Bn;}if(Bq!=null){Bp.exp=Bq;}if(Bs){Bp.tokenStrm=Bs;}Bp.vo=1;mstrApp.getRootController().getDataService().parse({success:function(Bw){if(Bw&&Bw.mi&&Bw.mi.items){var Bx=Bw.mi.items;AA(Bx);Bw.expr=C(Bx);}if(Br&&Br.success){Br.success(Bw);}}},Bp);},canAddTable:function Ap(Br){var Bq=this,Bo=Bq.SelDBRoleID,Bp=Bq.dbridForDDA,Bn;if(Bq.isDDA&&Bp&&Bo!==Bp){Bn={name:"directDataAccessTableError"};}if(Bn){if(!Br){this.raiseEvent(Bn);}return false;}return true;},addTable:function V(Bz,B0){var Bs=this,Br=Bz.tbn||Bz.did,Bx=Bs.tbns,By,Bu=1,Bv=[],Bq,Bt=Bs.SelDBRoleID,Bw;if(!this.canAddTable()){return ;}Br=Br.replace(/^[0-9]/,"L");By=Br;while(Bx[By]){By=Br+"_"+(Bu++);}Br=By;Y.forEach(B0,function(B1){Bq=B1.dt;Bv.push({cln:B1.cln,dtps:Bq.ps,dttp:Bq.tp,dtsc:Bq.sc});});var Bp={tbn:Bz.dbtn||Bz.tbn||Bz.did,clns:JSON.stringify(Bv),ns:Bz.ns,alias:Br,tbid:Bs.tableID||""},Bo=this.getMissingTableID(Bz.tbn,Br,Bz.ns);if(Bo){Bp.stbid=Bo;}var Bn={success:function(B1){Bx[Br]=Br;Bs.isDirty=true;mstrApp.msgid=B1.msgid;Bs.raiseEvent({name:"TableAdded",data:B0,table:{x:Bz.x,y:Bz.y,tbn:Br,dbtbn:Bz.tbn||Bz.did,ns:Bz.ns,did:Bo}});if(Bs.dbtables.length>1){Bs.autoJoin();}Bs.prevDBRoleID=Bt;if(!Bs.isDDA){Bw=mstrApp.getRootController().getDDAController();Bw.tryEnableDDACheckbox(false);}}};mstrApp.getRootController().getDataService().addTable(Bn,Bp);},removeTable:function(Bo,Bq){var Bs=this,Bp=this.gettIndex(Bo.id),Br=Bo.Rows.children;var Bn={widget:Bo,success:function(B1){mstrApp.msgid=B1.msgid;Bs.isDirty=true;var B5,B6,B9=this.widget.id;var B4=Bs.tbns,B7=Bs.tables[B9],Bw=B7.tbn,Bt=B7.dbtbn,B2=B7.ns;if(B4[Bw]){delete B4[Bw];}for(var Bv in Bs.joinsInfo){var By=Bs.joinsInfo[Bv].srctID,Bu=Bs.joinsInfo[Bv].tgttID;if(B9==By||B9==Bu){B6=Bs.joinsInfo[Bv].links;for(B5 in B6){BN(Bs.joinCols,B6[B5].srcw.id,B6[B5].tgtw.id);}delete Bs.joinsInfo[Bv];mstrmojo.array.removeItem(Bs.joins,Bv);Bs.tables[By].njoins--;Bs.tables[Bu].njoins--;}if(Bs.selLink&&Y.indexOf(Bs.selLink[0],B9)>-1){Bs.selLink=null;}}Bs.upttIndex(Bw,Bt,B9,false,B7.did,B2);if(Bs.dbtables.length===0&&Bs.canAddTable(true)){Bs.raiseEvent({name:A6.DBTABLES_ENABLED,value:true});mstrApp.getRootController().enableButton();}if(!Bs.isDDA){ddaController=mstrApp.getRootController().getDDAController();ddaController.tryEnableDDACheckbox(true);}var B0=Bs.selectedClns,B8=[],Bz;Y.forEach(Br,function(CA){Y.forEach(B0,function(CC,CB){Bz=Y.indexOf(CC.wid,CA.id);if(Bz>-1){Y.removeIndices(CC.wid,Bz,1);if(Y.indexOf(B8,CB)==-1){B8.push(CB);}}});});B8.sort(mstrmojo.array.numSorter);for(var Bx=B8.length-1;Bx>-1;Bx--){Bs.removeExpression(B8[Bx],true);}if(B8.length>0){g(Bs);}Bs.raiseEvent({name:"refreshTables",items:Bs.dbtables.slice(0)});var B3=Bs.conditions;Bw=Bw.toLowerCase();AB(B3.where,Bw)&&(delete B3.where);AB(B3.having,Bw)&&(delete B3.having);Bs.updateFilterLabel(B3);if(Bq&&Bq.success){Bq.success();}}};mstrApp.getRootController().getDataService().removeTable(Bn,{tbid:Bs.tableID||"",tindex:Bp});},getAvailableTablesEnabled:function Ao(){return(!mstrApp.isFFSQLMode)?this.canAddTable(true):this.canAddTableSQL(true);},addExpression:function A3(Bn,Bo){var Bt=C(this.selectedClns[Bn].expr);var Br={did:Bn+Bt,alias:Bt,n:Bt,selected:false,hasMapped:false,isQB:!this.FFSQLMode,expr:this.selectedClns[Bn].expr,dtp:1,colo:Bn,ix:Bn,tp:0};this.mappings.push(Br);var Bq=this.dataset.length;if(Bq>0){for(var Bp=0;Bp<Bq;Bp++){var Bs=this.dataset[Bp];Bs.push("");}}if(!Bo){mstrApp.getRootController().toggleDataPreview(true);g(this);}},removeExpression:function Bd(Bo,Bq){var Bn=this.selectedClns,Br,Bs=0,Bp;Y.forEach(Bn[Bo].wid,function(Bt){Br=mstrmojo.all[Bt];Br.count--;Br.updateState(0);});Bn.splice(Bo,1);if(this.isRefined&&!mstrApp.isFFSQLMode){}else{Bp=this.mappings[Bo].ix;Y.forEach(this.mappings,function(Bt){if(Bt.ix>Bp){Bs=Bs?Math.min(Bs,Bt.ix-Bp):Bt.ix-Bp;}});Y.forEach(this.mappings,function(Bt){if(Bt.ix>Bp){Bt.ix=Bt.ix-Bs;Bt.colo=Bt.colo-1;}});Y.removeIndices(this.mappings,Bo,1);}Y.forEach(this.dataset,function(Bt){Y.removeIndices(Bt,Bo,1);});if(!Bq){g(this);}},editExpression:function(Bn){var Bp=this.selectedClns[Bn-1],Bo=Bp.wid;this.exprEditor(Bp,3,null,Bn);},updateExpression:function Bk(Bn){var Bs=C(this.selectedClns[Bn].expr);var Bq=this.mappings[Bn];if(!Bq){return ;}Bq.did=Bn+Bs;Bq.alias=Bs;Bq.n=Bs;Bq.expr=this.selectedClns[Bn].expr,Bq.selected=false;Bq.hasMapped=false;Bq.tp=0;var Bp=this.dataset.length;if(Bp>0){for(var Bo=0;Bo<Bp;Bo++){var Br=this.dataset[Bo];Br[Bn]="";}}g(this);},addSelectedColumns:function AT(Bo,Br,Bq,Bx){var Bp=this,Bn,By,B0=[],Bw,Bu,Bv,Bt=Bp.tables[Bp.dbtables[Br-1]].existing;for(i=0;i<Bo.length;i++){Bw=Bo[i];Bv=Bw.dt;By={dt:Bv.tp,ps:Bv.ps,sc:Bv.sc,clix:Bw.rIndex+1,tblIdx:Br};if(Bq!=null){By.findex=Bq;Bu=[AR[Bq],"(",Bw.oriexpr,")"].join("");}else{Bu=Bw.expr[0].oi.n;}if(Bt){Bn=this.getMissingColumnID(Bu);if(Bn){By.cmid=Bn;}}B0.push(By);}var Bz=JSON.stringify(B0);var Bs={success:function(B3){Bp.isDirty=true;mstrApp.msgid=B3.msgid;for(var B2=0,B1=Bo.length;B2<B1;B2++){Bp.addColumnIndex(Bo[B2],Bq,null,!Bt,B0[B2].cmid,true);}mstrApp.getRootController().toggleDataPreview(true);g(Bp);if(Bx&&Bx.success){Bx.success(Bw);}}};mstrApp.getRootController().getDataService().addSelectedColumns(Bs,{tbid:Bp.tableID||"",colArray:Bz});},addColumnWithExpression:function Ba(Bq,Bu,Bv,Bt){var Bs=this,Br=Bq.dt,Bp={dt:Br.tp,ps:Br.ps,sc:Br.sc,tbid:Bs.tableID||"",exp:Bu||""},Bo=Bs.tables[Bq.srcID].existing;if(Bo){var Bn=this.getMissingColumnID(expr);if(Bn){Bp.cmid=Bn;}}mstrApp.getRootController().getDataService().addColumn({success:function(Bw){Bs.isDirty=true;mstrApp.msgid=Bw.msgid;Bw.cIndex=Bs.addColumnIndex(Bq,null,Bu,!Bo,Bn);mstrApp.getRootController().updateTableViewWithExpression(Bw.cIndex,Bv,true);if(Bt&&Bt.success){Bt.success();}}},Bp);},removeSelectedColumn:function(Bn,Br){var Bp=this,Bo=Bp.mappings,Bq;if(this.isRefined&&!mstrApp.isFFSQLMode){Bq=Bp.selectedClns[Bn].ix+1;}else{Bq=Bo[Bn].ix+1;}mstrApp.getRootController().getDataService().removeColumn({success:function(Bs){Bp.isDirty=true;mstrApp.msgid=Bs.msgid;Bp.removeExpression(Bn);if(Br&&Br.success){Br.success();}}},{cindex:Bq,tbid:Bp.tableID||""});},removeAllColumns:function AV(){var Bn=this,Bo=Bn.mappings;mstrApp.getRootController().getDataService().removeColumn({success:function(Bp){Bn.isDirty=true;mstrApp.msgid=Bp.msgid;Y.forEach(Bn.selectedClns,function(Bq){row=mstrmojo.all[Bq.wid[0]];row.count--;row.updateState(0);});Bn.selectedClns=[];Bn.mappings=[];g(Bn);}},{count:Bo.length,tbid:Bn.tableID||""});},editColumnExpression:function Ag(Bn,Bs,Bq,Bp){var Bo=this,Br={cindex:Bo.mappings[Bn].ix+1,exp:Bs||"",tbid:Bo.tableID||""};mstrApp.getRootController().getDataService().editColumn({success:function(Bt){Bo.isDirty=true;mstrApp.msgid=Bt.msgid;mstrApp.getRootController().updateTableViewWithExpression(Bn,Bq);if(Bp&&Bp.success){Bp.success();}}},Br);},editExpr:function(Bn){var Bo=this.selectedClns[Bn-1];this.exprEditor(Bo,3,null,Bn);},getColDataType:function Af(Bn){return parseInt(Bn.dt.tp,10);},addJoinColInfo:function A9(Bo,Bn){G(this.joinCols,Bo,Bn);},autoJoin:function BS(){var B2=this.dbtables.length,B0,B3,B1,Bu=this.tables,Bx,Bs,Bv,B4,Bp,By,Bo,Bt,Bq,Bn={},Bz,Bw,Br;B0=this.dbtables[B2-1];B1=Bu[B0];B4=B1.rows;for(B3 in Bu){if(B3===B0){continue;}Bx=Bu[B3].rows;Br=B0+B3;for(Bp in B4){Bt=B4[Bp];By=Bt.srcData;Bo=this.getColDataType(By);if(Bo===AO.columnDataTypes.integer||Bo===AO.columnDataTypes.unsigned||Bo===AO.columnDataTypes.int64||Bo==="INTEGER"){for(Bs in Bx){Bq=Bx[Bs];Bv=Bq.srcData;if(By.cln===Bv.cln&&Bo===this.getColDataType(Bv)&&!BD(this.joinCols,Bp,Bs)){Bw=this.brackets(Bt.oriexpr)+"="+this.brackets(Bq.oriexpr);if(Bn[Br]){Bn[Br].jexp=Bn[Br].jexp+" AND "+Bw;}else{Bn[Br]={jexp:Bw,links:[]};}Bz={srcw:Bt,tgtw:Bq,jtype:0,jexp:Bw};Bn[Br].links.push(Bz);G(this.joinCols,Bt.id,Bq.id);break;}}}}}if(!U.isEmpty(Bn)){this.addJoins(Bn);}},addJoin:function T(Bp,Bn,Bo,Bu,Br){var Bq,Bs,Bt={};Bq=Bp.srcID+Bn.srcID;Bs={srcw:Bp,tgtw:Bn,jtype:Bo,jexp:this.brackets(Bp.oriexpr)+"="+this.brackets(Bn.oriexpr)};Bt[Bq]={links:[Bs],jexp:Bs.jexp};G(this.joinCols,Bp.id,Bn.id);this.addJoins(Bt,Br);},addJoins:function n(Bs,Bv){var Br=this,Bt,Bp,Bx,Bq,Bw,Bo,Bu,Bn={success:function(By){Br.isDirty=true;mstrApp.msgid=By.msgid;for(Bq in Bs){Bw=Bs[Bq].jexp;Bx=Bs[Bq].links;Br.joinsInfo[Bq]={jt:0,exp:Bw,links:{},nlinks:Bx.length};for(i=0;i<Bx.length;i++){Bp=Bx[i];Bo=Bp.srcw;Bu=Bp.tgtw;Br.joinsInfo[Bq].links[Bo.id+Bu.id]={srcw:Bo,tgtw:Bu,coords:[],exp:Bp.jexp,jid:Bq};Br.tables[Bo.srcID].njoins++;Br.tables[Bu.srcID].njoins++;}Br.joinsInfo[Bq].srctID=Bo.srcID;Br.joinsInfo[Bq].tgttID=Bu.srcID;Br.joins.push(Bq);}if(Bv&&Bv.success){Bv.success();}Br.raiseEvent({name:"JoinsAdded"});}};Bt=JSON.stringify(Bj(Bs,Br));mstrApp.getRootController().getDataService().addJoin(Bn,{joins:Bt,tbid:Br.tableID||""});},removeJoin:function(Bp,Br){var Bs=this;var Bq=Bs.joinsInfo[Bp],Bt=Bq.srctID,Bo=Bq.tgttID;var Bn={success:function(Bu){Bs.isDirty=true;mstrApp.msgid=Bu.msgid;Y.removeItem(Bs.joins,Bp);delete Bs.joinsInfo[Bp];Bs.tables[Bt].njoins--;Bs.tables[Bo].njoins--;if(Br&&Br.success){Br.success();}}};mstrApp.getRootController().getDataService().removeJoin(Bn,{jindex:Bs.getjIndex(Bp),tbid:Bs.tableID||""});},editJoin:function t(Bs){var Bu=this,Bq=Bs.linkID,Bn=Bs.joinID,Bv=Bs.exp||"",Bo=Bs.op,By=Bs.type,Bz=Bu.joinsInfo[Bn].links,Bw=Bu.getjIndex(Bn),Bp="",Br={jindex:Bw,jtype:By,tbid:Bu.tableID||""},Bt={success:function Bx(B0){mstrApp.msgid=B0.msgid;Bu.isDirty=true;Bu.joinsInfo[Bn].jt=By;if(Bv){Bz[Bq].op=Bo;Bz[Bq].exp=Bv;Bu.joinsInfo[Bn].exp=Bp;}Bu.raiseEvent({name:"joinChanged"});}};if(Bv){U.forEach(Bz,function(B1,B0){Bp+=(Bp?" AND ":"")+((B0!==Bq)?B1.exp:Bv);});Br.exp=Bp;}mstrApp.getRootController().getDataService().editJoin(Bt,Br);},renameTable:function BY(Bq,Bn,Bp){var Bo=this;mstrApp.getRootController().getDataService().editTable({success:function(Br){mstrApp.msgid=Br.msgid;delete Bo.tbns[Bn];Bo.tbns[Bp]=Bp;Bo.tables[Bq].tbn=Bp;U.forEach(Bo.conditions,function(Bs){A5(Bn,Bp,Bs);});Bo.raiseEvent({name:"TableNameChanged",value:Bp,tid:Bq});}},{tbid:Bo.tableID||"",tables:JSON.stringify([{alias:Bp,tindex:Bo.gettIndex(Bq)}])});},saveTableLayout:function BL(Bp){var Bo=[];for(var Bq in this.tables){var Bn=mstrmojo.all[Bq];if(Bn&&Bn.editorNode){Bo.push({tindex:this.gettIndex(Bq),t:parseInt(Bn.top,10)*BU,l:parseInt(Bn.left,10)*BU,w:Bn.editorNode.clientWidth*BU,h:Bn.editorNode.clientHeight*BU});}}mstrApp.getRootController().getDataService().editTable({success:function Br(Bs){mstrApp.msgid=Bs.msgid;if(Bp&&Bp.success){Bp.success();}}},{tbid:this.tableID||"",tables:JSON.stringify(Bo)});},loadReport:function Az(Bt,Bv,Bu,Br,Bs,Bn){var Bo=this;Bv=Bv||BP;var Bq={browsetype:Bt,bindingflag:Bv,suppressError:true,showWait:!Bn};if(Bu!=null){Bq.previewflag=Bu;}if(Br!=null){Bq.automap=Br;Bq.docid=mstrApp.docID||"";}Bq.tableID=Bo.tableID||"";var Bp={success:function(Bw){if(Bt&AE){if(Bw.btb){Bo.bindingT=Bw.btb.slice(0);}}if(Bs&&Bs.success){Bs.success(Bw);}}};mstrApp.getRootController().getDataService().getReportDefinition(Bp,Bq);},loadConnectLiveSupport:function p(){var Bo=this,Bn,Bp={browsetype:BC,bindingflag:0,previewflag:0,tableID:Bo.tableID||"",showWait:false};Bo.connectLiveSupport=undefined;Bn={success:function(Bq){if(Bq.prs&&Bq.prs.dda!==undefined){Bo.connectLiveSupport=Bq.prs.dda;}}};mstrApp.getRootController().getDataService().getReportDefinition(Bn,Bp);},getcIndex:function Ax(Bn){return mstrmojo.array.indexOf(this.selectedClns,Bn)+1;},getRowWidget:function k(Bn,Br){var Bs=this.tables;Br=Br.toLowerCase();if(!Bn){for(var Bo in Bs){var Bq=Bs[Bo].rows;for(var Bp in Bq){if(Bq[Bp].text.toLowerCase()===Br){return mstrmojo.all[Bp];}}}}else{Bn=Bn.toLowerCase();for(var Bo in Bs){if(Bs[Bo].tbn.toLowerCase()===Bn){var Bq=Bs[Bo].rows;for(var Bp in Bq){if(Bq[Bp].text.toLowerCase()===Br){return mstrmojo.all[Bp];}}}}}},uptcIndex:function Aj(Bo,Bn){while(Bn>this.selectedClns.length){this.selectedClns.push("");}this.selectedClns[Bn]=Bo;},getjIndex:function Aa(Bn){return mstrmojo.array.indexOf(this.joins,Bn)+1;},gettIndex:function O(Bn){return mstrmojo.array.indexOf(this.dbtables,Bn)+1;},upttIndex:function Bl(Bp,Bn,Bo,Bv,Bu,Bs){var Bt=this.dbtables,Br=this.tables,Bq=function Bq(Bz,Bx,Bw,By){return{rows:{},njoins:0,tbn:Bz,ns:Bx,alias:"",dbtbn:Bw,did:By};};if(Bv){Br[Bo]=Bq(Bp,Bs,Bn,Bu);Bt.push(Bo);}else{delete Br[Bo];mstrmojo.array.removeItem(Bt,Bo);}},save:function(Bo,Bx,Bq,By,Bv,Bw,Bz){var Bt=this;var Bn={success:function(B2){var B1=B2.did;Bt.riid=B1;mstrApp.path=B2.path;mstrApp.reportID=B1;mstrApp.folderID=Bq;var B0={success:function(B3){if(Bz&&Bz.success){Bz.success({did:B1,path:mstrApp.path});}},failure:function(B8){var B7=Bt.dbtables,B5,B4=Bt.pos_hash;for(var B6=0,B3=B7.length;B6<B3;B6++){B5=mstrmojo.all[B7[B6]];if(B5&&B5.editorNode){B4[B5.title]={t:parseInt(B5.top,10),l:parseInt(B5.left,10),w:B5.editorNode.clientWidth,h:B5.editorNode.clientHeight};}if(B5){B5.set("visible",false);B5.set("opener",null);}delete mstrmojo.all[B7[B6]];}var CA=mstrmojo.all.CE,B9;if(CA&&(B9=CA.CEl)){B9.filterExpr.set("items",[]);B9.aggfilterExpr.set("items",[]);}Bt.createReportInstance();}};mstrApp.getRootController().getDataService().publishCube(B0,{reportid:B1});}};var Bp={success:function(){params={reportid:Bt.riid,folderID:Bq,isCube:Bt.isCubeReport,crb:Bt.refresh_opt,overwrite:!!By,autoName:!!Bv};if(Bo){params.name=Bo;}if(Bx){params.desc=Bx;}mstrApp.getRootController().getDataService().saveReport(Bn,params);}};var Br={success:function(){Bt.updateDerivedFlags(Bp);}};var Bs={success:function(){if(Bt.skipMissingCheck){Br.success();return ;}var B3=[],B2=Bt.getMissingMaps(B3);if(B2){var B1=B3.length>0,B0=mstrmojo.insert({scriptClass:"mstrmojo.qb.MissingColumnWarning",hasPT:B1,mappings:B1?B3:B2,isCube:Bt.isCubeReport,onOK:function(){Br.success();return true;}});B0.open();}else{Br.success();}}};var Bu={success:function(){if(Bt.isDirty){Bt.autoMap(Bs);}else{Bs.success();}}};if(!Bt.FFSQLMode){Bt.saveTableLayout(Bu);}else{Bt.editFFSQL(Bu,Bw);}},populatePreview:function BK(Bo,Bn){this.populateMappings(Bo);this.populateDataset(Bn);},populateMappings:function h(Bu){var Bv=Bu.amps,B2=Bu.mtmps,Bt=!mstrApp.isCloudPro&&(mstrApp.saveAsCube==2)&&(!this.isNew),B5=[];var B6=this.mappings.slice(0);this.mappings=[];this.cloneMappings=[];var Bx,Bw,Bq,Bn,B7,By=0,Br,Bo,B4,B1,Bs=function(B8){var B9=0;Y.forEach(B8,function(CA){if(!(CA.sqc.der&2147483648)){B9++;}});return B9;};for(var Bz=0,B0=Bv.length;Bz<B0;Bz++){Bw=Bv[Bz];Bq=Bw.aimp;Bo=Bq.ipa;Bn=Bw.afmps;By+=Bn.length;B1=Bs(Bn);for(Bx=0,aflen=Bn.length;Bx<aflen;Bx++){B7=Bn[Bx].sqc;Br=mstrmojo.array.find(B6,"did",B7.id);B4=(B7.der&2147483648)?true:false;B5.push({did:B7.id,alias:AJ(Bq.atnm),n:AJ(Bw.afmps[Bx].cln),selected:(B7.se==1),hasMapped:true,isReadOnly:Bt,isDI:this.isDI,isQB:!(this.FFSQLMode),dtp:Bn[Bx].bft,colo:Bn[Bx].colo-1,ix:B7.ix,tp:12,ipa:Bo,georole:(Br>=0)?B6[Br].georole:B7.geo,der:(Br>=0)?B6[Br].der:B7.der,oid:Bq.atid,fmid:Bn[Bx].fmid,afid:Bq.atid+Bn[Bx].fmid,fmn:AJ(Bn[Bx].fmn),shapeKey:AJ((Br>=0)?B6[Br].shapeKey:Bn[Bx].sha),toDel:(B7.ups&4)?true:false,isDerived:B4,multiForms:B1>1,isIDForm:Bx===0});}}for(var Bz=0,B0=B2.length;Bz<B0;Bz++){var Bp=B2[Bz],B7=Bp.sqc;B5.push({did:B7.id,alias:AJ(Bp.mtn),n:AJ(Bp.cln),selected:(B7.se==1),isReadOnly:Bt,hasMapped:true,isDI:this.isDI,isQB:!(this.FFSQLMode),dtp:Al[B7.dt.tp],colo:Bp.colo-1,ix:B7.ix,tp:4,oid:Bp.mtid,georole:B7.geo,der:B7.der,toDel:(B7.ups&4)?true:false});}Y.forEach(Bu.cmps,function(B8){B7=B8.sqc;B5.push({did:B7.id,alias:AJ(B7.exp.exp),n:AJ(B7.exp.exp),selected:false,hasMapped:false,isQB:!this.FFSQLMode,expr:B7.exp.exp,dtp:Al[B7.dt.tp],colo:B8.colo-1,ix:B7.ix,tp:0});});var B3;B5.sort(function(B9,B8){return(B9.ix<B8.ix)?-1:1;});for(var Bz=0,B0=B5.length;Bz<B0;Bz++){B3=B5[Bz];if(B3.toDel){this.selectedClns&&this.selectedClns[Bz]&&(this.selectedClns[Bz].missing=true);}else{if(B3.isDerived){this.selectedClns&&this.selectedClns[Bz]&&(this.selectedClns[Bz].isDerived=true);}else{this.mappings.push(B3);this.cloneMappings.push(U.copy(B3));}}}},populateDataset:function BO(Bn){var Bo;if(!(Bn instanceof Array)){Bn=Bn.dcs;if(!Bn||!Bn.length){this.dataset=[];return ;}}Bo=[];Y.forEach(Bn,function(Bp){Y.forEach(Bp.dvs,function(Br,Bq){Br=(Br===null)?"":BV.encodeData(Br);Bo[Bq]=Bo[Bq]||[];Bo[Bq].push(Br);});});this.dataset=Bo;},populateFFSQLMapping:function Z(Bv){var Bw=Bv.amps,B3=Bv.mtmps;var Bo={};var B8=this.mappings.slice(0);this.mappings=[];this.cloneMappings=[];var By,Bx,Br,B6,Bz=0,B4,Bn,B5,Bp,B7,B2,Bt=function Bt(B9){var CA=0;Y.forEach(B9,function(CB){if(!(CB.col.oi.def.dicl.der&2147483648)){CA++;}});return CA;};for(var B0=0,B1=Bw.length;B0<B1;B0++){Bx=Bw[B0];Br=Bx.aimp;Bp=Br.ipa;Bn=Bx.afmps;B2=Bt(Bn);for(By=0,B4=Bn.length;By<B4;By++){B6=Bn[By].col.oi;pos=mstrmojo.array.find(B8,"did",B6.did);if(B6.def.dicl.ups&4){break;}B7=(B6.def.dicl.der&2147483648)?true:false;Bz++;B5={did:B6.did,alias:AJ(Br.atnm),n:BV.encodeData(B6.def.cln),selected:true,hasMapped:true,dtp:Bn[By].bft,georole:(pos>=0)?B8[pos].georole:B6.def.dicl.geo,shapeKey:AJ((pos>=0)?B8[pos].shapeKey:Bn[By].sha),oid:Br.atid,fmid:Bn[By].fmid,afid:Br.atid+Bn[By].fmid,fmn:AJ(Bn[By].fmn),ipa:Bp,colo:Bn[By].colo-1,ix:B6.def.dicl.clix-1,tp:12,der:(pos>=0)?B8[pos].der:B6.def.dicl.der,isDerived:B7,multiForms:B2>1,isIDform:By===0};Bo[B5.ix]=B5;}}var Bu=Bw.length;for(var B0=0,B1=B3.length;B0<B1;B0++){var Bq=B3[B0],B6=Bq.col.oi;if(B6.def.dicl.ups&4){continue;}Bz++;var B5={did:B6.did,alias:AJ(Bq.mtn),n:AJ(B6.def.cln),selected:true,hasMapped:true,dtp:Al[B6.def.dt.tp],colo:Bq.colo-1,ix:B6.def.dicl.clix-1,oid:Bq.mtid,tp:4,georole:B6.def.dicl.geo,der:B6.def.dicl.der};Bo[B5.ix]=B5;}var B5;var Bs=[];U.forEach(Bo,function(CA,B9){Bs.push(parseInt(B9,10));});Bs.sort(function(CA,B9){return CA-B9;});for(var B0=0;B0<Bs.length;B0++){B5=Bo[Bs[B0]];if(B5&&!B5.isDerived){this.mappings.push(B5);this.cloneMappings.push(U.copy(B5));}}},updateDerivedFlags:function(Bq){var Bt=this.mappings;var Bo=[],Br;for(var Bp=0,Bn=Bt.length;Bp<Bn;Bp++){if(Bt[Bp].hasMapped){Bo.push({did:Bt[Bp].did,georole:Bt[Bp].georole,shapekey:Bt[Bp].shapeKey,drvflgs:Bt[Bp].der});}}if(Bo.length===0){Bq&&Bq.success&&Bq.success();}else{mstrApp.getRootController().getDataService().remapObject({success:function Bs(Bu){if(Bq&&Bq.success){Bq.success(Bu);}}},{mpcs:JSON.stringify(Bo),docid:mstrApp.docID||"",utm:1});}},getMissingMaps:function(B9){if(!this.orimaps){return null;}var By=[],B4,B3,B5,B6;var B7=this.orimaps;var Bq=this.mappings;var Bw=B7.amps,Bx=B7.mtmps;B7={};var Bs,B2,Bo,Bz,B8,Bu,B0,Bv=mstrApp.isFFSQL;for(B4=0,B5=Bw.length;B4<B5;B4++){B6=Bw[B4].aimp;Bs=B6.atid;B2=AJ(B6.atnm);B6=Bw[B4].afmps;for(B3=0;B3<B6.length;B3++){if(Bv){Bz=B6[B3].col.oi.def;if(Bz.dicl.der&2147483648){break;}Bu=Bz.cln;B0=B6[B3].col.oi.did;}else{B8=B6[B3].sqc;if(B8.der&2147483648){break;}Bu=B8.exp.exp;B0=B8.id;}B7[Bs]=B7[Bs]||{n:B2,oid:Bs,tp:12,fms:[]};B7[Bs].fms.push({fmid:B6[B3].fmid,fnm:AJ(B6[B3].fmn),exp:AJ(Bu),cmid:B0});}}for(B4=0,B5=Bx.length;B4<B5;B4++){if(Bv){Bu=Bx[B4].col.oi.def.cln;B0=Bx[B4].col.oi.did;}else{B8=Bx[B4].sqc;Bu=B8.exp.exp;B0=B8.id;}B7[Bx[B4].mtid]={oid:Bx[B4].mtid,n:AJ(Bx[B4].mtn),tp:4,exp:AJ(Bu),cmid:B0};}var B1=mstrmojo.hash.copy((this.pattrs||{}));var B5=Bq.length,Bn,Bp,Br,Bt;for(B4=0;B4<B5;B4++){Bn=Bq[B4].oid;Bp=B7[Bn];if(Bp&&Bp.tp==Bq[B4].tp){Br=Bp.fms;if(Br){Bt=Y.find(Br,"fmid",Bq[B4].fmid);if(Bt>-1){Y.removeIndices(Br,Bt,1);}}else{delete B7[Bn];}}if(B1[Bn]&&B1[Bn].tp==Bq[B4].tp){delete B1[Bn];}}if(B9){for(Bn in B1){B6=B1[Bn];B9.push(B6);}}for(Bn in B7){B6=B7[Bn];if(B6.tp===12){if(B6.fms.length){By.push(B6);}}else{By.push(B6);}}return((By.length>0)?By:null);},getMissingColumnID:function(Br){var Bo=this,Bn=Bo.getMissingMaps();if(!Bn){return null;}var Bq=null,Bs,Bp=Bo.mappings;Y.forEach(Bn,function(Bt){Bs=(Bt.tp===4)?[Bt]:Bt.fms;Y.forEach(Bs,function(Bu){if(Y.find(Bp,"did",Bu.cmid)===-1&&Bo.isEquivalentExpr(Bu.exp,Br)){Bq=Bu.cmid;return false;}});if(Bq){return false;}});if(Bq){Y.forEach(Bo.selectedClns,function(Bt){if(Bt.cmid===Bq&&!Bt.missing){Bq=null;return false;}});}return Bq;},getMissingTableID:function(Bn,Bp,Bs){var Bu=this.orits;if(!Bu){return null;}var Bt=this.dbtables,Br=this.tables,Bv;for(var Bo=0,Bq=Bt.length;Bo<Bq;Bo++){Bv=Br[Bt[Bo]];if(Bv.existing&&Bv.missing&&Bv.tbn===Bp&&Bv.dbtbn===Bn&&Bv.ns===Bs){return(!Bv.did?null:Bv.did);}}return null;},getTablesCount:function(){var Bq=this.tables,Br=this.dbtables,Bp=0;for(var Bo=0,Bn=Br.length;Bo<Bn;Bo++){!Bq[Br[Bo]].missing&&(Bp++);}return Bp;},getColumnsCount:function(){var Bo=this.selectedClns,Bq=0;for(var Bp=0,Bn=Bo.length;Bp<Bn;Bp++){!Bo[Bp].missing&&(Bq++);}return Bq;},addColumnIndex:function(B0,Br,Bx,Bn,Bp,Bv){var Bu=this.selectedClns,By=this.gettIndex(B0.parent.parent.id),Bq,Bw,Bz,Bt=Bu.length,Bs,Bo;if(!!Bx){Bq=Bx;}else{if(Br){Bq=AR[Br]+"("+(B0.oriexpr)+")";}else{Bq=this.brackets(B0.oriexpr);}}if(!Bn){for(Bs=0;Bs<Bt;Bs++){Bo=Bu[Bs];if(Bo.missing&&Bo.expr&&this.isEquivalentExpr(Bo.expr[0].v,Bq)){Bo.missing=false;Bo.wid=[B0.id];Bo.cmid=Bp;Bz=true;break;}}Bw=Bs;}else{Bw=Bt;}if(!Bz){if(Br){if(Br===6){Bu.push({wid:[B0.id],expr:[{isNew:true,v:"Count",oi:{t:"11",n:"Count"}},{isNew:true,v:"<Distinct=true>",oi:{t:"11",n:"<Distinct=true>"}},{isNew:true,v:"(",isDelimiter:true},{isNew:true,v:this.brackets(B0.oriexpr),oi:{tIndex:By,rIndex:B0.rIndex,t:"26",n:B0.oriexpr}},{isNew:true,v:")",isDelimiter:true}]});}else{Bu.push({wid:[B0.id],expr:[{isNew:true,v:AR[Br],oi:{t:"11",n:AR[Br]}},{isNew:true,v:"(",isDelimiter:true},{isNew:true,v:this.brackets(B0.oriexpr),oi:{tIndex:By,rIndex:B0.rIndex,t:"26",n:B0.oriexpr}},{isNew:true,v:")",isDelimiter:true}]});}}else{Bu.push({wid:[B0.id],expr:[{isNew:true,v:Bq,oi:{tIndex:By,rIndex:B0.rIndex,t:"26",n:B0.oriexpr}}]});}}this.addExpression(Bw,Bv);return Bw;},compareDBTables:function(Bp){var Bo=this;if(Bo.dbtables.length===0){return ;}var Bn={success:function(Bt){var Bq=Bt.btb,Br=[],Bv,Bu;Y.forEach(Bq,function(Bw){Bv=Bw.oi;Bu=Bv.def;(Bv.tp===53&&Bu.xt===1)&&Br.push({tbid:Bv.did,tbn:AJ(Bu.tbn),ns:AJ(Bu.ns)});});if(Br.length==0){return ;}Bo.whts=Br;mstrApp.getRootController().getDataService().catalogAction({success:function Bs(Bw){var Bx=Bw.xrc.cas[0];Bo.whdef=Bx.tis?Bx.tis:[Bx];Bp&&Bp.success&&Bp.success();}},{dbrid:Bo.SelDBRoleID,flags:1073741824|2|524288,mid:mstrApp.msgid,dbts:JSON.stringify(Br),showWait:true});}};Bo.loadReport(AE+Be,BP,b,null,Bn);},updateDBTables:function(Bx){var Bp=this,Bz,Bt,Bo=[],Bq,Bn,Bv,Bu,Bs,Bw,By;for(Bu=0,Bw=Bp.whdef.length;Bu<Bw;Bu++){Bz=Bp.whdef[Bu];if(Bz.sta!=0){Bq={ns:Bz.ns,sta:Bz.sta,tbid:Bz.tbid,tbn:AJ(Bz.tbn),clis:[]};Bv=Bq.clis;Bn=Bz.clis;for(Bs=0;Bs<Bn.length;Bs++){By=Bn[Bs];Bv.push({cln:AJ(By.cln),cmid:By.cmid,sta:By.sta,prec:By.dt.prec,scl:By.dt.scl,tp:By.dt.tp});}Bo.push(Bq);}}if(Bo.length==0){return ;}var Br={success:function(B1){mstrApp.msgid=B1.msgid;var B0={success:function(B5){var CA=Bp.dbtables,B9,B4=Bp.pos_hash,B8;for(var B2=0,B3=CA.length;B2<B3;B2++){B9=mstrmojo.all[CA[B2]];if(B9&&B9.editorNode){B4[B9.title]={t:parseInt(B9.top,10),l:parseInt(B9.left,10),w:B9.editorNode.clientWidth,h:B9.editorNode.clientHeight};}B9.set("visible",false);B9.set("opener",null);delete mstrmojo.all[CA[B2]];}var B7=mstrmojo.all.CE,B6;if(B7&&(B6=B7.CEl)){B6.filterExpr.set("items",[]);B6.aggfilterExpr.set("items",[]);}Bp.isDirty=true;if(Bp.loadDefinition){B8=Bp.firstTimeLoading;Bp.loadDefinition(B5);if(!B8){g(Bp);}}else{At(B5,Bp);}}};Bp.loadReport(AE+Be,BP,b,null,B0);}};mstrApp.getRootController().getDataService().updateTableStructure(Br,{tables:JSON.stringify(Bo),tbid:Bp.tableID||""});},isColumnUsed:function(Bv,Bt){var Bp=Bv.tbn,Bo=Bt.cln,Bq,Br,Bw;var Bs=this.tables;for(var Bn in Bs){if(Bs[Bn].dbtbn===Bp){Bw=Bs[Bn].rows;for(var Bu in Bw){if((Bw[Bu].text===Bo)&&(Bw[Bu].state!=0)){return true;}}}}return false;},hasMissingUsedDBColumns:function(){var Bq=this.whdef,Bu,Bt,Bs,Bn,Bp,Bo,Br;for(Bt=0,Bn=Bq.length;Bt<Bn;Bt++){Bu=Bq[Bt];switch(parseInt(Bu.sta,10)){case 0:case 64:break;default:Br=Bu.clis;for(Bs=0,Bp=Br.length;Bs<Bp;Bs++){Bo=Br[Bs];if(parseInt(Bo.sta,10)===4){if(this.isColumnUsed(Bu,Bo)){return true;}}}break;}if(Bu.sta==4){Br=Bu.clis;for(Bs=0,Bp=Br.length;Bs<Bp;Bs++){Bo=Br[Bs];if(this.isColumnUsed(Bu,Bo)){return true;}}}}return false;},getShapeKeys:function(){var Bo=this;var Bn={success:function(Bs){if(Bs&&Bs.ShapeFileMaps&&Bs.ShapeFileMaps.ShapeFileMap){var Bt=Bs.ShapeFileMaps.ShapeFileMap,Bq=[],Bu,Br,Bp=function Bp(Bx,Bw){var Bv=Bx.n.toLowerCase();var By=Bw.n.toLowerCase();if(Bv<By){return -1;}else{if(Bv>By){return 1;}else{return 0;}}};Y.forEach(Bt,function(Bv){Bu=Bv.descWeb;Br=Bu?mstrmojo.desc(Bu.slice(8)):AJ(Bv.name);Bq.push({did:Bv.shapeKey,n:Br});});Bq.sort(Bp);Bo.shapeKeys=Bq;}}};mstrApp.getRootController().getDataService().getShapeKeys(Bn,{});},createEmmaTable:function A8(){var Br=mstrApp.getRootController().getDataService(),Bp=this,Bo=mstrApp.isFFSQL,Bn=(Bo?304:352),Bs=function Bs(Bt){Br.createEmmaTable({success:function Bu(Bv){Bp.tableID=Bv.tbid;mstrApp.msgid=Bv.msgid;}},{xt:Bt});};mstrApp.msgid=mstrApp.msgID;if(mstrApp.msgid){Bs(Bn);}else{Br.createEmmaInstance({success:function Bq(Bt){mstrApp.msgid=Bt.msgid;Bs(Bn);}});}if(mstrApp.isFFSQL){Bp.set("isFFSQL",true);Bp.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},createReportInstance:function BZ(){var Bq=this,Bp=mstrApp.isCloudPro;Bq.msgid=mstrApp.msgid;Bq.riid=mstrApp.reportID||A7;Bq.supportTimeGeo=true;Bq.analysisID=mstrApp.analysisID;Bq.isNew=(Bq.riid==A7);Bq.alertTitle=Bp?"Oops!":null;if(mstrApp.isEMMACube){this.createEmmaTable();return ;}var Bo={success:function Bn(Br){Bq.msgid=Br.msgid;mstrApp.msgid=Br.msgid;if(Bq.riid!==A7){Bq.firstTimeLoading=true;var Bs={success:function Bt(Bv){var Bu;if(Bv&&(Bu=Bv.items)&&Bu.length){Bq.pattrs={};Y.forEach(Bu,function(Bw){Bw.ismapped&&(Bq.pattrs[Bw.did]={n:Bw.n,tp:12});});}Bq.loadReport(AE+Be,BP,b,null,{success:function(Bw){At(Bw,Bq);if(Bp){mstrApp.getRootController().getDataService().autoClosePrompt({success:function Bx(By){mstrApp.msgid=By.msgid;}});}}});}};if(Bp&&mstrApp.analysisID&&mstrApp.saveAsCube!=2){mstrApp.getRootController().getDataService().getDocumentAttributes(Bs,{objectID:mstrApp.analysisID});}else{Bs.success();}}else{Bq.skipMissingCheck=true;if(mstrApp.isFFSQL){Bq.set("isFFSQL",true);Bq.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;Bq.convertToFFSQL("",null,true);}}Bq.set("isCloud",Bp);Bq.set("isCubeReport",mstrApp.saveAsCube!=2);}};mstrApp.getRootController().getDataService().createReportInstance(Bo,{reportid:Bq.riid});if(!mstrApp.isCloudPro){Bq.getShapeKeys();}Bq.getFunctions();},getAllowSave:function w(Bp){var Bo,Bn=mstrApp.isFFSQLMode;if(Bn&&Bp===undefined){Bp=mstrApp.getRootController().rootView.getSQLStatement();}if(this.isNew){Bo=Bn?(!!P.trim(Bp)):(this.dbtables.length>0&&this.selectedClns.length>0);Bo=Bo&&(!!this.SelDBRoleID);}else{Bo=Bn?(!!P.trim(Bp)):true;}Bo=Bo&&this.getAvailableTablesEnabled();return Bo;},getAutoReportName:function Ay(){var Bn=this.tbns,Bo=[];U.forEach(Bn,function(Bq,Bp){Bo.push(Bp);});Bo=Bo.join("_");if(Bo==""){Bo="FFSQL";}return Bo.substring(0,252);},getFunctions:function As(Bq,Bp,Bo){var Bn=this;if(!this.functions){mstrApp.getRootController().getDataService().getSystemFunctions({success:function(Br){Bn.functions=D(Br.fncs,Bq);if(Bp&&Bp.success){Bp.success();}}},U.copy(Bo,{includeFunctionDetails:false,functionFlags:2}));}},getFunctionList:function Bb(){return this.functions;},getSuggestionItems:function AG(Bp){var Bn=[],Bq;if(Bp){var Bo=this.dbtbls[this.SelDBRoleID];U.forEach(Bo,function(Br,Bs){Bn.push({n:Bs,sta:2,t:15});});}else{U.forEach(this.tables,function(Br){U.forEach(Br.rows,function(Bs){Bq=Bs.oriexpr;Bn.push({n:Bq,cmid:Bs.srcData.id,rIndex:Bs.rIndex+1,t:26,display:['<span class="mstrmojo-qb-ListIconBlock t26 "></span><span>',Bq,"</span>"].join("")});});});}Y.forEach(this.functions,function(Br){Y.forEach(Br.fns,function(Bs){Bn.push(Bs);});});if(Bp){this.FFsqlComp=Bn;}return Bn;},getConditions:function AN(){return this.conditions;},setCondition:function AD(Bo,Br,Bp){var Bn=this;mstrApp.getRootController().getDataService().editCondition({success:function Bq(Bs){mstrApp.msgid=Bs.msgid;Bn.isDirty=true;if(Bp&&Bp.success){Bp.success(Bs);}}},{tbid:Bn.tableID||"",clause:Bo?"where":"having",exp:Br});},updateConditions:function d(Br,Bt){var Bo=this,Bs=this.conditions,Bq={success:function Bp(Bv){Bs.having=Bt;Bo.updateFilterLabel(Bs);}},Bn=function Bn(Bv){Bs.where=Br;if(Bt){Bo.setCondition(false,An(Bt),Bq);}else{if(Bs.having){Bo.setCondition(false,"",Bq);}else{Bq.success();}}},Bu={success:Bn};if(Br){this.setCondition(true,An(Br),Bu);}else{if(Bs.where){this.setCondition(true,"",Bu);}else{Bn();}}},appendCondition:function A1(Bo){var Bp=this.conditions,Bn=Bo.sqltp===0;condition=Bn?Bp.where:Bp.having;if(!condition){condition=Bo;}else{if(condition.nds){condition.nds.push(Bo);}else{condition={et:BG.ANDOR,fn:W.FN.AND,nds:[U.copy(condition),Bo]};}}Bp[Bn?"where":"having"]=condition;this.setCondition(Bn,An(condition),null);this.updateFilterLabel(Bp);},canAddTableSQL:function N(Br,Bq){var Bp=this,Bo=Bp.SelDBRoleID,Bn;dbridForDDA=this.dbridForDDA;if(Bp.isDDA&&dbridForDDA&&Bo!==dbridForDDA){Bn={name:"directDataAccessTableError"};}if(Bn){if(!Br){this.raiseEvent(Bn);}return false;}return true;},addTableSQL:function A0(Bo,Bn){j.call(this,Bo.ns,Bo.n,Bn);this.prevDBRoleID=this.SelDBRoleID;},updateFilterLabel:function AX(Bu){var Bo={},Bp=this.tables,Bq,Bt,Br,Bn,Bs;U.forEach(Bu,function(Bv){I(Bo,Bv);});U.forEach(Bp,function(Bv){Bt=Bv.rows;Bq=Bv.tbn.toLowerCase();Bn=Bo[Bq];U.forEach(Bt,function(Bw){Bs=Bw.state;Bs=(Bn&&Bn[Bw.text.toLowerCase()])?(Bs|2):(Bs&(~2));if(Bw.state!==Bs){Bw.state=Bs;Bw.images[1]=Bw.img[Bs];Bw.render();}});});},submitRequest:function Ae(Bp,Bo,Bn){AQ(Bp,Bo,Bn);},onisDDAChange:function AZ(Bn){var Bo=this;mstrApp.getRootController().getDDAController().checkDDACheckbox(Bn.value);Bo.raiseEvent({name:A6.DBTABLES_ENABLED,value:Bo.getAvailableTablesEnabled()});mstrApp.getRootController().enableButton();}});})();(function(){mstrmojo.requiresCls("mstrmojo.qb._hasQBModel");mstrmojo.qb.QBuilderModel=mstrmojo.declare(mstrmojo.warehouse.WHModel,[mstrmojo.qb._hasQBModel],{scriptClass:"mstrmojo.qb.QBuilderModel"});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.qb._hasQBModel","mstrmojo.warehouse.WHModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(14098,9945,9946);var a=1,e=4,c=15,D=1,p=2,H=4,q=2048,g=mstrmojo.string.decodeHtmlString,P=mstrmojo.hash,h=mstrmojo.array,X=mstrmojo.DI.DIConstants,K=4000,T=15,S=200,L=200,o=0,f=0,m=mstrmojo.desc(14098,"There is no project ## in ###.");var I=mstrmojo.desc;function Z(t){return t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function U(t){return g(t).replace(/&apos;/g,"'");}function V(t){t.raiseEvent({name:"dataPreview",mappings:t.mappings,dataset:t.dataset,selectedColumns:t.selectedClns,isRefined:t.isRefined});}function n(AA){var x=AA.datap,AC=x.maps,z=x.srce,AB=z.csl,t=mstrApp.getRootController(),u=this,w=z.gbqp;if(this.firstTimeLoading){this.orimaps=AC;}u.usingCookieNamespace=true;if(z.xt===304){u.prevDBRoleID=z.dbrid;t.selectDBRole(z.dbrid);}else{t.selectDBRole(w);if(u.getProject(w)===null){mstrmojo.alert(m.replace("##",w).replace("###",mstrApp.userEmail));}}AB=Z(AB);this.SQLstmt=AB;mstrApp.getRootController().raiseEvent({name:"reportModeChange",mode:2,value:AB,keepFormat:true});this.populateFFSQLMapping(AC);if(this.firstTimeLoading){V(this);this.firstTimeLoading=false;}}function W(t,u){var w=t.chn;if(!w){if(t.col&&t.stbid){u.push({cid:t.col,tid:t.stbid});}return u;}h.forEach(w,function(x){u=W(x,u);});return u;}function F(t){return t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function d(u){var t={">=":2,"<>":5,"<=":4,"<":3,">":1},w;for(w in t){if(u.indexOf(w)>-1){return t[w];}}return 0;}function E(t,u){var w=[],x;h.forEach(u,function(z){x=t.uiids[z.tid+z.cid];if(x){w.push(x);}});return w;}function J(x,AA,t){if(!AA.ftype){t.push({lcid:x.chn[0].col,rcid:x.chn[1].col,exp:AA.exp});return AA.exp;}var z,w,u;switch(AA.ftype){case 19:case 20:z=J(x.chn[0],AA.children[0],t);w=J(x.chn[1],AA.children[1],t);u=z+((AA.ftype===19)?" AND ":" OR ")+w;break;case 21:u=" NOT "+J(x.chn[0],AA.children[0],t);break;default:break;}return u;}function G(z,w,AA,t,AE,AC){if(!w.ftype){var u=F(w.exp);if(u.indexOf("? aptqbr_prompt")>-1){AC.push({n:u,cid:t.chn[0].cmid});return ;}var AF=E(z,W(t,[])),AB,AD=[];h.forEach(AF,function(AG){AB=mstrmojo.all[AG];if(AB&&AB.updateState){AB.updateState(2);}AD.push({t:AB.srcTable,col:AB.text});});return AA.push({et:"*",n:u,expr:[{v:u}],sqltp:AE,cols:AD});}switch(w.ftype){case 19:case 20:case 21:var x=[];h.forEach(w.children,function(AH,AG){G(z,AH,x,t.chn[AG],AE,AC);});if(!x.length){return ;}if(x.length<w.children.length&&x.length===1){AA.push(x[0]);}else{AA.push({et:14,fn:w.ftype,nds:x,not:(w.ftype===21),sqltp:AE});}break;default:break;}}function O(Aw){var AQ=Aw.datap||[],An=AQ.maps,z=this,AT,AN,Av=mstrApp.getRootController();if(z.firstTimeLoading){z.orimaps=An;}var AV,AS,Ax={},w={},Ao,u=true,Ad={53:function AO(A0){if(A0.ext_type===352||A0.ext_type===341){AV=A0.def.sqs.c_c[0];AS=A0.def.dbr.did;AT=A0.ext_type;AN=A0.def.sqs.big;}else{Ax[A0.did]={cs:A0.def.cs.cs,tbn:U(A0.def.tbn),did:A0.did,ns:A0.def.ns};if(Ao===undefined){Ao=A0.def.ns;}u=u&&(Ao===A0.def.ns);if(A0.ext_type===288){Ax[A0.did].alias=U(A0.n);}}},26:function Aq(A0){w[A0.did]={did:A0.did,cln:U(A0.def.cln),dt:A0.def.dt};}};h.forEach(Aw.btb,function(A0){A0=A0.oi;if(Ad[A0.tp]){Ad[A0.tp](A0);}});z.usingCookieNamespace=true;if(AT===341){Av.selectDBRole(AN);if(z.getProject(AN)===null){mstrmojo.alert(m.replace("##",AN).replace("###",mstrApp.userEmail));}}else{Av.selectDBRole(AS);}z.prevDBRoleID=AS;if(!AV){return ;}var Ae=AV.sqcs.c_c,AI=AV.whe,Ak=AV.w_cond,Az=AV.he,AC=AV.h_cond;z.selectedClns=[];z.dbtables=[];z.joins=[];z.joinsInfo={};z.uiids={};z.tables={};var At=z.selectedClns,Aj={},AR,As,Ay,AH,AM;h.forEach(Ae,function(A0){if(!(A0.der&2147483648)){AR=W(A0.exp.roo,[]);Ay=U(A0.exp.exp);As=[];h.forEach(AR,function(A1){AH=A1.cid;AM=A1.tid;Aj[AM]=Aj[AM]||{};Aj[AM][AH]=Aj[AM][AH]||{};Aj[AM][AH].state=1;Aj[AM][AH].count=!Aj[AM][AH].count?1:Aj[AM][AH].count+1;As.push(AM+AH);});At.push({wid:As,expr:[{v:Ay}],existing:true,ix:A0.ix});}});z.tbns={};var AK=z.pos_hash,AF=z.tbns,Au=[],AD,AA,Af,Am,Ap,x,Aa;h.forEach(AV.stbs.c_c,function(A1,A0){Aa={};AM=A1.id;AD=A1.dbt.did;Ap=A1.als?U(A1.als):(Ax[AD].alias||Ax[AD].tbn);Af=Ax[AD].cs;if(AK&&AK[Ap]){Aa.pos={w:AK[Ap].w||L,h:AK[Ap].h||S,t:AK[Ap].t||o,l:AK[Ap].l||f};}else{AA=A1.sqltf;if(AA&&AA.length){Aa.pos={w:(AA[0]&&AA[0].pdv)/T||L,h:(AA[1]&&AA[1].pdv)/T||S,t:(AA[2]&&AA[2].pdv)/T||o,l:(AA[3]&&AA[3].pdv)/T||f};}}Am=[];h.forEach(Af,function(A2){AH=A2.did;x=P.copy(w[AH]);if(Aj[AM]&&Aj[AM][AH]){x.state=1;x.count=Aj[AM][AH].count;}Am.push(x);});Aa.did=AM;Aa.cs=Am;Aa.tbn=Ap;Aa.ns=Ax[AD].ns;Aa.dbtbn=Ax[AD].tbn;Au[A0]=Aa;AF[Ap]=Ap;});if(z.firstTimeLoading&&!z.isNew){z.orits=z.orits||Au.slice(0);}var AP=z.orits;h.forEach(Au,function(A0){if(h.find(AP,"did",A0.did)>-1){A0.existing=true;A0.readOnly=mstrApp.isCloudPro;}});z.raiseEvent({name:"BindingTableLoaded",value:Au});h.forEach(At,function(A0){As=A0.wid;h.forEach(As,function(A2,A1){As[A1]=z.uiids[A2];});});if(An){z.populateMappings(An);}if(AQ.data){z.populateDataset(AQ.data);}if(this.firstTimeLoading){V(z);}var AG,Al,Ai,AB,Ar,AW,Ab,AL,AZ,Ag,t,AE,AJ,AY;h.forEach(AV.sjs.c_c,function(A0){AG=A0.ltid;Ai=A0.rtid;Ab=A0.jt;AL=A0.ix;AZ=A0.cdn.roo;AJ=[];AE=z.uiids[AG]+z.uiids[Ai];z.joins.push(AE);AY={jt:Ab+"",exp:U(J(AZ,A0.exp_bo,AJ)),srctID:z.uiids[AG],tgttID:z.uiids[Ai],links:{}};Al=z.tables[z.uiids[AG]];AB=z.tables[z.uiids[Ai]];Al.njoins=(Al.njoins||0)+1;AB.njoins=(AB.njoins||0)+1;h.forEach(AJ,function(A1){Ag=A1.lcid;t=A1.rcid;Ay=U(A1.exp);Ar=z.uiids[AG+Ag];AW=z.uiids[Ai+t];AY.links[Ar+AW]={srcw:mstrmojo.all[Ar],tgtw:mstrmojo.all[AW],coords:[],exp:Ay,jid:AE,op:d(Ay)};AY.nlinks=(AY.nlinks||0)+1;z.addJoinColInfo(Ar,AW);});z.joinsInfo[AE]=AY;});z.raiseEvent({name:"JoinsLoaded"});var AU=[],Ac=[];if(AI.exp!==""){G(z,Ak,AU,AI.roo,0,Ac);if(AU.length){z.conditions.where=AU[0];}if(Ac.length&&!z.isCubeReport){z.pattrs={};var AX=An.amps,Ah;h.forEach(AX,function(A0){if(h.find(Ac,"cid",A0.afmps[0].sqc.id)>=0){Ah=A0.aimp;z.pattrs[Ah.atid]={n:Ah.atnm,tp:12};}});}}if(Az.exp!==""){AU=[];G(z,AC,AU,Az.roo,1);if(AU.length){z.conditions.having=AU[0];}}z.firstTimeLoading=false;}function C(u){var t=this;if(!t.FFSQLMode){if(t.getColumnsCount()===0){mstrmojo.alert(mstrmojo.desc(9945,"Please add at least one column and try again."));if(u&&u.failure){u.failure();}return false;}if(t.getTablesCount()===0){mstrmojo.alert(mstrmojo.desc(9946,"Please add at least one table and try again."));if(u&&u.failure){u.failure();}return false;}}return true;}mstrmojo.qb.EmmaModel=mstrmojo.declare(mstrmojo.warehouse.WHModel,[mstrmojo.qb._hasQBModel],{scriptClass:"mstrmojo.qb.EmmaModel",originalMsgID:undefined,dbRolesVersionExcludeFilter:[223],isDataImport:true,init:function l(t){if(this._super){this._super(t);}if(t.dbIds){this.dbRoleEditorCfg.dbIdFilter=t.dbIds;}if(t.dbTypes!==undefined){this.specifyDBTypes=true;this.dbRolesTypeFilter=t.dbTypes;this.dbmsTypeFilter=this.dbRolesTypeFilter;}if(t.dbVersions){this.dbRolesVersionFilter=t.dbVersions;this.dbmsVersionFilter=t.dbVersions;}if(t.dbObjects!==undefined){this.dbObjects=t.dbObjects;}if(t.isHadoopQB){this.dbObjectsDisplayOptions=16;this.specifyDBTypes=true;this.dbRolesTypeFilter=X.hadoopDbTypes.slice(0);this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);this.dbRolesVersionExcludeFilter=X.ibmDb2Versions.concat(this.dbRolesVersionExcludeFilter?this.dbRolesVersionExcludeFilter:[]);}this.dbRoleEditorCfg.dbIdExcludeFilter=!mstrApp.isFFSQL?[41,15]:[41];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=!mstrApp.isFFSQL?[3000]:[];},dbRoleEditorCfg:{dbIdExcludeFilter:[41]},createReportInstance:function Q(w,u){var z=this,t=z.isNew=!mstrApp.tableID;z.supportTimeGeo=true;z.analysisID=mstrApp.analysisID;z.tableID=mstrApp.tableID;var AB=mstrApp.getRootController().getDataService(),x=mstrApp.isFFSQL,AC=function AC(AE,AD){AB.createEmmaTable({success:function AF(AG){z.tableID=AG.tbid;mstrApp.msgid=AG.msgid;}},{xt:AE,dict:AD});};mstrApp.msgid=mstrApp.msgID;if(t){if(mstrApp.msgid){z.originalMsgID=mstrApp.msgid;AB.removeOrDuplicateRI({success:function(AD){mstrApp.msgid=AD.msgid;AC(w,u);}},{messageID:mstrApp.msgid});}else{AB.createEmmaInstance({success:function AA(AD){mstrApp.msgid=AD.msgid;AC(w,u);}});}}else{z.originalMsgID=mstrApp.msgid;AB.removeOrDuplicateRI({success:function(AD){mstrApp.msgid=AD.msgid;z.firstTimeLoading=true;var AE=e;AE=AE+(x?0:a);z.loadReport(AE,c,D+H,null,{success:function AF(AG){if(x){n.call(z,AG);}else{O.call(z,AG);}if(mstrApp.isCloud){mstrApp.getRootController().getDataService().autoClosePrompt({success:function AH(AI){mstrApp.msgid=AI.msgid;}});}}});}},{messageID:mstrApp.msgid});}if(mstrApp.isFFSQL){z.set("isFFSQL",true);z.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},loadDefinition:function B(t){O.call(this,t);},remap:function j(u,t){mstrApp.getRootController().getDataService().changeMapping({success:function w(x){if(t&&t.success){t.success(x);}}},{tbid:this.tableID,mpcs:JSON.stringify([u]),docid:mstrApp.docID||""});},loadEmmaReport:function M(w,t,AC,z){var u=this,AB=!z?e:a+e,x=D+p;if(!C.call(u,w)){return ;}if(u.isRefined&&!mstrApp.isFFSQLMode){x=D+q;}u.loadReport(AB,c,x,null,{success:function AA(AE){u.isDirty=false;if(!t){var AD=AE.datap,AG=AD.maps,AF=AD.data;if(u.FFSQLMode){u.populateFFSQLMapping(AG);u.populateDataset(AF);}else{u.populatePreview(AG,AF);}V(u);}if(w&&w.success){w.success(AE);}}});},autoMap:function b(AA,AB,t,w){var AC=mstrApp.getRootController().getDataService(),x=this,u;if(!C.call(x,AA)){return ;}u={tbid:x.tableID,isDB:true,taskId:"DIAutoMappingEMMASourceTable"};if(!x.isNew&&(mstrApp.isFFSQL||!x.FFSQLMode)){u.behaviorFlags=16;}if(!x.isDirty&&x.isNew){x.loadEmmaReport(AA,AB,t,w);return ;}var z=function(){x.submitRequest({success:function AF(){x.loadEmmaReport(AA,AB,t,w);},failure:function AE(AG){if(AA&&AA.failure){AA.failure(AG);}}},u);};x.processEmmaTable({success:function AD(){z();},canceled:function(AG,AF){var AE={success:function(){if(AA.canceled){AA.canceled();}},failure:function(){if(AA.canceled){AA.canceled();}}};if(AF&&(AF.tid||AF.jid)){AC.killJob(AE,{threadId:AF.tid,jobid:AF.jid});}else{AE.success();}}},{tables:x.tableID});},processEmmaTable:function(w,u){var t=mstrApp.getRootController().getDataService();t.prepareData(w,u,1,1,I(9130,"Execute SQL"));},buildRelations:function R(t){mstrApp.getRootController().getDataService().buildRelations({success:function u(w){if(t&&t.success){t.success(w);}}},{did:this.tableID});},loadDBTypeFilters:function A(w){var t=this;t.dbObjects.populateDBProperties(mstrmojo.func.wrapMethods({success:function u(){var z=[],x=t.dbObjectsDisplayOptions;P.forEach(t.dbObjects.dbTypes,function(AA){if((AA.disp&x)===x){z.push(AA.v);}});t.dbmsTypeFilter=z;t.dbRolesTypeFilter=z;}},w));},cleanDuplicateRI:function N(u){var t;if(this.originalMsgID&&this.originalMsgID!==mstrApp.msgid){if(u){t=mstrApp.msgid;mstrApp.msgid=this.originalMsgID;}else{t=this.originalMsgID;}mstrApp.getRootController().getDataService().removeOrDuplicateRI({success:mstrmojo.emptyFn},{add:false,messageID:t,showWait:false});delete this.originalMsgID;}},submitRequest:function k(w,u,t){if(u.showWait===undefined){u.showWait=true;}mstrApp.getRootController().getDataService()[t||"submitRequest"](w,u);},getHelpTopic:function Y(){return this.FFSQLMode?"importing_data_using_freeform_script.htm":"importing_data_from_a_database.htm";}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDataChangeEvents");var F=mstrmojo.string;var E=4,A=15,D=8;function G(M){return M.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function I(O){var M=O.datap,N=M.srce,P=N.csl;this.set("SelDBRoleID",N.dbrid);P=G(P);this.SQLstmt=P;this.raiseEvent({name:"reportDefLoaded"});}function C(M){return M.dbRoleID+M.url;}mstrmojo.qb.thirdParty.Model=mstrmojo.declare(mstrmojo.qb.EmmaModel,null,{scriptClass:"mstrmojo.qb.thirdParty.Model",dbRolesVersionFilter:[223],dbRolesVersionExcludeFilter:[],dbObjectsDisplayOptions:8,xdaType:304,connectorType:131076,dbRoleEditorCfg:{hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[41],singleType:true},urlSrc:null,init:function L(M){this.dbRoleEditorCfg.showAddDriver=false;M.dbIds=null;M.dbVersions=null;this._super(M);this.urlSrc=[];this.dbRoleEditorCfg.dbIdExcludeFilter=[];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=[];},createReportInstance:function K(){var O=this,N=mstrApp.isFFSQL,M=O.isNew=!mstrApp.tableID,Q=mstrApp.getRootController().getDataService();O.supportTimeGeo=true;O.analysisID=mstrApp.analysisID;O.tableID=mstrApp.tableID;mstrApp.msgid=mstrApp.msgID;if(M){if(mstrApp.msgid){O.originalMsgID=mstrApp.msgid;Q.removeOrDuplicateRI({success:function(R){mstrApp.msgid=R.msgid;}},{messageID:mstrApp.msgid});}else{Q.createEmmaInstance({success:function P(R){mstrApp.msgid=R.msgid;}});}}else{O.originalMsgID=mstrApp.msgid;Q.removeOrDuplicateRI({success:function(R){mstrApp.msgid=R.msgid;var S=E;O.loadReport(S,A,D,null,{success:function T(U){if(N){I.call(O,U);}if(mstrApp.isCloud){mstrApp.getRootController().getDataService().autoClosePrompt({success:function V(W){mstrApp.msgid=W.msgid;}});}}});}},{messageID:mstrApp.msgid});}if(mstrApp.isFFSQL){O.set("isFFSQL",true);O.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},getAllowSave:function H(M){if(M&&M!==""){return true;}return false;},getHelpTopic:function J(){return"importing_data_from_a_BI_source.htm";},getNameSpaces:mstrmojo.emptyFn,autoMapFFSQL:function B(N,P){var M=this;mstrApp.getRootController().getDataService().editFFSQL({success:function O(){M.isDirty=true;M.SQLstmt=N;if(N){M.autoMap(P);}}},{exp:F.encodeXMLAttribute(N),tbid:M.tableID||""});}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._hasBigQueryModel","mstrmojo.hash");var C=mstrmojo.hash;mstrmojo.qb.bigquery.Model=mstrmojo.declare(mstrmojo.qb.EmmaModel,[mstrmojo.qb.bigquery._hasBigQueryModel],{setDBRole:function A(D){mstrApp.getRootController().getDataService().setDBRole({success:function(E){mstrApp.msgid=E.msgid;}},{dbrid:D,said:mstrApp.said,pid:this.selectedProject,tbid:this.tableID||""});},getRowWidget:function B(D,F){var G=this.tables,E,I=D.toLowerCase()+"."+F.toLowerCase(),H;C.forEach(G,function(J){E=J.tbn.toLowerCase();C.forEach(J.rows,function(K){if(E+"."+K.text.toLowerCase()===I){H=K;return false;}});});return H;},catalogRefresh:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasPopup","mstrmojo._FillsBrowser","mstrmojo.Box","mstrmojo.Table","mstrmojo.Image","mstrmojo.Button","mstrmojo.qb.SplitPanel","mstrmojo.qb.VSplitPanel","mstrmojo.qb.QBuilderModel","mstrmojo.qb.QBPanel","mstrmojo.qb.QBMappings","mstrmojo.qb.MissingColumnWarning","mstrmojo.form","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.Toolbar","mstrmojo.qb.QBPageLayout","mstrmojo.qb.Footer","mstrmojo.DI.DIExitOptions");mstrmojo.requiresDescs(531,1143,3377,12408,12484);var Q=mstrmojo.hash,E=mstrmojo.desc;var L="qbexpr",V={scriptClass:"mstrmojo.qb.ExpressionEditor",id:L};var A=" ",K=".";var M=E(12408,"Please add tables from the same DB connection.");function B(Z,a){if(!a){return Z;}return(Z.indexOf(A)>-1||Z.indexOf(K)>-1)?a.replace("#0",Z):Z;}function P(b,e,c){var k=[],a=mstrmojo.all.FFsql,l,g,h=c.length,j=a.items,f,d=this.main.WHTableTree,Z=d.getDBRole(d.getDBRoleID()).cpat;l=g=a.itemCount;k.push({isNew:true,v:"select",oi:{n:"select",sta:100,t:100},did:g++},{isNew:true,v:" ",isDelimiter:true,did:g++});mstrmojo.array.forEach(c,function(n,m){k.push({isNew:true,v:B(n.cln,Z),did:g++});f=m<h-1;if(f){k.push({isNew:true,v:",",isDelimiter:true,did:g++});}k.push({isNew:true,v:"\n",isDelimiter:true,did:g++});if(f){k.push({isNew:true,v:" ",isDelimiter:true,did:g++});}});e=B(e,Z);k.push({isNew:true,v:"from",oi:{n:"from",sta:100,t:100},did:g++},{isNew:true,v:" ",isDelimiter:true,did:g++},{isNew:true,v:(b?B(b,Z)+K+e:e),did:g++},{isNew:true,v:";",did:g++});if(l>0&&j[l-1]!=="\n"){j.push({isNew:true,v:"\n",isDelimiter:true,did:g++});}j=j.concat(k);a.itemCount=g;a.set("items",j);a.parent.updatepasses();}mstrmojo.qb.QBuilderPage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBuilderPage",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},id:"QBuilderPage",onError:mstrmojo.emptyFn,renderPageLoadError:function G(){var b=this.error,a=b.message,c=b.title,Z=b.btns;this.onError(b);if(!Z||!Z.length){mstrmojo.alert(a,null,c);}else{mstrmojo.confirm(a,null,{buttons:Z,title:c});}},render:function Y(){if(this.error){this.renderPageLoadError();}else{this._super();}},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:mstrmojo.desc(3377,"Object"),browsableTypes:"3,8",showCompletePath:false,onObjectSaved:function(b){var a=this.opener,Z=a&&a.oi;if(a&&Z){Z.did=b.did;Z.n=b.name;Z.desc=b.desc;a.set("title","QBReport: "+b.name);}}},children:[{scriptClass:"mstrmojo.qb.QBPageLayout",slot:"layout",alias:"main"}],init:function T(b){this._super(b);var c={},a=c[this.id]={};a.directDataAccessTableError=this.onTableAdded;a.diffDBInstTableError=this.onTableAdded;a.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(c);var d=this.getDBRoleSelector(),Z=this.main.children[0].bottomPanel;d.getLayoutOffsets=function(){return{h:9,w:0};};Z.getLayoutOffsets=function(){return{h:16,w:0};};Z.searchBox.widthOffset=10;Z.nameSpaces.heightOffset=30;d.heightOffset=38;Z.heightOffset=73;this.main.workPanel.getLayoutOffsets=function(){return{h:16,w:12};};d.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");},getDBRoleSelector:function I(){return this.main.children[0].topPanel;},getDBConnectionList:function J(){return this.getDBRoleSelector().dbConnections;},onTableAdded:function O(Z){var a="";switch(Z.name){case"diffDBInstTableError":a=M;break;case"directDataAccessTableError":a=M;break;}mstrmojo.qb.alert(a);},openDialog:function W(Z){this.openPopup(Z);},openExpressionEditor:function H(a,b){var Z=mstrmojo.all[L]||mstrmojo.insert(V);Z.set("oi",Q.copy(a,{mhfts:{},mvfts:{}}));Z.open(null,{zIndex:b||50});},addSQLFromColumn:function S(Z){P.call(this,Z.ns,Z.tbn,[Z]);},addSQLFromTable:function R(a,b,Z){P.call(this,a,b,Z);},getSQLStatement:function D(){return mstrmojo.all.FFsql.getSQLstmt();},toggleDatabaseView:function X(Z){this.main.toggleDatabaseView(Z);},toggleDataPreview:function C(Z){this.main.toggleDataPreview(Z);},loadView:function N(){this.toggleDataPreview(true);this.toggleDataPreview(false);},showRedirectionPage:function F(Z,a){this.set("children",[{scriptClass:"mstrmojo.Label",slot:"toolbar",text:mstrmojo.desc(12484,"Data Imported"),cssClass:"mstrmojo-qb-title"},{scriptClass:"mstrmojo.Image",cssClass:"mstrmojo-qb-toolbarIcon help",slot:"toolbar",title:mstrmojo.desc(1143,"help"),onclick:function(){var b=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId?mstrApp.helpLocaleId:mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm")+"#"+((mstrApp.helpTopics&&mstrApp.helpTopics.general)||"About_importing_data.htm");window.open(b);}},{scriptClass:"mstrmojo.DI.DIExitOptions",privileges:{CreateViewReport:mstrConfig.canCreateReport,CreateReportServices:mstrConfig.canCreateDocument,CreateAnalysis:mstrConfig.canCreateAnalysis},model:{cubeID:Z,path:a,operationMode:mstrApp.getRootController().getOperationMode()},slot:"layout"},{scriptClass:"mstrmojo.qb.Footer",slot:"footer",alias:"footerWidget"}]);this.footerWidget.hidePublish();},adjustSize:function(a){var b=a.size,d=mstrApp.isCloudPro,f=d?40:0,e=d?180:101;var c,Z;Z=parseInt(b.h,10)-e+"px";c=parseInt(b.w,10)-f+"px";if(this.height&&Z!==this.height){this.set("height",Z);}else{this.height=Z;}if(this.width&&c!==this.width){this.set("width",c);}else{this.width=c;}return true;},postBuildRendering:function U(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size});}});})();(function(){mstrmojo.requiresCls("mstrmojo.qb.QBuilderModel");var C=mstrmojo.func.wrapMethods,E=mstrmojo.array;function D(H,G,F){G.showWait=F;mstrApp.getRootController().getDataService().submitRequest(H,G);}function B(F){if(!F){return"";}return"hdfs://"+F.hadoopName+":"+F.webHDFSPort+"/webhdfs/v1/?op=liststatus";}mstrmojo.DI.DIHadoopModel=mstrmojo.declare(mstrmojo.qb.QBuilderModel,null,{scriptClass:"mstrmojo.DI.DIHadoopModel",dbObjectsDisplayOptions:32,dbRolesTypeFilter:[5400],dbRolesVersionFilter:[218],dbmsTypeFilter:[5400],saveDBRole:function A(G,F,I){D(C({success:function H(J){mstrApp.dbRoleID=J.dbr.did;var K=[];E.forEach(G.connstr.split(";"),function(M){var L=M.split("=");K[L[0].trim()]=L[1];});mstrApp.hadoopConnURL=B(K);}},I),{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",dbroleinfo:JSON.stringify(G),showWait:true},true);}});})();(function(){mstrmojo.requiresCls("mstrmojo.qb.QBPageLayout","mstrmojo.qb.QBuilderPage","mstrmojo.qb.bigquery.BigQueryWHPanel","mstrmojo.qb.QBHelpers");var F=mstrmojo.qb.QBHelpers;var B=[{did:"Delete",n:mstrmojo.desc(629,"Delete")},{did:-1,n:"-"},{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:-1,n:"-"},{did:"More Options",n:mstrmojo.desc(9126,"More Options")}];var C=[{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")}];var A=[{n:"=",dssid:"0"}];mstrmojo.qb.bigquery.QBPageLayout=mstrmojo.declare(mstrmojo.qb.QBPageLayout,null,{scriptClass:"mstrmojo.qb.bigquery.QBPageLayout",init:function D(H){var G;this.children=F.clone(this.children);this.children[0].scriptClass="mstrmojo.qb.bigquery.BigQueryWHPanel";if(this._super){this._super(H);}G=this.workPanel.children[0].tables;G.joinMenuOption={menuItems:B,joinItems:C,mappingKey:"bigquery",joinOperators:A};}});mstrmojo.qb.bigquery.BigQueryBuilderPage=mstrmojo.declare(mstrmojo.qb.QBuilderPage,null,{scriptClass:"mstrmojo.qb.bigquery.BigQueryBuilderPage",init:function D(G){this.children=F.clone(this.children);this.children[0].scriptClass="mstrmojo.qb.bigquery.QBPageLayout";if(this._super){this._super(G);}},getDBRoleSelector:function E(){return this.main.children[0].topPanel.dbSelector;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.Serializer","mstrmojo.array","mstrmojo.qb.QBuilderPage","mstrmojo.qb.QBuilderModel","mstrmojo.warehouse.WHController","mstrmojo.qb.QBHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(218,219,221,1442,3179,3377,7985,7986,8041,9114,9139,9523,9915,11299,12379,12380,12922,13137);var n=mstrmojo.hash,w=mstrmojo.array,AR=mstrmojo.string,h=mstrmojo.warehouse.EnumDataChangeEvents,AK=mstrmojo.qb.QBHelpers,g=mstrmojo.DI.DIConstants,X=mstrmojo.desc;var N={1:X(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),2:X(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this.")};var M=function(AW){if(AW===null){return"null";}var AX=typeof (AW);if(AX!=="object"){return AX;}else{if(AW.length===undefined){return"object";}else{return"array";}}};function H(AW){var AX=mstrApp.diShowFooterFunction;if(AX){AX({finish:{visible:AW}});}}function x(AX){var AW=AX.FFSQLMode?"Type Query":"Build Query";return{name:AW};}mstrmojo.qb.RootController=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{ddaController:null,start:function o(Ai,AZ){var Ac=this.rootView,Ab=this.model,Ad=this,AX,Aa,AW,Af,AY,Ah;this.dataService=mstrmojo.qb.DataService;Ac.render();if(mstrApp.isCloudPro){mstrApp.docID=mstrApp.docID||"";}else{mstrApp.docID=mstrApp.docID||mstrApp.analysisID||"";}if(mstrApp.isFFSQL){this.raiseEvent({name:"reportModeChange",mode:2,value:""});}this.toggleDatabaseView(true);Ac.loadView();var Ae=function Ae(){Ad.loadDBRoles({success:function Aj(){Ab.createReportInstance(Ai,AZ);var Ak;Ak=(Ab.isNew&&mstrApp.emmaTablesNum===0);H(Ak);}});};if(Ab.specifyDBTypes){Ab.dbObjects.populateDBProperties({success:function Ag(){Ae();}});}else{Ab.loadDBTypeFilters({success:function Ag(){Ae();}});}AX=mstrApp.diRootViewID;this.header=Aa=(AX?(mstrmojo.all[AX]&&mstrmojo.all[AX].header):undefined);if(Aa){Aa.closeBtn.set("visible",!mstrApp.tableID);}Ab.attachEventListener("dataPreview",this.id,function(){Ad.enableButton(Ab.SQLstmt);});AW=mstrApp.diFooterID;Af=AW?mstrmojo.all[AW]:undefined;if(Af){AY=Af.next;Ah=Af.finish;Ad.attachEventListener("allowSave",AY.id,Af.enableButton);Ad.attachEventListener("allowSave",Ah.id,Af.enableButton);}},getDataService:function Y(){return this.dataService;},toggleDatabaseView:function AO(AW){this.rootView.toggleDatabaseView(AW);},toggleDataPreview:function AE(AW){var AY=this.rootView,AX=this.model.FFSQLMode;AY.toggleDataPreview(AW);if(!AX){AY.showQBPreview=AW;}if(AW){this.raiseEvent({name:"dataPreview"});}},openConditionDialog:function e(){var AX=this.model,Aa=mstrApp.diCurrentZIndex,AZ=Aa?Aa+1:(this.zIndex||10)+1;if(AX.dbtables.length===0){mstrmojo.alert(mstrmojo.desc(9114,"Cannot add Filter without any Tables being added, please add some Tables first"));return ;}var AY="qbcondition",AW=mstrmojo.all[AY]||mstrmojo.insert({scriptClass:"mstrmojo.qb.ConditionEditor",id:AY});AW.set("zIndex",AZ);if(!AW.hasRendered){AW.render();}AW.domNode.style.zIndex=AW.zIndex;AW.set("data",n.clone(AX.getConditions()));AW.set("visible",true);},refreshConditionDialog:function L(){var AX=this.model,AY="qbcondition",AW=mstrmojo.all[AY];if(AW&&AW.visible){AW.set("data",n.copy(AX.getConditions()));}},openHelp:function k(){var AW=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId?mstrApp.helpLocaleId:mstrApp.localeId)+"/MicroStrategy_Web_Help.htm#"+(mstrApp.isFFSQL?"freeform_import_page.htm":"database_import_page.htm");window.open(AW);},openExpressionEditor:function S(AX){var AW=this,AZ={success:function AY(){var Ab=mstrApp.diCurrentZIndex,Aa=Ab?Ab+3:AW.zIndex;AW.rootView.openExpressionEditor(AX,Aa);}};if(this.getFunctionList()){AZ.success();return ;}this.model.getFunctions(false,{success:function AY(){AZ.success();}},{showWait:true});},getFunctionList:function AA(){return this.model.getFunctionList();},getSuggestionItems:function AP(AW){return this.model.getSuggestionItems(AW);},exprjson2xml:function d(Ai,Af,AZ){if(!(Af instanceof Array)){Af=[Af];}var AX=AZ&&AZ.isSerializable,Ad=(AZ.convertBoolean===false)?false:true;var Ag=[],AW=[],AY,Aj;for(var Ac=0,Ak=Af.length;Ac<Ak;Ac++){var Al=Af[Ac];for(AY in Al){if(AX){var Ae=AX(AY,Af,Ac);if(Ae!==true){if(Ae===false){continue;}else{if(Ae.att){Ag.push(Ae.att);}if(Ae.child){AW.push(Ae.child);}continue;}}}Aj=Al[AY];switch(M(Aj)){case"array":var Aa,Ab,Ah;if(AY!=="omit"){AW.push(["<",AY,">"].join(""));for(Aa=0,Ab=Aj.length;Aa<Ab;Aa++){Ah=AZ.getArrItemName(AY,Aj,Aa)||Aa;AW.push(this.exprjson2xml(Ah,Aj[Aa],AZ));}AW.push("</"+AY+">");}else{for(Aa=0,Ab=Aj.length;Aa<Ab;Aa++){Ah=AZ.getArrItemName(AY,Aj,Aa)||Aa;AW.push(this.exprjson2xml(Ah,Aj[Aa],AZ));}}break;case"object":AW.push(this.exprjson2xml(AY,Aj,AZ));break;case"string":Ag.push([AY,'="',mstrmojo.string.encodeXMLAttribute(Aj),'"'].join(""));break;case"boolean":Ag.push([AY,'="',((Ad)?(Aj?"-1":"0"):Aj),'"'].join(""));break;case"null":if(!AZ.skipNull){Ag.push([AY,'="',AZ.nullValue,'"'].join(""));}break;default:Ag.push([AY,'="',Aj,'"'].join(""));break;}}}return["<",Ai," ",Ag.join(" "),">",AW.join(""),"</",Ai,">"].join("");},parseExpression:function D(AX,AW){this.model.validateExpr(AX,AW);},autoMap:function AF(){var AW=this;if(!AW.hasDBConnection()){return ;}AW.model.autoMap({success:function(){AW.toggleDataPreview(true);}},false,false);},autoMapFFSQL:function q(AX){var AW=this;if(!AW.hasDBConnection()){return ;}AW.model.autoMapFFSQL(AX,{success:function AY(){AW.enableButton(AX);}});},getSQLPreview:function l(AW){this.model.getSQL(AW);},convertMode:function AM(Ac){var AY=this,Ab=mstrApp.diCurrentZIndex,Aa=Ab?Ab+1:1000;AY.model.connectLiveSupport=undefined;if(Ac){this.model.getSQL({success:function AZ(Ae){AY.model.convertToFFSQL(Ae,{success:function Af(){AY.toggleDataPreview(false);AY.raiseEvent({name:"reportModeChange",mode:2,value:Ae});}});}});}else{var AX=AY.rootView.showQBPreview,Ad={success:function(){AY.toggleDataPreview(AX);AY.raiseEvent({name:"reportModeChange",mode:1,showPreview:AX});}},AW=mstrmojo.all.FFsql;if(AW.oriSQL===AW.getSQLstmt()){AY.model.convertToQueryBuilder(Ad);}else{mstrmojo.confirm(mstrmojo.desc(9139,"All changes performed in FFSQL mode will be lost. Do you want to leave FFSQL mode?"),{confirmBtn:{fn:function(){AY.model.convertToQueryBuilder(Ad);}}},{zIndex:Aa});}}},editSQL:function AS(AW,AX){this.model.editFFSQL(AX,AW);},addTable:function AB(AX,AW){this.model.addTable(AX,AW);},addTables:function AJ(AX){var AY=this,AW=AY.model;w.forEach(AX,function(Aa){AY.getColumnsForDBTable({data:Aa},{success:function AZ(Ab){if(AW.FFSQLMode){AY.addTableSQL(Aa,Ab.items);AY.enableButton();}else{AY.addTable(Aa,Ab.items);}}});});},addSQLFromTable:function AH(AX,AY,AW){this.rootView.addSQLFromTable(AX,AY,AW);},addSQLFromColumn:function AC(AW){this.rootView.addSQLFromColumn(AW);},addSelectedColumns:function b(AZ,AW,AY,AX){this.model.addSelectedColumns(AZ,AW,AY,AX);},addColumnWithExpression:function R(AW,AZ,AY,AX){this.model.addColumnWithExpression(AW,AZ,AY,AX);},editColumnExpression:function t(AW,AZ,AY,AX){this.model.editColumnExpression(AW,AZ,AY,AX);},gettIndex:function a(AW){return this.model.gettIndex(AW);},updateTableViewWithExpression:function Q(AX,AW,Ad){var Ab=this.model,Aa=Ab.selectedClns[AX],AZ=Aa.wid,AY,Ac;Aa.expr=AW;w.forEach(AZ,function(Ae){AY=mstrmojo.all[Ae];if(AY&&!Ad){if(AY.count>0){AY.count--;}AY.updateState(0);}});AZ=[];w.forEach(AW,function(Ae){Ac=Ae.oi;if(Ac&&Ac.tp===26){AY=Ab.getRowWidget(Ac.tn,Ac.rn);if(AY){AY.count++;AY.updateState(1);AZ.push(AY.id);}}});Aa.wid=AZ;Ab.updateExpression(AX);},updateFilters:function AN(AW,AX){this.model.updateConditions(AW,AX);},addNewFilter:function U(AW){this.model.appendCondition(AW);},cancel:function K(){var AW=mstrApp.origin?(mstrApp.isBigQuery?"-3":"-2"):"-1";mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:AW},mstrApp.name,"POST",null,null,false);},onCancelButtonClick:function AL(){var AW;this.model.cleanDuplicateRI(true);AW=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=AW;mstrApp.getRootController().onCancelButtonClick();},onNextButtonClick:function W(){var AW=this;this.commit({success:function AX(){var AY,AZ=mstrApp.getRootController().model,Ab=AZ.isDDA,Aa=AZ.isManagedCube;if(AW.header&&AW.header.closeBtn){AW.header.closeBtn.set("visible",true);}AZ.cleanDuplicateRI(false);AY=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=AY;mstrApp.isDDA=Ab;mstrApp.isManagedCube=Aa;mstrApp.getRootController().afterQBProcess();}});},saveDDACube:function AT(AX){var AY=this.model,AZ={},Aa;Aa={success:function(Ah){var Ab,Ad=AY.isDDA,Ae,Ai,Af,Ag,Ac,Aj=AY.isManagedCube;AY.cleanDuplicateRI(false);Ab=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=Ab;mstrApp.isDDA=Ad;mstrApp.isManagedCube=Aj;Ae=mstrApp.getRootController();Ai=Ae.model;Ae.getDDAController().setDirectDataAccess(mstrApp.isDDA);Ae.dataService.set("messageID",mstrApp.messageID);Ae.model.isManagedCube=mstrApp.isManagedCube;Ai.cubeName=x(AY).name;if(mstrApp.isSingleTier){Af={isDirectDataAccess:Ai.isDirectDataAccess,name:Ai.cubeName};Ag={success:function(Ak){if(Ak.objectId){Ai.cubeID=Ak.objectId;}Ae.wrapUpDataImport();},failure:function(Ak){mstrApp.hideProgress();Ae.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,Ak&&Ak.message);}};Ac={success:function(){Ae.dataService.createOneTierDoc(Ag,Af);},failure:function(Ak){mstrApp.hideProgress();Ae.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,Ak&&Ak.message);}};if(Ai.operationMode===g.operationMode.edit||Ai.operationMode===g.operationMode.refresh){Ae.dataService.duplicateReportInstance(Ac,{messageID:Ai.analysisID,datasetID:Ai.cubeID,duplicateRIMsgID:Ae.dataService.messageID});}else{Ae.dataService.createOneTierDoc(Ag,Af);}return ;}if(Aj){Ae.wrapUpDataImport();return ;}Ai=Ae.model;if(Ah&&Ah.objectId){Ai.cubeID=Ah.objectId;}Ai.path=AX&&AX.objPath;Ae.wrapUpDataImport();}};function AW(){if(AY.isManagedCube){Aa.success();return ;}AZ.displayMode=12;AZ.shouldRefresh=false;if(AY.isDDA){AZ.shouldRefresh=false;AZ.saveAsFlags=g.saveAsFlags.saveAsDDA|g.saveAsFlags.saveAsOverWrite;}else{AZ.saveAsFlags=g.saveAsFlags.saveAsInMemory|g.saveAsFlags.saveAsOverWrite;}AZ.taskId="saveAndPublishCube";AZ.showWait=true;AZ=n.copy(AX,AZ);AZ.saveAsOverwrite=true;delete AZ.objPath;mstrApp.getRootController().model.submitRequest(Aa,AZ);}mstrApp.getRootController().model.submitRequest({success:function(){if(AY.operationMode!==2){mstrApp.getRootController().model.submitRequest({success:function(){AW();}},{taskId:"DIClearRelationshipEMMASourceTable",showWait:true});}else{AW();}}},{taskId:"DIToggleDatasetServeMode",serveMode:AY.isDDA?g.datasetServeMode.dda:g.datasetServeMode.inMemory,showWait:true});},handleFinish:function Z(){var AW=this.model,AY=this,AX=AW.operationMode,AZ={};AZ.onOK=function(Ab){AY.commit({success:function Aa(){var Ac,Ae=AW.isDDA,Ad=AW.isManagedCube;if(Ae&&AX!==1){AY.saveDDACube(Ab);}else{AW.cleanDuplicateRI(false);Ac=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=Ac;mstrApp.isDDA=Ae;mstrApp.saveCubeParams=Ab;mstrApp.isManagedCube=Ad;mstrApp.getRootController().afterQBProcess(true);}}});};if(AX===1){AZ.onOK();}else{if(!AW.isManagedCube&&!mstrApp.isSingleTier){AK.showSaveAsDialog(AZ,x(this.model));}else{AZ.onOK();}}},onBackButtonClick:function m(){var AX=this.model,AY=AX.tableID,AW=this,Aa;Aa={success:function AZ(){var Ab=mstrApp.msgid,Ac;mstrApp.container.unloadQB();mstrApp.messageID=Ab;Ac=mstrApp.getRootController();if(Ab){Ac.dataService.set("messageID",Ab);}Ac.backFromQB();}};if(AX.isNew&&AY){AW.getDataService().removeEmmaTable(Aa,{did:AY});}else{Aa.success();}},onFinishButtonClick:function AQ(){var AX=this,AW=this.model,AZ=AX.getDDAController(),Ac,AY,Ab=mstrApp.diCurrentZIndex,Aa=Ab?Ab+1:10;if(!AW.origIsDDA&&AZ.allowDDA()){Ac={onOK:function(){AX.handleFinish();}};AY={callback:Ac,selectedIndex:AW.isDDA?0:1,zIndex:Aa};AZ.showDDAConfirmDialog(AY);return ;}this.handleFinish();},exitApplication:function G(){mstrApp.container.unloadQB();mstrApp.getRootController().exitApplication();},addSQLCandidateTables:function u(AW){this.model.raiseEvent({name:"addCandidateTables",value:AW});},hasDBConnection:function z(){if(this.model.SelDBRoleID){return true;}mstrmojo.alert(mstrmojo.desc(9915,"Please select a database connection first."));return false;},publish:function f(){var AY=this.model,AW=AY.FFSQLMode?this.rootView.getSQLStatement():"",Aa=AY.isNew,Ab=mstrApp.folderID,AZ=this,AX={success:function(Ag){if(mstrApp.analysisID||mstrApp.msgID){var Ah=mstrApp.analysisID?[3169,mstrApp.name+".3169","messageID",mstrApp.analysisID]:[3104,mstrApp.name+".3104","messageID",mstrApp.msgID,"rwDesignMode",1,"executionMode",2],Af=[Ah,[2048007,mstrApp.name+".rwd.rwframe.rwb.2048007","dsObjectID",Ag.did,"dsType",3,"isDatasetAdded",false,"isDefault",false]];mstrApp.redirectToPage({evt:"1024001",events:mstrmojo.Serializer.serializeValueGroup(Af),src:mstrApp.name+"."+mstrApp.pageName+".1024001","1024001":"1",evtorder:"1024001"});}else{if(mstrApp.isCloudPro){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:Ag.did,rwCreateFlags:"16",rwViewMode:"2048"});}else{AZ.gotoRedirectionPage(Ag.did,Ag.path);}}}};if(!this.hasDBConnection()){return ;}AY.recoverMode=0;if(Ab||!Aa){var Ae=Aa&&mstrApp.isCloudPro;AY.save((Ae?AY.getAutoReportName():null),null,Ab,!Aa,Ae,AW,{success:function(Aj){var Ai=mstrApp.analysisID,Al=!AY.isCubeReport,Af=mstrApp.folderID,Ah=mstrApp.reportID,Ak=mstrApp.refreshInDoc;if(!Aa&&Ai){mstrApp.hideWait(true);if(Ak){if(rrLockAndRunDashboard){rrLockAndRunDashboard(Ai);}else{mstrApp.redirectToPage({evt:"3104",rwDesignMode:"0",rwViewMode:"2048",executionMode:"1",objectType:"55",objectID:Ai});}}else{var Ag=mstrmojo.insert({scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-qb-ObjectInfoEditor run-dashboard",showTitle:false,analysisID:Ai,cssText:"width: 260px",children:[{scriptClass:"mstrmojo.Label",text:Al?mstrmojo.desc(13137,"Edit data successfully!"):mstrmojo.desc(11299,"Data refresh successful!"),cssClass:"mstrmojo-AttCreator-Text"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-RunDashboard",onclick:function(An){var Am=this.parent.parent;Am.close();if(rrLockAndRunDashboard){rrLockAndRunDashboard(Ai);}else{mstrApp.redirectToPage({evt:"3104",rwDesignMode:"0",rwViewMode:"2048",executionMode:"1",objectType:"55",objectID:Ai});}}},{scriptClass:"mstrmojo.Button",id:"RefreshData",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-"+(Al?"EditData":"RefreshData"),cssDisplay:"none",onclick:function(){if(Al){refreshCube(Ai,Af,"0",Ah,RRDIExtentedType.DATAIMPORT_DATABASE,false,true);}else{openCubeRefreshStatus(Ai,Af);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-Exit",onclick:function(){var Am=this.parent.parent;Am.close();mstrApp.showWait();if(mstrApp.isCloud){rrOpenHomePage&&rrOpenHomePage();}else{mstrApp.redirectToPage({evt:3010});}}}]}]});Ag.open();}}else{AX.success(Aj);}}});}else{var Ac=this.rootView,Ad=function Ad(){Ac.openPopup("saveasRef",{folderLinksContextId:mstrConfig.hasProfileReports?28:1,name:mstrmojo.desc(8041,"New Cube"),saveAs:function(){var Am=this,Af=Am.contPanel,Ag=Af.name.value,Al=Am.ob.currentFolder,Ai=Al.did,Ah={success:function Ak(Ao){AX.success(Ao);},failure:function Aj(Ap){var Ao=parseInt(Ap.getResponseHeader("X-MSTR-TaskErrorCode"),10)+4294967296;if(Ao===2147749923){mstrmojo.confirm(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",mstrmojo.desc(3377)).replace("###",Ag),{confirmBtn:{fn:function(){An(true);}}},{title:mstrmojo.desc(3179,"Confirm Overwrite")});}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+Ap.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(!Ag){mstrmojo.alert(mstrmojo.desc(9523,"Enter a Name"));return ;}var An=function An(Ao){AY.save(Ag||"",Af.desc.value||"",Ai,Ao,mstrApp.isCloudPro,AW,Ah);Am.close();};An();}});};Ad();}},updateTableStructure:function I(){var AW=this.model;AW.compareDBTables({success:function(){if(AW.hasMissingUsedDBColumns()){mstrmojo.confirm(mstrmojo.desc(12922,"There are missing columns used in expressions. Do you want to update?"),null,{buttons:[mstrmojo.Button.newInteractiveButton(mstrmojo.desc(219),function(){AW.updateDBTables(true);},null,{iconClass:"mstrmojo-Editor-button-Yes"}),mstrmojo.Button.newInteractiveButton(mstrmojo.desc(218),null,null,{iconClass:"mstrmojo-Editor-button-No"})],title:mstrmojo.desc(3179)});}else{AW.updateDBTables();}}});},gotoRedirectionPage:function C(AW,AX){if(mstrApp.isNewAnalysis){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:AW,rwCreateFlags:"16",rwViewMode:"2048"});return ;}if(mstrApp.msgID){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"2",rwDesignMode:"1",objectType:"3",objectID:AW});return ;}this.rootView.showRedirectionPage(AW,AX);},save:function j(){this.model.save();},enableButton:function(AX){var AW=this.model.getAllowSave(AX);this.raiseEvent({name:"allowSave",value:AW});},addWHTable:function J(AZ){var AY=this.model,AX=0,AW=AZ.x,Aa=AZ.y;w.forEach(AZ,function(Ac){AY.getColumnsForDBTable({data:Ac},{success:function Ab(Ad){Ac.x=AW+AX*15;Ac.y=Aa+AX*15;AX++;AY.addTable(Ac,Ad.items);}},this);});},canAddTableSQL:function AD(AX,AW){return this.model.canAddTableSQL(AX,AW);},addTableSQL:function O(AX,AW){this.model.addTableSQL(AX,AW);},getFFsqlComp:function AU(){return this.model.FFsqlComp;},getOperationMode:function AI(){return(this.model.isNew)?0:1;},checkDBTables:function p(){this.model.checkDBTables();},markFailureLabel:function T(AW){this.raiseEvent({name:"failureLabel",value:AW});},attachDataChangeListeners:function AG(AX){var AW=this.model;n.forEach(AX,function(AY,AZ){n.forEach(AY,function(Ab,Aa){AW.attachEventListener(Aa,AZ,Ab);});});},editColumn:function c(AZ){var Aa=3,AY=AZ.columnIndex,AW=this.model,AX=AW.selectedClns[AY];this.openExpressionEditor({type:Aa,w:AX,tkn:AX.expr,cIndex:AY});},deleteColumn:function B(AY){var AX=AY.columnIndex,AW=this.model;if(AW.removeSelectedColumn){AW.removeSelectedColumn(AX);}},deleteAllColumns:function P(){this.model.removeAllColumns();},enableAvailableTables:function AV(){this.model.raiseEvent({name:h.DBTABLES_ENABLED,value:true});mstrApp.getRootController().enableButton();},getDDAController:function V(){if(this.ddaController===null){this.ddaController={shouldAskUser:true,allowDDA:function Aa(){var Ah=mstrApp.getRootController(),Ai=Ah.model,Aj=Ah.rootView,Af=!!Ai.canSupportDDA,Ad,Ak,Ag=Ai.connectLiveSupport,Al,Ae;if(!Af||(Ag===g.connectLiveSupport.connectLiveSupportInMemoryOnly)){return false;}else{if(Ag===undefined||!mstrApp.isFFSQLMode){Al=Ai.getDBRole(Ai.SelDBRoleID);Ae=Al&&Al.mdDBRole&&Al.mdDBRole.db_type===3000;if(Ae){return false;}}}Ad=Ai.dbridForDDA;if(Ad){if(!mstrApp.isFFSQLMode&&Ai.dbtables.length>0&&Ad!==Ai.prevDBRoleID){Af=false;}else{if(mstrApp.isFFSQLMode){Ak=Aj.getSQLStatement();if(Ai.prevDBRoleID&&AR.trim(Ak)&&Ad!==Ai.prevDBRoleID){Af=false;}}}}return Af&&!(mstrApp.isFFSQLMode&&Ai.isMultiPassSQL(Aj.getSQLStatement()));},onlyAllowDDA:function Ac(){return !!mstrApp.getRootController().model.shouldSupportDDA;},onToggleDDA:function AW(Ag){var Ae=mstrApp.getRootController().model,Ad=0,Af;if(Ae.isDDA===Ag){return ;}if(Ag){Ae.set("isDDA",true);if(!this.allowDDA()){Ad=1;Af=false;}}else{Ae.set("isDDA",false);if(this.onlyAllowDDA()){Ad=2;Af=true;}}if(Ad){mstrmojo.qb.alert(N[Ad]);Ae.set("isDDA",Af);}},checkDDACheckbox:function AY(Af){var Ad=mstrApp.getRootController().model.ddaCheckboxID,Ae;if(Ad){Ae=mstrmojo.all[Ad];if(Ae){Ae.set("checked",Af);}}},tryEnableDDACheckbox:function AZ(Af){var Ad=mstrApp.getRootController().model.ddaCheckboxID,Ae;if(Ad){Ae=mstrmojo.all[Ad];}if(!Ae||!Ae.visible){return ;}if(!Af){if(Ae.enabled&&!Ae.checked&&!this.allowDDA()){Ae.set("enabled",false);}}else{if(!Ae.enabled&&!Ae.checked&&this.allowDDA()){Ae.set("enabled",true);}}},askUserAboutDDA:function Ab(Ad){if(Ad){this.shouldAskUser=false;}return this.shouldAskUser;},showDDAConfirmDialog:function AX(Ad){var Ae=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog(Ad||{});Ae.open();}};}return this.ddaController;},onHelpButtonClick:function A(){mstrApp.showHelpTopic(this.model.getHelpTopic());},selectDBRole:function E(AY){var AX,AW;if(!AY){return ;}AX=this.rootView.getDBConnectionList&&this.rootView.getDBConnectionList();if(!AX){return ;}AW=w.find(AX.items,"did",AY);if(AW>=0){AX.set("selectedIndex",AW);AX.adjustScrollPosition(AW);}},hasTableJoin:function F(AW){var AX=this.model.tables[AW];return(AX&&AX.njoins>0)?true:false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController","mstrmojo.warehouse.WHController");mstrmojo.qb.EmmaController=mstrmojo.declare(mstrmojo.qb.RootController,null,{commit:function A(F){var C=this.model,D,B={success:function E(){C.buildRelations(F);}};if(C.FFSQLMode){C.autoMapFFSQL(mstrApp.getRootController().rootView.getSQLStatement(),B);}else{C.autoMap(B);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController","mstrmojo.warehouse.WHController");mstrmojo.requiresDescs(12752,12898,13324);var K=mstrmojo.array;function G(){return mstrApp.container.launchingApp.getRootController();}function E(R){var Q=[];var S=[];var T=R.urlSrc;var U="<ul>";mstrmojo.hash.forEach(T,function(V){if(V.fail===true){Q.push(V.tableID);U+="<li>"+V.url+"<br>"+V.errorMsg||" </li>";}else{S.push(V.tableID);}});U+="</ul>";return U;}function H(R,V,U){var X=E(R);var Q={detailErrorMessage:X,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:U};var W=mstrmojo.desc(12752,"BI Sources"),T=mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),S=G();S.displayWarning(T,W,V,Q);}function O(Q){var R=G();var S=E(Q);R.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,S);}function L(U,V,T,R,X){var Q={success:function W(){U.buildRelations(X);},failure:function S(){U.urlSrc[R].fail=true;X.success();}};U.setDBRole(V);U.autoMapFFSQL(T,Q);}function C(S,V,W,Q){var U=mstrApp.getRootController().getDataService();U.createEmmaTable({success:function T(X){S.tableID=X.tbid;mstrApp.msgid=X.msgid;V.tableID=X.tbid;L(S,V.dbRoleID,V.url,Q,W);},failure:function R(){S.urlSrc[Q].fail=true;O(S);}},{xt:S.xdaType,dict:S.connectorType});}function B(T){var Q=T.getDBRole(T.SelDBRoleID);var R=Q?Q.n:"";var S="BI Source from "+R;return{name:S};}function N(Y,c){var a=mstrApp.getRootController().getDataService();var U=Y.urlSrc,W=[],R=[];K.forEach(U,function(d){if(d.fail){R.push(d.tableID);}else{W.push(d);}});var V=function(){c.success();},T=function(){var d=mstrApp.getRootController();d.removeImportedSrc(W);};var Z=(R.length===U.length);var X={success:function b(){if(Z){O(Y);}else{H(Y,V,T);}},failure:function Q(){var d=G();d.displayError(mstrmojo.desc(12898,"Delete failed table failure!"),true);}};var S=R.length;if(S===0){c.success();}else{if(Y.isNew){a.removeEmmaTable(X,{did:R.join()});}else{O(Y);}}}mstrmojo.qb.thirdParty.Controller=mstrmojo.declare(mstrmojo.qb.RootController,null,{scriptClass:"mstrmojo.qb.thirdParty.Controller",proIdx:-1,commit:function I(X){var R=this.model,U=mstrApp.getRootController().rootView,S=U.getSrcUrls(),W=S.length,T=this,V;R.urlSrc=S;T.proIdx=0;if(W>0){V=S[0];var Q={success:function(){T.proIdx++;V=S[T.proIdx];if(V){C(R,V,Q,T.proIdx);}else{N(R,X);}}};if(R.isNew){C(R,V,Q,T.proIdx);}else{L(R,V.dbRoleID,V.url,0,X);}}},onBackButtonClick:function P(){mstrApp.container.unloadQB();var Q=mstrApp.getRootController();var R=Q.rootView.header;if(R){R.subtitle.set("text","");}Q.backFromQB();},handleFinish:function J(){var Q=this.model,S=this,R=Q.operationMode,T={};T.onOK=function(V){S.commit({success:function U(){var W=mstrApp.msgid,X=Q.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=W;mstrApp.saveCubeParams=V;mstrApp.isManagedCube=X;mstrApp.getRootController().afterQBProcess(true);}});};if(R===1){T.onOK();}else{if(!Q.isManagedCube&&!mstrApp.isSingleTier){mstrmojo.qb.QBHelpers.showSaveAsDialog(T,B(this.model));}else{T.onOK();}}},onFinishButtonClick:function F(){this.handleFinish();},removeImportedSrc:function D(Q){this.rootView.removeSrcs(Q);},canDisplayCatalogSQL:function M(){return false;},handleServerRequestError:function A(R,W,V,U,S){var Q=this.proIdx;if(Q<0){mstrmojo.DI.controller.DIDialogController.showErrorDialog(R,W,V,U,S);}else{var T=this.model.urlSrc[Q];if(T){T.errorMsg=W;}if(V){V();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController");var B=mstrmojo.func.wrapMethods;mstrmojo.DI.controller.DIHadoopWHController=mstrmojo.declare(mstrmojo.qb.RootController,null,{scriptClass:"mstrmojo.DI.controller.DIHadoopWHController",saveDBRole:function A(D,C,G){var E=this;E.model.saveDBRole(D.mdDBRole,C,B(G,{success:function F(){}}));}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.qb.bigquery._BigQueryController");mstrmojo.requiresDescs(12385);var F=mstrmojo.hash,E=mstrmojo.desc;mstrmojo.qb.bigquery.RootController=mstrmojo.declare(mstrmojo.qb.EmmaController,[mstrmojo.qb.bigquery._BigQueryController],{scriptClass:"mstrmojo.qb.bigquery.RootController",isCloud:function C(){return mstrApp.isCloudPro;},getColumnsForDBTable:function A(G,H){this.model.getColumnsForDBTable(G,H);},attachDataChangeListeners:function D(H){var G=this.model;F.forEach(H,function(I,J){F.forEach(I,function(L,K){G.attachEventListener(K,J,L);});});},hasDBConnection:function B(){if(this.model.selectedProject){return true;}mstrmojo.alert(E(12385,"Please select a project first."));return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._IsWebApp","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.warehouse.WHModel","mstrmojo.warehouse.WHController","mstrmojo.qb.QBuilderPage","mstrmojo.qb.QBuilderModel","mstrmojo.qb.EmmaModel","mstrmojo.qb.RootController","mstrmojo.qb.EmmaController","mstrmojo.qb.bigquery.RootController","mstrmojo.qb.bigquery.ESRootView","mstrmojo.qb.bigquery.BigQueryBuilderPage","mstrmojo.qb.es.Model","mstrmojo.qb.es.Controller","mstrmojo.qb.EnumQBAppType","mstrmojo.qb.QBAlertDialog","mstrmojo.qb.thirdParty.Controller","mstrmojo.qb.thirdParty.Model","mstrmojo.qb.thirdParty.RootView","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(37,889,1442,9944,11583,11584,11585,11622,11623,11624,11625,12569,12920,12921,12923,12941,5781,14297);var N="QBwaitBox",S={scriptClass:"mstrmojo.Editor",id:N,draggable:false,showTitle:false,zIndex:9999,cssClass:"mstrmojo-di-progressBar",children:[{scriptClass:"mstrmojo.ProgressBar",alias:"progress",cssClass:"mstrmojo-di-progress stripes"}],counter:0,displayMsg:null,ondisplayMsgChange:function I(){if(this.progress){this.progress.set("progressText",this.displayMsg);}},oncounterChange:function Y(){var b=this.counter,d=this.visible;if(b===0&&d){this.close();}else{if(b>0&&!d){var a=mstrApp.container;var c={};if(a&&a.domNode){var Z=mstrmojo.dom.position(a.domNode);if(Z){c={top:Z.y+"px"};}}this.open(null,c);}}}};var L=-2147215346,J=-2147071825,X=-2147212035,G=-2147206925,A=-2147206924,F=-2147209051,D=-2147207419,V=-2147071870,B=-2147216373;var W={};W[L]=mstrmojo.desc(11583,"Failed to execute query.");W[J]=mstrmojo.desc(11584,"Insufficient storage space to upload your data.");W[X]=mstrmojo.desc(11622,"Please unmap the attribute's non-key form first.");W[G]=mstrmojo.desc(11623,"Your session has expired.");W[A]=mstrmojo.desc(11623,"Your session has expired.");W[F]=mstrmojo.desc(11623,"Your session has expired.");W[D]=mstrmojo.desc(11623,"Your session has expired.");W[V]=mstrmojo.desc(11624,"No quota left to create cube.");W[B]=mstrmojo.desc(11625,"Failed to create report instance.");var O="A61B85F4485D3B953003B195E58B5138";var C=mstrmojo.DI.DIConstants;function T(h,Z,g){var d=mstrApp.isSingleTier?mstrmojo.desc(14297,"There is an error."):mstrmojo.desc(11585,"There is an error on the server."),f=mstrApp.getRootController(),k=h.code||(h.getResponseHeader&&h.getResponseHeader("X-MSTR-TaskErrorCode"))||"",b=h.message||(h.getResponseHeader&&h.getResponseHeader("X-MSTR-TaskFailureMsg"))||"",a="",e="",j;b=(b.length>2000)?b.substring(0,2000)+"...":b;j=b.replace(/com\.microstrategy(\.\w+)*: \(?/,"").replace(/\)$/,"");k=parseInt(k,10);switch(k){case L:if(f.model.FFSQLMode){a=b.replace(/com\.microstrategy(\.\w+)*: \(/,"").replace(/\)$/,"");if(a.match(/(.\s)*DataImport\)?\[(\d+)\](.\s)*/)){var c=parseInt(RegExp.$2,10);f.markFailureLabel(c);e=mstrmojo.desc(9944,"SQL Pass ## failed to execute.").replace("##",c);j=a;}}mstrmojo.qb.alert(e||W[k],j,Z,null,g);break;case J:b=b.match(/currently using(.*)space/g)[0];b=b.match(/\d+../g);a=mstrmojo.desc(12920,"You are currently using ## of the allocated ### space.");mstrmojo.qb.alert(W[k],a.replace("##",b[0]).replace("###",b[1]),Z,null,g);break;case X:mstrmojo.qb.alert(W[k],j,Z,null,g);break;case V:mstrmojo.qb.alert(W[k],j,function(){mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:"-1"},mstrApp.name,"POST",null,null,false);},null,g);break;case B:if(f.model.riid===O){mstrmojo.alert(mstrmojo.desc(12921,"Please contact your Administrator to update the Project Metadata."),function(){mstrApp.redirectToPage({evt:3010});});}else{mstrmojo.qb.alert(W[k],j,Z,null,g);}break;case G:case A:case F:case D:if(mstrApp.isCloudPro){rrOpenHomePage&&rrOpenHomePage();}else{mstrmojo.form.send({evt:"3010"},mstrApp.name,"POST",null,null,false);}break;default:if(j){mstrmojo.qb.alert(d,j,Z,null,g);}else{b=h.responseText;b=b&&b.match(/\[HttpException \(0x80004005\): (.)+\]/);mstrmojo.qb.alert(d,(b&&b[0]&&b[0].replace(/\[HttpException \(0x80004005\): |\]/gi,""))||mstrmojo.desc(5781,"Request timed out."),Z,null,g);}break;}}mstrmojo.qb.QBApp=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsWebApp],{scriptClass:"mstrmojo.qb.QBApp",enableWaitBox:true,getWaitBoxPosition:function(){var a=mstrApp.container;var b={};if(a&&a.domNode){var Z=mstrmojo.dom.position(a.domNode);if(Z){b={top:Z.y};}}return b;},init:function R(Z){this._super(Z);if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}},start:function E(h,b){var f,a=mstrmojo.qb.EnumQBAppType,j,g,e=mstrmojo.hash.clone(b),d,Z=C.backendSourceSubtype,c=false;switch(parseInt(h,10)){case a.BigQuery:case a.BigQueryFFSQL:mstrApp.isBigQuery=true;j=mstrApp.isFFSQL?342:341;this.dbroleID=mstrApp.dbrid;f=this.rootController=new mstrmojo.qb.bigquery.RootController();f.dataService=mstrmojo.qb.DataService;e.id="QBuilderModel";f.model=new mstrmojo.qb.bigquery.Model(e);f.rootView=new mstrmojo.qb.bigquery.BigQueryBuilderPage({placeholder:this.placeholder});break;case a.BigQuerySingleTable:mstrApp.isBigQuery=true;j=345;this.dbroleID=mstrApp.dbrid;f=this.rootController=new mstrmojo.qb.bigquery.ESController();f.dataService=mstrmojo.qb.es.DataService;f.model=new mstrmojo.qb.bigquery.ESModel(e);f.rootView=new mstrmojo.qb.bigquery.ESRootView({placeholder:this.placeholder});this.msgid=this.msgID;break;case a.EmmaSingleTable:f=this.rootController=new mstrmojo.qb.es.Controller();f.dataService=mstrmojo.qb.es.DataService;if(e.hasOwnProperty("emmaSingleIsForAlternateSource")){e.isForAlternateSource=e.emmaSingleIsForAlternateSource;delete e.emmaSingleIsForAlternateSource;}f.model=new mstrmojo.qb.es.Model(e);g={placeholder:this.placeholder};if(e.hasOwnProperty("emmaSingleAlertCfg")){g.alertCfg=e.emmaSingleAlertCfg;}f.rootView=new mstrmojo.qb.es.RootView(g);this.msgid=this.msgID;c=true;break;case a.MDX:f=this.rootController=new mstrmojo.qb.mdx.Controller();f.dataService=mstrmojo.qb.mdx.DataService;delete e.dbObjectsDisplayOptions;f.model=new mstrmojo.qb.mdx.Model(e);f.rootView=new mstrmojo.qb.mdx.RootView({placeholder:this.placeholder});this.msgid=this.msgID;break;case a.BISource:mstrApp.isBISource=true;j=mstrApp.isFFSQL?304:352;f=this.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.thirdParty.Controller"});f.dataService=mstrmojo.qb.DataService;f.model=new mstrmojo.qb.thirdParty.Model(e);f.rootView=new mstrmojo.qb.thirdParty.RootView({placeholder:this.placeholder});break;default:j=mstrApp.isFFSQL?304:352;d=mstrApp.isFFSQL?Z.customSQL:Z.customSQLWizard;if(mstrApp.isEMMACube){f=this.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.EmmaController"});f.dataService=mstrmojo.qb.DataService;e.canSupportDDA=mstrApp.canSupportDDA;e.shouldSupportDDA=mstrApp.shouldSupportDDA;e.dbridForDDA=mstrApp.dbridForDDA;e.isDDA=mstrApp.isDDA;e.ddaCheckboxID=mstrApp.ddaCheckboxID;f.model=new mstrmojo.qb.EmmaModel(e);f.model.set("id","QBuilderModel");c=true;}else{f=this.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.RootController"});f.dataService=mstrmojo.qb.DataService;f.model=new mstrmojo.qb.QBuilderModel({id:"QBuilderModel"});}f.rootView=new mstrmojo.qb.QBuilderPage({placeholder:this.placeholder});break;}if(!c){f.model.dbObjects.populateDBProperties({});}f.start(j,d);},getRootController:function Q(){return this.rootController;},hideProgress:function M(a){var b=mstrmojo.all.progressBar,Z={manually:!!a};if(b){b.close(Z);}},redirectToPage:function U(Z){this.showWait();mstrmojo.form.send(Z,mstrApp.name,"POST",null,null,false);},serverResponse:function K(d,a,b,Z,c){mstrmojo.all[d][a](b,!!Z,c);},serverRequest:function P(e,j,d,f,k,Z,g,h){var c={},a;if(!e.sessionState&&this.sessionState){e.sessionState=this.sessionState;}e.msgid=Z||mstrApp.msgid;c.hideFailureErr=true;if(!f){a=j.failure;j.failure=function b(l){T(l,a,g);};}c.waitBoxCfg=h||{showCancel:false};c.waitBoxCfg.position=this.getWaitBoxPosition();c.waitBoxCfg.message=k;c.silent=!d;this._super(e,j,c);},serverRequestParallel:function H(b,g,a,c,h,Z,d){if(a===true){this.showWait(h);}if(!b.sessionState&&this.sessionState){b.sessionState=this.sessionState;}b.msgid=Z||mstrApp.msgid;try{var f=this;window.setTimeout(function(){var l=g.failure;g.failure=function k(o){T(o,l,d);};var m=mstrmojo.func.wrapMethods(g,{complete:function j(){if(a){f.hideWait();}}});var n=new mstrmojo.SimpleXHR();n.request("POST",mstrConfig.taskURL,{success:function(o){if(m.success){m.success(o);}},failure:function(o){if(m.failure){m.failure({code:o.getResponseHeader("X-MSTR-TaskErrorCode"),message:o.getResponseHeader("X-MSTR-TaskFailureMsg")});}},complete:function(){if(m.complete){m.complete();}}},b);},0);}catch(e){mstrmojo.err(e);}},serverRequestParallel:function H(b,g,a,c,h,Z,d){if(a===true){this.showWait(h);}if(!b.sessionState&&this.sessionState){b.sessionState=this.sessionState;}b.msgid=Z||mstrApp.msgid;try{var f=this;window.setTimeout(function(){var l=g.failure;g.failure=function k(o){T(o,l,d);};var m=mstrmojo.func.wrapMethods(g,{complete:function j(){if(a){f.hideWait();}}});var n=new mstrmojo.SimpleXHR();n.request("POST",mstrConfig.taskURL,{success:function(o){if(m.success){m.success(o);}},failure:function(o){if(m.failure){m.failure({code:o.getResponseHeader("X-MSTR-TaskErrorCode"),message:o.getResponseHeader("X-MSTR-TaskFailureMsg")});}},complete:function(){if(m.complete){m.complete();}}},b);},0);}catch(e){mstrmojo.err(e);}},getSearchAutoCompleteDelay:mstrmojo.emptyFn});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.DI.DIHadoopModel","mstrmojo.DI.controller.DIHadoopWHController","mstrmojo.warehouse.obj.DBRole","mstrmojo.qb.DataService");mstrmojo.requiresDescs(12773,12774,12815,12816,12817);var E=mstrmojo.array;var K=mstrmojo.warehouse.EnumDatabaseType;function I(L){if(!L){return"";}return"hdfs://"+L.hadoopName+":"+L.webHDFSPort+"/webhdfs/v1/?op=liststatus";}function J(O){var L=O.mi.ftree.fl;var N=0,P,M;if(L!==undefined){for(M=0;M<L.length;M++){P=L[M];N+=P.sz;}}return N;}mstrmojo.DI.controller.DIHadoopController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIHadoopController",dbRoleID:"",hadoopConnURL:"",dbRole:"",saveDBRole:function H(O,N){var M=mstrApp.getRootController(),P=this;N.set("visible",false);N.close();M.getDataService().saveDBRole({success:function Q(R){P.dbRoleID=R.dbr.did;P.hadoopConnURL=I(O);M.model.raiseEvent({name:"HadoopDBRoleSaved"});},fail:function L(R){mstrmojo.alert(R.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{dbroleinfo:JSON.stringify(O)});},loadBDETypeDBRole:function A(N){var L=mstrApp.getRootController(),M=this;if(N){M.loadDBRoleByID(N);return ;}var O={success:function(P){var R=P.dbRoles,Q=false;if(R){R=[].concat(R);E.forEach(R,function(S){if(K.BDE===S.db_type){M.loadDBRoleByID(S.did);Q=true;}});}if(!Q){mstrApp.hideProgress();L.model.raiseEvent({name:"BDEDBRoleLoaded"});}},failure:function(){L.displayError(mstrmojo.desc(12815,"Error when loading DB Roles."));}};L.getDataService().archSearch(O,{typeFilter:K.BDE,domain:3});},loadDBRoleByID:function G(O){var N=this,M=new mstrmojo.DI.DIHadoopDBRole(),L=mstrApp.getRootController();M.mdDBRole.did=O;M.populate(function(Q){var P=Q.mdDBRole.connstr;E.forEach(P.split(";"),function(S){var R=S.split("=");Q[R[0].trim()]=R[1];});N.hadoopConnURL=I(Q);N.dbRoleID=O;N.dbRole=M;L.model.raiseEvent({name:"BDEDBRoleLoaded"});});},populateDBRole:function D(M,N){var L=mstrApp.getRootController();L.model.populateDBRole(M,N);},renderDBRoleEditor:function F(M){var O=this;this.launchingApp=mstrApp;window.mstrApp=new mstrmojo.qb.QBApp();mstrApp.sessionState=this.launchingApp.sessionState;mstrApp.msgID=mstrApp.messageID;mstrApp.docID=mstrApp.messageID;mstrApp.isSingleTier=this.launchingApp.isSingleTier;mstrApp.serverProxy=this.launchingApp.serverProxy;delete mstrApp.messageID;delete this.launchingApp.dbType;delete this.launchingApp.supportDBObjects;mstrApp.sessionManager=this.launchingApp.sessionManager;mstrApp.enableAutomaticSessionRecovery=this.launchingApp.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=this.launchingApp.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=this.launchingApp.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=this.launchingApp.enableWarningSessionTimeout;mstrApp.projectName=this.launchingApp.projectName;mstrApp.serverName=this.launchingApp.serverName;mstrApp.serverPort=this.launchingApp.serverPort;mstrApp.authMode=this.launchingApp.authMode;mstrApp.name=this.launchingApp.name;mstrApp.persistTaskParams=this.launchingApp.persistTaskParams;mstrApp.hideProgress=this.launchingApp.hideProgress;var L=mstrApp.rootController=new mstrmojo.DI.controller.DIHadoopWHController();L.dataService=mstrmojo.qb.DataService;var N=L.model=new mstrmojo.DI.DIHadoopModel();N.dbRoleEditorCfg={hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[42]};N.loadDBObjects({success:function P(){var Q=new mstrmojo.warehouse.dbroles.DBRoleEditor();Q.config=N.dbRoleEditorCfg;Q.callback={close:function(){if(mstrmojo.all.QBuilderModel){mstrmojo.all.QBuilderModel.destroy();}if(mstrmojo.all.QBuilderPage){mstrmojo.all.QBuilderPage.destroy();}mstrApp.getRootController().destroy();var R=window.mstrApp;window.mstrApp=O.launchingApp;mstrApp.sessionState=R.sessionState;mstrApp.msgID=R.messageID;mstrApp.docID=R.messageID;if(R.dbRoleID){mstrApp.getRootController().hadoopController.dbRoleID=R.dbRoleID;mstrApp.getRootController().hadoopController.hadoopConnURL=R.hadoopConnURL;mstrApp.getRootController().model.raiseEvent({name:"HadoopDBRoleSaved"});}R.destroy();}};if(!M){M=new mstrmojo.warehouse.obj.DBRole({mdl:N});}Q.dbrole=M;Q.open();}});},hadoopBrowserFunction:function(L){this.browseHadoop(L.data.address,L.data.browser,L);},browseHadoop:function B(O,P,Q){var M=mstrApp.getRootController(),R={},L=P,N=Q;if(O===""){M.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(O.substring(0,1)==="\\"){O=O.replace(/\\\\/g,"file://");O=O.replace(/\\/g,"/");}R.urlPath=O;var S={success:function(T){if(T.mi.ftree===""){M.displayError(mstrmojo.desc(12774,"We could not find anything. Please verify that you have entered a valid network path."),false);}L.set("fileList",M.parseURLFolders(T));if(N){N.data.isMouseOver=true;if(T.mi.ftree===""){N.totalSize=0;}else{var U=T.mi.ftree.fl;if(U){N.totalSize=mstrmojo.DI.DIHelpers.getRoundSize(J(T));}else{N.totalSize="---";}}}},failure:function(T){L.set("fileList",[]);M.displayError(mstrmojo.desc(12816,"Uh-Oh, Error fetching the list of files for the given network path: ####").replace("####",T.message),false);}};M.dataService.getOAuthSourceReports(S,R);},browseHadoopForFolderSize:function C(N,R){var M=mstrApp.getRootController(),P={},O=R,L=R.tree.parent;if(N===""){M.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(N.substring(0,1)==="\\"){N=N.replace(/\\\\/g,"file://");N=N.replace(/\\/g,"/");}P.urlPath=N;var Q={success:function(S){if(S.mi.ftree===""){O.totalSize=0;}else{var T=S.mi.ftree.fl;if(T){O.totalSize=mstrmojo.DI.DIHelpers.getRoundSize(J(S));}else{O.totalSize="---";}}L.setFileListForNode(M.parseURLFolders(S),R);O.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:O.textNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:-5,content:mstrmojo.desc(12817,"Name: #### Size: @@@@").replace("####",O.text).replace("@@@@",O.totalSize)});},failure:function(){}};M.dataService.getHadoopFolderSize(Q,P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBApp","mstrmojo.Container","mstrmojo.hash");mstrmojo.qb.QBContainer=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.QBContainer",markupString:'<div id="QBContainer"><div id="QBApp"></div></div>',launchingApp:null,init:function B(D){if(this._super){this._super(D);}this.QBParams={placeholder:"QBApp",Privs:'<uaps><pris pgd="67070C7C481676FC38A28595E71ED85D"><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-2130706433</pri></pris></uaps>',msgID:"",type:"368",reportID:"",folderID:"",docID:"",isFFSQL:"",isCloud:false,saveAsCube:"",analysisID:"",isNewAnalysis:"",isEMMACube:true,FlashResBundleURL:"../resBundles/DashboardViewerBundle_1033.xml",name:"mstrWeb",pageName:"qbuilder",helpUrl:"",helpTopics:{mainDB:"database_import_page.htm",mainSQL:"freeform_import_page.htm",tableJoin:"join_options_dialog_box.htm",filterValue:"Enter_Value_dialog_box.htm",expression:"expression_dialog_box.htm",condition:"new_condition_dialog_box.htm"},localeId:mstrApp.localeId,displayLocaleId:"1033",jsRoot:"../javascript/",jsMojoRoot:"../javascript/mojo/js/source/",persistTaskParams:{},getPersistParams:function(){return this.persistTaskParams;},isOIVM:function(){return true;},isTouchApp:function(){return false;}};},loadQB:function A(){var D=this.QBParams;if(D.shouldSupportDDA&&!D.canSupportDDA){return ;}this.launchingApp=mstrApp;window.mstrApp=new mstrmojo.qb.QBApp();mstrmojo.hash.copy(D,mstrApp);mstrApp.sessionState=this.launchingApp.sessionState;mstrApp.msgID=mstrApp.messageID;mstrApp.docID=mstrApp.messageID;mstrApp.isSingleTier=this.launchingApp.isSingleTier;mstrApp.serverProxy=this.launchingApp.serverProxy;delete mstrApp.messageID;mstrApp.container=this;D.dbTypes=this.launchingApp.dbTypes;D.dbObjects=this.launchingApp.supportDBObjects;D.dbIds=this.launchingApp.dbIds;D.dbVersions=this.launchingApp.dbVersions;if(this.launchingApp.dbObjectsDisplayOptions){D.dbObjectsDisplayOptions=this.launchingApp.dbObjectsDisplayOptions;if(this.launchingApp.dbObjectsDisplayOptions===16){D.dbRolesVersionExcludeFilter=this.launchingApp.dbRolesVersionExcludeFilter;}}D.hasNonRADataset=this.launchingApp.diParams&&this.launchingApp.diParams.hasNonRADataset;delete this.launchingApp.dbTypes;delete this.launchingApp.supportDBObjects;delete this.launchingApp.dbIds;delete this.launchingApp.dbVersions;delete this.launchingApp.dbObjectsDisplayOptions;this.domNode.style.display="block";mstrApp.sessionManager=this.launchingApp.sessionManager;mstrApp.enableAutomaticSessionRecovery=this.launchingApp.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=this.launchingApp.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=this.launchingApp.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=this.launchingApp.enableWarningSessionTimeout;mstrApp.projectName=this.launchingApp.projectName;mstrApp.serverName=this.launchingApp.serverName;mstrApp.serverPort=this.launchingApp.serverPort;mstrApp.authMode=this.launchingApp.authMode;mstrApp.name=this.launchingApp.name;mstrApp.persistTaskParams=this.launchingApp.persistTaskParams;mstrApp.helpUrl=this.launchingApp.helpUrl;mstrApp.userHelpPage=this.launchingApp.userHelpPage;mstrApp.autocomplete=this.launchingApp.autocomplete;if(this.launchingApp.cubeSaveFolderId){mstrApp.cubeSaveFolderId=this.launchingApp.cubeSaveFolderId;}mstrApp.dbRoles=this.launchingApp.dbRoles;mstrApp.start(mstrApp.type,D);},unloadQB:function C(){var D=mstrApp.getRootController();var G=D.rootView;var E=D.model;if(E){E.destroy();}if(G){G.destroy();}D.destroy();var F=window.mstrApp;window.mstrApp=this.launchingApp;mstrApp.size=F.size;F.destroy();this.domNode.style.display="none";this.destroy();}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBPreview","mstrmojo.DI.DIMappingPreview","mstrmojo._HasLayout","mstrmojo.DI.DIConstants","mstrmojo.Container","mstrmojo.ui.Checkbox","mstrmojo.DI.ui.dialogs.DIAggregationDialog","mstrmojo.DI.ui.dialogs.DIParseDataDialog","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(221,1442,1995,2969,8972,9117,9118,9119,9120,9121,13899,14661);var F=mstrmojo.array,Q=mstrmojo.css,D=mstrmojo.dom,H=mstrmojo.hash;var P={raw:0,xtab:1},T=mstrmojo.DI.DIConstants;var K=mstrmojo.desc(8972,"Expand")+" "+mstrmojo.desc(3389,"Preview");var S=mstrmojo.desc(8973,"Collapse")+" "+mstrmojo.desc(3389,"Preview");function R(){var f="aggEditor",b=f&&window.mstrmojo&&mstrmojo.all[f],Y,d=mstrApp.getRootController().getDialogController().getNextZIndex(),a=mstrApp.getRootController().dataService.messageID,c,e,X,Z,W,V=function V(){var h=window.launchingApp=mstrApp;window.mstrApp=new mstrmojo.qb.QBApp();mstrApp.sessionState=h.sessionState;mstrApp.msgid=a;mstrApp.isSingleTier=h.isSingleTier;mstrApp.serverProxy=h.serverProxy;mstrApp.sessionManager=h.sessionManager;mstrApp.enableAutomaticSessionRecovery=h.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=h.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=h.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=h.enableWarningSessionTimeout;mstrApp.projectName=h.projectName;mstrApp.serverName=h.serverName;mstrApp.serverPort=h.serverPort;mstrApp.authMode=h.authMode;mstrApp.name=h.name;mstrApp.persistTaskParams=h.persistTaskParams;mstrApp.helpUrl=h.helpUrl;mstrApp.userHelpPage=h.userHelpPage;mstrApp.autocomplete=h.autocomplete;Y=mstrApp.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.EmmaController"});Y.dataService=mstrmojo.qb.DataService;Y.model=new mstrmojo.qb.EmmaModel({tableID:c});Y.model.set("id","QBuilderModel");Y.isBDE=true;if(!b){b=mstrmojo.insert({id:f,scriptClass:"mstrmojo.DI.ui.dialogs.DIAggregationDialog",onClose:function g(){var j=window.mstrApp;a=mstrApp.msgid;window.mstrApp=window.launchingApp;Y.model.destroy();Y.destroy();j.destroy();mstrApp.getRootController().dataService.messageID=a;mstrApp.getRootController().getImportedDataEMMA(T.actions.importSource,T.requestFlag.mapping|T.requestFlag.sourceInfo|T.requestFlag.relationship|T.requestFlag.preview,null,null,c);}});}b.hasAggFilter=Z;Y.rootView=b;Y.zIndex=d;b.model=Y.model;b.tableID=c;b.controller=Y;b.open(null,{zIndex:d});};e=mstrApp.getRootController().model.currentSource;c=e.tableID;W=e.sourceInfo;X=W.isRefined;Z=W.hasAggFilter;if(X){mstrmojo.confirm(mstrmojo.desc(12717,"Previous changes made in wrangle will be discarded. Would you like to continue?"),{confirmBtn:{fn:function(){mstrApp.getRootController().dataService.cancelRefineStage({success:function g(h){a=h.msgid;mstrApp.getRootController().dataService.set("messageID",a);var j=mstrApp.getRootController().model.currentSource;delete j.projectID;V();}},{did:c,automap:1,dbr:W.dbRoleId});}}});}else{V();}}function J(){var W=this;var V=true;if(!W.model.currentSource){V=false;}else{if(W.sourceTableKey&&W.sourceTableKey!==W.model.currentSource.key){V=false;}}return V;}mstrmojo.DI.DIPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIPreview",markupString:'<div id="{@id}" class="mstrmojo-di-datapreview {@cssClass}" style="overflow-y: hidden; {@cssText}"><div class="cf di-preview-options"></div><div class="di-preview-container"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},sheetsNode:function(){return this.domNode.children[0];},previewNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";}},widgetResized:function E(){if(this._super){this._super();}if(this.preGrid&&this.preGrid.hasRendered){this.preGrid.widgetResized();}},mode:P.raw,preBuildRendering:function C(){if(this.parent.scriptClass!=="mstrmojo.StackContainer"){this.setDimensions(parseInt(this.parent.layoutNode.offsetHeight,10),this.parent.layoutNode.offsetWidth);}if(this._super){this._super();}},setDimensions:function I(Y,W){var V=parseInt(Y,10);var X=parseInt(W,10);if(isNaN(V)||isNaN(X)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.previewNode=Math.max((V-68),0)+"px";this.layoutConfig.w.previewNode=Math.max((X-36),0)+"px";if(this._super){this._super(V+"px",X-36+"px");}},onBackButtonClick:function(){var V=false;if(this.mode===P.xtab){this.set("mode",P.raw);mstrApp.getRootController().setModalNodes([this.domNode]);V=true;}return V;},onNextButtonClick:function(){mstrApp.getRootController().saveAndPublish();},children:[{scriptClass:"mstrmojo.Box",slot:"sheetsNode",alias:"sheets",cssClass:"di-preview-options-left",children:[{scriptClass:"mstrmojo.ui.Checkbox",cssClass:"preview-toggle",alias:"previewToggler",markupString:'<div id="{@id}" class="mstrmojo-ui-Checkbox {@cssClass}" mstrAttach:click,mousedown,mouseup></div>',checked:true,useRichTooltip:true,isDynamicTooltip:true,postCreate:function A(){var V=mstrApp.getRootController().rootView.currentPage;this.checked=V.isPreviewMaximized;V.attachEventListener("isPreviewMaximizedChange",this.id,"onPreviewChange");},updateTooltipConfig:function(X){var V=D.getMousePosition(X);var W={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,top:Math.max(V.y-40,0),left:Math.max(V.x-16,0)};W.content=this.checked?S:K;this.set("richTooltip",W);},moveTooltip:function N(V,X){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;if(this.hideTooltip){this.hideTooltip();}else{mstrmojo.tooltip.close();}}var Z=this,W=V,Y=X;this._tooltipTimeOut=setTimeout(function(){Z.showTooltip(W,Y);},this.tooltipOpenDelay);},oncheckedChange:function O(W){var V=mstrApp.getRootController().rootView.currentPage;if(V){V.togglePreviewMaximized(W.value);}},onmousedown:function U(){Q.toggleClass(this.domNode,"hit",true);},onmouseup:function G(){Q.toggleClass(this.domNode,"hit",false);},onPreviewChange:function(V){this.set("checked",V.value);}},{scriptClass:"mstrmojo.Label",cssClass:"table-name",alias:"tableName",useRichTooltip:true,isDynamicTooltip:true,markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click,mouseenter,mouseleave></div>',updateTooltipConfig:function(Y){var X=this.parent.previewToggler.checked?S:K;var V=D.getMousePosition(Y);var W={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,content:X,top:Math.max(V.y-40,0),left:Math.max(V.x-16,0)};this.set("richTooltip",W);},moveTooltip:function N(V,X){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;if(this.hideTooltip){this.hideTooltip();}else{mstrmojo.tooltip.close();}}var Z=this,W=V,Y=X;this._tooltipTimeOut=setTimeout(function(){Z.showTooltip(W,Y);},this.tooltipOpenDelay);},postCreate:function C(){var V=mstrmojo.all.DIModel;V.attachEventListener("SourceInfoFetched",this.id,"update");V.attachEventListener("CurrentSourceChanged",this.id,"update");this.update();},update:function(){var W=this.parent.parent;var V=W.model;if(!J.call(W)){return ;}var X=V.currentSource.sourceInfo.name;this.set("text",X);},onclick:function(){var V=this.parent.previewToggler;V.set("checked",!V.checked);},onmouseenter:function(){var V=this.parent.previewToggler;Q.addClass(V.domNode,"highlight");},onmouseleave:function(){var V=this.parent.previewToggler;Q.removeClass(V.domNode,"highlight");}},{scriptClass:"mstrmojo.Label",cssClass:"preview-label",alias:"tableName",text:mstrmojo.desc(3389,"Preview")},{scriptClass:"mstrmojo.Label",cssClass:"subTitle",alias:"subTitle",bindings:{visible:function(){return mstrApp.getRootController().rootView.currentPage.isPreviewOn;}},postBuildRendering:function C(){var W=mstrmojo.all.DIModel;this.update();W.attachEventListener("CurrentSourceChanged",this.id,"update");W.attachEventListener("MappingsFetched",this.id,"update");var V=mstrApp.getRootController().rootView.currentPage;V.attachEventListener("isPreviewOnChange",this.id,"onPreviewChange");},update:function(){var X=this.parent.parent;var W=mstrmojo.all.DIModel;var Y;if(!J.call(X)){return ;}if(W.currentSource.currentPreview){var V=W.currentSource.currentPreview.numOfRows;if(V<50){Y=mstrmojo.desc(13025,"(shows ## rows of data)").replace("##",V);}else{Y=mstrmojo.desc(12418," (shows first 50 rows of data)");}this.set("text",Y);}},onPreviewChange:function M(V){this.set("visible",V.value);}},{scriptClass:"mstrmojo.Label",cssClass:"refresh-time",alias:"timeStamp",postBuildRendering:function(){var W=mstrmojo.all.DIModel;W.attachEventListener("PreviewFetched",this.id,"update");W.attachEventListener("TransformedPreviewFetched",this.id,"update");W.attachEventListener("CurrentSourceChanged",this.id,"update");var V=mstrApp.getRootController().rootView.currentPage;V.attachEventListener("isPreviewOnChange",this.id,"onPreviewChange");this.update();},update:function(){var X=mstrmojo.desc(12718,"Data Refreshed at");var W=this.parent.parent;var V=W.model;if(!J.call(W)){return ;}if(V.currentSource&&V.currentSource.lastRefreshedTime){X+=" ";X+=V.currentSource.lastRefreshedTime.toLocaleString();this.set("text",X);}},bindings:{visible:function(){var W=(this.parent.parent.model.operationMode===T.operationMode.edit);var V=mstrApp.getRootController().rootView.currentPage.isPreviewOn;return W&V;}},onPreviewChange:function M(V){this.set("visible",V.value);}},{scriptClass:"mstrmojo.HBox",visible:false,cssClass:"di-preview-options-title",alias:"rightOptions",postCreate:function(){this.model=mstrmojo.all.DIModel;this.model.attachEventListener("PreviewFetched",this.id,"makeVisible");this.model.attachEventListener("CurrentSourceChanged",this.id,"makeVisible");this.parent.parent.attachEventListener("modeChange",this.id,"makeVisible");var V=mstrApp.getRootController().rootView.currentPage;V.attachEventListener("isPreviewOnChange",this.id,"makeVisible");this.makeVisible();},makeVisible:function(){var V=this.parent.parent;if(!J.call(V)){return ;}if(V.mode===P.raw){this.set("visible",true);return ;}this.set("visible",false);},children:[{scriptClass:"mstrmojo.Button",text:"Aggregation",cssClass:"refresh-options",onclick:function(){R();},postCreate:function(){this.model=mstrmojo.all.DIModel;this.model.attachEventListener("CurrentSourceChanged",this.id,"makeVisible");this.makeVisible();},makeVisible:function(){var V=mstrmojo.all.DIModel;var W=V.currentSource;var X=false;if(W&&W.type===T.sourceType.hadoop&&W.subtype===T.sourceSubtype.hadoop&&!V.isDirectDataAccess){X=true;}this.set("visible",X);}},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(13023,"Wrangle..."),cssClass:"refresh-options",useRichTooltip:true,updateTooltipConfig:function(){var V=mstrmojo.dom.position(this.domNode);this.richTooltip={cssClass:"vi-regular vi-tooltip-D",posType:mstrmojo.tooltip.POS_TOPRIGHT,content:this.title,top:V.y-10,left:V.x-10};},onclick:function(){var V=mstrApp.getRootController(),W=V.model.currentSource;if(W.canLaunchWrangler()){V.launchWranglerDialog(W);}else{if(mstrmojo.DI.DIHelpers.isRefreshable(V.model)){V.model.isAddingNewTable=false;V.model.refreshToWrangle=W.tableID;V.refreshSourceTable(W.tableID);}else{V.displayError(mstrmojo.desc(14661,"Administrator has disabled importing a file from a URL. Hence we cannot proceed to wrangle the table."));}}},postCreate:function B(){var V=mstrApp.getRootController().model;V.attachEventListener("SourceInfoFetched",this.id,"update");V.attachEventListener("CurrentSourceChanged",this.id,"update");this.update();},update:function(){var Z=this.parent.parent.parent;var W=Z.model;var Y=W.currentSource;var V=mstrApp.getRootController();var X;if(!J.call(Z)){return ;}this.set("enabled",true);this.title=mstrmojo.desc(13899,"Transform your data with Data Wrangler");X=Y.canRefine();this.set("visible",X);if(W.refreshToWrangle){V.launchWranglerDialog(W.importSources[W.refreshToWrangle]);W.refreshToWrangle=null;}}}]}]},{slot:"previewNode",scriptClass:"mstrmojo.DI.DIMappingPreview",alias:"preGrid",columns:null,initialRendering:null,postCreate:function(){var V=this.parent.model;this.columns=[];V.attachEventListener("MappingsFetched",this.id,"initPreview");if(mstrApp.isEMMACube){V.attachEventListener("CurrentSourceChanged",this.id,"initPreview");}this.initialRendering=true;},postBuildRendering:function L(){if(mstrmojo.DI.DIMappingPreview.prototype.postBuildRendering){mstrmojo.DI.DIMappingPreview.prototype.postBuildRendering.call(this);}if(this.initialRendering){this.initialRendering=false;this.initPreview();}},initPreview:function(){var e=this.parent.model,Y,b=[],a,V,X,d;if(!J.call(this.parent)){return ;}if(!e.currentSource){this.set("visible",false);return ;}var W,f,Z;var g=function(k,j){var h=false;if(k&&k.length){if(k[0].hasOwnProperty("clix")){h=F.find(k,"clix",j.ix)>=0;}if(k[0].hasOwnProperty("did")){h=F.find(k,"did",j.did)>=0;}}return h;};if(!e.currentSource.currentTransformations||!e.currentSource.currentTransformations.xtab||!e.currentSource.currentTransformations.xtab.isCrosstab){W=e.currentSource.currentMapping;if(!W){return ;}if(!e.currentSource.currentPreview){return ;}f=e.currentSource.currentPreview.data;Z=e.currentSource.currentPreview.dcns;}else{W=e.currentSource.transformedMapping||e.currentSource.currentMapping;if(!W){return ;}d=e.currentSource.transformedPreview||e.currentSource.currentPreview;if(!d){return ;}f=d.data;Z=d.dcns;}F.forEach(W,function(h){Y=h.subColumns;if(Y&&Y.length>=1){V=[];F.forEach(Y,function(j){if(j.columnState!==4&&(j.type!=="cmps"||g(Z,j))){V.push(j);}});X=V.length;if(X>1){a={};H.copy(h,a);a.subColumns=V;b.push(a);}else{if(X===1){b.push(V[0]);}}}else{if(h.columnState!==4&&(h.type!=="cmps"||g(Z,h))){b.push(h);}}});mstrmojo.DI.DIHelpers.setDataIdx(b,Z,"dataIdx");var c={mappings:b,dataset:f,supportTimeGeo:true,shapeKeys:e.shapeKeys,renameMapped:function(o,n,p){var j=this,k=j.mappings,q=false,l,m;for(l=0,m=k.length;l<m;l++){if(l!==n){if(p===k[l].alias&&k[n].tp===k[l].tp){q=true;break;}}}if(q){var h=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");mstrApp.getRootController().displayError(h.replace("##",p),null,j.alertTitle);return ;}j.mappings[n].alias=p;mstrApp.getRootController().model.raiseEvent({name:"MappingsFetched"});}};this.set("model",c);if(!c.mappings){return ;}this.populatePreview();},bindings:{visible:function(){return this.parent.mode===P.raw;}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIMappingPanel","mstrmojo.ui.Splitter","mstrmojo.StackContainer","mstrmojo.DI.DITablePanel","mstrmojo.DI.DIPreview","mstrmojo.css");mstrmojo.requiresDescs(12668);var K=mstrmojo.DI.DIConstants,L=mstrmojo.Widget,C=mstrmojo.css;function D(N){var M=0,O;for(O in N){M++;}return M;}mstrmojo.DI.DIMappingPage=mstrmojo.declare(mstrmojo.ui.Splitter,null,{cssClass:"mstrmojo-di-mappingpage",markupMethods:{onvisibleChange:L.visibleMarkupMethod,onheightChange:L.heightMarkupMethod,onwidthChange:L.widthMarkupMethod},orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,isPreviewOn:true,isPreviewMaximized:false,prviewMaxHeight:undefined,config:{firstSplit:{v:"100%",min:"296px",max:undefined},secondSplit:{v:"161px",min:"166px",max:undefined},resizeHandle:{v:"5px"}},children:[{slot:"firstSplitNode",scriptClass:"mstrmojo.DI.DITablePanel",bindings:{model:"this.parent.model"}},{slot:"secondSplitNode",scriptClass:"mstrmojo.StackContainer",cssClass:"mappingpage-bottom",alias:"bottomStack",setDimensions:function G(Q,N){var O;var M=parseInt(Q,10);var P=parseInt(N,10);if(isNaN(M)||isNaN(P)){return ;}if(this._super){this._super(Q,N);}this.set("height",Q);this.set("width",N);if(!this.children){return ;}for(O=0;O<this.children.length;O++){if(this.children[O].setDimensions){this.children[O].setDimensions(Q,N);}else{this.children[O].set("height",Q);this.children[O].set("width",N);}}},onremoveChild:function(M){var O=M.value;for(var N=0;N<O.length;N++){O[N].destroy();}}}],togglePreview:function F(N){mstrmojo.css.toggleClass(this.domNode,"toggling",true);this.toggleSecondItemVisibility(N);this.draggable=N;this.set("isPreviewOn",N);var M=this.domNode;C.toggleClass(M,"preview-collapse",!N);setTimeout(function(){C.removeClass(M,["toggling"]);},500);},togglePreviewMaximized:function I(M){var O=this,N=this.domNode;mstrmojo.css.toggleClass(N,"toggling",true);if(M){this.layoutConfig.h={firstSplitNode:"296px",resizeHandle:"5px",secondSplitNode:"100%"};}else{this.layoutConfig.h={firstSplitNode:"100%",resizeHandle:"5px",secondSplitNode:"161px"};}this.doLayout();O.set("isPreviewMaximized",M);setTimeout(function(){C.removeClass(N,["toggling"]);O.widgetResized();},500);},widgetResized:function E(){var N=this.isPreviewMaximized,M;if(this._super){this._super();}M=this.layoutConfig&&this.layoutConfig.h;if(M){N=M.firstSplitNode==="296px"&&M.secondSplitNode==="100%";}if(this.bottomStack.selected){this.bottomStack.selected.widgetResized();}this.set("isPreviewMaximized",N);},toggleSecondItemVisibility:function J(M){if(M){this._super(M);}else{this.layoutConfig.h={firstSplitNode:"100%",resizeHandleNode:"0px",secondSplitNode:"40px"};}this.doLayout();},update:function(N){if(N&&N.ignore){return ;}var M=this.model;var Q=null;var P=null;var R,O;if(M.currentSource===null){this.toggleSecondItemVisibility(this.isPreviewOn);}else{if(D(M.importSources)===1){Q=M.getAllTableID()[0];}else{Q=M.currentSource.key;}R=M.getImportSource(Q);O=!!R.currentPreview||!!R.transformedPreview;if(R&&!O){if(R.cannotFetchPreview){this.toggleSecondItemVisibility(false);}mstrApp.getRootController().selectSourceTable(R.tableID);return ;}if(this.layoutConfig&&this.layoutConfig.h.secondSplitNode==="0px"){this.toggleSecondItemVisibility(this.isPreviewOn);}P=this.previewPageInstances[Q];if(!P||P.destroyed){P=this.bottomStack.addChildren([mstrmojo.insert({scriptClass:"mstrmojo.DI.DIPreview",model:M,sourceTableKey:Q})])[0];this.previewPageInstances[Q]=P;if(P.setDimensions){P.setDimensions(this.bottomStack.height,this.bottomStack.width);}else{P.set("height",this.bottomStack.height);P.set("weight",this.bottomStack.width);}}this.bottomStack.set("selected",P);}},updateFooterButtons:function(){var N=mstrApp.getRootController(),M=this.model,O=M.getAllTableID(),P=0,Q,R;if(N.dialogController.pageZIndex<=0){mstrmojo.array.forEach(O,function(S){Q=M.getImportSource(S);if(Q){R=Q.getCurrentMappings(function(T){return T.selected;});if(R&&R.length){P+=R.length;}}});N.rootView.showFooter({next:{enabled:P>0}});N.rootView.showFooter({save:{enabled:P>0}});}},getSelectedChild:function(){return this.bottomStack.selected;},preBuildRendering:function H(){this.setDimensions(parseInt(this.parent.layoutNode.offsetHeight,10),this.parent.layoutNode.offsetWidth);if(this._super){this._super();}this.update();},postCreate:function(){var M=this.model;this.previewPageInstances={};M.attachEventListener("CurrentSourceChanged",this.id,"update");M.attachEventListener("PreviewFetched",this.id,"update");M.attachEventListener("PreviewNotFetched",this.id,"update");M.attachEventListener("MappingsFetched",this.id,"updateFooterButtons");M.attachEventListener("removeSourceTable",this.id,"removeSourceTablePreview");this.attachEventListener("scrollPreviewToCurItem",this.id,"scrollPreviewToCurItem");},removeSourceTablePreview:function(M){if(this.previewPageInstances[M.tableID]){this.bottomStack.removeChildren(this.previewPageInstances[M.tableID]);delete this.previewPageInstances[M.tableID];}},scrollPreviewToCurItem:function A(N){var P=N.tableId;var S;var R=this.getSelectedChild();if(!R||R.sourceTableKey!==P){return ;}var O=R.preGrid;var Q=R.preGrid.columns.length;if(!Q||Q<=0){return ;}S=O.getMappingColumnOffset(N.data);var M={};M.scrollLeft={isStyle:false,start:O.scrollNode.scrollLeft,stop:S,ease:mstrmojo.ease.linear};(new mstrmojo.fx.AnimateProp({props:M,duration:20,interval:10,target:O.scrollNode})).play();},onNextButtonClick:function(){var M=this.getSelectedChild();if(M&&M.scriptClass==="mstrmojo.DI.DIPreview"){M.onNextButtonClick();}else{mstrApp.getRootController().saveAndPublish();}},onSaveButtonClick:function(){mstrApp.getRootController().save();},onCancelButtonClick:function(){var M=mstrApp.getRootController(),N=M.getModel().isCubeSaved;if(N){M.wrapUpDataImport(false);}else{M.cancelApplication();}return true;},onHelpButtonClick:function B(){return"preview.htm";},onBackButtonClick:function(){var O=mstrApp.getRootController();var M=O.model;var S;var N=this.getSelectedChild();if(M.currentSource){var R=M.currentSource.tableID;var Q=O.navigationController.getPreviousPageSlot(R,K.pageType.emmaPreview);if(N.onBackButtonClick&&!N.onBackButtonClick()){if(Q){var P=Q.get();if(P){O.showPage(P.pageType,null,Q);}else{var T=Q.getConfig();if(T){O.showPage(T.pageType,null,Q);}}}else{S=M.currentSource.type;if(S===K.sourceType.querybuilder){mstrApp.getRootController().showPage(K.pageType.database,{sourceType:K.sourceType.querybuilder,type:M.currentSource.xdaType,extParams:{tableID:M.currentSource.tableID}});}}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.DI.DIFooter","mstrmojo.DI.DIFileUpload","mstrmojo.DI.DIURLUpload","mstrmojo.DI.DISampleFiles","mstrmojo.DI.DIPreview","mstrmojo.DI.DIExitOptions","mstrmojo.DI.DISourceList","mstrmojo.DI.DICubesList","mstrmojo.DI.DISourceIntro","mstrmojo.DI.DIDatabaseIntro","mstrmojo.DI.ProgressPolyfill","mstrmojo.DI.DISourceObjects","mstrmojo.DI.DISourceObjectsGA","mstrmojo.DI.DIDataset","mstrmojo.DI.DIMappingPage","mstrmojo.DI.TableSources","mstrmojo.DI.DIClipboard","mstrmojo.DI.DIPublicData","mstrmojo.qb.QBContainer","mstrmojo.DI.DIHadoop","mstrmojo.DI.DITwitterPage","mstrmojo.DI.DIFacebookPage","mstrmojo.DI.DISourceObjectsDnD","mstrmojo.ui.SearchablePulldown","mstrmojo.DI.DIRemoteProjects","mstrmojo.DI.DIHelpers","mstrmojo.css","mstrmojo.DI.DISourceListAdmin","mstrmojo.DI.DISearchTableBox");mstrmojo.requiresDescs(118,172,531,773,1059,1143,1302,3389,7972,10236,10766,11677,12446,12479,12480,12484,12490,12715,12716,12721,12722,12723,12752,12805,12806,13152,13308,13466,13467,13468,13469,13612,13781,13852,13978,14512);var N=mstrmojo.Widget,O=mstrmojo.dom,AC=mstrmojo.DI.DIHelpers,n=mstrmojo.DI.DIConstants,W=n.pageType,x=n.operationMode,h=mstrmojo.array,F=mstrmojo.css;var U={scriptClass:"mstrmojo.DI.DIRemoteProjects",alias:"allProjectPage",pageType:W.allProjectSource,slot:"layoutNode"};var e={scriptClass:"mstrmojo.DI.DIHadoop",alias:"hadoopPage",pageType:W.hadoop,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var T={scriptClass:"mstrmojo.DI.DIMstrUpload",alias:"mstrFileUpload",slot:"layoutNode"};var D={scriptClass:"mstrmojo.DI.DIFileUpload",pageType:W.file,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var P={scriptClass:"mstrmojo.DI.DIURLUpload",pageType:W.file,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var u={scriptClass:"mstrmojo.DI.DIClipboard",alias:"clipboardPage",cssClassLabel:"mstrmojo-clipboard-label",pageType:W.clipboard,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var a={scriptClass:"mstrmojo.DI.DIPublicData",pageType:W.publicData,slot:"layoutNode",size:{h:"557px",w:"1010px"}};var J={scriptClass:"mstrmojo.DI.DIDatabaseIntro",pageType:W.database,slot:"layoutNode",size:{w:"1328px",h:"636px"}};var b={scriptClass:"mstrmojo.qb.QBContainer",pageType:W.database,slot:"layoutNode",size:{w:"1328px",h:"636px"}};var Y={scriptClass:"mstrmojo.DI.DIDataset",pageType:W.dataset,slot:"layoutNode"};var z={scriptClass:"mstrmojo.DI.DISampleFiles",pageType:W.sampleFiles,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var S={scriptClass:"mstrmojo.DI.DISourceList",pageType:W.dataSelection,slot:"layoutNode",size:{h:"557px",w:"1010px"}};var R={scriptClass:"mstrmojo.DI.DISourceObjects",pageType:W.sourceObjects,slot:"layoutNode"};var E={scriptClass:"mstrmojo.DI.DISourceObjectsDnD",pageType:W.sourceObjectsDnD,slot:"layoutNode",size:{h:"556px",w:"1010px"}};var o={scriptClass:"mstrmojo.DI.DISourceObjectsGA",alias:"sourceObjectsPage",pageType:W.sourceObjects,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var c={scriptClass:"mstrmojo.Box",alias:"emptyPage",slot:"layoutNode",size:{h:"557px",w:"1010px"}};var f={scriptClass:"mstrmojo.DI.DIPreview",pageType:W.preview,slot:"layoutNode"};var C={scriptClass:"mstrmojo.DI.DIMappingPage",pageType:W.emmaPreview,slot:"layoutNode",size:{w:"95%",h:"95%"}};var L={scriptClass:"mstrmojo.DI.DIFooter",slot:"footerNode",alias:"footer"};var g={scriptClass:"mstrmojo.DI.DIExitOptions",pageType:W.redirect,slot:"layoutNode",size:{h:"380px",w:"500px"}};var Q={scriptClass:"mstrmojo.DI.DITwitterPage",pageType:W.twitter,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var q={scriptClass:"mstrmojo.DI.DIFacebookPage",pageType:W.facebook,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var p={scriptClass:"mstrmojo.DI.DISourceListAdmin",pageType:W.sourceAdmin,slot:"layoutNode",size:{h:"557px",w:"1010px"}};var G={scriptClass:"mstrmojo.Box",slot:"headerNode",alias:"header",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-title",alias:"title",text:mstrmojo.desc(12721,"Connect to Your Data")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-title mstrmojo-di-subtitle",alias:"subtitle",ontextChange:function I(AE){if(AE.value!==""){this.text="("+AE.value+")";}else{this.text="";}}},{scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-close",alias:"closeBtn",title:mstrmojo.desc(2102,"Close"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AE=O.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AE.y+40,0),left:Math.max(AE.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){this._ontooltipout();mstrApp.getRootController().onCancelButtonClick();},premousedown:function(){F.toggleClass(this.domNode,"hit",true);},premouseup:function(){F.toggleClass(this.domNode,"hit",false);}},{scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-help",title:mstrmojo.desc(1143,"Help"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AE=O.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AE.y+40,0),left:Math.max(AE.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){mstrApp.getRootController().onHelpButtonClick();},premousedown:function(){F.toggleClass(this.domNode,"hit",true);},premouseup:function(){F.toggleClass(this.domNode,"hit",false);}},{alias:"customizeButton",scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-customize",title:mstrmojo.desc(14512,"Customize your page"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AE=O.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AE.y+40,0),left:Math.max(AE.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){mstrApp.getRootController().showPage(n.pageType.sourceAdmin);},premousedown:function(){F.toggleClass(this.domNode,"hit",true);},premouseup:function(){F.toggleClass(this.domNode,"hit",false);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12668,"All Objects View")+"...",visible:false,cssClass:"all-objects-view-link",alias:"allObjectsLink",onclick:function K(){mstrApp.getRootController().allObjectsController.showAllObjects();}},{scriptClass:"mstrmojo.DI.DISearchTableBox",alias:"searchTable",visible:false}]};var j={};var d={};function X(AG,AF,AI,AJ){var AH=null;var AE=AG;if(AJ){AH=AJ.get();}if(!AH){if(AF){AG.model=AF;}if(AJ&&AJ.getConfig()){AE=AJ.getConfig().properties||{};AE=mstrmojo.hash.copy(AG,AE);}AH=this.addChildren(mstrmojo.insert(AE));AH.render();if(AH.alias==="sourceIntroPage"){d[AG.sourceInfo.id]=AH;}if(AG.sourceObjectsInfo){j[AG.sourceObjectsInfo.name]=AH;}if(AJ){AJ.set(AH);}}this.currentPage=AH;if(AJ.getConfig()&&AH.updatePageConfig){AH.updatePageConfig(AJ.getConfig());}if(this.header){this.header.title.set("text",AI);}if(AJ){window.setTimeout(function(){AJ.destroy();},0);}}function t(){var AH=this.curtainNode;if(!AH){return ;}var AE=document.body,AF=document.documentElement,AG=AH.style;AG.width=Math.max(AE.clientWidth,AF.scrollWidth)+"px";AG.height=Math.max(AE.clientHeight,AF.scrollHeight)+"px";}function Z(){if(this.domNode){var AE=this.domNode,AF=AE&&AE.style;if(AF){AF.height=this.height;AF.width=this.width;}mstrmojo.dom.center(this.domNode);AC.reevaluatePopupPosition(this.domNode);if(this.parent&&this.parent.setPosition){this.parent.setPosition(AF.left,AF.top);}}}function V(AE){var AF;switch(AE){case n.sourceType.salesforce:AF=mstrmojo.desc(13466,"Salesforce: Import your CRM reports from your account");break;case n.sourceType.dropbox:AF=mstrmojo.desc(13467,"Dropbox: Import files from your account");break;case n.sourceType.googleAnalytics:AF=mstrmojo.desc(13468,"Google Analytics: Import Web Analytics data from your account");break;case n.sourceType.googleDrive:AF=mstrmojo.desc(13469,"Google Drive: Import files and Google Spreadsheets from your account");break;default:AF=mstrmojo.desc(10766,"Select Data");break;}return AF;}function l(AE){var AH=this.getBrowserDimensions(),AF={};var AG=parseInt(AH.w,10);if(AE.h.match(/%$/)){AF.h=parseInt(AH.h,10)*parseInt(AE.h,10)/100+"px";}else{AF.h=AE.h;}if(AG>=800&&AG<=1063){AF.w=(AG*0.95)+"px";return AF;}if(AG<800){AF.w="760px";return AF;}if(AE.w.match(/%$/)){AF.w=AG*parseInt(AE.w,10)/100+"px";}else{AF.w=AE.w;}return AF;}function B(AE){var AG=mstrApp.getRootController().getModel().getImportSource(AE),AF=false;if(!AG){return AF;}switch(AG.databaseType){case 3100:case 4100:case 7300:case 6800:case 6400:AF=true;break;case 700:AF=h.indexOf(n.ibmDb2Versions,AG.databaseVersion)===-1;break;default:break;}return AF;}mstrmojo.DI.DIRootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIRootView",markupString:'<div id="{@id}" class="mstrmojo-di-view {@cssClass}" mstrAttach:contextmenu><div class="mstrmojo-di-header"></div><div class="mstrmojo-di-layout"></div><div class="mstrmojo-di-footer"></div><div class="mstrmojo-di-curtain"></div></div>',markupSlots:{headerNode:function(){return this.domNode.firstChild;},layoutNode:function(){return this.domNode.children[1];},footerNode:function(){return this.domNode.children[2];},curtainNode:function(){return this.domNode.children[3];}},offsetHeight:48,offsetWidth:1,headerHeight:41,footerHeight:61,layoutBorder:2,showHeader:true,visible:false,saveVisualTime:4000,saveVisualTimeoutID:null,saveVisualTimeoutFn:null,markupMethods:{onvisibleChange:N.visibleMarkupMethod,onheightChange:N.heightMarkupMethod,onwidthChange:N.widthMarkupMethod},showPage:function AB(AK,Ah,AI,Af){var AU=mstrApp.getRootController(),AJ=AU.getModel();if(Ah){if(mstrApp.isSingleTier&&Ah.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var AY=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),AW='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";AY=AY.replace("#",AW)+".";AU.displayError(AY,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}}this.set("visible",true);this.clearModalNodes();if(this.currentPage){this.currentPage.set("visible",false);}var AP={};var AE=mstrmojo.desc(13852,"Prepare Data"),Ac=AJ.operationMode===n.operationMode.edit?mstrmojo.desc(13850,"Update Dataset"):mstrmojo.desc(1302,"Finish");var AO=AE,AG=AI&&AI.getConfig(),AH,AN,Ab=AU.dialogController,AV=false,Ag,Aa=mstrApp.container,AS=mstrApp.isEMMACube,AM,Ae=n.xdaType;if(!Af&&AG){Af=AG.footerConfig;}mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD",(AJ.operationMode===x.refresh)?"refresh":"select",0];switch(AK){case W.dataSelection:X.call(this,S,AJ,mstrmojo.desc(12721,"Connect to Your Data"),AI);AP={next:{visible:false,enabled:false,text:AO},back:{visible:false},cancel:{visible:false},finish:{visible:false},cubeQuota:{visible:true},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false},sourceAdmin:{visible:true},};if(!mstrApp.isSingleTier&&mstrApp.launchingApp&&mstrApp.launchingApp.pageName==="Html5Vi"){if(!AJ.hasEMMAReportInstance()){AP.managedCheckbox={visible:false,enabled:true};}}if(AJ.analysisID){AP.cubeQuota={visible:false};}if(!mstrApp.isSingleTier&&AJ.operationMode===n.operationMode.edit&&!AJ.cubesInfo){AU.getCubeQuota();}break;case W.mstrFile:X.call(this,T,AJ,mstrmojo.desc(12479,"Mstr File upload"),AI);AP={next:{visible:false,text:AO},back:{visible:false},cancel:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.allProjectSource:X.call(this,U,AJ,mstrmojo.desc(12480,"Connect to MicroStrategy Projects"),AI);AP={next:{visible:false,text:AO},back:{visible:true},finish:{visible:true,enabled:false},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.hadoop:X.call(this,e,AJ,mstrmojo.desc(12805,"Connect to Hadoop"),AI);AP=Af||{next:{visible:true,text:AO},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.dataset:X.call(this,Y,AJ,mstrmojo.desc(11677,"Select a dataset"),AI);AP={next:{visible:true,text:AO},back:{visible:false},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.file:if(Ah!==null){if(Ah===1){if(AJ.operationMode!==n.operationMode.create&&mstrApp.diParams.EnableURLImport===false){Ah=0;}}}if(AI.getConfig()&&AI.getConfig().sourceInfo!==undefined){Ah=AI.getConfig().sourceInfo;}if(Ah===0){D.sourceSubtype=n.sourceSubtype.localFile;X.call(this,D,AJ,mstrmojo.desc(12715,"Upload your files"),AI);}else{P.sourceSubtype=n.sourceSubtype.url;X.call(this,P,AJ,mstrmojo.desc(12715,"Upload your files"),AI);}AP=Af||{next:{visible:true,text:AO},back:{visible:true},cancel:{visible:true},finish:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.database:if(Ah!==null){J.sourceInfo=Ah;}if(AS){AO=AE;Ag=(Ah&&Ah.type===n.xdaType.mdx)?mstrmojo.desc(13152,"Import From Cubes"):mstrmojo.desc(12716,"Import From Tables");X.call(this,b,AJ,Ag,AI);AN=AU.getQueryBuilderParams(Ah.type,Ah.extParams||null);AG=AI&&AI.getConfig();AH=AG&&AG.properties&&AG.properties.tableID;if(AH){AN.tableID=AH;AN.isHadoopQB=B(AH);}var Ad=this,AZ=false,AL=false;mstrmojo.hash.forEach(AU.model.importSources,function(Ai){if(Ai.subtype===n.sourceSubtype.hanaSingleTable){AZ=true;}else{AL=true;}});AN.isSapHanaSingleTable=AZ;AN.hasNonSapHana=AL;if(AZ){mstrApp.supportDBObjects=AU.model.supportDBObjects;}AN.diShowFooterFunction=function(Ai){Ad.showFooter(Ai);};this.currentPage.size=AN.size;mstrmojo.hash.copy(AN,this.currentPage.QBParams);if(AU.dataService.messageID){if(this.currentPage.QBParams.size){this.currentPage.QBParams.size=l.call(Ad,this.currentPage.QBParams.size);}this.currentPage.loadQB();}else{AU.createNewReportInstance({success:function(){var Ai=Ad.currentPage.QBParams;Ai.size=l.call(Ad,Ai.size);Ai.messageID=AU.dataService.messageID;AU.getQBParamsDDA(Ai);Ai.operationMode=AJ.operationMode;Ad.currentPage.loadQB();}});}}else{X.call(this,J,AJ,mstrmojo.desc(10766,"Select Data"),AI);}AP=Af||{next:{visible:true,enabled:true,text:AO},back:{visible:true},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};if(AS){AP.next.enabled=false;AP.finish.enabled=false;AH=AN&&AN.tableID;if(AH){AM=Ah.type;if(AM!==Ae.querybuilder&&AM!==Ae.ffsql&&AM!==Ae.googleBigQuery&&AM!==Ae.googleBigQueryFFSQL){AP.cancel.visible=false;}AP.back.visible=false;}}if(Ah.type===n.xdaType.mdx){AP.next.visible=false;}else{if(Ah.sourceType===n.sourceType.bisource){AP.cancel.visible=true;if(this.header){this.header.title.set("text",mstrmojo.desc(12752,"BI Sources"));this.header.subtitle.set("text",mstrmojo.desc(12806,"Import from SAP Business Object, Cognos, and OBIEE"));}}}break;case W.sampleFiles:X.call(this,z,AJ,mstrmojo.desc(12446,"File Samples"),AI);AP=Af||{next:{visible:true,text:AO},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.emmaPreview:var AR=mstrmojo.desc(13612,"Save Progress");if(mstrApp.isSingleTier){AP={next:{visible:true,text:Ac},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}else{AP={next:{visible:true,text:Ac},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:true,text:AR},managedCheckbox:{visible:false}};}if(AJ.isManagedCube){AP.save={visible:false};}X.call(this,C,AJ,mstrmojo.desc(3389,"Preview"),AI);this.header.subtitle.set("text","");mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD","review",0];AV=true;break;case W.preview:X.call(this,f,AJ,mstrmojo.desc(3389,"Preview"),AI);AP={next:{visible:true},back:{visible:true},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD","review",0];break;case W.redirect:X.call(this,g,AJ,mstrmojo.desc(13308,"Start your analysis"),AI);AP={next:{visible:false},back:{visible:false},cancel:{visible:false},previewNote:{visible:false},finish:{visible:false},dda:{visible:false},cubeQuota:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.sourceIntro:mstrApp.getRootController().getOAuthSourceReports(Ah.type,false,AI);break;case W.sourceObjects:Ag=V(Ah.type);if(n.sourceType.googleAnalytics===Ah.type){o.sourceObjectsInfo=Ah;X.call(this,o,AJ,Ag,AI);}else{R.sourceObjectsInfo=Ah;X.call(this,R,AJ,Ag,AI);}AP=Af||{next:{visible:true,text:AO},back:{visible:true},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.sourceObjectsDnD:Ag=V(Ah.type);if(n.sourceType.googleAnalytics===Ah.type){o.sourceObjectsInfo=Ah;X.call(this,o,AJ,Ag,AI);}else{E.sourceObjectsInfo=Ah;X.call(this,E,AJ,Ag,AI);}AP=Af||{next:{visible:true,text:AO},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.suggestNewSource:var AQ="productfeedback@microstrategy.com",AF=mstrApp.isSingleTier?"Analytics%20Desktop":"Analytics%20Enterprise",AX="New%20Data%20Source%20Suggestion";mstrApp.getRootController().openMailClient("mailto:"+AQ+"?subject="+AF+":%20"+AX);break;case W.clipboard:u.url=Ah;X.call(this,u,AJ,mstrmojo.desc(12490,"Create custom data"),AI);if(AJ.operationMode===n.operationMode.refresh){AP=Af||{next:{visible:true,text:mstrmojo.desc(773,"Refresh")},back:{visible:false},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}else{AP=Af||{next:{visible:true,text:AO},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}break;case W.twitter:Q.sourceObjectsInfo=Ah;X.call(this,Q,AJ,mstrmojo.desc(12722,"Import data from Twitter"),AI);AP=Af||{next:{visible:true,enabled:false,text:AO},cancel:{visible:true},finish:{visible:true,enabled:false},back:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.facebook:q.sourceObjectsInfo=Ah;X.call(this,q,AJ,mstrmojo.desc(12723,"Import data from Facebook"),AI);AP=Af||{next:{visible:true,enabled:false,text:AO},cancel:{visible:true},finish:{visible:true,enabled:false},back:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case W.publicData:a.url=Ah;X.call(this,a,AJ,mstrmojo.desc(13978,"Public Data"),AI);if(AJ.operationMode===n.operationMode.refresh){AP={next:{visible:true,text:mstrmojo.desc(773,"Refresh")},back:{visible:false},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}else{AP=Af||{next:{visible:true,text:AO},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}break;case W.sourceAdmin:X.call(this,p,AJ,mstrmojo.desc(12721,"Connect to Your Data"),AI);AP=Af||{next:{visible:false},back:{visible:false},cancel:{visible:true},finish:{visible:true,enabled:true,text:mstrmojo.desc(118,"Save")},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;}if(AK===W.dataSelection||AK===W.redirect){this.showFooterDividerLine(false);}else{this.showFooterDividerLine(true);}if(AU.model.isAddingNewTable&&AK!==W.sourceAdmin){if(AP.next){AP.next.text=mstrmojo.desc(531,"Add");}if(AP.finish){AP.finish.visible=false;}}if(!AP.mdxRACheckbox){AP.mdxRACheckbox={visible:false};}this.showFooter(AP);var AT=this.header;if(AT){AT.allObjectsLink.set("visible",AV);AT.searchTable.set("visible",AV);AT.customizeButton.set("visible",AP.sourceAdmin?AP.sourceAdmin.visible:false);}this.currentPage.set("visible",true);if(this.currentPage.size&&Aa){this.windowResize(this.currentPage.size);}if(Ab&&Ab.pageZIndex>0){Ab.centerPageDialog();}return this.currentPage;},showFooter:function AA(AE){this.footer.showControls(AE);},showFooterDividerLine:function m(AE){if(AE){this.layoutNode.className="mstrmojo-di-layout";this.footerNode.className="mstrmojo-di-footer";}else{this.layoutNode.className="mstrmojo-di-layout-noborder";this.footerNode.className="mstrmojo-di-footer-noborder";}},setModalNodes:function(AH,AE){var AG=this.curtainNode;if(!AG){return ;}this.clearModalNodes();var AI=AE||9999;var AF;if(!AH||!AH.length){return ;}this.modalNodes=AH;for(AF=0;AF<AH.length;AF++){this.modalNodesZIndexes.push(AH[AF].style.zIndex);}for(AF=0;AF<AH.length;AF++){AH[AF].style.zIndex=AI;if(AH[AF].style.position===""){AH[AF].style.position="relative";}}this.curtainNode.style.display=this.visible?"block":"none";this.curtainNode.style.zIndex=AI-1;t.call(this);AH[0].focus();},clearModalNodes:function(){var AH=this.curtainNode;if(!AH){return ;}var AF,AG,AE,AI;AE=this.modalNodes;AG=this.modalNodesZIndexes;for(AF=0;AE&&AF<AE.length;AF++){AI=AE[AF];if(AI&&AI.style){AI.style.zIndex=AG[AF];}}this.modalNodes=[];this.modalNodesZIndexes=[];this.curtainNode.style.height="0px";this.curtainNode.style.weight="0px";this.curtainNode.style.display="none";},windowResize:function M(AG){var AE,AH,AI,AF;if(!AG||!AG.h||!AG.w){return ;}AI=l.call(this,AG);mstrApp.size=AI;AE=AI.h;AH=AI.w;if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.w.layoutNode=AH;this.layoutConfig.h.layoutNode=parseInt(AE,10)-(this.headerHeight+this.footerHeight+this.layoutBorder)+"px";this.setDimensions(AE,AH);t.call(this);Z.call(this);AF=mstrApp.getRootController().model;if(AF){AF.raiseEvent({name:"windowSizeChanged",size:AI});}},browserResized:function w(AF){var AE,AG,AH;if(this.domNode){if(document.createEvent){AH=document.createEvent("MouseEvents");AH.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,0,null);this.domNode.dispatchEvent(AH);}else{if(document.createEventObject){AH=document.createEventObject();this.domNode.fireEvent("onmousedown",AH);}}}if(mstrApp.container||mstrApp.placeholder==="mainApp"){AE=this.height;AG=this.width;this.setDimensions(AE,AG);if(this.currentPage){this.windowResize(this.currentPage.size);}t.call(this);Z.call(this);}else{AE=(parseInt(AF.h,10)-this.offsetHeight);AG=(parseInt(AF.w,10)-this.offsetWidth);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.w.layoutNode=AG+"px";this.layoutConfig.h.layoutNode=AE-(this.headerHeight+this.footerHeight)+"px";this.setDimensions(AE+"px",AG+"px");}return true;},preBuildRendering:function A(){if(this._super){this._super();}mstrmojo.DI.ProgressPolyfill.createProgressPolyfill();var AE=[];if(!this.footer){L.model=mstrApp.getRootController().getModel();AE.push(L);}if(!this.header&&this.showHeader){AE.push(G);}this.addChildren(AE);this.footer.showControls({next:{visible:false},back:{visible:false},cancel:{visible:false}});if(!this.emptyPage){this.currentPage=this.addChildren(c);if(this.currentPage.size&&mstrApp.container){this.windowResize(this.currentPage.size);}}},oncontextmenu:function k(AE){var AG=O.eventTarget(AE.hWin,AE.e),AF;if(AG&&AG.tagName){AF=AG.tagName.toLowerCase();}if(AF!=="input"&&AF!=="textarea"&&AG.contentEditable!=="true"){O.preventDefault(window,AE.e);return false;}},setHomepageViewMode:function H(AE){S.mode=AE;},focusFooter:function AD(){if(this.footer&&this.footer.containerNode){this.footer.containerNode.focus();}},showSaveVisual:function(){var AF=this,AE=AF.header&&AF.header.subtitle.text,AG=mstrmojo.desc(13781,"Saved Successfully");if(AF.saveVisualTimeoutID){window.clearTimeout(AF.saveVisualTimeoutID);}else{AF.header.subtitle.set("text",AG);F.toggleClass(AF.header.subtitle.domNode,"saveVisual",true);AF.saveVisualTimeoutFn=function(){AF.header.subtitle.set("text",AE||"");F.toggleClass(AF.header.subtitle.domNode,"saveVisual",false);AF.saveVisualTimeoutID=null;};}AF.saveVisualTimeoutID=window.setTimeout(AF.saveVisualTimeoutFn,AF.saveVisualTime);},destroy:function(AE){if(this.saveVisualTimeoutID){window.clearTimeout(this.saveVisualTimeoutID);}this._super(AE);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIRootView","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.Editor");mstrmojo.requiresDescs(14155);var E=mstrmojo.DI.DIHelpers,D=mstrmojo.DI.DIConstants;mstrmojo.DI.ui.dialogs.DIPageDialog=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser],{scriptClass:"mstrmojo.DI.ui.dialogs.DIPageDialog",showTitle:false,zIndex:999,launcher:null,getMovingHandle:function F(){return this.rootView.headerNode;},browserResized:function C(G){if(this.editorNode){mstrmojo.dom.center(this.editorNode);E.reevaluatePopupPosition(this.editorNode);}},onOpen:function B(){var G=mstrApp.getRootController(),L=this.slot,J=mstrmojo.desc(14155,"Please input your original data into clipboard because you have parsed or wrangled the data."),K={success:function(M){L.getConfig().properties.content=M;G.showPage(D.pageType.clipboard,0,L||null);},failure:function(M){G.showPage(D.pageType.clipboard,0,L||null);G.displayError(mstrmojo.desc(12795,"Could not load clipboard data!"),false,M.message);}},H,I;this.set("visible",false);this.launcher=G.rootView;G.rootView=this.rootView;switch(this.pageType){case D.pageType.emmaPreview:G.fetchCubeInfoEMMA();break;case D.pageType.dataSelection:G.showPage(this.pageType,null,this.slot||null);break;case D.pageType.file:G.showPage(this.pageType,this.sourceInfo,this.slot||null);break;case D.pageType.clipboard:H=L.getConfig().properties.tableID;I={previewflag:D.requestFlag.fullData,browsetype:4,sheetIndex:0,bindingflag:0,tableID:H};if(!G.getModel().isParsed(H)&&!G.getModel().isRefined(H)){G.dataService.getImportedData(K,I,0);}else{G.showPage(D.pageType.clipboard,0,this.slot||null);mstrApp.getRootController().displayWarning(J,null,mstrmojo.emptyFn,{showCancel:false});}break;case D.pageType.schedule:case D.pageType.republish:this.origModel=G.getModel();this.origMessageID=G.dataService.messageID;this.origIRRMessageID=G.dataService.emmaIRRMessageID;this.model=new mstrmojo.DI.DIModel();this.addDisposable(this.model);this.model.initParams(this.diParams);G.model=this.model;G.dataService.messageID=null;G.dataService.emmaIRRMessageID=null;G.restoreForLaunchingApp();break;default:break;}},onClose:function A(){var G=mstrApp.getRootController();G.rootView=this.launcher;G.dialogController.pageZIndex--;this.sourceInfo=null;this.slot=null;if(this.origModel){G.model=this.origModel;this.origModel=null;}if(this.origMessageID!==undefined){G.dataService.messageID=this.origMessageID;this.origMessageID=null;}if(this.origIRRMessageID!==undefined){G.dataService.emmaIRRMessageID=this.origIRRMessageID;this.origIRRMessageID=null;}this.destroy();},children:[{scriptClass:"mstrmojo.DI.DIRootView",alias:"rootView",showHeader:true,onvisibleChange:function(){this.parent.set("visible",this.visible);}}]});}());(function(){var A=mstrmojo.DI.DIConstants.pageType;mstrmojo.DI.DIExpressView=mstrmojo.declare(mstrmojo.DI.DIRootView,null,{id:"DIRootView",scriptClass:"mstrmojo.DI.DIExpressView",offsetWidth:40,headerHeight:25,footerHeight:40,offsetHeight:175});}());function rrResize(){var A={h:mstr.utils.BoxModel.getBrowserWindowHeight(document),w:mstr.utils.BoxModel.getBrowserWindowWidth(document)};var B=mstrmojo.all.DIRootView;if(B){B.browserResized(A);}}(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.Obj","mstrmojo.Editor","mstrmojo.qb.es.AlternateSourceDialog","mstrmojo.DI.DIProjectsAttribute","mstrmojo.DI.DIHelpers","mstrmojo.vi.ui.editors.ObjectPicker");mstrmojo.requiresClsP("mstrmojo.DI","DIConstants","DIRootView","DIAllObjectsView","DIRepublishScheduleEditor","DIMultiFormEditor","DIPartitionGroupDialog","DIOAuthParaEditor","DIWhiteListEditor","DIProjectsAttribute","DITwitterAdvancedOptions");mstrmojo.requiresClsP("mstrmojo.DI.ui.dialogs","DICubesListDialog","DIMissingColumnsDialog","DIPageDialog","DIRefreshHistoryDialog","DIDirectAccessConfirmDialog","DISaveAsDialog","DISheetsSelectionDialog","DIParseDataDialog","DIQBImportOptionDialog","DICredentialsDialog","DIMapProjectAttributeDialog");mstrmojo.requiresClsP("mstrmojo.Refine","RefineClusteringDialog","RefineExtractDialog","RefineImportDialog");mstrmojo.requiresDescs(189,221,1442,3610,8973,11581,12579,12580,13010,13191,13192,13193,13194,13309,13310,13311,13312,13313,13314,13315,13316,13317,13329,13330,13303,14296);var m=mstrmojo,AA=m.DI.DIConstants,n=m.array,P=m.dom,D=m.css,AK=m.DI.DIHelpers,o=15;var J=mstrmojo.desc(13309,"Pick Tables"),M=mstrmojo.desc(13310,"Select single or multiple tables to import via 'SQL on hadoop'"),AB=mstrmojo.desc(13193,"Build a Query"),E=mstrmojo.desc(13311,"Use a graphical interface to build a 'SQL on hadoop' query to import a table"),AJ=mstrmojo.desc(13194,"Type a Query"),B=mstrmojo.desc(13312,"Paste or write a query script to import a table via 'SQL on Hadoop' or Pig"),R=mstrmojo.desc(13313,"Browse Hadoop Files using MicroStrategy Big Data Engine"),e=mstrmojo.desc(13314,"Import tables by browsing HDFS(Hadoop Distributed File System)"),L=mstrmojo.desc(13315,"Select single or multiple tables to import"),AC=mstrmojo.desc(13316,"Use a graphical interface to build a SQL query to import a table"),F=mstrmojo.desc(13317,"Paste or write a query script to import a table");var AM=[J,AB,AJ];var x=[R,J,AB,AJ];var f=[J,AB,AJ];var AF=[M,E,B];var C=[e,M,E,B];var G=[L,AC,F];var h="fixRefreshDialog",AL={scriptClass:"mstrmojo.Editor",id:h,showTitle:false,zIndex:999,onOpen:function Z(){var AN=mstrApp.getRootController();AN.rootView=this.rootView;AN.fetchCubeInfoEMMA();},onClose:function j(){var AN=mstrApp.getRootController();AN.dialogController.pageZIndex--;},children:[{scriptClass:"mstrmojo.DI.DIRootView",alias:"rootView"}]};function a(){return true;}var V={scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-di-errorBox",draggable:false,showTitle:true,zIndex:99999,showCancel:false,errorMessage:mstrmojo.desc(12579,"Error when running the application"),onmousedown:function(AN){P.stopPropogation(AN.hWin,AN.e);},onOpen:function(){this.helpNode.style.display="none";var AO=this.curtainNode.style;var AP=this;AO.background="black";AO.opacity=0.5;AO.filter="alpha(opacity=50)";this.message.domNode.innerHTML=this.errorMessage+" ";var AN=document.createElement("A");AN.href="#";AN.innerHTML=mstrmojo.desc(189,"Details");AN.className="mstrmojo-di-error-link";D.toggleClass(AP.message.domNode,"off",true);P.attachEvent(AN,"click",function(AQ){var AR=AK.expandNode(AP.detailMessage);D.toggleClass(AP.message.domNode,"off",!AR);D.toggleClass(AN,"on",AR);P.preventDefault(window,AQ);});this.detailMessage.domNode.innerHTML=this.detailErrorMessage;if(this.cancelBtnText){this.cancelButton.set("text",this.cancelBtnText);}if(this.okBtnText){this.okButton.set("text",this.okBtnText);}if(a()){if(this.detailErrorMessage){this.message.domNode.appendChild(AN);}this.detailMessage.set("visible",false);}else{this.detailMessage.set("visible",false);}this.cancelButton.set("visible",this.showCancel);},children:[{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-di-errorMessage off",alias:"message",text:mstrmojo.desc(12580,"Unexpected error occured during an operation. Please try again."),cssDisplay:""},{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-di-errorMessage-detail",alias:"detailMessage",visible:false},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",alias:"cancelButton",text:mstrmojo.desc(221,"Cancel"),cssText:"float:right; margin-left:10px;",onclick:function(){var AN=this.parent;AN.close();if(AN.onCancel){AN.onCancel();}}},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),alias:"okButton",onclick:function(){var AN=this.parent;AN.close();if(AN.onOK){AN.onOK();}}}]};var X="inputNameBox",O={scriptClass:"mstrmojo.Editor",id:X,cssClass:"mstrmojo-di-inputNameBox",draggable:true,showTitle:true,zIndex:999,title:mstrmojo.desc(13329,"Please rename the attribute to unmap it"),noButtonCls:true,text:mstrmojo.desc(13330,"Please rename to unmap this attribute"),buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(13303,"Unmap"),onclick:function(){var AO=this.parent.parent;var AN=AO.input.value;if(AO.onOk){if(AO.onOk(AN)){AO.close();}}else{AO.close();}},bindings:{enabled:function(){return this.parent.parent.input.value.length>0;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var AN=this.parent.parent;AN.close();if(AN.onCancel){AN.onCancel();}}}],children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-inputNameBox-text",bindings:{text:"this.parent.text"}},{scriptClass:"mstrmojo.Box",markupString:'<span id="{@id}" class="{@cssClass}">{@text}</span>',cssClass:"mstrmojo-di-inputNameBox-inputText",cssDisplay:"inline",text:mstrmojo.desc(13010,"New Name:")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-inputNameBox-input",alias:"input",onEnter:function(){var AO=this.parent;var AN=this.value;if(AO.onOk){if(AO.onOk(AN)){AO.close();}}else{AO.close();}}}],onOpen:function(){this.input.set("value",this.curName);this.input.focus();}};var T,U,H,AI,k,K,g,AH,S,I,Y,AE,W,w,q,Q,z,AG,p,l,u;mstrmojo.DI.controller.DIDialogController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDialogController",pageZIndex:0,hasDialog:function b(AP){var AN=false;switch(AP){case AA.dialogType.publishStatusDialog:var AO=mstrmojo.all[k];if(AO){AN=true;}break;case AA.dialogType.cubesList:if(mstrmojo.all[H]){AN=true;}break;}return AN;},getNextZIndex:function A(){var AN=o;o+=2;if(mstrApp.sessionManager){mstrApp.sessionManager.set("zIndex",o+1);}return AN;},getCurrentZIndex:function d(){return o;},centerPageDialog:function(){if(Q&&mstrmojo.all[Q]){mstrmojo.dom.center(mstrmojo.all[Q].editorNode);}},close:function AD(AO){var AN;switch(AO){case AA.dialogType.publishStatusDialog:AN=mstrmojo.all[k];break;case AA.dialogType.cubesList:AN=mstrmojo.all[H];break;case AA.dialogType.errorDialog:AN=mstrmojo.all[AE];break;}if(AN&&AN.visible){AN.close();}},destroyAll:function N(){if(mstrmojo.all[k]){mstrmojo.all[k].destroy();}if(mstrmojo.all[T]){mstrmojo.all[T].destroy();}if(mstrmojo.all[l]){mstrmojo.all[l].destroy();}if(mstrmojo.all[U]){mstrmojo.all[U].destroy();}if(mstrmojo.all[H]){mstrmojo.all[H].destroy();}if(mstrmojo.all[AI]){mstrmojo.all[AI].destroy();}if(mstrmojo.all[g]){mstrmojo.all[g].destroy();}if(mstrmojo.all[K]){mstrmojo.all[K].destroy();}if(mstrmojo.all[AH]){mstrmojo.all[AH].destroy();}if(mstrmojo.all[S]){mstrmojo.all[S].destroy();}if(mstrmojo.all[U]){mstrmojo.all[U].destroy();}if(mstrmojo.all[AG]){mstrmojo.all[AG].destroy();}if(mstrmojo.all[p]){mstrmojo.all[p].destroy();}if(Y){n.forEach(Y,function(AN){if(mstrmojo.all[AN]){mstrmojo.all[AN].destroy();}});}},show:function t(AV,AO){var AT=null,AQ,AR,AY;AO=AO||{};AO.zIndex=this.getNextZIndex();switch(AV){case AA.dialogType.setOAuthParaDialog:AT=mstrmojo.all[z];if(!AT){AT=new mstrmojo.DI.DIOAuthParaEditor();}AT.open(null,AO);z=AT.id;break;case AA.dialogType.setWhiteListDialog:AT=mstrmojo.all[u];if(!AT){AT=new mstrmojo.DI.DIWhiteListEditor();}AT.open(null,AO);u=AT.id;break;case AA.dialogType.fixRefreshErrorDialog:AT=mstrmojo.all[h];if(!AT){AT=mstrmojo.insert(mstrmojo.hash.copy(AO,AL));}AT.open(null,AO);this.pageZIndex++;break;case AA.dialogType.allObjectsViewDialog:AT=mstrmojo.all[U];if(!AT){AT=new mstrmojo.DI.DIAllObjectsView();}AT.open(null,AO);U=AT.id;break;case AA.dialogType.missingColumnsDialog:AT=mstrmojo.all[T];if(!AT){AT=new mstrmojo.DI.ui.dialogs.DIMissingColumnsDialog();}AT.open(null,AO);T=AT.id;break;case AA.dialogType.credentialsDialog:AT=mstrmojo.all[l];if(!AT){AT=new mstrmojo.DI.ui.dialogs.DICredentialsDialog();}AT.open(null,AO);l=AT.id;break;case AA.dialogType.diPageDialog:AT=new mstrmojo.DI.ui.dialogs.DIPageDialog();AT.open(null,AO);Q=AT.id;this.pageZIndex++;break;case AA.dialogType.ddaConfirmDialog:AT=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog();AT.open(null,AO);break;case AA.dialogType.refreshHistoryDialog:AT=mstrmojo.all[AI];if(!AT){AT=new mstrmojo.DI.ui.dialogs.DIRefreshHistoryDialog();}AT.open(null,AO);AI=AT.id;break;case AA.dialogType.alternateSourceValidateDialog:AT=mstrmojo.all[g];if(!AT){AT=new mstrmojo.qb.es.AlternateSourceDialog();}AT.open(null,AO);g=AT.id;break;case AA.dialogType.publishStatusDialog:AT=mstrmojo.all[k];AY="mstrmojo-di-scheduleEMMA ";AQ=mstrApp.getRootController().getModel();switch(AQ.operationMode){case AA.operationMode.create:AY+="createMode";break;case AA.operationMode.refresh:AY+="refreshMode";break;case AA.operationMode.edit:AY+="editMode";break;case AA.operationMode.subscribe:AY+="subscribeMode";break;}if(!AT){AT=new mstrmojo.DI.DIRepublishScheduleEditor({cssClass:AY});}AT.open(null,AO);k=AT.id;break;case AA.dialogType.saveAsDialog:AT=new mstrmojo.DI.ui.dialogs.DISaveAsDialog();this.addDisposable(AT);AT.open(null,AO);break;case AA.dialogType.cubesList:AT=mstrmojo.all[H];if(!AT){AT=new mstrmojo.DI.ui.dialogs.DICubesListDialog();H=AT.id;}AT.open(null,AO);break;case AA.dialogType.refinePage:AR=mstrApp.getRootController();AT=new mstrmojo.Refine.RefinePopupPage({controller:AR});var AP=AR.refineApp.getRefinePanel();AP.slot="refinePanelNode";AT.addChildren([AP]);AT.open(null,AO);break;case AA.dialogType.refineClusteringPage:AT=new mstrmojo.Refine.RefineClusteringDialog();AT.open(null,AO);break;case AA.dialogType.refineExtractDialog:AT=new mstrmojo.Refine.RefineExtractDialog();AT.open(null,AO);break;case AA.dialogType.refineImportDialog:AR=mstrApp.getRootController();AT=new mstrmojo.Refine.RefineImportDialog();AT.open(null,AO);break;case AA.dialogType.multiFormEditor:AT=new mstrmojo.DI.DIMultiFormEditor();AT.open(null,AO);this.addDisposable(AT);break;case AA.dialogType.sheetsSelectionDialog:AT=S&&mstrmojo.all[S];if(!AT){AT=new mstrmojo.DI.ui.dialogs.DISheetsSelectionDialog();}AT.open(null,AO);S=AT.id;break;case AA.dialogType.partitionGroupDialog:AT=I&&mstrmojo.all[I];if(!AT){AT=new mstrmojo.DI.DIPartitionGroupDialog();}AT.open(null,AO);I=AT.id;break;case AA.dialogType.parseDataDialog:var AZ=AO.id;AT=AZ&&mstrmojo.all[AZ];if(!Y){Y=[];}if(!AT){Y.push(AZ);AT=new mstrmojo.DI.ui.dialogs.DIParseDataDialog({id:AZ,tableID:AO.tableID});}AT.open(null,AO);break;case AA.dialogType.errorDialog:AT=AE&&mstrmojo.all[AE];if(!AT){AT=mstrmojo.insert(V);}AT.open(null,AO);AE=AT.id;break;case AA.dialogType.warningDialog:AT=W&&mstrmojo.all[W];if(!AT){AT=mstrmojo.insert(V);}AT.open(null,AO);W=AT.id;break;case AA.dialogType.relationDefineDialog:AT=w&&mstrmojo.all[w];if(!AT){AT=new mstrmojo.DI.DIRelationshipDefineEditor();}AT.open(null,AO);w=AT.id;break;case AA.dialogType.qbImportOptionDialog:AT=q&&mstrmojo.all[q];if(!AT){AT=new mstrmojo.DI.ui.dialogs.DIQBImportOptionDialog();}var AN=[{did:"2",n:AM[1],sub:AF[1]},{did:"3",n:AM[2],sub:AF[2]},{did:"1",n:AM[0],sub:AF[0]}],AW=[{did:"0",n:x[0],sub:C[0]},{did:"2",n:x[2],sub:C[2]},{did:"3",n:x[3],sub:C[3]},{did:"1",n:x[1],sub:C[1]}],AU=[{did:"2",n:f[1],sub:G[1]},{did:"3",n:f[2],sub:G[2]},{did:"1",n:f[0],sub:G[0]}],AS=[{did:"1",n:f[0],sub:G[0]}],AX=[{did:"2",n:f[1],sub:G[1]},{did:"3",n:f[2],sub:G[2]}];if(AO.isContainHadoop&&!mstrApp.isSingleTier){AT.set("items",AW);}else{if(AO.isSAPHanaDDA){AT.set("items",AS);}else{if(AO.isSAPHana){AT.set("items",mstrApp.isSingleTier?AX:AU);}else{if(AO.isODBC){AT.set("items",AU);}else{AT.set("items",AN);}}}}AT.set("srcInfo",AO.srcInfo);AT.open(null,AO);q=AT.id;break;case AA.dialogType.previewRenameDialog:AT=mstrmojo.all[X];if(!AT){AT=mstrmojo.insert(mstrmojo.hash.copy(AO,O));}AT.open(null,AO);this.pageZIndex++;break;case AA.dialogType.mapProjectsAttributeDialog:AT=mstrmojo.all[AG];if(!AT){AT=new mstrmojo.DI.DIProjectsAttribute();}AT.set("attribute",AO.attribute);AT.set("formMaps",AO.formMaps);AT.set("projectAttribute",null);AT.set("projectFormMaps",null);AT.open(null,AO);AT.updateHintText();AG=AT.id;break;case AA.dialogType.mapProjectsAttributeDialog2:AT=new mstrmojo.DI.ui.dialogs.DIMapProjectAttributeDialog(AO);AT.open(null,AO);this.addDisposable(AT);break;case AA.dialogType.objectPicker:AT=new mstrmojo.vi.ui.editors.ObjectPicker(AO);if(AO.oTypes){AT.browsableTypes=n.hash(AO.oTypes);AT.ob.browsableTypes="8,"+AO.oTypes.join(",");}this.addDisposable(AT);AT.open();break;case AA.dialogType.twitterAdvOptDialog:AT=mstrmojo.all[p];if(!AT){AT=new mstrmojo.DI.DITwitterAdvancedOptions(AO);}AT.open(null,AO);break;}if(AT){mstrmojo.dom.center(AT.editorNode);mstrmojo.css.toggleClass(AT.domNode,"mstrmojo-di-popup-dialog",true);AK.reevaluatePopupPosition(AT.editorNode);}return AT;}});var c;mstrmojo.DI.controller.DIDialogController.showErrorDialog=function(AO,AT,AS,AR,AQ){var AN,AP={title:AR||(mstrApp.isSingleTier?mstrmojo.desc(14296,"MicroStrategy Desktop"):mstrmojo.desc(3610,"MicroStrategy Web")),errorMessage:AO,detailErrorMessage:AT||"",onOK:AS||null};if(AQ){mstrmojo.hash.copy(AQ,AP);}AN=c&&mstrmojo.all[c];if(!AN){AN=mstrmojo.insert(V);}AN.open(null,AP);c=AN.id;};mstrmojo.DI.controller.DIDialogController.showConnectionError=function(){var AQ=null;mstrmojo.DI.controller.DIDialogController.hideConnectionError=function(){mstrmojo.all[AQ].close();};var AN=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),AP='<a href="" onclick=" mstrmojo.DI.controller.DIDialogController.hideConnectionError(); delete  mstrmojo.DI.controller.DIDialogController.hideConnectionError; window.FormWrapper.showProxyEditor();return false;">'+mstrmojo.desc(14125,"settings")+"</a>";AN=AN.replace("#",AP)+".";var AO=mstrmojo.insert(V);AO.open(null,{title:mstrmojo.desc(11812,"Notification"),errorMessage:AN,detailErrorMessage:"",onOK:null});AQ=AO.id;};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DIDataService","mstrmojo.DI.DIConstants","mstrmojo.Editor","mstrmojo.dom","mstrmojo.DI.DIObjectBrowser","mstrmojo.Refine.Refine","mstrmojo.Refine.RefinePopupPage","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIRelationshipDefineEditor","mstrmojo.DI.DINavigationController","mstrmojo.DI.controller.DIScheduleController","mstrmojo.DI.controller.DIDialogController","mstrmojo.DI.controller.DIFormsController","mstrmojo.DI.controller.DIPartitionController","mstrmojo.DI.controller.DIOAuthController","mstrmojo.DI.controller.DIMappingMenuController","mstrmojo.DI.controller.DIMappingController","mstrmojo.DI.controller.DIDirectAccessController","mstrmojo.DI.controller.DIHadoopController","mstrmojo.DI.controller.DIPublishController","mstrmojo.DI.controller.ImportController","mstrmojo.DI.controller.DIDocController","mstrmojo.DI.controller.DIRemoteProjectsController","mstrmojo.DI.controller.DIAllObjectsViewController");mstrmojo.requiresDescs(212,218,219,221,422,773,1302,1442,9117,9118,9119,12581,12609,12611,12612,12618,12619,12624,12626,12770,12771,12772,12773,12774,12775,12776,12777,12778,12779,12780,12781,12782,12783,12784,12785,12786,12787,12788,12789,12790,12791,12793,12794,12795,12796,12797,12798,12799,12800,12801,12802,12803,12900,13264,13265,13278,13279,13280,13282,13320,13321,13322,13323,13324,10065,13104,13100,11465,9229,9228,9220,9221,9222,9223,9224,9225,9226,9227,9230,13445,13446,13646,13782,13883,13914,13991,14096,14097,14155,14205,14206,14207,14610,14657,14658,14707);var AZ=mstrmojo.DI.DIConstants,Bd=mstrmojo.hash,BW=mstrmojo.array,o=mstrmojo.func,Aj=mstrmojo.DI.DIExitOptions,Ax=mstrmojo.DI.DIHelpers,h=4000;var A3=AZ.actions;function f(Bx,Bv,Bu,By){var Bw=mstrmojo.array.find(Bu[Bx].sheetsInfo,"index",Bv);if(Bu[Bx].sheetsInfo.length!==0){if(Bw>=0){Bu[Bx].sheetsInfo[Bw].isAutoMapped=true;Bu[Bx].sheetsInfo[Bw].isAutoMapppingSuccessed=By;}}else{Bu[Bx].isAutoMapped=true;Bu[Bx].isAutoMapppingSuccessed=By;}}function j(Bv){var Bw,Bx,B1,B0,Bz,By,Bu;for(Bw in Bv){B1=Bv[Bw].sheetsInfo;B0=Bv[Bw].sourceInfo;Bz=B0&&B0.partition.isPartition;if(this.model.operationMode===AZ.operationMode.edit){if(B0){continue;}}Bu=Bv[Bw].subtype;if(Bu===AZ.sourceSubtype.localFile||Bu===AZ.sourceSubtype.url||Bu===AZ.sourceSubtype.samplefile||Bu===AZ.sourceSubtype.publicData){if(!B1){return false;}if(B1.length===0){if(!Bv[Bw].isAutoMapped){return false;}}By=false;for(Bx=0;Bx<B1.length;Bx++){if(!B1[Bx].isAutoMapped&&B1[Bx].selected&&!Bz){return false;}else{if(B1[Bx].isAutoMapped&&B1[Bx].selected&&Bz){By=true;}}}if(Bz&&!By){return false;}}}return true;}function Bt(Bv){var Bw,Bx,Bz,Bu;var By=false,B0=true;for(Bw in Bv){Bz=Bv[Bw].sheetsInfo;Bu=Bv[Bw].subtype;if(this.model.operationMode===AZ.operationMode.edit){if(Bv[Bw].sourceInfo){continue;}}if(Bu===AZ.sourceSubtype.localFile||Bu===AZ.sourceSubtype.url||Bu===AZ.sourceSubtype.samplefile||Bu===AZ.sourceSubtype.hadoop||Bu===AZ.sourceSubtype.publicData){if(Bz.length===0){if(Bv[Bw].isAutoMapped&&!Bv[Bw].isAutoMapppingSuccessed){By=true;}else{if(Bv[Bw].isAutoMapped&&Bv[Bw].isAutoMapppingSuccessed){B0=false;}}}else{for(Bx=0;Bx<Bz.length;Bx++){if(Bz[Bx].isAutoMapped&&!Bz[Bx].isAutoMapppingSuccessed){By=true;}else{if(Bz[Bx].isAutoMapped&&Bz[Bx].isAutoMapppingSuccessed){B0=false;}}}}}}if(B0){return 3;}if(By){return 2;}return 1;}var Al="sheetsDialog",J={scriptClass:"mstrmojo.Editor",id:Al,cssClass:"mstrmojo-di-sheetsDialog",width:"300px",model:null,onOpen:function(){this.closeNode.style.display="none";this.helpNode.style.display="none";},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button primary-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var Bv=this.parent.parent;var Bu=AZ.requestFlag.preview|AZ.requestFlag.mapping|AZ.requestFlag.transformations|AZ.requestFlag.sourceInfo|AZ.requestFlag.sheets|AZ.requestFlag.anyState;if(mstrApp.isEMMACube){mstrApp.getRootController().editImportedDataEMMA(Bu,Bv.children[0].preShtsPD.selectedIndex,null,null);}else{mstrApp.getRootController().editImportedData(Bu,Bv.children[0].preShtsPD.selectedIndex,null,null);}Bv.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button secondary-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();this.parent.parent.destroy();}}],children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12581,"Select Sheet to Import:")},{scriptClass:"mstrmojo.Pulldown",alias:"preShtsPD",cssClass:"mstrmojo-di-sheetsDialog-pulldown",bindings:{items:function(){var Bu=mstrApp.getRootController().getModel();var Bx=Bu.currentSource.sheets;var Bw=[];var Bv;if(Bx){for(Bv=0;Bv<Bx.length;Bv++){if(Bx[Bv]!=="*"){Bw.push({dssid:Bv,n:Bx[Bv].name});}}}return Bw;},defaultSelection:function(){var Bv=mstrApp.getRootController().getModel();var Bu=0;if(Bv.currentSource.sourceInfo){Bu=mstrmojo.array.find(Bv.currentSource.sheets,"index",Bv.currentSource.sourceInfo.sheetIndex);if(Bu<0){Bu=0;}}return Bu;}}}]}]},Bk="refreshOptions",d={scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-di-refresh-dialog",id:Bk,showTitle:true,zIndex:10000,title:mstrmojo.desc(12770,"Refresh Data Options"),onOpen:function(){var Bu=this.curtainNode.style;Bu.background="black";Bu.opacity=0.5;Bu.filter="alpha(opacity=50)";},children:[{scriptClass:"mstrmojo.RadioList",alias:"radiolist",itemCssClass:"mstrmojo-di-refresh-options",items:[{did:"1",n:mstrmojo.desc(9117,"Replace existing data")},{did:"4",n:mstrmojo.desc(9118,"Update existing data and add new data")},{did:"2",n:mstrmojo.desc(9119,"Keep existing data and add new data")}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),onclick:function(){var Bu=this.parent.parent;Bu.model.refresh_opt=Bu.radiolist.selectedItem.did;if(Bu.onOK){Bu.onOK();}Bu.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var Bu=this.parent.parent;if(Bu.onCancel){Bu.onCancel();}Bu.close();}}]}]};function An(Bx){var Bu=this,Bw=[];function Bv(){window.setTimeout(function(){Bu.dialogController.close(AZ.dialogType.publishStatusDialog);Bu.dialogController.destroyAll();var By=mstrApp.container;if(By){mstrApp.hideProgress(true);mstrApp.container.close();if(By.dataImportCallback){By.dataImportCallback(Bw);}}else{mstrApp.redirectToPage(Aj.getRedirectParams(Aj.pageRedirect.flashVI,Bu.model.cubeID,Bu.model.isDirectDataAccess));}},0);}if(Bx!==undefined){Bw=[{acg:255,did:Bx,st:779,t:3,mngd:Bu.getModel().isManagedCube,isDDA:Bu.getModel().isDirectDataAccess}];}if((Bu.getModel().isManagedCube||mstrApp.isSingleTier)&&Bx!==undefined){Bu.getDocController().getVIDocData({success:function(By){Bw[0]=By&&By.datasets&&By.datasets[Bx];if(Bw[0]){Bw[0].did=Bx;}Bv();}});}else{Bv();}}function Bo(By,Bu){var Bv="";var B0;if(By){B0=this.model.getImportSource(By).getMappingChanges();}else{B0=this.model.currentSource.getMappingChanges();}var Bx,Bz,Bw;if(B0.length>0){Bv+="<mpcs>";}for(Bx=0;Bx<B0.length;Bx++){Bz=B0[Bx];Bv+="<mpc ";for(Bw in Bz){if(Bz[Bw]!==undefined){Bv+=Bw+'="'+Bz[Bw]+'" ';}}if(Bu){Bv+='fg="'+Bu+'" ';}Bv+=" />";}if(B0.length>0){Bv+="</mpcs>";}return Bv;}function Ak(){var Bw=this.model.operationMode;var Bv=this,Bu={success:function(){if(mstrApp.diParams.ImportDatabase&&Bw!==AZ.operationMode.refresh&&Bw!==AZ.operationMode.subscribe&&Bw!==AZ.operationMode.enterCredentials){Bv.getDBMSObjects();}}};if(mstrApp.isSingleTier){this.dataService.getPreferences({success:function(By){var Bx=By&&(By.diConnectorConfig||By.diconnectorConfig);if(Bx){if(typeof Bx==="string"){try{Bx=JSON.parse(Bx);}catch(Bz){Bx=null;}}mstrApp.diParams.connectorConfig=Bx;if(Bx&&(Bx.resourceConfig||Bx.dbRoleConfig)){Bv.getModel().populateSourceListAdminConfig(Bx.resourceConfig,Bx.dbRoleConfig);}}Bv.oAuthController.getExternalSourcesInfo();if(Bw!==AZ.operationMode.refresh&&Bw!==AZ.operationMode.subscribe&&Bw!==AZ.operationMode.enterCredentials){Bv.getDBMSObjects();}}},{fordiConnectorConfig:true});}else{this.getDIProjectSettings(Bu);}if(Bw!==AZ.operationMode.refresh&&Bw!==AZ.operationMode.subscribe&&Bw!==AZ.operationMode.enterCredentials){this.fetchSampleFileList();}if(!mstrApp.isSingleTier){mstrmojo.locales.load(mstrmojo.emptyFn);}if(!mstrApp.isSingleTier&&Bw!==AZ.operationMode.refresh&&Bw!==AZ.operationMode.subscribe&&Bw!==AZ.operationMode.edit){if(!this.model.analysisID){this.getCubeQuota();}this.getShapekeys();}}function AR(Bv){var Bw=Bv.code;var Bx=Bv.message;if(Bw===null||Bw===undefined){Bx=Bv.getResponseHeader("X-MSTR-TaskFailureMsg");}var By=Bx.indexOf("("),Bu=Bx.lastIndexOf(")");if(By>=0&&Bu>By){Bx=Bx.substring(By+1,Bu);}return Bx;}function Bq(Bw){var Bv=this;var By=[];var Bu=[];var Bx=Bv.rootView.currentPage;var Bz="<ul>";mstrmojo.hash.forEach(Bw.files,function(B0){if(B0.failed===true){Bu.push(B0.fileName);Bz+="<li>"+B0.fileName+"<br>"+AR(B0.errRes)||" </li>";}else{By.push(B0.fileName);}});Bz+="</ul>";Bx.set("forceEnable",By.length>0?true:false);if(Bx.setFilesObject){Bx.setFilesObject(Bu);}Bv.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,Bz);}function k(Bx,By){var Bu=[],Bv=mstrApp.getRootController(),Bw=Bv.getModel();BW.forEach(Bx,function(Bz){if(Bw.getImportSource(Bz)){Bu.push(Bz);}});if(Bu.length>0){Bv.removeEMMASourceTable(By,{did:Bu.join()});}else{if(By.success){By.success();}if(By.complete){By.complete();}}}function Au(Bu){Bu=Bu.split("&").join("&amp;");Bu=Bu.split("<").join("&lt;");Bu=Bu.split(">").join("&gt;");Bu=Bu.split("%").join("&#37;");return Bu;}mstrmojo.DI.DIRootController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIRootController",start:function BL(){var Bu=this.rootView;this.dataService=new mstrmojo.DI.DIDataService();this.navigationController=new mstrmojo.DI.DINavigationController();this.dialogController=new mstrmojo.DI.controller.DIDialogController();this.formsController=new mstrmojo.DI.controller.DIFormsController();this.partitionController=new mstrmojo.DI.controller.DIPartitionController();this.mappingMenuController=new mstrmojo.DI.controller.DIMappingMenuController();this.mappingController=new mstrmojo.DI.controller.DIMappingController();this.hadoopController=new mstrmojo.DI.controller.DIHadoopController();this.oAuthController=new mstrmojo.DI.controller.DIOAuthController();this.projectController=new mstrmojo.DI.controller.DIRemoteProjectsController();this.allObjectsController=new mstrmojo.DI.controller.DIAllObjectsViewController();this.ddaController=new mstrmojo.DI.controller.DIDirectAccessController();this.model.initParams(mstrApp.diParams);Bu.render();this.addDisposable(Bu);this.addDisposable(this.model);this.addDisposable(this.dataService);this.addDisposable(this.dialogController);this.addDisposable(this.navigationController);Ak.call(this);},getModel:function Az(){return this.model;},getDataService:function BQ(){return this.dataService;},getMappingMenu:function BM(Bu){return this.mappingMenuController.getMappingMenu(Bu);},forceImport:true,fetchPreview:true,refineApp:null,scheduleController:null,ddaController:null,tablesSrc:{},deleteObject:function BE(Bv,Bu){this.dataService.deleteObject(Bv,Bu);},renameObject:function P(Bv,Bu){this.dataService.renameObject(Bv,Bu);},getScheduleController:function BO(){if(this.scheduleController===null){this.scheduleController=new mstrmojo.DI.controller.DIScheduleController();}return this.scheduleController;},getDDAController:function Bp(){if(this.ddaController===null){this.ddaController=new mstrmojo.DI.controller.DIDirectAccessController();}return this.ddaController;},getDialogController:function A2(){if(this.dialogController===null){this.dialogController=new mstrmojo.DI.controller.DIDialogController();}return this.dialogController;},getImportController:function(){if(!this.importController){this.importController=new mstrmojo.DI.controller.ImportController();}return this.importController;},getDocController:function(){if(!this.docController){this.docController=new mstrmojo.DI.controller.DIDocController();}return this.docController;},showPage:function A8(Bu,Bv,Bx,Bw){if(Bu===AZ.pageType.emmaPreview&&this.dialogController.pageZIndex>0){this.rootView.parent.close();return null;}if(!this.rootView.parent){this.rootView.parent=mstrApp.container;}if(mstrApp.container&&!mstrApp.container.rootView){mstrApp.container.rootView=this.rootView;}if(!Bx){if(this["getNewPageSlotForPage"+Bu]){Bx=this["getNewPageSlotForPage"+Bu]();}else{Bx=this.navigationController.getPageSlot();}}if(Bx.getConfig()&&Bx.getConfig().newPage){this.showDialog(AZ.dialogType.diPageDialog,Bx.getConfig().newPageConfig);}return this.rootView.showPage(Bu,Bv,Bx,Bw);},getNewPageSlotForPage6:function(){var Bx=this,B0=Bx.navigationController.getPageSlot(),Bw=Bx.model,Bv=true,Bz=false,Bu,By=(Bw.operationMode===AZ.operationMode.create);Bd.forEach(Bw.importSources,function(B1){Bv=false;if(B1.databaseType===h&&B1.xdaType===AZ.xdaType.qbSingleTable){Bz=true;return false;}else{Bu=true;}});B0.setConfig({properties:{hasDDAOnlySource:Bv,isFilterDDA:By,isSAPHana:Bz,hasNonSAPHana:Bu}});return B0;},showSheetsSelectionDialog:function AC(By,B6,CG,CC,B5,Bw){var CF;var B9,B7,CD,Bx,CA,B4=[],CB,B1=false,B2=0;var Bz=By||this.model.getAllTableID();for(B9=0;B9<Bz.length;B9++){CD=this.model.importSources[Bz[B9]];Bx=CD.sheetsInfo;CA=[];if(Bx){if(Bx.length>1){B1=true;if(CD.currentIndex&&CD.currentIndex!==-1){B2=BW.find(Bx,"index",CD.currentIndex);if(B2<0){B2=0;}}for(B7=0;B7<Bx.length;B7++){if(B7===B2){CA.push({idx:B7,n:Bx[B7].name,selected:true,title:Bx[B7].name});}else{CA.push({idx:B7,n:Bx[B7].name,title:Bx[B7].name});}}var CH=this.model.importSources[Bz[B9]].sourceInfo;var B0=this.model.importSources[Bz[B9]].currentMapping;if(this.model.operationMode===AZ.operationMode.create){if(B0){CB=CH&&CH.partition.isPartition?true:false;}else{CB=true;}}else{if(CH&&CH.partition.type!==0){CB=true;}else{if(!CH){CB=true;}else{CB=false;}}}B4.push({n:CD.fileName||CG||CD.dbTableName,id:CD.tableID,sheets:CA,multiSelection:CB,defaultSheetsIndex:B2});}}}if(B1){CF={items:B4,onOK:function(){var CI=this;var CP=this.items;var CU=mstrApp.getRootController(),CO=CU.model,CK=CO.importSources,CM=this.items[0].id,CZ=CO.importSources[CM].sourceInfo,CV,CY={},CR,CX,CQ,CT,CJ;var CS=function(Ca){return Ca.selected;};mstrmojo.array.forEach(this.items,function(Ca){Bx=CK[Ca.id].sheetsInfo;mstrmojo.array.forEach(Bx,function(Cc,Cb){if(Ca.sheets[Cb].selected){Cc.selected=true;}else{Cc.selected=false;}});});function CN(Ca){var Cb=[];mstrmojo.hash.forEach(CK[Ca].sheetsInfo,function(Cc){if(Cc.selected){Cb.push({name:Cc.name,index:Cc.index});}});return Cb;}if((CO.operationMode===AZ.operationMode.create&&(CZ&&!CZ.partition.isPartition))||!CZ){for(CV=0;CV<CP.length;CV++){CM=CP[CV].id;CQ=mstrmojo.array.filter(CK[CM].sheetsInfo,CS);CX=CQ.length;CT=CX>1;for(B9=0;B9<CX;B9++){if(CT){CY.behaviorFlags=AZ.behaviorChangeFlag.multiSheet;}CR=CQ[B9].index;if(B9===0){CY.shtIx=CR;CU.autoMappingSourceTable(Bw,CM,CY,CM,B6,B5);}else{CJ=CY.tbid=CM;CU.createEMMASourceTableMultiSheets(CY,CR,CJ,CK[CM].type,CK[CM].subtype,B6,CC);}}CY={};}}else{var CW=CI.filesAndSheets.rightPanel.sheets;var CL;CQ=CO.importSources[CM].sheetsInfo;CX=CQ.length;if(CZ&&CZ.partition&&CZ.partition.isPartition){CL=CW.selected.selectedIndices;for(B9=0;B9<CX;B9++){if(CL[B9]){CQ[B9].selected=true;}else{CQ[B9].selected=false;}}CU.setPartition(CM);}else{CL=CW.selected.selectedIndex;for(B9=0;B9<CX;B9++){if(B9!==CL){CQ[B9].selected=false;}}CQ[CL].selected=true;CR=CQ[CL].index;CY.shtIx=CR;CU.setDataImportInfo(CM,CY,CM,B6);}}CI.destroy();},onBack:function(){var CL=this,CJ=mstrApp.getRootController(),CK=this.items,CM=[],CI=CJ.model.importSources,CN={success:function(CO){CJ.dataService.set("messageID",CO.msgid);BW.forEach(CM,function(CP){delete CI[CP];});CL.unrender();},failure:function(CO){CJ.displayError(mstrmojo.desc(12797,"Cannot remove source table."),false,CO.message||"");}};if(!mstrmojo.all[CC].tableID){BW.forEach(CK,function(CO){CM.push(CO.id);});CJ.removeEMMASourceTable(CN,{did:CM.join()});}else{delete CI[CK[0].id].sheetsInfo;CL.unrender();}}};var Bu=this.model.importSources;if(Bu[Bz[0]].tableIdx>=0){var B8;var Bv,CE={};var B3=mstrApp.getRootController();for(B8=0;B8<B4.length;B8++){Bv=B4[B8].id;CE.shtIx=Bu[Bz[B8]].tableIdx;B3.autoMappingSourceTable(B8===B4.length-1?Bw:null,Bv,CE,Bv,B6,B5);CE={};}}else{this.showDialog(AZ.dialogType.sheetsSelectionDialog,CF);}}},restoreForLaunchingApp:function E(){var Bu=this;var Bw=Bu.model;var By=mstrApp.launchingApp;var Bv=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;var Bx;switch(By){case"QB":Bx=mstrApp.tableID;if(mstrApp.messageID){Bu.dataService.set("messageID",mstrApp.messageID);Bu.getImportedDataEMMA(A3.importSource,Bv);}break;default:if(Bw.operationMode===AZ.operationMode.create){Bu.showPage(AZ.pageType.dataSelection);}else{if(Bw.operationMode===AZ.operationMode.enterCredentials){Bu.showDialog(AZ.dialogType.credentialsDialog,{model:Bw.documentModel});}else{if(mstrApp.isEMMACube&&(Bw.operationMode===AZ.operationMode.refresh)){if(Bu.model.datasets){Bu.showDialog(AZ.dialogType.cubesList,{left:"200px"});}else{this.republishEMMACube();}}else{if(mstrApp.isEMMACube&&(Bw.operationMode===AZ.operationMode.subscribe)){this.republishEMMACube();}else{this.fetchCubeInfoEMMA();}}}}break;}},checkAndShowPrivilegeMsg:function Ap(){var Bu=this,Bw=this.getModel(),Bv=Bw.hasPrivilegesForAllTables(Bd.valarray(Bw.importSources)),Bx=mstrmojo.desc(13914,"You do not have the right privilege to make changes. Contact your administrator."),By;By=function(){Bu.cancelApplication();};if(!Bv){mstrmojo.alert(Bx,By,"",Bu.getDialogController().getNextZIndex());}return Bv;},setModalNodes:function(Bx,Bw,Bv){var Bu=[];Bu=Bu.concat(Bx);if(Bw!==false){Bu.push(this.rootView.footerNode);}return this.rootView.setModalNodes(Bu,Bv);},clearModalNodes:function(){return this.rootView.clearModalNodes();},getCubeInfo:function x(Bv){var Bu=this,Bw={success:function(Bx){var By=mstrmojo.hash.copy(Bu.model.cubesInfo);mstrmojo.hash.forEach(By.cubes.cube,function(Bz){if(Bz.cube_id===Bv){Bz.mdt=Bx[Bv].mdt;}});Bu.model.set("cubesInfo",-1);Bu.model.set("cubesInfo",By);}};this.dataService.getUserDICubeInfo(Bw,{cubeIds:Bv});},getCubeQuota:function AV(Bv,Bu){var Bx=mstrApp,Bw=this;var By={success:function(Bz){if(!Bx.diParams){return ;}if(Bz.cubes&&Bz.cubes.cube){Bz.cubes.cube=[].concat(Bz.cubes.cube);}if(Bz.cubes&&Bz.cubes.doc){Bz.cubes.doc=[].concat(Bz.cubes.doc);}Bw.model.set("cubesInfo",Bz);},failure:function(){Bw.model.set("cubesInfo",-1);}};if(Bv){By=mstrmojo.func.wrapMethods(By,Bv,{});}mstrApp.serverRequestParallel({taskId:"qBuilder.GetQuota"},By);},openMailClient:function BK(Bu){this.getDataService().openMailClient(Bu);},displayCubesInfo:function A9(){var Bw=this,Bv=AZ.dialogType.cubesList;if(this.model.cubesInfo===0){var Bu=mstrmojo.desc(14657,"We are still fetching your cubes information. Please try again later."),Bx=mstrmojo.desc(14658,"Cube Quota Unavailable");this.displayWarning(Bu,Bx);return ;}if(this.model.cubesInfo===-1){return ;}if(Bw.getDialogController().hasDialog(Bv)){Bw.showDialog(Bv,{left:"200px"});}else{Bw.getScheduleController().updateScheduleAndStatus({complete:function(){Bw.showDialog(Bv,{left:"200px"});}});}},openOAuthParaDialog:function A6(Bv,Bu){this.showDialog(AZ.dialogType.setOAuthParaDialog,Bu);},openWhiteListDialog:function AH(Bv,Bu){this.showDialog(AZ.dialogType.setWhiteListDialog,Bu);},getAnalyticsWebProperties:function Bi(Bu){this.oAuthController.getAnalyticsWebProperties(Bu);},getAnalyticsProfiles:function As(Bv,Bu){this.oAuthController.getAnalyticsProfiles(Bv,Bu);},getOAuthSourceReports:function AW(Bw,Bv,By,Bx,Bu){this.oAuthController.getOAuthSourceReports(Bw,Bv,By,Bx,Bu);},oAuthSourceBrowserFunction:function(Bv,Bw,Bx,Bu){this.oAuthController.oAuthSourceBrowserFunction(Bv,Bw,Bx,Bu);},oAuthSourceFetchFunction:function(Bu,Bv){this.oAuthController.oAuthSourceFetchFunction(Bu,Bv);},projectSourceBrowserFunction:function(Bv,Bu,By){var Bw=this;var Bx={success:function(Bz){var B0=Bw.parseProjectSourceFolder(Bz);Bv.set("fileList",B0);},failure:function(){Bv.set("fileList",[]);}};this.getProjectSourceFolderContents(Bx,Bu,By);},getProjectSourceFolderContents:function e(Bx,Bw,Bu){var Bv={objectType:"8,768,769,774,776",dbrid:Bu};if(Bw){Bv.objectId=Bw;}this.dataService.fetchRemoteFolderContents(Bx,Bv);},parseProjectSourceFolder:function A7(Bx){if(!Bx.items){return[];}var Bz=Bx.items,Bv=[],Bu,By,Bw;if(!Bz.length){return[];}for(Bw=0;Bw<Bz.length;Bw++){Bu=Bz[Bw];By={isFolder:false};switch(Bu.t){case 8:By.isFolder=true;if(Bu.isc===true){By.type="shortcut";By.iconFolderClosed="mstrmojo-di-tree-node-icon shortcut-closed";By.iconFolderOpen="mstrmojo-di-tree-node-icon shortcut-open";}else{By.type="folder";}break;case 3:switch(Bu.st){case 768:By.type="grid";break;case 769:By.type="graph";break;case 774:By.type="gridGraph";break;case 776:By.type="cube";break;case 779:By.type="emmaCube";break;}break;}By.n=Bu.n;By.address=Bu.did;By.desc=Bu.desc;Bv.push(By);}return Bv;},getOAuthSourceFolderContents:function Aq(Bu,Bv,Bw){this.oAuthController.getOAuthSourceFolderContents(Bu,Bv,Bw);},oneTierImportFile:function AI(Bv,Bu){this.dataService.oneTierImportFile(Bv,Bu);},launchOneTierBrowser:function B(Bu){this.dataService.launchOneTierBrowser(Bu);},scrapeWiki:function Aw(Bw,Bu){var Bv=this,By={success:function(Bz){mstrApp.hideProgress();if(Bu){Bv.model.populateWikiSuggestions(Bz);}else{Bv.model.populateWikiSearchResults(Bz);}},failure:function(){mstrApp.hideProgress();if(Bu){Bv.model.populateWikiSuggestions([undefined,[]]);}else{Bv.model.populateWikiSearchResults([]);}},canceled:function(){mstrApp.hideProgress();if(Bu){Bv.model.populateWikiSuggestions([undefined,[]]);}else{Bv.model.populateWikiSearchResults([]);}}},Bx={searchString:Bw};if(Bu){Bx.shouldSuggest=true;}this.getDataService().scrapeWiki(By,Bx);},parseOAuthSourceFolder:function u(Bv,Bu){return this.oAuthController.parseOAuthSourceFolder(Bv,Bu);},readyForSubscription:function BB(){mstrmojo.all.mstrOAuthFW.set("oAuthReady",true);},sourceSelected:function q(Bu){if(Bu){this.rootView.showFooter({next:{enabled:true}});this.rootView.showFooter({finish:{enabled:true}});this.forceImport=true;}else{this.rootView.showFooter({next:{enabled:false}});this.rootView.showFooter({finish:{enabled:false}});}},enableFinishButton:function A5(Bu){if(Bu){this.rootView.showFooter({finish:{enabled:true}});}else{this.rootView.showFooter({finish:{enabled:false}});}this.sourceSelected(Bu);},showPreview:function BT(Bu){var Bv=false;if(this.model.operationMode===AZ.operationMode.create){Bv=true;}if(Bu){this.rootView.showFooter({next:{text:mstrmojo.desc(212,"Continue"),enabled:Bv}});}else{this.rootView.showFooter({next:{text:mstrmojo.desc(1302,"Finish"),enabled:Bv}});}},onBackButtonClick:function Av(){this.rootView.currentPage.onBackButtonClick();},onNextButtonClick:function AD(){this.rootView.currentPage.onNextButtonClick();},onSaveButtonClick:function BC(){if(this.rootView.currentPage.onSaveButtonClick){this.rootView.currentPage.onSaveButtonClick();}},onFinishButtonClick:function I(){this.rootView.currentPage.onFinishButtonClick();},onCancelButtonClick:function A1(){this.model.refreshToWrangle=null;if(typeof this.rootView.currentPage.onCancelButtonClick==="function"){if(this.rootView.currentPage.onCancelButtonClick()){return ;}}if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{this.cancelApplication();}},onHelpButtonClick:function O(){mstrApp.showHelpTopic(this.rootView.currentPage.onHelpButtonClick());},gotoOAuthLogin:function F(Bx,Bu,By){if(mstrApp.isSingleTier){if(window.FormWrapper.testInternetConnection()!==0){var Bv=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),Bw='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";Bv=Bv.replace("#",Bw)+".";this.displayError(Bv,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}this.oAuthController.oneTierOAuth(Bx,Bu,By);}else{mstrApp.originUrl=window.location.href;this.oAuthController.getWebServiceURL(Bx,Bu,By);}},setTableIDsForOAuth:function Af(Bu){this.oAuthController.tableIDs=Bu;},oAuthSignOut:function BG(Bu){this.oAuthController.oAuthSignOut(Bu);},launchWranglerDialog:function A(Bv){var Bu=this;var Bw=function Bw(){if(!Bv.projectID){var Bx="<rss><rpo></rpo></rss>";Bu.startRefineStage(Bv.tableID,2,Bx,Bv.sourceInfo.isRefined);}else{Bu.refine(Bv.projectID,Bv.tableID);}};if(Bv.sourceInfo&&Bv.sourceInfo.hasAggFilter){mstrmojo.confirm(mstrmojo.desc(12720,"Previous changes made in aggregation will be discarded. Would you like to continue?"),{confirmBtn:{fn:function(){Bu.dataService.cancelAggFilter({success:function Bx(By){Bu.dataService.set("messageID",By.msgid);Bw();}},{tbid:Bv.tableID});}}});}else{Bw();}},refine:function AQ(Bu,Bv){if(!this.refineApp){this.refineApp=new mstrmojo.Refine.Refine();}this.refineApp.start(this.getModel().refineServerURL,Bu,Bv);this.showDialog(AZ.dialogType.refinePage,{tableID:Bv});},importFile:function Ao(Bv,Bx,B2,B0){if(!this.forceImport){this.showPage(AZ.pageType.preview);return ;}this.fetchPreview=B2;var By=this.model;var Bu=this.model.cubeID;var Bz=this;var Bw={fileName:Bx};if(Bu){Bw.reportid=Bu;}Bw.behaviorFlags=AZ.importBehaviorFlag.reserved;if(this.model.operationMode===AZ.operationMode.refresh||this.model.operationMode===AZ.operationMode.edit){if(mstrApp.isCloudPro){Bw.behaviorFlags=AZ.importBehaviorFlag.newColumnsSilent|AZ.importBehaviorFlag.dataTypeSilent;}}var B1={success:function(B6){var B3=AZ.requestFlag.anyState|AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.sheets|AZ.requestFlag.preview|AZ.requestFlag.transformations,B5=B2?0:-1;var B4=B6.msg_id||B6.content.mst_id;if(B0){By.importSources.tableID=B4;return ;}Bz.dataService.set("messageID",B4);mstrApp.hideProgress();Bz.getImportedData(A3.refine,B3,B5,undefined,0);},failure:function(B3){mstrApp.hideProgress();Bz.displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,B3&&B3.message);},progress:function(B4,B5){if(B4.lengthComputable){var B3=(B4.loaded/B4.total);mstrApp.setProgressParams(B3,B5);}}};Bz.dataService.importFile(Bv,B1,Bw);},importFileEMMA:function Bc(By,B0,Bu,Bx,Bw,Bz,Bv){this.getImportController().importFile(By,B0,Bu,Bx,Bw,Bz,Bv);},resetAppforRepublish:function Am(Bu){this.model.initParams({ReportId:Bu.cubeID,CubeName:Bu.cubeName,StatusCode:AZ.statusCode.republish,AnalysisId:undefined,datasets:null});this.republishEMMACube();},resetAppforImport:function AP(){this.model.resetImportSource();this.model.initParams({ReportId:undefined,CubeName:undefined,StatusCode:undefined,AnalysisId:undefined,datasets:null});this.dataService.messageID=undefined;},browseURLPath:function AJ(Bv,By){var Bu=this,Bw={};if(Bv===""){Bu.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(Bv.substring(0,1)==="\\"){Bv=Bv.replace(/\\\\/g,"file://");Bv=Bv.replace(/\\/g,"/");}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}Bv=Bv.trim();if(Bv.charAt(Bv.length-1)!=="/"){Bv=Bv+"/";}Bw.urlPath=Bv;var Bx={success:function(Bz){if(Bz.mi.ftree===""){Bu.displayError(mstrmojo.desc(12774,"We could not find anything. Please verify that you have entered a valid network path."),false);}if(By.getObjectBrowser){By.getObjectBrowser().set("fileList",Bu.parseURLFolders(Bz));}else{By.set("fileList",Bu.parseURLFolders(Bz));}},failure:function(Bz){Bu.displayError(mstrmojo.desc(12775,"Uh-Oh, Error fetching the list of files for the given network path: ")+Bz.message,false);}};this.dataService.getOAuthSourceReports(Bx,Bw);},urlBrowserFunction:function(Bu){this.browseURLPath(Bu.data.address,Bu.data.browser);},executeCommand:function Bm(Bu,Bv){switch(Bu){case"loginToProxy":this.loginToProxy(Bv);break;case"loginToWebserver":this.loginToWebserver(Bv);break;case"loginToProject":this.loginToProject(Bv);break;case"shutDownDesktop":this.shutDownDesktop(Bv);break;default:break;}},loginToWebserver:function BN(Bu){mstrmojo.onetier.controllers.RootController.prototype.loginToWebserver.call(this,Bu);},loginToProxy:function t(Bu){mstrmojo.onetier.controllers.RootController.prototype.loginToProxy.call(this,Bu);},loginToProject:function AX(Bu){mstrmojo.onetier.controllers.RootController.prototype.loginToProject.call(this,Bu);},shutDownDesktop:function U(Bu){mstrmojo.onetier.controllers.RootController.prototype.shutDownDesktop.call(this,Bu);},parseURLFolders:function BZ(By){var Bv=[];var B0=By.mi.ftree.fd?[].concat(By.mi.ftree.fd):[];var Bu=By.mi.ftree.fl?[].concat(By.mi.ftree.fl):[];var Bx,B1,Bw,Bz;for(Bw=0;Bw<B0.length;Bw++){Bx=B0[Bw];Bz={isFolder:true};Bz.n=(Bx.n===null?"null":Bx.n.toString());Bz.desc=Bx.des;Bz.address=Bx.address;Bv.push(Bz);}for(Bw=0;Bw<Bu.length;Bw++){B1=Bu[Bw];Bz={isFolder:false};Bz.n=(B1.n===null?"null":B1.n.toString());Bz.address=B1.address;Bz.type=B1.mimetype;Bz.desc=B1.des;Bz.size=B1.sz;Bv.push(Bz);}return Bv;},importURL:function Br(Bw,Bv){if(!this.forceImport){this.showPage(AZ.pageType.preview);return ;}this.fetchPreview=Bv;var By={url:Au(Bw.trim())};var Bx=this.model.cubeID;if(Bx){By.reportid=Bx;}By.behaviorFlags=AZ.importBehaviorFlag.reserved;if(this.model.operationMode===AZ.operationMode.refresh||this.model.operationMode===AZ.operationMode.edit){if(mstrApp.isCloudPro){By.behaviorFlags=AZ.importBehaviorFlag.newColumnsSilent|AZ.importBehaviorFlag.dataTypeSilent;}}var Bu=this;var Bz={success:function(B1){var B2=AZ.requestFlag.sourceInfo|AZ.requestFlag.sheets|AZ.requestFlag.preview|AZ.requestFlag.mapping|AZ.requestFlag.transformations,B0=Bu.fetchPreview?0:-1;Bu.dataService.set("messageID",B1.msg_id);Bu.getImportedData(A3.importSource,B2,B0);},failure:function(B0){Bu.displayError(mstrmojo.desc(12776,"Error importing the URL. Please check the URL being imported"),false,B0&&B0.message);}};this.dataService.importURL(Bz,By);},importURLEMMA:function N(Bu,Bw,Bv,Bz,By,B0,Bx){this.getImportController().importURL(Bu,Bw,Bv,Bz,By,B0,Bx);},createEMMASourceTableMultiSheets:function D(Bv,B2,B1,By,B0,Bw,Bu){var Bx=this;if(!Bv){Bv={};}Bv.xt=AZ.xdaType.dataImport;Bv.dict=Ax.getBackendSourceType(B0);var Bz={success:function(B4){var B5=B4.tbid;Bv.shtIx=B2;Bx.model.createImportSource(By,B0,B5);var B3=Bx.model.importSources[B5];mstrmojo.DI.DIHelpers.setTablesrc(Bx,Bu,B5);B3.srcTableID=B1;B3.sheetsInfo=Bx.model.importSources[B1].sheetsInfo;Bx.autoMappingSourceTable(null,B5,Bv,B1,Bw);},failure:function(B3){Bx.displayError(mstrmojo.desc(12777,"Error creating EMMA Source Table"),false,B3&&B3.message);}};this.dataService.createEMMASourceTable(Bz,Bv);},autoMappingSourceTable:function AS(B6,B5,By,B7,Bz,B0){var B3=this;var B8=By.shtIx;var B2=B3.model;var Bx=B2.importSources;var B4=Bx[B5];var Bv=Bx[B5].sourceInfo;var Bu;var Bw=[];if(B5){if(!By){By={};}By.tbid=B5;delete By.xt;}if(B4.fileName&&Ax.strStartsWith(B4.fileName,"hdfs://")){By.dbRoleID=B3.hadoopController.dbRoleID;By.isUrl=true;}if(B4&&(B4.subtype===AZ.sourceSubtype.url||B4.subtype===AZ.sourceSubtype.samplefile||B4.subtype===AZ.sourceSubtype.publicData)){By.isUrl=true;if(B4.xdaType===AZ.xdaType.excel){By.url=B4.fileName||B4.sourceInfo.url;}}if(Bv){By.behaviorFlags=AZ.behaviorChangeFlag.refreshData;}var B1={success:function(){f(B7,B8,Bx,true);if(Bz!==AZ.actions.refreshData&&(B2.operationMode===AZ.operationMode.create||(B2.operationMode!==AZ.operationMode.create&&!Bv))){var B9=j.call(B3,Bx);if(B9){Bu=Bt.call(B3,Bx);if(B2.operationMode===AZ.operationMode.create){if(Bu===1){for(var CA in Bx){Bw.push(CA);}B3.detectRelationshipSourceTable(null,Bw,Bz);}}else{if(Bu===1){for(var CA in Bx){if(!Bx[CA].sourceInfo){Bw.push(CA);}}B3.detectRelationshipSourceTable(null,Bw,Bz);}}}}else{B3.detectRelationshipSourceTable(null,[B5],Bz);}if(B6&&B6.success&&Bu!==1){B6.success();}},failure:function(CA){var B9;f(B7,B8,Bx,false);if(B5&&B0){mstrmojo.hash.forEach(B0.files,function(CC,CB){if(CC.tableID===B5){B9=CB;return false;}return true;});}if(B9!==undefined){B0.files[B9].failed=true;B0.files[B9].errRes=CA;B0.idx=B9;}if(B6&&B6.failure){B6.failure();}}};B3.dataService.autoMappingSourceTable(B1,By);},setDataImportInfo:function Ag(Bw,By,Bv,Bx){var Bu=this;By.tbid=Bw;var Bz={success:function(){Bu.autoMappingSourceTable(null,Bw,By,Bw,Bx);},failure:function(B0){Bu.displayError(mstrmojo.desc(12779,"Encounter error when set data import info!"),false,B0&&B0.message);}};Bu.dataService.setDataImportInfo(Bz,By);},setPartition:function AL(B0,B2){var B3=this,Bv=B3.model.importSources[B0],Bx=0,Bw=mstrmojo.desc(14707,"Do you want to group these sheets into a single partition table?");if(Bv.xdaType===AZ.xdaType.excel){var Bu=Bv.sheetsInfo;var By,Bz=Bu.length;var B4=[],B1=[];for(By=0;By<Bz;By++){if(Bu[By].selected){Bx++;B4.push(Bu[By].name);B1.push(Bu[By].index);}}if(Bx>1){mstrmojo.confirm(Bw,{confirmBtn:{fn:function(){B3.partitionController.setPartitionExcel(B0,B4,B1);}}});}else{B3.partitionController.setPartitionExcel(B0,B4,B1);}}else{if(Bv.xdaType===AZ.xdaType.text){this.partitionController.setPartitionURL(B0,B2);}}},setDataImportInfoURL:function Bf(Bu,Bz,Bw){var Bv=this;var Bx=Bv.model;Bz.tbid=Bw;var By=Bx.importSources[Bw];if(By.fileName&&Ax.strStartsWith(By.fileName,"hdfs://")){Bz.dbRoleID=Bv.hadoopController.dbRoleID;}var B0={success:function(B1){if(Bx.operationMode===AZ.operationMode.edit){var B2=Bx.getImportSource(Bw);B2.fileName=Bz.url;Bv.dataService.editEMMASourceTable(Bu,{did:Bw,tp:AZ.cubeRefreshType.replaceTable,exef:AZ.tableStatsExecutionAction.forceExecution,bin:1});}else{if(Bx.currentSource){Bx.currentSource.fileName=Bz.url;}Bu.success(B1);}},failure:function(B1){if(Bu.failure){Bu.failure(B1);}Bv.displayError(mstrmojo.desc(12779,"Encounter error when set data import info!"),false,B1&&B1.message);Bv.sourceSelected(false);}};Bv.dataService.setDataImportInfo(B0,Bz);},autoDetectPartitionGroups:function Ae(B0,By){var Bw=this,Bx=this.model,Bv=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship|AZ.requestFlag.stateInfo,Bz,Bu;Bz={previewflag:Bv};if(By!==undefined){Bz.sheetIndex=By;}if(!Bw.dataService.messageID&&Bx.cubeID){Bz.reportid=Bx.cubeID;}Bu={success:function(B2){Bx.populateEMMA(B2,Bv);var B1,B4,B5=Bw.partitionController,B3={onOK:function(){B0.onOK();},onCancel:function(){B0.onCancel(B2);}};B1=Bx.getAllTableID();B4=Bx.detectPartitionGroups(B1);if(B4.length>0&&!B5.isSamePartitionGroups(B4,Bx.partitionGroups)){Bx.partitionGroups=B4;B5.openPartitionGroupDialog(B4,B3);return ;}B3.onCancel();},failure:function(B1){Bw.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}};Bw.dataService.getImportedData(Bu,Bz);},detectRelationshipSourceTable:function G(B0,By,Bz){var Bv=this,Bx=0,Bw;var Bu={success:function(){Bx++;if(Bx>=Bw){var B1=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship|AZ.requestFlag.stateInfo,B3,B2;if(Bz===A3.refreshData){Bz=Bz||AZ.actions.importSource;Bv.model.importSources[Bv.model.currentSource.key].invalidPreview();}B3={onOK:function(){Bv.getImportedDataEMMA(Bz,B1);},onCancel:function(B4){Bv.getImportedDataEMMA(Bz,B1,undefined,undefined,undefined,undefined,undefined,B4);}};B2=Bv.getModel().getAllTableID();if(!Bv.rootView.currentPage.tableID&&!Bv.model.isDirectDataAccess&&B2.length>=2){Bv.autoDetectPartitionGroups(B3);}else{Bv.getImportedDataEMMA(Bz,B1);}}},failure:function(B1){Bq.call(Bv,B1);}};Bw=By.length;Bz=Bz||AZ.actions.importSource;if(By.length>0){BW.forEach(By,function(B1){Bv.dataService.detectRelationshipSourceTable(Bu,{did:B1});});}},importOAuthReport:function AT(Bz,Bu,By,B1,B4,B0){var B3=this.model.externalSources[Bz];var Bw=this;var Bx=AZ.requestFlag.sourceInfo|AZ.requestFlag.preview|AZ.requestFlag.mapping|AZ.requestFlag.anyState;if(Bz===AZ.sourceType.googleDrive||Bz===AZ.sourceType.dropbox){Bx=Bx|AZ.requestFlag.sheets|AZ.requestFlag.transformations;}this.fetchPreview=B4;var Bv=B3.getSourceParams();Bv.reportAddress=B1;Bv.reportDesc=By;Bv.reportMimetype=B0;Bv.reportName=Bu;if(this.model.cubeID){Bv.cubeID=this.model.cubeID;}Bv.behaviorFlags=AZ.importBehaviorFlag.reserved;if(this.model.operationMode===AZ.operationMode.refresh||this.model.operationMode===AZ.operationMode.edit){if(mstrApp.isCloudPro){Bv.behaviorFlags=AZ.importBehaviorFlag.newColumnsSilent|AZ.importBehaviorFlag.dataTypeSilent;}}var B2={success:function(B5){Bw.dataService.set("messageID",B5.xmlAPIResponse.mid);Bw.getImportedData(A3.importSource,Bx);},failure:function(){Bw.displayError(mstrmojo.desc(12611,"Error importing the selected report."));}};this.dataService.importOAuthReport(B2,Bv);},importMultiOAuthReports:function(B3,B2,B8,B5,Bx,B7,B4){var Bz=this,B1=Bz.rootView.currentPage,By,Bu=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;var Bw={success:function(){var B9;if(B4){B9=Bz.model.getAllTableID();Bz.tablesSrc[B4]=Ax.findNewElements(By,B9);}}};var B6={success:function(){Bx=Bx||AZ.actions.importSource;Bz.getImportedDataEMMA(Bx,Bu,undefined,undefined,undefined,0,Bw);},failure:function(CF){var CD=true,CH="",CA="",CB,CC=[],B9,CG=true;if(B3===AZ.sourceType.twitter||B3===AZ.sourceType.facebook){if(CF.status){for(CB=0;CB<CF.status.length;CB++){var CE=CF.status[CB].tableID;if(CE){CC.push(CE);}}if(CC.length>0){Bz.getImportController().removeMultipleSourceTables(CC);}}}switch(B3){case AZ.sourceType.twitter:CA=mstrmojo.desc(12780,"Error importing results from Twitter.");break;case AZ.sourceType.facebook:CA=mstrmojo.desc(12781,"Error importing results from Facebook.");break;default:CA=mstrmojo.desc(12782,"Error importing following reports. Please check the files or delete them.");}if(CD){if(CF.reports&&CF.status&&CF.reports.length===CF.status.length&&CF.reports.length>0){CH="<ul>";BW.forEach(CF.reports,function(CJ,CI){if(CF.status[CI].success===false){CH+="<li>"+CJ.n+"<br>"+CF.status[CI].errMsg||" </li>";}else{CG=false;}});CH+="</ul>";}else{if(CF.status&&CF.status.errMsg){CH=CF.status.errMsg;}}if(B1.handleImportError){CD=B1.handleImportError(CF.reports,CF.status,CG);}if(B3===AZ.sourceType.twitter||B3===AZ.sourceType.facebook||CG){Bz.displayError(CA,false,CH);}else{B9={detailErrorMessage:CH,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:mstrmojo.emptyFn};Bz.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),null,function(){Bx=Bx||AZ.actions.importSource;Bz.getImportedDataEMMA(Bx,Bu,undefined,undefined,undefined,0,Bw);},B9);}}}};var B0={success:function(){if(B3===AZ.sourceType.googleDrive||B3===AZ.sourceType.dropbox){Bz.getImportController().importMultiOAuthFileReports(B3,B7,B2,B6);}else{if(B3===AZ.sourceType.facebook){Bz.getImportController().importMultiFBReports(B3,B7,B2,B6);}else{Bz.getImportController().importMultiOAuthReports(B3,B7,B2,B6);}}},failure:function(B9){Bz.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,B9.message||"");}};var Bv={success:function(){Bz.tablesSrc[B4]=[];By=Bz.model.getAllTableID();if(B5){Bz.createNewReportInstance(B0);}else{B0.success();}}};if(B4){k(Bz.tablesSrc[B4],Bv);}else{Bv.success();}},refreshDataOAuthReport:function(Bx,B1,Bw,Bv,B0){var Bu=this,Bz=Bu.getModel().getImportSource(Bw);var By={success:function(){var B2=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;B0=B0||AZ.actions.importSource;Bz.invalidPreview();Bu.getImportedDataEMMA(B0,B2);},failure:function(B2){Bu.displayError(mstrmojo.desc(12784,"Error importing the report."),false,B2.message);}};if(Bx===AZ.sourceType.googleDrive||Bx===AZ.sourceType.dropbox){Bu.getImportController().refreshDataOAuthFileReport(Bx,B1,Bw,Bv,Bu.getModel().operationMode,By);}else{Bu.getImportController().refreshDataOAuthReport(Bx,B1,Bw,Bv,Bu.getModel().operationMode,By);}},refreshMultiOAuthReports:function(B0,B1,Bz,Bx){var By=this,Bw=0;var Bv={success:function(){By.getModel().getImportSource(Bz[Bw].tableID).invalidPreview();Bw++;if(Bw>=Bz.length){B2.success();}else{Bu(Bz[Bw],Bv);}},failure:function(B3){B2.failure(B3);}};var B2={success:function(){var B3=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;Bx=Bx||AZ.actions.importSource;By.getImportedDataEMMA(Bx,B3);},failure:function(B3){By.displayError(mstrmojo.desc(12785,"Error refreshing the report(s)."),false,B3&&B3.message);}};function Bu(B3,B4){if(B0===AZ.sourceType.googleDrive||B0===AZ.sourceType.dropbox){By.getImportController().refreshDataOAuthFileReport(B0,B1,B3.tableID,B3,By.getModel().operationMode,B4);}else{By.getImportController().refreshDataOAuthReport(B0,B1,B3.tableID,B3,By.getModel().operationMode,B4);}}if(Bz.length<=0){B2.failure();}Bu(Bz[0],Bv);},importClipboard:function(Bz,Bx,By,B0){var Bu=this,B1;var Bw={success:function(){Bu.getImportController().importClipboard({uploader:Bz},{success:function(){var B3=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship,B4;By=By||AZ.actions.importSource;var B2={success:function(){if(B0){B4=Bu.model.getAllTableID();Bu.tablesSrc[B0]=Ax.findNewElements(B1,B4);}if(By===AZ.actions.importSource){Bz.destroy();}}};Bu.getImportedDataEMMA(By,B3,undefined,undefined,undefined,0,B2);},failure:function(B2){Bu.displayError(mstrmojo.desc(12609,"Error in importing the file. Please check the file being imported."),false,B2.message);}});},failure:function(B2){Bu.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,B2.message||"");}};var Bv={success:function(){Bu.tablesSrc[B0]=[];B1=Bu.model.getAllTableID();if(Bx){Bu.createNewReportInstance(Bw);}else{Bw.success();}}};if(B0){k(Bu.tablesSrc[B0],Bv);}else{Bv.success();}},refreshDataClipboard:function(Bv,Bz,By){var Bu=this,Bx=Bu.getModel().getImportSource(Bv);var Bw={success:function(){var B0=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;By=By||AZ.actions.importSource;Bx.invalidPreview();Bu.getImportedDataEMMA(By,B0);},failure:function(B0){Bu.displayError(mstrmojo.desc(12784,"Error importing the report."),false,B0.message);}};Bu.getImportController().refreshDataClipboard(Bv,{uploader:Bz},Bu.getModel().operationMode,Bw);},getImportedData:function n(Bx,Bz,Bw,By){var B0={previewflag:Bz};if(By!==undefined){B0.poll=By;}if(Bw>=0){B0.sheetIndex=Bw;}if(Bx===A3.refine){B0.refine=32;}var Bv=this;var Bu=this.model;var B1={success:function(B2){if(Bx===A3.refine){Bv.refine(B2.rpid);return ;}var B3;if(Bx===A3.importSource||Bx===A3.changeSheet){if(Bu.currentSource){Bu.currentSource.reset();}Bu.populate(B2,Bz);if(Bu.operationMode!==AZ.operationMode.create){if(Bu.currentSource.sheets&&Bu.currentSource.sheets.length>1){B3=mstrmojo.all[Al];if(!B3){B3=mstrmojo.insert(J);B3.model=Bu;B3.open();}else{if(!Bv.fetchPreview){Bv.saveAndPublish();return ;}}}else{if(!Bv.fetchPreview){Bv.saveAndPublish();return ;}}}}if(Bx===A3.importSource||Bx===A3.changeSheet){if(Bv.fetchPreview){Bv.forceImport=false;Bv.showPage(AZ.pageType.preview);}if(Bu.currentSource){Bu.currentSource.reset();}if(B3){B3.destroy();}}var B4=Bu.populate(B2,Bz);if(Bx===A3.importSource){if((B4&AZ.requestFlag.preview)!==AZ.requestFlag.preview){return ;}}if((B4&AZ.requestFlag.mapping)!==AZ.requestFlag.mapping){Bv.getImportedData(Bx,Bz,Bw,false);return ;}},failure:function(B4){var B3=parseInt(B4.getResponseHeader("X-MSTR-TaskErrorCode"),10);var B2=AZ.statusCode;if(B3===B2.mappingError||B3===B2.xformsError||B3===B2.obtainSource){Bv.getImportedData(Bx,Bz,Bw,false);}else{if(B3===AZ.backendError.fileVersionError){Bv.displayError(mstrmojo.desc(12612,"Excel 5.0/7.0 files are not supported. Save the file to Excel version 97/2000/XP/2003 or higher."));}else{if(B3===AZ.backendError.salesforceUnsavedReport){Bv.displayError(mstrmojo.desc(12786,"Cannot upload data because the Salesforce report Active Accounts has not been saved. Please save the report and try again!"));}else{if(B3===AZ.backendError.maxSizeExceeded){Bv.displayError(mstrmojo.desc(12787,"The maximum file size for files is #### MB.").replace("####",mstrApp.diParams.UploadSizeLimit));}else{Bv.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}}}}}};this.dataService.getImportedData(B1,B0);},getAttributeGroupInfo:function z(Bw){var Bx={tableID:Bw,browsetype:32};var Bv=this;var Bu=Bv.model;var By={success:function(Bz){Bu.populateAttributeGroup(Bz,Bw);},failure:function(Bz){Bv.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}};this.dataService.getImportedData(By,Bx);},getShapekeys:function AO(){var Bv=this.getModel();var Bu={success:function(Bz){if(Bz&&Bz.ShapeFileMaps&&Bz.ShapeFileMaps.ShapeFileMap){var B0=Bz.ShapeFileMaps.ShapeFileMap,Bx=[],B1,By,Bw=function Bw(B4,B3){var B2=B4.n.toLowerCase();var B6=B3.n.toLowerCase();var B5;if(B2<B6){B5=-1;}else{if(B2>B6){B5=1;}else{B5=0;}}return B5;};mstrmojo.array.forEach(B0,function(B2){B1=B2.descWeb;By=B1?mstrmojo.desc(B1.slice(8)):mstrmojo.string.decodeHtmlString(B2.name).replace(/&apos;/g,"'");Bx.push({did:B2.shapeKey,n:By});});Bx.sort(Bw);Bv.shapeKeys=Bx;}}};this.dataService.getShapeKeys(Bu,{fileNumber:2});},getSheetsInfo:function AB(Bv,B0,B1,Bx,By){var Bw={tableID:B0,previewflag:B1};var Bz=this;var Bu=Bz.model;var B2={success:function(B6){var B4=function(CA){if(CA==="*"){return false;}return true;};var B8=B6.datap.shts,B3=mstrmojo.array.filter(B8,B4);var B7;var B5=false;for(B7=0;B7<B8.length;B7++){if(B8[B7]!=="*"){B5=true;break;}}if(!B5){Bz.displayError(mstrmojo.desc(14205,"There is no sheets information of the importing file. Please check the file being imported."));return ;}if(B3.length<2){if((B1&AZ.requestFlag.sheets)===AZ.requestFlag.sheets){Bu.importSources[B0].populateSheets(B6.datap.shts,B7);}var B9={shtIx:B7};Bz.autoMappingSourceTable(Bv,B0,B9,B0,Bx,By);}else{if((B1&AZ.requestFlag.sheets)===AZ.requestFlag.sheets){Bu.importSources[B0].populateSheets(B6.datap.shts,B7);}if(Bv){Bv.success();}}},failure:function(B3){By.files[By.idx].failed=true;By.files[By.idx].errRes=B3;if(Bv){Bv.failure();}}};this.dataService.getImportedData(B2,Bw);},getImportedDataEMMA:function X(B0,Bz,B6,Bv,B4,Bu,Bx,B1){var B2=this,Bw=B2.getModel(),B3;var By={previewflag:Bz};if(Bv!==undefined){By.poll=Bv;}if(B6>=0){By.sheetIndex=B6;}if(B4){By.tableID=B4;}if(!this.dataService.messageID&&this.model.cubeID){By.reportid=this.model.cubeID;}var B5={success:function(CF){var B7,CB,CG,B8,CD,B9,CA=null,CE,CC;if(B0===A3.refine){B7=Bw.importSources[B4];B7.projectID=CF.datap.srce.rimp.rpid;B2.refine(B7.projectID,B4);return ;}if(B0===A3.getFlatPreview){Bw.populateEMMA(CF,Bz,B4,true);B2.raiseModelEvent({name:"FlatPreviewFetched"});return ;}CC=Bw.populateEMMA(CF,Bz,B4,B0===A3.quickPreview);if(B0===A3.savePublish){if(B2.dialogController.pageZIndex>0){B2.rootView.parent.close();}window.setTimeout(function(){B2.saveAndPublish();},0);return ;}for(CB=0;CB<CF.datap.length;CB++){CD=CF.datap[CB].state;if(CD&&CD.errc===AZ.backendError.refineApplyError){B2.displayError(CD.emsg);}}CG=Bw.getAllTableID();CE=B2.model.currentSource;if(B0===A3.importSource){CA=CG[B2.dialogController.pageZIndex>0?CG.length-1:0];}else{if(B0===A3.none||B0===A3.refreshData){if(CE&&BW.indexOf(CG,CE.tableID)>=0){CA=CE.tableID;}else{if(CG.length>0){if(B2.dialogController.pageZIndex===0){CA=CG[0];}}}}}B8=Bz|AZ.requestFlag.preview|AZ.requestFlag.transformations;if(B4===undefined&&CG.length>0&&B0===A3.quickPreview&&CA!==CG[CG.length-1]){B7=Bw.getImportSource(CG[CG.length-1]);B9=false;if(B7&&B7.currentTransformations&&B7.currentTransformations.xtab&&B7.currentTransformations.xtab.isCrosstab){B9=!!B7.currentMapping&&!!B7.transformedPreview;}else{if(B7){B9=!!B7.currentMapping&&!!B7.currentPreview&&!(B0===A3.quickPreview);}}if(!B9){if(B7&&B7.currentTransformations&&B7.currentTransformations.xtab&&B7.currentTransformations.xtab.isCrosstab){B8=B8&(~AZ.requestFlag.preview);B8|=AZ.requestFlag.transformedPreview;}else{B8=B8&(~AZ.requestFlag.transformedPreview);B8|=AZ.requestFlag.preview;}if(B7.type===AZ.sourceType.querybuilder){B8=B8&(~AZ.requestFlag.sheets);B8=B8&(~AZ.requestFlag.transformations);B8=B8&(~AZ.requestFlag.sourceInfo);}if(B7.type===AZ.sourceType.twitter){B8=B8&(~AZ.requestFlag.sheets);}if(B7.subtype===AZ.sourceSubtype.googleBigQuerySingleTable){B8=775;}if(B7.databaseType===h&&B7.xdaType===AZ.xdaType.qbSingleTable){B8=B8&(~AZ.requestFlag.preview);}B2.getImportedDataEMMA(B0,B8,B6,Bv,CG[CG.length-1]);return ;}}if(B0===A3.importSource||B0===A3.changeSheet||B0===A3.refreshData){B2.forceImport=false;B2.showPage(AZ.pageType.emmaPreview,null);}if(CA){window.setTimeout(function(){B2.selectSourceTable(CA);},0);}if(B0===A3.quickPreview){B2.raiseModelEvent({name:AZ.dataEvents.DATA_PREVIEW_EVENT,data:B4});return ;}if(B0===A3.transform){Bw.currentSource.currentTransformations.xtab.set("isCrosstab",true);B2.raiseModelEvent({name:"changeToXtab"});}if(B0===A3.importSource||B0===A3.refreshData){if((CC&AZ.requestFlag.preview)!==AZ.requestFlag.preview){return ;}}if((CC&AZ.requestFlag.mapping)!==AZ.requestFlag.mapping){B2.getImportedDataEMMA(B0,Bz,B6,false);return ;}},failure:function(B9){var B8=parseInt(B9.code||B9.getResponseHeader("X-MSTR-TaskErrorCode"),10),B7=AZ.statusCode;if(B8===B7.mappingError||B8===B7.xformsError||B8===B7.obtainSource){B2.getImportedDataEMMA(B0,Bz,B6,false);}else{var CA;if(B4){CA=B2.getImportController().handleImportError(B9,Bw.importSources[B4].dbTableName);}B2.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CA);}}};B3=mstrmojo.func.wrapMethods(B5,Bx,{});if(B1===undefined){this.dataService.getImportedData(B3,By);}else{B3.success(B1);}},fetchCubeInfo:function AM(){var By=AZ.requestFlag.sourceInfo|AZ.requestFlag.mapping|AZ.requestFlag.anyState,Bx=this.model,Bw=this,Bv=this.rootView,Bu=mstrApp.diParams.StatusCode;if(Bu===AZ.statusCode.xformsError||Bu===AZ.statusCode.mappingError){By=AZ.requestFlag.sourceInfo|AZ.requestFlag.mapping|AZ.requestFlag.preview|AZ.requestFlag.sheets|AZ.requestFlag.transformations|AZ.requestFlag.anyState;}var B0={success:function(B1){if(mstrApp.isEMMACube){Bx.populateEMMA(B1,By);}else{Bx.populate(B1,By);}switch(mstrApp.diParams.StatusCode){case AZ.statusCode.xformsError:Bv.showPage(AZ.pageType.preview);break;case AZ.statusCode.mappingError:Bv.showPage(AZ.pageType.preview);break;default:if(Bx.currentSource.type===AZ.sourceType.file&&Bx.currentSource.subtype!==AZ.sourceSubtype.samplefile&&Bx.currentSource.subtype!==AZ.sourceSubtype.publicData){Bv.showPage(AZ.pageType.file,Bx.currentSource.subtype-1);}else{if(Bx.currentSource.subtype===AZ.sourceSubtype.samplefile){Bv.showPage(AZ.pageType.sampleFiles);}else{if(Bx.currentSource.subtype===AZ.sourceSubtype.publicData){Bv.showPage(AZ.pageType.publicData);}else{if(Bx.currentSource.type===AZ.sourceType.salesforce||Bx.currentSource.type===AZ.sourceType.googleDrive||Bx.currentSource.type===AZ.sourceType.dropbox||Bx.currentSource.type===AZ.sourceType.googleAnalytics){if(mstrApp.diParams.StatusCode){Bw.getOAuthSourceReports(Bx.currentSource.type,false);}}}}}break;}},failure:function(B1){Bw.displayError(B1.getResponseHeader("X-MSTR-TaskFailureMsg"));}};var Bz={reportid:this.model.cubeID,previewflag:By};if(mstrApp.isEMMACube){this.dataService.getImportedDataEMMA(B0,Bz);}else{this.dataService.getImportedData(B0,Bz);}},fetchCubeInfoEMMA:function(){var Bu=this,Bw=Bu.model,By=AZ.requestFlag.sourceInfo|AZ.requestFlag.mapping|AZ.requestFlag.relationship,Bx=null,Bv=null,Bz;var B1={success:function(B4){Bw.populateEMMA(B4,By);if(!Bu.checkAndShowPrivilegeMsg()){return ;}mstrmojo.hash.forEach(Bw.importSources,function(B5){if(B5.xdaType===AZ.xdaType.mdx){Bv=B5;return false;}});if(Bv){Bz=mstrApp.diParams;Bu.showPage(AZ.pageType.database,{sourceType:Bv.type,type:Bv.xdaType,extParams:{tableID:Bv.tableID,cubeName:Bz.CubeName,cubeDesc:Bz.CubeDesc,folderID:Bz.FolderId,reportID:Bz.ReportId}});return ;}Bx=Bw.getAllTableID();if(Bx.length<=0){Bu.showPage(AZ.pageType.dataSelection);return ;}else{Bu.showPage(AZ.pageType.emmaPreview,null,null);}if(Bw.isDirectDataAccess===false){var B2=Bu.getDDAController().checkIfDDA(Bw.cubesInfo.cubes);var B3=Bu.getDDAController().canSupportDDA();if(B2&&B3){Bw.set("isDirectDataAccess",true);Bw.weakDDA=true;}}Bu.selectSourceTable(Bx[0]);},failure:function(B2){Bu.displayError(mstrmojo.desc(12793,"Fetch cube info failed."),false,B2.message||"",function(){Bu.cancelApplication();});}};var B0={success:function(B2){if(B2&&B2.msgid){Bu.dataService.set("messageID",B2.msgid);}Bu.dataService.getImportedData(B1,{previewflag:By,browsetype:AZ.browseFlag.dataPreview|AZ.browseFlag.publish|AZ.browseFlag.reportBindingTable|AZ.browseFlag.reportLevelProperty});},failure:function(B2){Bu.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,B2.message||"",function(){Bu.cancelApplication();});}};if(mstrApp.isSingleTier){Bu.dataService.duplicateReportInstance(B0,{datasetID:Bw.cubeID});}else{if(Bw.analysisID){Bu.dataService.duplicateReportInstance(B0,{datasetID:Bw.cubeID,messageID:Bw.analysisID});}else{Bu.dataService.createEMMAReportInstance(B0,{reportID:Bw.cubeID});}}},duplicateSelectedDataset:function(B1){var Bz=this,By=Bz.getModel(),B0=Bz.dataService,Bw=AZ.requestFlag.sourceInfo|AZ.requestFlag.mapping|AZ.requestFlag.relationship,Bv=By.currentDataset,B2=false,Bu={success:function(B5){var B8=null,B6=false,B4=false,B7=false,B3=0,CA="",B9=function(){B0.set("messageID",null);By.resetImportSource();if(By.datasets&&By.datasets.length){By.selectDataset(By.datasets[0]);}Bz.showPage(AZ.pageType.dataSelection);};By.populateEMMA(B5,Bw);B8=By.getAllTableID();BW.forEach(B8,function(CC){var CB=By.getImportSource(CC);if(CB&&CB.xdaType===AZ.xdaType.mdx){B6=true;CA=mstrmojo.desc(13320,"We do not allow add to operation on cubes that have sources based on MDX.");}if(CB&&CB.databaseType===mstrmojo.warehouse.EnumDatabaseType.SearchEngineSOLR){B4=true;CA=mstrmojo.desc(13321,"We do not allow add to operation on cubes that have sources based on Solr.");}if(CB&&CB.type===AZ.sourceType.remoteProject){B7=true;CA=mstrmojo.desc(13322,"We do not allow add to operation on cubes that have sources based on MicroStrategy Project.");}if(CB&&By.isDDAOnlySource(CB.subtype)){B3++;}});if(B6||B4||B7){Bz.displayError(CA,false,null,B9);}else{By.set("isDirectDataAccess",By.isDirectDataAccess&Bz.getDDAController().canSupportDDA());By.set("cubeID",Bv.did);By.set("cubeName",Bv.name);By.set("cubeDesc",Bv.dsc);By.set("operationMode",AZ.operationMode.edit);if(B1&&B1.success){B1.success(B5);}}}},Bx={success:function(B3){B2=true;if(B3&&B3.msgid){B0.set("messageID",B3.msgid);}B0.getImportedData(Bu,{previewflag:Bw});},failure:function(B3){if(B1.failure){B1.failure(B3);}},complete:function(){if(!B2&&B1.complete){B1.complete();}}};if(!Bv||!Bv.did){if(B1.success){B1.success();}if(B1.complete){B1.complete();}}B0.duplicateReportInstance(Bx,{datasetID:Bv.did,messageID:By.analysisID});},getRepublishInfoEMMA:function(){var Bu=this,Bw=Bu.model,Bx=AZ.requestFlag.sourceInfo|AZ.requestFlag.mapping,Bv=AZ.browseFlag.dataPreview|AZ.browseFlag.publish|AZ.browseFlag.reportBindingTable|AZ.browseFlag.reportLevelProperty;var By={success:function(B6){var B2,B1=false,Bz=false,B9=false,B3=false,B7=0,B5=0,B0,B4;Bw.populateEMMA(B6,Bx);if(!Bu.checkAndShowPrivilegeMsg()){return ;}if(Bw.isDirectDataAccess===false){var B8=Bu.getDDAController().shouldSupportDDA();if(B8){Bw.set("isDirectDataAccess",true);}}B2=Bw.getAllTableID();B0=B2.length;BW.forEach(B2,function(CB){var CA=Bw.getImportSource(CB);if(CA&&CA.xdaType===AZ.xdaType.mdx){B1=true;B4=mstrmojo.desc(13278,'A schedule cannot be created on this dataset as all its tables are from the "OLAP Sources" connector which is only supported in the Connect Live? Mode.');}if(CA&&CA.databaseType===mstrmojo.warehouse.EnumDatabaseType.SearchEngineSOLR){Bz=true;B4=mstrmojo.desc(13279,'A schedule cannot be created on this dataset as all its tables are from the "Search as a Source" connector which is only supported in the Connect Live? Mode.');}if(CA&&CA.type===AZ.sourceType.remoteProject){B9=true;B4=mstrmojo.desc(13323,'A schedule cannot be created on this dataset as all its tables are from the "MicroStrategy Project" connector which is only supported in the Connect Live? Mode.');}if(CA&&CA.xdaType===AZ.xdaType.qbSingleTable&&CA.databaseType===4000){B3=true;B4=mstrmojo.desc(14206,"A schedule cannot be created on this dataset as all its tables are from HANA which is only supported in the Connect Live? Mode.");}if(CA&&CA.type===AZ.sourceType.file){if(CA.subtype===AZ.sourceSubtype.clipboard||CA.subtype===AZ.sourceSubtype.localFile){B7++;}}if(CA&&Bw.isDDAOnlySource(CA.subtype)){B5++;}});if(Bw.operationMode===AZ.operationMode.refresh){if(Ax.isRefreshable(Bw)){if(B1){Bu.displayError(mstrmojo.desc(13264,'We do not allow the "Publish" operation on cubes that access OLAP sources.'),false,null,function(){Bu.cancelApplication();});}else{if(Bz){Bu.displayError(mstrmojo.desc(13265,"We do not allow publish operation on cubes that have sources based on Solr."),false,null,function(){Bu.cancelApplication();});}else{if(B3){Bu.displayError(mstrmojo.desc(14207,"We do not allow publish operation on cubes that have sources based on HANA."),false,null,function(){Bu.cancelApplication();});}else{Bu.showDialog(AZ.dialogType.publishStatusDialog,{model:Bw});}}}}else{Bu.displayError(mstrmojo.desc(13280,"Administrator has disabled importing a file from a URL."),false,null,function(){Bu.cancelApplication();});}}if(Bw.operationMode===AZ.operationMode.subscribe){if(B7===B0){Bu.displayError(mstrmojo.desc(13782,'A schedule cannot be created on this dataset as all its tables are either from the "File From Disk" or "Clipboard" connectors which requires manual data input.'),false,null,function(){Bu.cancelApplication();},mstrmojo.desc(13282,"Cannot Create Schedule"));}else{if(B5===B0){Bu.displayError(B4,false,null,function(){Bu.cancelApplication();},mstrmojo.desc(13282,"Cannot Create Schedule"));}else{Bu.getScheduleController().launchScheduleEditor();}}}},failure:function(Bz){Bu.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,Bz.message,function(){mstrApp.getRootController().cancelApplication();});}};if(Bw.operationMode===AZ.operationMode.subscribe){Bv=AZ.browseFlag.dataPreview;}Bu.dataService.getImportedData(By,{previewflag:Bx,browsetype:Bv});},republishEMMACube:function(){var Bu=this;var Bv=Bu.model;var Bw={success:function(Bx){if(Bx&&Bx.msgid){Bu.dataService.set("messageID",Bx.msgid);}Bu.getRepublishInfoEMMA();},failure:function(Bx){Bu.displayError(mstrmojo.desc(12794,"Run EMMA cube error."),false,Bx.message||"",function(){mstrApp.getRootController().cancelApplication();});}};if(mstrApp.isSingleTier){Bu.dataService.duplicateReportInstance(Bw,{datasetID:Bv.cubeID});}else{if(Bv.analysisID){Bu.dataService.duplicateReportInstance(Bw,{datasetID:Bv.cubeID,messageID:Bv.analysisID});}else{Bu.dataService.createEMMAReportInstance(Bw,{reportID:Bv.cubeID});}}},fetchSampleFileList:function Aa(){var Bu=this.model;var Bv={success:function(Bw){Bu.sampleFiles=Bw.samplefiles.file;}};},getDIProjectSettings:function BD(Bu){var Bv=this;var Bw={success:function(Bx){if(!mstrApp.sessionManager){mstrApp.projectName=mstrConfig.projectName;mstrApp.serverName=mstrConfig.serverName;mstrApp.serverPort=mstrConfig.serverPort;mstrApp.authMode=mstrConfig.authMode;mstrApp.enableAutomaticSessionRecovery=Bx.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=Bx.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=Bx.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=Bx.enableWarningSessionTimeout;mstrApp.startSessionManager();}mstrmojo.hash.copy(Bx,mstrApp.diParams);},failure:function(){Bv.oAuthController.getExternalSourcesInfo();}};this.dataService.getDIProjectSettings(mstrmojo.func.wrapMethods(Bw,Bu,{success:function(By){var B0=mstrmojo.desc(13991,'The Project is locked because it is being used by "###". The EMMA Cube cannot be opened until the Project is no longer in use.'),Bx=null;if(By&&By.projectLocked){Bv.displayError(B0.replace("###",By.projectLockedOwner),false,null,function(){Bv.cancelApplication();});return ;}if(By&&By.connectorConfig){try{Bx=JSON.parse(By.connectorConfig);}catch(Bz){console.log("Invalid DI connector configuration");}mstrApp.diParams.connectorConfig=Bx;if(Bx&&(Bx.resourceConfig||Bx.dbRoleConfig)){Bv.getModel().populateSourceListAdminConfig(Bx.resourceConfig,Bx.dbRoleConfig);}}Bv.oAuthController.getExternalSourcesInfo();}}));},getDBMSObjects:function AE(){var Bu=this;var Bv={success:function(Bw){if(Bw.DBInfo){Bu.model.populateDBRoles(Bw.DBInfo);}},failure:function(Bw){Bu.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."),false,Bw.message);}};this.dataService.getDBMSObjects(Bv,{flags:8});},editImportedData:function m(Bw,B4,Bu,Bz,B2,Bv,B0){if(mstrApp.isEMMACube){this.editImportedDataEMMA(Bw,B4,Bu,Bz,B0);return ;}var Bx={shtIx:B4};var B1=this.model.currentSource.type;if(B1===AZ.sourceType.dropbox||B1===AZ.sourceType.googleDrive){var B5=this.model.externalSources[B1];Bx=B5.getSourceParams();Bx.shtIx=B4;}if(Bu){Bx.chs=Bu;}if(Bz){Bx.trans=Bz;}if(this.model.currentSource.subtype===AZ.sourceSubtype.url||this.model.currentSource.subtype===AZ.sourceSubtype.samplefile||this.model.currentSource.subtype===AZ.sourceSubtype.publicData){Bx.isUrl=true;}Bx.behaviorFlags=AZ.importBehaviorFlag.reserved;if(this.model.operationMode===AZ.operationMode.refresh||this.model.operationMode===AZ.operationMode.edit){if(mstrApp.isCloudPro){Bx.behaviorFlags=AZ.importBehaviorFlag.newColumnsSilent|AZ.importBehaviorFlag.dataTypeSilent;}}if(B2){Bx.refine=B2;if(Bv===0){Bx.flags=536870920;}else{Bx.flags=0;}}var By=this;var B3={success:function(B6){By.dataService.set("messageID",B6.msg_id||B6.msgid);if(Bv===0){By.getImportedData(A3.refine,Bw,B4,undefined,1);}else{if(By.model.operationMode!==AZ.operationMode.create&&!Bu&&!Bz){By.getImportedData(A3.changeSheet,Bw,B4,undefined,By.model.currentSource.tableID);}else{By.getImportedData(A3.editImport,Bw,B4,undefined,By.model.currentSource.tableID);}}},failure:function(){By.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."));}};this.dataService.editImportedData(B3,Bx);},editImportedDataEMMA:function A4(By,B9,Bv,B3,B6,Bw,Bx,B5,B4,B1){var Bu,B0={};if(B6){Bu=this.model.importSources[B6];B9=Bu.currentIndex;}else{Bu=this.model.currentSource;B6=Bu.tableID;}if(B9>=0){B0.shtIx=B9;}var B7=Bu.type;if(Bu.type===AZ.sourceType.googleDrive||Bu.type===AZ.sourceType.dropbox||Bu.type===AZ.sourceType.salesforce||Bu.type===AZ.sourceType.twitter||Bu.type===AZ.sourceType.facebook||Bu.type===AZ.sourceType.googleAnalytics){var CA=this.model.externalSources[B7];B0=CA.getSourceParams();}if(Bv){B0.chs=Bv;}if(B3){B0.trans=B3;}if(Bu.subtype===AZ.sourceSubtype.url||Bu.type===AZ.sourceType.hadoop||Bu.subtype===AZ.sourceSubtype.samplefile||Bu.subtype===AZ.sourceSubtype.publicData){B0.isUrl=true;}if(Bu.subtype===AZ.sourceSubtype.querybuilder){B0.isDB=true;B0.dbTableName=Bu.sourceInfo.dbTableName;B0.dbRoleID=Bu.sourceInfo.dbRoleId;if(Bu.sourceInfo.dbNamespace){B0.dbNamespace=Bu.sourceInfo.dbNamespace;}}if(Bw||Bw===0){B0.sr=Bw;}if(Bx){B0.dlmt=Bx;}if(B5){B0.qt=B5;}B0.behaviorFlags=AZ.importBehaviorFlag.reserved;if(this.model.operationMode===AZ.operationMode.refresh||this.model.operationMode===AZ.operationMode.edit){if(mstrApp.isCloudPro){B0.behaviorFlags=AZ.importBehaviorFlag.newColumnsSilent|AZ.importBehaviorFlag.dataTypeSilent;}}if(B1){B0.behaviorFlags|=AZ.behaviorChangeFlag.refreshData;}else{B0.behaviorFlags|=AZ.behaviorChangeFlag.remapping;}var B2=this;var Bz={success:function(){B2.getImportedDataEMMA(A3.none,By,B9,undefined,B6);},failure:function(CB){B2.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CB.message||"");}};var B8={success:function(CB){if(CB&&CB.msgid){B2.dataService.set("messageID",CB.msgid);}B2.dataService.detectRelationshipSourceTable(B4||Bz,{did:B6||B2.model.currentSource.tableID});},failure:function(CB){B2.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."),false,CB.message||"");}};B0.tbid=B6;this.dataService.autoMappingSourceTable(B8,B0);},openRefreshOptions:function p(){var Bw=this.model.refresh_opt,Bu;if(Bw==="2"){Bu=2;}else{if(Bw==="4"){Bu=1;}else{Bu=0;}}var Bv=mstrmojo.all[Bk];if(!Bv){Bv=mstrmojo.insert(d);Bv.model=this.model;Bv.render();}Bv.radiolist.set("selectedIndex",Bu);Bv.open();},loadProject:function At(Bx,Bv){var B3,B0,Bw=0,Bz=0,By=0,Bu,B1,B2;B3={};B0={success:function(B4){if(!B4||!B4.servers){return ;}for(Bz=0;Bz<B4.servers.length;Bz++){Bu=B4.servers[Bz];if(Bu&&Bu.projects){for(By=0;By<Bu.projects.length;By++){B1=Bu.projects[By];if(B1){Bx[Bw]={nt:"\\\\"+Bu.name+"\\"+B1.name,n:B1.name,id:B1.id,sn:Bu.name,port:Bu.port};if((B1.name===mstrApp.projectName)&&(Bu.name===mstrApp.serverName)){Bx[Bw].ls=true;Bx[Bw].ss=mstrApp.sessionState;B2=Bw;}else{Bx[Bw].ls=false;Bx[Bw].ss=null;}Bw++;}}}}Bv.set("items",Bx);Bv.set("selectedIndex",B2);Bv.set("text",Bx[B2].nt);},failure:function(B4){mstrmojo.alert(B4.getResponseHeader("X-MSTR-TaskFailureMsg"));}};this.dataService.loadProject(B0,B3);},loginProjects:function Q(Bx,By){var Bv=1,Bz=Bx.parent,B1=Bx.mstrUserAlias.value,B4=Bx.mstrPasswordAlias.value,B0=Bx.loginErrorBoxAlias,Bw=Bz.selectedIndex,Bu=Bz.port,B3={userid:B1,server:Bz.serverName,password:B4,project:Bz.projectName,authMode:Bv,port:Bu},B2={success:function(B5){By[Bw].ls=true;By[Bw].ss=B5.sessionState;B0.set("visible",false);Bz.close();Bz.projectListNode.set("selectedIndex",Bw);},failure:function(B5){B0.set("visible",true);B0.errorMsgAlias.set("text",mstrmojo.desc(422));}};this.dataService.loginProject(B2,B3);},getPublishController:function BU(){if(this.publishController===undefined){this.publishController=new mstrmojo.DI.controller.DIPublishController();}return this.publishController;},saveAndPublish:function M(){this.getPublishController().saveAndPublish();},publishNonEmmaCube:function AK(Bx){var Bv=this;var Bz={success:function By(){Bv.displayError(mstrmojo.desc(14096,"The cube was published successfully!"),false,null,function(){var B3,B1,B2,B0,B4={did:Bx};if(mstrApp.refreshMultipleCubes){B3=Bv.getModel();B3.publishedDatasets.push(B4);B1=B3.cubesInfo;B2=B1&&B1.cubes&&B1.cubes.cube;B0=BW.find(B2,"cube_id",Bx);if(B0>=0){B2.splice(B0,1);B3.raiseEvent({name:"cubesInfoChange"});}}});},failure:function Bw(B0){Bv.displayError(mstrmojo.desc(14097,"There was an error publishing the cube."),false,B0.message||"");}};var Bu={success:function(B0){switch(parseInt(B0.status)){case AZ.cubePollStatus.msgID:case AZ.cubePollStatus.result:case AZ.cubePollStatus.xmlResult:Bz.success();break;case AZ.cubePollStatus.prompt:Bz.failure();break;case AZ.cubePollStatus.error:Bz.failure();break;default:Bv.dataService.pollStatus(Bu,{msgID:B0.id,stateID:parseInt(B0.st)});break;}},failure:function(B0){Bz.failure(B0);}};this.dataService.publishNonEmmaCube(Bu,{reportID:Bx});},save:function BF(){this.getPublishController().save();},handleMissingColumns:function BJ(Bu){this.getPublishController().handleMissingColumns(Bu);},handleRepublishError:function Ab(Bu){this.getPublishController().handleRepublishError(Bu);},cancelRepublishError:function Bg(Bu){this.getPublishController().cancelRepublishError(Bu);},exitApplication:function Bj(){if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrmojo.xhr.cancel();if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{An.call(this,this.model.cubeID);}},exitApplicationRefreshMultipleCubes:function(){var Bu=this;if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{window.setTimeout(function(){var Bw=Bu.model.publishedDatasets;Bu.dialogController.close(AZ.dialogType.publishStatusDialog);Bu.dialogController.destroyAll();var Bv=mstrApp.container;if(Bv){mstrApp.container.close();if(Bv.dataImportCallback){Bv.dataImportCallback(Bw);}}},0);}},cancelApplication:function Be(){var Bu=this,Bv=this.getModel();if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrmojo.xhr.cancel();if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{window.setTimeout(function(){Bu.dialogController.close(AZ.dialogType.publishStatusDialog);Bu.dialogController.destroyAll();var Bw=mstrApp.container;if(Bw){if(!Bv.hasMergedReportInstance){mstrApp.container.close();if(Bw.dataImportCallback){Bw.dataImportCallback();}}else{mstrApp.container.close();}}else{mstrApp.redirectToPage(Aj.getRedirectParams(Aj.pageRedirect.flashVI,Bu.model.cubeID,Bu.model.isDirectDataAccess));}},100);}},wrapUpDataImport:function BP(Bv){var Bu=this,Bx=this.model,Bw=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;if(Bv===undefined){Bv=true;}var By={success:function(){Bx.hasMergedReportInstance=true;if(Bx.operationMode===AZ.operationMode.create&&(Bx.isManagedCube||mstrApp.isSingleTier)){Bu.docController.renameDataset((Bx.curDataset&&Bx.curDataset.id)?Bx.curDataset.id:Bx.cubeID,Bx.cubeName,{success:function(){An.call(Bu,Bx.cubeID);}});}else{An.call(Bu,Bx.cubeID);}},failure:function(B1){mstrApp.hideProgress();Bu.displayError(mstrmojo.desc(12796,"Unable to update the dataset after editing."),false,B1&&B1.message);}};this.dialogController.close(AZ.dialogType.publishStatusDialog);function Bz(){Bu.dataService.duplicateReportInstance(By,{messageID:Bx.analysisID,datasetID:(Bx.curDataset&&Bx.curDataset.id)?Bx.curDataset.id:Bx.cubeID,duplicateRIMsgID:Bu.dataService.messageID});}function B0(){var B1=Bu.getDocController(),B2=Bu.getDocController().getVIModelDatasets();B1.createNewManagedDataset({success:function(B3){var B4=[],B5;Bd.forEach(B3.datasets,function(B6,B7){if(BW.find(B2,"did",B7)<0){B4.push(B7);}});if(B4.length>0){B5=B4[0];Bx.curDataset=B3.datasets[B5];Bx.hasCreateDataset=true;Bx.curDataset.id=B5;Bx.cubeID=B5;Bz();}},failure:function(B3){Bu.displayError(mstrmojo.desc(12796,"Unable to update the dataset after editing."),false,B3&&B3.message);}},{newObjectIds:[Bx.reportDefinitionId]});}if(!Bx.analysisID&&!mstrApp.isSingleTier){if(Bu.rootView.currentPage&&Bu.rootView.currentPage.scriptClass!=="mstrmojo.DI.DIExitOptions"){if(Bx.path!==undefined&&Bv){Bu.showPage(AZ.pageType.redirect);}else{Bu.exitApplication();}}}else{if(Bx.operationMode===AZ.operationMode.create&&(Bx.isManagedCube||(Bx.curDataset&&Bx.curDataset.id))){Bu.dataService.getImportedData({success:function(B1){Bx.populateEMMA(B1,Bw,true);B0();},failure:function(B1){Bu.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,B1.message);}},{previewflag:Bw});}else{if(Bx.operationMode===AZ.operationMode.edit){Bz();}else{An.call(Bu,Bx.cubeID);}}}},getQBParamsDDA:function Ah(Bx){var Bu,Bw=this.getDDAController(),Bv={};Bu=Bw.canSupportDDA(Bv);Bx.canSupportDDA=Bu;Bx.shouldSupportDDA=Bw.shouldSupportDDA();Bx.isManagedCube=this.model.isManagedCube;Bx.dbridForDDA=Bv.dbrid;Bx.isDDA=this.model.isDirectDataAccess;Bx.origIsDDA=this.model.origIsDirectDataAccess;Bx.ddaCheckboxID=Bw.getDDACheckboxID();},getQueryBuilderParams:function Bs(Bx,Bu){var Bw={isEMMACube:mstrApp.isEMMACube,type:Bx};switch(Bx){case AZ.xdaType.ffsql:case AZ.xdaType.googleBigQuery:case AZ.xdaType.googleBigQueryFFSQL:case AZ.xdaType.querybuilder:Bw.size={h:"95%",w:"95%"};break;case AZ.xdaType.qbSingleTable:case AZ.xdaType.dataImportBISource:case AZ.xdaType.mdx:Bw.size={h:"552px",w:"1010px"};break;default:Bw.size={h:"549px",w:"1010px"};}Bw.isFFSQL=(Bx===AZ.xdaType.ffsql||Bx===AZ.xdaType.googleBigQueryFFSQL||Bx===AZ.xdaType.dataImportBISource)?true:false;if(Bx===AZ.xdaType.googleBigQuery||Bx===AZ.xdaType.googleBigQueryFFSQL||Bx===AZ.xdaType.googleBigQuerySingleTable){var Bv=this.model.externalSources[AZ.sourceType.googleBigQuery];if(Bv){Bw.dbrid=Bv.dbRoleID;if(Bv.sourceAccountID){Bw.said=Bv.sourceAccountID;}if(Bv.userDisplayName){Bw.userName=Bv.userDisplayName;}if(Bv.userEmail){Bw.userEmail=Bv.userEmail;}}}if(mstrApp.isCloudPro){Bw.isCloud=true;if(this.model.cubeID){Bw.reportID=this.model.cubeID;}if(this.model.analysisID){Bw.analysisID=this.model.analysisID;}if(this.model.folderID){Bw.folderID=this.model.folderID;}if(mstrApp.diParams.isMDD){Bw.isCube=2;}else{Bw.isCube=1;}}else{if(this.model.analysisID){Bw.messageID=mstrApp.messageID||this.dataService.messageID||"";}else{Bw.messageID=this.dataService.messageID||"";}Bw.analysisID=this.model.analysisID||"";Bw.isNewAnalysis=mstrApp.isNewAnalysis;}Bw.origin="di";Bw.emmaTablesNum=this.model.getAllTableID().length;this.getQBParamsDDA(Bw);Bw.diFooterID=this.rootView.footer.id;Bw.diRootViewID=this.rootView.id;Bw.tableID=(Bu&&Bu.tableID)||"";Bw.subtype=(Bu&&Bu.subtype)||undefined;Bw.isRefined=(Bu&&Bu.isRefined);Bw.diCurrentZIndex=this.getDialogController().getCurrentZIndex();Bw.operationMode=this.model.operationMode;Bw=mstrmojo.hash.copy(Bw,Bu);return Bw;},afterQBProcess:function BS(By){var Bv=this;var Bw=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship,Bx=mstrApp.tableID,B1,Bz,Bu=!!(Bv.rootView.currentPage&&Bv.rootView.currentPage.tableID),B0=Bu?AZ.actions.refreshData:AZ.actions.importSource;if(mstrApp.hasOwnProperty("isDDA")){Bz=mstrApp.isDDA;Bv.getDDAController().setDirectDataAccess(Bz);}if(mstrApp.hasOwnProperty("isManagedCube")){Bv.model.isManagedCube=mstrApp.isManagedCube;}if(By){Bv.dataService.set("messageID",mstrApp.messageID);Bv.getDDAController().confirmDDA=false;if(By.mdx){Bv.saveAndPublish();return ;}Bv.getImportedDataEMMA(A3.savePublish,Bw);return ;}if(mstrApp.messageID){Bv.dataService.set("messageID",mstrApp.messageID);if(!Bx&&!Bv.model.isDirectDataAccess){B1={onOK:function(){Bv.getImportedDataEMMA(B0,Bw);},onCancel:function(B2){Bv.getImportedDataEMMA(B0,Bw,undefined,undefined,undefined,undefined,undefined,B2);}};Bv.autoDetectPartitionGroups(B1);}else{Bv.getImportedDataEMMA(B0,Bw);}}},afterBigQueryProcess:function S(Bu){var Bw=AZ.pageType,Bv=this.model.externalSources[AZ.sourceType.googleBigQuery];Bv.reset();this.showPage(Bu?Bw.emmaPreview:Bw.dataSelection);},displayError:function V(Bx,Bz,Bw,Bv,By){var Bu;if(mstrApp.isPopup){Bz=false;}Bu={title:By||mstrApp.applicationName&&mstrApp.applicationName()||mstrmojo.desc(3610),errorMessage:Bx,detailErrorMessage:Bw||"",onOK:Bv||null};if(mstrApp.hideProgress){mstrApp.hideProgress(true);}else{if(mstrApp.hideWait){mstrApp.hideWait();}}this.showDialog(AZ.dialogType.errorDialog,Bu);if(Bz){mstrApp.onSessionExpired();}},displayWarning:function K(Bu,By,Bx,Bw){var Bv={title:By||mstrApp.applicationName&&mstrApp.applicationName()||mstrmojo.desc(3610),errorMessage:Bu,showCancel:true,onOK:Bx};mstrmojo.hash.forEach(Bw,function(B0,Bz){Bv[Bz]=B0;});mstrApp.hideProgress(true);this.showDialog(AZ.dialogType.warningDialog,Bv);},filterSourcesByPrivileges:function(Bv){var Bu=[];mstrmojo.hash.forEach(Bv,function(Bw){if(Bw.privilege===AZ.privilegeType.accessCloud&&mstrApp.diParams.AccessDataFromCloudApp){Bu.push(Bw);}if(Bw.privilege===AZ.privilegeType.accessDatabase&&mstrApp.diParams.ImportDatabase){Bu.push(Bw);}if(Bw.privilege===AZ.privilegeType.accessFile&&mstrApp.diParams.AccessDataFromFiles){Bu.push(Bw);}});return Bu;},filterSourcesForOneTier:function(Bu){var Bv=[],By=0,Bw=0,Bx;mstrmojo.hash.forEach(Bu,function(Bz){Bx=null;if(Bz.oneTier){Bx=mstrmojo.hash.copy(Bz,Bx);if(Bw>3){By++;Bw=0;}Bw++;Bv.push(Bx);}});return Bv;},filterSourcesByDDA:function(Bv){var Bu=[],By=0,Bw=0,Bx;mstrmojo.hash.forEach(Bv,function(B0){Bx=null;var Bz,B1;if(B0.sourceInfo&&B0.sourceInfo.subtype){Bz=B0.sourceInfo.subtype;}else{Bz=B0.subtype;}if(B0.sourceInfo&&B0.sourceInfo.dbType){B1=B0.sourceInfo.dbType;}else{B1=B0.dbType;}if(mstrApp.getRootController().model.canAddToDDACube(Bz,B1)){Bx=mstrmojo.hash.copy(B0,Bx);if(Bw>3){By++;Bw=0;}Bw++;Bu.push(Bx);}});return Bu;},filterSourcesByDDAOnly:function(By,Bu){var Bx=this.getModel(),Bw=[],Bv;if(!Bu){BW.forEach(By,function(Bz){if(Bz.sourceInfo&&Bz.sourceInfo.subtype){Bv=Bz.sourceInfo.subtype;}else{Bv=Bz.subtype;}if(!Bx.isDDAOnlySource(Bv)){Bw.push(Bz);}});}else{Bw=By;}return Bw;},filterSourcesByText:function AA(Bx,Bw,B0){var Bv,Bz,Bu=[],B1=0,By=0;for(Bv=0;Bv<Bx.length;Bv++){Bz=Bx[Bv].n.toLowerCase().indexOf(Bw.toLowerCase());if(Bz>-1){Bu.push(Bx[Bv]);By++;if(By===B0){By=0;B1=B1+1;}}}return Bu;},filterSourcesbyTag:function Z(Bx,B1,By){var Bw,Bv,B2=[],B0=0,Bu=0,Bz;for(Bv=0;Bv<Bx.length;Bv++){if(Bx[Bv].tags){for(Bw=0;Bw<Bx[Bv].tags.length;Bw++){Bz=Bx[Bv].tags[Bw];if(B1[Bz]){B2.push(Bx[Bv]);Bu++;if(Bu===By){Bu=0;B0=B0+1;}break;}}}}return B2;},selectSourceTable:function AG(B0,B2){var By=this,Bx=By.model,Bu=null,Bv=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship|AZ.requestFlag.preview|AZ.requestFlag.transformations,Bz=false,B1=Bx.currentSource?Bx.currentSource.tableID:-1;if(B0!==-1){Bu=By.model.getImportSource(B0);}if(B0===B1&&Bu&&Bu.cannotFetchPreview){if(B2){Bx.raiseEvent({name:"scrollToTable",value:B0});}return ;}var B3={success:function(B4){By.model.selectSourceTable(B0);Bx.populateEMMA(B4,Bv,B0);Bu.selectPending=false;if(B2){Bx.raiseEvent({name:"scrollToTable",value:B0});}},failure:function(B4){Bu.selectPending=false;if(Bx.operationMode===AZ.operationMode.create){By.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,B4.message||"");}else{if(Bu){Bu.cannotFetchPreview=true;Bx.raiseEvent({name:"PreviewNotFetched"});}}if(B2){Bx.raiseEvent({name:"scrollToTable",value:B0});}}};if(Bu){var Bw=(!!Bu.currentMapping&&!!Bu.currentPreview)||(!!Bu.transformedMapping&&!!Bu.transformedPreview);if(!Bw){if(Bu&&Bu.currentTransformations&&Bu.currentTransformations.xtab&&Bu.currentTransformations.xtab.isCrosstab){Bv=Bv&(~AZ.requestFlag.preview);Bv=Bv&(~AZ.requestFlag.transformations);Bv|=AZ.requestFlag.transformedPreview;}else{Bv=Bv&(~AZ.requestFlag.transformedPreview);Bv|=AZ.requestFlag.preview;}if(Bu.type===AZ.sourceType.querybuilder){Bv=Bv&(~AZ.requestFlag.sheets);Bv=Bv&(~AZ.requestFlag.transformations);Bv=Bv&(~AZ.requestFlag.sourceInfo);}if(Bx.operationMode===AZ.operationMode.edit||Bx.operationMode===AZ.operationMode.refresh){Bv=Bv&(~AZ.requestFlag.sheets);}if(Bu.subtype===AZ.sourceSubtype.googleBigQuerySingleTable){Bv=775;}if(Bu.databaseType===h&&Bu.xdaType===AZ.xdaType.qbSingleTable){Bv=Bv&(~AZ.requestFlag.preview);}Bz=true;}}if(Bz&&!Bu.cannotFetchPreview){if(Bu.selectPending){return ;}Bu.selectPending=true;By.model.selectSourceTable(B0);By.dataService.getImportedData(B3,{previewflag:Bv,sheetIndex:0,tableID:B0},{showProgress:false});}else{By.model.selectSourceTable(B0);if(B2){Bx.raiseEvent({name:"scrollToTable",value:B0});}}},removeSourceTable:function Ar(Bw){var Bu=this;var Bz={did:Bw};var By=mstrmojo.desc(13646,"Oops ... Empty Dataset"),Bv=mstrmojo.desc(13883,"The dataset cannot be empty. Please add more tables before deleting this one."),Bx=Bu.getModel().getAllTableID();if(Bw===-1){return ;}var B0={success:function(B2){Bu.dataService.set("messageID",B2.msgid);Bu.model.resetImportSource(Bw);Bu.model.raiseEvent({name:"removeSourceTable",tableID:Bw});Bu.navigationController.deleteRoute(Bw);var B1=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;if(Bu.model.getAllTableID().length>0){Bu.getImportedDataEMMA(A3.none,B1);}else{Bu.showPage(AZ.pageType.dataSelection);}},failure:function(B1){Bu.displayError(mstrmojo.desc(12797,"Cannot remove source table."),false,B1.message||"");}};if(Bx.length===1){mstrmojo.alert(Bv,mstrmojo.emptyFn,By,Bu.getDialogController().getNextZIndex());}else{Bu.dataService.removeEMMASourceTable(B0,Bz);}},autoMappingAfterRefine:function c(Bw,Bx,By){var Bz={};if(By){Bz.behaviorFlags=AZ.behaviorChangeFlag.refreshData;}else{Bz.behaviorFlags=AZ.behaviorChangeFlag.remapping;}var Bv=this;var Bu={success:function(){Bv.getImportedDataEMMA(A3.none,Bw,undefined,undefined,Bx);},failure:function(B1){Bv.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,B1.message||"");}};var B0={success:function(B1){if(B1&&B1.msgid){Bv.dataService.set("messageID",B1.msgid);}Bv.dataService.detectRelationshipSourceTable(Bu,{did:Bx});},failure:function(B1){Bv.displayError(mstrmojo.desc(12798,"Error when auto mapping after wrangle."),false,B1.message||"");}};Bz.tbid=Bx;this.dataService.autoMappingSourceTable(B0,Bz);},startRefineStage:function R(Bx,Bv,Bw,Bz){var Bu=this;var By={did:Bx,flag:Bv,xml:Bw};var B0={success:function(B3){if(B3){Bu.dataService.set("messageID",B3.msgid);}if(Bv!==3){var B1=8;Bu.getImportedDataEMMA(A3.refine,B1,undefined,undefined,Bx,Bv-1);}else{var B4=Bu.model.getImportSource(Bx);var B2=AZ.requestFlag.preview|AZ.requestFlag.mapping|AZ.requestFlag.transformations|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;if(B4&&B4.currentTransformations&&B4.currentTransformations.xtab&&B4.currentTransformations.xtab.isCrosstab){B2=B2&(~AZ.requestFlag.preview);B2=B2&(~AZ.requestFlag.transformations);B2|=AZ.requestFlag.transformedPreview;}else{B2=B2&(~AZ.requestFlag.transformedPreview);B2|=AZ.requestFlag.preview;}Bu.editImportedDataEMMA(B2,null,null,null,Bx);}},failure:function(B1){Bu.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,B1.message||"");}};if(Bz){B0.success();}else{Bu.dataService.startRefineStage(B0,By);}},cancelRefineStage:function H(Bv){var Bu=this;var Bw={did:Bv};var Bx={success:function(Bz){Bu.dataService.set("messageID",Bz.msgid);var B0=Bu.model.importSources[Bv];delete B0.projectID;var By=AZ.requestFlag.preview|AZ.requestFlag.mapping|AZ.requestFlag.transformations|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;if(B0&&B0.currentTransformations&&B0.currentTransformations.xtab&&B0.currentTransformations.xtab.isCrosstab){By=By&(~AZ.requestFlag.preview);By=By&(~AZ.requestFlag.transformations);By|=AZ.requestFlag.transformedPreview;}else{By=By&(~AZ.requestFlag.transformedPreview);By|=AZ.requestFlag.preview;}Bu.editImportedDataEMMA(By,null,null,null,Bv,null,null,null,null,true);},failure:function(By){Bu.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,By.message||"");}};Bu.dataService.cancelRefineStage(Bx,Bw);},refreshSourceTable:function BR(B2){var B1=this;var Bu=B1.model.getImportSource(B2);var Bw=Bu.sourceInfo.dbTableName;var B5;var Bv={next:{visible:true,text:mstrmojo.desc(773,"Refresh")},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};var Bx=mstrmojo.desc(14155,"Please input your original data into clipboard because you have parsed or wrangled the data.");var B4={success:function(B6){B5.getConfig().properties.content=B6;B1.showPage(AZ.pageType.clipboard,0,B5,Bv);},failure:function(B6){B1.showPage(AZ.pageType.clipboard,0,B5,Bv);B1.displayError(mstrmojo.desc(12795,"Could not load clipboard data!"),false,B6.message);}};if(!Bu){return ;}delete Bu.projectID;B5=B1.navigationController.getPageSlot();B5.setConfig({name:Bw,properties:{tableID:B2,currentSource:Bu,isMultiSelect:false,operationMode:AZ.operationMode.edit},footerConfig:Bv,newPage:true,newPageConfig:{cssClass:"mstrmojo-di-refresh-data-editor"}});if(Bu.type===AZ.sourceType.file&&Bu.subtype===AZ.sourceSubtype.localFile){if(B1.model.refreshToWrangle&&mstrApp.isSingleTier&&window.FormWrapper.isFilePathExist(Bu.sourceInfo.url)){B1.refreshOnetierLocalFile(B2);}else{B1.showPage(AZ.pageType.file,Bu.subtype-1,B5,Bv);}}else{if(Bu.type===AZ.sourceType.file&&Bu.subtype===AZ.sourceSubtype.url){Bv.next.enabled=true;B1.showPage(AZ.pageType.file,Bu.subtype-1,B5,Bv);}else{if(Bu.type===AZ.sourceType.hadoop&&Bu.subtype===AZ.sourceSubtype.hadoop){B1.showPage(AZ.pageType.hadoop,Bu.subtype-1,B5,Bv);}else{if(Bu.type===AZ.sourceType.file&&Bu.subtype===AZ.sourceSubtype.clipboard){var Bz={previewflag:AZ.requestFlag.fullData,browsetype:4,sheetIndex:0,bindingflag:0,tableID:B2};if(!Bu.isParsed()&&!Bu.isRefined()){this.dataService.getImportedData(B4,Bz,0);}else{B1.showPage(AZ.pageType.clipboard,0,B5,Bv);mstrApp.getRootController().displayWarning(Bx,null,mstrmojo.emptyFn,{showCancel:false});}}else{if(Bu.type===AZ.sourceType.file&&Bu.subtype===AZ.sourceSubtype.samplefile){B1.showPage(AZ.pageType.sampleFiles,null,B5,Bv);}else{if(Bu.type===AZ.sourceType.file&&Bu.subtype===AZ.sourceSubtype.publicData){B1.showPage(AZ.pageType.publicData,null,B5,Bv);this.scrapeWiki(Bu.sourceInfo.url,false);}else{if(Bu.type===AZ.sourceType.querybuilder){mstrApp.getRootController().showPage(AZ.pageType.database,{sourceType:Bu.type,type:Bu.xdaType,extParams:{tableID:B2,isRefined:Bu.sourceInfo.isRefined,subtype:Bu.subtype,databaseType:Bu.databaseType}},B5,Bv);}else{if(Bu.type===AZ.sourceType.salesforce||Bu.type===AZ.sourceType.googleDrive||Bu.type===AZ.sourceType.dropbox||Bu.type===AZ.sourceType.googleAnalytics||Bu.type===AZ.sourceType.googleBigQuery){B1.getOAuthSourceReports(Bu.type,false,B5);}else{if(Bu.type===AZ.sourceType.bisource){mstrApp.getRootController().showPage(AZ.pageType.database,{sourceType:AZ.sourceType.bisource,type:AZ.xdaType.dataImportBISource,extParams:{tableID:B2}},B5,Bv);}else{if(Bu.type===AZ.sourceType.twitter||Bu.type===AZ.sourceType.facebook){var By,B0,B3;if(Bu.type===AZ.sourceType.twitter){By=Bu.sourceInfo.url.split("###")[1];B0=JSON.parse(By);B3=B5.getConfig().properties;if(B0!==undefined){B3.searchParam=B0.query;}if(Bu.fetchNum){B3.fetchNum=Bu.fetchNum;}}else{By=decodeURIComponent(Bu.sourceInfo.url.split("###")[1]);B0=JSON.parse(By);if(B0!==undefined){B5.getConfig().properties.searchParam=B0.query;B5.getConfig().properties.groupID=B0.groupID;if(B0.advProps){B5.getConfig().properties.advProps=B0.advProps;}}}B1.getOAuthSourceReports(Bu.type,true,B5,Bv);}}}}}}}}}}Bu.invalidPreview();},refreshOnetierLocalFile:function(By){var Bu=this,Bw=this.getModel(),B0=this.getDataService(),Bz=Bw.getImportSource(By),Bv=Bz.sourceInfo.url;function Bx(B1){Bu.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,B1&&B1.message);}if(Bv.indexOf("file:///")===0){Bv=Bv.substr(8);}Bu.oneTierImportFile({success:function(B1){if(B1&&B1.msgid){B0.set("messageID",B1.msgid);}B0.autoMappingSourceTable({success:function(){Bu.detectRelationshipSourceTable(null,[By],AZ.actions.refreshData);},failure:Bx},{tbid:By,shtIx:Bz.sourceInfo.sheetIndex,behaviorFlags:AZ.behaviorChangeFlag.refreshData});},failure:Bx},{msgID:B0.messageID,tableID:By,datasource:Bv,dict:AZ.backendSourceSubtype.localFile,fileName:Bv,__index:0,behaviorFlags:0});},openRenameTextBox:function BV(Bu,Bw,Bv){this.mappingController.openRenameTextBox(Bu,Bw,Bv);},changeEMMAMappings:function g(B3,B2){var B0=this;var Bz=B0.model;var B1=[];var Bu=Bz.getAllTableID();var Bx,By;var Bw;var Bv={success:function(){var B5=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;B0.getImportedDataEMMA(A3.none,B5);},failure:function(B5){B0.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,B5.message);}};for(Bx=0;Bx<Bu.length;Bx++){By=Bz.getImportSource(Bu[Bx]).getMappingChanges();if(By&&By.length>0){B1.push(Bu[Bx]);}}Bx=0;var B4={success:function(B6){B0.dataService.set("messageID",B6.msgid);var B7=0;Bx++;if(Bx<B1.length){Bw={tbid:B1[Bx],mapping:Bo.call(B0,B1[Bx])};Bz.getImportSource(B1[Bx]).invalidPreview();B0.dataService.changeMappingSourceTable(B4,Bw);}else{var B5=[];mstrmojo.array.forEach(B1,function(B9){var B8=Bz.getImportSource(B9);if(B8.canAutoMappingAndDetectRelation()){B5.push(B9);}});if(B5.length>0){BW.forEach(B5,function(B8){B0.dataService.detectRelationshipSourceTable({success:function(){B7++;if(B7>=B5.length){Bv.success();}},failure:function(B9){B0.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,B9.message);}},{did:B8});});}else{Bv.success();}}},failure:function(B7){var B6=parseInt(B7.code,10);var B8=mstrmojo.desc(12800,"Cannot change mapping.");switch(B6){case AZ.backendError.invalidObjectName:B8=mstrmojo.desc(12801,"Cannot change mapping with invalid characters");break;case AZ.backendError.stringTooLong:B8=mstrmojo.desc(12802,"Cannot change mapping with a too long string");break;}B0.displayError(B8,false,B7.message);var B5=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;B0.getImportedDataEMMA(A3.none,B5);}};if(Bx<B1.length){Bw={tbid:B1[Bx],mapping:Bo.call(B0,B1[Bx],B2)};Bz.getImportSource(B1[Bx]).invalidPreview();B0.dataService.changeMappingSourceTable(B3||B4,Bw);}},editRelationship:function w(B0,Bz,B1){var Bv=this;if(!B0||!Bz||!B0.length){return ;}var Bx=0;var Bw={success:function(){var B2=AZ.requestFlag.mapping|AZ.requestFlag.sourceInfo|AZ.requestFlag.relationship;Bv.getImportedDataEMMA(A3.none,B2);},failure:function(B2){Bv.displayError(mstrmojo.desc(12803,"Cannot edit relationship."),false,B2.message||"");}};var Bu=mstrmojo.func.wrapMethods(Bw,B1,{});var By={success:function(){Bx++;if(Bx<B0.length){Bz.did=B0[Bx];Bv.dataService.editRelationshipSourceTable(By,Bz);}else{Bu.success();if(Bu.complete){Bu.complete();}}},failure:function(B2){Bu.failure(B2);if(Bu.complete){Bu.complete();}}};Bz.did=B0[0];Bv.dataService.editRelationshipSourceTable(By,Bz);},openRelationsDefineEditor:function(Bv){var Bu;if(!Bv){return ;}Bu={tableID:Bv};this.showDialog(AZ.dialogType.relationDefineDialog,Bu);},removeEMMASourceTable:function BY(Bv,Bu){this.dataService.removeEMMASourceTable(Bv,Bu||{});},showDialog:function BA(Bv,Bu){return this.dialogController.show(Bv,Bu);},hasDialog:function Y(Bu){this.dialogController.hasDialog(Bu);},closeDialog:function Ay(Bu){this.dialogController.close(Bu);},closePageDialog:function Bn(){if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}},toAttribute:function l(Bu){this.mappingController.toAttribute(Bu);},toMetric:function L(Bu){this.mappingController.toMetric(Bu);},setMultipleImport:function AF(Bu){this.mappingController.setMultipleImport(Bu);},setGeoRoles:function Bb(Bu){this.mappingController.setGeoRoles(Bu);},setTimeDimension:function a(Bu){this.mappingController.setTimeDimension(Bu);},setTimeRole:function Ai(Bu){this.mappingController.setTimeRole(Bu);},toUnused:function A0(Bu){this.mappingController.toUnused(Bu);},openUnLinkDialog:function Ad(Bu){this.mappingController.openUnLinkDialog(Bu);},unlinkAll:function Bh(Bv,Bu){this.mappingController.unlinkAll(Bv,Bu);},unlinkAllCubeLevel:function BH(Bu){this.mappingController.unlinkAllCubeLevel(Bu);},linkAttributes:function W(Bv,Bu){this.mappingController.linkAttributes(Bv,Bu);},toProjectAttribute:function Ba(Bv,Bu){this.mappingController.toProjectAttribute2(Bv,Bu);},unmap:function b(Bu){this.mappingController.unmap(Bu);},importItem:function T(Bu){this.mappingController.importItem(Bu);},changeDataType:function Ac(Bv,Bu,Bw){this.mappingController.changeDataType(Bv,Bu,Bw);},attachDataChangeListeners:function BX(Bw){var Bu=this.model,Bv=[];Bd.forEach(Bw,function(Bx,By){Bd.forEach(Bx,function(B0,Bz){Bv.push(Bu.attachEventListener(Bz,By,B0));});});return Bv;},detachDataChangeListeners:function Bl(Bv){var Bu=this.model;BW.forEach(Bv,function(Bw){Bu.detachEventListener(Bw);});},raiseModelEvent:function AN(Bu){this.model.raiseEvent(Bu);},getTableNames:function AY(){var Bw=this.model,Bu=Bw.importSources,Bx,Bv=[],By;for(By in Bu){if(Bu.hasOwnProperty(By)){Bx=Bu[By];if(Bx&&Bx.tableID){Bv.push({n:Bx.sourceInfo.name,id:Bx.tableID});}}}return Bv;},getCurrentSource:function AU(){return this.model.currentSource;},createNewReportInstance:function(Bz){var Bu=this,Bv=this.getModel(),Bx=Bv.currentDataset,Bw=Bv.isManagedCube,By=null;if(!Bx){if(Bw){By={extParams:"<mgo>1</mgo>"};}Bu.dataService.createEMMAReportInstance(Bz,By);}else{Bu.duplicateSelectedDataset(Bz);}},removeCurrentReportInstance:function(B0){var Bv=this,Bx=Bv.getDocController(),Bw=this.getModel(),Bz=Bv.dataService,By=Bw.curDataset;var Bu={success:function(){Bw.curDataset=null;Bw.currentDataset=null;Bz.messageID=null;if(B0.success){B0.success();}},failure:function(B1){Bv.displayError(B1&&B1.message,false);},complete:function(){if(B0.complete){B0.complete();}}};if(By&&By.id){Bx.removeDataset(Bu,By);}else{Bu.success();Bu.complete();}},backFromQB:function(){var Bu=this;if(Bu.dialogController.pageZIndex===0){Bu.removeCurrentReportInstance({success:function(){Bu.showPage(mstrmojo.DI.DIConstants.pageType.dataSelection);}});}else{Bu.showPage(mstrmojo.DI.DIConstants.pageType.dataSelection);}},saveSourceListAdminConfig:function(By,Bx){var Bu=this,Bw=this.getModel(),Bv={};var Bz={success:function(){Bu.showPage(AZ.pageType.dataSelection);}};Bw.populateSourceListAdminConfig(By,Bx);if(By||Bx){if(mstrApp.diParams.connectorConfig){Bv=mstrApp.diParams.connectorConfig;}else{Bv={};}if(By){Bv.resourceConfig=By;}if(Bx){Bv.dbRoleConfig=Bx;}if(mstrApp.isSingleTier){this.dataService.updatePreferences(Bz,"diConnectorConfig",JSON.stringify(Bv));}else{this.dataService.setPreference(Bz,{prefs:"diConnectorConfig\u001E"+JSON.stringify(Bv)});}}else{Bz.success();}},showSaveVisual:function(){this.rootView.showSaveVisual();},closeDIPopup:An,getAttributesAndMetrics:function BI(B0,B2){var Bu,Bz,Bx=[],B1=[],Bw=12,Bv=4,By=B2?B2.toUpperCase():"";Bu=this.getModel().getImportSource(B0);if(!Bu){return[Bx,B1];}Bz=Bu.getCurrentMappings(function(B3){return B3.selected&&(!By||B3.alias.toUpperCase().indexOf(By)!==-1);});Bx=mstrmojo.array.filter(Bz,function(B3){return B3.tp===Bw;});B1=mstrmojo.array.filter(Bz,function(B3){return B3.tp===Bv;});return[Bx,B1];},getDBRoles:function C(Bv,Bu){var Bx={taskId:"arch.search",sessionState:mstrApp.sessionState||"",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:(Bv||[]).join(","),versionFilter:"",typeExcludeFilter:"",versionExcludeFilter:"",isDataImport:true};var By={success:function Bw(Bz){if(mstrApp.placeholder==="DIApp"){mstrApp.dbRoles=Bz;mstrApp.dbRolesAdminConfig=BW.map(Bu,function(B0){return B0;});}}};mstrApp.serverRequestParallel(Bx,By);},beforeDIUnload:function(Bv){var Bw=mstrmojo.desc(14610,"Are you sure you want to navigate away from this page? Any unsaved work will be lost."),Bz=this.getModel().operationMode,By=this.rootView,Bu=this.dialogController,Bx=false;if(Bz===AZ.operationMode.create||Bz===AZ.operationMode.edit){if(Bu.pageZIndex>0){Bx=true;}else{if(By&&By.currentPage&&By.currentPage.pageType===AZ.pageType.emmaPreview){Bx=true;}}}if(Bx){Bv.returnValue=Bw;return Bw;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIRootView","mstrmojo.DI.DIExpressView","mstrmojo.DI.DIModel","mstrmojo.DI.DIRootController","mstrmojo.Editor","mstrmojo.DI.DIConstants","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.form","mstrmojo._IsWebApp");mstrmojo.requiresDescs(12537,12538);var X=mstrmojo.DI.DIConstants,A=mstrmojo.dom,Q=null;var C="progressBar",S={scriptClass:"mstrmojo.Editor",id:C,showTitle:false,help:null,zIndex:99,cssClass:"mstrmojo-di-progressBar",children:[{scriptClass:"mstrmojo.ProgressBar",alias:"progress",cssClass:"mstrmojo-di-progress stripes"}],onremoveChild:function(Y){var a=Y.value;for(var Z=0;Z<a.length;Z++){a[Z].destroy();}},postCreate:function(){this.counter=0;},updateProgress:function O(Y){this.progress.updateProgress(Y);},progressTextValue:function K(Y){if(this.progress){this.progress.set("progressText",Y);}},open:function G(Z,Y){if((++this.counter>0&&!this.visible)||Y.manually){mstrmojo.Editor.prototype.open.call(this,Z,Y);}},close:function H(Z){var Y=this.counter=Math.max(0,this.counter-1);if((Y<=0&&this.visible)||Z.manually){if(!this.manually||Z.manually){this.counter=0;this.manually=false;mstrmojo.Editor.prototype.close.call(this,Z);this.updateProgress(0);}}}};mstrmojo.DI.DIApp=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsWebApp],{enableWaitBox:true,getWaitBoxPosition:function(){var Y={};var Z=mstrmojo.dom.position(this.rootController.rootView.headerNode);if(Z&&Z.h!==0&&Z.y!==0){Y.top=Z.h+Z.y;}return Y;},start:function B(){var Z;if(mstrApp.diParams.StatusCode===undefined||mstrApp.diParams.StatusCode===X.operationMode.edit||mstrApp.diParams.StatusCode===X.operationMode.create){Z=mstrApp.isCloudPro?new mstrmojo.DI.DIExpressView({placeholder:this.placeholder}):new mstrmojo.DI.DIRootView({placeholder:this.placeholder,cssClass:"mojo-theme-light"});}else{Z=new mstrmojo.Box({placeholder:this.placeholder});}var a={model:new mstrmojo.DI.DIModel({id:"DIModel"}),rootView:Z};var Y=this.rootController=new mstrmojo.DI.DIRootController(a);this.addDisposable(Y);Y.start();Q=this.beforeUnload.bind(Y);A.attachEvent(window,"beforeunload",Q);},destroy:function V(Y){if(Q){A.detachEvent(window,"beforeunload",Q);Q=null;}this._super(Y);},beforeUnload:function(Y){var Z=this;return Z.beforeDIUnload(Y);},restart:function N(Y){var Z=document.getElementById(this.rootController.rootView.id);var a=document.createElement("div");a.id=this.placeholder||"DIApp";mstrmojo.dom.replace(Z,a);this.rootController.destroy();if(mstrmojo.all[C]){mstrmojo.all[C].destroy();}mstrmojo.hash.copy(Y,this.diParams);this.start();},getRootController:function P(){return this.rootController;},applicationName:function F(){var Z=X.application,Y;if(this.diParams.CloudEdition===Z.cloudProfessional){Y=mstrmojo.desc(12538,"MicroStrategy Express");}else{if(this.diParams.CloudEdition===Z.cloudPersonal){Y=mstrmojo.desc(12538,"MicroStrategy Express");}else{Y=mstrmojo.desc(12537,"Data Import");}}return Y;},executeCommand:function R(Y,Z){this.serverProxy.cancelRequests();if(typeof this[Y]==="function"){this[Y](Z);}else{this.getRootController().executeCommand(Y,Z);}},showProgress:function L(Y){if(!Y){Y={message:mstrmojo.desc(5720,"Waiting...")};}if(Y.showCancel===undefined){Y.showCancel=false;}if(Y.showProgressText&&Y.progressText){Y.message=Y.progressText;}this.showWait(Y);},hideProgress:function I(Y){this.hideWait(Y);},setProgressParams:function W(Y,Z){var a=mstrmojo.all[C];if(a){if(Z&&Z.showProgressText){a.progressTextValue(Z.progressText);S.progressTextValue(Z.progressText);}if(Y){a.updateProgress(Y);}}else{if(Z&&Z.showProgressText){S.progressTextValue(Z.progressText);}if(Y){S.updateProgress(Y);}}},serverResponse:function E(c,Z,a,Y,b){mstrmojo.all[c][Z](a,!!Y,b);},activeRequests:[],serverRequest:function M(c,d,Y,Z){var b={},a=this;if(Y.hideFailureErr===undefined){b.hideFailureErr=true;}b.silent=!Y.showProgress;b.waitBoxCfg=Z||{showCancel:false};b.waitBoxCfg.position=a.getWaitBoxPosition();if(Y.showProgress&&Y.showProgressText){b.waitBoxCfg.message=Y.progressText;}this.activeRequests.push(c);d=mstrmojo.func.wrapMethods({complete:function(){a.activeRequests.splice(mstrmojo.array.indexOf(a.activeRequests,c),1);}},d,{});this._super(c,d,b);},serverRequestParallel:function D(Y,Z){window.setTimeout(function(){var b=new mstrmojo.SimpleXHR(),a=Z;b.request("POST",mstrConfig.taskURL,{success:function(c){if(a.success){a.success(c);}},failure:function(c){if(a.failure){a.failure({code:c.getResponseHeader("X-MSTR-TaskErrorCode"),message:c.getResponseHeader("X-MSTR-TaskFailureMsg")});}},complete:function(){if(a.complete){a.complete();}}},Y);},0);},redirectToPage:function U(Y){this.showProgress();mstrmojo.form.send(Y,mstrApp.name,"POST",null,null,false);},updateSessionState:function J(Y){this._super(Y);if(this.activeRequests){this.activeRequests.forEach(function(Z){if(Z.sessionState){Z.sessionState=Y;}});}},oneTierOAuthHandler:function T(Y){if(this.rootController.oAuthController){this.rootController.oAuthController.oneTierOAuthHandler(Y);}}});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIApp","mstrmojo._IsPopup","mstrmojo.Container","mstrmojo.hash","mstrmojo._IsMovable");var F=mstrmojo.css;function H(){this.dataImportParams={isNewAnalysis:true,isEdit:false,isCloudPro:false,isEmmaCube:true,isDirectDataAccess:false,isManagedCube:false,ReportId:undefined,CubeName:undefined,FolderId:undefined,CubeDesc:undefined,AnalysisId:undefined,StatusCode:0,CreateAnalysis:1,CreateReportServices:1,CreateViewReport:1,CubeQuota:200,Delete:1,EnableFTPImport:true,EnableFileImport:true,EnableHttpImport:true,EnableURLImport:true,ShowDDAOptions:true,ImportDatabase:1,AccessDataFromFiles:1,AccessDataFromCloudApp:1,Republish:1,Share:1,Subscriptions:1,UploadSizeLimit:100,datasets:null,hasNonRADataset:false,documentModel:null,missingCredentialsData:null,refreshMultipleCubes:false};}mstrmojo.DI.DIContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.DI.DIContainer",id:"DIContainer",cssClass:"mstrmojo-di-popup",markupString:'<div id="{@id}" class="{@cssClass}"><div id="DIApp"></div><div class="mstrmojo-DIEditor-curtain"></div></div>',markupSlots:{curtainNode:function(){return this.domNode.lastChild;}},draggable:true,launchingApp:null,dataImportParams:null,init:function(I){if(this._super){this._super(I);}H.call(this);},getMovingHandle:function G(){return this.rootView.headerNode;},onOpen:function C(){this.launchingApp=mstrApp;var I=this.dataImportParams;window.mstrApp=new mstrmojo.DI.DIApp();mstrmojo.hash.copy({placeholder:"DIApp",isEdit:I.isEdit,isNewAnalysis:I.isNewAnalysis,isCloudPro:I.isCloudPro,isEMMACube:I.isEmmaCube,isPopup:true,showDDAOptions:I.showDDAOptions,diParams:I,refreshMultipleCubes:I.refreshMultipleCubes,features:this.launchingApp.features,cubeSaveFolderId:I.cubeSaveFolderId},mstrApp);var J=["isSingleTier","projectName","serverName","serverPort","authMode","sessionManager","enableWarningSessionTimeout","maxSessionIdleTime","timeBeforeSessionTimeoutWarning","name","sessionState","persistTaskParams","helpUrl","helpLocaleId","localeId","userHelpPage","autocomplete","isCloud","features"];if(this.launchingApp.serverProxy){J.push("serverProxy");}mstrmojo.hash.copyProps(J,this.launchingApp,mstrApp);mstrApp.launchingApp=this.launchingApp;mstrApp.container=this;this.curtainNode.style.zIndex=this.domNode.style.zIndex-1;this.domNode.style.display="block";this.curtainNode.style.display="block";mstrApp.start();if(mstrApp.isSingleTier){window.FormWrapper.toggleNetMenu("disable");}this.docMouseDown=document.onmousedown;document.onmousedown=null;this.docMouseMove=document.onmousemove;document.onmousemove=null;this.docMouseUp=document.onmouseup;document.onmouseup=null;F.toggleClass(document.body,"user-select-none",true);},onClose:function B(){var I=window.mstrApp;window.mstrApp=this.launchingApp;mstrApp.sessionState=I.sessionState;I.destroy();this.domNode.style.display="none";this.curtainNode.style.display="none";H.call(this);this.destroy();if(mstrApp.isSingleTier){window.FormWrapper.toggleNetMenu("enable");}document.onmousedown=this.docMouseDown;document.onmousemove=this.docMouseMove;document.onmouseup=this.docMouseUp;F.toggleClass(document.body,"user-select-none",false);},preBuildRendering:function E(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},setPosition:function D(K,J){var I=this.domNode,L=I&&I.style;if(L){L.left=K;L.top=J;}},isDragValid:function A(I){var J=this.rootView.header.searchTable,K;K=this._super(I);if(K&&J.visible){K=!mstrmojo.dom.contains(J.domNode,I.src.node,true,this.getMovingHandle());}return K;}});}());