mstrmojo.mstr.EnumWebAPIErrorCodes={MSI_INBOX_MSG_NOT_FOUND:-2147468986,AUTHEN_E_LOGIN_FAIL_EXPIRED_PWD:-2147216963,AUTHEN_E_LOGIN_FAILED_NEW_PASSWORD_REQD:-2147216960,AUTHEN_E_LOGIN_FAIL:-2147216959,DOCDATA_PREPARE_TASK_REPORT_INCOMP:-2147466604,E_MSI_USERMGR_USER_NOTFOUND:-2147209051,MSI_SERVER_NOT_FOUND:-2147206923,DFC_QRYENG_RES_TRUNC:-2147205488,POOL_OBJECT_NOT_FOUND_BY_ID:-2147467398,MSI_CUBE_NOT_PUBLISHED:-2147072488,MSI_DocumentDataPreparationTask_ReportIncomplete:-2147466604,E_UNUSED:4294967295};(function(){mstrmojo.StringBuffer=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.StringBuffer",append:function A(C){if(!this.buf){this.reset();}this.buf[++this.len]=C;return this;},reset:function B(){this.buf=[];this.len=-1;}});mstrmojo.StringBuffer.prototype.toString=function(D){var C=this.buf;return(C&&C.join(D||""))||"";};}());(function(){mstrmojo.requiresCls("mstrmojo.StringBuffer","mstrmojo.hash");var B="AndroidServerTransport";mstrmojo.android.AndroidServerTransport={serverRequest:function A(I,H,F){var E=new mstrmojo.StringBuffer(),G,D;mstrmojo.hash.forEach(F.params,function(J,K){E.append(K+"="+encodeURIComponent(J));});G=F.taskURL+"?"+E.toString("&");F.params.hostUrl=F.taskURL;if(mstrApp.useBinaryFormat){D=JSON.stringify({params:F.params,url:G});}else{D=G;}$MAPF(true,B,"transportRequest");mstrMobileTransport.serverRequest(I,H,D,"response","progress");},cancelRequest:function C(D){$MAPF(false,B,"transportRequest");return mstrMobileTransport.cancelRequest(D);}};})();(function(){mstrmojo.requiresCls("mstrmojo.hash");var B=mstrmojo.hash;mstrmojo.Base=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Base",init:function A(C){B.copy(C,this);if(this.postApplyProperties){this.postApplyProperties();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var G=mstrmojo.dom;function C(I){if(I.hasChildNodes()){while(I.childNodes.length>=1){I.removeChild(I.firstChild);}}}function F(S,L){var K=this.getPages.call(this),N=K.current,O=K.next,Q=this;var J=0,M=0,P=0,I=0,R=O.offsetWidth;if(S.an===this.ANIMATION_FORWARD){I=-R;M=R;}else{P=-R;J=R;}G.translate(N,J,0,0);G.translate(O,M,0,0);B(P,I,L,{target:Q.sliderNode,duration:L,onEnd:function(){Q.finishTurn.call(Q);},preStart:function(){this.target.style.overflowY="hidden";}});}function B(M,J,L,K){var I=mstrmojo.hash.copy(K,{props:{left:{isStyle:true,start:M,stop:J,suffix:"px",ease:mstrmojo.ease.linear}},duration:L});(new mstrmojo.fx.AnimateProp(I)).play();}mstrmojo.winphone._IsMobileBookletWinPhone={_mixinName:"mstrmojo.winphone._IsMobileBookletWinPhone",cleanCurrentPage:function A(I){C(I);},turnPageAnimation:function E(I,K,J){F.call(this,K,500);},moveNextView:function D(J,I){},hideMessage:function H(){var I=this.msg.domNode;(new mstrmojo.fx.FadeOut({target:I})).play();mstrmojo.css.parkAfterFade({target:I});}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.Obj");var K=mstrmojo.hash;var P=0;var F=[];var J={};var L=false;function I(T){var U=T.callback;if(U.submission){U.submission(T.id,this.userInteractionRequired(T),T);}this.submitRequest(T);}function G(){if(F.length&&!L){I.call(this,F.shift());}}mstrmojo.ServerProxy=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ServerProxy",transport:null,cnt:0,request:function E(d,a,U,V){if(U){this.cancelRequests();}var X=this.id,Y=this.transport,T=mstrmojo.now()+a.taskId+P++,W=d.canceled||mstrmojo.emptyFn;d.canceled=function(e){W();d.complete(true);return Y.cancelRequest(e);};d=mstrmojo.func.wrapMethods(d,{complete:function(e){mstrmojo.all[X].deleteRequest(e);}});var Z=!K.isEmpty(this._requests),b=this.createRequest(T,d,a,V),c=(L||Z)&&!V.doNotHold;if(c){F.push(b);}else{I.call(this,b);}return T;},hasRequests:function O(){return !K.isEmpty(this._requests)||L;},createRequest:function Q(V,X,W,T){var U=this._requests;if(!U){U=this._requests={};}U[V]={id:V,callback:X,params:W,config:T};return U[V];},submitRequest:function M(T){this.transport.serverRequest(this.id,T.id,T);},cancelRequests:function S(){var T=false;K.forEach(this._requests,function(U){if(U.gotResponse===undefined){T|=U.callback.canceled(U.id);}});this._requests={};F=[];return T;},cancelRequest:function B(X){var U=false,W=this._requests[X],V,T=F.length;for(V=0;V<T;V++){if(F[V]===W){break;}}if(V<T){F.splice(V,1);delete this._requests[X];U|=W.callback.canceled(W.id);}return U;},response:function A(X,T,V){$MAPF(false,"AndroidServerTransport","transportRequest");var W=this.getRequest(X);if(W){W.gotResponse=true;var Y=W.callback,U=(T&&!V.mstrerr)?"success":"failure";try{if(Y[U]){Y[U](V,W);}}finally{Y.complete(X);}}G.call(this);},deleteRequest:function N(U){var T=this._requests;delete T[U];},getRequest:function H(U){var T=this._requests;return T&&T[U];},userInteractionRequired:function C(T){return false;},addLoadingGraph:function D(T){J[T]=true;L=true;},removeLoadingGraph:function R(T){delete J[T];if(K.isEmpty(J)){L=false;G.call(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.android.medium.RootView","mstrmojo.winphone._IsMobileBookletWinPhone");mstrmojo.winphone.RootView=mstrmojo.declare(mstrmojo.android.medium.RootView,[mstrmojo.winphone._IsMobileBookletWinPhone],{scriptClass:"mstrmojo.winphone.RootView"});}());(function(){mstrmojo.requiresCls("mstrmojo.MobileDoc","mstrmojo.winphone._IsMobileBookletWinPhone");mstrmojo.winphone.MobileDoc=mstrmojo.declare(mstrmojo.MobileDoc,[mstrmojo.winphone._IsMobileBookletWinPhone],{scriptClass:"mstrmojo.winphone.RootView"});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.css","mstrmojo.hash");var H=mstrmojo.css,D=mstrmojo.hash,B="glow";var F=mstrmojo.android.ui.Button=mstrmojo.declare(mstrmojo.Button,[mstrmojo._TouchGestures],{scriptClass:"mstrmojo.android.ui.Button",onclick:mstrmojo.emptyFn,touchBegin:function E(){if(this.enabled){H.addClass(this.domNode,B);}},touchTap:function C(J){if(this.enabled){this.onclick({e:J.evt});}},touchSelectBegin:mstrmojo.emptyFn,touchSelectEnd:function A(J){if(this.enabled){this.onclick({e:J.evt});}},touchEnd:function I(){H.removeClass(this.domNode,B);}});F.prototype.markupString=F.prototype.markupString.replace(new RegExp(" mstrAttach:[a-zA-Z,]*"),"");F.newButton=function G(M,L,K){var J={scriptClass:"mstrmojo.android.ui.Button",text:M};if(L){J.onclick=L;}D.copy(K,J);return J;};}());(function(){mstrmojo.requiresCls("mstrmojo.android.medium.ViewFactory","mstrmojo.winphone.MobileDoc");mstrmojo.winphone.ViewFactory=mstrmojo.declare(mstrmojo.android.medium.ViewFactory,null,{scriptClass:"mstrmojo.winphone.ViewFactory",newRootView:function A(B){return new mstrmojo.winphone.RootView(B);},mobileDoc:mstrmojo.winphone.MobileDoc});}());(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo.hash");var A="mstrmojo-TextBoxWithLabel";mstrmojo.TextBoxWithLabel=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextBoxWithLabel",label:"",rightLabel:"",cssDisplay:"inline",type:"text",markupString:'<div class="'+A+' {@cssClass}" style="{@cssText}"><span class="mstrmojo-TextBox-label">{@label}</span><input id="{@id}" class="mstrmojo-TextBox {@inputNodeCssClass}"  style="{@inputNodeCssText}" title="{@tooltip}" type="{@type}" value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur/><span class="mstrmojo-TextBox-label-right">{@rightLabel}</span></div>',markupSlots:{inputNode:function(){return this.domNode.firstChild.nextSibling;},lblNode:function(){return this.domNode.firstChild;}}});mstrmojo.TextBoxWithLabel.prototype.markupMethods=mstrmojo.hash.copy({oncssClassChange:function(){var B=this.cssClass;this.domNode.className=A+(B?" "+B:"");},onlabelChange:function(){this.lblNode.innerText=this.label||"";}},mstrmojo.hash.copy(mstrmojo.TextBoxWithLabel.prototype.markupMethods));}());(function(){mstrmojo.requiresCls("mstrmojo.ServerProxy","mstrmojo.android.ui.Button","mstrmojo.Box","mstrmojo.TextBoxWithLabel","mstrmojo.Label","mstrmojo.hash","mstrmojo.mstr.EnumWebAPIErrorCodes");mstrmojo.requiresDescs(11,17,18,26,7904,5088,9935,10672);var D="mobileLogin",a="changePassword",b=mstrmojo.android.ui.Button.newButton,O=mstrmojo.desc,X=mstrmojo.hash,h=mstrmojo.mstr.EnumWebAPIErrorCodes,C={},d={},A={ANDROID_PHONE:3,ANDROID_TAB:4},I={OLD_PASSWORD:0,NEW_PASSWORD:1,CONFIRM_NEW_PASSWORD:2},Q={};function W(m){var l=this,i=m.pid,n=m.id,j=C[i],k=m.params.projectID,o={taskId:"getProjectSettings"};if(j){o.sessionState=j;}else{o.projectID=k;}mstrApp.serverRequest(o,{success:function(p){Q[i]=true;l.transport.serverRequest(l.id,n,m);},failure:function(p){var q=m.callback;if(q.failure!==undefined){q.failure(p);}q.complete(n);}},{skipLogin:true,doNotHold:true});}function N(n){var l=String(mstrMobileApp.getLocaleInfo());if(l){var m=l.split(",");for(var k=0;k<m.length;k++){var j=m[k].split(":");n[j[0]]=j[1];}}return n;}function g(o,i){var m,k=[],l={id:"new_pwd_reqd",title:O(5088),cssClass:"mstrmojo-CredentialsDialog",loginInfo:o.loginInfo},j=o.loginInfo,n=function(q,r){return function(){r(q);};}(o,i);k.push({scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-PasswordDialog-Label",text:"You must supply a new password."});l.children=k;l.buttons=[b(O(221,"Cancel"),function(){m.manualClose=true;mstrApp.cancelPending();}),b(O(1442,"OK"),n,{enabled:true})];m=mstrApp.showDialog(l);}function e(p,i){var n,m,k=[],l={id:"password_prompt"+mstrmojo.now(),title:p.title,cssClass:"mstrmojo-CredentialsDialog",loginInfo:p.loginInfo},j=p.loginInfo,o=function(q,r){return function(){var t=n.children,s=t[0].children[0];switch(q.dlgType){case I.OLD_PASSWORD:j.pwd=s.value;break;case I.NEW_PASSWORD:j.npwd=s.value;break;}r(q);};}(p,i);m=mstrmojo.getInstance(b(O(1442,"OK"),o,{enabled:p.enableOK}));k.push({scriptClass:"mstrmojo.Box",cssDisplay:"table",children:[{scriptClass:"mstrmojo.TextBoxWithLabel",label:O(18)+":",value:"",type:"password",cssDisplay:"table-row",onvalueChange:function(){if(p.dlgType==I.CONFIRM_NEW_PASSWORD){m.set("enabled",this.value==j.npwd);}}}]});l.children=k;l.buttons=[b(O(221,"Cancel"),function(){mstrApp.cancelPending();}),m];n=mstrApp.showDialog(l);}function M(l){var i=this._mobileCfg,j=l.pid,n=i.getProject(j),m={cfg:i,projectId:j,project:n,transport:this.transport,loginInfo:i.getLoginInfo(j)},k=this;mstrApp.hideMessage();m.loginInfo.uid=l.params.userid;g(m,function(o){e(X.copy({title:"Enter your old password",dlgType:I.OLD_PASSWORD,enableOK:true},o),function(p){e(X.copy({title:"Enter your new password",dlgType:I.NEW_PASSWORD,enableOK:true},p),function(q){e(X.copy({title:"Confirm your new password",dlgType:I.CONFIRM_NEW_PASSWORD,enableOK:(q.loginInfo.npwd=="")},q),function(s){var r=function(u){return function(x){var v=u.loginInfo,z=v.npwd,w=v.uid;if(n.udc){var y=i.getServerByProjectId(j);y.pdc.ps=z;y.pdc.lo=w;}else{n.pc.ps=z;n.pc.lo=w;}i.saveConfiguration();l.params.password=z;S.call(k,l);};}(s),t=function(u){var v=l.callback;if(v.failure!==undefined){v.failure(u);}v.complete(l.id);};k.request({success:r,failure:t},{taskId:a,server:s.project.sn,userid:s.loginInfo.uid,oldPassword:s.loginInfo.pwd,newPassword:s.loginInfo.npwd},false,{projectId:j,mobileConfig:i,doNotHold:true});});});});});}function H(r,q,p,i){if(mstrApp.isHosted()){var m,s,k=mstrmojo.getInstance,j=function(w,t,v,u){return k(X.copy(u,{scriptClass:"mstrmojo.TextBoxWithLabel",cssDisplay:"table-row",label:O(w)+":",value:r[t],type:v||"text",onEnter:function(){if(s.enabled){s.onclick({e:{stopPropagation:mstrmojo.emptyFn}});}}}));},l=j(17,"uid",null,{onRender:function(){this.focus();},onvalueChange:function(){s.set("enabled",!!this.value.length);}}),n=j(18,"pwd","password");s=k(b(O(9935,"Log In"),function(){var t=r.uid=l.value;r.pwd=n.value;if(t.length){window.setTimeout(function(){p();},100);}},{enabled:false}));m=mstrApp.showDialog({id:"user_creds_prompt",title:(q?O(7904):O(11))+" "+O(26),cssClass:"mstrmojo-CredentialsDialog",loginInfo:r,children:[{scriptClass:"mstrmojo.Box",cssDisplay:"table",children:[l,n]}],buttons:[b(O(221,"Cancel"),function(){m.manualClose=true;mstrApp.cancelPending();}),s]});}else{var o=JSON.parse(mstrMobileApp.promptForCredentials(q,i));if(o.ok){var i=r.uid=o.uid;r.pwd=o.pwd;if(i.length){window.setTimeout(function(){p();},100);}}else{mstrApp.cancelPending();}}}function L(i){return((i.wsam>1)&&!i.wsuid);}function K(i){return(!i.uid&&i.am!=2);}function U(i,o){var j=i,m=false;var l=function(p){var q={uid:j.wsuid,pwd:j.wspwd},r=function(){j.wsuid=q.uid;j.wspwd=q.pwd;j.updateCfgAfterLogin|=1;p();};H.call(this,q,true,r,j.server.nm);};var n=function(p){var q={uid:j.uid,pwd:j.pwd},r=function(){j.uid=q.uid;j.pwd=q.pwd;j.updateCfgAfterLogin|=2;p();};H.call(this,q,false,r,j.project.pn);};if(L(j)&&K(j)){var k=this;l.call(this,function(){n.call(k,o);});}else{if(L(j)){l.call(this,o);}else{if(K(j)){n.call(this,o);}else{o();}}}}function c(m){var j=this._mobileCfg,k=m.pid,n=j.getProject(k),l=n.realPid,i=j.getLoginInfo(k);if(mstrApp.useBinaryFormat&&l){m.params.projectID=l;return true;}return false;}function f(m){var p=this,o=p._mobileCfg,n=m.pid,q=m.params.projectID,k=p.transport,i=p.id,r={success:function(t){var s=d[n]=mstrmojo.hash.obj2array(t);mstrmojo.hash.copy(s,mstrmojo.locales);if(mstrApp.useBinaryFormat){W.call(p,m);}else{Q[n]=true;k.serverRequest(i,m.id,m);}},failure:function(t){var s=m.callback;if(s.failure!==undefined){s.failure(t);}s.complete(m.id);}},l={taskId:"getLocaleInfo"},j={projectId:n,mobileConfig:o,skipLogin:true,doNotHold:true};if(q){l.projectID=q;}p.request(r,l,false,j);}function S(m){var p=this,o=p._mobileCfg,n=m.pid,s=o.getProject(n),l=p.transport,i=p.id,t=o.getLoginInfo(n),k=false,j,r=function(v){s.posLoginFlag=false;var x={success:function(AA){clearInterval(j);s.es=AA.hasEmailScreenPriv;if(t.updateCfgAfterLogin){o.updateLoginInfo(n,t);}o.setRealPid(s,AA.projectID);var z=C[n]=AA.sessionState;mstrMobileApp.putSession(n,z);m.params.sessionState=z;if(AA.isCompatible===false){mstrApp.handleCompatibilityError(m);}f.call(p,m);},failure:function(AD){var AG=m.callback,AI=c.call(p,m),z=(AD.status==401),AH=(AD.code==h.AUTHEN_E_LOGIN_FAIL)||(AD.status==401),AC=mstrmojo.emptyFn,AF=o.getLoginInfo(n),AA=z||AH||(L(AF)||K(AF));if((AG.failure!==undefined)&&!z){AD.noErrorMessage=AI||AA||AD.requireDeviceCertificate;AD.handledError=AA||AD.requireDeviceCertificate;AG.failure(AD);}if(!AA){AG.complete(m.id);}if(AI&&!mstrMobileApp.isOnline()){f.call(p,m);}else{AD.method="login";if(AA){if(AH){o.clearLoginInfoForProject(n);}if(z){var AB=o.getServerByProjectId(n),AE;if(AB.udc){AE=o.getDefaultServerCreds();}else{AE=AB.wsc;}delete AE.lo;delete AE.ps;o.saveConfiguration();AD.message=O(14575,"Login failure.");}AD.handledError=false;AD.useToast=true;AC=function(){k=true;};}mstrApp.onerror(AD,AC);}}},y=A,w=N({taskId:D,server:s.sn,project:s.pn,userid:t.uid,password:t.pwd,wsSize:10,authMode:t.am,wsuid:t.wsuid,wspwd:t.wspwd,wsam:t.wsam,clientVersion:mstrMobileApp.getAppVersion(),clientType:mstrMobileApp.isTablet()?y.ANDROID_TAB:y.ANDROID_PHONE}),u={projectId:n,mobileConfig:o,doNotHold:true};p.request(x,w,false,u);},q=r;U.call(this,t,r);j=setInterval(function(){if(k){k=false;t=o.getLoginInfo(n);U.call(p,t,r);}},500);}mstrmojo.MobileServerProxy=mstrmojo.declare(mstrmojo.ServerProxy,null,{scriptClass:"mstrmojo.MobileServerProxy",getSessions:function(){return C;},request:function J(l,k,j,i){this._projectId=i.projectId;this._mobileCfg=i.mobileConfig;return this._super(l,k,j,i);},createRequest:function Z(m,o,n,j){var l;try{l=this._super(m,o,n,j);var i=this._projectId;l.pid=i;if(!j.noTaskURL){l.taskURL=this._mobileCfg.getTaskUrlByProject(i);}l.isLogin=(n.taskId===D);l.isPwdChange=(n.taskId==a);}catch(k){this.deleteRequest(m);throw k;}return l;},userInteractionRequired:function E(l){var i=false;if(l.pid&&!C[l.pid]){var k=l.config.mobileConfig.getLoginInfo(l.pid),m=((k.wsam>1)&&!k.wsuid),j=(!k.uid&&k.am!=2);return m||j;}return i;},submitRequest:function V(j){if(j.isLogin||j.isPwdChange){this._super(j);return ;}var k=C[j.pid],i=d[j.pid];if(k){j.params.sessionState=k;if(i){mstrmojo.hash.copy(i,mstrmojo.locales);}this._super(j);}else{if(j.config.skipLogin){this._super(j);return ;}if(mstrMobileApp.isOnline()){S.call(this,j);}else{if(c.call(this,j)){if(!Q[j.pid]){f.call(this,j);}else{this._super(j);}}else{S.call(this,j);}}}},response:function B(l,i,j){var k=this.getRequest(l);if(!k){return ;}if(!i&&mstrMobileApp.isOnline()){switch(parseInt(j.code,10)){case h.AUTHEN_E_LOGIN_FAIL_EXPIRED_PWD:case h.AUTHEN_E_LOGIN_FAILED_NEW_PASSWORD_REQD:M.call(this,k);return ;break;case h.MSI_INBOX_MSG_NOT_FOUND:break;case h.E_MSI_USERMGR_USER_NOTFOUND:if(!k.isLogin){delete k.params.sessionState;S.call(this,k);return ;}break;}}this._super(l,i,j);},getSession:function Y(i){return C[i];},setSession:function G(i,j){C[i]=j;},closeSession:function R(i){},closeAllSessions:function T(){C={};},getLocaleInfo:function F(i){return d[i];},hasEmailScreenPrivilege:function P(i){return false;}});}());