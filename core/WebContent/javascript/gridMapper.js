mstrGridMapperImpl.prototype=new Object();mstrGridMapperImpl.prototype.getAreas=function(bone,map,gridDimensions){try{if(!bone.elem||bone.gridStructureInfo.emptyCase){return null;}this.gridContainerScrollLeft=bone.gridTable.parentElement.scrollLeft;var tBody=bone.elem.getElementsByTagName("tbody")[0];if(tBody==null||tBody.rows==null){return null;}var maskSubType=null;switch(map.getAttribute(microstrategy.HTMLATTR_MASKFOR)){case microstrategy.DSSTYPE_METRIC:case microstrategy.DSSTYPE_USER_METRIC:case microstrategy.DSSTYPE_USER_SUMMARY_METRIC:maskSubType=microstrategy.SUBOBJTYPE_METRIC;break;case microstrategy.DSSTYPE_RPT_DEFINITION:maskSubType=microstrategy.DSSTYPE_RPT_DEFINITION;break;default:maskSubType=microstrategy.SUBOBJTYPE_ATTRIBUTE;break;}var areas={length:0};if(maskSubType==microstrategy.DSSTYPE_RPT_DEFINITION){return this.buildGridArea(areas,gridDimensions);}var bgs=bone.gridStructureInfo;if(bgs.isEmptyTemplate){this.buildEmptyTemplateAreas(areas,tBody,gridDimensions,(bgs.pageAxis&&bgs.pageAxis.findUnit("")));return areas;}var areMetricsOnRows=(bgs.metricsAxis==microstrategy.GRIDCELL_AXIS_ROWS);var areMetricsOnCols=(bgs.metricsAxis==microstrategy.GRIDCELL_AXIS_COLUMNS);var rows=bgs.rowAxis.getAxisUnitInfos(new Array());var cols=bgs.colAxis.getAxisUnitInfos(new Array());var i,j,coords,isLastUnit,maskEnd,cell;var h,w,t,l;var depthObj=this.getMaxDepthObj(cols,1,bgs);if(rows.length==0&&bone.showEmptyAxis){this.buildEmptyRowAxis(areas,tBody.rows[tBody.rows.length-1].cells[0],gridDimensions);}else{if(rows.length>0&&rows[0].src){cell=rows[0].src;h=getObjHeight(cell);t=cell.offsetTop;for(i=0;i<rows.length;i++){coords=this.getCellCoordinates(i,rows,h,null,t,null);if(coords!=null){isLastUnit=(i>=rows.length-1);maskEnd=(maskSubType==microstrategy.SUBOBJTYPE_METRIC&&areMetricsOnRows)?coords.bottom:gridDimensions.height;areas=this.buildRowCellAreas(areas,coords,depthObj,gridDimensions,rows[i],isLastUnit,maskEnd);}}}}depthObj=this.getMaxDepthObj(rows,0,bgs);if(cols.length==0&&bone.showEmptyAxis&&bone.showColHeaders){this.buildEmptyColAxis(areas,tBody.rows[0].cells[tBody.rows[0].cells.length-1],gridDimensions);}else{if(cols.length>0&&cols[0].src){cell=cols[0].src;w=getObjWidth(cell);l=cell.offsetLeft;for(i=0;i<cols.length;i++){coords=this.getCellCoordinates(i,cols,null,w,null,l);if(coords!=null){var maxDepth=parseInt(cols[i].src.getAttribute(microstrategy.HTMLATTR_GRIDROW_MAX_DEPTH));isLastUnit=(i>=cols.length-1);maskEnd=(maskSubType==microstrategy.SUBOBJTYPE_METRIC&&areMetricsOnCols)?coords.right:gridDimensions.width;if(bone.gridStructureInfo.hasMetrics&&cols[i].needBuildColMetricAreas){areas=this.buildColMetricAreas(areas,cols[i].src,gridDimensions,getObjHeight(cols[i].src));cols[i].needBuildColMetricAreas=false;}else{areas=this.buildColCellAreas(areas,coords,depthObj,gridDimensions,cols[i],isLastUnit,maskEnd);}}}}}if(maskSubType==microstrategy.SUBOBJTYPE_METRIC&&(areMetricsOnCols||areMetricsOnRows)){var cellDimension=0;if(areMetricsOnCols){var metricUnit=bgs.metricAxis.get(0),metricRow=metricUnit.src.parentNode,metricsDepth,mrCells;if(!metricRow.cells){metricsDepth=bgs.colAxis.unitLength(bgs.metricsDepth);metricRow=tBody.rows[metricsDepth-1];}mrCells=metricRow.cells;this.isMetricTemplateUnit=(mrCells[0]&&mrCells[0].getAttribute("MH")&&mrCells[0].getAttribute("MH").toLowerCase()=="true");for(i=0;i<mrCells.length;i++){cell=mrCells[i];if(cell.nodeType==1&&cell.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_METRIC){if(this.firstColCell==null){this.firstColCell=true;}cellDimension=cellDimension||getObjHeight(cell);areas=this.buildColMetricAreas(areas,cell,gridDimensions,cellDimension);}}}if(areMetricsOnRows){for(i=cols.length;i<tBody.rows.length;i++){var row=tBody.rows[i];for(j=0;j<row.cells.length;j++){cell=row.cells[j];if(cell.nodeType==1&&cell.getAttribute(microstrategy.HTMLATTR_SUBOBJTYPE)==microstrategy.SUBOBJTYPE_METRIC){cellDimension=cellDimension||getObjWidth(cell);areas=this.buildRowMetricAreas(areas,cell,gridDimensions,cellDimension);}}}}}else{for(j=0;j<tBody.rows.length;j++){var tr=tBody.rows[j];if(tr.cells.length>0&&tr.cells[0].className.toLowerCase().indexOf("rowheader")!=-1){for(i=0;i<tr.cells.length;i++){if(tr.cells[i].className.toLowerCase().indexOf("metricvalue")!=-1){this.buildEmptyMetricAxis(areas,tr.cells[i],gridDimensions);break;}}break;}}}return areas;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridMapperImpl.prototype.getMaxDepthObj=function(cells,floor,gridStructureInfo){try{var unit=null;for(var i=cells.length-1;i>=floor;i--){if(cells[i].isVisible){unit=cells[i];break;}}var depthObj={depth:1,subDepth:1};if(unit!=null){if(unit.dssType==microstrategy.DSSTYPE_ATTRIBUTE||unit.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){if(unit.src){depthObj.depth=parseInt(unit.src.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH));depthObj.subDepth=parseInt(gridStructureInfo.getAttrFormPos(unit.src))+1;}else{if(unit.depth&&unit.subDepth){depthObj.depth=unit.depth;depthObj.subDepth=unit.subDepth;}}}else{if(unit.src){depthObj.depth=parseInt(unit.src.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH))+1;}else{if(unit.depth){depthObj.depth=unit.depth;}}}}return depthObj;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridMapperImpl.prototype.buildEmptyTemplateAreas=function(areas,tbody,gridDimensions,metricsOnPageBy){try{this.buildEmptyRowAxis(areas,tbody.rows[1].cells[0],gridDimensions);if(metricsOnPageBy){this.buildEmptyColAxis(areas,tbody.rows[0].cells[0],gridDimensions);}else{this.buildEmptyColAxis(areas,tbody.rows[0].cells[1],gridDimensions);this.buildEmptyMetricAxis(areas,tbody.rows[1].cells[1],gridDimensions);}}catch(err){microstrategy.errors.log(err);}};mstrGridMapperImpl.prototype.buildEmptyRowAxis=function(areas,td,gridDimensions){try{var y=getObjWidth(td);var x=td.offsetTop/2;var a=new mstrAreaObjectImpl();a.coords="0,0,"+y+","+x;a.pointsTo=microstrategy.GRIDCELL_AXIS_COLUMNS+",1,1";a.onmouseovercoords="0,0,"+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;a=new mstrAreaObjectImpl();a.coords="0,"+(x+1)+","+y+","+gridDimensions.height;a.pointsTo=microstrategy.GRIDCELL_AXIS_ROWS+",1,1";a.onmouseovercoords="0,0,"+gridDimensions.height+","+microstrategy.DND_HILITE_WIDTH;areas[areas.length++]=a;}catch(err){microstrategy.errors.log(err);}};mstrGridMapperImpl.prototype.buildEmptyColAxis=function(areas,td,gridDimensions){try{var a=new mstrAreaObjectImpl();a.coords=td.offsetLeft+",0,"+gridDimensions.width+","+getObjHeight(td);a.pointsTo=microstrategy.GRIDCELL_AXIS_COLUMNS+",1,1";a.onmouseovercoords="0,0,"+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;}catch(err){microstrategy.errors.log(err);}};mstrGridMapperImpl.prototype.buildEmptyMetricAxis=function(areas,td,gridDimensions){try{var a=new mstrAreaObjectImpl();a.coords=td.offsetLeft+","+td.offsetTop+","+gridDimensions.width+","+gridDimensions.height;a.pointsTo=microstrategy.GRIDCELL_AXIS_COLUMNS+",-1,1";a.onmouseovercoords="0,"+td.offsetTop+","+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;}catch(err){microstrategy.errors.log(err);}};mstrGridMapperImpl.prototype.buildRowCellAreas=function(areas,coords,depthObj,gridDimensions,unit,isLastUnit,maskEnd){try{var a=new mstrAreaObjectImpl();a.coords=coords.left+","+coords.top+","+coords.right+","+coords.vThird;a.pointsTo=microstrategy.GRIDCELL_AXIS_COLUMNS+","+depthObj.depth+","+depthObj.subDepth;a.onmouseovercoords="0,"+coords.top+","+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;if(unit.depth==1&&unit.subDepth==1){a=new mstrAreaObjectImpl();a.coords=coords.left+","+coords.vThird+","+coords.hMidPoint+","+maskEnd;a.pointsTo=unit.axis+","+unit.depth+","+unit.subDepth;a.onmouseovercoords=((coords.left>=0)?coords.left:0)+",0,"+gridDimensions.height+","+microstrategy.DND_HILITE_WIDTH;areas[areas.length++]=a;}else{if(unit.dssType==microstrategy.DSSTYPE_HIERARCHY&&unit.lastHiSrc){a=new mstrAreaObjectImpl();a.coords=(coords.left+(getObjWidth(unit.src)/2))+","+coords.vThird+","+coords.hMidPoint+","+maskEnd;a.pointsTo=unit.axis+","+unit.depth+","+unit.subDepth;a.onmouseovercoords=((coords.left>=0)?coords.left:0)+",0,"+gridDimensions.height+","+microstrategy.DND_HILITE_WIDTH;areas[areas.length++]=a;}}var depth=unit.depth;var subDepth=unit.subDepth+1;a=new mstrAreaObjectImpl();a.coords=coords.hMidPoint+","+coords.vThird+","+((isLastUnit)?coords.right:coords.hEndPoint)+","+maskEnd;if(unit.dssType==microstrategy.DSSTYPE_ATTRIBUTE||unit.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){a.pointsTo=unit.axis+","+unit.depth+","+(unit.subDepth+1);}else{a.pointsTo=unit.axis+","+(unit.depth+1)+",1";}a.onmouseovercoords=coords.right+",0,"+gridDimensions.height+","+microstrategy.DND_HILITE_WIDTH;areas[areas.length++]=a;return areas;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridMapperImpl.prototype.buildColCellAreas=function(areas,coords,depthObj,gridDimensions,unit,isLastUnit,maskEnd){try{a=new mstrAreaObjectImpl();a.coords=coords.left+","+coords.top+","+coords.hThird+","+gridDimensions.height;a.pointsTo=microstrategy.GRIDCELL_AXIS_ROWS+","+depthObj.depth+","+depthObj.subDepth;a.onmouseovercoords=coords.left+",0,"+gridDimensions.height+","+microstrategy.DND_HILITE_WIDTH;areas[areas.length++]=a;if(unit.depth==1&&unit.subDepth==1){a=new mstrAreaObjectImpl();a.coords=coords.hThird+","+coords.top+","+maskEnd+","+coords.vMidPoint;a.pointsTo=unit.axis+","+unit.depth+","+unit.subDepth;a.onmouseovercoords="0,"+coords.top+","+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;}else{if(unit.dssType==microstrategy.DSSTYPE_HIERARCHY&&unit.lastHiSrc){a=new mstrAreaObjectImpl();a.coords=coords.hThird+","+(coords.top+(getObjHeight(unit.src)/2))+","+maskEnd+","+coords.vMidPoint;a.pointsTo=unit.axis+","+unit.depth+","+unit.subDepth;a.onmouseovercoords="0,"+coords.top+","+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;}}a=new mstrAreaObjectImpl();a.coords=coords.hThird+","+coords.vMidPoint+","+maskEnd+","+((isLastUnit)?gridDimensions.height:coords.vEndPoint);if(unit.dssType==microstrategy.DSSTYPE_ATTRIBUTE||unit.dssType==microstrategy.DSSTYPE_ATTRIBUTE_FORM){a.pointsTo=unit.axis+","+unit.depth+","+(unit.subDepth+1);}else{a.pointsTo=unit.axis+","+(unit.depth+1)+",1";}a.onmouseovercoords="0,"+coords.bottom+","+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;return areas;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridMapperImpl.prototype.buildColMetricAreas=function(areas,cell,gridDimensions,cellHeight){try{var offset=(!this.isMetricTemplateUnit&&this.firstColCell?3:0);var left=getObjSumLeft(cell)-gridDimensions.left+offset;var top=getObjSumTop(cell)-gridDimensions.top;var height=cellHeight;var width=getObjWidth(cell);var midPoint=left+Math.floor(width/2);var right=left+width-offset;var bottom=top+height;if(right>gridDimensions.width-microstrategy.DND_HILITE_WIDTH){right=gridDimensions.width-((mstrGridReport.isRWD()?2:1)*microstrategy.DND_HILITE_WIDTH);}var axis=microstrategy.GRIDCELL_AXIS_METRICS;var depth=parseInt(cell.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH));var subDepth=1;var a=new mstrAreaObjectImpl();a.coords=left+",0,"+midPoint+","+gridDimensions.height;a.pointsTo=axis+","+depth+","+subDepth;a.onmouseovercoords=left+",0,"+gridDimensions.height+","+microstrategy.DND_HILITE_WIDTH;areas[areas.length++]=a;a=new mstrAreaObjectImpl();a.coords=midPoint+",0,"+right+","+gridDimensions.height;a.pointsTo=axis+","+(depth+1)+","+subDepth;a.onmouseovercoords=right+",0,"+gridDimensions.height+","+microstrategy.DND_HILITE_WIDTH;areas[areas.length++]=a;this.firstColCell=false;return areas;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridMapperImpl.prototype.buildGridArea=function(areas,gridDimensions){try{var a=new mstrAreaObjectImpl();a.coords="0,0,"+gridDimensions.width+","+gridDimensions.height;areas[areas.length++]=a;return areas;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridMapperImpl.prototype.buildRowMetricAreas=function(areas,cell,gridDimensions,cellWidth){try{var left=getObjSumLeft(cell)-gridDimensions.left+3;var top=getObjSumTop(cell)-gridDimensions.top;var height=getObjHeight(cell);var midPoint=top+Math.floor(height/2);var right=left+cellWidth;var bottom=top+height;var axis=microstrategy.GRIDCELL_AXIS_METRICS;var depth=parseInt(cell.getAttribute(microstrategy.HTMLATTR_GRIDCELL_DEPTH));var subDepth=1;var a=new mstrAreaObjectImpl();a.coords="0,"+top+","+gridDimensions.width+","+midPoint;a.pointsTo=axis+","+depth+","+subDepth;a.onmouseovercoords="0,"+top+","+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;a=new mstrAreaObjectImpl();a.coords="0,"+midPoint+","+gridDimensions.width+","+bottom;a.pointsTo=axis+","+(depth+1)+","+subDepth;a.onmouseovercoords="0,"+bottom+","+microstrategy.DND_HILITE_WIDTH+","+gridDimensions.width;areas[areas.length++]=a;return areas;}catch(err){microstrategy.errors.log(err);return null;}};mstrGridMapperImpl.prototype.getCellCoordinates=function(index,axis,h,w,t,l){try{var unit=axis[index];if(!unit.isVisible){return null;}var cell=unit.src;var __result={};__result.top=t||cell.offsetTop;__result.left=l||cell.offsetLeft-this.gridContainerScrollLeft;if(unit.dssType==microstrategy.DSSTYPE_HIERARCHY&&unit.lastHiSrc){__result.height=h||unit.lastHiSrc.offsetTop+getObjHeight(unit.lastHiSrc)-__result.top;__result.width=w||unit.lastHiSrc.offsetLeft+getObjWidth(unit.lastHiSrc)-__result.left;}else{__result.height=h||getObjHeight(cell);__result.width=w||getObjWidth(cell);}__result.vThird=Math.floor(__result.top+(__result.height/3));__result.vMidPoint=__result.top+Math.floor(__result.height/2);__result.bottom=__result.top+__result.height;__result.hThird=Math.floor(__result.left+(__result.width/3));__result.hMidPoint=__result.left+Math.floor(__result.width/2);__result.right=__result.left+__result.width;if(index<axis.length-1){__result.hEndPoint=__result.right+(Math.floor(getObjWidth(axis[index+1].src)/2));__result.vEndPoint=__result.bottom+(Math.floor(getObjHeight(axis[index+1].src)/2));}return __result;}catch(err){microstrategy.errors.log(err);return null;}};function mstrGridMapperImpl(){return this;}