(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.ui.pathbar.PathPopup","mstrmojo.dom","mstrmojo.css");function setPopUpPosition(){var me=this,dn=me.domNode,pos=mstrmojo.dom.position(me.targetNode),winDimension=mstrmojo.dom.windowDim();dn.style.top=(pos.y+pos.h+me.offsetTop)+"px";var left=pos.x+pos.w,right=winDimension.w-left-dn.offsetWidth;if(left+dn.offsetWidth>winDimension.w){right=winDimension.w-pos.x;if(right+dn.offsetWidth>winDimension.w){right=0;}}if(me.id==="mstrToolbarList"){right=right-pos.w*0.75;}dn.style.right=right+"px";me.set("visible",false);me.isOpen=true;me.set("visible",true);var top=parseInt(dn.style.top,10);if(top+dn.offsetHeight>winDimension.h){var newTop=top-dn.offsetHeight+pos.h;dn.style.top=(newTop>0?newTop:0)+"px";}mstrmojo.css.toggleClass(me.targetNode,"opened",true);}function updateZoomValue(){var popup=this.popup,zoomElement=popup.containerNode.childNodes[0].childNodes[0].childNodes[popup.zoomChildIndex].lastChild,textContent=zoomElement.textContent||zoomElement.innerText,zoomValue=popup.dc.view.zoomValue;textContent=textContent.substr(0,textContent.indexOf("("));zoomElement.innerHTML=textContent+"("+zoomValue.n+")";}function updateZoomSelection(zoomPopup){var currentSelectedChild=zoomPopup.selectedItem;if(currentSelectedChild===null){return ;}var selectionNode=zoomPopup.containerNode.firstChild.firstChild,zoomValue=zoomPopup.dc.view.zoomValue,currentDssid=currentSelectedChild.getAttribute("dssid");if(currentDssid===zoomValue.dssid){return ;}mstrmojo.css.removeClass(currentSelectedChild,"selected");var children=selectionNode.childNodes,len=children.length,i=0,newSel=-1,child;for(i=0;i<len;i++){child=children[i];if(child.getAttribute("dssid")===zoomValue.dssid){newSel=i;break;}}if(newSel===-1){var zoomList=zoomPopup.children[0];zoomList.addItems([zoomValue]);child=selectionNode.childNodes[zoomList.items.length-1];}mstrmojo.css.addClass(child,"selected");zoomPopup.selectedItem=child;}function createZoomPopup(menuItems,parent,target){var zoomPopup;parent.addDisposable(zoomPopup=new mstrmojo.ui.pathbar.PathPopup({id:"mstrZoomPopup",cssClass:"mstrShortcutsListPopup",targetNode:target,dc:parent.dc,slectedIndex:-1,selectedItem:null,onOpen:function onOpen(){setPopUpPosition.call(this);},onClose:function onClose(){delete this.isOpen;mstrmojo.css.toggleClass(this.targetNode,"opened",false);this.domNode.style.top="-10000px";},children:[{scriptClass:"mstrmojo.ui.pathbar.List",alias:"menuItems",preclick:function preclick(){this.parent.close();},items:menuItems,getItemMarkup:function(){return'<a class="item {@cls}" dssid="{@dssid}"><span class="icon"></span><span>{@name}</span></a>';},getItemProps:function getItemProps(item,idx){var selected=item.dssid===this.parent.dc.view.zoomValue.dssid,clsName="";if(selected){this.parent.selectedIndex=idx;clsName="selected";}return{cls:clsName,dssid:item.dssid,name:item.n};},onclick:function onclick(evt){var parent=this.parent,elem=mstrmojo.dom.findAncestorByAttr(evt.getTarget(),"dssid",true,parent.domNode),target=elem.node,dssid=target.getAttribute("dssid"),cmd=parent.targetNode.getAttribute("cmdid"),dc=parent.dc,zoomValue=dc.view.zoomValue,currZoomDssid=zoomValue.dssid;if(dssid!==currZoomDssid){dc[cmd](dssid);var textContent=parent.targetNode.lastChild.textContent||parent.targetNode.lastChild.innerText;parent.targetNode.lastChild.innerHTML=textContent.replace(zoomValue.n,target.lastChild.textContent||target.lastChild.innerText);if(parent.selectedItem===null){parent.selectedItem=this.domNode.firstChild.childNodes[parent.selectedIndex];}mstrmojo.css.removeClass(parent.selectedItem,"selected");mstrmojo.css.addClass(target,"selected");parent.selectedItem=target;}}}]}));return zoomPopup;}function createExportPopup(menuItems,parent,target){var exportPopup;parent.addDisposable(exportPopup=new mstrmojo.ui.pathbar.PathPopup({id:"mstrExportPopup",cssClass:"mstrShortcutsListPopup",targetNode:target,dc:parent.dc,onOpen:function onOpen(){setPopUpPosition.call(this);},onClose:function onClose(){delete this.isOpen;mstrmojo.css.toggleClass(this.targetNode,"opened",false);this.domNode.style.top="-10000px";},children:[{scriptClass:"mstrmojo.ui.pathbar.List",alias:"menuItems",preclick:function preclick(){this.parent.close();},items:menuItems,getItemMarkup:function(){return'<a class="item" dssid="{@dssid}"><span class="icon" style="display:none;"></span><span>{@name}</span></a>';},getItemProps:function getItemProps(item){return{cls:item.cssClass,dssid:item.dssid,name:item.n};},onclick:function onclick(evt){var elem=mstrmojo.dom.findAncestorByAttr(evt.getTarget(),"dssid",true,this.parent.domNode),target=elem.node,dssid=target.getAttribute("dssid"),dc=this.parent.dc;dc.exportCmd(dssid);}}]}));return exportPopup;}function createPopup(){this.addDisposable(this.popup=new mstrmojo.ui.pathbar.PathPopup({id:"mstrToolbarList",cssClass:"mstrShortcutsListPopup",targetNode:this.domNode,offsetTop:0,zoomChildIndex:null,onOpen:function onOpen(){setPopUpPosition.call(this);},children:[{scriptClass:"mstrmojo.ui.pathbar.List",alias:"menuItems",items:mstrApp.pathInfo.tbModelData.n.items,getItemMarkup:function(){return'<a class="item {@cls}" cmdId="{@cmdid}" idx="{@idx}"><span class="icon" style="display:none;"></span><span>{@name}</span></a>';},getItemProps:function getItemProps(item,idx){var isSelected=!!item.selected,cmdid=item.cmdid,name=item.tooltip||item.title||cmdid;if(cmdid==="zoom"){name+=" ("+this.parent.dc.view.zoomValue.n+")";this.parent.zoomChildIndex=idx;}return{sel:isSelected,idx:idx,cls:cmdid,n:cmdid,cmdid:cmdid,name:name};},closePopup:function closePopup(popUp){if(popUp){popUp.close();}},onmouseover:function onmouseover(event){var elem=mstrmojo.dom.findAncestorByAttr(event.getTarget(),"cmdid",true,document.getElementById("mstrToolbarList")),cmd=elem&&elem.value,parent=this.parent,exportPopup=parent.exportPopup,zoomPopup=parent.zoomPopup;if(cmd==="export"){this.onclick(event,elem);this.closePopup(zoomPopup);}else{if(cmd==="zoom"){this.onclick(event,elem);this.closePopup(exportPopup);}else{if(cmd){this.closePopup(exportPopup);this.closePopup(zoomPopup);}}}return false;},onclick:function onclick(event,element){event.cancel();var elem=element||mstrmojo.dom.findAncestorByAttr(event.getTarget(),"cmdid",true,document.getElementById("mstrToolbarList")),target=elem.node,idx=target.getAttribute("idx"),cmd=elem&&elem.value,parent=this.parent,dc=parent.dc,menuItems=[],rect=null;if(cmd==="export"){if(!parent.exportPopup){menuItems=this.items[idx].items;parent.exportPopup=createExportPopup(menuItems,parent,target);}var exPopup=parent.exportPopup;exPopup.autoPosition=false;rect=target.getBoundingClientRect();if(!exPopup.isOpen){exPopup.offsetTop=-(rect.height||target.offsetHeight);exPopup.open();}}else{if(cmd==="zoom"){if(!parent.zoomPopup){menuItems=this.items[idx].items;parent.zoomPopup=createZoomPopup(menuItems,parent,target);}var zoomPopup=parent.zoomPopup;zoomPopup.autoPosition=false;rect=target.getBoundingClientRect();if(!zoomPopup.isOpen){zoomPopup.offsetTop=-(rect.height||target.offsetHeight);if(zoomPopup.hasRendered){updateZoomSelection.call(this,zoomPopup);}zoomPopup.open();}}else{if(dc[cmd]){dc[cmd]();parent.close();}}}}}]}));}mstrmojo.ui.pathbar.PathHamburger=mstrmojo.declare(mstrmojo.Widget,null,{userName:null,init:function init(props){this._super(props);},scriptClass:"mstrmojo.ui.pathbar.PathHamburger",markupString:'<div id="mstrHamburger" mstrAttach:click class="mstrHamburgerButton" style="top:0"><div class="mstrHamburger path"></div></div>',popup:null,postBuildRendering:function postBuildRendering(){createPopup.call(this);},onclick:function onclick(){var mPopup=this.popup;if(!mPopup.dc){mPopup.dc=this.parent.dc;}if(!mPopup.isOpen){if(mPopup.hasRendered){updateZoomValue.call(this);}mPopup.open();}}});}());