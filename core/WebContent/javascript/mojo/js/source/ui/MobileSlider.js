(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.css","mstrmojo.dom","mstrmojo.num","mstrmojo._TouchGestures");var $D=mstrmojo.dom,$CSS=mstrmojo.css,$MIN=Math.min,$MAX=Math.max,$RND=Math.round,$NUM=mstrmojo.num,$CD=$NUM.countOfDecimals;function initCal(){var cs=document.defaultView.getComputedStyle,ns=[this.leftNode,this.rightNode],ps=["border-left-width","padding-left","margin-left","border-right-width","padding-right","margin-right"],ds=[0,0],i,j;for(i=0;i<ns.length;i++){var styl=cs(ns[i]);for(j=0;j<ps.length;j++){ds[i]+=parseInt(styl.getPropertyValue(ps[j]),10)||0;}}this._lnExt=ds[0];this._rnExt=ds[1];if(!this._thumbLen){this._thumbLen=parseInt(this.thumbNode.offsetWidth,10);}this._length=this.domNode.clientWidth;this._effLen=$RND(this._length-this._thumbLen);this._unitLen=this._effLen/(this.max-this.min);}function position(v){var min=this.min,unitLength=this._unitLen,thumbLength=this._thumbLen/2,lLen=$RND((v-min)*unitLength);this.leftNode.style.width=(lLen+thumbLength-this._lnExt)+"px";this.rightNode.style.width=(this._effLen-lLen+thumbLength-this._rnExt)+"px";$D.translate(this.thumbNode,$MAX($MIN(lLen,(this.max-min)*unitLength),0),0);}function calValueWDelta(v,delta){var interval=this.interval;return $MIN($MAX(this.min,parseFloat(v,10)+$RND(delta/this._unitLen/interval)*interval),this.max).toFixed(this._intervalDecimals);}function calValueWX(x){return calValueWDelta.call(this,this.min,x-$D.position(this.domNode,true).x-this._thumbLen/2);}function getTouchRedirectFn(methodName){return function(touch){return this["touchSelect"+methodName](touch);};}mstrmojo.ui.MobileSlider=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._TouchGestures],{markupString:'<div class="mstrmojo-MobileSlider" style="visibility:hidden;"><div class="v"></div><div class="bk"></div><div class="th"><div></div></div><div class="min">{@minText}</div><div class="max">{@maxText}</div></div>',markupSlots:{leftNode:function(){return this.domNode.childNodes[0];},rightNode:function(){return this.domNode.childNodes[1];},thumbNode:function(){return this.domNode.childNodes[2];},minNode:function(){return this.domNode.childNodes[3];},maxNode:function(){return this.domNode.childNodes[4];}},markupMethods:{onvalueChange:function(){if(this.hasRendered){position.apply(this,[this.value]);}if(this.slidingValue!==this.value){this.set("slidingValue",this.value);}},onslidingValueChange:function(){if(this.hasRendered){position.apply(this,[this.slidingValue]);}}},value:0,slidingValue:0,max:10,min:0,interval:1,_intervalDecimals:0,init:function init(props){this._super(props);this._intervalDecimals=$CD(this.interval,".");},onintervalChange:function onintervalChange(n,v){this._intervalDecimals=$CD(v,".");},preBuildRendering:function preBuildRendering(){this.minText=$NUM.toLocaleString(this.min);this.maxText=$NUM.toLocaleString(this.max);this._super();},postBuildRendering:function postBuildRendering(){this._super();initCal.call(this);position.call(this,this.value);this.domNode.style.visibility="visible";},resize:function resize(){initCal.call(this);position.call(this,this.value);},touchBegin:function touchBegin(touch){touch.stop();},touchSelectBegin:function touchSelectBegin(touch){var target=touch.target;if(!target||target!==this.thumbNode){return this.bubbleTouchEvent(touch);}$CSS.addClass(this.domNode,"active");this.slidingValue=this.value;},touchSelectMove:function touchSelectMove(touch){this.set("slidingValue",calValueWDelta.apply(this,[this.value,touch.delta.x||0]));},touchSelectEnd:function touchSelectEnd(touch){$CSS.removeClass(this.domNode,"active");this.set("slidingValue",calValueWDelta.apply(this,[this.value,touch.delta.x||0]));this.set("value",this.slidingValue);},touchSwipeBegin:getTouchRedirectFn("Begin"),touchSwipeMove:getTouchRedirectFn("Move"),touchSwipeEnd:getTouchRedirectFn("End"),onclick:function onclick(evt,hWin){this.touchTap({clientX:$D.getMousePosition(evt.e,hWin).x});},touchTap:function touchTap(touch){this.set("value",calValueWX.call(this,touch.clientX));}});}());