(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ValidationTextBox","mstrmojo.hash","mstrmojo.css","mstrmojo.validation");var $H=mstrmojo.hash,$CSS=mstrmojo.css;var MIN_WIDTH_BETWEEN_LABELS=10,RANGE_WIDTH=205,MIN_WIDTH_BETWEEN_TICKS=30,RANGE_DATA_ORIGIN_OFFSET=75;function convertValue(value){var isNegativeValue=value<0;value=Math.abs(value);["B","M","K"].every(function(unit){var max={B:1000000000,M:1000000,K:1000}[unit],canShorten=value>=max;if(canShorten){value=Math.round(value/max)+unit;}return !canShorten;});if(value<1){value=value.toPrecision(3);}if(isNegativeValue){value="-"+value;}return String(value);}function adjustCtrlPosition(){var textLabel=this.minLabel,autoLabel=this.maxAutoLabel,minTextWgt=this.min,checkBox=this.minCheck,marginLeft=5;if(minTextWgt.domNode&&autoLabel){minTextWgt.domNode.style.marginLeft=textLabel.domNode.offsetWidth+marginLeft+"px";autoLabel.domNode.style.width=minTextWgt.domNode.offsetWidth-checkBox.domNode.offsetWidth+"px";}if(this.auto===undefined){this.autoNode.style.height="0px";}}function adjustLabelPosition(minkey,maxkey){var minTick=this[minkey+"Node"],maxTick=this[maxkey+"Node"],left=parseInt(minTick.style.left.replace("px",""),10)-RANGE_DATA_ORIGIN_OFFSET,right=parseInt(maxTick.style.right.replace("px",""),10),minLabel=this[minkey+"NodeLabel"],maxLabel=this[maxkey+"NodeLabel"];if(left===0&&right===0){minLabel.style.left=0;maxLabel.style.right=0;return ;}var minLabelLen=mstrmojo.dom.position(minLabel).w,maxLabelLen=mstrmojo.dom.position(maxLabel).w,tickDist=RANGE_WIDTH-left-right,minOffset=0,maxOffset=0;if(left>0){minOffset=left<minLabelLen/2?left:minLabelLen/2;}if(right>0){maxOffset=right<maxLabelLen/2?right:maxLabelLen/2;}var minWidth=tickDist+minOffset+maxOffset-minLabelLen-maxLabelLen,diff=MIN_WIDTH_BETWEEN_LABELS-minWidth;if(diff>0){if(minOffset===left){maxOffset=maxOffset+diff;}else{if(maxOffset===right){minOffset=minOffset+diff;}else{var leftDiff=diff*minLabelLen/(minLabelLen+maxLabelLen),rightDiff=diff-leftDiff;if(minOffset+leftDiff>left){maxOffset=maxOffset+diff-(left-minOffset);minOffset=left;}else{if(maxOffset+rightDiff>right){minOffset=minOffset+diff-(right-maxOffset);maxOffset=right;}else{minOffset=minOffset+leftDiff;maxOffset=maxOffset+rightDiff;}}}}}minLabel.style.left=-Math.round(minOffset)+"px";maxLabel.style.right=-Math.round(maxOffset)+"px";}function updateDisplay(){var range=this.getRange(),auto=this.getAuto();if(!range){return ;}if(!this.enabled){range=$H.copyProps(["min","max"],range);}if(auto){["Min","Max"].forEach(function(prop){var autoPropName="auto"+prop,valueAlias=prop.toLowerCase()+"Check",autoValue=auto[autoPropName];this[valueAlias].set("checked",autoValue);},this);}["Min","Max"].forEach(function(prop){var customPropName="custom"+prop,valueAlias=prop.toLowerCase(),customValue=range[customPropName];if(!range.hasOwnProperty(customPropName)){range[customPropName]=range[valueAlias];}this[valueAlias].setValue(isNaN(customValue)||!this.enabled?"":customValue);},this);var sortedTicks=$H.keyarray(range).map(function(key){var isMax=key.indexOf("x")>-1;return{key:key,val:Number(range[key]),positionProp:isMax?"right":"left",positionValue:0};}).sort(function(a,b){return a.val-b.val;}),unscaleLeft=false,unscaleRight=false,rangeMin=sortedTicks[0].val,rangeMax=sortedTicks[3].val,scaleValueDifference=rangeMax-rangeMin,scaleDomWidth=RANGE_WIDTH,middleLeftTick,middleRightTick;if(sortedTicks[1].val===rangeMin){if(sortedTicks[2].val!==rangeMax){middleLeftTick=middleRightTick=sortedTicks[2];}}else{middleLeftTick=sortedTicks[1];middleRightTick=(sortedTicks[2].val!==rangeMax)?sortedTicks[2]:sortedTicks[1];}function adjustTickPosition(whichSide,tick){var rangeTipVal=(whichSide==="left")?rangeMin:rangeMax,valDifference=Math.abs(tick.val-rangeTipVal),positionVal=Math.round(valDifference/scaleValueDifference*scaleDomWidth),unscaled=positionVal<MIN_WIDTH_BETWEEN_TICKS;positionVal=unscaled?MIN_WIDTH_BETWEEN_TICKS:positionVal;tick.unscaled=unscaled;tick.positionValue=(whichSide===tick.positionProp)?positionVal:RANGE_WIDTH-positionVal;if(unscaled){scaleDomWidth-=MIN_WIDTH_BETWEEN_TICKS;scaleValueDifference-=valDifference;}return unscaled;}if(middleLeftTick){unscaleLeft=adjustTickPosition("left",middleLeftTick);}if(middleRightTick&&!middleRightTick.unscaled){unscaleRight=adjustTickPosition("right",middleRightTick);if(middleRightTick.unscaled&&!middleLeftTick.unscaled){unscaleLeft=adjustTickPosition("left",middleLeftTick);}}$CSS.toggleClass(this.bgNode,"unscaleleft",unscaleLeft);$CSS.toggleClass(this.bgNode,"unscaleright",unscaleRight);sortedTicks.forEach(function(tick){var node=this[tick.key+"Node"],nodeLabel=this[tick.key+"NodeLabel"],positionProp=tick.positionProp,offset=(positionProp==="left")?RANGE_DATA_ORIGIN_OFFSET:0;node.style[positionProp]=tick.positionValue+offset+"px";nodeLabel.innerHTML=this.getConvertValue(tick.val);},this);adjustLabelPosition.call(this,"customMin","customMax");adjustLabelPosition.call(this,"min","max");adjustCtrlPosition.call(this);}function changeRange(){var widget=this,rangeWas=this.getRange(),range=$H.copy(rangeWas),controls=this;range.customMin=controls.min.value;range.customMax=controls.max.value;this.set("range",range);window.setTimeout(function(){widget.rangeChanged(range,rangeWas);},75);}function changeAuto(){var widget=this,autoWas=this.getAuto(),auto=$H.copy(autoWas),controls=this;auto.autoMin=controls.minCheck.checked;auto.autoMax=controls.maxCheck.checked;this.set("auto",auto);window.setTimeout(function(){widget.autoChanged();},75);}function fnGetTextBoxCfg(isMaximum,props){var slot="ctrlNodeLeft",hint=mstrmojo.desc(5416,"Min"),alias="min",otherBox="max";if(isMaximum){slot="ctrlNodeRight";hint=mstrmojo.desc(5417,"Max");alias="max";otherBox="min";}var textBoxCtrl={scriptClass:"mstrmojo.ValidationTextBox",slot:slot,hint:hint,alias:alias,valueChangeDelay:1000,dtp:5,required:true,useRichTooltip:true,constraints:{trigger:mstrmojo.validation.TRIGGER.NONE,min:null,max:null},setValue:function(value){var currentSync=this._sync;this._sync=true;if(value===""&&this.hasRendered){this.clearValidation();}this.set("value",value);this._sync=currentSync;},onvalueChange:function(){if(!this._sync){var widget=this.parent,other=this.parent[otherBox];other.resetConstraints(true);if(other.isValid()){this.updateConstraints();}else{this.resetConstraints(false);}this.validate();widget.set("inputValid",other.isValid()&&this.isValid());if(widget.inputValid){changeRange.call(widget);}}},resetConstraints:function(validateNow){$H.copyProps(["min","max"],this.parent.rangeConstraints[this.alias],this.constraints);if(validateNow){this.validate();}},updateConstraints:function(){this.resetConstraints(false);var constraint=this.parent.rangeConstraints[this.alias][otherBox],otherValue=parseFloat(this.parent[otherBox].value,10);if(!constraint){this.constraints[otherBox]=otherValue;}else{if(otherBox==="min"){this.constraints[otherBox]=constraint>otherValue?constraint:otherValue;}else{this.constraints[otherBox]=constraint<otherValue?constraint:otherValue;}}},updateTooltipConfig:function(){if(!this.enabled){this.richTooltip=null;return ;}var vs=this.validationStatus,originTooltip=(alias==="min"?mstrmojo.desc(12119,"Custom minimum value"):mstrmojo.desc(12120,"Custom maximum value")),tooltip=this.isValid()?originTooltip:this.getInvalidMsg(vs),cssClass=(this.isValid()?"vi-regular":"vi-warning")+" vi-tooltip-V";this.richTooltip={content:tooltip,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:cssClass,left:0,top:this.domNode.offsetHeight-30,refNode:this.domNode};}};$H.copy(props,textBoxCtrl);return textBoxCtrl;}function getTextBoxLabelCfg(isMaximum,slotPrefix){return{scriptClass:"mstrmojo.Label",text:isMaximum?mstrmojo.desc(13731,"Max:"):mstrmojo.desc(13732,"Min:"),cssDisplay:"inline-block",alias:isMaximum?"maxLabel":"minLabel",slot:slotPrefix+(isMaximum?"NodeRight":"NodeLeft")};}function getAutoCheckBoxCfg(isMaximum){return{scriptClass:"mstrmojo.ui.Checkbox",cssDisplay:"inline-block",alias:isMaximum?"maxCheck":"minCheck",slot:isMaximum?"autoNodeRight":"autoNodeLeft",oncheckedChange:function oncheckedChange(){var isMaximum=this.alias==="maxCheck",parent=this.parent,widget=parent,textWgt=isMaximum?parent.max:parent.min,checked=this.checked;textWgt.set("enabled",!checked);if(widget.auto){changeAuto.call(widget);}}};}function getAutoTextLabelCfg(isMaximum){return{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12143,"Automatic"),cssClass:"autoLabel",cssDisplay:"inline-block",alias:isMaximum?"maxAutoLabel":"minAutoLabel",slot:isMaximum?"autoNodeRight":"autoNodeLeft"};}mstrmojo.ui.editors.controls.CustomRange=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.CustomRange",range:null,rangeConstraints:{min:{min:null,max:null},max:{min:null,max:null}},inputValid:true,labelOfDataRange:mstrmojo.desc(13733,"Data Range"),labelOfCustomRange:"",markupString:'<div id="{@id}" class="mstrmojo-ui-CustomRange {@cssClass}"><div class="autoNode"><div class="autoNodeLeft"></div><div class="autoNodeRight"></div></div><div class="ctrlNode"><div class="ctrlNodeLeft"></div><div class="ctrlNodeRight"></div></div><div class="displayNode"><div class="bg"><div class="tip left"></div><div class="dot left"></div><div class="tip right"></div><div class="dot right"></div><div class="girder"></div></div><div class="custom min"><div class="tick-label"></div></div><div class="custom max"><div class="tick-label"></div></div><div class="actual min"><div class="tick-label"></div></div><div class="actual max"><div class="tick-label"></div></div><div class="lbl-cust-range" title="{@labelOfCustomRange}">{@labelOfCustomRange}</div><div class="lbl-data-range" title="{@labelOfDataRange}">{@labelOfDataRange}</div></div></div>',markupSlots:{autoNode:function(){return this.domNode.firstChild;},autoNodeLeft:function(){return this.domNode.firstChild.firstChild;},autoNodeRight:function(){return this.domNode.firstChild.lastChild;},ctrlNode:function(){return this.domNode.children[1];},ctrlNodeLeft:function(){return this.domNode.children[1].firstChild;},ctrlNodeRight:function(){return this.domNode.children[1].lastChild;},displayNode:function(){return this.domNode.lastChild;},bgNode:function(){return this.domNode.lastChild.firstChild;},customMinNode:function(){return this.domNode.lastChild.childNodes[1];},customMaxNode:function(){return this.domNode.lastChild.childNodes[2];},minNode:function(){return this.domNode.lastChild.childNodes[3];},maxNode:function(){return this.domNode.lastChild.childNodes[4];},customMinNodeLabel:function(){return this.domNode.lastChild.childNodes[1].firstChild;},customMaxNodeLabel:function(){return this.domNode.lastChild.childNodes[2].firstChild;},minNodeLabel:function(){return this.domNode.lastChild.childNodes[3].firstChild;},maxNodeLabel:function(){return this.domNode.lastChild.childNodes[4].firstChild;}},layoutConfig:{w:{ctrlNode:"100%",displayNode:"100%"},xt:true},init:function init(props){this.range={min:0,max:100000};$H.copy(props,this);var isAuto=props.auto,slotPrefix=isAuto?"auto":"ctrl",children=isAuto?[getTextBoxLabelCfg(false,slotPrefix),getAutoCheckBoxCfg(false),getAutoTextLabelCfg(false),this.getTextBoxCfg(false),getTextBoxLabelCfg(true,slotPrefix),getAutoCheckBoxCfg(true),getAutoTextLabelCfg(true),this.getTextBoxCfg(true)]:[getTextBoxLabelCfg(false,slotPrefix),this.getTextBoxCfg(false),getTextBoxLabelCfg(true,slotPrefix),this.getTextBoxCfg(true)];this.addChildren(children);},getTextBoxCfg:function getTextBoxCfg(isMaximum,props){return fnGetTextBoxCfg(isMaximum,props);},getConvertValue:function getConvertValue(value){return convertValue(value);},afterLayout:function afterLayout(){this.min.resetConstraints();this.max.resetConstraints();updateDisplay.call(this);},getRange:function getRange(){return $H.copy(this.range);},getAuto:function getAuto(){return $H.copy(this.auto);},rangeChanged:function rangeChanged(range,rangeWas){},onrangeChange:function(){updateDisplay.call(this);},updateDisplay:updateDisplay});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ui.editors.controls.CustomRange,{onenabledChange:function(){this.propagateChildProps("enabled");$CSS.toggleClass(this.displayNode,"disabled",!this.enabled);updateDisplay.call(this);this.set("inputValid",true);}});mstrmojo.ui.editors.controls.CustomRange.RangeType=null;}());