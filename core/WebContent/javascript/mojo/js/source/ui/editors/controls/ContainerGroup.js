(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.Label","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.LineStyleButton","mstrmojo.color","mstrmojo.hash","mstrmojo.models.FormatModel");var $COLOR=mstrmojo.color,FILL_COLOR_ALIAS="fillColor",BORDER_ALIAS="border",CTRL_FILL_COLOR=1,CTRL_BORDER=2,$FORMAT_MODEL=mstrmojo.models.FormatModel,$ENUM_FORMAT_PROPERTIES=$FORMAT_MODEL.ENUM_PROPERTY_NAMES,$FMT_PROP_FILL_COLOR=$ENUM_FORMAT_PROPERTIES.BACKGROUND_COLOR,targetBorderMap={all:{c:$ENUM_FORMAT_PROPERTIES.BORDER_COLOR,s:$ENUM_FORMAT_PROPERTIES.BORDER_STYLE},top:{c:$ENUM_FORMAT_PROPERTIES.BORDER_TOP_COLOR,s:$ENUM_FORMAT_PROPERTIES.BORDER_TOP_STYLE},right:{c:$ENUM_FORMAT_PROPERTIES.BORDER_RIGHT_COLOR,s:$ENUM_FORMAT_PROPERTIES.BORDER_RIGHT_STYLE},bottom:{c:$ENUM_FORMAT_PROPERTIES.BORDER_BOTTOM_COLOR,s:$ENUM_FORMAT_PROPERTIES.BORDER_BOTTOM_STYLE},left:{c:$ENUM_FORMAT_PROPERTIES.BORDER_LEFT_COLOR,s:$ENUM_FORMAT_PROPERTIES.BORDER_LEFT_STYLE}};function getTwoColumnContainer(alias,controls){controls.forEach(function(ctrl,idx){ctrl.slot="col"+(idx+1)+"Node";});var col2Width=this.secondColumnWidth;return{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:alias,col1Width:(100-col2Width)+"%",col2Width:col2Width+"%",children:controls};}function getColorPickerCfg(propName,showGradient,props){return mstrmojo.hash.copy(props,{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",showGradient:!!showGradient,postselectedValueChange:function(evt){this.parent.parent.raiseFormatValueChange(propName,evt.value,evt.valueWas);}});}function getBorderFormatValues(borderFormat){var borderColor="transparent",borderStyle="none",colorIdx;if(borderFormat){colorIdx=borderFormat.indexOf("#");if(colorIdx===-1){colorIdx=borderFormat.indexOf(borderColor);}}if(!isNaN(colorIdx)&&colorIdx>-1){borderStyle=borderFormat.substr(0,colorIdx-1);borderColor=$COLOR.fixFullHexValue(borderFormat.substr(colorIdx));}else{borderStyle=borderFormat;}if(borderStyle.indexOf("none")>-1){borderStyle="none";}return{s:borderStyle,c:borderColor};}mstrmojo.ui.editors.controls.ContainerGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.ContainerGroup",borderTitle:mstrmojo.desc(13631,"Outer border:"),showThickBorderStyle:true,showBackgroundNoFill:true,showBorderNoFill:true,visibleControls:CTRL_FILL_COLOR+CTRL_BORDER,targetBorder:"all",secondColumnWidth:60,init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-EditContainer");var controls=[],ctrlFlags=this.visibleControls,borderProperties=targetBorderMap[this.targetBorder];if((ctrlFlags&CTRL_FILL_COLOR)>0){controls.push(getTwoColumnContainer.call(this,FILL_COLOR_ALIAS,[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(7993,"Fill color:")},getColorPickerCfg($FMT_PROP_FILL_COLOR,true,{showNoFill:this.showBackgroundNoFill})]));}if((ctrlFlags&CTRL_BORDER)>0){controls.push(new mstrmojo.Label({text:this.borderTitle}));controls.push(getTwoColumnContainer.call(this,BORDER_ALIAS,[{scriptClass:"mstrmojo.ui.editors.controls.LineStyleButton",showThickOption:this.showThickBorderStyle,postselectedValueChange:function(evt){var containerGroup=this.parent.parent;containerGroup.raiseFormatValueChange(borderProperties.s,evt.value,evt.valueWas);containerGroup[BORDER_ALIAS].getControl(2).set("enabled",evt.value!=="none");}},getColorPickerCfg(borderProperties.c,false,{showNoFill:this.showBorderNoFill})]));}this.addChildren(controls);},setFormatSource:function setFormatSource(formats){var fillColorPicker=this[FILL_COLOR_ALIAS],borderContainer=this[BORDER_ALIAS],targetBorder=this.targetBorder,borderProperties=targetBorderMap[targetBorder];if(targetBorder==="all"){borderProperties=targetBorderMap.top;}this.syncControls(function(){if(fillColorPicker){var gradientColor=$FORMAT_MODEL.getGradientValues(formats),fillColor;if(!gradientColor){if(formats[$ENUM_FORMAT_PROPERTIES.FILL_STYLE]===1){fillColor="transparent";}else{var tempColor=formats[$FMT_PROP_FILL_COLOR];if(typeof tempColor==="undefined"||tempColor===null){tempColor=formats["background-color"];}if(typeof tempColor==="undefined"||tempColor===null){tempColor=-1;}fillColor=$FORMAT_MODEL.decodeValue($FMT_PROP_FILL_COLOR,tempColor);}}fillColorPicker.getControl(2).set("selectedValue",gradientColor||fillColor);}if(borderContainer){var borderValue=formats.border;if(!borderValue){if(typeof (formats.borderStyle)!=="undefined"&&formats.borderStyle!==null){borderValue=typeof (formats.borderStyle)==="string"?formats.borderStyle:$FORMAT_MODEL.decodeValue("borderStyle",formats.borderStyle);}else{borderValue=$FORMAT_MODEL.decodeValue(borderProperties.s,formats[borderProperties.s]);}if(typeof formats.borderColor!=="undefined"&&formats.borderColor!==null){borderValue+=" "+$FORMAT_MODEL.decodeValue("borderColor",formats.borderColor);}else{if(typeof formats[borderProperties.c]!=="undefined"&&formats[borderProperties.c]!==null){borderValue+=" "+$FORMAT_MODEL.decodeValue(borderProperties.c,formats[borderProperties.c]);}else{borderValue+=" "+$FORMAT_MODEL.decodeValue(borderProperties.c,-1);}}}var borderFormat=getBorderFormatValues(borderValue),borderColorPicker=borderContainer.getControl(2);borderContainer.getControl(1).set("selectedValue",borderFormat.s);borderColorPicker.set("enabled",borderFormat.s!=="none");borderColorPicker.set("selectedValue",borderFormat.c);}});}});mstrmojo.ui.editors.controls.ContainerGroup.CTRL_FLAGS={FILL_COLOR:CTRL_FILL_COLOR,BORDER:CTRL_BORDER};}());