(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.Label","mstrmojo.num","mstrmojo.expr","mstrmojo.ui.Pulldown","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ValidationTextBox","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.models.template.DataInterface");var colScenarioAlias="selColScenario",colWidthAlias="colTargetAndWidth",rowScenarioAlias="selRowScenario",rowHeightAlias="rowHeightContainer",$N=mstrmojo.num,$CFG=mstrConfig,$E=mstrmojo.expr,$SCENARIOS=mstrmojo.models.template.DataInterface.ENUM_GRID_RESIZE,$FIXED=$SCENARIOS.FIXED,$NEW_PULLDOWN=mstrmojo.ui.Pulldown.newPulldown;function getWidthTwoColumnContainer(alias,col1Control,fnTextChange){col1Control.slot="col1Node";return{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:alias,col1Width:"100%",col2Width:"56px",children:[col1Control,{scriptClass:"mstrmojo.Box",slot:"col2Node",value:0,enabled:true,children:[{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",cssText:"text-align:right;width:36px",cssDisplay:"inline-block",bindings:{value:"this.parent.value",enabled:"this.parent.enabled"},dtp:$E.DTP.NUMERIC,onValid:function(){var newValue,changed;if($N.UNIT.PX!==$CFG.units){newValue=parseFloat(this.value).toFixed(2);changed=newValue!==parseFloat(this.orignText);}else{newValue=parseInt(this.value,10);changed=newValue!==parseInt(this.orignText,10);}if(changed){fnTextChange.call(this.parent.parent.parent,newValue);}}},{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",cssText:"width:16px;padding-left:2px;",text:$N.UNIT_SYMBOL[$CFG.units],title:$CFG.unitsLabel}]}]};}function getScenarioPulldown(pulldownAlias,sizeAlias,isColWidth){var items=[{n:mstrmojo.desc(2987,"Fit to contents"),v:$SCENARIOS.FIT_TO_CONTENTS},{n:mstrmojo.desc(2050,"Fixed"),v:$FIXED}];if(isColWidth){items.unshift({n:mstrmojo.desc(13580,"Fit to container"),v:$SCENARIOS.FIT_TO_WINDOW});}return $NEW_PULLDOWN(items,function(item){var group=this.parent;group[sizeAlias].set("enabled",item.v===$FIXED);if(!group._sync){group.targetXtab.changeResizeScenario(item.v,isColWidth);}},undefined,{alias:pulldownAlias,isHostedWithin:false});}mstrmojo.ui.editors.controls.XtabResizeGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.XtabResizeGroup",init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-XtabResize");var group=this;this.addChildren([{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(159,"Columns:")},getScenarioPulldown(colScenarioAlias,colWidthAlias,true),getWidthTwoColumnContainer(colWidthAlias,$NEW_PULLDOWN([],function(item){var colWidthContainer=this.parent,colWidth=item.width,isColScenarioFixed=group.xtabInterface.getColResizeScenario()===$FIXED,columnWidths=group.xtabInterface.getColResizeInfo(group.targetXtab.model.docModel.datasets).widths||[{}];if(columnWidths.length){var firstWidth=columnWidths[0].width;if(isColScenarioFixed&&item._renderIdx!==undefined){group.targetXtab.edtModel._lsfcw=item._renderIdx;}if(colWidth===""){var isAllTheSame=columnWidths.every(function(colInfo){return colInfo.width===firstWidth;});if(isAllTheSame){colWidth=firstWidth;}}colWidthContainer.parent.syncControls(function(){colWidthContainer.getControl(2).set("value",(isColScenarioFixed&&colWidth!=="")?(($N.UNIT.PX===$CFG.units)?colWidth:parseFloat($N.convertUnits($N.UNIT.PX,$CFG.units,colWidth)).toFixed(2)):"");});}}),function(width){var column=this[colWidthAlias].getControl(1).getSelectedItem();this.targetXtab.changeColumnWidth(column.did,column.t,Math.round($N.convertUnits($CFG.units,$N.UNIT.PX,width)),column.depth||1,false);}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(113,"Rows:")},getScenarioPulldown(rowScenarioAlias,rowHeightAlias,false),getWidthTwoColumnContainer(rowHeightAlias,{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13581,"Row height:")},function(height){this.targetXtab.changeRowHeight(Math.round($N.convertUnits($CFG.units,$N.UNIT.PX,height)));})]);},targetXtab:null,xtabInterface:null,setFormatSource:function setFormatSource(xtab){var group=this,xtabInterface=group.xtabInterface=this.addDisposable(new mstrmojo.models.template.DataInterface(xtab.model.data)),isEmpty=xtabInterface.isEmpty(),editorModel=xtab.edtModel,lastSelectedFixedColumn=editorModel._lsfcw=editorModel._lsfcw===undefined?1:editorModel._lsfcw;group.targetXtab=xtab;group.set("enabled",!isEmpty);if(!isEmpty){this.syncControls(function(){var columnInfo=xtabInterface.getColResizeInfo(xtab.model.docModel.datasets),columnListItems=columnInfo.widths||[];group[colScenarioAlias].selectItemByField("v",columnInfo.v);var targetAndWidth=group[colWidthAlias],columnList=targetAndWidth.getControl(1);columnListItems.unshift({n:mstrmojo.desc(2429,"All Columns"),did:"all",width:""});columnList.set("items",columnListItems);columnList.set("selectedIndex",columnInfo.v===$FIXED?Math.min(lastSelectedFixedColumn,columnListItems.length-1):0);var rowInfo=xtabInterface.getRowResizeInfo(),rowResizeScenario=rowInfo.v,rowHeight=rowInfo.height;group[rowScenarioAlias].selectItemByField("v",rowResizeScenario);group[rowHeightAlias].getControl(2).set("value",rowResizeScenario===$FIXED?(($N.UNIT.PX===$CFG.units)?rowHeight:parseFloat($N.convertUnits($N.UNIT.PX,$CFG.units,rowHeight)).toFixed(2)):"");});}}});}());