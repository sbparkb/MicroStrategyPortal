(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo._HasSuggestion");var UNDETERMINED=-1,VALID=0,INVALID=1;mstrmojo._ValidateSuggestions=mstrmojo.provide("mstrmojo._ValidateSuggestions",mstrmojo.hash.copy(mstrmojo._HasSuggestion,{_mixinName:"mstrmojo._ValidateSuggestions",itemValidationField:"did",verifyObject:function verifyObject(t,w){var c=this.candidates,state;if(c){var items=c.items,idx=mstrmojo.array.find(items,this.itemValidationField,w.data[this.itemValidationField]);idx=idx>-1?idx:mstrmojo.array.find(items,this.itemField,t);if(idx>-1){w.updateData(items[idx]);state=VALID;}else{if(c.isComplete){state=INVALID;}}}if(state!==undefined){return state;}var q=this._vqueue=this._vqueue||[];q.push({pattern:t,id:w.data[this.itemIdField]});if(!this._vInProgress){this.verifyNextCandidate();}return UNDETERMINED;},verifyNextCandidate:function verifyNextCandidate(){var queue=this._vqueue;if(!queue||queue.length===0){this._vInProgress=false;return ;}this.verifyCandidate(queue.shift());},verifyCandidate:function verifyCandidate(info){var me=this;this._vInProgress=true;this.getCandidatesThroughTaskCall({pattern:info.pattern,blockBegin:1,blockCount:me.noCache?-1:this.suggestCount,isVerify:true},{success:function(res){var ws=me.ctxtBuilder.itemWidgets,len=ws&&ws.length,target,i;for(i=0;i<len;i++){if(ws[i].data[me.itemIdField]===info.id){target=ws[i];break;}}if(!target){return ;}var its=res.items;if(its&&its.length===1){target.updateData(its[0]);}else{if(its&&its.length>1){var idx=mstrmojo.array.find(its,"did",target.data.did);if(idx>-1){target.updateData(its[idx]);}else{target.set("state",INVALID);}}else{target.set("state",INVALID);}}},failure:function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){me.verifyNextCandidate();}});}}));mstrmojo._ValidateSuggestions.ENUM_STATES={UNDETERMINED:UNDETERMINED,VALID:VALID,INVALID:INVALID};}());