(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.hash","mstrmojo.array","mstrmojo.date","mstrmojo.Stepper","mstrmojo.android.ui.Button","mstrmojo.DateStepperContentProvider","mstrmojo.NumStepperContentProvider");var $A=mstrmojo.array,$D=mstrmojo.date,$H=mstrmojo.hash,$BTN=mstrmojo.android.ui.Button.newButton,DTP=mstrmojo.expr.DTP,DT={interval:1},H={min:1,max:12,interval:1,value:12},H24={min:0,max:23,interval:1,value:0},M={min:0,max:59,interval:1};function createChildren(){var dtp=this.dtp,sc=this.stepperClass,value=this[this.valueField],children=[],dateText,timeText;if(this._hasDate){children.push({scriptClass:sc,slot:"monthNode",alias:"monthStepper",title:mstrmojo.desc(871,"month"),provider:this.dateProvider.monthCP},{scriptClass:sc,slot:"dayNode",alias:"dayStepper",title:mstrmojo.desc(872,"day"),provider:this.dateProvider.dayCP},{scriptClass:sc,slot:"yearNode",alias:"yearStepper",title:mstrmojo.desc(873,"year"),provider:this.dateProvider.yearCP});}if(this._hasTime){children.push({scriptClass:sc,slot:"hourNode",alias:"hourStepper",provider:this.hourProvider},{scriptClass:sc,slot:"minNode",alias:"minStepper",provider:this.minProvider});}if(!this.hideSwitchers){if(dtp!==DTP.TIME){dateText=(value&&value.date)?$D.formatDateInfo(value.date,mstrmojo.locales.datetime.DATEOUTPUTFORMAT):mstrmojo.desc(2052,"Date");children.push($BTN(dateText,function(){this.parent.toDateView();},{alias:"dateToggle",slot:"switcherNode",cssClass:"",selected:true}));}if(dtp!==DTP.DATE){timeText=(value&&value.time)?$D.formatTimeInfo(value.time,mstrmojo.locales.datetime.TIMEOUTPUTFORMAT):mstrmojo.desc(2170,"Time");children.push($BTN(timeText,function(){this.parent.toTimeView();},{alias:"timeToggle",slot:"switcherNode",cssClass:"",selected:dtp==DTP.TIME}));}}if(this._hasDate){this.viewCssClass="dateView";}else{if(this._hasTime){this.viewCssClass="timeView";}}this.addChildren(children);}function createProviders(){var propNames=[this.valueField,"min","max"],dateItem=$H.copy(DT),hourItem=this.is24HourMode?$H.copy(H24):$H.copy(H),minItem=$H.copy(M),value=this[this.valueField],timeValue=value&&value.time,me=this;$A.forEach(propNames,function(p){dateItem[p]=$H.copy(me[p]);});if(this._hasDate){this.dateProvider=new mstrmojo.DateStepperContentProvider({item:dateItem,valField:this.valueField,canLoop:true,onTraverse:function(){me.updateDate();}});}if(this._hasTime){if(this.minuteInterval!==undefined){minItem.interval=this.minuteInterval;}delete this.minuteInterval;if(timeValue){if(!this.is24HourMode){hourItem.value=timeValue.hour%12||12;this.set("meridiem",(timeValue.hour<12));}else{hourItem.value=timeValue.hour;}minItem.value=timeValue.min;}this.hourProvider=new mstrmojo.NumStepperContentProvider({item:hourItem,valField:"value",canLoop:true,onTraverse:function(){me.updateTime();}});this.minProvider=new mstrmojo.NumStepperContentProvider({item:minItem,valField:"value",canLoop:true,renderer:{render:function(v){return String(v).length===1?("0"+v):v;}},onTraverse:function(){me.updateTime();}});}}mstrmojo.DateTimePicker=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DateTimePicker",value:null,min:null,max:null,meridiem:true,hideSwitchers:false,minuteInterval:null,is24HourMode:false,dtp:mstrmojo.expr.DTP.TIMESTAMP,viewCssClass:"",valueField:"value",stepperClass:"mstrmojo.Stepper",markupString:"<div id='{@id}' class='mstrmojo-DateTimePicker' style='{@cssText}'><div class='switcher'></div><div class='{@viewCssClass}'><span class='stepNode month'></span><span class='stepNode day'></span><span class='stepNode year'></span><span class='stepNode hour'></span><span class='stepNode min'></span><span class='meridiem' mstrAttach:click></div></div></div>",markupSlots:{switcherNode:function(){return this.domNode.firstChild;},viewNode:function(){return this.domNode.children[1];},monthNode:function(){return this.domNode.children[1].children[0];},dayNode:function(){return this.domNode.children[1].children[1];},yearNode:function(){return this.domNode.children[1].children[2];},hourNode:function(){return this.domNode.children[1].children[3];},minNode:function(){return this.domNode.children[1].children[4];},meridiemNode:function(){return this.domNode.children[1].children[5];}},markupMethods:{onmeridiemChange:function(){if(this.is24HourMode){this.meridiemNode.display="none";}else{this.meridiemNode.innerHTML=this.meridiem?mstrmojo.locales.datetime.AM_NAME:mstrmojo.locales.datetime.PM_NAME;}},onviewCssClassChange:function(){this.viewNode.className=this.viewCssClass;}},init:function init(props){this._super(props);var dtp=this.dtp;this._hasDate=(dtp===DTP.DATE||dtp===DTP.TIMESTAMP);this._hasTime=(dtp===DTP.TIME||dtp===DTP.TIMESTAMP);createProviders.call(this);createChildren.call(this);},getDateTime:function getDateTime(){return{date:this.getDate(),time:this.getTime()};},getDate:function getDate(){if(this._hasDate){var dateInfo=this.dateProvider.curVal;return{year:dateInfo.getFullYear(),month:dateInfo.getMonth()+1,day:dateInfo.getDate()};}return null;},getTime:function getTime(){if(this._hasTime){return{hour:!this.is24HourMode?$D.capitalHour(this.hourProvider.curVal,this.meridiem?" AM":" PM"):this.hourProvider.curVal,min:this.minProvider.curVal};}return null;},getDateTimeString:function getDateTimeString(){var str="";if(this._hasDate){str+=$D.formatDateInfo(this.getDate(),mstrmojo.locales.datetime.DATEOUTPUTFORMAT);}if(this._hasDate&&this._hasTime){str+=" ";}if(this._hasTime){str+=$D.formatTimeInfo(this.getTime(),mstrmojo.locales.datetime.TIMEOUTPUTFORMAT);}return str;},updateDate:function updateDate(){if(this.hasRendered){var me=this;$A.forEach(["year","month","day"],function(n){me[n+"Stepper"].updateDisplayText();});}if(this.dateToggle){this.dateToggle.set("text",$D.formatDateInfo(this.getDate(),mstrmojo.locales.datetime.DATEOUTPUTFORMAT));}},updateTime:function updateTime(){if(this.timeToggle){this.timeToggle.set("text",$D.formatTimeInfo(this.getTime(),mstrmojo.locales.datetime.TIMEOUTPUTFORMAT));}},toDateView:function toDateView(){this.set("viewCssClass","dateView");this.dateToggle.set("selected",true);var timeToggle=this.timeToggle;if(timeToggle){timeToggle.set("selected",false);}},toTimeView:function toTimeView(){this.set("viewCssClass","timeView");var dateToggle=this.dateToggle;if(dateToggle){dateToggle.set("selected",false);}this.timeToggle.set("selected",true);}});}());