(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.dom","mstrmojo.array","mstrmojo._ResultSetXt","mstrmojo._ReportDataService","mstrmojo._ImageHelper");function submitAndGetResults(request,callback,config,resultParams){var me=this;mstrApp.serverRequest(request,{success:function(res){me.msgId=res.id;me.visName=res.visName;me.getResults(resultParams,callback);},failure:function(res){if(callback.failure){callback.failure(res);}},canceled:function(){if(callback.canceled){callback.canceled();}}},config);}function waitConfig(noHideWait,isProgress){var cfg={hideWait:!noHideWait,delay:true};cfg["show"+(isProgress?"Progress":"Wait")]=true;return cfg;}var promptObjType={objectType:3};var $C=mstrmojo.hash.copy,$ARR=mstrmojo.array;function getXtabStyleName(){var styleName="MojoXtabStyle",visName=this.visName;if(visName){var visObj=mstrmojo.AndroidVisList.getVis(visName);styleName=(visObj&&visObj.s)||styleName;}return styleName;}mstrmojo.XtabDataService=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._ResultSetXt,mstrmojo._ReportDataService,mstrmojo._ImageHelper],{scriptClass:"mstrmojo.XtabDataService",execute:function execute(params,callback,resParams){var id=this.id;var ab=this.controller.ab;if(ab){var abArr=ab.split("|"),visId=mstrApp.isTablet()?"73^":"72^";$ARR.forEach(abArr,function(value,index,arr){var i=value.indexOf(visId);if(i>=0){mstrmojo.all[id].visName=value.substring(i+3);return false;}});}var request=mstrmojo.hash.copy(params,{});request.taskId=request.taskId||"reportExecute";request.reportID=request.reportID||this.dssId;request.styleName=mstrApp.isTablet()?"AndroidTabletMessageResultStyle":"AndroidMessageResultStyle";if(params){if(params.dssId){request.reportID=params.dssId;}}this.dssId=request.reportID;this._super(request,callback,resParams);},getResults:function getResults(params,callback){var styleName=getXtabStyleName.call(this),dpi=mstrMobileApp.getDeviceDPI(),zoom=160;if(dpi<160){zoom=80;}else{if(dpi>240){zoom=230;}}var request={taskId:"iPhoneGetReportResults",styleName:styleName,zoomFactor:zoom,deviceMode:mstrApp.isTablet?(mstrApp.isTablet()?73:72):0};if(params){var pbUnits=params.pbUnits,yPos=params.yPos,colsPerPage=params.colsPerPage,rowPerPage=params.rowsPerPage;if(pbUnits){request.pageByKeys=this.pageByUnitsToKeys(pbUnits);}if(yPos){request.yPos=yPos;}if(colsPerPage){request.colsPerPage=colsPerPage;}if(rowPerPage){request.rowsPerPage=rowPerPage;}}this._super(request,callback);},answerPrompts:function answerPrompts(prompts,callback){this._super(prompts,callback,$C(promptObjType));},loadPrompts:function loadPrompts(callback,request){this._super(callback,$C(promptObjType,request));},drill2Grid:function drill2Grid(params,callback){var p={taskId:"RWGridDrillToReport",msgID:params.srcMsgId,displayMode:-1,retainParent:3,retainThreshold:3,drillPathKey:params.drillPathKey,drillPathIndex:params.drillPathIndex,elementList:params.drillElements,nodeKey:params.nodeKey,rwGroupByElements:params.rwGroupByElements};if(params.sliceId){p.sliceId=params.sliceId;}submitAndGetResults.call(this,p,callback,waitConfig(true,true));},drillGrid:function drillGrid(params,callback){submitAndGetResults.call(this,{taskId:"gridDrill",msgID:params.srcMsgId,drillPathKey:params.drillPathKey,drillPathIndex:params.drillPathIndex,elementList:params.drillElements},callback,waitConfig(true,true));},pageBy:function pageBy(pbUnits,callback){var app=mstrApp,request={taskId:"changePageBy",messageID:this.msgId,pageByKeys:this.pageByUnitsToKeys(pbUnits)};if(!app.useBinaryFormat){request.taskId="iPhoneGetReportResults";request.styleName=getXtabStyleName.call(this);request.zoomFactor=200;}mstrApp.serverRequest(request,callback,waitConfig());},sort:function sort(params,callback){submitAndGetResults.call(this,{taskId:"gridSort",msgID:this.msgId,sortKey:params.sortKey,sortOrder:((params.isAsc)?1:0),subtotalPos:params.subTotalsPos,clearSorts:1},callback,waitConfig());},pivot:function pivot(params,callback){var request={taskId:"gridPivot",msgID:this.msgId,objectId:params.objectId,pos:params.pos,objectType:params.objectType};if(params.axis){request.axis=params.axis;}submitAndGetResults.call(this,request,callback,waitConfig());},downloadGridData:function downloadGridData(params,callback){mstrApp.serverRequest({taskId:"DocXtabIncrementalFetch",nodeKey:"",rowPosition:params.rowPosition,maxRows:params.maxRows,colPosition:-1,maxColumns:-1},callback);}});}());