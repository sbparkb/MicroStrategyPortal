(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.mdx.CubeList");mstrmojo.requiresDescs(12931,14545);var DRAG_ACTION_ADD_CUBE="addCube";mstrmojo.qb.mdx.CubeDropbox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.mdx.CubeDropbox",markupString:'<div id="{@id}" class="mstrmojo-qb-MDXCubeDropbox {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-emma-container" style="margin-left: 12px"><div class="mstrmojo-qb-emma-EmptyHint">{@emptyHint}</div><div class="mstrmojo-qb-emma-content"></div></div></div>',markupSlots:{hintNode:function hintNode(){return this.domNode.firstChild.firstChild;},containerNode:function containerNode(){return this.domNode.firstChild.lastChild;},panelNode:function panelNode(){return this.domNode.firstChild;},outerContainerNode:function outerContaninerNode(){return this.domNode;}},emptyHint:mstrmojo.desc(13246,"Drag and Drop table(s) from any database connections"),children:[{scriptClass:"mstrmojo.qb.mdx.CubeList"},{scriptClass:"mstrmojo.CheckBox",slot:"outerContainerNode",label:mstrmojo.desc(14545,"Import as Recursive Attribute"),alias:"recursive",oncheckedChange:function oncheckedChange(){mstrApp.getRootController().setRecursive(this.checked?1:0);},postCreate:function postCreate(){if(this._super){this._super();}var me=this,evtConfig={},listConfig=evtConfig[this.id]={};listConfig.recursiveChange=function(evt){me.set("checked",evt.value?true:false);};mstrApp.getRootController().attachDataChangeListeners(evtConfig);this.enabled=!mstrApp.tableID;}}],init:function init(props){this._super(props);var evtConfig={},tableConfig=evtConfig[this.id]={};tableConfig.refreshTables=this.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},onTableRefresh:function onTableRefresh(evt){var hasTable=evt.items.length>0;mstrmojo.css.toggleClass(this.hintNode,["off"],hasTable);mstrmojo.css.toggleClass(this.panelNode,["active"],hasTable);},dropZone:true,allowDrop:function allowDrop(context){return DRAG_ACTION_ADD_CUBE===context.action;},ondrop:function ondrop(context){var dragEvent=context.action,contextSrc=context.src,dragData;if(contextSrc&&contextSrc.data){dragData=contextSrc.data;if(dragEvent===DRAG_ACTION_ADD_CUBE){mstrApp.getRootController().addCubes([dragData]);}}mstrmojo.css.removeClass(this.panelNode,"dragging");},getAvatarIconClass:function getAvatarIconClass(){return"enabled";},ondragenter:function ondragenter(context){var srcWidget=context.src.widget;if(srcWidget&&srcWidget.toggleAvatarClass&&this.allowDrop(context)){srcWidget.toggleAvatarClass(this.getAvatarIconClass(context),true);}mstrmojo.css.addClass(this.panelNode,"dragging");},ondragleave:function ondragleave(context){var srcWidget=context.src.widget;if(srcWidget&&srcWidget.toggleAvatarClass&&this.allowDrop(context)){srcWidget.toggleAvatarClass(this.getAvatarIconClass(context),false);}mstrmojo.css.removeClass(this.panelNode,"dragging");}});}());