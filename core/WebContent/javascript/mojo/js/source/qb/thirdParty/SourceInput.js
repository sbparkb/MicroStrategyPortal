(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.DI.DIConstants","mstrmojo.qb.thirdParty.UrlSourceItem");mstrmojo.requiresDescs(11098,12850,13992);var $CSS=mstrmojo.css,$ARR=mstrmojo.array;mstrmojo.qb.thirdParty.SourceInput=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.thirdParty.SourceInput",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload mstrmojo-di-fu mstrmojo-qb-thirdParty-SourceInput {@cssClass}" style="{@cssText}" ><div></div><div class="url-input"></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},instructionNode:function(){return this.domNode.firstChild;},urlInputNode:function(){return this.domNode.children[1];},urlContainerNode:function(){return this.domNode.lastChild;}},children:[{slot:"instructionNode",scriptClass:"mstrmojo.Label",cssClass:"connection-info-label",text:mstrmojo.desc(13992,"Please select a connection first"),postCreate:function(){var model=mstrApp.getRootController().model;model.attachEventListener("SelDBRoleNameChange",this.id,"updateInstruction");},updateInstruction:function update(evt){var dbName=evt.value?evt.value:mstrmojo.desc(13992,"Please select a connection first");this.set("text",dbName);this.parent.enableFooterBtn();}},{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",emptyText:mstrmojo.desc(12850,"Enter URL"),onvalueChange:function(evt){var isEmpty=!evt.value||evt.value==="";this.parent.toggleAddBtnState(!isEmpty);this.parent.enableFooterBtn();}},{slot:"urlInputNode",alias:"addBtn",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",cssDisplay:"inline-block",text:mstrmojo.desc(531,"Add"),onclick:function(){this.parent.addURL();}},{slot:"urlContainerNode",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-thirdParty-url-holder",alias:"urlList",bindings:{visible:function(){return this.getSrcCnt()>0;}},addURL:function addURL(url){var controller=mstrApp.getRootController();var urlItem=mstrmojo.insert({scriptClass:"mstrmojo.qb.thirdParty.UrlSourceItem",url:url,dbRoleID:controller.model.SelDBRoleID,dbRoleName:controller.model.SelDBRoleName});var urlList=this.addChildren(urlItem);urlList.render();if(!this.visible){this.set("visible",true);}},deleteURL:function deleteURL(urlItem){this.removeChildren(urlItem);if(this.getSrcCnt()===0){this.set("visible",false);}this.parent.enableFooterBtn();},getSrcCnt:function(){return this.children?this.children.length:0;},getSrcs:function(){var srcs=[];$ARR.forEach(this.children,function(child){srcs.push({url:child.url,dbRoleID:child.dbRoleID});});return srcs;}}],addURL:function addURL(){var controller=mstrApp.getRootController();var model=controller.model;var url=this.urlInput.value;url=url.replace(/^\s+|\s+$/g,"");if(url.length===0){return ;}if(!model.isNew){this.urlList.removeChildren();}this.urlList.addURL(url);this.urlInput.set("value","");},enableFooterBtn:function enableFooterBtn(){var controller=mstrApp.getRootController();var model=controller.model;var srcCnt=this.urlList.getSrcCnt();var input=this.urlInput.value;if(srcCnt===0){var enabled=input&&model.SelDBRoleID;controller.enableButton(enabled);}else{if(!model.isNew&&srcCnt===1){controller.enableButton(input.length<1);}}},getSrcs:function getSrcs(){this.addURL();return this.urlList.getSrcs();},removeSrcs:function removeSrcs(srcs){var urlList=this.urlList;var children=urlList.children,childrenToDel=[];$ARR.forEach(srcs,function(src){$ARR.forEach(children,function(child){if(child.url===src.url){childrenToDel.push(child);return false;}});});$ARR.forEach(childrenToDel,function(child){urlList.removeChildren(child);});},initURL:function initURL(){var url=mstrApp.getRootController().model.SQLstmt;if(url&&url.length>0){this.urlList.addURL(url);this.enableFooterBtn();}},postBuildRendering:function postBR(){if(this._super){this._super();}var model=mstrApp.getRootController().model;model.attachEventListener("reportDefLoaded",this.id,this.initURL);},toggleAddBtnState:function toggleAddBtnState(enable){$CSS[enable?"addClass":"removeClass"](this.addBtn.domNode,["hot"]);}});}());