(function(){mstrmojo.requiresCls("mstrmojo.Pulldown","mstrmojo.HBox","mstrmojo.Button","mstrmojo.qb.thirdParty.DBRoleMenu");mstrmojo.requiresDescs(12848,12849);var $A=mstrmojo.array,$ENUM_DATA_CHANGE_EVENTS=mstrmojo.warehouse.EnumDataChangeEvents;function handleDBRoleChange(evt){var newItem=evt.item,currentItems=this.items,index=$A.find(currentItems,"did",newItem.did);currentItems[index]=newItem;this.set("value",newItem.did);var model=mstrApp.getRootController().model;model.SelDBRoleName=newItem.n;}function dbRolesDeleted(evt){var newItem=evt.item,currentItems=this.items.concat();var idx=$A.find(currentItems,"did",newItem.did);if(idx>-1){currentItems.splice(idx,1);}this.set("items",currentItems);}mstrmojo.qb.thirdParty.DBRolePullDown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.thirdParty.DBRolePullDown",cssClass:"mstrmojo-qb-thirdParty-DBRolePullDown",children:[{scriptClass:"mstrmojo.Label",cssClass:"caption",text:mstrmojo.desc(12848,"Select Connection:")},{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",alias:"dbSelector",fixWidth:false,itemIdField:"did",itemField:"n",onitemsChange:function(){this.paint();var model=mstrApp.getRootController().model;var selDB=this.selectedItem;if(selDB){model.SelDBRoleID=selDB.did;model.SelDBRoleName=selDB.n;}},postCreate:function init(props){this._super(props);var $this=this,evtConfig={},listConfig=evtConfig[this.id]={};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_LOADED]=function dbRolesLoaded(evt){$this.set("items",evt.items);};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_ADD]=function dbRolesAdded(evt){$this.addItems([evt.item]);};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLE_CHANGED]=handleDBRoleChange;listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_RENAME]=handleDBRoleChange;listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLES_DELETE]=dbRolesDeleted;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},onvalueChange:function(evt){var value=evt.value;if(value){var model=mstrApp.getRootController().model;model.SelDBRoleID=this.value;model.SelDBRoleName=this.selectedItem.n;}}},{scriptClass:"mstrmojo.qb.thirdParty.DBRoleMenu",cssClass:"qb-thirdParty-menu-btn",alias:"menu",getData:function getData(){var selectedDB=this.parent.dbSelector.selectedItem;if(selectedDB){return selectedDB.data;}}}]});}());