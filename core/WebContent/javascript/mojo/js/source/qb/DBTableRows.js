(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.dom","mstrmojo.qb.EnumDragActions");var $DOM=mstrmojo.dom,JOIN_ACTION=mstrmojo.qb.EnumDragActions.JOIN_COLUMN,CSS_ADD_MENU_CLASS="item-add",CSS_MENU_CLASS="item-mn";mstrmojo.qb.DBTableRows=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.DBTableRows",getItemMarkup:function(item,idx){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-ic"></span><span class="item-n">{@n}</span><span class='+CSS_ADD_MENU_CLASS+"></span><span class="+CSS_MENU_CLASS+"></span></div>";},getItemProps:function getItemProps(item,idx){return{sel:!!this.selectedIndices[idx],cls:"st"+(item.state||"")+(idx%2?" odd":" even"),n:item.n,idx:idx};},getRowNode:function getRowPosition(prop,value){var index=mstrmojo.array.find(this.items,prop,value);if(index>-1){return this.itemsContainerNode.children[index];}},getRowItem:function getRowItem(index){return this.items[index];},onclick:function onclick(evt){try{var target=evt.target||$DOM.eventTarget(evt.hWin,evt.e),item=$DOM.findAncestorByAttr(target,"idx",true,this.domNode),idx=item&&parseInt(item.value,10),className=target.className;if((className===CSS_MENU_CLASS||className===CSS_ADD_MENU_CLASS)&&idx!==null&&!isNaN(idx)){var itemNode=this.itemsContainerNode.children[idx];if(className===CSS_MENU_CLASS){this.raiseEvent({name:"tableViewMenuSelect",data:this.items[idx],menuNode:itemNode.children[2]});}else{mstrApp.getRootController().addSelectedColumns([this.items[idx]]);}}}catch(ex){throw ex;}},dropZone:true,allowDrop:function allowDrop(context){return(context.action===JOIN_ACTION);},ondrop:function ondrop(context){var rootController=mstrApp.getRootController(),contextSrc=context.src;if(contextSrc&&contextSrc.data){var dragData=contextSrc.data;if(context.action===JOIN_ACTION){var item=$DOM.findAncestorByAttr(context.tgt.node,"idx",true,this.domNode);if(item){rootController.addJoinInfo(dragData,mstrmojo.hash.copy(this.getRowItem(item.value),{tableName:this.parent.tableData.did,tableId:this.parent.tableData.id}));}}}}});}());