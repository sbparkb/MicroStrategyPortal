(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.qb.es.TableDropbox","mstrmojo.warehouse.WHPanel");mstrmojo.requiresDescs(531,12384,14083);var $DESC=mstrmojo.desc,$DOM=mstrmojo.dom,$A=mstrmojo.array;var FIRST_ITEM_SLOT="firstSplitNode",SECOND_ITEM_SLOT="secondSplitNode";var VIEW_MODE_AUTO_FIT=0,VIEW_MODE_FIXED_SIZE=1;var INDEX_ATTR="idx",ITEM_TAG="li";var DDA_TABLE_ERROR_MSG=$DESC(12384,"LIVE Data Connection does NOT support connection to multiple Database Instances currently. Please uncheck LIVE Data Connection to add table(s) from this Database Instance.");var INCOMPATIBLE_SAPHANA_ERROR_MSG=$DESC(14083,"The following table(s) cannot be added since they are not Information Views: ###");function createAvatar(sourceNode){var div=document.createElement("div"),item=$DOM.findAncestorByAttr(sourceNode,INDEX_ATTR,true,this.domNode),ITEM_INNER_HTML_TEMPLATE='<div class="item-ic"></div><div class="item-n" title="" style="max-width: 340px">{@n}</div><div class="item-del"></div>',itemDiv,itemText,itemIndex;function createItemDiv(itemText){itemDiv=document.createElement("div");itemDiv.className="item cf";itemDiv.innerHTML=ITEM_INNER_HTML_TEMPLATE.replace("{@n}",itemText).replace("\n","");return itemDiv;}if(item&&item.node){var selections=this.userSelections;if(selections[item.value]){var treeNodes=this.domNode.getElementsByTagName(ITEM_TAG);$A.forEach(treeNodes,function(treeNode){itemIndex=treeNode.getAttribute(INDEX_ATTR);if(selections[itemIndex]===true){itemText=this.items[itemIndex].n;itemDiv=createItemDiv(itemText);div.appendChild(itemDiv);}},this);}else{itemText=this.items[parseInt(item.value)].n;itemDiv=createItemDiv(itemText);div.appendChild(itemDiv);}div.appendChild(document.createElement("div"));}div.className="mstrmojo-qb-emma-tablelist";return div;}function positionAvatar(pos,context){var avatarStyle=this.avatar.style,restrictedToAxis=this.restrictedToAxis;if(restrictedToAxis!=="y"){avatarStyle.left=pos.x+1+"px";}if(restrictedToAxis!=="x"){avatarStyle.top=pos.y+1+"px";}}mstrmojo.qb.es.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.es.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},onError:mstrmojo.emptyFn,init:function init(props){this._super(props);var evtConfig={},tableConfig={},dbTableTree;evtConfig[this.id]=tableConfig;tableConfig.directDataAccessTableError=this.onTableAdded;tableConfig.maxTableError=this.onTableAdded;tableConfig.SapHanaIncompatibleTypeError=this.onTableAdded;tableConfig.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(evtConfig);var dbRoleSelector=this.getDBRoleSelector();var availableTablesPanel=this.main.children[0].bottomPanel;availableTablesPanel.getLayoutOffsets=function(){return{h:32,w:0};};dbRoleSelector.getLayoutOffsets=function(){return{h:32,w:0};};availableTablesPanel.searchBox.widthOffset=21;availableTablesPanel.nameSpaces.heightOffset=35;dbRoleSelector.heightOffset=31;availableTablesPanel.heightOffset=31;dbRoleSelector.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");dbTableTree=availableTablesPanel.dbTableTree;dbTableTree.createAvatarFunc=createAvatar;dbTableTree.positionAvatarFunc=positionAvatar;dbTableTree.showTablesNum=false;},getDBRoleSelector:function getDBRoleSelector(){return this.main.children[0].topPanel;},getDBConnectionList:function getDBConnectionList(){return this.getDBRoleSelector().dbConnections;},preBuildRendering:function preBuildRendering(){if(this._super){this._super();}if(this.viewMode===VIEW_MODE_FIXED_SIZE){if(this._listenerProc){mstrmojo.dom.detachEvent(window,"resize",this._listenerProc);this._listenerProc=null;}}},onTableAdded:function onTableAdded(evt){var errorMsg="",names=[];switch(evt.name){case"maxTableError":errorMsg=mstrApp.getRootController().getTableErrorMsg();break;case"directDataAccessTableError":errorMsg=DDA_TABLE_ERROR_MSG;break;case"SapHanaIncompatibleTypeError":$A.forEach(evt.data,function(table){names.push(table.n);});errorMsg=INCOMPATIBLE_SAPHANA_ERROR_MSG.replace("###",names.join(", "));break;}mstrmojo.qb.alert(errorMsg,null,null,null,this.alertCfg);},renderPageLoadError:function renderPageLoadError(){var err=this.error,message=err.message,title=err.title,buttons=err.btns;this.onError(err);if(!buttons||!buttons.length){mstrmojo.alert(message,null,title);}else{mstrmojo.confirm(message,null,{buttons:buttons,title:title});}},render:function render(){if(this.error){this.renderPageLoadError();}else{this._super();}},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"50%",min:"350px",max:undefined},secondSplit:{v:"50%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function getLayoutOffsets(){return{h:0,w:36};},slot:"layout",alias:"main",toggleDatabaseView:function toggleDatabaseView(show){this.toggleFirstItemVisibility(show);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"mstrmojo-qb-es-whpanel",slot:FIRST_ITEM_SLOT,orientation:mstrmojo.ui.Splitter.ENUM_OR.HORIZONTAL,config:{firstSplit:{v:"50%",min:"200px"},secondSplit:{v:"50%",min:"200px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.qb.es.TableDropbox",slot:SECOND_ITEM_SLOT}]}],toggleDatabaseView:function toggleDatabaseView(show){this.main.toggleDatabaseView(show);},adjustSize:function(evt){var size=evt.size,isCloud=mstrApp.isCloudPro,widthDelta=isCloud?40:0,heightDelta=isCloud?180:104;var width=parseInt(size.w,10)-widthDelta+"px",height=parseInt(size.h,10)-heightDelta+"px";if(this.height&&height!==this.height){this.set("height",height);}else{this.height=height;}if(this.width&&width!==this.width){this.set("width",width);}else{this.width=width;}return true;},postBuildRendering:function postBuildRendering(){if(this._super){this._super();}if(mstrApp.size){this.adjustSize({size:mstrApp.size});}}});}());