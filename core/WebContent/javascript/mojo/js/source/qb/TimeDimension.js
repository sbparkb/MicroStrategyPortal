(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.array","mstrmojo.CheckList","mstrmojo.fx");mstrmojo.requiresDescs(221,871,873,1442,2052,2057,2461,10042,10043,10044,10045,10046,10047,10048,10049,10050,10051,12929);var _H=mstrmojo.hash;var ALL_DID="all",YEAR_DID=1,QUARTER_DID=2,QUARTER_OF_YEAR_DID=4,MONTH_DID=8,MONTH_OF_YEAR_DID=16,WEEK_DID=32,WEEK_OF_YEAR_DID=64,DATE_DID=128,DAY_OF_MONTH_DID=256,DAY_OF_WEEK_DID=512,HOUR_DID=1024,MINUTE_DID=2048,SECOND_DID=4096;var _TIME0=[{n:mstrmojo.desc(2461,"All"),did:ALL_DID}],_TIME1=[{n:mstrmojo.desc(873,"Year"),did:YEAR_DID},{n:mstrmojo.desc(10050,"Quarter"),did:QUARTER_DID},{n:mstrmojo.desc(10051,"Quarter of Year"),did:QUARTER_OF_YEAR_DID},{n:mstrmojo.desc(871,"Month"),did:MONTH_DID},{n:mstrmojo.desc(10049,"Month of Year"),did:MONTH_OF_YEAR_DID},{n:mstrmojo.desc(10048,"Week"),did:WEEK_DID},{n:mstrmojo.desc(10047,"Week of Year"),did:WEEK_OF_YEAR_DID},{n:mstrmojo.desc(2052,"Date"),did:DATE_DID},{n:mstrmojo.desc(10046,"Day of Month"),did:DAY_OF_MONTH_DID},{n:mstrmojo.desc(10045,"Day of Week"),did:DAY_OF_WEEK_DID}],_TIME2=[{n:mstrmojo.desc(10042,"Hour"),did:HOUR_DID},{n:mstrmojo.desc(10043,"Minute"),did:MINUTE_DID},{n:mstrmojo.desc(10044,"Second"),did:SECOND_DID}],_TIMEROLES=[{n:mstrmojo.desc(2057,"None")},{n:mstrmojo.desc(873,"Year"),did:YEAR_DID},{n:mstrmojo.desc(10050,"Quarter"),did:QUARTER_DID},{n:mstrmojo.desc(871,"Month"),did:MONTH_DID},{n:mstrmojo.desc(10048,"Week"),did:WEEK_DID},{n:"Day",did:DATE_DID}];var _skip=false;var TIME_DIMENSION_DATE_MODE=1,TIME_DIMENSION_TIME_MODE=2,TIME_DIMENSION_DATE_TIME_MODE=3,TIME_DIMENSION_TIME_ROLE=4;mstrmojo.qb.TimeDimension=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.TimeDimension",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};width:155px;height:{@height};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-qb-mapping-title">{@title}</div><div class="mstrmojo-qb-mapping-time"></div><div class="mstrmojo-qb-mapping-buttons"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},titleNode:function(){return this.domNode.firstChild.childNodes[0];},buttonNode:function(){return this.domNode.firstChild.childNodes[2];}},top:"0px",left:"0px",height:"320px",title:mstrmojo.desc(12929,"Please select additional time attributes that you want to create."),mode:TIME_DIMENSION_DATE_TIME_MODE,init:function init(props){this._super(props);this.raiseEvent({name:"modeChange"});},onmodeChange:function onmodeChange(){var mode=this.mode,items=[],children;switch(mode){case TIME_DIMENSION_DATE_MODE:items=_TIME0.concat(_TIME1);children=this.timebrowser;break;case TIME_DIMENSION_TIME_MODE:items=_TIME0.concat(_TIME2);children=this.timebrowser;break;case TIME_DIMENSION_DATE_TIME_MODE:items=_TIME0.concat(_TIME1).concat(_TIME2);children=this.timebrowser;break;case TIME_DIMENSION_TIME_ROLE:items=_TIMEROLES.concat(_TIME2);children=this.timeRoleList;break;default:break;}children.set("items",items);children.set("visible",true);},_close:function(){var parent=this.parent;if(parent&&parent._cmSource){parent._cmSource.closeMenuTree();}},onOK:function(){var selections;if(this.mode===TIME_DIMENSION_TIME_ROLE){selections=this.timeRoleList.getSelectedItems();}else{selections=this.timebrowser.getSelectedItems();}var parent=this.parent,i,len,tempSelections,derivedAttrFlag;this.data.geo=false;tempSelections=selections.slice();derivedAttrFlag=0;for(i=0,len=tempSelections.length;i<len;i++){(tempSelections[i].did!=="all")&&(derivedAttrFlag=derivedAttrFlag|tempSelections[i].did);}this.data.der=derivedAttrFlag;mstrApp.getRootController().setTimeRole(this.data);this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.CheckList",slot:"contentNode",alias:"timebrowser",cssClass:"mstrmojo-qb-time-tree",visible:false,onchange:function(evt){var added=evt.added,removed=evt.removed,items,length,idx,selectedIndices;if(_skip){_skip=false;return ;}if(added){items=this.items;length=items.length;selectedIndices=this.selectedIndices;if(added[0]===0){for(idx=0;idx<length;idx++){if(!selectedIndices[idx]){_skip=true;this.setSelectedItems(items,true);break;}}}else{for(idx=1;idx<length;idx++){if(!selectedIndices[idx]){return ;}}if(!selectedIndices[0]){_skip=true;this.toggleSelect(0,false);}}}if(removed){if(removed[0]===0){this.clearSelect();}else{if(this.selectedIndices[0]){_skip=true;this.toggleSelect(0,false);}}}},onRender:function(){var derivedAttrFlag=this.parent.der,items=this.items,selections=[],i,len;for(i=0,len=items.length;i<len;i++){(derivedAttrFlag&items[i].did)&&(selections.push({did:items[i].did}));}(len===selections.length+1)&&(selections.push({did:"all"}));selections.length&&this.setSelectedItems(selections,true);}},{scriptClass:"mstrmojo.RadioList",slot:"contentNode",alias:"timeRoleList",cssClass:"mstrmojo-qb-time-tree",visible:false}]});}());