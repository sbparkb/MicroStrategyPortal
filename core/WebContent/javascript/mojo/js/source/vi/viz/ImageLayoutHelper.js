(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.viz.DropZoneHelper","mstrmojo.XMLBuilder");mstrmojo.requiresClsP("mstrmojo.vi.viz","DropZoneHelper","EnumDSSDropZones");var $MOJO=mstrmojo,$HASH=$MOJO.hash,$VIZ=$MOJO.vi.viz;function getAdditionalMetricsXmlValue(){var value,i,metrics=this.tooltipMetrics;if(metrics.length>0){value=metrics[0].did;for(i=1;i<metrics.length;i++){value=value+","+metrics[i].did;}}return value;}mstrmojo.vi.viz.ImageLayoutHelper=mstrmojo.declare(mstrmojo.vi.viz.DropZoneHelper,null,{scriptClass:"mstrmojo.vi.viz.ImageLayoutHelper",geoAttribute:null,colorByMetric:null,sizeByMetric:null,layoutAttribute:null,tooltipMetrics:null,mapFile:null,init:function init(props){this._super(props);this.tooltipMetrics=[];if(props&&props.node.data){this.mapFile=props&&props.node.data.vp&&props.node.data.vp.mf;}},getAddDropZonesAction:function(){var h=this,r={act:"updateTemplate",keyContext:this.node.k,actions:[]};[{n:"geoAttribute",zone:"GeoAttribute"},{n:"colorByMetric",zone:"ColorBy",t:4},{n:"sizeByMetric",zone:"SizeBy",t:4},{n:"layoutAttribute",zone:"Layout"},{n:"tooltipMetrics",zone:"AdditionalMetrics",t:4}].forEach(function(item){var objs=[].concat(h[item.n]||[]),id=$VIZ.EnumDSSDropZones[item.zone];if(objs&&objs.length){objs.forEach(function(obj){r.actions.push({act:"addDropZoneUnit",zoneId:id,unitId:obj.did,unitType:obj.t});});}});return r;},setData:function setData(p){if(!p){return ;}var ths=this,fn=function(dz,dest){if(dz){var dst=ths[dest],arr=dz.TemplateUnit||dz.TemplateMetric;if(arr){arr.forEach(function(x){var item=$HASH.copy(x);if(!item.did){item.did=item.id;}if(dst instanceof Array){dst.push(item);}else{ths[dest]=item;}});}}};fn(p[$IL.PROP_GEO],"geoAttribute");fn(p[$IL.PROP_COLORBY],"colorByMetric");fn(p[$IL.PROP_SIZEBY],"sizeByMetric");fn(p[$IL.PROP_LAYOUT],"layoutAttribute");fn(p[$IL.PROP_TOOLTIPMETRICS],"tooltipMetrics");},getXml:function getXml(){var PROP_ATTRIBUTE="ga",PROP_PATH_TO_MAP="PathToMap",PROP_COLORBY="ColorBy",PROP_MAP_FILE="mf",PROP_SIZEBY="SizeBy",PROP_TOOLTIP="Tooltip";var xml=new mstrmojo.XMLBuilder(),amValue,fnAddChildIfExists=function(nodeName,attrName,attrValue){if(attrValue&&attrValue.did!==undefined){xml.addChild(nodeName);xml.addAttribute(attrName,attrValue.did);xml.closeElement();}};xml.addChild("props");xml.addChild("widgetProps");xml.addChild("fmt");fnAddChildIfExists(PROP_ATTRIBUTE,"value",this.geoAttribute);fnAddChildIfExists(PROP_COLORBY,"value",this.colorByMetric);fnAddChildIfExists(PROP_SIZEBY,"value",this.sizeByMetric);fnAddChildIfExists(PROP_PATH_TO_MAP,"value",this.layoutAttribute);amValue=getAdditionalMetricsXmlValue.call(this);fnAddChildIfExists(PROP_TOOLTIP,"value",amValue);fnAddChildIfExists(PROP_MAP_FILE,"value",this.mapFile);xml.closeElement();xml.closeElement();xml.closeElement();return xml.toString();}});var $IL=mstrmojo.vi.viz.ImageLayoutHelper;$IL.PROP_GEO="Geo";$IL.PROP_COLORBY="ColorBy";$IL.PROP_SIZEBY="SizeBy";$IL.PROP_LAYOUT="layout";$IL.PROP_TOOLTIPMETRICS="AdditionalMetrics";}());