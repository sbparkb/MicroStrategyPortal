(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.RadioList","mstrmojo.VisEnum","mstrmojo.array","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.Pulldown","mstrmojo._FormatDefinition","mstrmojo.hash","mstrmojo.models.FormatModel","mstrmojo.gm.GMUtility","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.func","mstrmojo.css","mstrmojo.models.FormatModel","mstrmojo.VisUtility","mstrmojo.heatmap.vi.VisHeatmapUtility","mstrmojo.ui.editors.controls.AdvancedColorPicker","mstrmojo.vi.viz.EnumDSSDropZones");var $ARR=mstrmojo.array,$FD=mstrmojo._FormatDefinition,$HASH=mstrmojo.hash,$GMU=mstrmojo.gm.GMUtility,$FUNC=mstrmojo.func,$CSS=mstrmojo.css,$VIS_UTILITY=mstrmojo.VisUtility,$HM_UTIL=mstrmojo.heatmap.vi.VisHeatmapUtility,$ACP=mstrmojo.ui.editors.controls.AdvancedColorPicker,FORMAT_MODEL=mstrmojo.models.FormatModel,ENUM_FORMAT_PROPERTIES=FORMAT_MODEL.ENUM_PROPERTY_NAMES,LEGEND_PROPERTY=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,ENUM_FONT_STYLE=mstrmojo.chart.enums.EnumFontStyle,ENUM_PROPERTY_NAMES=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,LABEL_SIZE=mstrmojo.VisEnum.HEATMAP_LABEL_SIZE,FILL_CONFIG_CONTROL=mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS,DROP_ZONES=mstrmojo.vi.viz.EnumDSSDropZones;var FONT_MAP={};FONT_MAP[ENUM_FORMAT_PROPERTIES.FONT_SIZE]=LEGEND_PROPERTY.LEGEND_FONT_SIZE;FONT_MAP[ENUM_FORMAT_PROPERTIES.FONT_FAMILY]=LEGEND_PROPERTY.LEGEND_FONT_FAMILY;FONT_MAP[ENUM_FORMAT_PROPERTIES.COLOR]=LEGEND_PROPERTY.LEGEND_FONT_COLOR;var CATEGORIES_DATA_EXPLORATION="de",CATEGORIES_LEGEND="lgd";var WIDGET_SELECTION_CHANGE_REGISTRY="widgetSelectionChangeHandlers",COLORBY_COLOR_CHANGE_REGISTRY="colorByColorChangeHandlers",FONT_SCALE_CHANGE_REGISTRY="fontScaleChangeHandlers";function getOMCallback(propPath){var me=this;return function(newValue){var host=me.getHost(),model=$VIS_UTILITY.getPropertyByPath(host,"observableModel."+propPath);if(model){model.setValue(newValue);}};}function getPropsInfo(){var host=this.getHost();if(host){return host.getPropsInfo();}return null;}var fontFamilyItems=$FD.Families.slice(1).map(function(font){return{n:font.n,id:font.n};});function getCheckbox(isChecked,labelText,fnChange){isChecked=isChecked&&isChecked!=="false";var checkBox=new mstrmojo.ui.Checkbox({checked:isChecked,oncheckedChange:function(){var isChecked=this.checked;fnChange(isChecked,!isChecked);}});var ctrl=this.getLabelAndControl(labelText,checkBox,"20px","100%",true);$CSS.addWidgetCssClass(ctrl,"checkLabel");var label=ctrl.getLabel();label.onclick=function onclick(){checkBox.onclick();};label.cssDisplay="inline-block";return ctrl;}function getPulldown(items,selectedIndex,labelText,fnChange,props){var pulldown=new mstrmojo.ui.Pulldown($HASH.copy(props,{items:items}));pulldown.set("selectedIndex",selectedIndex);pulldown.postselectedIndexChange=function(evt){var newValue=evt.value,oldValue=evt.valueWas;if(newValue!==oldValue){var items=this.items;fnChange(items[newValue]&&items[newValue].id,items[oldValue]&&items[oldValue].id);}};if(labelText){return this.getLabelAndControl(labelText,pulldown);}else{pulldown.getCtrl=function(){return pulldown;};return pulldown;}}function getLabelControl(text){return new mstrmojo.Label({text:text});}function findSelectedIndex(items,selectedValue){var ret,lastItem;if(typeof selectedValue==="number"){$ARR.forEach(items,function(item,i){if(!lastItem){ret=i;}else{if((selectedValue-item.id)*(selectedValue-lastItem.id)<=0){ret=Math.abs(selectedValue-item.value)<Math.abs(selectedValue-lastItem.value)?i:i-1;return false;}}lastItem=item;});}else{if(typeof selectedValue==="string"){$ARR.forEach(items,function(item,i){if(item.id===selectedValue){ret=i;return false;}});}}return ret;}function getColorFormatsControl(label,model,key){var controls=[];if(label!==undefined){controls.push(getLabelControl.call(this,label));}var props={onGroupValueChange:function(name,newValue,oldValue){if(name.indexOf("FillTrans")>=0){if(!$HASH.equals(newValue,oldValue)){model.opacity.setValue(newValue/100);}}}};props.propNames=[key+"Clr",key+"FillTrans"];var fillConfigGroup=new mstrmojo.ui.editors.controls.FillConfigGroup(props);if(fillConfigGroup){fillConfigGroup.iniChildrenComp(props.propNames);}var colorPickerControl=fillConfigGroup.getChildComp(props.propNames[0]);if(colorPickerControl){colorPickerControl.set("selectedValue",model.value.getValue());colorPickerControl.postselectedValueChange=function(evt){var newValue=evt.value,oldValue=evt.valueWas;if(!$HASH.equals(newValue,oldValue)){model.value.setValue(newValue);}};}var opacityControl=fillConfigGroup.getChildComp(props.propNames[1]);if(opacityControl){opacityControl.set("value",model.opacity.getValue()*100);}controls.push(fillConfigGroup);model.attachEventListener("valueChanged",this.id,function(){colorPickerControl.set("selectedValue",model.value.getValue());opacityControl.set("value",model.opacity.getValue()*100);});return controls;}function getFontControl(groupModel){var host=this.getHost(),textSelectedIndex=host.textSelectedIndex?host.textSelectedIndex:0;host.attachEventListener("formatclick",this.id,function(evt){if(evt.formatValue==="headerOnTop.header"){host.textSelectedIndex=1;}else{if(evt.formatValue==="headerOnTop.cell"){host.textSelectedIndex=2;}}});function applyStepperState(){var labelSize=getPropsInfo.call(this).labelSize;if(labelSize===LABEL_SIZE.Proportional){if(isHeaderOnTop&&selectionCtrl.getSelectedItem().id!==1||!isHeaderOnTop){fsc.set("enabled",false);}}}var getSharedFontFamily=function(models){var ret="",isInited=false;$ARR.forEach(models,function(model){var family=model.family.getValue();if(!isInited){ret=family;isInited=true;}else{if(ret!==family){ret="";}}});return ret;};var isHeaderOnTop=!!groupModel.cell,selectedModels=isHeaderOnTop?(textSelectedIndex===1?[groupModel.header]:[groupModel.cell]):[groupModel],fsc=$HM_UTIL.getStepper(function(d){var len=selectedModels.length,i;for(i=0;i<len;i++){var isSilent=i!==len-1,model=selectedModels[i];if(d>0){model.scale.setValue(model.scale.getValue()+0.1,isSilent);}else{model.scale.setValue(Math.max(0.1,model.scale.getValue()-0.1),isSilent);}}}),ffc=getPulldown.call(this,fontFamilyItems,findSelectedIndex(fontFamilyItems,getSharedFontFamily(selectedModels)),null,function(newValue){var len=selectedModels.length,i;for(i=0;i<len;i++){selectedModels[i].family.setValue(newValue,i!==len-1);}},{isHostedWithin:false});this._fontStepper=fsc;groupModel.attachEventListener("valueChanged",this.id,function(evt){var target=evt.target,isFontFamilyChanged=false;$ARR.forEach(selectedModels,function(model){if(target===model.family){isFontFamilyChanged=true;return false;}});if(isFontFamilyChanged){ffc.set("selectedIndex",findSelectedIndex(fontFamilyItems,getSharedFontFamily(selectedModels)));}});fsc.slot="col1Node";ffc.slot="col2Node";var fontCtrl=new mstrmojo.ui.editors.controls.TwoColumnContainer({col1Width:"50%",col2Width:"50%",children:[fsc,ffc]});var selectionCtrl;var me=this;var host=this.getHost();var fontControls=[fontCtrl];if(isHeaderOnTop){selectionCtrl=getPulldown.call(this,[{n:mstrmojo.desc(2461,"All"),id:0,limitNames:["header","cell"]},{n:mstrmojo.desc(2967,"Headers"),id:1,limitNames:["header"]},{n:mstrmojo.desc(12007,"Labels"),id:2,limitNames:["cell"]}],textSelectedIndex,null,function(textSelectedIndex){if(textSelectedIndex===0){selectedModels=[groupModel.header,groupModel.cell];}else{if(textSelectedIndex===1){selectedModels=[groupModel.header];}else{selectedModels=[groupModel.cell];}}var index=findSelectedIndex(fontFamilyItems,getSharedFontFamily(selectedModels));if(index!==undefined){ffc.set("selectedIndex",index);}else{if(index===undefined){ffc.selectedNode.innerHTML="";}}host.triggerFontScaleChangeEvent();},{isHostedWithin:false});fontControls.unshift(selectionCtrl);}addEventHandler.call(this,FONT_SCALE_CHANGE_REGISTRY,"stepper",function(evt){var paths;if(isHeaderOnTop){paths=(selectionCtrl.getSelectedItem().limitNames||[]).map(function(name){return"headerOnTop."+name;});}else{paths=["headerOnMiddle"];}$HM_UTIL.setStepperEnabled(fsc,paths,evt.limits);applyStepperState.call(me);});host.triggerFontScaleChangeEvent();return fontControls;}function initLegendCharacterGroupControl(control){var setControlValues=function(){var host=this.getHost(),fontFamily=host.readGlobalAttriLegndProperty(LEGEND_PROPERTY.LEGEND_FONT_FAMILY),fontSize=host.readGlobalAttriLegndProperty(LEGEND_PROPERTY.LEGEND_FONT_SIZE),fontColor=$GMU.decodeColor(host.readGlobalAttriLegndProperty(LEGEND_PROPERTY.LEGEND_FONT_COLOR)),fontStyleValue=parseInt(host.readGlobalAttriLegndProperty(LEGEND_PROPERTY.LEGEND_FONT_STYLE),10);var formats={};formats["text-decoration"]="";formats[ENUM_FORMAT_PROPERTIES.FONT_FAMILY]=fontFamily;formats[ENUM_FORMAT_PROPERTIES.FONT_SIZE]=parseInt(fontSize,10);formats[ENUM_FORMAT_PROPERTIES.COLOR]=fontColor;if((fontStyleValue&ENUM_FONT_STYLE.FS_BOLD)>0){formats[ENUM_FORMAT_PROPERTIES.FONT_WEIGHT]="bold";}if((fontStyleValue&ENUM_FONT_STYLE.FS_ITALIC)>0){formats[ENUM_FORMAT_PROPERTIES.FONT_STYLE]="italic";}if((fontStyleValue&ENUM_FONT_STYLE.FS_UNDERLINE)>0){formats[ENUM_FORMAT_PROPERTIES.UNDERLINE]="underline";}if((fontStyleValue&ENUM_FONT_STYLE.FS_STRIKETHROUGH)>0){formats[ENUM_FORMAT_PROPERTIES.LINE_THROUGH]="line-through";}control.setFormatSource(formats);}.bind(this);var host=this.getHost();var fontStyleValueMap={bold:ENUM_FONT_STYLE.FS_BOLD,italic:ENUM_FONT_STYLE.FS_ITALIC,underline:ENUM_FONT_STYLE.FS_UNDERLINE,strikeout:ENUM_FONT_STYLE.FS_STRIKETHROUGH};var compNames=["fontFamily","fontStyle","fontSize","fontColor"];function getCharacterChildComp(control,propName){var rst=null;if(compNames.indexOf(propName)>-1){rst=control[propName];}return rst;}var compFontColor=getCharacterChildComp(control,compNames[3]);compFontColor.showNoFill=false;var comp=getCharacterChildComp(control,compNames[1]);if(comp){comp.postselectionChange=function(evt){var added=evt.added,item=this.items[(added&&added[0]!==undefined)?added[0]:evt.removed[0]],isSelected=!!added,oldValue=host.readGlobalAttriLegndProperty(LEGEND_PROPERTY.LEGEND_FONT_STYLE),newValue=(oldValue===undefined?ENUM_FONT_STYLE.NORMAL:oldValue);if(isSelected){newValue=newValue|fontStyleValueMap[item.css];}else{newValue=newValue&(~fontStyleValueMap[item.css]);}this.parent.raiseFormatValueChange(LEGEND_PROPERTY.LEGEND_FONT_STYLE,newValue,oldValue);};}setControlValues();$VIS_UTILITY.addLegendFontChangeListeners(this,function(){if(control.eventFromEdtModel){return ;}setControlValues();});return control;}function getLegendCharacterFormatControl(props){var me=this;return initLegendCharacterGroupControl.call(this,new mstrmojo.ui.editors.controls.CharacterGroup($HASH.copy({onGroupValueChange:function(name,newValue,oldValue){if($HASH.equals(newValue,oldValue)){return ;}if(name!==LEGEND_PROPERTY.LEGEND_FONT_STYLE){name=FONT_MAP[name];}if(name===LEGEND_PROPERTY.LEGEND_FONT_COLOR){newValue=$GMU.encodeColor(newValue);}var host=me.getHost(),model=host.observableModel[name];if(model){this.eventFromEdtModel=true;model.setValue(newValue);this.eventFromEdtModel=false;}},onFmtPropsChangedDefault:mstrmojo.emptyFn},props)));}function getLayoutContent(){var propName="layout",layout=getPropsInfo.call(this)[propName],cfg={isHostedWithin:false},items=[{n:mstrmojo.desc(13758,"Keep readability"),displayName:mstrmojo.desc(12124,"Keep readability, not element order"),id:0},{n:mstrmojo.desc(13759,"Balance"),displayName:mstrmojo.desc(13760,"Balance readability and element order"),id:1},{n:mstrmojo.desc(13761,"Keep element order"),displayName:mstrmojo.desc(12126,"Keep element order, not readability"),id:2}],pulldown=getPulldown.call(this,items,layout,null,getOMCallback.call(this,propName),cfg);pulldown.list.getItemDisplayName=function(item){return item.displayName;};return pulldown;}function getHeaderType(){var propName="isHeaderOnTop",isHeaderOnTop=getPropsInfo.call(this)[propName],writeCb=getOMCallback.call(this,propName),host=this.getHost(),docModel=host&&host.model.docModel;var items=[{n:mstrmojo.desc(13605,"On top"),id:true},{n:mstrmojo.desc(13604,"In center"),id:false}];var label=mstrmojo.desc(13602,"Headers:");return getPulldown.call(this,items,isHeaderOnTop?0:1,label,function(newVal,oldVal){writeCb(newVal,oldVal);if(docModel){docModel.selectVIUnit(host.parent.id,true);}});}function getLabelSize(){var propName="labelSize",labelSize=getPropsInfo.call(this)[propName],me=this;var selectedIndex=0;if(labelSize===LABEL_SIZE.Off){selectedIndex=1;}else{if(labelSize===LABEL_SIZE.Proportional){selectedIndex=2;}}return getPulldown.call(this,[{n:mstrmojo.desc(6030,"On"),id:"On"},{n:mstrmojo.desc(6031,"Off"),id:"Off"},{n:mstrmojo.desc(11990,"Proportional"),id:"Proportional"}],selectedIndex,mstrmojo.desc(13603,"Labels:"),$FUNC.composite([getOMCallback.call(this,propName),function(newValue){me._showMetricValuesController.set("enabled",newValue!=="Off");var host=me.getHost();if(host){host.triggerFontScaleChangeEvent();}}]));}function getShowMetricValues(){var props=getPropsInfo.call(this);var label=mstrmojo.desc(12122,"Show metric values");var propName="showMetricValues";var checkbox=getCheckbox.call(this,props[propName],label,getOMCallback.call(this,propName));checkbox.enabled=props.labelSize!==LABEL_SIZE.Off;this._showMetricValuesController=checkbox;return checkbox;}function getAttributeColorByShapeColor(){function setColorAndOpacity(sync,idx){function set(){if(idx===undefined){idx=0;}else{selectedIdx=idx;}var item=cbElements[idx];this.setChildValue(SHAPE_FILL,item.color);this.setChildValue(SHAPE_OPACITY,item.opacity);var showAutomatic=getRealSelectionIndex().some(function(i){return $VIS_UTILITY.isColorManuallySet(host,cbElements[i].comb);});$VIS_UTILITY.setColorPickerShowAutomatic(this,showAutomatic);}if(sync){this.syncControls(set);}else{set.call(this);}}function cbSelectionToIndices(selection){return(selection||[]).map(function(elem){elem=$HASH.clone(elem);return $VIS_UTILITY.findInArray(cbElements,function(item){return $GMU.isEqualComb(elem,$HASH.clone(item.comb));});}).filter(function(idx){return idx!==-1;});}function getRealSelectionIndex(){return[].concat(selectedIdx===0?realIndexes:selectedIdx);}var host=this.getHost(),cbElements=host.getColorByElements(),initCbSel=cbSelectionToIndices(host&&host.edtModelCbInitSelection),selectedIdx,SHAPE_FILL="ShapeClr",SHAPE_OPACITY="ShapeFillTrans",AUTOMATIC_COLOR_VALUE=$ACP.VAL_AUTOMATIC,shapeItems=cbElements.map(function(e,idx){return{n:e.text,title:e.text,v:idx};}),realIndexes=$VIS_UTILITY.range(1,shapeItems.length),hasInitialMultiSelection=false,multiElementText=mstrmojo.desc(12092,"Multiple Elements"),itemPulldown,color;if(initCbSel.length===0){selectedIdx=0;}else{if(initCbSel.length===1){selectedIdx=initCbSel[0];}else{selectedIdx=initCbSel;hasInitialMultiSelection=true;}}color=new mstrmojo.ui.editors.controls.FillConfigGroup({onGroupValueChange:function(name,newVal){var newValues=[],combList=[],isShapeFill=name===SHAPE_FILL,isShapeOpacity=name===SHAPE_OPACITY,indexArray=getRealSelectionIndex();indexArray.forEach(function(idx){var elem=cbElements[idx],comb=elem.comb,sub;combList.push(comb);if(isShapeFill){if(newVal===AUTOMATIC_COLOR_VALUE){newValues.push("default");sub=host.listenToUpdateColorMap(function(){var combCount=combList.length,newColor;indexArray.forEach(function(index){var element=cbElements[index];newColor=$GMU.decodeColor($VIS_UTILITY.getCombColor(host,element.comb));element.color=newColor;});if(combCount>1){newColor=cbElements[0].color;}color.syncControls(function(){this.setChildValue(SHAPE_FILL,newColor);$VIS_UTILITY.setColorPickerShowAutomatic(color,false);});host.detachUpdateColorMapListener(sub);});}else{newValues.push($GMU.encodeColor(newVal));elem.color=newVal;}}else{if(isShapeOpacity){newValues.push(newVal);elem.opacity=newVal;}}});if(isShapeFill){host.updateColorMap(combList,newValues);$VIS_UTILITY.setColorPickerShowAutomatic(this,true);}if(isShapeOpacity){host.updateColorByOpacity(combList,newValues);}}});if(color){color.iniChildrenComp([SHAPE_FILL,SHAPE_OPACITY]);setColorAndOpacity.call(color,true,hasInitialMultiSelection?undefined:selectedIdx);}itemPulldown=this.getPulldown(shapeItems,setColorAndOpacity.bind(color,true),hasInitialMultiSelection?undefined:selectedIdx,{setDisplayText:function(txt){var selectedNode=this.selectedNode;if(selectedNode){selectedNode.innerHTML=txt;selectedNode.title=txt;}}});if(hasInitialMultiSelection){itemPulldown.attachEventListener("renderComplete",itemPulldown.id,function(){itemPulldown.setDisplayText(multiElementText);});}addEventHandler.call(this,WIDGET_SELECTION_CHANGE_REGISTRY,"shapeColor",function(evt){var indices=cbSelectionToIndices(evt.colorbyElements),count=indices.length;if(count<1){return ;}if(indices.length===1){itemPulldown.set("selectedIndex",indices[0]);}else{itemPulldown.setDisplayText(multiElementText);selectedIdx=indices;setColorAndOpacity.call(color,true);}});addEventHandler.call(this,COLORBY_COLOR_CHANGE_REGISTRY,"fill",function(evt){color.syncControls(function(){color.setChildValue(SHAPE_FILL,evt.fill);$VIS_UTILITY.setColorPickerShowAutomatic(color,evt.showAutomatic);});});addEventHandler.call(this,COLORBY_COLOR_CHANGE_REGISTRY,"opacity",function(evt){color.syncControls(function(){color.setChildValue(SHAPE_OPACITY,evt.opacity);});});addEventHandler.call(this,COLORBY_COLOR_CHANGE_REGISTRY,"invalidateCache",function(){cbElements.forEach(function(element,idx){if(idx===0){return ;}element.color=$GMU.decodeColor($VIS_UTILITY.getCombColor(host,element.comb));});});return this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(13753,"Shape Color")),itemPulldown,color]);}function getMetricColorByShapeColor(){function updateOpacityControl(){if(fillCtrl){fillCtrl.syncControls(function(){var model=$VIS_UTILITY.getPropertyByPath(host,"observableModel.colorByOpacity"),val=model!==undefined?model.getValue():1,v=val*100;this.setChildValue(SHAPE_OPACITY,v.toString());});}}var host=this.getHost();var SHAPE_OPACITY="ShapeFillTrans";var fillCtrl,model;var thresholdCtrl=new mstrmojo.Label({text:mstrmojo.desc(14110,"Select Color Ranges..."),cssText:"text-decoration: underline; cursor: pointer; padding-top: 2px; padding-bottom: 2px;",onclick:function(){host.model.openThresholdEditor($VIS_UTILITY.getMetricsInDropZone(host.zonesModel,DROP_ZONES.ColorBy)[0],true,false);}});var opacityCtrl=this.getLabelAndControl(mstrmojo.desc(13658,"Fill Opacity"),new mstrmojo.ui.editors.controls.FillConfigGroup({visibleControls:FILL_CONFIG_CONTROL.FILL_TRANSPARENCY,onGroupValueChange:function(name,newVal){if(name===SHAPE_OPACITY){var model=$VIS_UTILITY.getPropertyByPath(host,"observableModel.colorByOpacity");if(model){model.setValue(newVal/100);}}}}));if(opacityCtrl){fillCtrl=opacityCtrl.getCtrl();fillCtrl.iniChildrenComp([SHAPE_OPACITY]);updateOpacityControl();model=$VIS_UTILITY.getPropertyByPath(host,"observableModel.colorByOpacity");if(model){model.attachEventListener("valueChanged",host.id,updateOpacityControl);}}return this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(13753,"Shape Color")),thresholdCtrl,opacityCtrl]);}function getHeaderFillControl(){var host=this.getHost(),props=getPropsInfo.call(this),attributes=host.levelAttributes;if(host&&props.isHeaderOnTop&&attributes&&attributes.length>1){var fillControl=getColorFormatsControl.call(this,undefined,host.observableModel.headerColors,"headerColor");fillControl.unshift(this.getGroupTitle(mstrmojo.desc(14115,"Header Fill:")));return this.getEditorGroup(fillControl);}}function getDataExplorationControls(dynamicCtrlGroup){var host=this.getHost(),model=host.observableModel,cbType=host.getPropsInfo().colorByType,children,colorByControl;if(!model){return ;}var fontModel=model&&model.fonts,headerModel=fontModel&&(host.props&&host.props.isHeaderOnTop?fontModel.headerOnTop:fontModel.headerOnMiddle),textGroup=[this.getGroupTitle(mstrmojo.desc(3544,"Text"))];if(headerModel){textGroup=textGroup.concat(getFontControl.call(this,headerModel));}children=[this.getEditorGroup([getLabelControl.call(this,mstrmojo.desc(7195,"Layout:")),getLayoutContent.call(this),getHeaderType.call(this),getLabelSize.call(this),getShowMetricValues.call(this)]),this.getEditorGroup(textGroup),getHeaderFillControl.call(this),this.getEditorGroup([this.getMoreOptionsEditorLink((host.modelData&&host.modelData.gsi&&host.modelData.gsi.prop)||{})])];if(cbType==="attribute"){colorByControl=getAttributeColorByShapeColor.call(this);}else{if(cbType==="metric"&&$VIS_UTILITY.getMetricsInDropZone(host.zonesModel,DROP_ZONES.ColorBy)[0]!==undefined){colorByControl=getMetricColorByShapeColor.call(this);}}if(colorByControl){children.splice(1,0,colorByControl);}this.replaceChildControls(dynamicCtrlGroup,children);}function getShowLegend(model,dependentControls){var showLegend=!!(model&&model.getValue()),ctrl=getCheckbox.call(this,showLegend,mstrmojo.desc(13600,"Show legend"),function(newVal){$VIS_UTILITY.toggleControlEnabled(dependentControls,newVal);if(model){model.setValue(newVal);}}),checkbox=ctrl.getCtrl();if(model){model.attachEventListener("valueChanged",this.id,function(evt){var newVal=evt.newValue;if(checkbox.checked!==newVal){checkbox.set("checked",newVal);}});}return ctrl;}function getLegendControls(dynamicCtrlGroup){var model=this.getHost().observableModel,showLegendModel=model&&model.showLegend,showLegend=!!(showLegendModel&&showLegendModel.getValue()),controls=[getLegendCharacterFormatControl.call(this,{controlName:"LegendTextFontGroup"})],dependentControls;controls=controls.concat(getColorFormatsControl.call(this,mstrmojo.desc(13601,"Fill:"),model.legendBackground,"legendBackground"));dependentControls=controls.slice();controls.unshift(getShowLegend.call(this,showLegendModel,dependentControls));this.replaceChildControls(dynamicCtrlGroup,[this.getEditorGroup(controls)]);$VIS_UTILITY.toggleControlEnabled(dependentControls,showLegend);}function addEventHandler(registryName,type,fn,context){var registry=this[registryName];if(registry===undefined){this[registryName]={};registry=this[registryName];}registry[type]={fn:fn,context:context};}function getEventDispatcher(registryName){var me=this;return function(evt){var registry=me[registryName]||{},typeList=evt.type==="*"?Object.keys(registry):[].concat(evt.type),handler;typeList.forEach(function(type){if(registry.hasOwnProperty(type)){handler=registry[type];handler.fn.call(me,evt,handler.context);}});};}mstrmojo.vi.models.editors.HeatMapEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.HeatMapEditorModel",help:"dashboard_editor_heat_map_html5_properties.htm",init:function(props){if(this._super){this._super(props);}var host=this.getHost();if(!host){return ;}var dispatch=getEventDispatcher.bind(this);host.attachEventListener("selectionChange",this.id,dispatch(WIDGET_SELECTION_CHANGE_REGISTRY));host.attachEventListener("colorByColorChange",this.id,dispatch(COLORBY_COLOR_CHANGE_REGISTRY));host.attachEventListener("fontScaleChange",this.id,dispatch(FONT_SCALE_CHANGE_REGISTRY));},getInitialTarget:function getInitialTarget(){return CATEGORIES_DATA_EXPLORATION;},getTargetPulldownItems:function getTargetPulldownItems(dynamicCtrlGroup){var host=this.getHost(),pulldownItems=this._super(dynamicCtrlGroup),fnGetHandler=function(fn){return fn.bind(this,dynamicCtrlGroup);}.bind(this);if(!host.isEmpty()&&host.highlightCanvas){pulldownItems.push({n:mstrmojo.desc(11974,"Data Exploration"),v:CATEGORIES_DATA_EXPLORATION,h:fnGetHandler(getDataExplorationControls)});pulldownItems.push(pulldownItems.shift());if(host.hasSizebyOrColorby()){pulldownItems.push({n:mstrmojo.desc(2403,"Legend"),v:CATEGORIES_LEGEND,h:fnGetHandler(getLegendControls)});}}return pulldownItems;},onBEMFormatChange:function onBEMFormatChange(evt){if(!evt.isTitle&&evt.propertyName===ENUM_PROPERTY_NAMES.BACKGROUND_COLOR){var host=this.getHost()||{},om=host.observableModel;if(om){om.background.value.setValue(evt.value);}}}});}());