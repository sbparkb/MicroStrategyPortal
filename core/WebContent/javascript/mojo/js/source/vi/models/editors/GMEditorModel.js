(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.num","mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.ui.Pulldown","mstrmojo.tooltip","mstrmojo.gm.GMUtility","mstrmojo.VisUtility","mstrmojo.NumStepperContentProvider","mstrmojo.ui.CheckList","mstrmojo.vi.ui.rw.selectors.CheckList","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.Menu","mstrmojo.gm.GMEnums","mstrmojo.ui.editors.controls.AdvancedColorPicker","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.LineConfigGroup","mstrmojo.ui.editors.controls.FillConfigGroup","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.Stepper","mstrmojo.ui.editors.controls.CustomRange","mstrmojo.ui.editors.controls.GMReferenceLineList");var UNDEFINED_IDENTITY="[undefinedIdentity]",NO_HIGHLIGHT=0;var $EF=mstrmojo.emptyFn,$WIDGET=mstrmojo.Widget,$ARR=mstrmojo.array,$HASH=mstrmojo.hash,$CSS=mstrmojo.css,$FUNC=mstrmojo.func,$NUM=mstrmojo.num,$GM=mstrmojo.gm,$UTIL=mstrmojo.VisUtility,$DTP=mstrmojo.expr.DTP,$GM_UTIL=$GM.GMUtility,$SEL_OPT_LVL=$GM.EnumSelectionOptionLevel,$ENUM_XML_TAG=$GM.WidgetPropertyTag,$ENUM_FORMAT_TAG=$GM.FormatingPropertyTag,$ENUM_FORMAT_PROPERTIES=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,$ENUM_FONT_STYLE_VALUE=mstrmojo.chart.enums.EnumFontStyle,$ENUM_IDENTITY_TYPE=$GM.EnumIdentityType,$ENUM_SHAPE=$GM.EnumShape,$ENUM_SHAPE_SUBTYPE=$GM.EnumSubtype,$ENUM_OPT_LEVEL=$GM.EnumSelectionOptionLevel,$CHARACTER_CTRL_FLAGS=mstrmojo.ui.editors.controls.CharacterGroup.CTRL_FLAGS,$ACP=mstrmojo.ui.editors.controls.AdvancedColorPicker,$FILL_GROUP_FLAGS=mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS,nestedGroupProps={isNested:false,showDivider:false},nestedGroupWithDividerProps={isNested:false,showDivider:true},nestedGroupNoPropEnableProps={propagateChildProps:function(prop){if(prop!=="enabled"){this._super();}}};var XML_TAG_AXIS_SCALE_DATA=$ENUM_XML_TAG.AXIS_SCALE_DATA,XML_TAG_AXIS_ORIGIN=$ENUM_XML_TAG.AXIS_ORIGIN;var VIS_PROFILE_IS_BUBBLE=1,VIS_PROFILE_SEASON_ENABLED=2,VIS_PROFILE_HAS_NUM_AX=4,VIS_PROFILE_HAS_SIZE_BY=8,VIS_PROFILE_HAS_COLOR_BY=16,VIS_PROFILE_SHOW_TXT_DATA_LABEL=32,VIS_PROFILE_PURE_LINE_AND_TICK=64,VIS_PROFILE_SHOW_VAL_DATA_LABEL=128,VIS_PROFILE_IS_PERCENT_GRAPH=256,VIS_PROFILE_HAS_SIZE_BY_METRIC=512,VIS_PROFILE_IS_ABL=1024,VIS_PROFILE_PURE_AREA=2048,VIS_PROFILE_IS_LINE=4096,VIS_PROFILE_IS_TICK=8192,VIS_PROFILE_HAS_BREAK_BY=16384,VIS_PROFILE_PURE_BAR_AREA_CIRCLE_SQUARE_RING_PIE=32768,VIS_PROFILE_HAS_LINE_OR_AREA=65536,VIS_PROFILE_AXIS_IN_COLOR_BY=131072,VIS_PROFILE_IS_EMPTY=262144;var CATEGORIES_DATA_EXPLORATION="de",CATEGORIES_TREND_LINES="tln",CATEGORIES_REFERENCE_LINES="rln",CATEGORIES_TITLE_AND_CONTAINERS=mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE,CATEGORIES_SHAPES="sp",CATEGORIES_AXIS="ax",CATEGORIES_LEGEND="lgd",CATEGORIES_ROWS_COLUMNS="rcl";var IDENTITY_MAP_TYPE_PANEL="panel",IDENTITY_MAP_TYPE_SELECTOR="selector";var VAL_CLEAR="default";var NAME_AXIS_SCALE_FOR="selAxSc4",NAME_BORDER_METRICS_LINE_FOR="selBdrMtxLn4",NAME_BACKGROUND_FILL_FOR="selBgFill4",NAME_ROWS_COLUMNS_BG_FILL_FOR="rwColBgFill4",NAME_AXIS_LABELS_FOR="selAxLbl4",NAME_AXIS_LINES_FOR="selAxLn4",NAME_AXIS_TITLES_FOR="selAxTil4",NAME_GRID_LINES_FOR="selGL4",NAME_ROWS_COLUMNS_FOR="selRwCl4",NAME_TREND_LINE_FOR="selTln4",NAME_REFERENCE_LINE_METRIC_FOR="selRfMtcln4",NAME_REFERENCE_LINE_TYPE_FOR="selRfTyln4";var LEVEL_SEPARATOR="@",NAME_FIELD_SEPARATOR=":",OPT_SEPARATOR="#",SUFFIX_PROP_NOT_SET="_default",PREFIX_ROW_TEXT="rwTxt",PREFIX_COL_TEXT="colTxt",PREFIX_ROW_HEADER="rwHdr",PREFIX_COL_HEADER="colHdr",PREFIX_ALL_TEXT="allTxt",PREFIX_LEGEND="lgd",PREFIX_LEGEND_BACKGROUND="lgdBg",PREFIX_SHAPE="shp",PREFIX_SHAPE_BORDER="shpBdr",PREFIX_DATA_LABELS="dl",PREFIX_ALL_AXIS_LABEL="allAxLb",PREFIX_X_AXIS_LABEL="xAxLb",PREFIX_Y_AXIS_LABEL="yAxLb",SUFFIX_FONT_FAMILY="FntFml",SUFFIX_FONT_STYLE="FntStyle",SUFFIX_FONT_SIZE="FntSz",SUFFIX_FONT_COLOR="FntClr",SUFFIX_ROTATION="Rtt",SUFFIX_SHOW="Shw",SUFFIX_COLOR="Clr",SUFFIX_BORDER_STYLE="CmbStyle",SUFFIX_FILL_COLOR="FillClr",SUFFIX_FILL_TRANSPARENT="FillTrans",SUFFIX_TEXT_ALIGNMENT_HORIZONTAL="TxtAlignH",SUFFIX_TEXT_ALIGNMENT_VERTICAL="TxtAlignV",TARGET_SELECTABLE=1,CTRL_TYPE_CHARACTER_GROUP=0,CTRL_TYPE_CHECK_BOX=1;var TREND_REF_LINE_LEVEL_ITEMS=[{n:mstrmojo.desc(11980,"Per cell"),v:$GM.EnumTrendRefLevel.DssModelLevelPerCell},{n:mstrmojo.desc(11981,"Per row"),v:$GM.EnumTrendRefLevel.DssModelLevelPerRow},{n:mstrmojo.desc(11982,"Per column"),v:$GM.EnumTrendRefLevel.DssModelLevelPerColumn},{n:mstrmojo.desc(11983,"Entire table"),v:$GM.EnumTrendRefLevel.DssModelLevelPerPanel}];var MENU_CSS_CLS="propEditor-Menu";var enableDebug=false;function debugLog(msg){if(enableDebug&&window.console){window.console.log(msg);}}function illegalStatus(msg){debugLog(msg);return undefined;}var ENUM_LOCAL_STATES={IN_FORMATTING_MODE:"inFmtMode",SELECTED_CATEGORY:"selCat"},localState={};function clearAllHighLights(highLightObjects){(highLightObjects||[]).forEach(function(obj){obj.onHighlightObjChange(NO_HIGHLIGHT);});}function setHighLightObject(obj,isHighlight){var fn=isHighlight?$CSS.addClass:$CSS.removeClass;fn(obj.domNode,"hilight");}function getMouseClickHighLightFn(edtMgr){return function(){var cleanList=(edtMgr&&edtMgr._hilightObjListens);if(cleanList){clearAllHighLights(cleanList);}if(!edtMgr.host.formattingMode){return ;}if(this.groupTitle){setHighLightObject(this.groupTitle,true);}var scopeSelector=((this.groupTitle&&this.groupTitle.scopeSelectors&&this.groupTitle.scopeSelectors[0])||(this.scopeSelectors&&this.scopeSelectors[0]));if(scopeSelector){edtMgr.sendNonShapeTargetSelectionIdentity(scopeSelector);}};}function hasIdentityIncluded(srcIdentities,tgtIdentity){return srcIdentities.some(function(srcIdentity){return $GM_UTIL.longIntAnd(srcIdentity,tgtIdentity)===srcIdentity;});}function getRootIdentity(identity){while(identity&&identity.parentIdentity){identity=identity.parentIdentity;}return identity;}function getLevelOptionItems(options,hiLightIdentity){var optionItems=[];(options||[]).forEach(function(option){if(optionItems.length===0&&hiLightIdentity){optionItems.push({n:option.opt,identity:hiLightIdentity,v:option});}else{optionItems.push({n:option.opt,v:option});}});return optionItems;}function getRefLineItems(options){return(options||[]).map(function(option){return $HASH.copy(option,{v:option});});}function getAxisScaleOptionItems(){return getLevelOptionItems(this.getHost().getNumericAxisOptions(true));}function getReferenceLineAxisItems(){return getLevelOptionItems(this.getHost().getReferenceAxisOption());}function getTrendLineOptionItems(){return getLevelOptionItems(this.getHost().getDependentMetricOptions());}function getTrendLineForecastOptionItems(){return getLevelOptionItems(this.getHost().getIndependentMetricOptions());}function getGroupTitle(text,overrides){var broker=this.broker,edtMgr=broker.editorManager,rst=this.getGroupTitle(text);$HASH.copy({onHighlightObjChange:function(objType){var highlightObjects=this.highlightObjects;if(!highlightObjects){return illegalStatus("[GroupTitle] "+text+": not listen on any Highlight Objects but was registered as listener.");}setHighLightObject(this,hasIdentityIncluded(highlightObjects,objType));},highlightObjects:[]},rst);$HASH.copy(overrides,rst);edtMgr.registerGroupTitle(rst);return rst;}function syncControl(control,fnSync){var oldSync=control._sync;control._sync=true;fnSync.call(control);control._sync=oldSync;}function getTargetSelector(label,selectorName,items,edtMgr,overrides){var props=$HASH.copy(overrides,{postclick:getMouseClickHighLightFn(edtMgr),updateSelection:function(identityType,identities){var currentSync=this._sync;this._sync=true;var selectedIndex=-1,selIdentity=NO_HIGHLIGHT;this.items.forEach(function(item,idx){var curIdentity=item.identity;if(hasIdentityIncluded([curIdentity],identityType)&&hasIdentityIncluded([selIdentity],curIdentity)){selectedIndex=idx;selIdentity=curIdentity;}});this.set("selectedIndex",selectedIndex);this._sync=currentSync;},isHostedWithin:false});var control=this.addDisposable(this.getPulldown(items,props.fnChange||function(value){edtMgr.onTargetSelectionChanged(selectorName,value);if(this._sync){return ;}edtMgr.sendNonShapeTargetSelectionIdentity(selectorName);},0,props));edtMgr.registerSelector(selectorName,control,props.highlightObjects);if(typeof label==="string"){var isSpecial=!!this.usingSpecialFormat,rst=this.getLabelAndControl(label,control,isSpecial?"40%":"30%",isSpecial?"60%":"70%");control.label=rst.getLabel();return rst;}return control;}function getFmtControlSharedProperties(broker,smartNames){return{broker:broker,manager:broker.editorManager,smartNames:smartNames,controlName:smartNames[0],reInitDefault:function(){(this.listenFormatProps).forEach(function(smartName){this.onFmtPropsChanged(smartName,this.broker.getFormatPropertyValue(smartName));},this);},reInit:function(){this.reInitDefault();},preBuildRendering:function(){this.reInit();},syncControl:function(fnSync){var currentSync=this._sync;this._sync=true;var rst=fnSync.call(this);this._sync=currentSync;return rst;},onFmtPropsChangedDefault:$EF,onFmtPropsChanged:function(smartName,value,opt){this.onFmtPropsChangedDefault(smartName,value,opt);},onSelectorsValueChangedDefault:function(){this.reInit();},onSelectorsValueChanged:function(selName,value){this.onSelectorsValueChangedDefault(selName,value);},postclick:getMouseClickHighLightFn(broker.editorManager),onHighlightObjChange:function(objType){var highlightObjects=this.highlightObjects;if(!highlightObjects||!highlightObjects.length||!this.label){return illegalStatus("[Control] "+this.controlName+": was registered as listener but does not listen on any Highlight Objects or has no label attached.");}setHighLightObject(this.label,hasIdentityIncluded(highlightObjects,objType));}};}function doControlPostCreating(control,labelText,controlType,columnSizes){if(!control){return ;}function removeDuplicate(arr){return Object.keys($ARR.hash($ARR.ensureArray(arr)));}var listenFormatProps=control.listenFormatProps||[],listenSelector=control.listenSelector||[];(control.smartNames||[]).forEach(function(sn){$ARR.insert(listenFormatProps,null,sn);$ARR.insert(listenSelector,null,control.broker.getDependingSelectorNames(sn));});control.listenFormatProps=removeDuplicate(listenFormatProps);control.listenSelector=removeDuplicate(listenSelector);control.manager.registerFormatControl(control);var result=control;if(typeof labelText==="string"){var isCheckbox=(controlType===CTRL_TYPE_CHECK_BOX),labelWidth=isCheckbox?"20px":"30%",controlWidth=isCheckbox?"100%":"70%";if(columnSizes){labelWidth=columnSizes[0];controlWidth=columnSizes[1];}result=this.getLabelAndControl(labelText,control,labelWidth,controlWidth,isCheckbox);control.label=result.getLabel();if(isCheckbox){result.cssClass="checkLabel multiLine";control.label.onclick=function onclick(){control.onclick();};control.label.cssDisplay="inline-block";}else{if(controlType===CTRL_TYPE_CHARACTER_GROUP){result.cssClass="characterGroup";}}}control.getCtrlContainer=function(){return result;};return result;}function getShapeObjectMenuPulldown(shapeObjectOptions,overrides){var broker=this.broker,edtMgr=broker.editorManager,allItem=shapeObjectOptions.allItem,metricItems=shapeObjectOptions.metricItems,colorByItems=shapeObjectOptions.colorByItems,visible=true;if(metricItems.length<2&&colorByItems.length<1&&(!broker.getLocalState(ENUM_LOCAL_STATES.IN_FORMATTING_MODE)||!broker.getVisProfile(VIS_PROFILE_HAS_BREAK_BY))){visible=false;}var control=this.addDisposable(new mstrmojo.ui.editors.controls.MenuPulldown($HASH.copy(overrides,{selectorName:"shapeObjectSelector",visible:visible,syncControl:function(fnSync){var currentSync=this._sync;this._sync=true;var rst=fnSync.call(this);this._sync=currentSync;return rst;},value:colorByItems.length?colorByItems[0]:allItem,valueWas:null,onvalueChange:function(evt){var val=evt.value;this.updateTooltip(this.selectedNode,val.opt);if(!this._sync&&val&&!(val.optLvl===$SEL_OPT_LVL.COLOR_BY&&val.key==="multiple")){edtMgr.sendShapeOption(true);}edtMgr.shapeFormatControls.forEach(function(control){control=control.getCtrl?control.getCtrl():control;control.reInit();});},updateSelection:function(value){this.syncControl(function(){var currentVal=this.value;if(!edtMgr.isShapeOptionEqual(this.value,value)||(currentVal&&(currentVal.key==="multiple"||currentVal.optLvl===$ENUM_OPT_LEVEL.ITSELF))){this.set("value",$HASH.copy(value));if(broker.getLocalState(ENUM_LOCAL_STATES.IN_FORMATTING_MODE)){this.set("valueWas",$HASH.copy(value));}}});},updateTooltip:function(node,str){if(!node){return ;}var fs={};fs.fontFamily=$CSS.getStyleValue(node,"font-family");fs.fontSize=$CSS.getStyleValue(node,"font-size");fs.fontStyle=$CSS.getStyleValue(node,"font-style");fs.fontWeight=$CSS.getStyleValue(node,"font-weight");var strWidth=$UTIL.measureTextWidth(str,fs),wgtWidth=parseInt($CSS.getStyleValue(node,"width"));node.title=strWidth>wgtWidth?str:"";},onwidthChange:function(){if(this.selectedNode){this.updateTooltip(this.selectedNode,this.selectedNode.innerHTML);}},postBuildRendering:function(){if(this.selectedNode){this.updateTooltip(this.selectedNode,this.selectedNode.innerHTML);}},getDisplayText:function(value){return(value&&value.opt)||"";},getMenuConfig:function(){var me=this;function getSubMenuConfig(items){var subMenuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:MENU_CSS_CLS,newInstance:function(props){return new mstrmojo.ui.menus.Menu(mstrmojo.hash.copy({popupConfig:this,themeClassName:mstrApp.getThemeClassName()},props));}});(items||[]).forEach(function(item){subMenuCfg.addMenuItem(me.getDisplayText(item),"",function(){me.set("value",item);});});return subMenuCfg;}var menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:MENU_CSS_CLS,hostId:me.id,hostElement:me.containerNode,isHostedWithin:false});$UTIL.absorbMenuItems(menuCfg,getSubMenuConfig([allItem]));if(metricItems.length>1){if(colorByItems.length>0){menuCfg.addPopupMenuItem(mstrmojo.desc(962,"Metrics"),"",function(){return getSubMenuConfig(metricItems);});menuCfg.addSeparator();}else{$UTIL.absorbMenuItems(menuCfg,getSubMenuConfig(metricItems));}}if(colorByItems.length>0){$UTIL.absorbMenuItems(menuCfg,getSubMenuConfig(colorByItems));}return menuCfg;}})));edtMgr.shapeObjSel=control;edtMgr.sendShapeOption(true);return control;}function getPropertyRefLineList(label,metricOpt,selectorName,smartNames,overrides){var broker=this.broker,edtMgr=broker.editorManager,props=getFmtControlSharedProperties(broker,smartNames);function getSmartName(fld,opt){return broker.generateSmartName(null,$ENUM_XML_TAG.REF_LINE_DEF,fld,opt);}$HASH.copy({controlName:selectorName,items:[],metricOpt:metricOpt,_toggleRefLineEnabled:function(refLine,enabled){var sn=getSmartName($ENUM_XML_TAG.REF_ENABLED,refLine.v);broker.setFormatPropertyValue(sn,enabled);},reInitDefault:function(){this.syncControl(function(){this.set("items",this.broker.getOptionItems(this.controlName,this.metricOpt));if(this.items.length>0){this.selectItemByField("key",this.items[0].key);}});},generateNewRefLineItem:function generateNewRefLineItem(refType,constVal){var option=broker.vis.getRealReferenceOptionFromAxisOption(this.metricOpt,refType),refLine=$HASH.copy(option,{v:option});if(refLine.refType===$GM.EnumRefLineModelType.CONST){refLine.c=$NUM.parseNumeric(constVal);}return refLine;},onselectRefLine:function(refLine){this.manager.onTargetSelectionChanged(selectorName,refLine);},onremoveRefLine:function(refLine){if(this._sync){return ;}this._toggleRefLineEnabled(refLine,false);},onrenameRefLine:function(refLine){if(this._sync){return ;}var selKey=refLine.key;if(refLine.refType===$GM.EnumRefLineModelType.CONST){var sn=getSmartName($ENUM_XML_TAG.REF_LINE_NAME,refLine.v);broker.setFormatPropertyValue(sn,refLine[$ENUM_XML_TAG.REF_LINE_NAME]);}this.selectItemByField("key",selKey);},onaddRefLine:function(refLine){if(this._sync){return ;}var selKey=refLine.key;if(refLine.refType===$GM.EnumRefLineModelType.CONST){var sn=getSmartName($ENUM_XML_TAG.REF_CONST_VALUE,refLine.v);broker.setFormatPropertyValue(sn,refLine.c);}else{this._toggleRefLineEnabled(refLine,true);}this.selectItemByField("key",selKey);},onFmtPropsChangedDefault:function(){this.syncControl(function(){var selIt=this.getSelectedItem(),selKey=selIt&&selIt.key;this.reInit();this.selectItemByField("key",selKey);});},onSelectorsValueChangedDefault:function(selName,value){if(value!==this.metricOpt){this.metricOpt=value;this.reInit();}}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.editors.controls.GMReferenceLineList(props));edtMgr.registerSelector(selectorName,control,props.highlightObjects);return doControlPostCreating.call(this,control,label);}function getPropertyButtonBar(label,items,smartName,overrides){var broker=this.broker,smartNames=[smartName],props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({showIcon:false,items:items,onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){if(this.multiSelect){this.select((this.items||[]).map(function(item,idx){return(value&item.v)>0?idx:null;}).filter(function(elem){return elem!==null;}));}else{if(typeof value==="undefined"){this.clearSelect();}else{this.singleSelectByField(value,"v");}}});},postselectionChange:function(evt){if(this._sync){return ;}var value=evt.added&&this.items[evt.added[0]].v;if(this.multiSelect){if(!items||!items.length){return illegalStatus("[GMEditorModel getBitwiseValFromMultiSelection] no items in caller");}value=items.reduce(function(value,item,idx){return this.selectedIndices[idx]?value|=item.v:value;}.bind(this),0);}this.broker.setFormatPropertyValue(this.smartNames[0],value);}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.ButtonBar(props));return doControlPostCreating.call(this,control,label);}function getMetricsInDropZone(zonesModel,dropZoneId){var METRIC_NAMES_ID="00000000000000000000000000000000",dropZones=zonesModel.dropZones,idx=$ARR.find(dropZones,"id",dropZoneId);return idx===-1?[]:$ARR.filter(dropZones[idx].items,function(item){return item.t===4&&item.id!==METRIC_NAMES_ID;});}function getPropertyPulldown(label,items,smartName,overrides,colSizeConfig){overrides=overrides||{};var broker=this.broker,smartNames=[smartName],props=getFmtControlSharedProperties(broker,smartNames),fnChange=overrides.fnChange||function(value){if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],value);};$HASH.copy({onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){if(value==="undefined"){this.set("selectedIndex",-1);}else{this.selectItemByField("v",value);}});}},props);$HASH.copy(overrides,props);var control=this.addDisposable(this.getPulldown(items,fnChange,0,props));return doControlPostCreating.call(this,control,label,null,colSizeConfig||["40%","60%"]);}function getPropertyValidationTextBox(label,smartName,overrides){var broker=this.broker,smartNames=[smartName],props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({dtp:$DTP.FLOAT,required:true,onValid:function(){if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],$NUM.parseNumeric(this.value));},onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){this.set("value",value);this.validate();});}},props);$HASH.copy(overrides,$HASH.copy(getTextBoxPropsWithEmptyVal(broker,smartName),props));var control=this.addDisposable(new mstrmojo.ui.editors.controls.ValidationTextBox(props));return doControlPostCreating.call(this,control,label);}function getPropertyStepper(label,smartName,overrides,providerOverrides){var broker=this.broker,smartNames=[smartName],props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({provider:new mstrmojo.NumStepperContentProvider($HASH.copy(providerOverrides,{item:{interval:1},curVal:0,min:0,getInvalidMsg:function(){return mstrmojo.desc(14312,"This field accepts only integers greater than or equal to zero");},onTraverse:function(){var stepper=this.parent,me=this;if(stepper._sync){return ;}if(this._lastTimeoutId){window.clearTimeout(this._lastTimeoutId);}this._lastTimeoutId=window.setTimeout(function(){delete me._lastTimeoutId;stepper.broker.setFormatPropertyValue(stepper.smartNames[0],me.curVal);},1000);},oncurValChange:function(){var stepper=this.parent;if(stepper.textNode){stepper.updateDisplayText();}}})),preBuildRendering:function(){this.reInit();mstrmojo.ui.editors.controls.Stepper.prototype.preBuildRendering.call(this);},onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){if(typeof value==="undefined"){value="";}this.provider.set("curVal",value);});}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.editors.controls.Stepper(props));control.provider.parent=control;return doControlPostCreating.call(this,control,label,null,["40%","60%"]);}function fnGetConvertValue(broker,smartName,value){var fPKey=broker.getFormatPropertyKey(smartName),getMetricKeysForFormat=function(){var combObj=broker._resolveLevelOptionWithRuntime(fPKey),res=[];if(combObj.key==="AllMetrics"){res.push(combObj.mos[0].mId);}else{combObj.mos.forEach(function(item){res.push(item.mId);});}return res;};var ret,metricKey=getMetricKeysForFormat();ret=broker.vis.formatAsAxisLabel(metricKey,value);if(ret!==undefined){return ret;}return this.constructor.prototype.getConvertValue(value);}function accFloatMultDiv(value1,value2,isMulti){var vstr1=String(value1),vstr2=String(value2),deci1=vstr1.split(".")[1],deci2=vstr2.split(".")[1],decimalLen1=deci1?deci1.length:0,decimalLen2=deci2?deci2.length:0,v1=Number(vstr1.replace(".","")),v2=Number(vstr2.replace(".",""));if(isMulti){return v1*v2/Math.pow(10,decimalLen1+decimalLen2);}else{return accFloatMultDiv(v1/v2,Math.pow(10,decimalLen2-decimalLen1),true);}}function getAxisScaleTypePulldownMenu(label,smartNameOfScaleType,smartNamesMapOfScaleRange,smartNamesMapOfAutoScaleRange,overrides){var DISPLAY_TEXT_LOOKUP=[mstrmojo.desc(11976,"Global"),mstrmojo.desc(11985,"Per row/column"),mstrmojo.desc(11980,"Per cell"),mstrmojo.desc(13871,"Custom..."),mstrmojo.desc(13661,"Different")];var broker=this.broker,smartNames=[smartNameOfScaleType],props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({getMenuConfig:function(){var me=this,allTypes=$HASH.valarray($GM.EnumAxisScale).slice(0,3),menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:MENU_CSS_CLS,hostId:me.id,hostElement:me.containerNode,isHostedWithin:false});allTypes.forEach(function(ty){menuCfg.addMenuItem(me.getDisplayText(ty),"",function(){me.set("value",ty);});});menuCfg.addPopupMenuItem(me.getDisplayText($GM.EnumAxisScale.CUSTOM),"",function(){var snMap=smartNamesMapOfScaleRange,atMap=smartNamesMapOfAutoScaleRange,range={},auto={},isPercentGraph=broker.getVisProfile(VIS_PROFILE_IS_PERCENT_GRAPH),percentConvert=isPercentGraph?100:1;$HASH.keyarray(snMap).forEach(function(key){range[key]=accFloatMultDiv(broker.getFormatPropertyValue(snMap[key]),percentConvert,true);});$HASH.keyarray(atMap).forEach(function(key){auto[key]=broker.getFormatPropertyValue(atMap[key]);});var constraints=isPercentGraph?{min:-100,max:100}:{min:range.min,max:range.max};return new mstrmojo.ui.menus.EditorConfig({cssClass:MENU_CSS_CLS+" "+mstrApp.getThemeClassName(),data:{newRangeValid:true,rangeKeysChanged:[],autoKeysChanged:[],scaleTypeWillChange:me.value!==$GM.EnumAxisScale.CUSTOM},contents:[{scriptClass:"mstrmojo.ui.editors.controls.CustomRange",alias:"rangeCtrl",range:range,auto:auto,labelOfCustomRange:mstrmojo.desc(13662,"Axis Range"),rangeConstraints:{min:{min:null,max:range.max},max:{min:range.min,max:null}},oninputValidChange:function(evt){this.parent.data.set("newRangeValid",evt.value);},autoChanged:function(){var newAuto=this.getAuto(),keysOfChanged=$ARR.filter($HASH.keyarray(auto),function(key){return String(auto[key])!==String(newAuto[key]);});if(this.parent){this.parent.data.set("autoKeysChanged",keysOfChanged);}},rangeChanged:function(){var newRange=this.getRange(),keysOfChanged=$ARR.filter($HASH.keyarray(range),function(key){return String(range[key])!==String(newRange[key]);});this.parent.data.set("rangeKeysChanged",keysOfChanged);},getConvertValue:function(value){return fnGetConvertValue.call(this,broker,snMap.min,accFloatMultDiv(value,percentConvert,false));}}],bindings:{okEnabled:function(){return(this.data.newRangeValid&&(this.data.rangeKeysChanged.length>0||this.data.scaleTypeWillChange))||this.data.autoKeysChanged.length>0;}},onOpen:function(){this.rangeCtrl.updateDisplay();},fnOk:function(data,editor){var newRange=editor.rangeCtrl.getRange(),keysOfChanged=this.data.rangeKeysChanged,newAuto=editor.rangeCtrl.getAuto(),autoKeysChanged=this.data.autoKeysChanged;keysOfChanged.forEach(function(key,idx,arr){broker.setFormatPropertyValue(snMap[key],accFloatMultDiv(newRange[key],percentConvert,false),null,data.scaleTypeWillChange||idx!==arr.length-1);});autoKeysChanged.forEach(function(key,idx,arr){broker.setFormatPropertyValue(atMap[key],newAuto[key],null,data.scaleTypeWillChange||idx!==arr.length-1);});me.set("value",$GM.EnumAxisScale.CUSTOM);}});});return menuCfg;},getDisplayText:function(value){return(!isNaN(value)&&DISPLAY_TEXT_LOOKUP[value])||"";},onvalueChange:function(evt){if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],evt.value);},onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){this.set("value",value);});}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.editors.controls.MenuPulldown(props));return doControlPostCreating.call(this,control,label,null,["40%","60%"]);}function getForecastScatterMenuPulldown(smartName,overrides){var editorModel=this,broker=this.broker,smartNames=[smartName],props=getFmtControlSharedProperties(broker,smartNames),trendForeOptItems=getTrendLineForecastOptionItems.call(this);$HASH.copy({value:trendForeOptItems[0],getDisplayText:function(value){return(value&&value.n)||"";},getMenuConfig:function(){var me=this,menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:MENU_CSS_CLS,hostId:me.id,hostElement:me.containerNode,isHostedWithin:false});trendForeOptItems.forEach(function(item){menuCfg.addPopupMenuItem(me.getDisplayText(item),"",function(){var opt=item.v;function getSmartName(fld){return broker.generateSmartName(null,$ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF,fld,opt);}var snForecastEnabled=getSmartName($ENUM_XML_TAG.TREND_BUBBLE_FORE_ENABLED),foreEnabledValWas=broker.getFormatPropertyValue(snForecastEnabled),snMap={min:getSmartName($ENUM_XML_TAG.TREND_BUBBLE_MIN),max:getSmartName($ENUM_XML_TAG.TREND_BUBBLE_MAX),customMin:getSmartName($ENUM_XML_TAG.TREND_BUBBLE_FORE_BWD),customMax:getSmartName($ENUM_XML_TAG.TREND_BUBBLE_FORE_FWD)},range={};$HASH.keyarray(snMap).forEach(function(key){range[key]=broker.getFormatPropertyValue(snMap[key]);});var rangeCtrl=editorModel.addDisposable(new mstrmojo.ui.editors.controls.CustomRange({alias:"rangeCtrl",range:range,enabled:foreEnabledValWas,labelOfCustomRange:mstrmojo.desc(13734,"Forecast"),rangeConstraints:{min:{min:null,max:range.min},max:{min:range.max,max:null}},oninputValidChange:function(evt){this.parent.data.set("newRangeValid",evt.value);},rangeChanged:function(){var newRange=this.getRange(),keysOfChanged=$ARR.filter($HASH.keyarray(range),function(key){return String(range[key])!==String(newRange[key]);});this.parent.data.set("rangeKeysChanged",keysOfChanged);},getConvertValue:function(value){return fnGetConvertValue.call(this,broker,snMap.min,value);},getTextBoxCfg:function(isMaximum,props){props=[];$HASH.copy({getInvalidMsg:function(vs){if(vs.code===mstrmojo.validation.STATUSCODE.INVALID_OUTOFRANGE){if(!this.constraints.min){return mstrmojo.desc(14325,"Forecasting requires the horizontal axis to be extrapolated to smaller than its current min value of #").replace("#",this.parent.getConvertValue(range.min));}if(!this.constraints.max){return mstrmojo.desc(14326,"Forecasting requires the horizontal axis to be extrapolated to greater than its current max value of #").replace("#",this.parent.getConvertValue(range.max));}}return this.constructor.prototype.getInvalidMsg(vs);}},props);return this.constructor.prototype.getTextBoxCfg(isMaximum,props);}})),checkboxAndLabel=editorModel.getCheckboxAndLabel(foreEnabledValWas,mstrmojo.desc(12026,"Enable Forecasting"),function(){this.parent.parent.data.set("rangeEnabled",this.checked);rangeCtrl.set("enabled",this.checked);});return new mstrmojo.ui.menus.EditorConfig({cssClass:MENU_CSS_CLS+" "+mstrApp.getThemeClassName(),data:{newRangeValid:true,rangeKeysChanged:[],rangeEnabled:foreEnabledValWas},contents:[checkboxAndLabel,{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12027,"Extrapolate values by adjusting the horizontal axis"),cssClass:"textLabel"},rangeCtrl],bindings:{okEnabled:function(){var rangeEnabledChanged=this.data.rangeEnabled!==foreEnabledValWas;return(this.data.rangeEnabled&&this.data.newRangeValid&&(this.data.rangeKeysChanged.length>0||rangeEnabledChanged))||(!this.data.rangeEnabled&&rangeEnabledChanged);}},fnOk:function(data){var foreEnabledVal=data.rangeEnabled,rangeEnabledChanged=foreEnabledVal!==foreEnabledValWas;if(foreEnabledVal){var newRange=rangeCtrl.getRange(),keysOfChanged=this.data.rangeKeysChanged;keysOfChanged.forEach(function(key,idx,arr){broker.setFormatPropertyValue(snMap[key],newRange[key],null,rangeEnabledChanged||idx!==arr.length-1);});}if(rangeEnabledChanged){broker.setFormatPropertyValue(snForecastEnabled,foreEnabledVal);}me.set("value",item);}});});});return menuCfg;}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.editors.controls.MenuPulldown(props));return doControlPostCreating.call(this,control);}function getPropertyCheckBox(label,smartName,overrides){var broker=this.broker,smartNames=[smartName],props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({oncheckedChange:function(){if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],this.checked);},onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){this.set("checked",!!value);});}},props);$HASH.copy(overrides,props);return doControlPostCreating.call(this,this.addDisposable(new mstrmojo.ui.Checkbox(props)),label,CTRL_TYPE_CHECK_BOX);}function getPropertyCheckList(items,smartName,overrides){var broker=this.broker,smartNames=[smartName],allIdx=$ARR.find(items,"isAll",true),props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({items:items,allIdx:allIdx,reInitDefault:function(){var mySn=this.smartNames[0],selIdxs={};(this.listenFormatProps).forEach(function(smartName){if(smartName===mySn){return ;}this.onFmtPropsChanged(smartName,this.broker.getFormatPropertyValue(smartName));},this);(this.items||[]).forEach(function(item,idx){if(this.broker.getFormatPropertyValue(smartName,item.opt)){selIdxs[idx]=true;}},this);this.syncControl(function(){this.set("selectedIndices",selIdxs,true);});},postselectionChange:function(evt){if(this._sync){return ;}var checked=!!evt.added,idx=checked?evt.added[0]:evt.removed[0],opt=this.items[idx].opt;this.broker.setFormatPropertyValue(this.smartNames[0],checked,opt);},onFmtPropsChangedDefault:function(smartName,value,opt){this.syncControl(function(){var selItem=$ARR.filterOne(this.items,function(item){return item.opt.key===opt.key;}),idx=selItem&&this.items.indexOf(selItem);if(!!value){if(this.allIdx>-1&&idx>-1){var selIdxs=$HASH.copy(this.selectedIndices);selIdxs[idx]=true;if($HASH.keyarray(selIdxs).length===this.items.length-1){idx=this.allIdx;}}this.addSelect(idx);}else{this.removeSelect(idx);}});}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.CheckListIcon(props));return doControlPostCreating.call(this,control,null);}mstrmojo.ui.CheckListIcon=mstrmojo.declare(mstrmojo.ui.CheckList,null,{scriptClass:"mstrmojo.ui.CheckListIcon",init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"gm-CheckList");},getItemMarkup:function getItemMarkup(item,idx){var markup='<table><tr><td><span class="icon"></span></td><td><span>{@en@n}</span></td></tr></table>';return this._super(item).replace("<span>{@en@n}</span>",markup);}});function initColorPickerBtnWithGradientDir(colorPickerBtn,vis){$FUNC.override({showPickerForCurrentMode:function showPickerForCurrentMode(){this._super();if(this.pickerMode===2&&typeof this.color!=="object"){var gradientDir=this.gradientOrientation,isVerticalGraph=vis.getChartInfo().dirc===$GM.EnumABLDirection.VERTICAL;gradientDir.set("selectedIndex",$ARR.find(gradientDir.items,"id",isVerticalGraph?0:1));}}},colorPickerBtn.colorPicker);}function getTextBoxPropsWithEmptyVal(broker,snVal){function isConflictState(validationTextBox){var val=validationTextBox.value;return(val===undefined||val==="")&&broker.getFormatPropertyValue(snVal)===undefined;}return{onInvalid:function onInvalid(){if(isConflictState(this)){if(this.hasRendered){this.clearValidation();}return ;}if(this.hasRendered){mstrmojo.ui.editors.controls.ValidationTextBox.prototype.onInvalid.call(this);}},onRender:function(){if(isConflictState(this)){this.clearValidation();}}};}function getPropertyColorPicker(label,smartName,overrides){var broker=this.broker,smartNames=[smartName],props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({showGradient:true,postselectedValueChange:function(evt){if(this._sync){return ;}var val=evt.value;if(val===$ACP.VAL_AUTOMATIC){val=VAL_CLEAR;}this.broker.setFormatPropertyValue(this.smartNames[0],val);},onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){if(typeof value==="undefined"){value="conflict";}if(this.colorDefaultSN&&this.broker.getFormatPropertyValue(this.colorDefaultSN)){this.set("autoPreviewColor",value);value=$ACP.VAL_AUTOMATIC;}this.set("selectedValue",value);});}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.editors.controls.ColorPickerButton(props));return doControlPostCreating.call(this,control,label);}function getUpdatedFontFormats(broker,snMap){var formats={},fontStyleVal=broker.getFormatPropertyValue(snMap.fontStyle),fontColorVal=broker.getFormatPropertyValue(snMap.fontColor),fontFamilyVal=broker.getFormatPropertyValue(snMap.fontFamily),fontSizeVal=broker.getFormatPropertyValue(snMap.fontSize);if(fontStyleVal!==undefined){formats[$ENUM_FORMAT_PROPERTIES.FONT_WEIGHT]=(!isNaN(fontStyleVal)&&((fontStyleVal&$ENUM_FONT_STYLE_VALUE.FS_BOLD)>0));formats[$ENUM_FORMAT_PROPERTIES.FONT_STYLE]=(!isNaN(fontStyleVal)&&((fontStyleVal&$ENUM_FONT_STYLE_VALUE.FS_ITALIC)>0));formats[$ENUM_FORMAT_PROPERTIES.UNDERLINE]=(!isNaN(fontStyleVal)&&((fontStyleVal&$ENUM_FONT_STYLE_VALUE.FS_UNDERLINE)>0));formats[$ENUM_FORMAT_PROPERTIES.LINE_THROUGH]=(!isNaN(fontStyleVal)&&((fontStyleVal&$ENUM_FONT_STYLE_VALUE.FS_STRIKETHROUGH)>0));}formats[$ENUM_FORMAT_PROPERTIES.COLOR]=fontColorVal!==undefined?fontColorVal:-1;formats[$ENUM_FORMAT_PROPERTIES.FONT_SIZE]=fontSizeVal!==undefined?fontSizeVal:-1;formats[$ENUM_FORMAT_PROPERTIES.FONT_FAMILY]=fontFamilyVal!==undefined?fontFamilyVal:-1;return formats;}function getCharacterConfigComp(label,smartNamesMap,overrides){var broker=this.broker,smartNames=$HASH.valarray(smartNamesMap),props=getFmtControlSharedProperties(broker,smartNames),fontStyleValueMap={},propNameToSmartName={};propNameToSmartName[$ENUM_FORMAT_PROPERTIES.FONT_SIZE]=smartNamesMap.fontSize;propNameToSmartName[$ENUM_FORMAT_PROPERTIES.COLOR]=smartNamesMap.fontColor;propNameToSmartName[$ENUM_FORMAT_PROPERTIES.FONT_FAMILY]=smartNamesMap.fontFamily;propNameToSmartName[$ENUM_FORMAT_PROPERTIES.FONT_WEIGHT]=propNameToSmartName[$ENUM_FORMAT_PROPERTIES.FONT_STYLE]=propNameToSmartName[$ENUM_FORMAT_PROPERTIES.UNDERLINE]=propNameToSmartName[$ENUM_FORMAT_PROPERTIES.LINE_THROUGH]=smartNamesMap.fontStyle;fontStyleValueMap[$ENUM_FORMAT_PROPERTIES.FONT_WEIGHT]=$ENUM_FONT_STYLE_VALUE.FS_BOLD;fontStyleValueMap[$ENUM_FORMAT_PROPERTIES.FONT_STYLE]=$ENUM_FONT_STYLE_VALUE.FS_ITALIC;fontStyleValueMap[$ENUM_FORMAT_PROPERTIES.UNDERLINE]=$ENUM_FONT_STYLE_VALUE.FS_UNDERLINE;fontStyleValueMap[$ENUM_FORMAT_PROPERTIES.LINE_THROUGH]=$ENUM_FONT_STYLE_VALUE.FS_STRIKETHROUGH;$HASH.copy({smartNamesMap:smartNamesMap,syncWithAllText:false,onGroupValueChange:function(propName,value){var sn=propNameToSmartName[propName];if(sn===smartNamesMap.fontStyle){var curFontStyle=broker.getFormatPropertyValue(sn),selFontStyleVal=fontStyleValueMap[propName],isSelected=value;value=isSelected?(curFontStyle|selFontStyleVal):(curFontStyle&(~selFontStyleVal));}else{if(sn===smartNamesMap.fontSize){if(this.visibleControls&$CHARACTER_CTRL_FLAGS.FONT_SIZE_USE_STEPPER){value=value[0];}value=parseInt(value,10)+"pt";}}this.broker.setFormatPropertyValue(sn,value);},onFmtPropsChangedDefault:function(smartName){this.syncControl(function(){var snMap=this.smartNamesMap,keyOfChanged=$ARR.filterOne($HASH.keyarray(snMap),function(key){return snMap[key]===smartName;});if(keyOfChanged||this.syncWithAllText){if(!keyOfChanged&&smartName.indexOf(PREFIX_ALL_TEXT)===-1){debugLog("[CharacterGroup] Unnecessary refresh which might be due to incorrect listenFormatProps.");}this.refreshValues();}});},refreshValues:function(){this.syncControl(function(){var fontFmts=getUpdatedFontFormats(this.broker,this.smartNamesMap);if(this.visibleControls&$CHARACTER_CTRL_FLAGS.FONT_SIZE_USE_STEPPER){fontFmts[$ENUM_FORMAT_PROPERTIES.FONT_SIZE]=[parseInt(fontFmts[$ENUM_FORMAT_PROPERTIES.FONT_SIZE],10)];}this.setFormatSource(fontFmts);});}},props);$HASH.copy(overrides,props);if(props.syncWithAllText){var snsAllText=$HASH.valarray(broker.getSmartNamesMapForFontGroup(PREFIX_ALL_TEXT));props.listenFormatProps=(props.listenFormatProps||[]).concat(snsAllText);}var control=this.addDisposable(new mstrmojo.ui.editors.controls.CharacterGroup(props));return doControlPostCreating.call(this,control,label,CTRL_TYPE_CHARACTER_GROUP);}function getLineConfigComp(label,smartNamesMap,overrides){var broker=this.broker,smartNames=$HASH.valarray(smartNamesMap),props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({smartNamesMap:smartNamesMap,onGroupValueChange:function(smartName,value){if(this._sync){return ;}this.broker.setFormatPropertyValue(smartName,value);},onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){this.setChildValue(smartName,value);});}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.editors.controls.LineConfigGroup(props));control.iniChildrenComp(smartNames);var colorSubCtrl=control.getChildComp(SUFFIX_COLOR);if(colorSubCtrl){initColorPickerBtnWithGradientDir(colorSubCtrl,this.getHost());}return doControlPostCreating.call(this,control,label);}function getFillConfigComp(label,smartNamesMap,overrides){var broker=this.broker,smartNames=$HASH.valarray(smartNamesMap),props=getFmtControlSharedProperties(broker,smartNames);$HASH.copy({smartNamesMap:smartNamesMap,onGroupValueChange:function(smartName,value){if(!this._sync){broker.setFormatPropertyValue(smartName,value);}},onFmtPropsChangedDefault:function(smartName,value){this.syncControl(function(){var me=this;if($ARR.filterOne(this.propNames,function(name){return(name===smartName);})){me.setChildValue(smartName,value);}else{this.propNames.forEach(function(name){me.setChildValue(name,me.broker.getFormatPropertyValue(name));});}});}},props);$HASH.copy(overrides,props);var control=this.addDisposable(new mstrmojo.ui.editors.controls.FillConfigGroup(props));control.iniChildrenComp(smartNames);var colorSubCtrl=control.getChildComp(SUFFIX_COLOR);if(colorSubCtrl){initColorPickerBtnWithGradientDir(colorSubCtrl,this.getHost());}return doControlPostCreating.call(this,control,label);}mstrmojo.vi.models.editors.GMEditorManager=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.models.editors.GMEditorManager",host:null,initializing:false,targetSelectors:null,shapeObjSel:null,shapeFormatControls:null,_fmtPropBindings:null,_fmtSelBindings:null,_hilightObjListens:null,_IdentityTypeMapping:null,_nonShapeSelectionToIdentityMapping:null,init:function init(props){this._super($HASH.copy(props,{targetSelectors:{},_fmtPropBindings:{},_fmtSelBindings:{},_hilightObjListens:[],_IdentityTypeMapping:{},_nonShapeSelectionToIdentityMapping:{},shapeFormatControls:[]}));},clearControlsReference:function(){this.targetSelectors={};this._fmtPropBindings={};this._fmtSelBindings={};this._hilightObjListens=[this.model];this.shapeFormatControls.length=0;var idMap=this._IdentityTypeMapping;$ARR.forEach(Object.keys(idMap),function(key){idMap[key][IDENTITY_MAP_TYPE_SELECTOR].length=0;});},_addListener:function(bindings,listenOn,control){var listeners=bindings[listenOn]||[];listeners.push(control);bindings[listenOn]=listeners;},initIdentityPanelMapping:function(){var secondIx=IDENTITY_MAP_TYPE_PANEL,idMap=this._IdentityTypeMapping;$HASH.forEach($ENUM_IDENTITY_TYPE,function(idType){var map=idMap[idType]={};map[IDENTITY_MAP_TYPE_PANEL]=[];map[IDENTITY_MAP_TYPE_SELECTOR]=[];});var nonShapeSelectionMap=this._nonShapeSelectionToIdentityMapping;nonShapeSelectionMap[$ENUM_IDENTITY_TYPE.X_NUMERIC]=$ENUM_IDENTITY_TYPE.X_CATEGORY;nonShapeSelectionMap[$ENUM_IDENTITY_TYPE.Y_NUMERIC]=$ENUM_IDENTITY_TYPE.Y_CATEGORY;idMap[$ENUM_IDENTITY_TYPE.AXIS_SCALE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.LOG_SCALE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.AXIS_ORIGIN_DEFINE][secondIx]=CATEGORIES_DATA_EXPLORATION;idMap[$ENUM_IDENTITY_TYPE.TREND_LINE][secondIx]=CATEGORIES_TREND_LINES;idMap[$ENUM_IDENTITY_TYPE.REF_LINE][secondIx]=CATEGORIES_REFERENCE_LINES;idMap[$ENUM_IDENTITY_TYPE.VIZ_BOX_TITLE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.VIZ_BOX_CONTAINER][secondIx]=CATEGORIES_TITLE_AND_CONTAINERS;idMap[$ENUM_IDENTITY_TYPE.LEGEND][secondIx]=idMap[$ENUM_IDENTITY_TYPE.LEGEND_TEXT][secondIx]=idMap[$ENUM_IDENTITY_TYPE.COLOR_SQUARE][secondIx]=CATEGORIES_LEGEND;idMap[$ENUM_IDENTITY_TYPE.X_AXIS][secondIx]=idMap[$ENUM_IDENTITY_TYPE.Y_AXIS][secondIx]=idMap[$ENUM_IDENTITY_TYPE.X2_AXIS][secondIx]=idMap[$ENUM_IDENTITY_TYPE.Y2_AXIS][secondIx]=idMap[$ENUM_IDENTITY_TYPE.X_NUMERIC][secondIx]=idMap[$ENUM_IDENTITY_TYPE.X_CATEGORY][secondIx]=idMap[$ENUM_IDENTITY_TYPE.Y_NUMERIC][secondIx]=idMap[$ENUM_IDENTITY_TYPE.Y_CATEGORY][secondIx]=idMap[$ENUM_IDENTITY_TYPE.GRID_LINE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.MINOR_GRID_LINE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.X_METRIC_AXIS_TITLE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.Y_METRIC_AXIS_TITLE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.AXIS_ORIGIN][secondIx]=CATEGORIES_AXIS;idMap[$ENUM_IDENTITY_TYPE.ROW_TITLE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.COL_TITLE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.ROW_HEADER][secondIx]=idMap[$ENUM_IDENTITY_TYPE.COL_HEADER][secondIx]=idMap[$ENUM_IDENTITY_TYPE.ROWS_BACKGROUND][secondIx]=idMap[$ENUM_IDENTITY_TYPE.COLS_BACKGROUND][secondIx]=idMap[$ENUM_IDENTITY_TYPE.H_MATRIX_LINE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.V_MATRIX_LINE][secondIx]=CATEGORIES_ROWS_COLUMNS;idMap[$ENUM_IDENTITY_TYPE.GRAPH_SHAPE][secondIx]=idMap[$ENUM_IDENTITY_TYPE.SHAPE_COLLECTION][secondIx]=idMap[$ENUM_IDENTITY_TYPE.DATA_LABEL][secondIx]=CATEGORIES_SHAPES;},switchPanelByValue:function(newValue){if(this.initializing){return ;}this.model.selectTargetByValue(newValue);},notifyPropChangeToListeners:function(smartName,value,opt){if(this.initializing){return ;}(this._fmtPropBindings[smartName]||[]).forEach(function(control){if(control.onFmtPropsChanged){control.onFmtPropsChanged(smartName,value,opt);}});},notifyNonShapeSelectionChangeToListeners:function(evt){if(this.initializing){return ;}var noHighlight=evt.identities.length===0,objType=NO_HIGHLIGHT,singleObjType=NO_HIGHLIGHT,allSingleObjTypes=[],me=this;if(!noHighlight){evt.identities.forEach(function(identity){var rootIdentity=getRootIdentity(identity);if(!(rootIdentity&&rootIdentity.objType!==undefined)){return ;}var rootType=(me._nonShapeSelectionToIdentityMapping[rootIdentity.objType]||rootIdentity.objType);objType=$GM_UTIL.longIntOr(objType,rootType);allSingleObjTypes.push(rootType);});singleObjType=getRootIdentity(evt.identities[0]).objType;singleObjType=(me._nonShapeSelectionToIdentityMapping[singleObjType]||singleObjType);if(!me._IdentityTypeMapping[singleObjType]){return ;}var idMap=me._IdentityTypeMapping,val=idMap[singleObjType][IDENTITY_MAP_TYPE_PANEL];this.switchPanelByValue(val);var tgtSelectors=[];allSingleObjTypes.forEach(function(sot){tgtSelectors=tgtSelectors.concat($ARR.difference(idMap[sot][IDENTITY_MAP_TYPE_SELECTOR]||[],tgtSelectors));});tgtSelectors.forEach(function(selector){if(selector.updateSelection){selector.updateSelection(objType,evt.identities);}});}this._hilightObjListens.forEach(function(listener){listener.onHighlightObjChange(objType);});},_notifyShapeSelectionChangeToListeners:function(evt){if(this.initializing){return ;}var host=this.host,tgtItems=getShapeFormattingTargetItems.call(this.model),combs=evt.arrayOfComb||evt.arrayOfColorByComb,multiColorByItems={opt:"Multiple Elements",key:"multiple",optLvl:$SEL_OPT_LVL.COLOR_BY,comb:[]};var selectionLevel=evt.selectionlevel,isColorByLevel=selectionLevel===$SEL_OPT_LVL.COLOR_BY,selShapeItem;if(combs&&combs.length>1&&isColorByLevel){selShapeItem=multiColorByItems;}else{if(combs&&(isColorByLevel||selectionLevel===$SEL_OPT_LVL.METRIC)){selShapeItem=$HASH.copy($ARR.filterOne(isColorByLevel?tgtItems.colorByItems:tgtItems.metricItems,function(item){return $GM_UTIL.isEqualComb(item.comb,combs[0]);}));}else{selShapeItem=$HASH.copy($ARR.filterOne(tgtItems.originCollection,function(item){return selectionLevel===item.optLvl;}));}}this.switchPanelByValue(CATEGORIES_SHAPES);if(this.shapeObjSel){this.shapeObjSel.updateSelection(selShapeItem);}},_notifyFormatModeChangeToListeners:function(isFormattingMode){if(this.initializing){return ;}if(this.shapeObjSel){this.shapeObjSel.onFormattingModeChange(isFormattingMode);}},_notifyOnContextMenuSelectionListeners:function(evt){this.switchPanelByValue(this._IdentityTypeMapping[evt.identityType][IDENTITY_MAP_TYPE_PANEL]);var tgtSelectors=this._IdentityTypeMapping[evt.identityType][IDENTITY_MAP_TYPE_SELECTOR]||[];tgtSelectors.forEach(function(selector){if(selector.updateSelection){selector.updateSelection(evt.identityType,[{key:evt.metricId,tlOpt:{key:evt.metricId}}]);}});this._hilightObjListens.forEach(function(listener){listener.onHighlightObjChange(evt.identityType);});},getTargetSelector:function(selectorName){if(!this.targetSelectors[selectorName]){debugLog("Selector with name "+selectorName+" does not found.");}return this.targetSelectors[selectorName];},getSelectedValue:function(selectorName,fieldName,suffixName){var sel=this.getTargetSelector(selectorName);fieldName=fieldName||"v";return sel&&sel.getSelectedItem(suffixName)&&sel.getSelectedItem(suffixName)[fieldName];},onTargetSelectionChanged:function(selectorName,value){var controls=selectorName&&this._fmtSelBindings[selectorName];(controls||[]).forEach(function(control){if(!control.onSelectorsValueChanged){return illegalStatus("[Manager] onSelectorsValueChanged not defined for control: "+control.controlName);}control.onSelectorsValueChanged(selectorName,value);},this);},sendNonShapeTargetSelectionIdentity:function(selectorName){var selector=this.targetSelectors[selectorName];if(!this.host.formattingMode||!selector||selector.selectedIndex===undefined||selector.selectedIndex===null){return ;}var identity=selector.items[selector.selectedIndex].identity,identities=[];if(!identity||identity===UNDEFINED_IDENTITY){return ;}$HASH.forEach($ENUM_IDENTITY_TYPE,function(idType){if((identity&idType)>0){identities.push(idType);}});var obj={name:"highLightObjectChange",identities:identities};this.host.raiseEvent(obj);return obj;},isShapeOptionEqual:function(option1,option2){if(!option1&&!option2){return true;}if(!option1||!option2){return false;}if(option1.optLvl!==option2.optLvl){return false;}if(option1.opt!==option2.opt){return false;}return(option1.comb===option2.comb)||(option1.comb&&option2.comb&&$GM_UTIL.isEqualComb(option1.comb,option2.comb));},sendShapeOption:function(ignoreFormattingMode){var selector=this.shapeObjSel,val=selector.value;if((!ignoreFormattingMode&&!this.host.formattingMode)||this.isShapeOptionEqual(val,selector.valueWas)){return ;}selector.set("valueWas",$HASH.copy(val));this.host.onFormatableTargetChanged(val);},registerFormatControl:function(control){var listenOn=control.listenFormatProps;(listenOn||[]).forEach(function(sn){this._addListener(this._fmtPropBindings,sn,control);},this);listenOn=control.listenSelector;(listenOn||[]).forEach(function(selName){this._addListener(this._fmtSelBindings,selName,control);},this);if(control.highlightObjects&&control.highlightObjects.length){this._hilightObjListens.push(control);}},registerSelector:function(selectorName,control,highlightObjects){var listenerType=IDENTITY_MAP_TYPE_SELECTOR,idMap=this._IdentityTypeMapping;this.targetSelectors[selectorName]=control;(highlightObjects||[]).forEach(function(identity){if(!idMap[identity]){var map=idMap[identity]={};map[IDENTITY_MAP_TYPE_PANEL]=[];map[IDENTITY_MAP_TYPE_SELECTOR]=[];}idMap[identity][listenerType].push(control);});control.set("selectedIndex",0);},registerGroupTitle:function(gt){if(gt.highlightObjects){this._hilightObjListens.push(gt);}}});mstrmojo.vi.models.editors.GMBroker=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.models.editors.GMBroker",vis:null,editorManager:null,_smartNameToPropertyKeyLookup:null,_dynamicPrefixToSmartNamesLookup:null,_subscriptions:null,_titleSubs:null,init:function init(props){this._super($HASH.copy(props,{_smartNameToPropertyKeyLookup:{},_dynamicPrefixToSmartNamesLookup:[],_subscriptions:[]}));},getLocalState:function getLocalState(stateName){var state=localState[this.vis.node.k],value=state&&state[stateName];if(value===undefined){switch(stateName){case ENUM_LOCAL_STATES.IN_FORMATTING_MODE:value=this.vis.formattingMode;break;case ENUM_LOCAL_STATES.SELECTED_CATEGORY:value=CATEGORIES_DATA_EXPLORATION;break;}}return value;},updateLocalState:function updateLocalState(stateName,value){var state=localState[this.vis.node.k]||{};state[stateName]=value;localState[this.vis.node.k]=state;},attachEditorRuntime:function attachEditorRuntime(edtMgr){if(!edtMgr){return illegalStatus("[Broker] Could not attach undefined editor manager! Broker not connected to panel runtime.");}var vis=this.vis;this.editorManager=edtMgr;this._subscriptions=[vis.attachEventListener("formattingObjectChanged",this.id,function(evt){if(evt.selectionlevel!==$SEL_OPT_LVL.COLOR_BY||(evt.arrayOfComb&&evt.arrayOfComb.length>0)){edtMgr._notifyShapeSelectionChangeToListeners(evt);}else{clearAllHighLights(edtMgr._hilightObjListens);}}),vis.attachEventListener("nonShapeFormatableChanged",this.id,function(evt){if(true||this.getLocalState(ENUM_LOCAL_STATES.IN_FORMATTING_MODE)){edtMgr.notifyNonShapeSelectionChangeToListeners(evt);}}),vis.attachEventListener("propertyChanged",this.id,function(evt){var snAndVals=this.translateFormatPropertyChangeFromGM(evt.n,evt.v,evt.opt);(snAndVals||[]).forEach(function(snAndVal){edtMgr.notifyPropChangeToListeners(snAndVal.sn,snAndVal.val,evt.opt);});}),vis.attachEventListener("formattingModeChanged",this.id,function(evt){this.updateLocalState(ENUM_LOCAL_STATES.IN_FORMATTING_MODE,evt.isFmtMode);edtMgr._notifyFormatModeChangeToListeners(evt.isFmtMode);clearAllHighLights(edtMgr._hilightObjListens);}),vis.attachEventListener("onContextMenuSelection",this.id,function(evt){if(evt.identityType){edtMgr._notifyOnContextMenuSelectionListeners(evt);}})];this._titleSubs=[vis.parent.titleBar&&vis.parent.titleBar.attachEventListener("titleBarRMC",this.id,function(evt){if(this.getLocalState(ENUM_LOCAL_STATES.IN_FORMATTING_MODE)){evt.identities=[{objType:$ENUM_IDENTITY_TYPE.VIZ_BOX_TITLE}];edtMgr.notifyNonShapeSelectionChangeToListeners(evt);}})];},detachEditorRuntime:function detachEditorRuntime(){(this._subscriptions).forEach(function(sub){this.vis.detachEventListener(sub);},this);(this._titleSubs).forEach(function(sub){if(this.vis.parent.titleBar){this.vis.parent.titleBar.detachEventListener(sub);}},this);var edtMgr=this.editorManager;this.editorManager=null;return edtMgr;},translateFormatPropertyChangeFromGM:function translateFormatPropertyChangeFromGM(actualPropName,actualPropValue,levelOption){function narrowDownSet(theSet,actualName,strTail){return $ARR.filter(theSet,function(it){return(it.indexOf(actualName+(strTail||""))===0);});}function findSmartNameInLookups(actualName,fld,levelOpt){var snCandidateSet=$HASH.keyarray(me._smartNameToPropertyKeyLookup),snTempSet=narrowDownSet(snCandidateSet,actualName),strTail="";if(fld){strTail+=NAME_FIELD_SEPARATOR+fld;snTempSet=narrowDownSet(snTempSet,actualName,strTail);}if(snTempSet.length===1){return snTempSet[0];}if(snTempSet.length>1){if(snTempSet.indexOf(actualName+(strTail||""))!==-1){return actualName+(strTail||"");}strTail+=levelOpt&&(levelOpt.opt||levelOpt.key);snTempSet=narrowDownSet(snTempSet,actualName,strTail);}if(snTempSet.length===1){return snTempSet[0];}return undefined;}var me=this,flds=[undefined],sn,value,values=[actualPropValue],rst=[];if(actualPropValue&&actualPropValue.modifiedPropertyKeys){flds=actualPropValue.modifiedPropertyKeys;if(!flds){return illegalStatus("[Broker] modifiedPropertyKeys is empty for actual prop name: "+actualPropName);}values=flds.map(function(fld){return actualPropValue.jsonObj[fld];});}flds.forEach(function(fld,idx){var candidateSNs=[],dynPrxArr=$HASH.keyarray(me._dynamicPrefixToSmartNamesLookup),selVal;sn=findSmartNameInLookups(actualPropName,fld,levelOption);if(sn){candidateSNs.push(sn);}(dynPrxArr||[]).forEach(function(prx){selVal=me.editorManager.getSelectedValue(prx.slice(0,-1),"prefix");if(actualPropName.indexOf(selVal)===0){sn=findSmartNameInLookups(actualPropName.replace(selVal,prx),fld,levelOption);if(sn){candidateSNs.push(sn);}}});value=values[idx];if(value!==undefined&&candidateSNs.length!==0&&me.isColorProperty(me.getFormatPropertyKey(candidateSNs[0]))){value=$GM_UTIL.decodeColor(value);}candidateSNs.forEach(function(sn){var propKey=me.getFormatPropertyKey(sn),seln=propKey&&propKey.levelSelector,selOpt;if(!propKey){return illegalStatus("[Broker] Got a smart name in event but failed to locate the matched property key: "+sn);}if(seln&&typeof seln==="string"){selOpt=me.editorManager.getSelectedValue(seln);if(!selOpt){return illegalStatus("[Broker] Failed to get selection option by selector name: "+seln);}if(selOpt.key!==levelOption.key){return undefined;}}rst.push({sn:sn,val:value});});});return rst;},getSmartNamesMapForFontGroup:function getSmartNamesMapForFontGroup(namePrefix,nameSuffix,fieldAlias,placeHolderPosition,levelSelector,formatTarget){var me=this;function getSmartName(valForPh){var sfx=nameSuffix,fld=fieldAlias;if(placeHolderPosition==="fld"){fld=(fld||"")+valForPh;}else{sfx=(sfx||"")+valForPh;}return me.generateSmartName(namePrefix,sfx,fld,levelSelector,formatTarget);}return{fontFamily:getSmartName(SUFFIX_FONT_FAMILY),fontStyle:getSmartName(SUFFIX_FONT_STYLE),fontSize:getSmartName(SUFFIX_FONT_SIZE),fontColor:getSmartName(SUFFIX_FONT_COLOR)};},getSmartNamesMapForLineGroup:function getSmartNamesMapForLineGroup(namePrefix,nameSuffix,fieldAlias,placeHolderPosition,levelSelector,formatTarget){var me=this;function getSmartName(valForPh){var sfx=nameSuffix,fld=fieldAlias;if(placeHolderPosition==="fld"){fld=(fld||"")+valForPh;}else{sfx=(sfx||"")+valForPh;}return me.generateSmartName(namePrefix,sfx,fld,levelSelector,formatTarget);}return{lineColor:getSmartName(SUFFIX_COLOR),lineStyle:getSmartName(SUFFIX_BORDER_STYLE)};},getSmartNamesMapForFillGroup:function getSmartNamesMapForFillGroup(namePrefix,nameSuffix,fieldAlias,placeHolderPosition,levelSelector,formatTarget){var me=this;function getSmartName(valForPh){var sfx=nameSuffix,fld=fieldAlias;if(placeHolderPosition==="fld"){fld=(fld||"")+valForPh;}else{sfx=(sfx||"")+valForPh;}return me.generateSmartName(namePrefix,sfx,fld,levelSelector,formatTarget);}return{fillColor:getSmartName(SUFFIX_FILL_COLOR),fillAlpha:getSmartName(SUFFIX_FILL_TRANSPARENT)};},getVisProfile:function getVisProfile(pName){var vis=this.vis,typeArr=vis.GMController.enableCombiChart?vis.GMController.metricShapeArr:[vis.getChartInfo().shape];switch(pName){case VIS_PROFILE_IS_BUBBLE:return vis.getChartInfo().isBubbleOrScatter;case VIS_PROFILE_IS_ABL:return vis.getChartInfo().isABL;case VIS_PROFILE_PURE_AREA:return vis.GMController.pureAreaChart;case VIS_PROFILE_SEASON_ENABLED:return vis.isSeasonalityEnabled();case VIS_PROFILE_HAS_NUM_AX:return vis.getNumericAxisOptions().length>0;case VIS_PROFILE_HAS_SIZE_BY:return vis.GMController.hasSizeBy();case VIS_PROFILE_HAS_COLOR_BY:return vis.GMController.hasColorBy();case VIS_PROFILE_HAS_BREAK_BY:return vis.GMController.getBreakByAttributes().length>0;case VIS_PROFILE_SHOW_TXT_DATA_LABEL:return vis.GMController.textTypeDataLabelEnabled();case VIS_PROFILE_PURE_LINE_AND_TICK:return typeArr.every(function(type){return type===$ENUM_SHAPE.LINE||type===$ENUM_SHAPE.TICK;});case VIS_PROFILE_SHOW_VAL_DATA_LABEL:return vis.GMController.valueTypeDataLabelEnabled();case VIS_PROFILE_IS_PERCENT_GRAPH:return vis.GMController.chartSubType===$ENUM_SHAPE_SUBTYPE.PERCENT;case VIS_PROFILE_HAS_SIZE_BY_METRIC:return vis.GMController.getSizeByMetrics()&&vis.GMController.getSizeByMetrics().length>0;case VIS_PROFILE_IS_LINE:return vis.getChartInfo().shape===$ENUM_SHAPE.LINE;case VIS_PROFILE_IS_TICK:return vis.getChartInfo().shape===$ENUM_SHAPE.TICK;case VIS_PROFILE_PURE_BAR_AREA_CIRCLE_SQUARE_RING_PIE:return typeArr.every(function(type){return[$ENUM_SHAPE.BAR,$ENUM_SHAPE.AREA,$ENUM_SHAPE.CIRCLE,$ENUM_SHAPE.SQUARE,$ENUM_SHAPE.RING,$ENUM_SHAPE.PIE].indexOf(type)!==-1;});case VIS_PROFILE_HAS_LINE_OR_AREA:return typeArr.indexOf($ENUM_SHAPE.LINE)>-1||typeArr.indexOf($ENUM_SHAPE.AREA)>-1;case VIS_PROFILE_AXIS_IN_COLOR_BY:return vis.GMController.isAxisAttributeInColorBy();case VIS_PROFILE_IS_EMPTY:return vis.GMController.isEmptyVis();}return illegalStatus("[Broker getVisProfile] Unrecognized profile name: "+pName);},getOptionItems:function getOptionItems(optionName,key){var vis=this.vis;switch(optionName){case NAME_REFERENCE_LINE_TYPE_FOR:return getRefLineItems(vis.getEnabledReferenceLineOptions(key));}return illegalStatus("[Broker getOptionItems] Unrecognized optionName: "+optionName);},getDataLabelItems:function getDataLabelItems(){var items=this.vis.getShowDataLabelOptions(),rst=[];(items||[]).forEach(function(it){rst.push({n:it.opt,opt:it,isAll:it.key&&it.key==="AllMetrics"});});return rst;},generateSmartName:function generateSmartName(prefix,suffix,fieldAlias,levelSelectorName,formatTarget){function fnHash(key){var levelSelector=key.levelSelector,optSfx=levelSelector&&(levelSelector.opt||levelSelector.key),rst=(key.namePrefix||"")+(key.nameSuffix||"");if(key.filedAlias){rst+=NAME_FIELD_SEPARATOR+key.filedAlias;}if(optSfx){rst+=OPT_SEPARATOR+optSfx;}return rst;}var key={namePrefix:prefix,nameSuffix:suffix,filedAlias:fieldAlias,levelSelector:levelSelectorName,target:formatTarget},sn=fnHash(key),existing=this._smartNameToPropertyKeyLookup[sn];if(existing&&!$HASH.equals(existing,key)){debugLog("[Broker] smart name conflict for : "+sn);}this._smartNameToPropertyKeyLookup[sn]=key;if(prefix&&prefix.slice(-1)===LEVEL_SEPARATOR){this._dynamicPrefixToSmartNamesLookup[prefix]=this._dynamicPrefixToSmartNamesLookup[prefix]||[];this._dynamicPrefixToSmartNamesLookup[prefix].push(sn);}return sn;},getFormatPropertyKey:function getFormatPropertyKey(smartName){var existing=this._smartNameToPropertyKeyLookup[smartName];if(!existing){debugLog("[Broker] Format property key not found for smart name: "+smartName);}return existing;},getDependingSelectorNames:function getDependingSelectorNames(smartName){var key=this.getFormatPropertyKey(smartName),rst=[];if(!key){return rst;}var prx=key.namePrefix,seln=key.levelSelector;if(this._dynamicPrefixToSmartNamesLookup[prx]){rst.push(prx.slice(0,-1));}if(seln&&typeof seln==="string"){rst.push(seln);}return rst;},_resolveFormatPropNameWithRuntime:function _resolveFormatPropNameWithRuntime(key){var prx=key.namePrefix,rst;if(this._dynamicPrefixToSmartNamesLookup[prx]){rst=this.editorManager.getSelectedValue(prx.slice(0,-1),"prefix",key.nameSuffix);}else{rst=prx;}return(rst||"")+key.nameSuffix;},_resolveLevelOptionWithRuntime:function _resolveLevelOptionWithRuntime(key){var seln=key.levelSelector,selOpt;if(!seln){return undefined;}if(typeof seln==="string"){selOpt=this.editorManager.getSelectedValue(seln);if(!selOpt){return illegalStatus("[Broker] Failed to get selection option by selector name: "+seln);}}else{selOpt=seln;}return selOpt;},isColorProperty:function(key){var indicator=key.filedAlias||key.nameSuffix;if(indicator&&indicator.slice(-3)===SUFFIX_COLOR){return true;}return false;},getFormatPropertyValue:function getFormatPropertyValue(smartName,selOpt){var key=this.getFormatPropertyKey(smartName);if(!key){return illegalStatus("[Broker] Failed to locate a property key by smart name: "+smartName);}if(!this.editorManager){return illegalStatus("[Broker] Editor runtime offline while trying to get property value for : "+smartName);}var host=this.vis,fmtPropName,valueCollection,rst;if(key.target===TARGET_SELECTABLE){valueCollection=host.getPropertiesOfFormatable();}else{selOpt=selOpt||this._resolveLevelOptionWithRuntime(key);fmtPropName=this._resolveFormatPropNameWithRuntime(key);valueCollection=host.readGlobalProperty(fmtPropName,selOpt);}if(key.filedAlias){if(!valueCollection||!valueCollection.jsonObj){return illegalStatus("[Broker] Result value collection is not in expected structure for smart name: "+smartName);}rst=valueCollection.jsonObj[key.filedAlias];}else{if(typeof valueCollection==="object"){return illegalStatus("[Broker] Expect a string value while got a structure for smart name: "+smartName);}rst=valueCollection;}if(rst===undefined){rst=host.getDefaultProperties()[fmtPropName];debugLog("[Broker] get format value failed for smart name: "+smartName+". Fall back to default value and got: "+rst);}if(rst!==undefined&&this.isColorProperty(key)){rst=$GM_UTIL.decodeColor(rst);}return rst;},setFormatPropertyValue:function setFormatPropertyValue(smartName,value,selOpt,holdApply){var key=this.getFormatPropertyKey(smartName);if(!key){return illegalStatus("[Broker] Failed to locate a property key by smart name: "+smartName);}if(!this.editorManager){return illegalStatus("[Broker] Editor runtime offline while trying to set property value for : "+smartName);}if(value!==undefined&&this.isColorProperty(key)&&value!==VAL_CLEAR){value=$GM_UTIL.encodeColor(value);}var host=this.vis,fmtPropName,fld=key.filedAlias,valueCollection,currentVal;if(key.target===TARGET_SELECTABLE){valueCollection=host.getPropertiesOfFormatable();}else{selOpt=selOpt||this._resolveLevelOptionWithRuntime(key);fmtPropName=this._resolveFormatPropNameWithRuntime(key);valueCollection=host.readGlobalProperty(fmtPropName,selOpt);if(fmtPropName==="refDef"){valueCollection.opt=selOpt;}}if(fld){if(!valueCollection||!valueCollection.jsonObj){return illegalStatus("[Broker] Result value collection is not in expected structure for smart name: "+smartName);}currentVal=valueCollection.jsonObj[fld];if(value!==currentVal){valueCollection.setProperty(fld,value);if(key.target===TARGET_SELECTABLE){debugLog("[Broker] writeFormatableProperties("+fld+", "+value+")");host.writeFormatableProperties(valueCollection);}else{debugLog("[Broker] writeGlobalProperty("+fmtPropName+":"+fld+", "+value+", "+selOpt+")");host.writeGlobalProperty(fmtPropName,valueCollection,selOpt,holdApply);}}}else{if(typeof valueCollection==="object"){return illegalStatus("[Broker] Expect a string value while got a structure for smart name: "+smartName);}currentVal=valueCollection;if(value!==currentVal){debugLog("[Broker] writeGlobalProperty("+fmtPropName+", "+value+", "+selOpt+")");host.writeGlobalProperty(fmtPropName,value,selOpt,holdApply);}}}});mstrmojo.ui.editors.controls.MenuPulldown=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ui.editors.controls.MenuPulldown",markupString:'<div id="{@id}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-text">{@value}</div><div class="container"></div></div>',markupSlots:{selectedNode:function selectedNode(){return this.domNode.firstChild;},containerNode:function containerNode(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:$WIDGET.visibleMarkupMethod,onheightChange:$WIDGET.heightMarkupMethod,onwidthChange:$WIDGET.widthMarkupMethod,onvalueChange:function onvalueChange(){this.selectedNode.innerHTML=this.getDisplayText(this.value);},onenabledChange:mstrmojo.Widget.enabledMarkupMethod},value:undefined,anchorSlot:"selectedNode",getDisplayText:function getDisplayText(value){return value||"";},onclick:function onclick(){var menuConfig=this.getMenuConfig();if(!menuConfig){return ;}if(!this.isClosedByAnchor){this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:menuConfig,themeClassName:mstrApp.getThemeClassName()}));}else{this.closePopup();this.isClosedByAnchor=false;}},onPopupAutoClosed:function onPopupAutoClosed(e,hWin){if(mstrmojo.dom.eventTarget(hWin,e)===this[this.anchorSlot]){this.isClosedByAnchor=true;}},getMenuConfig:$EF});function getTwoControlContainer(control1,control2,col1Width,col2Width){control1.slot="col1Node";control2.slot="col2Node";return new mstrmojo.ui.editors.controls.TwoColumnContainer({col1Width:col1Width||"40%",col2Width:col2Width||"60%",children:[control1,control2]});}function getAllTextControls(){var groupTitleAllText=getGroupTitle.call(this,mstrmojo.desc(14313,"All Graph Fonts"));return[groupTitleAllText,getCharacterConfigComp.call(this,null,this.broker.getSmartNamesMapForFontGroup(PREFIX_ALL_TEXT),{controlName:"AllTextFontGroup",groupTitle:groupTitleAllText,visibleControls:$CHARACTER_CTRL_FLAGS.FONT_FAMILY|$CHARACTER_CTRL_FLAGS.FONT_SIZE_AND_COLOR|$CHARACTER_CTRL_FLAGS.FONT_STYLE|$CHARACTER_CTRL_FLAGS.FONT_SIZE_USE_STEPPER})];}function getAxisScaleControls(){var broker=this.broker,edtMgr=broker.editorManager,selName=NAME_AXIS_SCALE_FOR,axisScaleItems=getAxisScaleOptionItems.call(this),isPercentGraph=broker.getVisProfile(VIS_PROFILE_IS_PERCENT_GRAPH),percentConvert=isPercentGraph?100:1;if(!axisScaleItems.length){return[];}function getSmartName(sfx,fld){return broker.generateSmartName(null,sfx,fld,selName);}function isSelectedAxis(){var item=selector.items[selector.selectedIndex];return item._renderIdx===0||!(item.v.sizeBy||item.v.key==="SizeBy");}var groupTitle=getGroupTitle.call(this,mstrmojo.desc(13872,"Axis Configuration"),{highlightObjects:[$ENUM_IDENTITY_TYPE.AXIS_SCALE,$ENUM_IDENTITY_TYPE.LOG_SCALE,$ENUM_IDENTITY_TYPE.AXIS_ORIGIN_DEFINE],scopeSelectors:[selName]}),selector=getTargetSelector.call(this,null,selName,axisScaleItems,edtMgr),snAxisScaleType=getSmartName(XML_TAG_AXIS_SCALE_DATA,$ENUM_XML_TAG.SINGLE_AXIS_SCALE_TYPE),ctrlAxisScaleType=getAxisScaleTypePulldownMenu.call(this,mstrmojo.desc(13873,"Axis scale:"),snAxisScaleType,{min:getSmartName(XML_TAG_AXIS_SCALE_DATA,$ENUM_XML_TAG.AXIS_SCALE_REAL_MIN),max:getSmartName(XML_TAG_AXIS_SCALE_DATA,$ENUM_XML_TAG.AXIS_SCALE_REAL_MAX),customMin:getSmartName(XML_TAG_AXIS_SCALE_DATA,$ENUM_XML_TAG.AXIS_SCALE_MANUAL_MIN),customMax:getSmartName(XML_TAG_AXIS_SCALE_DATA,$ENUM_XML_TAG.AXIS_SCALE_MANUAL_MAX)},{autoMin:getSmartName(XML_TAG_AXIS_SCALE_DATA,$ENUM_XML_TAG.AXIS_SCALE_AUTO_MIN),autoMax:getSmartName(XML_TAG_AXIS_SCALE_DATA,$ENUM_XML_TAG.AXIS_SCALE_AUTO_MAX)},{groupTitle:groupTitle}),ctrlLogScale=getPropertyPulldown.call(this,mstrmojo.desc(13874,"Log scale:"),[{n:mstrmojo.desc(10035,"Yes"),v:true},{n:mstrmojo.desc(2180,"No"),v:false}],getSmartName(XML_TAG_AXIS_SCALE_DATA,$ENUM_XML_TAG.LOG_SCALE),{groupTitle:groupTitle,reInit:function(){this.reInitDefault();this.parent.set("enabled",!isPercentGraph&&isSelectedAxis());}}),snAxisOriginAuto=getSmartName(XML_TAG_AXIS_ORIGIN,$ENUM_XML_TAG.AXIS_ORIGIN_AUTO),ctrlAxisOriginAuto=getPropertyCheckBox.call(this,null,snAxisOriginAuto),snAxisOriginValue=getSmartName(XML_TAG_AXIS_ORIGIN,$ENUM_XML_TAG.AXIS_ORIGIN_VALUE),ctrlAxisOriginValue=getPropertyValidationTextBox.call(this,null,snAxisOriginValue,{listenFormatProps:[snAxisOriginAuto],errRevert:false,useRichTooltip:true,constraints:isPercentGraph?{min:-100,max:100}:{min:null,max:null},updateTooltipConfig:function(){if(this.isValid()){this.richTooltip=null;return ;}var vs=this.validationStatus;this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+12,top:this.domNode.offsetHeight+5,refNode:this.domNode,content:this.getInvalidMsg(vs)};},onValid:function(){var val=accFloatMultDiv(this.value,percentConvert,false);if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],val);},onFmtPropsChanged:function(smartName,value){if(smartName===snAxisOriginAuto){this.set("enabled",!value);var phStr=value?mstrmojo.desc(12143,"Automatic"):"";this.syncControl(function(){this.set("emptyText",phStr);if(value){this.set("value",null);}if(value&&this.hasRendered){this.clearValidation();}});}else{if(this.enabled){if(smartName===snAxisOriginValue){value=accFloatMultDiv(value,percentConvert,true);}this.onFmtPropsChangedDefault(smartName,value);}}var isAxis=isSelectedAxis();this.parent.parent.set("enabled",isAxis);this.set("enabled",isAxis&&!ctrlAxisOriginAuto.checked);}}),ctrlAxisOrigin=this.getLabelAndControl(mstrmojo.desc(13875,"Axis origin:"),this.addDisposable(getTwoControlContainer(ctrlAxisOriginAuto,ctrlAxisOriginValue,"20px","100%")),"40%","60%"),rst=[groupTitle,ctrlAxisScaleType,ctrlLogScale,ctrlAxisOrigin];if(selector.items.length>1){$ARR.insert(rst,1,[selector]);}if(rst.length){rst=[this.getEditorGroup(rst)];}return rst;}function getMaxMinSizeControls(){var broker=this.broker,hasSizeBy=broker.getVisProfile(VIS_PROFILE_HAS_SIZE_BY),txtConstraints={trigger:mstrmojo.validation.TRIGGER.ONBLUR,min:0.01,max:1,regExp:mstrmojo.locales.number.DECIMALSEPARATOR==="."?/^\d+(\.\d{1,2})?$/:/^\d+(\,\d{1,2})?$/},pureAreaGraph=broker.getVisProfile(VIS_PROFILE_PURE_AREA),minSizeText=this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13917,"Min size (0.01 - 1.0):")})),informativeText=this.addDisposable(new mstrmojo.Label()),manualRangeInfoText=mstrmojo.desc(13740,"The smallest element's size is ## of the largest element's size");function getSmartName(sfx){return broker.generateSmartName(null,sfx);}var snMaxSizeType=getSmartName($ENUM_XML_TAG.MAX_SIZE_TYPE),snMinSizeType=getSmartName($ENUM_XML_TAG.MIN_SIZE_TYPE),maxSizeContainer=getTwoControlContainer(getPropertyPulldown.call(this,null,[{n:mstrmojo.desc(6019,"Automatic"),v:$GM.EnumMaxSizeType.AUTO},{n:mstrmojo.desc(8262,"Manual"),v:$GM.EnumMaxSizeType.MANUAL}],snMaxSizeType,{reInit:function(){this.parent.set("enabled",!pureAreaGraph);if(!pureAreaGraph){this.reInitDefault();}}}),getPropertyValidationTextBox.call(this,null,getSmartName($ENUM_XML_TAG.MAX_SIZE_VALUE),{constraints:txtConstraints,listenFormatProps:[snMaxSizeType],onFmtPropsChanged:function(smartName,value){if(smartName===snMaxSizeType){this.set("enabled",value===$GM.EnumMaxSizeType.MANUAL);}else{this.onFmtPropsChangedDefault(smartName,$NUM.toLocaleString(value));}}}),"75%","25%"),minSizeContainer=getTwoControlContainer(getPropertyPulldown.call(this,null,[{n:mstrmojo.desc(11990,"Proportional"),v:$GM.EnumMinSizeType.PROPORTIONAL},{n:mstrmojo.desc(13741,"Full Range"),v:$GM.EnumMinSizeType.AUTO},{n:mstrmojo.desc(14118,"Adjusted Range"),v:$GM.EnumMinSizeType.MANUAL}],snMinSizeType,{reInit:function(){var enabled=!pureAreaGraph&&hasSizeBy;this.parent.set("enabled",enabled);minSizeText.set("enabled",enabled);if(enabled){this.reInitDefault();}},onFmtPropsChanged:function(smartName,value){this.onFmtPropsChangedDefault(smartName,value);if(value===$GM.EnumMinSizeType.PROPORTIONAL){informativeText.set("text",mstrmojo.desc(13743,"The smallest element's size is proportional to its data element"));}else{if(value===$GM.EnumMinSizeType.AUTO){informativeText.set("text",mstrmojo.desc(13744,"The smallest element's size is fixed, independent of its data value"));}}}}),getPropertyValidationTextBox.call(this,null,getSmartName($ENUM_XML_TAG.MIN_SIZE_VALUE),{constraints:txtConstraints,listenFormatProps:[snMinSizeType],onFmtPropsChanged:function(smartName,value){if(!hasSizeBy){this.set("enabled",false);return ;}if(smartName===snMinSizeType){var enabled=value===$GM.EnumMinSizeType.MANUAL;this.set("enabled",enabled);if(enabled){informativeText.set("text",manualRangeInfoText.replace("##",this.value*100+"%"));}}else{this.onFmtPropsChangedDefault(smartName,$NUM.toLocaleString(value));if(this.enabled){informativeText.set("text",manualRangeInfoText.replace("##",value*100+"%"));}}}}),"75%","25%");this.addDisposable([maxSizeContainer,minSizeContainer]);return[this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13918,"Max size (0.01 - 1.0):")})),maxSizeContainer,minSizeText,minSizeContainer,informativeText];}function getAxisManipulationControls(){var broker=this.broker;function getSmartName(sfx){return broker.generateSmartName(null,sfx);}return[getPropertyPulldown.call(this,mstrmojo.desc(2776,"Fit to:"),[{n:mstrmojo.desc(5374,"Content"),v:$GM.EnumFitTo.CONTENT},{n:mstrmojo.desc(11917,"Container"),v:$GM.EnumFitTo.PANEL},{n:mstrmojo.desc(14445,"Container (Compact)"),v:$GM.EnumFitTo.COMPACT}],getSmartName($ENUM_XML_TAG.FIT_TO),undefined,["20%","80%"]),this.getLabelAndControl(mstrmojo.desc(13745,"Banding on rows"),getPropertyCheckBox.call(this,null,getSmartName($ENUM_XML_TAG.BANDING)),"20px","100%",true)];}function getDataExplorationControls(dynamicCtrlGroup){var controls=getAxisScaleControls.call(this);this.replaceChildControls(dynamicCtrlGroup,controls.concat([this.getEditorGroup(getMaxMinSizeControls.call(this),nestedGroupWithDividerProps),this.getEditorGroup(getAxisManipulationControls.call(this),nestedGroupWithDividerProps),this.getEditorGroup(getAllTextControls.call(this),nestedGroupWithDividerProps),this.getEditorGroup([this.getMoreOptionsEditorLink(this.getHost().model.data.gsi.prop)],nestedGroupWithDividerProps)]));}function getTrendLineControls(dynamicCtrlGroup){var broker=this.broker,editorManager=broker.editorManager,selName=NAME_TREND_LINE_FOR,tagSuffix=$ENUM_XML_TAG.TREND_LINE_DEF,trendLineOptionItems=getTrendLineOptionItems.call(this),isTrendLineAvailable=$GM_UTIL.isTrendLineAvailableForAnyMetric(broker.vis);function getSmartName(fieldAlias,levelSelectorName){return broker.generateSmartName(null,tagSuffix,fieldAlias,levelSelectorName);}function getPropsOfEnabledListener(listenOnSN){return{listenFormatProps:[listenOnSN],onFmtPropsChanged:function(smartName,value){if(smartName===listenOnSN){this.getCtrlContainer().set("enabled",value&&isTrendLineAvailable);}else{this.onFmtPropsChangedDefault(smartName,value);}}};}function isAnyTrendLineEnabled(){return(trendLineOptionItems||[]).some(function(item){return broker.getFormatPropertyValue(snTrendLineEnabled,item.v);});}var snTrendLineEnabled=getSmartName($ENUM_XML_TAG.TREND_ENABLED,selName),selector=getTargetSelector.call(this,null,selName,trendLineOptionItems,editorManager,{highlightObjects:[$ENUM_IDENTITY_TYPE.TREND_LINE],enabled:isTrendLineAvailable,updateSelection:function updateSelection(identityType,identities){var selKey=identities[0].tlOpt.key,selIdx=-1;$ARR.forEach(this.items,function(item,idx){if(item.v.key===selKey){selIdx=idx;return false;}});syncControl(this,function(){this.set("selectedIndex",selIdx);});}}),ctrlTrendLineEnabled=getPropertyCheckBox.call(this,mstrmojo.desc(13746,"Enable Trend Line"),snTrendLineEnabled),ctrlTrendLineLineGroup=getLineConfigComp.call(this,null,broker.getSmartNamesMapForLineGroup(null,tagSuffix,"trdRefLn","fld",selName),$HASH.copy({lineTitle:mstrmojo.desc(13927,"Line:"),controlName:"TrendLineLineGoup",showNoneOption:false,showNoFillInColor:false,showGradient:!broker.getVisProfile(VIS_PROFILE_AXIS_IN_COLOR_BY)},getPropsOfEnabledListener(snTrendLineEnabled))),snTrendLineModeType=getSmartName($ENUM_XML_TAG.TREND_TYPE,selName),ctrlTrendLineModeType=getPropertyPulldown.call(this,mstrmojo.desc(13876,"Model:"),[{n:mstrmojo.desc(13877,"Best fit"),v:$GM.EnumTrendLineModelType.BEST_FIT},{n:mstrmojo.desc(4888,"Linear"),v:$GM.EnumTrendLineModelType.LINEAR},{n:mstrmojo.desc(12021,"Logarithmic"),v:$GM.EnumTrendLineModelType.LOG},{n:mstrmojo.desc(12022,"Exponential"),v:$GM.EnumTrendLineModelType.EXP},{n:mstrmojo.desc(12023,"Power"),v:$GM.EnumTrendLineModelType.POW},{n:mstrmojo.desc(12024,"Polynomial"),v:$GM.EnumTrendLineModelType.POLY}],snTrendLineModeType,$HASH.copy(getPropsOfEnabledListener(snTrendLineEnabled))),ctrlTrendLinePolyDegree=getPropertyPulldown.call(this,mstrmojo.desc(13919,"Degree:"),[{n:"2",v:2},{n:"3",v:3},{n:"4",v:4},{n:"5",v:5},{n:"6",v:6}],getSmartName($ENUM_XML_TAG.TREND_POLY_DEGREE,selName),{listenFormatProps:[snTrendLineEnabled,snTrendLineModeType],onFmtPropsChanged:function(smartName,value){if(smartName===snTrendLineEnabled){this.set("enabled",value&&isTrendLineAvailable);}else{if(smartName===snTrendLineModeType){this.parent.set("visible",value===$GM.EnumTrendLineModelType.POLY);}else{this.onFmtPropsChangedDefault(smartName,value);}}}},{curVal:2,min:2,max:6}),ctrlTrendLineLevel=getPropertyPulldown.call(this,mstrmojo.desc(1452,"Level:"),TREND_REF_LINE_LEVEL_ITEMS,getSmartName($ENUM_XML_TAG.TREND_LEVEL,selName),{listenFormatProps:[snTrendLineEnabled],onFmtPropsChanged:function onFmtPropsChanged(smartname,value){if(smartname===snTrendLineEnabled){var gmCtrl=broker.vis.GMController,hasAttrOnRowOrCol=gmCtrl.hasAttributesInDropzone("Rows")||gmCtrl.hasAttributesInDropzone("Columns");this.parent.set("enabled",isTrendLineAvailable&&hasAttrOnRowOrCol&&value);}else{this.onFmtPropsChangedDefault(smartname,value);}}}),ctrlArray=[ctrlTrendLineEnabled,ctrlTrendLineLineGroup,ctrlTrendLineModeType,ctrlTrendLinePolyDegree,ctrlTrendLineLevel],controls;ctrlTrendLineEnabled.set("enabled",isTrendLineAvailable);if(selector.items.length>1){$ARR.insert(ctrlArray,0,[selector]);}mstrmojo.css.addWidgetCssClass(ctrlTrendLineEnabled,"title");if(broker.getVisProfile(VIS_PROFILE_IS_ABL)){var ctrlTrendLineIncludeBreakBy=getPropertyCheckBox.call(this,mstrmojo.desc(13878,"Include Break-by Attribute"),getSmartName($ENUM_XML_TAG.TREND_INCLUDE_BREAK_BY,selName),{listenFormatProps:[snTrendLineEnabled],onFmtPropsChanged:function(smartName,value){if(!broker.getVisProfile(VIS_PROFILE_HAS_BREAK_BY)){this.parent.set("enabled",false);}else{if(smartName===snTrendLineEnabled){this.parent.set("enabled",value&&isTrendLineAvailable);}else{this.onFmtPropsChangedDefault(smartName,value);}}}});$ARR.insert(ctrlArray,ctrlArray.length,[ctrlTrendLineIncludeBreakBy]);var snTrendForecastEnabled=getSmartName($ENUM_XML_TAG.TREND_FORECAST_ENABLED),ctrlTrendForecastEnabled=getPropertyCheckBox.call(this,mstrmojo.desc(12026,"Enable Forecasting"),snTrendForecastEnabled,{listenFormatProps:[snTrendLineEnabled],onFmtPropsChanged:function(smartName,value){if(smartName===snTrendLineEnabled){this.parent.set("enabled",isTrendLineAvailable&&isAnyTrendLineEnabled());}else{this.onFmtPropsChangedDefault(smartName,value);}}});var fnGetForecastSharedOverrides=function(){return{listenFormatProps:[snTrendLineEnabled,snTrendForecastEnabled],onFmtPropsChanged:function(smartName,value){if(smartName===snTrendLineEnabled||smartName===snTrendForecastEnabled){this.parent.set("enabled",isTrendLineAvailable&&broker.getFormatPropertyValue(snTrendForecastEnabled)&&isAnyTrendLineEnabled());}else{this.onFmtPropsChangedDefault(smartName,value);}}};};var ctrlTrendForecastFwd=getPropertyStepper.call(this,mstrmojo.desc(13879,"Forward:"),getSmartName($ENUM_XML_TAG.TREND_FWD_FORECAST),fnGetForecastSharedOverrides()),ctrlTrendForecastBwd=getPropertyStepper.call(this,mstrmojo.desc(13880,"Backward:"),getSmartName($ENUM_XML_TAG.TREND_BWD_FORECAST),fnGetForecastSharedOverrides()),ctrlTrendSeasons=getPropertyPulldown.call(this,mstrmojo.desc(13881,"Seasons:"),[{n:mstrmojo.desc(5949,"None"),v:$GM.EnumTimeRole.None},{n:mstrmojo.desc(10048,"Week"),v:$GM.EnumTimeRole.DayOfWeek},{n:mstrmojo.desc(871,"Month"),v:$GM.EnumTimeRole.DayOfMonth},{n:mstrmojo.desc(10050,"Quarter"),v:$GM.EnumTimeRole.MonthOfQuarter},{n:mstrmojo.desc(873,"Year"),v:$GM.EnumTimeRole.MonthOfYear},{n:mstrmojo.desc(13748,"Decade"),v:$GM.EnumTimeRole.YearOfDecade}],getSmartName($ENUM_XML_TAG.TREND_SEASONALITY),{listenFormatProps:[snTrendLineEnabled,snTrendLineModeType],onFmtPropsChanged:function(smartName,value){if(smartName===snTrendLineModeType||smartName===snTrendLineEnabled){this.parent.set("enabled",isTrendLineAvailable&&broker.getVisProfile(VIS_PROFILE_SEASON_ENABLED)&&isAnyTrendLineEnabled());}else{this.onFmtPropsChangedDefault(smartName,value);}}});$HASH.copy({useRichTooltip:true,updateTooltipConfig:function updateTooltipConfig(){this.richTooltip=this.enabled?null:{content:mstrmojo.desc(14314,"This option is available only when a time based attribute is placed on the axis"),refNode:this.domNode,cssClass:"vi-regular",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:18,left:70};}},ctrlTrendSeasons);mstrmojo.css.addWidgetCssClass(ctrlTrendForecastEnabled,"title");controls=[this.getEditorGroup(ctrlArray,nestedGroupProps),this.getEditorGroup([ctrlTrendForecastEnabled,ctrlTrendForecastFwd,ctrlTrendForecastBwd],nestedGroupProps),this.getEditorGroup([ctrlTrendSeasons],nestedGroupProps)];}else{var groupTitleForecastScatter=getGroupTitle.call(this,mstrmojo.desc(13932,"Forecasting")),selectorForecastScatter=getForecastScatterMenuPulldown.call(this,snTrendLineEnabled,{groupTitle:groupTitleForecastScatter,onFmtPropsChanged:function(){var enabled=isTrendLineAvailable&&isAnyTrendLineEnabled();this.set("enabled",enabled);groupTitleForecastScatter.set("enabled",enabled);}});controls=[this.getEditorGroup(ctrlArray,nestedGroupProps)].concat(this.getEditorGroup([groupTitleForecastScatter,selectorForecastScatter],nestedGroupProps));}this.replaceChildControls(dynamicCtrlGroup,controls);}function getReferenceLineControls(dynamicCtrlGroup){var broker=this.broker,editorManager=broker.editorManager,tagSuffix=$ENUM_XML_TAG.REF_LINE_DEF,mtcSelName=NAME_REFERENCE_LINE_METRIC_FOR,tySelName=NAME_REFERENCE_LINE_TYPE_FOR,snRefLineType=broker.generateSmartName(null,tagSuffix,$ENUM_XML_TAG.REF_ENABLED),snRefLineName=broker.generateSmartName(null,tagSuffix,$ENUM_XML_TAG.REF_LINE_NAME),isRefLineAvailable=!broker.getVisProfile(VIS_PROFILE_IS_PERCENT_GRAPH),reInitOverrides={reInit:function(){var selVal=this.manager.getSelectedValue(tySelName,"v");this.getCtrlContainer().set("enabled",!!selVal&&isRefLineAvailable);if(this.controlName==="ReferenceLineLabelCharacterGroup"){var fontsize=parseInt(this.fontSize.selectedValue,10).toString();this.fontSize.set("selectedValue",fontsize);}if(selVal){this.reInitDefault();}else{syncControl(this,function(){this.resetValue();});}}};function getSmartName(fld){return broker.generateSmartName(null,tagSuffix,fld,tySelName);}var metricItems=getReferenceLineAxisItems.call(this),metricSelector=getTargetSelector.call(this,null,mtcSelName,metricItems,editorManager,{enabled:isRefLineAvailable}),ctrlRefLineType=getPropertyRefLineList.call(this,null,metricItems[0].v,tySelName,[snRefLineType,snRefLineName],{restrictedTypes:broker.getVisProfile(VIS_PROFILE_IS_BUBBLE)?[$GM.EnumRefLineModelType.FIRST,$GM.EnumRefLineModelType.LAST]:[],listenSelector:[mtcSelName],highlightObjects:[$ENUM_IDENTITY_TYPE.REF_LINE],enabled:isRefLineAvailable,updateSelection:function updateSelection(identityType,identities){var firstIdentity=identities[0],metricKey=firstIdentity.key,lineTypeKey=identities[0].tlOpt.key;syncControl(metricSelector,function(){var metricSelIdx=-1;$ARR.forEach(metricSelector.items,function(item,idx){if(item.v.key===metricKey){metricSelIdx=idx;return false;}});metricSelector.set("selectedIndex",metricSelIdx);});syncControl(this,function(){this.selectItemByField("key",lineTypeKey);});}}),ctrlRefLineLineGroup=getLineConfigComp.call(this,null,broker.getSmartNamesMapForLineGroup(null,tagSuffix,"trdRefLn","fld",tySelName),$HASH.copy(reInitOverrides,{lineTitle:mstrmojo.desc(13927,"Line:"),controlName:"ReferenceLineLineGroup",showNoneOption:false,showNoFillInColor:false,showGradient:!broker.getVisProfile(VIS_PROFILE_AXIS_IN_COLOR_BY),resetValue:function resetValue(){this.lineColorAndStyle.lineColor.set("color","#000000");this.lineColorAndStyle.lineStyle.set("selectedValue","none");}})),ctrlRefLineLevel=getPropertyPulldown.call(this,mstrmojo.desc(1452,"Level:"),TREND_REF_LINE_LEVEL_ITEMS,getSmartName($ENUM_XML_TAG.REF_LEVEL),{reInit:function(){var selVal=this.manager.getSelectedValue(tySelName,"v"),gmCtrl=broker.vis.GMController,enabled=isRefLineAvailable&&(gmCtrl.hasAttributesInDropzone("Rows")||gmCtrl.hasAttributesInDropzone("Columns"))&&(selVal&&selVal.refType!==$GM.EnumRefLineModelType.CONST);if(this.parent){this.parent.set("enabled",enabled);}if(enabled){this.reInitDefault();}if(!selVal){syncControl(this,function(){this.resetValue();});}},resetValue:function resetValue(){this.set("selectedIndex",0);}}),snRefLineShowLabel=getSmartName($ENUM_XML_TAG.REF_SHOW_LABEL),ctrlRefLineShowLabel=getPropertyCheckBox.call(this,mstrmojo.desc(13749,"Show label"),snRefLineShowLabel,$HASH.copy(reInitOverrides,{resetValue:function resetValue(){this.set("checked",false);}})),ctrlRefLineLabelType=getPropertyButtonBar.call(this,null,[{n:mstrmojo.desc(8733,"Type"),v:$GM.EnumTrendRefModelLabels.DssModelLabelsType},{n:mstrmojo.desc(4779,"Metric"),v:$GM.EnumTrendRefModelLabels.DssModelLabelsMetric},{n:mstrmojo.desc(527,"Value"),v:$GM.EnumTrendRefModelLabels.DssModelLabelsValue}],getSmartName($ENUM_XML_TAG.REF_LABEL_TYPE),$HASH.copy(reInitOverrides,{listenFormatProps:[snRefLineShowLabel],onFmtPropsChanged:function(smartName,value){if(smartName===snRefLineShowLabel){var selVal=this.manager.getSelectedValue(tySelName,"v");this.set("enabled",!!selVal&&value&&isRefLineAvailable);}else{this.onFmtPropsChangedDefault(smartName,value);}},multiSelect:true,resetValue:function resetValue(){this.clearSelect();}})),ctrlRefLineFontGroup=getCharacterConfigComp.call(this,null,broker.getSmartNamesMapForFontGroup(null,tagSuffix,"rfLn","fld",tySelName),$HASH.copy(reInitOverrides,{controlName:"ReferenceLineLabelCharacterGroup",syncWithAllText:true,listenFormatProps:[snRefLineShowLabel],onFmtPropsChanged:function(smartName,value){if(smartName===snRefLineShowLabel){var selVal=this.manager.getSelectedValue(tySelName,"v"),isEnabled=!!selVal&&value&&isRefLineAvailable;this.set("enabled",isEnabled);if(isEnabled){this.refreshValues();}}else{if(this.enabled){this.onFmtPropsChangedDefault(smartName,value);}}},resetValue:function resetValue(){this.fontColor.set("selectedValue","#000000");this.fontStyle.clearSelect();this.fontSize.set("selectedValue","10");this.fontFamily.set("selectedIndex",0);}}));mstrmojo.css.addWidgetCssClass(ctrlRefLineShowLabel,"title");this.replaceChildControls(dynamicCtrlGroup,[this.getEditorGroup([metricSelector,ctrlRefLineType,ctrlRefLineLineGroup,ctrlRefLineLevel],nestedGroupProps),this.getEditorGroup([ctrlRefLineShowLabel,ctrlRefLineLabelType,ctrlRefLineFontGroup],nestedGroupProps)]);}function getLegendControls(dynamicCtrlGroup){var broker=this.broker;function getSmartName(sfx){return broker.generateSmartName(null,sfx);}var legendVisibleSmartName=getSmartName($ENUM_XML_TAG.LEGEND_VISIBLE),legendCtrlOnPropValueChangeFn=function(smartName,value){if(smartName===legendVisibleSmartName){var parent=this.parent,enabledCtrl=this;if(parent&&parent.scriptClass==="mstrmojo.ui.editors.controls.TwoColumnContainer"){enabledCtrl=parent;}enabledCtrl.set("enabled",!!value);}else{this.onFmtPropsChangedDefault(smartName,value);}},ctrlLegendShowLegend=getPropertyCheckBox.call(this,mstrmojo.desc(13600,"Show legend"),legendVisibleSmartName),ctrlLegendLabelsFontGroup=getCharacterConfigComp.call(this,null,broker.getSmartNamesMapForFontGroup(PREFIX_LEGEND),{controlName:"LegendTextFongGroup",syncWithAllText:true,listenFormatProps:[legendVisibleSmartName],onFmtPropsChanged:legendCtrlOnPropValueChangeFn}),txtFillGroup=this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13601,"Fill:")})),ctrlLegendFillGroup=getFillConfigComp.call(this,null,broker.getSmartNamesMapForFillGroup(PREFIX_LEGEND_BACKGROUND),{controlName:"LegendBackgroundFillGroup",listenFormatProps:[legendVisibleSmartName],onFmtPropsChanged:legendCtrlOnPropValueChangeFn});mstrmojo.css.addWidgetCssClass(ctrlLegendShowLegend,"title");this.replaceChildControls(dynamicCtrlGroup,[this.getEditorGroup([ctrlLegendShowLegend,ctrlLegendLabelsFontGroup,txtFillGroup,ctrlLegendFillGroup],nestedGroupProps)]);}function getAxisLabelsControls(){var broker=this.broker,selName=NAME_AXIS_LABELS_FOR,prx=selName+LEVEL_SEPARATOR;function getSmartName(sfx){return broker.generateSmartName(prx,sfx);}function doesAxisExist(axis){return(axis.TemplateMetric!==undefined)||(axis.TemplateUnit!==undefined)||(axis.MetricNames!==undefined);}var dz=broker.vis.model.data.dz,haveX=doesAxisExist(dz.XAxis),haveY=doesAxisExist(dz.YAxis),haveXandY=haveX&&haveY,items=[],highlights=[];if(haveXandY){highlights.push(($ENUM_IDENTITY_TYPE.X_CATEGORY|$ENUM_IDENTITY_TYPE.Y_CATEGORY));items.push({n:mstrmojo.desc(13920,"X and Y axes"),identity:($ENUM_IDENTITY_TYPE.X_CATEGORY|$ENUM_IDENTITY_TYPE.Y_CATEGORY),prefix:PREFIX_ALL_AXIS_LABEL,v:0});}if(haveX){highlights.push($ENUM_IDENTITY_TYPE.X_CATEGORY);items.push({n:mstrmojo.desc(13921,"X axis"),identity:$ENUM_IDENTITY_TYPE.X_CATEGORY,prefix:PREFIX_X_AXIS_LABEL,v:1});}if(haveY){highlights.push($ENUM_IDENTITY_TYPE.Y_CATEGORY);items.push({n:mstrmojo.desc(13922,"Y axis"),identity:$ENUM_IDENTITY_TYPE.Y_CATEGORY,prefix:PREFIX_Y_AXIS_LABEL,v:2});}var snAxisLabelsShowHide=getSmartName(SUFFIX_SHOW),groupTitle=getGroupTitle.call(this,mstrmojo.desc(12003,"Axis Labels"),{highlightObjects:highlights,scopeSelectors:[selName]}),selector=getTargetSelector.call(this,null,selName,items,broker.editorManager,{highlightObjects:highlights,groupTitle:groupTitle}),ctrlAxisLabelsShowHide=getPropertyCheckBox.call(this,mstrmojo.desc(13923,"Show labels"),snAxisLabelsShowHide,{groupTitle:groupTitle}),rotationSmartName=getSmartName(SUFFIX_ROTATION);return[groupTitle,selector,ctrlAxisLabelsShowHide,getCharacterConfigComp.call(this,null,broker.getSmartNamesMapForFontGroup(prx),{controlName:"AxisLabelsFontGroup",syncWithAllText:true,groupTitle:groupTitle,listenFormatProps:[snAxisLabelsShowHide],showNoFillInColor:false,onFmtPropsChanged:function(smartName,value){if(smartName===snAxisLabelsShowHide){this.set("enabled",value);}else{this.onFmtPropsChangedDefault(smartName,value);}}}),getPropertyPulldown.call(this,mstrmojo.desc(13924,"Rotation:"),[{n:mstrmojo.desc(12284,"Automatic"),v:$GM.EnumLabelRotation.AUTOMATIC},{n:mstrmojo.desc(12285,"Vertical"),v:$GM.EnumLabelRotation.VERTICAL},{n:mstrmojo.desc(12286,"Horizontal"),v:$GM.EnumLabelRotation.HORIZONTAL}],rotationSmartName,{groupTitle:groupTitle,listenFormatProps:[snAxisLabelsShowHide],onFmtPropsChanged:function(smartName,value){var isXAxis=selector.selectedIndex===1,isShow=ctrlAxisLabelsShowHide.getCtrl().checked;if(smartName===snAxisLabelsShowHide||smartName===rotationSmartName){this.parent.set("enabled",isShow&&isXAxis);}if(smartName===rotationSmartName&&value){this.onFmtPropsChangedDefault(smartName,value);}}})];}function getAxisLinesControls(){var broker=this.broker,editorManager=broker.editorManager,selName=NAME_AXIS_LINES_FOR,prx=selName+LEVEL_SEPARATOR,groupTitle=getGroupTitle.call(this,mstrmojo.desc(12008,"Axis Lines"),{highlightObjects:[($ENUM_IDENTITY_TYPE.X_AXIS|$ENUM_IDENTITY_TYPE.Y_AXIS|$ENUM_IDENTITY_TYPE.AXIS_ORIGIN),($ENUM_IDENTITY_TYPE.X_AXIS|$ENUM_IDENTITY_TYPE.Y_AXIS),$ENUM_IDENTITY_TYPE.X_AXIS,$ENUM_IDENTITY_TYPE.Y_AXIS,$ENUM_IDENTITY_TYPE.AXIS_ORIGIN],scopeSelectors:[selName]}),axisLineSelectionItems=[{n:mstrmojo.desc(13925,"All lines"),identity:($ENUM_IDENTITY_TYPE.X_AXIS|$ENUM_IDENTITY_TYPE.Y_AXIS|$ENUM_IDENTITY_TYPE.AXIS_ORIGIN),prefix:"allLn",v:0},{n:mstrmojo.desc(13920,"X and Y axes"),identity:($ENUM_IDENTITY_TYPE.X_AXIS|$ENUM_IDENTITY_TYPE.Y_AXIS),prefix:"allAxLn",v:1},{n:mstrmojo.desc(13921,"X axis"),identity:$ENUM_IDENTITY_TYPE.X_AXIS,prefix:"xAxLn",v:2},{n:mstrmojo.desc(13922,"Y axis"),identity:$ENUM_IDENTITY_TYPE.Y_AXIS,prefix:"yAxLn",v:3}],axisOriginItem={n:mstrmojo.desc(13926,"Axis origin"),identity:$ENUM_IDENTITY_TYPE.AXIS_ORIGIN,prefix:"axOriLn",v:4},axisScaleItems=getAxisScaleOptionItems.call(this);if(axisScaleItems&&axisScaleItems.length>0){var snAxisOriginAuto=broker.generateSmartName(null,XML_TAG_AXIS_ORIGIN,$ENUM_XML_TAG.AXIS_ORIGIN_AUTO,NAME_AXIS_SCALE_FOR),isAxisOriginAuto=broker.getFormatPropertyValue(snAxisOriginAuto,axisScaleItems[0].v);if(!isAxisOriginAuto){axisLineSelectionItems.push(axisOriginItem);}}var selector=getTargetSelector.call(this,null,NAME_AXIS_LINES_FOR,axisLineSelectionItems,editorManager,{highlightObjects:[($ENUM_IDENTITY_TYPE.X_AXIS|$ENUM_IDENTITY_TYPE.Y_AXIS|$ENUM_IDENTITY_TYPE.AXIS_ORIGIN),($ENUM_IDENTITY_TYPE.X_AXIS|$ENUM_IDENTITY_TYPE.Y_AXIS),$ENUM_IDENTITY_TYPE.X_AXIS,$ENUM_IDENTITY_TYPE.Y_AXIS,$ENUM_IDENTITY_TYPE.AXIS_ORIGIN],groupTitle:groupTitle}),ctrlAxisLinesLineGroup=getLineConfigComp.call(this,null,broker.getSmartNamesMapForLineGroup(prx),{lineTitle:mstrmojo.desc(13927,"Line:"),controlName:"AxisLineGroup",groupTitle:groupTitle,showNoFillInColor:false,showNoneOption:false,showGradient:false,onSelectorsValueChanged:function(selName,value){if(selName===NAME_AXIS_LINES_FOR){this.set("showNoneOption",value!==4&&value!==0);}this.onSelectorsValueChangedDefault(selName,value);}});return[groupTitle,selector,ctrlAxisLinesLineGroup];}function getAxisTitlesControls(){var broker=this.broker,edtMgr=broker.editorManager,selName=NAME_AXIS_TITLES_FOR,prx=selName+LEVEL_SEPARATOR,groupTitle=getGroupTitle.call(this,mstrmojo.desc(12010,"Axis Titles"),{highlightObjects:[$GM_UTIL.longIntOr($ENUM_IDENTITY_TYPE.X_METRIC_AXIS_TITLE,$ENUM_IDENTITY_TYPE.Y_METRIC_AXIS_TITLE),$ENUM_IDENTITY_TYPE.X_METRIC_AXIS_TITLE,$ENUM_IDENTITY_TYPE.Y_METRIC_AXIS_TITLE],scopeSelectors:[selName]});var axisTitleSelectionItems=[],candidateItems={XAxisTitle:{n:mstrmojo.desc(13921,"X axis"),identity:$ENUM_IDENTITY_TYPE.X_METRIC_AXIS_TITLE,prefix:"xAxTt",v:1},YAxisTitle:{n:mstrmojo.desc(13922,"Y axis"),identity:$ENUM_IDENTITY_TYPE.Y_METRIC_AXIS_TITLE,prefix:"yAxTt",v:2},XAndYAxesTitle:{n:mstrmojo.desc(13920,"X and Y axes"),identity:$GM_UTIL.longIntOr($ENUM_IDENTITY_TYPE.X_METRIC_AXIS_TITLE,$ENUM_IDENTITY_TYPE.Y_METRIC_AXIS_TITLE),prefix:"allAxTt",v:0}},gmController=broker.vis.GMController,isYHaveTitle=gmController.haveMetricAxisTitle("y"),isXHaveTitle=gmController.haveMetricAxisTitle("x");isYHaveTitle=isYHaveTitle||gmController.haveAttributeAxisTitle("y");isXHaveTitle=isXHaveTitle||gmController.haveAttributeAxisTitle("x");if(isYHaveTitle){axisTitleSelectionItems.unshift(candidateItems.YAxisTitle);}if(isXHaveTitle){axisTitleSelectionItems.unshift(candidateItems.XAxisTitle);}if(isYHaveTitle&&isXHaveTitle){axisTitleSelectionItems.unshift(candidateItems.XAndYAxesTitle);}var allDisabled=axisTitleSelectionItems.length===0,selector=getTargetSelector.call(this,null,selName,axisTitleSelectionItems,edtMgr,{highlightObjects:[$GM_UTIL.longIntOr($ENUM_IDENTITY_TYPE.X_METRIC_AXIS_TITLE,$ENUM_IDENTITY_TYPE.Y_METRIC_AXIS_TITLE),$ENUM_IDENTITY_TYPE.X_METRIC_AXIS_TITLE,$ENUM_IDENTITY_TYPE.Y_METRIC_AXIS_TITLE],groupTitle:groupTitle,enabled:!allDisabled}),snAxisTitlesShowHide=broker.generateSmartName(prx,SUFFIX_SHOW),ctrlAxisTitlesShowHide=getPropertyCheckBox.call(this,mstrmojo.desc(13928,"Show axis titles"),snAxisTitlesShowHide,{groupTitle:groupTitle}),ctrlAxisTitlesFontGroup=getCharacterConfigComp.call(this,null,broker.getSmartNamesMapForFontGroup(prx),allDisabled?null:{controlName:"AxisTitlesFontGroup",groupTitle:groupTitle,syncWithAllText:true,listenFormatProps:[snAxisTitlesShowHide],onFmtPropsChanged:function(smartName,value){if(smartName===snAxisTitlesShowHide){this.set("enabled",value);}else{this.onFmtPropsChangedDefault(smartName,value);}}});groupTitle.set("enabled",!allDisabled);ctrlAxisTitlesShowHide.set("enabled",!allDisabled);ctrlAxisTitlesFontGroup.set("enabled",!allDisabled);return[groupTitle,selector,ctrlAxisTitlesShowHide,ctrlAxisTitlesFontGroup];}function getGridLinesControls(){var broker=this.broker,editorManager=broker.editorManager,selName=NAME_GRID_LINES_FOR,snAllGridLineShw=broker.generateSmartName(null,$ENUM_FORMAT_TAG.ALL_GRID_LINES_SHOW);var groupTitle=getGroupTitle.call(this,mstrmojo.desc(11991,"Grid Lines"),{highlightObjects:[($ENUM_IDENTITY_TYPE.GRID_LINE|$ENUM_IDENTITY_TYPE.MINOR_GRID_LINE),$ENUM_IDENTITY_TYPE.GRID_LINE,$ENUM_IDENTITY_TYPE.MINOR_GRID_LINE],scopeSelectors:[selName]}),selector=getPropertyPulldown.call(this,null,[{n:mstrmojo.desc(6019,"Automatic"),v:$GM.EnumGridLines.AUTO},{n:mstrmojo.desc(13929,"Show major and minor"),v:$GM.EnumGridLines.SHOW},{n:mstrmojo.desc(13930,"Show major only"),v:$GM.EnumGridLines.SHOW_MAJOR_ONLY},{n:mstrmojo.desc(2772,"Hide"),v:$GM.EnumGridLines.HIDE}],snAllGridLineShw,{groupTitle:groupTitle,fnChange:function(value){editorManager.onTargetSelectionChanged(selName,value);editorManager.sendNonShapeTargetSelectionIdentity(selName);if(this._sync){return ;}broker.setFormatPropertyValue(snAllGridLineShw,value);}});editorManager.registerSelector(selName,selector);var snAxisLabelsShowHide=broker.generateSmartName(NAME_AXIS_LABELS_FOR+LEVEL_SEPARATOR,SUFFIX_SHOW),snXAxisLabel=broker.generateSmartName(PREFIX_X_AXIS_LABEL,SUFFIX_SHOW),snYAxisLabel=broker.generateSmartName(PREFIX_Y_AXIS_LABEL,SUFFIX_SHOW);var ctrlGridLinesLineGroup=getLineConfigComp.call(this,null,broker.getSmartNamesMapForLineGroup(null,"allGridLn"),{lineTitle:mstrmojo.desc(13927,"Line:"),controlName:"GridLineGroup",showNoneOption:false,groupTitle:groupTitle,showNoFillInColor:false,listenFormatProps:[snAxisLabelsShowHide,snAllGridLineShw],showGradient:false,onFmtPropsChanged:function(smartName,value){if(smartName===snAxisLabelsShowHide||smartName===snAllGridLineShw){var show=true,xShow=broker.getFormatPropertyValue(snXAxisLabel),yShow=broker.getFormatPropertyValue(snYAxisLabel);if(broker.getVisProfile(VIS_PROFILE_IS_BUBBLE)&&!xShow&&!yShow){show=false;}else{if(broker.getVisProfile(VIS_PROFILE_IS_ABL)){var chart=broker.vis.getChartInfo();if(chart.dirc===$GM.EnumABLDirection.HORIZONTAL&&!xShow){show=false;}else{if(chart.dirc===$GM.EnumABLDirection.VERTICAL&&!yShow){show=false;}}}}this.getCtrlContainer().parent.set("enabled",show);var gridLineOption=broker.getFormatPropertyValue(snAllGridLineShw),isDisable=(gridLineOption===$GM.EnumGridLines.AUTO&&!broker.vis.isMajorGridLineShow())||gridLineOption===$GM.EnumGridLines.HIDE;this.getCtrlContainer().set("enabled",show&&!isDisable);}else{this.onFmtPropsChangedDefault(smartName,value);}}});return[groupTitle,selector,ctrlGridLinesLineGroup];}function getAxisControls(dynamicCtrlGroup){this.replaceChildControls(dynamicCtrlGroup,[this.getEditorGroup(getAxisLabelsControls.call(this),nestedGroupWithDividerProps),this.getEditorGroup(getAxisLinesControls.call(this),nestedGroupWithDividerProps),this.getEditorGroup(getAxisTitlesControls.call(this),$HASH.copy(nestedGroupWithDividerProps,nestedGroupNoPropEnableProps)),this.getEditorGroup(getGridLinesControls.call(this),nestedGroupWithDividerProps)]);}function getRCTextControls(){var broker=this.broker,edtMgr=broker.editorManager,selName=NAME_ROWS_COLUMNS_FOR,prx=selName+LEVEL_SEPARATOR,snRowsAndColsShowHide=getSmartName(SUFFIX_SHOW);function getHighlightListenerOverrides(){return{highlightObjects:[($ENUM_IDENTITY_TYPE.ROW_HEADER|$ENUM_IDENTITY_TYPE.COL_HEADER|$ENUM_IDENTITY_TYPE.ROW_TITLE|$ENUM_IDENTITY_TYPE.COL_TITLE),($ENUM_IDENTITY_TYPE.ROW_HEADER|$ENUM_IDENTITY_TYPE.ROW_TITLE),($ENUM_IDENTITY_TYPE.COL_HEADER|$ENUM_IDENTITY_TYPE.COL_TITLE),$ENUM_IDENTITY_TYPE.ROW_TITLE,$ENUM_IDENTITY_TYPE.COL_TITLE,$ENUM_IDENTITY_TYPE.ROW_HEADER,$ENUM_IDENTITY_TYPE.COL_HEADER]};}function getSmartName(sfx){return broker.generateSmartName(prx,sfx);}function getFmtPropsOverrides(){return{listenFormatProps:[snRowsAndColsShowHide],onFmtPropsChanged:function(smartName,value){if(smartName===snRowsAndColsShowHide){this.getCtrlContainer().set("enabled",value);}else{this.onFmtPropsChangedDefault(smartName,value);}}};}var groupTitle=getGroupTitle.call(this,mstrmojo.desc(1013,"Text"),$HASH.copy(getHighlightListenerOverrides(),{scopeSelectors:[selName]})),selector=getTargetSelector.call(this,null,selName,[{n:mstrmojo.desc(3524,"All"),identity:($ENUM_IDENTITY_TYPE.ROW_HEADER|$ENUM_IDENTITY_TYPE.COL_HEADER|$ENUM_IDENTITY_TYPE.ROW_TITLE|$ENUM_IDENTITY_TYPE.COL_TITLE),prefix:"allRwCol",v:0},{n:mstrmojo.desc(13665,"Row Text"),identity:($ENUM_IDENTITY_TYPE.ROW_HEADER|$ENUM_IDENTITY_TYPE.ROW_TITLE),prefix:PREFIX_ROW_TEXT,v:1},{n:mstrmojo.desc(13666,"Column Text"),identity:($ENUM_IDENTITY_TYPE.COL_HEADER|$ENUM_IDENTITY_TYPE.COL_TITLE),prefix:PREFIX_COL_TEXT,v:2},{n:mstrmojo.desc(12014,"Row Headers"),identity:$ENUM_IDENTITY_TYPE.ROW_TITLE,prefix:PREFIX_ROW_HEADER,v:3},{n:mstrmojo.desc(12015,"Column Headers"),identity:$ENUM_IDENTITY_TYPE.COL_TITLE,prefix:PREFIX_COL_HEADER,v:4},{n:mstrmojo.desc(12016,"Row Values"),identity:$ENUM_IDENTITY_TYPE.ROW_HEADER,prefix:"rwVl",v:5},{n:mstrmojo.desc(12017,"Column Values"),identity:$ENUM_IDENTITY_TYPE.COL_HEADER,prefix:"colVl",v:6}],edtMgr,$HASH.copy(getHighlightListenerOverrides(),{groupTitle:groupTitle})),ctrlRowsAndColsShowHide=getPropertyCheckBox.call(this,mstrmojo.desc(14315,"Show text"),snRowsAndColsShowHide,{groupTitle:groupTitle}),ctrlRowsAndColsFontGroup=getCharacterConfigComp.call(this,null,broker.getSmartNamesMapForFontGroup(prx,"Txt"),$HASH.copy(getFmtPropsOverrides(),{controlName:"RowsAndColsFontGroup",groupTitle:groupTitle,syncWithAllText:true})),ctrlRowsAndColsHorAlign=getPropertyButtonBar.call(this,mstrmojo.desc(3498,"Align"),[{n:mstrmojo.desc(3049,"Left"),v:$GM.EnumTextAlignH.LEFT,css:"left"},{n:mstrmojo.desc(2193,"Center"),v:$GM.EnumTextAlignH.MIDDLE,css:"center"},{n:mstrmojo.desc(2166,"Right"),v:$GM.EnumTextAlignH.RIGHT,css:"right"}],getSmartName(SUFFIX_TEXT_ALIGNMENT_HORIZONTAL),$HASH.copy(getFmtPropsOverrides(),{cssClass:"txtAlign",showIcon:true,groupTitle:groupTitle})),ctrlRowsAndColsVerAlign=getPropertyButtonBar.call(this,"",[{n:mstrmojo.desc(2256,"Top"),v:$GM.EnumTextAlignV.TOP,css:"top"},{n:mstrmojo.desc(8631,"Middle"),v:$GM.EnumTextAlignV.MIDDLE,css:"middle"},{n:mstrmojo.desc(2257,"Bottom"),v:$GM.EnumTextAlignV.BOTTOM,css:"bottom"}],getSmartName(SUFFIX_TEXT_ALIGNMENT_VERTICAL),$HASH.copy(getFmtPropsOverrides(),{cssClass:"verticalAlign",showIcon:true,groupTitle:groupTitle}));return[groupTitle,selector,ctrlRowsAndColsShowHide,ctrlRowsAndColsFontGroup,ctrlRowsAndColsHorAlign,ctrlRowsAndColsVerAlign];}function getRCBackgroundControls(){var broker=this.broker,editorManager=broker.editorManager,selName=NAME_ROWS_COLUMNS_BG_FILL_FOR,prx=selName+LEVEL_SEPARATOR,relatePrx=NAME_BACKGROUND_FILL_FOR+LEVEL_SEPARATOR;var groupTitle=getGroupTitle.call(this,mstrmojo.desc(3905,"Background"),{highlightObjects:[$ENUM_IDENTITY_TYPE.ROWS_BACKGROUND,$ENUM_IDENTITY_TYPE.COLS_BACKGROUND],scopeSelectors:[selName]}),snMap=broker.getSmartNamesMapForFillGroup(prx);return[groupTitle,getTargetSelector.call(this,null,selName,[{n:mstrmojo.desc(2968,"Rows"),prefix:PREFIX_ROW_HEADER,identity:$ENUM_IDENTITY_TYPE.ROWS_BACKGROUND,v:0},{n:mstrmojo.desc(122,"Columns"),prefix:PREFIX_COL_HEADER,identity:$ENUM_IDENTITY_TYPE.COLS_BACKGROUND,v:1}],editorManager,{highlightObjects:[$ENUM_IDENTITY_TYPE.ROWS_BACKGROUND,$ENUM_IDENTITY_TYPE.COLS_BACKGROUND],groupTitle:groupTitle}),getFillConfigComp.call(this,mstrmojo.desc(2885,"Fill"),snMap,{listenFormatProps:$HASH.valarray(this.broker.getSmartNamesMapForFillGroup(relatePrx)),controlName:"BackgroundFillGroup",groupTitle:groupTitle,showGradient:!broker.getVisProfile(VIS_PROFILE_AXIS_IN_COLOR_BY)})];}function getMatrixLinesControls(){var broker=this.broker,editorManager=broker.editorManager,selName=NAME_BORDER_METRICS_LINE_FOR,prx=selName+LEVEL_SEPARATOR;var groupTitleMatrixLines=getGroupTitle.call(this,mstrmojo.desc(12050,"Matrix Lines"),{highlightObjects:[($ENUM_IDENTITY_TYPE.H_MATRIX_LINE|$ENUM_IDENTITY_TYPE.V_MATRIX_LINE),$ENUM_IDENTITY_TYPE.H_MATRIX_LINE,$ENUM_IDENTITY_TYPE.V_MATRIX_LINE],scopeSelectors:[selName]});return[groupTitleMatrixLines,getTargetSelector.call(this,null,selName,[{n:mstrmojo.desc(11998,"All Matrix Lines"),prefix:"allMatrixLn",identity:($ENUM_IDENTITY_TYPE.H_MATRIX_LINE|$ENUM_IDENTITY_TYPE.V_MATRIX_LINE),v:0},{n:mstrmojo.desc(11999,"Horizontal Matrix Lines"),prefix:"hMatrixLn",identity:$ENUM_IDENTITY_TYPE.H_MATRIX_LINE,v:1},{n:mstrmojo.desc(12000,"Vertical Matrix Lines"),prefix:"vMatrixLn",identity:$ENUM_IDENTITY_TYPE.V_MATRIX_LINE,v:2}],editorManager,{highlightObjects:[($ENUM_IDENTITY_TYPE.H_MATRIX_LINE|$ENUM_IDENTITY_TYPE.V_MATRIX_LINE),$ENUM_IDENTITY_TYPE.H_MATRIX_LINE,$ENUM_IDENTITY_TYPE.V_MATRIX_LINE],groupTitle:groupTitleMatrixLines}),getLineConfigComp.call(this,null,broker.getSmartNamesMapForLineGroup(prx),{lineTitle:mstrmojo.desc(13927,"Line:"),controlName:"MatrixLineGroup",groupTitle:groupTitleMatrixLines,showNoFillInColor:false,showGradient:!broker.getVisProfile(VIS_PROFILE_AXIS_IN_COLOR_BY)})];}function getRowsAndColumnsControls(dynamicCtrlGroup){this.replaceChildControls(dynamicCtrlGroup,[this.getEditorGroup(getRCTextControls.call(this),nestedGroupProps),this.getEditorGroup(getRCBackgroundControls.call(this),nestedGroupWithDividerProps),this.getEditorGroup(getMatrixLinesControls.call(this),nestedGroupWithDividerProps)]);}function getShapeColorThresholdEditorLink(highLightTitleAndShapeFn){var vis=this.broker.vis,metricsInColorByDropZone=getMetricsInDropZone(vis.zonesModel,mstrmojo.vi.viz.EnumDSSDropZones.ColorBy);return this.getLabelAndControl(mstrmojo.desc(6242,"Color"),this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13174,"Select color ranges..."),cssText:"text-decoration: underline;cursor: pointer;",postclick:highLightTitleAndShapeFn,onclick:function(){vis.model.openThresholdEditor(metricsInColorByDropZone[0],true,false);}})),"30%","70%");}function getShapeFormattingTargetItems(){var allItem,metricItems=[],colorByItems=[],originalCollection=this.getHost().getStyleEffectsOptions(),isMetricNamesInColorBy=false;originalCollection.forEach(function(item){var optLvl=item.optLvl;if(optLvl===$SEL_OPT_LVL.ALL_SHAPE){allItem=item;}else{if(optLvl===$SEL_OPT_LVL.METRIC){metricItems.push(item);}else{if(optLvl===$SEL_OPT_LVL.COLOR_BY){if(item.isMetricNames){isMetricNamesInColorBy=true;}colorByItems=item.subOptions||[];}}}});if(isMetricNamesInColorBy){metricItems=[];}return{allItem:allItem,metricItems:metricItems,colorByItems:colorByItems,originCollection:originalCollection};}function getShapeFormattingControls(){var host=this.getHost(),broker=this.broker,editorManager=broker.editorManager,hasMetricInColorByDropZone=getMetricsInDropZone(broker.vis.zonesModel,mstrmojo.vi.viz.EnumDSSDropZones.ColorBy).length>0,comBObj=host.isShapeCombonation(),isCombination=comBObj.isComb,tgtItems=getShapeFormattingTargetItems.call(this),allItem=tgtItems.allItem,metricItems=tgtItems.metricItems,colorByItems=tgtItems.colorByItems;var shapeFmtSuffix="ShapeFormatting";function getShapeFormatSmartNames(fld){return broker.generateSmartName(null,shapeFmtSuffix,fld,null,TARGET_SELECTABLE);}function getPropNotSetSN(smartName){return getShapeFormatSmartNames(broker.getFormatPropertyKey(smartName).filedAlias+SUFFIX_PROP_NOT_SET);}function getHiLightTitleAndShapeFn(){return function(){getMouseClickHighLightFn(editorManager).call(this);editorManager.sendShapeOption();};}var groupTitle=getGroupTitle.call(this,mstrmojo.desc(13751,"Shape Formatting")),selector=getShapeObjectMenuPulldown.call(this,{allItem:allItem,metricItems:metricItems,colorByItems:colorByItems},{groupTitle:groupTitle,postclick:getHiLightTitleAndShapeFn(editorManager)}),shapeControls=[];function getAvailableShapeTypes(){var excluding=[$ENUM_SHAPE.AREA,$ENUM_SHAPE.LINE];if(broker.getVisProfile(VIS_PROFILE_IS_ABL)){excluding=[];}else{if(broker.getVisProfile(VIS_PROFILE_IS_BUBBLE)){excluding.push($ENUM_SHAPE.BAR);}}return $ARR.filter([{n:mstrmojo.desc(12097,"Bar"),v:$ENUM_SHAPE.BAR},{n:mstrmojo.desc(12098,"Line"),v:$ENUM_SHAPE.LINE},{n:mstrmojo.desc(12099,"Area"),v:$ENUM_SHAPE.AREA},{n:mstrmojo.desc(12100,"Circle"),v:$ENUM_SHAPE.CIRCLE},{n:mstrmojo.desc(12101,"Square"),v:$ENUM_SHAPE.SQUARE},{n:mstrmojo.desc(12102,"Tick"),v:$ENUM_SHAPE.TICK},{n:mstrmojo.desc(12103,"Ring"),v:$ENUM_SHAPE.RING},{n:mstrmojo.desc(12104,"Pie"),v:$ENUM_SHAPE.PIE}],function(item){return excluding.indexOf(item.v)===-1;});}var fillShapes=[$ENUM_SHAPE.BAR,$ENUM_SHAPE.AREA,$ENUM_SHAPE.CIRCLE,$ENUM_SHAPE.SQUARE],lineShapes=[$ENUM_SHAPE.LINE,$ENUM_SHAPE.TICK],clrCtrlEnabledFromSelector=function clrCtrlEnabledFromSelector(){var optLvl=selector.value&&selector.value.optLvl;return(colorByItems.length>0&&optLvl!==$SEL_OPT_LVL.ALL_SHAPE&&optLvl!==$SEL_OPT_LVL.METRIC)||(colorByItems.length===0&&optLvl===$SEL_OPT_LVL.ALL_SHAPE);},adjustCtrlLayout=function adjustCtrlLayout(shapeCtrlContainer,hasOnlyOneCtrl){if(hasOnlyOneCtrl){$HASH.copy({col1Node:"58%",col2Node:"42%"},shapeCtrlContainer.layoutConfig.w);var offsetWidth=3;$HASH.copy({cssText:"margin-left: "+offsetWidth+"px;",getLayoutOffsets:function getLayoutOffsets(){return{h:0,w:offsetWidth};}},shapeCtrlContainer.getCtrl());}return shapeCtrlContainer;};function getSharedControlProps(hideColorControl,resettableClrSN,hasSingleCtrl,lineStyleSN){var rst={postclick:getHiLightTitleAndShapeFn(editorManager),groupTitle:groupTitle,preBuildRendering:$EF,onRender:function(){this.reInit();}},snColorNotSet=getPropNotSetSN(resettableClrSN);if(!hideColorControl){$HASH.copy({reInit:function(){var colorEnabled=clrCtrlEnabledFromSelector();if(hasSingleCtrl){this.getCtrlContainer().set("enabled",colorEnabled);}else{this.setChildEnable(SUFFIX_COLOR,colorEnabled);}this.reInitDefault();},onGroupValueChange:function(smartName,value){if(resettableClrSN&&smartName===resettableClrSN&&value===$ACP.VAL_AUTOMATIC){value=VAL_CLEAR;}this.broker.setFormatPropertyValue(smartName,value);},onFmtPropsChanged:function onFmtPropsChangedDefault(smartName,value){if(resettableClrSN&&smartName===resettableClrSN){var isDefaultColor=this.broker.getFormatPropertyValue(snColorNotSet);this.syncControl(function(){this.getChildComp(smartName).set("autoPreviewColor",isDefaultColor?value:null);this.setChildValue(smartName,isDefaultColor?$ACP.VAL_AUTOMATIC:value);});}else{this.onFmtPropsChangedDefault(smartName,value);if(lineStyleSN&&smartName===lineStyleSN){this.setChildEnable(SUFFIX_COLOR,clrCtrlEnabledFromSelector()&&value!==mstrmojo.gm.EnumCombinedLineStyle.NONE);}}}},rst);}return rst;}var fnGetShapeLineGroup=function(hideColorControl,overrideFuncs){var label=hideColorControl?mstrmojo.desc(13752,"Line Style"):null,snMap={lineColor:getShapeFormatSmartNames($ENUM_FORMAT_TAG.SHAPE_FILL_COLOR),lineStyle:getShapeFormatSmartNames($ENUM_FORMAT_TAG.SHAPE_LINE_COMBINED_STYLE)},hasSingleCtrl=hideColorControl,props=$FUNC.override(overrideFuncs,$HASH.copy({controlName:"shapeLineGroup",hideColorControl:hideColorControl,showNoFillInColor:false,showAutomaticInColor:true,showNoneOption:false},getSharedControlProps(hideColorControl,snMap.lineColor,hasSingleCtrl,snMap.lineStyle)));if(hideColorControl){delete snMap.lineColor;}return adjustCtrlLayout(getLineConfigComp.call(this,label,snMap,$FUNC.override({reInit:function(){var gmCtrl=host.GMController,isSelectedPureLine=$ARR.difference(gmCtrl.getShapeForOption(selector.value),lineShapes).length===0,hasSizeByMetric=gmCtrl.getSizeByMetrics().length>0;this.setChildEnable(snMap.lineStyle,!(isSelectedPureLine&&hasSizeByMetric));this._super();}},props)),hideColorControl);}.bind(this);var fnGetShapeFillGroup=function(hideColorControl,hideTransparentControl,overrideFuncs){var label=mstrmojo.desc(2885,"Fill"),snMap=broker.getSmartNamesMapForFillGroup(null,shapeFmtSuffix,PREFIX_SHAPE,"fld",null,TARGET_SELECTABLE),hasSingleCtrl=hideColorControl||hideTransparentControl,props=$HASH.copy({controlName:"shapeFillGroup",showGradient:host.interactor.isShowGradientAllowed(),showAutomaticInColor:true},getSharedControlProps(hideColorControl,snMap.fillColor,hasSingleCtrl));if(hideColorControl){label=mstrmojo.desc(13658,"Fill Opacity");delete snMap.fillColor;props.visibleControls=$FILL_GROUP_FLAGS.FILL_TRANSPARENCY;}else{if(hideTransparentControl){label=mstrmojo.desc(13753,"Shape Color");delete snMap.fillAlpha;props.visibleControls=$FILL_GROUP_FLAGS.FILL_COLOR;}}var ctrlContainer=adjustCtrlLayout(getFillConfigComp.call(this,label,snMap,$FUNC.override(overrideFuncs,props)),hasSingleCtrl),snFillAlpha=snMap.fillAlpha,opacityCtrl=snFillAlpha&&ctrlContainer.getCtrl().getChildComp(snFillAlpha);if(opacityCtrl){$HASH.copy(getTextBoxPropsWithEmptyVal(broker,snFillAlpha),opacityCtrl);}return ctrlContainer;}.bind(this);var fnGetShapeBorderGroup=function(hideColorControl,overrideFuncs){var label=null,snMap=broker.getSmartNamesMapForLineGroup(null,shapeFmtSuffix,PREFIX_SHAPE_BORDER,"fld",null,TARGET_SELECTABLE),hasSingleCtrl=hideColorControl,props=$HASH.copy({lineTitle:mstrmojo.desc(9736,"Border"),controlName:"shapeBorderGroup",hideColorControl:hideColorControl,showNoFillInColor:false,showAutomaticInColor:true},getSharedControlProps(hideColorControl,snMap.lineColor,hasSingleCtrl,snMap.lineStyle));if(hideColorControl){delete snMap.lineColor;label=mstrmojo.desc(3538,"Border Style");props.lineTitle=null;}return adjustCtrlLayout(getLineConfigComp.call(this,label,snMap,$FUNC.override(overrideFuncs,props)),hasSingleCtrl);}.bind(this);var shapeTypeItems=getAvailableShapeTypes(),selectedShapeTypeIdx,shape;if(isCombination){selectedShapeTypeIdx=-1;}else{if(comBObj.shapeType===undefined){shape=host.getChartInfo().shape;}else{shape=comBObj.shapeType;}selectedShapeTypeIdx=$ARR.map(shapeTypeItems,function(item){return item.v;}).indexOf(shape);}var ctrlShapeType=this.getPulldown(shapeTypeItems,function(value){host.setWidgetPropertyValue($ENUM_XML_TAG.METRIC_SHAPES,{});host.processChangeShape(value);},selectedShapeTypeIdx,{onRender:function(){var selectedNode=this.selectedNode;if(selectedNode&&isCombination){selectedNode.innerHTML=mstrmojo.desc(5576,"Combination");}}}),ctrlShapeTypeWithLabel=this.getLabelAndControl(mstrmojo.desc(13754,"Shape Type"),ctrlShapeType,"40%","60%");if(broker.getVisProfile(VIS_PROFILE_PURE_LINE_AND_TICK)){shapeControls.push(fnGetShapeLineGroup(hasMetricInColorByDropZone));}else{if(broker.getVisProfile(VIS_PROFILE_PURE_BAR_AREA_CIRCLE_SQUARE_RING_PIE)){shapeControls.push(fnGetShapeFillGroup(hasMetricInColorByDropZone),fnGetShapeBorderGroup(hasMetricInColorByDropZone));}else{if(isCombination){if(!hasMetricInColorByDropZone){shapeControls.push(fnGetShapeFillGroup(false,true));}var getCtrlPropsForLimitedShapes=function getCtrlPropsForLimitedShapes(enabledShapes){return{reInit:function(){this._super();if(enabledShapes){var availableShapes=host.GMController.getShapeForOption(selector.value);this.getCtrlContainer().set("enabled",$ARR.intersection(availableShapes,enabledShapes).length>0);}}};},ctrlShapeLineStyle=fnGetShapeLineGroup(true,getCtrlPropsForLimitedShapes(lineShapes)),ctrlShapeFillOpacity=fnGetShapeFillGroup(true,false,getCtrlPropsForLimitedShapes(fillShapes)),ctrlShapeBorderGroup=fnGetShapeBorderGroup(false,getCtrlPropsForLimitedShapes(fillShapes));shapeControls.push(ctrlShapeLineStyle,ctrlShapeFillOpacity,ctrlShapeBorderGroup);}}}editorManager.shapeFormatControls=shapeControls;var rst=[ctrlShapeTypeWithLabel,groupTitle,selector];if(hasMetricInColorByDropZone){rst.splice(metricItems.length===1?3:2,0,getShapeColorThresholdEditorLink.call(this,getHiLightTitleAndShapeFn(editorManager)));}return rst.concat(shapeControls);}function getShapeMarkerControls(){var broker=this.broker;function getSmartName(sfx,fld){return broker.generateSmartName(null,sfx,fld);}var snLineMarkerShow=getSmartName($ENUM_FORMAT_TAG.LINE_MARKER_SHOW),shouldMarkerCtrlEnabled=function(control){return broker.getVisProfile(VIS_PROFILE_HAS_LINE_OR_AREA)&&!broker.getVisProfile(VIS_PROFILE_HAS_SIZE_BY_METRIC)&&(broker.vis.skipPaintedCheck||broker.vis.interactor.isLineOrAreaPaint());};return[getPropertyCheckBox.call(this,mstrmojo.desc(13755,"Show Marker"),snLineMarkerShow,{reInit:function reInit(){this.getCtrlContainer().set("enabled",shouldMarkerCtrlEnabled(this));this.reInitDefault();}}),getPropertyColorPicker.call(this,mstrmojo.desc(13756,"Marker Color"),getSmartName($ENUM_FORMAT_TAG.LINE_MARKER_COLOR,$ENUM_FORMAT_TAG.LINE_MARKER_COLOR),{listenFormatProps:[snLineMarkerShow],colorDefaultSN:getSmartName($ENUM_FORMAT_TAG.LINE_MARKER_COLOR,$ENUM_FORMAT_TAG.LINE_MARKER_COLOR+$ENUM_FORMAT_TAG.IS_DEFAULT_VALUE),showAutomatic:true,onFmtPropsChanged:function(smartName,value){if(smartName===snLineMarkerShow){this.parent.set("enabled",value&&shouldMarkerCtrlEnabled(this));}else{this.onFmtPropsChangedDefault(smartName,value);}}})];}function getDataLabelsControls(){var broker=this.broker,dataLabelTypeItems=[{n:mstrmojo.desc(2057,"None"),v:$GM.EnumDataLabels.HIDE}],availableItems={txt:{n:mstrmojo.desc(1013,"Text"),v:$GM.EnumDataLabels.SHOW_TEXT_ONLY},val:{n:mstrmojo.desc(2175,"Values"),v:$GM.EnumDataLabels.SHOW_VALUE_ONLY}},alwaysDisabled=false;if(broker.getVisProfile(VIS_PROFILE_SHOW_VAL_DATA_LABEL)){dataLabelTypeItems.unshift(availableItems.val);}if(broker.getVisProfile(VIS_PROFILE_SHOW_TXT_DATA_LABEL)){dataLabelTypeItems.unshift(availableItems.txt);}if(dataLabelTypeItems.length===1){$ARR.insert(dataLabelTypeItems,0,$HASH.valarray(availableItems));alwaysDisabled=true;}var snDataLabelType=broker.generateSmartName(null,$ENUM_XML_TAG.DATA_LABEL),snDataLabelReplacement=broker.generateSmartName(null,$ENUM_XML_TAG.DATA_LABELS_PLACEMENT),dataLabelItems=broker.getDataLabelItems(),includeDataLabelList=dataLabelItems&&dataLabelItems.length>1,rst=[getGroupTitle.call(this,mstrmojo.desc(11993,"Data Labels"),{highlightObjects:[$ENUM_IDENTITY_TYPE.DATA_LABEL]}),getPropertyButtonBar.call(this,null,dataLabelTypeItems,snDataLabelType,$HASH.copy(alwaysDisabled?{enabled:false}:undefined,{cssClass:"dataLabel "+("itemsCnt"+dataLabelTypeItems.length)})),getPropertyCheckBox.call(this,mstrmojo.desc(14606,"Hide overlapping labels"),snDataLabelReplacement,{listenFormatProps:[snDataLabelReplacement],reInitDefault:function(){(this.listenFormatProps).forEach(function(smartName){this.onFmtPropsChanged(smartName,this.broker.getFormatPropertyValue(smartName)!==mstrmojo.gm.EnumDataLabelPlacements.GENERIC);},this);}})];if(includeDataLabelList){rst.push(getPropertyCheckList.call(this,dataLabelItems,broker.generateSmartName(null,$ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL),{controlName:"DataLabelList",listenFormatProps:[snDataLabelType],onFmtPropsChanged:function(smartName,value,opt){if(smartName===snDataLabelType){this.set("enabled",value!==$GM.EnumDataLabels.HIDE);}else{this.onFmtPropsChangedDefault(smartName,value,opt);}}}));}rst.push(getCharacterConfigComp.call(this,null,broker.getSmartNamesMapForFontGroup(PREFIX_DATA_LABELS),{controlName:"DataLabelFontGroup",syncWithAllText:true,listenFormatProps:[snDataLabelType],onFmtPropsChanged:function(smartName,value){if(smartName===snDataLabelType){this.set("enabled",value!==$GM.EnumDataLabels.HIDE);}else{this.onFmtPropsChangedDefault(smartName,value);}}}));return rst;}function getShapesAndLabelsControls(dynamicCtrlGroup){var controls=[this.getEditorGroup(getShapeFormattingControls.call(this),nestedGroupProps)];if(this.broker.getVisProfile(VIS_PROFILE_HAS_LINE_OR_AREA)){controls.push(this.getEditorGroup(getShapeMarkerControls.call(this),nestedGroupWithDividerProps));}controls.push(this.getEditorGroup(getDataLabelsControls.call(this),nestedGroupWithDividerProps));this.replaceChildControls(dynamicCtrlGroup,controls);}mstrmojo.vi.models.editors.GMEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.editors.GMEditorModel",help:"dashboard_editor_graph_html5_properties.htm",broker:null,init:function init(props){this._super(props);this.broker=this.addDisposable(new mstrmojo.vi.models.editors.GMBroker({vis:this.getHost()}));},getInitialTarget:function getInitialTarget(){return CATEGORIES_DATA_EXPLORATION;},getEditorContents:function getEditorContents(){$GM_UTIL.handleDestroy(this,["mstrmojo.vi.models.editors.GMBroker"]);var editorManager=this.addDisposable(new mstrmojo.vi.models.editors.GMEditorManager({host:this.getHost(),model:this}));editorManager.initializing=true;var broker=this.broker;if(broker.editorManager){broker.detachEditorRuntime().destroy();}this.broker.attachEditorRuntime(editorManager);editorManager.initIdentityPanelMapping();var contents=this._super(),myId=this.id,dynamicCtrlGroup=contents[0],updateDynamicCtrlClass=function(){var editor=mstrmojo.all[myId];if(!dynamicCtrlGroup.hasRendered){$CSS.addWidgetCssClass(dynamicCtrlGroup,[(editor._hilightGMTitle?"hilightGMTitle":""),(editor._hilightGMContainer?"hilightGMContainer":"")]);}else{$CSS.toggleClass(dynamicCtrlGroup.domNode,"hilightGMTitle",editor._hilightGMTitle);$CSS.toggleClass(dynamicCtrlGroup.domNode,"hilightGMContainer",editor._hilightGMContainer);}};updateDynamicCtrlClass();this.onHighlightObjChange=function onHighlightObjChange(identityType){var editor=mstrmojo.all[myId];editor._hilightGMTitle=hasIdentityIncluded([$ENUM_IDENTITY_TYPE.VIZ_BOX_TITLE],identityType);editor._hilightGMContainer=hasIdentityIncluded([$ENUM_IDENTITY_TYPE.VIZ_BOX_CONTAINER],identityType);updateDynamicCtrlClass();};broker.editorManager._hilightObjListens.push(this);editorManager.initializing=false;return contents;},getTargetPulldownItems:function getTargetPulldownItems(dynamicCtrlGroup){var pulldownItems=this._super(dynamicCtrlGroup),broker=this.broker,fnGetHandler=function(fn){return function(args){broker.editorManager.clearControlsReference();$GM_UTIL.handleDestroy(this,["mstrmojo.vi.models.editors.GMBroker","mstrmojo.vi.models.editors.GMEditorManager"]);fn.bind(this,dynamicCtrlGroup)(args);}.bind(this);}.bind(this);if(broker.getVisProfile(VIS_PROFILE_IS_EMPTY)){return pulldownItems;}pulldownItems.push({n:mstrmojo.desc(11974,"Data Exploration"),v:CATEGORIES_DATA_EXPLORATION,h:fnGetHandler(getDataExplorationControls)});if(broker.getVisProfile(VIS_PROFILE_HAS_NUM_AX)){pulldownItems.push({n:mstrmojo.desc(12018,"Trend Lines"),v:CATEGORIES_TREND_LINES,h:fnGetHandler(getTrendLineControls)});pulldownItems.push({n:mstrmojo.desc(12030,"Reference Lines"),v:CATEGORIES_REFERENCE_LINES,h:fnGetHandler(getReferenceLineControls)});}pulldownItems.push({cls:"separator"});pulldownItems.push(pulldownItems.shift());if(broker.getVisProfile(VIS_PROFILE_HAS_SIZE_BY)||broker.getVisProfile(VIS_PROFILE_HAS_COLOR_BY)){pulldownItems.push({n:mstrmojo.desc(2403,"Legend"),v:CATEGORIES_LEGEND,h:fnGetHandler(getLegendControls)});}pulldownItems.push({n:mstrmojo.desc(13931,"Axis Lines and Labels"),v:CATEGORIES_AXIS,h:fnGetHandler(getAxisControls)});pulldownItems.push({n:mstrmojo.desc(11978,"Rows and Columns"),v:CATEGORIES_ROWS_COLUMNS,h:fnGetHandler(getRowsAndColumnsControls)});pulldownItems.push({n:mstrmojo.desc(13757,"Shapes and Data Labels"),v:CATEGORIES_SHAPES,h:fnGetHandler(getShapesAndLabelsControls)});return pulldownItems;},getFormatToTargetFn:function getFormatToTargetFn(){var gmEdtModelId=this.id;return function(formatMenuTarget){var gmEdtModel=mstrmojo.all[gmEdtModelId],editMgr=gmEdtModel&&gmEdtModel.broker&&gmEdtModel.broker.editorManager;if(formatMenuTarget===mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE&&editMgr&&editMgr.notifyNonShapeSelectionChangeToListeners){editMgr.notifyNonShapeSelectionChangeToListeners({identities:[{objType:$ENUM_IDENTITY_TYPE.VIZ_BOX_TITLE}]});}};},getPulldown:function getPulldown(items,fnChange,selectedIndex,props,skipInstantiation){props=$HASH.copy({_set_selectedIndex:function _set_selectedIndex(n,v){if(v===-1){this.selectedIndex=v;this.getPopupList().clearSelect();var selectedNode=this.selectedNode;if(selectedNode){selectedNode.innerHTML="";}return false;}return this.constructor.prototype._set_selectedIndex.call(this,n,v);}},props);return this._super.apply(this,arguments);}});mstrmojo.vi.models.editors.GMEditorModel.PropertyKeyType=null;}());