(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Button","mstrmojo.EnumRWUnitType","mstrmojo.vi.models.VIComponentMap","mstrmojo.VisEnum");mstrmojo.requiresDescs(14292,14293,14607);var $ARR=mstrmojo.array,ATTR_TYPE=12,ROWS=1,COLUMNS=2,$NWB=mstrmojo.Button.newWebButton,$VI_TYPES=mstrmojo.vi.models.VIComponentMap.TYPES;mstrmojo.vi.models._CheckDataCards=mstrmojo.provide("mstrmojo.vi.models._CheckDataCards",{_mixinName:"mstrmojo.vi.models._CheckDataCards",CARDLIMIT:mstrmojo.VisEnum.VIS_CARDLIMIT.NON_GRID,isUnitRestrictedInViz:function(){var docModel=this.docModel,units=[],filterPanel=docModel.getVIComponent($VI_TYPES.FILTER_PANEL),filterPanelStack=filterPanel&&filterPanel.parent;units=units.concat((filterPanelStack&&filterPanelStack.getFilterDefinitions())||[]);return units.length;},_addInLargeItems:[],_columnCardinalityCount:1,clearCardinalityFlags:function(){this._addInLargeItems=[];this._columnCardinalityCount=1;},existLargeOrManyItems:function(){return(!!this._addInLargeItems.length||this._columnCardinalityCount>this.CARDLIMIT);},findTotalColumnCount:function(items,zone){var me=this,itmCnt,potColCount=1,ignoreCount=0,gridData=this.getHost().gridData;me._columnCardinalityCount=1;if(gridData){if(zone&&zone.id===ROWS){var rw=gridData.rw,row=rw&&rw.row;me._columnCardinalityCount=(row&&row.tc)||1;return ;}var ghs=gridData.ghs,chs=ghs&&ghs.chs;$ARR.forEach(chs&&chs.items,function(colItem){if(colItem.items){potColCount=Math.max(potColCount,colItem.items.length);}});}$ARR.forEach(items,function(item){if(zone&&zone.id===COLUMNS){zone.items.every(function(zoneItem){if(zoneItem.t===ATTR_TYPE&&zoneItem.did===item.did&&zoneItem.card){ignoreCount++;potColCount=potColCount/zoneItem.card;return false;}return true;});}itmCnt=item.cardg>0?item.cardg:item.card;if(!itmCnt&&item.otp===ATTR_TYPE&&item.es){itmCnt=item.es.length+1;}if(itmCnt){potColCount=potColCount*itmCnt;}});me._columnCardinalityCount=(ignoreCount===items.length)?1:potColCount;},findLargeItemsForAddUnits:function(items,render,cardinate){var me=this,cardCnt;if((!render&&!me.isUnitRestrictedInViz())||render){items.forEach(function(item){var itmCnt=item.cardg>0?item.cardg:item.card;cardCnt=!!cardinate?cardinate:me.CARDLIMIT;if(itmCnt&&itmCnt>cardCnt){me._addInLargeItems.push(item.n+" ("+itmCnt+")");}});}},warnAndExecCallBackForAddUnits:function(callback,alternateCallback,isInitialRender){if(this.existLargeOrManyItems()){var largeItems=this._addInLargeItems,largeItemsLength=largeItems.length,warningMsg;if(largeItemsLength>1){warningMsg=mstrmojo.desc(14292,"The following attributes contain a large number of elements: ##. This action may impact dashboard performance.").replace("##",largeItems);}else{if(largeItemsLength===1){warningMsg=mstrmojo.desc(14293,"The attribute ## has too many elements. This action may impact dashboard performance.").replace("##",largeItems);}else{warningMsg=mstrmojo.desc(14607,"The dashboard will attempt to display more than ### columns. This can affect performance and stability.").replace("###",this.CARDLIMIT);}}var buttonsList=[];if(largeItemsLength&&alternateCallback){buttonsList.push($NWB(mstrmojo.desc(7977,"Move to Rows"),function(){alternateCallback();},true));}buttonsList.push($NWB(mstrmojo.desc(212,"Continue"),function(){callback();}));buttonsList.push($NWB(mstrmojo.desc(2140,"Cancel"),function(){if(isInitialRender){mstrmojo._DocToolbarActions.close.call({model:{isnew:false}});}}));mstrmojo.warn(warningMsg,{},{buttons:buttonsList});largeItems.splice(0,largeItems.length);return ;}callback();},checkAndWarnLargeItemsForAddUnits:function(items,callback,alternateCallback,checkColumnCount,zone,isInitialRender,cardinate){this.clearCardinalityFlags();if(!zone||zone.id===COLUMNS){this.findLargeItemsForAddUnits(items,isInitialRender,cardinate);}if(checkColumnCount){this.findTotalColumnCount(items,zone);}this.warnAndExecCallBackForAddUnits(callback,alternateCallback,isInitialRender);}});}());