(function(){mstrmojo.requiresCls("mstrmojo.vi._MonitorsAppState","mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui._HasUITheme","mstrmojo.ui.pathbar.PathBar","mstrmojo.css");var $CSS=mstrmojo.css,$DOM=mstrmojo.dom,PATH_BAR_HEIGHT="42px",MENUTOOL_BAR_HEIGHT="41px",MIN_WIDTH=610;function addView(view,slot,alias,noReplace){var oldView=this[alias];if(oldView){if(noReplace){throw new Error("RootView: Cannot replace "+view.scriptClass+".");}this.removeChildren(oldView);}view.slot=slot;view.alias=alias;this.addChildren([view]);return view;}function animatePathbar(pathbarNode,startTop,endTop,delay){pathbarNode.style.height=PATH_BAR_HEIGHT;window.setTimeout(function(){pathbarNode.style.top=startTop;window.setTimeout(function(){pathbarNode.style.top=endTop;},0);},delay||0);}mstrmojo.vi.ui.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._FillsBrowser,mstrmojo._HasLayout,mstrmojo.vi._MonitorsAppState,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.vi.ui.RootView",markupString:'<div id="{@id}" class="mstrmojo-RootView {@cssClass}" style="{@cssText}" mstrAttach:contextmenu,click><div class="mstrmojo-RootView-pathbar"></div><div class="mstrmojo-RootView-menutoolbar"><div class="mstrmojo-RootView-menubar"></div><div class="mstrmojo-RootView-toolbar"></div></div><div><div class="mstrmojo-RootView-datasets"></div><div class="mstrmojo-RootView-content"></div><div class="mstrmojo-RootView-gallery"></div></div><div id="canvasOverlay"></div><div id="annotate_tools"></div></div>',markupSlots:{pathbarNode:function(){return this.domNode.firstChild;},menuToolbarNode:function(){return this.domNode.childNodes[1];},menubarNode:function(){return this.domNode.childNodes[1].childNodes[0];},toolbarNode:function(){return this.domNode.childNodes[1].childNodes[1];},contentNode:function(){return this.domNode.childNodes[2];},datasetsNode:function(){return this.domNode.childNodes[2].childNodes[0];},containerNode:function(){return this.domNode.childNodes[2].childNodes[1];},galleryNode:function(){return this.domNode.childNodes[2].lastChild;},annotationsOverlayNode:function(){return this.domNode.childNodes[3];},annotationsToolbarNode:function(){return this.domNode.childNodes[4];},},markupMethods:{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},layoutConfig:{h:{pathbarNode:"0px",menutoolbarNode:MENUTOOL_BAR_HEIGHT,datasetsNode:"100%",containerNode:"100%",galleryNode:"100%"},w:{pathbarNode:"all",menuToolbarNode:"all",datasetsNode:"auto",containerNode:"100%",galleryNode:"auto"},xt:true},themeClassName:"mojo-theme-light",onthemeClassNameChange:function onthemeClassNameChange(evt){this._super(evt);document.body.setAttribute("appThemeClass",this.themeClassName);},datasetObjectsPanel:null,init:function init(props){this._super(props);var pathInfo=mstrApp.pathInfo,controller=this.controller;if(pathInfo){this.setPathbar(new mstrmojo.ui.pathbar.PathBar({pathInfo:pathInfo,visible:false}));}if(mstrApp.menubarModelData){controller.menubar=this.setMenubar(new mstrmojo.vi.ui.toolbars.RootToolbar({ignoreLayout:true}));}if(mstrApp.tbModelData){controller.toolbar=this.setToolbar(new mstrmojo.vi.ui.toolbars.RootToolbar({useRichTooltip:true,ignoreLayout:true}));}},onAppStateChange:function onAppStateChange(evt){var appStates=mstrmojo.vi.VisualInsightApp.APP_STATES,presentationMode=appStates.PRESENTATION,isPresentationMode=mstrApp.appState===presentationMode,domNode=this.domNode,clsPresentation="presentation";if(evt.value===presentationMode||evt.valueWas===presentationMode){if(isPresentationMode){$CSS.addClass(domNode,clsPresentation);if(mstrApp.enhancedPrensetation&&!mstrApp.isShare){$CSS.addClass(domNode,"enhanced");}var pathbar=this.pathbar;if(pathbar&&pathbar.visible){this.togglePathbar(true);}}if(!isPresentationMode){$CSS.removeClass(domNode,clsPresentation);}}},setPathbar:function setPathbar(pathbar){return addView.call(this,pathbar,"pathbarNode","pathbar");},setMenubar:function setMenubar(menubar){return addView.call(this,menubar,"menubarNode","menubar");},setToolbar:function setToolbar(toolbar){return addView.call(this,toolbar,"toolbarNode","toolbar");},setDatasetObjectsPanel:function setDatasetObjectsPanel(panel){addView.call(this,panel,"datasetsNode","datasetObjectsPanel",true);this.doLayout();},setDocumentView:function setDocumentView(documentView){var containerNode=this.containerNode;documentView.height=containerNode.offsetHeight+"px";documentView.width=containerNode.offsetWidth+"px";return addView.call(this,documentView,"containerNode","documentView",true);},setGalleryView:function setGalleryView(gallery){var view=addView.call(this,gallery,"galleryNode","visGalleryView",true);this.doLayout();return view;},toggleMenuToolbar:function toggleMenuToolbar(skipReLayout){var showMenuToolbar=!this.menubar.visible,rootView=this,menutoolbarNode=rootView.menuToolbarNode;this.menubar.set("visible",showMenuToolbar);this.toolbar.set("visible",showMenuToolbar);this.layoutConfig.h.menutoolbarNode=showMenuToolbar?MENUTOOL_BAR_HEIGHT:"0px";if(!skipReLayout){rootView.doLayout();}if(!showMenuToolbar){menutoolbarNode.style.height="0px";$CSS.addClass(menutoolbarNode,"printPreview");}else{menutoolbarNode.style.height=MENUTOOL_BAR_HEIGHT;$CSS.removeClass(menutoolbarNode,"printPreview");}},togglePathbar:function togglePathbar(skipReLayout){if(!mstrApp.pathInfo){return ;}var showPathbar=!this.pathbar.visible,rootView=this,pathbarNode=rootView.pathbarNode,top="-"+PATH_BAR_HEIGHT,ANIMATION_TIME=700;$CSS.addClass(pathbarNode,"absolute");this.pathbar.set("visible",showPathbar);this.layoutConfig.h.pathbarNode=showPathbar?PATH_BAR_HEIGHT:"0px";if(showPathbar){animatePathbar(pathbarNode,top,"0px");if(!skipReLayout){window.setTimeout(function(){rootView.doLayout();},ANIMATION_TIME);}}else{if(!skipReLayout){rootView.doLayout();}animatePathbar(pathbarNode,"0px",top,200);window.setTimeout(function(){pathbarNode.style.height="0px";},ANIMATION_TIME);}window.setTimeout(function(){$CSS.removeClass(pathbarNode,"absolute");pathbarNode.style.top="";},ANIMATION_TIME);},getPathbarState:function getPathbarState(){return this.pathbar.visible;},oncontextmenu:function oncontextmenu(evt){if(!mstrmojo.debugBundles){$DOM.preventDefault(window,evt.e);return false;}},showErrMsg:function showErrMsg(msg){if(msg){this.containerNode.innerHTML='<div class="errMsg">'+msg+"</div>";mstrmojo.css.addClass(this.containerNode,"errMsg");}},setDimensions:function setDimensions(h,w){return this._super(h,Math.max(parseInt(w,10),MIN_WIDTH)+"px");}});}());