(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.array","mstrmojo._HasLayout","mstrmojo.vi.ui._IsPanel","mstrmojo._HasPopup","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsBoxLayoutChild","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi._MonitorsAppState","mstrmojo._Formattable","mstrmojo.vi.ui._IsUnitContainerTitleBar","mstrmojo.DynamicClassFactory","mstrmojo.Box","mstrmojo.css","mstrmojo.dom","mstrmojo.func","mstrmojo.models.FormatModel","mstrmojo.DocDataService","mstrmojo.vi.ui.TitleBar","mstrmojo.vi.models.EnumDragSources","mstrmojo.EnumRWUnitType");mstrmojo.requiresDescs(629,1388,11477,11478);var $ARR=mstrmojo.array,$CSS=mstrmojo.css,$DOM=mstrmojo.dom,$DRAG_SRC=mstrmojo.vi.models.EnumDragSources,$FORMAT_MODEL=mstrmojo.models.FormatModel,$ENUM_FORMAT_PROPERTIES=$FORMAT_MODEL.ENUM_PROPERTY_NAMES,SUPPRESS_DATA=mstrmojo.DocDataService.SUPPRESS_DATA,DEFAULT_Z_INDEX=1,CSS_BTN_VISIBLE="visible",CSS_OVERLAY="ctrlOverlay",CSS_OR_VERTICAL="or-v",CSS_OR_HORIZONTAL="or-h";mstrmojo.vi.ui.rw.UnitContainerTitleBar=mstrmojo.DynamicClassFactory.newComponent(mstrmojo.vi.ui.TitleBar,[mstrmojo.vi.ui._IsUnitContainerTitleBar],{scriptClass:"mstrmojo.vi.ui.rw.UnitContainerTitleBar"});var MNU_HIDE_TITLE={n:mstrmojo.desc(11477,"Hide Titlebar"),cls:"htb",fn:function(){this.toggleTitleBar(false);},dsbld:false};var MNU_SHOW_TITLE={n:mstrmojo.desc(11478,"Show Titlebar"),cls:"stb",fn:function(){this.toggleTitleBar(true);},dsbld:false};function toggleBoxSelection(isSelected){var isPresentationMode=mstrApp.isAppStatePresentation(),isPrintPreviewMode=mstrApp.isAppStatePrintPreview(),dNode=this.domNode;$CSS.toggleClass(dNode,"selected",isSelected&&!isPresentationMode&&!isPrintPreviewMode);}function toggleHighlight(isSelected,autoRemove,forceRemove){var appStates=mstrmojo.vi.VisualInsightApp.APP_STATES,presentationMode=appStates.PRESENTATION,isPresentationMode=mstrApp.appState===presentationMode;var dNode=this.domNode;$CSS.toggleClass(this.domNode,"pulse",isSelected&&!isPresentationMode&&!forceRemove);if(autoRemove){setTimeout(function(){$CSS.toggleClass(dNode,"pulse",false);},500);}}function getUnitContainer(modelId,unitContainerKey){return mstrmojo.all[modelId].getPanel().getUnitByKey(unitContainerKey);}function setMenuButtonVisibility(info){info.btn.style.display=!!info.menuCfg?"block":"none";}function checkDragSrc(context,src){var dragData=this.getContextDragData(context);return !!(dragData&&(dragData.src===src));}function isDragFromFilter(context){return checkDragSrc.call(this,context,$DRAG_SRC.FILTERS);}function isDragFromDatasets(context){return checkDragSrc.call(this,context,$DRAG_SRC.DATASETS);}function isDragFromAllObjectsBrowser(context){return checkDragSrc.call(this,context,$DRAG_SRC.ALL_OBJECT_LIST);}function clearOverlay(overlay){var children=overlay.children;if(children&&children.length){overlay.removeChildren();children.forEach(function(child){child.destroy();});}}function getUnitFormats(){var boxContent=this.boxContent;if(boxContent&&boxContent.getFormats){return boxContent.getFormats();}return null;}function toggleControlOverlay(evt){if(evt.visible){if(evt.controls){this.showControlOverlay(evt.controls);}else{throw new Error('mstrmojo.vi.ui.rw.UnitContainer: "controls" should be provided when showing the control overlay');}}else{this.hideControlOverlay();}}function launchFormatAction(formatData,fnCustom){var docController=this.model.controller,viPropPanelType="propertiesPanel",fnShowEditorTarget=function(){var fmtTarget=this.getFormatMenuItemTarget(formatData);var edtModel=this.getEditorModel();if(edtModel.selectTargetByValue){edtModel.selectTargetByValue(fmtTarget);}if(fnCustom){fnCustom(fmtTarget);}var propPanel=docController.getViPanel(viPropPanelType),propPanelParent=propPanel&&propPanel.parent;if(propPanelParent&&propPanelParent.highlightSelected){propPanelParent.highlightSelected();}}.bind(this);if(docController.getViPanel(viPropPanelType)){docController.selectViPanel(viPropPanelType);fnShowEditorTarget();}else{docController.openViPanel(viPropPanelType,{success:fnShowEditorTarget});}}function applyFormat(isTitleBar,formats){var fmtNodeName=isTitleBar?"titlebarNode":"domNode";this.clearCache();this.clearSlotBackgroundCSS(fmtNodeName);this.applyCSSFormatToNode(fmtNodeName,formats);}mstrmojo.vi.ui.rw.UnitContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._Formattable,mstrmojo._HasPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsBoxLayoutChild,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.rw.UnitContainer",markupString:'<div id="{@id}" class="mstrmojo-UnitContainer {@cssClass}" style="{@cssText} {@domNodeCssText}" mstrAttach:mouseover,mouseout,click,contextmenu><div class="mstrmojo-UnitContainer-titlebar" style="{@titlebarNodeCssText}"></div><div class="mstrmojo-UnitContainer-content"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{titlebarNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,ontopChange:mstrmojo.Widget.topMarkupMethod,onleftChange:mstrmojo.Widget.leftMarkupMethod,onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex||DEFAULT_Z_INDEX;},onenabledChange:function(){$CSS.toggleClass(this.domNode,"inactive",!this.enabled);},onorientationChange:function(){var ctrlOverlay=this.ctrlOverlay.domNode,orientation=this.orientation;$CSS.toggleClass(ctrlOverlay,CSS_OR_VERTICAL,orientation==="v");$CSS.toggleClass(ctrlOverlay,CSS_OR_HORIZONTAL,orientation==="h");this.orientationHasChanged();}},layoutConfig:{h:{titlebarNode:"auto",containerNode:"100%"},w:{titlebarNode:"100%",containerNode:"100%"},xt:true},formatHandlers:{domNode:["B","BG"],titlebarNode:{src:"ttl",props:["F","BG","text-align"]}},updateOverlay:mstrmojo.emptyFn,getCacheKey:function getCacheKey(){return this._super()+"-vi-uc";},getPanelForAddAction:function getPanelForAddAction(){return"propertiesPanel";},getExcludedPanels:function getExcludedPanels(){return["editPanel"];},titleBarCss:"",orientation:"h",k:"",boxContent:null,parent:null,enabled:true,draggable:true,ctrlOverlay:null,model:null,title:"",titleBar:null,showTitleBar:false,bubbleMouseOver:true,dimensionsSet:false,getEditOverlayControls:mstrmojo.emptyFn,isNewUnitContainer:true,shouldShowCustomizeContextMenu:function(evt){var target=evt.getTarget(),nodeName=target&&target.nodeName.toLowerCase();return nodeName&&!(nodeName==="textarea"||(nodeName==="input"&&target.type.toLowerCase()==="text"));},switchToEditMode:function switchToEditMode(){this.showControlOverlay(this.getEditOverlayControls());},init:function init(props){this._super(props);var id=this.id,model=this.model,tb;model.attachEventListener("viUnitSelected",id,function(evt){toggleBoxSelection.call(this,id===evt.id);});model.attachEventListener("viIconTabClicked",id,function(evt){var hgl=model.hgl;if(model.getSelectedViUnit()&&evt.id!="vi_flt"&&!!hgl==0){toggleHighlight.call(this,id===model.getSelectedViUnit().id,true,false);}});model.attachEventListener("viVizEditorDrag",id,function(evt){var hgl=model.hgl;if(model.getSelectedViUnit()&&evt.id!="vi_flt"&&!!hgl==0){toggleHighlight.call(this,id===model.getSelectedViUnit().id,false,!evt.isIn);}});this.addChildren([this.getTitleBarCfg(),{scriptClass:"mstrmojo.Box",cssClass:CSS_OVERLAY,alias:"ctrlOverlay",slot:"containerNode",visible:false}],0);tb=this.titleBar;if(tb&&tb.tbToolbar){tb.tbToolbar.toolbarClicked=function(){model.selectVIUnit(id);};}this.menuBtnInfo={};this.showTitleBar=!!this.defn.httl;this.draggable=mstrApp.allowWebDashboardDesign();this.boxContent.attachEventListener("toggleCtrlOverlay",this.id,toggleControlOverlay);},getDocModel:function getDocModel(){return this.model;},getBoxBorderWidth:function getBoxBorderWidth(){var fmts=getUnitFormats.call(this),border=fmts&&fmts.border;if(border){var convertedWidths=[2,4];if(mstrApp.isSingleTier&&$DOM.getOSInfo().name.toLowerCase().indexOf("mac")>=0){convertedWidths=[2.66,5.34];}return border.indexOf("2pt")>-1?convertedWidths[1]:convertedWidths[0];}return 0;},onFormat:function onFormat(){var boxContent=this.boxContent;if(boxContent.execFormatHandler){boxContent.execFormatHandler();return ;}launchFormatAction.call(this);},showControlOverlay:function showControlOverlay(controls,cssClass){var overlay=this.ctrlOverlay,overlayDomNode=overlay.domNode;if(overlayDomNode){var overlayCss=[CSS_OVERLAY];overlayCss.push((this.orientation==="v")?CSS_OR_VERTICAL:CSS_OR_HORIZONTAL);if(cssClass){overlayCss.push(cssClass);}overlayDomNode.className=overlayCss.join(" ");}overlay.set("visible",true);clearOverlay(overlay);overlay.addChildren(controls);},hideControlOverlay:function hideControlOverlay(){var overlay=this.ctrlOverlay;overlay.set("visible",false);clearOverlay(overlay);},getTitleBarCfg:function getTitleBarCfg(){return{scriptClass:"mstrmojo.vi.ui.rw.UnitContainerTitleBar",slot:"titlebarNode",alias:"titleBar",title:this.title,editTitleOnDoubleClick:mstrApp.allowWebDashboardDesign(),close:function(){this.parent.deleteSelf();},getLayoutOffsets:function getLayoutOffsets(){return{h:1,w:0};}};},getDisplayName:function getDisplayName(){return this.title;},updateDisplayName:function updateDisplayName(displayText,oldDisplayText,isTitle){var model=this.model,key=this.k;if(isTitle){model.renameRWUnitTitle(displayText,oldDisplayText,key,{success:function(appliedTitle){this.set("title",appliedTitle);}.bind(this),failure:function(err){mstrmojo.err(err);this.set("title",oldDisplayText);}.bind(this)});}else{model.renameRWUnit(displayText,oldDisplayText,key,{success:function(){this.synchronizeEditors();}.bind(this)});}},ontitleChange:function ontitleChange(){this.titleBar.set("title",this.title);},oncontextmenu:function oncontextmenu(evt){if(this.shouldShowCustomizeContextMenu(evt)){var menuConfig=this.addContextMenuItems(new mstrmojo.ui.menus.MenuConfig({position:$DOM.getMousePosition(evt.e,evt.hWin),isHostedWithin:false}),evt);if(menuConfig.hasMenuItems()){$DOM.preventDefault(window,evt.e);this.openPopup(menuConfig.newInstance());}}evt.cancel();},addContextMenuItems:function addContextMenuItems(menuCfg,evt){var editorModel=this.getEditorModel(),fnFormatHandler;if(editorModel.getFormattingToolbar){fnFormatHandler=function(fmtTarget){var toolbar=editorModel.getFormattingToolbar(fmtTarget,evt.getTarget());if(toolbar){this.openPopup(toolbar);}}.bind(this);}this.addFormatMenuItem(menuCfg,evt,fnFormatHandler);return menuCfg;},addFormatMenuItem:function addFormatMenuItem(menuCfg,formatData,fnCustom){if(!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign()){menuCfg.addMenuItem(mstrmojo.desc(1918,"Format"),"",function(){this.selectVIUnit();launchFormatAction.call(this,formatData,fnCustom);}.bind(this));}return menuCfg;},getFormatMenuItemTarget:function getFormatMenuItemTarget(formatData){return mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE;},applyBoxSize:function applyBoxSize(height,width,top,left){this._super(height,width,top,left);this.dimensionsSet=true;var newOrientation=parseInt(width,10)>parseInt(height,10)?"h":"v";if(newOrientation!==this.orientation){this.set("orientation",newOrientation);}},childRenderCheck:function childRenderCheck(c){var doChildRender=this._super(c);if(c===this.boxContent){doChildRender=doChildRender&&this.dimensionsSet;}return doChildRender;},postUpdateLayout:function postUpdateLayout(){var boxContent=this.boxContent;if(!this.domNode){return ;}if(!boxContent.hasRendered){boxContent.render();var selectedUnitKey=this.model.getLatestSelectedViUnitKey(),unit=selectedUnitKey&&this.parent.getUnitByKey(selectedUnitKey);if(unit){this.model.selectVIUnit(unit.id);}else{this.parent.selectFirstBox();}}else{boxContent.refresh();}this.isNewUnitContainer=false;},orientationHasChanged:mstrmojo.emptyFn,onRender:function onRender(){this._super();var selectedUnit=this.model.getSelectedViUnit();toggleBoxSelection.call(this,(selectedUnit&&selectedUnit.k===this.k));},onAppStateChange:function onAppStateChange(evt){var presentationMode=mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION,isPresentationOn=evt.value===presentationMode;if(isPresentationOn||evt.valueWas===presentationMode){this.draggable=!isPresentationOn;this.generateToolbar();}var selectedUnit=this.model.getSelectedViUnit();toggleBoxSelection.call(this,(selectedUnit&&selectedUnit.k===this.k));},selectVIUnit:function selectVIUnit(forceSelection){if(this.enabled){toggleBoxSelection.call(this,this.parent.selectVIUnit(this,forceSelection));}},synchronizeEditors:function synchronizeEditors(){if(this.model.getLatestSelectedViUnitKey()===this.k){this.selectVIUnit(true);}},addToggleTitleMenuItem:function addToggleTitleMenuItem(cfg){var titleButtons=[MNU_HIDE_TITLE,MNU_SHOW_TITLE];if(!this.titleBar.visible){titleButtons.reverse();}cfg.addDualStateItem(this.id,titleButtons[0],titleButtons[1]);},canShowDesignMenuItems:function canShowDesignMenuItems(){return mstrApp.allowWebDashboardDesign();},updateToolbar:function updateToolbar(cfg){var corners=cfg.ENUM_CORNERS;cfg.setAlignment(corners.BOTTOM_RIGHT,corners.TOP_RIGHT);cfg.isHostedWithin=false;if(this.canShowDesignMenuItems()&&mstrApp.appState!==mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION){cfg.addSeparator();this.addFormatMenuItem(cfg);if(this.showTitleBar){cfg.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){this.draggable=false;this.titleBar.editTitle();}.bind(this));}if(undefined!==this.getEditOverlayControls()){cfg.addMenuItem(mstrmojo.desc(3272,"Edit"),"cls",this.switchToEditMode.bind(this));}var key=this.k,modelId=this.model.id;cfg.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){getUnitContainer(modelId,key).deleteSelf();});}return cfg;},deleteSelf:function deleteSelf(callback){var unitContainerKey=this.k,model=this.model,modelId=model.id,modelData=model.data,parent=getUnitContainer(modelId,unitContainerKey).parent,parentKey=parent.k,keys=[parentKey],tgtFilters=[],getChildren=function(node){return node.sections||node.subsections||node.objects||node.panels||node.layouts||node.children;},deleteNode=function(node,key){var children=getChildren(node);for(var i=0;children&&(i<children.length);i++){if((children[i]&&children[i].k)===key){$ARR.removeIndices(children,i,1);return ;}else{deleteNode(children[i],key);}}},undoRedoCallback=model.getRebuildCallback();tgtFilters=tgtFilters.concat(model.getSourceFilterKeys(unitContainerKey,true));this.model.execute({execute:function(){var unitContainer=getUnitContainer(modelId,unitContainerKey);if(unitContainer){var panel=unitContainer.parent,model=mstrmojo.all[modelId],update=model.getDataService().newUpdate();var hasMultipleChildren=panel.hasMultipleChildren();update.addUpdate(unitContainer.createDeleteUpdate());update.addCallbacks({success:function success(response){model.partialUpdate(response.data,model.getTargetDefn(tgtFilters),response.defn,tgtFilters);deleteNode(modelData,unitContainerKey);model.deleteDataCache(unitContainer.boxContent&&unitContainer.boxContent.id);unitContainer.defn._isDeleted=true;unitContainer.destroy();}});panel.deleteBoxAndSubmitDeferred(update,unitContainer,null,true);if(!hasMultipleChildren){model.addVisualizationDeferred(update,panel.k);}panel.selectFirstBox();update.addCallbacks(callback);update.addExtras({style:{params:{treesToRender:0}}});this.submitUpdate(update);}},urInfo:{undo:function undo(){var unitContainer=getUnitContainer(modelId,unitContainerKey);if(unitContainer){delete unitContainer.defn._isDeleted;}},redo:function redo(){var unitContainer=getUnitContainer(modelId,unitContainerKey);if(unitContainer){unitContainer.defn._isDeleted=true;}},puKeys:keys,extras:mstrmojo.DocDataService.REQUEST_DEFN_DATA,callback:undoRedoCallback}});},undoInsert:function undoInsert(){var panel=this.parent,model=mstrmojo.all[this.model.id];panel.deleteBoxAndSubmitDeferred(model.getDataService().newUpdate(),this,null,true);panel.selectFirstBox();this.destroy();},createDeleteUpdate:function createDeleteUpdate(){},getTitleBarVisibility:function TitleBarVisibility(){return this.titleBar&&this.titleBar.visible;},setTitleBarVisibility:function setTitleBarVisibility(isVisible){var titleBar=this.titleBar;titleBar.set("visible",isVisible);var info=this.menuBtnInfo,menuBtn=info.btn;if(!menuBtn){menuBtn=info.btn=document.createElement("div");menuBtn.className="hover-menu-btn";var id=this.id;$DOM.attachEvent(menuBtn,"click",function(){var panel=mstrmojo.all[id],cfg=info.menuCfg;cfg.hostId=id;cfg.hostElement=menuBtn;panel.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:cfg}));});}this.domNode.appendChild(menuBtn);info.menuCfg=isVisible?null:titleBar.getMenuConfig();setMenuButtonVisibility(info);this.doLayout();},refresh:function refresh(){delete this._currentLayout;if(!this.parent.boxLayoutConfig.dirty){this._super();}else{applyFormat.call(this,false,this.getFormats());if(this.showTitleBar){applyFormat.call(this,true,this.getFormats());}}},addFormatProps:function addFormatProps(action,skipPartialRetrieval){return action;},onclick:function onclick(evt){this.selectVIUnit();if(!evt.e.ptvSelected&&this.switchPropertyOnClick()){this.boxContent.edtModel.selectTargetByValue(mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE);}},switchPropertyOnClick:function switchPropertyOnClick(){var editorModel=this.boxContent.edtModel;return !!(editorModel&&editorModel.selectTargetByValue);},getZonesModel:function getZonesModel(){return null;},getEditorModel:function getEditorModel(){return this.boxContent.edtModel;},onmouseover:function onmouseover(evt){if(!mstrApp.isInteractive()){return ;}if(!this.bubbleMouseOver){evt.cancel();}var timeout=this._panelTimeout;if(timeout){window.clearTimeout(timeout);delete this._panelTimeout;}if(this.titleBar.visible){this.titleBar.setToolbarVisibility(true);}var menuBtnInfo=this.menuBtnInfo;if(!!menuBtnInfo.menuCfg){$CSS.addClass(menuBtnInfo.btn,CSS_BTN_VISIBLE);}},onmouseout:function onmouseout(){var id=this.id;this._panelTimeout=window.setTimeout(function(){var panel=mstrmojo.all[id];if(panel){var menuBtnInfo=panel.menuBtnInfo;if(!!menuBtnInfo.menuCfg){$CSS.removeClass(menuBtnInfo.btn,CSS_BTN_VISIBLE);}panel.titleBar.setToolbarVisibility(false);}},200);},isDragValid:function isDragValid(context){var srcNodeTagName=context.src.node.tagName;srcNodeTagName=(srcNodeTagName&&srcNodeTagName.toLowerCase())||"";if(srcNodeTagName==="input"||srcNodeTagName==="textarea"){return false;}return this.parent.hasMultipleChildren();},initializeDrag:function initializeDrag(){this.selectVIUnit();},getTargetDropZone:function getTargetDropZone(context){if(isDragFromDatasets.call(this,context)||isDragFromAllObjectsBrowser.call(this,context)){return"";}return this._super(context);},allowDrop:function allowDrop(context){var dragSrc=context.src,widget=dragSrc&&dragSrc.widget;if(widget&&widget===this){return false;}if(isDragFromFilter.call(this,context)&&this.allowDropFromFilter(context)){return true;}if(isDragFromDatasets.call(this,context)&&this.allowDropFromDataset(context)){return true;}if(isDragFromAllObjectsBrowser.call(this,context)&&this.allowDropFromAllObjectsBrowser(context)){return true;}return this._super(context);},allowDropFromFilter:function allowDropFromFilter(){return mstrApp.allowWebDashboardDesign();},allowDropFromDataset:function allowDropFromDataset(context){return false;},allowDropFromAllObjectsBrowser:function allowDropFromAllObjectsBrowser(context){return this.allowDropFromDataset(context);},close:function(){this.parent.deleteBoxAndSubmit(this);this.parent.removeChildren(this);mstrApp.rootCtrl.generateToolbar();this.destroy();},createAvatar:function createAvatar(){this.domNode.style.zIndex="-1";var avatar=document.createElement("div");avatar.className=this.getAvatarCls().join(" ");avatar.textContent=this.getDisplayName();return this.offsetAvatar(avatar);},ondragend:function ondragend(context){this.domNode.style.zIndex=DEFAULT_Z_INDEX;this._super(context);},wasDropped:function wasDropped(context){this.domNode.style.zIndex=DEFAULT_Z_INDEX;this._super(context);},ondrop:function ondrop(context){var isFromFilter=isDragFromFilter.call(this,context),edge=this.maskNode.zone,selectorNode,me=this;if(isFromFilter){selectorNode=context.src.widget.selector.node;}this._super(context);if(isDragFromDatasets.call(this,context)){this.dropFromDataset(context);}if(isDragFromAllObjectsBrowser.call(this,context)){var widget=context.src.widget,dp=widget&&widget.dataProvider;if(dp){dp.loadObjects(context.getCtxtDragData().items,{success:function(){me.dropFromAllObjects(context);}});}}if(isFromFilter){var targetBox=this;if(!edge){edge=this.parent.getPanelTargetEdge(context);if(edge){targetBox=null;}}this.model.insertExistingFilter(selectorNode,targetBox,edge);}},postDropBox:function postDropBox(){this.domNode.style.zIndex=DEFAULT_Z_INDEX;},rebuildBoxContent:function rebuildBoxContent(fnUpdateContent){var boxContent=this.boxContent,parentPanel=this.parent;this.removeChildren(boxContent);boxContent.destroy();boxContent=this.model.rebuildUnitFromDataCache(boxContent.id,parentPanel.k,parentPanel.builder).boxContent;if(fnUpdateContent){fnUpdateContent(boxContent);}this.addChildren([boxContent]);},dropFromDataset:mstrmojo.emptyFn,dropFromAllObjects:mstrmojo.emptyFn,generateToolbar:function generateToolbar(){var titleBar=this.titleBar,toolbarCfg=titleBar.toolbarCfg;if(toolbarCfg){toolbarCfg.destroy();}titleBar.set("toolbarCfg",this.updateToolbar(new mstrmojo.ui.menus.ToolbarConfig()));if(!titleBar.visible){this.menuBtnInfo.menuCfg=titleBar.getMenuConfig();}},getTitleVisibilityFmts:function getTitleVisibilityFmts(value){return{FormattingView:{ShowTitleBar:value}};},toggleTitleBar:function toggleTitleBar(isVisible){var contentWidgetId=this.boxContent.id,model=this.model,toggleUnitContainerTitle=function toggleUnitContainerTitle(newVisibleValue){var boxContent=mstrmojo.all[contentWidgetId],unitContainer=boxContent.parent;unitContainer.setTitleBarVisibility(newVisibleValue);unitContainer.parent.selectVIUnit(unitContainer,true);unitContainer.applyBoxSize(unitContainer.height,unitContainer.width,unitContainer.top,unitContainer.left);boxContent.refresh();};model.controller.cmdMgr.execute({execute:function(){var unitContainer=mstrmojo.all[contentWidgetId].parent;this.submit([model.getUnitFormatAction(unitContainer,unitContainer.defn.t===mstrmojo.EnumRWUnitType.SELECTOR?5:1,unitContainer.getTitleVisibilityFmts(isVisible?1:0),true)],{failure:function failure(){toggleUnitContainerTitle(!isVisible);}},SUPPRESS_DATA);toggleUnitContainerTitle(isVisible);},urInfo:{silent:true,undo:function undo(){toggleUnitContainerTitle(!isVisible);},redo:function redo(){toggleUnitContainerTitle(isVisible);}}});},getFormats:function getFormats(){var boxContent=this.boxContent;if(boxContent){return boxContent.getFormats();}return null;},clearFormats:function clearFormats(){var boxContent=this.boxContent;if(boxContent&&boxContent.clearFormats){boxContent.clearFormats();}},preBuildRendering:function preBuildRendering(){var boxContent=this.boxContent;if(boxContent){boxContent.attachEventListener("regenerateToolbar",this.id,"generateToolbar");}this.generateToolbar();return this._super();},postBuildRendering:function postBuildRendering(){var showTitleBar=this.showTitleBar;this.setTitleBarVisibility(showTitleBar);this.titleBar.setToolbarVisibility(false);if(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()){this.draggable=false;}this._super();this.applyBoxSize(this.height,this.width,this.top,this.left);return true;},changeUnitFormats:function changeUnitFormats(isTitleBar,formatType,formats,propertyName,newValue,oldValue,fnValueConverter,fnListener){var fnChangeFmtValue=function(value){if(fnValueConverter){value=fnValueConverter(value);}$FORMAT_MODEL.updateFormatBlock(isTitleBar?formats.ttl:formats,propertyName,value);var box=this.parent?this:this.model.getSelectedViUnit();applyFormat.call(box,isTitleBar,formats);if(fnListener){fnListener(value);}box.synchronizeEditors();if(isTitleBar&&propertyName===$ENUM_FORMAT_PROPERTIES.FONT_SIZE){box.doLayout();}};this.model.saveUnitFormatProperty(this,[{formatType:formatType,propertyName:propertyName,newValue:newValue,oldValue:oldValue}],{success:fnChangeFmtValue.bind(this,newValue)},mstrmojo.DocDataService.SUPPRESS_DATA,{silent:true,undo:fnChangeFmtValue.bind(this,oldValue),redo:fnChangeFmtValue.bind(this,newValue)});},redraw:function redraw(){if(this.boxContent.redraw()===true){return true;}return this._super();},getAvatarCls:function getAvatarCls(){return["mstrmojo-VIUnit-avatar","icn-avi",mstrApp.getThemeClassName()];},addDragHandle:function addDragHandle(){var handleNode=document.createElement("div");handleNode.className="uc-drag-handle";this.domNode.appendChild(handleNode);},toggleDragHandleVisibility:function toggleDragHandleVisibility(show){$CSS.toggleClass(this.domNode,"no-handler",!show);}});}());