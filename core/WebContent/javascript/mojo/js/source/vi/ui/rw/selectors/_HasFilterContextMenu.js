(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.EditorConfig","mstrmojo.Box","mstrmojo.Label","mstrmojo.ui.CheckList","mstrmojo.vi.ui.DatasetUnitMenuUtils");mstrmojo.requiresDescs(2031,3945,3946,11505,11571,13629,13630,13860,14595);var $DS_UTILS=mstrmojo.vi.ui.DatasetUnitMenuUtils;function getTargetEditorConfig(itemContext){var cfg,selector=itemContext.selector,targets=itemContext.fn(),currentTargetKeys=targets.keys,targetItems=targets.items,targetList=new mstrmojo.ui.CheckList({cssClass:"units",items:targetItems.map(function(item){item.css=$DS_UTILS.getUnitCssClass(item);return item;}),onchange:function(){if(cfg){cfg.set("okEnabled",true);}}});targetList.setSelectedItems(targetItems.filter(function(item){return currentTargetKeys.indexOf(item.id)>-1;}));cfg=new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.Box({children:[{scriptClass:"mstrmojo.Label",text:itemContext.title},targetList]}),okEnabled:false,data:{},onOpen:function(){targetList.updateScrollbars();},cssClass:"mstrmojo-vi-FilterBox-targets",okBtnText:mstrmojo.desc(2031,"Apply"),fnOk:function(){selector.model.changeFilterTargets(selector,currentTargetKeys,targetList.getSelectedItems().map(function(item){return item.id;}),selector.isInFilterPanel());}});return cfg;}function isPresentationMode(){return mstrApp.appState===mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;}function getUpdateMenuItemValueFunction(selector,property){return function(v,vWas){var wasChanged=v!==vWas;if(wasChanged){selector.set(property,v);}return wasChanged;};}mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu",{_mixinName:"mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu",addModeMenuItems:function addModeMenuItems(cfg,selector,fnChangeMode){if(!selector.supportsInclude()){return false;}var fnGetModeMenuItem=function(text,isIncludeItem){var isSelected=selector.include===isIncludeItem;cfg.addMenuItem(text,isSelected?"on":"",function(){if(!isSelected){selector.set("include",isIncludeItem);this.generateToolbar();if(fnChangeMode){fnChangeMode();}}return !isSelected;}.bind(this));}.bind(this);fnGetModeMenuItem(mstrmojo.desc(3945,"Include"),true);fnGetModeMenuItem(mstrmojo.desc(3946,"Exclude"),false);cfg.addSeparator();return true;},addClearFilterMenuItem:function addClearFilterMenuItem(cfg,selector,fnClear){cfg.addMenuItem(mstrmojo.desc(14595,"Unset Filter"),"",function(){selector.clearSelector(true);if(fnClear){fnClear();}});return true;},addMenuItemIfSelectTargetsValid:function isSelectTargetsValid(cfg,selector,title){if(!isPresentationMode()){var targetInfo=this.getTargetInfo();if(targetInfo.items.length){cfg.addEditorMenuItem(mstrmojo.desc(13629,"Select Targets"),this.id,getTargetEditorConfig,{selector:selector,fn:this.getTargetInfo.bind(this),title:title});}}},addFilterStyleMenuItem:function addFilterStyleMenuItem(cfg,selector){if(isPresentationMode()||selector.isSolrSelector()){return false;}var styleList=selector.getSelectorStyleList();if(!styleList.length){return false;}cfg.addSubMenuItem(mstrmojo.desc(11505,"Display Style"),"",this.id,function(){var currentStyle=selector.defn.style,getGetChangeFn=function(newStyle){return function(){if(newStyle!==currentStyle){var aqs=mstrmojo.DocSelector.STYLES.ATTR_QUAL;if(newStyle===aqs||currentStyle===aqs){selector.model.openSelWarnFlag(selector.k);}selector.model.changeFilterStyle(selector,newStyle);}};};var menuCfg=new mstrmojo.ui.menus.MenuConfig();styleList.forEach(function(style){var itemStyle=style.v;menuCfg.addMenuItem(style.n,currentStyle===itemStyle?"on":"",getGetChangeFn(itemStyle));},this);return menuCfg;});return true;},addMultiSelectMenuItem:function addMultiSelectMenuItem(cfg,selector){if(!selector.allowsTogglingMultiSelect()||isPresentationMode()){return false;}cfg.addMenuItem(mstrmojo.desc(13860,"Allow Multiple Selections"),selector.multi?"on":"",function(){selector.model.changeFilterStyle(selector,selector.style,!selector.multi);});return true;},addQualMenuItems:function addQualMenuItems(cfg,selector){if(selector.isSolrSelector()||!selector.isMetricSelector()||selector.isRankMetricSelector()||!selector.isNumericMetricSelector()){return false;}cfg.addRadioMenuGroup(selector.qua>0?1:0,getUpdateMenuItemValueFunction(selector,"qua"),[{value:0,text:mstrmojo.desc(11571,"Qualify on Value")},{value:1,text:mstrmojo.desc(13630,"Qualify on Rank")}],"",undefined,true);cfg.addSeparator();return true;},getTargetInfo:function getTargetInfo(){this.throwAbstractMethodError("getTargetInfo");}});}());