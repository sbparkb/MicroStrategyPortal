(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.ui._IsViPanel","mstrmojo.vi.ui._IsBoxLayoutChild","mstrmojo.vi.ui._HasMask","mstrmojo.vi._MonitorsAppState","mstrmojo.DocSelector","mstrmojo.vi.ui.toolbars.TitleToolbar");var $SELECTOR_STYLES=mstrmojo.DocSelector.STYLES;function destroyCurrentUnit(){var unit=this.unit;if(unit){var selector=mstrmojo.all[unit.id];this.removeChildren(selector);selector.destroy();this.set("unit",null);}}mstrmojo.vi.ui.PageByPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi.ui.toolbars._HasToolbar,mstrmojo.vi.ui._IsViPanel,mstrmojo.vi.ui._IsBoxLayoutChild,mstrmojo.vi.ui._HasMask,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.PageByPanel",markupString:'<div id="{@id}" class="mstrmojo-VIPageByStack" style="{@cssText}"><div class="mstrmojo-VIPageByStack-Values horizontal"></div><div class="mstrmojo-VIPageByStack-Toolbar"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},toolbarNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onunitChange:function(){if(this.hasRendered){this.generateToolbar();this.doLayout();this.pageByStack.doLayout();}}},layoutConfig:{h:{toolbarNode:"100%",containerNode:"100%",maskNode:"100%"},w:{toolbarNode:"auto",containerNode:"all",maskNode:"all"},xt:true},unit:null,parent:null,pageByStack:null,useRichTooltip:true,isDynamicTooltip:true,getLayoutOffsets:function getLayoutOffsets(){return{h:2,w:2};},children:[{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",alias:"toolbar",slot:"toolbarNode"}],onAppStateChange:function onAppStateChange(evt){this._super(evt);var $APP_STATES=mstrmojo.vi.VisualInsightApp.APP_STATES,value=evt.value,toolbarNode=this.toolbarNode;this.set("isMasked",value===$APP_STATES.SELECTOR_TARGETING);if(toolbarNode){toolbarNode.style.display=(value===$APP_STATES.PRESENTATION)?"none":"";}},preBuildRendering:function preBuildRendering(){var parent=this.parent;this.model=parent.model;this.builder=parent.builder;return this._super();},moveTooltip:function moveTooltip(evt,win){this.richTooltip=null;var unit=this.unit;if(unit){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:unit.n,top:evt.clientY+15,left:evt.clientX-15};}this._super(evt,win);},updateToolbar:function updateToolbar(cfg){var corners=cfg.ENUM_CORNERS;cfg.setAlignment(corners.BOTTOM_RIGHT,corners.TOP_RIGHT);cfg.isHostedWithin=false;var unit=this.unit,model=this.parent.model;if(unit){var oldStyle=unit.style,fnAddStyleItem=function(text,newStyle){var cls=newStyle===oldStyle?"on":"";cfg.addMenuItem(text,cls,function(item){var newStyle=item.ctxt.style;if(newStyle===oldStyle){return false;}model.changePageByStyle(mstrmojo.all[unit.id],newStyle);return true;},{style:newStyle});};fnAddStyleItem(mstrmojo.desc(4734,"Button Bar"),$SELECTOR_STYLES.BUTTON);fnAddStyleItem(mstrmojo.desc(4730,"Slider"),$SELECTOR_STYLES.SCROLLER);fnAddStyleItem(mstrmojo.desc(4729,"Drop-down"),$SELECTOR_STYLES.PULLDOWN);cfg.addSeparator();cfg.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){mstrmojo.warn(mstrmojo.desc(13245,"This action will permanently delete the page-by panel. A new one can be created by inserting a new filter. Do you want to proceed?"),{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){destroyCurrentUnit.call(this);this.model.removePageByUnit(this,unit);}.bind(this),isHot:true},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});}.bind(this));}return this._super(cfg);},close:function close(){this.setOpenStatus(false);},setOpenStatus:function setOpenStatus(isOpen,noSave){var fnSuper=this._super,id=this.id;if(isOpen&&!this.pageByStack){this.model.loadHiddenPageByStack(this.builder,function(){fnSuper.call(mstrmojo.all[id],isOpen,true);});}else{fnSuper.call(this,isOpen,noSave);}},getPanelSaver:function(){return mstrmojo.vi.models.PanelFormatSaver.getPanelSaver(this.model,{visible:{set:"FormattingAppearance",name:"Visible"}},this.pageByStack);},setPageByStack:function setPageByStack(pageByStack){var existingStack=this.pageByStack;if(existingStack){this.removeChildren(existingStack);existingStack.destroy();}if(pageByStack){pageByStack.slot="containerNode";pageByStack.alias="pageByStack";this.addChildren([pageByStack]);}},resetLayout:function resetLayout(){this.parent.viPanelChangedVisibility(this);}});mstrmojo.vi.ui.PageByPanel.boxConfiguration={f:{h:32,v:45},o:"v",r:true};}());