(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.array","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi.models.DropZonesModel");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVisualizationTemplates","EnumVizStyles","EnumWidgetTypes");mstrmojo.requiresDescs(11819,11825,11827);var $MOJO=mstrmojo,$ARRAY=$MOJO.array,$VIZ=$MOJO.vi.viz,$ENUM_REQUIREMENT_TYPE=mstrmojo.vi.models.DropZonesModel.ENUM_REQUIREMENT_TYPE,REQ_ATTRIBUTE=$ENUM_REQUIREMENT_TYPE.ATTRIBUTE,REQ_METRIC=$ENUM_REQUIREMENT_TYPE.METRIC,$VIZ_TEMPLATES=$VIZ.EnumVisualizationTemplates,$VIZ_STYLES=$VIZ.EnumVizStyles,GRAPH_MATRIX_STYLE=$VIZ_STYLES.GRAPH_MATRIX,WTP_GRAPH_MATRIX=$VIZ.EnumWidgetTypes.GRAPH_MATRIX,$VIZ_TEMPLATES_MAP={},CUSTOM_STYLE="custom",PLUGINS="plugins.";$VIZ_TEMPLATES_MAP[$VIZ_STYLES.GOOGLE_MAP]=$VIZ_TEMPLATES.GOOGLEMAP;$VIZ_TEMPLATES_MAP[$VIZ_STYLES.HEAT_MAP]=$VIZ_TEMPLATES.HEATMAP;$VIZ_TEMPLATES_MAP[$VIZ_STYLES.ESRI_MAP]=$VIZ_TEMPLATES.ESRIMAP;$VIZ_TEMPLATES_MAP[$VIZ_STYLES.NETWORK]=$VIZ_TEMPLATES.NETWORK;$VIZ_TEMPLATES_MAP[$VIZ_STYLES.IMAGE_LAYOUT]=$VIZ_TEMPLATES.IMAGELAYOUT;function getItemRequirements(metrics,attributes){var requirements=[],fnPushReq=function(type,value){requirements.push({t:type,r:value});};if(metrics){fnPushReq(REQ_METRIC,metrics);}if(attributes){fnPushReq(REQ_ATTRIBUTE,attributes);}return requirements;}var $GM_ITEMS=[{n:mstrmojo.desc(11820,"Bar Chart"),id:"BarChart",mr:getItemRequirements(1,0),vt:{v:$VIZ_TEMPLATES.GRAPHMATRIXVERTICALBARAUTOMATIC,h:$VIZ_TEMPLATES.GRAPHMATRIXHORIZONTALBARAUTOMATIC}},{n:mstrmojo.desc(8121,"Line Chart"),id:"LineChart",mr:getItemRequirements(1,1),vt:{v:$VIZ_TEMPLATES.GRAPHMATRIXVERTICALLINEAUTOMATIC,h:$VIZ_TEMPLATES.GRAPHMATRIXHORIZONTALLINEAUTOMATIC}},{n:mstrmojo.desc(11821,"Area Chart"),id:"AreaChart",mr:getItemRequirements(1,1),vt:{v:$VIZ_TEMPLATES.GRAPHMATRIXVERTICALAREAAUTOMATIC,h:$VIZ_TEMPLATES.GRAPHMATRIXHORIZONTALAREAAUTOMATIC}},{n:mstrmojo.desc(11822,"Bubble Chart"),id:"BubbleChart",mr:getItemRequirements(1,1),vt:$VIZ_TEMPLATES.GRAPHMATRIXBUBBLECIRCLEMM},{n:mstrmojo.desc(11823,"Pie Chart"),id:"PieChart",mr:getItemRequirements(0,1),vt:$VIZ_TEMPLATES.GRAPHMATRIXPIE},{n:mstrmojo.desc(11824,"Combo Chart"),id:"ComboChart",mr:getItemRequirements(2,1),vt:$VIZ_TEMPLATES.GRAPHCOMBINATIONBARAREADUALAXIS}];$GM_ITEMS.forEach(function(vis){vis.s=GRAPH_MATRIX_STYLE;vis.wtp=WTP_GRAPH_MATRIX;});var VIZ_LIST_TYPE={BUILT_IN_LIST:1,CUSTOM_LIST:2};function getVizList(vizListType){var vizItems=[],visList=mstrConfig.pluginsVisList||{},fnAddRequirement=function(type,value,requirements){requirements=requirements||[];value=isNaN(value)?0:parseInt(value,10);if(value>0){requirements.push({t:type,r:value});}return requirements;};Object.keys(visList).forEach(function(vizType){var viz=visList[vizType],vizStyle=viz.s,vizName=viz.d,hasVizType=viz.c.indexOf(PLUGINS)!==-1?VIZ_LIST_TYPE.CUSTOM_LIST:VIZ_LIST_TYPE.BUILT_IN_LIST;if(!(vizListType&hasVizType)){return ;}if(vizStyle===GRAPH_MATRIX_STYLE){viz.st.forEach(function(visName){var gmVisPos=$ARRAY.find($GM_ITEMS,"id",visName);if(gmVisPos>=0){vizItems.push($GM_ITEMS[gmVisPos]);}});return ;}var descriptorID=viz.desc;if(descriptorID){vizName=mstrmojo.desc(descriptorID,"");}vizItems.push({n:vizName,s:vizStyle,mr:fnAddRequirement(REQ_ATTRIBUTE,viz.ma,fnAddRequirement(REQ_METRIC,viz.mm)),id:vizStyle,dz:viz.dz,vt:$VIZ_TEMPLATES_MAP[vizStyle],wtp:viz.wtp,pn:viz.pn||null});});return vizItems;}function getVisType(style){return getVizList(VIZ_LIST_TYPE.BUILT_IN_LIST+VIZ_LIST_TYPE.CUSTOM_LIST).filter(function(viz){return viz.s===style;}).map(function(viz){return{s:viz.s,vt:viz.vt||-1};})[0];}function removeCustomViz(vizname,pluginname){window.FormWrapper.doVisRemove(vizname,pluginname);}var itemMarkup;mstrmojo.vi.ui.VizGalleryList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.vi.ui.VizGalleryList",init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIGalleryList");this.items=(this.items||[]).concat(getVizList(this.type));},items:null,type:VIZ_LIST_TYPE.BUILT_IN_LIST,getItemMarkup:function getItemMarkup(item){if(!itemMarkup){itemMarkup=this._super(item).replace(">{@en@n}<","><div><div></div></div><");}return itemMarkup;},getItemProps:function getItemProps(item,idx){var props=this._super(item,idx);props.addCls("ic-"+item.id);if(this.type===VIZ_LIST_TYPE.CUSTOM_LIST){props.addCls(CUSTOM_STYLE);}return props;},select:function(idxs,bSuppressEvt){if(!idxs){return ;}idxs=$ARRAY.ensureArray(idxs);var rmv=this._removeAll(),add=this._addSelections(idxs),i;if(this.selectionPolicy!=="reselect"){for(i=rmv.length-1;i>=0;i--){var ind=$ARRAY.indexOf(add,rmv[i]);if(ind>-1){rmv.splice(i,1);add.splice(ind,1);}}}var evt={name:"selectionChange",added:add,removed:rmv};if(bSuppressEvt){if(this.onselectionChange){this.onselectionChange(evt);}}else{this.raiseEvent(evt);}},onItemContextMenu:function onItemContextMenu(item,evt){var menuCfg;if(item.pn){this.hideTooltip();menuCfg=new mstrmojo.ui.menus.MenuConfig({position:mstrmojo.dom.getMousePosition(evt.e,evt.hWin),isHostedWithin:false});menuCfg.addMenuItem(mstrmojo.desc(629,"Delete"),"",function(){removeCustomViz(item.id,item.pn);});this.openPopup(menuCfg.newInstance());}}});mstrmojo.vi.ui.VizGalleryList.getVizList=getVizList;mstrmojo.vi.ui.VizGalleryList.getVisType=getVisType;mstrmojo.vi.ui.VizGalleryList.VIZ_LIST_TYPE=VIZ_LIST_TYPE;}());