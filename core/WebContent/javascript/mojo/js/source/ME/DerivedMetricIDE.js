(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME.DerivedSimpleMetricEditor","mstrmojo.ME.DerivedRankEditor","mstrmojo.ME.DerivedFormulaMetricEditor","mstrmojo.ME.DerivedOLAPEditor","mstrmojo.ME.MetricIDE","mstrmojo.hash");mstrmojo.requiresDescs();var $DESC=mstrmojo.desc,E=mstrmojo.expr,$HASH=mstrmojo.hash;var IDE;function getDocumentDatasets(me){return me.datasets;}function getDocumentDatasetsUnits(me){var datasets=getDocumentDatasets(me),items=[],itemsHash={},dsdid;for(dsdid in datasets){var dataset=datasets[dsdid],dsn=dataset.name,itms=filterDatasetsUnits([].concat(dataset.mx).concat(dataset.att)),len=itms.length,i;for(i=0;i<len;i++){var itm=itms[i];itm.dsdid=dsdid;itm.path=dsn;if(!itemsHash[itm.did]){itemsHash[itm.did]=itm;}}}items=$HASH.valarray(itemsHash);return{items:items,isComplete:true,bc:-1};}function filterDatasetsUnits(items){return mstrmojo.array.filter(items,function(item){return item.st!==E.STP.CONS&&item.st!==E.STP.CUSTOMGROUP&&item.did!==IDE.metricId;});}function getIDE(){return mstrmojo.all.mstrMetricIDE;}mstrmojo.ME.DerivedMetricIDE=mstrmojo.declare(mstrmojo.ME.MetricIDE,null,{scriptClass:"mstrmojo.ME.DerivedMetricIDE",isDME:true,noCache:false,disableAFB:false,getEditorScriptClass:function getMEScriptClass(editorId){return{mstrFE:"mstrmojo.ME.DerivedFunctionWizard",mstrSME:"mstrmojo.ME.DerivedSimpleMetricEditor",mstrME:"mstrmojo.ME.DerivedFormulaMetricEditor",mstrRFE:"mstrmojo.ME.DerivedRankEditor",mstrOFE:"mstrmojo.ME.DerivedOLAPEditor"}[editorId];},filterFunctions:function filterFunctions(fcts){var dm_cat_index=mstrmojo.ME.MetricDataService.getDataMiningCatIndex(fcts),dm_cat_did=dm_cat_index>-1?fcts[dm_cat_index].did:"";var fns2exclude={"1762CA4760014C78B365C868019C6F3E":"HistogramMedian"};return mstrmojo.array.filter(fcts,function(fct){if(fct.did!==dm_cat_did){var fns=fct.fns;fct.fns=mstrmojo.array.filter(fns,function(fn){return(!fn.idbo&&fn.ip)&&!fns2exclude[fn.did];});return fct;}});},onOpen:function onOpen(){this.set("datasets",getDocumentDatasets(this));this.set("dsUnits",getDocumentDatasetsUnits(this));this.set("feParamItemsPath","mstrmojo.all.mstrMetricIDE.dsUnits.items");this.set("candidates",getDocumentDatasetsUnits(this));if(this._super){this._super();}},init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"dme");IDE=this;},setExtraMetricTokens:function setExtraMetricTokens(tokensOi){if(mstrmojo.string.isEmpty(tokensOi.n)){tokensOi.n=this.action.n||mstrmojo.desc(2213,"New Metric");}tokensOi.alias=tokensOi.alias||this.action.alias;},setRefOi:function(cfg){cfg.refOi=this.action&&this.action.refOi;},renderObjectsBrowser:function renderObjectsBrowser(){var dso=this.datasetsObjects;if(dso){dso.alias="ob";dso.bindings={visible:function(){return mstrmojo.all.mstrME.visible;}};dso.onvisibleChange=function(){if(this.visible){var me=this;window.setTimeout(function(){if(me.doLayout){me.doLayout();}},50);}};dso.doubleClickItemHandler=function(item){getIDE().onObjectInsert(item);};this.getBrowsersContainer().addChildren([dso]);}}});}());