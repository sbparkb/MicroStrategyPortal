(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper","mstrmojo.ui.ScrollableSuggestionList");var E=mstrmojo.expr,STATES=mstrmojo.Enum_OIB_States,MEH=mstrmojo.ME._MetricEditorHelper,$D=mstrmojo.dom;mstrmojo.ME.ObjectInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{cssClass:"",autoSelect:false,suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",suggestionPopupCssClss:"mstrmojo-ME-ObjectInputBox-suggest",blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,useKeyDelay:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,emptyText:"Search for an object",showEmptyItem:false,noEditButton:true,browseItemVisible:true,click2edit:true,showSuggestionOnEdit:false,tabNavigable:true,obCfg:{},dynamicVerify:true,init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-ObjectInputBox");if(this.isDME){this.browseItemVisible=!this.isDME;this.suggestCount=this.isDME?1000:mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=1000;this.dynamicVerify=false;}},item2textCss:function item2textCss(data){if(this.isDME){return mstrmojo.ME._MetricEditorHelper.item2textCss(data);}var cls=this._super(data)||{1:"f",4:"m",12:"a",13:"fc",43:"tr","-1":"rl","-99":"br"}[data.t]||"";return cls?" icn "+cls:"";},itemFunction:function itemFunction(item,idx,w,itemScriptClass){item[w.itemIdField]=w.nextId();var Cls=itemScriptClass||mstrmojo.ME.ObjectItem,c=new Cls({parent:w,itemField:w.itemField,cssClass:w.item2textCss(item),data:item,bindings:{isFull:"this.parent.isFull"},onisFullChange:function(){if(this.hasRendered){this.updateButtonsVisibility();}}});w.attachEventListener4ItemWidget(c,w);return c;},getActiveItem:function getActiveItem(){var eidx=this.editingIdx,activeInput,activeItem;if(eidx>-1){activeInput=this.ctxtBuilder.itemWidgets[eidx];activeItem=activeInput&&activeInput.data;}return activeItem;},showObjectBrowser:function(c){this.set("suggestTarget",c);this.handleSuggestionItemSelect({t:-99},this.obCfg);},hideItemWidgetBrowseButton:function hideItemWidgetBrowseButton(){return false;},hidePulldownButton:function hidePulldownButton(){return true;},hideDelButton:function hideDelButton(){return false;},dtp:0,verifyObject:function verifyObject(t,w){if(!this.dynamicVerify){return STATES.VALID;}var data=w.data;var dtp=parseInt(this.dtp,10);switch(dtp){case -1:case -2:case -4:case -5:case -6:if(data.t===-1||MEH.isDimty(t,dtp===-1)){return STATES.VALID;}if(this.dynamicVerify){return this._super(t,w);}return data.did?STATES.VALID:STATES.INVALID;case 1:case 2:case 3:case 4:case 5:case 6:case 7:if(data.t<0){return STATES.VALID;}if(/^\d{1,}$/.test(mstrmojo.string.trim(t))||data.did){return STATES.VALID;}if(this.dynamicVerify){return this._super(t,w);}return STATES.INVALID;default:return STATES.VALID;}},getItemsToFilterOut:function getItemsToFilterOut(){return this.items;},updateSuggestion:function updateSuggestion(its){var activeItem=this.getActiveItem();var currItems=this.getItemsToFilterOut();its=mstrmojo.array.filter(its,function(item){var did=item.did,inCollection=false,retVal;var f=function(id){mstrmojo.array.forEach(currItems,function(currItem){if(currItem!==activeItem&&currItem.did===id){inCollection=true;return false;}});};f(did);if(!inCollection){retVal=item;}return retVal;});if(this._super){this._super(its);}},nudge:function nudge(popup){popup.domNode.style.minWidth=this.suggestTarget.domNode.offsetWidth+(this.isDME?13:0)+"px";var popPos=$D.position(popup.domNode),tgtPos=$D.position(this.suggestTarget.domNode),winDim=$D.windowDim();if(popPos.y+popPos.h>winDim.h){popup.domNode.style.top=(tgtPos.y-popPos.h-5)+"px";}}});mstrmojo.ME.ObjectItem=mstrmojo.declare(mstrmojo.ObjectItem,[mstrmojo._HasPopup],{markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode" tabindex="0" mstrAttach:click,focus><span class="mstrmojo-ObjectItem-text {@cssClass}"></span></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" placeholder="{@placeholderText}" mstrAttach:keyup,keydown/></div><div class="mstrmojo-ObjectItem-icons"><div class="mstrmojo-ObjectItem-down" onclick="mstrmojo.all[\'{@id}\'].showSuggestion(\'\')"></div><img class="mstrmojo-ObjectItem-browse" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1825,"Browse")+'" onclick="mstrmojo.all[\'{@id}\'].browse()"/><div class="mstrmojo-ObjectItem-opts" title="'+mstrmojo.desc(9598,"Level options")+'" onclick="mstrmojo.all[\'{@id}\'].options(arguments[0])" style="display:none;"></div><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])" style="display:none;"/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},pulldownButtonNode:function(){return this.domNode.lastChild.childNodes[0];},browseButtonNode:function(){return this.domNode.lastChild.childNodes[1];},optionButtonNode:function(){return this.domNode.lastChild.childNodes[2];},editButtonNode:function(){return this.domNode.lastChild.childNodes[3];},delButtonNode:function(){return this.domNode.lastChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},init:function init(props){this._super(props);this.placeholderText=this.parent.emptyText;},initState:function initState(){var p=this.parent,d=this.data,s=d.state;if(p.dynamicVerify){return this._super();}if(typeof s==="undefined"){s=p.verifyObject(d[this.itemField],this);d.state=s;}return s;},updateButtonsVisibility:function updateButtonsVisibility(){if(this._super){this._super();}if(this.parent.hidePulldownButton()){this.pulldownButtonNode.style.display="none";}if(this.parent.hideItemWidgetBrowseButton()){this.browseButtonNode.style.display="none";}this.optionButtonNode.style.display=this.data.state!==STATES.ADDING&&this.optionButtonVisible?"":"none";this.delButtonNode.style.display=this.data.state!==STATES.ADDING&&!this.parent.hideDelButton()&&!this.isFull?"":"none";},browse:function browse(){this.set("state",this.data.state===STATES.ADDING?STATES.ADDING:STATES.EDITING);this.parent.showObjectBrowser(this);},click2edit:function click2edit(){if(this.parent.click2edit){this.edit();}},onclick:function onclick(){this.click2edit();},onfocus:function onfocus(){this.click2edit();}});}());