(function(){mstrmojo.requiresCls("mstrmojo.ValidationTextBox","mstrmojo.Calendar","mstrmojo.Popup","mstrmojo._HasPopup","mstrmojo.locales","mstrmojo.date","mstrmojo.string");var _MK=mstrmojo.ValidationTextBox.prototype.markupMethods,_S=mstrmojo.string,$DT=function(){return mstrmojo.locales.datetime;},$Date=mstrmojo.date;mstrmojo.DateTextBox=mstrmojo.declare(mstrmojo.ValidationTextBox,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DateTextBox",calendarToBody:false,calendarZIndex:100,changeValueOnOK:false,dynDateValue:null,showAdvanced:false,canSelectDisabledDate:false,isList:false,dtp:14,defaultDate:null,autoFormat:true,enabled:true,min:"",max:"",markupString:'<div id="{@id}" class="mstrmojo-DateTextBox {@cssClass}" style="{@cssText}"><input class="mstrmojo-DateTextBox-input" type="text" title="{@tooltip}"value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur /><div class="mstrmojo-DateTextBox-icon" mstrAttach:click> </div><div class="mstrmojo-DateTextBox-popup"></div></div>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.childNodes[1];},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},onwidthChange:function(){if(this.width){this.inputNode.style.width=(this.width-20)+"px";this.iconNode.style.left=(this.width-18)+"px";this.domNode.style.width=this.width+"px";}},onvalueChange:_MK.onvalueChange,onenabledChange:_MK.onenabledChange,onvalidationStatusChange:_MK.onvalidationStatusChange},calConfig:null,calendar:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DateTextBox-calendar",locksHover:true,slot:"popupNode",onOpen:function(){var o=this.opener,z=o&&o.calendarZIndex,c=this.cal,cfg=o&&o.calConfig;if(z){this.domNode.style.zIndex=z;}for(var k in cfg){c.set(k,cfg[k]);}},children:[{scriptClass:"mstrmojo.Calendar",alias:"cal",forceNonEmptySelection:true,bindings:{showAdvanced:"this.parent.opener.showAdvanced",dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",dynDateValue:"this.parent.opener.dynDateValue",enabled:"this.parent.opener.enabled",min:"this.parent.opener.min",max:"this.parent.opener.max",canSelectDisabledDate:"this.parent.opener.canSelectDisabledDate",changeValueOnOK:function(){var dtp=this.parent.opener.dtp,cv=this.parent.opener.changeValueOnOK;return dtp===15||dtp===16||cv;}},closeOnValueChange:true,onValueUpdate:function(evt){var op=this.parent&&this.parent.opener;if(op){var v=op.value,ls=window.mstrConfig&&window.mstrConfig.listSep||";",newValue=op.dtp===15?$Date.formatTimeInfo(this.timeVal,$DT().TIMEOUTPUTFORMAT):this.value;if(op.isList&&!_S.isEmpty(v)){op.set("value",op.value+ls+newValue);}else{op.set("dynDateValue",this.dynDateValue);op.set("value",newValue);}op.closePopup();}}}]},onclick:function(evt){var p=this._lastOpened,c=this._calendarConfig;if(!c){c={};if(this.calendarToBody){delete this.calendar.slot;c.placeholder=document.body.appendChild(document.createElement("div"));c.nudge=function(){var op=this.opener;if(op){var p=mstrmojo.dom.position(op.popupNode,true),domNode=this.domNode,height=domNode.offsetHeight,width=domNode.offsetWidth,windowDimensions=mstrmojo.dom.windowDim(),left=p.x,top=p.y;if(top+height>=windowDimensions.h){top=Math.max(top-height,0);}if(left+width>=windowDimensions.w){left=Math.max(left-width,0);}var nodeStyle=domNode.style;nodeStyle.top=top+"px";nodeStyle.left=left+"px";}};}this._calendarConfig=c;}c.lockIW=this;if(p&&p.visible){this.closePopup();}else{this.openPopup("calendar",c);this.calendar.cal.updateSelectedDate(true);}},unrender:function(){this._super();if(this.calendarToBody&&this._calendarConfig){delete this._calendarConfig;}if(this.calendar.hasRendered){this.calendar.unrender();}},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){this.value=v;this.validate(v);}if(this.showAdvanced&&this.dynDateChanged){this.dynDateChanged=false;bChanged=true;}return bChanged;},_set_dynDateValue:function(n,v){var vWas=this.dynDateValue,bChanged=(vWas!==v);if(bChanged){this.dynDateValue=v;this.dynDateChanged=true;}return bChanged;}});})();