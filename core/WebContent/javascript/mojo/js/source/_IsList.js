(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var $DOM=mstrmojo.dom,$CSS=mstrmojo.css,CLASS_SELECTED="selected";function delegateSelect(mthName,el,item,idx,widget){var hook=widget.listHooks[mthName];if(hook&&hook.call(widget,el,item,idx)){return ;}$CSS.toggleClass(el,CLASS_SELECTED,mthName==="select");}function addToCollection(propertyName,delimiter,values){var existing=this[propertyName],arr=existing?existing.split(delimiter):[];this[propertyName]=mstrmojo.array.distinct(arr.concat(values.split(delimiter))).join(delimiter);}mstrmojo._IsList=mstrmojo.provide("mstrmojo._IsList",{_mixinName:"mstrmojo._IsList",listHooks:{},useListModKeys:false,init:function init(props){this._super(props);this._shiftStartIndex=-1;},getItemMarkup:function getItemMarkup(item,idx){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@en@n}</{@tag}>';},getItemDisplayName:function getItemDisplayName(item){return item.n||"";},getItemProps:function getItemProps(item,idx){var isSelected=!!this.selectedIndices[idx],itemProps={tag:"div",sel:isSelected,cls:"",n:this.getItemDisplayName(item),style:"",idx:idx,addCls:function addCls(cls){addToCollection.call(this,"cls"," ",cls);},addStyle:function addStyle(s){addToCollection.call(this,"style",";",s);},title:item.title||""};if(isSelected){itemProps.addCls(CLASS_SELECTED);}var itemClass=item.cls;if(itemClass){itemProps.addCls(itemClass);}return itemProps;},itemRenderer:{render:function render(item,idx,widget){item._renderIdx=idx;return mstrmojo.string.apply(widget.getItemMarkup(item,idx),widget.getItemProps(item,idx));},select:function select(el,item,idx,widget){delegateSelect("select",el,item,idx,widget);},unselect:function unselect(el,item,idx,widget){delegateSelect("unselect",el,item,idx,widget);}},onclick:function onclick(evt){try{var item=this.getItemFromTarget(evt.getTarget());if(item){evt.cancel();this.doItemSelect(item,evt||{});}}catch(ex){mstrApp.onerror(ex);}},doItemSelect:function doItemSelect(item,evt){var hWin=evt.hWin,e=evt.e,idx=item._renderIdx,pos=item._positionIdx,isMetaKey=$DOM.isMetaKey(hWin,e),isShiftKey=$DOM.shiftKey(hWin,e),allowMultiSelect=this.multiSelect,useListModKeys=this.useListModKeys,rangeStartIndex=this._shiftStartIndex,selectedIndices=this.selectedIndices;if(allowMultiSelect&&useListModKeys&&isShiftKey&&rangeStartIndex>-1){var adding=[],removing=[],startIdx=Math.min(rangeStartIndex,idx),endIdx=Math.max(rangeStartIndex,idx),i;for(i=0;i<this.items.length;i++){if(startIdx<=i&&i<=endIdx){if(!selectedIndices[i]){adding.push(i);}}else{if(selectedIndices[i]){removing.push(i);}}}this.addSelect(adding);this.removeSelect(removing);}else{if(allowMultiSelect&&(!useListModKeys||isMetaKey)){var methodName=(selectedIndices[idx])?"remove":"add";this[methodName+"Select"](idx,false,pos);}else{this.singleSelect(idx,false,pos);}this._shiftStartIndex=idx;}},onclearSelection:function onclearSelection(){this._shiftStartIndex=-1;},getItemNodeFromTarget:function getItemNodeFromTarget(target){var node=$DOM.findAncestorByAttr(target,"idx",true,this.domNode);return(node&&node.node)||null;},getItemFromTarget:function getItemFromTarget(target){var node=this.getItemNodeFromTarget(target),idx=node&&parseInt(node.getAttribute("idx"),10);if(idx!==null&&!isNaN(idx)&&this.items){return this.items[idx];}return undefined;}});mstrmojo._IsList.SELECTED_CLS=CLASS_SELECTED;}());