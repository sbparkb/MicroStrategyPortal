(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.fx","mstrmojo.TreeNode");var _D=mstrmojo.dom,NODE_STATE_CSS_MAP={0:"closed",1:"opened",2:"leaf"},_animContainerNode=function(icn,toExpand){var cns=icn.style,expHeight,hNew,hStart,dNew,anim;cns.display="block";cns.height="auto";expHeight=icn.offsetHeight;hNew=toExpand?expHeight:0;hStart=toExpand?0:expHeight;dNew=toExpand?"block":"none";cns.overflow="hidden";anim=new mstrmojo.fx.AnimateProp({target:icn,props:{height:{start:hStart,stop:hNew,suffix:"px",fn:Math.round,ease:mstrmojo.ease.linear}},onEnd:function(){cns.height="auto";cns.display=dNew;},interval:30,duration:300});anim.play();};mstrmojo.TreeBrowserNode=mstrmojo.declare(mstrmojo.TreeNode,null,{scriptClass:"mstrmojo.TreeBrowserNode",markupString:'<div id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,click,dblclick><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><img class="mstrmojo-TreeNode-checkBox" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><div class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</div></div>',markupSlots:mstrmojo.hash.copy({displayNode:function(){return this.domNode.firstChild;},checkBoxNode:function(){return this.domNode.firstChild.childNodes[1];}},mstrmojo.TreeNode.prototype.markupSlots),markupMethods:mstrmojo.hash.copy({onstateChange:function(init){this.stateNode.className="mstrmojo-TreeNode-state "+(NODE_STATE_CSS_MAP[this.state]||"closed");if(this.tree.anim&&this.contentRetrieved&&!init){_animContainerNode(this.itemsContainerNode,this.state===1);}else{this.itemsContainerNode.style.display=(this.state===1)?"block":"none";}}},mstrmojo.TreeNode.prototype.markupMethods),blockBegin:1,allowUnlistedValues:false,contentRetrieved:false,_set_items:function(n,v){var result=this._super(n,v);if(result&&this.tree.anim){_animContainerNode(this.itemsContainerNode,true);}return result;},onstateChange:function onstateChange(){var t=this.tree;if(!this.contentRetrieved&&(this.state==1)){this.set("items",[t.loadingItemCreaterFunc()]);t.getContent(this,this.blockBegin);}else{if((this.state==1)&&t.onNodeExpand){t.onNodeExpand(this);}if((this.state==0)&&t.onNodeCollapse){t.onNodeCollapse(this);}}},toggleState:function toggleState(){if(this.state!==2){this.set("state",this.state===1?0:1);}},preclick:function preclick(evt){_D.clearBrowserHighlights(evt.hWin);return false;},predblclick:function predblclick(evt){_D.clearBrowserHighlights(evt.hWin);return false;},premousedown:function pmd(evt){var D=mstrmojo.dom,t=mstrmojo.dom.eventTarget(evt.hWin,evt.e),tree=this.tree,isLeaf=(this.state==2),icn=D.contains(this.itemsContainerNode,D.eventTarget(evt.hWin,evt.e),true,this.domNode),toggleOnClick=(tree.branchClickPolicy==mstrmojo.TreeBrowserEnum.BRANCH_POLICY_TOGGLE);if((this.isSpecialNode()||!(t==this.checkBoxNode||((t==this.textNode||t==this.displayNode)&&(isLeaf||!toggleOnClick))))&&!this.draggable){D.stopPropogation(evt.hWin,evt.e);}if((t==this.stateNode)||((t==this.textNode||t==this.displayNode)&&!isLeaf&&toggleOnClick)){if(!isLeaf){this.toggleState();}}else{if(t==this.checkBoxNode||icn){if(this._super){this._super(evt);}}else{this.handleNodeClicked();}}},isSpecialNode:function isSpecialNode(){var st=this.data&&this.data.st;return(st<0);},handleNodeClicked:function handleNodeClicked(){var tree=this.tree,w=this.parent,data=this.data;switch(data&&data.st){case"-4":mstrmojo.css.addClass(this.textNode,["loading"]);tree.getContent(w,w.blockBegin-tree.blockCount);break;case"-3":mstrmojo.css.addClass(this.textNode,["loading"]);tree.getContent(w,w.blockBegin+tree.blockCount);break;case"-1":case"-2":break;default:if(tree.handleNodeClicked){tree.handleNodeClicked(data);}}},init:function(props){this._super(props);this.set("state",this.tree.isBranch(this.data)?0:2);},postBuildRendering:function postBuildRendering(){if(this._super){this._super();}var _handler=function(e){_D.preventDefault(window,e||window.event);return false;};_D.attachEvent(this.domNode,"mousedown",_handler);if(this.isSpecialNode()||this.tree.noCheckBox){this.checkBoxNode.style.display="none";}}});})();