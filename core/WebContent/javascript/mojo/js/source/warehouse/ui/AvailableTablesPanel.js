(function(){mstrmojo.requiresCls("mstrmojo.ui.SearchablePulldown","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.NameSpacePullDown","mstrmojo.warehouse.ui.SearchBox");mstrmojo.requiresDescs(12260,9142,12259);var $A=mstrmojo.array,$CSS=mstrmojo.css,CSS_PREFIX="mstrmojo-wh-",$DOM=mstrmojo.dom,STR_NUM_TABLES=mstrmojo.desc(12260,"%% Tables, Last cache update: $$"),STR_AVAIL_TABLES=mstrmojo.desc(9142,"Available Tables"),STR_CATALOG_SQL=mstrmojo.desc(12259,"Catalog SQL"),$ENUM_DATA_CHANGE_EVENTS=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.ui.AvailableTablesPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",cssClass:"AvailableTables",title:STR_AVAIL_TABLES,dbTableTree:undefined,searchBox:undefined,nameSpaces:undefined,catalogSQLBtn:undefined,refreshBtn:undefined,catSQL:undefined,useRichTooltip:true,showTooltip:function showTooltip(evt,win){var target=evt.target||$DOM.eventTarget(evt.hWin,evt.e);if(target===this.titleNode||target===this.titleTextNode){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.titleNode,top:32,content:this.titleTooltip};this._super(evt,win);}},init:function init(props){this._super(props);var searchBox=this.searchBox,dbTableTree=this.dbTableTree;searchBox.attachEventListener("searchTriggered",this.id,function(evt){dbTableTree.userSelections={};mstrApp.getRootController().availableTableSearch(evt.searchValue);});this.addNewTitleButton({alias:"catalogSQLBtn",title:STR_CATALOG_SQL,cssClass:CSS_PREFIX+"catalogSQL hidden",onclick:function onclick(){mstrApp.getRootController().displayCatalogSQL();}});var $this=this,evtConfig={},listConfig=evtConfig[this.id]={};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBTABLES_CHANGED]=function(evt){$this.set("titleTooltip",STR_NUM_TABLES.replace("%%",evt.items.length.toString()).replace("$$",evt.src.catalogStamp||""));};listConfig[$ENUM_DATA_CHANGE_EVENTS.DBROLE_SELECTION]=function(evt){var $this=this,dbr=evt.src.dbrs[$A.find(evt.src.dbrs,"did",evt.value)];searchBox.tableBox.refreshBtn.set("visible",false);if(dbr){dbr.populate(function success(res){searchBox.clearSearch(true);$CSS.toggleClass($this.catalogSQLBtn.domNode,"hidden",!(mstrApp.getRootController().canDisplayCatalogSQL(evt.src.dbObjects.dbTypes,res.mdDBRole.db_type)));searchBox.tableBox.refreshBtn.set("visible",searchBox._preSearch?searchBox._preSearch():false);});}else{if(!evt.value){searchBox.clearSearch(true);$CSS.toggleClass($this.catalogSQLBtn.domNode,"hidden",true);}}};mstrApp.getRootController().attachDataChangeListeners(evtConfig);},onheightChange:function onheightChange(e){if(!this.nameSpaces.heightOffset){this.nameSpaces.heightOffset=21;}if(!this.heightOffset){this.heightOffset=85;}this.dbTableTree.set("height",parseInt(e.value,10)-this.heightOffset-(this.nameSpaces.visible?this.nameSpaces.heightOffset:0)+"px");},onwidthChange:function onwidthChange(evt){if(!this.searchBox.widthOffset){this.searchBox.widthOffset=0;}var width=parseInt(evt.value,10);this.searchBox.set("width",width-6-this.searchBox.widthOffset+"px");this.nameSpaces.set("width",width-12+"px");},children:[{alias:"nameSpaces",scriptClass:"mstrmojo.warehouse.ui.NameSpacePullDown",sourceInfo:"tablesPanel",nameSpacesLoaded:function nameSpacesLoaded(){this.parent.searchBox.clearSearch(true);this.parent.onheightChange({value:this.parent.height});},onItemSelectedCallback:function onItemSelectedCallback(item){var searchBox=this.parent.searchBox;searchBox.clearSearch(true);mstrApp.getRootController().setNameSpaceID(item.n);searchBox.tableBox.refreshBtn.set("visible",searchBox._preSearch?searchBox._preSearch():false);}},{scriptClass:"mstrmojo.warehouse.ui.SearchBox",alias:"searchBox",_preSearch:function _preSearch(){if(this.parent.nameSpaces.visible){return(this.parent.nameSpaces.selectedIndex!==undefined);}return true;},_onRefresh:function _onRefresh(){this.clearSearch(true);mstrApp.getRootController().handleDBTableRefresh();}},{alias:"dbTableTree",scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",sourceInfo:"tablesPanel",renderOnScroll:true}]});}());