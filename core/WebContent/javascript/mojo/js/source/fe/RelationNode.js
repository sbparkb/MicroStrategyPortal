(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsExprNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo._HasPopup","mstrmojo.fe.AndOrNode","mstrmojo.fe.DynamicNode","mstrmojo.ConditionNode","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.hash","mstrmojo.expr");var _C=mstrmojo.css,_D=mstrmojo.dom,_H=mstrmojo.hash,getAttrSetText=function(me){var d=me.data,dmy=d.dmy&&d.dmy.uts||[],len=dmy.length,txt=[],i;for(i=0;i<len;i++){txt.push(dmy[i].n);}return'<span class="mstrmojo-text">'+txt.join(", ")+"</span>";};mstrmojo.fe.RelationNode=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsExprNode,mstrmojo.fe._IsRelationTreeNode,mstrmojo._HasPopup],{scriptClass:"mstrmojo.fe.RelationNode",markupString:'<div id="{@id}" class="mstrmojo-relation {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-relation-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-relation-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}"><span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-relationNode"><span class="mstrmojo-relationNode-inf"><span class="mstrmojo-relation-prefix-text">'+mstrmojo.desc(2790,"Set of").replace(/##/g,"")+'</span><span class="mstrmojo-textset"  mstrAttach:click></span><span class="mstrmojo-relation-postfix-text">'+mstrmojo.desc(2793,"Where").replace(/##/g,"")+'</span><span class="mstrmojo-relation-convert-text"  mstrAttach:click >'+mstrmojo.desc(null,"Convert to Condition")+'</span><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'"onclick="mstrmojo.all[\'{@id}\'].del()" /></span><div class="mstrmojo-relation-childTreeNode" style="position:relative;"></div></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},relationNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[1];},convertNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[3];},containerNode:function(){return this.domNode.childNodes[1].childNodes[1];}},markupMethods:{onprefixedAndOrEditableChange:function(){_C.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){_C.toggleClass(this.relationNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=getAttrSetText(this);}},noRelationOperator:true,children:[{scriptClass:"mstrmojo.fe.RelationFilterExprTree",alias:"childTree",ignoreLayout:true,dropZone:false,draggable:false,nodeClassMap:{14:mstrmojo.fe.AndOrNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},onNew:function(inf){this.parent.tree.onNew(inf);},getItemConfig:function(item,idx,widget){var config=mstrmojo.fe.RelationFilterExprTree.prototype.getItemConfig.call(this,item,idx,widget),t=widget.tree||widget;return _H.copy({tree:t,rootTree:this.parent.tree,noRelation:true,inRelation:true},config);},prenodeclick:function(evt){if(!evt||!evt.part){return ;}var t=this.rootTree;if(t&&t.onnodeclick&&this.editable){evt.editor=t.editor;t.onnodeclick.call(this,evt);}}}],premousedown:function(evt){if(this._super){this._super(evt);}var el=_D.eventTarget(evt.hWin,evt.e);if(!_D.contains(this.childTree.domNode,el,true)){this.childTree.clearTreeSelect();}},preselectedChange:function(evt){if(!evt.value){this.childTree.clearTreeSelect();}},init:function(props){this._super(props);var d=this.data;if(d){delete this.data;this._set_data(null,d);}},_set_data:function(n,v){var vWas=this.data,chg=(vWas!==v);if(chg){this.data=v;if(v){this.childTree.set("items",v.nds||[v]);}}return chg;},isSelectableArea:function(el){return mstrmojo.dom.contains(this.relationNode,el,true);},preclick:function pc(evt){var p=null,t=_D.eventTarget(evt.hWin,evt.e);if(_D.contains(this.prefixNode,t,true)){p="andor";}else{if(_D.contains(this.textNode,t,true)){p="createSet";}else{if(_D.contains(this.convertNode,t,true)){this.parent.removeSet(this);return false;}}}evt.part=p;},del:function del(){var p=this.parent;if(p&&p.remove&&this.data){p.remove(this.data);}},newCondition:function newCondition(c){this.childTree.newCondition(c);},avatarCssCls:"mstrmojo-FE mstrmojo-relationNode",getAvatarNode:function(){return this.relationNode.cloneNode(true);}});})();