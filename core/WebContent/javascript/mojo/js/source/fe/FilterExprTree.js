(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.hash","mstrmojo.FilterExpr");var $H=mstrmojo.hash,_ET=mstrmojo.expr.ET;mstrmojo.fe.FilterExprTree=mstrmojo.declare(mstrmojo.FilterExpr,null,{scriptClass:"mstrmojo.fe.FilterExprTree",allowCopy:false,containerResizable:false,draggable:true,dropZone:true,editable:true,makeObservable:true,onConditionEdit:mstrmojo.emptyFn,modifyConditionNode:function(cond,newData){var data=cond.data,isNew=data.isNew;$H.copy($H.clone(newData),$H.clear(data));delete data.isNew;cond.paint();if(data.et===_ET.MQ||data.et===_ET.MC){cond.set("noCreateSet",true);}if(cond.tree.onConditionEdit){cond.tree.onConditionEdit(cond,isNew);}},getItemConfig:function(item,idx,widget){var config=this._super(item,idx,widget),t=widget.tree;return $H.copy({onclick:t.prenodeclick,containerResizable:t.containerResizable,ondragend:t.ondragend,ondrop:t.ondrop},config);},ondragenter:function ondragenter(context){this.dropCuePos={left:0,top:0,idx:0,idxActual:0};this._super(context);},ondragend:function(ctx){if(this===this.tree){return this._super(ctx);}else{return this.constructor.prototype.ondragend.call(this,ctx);}},ondrop:function(ctx){if(this===this.tree){return this._super(ctx);}else{return this.constructor.prototype.ondrop.call(this,ctx);}},isEditable:function isedt(item){if(!this.editable){return false;}var _result=false;switch(item&&item.et){case _ET.R:case _ET.F:_result=false;break;case _ET.ANDOR:case _ET.MQ:case _ET.AQ:case _ET.AL:case _ET.AC:case _ET.MC:case _ET.AE:_result=true;break;case _ET.XML:_result=!item.xml||!!item.ph;}return _result;},prenodeclick:function(evt){if(!evt||!evt.part){return ;}if(evt.part!=="createSet"&&evt.part!=="createSetOpt"&&!(evt.part==="andor"?this.prefixedAndOrEditable:this.editable)){return ;}var t=this.tree;if(t.onnodeclick){t.onnodeclick.call(this,evt);}},getSelectedItemWidget:function(){var findWidgetWithSelectedIndex=function(widget){var itemsWidgets=widget&&widget.ctxtBuilder&&widget.ctxtBuilder.itemWidgets,idx=widget.selectedIndex,len=itemsWidgets&&itemsWidgets.length||0;if(!itemsWidgets){return ;}if(idx===-1){for(var i=0;i<len;i++){var sel=findWidgetWithSelectedIndex(itemsWidgets[i]);if(sel){return sel;}}}else{return itemsWidgets[idx];}};return findWidgetWithSelectedIndex(this);}});})();