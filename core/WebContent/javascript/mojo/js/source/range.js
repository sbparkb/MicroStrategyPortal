(function(){function prevTextNode(node,include,stopNode){if(node.nodeType===3&&include){return node;}else{var ns=(include&&node.nodeType===1&&node.lastChild)?node.lastChild:prevSib(node,stopNode);return ns?prevTextNodeIncluding(ns,stopNode):null;}}function prevSib(node,stopNode){return(node===stopNode)?null:(node.previousSibling||prevSib(node.parentNode,stopNode));}function prevTextNodeIncluding(node,stopNode){if(node===stopNode){return null;}if(node.nodeType===3&&getTextContent(node)){return node;}else{if(node.nodeType===1&&node.lastChild){return prevTextNodeIncluding(node.lastChild);}else{return prevTextNodeIncluding(prevSib(node,stopNode));}}}function getTextContent(node){return node.textContent||node.nodeValue||node.innerText;}function nextTextNode(node,include,stopNode){if(node.nodeType===3&&include){return node;}else{var ns=(include&&node.nodeType===1&&node.firstChild)?node.firstChild:nextSib(node,stopNode);return ns?nextTextNodeIncluding(ns,stopNode):null;}}function nextSib(node,stopNode){return(node===stopNode)?null:(node.nextSibling||nextSib(node.parentNode,stopNode));}function nextTextNodeIncluding(node,stopNode){if(node===stopNode){return null;}if(node.nodeType===3&&getTextContent(node)){return node;}else{if(node.nodeType===1&&node.firstChild){return nextTextNodeIncluding(node.firstChild);}else{return nextTextNodeIncluding(nextSib(node,stopNode));}}}mstrmojo.range=mstrmojo.provide("mstrmojo.range",{EDGE:{EDGE_BEGIN:1,EDGE_END:2,EDGE_MIDDLE:-1},getEdgeInfo:function getEdgeInfo(node,offset){var l=0,range;if(node.nodeType===1){if(window.getSelection){range=document.createRange();range.selectNode(node);l=range.toString().length;}else{range=document.body.createTextRange();range.moveToElementText(node);l=range.text.length;}}else{l=getTextContent(node).length;}return offset===l?this.EDGE.EDGE_END:(offset===0?this.EDGE.EDGE_BEGIN:this.EDGE.EDGE_MIDDLE);},collapseOnNode:function collapseOnNode(node,toStart){if(!node.offsetParent){return ;}var selection=this.getSelection(),range=this.getRange();if(window.getSelection){range.selectNodeContents(node);range.collapse(toStart);selection.removeAllRanges();selection.addRange(range);}else{range.moveToElementText(node);range.collapse(toStart);range.select();}},collapseOnTextNode:function collapseOnTextNode(node,offset){var selection=this.getSelection(),range=this.getRange();if(window.getSelection){var tn=nextTextNode(node,true);range.setStart(tn,offset);range.collapse(true);selection.removeAllRanges();selection.addRange(range);}else{range.moveToElementText(node);range.collapse(true);range.move("character",offset);range.select();}},collapseOnTextNodeIE:function collapseOnTextNodeIE(node,offset){var n=nextTextNode(node,true),l;while(n!==null){l=getTextContent(n).length;if(l>=offset){this.collapseOnTextNode(n,offset);break;}else{offset-=l;n=nextTextNode(n,false);}}},getRangeInfo:function getRangeInfo(editNode,saveRange){var rInfo=null,selection,range=this.getRange(),range2;if(editNode&&editNode===range.startContainer){var item=range.startContainer.firstChild,tse=item&&item.firstChild,txt=tse&&tse.firstChild;if(txt){range.setStart(txt,range.startOffset);range.setEnd(txt,range.endOffset);}}if(window.getSelection){var gos=function(r,c,start){var r2=r.cloneRange();r2.collapse(start);r2.setStartBefore(c);return r2.toString().length;},sc=range.startContainer,so=range.startOffset;if(sc.nodeType===1){so=gos(range,sc,true);}rInfo={collapsed:range.collapsed,startContainer:sc,startOffset:saveRange?saveRange.startOffset:so};if(!range.collapsed){var ec=range.endContainer,eo=range.endOffset;if(ec.nodeType===1){eo=gos(range,ec,false);}rInfo.endContainer=ec;rInfo.endOffset=eo;}rInfo.range=range;}else{var pe,range3,fo=function(r,start){var r2=r.duplicate(),range2=document.body.createTextRange(),pe;r2.collapse(start);pe=r2.parentElement();range2.moveToElementText(pe);range2.setEndPoint("EndToStart",r2);return{container:pe,offset:range2.text.length};},si=fo(range,true),ei;rInfo={collapsed:(range.compareEndPoints("StartToEnd",range)===0),startContainer:si.container,startOffset:si.offset};if(!rInfo.collapsed){ei=fo(range,false);rInfo.endContainer=ei.container;rInfo.endOffset=ei.offset;}}return rInfo;},collapse:function collapse(toStart){if(window.getSelection){var selection=this.getSelection();if(toStart){selection.collapseToStart();}else{selection.collapseToEnd();}}else{var range=this.getRange();range.collapse(toStart);range.select();}},selectSingleNode:function selectSingleNode(node){var selection=this.getSelection(),range=this.getRange();if(window.getSelection){range.selectNodeContents(node);selection.removeAllRanges();selection.addRange(range);}else{range.moveToElementText(node);range.select();}},selectMultipleNodes:function selectMultipleNodes(startContainer,startOffset,endContainer,endOffset){var selection=this.getSelection(),range=this.getRange();if(window.getSelection){range.setStart(startContainer,startOffset);range.setEnd(endContainer,endOffset);selection.removeAllRanges();selection.addRange(range);}else{startContainer=(startContainer.nodeType===3)?startContainer.parentNode:startContainer;range.moveToElementText(startContainer);range.move("character",startOffset);endContainer=(endContainer.nodeType===3)?endContainer.parentNode:endContainer;var range2=document.body.createTextRange();range2.moveToElementText(endContainer);range2.move("character",endOffset);range.setEndPoint("EndToStart",range2);range.select();}},getSelection:function getSelection(){if(window.getSelection){return window.getSelection();}else{return document.selection;}},getRange:function getRange(){if(window.getSelection){selection=window.getSelection();if(selection.rangeCount>0){return selection.getRangeAt(0);}else{return document.createRange();}}else{return document.selection.createRange();}}});}());