(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom");var $DOM=mstrmojo.dom;mstrmojo.gm.DndReplaceNode=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.gm.DndReplaceNode",markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}px;height:{@height}px;top:{@top}px;left:{@left}px;z-index:{@zIndex};position:absolute;"></div>',markupSlots:{nodesContainer:function(){return this.domNode;}},toggle:function toggle(show){if(show){this.nodesContainer.style.display="block";}else{this.nodesContainer.style.display="none";}},getBoundaryPosForAllNodes:function getBoundaryPosForAllNodes(){var i,nodesContainer=this.nodesContainer,nodesList=nodesContainer.children,nodesCnt=nodesList.length;if(nodesCnt<1){return{x:0,y:0,w:0,h:0};}var boundaryPos=$DOM.position(nodesList[0]),boundaryRight=boundaryPos.x+boundaryPos.w,boundaryBottom=boundaryPos.y+boundaryPos.h;if(nodesCnt===1){return boundaryPos;}for(i=1;i<nodesCnt;i++){var nodeDom=nodesList[i],nodePos=$DOM.position(nodeDom);boundaryRight=Math.max(boundaryRight,nodePos.x+nodePos.w);boundaryBottom=Math.max(boundaryBottom,nodePos.y+nodePos.h);boundaryPos.x=Math.min(boundaryPos.x,nodePos.x);boundaryPos.y=Math.min(boundaryPos.y,nodePos.y);}boundaryPos.w=boundaryRight-boundaryPos.x;boundaryPos.h=boundaryBottom-boundaryPos.y;return boundaryPos;},updateNodes:function updateNodes(nodes,containerPos,cssClass){var nodesContainer=this.nodesContainer,i,node,nodeDom,left,top,nodePos,setRotateStyle=function(nodeDom,degree,originX,originY){var style=nodeDom.style;if(originX&&originY){if(node.svgNodePos){originX=originX+node.svgNodePos.x-left;originY=originY+node.svgNodePos.y-top;}style.transformOrigin=originX+"px "+originY+"px";style.msTransformOrigin=originX+"px "+originY+"px";style.webkitTransformOrigin=originX+"px "+originY+"px";}style.transform="rotate("+degree+"deg)";style.msTransform="rotate("+degree+"deg)";style.webkitTransform="rotate("+degree+"deg)";};nodesContainer.innerHTML="";if(!nodes){return ;}this.toggle(true);for(i=0;i<nodes.length;i++){node=nodes[i];nodePos=node.nodePos;if(node.clonedNode){nodeDom=node.clonedNode;}else{nodeDom=document.createElement("div");nodeDom.innerHTML=node.nodeContent;}nodesContainer.appendChild(nodeDom);if(node.isMultipleTspan){nodePos.w=nodeDom.offsetWidth;nodePos.h=nodeDom.offsetHeight;}nodeDom.classList.add(this.nodeCss);if(cssClass){nodeDom.classList.add(cssClass);}left=Math.round(nodePos.x-Math.ceil((nodeDom.offsetWidth-nodePos.w)/2));top=Math.round(nodePos.y-Math.ceil((nodeDom.offsetHeight-nodePos.h)/2));nodeDom.style.left=(left-containerPos.x)+"px";nodeDom.style.top=(top-containerPos.y)+"px";var transform=node.transform;if(transform){var start=transform.indexOf("("),end=transform.indexOf(")");if(start>=0&&end>=0){var values=transform.substring(start+1,end).split(" "),degree=parseInt(values[0],10),originX,originY;if(values.length===3){originX=parseInt(values[1],10);originY=parseInt(values[2],10);}setRotateStyle(nodeDom,degree,originX,originY);}}}}});}());