(function(){mstrmojo.requiresCls("mstrmojo.dom");var $D=mstrmojo.dom,$MATH=Math;mstrmojo.gm._IsAnchorable={PLACEMENT_ABOVE:1,PLACEMENT_BELOW:2,PLACEMENT_LEFT:3,PLACEMENT_RIGHT:4,anchor:null,anchorPosition:null,boundary:null,boundaryPosition:null,popupNodeName:"infoNode",tipNodeName:"tipNode",baseTipClass:"arrow",infoNodeOffset:25,popupNodeOffset:0,placementOrder:[this.PLACEMENT_ABOVE,this.PLACEMENT_BELOW,this.PLACEMENT_LEFT,this.PLACEMENT_RIGHT],hasScrollbars:function hasScrollbars(){return(!mstrApp.isTouchApp||!mstrApp.isTouchApp());},positionDialog:function positionDialog(){if(!this.anchorPopup()){if(typeof this._super==="function"){this._super();}}},positionTipNode:function positionTipNode(position){var baseTipCls=this.baseTipClass,tipNode=this[this.tipNodeName];tipNode.className=baseTipCls+" "+position;},getTipDimension:function getTipDimension(){var tipNode=this[this.tipNodeName],tipPosition=$D.position(tipNode);return tipPosition;},anchorPopup:function anchorPopup(){this.positionTipNode("top");var anchor=this.anchor,boundary=this.boundary,popupNode=this[this.popupNodeName],infoNodeOffset=this.infoNodeOffset,popupNodeOffset=this.popupNodeOffset,hasScrollbars=this.hasScrollbars(),anchorPosition=this.anchorPosition||$D.position(anchor,true),boundaryPosition=this.boundaryPosition||$D.position(boundary,true),boundaryRight=boundaryPosition.w,boundaryBottom=boundaryPosition.h,popWidth=popupNode.offsetWidth,popHeight=popupNode.offsetHeight,halfPopWidth=popWidth/2,halfPopHeight=popHeight/2,tipPosition=this.getTipDimension(),tipDimensionShort=$MATH.min(tipPosition.h,tipPosition.w),tipHalfLong=$MATH.max(tipPosition.h,tipPosition.w)/2;if(hasScrollbars){boundaryRight-=15;boundaryBottom-=15;}var popupInsideBoundary=$D.contains(boundary,popupNode),offsetTop=popupInsideBoundary?0:boundaryPosition.y,popLeft=boundaryRight/2-halfPopWidth,popTop=boundaryBottom/2-halfPopHeight+offsetTop,tipLeft=-1000,tipTop=-1000;if(popupInsideBoundary){anchorPosition.x=anchorPosition.x-boundaryPosition.x;anchorPosition.y=anchorPosition.y-boundaryPosition.y;}var anchorBottom=anchorPosition.y+anchorPosition.h,anchorRight=anchorPosition.x+anchorPosition.w,fitsLeft=anchorPosition.x>popWidth,fitsRight=((anchorRight+popWidth)<boundaryRight),fitsAbove=anchorPosition.y>popHeight,fitsBottom=((anchorBottom+popHeight)<boundaryBottom),me=this,fnBounds=function(minVal,maxVal,desiredVal){return $MATH.min($MATH.max(minVal,desiredVal),$MATH.max(maxVal,0));},fnTopFit=function(){if((anchorPosition.x<boundaryRight)&&fitsAbove){var anchorMidWidth=anchorPosition.x+(anchorPosition.w/2);me.positionTipNode("bottom");tipTop=anchorPosition.y-tipDimensionShort-popupNodeOffset;popTop=tipTop-popHeight+infoNodeOffset;popLeft=fnBounds(0,boundaryRight-popWidth,anchorMidWidth-halfPopWidth);tipLeft=fnBounds(anchorPosition.x,anchorRight,anchorMidWidth)-tipHalfLong;return true;}return false;},fnBottomFit=function(){if((anchorPosition.x<boundaryRight)&&fitsBottom){var anchorMidWidth=anchorPosition.x+(anchorPosition.w/2);me.positionTipNode("top");tipTop=anchorBottom+popupNodeOffset;popTop=tipTop+tipDimensionShort-infoNodeOffset;popLeft=fnBounds(0,boundaryRight-popWidth,anchorMidWidth-halfPopWidth);tipLeft=fnBounds(anchorPosition.x,anchorRight,anchorMidWidth)-tipHalfLong;return true;}return false;},fnLeftFit=function(){if((anchorPosition.y<boundaryBottom)&&fitsLeft){var anchorMidHeight=anchorPosition.y+(anchorPosition.h/2);me.positionTipNode("right");tipLeft=anchorPosition.x-tipDimensionShort-popupNodeOffset;popLeft=tipLeft-popWidth+infoNodeOffset;popTop=fnBounds(offsetTop,boundaryBottom-popHeight,anchorMidHeight-halfPopHeight);tipTop=fnBounds(anchorPosition.y,anchorBottom,anchorMidHeight)-tipHalfLong;return true;}return false;},fnRightFit=function(){if((anchorPosition.y<boundaryBottom)&&fitsRight){var anchorMidHeight=anchorPosition.y+(anchorPosition.h/2);me.positionTipNode("left");tipLeft=anchorRight+popupNodeOffset;popLeft=tipLeft+tipDimensionShort-infoNodeOffset;popTop=fnBounds(offsetTop,boundaryBottom-popHeight,anchorMidHeight-halfPopHeight);tipTop=fnBounds(anchorPosition.y,anchorBottom,anchorMidHeight)-tipHalfLong;return true;}return false;},testFns=[],i;for(i=0;i<this.placementOrder.length;i++){switch(this.placementOrder[i]){case this.PLACEMENT_ABOVE:testFns.push(fnTopFit);break;case this.PLACEMENT_BELOW:testFns.push(fnBottomFit);break;case this.PLACEMENT_LEFT:testFns.push(fnLeftFit);break;case this.PLACEMENT_RIGHT:testFns.push(fnRightFit);break;}}for(i=0;i<testFns.length;i++){if(testFns[i]()){break;}}popTop=$MATH.round(popTop);popLeft=$MATH.round(popLeft);tipTop=$MATH.round(tipTop);tipLeft=$MATH.round(tipLeft);this.applyPopupNodePos(popTop,popLeft,tipTop,tipLeft);return true;},applyPopupNodePos:function applyPopupNodePos(popTop,popLeft,tipTop,tipLeft){var tipNode=this[this.tipNodeName],tipNodeStyle=tipNode.style,popupNode=this[this.popupNodeName],popupNodeStyle=popupNode.style;tipNodeStyle.top=tipTop+"px";tipNodeStyle.left=tipLeft+"px";popupNodeStyle.top=popTop+"px";popupNodeStyle.left=popLeft+"px";}};}());