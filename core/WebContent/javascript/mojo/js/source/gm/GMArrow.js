(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo._HasOwnAvatar");var $CSS=mstrmojo.css;function string2int(str){var floatNum=parseFloat(str);if(isNaN(floatNum)){floatNum=0;}return Math.floor(floatNum+0.5);}mstrmojo.gm.GMArrow=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.gm.VisLegend",cssClass:"gm-arrow",bodyCssClass:"gm-arrow-body",avatarCssClass:"gm-arrow-move",restrictedToAxis:"y",boundingBox:null,xSlots:null,ySlots:null,currentSlot:0,tempSlot:0,markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}px;height:{@height}px;top:{@top}px;left:{@left}px;" mstrAttach:click,mouseover,mouseout><div class="{@bodyCssClass}" style="width:{@width}px;height:{@height}px"></div></div>',markupSlots:{domBody:function(){return this.domNode.firstChild;}},init:function(props){var ph=props.placeholder;if(ph!==undefined){this.cssClass=ph.getAttribute("class");if(!this.cssClass){this.cssClass="";}if(props.hasOwnProperty("left")===false){props.left=string2int(ph.style.left);}if(props.hasOwnProperty("top")===false){props.top=string2int(ph.style.top);}}this.xSlots=[];this.ySlots=[];if(this._super){this._super(props);}var left,top,restrictedToAxis=this.restrictedToAxis;if(restrictedToAxis==="x"){this.width=10;this.height=15;left=this.getX();}else{this.width=15;this.height=10;top=this.getY();}if(left!==undefined){this.left=left;}if(top!==undefined){this.top=top;}},getX:function(){var x,width=this.width,bbox=this.boundingBox,slots=this.xSlots,curSlot=this.currentSlot;if(slots&&curSlot){x=(slots[curSlot]||0)-(width>>1);x=Math.max(x,0);x=Math.min(x,bbox.w-width);return x;}return 0;},getY:function(){var y,height=this.height,bbox=this.boundingBox,slots=this.ySlots,curSlot=this.currentSlot;if(slots&&curSlot){y=(slots[curSlot]||0)-(height>>1);y=Math.max(y,0);y=Math.min(y,bbox.h-height);return y;}return 0;},getSnapSlotByX:function(x){var i,pos,dist,slots=this.xSlots,n=slots.length;if(n===0){return 0;}pos=0;dist=Math.abs(x-slots[0]);for(i=1;i<n;i++){if(Math.abs(x-slots[i])<dist){pos=i;dist=Math.abs(x-slots[i]);}}return pos;},getSnapSlotByY:function(y){var i,pos,dist,slots=this.ySlots,n=slots.length;if(n===0){return 0;}pos=0;dist=Math.abs(y-slots[0]);for(i=1;i<n;i++){if(Math.abs(y-slots[i])<dist){pos=i;dist=Math.abs(y-slots[i]);}}return pos;},isDragValid:function isDragValid(){return true;},ondrop:function(evt){var domBody=this.domBody,domBodyStyle=domBody.style;$CSS.removeClass(domBody,this.avatarCssClass);domBodyStyle.left="0px";domBodyStyle.top="0px";this.domNode.appendChild(domBody);this.updateOnSlotChange();evt.dropSuccessful=true;},ondragend:function(evt){this._super(evt);if(!evt.dropSuccessful){this.ondrop(evt);}},updateOnSlotChange:function(){var domNodeStyle=this.domNode.style,tempSlot=this.tempSlot,currentSlot=this.currentSlot,restrictedToAxis=this.restrictedToAxis;if(tempSlot!==currentSlot){this.currentSlot=tempSlot;}if(restrictedToAxis!=="y"){domNodeStyle.left=this.getX()+"px";}if(restrictedToAxis!=="x"){domNodeStyle.top=this.getY()+"px";}},createAvatar:function createAvatar(){var left=this.left,top=this.top,bbox=this.boundingBox,body=this.domBody,restrictedToAxis=this.restrictedToAxis,bodyStyle=body.style;if(restrictedToAxis!=="y"){bodyStyle.top=bbox.y+top+1+"px";}if(restrictedToAxis!=="x"){bodyStyle.left=bbox.x+left+1+"px";}return this.domBody;},positionAvatar:function positionAvatar(pos){var idx,left,top,bbox=this.boundingBox,avatar=this.avatar,avs=avatar.style,restrictedToAxis=this.restrictedToAxis;if(restrictedToAxis!=="y"){idx=this.getSnapSlotByX(pos.x-bbox.x);left=this.xSlots[idx]+bbox.x-(this.width>>1);avs.left=Math.max(left,bbox.x)+1+"px";this.tempSlot=idx;}if(restrictedToAxis!=="x"){idx=this.getSnapSlotByY(pos.y-bbox.y);top=this.ySlots[idx]+bbox.y-(this.height>>1)+1;avs.top=Math.max(top,bbox.y)+1+"px";this.tempSlot=idx;}}});}());