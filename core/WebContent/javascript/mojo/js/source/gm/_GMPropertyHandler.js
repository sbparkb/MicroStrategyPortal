(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.chart.enums.EnumLineStyle");mstrmojo.requiresClsP("mstrmojo.gm","GMUtility","GMEnums","GMLegend","GMController","GMProperty","GMAxisScale","GMPropertyNode","GMPropDefaults");var $MOJO=mstrmojo,$GM=$MOJO.gm,$WRAP=$MOJO.func.wrapMethods,$ARR=$MOJO.array,$HASH=$MOJO.hash,$GMProp=$GM.GMProperty,GMUTIL=$GM.GMUtility,$VISUTILS=$MOJO.VisUtility,PRP_SHAPE=$GM.EnumShape,PRP_SUBTYPE=$GM.EnumSubtype,PRP_GRID_LINE=$GM.EnumGridLines,PRP_THEME=$GM.EnumTheme,PRP_LEGEND_SLOT=$GM.EnumLegendSlot,$RLT=$GM.EnumTrendRefModelLabels,$RMT=$GM.EnumRefLineModelType,$SEL_OPT_LVL=$GM.EnumSelectionOptionLevel,$PROP_DEFAULTS=$GM.GMPropDefaults,CHART_TYPE=$GM.EnumGraphType,COLOR_BY_TYPE=$GM.EnumColorByType,CE_LN_STYLE=$MOJO.chart.enums.EnumLineStyle,GM_LN_STYLE=$GM.EnumCombinedLineStyle,ENUM_FMT_STATUS=$GM.EnumShapeFormatStatus,ENUM_FORMAT_TAG=$GM.FormatingPropertyTag,ENUM_XML_TAG=$GM.WidgetPropertyTag,AXIS_SCALE=$GM.GMAxisScale,PRP_AXIS_SCALE=$GM.EnumAxisScale,ID_TYPE=$GM.EnumIdentityType,CTRL_TYPE=$MOJO.VisEnum.ControlType,PNode=$GM.GMPropertyNode,CARDLIMIT=$MOJO.VisEnum.VIS_CARDLIMIT.NON_GRID,METRIC_NAMES_ITEM={n:"Metric Names",did:"00000000000000000000000000000000",t:0,cs:1};var TIME_STAMP="_tmsp",DEFAULT_TAG="_default",ALL_VALUE="allVal",REF_LABEL_FONT="rfLnFnt",METRIC_LVL_DATA_LABEL_SHOW=true;var COLOR_FILL_STYLE_MAP={lgdBgFillClr:"lgdBgFillStyle",shpFillClr:"shpFillStyle",bgFillClr:"bgFillStyle",rwHdrFillClr:"rwHdrFillStyle",colHdrFillClr:"colHdrFillStyle"};var LEGEND_DOCK_POS=[{pos:PRP_LEGEND_SLOT.LEFT_TOP},{pos:PRP_LEGEND_SLOT.LEFT_MIDDLE},{pos:PRP_LEGEND_SLOT.LEFT_BOTTOM},{pos:PRP_LEGEND_SLOT.RIGHT_TOP},{pos:PRP_LEGEND_SLOT.RIGHT_MIDDLE},{pos:PRP_LEGEND_SLOT.RIGHT_BOTTOM}];var GRID_FORMAT_PROPS=[ENUM_FORMAT_TAG.MAJOR_GRID_LINES_COLOR,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_THICKNESS,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_STYLE,ENUM_FORMAT_TAG.MINER_GRID_LINES_COLOR,ENUM_FORMAT_TAG.MINER_GRID_LINES_THICKNESS,ENUM_FORMAT_TAG.MINER_GRID_LINES_STYLE];var DataChangeProps=[ENUM_XML_TAG.AXIS_SCALE,ENUM_XML_TAG.AXIS_SCALE_DATA,ENUM_XML_TAG.SUB_TYPE,ENUM_XML_TAG.OUTSIDE_BORDER,ENUM_XML_TAG.SELECTION_TYPE,ENUM_XML_TAG.SELECTIONS,ENUM_XML_TAG.AXIS_SCALE_MANUAL_MIN,ENUM_XML_TAG.AXIS_SCALE_MANUAL_MAX,ENUM_XML_TAG.SINGLE_AXIS_SCALE_TYPE,ENUM_XML_TAG.TREND_LINE_DEF,ENUM_XML_TAG.REF_LINE_DEF,ENUM_FORMAT_TAG.OUTSIDE_BORDER_SHOW,ENUM_FORMAT_TAG.OUTSIDE_BORDER_COLOR,ENUM_FORMAT_TAG.OUTSIDE_BORDER_STYLE,ENUM_FORMAT_TAG.OUTSIDE_BORDER_THICKNESS,ENUM_FORMAT_TAG.COLOR_SQUARE_COLOR];var AXIS_PROP_NAMES=[ENUM_FORMAT_TAG.MAJOR_GRID_LINES_SHOW,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_COLOR,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_THICKNESS,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_STYLE,ENUM_FORMAT_TAG.MINOR_GRID_LINES_SHOW,ENUM_FORMAT_TAG.MINER_GRID_LINES_COLOR,ENUM_FORMAT_TAG.MINER_GRID_LINES_THICKNESS,ENUM_FORMAT_TAG.MINER_GRID_LINES_STYLE,ENUM_FORMAT_TAG.X_AXIS_LINE_SHOW,ENUM_FORMAT_TAG.X_AXIS_LINE_COLOR,ENUM_FORMAT_TAG.X_AXIS_LINE_STYLE,ENUM_FORMAT_TAG.X_AXIS_LINE_THICKNESS,ENUM_FORMAT_TAG.X_AXIS_TITLE_SHOW,ENUM_FORMAT_TAG.X_AXIS_TITLE_CONTENT,ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_COLOR,ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_FAMILY,ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_STYLE,ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_SIZE,ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_COLOR,ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.X_AXIS_LABELS_ROTATION,ENUM_FORMAT_TAG.X_AXIS_LABELS_SHOW,ENUM_FORMAT_TAG.Y_AXIS_LINE_SHOW,ENUM_FORMAT_TAG.Y_AXIS_LINE_COLOR,ENUM_FORMAT_TAG.Y_AXIS_LINE_STYLE,ENUM_FORMAT_TAG.Y_AXIS_LINE_THICKNESS,ENUM_FORMAT_TAG.Y_AXIS_TITLE_SHOW,ENUM_FORMAT_TAG.Y_AXIS_TITLE_CONTENT,ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_SIZE,ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_COLOR,ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_FAMILY,ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_STYLE,ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_COLOR,ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.Y_AXIS_LABELS_ROTATION,ENUM_FORMAT_TAG.Y_AXIS_LABELS_SHOW,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_SHOW,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_COLOR,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_THICKNESS,ENUM_FORMAT_TAG.MAJOR_GRID_LINES_STYLE,ENUM_FORMAT_TAG.MINOR_GRID_LINES_SHOW,ENUM_FORMAT_TAG.MINER_GRID_LINES_COLOR,ENUM_FORMAT_TAG.MINER_GRID_LINES_THICKNESS,ENUM_FORMAT_TAG.MINER_GRID_LINES_STYLE,ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_SHOW,ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_COLOR,ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_STYLE,ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_THICKNESS,ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_SHOW,ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_COLOR,ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_STYLE,ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_THICKNESS];var COMPLEX_PROPERTY=[ENUM_XML_TAG.METRIC_SHAPES,ENUM_XML_TAG.LOG_SCALE,ENUM_XML_TAG.TREND_LINE_DEF,ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF,ENUM_XML_TAG.REF_LINE_DEF,ENUM_XML_TAG.AXIS_ORIGIN,ENUM_XML_TAG.FORMATS_ON_COMBINATION,ENUM_FORMAT_TAG.ALL_SHAPE_FORMAT,ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL];var ENUM_PARTIAL_UPDATE_TYPE={UNKNOW:-1,UPDATE_CHARTS:1,CHART_SCALE:2,SPLITTER_LINE_SCALE:3,UPDATE_ALL:4};var LAYOUT_RERENDER_ALL_PROPERTY=[ENUM_FORMAT_TAG.ROW_TEXT_SHOW,ENUM_FORMAT_TAG.ROW_HEADER_SHOW,ENUM_FORMAT_TAG.ROW_VALUES_SHOW,ENUM_FORMAT_TAG.COLUMN_TEXT_SHOW,ENUM_FORMAT_TAG.COLUMN_HEADER_SHOW,ENUM_FORMAT_TAG.COLUMN_VALUES_SHOW,ENUM_FORMAT_TAG.ALL_ROW_COLUMN_SHOW,ENUM_FORMAT_TAG.ROW_TEXT_TEXT_FONT_FAMILY,ENUM_FORMAT_TAG.ROW_TEXT_TEXT_FONT_SIZE,ENUM_FORMAT_TAG.ROW_TEXT_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.ROW_HEADER_TEXT_FONT_FAMILY,ENUM_FORMAT_TAG.ROW_HEADER_TEXT_FONT_SIZE,ENUM_FORMAT_TAG.ROW_HEADER_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_FONT_FAMILY,ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_FONT_SIZE,ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.COLUMN_TEXT_TEXT_FONT_FAMILY,ENUM_FORMAT_TAG.COLUMN_TEXT_TEXT_FONT_SIZE,ENUM_FORMAT_TAG.COLUMN_TEXT_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_FONT_FAMILY,ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_FONT_SIZE,ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_FONT_FAMILY,ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_FONT_SIZE,ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.ALL_ROW_COLUMN_TEXT_FONT_FAMILY,ENUM_FORMAT_TAG.ALL_ROW_COLUMN_TEXT_FONT_SIZE,ENUM_FORMAT_TAG.ALL_ROW_COLUMN_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.V_MATRIX_LINES_SHOW,ENUM_FORMAT_TAG.H_MATRIX_LINES_SHOW,ENUM_FORMAT_TAG.ALL_MATRIX_LINES_SHOW,ENUM_FORMAT_TAG.V_MATRIX_LINES_COMBINED_STYLE,ENUM_FORMAT_TAG.H_MATRIX_LINES_COMBINED_STYLE,ENUM_FORMAT_TAG.ALL_MATRIX_LINES_COMBINED_STYLE,ENUM_FORMAT_TAG.X_AXIS_LINE_SHOW,ENUM_FORMAT_TAG.X_AXIS_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.Y_AXIS_LINE_SHOW,ENUM_FORMAT_TAG.Y_AXIS_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.ALL_AXIS_LINE_SHOW,ENUM_FORMAT_TAG.ALL_AXIS_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.ALL_LINE_SHOW,ENUM_FORMAT_TAG.ALL_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.X_AXIS_TITLE_SHOW,ENUM_FORMAT_TAG.Y_AXIS_TITLE_SHOW,ENUM_FORMAT_TAG.ALL_AXIS_TITLE_SHOW,ENUM_FORMAT_TAG.X_AXIS_TITLE_CONTENT,ENUM_FORMAT_TAG.Y_AXIS_TITLE_CONTENT,ENUM_FORMAT_TAG.ALL_AXIS_TITLE_CONTENT,ENUM_FORMAT_TAG.X_AXIS_LABELS_SHOW,ENUM_FORMAT_TAG.Y_AXIS_LABELS_SHOW,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_SHOW,ENUM_FORMAT_TAG.X_AXIS_LABELS_ROTATION,ENUM_FORMAT_TAG.Y_AXIS_LABELS_ROTATION,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_ROTATION,ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_FAMILY,ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_STYLE,ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_SIZE,ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_FAMILY,ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_STYLE,ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_SIZE,ENUM_FORMAT_TAG.ALL_AXIS_TITLE_FONT_FAMILY,ENUM_FORMAT_TAG.ALL_AXIS_TITLE_FONT_STYLE,ENUM_FORMAT_TAG.ALL_AXIS_TITLE_FONT_SIZE,ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.ALL_TEXT_FONT_SIZE,ENUM_FORMAT_TAG.ALL_TEXT_FONT_FAMILY,ENUM_FORMAT_TAG.ALL_TEXT_FONT_STYLE,ENUM_XML_TAG.AXIS_SCALE_DATA,ENUM_XML_TAG.FIT_TO];var UPDATE_CHARTS_PROPERTY=[ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_SHOW,ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_SHOW,ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.ALL_AXIS_ORIGIN_LINE_SHOW,ENUM_FORMAT_TAG.ALL_AXIS_ORIGIN_LINE_COMBINED_STYLE,ENUM_XML_TAG.TREND_LINE_DEF,ENUM_XML_TAG.REF_LINE_DEF,ENUM_FORMAT_TAG.MODIFIED_DEF_FILL_COLOR,ENUM_FORMAT_TAG.SHAPE_FILL_TRANSPARENCY,ENUM_FORMAT_TAG.SHAPE_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR,ENUM_FORMAT_TAG.SHAPE_BORDER_COMBINED_STYLE,ENUM_FORMAT_TAG.LINE_MARKER_SHOW,ENUM_FORMAT_TAG.LINE_MARKER_COLOR,ENUM_FORMAT_TAG.REF_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.REF_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.REF_LABELS_FONT_SIZE];var CHART_SCALE_PROPERTY=[ENUM_XML_TAG.SCALE_CHART_WIDTH,ENUM_XML_TAG.SCALE_CHART_HEIGHT];var SPLITTER_LINE_SCALE_PROPERTY=[ENUM_XML_TAG.SCALE_ROW_HEADERS,ENUM_XML_TAG.SCALE_COL_HEADERS,ENUM_XML_TAG.SCALE_Y,ENUM_XML_TAG.SCALE_Y2,ENUM_XML_TAG.SCALE_X,ENUM_XML_TAG.SCALE_X2,ENUM_XML_TAG.SCALE_V_EXTRA_LINE];var DO_NOT_SEPARATE_PROPERTY=[ENUM_FORMAT_TAG.ALL_TEXT_FONT_COLOR,ENUM_FORMAT_TAG.ALL_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_COLOR,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_STYLE];var FORCE_UPDATE_AXIS_PROPERTY=[ENUM_XML_TAG.BANDING,ENUM_XML_TAG.AXIS_SCALE_DATA,ENUM_XML_TAG.AXIS_ORIGIN,ENUM_XML_TAG.MAX_SIZE_TYPE,ENUM_XML_TAG.MAX_SIZE_VALUE,ENUM_XML_TAG.MIN_SIZE_TYPE,ENUM_XML_TAG.MIN_SIZE_VALUE];var CONFLICT_SHAPE_FORMAT=[ENUM_FORMAT_TAG.SHAPE_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.SHAPE_BORDER_COMBINED_STYLE,ENUM_FORMAT_TAG.SHAPE_FILL_TRANSPARENCY];function getWrapperForObject(value){var type=typeof value;if(type==="object"||type==="array"){return new PNode({jsonObj:value,parent:undefined});}return value;}function getOriginalThicknessAndStyle(combinedLineStyle){var thk=1,ceLnStyle;if(combinedLineStyle===GM_LN_STYLE.NONE){ceLnStyle=CE_LN_STYLE.LS_NONE;thk=0;}else{if(combinedLineStyle===GM_LN_STYLE.DASHED){ceLnStyle=CE_LN_STYLE.LS_DASH;}else{if(combinedLineStyle===GM_LN_STYLE.DOTTED){ceLnStyle=CE_LN_STYLE.LS_DOT;}else{ceLnStyle=CE_LN_STYLE.LS_SOLID;if(combinedLineStyle===GM_LN_STYLE.THICK){thk=2;}}}}return{ceLnStyle:ceLnStyle,thk:thk};}function createShowHideDataLabelObject(){var res={},opts=this.getShowDataLabelOptions();opts.forEach(function(o){res[o.key]=METRIC_LVL_DATA_LABEL_SHOW;});return res;}function updateMetricLevelDataLabel(mtcLvlDataLavel){var opts=this.getShowDataLabelOptions(),allMetricTrue=true,key;opts.forEach(function(o){key=o.key;if(key!=="AllMetrics"){if(mtcLvlDataLavel[key]===undefined){mtcLvlDataLavel[key]=false;}if(mtcLvlDataLavel[key]===false){allMetricTrue=false;}}});mtcLvlDataLavel.AllMetrics=allMetricTrue;}function convertBooleanToInt(rawValue){if(typeof rawValue==="boolean"){return rawValue===true?1:0;}return rawValue;}function getRFLTextPropValue(propName,value){var tempValue=getWrapperForObject({});tempValue.setProperty(propName,value,true);return tempValue.jsonObj;}function getTrendRefInfo(props){var info={},key,existing=props.existing,actPropNm,format={},fmtProps={rfLnFntClr:true,rfLnFntFml:true,rfLnFntStyle:true,rfLnFntSz:true,trdRefLnClr:true,trdRefLnStyle:true,trdRefLnThk:true},propNameMapping={metricId:"metricId",trdTp:"lineType",trdLvl:"lineLevel",trdSeason:"seasonality",trdIncBB:"includeBreakby",trdEnabled:"enabled",dropzoneId:"dropzoneId",refTp:"lineType",refLvl:"lineLevel",refLbTp:"lineLabel",trdDgr:"lineConstant",refCstVl:"lineConstant",refEnabled:"enabled",modix:"lineIndex",trdFstEnabled:"enabled",trdBbForeEnabled:"enabled",trdBwdFst:"min",trdFwdFst:"max",trdBbForeBwd:"min",trdBbForeFwd:"max",subAxis:"subAxis",refLnName:"refLnName"};if(props.trdRefLnCmbStyle!==undefined){var obj=getOriginalThicknessAndStyle(props.trdRefLnCmbStyle);props.trdRefLnStyle=obj.ceLnStyle;props.trdRefLnThk=obj.thk;}for(key in props){if(props.hasOwnProperty(key)){if(fmtProps[key]===true){if(key.indexOf(REF_LABEL_FONT)>=0&&existing){format[key]=getRFLTextPropValue(key,props[key]);}else{format[key]=convertBooleanToInt(props[key]);}}else{actPropNm=propNameMapping[key];if(actPropNm!==undefined){info[actPropNm]=convertBooleanToInt(props[key]);}}}}info.format=GMUTIL.replaceSpecialChars(JSON.stringify(format));return info;}function requireDataForTrendRef(newValue,option,isTrend){var gmCtr=this.GMController,metricId=option.key.split(",")[0],modelData=this.model.data,midx,mdls,jsonObj=newValue.jsonObj,dataChangeProps=["existing","trdBwdFst","trdDgr","trdEnabled","trdFwdFst","trdIncBB","trdLvl","trdTp","refLvl","refTp","refEnabled","refCstVl"],modix0based,needGetData=false,trdDef,fms,fmt,fmtObj;if(jsonObj.modix===undefined){return true;}modix0based=jsonObj.modix-1;if(metricId.indexOf("Axis")>=0){mdls=modelData.dz[metricId[0]+"Axis"].mdls;}else{midx=gmCtr.getMetricIndexFromID(metricId);mdls=modelData.gsi.mx[midx].mdls;}trdDef=mdls.mod_c[modix0based];fms=trdDef.fms;if(fms===""||fms===undefined){fmtObj={};}else{fmt=GMUTIL.restoreSpecialChars(fms);fmtObj=JSON.parse(fmt);}if(jsonObj.trdRefLnCmbStyle!==undefined){var obj=getOriginalThicknessAndStyle(jsonObj.trdRefLnCmbStyle);jsonObj.trdRefLnStyle=obj.ceLnStyle;jsonObj.trdRefLnThk=obj.thk;fmtObj.trdRefLnStyle=jsonObj.trdRefLnStyle;fmtObj.trdRefLnThk=obj.thk;}$ARR.forEach(newValue.modifiedPropertyKeys,function(pn){if(dataChangeProps.indexOf(pn)!==-1){needGetData=true;}var pv=jsonObj[pn];if(fmtObj[pn]!==undefined){if(pn.indexOf(REF_LABEL_FONT)>=0){fmtObj[pn]=getRFLTextPropValue(pn,pv);}else{fmtObj[pn]=convertBooleanToInt(pv);}}if(pn===ENUM_XML_TAG.REF_LINE_NAME){trdDef.lin=pv;}});trdDef.fms=GMUTIL.replaceSpecialChars(JSON.stringify(fmtObj));if(!isTrend){trdDef.la=jsonObj.refLbTp;}return needGetData;}function getRefDefByOption(option){var refDef=this.GMController[ENUM_XML_TAG.REF_LINE_DEF],optKeyPair=option.key.split(","),axisKey=optKeyPair[0],refTpKey=optKeyPair[1],refOfMetric=refDef[axisKey]||{},refModelType=$RMT[refTpKey],refObjOfTypeArr=refOfMetric[refModelType],retObj;$ARR.forEach(refObjOfTypeArr,function(refO){if(refO.modix===option.modix){retObj=refO;return false;}});return retObj;}function mergeModifiedPropertyToObject(destObj,propertyNode,noTimeStamp){var modiProps=propertyNode.modifiedPropertyKeys,jsonObj=propertyNode.jsonObj,len=modiProps.length,i,key;for(i=0;i<len;i++){key=modiProps[i];if(jsonObj[key]==="default"){delete destObj[key];delete destObj[key+TIME_STAMP];continue;}destObj[key]=jsonObj[key];if(noTimeStamp!==true){destObj[key+TIME_STAMP]=jsonObj[key+TIME_STAMP];}}return destObj;}function isABLForecastProps(modifiedKeys){var i,n,foreProps=[ENUM_XML_TAG.TREND_SEASONALITY,ENUM_XML_TAG.TREND_FORECAST_ENABLED,ENUM_XML_TAG.TREND_BWD_FORECAST,ENUM_XML_TAG.TREND_FWD_FORECAST];for(i=0,n=modifiedKeys.length;i<n;i++){if(foreProps.indexOf(modifiedKeys[i])>=0){return true;}}return false;}function resetGridLineFormat(){var defaults=this.getDefaultProperties(),me=this;GRID_FORMAT_PROPS.forEach(function(pn){me.setWidgetPropertyValue(pn,defaults[pn]);});}function uncheckAutoGridLineFormatIfNecessary(propNames){var me=this;propNames.forEach(function(pn){if(GRID_FORMAT_PROPS.indexOf(pn)>=0){me.setWidgetPropertyValue(ENUM_FORMAT_TAG.GRID_LINE_AUTO,false);}});}function getFillStyle(newColor){var clrTp=typeof newColor,fillStyle;if(clrTp==="number"||clrTp==="string"){fillStyle=mstrmojo.gm.ShapeFillType.Solid;}else{fillStyle=mstrmojo.gm.ShapeFillType.Gradient;}return fillStyle;}function getRealPropValue(propName,value){if(typeof value==="object"&&propName.indexOf(REF_LABEL_FONT)>=0){return value[propName];}return value;}function setSimplePropertyValue(pn,value,option,isUndo){if(!isUndo&&pn.indexOf(REF_LABEL_FONT)>=0){value=getRFLTextPropValue(pn,value);}if(option===undefined){var assFillStyle=COLOR_FILL_STYLE_MAP[pn];if(assFillStyle){this.setWidgetPropertyValue(assFillStyle,getFillStyle(value));}this.setWidgetPropertyValue(pn,(value&&value.jsonObj)||value);}else{var existingPropValue=this.getWidgetPropertyValue(pn);if(existingPropValue===undefined){existingPropValue={};}existingPropValue[option.key]=(value&&value.jsonObj)||value;this.setWidgetPropertyValue(pn,existingPropValue);}}function needRetrieveTrendData(propName,newValue,chtInfo){var trendDef,option,me=this,key,mIdx,trdAvbleForOldShape,trdAvbleForNewShape,needRetrieveData=false,gmCtr=this.GMController,mxs;if(propName===ENUM_XML_TAG.METRIC_SHAPES){key=newValue.modifiedPropertyKeys[0];option={key:key};trendDef=this.readGlobalProperty(ENUM_XML_TAG.TREND_LINE_DEF,option);if(trendDef.jsonObj[ENUM_XML_TAG.TREND_ENABLED]){mIdx=gmCtr.getMetricIndexFromID(key);trdAvbleForOldShape=GMUTIL.isTrendLineAvailableForMetric(this,mIdx);trdAvbleForNewShape=GMUTIL.isTrendLineAvailableForMetric(this,mIdx,newValue.jsonObj[key]);if(trdAvbleForOldShape!==trdAvbleForNewShape){needRetrieveData=true;}}}else{if(propName===ENUM_XML_TAG.SHAPE){if(chtInfo.isABL&&chtInfo.dirc===$GM.EnumABLDirection.HORIZONTAL){mxs=gmCtr.getMetricsOnXAxis();}else{if(chtInfo.isBubbleOrScatter||(chtInfo.isABL&&chtInfo.dirc===$GM.EnumABLDirection.VERTICAL)){mxs=gmCtr.getMetricsOnYAxis();}}$ARR.forEach(mxs,function(mx){key=gmCtr.model.getMetricIDsFromIndex([mx])[0];option={key:key};trendDef=me.readGlobalProperty(ENUM_XML_TAG.TREND_LINE_DEF,option);if(trendDef.jsonObj[ENUM_XML_TAG.TREND_ENABLED]){trdAvbleForOldShape=GMUTIL.isTrendLineAvailableForMetric(me,mx);trdAvbleForNewShape=GMUTIL.isTrendLineAvailableForMetric(me,mx,newValue);if(trdAvbleForOldShape!==trdAvbleForNewShape){needRetrieveData=true;return false;}}});}}return needRetrieveData;}function needRetrieveData(propName,newValue,chtInfo){if(this.skipSuppressDataCheck){return false;}if(DataChangeProps.indexOf(propName)>=0){return true;}if(needRetrieveTrendData.call(this,propName,newValue,chtInfo)){return true;}if(propName===ENUM_XML_TAG.SHAPE){var curShp=this.readGlobalProperty(propName),gmCtr=this.GMController,subType;if(gmCtr.getUnitsCountInSliceBy()>0&&(PRP_SHAPE.PIE===curShp||PRP_SHAPE.RING===curShp)){return true;}subType=this.readGlobalProperty(ENUM_XML_TAG.SUB_TYPE);if((PRP_SHAPE.AREA===curShp||PRP_SHAPE.AREA===newValue)&&subType===PRP_SUBTYPE.AUTO){return true;}}return false;}function getSortAction(newValue,handleConfig){var gmCtr=this.GMController,chtInfo=this.getChartInfo();handleConfig.puFiltersConfig={};if(gmCtr.showMetricSortIcon){var cellHandle=this.getWidgetPropertyValue(ENUM_XML_TAG.SORT_INDEX),isAsc=this.getWidgetPropertyValue(ENUM_XML_TAG.SORT_ORDER),isStacked=(newValue===PRP_SUBTYPE.STACKED||newValue===PRP_SUBTYPE.PERCENT||(newValue===PRP_SUBTYPE.AUTO&&chtInfo.tp===CHART_TYPE.AREA)),sortAction=gmCtr.getUpdateMetricSortAction(cellHandle,isAsc,isStacked);handleConfig.actions.push(sortAction);}}function getCombinedLineStyle(thickness,lineStyle){thickness=parseInt(thickness,10);if(lineStyle===CE_LN_STYLE.LS_NONE||thickness===0){return GM_LN_STYLE.NONE;}if(lineStyle===CE_LN_STYLE.LS_DASH){return GM_LN_STYLE.DASHED;}if(lineStyle===CE_LN_STYLE.LS_DOT){return GM_LN_STYLE.DOTTED;}if(lineStyle===CE_LN_STYLE.LS_SOLID){if(thickness===1){return GM_LN_STYLE.THIN;}return GM_LN_STYLE.THICK;}}function getUndoPropValConfig(modifiedKeys,currentDef){var undoPropValConfig={};if(currentDef){$ARR.forEach(modifiedKeys,function(key){if(key===ENUM_XML_TAG.TREND_REF_LINE_COMBINED_STYLE){undoPropValConfig[ENUM_XML_TAG.TREND_REF_LINE_THICKNESS]=currentDef[ENUM_XML_TAG.TREND_REF_LINE_THICKNESS];undoPropValConfig[ENUM_XML_TAG.TREND_REF_LINE_STYLE]=currentDef[ENUM_XML_TAG.TREND_REF_LINE_STYLE];undoPropValConfig[ENUM_XML_TAG.TREND_REF_LINE_COMBINED_STYLE]=getCombinedLineStyle(currentDef[ENUM_XML_TAG.TREND_REF_LINE_THICKNESS],currentDef[ENUM_XML_TAG.TREND_REF_LINE_STYLE]);}else{undoPropValConfig[key]=currentDef[key];}});}return undoPropValConfig;}function getFormatsOfShapeCollection(selOptLvl,identityArray,arrayOfComb){var res,allPropKey,formatObj,gc,gmCtr=this.GMController,allShpFmt=this.model.data.dz.visProp.fmt.allShpFmt,shapeFmt,shapeDef=gmCtr.getDefaultsForShape(gmCtr.getChartInfo().shape),resolvedFormatsCollection=[];if(selOptLvl===$SEL_OPT_LVL.ALL_SHAPE){resolvedFormatsCollection.push(shapeDef);allPropKey=ENUM_FORMAT_TAG.ALL_SHAPE_FORMAT;formatObj=this.getWidgetPropertyValue(allPropKey);resolvedFormatsCollection.push(formatObj);}else{if(selOptLvl===$SEL_OPT_LVL.COLOR_BY){$ARR.forEach(arrayOfComb,function(comb){resolvedFormatsCollection.push(shapeDef);shapeFmt=gmCtr.getShapeFormatsWithCombination(comb);if(shapeFmt){resolvedFormatsCollection.push(shapeFmt);}else{resolvedFormatsCollection.push(GMUTIL.stringToJSON(allShpFmt));}});}else{if(selOptLvl===$SEL_OPT_LVL.METRIC){$ARR.forEach(arrayOfComb,function(comb){resolvedFormatsCollection.push(shapeDef);resolvedFormatsCollection.push(gmCtr.getShapeFormatsWithCombination(comb));});}else{if(selOptLvl===$SEL_OPT_LVL.ITSELF){$ARR.forEach(identityArray,function(identity){if(identity.isPie){resolvedFormatsCollection.push(identity.sPieDP.getFormattingProperties(identity.sliceIdx));}else{gc=identity.getGraphCell();resolvedFormatsCollection.push(gc.getFormattingProperties());}});}}}}res=GMUTIL.getResolvedFormatsObject(resolvedFormatsCollection);var shapeColor=res.shpFillClr,finalRes;if(res===shapeDef){finalRes=gmCtr.getVolatileDefaultsForShape(gmCtr.getChartInfo().shape);}else{finalRes=res;}if(shapeColor!==undefined){finalRes[ENUM_FORMAT_TAG.SHAPE_LINE_COLOR]=finalRes[ENUM_FORMAT_TAG.SHAPE_FILL_COLOR]=shapeColor;}var bdrHit=false,mkBdrHit=false,mkFillHit=false,i,fobj;var arr=[],len;$ARR.forEach(resolvedFormatsCollection,function(formatObj){if(formatObj!==undefined){arr.push(formatObj);}});len=arr.length;for(i=1;i<len;i++){fobj=arr[i];if(fobj[ENUM_FORMAT_TAG.LINE_MARKER_COLOR]!==undefined){mkFillHit=true;}if(fobj[ENUM_FORMAT_TAG.LINE_MARKER_BORDER_COLOR]!==undefined){mkBdrHit=true;}if(fobj[ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR]!==undefined){bdrHit=true;}}if(!mkFillHit){delete finalRes[ENUM_FORMAT_TAG.LINE_MARKER_COLOR];}if(!mkBdrHit){delete finalRes[ENUM_FORMAT_TAG.LINE_MARKER_BORDER_COLOR];}if(!bdrHit){delete finalRes[ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR];}return finalRes;}function updateCombineLineStyle(shapeFormat){[ENUM_FORMAT_TAG.SHAPE_LINE_COMBINED_STYLE,ENUM_FORMAT_TAG.SHAPE_BORDER_COMBINED_STYLE].forEach(function(cmbPropname){var thkProp=cmbPropname.replace("CmbStyle","Thk"),ceLnStyle=cmbPropname.replace("CmbStyle","Style"),thkV=shapeFormat[thkProp],ceLnStyleV=shapeFormat[ceLnStyle];if(thkV!==undefined&&ceLnStyleV!==undefined){shapeFormat[cmbPropname]=getCombinedLineStyle(thkV,ceLnStyleV);}});}function collectConflictShapeFormat(src,dest){if(!src){return ;}$ARR.forEach(CONFLICT_SHAPE_FORMAT,function(prop){if(src[prop]!==undefined){if(dest[prop]===undefined){dest[prop]=[];}dest[prop].push({val:src[prop],tmsp:src[prop+TIME_STAMP]});}});}function mergeConflictShapeFormat(src,dest){var fmtObj,destObjTmsp,overWrite,value,conflict;$ARR.forEach(CONFLICT_SHAPE_FORMAT,function(prop){fmtObj=src[prop];destObjTmsp=dest[prop+TIME_STAMP];overWrite=false;conflict=false;value=undefined;$ARR.forEach(fmtObj,function(fmt){if(destObjTmsp!==undefined&&fmt.tmsp!==undefined&&fmt.tmsp>destObjTmsp){overWrite=true;}if(value===undefined){value=fmt.val;}else{if(value!==fmt.val){conflict=true;}}});if(destObjTmsp===undefined||overWrite){if(conflict){dest[prop]=undefined;}else{if(value!==undefined){dest[prop]=value;}}}});}function isColorByCombContainMetricComb(colorByComb,metricComb){var exist;$ARR.forEach(metricComb,function(mComb){exist=false;$ARR.forEach(colorByComb,function(cbComb){if(cbComb.tp===4&&cbComb.eid===mComb.eid){exist=true;return false;}});if(!exist){return false;}});return true;}function keepOnlyAttInComb(allInfo,attIds,keepMetrics){var res=[],reverseMap=GMUTIL.reverseMapping(attIds);$ARR.forEach(allInfo,function(selInfo){if(selInfo.tid===-1){if(keepMetrics){res.push(selInfo);}}else{if(reverseMap[selInfo.tid]!==undefined){res.push(selInfo);}}});return res;}function filterComb(arrayOfComb,attIds,keepMetrics){var collisionTestObject={},resArrayOfComb=[];arrayOfComb.forEach(function(comb){var filteredComb=keepOnlyAttInComb(comb,attIds,keepMetrics),strComb=GMUTIL.serializeCombination(filteredComb);if(collisionTestObject[strComb]===undefined){collisionTestObject[strComb]=true;resArrayOfComb.push(filteredComb);}});return resArrayOfComb;}function getTemplateAttribute(){var m=this.model.data||{},rowsAttr=$VISUTILS.getPropertyByPath(m,"gts.row",[]),colsAttr=$VISUTILS.getPropertyByPath(m,"gts.col",[]),allowedItems=rowsAttr.concat(colsAttr);return allowedItems;}function getCombinedValue(values){if(!values||values.length<=0){return undefined;}var i,allSame=true,n=values.length;if(n===1){return values[0];}for(i=1;i<n;i++){if(values[i]!==values[i-1]){allSame=false;break;}}if(allSame){return values[0];}return undefined;}function cloneAndReplacePNodeObj(src,valueConfig,copyAllProp,modifiedKeys){var jsonObj,prop,dest={};["jsonObj","modifiedPropertyKeys","opt"].forEach(function(key){if(src.hasOwnProperty(key)){dest[key]=$HASH.clone(src[key]);}});jsonObj=dest.jsonObj;if(copyAllProp){for(prop in valueConfig){if(valueConfig.hasOwnProperty(prop)){jsonObj[prop]=valueConfig[prop];}}}else{$ARR.forEach(modifiedKeys||dest.modifiedPropertyKeys,function(key){if(valueConfig.hasOwnProperty(key)){jsonObj[key]=valueConfig[key];}});}return dest;}function getAssociatedOptionsForPropPanelUpdate(propName,modifiedKeys,axScaleCollection,forAll){var key,value,associatedOptions=[];for(key in axScaleCollection){if(((forAll&&key==="AllMetrics")||(!forAll&&key!=="AllMetrics"))&&axScaleCollection.hasOwnProperty(key)){value={};value.modifiedPropertyKeys=$HASH.clone(modifiedKeys);value.jsonObj=$HASH.clone(axScaleCollection[key]);associatedOptions.push({name:propName,value:value,option:{key:key}});}}return associatedOptions;}function checkForPartialUpdate(propName,newValue){return propName===ENUM_XML_TAG.REF_LINE_DEF&&newValue[ALL_VALUE].modifiedPropertyKeys[0]===ENUM_XML_TAG.REF_LINE_NAME;}function getDefaultHandleConfig(){return{suppressData:true,needRefresh:true,actions:[],undoRedoCallback:undefined};}function needRefresh(propName,newValue,oldValues){var i,n=oldValues.length,oldValue,thk,mark1,mark2,jsonPn;if(propName===ENUM_XML_TAG.REF_LINE_DEF||propName===ENUM_XML_TAG.TREND_LINE_DEF){propName=newValue.modifiedPropertyKeys[0];jsonPn=propName;if(propName===ENUM_FORMAT_TAG.REF_LABELS_FONT_COLOR||propName===ENUM_XML_TAG.TREND_REF_LINE_COLOR){return false;}if(propName===ENUM_XML_TAG.TREND_REF_LINE_COMBINED_STYLE){jsonPn=ENUM_XML_TAG.TREND_REF_LINE_THICKNESS;}if(!newValue.jsonObj.fmt){return true;}oldValues=[];oldValues.push(newValue.jsonObj.fmt[jsonPn]);n=oldValues.length;newValue=newValue.jsonObj[jsonPn];}if(n<=0){return true;}if(propName.indexOf("FntStyle")>=0){mark1=newValue&1;mark2=newValue&2;for(i=0;i<n;i++){oldValue=oldValues[i];if(typeof oldValue==="object"){oldValue=oldValue[propName];}if((mark1!==(oldValue&1))||(mark2!==(oldValue&2))){return true;}}return false;}if(propName.indexOf("LnCmbStyle")>=0){if(jsonPn===ENUM_FORMAT_TAG.TREND_REF_LINE_THICKNESS){thk=newValue;}else{thk=getOriginalThicknessAndStyle(newValue).thk;}for(i=0;i<n;i++){if((thk!==2&&oldValues[i]===2)||(thk===2&&oldValues[i]!==2)){return true;}}return false;}return true;}mstrmojo.gm._GMPropertyHandler=mstrmojo.provide("mstrmojo.gm._GMPropertyHandler",{scriptClass:"mstrmojo.gm._GMPropertyHandler",getWidgetPropertyDefaultValue:function(propName,context){return this.property.readItemDefault(propName,context);},getWidgetPropertyValue:function(propName){return this.property.readItem(propName);},setWidgetPropertyValue:function(propName,value){if(propName===ENUM_FORMAT_TAG.V_MATRIX_LINES_SHOW||propName===ENUM_FORMAT_TAG.H_MATRIX_LINES_SHOW){this.property.removeItem(ENUM_XML_TAG.MATRIX_LINES);}if(propName===ENUM_FORMAT_TAG.X_AXIS_LINE_SHOW||propName===ENUM_FORMAT_TAG.Y_AXIS_LINE_SHOW){this.property.removeItem(ENUM_XML_TAG.AXES);}this.property.updateItem(propName,value);},removeWidgetProperty:function(propName){this.property.removeItem(propName);},getWidgetProps:function(){return this.property.generalProps;},isXMLDirty:function(){return this.property.isXMLDirty();},resetXMLDirtyFlag:function(){this.property.resetXMLDirtyFlag();},readGlobalProperty:function(propName,option){if(propName.indexOf("CmbStyle")!==-1){var thkProp=propName.replace("CmbStyle","Thk"),ceLnStyle=propName.replace("CmbStyle","Style"),thkV=this.readGlobalProperty(thkProp,option),ceLnStyleV=this.readGlobalProperty(ceLnStyle,option);if(thkV===undefined||ceLnStyleV===undefined){return undefined;}return getCombinedLineStyle(thkV,ceLnStyleV);}if(propName===ENUM_XML_TAG.TREND_BUBBLE_MAX||propName===ENUM_XML_TAG.TREND_BUBBLE_MIN){var ex=this.getGlobalExtremeForAxisOrMetric(option.key,option.sizeBy);if(propName===ENUM_XML_TAG.TREND_BUBBLE_MAX){return ex.max;}return ex.min;}if(propName===ENUM_FORMAT_TAG.COLOR_SQUARE_COLOR){var colorSqureIdentity=this.colorSqureIdentity;if(colorSqureIdentity){return{color:colorSqureIdentity.decodedColor,isDefaultColor:colorSqureIdentity.isDefaultColor};}return{color:"#0000FF",isDefaultColor:true};}if(propName===ENUM_XML_TAG.TREND_LINE_DEF){var trendDef=this.GMController.trConfigPool,trendlineDef,defTrdAtOption;if(option===undefined){return getWrapperForObject.call(this,trendDef.globalProp||{});}trendlineDef=$HASH.clone(trendDef[option.key]);defTrdAtOption=this.makeDefaultsObjectAtOption(propName);$HASH.copy(trendlineDef,defTrdAtOption);defTrdAtOption.trdRefLnCmbStyle=getCombinedLineStyle(defTrdAtOption.trdRefLnThk,defTrdAtOption.trdRefLnStyle);return getWrapperForObject.call(this,defTrdAtOption);}if(propName===ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF){var bubbleForeDef=this.GMController[ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF],foreDef=bubbleForeDef[option.key],foreDefTrdAtOption=this.makeDefaultsObjectAtOption(propName);$HASH.copy(foreDef,foreDefTrdAtOption);return getWrapperForObject.call(this,foreDefTrdAtOption);}if(propName===ENUM_XML_TAG.REF_LINE_DEF){var refObjOfType=getRefDefByOption.call(this,option),defaultRefAtOpt=this.makeDefaultsObjectAtOption(propName);$HASH.copy(refObjOfType,defaultRefAtOpt);defaultRefAtOpt.trdRefLnCmbStyle=getCombinedLineStyle(defaultRefAtOpt.trdRefLnThk,defaultRefAtOpt.trdRefLnStyle);return getWrapperForObject.call(this,defaultRefAtOpt);}if(propName===ENUM_XML_TAG.AXIS_SCALE_DATA){var axScaleDataArr,axScaleCollection;axScaleDataArr=this.getWidgetPropertyValue(propName);axScaleCollection=AXIS_SCALE.createAxisScaleCollectionFromArrays(axScaleDataArr);if(option===undefined){return getWrapperForObject.call(this,axScaleCollection);}return getWrapperForObject.call(this,axScaleCollection[option.key]);}if(propName===ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL){var showHideObj=this.getWidgetPropertyValue(ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL);if(!showHideObj){showHideObj=createShowHideDataLabelObject.call(this);}else{updateMetricLevelDataLabel.call(this,showHideObj);}if(!option){return new PNode({jsonObj:showHideObj,parent:undefined});}if(showHideObj[option.key]!==undefined){return showHideObj[option.key];}return this.makeDefaultsObjectAtOption(propName);}if(propName===ENUM_XML_TAG.AXIS_ORIGIN){var axOriCollect=this.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_ORIGIN);if(!axOriCollect){axOriCollect=this.createAxisOriginObject();}if(!option){return new PNode({jsonObj:axOriCollect,parent:undefined});}if(axOriCollect[option.key]!==undefined){return new PNode({jsonObj:axOriCollect[option.key],parent:undefined});}return new PNode({jsonObj:this.makeDefaultsObjectAtOption(propName),parent:undefined});}if(propName===ENUM_FORMAT_TAG.LINE_MARKER_COLOR){var colorObj={},gmCtr=this.GMController,cbTp=gmCtr.model.colorType,lnMkColor=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.LINE_MARKER_COLOR),finalRes;if(lnMkColor===undefined){if(cbTp===COLOR_BY_TYPE.NULL){finalRes=gmCtr.getVolatileDefaultsForShape(gmCtr.getChartInfo().shape);}colorObj[ENUM_FORMAT_TAG.LINE_MARKER_COLOR]=finalRes&&finalRes[ENUM_FORMAT_TAG.SHAPE_FILL_COLOR];colorObj[ENUM_FORMAT_TAG.LINE_MARKER_COLOR+DEFAULT_TAG]=true;}else{colorObj[ENUM_FORMAT_TAG.LINE_MARKER_COLOR]=lnMkColor;colorObj[ENUM_FORMAT_TAG.LINE_MARKER_COLOR+DEFAULT_TAG]=false;}return getWrapperForObject(colorObj);}return this.readPropertiesUniformly(propName,option);},readPropertiesUniformly:function(propName,option){var len,i,firstTpPropV,tpPropV,currentValue,propValueAtOption,singlePropNames=$GMProp.getUnderlyingPropertyNameWithAll(propName);len=singlePropNames.length;if(len>1){firstTpPropV=this.getWidgetPropertyValue(singlePropNames[0]);for(i=1;i<len;i++){tpPropV=getRealPropValue(singlePropNames[i],this.getWidgetPropertyValue(singlePropNames[i]));if(tpPropV!==firstTpPropV){if(propName===ENUM_FORMAT_TAG.ALL_GRID_LINES_SHOW){if(firstTpPropV===PRP_GRID_LINE.SHOW&&tpPropV===PRP_GRID_LINE.HIDE){return PRP_GRID_LINE.SHOW_MAJOR_ONLY;}}return undefined;}}return firstTpPropV;}currentValue=this.getWidgetPropertyValue(propName);if(option!==undefined){if(currentValue!==undefined){propValueAtOption=currentValue[option.key];if(propValueAtOption!==undefined){return new PNode({jsonObj:propValueAtOption,parent:undefined});}propValueAtOption=this.makeDefaultsObjectAtOption(propName);}else{propValueAtOption=this.makeDefaultsObjectAtOption(propName);}return getWrapperForObject(propValueAtOption);}if(currentValue!==undefined){return getWrapperForObject(currentValue);}if(COMPLEX_PROPERTY.indexOf(propName)>=0){return new PNode({jsonObj:{},parent:undefined});}return undefined;},writeGlobalProperty:function writeGlobalProperty(propName,newValue,option,holdSumbitAndEvent,associatedPropValueTuples){var me=this,callback,handleConfig=getDefaultHandleConfig();me.GMController.clearShapeFormatsCache();if(propName!==""&&propName!==undefined){if(this.syning){return ;}if(propName===ENUM_FORMAT_TAG.COLOR_SQUARE_COLOR){if(this.colorSqureIdentity){this.updateColorByMap([this.colorSqureIdentity.comb],newValue);}return ;}if(propName.indexOf("CmbStyle")!==-1){handleConfig=this.processCombineLineStyle(propName,newValue,option);}else{if(propName===ENUM_XML_TAG.TREND_LINE_DEF){handleConfig=this.processTrendLine(propName,newValue,option);}else{if(propName===ENUM_XML_TAG.REF_LINE_DEF){handleConfig=this.processReferenceLine(propName,newValue,option);}else{if(propName===ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF){handleConfig=this.processTrendLineForcast(propName,newValue,option,holdSumbitAndEvent);}else{if(propName===ENUM_XML_TAG.AXIS_SCALE_DATA){handleConfig=this.processAxisScale(propName,newValue,option,holdSumbitAndEvent);}else{if(propName===ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL){handleConfig=this.processMetricLevelDataLabel(propName,newValue,option);}else{if(propName===ENUM_XML_TAG.AXIS_ORIGIN){handleConfig=this.processAxisOrigin(propName,newValue,option);}else{if(propName===ENUM_FORMAT_TAG.ALL_GRID_LINES_SHOW){handleConfig=this.processGridLineShow(propName,newValue);}else{if(propName===ENUM_FORMAT_TAG.LINE_MARKER_COLOR){handleConfig=this.processLineMarkColor(propName,newValue);}else{handleConfig=this.processPropertiesUniformly(propName,newValue,option,associatedPropValueTuples);}}}}}}}}}}if(holdSumbitAndEvent){return ;}callback=this.getPropertyUpdateCallback(propName,newValue,option,associatedPropValueTuples,handleConfig.suppressData);if(handleConfig.suppressData){me.partialUpdate(propName,{allVal:newValue},handleConfig.needRefresh,option);if(callback.success){callback.success();}}this.submitUpdatesAndPersistXML(handleConfig.actions,callback,handleConfig.undoRedoCallback,handleConfig.suppressData,false,handleConfig.puFiltersConfig);},getRaiseEventCallback:function(propName,newValue,option,associatedPropValueTuples){var widgetId=this.id;return{success:function(){var me=$MOJO.all[widgetId];me.syning=true;if(propName===ENUM_FORMAT_TAG.MODIFIED_DEF_FILL_COLOR){me.raiseEventShapeFormattingChanged(ENUM_FORMAT_TAG.SHAPE_FILL_COLOR);}else{me.raiseEventGlobalPropertyChanged(propName,newValue,option||{});}if(associatedPropValueTuples){associatedPropValueTuples.forEach(function(pTuple){me.raiseEventGlobalPropertyChanged(pTuple.name,pTuple.value,pTuple.option);});}$ARR.forEach($GMProp.propertyMap[propName],function(prop){me.raiseEventGlobalPropertyChanged(prop,me.readGlobalProperty(prop,option),option||{});});me.syning=false;}};},getPropertyUpdateCallback:function(propName,newValue,option,associatedPropValueTuples,suppressData){var dzAndPpUpdate=false,dzCallBack,callback={},raiseEventCallBack;if(propName===ENUM_XML_TAG.SHAPE||propName===ENUM_XML_TAG.METRIC_SHAPES||propName===ENUM_XML_TAG.SUB_TYPE){dzAndPpUpdate=true;}if(!dzAndPpUpdate){raiseEventCallBack=this.getRaiseEventCallback(propName,newValue,option,associatedPropValueTuples);$WRAP(raiseEventCallBack,callback);}if(!suppressData){if(dzAndPpUpdate){$WRAP(this.getXTabRefreshCallBack(),callback);}else{$WRAP(this.getDocModelSliceCallback(),callback);}}else{if(dzAndPpUpdate){dzCallBack=this.zonesModel.getUpdateCallback();$WRAP(dzCallBack,callback);}}return callback;},processCombineLineStyle:function(propName,newValue,option){var me=this,widgetId=this.id,ret=getDefaultHandleConfig(),undoValue=this.readGlobalProperty(propName,option),oldValues=[],doRefresh,updateLineStyleAndThickness=function(widget,value){var thkProp=propName.replace("CmbStyle","Thk"),ceLnStyle=propName.replace("CmbStyle","Style"),cmbObj=getOriginalThicknessAndStyle(value),thkV=cmbObj.thk,ceLnStyleV=cmbObj.ceLnStyle;widget.writeGlobalProperty(thkProp,thkV,option,true);widget.writeGlobalProperty(ceLnStyle,ceLnStyleV,option,true);};$GMProp.getUnderlyingPropertyNameWithAll(propName.replace("CmbStyle","Thk")).forEach(function(pn){oldValues.push(me.getWidgetPropertyValue(pn));});updateLineStyleAndThickness(this,newValue);ret.needRefresh=needRefresh(propName,newValue,oldValues);doRefresh=ret.needRefresh;ret.undoRedoCallback={undo:function(){var widget=$MOJO.all[widgetId];updateLineStyleAndThickness(widget,undoValue);widget.doUpdateOnUndoRedo(propName,undoValue,{allVal:undoValue},doRefresh,option,undefined);},redo:function(){var widget=$MOJO.all[widgetId];updateLineStyleAndThickness(widget,newValue);widget.doUpdateOnUndoRedo(propName,newValue,{allVal:newValue},doRefresh,option,undefined);}};return ret;},processTrendLine:function(propName,newValue,option){var gPropsJSON,key,trendJson,undoPropValConfig,me=this,ret=getDefaultHandleConfig(),modifiedKeys=newValue.modifiedPropertyKeys,seaChg=false,fcstChg=false,trendDef=this.GMController.trConfigPool,chtInfo=this.getChartInfo(),isABL=chtInfo.isABL;if(option===undefined){ret.suppressData=false;gPropsJSON=newValue.jsonObj;modifiedKeys.forEach(function(mk){if(mk===ENUM_XML_TAG.TREND_SEASONALITY){seaChg=true;}else{fcstChg=true;}});for(key in trendDef){if(key.length===32&&trendDef.hasOwnProperty(key)){trendJson=trendDef[key];if(trendJson.existing&&(seaChg||fcstChg)){me.collectABLForecastActions(gPropsJSON,key,ret.actions);}}}}else{trendJson=newValue.jsonObj;if(isABL){gPropsJSON=this.readGlobalProperty(propName,undefined).jsonObj;}else{gPropsJSON=undefined;}undoPropValConfig=getUndoPropValConfig(modifiedKeys,trendJson.fmt);ret.suppressData=!requireDataForTrendRef.call(me,newValue,option,true);me.collectTrendLineAction(trendJson,ret.actions,option.key);this.checkCustomScaleNotificationForTrendLine(option.key);if(isABL){if(isABLForecastProps(modifiedKeys)){me.collectABLForecastActions(gPropsJSON,option.key,ret.actions);}if(modifiedKeys[0]===ENUM_XML_TAG.TREND_TYPE&&this.isSeasonalityEnabled()&&(trendJson[ENUM_XML_TAG.TREND_TYPE]===$GM.EnumTrendLineModelType.LOG||trendJson[ENUM_XML_TAG.TREND_TYPE]===$GM.EnumTrendLineModelType.POW)){this.trendSeasonalityError=true;}}ret.needRefresh=needRefresh(propName,newValue,[]);this.getUndoRedoCallBackForTrdRefLine(ret,propName,newValue,undoPropValConfig,ret.needRefresh,option,true);}return ret;},getPartialUpdateFilterConfigForRefLine:function(){return{data:{include:{dz:true,gsi:true,ghs:true,trendref:true}}};},processReferenceLine:function(propName,newValue,option){var me=this,undoPropValConfig,ret=getDefaultHandleConfig(),gmCtr=this.GMController,modifiedKeys=newValue.modifiedPropertyKeys,refJSON=newValue.jsonObj,updateRefLabel=false,optKeyPair=option.key.split(","),axisKey=optKeyPair[0],refTpKey=optKeyPair[1];if(modifiedKeys[0]===ENUM_XML_TAG.REF_CONST_VALUE){newValue.setProperty(ENUM_XML_TAG.REF_ENABLED,true);}if(modifiedKeys.indexOf(ENUM_XML_TAG.REF_SHOW_LABEL)>=0){updateRefLabel=true;}if(modifiedKeys.indexOf(ENUM_XML_TAG.REF_ENABLED)>=0&&newValue.jsonObj[ENUM_XML_TAG.REF_ENABLED]){updateRefLabel=true;}if(updateRefLabel){if(refJSON[ENUM_XML_TAG.REF_SHOW_LABEL]){if(refJSON[ENUM_XML_TAG.REF_LABEL_TYPE]<=0){newValue.setProperty(ENUM_XML_TAG.REF_LABEL_TYPE,$RLT.DssModelLabelsType);}}else{newValue.setProperty(ENUM_XML_TAG.REF_LABEL_TYPE,$RLT.DssModelLabelsNone);}}undoPropValConfig=getUndoPropValConfig(modifiedKeys,getRefDefByOption.call(this,option));ret.puFiltersConfig=this.getPartialUpdateFilterConfigForRefLine();if(gmCtr.isStacked&&!gmCtr.splitPlottingMetrics){refJSON.dropzoneId=(axisKey==="YAxis"||axisKey==="Y2Axis")?4:3;refJSON.subAxis=axisKey.search("2")>=0?1:0;}else{refJSON.metricId=axisKey;}refJSON[ENUM_XML_TAG.REF_TYPE]=$RMT[refTpKey];if(refJSON[ENUM_XML_TAG.REF_ENABLED]===false&&modifiedKeys.indexOf(ENUM_XML_TAG.REF_ENABLED)>=0){ret.suppressData=false;me.collectRemoveRefLineAction(refJSON,ret.actions);}else{ret.suppressData=!requireDataForTrendRef.call(me,newValue,option,false);if(gmCtr.isStacked&&!gmCtr.splitPlottingMetrics){axisKey=undefined;}me.collectRefLineAction(refJSON,ret.actions,axisKey);}ret.needRefresh=needRefresh(propName,newValue,[]);this.getUndoRedoCallBackForTrdRefLine(ret,propName,newValue,undoPropValConfig,ret.needRefresh,option,false);return ret;},processTrendLineForcast:function(propName,newValue,option,holdSumbitAndEvent){var ret=getDefaultHandleConfig(),gmCtr=this.GMController;ret.suppressData=false;if(holdSumbitAndEvent){mergeModifiedPropertyToObject((gmCtr[ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF])[option.key],newValue,true);}var bubbleForeCastJSON=newValue.jsonObj,bbFstInfo=getTrendRefInfo(bubbleForeCastJSON);if(typeof bbFstInfo.max==="number"){bbFstInfo.max=String(bbFstInfo.max);}if(typeof bbFstInfo.min==="number"){bbFstInfo.min=String(bbFstInfo.min);}bbFstInfo.metricId=option.key;ret.actions.push(this.getUpdateForecastInfoAction(bbFstInfo));return ret;},generateUndoRedoConfigForAxisConfig:function(propName,newValue,option,isUndo,needSerialize){var value,associatedOptions,config={},thisConfig=isUndo?this.undoPropValConfig:this.redoPropValConfig,modifiedKeys=this.undoPropValConfig.modifiedKeys,jsonCollection=thisConfig[propName];config[propName]=needSerialize?AXIS_SCALE.serializeCollection2String(jsonCollection):jsonCollection;if(thisConfig.hasOwnProperty(ENUM_XML_TAG.AXIS_SCALE)){config[ENUM_XML_TAG.AXIS_SCALE]=thisConfig[ENUM_XML_TAG.AXIS_SCALE];}associatedOptions=getAssociatedOptionsForPropPanelUpdate(propName,modifiedKeys,jsonCollection,option.key!=="AllMetrics");if(isUndo){value=cloneAndReplacePNodeObj(newValue,jsonCollection[option.key],false,modifiedKeys);return{undoPropValConfig:config,associatedOptionsForUndo:associatedOptions,undoValue:value};}delete this.undoPropValConfig;delete this.redoPropValConfig;return{redoPropValConfig:config,associatedOptionsForRedo:associatedOptions,redoValue:newValue};},updateUndoRedoConfigForAxisConfig:function(isUndo,propName,value,forceUpdate){if(!this.undoPropValConfig){this.undoPropValConfig={modifiedKeys:[]};}if(!this.redoPropValConfig){this.redoPropValConfig={};}var thisConfig=isUndo?this.undoPropValConfig:this.redoPropValConfig,updateConfigValue=function(config,value){var realVal;if($ARR.isArray(value)){realVal=config[propName];$ARR.forEach(value,function(item){if(realVal.indexOf(item)<0){realVal.push(item);}});}else{if(typeof value==="object"){realVal=$HASH.clone(value);}else{realVal=value;}}config[propName]=realVal;};if(forceUpdate||!thisConfig.hasOwnProperty(propName)){updateConfigValue(thisConfig,value);}},processAxisScale:function(propName,newValue,option,holdSumbitAndEvent){var key,axScaleDataArr,axScaleCollection,strNewAxisScale,undoConfig,redoConfig,ret=getDefaultHandleConfig(),modifiedKeys=newValue.modifiedPropertyKeys;axScaleDataArr=this.getWidgetPropertyValue(propName);axScaleCollection=AXIS_SCALE.createAxisScaleCollectionFromArrays(axScaleDataArr);this.updateUndoRedoConfigForAxisConfig(true,propName,axScaleCollection);if(newValue.jsonObj.scaleType!==PRP_AXIS_SCALE.CUSTOM&&modifiedKeys[0]!==ENUM_XML_TAG.LOG_SCALE){ret.suppressData=false;ret.puFiltersConfig={data:{include:{extrs:true}}};}if(modifiedKeys[0]!==ENUM_XML_TAG.LOG_SCALE){this.updateUndoRedoConfigForAxisConfig(true,ENUM_XML_TAG.AXIS_SCALE,this.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE));this.setWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE,PRP_AXIS_SCALE.CUSTOM);this.updateUndoRedoConfigForAxisConfig(false,ENUM_XML_TAG.AXIS_SCALE,PRP_AXIS_SCALE.CUSTOM,true);}else{this.logScaleChanged=true;}if(modifiedKeys[0]===ENUM_XML_TAG.SINGLE_AXIS_SCALE_TYPE&&newValue.jsonObj[ENUM_XML_TAG.SINGLE_AXIS_SCALE_TYPE]!==PRP_AXIS_SCALE.CUSTOM){newValue.setProperty(ENUM_XML_TAG.AXIS_SCALE_MANUAL_MIN,newValue.jsonObj[ENUM_XML_TAG.AXIS_SCALE_REAL_MIN]);newValue.setProperty(ENUM_XML_TAG.AXIS_SCALE_MANUAL_MAX,newValue.jsonObj[ENUM_XML_TAG.AXIS_SCALE_REAL_MAX]);newValue.setProperty(ENUM_XML_TAG.AXIS_SCALE_AUTO_MIN,false);newValue.setProperty(ENUM_XML_TAG.AXIS_SCALE_AUTO_MAX,false);}if(option.key==="AllMetrics"){var associatedProps=[ENUM_XML_TAG.AXIS_SCALE_AUTO_MIN,ENUM_XML_TAG.AXIS_SCALE_AUTO_MAX,ENUM_XML_TAG.AXIS_SCALE_MANUAL_MIN,ENUM_XML_TAG.AXIS_SCALE_MANUAL_MAX,ENUM_XML_TAG.SINGLE_AXIS_SCALE_TYPE];var hitIdx=associatedProps.indexOf(modifiedKeys[0]);if(hitIdx>=0){$ARR.forEach(associatedProps,function(item){if(modifiedKeys.indexOf(item)<0){modifiedKeys.push(item);}});}for(key in axScaleCollection){if(key!=="AllMetrics"&&axScaleCollection.hasOwnProperty(key)){mergeModifiedPropertyToObject(axScaleCollection[key],newValue,true);}}}else{mergeModifiedPropertyToObject(axScaleCollection[option.key],newValue,true);}delete axScaleCollection.AllMetrics;strNewAxisScale=AXIS_SCALE.serializeCollection2String(axScaleCollection);this.setWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE_DATA,strNewAxisScale);if(!ret.suppressData){this.setWidgetPropertyValue("axScaleModified",1);}this.updateUndoRedoConfigForAxisConfig(true,"modifiedKeys",modifiedKeys,true);this.updateUndoRedoConfigForAxisConfig(false,propName,axScaleCollection,true);if(!holdSumbitAndEvent){undoConfig=this.generateUndoRedoConfigForAxisConfig(propName,newValue,option,true,true);redoConfig=this.generateUndoRedoConfigForAxisConfig(propName,newValue,option,false,true);this.getUndoRedoCallBackForAxisConfig(ret,propName,undoConfig,redoConfig,true,option);}return ret;},processMetricLevelDataLabel:function(propName,newValue,option){var ret=getDefaultHandleConfig(),key,widgetId=this.id,allMetricTrue=true,oriShowHideDL=this.readGlobalProperty(propName),oriShowHideDLJSON=oriShowHideDL.jsonObj,oldValue=oriShowHideDLJSON[option.key],redoJsonValue,undoJsonValue=$HASH.clone(oriShowHideDLJSON);if(option.key==="AllMetrics"){for(key in oriShowHideDLJSON){if(oriShowHideDLJSON.hasOwnProperty(key)){oriShowHideDLJSON[key]=newValue;}}}else{oriShowHideDLJSON[option.key]=newValue;for(key in oriShowHideDLJSON){if(key!=="AllMetrics"&&oriShowHideDLJSON.hasOwnProperty(key)){if(oriShowHideDLJSON[key]===false){allMetricTrue=false;}}}if(oriShowHideDLJSON.AllMetrics!==undefined){oriShowHideDLJSON.AllMetrics=allMetricTrue;}}this.setWidgetPropertyValue(propName,oriShowHideDLJSON);redoJsonValue=oriShowHideDLJSON;ret.undoRedoCallback={undo:function(){var widget=$MOJO.all[widgetId];widget.setWidgetPropertyValue(propName,undoJsonValue);widget.doUpdateOnUndoRedo(propName,oldValue,{allVal:oldValue},true,option,undefined);},redo:function(){var widget=$MOJO.all[widgetId];widget.setWidgetPropertyValue(propName,redoJsonValue);widget.doUpdateOnUndoRedo(propName,newValue,{allVal:newValue},true,option,undefined);}};return ret;},processAxisOrigin:function(propName,newValue,option){var key,undoConfig,redoConfig,ret=getDefaultHandleConfig(),modifiedKeys=newValue.modifiedPropertyKeys,oriAxOriObject=this.readGlobalProperty(propName),oriAxOriJSON=oriAxOriObject.jsonObj,allAuto=true,allValue=null;if(modifiedKeys[0]===ENUM_XML_TAG.AXIS_ORIGIN_AUTO&&newValue.jsonObj[ENUM_XML_TAG.AXIS_ORIGIN_AUTO]===true){newValue.jsonObj[ENUM_XML_TAG.AXIS_ORIGIN_VALUE]=0;modifiedKeys.push(ENUM_XML_TAG.AXIS_ORIGIN_VALUE);}this.updateUndoRedoConfigForAxisConfig(true,propName,oriAxOriJSON);if(option.key==="AllMetrics"){if(modifiedKeys[0]===ENUM_XML_TAG.AXIS_ORIGIN_VALUE){modifiedKeys.push(ENUM_XML_TAG.AXIS_ORIGIN_AUTO);}for(key in oriAxOriJSON){if(oriAxOriJSON.hasOwnProperty(key)){mergeModifiedPropertyToObject(oriAxOriJSON[key],newValue);}}if(oriAxOriJSON.AllMetrics===undefined){oriAxOriJSON.AllMetrics=$HASH.copy(newValue.jsonObj);}}else{mergeModifiedPropertyToObject(oriAxOriJSON[option.key],newValue);$HASH.forEach(oriAxOriJSON,function(v,n){if(n!=="AllMetrics"){allAuto=allAuto&&v.axOriAuto;if(allValue===null){allValue=v.axOriValue;}else{if(allValue!==undefined){if(allValue!==v.axOriValue){allValue=undefined;}}}}});oriAxOriJSON.AllMetrics={axOriAuto:allAuto,axOriValue:allValue};}this.setWidgetPropertyValue(propName,oriAxOriJSON);this.setWidgetPropertyValue(ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_SHOW,true);this.setWidgetPropertyValue(ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_SHOW,true);this.updateUndoRedoConfigForAxisConfig(true,"modifiedKeys",modifiedKeys,true);this.updateUndoRedoConfigForAxisConfig(false,propName,oriAxOriJSON,true);undoConfig=this.generateUndoRedoConfigForAxisConfig(propName,newValue,option,true,false);redoConfig=this.generateUndoRedoConfigForAxisConfig(propName,newValue,option,false,false);this.getUndoRedoCallBackForAxisConfig(ret,propName,undoConfig,redoConfig,true,option);return ret;},processGridLineShow:function(propName,newValue){var ret=getDefaultHandleConfig(),widgetId=this.id,undoValue=this.readGlobalProperty(propName),updateGridLineShow=function(widget,gridLineShowValue){var majorShow=gridLineShowValue,minorShow=gridLineShowValue;if(gridLineShowValue===PRP_GRID_LINE.SHOW_MAJOR_ONLY){majorShow=PRP_GRID_LINE.SHOW;minorShow=PRP_GRID_LINE.HIDE;}widget.setWidgetPropertyValue(ENUM_FORMAT_TAG.MAJOR_GRID_LINES_SHOW,majorShow);widget.setWidgetPropertyValue(ENUM_FORMAT_TAG.MINOR_GRID_LINES_SHOW,minorShow);};updateGridLineShow(this,newValue);ret.undoRedoCallback={undo:function(){var widget=$MOJO.all[widgetId];updateGridLineShow(widget,undoValue);widget.doUpdateOnUndoRedo(propName,undoValue,{allVal:undoValue},true,undefined,undefined);},redo:function(){var widget=$MOJO.all[widgetId];updateGridLineShow(widget,newValue);widget.doUpdateOnUndoRedo(propName,newValue,{allVal:newValue},true,undefined,undefined);}};return ret;},processLineMarkColor:function(propName,newValue){var widgetId=this.id,ret=getDefaultHandleConfig(),oldValue=this.readGlobalProperty(propName),originNewValue=$HASH.clone(newValue),updateLineMarkColor=function(widegt,value,useOrigin){var resolvedValue=useOrigin?value:$HASH.clone(value),lnMrClrValue=value.jsonObj[propName],newLnMrClr;if(lnMrClrValue==="default"){widegt.removeWidgetProperty(propName);}else{widegt.setWidgetPropertyValue(propName,lnMrClrValue);}newLnMrClr=widegt.readGlobalProperty(propName);resolvedValue.jsonObj[propName]=newLnMrClr.jsonObj[propName];resolvedValue.jsonObj[propName+DEFAULT_TAG]=newLnMrClr.jsonObj[propName+DEFAULT_TAG];return resolvedValue;},updateUndoRedoFunc=function(value){var widget=$MOJO.all[widgetId],resolvedValue=updateLineMarkColor(widget,value);widget.doUpdateOnUndoRedo(propName,resolvedValue,{allVal:resolvedValue},true,undefined,undefined);};oldValue.modifiedPropertyKeys.push(propName);updateLineMarkColor(this,newValue,true);ret.undoRedoCallback={undo:function(){updateUndoRedoFunc(oldValue);},redo:function(){updateUndoRedoFunc(originNewValue);}};return ret;},processPropertiesUniformly:function(propName,newValue,option,associatedPropValueTuples){var me=this,ret=getDefaultHandleConfig(),singlePropNames,chtInfo=this.getChartInfo(),undoPropValConfig={},oldValues=[];if(propName===ENUM_XML_TAG.SUB_TYPE){getSortAction.call(this,newValue,ret);}singlePropNames=$GMProp.getUnderlyingPropertyNameWithAll(propName);$ARR.forEach(singlePropNames,function(pn){if(ret.suppressData){ret.suppressData=!needRetrieveData.call(me,pn,newValue,chtInfo);}undoPropValConfig[pn]=me.getWidgetPropertyValue(pn);if(option&&undoPropValConfig[pn]){undoPropValConfig[pn]=undoPropValConfig[pn][option.key];}if(pn.indexOf("FntStyle")>=0||pn.indexOf("LnThk")>=0){oldValues.push(undoPropValConfig[pn]);}setSimplePropertyValue.call(me,pn,newValue,option);});ret.needRefresh=needRefresh(propName,newValue,oldValues);this.getUndoRedoCallBackForUniformProperty(ret,propName,newValue,undoPropValConfig,ret.needRefresh,option,associatedPropValueTuples);return ret;},getUndoRedoCallBackForUniformProperty:function(ret,propName,newValue,undoPropValConfig,needRefresh,option,associatedPropValueTuples){var widgetId=this.id,associatedProp;if(ret.suppressData){if(associatedPropValueTuples&&associatedPropValueTuples[0]){associatedProp=$HASH.clone(associatedPropValueTuples);associatedProp[0].value=false;}ret.undoRedoCallback={undo:function(){var prop,propVal,widget=$MOJO.all[widgetId],undoValues=[];for(prop in undoPropValConfig){if(undoPropValConfig.hasOwnProperty(prop)){propVal=undoPropValConfig[prop];setSimplePropertyValue.call(widget,prop,propVal,option,true);propVal=getRealPropValue(prop,propVal);undoValues.push(propVal);}}widget.doUpdateOnUndoRedo(propName,getCombinedValue(undoValues),undoPropValConfig,needRefresh,option,associatedProp);},redo:function(){var widget=$MOJO.all[widgetId],singlePropNames=$GMProp.getUnderlyingPropertyNameWithAll(propName);$ARR.forEach(singlePropNames,function(pn){setSimplePropertyValue.call(widget,pn,newValue,option);});widget.doUpdateOnUndoRedo(propName,newValue,{allVal:newValue},needRefresh,option,associatedPropValueTuples);}};}},getUndoRedoCallBackForTrdRefLine:function(ret,propName,newValue,undoPropValConfig,needRefresh,option,isTrend){var widgetId=this.id,undoValue;if(ret.suppressData){undoValue=cloneAndReplacePNodeObj(newValue,undoPropValConfig,true);ret.undoRedoCallback={undo:function(){var widget=$MOJO.all[widgetId];requireDataForTrendRef.call(widget,undoValue,option,isTrend);widget.doUpdateOnUndoRedo(propName,undoValue,{allVal:undoValue},needRefresh,option,undefined);},redo:function(){var widget=$MOJO.all[widgetId];requireDataForTrendRef.call(widget,newValue,option,isTrend);widget.doUpdateOnUndoRedo(propName,newValue,{allVal:newValue},needRefresh,option,undefined);}};}},getUndoRedoCallBackForAxisConfig:function(ret,propName,undoConfig,redoConfig,needRefresh,option){var widgetId=this.id,updateWidgetValue;if(ret.suppressData){updateWidgetValue=function(widget,valConfig){var prop;for(prop in valConfig){if(valConfig.hasOwnProperty(prop)){widget.setWidgetPropertyValue(prop,valConfig[prop]);}}};ret.undoRedoCallback={undo:function(){var widget=$MOJO.all[widgetId];updateWidgetValue(widget,undoConfig.undoPropValConfig);widget.doUpdateOnUndoRedo(propName,undoConfig.undoValue,{allVal:undoConfig.undoValue},needRefresh,option,undoConfig.associatedOptionsForUndo);},redo:function(){var widget=$MOJO.all[widgetId];updateWidgetValue(widget,redoConfig.redoPropValConfig);widget.doUpdateOnUndoRedo(propName,redoConfig.redoValue,{allVal:redoConfig.redoValue},needRefresh,option,redoConfig.associatedOptionsForRedo);}};}},doUpdateOnUndoRedo:function(propName,newValue,valueConfig,needRefresh,option,associatedPropValueTuples){var callback;this.partialUpdate(propName,valueConfig,needRefresh,option,true);callback=this.getPropertyUpdateCallback(propName,newValue,option,associatedPropValueTuples,true);if(callback.success){callback.success();}},processChangeShape:function processChangeShape(shapeId){var itemsToDelete=[],me=this,dropZone=me.GMController.dz,sliceItems=dropZone.SliceBy.TemplateUnit||[],angleItems=dropZone.AngleBy.TemplateMetric||[],sizeByItems=dropZone.SizeBy.TemplateMetric||[],allowedItems=getTemplateAttribute.call(me);this.zonesModel.CARDLIMIT=CARDLIMIT;this.zonesModel.checkAndWarnLargeItemsForAddUnits(allowedItems,function(){if(dropZone.SliceBy.MetricNames!==undefined){sliceItems.push(METRIC_NAMES_ITEM);}if(shapeId===PRP_SHAPE.AREA){$ARR.forEach(sizeByItems,function(item){item.zone=8;if(!item.did){item.did=item.id;}item.cs=1;});itemsToDelete=sizeByItems;}if(shapeId!==PRP_SHAPE.PIE&&shapeId!==PRP_SHAPE.RING){$ARR.forEach(sliceItems,function(item){item.zone=6;if(!item.did){item.did=item.id;}item.cs=1;});$ARR.forEach(angleItems,function(item){item.zone=10;if(!item.did){item.did=item.id;}item.cs=1;});itemsToDelete=(itemsToDelete||[]).concat((angleItems.concat(sliceItems||[])));}if(itemsToDelete.length>0){me.changeShapeProperty(ENUM_XML_TAG.SHAPE,shapeId);me.zonesModel.gmZones.deleteItems(itemsToDelete);}else{me.writeGlobalProperty(ENUM_XML_TAG.SHAPE,shapeId);}});},getPartialUpdateType:function(propName){if(LAYOUT_RERENDER_ALL_PROPERTY.indexOf(propName)>=0){return ENUM_PARTIAL_UPDATE_TYPE.UPDATE_ALL;}if(UPDATE_CHARTS_PROPERTY.indexOf(propName)>=0){return ENUM_PARTIAL_UPDATE_TYPE.UPDATE_CHARTS;}if(SPLITTER_LINE_SCALE_PROPERTY.indexOf(propName)>=0){return ENUM_PARTIAL_UPDATE_TYPE.SPLITTER_LINE_SCALE;}if(CHART_SCALE_PROPERTY.indexOf(propName)>=0){return ENUM_PARTIAL_UPDATE_TYPE.CHART_SCALE;}return ENUM_PARTIAL_UPDATE_TYPE.UNKNOW;},partialUpdate:function(propName,newValue,needRefresh,option,isUndoRedo){var singlePropNames,ret,me=this,handled=false;if(this.noData){return ;}GMUTIL.startTimer({functionName:"VisGraphMatrix.partialUpdate",purpose:"Partial update of GraphMatrix ("+this.k+")"});singlePropNames=$GMProp.getUnderlyingPropertyNameWithAll(propName);this.resetAxisProps(singlePropNames);this.resetHTML5Props();this.configureTrendAndRefLine(propName);this.resetGMCtrlCache(propName,newValue);this.setUpForceUpdateFlag(propName);handled=checkForPartialUpdate(propName,newValue);if(needRefresh&&!handled){handled=this.handlePartialUpdate(this.getPartialUpdateType(propName),isUndoRedo);}if(!handled){if(DO_NOT_SEPARATE_PROPERTY.indexOf(propName)>=0){singlePropNames=[propName];}singlePropNames.forEach(function(pn){ret=me.updateSingleProperty(pn,newValue,needRefresh,option);handled=handled||ret;});}this.clearForceUpdateFlag();if(!handled){this.clientRerenderGraphMatrix();}GMUTIL.endTimer();},handlePartialUpdate:function(type,isUndoRedo){var gmCtr=this.GMController;switch(type){case ENUM_PARTIAL_UPDATE_TYPE.UPDATE_CHARTS:this.updateCharts();break;case ENUM_PARTIAL_UPDATE_TYPE.UPDATE_ALL:gmCtr.reRenderGM();break;case ENUM_PARTIAL_UPDATE_TYPE.CHART_SCALE:if(isUndoRedo){gmCtr.reRenderGM();}else{this.onControlResized();}break;case ENUM_PARTIAL_UPDATE_TYPE.SPLITTER_LINE_SCALE:if(isUndoRedo){gmCtr.reRenderGM();}else{this.onControlResized(false,false,true,true);}break;default:return false;}return true;},updateSingleProperty:function(propName,newValue,needRefresh,option){var modifiedKey,subPropName={},manager=this.manager,HTML5PROPS=this.HTML5PROPS,allVal=newValue[ALL_VALUE],value=newValue.hasOwnProperty(propName)?newValue[propName]:allVal,GMC=this.GMController;switch(propName){case ENUM_FORMAT_TAG.BG_COLOR:case ENUM_FORMAT_TAG.BG_FILL_TRANSPARENCY:break;case ENUM_FORMAT_TAG.ROW_HEADER_FILL_COLOR:case ENUM_FORMAT_TAG.ROW_HEADER_FILL_TRANSPARENCY:this.updateRowValueBackground();this.updateHeaderTitle("row","bg");break;case ENUM_FORMAT_TAG.ROW_HEADER_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.ROW_HEADER_TEXT_FONT_STYLE:case ENUM_FORMAT_TAG.ROW_HEADER_TEXT_ALIGNMENT_HORIZONTAL:case ENUM_FORMAT_TAG.ROW_HEADER_TEXT_ALIGNMENT_VERTICAL:this.updateHeaderTitle("row","font");break;case ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_FONT_STYLE:case ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL:case ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL:manager.updateSubSetOfVSlaves("row",GMC.metricNamesOnRowMetricsOnXAxis);break;case ENUM_FORMAT_TAG.COLUMN_HEADER_FILL_COLOR:case ENUM_FORMAT_TAG.COLUMN_HEADER_FILL_TRANSPARENCY:this.updateColumnValueBackground();this.updateHeaderTitle("col","bg");break;case ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_FONT_STYLE:case ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_ALIGNMENT_HORIZONTAL:case ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_ALIGNMENT_VERTICAL:this.updateHeaderTitle("col","font");break;case ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_FONT_STYLE:case ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL:case ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_VERTICAL:manager.updateSubSetOfHSlaves("column",GMC.metricNamesOnColumnMetricsOnYAxis);break;case ENUM_FORMAT_TAG.V_MATRIX_LINES_COLOR:case ENUM_FORMAT_TAG.V_MATRIX_LINES_COMBINED_STYLE:this.updateMatrixLineStyle(".gm-matrix-line.v",HTML5PROPS.MATRIX_LINE_V);break;case ENUM_FORMAT_TAG.H_MATRIX_LINES_COLOR:case ENUM_FORMAT_TAG.H_MATRIX_LINES_COMBINED_STYLE:this.updateMatrixLineStyle(".gm-matrix-line.h",HTML5PROPS.MATRIX_LINE_H);break;case ENUM_FORMAT_TAG.X_AXIS_LINE_COLOR:case ENUM_FORMAT_TAG.X_AXIS_LINE_COMBINED_STYLE:this.updateMatrixLineStyle(".gm-axis-line.h",HTML5PROPS.AXIS_LINE_X);break;case ENUM_FORMAT_TAG.Y_AXIS_LINE_COLOR:case ENUM_FORMAT_TAG.Y_AXIS_LINE_COMBINED_STYLE:this.updateMatrixLineStyle(".gm-axis-line.v",HTML5PROPS.AXIS_LINE_Y);break;case ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_COLOR:case ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_COMBINED_STYLE:this.updateOriginLineStyle(propName,"v",".gm-set-originline",value);break;case ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_COLOR:case ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_COMBINED_STYLE:this.updateOriginLineStyle(propName,"h",".gm-set-originline",value);break;case ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_COLOR:case ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_STYLE:this.updateAxisTitleFontStyle("yaxis");break;case ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_COLOR:case ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_STYLE:this.updateAxisLabelFontStyle("yaxis",propName);break;case ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_COLOR:case ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_STYLE:this.updateAxisTitleFontStyle("xaxis");break;case ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_COLOR:case ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_STYLE:this.updateAxisLabelFontStyle("xaxis",propName);break;case ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_COLOR:case ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_STYLE:this.updateAxisLabelFontStyle("allaxis",propName);break;case ENUM_FORMAT_TAG.GRID_LINE_AUTO:case ENUM_FORMAT_TAG.ALL_GRID_LINES_SHOW:case ENUM_FORMAT_TAG.MAJOR_GRID_LINES_SHOW:case ENUM_FORMAT_TAG.MINOR_GRID_LINES_SHOW:case ENUM_FORMAT_TAG.ALL_GRID_LINES_COLOR:case ENUM_FORMAT_TAG.ALL_GRID_LINES_COMBINED_STYLE:case ENUM_FORMAT_TAG.MAJOR_GRID_LINES_COLOR:case ENUM_FORMAT_TAG.MAJOR_GRID_LINES_COMBINED_STYLE:case ENUM_FORMAT_TAG.MINER_GRID_LINES_COLOR:case ENUM_FORMAT_TAG.MINER_GRID_LINES_COMBINED_STYLE:this.hPlaceHGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);this.hPlaceVGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);break;case ENUM_XML_TAG.LEGEND_VISIBLE:case ENUM_XML_TAG.LEGEND_MODE:case ENUM_XML_TAG.SCALE_LEGEND_WIDTH:case ENUM_FORMAT_TAG.LEGEND_BG_COLOR:case ENUM_FORMAT_TAG.LEGEND_BG_FILL_TRANSPARENCY:case ENUM_FORMAT_TAG.LEGEND_FONT_COLOR:case ENUM_FORMAT_TAG.LEGEND_FONT_STYLE:case ENUM_FORMAT_TAG.LEGEND_FONT_SIZE:case ENUM_FORMAT_TAG.LEGEND_FONT_FAMILY:this.legendPartialUpdate(propName,needRefresh);break;case ENUM_XML_TAG.LEGEND_POSITION:if(this.legend){this.legend.updateLegendSlot(value,this.getLegendDockPosIdx(value));}break;case ENUM_FORMAT_TAG.ALL_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.ALL_TEXT_FONT_STYLE:this.updateHeaderTitle("row","font");this.updateHeaderTitle("col","font");manager.updateVSlaves();manager.updateHSlaves();if(newValue.hasOwnProperty(ALL_VALUE)){this.updateChartFontStyle(propName,"all-text",allVal);}else{if(propName.indexOf("FntClr")>=0){subPropName.dl=ENUM_FORMAT_TAG.DATA_LABELS_FONT_COLOR;subPropName.rfl=ENUM_FORMAT_TAG.REF_LABELS_FONT_COLOR;}else{if(propName.indexOf("FntStyle")>=0){subPropName.dl=ENUM_FORMAT_TAG.DATA_LABELS_FONT_STYLE;subPropName.rfl=ENUM_FORMAT_TAG.REF_LABELS_FONT_STYLE;}}this.updateChartFontStyle(propName,CTRL_TYPE.GM_ORIGIN_LABEL);this.updateChartFontStyle(subPropName.dl,CTRL_TYPE.GM_DATA_LABEL,newValue[subPropName.dl]);this.updateChartFontStyle(subPropName.rfl,CTRL_TYPE.GM_REF_LABEL,newValue[subPropName.rfl]);}if(this.legend){this.legend.updateStyle(HTML5PROPS.LEGEND);}break;case ENUM_XML_TAG.BANDING:case ENUM_XML_TAG.AXIS_ORIGIN:case ENUM_XML_TAG.MAX_SIZE_TYPE:case ENUM_XML_TAG.MAX_SIZE_VALUE:case ENUM_XML_TAG.MIN_SIZE_VALUE:case ENUM_XML_TAG.DATA_LABEL:case ENUM_XML_TAG.DATA_LABELS_PLACEMENT:case ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL:case ENUM_FORMAT_TAG.DATA_LABELS_FONT_FAMILY:case ENUM_FORMAT_TAG.DATA_LABELS_FONT_SIZE:this.updateAxisAndCharts(propName);break;case ENUM_XML_TAG.MIN_SIZE_TYPE:if(propName===ENUM_XML_TAG.MIN_SIZE_TYPE&&this.needLegend&&GMC.hasSizeBy()){this.sizeByData=GMC.getSizeByLegendInfo();}this.updateAxisAndCharts(propName);this.hUpdateLegend();break;case ENUM_FORMAT_TAG.DATA_LABELS_FONT_STYLE:if(needRefresh){this.updateAxisAndCharts(propName);}else{this.updateChartFontStyle(propName,CTRL_TYPE.GM_DATA_LABEL,value);}break;case ENUM_FORMAT_TAG.DATA_LABELS_FONT_COLOR:this.updateChartFontStyle(propName,CTRL_TYPE.GM_DATA_LABEL,value);break;case ENUM_XML_TAG.REF_LINE_DEF:modifiedKey=value.modifiedPropertyKeys[0];if(modifiedKey===ENUM_XML_TAG.TREND_REF_LINE_COMBINED_STYLE||modifiedKey===ENUM_XML_TAG.TREND_REF_LINE_COLOR){this.updateTrdAndRefLineStyle(".gm-set-referenceline",value,option);}else{this.updateChartFontStyle(propName,CTRL_TYPE.GM_REF_LABEL,value);}break;case ENUM_XML_TAG.TREND_LINE_DEF:this.updateTrdAndRefLineStyle(".gm-set-trendline",value,option);break;case ENUM_FORMAT_TAG.REF_LABELS_FONT_COLOR:case ENUM_FORMAT_TAG.REF_LABELS_FONT_STYLE:this.updateChartFontStyle(propName,CTRL_TYPE.GM_REF_LABEL,value);break;default:return false;}return true;},getHTML5Props:function(){return this.HTML5PROPS;},resetHTML5Props:function(){var property=this.property,HTML5PROPS=this.HTML5PROPS;property.initHTML5Props(HTML5PROPS);this.applyHTML5Props(HTML5PROPS);this.adjustRHAndCHOpacity();this.postFillGMControllerStyle();},adjustRHAndCHOpacity:function(){var HTML5PROPS=this.HTML5PROPS;var BK=HTML5PROPS.BK;var RH_BK=HTML5PROPS.RH_BK;var CH_BK=HTML5PROPS.CH_BK;if(BK.backgroundColor===RH_BK.backgroundColor){if(RH_BK.opacity<=BK.opacity){RH_BK.opacity=0;}else{RH_BK.opacity-=BK.opacity;}}if(BK.backgroundColor===CH_BK.backgroundColor){if(CH_BK.opacity<=BK.opacity){CH_BK.opacity=0;}else{CH_BK.opacity-=BK.opacity;}}},getAllAxisProperties:function(){var res={},gmCtr=this.GMController,me=this;if(gmCtr.axisFormat){return gmCtr.axisFormat;}AXIS_PROP_NAMES.forEach(function(pn){res[pn]=me.readGlobalProperty(pn);});gmCtr.axisFormat=res;return res;},resetAxisProps:function(singleNames){var axisFormat=this.GMController.axisFormat,me=this,thkProp,ceLnStyle;if(axisFormat){singleNames.forEach(function(outer){if(outer.indexOf("CmbStyle")>=0){thkProp=outer.replace("CmbStyle","Thk");ceLnStyle=outer.replace("CmbStyle","Style");}AXIS_PROP_NAMES.forEach(function(pn){if((pn===outer)||(thkProp&&pn===thkProp)||(ceLnStyle&&pn===ceLnStyle)){axisFormat[pn]=me.readGlobalProperty(pn);}});});}},getDefaultProperties:function(){var defaults=(this.theme===PRP_THEME.LIGHT?$PROP_DEFAULTS.lightTheme():$PROP_DEFAULTS.darkTheme()),docModel=this.getDocModel(),updated=false;if(docModel){var paletteColors=docModel.getCurrentPaletteColors();if(paletteColors&&paletteColors.length){defaults.shpFillClr=defaults.shpLnClr=paletteColors[0];updated=true;}}if(!updated){$PROP_DEFAULTS.update(this.theme,["shpFillClr"]);$PROP_DEFAULTS.update(this.theme,["shpLnClr"]);}return defaults;},configureTrendAndRefLine:function configureTrendAndRefLine(propName){if(propName===ENUM_XML_TAG.TREND_LINE_DEF||propName===ENUM_XML_TAG.REF_LINE_DEF||propName.indexOf("allTxtFnt")>=0||propName.indexOf(REF_LABEL_FONT)>=0){this.GMController.configureTrendLine(this.getData());}},isLogScaleChanged:function isLogScaleChanged(newValue){var value=newValue[ENUM_XML_TAG.AXIS_SCALE_DATA]||newValue[ALL_VALUE];return !!(value&&value.modifiedPropertyKeys&&value.modifiedPropertyKeys[0]===ENUM_XML_TAG.LOG_SCALE);},resetGMCtrlCache:function resetGMCtrlCache(propName,newValue){var GMC=this.GMController;if(propName===ENUM_XML_TAG.MAX_SIZE_TYPE||propName===ENUM_XML_TAG.MAX_SIZE_VALUE||propName===ENUM_XML_TAG.MIN_SIZE_TYPE||propName===ENUM_XML_TAG.MIN_SIZE_VALUE){GMC.initMaxMinSizeProps();}else{if(propName===ENUM_XML_TAG.AXIS_SCALE_DATA){GMC.getAxisScaleMode();GMC.setupDualAxis();if(this.isLogScaleChanged(newValue)){GMC.clearLogScaleCahce();GMC.msgCenter={};}}else{if(propName===ENUM_XML_TAG.DATA_LABEL){GMC.resetDataLabelType();GMC.checkMetricLevelDataLabel();}else{if(propName===ENUM_XML_TAG.DATA_LABELS_PLACEMENT){GMC.resetDataLabelPlacement();GMC.checkMetricLevelDataLabel();}else{if(propName.indexOf("dlFnt")>=0||propName.indexOf("allTxtFnt")>=0){GMC.clearDataLabelFormatCache();}else{if(propName===ENUM_FORMAT_TAG.MODIFIED_DEF_FILL_COLOR||propName===ENUM_FORMAT_TAG.SHAPE_BORDER_COMBINED_STYLE||propName===ENUM_FORMAT_TAG.SHAPE_LINE_COMBINED_STYLE){GMC.resetDefaultShapeProp();}else{if(propName===ENUM_FORMAT_TAG.SHAPE_FILL_TRANSPARENCY){GMC.resetDefaultShapeProp();}else{if(propName===ENUM_XML_TAG.AXIS_ORIGIN){delete GMC.axisFormat;}}}}}}}}},getColorByComb:function getColorByComb(token){var i,levels=token.levels,elements=token.elements,n=levels.length,arr=[];for(i=0;i<n;i++){arr.push({tid:levels[i],eid:elements[i]});}return arr;},updateLegendColorByOpacity:function updateLegendColorByOpacity(){if(!this.colorByData){return ;}var GMC=this.GMController,defProp=GMC.getDefaultsForShape(GMC.getChartInfo().shape),allProp=this.property.readItem(ENUM_FORMAT_TAG.ALL_SHAPE_FORMAT),localProp,res,me=this;if(GMC.colorByInfo.tp===COLOR_BY_TYPE.METRICS){res=GMUTIL.getResolvedFormatsObject([defProp,allProp]);this.colorByData.elements.forEach(function(element){element.opacity=res[ENUM_FORMAT_TAG.SHAPE_FILL_TRANSPARENCY]/100;});}else{this.colorByData.elements.forEach(function(element){localProp=GMC.getShapeFormatsWithCombination(me.getColorByComb(element.token));res=GMUTIL.getResolvedFormatsObject([defProp,allProp,localProp]);element.opacity=res[ENUM_FORMAT_TAG.SHAPE_FILL_TRANSPARENCY]/100;});}},setUpForceUpdateFlag:function(propName){if(propName.indexOf("AxTt")>=0||propName.indexOf("AxLb")>=0||propName.indexOf("allTxtFnt")>=0){this.forceUpdateAxis=true;}var me=this;$ARR.forEach(FORCE_UPDATE_AXIS_PROPERTY,function(pn){if(pn===propName){me.forceUpdateAxis=true;return false;}});},clearForceUpdateFlag:function clearForceUpdateFlag(){delete this.forceUpdateAxis;},updateDummyANodeStyle:function(style){var node=this.domDummyA;if(node.style.display!=="none"){$VISUTILS.applyStyles2DomNode(node,style);node.setAttribute("type",CTRL_TYPE.GM_DUMMY_A);}},updateHeaderTitle:function(type,pn){var className=type==="row"?".gm-rowheader-title":".gm-colheader-title",nodes=this.domNode.querySelectorAll(className),i,n=nodes.length,div,hAlign,vAlign,props=this.HTML5PROPS,bgColor,fontStyle;if(type==="row"){bgColor=props.RH_BK;fontStyle=props.RH_TITLE;hAlign=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_HEADER_TEXT_ALIGNMENT_HORIZONTAL);vAlign=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_HEADER_TEXT_ALIGNMENT_VERTICAL);}else{bgColor=props.CH_BK;fontStyle=props.CH_TITLE;hAlign=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_ALIGNMENT_HORIZONTAL);vAlign=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_ALIGNMENT_VERTICAL);}for(i=0;i<n;i++){div=nodes[i];if(pn==="bg"){$VISUTILS.applyStyles2DomNode(div,bgColor);}else{if(div.getAttribute("type")===null){$VISUTILS.applyStyles2DomNode(div.firstChild.firstChild,fontStyle);}else{GMUTIL.updateTextColorAndAlignment(div,hAlign,vAlign);}}}},updateHeaderValueFontStyle:function(type){var className=type==="row"?"div.gm-rowheader-cell, div.gm-rowheader-cell-dummy":"div.gm-colheader-cell, div.gm-colheader-cell-dummy",nodes=this.domNode.querySelectorAll(className),i,n=nodes.length,div,hAlign,vAlign;if(type==="row"){hAlign=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL);vAlign=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL);}else{hAlign=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL);vAlign=this.getWidgetPropertyValue(ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_VERTICAL);}for(i=0;i<n;i++){div=nodes[i];if(div.getAttribute("class").indexOf("gm-colheader-cell-dummy")>=0&&!this.GMController.metricNamesOnColumnMetricsOnYAxis){continue;}GMUTIL.updateTextColorAndAlignment(div,hAlign,vAlign);}},updateAxisTitleFontStyle:function(type){var className=type==="yaxis"?".gm-yaxis-cell-label .gm-text-body-nowrap":".gm-xaxis-cell-label .gm-text-body-nowrap, .gm-x2axis-cell-label .gm-text-body-nowrap",nodes=this.domNode.querySelectorAll(className),i,n=nodes.length,styles=this.HTML5PROPS[type==="yaxis"?"AXIS_TITLE_Y":"AXIS_TITLE_X"];for(i=0;i<n;i++){$VISUTILS.applyStyles2DomNode(nodes[i],styles);}},updateRowValueBackground:function(){var nodes=this.domRowHeader.childNodes,i,n=nodes.length,style=this.HTML5PROPS.RH_BK;for(i=0;i<n;i++){$VISUTILS.applyStyles2DomNode(nodes[i],style);}if(this.GMController.metricNamesOnRowMetricsOnXAxis){$VISUTILS.applyStyles2DomNode(this.domYAxis,style);}},updateColumnValueBackground:function(){var nodes=this.domColHeader.childNodes,i,n=nodes.length,style=this.HTML5PROPS.CH_BK;for(i=0;i<n;i++){if(i===n-1&&this.colHeaderExtraH>0&&!this.GMController.metricNamesOnColumnMetricsOnYAxis){break;}$VISUTILS.applyStyles2DomNode(nodes[i],style);}},updateMatrixLineStyle:function(className,style){var nodes=this.domNode.querySelectorAll(className),lineBody,i,n=nodes.length;for(i=0;i<n;i++){lineBody=nodes[i].firstChild;$VISUTILS.applyStyles2DomNode(lineBody,style);}},updateOriginLineStyle:function(propName,subType,className,newValue){var nodes=this.domNode.querySelectorAll(className),i,n=nodes.length,color,styleObj,thk,ceLnStyle;if(propName.indexOf("Clr")>=0){color=GMUTIL.decodeColor(newValue);for(i=0;i<n;i++){if(nodes[i].getAttribute("subtype")===subType){nodes[i].style.stroke=color;}}}else{if(propName.indexOf("CmbStyle")>=0){styleObj=getOriginalThicknessAndStyle(newValue);thk=styleObj.thk;ceLnStyle=styleObj.ceLnStyle;if(ceLnStyle===CE_LN_STYLE.LS_DOT){ceLnStyle="1 1";}else{if(ceLnStyle===CE_LN_STYLE.LS_DASH){ceLnStyle="3 1";}else{ceLnStyle="";}}for(i=0;i<n;i++){if(nodes[i].getAttribute("subtype")===subType){nodes[i].style.strokeDasharray=ceLnStyle;nodes[i].style.strokeWidth=thk;}}}}},updateTrdAndRefLineStyle:function(className,newValue,option){var modifiedKey=newValue.modifiedPropertyKeys[0],nodes=this.domNode.querySelectorAll(className),i,n=nodes.length,color,thk,ceLnStyle,key=option.key;if(modifiedKey===ENUM_XML_TAG.TREND_REF_LINE_COLOR){color=GMUTIL.decodeColor(newValue.jsonObj[modifiedKey]);for(i=0;i<n;i++){if(key===nodes[i].identity.tlOpt.key){nodes[i].style.stroke=color;}}}else{if(modifiedKey===ENUM_XML_TAG.TREND_REF_LINE_COMBINED_STYLE){thk=newValue.jsonObj[ENUM_XML_TAG.TREND_REF_LINE_THICKNESS];ceLnStyle=newValue.jsonObj[ENUM_XML_TAG.TREND_REF_LINE_STYLE];if(ceLnStyle===CE_LN_STYLE.LS_DOT){ceLnStyle="1 1";}else{if(ceLnStyle===CE_LN_STYLE.LS_DASH){ceLnStyle="3 1";}else{ceLnStyle="";}}for(i=0;i<n;i++){if(key===nodes[i].identity.tlOpt.key){nodes[i].style.strokeDasharray=ceLnStyle;nodes[i].style.strokeWidth=thk;}}}}},updateAxisLabelFontStyle:function(type,propName){var manager=this.manager,GMC=this.GMController;if(type==="yaxis"){manager.updateSubSetOfVSlaves("axis",GMC.metricNamesOnRowMetricsOnXAxis);}else{if(type==="xaxis"){manager.updateSubSetOfHSlaves("axis",GMC.metricNamesOnColumnMetricsOnYAxis);}else{manager.updateSubSetOfVSlaves("axis",GMC.metricNamesOnRowMetricsOnXAxis);manager.updateSubSetOfHSlaves("axis",GMC.metricNamesOnColumnMetricsOnYAxis);}}this.updateChartFontStyle(propName,CTRL_TYPE.GM_ORIGIN_LABEL);},updateChartFontStyle:function(propName,type,newValue){var i,targetKey,currentKey,nodeType,nodeStyle,propObj,propObj2,parentNode,parentIdentity,nodes=this.domNode.querySelectorAll(".gm-chart .gm-tspan"),n=nodes.length,HTML5PROPS=this.HTML5PROPS;switch(type){case CTRL_TYPE.GM_ORIGIN_LABEL:if(propName.indexOf("FntClr")>=0){propObj={p:"fill",v:HTML5PROPS.AXIS_LABEL_X.color};propObj2={p:"fill",v:HTML5PROPS.AXIS_LABEL_Y.color};}else{if(propName.indexOf("FntStyle")>=0){propObj={p:"textDecoration",v:HTML5PROPS.AXIS_LABEL_X.textDecoration||"none"};propObj2={p:"textDecoration",v:HTML5PROPS.AXIS_LABEL_Y.textDecoration||"none"};}}break;case CTRL_TYPE.GM_DATA_LABEL:case"all-text":propObj=this.getPropValue(propName,newValue);break;case CTRL_TYPE.GM_REF_LABEL:if(newValue.opt){targetKey=newValue.opt.key;propName=newValue.modifiedPropertyKeys[0];newValue=newValue.jsonObj[propName];}else{newValue=getRealPropValue(propName,newValue);}propObj=this.getPropValue(propName,newValue);break;default:break;}for(i=0;i<n;i++){nodeType=nodes[i].getAttribute("type");if(type==="all-text"){nodeStyle=nodes[i].parentNode.style;nodeStyle[propObj.p]=propObj.v;}else{if(nodeType&&nodeType.indexOf(type)>=0){nodeStyle=nodes[i].parentNode.style;switch(type){case CTRL_TYPE.GM_ORIGIN_LABEL:if(nodeType.indexOf("v")>=0){nodeStyle[propObj.p]=propObj.v;}else{nodeStyle[propObj2.p]=propObj2.v;}break;case CTRL_TYPE.GM_DATA_LABEL:nodeStyle[propObj.p]=propObj.v;break;case CTRL_TYPE.GM_REF_LABEL:if(targetKey){parentNode=nodes[i].parentNode;if(parentNode){parentIdentity=parentNode.identity;}if(parentIdentity&&parentIdentity.tlOpt){currentKey=parentIdentity.tlOpt.key;}if(currentKey===targetKey){nodeStyle[propObj.p]=propObj.v;}}else{nodeStyle[propObj.p]=propObj.v;}break;default:break;}}}}},getPropValue:function(propName,newValue){var propValue;if(propName.indexOf("FntClr")>=0){propValue=GMUTIL.decodeColor(newValue);return{p:"fill",v:propValue};}if(propName.indexOf("FntStyle")>=0){if((newValue&8)&&(newValue&4)){propValue="line-through underline";}else{if(newValue&8){propValue="line-through";}else{if(newValue&4){propValue="underline";}else{propValue="none";}}}return{p:"textDecoration",v:propValue};}},updateCharts:function(){var master=this.manager.master;master.clearCharts();master.updateCharts();this.updateSelections();},updateAxisAndCharts:function(propName){var manager=this.manager,GMC=this.GMController;if(propName!==ENUM_XML_TAG.BANDING){this.hCalcRadiusAndMargin(true);}manager.updateSubSetOfVSlaves("axis",GMC.metricNamesOnRowMetricsOnXAxis);manager.updateSubSetOfHSlaves("axis",GMC.metricNamesOnColumnMetricsOnYAxis);if(propName===ENUM_XML_TAG.AXIS_ORIGIN){var HTML5PROPS=this.HTML5PROPS;this.hPlaceHGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);this.hPlaceVGridLines(HTML5PROPS.GRID_LINE_MAJOR,HTML5PROPS.GRID_LINE_MINOR);}this.updateCharts();},legendPartialUpdate:function(propName,needRefresh){var needReRender=true,legend,HTML5PROPS=this.HTML5PROPS;if(!this.legend){this.hInitLegend();}legend=this.legend;if(propName===ENUM_FORMAT_TAG.LEGEND_FONT_STYLE){needReRender=needRefresh;}else{if((propName===ENUM_FORMAT_TAG.LEGEND_BG_COLOR)||(propName===ENUM_FORMAT_TAG.LEGEND_FONT_COLOR)||(propName===ENUM_FORMAT_TAG.LEGEND_BG_FILL_TRANSPARENCY)){needReRender=false;}}legend.updateStyle(HTML5PROPS.LEGEND);if(needReRender){legend.updateTitleLineHeight(HTML5PROPS.LEGEND);this.onControlResized(false,true,false,true);legend.updateAfterResize();legend.updateSplitter();}},getLegendDockPosIdx:function(pos){var i,n=LEGEND_DOCK_POS.length;for(i=0;i<n;i++){if(pos===LEGEND_DOCK_POS[i].pos){return i;}}return -1;},makeDefaultsObjectAtOption:function(propName){var res,defaultsObj=this.getDefaultProperties();if(COMPLEX_PROPERTY.indexOf(propName)>=0){switch(propName){case ENUM_XML_TAG.METRIC_SHAPES:res=this.getWidgetPropertyValue(ENUM_XML_TAG.SHAPE);break;case ENUM_XML_TAG.LOG_SCALE:break;case ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL:res=false;break;case ENUM_XML_TAG.TREND_LINE_DEF:res={};res[ENUM_XML_TAG.TREND_TYPE]=$GM.EnumTrendLineModelType.BEST_FIT;res[ENUM_XML_TAG.TREND_LEVEL]=$GM.EnumTrendRefLevel.DssModelLevelPerCell;res[ENUM_XML_TAG.TREND_ENABLED]=false;res[ENUM_XML_TAG.TREND_INCLUDE_BREAK_BY]=!!this.getChartInfo().isABL;[ENUM_XML_TAG.TREND_POLY_DEGREE,ENUM_XML_TAG.TREND_REF_LINE_THICKNESS,ENUM_XML_TAG.TREND_REF_LINE_COLOR,ENUM_XML_TAG.TREND_REF_LINE_STYLE].forEach(function(pn){res[pn]=defaultsObj[pn];});break;case ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF:res={};res[ENUM_XML_TAG.TREND_BUBBLE_FORE_FWD]=987654321;res[ENUM_XML_TAG.TREND_BUBBLE_FORE_BWD]=-987654321;res[ENUM_XML_TAG.TREND_BUBBLE_FORE_ENABLED]=false;break;case ENUM_XML_TAG.REF_LINE_DEF:res={};res[ENUM_XML_TAG.REF_TYPE]=$RMT.AVG;res[ENUM_XML_TAG.REF_ENABLED]=false;res[ENUM_XML_TAG.REF_SHOW_LABEL]=true;res[ENUM_XML_TAG.REF_LABEL_TYPE]=$RLT.DssModelLabelsType|$RLT.DssModelLabelsValue;res[ENUM_XML_TAG.REF_LEVEL]=$GM.EnumTrendRefLevel.DssModelLevelPerCell;[ENUM_XML_TAG.TREND_REF_LINE_THICKNESS,ENUM_XML_TAG.TREND_REF_LINE_COLOR,ENUM_XML_TAG.TREND_REF_LINE_STYLE,ENUM_FORMAT_TAG.REF_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.REF_LABELS_FONT_SIZE,ENUM_FORMAT_TAG.REF_LABELS_FONT_STYLE,ENUM_FORMAT_TAG.REF_LABELS_FONT_COLOR].forEach(function(pn){res[pn]=defaultsObj[pn];});res[ENUM_XML_TAG.TREND_REF_LINE_STYLE]=1;break;case ENUM_XML_TAG.AXIS_ORIGIN:res={};res[ENUM_XML_TAG.AXIS_ORIGIN_AUTO]=true;res[ENUM_XML_TAG.AXIS_ORIGIN_VALUE]=0;break;case ENUM_XML_TAG.FORMATS_ON_COMBINATION:break;case ENUM_FORMAT_TAG.ALL_SHAPE_FORMAT:break;}}else{$VISUTILS.visPrint(propName+"is not in COMPLEX_PROPERTY object! Add it in if it is complex property");}return res;},createAxisOriginObject:function(){var res={},me=this,propName=ENUM_XML_TAG.AXIS_ORIGIN,opts=this.getNumericAxisOptions(false);opts.forEach(function(o){res[o.key]=me.makeDefaultsObjectAtOption(propName);});if(res.AllMetrics===undefined){res.AllMetrics=this.makeDefaultsObjectAtOption(propName);}return res;},getPropertiesOfFormatable:function(){var me=this,docModel=me.getDocModel(),correctColor,selOptLvl=this.curSelOptLvl,identityArray,arrayOfComb=this.arrayOfComb,resolvedFormatsOfCollection,fmtsRet;if(this.interactor.fmtState===ENUM_FMT_STATUS.PER_COLORBY){identityArray=this.interactor.getColorByIdentities();correctColor=true;}else{identityArray=this.interactor.getBreakByIdentities();}resolvedFormatsOfCollection=getFormatsOfShapeCollection.call(this,selOptLvl,identityArray,arrayOfComb);if(correctColor&&arrayOfComb&&arrayOfComb[0]){var levels=[],elements=[];$ARR.forEach(arrayOfComb[0],function(el){levels.push(el.tid);elements.push(el.eid);});if(elements.length>0){var shapeFillColor=docModel.getColorBy(levels,elements);resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_LINE_COLOR]=resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_FILL_COLOR]=shapeFillColor.color;resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_FILL_COLOR_DEFAULT]=!shapeFillColor.isManual;resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_LINE_COLOR+DEFAULT_TAG]=!shapeFillColor.isManual;}}var finalFillColor=resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_FILL_COLOR];if(resolvedFormatsOfCollection[ENUM_FORMAT_TAG.LINE_MARKER_COLOR]===undefined){resolvedFormatsOfCollection[ENUM_FORMAT_TAG.LINE_MARKER_COLOR]=finalFillColor;resolvedFormatsOfCollection[ENUM_FORMAT_TAG.LINE_MARKER_COLOR+DEFAULT_TAG]=true;}else{resolvedFormatsOfCollection[ENUM_FORMAT_TAG.LINE_MARKER_COLOR+DEFAULT_TAG]=false;}if(resolvedFormatsOfCollection[ENUM_FORMAT_TAG.LINE_MARKER_BORDER_COLOR]===undefined){resolvedFormatsOfCollection[ENUM_FORMAT_TAG.LINE_MARKER_BORDER_COLOR]=finalFillColor;resolvedFormatsOfCollection[ENUM_FORMAT_TAG.LINE_MARKER_BORDER_COLOR+DEFAULT_TAG]=true;}else{resolvedFormatsOfCollection[ENUM_FORMAT_TAG.LINE_MARKER_BORDER_COLOR+DEFAULT_TAG]=false;}if(resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR]===undefined){resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR]=finalFillColor;resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR+DEFAULT_TAG]=true;}else{resolvedFormatsOfCollection[ENUM_FORMAT_TAG.SHAPE_BORDER_COLOR+DEFAULT_TAG]=false;}updateCombineLineStyle.call(this,resolvedFormatsOfCollection);if(selOptLvl===$SEL_OPT_LVL.ALL_SHAPE||selOptLvl===$SEL_OPT_LVL.METRIC){fmtsRet=$HASH.clone(resolvedFormatsOfCollection);this.updateConflictShapeFormat(fmtsRet,selOptLvl);return getWrapperForObject(fmtsRet);}return getWrapperForObject(resolvedFormatsOfCollection);},updateConflictShapeFormat:function(allShapeFormat,selOptLvl){var fmtOpts=this.getStyleEffectsOptions(),optLvl,tempFmt,me=this,arrayOfComb=this.arrayOfComb&&this.arrayOfComb[0],combFmt={};$ARR.forEach(fmtOpts,function(opt){optLvl=opt.optLvl;if(optLvl===$SEL_OPT_LVL.METRIC&&selOptLvl===$SEL_OPT_LVL.ALL_SHAPE){tempFmt=getFormatsOfShapeCollection.call(me,optLvl,undefined,[opt.comb]);collectConflictShapeFormat(tempFmt,combFmt);}else{if(optLvl===$SEL_OPT_LVL.COLOR_BY){$ARR.forEach(opt.subOptions,function(subOpt){if(!subOpt.key||subOpt.key!=="multiple"){if(selOptLvl===$SEL_OPT_LVL.ALL_SHAPE||(selOptLvl===$SEL_OPT_LVL.METRIC&&isColorByCombContainMetricComb(subOpt.comb,arrayOfComb))){tempFmt=getFormatsOfShapeCollection.call(me,optLvl,undefined,[subOpt.comb]);collectConflictShapeFormat(tempFmt,combFmt);}}});}}});mergeConflictShapeFormat(combFmt,allShapeFormat);},writeFormatableProperties:function(modifiedProperty){var objType,combArrForColorMapAction,attIds,clrPropNm,newColor,undoValue,redoValue,undoRedoProp,me=this,gmCtr=this.GMController,gmm=gmCtr.model,identity=this.identity,modifiedPropertyJSON=modifiedProperty.jsonObj,modifiedPropertyKeys=modifiedProperty.modifiedPropertyKeys,suppressData=true,fillClrIdx=modifiedPropertyKeys.indexOf(ENUM_FORMAT_TAG.SHAPE_FILL_COLOR),lnClrIdx=modifiedPropertyKeys.indexOf(ENUM_FORMAT_TAG.SHAPE_LINE_COLOR),keepMetrics=true;if(fillClrIdx>-1||lnClrIdx>-1){suppressData=false;if(!gmCtr.hasColorBy()){me.writeGlobalProperty(ENUM_FORMAT_TAG.MODIFIED_DEF_FILL_COLOR,modifiedPropertyJSON[modifiedPropertyKeys[0]]);return ;}}if(!identity){return ;}objType=identity.objType;if(objType===ID_TYPE.SHAPE_COLLECTION){var identityArray,selOptLvl=this.curSelOptLvl,arrayOfComb=this.arrayOfComb;if(this.interactor.fmtState===ENUM_FMT_STATUS.PER_COLORBY){identityArray=this.interactor.getColorByIdentities();}else{identityArray=this.interactor.getBreakByIdentities();}modifiedPropertyKeys.forEach(function(mPn){if(mPn.indexOf("CmbStyle")!==-1){var thkProp=mPn.replace("CmbStyle","Thk"),ceLnStyle=mPn.replace("CmbStyle","Style"),cmbObj=getOriginalThicknessAndStyle(modifiedPropertyJSON[mPn]),thkV=cmbObj.thk,ceLnStyleV=cmbObj.ceLnStyle;modifiedProperty.setProperty(thkProp,thkV);modifiedProperty.setProperty(ceLnStyle,ceLnStyleV);}});if(selOptLvl===$SEL_OPT_LVL.ALL_SHAPE){undoRedoProp=ENUM_FORMAT_TAG.ALL_SHAPE_FORMAT;undoValue=this.getWidgetPropertyValue(undoRedoProp);me.mergeModifiedFormatsForSingleShape(undefined,selOptLvl,modifiedProperty);}else{if(selOptLvl===$SEL_OPT_LVL.COLOR_BY||selOptLvl===$SEL_OPT_LVL.METRIC||selOptLvl===$SEL_OPT_LVL.ITSELF){undoRedoProp=ENUM_XML_TAG.FORMATS_ON_COMBINATION;undoValue=this.getWidgetPropertyValue(undoRedoProp);$ARR.forEach(arrayOfComb,function(comb){if(modifiedPropertyKeys[0]!==ENUM_FORMAT_TAG.SHAPE_FILL_COLOR&&modifiedPropertyKeys[0]!==ENUM_FORMAT_TAG.SHAPE_LINE_COLOR){me.mergeModifiedFormatsForSingleShape(comb,selOptLvl,modifiedProperty);}});}}redoValue=this.getWidgetPropertyValue(undoRedoProp);if(selOptLvl!==$SEL_OPT_LVL.ALL_SHAPE&&modifiedPropertyKeys){if(arrayOfComb){if(gmm.colorType===COLOR_BY_TYPE.ATT){keepMetrics=false;}attIds=gmCtr.getColorByAttrsID();combArrForColorMapAction=filterComb(arrayOfComb,attIds,keepMetrics);}else{combArrForColorMapAction=this.collectUniqueCombination(identityArray,$SEL_OPT_LVL.COLOR_BY);}if(fillClrIdx>=0||lnClrIdx>=0){clrPropNm=modifiedPropertyKeys[fillClrIdx>=0?fillClrIdx:lnClrIdx];newColor=modifiedProperty.jsonObj[clrPropNm];}}}if(!suppressData){this.updateColorByMap(combArrForColorMapAction,newColor);}else{var widgetId=this.id,propName=modifiedPropertyKeys[0],doShapeFormattingUpdate=function(){me.GMController.clearShapeFormatsCache();me.partialUpdate(propName,{allVal:modifiedProperty},true);me.raiseEventShapeFormattingChanged(propName);},updateFunc=function(updateValue){var widget=$MOJO.all[widgetId];if(undoRedoProp===ENUM_XML_TAG.FORMATS_ON_COMBINATION){widget.GMController[undoRedoProp]=$HASH.clone(updateValue);}widget.setWidgetPropertyValue(undoRedoProp,updateValue);doShapeFormattingUpdate();},undoRedoCallback={undo:function(){updateFunc(undoValue);},redo:function(){updateFunc(redoValue);}};doShapeFormattingUpdate();this.submitUpdatesAndPersistXML(undefined,undefined,undoRedoCallback,true);}},mergeModifiedFormatsForSingleShape:function(elementComb,selOptLvl,modifiedProperty){var allPropKey,existingFormatsOfShape,gmCtr=this.GMController;if(selOptLvl===$SEL_OPT_LVL.ALL_SHAPE){allPropKey=ENUM_FORMAT_TAG.ALL_SHAPE_FORMAT;existingFormatsOfShape=this.getWidgetPropertyValue(allPropKey);if(existingFormatsOfShape===undefined){existingFormatsOfShape={};}mergeModifiedPropertyToObject(existingFormatsOfShape,modifiedProperty);this.setWidgetPropertyValue(allPropKey,existingFormatsOfShape);}else{existingFormatsOfShape=gmCtr.getShapeFormatsWithCombination(elementComb);if(existingFormatsOfShape===undefined){existingFormatsOfShape={};}mergeModifiedPropertyToObject(existingFormatsOfShape,modifiedProperty);gmCtr.setShapeFormatsWithCombination(elementComb,existingFormatsOfShape);}},collectUniqueCombination:function(identities,fmtLvl){var collisionTestObject={},comb,strComb,resComb=[];$ARR.forEach(identities,function(iden){if(fmtLvl===$SEL_OPT_LVL.ITSELF){comb=iden.getSelectedObjectLowestLevel(true);}else{if(fmtLvl===$SEL_OPT_LVL.COLOR_BY){comb=iden.getSelectedObjectColorByInfo();}else{if(fmtLvl===$SEL_OPT_LVL.METRIC){comb=iden.getSelectedObjectMetricInfo();}}}strComb=GMUTIL.serializeCombination(comb);if(collisionTestObject[strComb]===undefined){collisionTestObject[strComb]=true;resComb.push(comb);}});return resComb;},getTrendRefInfo:function(props){return getTrendRefInfo(props);},changeShapeProperty:function changeShapeProperty(propName,newValue){var me=this;if(this.syning){return ;}me.setWidgetPropertyValue(propName,newValue.jsonObj||newValue);},updateColorByMap:function(combArr,newColor){var manualColor=JSON.stringify({color:newColor}),docModel=this.getDocModel(),actions=[],callback=docModel.getUpdateColorMapCallback(),actionGenerator=$VISUTILS.getUpdateColorMapAction.bind(this);$ARR.forEach(combArr,function(comb){actions.push(actionGenerator(comb,manualColor));});this.submitUpdatesAndPersistXML(actions,callback,undefined,false,true);if(this.forceUpdateColorMap){if(callback.success&&actions.length>0){callback.success({defn:{epm:actions[0].epm}});}}},checkCustomScale:function(metricId){var isCustomScaled=false,customScaleData=this.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE_DATA);$ARR.forEach(customScaleData||[],function(metricOpt){if(metricOpt.length>1){if(metricOpt[0]===metricId){var customScaleType=parseInt(metricOpt[1],10);if(customScaleType===PRP_AXIS_SCALE.CUSTOM){isCustomScaled=true;return false;}}}});return isCustomScaled;},abandonCustomAxisScale:function(){if(this.GMController.hasCustomOnAxis()){this.setWidgetPropertyValue(ENUM_XML_TAG.AXIS_SCALE,PRP_AXIS_SCALE.GLOBAL);}},absorbAxisOrigin:function(){var oldAxOriCollect=this.getWidgetPropertyValue(ENUM_XML_TAG.AXIS_ORIGIN),newAxOriCollect=this.createAxisOriginObject();if(oldAxOriCollect){$HASH.forEach(newAxOriCollect,function(v,n){if(oldAxOriCollect[n]){newAxOriCollect[n]=oldAxOriCollect[n];}});}var allAuto=true;var allValue=null;$HASH.forEach(newAxOriCollect,function(v,n){if(n!=="AllMetrics"){allAuto=allAuto&&v.axOriAuto;if(allValue===null){allValue=v.axOriValue;}else{if(allValue!==undefined){if(allValue!==v.axOriValue){allValue=undefined;}}}}});newAxOriCollect.AllMetrics={axOriAuto:allAuto,axOriValue:allValue};this.setWidgetPropertyValue(ENUM_XML_TAG.AXIS_ORIGIN,newAxOriCollect);},resetAxisOrigin:function(){this.removeWidgetProperty(ENUM_XML_TAG.AXIS_ORIGIN);},clearChartScale:function(){this.removeWidgetProperty(ENUM_XML_TAG.SCALE_CHART_WIDTH);this.removeWidgetProperty(ENUM_XML_TAG.SCALE_CHART_HEIGHT);},persistOnTheFlyShape:function(mIdx){var gmCtr=this.GMController,gmm=gmCtr.model,mId=gmm.getMetricIDsFromIndex([mIdx])[0],origShape=gmCtr.getResolvedShapeForMetric(mIdx),onTheFly=gmCtr.getOnTheFlyShapeForMetric(mIdx);if(origShape!==onTheFly){var metricShape=this.readGlobalProperty(ENUM_XML_TAG.METRIC_SHAPES);metricShape.setProperty(mId,onTheFly);this.setWidgetPropertyValue(ENUM_XML_TAG.METRIC_SHAPES,metricShape.jsonObj);}},updateMetricShape:function(item){var metricShape=this.readGlobalProperty(ENUM_XML_TAG.METRIC_SHAPES),key=item.did,mShpJson=metricShape.jsonObj,doUpdate=false;if(metricShape!==undefined&&mShpJson.hasOwnProperty(key)){delete mShpJson[key];delete mShpJson[key+TIME_STAMP];doUpdate=true;}if(doUpdate){this.setWidgetPropertyValue(ENUM_XML_TAG.METRIC_SHAPES,mShpJson);}}});}());