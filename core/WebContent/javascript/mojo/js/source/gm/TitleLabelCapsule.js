(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Widget","mstrmojo.VisUtility","mstrmojo.VisEnum");var VIS_UTILITY=mstrmojo.VisUtility,CTRL_TYPE=mstrmojo.VisEnum.ControlType,$ARRAY=mstrmojo.array,CAPSULE_BORDER_THICKNESS=1,CAPSULE_TOP_PADDING=5,CAPSULE_LEFT_PADDING=8;function layoutText(){var labelObj=this.labelObj,singleLineHeight=VIS_UTILITY.measureTextHeight(labelObj.text,this.styles,0,100,undefined,true,true);labelObj.textWidth=VIS_UTILITY.measureTextWidth(labelObj.text,this.styles,0,undefined,true);labelObj.textHeight=VIS_UTILITY.measureTextHeight(labelObj.text,this.styles,0,this.width-2*CAPSULE_BORDER_THICKNESS-2*CAPSULE_LEFT_PADDING,"break-word",true,false);this.lineChanged=this.width<labelObj.textWidth+2*CAPSULE_BORDER_THICKNESS+2*CAPSULE_LEFT_PADDING;if(this.lineChanged){this.actualOffsetWidth=this.width;}else{this.actualOffsetWidth=labelObj.textWidth+2*CAPSULE_LEFT_PADDING+2*CAPSULE_BORDER_THICKNESS;}var tempLineCount=Math.floor((this.height-2*CAPSULE_BORDER_THICKNESS-2*CAPSULE_TOP_PADDING)/singleLineHeight);this.hasEllipsis=this.height<labelObj.textHeight+2*CAPSULE_BORDER_THICKNESS+2*CAPSULE_TOP_PADDING;if(this.hasEllipsis){this.domNode.setAttribute("title",labelObj.text);this.lineCount=Math.min(this.maxLineCount,tempLineCount);if(this.lineCount===0){labelObj.truncatedText="...";}else{labelObj.truncatedText=VIS_UTILITY.truncateTextToLineWithWordWrap(labelObj.text,this.styles,this.width-2*CAPSULE_BORDER_THICKNESS-2*CAPSULE_LEFT_PADDING,this.lineCount,false,true);var wordsArray=labelObj.truncatedText.split(" "),tText="";for(var i=0;i<wordsArray.length;i++){var wLen=VIS_UTILITY.measureTextWidth(wordsArray[i],this.styles);if(wLen>this.width-2*CAPSULE_BORDER_THICKNESS){tText+="...";}else{tText+=wordsArray[i];}if(i===0&&i!==wordsArray.length-1){tText+=" ";}}labelObj.truncatedText=tText;}}else{var wordsArr=labelObj.text.split(" "),hasWordAbbreviated=false;$ARRAY.forEach(wordsArr,function(word){var wordLen=VIS_UTILITY.measureTextWidth(word,this.styles);if(wordLen>this.width-2*CAPSULE_BORDER_THICKNESS-2*CAPSULE_TOP_PADDING){hasWordAbbreviated=true;return false;}},this);if(hasWordAbbreviated){this.domNode.setAttribute("title",labelObj.text);}this.lineCount=Math.min(this.maxLineCount,Math.round(labelObj.textHeight/singleLineHeight));}if(this.lineCount===0){this.actualOffsetHeight=this.height;}else{this.actualOffsetHeight=this.lineCount*singleLineHeight+2*CAPSULE_BORDER_THICKNESS+2*CAPSULE_TOP_PADDING;}this.domNode.style.width=this.actualOffsetWidth+"px";this.domNode.style.height=this.actualOffsetHeight+"px";}function fillContent(){var name,value,textDiv,innerDiv,doc=document,fragment=doc.createDocumentFragment(),domNode=this.domNode,styles=this.styles,labelObj=this.labelObj,extraAttrs=labelObj.extraAttributes,offsetLeft=0;innerDiv=doc.createElement("div");innerDiv.setAttribute("class","gm-text-body-nowrap");innerDiv.style.whiteSpace="normal";innerDiv.style.textAlign="center";innerDiv.setAttribute("type",CTRL_TYPE.GM_TEXT_BODY);innerDiv.innerHTML=this.hasEllipsis?labelObj.truncatedText:labelObj.text;innerDiv.container=domNode;innerDiv.style.width=this.actualOffsetWidth-2*CAPSULE_BORDER_THICKNESS+"px";innerDiv.style.height=this.actualOffsetHeight-2*CAPSULE_BORDER_THICKNESS+"px";innerDiv.style.padding=CAPSULE_TOP_PADDING+"px "+CAPSULE_LEFT_PADDING+"px";VIS_UTILITY.applyStyles2DomNode(innerDiv,styles);textDiv=doc.createElement("div");textDiv.setAttribute("class","gm-textbody-unit");textDiv.style.left=offsetLeft+"px";textDiv.style.width=this.actualOffsetWidth-2*CAPSULE_BORDER_THICKNESS+"px";textDiv.style.height=this.actualOffsetHeight-2*CAPSULE_BORDER_THICKNESS+"px";for(name in extraAttrs){if(extraAttrs.hasOwnProperty(name)){value=extraAttrs[name];if((typeof value)==="string"||(typeof value)==="number"){textDiv.setAttribute(name,String(value));}else{textDiv[name]=extraAttrs[name];}}}textDiv.appendChild(innerDiv);fragment.appendChild(textDiv);domNode.appendChild(fragment);}function positionDom(){var domNode=this.domNode,outerWidth=this.width,outerHeight=this.height,innerWidth=this.actualOffsetWidth,innerHeight=this.actualOffsetHeight;domNode.style.left=Math.floor((outerWidth-innerWidth)/2)+"px";domNode.style.top=Math.floor((outerHeight-innerHeight)/2)+"px";}mstrmojo.gm.TitleLabelCapsule=mstrmojo.declare(mstrmojo.Widget,[],{scriptClass:"mstrmojo.gm.TitleLabelCapsule",cssClass:"",width:10,height:10,labelObj:null,styles:null,actualOffsetWidth:0,actualOffsetHeight:0,hasEllipsis:false,lineChanged:false,lineCound:1,maxLineCount:2,markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}px; height:auto"></div>',init:function(props){this.labelObj={};this.styles={};if(this._super){this._super(props);}},postBuildRendering:function(){layoutText.call(this);fillContent.call(this);positionDom.call(this);}});}());