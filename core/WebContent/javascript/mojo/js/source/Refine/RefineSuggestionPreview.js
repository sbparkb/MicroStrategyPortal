(function(){mstrmojo.requiresCls("mstrmojo.PopupEditBox","mstrmojo.Widget","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.Container","mstrmojo.Refine.RefineDataHeader","mstrmojo.Refine.RefineDataCell","mstrmojo.dom");var headerNode={scriptClass:"mstrmojo.Refine.RefineDataHeader"};var cellNode={scriptClass:"mstrmojo.Refine.RefineDataCell"};mstrmojo.Refine.RefineSuggestionPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineSuggestionPreview",markupString:'<div class="refine-suggestion-preview"><div class="fixed-width-preview-container"><div class="fixed-width-preview-container-inner"></div></div></div>',markupSlots:{dataNode:function(){return this.domNode.children[0];},tableNode:function(){return this.domNode.children[0].children[0];}},enableEdit:true,scrollTop:0,setDimensions:function setDimensions(h){var height=parseInt(h,10);if(isNaN(height)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.dataNode=(this.enableEdit?(height-21-2):(height-2))+"px";this.layoutConfig.w.dataNode="auto";this.layoutConfig.h.tableNode=(this.enableEdit?(height-21-2):(height-2))+"px";this.layoutConfig.w.tableNode="auto";if(this.domNode){if(this.cellPos){this.domNode.style.top=this.cellPos.tableTop+"px";if(this.domNode.clientWidth+10<this.cellPos.distanceToRight){this.domNode.style.left=this.cellPos.cellRight+10+"px";this.domNode.style.right="";this.domNode.className="refine-suggestion-preview left";}else{if(this.domNode.clientWidth+10<this.cellPos.distanceToLeft){this.domNode.style.right=(this.cellPos.cellRight+this.cellPos.distanceToRight)-this.cellPos.cellLeft+10+"px";this.domNode.style.left="";this.domNode.className="refine-suggestion-preview right";}else{if(this.cellPos.distanceToRight>=this.cellPos.distanceToLeft){this.domNode.style.left="";this.domNode.style.right="0px";this.domNode.className="refine-suggestion-preview left";}else{this.domNode.style.left="0px";this.domNode.style.right="";this.domNode.className="refine-suggestion-preview right";}}}}}if(this._super){this._super((height-2)+"px","auto");}},children:[{scriptClass:"mstrmojo.Table",slot:"tableNode",cssClass:"refine-table",alias:"dataTable",onremoveChild:function(evt){var children=evt.value;for(var i=0;i<children.length;i++){children[i].destroy();}},populateData:function(columns,data){if(!columns||!data){this.parent.domNode.style.display="none";return ;}else{this.parent.domNode.style.display="block";this.parent.domNode.style.left="";this.parent.domNode.style.right="";}this.removeChildren();this.unrender();var i=0,j,cell;this.rows=data.rows.length+1;this.cols=columns.length;for(j=0;j<columns.length;j++){headerNode.slot=i+","+j;headerNode.columnIndex=j;headerNode.text=columns[j].name;headerNode.preview=this.parent;headerNode.suggestionPreview=columns[j].suggestionPreview;headerNode.cssClass="suggestion-preview columnNumber"+columns[j].columnNumber;headerNode.allowEdit=this.parent.enableEdit;this.addChildren(headerNode);}for(i=1;i<=data.rows.length;i++){for(j=0;j<columns.length;j++){cell=cellNode;cell.slot=i+","+j;cell.columnIndex=j;cell.column=columns;cell.rowIndex=data.rows[i-1].i;var c=data.rows[i-1].cells[columns[j].cellIndex];if(c===null||c===undefined){c={v:""};}if(c.v===null||c.v===undefined){c.v="";}cell.text=c.v;if(c.t){cell.cssClass="date";}else{if(typeof c.v==="string"||c.v instanceof String){cell.cssClass="text";cell.text=c.v;}else{cell.cssClass="number";}}cell.cssClass+=" suggestion-preview";cell.cssClass+=" columnNumber"+c.columnNumber;cell.preview=this.parent;cell.columnName=columns[j].name;this.addChildren(cell);}}this.render();this.updateCellClass(columns,data);this.parent.setDimensions(parseInt(this.parent.domNode.style.height,10)+2);},updateCellClass:function(columns,data){var i,j;var rows=this.domNode.firstChild.children;for(i=0;i<=data.rows.length;i++){var row=rows[i];var cells=row.children;for(j=0;j<columns.length;j++){if(i===0){cells[j].className="refine-header";if(j===0){cells[j].className+=" left";}if(j===columns.length-1){cells[j].className+=" right";}}else{cells[j].className="refine-cell";if(j===0){cells[j].className+=" left";}if(j===columns.length-1){cells[j].className+=" right";}if(i===data.rows.length){cells[j].className+=" bottom";}}}}this.parent.tableNode.scrollTop=this.parent.scrollTop;}}],populate:function(columns,data){this.dataTable.populateData(columns,data);},handlePreviewSuggestion:function(event){this.cellPos=event.cellPos;this.populate(event.columns,event.data);},handleUnPreviewSuggestion:function(){this.populate();},handlePreviewScrollTop:function(event){this.scrollTop=event.scrollTop;}});}());