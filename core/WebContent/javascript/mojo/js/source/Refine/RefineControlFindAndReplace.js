(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(134,9305,3124,12359,686,13059,13060,13574);var constants=mstrmojo.Refine.RefineConstants;function escapeSpecial(str){str=str.replace(/\n/g,"\\n");str=str.replace(/\t/g,"\\t");return str;}function replaceDollar(str){return str.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function applyOperations(){var operations=[],operation,transformation,columns,index,columnName,transformationList,idx;transformation=this.parent;columns=transformation.columns;index=columns.selectedIndex;if(index===undefined){return ;}columnName=(columns.items[index]).name;transformationList=transformation.transformationList;idx=transformationList.subType%10;switch(idx){case 0:operation=JSON.parse(JSON.stringify(this.operations.CharInCell));break;case 1:if(this.optionsBox.type.selectedIndex===0){operation=JSON.parse(JSON.stringify(this.operations.CellContains));}else{if(this.optionsBox.type.selectedIndex===1){operation=JSON.parse(JSON.stringify(this.operations.CellBeginsWith));}else{operation=JSON.parse(JSON.stringify(this.operations.CellEndsWith));}}break;}var from=this.optionsBox.find.from.value;var to=this.optionsBox.find.to.value;if(!from||!to){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}operation.description=operation.description.replace("[column name]",columnName);operation.description=operation.description.replace("####","'"+escapeSpecial(replaceDollar(from))+"'");operation.description=operation.description.replace("@@@@","'"+escapeSpecial(replaceDollar(to))+"'");operation.columnName=columnName;operation.expression=operation.expression.replace("[from]","'"+replaceDollar(from)+"'");operation.expression=operation.expression.replace("[to]","'"+replaceDollar(to)+"'");operation.engineConfig=JSON.parse(this.controller.model.engine);operations.push(operation);this.controller.applyOperations({operations:JSON.stringify(operations),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.find.from.set("value","");this.optionsBox.find.to.set("value","");}mstrmojo.Refine.RefineControlFindAndReplace=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlFindAndReplace",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===constants.transformationType.FindAndReplace);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12359,"Where Cell"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(686,"Contains")},{n:mstrmojo.desc(13059,"Begins With")},{n:mstrmojo.desc(13060,"Ends with")}],selectedIndex:0,bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{scriptClass:"mstrmojo.HBox",alias:"find",children:[{scriptClass:"mstrmojo.TextBox",alias:"from",emptyText:mstrmojo.desc(9305,"From")},{scriptClass:"mstrmojo.TextBox",alias:"to",emptyText:mstrmojo.desc(3124,"To")}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){applyOperations.call(this.parent.parent);}}]}]});}());