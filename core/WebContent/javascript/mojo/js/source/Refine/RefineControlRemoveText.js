(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(134,13574);var constants=mstrmojo.Refine.RefineConstants;function escapeSpecial(str){str=str.replace(/\n/g,"\\n");str=str.replace(/\t/g,"\\t");return str;}function replaceDollar(str,noslash){str=str.replace(/\$/g,"$$$$");if(!noslash){str=str.replace(/[\\"']/g,"\\$&");}return str;}function applyOperations(){var operations=[],operation,transformation,columns,index,columnName,transformationList,idx;transformation=this.parent;columns=transformation.columns;index=columns.selectedIndex;if(index===undefined){return ;}columnName=(columns.items[index]).name;transformationList=transformation.transformationList;idx=transformationList.subType%10;var text,tags,i,inputText;switch(idx){case 0:operation=JSON.parse(JSON.stringify(this.operations.CutOn));tags=this.optionsBox.find.tagBox.children;text="";for(i=0;i<tags.length-1;i++){text+=mstrmojo.string.regEscape(tags[i].text);if(i!==tags.length-2){text+="|";}}inputText=tags[tags.length-1].input.value;if(inputText){if(tags.length>1){text+="|";}text+=mstrmojo.string.regEscape(inputText);}break;case 1:operation=JSON.parse(JSON.stringify(this.operations.CutBefore));break;case 2:operation=JSON.parse(JSON.stringify(this.operations.CutAfter));break;}var from=this.optionsBox.find.from.value;if((idx===0&&!text)||(idx!==0&&!from)){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}operation.description=operation.description.replace("[column name]",columnName);if(idx===0){operation.description=operation.description.replace("####","/"+escapeSpecial(replaceDollar(text,true))+"/");operation.expression=operation.expression.replace(new RegExp("\\[separator\\]","gm"),"/"+replaceDollar(text,true)+"/");}else{operation.description=operation.description.replace("####","'"+escapeSpecial(replaceDollar(from))+"'");operation.expression=operation.expression.replace(new RegExp("\\[separator\\]","gm"),"'"+replaceDollar(from)+"'");}operation.columnName=columnName;operation.engineConfig=JSON.parse(this.controller.model.engine);operations.push(operation);this.controller.applyOperations({operations:JSON.stringify(operations),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.find.from.set("value","");this.optionsBox.find.tagBox.removeTags();this.optionsBox.find.tagBox.inputBox.input.set("value","");}mstrmojo.Refine.RefineControlRemoveText=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlRemoveText",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===constants.transformationType.RemoveText);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"find",cssClass:"refine-controls-remove-text-box",children:[{scriptClass:"mstrmojo.TextBox",alias:"from",bindings:{visible:function(){return(this.parent.parent.parent.parentBox.transformationList.subType%10!==0);}}},{scriptClass:"mstrmojo.Refine.RefineTagBox",alias:"tagBox",bindings:{visible:function(){return(this.parent.parent.parent.parentBox.transformationList.subType%10===0);}}}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){applyOperations.call(this.parent.parent);}}]}]});}());