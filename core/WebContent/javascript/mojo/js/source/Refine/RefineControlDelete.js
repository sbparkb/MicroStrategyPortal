(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.RadioList","mstrmojo.ui.Pulldown","mstrmojo.Refine.RefineTagBox","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(13574,686,13059,13060,12359,12360,134,14290,14291);var constants=mstrmojo.Refine.RefineConstants;function applyOperations(){var operations=[],operation,transformation,columns,index,columnName,transformationList,idx;var facetPanel,requirement;transformation=this.parent;index=transformation.columns.selectedIndex;transformationList=transformation.transformationList;columns=transformation.columns;idx=transformationList.subType%10;if(index===undefined&&!transformationList.noColumn){return ;}if(!transformationList.noColumn){columnName=(columns.items[index]).name;}switch(idx){case 0:operation=JSON.parse(JSON.stringify(this.operations.Colomn));operation.description=operation.description.replace("[column name]",columnName);operation.columnName=columnName;break;case 1:var type=this.optionsBox.rows.type.selectedIndex;var text=this.optionsBox.rows.text.value;var tags,i,inputText;switch(type){case 0:operation=JSON.parse(JSON.stringify(this.operations.RowsContains));tags=this.optionsBox.rows.tagBox.children;text="";for(i=0;i<tags.length-1;i++){text+=mstrmojo.string.regEscape(tags[i].text);if(i!==tags.length-2){text+="|";}}inputText=tags[tags.length-1].input.value;if(inputText){if(tags.length>1){text+="|";}text+=mstrmojo.string.regEscape(inputText);}break;case 1:operation=JSON.parse(JSON.stringify(this.operations.RowsBegins));tags=this.optionsBox.rows.tagBox.children;text="";for(i=0;i<tags.length-1;i++){text+="^"+mstrmojo.string.regEscape(tags[i].text);if(i!==tags.length-2){text+="|";}}inputText=tags[tags.length-1].input.value;if(inputText){if(tags.length>1){text+="|";}text+="^"+mstrmojo.string.regEscape(inputText);}break;case 2:operation=JSON.parse(JSON.stringify(this.operations.RowsEnds));tags=this.optionsBox.rows.tagBox.children;text="";for(i=0;i<tags.length-1;i++){text+=mstrmojo.string.regEscape(tags[i].text)+"$";if(i!==tags.length-2){text+="|";}}inputText=tags[tags.length-1].input.value;if(inputText){if(tags.length>1){text+="|";}text+=mstrmojo.string.regEscape(inputText)+"$";}break;case 3:operation=JSON.parse(JSON.stringify(this.operations.RowsBlank));break;case 4:operation=JSON.parse(JSON.stringify(this.operations.RowsEquals));break;case 5:operation=JSON.parse(JSON.stringify(this.operations.RowsNotEquals));break;}if(type!==3&&!text){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(type===0||type===1||type===2){operation.engineConfig.facets[0].query=operation.engineConfig.facets[0].query.replace("[text]",text);operation.description=operation.description.replace("####","/"+text+"/");}else{if(type===4||type===5){operation.engineConfig.facets[0].selection[0].v.v=text;operation.engineConfig.facets[0].selection[0].v.l=text;operation.description=operation.description.replace("####","'"+text+"'");}}operation.engineConfig.facets[0].name=operation.engineConfig.facets[0].columnName=columnName;operation.description=operation.description.replace("[column name]",columnName);break;case 2:operation=JSON.parse(JSON.stringify(this.operations.RemoveDuplicateCells));operation.description=operation.description.replace("[column name]",columnName);operation.columnName=columnName;break;case 3:operation=JSON.parse(JSON.stringify(this.operations.RemoveDuplicateRows));break;case 4:operation=JSON.parse(JSON.stringify(this.operations.DeleteRowsInTheView));facetPanel=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;operation.engineConfig=facetPanel.getJSON();requirement=facetPanel.getRequirementDiscription();operation.description=operation.description.replace("[Requirement]",requirement);facetPanel.resetAllFacets();break;case 5:operation=JSON.parse(JSON.stringify(this.operations.DeleteRowsNotInTheView));facetPanel=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;operation.engineConfig=facetPanel.getJSON();requirement=facetPanel.getRequirementDiscription();operation.description=operation.description.replace("[Requirement]",requirement);facetPanel.resetAllFacets();break;}if(idx===1||idx===2||idx===3){operation.engineConfig.facets=operation.engineConfig.facets.concat(JSON.parse(this.controller.model.engine).facets);}operations.push(operation);this.controller.applyOperations({operations:JSON.stringify(operations),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.rows.text.set("value","");this.optionsBox.rows.tagBox.removeTags();this.optionsBox.rows.tagBox.inputBox.input.set("value","");}mstrmojo.Refine.RefineControlDelete=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlDelete",markupString:'<div class="refine-controls delete"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===20||this.subType===22||this.subType===23||this.subType===24||this.subType===25){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===constants.transformationType.Delete);},subType:function(){return((this.parentBox.transformationList.type===constants.transformationType.Delete)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"rows",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12359,"Where Cell")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(686,"Contains")},{n:mstrmojo.desc(13059,"Begins With")},{n:mstrmojo.desc(13060,"Ends With")},{n:mstrmojo.desc(12360,"Is Empty")},{n:mstrmojo.desc(14290,"Equals To")},{n:mstrmojo.desc(14291,"Not Equals To")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===3){this.parent.text.set("visible",false);this.parent.tagBox.set("visible",false);}else{if(this.selectedIndex===0||this.selectedIndex===1||this.selectedIndex===2){this.parent.text.set("visible",false);this.parent.tagBox.set("visible",true);}else{this.parent.text.set("visible",true);this.parent.tagBox.set("visible",false);}}}},{scriptClass:"mstrmojo.TextBox",alias:"text"},{scriptClass:"mstrmojo.Refine.RefineTagBox",alias:"tagBox"}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{slot:"optionsNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){applyOperations.call(this.parent.parent);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}}]}]});}());