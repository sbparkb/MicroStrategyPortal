(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo._CanValidate","mstrmojo.css","mstrmojo.validation","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");var $CSS=mstrmojo.css,$VALIDATE=mstrmojo.validation,$VALIDATE_TRIGGER=$VALIDATE.TRIGGER,$VALIDATE_CODE=$VALIDATE.STATUSCODE;function triggerValidate(trigger){if((this.constraints.trigger&trigger)>0){this.validate();}}mstrmojo.ValidationTextBox=mstrmojo.declare(mstrmojo.TextBox,[mstrmojo._CanValidate,mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.ValidationTextBox",validationDelay:500,getInvalidMsg:function getInvalidMsg(vs){return(vs&&vs.msg?vs.msg:"");},postBuildRendering:function postBuildRendering(){this._super();this._original_tooltip=this.inputNode.title;},prekeyup:function prekeyup(evt){this._super(evt);var tri=(this.constraints.trigger&$VALIDATE_TRIGGER.ONKEYUP)>0;if(tri){var delay=this.validationDelay;if(delay){this.clearValDelayTimer();var fnValidate=this._validateHandler;if(!fnValidate){var me=this;this._validateHandler=fnValidate=function(){me.validate();if(me._valDelayTimer){window.clearTimeout(me._valDelayTimer);delete me._valDelayTimer;}};}this._valDelayTimer=window.setTimeout(fnValidate,delay);}else{this.validate();}}},preinput:function preinput(evt){this._super(evt);triggerValidate.call(this,$VALIDATE_TRIGGER.ONKEYUP);},preblur:function preblur(evt){this._super(evt);triggerValidate.call(this,$VALIDATE_TRIGGER.ONBLUR);},clearValidation:function clearValidation(){this._super();var inputNode=this.inputNode;$CSS.removeClass(inputNode,this.constraints.invalidCssClass||"mstrmojo-TextBox-ErrValidation");inputNode.title=this._original_tooltip;},clearValDelayTimer:function(){var existingTimer=this._valDelayTimer;if(existingTimer){window.clearTimeout(existingTimer);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ValidationTextBox,{onvalidationStatusChange:function(){var vs=this.validationStatus;if(!vs){return ;}var inputNode=this.inputNode,isInvalid=(vs.code>$VALIDATE_CODE.VALID),css=this.constraints.invalidCssClass;$CSS.toggleClass(inputNode,css||"mstrmojo-TextBox-ErrValidation",isInvalid);var title=isInvalid?this.getInvalidMsg(vs):this._original_tooltip;if(!this.useRichTooltip&&title!==undefined&&title!==null){inputNode.setAttribute("title",title);}}});}());