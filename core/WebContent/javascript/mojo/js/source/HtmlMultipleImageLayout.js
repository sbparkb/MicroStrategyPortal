(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.func","mstrmojo.BaseMultipleImageLayout","mstrmojo.HtmlWidgetMatrix","mstrmojo.HtmlBaseImageLayout","mstrmojo._VizSelectionHelper","mstrmojo.VisUtility","mstrmojo.VisEnum","mstrmojo.util.color","mstrmojo.vi.ui._IsDropTarget","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi.models.editors.BaseEditorModel");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_HasVisSelections","selectors._IsMultiUnitControl","selectors._BrushesAndHighlights");mstrmojo.requiresClsP("mstrmojo.gm","GMLegend","EnumLegendSlot","GMUtility","_SupportDndAsBlackBox");mstrmojo.requiresClsP("mstrmojo.imagelayout","_SupportImageLayoutBrushesAndHighlights","ImageLayoutEditorHelper");var $CSS=mstrmojo.css,$DOM=mstrmojo.dom,$HASH=mstrmojo.hash,$FUNC=mstrmojo.func,$ARRAY=mstrmojo.array,$NUM=mstrmojo.num,$UTIL=mstrmojo.VisUtility,$CLRUTIL=mstrmojo.util.color,$GM=mstrmojo.gm,$VIS_ENUMS=mstrmojo.VisEnum,CTRL_TYPE=$VIS_ENUMS.ControlType,PROPERTIES_TYPE=$VIS_ENUMS.IMAGELAYOUT_PROPERTIES,ENUM_COLOR_RANKMODE=$VIS_ENUMS.EnumColorRankMode,PRP_LEGEND_SLOT=$GM.EnumLegendSlot,$LEGEND=$GM.GMLegend,ENUM_LEGEND_MODE=$VIS_ENUMS.EnumLegendMode,LEGEND_DATA_TYPE=$VIS_ENUMS.GMLegendDataType,$EDITOR_HELPER=mstrmojo.imagelayout.ImageLayoutEditorHelper;var Background_Color=16119287,LEGEND_PADDING=5,STR_ABS_VALUE_OF="Absolute value of ";var CATEGORIES_DATA_EXPLORATION="de",CATEGORIES_TITLE_AND_CONTAINERS=mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE,CATEGORIES_LEGEND="lgd",CATEGORIES_ROWS_COLUMNS="rcl",CATEGORIES_SHAPES_AND_DATA_LABELS="dl";var PREFIX_DATA_LABELS="dl",LEVEL_SEPARATOR="@",NAME_BORDER_METRICS_LINE_FOR="selBdrMtxLn4",PREFIX_SHAPE_FORMATTING="shape",PREFIX_SHAPE_BORDER="shapeBorder";var IMAGELAYOUT_THRESHOLD_COLORS=["#65D22B","#FFC561","#FF9547","#FF5824","#CC1D1D"],IMAGELAYOUT_THRESHOLD_BANDS=[0.2,0.4,0.6,0.8];var LEGEND_DOCK_POS=[{pos:PRP_LEGEND_SLOT.LEFT_TOP},{pos:PRP_LEGEND_SLOT.LEFT_MIDDLE},{pos:PRP_LEGEND_SLOT.LEFT_BOTTOM},{pos:PRP_LEGEND_SLOT.RIGHT_TOP},{pos:PRP_LEGEND_SLOT.RIGHT_MIDDLE},{pos:PRP_LEGEND_SLOT.RIGHT_BOTTOM}];function getSizeByMinMaxValues(){var m=this.modelData,mx=m.gsi.mx,mxOfSizeMetric=mx[this.sizeByIndex],range={min:Infinity,max:-Infinity};range.max=Math.max(mxOfSizeMetric.max,range.max);range.min=Math.min(mxOfSizeMetric.min,range.min);return range;}function formatByValidation(formatMask,nm){var fm=formatMask;if(!$NUM.validateFormat(fm)){fm="#,##0.00;(#,##0.00)";}return $NUM.formatByMask(fm,nm);}function getLegendDockPosIdx(pos){var i,n=LEGEND_DOCK_POS.length;for(i=0;i<n;i++){if(pos===LEGEND_DOCK_POS[i].pos){return i;}}return -1;}function getObjSize(obj){var size=0,key;for(key in obj){if(obj.hasOwnProperty(key)){size++;}}return size;}function showToolbarByFormat(pos,toolbarData){toolbarData.position=pos;toolbarData.isHostedWithin=false;if(!toolbarData.cssClass){toolbarData.cssClass="";}toolbarData.cssClass+=mstrApp.getThemeClassName();this.openPopup(toolbarData.newInstance({onClose:function(config){$CSS.toggleClass(document.body,"hasToolbarPopup",false);}}));$CSS.toggleClass(document.body,"hasToolbarPopup",true);}function getRowContainer(children,rowContainerCSSClass){children=children||[];rowContainerCSSClass=rowContainerCSSClass||"";$ARRAY.forEach(children,function(child){child.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.HBox",cssClass:rowContainerCSSClass,children:children};}function getLabelBox(children,labelcss){children=children||[];var labelBox=new mstrmojo.Box({children:children,cssText:labelcss});return labelBox;}function getLabelAndControlBox(labelText,control,reverseOrder,rowContainerCSSClass){var label=new mstrmojo.Label({text:labelText}),labelBox=getLabelBox(label,"white-space: nowrap; margin-right:9px;");var children=[labelBox,control];if(reverseOrder){children=[control,labelBox];}return getRowContainer(children,rowContainerCSSClass);}function getFillConfigComp(widget,label,childrenNames,props){if(props===undefined){props={};}$HASH.copy({width:props.width||"140px",height:"22px",colorPickerHostWithin:true},props);var control=$EDITOR_HELPER.getFillConfigComp(widget,null,childrenNames,props);if(typeof label==="string"){return getLabelAndControlBox(label,control);}return control;}function getFillToolbar(widget,label,smartNamesMap,props){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",cssClass:mstrApp.getThemeClassName(),showDivider:false,children:[getFillConfigComp(widget,label,smartNamesMap,props)]}]});}function getCharacterConfigComp(widget,smartNamesMap,props,showNoFill){if(props===undefined){props={};}if(showNoFill!==undefined){props.showNoFillInColor=showNoFill;}props=$HASH.copy({cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,width:"381px",height:"22px"},props);if(props.propNames===undefined){props.propNames=$HASH.valarray(smartNamesMap);}var control=$EDITOR_HELPER.getCharacterConfigComp(widget,null,smartNamesMap,props);return control;}function getFontToolbar(widget,fontGroupSmartNames){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",cssClass:mstrApp.getThemeClassName(),showDivider:false,children:[getCharacterConfigComp(widget,fontGroupSmartNames)]}]});}function getLineConfigComp(widget,label,childrenNames,props){if(props===undefined){props={};}$HASH.copy({width:props.width||"140px",height:"22px",colorPickerHostWithin:true},props);var control=$EDITOR_HELPER.getLineConfigComp(widget,null,childrenNames,props);if(typeof label==="string"){return getLabelAndControlBox(label,control,false,(props||[]).rowContainerCSSClass);}return control;}function getLineToolbar(widget,label,smartNamesMap,props){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",cssClass:mstrApp.getThemeClassName(),showDivider:false,children:[getLineConfigComp(widget,label,smartNamesMap,props)]}]});}function getFillAndBorderToolbar(widget,fillChildrenNames,lineChildrenNames){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-ToolbarBorderAndFill",children:[getFillConfigComp(widget,mstrmojo.desc(2885,"Fill"),fillChildrenNames,{showGradient:false}),getLineConfigComp(widget,mstrmojo.desc(9736,"Border"),lineChildrenNames,{rowContainerCSSClass:"mstrmojo-ui-rowContainer",showNoneOption:false})]}]});}function getFillOpacityAndBorderStyleToolbar(widget,fillChildrenNames,lineChildrenNames){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-ToolbarBorderAndFill",children:[getFillConfigComp(widget,mstrmojo.desc(13658,"Fill Opacity"),fillChildrenNames,{width:"60px",visibleControls:mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS.FILL_TRANSPARENCY}),getLineConfigComp(widget,mstrmojo.desc(3538,"Border Style"),lineChildrenNames,{width:"60px",rowContainerCSSClass:"mstrmojo-ui-rowContainer",hideColorControl:true,showNoFillInColor:false,showAutomaticInColor:true,showNoneOption:false})]}]});}function isVMatrixLine(type){return type===CTRL_TYPE.GM_V_MATRIX_LINE;}function isHMatrixLine(type){return type===CTRL_TYPE.GM_H_MATRIX_LINE;}function isMatrixLineContainer(type){return type===CTRL_TYPE.LINE_CONTAINER;}function isDataLabel(type){return type===CTRL_TYPE.GM_DATA_LABEL;}mstrmojo.HtmlMultipleImageLayout=mstrmojo.declare(mstrmojo.BaseMultipleImageLayout,[mstrmojo._VizSelectionHelper,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.imagelayout._SupportImageLayoutBrushesAndHighlights,mstrmojo.vi.ui._IsDropTarget,mstrmojo.gm._SupportDndAsBlackBox,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.HtmlMultipleImageLayout",isTablet:false,legendW:0,legendH:0,markupString:'<div id="{@id}" class="scrollBarParent {@cssClass}" style="position:absolute; width:{@width}px; height:{@height}px; left:{@left}px; top:{@top}px; z-index:{@zIndex}; " mstrAttach:mouseup,scroll,click,contextmenu><div id="{@id}-loading-indicator" style="position:relative; width:{@width}; height:{@height}; display:none; z-index: 2;"><div style="padding-left: 5px; height: {@loadingIndicatorDivHeight}px; width: {@loadingIndicatorDivWidth}px; background-color: RGBA(0,0,0,0.5); border: solid 1px RGBA(255, 255, 255, 0.5); color: #FFFFFF; font-size: {@loadingIndicatorFontSize}px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; line-height: {@loadingIndicatorDivHeight}px;">Loading...</div></div><div id="{@id}-error-message" align="center" style="position:absolute; top:35%; word-wrap:break-word; display: none; z-index: 3"></div><div class="mil-vsbar" style="width:{@sbwh}px; z-index:3;" mstrAttach:scroll><div class="mil-vsbar-body"></div></div><div class="mil-hsbar" style="height:{@sbwh}px; z-index:3;" mstrAttach:scroll><div class="mil-hsbar-body"></div></div><div id="{@id}-scrollbar-corner" style="position: absolute; height:{@sbwh}px; width:{@sbwh}px; background-color: #FFF; display:none; z-index:3;"></div><div /></div>',markupSlots:{loadingIndicator:function(){return this.domNode.childNodes[0];},loadingIndicatorTextDiv:function(){return this.domNode.childNodes[0].firstChild;},errorMessage:function(){return this.domNode.childNodes[1];},domVSBar:function(){return this.domNode.childNodes[2];},domVSBarBody:function(){return this.domNode.childNodes[2].firstChild;},domHSBar:function(){return this.domNode.childNodes[3];},domHSBarBody:function(){return this.domNode.childNodes[3].firstChild;},scrollBarCorner:function(){return this.domNode.childNodes[4];},legendNode:function(){return this.domNode.childNodes[5];}},preBuildRendering:function preBR(){if(this._super){this._super();}},init:function(props){if(this._super){this._super(props);}this.sbwh=15;this.selectedTargets=[];},clearAll:function clearAll(){this.selectedTargets=[];},getShapeFileCoordsWithXHR:function getShapeFileCoordsWithXHR(mapFilePath,callback){if(!mapFilePath){console.log("no shape file ");return ;}var totalWidget=this,params={taskId:"getMapCoordinates",coordinatesFile:mapFilePath},config={src:"postBuildRendering",noErrorMessage:true,showProgress:true,hideProgress:true,progressStateText:["Loading Map File for Sub-ImageLayout"],silent:true},xhrCfg={submission:function(){totalWidget.showLoadingIndicator();},complete:function(){totalWidget.hideLoadingIndicator();},success:function(res){var coords=res&&res.coords;if(coords){totalWidget.prepareCoordsName(coords);totalWidget.mapFilePool[mapFilePath]=coords;}}};mstrApp.serverRequest(params,$FUNC.wrapMethods(xhrCfg,callback),config);},getAllShapeFileCoordsWithXHR:function getAllShapeFileCoordsWithXHR(callback){var totalWidget=this,params={taskId:"getAllMapCoordinates"},config={src:"postBuildRendering",noErrorMessage:true,showProgress:true,hideProgress:true,progressStateText:["Loading Map File for Sub-ImageLayout"],silent:true};var xhrCfg={submission:function(){totalWidget.showLoadingIndicator();},complete:function(){totalWidget.hideLoadingIndicator();},success:function(res){var mapFilePath;for(mapFilePath in res){totalWidget.mapFilePool[mapFilePath]=res[mapFilePath];}totalWidget.allShapeFileLoaded=true;}};mstrApp.serverRequest(params,$FUNC.wrapMethods(xhrCfg,callback),config);},getShapeFileListWithXHR:function getShapeFileListWithXHR(callback){var me=this;if(me._shapeFileList){callback();}else{var xhrCfg={success:function(res){me._shapeFileList=$ARRAY.ensureArray(res.ShapeFileMaps&&res.ShapeFileMaps.ShapeFileMap);callback();},failure:function(res){me._shapeFileList=[];console.log("no shape file list found");}},params={taskId:"getMapShapes"},config={noErrorMessage:true,silent:true};mstrApp.serverRequest(params,xhrCfg,config);}},highlightRMCTargets:function(targetArr,clear){var widget=this,mainContainer=widget.domNode,type,funcName=clear?"removeClass":"addClass";if(clear){targetArr=this.selectedTargets||[];}$ARRAY.forEach(targetArr||[],function(target){if(!clear){widget.selectedTargets.push(target);}type=target.getAttribute("type");if(isVMatrixLine(type)){$CSS[funcName](mainContainer,"select-ml-v");}if(isHMatrixLine(type)){$CSS[funcName](mainContainer,"select-ml-h");}if(isDataLabel(type)){$CSS[funcName](target,"select-dl");}});if(clear){widget.selectedTargets=[];}},clearRMCTargets:function clearRMCTargets(){this.highlightRMCTargets(null,true);this.selectedTargets=[];},onclick:function onclick(evt){var iLTable=this.imageLayoutTable;$DOM.preventDefault(window,evt.e);iLTable.handleSingleClick(evt);},oncontextmenu:function oncontextmenu(evt){var target=evt&&evt.getTarget(),legend=this.legend;$DOM.preventDefault(window,evt.e);if(legend&&$DOM.contains(legend.domNode,target,true)){this.handleRMCOnLegend(evt);}else{this.handleRMC(evt);}},configurePopup:function configurePopup(config,itemBtn){config.hostId=this.id;config.hostElement=itemBtn;},addFormatItemAndShowContextMenu:function(evt,cfg,formatHandler){if($UTIL.isOnExpressMode()){return ;}if(!cfg){cfg=this.addDisposable(new mstrmojo.ui.menus.MenuConfig());}if(!mstrApp.isAppStatePresentation()&&formatHandler&&mstrApp.allowWebDashboardDesign()){if(cfg.hasMenuItems()){cfg.addSeparator();}cfg.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",formatHandler);}if(cfg.hasMenuItems()){cfg.position=mstrmojo.dom.getMousePosition(evt.e,evt.hWin);cfg.isHostedWithin=false;this.openPopup(cfg.newInstance());}},getRMCToolbarPos:function getRMCToolbarPos(evt){return{x:evt.pageX+2,y:evt.pageY+2};},handleRMCOnLegend:function handleRMCOnLegend(evt){var target=evt&&evt.getTarget(),pos=this.getRMCToolbarPos(evt.e),type=target.getAttribute("type"),me=this,propertyManager=me.propertyManager,legend=this.legend,tfg,formatHandler;this.clearRMCTargets();if(type!==CTRL_TYPE.LGD_COLORBOX&&type!==CTRL_TYPE.LGD_COLORBOX_CTN){if(!mstrApp.isAppStatePresentation()){formatHandler=function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");me.parent.selectVIUnit();me.raiseEvent({name:"switchToPanel",panelID:CATEGORIES_LEGEND});switch(type){case CTRL_TYPE.LGD_TITLE:case CTRL_TYPE.LGD_TEXT:legend.selectText(true);var fontGroupSmartNames=propertyManager.getSmartNamesMapForFontGroup("lg");tfg=getFontToolbar(me,fontGroupSmartNames);break;default:legend.selectLegendBody();var fillSmartNames=propertyManager.getSmartNamesMapForColorFormat("lgBg");tfg=getFillToolbar(me,mstrmojo.desc(2885,"Fill"),fillSmartNames);break;}if(tfg){me.hideTooltip();showToolbarByFormat.call(me,pos,tfg,true);}};this.addFormatItemAndShowContextMenu(evt,null,formatHandler);switch(type){case CTRL_TYPE.LGD_TITLE:case CTRL_TYPE.LGD_TEXT:legend.selectText(true);break;default:legend.selectLegendBody();break;}}}evt.cancel();},getRealTarget:function getRealTarget(target){var type=target.getAttribute("type");if(!target){return null;}if(isMatrixLineContainer(type)){target=target.firstChild;}return target;},handleRMC:function handleRMC(evt){var widget=this,iLTable=this.imageLayoutTable,target=this.getRealTarget(evt&&evt.getTarget()),pos=this.getRMCToolbarPos(evt.e),type=target.getAttribute("type"),formatHandler,formatToolbarCfg,propertyManager=this.propertyManager;if(isDataLabel(type)){this.hideTooltip();widget.highlightRMCTargets(widget.getTargetsWithSameType(target));formatHandler=function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");widget.parent.selectVIUnit();widget.raiseEvent({name:"switchToPanel",panelID:CATEGORIES_SHAPES_AND_DATA_LABELS});var fontGroupSmartNames=propertyManager.getSmartNamesMapForFontGroup(PREFIX_DATA_LABELS);formatToolbarCfg=getFontToolbar(widget,fontGroupSmartNames);if(formatToolbarCfg){widget.hideTooltip();showToolbarByFormat.call(widget,pos,formatToolbarCfg,true);}};widget.addFormatItemAndShowContextMenu(evt,iLTable.getDataLabelMenuConfig(),formatHandler);evt.cancel();}else{iLTable.handleSingleClick(evt);this.hideTooltip();var defaultSelectedObjs=widget.defaultSelectedObjs,selectedObjCnt=defaultSelectedObjs&&Object.keys(defaultSelectedObjs).length,hasSelectedObj=selectedObjCnt>0;if(hasSelectedObj){formatHandler=function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");widget.parent.selectVIUnit();widget.raiseEvent({name:"switchToPanel",panelID:CATEGORIES_SHAPES_AND_DATA_LABELS});var fillChildrenNames=propertyManager.getSmartNamesMapForColorFormat(PREFIX_SHAPE_FORMATTING),lineChildrenNames=propertyManager.getSmartNamesMapForLineGroup(PREFIX_SHAPE_BORDER);if(widget.getColorByIndex()>=0){formatToolbarCfg=getFillOpacityAndBorderStyleToolbar(widget,fillChildrenNames,lineChildrenNames);}else{formatToolbarCfg=getFillAndBorderToolbar(widget,fillChildrenNames,lineChildrenNames);}if(formatToolbarCfg){widget.hideTooltip();showToolbarByFormat.call(widget,pos,formatToolbarCfg,true);}};widget.addFormatItemAndShowContextMenu(evt,iLTable.getSelectionMenuConfig(),formatHandler);evt.cancel();}else{if(!mstrApp.isAppStatePresentation()){widget.highlightRMCTargets(widget.getTargetsWithSameType(target));if(isVMatrixLine(type)||isHMatrixLine(type)||isMatrixLineContainer(type)){formatHandler=function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");widget.parent.selectVIUnit();widget.raiseEvent({name:"switchToPanel",panelID:CATEGORIES_ROWS_COLUMNS});widget.raiseEvent({name:"switchTargetSelector",selName:"selBdrMtxLn4",value:0});var lineSmartNames=propertyManager.getSmartNamesMapForLineGroup(NAME_BORDER_METRICS_LINE_FOR+LEVEL_SEPARATOR);formatToolbarCfg=getLineToolbar(widget,mstrmojo.desc(13927,"Line:"),lineSmartNames,{showNoFillInColor:false});if(formatToolbarCfg){widget.hideTooltip();showToolbarByFormat.call(widget,pos,formatToolbarCfg,true);}};}else{formatHandler=function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");widget.parent.selectVIUnit();widget.raiseEvent({name:"switchToPanel",panelID:CATEGORIES_TITLE_AND_CONTAINERS});formatToolbarCfg=getFillToolbar(widget,mstrmojo.desc(3905,"Background"),{bgColor:"bgFillClr"},{width:"60px",visibleControls:mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS.FILL_COLOR});if(formatToolbarCfg){widget.hideTooltip();showToolbarByFormat.call(widget,pos,formatToolbarCfg,true);}};}widget.addFormatItemAndShowContextMenu(evt,null,formatHandler);evt.cancel();}}}},getTargetsWithSameType:function(target){var targets=[],type=target.getAttribute("type"),typeGroups=[[CTRL_TYPE.GM_V_MATRIX_LINE,CTRL_TYPE.GM_H_MATRIX_LINE],[CTRL_TYPE.GM_DATA_LABEL]];$ARRAY.forEach(typeGroups,function(typeGroup){if(typeGroup.indexOf(type)!==-1){targets=$UTIL.findElementsByAttribute(this.domNode,"type",typeGroup);return false;}},this);return targets;},layoutSubwidgets:function layoutSubwidgets(){this.renderLegend();if(this._super){this._super();}},getProperties:function(){var model=this.modelData;return(model&&model.vp)||{};},getFormatString:function getFormatString(idx){var m=this.modelData,nf=m.nf||[],len=nf.length,nfs;if(idx>=0&&idx<len){nfs=$UTIL.getNumberFormat(m,idx);return nfs.replace(/\'/g,'"');}return"";},getColorByMetricThreshold:function(){if(!this.hasColorByThs()){return ;}var colorByMetricThreshold;if(this.colorByMetricThreshold){colorByMetricThreshold=this.colorByMetricThreshold;}else{var m=this.modelData,mx=m.gsi.mx,mxOfColorMetric=mx[this.colorByIndex],colorMetricID=mxOfColorMetric&&mxOfColorMetric.did,rankMode,colorByMetricThresholdItems;if(mxOfColorMetric.max===""&&mxOfColorMetric.min===""){this.colorByMetricThreshold=undefined;return ;}if(m.gsi.thresholds[colorMetricID]&&mxOfColorMetric){var thresholds,fs;thresholds=m.gsi.thresholds[colorMetricID];rankMode=$UTIL.getRankMode(thresholds);fs=$UTIL.getColorByFormatStr(this.getFormatString(this.colorByIndex),rankMode);colorByMetricThresholdItems=$UTIL.getColorByItems(thresholds,rankMode,mxOfColorMetric.max,mxOfColorMetric.min,mxOfColorMetric.cnt,fs,$CLRUTIL.getCSSColorString(Background_Color));colorByMetricThresholdItems.sort(function(item1,item2){var r;if(item1.ceil>item2.ceil){r=1;}else{if(item1.ceil===item2.ceil){r=0;}else{r=-1;}}return r;});}else{if(mxOfColorMetric){colorByMetricThresholdItems=$UTIL.getDefaultColorByItems($CLRUTIL.getCSSColorString(Background_Color),mxOfColorMetric.max,mxOfColorMetric.min);}else{colorByMetricThresholdItems=$UTIL.getDefaultColorByItems($CLRUTIL.getCSSColorString(Background_Color),1,0);}rankMode=ENUM_COLOR_RANKMODE.VALUE;}colorByMetricThreshold={rankMode:rankMode,items:colorByMetricThresholdItems,n:mxOfColorMetric.n};this.colorByMetricThreshold=colorByMetricThreshold;}return colorByMetricThreshold;},isOnRight:function(slot){return(slot===PRP_LEGEND_SLOT.RIGHT_MIDDLE||slot===PRP_LEGEND_SLOT.RIGHT_TOP||slot===PRP_LEGEND_SLOT.RIGHT_BOTTOM);},onLegendDropZoneChange:function onLegendDropZoneChange(dropZoneInfo,dockedPosIdx){var prevSlotIndex=this.legend.currDockedPositionIdx,canvasOuterContainer=this.imageLayoutTable.domNode,preOnRight,curOnRight;if(dockedPosIdx!==prevSlotIndex){preOnRight=this.isOnRight(LEGEND_DOCK_POS[prevSlotIndex].pos);curOnRight=this.isOnRight(dropZoneInfo.pos);if(preOnRight!==curOnRight){canvasOuterContainer.style.left=curOnRight?"0px":this.legendW+"px";}}},onLegendDropped:function(legendDockPos){var propertyManager=this.propertyManager;propertyManager.setFormatPropertyValue(PROPERTIES_TYPE.LEGEND_POSITION,legendDockPos);},getLegendColorByInfo:function(){var colorByMetricThresholds=this.getColorByMetricThreshold(),metricName;if(colorByMetricThresholds){metricName=$UTIL.getColorByTitle(colorByMetricThresholds.n,colorByMetricThresholds.rankMode);this.legendColorByElements={item:colorByMetricThresholds.n,elements:colorByMetricThresholds.items};}else{this.legendColorByElements=undefined;}return this.legendColorByElements;},getLegendSizeByInfo:function(){if(this.sizeByIndex>-1){var m=this.modelData,mx=m.gsi.mx,mxOfSizeMetric=mx[this.sizeByIndex],range={min:Infinity,max:-Infinity};range.max=Math.max(mxOfSizeMetric.max,range.max);range.min=Math.min(mxOfSizeMetric.min,range.min);if(range.max===Infinity&&range.min===-Infinity){this.legendSizeByElements=undefined;return ;}var sfs=this.getFormatString(this.sizeByIndex);var sizeByValueStrings=[],i,start=range.min,end=range.max,delta=(end-start)/4;for(i=0;i<5;i++){sizeByValueStrings.push(formatByValidation.call(this,sfs,end-i*delta));}var res={},elements;var mxName=mxOfSizeMetric.n;if(range.min<0){mxName=STR_ABS_VALUE_OF+mxName;}res.item=mxName;if(sizeByValueStrings.length>1){elements=res.elements=[];$ARRAY.forEach(sizeByValueStrings,function(szByValue){elements.push({sign:"<",v:szByValue});});if(elements.length===5){elements[0].sign="=";elements[4].sign="=";}res.caseFlag=0;}if(sizeByValueStrings.length===1){res.elements=[{diameter:12,shape:"rect",sign:"=",v:sizeByValueStrings[0]}];res.caseFlag=2;}this.legendSizeByElements=res;}else{this.legendSizeByElements=undefined;}return this.legendSizeByElements;},hasThresholdInColorBy:function hasThrInClrBy(){var m=this.modelData,gsi=m&&m.gsi,mx=gsi&&gsi.mx,ths=gsi&&gsi.thresholds,mxOfColorMetric=mx&&mx[this.colorByIndex],colorMetricID=mxOfColorMetric&&mxOfColorMetric.did,threshold=ths&&ths[colorMetricID];return threshold!==undefined;},hasColorByThs:function hasColorByThs(){return(this.calculateColorByIndex()>-1)&&this.hasThresholdInColorBy();},hasSizeByOrColorByThs:function hasSizeByOrColorByThs(){var hasSizeBy=(this.calculateSizeByIndex()>-1),hasColorBy=this.hasColorByThs();return hasSizeBy||hasColorBy;},isLegendShown:function isLegendShown(){var hasLegend=this.hasSizeByOrColorByThs(),showLegend=this.propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.LEGEND_SHOW);return hasLegend&&showLegend;},hEvalSize4Legend:function hEvalSize4Legend(){var propertyManager=this.propertyManager,rtn,cData,sData,width=this.getWidth(),height=this.getHeight(),legendStyle=propertyManager.getLegendStyles();if(!this.isLegendShown()){this.legendW=this.legendH=this.legendP=0;}else{cData=this.getLegendColorByInfo();sData=this.getLegendSizeByInfo();$LEGEND.applyHTML5Props(legendStyle);this.legendP=LEGEND_PADDING;this.legendScale=propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.LEGEND_SCALE);rtn=$LEGEND.getLegendSize([{dataType:LEGEND_DATA_TYPE.COLOR_BY,dataObj:cData},{dataType:LEGEND_DATA_TYPE.SIZE_BY,dataObj:sData}],this.legendScale!==1?this.legendScale:undefined,width,height,legendStyle,this.legendFixedW);this.legendCutBy=rtn.cutBy;this.legendMinHeight=rtn.minHeight;this.legendFixedW=rtn.width;if(rtn.scale){this.legendScale=rtn.scale;}if(propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.LEGEND_MODE)===ENUM_LEGEND_MODE.MINIMIZED||rtn.autoCollapse){rtn=$LEGEND.getLegendSize4MinMode(cData,height);this.legendCutBy=undefined;}this.legendW=rtn.width;this.legendH=rtn.height;}},toggleLegend:function toggleLegend(show){if(!this.legendNode){return ;}if(show){this.legendNode.style.display="block";}else{this.legendNode.style.display="none";}},hInitLegendListeners:function(){var me=this,id=this.id;if(this.legend){this.legendResizeListener=this.legend.attachEventListener("gm-legend-resized",id,function(evt){me.onLegendResized(evt.position);});this.legendClickListener=this.legend.attachEventListener("gm-legend-clicked",id,function(evt){me.onLegendClicked(evt);});}},onLegendResized:function(distance){var propertyManager=this.propertyManager;if(this.legend){this.legendFixedW=this.legendW+distance;this.legendScale=(this.legendFixedW)/(this.legendW/this.legendScale);propertyManager.setFormatPropertyValue(PROPERTIES_TYPE.LEGEND_SCALE,this.legendScale);}},onLegendClicked:function(evt){var action=evt.action,propertyManager=this.propertyManager;if(action==="close"){propertyManager.setFormatPropertyValue(PROPERTIES_TYPE.LEGEND_SHOW,false);}else{if(action==="minimize"){propertyManager.setFormatPropertyValue(PROPERTIES_TYPE.LEGEND_MODE,ENUM_LEGEND_MODE.MINIMIZED);}else{if(action==="restore"){propertyManager.setFormatPropertyValue(PROPERTIES_TYPE.LEGEND_MODE,ENUM_LEGEND_MODE.RESTORED);}}}},renderLegend:function renderLegend(){var propertyManager=this.propertyManager;this.hEvalSize4Legend();if(this.isLegendShown()){this.legend=this.addDisposable(new $GM.GMLegend({widget:this,width:this.legendW,height:this.legendH,model:this.model,placeholder:this.legendNode,cssClass:"gm-legend",currDockedPositionIdx:getLegendDockPosIdx(propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.LEGEND_POSITION)),styles:propertyManager.getLegendStyles(),cutBy:this.legendCutBy,readGlobalProperty:function(propName){var propertyManager=this.widget.propertyManager;return propertyManager.getFormatPropertyValue(propName);},writeGlobalProperty:function(propName,newValue){}}));this.legend.render();this.legend.parent=this;this.legendNode=this.legend.domNode;this.legend.cutBy=this.legendCutBy;this.legend.minHeight=this.legendMinHeight;this.legend.updateContainerSize(this.getWidth(),this.getHeight());this.hInitLegendListeners();this.legend.feedData([{dataType:LEGEND_DATA_TYPE.COLOR_BY,dataObj:this.legendColorByElements},{dataType:LEGEND_DATA_TYPE.SIZE_BY,dataObj:this.legendSizeByElements}],(this.legend.readGlobalProperty(PROPERTIES_TYPE.LEGEND_MODE)===ENUM_LEGEND_MODE.MINIMIZED));this.toggleLegend(true);}else{this.toggleLegend(false);}},onmouseup:function onmouseup(evt){if(this.beingScrolled){this.beingScrolled=false;}},onscroll:function onscroll(evt){var x,y,me=this,manager=this.manager,target=evt.getTarget();if(!this.beingScrolled){this.beingScrolled=true;}y=this.domVSBar.scrollTop;x=this.domHSBar.scrollLeft;manager.scrollTo(x,y);manager.drawCharts();},doSelection:function(transformSelectionFn){this.prepareSelectedNodesInfo(transformSelectionFn);this.endSelections();},getSelectionObjInfo:function(selectedObjs){var me=this,ghsElems=me.getGhsItems(),gtsRow=me.getGtsRow(),attrFormIndices=me.attrFormIndices,oneAttrForms,oneAttrFormCount,attrCount=attrFormIndices.length,formCount,selObjsInfo=[],selObjInfo,lineIndex,lineItems,lineItem,lineItemIndex,attrIndex,formIndex,i,attrObj,attrElems,attrName,attrID,attrElemObj,attrElemName,attrElemID;selectedObjs=selectedObjs||{};for(lineIndex in selectedObjs){if(selectedObjs.hasOwnProperty(lineIndex)){lineItems=ghsElems[lineIndex].items;formCount=lineItems.length;selObjInfo=[];for(attrIndex=0;attrIndex<attrCount;attrIndex++){oneAttrForms=attrFormIndices[attrIndex];oneAttrFormCount=oneAttrForms.length;attrObj=gtsRow[attrIndex];attrElems=attrObj.es;attrName=attrObj.n;attrID=attrObj.id;for(i=0;i<oneAttrFormCount;i++){formIndex=oneAttrForms[i];if(formIndex<formCount){lineItem=lineItems[formIndex];lineItemIndex=lineItem.idx;attrElemObj=attrElems[lineItemIndex];attrElemName=attrElemObj.n;attrElemID=attrElemObj.id;selObjInfo.push({n:attrName,tid:attrID,v:attrElemName,eid:attrElemID});}}}selObjsInfo.push(selObjInfo);}}return selObjsInfo;},getMenuHandler:function getMenuHandler(fName){var selObjsInfo,me=this;function selectionKeepOnly(){me.updateAfterKeepOnly(true);}function selectionExclude(){me.updateAfterKeepOnly(false);}function selectionShowData(){selObjsInfo=me.getSelectionObjInfo(me.defaultSelectedObjs);me.showData(selObjsInfo);}switch(fName){case"selectionKeepOnly":return selectionKeepOnly;case"selectionExclude":return selectionExclude;case"selectionShowData":return selectionShowData;}},getDataLabelShowSubMenu:function(){var me=this,propertyManager=this.propertyManager,DATA_LABEL=propertyManager.CONSTANTS.DATA_LABEL,subMenu=new mstrmojo.ui.menus.MenuConfig(),fnOn=function(currSwitch){return function(){propertyManager.setFormatPropertyValue(PROPERTIES_TYPE.DATA_LABEL_SWITCH,propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.DATA_LABEL_SWITCH)|currSwitch);};},fnOff=function(currSwitch){return function(){propertyManager.setFormatPropertyValue(PROPERTIES_TYPE.DATA_LABEL_SWITCH,propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.DATA_LABEL_SWITCH)^currSwitch);};},fnHide=function(){propertyManager.setFormatPropertyValue(PROPERTIES_TYPE.DATA_LABEL_SWITCH,DATA_LABEL.NONE);},noResponse=function(){},isOn=function(currSwitch){return(propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.DATA_LABEL_SWITCH)&currSwitch)!==DATA_LABEL.NONE;};subMenu.addToggleMenuItem(mstrmojo.desc(1013,"Text"),"xt",fnOn(DATA_LABEL.SHOW_TEXT),fnOff(DATA_LABEL.SHOW_TEXT),me.id,isOn(DATA_LABEL.SHOW_TEXT));subMenu.addToggleMenuItem(mstrmojo.desc(2175,"Value"),"xt",fnOn(DATA_LABEL.SHOW_VALUE),fnOff(DATA_LABEL.SHOW_VALUE),me.id,isOn(DATA_LABEL.SHOW_VALUE));subMenu.addToggleMenuItem(mstrmojo.desc(2057,"None"),"xt",fnHide,noResponse,me.id,propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.DATA_LABEL_SWITCH)===DATA_LABEL.NONE);return subMenu;},useAsSelector:function(){return this.modelData.hasOwnProperty("sc");},canClearAll:function(){if(this.useAsSelector){return this.modelData.sc.clearAll||this.modelData.sc.showall;}return false;},hasMultipleSelected:function(){var ds=this.defaultSelectedObjs;if(ds){return getObjSize(ds)>1;}return false;},hasSingleSelected:function(){var ds=this.defaultSelectedObjs;if(ds){return getObjSize(ds)===1;}return false;},hasNoSelected:function(){var ds=this.defaultSelectedObjs;return !ds||this.isOwnEmpty(ds);},getShouldHighlightDefaultSelectedNodes:function(){return !this.isOwnEmpty(this.defaultSelectedObjs);},calculateColorByIndex:function calculateAreaColorByIndex(){var me=this,metrics,dzInfo=me.getDZ(),colorByInDZ=dzInfo&&dzInfo.ColorBy;me.colorByIndex=me.getIndexFromDZ("COL",me.CONSTANTS.DP_IN_DZ.COLOR_BY);if(mstrApp.isExpress&&me.colorByIndex<0&&!colorByInDZ){metrics=$UTIL.getPropertyByPath(this.modelData,"ghs.chs.items.0.items",[]);me.colorByIndex=metrics&&metrics.length>0?(metrics&&metrics.length>=2?1:0):-1;var m=me.modelData,thresholds=m.gsi.thresholds,mx=m.gsi.mx,mxOfColorMetric=mx[me.colorByIndex],colorMetricID=mxOfColorMetric&&mxOfColorMetric.did,colorMetricName=mxOfColorMetric&&mxOfColorMetric.n;if(!thresholds||Object.keys(thresholds).length===0){m.gsi.thresholds=$UTIL.generateThresholdsInfo(colorMetricID,colorMetricName,IMAGELAYOUT_THRESHOLD_COLORS,IMAGELAYOUT_THRESHOLD_BANDS);}}return me.colorByIndex;},calculateSizeByIndex:function calculateSizeByIndex(){var me=this,metrics,dzInfo=me.getDZ(),sizeByInDZ=dzInfo&&dzInfo.SizeBy,propertyManager=me.propertyManager,DISPLAY_MODE=propertyManager.CONSTANTS.DISPLAY_MODE,isAreaMode=propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.DISPLAY_MODE)===DISPLAY_MODE.AREA;me.sizeByIndex=me.getIndexFromDZ("COL",me.CONSTANTS.DP_IN_DZ.SIZE_BY);if(mstrApp.isExpress&&me.sizeByIndex<0&&!sizeByInDZ&&!isAreaMode){metrics=$UTIL.getPropertyByPath(this.modelData,"ghs.chs.items.0.items",[]);me.sizeByIndex=metrics&&metrics.length>0?0:-1;}return me.sizeByIndex;},createBaseImageLayout:function createBaseImageLayout(props){return new mstrmojo.HtmlBaseImageLayout(props);},createWidgetMatrix:function(props){var propertyManager=this.propertyManager,legendPos=propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.LEGEND_POSITION),legendOnRight=this.isOnRight(legendPos);if(!props){props={};}props.left=legendOnRight?0:this.legendW;return new mstrmojo.HtmlWidgetMatrix(props);},createUnitChart:function createUnitChart(w,h,t,l,row,col){var me=this,miniChartIndex=row*me.finalColCnt+col,ht=me.CONSTANTS.SUB_TITLE_HEIGHT,cbw=me.CONSTANTS.CHART_BORDER_WIDTH,isDarkTheme=(me.themeMode===me.CONSTANTS.THEME.DARK),isRightColumn=(col===me.finalColCnt-1),isBottomRow=(row===me.finalRowCnt-1),subParentDiv,subTitleDiv,imageLayout,miniCharts=me.miniCharts,rowStr=row.toString(),colStr=col.toString(),props;if(miniChartIndex>=me.miniChartCount){return document.createElement("div");}if(!me.hasMultiAttr){ht=0;cbw=0;}subParentDiv=document.createElement("div");$CSS.addClass(subParentDiv,["subImageLayout-subParent"]);if(isDarkTheme){$CSS.addClass(subParentDiv,["dark"]);}else{$CSS.addClass(subParentDiv,["light"]);}if(isBottomRow){$CSS.addClass(subParentDiv,["bottom"]);}if(isRightColumn){$CSS.addClass(subParentDiv,["right"]);}subParentDiv.setAttribute("row",row);subParentDiv.setAttribute("col",col);if(w!==undefined){subParentDiv.style.width=w-cbw+"px";}if(h!==undefined){subParentDiv.style.height=h-cbw+"px";}if(t!==undefined){subParentDiv.style.top=t+"px";}if(l!==undefined){subParentDiv.style.left=l+"px";}if(this.hasMultiAttr){subTitleDiv=document.createElement("div");$CSS.addClass(subTitleDiv,["subImageLayout-title"]);if(isDarkTheme){$CSS.addClass(subTitleDiv,["dark"]);}else{$CSS.addClass(subTitleDiv,["light"]);}subTitleDiv.innerHTML=me.getSubTitle(row,col);subParentDiv.appendChild(subTitleDiv);}if(miniCharts===null){miniCharts=me.miniCharts={};}if(!miniCharts.hasOwnProperty(rowStr)){miniCharts[rowStr]={};}if(!miniCharts[rowStr].hasOwnProperty(colStr)){props={totalWidget:me,mapFileIndex:row*me.finalColCnt+col,model:me.modelData,controller:me.controller,xtabModel:me.getModel(),width:me.CONSTANTS.MIN_WIDTH_OR_HEIGHT,height:me.CONSTANTS.MIN_WIDTH_OR_HEIGHT,top:ht,left:0,CONSTANTS:me.CONSTANTS};if(w!==undefined){props.width=w-cbw;}if(h!==undefined){props.height=h-ht-cbw;}imageLayout=me.createBaseImageLayout(props);imageLayout.render();imageLayout.parent=me.imageLayoutTable;miniCharts[rowStr][colStr]=imageLayout;}else{imageLayout=miniCharts[rowStr][colStr];if(w!==undefined){imageLayout.width=w-cbw;}if(h!==undefined){imageLayout.height=h-ht-cbw;}imageLayout.refresh();}subParentDiv.appendChild(imageLayout.domNode);return subParentDiv;},updateUnitChart:function updateUnitChart(div,w,h,t,l){if(!div){return ;}if(this.imageLayoutTable.beingScrolled||(div.offsetWidth===w&&div.offsetHeight===h)){return ;}var me=this,miniCharts=me.miniCharts,rowIndexStr=div.getAttribute("row"),colIndexStr=div.getAttribute("col"),ht=me.CONSTANTS.SUB_TITLE_HEIGHT,cbw=me.CONSTANTS.CHART_BORDER_WIDTH,miniChart;if(!me.hasMultiAttr){ht=0;cbw=0;}if(w!==undefined){div.style.width=w-cbw+"px";}if(h!==undefined){div.style.height=h-cbw+"px";}if(t!==undefined){div.style.top=t+"px";}if(l!==undefined){div.style.left=l+"px";}if(miniCharts&&miniCharts.hasOwnProperty(rowIndexStr)&&miniCharts[rowIndexStr].hasOwnProperty(colIndexStr)){miniChart=miniCharts[rowIndexStr][colIndexStr];if(w!==undefined){miniChart.width=w-cbw;}if(h!==undefined){miniChart.height=h-ht-cbw;}miniChart.refresh();}},getBgColorFromCss:function getBgColorFromCss(cellData){var ths=this.getTh(),th=ths&&ths.hasOwnProperty(this.colorByIndex)&&ths[this.colorByIndex],hasThData=th&&th.length>0,ty,ti,thresholdClr=null;if(th&&cellData&&cellData.hasOwnProperty("ty")){ty=parseInt(cellData.ty,10);ti=cellData.hasOwnProperty("ti")?parseInt(cellData.ti,10):undefined;if((ty===2||ty===4)&&ti!==undefined&&th.length>ti&&th[ti].hasOwnProperty("fillclr")){thresholdClr=th[ti].fillclr;}}if(!thresholdClr&&mstrApp.isExpress&&this.hasThresholdInColorBy()&&!hasThData){var rv,modelData=this.modelData,gsi=modelData&&modelData.gsi,mx=gsi&&gsi.mx,metrixRange=mx&&mx[this.colorByIndex],max=metrixRange&&metrixRange.max,min=metrixRange&&metrixRange.min,dataRatio,bandLen,idx;rv=cellData&&cellData.rv;if(max===min){dataRatio=0;}else{dataRatio=(rv-min)/(max-min);}bandLen=IMAGELAYOUT_THRESHOLD_BANDS.length;for(idx=0;idx<bandLen;idx++){if(dataRatio<IMAGELAYOUT_THRESHOLD_BANDS[idx]){thresholdClr=IMAGELAYOUT_THRESHOLD_COLORS[idx];break;}}if(dataRatio>=IMAGELAYOUT_THRESHOLD_BANDS[bandLen-1]){thresholdClr=IMAGELAYOUT_THRESHOLD_COLORS[bandLen];}}return thresholdClr;},calculateAllBubblesColor:function calculateAllBubblesColor(colorByIndex){var me=this,propertyManager=me.propertyManager,modelData=me.modelData,gvs=me.getGvs(),i,defBubbleColor=propertyManager.getFormatPropertyValue(PROPERTIES_TYPE.SHAPE_FILL_COLOR),colorByCellData,bubbleColor;modelData.allBubblesColor={};if(colorByIndex>=0){for(i=0;i<gvs.items.length;i++){colorByCellData=gvs.items[i].items[colorByIndex];bubbleColor=me.getBgColorFromCss(colorByCellData);if(!bubbleColor){bubbleColor=defBubbleColor;}modelData.allBubblesColor[i]=bubbleColor;}}return modelData.allBubblesColor;},miniChartResizedCallback:function mrcb(evt){if(this._super){this._super(evt);}this.calculateBubbleSizeParas();var me=this,sbwh=me.sbwh,scrollBarStatusConstants=me.CONSTANTS.SCROLL_BAR_STATUS,imageLayoutTableCanvas=me.imageLayoutTable&&me.imageLayoutTable.domCanvas,scrollBarCorner=me.scrollBarCorner,widgetW=me.getWidgetWidth(),widgetH=me.getHeight(),matrixW=imageLayoutTableCanvas?imageLayoutTableCanvas.offsetWidth:0,matrixH=imageLayoutTableCanvas?imageLayoutTableCanvas.offsetHeight:0,viewW=widgetW-sbwh,viewH=widgetH-sbwh,vsbStyle=me.domVSBar.style,hsbStyle=me.domHSBar.style;if(matrixW<=viewW&&matrixH<=viewH){vsbStyle.display="none";hsbStyle.display="none";scrollBarCorner.style.display="none";me.scrollBarStatus=scrollBarStatusConstants.NONE;}else{if(matrixW>viewW&&matrixH<=viewH){vsbStyle.display="none";hsbStyle.display="block";hsbStyle.width=me.getWidgetWidth()+"px";scrollBarCorner.style.display="none";me.scrollBarStatus=scrollBarStatusConstants.HORIZONTAL;}else{if(matrixW<=viewW&&matrixH>viewH){vsbStyle.height=me.getHeight()+"px";vsbStyle.display="block";hsbStyle.display="none";scrollBarCorner.style.display="none";me.scrollBarStatus=scrollBarStatusConstants.VERTICAL;}else{if(matrixW>viewW&&matrixH>viewH){vsbStyle.height=(me.getHeight()-sbwh)+"px";hsbStyle.width=(me.getWidgetWidth()-sbwh)+"px";vsbStyle.display="block";hsbStyle.display="block";me.scrollBarStatus=scrollBarStatusConstants.BOTH;scrollBarCorner.style.display="block";scrollBarCorner.style.left=(widgetW-sbwh)+"px";scrollBarCorner.style.top=(widgetH-sbwh)+"px";}}}}},createPropsForImageLayoutTable:function(){var me=this,ph=me.createPlaceholder(),props,vsbStyle,hsbStyle,sbwh=me.sbwh,scrollBarStatusConstants=me.CONSTANTS.SCROLL_BAR_STATUS,hasVSB=me.scrollBarStatus===scrollBarStatusConstants.VERTICAL,hasHSB=me.scrollBarStatus===scrollBarStatusConstants.HORIZONTAL;vsbStyle=me.domVSBar.style;vsbStyle.height=me.getHeight()+"px";vsbStyle.top="0px";vsbStyle.left=(me.getWidth()-sbwh)+"px";if(hasVSB){vsbStyle.display="block";}else{vsbStyle.display="none";}me.domVSBarBody.style.height=(me.cellHeight*me.finalRowCnt)+"px";hsbStyle=me.domHSBar.style;hsbStyle.width=(me.getWidgetWidth()-sbwh)+"px";hsbStyle.top=(me.getHeight()-sbwh)+"px";hsbStyle.left="0px";if(hasHSB){hsbStyle.display="block";}else{hsbStyle.display="none";}me.domHSBarBody.style.width=(me.cellWidth*me.finalColCnt)+"px";props={placeholder:ph,left:0,top:0,width:hasVSB?me.getWidgetWidth()-sbwh:me.getWidgetWidth(),height:me.getHeight(),nRows:me.finalRowCnt,nCols:me.finalColCnt,chartW:me.cellWidth,chartH:me.cellHeight,domHSBar:me.domHSBar,domVSBar:me.domVSBar,domHSBarBody:me.domHSBarBody,domVSBarBody:me.domVSBarBody,borderW:me.CONSTANTS.CHART_BORDER_WIDTH,APIOwner:me,manager:me.manager||new mstrmojo.WidgetMatrixManager()};return props;},update:function update(){if(this._super){this._super();}delete this.colorByMetricThreshold;delete this.legendColorByElements;delete this.legendSizeByElements;},destroy:function destroy(){if(this._super){this._super();}delete this.legend;}});}());