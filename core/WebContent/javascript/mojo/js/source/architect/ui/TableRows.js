(function(){mstrmojo.requiresCls("mstrmojo.ui.SimpleTree","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.architect.ui._HasTreeDropZone","mstrmojo.string","mstrmojo.dom");var $DOM=mstrmojo.dom,$STR=mstrmojo.string,$ENUM_DATA_CHANGE_EVENTS=mstrmojo.architect.EnumDataChangeEvents,$ENUM_DRAG_ACTIONS=mstrmojo.architect.EnumDragActions,DRAG_ACTION_TABLE_COLUMN=$ENUM_DRAG_ACTIONS.PROJECT_TABLE_COLUMN,DRAG_ACTION_TABLE_ATTR=$ENUM_DRAG_ACTIONS.TABLE_VIEW_ATTR,DRAG_ACTION_TABLE_METRIC=$ENUM_DRAG_ACTIONS.TABLE_VIEW_METRIC,DRAG_ACTION_COMPOUND_FORM=$ENUM_DRAG_ACTIONS.COMPOUND_FORM,CSS_MENU_CLASS="item-mn",IDX_ATTR="idx";mstrmojo.architect.ui.TableRows=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo.warehouse._CanToggleAvatarClass,mstrmojo.architect.ui._HasTreeDropZone],{scriptClass:"mstrmojo.architect.ui.TableRows",getItemMarkup:function getItemMarkup(item){return'<div class="item {@cls}" title="{@ttp}"><span class="item-ic"></span><span class="item-n">{@n}</span><span class='+CSS_MENU_CLASS+"></span></div>";},getItemProps:function getItemProps(item,idx){return{sel:!!this.selectedIndices[idx],cls:("tp"+item.tp)+(item.unused?" uc":""),n:$STR.encodeHtmlString(item.n),idx:idx,ttp:$STR.encodeXMLAttribute(item.ttp)};},getRowItem:function getRowItem(index){return this.getTreeItem(index);},isItemAvailable:function isItemAvailable(itemId){return this.getItemWithPropName(this.items,"did",itemId).length>0;},handleEvent:function handleEvent(evt){var item=this.getItemWithPropName(this.items,"did",evt.did)[0];switch(evt.name){case $ENUM_DATA_CHANGE_EVENTS.REMOVE:this.removeChild(item._renderIdx);return true;case $ENUM_DATA_CHANGE_EVENTS.RENAME:item.n=evt.value;this.updateChild(item._renderIdx,item);return true;}return false;},onclick:function onclick(evt){try{var target=evt.target||$DOM.eventTarget(evt.hWin,evt.e),item=$DOM.findAncestorByAttr(target,IDX_ATTR,true,this.domNode),idx=item&&item.value;if(target.className===CSS_MENU_CLASS&&idx!==null){this.raiseEvent({name:"tableViewMenuSelect",data:this.getTreeItem(idx),menuNode:target});}else{this._super(evt);}}catch(ex){throw ex;}},dropZone:true,allowDrop:function allowDrop(context){return[DRAG_ACTION_TABLE_COLUMN,DRAG_ACTION_TABLE_ATTR,DRAG_ACTION_COMPOUND_FORM,DRAG_ACTION_TABLE_METRIC].indexOf(context.action)!==-1;},ondrop:function ondrop(context){var rootController=mstrApp.getRootController(),contextSrc=context.src;if(contextSrc&&contextSrc.data){var dragData=contextSrc.data;var item=$DOM.findAncestorByAttr(context.tgt.node,IDX_ATTR,true,this.domNode);if(item){rootController.addTableInfo(dragData,this.getRowItem(item.value));}}this._super(context);}});}());