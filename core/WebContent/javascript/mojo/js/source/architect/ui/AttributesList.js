(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo._HasOwnAvatar","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.architect.EnumDragActions","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.Button");var $A=mstrmojo.array,$CSS=mstrmojo.css,$DOM=mstrmojo.dom,$H=mstrmojo.hash,$ENUM_DRAG_ACTIONS=mstrmojo.architect.EnumDragActions,$ENUM_DATA_CHANGE_EVENTS=mstrmojo.architect.EnumDataChangeEvents;function onAttributeRename(evt){var items=this.items,idx=$A.find(items,"attributeId",evt.did);if(!this.hasRendered){return ;}if(idx>-1){var item=items[idx];item.n=evt.value;this._getItemNode(idx).outerHTML=this.itemRenderer.render(item,idx,this);}}function onAttributesChange(evt){var relations=evt.relations,attributes={},items=[];$A.forEach(relations,function populateAttributes(relationObj){var parentId=relationObj.parentAttributeId,childId=relationObj.childAttributeId;attributes[parentId]={attributeId:parentId,n:relationObj.parentAttributeName};if(childId!==""){attributes[childId]={attributeId:childId,n:relationObj.childAttributeName};}});$H.forEach($H.copy(attributes),function populateAttributes(attributeObject){items.push(attributeObject);});items=items.sort(function(a,b){return a.n.toLowerCase().localeCompare(b.n.toLowerCase());});this.set("items",items);}mstrmojo.architect.ui.AttributesList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo._HasOwnAvatar,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.AttributesList",cssClass:"mstrmojo-ar-rpc-attrlist",draggable:true,dropZone:false,getItemMarkup:function getItemMarkup(item,idx){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-icn"></span><span>{@n}</span></div>';},init:function init(props){this._super(props);this.attributes={};var evtConfig={},containerConfig=evtConfig[this.id]={};containerConfig[$ENUM_DATA_CHANGE_EVENTS.RENAME]=onAttributeRename;containerConfig[$ENUM_DATA_CHANGE_EVENTS.ATTRIBUTES_CHANGED]=onAttributesChange;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},createAvatar:function createAvatar(sourceNode){var div=document.createElement("div");var item=$DOM.findAncestorByAttr(sourceNode,"idx",true,this.domNode);if(item&&item.node){div.appendChild(item.node.cloneNode(true));div.appendChild(document.createElement("div"));}div.className=this.domNode.className;return div;},isDragValid:function isDragValid(){return true;},getDragData:function getDragData(context){var item=$DOM.findAncestorByAttr(context.src.node,"idx",true,this.domNode);context.createRelations=true;return item&&this.items[item.value];},getDragAction:function getDragAction(){return $ENUM_DRAG_ACTIONS.LINKER_ATTR;},toggleAvatarClass:function toggleAvatarClass(cls,isAdd){$CSS.toggleClass(this.avatar,cls,isAdd);}});}());