(function(){mstrmojo.requiresCls("mstrmojo.Obj");var $A=mstrmojo.array,$H=mstrmojo.hash,$M=mstrmojo,$WRAP=$M.func.wrapMethods,$DBHLP=mstrmojo.warehouse.dbroles.DBRoleHelper,$ENUM_OT=mstrmojo.warehouse.EnumObjectTypes,ENUM_OT_LOGICALVIEW=$ENUM_OT.logicalView,DEFAULT_LOGICALVIEW_NAME="New logicalView",Enum_SM_CreateObject=1,Enum_SM_DeleteObject=2,Enum_SM_RenameObject=3,Enum_SM_EditLogicalView=-1;function getlogicalViews(){var logicalViews=this.model.logicalViews,items=[];$H.forEach(logicalViews,function(logicalView){items.push(logicalView);});return items;}function findNextName(newName){var logicalViews=getlogicalViews.call(this),count=1,name=newName,upperName=name.toUpperCase();do{if($DBHLP.findinArray(logicalViews,"name",upperName)>=0){name=newName+" "+count++;upperName=name.toUpperCase();}else{return name;}}while(count<10000);return"Temp logicalView";}mstrmojo.architect.obj.logicalView=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.logicalView",init:function init(props){this.model=props.mdl;this.elements=[];if(props.isNew){if(props.defaultName){this.createlogicalView(this,findNextName.call(this,DEFAULT_LOGICALVIEW_NAME),props.callback);}else{if(mstrApp.getRootController().validateName(ENUM_OT_LOGICALVIEW,props.newlogicalViewName,this.name)){this.createlogicalView(this,props.newlogicalViewName,props.callback);}}}else{this.id=props.id;this.name=props.n;this.onetoOneMappingType=true;}},name:"",id:"",columns:[],SQLStatement:"",submitRequest:function submitRequest(callback,params,fn){if(callback&&callback.success){callback.success();}},executeSQL:function executeSQL(callback){var logicalView=this;logicalView.submitRequest({success:function(res){if(callback&&callback.success){callback.success();}}},{manipulationtype:Enum_SM_CreateObject,objecttype:ENUM_OT_LOGICALVIEW,objectname:""},"schemaManipulation");},createlogicalView:function createlogicalView(logicalViewName,callback){var logicalView=this;logicalView.submitRequest({success:function(res){logicalView.id=logicalViewName;logicalView.name=logicalViewName;if(callback&&callback.success){callback.success(logicalViewName);}}},{manipulationtype:Enum_SM_CreateObject,objecttype:ENUM_OT_LOGICALVIEW,objectname:logicalViewName},"schemaManipulation");},rename:function rename(newlogicalViewName){var logicalView=this;if(mstrApp.getRootController().validateName(ENUM_OT_LOGICALVIEW,newlogicalViewName,this.name)){logicalView.submitRequest({success:function(){logicalView.name=newlogicalViewName;}},{manipulationtype:Enum_SM_RenameObject,objecttype:ENUM_OT_LOGICALVIEW,objectid:this.id,objectname:newlogicalViewName},"schemaManipulation");return true;}return false;},remove:function remove(callback){var logicalView=this;logicalView.submitRequest({logicalView:this,callback:callback,success:function(){if(this.callback&&this.callback.success){this.callback.success(this.logicalView.id);}}},{manipulationtype:Enum_SM_DeleteObject,objecttype:ENUM_OT_LOGICALVIEW,objectid:this.id},"schemaManipulation");},getlogicalViewData:function getlogicalViewData(){var logicalView=this,returnValue={n:logicalView.name,did:logicalView.id,tp:ENUM_OT_LOGICALVIEW,SQLStatement:logicalView.SQLStatement,isVisible:function isVisible(data,item){return logicalView.model.handleVisibleAction(data,item);},isChecked:function isChecked(data,item){return logicalView.model.handleCheckAction(data,item);},isEnabled:function isEnabled(data,item){return logicalView.model.handleEnabledAction(data,item);},columns:logicalView.columns};return returnValue;}});}());