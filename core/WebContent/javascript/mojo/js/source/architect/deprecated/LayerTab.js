(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.architect.ui.LayerLabel","mstrmojo.array","mstrmojo.css","mstrmojo.dom");var $A=mstrmojo.array,$CSS=mstrmojo.css,$DOM=mstrmojo.dom,$WIDGET=mstrmojo.Widget,MIN_SCROLL_VALUE=0,BUFFER=30;function constrainValue(value){return Math.max(Math.min(value,MIN_SCROLL_VALUE),Math.min(parseInt(this.width,10)-this.itemsContainerNode.offsetWidth-BUFFER,0));}function addLabels(render){var items=this.items=this.items||[];$A.forEach(items,function(item,index){this.addChildren({scriptClass:"mstrmojo.architect.ui.LayerLabel",slot:"itemsContainerNode",text:item.n,layerId:item.did,index:index});},this);if(render){this.renderChildren();}}mstrmojo.architect.ui.LayerTab=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.architect.ui.LayerTab",markupString:'<div id="{@id}" class="mstrmojo-ar-LayerTab" mstrAttach:click,mousedown,mouseup><div class="mstrmojo-ar-lt-icn"></div><div class="mstrmojo-ar-lt-btn left"></div><div class="mstrmojo-ar-lt-btn right"></div><div class="mstrmojo-clearingDiv"></div></div>',markupSlots:{containerNode:function containerNode(){return this.domNode;},itemsContainerNode:function itemsContainerNode(){return this.domNode.firstChild;},scrollLeftNode:function scrollLeftNode(){return this.domNode.children[1];},scrollRightNode:function scrollRightNode(){return this.domNode.children[2];}},markupMethods:{onvisibleChange:$WIDGET.visibleMarkupMethod,onheightChange:$WIDGET.heightMarkupMethod,onwidthChange:$WIDGET.widthMarkupMethod},items:undefined,closeLayer:function closeLayer(layerId){this.parent.onLayerClosed(layerId);},preBuildRendering:function preBuildRendering(){this._super();addLabels.call(this);},onclick:function onclick(evt){var targetWidget=evt.labelWidget;if(targetWidget){var targetIndex=targetWidget.index,currentSelectedIndex=this.selectedIndex;if(targetIndex!==currentSelectedIndex&&currentSelectedIndex!==-1){this.children[currentSelectedIndex].set("selected",false);this.set("selected",this.items[targetIndex].did);}}},onTabRenamed:function onTabRenamed(layerId,layerName){var layerItems=this.items,layerData=layerItems[$A.find(layerItems,"did",layerId)];layerData.n=layerName;this.parent.onLayerRenamed(layerId,layerName);},onmousedown:function onmousedown(evt){if(!this._holdTimer){var $this=this,target=evt.target||$DOM.eventTarget(evt.hWin,evt.e),itemsContainerNode=this.itemsContainerNode,icnStyle=itemsContainerNode.style,initialLeft=itemsContainerNode.offsetLeft,isScrollLeftNode=this.scrollLeftNode===target,isScrollRightNode=this.scrollRightNode===target;if(isScrollLeftNode||isScrollRightNode){this._target=target;$CSS.addClass(target,"hold");this._holdTimer=setInterval(function(){icnStyle.left=constrainValue.call($this,isScrollLeftNode?++initialLeft:--initialLeft)+"px";},1);}}},onmouseup:function onmouseup(){if(this._holdTimer){$CSS.removeClass(this._target,"hold");clearInterval(this._holdTimer);delete this._holdTimer;}},_set_items:function _set_items(propName,propValue){this.removeChildren();this.items=propValue;addLabels.call(this,true);this.scrollLeftNode.style.display=this.scrollRightNode.style.display=((parseInt(this.width,10)-this.itemsContainerNode.offsetWidth)>0)?"none":"";return true;},_set_selected:function _set_selected(propName,propValue){var valueWas=this.selected;this.selected=propValue;if(propValue!==null){var index=this.selectedIndex=$A.find(this.items,"did",propValue);if(index>=0){var itemsContainerNode=this.itemsContainerNode,icnLeft=itemsContainerNode.offsetLeft,selectedChild=this.children[index],selectedLabelDom=selectedChild.domNode,selectedLabelLeft=selectedLabelDom.offsetLeft,selectedLabelWidth=selectedLabelDom.offsetWidth,width=parseInt(this.width,10),overflowStart=selectedLabelLeft<-icnLeft,overflowEnd=(selectedLabelLeft+selectedLabelWidth)>(width-icnLeft),labelPosition=icnLeft;if(overflowEnd){labelPosition=-(selectedLabelLeft+selectedLabelWidth-parseInt(this.width,10)+BUFFER);}else{if(overflowStart){labelPosition=-selectedLabelLeft+BUFFER;}}selectedChild.set("selected",true);itemsContainerNode.style.left=constrainValue.call(this,labelPosition)+"px";}}return valueWas!==propValue;}});}());