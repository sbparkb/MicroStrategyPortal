(function(){mstrmojo.requiresCls("mstrmojo._FillsBrowser","mstrmojo.dom","mstrmojo.architect.projectmanagement.ProjectManagerIcons","mstrmojo.architect.projectmanagement.ProjectManagerList");var $A=mstrmojo.array,$DOM=mstrmojo.dom,cookie="projectManagerView";function sleep(ms){var endTime=new Date(),now;endTime.setTime(endTime.getTime()+ms);do{now=new Date().getTime();}while(now<endTime.getTime());}mstrmojo.architect.projectmanagement.ProjectManager=mstrmojo.declare(mstrmojo.Box,[mstrmojo._FillsBrowser],{scriptClass:"mstrmojo.architect.projectmanagement.ProjectManager",cssClass:"mstrmojo-ProjectManager",switchView:function switchView(view){this.pmlist.set("visible",(view!==0));this.pmicon.set("visible",(view===0));var wls=window.localStorage;if(wls){wls.setItem(cookie,view);}this.refresh();},pmlist:undefined,pmicon:undefined,projects:[],children:[{scriptClass:"mstrmojo.architect.projectmanagement.ProjectManagerList",alias:"pmlist"},{scriptClass:"mstrmojo.architect.projectmanagement.ProjectManagerIcons",alias:"pmicon"}],postBuildRendering:function postBuildRendering(){this.populateProjects(0);},browserResized:function browserResized(size){var path=document.getElementById("mstrWeb_path"),tb=document.getElementById("PMToolbar"),list=this.pmlist,icon=this.pmicon;this.set("height",parseInt(size.h,10)-$DOM.position(path).h-$DOM.position(tb).h+"px");this.set("width",parseInt(size.w,10)+"px");if(list.visible){list.set("height",this.height);list.set("tbheight",$DOM.position(tb).h);list.set("width",this.width);}else{if(icon.visible){icon.set("boxh",0);icon.set("boxw",0);icon.onvisibleChange();}}return true;},populateProjects:function populateProjects(sleepamt){var $this=this;if(sleepamt>0){sleep(sleepamt);}mstrApp.getRootController().getProjects({},{success:function success(res){var pm=mstrApp.getRootController().rootView,projectinfo=[];$A.forEach(res.servers,function(server){$A.forEach(server.projects,function(project){projectinfo.push({name:project.name,projectinfo:project,serverinfo:server});});});projectinfo.sort(function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase());});pm.pmicon.set("info",projectinfo);pm.pmlist.set("info",projectinfo);$this.projects=projectinfo;}});}});}());