(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.architect.ui.editors.DataSourceEditor","mstrmojo.warehouse.EnumObjectTypes");var $A=mstrmojo.array,$ENUM_MENU_ACTIONS=mstrmojo.architect.menu.EnumMenuActions,$ENUM_OT=mstrmojo.warehouse.EnumObjectTypes,STR_NOT_IMPL=mstrmojo.desc(11398,"Functionality not yet implemented."),STR_DELETE_CONFIRM=mstrmojo.desc(6722,"Are you sure you want to delete '##'?"),STR_DELETE_CONFIRM_MULTIPLE="Are you sure you want to delete these ## objects?";var DEBUG=false;function handleQueryFn(fnName,item){var data=this.data,queryData=(data&&data.length)?data[0]:data;return(queryData&&queryData[fnName])?queryData[fnName](data,item):true;}mstrmojo.architect.menu.ArchitectMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.menu.ArchitectMenu",dynamicUpdate:true,queryEnabled:function queryEnabled(item){return handleQueryFn.call(this,"isEnabled",item)||DEBUG;},queryVisible:function queryVisible(item){return handleQueryFn.call(this,"isVisible",item)||DEBUG;},queryChecked:function queryChecked(item){return handleQueryFn.call(this,"isChecked",item)||DEBUG;},executeCommand:function(item){var $ENUM_RELATION_TYPE=mstrmojo.architect.menu.ArchitectMenu.EnumRelationType,data=this.data,rootController=mstrApp.getRootController(),parentAttributeId=data.parentAttributeId,childAttributeId=data.childAttributeId,relationTableId=data.relationTableId;switch(item.action){case $ENUM_MENU_ACTIONS.NONE:break;case $ENUM_MENU_ACTIONS.DELETE:var msg;if(data.length){msg=STR_DELETE_CONFIRM_MULTIPLE.replace("##",data.length);}else{msg=STR_DELETE_CONFIRM.replace("##",data.n);}mstrmojo.confirm(msg,{confirmBtn:{fn:function(){rootController.deleteObject(data);}}});break;case $ENUM_MENU_ACTIONS.RENAME:rootController.renameObject(data);break;case $ENUM_MENU_ACTIONS.AUTOMAP:rootController.autoMapTable([].concat(data));break;case $ENUM_MENU_ACTIONS.SAMPLE_DATA:rootController.showSampleData(data);break;case $ENUM_MENU_ACTIONS.CONVERT_ATTR_TO_FACT:rootController.convertAttributeToFact(data);break;case $ENUM_MENU_ACTIONS.CONVERT_ATTR_TO_FORM:rootController.convertAttributeToForm(data,item);break;case $ENUM_MENU_ACTIONS.LOGICAL_TABLE_SIZE:rootController.setTableLogicalSize(data);break;case $ENUM_MENU_ACTIONS.CONVERT_COLUMN_TO_FORM:rootController.convertColumnToForm(data,item);break;case $ENUM_MENU_ACTIONS.SET_AS_MULTILINGUAL:rootController.setAsMultiLingual(data);break;case $ENUM_MENU_ACTIONS.CONVERT_FACT_TO_ATTR:rootController.convertFactToAttribute(data);break;case $ENUM_MENU_ACTIONS.REMOVE_FROM_TABLE:rootController.removeFromTable(data);break;case $ENUM_MENU_ACTIONS.SET_AS_LOOKUP:rootController.setAsLookup(data);break;case $ENUM_MENU_ACTIONS.NEW_FACT:item.tp=$ENUM_OT.FACT;item.isNew=true;rootController.openExpressionEditor(data,item);break;case $ENUM_MENU_ACTIONS.NEW_ATTR:item.tp=$ENUM_OT.ATTRIBUTE;item.isNew=true;rootController.openExpressionEditor(data,item);break;case $ENUM_MENU_ACTIONS.UPDATE_FORMAT:rootController.updateFormFormat(data,item);break;case $ENUM_MENU_ACTIONS.EDIT:item.tp=data.tp;item.isNew=false;rootController.openExpressionEditor(data,item);break;case $ENUM_MENU_ACTIONS.MAPPING:rootController.updateMappingMethod(data,item);break;case $ENUM_MENU_ACTIONS.UPDATE_AGGR:rootController.updateAggregation(data,item);break;case $ENUM_MENU_ACTIONS.REMOVE_TABLE:rootController.removeFromCurrentLayer(data);break;case $ENUM_MENU_ACTIONS.ADD_ATTRIBUTE:rootController.createAttribute(data);break;case $ENUM_MENU_ACTIONS.ADD_FACT:rootController.createFact(data);break;case $ENUM_MENU_ACTIONS.DATA_SOURCES:var dataSourceEditor=mstrmojo.all[this._dseid]||new mstrmojo.architect.ui.editors.DataSourceEditor({onSubmit:function onSubmit(data){rootController.setTableDBRoles(data);}});this._dseid=dataSourceEditor.id;dataSourceEditor.open(undefined,{dataSources:rootController.getTableDBRoles(data)});break;case $ENUM_MENU_ACTIONS.REMOVE_ATTR_FROM_RELATIONSHIP:rootController.removeAttributeFromRelation(data);break;case $ENUM_MENU_ACTIONS.DELETE_RELATIONSHIP:rootController.removeRelation(parentAttributeId,childAttributeId);return ;case $ENUM_MENU_ACTIONS.ONE_TO_ONE:rootController.updateRelation(parentAttributeId,childAttributeId,$ENUM_RELATION_TYPE.ONE_TO_ONE,relationTableId);break;case $ENUM_MENU_ACTIONS.ONE_TO_MANY:rootController.updateRelation(parentAttributeId,childAttributeId,$ENUM_RELATION_TYPE.ONE_TO_MANY,relationTableId);break;case $ENUM_MENU_ACTIONS.MANY_TO_MANY:rootController.updateRelation(parentAttributeId,childAttributeId,$ENUM_RELATION_TYPE.MANY_TO_MANY,relationTableId);break;case $ENUM_MENU_ACTIONS.RELATIONSHIP_TABLE_ENTRY:rootController.updateRelation(parentAttributeId,childAttributeId,data.relationType,item.did);break;case $ENUM_MENU_ACTIONS.SHOW_UNUSED_COLUMNS:rootController.changeLayerTableColumnView([].concat(data),item);break;case $ENUM_MENU_ACTIONS.ADD_TO_LAYER:rootController.addOrRemoveTables([].concat(data),true);break;case $ENUM_MENU_ACTIONS.REMOVE_FROM_LAYER:rootController.addOrRemoveTables([].concat(data),false);break;case $ENUM_MENU_ACTIONS.UPSTRUCT:rootController.handleUpdateStructures([].concat(data));break;case $ENUM_MENU_ACTIONS.CREATE_ALIAS:rootController.createTableAlias([].concat(data));break;case $ENUM_MENU_ACTIONS.LINKS:rootController.showLinks(data);break;case $ENUM_MENU_ACTIONS.UPDATE_CATEGORY:rootController.updateFormCategory(data,item);break;case $ENUM_MENU_ACTIONS.UNGROUP_FORMS:rootController.unGroupForms(data,item);break;case $ENUM_MENU_ACTIONS.UPDATE_GROUP:rootController.groupForms([data],item);break;case $ENUM_MENU_ACTIONS.UNGROUP_FORM:rootController.unGroupForms(data,item);break;case $ENUM_MENU_ACTIONS.TX_ONE_TO_ONE:rootController.setTransformationCardinality(data.did,true);break;case $ENUM_MENU_ACTIONS.TX_MANY_TO_MANY:rootController.setTransformationCardinality(data.did,false);break;case $ENUM_MENU_ACTIONS.TX_APPLY_TO_ALL:rootController.setTransformationAllAttributes(data.did,true);break;case $ENUM_MENU_ACTIONS.TX_APPLY_TO_HIGHEST:rootController.setTransformationAllAttributes(data.did,false);break;case $ENUM_MENU_ACTIONS.SET_ENTRY_POINT:rootController.addEntryPoint(data.attributeId);break;case $ENUM_MENU_ACTIONS.REMOVE_ENTRY_POINT:rootController.removeEntryPoint(data.attributeId);break;case $ENUM_MENU_ACTIONS.ATTRIBUTE_FILTERS:rootController.editFilters(data.attributeId,undefined,undefined);break;case $ENUM_MENU_ACTIONS.ADD_JOIN_CHILDREN:rootController.addJointChildren(data,item.did);break;case $ENUM_MENU_ACTIONS.USE_AS_DRILL:rootController.updateHiearchySubtype(true);break;case $ENUM_MENU_ACTIONS.USE_AS_BROWSE:rootController.updateHiearchySubtype(false);break;default:mstrmojo.alert(STR_NOT_IMPL);break;}},getMenuConfig:function getMenuConfig(menuItems){var menuCfg=new mstrmojo.ui.menus.MenuConfig(),id=this.id,lastIsSeparator=false,isSeparator,allAvailableMenuItems=menuItems||this.cm;$A.forEach(allAvailableMenuItems,function(menuItem){isSeparator=menuItem.action===$ENUM_MENU_ACTIONS.NONE;if(this.queryVisible(menuItem)){var cssClasses=["xt "+(menuItem.icn||"")],execFn=function execFn(){this.executeCommand(menuItem);};if((this.queryEnabled(menuItem)===false)||isSeparator){if((isSeparator&&!lastIsSeparator)||!isSeparator){cssClasses.push(isSeparator?"sep":"");menuCfg.addDisabledMenuItem(menuItem.n,cssClasses.join(" "));}if(isSeparator){lastIsSeparator=true;}}else{if(menuItem.items){menuCfg.addSubMenuItem(menuItem.n,"",id,menuItem.buildSubMenuConfig||this.getMenuConfig,menuItem.items);lastIsSeparator=false;}else{if(menuItem.hasEdt){menuCfg.addEditorMenuItem(menuItem.n,id,menuItem.buildSubMenuConfig);lastIsSeparator=false;}else{menuCfg.addToggleMenuItem(menuItem.n||"",cssClasses.join(" "),execFn,execFn,id,this.queryChecked(menuItem));lastIsSeparator=false;}}}}},this);return menuCfg;}});mstrmojo.architect.menu.ArchitectMenu.EnumRelationType={ONE_TO_ONE:1,ONE_TO_MANY:2,MANY_TO_MANY:4,PARENT_CHILD:0};}());