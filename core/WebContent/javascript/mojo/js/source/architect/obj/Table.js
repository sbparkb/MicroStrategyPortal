(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.obj.Attribute","mstrmojo.architect.obj.AttrInfo","mstrmojo.architect.obj.Column","mstrmojo.architect.obj.Fact","mstrmojo.architect.obj.FactInfo","mstrmojo.architect.obj.Form","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.architect.EnumDataChangeEvents","mstrmojo.warehouse.obj.TableData");var Enum_SM_CreateObject=1,Enum_SM_DeleteObject=2,Enum_SM_RenameObject=3,Enum_SM_AutoRecognizeTable=10,Enum_SM_SetAsLookup=11,Enum_SM_EditDBRoles=19,Enum_SM_AddTableDBRole=1020,Enum_SM_AutoRecognizeColumn=28,Enum_SM_EditLogicalView=29,Enum_SM_UpdateTableStructure=30,Enum_SM_SetTableLogicalSize=36,$ENUM_OT=mstrmojo.warehouse.EnumObjectTypes,ENUM_OT_ATTRIBUTE=$ENUM_OT.ATTRIBUTE,ENUM_OT_FACT=$ENUM_OT.FACT,ENUM_OT_TABLE=parseInt($ENUM_OT.TABLE,10),ENUM_OT_LOGICALVIEW=$ENUM_OT.TABLE_LOGICAL_VIEW,ENUM_OT_PARTITION=$ENUM_OT.TABLE_PARTITION,ENUM_OT_COLUMN=$ENUM_OT.COLUMN,ENUM_OT_FORM=$ENUM_OT.FORM,ENUM_OT_COMPOUND_FORM=$ENUM_OT.COMPOUND_FORM,STR_DEFAULT_LOGICALVIEW_NAME=mstrmojo.desc(12247,"New logical view"),Enum_TD_Columns_All=0,Enum_TD_Columns_None=1,Enum_TD_Columns_Unused=2,ENUM_STATUS_COMPLETE=1,ENUM_STATUS_MULTISOURCE=2,ENUM_STATUS_ERROR=3,STR_TABLE_EXISTS=mstrmojo.desc(11438,"This table is already part of the project, please add a different table"),STR_TABLE_EXISTS_MULTI=mstrmojo.desc(11439,"This table already exists in the project. Do you want to create multiple source table?"),STR_LOOKUP=mstrmojo.desc(11440,"(lookup)"),$ENUM_DATA_CHANGE_EVENTS=mstrmojo.architect.EnumDataChangeEvents,$M=mstrmojo,$WRAP=$M.func.wrapMethods,$H=$M.hash,$A=$M.array;function decodeIconType(table){if(table.isView){return ENUM_OT_LOGICALVIEW;}if(table.isPartition){return ENUM_OT_PARTITION;}return ENUM_OT_TABLE;}function isInSecondaryDBRoles(table,dbroleId){return table.secondaryDBRoles[dbroleId];}function decodeDBRoleID(){var dbRoleID=this.primaryDBRole;return(dbRoleID==="00000000000000000000000000000000")?this.model.projPrimaryDBRoleID:dbRoleID;}function prepareColumn(colInfo){var column=new mstrmojo.architect.obj.Column({tableInfo:colInfo});mstrApp.rootController.getColumns()[column.cmid]=column;return column;}function prepareColumns(columns){var cols=[];$A.forEach(columns,function(column){cols.push(prepareColumn(column));});return cols;}function renameTable(table,newName,callback){table.model.submitRequest({success:function(){table.name=newName;if(callback&&callback.success){callback.success();}}},{objectid:table.id,objecttype:ENUM_OT_TABLE,manipulationtype:Enum_SM_RenameObject,objectname:newName},"schemaManipulation");}function createSITable(name,tblDef,callback){var table=this,model=table.model,selDBRoleId=table.model.SelDBRoleID;model.submitRequest({success:function(res){var objects=res.mi["in"].oi,newItems={26:[],15:[]},columns,tbl;objects=objects.length?objects:[objects];$A.forEach(objects,function(item){if(newItems[item.tp]){newItems[item.tp].push(item);}});if(res.mi.rto){columns=res.mi.rto.oi;columns=columns.length?columns:[columns];$A.forEach(columns,function(item){if(newItems[item.tp]){newItems[item.tp].push(item);}});}tbl=newItems[ENUM_OT_TABLE][0];table.id=tbl.did;table.name=tbl.n;table.primaryDBRole=selDBRoleId;table.columns=prepareColumns(newItems[ENUM_OT_COLUMN]);table.attributeInfos={};table.factInfos={};table.secondaryDBRoles=[];table.relations=[];table.nameSpace=tblDef.ns;table.dbtid=tbl.def.dbt.did;table.dbtn=tbl.n;this.isPopulated=false;model.addTableStatus(table.id,ENUM_STATUS_COMPLETE,"","",null);if(callback&&callback.success){callback.success(table);}},failure:function(res){if(res.getResponseHeader("X-MSTR-TaskErrorCode")==="-2147080975"){model.addTableStatus(name,ENUM_STATUS_ERROR,res.getResponseHeader("X-MSTR-TaskFailureMsg"),"",null);model.checkTableStatus();}else{var newTable=table.model.getTableByName(name);if(newTable){if((newTable.primaryDBRole===selDBRoleId)||(isInSecondaryDBRoles(newTable,selDBRoleId))||((newTable.primaryDBRole==="00000000000000000000000000000000")&&selDBRoleId===table.model.projPrimaryDBRoleID)){model.addTableStatus(name,ENUM_STATUS_ERROR,STR_TABLE_EXISTS,"",null);model.checkTableStatus();}else{model.addTableStatus(newTable.id,ENUM_STATUS_MULTISOURCE,STR_TABLE_EXISTS_MULTI,selDBRoleId,callback);model.checkTableStatus();}}else{model.addTableStatus(name,ENUM_STATUS_ERROR,res.getResponseHeader("X-MSTR-TaskFailureMsg"),"",null);model.checkTableStatus();}}}},{manipulationtype:Enum_SM_CreateObject,objecttype:ENUM_OT_TABLE,objectname:name,dbrid:selDBRoleId,objectdef:JSON.stringify(tblDef.columns),ns:tblDef.ns,sta:tblDef.sta,showWait:true},"schemaManipulation");}function createLogicalView(callback){var table=this,name=this.name;if((this.isNew)&&(this.name==="")){name=mstrApp.rootController.findNextName(STR_DEFAULT_LOGICALVIEW_NAME,$H.valarray(this.model.logicalViews),"name");}table.model.submitRequest({success:function(res){var objects=res.mi["in"].oi,newItems={15:[]};objects=objects.length?objects:[objects];$A.forEach(objects,function(item){if(newItems[item.tp]){newItems[item.tp].push(item);}});var tbl=newItems[ENUM_OT_TABLE][0];table.id=tbl.did;table.name=tbl.n;table.primaryDBRole=table.model.projPrimaryDBRoleID;table.columns=[];table.attributeInfos={};table.factInfos={};table.secondaryDBRoles=[];table.relations=[];table.nameSpace="";table.dbtid="";table.dbtn="";this.isPopulated=false;table.model.addTableStatus(table.id,ENUM_STATUS_COMPLETE,"","",null);if(callback&&callback.success){callback.success(table);}}},{manipulationtype:Enum_SM_CreateObject,objecttype:ENUM_OT_TABLE,objectname:name,objectdef:JSON.stringify([]),info:"Select",showWait:true},"schemaManipulation");}mstrmojo.architect.obj.Table=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Table",init:function init(props){this._super(props);this.isView=(props.type===3);this.isPartition=(props.subtype===3842);var callback=props.callback;if(props.isNew){if(!this.isView){createSITable.call(this,props.name,props.tblDef,callback);}else{createLogicalView.call(this,callback);}}else{this.reset();if(callback&&callback.success){callback.success(this);}}},reset:function reset(){this.secondaryDBRoles=[];this.columns=[];this.relations=[];this.attributeInfos={};this.factInfos={};this.isPopulated=false;this.isNew=false;},id:undefined,name:undefined,dbtid:undefined,dbtn:"",primaryDBRole:undefined,columns:undefined,secondaryDBRoles:undefined,isPopulated:false,columnDisplay:Enum_TD_Columns_None,nameSpace:undefined,isError:false,errorMsg:"",sta:0,size:10,sizeLocked:false,isView:false,isPartition:false,SQLStatement:"",type:"",ID:undefined,catID:undefined,formName:undefined,rto:undefined,tablecols:undefined,AttInfos:undefined,Attributes:undefined,Facts:undefined,bfi:undefined,tar:undefined,updateStructure:function updateStructure(tblDef,callback){var table=this,model=table.model,column;table.sta=tblDef.sta;model.submitRequest({success:function success(res){table.isError=false;$A.forEach(res.cols,function(col){column=new mstrmojo.architect.obj.Column({tableInfo:col});model.columns[column.cmid]=column;});var tableCols=[];$A.forEach(res.tablecols,function(col){tableCols.push(model.columns[col.cmid]);});if(tableCols.length>0){table.columns=tableCols;callback.success();}},failure:function failure(res){table.isError=true;table.errorMsg=res.getResponseHeader("X-MSTR-TaskFailureMsg");},complete:function complete(){table.model.raiseEvent({name:$ENUM_DATA_CHANGE_EVENTS.TABLES_CHANGED,item:table.getTableData()});model.raiseEvent({name:$ENUM_DATA_CHANGE_EVENTS.LAYER_TABLE_CHANGED,item:table.getTableData(true)});}},{manipulationtype:Enum_SM_UpdateTableStructure,objectname:table.name,objectid:table.dbtid,dbrid:table.primaryDBRole,objectdef:JSON.stringify(tblDef),showWait:true},"schemaManipulation");},rename:function rename(newName,callback){if(mstrApp.getRootController().validateName(ENUM_OT_TABLE,newName,this.name)){renameTable(this,newName,callback);}else{if(callback.failure){callback.failure();}}},setLogicalSize:function setLogicalSize(size,lock,callback){var table=this;table.size=size;table.sizeLocked=lock;table.model.submitRequest({success:function(){if(callback&&callback.success){callback.success();}}},{manipulationtype:Enum_SM_SetTableLogicalSize,tableids:table.id,sz:size},"schemaManipulation");},remove:function remove(callback){var table=this,tableId=this.id,model=table.model,attribute,fact;table.model.submitRequest({success:function(){$H.forEach(table.attributeInfos,function(attributeInfo){attribute=model.getAttribute(attributeInfo.attributeId);delete attribute.tables[tableId];});$H.forEach(table.factInfos,function(factInfo){fact=model.getAttribute(factInfo.factId);delete fact.tables[tableId];});if(callback&&callback.success){callback.success(table.id);}}},{manipulationtype:Enum_SM_DeleteObject,objecttype:ENUM_OT_TABLE,objectid:table.id},"schemaManipulation");},autoRecognize:function autoRecognize(callback){var table=this,model=table.model;table.model.submitRequest({failure:function(res){if(res.getResponseHeader("X-MSTR-TaskErrorCode")!==null){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));}else{table.isPopulated=true;if(callback&&callback.success){callback.success(table);}}},success:function(res){var attributes=res.Attributes,facts=res.Facts,attributeInfos=res.AttInfos,factInfos=res.FactInfos,attributeId,factId,attribute,fact;$H.forEach(attributes,function(attr){attributeId=attr.did;attribute=model.attributes[attributeId];if(!attribute){attribute=new mstrmojo.architect.obj.Attribute({isNew:false,id:attributeId,name:attr.n,arity:1,model:model});model.attributes[attributeId]=attribute;attribute.isNew=true;}attribute.tables[table.id]=table;$H.forEach(attr.Forms,function(form){var attForm=attribute.forms[form.bfi],column=form.tar,lookup=form.lk,cln=model.columns[column].cln,expression=model.createExpression(column),category=model.getCategoryAtIndex(parseInt(form.bfi,10)),categoryId=category?category.id:column,useName=category?category.useName:cln,useDescription=category?category.useDescription:cln,objectName=category?category.objectName:cln;if(!attForm){attribute.addForm(false,categoryId+attributeId,form.bfi,categoryId,lookup,column,expression,"3","3",true,3,useName,useDescription,true,true,objectName);}else{if(lookup){attForm.tableId=lookup;attForm.columnId=column;attForm.expression=expression;}}});});$H.forEach(attributeInfos,function(attInfo){var attInfoId=attInfo.did;$H.forEach(attInfo.Forms,function(baseForm){if(baseForm.tar){var attExpression=baseForm.tar,expression=model.createExpression(attExpression);table.addAttributeInfo(false,baseForm.bfi,attInfoId,expression,attExpression,null);}});});$H.forEach(facts,function(fct){factId=fct.did;fact=model.facts[factId];if(!fact){fact=new mstrmojo.architect.obj.Fact({isNew:false,id:factId,name:fct.n,model:model});model.facts[factId]=fact;fact.isNew=true;}fact.tables[table.id]=table;});$H.forEach(factInfos,function(factInfo){var factInfoId=factInfo.did,factExpression=factInfo.exp;if(factInfoId!==""){table.addFactInfo(false,factInfoId,model.createExpression(factExpression),factExpression,null);}});table.isPopulated=true;if(callback&&callback.success){callback.success(table);}}},{manipulationtype:Enum_SM_AutoRecognizeTable,tableids:table.id,info:JSON.stringify(table.columns)},"schemaManipulation");},automapColumn:function automapColumn(columnid,callback){var table=this,model=table.model,objects,expression,did,attr,fct,fact,attribute,tableid=table.id,categoryId=model.basicForms.ID.id,category=model.getCategoryAtIndex(0),newitems={26:[],15:[],12:[],13:[]},cbAutoCol={success:function(res){objects=res.mi["in"].oi;$A.forEach(objects,function(item){if(newitems[item.tp]){newitems[item.tp].push(item);}});attr=newitems[ENUM_OT_ATTRIBUTE][0];fct=newitems[ENUM_OT_FACT][0];expression=model.createExpression(columnid);if(fct){did=fct.did;fact=model.facts[did];if(!fact){fact=new mstrmojo.architect.obj.Fact({isNew:false,id:did,name:fct.n,model:model});model.facts[did]=fact;fact.isNew=true;}fact.tables[tableid]=table;table.addFactInfo(false,did,expression,columnid,null);}else{if(attr){did=attr.did;attribute=model.getAttribute(did);if(!attribute){attribute=new mstrmojo.architect.obj.Attribute({isNew:false,id:did,name:attr.n,arity:1,model:model});model.attributes[did]=attribute;attribute.isNew=true;}attribute.tables[tableid]=table;attribute.addForm(false,categoryId+did,0,categoryId,tableid,columnid,expression,"3","3",true,3,category.objectName,category.useDescription,true,true,category.useDescription);table.addAttributeInfo(false,"0",did,expression,columnid,null);}}if(callback&&callback.success){callback.success();}}};table.model.submitRequest(cbAutoCol,{columnid:columnid,manipulationtype:Enum_SM_AutoRecognizeColumn,tableids:table.id,showWait:false},"schemaManipulation");},getTableData:function getTableData(useLocalSetting){var table=this,model=table.model,tableName=table.name,tableData=new mstrmojo.warehouse.obj.TableData({id:table.id,n:tableName,tp:ENUM_OT_TABLE,model:model,multi:(table.secondaryDBRoles.length>0),bold:model.tableIsInLayer(table.id),dbrole:table.primaryDBRole,isError:table.isError,ttp:table.isError?mstrApp.getRootController().cleanError(table.errorMsg):"",sta:table.sta,ns:table.nameSpace,dbtn:table.dbtn,isLocked:table.sizeLocked,size:table.size,isView:table.isView,icntp:decodeIconType(table)}),attribute,baseFormId,attributeId,factId,form,fact,formName,allExpressions=[],exp,colDisplay=Enum_TD_Columns_All,expCols=[],item,subItem,groupID,usedForms={};useLocalSetting=useLocalSetting||false;if(useLocalSetting){colDisplay=table.columnDisplay;}$H.forEach(table.attributeInfos,function(attributeInfo){attributeId=attributeInfo.attributeId;attribute=model.getAttribute(attributeId);usedForms={};item=tableData.addItem(attributeId,attribute.name,ENUM_OT_ATTRIBUTE,"0","",false,false,false);$A.forEach(attribute.formGroups,function(group){groupID=group.catID;subItem=tableData.addSubItem(attributeId,attributeId+groupID,group.formName,ENUM_OT_COMPOUND_FORM,"0",groupID,"",false,false);$A.forEach(group.fms,function(groupForm){usedForms[groupForm.did]=groupForm.did;$H.forEach(attributeInfo.baseForms,function(baseForm){baseFormId=baseForm.baseFormId;form=attribute.forms[baseFormId];if(groupForm.did===form.categoryId){exp=baseForm.expression;formName=(form.tableId===table.id)?form.useName+" "+STR_LOOKUP+" ":form.useName;allExpressions.push(baseForm.expression);tableData.addSubItemItem(attributeId,subItem.did,subItem.did+baseFormId,formName,ENUM_OT_FORM,baseFormId,form.categoryId,exp+": "+model.columns[baseForm.columnId].getDataTypeName(),true,false);return false;}return true;});});});$H.forEach(attributeInfo.baseForms,function(baseForm){baseFormId=baseForm.baseFormId;form=attribute.forms[baseFormId];if(!(usedForms[form.categoryId])){exp=baseForm.expression;formName=(form.tableId===table.id)?form.useName+" "+STR_LOOKUP+" ":form.useName;allExpressions.push(baseForm.expression);subItem=tableData.addSubItem(attributeId,attributeId+baseFormId,formName,ENUM_OT_FORM,baseFormId,form.categoryId,exp+": "+model.columns[baseForm.columnId].getDataTypeName(),true,false);}});});$H.forEach(table.factInfos,function(factInfo){factId=factInfo.factId;fact=model.getFact(factId);tableData.addItem(factId,fact.name,ENUM_OT_FACT,"",factInfo.expression+": "+model.columns[factInfo.columnId].getDataTypeName(),true,false,false);allExpressions.push(factInfo.expression);});$H.forEach(allExpressions,function(expression){expCols=expCols.concat(table.model.getAllColumnsForExpression(expression));});if(colDisplay!==Enum_TD_Columns_None){$H.forEach(table.columns,function(column){if(column){if($A.find(expCols,"cmid",column.cmid)<0){tableData.addItem(column.cmid,column.cln,column.tp,"",column.getDataTypeName(),true,false,true);}else{if(colDisplay===Enum_TD_Columns_All){tableData.addItem(column.cmid,column.cln,column.tp,"",column.getDataTypeName(),true,false,false);}}}});}tableData.sortElements();return tableData;},addFactInfo:function addFactInfo(isNew,factId,expression,columnId,callbackFn){var table=this,fact=table.model.facts[factId],tableId=table.id,cb2={callbackFn:callbackFn,success:function(res){table.factInfos[res.factId]=res;table.isPopulated=true;fact.tables[tableId]=table;if(this.callbackFn&&this.callbackFn.success){this.callbackFn.success();}}};mstrmojo.insert(new mstrmojo.architect.obj.FactInfo({isNew:isNew,factId:factId,factName:fact.name,expression:expression,columnId:columnId,tableId:tableId,callback:cb2,model:table.model}));},removeFactInfo:function removeFactInfo(removeFromSI,factId,callbackFn){var table=this,fact=table.model.facts[factId],tableId=table.id,factInfo=table.factInfos[factId],cbFactInfo={callbackFn:callbackFn,success:function(){delete table.factInfos[factId];delete fact.tables[tableId];if(callbackFn&&callbackFn.success){callbackFn.success();}}};if(removeFromSI){factInfo.remove(cbFactInfo);}else{cbFactInfo.success();}},updateFactInfo:function updateFactInfo(factId,expression,columnId,callbackFn){var table=this,factInfo=table.factInfos[factId];factInfo.update(expression,columnId,callbackFn);},setAsLookup:function setAsLookup(attributeId,baseFormId,callback){var table=this,attribute=table.model.getAttribute(attributeId);table.model.submitRequest({success:function(){attribute.forms[baseFormId].tableId=table.id;if(callback&&callback.success){callback.success();}}},{manipulationtype:Enum_SM_SetAsLookup,objectid:attributeId,baseformid:baseFormId,tableids:table.id,showWait:false},"schemaManipulation");},addAttributeInfo:function addAttributeInfo(isNew,baseFormId,attributeId,expression,columnId,callbackFn){var table=this,attributeInfo,attribute=table.model.attributes[attributeId],tableId=table.id,cbAttrInf={callbackFn:callbackFn,success:function(res){attribute.tables[tableId]=table;table.isPopulated=true;table.attributeInfos[res.attributeId]=res;if(isNew){mstrApp.getRootController().invalidateRelations(true);}if(this.callbackFn&&this.callbackFn.success){this.callbackFn.success();}}};if(table.attributeInfos[attributeId]){attributeInfo=table.attributeInfos[attributeId];attributeInfo.addBaseForm(isNew,baseFormId,columnId,expression,callbackFn);}else{mstrmojo.insert(new mstrmojo.architect.obj.AttrInfo({isNew:isNew,baseFormId:baseFormId,attributeId:attributeId,attributeName:attribute.name,expression:expression,columnId:columnId,tableId:tableId,model:table.model,callback:cbAttrInf}));}},removeAttributeInfo:function removeAttributeInfo(removeFromSI,baseFormId,attributeId,callbackFn){var table=this,attributeInfo,attribute=table.model.attributes[attributeId],tableId=table.id,cbRemoveAI={callbackFn:callbackFn,success:function(){if(Object.keys(attributeInfo.baseForms).length===0){delete table.attributeInfos[attributeInfo.attributeId];}mstrApp.getRootController().invalidateRelations(true);if(callbackFn&&callbackFn.success){callbackFn.success();}}};if(table.attributeInfos[attributeId]){attributeInfo=table.attributeInfos[attributeId];if(removeFromSI){attributeInfo.remove(baseFormId,cbRemoveAI);}else{delete attributeInfo.baseForms[baseFormId];cbRemoveAI.success();}}if(baseFormId==="0"||baseFormId==="-1"){delete attribute.tables[tableId];}},updateAttributeInfo:function updateAttributeInfo(attributeId,baseFormId,expression,columnId,callbackFn){var table=this,attributeInfo=table.attributeInfos[attributeId];attributeInfo.update(baseFormId,expression,columnId,callbackFn);},addColumns:function addColumns(columns){this.columns=prepareColumns(columns);},addColumn:function addColumn(colInfo){var column=new mstrmojo.architect.obj.Column({tableInfo:colInfo});mstrApp.getRootController().getColumns()[column.cmid]=column;this.columns.push(column);},addColumnDef:function addColumnDef(columnDef){var column=new mstrmojo.architect.obj.Column({colDef:columnDef});mstrApp.getRootController().getColumns()[column.cmid]=column;this.columns.push(column);},addSecondaryDBRole:function addSecondaryDBRole(dbroleId,callback){var table=this,tableId=table.id;table.model.submitRequest({success:function(){table.secondaryDBRoles[dbroleId]=dbroleId;if(callback&&callback.success){callback.success(table);}}},{manipulationtype:Enum_SM_AddTableDBRole,tableids:tableId,dbrid:dbroleId},"schemaManipulation");},editDBRoles:function editDBRoles(primaryDBRoleId,secondaryDBRoleIds,callback){var table=this,model=table.model,tableId=table.id;model.submitRequest({success:function(){var dbRoleTables=model.dbRoleTables;if(table.primaryDBRole!=="00000000000000000000000000000000"){delete dbRoleTables[table.primaryDBRole][table.id];}$A.forEach(table.secondaryDBRoles,function(tableSecondaryDBRole){if(dbRoleTables[tableSecondaryDBRole]){if(dbRoleTables[tableSecondaryDBRole][table.id]){delete dbRoleTables[tableSecondaryDBRole][table.id];}}});if(table.primaryDBRole!=="00000000000000000000000000000000"){table.primaryDBRole=primaryDBRoleId;dbRoleTables[primaryDBRoleId][table.id]=table;}table.secondaryDBRoles=secondaryDBRoleIds;$A.forEach(secondaryDBRoleIds,function(secondaryDBRoleId){if(!dbRoleTables[secondaryDBRoleId]){dbRoleTables[secondaryDBRoleId]={};}dbRoleTables[secondaryDBRoleId][table.id]=table;});if(callback&&callback.success){callback.success(table);}}},{manipulationtype:Enum_SM_EditDBRoles,tableids:tableId,dbrid:primaryDBRoleId,dbrids:secondaryDBRoleIds},"schemaManipulation");},clone:function clone(id,name){return new mstrmojo.architect.obj.Table({model:this.model,isNew:false,id:id,name:name,primaryDBRole:this.primaryDBRole,dbtn:this.dbtn,dbtid:this.dbtid,nameSpace:this.nameSpace,type:this.type,SQLStatement:this.SQLStatement});},getSampleData:function getSampleData(callback){if(this.isView){this.getSQLData(true,callback);}else{var ns=this.nameSpace,nsp=ns+".",n=this.dbtn,did=this.id;if(n.indexOf(nsp)===0){n=n.substring(nsp.length);}if(did.indexOf(nsp)===0){did=did.substring(nsp.length);}mstrApp.rootController.getDataService().catalogAction(callback,{dbrid:decodeDBRoleID.call(this),dbts:JSON.stringify([{tbn:n,tbid:did,ns:ns}]),flags:16+32,rowlimit:25});}},getSQLData:function getSQLData(addColumnNames,callback){var table=this;if(table.isView){if(table.SQLStatement.replace(/[ \n\r\t]/g,"")!==""){mstrApp.rootController.getDataService().catalogAction($WRAP({success:function success(res){if(addColumnNames){$A.forEach(res.cols,function(col){col.data.unshift({v:col.def.cln});});res.dbt={sz:-1};}},failure:function failure(res){mstrmojo.alert(mstrApp.getRootController().cleanError(res.getResponseHeader("X-MSTR-TaskFailureMsg")));}},callback),{dbrid:decodeDBRoleID.call(table),info:table.SQLStatement,flags:10001});}else{callback.success({cols:[]});}}},updateViewDefinition:function updateViewDefinition(callback){var table=this;if(table.isView){table.model.submitRequest($WRAP({success:function success(res){$A.forEach(table.columns,function(column){if(column.cmid===""){var idx=$A.find(res.cols,"cln",column.cln);if(idx>=0){column.cmid=res.cols[idx].cmid;}mstrApp.getRootController().getColumns()[column.cmid]=column;}});}},callback),{objectid:table.id,objectdef:JSON.stringify({columns:table.columns}),info:this.SQLStatement,manipulationtype:Enum_SM_EditLogicalView},"schemaManipulation");}},EnumColumnDisplay:{AllColumns:Enum_TD_Columns_All,None:Enum_TD_Columns_None,Unused:Enum_TD_Columns_Unused}});}());