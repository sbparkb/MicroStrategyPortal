(function(){var ROW_AXIS=1;var COL_AXIS=2;var CP_ROW_HEADERS=4;var CP_VALUES=8;function _moreData(gd,isDoc){var rw=gd.rw;if(!rw){return false;}return isDoc?(rw.row.bb+rw.row.bc<rw.row.tc):(rw.wsr+rw.wmr<rw.tr);}mstrmojo._XtabSeamlessIncrementalFetch=mstrmojo.provide("mstrmojo._XtabSeamlessIncrementalFetch",{_mixinName:"mstrmojo._XtabSeamlessIncrementalFetch",useSeamlessIncFetch:true,preBuildRendering:function preBuildRendering(){var rtn=this._super();if(this.useSeamlessIncFetch){this.currentPageNum=0;this.currentPageNum=this.loadingPageNum=0;this.endFetching=!_moreData(this.gridData,this.isDocXtab);}return rtn;},aggregateCP:function aggregateCP(cp,rc,zone){var scp=(rc===CP_ROW_HEADERS)?this.rhsCP:this.valuesCP;if(scp.scriptClass!=="mstrmojo.XtabVACP"){scp=mstrmojo.hash.clone(scp);var tcp=new mstrmojo.XtabVACP();tcp.cps=[scp,cp];mstrmojo.hash.copy(tcp,(rc===CP_ROW_HEADERS)?this.rhsCP:this.valuesCP);}else{scp.cps.push(cp);}if(zone){zone.cp.initContent();}},onScrolledToLastRow:function onScrolledToLastRow(){if(this.useSeamlessIncFetch){var cp=this.currentPageNum,lp=this.loadingPageNum;if(lp<=cp&&!this.endFetching){this.loadingPageNum=cp+1;this.download(1+cp);}}},download:function download(blockNum){var rw=this.gridData.rw,rwRow=rw.row,rwCol=rw.col,maxRows=rwRow.bc;this._isDownloading=this.rhsCP.isDownloading=this.valuesCP.isDownloading=true;if(maxRows){var memo={blockNum:blockNum};this.controller.onDownloadGridData(this,this.model.getDownloadAction(blockNum*maxRows+1,maxRows,rwCol.bb,rwCol.bc,this.id,memo));}},dataDownloaded:function dataDownloaded(node,memo){if(this._isDecelerating){this._cachedDownload={node:node,memo:memo};return ;}var cachedDownload=this._cachedDownload;if(cachedDownload){if(node){alert("Missed download");}node=cachedDownload.node;memo=cachedDownload.memo;delete this._cachedDownload;}var gd=node.data,z=this.zones;this._firstRowHeight=this._firstRowHeight||this.contentNode.rows[0].offsetHeight;var rhsCP=this.initCP(gd,this.interactiveCellsArray,CP_ROW_HEADERS,gd.ghs.rhs,gd.gts.row,ROW_AXIS),valuesCP=this.initCP(gd,this.interactiveCellsArray,CP_VALUES,gd.gvs);this.aggregateCP(rhsCP,CP_ROW_HEADERS,z._BL);this.aggregateCP(valuesCP,CP_VALUES,z._BR);var start=rhsCP.startIndexInContainer,end=start+rhsCP.rc-1;var appGrid=function(zone){if(zone){zone.start=start;zone.end=end;zone.renderGrid(true);}};var id=this.id;window.setTimeout(function(){var w=mstrmojo.all[id];appGrid(z._BL);appGrid(z._BR);if(!_moreData(gd,w.isDocXtab)){w.endFetching=true;}w.setOffsets();w.currentPageNum++;w._isDownloading=false;},0);}});}());