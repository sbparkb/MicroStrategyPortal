(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.DocTextfield");var $DOM=mstrmojo.dom,$CSS=mstrmojo.css,DPST_CAPTION_ONLY=1,DPST_ICON_ONLY=2,DPST_ICON_LEFT=3,DPST_ICON_RIGHT=4,DPST_ICON_TOP=5,DPST_CUSTOM=6,FE_GLOSSY=1,dpstCssClass=["","CaptionOnly","IconOnly","IconLeft","IconRight","IconTop","Custom"];var btnCfg=[];btnCfg[DPST_CAPTION_ONLY]=btnCfg[DPST_ICON_ONLY]=btnCfg[DPST_CUSTOM]={minsp:0,mincs:0};btnCfg[DPST_ICON_LEFT]=btnCfg[DPST_ICON_RIGHT]={minsp:10,mincs:5};btnCfg[DPST_ICON_TOP]={minsp:4,mincs:5};function centerAlign(e,isH,isV,innerBox,cutoff){var pos=$DOM.position(e),ppos=$DOM.position(e.parentElement),es=e.style;innerBox=innerBox||{};innerBox={t:innerBox.t||0,r:innerBox.r||0,b:innerBox.b||0,l:innerBox.l||0};innerBox.h=ppos.h-innerBox.t-innerBox.b;innerBox.w=ppos.w-innerBox.l-innerBox.r;if(cutoff){if(pos.h>innerBox.h){es.height=innerBox.h+"px";}if(pos.w>innerBox.w){es.width=innerBox.w+"px";}pos=$DOM.position(e);}if(isH){es.top=((innerBox.h-pos.h)/2+innerBox.t)+"px";}if(isV){es.left=((innerBox.w-pos.w)/2+innerBox.l)+"px";}}function appendAndCentralizeImg(e,src,className){var img=document.createElement("img"),imgsty=img.style;e.appendChild(img);$DOM.attachEvent(img,"load",function(){var disp=imgsty.display;imgsty.display="block";centerAlign(img,true,true);imgsty.display=disp;},true);img.className=className;var ds=this.model.getDataService();img.src=(ds&&ds.getDocImage&&ds.getDocImage(src))||src;}mstrmojo.DocButton=mstrmojo.declare(mstrmojo.DocTextfield,null,{scriptClass:"mstrmojo.DocButton",pressed:false,markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-DocButton {@cssClass}" title="{@tooltip}" style="{@domNodeCssText}"><div class="mstrmojo-DocButton-Container" mstrAttach:click,mousedown><div class="mstrmojo-DocButton-IconNode"></div><div class="mstrmojo-DocButton-ValueNode" style="{@valueNodeCssText}">{@v}</div></div><div class="mstrmojo-DocButton-EffectOverlay"></div>{@buttonNodeMarkup}</div>',markupSlots:{iconNode:function(){return this.domNode.firstChild.firstChild;},valueNode:function(){return this.domNode.firstChild.lastChild;},buttonContainerNode:function(){return this.domNode.firstChild;}},markupMethods:{onpressedChange:function(){var isPressed=!!this.pressed,defn=this.defn,domNode=this.domNode,fmts=this.fmts;$CSS.toggleClass(domNode,"pressed",isPressed);this.setBackgroundColor();this.valueNode.style.color=isPressed?defn.fhlc:(fmts.color||"");},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},formatHandlers:{domNode:["T","z-index","D","B","P","background-color"],valueNode:["font","fx","color","white-space","overflow"]},setBackgroundColor:function setBackgroundColor(){this.domNode.style.backgroundColor=(!!this.pressed)?this.defn.bhlc:(this.fmts["background-color"]||"");},getAnchor:function getAnchor(){return this.domNode;},getDPI:function getDPI(){return this.model.dpi;},buildRendering:function buildRendering(){this._super();var defn=this.defn,dm=this.domNode,bc=this.buttonContainerNode,ic=this.iconNode,vl=this.valueNode,dpst=parseInt((defn&&defn.dpst)||1,10),px="px";$CSS.toggleClass(dm,dpstCssClass[dpst],true);dm.onselectstart=dm.ondragstart=function(){return false;};var fmts=this.getFormats(),innerBorderWidth=parseInt($CSS.getComputedStyle(bc).borderWidth,10)*2;if(isNaN(innerBorderWidth)){innerBorderWidth=0;}var w=parseFloat(fmts.width)-innerBorderWidth,h=parseFloat(fmts.height)-innerBorderWidth,cfg=btnCfg[dpst],minsp=cfg.minsp,mincs=cfg.mincs,icsize,ics=ic.style,vls=vl.style;function setIcsize(w,h){ics.width=w+px;ics.height=h+px;}var buttonContainerNodeStyle=bc.style;buttonContainerNodeStyle.height=h+px;buttonContainerNodeStyle.width=w+px;switch(dpst){case DPST_ICON_TOP:var dpi=this.getDPI(),outerHeight=h+$CSS.getBorderWidths(fmts["border-width"],dpi).h+$CSS.getPaddings(fmts.padding,dpi).h;icsize=Math.max(0,Math.min(h-minsp-mincs,outerHeight*0.6));setIcsize(w,icsize);centerAlign(ic,false,true);centerAlign(vl,true,false,{t:icsize+minsp},true);break;case DPST_ICON_LEFT:case DPST_ICON_RIGHT:icsize=Math.max(0,Math.min(h,w-minsp-mincs));setIcsize(icsize,icsize);centerAlign(ic,true,false);vls[(dpst===DPST_ICON_LEFT)?"left":"right"]=(icsize+minsp)+px;centerAlign(vl,true,false);break;case DPST_CAPTION_ONLY:centerAlign(vl,true,false);break;case DPST_ICON_ONLY:case DPST_CUSTOM:break;}if(FE_GLOSSY===parseInt(defn.fe,10)){$CSS.addClass(dm,"gloss");}appendAndCentralizeImg.call(this,ic,defn.nmurl,"normal");appendAndCentralizeImg.call(this,ic,defn.hlurl||defn.nmurl,"hilight");var icMaskNode=document.createElement("div");$CSS.addClass(icMaskNode,"mstrmojo-DocButton-IconMaskNode");ic.appendChild(icMaskNode);}});}());