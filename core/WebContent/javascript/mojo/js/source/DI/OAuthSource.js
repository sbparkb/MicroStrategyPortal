(function(){var constants=mstrmojo.DI.DIConstants;mstrmojo.DI.OAuthSource=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.OAuthSource",type:-1,clientID:"",state:"",accessToken:"",refreshToken:"",revokeUrl:"",locale:"",reports:null,userDisplayName:null,userEmail:null,reset:function(){this.accessToken="";this.refreshToken="";this.reports=null;this.userDisplayName=null;this.instanceUrl=null;this.sourceAccountID=null;this.said=null;this.locale="";this.idUrl=null;this.signature=null;this.userEmail=null;},populate:function populate(result){if(result.id){this.idUrl=result.id;}if(result.instance_url){this.instanceUrl=result.instance_url;}if(result.signature){this.signature=result.signature;}if(result.refresh_token){this.refreshToken=result.refresh_token;}if(result.access_token){this.accessToken=result.access_token;}if(result.display_name){this.userDisplayName=result.display_name;}if(result.name){this.userDisplayName=result.name;}if(result.id){this.sourceAccountID=result.id;}if(result.uid){this.sourceAccountID=result.uid;}if(result.locale){this.locale=result.locale;}},populateReports:function populateReports(result,isRefresh){this.reports=result;var i;if(result.mi.sinf){var tokens=result.mi.sinf.stkn;if(tokens){for(i=0;i<tokens.length;i++){if(tokens[i].n=="SESSION_ID"){this.accessToken=tokens[i].v;}if(tokens[i].n=="SERVER_URL"){this.instanceUrl=tokens[i].v;}if(tokens[i].n=="REFRESH_TOKEN"){this.refreshToken=tokens[i].v;}if(tokens[i].n==="INSTANCE_URL"){this.instanceUrl=tokens[i].v;}}}this.set("userDisplayName",result.mi.sinf.un);this.set("userEmail",result.mi.sinf.ea||"");this.said=result.mi.sinf.said;this.sourceAccountID=result.mi.sinf.said;if(result.mi.sinf.said.indexOf("#said:")===0){this.said=result.mi.sinf.said.substr(6);this.sourceAccountID=result.mi.sinf.said.substr(6);}this.locale=result.mi.sinf.lcldn||"";if(result.mi.sinf.picurl){this.picurl=result.mi.sinf.picurl;}}this.raiseEvent({name:"oAuthReportsFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id,isRefresh:isRefresh});},getSourceParams:function getSourceParams(){var params={accessToken:this.accessToken,clientID:this.clientID,clientSecret:this.clientSecret||"",instanceURL:(this.instanceUrl===null||this.instanceUrl==="")?"test":this.instanceUrl,userDisplayName:this.userDisplayName,locale:this.locale===""?"en_US":this.locale};if(this.refreshToken){params.refreshToken=this.refreshToken;}params.dbRoleID=this.dbRoleID;if(this.sourceAccountID){params.sourceAccountID=this.sourceAccountID;}return params;},getSourceInfoParam:function getSourceInfoParam(getSourceAccountID){var params={dbRoleID:this.dbRoleID,locale:this.locale===""?"en_US":this.locale};if(this.userDisplayName){params.userDisplayName=this.userDisplayName;}if(getSourceAccountID&&this.sourceAccountID){params.sourceAccountID=this.sourceAccountID;}return params;},parseOAuthSourceFolder:function parseOAuthSourceFolder(res){var items=[],cItems;var fds=this.isArray(res.mi.ftree.fd)?res.mi.ftree.fd:this.makeArray(res.mi.ftree.fd);var fls=this.isArray(res.mi.ftree.fl)?res.mi.ftree.fl:this.makeArray(res.mi.ftree.fl);var fd,fl,i,j,item,cItem,fdls,fdl;for(i=0;i<fds.length;i++){fd=fds[i];item={isFolder:true};item.n=fd.n.toString();item.desc=fd.des;item.address=fd.address;item.type=0;fdls=this.isArray(fd.fl)?fd.fl:this.makeArray(fd.fl);cItems=[];for(j=0;j<fdls.length;j++){fdl=fdls[j];cItem={isFolder:false};cItem.address=fdl.address;cItem.desc=fdl.des;cItem.type=fdl.minetype;cItem.n=fdl.n.toString();cItem.folderPath=item.n;cItems.push(cItem);}if(cItems.length>0){item.cItem=cItems;}items.push(item);}for(i=0;i<fls.length;i++){fl=fls[i];item={isFolder:false};item.n=fl.n.toString();item.address=fl.address;item.type=fl.mimetype;item.desc=fl.des;if(typeof fl.FileSize==="number"){item.size=fl.FileSize;}items.push(item);}return items;},isArray:function isArray(obj){return(Object.prototype.toString.call(obj)==="[object Array]");},makeArray:function makeArray(){var array=[];var i;for(i=0;i<arguments.length;i++){if(arguments[i]!==undefined){array.push(arguments[i]);}}return array;}});}());