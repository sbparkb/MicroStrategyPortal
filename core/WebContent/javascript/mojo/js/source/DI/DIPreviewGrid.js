(function(){mstrmojo.requiresCls("mstrmojo.qb.QBSimplePreview");var $DOM=mstrmojo.dom,$ARR=mstrmojo.array;var $SIMPLE_GRID;mstrmojo.DI.DIPreviewGrid=mstrmojo.declare(mstrmojo.qb.QBSimplePreview,null,{scriptClass:"mstrmojo.DI.DIPreviewGrid",cssClass:"lockHeader mstrmojo-di-previewGrid",adjustSize:function(columnCount){var COLUMN_WIDTH=200,p=this.parent&&this.parent.domNode,calculateWidth=COLUMN_WIDTH*columnCount;if(!p||!this.scrollboxNode){return ;}this.scrollboxNode.style.overflowX=(calculateWidth>p.clientWidth)?"scroll":"hidden";this.contentWidth=Math.max(calculateWidth,p.clientWidth)+"px";var cw=this.contentWidth,hc=this.headerContainerNode,ic=this.itemsContainerNode;if(cw&&hc&&ic){hc.children[0].style.width=cw;ic.style.width=cw;}},renderOnScroll:false,setupScrollNodes:function setupScrollNodes(){this.scrollNode=this.scrollboxNode;},lockHeader:false,postBuildRendering:function postBuildRendering(){if(this._super){this._super();}var dn=this.domNode,sb=this.scrollboxNode,hc=this.headerContainerNode;sb.style.height=dn.offsetHeight-hc.offsetHeight+"px";$DOM.attachEvent(sb,"scroll",function(){if(hc.scrollLeft!==sb.scrollLeft){hc.scrollLeft=sb.scrollLeft;}});$DOM.attachEvent(hc,"scroll",function(){if(sb.scrollLeft!==hc.scrollLeft){sb.scrollLeft=hc.scrollLeft;}});},populatePreview:function populatePreview(){var mappings=this.mappings,selectedColumns=this.selectedColumns,scrollLeft=0,scrollboxNode=this.scrollboxNode,i,len,dataset,j,simpleGrid=this;this.columns=[];if(scrollboxNode){scrollLeft=scrollboxNode.scrollLeft||0;}this.unrender();$ARR.forEach(mappings,function(tag,i){var columnIndex=tag.ix,headerText,hw;headerText=tag.n;hw={tag:tag,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:columnIndex,headerText:headerText,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@headerText}</span></div>',onclick:function onclick(){var index=this.columnIndex;$SIMPLE_GRID.showPopupMenu(simpleGrid,{menuNode:this.domNode.lastChild,data:{columnIndex:index,isVisible:function isVisible(data,menuItem){return mstrApp.isFFSQLMode?false:true;}}});}},colWidth:"60",dataFunction:function(d,idx,datagrid){var txt=d[this.dataField],css="mstrmojo-di-datapreview-DataRow-text";css+=(idx%2===1)?" odd":" even";return'<div class="'+css+'">'+txt+"</div>";},dataField:i.toString()};simpleGrid.columns.push(hw);});dataset=this.dataset;if(dataset.length===0&&this.columns.length>0){var _row_height=21;var count=parseInt(parseInt(this.parent.height)/_row_height)-1;count=count>0?count:1;var row;for(i=0;i<count;i++){row=[];for(j=0,len=this.columns.length;j<len;j++){row.push("");}dataset.push(row);}}this.items=dataset;this.render();this.adjustSize(mappings.length);this.updateScrollbars();this.scrollboxNode.scrollLeft=scrollLeft;}});}());