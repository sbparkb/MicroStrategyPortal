(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresDescs(10,2391,8338,8513,12882,13006,13819,14308,14309,14504,14505);var constants=mstrmojo.DI.DIConstants,$DESC=mstrmojo.desc,$CSS=mstrmojo.css,$DOM=mstrmojo.dom,MAX_TWEETS=5000;mstrmojo.DI.DISearchBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DISearchBox",cssClass:"mstrmojo-DI-SearchBox",searchLabel:$DESC(10,"Search"),headerLabelVisible:false,footerLabelVisible:true,headerLabelText:$DESC(13006,"Search for Data"),placeHolderText:$DESC(13006,"Search for Data"),previewTableId:"",showOperators:true,showAdvancedOptions:false,showFetchOptions:false,noDataErrorString:$DESC(12882,"No data was returned, please try another search string."),hideSignout:false,hint:"",iconCssClass:"",signOutTooltipText:"",tipLabel:mstrmojo.desc(14504,"Tip: use")+" ",operatorLabel:mstrmojo.desc(14505,"operators"),markupString:'<div class = "{@cssClass}" mstrAttach:click,keyup><div class = "signOut cf"></div><div class = "block center"><label class = "headerLabel" style="visible:{@headerLabelVisible};">{@headerLabelText}</label><div class="input"><input class="inputSearch" type="text" value = "" placeholder="{@placeHolderText}"/><div id={@id} class="mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton"><div class="mstrmojo-Button-text ">{@searchLabel}</div></div></div><div class="footerDiv"><label class ="helpOperatorsLabel" style="visible:{@footerLabelVisible}">{@tipLabel}<a class = "helpOperatorsLabelLink"><span id="operators">{@operatorLabel} </span></a></label><label class ="helpOperatorsLabel" style="visible:{@footerLabelVisible};"><a class = "helpOperatorsLabelLink"><span id="advanced">'+$DESC(2391,"Advanced search")+'</span></a></label></div><div  class="mstrmojo-di-source-fetch"><input type="text" value="100"/>'+$DESC(14308,"## rows of latest tweets.").replace("##","")+'<span class="comment">('+$DESC(14309,"Please do not type more than ##").replace("##",MAX_TWEETS)+')</span></div><div id={@id} class ="helpOperators" mstrAttach:click ></div><div id={@id} class ="noDataReturned">{@noDataErrorString}</div></div></div>',markupSlots:{signoutNode:function(){return this.domNode.children[0];},blockNode:function(){return this.domNode.children[1];},headerLabelNode:function(){return this.domNode.children[1].childNodes[0];},searchFieldNode:function(){return this.domNode.children[1].childNodes[1].firstChild;},searchButton:function(){return this.domNode.children[1].childNodes[1].lastChild;},footerNode:function(){return this.domNode.children[1].childNodes[2];},fetchNode:function(){return this.domNode.children[1].childNodes[3];},operatorsHelpNode:function(){return this.domNode.children[1].childNodes[4];},noDataReturnedNode:function(){return this.domNode.childNodes[1].lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.footerNode.firstChild.style.display=this.showOperators?"inline-block":"none";this.footerNode.children[1].style.display=this.showAdvancedOptions?"inline-block":"none";this.fetchNode.style.display=this.showFetchOptions?"block":"none";this.headerLabelNode.style.display=this.headerLabelVisible?"block":"none";}},handleNoDataReturned:function handleNoDataReturned(){this.noDataReturnedNode.style.visibility="visible";},init:function init(props){var evtConfig,listConfig;this._super(props);evtConfig={};listConfig=evtConfig[this.id]={};listConfig[constants.dataEvents.NO_DATA_RETURNED_EVENT]=this.handleNoDataReturned;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},formatUserEmail:function formatUserEmail(userEmail){if(userEmail!==""){userEmail="("+userEmail+")";}return userEmail;},getUserEmail:function getUserEmail(){var userEmail=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].userEmail;return this.formatUserEmail(userEmail);},getUserName:function getUserName(){var userName=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].userDisplayName;return $DESC(8513,"User:")+userName+" ";},getProfilePic:function getProfilePic(){var url=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].picurl;return url||"";},populate:function populate(){this.emailAddress.set("text",this.getUserEmail());this.username.set("text",this.getUserName());this.noDataReturnedNode.style.visibility="hidden";},children:[{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-signout",alias:"signoutLink",text:$DESC(8338,"sign out"),onclick:function(){mstrApp.getRootController().oAuthSignOut(this.parent.parent.sourceObjectsInfo.type);},postBuildRendering:function postBuildRendering(){var me=this,tooltipText=this.parent.signOutTooltipText;var rtn;if(this._super){rtn=this._super();}if(tooltipText){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:50,content:tooltipText});if(!this._ontooltipover){this._ontooltipover=function(e){me.showTooltip(e,self);};this._ontooltipout=function(e){me.hideTooltip(e,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);}return rtn;}},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"signoutLinkSeparator",text:" | "},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"emailAddress",bindings:{text:function(){return this.parent.getUserEmail();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"username",bindings:{text:function(){return this.parent.getUserName();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Image",cssClass:"profileIcon",bindings:{visible:function(){return !!this.parent.getProfilePic();},src:function(){return this.parent.getProfilePic();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Image",cssClass:"sourceIcon",bindings:{src:function(){var iconSrc="../javascript/mojo/css/images/DI/facebook-logo-small.png";if(this.parent.parent.iconCssClass==="twitterIcon"){iconSrc="../javascript/mojo/css/images/DI/twitter-logo-small.png";}return iconSrc;}}}],handleHelpOperatorsItemClick:function handleHelpOperatorsItemClick(evt,source){var textSelected=evt.currentTarget.value;source.searchFieldNode.value=textSelected;source.searchFieldNode.select();},operatorsHelp:{toggleVisibility:function(elem){if(elem.style.visibility==="visible"){elem.style.visibility="hidden";}else{elem.style.visibility="visible";}}},onclick:function(evt){var target=evt.e.target||evt.e.srcElement;if($DOM.contains(this.searchButton,target,true)){this.parent.onSearchClick(this.getSearchQuery());}if(target.id==="advanced"){this.parent.onadvancedSearchClick();}else{if(target.id==="operators"){mstrApp.getRootController().showDialog(constants.dialogType.twitterAdvOptDialog);}}},onkeyup:function(evt){this.parent.handleSearchChange(evt);},postBuildRendering:function(){var $this=this,inputNode=this.fetchNode.children[0];if(this._super){this._super();}this.parent.refreshSearch();if(this.signoutLink){this.signoutLink.domNode.style.display=this.hideSignout?"none":"block";this.signoutLinkSeparator.domNode.style.display=this.hideSignout?"none":"block";}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:inputNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:$DESC(13819,"Invalid input")});if(!this.validateFetchNum){this.validateFetchNum=function(evt){var result=$this.getFetchValue();if(!result.valid){$CSS.addClass(inputNode,"warning");$this.showTooltip(evt,window);window.clearTimeout($this._warningTimeOut);$this._warningTimeOut=window.setTimeout(function(){$this.hideTooltip(evt,window);},6000);}else{window.clearTimeout($this._warningTimeOut);$this.hideTooltip(evt,window);$CSS.removeClass(inputNode,"warning");}};}$DOM.attachEvent(inputNode,"blur",this.validateFetchNum);},getFetchValue:function(){var value=parseInt(this.fetchNode.children[0].value,10),result={valid:true,value:value};if(isNaN(value)||value>MAX_TWEETS||value<=0){result.valid=false;result.value=100;}return result;},getSearchQuery:function getSearchQuery(){return this.searchFieldNode.value;},updateLayout:function updateLayout(){$CSS.addClass(this.blockNode,"top");$CSS.addClass(this.signoutNode,"top");$CSS.removeClass(this.blockNode,"center");}});}());