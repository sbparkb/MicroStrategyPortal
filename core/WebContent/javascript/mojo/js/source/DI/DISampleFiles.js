(function(){mstrmojo.requiresCls("mstrmojo.DataGrid");mstrmojo.requiresDescs(39,12539);var constants=mstrmojo.DI.DIConstants;function doImport(action){var showPreview=(this.model.operationMode===constants.operationMode.create),controller=mstrApp.getRootController(),selectedItems=this.getSelectedItems(),me=this;this.urls=[];mstrmojo.array.forEach(selectedItems,function(item){var url=item.url;me.urls.push(url);});controller.importURLEMMA(this,this.urls,showPreview,!controller.model.hasEMMAReportInstance(),this.id,true,action);}function toggleSelectAll(selectedAll){var num=this.items.length;var selected={},i;if(selectedAll){for(i=0;i<num;i++){selected[i]=selectedAll;}}this.set("selectedIndices",selected);}mstrmojo.DI.DISampleFiles=mstrmojo.declare(mstrmojo.DataGrid,null,{scriptClass:"mstrmojo.DI.DISampleFiles",cssClass:"mstrmojo-di-samplefiles",data:null,resizableColumns:false,multiSelect:true,selectionPolicy:"toggle",urls:[],visible:false,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},columns:[{headerCss:"mstrmojo-di-samplefiles-col1header",headerWidget:{scriptClass:"mstrmojo.ImageCheckBox",label:mstrmojo.desc(12539,"Sample File"),alias:"allSampleFiles",state:"unselect-all",preclick:function(){if(this.dataGrid.tableID){return ;}if(this.state==="select-all"){this.set("state","unselect-all");toggleSelectAll.call(this.dataGrid,false);}else{this.set("state","select-all");toggleSelectAll.call(this.dataGrid,true);}},onstateChange:function(){var CSS=mstrmojo.css;CSS.removeClass(this.inputNode,["select-all","unselect-all","select-some"]);CSS.addClass(this.inputNode,this.state);},postCreate:function(){this.set("state","unselect-all");}},colCss:"mstrmojo-di-samplefiles-col1",dataWidget:{scriptClass:"mstrmojo.ImageCheckBox",bindings:{label:"this.parent.data.display",checked:function(){return !!this.parent.dataGrid.selectedIndices[this.idx];}},preclick:function(){this.set("checked",!!this.parent.dataGrid.selectedIndices[this.idx]);var num=this.parent.dataGrid.items.length;var selectedNum=0,i;for(i=0;i<num;i++){if(this.parent.dataGrid.selectedIndices[i]){selectedNum++;}}var allCheckBox=this.dataGrid._headerWidgets_[0];if(selectedNum<=0){allCheckBox.set("state","unselect-all");}else{if(selectedNum>=num){allCheckBox.set("state","select-all");}else{allCheckBox.set("state","select-some");}}}}},{headerText:mstrmojo.desc(39,"Description"),colCss:"mstrmojo-di-samplefiles-col2",dataWidget:{scriptClass:"mstrmojo.Container",markupString:'<div class="mstrmojo-di-sampleitem-desc"><div class="sampleitem-desc-text""></div><div class="sampleitem-desc-downloadbtn"></div></div>',markupSlots:{textNode:function(){return this.domNode.children[0];},btnNode:function(){return this.domNode.children[1];}},children:[{scriptClass:"mstrmojo.Label",slot:"textNode",bindings:{text:"this.parent.data.desc"}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-di-download",slot:"btnNode",onclick:function(e){var url=this.parent.data.url;if(mstrApp.isSingleTier){window.FormWrapper.openPage(url);}else{mstrApp.openPage(url);}e.cancel();},premousedown:function(e){e.cancel();}}]}}],init:function(config){this._super(config);this.set("items",this.model.sampleFiles.file);var controller=mstrApp.getRootController();controller.sourceSelected(false);if(this.model.importSources[this.tableID]&&this.model.importSources[this.tableID].sourceInfo&&this.model.importSources[this.tableID].sourceInfo.url){var i,url=this.model.importSources[this.tableID].sourceInfo.url;for(i=0;i<this.items.length;i++){if(url===this.items[i].url){this.set("selectedIndex",i);break;}}this.set("multiSelect",false);}},onchange:function(){var controller=mstrApp.getRootController();var selectedItems=this.getSelectedItems();if(selectedItems.length>0){controller.sourceSelected(true);}else{controller.sourceSelected(false);}},onvisibleChange:function(){var controller=mstrApp.getRootController();if(this.selectedIndex!==-1){controller.sourceSelected(true);}else{controller.sourceSelected(false);}},getFileUrl:function(idx){var url;if(idx<this.urls.length){url=this.urls[idx];return url;}return"";},getFilesCnt:function(){return this.urls?this.urls.length:0;},getFileTableID:function(idx){if(this.urls&&idx<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[idx]];}},onNextButtonClick:function(){doImport.call(this,this.tableID?constants.actions.refreshData:constants.actions.importSource);},onFinishButtonClick:function(){doImport.call(this,constants.actions.savePublish);},onHelpButtonClick:function onHelpButtonClick(){return"importing_data_from_a_sample_file.htm";},onBackButtonClick:function(){var controller=mstrApp.getRootController();controller.showPage(constants.pageType.dataSelection);}});}());