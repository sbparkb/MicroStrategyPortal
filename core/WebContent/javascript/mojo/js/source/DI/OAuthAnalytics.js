(function(){mstrmojo.requiresCls("mstrmojo.DI.OAuthSource","mstrmojo.DI.DIConstants");mstrmojo.DI.OAuthAnalytics=mstrmojo.declare(mstrmojo.DI.OAuthSource,null,{scriptClass:"mstrmojo.DI.OAuthAnalytics",accounts:[],onGetAnalyticsWebProperties:{},onGetAnalyticsProfiles:{},reset:function(){this.accounts=[];this.onGetAnalyticsProfiles={};this.onGetAnalyticsProfiles={};this._super();},populateReports:function populateReports(result){if(result.mi.ght){this.accounts=this.isArray(result.mi.ght.gacc)?result.mi.ght.gacc:this.makeArray(result.mi.ght.gacc);}if(this._super){this._super(result);}if(this.accounts&&this.accounts[0]){this.populateWebProperties(result,this.accounts[0].id);this.populateProfiles(result,this.accounts[0].id,this.accounts[0].webProperties[0].id);}},populateWebProperties:function populateWebProperties(result,accountID){var accts=this.isArray(result.mi.ght.gacc)?result.mi.ght.gacc:this.makeArray(result.mi.ght.gacc);var idx=mstrmojo.array.find(accts,"id",accountID);var acct=null;if(idx===-1){return ;}acct=accts[idx];for(var i=0;i<this.accounts.length;i++){var account=this.accounts[i];if(account.id===accountID){account.webProperties=this.isArray(acct.gprp)?acct.gprp:this.makeArray(acct.gprp);break;}}this.raiseEvent({name:"analyticsWebPropertiesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});},checkWebProperties:function checkWebProperties(accountId,bRaiseEvent){var account=this.getAccountById(accountId);if(!account){return false;}if(account.webProperties){if(bRaiseEvent){this.raiseEvent({name:"analyticsWebPropertiesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});}return true;}else{return false;}},populateProfiles:function populateProfiles(result,accountID,webPropertyID){var accts,props,acct,prop,idx;accts=this.isArray(result.mi.ght.gacc)?result.mi.ght.gacc:this.makeArray(result.mi.ght.gacc);idx=mstrmojo.array.find(accts,"id",accountID);if(idx===-1){return ;}acct=accts[idx];props=this.isArray(acct.gprp)?acct.gprp:this.makeArray(acct.gprp);idx=mstrmojo.array.find(props,"id",webPropertyID);if(idx===-1){return ;}prop=props[idx];for(var i=0;i<this.accounts.length;i++){var account=this.accounts[i];if(account.id===accountID){for(var j=0;j<account.webProperties.length;j++){var property=account.webProperties[j];if(property.id===webPropertyID){property.profiles=this.isArray(prop.gprf)?prop.gprf:this.makeArray(prop.gprf);break;}}break;}}this.raiseEvent({name:"analyticsProfilesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});},checkProfiles:function checkProfiles(accountID,webPropertyID,bRaiseEvent){var account,webProperty,idx;account=this.getAccountById(accountID);if(!this.checkWebProperties(accountID,false)){return false;}idx=mstrmojo.array.find(account.webProperties,"id",webPropertyID);if(idx===-1){return false;}webProperty=account.webProperties[idx];if(webProperty.profiles){if(bRaiseEvent){this.raiseEvent({name:"analyticsProfilesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});}return true;}else{return false;}},getAccountById:function getAccountById(accountId){var i=0;var account=null;for(i=0;i<this.accounts.length;i++){if(this.accounts[i].id===accountId){account=this.accounts[i];break;}}return account;},parseOAuthSourceFolder:function parseOAuthSourceFolder(res){var items=[];var fds=this.isArray(res.mi.ftree.fd)?res.mi.ftree.fd:this.makeArray(res.mi.ftree.fd);var fls=this.isArray(res.mi.ftree.fl)?res.mi.ftree.fl:this.makeArray(res.mi.ftree.fl);var fd,fl,i,item;for(i=0;i<fds.length;i++){fd=fds[i];item={isFolder:true};item.n=fd.n;item.desc=fd.des;item.address=fd.address;item.type=0;items.push(item);}for(i=0;i<fls.length;i++){fl=fls[i];item={isFolder:false};item.edit=true;item.n=fl.n;item.desc=fl.des;item.address=fl.address;item.type=fl.mimetype;items.push(item);}return items;}});}());