(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.DataGrid","mstrmojo.Table","mstrmojo.HBox","mstrmojo.form","mstrmojo.MenuButton","mstrmojo.date","mstrmojo.DI.DIConstants","mstrmojo.DI.DIExitOptions","mstrmojo.ui.menus.Menu","mstrmojo.ui.menus.MenuConfig","mstrmojo.DI.ui.dialogs.DIPermissionDialog","mstrmojo.locales","mstrmojo.date","mstrmojo.css","mstrmojo.expr");mstrmojo.requiresDescs(60,172,239,767,1085,1088,1279,3610,7559,9099,9101,9242,10216,10380,12855,13042,13043,13044,13045,13046,13047,13127,9252,13241,773,8733,1388,14055,14056,14452,14453,14454);var $ARR=mstrmojo.array,$CSS=mstrmojo.css,exitHelper=mstrmojo.DI.DIExitOptions,$DOM=mstrmojo.dom,$STR=mstrmojo.string,$EXPR=mstrmojo.expr,STP=$EXPR.STP,constants=mstrmojo.DI.DIConstants;var HIGHLIGHT_CSS_CLASS="highlight",COLUMNS={TYPE:"type",NAME:"n",SIZE:"sz",DATE:"dt",SCHEDULE:"sched"};function populateCubeACLItems(data){var canEdit=data.canEdit,attributeId,formDataTypes={};$ARR.forEach(data.mapping.datap,function tableHandler(table){$ARR.forEach(table.maps&&table.maps.amps,function attributeHandler(mapping){attributeId=mapping.aimp.atid;$ARR.forEach(mapping.afmps,function formHandler(form){formDataTypes[attributeId+form.fmid]=form.bft;});});});data=data.oi.gsfsr;var objectInfos=[].concat(data.mi["in"].oi),cubeInfo=objectInfos[0],target={ab:cubeInfo.ab,acg:cubeInfo.acg,desc:cubeInfo.des,did:cubeInfo.did,n:cubeInfo.n,own:cubeInfo.ow.content,st:cubeInfo.stp,t:cubeInfo.tp},items=[],acls=[].concat(data.mi.acl.ace),objectInfo,userInfo,item,users;target.canEdit=canEdit;if(!data.mi.acl||data.u===undefined){target.acls=[];return target;}users=[].concat(data.u);$ARR.forEach(acls,function aclHandler(acl){objectInfo=objectInfos[$ARR.find(objectInfos,"id",acl.trustee)];item={den:!!acl.deny,did:objectInfo.did,inh:!!acl.inheritable,n:objectInfo.n,rgt:acl.rights,st:objectInfo.stp};userInfo=users[$ARR.find(users,"uid",objectInfo.did)];if(userInfo.mi){item.partial=userInfo.partial_type;item.fg=userInfo.partial_type||3;item.filter=mstrmojo.DI.ui.dialogs.DIPermissionDialog.buildWalk(userInfo.mi.exp.nd,[].concat(userInfo.mi["in"].oi),formDataTypes);item.filterText=userInfo.mi.exp.content;}else{item.filter="";item.filterText="";item.fg=1;}items.push(item);});target.acls=items;target.formTypes=formDataTypes;return target;}mstrmojo.DI.CubeListCubeMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.CubeListCubeMenu",menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-cubeListCubeMenu",data:null,cubeID:null,cubeName:null,subs:null,handleRepublish:function(item){mstrApp.fromCubesList=true;mstrApp.getRootController().resetAppforRepublish(item.ctxt);},handleEdit:function(item){var ctxt=item.ctxt;mstrApp.getRootController().closeDialog(constants.dialogType.cubesList);mstrApp.restart({ReportId:ctxt.cubeID,CubeName:ctxt.cubeName,StatusCode:constants.statusCode.edit,AnalysisId:undefined,datasets:null});},handleShare:function(item){var ctxt=item.ctxt,did=ctxt.cubeID,candidates=[],id="mstrACL",openACL=function(oi){var ae=mstrmojo.all[id];if(!ae){ae=new mstrmojo.DI.ui.dialogs.DIPermissionDialog({id:id,oi:oi,cubeid:did,candidates:candidates});}else{ae.set("oi",oi);ae.cubeid=did;ae.candidates=candidates;}ae.formTypes=oi.formTypes;ae.open(null,{zIndex:mstrApp.getRootController().getDialogController().getNextZIndex()});};var dataService=mstrApp.getRootController().getDataService();dataService.getSecurityFilter({success:function success(res){var attribute;$ARR.forEach(res.mapping.datap,function tableHandler(table){$ARR.forEach(table.maps&&table.maps.amps,function attributeHandler(mapping){attribute=mapping.aimp;if($ARR.find(candidates,"did",attribute.atid)===-1){candidates.push({n:attribute.atnm,did:attribute.atid,t:12});}});});if(candidates.length===0){res.canEdit=0;}openACL(populateCubeACLItems(res));}},{cubeid:did,isNew:true});},handleDelete:function(item){var params={objectID:item.ctxt.cubeID,objectType:3};var controller=mstrApp.getRootController();var msg=mstrmojo.desc(13127,"Are you sure you want to delete the intelligent cube, ##?").replace("##",this.ctxt.cubeName);var callback={success:function(){params={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")};controller.getCubeQuota({success:function(){controller.getCubeQuota({success:function(){controller.scheduleController.updateScheduleAndStatus();}},params);}},params);},failure:function(res){controller.displayError(res.message||res.getResponseHeader("X-MSTR-TaskFailureMsg"));}};var okHandler=function(){controller.deleteObject(callback,params);};controller.displayWarning(msg,mstrmojo.desc(3610,"Microstrategy Web"),okHandler);},handleRename:function(item){item.ctxt.nameWidget.set("editMode",true);},handleShowInFolder:function(item){var controller=mstrApp.getRootController();var callback={success:function(res){if(res&&res.items&&res.items.length===1){var folderID=res.items[0].fid;mstrApp.redirectToPage({evt:"2001",folderID:folderID});}},failure:function(res){controller.displayError(mstrmojo.desc(14056,"Error when getting the cube's folder id."),false,res.message);}};controller.dataService.getObjectFolder(callback,{dids:item.ctxt.cubeID,types:3});},handleRepublish2:function(item){var ctxt=item.ctxt;var cfg={ReportId:ctxt.cubeID,CubeName:ctxt.cubeName,StatusCode:constants.statusCode.republish};mstrApp.getRootController().getDialogController().show(constants.dialogType.diPageDialog,{pageType:constants.pageType.republish,diParams:cfg});return true;},handleAddSchedule:function(item){var ctxt=item.ctxt;var cfg={ReportId:ctxt.cubeID,CubeName:ctxt.cubeName,StatusCode:constants.statusCode.schedule};mstrApp.getRootController().getDialogController().show(constants.dialogType.diPageDialog,{pageType:constants.pageType.schedule,diParams:cfg});return true;},handleEditSubscription:function(item){var ctxt=item.ctxt;var cfg={ReportId:ctxt.contentID,CubeName:ctxt.contentName,SubsId:ctxt.did,SubsName:ctxt.subsName,StatusCode:constants.statusCode.schedule};mstrApp.getRootController().getDialogController().show(constants.dialogType.diPageDialog,{pageType:constants.pageType.schedule,diParams:cfg});return true;},handleDeleteSubscription:function(item){var subsID=item.ctxt.did;var cb={success:function(){mstrApp.getRootController().getScheduleController().updateScheduleAndStatus();},failure:function(res){mstrApp.getRootController().displayError(mstrmojo.desc(12855,"Cannot remove this subscription."),false,res.message);}};mstrApp.getRootController().getScheduleController().removeSubscription([subsID],cb);return true;},handleRefreshHistory:function(item){var subsID=item.ctxt.did;mstrApp.getRootController().getScheduleController().getScheduleStatus([subsID],{complete:function(){mstrApp.getRootController().getScheduleController().showScheduleStatusDialog(subsID);}});return true;},handleCreate:function(item){mstrApp.redirectToPage(exitHelper.getRedirectParams(item.ctxt.did,item.ctxt.cubeID,item.ctxt.isDDA));},getSubsMenuConfig:function(ctxt){var me=this,cfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu subscriptionMenu"});if(mstrApp.diParams.canSubscribe){cfg.addMenuItem(mstrmojo.desc(767,"Modify"),"",me.handleEditSubscription,ctxt);cfg.addMenuItem(mstrmojo.desc(9252,"Delete"),"",me.handleDeleteSubscription,ctxt);}else{cfg.addDisabledMenuItem(mstrmojo.desc(767,"Modify"),"");cfg.addDisabledMenuItem(mstrmojo.desc(9252,"Delete"),"");}cfg.addMenuItem(mstrmojo.desc(10216,"Refresh History"),"",me.handleRefreshHistory,ctxt);return cfg;},getCreateMenuConfig:function(){var me=this,cfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});cfg.addMenuItem(mstrmojo.desc(8042,"Create Dashboard"),"dashboard",me.handleCreate,{did:exitHelper.pageRedirect.analysis,cubeID:me.cubeID,isDDA:false});cfg.addMenuItem(mstrmojo.desc(2918,"Create Document"),"document",me.handleCreate,{did:exitHelper.pageRedirect.doc,cubeID:me.cubeID,isDDA:false});cfg.addMenuItem(mstrmojo.desc(5,"Create Report"),"report",me.handleCreate,{did:exitHelper.pageRedirect.report,cubeID:me.cubeID,isDDA:false});return cfg;},getCreateMenuConfigDDA:function(){var me=this,cfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});cfg.addMenuItem(mstrmojo.desc(8042,"Create Dashboard"),"dashboard",me.handleCreate,{did:exitHelper.pageRedirect.analysis,cubeID:me.cubeID,isDDA:true});cfg.addMenuItem(mstrmojo.desc(2918,"Create Document"),"document",me.handleCreate,{did:exitHelper.pageRedirect.doc,cubeID:me.cubeID,isDDA:true});return cfg;},getScheduleMenuConfig:function(){var me=this,cfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});if(mstrApp.diParams.canSubscribe){cfg.addMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add",me.handleAddSchedule,{cubeID:me.cubeID,cubeName:me.cubeName});}else{cfg.addDisabledMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add");}if(me.subs&&me.subs.length>0){cfg.addSeparator();$ARR.forEach(me.subs,function(sub){var text="",cls="subscription ",subStatus=sub.status&&sub.status.length>0&&sub.status[sub.status.length-1],tooltip;if(subStatus){if(subStatus.en===0){cls+="success";}else{cls+="fail";tooltip=subStatus.emsg;}}else{cls+="empty";}if(sub.subsName.indexOf(sub.contentName)===0){text="..."+sub.subsName.substr(sub.contentName.length);}else{text=sub.subsName;}if(text.length>50){text=text.substr(0,50);}if(tooltip){tooltip=$STR.encodeHtmlString(tooltip);text=$STR.encodeHtmlString(text);text='<span title="'+tooltip+'">'+text+"</span>";}cfg.addSubMenuItem(text,cls,me.id,me.getSubsMenuConfig,sub);});}return cfg;},getMenuConfig:function(){var me=this,cfg,republishText;cfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:me.menuCssClass});if(mstrApp.refreshMultipleCubes){republishText=me.data.sz?mstrmojo.desc(9242,"Republish"):mstrmojo.desc(172,"Publish");cfg.addMenuItem(republishText,"republish",me.handleRepublish2,{cubeID:me.cubeID,cubeName:me.cubeName});}else{if(me.data.type!=="Managed"){if(me.data.ddam===constants.datasetServeMode.dda){cfg.addSubMenuItem(mstrmojo.desc(3291,"Create"),"create",me.id,me.getCreateMenuConfigDDA);}else{cfg.addSubMenuItem(mstrmojo.desc(3291,"Create"),"create",me.id,me.getCreateMenuConfig);}}republishText=me.data.sz?mstrmojo.desc(9242,"Republish"):mstrmojo.desc(172,"Publish");cfg.addMenuItem(republishText,"republish",me.handleRepublish2,{cubeID:me.cubeID,cubeName:me.cubeName});if(me.data.type!=="Managed"){cfg.addMenuItem(mstrmojo.desc(1088,"Edit"),"edit",me.handleEdit,{cubeID:me.cubeID,cubeName:me.cubeName});}if(me.subs&&me.subs.length>0){cfg.addSubMenuItem(mstrmojo.desc(1085,"Schedule"),"schedule",me.id,me.getScheduleMenuConfig);}else{if(mstrApp.diParams.canSubscribe){cfg.addMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add",me.handleAddSchedule,{cubeID:me.cubeID,cubeName:me.cubeName});}else{cfg.addDisabledMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add");}}if(me.data.type!=="Managed"){cfg.addMenuItem(mstrmojo.desc(9099,"Share"),"share",me.handleShare,{cubeID:me.cubeID,cubeName:me.cubeName});cfg.addMenuItem(mstrmojo.desc(9252,"Delete"),"delete",me.handleDelete,{cubeID:me.cubeID,cubeName:me.cubeName});cfg.addMenuItem(mstrmojo.desc(1388,"Rename"),"rename",me.handleRename,{nameWidget:me.opener.parent.children[0]});cfg.addMenuItem(mstrmojo.desc(14055,"Show in folder"),"show",me.handleShowInFolder,{cubeID:me.cubeID});}}return cfg;}});function openCubeMenu(opener,data){var menuHelper=opener.menuHelper,menuCfg;if(!opener.openPopup){opener.openPopup=function(ref,config){mstrmojo._HasPopup.openPopup.call(opener,ref,config);};}if(!opener.closePopup){opener.closePopup=function(){mstrmojo._HasPopup.closePopup.call(opener);};}if(!menuHelper){menuHelper=new mstrmojo.DI.CubeListCubeMenu();opener.menuHelper=menuHelper;}menuHelper=opener.menuHelper;menuHelper.data=data;menuHelper.cubeID=data.cube_id;menuHelper.cubeName=data.cname;menuHelper.subs=data.subs;menuHelper.opener=opener;menuCfg=menuHelper.getMenuConfig();menuCfg.hostId=opener.id;menuCfg.hostElement=opener.domNode;menuCfg.position=$DOM.position(opener.domNode,true);menuCfg.isHostedWithin=false;menuCfg.zIndex=mstrApp.getRootController().getDialogController().getNextZIndex();opener.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:menuCfg}));}function getCubesSortFn(sortField,sortOrder){var fn=null;switch(sortField){case COLUMNS.TYPE:fn=function(a,b){var lNameStr=a.cname===undefined?"":a.cname,rNameStr=b.cname===undefined?"":b.cname,lTypeStr=a.type===undefined?"":a.type,rTypeStr=b.type===undefined?"":b.type;if(lTypeStr.toString().toLowerCase()<rTypeStr.toString().toLowerCase()){return sortOrder;}else{if(lTypeStr.toString().toLowerCase()===rTypeStr.toString().toLowerCase()){if(lNameStr.toString().toLowerCase()<rNameStr.toString().toLowerCase()){return -1;}else{return 1;}}else{return(-sortOrder);}}};break;case COLUMNS.NAME:fn=function(a,b){var lstr=a.cname===undefined?"":a.cname,rstr=b.cname===undefined?"":b.cname;return(lstr.toString().toLowerCase()<rstr.toString().toLowerCase())?sortOrder:(-sortOrder);};break;case COLUMNS.SIZE:fn=function(a,b){return(parseInt(a.sz||0,10)<parseInt(b.sz||0,10))?sortOrder:(-sortOrder);};break;case COLUMNS.DATE:fn=function(a,b){var amt=a.mdt||a.nutm||a.utm||"",bmt=b.mdt||b.nutm||b.utm||"";amt=amt.replace(/-/g,"/");bmt=bmt.replace(/-/g,"/");return(new Date(amt).getTime()<(new Date(bmt).getTime()))?sortOrder:(-sortOrder);};break;case COLUMNS.SCHEDULE:fn=function(a,b){return a.schedStatus>b.schedStatus?sortOrder:(-sortOrder);};break;}return fn;}function getSearchedItems(items,pattern){var results=[],n,i;if(!pattern){return items;}for(i=0;items&&i<items.length;i++){n=items[i].cname===undefined?"":items[i].cname.toString().toUpperCase();if(n.indexOf(pattern.toUpperCase())>-1){results.push(items[i]);}}return results;}mstrmojo.DI.DICubesList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DICubesList",markupString:'<div class="mstrmojo-di-cubes cf"><div></div><div></div></div>',markupSlots:{subTitleNode:function(){return this.domNode.children[0];},cubesNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},searchPattern:"",items:null,setDimensions:function setDimensions(h,w){var height=parseInt(h,10);var width=parseInt(w,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.cubesNode=(height-10)+"px";this.layoutConfig.w.cubesNode=width+"px";if(this._super){this._super(height+"px",w);}},preBuildRendering:function preBuildRendering(){if(this._super){this._super();}this.update();},postBuildRendering:function(){if(this._super){this._super();}var model=mstrApp.getRootController().getModel();model.attachEventListener("cubesInfoChange",this.id,"update");model.attachEventListener("subsInfoChange",this.id,"update");model.attachEventListener("subsStatusChange",this.id,"update");},populateACLItems:function(items){return populateCubeACLItems(items);},update:function(){var model=mstrApp.getRootController().getModel(),res,curSortBy=this.cubesList.curSortBy,cubeListScrollTop=null,sortFn;if(model.cubesInfo){res=model.cubesInfo;}if(this.cubesList.scrollNode){cubeListScrollTop=this.cubesList.scrollNode.scrollTop;}var cubes=res.cubes&&res.cubes.cube?[].concat(res.cubes&&res.cubes.cube):[];$ARR.forEach(cubes,function(cube){if(cube.ddam===constants.datasetServeMode.dda){cube.type=mstrmojo.desc(14452,"Live");}else{cube.type=mstrmojo.desc(14453,"In memory");}});var docs=res.cubes&&res.cubes.doc?[].concat(res.cubes&&res.cubes.doc):[];$ARR.forEach(docs,function(doc){var managedCubes=doc.cube?[].concat(doc.cube):[];$ARR.forEach(managedCubes,function(cube){cube.docn=doc.docn;cube.docid=doc.id;cube.docp=doc.objp;cube.type=mstrmojo.desc(14454,"Managed");cubes.push(cube);});});if(curSortBy&&curSortBy.k){sortFn=getCubesSortFn(curSortBy.k,curSortBy.v);if(sortFn){cubes=cubes.sort(sortFn);}}this.set("items",cubes);this.cubesList.set("items",getSearchedItems(cubes,this.searchPattern));if(cubeListScrollTop!==null){this.cubesList.scrollNode.scrollTop=cubeListScrollTop;}},onsearchPatternChange:function(){var items=this.items,pattern=this.searchPattern,searchedItems;searchedItems=getSearchedItems(items,pattern);this.cubesList.set("items",searchedItems);},children:[{scriptClass:"mstrmojo.Box",slot:"subTitleNode",cssClass:"mstrmojo-di-cubes-subTitleBox cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-cubes-subTitle",postBuildRendering:function(){var model=mstrApp.getRootController().getModel();if(this._super){this._super();}this.update();model.attachEventListener("cubesInfoChange",this.id,"update");},update:function(){var res=mstrApp.getRootController().model.cubesInfo,quota,txt,percentage;if(res===undefined||!res.cubes){return ;}var usage=res.cubes.cusage,places=0;if(usage<1){places=2;}else{if(usage<10){places=1;}}if(usage!==undefined){usage=Number(usage.toFixed(places));if(res.cubes.cquota===-1){txt=mstrmojo.desc(12693,"##### MB used. You have unlimited storage!").replace("#####",Math.round(usage*100)/100);}else{quota=res.cubes.cquota;percentage=Math.round(usage/quota*10000)/100;txt=mstrmojo.desc(13241,"You are currently using ## MB (###) out of #### MB in allocated In-memory space.");txt=txt.replace("####",quota).replace("###",percentage+"%").replace("##",usage);}this.set("text",txt);}}},{scriptClass:"mstrmojo.ui.SearchBox",cssClass:"mstrmojo-di-cubes-subTitle-search",searchDelay:600,searchTriggered:function(pattern){var widget=this.parent.parent;widget.set("searchPattern",pattern);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-cubes-subTitle-refresh",title:mstrmojo.desc(773,"Refresh"),bindings:{visible:"!mstrApp.refreshMultipleCubes"},onclick:function(){var controller=mstrApp.getRootController();controller.getCubeQuota({success:function(){controller.scheduleController.updateScheduleAndStatus();}},{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});}}]},{scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-di-QuotaGrid",alias:"cubesList",slot:"cubesNode",resizableColumns:false,setupScrollNodes:function setupScrollNodes(){this.scrollNode=this.scrollboxNode;},bindings:{items:"this.parent.items"},sortBy:{n:1,sz:1,own:1,dt:1,sched:1,type:1},curSortBy:{k:null,v:1},columns:[{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(8733,"Type"),onclick:function(){var dg=this.dataGrid;dg.sortBy.type=-dg.sortBy.type;var v=dg.sortBy.type;dg.curSortBy.k=COLUMNS.TYPE;dg.curSortBy.v=v;var items=[];items=items.concat(dg.items);dg.set("items",items.sort(getCubesSortFn(COLUMNS.TYPE,v)));},postBuildRendering:function pbr(){var dg=this.dataGrid;if(dg.curSortBy.k===COLUMNS.TYPE){$CSS.addClass(this.domNode,HIGHLIGHT_CSS_CLASS);}}},colCss:"typeCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"typeLabel",bindings:{text:"this.parent.data.type"}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(7559,"Name"),onclick:function(){var dg=this.dataGrid;dg.sortBy.n=-dg.sortBy.n;var v=dg.sortBy.n;dg.curSortBy.k=COLUMNS.NAME;dg.curSortBy.v=v;var items=[];items=items.concat(dg.items);dg.set("items",items.sort(getCubesSortFn(COLUMNS.NAME,v)));},postBuildRendering:function pbr(){var dg=this.dataGrid;if(dg.curSortBy.k===COLUMNS.NAME){$CSS.addClass(this.domNode,HIGHLIGHT_CSS_CLASS);}}},colCss:"nameCol",dataWidget:{scriptClass:"mstrmojo.Table",cssClass:"nameTable",rows:1,cols:2,children:[{slot:"0,0",scriptClass:"mstrmojo.InlineEditBox",cssClass:"nameLabel",useRichTooltip:true,okSave:true,bindings:{text:function(){var n=this.parent.data.cname+(this.parent.data.docn?" ("+this.parent.data.docn+")":"");return mstrmojo.string.escape4HTMLText(n);},richTooltip:function(){var tooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT};tooltip.content=this.parent.data.docp?this.parent.data.docp:this.parent.data.objp;return tooltip;}},postBuildRendering:function postBuildRendering(){if(this._super){this._super();}this._em_sub=this.attachEventListener("editModeChange",this.id,"_attachEvents");this.tooltipNode=this.textNode;this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},save:function(){this.oldColumn=this.text;this.newColumn=this.inputNode.value;this.set("editMode",false);if(this.oldColumn===this.newColumn){return ;}this.set("text",this.inputNode.value);if(this.onSave){this.onSave();}},onSave:function(){var params={objectid:this.parent.data.cube_id,objecttype:3,objectname:this.text};var controller=mstrApp.getRootController();var callback={success:function(){params={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")};controller.getCubeQuota({success:function(){controller.getCubeQuota({success:function(){controller.scheduleController.updateScheduleAndStatus();}},params);}},params);},failure:function(res){controller.displayError(res.message||res.getResponseHeader("X-MSTR-TaskFailureMsg"));}};controller.renameObject(callback,params);},preclick:function(evt){var e=evt.e,t=$DOM.eventTarget(evt.hWin,e);if(t===this.okNode){this.save();}else{if(t===this.cancelNode){this.cancel();}else{if(t===this.textNode){if(mstrApp.refreshMultipleCubes){var st=this.parent.data.st;if(st===STP.REPORT_EMMACUBE||st===STP.REPORT_GRID||st===STP.REPORT_GRAPH||st===STP.REPORT_GRIDGRAPH){var cfg={ReportId:this.parent.data.cube_id,CubeName:this.parent.data.cname,StatusCode:constants.statusCode.republish};mstrApp.getRootController().getDialogController().show(constants.dialogType.diPageDialog,{pageType:constants.pageType.republish,diParams:cfg});}else{if(st===STP.REPORT_CUBE){mstrApp.getRootController().publishNonEmmaCube(this.parent.data.cube_id);}}}else{if(this.parent.data.type==="Managed"){mstrApp.redirectToPage(exitHelper.getRedirectParams(exitHelper.pageRedirect.existingAnalysis,null,false,this.parent.data.docid));}else{mstrApp.redirectToPage(exitHelper.getRedirectParams(exitHelper.pageRedirect.analysis,this.parent.data.cube_id,this.parent.data.type==="Live"));}}}}}}},{slot:"0,1",scriptClass:"mstrmojo.MenuButton",cssClass:"cubeList-menu-button",cmCssClass:"cubeList-menu",menuZIndex:1000,preclick:mstrmojo.func.emptyFn,preBuildRendering:function(){var data=this.parent.data,visible=true;if(this._super){this._super();}if(!data||!data.cube_id||mstrApp.refreshMultipleCubes){visible=false;}this.set("visible",visible);},onclick:function(){var data=this.parent.data,me=this;openCubeMenu(me,data);}}]}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13045,"Size(KB)"),onclick:function(){var dg=this.dataGrid;dg.sortBy.sz=-dg.sortBy.sz;var v=dg.sortBy.sz;dg.curSortBy.k=COLUMNS.SIZE;dg.curSortBy.v=v;var items=[];items=items.concat(dg.items);dg.set("items",items.sort(getCubesSortFn(COLUMNS.SIZE,v)));},postBuildRendering:function pbr(){var dg=this.dataGrid;if(dg.curSortBy.k===COLUMNS.SIZE){$CSS.addClass(this.domNode,HIGHLIGHT_CSS_CLASS);}}},colCss:"sizeCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"sizeLabel",bindings:{text:"this.parent.data.sz"}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13046,"Last Modified"),onclick:function(){var dg=this.dataGrid;dg.sortBy.dt=-dg.sortBy.dt;var v=dg.sortBy.dt;dg.curSortBy.k=COLUMNS.DATE;dg.curSortBy.v=v;var items=[];items=items.concat(dg.items);dg.set("items",items.sort(getCubesSortFn(COLUMNS.DATE,v)));},postBuildRendering:function pbr(){var dg=this.dataGrid;if(dg.curSortBy.k===COLUMNS.DATE){$CSS.addClass(this.domNode,HIGHLIGHT_CSS_CLASS);}}},colCss:"modifiedCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"mtLabel",bindings:{text:function(){var data=this.parent.data;var mt=data.mdt;if(mt===undefined){mt=data.nutm||data.utm;}if(mt===undefined){return"";}return mstrmojo.DI.DIHelpers.formatDateAndTime(mt,true);}}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13047,"Schedule Status"),onclick:function(){var dg=this.dataGrid;dg.sortBy.dt=-dg.sortBy.dt;var v=dg.sortBy.dt;dg.curSortBy.k=COLUMNS.SCHEDULE;dg.curSortBy.v=v;var items=[];items=items.concat(dg.items);dg.set("items",items.sort(getCubesSortFn(COLUMNS.SCHEDULE,v)));},postBuildRendering:function pbr(){var dg=this.dataGrid;if(dg.curSortBy.k===COLUMNS.SCHEDULE){$CSS.addClass(this.domNode,HIGHLIGHT_CSS_CLASS);}}},colCss:"scheStatusCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"scheStatus",bindings:{cssClass:function(){var cls=["scheStatus"],data=this.parent.data,schedStatusEnum=constants.cubeSchedStatus;switch(data.schedStatus){case schedStatusEnum.failed:cls.push("fail");break;case schedStatusEnum.successful:cls.push("success");break;case schedStatusEnum.unexecuted:cls.push("empty");break;}return cls.join(" ");},visible:function(){var subs=this.parent.data.subs;return subs&&subs.length>0;}}}}]}]});}());