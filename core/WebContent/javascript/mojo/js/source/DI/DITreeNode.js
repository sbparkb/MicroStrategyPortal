(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.TreeNode");mstrmojo.DI.DITreeNode=mstrmojo.declare(mstrmojo.TreeNode,null,{scriptClass:"mstrmojo.DI.DITreeNode",markupString:'<div id="{@id}" class="{@cssClass} mstrmojo-di-tree-node-list" style="{@cssText}" mstrAttach:mousedown><div class="mstrmojo-di-tree-node"><img border="0" class="mstrmojo-di-tree-node-icon folder-closed" src="../images/1ptrans.gif"/><span class="mstrmojo-di-tree-node-text {@textCssClass}"></span><span class="mstrmojo-di-ga-tree-node-edit-icon {@textCssClass}"></span><span class="mstrmojo-di-tree-node-desc {@textCssClass}"></span></div><ul class="mstrmojo-di-tree-node-itemsContainer">{@itemsHtml}</ul></div>',markupSlots:{listNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];},editIconNode:function(){return this.domNode.firstChild.children[2];},descNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{onstateChange:function(){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);if(this.data.desc){var d=this.data.desc;d=mstrmojo.string.multiReplace(d,{"&#10;":" "});this.descNode.innerHTML=mstrmojo.string.encodeHtmlString(d);this.descNode.title=d;}}},clickHandler:null,editHandler:null,deselect:function deselect(){if(this.listNode){this.listNode.className="mstrmojo-di-tree-node-file";}},fetched:false,iconEntity:"",iconFolderClosed:"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:"mstrmojo-di-tree-node-icon folder-open",isFolder:true,postBuildRendering:function postBuildRendering(){if(this._super){this._super();}var indent=0;var node=this;while(node&&node.parent&&node.parent.data){indent++;node=node.parent;}this.iconNode.style.marginLeft=indent*18+"px";if(this.data.isFolder){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.listNode.className="mstrmojo-di-tree-node-folder";this.editIconNode.style.display="none";}else{this.iconNode.className=this.data.iconEntity;this.listNode.className="mstrmojo-di-tree-node-file";}if(!this.data.edit){this.editIconNode.style.display="none";}},selectThisNode:function(evt){this.listNode.className="mstrmojo-di-tree-node-file selected";var node=this;while(node&&node.parent&&node.parent.data){node=node.parent;}if(node&&node.tree&&node.tree.scriptClass==="mstrmojo.DI.DITree"){node.tree.selectNode(this,evt);}this.data.clickHandler.call(this,this);},premousedown:function pmd(evt){var t=mstrmojo.dom.eventTarget(evt.hWin,evt.e);mstrmojo.dom.stopPropogation(evt.hWin,evt.e);if(t!==this.editIconNode){if(this.data.isFolder){if(this.state===0){if(this.data.fetched){this.set("state",1);}else{this.data.clickHandler.call(this,this);this.data.fetched=true;this.set("state",1);}}else{if(this.state===1){this.set("state",0);}}}else{this.selectThisNode(evt);}}else{this.data.editHandler(this);}}});}());