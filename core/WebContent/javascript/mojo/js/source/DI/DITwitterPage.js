(function(){mstrmojo.requiresCls("mstrmojo.DI.DISearchBoxPage");mstrmojo.requiresDescs(12809,12810);var constants=mstrmojo.DI.DIConstants;mstrmojo.DI.DITwitterPage=mstrmojo.declare(mstrmojo.DI.DISearchBoxPage,null,{scriptClass:"mstrmojo.DI.DITwitterPage",cssClass:"mstrmojo-di-twitter",preBuildRendering:function preBuildRendering(){if(this._super){this._super();}this.set("headerLabelText",mstrmojo.desc(12809,"Search for Tweets"));this.set("placeHolderText",mstrmojo.desc(12809,"Search for Tweets"));this.set("showOperators",true);this.set("showAdvancedOptions",false);this.set("showFetchOptions",true);this.set("noDataErrorString",mstrmojo.desc(12810,"No Tweets found, please try another search string."));this.set("iconCssClass","twitterIcon");this.previewPanel.previewType="grid";},handleDataPreview:function handleDataPreview(evt){this.searchPanel.previewTableId=evt.data;this.toggleDataPreview(true);this.searchPanel.populate(evt);this.previewPanel.populate(evt);this.adjustSize();},handleNoDataReturned:function handleNoDataReturned(){this.toggleDataPreview(false);},init:function init(props){var evtConfig,listConfig;this._super(props);evtConfig={};listConfig=evtConfig[this.id]={};listConfig[constants.dataEvents.DATA_PREVIEW_EVENT]=this.handleDataPreview;listConfig[constants.dataEvents.NO_DATA_RETURNED_EVENT]=this.handleNoDataReturned;listConfig.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},adjustSize:function adjustSize(){var width=this.searchPanel.blockNode.clientWidth;if(width>90){this.searchPanel.searchFieldNode.style.width=(width-90)+"px";}},onSearchClick:function onSearchClick(query){if(query===undefined||query===""){return ;}if(this._super){this._super(query);}var pageInfo={query:query};var controller=mstrApp.getRootController(),searchQuery="searchedTweets?q="+query+"###"+JSON.stringify(pageInfo),tableName=(query.replace(/['"]/g,"")).substr(0,8)+" Twitter",items=[],quickPreviewTable={query:searchQuery,n:tableName,max:this.searchPanel.getFetchValue().value};quickPreviewTable.tableID=this.searchPanel.previewTableId;items.push(quickPreviewTable);if(this.searchPanel.previewTableId!==""){controller.refreshDataOAuthReport(this.sourceObjectsInfo.type,constants.sourceSubtype.twitter,this.searchPanel.previewTableId,items[0],constants.actions.quickPreview);}else{controller.importMultiOAuthReports(this.sourceObjectsInfo.type,items,true,!controller.model.hasEMMAReportInstance(),constants.actions.quickPreview,constants.sourceSubtype.twitter);}},toggleFooterButtons:function toggleFooterButtons(){if(this.searchText===undefined||this.searchText===""){mstrApp.getRootController().enableFinishButton(false);}else{mstrApp.getRootController().enableFinishButton(true);}},handleSearchChange:function handleSearchChange(evt){if(this._super){this._super(evt);}this.toggleFooterButtons();},getImportTable:function getImportTable(){var searchTerm=this.searchPanel.getSearchQuery();var pageInfo={query:searchTerm};var tableName=(searchTerm.replace(/['"]/g,"")).substr(0,8)+" Twitter",searchQuery="searchedTweets?q="+searchTerm+"###"+JSON.stringify(pageInfo),max=this.searchPanel.getFetchValue().value,tableID=this.getTableId();return{query:searchQuery,tableID:tableID,n:tableName,max:max};},performAction:function performAction(action){this.searchTerm=this.searchPanel.getSearchQuery();var controller=mstrApp.getRootController(),items=[],tableID=this.getTableId();items.push(this.getImportTable());if(items[0].tableID&&!this.tableID){controller.dataService.removeEMMASourceTable(null,{did:items[0].tableID});items[0].tableID=null;}if(this.tableID!==""){if(this.searchPanel.previewTableId!==""){controller.removeSourceTable(this.searchPanel.previewTableId);}controller.refreshDataOAuthReport(this.sourceObjectsInfo.type,constants.sourceSubtype.twitter,tableID,items[0],action);}else{controller.importMultiOAuthReports(this.sourceObjectsInfo.type,items,true,!controller.model.hasEMMAReportInstance(),action,constants.sourceSubtype.twitter,this.id);}},onNextButtonClick:function(){this.performAction(this.tableID?constants.actions.refreshData:constants.actions.importSource);},onBackButtonClick:function onBackButtonClick(){var controller=mstrApp.getRootController(),items=[];items.push(this.getImportTable());if(items.length&&items[0].tableID&&!this.tableID){controller.dataService.removeEMMASourceTable(null,{did:items[0].tableID});controller.getModel().resetImportSource(items[0].tableID);items[0].tableID=null;}controller.showPage(constants.pageType.dataSelection);},onHelpButtonClick:function onHelpButtonClick(){return"Importing_data_from_Twitter.htm";},onFinishButtonClick:function(){this.performAction(constants.actions.savePublish);},onCancelButtonClick:function(){var controller=mstrApp.getRootController();if(this.searchPanel.previewTableId!==""){if(controller.dialogController!==undefined&&controller.dialogController.pageZIndex>0){controller.removeSourceTable(this.searchPanel.previewTableId);}}if(this._super){this._super();}}});}());