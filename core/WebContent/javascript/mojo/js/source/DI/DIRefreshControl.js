(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(3118,5124,12640,12641,12644,13000,13001,13002);var constants=mstrmojo.DI.DIConstants;function getCurrentSource(){var m=this.model;var source;if(this.currentSource){source=this.currentSource;}else{source=m&&m.currentSource;}return source;}function getSheetTip(source){var title=mstrmojo.desc(12640,"Sheet Name");var name="";if(source){switch(source.type){case constants.sourceType.file:title=mstrmojo.desc(12640,"Sheet Name");name=source.sourceInfo.sheetName;break;case constants.sourceType.googleDrive:case constants.sourceType.dropbox:title=mstrmojo.desc(3118,"File Name");name=source.sourceInfo.name;break;case constants.sourceType.salesforce:title=mstrmojo.desc(5124,"Report Name");name=source.sourceInfo.name;break;case constants.sourceType.googleAnalytics:title=mstrmojo.desc(5124,"Report Name");name=source.sourceInfo.name;break;}}return title+": "+name;}function hasMissingColumns(currentSource){var ret=false;if(!currentSource){return false;}var missingColumns=currentSource.getMissingColumns();if(missingColumns===null||missingColumns.length===0){ret=false;}else{ret=true;}return ret;}mstrmojo.DI.DIRefreshControl=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIRefreshControl",markupString:'<div id="{@id}" class="mstrmojo-di-refreshcontrol {@cssClass}" style="{@cssText}" ><div class="mstrmojo-di-refresh-guide"></div><div class="mstrmojo-di-refresh-info"></div></div>',markupSlots:{guideNode:function(){return this.domNode.children[0];},infoNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"guideNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refresh-guide-title",text:mstrmojo.desc(12641,"Guidelines for refreshing data:")},{slot:"guideNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refresh-guide-body",bindings:{text:function(){var type="";var source=getCurrentSource.call(this.parent);if(source){type=source.getSourceObjectType();}return"<ul><li>"+mstrmojo.desc(13000,"If you have added new columns or rows in your ## , simply re-import and analyze the lasted data without the need to create a new dashboard.").replace("##",type)+"</li></ul>";}}},{slot:"guideNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refresh-guide-body",bindings:{text:function(){var type="";var source=getCurrentSource.call(this.parent);if(source){type=source.getSourceObjectType();}return"<ul><li>"+mstrmojo.desc(13001,"Ensure that all previously uploaded columns still exist in the ##.").replace("##",type)+"</li></ul>";}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refresh-info-title",text:mstrmojo.desc(12644,"Your previously uploaded columns")},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refresh-info-sheet",bindings:{text:function(){return getSheetTip(getCurrentSource.call(this.parent));}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refresh-info-warning",postCreate:function(){var m=this.parent.model;this.updateMapping();m.attachEventListener("MappingsFetched",this.id,"updateMapping");},updateMapping:function(){this.set("visible",hasMissingColumns.call(this,this.parent.model.currentSource));var type="";var source=getCurrentSource.call(this.parent);if(source){type=source.getSourceObjectType();}var text=mstrmojo.desc(13002,"Cannot refresh data because highlighted columns are missing from the ##.").replace("##",type);this.set("text",text);}},{slot:"infoNode",scriptClass:"mstrmojo.List",cssClass:"mstrmojo-di-refresh-info-list",itemMarkup:'<div class="mstrmojo-di-refresh-info-list-item {@state}"><div class="mstrmojo-Label mstrmojo-di-refresh-info-list-item-div mstrmojo-di-refresh-info-list-item-state mstrmojo-di-datapreview-headerIcon t{@desc}">{@n}</div></div>',postCreate:function(){var m=this.parent.model;this.updateMapping();m.attachEventListener("MappingsFetched",this.id,"updateMapping");},updateMapping:function(){var col,i,maps;var cols=[];var currentSource=getCurrentSource.call(this.parent);if(currentSource&&currentSource.currentMapping){if(hasMissingColumns.call(this,this.parent.model.currentSource)){for(i=0;i<currentSource.currentMapping.length;i++){col=currentSource.currentMapping[i];if((col.columnState&constants.columnState.missing)===constants.columnState.missing&&(col.type==="amps"||col.type==="mtmps")){cols.push({n:col.n,desc:col.tp,state:"missing"});}}}else{for(i=0;i<currentSource.currentMapping.length;i++){col=currentSource.currentMapping[i];if(col.selected){cols.push({n:col.n,desc:col.tp});}}}}this.set("items",cols);}}]});}());