(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Button","mstrmojo.array");mstrmojo.requiresDescs(221,1442,13216,13217,13218,13219,13220,13221,13222,14712,14713,14714,14715);var $ARR=mstrmojo.array;function getWhiteListURL(){var editor=this,urlList=editor.urlList,controller=mstrApp.getRootController();controller.getDataService().DISetURLWhiteListTask({success:function(res){$ARR.forEach(res&&res.split(";"),function(url){url=url.trim();if(url&&url.length){urlList.addURL(url);}});},failure:function(res){controller.displayError(mstrmojo.desc(14713,"Get URL white list failed"),false,res&&res.message);}});}function doSave(){var editor=this,urlList=editor.urlList,controller=mstrApp.getRootController(),urls=urlList.urls.concat();controller.getDataService().DISetURLWhiteListTask({success:function(){editor.close();},failure:function(res){controller.displayError(mstrmojo.desc(14714,"Save URL white list failed"),false,res&&res.message);}},{sv:urls.join(";")});}mstrmojo.DI.DIWhiteListEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIWhiteListEditor",cssClass:"mstrmojo-di-DIWhiteListEditor",title:mstrmojo.desc(14712,"Set Allowed URLs"),help:"About_importing_data.htm",sourceName:"",isOneTier:false,sourceItem:null,children:[{scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",initValue:false,postBuildRendering:function(){this.emptyText=mstrmojo.desc(12812,"Supported URL format: #### ").replace("####",mstrmojo.DI.DIHelpers.getURLCaption());if(this._super){return this._super();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-add-url-button mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(531,"Add"),onclick:function(){var url=this.parent.urlInput.value;if(url.length===0){return ;}this.parent.urlList.addURL(url);this.parent.urlInput.set("value","");},visible:true},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-DIWhiteListEditor-title",text:mstrmojo.desc(14715,"List of Allowed URLs")},{scriptClass:"mstrmojo.DI.FileDragDropBox",alias:"urlList",text:"",draggable:false,fileUpload:false,cssClass:"mstrmojo-di-url-box",visible:true,getFilesCnt:function(){var cnt=0;if(this.parent.urlInput.value&&this.parent.urlInput.value!==""){cnt=this.urls?this.urls.length+1:1;}else{cnt=this.urls?this.urls.length:0;}return cnt;},getFileUrl:function(idx){if(idx<this.urls.length){return mstrmojo.string.trim(this.urls[idx]);}if(this.parent.urlInput.value!==""){return mstrmojo.string.trim(this.parent.urlInput.value);}return"";},onurlsChange:function(){if(this._super){this._super();}if(this.updateItemsCount){this.updateItemsCount(this.getURLCnt());var cnt=this.getURLCnt();this.updateItemsCount(cnt);if(cnt>1&&cnt<5){this.countNode.style.marginTop=cnt*(-33)+"px";}else{if(cnt>=5){this.countNode.style.marginTop="-140px";}}}}},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",alias:"ok",text:mstrmojo.desc(1442,"OK"),onclick:function(){doSave.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],onOpen:function onOpen(){if(this._super){this._super();}getWhiteListURL.call(this);},onClose:function onClose(){if(this._super){this._super();}mstrmojo.css.removeClass(this.sourceItem.domNode,"selected");this.destroy();}});}());