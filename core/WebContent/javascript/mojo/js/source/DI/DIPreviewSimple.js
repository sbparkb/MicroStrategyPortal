(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIPreviewSimpleGrid","mstrmojo.DI.DIFacebookPageItem");var constants=mstrmojo.DI.DIConstants,GRID_PREVIEW="grid",LIST_PREVIEW="list",TABLE_PREVIEW="table",sourceType=mstrmojo.DI.DIConstants.sourceType,sourceItem=mstrmojo.DI.DIFacebookPageItem;mstrmojo.DI.DIPreviewSimple=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPreviewSimple",cssClass:"mstrmojo-di-dataPreviewSimple",previewType:GRID_PREVIEW,markupString:'<div id="{@id}" class ="mstrmojo-DI-previewSlot {@previewType}"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{mappings:function(){return this.domNode;}},getListItems:function(results){var rawResults=results.mi.ca.value;var items=[],index,page;for(index in rawResults){page=rawResults[index];items.push({n:page.n,d:page.cat,id:page.auto_id,pg_id:page.id,picUrl:page.picurl,likes:this.addCommas(page.likes),whCount:page.whCount,taCount:page.taCount});}return items;},addCommas:function addCommas(nStr){nStr+="";var x=nStr.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"",rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1,$2");}return x1+x2;},getTableItems:function(results,advProps){var items=[],index,sourcePage=this.content,page;if(results.mi.ca.value.length===undefined){page=results.mi.ca.value;items.push({scriptClass:"mstrmojo.DI.DIFacebookPageItem",n:page.n,desc:page.cat,pg_id:page.id,picUrl:page.picurl,likes:this.addCommas(page.likes),link:page.link,slot:"0,0",source:sourcePage,advancedProperties:advProps});}else{var rawResults=results.mi.ca.value;for(index in rawResults){page=rawResults[index];var auto_id=index,itemSlot,xIndex,yIndex;if(auto_id%3===0){xIndex=auto_id/3;yIndex=0;}else{xIndex=Math.floor(auto_id/3);yIndex=yIndex+1;}itemSlot=xIndex+","+yIndex;items.push({scriptClass:"mstrmojo.DI.DIFacebookPageItem",n:page.n,desc:page.cat,pg_id:page.id,picUrl:page.picurl,likes:this.addCommas(page.likes),link:page.link,slot:itemSlot,source:sourcePage,advancedProperties:advProps});}}return items;},populate:function populate(evt){if(this.previewType===GRID_PREVIEW){this.content.populate(evt);}else{var results=mstrApp.getRootController().model.externalSources[sourceType.facebook].reports;if(this.previewType===LIST_PREVIEW){this.content.set("items",this.getListItems(results));this.content.set("selectedIndex",0);}else{if(this.previewType===TABLE_PREVIEW){if(this.content.children){this.content.children=[];}this.content.addChildren(this.getTableItems(results,this.parent.advancedProperties));this.content.refresh();}}}},toggleDataPreview:function toggleDataPreview(show){this.parent.toggleDataPreview(show);},preBuildRendering:function preBuildRendering(){if(this._super){this._super();}var controller=mstrApp.getRootController(),m=controller.model;if(this.previewType===GRID_PREVIEW){this.set("class","mstrmojo-DI-previewSlot grid");this.addChildren({scriptClass:"mstrmojo.DI.DIPreviewSimpleGrid",alias:"content",slot:"mappings",columns:[],cssText:"height:100%;"});}else{if(this.previewType===LIST_PREVIEW){this.set("class","mstrmojo-DI-previewSlot list");this.addChildren({scriptClass:"mstrmojo.List",cssText:"background-color: 0xffffff; overflow-x: hidden; overflow-y: auto; width: 100%",onchange:function(){var elem=document.getElementById("mstrmojo-DI-FBList-row"+this.selectedIndex);mstrmojo.css.toggleClass(elem,"selected",true);},itemMarkupFunction:function(item,index){var c1=" class = mstrmojo-DI-FBList-row",url=item.picUrl,c2="",id=' id="mstrmojo-DI-FBList-row'+index+'"',entry='<p style= "margin:0px; font-size:10pt;">';return"<div"+c1+'><table cellpadding="0" cellspacing="0" style="width: 100%; padding-left: 10px"><tr'+id+'class = "mstrmojo-DI-FBList-row"><td style="vertical-align: middle; width: 20%;"><img src='+url+'> </td><td style="vertical-align: middle; width: 40%;">'+item.n+"</td><td"+c2+' style="vertical-align: middle; width: 40%;">'+entry+item.d+"</p>"+entry+"Likes: "+item.likes+"</p></td></tr></table></div>";},slot:"mappings",alias:"content"});}else{if(this.previewType===TABLE_PREVIEW){this.set("class","mstrmojo-DI-previewSlot table");this.addChildren({scriptClass:"mstrmojo.Table",slot:"mappings",alias:"content",cssClass:"mstrmojo-di-facebook-previewTable",bindings:{rows:function(){return 20;}},cols:3,selectedItem:undefined,handleSelectionChange:function handleSelectionChange(newSelectionItem){var previousSelection=this.selectedItem;if(previousSelection){previousSelection.setUnSelectedItem();}newSelectionItem.setSelectedItem();this.selectedItem=newSelectionItem;mstrApp.getRootController().sourceSelected(true);}});}}}},children:[]});}());