(function(){mstrmojo.requiresCls("mstrmojo.android.controllers.ViewController","mstrmojo.android.SimpleList","mstrmojo.android.EnumMenuOptions","mstrmojo.android.ui.Button","mstrmojo.hash","mstrmojo.array","mstrmojo.string","mstrmojo.num","mstrmojo.android.nativedialog.ListDialog");mstrmojo.requiresDescs(11,16,17,18,37,187,295,629,702,784,844,845,874,1088,1142,1563,1900,1905,2411,2461,2822,3157,4253,5191,6560,7227,7559,7561,7778,7779,7831,7840,8027,8360,8361,8362,8363,8364,8365,8366,8367,8368,8369,8370,8371,8372,8373,8374,8375,8376,8377,8378,8379,8390,8441,8447,8455,8456,8457,8458,8459,8489,8633,8634,8635,8760,9446,9447,9448,9449,9450,9451,9452,9456,9457,9458,9459,9460,9464,9465,9466,9467,9468,9469,9470,9471,9481,9790,9791,9792,9793,9794,9795,9796,9797,9807);var $ARR=mstrmojo.array,$HASH=mstrmojo.hash,$BTN=mstrmojo.android.ui.Button.newButton,$DESC=mstrmojo.desc,MENUS=mstrmojo.android.EnumMenuOptions,MENU_DELETE=MENUS.DELETE,MENU_ADD_SERVER=MENUS.ADD_SERVER,MENU_ADD_PROJECT=MENUS.ADD_PROJECT,MENU_ABOUT=MENUS.ABOUT,legalText;var STYLE_HEADER=1,STYLE_BUTTON=2,STYLE_VIEW_BUTTON=3,STYLE_TEXT=4,STYLE_LIST=5,STYLE_CHECK=6,STYLE_IMAGE=7,STYLE_TEXT_AREA=8,STYLE_NUMBER=9,STYLE_TIME=10;var TYPE_HOME=1,TYPE_SERVERS=2,TYPE_EDIT_SERVER=3,TYPE_SERVER_CREDS=4,TYPE_EDIT_PROJECT=5,TYPE_PROJECT_CREDS=6,TYPE_GENERAL=7,TYPE_ABOUT=8,TYPE_LEGAL=10,TYPE_CERT=12,TYPE_CERT_AUTH=12,TYPE_TRUSTED_CERTS=13;var DELETE_TXT={};DELETE_TXT[TYPE_EDIT_SERVER]=5191;DELETE_TXT[TYPE_EDIT_PROJECT]=11;var ADD_TXT={};ADD_TXT[TYPE_SERVERS]=5191;ADD_TXT[TYPE_EDIT_SERVER]=11;var MEMORY_LIMIT_LIST=[{v:25,n:"25MB"},{v:50,n:"50MB"},{v:100,n:"100MB"},{v:250,n:"250MB"},{v:500,n:"500MB"},{v:1024,n:"1GB"},{v:2048,n:"2GB"},{v:3072,n:"3GB"},{v:4096,n:"4GB"}];function getHourString(v){return $DESC(9797,"Every ## hours").replace("##",v);}var UPDATE_INTERVAL=[{v:1,n:$DESC(9796,"Every hour")},{v:2,n:getHourString(2)},{v:4,n:getHourString(4)},{v:10,n:getHourString(10)},{v:24,n:getHourString(24)}];var MODIFIED_ITEMS={};function getNewServerNode(){return{nm:"",po:80,pt:"MicroStrategyMobile",ty:1,rt:0,udc:true,wsc:{am:1,lo:"",ps:""},pdc:{am:1,lo:"",ps:""},pl:[],isNew:true};}function getNewProjectNode(){return{pc:{am:0,lo:"",ps:""},pn:"",sn:"",sp:0,udc:false,isNew:true};}function updateView(viewInfo,items){if(items){viewInfo.items=items;}else{items=viewInfo.items;}var view=this.view.getList(viewInfo.cfg.isHome),rootCtrl=this.rootCtrl;view.restoreListState(viewInfo.idx,viewInfo.origin);view.items=items;view.refresh();if(mstrApp.isTablet()&&viewInfo.cfg.isHome){if(!viewInfo.idx){view.singleSelect(0);}}rootCtrl.updateContent(null,(mstrApp.isTablet())?$DESC(7831,"Settings"):viewInfo.title);rootCtrl.contentUpdated("Settings");this.generateActionToolbar();}function generateView(fnView,item){var viewInfo=fnView.call(this,item);this.view.getList(viewInfo.cfg.isHome).resetListState();viewInfo.cfg.fnRedraw=fnView;this._viewInfos.push(viewInfo);updateView.call(this,viewInfo);}function getLastViewInfo(){var views=this._viewInfos;return views[views.length-1];}function getCurrentConfig(){var viewInfo=getLastViewInfo.call(this);return viewInfo&&viewInfo.cfg;}function cacheViewState(idx){var lastViewInfo=getLastViewInfo.call(this);lastViewInfo.idx=idx;lastViewInfo.origin=this.view.getList(lastViewInfo.cfg.isHome).getScrollPos();}function showCurrentView(){var current=getLastViewInfo.call(this),cfg=current.cfg;updateView.call(this,current,cfg.fnRedraw.call(this,cfg.item).items);this.view.getList(cfg.isHome).restoreListState(current.idx,current.origin);}function confirmDelete(itemName,fnOk){mstrmojo.confirm($DESC(8390,"Are you sure you want to delete #?").replace("#",itemName),[$BTN($DESC(221,"Cancel")),$BTN($DESC(1442,"OK"),fnOk)]);}function deleteItem(item){var me=this;confirmDelete(item.nm,function(){var mobileConfig=me.mobileConfigObj,cfg=getCurrentConfig.call(me),servers=mobileConfig.getWebServersList(),collection=(cfg.type===TYPE_SERVERS)?servers:servers[cfg.idx].pl;collection.splice(item.idx,1);me.view.getList(cfg.isHome).set("items",cfg.fnRedraw.call(me,cfg.item).items);me.mobileConfigObj.reconcileHomescreen();me.mobileConfigObj.saveConfiguration();me.connectivityChanged=true;});}function showPopup(item){var controller=this,dialog,dialogConfig;var dialogConfig={title:item.nm,cssClass:"mstrmojo-SimpleOptions",children:[{scriptClass:"mstrmojo.android.SimpleList",isElastic:true,items:[{n:$DESC(1088,"Edit"),v:1},{n:$DESC(629,"Delete"),v:2}],postselectionChange:function(evt){dialog.close();if(this.items[evt.added[0]].v===1){item.fn();}else{deleteItem.call(controller,item);}}}]};if(mstrApp.useBinaryFormat){$HASH.copy({isNative:true,scriptClass:"mstrmojo.android.nativedialog.ListDialog",choiceMode:mstrmojo.android.nativedialog.ListDialog.CHOICE_MODES.NONE,onSelectionChange:function(index){if(index===0){item.fn();}else{deleteItem.call(controller,item);}this.close();}},dialogConfig);}dialog=mstrApp.showDialog(dialogConfig);}function convertListToItems(list){var rtn=[],x=-1;$ARR.forEach(list,function(n,idx){if(n){rtn[++x]={n:n,v:idx};}});return rtn;}function editItem(item,value,node){var cfg=getCurrentConfig.call(this),type=cfg.type,path=item.pt.split("."),prop=path.pop(),mobileConfig=this.mobileConfigObj,servers=mobileConfig.getWebServersList();switch(type){case TYPE_EDIT_SERVER:node=servers[cfg.idx];if(!node){node=getNewServerNode();servers.push(node);this.connectivityChanged=true;}break;case TYPE_EDIT_PROJECT:var serverNode=servers[cfg.parent.idx],projects=serverNode.pl||[];node=projects[cfg.idx];if(!node){node=getNewProjectNode();this.mobileConfigObj.setPid(node);projects.push(node);this.connectivityChanged=true;}break;case TYPE_GENERAL:node=mobileConfig.getGeneralSettings();if(prop==="am"||prop==="lo"||prop==="ps"){node=mobileConfig.getDefaultServerCreds();}else{if(prop==="ebs"||prop==="tod"||prop==="ui"||prop==="wo"||prop==="co"){node=mobileConfig.getBackgroundSyncSettings();}}break;case TYPE_CERT:case TYPE_CERT_AUTH:case TYPE_TRUSTED_CERTS:break;default:throw new Error("AndroidSettingsController::editItem -- Unhandled edit action.");}if(path.length){node=$HASH.walk(path.join("."),node);}var oldValue=node[prop];if(oldValue!==value){node[prop]=value;item.v=value;var mods=MODIFIED_ITEMS[type]||{};mods[item.pt.replace(".","@")]=item;MODIFIED_ITEMS[type]=mods;$ARR.forEach(item.dependents,function(dependentItem){$ARR.forEach(["Hidden","Disabled"],function(prop){var fnDependent=dependentItem["fn"+prop];if(fnDependent){dependentItem[prop.toLowerCase()]=fnDependent(value);}});});if(prop==="lo"||prop==="ps"){node.um=true;}}}function newImage(props){return $HASH.copy(props,{nm:"",style:STYLE_IMAGE});}function newHeader(text,props){return $HASH.copy(props,{nm:text,style:STYLE_HEADER});}function newItem(title,value,style,props){return $HASH.copy(props,{nm:title,v:value,style:style});}function newBtnItem(title,value,fnClick,props){var controller=this;return newItem(title,value,STYLE_BUTTON,$HASH.copy({fn:function(){fnClick.call(controller);}},props));}function newViewItem(title,value,fnView,props){var controller=this;return newItem(title,value,STYLE_VIEW_BUTTON,$HASH.copy({fn:function(){cacheViewState.call(controller,this._renderIdx);generateView.call(controller,fnView,this);}},props));}function newEditItem(title,style,node,path,props){var controller=this;return newItem(title,$HASH.walk(path,node),style,$HASH.copy({pt:path,fn:function(value){editItem.call(controller,this,value,node);}},props));}function newListItem(title,node,path,items,props){return newEditItem.call(this,title,STYLE_LIST,node,path,$HASH.copy({items:items},props));}function newCheckItem(title,description,node,path,on,off,props){return newEditItem.call(this,title,STYLE_CHECK,node,path,$HASH.copy({desc:description,on:on,off:off},props));}function ellipsizeHeaderText(text,ellipsize){return ellipsize?mstrmojo.string.ellipsize(text,20):text;}function addTabletHeader(items,title,ellipsize){if(mstrApp.isTablet()){var headerTitle=[];$ARR.forEach(this._viewInfos,function(info,idx){if(idx&&info.title!==title){headerTitle.push('<div hidx="'+idx+'">'+ellipsizeHeaderText(info.title,(idx>1&&ellipsize))+"</div>");}});headerTitle.push("<em>"+ellipsizeHeaderText(title,ellipsize)+"</em>");items=[newHeader(headerTitle.join(""),{cls:"tablet-header"})].concat(items);}return items;}function validateServerChanges(cfg,mods){var servers=this.mobileConfigObj.getWebServersList(),server=servers[cfg.idx],serverCreds=server.wsc,serverAuth=serverCreds.am,projects=server.pl,isNewServer=server.isNew;if(isNewServer&&!mods.nm){servers.splice(cfg.idx,1);return false;}delete server.isNew;if(mods.nm||mods.po||mods.pt||mods.ty){$ARR.forEach(projects,function(project){mstrApp.removeProjectCaches(project);});}else{if(mods["wsc@lo"]&&(mods["wsc@am"]||(serverAuth===2||serverAuth===3))){var projectDefaultAuth=server.pdc.am;$ARR.forEach(projects,function(project){var projectAuth=(project.udc)?projectDefaultAuth:project.pc.am;if(projectAuth===2||projectAuth===64){mstrApp.removeProjectCaches(project);}});}}server.udc=(!serverAuth);if(!serverAuth){serverCreds.lo="";serverCreds.ps="";}this.mobileConfigObj.setWebServerList(servers);return(isNewServer||!!mods.nm);}function validateProjectChanges(cfg,mods){var servers=this.mobileConfigObj.getWebServersList(),projects=servers[cfg.parent.idx].pl,project=projects[cfg.idx],projectCreds=project.pc,projectAuth=projectCreds.am,isNewProject=project.isNew;if(isNewProject&&(!mods.pn||!mods.sn)){projects.splice(cfg.idx,1);return false;}delete project.isNew;if(!isNewProject&&(mods.pn||mods.sn||mods["pc@am"]||(projectAuth>0&&mods.lo))){mstrApp.removeProjectCaches(project.pid);this.mobileConfigObj.setPid(project);this.connectivityChanged=true;}project.udc=(!projectAuth);if(!projectAuth){projectCreds.lo="";projectCreds.ps="";}return(isNewProject||!!mods.pn||!!mods.sn);}function validateGeneralSettingsChanges(cfg,mods){var mobileConfig=this.mobileConfigObj,creds=mobileConfig.getDefaultServerCreds(),isAnonymousMode=(creds.am===1);if(mods.am||(mods.lo&&!isAnonymousMode)){$ARR.forEach(mobileConfig.getWebServersList(),function(server){if(server.udc){var defaultProjAuth=server.pdc.am;$ARR.forEach(server.pl,function(project){var projAuthMode=(project.udc)?defaultProjAuth:project.pc.am;if(projAuthMode===2||projAuthMode===64){mstrApp.removeProjectCaches(project.pid);}});}});}if(isAnonymousMode){creds.lo="";creds.ps="";}return false;}function newAuthenticationItems(type,node){var path="",fnDisabled=mstrmojo.emptyFn,items;if(type===TYPE_EDIT_SERVER||type===TYPE_SERVER_CREDS){items=convertListToItems([$DESC(8441,"Default"),$DESC(7778,"Anonymous"),$DESC(7227,"Basic"),$DESC(7779,"Windows"),$DESC(8027,"Trusted")]);if(type===TYPE_EDIT_SERVER){path="wsc";}fnDisabled=function(v){return(v<2||v===64);};if((type!==TYPE_SERVER_CREDS)&&node.udc){node[path].am=0;}}else{items=[{n:$DESC(8441,"Default"),v:0},{n:$DESC(3157,"Standard"),v:1},{n:$DESC(7779,"Windows"),v:2},{n:"LDAP",v:16},{n:$DESC(1563,"Database"),v:32},{n:mstrmojo.desc(8027,"Trusted"),v:64}];path=(type===TYPE_PROJECT_CREDS)?"pdc":"pc";fnDisabled=function(v){return(!v||parseInt(v,10)===2||parseInt(v,10)===64);};if((type!==TYPE_PROJECT_CREDS)&&node.udc){node[path].am=0;}}if(type===TYPE_SERVER_CREDS||type===TYPE_PROJECT_CREDS){items.shift();}path=(path&&path+".")||"";var rtn=[];if(!this.mobileConfigObj.getGeneralSettings().npc){var cfgLogin={disabled:fnDisabled($HASH.walk(path+"am",node)),fnDisabled:fnDisabled},userName=newEditItem.call(this,$DESC(17,"User Name"),STYLE_TEXT,node,path+"lo",cfgLogin),pwd=newEditItem.call(this,$DESC(18,"Password"),STYLE_TEXT,node,path+"ps",$HASH.copy(cfgLogin,{pwd:true}));rtn.push(newListItem.call(this,$DESC(2822,"Authentication"),node,path+"am",items,{dependents:[userName,pwd]}));rtn.push(userName);rtn.push(pwd);}else{rtn.push(newListItem.call(this,$DESC(2822,"Authentication"),node,path+"am",items));}return rtn;}function getEditProjectView(item){var idx=item.idx,settingsCfg=getCurrentConfig.call(this),server=this.mobileConfigObj.getWebServersList()[settingsCfg.idx]||getNewServerNode(),project=server.pl[idx]||getNewProjectNode(),items=[];items.push(newEditItem.call(this,$DESC(11,"Project"),STYLE_TEXT,project,"pn",{showHint:true}));items.push(newEditItem.call(this,$DESC(5191,"Server"),STYLE_TEXT,project,"sn",{showHint:true}));items=items.concat(newAuthenticationItems.call(this,TYPE_EDIT_PROJECT,project));return{title:item.nm,items:addTabletHeader.call(this,items,item.nm,true),cfg:{type:TYPE_EDIT_PROJECT,item:item,idx:idx,parent:settingsCfg,fnVal:validateProjectChanges}};}function getEditServerView(item){var controller=this,serverIndex=item.idx,server=this.mobileConfigObj.getWebServersList()[serverIndex]||getNewServerNode(),projects=server.pl||[],items=[];server.pl=projects;items.push(newEditItem.call(this,$DESC(7559,"Name"),STYLE_TEXT,server,"nm",{showHint:true}));items.push(newEditItem.call(this,$DESC(16,"Port"),STYLE_NUMBER,server,"po",{limits:{min:0,max:65535}}));items.push(newEditItem.call(this,$DESC(8489,"Path"),STYLE_TEXT,server,"pt"));items.push(newListItem.call(this,$DESC(8362,"Web server type"),server,"ty",convertListToItems(["J2EE","ASP.Net"])));items.push(newCheckItem.call(this,$DESC(8363,"Secure HTTP"),$DESC(9449,"Use HTTPS to access the mobile server"),server,"rt",1,0));items=items.concat(newAuthenticationItems.call(this,TYPE_EDIT_SERVER,server));items.push(newHeader($DESC(8364,"Default Project Credentials")));items=items.concat(newAuthenticationItems.call(this,TYPE_PROJECT_CREDS,server));items.push(newHeader($DESC(37,"Projects")));$ARR.forEach(projects,function(project,idx){items.push(newViewItem.call(controller,project.pn,project.sn,getEditProjectView,{idx:idx,fnPress:showPopup}));});return{title:item.nm,items:addTabletHeader.call(this,items,item.nm,true),cfg:{type:TYPE_EDIT_SERVER,item:item,idx:serverIndex,parent:getCurrentConfig.call(this),fnVal:validateServerChanges}};}function getLegalView(){var items=[],title=$DESC(8365,"Legal");if(!legalText){legalText="<p>"+$DESC(8633)+"</p><p>"+$DESC(8634)+"</p><p>"+$DESC(8635)+"</p>";}items.push(newItem(legalText,"",STYLE_TEXT_AREA,{noclick:true}));return{title:title,items:addTabletHeader.call(this,items,title),cfg:{type:TYPE_LEGAL}};}function getAboutView(){var items=[],title=mstrApp.isTablet()?$DESC(1142,"About"):$DESC(9457,"About #").replace("#","MicroStrategy");items.push(newImage.call(this,{noclick:true,cls:"mstr-logo"}));items.push(newItem.call(this,"MicroStrategy Mobile 9.4.1",$DESC(8366,"Build Number #").replace("#",mstrMobileApp.getAppVersion()),STYLE_BUTTON,{cls:"build-info",noclick:true}));items.push(newHeader($DESC(9456,"More Information"),{cls:"more-info"}));items.push(newViewItem.call(this,$DESC(8365,"Legal"),$DESC(9460,"Copyright disclosure"),getLegalView));items.push(newBtnItem.call(this,$DESC(9458,"Get in touch"),$DESC(9459,"Send us an email with your feedback, suggestions and appreciation!"),function(){var bodyMsg=[$DESC(9465,"I was looking through the MicroStrategy Mobile Android App. Please contact me with details on how I can:")];bodyMsg.push($DESC(9466," - Find out how I can use MicroStrategy Apps to drive my business."));bodyMsg.push($DESC(9467," - Have apps, based on my workflow, specifications and design, in two weeks."));bodyMsg.push($DESC(9468," - How I can partner with MicroStrategy for all my Mobile solutions."));bodyMsg.push($DESC(9469," - Attend a free, hands-on, class to teach developers how to build and maintain Mobile Business Apps."));bodyMsg.push("");bodyMsg.push($DESC(9470,"Thank you."));mstrMobileApp.sendEmail("info@microstrategy.com",$DESC(9464,"Request information about MicroStrategy Mobile"),bodyMsg.join("\r\n"),"");}));return{title:title,items:addTabletHeader.call(this,items,title),cfg:{type:TYPE_ABOUT}};}function getBackgroundSyncingItems(){var settings=this.mobileConfigObj.getBackgroundSyncSettings(),fnDisabled=function(v){return(!v||v===false);},depProps={disabled:fnDisabled($HASH.walk("ebs",settings)),fnDisabled:fnDisabled},timeOfDay=newEditItem.call(this,$DESC(9807,"Time of day"),STYLE_TIME,settings,"tod"),updateInterval=newListItem.call(this,$DESC(9792,"Update interval"),settings,"ui",UPDATE_INTERVAL,$HASH.copy(depProps,{dependents:[timeOfDay]})),wifi=newCheckItem.call(this,$DESC(9793,"Only over Wi-Fi"),null,settings,"wo",true,false,depProps),charge=newCheckItem.call(this,$DESC(9794,"Only if charging"),null,settings,"co",true,false,depProps),enable=newCheckItem.call(this,$DESC(9795,"Enable background syncing"),null,settings,"ebs",true,false,{dependents:[updateInterval,timeOfDay,wifi,charge,timeOfDay]}),items=[];items.push(enable);items.push(updateInterval);items.push(timeOfDay);items.push(wifi);items.push(charge);timeOfDay.disabled=updateInterval.disabled||(updateInterval.v!==24);timeOfDay.fnDisabled=function(){return(enable.v!==true)||(updateInterval.v!==24);};return items;}function deleteCertificate(item){var controller=this;confirmDelete(item.nm,function(){mstrApp.showMessage("Deleting...");window.setTimeout(function(){var cfg=getCurrentConfig.call(controller);mstrMobileApp.deleteCertificate();item.hidden=!mstrMobileApp.hasCertificate();$ARR.forEach(item.dependents,function(d){d.hidden=!item.hidden;});controller.view.getList(cfg.isHome).set("items",cfg.fnRedraw.call(controller,cfg.item).items);mstrApp.hideMessage();},100);});}function showPopupDeleteCertificate(item){var controller=this,dialog;dialog=mstrApp.showDialog({title:item.nm,cssClass:"mstrmojo-SimpleOptions",children:[{scriptClass:"mstrmojo.android.SimpleList",isElastic:true,items:[{n:$DESC(1900,"View"),v:1},{n:$DESC(629,"Delete"),v:2}],postselectionChange:function(evt){dialog.close();if(this.items[evt.added[0]].v===1){item.fn();}else{if(this.items[evt.added[0]].v===2){deleteCertificate.call(controller,item);}}}}]});}function getCertificateDetailsView(item){var detailsStr=mstrMobileApp.getCertificateDetails(),details=eval("("+detailsStr+")"),items=[],result="",i;if(details.prs){for(i=0;i<details.prs.pr.length;++i){var pr=details.prs.pr[i];var name;if(pr.n==="edat"){name=$DESC(8457,"Expiration");}else{if(pr.n==="issr_n"){name=$DESC(8458,"Issuer");}else{name=pr.n;}}result+=name+": "+pr.v+"<br/>";}items.push(newItem.call(this,result,"",STYLE_TEXT_AREA,{disabled:true}));return{title:item.nm,items:addTabletHeader.call(this,items,item.nm),cfg:{type:TYPE_CERT,item:item}};}throw details.message||"No certificate details available";}function getTrustedCertificatesView(item){var result=mstrMobileApp.getTrustedCertificates(),jsonResult=eval("("+result+")"),items=[],i;if(jsonResult&&jsonResult.certs){for(i=0;i<jsonResult.certs.length;++i){var cert=jsonResult.certs[i].dsc;items.push(newItem(cert,"",STYLE_TEXT_AREA,{disabled:true}));}}return{title:item.nm,items:addTabletHeader.call(this,items,item.nm),cfg:{type:TYPE_TRUSTED_CERTS,item:item}};}function getCertificateAuthenticationFieldsView(item){var result=mstrMobileApp.getCertificateAuthenticationFields(),jsonResult=eval("("+result+")"),items=[],controller=this,i=0;if(jsonResult.login_info){var settings={},loginInfoField=jsonResult.login_info.field;for(i=0;i<loginInfoField.length;++i){var field=loginInfoField[i],cfgAuth={};settings[field.n]="";if(!!field.pass){cfgAuth=$HASH.copy(cfgAuth,{pwd:true});}items.push(newEditItem.call(this,field.dn,((field.tp==="numeric")?STYLE_NUMBER:STYLE_TEXT),settings,field.n,cfgAuth));}items.push(newItem.call(this,"Submit","",STYLE_BUTTON,{fn:function(){mstrApp.showMessage();window.setTimeout(function(){var responseStr=mstrMobileApp.getNewCertificate(JSON.stringify(settings));mstrApp.hideMessage();var response=eval("("+responseStr+")"),message=response.message;if(message){window.alert(response.message);}else{window.alert("Certificate obtained");if(item&&item.nm==="Get Certificate"){item.hidden=mstrMobileApp.hasCertificate();$ARR.forEach(item.dependents,function(d){d.hidden=!d.hidden;});}mstrApp.goBack();}},100);}}));var title=jsonResult.login_info.msg;return{title:title,items:addTabletHeader.call(this,items,title),cfg:{type:TYPE_CERT_AUTH,item:item}};}throw new Error(jsonResult.message);}function getGeneralSettingsView(item){var mobileConfig=this.mobileConfigObj,generalSettings=mobileConfig.getGeneralSettings(),items=[];items.push(newEditItem.call(this,$DESC(8367,"Network Timeout (seconds)"),STYLE_NUMBER,generalSettings,"nt",{limits:{min:0,max:9999}}));items.push(newEditItem.call(this,$DESC(7840,"Maximum Columns in Grid"),STYLE_NUMBER,generalSettings,"mgc",{limits:{min:0,max:9999}}));if(generalSettings.usd){var diagnosticMode=newCheckItem.call(this,$DESC(8760,"Diagnostic Mode"),$DESC(9450,"Store a log file in the device"),{b:mobileConfig.getDiagnosticMode()},"b",true,false);diagnosticMode.fn=function(value){mobileConfig.setDiagnosticMode(value);this.v=value;};items.push(diagnosticMode);}var monitor=newCheckItem.call(this,$DESC(9471,"Monitor Network Status"),$DESC(9790,"Notify the user when connection quality is below optimal"),generalSettings,"mns",true,false);var fn=function(value){mstrMobileApp.setNetworkMonitoringEnabled(value);};monitor.fn=mstrmojo.func.composite([fn,monitor.fn]);if(generalSettings.mns===undefined){monitor.v=true;}items.push(monitor);items.push(newHeader($DESC(8361,"Mobile Server Default")));items=items.concat(newAuthenticationItems.call(this,TYPE_SERVER_CREDS,this.mobileConfigObj.getDefaultServerCreds()));if(generalSettings.usc){items.push(newHeader($DESC(8368,"Caching")));items.push(newListItem.call(this,$DESC(8369,"Memory limit"),generalSettings,"ml",MEMORY_LIMIT_LIST));items.push(newCheckItem.call(this,$DESC(8370,"Folder caching"),$DESC(9451,"Store folders information for offline analysis"),generalSettings,"fc",true,false));items.push(newCheckItem.call(this,$DESC(8371,"Clear cache when closed"),$DESC(9452,"Delete reports and documents information after exiting the app"),generalSettings,"cc",2,1));}items.push(newHeader($DESC(8459,"Certificates")));if(generalSettings.ucs!==undefined&&generalSettings.ucs!==""&&generalSettings.ucs){var hasCert=mstrMobileApp.hasCertificate(),certItem,getCertItem;certItem=newViewItem.call(this,"Device Certificate","",getCertificateDetailsView,{fnPress:showPopupDeleteCertificate,hidden:!hasCert});getCertItem=newViewItem.call(this,"Get Certificate","",getCertificateAuthenticationFieldsView,{hidden:hasCert,dependents:[certItem]});certItem.dependents=[getCertItem];items.push(certItem);items.push(getCertItem);}items.push(newViewItem.call(this,$DESC(8447,"Trusted Certificates"),"",getTrustedCertificatesView,{hidden:false}));if(mstrMobileApp.isDPCEnabled()){items.push(newHeader($DESC(9481,"Device Passcode")));items.push(newItem.call(this,$DESC(1905,"Reset"),"",STYLE_BUTTON,{fn:function(){mstrMobileApp.resetDPC();}}));}items.push(newHeader($DESC(9791,"Background Syncing")));items=items.concat(getBackgroundSyncingItems.call(this));return{title:item.nm,items:addTabletHeader.call(this,items,item.nm),cfg:{type:TYPE_GENERAL,fnVal:validateGeneralSettingsChanges,item:item}};}function getMobileServersView(item){var config=this.mobileConfigObj,servers=config.getWebServersList(),items=[];$ARR.forEach(servers,function(server,idx){items.push(newViewItem.call(this,server.nm,"",getEditServerView,{idx:idx,fnPress:showPopup}));},this);return{title:item.nm,items:addTabletHeader.call(this,items,item.nm),cfg:{type:TYPE_SERVERS,item:item}};}function getHomeSettingsView(){var items=[newViewItem.call(this,$DESC(6560,"General Settings"),"",getGeneralSettingsView),newViewItem.call(this,$DESC(8375,"Mobile Servers"),"",getMobileServersView)];if(mstrApp.isTablet()){items.push(newViewItem.call(this,$DESC(1142,"About"),"",getAboutView));}return{title:$DESC(7831,"Settings"),items:items,cfg:{type:TYPE_HOME,isHome:true}};}function saveChanges(cfg,doSave){var type=cfg.type,modifications=MODIFIED_ITEMS[cfg.type];if(modifications){var fnValidate=cfg.fnVal;if(fnValidate){fnValidate.call(this,cfg,modifications);}if(doSave){this.mobileConfigObj.saveConfiguration();}delete MODIFIED_ITEMS[type];}}var $CTRL=mstrmojo.android.controllers.SettingsController=mstrmojo.declare(mstrmojo.android.controllers.ViewController,null,{scriptClass:"mstrmojo.android.controllers.SettingsController",connectivityChanged:false,init:function(props){this._super(props);this.mobileConfigObj=this.mobileConfigObj||mstrApp.getConfiguration();},start:function(params){var viewFn=params.viewFn;this._super(params);mstrApp.cancelPending();this._viewInfos=[];var view=this.view=this.newView("Settings");this.rootCtrl.updateContent(view,$DESC(7831,"Settings"));generateView.call(this,(viewFn&&eval("("+viewFn+")"))||getHomeSettingsView);},getDefaultMenus:function getDefaultMenus(){return MENUS.HELP;},updateActionToolbar:function updateActionToolbar(tbCfg){var cfg=getCurrentConfig.call(this),cfgType=cfg&&cfg.type,deleteDescId=DELETE_TXT[cfgType],addDescId=ADD_TXT[cfgType];if(addDescId){var menuId=MENU_ADD_SERVER,iconId=19;if(cfgType===TYPE_EDIT_SERVER){menuId=MENU_ADD_PROJECT;iconId=20;}tbCfg.addToolbarBtn(menuId,$DESC(9446,"Add #").replace("#",$DESC(addDescId,"Item")),menuId,true,iconId);}if(deleteDescId){tbCfg.addMenuItem(MENU_DELETE,$DESC(8379,"Delete #").replace("#",$DESC(deleteDescId,"Item")),MENU_DELETE,true,16);}if(!mstrApp.isTablet()&&cfgType!==TYPE_ABOUT&&cfgType!==TYPE_LEGAL){tbCfg.addMenuItem(MENU_ABOUT,$DESC(1142,"About"),MENU_ABOUT,true,21);}return this._super(tbCfg);},handleMenuItem:function handleMenuItem(group,cmdId){var cfg=getCurrentConfig.call(this),type=cfg.type,servers=this.mobileConfigObj.getWebServersList(),isServer=(type===TYPE_EDIT_SERVER);switch(group){case MENU_ABOUT:cacheViewState.call(this,-1);generateView.call(this,getAboutView);break;case MENU_ADD_SERVER:case MENU_ADD_PROJECT:cacheViewState.call(this,-1);if(group===MENU_ADD_SERVER){generateView.call(this,getEditServerView,{nm:$DESC(9447,"New Server"),idx:servers.length});}else{var server=servers[cfg.item.idx];generateView.call(this,getEditProjectView,{nm:$DESC(9448,"New Project"),idx:(server&&server.pl.length)||0});}break;case MENU_DELETE:var collection;if(isServer){collection=servers;}else{if(type===TYPE_EDIT_PROJECT){var idx=cfg.parent.idx;collection=servers[idx]&&servers[idx].pl;}}if(collection){var me=this,item=collection[cfg.idx];var okFn=function(){collection.splice(cfg.idx,1);me.mobileConfigObj.reconcileHomescreen();me.mobileConfigObj.saveConfiguration();me.view.getList(cfg.isHome).set("items",cfg.parent.fnRedraw.call(me,cfg.parent.item).items);me.goBack();me.connectivityChanged=true;};if(item){confirmDelete(item.nm||item.pn,okFn);}else{okFn();}}else{this.goBack();}return false;}return this._super(group,cmdId);},goBack:function goBack(){if(this._super()){return true;}var currentConfig=getCurrentConfig.call(this);saveChanges.call(this,currentConfig,true);var viewInfos=this._viewInfos;viewInfos.pop();if(currentConfig.type===TYPE_EDIT_SERVER&&mstrApp.deviceType===3&&this.mobileConfigObj.getWebServersList().length===0){viewInfos.pop();}var current=getLastViewInfo.call(this);if(!current||(mstrApp.isTablet()&&viewInfos.length===1)){if(this.connectivityChanged){this.rootCtrl.restart();return true;}return false;}showCurrentView.call(this);return true;},goUp:function goUp(){if(!this._super()){$ARR.forEach(this._viewInfos,function(view){saveChanges.call(this,view.cfg);},this);this.mobileConfigObj.saveConfiguration();this.rootCtrl[(this.connectivityChanged)?"restart":"goHome"]();}return true;},jumpTo:function jumpTo(idx,showView){var viewInfos=this._viewInfos,targetIdx=idx+1;$ARR.forEach(viewInfos,function(view,vIdx){if(vIdx>targetIdx){saveChanges.call(this,view.cfg);}},this);viewInfos.splice(targetIdx);if(showView){showCurrentView.call(this);}}});$CTRL.STYLES={HEADER:STYLE_HEADER,BUTTON:STYLE_BUTTON,VIEW_BUTTON:STYLE_VIEW_BUTTON,TEXT:STYLE_TEXT,LIST:STYLE_LIST,CHECK:STYLE_CHECK,IMAGE:STYLE_IMAGE,TEXT_AREA:STYLE_TEXT_AREA,NUMBER:STYLE_NUMBER,TIME:STYLE_TIME};}());