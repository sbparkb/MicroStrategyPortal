(function(){mstrmojo.requiresCls("mstrmojo.android.ui.ViewSwitcher","mstrmojo.android.ui.TxDocList","mstrmojo.android.large.ui.TxEditDoc","mstrmojo.OfflineTransactionModel","mstrmojo.hash","mstrmojo.css");mstrmojo.requiresDescs(9249,9753);var $HASH=mstrmojo.hash,$CSS=mstrmojo.css;var EnumTxType=mstrmojo.OfflineTransactionModel,PENDING=EnumTxType.PENDING,FAILED=EnumTxType.FAILED;var defaultTitle=mstrmojo.desc(9753,"Transactions");function editDoc(item){var editDocView=this._editDocView;if(!editDocView){editDocView=this._editDocView=mstrApp.viewFactory.newView("TransactionsEditDoc",{model:this.model});}else{editDocView.set("docID",null);}this.switchView(editDocView);this.disposables.push(editDocView);editDocView.set("docID",item.v);var title=item.n;if(this.controller.isAllTransactionLevel()){title="<em>"+defaultTitle+"</em>"+title;}this.setTitle(title);}function showDocList(){this.enableButtons(false);var model=this.model,txs=(model&&model.docsTx)||{},items=[],id=this.id;if($HASH.isEmpty(txs)){showEmptyList.call(this);return ;}$HASH.forEach(txs,function(v,k){var pe=v[PENDING]||[],fe=v[FAILED]||[];items.push({n:v.name,v:k,c:pe.length+fe.length,desc:v.p.pn});});this.dirty=false;var docList=this._docList;if(!docList){docList=this._docList=new mstrmojo.android.ui.TxDocList({cssClass:"docList",items:items,postselectionChange:function(evt){var added=evt.added;if(added){editDoc.call(mstrmojo.all[id],this.items[added[0]]);}}});this.disposables.push(docList);}else{docList.set("items",items);}this.switchView(docList);this.setTitle(defaultTitle);var editDocView=this._editDocView;if(editDocView){editDocView.set("docID",null);}}function showEmptyList(){var lbl=this._docList=new mstrmojo.Label({cssClass:"txtEmpty",text:mstrmojo.desc(9249,"No pending or failed transactions")});this.disposables.push(lbl);this.switchView(lbl);this.enableButtons(false);}mstrmojo.android.ui.TransactionView=mstrmojo.declare(mstrmojo.android.ui.ViewSwitcher,null,{scriptClass:"mstrmojo.android.ui.TransactionView",context:null,model:null,controller:null,dirty:true,init:function init(props){this._super(props);$CSS.addWidgetCssClass(this,"mstrmojo-TxView");},onRender:function onRender(){var fnStart=function(){var model=this.model,txs=(model&&model.docsTx)||{},context=this.context;if($HASH.isEmpty(txs)){showEmptyList.call(this);return ;}if(context){editDoc.call(this,{v:context.id,n:context.n});}else{showDocList.call(this);}};if(!this._txListener){var txListener=this._txListener=this.model.attachEventListener("recordChanged",this.id,function(){this.dirty=true;fnStart.call(this);});this.disposables.push(txListener);}fnStart.call(this);},deleteRecord:function deleteRecord(){var editDocView=this._editDocView,isPending=(editDocView.getType()===0),tx=editDocView.getSelectedTx(),id=this.id;this.controller.deleteTransactionRecord(editDocView.docID,isPending,tx.v,{success:function(r){var view=mstrmojo.all[id];view.dirty=true;editDocView.generateTypeList();editDocView.setType((isPending||!r.length)?0:1);}});},editRecord:function editRecord(){var editDocView=this._editDocView,tx=editDocView.getSelectedTx();this.controller.editTransactionRecord(editDocView.docID,(editDocView.getType()===0),tx.v);},enableButtons:mstrmojo.emptyFn,setTitle:mstrmojo.emptyFn,goBack:function goBack(){if(!this.controller.isAllTransactionLevel()){return false;}var currentView=this.getCurrentView();if(!currentView||currentView===this._docList){return false;}showDocList.call(this);return true;}});}());