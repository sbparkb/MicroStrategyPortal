(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.Container","mstrmojo.ListBase","mstrmojo.android._IsList","mstrmojo.android._IsIncFetchList","mstrmojo._TouchGestures","mstrmojo._HasTouchScroller");var $A=mstrmojo.array,$HC=mstrmojo.hash.copy,EDGES_ENUM=mstrmojo.TouchScroller.EnumIncFetchEdges,EDGE_START=EDGES_ENUM.start,INC_FETCH_SIZE=50,BUFFER_SIZE=20,NO_DELAY=false;function createIncFetchDataHelper(start,end){if(this.end===null||isNaN(this.end)||this.start===null||isNaN(this.start)){this.ifDirection="h";this.supportedEdges=0;$A.forEach(["start","end"],function(edge){this.supportedEdges+=isNaN(this[edge])?EDGES_ENUM[edge]:0;},this);var $this=this,i;this.ifDataHelper=new mstrmojo.Obj({totalSize:-1,next:function next(callbacks,edge){var evtItems=[],adjustedIndex=-1;evtItems=evtItems.concat($this.items);if(edge===EDGE_START){for(i=0;i<INC_FETCH_SIZE;i++){evtItems.splice(0,0,{n:--start});}evtItems=evtItems.splice(0,INC_FETCH_SIZE+BUFFER_SIZE);end=start+INC_FETCH_SIZE+BUFFER_SIZE-1;adjustedIndex=INC_FETCH_SIZE;}else{for(i=0;i<INC_FETCH_SIZE;i++){evtItems.push({n:++end});}evtItems=evtItems.splice(evtItems.length-INC_FETCH_SIZE-BUFFER_SIZE);start=end-INC_FETCH_SIZE-BUFFER_SIZE;adjustedIndex=BUFFER_SIZE-3;}$this.set("items",evtItems);window.setTimeout(function(){NO_DELAY=true;$this.singleSelect(adjustedIndex);},0);callbacks.success({items:undefined});}});}}mstrmojo.android.ui.CalendarYearList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo.android._IsList,mstrmojo._TouchGestures,mstrmojo._HasTouchScroller,mstrmojo.android._IsIncFetchList],{scriptClass:"mstrmojo.android.ui.CalendarYearList",years:undefined,scrollerConfig:{bounces:false,showScrollbars:false,scrollPast:true},getItemMarkup:function(item,idx){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}"><span>{@n}</span><div class="marker"></div></{@tag}>';},postCreate:function postCreate(props){if(this._super){this._super();}var start=(this.start)||(new Date(0)).getFullYear(),end=(this.end)||((new Date()).getFullYear()+5),current=start,items=this.items=this.items||[];while(end>=current){items.push({n:current++});}createIncFetchDataHelper.call(this,start,end);},postBuildRendering:function postBuildRendering(){this._super();var width=this.ITEMS_NODE_WIDTH=this.itemsNode.clientWidth;this.updateScroller();this.singleSelectByField(this.initialYear,"n");this._scroller.attachEventListener("scrollDone",this.id,function(evt){var fraction=(evt.x+(parseInt(this.width,10)-width)/2)/width,intVal=Math.floor(fraction),newIdx=intVal;newIdx+=((fraction-intVal)>0.3)?1:0;if(newIdx!==this.selectedIndex){this.singleSelect(newIdx);}else{this.onchange();}});},onchange:function(){var idx=this.selectedIndex;if(idx>=0){var itemWidth=this.ITEMS_NODE_WIDTH,scrollToPos=(idx*itemWidth)-(parseInt(this.width,10)-itemWidth)/2;this._scroller.scrollTo(scrollToPos,undefined,NO_DELAY?0:200);this.raiseEvent({name:"yearChanged",value:this.selectedItem.n});NO_DELAY=false;}},updateScrollerConfig:function updateScrollerConfig(){var cfg=this._super(),icn=this.itemsContainerNode,w=parseInt(this.width,10);if(isNaN(w)){w=this.domNode.clientWidth;}cfg.scrollEl=icn;cfg.noVScroll=true;cfg.origin=cfg.origin||{x:0,y:0};var offsetEnd=Math.max(icn.clientWidth-w,0),enableScroll=cfg.hScroll=(offsetEnd!==0);if(enableScroll){cfg.offset={x:$HC({start:0,end:offsetEnd},cfg.offset&&cfg.offset.x)};}else{cfg.offset=undefined;}return cfg;},destroy:function destroy(){if(this.ifDataHelper){this.ifDataHelper.destroy();delete this.ifDataHelper;}this._super();}});}());