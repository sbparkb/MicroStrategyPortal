(function(){mstrmojo.requiresCls("mstrmojo.android.SimpleList","mstrmojo.android.controllers.SettingsController","mstrmojo.android._HasLingeringListSelections","mstrmojo.android.ui.Button","mstrmojo.ui.MobileCheckList","mstrmojo.android.ui.TextInput","mstrmojo.android.ui.ValidationTextInput","mstrmojo.expr","mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo.android.nativedialog.EditTextDialog","mstrmojo.android.nativedialog.ListDialog","mstrmojo.android.nativedialog.TimePickerDialog");mstrmojo.requiresDescs(221,1442,7883,9454);var $STYLES=mstrmojo.android.controllers.SettingsController.STYLES,$BTN=mstrmojo.android.ui.Button.newButton,$ARR=mstrmojo.array,$VAL=mstrmojo.validation,$TRIG=$VAL.TRIGGER,$SC=$VAL.STATUSCODE,itemMarkup={},$D=mstrmojo.dom,$TRANS_DURATION=$D.CSS3_TRANSITION_DURATION,$HASH=mstrmojo.hash;mstrmojo.android.ui.SettingsView=mstrmojo.declare(mstrmojo.android.SimpleList,[mstrmojo.android._HasLingeringListSelections],{scriptClass:"mstrmojo.android.ui.SettingsView",init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-AndroidSettings");},allowTouchBubble:false,getList:function getList(){return this;},listHooks:{select:function(el,item,idx){el.style[$TRANS_DURATION]=0;if(item.disabled){return true;}if(item.style!==$STYLES.VIEW_BUTTON){this.setClearHandler(200);}},unselect:function(el,item,idx){el.style[$TRANS_DURATION]="300ms";}},getItemMarkup:function(item){var s=item.style;if(!itemMarkup[s]){var newMarkup="<div><h3>{@ttl}</h3><h4>{@value}</h4></div>";if(s===$STYLES.TEXT_AREA){newMarkup='<div readonly="readonly">{@ttl}</div>';}else{if(s===$STYLES.IMAGE){newMarkup="<h3></h3>";}}itemMarkup[s]=this._super(item).replace("{@en@n}",newMarkup);}return itemMarkup[s];},getItemProps:function getItemProps(item,idx){var value=item.v,props=this._super(item,idx);props.ttl=item.nm;props.value=value||"";var cls=item.cls;if(cls){props.addCls(cls);}var fnTimeNumberText=function(){props.addCls("drop-down");if(item.pwd){props.value="********";}else{if(item.showHint&&value===""){props.value=mstrmojo.desc(9454,"&lt;not set&gt;");}}};switch(item.style){case $STYLES.TEXT_AREA:props.addCls("textarea");break;case $STYLES.HEADER:props.addCls("header");break;case $STYLES.TIME:props.value=new Date((item.v<60000)?item.v*60000:item.v).toJSON().replace(/.*T/,"").replace(/\.[0-9]{3}Z/,"");fnTimeNumberText();break;case $STYLES.NUMBER:case $STYLES.TEXT:fnTimeNumberText();break;case $STYLES.LIST:props.addCls("drop-down");var items=item.items;props.value=items[$ARR.find(items,"v",value)].n;break;case $STYLES.CHECK:props.addCls("check");if(value===item.on){props.addCls("on");}props.value=item.desc;break;}if(item.hidden){props.addCls("hidden");}else{if(item.disabled){props.addCls("disabled");props.value="";}}if(props.value){props.addCls("with-desc");}return props;},touchSelectBegin:function touchSelectBegin(touch){var idx=this.getItemIdxTouch(touch);if(idx>-1){var item=this.items[idx],fnPress=item.fnPress;if(fnPress){fnPress.call(this.controller,item);return false;}}return true;},preselectionChange:function preselectionChange(evt){var added=evt.added;if(!added){return true;}var idx=added[0],item=this.items[idx];if(item.disabled||item.noclick){return false;}if(item.style===$STYLES.HEADER){if(!this._listTarget.getAttribute("hidx")){return false;}}return true;},postselectionChange:function postselectionChange(evt){var added=evt.added;if(!added){return ;}var idx=added[0],item=this.items[idx];var me=this,dialogConfig={title:item.nm},dialogChildren=[],fnOk,dialog,fnUpdateValue=function(item,value){item.fn(value);me.updateItem(idx);};switch(item.style){case $STYLES.HEADER:var headerIdx=this._listTarget.getAttribute("hidx");if(headerIdx){this.controller.jumpTo(parseInt(headerIdx,10),true);}break;case $STYLES.BUTTON:case $STYLES.VIEW_BUTTON:if(item.fn){item.fn();}break;case $STYLES.NUMBER:case $STYLES.TEXT:var isNum=(item.style===$STYLES.NUMBER),tb={scriptClass:"mstrmojo.android.ui."+(isNum?"Validation":"")+"TextInput",alias:"textInput",textValue:item.v,textType:isNum?"number":(item.pwd?"password":"text"),onEnter:function(value){fnUpdateValue(item,value);dialog.close();}};if(isNum){tb.valProps={dtp:mstrmojo.expr.DTP.UNSIGNED,min:item.limits.min,max:item.limits.max,constraints:{trigger:$TRIG.ONKEYUP,validator:function(v){v=parseInt(v,10);var min=this.min,max=this.max,msg=(v>=min&&v<=max)?"":mstrmojo.desc(7883).replace("##",min).replace("###",max);return{code:msg?$SC.INVALID:$SC.VALID,msg:msg};}}};}dialogChildren.push(tb);fnOk=function(){var eb=dialog.textInput;if(eb.validate){eb.validate();if(eb.isValid()){fnUpdateValue(item,eb.getValue());return true;}return false;}fnUpdateValue(item,eb.getValue());return true;};break;case $STYLES.LIST:var items=item.items;var optionList=new mstrmojo.ui.MobileCheckList({items:items,multiSelect:false,isElastic:true,selectedIndex:$ARR.find(items,"v",item.v)});dialogChildren.push(optionList);fnOk=function(){fnUpdateValue(item,items[optionList.selectedIndex].v);};break;case $STYLES.CHECK:fnUpdateValue(item,(item.v===item.on)?item.off:item.on);break;case $STYLES.TIME:var v=(item.v<60000)?item.v*60000:item.v,date=new Date(v),timePicker=new mstrmojo.ui.MobileDateTimePicker({value:{time:{hour:date.getUTCHours(),min:date.getUTCMinutes(),sec:0}},is24HourMode:false,dtp:mstrmojo.expr.DTP.TIME});dialogChildren.push(timePicker);fnOk=function(){var time=timePicker.getTime();fnUpdateValue(item,time.hour*60+time.min);};break;}if(dialogChildren.length){dialogConfig.children=dialogChildren;if(fnOk){dialogConfig.buttons=[$BTN(mstrmojo.desc(221,"Cancel")),$BTN(mstrmojo.desc(1442,"OK"),fnOk)];}if(mstrApp.useBinaryFormat){var positiveButton=dialogConfig.buttons[1],dialogClazz;if(item.style==$STYLES.TEXT||item.style==$STYLES.NUMBER){if(item.style==$STYLES.NUMBER){dialogConfig.validator={min:item.limits.min,max:item.limits.max};}positiveButton.onclick=function(value){fnUpdateValue(item,value);};dialogClazz=mstrmojo.android.nativedialog.EditTextDialog;}if(item.style==$STYLES.LIST){$HASH.copy({onSelectionChange:function(index){fnUpdateValue(item,items[index].v);this.close();}},dialogConfig);dialogClazz=mstrmojo.android.nativedialog.ListDialog;}if(item.style==$STYLES.TIME){positiveButton.onclick=function(value){var time=eval("("+value+")").time;fnUpdateValue(item,time.hour*60+time.min);};dialogClazz=mstrmojo.android.nativedialog.TimePickerDialog;}if(!!dialogClazz){new dialogClazz(dialogConfig).show();return ;}}dialog=mstrApp.showDialog(dialogConfig);}}});}());