(function(){mstrmojo.requiresCls("mstrmojo.ui.MobileCheckList","mstrmojo.android._IsIncFetchList","mstrmojo.mstr.WebElements","mstrmojo.array");var $ARR=mstrmojo.array,emptyElements=new mstrmojo.mstr.WebElements();function toggleIncFetch(browseElements){this.supportsIncFetch=false;delete this.ifDataHelper;if(browseElements){if(browseElements.items.length<browseElements.totalSize){this.ifDataHelper=browseElements;this.supportsIncFetch=true;}}}function cacheElasticHeight(){var height=this.height;if(!this.elasticHeight&&height){this.elasticHeight=parseInt(height,10);}}mstrmojo.android.ui.ElementsPicker=mstrmojo.declare(mstrmojo.ui.MobileCheckList,[mstrmojo.android._IsIncFetchList],{scriptClass:"mstrmojo.android.ui.ElementsPicker",browseElements:null,viewAll:true,glow:true,onbrowseElementsChange:function onbrowseElementsChange(){toggleIncFetch.call(this);this._ignoreSelection=true;var bElems=this.browseElements;if(bElems){var items=bElems.items=(bElems.items||[]),cfg=this._searchConfig;if((!cfg||cfg.exit)&&!this.viewAll){items=this.getSelectedItems();}this.set("items",items);if(cfg){this.glow=false;this.selectItems(cfg.selected,true);this.glow=true;}toggleIncFetch.call(this,bElems);}else{this.set("items",[]);}this.updateScroller();this._ignoreSelection=false;},syncSelection:function syncSelection(){var cfg=this._searchConfig;if(cfg){this.selectItems(cfg.selected,false);}},enterSearchMode:function enterSearchMode(){var selectedItems=this.getSelectedItems();this._searchConfig={elements:this.browseElements,selected:selectedItems,clone:[].concat(selectedItems)};cacheElasticHeight.call(this);this.set("browseElements",emptyElements);},search:function search(results){this.set("browseElements",results);},exitSearchMode:function exitSearchMode(viewAll){var cfg=this._searchConfig;cfg.exit=true;this.set("browseElements",viewAll?cfg.elements:{items:cfg.selected});delete this._searchConfig;},clearSearch:function clearSearch(){var cfg=this._searchConfig;cfg.selected=[].concat(cfg.clone);this.set("browseElements",emptyElements);},postselectionChange:function postselectionChange(evt){var cfg=this._searchConfig;if(!cfg||this._ignoreSelection){return ;}var selected=cfg.selected,items=this.items,added=evt.added;if(this.multiSelect){$ARR.forEach(added,function(idx){selected.push(items[idx]);});$ARR.forEach(evt.removed,function(idx){$ARR.removeItems(selected,"v",[items[idx]]);});}else{if(added){selected.splice(0);selected.push(items[added[0]]);}}},onviewAllChange:function onviewAllChange(){var items=this.getSelectedItems(),browseElements;if(this.viewAll){browseElements=this.browseElements;items=browseElements.items;}else{cacheElasticHeight.call(this);}this.glow=false;var selectedItems=this.getSelectedItems();this.set("items",items);this.selectItems(selectedItems,true);this.glow=true;toggleIncFetch.call(this,browseElements);this.updateScroller();}});}());