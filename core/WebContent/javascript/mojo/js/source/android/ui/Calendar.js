(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._TouchGestures","mstrmojo.android.ui.CalendarMonthView","mstrmojo.android.ui.CalendarYearList");var $H=mstrmojo.hash,$A=mstrmojo.array,CLEAR_TEXT=mstrmojo.desc(2827,"Clear"),CANCEL_TEXT=mstrmojo.desc(221,"Cancel");mstrmojo.android.ui.Calendar=mstrmojo.declare(mstrmojo.Container,[mstrmojo._TouchGestures,mstrmojo._HasLayout],{scriptClass:"mstrmojo.android.ui.Calendar",config:undefined,markupString:'<div id="{@id}" class="mstrmojo-android-Calendar"><div class="mstrmojo-Calendar-Year"></div><hr class="mstrmojo-Calendar-Sep"/><div class="mstrmojo-Calendar-Month"></div></div>',markupSlots:{yearNode:function(){return this.domNode.firstChild;},monthNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},cssDisplay:"",isMultiSelect:false,selectedDates:undefined,min:undefined,max:undefined,init:function init(props){var now=new Date(),yearWidget=this.children[0],monthWidget=this.children[1],min=props.min=props.min||{},max=props.max=props.max||{},selected=props.selectedDates=props.selectedDates||[],firstSelected=selected[0]||{},firstYear,firstMonth;$A.forEach([firstSelected,min],function(obj){if(!isNaN(obj.year)&&!isNaN(obj.month)){firstYear=obj.year;firstMonth=obj.month;return false;}});firstMonth=!isNaN(firstMonth)?firstMonth:(now.getMonth()+1);firstYear=!isNaN(firstYear)?firstYear:now.getFullYear();$H.copy({initialYear:firstYear,initialMonth:firstMonth,multiSelect:!!this.isMultiSelect,selected:selected,range:{start:min,end:max}},monthWidget);$H.copy({initialYear:firstYear,start:min.year,end:max.year},yearWidget);this._super(props);},postBuildRendering:function postBuildRendering(){this.monthWidget.markupBuilder=this.markupBuilder;this._super();var calList=this.target;calList.set("items",this.selectedDates);calList.selectItems(calList.items);this.yearWidget.attachEventListener("yearChanged",this.monthWidget.id,function(evt){this.current.set("y",evt.value);});this.monthWidget.attachEventListener("selectionChanged",this.id,function(evt){this.syncListItemsWithSelections([].concat(evt.items));});this.target.attachEventListener("selectionChange",this.id,function(evt){var target=this.target,targetItems=target.items,monthWidget=this.monthWidget,added=$A.get(targetItems,evt.added),removed=$A.get(targetItems,evt.removed);if(added&&added.length>0){monthWidget.selectItems(added);}else{var toRemove;if((removed&&removed.length>0)&&(targetItems&&targetItems.length>0)){toRemove=removed;}monthWidget.unselectItems(toRemove);}if(target.parent){target.parent.btnHbox.children[0].set("text",((target.getSelectedItems().length>0)?CLEAR_TEXT:CANCEL_TEXT));}monthWidget.selected=target.getSelectedItems();});},syncListItemsWithSelections:function syncTargetListSelections(newItems){var target=this.target;target.glow=false;target.set("items",newItems);target.selectItems(newItems);if(target.parent){target.parent.btnHbox.children[0].set("text",((target.getSelectedItems().length>0)?CLEAR_TEXT:CANCEL_TEXT));target.parent.resizeDialog();}target.glow=true;},getSelectedDates:function getSelectedDates(format){var result=[];$A.forEach(this.target.getSelectedItems(),function(sd){result.push(sd.n);});return result;},children:[{scriptClass:"mstrmojo.android.ui.CalendarYearList",alias:"yearWidget",slot:"yearNode"},{scriptClass:"mstrmojo.android.ui.CalendarMonthView",alias:"monthWidget",slot:"monthNode"}]});}());