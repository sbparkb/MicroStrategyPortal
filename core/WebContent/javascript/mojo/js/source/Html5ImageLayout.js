(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._BaseImageLayout");mstrmojo.Html5ImageLayout=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._BaseImageLayout],{scriptClass:"Html5ImageLayout",isTablet:false,width:700,height:500,top:0,left:0,multiTouch:false,markupString:'<div id="{@id}" class="mstrmojo-Chart {@cssClass}" style="position:absolute;width:{@width}px;height:{@height}px;top:{@top}px;left:{@left}px;overflow:hidden;"  mstrAttach:mouseover,mouseout,mousedown,mousemove,mouseup,click,dblclick><div id="{@id}"-scroll-element style="position:absolute;left:0;top:0;width:{@width};height={@height}"><canvas id="{@id}-highlightCanvas" style="position:absolute;left:0;top:0;z-index:1" width="{@width}" height="{@height}"></canvas><canvas id="{@id}-animationCanvas" style="position:absolute;left:0;top:0" width="{@width}" height="{@height}"></canvas></div><div id="{@id}-tooltip" style="z-index:2" class="mstrmojo-ImageLayout-tooltip" clk="clk"><table style="margin:5px 7px"></table></div><div id="{@id}-infowindow-anchor" style="position:absolute;width:18px;height:18px;display:block;z-index:-1;"></div><div id="{@id}-css" style="display:none"></div><div id="{@id}-errMsg" align="center" style="position:absolute; top:35%; word-wrap:break-word;"></div></div>',markupSlots:{scrollableCanvasDiv:function(){return this.domNode.childNodes[0];},highlightCanvas:function(){return this.domNode.childNodes[0].firstChild;},animationCanvas:function(){return this.domNode.childNodes[0].lastChild;},tooltip:function(){return this.domNode.childNodes[1];},infowindowAnchor:function(){return this.domNode.childNodes[2];},cssDiv:function(){return this.domNode.childNodes[3];},errorMessage:function(){return this.domNode.childNodes[4];}},postBuildRendering:function postBR(){var domStyle=this.domNode.style;this.width=400;this.height=400;domStyle.width=this.width+"px";domStyle.height=this.height+"px";this._scroller={bounces:false,showScrollbars:false,useTranslate3d:true,vScroll:true,hScroll:true,offset:{y:{start:0,end:0},x:{start:0,end:0}},origin:{x:0,y:0}};if(this._super){this._super();}},setFontByDPI:function setFontByDPI(){if(this.setFontByDPIFlag){return ;}var me=this;me.setFontByDPIFlag=true;me.hoverBubbleRadiusLarger=5;me.bubbleStrokeWidth=2;me.baseMaxBubbleSizeAuto=12;me.baseMaxBubbleSizeManual=24;me.polygonStrokeWidth=1;me.highlightPolygonStrokeWidth=2;me.borderSpace=5;me.tooltipFontSize=12;me.tooltipBorderWidth=1;me.tooltipBorderRadius=5;me.errMsgFontSize=16;me.bias=30;me.tooltipRightShadowWidth=4;var ratio=1;if(ratio>1){me.hoverBubbleRadiusLarger*=ratio;me.bubbleStrokeWidth*=ratio;me.baseMaxBubbleSizeAuto*=ratio;me.baseMaxBubbleSizeManual*=ratio;me.polygonStrokeWidth*=ratio;me.highlightPolygonStrokeWidth*=ratio;me.borderSpace*=ratio;me.tooltipFontSize*=ratio;me.tooltipBorderWidth*=ratio;me.tooltipBorderRadius*=ratio;me.errMsgFontSize*=ratio;me.bias*=ratio;me.tooltipRightShadowWidth*=ratio;var tooltip=me.tooltip,table=tooltip.childNodes[0];tooltip.style.fontSize=me.tooltipFontSize+"px";tooltip.style.borderWidth=me.tooltipBorderWidth+"px";tooltip.style.borderRadius=me.tooltipBorderRadius+"px";tooltip.style.boxShadow=3*ratio+"px "+3*ratio+"px "+4*ratio+"px RGBA(0,0,0,0.45)";table.style.margin=5*ratio+"px "+7*ratio+"px";}},getAreaBubbleAttrElems:function getAreaBubbleAttrElems(){var areaBubbleAttrElems={},me=this,model=me.model,mapFileIndex=me.mapFileIndex,totalWidget=me.totalWidget,attrFormIndices=totalWidget.attrFormIndices,layoutAttrIndex=totalWidget.layoutAttrIndex,areaBubbleAttrIndex=totalWidget.areaBubbleAttrIndex,rhsItems=model&&model.ghs&&model.ghs.rhs&&model.ghs.rhs.items,gtsRows=model&&model.gts&&model.gts.row,allAreaBubbleAttrElems=gtsRows&&gtsRows.length>areaBubbleAttrIndex&&gtsRows[areaBubbleAttrIndex].es,areaBubbleAttrFirstFormIndexIdx,areaBubbleAttrFirstFormName,i;if(layoutAttrIndex>-1&&areaBubbleAttrIndex>-1){var layoutAttrFormIndices=attrFormIndices.length>layoutAttrIndex&&attrFormIndices[layoutAttrIndex];var areaBubbleAttrFormIndices=attrFormIndices.length>areaBubbleAttrIndex&&attrFormIndices[areaBubbleAttrIndex];if(layoutAttrFormIndices&&areaBubbleAttrFormIndices){var layoutAttrFormCnt=layoutAttrFormIndices.length,layoutAttrFirstFormIndex=layoutAttrFormIndices[0],layoutAttrFirstFormIndexIdx=layoutAttrFormCnt*mapFileIndex,areaBubbleAttrFirstFormIndex=areaBubbleAttrFormIndices[0];if(rhsItems&&gtsRows&&allAreaBubbleAttrElems){for(i=0;i<rhsItems.length;i++){var idx=rhsItems[i].items&&rhsItems[i].items.length>layoutAttrFirstFormIndex&&rhsItems[i].items[layoutAttrFirstFormIndex].idx;if(idx===layoutAttrFirstFormIndexIdx){areaBubbleAttrFirstFormIndexIdx=(rhsItems[i].items&&rhsItems[i].items.length>areaBubbleAttrFirstFormIndex)?rhsItems[i].items[areaBubbleAttrFirstFormIndex].idx:-1;areaBubbleAttrFirstFormName=(allAreaBubbleAttrElems.length>areaBubbleAttrFirstFormIndexIdx)?allAreaBubbleAttrElems[areaBubbleAttrFirstFormIndexIdx].n:null;if(areaBubbleAttrFirstFormName&&areaBubbleAttrFirstFormIndexIdx>-1){areaBubbleAttrElems[areaBubbleAttrFirstFormName.toLowerCase()]=areaBubbleAttrFirstFormIndexIdx;}}}}}}else{if(layoutAttrIndex===-1&&areaBubbleAttrIndex>-1){if(rhsItems&&gtsRows&&allAreaBubbleAttrElems){for(i=0;i<rhsItems.length;i++){areaBubbleAttrFirstFormIndexIdx=(rhsItems[i].items&&rhsItems[i].items.length>0)?rhsItems[i].items[0].idx:-1;areaBubbleAttrFirstFormName=(allAreaBubbleAttrElems.length>areaBubbleAttrFirstFormIndexIdx)?allAreaBubbleAttrElems[areaBubbleAttrFirstFormIndexIdx].n:null;if(areaBubbleAttrFirstFormName&&areaBubbleAttrFirstFormIndexIdx>-1){areaBubbleAttrElems[areaBubbleAttrFirstFormName.toLowerCase()]=areaBubbleAttrFirstFormIndexIdx;}}}}}return areaBubbleAttrElems;},getWidgetXY:function getWidgetXY(e){e.widgetX=e.offsetX;e.widgetY=e.offsetY;},onmouseover:function onmouseover(evt){var e=evt.e;console.log("mouse over");this.getWidgetXY(e);this.touchSelectBegin_mouseOver(e);},onmouseout:function onmouseout(evt){var e=evt.e;console.log("mouse out");this.getWidgetXY(e);this.touchSelectEnd_mouseOut(e);this.hideTooltip();},onmousedown:function onmousedown(evt){var e=evt.e;console.log("mouse down");},onmousemove:function onmousemove(evt){var e=evt.e;console.log("mouse move");this.getWidgetXY(e);this.touchSelectMove_mouseMove(e);},onmouseup:function onmouseup(evt){var e=evt.e;console.log("mouse up");},onclick:function onclick(evt){var e=evt.e;console.log("click");this.getWidgetXY(e);this.touchTap_click(e);},ondblclick:function ondblclick(evt){var e=evt.e;console.log("double click");}});}());