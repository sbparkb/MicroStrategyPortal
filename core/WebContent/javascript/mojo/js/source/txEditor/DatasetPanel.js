(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Pulldown","mstrmojo.txEditor.CommonComponent","mstrmojo.txEditor.Container","mstrmojo.txEditor.Table","mstrmojo.Label","mstrmojo.HBox","mstrmojo.HTMLButton");mstrmojo.requiresDescs(2149,4190,5247,8501,9899,9900);var _TC=mstrmojo.txEditor.CommonComponent,_TCCT=_TC.CTRL_TYPES,_TCIV=_TC.INPUT_VALUES,$NWB=mstrmojo.Button.newWebButton,SORT_EDITOR_ID="mstrTransactionSortEditor",SORT_ASCENDING=1,SORT_DESCENDING=0,SORT_DISABLED=-1;function _isBarcode(){return mstrmojo.all.teModel.currentTxInput.ctl.pr.t===_TCCT.CTRL_BARCODE;}mstrmojo.txEditor.DatasetPanel=mstrmojo.declare(mstrmojo.txEditor.Container,null,{scriptClass:"mstrmojo.txEditor.DatasetPanel",cssClass:"mstrmojo-TransactionEditor-Panel dataset",onvisibleChange:function(){var m=mstrmojo.all.teModel;if(this.visible){m.updateDDICSetting(m.currentTxInput);}else{if(this.parent.visible){m.currentTxInput.ctl.ddic=null;}}},getVisibility:function(){return mstrmojo.all.teModel.currentTxInput.ctl.pr.ipt===_TCIV.INPUT_VALUES_DATASET;},children:[{scriptClass:"mstrmojo.txEditor.Table",layout:[{cells:[{},{}]},{cells:[{},{}]},{cells:[{},{},{}]},{cells:[{},{}]},{cells:[{colSpan:2}]},{cells:[{},{}]}],children:[_TC.createLabel({slot:"0,0"},mstrmojo.desc(4190)),{slot:"0,1",alias:"dstPicker",scriptClass:"mstrmojo.Pulldown",popupToBody:true,popupZIndex:112,itemIdField:"dsid",defaultText:" ",defaultSelection:-1,getVisibility:function(){var model=mstrmojo.all.teModel;this.set("items",model.rwTxs.ds);this.set("value",model.currentTxInput.ctl.ddic.dsid);return true;},onvalueChange:function(){if(this.visible){var ddic=mstrmojo.all.teModel.currentTxInput.ctl.ddic;ddic.dsid=this.value;ddic.dst=this.selectedItem&&this.selectedItem.dst;ddic.cst=null;this.parent.attPicker.set("items",this.selectedItem&&this.selectedItem.attrs);this.parent.attPicker.set("value",null);this.parent.wfrmPicker.set("value",null);if(_isBarcode()){this.parent.mfrmPicker.set("value",null);this.parent.wmEqualCheck.set("checked",false);}}}},_TC.createLabel({slot:"1,0"},mstrmojo.desc(2149)),{slot:"1,1",alias:"attPicker",scriptClass:"mstrmojo.Pulldown",popupToBody:true,popupZIndex:112,itemIdField:"did",defaultText:" ",defaultSelection:-1,items:[],getVisibility:function(){var selectedItem=this.parent.dstPicker.selectedItem;this.set("items",selectedItem&&selectedItem.attrs);this.set("value",mstrmojo.all.teModel.currentTxInput.ctl.ddic.csid);return true;},onvalueChange:function(){if(this.visible){var ddic=mstrmojo.all.teModel.currentTxInput.ctl.ddic;ddic.csid=this.value;ddic.cst=this.selectedItem&&this.selectedItem.tp;this.parent.dfrmPicker.set("items",this.selectedItem&&[{fid:"1",n:"Automatic"}].concat(this.selectedItem.frms));this.parent.dfrmPicker.set("value",this.selectedItem?"1":null);this.parent.wfrmPicker.set("items",this.selectedItem&&this.selectedItem.frms);this.parent.wfrmPicker.set("value",null);if(_isBarcode()){this.parent.mfrmPicker.set("items",this.selectedItem&&this.selectedItem.frms);this.parent.mfrmPicker.set("value",null);this.parent.wmEqualCheck.set("checked",false);}}}},_TC.createLabel({slot:"2,0"},mstrmojo.desc(5247)),{slot:"2,1",alias:"dfrmPicker",scriptClass:"mstrmojo.Pulldown",popupToBody:true,popupZIndex:112,itemIdField:"fid",defaultText:" ",defaultSelection:-1,items:[],getVisibility:function(){var selectedItem=this.parent.attPicker.selectedItem;this.set("items",selectedItem&&[{fid:"1",n:"Automatic"}].concat(selectedItem.frms));this.set("value",mstrmojo.all.teModel.currentTxInput.ctl.ddic.dfid);return true;},onvalueChange:function(){if(this.visible){mstrmojo.all.teModel.currentTxInput.ctl.ddic.dfid=this.value;}}},{slot:"2,2",alias:"sortButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-TransactionEditor-SortButton",bindings:{enabled:"!!this.parent.dfrmPicker.value"},onclick:function(){var id=SORT_EDITOR_ID,selectedItem=this.parent.attPicker.selectedItem,w;if(!mstrmojo.all[id]){mstrmojo.insert(mstrmojo.txEditor.SortEditor);}w=mstrmojo.all[id];w.sortTxModel.set("items",[{fid:"0",n:"Default"}].concat(selectedItem.frms));w.sortTxModel.set("text",selectedItem.n);w.open();},getVisibility:function(){return mstrmojo.all.teModel.currentTxInput.ctl.pr.t===_TCCT.CTRL_LIST;}},_TC.createLabel({slot:"3,0",getVisibility:_isBarcode},mstrmojo.desc(9899)),{slot:"3,1",alias:"mfrmPicker",scriptClass:"mstrmojo.Pulldown",popupToBody:true,popupZIndex:112,itemIdField:"fid",defaultText:" ",defaultSelection:-1,items:[],getVisibility:function(){var isBarcodeType=_isBarcode(),selectedItem=this.parent.attPicker.selectedItem;if(isBarcodeType){this.set("items",selectedItem&&selectedItem.frms);this.set("value",mstrmojo.all.teModel.currentTxInput.ctl.ddic.mfid);}return isBarcodeType;},onvalueChange:function(){if(this.visible){var ddic=mstrmojo.all.teModel.currentTxInput.ctl.ddic;ddic.mfid=this.value;if(this.parent.wmEqualCheck.checked===false){this.parent.wfrmPicker.set("value",this.value);}}}},{slot:"4,0",alias:"wmEqualCheck",scriptClass:"mstrmojo.TristateCheckBox",cssClass:"tristate mstrmojo-TransactionEditor-CheckBox",grayed:false,text:mstrmojo.desc(9900),getVisibility:function(){var ddic=mstrmojo.all.teModel.currentTxInput.ctl.ddic,isBarcodeType=_isBarcode();if(isBarcodeType){this.set("checked",ddic.wfid!==ddic.mfid);}return isBarcodeType;},oncheckedChange:function(){if(this.visible){var ddic=mstrmojo.all.teModel.currentTxInput.ctl.ddic;if(!this.checked){this.parent.wfrmPicker.set("value",ddic.mfid);}}}},_TC.createLabel({slot:"5,0",getVisibility:function(){return(mstrmojo.all.teModel.currentTxInput.ctl.pr.t!==_TCCT.CTRL_BARCODE)||this.parent.wmEqualCheck.checked;},bindings:{visible:"this.parent.wmEqualCheck.checked"}},mstrmojo.desc(8501)),{slot:"5,1",alias:"wfrmPicker",scriptClass:"mstrmojo.Pulldown",popupToBody:true,popupZIndex:112,itemIdField:"fid",defaultText:" ",defaultSelection:-1,items:[],getVisibility:function(){return !_isBarcode()||this.parent.wmEqualCheck.checked;},onvisibleChange:function(){if(this.visible){var selectedItem=this.parent.attPicker.selectedItem;this.set("items",selectedItem&&selectedItem.frms);this.set("value",mstrmojo.all.teModel.currentTxInput.ctl.ddic.wfid);}},bindings:{visible:"this.parent.wmEqualCheck.checked"},onvalueChange:function(){mstrmojo.all.teModel.currentTxInput.ctl.ddic.wfid=this.value;}}]}]});mstrmojo.txEditor.SortEditor={id:SORT_EDITOR_ID,scriptClass:"mstrmojo.Editor",title:"Sort",zIndex:150,cssClass:"mstrmojo-TransactionEditor-SortEditor",help:"configure_transactions_dialog_box.htm",postCreate:function(){var _sortTxModel={scriptClass:"mstrmojo.Model",id:"sortModel"};this.sortTxModel=mstrmojo.insert(_sortTxModel);},onOpen:function(){var sortinfo=mstrmojo.all.teModel.currentTxInput.ctl.ddic.sort||{sortfmid:"0",sortdir:-1};this.sortTxModel.set("sortdir",sortinfo.sortdir);this.sortTxModel.set("sortfmid",sortinfo.sortfmid);},onClose:function(){this.sortTxModel.sortdir=null;this.sortTxModel.sortfmid=null;},children:[{scriptClass:"mstrmojo.Table",alias:"sortTable",rows:1,cols:3,children:[{scriptClass:"mstrmojo.Label",alias:"sortAttr",slot:"0,0",bindings:{text:"this.parent.parent.sortTxModel.text"},},{scriptClass:"mstrmojo.Pulldown",alias:"sortForm",slot:"0,1",popupToBody:true,popupZIndex:160,itemIdField:"fid",bindings:{items:"this.parent.parent.sortTxModel.items",value:"this.parent.parent.sortTxModel.sortfmid"},onvalueChange:function(){var sortTxModel=this.parent.parent.sortTxModel;sortTxModel.sortfmid=this.value;if(this.value==="0"){sortTxModel.set("sortdir",SORT_DISABLED);}else{if(sortTxModel.sortdir===SORT_DISABLED){sortTxModel.set("sortdir",SORT_ASCENDING);}}}},{scriptClass:"mstrmojo.RadioList",alias:"sortDir",slot:"0,2",itemIdField:"v",allowUnlistedValues:false,bindings:{enabled:function(){return this.parent.parent.sortTxModel.sortdir!==SORT_DISABLED;},selectedItem:function(){return{v:this.parent.parent.sortTxModel.sortdir};}},items:[{n:"Ascending",v:SORT_ASCENDING},{n:"Descending",v:SORT_DESCENDING}],onchange:function(){var sortTxModel=this.parent.parent.sortTxModel;selectedItem=this.selectedItem;sortTxModel.sortdir=(!!selectedItem)?selectedItem.v:SORT_DISABLED;}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442),onclick:function(){var ddic=mstrmojo.all.teModel.currentTxInput.ctl.ddic,sortTxModel=this.parent.parent.sortTxModel;ddic.sort=(sortTxModel.sortfmid!=="0")?{sortfmid:sortTxModel.sortfmid,sortdir:sortTxModel.sortdir}:null;this.parent.parent.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221),onclick:function(){this.parent.parent.close();}},]}],};}());