(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.Popup","mstrmojo.MenuItem");var $ID="mstrFilterPanelMenu",$BOX="mstrmojo.Box",$BOXC="mstrmojo-Menu-Box";var fnClearAllFilters=function(){var mn=mstrmojo.all[$ID],fps=mn.fps;fps.clearAllFilter();fps.applyBufferedSlices();mn.close();};var fnApplyBufferedSlices=function(){var mn=mstrmojo.all[$ID],fps=mn.fps;if(fps&&fps.applyBufferedSlices){fps.applyBufferedSlices();}mn.close();};var fnCollapseAll=function(){_dsChangeAll(false);};var fnExpandAll=function(){_dsChangeAll(true);};var fnSetAutoSubmit=function(){var mn=mstrmojo.all[$ID],fps=mn.fps,nv=!mn.autoSubmit;fps.applyBufferedSlices();fps.model.updateUnitFormat(fps,1,{FormattingLayout:{CtlAutoSubmit:(nv?1:0)}},{success:function(){var docPortlet=fps.parent;mn.set("autoSubmit",nv);mn.fps.defn.set("cas",nv);docPortlet.buttonbar.applyNow.set("visible",!nv);docPortlet.buttonbar.resetBtn.set("visible",!nv);docPortlet.adjustFPHeight2Fit();mstrmojo.css.toggleClass(docPortlet.buttonbarNode,"hide",nv);mstrmojo.css.toggleClass(docPortlet.toolbarNode,["cas"],!nv);}},{params:{suppressData:true}});mn.close();};function _dsChangeAll(bExpd){var mn=mstrmojo.all[$ID],fps=mn.fps,portlet=mstrmojo.DocPortlet,state=bExpd?portlet.ST_RESTORE:portlet.ST_MIN;if(!fps||!fps.children){return ;}var model=fps.model,actions=[];for(var i in fps.children){var pal=fps.children[i];if(!pal.children||!pal.selected){continue;}for(var j in pal.children){var s=pal.children[j];if(typeof (s.defn.ttl)!=="undefined"){actions.push(s.changeWindowState(state));}}}if(actions.length){model.getDataService().submitUpdates(actions,{},{preserveUndo:true,params:{suppressData:true}});}mn.close();}function createFPMnBtn(t,clkFn,bds){var btn={scriptClass:"mstrmojo.MenuItem",text:t,cssClass:"mstrmojo-InteractiveButton",onclick:clkFn,bindings:bds};return btn;}function createCheckableFPMnBtn(t,clkFn,bds){bds=bds||{};bds.pressed="mstrmojo.all['"+$ID+"'].autoSubmit";bds.iconClass="this.pressed?'pressed':''";var btn=createFPMnBtn(t,clkFn,bds);btn.onpressedChange=function(){if(this.domNode){mstrmojo.css.toggleClass(this.domNode,"pressed",this.pressed);}};return btn;}mstrmojo.FilterPanelMenu=mstrmojo.registry.ref({id:$ID,slot:"popupNode",scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-Menu",shadowNodeCssClass:"mstrmojo-Menu-shadow",contentNodeCssClass:"mstrmojo-Menu-content",locksHover:true,autoSubmit:true,onOpen:function onOpen(){var op=this.opener,opNode=op&&op[this.slot],opPos=mstrmojo.dom.position(opNode),opTop=opPos.y||0,cmPos=this.cmPos,x,y,diff;if(cmPos){x=cmPos.x;y=cmPos.y-opTop;}else{var el=this.openerButton.domNode;diff=mstrmojo.boxmodel.offset(el,opNode);x=diff.left;y=diff.top+((el&&el.offsetHeight)||0);}var dim=mstrmojo.dom.windowDim(),dn=this.domNode;var h=dn.offsetHeight,bH=dim.h-opTop;diff=Math.max(0,y+h-bH);this.set("top",y-diff+"px");var w=dn.offsetWidth,bW=dim.w;diff=Math.max(0,x+w-bW);this.set("left",x-diff+"px");this.set("autoSubmit",this.fps.defn.cas);},children:[{scriptClass:$BOX,bindings:{},cssClass:$BOXC,children:[createFPMnBtn(mstrmojo.desc(8974,"Clear all filters"),fnClearAllFilters,{}),createFPMnBtn("Apply Now",fnApplyBufferedSlices,{visible:"!mstrmojo.all['"+$ID+"'].autoSubmit",enabled:"mstrmojo.all['"+$ID+"'].fps.applyEnabled"})]},{scriptClass:$BOX,cssClass:$BOXC,bindings:{},children:[createFPMnBtn(mstrmojo.desc(8970,"Expand all"),fnExpandAll,{}),createFPMnBtn(mstrmojo.desc(8971,"Collapse all"),fnCollapseAll,{})]},{scriptClass:$BOX,cssClass:$BOXC,bindings:{},children:[createCheckableFPMnBtn(mstrmojo.desc(1996,"Auto-Apply changes"),fnSetAutoSubmit,{})]}]});}());