(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash","mstrmojo.Label","mstrmojo.array","mstrmojo.Popup","mstrmojo.Box","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.PopupConfig","mstrmojo.ui.Pulldown","mstrmojo.ui.editors.controls.LineStyleButton","mstrmojo.dom","mstrmojo.models.FormatModel","mstrmojo.VisUtility");var $ARR=mstrmojo.array,$HASH=mstrmojo.hash,$DOM=mstrmojo.dom,$UTIL=mstrmojo.VisUtility,OPACITY_ITEMS_NUMBER=11,ENUM_PROPERTY_NAMES=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES;function getOpacityItems(){var itemsNumber=OPACITY_ITEMS_NUMBER,i,ret=[],delta=Math.round(100/(itemsNumber-1));for(i=0;i<itemsNumber;i++){var value=(i*delta)/100,name=(i*delta)+"%";if(i===itemsNumber-1){name="100%";value=1;}ret.push({n:name,did:value});}return ret;}function getShapeItems(){var items=[{n:mstrmojo.desc(12100,"Circle"),did:"Circle"},{n:mstrmojo.desc(12101,"Square"),did:"Square"},{n:mstrmojo.desc(14433,"Diamond"),did:"Diamond"},{n:mstrmojo.desc(14434,"Hexagon"),did:"Hexagon"},{n:mstrmojo.desc(14435,"Triangle"),did:"Triangle"},{n:mstrmojo.desc(12103,"Ring"),did:"Ring"}];return items;}function findSelectedOpacityItemIndex(value){var itemsNumber=OPACITY_ITEMS_NUMBER,i,ret=0,delta=Math.round(100/(itemsNumber-1));value=Math.round(value*100);for(i=0;i<itemsNumber;i++){if(Math.abs(value-i*delta)<0.5*delta){ret=i;break;}}return ret;}function getRowContainer(children){children=children||[];$ARR.forEach(children,function(child){child.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.Box",cssClass:"row-container",children:children};}function getPulldown(items,selectedIndex,model,width){width=width||"60px";var pulldown=new mstrmojo.ui.Pulldown({items:items,width:width});pulldown.set("selectedIndex",selectedIndex);pulldown.postselectedIndexChange=function(evt){var newIndex=evt.value,newValue=items[newIndex]&&items[newIndex].did;model.setValue(newValue);};return{scriptClass:"mstrmojo.Box",children:[pulldown]};}function getLabel(label,cfg){return $HASH.copy(cfg,{scriptClass:"mstrmojo.Label",text:label,cssText:"width: 60px;"});}function findSelectedIndex(items,selectedValue){var ret;$ARR.forEach(items,function(item,i){if(item===selectedValue||item.did===selectedValue){ret=i;return false;}});return ret;}var configFactory={background:function(model,extraParam){var title=(extraParam&&extraParam.label)||mstrmojo.desc(3905,"Background"),theme=mstrApp.getThemeClassName()||"";return{scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+theme,locksHover:true,children:[getRowContainer([getLabel(title),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:theme,selectedValue:model.value.getValue(),model:model.value,showNoFill:false,width:"60px",postselectedValueChange:function(e){this.model.setValue(e.value);}}]}])]};},bubble:function(model,extraParam){var theme=mstrApp.getThemeClassName()||"",shapeModel=extraParam.alignment.attSrc==="from"?model.circleStyle.fromNode:model.circleStyle.toNode;return{scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+theme,locksHover:true,children:[getRowContainer([getLabel(mstrmojo.desc(2923,"Shape")),getPulldown(getShapeItems(),findSelectedIndex(getShapeItems(),shapeModel.shape.getValue()),shapeModel.shape,"128px")]),getRowContainer([getLabel(mstrmojo.desc(2885,"Fill")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:theme,showNoFill:false,selectedValue:shapeModel.color.value.getValue(),model:shapeModel.color.value,width:"60px",postselectedValueChange:function(e){if(!$HASH.equals(e.value,e.valueWas)){this.model.setValue(e.value);}}}]},getPulldown(getOpacityItems(),findSelectedOpacityItemIndex(shapeModel.color.opacity.getValue()),shapeModel.color.opacity)]),getRowContainer([getLabel(mstrmojo.desc(9736,"Border")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:theme,showNoFill:false,showGradient:false,selectedValue:shapeModel.border.color.value.getValue(),model:shapeModel.border.color.value,width:"60px",postselectedValueChange:function(e){this.model.setValue(e.value);}}]},{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.LineStyleButton",width:"60px",isHostedWithin:true,model:shapeModel.border.style,selectedValue:shapeModel.border.style.getValue(),postselectedValueChange:function(e){this.model.setValue(e.value);}}]}]),getRowContainer([getLabel(mstrmojo.desc(11993,"Data Labels")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.CharacterGroup",cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,showNoFillInColor:false,width:"380px",height:"22px,",onGroupValueChange:$UTIL.getCharGroupValueChangeCb(model.circleLabelStyle)}]}])]};}};function getConfig(type,model,e,extraParam){var factory=configFactory[type];if(factory){var config=factory(model,extraParam),containerPosition=$DOM.position(this.containerNode,true),x=e.pageX-containerPosition.x,y=e.pageY-containerPosition.y;var anchor=this._contextMenuAnchor;if(!anchor||!anchor.parentElement){anchor=document.createElement("div");anchor.style.position="absolute";this._contextMenuAnchor=anchor;this.containerNode.appendChild(anchor);}anchor.style.left=x+1+"px";anchor.style.top=y+1+"px";var popupConfig={hostId:this.id,hostElement:anchor,isHostedWithin:false};if(extraParam&&extraParam.alignment){popupConfig.alignment=extraParam.alignment;}config.popupConfig=new mstrmojo.ui.PopupConfig(popupConfig);config.visible=true;config.onClose=function(){this.unrender();};return config;}}mstrmojo.netviz._HasNetworkContextMenu=mstrmojo.provide("mstrmojo.netviz._HasNetworkContextMenu",{getWidget:function(){return this.owner;},showContextMenu:function(type,model,e,extraParam){var config=getConfig.call(this,type,model,e,extraParam);if(extraParam&&$UTIL.getPropertyByPath(extraParam,"alignment.attSrc",false)!==false){if(extraParam.alignment.attSrc==="from"){this.parent.textSelectedIndex=1;}else{this.parent.textSelectedIndex=2;}}if(type==="bubble"){config=mstrmojo.registry.ref(config);var charGroup=$UTIL.getPropertyByPath(config,"children.3.children.1.children.0");if(charGroup!==undefined){charGroup.setFormatSource(this.getDataLabelFormats());charGroup.fontColor.isHostedWithin=true;charGroup.fontSize.isHostedWithin=true;charGroup.fontFamily.isHostedWithin=true;}}this.openPopup(config);},unrender:function(params){this._contextMenuAnchor=undefined;this._super(params);}});}());