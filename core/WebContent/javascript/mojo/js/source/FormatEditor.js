(function(){mstrmojo.requiresCls("mstrmojo.color","mstrmojo.hash","mstrmojo.array","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.CheckBox","mstrmojo.DropDownButton","mstrmojo.Pulldown","mstrmojo.TristateCheckBox","mstrmojo.Container","mstrmojo.Table","mstrmojo.VBox","mstrmojo.HBox","mstrmojo.FieldSet","mstrmojo.Popup","mstrmojo.List","mstrmojo.Editor","mstrmojo._FormatDefinition","mstrmojo.ColorPicker");var $COLOR=mstrmojo.color,$HASH=mstrmojo.hash,$ARR=mstrmojo.array,$FORMATDEF=mstrmojo._FormatDefinition,$NUM=mstrmojo.num;var observableSets={FormattingNumber:true,FormattingBorder:true};var duration=350;function slideProp(show,target,prop,start,stop,onEnd,ease,extraProps){var props={duration:duration,target:target,onEnd:function(){if(onEnd){onEnd();}},props:{}};props.props[prop]={ease:ease||mstrmojo.ease.sin,start:parseInt(start,10),stop:parseInt(stop,10),suffix:"px"};props=mstrmojo.hash.copy(extraProps,props);var fx=new mstrmojo.fx.AnimateProp(props);fx.play();}function _saveModel(w){var cgeModel=w.model,feModel=mstrmojo.all.feModel.model,df=$FORMATDEF.DefaultFormat,i;for(i=0;i<feModel.items.length;i++){var j;for(j=0;j<4;j++){var which=["header_format","grid_format","child_header_format","child_grid_format"][j];var cgef=cgeModel.items[i][which]||null;var fef=feModel.items[i][which];if(fef===undefined){delete cgeModel.items[i][which];continue;}var ps;for(ps in df){var PS=df[ps];if((!cgef&&!fef)||(cgef&&!cgef[ps]&&!fef[ps])){continue;}var p;for(p in PS){var P=PS[p];if(fef[ps]===undefined||fef[ps]===""){if(cgef&&cgef[ps]){delete cgef[ps];}}else{if(fef[ps][p]==="pru"||(fef[ps][p]===undefined&&cgef&&cgef[ps]&&cgef[ps][p]!==undefined)){delete fef[ps][p];if(cgef&&cgef[ps]&&cgef[ps][p]){cgef[ps][p]="pru";}}else{if(fef[ps][p]!==undefined){cgef=cgef||{};cgef[ps]=cgef[ps]||{};cgef[ps][p]=fef[ps][p];}}}}}if(cgef){cgeModel.items[i][which]=cgef;}}}}var _triStateCheckBox=function(ps){var alias=ps.alias,label=ps.label,prs=ps.prs,pr=ps.pr;return{alias:alias,scriptClass:"mstrmojo.TristateCheckBox",text:label,checked:false,grayed:false,bindings:{checked:function(){return parseInt(mstrmojo.all.feModel.currentFormat[prs][pr],10)===-1;},grayed:function(){return(mstrmojo.all.feModel.currentFormat[prs][pr]==="undefined");}},oncheckedChange:function(){mstrmojo.all.feModel.currentFormat[prs][pr]=this.checked?-1:0;}};};var createRightPanel=function(ps){return $HASH.copy(ps,{scriptClass:"mstrmojo.Container",markupString:'<div id={@id} class="mstrmojo-FormatEditor-rightPanel {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){if(!this.useAnimate){this.domNode.style.display=this.visible?"block":"none";}}},useAnimate:true,width:"420px",ease:"mstrmojo.ease.sin"});};var fontPanelWidget=createRightPanel({alias:"font",cssClass:"fontPanel",cssText:"z-index:2; overflow:visible;",children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-fontTable",rows:2,cols:3,cellPadding:5,layout:[{cells:[{},{},{}]},{cells:[{},{colSpan:2}]}],children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2172),slot:"0,0"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3059),slot:"0,1"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2178),slot:"0,2"},{scriptClass:"mstrmojo.List",alias:"fontFamily",cssClass:"mstrmojo-FormatEditor-fontFamily",itemCssClass:"mstrmojo-FormatEditor-bullet",selectedIndex:0,itemMarkup:'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text" style="font-family:{@n}">{@n}</div></div>',items:$FORMATDEF.Families,bindings:{selectedIndex:function(){var idx=$ARR.find($FORMATDEF.Families,"v",mstrmojo.all.feModel.currentFormat.FormattingFont.Name);return idx===-1?0:idx;}},onchange:function(){mstrmojo.all.feModel.currentFormat.FormattingFont.Name=this.selectedItem.v;},slot:"0,0"},{scriptClass:"mstrmojo.List",alias:"fontStyle",cssClass:"mstrmojo-FormatEditor-fontStyle",itemCssClass:"mstrmojo-FormatEditor-bullet",selectedIndex:0,itemMarkup:'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">{@n}</div></div>',items:$FORMATDEF.Styles,bindings:{selectedIndex:function(){var bold=mstrmojo.all.feModel.currentFormat.FormattingFont.Bold||"",italic=mstrmojo.all.feModel.currentFormat.FormattingFont.Italic||"",style=(bold===""&&italic==="")?"":bold+","+italic,idx=$ARR.find($FORMATDEF.Styles,"v",style);idx=idx===-1?$ARR.find($FORMATDEF.Styles,"v2",style):idx;return(idx===-1?0:idx);}},onchange:function(){var bold="pru",italic="pru";switch(this.selectedIndex){case 0:break;case 1:bold=0;italic=0;break;case 2:bold=-1;italic=0;break;case 3:bold=0;italic=-1;break;case 4:bold=-1;italic=-1;break;}mstrmojo.all.feModel.currentFormat.FormattingFont.Bold=bold;mstrmojo.all.feModel.currentFormat.FormattingFont.Italic=italic;},slot:"0,1"},{scriptClass:"mstrmojo.List",alias:"fontSize",cssClass:"mstrmojo-FormatEditor-fontSize",itemCssClass:"mstrmojo-FormatEditor-bullet",selectedIndex:0,itemMarkup:'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">{@n}</div></div>',items:$FORMATDEF.Sizes,bindings:{selectedIndex:function(){var idx=$ARR.find($FORMATDEF.Sizes,"v",mstrmojo.all.feModel.currentFormat.FormattingFont.Size);return idx===-1?0:idx;}},onchange:function(evt){mstrmojo.all.feModel.currentFormat.FormattingFont.Size=this.selectedItem.v;},slot:"0,2"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3060),slot:"1,0"},{scriptClass:"mstrmojo.VBox",alias:"fontEffect",cssClass:"mstrmojo-FormatEditor-fontEffect",children:[_triStateCheckBox({alias:"Underline",label:mstrmojo.desc(3061),prs:"FormattingFont",pr:"Underline"}),_triStateCheckBox({alias:"Strikeout",label:mstrmojo.desc(3062),prs:"FormattingFont",pr:"Strikeout"})],slot:"1,0"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3063),slot:"1,1"},mstrmojo.ColorPicker.createDropDown({alias:"fontColor",pr:"Color",bindings:{fillColor:function(){var color=mstrmojo.all.feModel.currentFormat.FormattingFont[this.pr];if(color!==undefined&&/^\d{1,8}$/.test(color)){return $COLOR.decodeColor(color);}return"transparent";}},onfillColorChange:function(){mstrmojo.all.feModel.currentFormat.FormattingFont[this.pr]=(this.fillColor==="transparent"?"pru":$COLOR.encodeColor(this.fillColor));},slot:"1,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2036),slot:"1,1"},{scriptClass:"mstrmojo.Label",alias:"fontPreview",cssClass:"mstrmojo-FormatEditor-fontPreview",text:mstrmojo.desc(2037),bindings:{cssText:function(){var color=this.parent.fontColor.fillColor,size=this.parent.fontSize.selectedItem.v,family=this.parent.fontFamily.selectedItem.v;color=/^#[a-f0-9]{6}$/i.test(color)?color:$COLOR.decodeColor($FORMATDEF.DefaultFormat.FormattingFont.Color);size=size||$FORMATDEF.DefaultFormat.FormattingFont.Size;family=family||$FORMATDEF.DefaultFormat.FormattingFont.Name;return";font-family:"+family+";font-style:"+["default","normal","normal","italic","italic"][this.parent.fontStyle.selectedIndex]+";font-weight:"+["default","normal","bold","normal","bold"][this.parent.fontStyle.selectedIndex]+";font-size:"+size+"pt;color:"+color+";text-decoration:"+(this.parent.fontEffect.Underline.checked?" underline ":"")+(this.parent.fontEffect.Strikeout.checked?" line-through ":"");}},slot:"1,1"}]}]});var createDecimalBox=function(ps){return mstrmojo.hash.copy(ps,{scriptClass:"mstrmojo.TextBox",alias:"decimalPlaces",bindings:{value:function(){return mstrmojo.all.feModel.currentFormat.FormattingNumber.DecimalPlaces||"2";},category:function(){var category=mstrmojo.all.feModel.currentFormat.FormattingNumber.Category;this.onkeyup();}},onkeyup:function(evt){if(/^\d{1,2}$/.test(this.value)){var was=mstrmojo.all.feModel.currentFormat.FormattingNumber.DecimalPlaces,v=this.value;mstrmojo.all.feModel.currentFormat.FormattingNumber.DecimalPlaces=v;if(was!==v&&this.negative){var negative=this.parent[this.negative],itms;if(negative&&negative.refreshFormatList){negative.refreshFormatList();}else{itms=mstrmojo.hash.clone($FORMATDEF[this.negative]);if(itms){var digits=v>0?".":"",zeros=digits,i;for(i=0;i<Math.min(v,$FORMATDEF.MaxNegativeDidigts);i++){digits+=i%9;zeros+="0";}for(i=0;i<itms.length;i++){itms[i].n=itms[i].n.replace(/\.\d{2}/g,digits);itms[i].f=itms[i].f.replace(/\.\d{2}/g,zeros);}negative.set("items",itms);}}}}}});},createNegativeList=function(ps){return mstrmojo.hash.copy(ps,{scriptClass:"mstrmojo.List",cssClass:"mstrmojo-FormatEditor-numberFormatList",itemMarkupFunction:function(item,idx,widget){var color=item.r?"color: red":"";return'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text" style="'+color+'">'+item.n+"</div></div>";},selectionPolicy:"reselect",bindings:{selectedIndex:function(){var idx=$ARR.find(this.items,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.NegativeNumbers);if(idx===-1){idx=$ARR.find(this.items,"f",mstrmojo.all.feModel.currentFormat.FormattingNumber.Format);}this.singleSelect(idx);return idx===-1?3:idx;},category:function(){var category=mstrmojo.all.feModel.currentFormat.FormattingNumber.Category;this.onchange();}},onchange:function(evt){if(this.parent.idx===$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)&&this.selectedItem){mstrmojo.all.feModel.currentFormat.FormattingNumber.NegativeNumbers=this.selectedItem.v;mstrmojo.all.feModel.currentFormat.FormattingNumber.set("Format",this.selectedItem.f||this.selectedItem.v);}},postCreate:function(){var d=mstrmojo.all.feModel.currentFormat.FormattingNumber.DecimalPlaces;if(parseInt(d,10)!==2){var itms=mstrmojo.hash.clone($FORMATDEF[this.alias]);if(itms){var digits=d>0?".":"",zeros=digits,i;for(i=0;i<Math.min(d,$FORMATDEF.MaxNegativeDidigts);i++){digits+=i%9;zeros+="0";}for(i=0;i<itms.length;i++){itms[i].n=itms[i].n.replace(/\.\d{2}/g,digits);itms[i].f=itms[i].f.replace(/\.\d{2}/g,zeros);}this.set("items",itms);}}}});},createNumberFormatList=function(ps){return mstrmojo.hash.copy(ps,{scriptClass:"mstrmojo.List",cssClass:"mstrmojo-FormatEditor-numberFormatList "+ps.alias,itemMarkupFunction:function(item,idx,widget){return'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">'+item.n+"</div></div>";},selectedIndex:0,bindings:{selectedIndex:function(evt){var idx=$ARR.find(this.items,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Format);return idx===-1?0:idx;},category:function(){var category=mstrmojo.all.feModel.currentFormat.FormattingNumber.Category;this.onchange();}},onchange:function(evt){if(this.parent.idx===$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)){mstrmojo.all.feModel.currentFormat.FormattingNumber.set("Format",this.selectedItem.f||this.selectedItem.v);}}});};var numberPanelWidget=createRightPanel({alias:"number",cssText:"width:0;",cssClass:"numberPanel",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(7940,"Category"),cssClass:"category",cssText:"font-weightx: bold"},{scriptClass:"mstrmojo.List",alias:"numberCategory",cssClass:"mstrmojo-FormatEditor-numberCategory",items:$FORMATDEF.Category,selectionPolicy:"reselect",bindings:{selectedIndex:function(){var cat=mstrmojo.all.feModel.currentFormat.FormattingNumber.Category,idx=$ARR.find(this.items,"v",(cat==="pru"?-2:cat));return(idx===-1)?0:idx;}},onchange:function(evt){mstrmojo.all.feModel.currentFormat.FormattingNumber.set("Category",this.selectedIndex===0?"pru":this.selectedItem.v);var subPanelContainer=this.parent.numberSubpanelContainer;if(this.hasRendered&&subPanelContainer.domNode){var width=300,start=-(evt.removed[0]||0)*width,stop=-this.selectedIndex*width;slideProp(true,subPanelContainer.containerNode,"left",start,stop,null,null,{duration:20,interval:15});}}},{scriptClass:"mstrmojo.Container",alias:"numberSubpanelContainer",width:"300px",markupString:'<div id={@id} class="mstrmojo-FormatEditor-numberPanel-subpanel {@cssClass}"><div class="mstrmojo-FormatEditor-numberPanel-subpanel-container"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},postBuildRendering:function(){var ret=mstrmojo.Container.prototype.postBuildRendering.apply(this);this.parent.numberCategory.singleSelect(this.parent.numberCategory.selectedIndex);return ret;},children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item",idx:0,rows:1,cols:1,children:[{scriptClass:"mstrmojo.Label",text:" ",slot:"0,0"}],bindings:{category:function(){if(this.idx===$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)){mstrmojo.all.feModel.currentFormat.FormattingNumber.set("Format","");}}}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item",idx:1,rows:1,cols:1,children:[{scriptClass:"mstrmojo.Label",text:" ",slot:"0,0"}],bindings:{category:function(){if(this.idx===$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)){mstrmojo.all.feModel.currentFormat.FormattingNumber.set("Format","");}}}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item fixed",idx:2,rows:3,cols:2,layout:[{cells:[{},{}]},{cells:[{},{}]},{cells:[{colSpan:2}]}],children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2046),slot:"0,0"},createDecimalBox({negative:"FixedNegative",alias:"FixedDecimalPlaces",slot:"0,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2044),slot:"1,0"},createNegativeList({items:$FORMATDEF.FixedNegative,refreshFormatList:function(){var p=this.parent,fdp=p&&p.FixedDecimalPlaces,ts=p&&p.ThousandSeparator;if(!fdp||!ts){return ;}var cd=fdp.value||0,itms=mstrmojo.hash.clone($FORMATDEF.FixedNegative),uts=ts.checked,dgs=cd>0?".":"",zrs=dgs,ns,len=Math.min(cd,$FORMATDEF.MaxNegativeDidigts),d;for(d=0;d<len;d++){dgs+=d%9;zrs+="0";}var i;for(i=0;i<itms.length;i++){ns=itms[i].n.replace(/\.\d{2}/g,dgs);if(!uts){ns=ns.replace("1,234","1234");}itms[i].n=ns;ns=itms[i].f.replace(/\.\d{2}/g,zrs);if(!uts){ns=ns.replace(/#,##/g,"###");}itms[i].f=ns;}this.set("items",itms);},alias:"FixedNegative",slot:"1,1"}),{scriptClass:"mstrmojo.ImageCheckBox",alias:"ThousandSeparator",label:mstrmojo.desc(2049),cssText:"width:auto;",bindings:{checked:function(){var ts=mstrmojo.all.feModel.currentFormat.FormattingNumber.ThousandSeparator;if(ts==null){ts=-1;}return parseInt(ts,10)!==0;}},oncheckedChange:function(){if(this.parent.idx===$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)){mstrmojo.all.feModel.currentFormat.FormattingNumber.ThousandSeparator=this.checked?-1:0;this.parent.FixedNegative.refreshFormatList();}},slot:"2,0"}]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item currency",idx:3,rows:4,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2046),slot:"0,0"},createDecimalBox({negative:"CurrencyNegative",alias:"currencyDecimal",slot:"0,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2047),slot:"1,0"},{scriptClass:"mstrmojo.TextBox",alias:"currencySymbol",maxLength:5,bindings:{value:function(){return mstrmojo.all.feModel.currentFormat.FormattingNumber.CurrencySymbol||mstrmojo.desc("2369");},category:function(){if(this.parent.idx==$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)){this.onkeyup();}}},onkeyup:function(evt){this._update();},onvalueChange:function(){this._update();},_update:function(){var was=mstrmojo.all.feModel.currentFormat.FormattingNumber.CurrencySymbol;mstrmojo.all.feModel.currentFormat.FormattingNumber.CurrencySymbol=this.value;var negative=this.parent.CurrencyNegative;if(negative&&(was!=this.value)){negative.refreshFormatList();}},slot:"1,1"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2048),slot:"2,0"},{scriptClass:"mstrmojo.List",cssClass:"mstrmojo-FormatEditor-numberFormatList",alias:"CurrencyPosition",items:$FORMATDEF.CurrencyPosition,itemMarkupFunction:function(item,idx,widget){return'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">'+item.n+"</div></div>";},bindings:{selectedIndex:function(){var idx=$ARR.find($FORMATDEF.CurrencyPosition,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.CurrencyPosition);return(idx==-1?0:idx);},category:function(){if(this.parent.idx==$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)){this.onchange();}}},onchange:function(evt){mstrmojo.all.feModel.currentFormat.FormattingNumber.CurrencyPosition=this.selectedItem.v;var negative=this.parent.CurrencyNegative;if(negative){negative.refreshFormatList();}},slot:"2,1"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2044),slot:"3,0"},createNegativeList({items:$FORMATDEF.CurrencyNegative,refreshFormatList:function(){var p=this.parent,cdt=p&&p.currencyDecimal,cpl=p&&p.CurrencyPosition,cst=p&&p.currencySymbol;if(!cdt||!cpl||!cst){return ;}var cd=cdt.value||0,cp=cpl.selectedIndex||0,cs=cst.value||"",cs=(cp==2?cs+" ":(cp==3?" "+cs:cs)),itms=mstrmojo.hash.clone($FORMATDEF.CurrencyNegative),dgs=cd>0?".":"",zrs=dgs,fa;for(var d=0,len=Math.min(cd,$FORMATDEF.MaxNegativeDidigts);d<len;d++){dgs+=d%9;zrs+="0";}for(var i=0;i<itms.length;i++){if(cp==1||cp==3){fa=itms[i].f.split(";");for(var j=0,len=fa.length;j<len;j++){fa[j]=fa[j].replace(/(\"\$\")(.*)/g,"$2$1");}itms[i].n=itms[i].n.replace(/(\$)(.*)/g,"$2$1");itms[i].f=fa.join(";");}itms[i].n=itms[i].n.replace(/\$/g,cs).replace(/\.\d{2}/g,dgs);itms[i].f=itms[i].f.replace(/\$/g,cs).replace(/\.\d{2}/g,zrs);}this.set("items",itms);},alias:"CurrencyNegative",slot:"3,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item Date",idx:4,rows:1,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2869),slot:"0,0"},createNumberFormatList({items:$FORMATDEF.Date,alias:"Date",slot:"0,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item Time",idx:5,rows:1,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2869),slot:"0,0"},createNumberFormatList({items:$FORMATDEF.Time,alias:"Time",slot:"0,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item percentage",idx:6,rows:2,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2046),slot:"0,0"},createDecimalBox({negative:"PercentNegative",slot:"0,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2044),slot:"1,0"},createNegativeList({items:$FORMATDEF.PercentNegative,alias:"PercentNegative",slot:"1,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item Fraction",idx:7,rows:1,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2869),slot:"0,0"},createNumberFormatList({items:$FORMATDEF.Fraction,alias:"Fraction",slot:"0,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item scientific",idx:8,rows:1,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2046),slot:"0,0"},createDecimalBox({slot:"0,1"})],bindings:{category:function(){if(this.idx==$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)){mstrmojo.all.feModel.currentFormat.FormattingNumber.set("Format","0.00E+00");}}}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item custom",idx:9,rows:1,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2133),slot:"0,0"},{scriptClass:"mstrmojo.TextBox",alias:"custom",value:"",bindings:{value:function(){return mstrmojo.all.feModel.currentFormat.FormattingNumber.Format;}},onvalueChange:function(){if(this.parent.idx==$ARR.find($FORMATDEF.Category,"v",mstrmojo.all.feModel.currentFormat.FormattingNumber.Category)){mstrmojo.all.feModel.currentFormat.FormattingNumber.Format=this.value;}},slot:"0,1"}]}]}]});var createPaddingBox=function(ps){return mstrmojo.hash.copy(ps,{scriptClass:"mstrmojo.ValidationTextBox",maxLength:6,dtp:4,min:0,max:100,constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP},bindings:{value:function(){var v=mstrmojo.all.feModel.currentFormat.FormattingPadding[this.pr];return v==null?"":this._PT2UserUnits(v).replace(/0{1,}$/,"").replace(/\.$/,".0").replace(/,$/,",0");}},postCreate:function(){this.markupMethods=mstrmojo.hash.copy({onvalueChange:function(){this.inputNode.value=this.value;}},mstrmojo.hash.copy(this.markupMethods));},onValid:function(){mstrmojo.all.feModel.currentFormat.FormattingPadding[this.pr]=this._UserUnits2PT(this.value);},_PT2UserUnits:function(v){return $NUM.toLocaleString($NUM.convertToLocalUnits($NUM.toString(v)/72));},_UserUnits2PT:function(v){return $NUM.toLocaleString($NUM.toString($NUM.convertToUSUnits(v))*72);}});};var createPaddingBoxLabel=function(text,slot){return{scriptClass:"mstrmojo.Label",text:text,slot:slot};};var _alignmentPanelWidget=createRightPanel({alias:"alignment",cssClass:"alignmentPanel",cssText:"width:0;",children:[{scriptClass:"mstrmojo.FieldSet",alias:"textAlignment",cssClass:"mstrmojo-FormatEditor-textAlignment",legend:mstrmojo.desc(2065),children:[{scriptClass:"mstrmojo.Table",rows:2,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3691),slot:"0,0"},{scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:$FORMATDEF.Horizontal,bindings:{value:"mstrmojo.all.feModel.currentFormat.FormattingAlignment.Horizontal"},onvalueChange:function(){mstrmojo.all.feModel.currentFormat.FormattingAlignment.Horizontal=this.value;},slot:"0,1"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3692),slot:"1,0"},{scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:$FORMATDEF.Vertical,bindings:{value:"mstrmojo.all.feModel.currentFormat.FormattingAlignment.Vertical"},onvalueChange:function(){mstrmojo.all.feModel.currentFormat.FormattingAlignment.Vertical=this.value;},slot:"1,1"}]}]},{scriptClass:"mstrmojo.FieldSet",alias:"textControl",cssClass:"mstrmojo-FormatEditor-textControl",legend:mstrmojo.desc(2884),children:[_triStateCheckBox({alias:"TextWrap",label:mstrmojo.desc(2070),prs:"FormattingAlignment",pr:"TextWrap"}),{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5159)},{scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:$FORMATDEF.TextDirection,bindings:{value:"mstrmojo.all.feModel.currentFormat.FormattingAlignment.TextDirection"},onvalueChange:function(){mstrmojo.all.feModel.currentFormat.FormattingAlignment.TextDirection=this.value;},slot:"1,1"}]}]},{scriptClass:"mstrmojo.FieldSet",alias:"padding",cssClass:"mstrmojo-FormatEditor-padding",legend:mstrmojo.desc(2883),children:[{scriptClass:"mstrmojo.HBox",cssClass:"paddingBox",children:[{scriptClass:"mstrmojo.Table",rows:2,cols:3,children:[createPaddingBoxLabel(mstrmojo.desc(3528),"0,0"),createPaddingBox({pr:"LeftPadding",slot:"0,1"}),createPaddingBoxLabel(mstrApp.unitsLabel,"0,2"),createPaddingBoxLabel(mstrmojo.desc(3526),"1,0"),createPaddingBox({pr:"TopPadding",slot:"1,1"}),createPaddingBoxLabel(mstrApp.unitsLabel,"1,2")]},{scriptClass:"mstrmojo.Table",rows:2,cols:3,children:[createPaddingBoxLabel(mstrmojo.desc(3529),"0,0"),createPaddingBox({pr:"RightPadding",slot:"0,1"}),createPaddingBoxLabel(mstrApp.unitsLabel,"0,2"),createPaddingBoxLabel(mstrmojo.desc(3527),"1,0"),createPaddingBox({pr:"BottomPadding",slot:"1,1"}),createPaddingBoxLabel(mstrApp.unitsLabel,"1,2")]}]}]}]});var _updateBorder=function(n,v){var labels=["Left","Right","Top","Bottom"];for(var i=0;i<3;i++){mstrmojo.all.feModel.currentFormat.FormattingBorder[labels[i]+n]=v;}mstrmojo.all.feModel.currentFormat.FormattingBorder.set(labels[3]+n,v);};var _colorLinePanelWidget=createRightPanel({alias:"colorLine",cssClass:"colorLinePanel",cssText:"width:0;",children:[{scriptClass:"mstrmojo.FieldSet",alias:"fill",cssClass:"mstrmojo-FormatEditor-fill",legend:mstrmojo.desc(2885),children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2060),cssClass:"label"},mstrmojo.ColorPicker.createDropDown({bindings:{fillStyle:function(){var fp=mstrmojo.all.feModel.currentFormat.FormattingPatterns,fillStyle=fp.FillStyle;if(fillStyle==2){var angle=parseInt(fp.GradientAngle,10),type=angle===0?1:0,fillColor=$COLOR.decodeColor(fp.FillColor),gradientColor=$COLOR.decodeColor(fp.GradientColor),offsetIndex=parseInt(fp["Gradient"+(angle===0?"X":"Y")+"Offset"],10)==100?1:0,gradientCss=(offsetIndex!=1)?mstrmojo.css.buildGradient(type,fillColor,gradientColor):mstrmojo.css.buildGradient(type,gradientColor,fillColor);this.set("gradientCss",gradientCss.n+":"+gradientCss.v);this._updateGradientInfo();}else{var color=mstrmojo.all.feModel.currentFormat.FormattingPatterns.FillColor;if(typeof (color)!="undefined"&&/^\d{1,8}$/.test(color)){color=$COLOR.decodeColor(color);}else{color="transparent";}this.set("fillColor",color);}return fillStyle||0;}},_updateGradientInfo:function(){var fp=mstrmojo.all.feModel.currentFormat.FormattingPatterns;this.gradient=mstrmojo.hash.copy({FillColor:$COLOR.decodeColor(fp.FillColor),GradientColor:$COLOR.decodeColor(fp.GradientColor)},mstrmojo.hash.copy(fp));},onfillColorChange:function(){mstrmojo.all.feModel.currentFormat.FormattingPatterns.FillColor=(this.fillColor=="transparent"?"pru":$COLOR.encodeColor(this.fillColor));mstrmojo.all.feModel.currentFormat.FormattingPatterns.FillStyle=0;},ongradientChange:function(evt){var g=["FillStyle","FillColor","GradientColor","GradientXOffset","GradientYOffset","GradientAngle"];for(var i=0;i<g.length;i++){var v=evt.value[g[i]];mstrmojo.all.feModel.currentFormat.FormattingPatterns[g[i]]=/Color$/.test(g[i])?$COLOR.encodeColor(v):v;}mstrmojo.all.feModel.currentFormat.FormattingPatterns.FillStyle=2;}},{showGradients:true})]},{scriptClass:"mstrmojo.FieldSet",alias:"borders",cssClass:"mstrmojo-FormatEditor-border",legend:mstrmojo.desc(2886),children:[{scriptClass:"mstrmojo.Table",alias:"borderTable",cssText:"width:100%;",rows:1,cols:2,children:[{scriptClass:"mstrmojo.List",alias:"borderTypes",pidx:0,cssClass:"borderTypes",items:[{n:'<img border="0" align="absmiddle" src="../images/borders_none.gif" alt=""> '+mstrmojo.desc(2057),v:1},{n:'<img border="0" align="absmiddle" src="../images/borders_all.gif" alt=""> '+mstrmojo.desc(2058),v:2},{n:'<img border="0" align="absmiddle" src="../images/borders_custom.gif" alt=""> '+mstrmojo.desc(2056),v:3}],slot:"0,0",oldSI:-1,onchange:function(evt){mstrmojo.all.feModel.set("pidx",this.selectedIndex);var widget=this.parent.borderAndColor;if(!widget){return ;}var rowHeight=30,fullHeight=105,allBordersContainer=widget.allBordersContainer.domNode,customBordersContainer=widget.customBordersContainer.domNode,oldSI=this.oldSI,h1Start,h1Stop,h2Start,h2Stop;switch(this.selectedIndex){case 0:h1Stop=0;h2Stop=0;if(oldSI===1){h1Start=rowHeight;h2Start=0;}else{h1Start=0;h2Start=fullHeight;}break;case 1:h1Start=0;h1Stop=rowHeight;if(oldSI===0){h2Start=h2Stop=0;}else{h2Start=fullHeight;h2Stop=0;}break;case 2:h2Start=0;h2Stop=fullHeight;if(oldSI===0){h1Start=h1Stop=0;}else{h1Start=rowHeight;h1Stop=0;}break;}allBordersContainer.style.display="block";customBordersContainer.style.display="block";slideProp(true,allBordersContainer,"height",h1Start,h1Stop,function(){widget.allBordersContainer.allBorders.set("show",h1Stop>h1Start);},null,{durationx:1500});slideProp(true,customBordersContainer,"height",h2Start,h2Stop,function(){widget.customBordersContainer.customBorders.set("show",h2Stop>h2Start);},null,{durationx:1500});this.oldSI=this.selectedIndex;if(this.selectedIndex===0){var labels=["Left","Right","Top","Bottom"];for(var i=0;i<4;i++){mstrmojo.all.feModel.currentFormat.FormattingBorder.set(labels[i]+"Style","0");mstrmojo.all.feModel.currentFormat.FormattingBorder.set(labels[i]+"Color","0");}}},bindings:{selectedIndex:function(){if(!this.parent.borderAndColor){return ;}var bs=mstrmojo.all.feModel.currentFormat.FormattingBorder;if($HASH.isEmpty(bs)){return 0;}if(bs.LeftStyle==0&&bs.TopStyle==0&&bs.RightStyle==0&&bs.BottomStyle==0){return 0;}else{if(bs.LeftStyle==bs.TopStyle&&bs.LeftStyle==bs.RightStyle&&bs.LeftStyle==bs.BottomStyle){return 1;}}return 2;}}},{scriptClass:"mstrmojo.Container",alias:"borderAndColor",markupString:'<div class="borderStyles"></div>',markupSlots:{containerNode:function(){return this.domNode;}},children:[{scriptClass:"mstrmojo.Container",alias:"allBordersContainer",markupString:'<div class="mstrmojo-FormatEditor-ColorLine-borders"></div>',markupSlots:{containerNode:function(){return this.domNode;}},children:[{scriptClass:"mstrmojo.Table",alias:"allBorders",rows:1,cols:3,onshowChange:function(){if(this.show){_updateBorder("Style",this.styles.value);_updateBorder("Color",$COLOR.encodeColor(this.colors.fillColor));}},postCreate:function(){var labels=["Left","Right","Top","Bottom"];var children=[{scriptClass:"mstrmojo.Pulldown",alias:"styles",pidx:1,items:$FORMATDEF.BorderStyles,itemIdField:"v",bindings:{value:function(){var l=mstrmojo.all.feModel.currentFormat.FormattingBorder.LeftStyle,r=mstrmojo.all.feModel.currentFormat.FormattingBorder.RightStyle,t=mstrmojo.all.feModel.currentFormat.FormattingBorder.TopStyle,b=mstrmojo.all.feModel.currentFormat.FormattingBorder.BottomStyle;var idx=0;if(l==r&&r==b&&b==t){idx=$ARR.find($FORMATDEF.BorderStyles,"v",l);}idx=idx==-1?0:idx;return this.items[idx][this.itemIdField];}},onvalueChange:function(){if(mstrmojo.all.feModel.pidx==this.pidx){_updateBorder("Style",this.value);}},slot:"0,1"},mstrmojo.ColorPicker.createDropDown({alias:"colors",pidx:1,pr:"LeftColor",bindings:{fillColor:function(){var l=mstrmojo.all.feModel.currentFormat.FormattingBorder.LeftColor,r=mstrmojo.all.feModel.currentFormat.FormattingBorder.RightColor,t=mstrmojo.all.feModel.currentFormat.FormattingBorder.TopColor,b=mstrmojo.all.feModel.currentFormat.FormattingBorder.BottomColor;if(l==r&&r==b&&b==t){var color=l;}if(typeof (color)!="undefined"&&/^\d{1,8}$/.test(color)){return $COLOR.decodeColor(color);}return"transparent";}},onfillColorChange:function(){if(mstrmojo.all.feModel.pidx==this.pidx){_updateBorder("Color",this.fillColor=="transparent"?"pru":$COLOR.encodeColor(this.fillColor));}},slot:"0,2"})];this.addChildren(children);}}]},{scriptClass:"mstrmojo.Container",alias:"customBordersContainer",markupString:'<div class="mstrmojo-FormatEditor-ColorLine-borders"></div>',markupSlots:{containerNode:function(){return this.domNode;}},children:[{scriptClass:"mstrmojo.Table",alias:"customBorders",rows:1,cols:3,idx:2,postCreate:function(){var labels=["Left","Right","Top","Bottom"];var children=[];for(var i=0;i<labels.length;i++){var label=labels[i];children.push({scriptClass:"mstrmojo.Label",text:mstrmojo.desc({Left:3528,Right:3529,Top:3526,Bottom:3527}[label]),alias:label,slot:"0,0"},{scriptClass:"mstrmojo.Pulldown",pidx:2,items:$FORMATDEF.BorderStyles,itemIdField:"v",pr:label+"Style",bindings:{value:function(){var l=mstrmojo.all.feModel.currentFormat.FormattingBorder.LeftStyle,r=mstrmojo.all.feModel.currentFormat.FormattingBorder.RightStyle,t=mstrmojo.all.feModel.currentFormat.FormattingBorder.TopStyle,b=mstrmojo.all.feModel.currentFormat.FormattingBorder.BottomStyle;var idx=$ARR.find($FORMATDEF.BorderStyles,"v",mstrmojo.all.feModel.currentFormat.FormattingBorder[this.pr]);idx=idx==-1?0:idx;return this.items[idx][this.itemIdField];}},onvalueChange:function(){if(mstrmojo.all.feModel.pidx==this.pidx){mstrmojo.all.feModel.currentFormat.FormattingBorder.set(this.pr,this.value);}},slot:"0,1"},mstrmojo.ColorPicker.createDropDown({cssClassx:"mstrmojo-FormatEditor-colorPicker",alias:label+"Color",pidx:2,pr:label+"Color",bindings:{fillColor:function(){var l=mstrmojo.all.feModel.currentFormat.FormattingBorder.LeftColor,r=mstrmojo.all.feModel.currentFormat.FormattingBorder.RightColor,t=mstrmojo.all.feModel.currentFormat.FormattingBorder.TopColor,b=mstrmojo.all.feModel.currentFormat.FormattingBorder.BottomColor;var color=mstrmojo.all.feModel.currentFormat.FormattingBorder[this.pr];if(typeof (color)!="undefined"&&/^\d{1,8}$/.test(color)){return $COLOR.decodeColor(color);}return"transparent";}},onfillColorChange:function(){if(mstrmojo.all.feModel.pidx==this.pidx){mstrmojo.all.feModel.currentFormat.FormattingBorder.set(this.pr,this.fillColor=="transparent"?"pru":$COLOR.encodeColor(this.fillColor));}},slot:"0,2"}));}this.addChildren(children);}}]}],slot:"0,1"}]},{scriptClass:"mstrmojo.Label",cssClass:"borderPreview",text:mstrmojo.desc(7941),bindings:{cssText:function(){var borderStyles={0:"None",3:"Dashed",4:"Dotted",6:"Double",7:"Solid"},borderSizes={1:"Thin",5:"Thick",6:"medium"};var bordertype=this.parent.borderTable.borderTypes.selectedIndex;return";border-left-style: "+(borderStyles[mstrmojo.all.feModel.currentFormat.FormattingBorder.LeftStyle]||"solid")+";border-right-style: "+(borderStyles[mstrmojo.all.feModel.currentFormat.FormattingBorder.RightStyle]||"solid")+";border-top-style: "+(borderStyles[mstrmojo.all.feModel.currentFormat.FormattingBorder.TopStyle]||"solid")+";border-bottom-style: "+(borderStyles[mstrmojo.all.feModel.currentFormat.FormattingBorder.BottomStyle]||"solid")+";border-left-color: "+$COLOR.decodeColor(mstrmojo.all.feModel.currentFormat.FormattingBorder.LeftColor||"0")+";border-right-color: "+$COLOR.decodeColor(mstrmojo.all.feModel.currentFormat.FormattingBorder.RightColor||"0")+";border-top-color: "+$COLOR.decodeColor(mstrmojo.all.feModel.currentFormat.FormattingBorder.TopColor||"0")+";border-bottom-color: "+$COLOR.decodeColor(mstrmojo.all.feModel.currentFormat.FormattingBorder.BottomColor||"0")+";border-left-width: "+(borderSizes[mstrmojo.all.feModel.currentFormat.FormattingBorder.LeftStyle]||"thin")+";border-right-width: "+(borderSizes[mstrmojo.all.feModel.currentFormat.FormattingBorder.RightStyle]||"thin")+";border-top-width: "+(borderSizes[mstrmojo.all.feModel.currentFormat.FormattingBorder.TopStyle]||"thin")+";border-bottom-width: "+(borderSizes[mstrmojo.all.feModel.currentFormat.FormattingBorder.BottomStyle]||"thin");}}}]}]});var _levelDropDownJson=function(level,levelItems,ps){return mstrmojo.hash.copy(ps,{scriptClass:"mstrmojo.Pulldown",cssClass:" level"+level+" mstrmojo-FormatEditor-DropDownButton",popupToBody:true,popupZIndex:100,items:levelItems,onvalueChange:function(){mstrmojo.all.feModel.set("level"+level+"Index",level===0?this.selectedIndex:this.selectedItem.p);}});};var _contentLayoutJson=function(){return{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.HBox",children:[_levelDropDownJson(0,mstrmojo.all.feModel.model.items,{itemIdField:"did",bindings:{items:function(){return mstrmojo.all.feModel.model.items||[];},value:function(){var idx=mstrmojo.all.feModel.level0Index;idx=(idx==-1?0:idx);return this.items[idx][this.itemIdField];}}}),_levelDropDownJson(1,$FORMATDEF.FormatTarget,{itemIdField:"v"}),new mstrmojo.Button.newInteractiveButton(mstrmojo.desc(5976),function(evt){var editor=this.parent.parent.parent;if(editor.onClearFormat){editor.onClearFormat();}},"#999",{alias:"btnClear",cssClass:"mstrmojo-Editor-button clear"})]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-FormatEditor-box",children:[{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-FormatEditor-leftPanel",children:[{scriptClass:"mstrmojo.List",alias:"feFMTList",cssClass:"mstrmojo-FormatEditor-formatList",items:$FORMATDEF.Formats,selectedIndex:0,itemMarkup:'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">{@n}</div></div>',height:"200px",onchange:function(evt){var rpc=this.parent.parent.rightPanelContainer,_rightPanels=rpc&&rpc.children;if(_rightPanels&&_rightPanels.length>0&&this.selectedIndex>=0){var rightPanel=_rightPanels[this.selectedIndex],rightPanelDomNode=rightPanel.domNode,oldIndex=evt.removed[0],oldRightPanel=oldIndex>-1?_rightPanels[oldIndex]:null,oldRightPanelDomNode=oldRightPanel&&oldRightPanel.domNode;if(oldRightPanelDomNode){oldRightPanelDomNode.style.overflow="hidden";oldRightPanelDomNode.style.zIndex=8;var w=parseInt(oldRightPanel.width,10),start=w,stop=0;slideProp(true,oldRightPanelDomNode,"width",start,stop,function(){oldRightPanelDomNode.style.zIndex=0;});}if(rightPanelDomNode){var w=parseInt(rightPanel.width,10);if(evt.removed.length===0){rightPanelDomNode.style.overflow="hidden";slideProp(true,rightPanelDomNode,"width",0,w,function(){rightPanelDomNode.style.overflow="visible";rightPanelDomNode.style.zIndex=7;});}else{rightPanelDomNode.style.width=w+"px";rightPanelDomNode.style.zIndex=7;rightPanelDomNode.style.overflow="visible";}}}}}]},{scriptClass:"mstrmojo.Container",alias:"rightPanelContainer",cssClass:"mstrmojo-FormatEditor-rightPanel-container",markupString:'<div id={@id} class="{@cssClass}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},children:[fontPanelWidget,numberPanelWidget,_alignmentPanelWidget,_colorLinePanelWidget]}]}]};};mstrmojo.FormatEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.FormatEditor",cssClass:"mstrmojo-FormatEditor",id:"fe",ease:"mstrmojo.ease.bounce",useAnimate:false,replacePredefinedCssClass:false,cpHeight:"200px",height:"330px",title:"Format Editor",onOK:function(){mstrmojo.all.feModel._updateModel();_saveModel(this);},model:null,onshowChange:function(evt){var height=parseInt(this.height,10),start=this.show?0:height,stop=height-start,me=this;this.editorNode.style.overflow="hidden";slideProp(this.show,this.editorNode,"height",start,stop,function(){me.set("visible",me.show);if(me.show){me.editorNode.style.overflow="visible";}});},_initModel:function(){if(!mstrmojo.all.feModel){var me=this;mstrmojo.all.feModel=new mstrmojo.Model({level1Index:"header_format",onlevel0IndexChange:function(evt){if(evt.valueWas>-1){this._updateModel(evt.valueWas,this.level1Index);}this._setCurrentFormat();},onlevel1IndexChange:function(evt){if(evt.valueWas!=undefined){this._updateModel(this.level0Index,evt.valueWas);}this._setCurrentFormat();},onmodelChange:function(){if(this.model.items.length>0){this._setCurrentFormat();}else{return false;}},_updateModel:function(level0Index,level1Index){level0Index=(typeof level0Index!="undefined")?level0Index:this.level0Index;level1Index=level1Index||this.level1Index;var cf=mstrmojo.hash.copy(this.currentFormat);var modelf=this.model.items[level0Index][level1Index]||{};for(var ps in cf){var cfps=cf[ps];if(!cfps.attachEventListener){if(!$HASH.isEmpty(cfps)){modelf[ps]=cfps;}}else{for(var p in cfps){if($FORMATDEF.DefaultFormat[ps][p]){if(!modelf[ps]){modelf[ps]={};}modelf[ps][p]=cfps[p];}}}}this.model.items[level0Index].set(level1Index,modelf);},_setCurrentFormat:function(){var cf=mstrmojo.hash.copy(this.model.items[this.level0Index||0][this.level1Index]);var df=mstrmojo.hash.clone($FORMATDEF.DefaultFormat);cf=cf||{};for(var ps in df){cf[ps]=cf[ps]||{};}for(var ps in cf){if(observableSets[ps]&&!cf[ps].attachEventListener){cf[ps]=mstrmojo.hash.make(cf[ps],mstrmojo.Obj);}}this.set("currentFormat",cf);}});}},init:function(props){this._initModel();this._super(props);},onmodelChange:function(){this._initModel();var fem=mstrmojo.all.feModel;fem.level0Index=0;fem.set("model",mstrmojo.hash.clone(this.model));var idx=fem.model.selectedIndex;fem.set("level0Index",(idx==-1?0:idx));},onClearFormat:function(){var fmts=mstrmojo.all.feModel.currentFormat;for(var ps in fmts){delete fmts[ps];}for(var i=0;i<4;i++){var which=["header_format","grid_format","child_header_format","child_grid_format"][i];var fem=mstrmojo.all.feModel;delete fem.model.items[fem.level0Index][which];}mstrmojo.all.feModel._setCurrentFormat();},_hasPop:0,close:function(){var editor=this;window.setTimeout(function(){if(editor.useAnimate){editor.set("show",false);}else{editor.set("visible",false);}},((editor._hasPop>0)&&mstrmojo.dom.isIE7)?duration:0);},postBuildRendering:function(){if(this._super){this._super();}var idx=mstrmojo.all.feModel.model.selectedIndex;mstrmojo.all.feModel.set("level0Index",(idx==-1?0:idx));},preBuildRendering:function(){if(this._super){this._super();}this.addChildren([_contentLayoutJson(),{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[new mstrmojo.Button.newInteractiveButton(mstrmojo.desc(2397),function(){var editor=this.parent.parent;editor.close();if(editor.onOK){editor.onOK();}},"#999",{alias:"btnOk",cssClass:"mstrmojo-Editor-button mstrButton"}),new mstrmojo.Button.newInteractiveButton(mstrmojo.desc(2399),function(){var editor=this.parent.parent;editor.close();if(editor.onCancel){editor.onCancel();}},"#999",{alias:"btnCancel",cssClass:"mstrmojo-Editor-button mstrButton"})]}]);}});})();