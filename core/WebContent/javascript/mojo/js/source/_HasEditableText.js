(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.string","mstrmojo.css");var $CSS=mstrmojo.css,$STR=mstrmojo.string,$DOM=mstrmojo.dom,KEY_ENTER=13,KEY_ESC=27;function handleEdit(key){if(this._editComplete){return ;}var text,complete=false,originalText=this.text,render=false;if(key===KEY_ESC){text=originalText;render=true;complete=true;}if(!key||(!this.allowNewLine&&key===KEY_ENTER)){var editableNode=this[this.editableSlot],newText=editableNode.innerText||editableNode.textContent||"";if(!this.allowNewLine){text=newText.replace(/\n/g,"");}else{text=newText;}complete=true;if(!this.allowEmptyText&&text.length===0){text=originalText;render=true;}}if(complete){this._editComplete=true;text=text.replace(/\u00A0/g,"\u0020");this.text=text;this.set("isEditing",false);this.onTextEditComplete(text!==originalText,originalText);delete this._editComplete;}if(render){this.refresh();}}function enableEditOnMouseEvent(evt){var eventMap={dblclick:"editOnDoubleClick",click:"editOnClick"};if(this[eventMap[evt.name]]&&evt.getTarget()===this[this.editableSlot]){this.set("isEditing",true);}}function attachEvent(widgetId,el,eventName){if(typeof el["on"+eventName]!=="function"){$DOM.attachMarkupEvent(widgetId,el,eventName);}}mstrmojo._HasEditableText=mstrmojo.provide("mstrmojo._HasEditableText",{_mixinName:"mstrmojo._HasEditableText",editableSlot:"domNode",editButtonSlot:null,isEditing:false,editOnClick:true,allowEmptyText:false,allowNewLine:false,editOnDoubleClick:false,onTextEditComplete:mstrmojo.emptyFn,postBuildRendering:function postBuildRendering(){this._super();var editableSlot=this.editableSlot,editableDomNode=this[editableSlot],renameBtnNode=this[this.editButtonSlot||editableSlot];$CSS.addClass(editableDomNode,"hasEditableText");this.text=this.text||editableDomNode.innerText||editableDomNode.textContent||"";editableDomNode.innerHTML=$STR.encodeHtmlString(this.text,true).replace(/ (?= )/g,"&nbsp;");var widgetID=this.id;if(this.editOnClick){attachEvent(widgetID,renameBtnNode,"click");}attachEvent(widgetID,renameBtnNode,"dblclick");attachEvent(widgetID,editableDomNode,"blur");attachEvent(widgetID,editableDomNode,"keyup");attachEvent(widgetID,editableDomNode,"keydown");},onclick:function onclick(evt){enableEditOnMouseEvent.call(this,evt);if(this._super){this._super(evt);}},ondblclick:function ondblclick(evt){enableEditOnMouseEvent.call(this,evt);},onblur:function onblur(){handleEdit.call(this);},onkeyup:function onkeyup(event){var evt=window.event||event.e;handleEdit.call(this,evt.keyCode);},onkeydown:function onkeydown(event){var evt=window.event||event.e;if(evt.keyCode===KEY_ENTER){handleEdit.call(this,evt.keyCode);event.cancel();}},_set_text:function _set_text(n,v){var was=this.text;this.text=v;if(this.hasRendered){this[this.editableSlot].innerHTML=$STR.encodeHtmlString(v||"",true);}return(was!==v);},onisEditingChange:function onisEditingChange(){if(this.hasRendered){var editableDomNode=this[this.editableSlot],isEditing=!!this.isEditing;editableDomNode.contentEditable=isEditing;editableDomNode.spellcheck=false;$CSS.toggleClass(editableDomNode,"editable",isEditing);if(isEditing){editableDomNode.focus();$DOM.setElementSelection(editableDomNode);}else{editableDomNode.blur();editableDomNode.scrollLeft=0;}}}});}());