(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.TextBoxDocSelector","mstrmojo.array","mstrmojo.string","mstrmojo.elementHelper");var $ARR=mstrmojo.array,$S=mstrmojo.string,_EH=mstrmojo.elementHelper,ELEM_ALL_ID=_EH.ELEM_ALL_ID;var NO_SEL_AS_EMPTY=0,NO_SEL_AS_UNSET=1,NO_SEL_AS_ALL=2;var UNIT_CONDITION=1,SUBTOTAL=3;mstrmojo.SearchBoxDocSelector=mstrmojo.declare(mstrmojo.TextBoxDocSelector,null,{scriptClass:"mstrmojo.SearchBoxDocSelector",filterElemALL:false,_buildEvent:function _buildEvent(rEvt,widget){var elementIDs=[],elementCount,defn=this.defn;$ARR.forEach(widget.items,function(item){elementIDs.push(item.v+";"+$S.decodeHtmlString(item.n));});elementCount=elementIDs.length;if(!elementCount){elementIDs.push(ELEM_ALL_ID);}if(elementIDs.length>0||!defn.nsb||defn.nsb===NO_SEL_AS_EMPTY){rEvt.eid=elementIDs.join(mstrmojo.elementHelper.ELEM_SEPARATOR);}else{if(defn.nsb===NO_SEL_AS_UNSET||!defn.showall){rEvt.unset=true;}else{if(defn.nsb===NO_SEL_AS_ALL){rEvt.eid=ELEM_ALL_ID;}}}if(defn.sec){if(defn.multi){this.parent.set("count",_EH.buildElemsCountStrByNum(elementCount,0));}else{this.parent.set("count",_EH.buildElemsCountStrByNum(0,0));}}},updateWidget:function updateWidget(selectorContainer){var selectorWidget=this._super(selectorContainer),node=selectorContainer.node,defn=node.defn,data=node.data,elements=data.elms;if(elements&&!defn.sos){selectorWidget.candidates=this.setupCandidates(defn,elements);}if(defn.srcid){var ca=[],i,ces=$ARR.filter(data.ces,function(item){return item.v!=="u;";});if(ces&&ces.constructor===Array){if(defn.dfm==UNIT_CONDITION){for(i=0;i<ces.length;i++){if(ces[i]["t"]!=SUBTOTAL){ca.push(ces[i]);}}}else{ca=ces.concat();}}if(!defn.sos){var new_ca=[];$ARR.forEach(ca,function(item){if($ARR.find(selectorWidget.candidates.items,"v",item.v)>-1){new_ca.push(item);}});ca=new_ca;}selectorWidget.items=ca;}return selectorWidget;},getCekEvtListener:function getCekEvtListener(selectorContainer,selectorControl){return function(evt){selectorContainer.handleActionInSyncPhase(function(){selectorControl.set("items",evt.value);});};},getWidgetConfig:function getWidgetConfig(selectorContainer,selectorStyle,defn,elements){var fmts=selectorContainer.getFormats(),data=selectorContainer.node.data,cfg=this._super(selectorContainer,selectorStyle,defn,elements);cfg={scriptClass:cfg.scriptClass,cssText:fmts.height?"height: "+fmts.height:"",emptyText:mstrmojo.desc(4325,"Search")+" "+(defn.ttl||""),items:defn.srcid?(data.ces?data.ces.concat():[]):[],REQUEST_THRESHOLD:(mstrApp&&mstrApp.SEARCH_REQUEST_THRESHOLD)||55,suggestCount:(mstrApp&&mstrApp.SEARCH_SUGGESTION_LENGTH)||50,srcid:defn.srcid||"",dsrc:defn.dsrc||"",onitemsChange:function(){if(!selectorContainer._inSyncPhase){selectorContainer.showInfoWin();selectorContainer.selectorControlChange(this);}}};if(elements&&!defn.sos){cfg.candidates=this.setupCandidates(defn,elements);}else{cfg.useKeyDelay=true;cfg.noCache=true;}if(!defn.multi){cfg.maxObjectCount=1;}return cfg;},isSelectAll:function isSelectAll(){var widget=this.children&&this.children[0];return widget===undefined?true:(!widget.items||widget.items.length==0);},setupCandidates:function setupCandidates(defn,elements){var items=defn.srcid?elements:[];if(this.filterElemALL){items=$ARR.filter(items,function(it){return it.v!=="u;";});}return{isComplete:true,items:items};},isValidSelection:function isValidSel(){var data=this.node.data,model=this.model;if(model.isSelWarnFlagOn(this.k)&&data.ces&&data.ces.length===0){return data.elms.length!==0;}return true;}});}());