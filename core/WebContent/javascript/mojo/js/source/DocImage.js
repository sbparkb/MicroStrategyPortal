(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._Formattable");var getDL=function getDL(node){return node.data.dl||node.defn.dl;};mstrmojo.DocImage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable],{scriptClass:"mstrmojo.DocImage",markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-DocImage" title="{@tooltip}" style="{@domNodeCssText}"><div style="{@shadowNodeCssText}"><img src="{@v}" style="{@imgNodeCssText}" mstrAttach:click></div>{@buttonNodeMarkup}</div>',markupSlots:{imgNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},update:function update(node){var ds=this.model.getDataService(),v=node.data.v,dl=getDL(node);this.origV=v;this.v=(ds&&ds.getImage&&ds.getImage(v))||v;this.oid=node.defn.oid;if(dl){this.tooltip=dl.items[0].n;}if(this.thresholdId||node.data.tid){delete this.fmts;}this.thresholdId=node.data.tid;this.set("visible",!node.data.hidden);if(this._super){this._super(node);}},formatHandlers:{domNode:["left","top","z-index"],shadowNode:["width","height","B","fx"],imgNode:["height","width"]},preBuildRendering:function preBuildRendering(){this._super();if(mstrApp.isMobile&&mstrApp.useBinaryFormat){var v=this.v,isOnline=mstrMobileApp.isOnline(),dataService=this.model.getDataService();if((!isOnline&&v.indexOf("http")===0)||(isOnline&&v.indexOf("http")!==0)){this.v=(dataService&&dataService.getDocImage&&dataService.getDocImage(this.origV))||v;}}var _S=mstrmojo.string;if(this.node.data.ut===4){this.v=mstrConfig.taskURL+"?taskId=getRWEmbeddedImage&msgID="+this.model.mid+"&oid="+_S.decodeHtmlString(this.v,true);}this.updateDimensionsFromFormats();},updateDimensionsFromFormats:function updateDimensionsFromFormats(){if(!mstrmojo.dom.isIE7){var fmt=this.getFormats(),ds=(fmt.fx&&fmt.fx.ds)||0,border=mstrmojo._Formattable.getBorderWidths(this),zoomFactor=1;if((mstrmojo.dom.isIE||mstrmojo.dom.isIEW3C)&&this.model.getZoomFactor){zoomFactor=this.model.getZoomFactor()>1?this.model.getZoomFactor():1;border.w=Math.ceil(border.w*zoomFactor);border.h=Math.ceil(border.h*zoomFactor);}this.domNodeCssText+="width:"+((parseInt(fmt.width,10)||0)+ds+border.w)+"px; height: "+((parseInt(fmt.height,10)||0)+ds+border.h)+"px;";}},getAnchor:function getAnchor(){return this.imgNode;}});}());