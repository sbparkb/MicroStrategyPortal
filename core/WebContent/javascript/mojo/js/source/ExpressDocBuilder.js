(function(){mstrmojo.requiresCls("mstrmojo.DocBuilder","mstrmojo.rw._IsReportServicesDocBuilder","mstrmojo.DocLayoutViewer","mstrmojo.maps.MapInfoWindowLayoutViewer","mstrmojo.DocGroupBy","mstrmojo.DocTextfield","mstrmojo.DocHTMLContainer","mstrmojo.Xtab","mstrmojo._Formattable","mstrmojo._IsDocXtab","mstrmojo.IncFetch","mstrmojo.express.ui.DocButton","mstrmojo.ExpressDocPanel","mstrmojo._IsEditableXtab","mstrmojo._CanSupportTransaction","mstrmojo.ExpressVisList","mstrmojo.OIVMDICConfig","mstrmojo.OIVMDocSelectorViewFactory","mstrmojo.OIVMDocXtabGraph","mstrmojo.vi.models.DocVisModel","mstrmojo.vi.models.DocXtabModel","mstrmojo.MenuButton","mstrmojo._HasHoverButton","mstrmojo.ToolBar","mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl","mstrmojo.vi.ui.rw._IsMultiselectXtab","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.vi.ui.rw._XtabHighlights","mstrmojo.rw.xtab._XtabColResize");var $UNIT_TYPES=mstrmojo.EnumRWUnitType,$CFC=mstrmojo.DynamicClassFactory.newComponent;mstrmojo.DocXtab=$CFC(mstrmojo.Xtab,[mstrmojo._Formattable,mstrmojo._IsDocXtab,mstrmojo._HasOwnAvatar,mstrmojo.rw.xtab._XtabColResize,mstrmojo.vi.ui.rw._IsMultiselectXtab,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw._XtabHighlights],{scriptClass:"mstrmojo.DocXtab"});var EXP_PDF=3,EXP_EXCEL=4;var getPopupDelegate=function(widget,cmdName){var w=widget;while(w){if(w.controller&&w.controller[cmdName]){return w.controller;}w=w.parent;}return null;};mstrmojo.ExpressDocBuilder=mstrmojo.declare(mstrmojo.DocBuilder,[mstrmojo.rw._IsReportServicesDocBuilder],{scriptClass:"mstrmojo.ExpressDocBuilder",visList:mstrmojo.ExpressVisList,createSelectorFactory:function createSelectorFactory(){return new mstrmojo.OIVMDocSelectorViewFactory();},createClassMap:function createClassMap(){var clsMap=this._super();clsMap[$UNIT_TYPES.PANEL]={n:"Panel",scriptClass:"mstrmojo.ExpressDocPanel"};clsMap[$UNIT_TYPES.HTMLCONTAINER]={n:"HTMLContainer"};clsMap[$UNIT_TYPES.GRAPH]={n:"OIVMDocXtabGraph",scriptClass:"mstrmojo.OIVMDocXtabGraph"};clsMap[$UNIT_TYPES.TEXTFIELD+"B"]={n:"Button",scriptClass:"mstrmojo.express.ui.DocButton"};return clsMap;},getDefaultMojoVisModel:function getDefaultMojoVisModel(){return mstrmojo.vi.models.DocVisModel;},getLayoutViewerClass:function getLayoutViewerClass(node){return mstrmojo.DocLayoutViewer;},newLayout:function newLayout(model,node){var dlv=this._super(model,node);var gb=node.data.gbys;if(gb&&gb.showGroupby){dlv.addChildren(new mstrmojo.DocGroupBy({id:gb.k,slot:"groupBy",title:gb.title,model:model,node:node,data:gb.groupbys,controller:this.parent.controller}));}if(node.data.ifs){var ifs=new mstrmojo.IncFetch(mstrmojo.hash.copy(node.data.ifs,{slot:"incFetchNode",model:model}));ifs.attachEventListener("fetch",dlv.id,function(evt){model.getDataService().fetchDocPage((evt.v-1)*ifs.ps+1,{success:function(res){model.loadLayout(res);}});});dlv.addChildren(ifs);}return dlv;},newOIVMDocXtabGraph:function(model,node){var graph=new mstrmojo.OIVMDocXtabGraph({id:node.id,node:node,controller:this.parent.controller,model:model,gridInfo:node.data.gsi});graph.model=new mstrmojo.vi.models.DocXtabModel({xtab:graph,docModel:model});return graph;},getEditableXtab:function getEditableXtab(){if(!mstrmojo.EditableXtab){mstrmojo.EditableXtab=$CFC(mstrmojo.Xtab,[mstrmojo._CanSupportTransaction,mstrmojo._IsEditableXtab],{scriptClass:"mstrmojo.EditableXtab"});}return mstrmojo.EditableXtab;},getDefaultXtab:function getDefaultXtab(){return mstrmojo.DocXtab;},getPortletExportGridToolbar:function getPortletExportGridToolbar(widget){var key=widget.k,data=widget.node.data,sliceId=data.wid,exports=[];if(!data.disablePDF){exports.push({n:mstrmojo.desc(5212,"Export to PDF"),did:EXP_PDF});}if(!data.disableEXCEL){exports.push({n:mstrmojo.desc(5213,"Export to Excel"),did:EXP_EXCEL});}return{css:"grid-menu",node:{scriptClass:"mstrmojo.ToolBar",slot:"toolbarNode",alias:"rightToolbar",children:[{scriptClass:"mstrmojo.MenuButton",iconClass:"mstrmojo-oivmSprite tbDown",itemIdField:"did",itemField:"n",itemChildrenField:"subItms",executeCommand:function(item){var dl=getPopupDelegate(this,"exportCmd");if(dl){dl.exportCmd(item.did,key,sliceId);}},cm:exports}]}};},newHTMLContainer:function(model,node){return this.newRWUnitInstance(model,node,(node.defn.ht===0)?mstrmojo.DocHTMLContainer:mstrmojo.DocTextfield);},newInfoWindow:function newInfoWindow(cfg){return new mstrmojo.DocInfoWindow(cfg);},getLinkDrillMixins:function getLinkDrillMixins(useHover){return useHover?[mstrmojo._HasHoverButton]:[];}});}());