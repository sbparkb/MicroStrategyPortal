(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.Editor","mstrmojo.Button","mstrmojo.ui.ScrollableContainer","mstrmojo.prefs.ColorPalettesEditor");var $ARR=mstrmojo.array,$FUNC=mstrmojo.func,$HASH=mstrmojo.hash,$CSS=mstrmojo.css,$DOM=mstrmojo.dom;function getHeaderLabel(text){return{scriptClass:"mstrmojo.Label",text:text,cssClass:"header"};}mstrmojo.onetier.vi.prefs.OneTierPalettesEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.onetier.vi.prefs.OneTierPalettesEditor",paletteThemesData:null,serverRequest:mstrmojo.emptyFn,init:function init(props){this._super(props);$CSS.addWidgetCssClass(this,"mstrmojo-OneTierPalettesEditor");this.palettes.initData(this.paletteThemesData);},children:[{alias:"palettes",scriptClass:"mstrmojo.prefs.ColorPalettesEditor",serverRequest:function serverRequest(params,callback,config){this.parent.serverRequest(params,callback,config);},postCreate:function postCreate(){var pltsEditor=this,openPltEditor=function openPltEditor(pltItem,hostElement,fnInitPopupCfg){var popupCfg=new mstrmojo.ui.PopupConfig({hostElement:hostElement,isHostedWithin:false,hostProxyCssClass:"OneTierPltEditor"});if(fnInitPopupCfg){fnInitPopupCfg(popupCfg);}pltsEditor.openPaletteEditor(pltItem,{top:"-2.5em",left:"10em",popupConfig:popupCfg});},getPltListCfg=function getPltListCfg(newProps){return $HASH.copy(newProps,$FUNC.override({getPaletteCfg:function getPaletteCfg(props){props=$HASH.copy(props,{oncontextmenu:null,onclick:function onclick(evt){var tgtNode=evt.getTarget(),tgtCls=tgtNode.className;if(tgtCls==="edit"){openPltEditor(this,pltsEditor.children[0].domNode);}else{if(tgtCls==="delete"){pltsEditor.doDeletePalette(this.pltid);}}}});return $FUNC.override({postBuildRendering:function postBuildRendering(){var isRendered=this._super();if(isRendered){var div=document.createElement("div");div.innerHTML='<div class="icons"><div class="edit"></div><div class="delete"></div></div>';var resultNode=div.firstChild;this.domNode.appendChild(resultNode);if(this.parent.showFocus===true){this.paletteLabel.set("isEditing",true);this.parent.showFocus=false;}}return isRendered;}},this._super(props));},addPalettes:function addPalettes(items){this._super(items);pltsEditor.customPltsContainer.updateScrollbars();},removePalette:function removePalette(c){this._super(c);pltsEditor.customPltsContainer.updateScrollbars();}},pltsEditor.getPaletteListCfg()));};this.children=[getHeaderLabel(mstrmojo.desc(14119,"Built-in")),getPltListCfg({alias:"builtInPlts"}),getHeaderLabel(mstrmojo.desc(2056,"Custom")),{scriptClass:"mstrmojo.ui.ScrollableContainer",alias:"customPltsContainer",cssClass:"CustomPalettesContainer",children:[getPltListCfg({postCreate:function postCreate(){pltsEditor.paletteList=this;}}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13725,"Add a Palette"),cssClass:"newPalette",onclick:function onclick(){openPltEditor(null,pltsEditor.children[0].domNode,function(popupCfg){var CORNERS=popupCfg.ENUM_CORNERS;popupCfg.setAlignment(CORNERS.TOP_LEFT,CORNERS.TOP_LEFT);});}}]}];},doThemeChanged:mstrmojo.emptyFn,initPaletteList:function initPaletteList(){var builtInPlts=this.palettes.filter(function(plt){return plt.tp===1;}),customPlts=$ARR.difference(this.palettes,builtInPlts);this.builtInPlts.addPalettes(builtInPlts);this.paletteList.addPalettes(customPlts);},onRender:function onRender(){var scrollNode=this.customPltsContainer.scrollNode,scrollNodePos=$DOM.position(scrollNode);scrollNode.scrollTop=scrollNode.scrollHeight-scrollNodePos.h;}}],buttons:[mstrmojo.Button.newActionButton(mstrmojo.desc(2177,"Close"),function(){this.parent.parent.close();})]});}());