(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.onetier.vi.prefs.LoginEditor","mstrmojo.vi.models.editors.ControlsViewFactory","mstrmojo.Editor","mstrmojo.hash");var $HASH=mstrmojo.hash;function onError(res){var loginFailure=mstrmojo.desc(14575,"Login failure."),customErrorMessages={"-50":mstrmojo.desc(14015,"Desktop cannot download dashboards with prompts that require an answer but do not have a default answer set."),"-51":mstrmojo.desc(14062,"You are not allowed to download dashboards from the server. Please check with the administrator of the project."),"-52":mstrmojo.desc(14063,"You are not allowed to upload dashboads to the server. Please check with the administrator of the project."),"-2147202292":loginFailure,"-2147216959":loginFailure};var msg=customErrorMessages[res.taskErrorCode]||res.errorMessage||res.message||(res.taskErrorCode&&"TaskErrorCode:"+res.taskErrorCode+" (No error message).")||(res.getResponseHeader&&res.getResponseHeader("X-MSTR-TaskFailureMsg"));if(res.taskErrorCode!==-2147028992&&msg!==undefined){mstrmojo.error({longDesc:msg},undefined,{zIndex:100000});}return !msg;}mstrmojo.onetier.vi.prefs.DesktopConnectivityProxyBase=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.onetier.vi.prefs.DesktopConnectivityProxyBase",showPreferencesEditor:function showPreferencesEditor(){this.throwAbstractMethodError("savePreferences");},savePreferences:function savePreferences(preferences){this.throwAbstractMethodError("savePreferences");},getSavedPreferences:function getSavedPreferences(callback){this.throwAbstractMethodError("getSavedPreferences");},deleteServerConnections:function deleteServerConnections(deletedConnections){this.throwAbstractMethodError("deleteServerConnections");},testServerConnection:function testServerConnection(params,callback){this.throwAbstractMethodError("testServerConnection");},loginToWebserver:function loginToWebserver(wsn,username,password,callback){this.throwAbstractMethodError("loginToWebserver");},loginToProxy:function loginToProxy(proxyUrl,username,password,saveToPrefs,callback){this.throwAbstractMethodError("loginToProxy");},httpStatusCodeHandler:function httpStatusCodeHandler(statusCode,fnTestSuccessful,loginEditorProps){var connProxy=this,loginEditor;if(statusCode===401||statusCode===407){loginEditor=new mstrmojo.onetier.vi.prefs.LoginEditor($HASH.copy(loginEditorProps,{onLoginCancelled:function onLoginCancelled(){connProxy.authenticationCancelled();}}));}switch(statusCode){case 200:fnTestSuccessful();break;case 401:case 407:loginEditor.open();break;case 404:case 500:mstrmojo.alert(mstrmojo.desc(13690,"Unable to connect to the server now. Please check your connection."));break;}},authenticationCancelled:function authenticationCancelled(){this.throwAbstractMethodError("authenticationCancelled");},resumeDashboardExecution:function resumeDashboardExecution(){this.throwAbstractMethodError("authenticationCancelled");},checkForDesktopUpdates:function getForDesktopUpdates(){this.throwAbstractMethodError("checkForDesktopUpdates");},showProxyEditor:function showProxyEditor(){this.throwAbstractMethodError("showProxyEditor");},getProjects:function getProjects(params,callback){this.throwAbstractMethodError("getProjects");},getSessionState:function getSessionState(connectionId,iServer,port,project,callback){this.throwAbstractMethodError("getSessionState");},getLoginFirstSessionState:function getLoginFirstSessionState(connectionId,callback){this.throwAbstractMethodError("getLoginFirstSessionState");},login:function login(params,callback){this.throwAbstractMethodError("login");},loginFirst:function login(params,callback){this.throwAbstractMethodError("loginFirst");},sendWebServerRequest:function sendWebServerRequest(params,callback,extras){this.throwAbstractMethodError("sendWebServerRequest");},saveToServer:function saveToServer(params,callback){this.throwAbstractMethodError("saveToServer");},openFromServer:function openFromServer(params,callback){this.throwAbstractMethodError("openFromServer");},loadCube:function loadCube(params,callback){this.throwAbstractMethodError("loadCube");},getCubeInfo:function getCubeInfo(params,callback){this.throwAbstractMethodError("getCubeInfo");},getPublicCloudSession:function getPublicCloudSession(params,callback){this.throwAbstractMethodError("getPublicCloudSession");},saveToPublicCloud:function saveToPublicCloud(sessionState,callback){this.throwAbstractMethodError("saveToPublicCloud");},logout:function logout(params,callback){this.throwAbstractMethodError("saveToPublicCloud");},getWebServersProjects:function getWebServersProjects(callback){var webServers={},requests=0,authCancelled=false,getIServerPollingCallback=function(connection){if(connection&&!connection.wsservlet){var url=this.parseServerURL(connection.url);connection.wsservlet=url.wsservlet;connection.wsfolderpath=url.wsfolderpath;}return{success:function success(res){webServers[connection.id]={};webServers[connection.id].connection=connection;webServers[connection.id].loginInfo=res.loginInfo;if(res.loginRequired){webServers[connection.id].loginFirst=true;}else{webServers[connection.id].clusters=res.clusters;}},failure:function failure(res){if(res.code===403){authCancelled=true;}else{if(!onError(res)){if(res.status===401){webServers[connection.id]={};webServers[connection.id].connection=connection;webServers[connection.id].loginFirst=true;}}}},complete:function complete(){requests--;if(requests===0){callback.success(webServers,authCancelled);}}};}.bind(this),getServerConnections=function getServerConnections(serverConnCB){this.getSavedPreferences({success:function success(prefs){serverConnCB.success((prefs&&prefs.server&&prefs.server.conn)||[]);},failure:function failure(res){serverConnCB.failure(res);}});},getProjectsFromWS=function getProjectsFromWS(params,getProjectsFromWSCB){this.getProjects(params,getProjectsFromWSCB);};getServerConnections.call(this,{success:function(connections){connections.forEach(function(connection){if(connection.url){requests++;var params={connectionId:connection.id},getProj=function(){getProjectsFromWS.call(this,params,getIServerPollingCallback(connection));}.bind(this);this.getLoginFirstSessionState(connection.id,{success:function(res){params.sessionState=res.sessionState;getProj();},failure:function(){getProj();}});}}.bind(this));if(requests===0){callback.success(webServers);}}.bind(this),failure:function(res){callback.failure(res);}});},getObjectInfo:function getObjectInfo(params,callback){this.throwAbstractMethodError("getObjectInfo");},getUserServices:function getUserServices(params,callback){this.throwAbstractMethodError("getUserServices");},saveObjectACL:function saveObjectACL(params,callback){this.throwAbstractMethodError("saveObjectACL");},getUserEntityInfo:function getUserEntityInfo(params,callback){this.throwAbstractMethodError("getUserEntityInfo");},isCurrentProject:function isCurrentProject(currentProject,callback){this.throwAbstractMethodError("isCurrentProject");},getCleanDocModel:function getCleanDocModel(callback){this.throwAbstractMethodError("getCleanModel");},getDefaultPort:function getDefaultPort(connectionType){return connectionType==="https:"?443:80;},parseServerURL:function parseServerURL(url){var parser=document.createElement("a"),TP_JSP="j2ee",TP_ASP="asp";parser.href=url;var searchParams={};if(parser.protocol!=="http:"&&parser.protocol!=="https:"){parser.href="http://"+url;}parser.search.substr(1).split("&").forEach(function(param){var pairs=param.split("=");if(pairs.length===2){searchParams[pairs[0].toLowerCase()]=pairs[1];}});var pathnameArgs=parser.pathname.split("/"),servlet=pathnameArgs.pop(),hostpath=pathnameArgs.splice(1,1)[0];return{url:url,conntp:parser.protocol,wsn:parser.hostname,wsport:parser.port||this.getDefaultPort(parser.protocol),wsfolderpath:pathnameArgs.join("/"),wsservlet:servlet,wspath:hostpath,wstp:servlet.indexOf(".aspx")===-1?TP_JSP:TP_ASP,search:searchParams};}});mstrmojo.onetier.vi.prefs.handleErrorMessage=onError;}());