(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash");var $WRAP=mstrmojo.func.wrapMethods;function wrapCallback(callback,argv,method,idx,me){return $WRAP({success:function(res){if(mstrMobileApp&&mstrMobileApp.sendCallback){mstrMobileApp.sendCallback("success",argv.target,JSON.stringify(argv.memo),JSON.stringify(res));}},complete:function(){if(mstrMobileApp&&mstrMobileApp.sendCallback){mstrMobileApp.sendCallback("complete",argv.target,JSON.stringify(argv.memo));}me.removeCallback(method,idx);},failure:function(res){if(mstrMobileApp&&mstrMobileApp.sendCallback){mstrMobileApp.sendCallback("failure",argv.target,JSON.stringify(argv.memo),JSON.stringify(res));}}},callback);}mstrmojo._CanProxyCallback=mstrmojo.provide("mstrmojo._CanProxyCallback",{_mixinName:"mstrmojo._CanProxyCallback",callbacks:null,isCallbackReceiver:false,newCallback:function newCallback(props){return props;var cbs=this.callbacks,cb=mstrmojo.hash.copy(props),idx=(props.index!==undefined)?String(props.index):"index",args=arguments.callee.caller.arguments,argv,i,len,method=props.method||"anonymous";if(!cbs){cbs=this.callbacks={};}if(!cbs[method]){cbs[method]={};}if(!this.isCallbackReceiver){for(i=0,len=args.length;i<len;i++){argv=args[i];if(argv&&argv.target){cb=wrapCallback(cb,argv,method,idx,this);break;}}}if(!props.method){cb.proxy=this.getCallbackMemo();}cbs[method][idx]=cb;return cb;},anonymous:function(params,callback,config,argv){if(!this.isCallbackReceiver){callback=wrapCallback(callback,argv,"anonymous","index",this);mstrApp.serverRequest(params,callback,config);}},getCallback:function getCallback(method,index){var idx=index||"index",cbs=this.callbacks;return cbs&&cbs[method]&&cbs[method][idx];},removeCallback:function removeCallback(method,index){var idx=index||"index",cbs=this.callbacks;if(cbs&&cbs[method]){delete cbs[method][idx];if(mstrmojo.hash.isEmpty(cbs[method])){delete cbs[method];}}},getCallbackMemo:function getCallbackMemo(method,index){return{target:'mstrmojo.all["'+this.id+'"].receiveCallback',memo:{method:method||"anonymous",index:index||"index"}};},receiveCallback:function receiveCallback(fn,memo,res){var method=memo.method,idx=memo.index,cb=this.getCallback(method,idx);if(cb&&fn&&cb[fn]){cb[fn](res);}}});}());