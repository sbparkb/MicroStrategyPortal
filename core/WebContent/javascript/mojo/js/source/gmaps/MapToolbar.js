(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui._HasScroller","mstrmojo.vi.ui.toolbars.Toolbar","mstrmojo.ui.menus.ToolbarConfig","mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus.MenuConfig","mstrmojo.TextArea","mstrmojo.Popup","mstrmojo.Box","mstrmojo.VBox","mstrmojo.CheckBox","mstrmojo.RadioList","mstrmojo.Editor","mstrmojo.HBox","mstrmojo.Label","mstrmojo.SelectBox","mstrmojo.TextArea","mstrmojo.HTMLButton","mstrmojo.Popup","mstrmojo.Pulldown","mstrmojo.tooltip","mstrmojo.Button","mstrmojo.gmaps.MapSearchWidget");mstrmojo.requiresDescs(1158,10371,8218,10372,1442,221,10979,10980,10981,10978,9877,8473,9879,9876,11701,3946,145,9880,11476,9881);var LAYER_TITLE_HEIGHT=0,EMPTY_SPACE_BETWEEN_TRIANGLE_AND_TOOLBAR=0,SLIDING_ANIMATION_DURATION=500,SEARCHBAR_OFFSET=180,TOOLBAR_STATE={NORMAL_STATE:0,SINGLE_SELECT_STATE:1,RECTANGLE_SELECT_STATE:2,ZOOM_STATE:3,AFFINITY_STATE:4,FREE_SELECT_STATE:5,CIRCLE_SELECT_STATE:6,CLEAR_ALL_STATE:7,GRIDS_SELECT_STATE:8,MARKERTYPE:9,CLUSTER:10,MAP_TYPE:11},EnumToolbarButtonType={DRILL:1,SINGLE_SELECT:2,RECTANGLE_SELECT:4,EDIT_INFO_WINDOW:8,CLEAR_ALL:16,AFFINITY:32,FREE_SELECT:64,CIRCLE_SELECT:128,ZOOM:256,GRIDS_SELECT:512,KEEP_ONLY:1024,EXCLUDE:2048,SHOW_DATA:4096,SEARCH_BAR:8192,MAP_TYPE:16384},EnumMarkerType={MARKER:"1",BUBBLE:"2",POLYGON:"3",DENSITY:"4"},$D=mstrmojo.dom,$CSS=mstrmojo.css,$TT=mstrmojo.tooltip,DARK_THEME_CLASS="darkTheme",KEYS=mstrmojo.Enum_Keys;function updateButtonTooltipConfig(){var position=$D.position(this.domNode),config={content:this.tooltipContent,cssClass:"vi-regular vi-tooltip-A",posType:$TT.POS_TOPLEFT,top:position.y+position.h+3,left:position.x};this.richTooltip=config;}function getEscCallbackFunc(){var me=this;return function(evt){var e=evt||window.event,k=e.keyCode||e.charCode;if(k===KEYS.ESCAPE&&me.isSelectionState()){me.set("state",TOOLBAR_STATE.NORMAL_STATE);}};}function getMapTypeMenuConfig(){var menuCfg=new mstrmojo.ui.menus.MenuConfig(),mapTypeData=this.mapTypeData,me=this,menuCss="mapStylesMenu",fnCustomMarkup=function(){return'<div class="{@cls}" idx="{@idx}"><div>{@en@n}</div></div>';},fnGetHandler=function(value){return function(){var map=me.googlemap;if(!map||!map.observableModel){return false;}map.observableModel.set("dv",value);return true;};};if(mstrApp&&mstrApp.getThemeClassName){menuCss+=" "+mstrApp.getThemeClassName();}menuCfg.menuCssClass=menuCss;menuCfg.isHostedWithin=false;for(var i=0;i<mapTypeData.length;i++){var mapStyle=mapTypeData[i],mapStyleValue=mapStyle.v,mapStyleName=mapStyle.n,titleMap={"World Street Map":mstrmojo.desc(13821,"Street"),"Light Gray Map":mstrmojo.desc(13822,"Light gray"),"Relief Map":mstrmojo.desc(13823,"Relief"),"Topographic Map":mstrmojo.desc(11852,"Topographic"),"Physical Map":mstrmojo.desc(13824,"Physical"),"Terrain Map":mstrmojo.desc(8102,"Terrain"),"Satellite View Map":mstrmojo.desc(8068,"Satellite")};menuCfg.addCustomMenuItem(titleMap[mapStyleName],"CSS"+mapStyle.type+(mapStyle.id||i),fnGetHandler(mapStyleValue),fnCustomMarkup);}return menuCfg;}mstrmojo.gmaps.MapToolbar=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.gmaps.MapToolbar",callback:null,TOOLBAR_BUTTON_COUNT:13,formatPopupRef:null,googlemap:null,toolBarActive:false,layersRendered:0,timer:null,clearAllPopup:null,singleSelectPopup:null,metricSelectBox:null,mapTypeSelectBox:null,toolbar:null,$MSM:null,metricsString:"",metricData:[],mapTypeData:[],mapTypeSelList:null,state:TOOLBAR_STATE.NORMAL_STATE,leftToolbar:null,rightToolbar:null,SEARCH_BAR_MAX_WIDTH:200,buttonsToCreateFlag:0,toolBarButtonsEnabledState:0,toolBarButtonsSelectedState:0,markupString:'<div id="{@id}-toolbarwrapper" class="toolbarBoxWrapper" mstrAttach:scroll><div class="map-toolbar-searchbar" mstrAttach:mousedown></div><div id="{@id}" class="mstrMapToolBarBox" ><div class="map-toolbar-left" ></div><div class="map-toolbar-right"></div></div></div>',markupSlots:{leftToolbarNode:function(){return this.domNode.lastChild.firstChild;},searchBarNode:function(){return this.domNode.firstChild;},rightToolbarNode:function(){return this.domNode.lastChild.lastChild;},mapToolBarBox:function(){return this.domNode.lastChild;}},markupMethods:{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},layoutConfig:{h:{leftToolbarNode:"30px",searchBarNode:"25px",rightToolbarNode:"30px"},w:{leftToolbarNode:"auto",searchBarNode:"100%",rightToolbarNode:"auto"}},xt:true,setupScrollNodes:function setupScrollNodes(){this.scrollNode=this.mapToolBarBox;},updateScrollbars:function updateScrollbars(){if(this._super){this._super();}if(this.scrollNode){this.scrollNode.style.overflowX="hidden";}},initMapToolbar:function initMapToolbar(mapObj,gridInfo,flags,toolBarId,layersDivId,clearAllIdPopupId,singleSelectPopupId,mtData){this.googlemap=mapObj;this.metricData=gridInfo;this.buttonsToCreateFlag=flags;this.merticSelectPlaceholder=layersDivId;this.clearAllPopupPlaceholder=clearAllIdPopupId;this.singleSelectPopupPlaceholder=singleSelectPopupId;this.metricsString=mstrmojo.desc(1158,"Metrics");this.googlemap.layerChosen=[];for(var i=0;i<this.metricData.length;i++){this.googlemap.layerChosen.push(i);}this.mapTypeData=mtData;this.createToolBarButtons();},getPropertyValue:function getPropertyValue(mapCssObj,property){var propertyValue;if(mapCssObj&&property){if(!window.getComputedStyle){propertyValue=parseInt(mapCssObj[property],10);}else{propertyValue=parseInt(mapCssObj.getPropertyValue(property),10);}}return isNaN(propertyValue)?0:propertyValue;},searchBarInitialWidth:33,removeSearchMode:function removeSearchMode(){$CSS.removeClass(this.leftToolbarNode,"toolbar_searchMode");$CSS.removeClass(this.rightToolbarNode,"toolbar_searchMode");$CSS.removeClass(this.searchBarNode,"searchbar_searchMode");$CSS.removeClass(this.domNode,"searchbar_searchMode_center");this.searchBarNode.style.width=this.searchBarInitialWidth+"px";},onmousedown:function onmousedown(){if(parseInt(this.searchBarNode.offsetWidth)<this.SEARCH_BAR_MAX_WIDTH){this.searchBarInitialWidth=parseInt(this.searchBarNode.offsetWidth);this.googlemap.setSearchMode(true);this.searchBarNode.style.width=Math.min(this.SEARCH_BAR_MAX_WIDTH,this.width)+"px";$CSS.addClass(this.leftToolbarNode,"toolbar_searchMode");$CSS.addClass(this.rightToolbarNode,"toolbar_searchMode");$CSS.addClass(this.searchBarNode,"searchbar_searchMode");$CSS.addClass(this.domNode,"searchbar_searchMode_center");}},createMultiGridLayersBoxPopupRef:function createMultiGridLayersBoxPopupRef(){var $ME=this;return{alias:"metricSelectBox",scriptClass:"mstrmojo.Popup",cssClass:"metricSelectBox",slot:"popupNode",locksHover:true,autoCloses:true,onOpen:function onOpen(){$ME.set("state",TOOLBAR_STATE.GRIDS_SELECT_STATE);this.set("selected",true);var metricSelectBox=this;var tbDomNode=$CSS.getComputedStyle($ME.domNode);var toolbarTop=$ME.getPropertyValue(tbDomNode,"top")+$ME.getPropertyValue(tbDomNode,"height");metricSelectBox.domNode.style.maxHeight=((parseInt($ME.googlemap.height)-toolbarTop)*0.9)+"px";var metricBoxHeight,metricContentBoxOffsetHeight,wrapperHeight;metricContentBoxOffsetHeight=parseInt(metricSelectBox.metricContentWrapper.metricContentBox.domNode.offsetHeight);metricBoxHeight=LAYER_TITLE_HEIGHT+metricContentBoxOffsetHeight;metricBoxHeight=Math.min(metricBoxHeight,parseInt(metricSelectBox.domNode.style.maxHeight));metricSelectBox.domNode.style.height=metricBoxHeight+"px";wrapperHeight=metricBoxHeight-EMPTY_SPACE_BETWEEN_TRIANGLE_AND_TOOLBAR;metricSelectBox.metricContentWrapper.metricContentBox.domNode.style.maxHeight=(wrapperHeight-LAYER_TITLE_HEIGHT)+"px";metricSelectBox.metricContentWrapper.metricContentBox.domNode.style.height=metricContentBoxOffsetHeight+"px";metricSelectBox.metricContentWrapper.domNode.style.height=wrapperHeight+"px";metricSelectBox.domNode.style.width=parseInt(metricSelectBox.metricContentWrapper.metricContentBox.metricSelectVBox.domNode.offsetWidth)+"px";var rect=$ME.rightToolbar.showMetricSelectorList.domNode.getBoundingClientRect();this.domNode.style.left=parseInt(rect.left,10)+parseInt(rect.width,10)-parseInt(metricSelectBox.domNode.style.width,10)+"px";},onClose:function onClose(){this.set("selected",false);$ME.set("state",TOOLBAR_STATE.NORMAL_STATE);},children:[{alias:"metricContentWrapper",scriptClass:"mstrmojo.Box",cssClass:"metricContentWrapper",children:[{alias:"metricContentBox",scriptClass:"mstrmojo.Box",cssClass:"metricContentBox",children:[{alias:"metricSelectVBox",scriptClass:"mstrmojo.VBox",cssClass:"metricSelectVBox",cssText:"",closeMe:function closeMe(e){var elTarget=$D.eventTarget(self,e);var t=$D.contains($ME.metricSelList.parent.domNode,elTarget,true,$ME.metricSelList.parent.domNode);if(!t){$D.detachEvent(document,"click",$ME.$MSM);var metricBoxHeight=$ME.metricSelectBox.height;var startPos=metricBoxHeight,stopPos=0;new mstrmojo.fx.AnimateProp({target:$ME.metricSelectBox.domNode,props:{height:{ease:mstrmojo.ease.sin,start:startPos,stop:stopPos,suffix:"px"}},duration:SLIDING_ANIMATION_DURATION}).play();$ME.set("state",TOOLBAR_STATE.NORMAL_STATE);}},postCreate:function postCreate(){$ME.layersRendered=$ME.metricData.length;var childs=[],i;var allCheckBox=mstrmojo.insert({scriptClass:"mstrmojo.CheckBox",cssClass:"allLayer",label:mstrmojo.desc(10371,"All Layers"),alias:"allLayers",cssDisplay:"block",align:"left",postCreate:function(){this.set("checked",true);},onclick:function(){var layer;for(i=0;i<$ME.metricData.length;i++){layer=this.parent.children[i+1].children[0];if(this.checked!=layer.checked){layer.processMe(this.checked);}}}});if($ME.metricData.length>1){childs.push(allCheckBox);}for(i=0;i<$ME.metricData.length;i++){var gridMetricSel=mstrmojo.insert({scriptClass:"mstrmojo.VBox",alias:"layersbox"+i,halign:"left",cssText:"margin-top:3px;margin-bottom:5px;width:100%;",children:[{scriptClass:"mstrmojo.CheckBox",cssClass:"gridLayerNames",label:$ME.metricData[i].gridName,tooltip:$ME.metricData[i].gridName,align:"left",cssDisplay:"block",layerIndex:i,processMe:function processMe(checked){$ME.layersRendered+=(checked?1:-1);if(checked){$ME.googlemap.layerChosen.push(this.layerIndex);$ME.googlemap.addGridLayer(this.layerIndex);}else{var ind=mstrmojo.array.indexOf($ME.googlemap.layerChosen,this.layerIndex);if(ind!=-1){$ME.googlemap.layerChosen.splice(ind,1);}$ME.googlemap.removeGridLayer(this.layerIndex);if($ME.googlemap.noMarkerSelected()){$ME.googlemap.markerSelected=false;}if($ME.drillButton){$ME.drillButton.set("enabled",$ME.googlemap.isDrillable()&&$ME.state==TOOLBAR_STATE.NORMAL_STATE);}}this.set("checked",checked);this.parent["metricSelector_"+this.layerIndex].set("enabled",checked);},postCreate:function(){this.set("checked",true);},onclick:function(evt){this.processMe(this.checked);if(this.parent.parent.allLayers){this.parent.parent.allLayers.set("checked",($ME.layersRendered==$ME.metricData.length));}}},{scriptClass:"mstrmojo.RadioList",alias:"metricSelector_"+i,layerIndex:i,cssClass:"layerMetrics",itemTitleField:"n",items:(function getRadioContents(){if($ME.googlemap.gridDataViewer[i].wpMarkerType==EnumMarkerType.DENSITY){return[{n:"Marker density",gIdx:-1}];}else{return $ME.metricData[i].metrics;}})(),postCreate:function postCreate(evt){this.selectedIndex=$ME.googlemap.gridDataViewer[i].selectedMetricIndex;},postselectionChange:function(evt){if(this.parent.children[0].checked){var item=this.items[evt.added[0]];if(item.gIdx!=-1){$ME.googlemap.onselectedMetricIndexChange(item.gIdx,evt.added[0],item.id);}}}}]});childs.push(gridMetricSel);}this.set("children",childs);}}]}]}]};},renderEditInfoWindow:function renderEditInfoWindow(){if(!this.leftToolbar){return ;}var tb=this.leftToolbar.customInfoWindow;if(!tb){return ;}this.formatPopupRef={scriptClass:"mstrmojo.Editor",contentNodeCssClass:"mstrmojo-balloon",alias:"infoWindowEditor",title:mstrmojo.desc(8218,"Edit custom infoWindow"),left:"100px",top:"100px",width:"200px",locksHover:true,onOpen:function(){var openerDom=this.opener.domNode;var position=mstrmojo.dom.position(openerDom);var top=position.y+50;var left=parseInt(tb.domNode.style.left)+100;this.set("top",top+"px");this.set("left",left+"px");this.editorNode.style.width="300px";this.editorNode.style.zIndex=9999;this.gridSelectorHBox.gridSelector.previousSelection=0;},children:[{alias:"gridSelectorHBox",scriptClass:"mstrmojo.HBox",halign:"left",cssText:"margin:3px",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(10372,"Select a Grid: "),align:"left"},{alias:"gridSelector",scriptClass:"mstrmojo.SelectBox",bindings:{items:"this.parent.parent.opener.gridNamesSelectorItems"},size:1,selectedIndex:0,previousSelection:0,cssText:"white-space: nowrap; width: 200px",onchange:function onchange(){if(!this.selectedItem){return ;}this.parent.parent.opener.getGridViewer(this.previousSelection).setInfoWindowHTML(this.parent.parent.desc.value);var ind=parseInt(this.selectedItem.v);this.parent.parent.desc.set("value",this.parent.parent.opener.getGridViewer(ind).getInfoWindowHTML());this.previousSelection=ind;}}]},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",alias:"desc",bindings:{value:function(){if(!this.parent.opener){return"";}else{var viewer=this.parent.opener.getPrimaryGridViewer();return viewer.getInfoWindowHTML();}}},cols:80,rows:7},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.HTMLButton",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-Editor-button",onclick:function(){var val=this.parent.parent.desc.value;this.parent.parent.opener.getGridViewer(this.parent.parent.gridSelectorHBox.gridSelector.previousSelection).setInfoWindowHTML(val);this.parent.parent.opener.saveCustomInfo();}},{scriptClass:"mstrmojo.HTMLButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-Editor-button",onclick:function(){this.parent.parent.close();}}]},{alias:"editInfoWindowTriangle",scriptClass:"mstrmojo.Label",cssClass:"editInfoWindowTriangle"}]};},onstateChange:function onstateChange(){var $ME=this,state=parseInt(this.state,10),leftToolbar=this.leftToolbar;if((this.buttonsToCreateFlag&EnumToolbarButtonType.SINGLE_SELECT)!==0){leftToolbar.clickSelect.set("enabled",(state===TOOLBAR_STATE.NORMAL_STATE||state===TOOLBAR_STATE.SINGLE_SELECT_STATE)&&!$ME.googlemap.isSelectedDensity($ME.googlemap.layerChosen));$ME.googlemap.set("enableClickSelect",state===TOOLBAR_STATE.SINGLE_SELECT_STATE);leftToolbar.clickSelect.set("selected",state===TOOLBAR_STATE.SINGLE_SELECT_STATE);}leftToolbar.rectangleSelect.set("enabled",state===TOOLBAR_STATE.NORMAL_STATE||state===TOOLBAR_STATE.RECTANGLE_SELECT_STATE);leftToolbar.clearAll.set("enabled",(!$ME.googlemap.noPolygonsPresentOnMap()||$ME.googlemap.markerSelected)&&(state===TOOLBAR_STATE.CLEAR_ALL_STATE||state===TOOLBAR_STATE.NORMAL_STATE));if((this.buttonsToCreateFlag&EnumToolbarButtonType.GRIDS_SELECT)!==0){this.rightToolbar.showMetricSelectorList.set("enabled",state===TOOLBAR_STATE.NORMAL_STATE||state===TOOLBAR_STATE.GRIDS_SELECT_STATE);this.rightToolbar.showMetricSelectorList.set("selected",state===TOOLBAR_STATE.GRIDS_SELECT_STATE);}leftToolbar.rectangleSelect.set("selected",state===TOOLBAR_STATE.RECTANGLE_SELECT_STATE);leftToolbar.clearAll.set("selected",state===TOOLBAR_STATE.CLEAR_ALL_STATE);if((this.buttonsToCreateFlag&EnumToolbarButtonType.FREE_SELECT)!==0){leftToolbar.freeSelect.set("enabled",state===TOOLBAR_STATE.NORMAL_STATE||state===TOOLBAR_STATE.FREE_SELECT_STATE);leftToolbar.freeSelect.set("selected",state===TOOLBAR_STATE.FREE_SELECT_STATE);$ME.googlemap.set("enableFreeFormSelect",state===TOOLBAR_STATE.FREE_SELECT_STATE);}if((this.buttonsToCreateFlag&EnumToolbarButtonType.CIRCLE_SELECT)!==0){leftToolbar.circleSelect.set("enabled",state===TOOLBAR_STATE.NORMAL_STATE||state===TOOLBAR_STATE.CIRCLE_SELECT_STATE);leftToolbar.circleSelect.set("selected",state===TOOLBAR_STATE.CIRCLE_SELECT_STATE);$ME.googlemap.set("enableCircleSelect",state===TOOLBAR_STATE.CIRCLE_SELECT_STATE);}if((this.buttonsToCreateFlag&EnumToolbarButtonType.KEEP_ONLY)!==0){leftToolbar.keepOnly.set("enabled",$ME.googlemap.markerSelected&&$ME.googlemap.canDoMultiSelect()&&state===TOOLBAR_STATE.NORMAL_STATE);}if((this.buttonsToCreateFlag&EnumToolbarButtonType.EXCLUDE)!==0){leftToolbar.exclude.set("enabled",$ME.googlemap.markerSelected&&$ME.googlemap.canDoMultiSelect()&&state===TOOLBAR_STATE.NORMAL_STATE);}if((this.buttonsToCreateFlag&EnumToolbarButtonType.SHOW_DATA)!==0){leftToolbar.showData.set("enabled",$ME.googlemap.markerSelected&&state===TOOLBAR_STATE.NORMAL_STATE);}if($ME.googlemap.drillable){leftToolbar.drillButton.set("enabled",$ME.googlemap.isDrillable()&&state===TOOLBAR_STATE.NORMAL_STATE);}if($ME.googlemap.affinityEnabled){leftToolbar.affinityLines.set("selected",state===TOOLBAR_STATE.AFFINITY_STATE);leftToolbar.affinityLines.set("enabled",state===TOOLBAR_STATE.NORMAL_STATE||state===TOOLBAR_STATE.AFFINITY_STATE);}$ME.googlemap.set("enableRectangleSelect",state===TOOLBAR_STATE.RECTANGLE_SELECT_STATE);$ME.googlemap.set("enablePopup",state===TOOLBAR_STATE.NORMAL_STATE);},getRightToolbarConfig:function getRightToolbarConfig(){var rightToolbarCfg=new mstrmojo.ui.menus.ToolbarConfig(),typeMenuCfg=getMapTypeMenuConfig.call(this);rightToolbarCfg.addDisposable(typeMenuCfg);rightToolbarCfg.addMenuToolbarBtn(mstrmojo.desc(4157,"STYLES"),"mapTypeSelectVBox",typeMenuCfg);return rightToolbarCfg;},createMessagePopupRef:function createMessagePopupRef(message,okBtnText,okCallbackFunc,cancelCallbackFunc){var $ME=this;return{alias:"messagePopup",scriptClass:"mstrmojo.Popup",cssClass:"messagePopupWindow",slot:"popupNode",locksHover:false,autoCloses:false,children:[{alias:"popupLabel",scriptClass:"mstrmojo.Label",cssClass:"messageLabel",text:message},{alias:"popupVBox",scriptClass:"mstrmojo.HBox",children:[{alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:(mstrApp&&mstrApp.isVI)?"messageBoxOkButton mstrmojo-WebButton hot":"messageBoxOkButton-nonVI",text:okBtnText,bindings:{popup:"this.parent.parent"},onclick:function onclick(){okCallbackFunc.call(this);this.popup.close();}},{alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:(mstrApp&&mstrApp.isVI)?"messageBoxCancelButton mstrmojo-WebButton":"messageBoxCancelButton-nonVI",text:mstrmojo.desc(221,"Cancel"),bindings:{popup:"this.parent.parent"},onclick:function onclick(){if(cancelCallbackFunc!=undefined){cancelCallbackFunc.call(this);}else{$ME.set("state",TOOLBAR_STATE.NORMAL_STATE);}this.popup.close();}}]}]};},getLeftToolbar:function getLeftToolbar(){var $ME=this;var ltb;ltb=mstrmojo.insert({alias:"toolBarBox",scriptClass:"mstrmojo.HBox",cssClass:"mstrMapToolBarBox",slot:"leftToolbarNode",buttonCount:$ME.TOOLBAR_BUTTON_COUNT,defaultButtonCount:$ME.TOOLBAR_BUTTON_COUNT,barLength:520,postCreate:function postCreate(){for(var i=this.children.length-1;i>=0;i--){if(((this.children[i].toolbarButtonType===EnumToolbarButtonType.SHOW_DATA)&&($ME.buttonsToCreateFlag&EnumToolbarButtonType.SHOW_DATA)==0)||((this.children[i].toolbarButtonType===EnumToolbarButtonType.EXCLUDE)&&($ME.buttonsToCreateFlag&EnumToolbarButtonType.EXCLUDE)==0)||((this.children[i].toolbarButtonType===EnumToolbarButtonType.KEEP_ONLY)&&($ME.buttonsToCreateFlag&EnumToolbarButtonType.KEEP_ONLY)==0)||((this.children[i].toolbarButtonType===EnumToolbarButtonType.CIRCLE_SELECT)&&($ME.buttonsToCreateFlag&EnumToolbarButtonType.CIRCLE_SELECT)==0)||((this.children[i].toolbarButtonType===EnumToolbarButtonType.FREE_SELECT)&&($ME.buttonsToCreateFlag&EnumToolbarButtonType.FREE_SELECT)==0)||((this.children[i].toolbarButtonType===EnumToolbarButtonType.EDIT_INFO_WINDOW)&&($ME.buttonsToCreateFlag&EnumToolbarButtonType.EDIT_INFO_WINDOW)==0)||((this.children[i].toolbarButtonType===EnumToolbarButtonType.SINGLE_SELECT)&&($ME.buttonsToCreateFlag&EnumToolbarButtonType.SINGLE_SELECT)==0)||((this.children[i].toolbarButtonType===EnumToolbarButtonType.GRIDS_SELECT)&&($ME.buttonsToCreateFlag&EnumToolbarButtonType.GRIDS_SELECT)==0)){this.children.splice(i,1);continue;}if((this.children[i].toolbarButtonType===EnumToolbarButtonType.AFFINITY)&&(($ME.buttonsToCreateFlag&EnumToolbarButtonType.AFFINITY)==0||!$ME.googlemap.isMapEnabledAffinityLine())){$ME.googlemap.affinityEnabled=false;this.children.splice(i,1);continue;}if((this.children[i].toolbarButtonType===EnumToolbarButtonType.DRILL)&&(($ME.buttonsToCreateFlag&EnumToolbarButtonType.DRILL)==0||!$ME.googlemap.isMapDrillEnabled())){$ME.googlemap.drillable=false;this.children.splice(i,1);}}},children:[{alias:"rectangleSelect",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapRectangleSearch",tooltipContent:mstrmojo.desc(10979,"Rectangular selection tool"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,enabled:true,toolbarButtonType:EnumToolbarButtonType.RECTANGLE_SELECT,onclick:function onclick(){this.set("selected",!this.selected);if(this.selected){$ME.googlemap.set("enablePopup",false);$ME.googlemap.set("infoWindowVisible",false);}$ME.set("state",this.selected?TOOLBAR_STATE.RECTANGLE_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);$ME.googlemap.hideInfoWindow();window.clearTimeout($ME.timer);}},{alias:"circleSelect",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapCircleSelectButton",tooltipContent:mstrmojo.desc(10980,"Circular selection tool"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,enabled:true,toolbarButtonType:EnumToolbarButtonType.CIRCLE_SELECT,onclick:function onclick(){this.set("selected",!this.selected);if(this.selected){$ME.googlemap.set("enablePopup",false);$ME.googlemap.set("infoWindowVisible",false);}$ME.set("state",this.selected?TOOLBAR_STATE.CIRCLE_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);$ME.googlemap.hideInfoWindow();}},{alias:"freeSelect",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapFreeSelectButton",tooltipContent:mstrmojo.desc(10981,"Freeform selection tool"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,enabled:true,toolbarButtonType:EnumToolbarButtonType.FREE_SELECT,onclick:function onclick(){this.set("selected",!this.selected);if(this.selected){$ME.googlemap.set("enablePopup",false);$ME.googlemap.set("infoWindowVisible",false);}$ME.set("state",this.selected?TOOLBAR_STATE.FREE_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);$ME.googlemap.hideInfoWindow();}},{alias:"clickSelect",scriptClass:"mstrmojo.Pulldown",cssClass:"mstrtbMapSelection",popupToBody:true,height:"30px",tooltipContent:mstrmojo.desc(13938,"Individual element selection tool"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,enabled:!$ME.googlemap.isSelectedDensity($ME.googlemap.layerChosen),toolbarButtonType:EnumToolbarButtonType.SINGLE_SELECT,onselectedChange:function onselectedChange(){var p=this._lastOpened;if(!this.selected&&p&&p.visible){this.closePopup();}},onmousedown:function onmousedown(){$ME.googlemap.set("infoWindowVisible",false);this.set("selected",!this.selected);$ME.googlemap.set("enablePopup",false);$ME.set("state",this.selected?TOOLBAR_STATE.SINGLE_SELECT_STATE:TOOLBAR_STATE.NORMAL_STATE);$ME.googlemap.hideInfoWindow();},popupRef:$ME.createMessagePopupRef(mstrmojo.desc(13939,"Please click on the element(s) you want to select."),mstrmojo.desc(8473,"Done"),function(){$ME.googlemap.handleSingleSelection(true);$ME.set("state",TOOLBAR_STATE.NORMAL_STATE);$ME.googlemap.set("enablePopup",true);},function(){$ME.googlemap.handleSingleSelection(false);$ME.set("state",TOOLBAR_STATE.NORMAL_STATE);$ME.googlemap.set("enablePopup",true);})},{alias:"clearAll",scriptClass:"mstrmojo.Pulldown",popupToBody:true,cssClass:"mstrtbMapClearAll",height:"30px",tooltipContent:mstrmojo.desc(9879,"Remove selections"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,enabled:false,toolbarButtonType:EnumToolbarButtonType.CLEAR_ALL,onmousedown:function onmousedown(){$ME.googlemap.hideInfoWindow();this.set("selected",!this.selected);$ME.set("state",this.selected?TOOLBAR_STATE.CLEAR_ALL_STATE:TOOLBAR_STATE.NORMAL_STATE);},popupRef:$ME.createMessagePopupRef(mstrmojo.desc(9876,"Are you sure you wish to remove all selections?"),mstrmojo.desc(1442,"OK"),function(){$ME.googlemap.clearMarkerSelections();})},{alias:"keepOnly",scriptClass:"mstrmojo.Button",enabled:false,iconClass:"mstrtbMapKeepOnly",tooltipContent:mstrmojo.desc(11701,"Keep Only"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,toolbarButtonType:EnumToolbarButtonType.KEEP_ONLY,onmousedown:function onmousedown(){$ME.googlemap.hideInfoWindow();this.set("selected",true);},onmouseup:function onmouseup(){this.set("selected",false);$ME.googlemap.processKeepOnly();}},{alias:"exclude",scriptClass:"mstrmojo.Button",enabled:false,iconClass:"mstrtbMapExclude",tooltipContent:mstrmojo.desc(3946,"Exclude"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,toolbarButtonType:EnumToolbarButtonType.EXCLUDE,onmousedown:function onmousedown(){$ME.googlemap.hideInfoWindow();this.set("selected",true);},onmouseup:function onmouseup(){this.set("selected",false);$ME.googlemap.processExclude();}},{alias:"drillButton",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapDrill",tooltipContent:mstrmojo.desc(145,"Drill"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,enabled:false,toolbarButtonType:EnumToolbarButtonType.DRILL,onmousedown:function onmousedown(){$ME.googlemap.hideInfoWindow();this.set("selected",true);},onmouseup:function onmouseup(){this.set("selected",false);$ME.googlemap.processDrill();}},{alias:"customInfoWindow",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapCustomizeInfoWindow",tooltipContent:mstrmojo.desc(8218,"Edit custom infoWindow"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,toolbarButtonType:EnumToolbarButtonType.EDIT_INFO_WINDOW,onclick:function onclick(){$ME.googlemap.hideInfoWindow();$ME.googlemap.openPopup($ME.formatPopupRef);}},{alias:"affinityLines",scriptClass:"mstrmojo.Button",enabled:true,iconClass:"mstrtbMapAffinity",tooltipContent:mstrmojo.desc(9880,"Filter affinity lines/arcs"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,toolbarButtonType:EnumToolbarButtonType.AFFINITY,onclick:function onclick(){$ME.googlemap.hideInfoWindow();this.set("selected",!this.selected);$ME.googlemap._affinityGlow=!$ME.googlemap._affinityGlow;$ME.googlemap.onAffinityAnimationModeChange();$ME.set("state",this.selected?TOOLBAR_STATE.AFFINITY_STATE:TOOLBAR_STATE.NORMAL_STATE);}},{alias:"showData",scriptClass:"mstrmojo.Button",enabled:false,iconClass:"mstrtbMapShowData",tooltipContent:mstrmojo.desc(11476,"Show Data"),updateTooltipConfig:updateButtonTooltipConfig,useRichTooltip:true,toolbarButtonType:EnumToolbarButtonType.SHOW_DATA,onmousedown:function onmousedown(){$ME.googlemap.hideInfoWindow();this.set("selected",true);},onmouseup:function onmouseup(){this.set("selected",false);$ME.googlemap.processShowData();}}]});return ltb;},searchBar:null,createToolBarButtons:function createToolBarButtons(){this.leftToolbar=this.getLeftToolbar();var rightToolbar=this.rightToolbar=mstrmojo.insert({scriptClass:"mstrmojo.HBox",height:"30px",slot:"rightToolbarNode"});if((this.buttonsToCreateFlag&EnumToolbarButtonType.GRIDS_SELECT)!==0){rightToolbar.addChildren({alias:"showMetricSelectorList",scriptClass:"mstrmojo.Pulldown",popupToBody:true,cssClass:"mstrtbMapGridSelector",height:"30px",tooltipContent:mstrmojo.desc(9881,"Multiple grids"),updateTooltipConfig:updateButtonTooltipConfig,enabled:true,toolbarButtonType:EnumToolbarButtonType.GRIDS_SELECT,mapToolbar:this,onmousedown:function onmousedown(){this.mapToolbar.googlemap.hideInfoWindow();this.set("selected",!this.selected);},popupRef:this.createMultiGridLayersBoxPopupRef()});}if((this.buttonsToCreateFlag&EnumToolbarButtonType.MAP_TYPE)!==0){var mapTypeToolbar=new mstrmojo.vi.ui.toolbars.Toolbar();mapTypeToolbar.set("toolbarCfg",this.getRightToolbarConfig());mapTypeToolbar.alias="mapTypeToolbar";rightToolbar.addChildren(mapTypeToolbar);}var toolbarContents=[this.leftToolbar];if((this.buttonsToCreateFlag&EnumToolbarButtonType.SEARCH_BAR)!==0){this.searchBar=new mstrmojo.gmaps.MapSearchWidget({slot:"searchBarNode"});toolbarContents.push(this.searchBar);}toolbarContents.push(this.rightToolbar);this.addChildren(toolbarContents);if(this.searchBar){this.searchBar.suggestionSource=this.googlemap;}},postBuildRendering:function postBuildRendering(){var themeProp=!!this.googlemap.widgetProps?this.googlemap.widgetProps.th:null;if(!!themeProp){if(themeProp==="1"){$CSS.removeClass(this.domNode,DARK_THEME_CLASS);}else{$CSS.addClass(this.domNode,DARK_THEME_CLASS);}}this.renderEditInfoWindow();this._super();var me=this;SEARCHBAR_OFFSET=parseInt(me.leftToolbarNode.offsetLeft)+parseInt(me.leftToolbarNode.offsetWidth);me.searchBarNode.style.left=SEARCHBAR_OFFSET+"px";this.onscroll=function(event){var target=event.target||event.srcElement;var leftoffset=target.scrollLeft;me.searchBarNode.style.left=SEARCHBAR_OFFSET-leftoffset+"px";};$D.attachEvent(this.mapToolBarBox,"scroll",this.onscroll);if(!this.escCallbackFunc){this.escCallbackFunc=getEscCallbackFunc.call(this);$D.attachEvent(document,"keydown",this.escCallbackFunc);}},getToolbar:function getToolbar(){return this.toolbar;},setToolbarState:function setToolbarState(value){this.set("state",value);},isSelectionState:function(){var state=this.state;return state===TOOLBAR_STATE.SINGLE_SELECT_STATE||state===TOOLBAR_STATE.RECTANGLE_SELECT_STATE||state===TOOLBAR_STATE.FREE_SELECT_STATE||state===TOOLBAR_STATE.CIRCLE_SELECT_STATE;},setToolbarButtonState:function setToolbarButtonState(buttonName,stateName,value){switch(buttonName){case EnumToolbarButtonType.DRILL:if(this.leftToolbar.drillButton){this.leftToolbar.drillButton.set(stateName,value);}break;case EnumToolbarButtonType.SINGLE_SELECT:this.leftToolbar.clickSelect.set(stateName,value);break;case EnumToolbarButtonType.RECTANGLE_SELECT:this.leftToolbar.rectangleSelect.set(stateName,value);break;case EnumToolbarButtonType.FREE_SELECT:if((this.buttonsToCreateFlag&this.EnumToolbarButtonType.FREE_SELECT)!=0){this.leftToolbar.freeSelect.set(stateName,value);}break;case EnumToolbarButtonType.CIRCLE_SELECT:if((this.buttonsToCreateFlag&this.EnumToolbarButtonType.CIRCLE_SELECT)!=0){this.leftToolbar.circleSelect.set(stateName,value);}break;case EnumToolbarButtonType.EDIT_INFO_WINDOW:break;case EnumToolbarButtonType.CLEAR_ALL:this.leftToolbar.clearAll.set(stateName,value);break;case EnumToolbarButtonType.AFFINITY:if(this.leftToolbar.affinityLines){this.leftToolbar.affinityLines.set(stateName,value);}break;case EnumToolbarButtonType.KEEP_ONLY:if(this.leftToolbar.keepOnly){this.leftToolbar.keepOnly.set(stateName,value);}break;case EnumToolbarButtonType.EXCLUDE:if(this.leftToolbar.exclude){this.leftToolbar.exclude.set(stateName,value);}break;case EnumToolbarButtonType.SHOW_DATA:if(this.leftToolbar.showData){this.leftToolbar.showData.set(stateName,value);}break;default:}},destroy:function destroy(ignoreDom){delete this.googlemap;this._super(ignoreDom);},unrender:function unrender(ignoreDom){$D.detachEvent(document,"keydown",this.escCallbackFunc);$D.detachEvent(this.mapToolBarBox,"scroll",this.onscroll);this.escCallbackFunc=null;this._super(ignoreDom);}});mstrmojo.gmaps.MapToolbar.TOOLBAR_STATE=TOOLBAR_STATE;})();