(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.Label","mstrmojo.hash","mstrmojo.array","mstrmojo.ui.Checkbox","mstrmojo.css","mstrmojo.threshold.ThresholdExprTree","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.models.FormatModel.getFormatUpdate","mstrmojo.threshold.ThresholdModel.REPLACE_SYMBOL");mstrmojo.requiresDescs(2869,3397,5893,7978,7979,13788,13789,13790,13894,14599,14600,14601,14611);var $HASH=mstrmojo.hash,$ARR=mstrmojo.array,$CSS=mstrmojo.css,$DECODE_FORMAT=mstrmojo.models.FormatModel.decodeValue,REPLACE_SYMBOL=mstrmojo.threshold.ThresholdModel.REPLACE_SYMBOL,TYPE_ATTRIBUTE=12;function applyTo(value){this.threshold.scope=value;}function setPreviewContent(replaceType,replaceText,objectType){var previewNode=this.previewNode;switch(replaceType){case 10:var symbol=$ARR.filterOne(REPLACE_SYMBOL,function(s){return s.v===replaceText;});if(symbol){previewNode.innerHTML=symbol.n;}break;case 4:$CSS.addClass(previewNode,"hasImage");previewNode.innerHTML='<img class="replaceImg" src="'+replaceText+'" />';break;default:previewNode.innerHTML=replaceText||(objectType===TYPE_ATTRIBUTE?mstrmojo.desc(14611,"Sample"):"1234.567");}}function setPreviewFormat(format,style){style.fontFamily=format.ff;style.fontSize=parseInt(format.fsz,10)+"pt";style.fontWeight=format.fw?"bold":"normal";style.textDecoration=(format.fun?"underline":"")+" "+(format.fst?"line-through":"");style.fontStyle=format.fit?"italic":"";style.color=format.fc;style.backgroundColor=format.bc;style.textAlign=format.alh;style.verticalAlign=format.alv;style.wordWrap=format.atw;style.direction=format.atd;var bts=format.bts;style.border=format.borderStyle||(bts?$DECODE_FORMAT("bts",bts):"1px dotted");style.borderColor=format.borderColor||format.btc||"#e1e1e1";}mstrmojo.threshold.ThresholdRow=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.threshold.ThresholdRow",markupString:'<div id="{@id}" class="mstrmojo-thresholdRow cf {@cssClass}" style="{@cssText}" mstrAttach:click><div class="draggable-icon"></div><div class="container"></div><div class="previewWrap"><div class="preview"></div></div><div class="menu"></div><div class="delete"></div></div>',markupSlots:{containerNode:function containerNode(){return this.domNode.children[1];},draggableNode:function draggableNode(){return this.domNode.firstChild;},previewNode:function containerNode(){return this.domNode.children[2].firstChild;},menuNode:function containerNode(){return this.domNode.children[3];},deleteNode:function deleteNode(){return this.domNode.children[4];}},threshold:undefined,idx:undefined,editor:undefined,model:undefined,lblIndex:undefined,chkBox:undefined,exprTree:undefined,postBuildRendering:function postBuildRendering(){this.destroyChildren(false);var threshold=this.threshold,model=this.model,style=this.previewNode.style,format=$HASH.copy(threshold.fmt,$HASH.clone(model.getGridValueFormat())),expr=threshold.expr;setPreviewContent.call(this,threshold.rtp,threshold.rtxt,model.objectType);if(format){setPreviewFormat(format,style);}this.destroyChildren(false);this.addChildren([{scriptClass:"mstrmojo.Label",alias:"lblIndex",text:this.idx+1},{scriptClass:"mstrmojo.threshold.ThresholdExprTree",alias:"exprTree",editor:this.editor,model:this.model,items:[expr]}]);model.attachEventListener("selectedThresholdsChange",this.id,"onselectedThresholdsChange");return this._super();},onselectedThresholdsChange:function onselectedThresholdsChange(){},onclick:function onclick(event){var editor=this.editor,target=event.getTarget(),me=this,model=this.model,isAttribute=editor.objectType===TYPE_ATTRIBUTE;if(target===this.deleteNode){this.removeFromModel();}else{if(target===this.menuNode){var menuCfg=new mstrmojo.ui.menus.MenuConfig();menuCfg.hostId=this.id;menuCfg.hostElement=this.menuNode;menuCfg.isHostedWithin=false;menuCfg.addSubMenuItem(mstrmojo.desc(13788,"Apply to"),"",editor.id,function(){var cfg=new mstrmojo.ui.menus.MenuConfig();cfg.addRadioMenuGroup(me.threshold.scope||1,applyTo,[{value:1,text:isAttribute?mstrmojo.desc(14599,"Element Rows Only"):mstrmojo.desc(13789,"Metric Only")},{value:2,text:isAttribute?mstrmojo.desc(14600,"Subtotal Rows Only"):mstrmojo.desc(13790,"Subtotals Only")},{value:3,text:isAttribute?mstrmojo.desc(14601,"Elements and Subtotals"):mstrmojo.desc(13894,"Metric and Subtotals")}],"",me,true);return cfg;});menuCfg.addMenuItem(mstrmojo.desc(2869,"Formatting"),"",function(){editor.openPropertyPanel(me);});menuCfg.addMenuItem(mstrmojo.desc(3397,"Duplicate"),"",function(){model.duplicateThreshold(me.idx);});if(this.idx!==0){menuCfg.addMenuItem(mstrmojo.desc(7978,"Move Up"),"",function(){model.moveThreshold(me.idx,me.idx-1);});}else{menuCfg.addNonInteractiveMenuItem(mstrmojo.desc(7978,"Move Up"),"",true);}if(this.idx!==model.thresholds[model.metricId].length-1){menuCfg.addMenuItem(mstrmojo.desc(7979,"Move Down"),"",function(){model.moveThreshold(me.idx,me.idx+1);});}else{menuCfg.addNonInteractiveMenuItem(mstrmojo.desc(7979,"Move Down"),"",true);}menuCfg.addMenuItem(mstrmojo.desc(5893,"New Condition"),"",function(){me.exprTree.newCondition(null);});this.openPopup(menuCfg.newInstance());}else{if(target===this.previewNode||target===this.previewNode.firstChild){editor.openPropertyPanel(this);}}}},removeFromModel:function removeFromModel(){this.model.deleteThreshold(this.threshold);},onpropertyModelChange:function onpropertyModelChange(evt){$HASH.copy(evt.threshold,$HASH.clear(this.threshold));this.refresh();}});}());