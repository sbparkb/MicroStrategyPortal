(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.threshold.ThresholdModel","mstrmojo.threshold.SimpleThresholdEditor","mstrmojo.threshold.AdvancedThresholdEditor");var $HASH=mstrmojo.hash,SIMPLE_THRESHOLD_ID="mstrmojo-simple-threshold-editor",ADVANCED_THRESHOLD_ID="mstrmojo-advanced-threshold-editor",EDITOR_TYPES=mstrmojo.threshold.ThresholdModel.EDITOR_TYPES;mstrmojo.threshold.ThresholdController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.threshold.ThresholdController",metricId:undefined,data:undefined,model:undefined,targets:undefined,editor:undefined,messageId:undefined,datasets:undefined,dataService:undefined,onSubmitActions:mstrmojo.emptyFn(),onSaveThresholds:mstrmojo.emptyFn(),onLoadThresholds:mstrmojo.emptyFn(),supportsFeature:function supportsFeature(featureId){return true;},init:function init(props){this._super(props);this.model=new mstrmojo.threshold.ThresholdModel({controller:this});},openEditor:function openEditor(){var data=this.data;if(!data){throw new Error("Visualization data not provided.");}var metricId=this.metricId,objectType=this.objectType,model=this.model,messageId=this.messageId,editor;model.set("data",$HASH.clone(data));model.metricId=metricId;model.objectType=objectType;var isAdvanced=model.isAdvanced(metricId),forceOpenEditorType=model.editorMode,forceOpenSimpleEditor=forceOpenEditorType===EDITOR_TYPES.SIMPLE_EDITOR;if(forceOpenEditorType===EDITOR_TYPES.ADVANCED_EDITOR||(!forceOpenSimpleEditor&&isAdvanced)){editor=mstrmojo.all[ADVANCED_THRESHOLD_ID]||new mstrmojo.threshold.AdvancedThresholdEditor({id:ADVANCED_THRESHOLD_ID,onUpdateBrowseElementsParams:function onUpdateBrowseElementsParams(params){var datasetId,datasets=this.controller.datasets,findAttrFn=function(attribute){return attribute.did===params.attributeID;};for(datasetId in datasets){if(datasets[datasetId].att.filter(findAttrFn).length>0){params.datasetID=datasetId;break;}}params.messageID=messageId;params.templateNodeKey=data.k;}});}else{if(isAdvanced){model.clearData();}editor=mstrmojo.all[SIMPLE_THRESHOLD_ID]||new mstrmojo.threshold.SimpleThresholdEditor({id:SIMPLE_THRESHOLD_ID});}this.editor=editor;editor.set("model",model);editor.set("controller",this);editor.set("metricId",metricId);editor.set("objectType",objectType);editor.set("title",this.title);editor.set("targets",this.targets);editor.open();this.addDisposable([model,editor]);}});}());