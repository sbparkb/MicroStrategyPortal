(function(){function parseSetsAndCompareFunc(args){var sets=[].slice.call(args),last=sets[sets.length-1],compareFunc=function(a,b){return a===b;};if(/function|string/.test(typeof last)){compareFunc=typeof last==="function"?last:function(a,b){return a[last]===b[last];};sets=sets.slice(0,sets.length-1);}return{sets:sets,compareFunc:compareFunc};}mstrmojo.array=mstrmojo.provide("mstrmojo.array",{indexOf:function indexOf(arr,item){var len=(arr&&arr.length)||0,i;for(i=0;i<len;i++){if(arr[i]==item){return i;}}return -1;},indexOfMulti:function indexOfMulti(arr,items){var indices=[],map={},count=0,me=this;me.forEach(arr,function(srcItem,srcIdx){me.forEach(items,function(testItem,testIdx){var isItem=(testItem===srcItem);if(isItem){indices[testIdx]=map[testIdx]=srcIdx;count++;}return !isItem;});});return{indices:indices.length?indices:null,map:map,count:count};},forEach:function forEach(arr,f,scope){var len=(arr&&arr.length)||0,i;for(i=0;i<len;i++){var isLast=i===(len-1);if(scope){if(f.call(scope,arr[i],i,arr,isLast)===false){break;}}else{if(f(arr[i],i,arr,isLast)===false){break;}}}return arr;},map:function map(arr,f){var len=(arr&&arr.length)||0,ret=[],i;for(i=0;i<len;i++){ret[i]=f(arr[i],i);}return ret;},filter:function filter(arr,fnFilter,config){var subset=[],cnt=0,len=(arr&&arr.length)||0,max=(config&&config.max)||0,i;for(i=0;i<len;i++){if(fnFilter(arr[i],i,arr)){subset[cnt]=arr[i];cnt++;if(max&&cnt>=max){break;}}}return subset;},filterOne:function filterOne(arr,fnFilter){var subset=this.filter(arr,fnFilter,{max:1});if(subset.length){return subset[0];}return null;},ensureArray:function ensureArray(arr){return[].concat(arr||[]);},find:function find(arr,n,v){var len=(arr&&arr.length)||0,i;for(i=0;i<len;i++){var obj=arr[i];if(obj&&obj[n]==v){return i;}}return -1;},distinct:function distinct(arr,n){if(arr.reduce&&!n){return arr.reduce(function(reducedArray,currentValue){if(reducedArray.indexOf(currentValue)<0){reducedArray.push(currentValue);}return reducedArray;},[]);}var len=(arr&&arr.length)||0,i,obj,subset=[];for(i=0;i<len;i++){obj=arr[i];if((obj!==undefined)&&((n&&this.find(subset,n,obj[n])<0)||(!n&&this.indexOf(subset,obj)<0))){subset.push(obj);}}return subset;},findBin:function fBin(arr,item,p,len){var h=(len||arr.length)-1,l=0,m,v=item[p];while(h-l>1){if(arr[m=h+l>>1][p]<v){l=m;}else{h=m;}}if(arr[l][p]===v){return l;}return arr[h][p]===v?h:-1;},search:function search(o,v,p){var h=o.length,l=-1,m,val=v.toUpperCase(),len=v.length;while(h-l>1){if(o[m=h+l>>1][p].substr(0,len).toUpperCase()<val){l=m;}else{h=m;}}return h;},findMulti:function idxOf(arr,n,items){if(!items){return{indices:null,map:{},count:0};}var len=items.length,indices=[],map={},c=0,j=(arr&&arr.length)||0,i;for(i=0;i<j;i++){var a=arr[i][n],k;for(k=0;k<len;k++){if(items[k][n]===a){indices[k]=i;map[k]=i;c++;break;}}}return{indices:indices,map:map,count:c};},removeItem:function removeItem(arr,item){var i=this.indexOf(arr,item);if(i>-1){this.removeIndices(arr,i,1);}return i;},removeItems:function removeItems(arr,n,items){var ret=this.findMulti(arr,n,items);if(ret.count){var indices=ret.indices.concat().sort(this.numSorter).slice(0,ret.count),i;for(i=indices.length-1;i>-1;i--){arr.splice(indices[i],1);}}},numSorter:function numSorter(a,b){return Number(a)-Number(b);},stringSorter:function stringSorter(a,b){var A=a.toLowerCase(),B=b.toLowerCase();if(A<B){return -1;}if(A>B){return 1;}return 0;},removeIndices:function removeIds(arr,start,count){arr.splice(start,count);},insert:function inst(arr,idx,items){if(!arr){arr=[];}if(idx===null||idx===undefined){idx=arr.length;}Array.prototype.splice.apply(arr,[idx,0].concat(items));return arr;},hash:function hash(arr,h){h=h||{};var len=(arr&&arr.length)||0,i;for(i=0;i<len;i++){h[arr[i]]=true;}return h;},get:function get(arr,indices){if(!indices){return null;}var ret=[],len=indices.length,i;for(i=0;i<len;i++){ret[i]=arr[indices[i]];}return ret;},deepSortArr:function deepSortArr(arr,prop,idx,asc){return arr.sort(function(a,b){var aProp=a[idx][prop],bProp=b[idx][prop];if(!asc){return(aProp<=bProp);}return(aProp>bProp)?-1:1;});},isArray:function(obj){var isa=Array.isArray;if(isa){return isa(obj);}return Object.prototype.toString.call(obj)==="[object Array]";},some:function some(arr,fnSome){if(!arr){return false;}if(arr.some){return arr.some(fnSome);}var result=false;this.forEach(arr,function(element,idx){result=fnSome(element,idx,arr);return !result;});return result;},difference:function difference(){if(arguments.length<2){throw new Error("difference should get at least 2 parameters");}var obj=parseSetsAndCompareFunc(arguments),sets=obj.sets,compareFunc=obj.compareFunc,first=sets[0],rest=[].concat.apply([],sets.slice(1));return first.filter(function(item){return !rest.some(function(rest_item){return compareFunc(item,rest_item);});});},intersection:function intersect(){if(arguments.length<2){throw new Error("intersection should get at least 2 parameters");}var obj=parseSetsAndCompareFunc(arguments),sets=obj.sets,compareFunc=obj.compareFunc,result=sets[0],rest=sets.slice(1);rest.forEach(function(_set){result=result.filter(function(item){return _set.some(function(item2){return compareFunc(item,item2);});});});return result;},fnReduceNumber:function fnReduceNumber(sum,value){return sum+value;}});}());