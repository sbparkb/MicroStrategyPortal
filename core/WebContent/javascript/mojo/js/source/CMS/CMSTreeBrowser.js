(function(){mstrmojo.requiresCls("mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowser","mstrmojo.CMS.DocViewer");mstrmojo.CMS.CMSTreeBrowser=mstrmojo.declare(mstrmojo.TreeBrowser,null,{renderOnScroll:false,itemChildrenField:"items",noCheckBox:true,anim:true,itemIdField:"dssid",itemField:"n",branchClickPolicy:mstrmojo.TreeBrowserEnum.BRANCH_POLICY_TOGGLE,allowUnlistedValues:false,selectionAcrossBranch:false,listSelector:mstrmojo.ListSelector,getContentThroughTaskCall:function(params,callbacks){var cms=this.parent.parent,ati=cms.activeTabIndex,cfg=cms.tabsConfig[ati];if(params.isRoot){var f=function(){callbacks.success({items:cfg.items});};window.setTimeout(f,0);}else{if(params.data.tp==LINK_TYPES.MSTR_FOLDER||params.data.tp==8){var ps={taskId:"searchMetadata",objectType:"8,55",sessionState:mstrApp.sessionState};if(params.data.dssid){ps.rootFolderID=params.data.dssid;}if(params.data.nf){ps.rootFolderType=params.data.nf;}mstrmojo.xhr.request("POST",mstrmojo.App.taskURL,callbacks,ps);}else{var f=function(){callbacks.success({items:params.data.items});};window.setTimeout(f,0);}}},itemFunction:function ifn(item,idx,w){var r=this._super(item,idx,w);r.toggleState=function(force){var s=this.state;if(s===0){this.set("state",1);}else{if(force&&(s===1)){this.set("state",0);}}};return r;},handleNodeClicked:function(data){var cms=this.parent.parent,renderer=this.parent.widgetRenderer,w;if(data.tp==LINK_TYPES.DOC||data.tp==55){w=new mstrmojo.CMS.DocViewer({docId:data.dssid});}else{w=mstrmojo.insert(data.config);}renderer.set("widget",w);},onNodeExpand:function onNodeExpand(w){var its=w[this.itemChildrenField],len=its&&its.length;if((w.state===1&&(len>0))||(w===this)){if(!this.isBranch(its[0])){w.singleSelect(0);this.handleNodeClicked(its[0]);}}},onnodechange:function onnodechange(evt){if(this.initializing){return ;}var ps=this.selectionParentNode;this._super(evt);if(ps&&(ps.state===1)&&(ps!=this.selectionParentNode)){ps.toggleState(true);}},isBranch:function isBranch(data){return(data.tp==LINK_TYPES.MSTR_FOLDER||data.tp==LINK_TYPES.CUSTOM_FOLDER||data.tp==8);},item2textCss:function item2textCss(data){var r="";if(data.cssClass){r=data.cssClass;}else{r={"-1":"failed","-2":"loading","-3":"next","-4":"prev"}[data.st];}return r||{8:"folder",55:"doc","-11":"doc","-14":"doc","-12":"folder","-13":"folder"}[data.tp];}});})();