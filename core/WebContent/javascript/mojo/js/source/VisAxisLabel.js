(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.string","mstrmojo.Widget","mstrmojo.VisUtility");var $MJ=mstrmojo,$CSS=$MJ.css,$HASH=$MJ.hash,$UTL=$MJ.VisUtility,$DOM=$MJ.dom,$STR=$MJ.string,CTRL_TYPE=$MJ.VisEnum.ControlType,SEP_WIDTH=5,ICON_WIDTH=15,CAPSULE_BORDER_THICKNESS=1,CAPSULE_TOP_PADDING=5,CAPSULE_LEFT_PADDING=8,PADDING_BETWEEN_TITLE_BORDER=0,CUSTOM_SCALE_ICON_TITLE=mstrmojo.desc(14442,"This metric has its axis scale set to custom min and max values");function evalWidth(){var i,item,cnt=0,styles=this.styles,labels=this.contentData,n=labels.length;if($DOM.isFF){this.DOTS_WIDTH=$UTL.measureTextWidth("W…",styles,2*CAPSULE_LEFT_PADDING+2*CAPSULE_BORDER_THICKNESS);this.DOTS_WIDTH_NO_PADDING=$UTL.measureTextWidth("W…",styles,2*CAPSULE_BORDER_THICKNESS);}else{this.DOTS_WIDTH=$UTL.measureTextWidth("…",styles,2*CAPSULE_LEFT_PADDING+2*CAPSULE_BORDER_THICKNESS);this.DOTS_WIDTH_NO_PADDING=$UTL.measureTextWidth("…",styles,2*CAPSULE_BORDER_THICKNESS);}for(i=0;i<n;i++){item=labels[i];item.width=$UTL.measureTextWidth(item.text,styles,2*CAPSULE_LEFT_PADDING+2*CAPSULE_BORDER_THICKNESS);if(item.sort){cnt++;}if(item.extraAttributes.customScale){cnt++;}}this.nSort=cnt;}function calculateActualWidth(){var i,labelWidth,changed,finishMeasure=false,labels=this.contentData,n=labels.length,k=n,width=parseInt(this.width,10),sepTotalWidth=(n-1)*SEP_WIDTH,iconTotalWidth=this.nSort*ICON_WIDTH,contentWidth=sepTotalWidth+iconTotalWidth,avgLabelWidth,cnt;for(i=0;i<n;i++){delete labels[i].actualWidth;}while(!finishMeasure){while(k>0){avgLabelWidth=Math.floor((width-contentWidth)/k);changed=false;for(i=0;i<n;i++){if(labels[i].actualWidth!==undefined){continue;}labelWidth=labels[i].width;if(labelWidth<=avgLabelWidth){labels[i].actualWidth=labelWidth;contentWidth+=labelWidth;changed=true;k--;}}if(!changed){break;}}if(k>0){for(i=n-1;i>=0;i--){if(labels[i].actualWidth===undefined){k--;if(avgLabelWidth<this.DOTS_WIDTH_NO_PADDING){labels[i].actualWidth=-1;cnt=0;if(labels[i].sort){cnt++;}if(labels[i].extraAttributes.customScale){cnt++;}if(i>0){contentWidth-=SEP_WIDTH;}contentWidth-=cnt*ICON_WIDTH;break;}else{if(avgLabelWidth<=this.DOTS_WIDTH){labels[i].noPadding=true;}}labels[i].actualWidth=avgLabelWidth;contentWidth+=avgLabelWidth;}}if(i===0||k===0){finishMeasure=true;}}else{finishMeasure=true;}}this.contentWidth=contentWidth;}function positionDomNode(){var width=parseInt(this.width,10),height=parseInt(this.height,10),contentWidth=this.contentWidth,delta=(width-height)>>1,delta1=(contentWidth-height-2*PADDING_BETWEEN_TITLE_BORDER)>>1,delta2=(width-contentWidth)>>1,align=this.align,domNode=this.domNode,pos={};if(align==="left"||align==="right"){$CSS.addClass(domNode,"gm-rotate-270");if(contentWidth<width){pos.width=contentWidth;}pos.top=delta;if(align==="left"){pos.left=-delta1;}else{pos.right=-delta1;}}else{if(align==="top"||align==="bottom"){if(contentWidth<width){pos.width=contentWidth;pos.left=delta2;}}else{if(align==="center"){if(contentWidth<=width){pos.width=contentWidth;pos.right=0;pos.bottom=0;}}}}$UTL.positionDomNode(domNode,pos);}function getSortTooltip(align,order,metricName){var s1=(align==="left"||align==="right")?"row":"column",s2=order?"ascendingly":"descendingly";return"This "+s1+" is sorted "+s2+" based on "+metricName;}function fillContent(){var i,name,value,labelItem,extraAttrs,text,iconDiv,textDiv,innerDiv,sepDiv,sortOrder,doc=document,fragment=doc.createDocumentFragment(),domNode=this.domNode,styles=this.styles,labels=this.contentData,align=this.align,n=labels.length,height=parseInt(this.height,10),offsetLeft=0;for(i=0;i<n;i++){labelItem=labels[i];if(labelItem.actualWidth<0){continue;}text=labelItem.text;extraAttrs=labelItem.extraAttributes;sortOrder=extraAttrs.sortOrder;if(align==="left"||align==="right"){if(extraAttrs.customScale){iconDiv=doc.createElement("div");iconDiv.setAttribute("class","gm-lock-icon");iconDiv.setAttribute("title",CUSTOM_SCALE_ICON_TITLE);iconDiv.style.left=offsetLeft+"px";iconDiv.style.top=((height-ICON_WIDTH)>>1)+"px";fragment.appendChild(iconDiv);offsetLeft+=ICON_WIDTH;}if(extraAttrs.sort){iconDiv=doc.createElement("div");iconDiv.setAttribute("class",sortOrder?"gm-sort-icon ascend":"gm-sort-icon");iconDiv.setAttribute("title",getSortTooltip(align,sortOrder,text));iconDiv.style.left=offsetLeft+"px";iconDiv.style.top=((height-ICON_WIDTH)>>1)+"px";fragment.appendChild(iconDiv);offsetLeft+=ICON_WIDTH;}}innerDiv=doc.createElement("div");innerDiv.setAttribute("class","gm-text-body-nowrap");innerDiv.setAttribute("type",CTRL_TYPE.GM_TEXT_BODY);innerDiv.innerHTML=$STR.encodeHtmlString(text,true);innerDiv.container=domNode;innerDiv.style.width=labelItem.actualWidth-2*CAPSULE_BORDER_THICKNESS+"px";innerDiv.style.height=height-2*CAPSULE_BORDER_THICKNESS+"px";if(!labelItem.noPadding){innerDiv.style.padding=CAPSULE_TOP_PADDING+"px "+CAPSULE_LEFT_PADDING+"px";}else{innerDiv.style.padding="0px";innerDiv.innerHTML="…";}$UTL.applyStyles2DomNode(innerDiv,styles);if(align==="left"||align==="right"){innerDiv.rotated=true;}textDiv=doc.createElement("div");textDiv.setAttribute("class","gm-textbody-unit");textDiv.appendChild(innerDiv);if(labelItem.actualWidth<labelItem.width){innerDiv.setAttribute("title",text);}else{innerDiv.style.overflow="visible";}textDiv.style.left=offsetLeft+"px";textDiv.style.width=labelItem.actualWidth-2*CAPSULE_BORDER_THICKNESS+"px";textDiv.style.height=height-2*CAPSULE_BORDER_THICKNESS+"px";fragment.appendChild(textDiv);for(name in extraAttrs){if(extraAttrs.hasOwnProperty(name)){value=extraAttrs[name];if((typeof value)==="string"||(typeof value)==="number"){textDiv.setAttribute(name,String(value));}else{textDiv[name]=extraAttrs[name];}}}offsetLeft+=labelItem.actualWidth;if(align!=="left"&&align!=="right"){if(extraAttrs.customScale){iconDiv=doc.createElement("div");iconDiv.setAttribute("class","gm-lock-icon");iconDiv.setAttribute("title",CUSTOM_SCALE_ICON_TITLE);iconDiv.style.left=offsetLeft+"px";iconDiv.style.top=((height-ICON_WIDTH)>>1)+"px";fragment.appendChild(iconDiv);offsetLeft+=ICON_WIDTH;}if(extraAttrs.sort){iconDiv=doc.createElement("div");iconDiv.setAttribute("class",sortOrder?"gm-sort-icon ascend":"gm-sort-icon");iconDiv.setAttribute("title",getSortTooltip(align,sortOrder,text));iconDiv.style.left=offsetLeft+"px";iconDiv.style.top=((height-ICON_WIDTH)>>1)+"px";fragment.appendChild(iconDiv);offsetLeft+=ICON_WIDTH;}}if(i!==n-1&&labels[i+1].actualWidth>0){sepDiv=doc.createElement("div");sepDiv.setAttribute("class","gm-text-body-nowrap");sepDiv.innerHTML="|";sepDiv.style.left=offsetLeft-2+2+"px";sepDiv.style.width=SEP_WIDTH+"px";sepDiv.style.padding="5px 2px";sepDiv.style.overflow="visible";$UTL.applyStyles2DomNode(sepDiv,styles);fragment.appendChild(sepDiv);offsetLeft+=SEP_WIDTH;}}domNode.appendChild(fragment);}mstrmojo.VisAxisLabel=mstrmojo.declare(mstrmojo.Widget,[],{scriptClass:"mstrmojo.VisAxisLabel",markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}; height:{@height}"></div>',init:function(props){this.align="left";this.styles={};this.contentData=[];this.contentWidth=0;if(this._super){this._super(props);}evalWidth.call(this);},postBuildRendering:function(){calculateActualWidth.call(this);positionDomNode.call(this);fillContent.call(this);}});}());