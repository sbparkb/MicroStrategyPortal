(function(){mstrmojo.requiresClsP("mstrmojo.chart","ChartCanvas","FormatLine","FormatFont","FormatFill","JSONInstruction","JSONUtil","JSONUnit","JSONFormatFill","JSONFormatFont","JSONFormatLine");mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.chart.enums.EnumInstructionName");var $C=mstrmojo.chart,$CHART_ENUMS=mstrmojo.chart.enums,$JI=$CHART_ENUMS.EnumInstructionName,$JSONUtil=$C.JSONUtil.prototype,$HASH=mstrmojo.hash;function SortFormatList(a,b){return a.mpOriginalAddress-b.mpOriginalAddress;}function hAddInstruction(instructionName,originalAddress){if(instructionName===undefined){instructionName=$JI.JSONInsUndefined;}if(originalAddress===undefined){originalAddress=null;}else{originalAddress=originalAddress.id;}if(this.mpCurrentUnit===null){this.mpCurrentUnit=new $C.JSONUnit();this.mUnitList.push(this.mpCurrentUnit);}return this.mpCurrentUnit.AddInstruction(instructionName,originalAddress);}function hAddFormat(format){var formatMap=this.mFormatMap,address=format.id;if(format instanceof $C.FormatFill){if(formatMap[address]===undefined){formatMap[address]=new $C.JSONFormatFill(format);}}else{if(format instanceof $C.FormatFont){if(formatMap[address]===undefined){formatMap[address]=new $C.JSONFormatFont(format);}}else{if(format instanceof $C.FormatLine){if(formatMap[address]===undefined){formatMap[address]=new $C.JSONFormatLine(format);}}}}}mstrmojo.chart.JSONCanvas=mstrmojo.declare(mstrmojo.chart.ChartCanvas,null,{scriptClass:"mstrmojo.chart.JSONCanvas",mIsJSONObjectConstructed:false,mpCurrentUnit:null,mUnitList:null,mFormatMap:null,mFormatList:null,mJSONObject:null,init:function init(props){this._super(props);this.mUnitList=[];this.mFormatMap={};this.mFormatList=[];this.mJSONObject={};},reset:function reset(){this.mUnitList=[];this.mFormatMap={};this.mFormatList=[];this.mJSONObject={};this.mIsJSONObjectConstructed=false;this.mpCurrentUnit=null;},SaveToObject:function SaveToObject(graphDesc){var prop;if(!this.mIsJSONObjectConstructed){this.hConstructJSONObject();}for(prop in this.mJSONObject){graphDesc[prop]=this.mJSONObject[prop];}return true;},saveState:function saveState(){hAddInstruction.call(this,$JI.JSONInsSaveState);},RestoreState:function RestoreState(){hAddInstruction.call(this,$JI.JSONInsRestoreState);},Clip:function Clip(){hAddInstruction.call(this,$JI.JSONInsClip);},Scale:function Scale(x,y){var pIns=hAddInstruction.call(this,$JI.JSONInsScale);pIns.AppendToParameterList("X",x);pIns.AppendToParameterList("Y",y);},Rotate:function Rotate(anchor,radian){var pIns=hAddInstruction.call(this,$JI.JSONInsRotate);pIns.AppendToParameterList("Anchor",anchor);pIns.AppendToParameterList("Radian",radian);},NewPath:function NewPath(){hAddInstruction.call(this,$JI.JSONInsNewPath);},ClosePath:function ClosePath(){hAddInstruction.call(this,$JI.JSONInsClosePath);},MoveTo:function MoveTo(x,y,isCurveAnimation,basePoint){var pIns=hAddInstruction.call(this,$JI.JSONInsMoveTo);pIns.AppendToParameterList("X",x);pIns.AppendToParameterList("Y",y);if(isCurveAnimation){pIns.AppendToParameterList("CA",1);pIns.AppendToParameterList("BPX",basePoint.x);pIns.AppendToParameterList("BPY",basePoint.y);}else{pIns.AppendToParameterList("CA",0);}},LineTo:function LineTo(x,y,isCurveAnimation,basePoint){var pIns;pIns=hAddInstruction.call(this,$JI.JSONInsLineTo);pIns.AppendToParameterList("X",x);pIns.AppendToParameterList("Y",y);if(isCurveAnimation){pIns.AppendToParameterList("CA",1);pIns.AppendToParameterList("BPX",basePoint.x);pIns.AppendToParameterList("BPY",basePoint.y);}else{pIns.AppendToParameterList("CA",0);}},BezierCurveTo:function BezierCurveTo(cP1X,cP1Y,cP2X,cP2Y,x,y){var pIns;pIns=hAddInstruction.call(this,$JI.JSONInsBezierCurveTo);pIns.AppendToParameterList("CP1X",cP1X);pIns.AppendToParameterList("CP1Y",cP1Y);pIns.AppendToParameterList("CP2X",cP2X);pIns.AppendToParameterList("CP2Y",cP2Y);pIns.AppendToParameterList("X",x);pIns.AppendToParameterList("Y",y);},SetRGBAFillColor:function SetRGBAFillColor(red,green,blue,alpha){var pIns;pIns=hAddInstruction.call(this,$JI.JSONInsSetRGBAFillColor);pIns.AppendToParameterList("R",this.BoundedValue(red*256,0,255));pIns.AppendToParameterList("G",this.BoundedValue(green*256,0,255));pIns.AppendToParameterList("B",this.BoundedValue(blue*256,0,255));pIns.AppendToParameterList("A",this.BoundedValue(alpha,0,1));},BoundedValue:function BoundedValue(value,min,max){if(value<min){return min;}if(value>max){return max;}return value;},SetRGBAStrokeColor:function SetRGBAStrokeColor(red,green,blue,alpha){var pIns;pIns=hAddInstruction.call(this,$JI.JSONInsSetRGBAStrokeColor);pIns.AppendToParameterList("R",this.BoundedValue(red*256,0,255));pIns.AppendToParameterList("G",this.BoundedValue(green*256,0,255));pIns.AppendToParameterList("B",this.BoundedValue(blue*256,0,255));pIns.AppendToParameterList("A",this.BoundedValue(alpha,0,1));},FillPath:function FillPath(){hAddInstruction.call(this,$JI.JSONInsFillPath);},StrokePath:function StrokePath(){hAddInstruction.call(this,$JI.JSONInsStrokePath);},SetLineDash:function SetLineDash(linePattern,dashNumber){var pIns=hAddInstruction.call(this,$JI.JSONInsSetLineDash);pIns.AppendArrayToParameterList("LinePattern",linePattern,dashNumber);},SetLineWidth:function SetLineWidth(lineWidth){var pIns=hAddInstruction.call(this,$JI.JSONInsSetLineWidth);pIns.AppendToParameterList("LineWidth",lineWidth);},SetLineJoin:function SetLineJoin(lineJoinType){var pIns=hAddInstruction.call(this,$JI.JSONInsSetLineJoin);pIns.AppendToParameterList("Type",lineJoinType);},SetFontSize:function SetFontSize(fontSize){var pIns=hAddInstruction.call(this,$JI.JSONInsSetFontSize);pIns.AppendToParameterList("FontSize",fontSize);},AddRect:function AddRect(x,y,width,height){var pIns=hAddInstruction.call(this,$JI.JSONInsAddRect);pIns.AppendToParameterList("X",x);pIns.AppendToParameterList("Y",y);pIns.AppendToParameterList("W",width);pIns.AppendToParameterList("H",height);},AddArc:function AddArc(x,y,radius,startAngle,endAngle,antiClockwise){var pIns=hAddInstruction.call(this,$JI.JSONInsAddArc);pIns.AppendToParameterList("X",x);pIns.AppendToParameterList("Y",y);pIns.AppendToParameterList("Radius",radius);pIns.AppendToParameterList("StartAngle",startAngle);pIns.AppendToParameterList("EndAngle",endAngle);pIns.AppendToParameterList("AntiClockwise",antiClockwise);},AddNeedle:function AddNeedle(needleStyle,basePoint,angle,size){var pIns=hAddInstruction.call(this,$JI.JSONInsAddNeedle);pIns.AppendToParameterList("NeedleStyle",needleStyle);pIns.AppendToParameterList("BasePoint",basePoint);pIns.AppendToParameterList("Angle",angle);pIns.AppendToParameterList("Size",size);},AddString:function AddString(point,text){var pIns=hAddInstruction.call(this,$JI.JSONInsAddString);pIns.AppendToParameterList("Point",point);pIns.AppendToParameterList("Text",text);},FillSimple:function FillSimple(fill,darkerFactor,color,hasExtraPara){var pIns=hAddInstruction.call(this,$JI.JSONInsFillSimple,fill);pIns.AppendToParameterList("DarkerFactor",darkerFactor);if(hasExtraPara){pIns.AppendToParameterList("HEP",1);pIns.AppendToParameterList("FC",color);}else{pIns.AppendToParameterList("HEP",0);}hAddFormat.call(this,fill);},FillPattern:function FillPattern(fill){hAddInstruction.call(this,$JI.JSONInsFillPattern,fill);hAddFormat.call(this,fill);},FillGradient:function FillGradient(fill,boundingRect,darkerFactor){var pIns=hAddInstruction.call(this,$JI.JSONInsFillGradient,fill);pIns.AppendToParameterList("BoundingRect",boundingRect);pIns.AppendToParameterList("DarkerFactor",darkerFactor);hAddFormat.call(this,fill);},FillEdgeType:function FillEdgeType(fill,polygon){var pIns=hAddInstruction.call(this,$JI.JSONInsFillEdgeType,fill);pIns.AppendSimpleVectorToParameterList("Polygon",polygon);hAddFormat.call(this,fill);},FillRadientGradient:function FillRadientGradient(fill,rgUsage,cPX,cPY,innerRadius,outerRadius,hasExtraPara,extraDepth,extraIntensity){var pIns=hAddInstruction.call(this,$JI.JSONInsFillRadientGradient,fill);pIns.AppendToParameterList("RGUsage",rgUsage);pIns.AppendToParameterList("CX",cPX);pIns.AppendToParameterList("CY",cPY);pIns.AppendToParameterList("InnerRadius",innerRadius);pIns.AppendToParameterList("OuterRadius",outerRadius);if(hasExtraPara){pIns.AppendToParameterList("HEP",1);pIns.AppendToParameterList("ExtraDepth",extraDepth);pIns.AppendToParameterList("ExtraIntensity",extraIntensity);}else{pIns.AppendToParameterList("HEP",0);}hAddFormat.call(this,fill);},FillBorderMetallic:function FillBorderMetallic(fill,borderUse,cPX,cPY,radius,thickness){var pIns=hAddInstruction.call(this,$JI.JSONInsFillBorderMetallic,fill);pIns.AppendToParameterList("BorderUse",borderUse);pIns.AppendToParameterList("CX",cPX);pIns.AppendToParameterList("CY",cPY);pIns.AppendToParameterList("Radius",radius);pIns.AppendToParameterList("Thickness",thickness);hAddFormat.call(this,fill);},FillDonutOrSphere:function FillDonutOrSphere(fill,boundingRect,isCircularShape){var pIns=hAddInstruction.call(this,$JI.JSONInsFillDonutOrSphere,fill);pIns.AppendToParameterList("BoundingRect",boundingRect);pIns.AppendToParameterList("IsCircularShape",isCircularShape);hAddFormat.call(this,fill);},MakeDarker:function MakeDarker(fill,factor){var pIns=hAddInstruction.call(this,$JI.JSONInsMakeDarker,fill);pIns.AppendToParameterList("Factor",factor);hAddFormat.call(this,fill);},RestoreColor:function RestoreColor(fill){hAddInstruction.call(this,$JI.JSONInsRestoreColor,fill);hAddFormat.call(this,fill);},ApplyLineFormat:function ApplyLineFormat(line){hAddInstruction.call(this,$JI.JSONInsApplyLineFormat,line);hAddFormat.call(this,line);},AddFormatedText:function AddFormatedText(font,startPoint,text,props){var pIns=hAddInstruction.call(this,$JI.JSONInsAddFormatedText,font);pIns.AppendToParameterList("StartPoint",startPoint);pIns.AppendToParameterList("Text",text);hAddFormat.call(this,font);},ApplyBeveledFrameToRectangle:function ApplyBeveledFrameToRectangle(rect,rotationAngle,bevelDepth,leftTopColor,leftTopAlpha,rightBottomColor,rightBottomAlpha){var pIns=hAddInstruction.call(this,$JI.JSONInsApplyBeveledFrameToRectangle);pIns.AppendToParameterList("Rect",rect);pIns.AppendToParameterList("RotationAngle",rotationAngle);pIns.AppendToParameterList("BevelDepth",bevelDepth);pIns.AppendToParameterList("LTColor",leftTopColor);pIns.AppendToParameterList("LTAlpha",leftTopAlpha);pIns.AppendToParameterList("RBColor",rightBottomColor);pIns.AppendToParameterList("RBAlpha",rightBottomAlpha);},DrawGaugeMarker:function DrawGaugeMarker(basePoint,markerSize,markerShape,angle,needSize){var pIns=hAddInstruction.call(this,$JI.JSONInsAddGaugeMarker);pIns.AppendToParameterList("MarkSize",markerSize);pIns.AppendToParameterList("MarkShape",markerShape);pIns.AppendToParameterList("Angle",angle);pIns.AppendToParameterList("NeedleSize",needSize);pIns.AppendToParameterList("BPX",basePoint.x);pIns.AppendToParameterList("BPY",basePoint.y);},ApplyDonutToRect:function ApplyDonutToRect(startPoint,endPoint,fill){var pIns=hAddInstruction.call(this,$JI.JSONInsFillDonut2Rect,fill);pIns.AppendToParameterList("StartPoint",startPoint);pIns.AppendToParameterList("EndPoint",endPoint);},BeginFirstFrame:function BeginFirstFrame(){if(this.mpCurrentUnit===null||this.mpCurrentUnit.IsValid()){this.mpCurrentUnit=new $C.JSONUnit({mIsAnimated:true,mIsLastFrame:false});this.mUnitList.push(this.mpCurrentUnit);}this.mpCurrentUnit.SetToFirstFrame();},BeginLastFrame:function BeginLastFrame(){if(this.mpCurrentUnit===null||this.mpCurrentUnit.IsValid()){this.mpCurrentUnit=new $C.JSONUnit({mIsAnimated:true,mIsLastFrame:true});this.mUnitList.push(this.mpCurrentUnit);}this.mpCurrentUnit.SetToLastFrame();},EndFrame:function EndFrame(){if(this.mpCurrentUnit!==null&&this.mpCurrentUnit.IsValid()){this.mpCurrentUnit=null;}},EndUnit:function EndUnit(){this.mpCurrentUnit=null;},hConstructJSONObject:function hConstructJSONObject(){var fmtList=this.mFormatList,unitList=this.mUnitList,j,len,i,lJSONObject,count;j=this.mJSONObject={};$HASH.forEach(this.mFormatMap,function(v,k,h){fmtList.push(v);});fmtList.sort(SortFormatList);len=unitList.length;for(i=0;i<len;++i){unitList[i].CalculateFormatIndex(fmtList);}j.UnitList=[];if(len>0){if(len===1){lJSONObject={};unitList[0].AppendToJSONObject(lJSONObject);j.UnitList.push(lJSONObject);}else{count=0;lJSONObject={};unitList[0].AppendToJSONObject(lJSONObject);j.UnitList.push(lJSONObject);for(i=1;i<len;++i){lJSONObject={};unitList[i].AppendToJSONObject(lJSONObject);if(unitList[i-1].IsAnimated()!==unitList[i].IsAnimated()){j.UnitList.push(lJSONObject);count++;}else{j.UnitList[count].InstructionList=j.UnitList[count].InstructionList.concat(lJSONObject.InstructionList);}}}}$JSONUtil.AppendCompoundPointerVectorToJSONObject("FormatList",fmtList,j);this.mIsJSONObjectConstructed=true;}});}());