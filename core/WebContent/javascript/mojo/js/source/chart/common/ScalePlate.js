(function(){function hComputeStep(iMaximum,iMinimum,iIncludeZero){var range,step;range=0;if(iIncludeZero){range=Math.max(iMaximum,iMaximum-iMinimum);range=Math.max(range,-iMinimum);}else{range=iMaximum-iMinimum;}if(range===0){this.mIsShown=false;return 1;}var absoluteRange=range;step=1;while(range<1){range*=10;step/=10;}while(range>=10){range/=10;step*=10;}if(range<1.8){step*=2;step/=10;}else{if(range<3.1){step*=4;step/=10;}else{if(range<4.6){step*=5;step/=10;}else{if(range>=8.1){step*=2;}}}}return step;}function hComputeTicksForFlexMinMax(axisOptions){var ticksCount,i;this.mStep=hComputeStep.call(this,this.mMaximum,this.mMinimum,axisOptions.mAlwaysIncludeZero);this.mMaxTick=Math.ceil(this.mMaximum/this.mStep)*this.mStep;this.mMinTick=Math.floor(this.mMinimum/this.mStep)*this.mStep;this.mMinTick=(this.mMinTick*this.mMinimum<0)?0:this.mMinTick;if(axisOptions.mAlwaysIncludeZero){this.mMaxTick=(this.mMaximum<0)?0:this.mMaxTick;this.mMinTick=(this.mMinimum>0)?0:this.mMinTick;}var range=this.mMaxTick-this.mMinTick;if(this.mStep>=range){return ;}ticksCount=Math.floor((this.mMaxTick-this.mMinTick+this.mStep/100)/this.mStep)+1;for(i=1;i<ticksCount-1;++i){var value=this.mMinTick+i*this.mStep;this.mTicks.push(value);}}function hComputeTicksForPercent(axisOptions){var tick;this.mMaxTick=1;this.mStep=this.mMinimum<0?0.2:0.1;if(axisOptions.mUseCustomMinMax){this.mMaxTick=axisOptions.mAxisMaxValue;this.mMinTick=axisOptions.mAxisMinValue;this.mMaxTick=Math.min(1,this.mMaxTick);this.mMinTick=Math.max(-1,this.mMinTick);this.mStep=0.1;}else{if(this.mMaximum>=0.5){this.mMaxTick=1;this.mMinTick=Math.floor(this.mMinimum/this.mStep)*this.mStep;this.mMinTick=(this.mMinTick*this.mMinimum<0)?0:(this.mMinTick>0?0:this.mMinTick);if(this.mMinimum<-0.5){this.mMinTick=-1;}}else{if(this.mMaximum>0){this.mMaxTick=Math.ceil(this.mMaximum/this.mStep)*this.mStep;this.mMinTick=-1;}else{this.mStep=0.1;this.mMaxTick=0;this.mMinTick=-1;}}}for(tick=this.mMinTick+this.mStep;tick+0.01<this.mMaxTick;tick+=this.mStep){this.mTicks.push(Math.round(tick*100)/100);}}function log10(x){return Math.log(x)/Math.log(10);}function hComputeTicksForLogScale(axisOptions){var ceilLogMax,floorLogMin,i;this.mStep=1;if(this.mMaximum<=0){this.mMinTick=1;this.mMaxTick=10;return ;}if(this.mMinimum<=0){floorLogMin=this.mMaximum>1?0:-1;this.mMinTick=Math.pow(10,floorLogMin);if(axisOptions.mUseCustomMinMax){this.mMaxTick=this.mMaximum;ceilLogMax=Math.floor(log10.call(this,this.mMaximum));if(log10.call(this,this.mMaximum)===ceilLogMax){ceilLogMax--;}}else{ceilLogMax=Math.ceil(log10.call(this,this.mMaximum));this.mMaxTick=Math.pow(10,ceilLogMax);}for(i=floorLogMin+1;i<ceilLogMax;++i){this.mTicks.push(Math.pow(10,Math.floor(i)));}return ;}if(axisOptions.mUseCustomMinMax){ceilLogMax=log10.call(this,this.mMaximum);floorLogMin=log10.call(this,this.mMinimum);this.mMaxTick=this.mMaximum;this.mMinTick=this.mMinimum;}else{ceilLogMax=Math.ceil(log10.call(this,this.mMaximum));floorLogMin=Math.floor(log10.call(this,this.mMinimum));this.mMaxTick=Math.pow(10,ceilLogMax);this.mMinTick=Math.pow(10,floorLogMin);}for(i=floorLogMin+1;i<ceilLogMax;++i){this.mTicks.push(Math.pow(10,Math.floor(i)));}}function hComputeTicks(axisOptions){this.mTicks.splice(0,this.mTicks.length);if(this.mIsPercent){return hComputeTicksForPercent.call(this,axisOptions);}if(axisOptions.mUseLogarithmicScale){return hComputeTicksForLogScale.call(this,axisOptions);}hComputeTicksForFlexMinMax.call(this,axisOptions);}function hAdjustTicks(axisOptions){if(axisOptions.mUseCustomMinMax||axisOptions.mUseLogarithmicScale){return ;}var sTickOffsetRatio=0.1,fixMin=false,fixMax=false,ticks=[];this.GetTicks(ticks);if(ticks.length>=2){var size=ticks.length;fixMax=((Math.abs(this.mMaximum-ticks[size-2])<sTickOffsetRatio*this.mStep));fixMin=((Math.abs(this.mMinimum-ticks[1])<sTickOffsetRatio*this.mStep));if(this.mIsPercent){fixMax=false;}}if(fixMax&&fixMin){this.mMinTick=this.mMinimum;this.mMaxTick=this.mMaximum;axisOptions.mUseMinValue=axisOptions.mShowMinLabel=true;axisOptions.mUseMaxValue=axisOptions.mShowMaxLabel=true;}else{if(fixMax){this.mMaxTick=this.mMaximum;axisOptions.mUseMaxValue=axisOptions.mShowMaxLabel=true;}else{if(fixMin){this.mMinTick=this.mMinimum;axisOptions.mUseMinValue=axisOptions.mShowMinLabel=true;}else{}}}if(axisOptions.mAlwaysIncludeZero){this.mMaxTick=(this.mMaximum<0)?0:this.mMaxTick;this.mMinTick=(this.mMinimum>0)?0:this.mMinTick;}}mstrmojo.chart.common.ScalePlate=mstrmojo.provide("mstrmojo.chart.common.ScalePlate",{mOptions:{mShowMinLabel:true,mShowMaxLabel:true},isStackedChart:false,mStep:0,mIsPercent:false,mMinimum:0,mMaximum:0,mMaxTick:0,mMinTick:0,mTicks:[],clear:function clear(){this.isStackedChart=this.mIsPercent=false;this.mMinimum=this.mMaximum=0;this.mMinTick=this.mMaxTick=0;this.mStep=0;this.mTicks=[];},GetTicks:function GetTicks(orTicks){if(this.mOptions.mShowMinLabel){orTicks.push(this.mMinTick);}var i;for(i=0;i<this.mTicks.length;++i){orTicks.push(this.mTicks[i]);}if(this.mOptions.mShowMaxLabel){orTicks.push(this.mMaxTick);}},getMaxMinTickValue:function getMaxMinTickValue(axisOptions,chartLayout,max,min){this.computeTicks(axisOptions,chartLayout,max,min);return{Max:this.mMaxTick,Min:this.mMinTick};},computeTicks:function computeTicks(axisOptions,chartLayout,max,min){this.mMinimum=min;this.mMaximum=max;this.mIsPercent=!!(chartLayout&1);this.isStackedChart=!!(chartLayout&2);var sTolerance=1e-14;if(!axisOptions.mUseLogarithmicScale&&this.isStackedChart){this.mMinimum=Math.min(this.mMinimum,0);this.mMaximum=Math.max(this.mMaximum,0);}if(axisOptions.mDrawCustomLine){this.mMinimum=Math.min(this.mMinimum,axisOptions.mAxisCustomValue);this.mMaximum=Math.max(this.mMaximum,axisOptions.mAxisCustomValue);}if(this.mIsPercent&&this.mMinimum===this.mMaximum&&1===this.mMaximum){if(this.mMinimum===1){this.mMinimum=0;}}if(Math.abs(this.mMinimum-this.mMaximum)<sTolerance){if(this.mMinimum<-sTolerance||this.mMinimum>sTolerance){var temp=Math.abs(this.mMinimum)*0.5;this.mMaximum=this.mMaximum+temp;this.mMinimum=this.mMinimum-temp;}else{this.mMinimum=-6;this.mMaximum=6;}}hComputeTicks.call(this,axisOptions);if(axisOptions.mUseLogarithmicScale&&this.isStackedChart){this.mMaximum=axisOptions.mDrawCustomLine?Math.max(this.mMaximum+this.mMinTick,axisOptions.mAxisCustomValue):this.mMaximum+this.mMinTick;this.mMinimum=Math.min(this.mMinimum,0);this.mTicks.splice(0,this.mTicks.length);hComputeTicksForLogScale.call(this,axisOptions);}hAdjustTicks.call(this,axisOptions);}});}());