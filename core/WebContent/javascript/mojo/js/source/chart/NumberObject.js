(function(){mstrmojo.requiresCls("mstrmojo.num","mstrmojo.VisUtility");mstrmojo.requiresClsP("mstrmojo.chart.common","FractionNumber","Utility");mstrmojo.requiresClsP("mstrmojo.chart","TextObject","ChartAdvFormat","ChartContext","ShapeObject","SubTextHolder","Point2D");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumGraphMajorType","EnumNumberCategory");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphType","EnumDSSGraphObject","EnumDSSGraphProperty");var $C=mstrmojo.chart,$CHART_ENUMS=$C.enums,$VISUTIL=mstrmojo.VisUtility,$GMT=$CHART_ENUMS.EnumGraphMajorType,$NC=$CHART_ENUMS.EnumNumberCategory,kMaxNumberLength=5,kGraphMatrixMaxNumberLength=5;var $M=mstrmojo.chart.model,$MODEL_ENUMS=$M.enums,$GT=$MODEL_ENUMS.EnumDSSGraphType,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$GP=$MODEL_ENUMS.EnumDSSGraphProperty,$NUM=mstrmojo.num,$COMMON=mstrmojo.chart.common,$Utility=$COMMON.Utility,$Utility_id=$Utility.tripleId;var sFixedStringTable=["[SF:-3]","[SF:-6]","[SF:-9]"];var perfTripleId=new $C.TripleId(),perfNumberFormat=new $C.ChartAdvFormat(),perfGridFormat=new $C.ChartAdvFormat(),perfAxisLabelNumberFormat=new $C.ChartAdvFormat();function isValueAxisLabel(objectId){switch(objectId){case $GO.DssGraphY1Label:case $GO.DssGraphY2Label:case $GO.DssGraphY3Label:case $GO.DssGraphY4Label:case $GO.DssGraphX1Label:case $GO.DssGraphX2Label:return true;}return false;}function hGetMappedObjectId(tripleId){switch(tripleId.mObjectId){case $GO.DssGraphUserLabel1:return $GO.DssGraphY1Label;case $GO.DssGraphUserLabel2:return $GO.DssGraphY2Label;case $GO.DssGraphUserLabel3:return $GO.DssGraphX1Label;case $GO.DssGraphUserLabel4:return $GO.DssGraphX2Label;default:return tripleId.mObjectId;}}function hSetText(irString){var prefix,suffix=this.mSuffix,text=irString;if(text.length&&this.mNumber<0){if(text[0]==="-"&&this.mPrefix!=="-"){text=text.substring(1);this.mPrefix="-"+this.mPrefix;}}prefix=this.mPrefix;if(this.mHasBracket){if(text.length>=2&&text[0]==="("&&text[text.length-1]===")"){text="("+prefix+text.substring(1,text.length-2)+suffix+")";}else{text=prefix+text+suffix;}}else{text=prefix+text+suffix;}if(this.mIsFinal){this.SetText(text);}else{this.mText=text;}}function hIsFraction(irFormat){return(irFormat.search(/\?\/[0-9\?]/)!==-1);}function hRemoveMinusFromNegExpComponent(iorNumberFormat){return iorNumberFormat.replace(/[^"]E-/,"E");}function doubleToFraction(value,seperated,denominatorLimit,iIncludeZeroNume){var resultNumber,low,high,mid,intPart,isPositive,n;n=denominatorLimit;resultNumber=new $COMMON.FractionNumber();low=new $COMMON.FractionNumber();high=new $COMMON.FractionNumber();mid=new $COMMON.FractionNumber();low.mNumerator=0;low.mDenominator=high.mDenominator=high.mNumerator=1;mid.mDenominator=low.mDenominator+high.mDenominator;mid.mNumerator=low.mNumerator+high.mNumerator;isPositive=value>=0;value=Math.abs(value);intPart=Math.floor(value);value-=intPart;while(mid.mDenominator<n){if(Math.abs(mid.ToDouble()-value)<1e-15){resultNumber.Copy(mid);break;}if(mid.ToDouble()>value){high.Copy(mid);}else{low.Copy(mid);}mid.mDenominator=low.mDenominator+high.mDenominator;mid.mNumerator=low.mNumerator+high.mNumerator;}if(mid.mDenominator>=n){if(value-low.ToDouble()<high.ToDouble()-value){resultNumber.Copy(low);}else{resultNumber.Copy(high);}}if(intPart>0){resultNumber.mNumerator+=intPart*resultNumber.mDenominator;}return resultNumber.ToString(seperated,isPositive,iIncludeZeroNume);}function convertToFraction(value,formatString,zeroNumerator){var i,j,stemp,base=10,sepInt,found;found=formatString.indexOf("# ",0);sepInt=(found!==-1);for(i=5;i>0;i--){stemp="/";for(j=0;j<i;j++){stemp+="?";}found=formatString.indexOf(stemp,0);if(found!==-1){for(j=1;j<i;j++){base*=10;}break;}}var resultString;resultString=doubleToFraction(value,sepInt,base,zeroNumerator);return resultString;}function hConvertToFraction(value,formatString){var fixedBase,result,ss,pos=formatString.lastIndexOf("/"),baseString=formatString.substr(pos+1,formatString.length);fixedBase=(baseString.indexOf("?")===-1);if(fixedBase){var isNeg=value<0,sepInt=(formatString.indexOf("# ",0)!==-1),intPart,base=baseString.ToInteger();value=Math.abs(value);intPart=Math.floor(value);value-=intPart;var N=Math.floor(value*base+0.5);intPart+=N/base;N%=base;if(!sepInt){N+=intPart*base;intPart=0;}if(intPart===0&&N===0){return"0";}if(intPart!==0){ss=intPart.ToString();if(N!==0){ss+=" ";}}if(N!==0){ss=N.ToString();ss+="/";ss+=base.ToString();}result=ss;if(isNeg){result="-"+result;}return result;}var objectId=this.mTripleId.mObjectId,isAxisLabel=isValueAxisLabel.call(this,objectId),isDataText=objectId===$GO.DssGraphDataText;result=convertToFraction(value,formatString,!isAxisLabel&&!isDataText);return result;}function hGetPreAndSuffix(iorFormatStr){var quote,position1,position2,orPrefix="",orSuffix="";quote='"';position1=iorFormatStr.indexOf(quote);if(position1===-1){return{Format:iorFormatStr,HasLeftOver:true,Prefix:orPrefix,Suffix:orSuffix};}position2=iorFormatStr.indexOf(quote,position1+1);if(position2===-1){return{Format:iorFormatStr,HasLeftOver:false,Prefix:orPrefix,Suffix:orSuffix};}if(position1===0){orPrefix=iorFormatStr.substring(1,position2);iorFormatStr=iorFormatStr.substring(position2+1);}position1=iorFormatStr.lastIndexOf(quote);if(position1===-1){return{Format:iorFormatStr,HasLeftOver:true,Prefix:orPrefix,Suffix:orSuffix};}position2=iorFormatStr.lastIndexOf(quote,position1-1);if(position2===-1){return{Format:iorFormatStr,HasLeftOver:false,Prefix:orPrefix,Suffix:orSuffix};}if(position1===iorFormatStr.length-1){orSuffix=iorFormatStr.substring(position2+1,position1);iorFormatStr=iorFormatStr.substring(0,position2);}return{Format:iorFormatStr,HasLeftOver:true,Prefix:orPrefix,Suffix:orSuffix};}function hGetPreAndSuffixWithBracket(iorFormatStr,iDividPosAndNeg){iDividPosAndNeg=iDividPosAndNeg||false;var hasBracket,positivePart="",negativePart="",position,hasNegPart,hasColor,colorPart,position1,hasLeftover,orPrefix,orSuffix,usePositiveFormattingForNegative=false,returnVal;position=iorFormatStr.indexOf(";");hasBracket=false;if(position!==-1){positivePart=iorFormatStr.substring(0,position);negativePart=iorFormatStr.substring(position+1);}else{positivePart=iorFormatStr;if(iDividPosAndNeg===false){negativePart=positivePart;usePositiveFormattingForNegative=true;}}hasNegPart=negativePart.length>0;hasColor=hasNegPart;if(hasColor){hasColor=negativePart[0]==="[";if(hasColor){position1=negativePart.indexOf("]");hasColor=position1!==-1;if(hasColor){colorPart=negativePart.substring(0,position1+1);negativePart=negativePart.substring(position1+1);}}}if(negativePart.length>=2){hasBracket=(negativePart[0]==="("&&negativePart[negativePart.length-1]===")");}if(hasBracket){negativePart=negativePart.substring(1,negativePart.length-1);}hasLeftover=false;if(this.mNumber>=0){returnVal=hGetPreAndSuffix.call(this,positivePart);positivePart=returnVal.Format;hasLeftover=returnVal.HasLeftOver;orPrefix=returnVal.Prefix;orSuffix=returnVal.Suffix;returnVal=hGetPreAndSuffix.call(this,negativePart);negativePart=returnVal.Format;}else{returnVal=hGetPreAndSuffix.call(this,negativePart);negativePart=returnVal.Format;hasLeftover=returnVal.HasLeftOver;orPrefix=returnVal.Prefix;orSuffix=returnVal.Suffix;returnVal=hGetPreAndSuffix.call(this,positivePart);positivePart=returnVal.Format;}if(hasBracket){negativePart="("+negativePart+")";}if(hasColor){negativePart=colorPart+negativePart;}if(hasNegPart){if(usePositiveFormattingForNegative){iorFormatStr=negativePart;}else{iorFormatStr=positivePart+";"+negativePart;}}else{iorFormatStr=positivePart;}return{Format:iorFormatStr,HasLeftOver:hasLeftover,HasBracket:hasBracket,Prefix:orPrefix,Suffix:orSuffix};}function hFilterQuotes(ipString,iDividePosAndNeg){iDividePosAndNeg=(iDividePosAndNeg!==undefined)?iDividePosAndNeg:true;var numberFormatString,prefix,suffix,returnVal;if(this.mPrefix.length>0||this.mSuffix.length>0){return ipString;}numberFormatString=ipString.substring(0);returnVal=hGetPreAndSuffixWithBracket.call(this,numberFormatString,iDividePosAndNeg);numberFormatString=returnVal.Format;prefix=returnVal.Prefix;suffix=returnVal.Suffix;if(prefix.length){this.mPrefix=prefix;}if(suffix.length){this.mSuffix=suffix;}return numberFormatString.substring(0);}function hHandleNegNumberFormat(ipFormattingString,negativeFormat,iLocale){var number,formattedString;number=this.mNumber;if(this.mNumber<0&&negativeFormat>=2&&negativeFormat!==5){number=-this.mNumber;}formattedString=$Utility.hFormatValue(ipFormattingString,number);if(this.mNumber<0){if(negativeFormat===3||negativeFormat===4){formattedString="("+formattedString+")";}if(negativeFormat===2||negativeFormat===4||negativeFormat===5){this.mColor=255;}}hSetText.call(this,formattedString);}function hFormatFixed(numberFormat,iLocale){var preChar,postChar,suffixChar,stringLen,formatString,indexInString=-1,indexOfTable=-1,fixedStringTable=["[SF:-3]","[SF:-6]","[SF:-9]"];preChar=numberFormat.mCustomFormat[0];stringLen=numberFormat.mCustomFormat.length;postChar=numberFormat.mCustomFormat[stringLen-1];formatString=numberFormat.mCustomFormat.substring(0);if(preChar==="K"){indexInString=1;indexOfTable=0;suffixChar="K";}else{if(postChar==="K"){indexInString=stringLen;indexOfTable=0;suffixChar="K";}else{if(preChar==="M"){indexInString=1;indexOfTable=1;suffixChar="M";}else{if(postChar==="M"){indexInString=stringLen;indexOfTable=1;suffixChar="M";}else{if(preChar==="B"){indexInString=1;indexOfTable=2;suffixChar="B";}else{if(postChar==="B"){indexInString=stringLen;indexOfTable=2;suffixChar="B";}}}}}}if(indexInString!==-1){formatString.replace(/([KMB])/g,'"$1"');var replacedText;var pos=formatString.indexOf(";");if(pos!==-1){if(preChar===suffixChar){replacedText='"'+suffixChar+'"'+sFixedStringTable[indexOfTable];}else{replacedText=sFixedStringTable[indexOfTable]+'"'+suffixChar+'"';}formatString.replace(";",";"+fixedStringTable[indexOfTable]);}formatString=sFixedStringTable[indexOfTable]+formatString;}hHandleNegNumberFormat.call(this,formatString,numberFormat.mNegFormat,iLocale);}function hFormatCurrency(numberFormat,iLocale){var returnVal,formatString=numberFormat.mCustomFormat.substring(0);returnVal=hGetPreAndSuffixWithBracket.call(this,formatString);this.mHasBracket=this.mHasBracket||returnVal.HasBracket;formatString=returnVal.Format;var hasLeftOver=!returnVal.HasLeftOver,hasBracket=returnVal.HasBracket,prefix=returnVal.Prefix,suffix=returnVal.Suffix;if(prefix.length){this.mPrefix=prefix.substring(0);}if(suffix.length){this.mSuffix=suffix.substring(0);}numberFormat.mCustomFormat=formatString.substring(0);if(hasLeftOver){numberFormat.mCustomFormat=hFilterQuotes.call(this,numberFormat.mCustomFormat);}hHandleNegNumberFormat.call(this,numberFormat.mCustomFormat,numberFormat.mNegFormat,iLocale);}function hAnalyzeSeparatorAtTail(iorNumberFormat){var position,formatString,result,len=iorNumberFormat.length;if(len===0){return{Format:iorNumberFormat,Base:1};}if(iorNumberFormat[len-1]!==","){return{Format:iorNumberFormat,Base:1};}if(iorNumberFormat===","){return{Format:iorNumberFormat,Base:1000};}formatString=iorNumberFormat.reverse();position=formatString.search(/[^,]/);if(position===-1){result=Math.pow(1000,len);return{Format:"",Base:result};}result=Math.pow(1000,position);return{Format:iorNumberFormat.substring(0,len-1),Base:result};}function hSetTextFromGrid(iDatasetPtr,iLocale){var backUpNumber=this.mNumber,hr,str,formatString,formattedText,base,pre,pos,pre1,pos1,dot,dotIndex,number,len,baseTag,text,quto,suffix,hasNegSignTakenOut,textSize,hasBracket,i;if(iDatasetPtr===null){hSetText.call(this,$Utility.hFormatValue("General",this.mNumber));}else{perfGridFormat.restore();hr=iDatasetPtr.getGridDataFormat(perfGridFormat,(this.mTripleId.mSeriesId<0)?0:this.mTripleId.mSeriesId,(this.mTripleId.mGroupId<0)?0:this.mTripleId.mGroupId,this.mColumnOffset);if(hr!==true){hSetText.call(this,$Utility.hFormatValue("General",this.mNumber));return ;}str=perfGridFormat.mCustomFormat.substring(0);if(hIsFraction.call(this,str)){perfGridFormat.mFormatType=$NC.Fraction;}if(perfGridFormat.mFormatType===$NC.Fraction){formatString=perfGridFormat.mCustomFormat.substring(0);formattedText=hConvertToFraction.call(this,this.mNumber,formatString);hSetText.call(this,formattedText);return ;}perfGridFormat.mCustomFormat=hFilterQuotes.call(this,perfGridFormat.mCustomFormat);formatString=perfGridFormat.mCustomFormat.substring(0);hRemoveMinusFromNegExpComponent.call(this,formatString);var lRetVal=hAnalyzeSeparatorAtTail.call(this,formatString);base=lRetVal.Base;formatString=lRetVal.Format;this.mNumber/=base;if(this.replaceQuestionMarkWithHash(formatString)){pre=formatString.indexOf(".");pos=formatString.length-pre-1;text=$Utility.hFormatValue(formatString,this.mNumber);pre1=text.indexOf(".");pos1=0;if(pre1===-1){pre1=text.length;pos=pos1;}else{pos1=text.length-pre-1;}pre-=pre1;pos-=pos1;if(pre>0){this.mPrefix="";for(i=0;i<pre;i++){this.mPrefix+=" ";}}if(pos>0){this.mSuffix="";for(i=0;i<pre;i++){this.mSuffix+=" ";}}hSetText.call(this,text);this.mNumber=backUpNumber;return ;}if(perfGridFormat.mFormatType===$NC.Scientific){formatString.replace("#","0");}dot=".";base=1;dotIndex=formatString.lastIndexOf(dot);number=this.mNumber;if(dotIndex!==-1&&perfGridFormat.mFormatType===$NC.Custom){var lRet=this.AdjustFormatStringWithDot(formatString,dotIndex);base=lRet.BASE;formatString=lRet.STRING;number/=base;}else{if(perfGridFormat.mFormatType===$NC.Custom){len=formatString.length;if(len>2){var lastChar=formatString[len-1];if(formatString[len-2]==="\\"&&(lastChar==="B"||lastChar==="b"||lastChar==="M"||lastChar==="m"||lastChar==="K"||lastChar==="k")){baseTag=formatString[len-1];quto='"';formatString=formatString.substring(0,len-2);formatString+=quto;formatString+=baseTag;formatString+=quto;suffix="";base=this.getBaseForCustomFormatting(formatString);number/=base;formatString+=quto;formatString+=suffix;formatString+=quto;}}}}hasNegSignTakenOut=false;if(formatString.indexOf("* -")!==-1){hasNegSignTakenOut=this.mNumber<0;if(hasNegSignTakenOut){formatString.replace("* -","* ");}}if(formatString===""){hSetText.call(this,$Utility.hFormatValue("General",this.mNumber));return ;}text=$Utility.hFormatValue(formatString,number);textSize=text.length;if(text.length){hasBracket=perfGridFormat.mNegFormat>=3&&text[0]==="("&&text[textSize-1]===")";if(hasBracket&&text.length>this.mPrefix.length&&this.mPrefix.length&&this.mNumber<0){text="("+this.mPrefix+text.substring(1);this.mPrefix=this.mSuffix="";}}if(hasNegSignTakenOut){this.mText=text;pos=this.mText.search(/[0-9]/);if(pos!==-1){if(pos>0){text=this.mText.substring(0,pos);}text=text+"-"+this.mText.substring(pos);}}hSetText.call(this,text);this.mNumber=backUpNumber;}}function hSetNumberFormat(iDatasetPtr,irNumberFormat,iLocale){var numberFormat,i,backupNumber,formattedText,formatString,returnVal,hasNegSignTakeOut,tempFormatString,isFraction,base,pre,pos,pre1,pos1,dot,dotIndex,text;switch(irNumberFormat.mFormatType){case $NC.Default:$VISUTIL.visPrint("should not reach here.");break;case $NC.General:hSetText.call(this,$Utility.hFormatValue("",this.mNumber));break;case $NC.FromGrid:hSetTextFromGrid.call(this,iDatasetPtr,iLocale);break;case $NC.Fixed:hFormatFixed.call(this,irNumberFormat,iLocale);break;case $NC.Date:case $NC.Time:formatString=irNumberFormat.mCustomFormat.substring(0);formatString.replace(/[:(tt)]/g,"");hSetText.call(this,$Utility.hFormatValue(formatString,this.mNumber));break;case $NC.Percentage:formatString=irNumberFormat.mCustomFormat.substring(0);hHandleNegNumberFormat.call(this,formatString,irNumberFormat.mNegFormat,iLocale);break;case $NC.Fraction:formatString=irNumberFormat.mCustomFormat.substring(0);formattedText=hConvertToFraction.call(this,this.mNumber,formatString);hSetText.call(this,formattedText);break;case $NC.Special:numberFormat=new $C.ChartAdvFormat({ChartAdvFormat:irNumberFormat});if(numberFormat.mCustomFormat.localeCompare("#####")===false&&this.mNumber===0){numberFormat.mCustomFormat[4]="0";}hSetText.call(this,$Utility.hFormatValue(numberFormat.mCustomFormat,this.mNumber));break;case $NC.Currency:numberFormat=new $C.ChartAdvFormat({ChartAdvFormat:irNumberFormat});hFormatCurrency.call(this,numberFormat,iLocale);break;case $NC.Scientific:formatString=irNumberFormat.mCustomFormat.substring(0);formatString.replace("#","0");hSetText.call(this,$NUM.formatByMask(formatString,this.mNumber));break;default:backupNumber=this.mNumber;hasNegSignTakeOut=false;numberFormat=new $C.ChartAdvFormat({ChartAdvFormat:irNumberFormat});tempFormatString=numberFormat.mCustomFormat.substring(0);if(tempFormatString==="?"){tempFormatString="0";}if(numberFormat.mFormatType===$NC.Custom){isFraction=hIsFraction.call(this,tempFormatString);if(isFraction){formattedText=hConvertToFraction.call(this,this.mNumber,tempFormatString);hSetText.call(this,formattedText);return ;}tempFormatString=hRemoveMinusFromNegExpComponent.call(this,tempFormatString);returnVal=hAnalyzeSeparatorAtTail.call(this,tempFormatString);base=returnVal.Base;tempFormatString=returnVal.Format;this.mNumber/=base;if(this.replaceQuestionMarkWithHash(tempFormatString)){pre=tempFormatString.indexOf(".");pos=tempFormatString.length-pre-1;text=$Utility.hFormatValue(tempFormatString,this.mNumber);pre1=text.indexOf(".");pos1=0;if(pre1===-1){pre1=text.length;pos=pos1;}else{pos1=text.length-pre-1;}pre-=pre1;pos-=pos1;if(pre>0){this.mPrefix="";for(i=0;i<pre;i++){this.mPrefix+=" ";}}if(pos>0){this.mSuffix="";for(i=0;i<pre;i++){this.mSuffix+=" ";}}hSetText.call(this,text);this.mNumber=backupNumber;return ;}if(tempFormatString.indexOf("* -")!==-1){tempFormatString.replace("* -","* ");hasNegSignTakeOut=true;}}dot=".";dotIndex=tempFormatString.lastIndexOf(dot);if(dotIndex!==-1){var lRet=this.AdjustFormatStringWithDot(tempFormatString,dotIndex);base=lRet.BASE;tempFormatString=lRet.STRING;this.mNumber/=base;}hSetText.call(this,$Utility.hFormatValue(tempFormatString,this.mNumber));if(hasNegSignTakeOut&&this.mNumber<0){text=this.mText.substring(0);pos=text.search(/[0-9]/);if(pos!==-1){if(pos>0){this.mText=text.substring(0,pos);}this.mText=this.mText+"-"+text.substring(pos);hSetText.call(this,this.mText);}}this.mNumber=backupNumber;break;}}function hIsCondenseAllowed(){if(!this.mChartContextPtr.mIsGraphMatrix){return false;}return this.expectCondense===true;}function hFormatAxisLabelsForTSAndGM(irNumberFormat,iLocale,iDatasetPtr){var chartCtx=this.mChartContextPtr,backup,isGraphMatrix=this.mChartContextPtr.mIsGraphMatrix,objectId=hGetMappedObjectId.call(this,this.mTripleId);if(chartCtx.mIsTimeSeriesChart&&objectId===$GO.DssGraphY1Label){this.SetNumberFormatForTimeSeries(irNumberFormat);return ;}if(isGraphMatrix===false){return ;}if(isValueAxisLabel.call(this,objectId)){if(this.shouldCondense){this.SetNumberFormatForTimeSeries(irNumberFormat);return ;}perfAxisLabelNumberFormat.reset(irNumberFormat);backup=this.mNumber;if(perfAxisLabelNumberFormat.mFormatType===$NC.Default){var axisKey=chartCtx.getAxisKeyFromObjectId(objectId),axisInfo=chartCtx.getUniformAxisInformationFromKey(axisKey),metricList=axisInfo.Metrics;if(metricList===undefined||metricList.length===0){metricList=[0];}chartCtx.getAxisAutoNumberFormat(perfAxisLabelNumberFormat,metricList);perfAxisLabelNumberFormat.mCustomFormat=hFilterQuotes.call(this,perfAxisLabelNumberFormat.mCustomFormat);}hSetNumberFormat.call(this,iDatasetPtr,perfAxisLabelNumberFormat,iLocale);var gmCtx=this.mChartContextPtr.GetGraphMatrixContext();if(hIsCondenseAllowed.call(this)){if(this.mText.length>gmCtx.getCondensedTextLimit(perfAxisLabelNumberFormat.mFormatType)){this.mNumber=backup;this.mPrefix=this.mSuffix="";this.SetNumberFormatForTimeSeries(irNumberFormat);}}}}mstrmojo.chart.NumberObject=mstrmojo.declare(mstrmojo.chart.TextObject,null,{scriptClass:"mstrmojo.chart.NumberObject",mNumber:0,mColor:-1,mIsFinal:false,mIsAbbreviated:false,mColumnOffset:0,mHasBracket:false,mPrefix:"",mSuffix:"",expectCondense:false,shouldCondense:false,init:function init(props){if(props.Locale===undefined){props.Locale=0;}this._super(props);this.mNumber=props.Number;this.mIsFinal=props.IsFinal!==undefined?props.IsFinal:true;this.mColumnOffset=props.ColumnOffset!==undefined?props.ColumnOffset:0;this.mPrefix="";this.mSuffix="";if(props.ExpectCondense){this.expectCondense=props.ExpectCondense;}if(props.ShouldCondense){this.shouldCondense=props.ShouldCondense;}this.SetNumberFormat(props.NumberFormat,props.Locale,props.DataSet);},SetNumberFormat:function SetNumberFormat(irNumberFormat,iLocale,iDatasetPtr){var chartCtx=this.mChartContextPtr,graphMajorType,isGM=this.mChartContextPtr.mIsGraphMatrix,objectId=hGetMappedObjectId.call(this,this.mTripleId),value,format,formatType,i;if(chartCtx.mIsTimeSeriesChart&&objectId===$GO.DssGraphY1Label){return hFormatAxisLabelsForTSAndGM.call(this,irNumberFormat,iLocale,iDatasetPtr);}if(chartCtx.mIsGraphMatrix&&isValueAxisLabel.call(this,objectId)){return hFormatAxisLabelsForTSAndGM.call(this,irNumberFormat,iLocale,iDatasetPtr);}perfNumberFormat.reset(irNumberFormat);formatType=perfNumberFormat.mFormatType;graphMajorType=chartCtx.GetGraphMajorType();$Utility_id.reset(perfTripleId,this.mTripleId.mObjectId);if(((objectId===$GO.DssGraphDataText||objectId===$GO.DssGraphRiser)&&(graphMajorType===$GMT.GMT_SCATTER||graphMajorType===$GMT.GMT_BUBBLE))&&!isGM){switch(this.mColumnOffset){case 0:$Utility_id.reset(perfTripleId,$GO.DssGraphX1Body);break;case 1:$Utility_id.reset(perfTripleId,$GO.DssGraphY1Body);break;case 2:$Utility_id.reset(perfTripleId,$GO.DssGraphZBody);break;default:break;}value=chartCtx.GetProperty($GP.DssGraphAxisNumberFormat,perfTripleId);if(value){chartCtx.ParseValueToFormat(value,perfNumberFormat);}switch(this.mColumnOffset){case 0:$Utility_id.reset(perfTripleId,$GO.DssGraphX1Label);break;case 1:$Utility_id.reset(perfTripleId,$GO.DssGraphY1Label);break;default:break;}}objectId=perfTripleId.mObjectId;if(isValueAxisLabel.call(this,objectId)){if(isGM===false){if(((formatType===$NC.FromGrid)||(formatType===$NC.Default))){if(chartCtx.mGraphType===$GT.DssGraphTypePareto_Percent){perfNumberFormat.mFormatType=$NC.General;}else{chartCtx.getAxisAutoNumberFormat(perfNumberFormat);perfNumberFormat.mCustomFormat=hFilterQuotes.call(this,perfNumberFormat.mCustomFormat);}}}}else{if(formatType===$NC.Default){perfNumberFormat.mFormatType=$NC.FromGrid;}if(objectId===$GO.DssGraphDataText&&formatType===$NC.FromGrid&&graphMajorType===$GMT.GMT_HISTOGRAM){perfNumberFormat.mFormatType=$NC.General;}}if((this.mNumber>1000000000000000||this.mNumber<-1000000000000000)&&formatType===$NC.Currency){format="0";for(i=0;i<perfNumberFormat.mDigits;i++){if(i===0){format+=".";}format+="0";}format+="E+00";perfNumberFormat.mCustomFormat=format.substr(0);perfNumberFormat.mFormatType=$NC.Scientific;}hSetNumberFormat.call(this,iDatasetPtr,perfNumberFormat,iLocale);},Draw:function Draw(){var formatFont=this.mFormatFontPtr,color=this.mColor;if(color>=0){var backupColor=color;if(formatFont){backupColor=formatFont.mFontColor;formatFont.mFontColor=color;}this._super();if(formatFont){formatFont.mFontColor=backupColor;}}else{this._super();}},replaceQuestionMarkWithHash:function replaceQuestionMarkWithHash(iorNumberFormat){var lDotCount,lSize,i,lStr="";if(iorNumberFormat.length===0){return false;}lSize=iorNumberFormat.length;lDotCount=0;for(i=0;i<lSize;i++){if(lStr.indexOf(iorNumberFormat[i])===-1){lStr+=iorNumberFormat[i];}if(iorNumberFormat[i]==="."){lDotCount++;}}if(lStr===".?"||lStr==="?."){if(lDotCount===1){iorNumberFormat.replace("?","#");return true;}}return false;},AddTextBeforeNumber:function AddTextBeforeNumber(irString){var rect,lString;rect=new $C.Rect2D();this.SetRect(rect);lString=irString+"\n"+this.mText;this.SetText(lString);this.mIsFinal=true;},getBaseForCustomFormatting:function getBaseForCustomFormatting(formatString){var baseTag="",suffix="",oneThousand=1000,quoted='"',index=formatString.lastIndexOf(quoted);if(index!==-1&&index===formatString.length-1){index=formatString.lastIndexOf(quoted,index-1);if(index!==-1){if(index!==0&&!(index===1&&formatString.charAt(0)==="-")){if(formatString.lastIndexOf("(",index-1)===-1){var l=formatString.substr(index,formatString.length);suffix=l.replace(/"""/gi,"");formatString=formatString.substr(0,index);}}}}index=formatString.length-1;var base=1,lBaseTag=formatString.charAt(index),isBaseFromTag=true;switch(lBaseTag){case"K":case"k":base*=oneThousand;baseTag=lBaseTag;index-=1;break;case"M":case"m":base*=oneThousand*oneThousand;baseTag=lBaseTag;index-=1;break;case"B":case"b":base*=oneThousand*oneThousand*oneThousand;baseTag=lBaseTag;index-=1;break;default:isBaseFromTag=false;break;}formatString=formatString.substr(0,index+1);if(isBaseFromTag){index=formatString.length-1;if(formatString.charAt(index)===","){formatString=formatString.substr(0,index);}return{BASE:base,STRING:formatString,TAG:baseTag,SUFFIX:suffix};}var lThousandSeparator=",";while(index>0){if(formatString.charAt(index)!==lThousandSeparator){break;}index--;base*=oneThousand;}formatString=formatString.substr(0,index+1);return{BASE:base,STRING:formatString,TAG:baseTag,SUFFIX:suffix};},AdjustFormatStringWithDot:function AdjustFormatStringWithDot(formatString,iDotIndex){var dot=".",thousandSeperator=",",markerCount=0,thousandSepCount=0,base=1,pattern="",replaced=".",index=iDotIndex-1;while(index>=0){if(formatString[index]===thousandSeperator){thousandSepCount++;base*=1000;}else{break;}index--;pattern+=thousandSeperator;}pattern+=dot;if(!(markerCount===0&&thousandSepCount===0)){var preIndex=0,patternIndex=formatString.indexOf(pattern),copy="";while(patternIndex!==-1){copy=copy.concat(formatString.substr(preIndex,patternIndex-preIndex));preIndex=patternIndex+pattern.length;copy=copy.concat(replaced);patternIndex=formatString.indexOf(pattern,preIndex);}copy+=formatString.substr(preIndex,formatString.length);formatString=copy;}var i,tempString,lastCommaIndex,lastDotIndex=formatString.lastIndexOf(dot);while(lastDotIndex!==-1){lastCommaIndex=formatString.lastIndexOf(thousandSeperator,lastDotIndex);if((lastCommaIndex!==-1)&&(lastCommaIndex<lastDotIndex)&&(lastDotIndex-lastCommaIndex>1)&&(lastDotIndex-lastCommaIndex<4)){tempString="";tempString=tempString.concat(formatString.substr(0,lastCommaIndex+1));for(i=0;i<4-(lastDotIndex-lastCommaIndex);i++){tempString=tempString.concat(formatString[lastCommaIndex+1]);}tempString=tempString.concat(formatString.substr(lastCommaIndex+1));formatString=tempString;}lastDotIndex=formatString.lastIndexOf(dot,lastDotIndex-1);}return{BASE:base,STRING:formatString};},SetNumberFormatForTimeSeries:function SetNumberFormatForTimeSeries(irNumberFormat){var chartCtx=this.mChartContextPtr,number=this.mNumber,text,dotIndex,isGM=chartCtx.mIsGraphMatrix;if(irNumberFormat.mFormatType===0&&!isGM){var a;if(this.mNumber>0){a=chartCtx.getInt(number);text="$"+a.ToString();}else{number=-number;a=chartCtx.getInt(number);text="($"+a.ToString()+")";}hSetText.call(this,text);return ;}this.mIsAbbreviated=this.mIsAbbreviated||isGM;var objectId=this.mTripleId.mObjectId,isGMVALabel=isGM&&isValueAxisLabel.call(this,objectId),maxLength=isGMVALabel?kGraphMatrixMaxNumberLength:kMaxNumberLength;text=$Utility.abbreviateNumber(this.mNumber,maxLength);hSetText.call(this,text);},GetNumberFromText:function GetNumberFromText(){if(this.mText!==""){var number=parseFloat(this.mText);if($Utility.isValidNumber(number)){return number;}return null;}return null;}});}());