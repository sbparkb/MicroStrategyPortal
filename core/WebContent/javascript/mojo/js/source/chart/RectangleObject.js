(function(){mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphObject","EnumShapeType");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumGenericDirection","EnumRectExpandDirection");mstrmojo.requiresClsP("mstrmojo.chart","ShapeObject","FormatLine","Rect2D");var $C=mstrmojo.chart,$M=mstrmojo.chart.model,$MODEL_ENUMS=$M.enums,$SHP=$MODEL_ENUMS.EnumShapeType,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$FormatLine=$C.FormatLine,$CHART_ENUMS=mstrmojo.chart.enums,$LS=$CHART_ENUMS.EnumLineStyle,$GD=$CHART_ENUMS.EnumGenericDirection,$RED=$CHART_ENUMS.EnumRectExpandDirection,$MS=$C.model.enums.EnumDSSGraphMarkerShape;var sPerfRect=new $C.Rect2D();function hGetBorder(){var orBorder=[],rect=this.mRect;if(this.mBorderOpenType===$GD.NONE){orBorder.push(rect.GetTopLeft());orBorder.push(rect.GetTopRight());orBorder.push(rect.GetBottomRight());orBorder.push(rect.GetBottomLeft());orBorder.push(rect.GetTopLeft());}else{orBorder.push(rect.GetBottomLeft());orBorder.push(rect.GetTopLeft());orBorder.push(rect.GetTopRight());orBorder.push(rect.GetBottomRight());var shiftIndex=0;switch(this.mBorderOpenType){case $GD.BOTTOM:break;case $GD.LEFT:shiftIndex=1;break;case $GD.TOP:shiftIndex=2;break;case $GD.RIGHT:shiftIndex=3;break;default:break;}if(shiftIndex!==0){orBorder=$C.gModuleMain.ShiftPolygonBy(orBorder,shiftIndex);}}return orBorder;}function hCollectVertexWithOffset(rect,vertical){var point,polyLine=[];if(this.mChartContextPtr.mImageFormat===103){return polyLine;}if(vertical){point=rect.GetBottomLeft();if(point.x>1){point.x--;}polyLine.push(point);point=rect.GetTopLeft();if(point.x>1){point.x--;}if(point.y>1){point.y--;}polyLine.push(point);point=rect.GetTopRight();if(point.y>1){point.y--;}polyLine.push(point);polyLine.push(rect.GetBottomRight());}else{point=rect.GetTopLeft();if(point.x>0){point.x--;}if(point.y>0){point.y--;}polyLine.push(point);point=rect.GetTopRight();if(point.y>0){point.y--;}polyLine.push(point);polyLine.push(rect.GetBottomRight());point=rect.GetBottomLeft();if(point.x>0){point.x--;}polyLine.push(point);}return polyLine;}function hSetBorderStyle(irRect){var chartCtx=this.mChartContextPtr,lineStyle=this.mFormatLinePtr.mLineStyle,lTemp,startPoint,endPoint;if(lineStyle!==$LS.LS_SOLID){chartCtx.NewPath();lTemp=$FormatLine.getLinePattern(lineStyle);startPoint=new $C.Point2D({x:irRect.x+0.5,y:irRect.y+0.5});endPoint=new $C.Point2D({x:irRect.x+0.5+irRect.width,y:irRect.y+0.5});chartCtx.DrawDashedLine(startPoint,endPoint,lTemp);startPoint.ResetPoint(endPoint);endPoint.x=irRect.x+0.5+irRect.width;endPoint.y=irRect.y+0.5+irRect.height;chartCtx.DrawDashedLine(startPoint,endPoint,lTemp);startPoint.ResetPoint(endPoint);endPoint.x=irRect.x+0.5;endPoint.y=irRect.y+0.5+irRect.height;chartCtx.DrawDashedLine(startPoint,endPoint,lTemp);startPoint.ResetPoint(endPoint);endPoint.x=irRect.x+0.5;endPoint.y=irRect.y+0.5;chartCtx.DrawDashedLine(startPoint,endPoint,lTemp);}}function hAdjustRect(ioRect,iIsVertical){if(iIsVertical){if(ioRect.x>1){--ioRect.x;++ioRect.width;}if(ioRect.y>1){--ioRect.y;++ioRect.height;}}else{if(ioRect.x>0){--ioRect.x;++ioRect.width;}if(ioRect.y>0){--ioRect.y;++ioRect.height;}}}function hAdjustRectWithBorder(rect){var formatLine=this.mFormatLinePtr,borderWidth=formatLine.mLineThickness,drawBorder=true;if(borderWidth>=1){var offset=borderWidth/2;if(this.mShapeType===$SHP._BAR){switch(this.mBorderOpenType){case $GD.BOTTOM:if((rect.width>borderWidth)&&(rect.height>offset)){rect.Expand(-offset,$RED.REC_EXP_HORIZONTAL);rect.y+=offset;}else{drawBorder=false;}break;case $GD.LEFT:if((rect.height>borderWidth)&&(rect.width>offset)){rect.Expand(-offset,$RED.REC_EXP_VERTICAL);rect.wdith-=offset;}else{drawBorder=false;}break;case $GD.TOP:if((rect.width>borderWidth)&&(rect.height>offset)){rect.Expand(-offset,$RED.REC_EXP_HORIZONTAL);rect.y-=offset;}else{drawBorder=false;}break;case $GD.RIGHT:if((rect.height>borderWidth)&&(rect.width>offset)){rect.Expand(-offset,$RED.REC_EXP_VERTICAL);rect.wdith+=offset;}else{drawBorder=false;}break;default:if(rect.height>borderWidth&&rect.width>borderWidth){rect.Expand(-offset,$RED.REC_EXP_BOTH);}else{drawBorder=false;}break;}}else{if(rect.height>borderWidth&&rect.width>borderWidth){rect.Expand(-offset,$RED.REC_EXP_BOTH);}else{drawBorder=false;}}}return drawBorder;}function doDraw(){var chartCtx=this.mChartContextPtr,formatLine=this.mFormatLinePtr,isGM=chartCtx.mIsGraphMatrix,gmCtx=chartCtx.GetGraphMatrixContext(),isGraphMatrixTickerShape=(this.mShapeType===$SHP._TICKER)||(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeGMTick);if(this.mTripleId.mObjectId===$GO.DssGraphRiser&&chartCtx.mPartialRendering){if(this.fallOut(true)){return ;}}var needBorder=hAdjustRectWithBorder.call(this,this.mRect);chartCtx.DrawRectangle(this.mRect,false);this.ApplyFillFormat();sPerfRect.ResetRect(this.mRect);var borderWidth=formatLine.mLineThickness;this.SetLineWidth();if(isGM){if(isGraphMatrixTickerShape===false){var thisObjectId=this.mTripleId.mObjectId;if(thisObjectId===$GO.DssGraphRiser){if(chartCtx.IsBarChart()){needBorder=true;this.SetOutlineWidthEx(borderWidth);var isVertical=chartCtx.IsVertical(),polyLine=hCollectVertexWithOffset.call(this,sPerfRect,isVertical);if((polyLine.length===4)&&((isVertical&&this.mBorderOpenType!==$GD.BOTTOM)||(!isVertical&&this.mBorderOpenType!==$GD.LEFT))){polyLine[0].swapPoints(polyLine[1]);polyLine[2].swapPoints(polyLine[3]);chartCtx.DrawPolyLine(polyLine,true);}}else{if(chartCtx.IsGridChart()||chartCtx.IsLineChart()||chartCtx.IsBubbleChart()||chartCtx.IsScatterChart()){needBorder=true;chartCtx.DrawRectangle(sPerfRect,true);}}}}}else{if(chartCtx.NeedAdjustedLinePath()&&!isGM){if(this.mBorderOpenType!==$GD.NONE){var polygon;polygon=hGetBorder.call(this);chartCtx.DrawPolyLine(polygon,true);}else{chartCtx.DrawRectangle(sPerfRect,true);}}else{chartCtx.DrawRectangle(this.mRect,true);}}if(needBorder){if(!isGM){hSetBorderStyle.call(this,this.mRect);}this.ApplyLineFormat();}else{this.hSetLineWidth(0);}chartCtx.FinishDrawRect(sPerfRect,this.mTripleId);}mstrmojo.chart.RectangleObject=mstrmojo.declare(mstrmojo.chart.ShapeObject,null,{scriptClass:"mstrmojo.chart.RectangleObject",mRect:null,mBorderOpenType:0,init:function init(props){if(props.hasFill===undefined){props.hasFill=true;}if(props.hasLine===undefined){props.hasLine=true;}this.mpParentObject=props.GraphCollectionObject||null;this.mTripleId=props.TripleId;this.mpManager=props.GraphObjectManager||null;this.mChartContextPtr=this.mpManager?this.mpManager.mChartContextPtr:null;this.mIsDetectable=true;if(props.Shape){this.mShapeType=props.Shape;}if(props.hasLine&&this.mTripleId.mObjectId!==-3){this.mFormatLinePtr=(this.mpParentObject===null||this.mpParentObject===undefined)?this.mChartContextPtr.GetFormatLine(this.mTripleId,0,this.mShapeType):this.mpParentObject.mFormatLinePtr;}this.mIsAnimationEnabled=false;if(props.hasFill&&this.mTripleId.mObjectId!==$GO.DssGraphErrorBar){this.mFormatFillPtr=(this.mpParentObject===null)?this.mChartContextPtr.GetFormatFill(this.mTripleId,0):this.mpParentObject.GetFormatFill();}if(props&&props.Area){this.mRect=new $C.Rect2D({Rect2D:props.Area});}this.mIsVirtual=props.IsVirtualMarker||false;},Draw:function Draw(){var chartCtx=this.mChartContextPtr;if(this.mIsVirtual){return ;}if(this.mIsAnimationEnabled){chartCtx.BeginFirstFrame();this.SetProgress(0);doDraw.call(this);chartCtx.EndFrame();chartCtx.BeginLastFrame();}doDraw.call(this);if(this.mIsAnimationEnabled){chartCtx.EndFrame();}},GetClockwisePolygon:function GetClockwisePolygon(){var r=this.mRect;return[r.GetTopLeft(),r.GetTopRight(),r.GetBottomRight(),r.GetBottomLeft()];},GetBoundingRect:function GetBoundingRect(intact){intact=intact||false;if(intact){return this.mRect;}return new $C.Rect2D({Rect2D:this.mRect});},getShapeSize:function getShapeSize(){return Math.round(Math.max(0.5*this.mRect.width,0.5*this.mRect.height)+0.5);}});}());