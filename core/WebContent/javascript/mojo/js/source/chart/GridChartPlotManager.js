(function(){mstrmojo.requiresClsP("mstrmojo.chart","Plot","CategoryAxis","PlotManager","GridChartPlot");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumOrientation","EnumDSSGraphObjectManager");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphObject","EnumDSSGraphProperty","EnumDSSExtraGraphProperty");var $C=mstrmojo.chart,$CHART_ENUMS=$C.enums,$OR=$CHART_ENUMS.EnumOrientation,$GM=$CHART_ENUMS.EnumDSSGraphObjectManager,$M=$C.model,$MODEL_ENUMS=$M.enums,$GP=$MODEL_ENUMS.EnumDSSGraphProperty;var perfTempRect1=new $C.Rect2D(),perfTempRect2=new $C.Rect2D();mstrmojo.chart.PlotOption=mstrmojo.provide("mstrmojo.chart.PlotOption",{});function hCreatePlot(index){var plot,tripleId;if(this.mChartContextPtr.mIsGraphMatrix){tripleId=$C.PlotId0;}else{tripleId=new $C.TripleId();tripleId.mObjectId=$GM.DssPlot;tripleId.mSeriesId=index;}plot=new $C.GridChartPlot({TripleId:tripleId,GraphObjectManager:this,Area:$C.gEmptyRect});plot.SetDataset(this.mDatasetPtr);return plot;}function hAssignChartAreas(dataArea,chartAreas){var numberOfChartAreas=this.mChartAreaOptions.chartAreaNumber,reusedSet=this.mIsReuseYAxis?this.mYAxisSet:this.mXAxisSet,i;reusedSet[0].SetDeviceDataArea(dataArea);for(i=0;i<numberOfChartAreas;++i){this.mPlots[i].AssignDataArea(chartAreas[i],!this.mIsReuseYAxis);}}function hReserveAxisArea(rect,isForReusedAxis){if(isForReusedAxis){var currentRect=new $C.Rect2D({Rect2D:rect}),reusedSet=this.mIsReuseYAxis?this.mYAxisSet:this.mXAxisSet;reusedSet[0].AdjustTitleArea(currentRect);reusedSet[0].AdjustDataArea(currentRect,0,0,true);return currentRect;}var independentSet=!(this.mIsReuseYAxis)?this.mYAxisSet:this.mXAxisSet,numberOfChartAreas=independentSet.length,areas=[],rectangles,i;this.CalculateChartAreas(rect,areas);for(i=0;i<numberOfChartAreas;++i){independentSet[i].AdjustTitleArea(areas[i]);independentSet[i].AdjustDataArea(areas[i],0,0,true);}rectangles=areas;var numberOfRects=rectangles.length;perfTempRect1.Reset(0,0,0,0);perfTempRect2.ResetRect(rectangles[0]);for(i=1;i<numberOfRects;++i){if(!this.RectangleIntersection(perfTempRect2,rectangles[i],perfTempRect1)){perfTempRect2.Reset(0,0,0,0);break;}perfTempRect2.ResetRect(perfTempRect1);}return perfTempRect2;}function hCreateAxisAtChartArea(index){var categoryAxisInfo=new $C.CategoryAxisInfo(),reusedSet,categoryAxis,independentSet,isSeriesByCol=this.mDatasetPtr.GetSeriesByColumn();if(this.mIsReuseYAxis){categoryAxisInfo.ToY(!isSeriesByCol);}else{categoryAxisInfo.ToX(isSeriesByCol);}reusedSet=this.mIsReuseYAxis?this.mYAxisSet:this.mXAxisSet;if(reusedSet.length===0){categoryAxis=new $C.CategoryAxis({TripleId:categoryAxisInfo.mId,GraphObjectManager:this,AxisLabelsLocation:categoryAxisInfo.mAxisLabelsLocation,AxisDirection:categoryAxisInfo.mAxisDirection});categoryAxis.SetDataset(this.mDatasetPtr);reusedSet.push(categoryAxis);}this.mPlots[index].AssignAxis(reusedSet[0],this.mIsReuseYAxis);if(this.mIsReuseYAxis){categoryAxisInfo.ToX(isSeriesByCol);}else{categoryAxisInfo.ToY(!isSeriesByCol);}categoryAxisInfo.mId.mSeriesId=index;independentSet=(!this.mIsReuseYAxis)?this.mYAxisSet:this.mXAxisSet;categoryAxis=new $C.CategoryAxis({TripleId:categoryAxisInfo.mId,GraphObjectManager:this,AxisLabelsLocation:categoryAxisInfo.mAxisLabelsLocation,AxisDirection:categoryAxisInfo.mAxisDirection});categoryAxis.SetDataset(this.mDatasetPtr);independentSet.push(categoryAxis);this.mPlots[index].AssignAxis(independentSet[index],!this.mIsReuseYAxis);}function hPopulatePlotOptions(){var gmCtx=this.mChartContextPtr.GetGraphMatrixContext();if(gmCtx){this.mPlotOption.mIsAutoFitMode=!gmCtx.mHasSizeBy;this.mPlotOption.mMaxDataVal=gmCtx.mMaxSizeVal;this.mPlotOption.mMinDataVal=gmCtx.mMinSizeVal;this.mPlotOption.mMarkerShape=gmCtx.mMarkerShape;}}mstrmojo.chart.GridChartPlotManager=mstrmojo.declare(mstrmojo.chart.PlotManager,null,{scriptClass:"mstrmojo.chart.GridChartPlotManager",mPlots:null,mXAxisSet:null,mYAxisSet:null,mIsReuseYAxis:false,mPlotOption:{},init:function init(props){this._super(props);this.mPlots=[];this.mXAxisSet=[];this.mYAxisSet=[];this.mPlotOption={mIsAutoFitMode:false,mMaxDataVal:100000,mMinDataVal:0,mMarkerShape:4};this.mIsReuseYAxis=false;},Draw:function Draw(){this._super();var y1AxisCount=this.mYAxisSet.length,o1AxisCount=this.mXAxisSet.length,numberOfPlots=this.mPlots.length,i;for(i=0;i<y1AxisCount;++i){this.mYAxisSet[i].Draw();}for(i=0;i<o1AxisCount;++i){this.mXAxisSet[i].Draw();}for(i=0;i<numberOfPlots;++i){this.mPlots[i].Draw();}},LoadProperties:function LoadProperties(){this._super();this.mIsReuseYAxis=(this.mChartAreaOptions.mOrientation===$OR.OR_HORIZONTAL);hPopulatePlotOptions.call(this);},GenerateMapAndList:function GenerateMapAndList(){var plotArea=this.mPlotArea,chartAreaOptions=this.mChartAreaOptions,graphObjectManagerList=this.mGraphObjectManagerList,chartCtx=this.mChartContextPtr,i,len;if(plotArea.width*plotArea.height===0){return ;}if(this.mDatasetPtr===null||this.mDatasetPtr===undefined){return ;}this.LoadProperties();var numberOfChartAreas=chartAreaOptions.chartAreaNumber;for(i=0;i<numberOfChartAreas;++i){var lPlotPtr=hCreatePlot.call(this,i);lPlotPtr.AssignSeries(chartAreaOptions.seriesDistribution[i]);lPlotPtr.mLegendPtr=this.mLegendPtr;this.mPlots.push(lPlotPtr);hCreateAxisAtChartArea.call(this,i);}len=this.mPlots.length;for(i=0;i<len;++i){graphObjectManagerList.push(this.mPlots[i]);}len=this.mXAxisSet.length;for(i=0;i<len;++i){graphObjectManagerList.push(this.mXAxisSet[i]);}len=this.mYAxisSet.length;for(i=0;i<len;++i){graphObjectManagerList.push(this.mYAxisSet[i]);}var rect=hReserveAxisArea.call(this,plotArea,true),dataArea=hReserveAxisArea.call(this,rect,false);if(dataArea.width<0){dataArea.width=0;}if(dataArea.height<0){dataArea.height=0;}var y=plotArea.y+Math.max(rect.y-plotArea.y,dataArea.y-rect.y),height=plotArea.y+plotArea.height-Math.max(plotArea.y+plotArea.height-(rect.y+rect.height),rect.y+rect.height-(dataArea.y+dataArea.height))-y;dataArea.y=y;dataArea.height=height;if(chartCtx.mManualLayoutMode&&!this.mRecalculateFrame){dataArea=plotArea;}else{}var chartAreas=[];this.CalculateChartAreas(dataArea,chartAreas);if(chartCtx.isUADataAreaOutput()){var uaCtx=chartCtx.getUniformAxisContext();chartAreas[0].x=uaCtx.mDataAreaLeftMargin;chartAreas[0].y=uaCtx.mDataAreaTopMargin;chartAreas[0].width=chartCtx.mGraphWidth-chartAreas[0].x-uaCtx.mDataAreaRightMargin;chartAreas[0].height=chartCtx.mGraphHeight-chartAreas[0].y-uaCtx.mDataAreaBottomMargin;this.mXAxisSet[0].TrimAxisPadding(chartAreas[0],false);this.mYAxisSet[0].TrimAxisPadding(chartAreas[0],false);dataArea=chartAreas[0];}hAssignChartAreas.call(this,dataArea,chartAreas);len=this.mPlots.length;for(i=0;i<len;++i){this.mPlots[i].GenerateMapAndList();}len=this.mXAxisSet.length;for(i=0;i<len;++i){this.mXAxisSet[i].GenerateMapAndList();}len=this.mYAxisSet.length;for(i=0;i<len;++i){this.mYAxisSet[i].GenerateMapAndList();}}});}());