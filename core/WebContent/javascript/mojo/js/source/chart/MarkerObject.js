(function(){mstrmojo.requiresCls("mstrmojo.hash");mstrmojo.requiresClsP("mstrmojo.chart","ShapeObject","ImageMap","FormatLine","Point2D");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumObjectShape","EnumMarkerShape","EnumLineStyle","EnumGraphMajorType");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphMarkerShape","EnumDSSGraphObject");var $C=mstrmojo.chart,$CHART_ENUMS=$C.enums,$OBJ_SHAPE_CIRCLE=$CHART_ENUMS.EnumObjectShape.OS_CIRCLE,$LOCAL_MARKER_SHAPE=$CHART_ENUMS.EnumMarkerShape,$LSL=$CHART_ENUMS.EnumLineStyle,$GMT=$CHART_ENUMS.EnumGraphMajorType,$HASH=mstrmojo.hash,SVG=103,$M=$C.model,$MODEL_ENUMS=$M.enums,$MS=$MODEL_ENUMS.EnumDSSGraphMarkerShape,$GO=$MODEL_ENUMS.EnumDSSGraphObject,kPolygonApproximationAngle=10,kDefaultMarkerSize=31,kLocalMarkerSize=100,kMarkerShapes=[[4,-100,-100,100,-100,100,100,-100,100],[12,-80,-100,0,-20,80,-100,100,-80,20,0,100,80,80,100,0,20,-80,100,-100,80,-20,0,-100,-80],[12,-33,-100,33,-100,33,-33,100,-33,100,33,33,33,33,100,-33,100,-33,33,-100,33,-100,-33,-33,-33],[12,-50,-100,50,-100,50,-50,100,-50,100,50,50,50,50,100,-50,100,-50,50,-100,50,-100,-50,-50,-50],[0],[4,0,-100,100,0,0,100,-100,0],[3,0,-100,100,100,-100,100],[4,-100,-100,100,-100,100,100,-100,100],[10,0,-100,23,-31,95,-31,36,12,59,81,0,38,-59,81,-36,12,-95,-31,-23,-31],[7,0,-60,100,-100,100,100,-100,100,-100,-100,0,-60,0,100],[8,-100,-100,0,-50,100,-100,50,0,100,100,0,50,-100,100,-50,0]];$C.gMarkerShapeMap=[$MS.DssGraphMarkerShapeRectangle,$MS.DssGraphMarkerShapePlainX,$MS.DssGraphMarkerShapePlus,$MS.DssGraphMarkerShapeFatPlus,$MS.DssGraphMarkerShapeCircle,$MS.DssGraphMarkerShapeDiamond,$MS.DssGraphMarkerShapeTriangle1,$MS.DssGraphMarkerShapeSquare,$MS.DssGraphMarkerShapeStar5,$MS.DssGraphMarkerShapeHouse,$MS.DssGraphMarkerShapeStar45];$C.gMarkerShapeDict=[];function hConvertToLocalMarkerShape(graphMarkerShape){var cnt=kMarkerShapes.length,map=$C.gMarkerShapeMap,dict=$C.gMarkerShapeDict,useLegacy=false,i;if(dict.length===0){for(i=0;i<map.length;i++){dict[map[i]]=i;}}if(useLegacy){for(i=0;i<cnt;++i){if(map[i]===graphMarkerShape){return i;}}}else{return dict[graphMarkerShape]||0;}return 0;}function hGetClockwisePolygon(){var poly=this.mPolygon=[],myShape=this.mMarkerShape,markerSize=this.mMarkerSize,markerPosition=this.mMarkerPosition;var gngle,angleRadian,i,useApproximationForCirclePolygon=false,x,y;if(myShape===$LOCAL_MARKER_SHAPE.MS_Circle){if(useApproximationForCirclePolygon){for(gngle=0;gngle<360;gngle+=kPolygonApproximationAngle){angleRadian=$C.gModuleMain.DegreeToRadian(gngle);poly.push(new $C.Point2D({x:markerPosition.x+markerSize*Math.cos(angleRadian),y:markerPosition.y+markerSize*Math.sin(angleRadian)}));}}else{poly.push(new $C.Point2D({x:markerPosition.x-markerSize,y:markerPosition.y-markerSize}));poly.push(new $C.Point2D({x:markerPosition.x+markerSize,y:markerPosition.y-markerSize}));poly.push(new $C.Point2D({x:markerPosition.x+markerSize,y:markerPosition.y+markerSize}));poly.push(new $C.Point2D({x:markerPosition.x-markerSize,y:markerPosition.y+markerSize}));}return ;}var points=kMarkerShapes[myShape];var numberOfPoints=points[0];if(this.mIsIsometric){for(i=0;i<numberOfPoints;++i){x=points[2*i+1]*markerSize/kLocalMarkerSize+markerPosition.x;y=points[2*i+2]*markerSize/kLocalMarkerSize+markerPosition.y;poly.push(new $C.Point2D({x:x,y:y}));}}else{var point;for(i=0;i<numberOfPoints;++i){x=points[2*i+1]*markerSize/kLocalMarkerSize+markerPosition.x;y=points[2*i+2]*markerSize/kLocalMarkerSize+markerPosition.y;point={x:x,y:y};point=this.mChartContextPtr.vdPoint(point);poly.push(point);}}}function hShrinkMarkerSizeWithBorder(markerSize){var result={drawBorder:true,shapeSize:markerSize},formatLine=this.mFormatLinePtr;if(formatLine&&markerSize>=formatLine.mLineThickness+1&&formatLine.mLineStyle!==$LSL.LS_NONE){result.shapeSize=markerSize-formatLine.mLineThickness;}else{result.drawBorder=false;}return result;}mstrmojo.chart.MarkerObject=mstrmojo.declare(mstrmojo.chart.ShapeObject,null,{scriptClass:"mstrmojo.chart.MarkerObject",mMarkerSize:0,mMarkerShape:$MS.DssGraphMarkerShapeNone,mMarkerPosition:null,mIsIsometric:true,mPolygon:null,mIsShown:true,init:function init(props){props.hasLine=props.MarkerSize>=2;this._super(props);var chartCtx=this.mChartContextPtr;this.mMarkerPosition=new $C.Point2D({Point2D:props.MarkerPosition});this.mMarkerShape=hConvertToLocalMarkerShape.call(this,props.MarkerShape);this.mIsIsometric=props.IsIsometric;this.mMarkerSize=props.MarkerSize;this.mIsShown=true;if(props.IsDialogSize){this.mMarkerSize=chartCtx.dialogSizeToPixelSize(props.MarkerSize);}},fallOut:function fallOut(entirely){var chartCtx=this.mChartContextPtr,w=chartCtx.mGraphWidth,h=chartCtx.mGraphHeight,center=this.mMarkerPosition,x=center.x,y=center.y,offset=this.mMarkerSize;if(entirely){return x+offset<0||x-offset>w||y+offset<0||y-offset>h;}else{return(x-offset>=0&&x+offset<=w)&&(y-offset>=0&&y+offset<=h);}},Draw:function Draw(){if(!this.mIsShown){return ;}var chartCtx=this.mChartContextPtr,graphMajorType=chartCtx.GetGraphMajorType();if(chartCtx.mPartialRendering){if(this.fallOut(true)){return ;}}if(this.mIsAnimationEnabled&&graphMajorType===$GMT.GMT_BUBBLE){chartCtx.BeginFirstFrame();this.SetProgress(0);this.DoDraw();chartCtx.EndFrame();chartCtx.BeginLastFrame();}this.DoDraw();if(this.mIsAnimationEnabled&&graphMajorType===$GMT.GMT_BUBBLE){this.mChartContextPtr.EndFrame();}},DoDraw:function DoDraw(){var chartCtx=this.mChartContextPtr;var returnVal,length,dist,i,markerSize,len,minAngle,angle,drawBorder,dashLength,tempVal;markerSize=this.mMarkerSize;returnVal=hShrinkMarkerSizeWithBorder.call(this,markerSize);this.mMarkerSize=returnVal.shapeSize;drawBorder=returnVal.drawBorder;if(drawBorder){this.SetLineWidth();}this.setMarkerPath(false);this.ApplyFillFormat();if(chartCtx.NeedAdjustedLinePath()){this.setMarkerPath(true);}if(drawBorder&&this.mFormatLinePtr.mLineStyle!==$LSL.LS_SOLID&&!chartCtx.mUseAnimation){if(this.mMarkerShape===$LOCAL_MARKER_SHAPE.MS_Circle){returnVal=$C.FormatLine.getLinePattern(this.mFormatLinePtr.mLineStyle);length=this.mMarkerSize*Math.abs(2*Math.PI);dist=0;i=0;len=returnVal.length;minAngle=Math.PI/5;angle=0;while(dist<length){dashLength=Math.min(returnVal[i%len],length-dist);tempVal=dashLength/this.mMarkerSize;++i;if(minAngle>tempVal){tempVal=minAngle;}dist+=tempVal*this.mMarkerSize;if(i%2===1){chartCtx.NewPath();chartCtx.drawArc(this.mMarkerPosition,this.mMarkerSize,angle,angle+tempVal,false);this.ApplyLineFormat();}angle+=tempVal;}}}if(drawBorder){this.ApplyLineFormat();}if(this.mMarkerShape===$MS.DssGraphMarkerShapeCircle){chartCtx.FinishDrawCircle({x:this.mMarkerPosition.x,y:this.mMarkerPosition.y,r:this.mMarkerSize},this.mTripleId);}else{chartCtx.FinishDrawPolygon(this.mPolygon,0,this.mTripleId);}this.mMarkerSize=markerSize;},setMarkerPath:function setMarkerPath(isLinePath){var chartCtx=this.mChartContextPtr,point,markerSize=this.mMarkerSize,markerShape=this.mMarkerShape;if(chartCtx.mImageFormat===SVG){return ;}if(this.mPolygon===null){hGetClockwisePolygon.call(this);}if(markerShape===$MS.DssGraphMarkerShapeCircle){chartCtx.drawArc(this.mMarkerPosition,markerSize,0,Math.PI*2);}else{chartCtx.DrawPolygon(this.mPolygon,isLinePath);}},GetBoundingRect:function GetBoundingRect(){if(this.mPolygon===null){hGetClockwisePolygon.call(this);}return this.GetBoundingRectFromPolygon(this.mPolygon);},GetClockwisePolygon:function GetClockwisePolygon(){if(this.mPolygon===null){hGetClockwisePolygon.call(this);}return $C.Polygon2D.clone(this.mPolygon);},SetMarkerShape:function SetMarkerShape(inputMarkerShape){var markerShape=hConvertToLocalMarkerShape.call(this,inputMarkerShape);if(this.mMarkerShape===markerShape){return ;}this.mMarkerShape=markerShape;hGetClockwisePolygon.call(this);},getRadialInfo:function getRadialInfo(){if(this.mMarkerShape===$MS.DssGraphMarkerShapeCircle){var info={r:this.mMarkerSize,cx:this.mMarkerPosition.x,cy:this.mMarkerPosition.y,fx:0,fy:0};info.fx=info.cx;info.fy=info.cy;return info;}return null;},getShapeSize:function getShapeSize(){return this.mMarkerSize;}});}());