(function(){mstrmojo.requiresClsP("mstrmojo.chart","TripleId","Rect2D","Point2D","RectangleObject","TextObject","NumberObject","GraphCollectionObject","GridDataLabelInfo","GridBasePlot","CategoryAxis","PiePlotRenderer","MarkerObject","ChartConstants");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumGraphMatrixElementSizeMode","EnumGraphMatrixMarkerTypeInChart","EnumAnchorPoint");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphMarkerShape","EnumDSSGraphObject","EnumShapeType");mstrmojo.requiresClsP("mstrmojo.chart.common","Utility","MapStructure");var $C=mstrmojo.chart,$K=$C.ChartConstants,$CHART_ENUMS=$C.enums,$AP=$CHART_ENUMS.EnumAnchorPoint,$CT=$CHART_ENUMS.EnumCollectionType,$GM_MarkerStyle=$CHART_ENUMS.EnumGraphMatrixMarkerTypeInChart,$GM_ESM=$CHART_ENUMS.EnumGraphMatrixElementSizeMode,$GMPPT=$CHART_ENUMS.EnumGraphMatrixPiePlotType,$M=mstrmojo.chart.model,$MODEL_ENUMS=$M.enums,$MS=$MODEL_ENUMS.EnumDSSGraphMarkerShape,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$SHP=$MODEL_ENUMS.EnumShapeType,$CHART_COMMON=$C.common,$Utility=$CHART_COMMON.Utility,$Utility_Id=$Utility.tripleId;var perfMarkerRect=new $C.Rect2D(),perfCenter=new $C.Point2D(),perfPoint=new $C.Point2D(),textNumberFormat=new $C.ChartAdvFormat(),perfPosition=new $C.Point2D();var GMCM_BYBOTH=0,GMCM_BYX=1,GMCM_BYY=2;var kDataLabelHide=1,kDataLabelShowValue=2,kDataLabelShowText=3;function compareOfDateLabelInfo(a,b){if(a.mYIndex===b.mYIndex){return a.mXIndex-b.mXIndex;}return a.mYIndex-b.mYIndex;}function hUpdateDatasetSliceWindow(){var xCategoryAxis=this.mXAxis,yCategoryAxis=this.mYAxis,dataset=this.mDatasetPtr;if(this.mPartialRendering){var chartCtx=this.mChartContextPtr,props={PartialRendering:true,Group:{},Series:{}},xMin,xMax,yMin,yMax,window=chartCtx.mRenderingWindow;xMin=window.x;xMax=xMin+window.width;yMin=window.y;yMax=yMin+window.height;if(xCategoryAxis){xMax=xCategoryAxis.getGroupSlotAt(xMax)+1;xMin=xCategoryAxis.getGroupSlotAt(xMin)-1;}if(yCategoryAxis){yMax=yCategoryAxis.getGroupSlotAt(yMax)+1;yMin=yCategoryAxis.getGroupSlotAt(yMin)-1;}if(this.mDatasetPtr.GetSeriesByColumn()){if(yCategoryAxis){props.Group.Max=yMax;props.Group.Min=yMin;}if(xCategoryAxis){props.Series.Max=xMax;props.Series.Min=xMin;}}else{if(yCategoryAxis){props.Series.Max=yMax;props.Series.Min=yMin;}if(xCategoryAxis){props.Group.Max=xMax;props.Group.Min=xMin;}}dataset.updateDataWindow(props);}else{dataset.resetDataWindow();}}function hGetAdjustAutoFitRect(isInit){if(!isInit){var gmCtx=this.mChartContextPtr.GetGraphMatrixContext(),elementsInfo=gmCtx.mElementsInfo;if(this.mMarkerShape===$MS.DssGraphMarkerShapeRectangle){var specified=elementsInfo.Max.Size,ratio=1;var autoFitMarkerRect=this.mAutoFitMarkerRect;this.mAdjustMarkerRect=new $C.Rect2D({Rect2D:autoFitMarkerRect});var adjustMarkerRect=this.mAdjustMarkerRect;if(elementsInfo.Max.Mode===$GM_ESM._MANUAL){ratio=Math.min(ratio,specified);if(ratio<1){adjustMarkerRect.width=autoFitMarkerRect.width*ratio;adjustMarkerRect.height=autoFitMarkerRect.height*ratio;}}}if(this.mMarkerShape===$MS.DssGraphMarkerShapeGMTick){var rect=new $C.Rect2D();rect.width=gmCtx.mConstants.FixedTickerSize;rect.height=gmCtx.GetMaxMarkerSize($GM_MarkerStyle._TICK_CATEGORY,false,this.mYArity);this.mAdjustMarkerRect=rect;}}return this.mAdjustMarkerRect;}function hGetArity(){var seriesCount=this.mSeriesSet.length,groupCount=this.mDatasetPtr.GetGroupCount(),dataset=this.mDatasetPtr;if(this.mIsSeriesByCol){this.mXArity=seriesCount;this.mYArity=groupCount;}else{this.mXArity=groupCount;this.mYArity=seriesCount;}if(this.mXArity===0&&!this.mHasXAxis){this.mXArity=1;}if(this.mXArity===0&&!dataset.mHasMetrics){this.mXArity=1;}if(this.mYArity===0&&!this.mHasYAxis){this.mYArity=1;}if(this.mYArity===0&&!dataset.mHasMetrics){this.mYArity=1;}}function doesAngleBreakX(){return this.mDatasetPtr.IsGridPieAngleBreakX();}function hGetMaxMarkerSizeInDevice(){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),elementInfo=gmCtx.mElementsInfo,numberOfAngels=0,markerShape=this.mMarkerShape,isPieShape=markerShape===$MS.DssGraphMarkerShape2DPie||markerShape===$MS.DssGraphMarkerShape2DRingPie,xDivide=1,yDivide=1,upperLimit=2500,ratio=1,size,xAxisSize,yAxisSize;if(markerShape!==$MS.DssGraphMarkerShapeRectangle){if(this.mHasXAxis){xAxisSize=this.mXAxis.getGroupSize();}else{xAxisSize=this.mDataArea.width;}if(this.mHasYAxis){yAxisSize=this.mYAxis.getGroupSize();}else{yAxisSize=this.mDataArea.height;}if(isPieShape){if(elementInfo.Max.Mode===$GM_ESM._AUTOMATIC){upperLimit=250;}numberOfAngels=this.mDatasetPtr.GetAngleNumber();var divideOnX=doesAngleBreakX.call(this);if(divideOnX){xDivide=numberOfAngels;}else{yDivide=numberOfAngels;}if(elementInfo.Max.Mode===$GM_ESM._AUTOMATIC){ratio=this.mDatasetPtr.showDatalabels()?0.5:0.9;if(ratio<0){ratio=0.1;}ratio=Math.min(ratio,1);}}if(elementInfo.Max.Mode===$GM_ESM._MANUAL){ratio=elementInfo.Max.Size;if(ratio<0){ratio=0.1;}ratio=Math.min(ratio,1);}size=0.5*Math.min(xAxisSize/xDivide,yAxisSize/yDivide);if(markerShape!==$MS.DssGraphMarkerShapeCircle||size>=4){size-=1;}size=Math.max(size,1);size*=ratio;size=Math.min(size,upperLimit);size=Math.max(size,1);return Math.floor(size);}return 1;}function hLoadProperties(){var dataset=this.mDatasetPtr,dataArea=this.mDataArea,xAxis=this.mXAxis,yAxis=this.mYAxis,autoFitMarkerRect=this.mAutoFitMarkerRect,chartCtx=this.mChartContextPtr,plotOptions=this.mpManager.mPlotOption;this.mIsAutoFitMode=plotOptions.mIsAutoFitMode;this.mMaxDataVal=plotOptions.mMaxDataVal;this.mMinDataVal=plotOptions.mMinDataVal;this.mUniformColorMode=dataset.GetSeriesByColumn()?GMCM_BYY:GMCM_BYX;if(this.mHasXAxis){autoFitMarkerRect.width=xAxis.getGroupSize();}else{autoFitMarkerRect.width=dataArea.width;}if(this.mHasYAxis){autoFitMarkerRect.height=yAxis.getGroupSize();}else{autoFitMarkerRect.height=dataArea.height;}this.mMarkerShape=plotOptions.mMarkerShape;if(this.mMarkerShape===$MS.DssGraphMarkerShapeNone){this.mMarkerShape=$MS.DssGraphMarkerShapeRectangle;}this.mIsSeriesByCol=dataset.GetSeriesByColumn();if(this.mHasXAxis){this.mPreXCoord=xAxis.getGroupStartPos(0);}else{this.mPreXCoord=dataArea.x;}if(this.mHasYAxis){this.mPreYCoord=yAxis.getGroupStartPos(0);}else{this.mPreYCoord=dataArea.y;}hGetArity.call(this);hGetAdjustAutoFitRect.call(this,false);this.mMinMarkerSize=1;this.mMaxMarkerSize=hGetMaxMarkerSizeInDevice.call(this);this.mDataGroup=dataset.GetDataGroup();}function hGetCollectionAsParentFor(x,y){if(this.mHasColorBy===false){return this.mMarkerCollectionSet[0]||null;}return null;}function hAddLegendMarkerToCollectionFor(x,y,collection){if(!collection){return ;}if(this.mLegendPtr===null||this.mLegendPtr===undefined){return ;}if(this.mChartContextPtr.mIsGraphMatrix){return ;}}function hGetRectHLPosition(isForX,isForHighEnd,index,center){var anchor=isForX?center.x:center.y,nextAnchor=0,middle;if(isForX){nextAnchor=isForHighEnd?this.mXAxis.getGroupMiddlePos(index+1):this.mXAxis.getGroupMiddlePos(index-1);middle=(nextAnchor+anchor)/2;}else{nextAnchor=isForHighEnd?this.mYAxis.getGroupMiddlePos(index+1):this.mYAxis.getGroupMiddlePos(index-1);middle=(nextAnchor+anchor)/2;}var offset=middle-Math.floor(middle);if(offset!==0){middle-=0.5;}if(middle===0){middle=1;}return middle;}function hGetMarkerRect(x,y){var paddingBetweenRect=1,halfBorderWidth=0,shape=$SHP._RECTANGLE,isTick=false,dataProvider=this.mDatasetPtr.dataProvider;perfCenter.x=this.mXAxis.getGroupMiddlePos(x);perfCenter.y=this.mYAxis.getGroupMiddlePos(y);perfMarkerRect.Reset(0,0,0,0);if(this.mMarkerShape===$MS.DssGraphMarkerShapeRectangle){if(this.mXArity*this.mYArity===1){perfMarkerRect=hGetAdjustAutoFitRect.call(this,true);}else{var low=0,high=0;if(!this.resizerLine){this.resizerLine=dataProvider.getResizerLineThickNess();}if(!this.chartInfo){this.chartInfo=dataProvider.getChartRowColCount();}if(x===0){low=this.mDataArea.x+paddingBetweenRect+halfBorderWidth;high=hGetRectHLPosition.call(this,true,true,x,perfCenter);}else{if(x===this.mXArity-1){low=hGetRectHLPosition.call(this,true,false,x,perfCenter);high=this.mDataArea.x+this.mDataArea.width;}else{low=hGetRectHLPosition.call(this,true,false,x,perfCenter);high=hGetRectHLPosition.call(this,true,true,x,perfCenter);}}if(x===this.mXArity-1){if(dataProvider.colIndex!==this.chartInfo.cir-1){high-=this.resizerLine.MATRIX_VLINE_THICKNESS;}else{high-=parseInt(this.resizerLine.MATRIX_VLINE_THICKNESS/2);}}perfMarkerRect.x=low;perfMarkerRect.width=high-low;perfMarkerRect.width=Math.max(0,perfMarkerRect.width);if(y===0){low=this.mDataArea.y+paddingBetweenRect;high=hGetRectHLPosition.call(this,false,true,y,perfCenter);}else{if(y===this.mYArity-1){low=hGetRectHLPosition.call(this,false,false,y,perfCenter);high=this.mDataArea.y+this.mDataArea.height;}else{low=hGetRectHLPosition.call(this,false,false,y,perfCenter);high=hGetRectHLPosition.call(this,false,true,y,perfCenter);}}if(dataProvider.rowIndex!==0&&y===0){low+=this.resizerLine.MATRIX_HLINE_THICKNESS;}if(dataProvider.rowIndex===this.chartInfo.cic-1&&y===this.mYArity-1){high-=this.resizerLine.AXIS_X_THICKNESS;}perfMarkerRect.y=low;perfMarkerRect.height=high-low;perfMarkerRect.height=Math.max(0,perfMarkerRect.height);if(perfMarkerRect.width>paddingBetweenRect){perfMarkerRect.width-=paddingBetweenRect+halfBorderWidth*2;}if(perfMarkerRect.height>paddingBetweenRect){perfMarkerRect.height-=paddingBetweenRect+halfBorderWidth;}}}else{isTick=true;shape=$SHP._TICKER;var tempRect=hGetAdjustAutoFitRect.call(this,true);perfPoint.x=perfPoint.y=0;if(this.mHasXAxis){perfPoint.x=this.mXAxis.getGroupMiddlePos(x);}else{perfPoint.x=this.mDataArea.GetCenter().x;}if(this.mHasYAxis){perfPoint.y=this.mYAxis.getGroupMiddlePos(y);}else{perfPoint.y=this.mDataArea.GetCenter().y;}perfMarkerRect.width=tempRect.width;perfMarkerRect.height=tempRect.height;perfMarkerRect.x=perfPoint.x-0.5*perfMarkerRect.width;perfMarkerRect.y=perfPoint.y-0.5*perfMarkerRect.height;}if(this.mMinDataVal===this.mMaxDataVal){return perfMarkerRect;}var gmCtx=this.mChartContextPtr.GetGraphMatrixContext(),maxSizeInfo=gmCtx.mElementsInfo.Max;if(this.mIsAutoFitMode){if(maxSizeInfo.Mode===$GM_ESM._AUTOMATIC){return perfMarkerRect;}if(maxSizeInfo.Mode===$GM_ESM._MANUAL&&maxSizeInfo.Size===1){return perfMarkerRect;}}var halfSpanX,halfSpanY;if(maxSizeInfo.Mode===$GM_ESM._MANUAL&&maxSizeInfo.Size!==1){var ratio=maxSizeInfo.Size;halfSpanX=Math.round((1-ratio)*0.5*perfMarkerRect.width);halfSpanY=Math.round((1-ratio)*0.5*perfMarkerRect.height);perfMarkerRect.x+=halfSpanX;perfMarkerRect.y+=halfSpanY;perfMarkerRect.width-=2*halfSpanX;perfMarkerRect.height-=2*halfSpanY;}if(this.mIsAutoFitMode){return perfMarkerRect;}var value=0;if(this.mIsSeriesByCol){value=this.mDatasetPtr.GetSizeByData(this.mSeriesSet[x],y);}else{value=this.mDatasetPtr.GetSizeByData(this.mSeriesSet[y],x);}halfSpanX=0.5*perfMarkerRect.width;halfSpanY=0.5*(perfMarkerRect.height-gmCtx.GetScaledSize(value,perfMarkerRect.height,shape)+0.5);if(isTick){perfMarkerRect.x+=halfSpanX-1;perfMarkerRect.y+=halfSpanY;perfMarkerRect.width=gmCtx.mConstants.FixedTickerSize;}else{halfSpanX=0.5*(perfMarkerRect.width-gmCtx.GetScaledSize(value,perfMarkerRect.width,shape)+0.5);perfMarkerRect.x+=halfSpanX;perfMarkerRect.y+=halfSpanY;perfMarkerRect.width-=2*halfSpanX;}perfMarkerRect.height-=2*halfSpanY;return perfMarkerRect;}function hGetGMPiePosition(xInput,yInput,xSubIndex,ySubIndex,xSectionCount,ySectionCount){var x=-1,y=-1,base,groupSize,subGroupSize,groupSection,point=new $C.Point2D({x:-1,y:-1});if(this.mHasXAxis){x=this.mXAxis.getSubGroupMiddlePos(xInput,xSubIndex,xSectionCount);}else{base=this.mDataArea.x;subGroupSize=this.mDataArea.width/xSectionCount;x=base+subGroupSize*xSubIndex+subGroupSize/2;}if(this.mHasYAxis){y=this.mYAxis.getSubGroupMiddlePos(yInput,ySubIndex,ySectionCount);}else{groupSection=this.mDatasetPtr.GetSeriesCount();base=this.mDataArea.y;groupSize=this.mDataArea.height/groupSection;subGroupSize=this.mDataArea.height/ySectionCount/groupSection;y=base+groupSize*yInput+subGroupSize*ySubIndex+subGroupSize/2;}if(x>=0&&y>=0){point.x=x;point.y=y;}return point;}function hGetPieCenter(seriesId,groupId,angleIndex){var key=[seriesId,groupId,angleIndex],point,xInput,yInput,xSubInput,ySubInput,xSectionCount=1,ySectionCount=1;if(this.mPieCentersPool===null){this.mPieCentersPool=new $CHART_COMMON.MapStructure();}var center=this.mPieCentersPool.find(key);if(center!==null&&center!==undefined){return center;}xInput=groupId;xSubInput=angleIndex;yInput=seriesId;ySubInput=angleIndex;var angleCount=this.mDatasetPtr.GetPieCountAtOneDataPoint(seriesId,groupId);if(doesAngleBreakX.call(this)){xSubInput=angleIndex;xSectionCount=angleCount;}else{ySubInput=angleIndex;ySectionCount=angleCount;}point=hGetGMPiePosition.call(this,xInput,yInput,xSubInput,ySubInput,xSectionCount,ySectionCount);this.mPieCentersPool.replace(key,point);return point;}function hGetPosition(x,y){var dataArea=this.mDataArea,xIndex=x,yIndex=y;if(this.mIsSeriesByCol){if(this.mHasXAxis){xIndex=this.mSeriesSet.length>x?this.mSeriesSet[x]:x;}yIndex=y;}else{xIndex=x;if(this.mHasYAxis){yIndex=this.mSeriesSet.length>y?this.mSeriesSet[y]:y;}}if(this.mHasXAxis){perfPosition.x=this.mXAxis.getGroupMiddlePos(xIndex);}else{perfPosition.x=dataArea.x+dataArea.width/2;}if(this.mHasYAxis){perfPosition.y=this.mYAxis.getGroupMiddlePos(yIndex);}else{perfPosition.y=dataArea.y+dataArea.height/2;}return perfPosition;}function hGetSize(x,y){var result,sizeByValue,shape=$SHP._SQUARE,gmCtx=this.mChartContextPtr.GetGraphMatrixContext(),gmShape=gmCtx.mMarkerShape;if(this.mIsAutoFitMode){result=this.mMaxMarkerSize;}else{if(this.mMinDataVal===this.mMaxDataVal){return this.mMaxMarkerSize;}if(gmShape===$MS.DssGraphMarkerShapeCircle){shape=$SHP._CIRCLE;}else{if(gmShape===$MS.DssGraphMarkerShape2DPie||gmShape===$MS.DssGraphMarkerShape2DRingPie){shape=$SHP._PIE;}}if(this.mIsSeriesByCol){sizeByValue=this.mDatasetPtr.GetSizeByData(this.mSeriesSet[x],y);}else{sizeByValue=this.mDatasetPtr.GetSizeByData(this.mSeriesSet[y],x);}result=gmCtx.GetScaledSize(sizeByValue,this.mMaxMarkerSize,shape);}return result;}function hGetMarkersForOneDataPoint(x,y){var chartCtx=this.mChartContextPtr,DssGraphRiser=$GO.DssGraphRiser,seriesIndex,tripleId,markerShape=this.mMarkerShape,isPieShape=(markerShape===$MS.DssGraphMarkerShape2DPie||markerShape===$MS.DssGraphMarkerShape2DRingPie),oneMarker=null,pieCount,i,center,onePieSliceList,graphObjectsInOneDataPoint=[],rect;seriesIndex=(this.mSeriesSet.length>x)?this.mSeriesSet[x]:x;tripleId=new $C.TripleId({ObjectId:DssGraphRiser,SeriesId:seriesIndex,GroupId:y});if(!this.mIsSeriesByCol){tripleId.mSeriesId=(this.mSeriesSet.length>y)?this.mSeriesSet[y]:y;tripleId.mGroupId=x;}if(this.mDatasetPtr&&this.mDatasetPtr.useSliceWindow){if(this.mDatasetPtr.IsInSlicedWindow(tripleId.mSeriesId,tripleId.mGroupId)===false){return graphObjectsInOneDataPoint;}}if(chartCtx.checkColorByAndSizeByValue(tripleId,this.mDatasetPtr,this.mHasColorBy&&!isPieShape,this.mHasSizeBy)===false){return graphObjectsInOneDataPoint;}var shape=$SHP._RECTANGLE,parentalCollection=hGetCollectionAsParentFor.call(this,x,y);hAddLegendMarkerToCollectionFor.call(this,x,y,parentalCollection);if(markerShape===$MS.DssGraphMarkerShapeRectangle||markerShape===$MS.DssGraphMarkerShapeGMTick){rect=hGetMarkerRect.call(this,x,y);if(markerShape===$MS.DssGraphMarkerShapeGMTick){shape=$SHP._TICKER;}if(rect.width<=0){rect.width=1;}if(rect.height<=0){rect.height=1;}if(markerShape===$MS.DssGraphMarkerShapeRectangle){oneMarker=new $C.RectangleObject({TripleId:tripleId,GraphObjectManager:this,Area:rect,GraphCollectionObject:parentalCollection,IsOnlyForToolTip:false,Shape:shape});}else{var points=chartCtx.transformRectToTicker(rect,false);if(points.length>=2){oneMarker=new $C.StraightLineObject({TripleId:tripleId,GraphObjectManager:this,StartPoint:points[0],EndPoint:points[1],GraphCollectionObject:null,Shape:shape});}else{return graphObjectsInOneDataPoint;}}}else{if(isPieShape){var layout=0;if(markerShape===$MS.DssGraphMarkerShape2DRingPie){layout=1;}if(this.mPieRenderer===null||this.mPieRenderer===undefined){this.mPieRenderer=new $C.PiePlotRenderer({GraphObjectManager:this,Dataset:this.mDatasetPtr,ChartContext:chartCtx,Layout:0,PlotType:$GMPPT.GMPPT_GRID,MaxRadius:this.mMaxMarkerSize,ShownDataLabels:this.shownDataLabels});}pieCount=this.mDatasetPtr.GetPieCountAtOneDataPoint(tripleId.mSeriesId,tripleId.mGroupId);for(i=0;i<pieCount;++i){center=hGetPieCenter.call(this,tripleId.mSeriesId,tripleId.mGroupId,i);onePieSliceList=this.mPieRenderer.drawSinglePie(tripleId.mSeriesId,tripleId.mGroupId,i,center,pieCount);graphObjectsInOneDataPoint=graphObjectsInOneDataPoint.concat(onePieSliceList);}}else{var point=hGetPosition.call(this,x,y),markerSize=hGetSize.call(this,x,y);if(markerSize<=0){return graphObjectsInOneDataPoint;}if(markerShape===$MS.DssGraphMarkerShapeSquare){rect=this.mChartContextPtr.transformToRect(point,markerSize,true,rect);oneMarker=new $C.RectangleObject({TripleId:tripleId,GraphObjectManager:this,GraphCollectionObject:null,Area:rect,Shape:shape});}else{shape=$SHP._CIRCLE;oneMarker=new $C.MarkerObject({TripleId:tripleId,MarkerPosition:point,MarkerShape:markerShape,IsIsometric:true,MarkerSize:markerSize,GraphObjectManager:this,GraphCollectionObject:parentalCollection,Shape:shape});}}}if(graphObjectsInOneDataPoint.length===0&&oneMarker){graphObjectsInOneDataPoint.push(oneMarker);}return graphObjectsInOneDataPoint;}function hValueToFormattedText(dataValue,text,seriesId,groupId,collection){var lId=new $C.TripleId($GO.DssGraphDataText,seriesId,groupId);textNumberFormat.restore();this.mDatasetPtr.getSizeByDataFormat(textNumberFormat,seriesId,groupId);var numberObject=new $C.NumberObject({TripleId:lId,GraphObjectManager:this,Number:dataValue,NumberFormat:textNumberFormat,GraphCollectionObject:collection,Locale:0,clientDrag:false,DataSet:null});if(numberObject){text=numberObject.mText;}return text;}function hCreateOneDataLabel(x,y){var finalStr="",seriesId=(this.mSeriesSet.length>x)?this.mSeriesSet[x]:x,groupId=y,gmCtx=this.mChartContextPtr.GetGraphMatrixContext(),dataset=this.mDatasetPtr,dataLabelStyle=dataset.dataLabelStyle;if(!this.mIsSeriesByCol){seriesId=(this.mSeriesSet.length>y)?this.mSeriesSet[y]:y;groupId=x;}if((dataLabelStyle===kDataLabelShowValue)&&gmCtx.mHasSizeBy){var sizeByValue;if(this.mIsSeriesByCol){sizeByValue=this.mDatasetPtr.GetSizeByData(this.mSeriesSet[x],y);}else{sizeByValue=this.mDatasetPtr.GetSizeByData(this.mSeriesSet[y],x);}if(!!sizeByValue===false){return null;}finalStr=hValueToFormattedText.call(this,sizeByValue,finalStr,seriesId,groupId,null);}var dataLabel=new $C.TextObject({TripleId:new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:seriesId,GroupId:groupId}),GraphObjectManager:this,OnMarker:true});dataLabel.SetText(finalStr);return dataLabel;}function hGetMarkerBoundingRect(x,y){if(this.mMarkerShape===$MS.DssGraphMarkerShapeRectangle||this.mMarkerShape===$MS.DssGraphMarkerShapeGMTick){return new $C.Rect2D({Rect2D:hGetMarkerRect.call(this,x,y)});}var point=hGetPosition.call(this,x,y),size=hGetSize.call(this,x,y),markerSize=Math.floor(size+0.5);return new $C.Rect2D({x:point.x-markerSize,y:point.y-markerSize,width:markerSize*2,height:markerSize*2});}function hInitDataLabels(){var i,j,xArity=this.mXArity,yArity=this.mYArity,rect;for(i=0;i<xArity;++i){for(j=0;j<yArity;++j){var seriesId=(this.mSeriesSet.length>i)?this.mSeriesSet[i]:i;var groupId=j;if(!this.mIsSeriesByCol){seriesId=(this.mSeriesSet.length>j)?this.mSeriesSet[j]:j;groupId=i;}if(this.mDatasetPtr.showSeriesDatalabel(seriesId)===false){continue;}var labelInfo=new $C.GridDataLabelInfo();labelInfo.mIsValid=true;labelInfo.mGroupId=groupId;labelInfo.mSeriesId=seriesId;labelInfo.mXIndex=i;labelInfo.mYIndex=j;labelInfo.mHostMarkerBound=hGetMarkerBoundingRect.call(this,i,j);labelInfo.mLabelPtr=hCreateOneDataLabel.call(this,i,j);if(labelInfo.mLabelPtr===null||labelInfo.mLabelPtr===undefined){labelInfo.mIsValid=false;continue;}else{}this.mDataLabels.push(labelInfo);}}}function hPopulateMarkerCollections(){var collectionTripleId,DssGraphRiser=286,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),oneCollection,shape,markerCollectionSet=this.mMarkerCollectionSet;markerCollectionSet.splice(0,markerCollectionSet.length);var collectionNumber;if(this.mHasColorBy){return ;}if(chartCtx.mIsGraphMatrix){shape=gmCtx.markerToShape(gmCtx.mMarkerShape);}if(shape!==$SHP._PIE){collectionTripleId=$Utility_Id.create(DssGraphRiser,0,0);oneCollection=new $C.GraphCollectionObject({TripleId:collectionTripleId,GraphObjectManager:this,CollectionType:$CT.CT_GENERAL_SHAPE,Shape:shape});markerCollectionSet.push(oneCollection);}else{}}function hPutDataLabel(index){var dataLabelsVec=this.mDataLabels,hostMarkerBound=dataLabelsVec[index].mHostMarkerBound,hostMarkerBoundCenter={x:hostMarkerBound.x+0.5*hostMarkerBound.width,y:hostMarkerBound.y+0.5*hostMarkerBound.height},xCoordinate=hostMarkerBoundCenter.x,yCoordinate=hostMarkerBoundCenter.y;xCoordinate+=hostMarkerBound.width%2;yCoordinate+=hostMarkerBound.height%2;dataLabelsVec[index].mLabelPtr.MoveTo(xCoordinate,yCoordinate,$AP.CENTER);}function hGetDataLabelIndexInVec(x,y){return y*this.mXArity+x;}function hAddPaddingBoundToDataLabel(textRect,dataLabelPadding){return new $C.Rect2D({x:textRect.x-dataLabelPadding,y:textRect.y-dataLabelPadding,width:textRect.width+2*dataLabelPadding,height:textRect.height+2*dataLabelPadding});}function hIsFitPaddingToBorder(textRect,dataLabelPadding){var chartArea=new $C.Rect2D({x:0,y:0,width:this.mChartContextPtr.mGraphWidth,height:this.mChartContextPtr.mGraphHeight});if(textRect.x<chartArea.x+dataLabelPadding||textRect.x+textRect.width+dataLabelPadding>=chartArea.x+chartArea.width){return false;}return !(textRect.y<chartArea.y+dataLabelPadding||textRect.y+textRect.height+dataLabelPadding>=chartArea.y+chartArea.height);}function hPlaceDataLabelWithoutOverlap(){var x,y,dataLabels=this.mDataLabels,numberOfDataLabels=dataLabels.length,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),dataLabelPadding=gmCtx.getPadding($K.kDataLabel),i,indexX,indexY,idx,map={};for(i=0;i<numberOfDataLabels;++i){idx=hGetDataLabelIndexInVec.call(this,dataLabels[i].mXIndex,dataLabels[i].mYIndex);map[idx]=i;}for(i=0;i<numberOfDataLabels;++i){var textRect,isFitPaddingToBorder,textRectWithPaddingBound,index,isOverlapped=false;hPutDataLabel.call(this,i);textRect=this.mDataLabels[i].mLabelPtr.GetBoundingRectNoRotation(true);textRectWithPaddingBound=hAddPaddingBoundToDataLabel.call(this,textRect,dataLabelPadding);isFitPaddingToBorder=hIsFitPaddingToBorder.call(this,textRect,dataLabelPadding);if(!isFitPaddingToBorder){continue;}x=dataLabels[i].mXIndex;y=dataLabels[i].mYIndex;for(indexX=x-1;indexX<=x+1;indexX++){if(indexX<0||indexX>=this.mXArity){continue;}for(indexY=y-1;indexY<=y+1;indexY++){if(indexY<0||indexY>=this.mYArity){continue;}if(indexX===x&&indexY===y){continue;}idx=hGetDataLabelIndexInVec.call(this,indexX,indexY);index=map[idx];if(index>=dataLabels.length){continue;}if(!!dataLabels[index]===false){continue;}if(dataLabels[index].mIsValid===false||!!dataLabels[index].mLabelPtr===false){continue;}isOverlapped=textRectWithPaddingBound.HasIntersection(dataLabels[index].mHostMarkerBound);if(isOverlapped){break;}if(dataLabels[index].mIsDisPlayed){var lAdjacentDataLabelRect=dataLabels[index].mLabelPtr.GetBoundingRectNoRotation(true);isOverlapped=isOverlapped||textRectWithPaddingBound.HasIntersection(lAdjacentDataLabelRect);}if(isOverlapped){break;}}if(isOverlapped){break;}}if(!isOverlapped){dataLabels[i].mIsDisPlayed=true;dataLabels[i].mLabelPtr.mIsShown=true;this.AddToMapAndList(this.mDataLabels[i].mLabelPtr);}else{dataLabels[i].mLabelPtr.mIsShown=false;}}}function hRenderDataLabels(){var chartFrame,chartCtx=this.mChartContextPtr;if(chartCtx.mIsGraphMatrix){var gmCtx=chartCtx.GetGraphMatrixContext();if(this.mDatasetPtr.showDatalabels()){var dataLabelManager=this.dataLabelManager;if(dataLabelManager===null||dataLabelManager===undefined){chartFrame=new $C.Rect2D({x:0,y:0,width:chartCtx.mGraphWidth,height:chartCtx.mGraphHeight});dataLabelManager=this.dataLabelManager=new $C.DataLabelManager({DataArea:chartFrame});dataLabelManager.ChartContext=chartCtx;}if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShape2DPie||gmCtx.mMarkerShape===$MS.DssGraphMarkerShape2DRingPie){var shownLabels=[];this.mPieRenderer.enableDataLabel(dataLabelManager,shownLabels);var i,labelList=this.mPieRenderer.dataLabels,numberOfLabels=labelList.length;for(i=0;i<numberOfLabels;++i){var dataLabel=labelList[i].Label;if(dataLabel.mIsShown){this.AddToMapAndList(dataLabel);}}}else{hInitDataLabels.call(this);this.mDataLabels.sort(compareOfDateLabelInfo);hPlaceDataLabelWithoutOverlap.call(this);}}}}mstrmojo.chart.GridChartPlot=mstrmojo.declare(mstrmojo.chart.GridBasePlot,null,{scriptClass:"mstrmojo.chart.GridChartPlot",mXArity:0,mYArity:0,mDataGroup:1,mIsSeriesByCol:false,mIsAutoFitMode:false,mDataLabelTextMode:0,mMaxDataVal:0,mMinDataVal:0,mMaxMarkerSize:0,mMinMarkerSize:0,mPreXCoord:0,mPreYCoord:0,mUniformColorMode:0,mSeriesSet:null,mMarkerCollectionSet:null,mAutoFitMarkerRect:null,mAdjustMarkerRect:null,mDataLabels:null,mPieRenderer:null,mPieCentersPool:null,init:function init(props){this._super(props);this.mSeriesSet=[];this.mMarkerCollectionSet=[];this.mDataLabels=[];this.mAutoFitMarkerRect=new $C.Rect2D();this.mAdjustMarkerRect=new $C.Rect2D();},AssignSeries:function AssignSeries(series){this.mSeriesSet=series.slice();},GetMaxElementRadius:function GetMaxElementRadius(){if(this.mMarkerShape===$MS.DssGraphMarkerShapeRectangle){return Math.min(this.mAdjustMarkerRect.width,this.mAdjustMarkerRect.height);}return this.mMaxMarkerSize;},GenerateMapAndList:function GenerateMapAndList(){var dataset=this.mDatasetPtr,dataArea=this.mDataArea,i,j,k,xArity,yArity;if(dataset===null||dataset===undefined){return ;}if((dataset.mHasMetrics)&&(this.mSeriesSet.length===0)){return ;}if(dataArea.width*dataArea.height===0){return ;}hUpdateDatasetSliceWindow.call(this);hLoadProperties.call(this);hPopulateMarkerCollections.call(this);xArity=this.mXArity;yArity=this.mYArity;for(i=0;i<xArity;++i){for(j=0;j<yArity;++j){var markerList=hGetMarkersForOneDataPoint.call(this,i,j),len=markerList.length;for(k=0;k<len;++k){this.AddToMapAndList(markerList[k]);}}}if(this.mChartContextPtr.mImageUsage===0){hRenderDataLabels.call(this);}dataset.resetDataWindow();}});}());