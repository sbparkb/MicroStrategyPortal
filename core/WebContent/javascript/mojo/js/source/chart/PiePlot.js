(function(){mstrmojo.requiresClsP("mstrmojo.chart","Plot","CategoryPlot","GraphCollectionObject","TripleId","Point2D","Rect2D","TextObject","PieSliceObject","PieSliceElementObject","StraightLineObject","PolyLineObject","FormatFill","ChartConstants");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumCollectionType","EnumLineJoinType","EnumAnchorPoint");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphType","EnumDSSGraphProperty","EnumDSSGraphDataTextPosition","EnumDSSGraphDataTextShowType","EnumDSSGraphObject","EnumDSSGraphFillBevelEffect","EnumDSSGraphFontRotation");var $C=mstrmojo.chart,$K=$C.ChartConstants,$CHART_ENUMS=$C.enums,$CT=$CHART_ENUMS.EnumCollectionType,$LJT=$CHART_ENUMS.EnumLineJoinType,$AP=$CHART_ENUMS.EnumAnchorPoint,$NULL_GROUP_ID=$C.gNullGroupId,$NULL_OBJECT_ID=$C.gNullObjectId,$NULL_SERIES=$C.gNullSeriesId,$NULL_ID=$C.gNullTripleId,$M=$C.model,$MODEL_ENUMS=$M.enums,$GT=$MODEL_ENUMS.EnumDSSGraphType,$GP=$MODEL_ENUMS.EnumDSSGraphProperty,$GDTP=$MODEL_ENUMS.EnumDSSGraphDataTextPosition,$DTST=$MODEL_ENUMS.EnumDSSGraphDataTextShowType,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$BE=$MODEL_ENUMS.EnumDSSGraphFillBevelEffect,$FR=$MODEL_ENUMS.EnumDSSGraphFontRotation,sTolerance=1e-10,kPieLayout_Pie=0,kPieLayout_Ring=1,kPieDataLabelsPosition_OnSlice=0,kPieDataLabelsPosition_OutsideSlice=1,kInitRadiusNoSmartRatio=0.34,kInitRadiusSmartHeightRatio=0.34,kInitRadiusSmartWidthRatio=0.34,kMinimumRadiusRatio=0.25,kMinimumRadiusRatioEx=0.4,kInitLabelOutSliceNoSmartRadiusRatio=1.1,kInitLabelOutSliceSmartRadiusRatio=1.2,kInitLabelOnSliceNoSmartRadiusRatio=0.5,kInitLabelOnSliceSmartRadiusRatio=0.7,kInitLabelOnSidesRadiusRatio=1.2,kWidthLimitRatio=0.5,kDepthRatio=2.2,kYDirectionRadiusRatio=0.2,kValueAndLabelNumber=2,kXDirectionBoundary=0.4,kLeaderLineHorizontalLength=4,kHalfSqrt2=0.70710678,kBigFontBound=0.85;mstrmojo.chart.TextHeightAndCount=mstrmojo.provide("mstrmojo.chart.TextHeightAndCount",{});mstrmojo.chart.TextLabelAndValue=mstrmojo.provide("mstrmojo.chart.TextLabelAndValue",{});mstrmojo.chart.PiePlot=mstrmojo.declare(mstrmojo.chart.Plot,null,{scriptClass:"mstrmojo.chart.PiePlot",mPieOption:null,mSeriesOptions:null,mGroupCount:0,mGroupTotals:null,mMaxGroupTotal:0,mPiesPerRowInChart:0,mNumberRows:0,mScale:0,mGroupRects:null,mPieRects:null,mPieCenters:null,mRadius:null,mInitRadius:0,mDepthInChart:0,mGroupLabels:null,mMaxGroupLabelsHeight:0,mGroupLabelY:null,mSlices:null,mLeftTexts:null,mRightTexts:null,mIsAllLabelsOnSlice:false,mMaxExplode:0,init:function init(props){this._super(props);this.mIsAllLabelsOnSlice=true;this.mMaxGroupLabelsHeight=0;this.mMaxExplode=0;this.mLeftTexts=[];this.mRightTexts=[];this.mSlices=[];this.mPieRects=[];this.mGroupLabels=[];this.mPieOption={};this.mSeriesOptions=[];this.mGroupRects=[];this.mPieRects=[];this.mPieCenters=[];this.mGroupLabelY=[];},Draw:function Draw(){var i,chartCtx=this.mChartContextPtr;var backupLineJoinType=chartCtx.GetLineJoin();chartCtx.SetLineJoin($LJT.LJT_ROUND);chartCtx.Scale(1,this.mScale);$C.GraphObjectManager.prototype.Draw.apply(this,[]);chartCtx.Scale(1,1/this.mScale);for(i=0;i<this.mPostTrendLineObjects.length;++i){this.mPostTrendLineObjects[i].Draw();}chartCtx.SetLineJoin(backupLineJoinType);},GenerateMapAndList:function GenerateMapAndList(){},GetSmartLabelRadius:function GetSmartLabelRadius(iGroupId){return 0.6*this.mInitRadius+0.6*this.mRadius[iGroupId];},SetGraphType:function SetGraphType(iType){var pieOption=this.mPieOption;switch(iType){case $GT.DssGraphTypePies:pieOption.mLayout=kPieLayout_Pie;pieOption.mPieSizeProportional=false;break;case $GT.DssGraphTypeRing_Pie:pieOption.mLayout=kPieLayout_Ring;pieOption.mPieSizeProportional=false;break;case $GT.DssGraphTypeMultiple_Pies:pieOption.mLayout=kPieLayout_Pie;pieOption.mPieSizeProportional=false;break;case $GT.DssGraphTypeMultiple_Ring_Pies:pieOption.mLayout=kPieLayout_Ring;pieOption.mPieSizeProportional=false;break;case $GT.DssGraphTypeMultiple_Proportional:pieOption.mLayout=kPieLayout_Pie;pieOption.mPieSizeProportional=true;break;case $GT.DssGraphTypeMultiple_Proportional_Ring_Pies:pieOption.mLayout=kPieLayout_Ring;pieOption.mPieSizeProportional=true;break;case $GT.DssGraphTypePie_Bar:pieOption.mLayout=kPieLayout_Pie;pieOption.mPieSizeProportional=false;break;case $GT.DssGraphTypeRing_Pie_Bar:pieOption.mLayout=kPieLayout_Ring;pieOption.mPieSizeProportional=false;break;}},GetMinMaxValue:function GetMinMaxValue(iValueAxis,iorMin,iorMax,iorAreInitialized){var i,j;for(i=0;i<this.mSeriesCount;++i){for(j=0;j<this.mGroupCount;++j){var lValue=this.mDatasetPtr.GetData(i,j);if(lValue!==null){if(!iorAreInitialized){iorAreInitialized=true;iorMin=lValue;iorMax=lValue;}else{if(lValue>iorMax){iorMax=lValue;}if(lValue<iorMin){iorMin=lValue;}}}}}return{Min:iorMin,Max:iorMax,AreInitialized:iorAreInitialized};},SetCategoryAxis:function SetCategoryAxis(iCategoryAxisPtr){this.mCategoryAxisPtr=iCategoryAxisPtr;},GreaterThan:function GreaterThan(irTextHeightAndCountA,irTextHeightAndCountB){if(irTextHeightAndCountA.mTextHeight>irTextHeightAndCountB.mTextHeight){return 1;}if(irTextHeightAndCountA.mLineCount>irTextHeightAndCountB.mLineCount){return 1;}return -1;},GetDataPoint:function GetDataPoint(iSeriesId,iGroupId,orDataPoint){if(iGroupId<0||iGroupId>=this.mSlices.length){return false;}if(iSeriesId<0||iSeriesId>this.mSlices[0].length){return false;}if(this.mSlices[0].length===1){if(this.mPieCenters.length!==this.mSlices.length){return false;}orDataPoint.x=this.mPieCenters[iGroupId].x;orDataPoint.y=this.mPieCenters[iGroupId].y*this.mScale;}else{var i,len=this.mSlices[0].length;for(i=0;i<len;++i){var lTripleId=this.mSlices[iGroupId][i].mTripleId;if(lTripleId.mSeriesId===iSeriesId){orDataPoint=this.mSlices[iGroupId][i].GetPointByRatio(kInitLabelOnSliceNoSmartRadiusRatio);}}}return true;}});}());