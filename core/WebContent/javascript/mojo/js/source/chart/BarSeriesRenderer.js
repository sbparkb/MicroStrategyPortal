(function(){mstrmojo.requiresClsP("mstrmojo.chart","CategoryPlot","MarkerObject","SeriesRenderer","Plot","ChartConstants");mstrmojo.requiresClsP("mstrmojo.chart.common","MapStructure","Utility");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumCollectionType","EnumMajorGraphType","EnumLayout","EnumOrientation","EnumValueAxis","EnumFillType","EnumGraphMatrixElementSizeMode","EnumGraphMatrixDataLabelPosition","EnumFontRotation","EnumAnchorPoint","EnumImageUsage","EnumGenericDirection");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphMarkerShape","EnumDSSGraphProperty","EnumDSSGraphObject");var $C=mstrmojo.chart,$K=$C.ChartConstants,$CHART_ENUMS=$C.enums,$CT=$CHART_ENUMS.EnumCollectionType,$LAYOUT=$CHART_ENUMS.EnumLayout,$OR=$CHART_ENUMS.EnumOrientation,$VA=$CHART_ENUMS.EnumValueAxis,$AP=$CHART_ENUMS.EnumAnchorPoint,$FT=$CHART_ENUMS.EnumFillType,$GD=$CHART_ENUMS.EnumGenericDirection,$IMG_USAGE=$CHART_ENUMS.EnumImageUsage,$GM_ESM=$CHART_ENUMS.EnumGraphMatrixElementSizeMode,$GMDLP=$CHART_ENUMS.EnumGraphMatrixDataLabelPosition,$FR=$CHART_ENUMS.EnumFontRotation,$M=mstrmojo.chart.model,$MODEL_ENUMS=$M.enums,$MS=$MODEL_ENUMS.EnumDSSGraphMarkerShape,$SHP=$MODEL_ENUMS.EnumShapeType,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$Utility=$C.common.Utility;var kBarRenderType_Absolute=0,kBarRenderType_Cluster=1,kBarRenderType_Stacked=2,kBarRenderType_Percent=3;var perfBarRectAdjust=new $C.Rect2D(),perfBarRectCalculated=new $C.Rect2D();function hGetNumberOfVA(){var seriesInfo=this.mSeriesInfo,valueAxisY1=0,valueAxisY2=0,i,len=seriesInfo.length;for(i=0;i<len;++i){if(seriesInfo[i].mValueAxis===$VA.VA_Y1){valueAxisY1=1;}if(seriesInfo[i].mValueAxis===$VA.VA_Y2){valueAxisY2=1;}}return valueAxisY1+valueAxisY2;}function hGetIndexInColumn(riserInfo){var index=0;switch(this.mBarRenderType){case kBarRenderType_Cluster:index=riserInfo.seriesInfoID;break;case kBarRenderType_Stacked:if(hGetNumberOfVA.call(this)>1&&!this.mpABLPlotContext.mABLOptions.mSplitDualAxes){index=this.mSeriesInfo[riserInfo.seriesInfoID].mValueAxis;}break;}return index;}function hGetBarRiserWidth(irRiserInfo){var gmCtx=this.mChartContextPtr.GetGraphMatrixContext(),dataset=this.mDatasetPtr,seriesInfo=this.mSeriesInfo,sizeByValue,width,result;if(gmCtx&&this.mHasSizeBy){sizeByValue=dataset.GetSizeByData(seriesInfo[irRiserInfo.seriesInfoID].mSeriesId,irRiserInfo.groupID);sizeByValue=sizeByValue||0;width=gmCtx.GetScaledSize(sizeByValue,this.mBarWidth,$SHP._BAR);width=Math.max(width,1);if(this.mBarRenderType===kBarRenderType_Stacked){result=width;if(result%2===0){result++;}return result;}return width;}return this.mBarWidth;}function hGetRiserStartPosAndSize(riserInfo,barWidth){var start,size,offset,categoryAxis,indexInColumns,groupPosition,startPos,tempSize,clusterDataGroup,realIndex,ablPlotCtx=this.mpABLPlotContext,useFloat=false;if(riserInfo.useFloat!==undefined){useFloat=riserInfo.useFloat;}barWidth=barWidth||this.mBarWidth;categoryAxis=ablPlotCtx.mCategoryAxisPtr;groupPosition=riserInfo.groupID;if(ablPlotCtx.takeGroupCenter){clusterDataGroup=this.mDatasetPtr.GetClusterDataGroup();startPos=categoryAxis.getFloatGroupMiddlePos(groupPosition);if(clusterDataGroup<=1){startPos=startPos-0.5*barWidth;}else{realIndex=riserInfo.seriesInfoID%clusterDataGroup;startPos-=0.5*clusterDataGroup*barWidth;startPos+=realIndex*barWidth;}}else{indexInColumns=hGetIndexInColumn.call(this,riserInfo);startPos=categoryAxis.getGroupStartPos(groupPosition)+this.mSpaceBetweenGroup/2+(barWidth+this.mSpaceBetweenRiser)*indexInColumns;}start=Math.floor(startPos+0.5);if(this.mChartContextPtr.mIsGraphMatrix){size=barWidth;if(this.mHasSizeBy){if(!this.mUseDepth){tempSize=hGetBarRiserWidth.call(this,riserInfo);offset=size-tempSize;startPos+=offset*0.5;start=Math.round(startPos);size=Math.round(tempSize);}}else{size=(useFloat?(startPos+barWidth):Math.round(startPos+barWidth))-start;}}else{size=(useFloat?(startPos+barWidth):Math.round(startPos+barWidth))-start;}if(size===0&&barWidth>=0.5){size=1;}return{Start:start,Size:size};}function hIsLegendMarkerAddedToCollection(seriesId){var isFound,groupCount;if(this.mBarOptions.mColorBySeries){if(seriesId<0||seriesId>=this.mSeriesInfo.length){return true;}}else{groupCount=this.mDatasetPtr.GetGroupCount();if(seriesId<0||seriesId>=groupCount){return true;}}isFound=(this.mAddedLegendMarkerSet[seriesId]!==undefined);if(!isFound){this.mAddedLegendMarkerSet[seriesId]=true;}return isFound;}function hSmartLabelForCluster(valueAixIndex,textForGroup){var i,currentRect,nextRect,sign,point,numberOfTextForGroup;numberOfTextForGroup=textForGroup.length;for(i=0;i<(numberOfTextForGroup-1);++i){currentRect=textForGroup[i].GetBoundingRect();nextRect=textForGroup[i+1].GetBoundingRect();sign=this.mpABLPlotContext.mValueAxis[valueAixIndex].IsReverseOrder()?1:-1;if(currentRect.HasIntersection(nextRect)){point=new $C.Point2D({x:Math.floor(nextRect.x+nextRect.height/2),y:currentRect.y});if(sign===1){point.y+=currentRect.height;}point.y+=Math.floor(sign*nextRect.height/2);textForGroup[i+1].MoveTo(point.x,point.y,$AP.CENTER);}}}function hCreateRiserLabel(riserInfo,refRect,collection){var textObj,maxPosition,minPosition,reverseSign,data,barRenderType=this.mBarRenderType,valueAxis;textObj=this.createRiserLabel(riserInfo.seriesInfoID,riserInfo.groupID,collection);if(textObj===null){return null;}if(barRenderType===kBarRenderType_Stacked||barRenderType===kBarRenderType_Percent){textObj.mOnMarker=true;}maxPosition=this.mIsVertical?refRect.GetTopMiddle():refRect.GetRightMiddle();minPosition=this.mIsVertical?refRect.GetBottomMiddle():refRect.GetLeftMiddle();reverseSign=false;data=this.GetData(riserInfo.seriesInfoID,riserInfo.groupID);if(data!==null&&data!==undefined){valueAxis=this.mpABLPlotContext.mValueAxis[this.mSeriesInfo[riserInfo.seriesInfoID].mValueAxis];reverseSign=(data<0)^valueAxis.IsReverseOrder();}if(reverseSign){maxPosition.swapPoints(minPosition);}this.MoveLabel(riserInfo.groupID,textObj,maxPosition,minPosition,riserInfo.seriesInfoID);return textObj;}function hGetSeriesByVA(seriesList,valueAxisIndex){var seriesInfo=this.mSeriesInfo,i,len=seriesInfo.length;for(i=0;i<len;++i){if(valueAxisIndex===$VA.VA_BOTH||seriesInfo[i].mValueAxis===valueAxisIndex){seriesList.push(i);}}}function hGetVAOrder(){var ablOptions=this.mpABLPlotContext.mABLOptions;var first=$VA.VA_Y1,second=$VA.VA_Y2;if(ablOptions.mUseDepth&&hGetNumberOfVA.call(this)>1&&ablOptions.mDualAxes&&!ablOptions.mSplitDualAxes){if((ablOptions.mOrientation===$OR.OR_VERTICAL&&ablOptions.mDepthDirection>=90&&ablOptions.mDepthDirection<270)||(ablOptions.mOrientation===$OR.OR_HORIZONTAL&&ablOptions.mDepthDirection>=0&&ablOptions.mDepthDirection<180)){first=$VA.VA_Y2;second=$VA.VA_Y1;}}return{First:first,Second:second};}function hAdjustSeriesOrderForNegativeValue(groupIndex,vecSeries){if(vecSeries.length===0){return vecSeries;}var seriesPos,vecSeriesOrder=[],data,seriesId;for(seriesPos in vecSeries){if(vecSeries.hasOwnProperty(seriesPos)){seriesId=vecSeries[seriesPos];data=this.mDatasetPtr.GetData(seriesId,groupIndex);if(data!==null&&data<0){vecSeriesOrder.unshift(seriesId);}else{vecSeriesOrder.push(seriesId);}}}return vecSeriesOrder;}function hCalSeriesOrderForOneGroup(groupIndex,seriesList,valueAxisIndex){var ablOptions=this.mpABLPlotContext.mABLOptions,depthDirection=ablOptions.mDepthDirection,orientation=ablOptions.mOrientation,barRenderType=this.mBarRenderType,reverseSeries=false;switch(this.mBarRenderType){case kBarRenderType_Absolute:reverseSeries=false;break;case kBarRenderType_Cluster:if(ablOptions.mUseDepth&&((orientation===$OR.OR_VERTICAL&&depthDirection>=90&&depthDirection<270)||(orientation===$OR.OR_HORIZONTAL&&depthDirection>0&&depthDirection<180))){reverseSeries=true;}break;case kBarRenderType_Stacked:case kBarRenderType_Percent:if((ablOptions.mUseDepth)&&((orientation===$OR.OR_VERTICAL&&depthDirection>=180&&depthDirection<360)||(orientation===$OR.OR_HORIZONTAL&&depthDirection>=90&&depthDirection<270))){reverseSeries=true;}break;}seriesList.splice(0,seriesList.length);hGetSeriesByVA.call(this,seriesList,valueAxisIndex);if(seriesList.length===0){return ;}if(barRenderType===kBarRenderType_Stacked||(barRenderType===kBarRenderType_Percent&&valueAxisIndex!==$VA.VA_BOTH)){seriesList=hAdjustSeriesOrderForNegativeValue.call(this,groupIndex,seriesList);var valueAxis=this.mpABLPlotContext.mValueAxis[valueAxisIndex];if(valueAxis.IsReverseOrder()){reverseSeries=!reverseSeries;}}if(reverseSeries&&seriesList.length>0){seriesList.reverse();}}function hCalBarWidth(){var ablPlotCtx=this.mpABLPlotContext,barOptions=this.mBarOptions;if(this.mBarColumns===-1){this.mBarColumns=1;switch(this.mBarRenderType){case kBarRenderType_Cluster:this.mBarColumns=this.mSeriesInfo.length;break;case kBarRenderType_Stacked:if(hGetNumberOfVA.call(this)>1&&!ablPlotCtx.mABLOptions.mSplitDualAxes){this.mBarColumns=2;}break;}var groupSize=this.mGroupSize,barInfo=this.evalBarStyleUnitWidth(groupSize,this.mBarColumns,barOptions.mGapWidth);this.mBarWidth=barInfo.unitWidth;this.mSpaceBetweenRiser=barInfo.riserGap;this.mSpaceBetweenGroup=barInfo.groupGap;}}function hGetRenderingType(){switch(this.mpABLPlotContext.mABLOptions.mLayout){case $LAYOUT.LO_ABSOLUTE:if(this.mChartContextPtr.GetGraphMatrixContext().isCombinationChart()){return kBarRenderType_Cluster;}return kBarRenderType_Absolute;case $LAYOUT.LO_CLUSTER:return kBarRenderType_Cluster;case $LAYOUT.LO_STACKED:return kBarRenderType_Stacked;case $LAYOUT.LO_PERCENT:return kBarRenderType_Percent;default:return kBarRenderType_Cluster;}}function hUpdateSpecificColor(tripleId,graphObj){var colorValue,newFill;colorValue=this.mDatasetPtr.GetColorByData(tripleId.mSeriesId,tripleId.mGroupId);if(colorValue){newFill=new $C.FormatFill();newFill.mFillType=$FT.FT_SIMPLE;newFill.mAlpha=255*0.7;newFill.mSimpleColor=colorValue;graphObj.SetFormatFill(newFill);}}function hPrepareErrorBar(){if(this.mChartContextPtr.mIsGraphMatrix){return ;}}function hPrepareSeriesLineInfoPoint(){}function hRenderOneItem(riserInfo,textForGroup,isOnlyForDataLabels){var data,returnVal,aboveBase,barRect,ablPlot=this.mpABLPlot,ablPlotCtx=this.mpABLPlotContext,valueIndex=this.mSeriesInfo[riserInfo.seriesInfoID].mValueAxis,valueAxis=ablPlotCtx.mValueAxis[valueIndex],backUpDrawFromZero=valueAxis.mOptions.mDrawFromZero,axisOriginValue=valueAxis.GetAxisOriginValue();valueAxis.mOptions.mDrawFromZero=(axisOriginValue===null||axisOriginValue===0);data=this.hPrepareData(riserInfo);if($Utility.isValidNumber(data)===false){return ;}returnVal=this.hPrepareRect(riserInfo,data);barRect=returnVal.Rect;aboveBase=returnVal.AboveBase;if(!this.hUpdateBarRect(riserInfo,barRect,aboveBase,data)){valueAxis.mOptions.mDrawFromZero=backUpDrawFromZero;return ;}if(barRect.width<=0||barRect.height<=0){valueAxis.mOptions.mDrawFromZero=backUpDrawFromZero;return ;}if(!isOnlyForDataLabels){var graphObject=this.hPrepareRectangleObject(riserInfo,barRect,aboveBase);if(graphObject){this.hPostProcessOneBar(riserInfo,graphObject);++ablPlot.DPCount;if(ablPlot.seriesDPCount[riserInfo.seriesInfoID]===undefined||ablPlot.seriesDPCount[riserInfo.seriesInfoID]===null){ablPlot.seriesDPCount[riserInfo.seriesInfoID]=1;}else{++(ablPlot.seriesDPCount[riserInfo.seriesInfoID]);}}}valueAxis.mOptions.mDrawFromZero=backUpDrawFromZero;}function hGetSeriesOrderByType(groupIndex,seriesList,valueAxisIndex){var returnVal,first,second,tempSeries=[];if((valueAxisIndex===$VA.VA_BOTH&&this.mBarRenderType===kBarRenderType_Stacked)||this.mBarRenderType===kBarRenderType_Percent){returnVal=hGetVAOrder.call(this);first=returnVal.First;second=returnVal.Second;hCalSeriesOrderForOneGroup.call(this,groupIndex,seriesList,first);hCalSeriesOrderForOneGroup.call(this,groupIndex,tempSeries,second);if(tempSeries.length>0){seriesList=seriesList.concat(tempSeries);}}else{hCalSeriesOrderForOneGroup.call(this,groupIndex,seriesList,valueAxisIndex);}return seriesList;}function filterSeriesInsideGroup(groupIndex,allSeriesCount){var ctx=this.mChartContextPtr,kMinimalSeriesCount=1500,start=-1,end=-1;if(this.mBarRenderType===kBarRenderType_Cluster&&!this.mDatasetPtr.ShouldTakeGroupCenter()){if(allSeriesCount>=kMinimalSeriesCount&&ctx.mPartialRendering){var min,max,barWidth=this.mBarWidth,window=ctx.mRenderingWindow,isVertical=ctx.IsVertical(),ablPlotCtx=this.mpABLPlotContext,categoryAxis=ablPlotCtx.mCategoryAxisPtr;if(isVertical){min=window.x;max=min+window.width;}else{min=window.y;max=min+window.height;}start=min-categoryAxis.getGroupStartPos(groupIndex)-this.mSpaceBetweenGroup/2;start=Math.round(start/(barWidth+this.mSpaceBetweenRiser))-1;start=Math.max(start,0);end=max-categoryAxis.getGroupStartPos(groupIndex)-this.mSpaceBetweenGroup/2;end=Math.round(end/(barWidth+this.mSpaceBetweenRiser))+1;end=Math.min(end,allSeriesCount-1);return[start,end];}}return[];}function hRenderItems(valueAxisIndex){var ablPlotCtx=this.mpABLPlotContext,isReverseDrawGroup=this.IsReverseGroupOrder(),groupCount,groupID,allSeries=[],textForGroup=[],seriesCount,i,textForY1Group=[],textForY2Group=[],riserInfo,seriesSpan,groupPos;groupCount=this.mDatasetPtr.GetGroupCount();for(groupPos=0;groupPos<groupCount;++groupPos){groupID=groupPos;if(isReverseDrawGroup){groupID=groupCount-1-groupID;}allSeries=hGetSeriesOrderByType.call(this,groupID,allSeries,valueAxisIndex);seriesCount=allSeries.length;seriesSpan=filterSeriesInsideGroup.call(this,groupID,seriesCount);for(i=0;i<seriesCount;++i){if(seriesSpan.length===2&&(i<seriesSpan[0]||i>seriesSpan[1])){continue;}riserInfo={groupID:groupID,seriesInfoID:allSeries[i]};hRenderOneItem.call(this,riserInfo,textForGroup);}if(this.mBarRenderType===kBarRenderType_Cluster){seriesCount=textForGroup.length;for(i=0;i<seriesCount;++i){if(ablPlotCtx.mSeriesOptions[textForGroup[i].first].mValueAxis===$VA.VA_Y1){textForY1Group.push(textForGroup[i].second);}else{textForY2Group.push(textForGroup[i].second);}}if(textForY1Group.length!==0){hSmartLabelForCluster.call(this,$VA.VA_Y1,textForY1Group);}if(textForY2Group.length!==0){hSmartLabelForCluster.call(this,$VA.VA_Y2,textForY2Group);}}textForGroup.splice(0,textForGroup.length);}}function hFindRiserCollectionOrInsert(riserInfo){var chartCtx=this.mChartContextPtr;if(chartCtx.mIsGraphMatrix&&this.mHasColorBy){return null;}if(this.mGroupCount<2){return null;}var collectionID,dataset=this.mDatasetPtr;collectionID=new $C.TripleId({ObjectId:$GO.DssGraphRiser});if(this.mBarOptions.mColorBySeries){collectionID.mSeriesId=this.mSeriesInfo[riserInfo.seriesInfoID].mSeriesId;}else{collectionID.mSeriesId=riserInfo.groupID;}var collection=this.GetGraphObject(collectionID);if(collection===undefined){if(chartCtx.mIsGraphMatrix){if(dataset.findCell(true,collectionID.mSeriesId,1)!==-1){collection=null;return collection;}}if(collection===undefined){collection=new $C.GraphCollectionObject({TripleId:collectionID,GraphObjectManager:this,CollectionType:(this.mIsVertical?$CT.CT_VERTICAL_BAR:$CT.CT_HORIZONTAL_BAR)});}this.AddToMap(collection);}return this.GetGraphObject(collectionID);}function hIsValueAxisUseCustomMinMax(valueAxisIndex){if(this.mChartContextPtr.mIsGraphMatrix){var valueAxis=this.mpABLPlotContext.mValueAxis[valueAxisIndex];if(valueAxis){return valueAxis.mOptions.mUseCustomMinMax;}return false;}return false;}function hIsFitPaddingToBorder(dataLabelRect,padding){if(dataLabelRect.x<padding||dataLabelRect.x+dataLabelRect.width+padding>this.mChartContextPtr.mGraphWidth){return false;}return(!(dataLabelRect.y<padding||dataLabelRect.y+dataLabelRect.height+padding>this.mChartContextPtr.mGraphHeight));}function hIsTwoRectFitPadding(dataLabelRect,Rect,padding){if(dataLabelRect.x+dataLabelRect.width+padding<=Rect.x||dataLabelRect.x>=Rect.x+Rect.width+padding){return true;}return(dataLabelRect.y+dataLabelRect.height+padding<=Rect.y||dataLabelRect.y>=Rect.y+Rect.height+padding);}function hPutOneDataLabelBase(hostRect,text,location,isRotated){var textRect,offsetX=0,offsetY=0,xCoordinate,yCoordinate,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),dataLabelPadding=5;if(chartCtx.mIsGraphMatrix){dataLabelPadding=gmCtx.getPadding($K.kDataLabel);}if(isRotated){text.GetFormatFont().mFontRotation=$FR.FR_90;}else{text.GetFormatFont().mFontRotation=$FR.FR_NORMAL;}textRect=text.GetBoundingRect();switch(location){case $GMDLP._BOTTOM:offsetX=0;offsetY=(hostRect.height+textRect.height)/2+dataLabelPadding;break;case $GMDLP._TOP:offsetX=0;offsetY=-1*((hostRect.height+textRect.height)/2+dataLabelPadding);break;case $GMDLP._LEFT:offsetX=-1*((hostRect.width+textRect.width)/2+dataLabelPadding);offsetY=0;break;case $GMDLP._RIGHT:offsetX=(hostRect.width+textRect.width)/2+dataLabelPadding;offsetY=0;break;case $GMDLP._CENTER:offsetX=0;offsetY=0;break;}xCoordinate=hostRect.GetCenter().x+hostRect.width%2+offsetX;yCoordinate=hostRect.GetCenter().y+hostRect.height%2+offsetY;text.MoveTo(xCoordinate,yCoordinate,$AP.CENTER);}function hPutOneDataLabel(barRect,text,value,axisOriginValue,isForJudgeRotate,isRotated){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),shouldRotateDataLabel,options=this.mpABLPlotContext.mABLOptions,layout=options.mLayout,orientation=options.mOrientation;if(isForJudgeRotate===null||isForJudgeRotate===undefined){isForJudgeRotate=false;}if(isRotated===null||isRotated===undefined){isRotated=false;}if(isForJudgeRotate){shouldRotateDataLabel=isRotated;}else{shouldRotateDataLabel=gmCtx.mIsNeedRotateDataLabel;}if(orientation===$OR.OR_VERTICAL){if(layout===$LAYOUT.LO_ABSOLUTE||layout===$LAYOUT.LO_CLUSTER){if(value-axisOriginValue<0){hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._BOTTOM,shouldRotateDataLabel);}else{hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._TOP,shouldRotateDataLabel);}}else{if(this.mSeriesInfo.length===1){if(value-axisOriginValue<0){hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._BOTTOM,shouldRotateDataLabel);}else{hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._TOP,shouldRotateDataLabel);}}else{hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._CENTER,shouldRotateDataLabel);}}}else{if(layout===$LAYOUT.LO_ABSOLUTE||layout===$LAYOUT.LO_CLUSTER){if(value-axisOriginValue<0){hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._LEFT,shouldRotateDataLabel);}else{hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._RIGHT,shouldRotateDataLabel);}}else{if(this.mSeriesInfo.length===1){if(value-axisOriginValue<0){hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._LEFT,shouldRotateDataLabel);}else{hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._RIGHT,shouldRotateDataLabel);}}else{hPutOneDataLabelBase.call(this,barRect,text,$GMDLP._CENTER,shouldRotateDataLabel);}}}}function hPrepareRiserLabel(tripleID,riserInfo,rectBar,oldRectBar,dataValue,axisOriginValue){var chartCtx=this.mChartContextPtr,dataset=this.mDatasetPtr,isGraphMatrix=chartCtx.mIsGraphMatrix,dataLabelInfo={},tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText}),key=-3,label,labelText;if(isGraphMatrix){var isDataLabelEnabled=dataset.showSeriesDatalabel(tripleID.mSeriesId);if(isDataLabelEnabled){dataLabelInfo.SeriesId=tripleID.mSeriesId;dataLabelInfo.GroupId=riserInfo.groupID;dataLabelInfo.SeriesInfo=riserInfo.seriesInfoID;dataLabelInfo.HostMarkerBound=oldRectBar;label=this.mSGMapLabel[key];if(label===null||label===undefined){this.mSGMapLabel[key]=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});}var isMetricsOnlyOnCategory=false;if(isMetricsOnlyOnCategory&&this.mBarRenderType===kBarRenderType_Cluster){labelText=this.CreateOneDataLabel(riserInfo.groupID,this.mSeriesInfo[riserInfo.seriesInfoID].mSeriesId,dataValue,this.mSGMapLabel[key]);}else{labelText=this.CreateOneDataLabel(this.mSeriesInfo[riserInfo.seriesInfoID].mSeriesId,riserInfo.groupID,dataValue,this.mSGMapLabel[key]);}if(labelText!==null&&labelText!==undefined){dataLabelInfo.Label=labelText;labelText.mIsShown=false;hPutOneDataLabel.call(this,oldRectBar,labelText,dataValue,axisOriginValue);this.mDataLabels.push(dataLabelInfo);this.AddToMapAndList(labelText);}}}}function hCreateOneDataLabelItem(riserInfo,barRects,dataLabelRects,isRotated,isOnlyForRect){var data,returnVal,aboveZero,axisOriginValue,rectBar,rectBarBeforeUpdateSize,isMetricsOnlyOnCategory,tripleId,collection,textObj,textRect,key,label;data=this.hPrepareData(riserInfo);if(data===null||data===undefined){return ;}returnVal=this.hPrepareRect(riserInfo,data);rectBar=new $C.Rect2D({Rect2D:returnVal.Rect});aboveZero=returnVal.AboveBase;axisOriginValue=returnVal.AxisOriginValue;if(rectBar.width<0||rectBar.height<0){return ;}rectBarBeforeUpdateSize=new $C.Rect2D();rectBarBeforeUpdateSize.x=rectBar.x;rectBarBeforeUpdateSize.y=rectBar.y;rectBarBeforeUpdateSize.width=rectBar.width;rectBarBeforeUpdateSize.height=rectBar.height;if(!this.hUpdateBarRect(riserInfo,rectBar,aboveZero,data)){return ;}barRects.push(rectBar);if(isOnlyForRect){isMetricsOnlyOnCategory=false;tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText});collection=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});if(isMetricsOnlyOnCategory&&this.mChartContextPtr.mIsGraphMatrix&&this.mBarRenderType===kBarRenderType_Cluster){textObj=this.CreateOneDataLabel(riserInfo.groupID,this.mSeriesInfo[riserInfo.seriesInfoID].mSeriesId,data,collection);}else{textObj=this.CreateOneDataLabel(this.mSeriesInfo[riserInfo.seriesInfoID].mSeriesId,riserInfo.groupID,data,collection);}if(textObj!==null&&textObj!==undefined){hPutOneDataLabel.call(this,rectBar,textObj,data,axisOriginValue,true,isRotated);textRect=textObj.GetBoundingRect();dataLabelRects.push(textRect);}}else{tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText});key=this.mSeriesInfo[riserInfo.seriesInfoID].mSeriesId;tripleId.mSeriesId=key;label=this.mSGMapLabel[key];if(label===null||label===undefined){this.mSGMapLabel[key]=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});}hPrepareRiserLabel.call(this,tripleId,riserInfo,rectBar,rectBarBeforeUpdateSize,data,axisOriginValue);}}function hCreateDataLabels(barRects,dataLabelRects,isRotated,isOnlyForRect){var isReversDrawGroup=this.IsReverseGroupOrder(),groupCount,categoryAxis=this.mpABLPlotContext.mCategoryAxisPtr,isOnlyMetricsOnCategory=false,groupPos,groupID,seriesList=[],seriesCount,i,seriesPos,riserInfo,numberOfSeries;barRects.splice(0,barRects.length);dataLabelRects.splice(0,dataLabelRects.length);if(this.mChartContextPtr.mIsGraphMatrix){groupCount=categoryAxis.mGroupCount;}else{groupCount=this.mDatasetPtr.GetGroupCount();}for(groupPos=0;groupPos<groupCount;++groupPos){groupID=groupPos;if(isReversDrawGroup){groupID=groupCount-1-groupID;}if(isOnlyMetricsOnCategory&&this.mChartContextPtr.mIsGraphMatrix&&this.mBarRenderType===kBarRenderType_Cluster){seriesCount=this.mDatasetPtr.GetGroupCount();for(i=0;i<seriesCount;++i){seriesList.push(i);}}else{seriesList=hGetSeriesOrderByType.call(this,groupID,seriesList,$VA.VA_BOTH);}numberOfSeries=seriesList.length;for(seriesPos=0;seriesPos<numberOfSeries;++seriesPos){riserInfo={};riserInfo.groupID=groupID;riserInfo.seriesInfoID=seriesList[seriesPos];hCreateOneDataLabelItem.call(this,riserInfo,barRects,dataLabelRects,isRotated,isOnlyForRect);}}}function hGetDataLabelNumber(isRotated){var barRects=[],dataLabelRects=[],existDataLabel=[],count=0,i,j,k,isFitPaddingToBorder,isFitPadding,isTwoRectFitPadding,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),dataLabelPadding=5;if(chartCtx.mIsGraphMatrix){dataLabelPadding=gmCtx.getPadding($K.kDataLabel);}hCreateDataLabels.call(this,barRects,dataLabelRects,isRotated,true);for(i=0;i<dataLabelRects.length;++i){isFitPaddingToBorder=hIsFitPaddingToBorder.call(this,dataLabelRects[i],dataLabelPadding);if(!isFitPaddingToBorder){continue;}isFitPadding=true;for(j=0;j<barRects.length;++j){if(i===j){continue;}isTwoRectFitPadding=hIsTwoRectFitPadding.call(this,dataLabelRects[i],barRects[j],dataLabelPadding);if(!isTwoRectFitPadding){isFitPadding=false;break;}}if(!isFitPadding){continue;}for(k=0;k<existDataLabel.length;++k){isTwoRectFitPadding=hIsTwoRectFitPadding.call(this,dataLabelRects[i],existDataLabel[k],dataLabelPadding);if(!isTwoRectFitPadding){isFitPadding=false;break;}}if(isFitPadding){++count;existDataLabel.push(dataLabelRects[i]);}}return count;}function hShouldRotateDataLabel(){var dataLabelNumberHorizontal,dataLabelNumberVertical;if(this.mSeriesInfo.length===0){return false;}this.mGroupSize=this.mpABLPlotContext.mCategoryAxisPtr.getGroupSize();hCalBarWidth.call(this);dataLabelNumberHorizontal=hGetDataLabelNumber.call(this,false);dataLabelNumberVertical=hGetDataLabelNumber.call(this,true);return(dataLabelNumberVertical>dataLabelNumberHorizontal);}function hIsDataLabelInDataArea(dataLabelRect){var chartCtx=this.mChartContextPtr,isGM=chartCtx.mIsGraphMatrix,uaCtx;if(isGM&&chartCtx.mIsUniformAxisMode){uaCtx=chartCtx.getUniformAxisContext();if(dataLabelRect.x<uaCtx.mDataAreaLeftMargin||dataLabelRect.x+dataLabelRect.width>chartCtx.mGraphWidth-uaCtx.mDataAreaRightMargin){return false;}if(dataLabelRect.y<uaCtx.mDataAreaTopMargin||dataLabelRect.y+dataLabelRect.height>chartCtx.mGraphHeight-uaCtx.mDataAreaBottomMargin){return false;}}return true;}function hRenderDataLabels(shownDataLabels){var i,j,k,l,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),dataLabelRect,location,dataLabels=this.mDataLabels,len,allowOverlap=chartCtx.allowOverlapBetweenDatalabels(),existingSize,isFitPaddingToBorder,isFitPadding,isTwoRectFitPadding,chartFrame=new $C.Rect2D({x:0,y:0,width:chartCtx.mGraphWidth,height:chartCtx.mGraphHeight}),dataLabelManager=this.mpABLPlot.dataLabelManager,dataLabelPadding=5;if(chartCtx.mIsGraphMatrix){dataLabelPadding=gmCtx.getPadding($K.kDataLabel);}if(dataLabelManager===null||dataLabelManager===undefined){dataLabelManager=this.mpABLPlot.dataLabelManager=new $C.DataLabelManager({DataArea:chartFrame});dataLabelManager.ChartContext=chartCtx;}len=dataLabels.length;for(i=0;i<len;++i){for(l=0;l<4;++l){if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeGMTick){location=l;hPutOneDataLabelBase.call(this,dataLabels[i].HostMarkerBound,dataLabels[i].Label,location,false);}else{if(l>0){break;}}dataLabelRect=dataLabels[i].Label.GetBoundingRect();isFitPaddingToBorder=allowOverlap||hIsFitPaddingToBorder.call(this,dataLabelRect,dataLabelPadding);if(!isFitPaddingToBorder){continue;}isFitPadding=true;for(j=0;j<len;++j){if(j===i){continue;}isTwoRectFitPadding=allowOverlap||hIsTwoRectFitPadding.call(this,dataLabelRect,dataLabels[j].HostMarkerBound,dataLabelPadding);if(!isTwoRectFitPadding){isFitPadding=false;break;}}if(!isFitPadding){continue;}existingSize=shownDataLabels.length;for(k=0;k<existingSize;++k){isTwoRectFitPadding=allowOverlap||hIsTwoRectFitPadding.call(this,dataLabelRect,shownDataLabels[k].GetBoundingRect(),dataLabelPadding);if(!isTwoRectFitPadding){isFitPadding=false;break;}}if(hIsValueAxisUseCustomMinMax.call(this,this.mSeriesInfo[dataLabels[i].SeriesInfo].mValueAxis)){if(!hIsDataLabelInDataArea.call(this,dataLabelRect)){isFitPadding=false;}}if(isFitPadding){if(!allowOverlap){dataLabelManager.UpdateMatrixDataLabel(dataLabelRect);}shownDataLabels.push(dataLabels[i].Label);dataLabels[i].IsDisplayed=true;dataLabels[i].Label.mIsShown=true;if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeGMTick){break;}}}}}mstrmojo.chart.BarSeriesRenderer=mstrmojo.declare(mstrmojo.chart.SeriesRenderer,null,{scriptClass:"mstrmojo.chart.BarSeriesRenderer",mSGMapLabel:[],mpSeriesLineInfo:null,mBarRenderType:kBarRenderType_Absolute,mBarWidth:0,mGroupSize:0,mSpaceBetweenRiser:0,mSpaceBetweenGroup:0,mBarColumns:-1,mBarOptions:null,mAddedLegendMarkerSet:null,mDataLabels:null,init:function init(props){this._super(props);this.mSGMapLabel=[];this.mAddedLegendMarkerSet=[];this.mDataLabels=[];this.mBarOptions={mOverlap:0,mGapWidth:40,mRiserShape:0,mShowErrorBar:false,mHasMiddleValue:false,mMiddleValueSize:50,mShowSeriesLines:false,mColorBySeries:true};this.LoadProperties();},SetDeviceDataArea:function SetDeviceDataArea(deviceDataArea){if(this.mChartContextPtr.mUseAnimation){if(this.mDeviceDataArea===null){this.mDeviceDataArea=new $C.Rect2D({Rect2D:deviceDataArea});}else{this.mDeviceDataArea.ResetRect(deviceDataArea);}}this.mBarRenderType=hGetRenderingType.call(this);},AddTextToMapAndList:function AddTextToMapAndList(graphObjectMap,graphObjectList){var i,j,mapSize,colSize,collection,tripleId;mapSize=this.mSGMapLabel.length;for(j=0;j<mapSize;++j){collection=this.mSGMapLabel[j];if(collection!==null&&collection!==undefined){colSize=collection.GetCollectionSize();for(i=0;i<colSize;++i){graphObjectList.push(collection.GetObjectByIndex(i));}tripleId=collection.mTripleId;graphObjectMap.push(tripleId,collection);}}this.mSGMapLabel.splice(0,this.mSGMapLabel.length);this._super(graphObjectMap,graphObjectList);},CreateTrendLine:function CreateTrendLine(infoIndex,category,values){this._super(infoIndex,category,values);},GenerateMapAndList:function GenerateMapAndList(shownDataLabels){var chartCtx=this.mChartContextPtr;if(chartCtx.mImageUsage!=$IMG_USAGE.OBJECT_CLIP_COMPUTATION){return this.GenerateByValueAxis($VA.VA_BOTH,shownDataLabels);}},GenerateByValueAxis:function GenerateByValueAxis(valueAxisIndex,shownDataLabels){var chartCtx=this.mChartContextPtr;if(this.mSeriesInfo.length===0){return ;}this.mGroupSize=this.mpABLPlotContext.mCategoryAxisPtr.getGroupSize();hCalBarWidth.call(this);hRenderItems.call(this,valueAxisIndex);if(chartCtx.mIsGraphMatrix){if(chartCtx.mImageUsage===$IMG_USAGE.GENERAL){if(this.mDatasetPtr.showDatalabels()){var barRects=[],dataLabelRects=[];hCreateDataLabels.call(this,barRects,dataLabelRects,false,false);hRenderDataLabels.call(this,shownDataLabels);}this.GenerateTrendLine();this.GenerateRefLine();}}this.populateRenderSequence();},LoadProperties:function LoadProperties(){var chartCtx=this.mChartContextPtr,barOptions=this.mBarOptions,gap,gmCtx=chartCtx.GetGraphMatrixContext(),elementInfo=gmCtx.mElementsInfo;if(chartCtx.mIsGraphMatrix){barOptions.mColorBySeries=!this.mChartContextPtr.isLegendByGroup();barOptions.mGapWidth=10;if(elementInfo.Max.Mode===$GM_ESM._MANUAL){gap=elementInfo.Max.Size*100;if(gap<1){gap=1;}if(gap>100){gap=99;}barOptions.mGapWidth=100-gap;}}if(chartCtx.mImageUsage!==0){return ;}},ShouldRotateDataLabel:function ShouldRotateDataLabel(){var gmCtx=this.mChartContextPtr.GetGraphMatrixContext(),ablOptions=this.mpABLPlotContext.mABLOptions,orientation=ablOptions.mOrientation,layout=ablOptions.mLayout;if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeGMTick){return false;}if(orientation===$OR.OR_HORIZONTAL){return false;}if(gmCtx.isCombinationChart()&&(layout===$LAYOUT.LO_ABSOLUTE)){layout=$LAYOUT.LO_CLUSTER;}if(layout===$LAYOUT.LO_ABSOLUTE||this.mSeriesInfo.length===1){return hShouldRotateDataLabel.call(this);}if(layout===$LAYOUT.LO_CLUSTER){return true;}return false;},GetSeriesOrderByType:function GetSeriesOrderByType(groupIndex,seriesList,valueAxisIndex){return hGetSeriesOrderByType.call(this,groupIndex,seriesList,valueAxisIndex);},GetRiserStartPosAndSize:function GetRiserStartPosAndSize(riserInfo,barWidth){return hGetRiserStartPosAndSize.call(this,riserInfo,barWidth);},hUpdateBarRect:function hUpdateBarRect(riserInfo,rect,aboveBase,dataValue){var chartCtx=this.mChartContextPtr,valueAxisIndex,valueAxis,basePosition,baseValue,plotCtx=this.mpABLPlotContext,options=plotCtx.mABLOptions,dataset=this.mDatasetPtr,seriesInfo=this.mSeriesInfo,orientation=options.mOrientation,layout=options.mLayout;if(!chartCtx.mIsGraphMatrix){return true;}if(dataValue!==0&&(this.mBarRenderType===kBarRenderType_Stacked||this.mBarRenderType===kBarRenderType_Percent)){dataValue=dataset.GetData(seriesInfo[riserInfo.seriesInfoID].mSeriesId,riserInfo.groupID,0);}if(dataValue!==0){if(orientation===$OR.OR_VERTICAL&&rect.height===0){rect.height=1;}if(orientation===$OR.OR_HORIZONTAL&&rect.width===0){rect.width=1;}}if(rect.width*rect.height===0){return false;}valueAxisIndex=this.mSeriesInfo[riserInfo.seriesInfoID].mValueAxis;valueAxis=plotCtx.mValueAxis[valueAxisIndex];if(valueAxis===null){return false;}perfBarRectAdjust.ResetRect(rect);basePosition=valueAxis.GetBasePosition(true);baseValue=valueAxis.GetBaseValue(true);if(basePosition===null||baseValue===null){return false;}if(orientation===$OR.OR_VERTICAL){if(valueAxis.isBaseLineQualified()){if(perfBarRectAdjust.y===basePosition){if(aboveBase){--(perfBarRectAdjust.y);--(perfBarRectAdjust.y);}else{}if(perfBarRectAdjust.height>1&&layout===$LAYOUT.LO_STACKED){++(perfBarRectAdjust.y);--(perfBarRectAdjust.height);}}else{if(perfBarRectAdjust.y+perfBarRectAdjust.height===basePosition){if(perfBarRectAdjust.height>1){perfBarRectAdjust.height--;}else{perfBarRectAdjust.y--;}}}}else{if(perfBarRectAdjust.y===basePosition){if(dataValue>=baseValue){--(perfBarRectAdjust.y);--(perfBarRectAdjust.y);}else{if(perfBarRectAdjust.height>1){perfBarRectAdjust.y++;perfBarRectAdjust.height--;}}}if(perfBarRectAdjust.y+perfBarRectAdjust.height===basePosition&&perfBarRectAdjust.height===1){if(dataValue>=baseValue){--(perfBarRectAdjust.y);++(perfBarRectAdjust.height);}}}}if(orientation===$OR.OR_HORIZONTAL){if(valueAxis.isBaseLineQualified()){if(perfBarRectAdjust.x===basePosition){if(aboveBase){++(perfBarRectAdjust.x);}else{--(perfBarRectAdjust.x);--(perfBarRectAdjust.x);}if(perfBarRectAdjust.width>1&&layout===$LAYOUT.LO_STACKED){--(perfBarRectAdjust.width);}}else{if(perfBarRectAdjust.x+perfBarRectAdjust.width===basePosition){if(perfBarRectAdjust.width>1){}else{perfBarRectAdjust.x--;}}}}else{if(perfBarRectAdjust.x===basePosition){if(aboveBase&&dataValue>baseValue){if(perfBarRectAdjust.x>basePosition){perfBarRectAdjust.width+=perfBarRectAdjust.x;perfBarRectAdjust.x=basePosition;}}}if(perfBarRectAdjust.x+perfBarRectAdjust.width===basePosition){--(perfBarRectAdjust.x);++(perfBarRectAdjust.width);}}}rect.copy(perfBarRectAdjust);return true;},hPrepareData:function hPrepareData(riserInfo){var dataValue,chartCtx=this.mChartContextPtr,barCollection;dataValue=this.GetData(riserInfo.seriesInfoID,riserInfo.groupID);if(dataValue===null){if(chartCtx.mIsGraphMatrix===false){barCollection=hFindRiserCollectionOrInsert.call(this,riserInfo);if(barCollection){if(this.mBarOptions.mColorBySeries&&!hIsLegendMarkerAddedToCollection.call(this,riserInfo.seriesInfoID)){this.AddLegendMarkerToCollection(riserInfo.seriesInfoID,barCollection);}}}}else{var id={mSeriesId:this.mSeriesInfo[riserInfo.seriesInfoID].mSeriesId,mGroupId:riserInfo.groupID};if(chartCtx.checkColorByAndSizeByValue(id,this.mDatasetPtr,this.mHasColorBy,this.mHasSizeBy)===false){dataValue=null;}}return dataValue;},hPrepareRect:function hPrepareRect(riserInfo,data,barWidth){var ablPlotCtx=this.mpABLPlotContext,ablOptions=ablPlotCtx.mABLOptions,valueIndex=this.mSeriesInfo[riserInfo.seriesInfoID].mValueAxis,valueAxis=ablPlotCtx.mValueAxis[valueIndex];var axisOriginValue=valueAxis.GetAxisOriginValue(),baseValue=valueAxis.GetBaseValue(true),aboveBase=data>baseValue,retVal=hGetRiserStartPosAndSize.call(this,riserInfo,barWidth),baseX=retVal.Start,sizeX=retVal.Size,baseY=valueAxis.GetBasePosition(true),offsetY=valueAxis.GetPositionByValue(data);perfBarRectCalculated.Reset(0,0,0,0);if(offsetY===null){perfBarRectCalculated.width=perfBarRectCalculated.height=-1;return{Rect:perfBarRectCalculated,AboveBase:aboveBase};}if(this.mBarRenderType===kBarRenderType_Stacked||this.mBarRenderType===kBarRenderType_Percent){var baseDataValue,useGeneric=false,groupStacked,thisIndex,cumulativeDataValue;if(axisOriginValue===null||axisOriginValue===0||this.mBarRenderType===kBarRenderType_Percent){useGeneric=true;}else{groupStacked=this.updateGroupStackInfoWithBase(valueIndex,riserInfo.groupID,axisOriginValue);thisIndex=this.getSeriesOffsetIntoStackedInfo(valueIndex,riserInfo.groupID,riserInfo.seriesInfoID);var oneCell=groupStacked[thisIndex];if(oneCell.Max===null||oneCell.Min===null){perfBarRectCalculated.width=perfBarRectCalculated.height=-1;return{Rect:perfBarRectCalculated,AboveBase:aboveBase};}baseY=valueAxis.ValueToPosition(oneCell.Min);offsetY=valueAxis.ValueToPosition(oneCell.Max);}if(useGeneric){if(this.mBarRenderType===kBarRenderType_Stacked&&valueAxis.mOptions.mUseLogarithmicScale&&riserInfo.seriesInfoID===0){baseDataValue=baseValue;}else{baseDataValue=this.GetData(riserInfo.seriesInfoID,riserInfo.groupID,true);}cumulativeDataValue=this.GetData(riserInfo.seriesInfoID,riserInfo.groupID);baseY=valueAxis.GetPositionByValue(baseDataValue);offsetY=valueAxis.GetPositionByValue(cumulativeDataValue);}if(baseY===null||offsetY===null){perfBarRectCalculated.width=perfBarRectCalculated.height=-1;return{Rect:perfBarRectCalculated,AboveBase:aboveBase};}aboveBase=(cumulativeDataValue>=baseValue);}switch(ablOptions.mOrientation){case $OR.OR_VERTICAL:perfBarRectCalculated.x=baseX;perfBarRectCalculated.y=Math.min(baseY,offsetY);perfBarRectCalculated.width=sizeX;perfBarRectCalculated.height=Math.abs(baseY-offsetY);break;case $OR.OR_HORIZONTAL:perfBarRectCalculated.x=Math.min(baseY,offsetY);perfBarRectCalculated.y=baseX;perfBarRectCalculated.width=Math.abs(baseY-offsetY);perfBarRectCalculated.height=sizeX;break;}return{Rect:perfBarRectCalculated,AboveBase:aboveBase,AxisOriginValue:(axisOriginValue||0)};},hPostProcessOneBar:function hPostProcessOneBar(riserInfo,rectangleObject){var barCollection=hFindRiserCollectionOrInsert.call(this,riserInfo);if(rectangleObject!==null){var barOptions=this.mBarOptions;if(barCollection){barCollection.AddGraphObject(rectangleObject);}if(this.mChartContextPtr.mIsGraphMatrix){if(this.mHasColorBy&&!this.mChartContextPtr.mDebugUseNewProperties){var tripleId=rectangleObject.mTripleId;hUpdateSpecificColor.call(this,tripleId,rectangleObject);}}this.mGraphObjectList.push(rectangleObject);this.AddToMap(rectangleObject);if(barOptions.mColorBySeries&&!hIsLegendMarkerAddedToCollection.call(this,riserInfo.seriesInfoID)){this.AddLegendMarkerToCollection(riserInfo.seriesInfoID,barCollection);}else{if(!this.mBarOptions.mColorBySeries&&this.mChartContextPtr.mIsGraphMatrix){if(this.mAddedLegendMarkerSet[riserInfo.groupID]===null&&this.mLegendPtr!==null){var newFill;if(barCollection){newFill=barCollection.GetFormatFill();}else{newFill=rectangleObject.GetFormatFill();}this.mLegendPtr.UpdateFormatForLegendMarker(riserInfo.groupID,newFill,null);this.mAddedLegendMarkerSet[riserInfo.groupID]=true;}}}}},hPrepareRectangleObject:function hPrepareRectangleObject(riserInfo,barRect,aboveZero){if(barRect.width<0||barRect.height<0){return null;}var chartCtx=this.mChartContextPtr,ablPlotCtx=this.mpABLPlot.mABLPlotContext,ablOptions=ablPlotCtx.mABLOptions,barCollection=hFindRiserCollectionOrInsert.call(this,riserInfo),Id=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:this.mSeriesInfo[riserInfo.seriesInfoID].mSeriesId,GroupId:riserInfo.groupID}),rectangleObject;if(ablOptions.mUseDepth){console.alert("Missing method for depth rectangle object");}else{rectangleObject=new $C.RectangleObject({TripleId:Id,GraphObjectManager:this,Area:barRect,GraphCollectionObject:barCollection,Shape:$SHP._BAR,hasFill:true});if(chartCtx.mIsGraphMatrix){if(aboveZero){rectangleObject.mBorderOpenType=this.mIsVertical?$GD.BOTTOM:$GD.LEFT;}else{rectangleObject.mBorderOpenType=this.mIsVertical?$GD.TOP:$GD.RIGHT;}}}if(chartCtx.mUseAnimation){rectangleObject.SetAnimationEnable(true);rectangleObject.SetProgress(1);}return rectangleObject;}});}());