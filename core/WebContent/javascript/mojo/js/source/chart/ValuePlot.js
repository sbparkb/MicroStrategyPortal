(function(){mstrmojo.requiresClsP("mstrmojo.chart","Rect2D","Point2D","TripleId","Plot","GridMap","LabelInfo","TextObject","StraightLineObject","PolyLineObject","NumberObject","GraphCollectionObject","MarkerObject","DataLabelManager","GMDataLabelInfo","ChartConstants","TrendLineObject");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumGraphMajorType","EnumDSSGraphObjectManager","EnumCollectionType","EnumAnchorPoint","EnumImageUsage","EnumFontRotation","EnumGraphMatrixMarkerTypeInChart","EnumGraphMatrixPiePlotType","EnumGraphMatrixThemeType","EnumGraphMatrixElementSizeMode");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphProperty","EnumDSSGraphObject","EnumDSSGraphProperty","EnumDSSGraphRegressionType","EnumDSSGraphDataTextPosition","EnumDSSGraphDataTextShowType","EnumDSSExtraGraphProperty","EnumShapeType","EnumDSSGraphDataTextPosition");mstrmojo.requiresCls("mstrmojo.chart.common.MapStructure");mstrmojo.requiresCls("mstrmojo.VisUtility");var $C=mstrmojo.chart;var $GMM=$C.gModuleMain,$K=$C.ChartConstants,$VISUTIL=mstrmojo.VisUtility,$CHART_ENUMS=$C.enums,$CT=$CHART_ENUMS.EnumCollectionType,$GMT=$CHART_ENUMS.EnumGraphMajorType,$AP=$CHART_ENUMS.EnumAnchorPoint,$FR=$CHART_ENUMS.EnumFontRotation,$GM_MarkerStyle=$CHART_ENUMS.EnumGraphMatrixMarkerTypeInChart,$GMESM=$CHART_ENUMS.EnumGraphMatrixElementSizeMode,$IMG_USAGE=$CHART_ENUMS.EnumImageUsage,$GMPPT=$CHART_ENUMS.EnumGraphMatrixPiePlotType,$CHART_COMMON=$C.common,$NTID=$C.gNullTripleId,$NGID=$C.gNullGroupId,$M=mstrmojo.chart.model,$MODEL_ENUMS=$M.enums,$GP=$MODEL_ENUMS.EnumDSSGraphProperty,$RT=$MODEL_ENUMS.EnumDSSGraphRegressionType,$DTP=$MODEL_ENUMS.EnumDSSGraphDataTextPosition,$DTS=$MODEL_ENUMS.EnumDSSGraphDataTextShowType,$GDTP=$MODEL_ENUMS.EnumDSSGraphDataTextPosition,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$EGP=$MODEL_ENUMS.EnumDSSExtraGraphProperty,$SHP=$MODEL_ENUMS.EnumShapeType,$MS=$MODEL_ENUMS.EnumDSSGraphMarkerShape;var kMaxComposite=-1,kRingPieRatio=0.7,kDataLabelShowValue=2,kDataLabelShowText=3,kRefLabelPosition1=1,kRefLabelPosition2=2,kRefLabelPosition3=3,kRefLabelPosition4=4,kRefLabelPosition5=5,kRefLabelPosition6=6,kRefLineLevelPerCell=1,k_y1=1,k_x1=2,k_y2=3,k_x2=4;var perfShapePosition=new $C.Point2D();function compareRefLabelCandidates(a,b){var diff;if(a.cannotFitVertically===true&&b.cannotFitVertically===false){return 1;}if(a.cannotFitVertically===false&&b.cannotFitVertically===true){return -1;}if(a.cannotFitHorizontally===true&&b.cannotFitHorizontally===false){return 1;}if(a.cannotFitHorizontally===false&&b.cannotFitHorizontally===true){return -1;}diff=a.overlapRefLabelCount-b.overlapRefLabelCount;if(diff<0){return -1;}else{if(diff>0){return 1;}else{diff=a.overlapRefLineCount-b.overlapRefLineCount;if(diff<0){return -1;}else{if(diff>0){return 1;}else{diff=a.overlapDataLabelCount-b.overlapDataLabelCount;if(diff<=0){return -1;}else{return 1;}}}}}}function newScatterSeriesInfo(){var result={ConnectDataPoint:false,ShowDataLabel:false,MarkerSize:33,MarkerShape:4,ValueAxisIndex:0,SeriesID:0,IsNullData:[],TrendLineOptions:{mRegressionType:$RT.DssGraphRegressionNone,mOrder:3,mPeriod:2,mShowEquation:false,mShowCoefficients:false,mUserSeriesGraphColor:true}};return result;}function hGetSuggestedSliceUnit(rect){var i,size=this.labelMatrix.length,width=this.mDataArea.width,height=this.mDataArea.height,tempRect,chartCtx=this.mChartContextPtr,factor=0.25;if(chartCtx.mIsGraphMatrix){var gmCtx=chartCtx.GetGraphMatrixContext(),kFixedTickerSize=gmCtx.mConstants.FixedTickerSize;if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeGMTick){height=kFixedTickerSize;width=this.minRadius*factor;}else{height=width=this.minRadius*factor;}}else{for(i=0;i<size;++i){tempRect=this.labelMatrix[i].Label.GetBoundingRectNoRotation(true);width=Math.min(tempRect.width,width);height=Math.min(tempRect.height,height);if(this.isBubbleChart){width=Math.min(this.labelMatrix[i].HostMarker.width,width);height=Math.min(this.labelMatrix[i].HostMarker.height,height);}}if(!this.isBubbleChart){width=Math.min(this.labelMatrix[0].HostMarker.width,width);height=Math.min(this.labelMatrix[0].HostMarker.height,height);}if(width>1){width=Math.round(width*factor);}if(height>1){height=Math.round(height*factor);}}rect.width=Math.max(width,1);rect.height=Math.max(height,1);}function hCalCulateMaxcomposite(alpha){return 3;}function hInViewPort(viewPort,shapeInfo){var size=shapeInfo.Size,position=shapeInfo.Position,isYout=size+position.y<viewPort.y||position.y-size>viewPort.y+viewPort.height,isXout=size+position.x<viewPort.x||position.x-size>viewPort.x+viewPort.width;return !isXout&&!isYout;}function hCanSkip(shapeInfo){var chartCtx=this.mChartContextPtr,gmCtx,dataLabelPadding=5;if(chartCtx.mPartialRendering===false){return false;}if(chartCtx.mIsGraphMatrix){gmCtx=chartCtx.GetGraphMatrixContext();dataLabelPadding=gmCtx.getPadding($K.kDataLabel);if(hInViewPort.call(this,chartCtx.mRenderingWindow,shapeInfo)===false){return true;}}if(this.shapeCanvas===null){var unitRect=new $C.Rect2D();hGetSuggestedSliceUnit.call(this,unitRect);this.shapeCanvas=new $C.GridMap({Rect:this.mDataArea,Unit:unitRect,MatrixType:1,dataLabelPadding:dataLabelPadding});if(kMaxComposite<0){kMaxComposite=hCalCulateMaxcomposite.call(this,1);}}var density,gridMap=this.shapeCanvas;if(gridMap.veryDense()){return true;}density=gridMap.ToInspectedMetric(shapeInfo);if(density.Min>=kMaxComposite-1||((density.Occupied/density.Total)>=kMaxComposite-1&&density.Min>0)){return true;}var rect=shapeInfo.BoundingBox,position=shapeInfo.Position,size=shapeInfo.Size;switch(shapeInfo.Shape){case $SHP._CIRCLE:gridMap.UpdateMatrixCircle(position,size,true);break;case $SHP._PIE:gridMap.UpdateMatrixCircle(position,size,true);if(shapeInfo.ExclusiveRect){gridMap.UpdateMatrixCircle(position,size*kRingPieRatio,false);}break;case $SHP._TICKER:case $SHP._RECTANGLE:gridMap.UpdateMatrixRect(rect,true);break;default:console.alert("Bubble partial rendering: shape not support yet");break;}return false;}function hGetShapeInfo(markerShape,irCoordPoint,iMarkerSize){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),rect,shape,exclusiveRect;switch(markerShape){case $MS.DssGraphMarkerShapeGMTick:var halfY=Math.round(gmCtx.mConstants.FixedTickerSize*0.5),halfX=Math.round(0.5*iMarkerSize);rect=new $C.Rect2D();rect.x=irCoordPoint.x-halfX;rect.y=irCoordPoint.y-halfY;rect.width=2*halfX;rect.height=2*halfY;shape=$SHP._TICKER;break;case $MS.DssGraphMarkerShape2DPie:case $MS.DssGraphMarkerShape2DRingPie:var layout=0;if(markerShape===$MS.DssGraphMarkerShape2DRingPie){layout=1;}if(this.mPieRenderer===null||this.mPieRenderer===undefined){this.mPieRenderer=new $C.PiePlotRenderer({GraphObjectManager:this,Dataset:this.mDatasetPtr,ChartContext:chartCtx,Layout:layout,MaxRadius:this.maxUnitRadius,PlotType:$GMPPT.GMPPT_VALUE,ShownDataLabels:this.shownDataLabels});}var radius=this.mPieRenderer.GetPieRadius(0,0,0);rect=chartCtx.transformToRect(irCoordPoint,radius,true);shape=$SHP._PIE;if(layout===1){exclusiveRect=chartCtx.transformToRect(irCoordPoint,radius*kRingPieRatio,true);}break;case $MS.DssGraphMarkerShapeSquare:case $MS.DssGraphMarkerShapeRectangle:rect=chartCtx.transformToRect(irCoordPoint,iMarkerSize,true);shape=$SHP._RECTANGLE;break;default:rect=chartCtx.transformToRect(irCoordPoint,iMarkerSize,true);shape=$SHP._CIRCLE;break;}return{BoundingBox:rect,Shape:shape,ExclusiveRect:exclusiveRect};}function hGetMarkerPosition(SeriesInfoIndex,GroupId,Position){var data,YAxis,position;data=this.mDatasetPtr.GetData(this.VecSeriesInfo[SeriesInfoIndex].SeriesID,GroupId,0);if(data===null){return false;}position=this.xAxis.GetPositionByValue(data);if(position===null){return false;}Position.x=position;data=this.mDatasetPtr.GetData(this.VecSeriesInfo[SeriesInfoIndex].SeriesID,GroupId,1);if(data===null){return false;}YAxis=(this.VecSeriesInfo[SeriesInfoIndex].ValueAxisIndex===0)?this.y1Axis:this.y2Axis;position=YAxis.GetPositionByValue(data);if(position===null){return false;}Position.y=position;return true;}function hGetMarkerSize(SeriesInfoIndex,GroupId){var result,allMarkerSize,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),dataset=this.mDatasetPtr,seriesInfos=this.VecSeriesInfo,value,size,shape=$SHP._CIRCLE,markerShape=gmCtx.mMarkerShape;if(chartCtx.mIsGraphMatrix){if(this.isBubbleChart){value=dataset.GetSizeByData(this.VecSeriesInfo[SeriesInfoIndex].SeriesID,GroupId);if(value===null){return null;}size=this.maxUnitRadius;if(markerShape===$MS.DssGraphMarkerShapeGMTick){shape=$SHP._TICKER;size=gmCtx.GetScaledSize(value,size,shape);}else{if(markerShape===$MS.DssGraphMarkerShape2DPie||markerShape===$MS.DssGraphMarkerShape2DRingPie){shape=$SHP._PIE;size=gmCtx.GetScaledSize(value,size,shape);size=Math.max(size,gmCtx.mConstants.MinimalSize.Pie);}else{if(markerShape!==$MS.DssGraphMarkerShapeCircle){shape=$SHP._SQUARE;}size=gmCtx.GetScaledSize(value,size,shape);}}result=size;this.maxRadius=Math.max(this.maxRadius,size);this.minRadius=Math.min(this.minRadius,size);}else{result=this.maxUnitRadius;this.minRadius=this.maxRadius=this.maxUnitRadius;}}else{if(this.isBubbleChart){allMarkerSize=0;value=dataset.GetProperty($GP.DssGraphMarkerSize,$NTID);if(value){allMarkerSize=value;}value=dataset.GetData(this.VecSeriesInfo[SeriesInfoIndex].SeriesID,GroupId,2);if(value===null){seriesInfos[SeriesInfoIndex].IsNullData[GroupId]=true;}else{seriesInfos[SeriesInfoIndex].IsNullData[GroupId]=false;result=this.zAxis.ValueToBubbleSize(allMarkerSize,value);}}else{result=seriesInfos[SeriesInfoIndex].MarkerSize;}}if(result){result=Math.max(result,1);result=Math.floor(result);}return result;}function hGetVAFormattedText(SeriesInfoIndex,GroupID,VAIndex,Collection){var valueAxis,data,axisFormat,tripleId,numberObj,text=null;if(VAIndex===0){valueAxis=this.xAxis;}else{if(VAIndex===1){valueAxis=(this.VecSeriesInfo[SeriesInfoIndex].ValueAxisIndex===0)?this.y1Axis:this.y2Axis;}else{if(VAIndex===2){valueAxis=this.zAxis;}}}if(valueAxis===null){return text;}data=this.mDatasetPtr.GetData(this.VecSeriesInfo[SeriesInfoIndex].SeriesID,GroupID,VAIndex);if(data===null){return text;}axisFormat=valueAxis.GetNumberFormat();tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:this.VecSeriesInfo[SeriesInfoIndex].SeriesID,GroupId:GroupID});numberObj=new $C.NumberObject({TripleId:tripleId,GraphObjectManager:this,Number:data,NumberFormat:axisFormat,GraphCollectionObject:Collection,Locale:0,clientDrag:false,DataSet:null,IsFinal:false,ColumnOffset:VAIndex});if(numberObj!==null){text=numberObj.mText;}return text;}function hPutDataLabelToTarget(TextObj,RefRect,TargetPoint,Rotation){var tempRect,TargetRect;tempRect=TextObj.GetBoundingRectNoRotation();TargetRect=tempRect;TextObj.SetRect(TargetRect);return Math.sqrt((TargetRect.x-RefRect.x)*(TargetRect.x-RefRect.x)+(TargetRect.y-RefRect.y)*(TargetRect.y-RefRect.y));}function hPutDataLabel(TextObj,RefRect,Rotation,LabelLocation){var isVertical=false,isTilted=false,factor=2,textRect,space=0,offSet,xAffector=0,yAffector=0,xCoordinate,yCoordinate,distance,workLabelLocation=this.isSmarted?LabelLocation:this.labelLocation;switch(Rotation){case $FR.FR_90:case $FR.FR_270:isVertical=true;break;case $FR.FR_45:case $FR.FR_315:isTilted=true;break;default:break;}if(isTilted){factor=1.414;}textRect=TextObj.GetBoundingRectNoRotation();if((workLabelLocation===$DTP.DssGraphDTPositionOutMin)||(workLabelLocation===$DTP.DssGraphDTPositionInMin)){space=isTilted?RefRect.height/2+RefRect.width/2:RefRect.width;}else{space=isTilted?RefRect.width/2+RefRect.height/2:RefRect.height;}offSet=space;switch(workLabelLocation){case $DTP.DssGraphDTPositionCenter:xAffector=yAffector=0;break;case $DTP.DssGraphDTPositionOutMin:xAffector=1;offSet+=(isVertical||isTilted)?textRect.Height/factor:textRect.Width/2;break;case $DTP.DssGraphDTPositionInMin:xAffector=-1;offSet+=(isVertical||isTilted)?textRect.Height/factor:textRect.Width/2;break;case $DTP.DssGraphDTPositionInMax:yAffector=-1;distance=isVertical?textRect.Width:textRect.Height;offSet+=(isVertical||isTilted)?distance/factor:textRect.Height/2;break;case $DTP.DssGraphDTPositionOutMax:yAffector=1;distance=isVertical?textRect.Width:textRect.Height;offSet+=(isVertical||isTilted)?distance/factor:textRect.Height/2;break;default:break;}xCoordinate=RefRect.GetCenter().x+xAffector*offSet;yCoordinate=RefRect.GetCenter().y+yAffector*offSet;TextObj.MoveTo(xCoordinate,yCoordinate,$AP.CENTER);return space;}function hGetFeelerLinePosition(vexOnMarker,vexOnLabel,MarkerRect,labelRect){var Center=MarkerRect.GetCenter(),isAbove=(labelRect.y+labelRect.height-Center.y)<0,isLeft=(labelRect.x+labelRect.width-Center.x)<0,resultX=(labelRect.x-Center.x)*(labelRect.x+labelRect.width-Center.y),resultY=(labelRect.y-Center.y)*(labelRect.y+labelRect.height-Center.y);if(resultY<=0){vexOnMarker.x=isLeft?MarkerRect.x:MarkerRect.x+MarkerRect.width;vexOnMarker.y=isLeft?Math.round(MarkerRect.y+0.5*MarkerRect.height):Math.round(MarkerRect.y+0.5*MarkerRect.height);vexOnLabel.y=Center.y;vexOnLabel.x=isLeft?labelRect.x+labelRect.width:labelRect.x;}else{vexOnMarker.x=isAbove?Math.round(MarkerRect.x+0.5*MarkerRect.width):Math.round(MarkerRect.x+0.5*MarkerRect.width);vexOnMarker.y=isAbove?MarkerRect.y:MarkerRect.y+MarkerRect.height;if(resultX<=0){vexOnLabel.x=Center.x;vexOnLabel.y=isAbove?labelRect.y+labelRect.height:labelRect.y;}else{if(isLeft){vexOnLabel.x=isAbove?labelRect.x+labelRect.width:labelRect.x+labelRect.width;vexOnLabel.y=isAbove?labelRect.y+labelRect.height:labelRect.y;}else{vexOnLabel.x=isAbove?labelRect.x:labelRect.x;vexOnLabel.y=isAbove?labelRect.y+labelRect.height:labelRect.y;}}}}function hGetFeelerLinePositionWithSpace(vertexOnMarker,vertexOnLabel,markerRect,space,location){var xAffector=0,yAffector=0;switch(location){case $DTP.DssGraphDTPositionOutMin:xAffector=1;vertexOnMarker.x=markerRect.x+markerRect.width;vertexOnMarker.y=markerRect.y+0.5*markerRect.height;space-=markerRect.width/2;break;case $DTP.DssGraphDTPositionInMin:xAffector=-1;vertexOnMarker.x=markerRect.x;vertexOnMarker.y=markerRect.y+0.5*markerRect.height;space-=markerRect.width/2;break;case $DTP.DssGraphDTPositionInMax:yAffector=-1;vertexOnMarker.x=markerRect.x+0.5*markerRect.width;vertexOnMarker.y=markerRect.y;space-=markerRect.height/2;break;case $DTP.DssGraphDTPositionOutMax:yAffector=1;vertexOnMarker.x=markerRect.x+0.5*markerRect.width;vertexOnMarker.y=markerRect.y;space-=markerRect.height/2;break;}vertexOnLabel.x=vertexOnMarker.x+xAffector*space;vertexOnLabel.y=vertexOnMarker.y+yAffector*space;}function hMoveDataLabel(TextObj,RefRect,Rotation,Collection){var space,marker,label,tripleId,dataLabelLine;if(TextObj===null){return ;}space=hPutDataLabel.call(this,TextObj,RefRect,Rotation,this.labelLocation);if(this.dataLabelLine){marker=new $C.Point2D();label=new $C.Point2D();hGetFeelerLinePositionWithSpace.call(this,marker,label,RefRect,space,this.labelLocation);tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataTextConnectLine,SeriesId:-3,GroupId:-3});dataLabelLine=new $C.StraightLineObject({TripleId:tripleId,GraphObjectManager:this,Start:marker,End:label});this.mGraphObjectList.push(dataLabelLine);Collection.AddGraphObject(dataLabelLine);}}function hCreateDataLabel(seriesInfoIndex,groupID,collection){var dataset=this.mDatasetPtr,dataLabelStyle=dataset.dataLabelStyle,finalStr="",xStr,yStr,dataLabel;switch(dataLabelStyle){case kDataLabelShowValue:xStr=hGetVAFormattedText.call(this,seriesInfoIndex,groupID,0,collection);yStr=hGetVAFormattedText.call(this,seriesInfoIndex,groupID,1,collection);finalStr="("+xStr+", "+yStr+")";break;case kDataLabelShowText:finalStr=dataset.GetTextLabel(this.VecSeriesInfo[seriesInfoIndex].SeriesID,groupID);break;}dataLabel=new $C.TextObject({TripleId:new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:this.VecSeriesInfo[seriesInfoIndex].SeriesID,GroupId:groupID}),GraphObjectManager:this,GraphCollectionObject:collection});dataLabel.SetText(finalStr);this.mPostTrendLineObjects.push(dataLabel);return dataLabel;}function hCreateSmartLabelCollection(Collections){var i,seriesCount=this.VecSeriesInfo.length,collectionsCount=Collections.length,tripleId,collection;if(collectionsCount>0){Collections.splice(0,collectionsCount);}for(i=0;i<seriesCount;++i){var showDataLabel=this.VecSeriesInfo[i].ShowDataLabel;if(showDataLabel){tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:this.VecSeriesInfo[i].SeriesID});collection=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});Collections.push(collection);this.AddToMap(collection);}}}function hCreateDataLabelCollection(Collections){var i,SeriesInfos=this.VecSeriesInfo,SeriesCount=SeriesInfos.length,CollectionsCount=Collections.length,TripleId,Collection;if(CollectionsCount>0){Collections.splice(0,CollectionsCount);}for(i=0;i<SeriesCount;++i){var showDataLabel=SeriesInfos[i].ShowDataLabel;if(showDataLabel){TripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:SeriesInfos[i].SeriesID});Collection=new $C.GraphCollectionObject({TripleId:TripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});Collections.push(Collection);this.AddToMap(Collection);}}}function hIsValueAxisUseCustomMinMax(){if(this.mChartContextPtr.mIsGraphMatrix){return(this.xAxis&&this.xAxis.mOptions.mUseCustomMinMax)||(this.y1Axis&&this.y1Axis.mOptions.mUseCustomMinMax)||(this.y2Axis&&this.y2Axis.mOptions.mUseCustomMinMax);}return false;}function hIsHostMarkerInDataAreaWithCustomMinMax(HostMarker){var dataArea=this.mDataArea,isCustomMinMax=hIsValueAxisUseCustomMinMax.call(this);if(isCustomMinMax){if(HostMarker.x<dataArea.x||HostMarker.x+HostMarker.width>dataArea.x+dataArea.width){return false;}if(HostMarker.y<dataArea.y||HostMarker.y+HostMarker.height>dataArea.y+dataArea.height){return false;}}return true;}function hInitDataLabels(MarkerMatrix,Collections){var seriesInfos=this.VecSeriesInfo,seriesNumber=seriesInfos.length,waitingList=this.waitingList,i,j,hiddenMarkers=null,count=0,seriesId,groupCount,labelInfo,rect;if(waitingList&&this.waitingList.length){var list=this.waitingList,len=list.length,id;this.hiddenMarkers=this.hiddenMarkers||[];hiddenMarkers=this.hiddenMarkers;for(i=0;i<len;i++){id=list[i].Id;hiddenMarkers[id.mSeriesId]=hiddenMarkers[id.mSeriesId]||[];hiddenMarkers[id.mSeriesId][id.mGroupId]=1;}}for(i=0;i<seriesNumber;++i){count=0;seriesId=seriesInfos[i].SeriesID;groupCount=seriesInfos[i].IsNullData.length;for(j=0;j<groupCount;++j){if(hiddenMarkers&&hiddenMarkers[seriesId][j]!==undefined){if(!seriesInfos[i].IsNullData[j]){++count;}continue;}var showDataLabel=seriesInfos[i].ShowDataLabel;if(!showDataLabel){this.standAloneMarkers.push(MarkerMatrix[i][count++]);continue;}if(!seriesInfos[i].IsNullData[j]){labelInfo=new $C.GMDataLabelInfo();labelInfo.isValid=true;labelInfo.GroupId=j;labelInfo.SeriesId=seriesId;labelInfo.HostMarkerBound=MarkerMatrix[i][j];labelInfo.HostMarkerPoint=labelInfo.HostMarkerBound.GetCenter();labelInfo.Label=hCreateDataLabel.call(this,i,j,Collections[i]);if(!hIsHostMarkerInDataAreaWithCustomMinMax.call(this,labelInfo.HostMarkerBound)){labelInfo.isValid=false;continue;}if(labelInfo.Label===null||labelInfo.Label===undefined){labelInfo.isValid=false;continue;}else{}this.mDataLabels.push(labelInfo);Collections[i].AddGraphObject(labelInfo.Label);}}}delete this.hiddenMarkers;}function hGetMarkerRectSet(RectMatrix){var i,j,rectMatrixSize=RectMatrix.length,insideSize=0,rectSet=[];for(i=0;i<rectMatrixSize;++i){if(RectMatrix[i].length>0){insideSize=RectMatrix[i].length;for(j=0;j<insideSize;++j){rectSet.push(RectMatrix[i][j]);}}}return rectSet;}function hIsFallOut(labelRect){var dataArea=this.mDataArea;if(labelRect.x<dataArea.x||labelRect.y<dataArea.y){return true;}return(labelRect.x+labelRect.width>dataArea.x+dataArea.width||labelRect.y+labelRect.height>dataArea.y+dataArea.height);}function hIsOverlappedWithHLine(Start,End,HStart,HEnd){var Bigger=Math.max(Start.y,End.y),Smaller=Start.y+End.y-Bigger;if(Smaller>HEnd.y||Bigger<HEnd.y){return false;}Bigger=Math.max(Start.x,End.x);Smaller=Start.x+End.x-Bigger;return !(Smaller>Math.max(HStart.x,HEnd.x)||Bigger<Math.min(HStart.x,HEnd.x));}function hIsOverlappedWithVLine(Start,End,VStart,VEnd){var Bigger=Math.max(Start.x,End.x),Smaller=Start.x+End.x-Bigger;if(Smaller>VEnd.x||Bigger<VEnd.x){return false;}Bigger=Math.max(Start.y,End.y);Smaller=Start.y+End.y-Bigger;return !(Smaller>Math.max(VStart.y,VEnd.y)||Bigger<Math.min(VStart.y,VEnd.y));}function hIsTiltLineOverlappedWithNormalRect(Start,End,Points){var isTargetLineHorizontal=true,len=Points.length,i;for(i=0;i<len;++i){isTargetLineHorizontal=(i===0)||(i===2);if(isTargetLineHorizontal){if(hIsOverlappedWithHLine.call(this,Start,End,Points[i],Points[(i+1)%len])){return true;}}else{if(hIsOverlappedWithVLine.call(this,Start,End,Points[i],Points[(i+1)%len])){return true;}}}return false;}function hGetPrecisePointsForTiltRect(LabelInfo,Points){var Sign=1,normalRect,center,width,height,radius,tempPoint,xSign,ySign,tempPoints=[],addOn,result,theta,delta,X,Y,i;switch(LabelInfo.LabelRotation){case $FR.FR_NORMAL:case $FR.FR_CUSTOME:case $FR.FR_90:case $FR.FR_180:case $FR.FR_270:case $FR.FR_HOTEL:break;case $FR.FR_45:break;case $FR.FR_315:Sign=-1;break;}normalRect=LabelInfo.Label.GetBoundingRectNoRotation();center=normalRect.GetCenter();width=0.5*normalRect.width;height=0.5*normalRect.height;radius=Math.sqrt(width*width+height*height);for(i=0;i<4;++i){xSign=(i===0||i===3)?-1:1;ySign=(i===0||i===1)?-1:1;tempPoint=new $C.Point2D({x:xSign*width,y:ySign*height});tempPoints.push(tempPoint);}for(i=0;i<4;i++){addOn=(i===0||i===3)?180:0;result=Math.atan(tempPoints[i].x/tempPoints[i].y);theta=$GMM.RadianToDegree(result);theta+=(addOn+Sign*45);delta=$GMM.DegreeToRadian(theta);X=Math.round(radius*Math.cos(delta))+center.x;Y=Math.round(radius*Math.sin(delta))+center.y;tempPoint=new $C.Point2D({x:X,y:Y});Points.push(tempPoint);}}function hIsLabelRectOverlapped(labelRect,targetSet,isTiltRect,isTiltTargets){var TargetSize=targetSet.length,Count=0,i=0;isTiltRect=isTiltRect||false;isTiltTargets=isTiltTargets||false;if(!isTiltTargets){for(i=0;i<TargetSize;++i){if(labelRect.HasIntersection(targetSet[i])){++Count;}}}else{$VISUTIL.visPrint("Checking label overlap with tilt targets has not been implemented yet.");}return Count;}function hIsLabelInfoOverlapped(LabelInfo,TargetSet,IsTiltTargets){var count=0,targetSize=TargetSet.length,isTiltRect=((LabelInfo.LabelRotation===$FR.FR_45)||(LabelInfo.LabelRotation===$FR.FR_315)),vertex=[],i=0,points,rect;IsTiltTargets=IsTiltTargets||false;if(isTiltRect){hGetPrecisePointsForTiltRect.call(this,LabelInfo,vertex);for(i=0;i<targetSize;++i){points=[];points.push(TargetSet[i].GetBottomLeft());points.push(TargetSet[i].GetBottomRight());points.push(TargetSet[i].GetTopRight());points.push(TargetSet[i].GetTopLeft());if(!IsTiltTargets){if(hIsTiltLineOverlappedWithNormalRect.call(this,vertex[0],vertex[1],points)||hIsTiltLineOverlappedWithNormalRect.call(this,vertex[1],vertex[2],points)||hIsTiltLineOverlappedWithNormalRect.call(this,vertex[2],vertex[3],points)||hIsTiltLineOverlappedWithNormalRect.call(this,vertex[3],vertex[0],points)){++count;}}else{$VISUTIL.visPrint("We currently do not support tilt rectangle against tilt targets");}}}else{rect=LabelInfo.Label.GetBoundingRect();count=hIsLabelRectOverlapped.call(this,rect,TargetSet,false,IsTiltTargets);}return count;}function hInitGridMapOccupation(GridMap){var i,j,dataArea=this.mDataArea,size,commonRect,tempRect,upperLimit;size=this.standAloneMarkers.length;commonRect=new $C.Rect2D();for(j=0;j<size;++j){commonRect.Reset(0,0,0,0);if(this.mChartContextPtr.RectangleIntersection(this.standAloneMarkers[j],dataArea,commonRect)){GridMap.UpdateMatrixRect(commonRect);}}size=this.labelMatrix.length;for(i=0;i<size;++i){commonRect.Reset(0,0,0,0);if(this.mChartContextPtr.RectangleIntersection(this.labelMatrix[i].HostMarker,dataArea,commonRect)){GridMap.UpdateMatrixRect(commonRect);}if(this.labelMatrix[i].IsPut){tempRect=this.labelMatrix[i].Label.GetBoundingRectNoRotation();if(this.mChartContextPtr.RectangleIntersection(tempRect,dataArea,commonRect)){GridMap.UpdateMatrixRect(commonRect,true,this.labelMatrix[i].LabelRotation);}}}upperLimit=Math.round(0.95*GridMap.XCount*GridMap.YCount);return GridMap.Metric<upperLimit;}function hGenerateFeelerForOneLabel(labelInfo,collection,space){var marker=new $C.Point2D(),label=new $C.Point2D(),lineId=new $C.TripleId({ObjectId:$GO.DssGraphDataTextConnectLine,SeriesId:-3,GroupId:-3}),rect,dataLabelLine;if(!labelInfo.IsValid){return false;}if(labelInfo.IsPut){if(labelInfo.SuggestedStart===$DTP.DssGraphDTPositionPieSmart){if(this.dataLabelLine||(!this.dataLabelLine&&labelInfo.IsMoved(this.labelLocation))){rect=labelInfo.Label.GetBoundingRect();hGetFeelerLinePosition.call(this,marker,label,labelInfo.HostMarker,rect);}else{return false;}}else{if(this.dataLabelLine||(!this.dataLabelLine&&labelInfo.IsMoved(this.labelLocation))){hGetFeelerLinePositionWithSpace.call(this,marker,label,labelInfo.HostMarker,space,labelInfo.SuggestedStart);}else{return false;}}dataLabelLine=new $C.StraightLineObject({TripleId:lineId,GraphObjectManager:this,StartPoint:marker,EndPoint:label,GraphCollectionObject:collection});this.mGraphObjectList.push(dataLabelLine);collection.AddGraphObject(dataLabelLine);return true;}if(this.dataLabelLine){hGetFeelerLinePositionWithSpace.call(this,marker,label,labelInfo.HostMarker,space,labelInfo.SuggestedStart);}else{return false;}dataLabelLine=new $C.StraightLineObject({TripleId:lineId,GraphObjectManager:this,StartPoint:marker,EndPoint:label,GraphCollectionObject:collection});this.mGraphObjectList.push(dataLabelLine);collection.AddGraphObject(dataLabelLine);return true;}function hPlaceLeftOversIntoFreeSpace(GridMap,LabelLines){var labelMatrixSize=this.labelMatrix.length,position=new $C.Point2D(),commonRect=new $C.Rect2D(),boundingRect,isAccommodatable,space,i,labelMatrix;for(i=0;i<labelMatrixSize;++i){labelMatrix=this.labelMatrix[i];if(!labelMatrix.IsPut){boundingRect=labelMatrix.Label.GetBoundingRectNoRotation();isAccommodatable=GridMap.IsAccomdatableConsiderRotation(labelMatrix.HostMarker,boundingRect,position,labelMatrix.LabelRotation);if(isAccommodatable){labelMatrix.IsPut=true;labelMatrix.SuggestedStart=$GDTP.DssGraphDTPositionPieSmart;space=hPutDataLabelToTarget.call(this,labelMatrix.Label,labelMatrix.HostMarker,position,labelMatrix.LabelRotation);boundingRect=labelMatrix.Label.GetBoundingRectNoRotation();hGenerateFeelerForOneLabel.call(this,labelMatrix,LabelLines,space);this.AddToMap(labelMatrix.Label);commonRect.Reset(0,0,0,0);if(this.mChartContextPtr.RectangleIntersection(boundingRect,this.mDataArea,commonRect)){GridMap.UpdateMatrixRect(commonRect,true,labelMatrix.LabelRotation);}}}}return true;}function hGenerateCollection(Collection){var i,vSeriesInfo,objectId,collectionType,collectionId,collectionObj,sizeScatterInfoArray=this.VecSeriesInfo.length;objectId=this.isBubbleChart?$GO.DssGraphRiser:$GO.DssGraphDataLine;collectionType=this.isBubbleChart?$CT.CT_GENERAL_SHAPE:$CT.CT_LINE;for(i=0;i<sizeScatterInfoArray;++i){vSeriesInfo=this.VecSeriesInfo[i];collectionId=new $C.TripleId({ObjectId:objectId,SeriesId:vSeriesInfo.SeriesID,GroupId:$NGID});collectionObj=new $C.GraphCollectionObject({TripleId:collectionId,GraphObjectManager:this,CollectionType:collectionType});Collection.push(collectionObj);this.AddToMap(Collection[i]);if(!this.mChartContextPtr.mIsGraphMatrix){this.AddLegendMarkerToCollection(vSeriesInfo.SeriesID,Collection[i],!this.isBubbleChart,true,vSeriesInfo.MarkerShape,vSeriesInfo.ConnectDataPoint);}}}function hPlaceLeftOvers(LabelLines){var labelMatrixSize=this.labelMatrix.length,tripleId,value,fontRotation,i,labelMatrix;for(i=0;i<labelMatrixSize;++i){labelMatrix=this.labelMatrix[i];tripleId=labelMatrix.Label.mTripleId;fontRotation=$FR.FR_NORMAL;value=this.mChartContextPtr.GetProperty($GP.DssGraphFontRotation,tripleId);if(value){fontRotation=value;}if(!labelMatrix.IsPut){hMoveDataLabel.call(this,labelMatrix.Label,labelMatrix.HostMarker,fontRotation,LabelLines);this.AddToMap(labelMatrix.Label);}}}function hPlaceOneLabel(Label,MarkerRectSet,LabelRectSet,LabelLines){var rect,space;if(this.labelLocation===$DTP.DssGraphDTPositionOutMin){Label.SuggestedStart=$DTP.DssGraphDTPositionInMin;}space=hPutDataLabel.call(this,Label.Label,Label.HostMarker,Label.LabelRotation,Label.SuggestedStart);rect=Label.ToRectangle();if(hIsFallOut.call(this,rect)||(hIsLabelInfoOverlapped.call(this,Label,MarkerRectSet)>0)||(hIsLabelInfoOverlapped.call(this,Label,this.standAloneMarkers)>0)||(hIsLabelInfoOverlapped.call(this,Label,LabelRectSet)>0)){if(Label.SuggestedStart>=$DTP.DssGraphDTPositionOutMax){return false;}++Label.SuggestedStart;if(Label.SuggestedStart===this.labelLocation){++Label.SuggestedStart;}if(Label.SuggestedStart>$DTP.DssGraphDTPositionOutMax){return false;}return hPlaceOneLabel.call(this,Label,MarkerRectSet,LabelRectSet,LabelLines);}LabelRectSet.push(rect);Label.IsPut=true;hGenerateFeelerForOneLabel.call(this,Label,LabelLines,space);return true;}function hGreedyPlacer(MarkerRectSet,LabelRectSet,LabelLines){var labelNumber=this.labelMatrix.length,count=0,labelInfo,space,rect,isOverLapped,i;for(i=0;i<labelNumber;++i){labelInfo=this.labelMatrix[i];space=hPutDataLabel.call(this,labelInfo.Label,labelInfo.HostMarker,labelInfo.LabelRotation,this.labelLocation);rect=labelInfo.ToRectangle();isOverLapped=(hIsFallOut.call(this,rect)||(hIsLabelInfoOverlapped.call(this,labelInfo,MarkerRectSet)>0)||(hIsLabelInfoOverlapped.call(this,labelInfo,this.standAloneMarkers)>0)||(hIsLabelInfoOverlapped.call(this,labelInfo,LabelRectSet)>0));if(!isOverLapped){LabelRectSet.push(rect);labelInfo.IsPut=true;labelInfo.SuggestedStart=this.labelLocation;hGenerateFeelerForOneLabel.call(this,labelInfo,LabelLines,space);++count;this.AddToMap(labelInfo.Label);continue;}if(hPlaceOneLabel.call(this,labelInfo,MarkerRectSet,LabelRectSet,LabelLines)){++count;this.AddToMap(labelInfo.Label);}else{labelInfo.SuggestedStart=this.labelLocation;}}return count;}function hInitLabelMatrix(MarkerMatrix,Collections){var vSeriesInfo,seriesNumber=this.VecSeriesInfo.length,count,i,j=0,seriesId,groupCount,labelInfo,rect;for(i=0;i<seriesNumber;++i){vSeriesInfo=this.VecSeriesInfo[i];count=0;seriesId=this.VecSeriesInfo[i].SeriesID;groupCount=this.VecSeriesInfo[i].IsNullData.length;for(j=0;j<groupCount;++j){var showDataLabel=this.VecSeriesInfo[i].ShowDataLabel;if(!showDataLabel){this.standAloneMarkers.push(MarkerMatrix[i][count++]);continue;}if(!this.VecSeriesInfo[i].IsNullData[j]){labelInfo=new $C.LabelInfo();labelInfo.IsValid=true;labelInfo.GroupId=j;labelInfo.SeriesId=seriesId;labelInfo.HostMarker=MarkerMatrix[i][count++];labelInfo.Label=hCreateDataLabel.call(this,i,j,Collections[i]);if(labelInfo.Label===null){labelInfo.IsValid=false;continue;}else{}this.labelMatrix.push(labelInfo);Collections[i].AddGraphObject(labelInfo.Label);}}}}function hGenerateDatalabels(RecMatrix,Collection){var vSeriesInfo,seriesNumber=this.VecSeriesInfo.length,i,j=0,localCollection,tripleId,rects,recIndex=0,value,groupSize,dataText,fontRotation;for(i=0;i<seriesNumber;++i){vSeriesInfo=this.VecSeriesInfo[i];var showDataLabel=this.mDatasetPtr.showSeriesDatalabel(vSeriesInfo.SeriesID);if(showDataLabel){tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:vSeriesInfo.SeriesID});localCollection=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});rects=RecMatrix[i];recIndex=0;groupSize=vSeriesInfo.IsNullData.length;for(j=0;j<groupSize;++j){if(vSeriesInfo.IsNullData[j]){continue;}dataText=hCreateDataLabel.call(this,i,j,localCollection);localCollection.AddGraphObject(dataText);this.AddToMap(dataText);tripleId=dataText.mTripleId;fontRotation=$FR.FR_NORMAL;value=this.mChartContextPtr.GetProperty($GP.DssGraphFontRotation,tripleId);if(value){fontRotation=value;}hMoveDataLabel.call(this,dataText,rects[recIndex++],fontRotation,Collection);}if(localCollection.GetCollectionSize()>0){this.AddToMap(localCollection);}}}}function hInitDataLabelManager(){var chartCtx=this.mChartContextPtr,dataLabelManager=this.dataLabelManager,i,dataLabels=this.mDataLabels,size=dataLabels.length,dataLabelHostMarker=[],chartFrame=new $C.Rect2D({x:0,y:0,width:chartCtx.mGraphWidth,height:chartCtx.mGraphHeight});if(dataLabelManager===null||dataLabelManager===undefined){dataLabelManager=this.dataLabelManager=new $C.DataLabelManager({DataArea:chartFrame});dataLabelManager.ChartContext=chartCtx;}dataLabelManager.RectangleObjects=dataLabelManager.RectangleObjects.concat(this.standAloneMarkers);for(i=0;i<size;++i){dataLabelHostMarker.push(dataLabels[i].HostMarkerBound);}dataLabelManager.RectangleObjects=dataLabelManager.RectangleObjects.concat(dataLabelHostMarker);return dataLabelManager;}function hPrepareDataLabelPositions(){var dataLabels=this.mDataLabels,size=dataLabels.length,i;for(i=0;i<size;++i){dataLabels[i].CenterXOffset=dataLabels[i].HostMarkerBound.width/2;dataLabels[i].CenterYOffset=dataLabels[i].HostMarkerBound.height/2;}}function hGenerateTrendLine(){var seriesNumber=this.VecSeriesInfo.length,seriesId,seriesInfo,i,valueAxis,values,coreValues,trendLineId,trendLineInfo,trendLineType,identity,coefficients,order,dataset=this.mDatasetPtr,chartCtx=this.mChartContextPtr,trendLineOptions,trendLineObject,trendLine;if(this.mTrendLineObjects===null){this.mTrendLineObjects=[];}if(dataset.isBare(chartCtx.IsPieChart())){return ;}for(i=0;i<seriesNumber;++i){seriesInfo=this.VecSeriesInfo[i];seriesId=seriesInfo.SeriesID;trendLineInfo=this.mDatasetPtr.GetTrendLineOfSeries(seriesId);valueAxis=seriesInfo.ValueAxisIndex===0?this.y1Axis:this.y2Axis;trendLineId=new $C.TripleId({ObjectId:$GO.DssGraphTrendLine,SeriesId:seriesId});if(trendLineInfo){trendLineType=trendLineInfo.getTrendLineType();if(trendLineType!==$RT.DssGraphRegressionNone){identity=trendLineInfo.getIdentity();values=trendLineInfo.getTrendLineValuesWithForecast();coreValues=trendLineInfo.getTrendLineValues();if(hGetValidValueNum(coreValues)<=1){continue;}coefficients=trendLineInfo.getCoefficients(true);order=coefficients.length-1;if(values&&values.length){trendLineOptions={mRegressionType:trendLineType,mOrder:order,mPeriod:0,mShowEquation:false,mShowCoefficients:false,mUserSeriesGraphColor:true,mSeasonal:false};trendLineObject=new $C.TrendLineObject({TripleId:trendLineId,GraphObjectManager:this,GraphCollectionObject:null,TrendLineOptions:trendLineOptions,XAxis:this.xAxis,YAxis:valueAxis,TrendLineValues:values,Coefficients:coefficients,IsVertical:true,Identity:identity});if(trendLineObject!==undefined&&trendLineObject!==null){trendLine=trendLineObject.CreateTrendLine();if(trendLine!==undefined&&trendLine!==null){this.mTrendLineObjects.push(trendLine);}}}}}}}function hGetRefLabelRectInfo(position,height,halfHeight,width,halfWidth,valuePosition,drawingAreaHeight,drawingAreaWidth,refLabelPadding,isVertical){var retVal={};retVal.rect=new $C.Rect2D({x:0,y:0,width:width+2*refLabelPadding,height:height+2*refLabelPadding});switch(position){case kRefLabelPosition1:if(isVertical){retVal.xOffset=valuePosition+refLabelPadding+halfWidth;retVal.yOffset=refLabelPadding+halfHeight;retVal.rect.x=valuePosition;retVal.rect.y=0;}else{retVal.xOffset=drawingAreaWidth-refLabelPadding-halfWidth;retVal.yOffset=valuePosition-refLabelPadding-halfHeight;retVal.rect.x=drawingAreaWidth-2*refLabelPadding-width;retVal.rect.y=valuePosition-2*refLabelPadding-height;}break;case kRefLabelPosition2:if(isVertical){retVal.xOffset=valuePosition-refLabelPadding-halfWidth;retVal.yOffset=refLabelPadding+halfHeight;retVal.rect.x=valuePosition-2*refLabelPadding-width;retVal.rect.y=0;}else{retVal.xOffset=drawingAreaWidth-refLabelPadding-halfWidth;retVal.yOffset=valuePosition+refLabelPadding+halfHeight;retVal.rect.x=drawingAreaWidth-2*refLabelPadding-width;retVal.rect.y=valuePosition;}break;case kRefLabelPosition3:if(isVertical){retVal.xOffset=valuePosition+refLabelPadding+halfWidth;retVal.yOffset=drawingAreaHeight/2;retVal.rect.x=valuePosition;retVal.rect.y=drawingAreaHeight/2-refLabelPadding-halfHeight;}else{retVal.xOffset=drawingAreaWidth/2;retVal.yOffset=valuePosition-refLabelPadding-halfHeight;retVal.rect.x=drawingAreaWidth/2-refLabelPadding-halfWidth;retVal.rect.y=valuePosition-2*refLabelPadding-height;}break;case kRefLabelPosition4:if(isVertical){retVal.xOffset=valuePosition-refLabelPadding-halfWidth;retVal.yOffset=drawingAreaHeight/2;retVal.rect.x=valuePosition-2*refLabelPadding-width;retVal.rect.y=drawingAreaHeight/2-refLabelPadding-halfHeight;}else{retVal.xOffset=drawingAreaWidth/2;retVal.yOffset=valuePosition+refLabelPadding+halfHeight;retVal.rect.x=drawingAreaWidth/2-refLabelPadding-halfWidth;retVal.rect.y=valuePosition;}break;case kRefLabelPosition5:if(isVertical){retVal.xOffset=valuePosition+refLabelPadding+halfWidth;retVal.yOffset=drawingAreaHeight-refLabelPadding-halfHeight;retVal.rect.x=valuePosition;retVal.rect.y=drawingAreaHeight-2*refLabelPadding-height;}else{retVal.xOffset=refLabelPadding+halfWidth;retVal.yOffset=valuePosition-refLabelPadding-halfHeight;retVal.rect.x=0;retVal.rect.y=valuePosition-2*refLabelPadding-height;}break;case kRefLabelPosition6:if(isVertical){retVal.xOffset=valuePosition-refLabelPadding-halfWidth;retVal.yOffset=drawingAreaHeight-refLabelPadding-halfHeight;retVal.rect.x=valuePosition-2*refLabelPadding-width;retVal.rect.y=drawingAreaHeight-2*refLabelPadding-height;}else{retVal.xOffset=refLabelPadding+halfWidth;retVal.yOffset=valuePosition+refLabelPadding+halfHeight;retVal.rect.x=0;retVal.rect.y=valuePosition;}break;}return retVal;}function hCheckRefLabelCandidate(refLabelCandidate,drawingAreaHeight,drawingAreaWidth,dataLabels,refLabels,refLinePosInfos){var rect=refLabelCandidate.rect,len,i,checkRect,currentDataLabel,curRefLine;if(rect.y<0||rect.y+rect.height>drawingAreaHeight){refLabelCandidate.cannotFitVertically=true;return ;}if(rect.x<0||rect.x+rect.width>drawingAreaWidth){refLabelCandidate.cannotFitHorizontally=true;}len=refLabels.length;for(i=0;i<len;++i){checkRect=refLabels[i].GetBoundingRect();if(rect.HasIntersection(checkRect)){++refLabelCandidate.overlapRefLabelCount;}}len=refLinePosInfos.length;for(i=0;i<len;++i){curRefLine=refLinePosInfos[i];if(curRefLine.isVertical){if(rect.x<curRefLine.position&&rect.x+rect.width>curRefLine.position){++refLabelCandidate.overlapRefLineCount;}}else{if(rect.y<curRefLine.position&&rect.y+rect.height>curRefLine.position){++refLabelCandidate.overlapRefLineCount;}}}len=dataLabels.length;for(i=0;i<len;++i){currentDataLabel=dataLabels[i];if(currentDataLabel.mIsShown){checkRect=currentDataLabel.GetBoundingRect();if(rect.HasIntersection(checkRect)){++refLabelCandidate.overlapDataLabelCount;refLabelCandidate.overlapDataLabels.push(dataLabels[i]);}}}}function hGenerateRefLineLabels(drawingAreaHeight,drawingAreaWidth,refLinePosInfos){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),refLabelPadding=gmCtx.getPadding($K.kRefLabel),numberOfRefLines=refLinePosInfos.length,curRefLine,label,width,height,halfWidth,halfHeight,textRect,i,j,k,renderingStr,refLabelCandidate,positionInfo,refLabelCandidates,len;for(i=0;i<numberOfRefLines;++i){curRefLine=refLinePosInfos[i];label=new $C.TextObject({TripleId:curRefLine.tripleId,GraphObjectManager:this,GraphCollectionObject:null,Identity:curRefLine.identity});if(label!==null){label.SetText(curRefLine.labelText);for(j=0;j<2;++j){if(j===1){renderingStr=label.mText;label.SetText(renderingStr[0]+"...");label.rect.height=0;label.rect.width=0;}textRect=label.GetBoundingRect();height=textRect.height;halfHeight=height/2;width=textRect.width;halfWidth=width/2;refLabelCandidates=[];for(k=kRefLabelPosition1;k<=kRefLabelPosition6;++k){refLabelCandidate={};refLabelCandidate.position=k;refLabelCandidate.cannotFitVertically=false;refLabelCandidate.cannotFitHorizontally=false;refLabelCandidate.overlapRefLabelCount=0;refLabelCandidate.overlapRefLineCount=0;refLabelCandidate.overlapDataLabelCount=0;refLabelCandidate.overlapDataLabels=[];positionInfo=hGetRefLabelRectInfo.call(this,k,height,halfHeight,width,halfWidth,curRefLine.position,drawingAreaHeight,drawingAreaWidth,refLabelPadding,curRefLine.isVertical);refLabelCandidate.xOffset=positionInfo.xOffset;refLabelCandidate.yOffset=positionInfo.yOffset;refLabelCandidate.rect=positionInfo.rect;hCheckRefLabelCandidate.call(this,refLabelCandidate,drawingAreaHeight,drawingAreaWidth,this.shownDataLabels,this.shownRefLabels,refLinePosInfos);refLabelCandidates.push(refLabelCandidate);}refLabelCandidates.sort(compareRefLabelCandidates);if(refLabelCandidates[0].cannotFitVertically){break;}if(refLabelCandidates[0].cannotFitHorizontally){if(i===0){continue;}else{break;}}label.MoveTo(refLabelCandidates[0].xOffset,refLabelCandidates[0].yOffset,$AP.CENTER);label.mIsShown=true;len=refLabelCandidates[0].overlapDataLabelCount;for(k=0;k<len;++k){refLabelCandidates[0].overlapDataLabels[k].mIsShown=false;}this.mPostTrendLineObjects.push(label);this.shownRefLabels.push(label);break;}}}}function hGenerateRefLine(){var numberOfSeries=this.VecSeriesInfo.length,seriesId,seriesInfo,i,j,valueAxis,value,points=[],refLineId,refLineInfo,refLineInfos,refLineLabel,refLineLevel,identity,direction,isVertical,refLine,position,startX,endX,midPoint={},labelId,refLabelFormat,dataset=this.mDatasetPtr,numberOfDataPoints=dataset.GetSeriesCount()*dataset.GetGroupCount(),chartCtx=this.mChartContextPtr,drawingAreaWidth=chartCtx.mGraphWidth,drawingAreaHeight=chartCtx.mGraphHeight,numberOfRefLines,refLinePosInfos=[];if(this.mReferenceLineObjects===null){this.mReferenceLineObjects=[];}if(chartCtx.mPartialRendering===false){numberOfDataPoints=this.DPCount;}for(i=0;i<numberOfSeries;++i){seriesInfo=this.VecSeriesInfo[i];seriesId=seriesInfo.SeriesID;refLineInfos=this.mDatasetPtr.GetReferenceLinesOfSeries(seriesId);valueAxis=seriesInfo.ValueAxisIndex===0?this.y1Axis:this.y2Axis;refLabelFormat={};refLabelFormat.Condense=valueAxis.mCondenseLabels;if(!refLabelFormat.Condense){if(valueAxis.mNumberFormat.isDefault){var axisFormat=new $C.ChartAdvFormat();chartCtx.getAxisAutoNumberFormat(axisFormat,valueAxis.mPrimaryMetrics);valueAxis.mNumberFormat=axisFormat;}refLabelFormat.NumberFormat=valueAxis.mNumberFormat.mCustomFormat;}numberOfRefLines=refLineInfos.length;for(j=0;j<numberOfRefLines;++j){refLineId=new $C.TripleId({GroupId:j,ObjectId:$GO.DssGraphReferenceLine,SeriesId:seriesId});labelId=new $C.TripleId({ObjectId:$GO.DssGraphRefLineText,SeriesId:seriesId,GroupId:j});points=[];refLineInfo=refLineInfos[j];if(refLineInfo){identity=refLineInfo.getIdentity();value=refLineInfo.getReferenceLineValue();direction=refLineInfo.getReferenceLineDirection();refLineLabel=refLineInfo.getReferenceLineLabel(false,false,refLabelFormat);refLineLevel=refLineInfo.getLevel();if(numberOfDataPoints===0){continue;}if(value===null&&value===undefined){continue;}isVertical=(direction!=="horizontal");if(isVertical){position=this.xAxis.GetPositionByValue(value);}else{position=valueAxis.GetPositionByValue(value);}if(position!==null){startX=1;if(isVertical){if(position===0){position=1;}else{if(position===drawingAreaWidth){--position;}}endX=drawingAreaHeight-1;points.push(new $C.Point2D({x:position,y:startX}));points.push(new $C.Point2D({x:position,y:endX}));midPoint.x=position;midPoint.y=(points[0].y+points[1].y)/2;}else{if(position===0){position=1;}else{if(position===drawingAreaHeight){--position;}}endX=drawingAreaWidth-1;points.push(new $C.Point2D({x:startX,y:position}));points.push(new $C.Point2D({x:endX,y:position}));midPoint.x=(points[0].x+points[1].x)/2;midPoint.y=position;}refLine=new $C.StraightLineObject({TripleId:refLineId,GraphObjectManager:this,StartPoint:points[0],EndPoint:points[1],GraphCollectionObject:null,Identity:identity,Shape:$SHP._LINE,MidPoint:midPoint});if(refLine!==null){if(!refLine.mFormatLinePtr){refLine.mFormatLinePtr=new $C.FormatLine();}this.mReferenceLineObjects.push(refLine);refLinePosInfos.push({tripleId:labelId,identity:identity,isVertical:isVertical,position:position,labelText:refLineLabel});}}else{$VISUTIL.visPrint("Reference line point calculation abnormal:");$VISUTIL.visPrint("\tref line #: "+j+" direction: "+direction);$VISUTIL.visPrint("\tvalue = "+value);if(isVertical){$VISUTIL.visPrint("\tx = "+position);}else{$VISUTIL.visPrint("\ty = "+position);}}}}}hGenerateRefLineLabels.call(this,drawingAreaHeight,drawingAreaWidth,refLinePosInfos);}function hDrawTrendLine(){var size=this.mTrendLineObjects.length,i;for(i=0;i<size;++i){this.mTrendLineObjects[i].Draw();}}function hDrawRefLine(){var refLines=this.mReferenceLineObjects,i;for(i=0;i<refLines.length;++i){refLines[i].Draw();}}function hGetValidValueNum(valArray){var i,validValueNum=0;for(i=0;i<valArray.length;i++){if(valArray[i]!==null){validValueNum++;}}return validValueNum;}function hRenderDataLabels(vecMarkerRectangle,isSmartPossible){if(!isSmartPossible){return ;}var chartCtx=this.mChartContextPtr,dataset=this.mDatasetPtr,gmCtx=this.mChartContextPtr.GetGraphMatrixContext(),isGM=chartCtx.mIsGraphMatrix,smartLabelCollections,dataLabelCollections,markerRectSet,labelRectSet,value,size,i,labelList,dataLabel,dataLabelManager,chartFrame;var isDataLabelEnabled=dataset.showDatalabels();if(isGM&&isDataLabelEnabled){dataLabelManager=this.dataLabelManager;if(dataLabelManager===null||dataLabelManager===undefined){chartFrame=new $C.Rect2D({x:0,y:0,width:chartCtx.mGraphWidth,height:chartCtx.mGraphHeight});dataLabelManager=this.dataLabelManager=new $C.DataLabelManager({DataArea:chartFrame});dataLabelManager.ChartContext=chartCtx;}if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShape2DPie||gmCtx.mMarkerShape===$MS.DssGraphMarkerShape2DRingPie){this.mPieRenderer.enableDataLabel(dataLabelManager,this.shownDataLabels);labelList=this.mPieRenderer.dataLabels;size=labelList.length;for(i=0;i<size;++i){dataLabel=labelList[i].Label;if(dataLabel.mIsShown){this.AddToMapAndList(dataLabel);}}}else{dataLabelCollections=[];hCreateDataLabelCollection.call(this,dataLabelCollections);hInitDataLabels.call(this,vecMarkerRectangle,dataLabelCollections);hPrepareDataLabelPositions.call(this);dataLabelManager=hInitDataLabelManager.call(this);dataLabelManager.PlaceDataLabels(this.mDataLabels,this.shownDataLabels);}}else{if(this.isSmarted){smartLabelCollections=[];markerRectSet=[];labelRectSet=[];value=hGetMarkerRectSet.call(this,vecMarkerRectangle);if(value){markerRectSet=value;}hCreateSmartLabelCollection.call(this,smartLabelCollections);hInitLabelMatrix.call(this,vecMarkerRectangle,smartLabelCollections);var dataLabelLineCollectionId=new $C.TripleId({ObjectId:$GO.DssGraphDataTextConnectLine,SeriesId:this.TripleId.mSeriesId,GroupId:this.TripleId.mGroupId}),dataLabelLines=new $C.GraphCollectionObject({TripleId:dataLabelLineCollectionId,GraphObjectManager:this,CollectionType:$CT.CT_LINE});var totalLabel=this.labelMatrix.length,numLabelsHandled=hGreedyPlacer.call(this,markerRectSet,labelRectSet,dataLabelLines);if(numLabelsHandled===totalLabel){return ;}if(numLabelsHandled===0){isSmartPossible=false;}else{var unitRect=new $C.Rect2D(),gridMap,isSufficientSpace;hGetSuggestedSliceUnit.call(this,unitRect);gridMap=new $C.GridMap({Rect:this.mDataArea,Unit:unitRect,dataLabelPadding:5});isSufficientSpace=hInitGridMapOccupation.call(this,gridMap);if(isSufficientSpace){var comparisonOfLabelInfo=function comparisonOfLabelInfo(First,Second){return First.HostMarker.x-Second.HostMarker.x;};this.labelMatrix.sort(comparisonOfLabelInfo);hPlaceLeftOversIntoFreeSpace.call(this,gridMap,dataLabelLines);}else{hPlaceLeftOvers.call(this,dataLabelLines);}}if(dataLabelLines.GetCollectionSize()){this.AddToMap(dataLabelLines);}if(!this.isSmarted){if(this.isSmarted){this.mPostTrendLineObjects.splice(0,this.mPostTrendLineObjects.length);}if(!this.dataLabelLine){hGenerateDatalabels.call(this,vecMarkerRectangle);}else{dataLabelLines=new $C.GraphCollectionObject({TripleId:dataLabelLineCollectionId,GraphObjectManager:this,CollectionType:$CT.CT_LINE});hGenerateDatalabels.call(this,vecMarkerRectangle,dataLabelLines);if(dataLabelLines.GetCollectionSize()>0){this.AddToMap(dataLabelLines);}}}}}}function hRenderCustomLine(){var chartCtx=this.mChartContextPtr,dataArea=this.mDataArea,objects=this.mPostTrendLineObjects;if(chartCtx.mIsGraphMatrix){objects=[];}this.y1Axis.GenerateCustomLine(dataArea,objects);if(this.mChartContextPtr.IsDualAxis()){this.y2Axis.GenerateCustomLine(dataArea,objects);}this.xAxis.GenerateCustomLine(dataArea,objects);if(chartCtx.mIsGraphMatrix&&objects.length){this.mGraphObjectList=objects.concat(this.mGraphObjectList);}}function hAxisOriginLineEnabled(axis){var chartCtx=this.mChartContextPtr,drawingAreaHeight=chartCtx.mGraphHeight,drawingAreaWidth=chartCtx.mGraphWidth,axisOptions,axisOriginValue,isVertical,position;if(axis===undefined||axis===null){return false;}axisOptions=axis.mOptions;axisOriginValue=axisOptions.mAxisCustomValue;isVertical=axis.IsVerticalAxis();position=axis.ValueToPosition(axisOriginValue);if(!axisOptions.mDrawCustomLine){return false;}if(axisOriginValue>axis.mMaxTick||axisOriginValue<axis.mMinTick){return false;}if(position===0){return false;}if(isVertical){if(position===drawingAreaHeight){return false;}}else{if(position===drawingAreaWidth){return false;}}return true;}function hGetAxisOriginLabelRectInfo(position,height,width,valuePosition,drawingAreaHeight,drawingAreaWidth,labelPadding,axis){var retVal={},halfHeight=height/2,halfWidth=width/2,isVertical=axis.IsVerticalAxis(),axisLocation;if(axis.mTripleId.mObjectId===$GO.DssGraphY2Body){axisLocation=k_y2;}else{if(axis.mTripleId.mObjectId===$GO.DssGraphX2Body){axisLocation=k_x2;}else{axisLocation=isVertical?k_y1:k_x1;}}retVal.rect=new $C.Rect2D({x:0,y:0,width:width+2*labelPadding,height:height+2*labelPadding});switch(position){case 0:switch(axisLocation){case k_y1:retVal.xOffset=labelPadding+halfWidth;retVal.yOffset=valuePosition-labelPadding-halfHeight;retVal.rect.y=valuePosition-2*labelPadding-height;retVal.rect.x=0;break;case k_x1:retVal.xOffset=valuePosition-labelPadding-halfWidth;retVal.yOffset=drawingAreaHeight-labelPadding-halfHeight;retVal.rect.y=drawingAreaHeight-2*labelPadding-height;retVal.rect.x=valuePosition-2*labelPadding-width;break;case k_y2:retVal.xOffset=drawingAreaWidth-labelPadding-halfWidth;retVal.yOffset=valuePosition-labelPadding-halfHeight;retVal.rect.y=valuePosition-2*labelPadding-height;retVal.rect.x=drawingAreaWidth-2*labelPadding-width;break;case k_x2:retVal.xOffset=valuePosition-labelPadding-halfWidth;retVal.yOffset=labelPadding+halfHeight;retVal.rect.y=0;retVal.rect.x=valuePosition-2*labelPadding-width;break;}break;case 1:switch(axisLocation){case k_y1:retVal.xOffset=labelPadding+halfWidth;retVal.yOffset=valuePosition+labelPadding+halfHeight;retVal.rect.y=valuePosition;retVal.rect.x=0;break;case k_x1:retVal.xOffset=valuePosition+labelPadding+halfWidth;retVal.yOffset=drawingAreaHeight-labelPadding-halfHeight;retVal.rect.y=drawingAreaHeight-2*labelPadding-height;retVal.rect.x=valuePosition;break;case k_y2:retVal.xOffset=drawingAreaWidth-labelPadding-halfWidth;retVal.yOffset=valuePosition+labelPadding+halfHeight;retVal.rect.y=valuePosition;retVal.rect.x=drawingAreaWidth-2*labelPadding-width;break;case k_x2:retVal.xOffset=valuePosition+labelPadding+halfWidth;retVal.yOffset=labelPadding+halfHeight;retVal.rect.y=0;retVal.rect.x=valuePosition;break;}break;}return retVal;}function hCheckAxisOriginLabelCandidate(labelCandidate,drawingAreaHeight,drawingAreaWidth,dataLabels,refLabels,axisOriginLabels){var rect=labelCandidate.rect,len,i,checkRect,currentDataLabel;if(rect.y<0||rect.y+rect.height>drawingAreaHeight){return false;}if(rect.x<0||rect.x+rect.width>drawingAreaWidth){return false;}len=axisOriginLabels.length;for(i=0;i<len;++i){checkRect=axisOriginLabels[i].GetBoundingRect(true);if(rect.HasIntersection(checkRect)){return false;}}len=refLabels.length;for(i=0;i<len;++i){checkRect=refLabels[i].GetBoundingRect(true);if(rect.HasIntersection(checkRect)){return false;}}len=dataLabels.length;for(i=0;i<len;++i){currentDataLabel=dataLabels[i];if(currentDataLabel.mIsShown){checkRect=currentDataLabel.GetBoundingRect(true);if(rect.HasIntersection(checkRect)){return false;}}}return true;}function hGenerateSimpleLabel(axis){var chartCtx=this.mChartContextPtr,drawingAreaWidth=chartCtx.mGraphWidth,drawingAreaHeight=chartCtx.mGraphHeight,gmCtx=chartCtx.mpGraphMatrixContext,axisOriginValue=axis.mOptions.mAxisCustomValue,savedInRow=axis.Key==="Y1"||axis.Key==="Y2",backupTicks=this.mDatasetPtr.fetchShownLabels(savedInRow),ticks=backupTicks&&backupTicks[axis.Key],numberOfTicks=ticks&&ticks.length,tickValue,matchTick=false,i,numberObject,valueStr,label,tripleId,textRect,height,width,position,labelValid,axisOriginLabelCandidate,positionInfo,labelPadding=gmCtx.getPadding($K.kAxisOriginLabel);tripleId=$C.gAxisObjects[axis.getIndex()].mCustomLabelId;for(i=0;i<numberOfTicks&&!matchTick;++i){tickValue=ticks[i];if(tickValue===axisOriginValue){matchTick=true;}}if(matchTick){return ;}numberObject=new $C.NumberObject({TripleId:tripleId,GraphObjectManager:this,Number:axisOriginValue,NumberFormat:axis.mNumberFormat,GraphCollectionObject:null,Locale:0,clientDrag:false,DataSet:null,IsFinal:false,ColumnOffset:0,ShouldCondense:axis.mCondenseLabels});if(numberObject===null||numberObject===undefined){return ;}label=numberObject;valueStr=numberObject.mText;label.SetText(valueStr);textRect=label.GetBoundingRect(true);height=textRect.height;width=textRect.width;position=axis.ValueToPosition(axisOriginValue);labelValid=false;for(i=0;i<=1&&!labelValid;++i){axisOriginLabelCandidate={};positionInfo=hGetAxisOriginLabelRectInfo.call(this,i,height,width,position,drawingAreaHeight,drawingAreaWidth,labelPadding,axis);axisOriginLabelCandidate.xOffset=positionInfo.xOffset;axisOriginLabelCandidate.yOffset=positionInfo.yOffset;axisOriginLabelCandidate.rect=positionInfo.rect;labelValid=hCheckAxisOriginLabelCandidate.call(this,axisOriginLabelCandidate,drawingAreaHeight,drawingAreaWidth,this.shownDataLabels,this.shownRefLabels,this.axisOriginLabels);}if(labelValid){label.MoveTo(axisOriginLabelCandidate.xOffset,axisOriginLabelCandidate.yOffset,$AP.CENTER);label.mIsShown=true;this.mPostTrendLineObjects.push(label);this.axisOriginLabels.push(label);}}function hGetQuadLabelRectInfo(position,height,width,xPosition,yPosition,labelPadding){var retVal={},halfHeight=height/2,halfWidth=width/2;retVal.rect=new $C.Rect2D({x:0,y:0,width:width+2*labelPadding,height:height+2*labelPadding});switch(position){case 0:retVal.xOffset=xPosition+labelPadding+halfWidth;retVal.yOffset=yPosition-labelPadding-halfHeight;retVal.rect.x=xPosition;retVal.rect.y=yPosition-2*labelPadding-height;break;case 1:retVal.xOffset=xPosition-labelPadding-halfWidth;retVal.yOffset=yPosition-labelPadding-halfHeight;retVal.rect.x=xPosition-2*labelPadding-width;retVal.rect.y=yPosition-2*labelPadding-height;break;case 2:retVal.xOffset=xPosition-labelPadding-halfWidth;retVal.yOffset=yPosition+labelPadding+halfHeight;retVal.rect.x=xPosition-2*labelPadding-width;retVal.rect.y=yPosition;break;case 3:retVal.xOffset=xPosition+labelPadding+halfWidth;retVal.yOffset=yPosition+labelPadding+halfHeight;retVal.rect.x=xPosition;retVal.rect.y=yPosition;break;}return retVal;}function hGenerateQuadLabel(drawY1){var chartCtx=this.mChartContextPtr,drawingAreaWidth=chartCtx.mGraphWidth,drawingAreaHeight=chartCtx.mGraphHeight,gmCtx=chartCtx.mpGraphMatrixContext,yAxis,yAxisOriginValue,yPosition,yNumber,xAxis,xAxisOriginValue,xPosition,xNumber,tripleId,valueStr,label,textRect,height,width,labelValid,labelCandidate,positionInfo,i,labelPadding=gmCtx.getPadding($K.kAxisOriginLabel);xAxis=this.xAxis;tripleId=$C.gAxisObjects[xAxis.getIndex()].mCustomLabelId;yAxis=drawY1?this.y1Axis:this.y2Axis;yAxisOriginValue=yAxis.mOptions.mAxisCustomValue;yPosition=yAxis.ValueToPosition(yAxisOriginValue);yNumber=new $C.NumberObject({TripleId:tripleId,GraphObjectManager:this,Number:yAxisOriginValue,NumberFormat:yAxis.mNumberFormat,GraphCollectionObject:null,Locale:0,clientDrag:false,DataSet:null,IsFinal:false,ColumnOffset:0,ShouldCondense:xAxis.mCondenseLabels});xAxisOriginValue=xAxis.mOptions.mAxisCustomValue;xPosition=xAxis.ValueToPosition(xAxisOriginValue);xNumber=new $C.NumberObject({TripleId:tripleId,GraphObjectManager:this,Number:xAxisOriginValue,NumberFormat:xAxis.mNumberFormat,GraphCollectionObject:null,Locale:0,clientDrag:false,DataSet:null,IsFinal:false,ColumnOffset:0,ShouldCondense:xAxis.mCondenseLabels});valueStr="("+xNumber.mText+", "+yNumber.mText+")";label=new $C.TextObject({TripleId:tripleId,GraphObjectManager:this,GraphCollectionObject:null});label.SetText(valueStr);textRect=label.GetBoundingRect(true);height=textRect.height;width=textRect.width;labelValid=false;for(i=0;i<4&&!labelValid;++i){labelCandidate={};positionInfo=hGetQuadLabelRectInfo.call(this,i,height,width,xPosition,yPosition,labelPadding);labelCandidate.xOffset=positionInfo.xOffset;labelCandidate.yOffset=positionInfo.yOffset;labelCandidate.rect=positionInfo.rect;labelValid=hCheckAxisOriginLabelCandidate.call(this,labelCandidate,drawingAreaHeight,drawingAreaWidth,this.shownDataLabels,this.shownRefLabels,this.axisOriginLabels);}if(labelValid){label.MoveTo(labelCandidate.xOffset,labelCandidate.yOffset,$AP.CENTER);label.mIsShown=true;this.mPostTrendLineObjects.push(label);this.axisOriginLabels.push(label);}}function hGenerateAxisOriginLabel(){var drawQuadrants=0,drawY1,drawY2,drawX;drawY1=hAxisOriginLineEnabled.call(this,this.y1Axis);drawY2=hAxisOriginLineEnabled.call(this,this.y2Axis);drawX=hAxisOriginLineEnabled.call(this,this.xAxis);if((drawY1||drawY2)&&drawX){drawQuadrants=true;}if(drawQuadrants){hGenerateQuadLabel.call(this,drawY1);}else{if(drawY1){hGenerateSimpleLabel.call(this,this.y1Axis);}if(drawY2){hGenerateSimpleLabel.call(this,this.y2Axis);}if(drawX){hGenerateSimpleLabel.call(this,this.xAxis);}}}function hGenerateMarkersForOneDataPoint(shapeInfo,ipCollection){var chartContext=this.mChartContextPtr,oneMarker=null,oneCollection,pieCount,onePieSliceList,i,markerId=shapeInfo.Id,markerShape=shapeInfo.MarkerType,shape=shapeInfo.Shape,markerPosition=shapeInfo.Position,markerSize=shapeInfo.Size,graphObjectsInOneDataPoint=[];if(chartContext.mIsGraphMatrix){var rect=shapeInfo.BoundingBox;if(hCanSkip.call(this,shapeInfo)){if(this.waitingList===null){this.waitingList=[];}this.waitingList.push(shapeInfo);return[];}oneCollection=null;switch(markerShape){case $MS.DssGraphMarkerShapeGMTick:var points=chartContext.transformRectToTicker(rect,true);if(points.length>=2){oneMarker=new $C.StraightLineObject({TripleId:markerId,GraphObjectManager:this,StartPoint:points[0],EndPoint:points[1],GraphCollectionObject:null,Shape:$SHP._TICKER});}else{return[];}break;case $MS.DssGraphMarkerShape2DPie:case $MS.DssGraphMarkerShape2DRingPie:var layout=0;if(markerShape===$MS.DssGraphMarkerShape2DRingPie){layout=1;}if(this.mPieRenderer===null||this.mPieRenderer===undefined){this.mPieRenderer=new $C.PiePlotRenderer({GraphObjectManager:this,Dataset:this.mDatasetPtr,ChartContext:chartContext,Layout:layout,PlotType:$GMPPT.GMPPT_VALUE,ShownDataLabels:this.shownDataLabels});}pieCount=this.mDatasetPtr.GetPieCountAtOneDataPoint(markerId.mSeriesId,markerId.mGroupId);for(i=0;i<pieCount;++i){onePieSliceList=this.mPieRenderer.drawSinglePie(markerId.mSeriesId,markerId.mGroupId,i,markerPosition,pieCount);graphObjectsInOneDataPoint=graphObjectsInOneDataPoint.concat(onePieSliceList);}break;case $MS.DssGraphMarkerShapeSquare:case $MS.DssGraphMarkerShapeRectangle:oneMarker=new $C.RectangleObject({TripleId:markerId,GraphObjectManager:this,GraphCollectionObject:null,Area:rect,Shape:shape});break;default:oneMarker=new $C.MarkerObject({TripleId:markerId,GraphObjectManager:this,MarkerPosition:markerPosition,MarkerShape:markerShape,IsIsometric:true,MarkerSize:markerSize,GraphCollectionObject:oneCollection,IsDialogSize:false,Shape:shape});break;}}else{oneMarker=new $C.MarkerObject({TripleId:markerId,GraphObjectManager:this,MarkerPosition:markerPosition,MarkerShape:markerShape,IsIsometric:true,MarkerSize:markerSize,GraphCollectionObject:ipCollection,IsDialogSize:!this.isBubbleChart});}if(oneMarker!==null&&oneMarker!==undefined){graphObjectsInOneDataPoint.push(oneMarker);this.AddToMap(oneMarker);if(ipCollection){ipCollection.AddGraphObject(oneMarker);}}return graphObjectsInOneDataPoint;}function hGenerateMarkers(rectMatrix,coordPoints,markerSizes,seriesIndex,collection){var markerShape=this.VecSeriesInfo[seriesIndex].MarkerShape,cordIndex=0,nullDataSize=this.VecSeriesInfo[seriesIndex].IsNullData.length,localCol,i,j,shapeInfo,sdMarkerSize,tempCol,markerId,markerObjects,boundingRect,tripleId;tripleId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:this.VecSeriesInfo[seriesIndex].SeriesID});localCol=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_GENERAL_SHAPE});for(i=0;i<nullDataSize;++i){if(this.VecSeriesInfo[seriesIndex].IsNullData[i]){continue;}sdMarkerSize=markerSizes[cordIndex];tempCol=this.isBubbleChart?collection:localCol;markerId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:this.VecSeriesInfo[seriesIndex].SeriesID,GroupId:i});shapeInfo={MarkerShape:markerShape,Size:sdMarkerSize,Position:coordPoints,Id:markerId,MarkerType:this.VecSeriesInfo[seriesIndex].MarkerShape};markerObjects=hGenerateMarkersForOneDataPoint.call(this,shapeInfo,collection);if(markerObjects.length>0){for(j=0;j<markerObjects.length;++j){this.mGraphObjectList.push(markerObjects[j]);this.AddToMap(markerObjects[j]);tempCol.AddGraphObject(markerObjects[j]);boundingRect=markerObjects[j].GetBoundingRect();rectMatrix[seriesIndex].push(boundingRect);}}}if(!this.isBubbleChart){this.AddToMap(localCol);}}function hCreateConnectionPolyLine(CoordPoints,SeriesIndex,Collection){var Parent,connectDataPoint,TripleId;if(CoordPoints.length===0){return ;}if(this.VecSeriesInfo[SeriesIndex].ConnectDataPoint){Parent=this.isBubbleChart?null:Collection;TripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataLine,SeriesId:this.VecSeriesInfo[SeriesIndex].mSeriesId,GroupId:$NGID});connectDataPoint=new $C.PolyLineObject({TripleId:TripleId,GraphObjectManager:this,PolyLine:CoordPoints,Parent:Parent});this.mGraphObjectList.push(connectDataPoint);this.AddToMap(connectDataPoint);if(!this.isBubbleChart){Collection.AddGraphObject(connectDataPoint);}}}function hRenderOOTBShapes(collections,vecMarkerRectangle){hGenerateCollection.call(this,collections);var i,j,seriesInfos=this.VecSeriesInfo,seriesNumber=seriesInfos.length,groupCount=this.mDatasetPtr.GetGroupCount(),isShown,position,markerSize,seriesCoord,seriesSize,isSmartPossible=false;for(i=0;i<seriesNumber;++i){seriesCoord=[];seriesSize=[];var showDataLabel=seriesInfos[i].ShowDataLabel;isSmartPossible=isSmartPossible||showDataLabel;for(j=0;j<groupCount;++j){position=new $C.Point2D();isShown=hGetMarkerPosition.call(this,i,j,position);this.VecSeriesInfo[i].IsNullData.push(!isShown);if(!isShown){continue;}markerSize=hGetMarkerSize.call(this,i,j);if(markerSize===undefined){continue;}seriesCoord.push(position);seriesSize.push(markerSize);}hCreateConnectionPolyLine.call(this,seriesCoord,i,collections[i]);hGenerateMarkers.call(this,vecMarkerRectangle,seriesCoord,seriesSize,i,collections[i]);}return{IsLabelPossible:isSmartPossible,MarkerRectangles:vecMarkerRectangle};}function hRenderShapes(vecMarkerRectangle){var i,j,seriesInfos=this.VecSeriesInfo,seriesNumber=seriesInfos.length,groupCount=this.mDatasetPtr.GetGroupCount(),isShown,position,markerSize,objectList=this.mGraphObjectList,checkSizeSort=this.drawBySize,shapeInfos=[],isSmartPossible=false,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),markerShape=gmCtx.mMarkerShape,isPieShape=markerShape===$MS.DssGraphMarkerShape2DPie||markerShape===$MS.DssGraphMarkerShape2DRingPie,checkSkip=chartCtx.mPartialRendering,shapeElements=[],ComparisonOfMarkerSize=function ComparisonOfMarkerSize(a,b){if(a.Size<b.Size){return 1;}if(a.Size>b.Size){return -1;}return 0;};for(i=0;i<seriesNumber;++i){var showDataLabel=seriesInfos[i].ShowDataLabel;isSmartPossible=isSmartPossible||showDataLabel;for(j=0;j<groupCount;++j){position=new $C.Point2D();isShown=hGetMarkerPosition.call(this,i,j,position);seriesInfos[i].IsNullData.push(!isShown);if(!isShown){continue;}markerSize=hGetMarkerSize.call(this,i,j);if(markerSize===undefined){continue;}var markerId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:seriesInfos[i].SeriesID,GroupId:j});if(chartCtx.checkColorByAndSizeByValue(markerId,this.mDatasetPtr,this.mHasColorBy&&!isPieShape,this.mHasSizeBy)===false){seriesInfos[i].IsNullData[seriesInfos[i].IsNullData.length-1]=true;continue;}var shapeInfo=hGetShapeInfo.call(this,markerShape,position,markerSize);shapeInfo.Id=markerId;shapeInfo.Position=position;shapeInfo.Size=markerSize;shapeInfo.MarkerType=seriesInfos[i].MarkerShape;shapeInfos.push(shapeInfo);++this.DPCount;if(this.seriesDPCount[i]===undefined||this.seriesDPCount[i]===null){this.seriesDPCount[i]=1;}else{++this.seriesDPCount[i];}}}if(checkSizeSort||checkSkip){shapeInfos.sort(ComparisonOfMarkerSize);if(checkSkip){shapeInfos.reverse();}}var k;for(i=0;i<shapeInfos.length;i++){var markerObjects=hGenerateMarkersForOneDataPoint.call(this,shapeInfos[i],null);for(k=0;k<markerObjects.length;++k){var info=shapeInfos[i],index=info.Id.mSeriesId,group=info.Id.mGroupId;markerShape=info.MarkerType;var isPie=markerShape===$MS.DssGraphMarkerShape2DPie||markerShape===$MS.DssGraphMarkerShape2DRingPie;vecMarkerRectangle[index][group]=info.BoundingBox;if(isPie){this.AddToMap(markerObjects[k]);}shapeElements.push(markerObjects[k]);}}if(checkSkip){shapeElements.reverse();this.shapeCanvas=null;}for(i=0;i<shapeElements.length;i++){objectList.push(shapeElements[i]);}return{IsLabelPossible:isSmartPossible,MarkerRectangles:vecMarkerRectangle};}function hGetAdjustedMarkerRadius(iDataArea,iXUnitCount,iYUnitCount,iIsGeneric){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),space,X,Y;if(chartCtx.mIsGraphMatrix&&!iIsGeneric){gmCtx=chartCtx.GetGraphMatrixContext();if(gmCtx.isPieOrRingShape()){space=gmCtx.GetMaxMarkerSize($GM_MarkerStyle._PIE,true,1,this.isBubbleChart);}else{if(gmCtx.mMarkerShape===$MS.DssGraphMarkerShapeGMTick){space=gmCtx.GetMaxMarkerSize($GM_MarkerStyle._TICK_VALUE,true,this.isBubbleChart);}else{space=gmCtx.GetMaxMarkerSize($GM_MarkerStyle._SHAPES_IN_BUBBLESCATTER,false,0,this.isBubbleChart);}}return Math.round(space);}X=iDataArea.width;Y=iDataArea.height;return Math.round(Math.min(X/iXUnitCount+0.5,Y/iYUnitCount+0.5)*0.5);}function hCalculateMaxRadiusForShape(){var xUnit,yUnit,groupCount=this.mDatasetPtr.GetSeriesCount(),seriesCount=this.mDatasetPtr.GetGroupCount(),size;if(this.mDatasetPtr.GetSeriesByColumn()){xUnit=seriesCount;yUnit=groupCount;}else{yUnit=seriesCount;xUnit=groupCount;}if(xUnit*yUnit===0){return 0;}size=hGetAdjustedMarkerRadius.call(this,this.mDataArea,xUnit,yUnit,false);if(size<3){size=3;}return size;}mstrmojo.chart.ValuePlot=mstrmojo.declare(mstrmojo.chart.Plot,null,{scriptClass:"mstrmojo.chart.ValuePlot",dataLabelLine:false,isBubbleChart:false,isSmarted:false,maxUnitRadius:-1,maxRadius:-10,minRadius:10000,labelFormat:$DTS.DssGraphDataTextSeriesDependent|$DTS.DssGraphDataTextLabel,labelLocation:$DTP.DssGraphDTPositionCenter,xAxis:null,y1Axis:null,y2Axis:null,zAxis:null,VecSeriesInfo:[],standAloneMarkers:[],labelMatrix:[],drawBySize:false,mPieRenderer:null,mDataLabels:[],mTrendLineObjects:null,mReferenceLineObjects:null,waitingList:null,shapeCanvas:null,viewPort:null,init:function init(props){var chartContext;this._super(props);chartContext=this.mChartContextPtr;this.xAxis=null;this.y1Axis=null;this.y2Axis=null;this.zAxis=null;this.VecSeriesInfo=[];this.standAloneMarkers=[];this.labelMatrix=[];this.isBubbleChart=(chartContext.GetGraphMajorType()===$GMT.GMT_BUBBLE);this.drawBySize=this.isBubbleChart&&this.mChartContextPtr.mIsGraphMatrix;this.mDataLabels=[];},OnRectangleSelection:function OnRectangleSelection(rect,selectedObjects,type){type=type||0;var chartCtx=this.mChartContextPtr;if(type===0&&this.waitingList){var wl=this.waitingList,len=wl.length,i,x,y,identity,id,shapeType=(wl[0].Shape===$SHP._PIE)?"pie":"shape";for(i=0;i<len;i++){x=wl[i].Position.x;y=wl[i].Position.y;if((x>=rect.x&&x<=rect.x+rect.width)&&(y>=rect.y&&y<=rect.y+rect.height)){id=wl[i].Id;identity=chartCtx.getIdentity(id,shapeType);selectedObjects.push(identity);}}}},GenerateMapAndList:function GenerateMapAndList(){var vecMarkerRectangle,collections=[],i,isSmartPossible,chartCtx=this.mChartContextPtr,isGraphMatrix=chartCtx.mIsGraphMatrix,seriesNumber=this.VecSeriesInfo.length;this.maxUnitRadius=hCalculateMaxRadiusForShape.call(this);vecMarkerRectangle=[];for(i=0;i<seriesNumber;++i){vecMarkerRectangle.push([]);}if(chartCtx.mImageUsage!==$IMG_USAGE.GENERAL){return ;}var resultVal;if(isGraphMatrix){resultVal=hRenderShapes.call(this,vecMarkerRectangle);}else{resultVal=hRenderOOTBShapes.call(this,collections,vecMarkerRectangle);}vecMarkerRectangle=resultVal.MarkerRectangles;isSmartPossible=resultVal.IsLabelPossible;hRenderDataLabels.call(this,vecMarkerRectangle,isSmartPossible);hGenerateTrendLine.call(this);hGenerateRefLine.call(this);hRenderCustomLine.call(this);hGenerateAxisOriginLabel.call(this);},Draw:function Draw(){var checkSizeSort=this.drawBySize,chartCtx=this.mChartContextPtr,seriesNumber=this.VecSeriesInfo.length;if(checkSizeSort){var order=[],i;for(i=0;i<seriesNumber;i++){order[i]=0;}chartCtx.setDrawingOrderToCanvas(order);}$C.GraphObjectManager.prototype.Draw.apply(this,[]);hDrawTrendLine.call(this);hDrawRefLine.call(this);this.DrawPostTrendLineObjects();},AssignValueAxis:function AssignValueAxis(ValueAxis,Index){switch(Index){case 0:this.xAxis=ValueAxis;break;case 1:this.y1Axis=ValueAxis;break;case 2:this.y2Axis=ValueAxis;break;case 3:this.zAxis=ValueAxis;break;default:break;}},AssignSeriesInfo:function AssignSeriesInfo(SeriesIndex,VecSeriesVAIndex){var size=SeriesIndex.length,tempSeriesIndex,tempSeriesInfo,i;for(i=0;i<size;++i){tempSeriesInfo=newScatterSeriesInfo.call(this);this.VecSeriesInfo.push(tempSeriesInfo);tempSeriesIndex=SeriesIndex[i];this.VecSeriesInfo[i].SeriesID=tempSeriesIndex;this.VecSeriesInfo[i].ValueAxisIndex=VecSeriesVAIndex[tempSeriesIndex];}this.LoadProperties();},GetMaxElementRadius:function GetMaxElementRadius(){var tripleId=new $C.TripleId(),value=this.mChartContextPtr.GetProperty($EGP.DssGraphMatrixUsePerfectPadding,tripleId);if(value===null||value===undefined){return 0;}return this.maxUnitRadius;},GetMaxElementOffsetClippedByBoundary:function GetMaxElementOffsetClippedByBoundary(iIsOnXAxis,isPrimary){var retVal={LowOffset:0,HighOffset:0},chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),theXAxis,theYAxis,XminMax,YminMax,lowBoundaryX,lowBoundaryY,highBoundaryX,highBoundaryY,seriesCount,groupCount,i,j,isShown,markerSize;if(isPrimary===undefined){isPrimary=true;}if(!chartCtx.mIsGraphMatrix){return retVal;}var clippedMarkerKey=iIsOnXAxis?(isPrimary?"X1":"X2"):(isPrimary?"Y1":"Y2"),clippedSizes=this.mClippedElementSize;if(clippedSizes[clippedMarkerKey]!==undefined){return clippedSizes[clippedMarkerKey];}if(this.maxUnitRadius<0){this.maxUnitRadius=hCalculateMaxRadiusForShape.call(this);}seriesCount=this.mDatasetPtr.GetSeriesCount();groupCount=this.mDatasetPtr.GetGroupCount();var retValX={LowOffset:0,HighOffset:0};var retValY={LowOffset:0,HighOffset:0};for(i=0;i<seriesCount;++i){for(j=0;j<groupCount;++j){perfShapePosition.Reset(0,0);isShown=hGetMarkerPosition.call(this,i,j,perfShapePosition);if(!isShown){continue;}markerSize=hGetMarkerSize.call(this,i,j);if(markerSize===undefined){continue;}var lowOffsetX=0,highOffsetX=0;var lowOffsetY=0,highOffsetY=0;retVal={LowOffset:0,HighOffset:0};theXAxis=this.xAxis;theYAxis=this.y1Axis;if(theXAxis===null||theYAxis===null){clippedSizes[clippedMarkerKey]=retVal;return ;}XminMax=theXAxis.GetMaxMinDataInput();YminMax=theYAxis.GetMaxMinDataInput();lowBoundaryX=theXAxis.GetPositionByValue(XminMax.Min);lowBoundaryY=theYAxis.GetPositionByValue(YminMax.Min);if(lowBoundaryX===null||lowBoundaryY===null){clippedSizes[clippedMarkerKey]=retVal;return ;}highBoundaryX=theXAxis.GetPositionByValue(XminMax.Max);highBoundaryY=theYAxis.GetPositionByValue(YminMax.Max);if(highBoundaryX===null||highBoundaryY===null){clippedSizes[clippedMarkerKey]=retVal;return ;}lowOffsetX=retValX.LowOffset;highOffsetX=retValX.HighOffset;retValX=gmCtx.getClippedOffset(lowBoundaryX,highBoundaryX,markerSize,perfShapePosition,true,lowOffsetX,highOffsetX);lowOffsetX=Math.max(retValX.LowOffset,lowOffsetX);highOffsetX=Math.max(retValX.HighOffset,highOffsetX);clippedSizes.X1=retValX;lowOffsetY=retValY.LowOffset;highOffsetY=retValY.HighOffset;retValY=gmCtx.getClippedOffset(lowBoundaryY,highBoundaryY,markerSize,perfShapePosition,false,lowOffsetY,highOffsetY);lowOffsetY=Math.max(retValY.LowOffset,lowOffsetY);highOffsetY=Math.max(retValY.HighOffset,highOffsetY);clippedSizes.Y1=retValY;}}if(clippedSizes.X1){clippedSizes.X2=mstrmojo.hash.copy(clippedSizes.X1);}else{clippedSizes.X1=clippedSizes.X2={LowOffset:0,HighOffset:0};}if(clippedSizes.Y1){clippedSizes.Y2=mstrmojo.hash.copy(clippedSizes.Y1);}else{clippedSizes.Y1=clippedSizes.Y2={LowOffset:0,HighOffset:0};}return clippedSizes[clippedMarkerKey];},refresh:function refresh(purpose,props){if(purpose==="clipping"){this.mDataArea.width=this.mChartContextPtr.mGraphWidth;this.mDataArea.height=this.mChartContextPtr.mGraphHeight;this.maxUnitRadius=-1;this.mClippedElementSize={};}else{}},LoadProperties:function LoadProperties(){var Series,value,Id,ConnectLineProperty=this.isBubbleChart?$GP.DssGraphShowSDLine:$GP.DssGraphShowLine,i,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),isGM=chartCtx.mIsGraphMatrix;for(i=0;i<this.VecSeriesInfo.length;++i){Series=this.VecSeriesInfo[i];Id=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:Series.SeriesID});if(isGM){Series.MarkerShape=gmCtx.mMarkerShape;}else{value=chartCtx.GetProperty($GP.DssGraphSDMarkerShape,Id);if(value){Series.MarkerShape=value;}else{Series.MarkerShape=$MS.DssGraphMarkerShapeCircle;}}switch(Series.MarkerShape){case $MS.DssGraphMarkerShapeCircle:case $MS.DssGraphMarkerShapeRectangle:case $MS.DssGraphMarkerShapeSquare:case $MS.DssGraphMarkerShape2DPie:case $MS.DssGraphMarkerShape2DRingPie:break;default:this.drawBySize=false;break;}if(chartCtx.mImageUsage!==0){return ;}value=chartCtx.GetProperty(ConnectLineProperty,Id);if(value){Series.ConnectDataPoint=value;}value=chartCtx.GetProperty($GP.DssGraphSDShowDataText,Id);if(value){Series.ShowDataLabel=value;}if(isGM){Series.ShowDataLabel=this.mDatasetPtr.showSeriesDatalabel(Id.mSeriesId);}this.LoadTrendLineProperties(this.VecSeriesInfo[i].SeriesID,Series.TrendLineOptions);}value=chartCtx.GetProperty($GP.DssGraphNewUseSmartLabels,$NTID);if(value){this.isSmarted=value;}value=chartCtx.GetProperty($GP.DssGraphAxisDataTextPlace,$NTID);if(value){this.labelLocation=value;}value=chartCtx.GetProperty($GP.DssGraphShowDataText,$NTID);if(value){this.labelFormat=value;}}});}());