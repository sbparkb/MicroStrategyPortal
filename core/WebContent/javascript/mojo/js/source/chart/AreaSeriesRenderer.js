(function(){mstrmojo.requiresClsP("mstrmojo.chart","TripleId","Point2D","Vector2D","Polygon2D","SeriesRenderer","CategoryPlot","MarkerObject","NumberObject","Plot","ChartConstants","GraphObjectAggregation","DataLabelManager");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumCollectionType","EnumDSSExtraGraphObject","EnumMajorGraphType","EnumLayout","EnumValueAxis","EnumShowFace","EnumAttachedPointsStyle","EnumPictureFormatType","EnumImageUsage");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphObject","EnumShapeType","EnumDSSGraphFillEffect","EnumDSSGraphMarkerShape");var $C=mstrmojo.chart,$K=$C.ChartConstants,$CHART_ENUMS=mstrmojo.chart.enums,$APS=$CHART_ENUMS.EnumAttachedPointsStyle,$CT=$CHART_ENUMS.EnumCollectionType,$MAJOR_GRAPH_TYPE=$CHART_ENUMS.EnumMajorGraphType,$LAYOUT=$CHART_ENUMS.EnumLayout,$VA=$CHART_ENUMS.EnumValueAxis,$EGO=$CHART_ENUMS.EnumDSSExtraGraphObject,$IMG_USAGE=$CHART_ENUMS.EnumImageUsage,$PFT=$CHART_ENUMS.EnumPictureFormatType,$M=mstrmojo.chart.model,$MODEL_ENUMS=$M.enums,$GO=$MODEL_ENUMS.EnumDSSGraphObject,$MS=$MODEL_ENUMS.EnumDSSGraphMarkerShape,$SHP=$MODEL_ENUMS.EnumShapeType,$FE=$MODEL_ENUMS.EnumDSSGraphFillEffect,$NULL_GROUP_ID=$C.gNullGroupId;var perfVirtualMarkerRect=new $C.Rect2D(),perfTripleId=new $C.TripleId();var kNullPoint=new $C.Point2D();kNullPoint.Reset(-1,-1);kNullPoint.isNull=true;function hGenerateAreaCollections(){var collectionType,numberOfSeries,i,areaId,graphCollectionObject,areaCollection=this.mAreaCollection;areaCollection.splice(0,areaCollection.length);collectionType=this.mIsVertical?$CT.CT_VERTICAL_AREA:$CT.CT_HORIZONTAL_AREA;numberOfSeries=this.mSeriesInfo.length;for(i=0;i<numberOfSeries;++i){areaId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:this.mSeriesInfo[i].mSeriesId});graphCollectionObject=new $C.GraphCollectionObject({TripleId:areaId,GraphObjectManager:this,CollectionType:collectionType});areaCollection.push(graphCollectionObject);this.AddToMap(areaCollection[i]);this.AddLegendMarkerToCollection(i,areaCollection[i]);}}function hGenerateLabelsForSeries(seriesIndex){var seriesId,textCollection,labelId,polygon,i,textObject,groupCount;seriesId=this.mSeriesInfo[seriesIndex].mSeriesId;labelId=new $C.TripleId({ObjectId:$GO.DssGraphDataText,SeriesId:seriesId,GroupId:$NULL_GROUP_ID});textCollection=new $C.GraphCollectionObject({TripleId:labelId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});this.mTextCollection.push(textCollection);polygon=this.mFinalSeriesPolygons[seriesIndex];groupCount=this.mGroupCount;for(i=0;i<groupCount;++i){if(polygon[i].x!==-1){textObject=this.createRiserLabel(seriesIndex,i,textCollection);this.MoveLabel(i,textObject,polygon[i],polygon[2*this.mGroupCount-1-i],seriesIndex);}}}function hGenerateTotalLabelsByAxis(valueAxisIndex,totalCollection){var i,totalLabel,seriesIndex,polygon;for(i=0;i<this.mGroupCount;++i){totalLabel=this.CreateTotalLabel(valueAxisIndex,i,totalCollection);if(totalLabel!==null){seriesIndex=this.GetUpmostIndexByValueAxisAndGroup(valueAxisIndex,i);polygon=this.mFinalSeriesPolygons[seriesIndex];this.MoveLabel(i,totalLabel,polygon[i],polygon[2*this.mGroupCount-1-i],seriesIndex);}}}function hGenerateDataLabelsLegacy(){var numberOfSeries,i,tripleId,plotId,textCollection,ablPlotCtx=this.mpABLPlotContext,ablOptions=ablPlotCtx.mABLOptions;numberOfSeries=this.mSeriesInfo.length;for(i=0;i<numberOfSeries;++i){if(ablPlotCtx.mSeriesOptions[this.mSeriesInfo[i].mSeriesIndex].mShowDataLabels){hGenerateLabelsForSeries.call(this,i);}}if(ablOptions.mMajorGraphType===$MAJOR_GRAPH_TYPE.MGT_AREA&&ablOptions.mLayout===$LAYOUT.LO_STACKED&&!ablOptions.mShowCumulate&&ablOptions.mShowValue&&ablOptions.mShowTotal){plotId=this.mpManager.mTripleId;tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataTextStackTotal,SeriesId:plotId.mSeriesId,GroupId:$NULL_GROUP_ID});textCollection=new $C.GraphCollectionObject({TripleId:tripleId,GraphObjectManager:this,CollectionType:$CT.CT_TEXT});this.mTextCollection.push(textCollection);hGenerateTotalLabelsByAxis.call(this,$VA.VA_Y1,textCollection);if(ablOptions.mDualAxes){hGenerateTotalLabelsByAxis.call(this,$VA.VA_Y2,textCollection);}}}function hGenerateNaiveSideFaces(){}function hGetSeriesPolygonIndex(idx){var index=idx,layout=this.mpABLPlotContext.mABLOptions.mLayout,isGM=this.mChartContextPtr.mIsGraphMatrix;if(isGM&&(layout===$LAYOUT.LO_STACKED||layout===$LAYOUT.LO_PERCENT)){if(idx>=0&&idx<this.mSeriesDrawingOrder.length){index=this.mSeriesDrawingOrder[idx];}}return index;}function hPopulateGroupIdMapPerSeries(polygonUnit){var i=0,accumulatedIndex=0;this.mGroupIdMapPerSeries.splice(0,this.mGroupIdMapPerSeries.length);while(i<this.mGroupCount){if(polygonUnit[i].x===-1){++i;continue;}this.mGroupIdMapPerSeries[accumulatedIndex]=i;++i;accumulatedIndex++;}}function hPopulateGroupRangeListPerSeries(polygons){this.mGroupRangeList.splice(0,this.mGroupRangeList.length);if(polygons.length===0){return ;}var fistIndex=0,lastIndex,start,end,i,len;len=polygons.length;for(i=0;i<len;++i){lastIndex=fistIndex+polygons[i].length/2;start=this.getCorrectGroupIdInSeriesPoints(fistIndex,fistIndex);end=this.getCorrectGroupIdInSeriesPoints(lastIndex-1,lastIndex-1);this.mGroupRangeList.push({Start:start,End:end});fistIndex=lastIndex;}}function hParsePolygon(polygon,seriesPolygonBounder){var polygonUnit=[],polygons=[],startIndex,numberOfPolygons,i,j,span,chartCtx=this.mChartContextPtr,isGM=chartCtx.mIsGraphMatrix,isTS=chartCtx.mIsTimeSeriesChart;startIndex=0;numberOfPolygons=polygon.length;span=(isTS||isGM)?0:1;for(i=0;i*2<=numberOfPolygons;++i){if(polygon[i].x!==-1){continue;}if(i-startIndex>span){var numberOfPolygonUnits=2*(i-startIndex);for(j=startIndex;j<i;++j){polygonUnit[j-startIndex]=polygon[j];polygonUnit[numberOfPolygonUnits-1-(j-startIndex)]=polygon[numberOfPolygons-1-j];}polygons.push(polygonUnit);seriesPolygonBounder.push(polygonUnit);polygonUnit=[];}startIndex=i+1;}if(startIndex<numberOfPolygons/2){var halfNumberOfPolygons=numberOfPolygons/2-startIndex;if(halfNumberOfPolygons>span){if(startIndex===0){polygons.push(polygon);seriesPolygonBounder.push(polygon);}else{if(startIndex<numberOfPolygons/2){var len=halfNumberOfPolygons*2,lastPolygon=polygon.slice(startIndex,startIndex+len);polygons.push(lastPolygon);seriesPolygonBounder.push(lastPolygon);}}}}hPopulateGroupIdMapPerSeries.call(this,polygon);hPopulateGroupRangeListPerSeries.call(this,polygons);return polygons;}function hGetStartGroupIndexForPolygonAt(index,candidate){if(index<0||index>=this.mGroupRangeList.length){return candidate;}return this.mGroupRangeList[index].Start;}function hGenerateOnePolygonObject(areaId,polygon,areaSet){var currentAreaId=new $C.TripleId({TripleId:areaId}),area=null,chartCtx=this.mChartContextPtr;if(polygon.length===2){currentAreaId.mObjectId=$GO.DssGraphDataMarker;var markerSize=4,markerShape=$MS.DssGraphMarkerShapeCircle;area=new $C.MarkerObject({TripleId:currentAreaId,MarkerPosition:polygon[0],MarkerShape:markerShape,IsIsometric:true,MarkerSize:markerSize,GraphObjectManager:this,GraphCollectionObject:areaSet});return area;}if(chartCtx.mImageUsage===$IMG_USAGE.OBJECT_CLIP_COMPUTATION){return area;}area=new $C.PolygonObject({TripleId:currentAreaId,GraphObjectManager:this,Polygon:polygon,ParentObject:areaSet,Shape:$SHP._POLYGON});if(chartCtx.mIsGraphMatrix&&this.mChartContextPtr.mImageFormat===$PFT.SVG){area.mPointsStyle=$APS.TOOLTIP_UPPER;}return area;}function hGenerateOnePolygon(seriesIndex,polygon,useDepth){var areaId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:this.mSeriesInfo[seriesIndex].mSeriesId,GroupId:$NULL_GROUP_ID}),areaSet=this.mAreaCollection[seriesIndex],area;area=hGenerateOnePolygonObject.call(this,areaId,polygon,useDepth,areaSet);if(area){this.mGraphObjectList.push(area);areaSet.AddGraphObject(area);}}function hCheckClip(valueAxis,basePoint,shapeSize){var chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),result=valueAxis.GetMaxMinDataInputPosition(),axisObjectId=valueAxis.mTripleId.mObjectId,lowBoundary=result.LowBoundary,highBoundary=result.HighBoundary,clippedMarkerKey;if(this.mIsVertical){clippedMarkerKey=(axisObjectId===$GO.DssGraphY1Body)?"Y1":"Y2";}else{clippedMarkerKey=(axisObjectId===$GO.DssGraphX1Body)?"X1":"X2";}var offsets=this.mClippedMarkerSize[clippedMarkerKey],lowOffset=offsets.LowOffset,highOffset=offsets.HighOffset;result=gmCtx.getClippedOffset(lowBoundary,highBoundary,shapeSize,basePoint,!this.mIsVertical,lowOffset,highOffset);offsets.LowOffset=lowOffset=result.LowOffset;offsets.HighOffset=highOffset=result.HighOffset;}function hUpdateBaseSide(polygon,valueAxis,isVertical){if(!this.mChartContextPtr.mIsGraphMatrix){return polygon;}var returnVal,zeroPosition=0,isChanged=false,i;if(valueAxis.IsBaseAtZero()){returnVal=valueAxis.GetPositionByValue(0);if(returnVal!==null){zeroPosition=returnVal;if(valueAxis.isBaseLineQualified()){var numberOfPoints=polygon.length;if(numberOfPoints%2===0&&numberOfPoints>=4){var halfNumberOfPoints=numberOfPoints/2,upper,lower;upper=polygon.slice(0,halfNumberOfPoints);lower=polygon.slice(halfNumberOfPoints,polygon.length+1);if(isVertical&&lower[0].y===zeroPosition){isChanged=true;for(i=0;i<halfNumberOfPoints;++i){if(upper[i].y!==lower[halfNumberOfPoints-1-i].y){lower[halfNumberOfPoints-1-i].y--;}}}if(!isVertical&&lower[0].x===zeroPosition){isChanged=true;for(i=0;i<halfNumberOfPoints;++i){if(upper[i].x!==lower[halfNumberOfPoints-1-i].x){lower[halfNumberOfPoints-1-i].x++;}}}if(isChanged){polygon.splice(0,polygon.length);polygon=upper.concat(lower);}}}}}return polygon;}function hPushDownBaseSide(polygon,isVertical){if(!this.mChartContextPtr.mIsGraphMatrix){return polygon;}var numberOfPolygons=polygon.length,i;if(numberOfPolygons%2===0&&numberOfPolygons>=4){var halfNumberOfPolygons=numberOfPolygons/2,upper,lower;upper=polygon.slice(0,halfNumberOfPolygons);lower=polygon.slice(halfNumberOfPolygons,polygon.length+1);for(i=0;i<halfNumberOfPolygons;++i){if(isVertical){if(upper[i].y!==lower[halfNumberOfPolygons-1-i].y){lower[halfNumberOfPolygons-1-i].y++;}}else{if(upper[i].x!==lower[halfNumberOfPolygons-1-i].x){lower[halfNumberOfPolygons-1-i].x--;}}}polygon.splice(0,polygon.length);polygon=upper.concat(lower);return polygon;}return polygon;}function hGenerateOneRiser(seriesIndex,groupIndex,polygon,useDepth){var isGM=this.mChartContextPtr.mIsGraphMatrix,area,valueAxis,areaPolygon,shapeSize;if(!isGM){hGenerateOnePolygon.call(this,seriesIndex,polygon,useDepth);}var valueAxisCollection=this.mpABLPlotContext.mValueAxis,areaId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:this.mSeriesInfo[seriesIndex].mSeriesId,GroupId:groupIndex});if(polygon.length===1){return ;}if(polygon.length<=2){var oneElement=this.drawSinglePoint(areaId,polygon[0],$SHP._CIRCLE,$SHP._AREA);area=oneElement.Object;if(this.mDatasetPtr.showSeriesDatalabel(this.mSeriesInfo[seriesIndex].mSeriesId)){if(area!==undefined&&area!==null){this.mSinglePointObjects.push(area);}}shapeSize=oneElement.ShapeSize;if(shapeSize===undefined){if(area){shapeSize=area.getShapeSize();}else{shapeSize=0;}}valueAxis=valueAxisCollection[this.mSeriesInfo[seriesIndex].mValueAxis];if(valueAxis){hCheckClip.call(this,valueAxis,polygon[0],shapeSize);}}else{var needColorByGradient=this.mHasColorBy&&this.mDatasetPtr.isGradientABL();valueAxis=valueAxisCollection[this.mSeriesInfo[seriesIndex].mValueAxis];areaPolygon=polygon.slice(0);areaPolygon=hUpdateBaseSide.call(this,areaPolygon,valueAxis,this.mIsVertical);if(areaId.mSeriesId!==0){areaPolygon=hPushDownBaseSide.call(this,areaPolygon,this.mIsVertical);area=hGenerateOnePolygonObject.call(this,areaId,areaPolygon,useDepth,null);}else{area=hGenerateOnePolygonObject.call(this,areaId,areaPolygon,useDepth,null);}if(needColorByGradient){var points=areaPolygon;if(area){var props=this.prepareTransitionalGradient(areaId,points,points.length/2),fillPtr=area.GetFormatFill(),gradientFillPtr=fillPtr.transformToGradient(props);area.SetFormatFill(gradientFillPtr);if(props.Effective){var fillGradient=gradientFillPtr.getGradient(),formatLine=area.mFormatLinePtr.transformToGradientFromFill(fillGradient,points[0],points[points.length/2-1]);area.SetFormatLine(formatLine);}}}var needCheckClip=area&&(area instanceof $C.MarkerObject);if(needCheckClip){valueAxis=valueAxisCollection[this.mSeriesInfo[seriesIndex].mValueAxis];if(valueAxis){shapeSize=area.getShapeSize();hCheckClip.call(this,valueAxis,polygon[0],shapeSize);}}}if(area){this.mGraphObjectList.push(area);this.AddToMap(area);}}function hGenerateOnePolygonBounderLine(lineId,polygon){var halfNumberOfPoints=polygon.length/2,startIndex=polygon.length-1,polygonLine=[],i;if(lineId.mSeriesId===0&&this.mIgnoreBasesSeriesBorder){delete this.mIgnoreBasesSeriesBorder;return null;}polygonLine.push(polygon[startIndex]);for(i=0;i<=halfNumberOfPoints;++i){polygonLine.push(polygon[i]);}return new $C.PolyLineObject({TripleId:lineId,GraphObjectManager:this,PolyLine:polygonLine});}function hGenerateStrokeBounderForOneRiser(seriesIndex,groupIndex,polygon){var chartCtx=this.mChartContextPtr,seriesInfo=this.mSeriesInfo[seriesIndex],seriesId=seriesInfo.mSeriesId,areaId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:seriesId,GroupId:groupIndex}),area,lineId,stroke,formatLine;if(polygon.length<4){return ;}if(!chartCtx.mIsGraphMatrix){return ;}area=this.GetGraphObject(areaId);if(area!==undefined&&area!==null){lineId=new $C.TripleId({ObjectId:$GO.DssGraphDataLine,SeriesId:seriesId});stroke=hGenerateOnePolygonBounderLine.call(this,lineId,polygon,seriesIndex);if(stroke){formatLine=stroke.mFormatLinePtr;formatLine.mLineThickness=2;var areaFormatLine=area.mFormatLinePtr,areaFormatFill=area.GetFormatFill();if(areaFormatLine){formatLine=mstrmojo.hash.copy(areaFormatLine,formatLine);}else{if(areaFormatFill){formatLine.mLineColor=areaFormatFill.mSimpleColor;}}}if(stroke){stroke.mIsDetectable=false;this.mGraphObjectList.push(stroke);}}}function hGenerateOnePolylineBounderForDataLabel(seriesIndex,groupIndex,polygon){var chartCtx=this.mChartContextPtr,dataset=this.mDatasetPtr,dataLabelEnabled,seriesInfo=this.mSeriesInfo[seriesIndex],seriesId=seriesInfo.mSeriesId,areaId,area,lineId,line,formatLine;if(polygon.length<4){return ;}if(!chartCtx.mIsGraphMatrix){return ;}dataLabelEnabled=dataset.showSeriesDatalabel(seriesId);if(dataLabelEnabled){areaId=new $C.TripleId({ObjectId:$GO.DssGraphRiser,SeriesId:seriesId,GroupId:groupIndex});area=this.GetGraphObject(areaId);if(area!==undefined&&area!==null){lineId=new $C.TripleId({ObjectId:$GO.DssGraphDataLine,SeriesId:seriesId});line=hGenerateOnePolygonBounderLine.call(this,lineId,polygon,seriesIndex);if(line===null){return ;}formatLine=line.mFormatLinePtr;formatLine.mLineThickness=2;formatLine.mAlpha=255;this.mAreaBoundForDataLabel.push(line);}}}function hGenerateRisersForSeries(seriesIndex,useDepth){var polygon,polygonUnits,numOfPolygons,i,polygonBounder=[],isGM=this.mChartContextPtr.mIsGraphMatrix;var currentSeriesIndex=hGetSeriesPolygonIndex.call(this,seriesIndex);polygon=this.mSeriesPolygons[currentSeriesIndex];if(polygon.length<4&&!isGM){return ;}this.mGroupIdMapPerSeries.splice(0,this.mGroupIdMapPerSeries.length);this.mGroupRangeList.splice(0,this.mGroupRangeList.length);polygonUnits=hParsePolygon.call(this,polygon,polygonBounder);numOfPolygons=polygonUnits.length;for(i=0;i<numOfPolygons;++i){var groupIndex=-3;if(isGM){groupIndex=hGetStartGroupIndexForPolygonAt.call(this,i,groupIndex);}hGenerateOneRiser.call(this,currentSeriesIndex,groupIndex,polygonUnits[i],useDepth);hGenerateStrokeBounderForOneRiser.call(this,currentSeriesIndex,groupIndex,polygonBounder[i],useDepth);hGenerateOnePolylineBounderForDataLabel.call(this,currentSeriesIndex,groupIndex,polygonBounder[i],useDepth);}}function hGenerateTrickySideFaces(){}function hGetPolygonUnit(seriesIndex,groupId){var polygon=this.mSeriesPolygons[seriesIndex];if(polygon[groupId-1].x===-1||polygon[groupId].x===-1){return ;}var polygonUnit=[];polygonUnit[0]=polygon[groupId-1];polygonUnit[1]=polygon[groupId];polygonUnit[2]=polygon[polygon.length-groupId-1];polygonUnit[3]=polygon[polygon.length-groupId];return polygonUnit;}function hGenerateSideFaces(valueAxisIndex,groupId){var isReverseOrder,polygonList=[],polygonIndex=[],flags=[],numberOfSeries,seriesIndex,polyUnit,numberOfPolygons,sideDirection,i;if(this.mHasNegativeValue){hGenerateTrickySideFaces.call(this,valueAxisIndex,groupId);return ;}isReverseOrder=this.IsReverseSeriesOrder(valueAxisIndex);numberOfSeries=this.mSeriesInfo.length;for(i=0;i<numberOfSeries;++i){seriesIndex=isReverseOrder?numberOfSeries-1-i:i;if(this.mSeriesInfo[seriesIndex].mValueAxis===valueAxisIndex){polyUnit=hGetPolygonUnit.call(this,seriesIndex,groupId);if(polyUnit===undefined){continue;}polygonList.push(polyUnit);polygonIndex.push(seriesIndex);flags.push(true);}}numberOfPolygons=polygonList.length;for(i=0;i+1<numberOfPolygons;++i){if(isReverseOrder){sideDirection=new $C.Vector2D({StartPoint:polygonList[i][3],EndPoint:polygonList[i][2]});}else{sideDirection=new $C.Vector2D({StartPoint:polygonList[i][0],EndPoint:polygonList[i][1]});}if(this.PriorToNextSeries(sideDirection,groupId)){hGenerateNaiveSideFaces.call(this,polygonIndex[i],polygonList[i],groupId);flags[i]=false;}}for(i=numberOfPolygons-1;i>=0;--i){if(flags[i]){hGenerateNaiveSideFaces.call(this,polygonIndex[i],polygonList[i],groupId);}}}function hGenerateRisers(valueAxisIndex){var i,reverseGroupOrder,groupIndex,seriesInfo=this.mSeriesInfo,numberOfSeries=seriesInfo.length;if(this.mpABLPlot.isAbsoluteOrCluster()||!this.mUseDepth){for(i=0;i<numberOfSeries;++i){if(valueAxisIndex===seriesInfo[i].mValueAxis||valueAxisIndex===$VA.VA_BOTH){hGenerateRisersForSeries.call(this,i,this.mUseDepth);}}}else{reverseGroupOrder=this.IsReverseGroupOrder();if(this.mpABLPlotContext.mABLOptions.mCurvedLines){hGenerateTrickySideFaces.call(this,valueAxisIndex,0);}else{for(i=1;i<this.mGroupCount;++i){groupIndex=reverseGroupOrder?this.mGroupCount-i:i;hGenerateSideFaces.call(this,valueAxisIndex,groupIndex);}}for(i=0;i<numberOfSeries;++i){if(valueAxisIndex===seriesInfo[i].mValueAxis||valueAxisIndex===$VA.VA_BOTH){hGenerateRisersForSeries.call(this,i,false);}}}}function hIsAtHighSideToBase(iIsVertical,basePosition,isStringent,point){if(iIsVertical){if(isStringent){return point.y<basePosition;}return point.y<=basePosition;}if(isStringent){return point.x>basePosition;}return point.x>=basePosition;}function hGetSeriesPolygon(seriesIndex){var ablPlotCtx=this.mpABLPlotContext,ablPlot=this.mpABLPlot,polygon=[],offsetX=0,offsetY=0,returnVal,valueAxis,valueIndex,baseValue,baselinePosition,basePosition,i,backUpDrawFromZero,dataValue,isNull,valuePosition,categoryPosition,preValue,axisOriginValue,zeroLinePosition,hasPositivePoints=false,hasNegativePoints=false,crossBaseLine=false,layout=this.mpABLPlotContext.mABLOptions.mLayout,isGM=this.mChartContextPtr.mIsGraphMatrix,groupCount=this.mGroupCount;if(this.mUseDepth){returnVal=this.mpABLPlot.GetDepthOffset(this.mSeriesInfo[seriesIndex].mSeriesIndex);offsetX=returnVal.OffsetX;offsetY=returnVal.OffsetY;}valueIndex=this.mSeriesInfo[seriesIndex].mValueAxis;valueAxis=ablPlotCtx.mValueAxis[valueIndex];axisOriginValue=valueAxis.GetAxisOriginValue();backUpDrawFromZero=valueAxis.mOptions.mDrawFromZero;valueAxis.mOptions.mDrawFromZero=(axisOriginValue===null||axisOriginValue===0)&&(valueAxis.mOptions.mUseLogarithmicScale===false);basePosition=valueAxis.GetBasePosition(true);baseValue=valueAxis.GetBaseValue(true);zeroLinePosition=valueAxis.GetPositionByValue(axisOriginValue!==null?axisOriginValue:0);if(zeroLinePosition===null){zeroLinePosition=-100;}baselinePosition=valueAxis.GetBasePosition(axisOriginValue);for(i=0;i<groupCount;++i){dataValue=0;returnVal=this.GetData(seriesIndex,i);isNull=(returnVal===null);if(returnVal!==null){dataValue=returnVal;++ablPlot.DPCount;if(ablPlot.seriesDPCount[this.mSeriesInfo[seriesIndex].mSeriesId]===undefined||ablPlot.seriesDPCount[this.mSeriesInfo[seriesIndex].mSeriesId]===null){ablPlot.seriesDPCount[this.mSeriesInfo[seriesIndex].mSeriesId]=1;}else{++(ablPlot.seriesDPCount[this.mSeriesInfo[seriesIndex].mSeriesId]);}}valuePosition=0;returnVal=valueAxis.GetPositionByValue(dataValue);if(returnVal!==null){valuePosition=returnVal;}if(isGM&&isNull){polygon[i]=kNullPoint;polygon[groupCount*2-i-1]=kNullPoint;continue;}if((this.mIsAbsolute&&isNull)||returnVal===null){polygon[i]=kNullPoint;polygon[groupCount*2-i-1]=kNullPoint;continue;}categoryPosition=ablPlotCtx.mCategoryAxisPtr.getGroupMiddlePos(i);if(!this.mIsAbsolute){var isStacked=layout===$LAYOUT.LO_STACKED,isCustomScale=valueAxis.mOptions.mUseCustomMinMax,isLogScale=valueAxis.mOptions.mUseLogarithmicScale;if(valueAxis.mOptions.mDrawFromZero||$LAYOUT.LO_PERCENT===layout||(isStacked&&!isCustomScale&&isLogScale)){if((isStacked&&!isCustomScale&&isLogScale)&&(seriesIndex===0)){preValue=baseValue;}else{preValue=0;returnVal=this.GetData(seriesIndex,i,true);if(returnVal!==null){preValue=returnVal;}}returnVal=valueAxis.GetPositionByValue(preValue);if(returnVal!==null){basePosition=returnVal;}else{polygon[i]=kNullPoint;polygon[groupCount*2-i-1]=kNullPoint;continue;}}else{var groupStacked=this.updateGroupStackInfoWithBase(valueIndex,i,axisOriginValue);var thisIndex=this.getSeriesOffsetIntoStackedInfo(valueIndex,i,seriesIndex);var oneCell=groupStacked[thisIndex];basePosition=valueAxis.ValueToPosition(dataValue>=baseValue?oneCell.Min:oneCell.Max);valuePosition=valueAxis.ValueToPosition(dataValue>=baseValue?oneCell.Max:oneCell.Min);}}if(valuePosition===baselinePosition&&dataValue!==baseValue){if(this.mIsAbsolute&&this.mSeriesInfo.length===1){if(this.mIsVertical){offsetY=dataValue>0?-1:1;}else{offsetX=dataValue>0?1:-1;}}else{if(seriesIndex===0){this.mIgnoreBasesSeriesBorder=true;}}}if(this.mIsVertical){polygon[i]=new $C.Point2D({x:categoryPosition+offsetX,y:valuePosition+offsetY});polygon[groupCount*2-i-1]=new $C.Point2D({x:categoryPosition+offsetX,y:basePosition+offsetY});}else{polygon[i]=new $C.Point2D({x:valuePosition+offsetX,y:categoryPosition+offsetY});polygon[groupCount*2-i-1]=new $C.Point2D({x:basePosition+offsetX,y:categoryPosition+offsetY});}if(!crossBaseLine&&isGM){var point=polygon[i];var isAbove=hIsAtHighSideToBase.call(this,this.mIsVertical,zeroLinePosition,true,point);hasPositivePoints=hasPositivePoints||isAbove;hasNegativePoints=hasNegativePoints||!isAbove;point=polygon[groupCount*2-i-1];isAbove=hIsAtHighSideToBase.call(this,this.mIsVertical,zeroLinePosition,false,point);hasPositivePoints=hasPositivePoints||isAbove;hasNegativePoints=hasNegativePoints||!isAbove;crossBaseLine=hasNegativePoints&&hasPositivePoints;}}valueAxis.mOptions.mDrawFromZero=backUpDrawFromZero;return{POLYGON:polygon,CROSS:crossBaseLine};}function hInitSeriesPolygons(){var finalSeriesPolygons=this.mFinalSeriesPolygons,seriesPolygons=this.mSeriesPolygons,i,j,numberOfSeries,numberOfPoints,isCrossOver,layout=this.mpABLPlotContext.mABLOptions.mLayout;this.mSeriesDrawingOrder.splice(0,this.mSeriesDrawingOrder.length);numberOfSeries=this.mSeriesInfo.length;for(i=0;i<numberOfSeries;++i){var returnVal=hGetSeriesPolygon.call(this,i);var polygon=returnVal.POLYGON;isCrossOver=returnVal.CROSS;finalSeriesPolygons.push(polygon);if((layout===$LAYOUT.LO_STACKED||layout===$LAYOUT.LO_PERCENT)&&this.mChartContextPtr.mIsGraphMatrix){if(isCrossOver){this.mSeriesDrawingOrder.unshift(i);}else{this.mSeriesDrawingOrder.push(i);}}}seriesPolygons.splice(0,seriesPolygons.length);var areaSeriesPoints;numberOfSeries=finalSeriesPolygons.length;for(i=0;i<numberOfSeries;++i){areaSeriesPoints=[];numberOfPoints=finalSeriesPolygons[i].length;for(j=0;j<numberOfPoints;++j){var point=new $C.Point2D();this.GetAreaPointByProgress(i,j,this.mProgress,point);areaSeriesPoints.push(point);}seriesPolygons.push(areaSeriesPoints);}}function hGenerateMarkers(valueAxisIndex){var i;for(i=0;i<this.mSeriesInfo.length;++i){if(valueAxisIndex===this.mSeriesInfo[i].mValueAxis||valueAxisIndex===$VA.VA_BOTH){hGenerateMarkersBySeries.call(this,i);}}}function hGenerateMarkersBySeries(seriesIndex){var seriesInfo=this.mSeriesInfo,polygon=this.mSeriesPolygons[seriesIndex],isGraphMatrix=this.mChartContextPtr.mIsGraphMatrix,data,rect,tripleId,markerPtr,markerSize=$K.kVirtualMarkerSize,i,numberOfPolygons=polygon.length;for(i=0;i*2<numberOfPolygons;++i){if(polygon[i].x===-1){continue;}data=this.mDatasetPtr.GetData(seriesInfo[seriesIndex].mSeriesId,i,0);if(data===null||data===undefined){continue;}if(isGraphMatrix){this.CreateOneDataMarker(seriesIndex,i,null,polygon[i],i);}else{rect=new $C.Rect2D({x:polygon[i].x-markerSize/2,y:polygon[i].y-markerSize/2,height:markerSize,width:markerSize});tripleId=new $C.TripleId({ObjectId:$GO.DssGraphDataMarker,SeriesId:seriesInfo[seriesIndex].mSeriesId,GroupId:i});markerPtr=new $C.RectangleObject({TripleId:tripleId,GraphObjectManager:this,Area:rect,GraphCollectionObject:null,IsOnlyForToolTip:true,IsVirtualMarker:true});this.AddToMapAndList(markerPtr);}}}function hCalculateDataLabelBasePointAndOffset(dataLabel){var polygon=this.mFinalSeriesPolygons[dataLabel.SeriesInfo],dataLabelXCenterOffset=0,dataLabelYCenterOffset=0,chartCtx=this.mChartContextPtr,gmCtx=chartCtx.GetGraphMatrixContext(),utility_id=chartCtx.getUtiliy().tripleId,isIsolatedDot,marker;utility_id.reset(perfTripleId,$GO.DssGraphRiser,dataLabel.SeriesId,dataLabel.GroupId);isIsolatedDot=gmCtx.IsIsolatedDot(perfTripleId);if(polygon[dataLabel.GroupId].x===-1){return false;}if(isIsolatedDot){marker=this.GetGraphObject(perfTripleId);if(marker!==null&&marker!==undefined&&marker.mMarkerSize!==undefined&&marker.mMarkerSize!==null){dataLabelXCenterOffset=marker.mMarkerSize;}dataLabelYCenterOffset=dataLabelXCenterOffset;}dataLabel.HostMarkerPoint=polygon[dataLabel.GroupId];dataLabel.CenterXOffset=dataLabelXCenterOffset;dataLabel.CenterYOffset=dataLabelYCenterOffset;return true;}function hPrepareDataLabelPositions(){var i,dataLabels=this.mDataLabels,len=dataLabels.length;for(i=0;i<len;++i){dataLabels[i].isValid=hCalculateDataLabelBasePointAndOffset.call(this,dataLabels[i]);}}function hInitDataLabelManager(){var dataLabelManager=this.mpABLPlot.dataLabelManager,chartCtx=this.mChartContextPtr,chartFrame=new $C.Rect2D({x:0,y:0,width:chartCtx.mGraphWidth,height:chartCtx.mGraphHeight});if(dataLabelManager===null||dataLabelManager===undefined){dataLabelManager=this.mpABLPlot.dataLabelManager=new $C.DataLabelManager({DataArea:chartFrame});dataLabelManager.ChartContext=chartCtx;}dataLabelManager.SinglePointObjects=dataLabelManager.SinglePointObjects.concat(this.mSinglePointObjects);dataLabelManager.PolyLineObjects=dataLabelManager.PolyLineObjects.concat(this.mAreaBoundForDataLabel);dataLabelManager.seriesOptions=this.mpABLPlotContext.mSeriesOptions;return dataLabelManager;}function hCreateDataMarkerForDataLabel(){var dataLabels=this.mDataLabels,len=dataLabels.length,i;for(i=0;i<len;++i){if(dataLabels[i].display){this.CreateOneDataMarker(dataLabels[i].SeriesInfo,dataLabels[i].GroupId,null,dataLabels[i].HostMarkerPoint,-3,true);}}}function hGenerateDataLabels(shownDataLabels){if(this.mChartContextPtr.mIsGraphMatrix){if(this.mDatasetPtr.showDatalabels()){this.CreateAllDataLabels();hPrepareDataLabelPositions.call(this);var dataLabelManager=hInitDataLabelManager.call(this);dataLabelManager.PlaceDataLabels(this.mDataLabels,shownDataLabels);hCreateDataMarkerForDataLabel.call(this);}}else{hGenerateDataLabelsLegacy.call(this);}}mstrmojo.chart.AreaSeriesRenderer=mstrmojo.declare(mstrmojo.chart.SeriesRenderer,null,{scriptClass:"mstrmojo.chart.AreaSeriesRenderer",mAreaCollection:null,mSeriesPolygons:null,mFinalSeriesPolygons:null,mIsAbsolute:false,mIsPolygonSplit:false,mSeriesDrawingOrder:null,mGroupRangeList:null,mSinglePointObjects:null,mHasCreatedMarkers:false,mAreaBoundForDataLabel:null,mDataLabels:null,init:function init(props){this._super(props);this.mAreaCollection=[];this.mSeriesPolygons=[];this.mFinalSeriesPolygons=[];this.mSeriesDrawingOrder=[];this.mGroupRangeList=[];this.mIsAbsolute=this.mpABLPlot.isAbsoluteOrCluster();this.mProgress=1;this.mSinglePointObjects=[];this.mAreaBoundForDataLabel=[];this.mDataLabels=[];},GenerateMapAndList:function GenerateMapAndList(shownDataLabels){var chartCtx=this.mChartContextPtr;if(this.mSeriesInfo.length===0){return ;}hGenerateAreaCollections.call(this);hInitSeriesPolygons.call(this);var tripleId=new $C.TripleId({ObjectId:$EGO.DssGraphRendererLayer,SeriesId:$VA.VA_BOTH}),graphObjAggregation=new $C.GraphObjectAggregation({TripleId:tripleId,GraphObjectManager:this}),graphObjList=this.mGraphObjectList;graphObjList.splice(0,graphObjList.length);this.GenerateInterpolationFrame(1,graphObjAggregation);if(chartCtx.mUseAnimation){this.GenerateInterpolationFrame(0,graphObjAggregation);}graphObjList.push(graphObjAggregation);if(chartCtx.mImageUsage===$IMG_USAGE.GENERAL){hGenerateDataLabels.call(this,shownDataLabels);this.GenerateTrendLine();this.GenerateRefLine();}if(this.mSeriesDrawingOrder&&this.mSeriesDrawingOrder.length){var order=this.renderSequence,myOrder=this.mSeriesDrawingOrder,seriesInfo=this.mSeriesInfo,i,len=this.mSeriesDrawingOrder.length;order.splice(0,order.length);for(i=0;i<len;i++){var index=myOrder[i];index=seriesInfo[index].mSeriesId;order[index]=i;}}else{this.populateRenderSequence();}},GenerateByValueAxis:function GenerateByValueAxis(valueAxisIndex){var currentGraphObjList=[],oldGraphObjList=[],numberOfObjects,i,graphObjList=this.mGraphObjectList,tripleId,graphObjAggregation;if(this.mSeriesPolygons.length===0){hGenerateAreaCollections.call(this);hInitSeriesPolygons.call(this);}tripleId=new $C.TripleId({ObjectId:$EGO.DssGraphRendererLayer,SeriesId:valueAxisIndex,GroupId:$NULL_GROUP_ID});graphObjAggregation=new $C.GraphObjectAggregation({TripleId:tripleId,GraphObjectManager:this});currentGraphObjList.push(graphObjAggregation);this.GenerateInterpolationFrame(1,graphObjAggregation);if(this.mChartContextPtr.mUseAnimation){this.GenerateInterpolationFrame(0,graphObjAggregation);}numberOfObjects=graphObjList.length;for(i=0;i<numberOfObjects;i++){oldGraphObjList.push(graphObjList[i]);}graphObjList.splice(0,numberOfObjects);graphObjList.splice(0,numberOfObjects);for(i=0;i<numberOfObjects;++i){graphObjList.push(oldGraphObjList[i]);}if(valueAxisIndex===$VA.VA_Y1){hGenerateDataLabelsLegacy.call(this);this.GenerateTrendLine();this.GenerateRefLine();}},GenerateInterpolationFrame:function GenerateInterpolationFrame(progress,layerObject){var seriesPolygons=this.mSeriesPolygons,graphObjList=this.mGraphObjectList,oldGraphObjList=graphObjList.slice(0),numberOfSeries=this.mFinalSeriesPolygons.length,i,j,areaSeriesPoints,numberOfPoints,point,valueAxisId,numberOfGraphObjects;this.mProgress=progress;seriesPolygons.splice(0,seriesPolygons.length);for(i=0;i<numberOfSeries;++i){areaSeriesPoints=[];numberOfPoints=this.mFinalSeriesPolygons[i].length;for(j=0;j<numberOfPoints;++j){point=new $C.Point2D();this.GetAreaPointByProgress(i,j,this.mProgress,point);areaSeriesPoints.push(point);}seriesPolygons.push(areaSeriesPoints);}valueAxisId=layerObject.mTripleId.mSeriesId;if(valueAxisId===$VA.VA_BOTH){if(this.mpABLPlot.isAbsoluteOrCluster()||!this.mUseDepth){hGenerateRisers.call(this,$VA.VA_BOTH);hGenerateMarkers.call(this,$VA.VA_BOTH);}else{hGenerateRisers.call(this,$VA.VA_Y2);hGenerateRisers.call(this,$VA.VA_Y1);hGenerateMarkers.call(this,$VA.VA_Y2);hGenerateMarkers.call(this,$VA.VA_Y1);}}else{hGenerateRisers.call(this,valueAxisId===$VA.VA_Y1?$VA.VA_Y1:$VA.VA_Y2);hGenerateMarkers.call(this,valueAxisId===$VA.VA_Y1?$VA.VA_Y1:$VA.VA_Y2);}layerObject.Clear(progress<0.5,progress>=0.5);numberOfGraphObjects=graphObjList.length;for(i=0;i<numberOfGraphObjects;++i){layerObject.AddGraphObject(graphObjList[i],progress<0.5);}if(this.mChartContextPtr.mUseAnimation&&!this.mUseDepth){layerObject.SetAnimationEnable(true);layerObject.SetProgress(progress);}graphObjList.splice(0,graphObjList.length);graphObjList=graphObjList.concat(oldGraphObjList);this._super(progress);},GetAreaPointByProgress:function GetAreaPointByProgress(seriesIndex,pointIndex,progress,point){var finalSeriesPolygons=this.mFinalSeriesPolygons,chartCtx=this.mChartContextPtr,isMove=false,oldSeriesPolygons=[],oldChartManager,oldRenderer;if(finalSeriesPolygons[seriesIndex][pointIndex].x===-1&&finalSeriesPolygons[seriesIndex][pointIndex].y===-1){point.x=-1;point.y=-1;return ;}if(!!chartCtx.mpOldChartManager){oldChartManager=chartCtx.mpOldChartManager;var lOldObjectManager=oldChartManager.GetGraphObjectManager(this.mTripleId,true);if(lOldObjectManager!==null){oldRenderer=lOldObjectManager;oldSeriesPolygons=oldRenderer.mFinalSeriesPolygons.slice(0);isMove=true;}}if(isMove&&seriesIndex<oldSeriesPolygons.length&&pointIndex<oldSeriesPolygons[seriesIndex].length&&!(oldSeriesPolygons[seriesIndex][pointIndex].x===-1&&oldSeriesPolygons[seriesIndex][pointIndex].y===-1)){point.x=oldSeriesPolygons[seriesIndex][pointIndex].x+(finalSeriesPolygons[seriesIndex][pointIndex].x-oldSeriesPolygons[seriesIndex][pointIndex].x)*progress;point.y=oldSeriesPolygons[seriesIndex][pointIndex].y+(finalSeriesPolygons[seriesIndex][pointIndex].y-oldSeriesPolygons[seriesIndex][pointIndex].y)*progress;}else{var baseY=this.mpABLPlotContext.mValueAxis[this.mSeriesInfo[seriesIndex].mValueAxis].GetBasePosition();if(this.mIsVertical){point.x=finalSeriesPolygons[seriesIndex][pointIndex].x;point.y=baseY-(baseY-finalSeriesPolygons[seriesIndex][pointIndex].y)*progress;}else{point.x=baseY-(baseY-finalSeriesPolygons[seriesIndex][pointIndex].x)*progress;point.y=finalSeriesPolygons[seriesIndex][pointIndex].y;}}}});}());