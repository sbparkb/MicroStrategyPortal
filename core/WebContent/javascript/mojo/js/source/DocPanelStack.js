(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._Formattable","mstrmojo.DocSelector","mstrmojo._IsSelectorTarget","mstrmojo.Serializer","mstrmojo._IsPanelStack","mstrmojo._HasBuilder","mstrmojo.array","mstrmojo.css","mstrmojo.hash");function updateSelectedIndex(ps,dir){var idx=mstrmojo.array.find(ps.node.data.panels,"k",ps.selectedKey);idx+=(dir||0);ps.set("selectedIdx",idx);}function updatePSNavigationProps(ps){ps.set("hasNextPanel",(ps.selectedIdx<(ps.node.data.panels.length-1)));ps.set("hasPreviousPanel",(ps.selectedIdx>0));}mstrmojo.DocPanelStack=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable,mstrmojo._IsSelectorTarget,mstrmojo._HasBuilder,mstrmojo._IsPanelStack],{scriptClass:"mstrmojo.DocPanelStack",markupString:'<div id="{@id}" k="{@k}" title="{@tooltip}" nm="{@n}" class="mstrmojo-DocPanelStack {@cssClass}" style="{@domNodeCssText}"><div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},formatHandlers:{domNode:["RW","B","overflow"]},model:null,hasNextPanel:false,hasPreviousPanel:false,applyEnabled:false,clearEnabled:true,renderMode:"onshow",n:"",node:null,selectedIdx:undefined,selectedKey:"",init:function init(props){this._super(props);updateSelectedIndex(this);this.node.sw=(this.node.data.panels.length>1&&this.defn.sw);this.n=props.node.defn.n;},onselectedKeyChange:function onselKeyChg(evt){var panelInfo=this._super(evt),on=panelInfo.on;if(on._delayRefresh){if(!on.defn.dirtyKeys){on.refresh();}delete on._delayRefresh;}updateSelectedIndex(this);},updateSelectedIdx:function updateSelected(dir){updateSelectedIndex(this,dir);},onselectedIdxChange:function onselectedIdxChange(){updatePSNavigationProps(this);},_bufferedSlices:null,canApply:function canApply(){var i,j;for(i in this.children){var pal=this.children[i];if(!pal.children){continue;}for(j in pal.children){var s=pal.children[j];if(s.defn&&s.defn.ttl!==undefined){s=s.children[1];}if(s&&s.canApply&&!s.canApply()){return false;}}}return true;},bufferSlice:function bufferSlice(rEvt){var bs=this._bufferedSlices=this._bufferedSlices||[];bs.push(rEvt);this.set("applyEnabled",this.canApply());},applyBufferedSlices:function applyBufferedSlices(){var bufferedSlices=this._bufferedSlices;if(!bufferedSlices){return ;}this.model.slice({bufferedSlices:true,tks:(mstrmojo.hash.any(bufferedSlices)||{}).tks,events:bufferedSlices});this.clearBuffSlices();},clearBuffSlices:function(){this._bufferedSlices=null;this.set("applyEnabled",false);},_isFPS:function _isFPS(){return !!this.defn.ifp;},clearAllFilter:function clearAllFilter(){var $STYLES=mstrmojo.DocSelector.STYLES,fps=this;if(!fps._isFPS()){return ;}if(!(fps.children&&fps.children.length)){return ;}for(var i in fps.children){var pal=fps.children[i];if(!pal.children){continue;}for(var j in pal.children){var s=pal.children[j];if(s.defn.ttl!=="undefined"){s=s.children[1];}if(s.model){var evt={tks:s.tks,ck:s.ck,ctlKey:s.ckey,unset:true};fps.bufferSlice(evt);s.node.data.ces=[];s.node.defn.cek=null;s.node.data.cs=[];var cnt=s.content;if(parseInt(s.node.defn.style,10)===$STYLES.SCROLLER){cnt.min=0;var len=cnt.items&&cnt.items.length;cnt.max=len?len-1:0;}s.update(s.node);s.refresh();}}}},update:function(node){if(this._super){this._super(node);}var selKey=node.data&&node.data.selKey;if(selKey&&selKey!==this.selectedKey){this.defn.newSelKey=selKey;}},postBuildRendering:function(){this._super();if(this.defn.itb){mstrmojo.css.addClass(this.domNode,"tableControl");}}});}());