(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.css","mstrmojo.dom");var $CSS=mstrmojo.css,$DOM=mstrmojo.dom;var KEY_CODE_NAME={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};function hideEmpty(){var value=this.value,inputNode=this.inputNode,inputNodeValue=inputNode.value,resolvedValue=(value!==null&&value!==undefined)?String(value):"";if(resolvedValue!==inputNodeValue&&(!this.keepEmpty||inputNodeValue!==this.emptyText)){inputNode.value=resolvedValue;}if(inputNode.mstrmojoEmpty){$CSS.removeClass(inputNode,[this.emptyClass]);inputNode.mstrmojoEmpty=null;}}function showEmpty(){var inputNode=this.inputNode;inputNode.value=this.emptyText||"";$CSS.addClass(inputNode,[this.emptyClass]);inputNode.mstrmojoEmpty=true;}function dom2value(){var inputNode=this.inputNode;if(inputNode){this.readingDom=true;this.set("value",inputNode.value);this.readingDom=false;}}function delaySetValue(delay){var textBox=this;if(delay===-1){dom2value.call(this);}else{if(this._lastTimeoutId){window.clearTimeout(this._lastTimeoutId);}this._lastTimeoutId=window.setTimeout(function(){delete textBox._lastTimeoutId;dom2value.call(textBox);},delay||100);}}mstrmojo.TextBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.TextBox",value:"",type:"text",hint:"",readOnly:false,size:"",maxLength:"",cssDisplay:"inline",tabIndex:"",emptyText:"",keepEmpty:false,emptyClass:"mstrmojo-empty",valueChangeDelay:-1,textValid:true,autoComplete:true,autoCorrect:true,autoCapitalize:true,markupString:'<input id="{@id}" class="mstrmojo-TextBox {@cssClass}"  style="{@cssText}" title="{@tooltip}" type="{@type}" value="" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}"min="{@min}" max="{@max}" placeholder="{@hint}" mstrAttach:focus,keyup,blur,paste,cut,input,click,keydown  tstid="{@tstid}"/>',markupSlots:{inputNode:function inputNode(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,oncssClassChange:function oncssClassChange(){this.inputNode.className="mstrmojo-TextBox "+(this.cssClass||"");},onhintChange:function onhintChange(){this.inputNode.setAttribute("placeholder",this.hint);},onenabledChange:function onenabledChange(){var inputNode=this.inputNode;inputNode.disabled=!this.enabled;$CSS.toggleClass(inputNode,"disabled",!this.enabled);},onvalueChange:function onvalueChange(){var v=this.value,em=(v===undefined)||(v===null)||(v==="");if(em){if(!this.hasFocus){showEmpty.call(this);}else{this.inputNode.value="";}}else{hideEmpty.call(this);}if($DOM.isIE9){this.inputNode.type=em?"text":this.type;}},ontooltipChange:function ontooltipChange(){this.domNode.title=this.tooltip;},onreadOnlyChange:function onreadOnlyChange(){this.inputNode.readOnly=this.readOnly;},ontextValidChange:function ontextValidChange(){$CSS.toggleClass(this.inputNode,["err"],!this.textValid);}},postBuildRendering:function postBuildRendering(){this._super();var e=this.inputNode;e.setAttribute("autocomplete",this.autoComplete?"on":"off");e.setAttribute("autocorrect",this.autoCorrect?"on":"off");e.setAttribute("autocapitalize",this.autoCapitalize?"on":"off");},focus:function focus(){if(this.inputNode&&this.inputNode.offsetParent){try{this.inputNode.focus();}catch(ex){}}},prefocus:function prefocus(){this.hasFocus=true;hideEmpty.call(this);},blur:function blur(){this.inputNode.blur();},preblur:function preblur(){window.setTimeout(function(){},200);this.hasFocus=false;dom2value.call(this);var value=this.value;if(((value===null||value==="")&&this.emptyText)||(this.keepEmpty&&value===this.emptyText)){showEmpty.call(this);}},prekeyup:function prekeyup(evt){var hWin=evt.hWin,e=evt.e||hWin.event;delaySetValue.call(this,this.valueChangeDelay);var n=KEY_CODE_NAME[e.keyCode];if(this["on"+n]){this["on"+n](evt);}},preinput:function preinput(){delaySetValue.call(this,this.valueChangeDelay);},prepaste:function prepaste(){delaySetValue.call(this);},precut:function precut(){delaySetValue.call(this);},setInvalidState:function setInvalidState(msg){this.set("textValid",true);if(msg){this.domNode.setAttribute("title",msg);}},cleanUp:function cleanUp(){this.inputNode.value="";this.set("textValid",false);this.domNode.setAttribute("title",this.tooltip);}});}());