(function(){mstrmojo.requiresCls("mstrmojo.dom");var $DOM=mstrmojo.dom;var $D=mstrmojo.dom;var EVENT_TO_CLOSE="mousedown";function attachHotSlot(me){var el=me[me.hotSlot||"domNode"];if(el){if(!me._closeCallback){var id=me.id,fnCallback=function(mthName){return function(e){var p=mstrmojo.all[id];if(p&&!p.ignoreHover){p["auto"+mthName](e,self);}};};me._uncloseCallback=fnCallback("Unclose");me._closeCallback=fnCallback("Close");}$DOM.attachEvent(el,"mouseover",me._uncloseCallback);$DOM.attachEvent(el,"mouseout",me._closeCallback);}}function detachHotSlot(me){if(me._closeCallback){var el=me[me.hotSlot||"domNode"];if(el){$DOM.detachEvent(el,"mouseover",me._uncloseCallback);$DOM.detachEvent(el,"mouseout",me._closeCallback);}}}function toggleLock(me,lock){var w=me;while(w){if(w.open||w.openPopup){if(w.set){w.set("ignoreHover",lock);}else{w.ignoreHover=lock;}}w=w.opener||w.parent;if(w&&w.shouldPropagateLockHover&&!w.shouldPropagateLockHover()){break;}}}function clearLockHoverCallback(){var fn=this._lockHoverCallback;if(fn){$DOM.detachEvent(document.body,EVENT_TO_CLOSE,fn,true);delete this._lockHoverCallback;}}mstrmojo._CanAutoClose=mstrmojo.provide("mstrmojo._CanAutoClose",{autoCloses:false,autoCloseDelay:100,locksHover:false,hotSlot:null,closeOnClick:false,curtainNode:null,postBuildRendering:function postBuildRendering(){this._super();if(this.autoCloses){attachHotSlot(this);}this.oncloseOnClickChange();},onautoClosesChange:function onautoClosesChange(){var fn=(this.autoCloses)?attachHotSlot:detachHotSlot;fn(this);},oncloseOnClickChange:function oncloseOnClickChange(){if(!this.curtainNode){return ;}var me=this,mthName="click",isTouchApp=(mstrApp&&mstrApp.isTouchApp&&mstrApp.isTouchApp());if(isTouchApp){mthName="touchstart";}$DOM.attachEvent(me.curtainNode,mthName,function(){me.close();if(isTouchApp){mstrmojo.touchManager.notify([]);}});},autoUnclose:function autoUnclose(){var t=this._autoCloseTimer;if(t){self.clearTimeout(t);delete this._autoCloseTimer;}},autoClose:function autoClose(){if(this.ignoreHover){return ;}if(this._autoCloseTimer){self.clearTimeout(this._autoCloseTimer);}if(this.opener){if(this.autoCloseDelay){var xid=this.opener.id;this._autoCloseTimer=self.setTimeout(function(){mstrmojo.all[xid].closePopup();},this.autoCloseDelay);}else{this.opener.closePopup();}}},destroy:function destroy(ignoreDom){clearLockHoverCallback.call(this);this._super(ignoreDom);},lockHover:function lockHover(){toggleLock(this,true);if(!this._lockHoverCallback){var id=this.id,fn=this._lockHoverCallback=function(evt){mstrmojo.all[id]._unlockHoverCheck(evt,self);};if(($DOM.isIE7||$DOM.isIE8)&&window.event&&(window.event.type===EVENT_TO_CLOSE)&&this.opener){this.opener._ignoreMousedown=true;}$DOM.attachEvent(document.body,EVENT_TO_CLOSE,fn,true);}},unlockHover:function unlockHover(){toggleLock(this,false);clearLockHoverCallback.call(this);},_unlockHoverCheck:function _unlockHoverCheck(e,hWin){var opener=this.opener;if(opener&&opener._ignoreMousedown){delete opener._ignoreMousedown;return ;}var target=$DOM.eventTarget(hWin,e);if(!$D.contains(this.domNode,target,true,document.body)){var widget=$D.findWidget(target);while(widget){if(widget===this){return ;}widget=widget.parent||widget.opener;}if(opener&&opener.onPopupAutoClosed){opener.onPopupAutoClosed(e,hWin);}this.close();}},open:function open(opener,config){if(this.autoCloses){this.autoUnclose();}this._super(opener,config);if(this.locksHover){this.lockHover();}},close:function close(cfg){if(this.locksHover){this.unlockHover();}this._super(cfg);},shouldPropagateLockHover:function shouldPropagateLockHover(){return true;}});}());