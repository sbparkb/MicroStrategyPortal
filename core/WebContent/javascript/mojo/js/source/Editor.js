(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.fx","mstrmojo.Dialog","mstrmojo.Label","mstrmojo._IsPopup","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ui._HasUITheme","mstrmojo.Button","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.tooltip","mstrmojo.ui.editors.ErrorDialogContent");var $FUNC=mstrmojo.func.composite,$DOM=mstrmojo.dom,$NWB=mstrmojo.Button.newWebButton,$CSS=mstrmojo.css,$ALL=mstrmojo.all,$HASH=mstrmojo.hash,$ARR=mstrmojo.array;function notifyAppAboutModality(isOpen){if(!this.modal){return ;}var app=window.mstrApp;if(app&&app.modalEditorChange){app.modalEditorChange(this.id,isOpen);}}mstrmojo.Editor=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsPopup,mstrmojo._HasPopup,mstrmojo._IsMovable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.Editor",title:"",help:"",autoClose:false,showTitle:true,openEffect:null,themeClassName:"mojo-theme-light",useRichTooltip:true,closeEffect:null,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mouseup,mousedown,click,contextmenu>{@titlebarHTML}<div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',titleMarkupString:'<div class="mstrmojo-Editor-title-container"><div class="mstrmojo-Editor-title"></div><div class="edt-title-btn mstrmojo-Editor-help" tooltip="'+mstrmojo.desc(1143,"help")+'"></div><div class="edt-title-btn mstrmojo-Editor-close" tooltip="'+mstrmojo.desc(2102,"Close")+'"></div></div><div class="mstrmojo-Editor-titleSpacer"></div>',markupSlots:{editorNode:function editorNode(){return this.domNode.firstChild;},titlebarNode:function titlebarNode(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},titleNode:function titleNode(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},helpNode:function helpNode(){return this.showTitle?this.domNode.firstChild.firstChild.children[1]:null;},closeNode:function closeNode(){return this.showTitle?this.domNode.firstChild.firstChild.lastChild:null;},containerNode:function containerNode(){return this.domNode.firstChild.childNodes[2];},buttonNode:function buttonNode(){return this.domNode.firstChild.childNodes[3];},curtainNode:function curtainNode(){return this.domNode.lastChild;}},markupMethods:{ontitleChange:function(){if(this.showTitle){this.titleNode.innerHTML=this.title;}},onzIndexChange:function(){var zIndex=this.zIndex;this.editorNode.style.zIndex=zIndex;this.curtainNode.style.zIndex=zIndex-1;},onvisibleChange:function(init){if(init){return ;}var visible=this.visible,fx="closeEffect",DISPLAY_NONE="none";if(visible){fx="openEffect";DISPLAY_NONE="block";}if(this[fx]){this.playEffect(fx);}else{this.editorNode.style.display=DISPLAY_NONE;if(this.modal){this.curtainNode.style.display=DISPLAY_NONE;}}},onhelpChange:function onhelpChange(){if(this.showTitle){var strHelp=this.help,helpNode=this.helpNode;if(!strHelp){helpNode.style.display="none";}else{helpNode.style.display="block";}}},onleftChange:function onleftChange(){this.editorNode.style.left=this.left||"";},ontopChange:function ontopChange(){this.editorNode.style.top=this.top||"";}},open:function open(opener,config){this._super(opener,config);notifyAppAboutModality.call(this,true);},close:function close(config){this._super(config);notifyAppAboutModality.call(this,false);},unrender:function unrender(ignoreDom){this._super(ignoreDom);notifyAppAboutModality.call(this,false);},destroy:function destroy(skipCleanup){this._super(skipCleanup);notifyAppAboutModality.call(this,false);},preBuildRendering:function preBuildRendering(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));this._curtain_to_body=true;notifyAppAboutModality.call(this,true);}this.titlebarHTML=(this.showTitle)?this.titleMarkupString:"<div></div><div></div>";return this._super();},getMovingHandle:function getMovingHandle(){return this.titlebarNode;},getMovingTarget:function getMovingTarget(){return this.editorNode;},onPreClose:function onPreClose(){this.hideTooltip();return true;},premousedown:function premousedown(evt){var tgt=evt.getTarget();if(tgt===this.closeNode||tgt===this.helpNode){$CSS.toggleClass(tgt,"active",true);}},premouseup:function premouseup(evt){var tgt=evt.getTarget();if(tgt===this.closeNode||tgt===this.helpNode){$CSS.toggleClass(tgt,"active",false);}if(evt.getTarget()===this.closeNode&&this.onPreClose()){this.close();}},onclick:function onclick(evt){if(evt.getTarget()===this.helpNode){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(this.help);}else{var helpUrl=(mstrApp.helpUrl||"../help/")+"WebUser/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/"+(mstrApp.userHelpPage||"MicroStrategy_Web_Help.htm#");window.open(helpUrl+(this.help||""),"_blank");return false;}}},_set_visible:function _set_visible(n,v){var bChanged=(this[n]!==v);if(bChanged){this[n]=v;var closeHandler=this._close_handler;if(v){if(this._curtain_to_body){this.resizeDialog();this.positionDialog();}if(this.autoClose){var me=this;closeHandler=this._close_handler=closeHandler||function(evt){var target=$DOM.eventTarget(self,evt);if(target&&target.parentNode&&!$DOM.contains(me.editorNode,target,true,document.body)){me.close();}};$DOM.attachEvent(document.body,"mousedown",closeHandler);}}else{var curtainHandler=this._curtain_handler;if(curtainHandler){$DOM.detachEvent(window,"resize",curtainHandler);}if(closeHandler){$DOM.detachEvent(document.body,"mousedown",closeHandler);}}}return bChanged;},showTooltip:function showTooltip(e,win){var me=this,t=$DOM.findAncestorByAttr($DOM.eventTarget(win,e),"tooltip",true,this.domNode),content=t&&t.value;if(!me.hasOpenTooltip&&content){var position=$DOM.position(t.node);me.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:content,top:Math.max(position.y+40,0),left:Math.max(position.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER};this._super(e,win);}}});mstrmojo.Editor.openEffect_fadeIn={scriptClass:"mstrmojo.fx.AnimateProp",slot:"curtainNode",props:{backgroundColor:{start:255,stop:0,fn:function(v){v=Math.round(v);return["rgb(",v,",",v,",",v,")"].join("");}}},preStart:function(){var target=this.target,widget=this.widget;widget.editorNode.style.display="block";if(!widget.modal){return false;}target.style.display="block";$CSS.setOpacity(target,60);return true;}};mstrmojo.Editor.closeEffect_fadeOut={scriptClass:"mstrmojo.fx.FadeOut",slot:"curtainNode",start:0.6,stop:0,preStart:function(){var widget=this.widget;widget.editorNode.style.display="none";return !!widget.modal;}};function getDestroyFn(id){return function(){$ALL[id].destroy();};}function createEditor(msg,props,title,cssClass){var id=props.id||"mojoAlertx9",cfg,buttons=props.buttons;$ARR.forEach(buttons,function(btn){var onClickFn=btn.onclick;btn.onclick=function(evt){var currentEditor=$ALL[id];if(onClickFn&&onClickFn.call(btn,evt)===false){return ;}currentEditor.destroy();currentEditor=null;};});try{$ALL[id].destroy();}catch(ignore){}var propsClass=props.cssClass,css=[];if(propsClass){css.push(propsClass);delete props.cssClass;}if(cssClass){css.push(cssClass);}css.push("mstrmojo-alert");cfg={scriptClass:"mstrmojo.Editor",id:id,width:"475px",zIndex:1000,title:title||mstrmojo.desc(11812,"Notification"),cssClass:css.join(" "),children:[{scriptClass:"mstrmojo.Label",cssClass:"alert-content",text:msg,allowHTML:props.allowHTML}],visible:true};var editor=new mstrmojo.Editor($HASH.copy(props,cfg));editor.render();return editor;}if(window.mstrConfig&&!window.mstrConfig.simpleDialog){mstrmojo.notify=function notify(msg,editorProps,config){config=config||{};var forceClose=config.forceClose,callback=config.callback||mstrmojo.emptyFn,props=$HASH.copy(editorProps||{},{buttons:forceClose?[mstrmojo.Button.newActionButton((config.buttonText||mstrmojo.desc(8607,"Dismiss")),callback)]:null,showTitle:false,modal:false,top:"42px"}),time=config.duration||6000;var editor=createEditor(msg,props,"",forceClose?"ed-notify":"ed-toast"),id=editor.id;if(!forceClose){window.setTimeout($FUNC([callback,getDestroyFn(id)]),time);}else{window.setTimeout(function(){if($ALL[id]){$ALL[id].editorNode.style.opacity=0.75;}},6000);}return editor;};mstrmojo.confirm=function confirm(msg,buttonConfigs,editorProps){buttonConfigs=buttonConfigs||{};var confirmBtn=buttonConfigs.confirmBtn||{},cancelBtn=buttonConfigs.cancelBtn||{},buttons=[$NWB(confirmBtn.t||mstrmojo.desc(219,"Yes"),confirmBtn.fn,true),$NWB(cancelBtn.t||mstrmojo.desc(218,"No"),cancelBtn.fn)];return createEditor(msg,$HASH.copy(editorProps||{},{buttons:buttons,onPreClose:function(){if(cancelBtn&&cancelBtn.fn){cancelBtn.fn();}return true;}}));};mstrmojo.warn=function warn(msg,buttonConfigs,editorProps){editorProps=editorProps||{};editorProps.cssClass=(editorProps.cssClass||"")+" mstrmojo-warning";mstrmojo.confirm(msg,buttonConfigs,editorProps);};mstrmojo.alert=function alert(msg,fn,title,zIndex,cssClass,editorProps){var props={title:title,zIndex:zIndex,cssClass:cssClass,buttons:[$NWB(mstrmojo.desc(1442,"OK"),fn,true)],onPreClose:function(){if(fn){fn();}return true;}};$HASH.forEach(props,function(value,key){if(!value){delete props[key];}});return createEditor(msg,$HASH.copy(editorProps,props));};mstrmojo.error=function error(errorInfo,fn,editorProps){var info=errorInfo||{};var title=mstrmojo.desc(96,"Error");if(editorProps){title=(editorProps.title)?editorProps.title:mstrmojo.desc(96,"Error");}createEditor("",$HASH.copy(editorProps||{},{buttons:[$NWB(mstrmojo.desc(1442,"OK"),fn,true)],children:[{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",shortDesc:info.shortDesc,longDesc:info.longDesc}]}),title);};}mstrmojo.Editor.ButtonConfigType=null;}());