(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.expr","mstrmojo.rw.ConditionWalk","mstrmojo.mstr.EnumNodeDimty","mstrmojo.condTx.ConditionWalkProvider","mstrmojo.condTx.ConditionModel");mstrmojo.requiresDescs(12304);var setTip=mstrmojo.rw.ConditionWalkProvider.setTip,updateOkBtn=mstrmojo.condTx.ConditionWalkProvider.updateOkBtn,$A=mstrmojo.array,$CSS=mstrmojo.css,$DMT=mstrmojo.mstr.EnumNodeDimty,$CC=mstrmojo.condTx.CommonComponent,$EXPR=mstrmojo.expr,TP=$EXPR.TP,_NT=$CC.NODE_TYPE,VALID_DIMTY_TYPES=$A.hash([$DMT.NodeDimtyUnspecified,$DMT.NodeDimtyNone]);function onClose(){var editor=this.editor,actionRow=this.actionRow;if(actionRow){this.removeChildren(actionRow);}this.set("visible",false);if(editor&&editor.onConditionWalkClose){editor.onConditionWalkClose();}}mstrmojo.condTx.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,null,{scriptClass:"mstrmojo.condTx.ConditionWalk",cssClass:"mstrmojo-TransactionEditor-ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk {@cssClass}" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="apply"></div></div>',markupSlots:{conditionNode:function(){return this.domNode.firstChild;},walkNode:function(){return this.domNode.children[1];},applyNode:function(){return this.domNode.lastChild;}},editor:null,condition:null,objectBrowsingEnabled:false,dimtyTypes:VALID_DIMTY_TYPES,postCreate:function postCreate(){if(!this.walkProvider){this.walkProvider=mstrmojo.insert(mstrmojo.condTx.ConditionWalkProvider);}this._super&&this._super();},initWalk:function initWalk(){if(this.visible){var columnWalk=this.columnWalk,walkProvider=this.walkProvider;setTip.call(this,mstrmojo.desc(12304,"Select one editable element..."));columnWalk.removeTrailingContainer(-1);columnWalk.addNextColumn(walkProvider.getFilterOnProps());columnWalk.fo.updateColumnContainer();updateOkBtn(this);}},_set_model:function _set_model(n,v){if(v&&!v.attachEventListener){if(!v.dimtyTypes){v.dimtyTypes=this.dimtyTypes;}mstrmojo.hash.make(v,mstrmojo.condTx.ConditionModel,{});}return this._super(n,v);},onmodeledit:function onmodeledit(evt){this.columnWalk[evt.prop==="c1"?"c0":evt.prop].updateColumnContainer();if(evt.value&&evt.value.t==TP.FUNCTION){var model=this.model,target=this.target,prop=evt.prop;m={items:evt.value.m,expr:model[(prop===$CC.ALIS.FILTERON)?"ex":"ex2"],prop:prop};this.editor.openAdvEditor(m,this);}updateOkBtn(this);},onOK:function onOK(){var editor=this.editor;editor.model.setConditionData(this.condition,this.model.get());onClose.call(this);editor.toggleButtonStatus(true);},close:function close(){var editor=this.editor,condition=this.condition,actionRow=condition&&condition.tree.parent,tree=actionRow&&actionRow.exprTree;if(condition&&condition.isEmpty()){condition.del();}var items=tree&&tree.items,length=items&&items.length;if(actionRow&&!length){editor&&editor.model.deleteAction(actionRow.action);}onClose.call(this);editor&&editor.toggleButtonStatus(true);}});}());