(function(){mstrmojo.requiresCls("mstrmojo.hash");var _H=mstrmojo.hash;var elapsedTm=function(ts){return(mstrmojo.now()-ts.getTime());};mstrmojo.storage.DOMStorage=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.storage.DOMStorage",mIsSupported:false,mStorageObj:null,itemTimeToLive:3600,init:function init(props){_H.copy(props,this);return this;},isSupported:function isSupported(){return this.mIsSupported;},checkVersion:function checkVersion(curVer){var existingVer=this.getItem("__version__");if(existingVer&&existingVer<curVer){mstrmojo.dbg("DOMStorage data is old - clearing, v="+existingVer);this.clear();}this.setItem("__version__",curVer,-1);return this;},length:function(){return(this.mIsSupported?this.mStorageObj.length:0);},_keyExpired:function _keyExpired(d){return(d&&(d.ts>0)&&(mstrmojo.now()>d.ts));},key:function(index){return(this.mIsSupported?this.mStorageObj.key(index):null);},getItemAsString:function(key){var result=this.getItem(key);if(result){if(typeof result=="object"){result=JSON.stringify(result);}else{result=result+"";}}return result;},getItem:function(key){var result=null;if(this.mIsSupported){var d=this.mStorageObj.getItem(key);if(d){try{d=JSON.parse(d);}catch(e){}if(this._keyExpired(d)){this.removeItem(key);}else{result=d.data;}}}return result;},setItem:function(key,any_data,ttl){ttl=ttl||this.itemTimeToLive;try{if(this.mIsSupported){this.mStorageObj.removeItem(key);var exp=(ttl>0)?(mstrmojo.now()+(ttl*1000)):-1;var item={ts:exp,data:any_data};this.mStorageObj.setItem(key,JSON.stringify(item));}}catch(e){if(e!==QUOTA_EXCEEDED_ERR){throw e;}}finally{}return this;},removeItem:function(key){if(this.mIsSupported){this.mStorageObj.removeItem(key);}return this;},clear:function(){if(this.mIsSupported){this.mStorageObj.clear();}return this;}});})();