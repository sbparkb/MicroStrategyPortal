(function(){mstrmojo.requiresCls("mstrmojo._IsInputControl","mstrmojo.num","mstrmojo.HBox","mstrmojo.Container");var _DTP=mstrmojo.expr.DTP,_BTN="mstrmojo.Button",_N=mstrmojo.num,_TR=mstrmojo.validation.TRIGGER,HOLD_INTERVAL=50,HOLD_THRESHOLD=500,DECIMAL_NUM=10;function startStepperInterval(evt){var me=this;this._holdTimer=setInterval(function(){me.onclick(evt);},HOLD_INTERVAL);}function stopStepperInterval(){if(this._holdTimer){clearInterval(this._holdTimer);delete this._holdTimer;}}function btnMousedown(evt){var me=this;if(!this._holdTimer&&!this._startHoldTimer){this._startHoldTimer=setTimeout(function(){delete me._startHoldTimer;startStepperInterval.call(me,evt);},HOLD_THRESHOLD);}}function clearStepperTimeout(){if(this._startHoldTimer){clearTimeout(this._startHoldTimer);delete this._startHoldTimer;}stopStepperInterval.call(this);}function btnMouseup(evt){clearStepperTimeout.call(this);}function decimalFormat(v){return v?parseFloat(v.toFixed(DECIMAL_NUM)):v;}function createDICWidget(dic){var max=dic.max,min=dic.min,itv=dic.itv;return{scriptClass:"mstrmojo.HBox",alias:"hBox",children:[{scriptClass:_BTN,alias:"minus",cssClass:"mstrmojo-StepperDIC-Operator",bindings:{enabled:function(){var p=this.parent.parent,v=p.numericValue;if(v<=min||!p.enabled){clearStepperTimeout.call(this);return false;}return true;}},onclick:function(evt){var di=this.parent.parent,v=di.numericValue;if(!isNaN(v)){if(max!==undefined&&v-itv>max){di.set("numericValue",max);}else{if(min===undefined||v-itv>=min){di.set("numericValue",decimalFormat(v-itv));}else{if(v>min&&v-itv<min){di.set("numericValue",min);}}}}},onmouseup:btnMouseup,onmousedown:btnMousedown,text:"-"},{scriptClass:"mstrmojo.ValidationTextBox",cssClass:"mstrmojo-DataInputControl",dtp:_DTP.DOUBLE,required:true,alias:"textInput",cssDisplay:"block",constraints:{trigger:_TR.ONKEYUP|_TR.ONBLUR,max:max,min:min},bindings:{value:"this.parent.parent.numericValue",enabled:"!!this.parent.parent.enabled"},onValid:function(){this.parent.parent.set("numericValue",parseFloat(this.value));},onblur:function onblur(evt){var me=this,di=this.parent.parent,value=_N.parseNumeric(this.value);if(!di.active&&!isNaN(value)&&value>=min&&value<=max){di.set("value",_N.toLocaleString(di.numericValue));}if(this._super){this._super(evt);}}},{scriptClass:_BTN,alias:"plus",cssClass:"mstrmojo-StepperDIC-Operator",bindings:{enabled:function(){var p=this.parent.parent,v=p.numericValue;if(v>=max||!p.enabled){clearStepperTimeout.call(this);return false;}return true;}},onclick:function(evt){var di=this.parent.parent,v=di.numericValue;if(!isNaN(v)){if(min!==undefined&&v+itv<min){di.set("numericValue",min);}else{if(max===undefined||v+itv<=max){di.set("numericValue",decimalFormat(v+itv));}else{if(v<max&&v+itv>max){di.set("numericValue",max);}}}}},onmouseup:btnMouseup,onmousedown:btnMousedown,text:"+"}]};}mstrmojo.StepperDIC=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsInputControl],{scriptClass:"mstrmojo.StepperDIC",cssClass:"mstrmojo-StepperDIC",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}" mstrAttach:mouseup,mousedown></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},init:function init(props){if(this._super){this._super(props);}var _v=parseFloat(this.value);this.set("numericValue",isNaN(_v)?(this.dic.min||0):_v);this.set("children",createDICWidget(this.dic));this.textInput=this.hBox&&this.hBox.textInput;this.plus=this.hBox&&this.hBox.plus;this.minus=this.hBox&&this.hBox.minus;},onmousedown:function(evt){this.active=true;},onmouseup:function(evt){this.active=false;this.textInput&&this.textInput.domNode.focus();},unrender:function unrender(ignoreDom){this.plus&&clearStepperTimeout.call(this.plus);this.minus&&clearStepperTimeout.call(this.minus);this._super(ignoreDom);}});}());