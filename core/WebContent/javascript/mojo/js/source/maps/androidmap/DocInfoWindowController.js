(function(){mstrmojo.requiresCls("mstrmojo.android.controllers.DocumentController","mstrmojo.maps.androidmap.InfoWindowDoc","mstrmojo.maps.androidmap.AndroidDocMapInfoWindow","mstrmojo.InfoWindowDocBuilder","mstrmojo.Overlay","mstrmojo.hash","mstrmojo.array");var $HASH=mstrmojo.hash,$ARR=mstrmojo.array;function prepareLayout(res){var dm=this.model,key=res.key,doc=this.doc,layout={};dm.replaceLayout(key,res);dm.currlaykey=key;if(res.isSelected){doc.selectLayout(layout,false);}return(doc.rebuildLayout(key,doc.getLayouts()));}mstrmojo.maps.androidmap.DocInfoWindowController=mstrmojo.declare(mstrmojo.android.controllers.DocumentController,null,{scriptClass:"mstrmojo.maps.androidmap.DocInfoWindowController",initModel:function initModel(){var params=this._startParams,model=this._super(params);var docParams=params.docParams;if(docParams){model.st=docParams.st;model.n=docParams.ttl;}return model;},destroy:function destroy(){var widget=this.widget;if(widget){widget.destroy();}this.doc.destroy();this._super();},renderLayout:function renderLayout(res,width,height){var layoutRes=prepareLayout.call(this,res),node=layoutRes.node,w=node.defn.fmts.width,h=node.defn.fmts.height||node.data.mh,overlay=new mstrmojo.Overlay({parent:this,children:[layoutRes]});overlay.set("width",w);overlay.set("height",h);var cn=document.getElementById("mainInfoWindow");cn.style.visibility="visible";if(!cn.firstChild){cn.appendChild(document.createElement("div"));}overlay.placeholder=cn.firstChild;overlay.render();window.setTimeout(function(){overlay.setDimensions(height||"300px",width||"400px");},500);this.widget=overlay;},start:function start(params){this.model=this.initModel();this.view=this.doc=this.createView(null,params);if(mapProxy&&mapProxy.registerInfoWindow){mapProxy.registerInfoWindow(this.id);}},createView:function createView(res,params){var doc=new mstrmojo.maps.androidmap.InfoWindowDoc($HASH.copy(params.docParams,{controller:this,model:this.model,renderMode:"normal",placeholder:mstrApp.rootView.rootContainer.domNode}));doc.builder=new mstrmojo.InfoWindowDocBuilder({parent:doc});doc.render();return doc;},findSelectorTarget:function findSelectorTarget(sc){var targetKeys=sc&&sc.tks;if(targetKeys){var model=this.model;$ARR.forEach(targetKeys.split("\u001E"),function(target){var defn=model.getTargetDefn(target);if(defn[target].ifw){return target;}});}},renderPanelStack:function renderPanelStack(res,width,height){var d=this.gridProps,dm=this.model,sc=this.getInfoWindowSelectorControl(d);var tgtDefs=dm.getTargetDefn(res.pukeys||sc.tks);dm.updateDataCache(res.data,tgtDefs);var firstInfoWinKey=this.findSelectorTarget(sc);if(firstInfoWinKey){var id=firstInfoWinKey+"_ifw",w=mstrmojo.all[id],psId="*l"+res.currlaykey+"*k"+firstInfoWinKey+"*x1*t"+dm.buildTime;if(w){w.destroy();}var ifw=new mstrmojo.maps.androidmap.AndroidDocMapInfoWindow({id:id,parent:this,builder:this.doc.builder,model:dm,psKey:firstInfoWinKey,psId:psId});var cn=document.getElementById("mainInfoWindow");cn.style.visibility="visible";if(!cn.firstChild){cn.appendChild(document.createElement("div"));}ifw.placeholder=cn.firstChild;ifw.render();this.widget=ifw;}},getInfoWindowSelectorControl:function getInfoWindowSelectorControl(d){var sc=this.sc=this.sc||d.gts.row[0].sc;return sc;}});}());