(function(){mstrmojo.requiresCls("mstrmojo.Dialog","mstrmojo._IsAnchorable","mstrmojo._TouchGestures","mstrmojo._HasTouchScroller");var $D=mstrmojo.dom;function fnCloseDialog(){mstrApp.closeDialog();}mstrmojo.Magnifier=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsAnchorable,mstrmojo._TouchGestures,mstrmojo._HasTouchScroller],{scriptClass:"mstrmojo.Magnifier",cssClass:"mstrmojo-magnifier anchor",markupString:'<div id="{@id}" class="mstrmojo-Dialog {@cssClass}"><div class="win mstrmojo-Editor" style="{@cssText}"><div class="mstrmojo-InfoViewer-Title"><div class="mstrmojo-Editor-title">{@title}</div></div><div class="mstrmojo-InfoViewer-Content"></div><div class="mstrmojo-InfoViewer-Buttons"></div></div><div class="mstrmojo-Editor-curtain"></div><div class="mstrmojo-Editor-tip"></div></div>',anchorOrientation:"h",anchorOffset:0,baseTipClass:"",screenDim:null,width:"auto",close:function close(){if(this.onClose){this.onClose();}$D.detachEvent(window,"resize",fnCloseDialog);this.destroy();},touchBegin:function touchBegin(touch){this.helper.glowOnTap(touch.target);},touchTap:function touchTap(touch){var target=touch.target;if(target===this.curtainNode){mstrApp.closeDialog();}else{this.helper.handleTouchTap(target);}},touchSwipeEnd:function touchSwipeEnd(touch){this.helper.handleTouchSwipe(touch);this._super(touch);},preBuildRendering:function preBldRdr(){this._super();var dim=this.screenDim=mstrApp.getScreenDimensions(),w=dim.w,h=dim.h;if(mstrApp.isTablet()){this.width="auto";}else{this.width=(w>h?(w*0.4):(w*0.6))+"px";}},postBuildRendering:function(){this._super();$D.attachEvent(window,"resize",fnCloseDialog);},updateContent:function(){var helper=this.helper;helper.createTitle(this.titleNode);helper.createContent(this.containerNode);},resizeAndPosition:function(anchorPos){var contentHeight=this.helper.getContentHeight(),titleHeight=this.helper.titleHeight,dim=this.screenDim,totalHeight=dim.h-30,pos;this.height=Math.min(contentHeight,totalHeight-titleHeight);this.containerNode.style.height=this.height+"px";this.updateScroller();if(anchorPos){this.moveTo(anchorPos);}else{pos=$D.position(this.editorNode);if(!(pos.x>0&&pos.x+pos.w<dim.w&&pos.y>0&&pos.y+pos.h<dim.h)){this.positionDialog();}}window.setTimeout(function(){mstrMobileApp.forceRepaint();},0);},moveTo:function(anchorPosition){this.anchorPosition=anchorPosition;this.positionDialog();},updateScrollerConfig:function updateScrollerConfig(){var cfg=this._super(),idx=this.helper.currentTabIndex,scrollEl=this.containerNode.children[idx];cfg.bounces=false;if(scrollEl){cfg.scrollEl=scrollEl;cfg.origin=cfg.origin||{x:0,y:0};cfg.noVScroll=cfg.noHScroll=true;var offsetEnd=Math.max(this.helper.getContentHeight()-this.height,0);var enableScroll=cfg.vScroll=(offsetEnd!==0);if(enableScroll){cfg.offset={y:{start:0,end:offsetEnd}};}}return cfg;}});}());