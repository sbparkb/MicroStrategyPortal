(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.Box","mstrmojo.Button","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.form");mstrmojo.requiresDescs(138,139,221,2397,12204,12205,12206,13319);var $DESC=mstrmojo.desc,$DOM=mstrmojo.dom,$CSS=mstrmojo.css,$HASH=mstrmojo.hash,EID,EDITOR;mstrmojo.sort.CustomSortEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.sort.CustomSortEditor",cssClass:"mstrmojo-CustomSortEditor",title:mstrmojo.desc(12204,"Custom Sort"),browseConfig:null,dirty:false,onSave:mstrmojo.emptyFn,init:function init(props){this._super(props);EID=this.id;EDITOR=this;},_set_model:function(n,v){this.model=v;this.deList.set("items",v.es);this.resetBtn.set("enabled",!mstrmojo.hash.isEmpty(v.oldSorts));return true;},children:[{scriptClass:"mstrmojo.List",alias:"deList",renderOnScroll:false,draggable:true,dropZone:true,ownAvatar:true,allowDrop:function allowDrop(c){var s=c&&c.src,w=s&&s.widget;return(w===this);},itemIdField:"v",selectionPolicy:"reselect",selectedIndex:0,multiSelect:true,cssClass:"mstrmojo-CSE-List",itemMarkupFunction:function itemMarkupFunction(data,idx,w){return'<div class="mstrmojo-CSE-List-item"><div class="mstrmojo-CSE-List-text lvl-'+(data.lvl||0)+'">'+data[w.itemField]+"</div></div>";}},{scriptClass:"mstrmojo.ListBase",alias:"toolbar",cssClass:"mstrmojo-CSE-toolbar",itemIdField:"did",itemField:"n",items:[{n:"top",did:1,desc:mstrmojo.desc(12205,"Move to top")},{n:"up",did:2,desc:mstrmojo.desc(138,"Move up")},{n:"down",did:3,desc:mstrmojo.desc(139,"Move down")},{n:"bottom",did:4,desc:mstrmojo.desc(12206,"Move to bottom")}],getItemMarkup:function getItemMarkup(item){return'<div class="mstrmojo-CSE-toolbar-item {@n}" idx="{@idx}" title="{@desc}">{@n}</div>';},getItemProps:function getItemProps(item,idx){return{n:item.n,desc:item.desc,idx:idx};},itemRenderer:mstrmojo._IsList.itemRenderer,onclick:function onclick(evt){var target=evt.target||$DOM.eventTarget(evt.hWin,evt.e),item=$DOM.findAncestorByAttr(target,"idx",true,this.domNode),bIdx=item&&parseInt(item.value,10),btn=bIdx!==null&&!isNaN(bIdx)?this.items[bIdx]:null;if(btn){var deList=EDITOR.deList,selItems=deList.getSelectedItems(),selIdxs=deList.sortSelectedIndices(),len=deList.items.length,selLen=selIdxs.length,toIdx=0;switch(btn.n){case"top":toIdx=0;break;case"up":toIdx=Math.max(parseInt(selIdxs[0],10)-1,0);break;case"down":toIdx=Math.min(parseInt(selIdxs[selLen-1],10)+1,len);break;case"bottom":toIdx=len;break;}deList.move(selIdxs,toIdx);deList.clearSelect();deList.setSelectedItems(selItems,true);deList.scrollboxNode=deList.itemsContainerNode;deList.scrollTo(Math.min(len-1,toIdx));EDITOR.set("dirty",true);}}},{scriptClass:"mstrmojo.Box",slot:"buttonNode",alias:"btns",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",alias:"okBtn",cssClass:"mstrmojo-Editor-button mstrmojo-VIButton hot",cssDisplay:"inline-block",text:mstrmojo.desc(2397,"Save"),bindings:{enabled:function(){return this.parent.parent.dirty;}},onclick:function(){var m=EDITOR.model;m.es=EDITOR.deList.items;EDITOR.onSave(m);EDITOR.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-VIButton",cssDisplay:"inline-block",text:$DESC(221,"Cancel"),onclick:function(){EDITOR.close();}}]},{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"resetBtn",cssClass:"mstrmojo-Editor-button mstrmojo-VIButton reset",text:mstrmojo.desc(13319,"Clear and Close"),onclick:function(){var m=EDITOR.model;m.es=null;EDITOR.onSave(m);EDITOR.close();}}]});}());