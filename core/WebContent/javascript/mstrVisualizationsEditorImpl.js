mstrVisualizationsEditorImplScript=true;mstrVisualizationsEditorImpl.prototype=new mstrEditorImpl();mstrVisualizationsEditorImpl.prototype.updateManager=microstrategy.updateManager;mstrVisualizationsEditorImpl.prototype.oSelectedVis;mstrVisualizationsEditorImpl.prototype.oAvailableVis;mstrVisualizationsEditorImpl.prototype.oVisEnabled;mstrVisualizationsEditorImpl.prototype.oSetVisualizationMode;mstrVisualizationsEditorImpl.prototype.oSecondaryDS;mstrVisualizationsEditorImpl.prototype.oIPhoneVis;mstrVisualizationsEditorImpl.prototype.oIPadVis;mstrVisualizationsEditorImpl.prototype.secondaryKeys;mstrVisualizationsEditorImpl.prototype.secondarySourcesChanged=false;mstrVisualizationsEditorImpl.prototype.minSecondaryProviders=0;mstrVisualizationsEditorImpl.prototype.maxSecondaryProviders=0;mstrVisualizationsEditorImpl.prototype.flushChanges=false;mstrVisualizationsEditorImpl.prototype.visChangedOrDisabled=false;mstrVisualizationsEditorImpl.prototype.targetBone;mstrVisualizationsEditorImpl.prototype.activeLayoutID="";mstrVisualizationsEditorImpl.prototype.widgetPropsXml;mstrVisualizationsEditorImpl.prototype.visProps;mstrVisualizationsEditorImpl.prototype.STYLE_NAME=0;mstrVisualizationsEditorImpl.prototype.VIEW_MODE=1;mstrVisualizationsEditorImpl.prototype.MIN_PROVIDERS=2;mstrVisualizationsEditorImpl.prototype.MAX_PROVIDERS=3;mstrVisualizationsEditorImpl.prototype.SHOW_IN_WEB=4;mstrVisualizationsEditorImpl.prototype.SHOW_VIS_PROPS_EDITOR=5;mstrVisualizationsEditorImpl.prototype.cartButtons={};mstrVisualizationsEditorImpl.prototype.onload=function(){try{this.initEditor();this.oSelectedVis=document.getElementById("SelectedVisualizations");this.oAvailableVis=document.getElementById("AvailableVisualizations");this.oVisEnabled=document.getElementById("VisualizationsEnabled");this.oSetVisualizationMode=document.getElementById("SetVisualizationMode");this.oSecondaryDS=document.getElementById("SecondaryDataSources");this.oVisPropsBtn=document.getElementById("visPropsEditorButton");this.oIPhoneVis=document.getElementById("iPhoneVisualization");this.oIPadVis=document.getElementById("iPadVisualization");this.oVisPropsIPhoneBtn=document.getElementById("visPropsIPhone");this.oVisPropsIPadBtn=document.getElementById("visPropsIPad");this.oVisPropsAPhoneBtn=document.getElementById("visPropsAPhone");this.oVisPropsATabletBtn=document.getElementById("visPropsATablet");this.oIPadVis=document.getElementById("iPadVisualization");this.oAPhoneVis=document.getElementById("APhoneVisualization");this.oATabletVis=document.getElementById("ATabletVisualization");for(var i=0;i<4;i++){this.cartButtons[["add","remove","up","down"][i]]=document.getElementById(["addUnitsButton","removeUnitsButton","upFontButton","downFontButton"][i]).firstChild;}if(this.oVisEnabled){this.enableOptions(this.oVisEnabled.checked);}this.updateVisPropsBtns();}catch(err){microstrategy.errors.log(err);}};mstrVisualizationsEditorImpl.prototype.updateCheck=function(obj){try{if(obj){this.enableOptions(obj.checked);}}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.enableOptions=function(enable){this.enableCart(enable);this.enableSetVisualizationMode(enable);this.enableSecondaryDataSources(enable);this.enableSetVisProps(!enable);};mstrVisualizationsEditorImpl.prototype.enableCart=function(enable){try{var AV=this.oAvailableVis;var SV=this.oSelectedVis;AV.disabled=!enable;SV.disabled=!enable;this.CleanSelectionsOnList(AV);this.CleanSelectionsOnList(SV);if(enable){if(AV.options.length>0){AV.selectedIndex=0;}if(SV.options.length>0&&SV.options[0].value!="-none-"){SV.selectedIndex=0;}AV.onchange=new Function("e","microstrategy.bone('"+this.id+"').updateButtonStatus( );");SV.onchange=new Function("e","microstrategy.bone('"+this.id+"').updateButtonStatus( );");}this.updateButtonStatus();}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.updateButtonStatus=function(){try{var AV=this.oAvailableVis;var SV=this.oSelectedVis;function fnSelected(sel){return sel.selectedIndex>=0&&sel.options[sel.selectedIndex].value!="-none-";}function fnE(cb){return cb.className.replace(new RegExp("Disabled","g"),"");}function fnD(cb){return fnE(cb)+"Disabled";}var cbs=this.cartButtons;var cb=cbs.add;cb.className=fnSelected(AV)?fnE(cb):fnD(cb);cb=cbs.remove;cb.className=fnSelected(SV)?fnE(cb):fnD(cb);cb=cbs.up;cb.className=(fnSelected(SV)&&SV.selectedIndex>0)?fnE(cb):fnD(cb);cb=cbs.down;cb.className=(fnSelected(SV)&&SV.selectedIndex<SV.options.length-1)?fnE(cb):fnD(cb);}catch(err){microstrategy.errors.log(err);}};mstrVisualizationsEditorImpl.prototype.enableSetVisualizationMode=function(enable){try{if(this.oSetVisualizationMode){this.oSetVisualizationMode.disabled=!enable;}var oSetVisualizationModeLabel=document.getElementById("SetVisualizationMode_label");if(oSetVisualizationModeLabel){oSetVisualizationModeLabel.disabled=!enable;oSetVisualizationModeLabel.className=(enable)?"":"disabledLabel";}}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.enableSecondaryDataSources=function(enable){try{if(this.oSecondaryDS){this.calculateMinMaxSecondarySources();this.oSecondaryDS.disabled=!(enable&&this.maxSecondaryProviders>0);}}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.enableSetVisProps=function(disable){try{if(this.oVisPropsBtn){this.oVisPropsBtn.disabled=disable||this.getSelectedElemOnList()==null||this.getSelectedElemOnList().split("|")[this.SHOW_VIS_PROPS_EDITOR]=="false";}}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.calculateMinMaxSecondarySources=function(){this.maxSecondaryProviders=0;this.minSecondaryProviders=0;if(this.oSecondaryDS){if(this.oSelectedVis.options.length>0&&!(this.oSelectedVis.options.length==1&&this.oSelectedVis.options[0].value=="-none-")){this.minSecondaryProviders=this.oSelectedVis.options[0].value.split("|")[this.MIN_PROVIDERS];for(i=0;i<this.oSelectedVis.options.length;i++){var curVis=this.oSelectedVis.options[i].value.split("|");if(curVis[this.MAX_PROVIDERS]>this.maxSecondaryProviders){this.maxSecondaryProviders=curVis[this.MAX_PROVIDERS];}if(curVis[this.MIN_PROVIDERS]<this.minSecondaryProviders){this.minSecondaryProviders=curVis[this.MIN_PROVIDERS];}}}}};mstrVisualizationsEditorImpl.prototype.openSecondarySourcesEditor=function(){try{microstrategy.bone("rwb_viewer").doc.commands.exec("secondaryDataSourcesEditor",[this.secondaryKeys,this.id]);}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.openVisPropsEditor=function(){try{var selectedElemOnList=this.getSelectedElemOnList();if(selectedElemOnList){this.openPropsEditor(selectedElemOnList.split("|")[this.STYLE_NAME]);}else{alert("No visualization selected");}}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.openIPhoneVisPropsEditor=function(){this.openMobileVisPropsEditor(this.oIPhoneVis);};mstrVisualizationsEditorImpl.prototype.openIPadVisPropsEditor=function(){this.openMobileVisPropsEditor(this.oIPadVis);};mstrVisualizationsEditorImpl.prototype.openAndroidVisPropsEditor=function(){this.openMobileVisPropsEditor(this.oAPhoneVis);};mstrVisualizationsEditorImpl.prototype.openAndroidTabletVisPropsEditor=function(){this.openMobileVisPropsEditor(this.oATabletVis);};mstrVisualizationsEditorImpl.prototype.openMobileVisPropsEditor=function(mVis){if(mVis&&mVis[mVis.selectedIndex].getAttribute("visPropsStyle")){this.openPropsEditor(mVis[mVis.selectedIndex].value);}};mstrVisualizationsEditorImpl.prototype.openPropsEditor=function(selVis){if(selVis){var args=[this.scope,selVis,this.id];args.push(this.widgetPropsXml||"");args.push(this.secondaryKeys||"");this.getTargetBone().commands.exec("visPropsEditor",args);}};mstrVisualizationsEditorImpl.prototype.okChanges=function(){try{var actionCollection=new Array();var bone=null;if(!this.validateInputs()){return ;}bone=this.getTargetBone();var viewMode;var selectedVis;var visEnabled;var selectedVisList;var iphoneVis;var ipadVis;var aPhoneVis;var aTabletVis;if(this.oVisEnabled.checked){visEnabled="1";}else{visEnabled="0";viewMode="0";}if(this.isSelectedListNotEmpty()){var selectedElem=this.getSelectedElemOnList();selectedVis=selectedElem.split("|")[this.STYLE_NAME];if(this.oSetVisualizationMode.checked&&this.oVisEnabled.checked){viewMode=selectedElem.split("|")[this.VIEW_MODE];}}else{if(this.getCurrentSelectedVisualization()){selectedVis="";}}if(this.scope==microstrategy.VIS_EDITOR_SCOPE_REPORT&&!this.flushChanges){this.flushChanges=(bone.selectedVisualization!=selectedVis)||(bone.visualizationMode!=viewMode)||(visEnabled=="0"&&bone.visualizationsEnabled)||(visEnabled=="1"&&!bone.visualizationsEnabled);}var aSelectedElems=new Array();for(i=0;this.isSelectedListNotEmpty()&&i<this.oSelectedVis.options.length;i++){aSelectedElems[i]=this.oSelectedVis.options[i].value.split("|")[this.STYLE_NAME];}selectedVisList=aSelectedElems.join(",");if(this.scope==microstrategy.VIS_EDITOR_SCOPE_RW_GRID&&(selectedVis!=bone.selectedVisualization||visEnabled=="0")){this.visChangedOrDisabled=true;}if(this.oIPhoneVis){iphoneVis=this.oIPhoneVis[this.oIPhoneVis.selectedIndex].value;}if(this.oIPadVis){ipadVis=this.oIPadVis[this.oIPadVis.selectedIndex].value;}if(this.oAPhoneVis){aPhoneVis=this.oAPhoneVis[this.oAPhoneVis.selectedIndex].value;}if(this.oATabletVis){aTabletVis=this.oATabletVis[this.oATabletVis.selectedIndex].value;}if(this.scope==microstrategy.VIS_EDITOR_SCOPE_RW_LAYOUT){bone.parentBone.isLayoutLevelVis=(viewMode>0);bone.setVisualizationSettings(visEnabled,selectedVis,selectedVisList,viewMode,actionCollection,this.widgetPropsXml,this.activeLayoutID);}else{bone.setVisualizationSettings(visEnabled,selectedVis,selectedVisList,viewMode,actionCollection,this.widgetPropsXml,iphoneVis,ipadVis,aPhoneVis,aTabletVis);}if(actionCollection.length>0){this.updateManager.add(actionCollection);}if(viewMode=="0"&&this.isObjectVisualized()&&this.oSecondaryDS){showMessage({contents:microstrategy.descriptors.getDescriptor("5024"),elements:microstrategy.OK_BUTTON+microstrategy.CANCEL_BUTTON,okEval:"microstrategy.bone('"+this.id+"').setSelectedDataSourceKeys('');microstrategy.bone('"+this.id+"').saveSelectedDataSourcesAndCloseEditor();",cancelEval:"microstrategy.bone('"+this.id+"').saveSelectedDataSourcesAndCloseEditor();",type:mstrMsgBoxImpl.MSG_WARNING});}else{this.saveSelectedDataSourcesAndCloseEditor();}}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.isSelectedListNotEmpty=function(){return this.oSelectedVis.options.length>0&&!(this.oSelectedVis.options.length==1&&this.oSelectedVis.options[0].value=="-none-");};mstrVisualizationsEditorImpl.prototype.getSelectedElemOnList=function(){var selectedElem;if(this.isSelectedListNotEmpty()){for(i=0;i<this.oSelectedVis.options.length;i++){var selectedValue=this.oSelectedVis.options[i].value.split("|")[this.STYLE_NAME];if(selectedValue==this.getCurrentSelectedVisualization()){selectedElem=this.oSelectedVis.options[i].value;}}if(!selectedElem){selectedElem=this.oSelectedVis.options[0].value;}}return selectedElem;};mstrVisualizationsEditorImpl.prototype.getTargetBone=function(){if(!this.targetBone){if(this.scope==microstrategy.VIS_EDITOR_SCOPE_REPORT){this.targetBone=microstrategy.bone("UniqueReportID");}else{if(this.scope==microstrategy.VIS_EDITOR_SCOPE_RW_GRID){this.targetBone=microstrategy.findBone(microstrategy.bone("rwb_viewer").commands.queryState("selectedGrid"));}else{if(this.isDocVis()){this.targetBone=microstrategy.bone("rwb_viewer").doc;}}}}return this.targetBone;};mstrVisualizationsEditorImpl.prototype.isDocVis=function(){return this.scope==microstrategy.VIS_EDITOR_SCOPE_RW||this.scope==microstrategy.VIS_EDITOR_SCOPE_RW_LAYOUT;};mstrVisualizationsEditorImpl.prototype.getCurrentSelectedVisualization=function(){bone=this.getTargetBone();if(this.isDocVis()){return bone.parentBone.selectedVisualization;}else{return bone.selectedVisualization;}};mstrVisualizationsEditorImpl.prototype.isObjectVisualized=function(){bone=this.getTargetBone();if(this.isDocVis()){return bone.parentBone.isVisualization;}else{return bone.isVisualization;}};mstrVisualizationsEditorImpl.prototype.saveSelectedDataSourcesAndCloseEditor=function(){try{this.saveSelectedDataSources();if(this.visChangedOrDisabled){microstrategy.bone("rwb_viewer").doc.commands.exec("PropertyChanges",[{cmdId:"setWidgetDhtmlRenderForViewModeChange",value:microstrategy.DHTML_RENDERER_SAME_AS_PDF_AND_EXCEL,memo:{},obj:null,performFormatChange:true,submitUpdateManager:false}]);}this.closeEditor(this.flushChanges);}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.saveSelectedDataSources=function(){try{if(this.secondarySourcesChanged==false){return ;}var bone=microstrategy.bone("rwb_viewer").doc;if(bone&&bone.commands){var props=new Array();props[0]=new Object();props[0].cmdId="SecondaryDataProviders";props[0].formatType="1";props[0].value=this.secondaryKeys;bone.commands.exec("PropertyChanges",props);this.flushChanges=true;}}catch(err){microstrategy.errors.log(err);}};mstrVisualizationsEditorImpl.prototype.setSelectedDataSourceKeys=function(newKeys){try{if(this.secondaryKeys!=newKeys){this.secondaryKeys=newKeys;this.secondarySourcesChanged=true;}}catch(err){microstrategy.errors.log(err);return false;}};mstrVisualizationsEditorImpl.prototype.validateInputs=function(){if(this.oVisEnabled.checked&&(this.oSelectedVis.options.length==0||this.oSelectedVis.options[0].value=="-none-")){showMessage({contents:microstrategy.descriptors.getDescriptor(4637),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return false;}var numSecondarySources=0;if(this.secondaryKeys&&this.secondaryKeys.split(",")){numSecondarySources=this.secondaryKeys.split(",").length;}return this.validateSecondaryProviders(numSecondarySources);return true;};mstrVisualizationsEditorImpl.prototype.validateSecondaryProviders=function(numSecondaryProviders){try{if(this.oSecondaryDS){if(numSecondaryProviders<this.minSecondaryProviders){showMessage({contents:microstrategy.descriptors.getDescriptor("5051").replace(/##/g,this.minSecondaryProviders),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return false;}if(numSecondaryProviders>this.maxSecondaryProviders){showMessage({contents:microstrategy.descriptors.getDescriptor("5052").replace(/##/g,this.maxSecondaryProviders),elements:microstrategy.OK_BUTTON,type:mstrMsgBoxImpl.MSG_WARNING});return false;}}return true;}catch(err){microstrategy.errors.log(err);return false;}};function mstrVisualizationsEditorImpl(id){this.inherits=mstrEditorImpl;this.inherits(id);this.inherits=null;return this;}mstrVisualizationsEditorImpl.prototype.AddOptionsToList=function(sFromList,sToList,bKeepItem,bShowOnlyOneHidden){var i;var lLength;var oOption;var aPreSelected=new Array();var bSomethingSelected;bSomethingSelected=false;var oFromList=getObj(sFromList);var oToList=getObj(sToList);var iNextToSelect;var VISIBLE="true";var dontAddMoreOptions=false;var visibilityToDisplay=VISIBLE;for(i=0;i<oFromList.options.length&&!dontAddMoreOptions;i++){if(oFromList.options[i].selected&&oFromList.options[i].value!="-none-"){if(!this.IsOptionInList(oToList,oFromList.options[i])&&this.getVisOptionVisibility(oFromList.options[i])==visibilityToDisplay){bSomethingSelected=true;oOption=new Option(this.trim(oFromList.options[i].text),oFromList.options[i].value,false,false);oOption.title=oOption.text;aPreSelected[aPreSelected.length]=oOption.text;if(bShowOnlyOneHidden&&this.getVisOptionVisibility(oOption)!=VISIBLE){oToList.options[0]=oOption;dontAddMoreOptions=true;}else{if((oToList.options.length==1)&&(oToList.options[0].value=="-none-")){oToList.options[0]=oOption;}else{oToList.options[oToList.length]=oOption;}}}if(!bKeepItem){oFromList.options[i]=null;i--;iNextToSelect=(i<0)?0:i;if(oFromList.length==0){oOption=new Option("--- "+microstrategy.descriptors.getDescriptor("512")+" ---","-none-",false,false);oFromList.options[0]=oOption;}}}}if(bSomethingSelected){this.CleanSelectionsOnList(oFromList);this.CheckPreSelected(oToList,aPreSelected);if(iNextToSelect){oFromList.options[iNextToSelect].selected="selected";}}this.enableSecondaryDataSources(true);this.enableSetVisProps();this.updateButtonStatus();};mstrVisualizationsEditorImpl.prototype.getVisOptionVisibility=function(oOption){return oOption.value.split("|")[this.SHOW_IN_WEB];};mstrVisualizationsEditorImpl.prototype.MoveOptionsInListUp=function(sList){var oTempOptionText;var oTempOptionValue;var i;var aPreSelected=new Array();var bSomethingSelected;var oList=getObj(sList);bSomethingSelected=false;for(i=1;i<oList.options.length;i++){if(oList.options[i].selected){bSomethingSelected=true;aPreSelected[aPreSelected.length]=oList.options[i].text;oTempOptionText=oList.options[i].text;oTempOptionValue=oList.options[i].value;oList.options[i].text=oList.options[i-1].text;oList.options[i].value=oList.options[i-1].value;oList.options[i-1].text=oTempOptionText;oList.options[i-1].value=oTempOptionValue;}}if(bSomethingSelected){this.CheckPreSelected(oList,aPreSelected);}this.updateButtonStatus();this.enableSetVisProps();};mstrVisualizationsEditorImpl.prototype.MoveOptionsInListDown=function(sList){var oTempOptionText;var oTempOptionValue;var i;var aPreSelected=new Array();var bSomethingSelected;bSomethingSelected=false;var oList=getObj(sList);for(i=oList.options.length-1;i>-1;i--){if(oList.options[i].selected&&i+1<oList.options.length){bSomethingSelected=true;aPreSelected[aPreSelected.length]=oList.options[i].text;oTempOptionText=oList.options[i].text;oTempOptionValue=oList.options[i].value;oList.options[i].text=oList.options[i+1].text;oList.options[i].value=oList.options[i+1].value;oList.options[i+1].text=oTempOptionText;oList.options[i+1].value=oTempOptionValue;}}if(bSomethingSelected){this.CheckPreSelected(oList,aPreSelected);}this.updateButtonStatus();this.enableSetVisProps();};mstrVisualizationsEditorImpl.prototype.CleanSelectionsOnList=function(oList){var i;for(i=0;i<oList.options.length;i++){oList.options[i].selected=false;}};mstrVisualizationsEditorImpl.prototype.CheckPreSelected=function(oList,aPreSelected){var i;var j;this.CleanSelectionsOnList(oList);for(i=0;i<oList.options.length;i++){for(j=0;j<aPreSelected.length;j++){if(aPreSelected[j]==oList.options[i].text){oList.options[i].selected=true;}}}};mstrVisualizationsEditorImpl.prototype.IsOptionInList=function(oList,sElement){var i;for(i=0;i<oList.options.length;i++){if(this.trim(oList.options[i].text)==this.trim(sElement.text)){return true;}}return false;};mstrVisualizationsEditorImpl.prototype.moveTo=function(newX,newY){mstrDialogImpl.prototype.moveTo.apply(this,arguments);return false;};mstrVisualizationsEditorImpl.prototype.trim=function(value){value=value.replace(/\u00a0/g,"");return trim(value);};mstrVisualizationsEditorImpl.prototype.updateVisPropsBtns=function(){var p=this.oIPhoneVis;if(p){var b=this.oVisPropsIPhoneBtn;if(b){b.className=(p[p.selectedIndex].getAttribute("visPropsStyle"))?"mstrVisPropsBtn":"mstrVisPropsBtnDisabled";}}p=this.oIPadVis;if(p){var b=this.oVisPropsIPadBtn;if(b){b.className=(p[p.selectedIndex].getAttribute("visPropsStyle"))?"mstrVisPropsBtn":"mstrVisPropsBtnDisabled";}}p=this.oAPhoneVis;if(p){var b=this.oVisPropsAPhoneBtn;if(b){b.className=(p[p.selectedIndex].getAttribute("visPropsStyle"))?"mstrVisPropsBtn":"mstrVisPropsBtnDisabled";}}p=this.oATabletVis;if(p){var b=this.oVisPropsATabletBtn;if(b){b.className=(p[p.selectedIndex].getAttribute("visPropsStyle"))?"mstrVisPropsBtn":"mstrVisPropsBtnDisabled";}}};